Released XU*8*146 SEQ #130
Extracted from mail message
**KIDS**:XU*8.0*146^

**INSTALL NAME**
XU*8.0*146
"BLD",269,0)
XU*8.0*146^KERNEL^0^3000411^y
"BLD",269,4,0)
^9.64PA^^
"BLD",269,"KRN",0)
^9.67PA^19^17
"BLD",269,"KRN",.4,0)
.4
"BLD",269,"KRN",.401,0)
.401
"BLD",269,"KRN",.402,0)
.402
"BLD",269,"KRN",.403,0)
.403
"BLD",269,"KRN",.5,0)
.5
"BLD",269,"KRN",.84,0)
.84
"BLD",269,"KRN",3.6,0)
3.6
"BLD",269,"KRN",3.8,0)
3.8
"BLD",269,"KRN",9.2,0)
9.2
"BLD",269,"KRN",9.8,0)
9.8
"BLD",269,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",269,"KRN",9.8,"NM",1,0)
XPDIK^^0^B39475201
"BLD",269,"KRN",9.8,"NM",2,0)
XPDIA1^^0^B48547102
"BLD",269,"KRN",9.8,"NM","B","XPDIA1",2)

"BLD",269,"KRN",9.8,"NM","B","XPDIK",1)

"BLD",269,"KRN",19,0)
19
"BLD",269,"KRN",19.1,0)
19.1
"BLD",269,"KRN",101,0)
101
"BLD",269,"KRN",409.61,0)
409.61
"BLD",269,"KRN",771,0)
771
"BLD",269,"KRN",870,0)
870
"BLD",269,"KRN",8994,0)
8994
"BLD",269,"KRN","B",.4,.4)

"BLD",269,"KRN","B",.401,.401)

"BLD",269,"KRN","B",.402,.402)

"BLD",269,"KRN","B",.403,.403)

"BLD",269,"KRN","B",.5,.5)

"BLD",269,"KRN","B",.84,.84)

"BLD",269,"KRN","B",3.6,3.6)

"BLD",269,"KRN","B",3.8,3.8)

"BLD",269,"KRN","B",9.2,9.2)

"BLD",269,"KRN","B",9.8,9.8)

"BLD",269,"KRN","B",19,19)

"BLD",269,"KRN","B",19.1,19.1)

"BLD",269,"KRN","B",101,101)

"BLD",269,"KRN","B",409.61,409.61)

"BLD",269,"KRN","B",771,771)

"BLD",269,"KRN","B",870,870)

"BLD",269,"KRN","B",8994,8994)

"BLD",269,"QUES",0)
^9.62^^
"BLD",269,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
146^3000411
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XPDIA1")
0^2^B48547102
"RTN","XPDIA1",1,0)
XPDIA1 ;SFISC/RSD - Install Pre/Post Actions for Kernel files cont. ;04/10/2000  13:46
"RTN","XPDIA1",2,0)
 ;;8.0;KERNEL;**2,44,51,58,68,85,131,146**;Jul 10, 1995
"RTN","XPDIA1",3,0)
 Q
"RTN","XPDIA1",4,0)
HLPF1 ;help frames file pre
"RTN","XPDIA1",5,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",6,0)
 Q
"RTN","XPDIA1",7,0)
HLPE1 ;entry pre
"RTN","XPDIA1",8,0)
 S ^TMP($J,"XPD",DA)="" K ^DIC(9.2,DA,1),^(2),^(3),^(10)
"RTN","XPDIA1",9,0)
 Q
"RTN","XPDIA1",10,0)
HLPF2 ;file post
"RTN","XPDIA1",11,0)
 N DA,DIK,I,X,Y,Y0
"RTN","XPDIA1",12,0)
 ;need to send error message, need to setup message
"RTN","XPDIA1",13,0)
 S DA=0,DIK=DIC F  S DA=$O(^TMP($J,"XPD",DA)) Q:'DA  D
"RTN","XPDIA1",14,0)
 .;repoint Related Frame (2;0)
"RTN","XPDIA1",15,0)
 .S I=0 F  S I=$O(^DIC(9.2,DA,2,I)) Q:'I  S Y0=$G(^(I,0)),Y=$$LK^XPDIA("^DIC(9.2)",$P(Y0,U,2)),$P(^DIC(9.2,DA,2,I,0),U,2)=Y
"RTN","XPDIA1",16,0)
 .;repoint OBJECT (10;0)
"RTN","XPDIA1",17,0)
 .S (I,X)=0 F  S I=$O(^DIC(9.2,DA,10,I)) Q:'I  S Y0=$G(^(I,0)) D
"RTN","XPDIA1",18,0)
 ..S Y=$$LK^XPDIA("^MAG",$P(Y0,U)) S:Y $P(^DIC(9.2,DA,10,I,0),U)=Y,X=X+1_U_I
"RTN","XPDIA1",19,0)
 ..K:'Y ^DIC(9.2,DA,10,I)
"RTN","XPDIA1",20,0)
 .I X S $P(^DIC(9.2,DA,10,0),U,3,4)=$P(X,U,2)_U_+X
"RTN","XPDIA1",21,0)
 .D IX1^DIK
"RTN","XPDIA1",22,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",23,0)
 Q
"RTN","XPDIA1",24,0)
HLPDEL ;help frame delete
"RTN","XPDIA1",25,0)
 N DA,DIK,XPDI,XPDJ
"RTN","XPDIA1",26,0)
 S XPDI=0
"RTN","XPDIA1",27,0)
 F  S XPDI=$O(^TMP($J,"XPDEL",XPDI)),XPDJ=0 Q:'XPDI  D
"RTN","XPDIA1",28,0)
 .S DIK="^DIC(9.2,XPDJ,2,"
"RTN","XPDIA1",29,0)
 .;check other frames that point to this one
"RTN","XPDIA1",30,0)
 .F  S XPDJ=$O(^DIC(9.2,"AE",XPDI,XPDJ)) Q:'XPDJ  S Z=$O(^(XPDJ,0)) D:Z
"RTN","XPDIA1",31,0)
 ..K DA S DA=Z,DA(1)=XPDJ D ^DIK
"RTN","XPDIA1",32,0)
 .;delete this frame
"RTN","XPDIA1",33,0)
 .K DA S DA=XPDI,DIK="^DIC(9.2," D ^DIK
"RTN","XPDIA1",34,0)
 Q
"RTN","XPDIA1",35,0)
BULE1 ;bulletin entry pre
"RTN","XPDIA1",36,0)
 N X,I S I=0
"RTN","XPDIA1",37,0)
 ;save current Mail Groups (2)
"RTN","XPDIA1",38,0)
 I $G(^XMB(3.6,DA,2,0))]"" S X(0)=^(0) F  S I=$O(^XMB(3.6,DA,2,I)) Q:'I  S X(I)=$G(^(I,0))
"RTN","XPDIA1",39,0)
 K ^XMB(3.6,DA)
"RTN","XPDIA1",40,0)
 ;after killing data, put back Mail Groups before data merge
"RTN","XPDIA1",41,0)
 I $D(X) S ^XMB(3.6,DA,2,0)=X(0),I=0 F  S I=$O(X(I)) Q:'I  S ^XMB(3.6,DA,2,I,0)=X(I)
"RTN","XPDIA1",42,0)
 Q
"RTN","XPDIA1",43,0)
BULDEL ;del bulletins
"RTN","XPDIA1",44,0)
 N DA,DIK,XPDI
"RTN","XPDIA1",45,0)
 S XPDI=0,DIK="^XMB(3.6,"
"RTN","XPDIA1",46,0)
 F  S XPDI=$O(^TMP($J,"XPDEL",XPDI)) Q:'XPDI  S DA=XPDI D ^DIK
"RTN","XPDIA1",47,0)
 Q
"RTN","XPDIA1",48,0)
MAILGF1 ;mail groups file pre
"RTN","XPDIA1",49,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",50,0)
 Q
"RTN","XPDIA1",51,0)
MAILGE1 ;mail group entry pre
"RTN","XPDIA1",52,0)
 N I,J
"RTN","XPDIA1",53,0)
 S ^TMP($J,"XPD",DA)=""
"RTN","XPDIA1",54,0)
 ;save MEMBER GROUPS (5;0)
"RTN","XPDIA1",55,0)
 I $O(^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,5,0)) M ^TMP($J,"XPD",DA,5)=^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,5) K ^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,5)
"RTN","XPDIA1",56,0)
 ;save MEMBER - REMOTE (6;0)
"RTN","XPDIA1",57,0)
 I $O(^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,6,0)) M ^TMP($J,"XPD",DA,6)=^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,6) K ^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,6)
"RTN","XPDIA1",58,0)
 ;if there is a new Description, kill the old Description
"RTN","XPDIA1",59,0)
 K:$O(^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,2,0)) ^XMB(3.8,DA,2)
"RTN","XPDIA1",60,0)
 S I=^XMB(3.8,DA,0),J=^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,0)
"RTN","XPDIA1",61,0)
 ;save REFERENCE COUNT (0;4) & LAST REFERENCED (0;5)
"RTN","XPDIA1",62,0)
 S:$P(I,U,4) $P(J,U,4)=$P(I,U,4) S:$P(I,U,5) $P(J,U,5)=$P(I,U,5)
"RTN","XPDIA1",63,0)
 ;check COORDINATOR (0;7), if exist then save, else bring in one that was asked during install question
"RTN","XPDIA1",64,0)
 D
"RTN","XPDIA1",65,0)
 .I $P(I,U,7) S $P(J,U,7)=$P(I,U,7) Q
"RTN","XPDIA1",66,0)
 .S %=$O(^XPD(9.7,XPDA,"QUES","B","XPM"_OLDA_"#1",0)) Q:'%
"RTN","XPDIA1",67,0)
 .S:$G(^XPD(9.7,XPDA,"QUES",%,1)) $P(J,U,7)=^(1)
"RTN","XPDIA1",68,0)
 S ^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,0)=J,I=$G(^XMB(3.8,DA,3))
"RTN","XPDIA1",69,0)
 ;save ORGANIZER (3;1)
"RTN","XPDIA1",70,0)
 I $P(I,U) S $P(^XTMP("XPDI",XPDA,"KRN",3.8,OLDA,3),U)=$P(I,U)
"RTN","XPDIA1",71,0)
 Q
"RTN","XPDIA1",72,0)
MAILGF2 ;mail group file post
"RTN","XPDIA1",73,0)
 N DA,DIK,XPDMDA,XPDI,Y
"RTN","XPDIA1",74,0)
 S XPDMDA=0,DIK="^XMB(3.8,"
"RTN","XPDIA1",75,0)
 F  S XPDMDA=$O(^TMP($J,"XPD",XPDMDA)) Q:'XPDMDA  D
"RTN","XPDIA1",76,0)
 .;merge & repoint MEMBER GROUP (5;0)
"RTN","XPDIA1",77,0)
 .S XPDI=0
"RTN","XPDIA1",78,0)
 .F  S XPDI=$O(^TMP($J,"XPD",XPDMDA,5,XPDI)) Q:'XPDI  S Y=$P($G(^(XPDI,0)),U) D:Y]"" ADD^XPDIA(3.811,XPDMDA,Y)
"RTN","XPDIA1",79,0)
 .;merge & repoint MEMBER - REMOTE (6;0)
"RTN","XPDIA1",80,0)
 .S XPDI=0
"RTN","XPDIA1",81,0)
 .F  S XPDI=$O(^TMP($J,"XPD",XPDMDA,6,XPDI)) Q:'XPDI  S Y=$P($G(^(XPDI,0)),U) D:Y]"" ADD^XPDIA(3.812,XPDMDA,Y)
"RTN","XPDIA1",82,0)
 .S DA=XPDMDA D IX1^DIK
"RTN","XPDIA1",83,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",84,0)
 Q
"RTN","XPDIA1",85,0)
HLAPF1 ;HL7 application parameter #771 file pre
"RTN","XPDIA1",86,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",87,0)
 Q
"RTN","XPDIA1",88,0)
HLAPE1 ;HL7 application parameter #771 entry pre
"RTN","XPDIA1",89,0)
 N I,J
"RTN","XPDIA1",90,0)
 S ^TMP($J,"XPD",DA)=""
"RTN","XPDIA1",91,0)
 S I=^HL(771,DA,0),J=^XTMP("XPDI",XPDA,"KRN",771,OLDA,0)
"RTN","XPDIA1",92,0)
 ;save FACILITY NAME (0;3)
"RTN","XPDIA1",93,0)
 S:$P(I,U,3)]"" $P(J,U,3)=$P(I,U,3)
"RTN","XPDIA1",94,0)
 ;repoint MAIL GROUP (0;4)
"RTN","XPDIA1",95,0)
 S:$P(J,U,4)]"" $P(J,U,4)=$$LK^XPDIA("^XMB(3.8)",$P(J,U,4))
"RTN","XPDIA1",96,0)
 ;repoint COUNTRY CODE (0;7)
"RTN","XPDIA1",97,0)
 S:$P(J,U,7)]"" $P(J,U,7)=$$LK^XPDIA("^HL(779.004)",$P(J,U,7))
"RTN","XPDIA1",98,0)
 S ^XTMP("XPDI",XPDA,"KRN",771,OLDA,0)=J
"RTN","XPDIA1",99,0)
 ;remove HL7 SEGMENT (SEG;0), HL7 MESSAGE (MSG;0)
"RTN","XPDIA1",100,0)
 K ^HL(771,DA,"SEG"),^("MSG")
"RTN","XPDIA1",101,0)
 Q
"RTN","XPDIA1",102,0)
HLAPF2 ;HL7 application parameter #771 file post
"RTN","XPDIA1",103,0)
 N DA,DIK,XPDI,X,Y
"RTN","XPDIA1",104,0)
 S DA=0,DIK="^HL(771,"
"RTN","XPDIA1",105,0)
 F  S DA=$O(^TMP($J,"XPD",DA)) Q:'DA  D
"RTN","XPDIA1",106,0)
 .;repoint HL7 SEGMENT (SEG;0)
"RTN","XPDIA1",107,0)
 .S XPDI=0
"RTN","XPDIA1",108,0)
 .F  S XPDI=$O(^HL(771,DA,"SEG",XPDI)) Q:'XPDI  S Y=$P($G(^(XPDI,0)),U) D
"RTN","XPDIA1",109,0)
 ..S X=$$LK^XPDIA("^HL(771.3)",$P(Y,U))
"RTN","XPDIA1",110,0)
 ..I X]"" S $P(^HL(771,DA,"SEG",XPDI,0),U)=X Q
"RTN","XPDIA1",111,0)
 ..K ^HL(771,DA,"SEG",XPDI)
"RTN","XPDIA1",112,0)
 .;repoint HL7 MESSAGE (MSG;0)
"RTN","XPDIA1",113,0)
 .S XPDI=0
"RTN","XPDIA1",114,0)
 .F  S XPDI=$O(^HL(771,DA,"MSG",XPDI)) Q:'XPDI  S Y=$P($G(^(XPDI,0)),U) D
"RTN","XPDIA1",115,0)
 ..S X=$$LK^XPDIA("^HL(771.3)",$P(Y,U))
"RTN","XPDIA1",116,0)
 ..I X]"" S $P(^HL(771,DA,"MSG",XPDI,0),U)=X Q
"RTN","XPDIA1",117,0)
 ..K ^HL(771,DA,"MSG",XPDI)
"RTN","XPDIA1",118,0)
 .D IX1^DIK
"RTN","XPDIA1",119,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA1",120,0)
 Q
"RTN","XPDIA1",121,0)
HLLLPE ;HL7 lower level protocol #869.2 entry pre
"RTN","XPDIA1",122,0)
 N I,J,L,TMP,Y
"RTN","XPDIA1",123,0)
 S L=$P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,0),U),I=0
"RTN","XPDIA1",124,0)
 ;loop thru logical links and find those pointing to this llp
"RTN","XPDIA1",125,0)
 F  S I=$O(^XTMP("XPDI",XPDA,"KRN",870,I)) Q:'I  S J=$G(^(I,0)) D
"RTN","XPDIA1",126,0)
 . Q:$P(J,U,3)'=L
"RTN","XPDIA1",127,0)
 . ;save llp into tmp, get the llp type field
"RTN","XPDIA1",128,0)
 . M TMP=^XTMP("XPDI",XPDA,"KRN",869.2,OLDA) S Y=$P(TMP(0),U,2)
"RTN","XPDIA1",129,0)
 . K TMP(-1),TMP(0)
"RTN","XPDIA1",130,0)
 . M ^XTMP("XPDI",XPDA,"KRN",870,I)=TMP S $P(^(I,0),U,3)=Y
"RTN","XPDIA1",131,0)
 S I=$P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,0),U,2)
"RTN","XPDIA1",132,0)
 ;repoint LLP TYPE (0;2)
"RTN","XPDIA1",133,0)
 S:I]"" $P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,0),U,2)=$$LK^XPDIA("^HLCS(869.1)",I)
"RTN","XPDIA1",134,0)
 S I=$P($G(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,100)),U)
"RTN","XPDIA1",135,0)
 ;repoint MAIL GROUP (100;1)
"RTN","XPDIA1",136,0)
 S:I]"" $P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,100),U)=$$LK^XPDIA("^XMB(3.8)",I)
"RTN","XPDIA1",137,0)
 ;save HLLP DEVICE (200;1)
"RTN","XPDIA1",138,0)
 S I=$G(^HLCS(869.2,DA,200))
"RTN","XPDIA1",139,0)
 S:I $P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,200),U)=$P(I,U)
"RTN","XPDIA1",140,0)
 ;save X3.28 DEVICE (300;1)
"RTN","XPDIA1",141,0)
 S I=$G(^HLCS(869.2,DA,300))
"RTN","XPDIA1",142,0)
 S:I $P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,300),U)=$P(I,U)
"RTN","XPDIA1",143,0)
 ;save TCP/IP Start-up Node (400;6)
"RTN","XPDIA1",144,0)
 S I=$G(^HLCS(869.2,DA,400))
"RTN","XPDIA1",145,0)
 S:I $P(^XTMP("XPDI",XPDA,"KRN",869.2,OLDA,400),U,6)=$P(I,U,6)
"RTN","XPDIA1",146,0)
 Q
"RTN","XPDIA1",147,0)
HLLLE ;HL7 logical link #870 entry pre
"RTN","XPDIA1",148,0)
 N I,J,K,L,Y
"RTN","XPDIA1",149,0)
 S I=^HLCS(870,DA,0),J=^XTMP("XPDI",XPDA,"KRN",870,OLDA,0)
"RTN","XPDIA1",150,0)
 ;repoint INSTITUTION (0;2)
"RTN","XPDIA1",151,0)
 I $P(J,U,2)]"" S Y=$$LK^XPDIA("^DIC(4)",$P(J,U,2)) D:Y=""  S $P(J,U,2)=Y
"RTN","XPDIA1",152,0)
 .D BMES^XPDUTL(" Couldn't resolve Institution "_$P(J,U,2)_" for Logical Link "_$P(^HLCS(870,DA,0),U))
"RTN","XPDIA1",153,0)
 ;repoint LLP TYPE (0;3)
"RTN","XPDIA1",154,0)
 S:$P(J,U,3)]"" $P(J,U,3)=$$LK^XPDIA("^HLCS(869.1)",$P(J,U,3))
"RTN","XPDIA1",155,0)
 ;repoint DOMAIN (0;7)
"RTN","XPDIA1",156,0)
 I $P(J,U,7)]"" S Y=$$LK^XPDIA("^DIC(4.2)",$P(J,U,7)) D:Y=""  S $P(J,U,7)=Y
"RTN","XPDIA1",157,0)
 .D BMES^XPDUTL(" Couldn't resolve Domain "_$P(J,U,7)_" for Logical Link "_$P(^HLCS(870,DA,0),U))
"RTN","XPDIA1",158,0)
 ;save node 0; pieces 4,5,6,7,10,11,12,19,21
"RTN","XPDIA1",159,0)
 F L=4:1:7,10:1:12,19,21 S:$P(I,U,L)]"" $P(J,U,L)=$P(I,U,L)
"RTN","XPDIA1",160,0)
 ;set SHUTDOWN LLP (0;15) no for DSM multi-listener and yes for all else
"RTN","XPDIA1",161,0)
 S Y=$P($G(^HLCS(870,DA,400)),U,3) S:Y]"" $P(J,U,15)=$S(Y="M":(^%ZOSF("OS")["OpenM"),1:1)
"RTN","XPDIA1",162,0)
 S ^XTMP("XPDI",XPDA,"KRN",870,OLDA,0)=J
"RTN","XPDIA1",163,0)
 S I=$P($G(^XTMP("XPDI",XPDA,"KRN",870,OLDA,100)),U)
"RTN","XPDIA1",164,0)
 ;repoint MAIL GROUP (100;1)
"RTN","XPDIA1",165,0)
 S:I]"" $P(^XTMP("XPDI",XPDA,"KRN",870,OLDA,100),U)=$$LK^XPDIA("^XMB(3.8)",I)
"RTN","XPDIA1",166,0)
 ;save data from site on nodes 200,300,400
"RTN","XPDIA1",167,0)
 F L=200,300,400 S I=$G(^HLCS(870,DA,L)) D:I]""
"RTN","XPDIA1",168,0)
 . S J=$G(^XTMP("XPDI",XPDA,"KRN",870,OLDA,L)) Q:J=""
"RTN","XPDIA1",169,0)
 . ;check local data (I) and if exist set incomming data (J)
"RTN","XPDIA1",170,0)
 . F K=1:1:10 S Y=$P(I,U,K) S:Y]"" $P(J,U,K)=Y
"RTN","XPDIA1",171,0)
 . S ^XTMP("XPDI",XPDA,"KRN",870,OLDA,L)=J
"RTN","XPDIA1",172,0)
 Q
"RTN","XPDIA1",173,0)
KEYDEL ;del security keys
"RTN","XPDIA1",174,0)
 N XPDI S XPDI=0
"RTN","XPDIA1",175,0)
 F  S XPDI=$O(^TMP($J,"XPDEL",XPDI)) Q:'XPDI  D DEL^XPDKEY(XPDI)
"RTN","XPDIA1",176,0)
 Q
"RTN","XPDIA1",177,0)
LMDEL ;del list manager templates
"RTN","XPDIA1",178,0)
 N DA,DIK,XPDI
"RTN","XPDIA1",179,0)
 S XPDI=0,DIK="^SD(409.61,"
"RTN","XPDIA1",180,0)
 F  S XPDI=$O(^TMP($J,"XPDEL",XPDI)) Q:'XPDI  S DA=XPDI D ^DIK
"RTN","XPDIA1",181,0)
 Q
"RTN","XPDIA1",182,0)
RPCDEL ;del Kernel RPCs
"RTN","XPDIA1",183,0)
 N DA,DIK,XPDI
"RTN","XPDIA1",184,0)
 S XPDI=0,DIK="^XWB(8994,"
"RTN","XPDIA1",185,0)
 F  S XPDI=$O(^TMP($J,"XPDEL",XPDI)) Q:'XPDI  S DA=XPDI D ^DIK
"RTN","XPDIA1",186,0)
 Q
"RTN","XPDIA1",187,0)
HLAPDEL ;del HL7 application parameter #771
"RTN","XPDIA1",188,0)
 Q
"RTN","XPDIA1",189,0)
HLLLDEL ;del HL7 logical link #870
"RTN","XPDIA1",190,0)
 N DA,DIK,XPDI,XPDJ,Y
"RTN","XPDIA1",191,0)
 S XPDI=0
"RTN","XPDIA1",192,0)
 ;loop thru protocols, #101, get LL field, 770.7 (700;7)
"RTN","XPDIA1",193,0)
 F  S XPDI=$O(^ORD(101,XPDI)) Q:'XPDI  S Y=$P($G(^(XPDI,700)),U,7) D:Y
"RTN","XPDIA1",194,0)
 . Q:'$D(^TMP($J,"XPDEL",Y))
"RTN","XPDIA1",195,0)
 . K XPDJ S XPDJ(101,XPDI_",",770.7)="@"
"RTN","XPDIA1",196,0)
 . D FILE^DIE("","XPDJ")
"RTN","XPDIA1",197,0)
 ;subscription, #774
"RTN","XPDIA1",198,0)
 F  S XPDI=$O(TMP($J,"XPDEL",XPDI)) Q:'XPDI  D:$D(^HLS(774,"C",XPDI))
"RTN","XPDIA1",199,0)
 . S XPDJ=0 F  S XPDJ=$O(^HLS(774,"C",XPDI,XPDJ))
"RTN","XPDIA1",200,0)
 Q
"RTN","XPDIK")
0^1^B39475201
"RTN","XPDIK",1,0)
XPDIK ;SFISC/RSD - Install Kernel Files & FM Files ;03/31/2000  07:49
"RTN","XPDIK",2,0)
 ;;8.0;KERNEL;**15,58,108,124,146**;Jul 10, 1995
"RTN","XPDIK",3,0)
 Q
"RTN","XPDIK",4,0)
KRN ;
"RTN","XPDIK",5,0)
 ;XPDA=package ien in INSTALL FILE, XPDNM=package name, XPDCP= check points
"RTN","XPDIK",6,0)
 N DA,DIC,DIOVRD,EPOS,EPRE,FDEL,FPOS,FPRE,OLDA,ORD,X,XGCEDITR,XPDFIL,XPDFILNM,XPDFL,XPDNEW,XREF,Y,%
"RTN","XPDIK",7,0)
 ;DIOVRD is used to override write protection on a file
"RTN","XPDIK",8,0)
 ;XGCEDITR is check in file 8995, at 'SCR' node of DD
"RTN","XPDIK",9,0)
 S ORD=0,XPDCP="KRN",(DIOVRD,XGCEDITR)=1
"RTN","XPDIK",10,0)
 F  S ORD=$O(^XTMP("XPDI",XPDA,"ORD",ORD)) Q:'ORD  S XPDFIL=+$O(^(ORD,0)),XREF=$G(^(XPDFIL)),XPDFILNM=$G(^(XPDFIL,0)) D:XPDFIL
"RTN","XPDIK",11,0)
 .;sets up EPOS,EPRE,FDEL,FPOS,FPRE variables
"RTN","XPDIK",12,0)
 .F DA=1:1:5 S @$P("FPRE^EPRE^FPOS^EPOS^FDEL",U,DA)=$P(XREF,";",DA+5)
"RTN","XPDIK",13,0)
 .K DIC,^TMP($J,"XPDEL")
"RTN","XPDIK",14,0)
 .S DIC=$G(^DIC(XPDFIL,0,"GL")),XREF=+$P(XREF,";",3)
"RTN","XPDIK",15,0)
 .;check if file, XPDFIL, exist at this site
"RTN","XPDIK",16,0)
 .I $P($G(^DIC(XPDFIL,0)),U)'=XPDFILNM D BMES^XPDUTL(" File "_XPDFIL_" is not "_XPDFILNM_", nothing installed.") Q
"RTN","XPDIK",17,0)
 .;check if XPDFIL has already been installed
"RTN","XPDIK",18,0)
 .I $P(^XPD(9.7,XPDA,"KRN",XPDFIL,0),U,2) D BMES^XPDUTL(" "_XPDFILNM_" already installed.") Q
"RTN","XPDIK",19,0)
 .D BMES^XPDUTL(" Installing "_XPDFILNM),SETTOT^XPDID(XPDFIL)
"RTN","XPDIK",20,0)
 .;do File Pre-install action, continue if ok
"RTN","XPDIK",21,0)
 .;XPDFL= 0-send,1-delete,2-link,3-merge,4-attach,5-disable
"RTN","XPDIK",22,0)
 .;loops thru the entries for this file
"RTN","XPDIK",23,0)
 .I '$$ACT(FPRE) S OLDA=0 F  S OLDA=$O(^XTMP("XPDI",XPDA,"KRN",XPDFIL,OLDA)) Q:'OLDA  S XPDFL=+$G(^(OLDA,-1)),OLDA(0)=^(0) D
"RTN","XPDIK",24,0)
 ..;if we are doing VT graphic display, set counter
"RTN","XPDIK",25,0)
 ..I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+1 D:'(XPDIDCNT#XPDIDMOD) UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIK",26,0)
 ..;quit if disable or attach (4 or 5).  Attach will be processed under the parent menu.
"RTN","XPDIK",27,0)
 ..Q:XPDFL>3
"RTN","XPDIK",28,0)
 ..;if FM file, need to set screening logic
"RTN","XPDIK",29,0)
 ..I XPDFIL<.44 S %=$S(XPDFIL'=.403:4,1:8),DIC("S")="I $P(^(0),U,"_%_")="_$P(OLDA(0),U,%)
"RTN","XPDIK",30,0)
 ..;if deleting at site and a template, reset the lookup value and DIC("S")
"RTN","XPDIK",31,0)
 ..I XPDFL=1,XPDFIL<.44 S %=$P(OLDA(0),U),$P(OLDA(0),U)=$P(%,"    FILE #"),DIC("S")="I $P(^(0),U,"_$S(XPDFIL'=.403:4,1:8)_")="_+$P(%,"    FILE #",2)
"RTN","XPDIK",32,0)
 ..;XPDNEW=1 if entry is new, laygo
"RTN","XPDIK",33,0)
 ..S X=$P(OLDA(0),U),Y=$$DIC(XPDFIL,X,$G(DIC("S")),XPDFL) Q:'Y  S DA=+Y,XPDNEW=$P(Y,U,3)
"RTN","XPDIK",34,0)
 ..;if deleting then save and process after FPOS
"RTN","XPDIK",35,0)
 ..I XPDFL=1 S ^TMP($J,"XPDEL",DA)="" Q
"RTN","XPDIK",36,0)
 ..;do Entries Pre-install action
"RTN","XPDIK",37,0)
 ..Q:$$ACT(EPRE)
"RTN","XPDIK",38,0)
 ..;merges the data, if you want the data deleted before the merge, you must
"RTN","XPDIK",39,0)
 ..;do it in the Entry Pre-install node, EPRE.
"RTN","XPDIK",40,0)
 ..M @(DIC_DA_")")=^XTMP("XPDI",XPDA,"KRN",XPDFIL,OLDA)
"RTN","XPDIK",41,0)
 ..;kill the flag node from the live data node
"RTN","XPDIK",42,0)
 ..K @(DIC_DA_",-1)") Q:$$ACT(EPOS)
"RTN","XPDIK",43,0)
 ..;XREF is flag to x-ref file after each entry, it is set in file 9.6
"RTN","XPDIK",44,0)
 ..I XREF N DIK S DIK=DIC D IX1^DIK
"RTN","XPDIK",45,0)
 .;do File Post Install Action
"RTN","XPDIK",46,0)
 .S %=$$ACT(FPOS)
"RTN","XPDIK",47,0)
 .;process the deleting of entries, FDEL should allow the passing of all entries
"RTN","XPDIK",48,0)
 .;to delete in array ^TMP($J,"XPDEL",DA)=""
"RTN","XPDIK",49,0)
 .I $L(FDEL),$D(^TMP($J,"XPDEL")) S %="^TMP($J,""XPDEL"")" D @FDEL
"RTN","XPDIK",50,0)
 .;complete check point
"RTN","XPDIK",51,0)
 .S %=$$XPCOM(XPDFIL)
"RTN","XPDIK",52,0)
 .K ^TMP($J,"XPDEL")
"RTN","XPDIK",53,0)
 .I $D(XPDIDVT) D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIK",54,0)
 Q
"RTN","XPDIK",55,0)
FIA ;
"RTN","XPDIK",56,0)
 ;XPFIL2=file is new^DD screen failed^data already exists^change file name^don't add data; 1=yes, 0=no
"RTN","XPDIK",57,0)
 N XPGR,XPFIL,XPFILO,XPFIL2,Z
"RTN","XPDIK",58,0)
 S XPFIL=0,XPGR=$NA(^XTMP("XPDI",XPDA))
"RTN","XPDIK",59,0)
 F  S XPFIL=$O(^XTMP("XPDI",XPDA,"FIA",XPFIL)) Q:'XPFIL  S XPFILO=^(XPFIL,0,1),XPFIL2=^(2) D
"RTN","XPDIK",60,0)
 .;if we are doing VT graphic display, set counter
"RTN","XPDIK",61,0)
 .I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+1 D:'(XPDIDCNT#XPDIDMOD) UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIK",62,0)
 .;file is new, alway install DD
"RTN","XPDIK",63,0)
 .S:XPFIL2 $P(XPFILO,U)="y"
"RTN","XPDIK",64,0)
 .;DD failed screen
"RTN","XPDIK",65,0)
 .I $P(XPFIL2,U,2) D  Q
"RTN","XPDIK",66,0)
 ..N XPD
"RTN","XPDIK",67,0)
 ..S XPD(1)=" ",XPD(2)="Data Dictionary for File #"_XPFIL_" not installed, failed DD screen."
"RTN","XPDIK",68,0)
 ..D MES^XPDUTL(.XPD) S %=$$XPCOM(XPFIL)
"RTN","XPDIK",69,0)
 .;if udate DD question = no & file is not new update checkpoint
"RTN","XPDIK",70,0)
 .I $P(XPFILO,U)'="y"&'XPFIL2 S %=$$XPCOM(XPFIL)
"RTN","XPDIK",71,0)
 .;check if XPFIL has already been installed
"RTN","XPDIK",72,0)
 .Q:$P(^XPD(9.7,XPDA,4,XPFIL,0),U,2)
"RTN","XPDIK",73,0)
 .;update file name
"RTN","XPDIK",74,0)
 .I $P(XPFIL2,U,4) D
"RTN","XPDIK",75,0)
 ..N DIE,DR,DA
"RTN","XPDIK",76,0)
 ..S DR=".01////"_^XTMP("XPDI",XPDA,"FIA",XPFIL),DA=XPFIL,DIE=1
"RTN","XPDIK",77,0)
 ..D ^DIE
"RTN","XPDIK",78,0)
 .;move DD and check for errors
"RTN","XPDIK",79,0)
 .D DDIN^DIFROMS(XPFIL,"","",XPGR),DIERR("** ERROR IN DATA DICTIONARY FOR FILE # "_XPFIL_" **"):$D(DIERR)
"RTN","XPDIK",80,0)
 .S %=$$XPCOM(XPFIL)
"RTN","XPDIK",81,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDTOT)
"RTN","XPDIK",82,0)
 Q
"RTN","XPDIK",83,0)
DAT ;
"RTN","XPDIK",84,0)
 N XPGR,XPFIL,XPFILO,XPFIL2,Z
"RTN","XPDIK",85,0)
 S XPFIL=0,XPGR=$NA(^XTMP("XPDI",XPDA))
"RTN","XPDIK",86,0)
 ;DO if they are sending data
"RTN","XPDIK",87,0)
 F  S XPFIL=$O(^XTMP("XPDI",XPDA,"FIA",XPFIL)) Q:'XPFIL  S XPFILO=^(XPFIL,0,1),XPFIL2=^(2) D:$P(XPFILO,U,7)="y"
"RTN","XPDIK",88,0)
 .;DD failed screen or answer no to adding data or 'Add if new' & data already exists or file doesn't exist
"RTN","XPDIK",89,0)
 .I $P(XPFIL2,U,2)!$P(XPFIL2,U,5)!($P(XPFILO,U,8)="a"&$P(XPFIL2,U,3))!'$D(^DIC(XPFIL,0)) S %=$$XPCOM(XPFIL,1) Q
"RTN","XPDIK",90,0)
 .;check if XPFIL has already been installed or no data to input
"RTN","XPDIK",91,0)
 .Q:$P(^XPD(9.7,XPDA,4,XPFIL,0),U,3)!('$D(^XTMP("XPDI",XPDA,"DATA",XPFIL)))
"RTN","XPDIK",92,0)
 .;bring in Data and check for error
"RTN","XPDIK",93,0)
 .D DATAIN^DIFROMS(XPFIL,"","",XPGR),DIERR("** ERROR IN DATA FOR FILE # "_XPFIL_" **"):$D(DIERR)
"RTN","XPDIK",94,0)
 .S %=$$XPCOM(XPFIL,1)
"RTN","XPDIK",95,0)
 D RP^DIFROMSR("","",XPGR),DIERR("** ERROR IN POINTER RESOLUTION OF DATA **"):$D(DIERR)
"RTN","XPDIK",96,0)
 Q
"RTN","XPDIK",97,0)
 ;record error
"RTN","XPDIK",98,0)
DIERR(XPDI) N XPD
"RTN","XPDIK",99,0)
 D MSG^DIALOG("AE",.XPD) Q:'$D(XPD)
"RTN","XPDIK",100,0)
 D BMES^XPDUTL(XPDI),MES^XPDUTL(.XPD)
"RTN","XPDIK",101,0)
 Q
"RTN","XPDIK",102,0)
 ;
"RTN","XPDIK",103,0)
 ;XPDF=file #,X=input,XPDS=screen logic, XPDACT=action
"RTN","XPDIK",104,0)
DIC(XPDF,XPDX,XPDS,XPDACT) ;
"RTN","XPDIK",105,0)
 N DIC,DIERR,XPD,XPDN
"RTN","XPDIK",106,0)
 S DIC=$G(^DIC(XPDF,0,"GL"))
"RTN","XPDIK",107,0)
 D FIND^DIC(XPDF,"","","XQf",XPDX,5,"",$G(XPDS),"","XPD")
"RTN","XPDIK",108,0)
 ;one or more matches, just return first one
"RTN","XPDIK",109,0)
 I $G(XPD(0)) D:XPD(0)>1  Q XPD(1)
"RTN","XPDIK",110,0)
 .N %
"RTN","XPDIK",111,0)
 .S %(1)=$P($G(^DIC(XPDF,0)),U)_"  "_XPDX_"  is Duplicated,",%(2)=" only ien #"_XPD(1)_" was updated."
"RTN","XPDIK",112,0)
 .D MES^XPDUTL(.%)
"RTN","XPDIK",113,0)
 ;no match and action=(delete,link, or attach), don't write message if deleting
"RTN","XPDIK",114,0)
 I $G(XPDACT),XPDACT'=3 D:XPDACT'=1 BMES^XPDUTL(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" Lookup failed, NO Action Taken.") Q 0
"RTN","XPDIK",115,0)
 ;add a new entry
"RTN","XPDIK",116,0)
 N DLAYGO,X,Y
"RTN","XPDIK",117,0)
 S X=XPDX,DIC(0)="LX",DLAYGO=XPDF,DIC("S")=$G(XPDS) D ^DIC
"RTN","XPDIK",118,0)
 I Y<0 D BMES^XPDUTL(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIK",119,0)
 Q Y
"RTN","XPDIK",120,0)
 ;code can't be used until UPDATE^DIE allows the creation of a record
"RTN","XPDIK",121,0)
 ;without required identifiers
"RTN","XPDIK",122,0)
 ;K XPD,DIERR
"RTN","XPDIK",123,0)
 ;S XPD(XPDF,"+1,",.01)=XPDX
"RTN","XPDIK",124,0)
 ;D UPDATE^DIE("","XPD","XPDN")
"RTN","XPDIK",125,0)
 ;couldn't add as new
"RTN","XPDIK",126,0)
 ;I $D(DIERR) D DIERR(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIK",127,0)
 ;I '$G(XPDN(1)) D BMES^XPDUTL(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIK",128,0)
 ;Q XPDN(1)
"RTN","XPDIK",129,0)
 ;
"RTN","XPDIK",130,0)
ACT(%) ;execute action, returns 0 to continue, 1 to quit
"RTN","XPDIK",131,0)
 ;user can count on DIC,DA,XPDFIL,OLDA,XPDNM,XPDFL,X,Y being around
"RTN","XPDIK",132,0)
 ;XPDNEW is set only for Entry Pre-install action
"RTN","XPDIK",133,0)
 Q:%="" 0
"RTN","XPDIK",134,0)
 N %1,%2,%3 S %1=$G(DIC),%2=$G(DA),%3=$G(OLDA)
"RTN","XPDIK",135,0)
 N DA,DIC,DIOVRD,OLDA,EPOS,EPRE,FPOS,FPRE,ORD,XREF,XPDQUIT
"RTN","XPDIK",136,0)
 S DIC=%1,DA=%2,OLDA=%3
"RTN","XPDIK",137,0)
 S:%'["^" %="^"_%
"RTN","XPDIK",138,0)
 ;XPDQUIT=quit this level of processing
"RTN","XPDIK",139,0)
 D @% Q $D(XPDQUIT)
"RTN","XPDIK",140,0)
 Q
"RTN","XPDIK",141,0)
 ;
"RTN","XPDIK",142,0)
XPCOM(XPDF,XPDJ) ;complete checkpoint for file XPDF
"RTN","XPDIK",143,0)
 ;XPDJ=1 only for data of fm files, it set the field to edit = 2
"RTN","XPDIK",144,0)
 N XPD,%,Z
"RTN","XPDIK",145,0)
 S %=$$NOW^XLFDT,Z=$S(XPDCP="KRN":9.715,1:9.714),XPD(Z,XPDF_","_XPDA_",",$G(XPDJ)+1)=%
"RTN","XPDIK",146,0)
 ;if Build Components, save the ORDer number
"RTN","XPDIK",147,0)
 S:Z=9.715 XPD(Z,XPDF_","_XPDA_",",2)=ORD
"RTN","XPDIK",148,0)
 D FILE^DIE("","XPD")
"RTN","XPDIK",149,0)
 Q 1
"RTN","XPDIK",150,0)
 ;
"RTN","XPDIK",151,0)
XPCK(XPDI) ;setup check points for file type XPDI
"RTN","XPDIK",152,0)
 ;XPDI="KRN"-components, ="FIA"-files
"RTN","XPDIK",153,0)
 N %,XPD,XPDF,XPDJ,XPDK
"RTN","XPDIK",154,0)
 ;XPDK=sub DD
"RTN","XPDIK",155,0)
 S XPDK=$S(XPDI="KRN":9.715,1:9.714),XPDF=0
"RTN","XPDIK",156,0)
 F %=1:1 S XPDF=$O(^XTMP("XPDI",XPDA,XPDI,XPDF)) Q:'XPDF  S (XPDJ(%),XPD(XPDK,"+"_%_","_XPDA_",",.01))=XPDF
"RTN","XPDIK",157,0)
 D:$D(XPD)>9 UPDATE^DIE("","XPD","XPDJ")
"RTN","XPDIK",158,0)
 Q
"VER")
8.0^22.0
**END**
**END**
