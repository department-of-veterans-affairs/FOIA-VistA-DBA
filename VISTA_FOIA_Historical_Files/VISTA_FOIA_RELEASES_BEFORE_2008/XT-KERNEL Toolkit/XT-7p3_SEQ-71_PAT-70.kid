Released XT*7.3*70 SEQ #71
Extracted from mail message
**KIDS**:XT*7.3*70^

**INSTALL NAME**
XT*7.3*70
"BLD",733,0)
XT*7.3*70^TOOLKIT^0^3040406^y
"BLD",733,1,0)
^^2^2^3030428^^^
"BLD",733,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"BLD",733,1,2,0)
Patch XT*7.3*70.
"BLD",733,1,3,0)

"BLD",733,4,0)
^9.64PA^^
"BLD",733,"KRN",0)
^9.67PA^8989.52^19
"BLD",733,"KRN",.4,0)
.4
"BLD",733,"KRN",.401,0)
.401
"BLD",733,"KRN",.402,0)
.402
"BLD",733,"KRN",.403,0)
.403
"BLD",733,"KRN",.5,0)
.5
"BLD",733,"KRN",.84,0)
.84
"BLD",733,"KRN",3.6,0)
3.6
"BLD",733,"KRN",3.8,0)
3.8
"BLD",733,"KRN",9.2,0)
9.2
"BLD",733,"KRN",9.8,0)
9.8
"BLD",733,"KRN",9.8,"NM",0)
^9.68A^7^6
"BLD",733,"KRN",9.8,"NM",1,0)
ZTP1^^0^B15149784
"BLD",733,"KRN",9.8,"NM",2,0)
ZTPP^^0^B11701778
"BLD",733,"KRN",9.8,"NM",3,0)
XTSUMBLD^^0^B25513558
"BLD",733,"KRN",9.8,"NM",4,0)
XTEDTVXD^^0^B10047824
"BLD",733,"KRN",9.8,"NM",6,0)
XTVNUM^^0^B12984715
"BLD",733,"KRN",9.8,"NM",7,0)
XTRMON^^0^B9421113
"BLD",733,"KRN",9.8,"NM","B","XTEDTVXD",4)

"BLD",733,"KRN",9.8,"NM","B","XTRMON",7)

"BLD",733,"KRN",9.8,"NM","B","XTSUMBLD",3)

"BLD",733,"KRN",9.8,"NM","B","XTVNUM",6)

"BLD",733,"KRN",9.8,"NM","B","ZTP1",1)

"BLD",733,"KRN",9.8,"NM","B","ZTPP",2)

"BLD",733,"KRN",19,0)
19
"BLD",733,"KRN",19,"NM",0)
^9.68A^^
"BLD",733,"KRN",19.1,0)
19.1
"BLD",733,"KRN",101,0)
101
"BLD",733,"KRN",409.61,0)
409.61
"BLD",733,"KRN",771,0)
771
"BLD",733,"KRN",870,0)
870
"BLD",733,"KRN",8989.51,0)
8989.51
"BLD",733,"KRN",8989.52,0)
8989.52
"BLD",733,"KRN",8994,0)
8994
"BLD",733,"KRN","B",.4,.4)

"BLD",733,"KRN","B",.401,.401)

"BLD",733,"KRN","B",.402,.402)

"BLD",733,"KRN","B",.403,.403)

"BLD",733,"KRN","B",.5,.5)

"BLD",733,"KRN","B",.84,.84)

"BLD",733,"KRN","B",3.6,3.6)

"BLD",733,"KRN","B",3.8,3.8)

"BLD",733,"KRN","B",9.2,9.2)

"BLD",733,"KRN","B",9.8,9.8)

"BLD",733,"KRN","B",19,19)

"BLD",733,"KRN","B",19.1,19.1)

"BLD",733,"KRN","B",101,101)

"BLD",733,"KRN","B",409.61,409.61)

"BLD",733,"KRN","B",771,771)

"BLD",733,"KRN","B",870,870)

"BLD",733,"KRN","B",8989.51,8989.51)

"BLD",733,"KRN","B",8989.52,8989.52)

"BLD",733,"KRN","B",8994,8994)

"BLD",733,"QUES",0)
^9.62^^
"BLD",733,"REQB",0)
^9.611^3^3
"BLD",733,"REQB",1,0)
XT*7.3*39^2
"BLD",733,"REQB",2,0)
XT*7.3*59^2
"BLD",733,"REQB",3,0)
XT*7.3*66^2
"BLD",733,"REQB","B","XT*7.3*39",1)

"BLD",733,"REQB","B","XT*7.3*59",2)

"BLD",733,"REQB","B","XT*7.3*66",3)

"MBREQ")
0
"PKG",6,-1)
1^1
"PKG",6,0)
TOOLKIT^XT^PROGRAMMERS OPTIONS, MULTI. TERM LOOKUP^
"PKG",6,20,0)
^9.402P^^
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.3^2961029^2970513^2
"PKG",6,22,1,"PAH",1,0)
70^3040406^2
"PKG",6,22,1,"PAH",1,1,0)
^^3^3^3040406
"PKG",6,22,1,"PAH",1,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"PKG",6,22,1,"PAH",1,1,2,0)
Patch XT*7.3*70.
"PKG",6,22,1,"PAH",1,1,3,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","XTEDTVXD")
0^4^B10047824
"RTN","XTEDTVXD",1,0)
XTEDTVXD ;SF/RWF - Call VMS EDT editor for a WP field. ;03/23/2004  10:38
"RTN","XTEDTVXD",2,0)
 ;;7.3;TOOLKIT;**11,70**;Apr 25, 1995
"RTN","XTEDTVXD",3,0)
A ;
"RTN","XTEDTVXD",4,0)
DSM ;Entry point for DSM on VMS
"RTN","XTEDTVXD",5,0)
 S:$D(IO)[0 IO=$I Q:^%ZOSF("OS")'["VAX"
"RTN","XTEDTVXD",6,0)
 N FN,I,C,F,X
"RTN","XTEDTVXD",7,0)
 D DPUT X "S X=$ZC(%EDT,FN)" D DGET
"RTN","XTEDTVXD",8,0)
 Q
"RTN","XTEDTVXD",9,0)
DPUT ;DSM, Put current data in VMS file
"RTN","XTEDTVXD",10,0)
 S FN="DIWE$"_$J_".TMP" X "C FN O FN:(NEWVERSION:PROT=(W=RWD))"
"RTN","XTEDTVXD",11,0)
 U FN X "F I=0:0 S I=$O("_DIC_"I)) Q:I'>0  W ^(I,0),!"
"RTN","XTEDTVXD",12,0)
 C FN
"RTN","XTEDTVXD",13,0)
 Q
"RTN","XTEDTVXD",14,0)
DGET ;DSM, Get data from VMS file, Expand tab, Strip control.
"RTN","XTEDTVXD",15,0)
 N $ES,$ET,%A S $ET="G DERR^XTEDTVXD"
"RTN","XTEDTVXD",16,0)
 X "O FN:(READONLY:DELETE)" K @($E(DIC,1,$L(DIC)-1)_")")
"RTN","XTEDTVXD",17,0)
 S C=$$CTRL
"RTN","XTEDTVXD",18,0)
 U FN F I=1:1 R X#255:60 D SAVE(I,X) Q:$ZA=-1
"RTN","XTEDTVXD",19,0)
DERR U IO S DWLC=I-1,$EC="" X "C FN O FN C FN:DELETE" ;Clean-up both copies
"RTN","XTEDTVXD",20,0)
 Q
"RTN","XTEDTVXD",21,0)
 ;
"RTN","XTEDTVXD",22,0)
CTRL() ;Return control char to remove
"RTN","XTEDTVXD",23,0)
 ;9 is missing, handle TAB special.
"RTN","XTEDTVXD",24,0)
 Q $C(1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31)
"RTN","XTEDTVXD",25,0)
 ;
"RTN","XTEDTVXD",26,0)
SAVE(I,V) ;Save one line
"RTN","XTEDTVXD",27,0)
 S:V[$C(9) V=$$TAB(V) S @(DIC_"I,0)")=$TR(V,C)
"RTN","XTEDTVXD",28,0)
 Q
"RTN","XTEDTVXD",29,0)
 ;
"RTN","XTEDTVXD",30,0)
TAB(S) ;Expand tabs
"RTN","XTEDTVXD",31,0)
 N F
"RTN","XTEDTVXD",32,0)
 S F=0 F  S F=$F(S,$C(9),F) Q:(F'>0)!($L(S)+8>255)  S S=$E(S,1,F-2)_$J("",8-(F-1#8))_$E(S,F,999)
"RTN","XTEDTVXD",33,0)
 Q S
"RTN","XTEDTVXD",34,0)
 ;
"RTN","XTEDTVXD",35,0)
TPU ;DSM, Call VMS TPU editor.
"RTN","XTEDTVXD",36,0)
 S:$D(IO)[0 IO=$I Q:^%ZOSF("OS")'["VAX"
"RTN","XTEDTVXD",37,0)
 N FN,I,C,F,X
"RTN","XTEDTVXD",38,0)
 D DPUT S X="TPU "_FN X "S X=$ZC(%TPU,X)" D DGET
"RTN","XTEDTVXD",39,0)
 Q
"RTN","XTEDTVXD",40,0)
 ;
"RTN","XTEDTVXD",41,0)
GTMVMS ;Entry point for GT.M on VMS
"RTN","XTEDTVXD",42,0)
 N FN,I,C,F,X
"RTN","XTEDTVXD",43,0)
 S:$D(IO)[0 IO=$I S X=^%ZOSF("OS") Q:X'["GT.M"
"RTN","XTEDTVXD",44,0)
 S FN="DIWE$"_$J_".TMP"
"RTN","XTEDTVXD",45,0)
 D GPUT S X="ZSYSTEM ""EDIT "_FN_"""" X X D GGET
"RTN","XTEDTVXD",46,0)
 I $L($ZSEARCH(FN)) ZSYSTEM "DEL "_FN_";*"
"RTN","XTEDTVXD",47,0)
 Q
"RTN","XTEDTVXD",48,0)
 ;
"RTN","XTEDTVXD",49,0)
GPUT ;GTM, Put current data in VMS file
"RTN","XTEDTVXD",50,0)
 X "C FN O FN:(NEWVERSION:NOREADONLY:VARIABLE)"
"RTN","XTEDTVXD",51,0)
 U FN X "F I=0:0 S I=$O("_DIC_"I)) Q:I'>0  W ^(I,0),!"
"RTN","XTEDTVXD",52,0)
 C FN
"RTN","XTEDTVXD",53,0)
 Q
"RTN","XTEDTVXD",54,0)
GGET ;GTM, Get data from VMS file, Expand tab, Strip control.
"RTN","XTEDTVXD",55,0)
 N $ES,$ET,%A S $ET="G GERR^XTEDTVXD"
"RTN","XTEDTVXD",56,0)
 S C=$$CTRL
"RTN","XTEDTVXD",57,0)
 X "O FN:(READONLY)" K @($E(DIC,1,$L(DIC)-1)_")")
"RTN","XTEDTVXD",58,0)
 U FN F I=1:1 R X#255:60 D SAVE(I,X) Q:$ZEOF
"RTN","XTEDTVXD",59,0)
GERR U IO S DWLC=I-1,$EC="" X "C FN O FN C FN:DELETE" ;Clean-up both copies
"RTN","XTEDTVXD",60,0)
 Q
"RTN","XTEDTVXD",61,0)
 ;
"RTN","XTEDTVXD",62,0)
GTMUNIX ;Entry point for GT.M on Unix
"RTN","XTEDTVXD",63,0)
 N FN,I,C,F,X
"RTN","XTEDTVXD",64,0)
 S:$D(IO)[0 IO=$I S X=^%ZOSF("OS") Q:X'["GT.M"
"RTN","XTEDTVXD",65,0)
 S FN="DIWE$"_$J_".TMP"
"RTN","XTEDTVXD",66,0)
 D GPUT X "ZSYSTEM ""vi """_FN D GGET
"RTN","XTEDTVXD",67,0)
 I $L($ZSEARCH(FN)) X "ZSYSTEM ""rm """_FN
"RTN","XTEDTVXD",68,0)
 Q
"RTN","XTEDTVXD",69,0)
 ;
"RTN","XTEDTVXD",70,0)
CACHE ;Entry point for Cache/VMS
"RTN","XTEDTVXD",71,0)
 N FN,OD,I,C,F,X
"RTN","XTEDTVXD",72,0)
 Q:^%ZOSF("OS")'["OpenM"
"RTN","XTEDTVXD",73,0)
 S:$D(IO)[0 IO=$I
"RTN","XTEDTVXD",74,0)
 S X=$$DEFDIR^%ZISH(""),OD=$ZU(168,X) ;Set working directory to default
"RTN","XTEDTVXD",75,0)
 D CPUT X "S X=$ZF(-1,""EDIT ""_FN)" D CGET
"RTN","XTEDTVXD",76,0)
 I $L($ZSEARCH(FN)) X "S X=$ZF(-1,""DEL ""_FN_"";*"")"
"RTN","XTEDTVXD",77,0)
 S X=$ZU(168,OD) ;Change back
"RTN","XTEDTVXD",78,0)
 Q
"RTN","XTEDTVXD",79,0)
 ;
"RTN","XTEDTVXD",80,0)
CPUT ;Cache, Put current data in VMS file
"RTN","XTEDTVXD",81,0)
 S FN="DIWE$"_$J_".TMP" X "O FN:(""NWS"")"
"RTN","XTEDTVXD",82,0)
 U FN X "F I=0:0 S I=$O("_DIC_"I)) Q:I'>0  W ^(I,0),!"
"RTN","XTEDTVXD",83,0)
 C FN
"RTN","XTEDTVXD",84,0)
 Q
"RTN","XTEDTVXD",85,0)
 ;
"RTN","XTEDTVXD",86,0)
CGET ;Cache, Get data from VMS file, Expand tab, Strip control.
"RTN","XTEDTVXD",87,0)
 N $ES,$ET,%A,% S $ET="G CERR^XTEDTVXD"
"RTN","XTEDTVXD",88,0)
 S C=$$CTRL
"RTN","XTEDTVXD",89,0)
 X "O FN:(""RV"")" S %A=$ZUTIL(68,40),%=$ZUTIL(68,40,1) ;Use $ZEOF
"RTN","XTEDTVXD",90,0)
 K @($E(DIC,1,$L(DIC)-1)_")")
"RTN","XTEDTVXD",91,0)
 U FN F I=1:1 Q:$ZEOF<0  R X#255:60 D SAVE(I,X)
"RTN","XTEDTVXD",92,0)
CERR U IO S DWLC=I-1,$EC="",%=$ZUTIL(68,40,%A)
"RTN","XTEDTVXD",93,0)
 X "C FN:""D"" O FN::1 I $T C FN:""D""" ;Clean-up both copies
"RTN","XTEDTVXD",94,0)
 Q
"RTN","XTRMON")
0^7^B9421113
"RTN","XTRMON",1,0)
XTRMON ;ISCSF/RWF - Watch for changes in routine checksums. ;02 Jul 2003 2:59 pm
"RTN","XTRMON",2,0)
 ;;7.3;TOOLKIT;**27,59,70**;Apr 25, 1995
"RTN","XTRMON",3,0)
A N CNT,NOW,MODE,RTN,RN,RSUM,TEST,XMB,DA,DIC,X0,OS
"RTN","XTRMON",4,0)
 K ^TMP($J)
"RTN","XTRMON",5,0)
 S CNT=0,NOW=$$HTFM^XLFDT($H),U="^"
"RTN","XTRMON",6,0)
 S RSUM=^%ZOSF("RSUM"),TEST=^%ZOSF("TEST")
"RTN","XTRMON",7,0)
 S OS=^%ZOSF("OS")
"RTN","XTRMON",8,0)
 S MODE=$G(^XTV(8989.3,1,"RM")) I "n"[$E(MODE) Q
"RTN","XTRMON",9,0)
 G ALL:"a"=$E(MODE)
"RTN","XTRMON",10,0)
SEL S RTN=""
"RTN","XTRMON",11,0)
 F  S RTN=$O(^XTV(8989.3,1,"RM1","B",RTN)) Q:RTN=""  D
"RTN","XTRMON",12,0)
 . I RTN["*" D RANGE($P(RTN,"*")) Q
"RTN","XTRMON",13,0)
 . D CHK(RTN)
"RTN","XTRMON",14,0)
 . Q
"RTN","XTRMON",15,0)
EXIT ;
"RTN","XTRMON",16,0)
 D LOST
"RTN","XTRMON",17,0)
 S XMB="XTRMON",XMTEXT="^TMP($J,",XMB(1)=$$FMTE^XLFDT(NOW,1),XMB(2)=CNT
"RTN","XTRMON",18,0)
 X ^%ZOSF("UCI") S XMB(3)=Y
"RTN","XTRMON",19,0)
 D:CNT>0 ^XMB
"RTN","XTRMON",20,0)
 K XMB,CNT,RN,RTN
"RTN","XTRMON",21,0)
 Q
"RTN","XTRMON",22,0)
 ;
"RTN","XTRMON",23,0)
RANGE(RTN) ;Check a N-space
"RTN","XTRMON",24,0)
 S RN=RTN D CHK(RTN) ;Check for rtn with namespace name
"RTN","XTRMON",25,0)
 I OS["GT.M" G GRNG
"RTN","XTRMON",26,0)
 F  S RN=$O(^$ROUTINE(RN)) Q:$E(RN,1,$L(RTN))'=RTN  D CHK(RN)
"RTN","XTRMON",27,0)
 Q
"RTN","XTRMON",28,0)
 ;
"RTN","XTRMON",29,0)
GRNG ;Check a N-space in GT.M
"RTN","XTRMON",30,0)
 N X,RA,RY,RX S RSUM="S Y=$$RSUM^%ZOSV2(X)"
"RTN","XTRMON",31,0)
 I '$D(ZTQUEUED) W !,"Namespace: "_RTN
"RTN","XTRMON",32,0)
 S X=$ZSEARCH("*.X"),RA=$$RTNDIR^%ZOSV_RTN,RY=RA_"*.m"
"RTN","XTRMON",33,0)
 F  S RX=$ZSEARCH(RY) Q:(RX="")!(RX'[RA)  D
"RTN","XTRMON",34,0)
 . S RX=$TR(RX,"]","/"),RN=$P($P(RX,"/",$L(RX,"/")),".",1)
"RTN","XTRMON",35,0)
 . D CHK(RN)
"RTN","XTRMON",36,0)
 Q
"RTN","XTRMON",37,0)
 ;
"RTN","XTRMON",38,0)
ALL ;Check all routines
"RTN","XTRMON",39,0)
 I OS["GT.M" G GALL
"RTN","XTRMON",40,0)
 S RN="" F  S RN=$O(^$ROUTINE(RN)) Q:RN=""  D CHK(RN)
"RTN","XTRMON",41,0)
 G EXIT
"RTN","XTRMON",42,0)
 ;
"RTN","XTRMON",43,0)
GALL ;GT.M all routines
"RTN","XTRMON",44,0)
 N X,RY,RX S RSUM="S Y=$$RSUM^%ZOSV2(X)"
"RTN","XTRMON",45,0)
 S X=$ZSEARCH("*.X"),RY=$$RTNDIR^%ZOSV_"A.m"
"RTN","XTRMON",46,0)
 F  S RX=$ZSEARCH(RY) Q:(RX="")!(RX'["*")  D
"RTN","XTRMON",47,0)
 . S RX=$TR(RX,"]","/"),RN=$P($P(RX,"/",$L(RX,"/")),".",1) D CHK(RN)
"RTN","XTRMON",48,0)
 G EXIT
"RTN","XTRMON",49,0)
 ;
"RTN","XTRMON",50,0)
CHK(RN) ;Check one routine
"RTN","XTRMON",51,0)
 N $ET,$ES S $ET="D CHKERR^XTRMON Q"
"RTN","XTRMON",52,0)
 S X=RN X TEST Q:'$T
"RTN","XTRMON",53,0)
 S DA=$O(^DIC(9.8,"B",RN,0)) I DA<1 D  Q:DA'>0  ;See if RN is in file
"RTN","XTRMON",54,0)
 . S X=RN,DIC="^DIC(9.8,",DIC(0)="ML" D FILE^DICN ;No, so add
"RTN","XTRMON",55,0)
 . S DA=+Y I DA>0 S DIE=DIC,DR="1///R" D ^DIE ;Set routine flag
"RTN","XTRMON",56,0)
 . Q
"RTN","XTRMON",57,0)
 S X0=^DIC(9.8,DA,0),X=RN X RSUM I '$D(ZTQUEUED) W "." ;Test
"RTN","XTRMON",58,0)
 Q:(Y<0)!(Y=+$P(X0,U,5))
"RTN","XTRMON",59,0)
 D LOG($E(RN_"          ",1,10)_$S($P(X0,U,5)>0:"Has changed, Old: "_$P(X0,U,5)_" New: "_Y,1:"Is new"))
"RTN","XTRMON",60,0)
 I '$D(ZTQUEUED) W !,RN,?10,$S($P(X0,U,5)>0:"Has changed",1:"Is new")
"RTN","XTRMON",61,0)
 S $P(^DIC(9.8,DA,0),U,5,6)=Y_U_NOW
"RTN","XTRMON",62,0)
 Q
"RTN","XTRMON",63,0)
 ;
"RTN","XTRMON",64,0)
CHKERR ;Handle an error during check
"RTN","XTRMON",65,0)
 S $ET="D ^%ZTER G UNWIND^%ZTER"
"RTN","XTRMON",66,0)
 D LOG(RN_" Caused an error: "_$$EC^%ZOSV)
"RTN","XTRMON",67,0)
 S Y=-1,$EC="" ;Set Y=-1 to stop test
"RTN","XTRMON",68,0)
 Q
"RTN","XTRMON",69,0)
 ;
"RTN","XTRMON",70,0)
LOG(MSG) ;Record message
"RTN","XTRMON",71,0)
 S CNT=CNT+1,^TMP($J,CNT,0)=MSG
"RTN","XTRMON",72,0)
 Q
"RTN","XTRMON",73,0)
 ;
"RTN","XTRMON",74,0)
LOST ;Look for routines no-longer in the system
"RTN","XTRMON",75,0)
 I '$D(ZTQUEUED) W !,"Starting LOST routine check."
"RTN","XTRMON",76,0)
 S RTN=""
"RTN","XTRMON",77,0)
 F  S RTN=$O(^DIC(9.8,"B",RTN)) Q:RTN=""  D
"RTN","XTRMON",78,0)
 . Q:$E(RTN)="%"
"RTN","XTRMON",79,0)
 . S IX=$O(^DIC(9.8,"B",RTN,0)),X0=$G(^DIC(9.8,+IX,0)) Q:$P(X0,U,2)="PK"
"RTN","XTRMON",80,0)
 . S X=RTN X TEST Q:$T
"RTN","XTRMON",81,0)
 . D LOG($E(X_"          ",1,10)_"Not in UCI")
"RTN","XTRMON",82,0)
 . S DA=IX,DIK="^DIC(9.8," D ^DIK
"RTN","XTRMON",83,0)
 . Q
"RTN","XTRMON",84,0)
 Q
"RTN","XTSUMBLD")
0^3^B25513558
"RTN","XTSUMBLD",1,0)
XTSUMBLD ;SF/RWF - BUILD PACKAGE INTEG ROUTINE ;09 Apr 2003 3:45 pm
"RTN","XTSUMBLD",2,0)
 ;;7.3;TOOLKIT;**11,20,66,70**;Apr 25, 1995
"RTN","XTSUMBLD",3,0)
A ;
"RTN","XTSUMBLD",4,0)
 K ^UTILITY($J),DIR D MSG
"RTN","XTSUMBLD",5,0)
 S DIR(0)="SM^P:Package;B:Build",DIR("A")="Build from" D ^DIR K DIR Q:X[U
"RTN","XTSUMBLD",6,0)
 G PKG:Y="P",BUILD:Y="B" Q
"RTN","XTSUMBLD",7,0)
PKG W !!,"This will build a checksum routine for a package from the package file",!
"RTN","XTSUMBLD",8,0)
 S DIC=9.4,DIC(0)="AEMQZ" D ^DIC G EXIT:Y'>0
"RTN","XTSUMBLD",9,0)
 D NAME($P(Y(0),U,2)) G EXIT:'$D(XTRNAME)
"RTN","XTSUMBLD",10,0)
 X ^%ZOSF("RSEL") G EXIT:$O(^UTILITY($J,""))=""
"RTN","XTSUMBLD",11,0)
 G BLD
"RTN","XTSUMBLD",12,0)
 ;
"RTN","XTSUMBLD",13,0)
BUILD W !!,"This will build a checksum routine from the BUILD file."
"RTN","XTSUMBLD",14,0)
 S DIC="^XPD(9.6,",DIC(0)="AEMQZ" D ^DIC G EXIT:Y'>0 S BLDA=+Y
"RTN","XTSUMBLD",15,0)
 I $P(Y(0),U,2)'>0 W !!,"There isn't a package file pointer." G EXIT
"RTN","XTSUMBLD",16,0)
 S X=$P(^DIC(9.4,+$P(Y(0),U,2),0),U,2) D NAME(X) G EXIT:'$D(XTRNAME)
"RTN","XTSUMBLD",17,0)
 F IX=0:0 S IX=$O(^XPD(9.6,BLDA,"KRN",9.8,"NM",IX)) Q:IX'>0  S X=^(IX,0) S:'$P(X,U,3) ^UTILITY($J,$P(X,U))=""
"RTN","XTSUMBLD",18,0)
 F IX="INI","INIT","PRE" S X=$G(^XPD(9.6,BLDA,IX)) I X]"" S ^UTILITY($J,$S(X[U:$P(X,U,2),1:X))=""
"RTN","XTSUMBLD",19,0)
 G EXIT:$O(^UTILITY($J,""))=""
"RTN","XTSUMBLD",20,0)
 G BLD
"RTN","XTSUMBLD",21,0)
 ;
"RTN","XTSUMBLD",22,0)
NAME(Y) S XTRNAME=Y_"NTEG" W !,"I will create a routine ",XTRNAME
"RTN","XTSUMBLD",23,0)
 S X=XTRNAME X ^%ZOSF("TEST") I $T S DIR(0)="YA",DIR("A")="But you already have one on file!  OK to replace? ",DIR("B")="NO" D ^DIR I Y'=1 K XTRNAME
"RTN","XTSUMBLD",24,0)
 Q
"RTN","XTSUMBLD",25,0)
 ;
"RTN","XTSUMBLD",26,0)
BLD S X=XTRNAME F I=0:0 K ^UTILITY($J,X) S X=$O(^UTILITY($J,X)) Q:X'[XTRNAME
"RTN","XTSUMBLD",27,0)
 I $O(^UTILITY($J,""))="" W !,"Routine list is empty" G EXIT
"RTN","XTSUMBLD",28,0)
 W !,"Calculating check-sums" S XTDT=$$NOW^XLFDT()
"RTN","XTSUMBLD",29,0)
 S X=" " F I=0:0 S X=$O(^UTILITY($J,X)) Q:X=""  D
"RTN","XTSUMBLD",30,0)
 . W !,X X ^%ZOSF("TEST") I '$T W ?10,"Routine not in this UCI." Q
"RTN","XTSUMBLD",31,0)
 . X ^%ZOSF("RSUM") S ^UTILITY($J,X)=Y Q
"RTN","XTSUMBLD",32,0)
 W !,"Building routine" S RN=" ",XTRNCNT=0
"RTN","XTSUMBLD",33,0)
B K ^UTILITY($J,0) S XTSIZE=0,XCN=0,DIE="^UTILITY($J,0,",XTRNEXT=$E(XTRNAME,1,7)_XTRNCNT,XTRNCNT=XTRNCNT+1
"RTN","XTSUMBLD",34,0)
 F I=1:1 S XT=$P($T(ROU+I),";;",2,99) D ADD Q:$E(XT,1,3)="ROU"
"RTN","XTSUMBLD",35,0)
 S @(DIE_"1,0)")=XTRNAME_$P($T(ROU+1),";;",2)_XTDT,@(DIE_"3,0)")=" ;;"_$P($T(+2),";",3)_";"_XTDT
"RTN","XTSUMBLD",36,0)
 F I=0:0 S RN=$O(^UTILITY($J,RN)) Q:RN=""  S %=^(RN),XT=RN_" ;;"_% D ADD Q:XTSIZE>3700
"RTN","XTSUMBLD",37,0)
 I RN]"" S @(DIE_"6,0)")=" G CONT^"_XTRNEXT
"RTN","XTSUMBLD",38,0)
 S XCN=0,X=XTRNAME W !!,"Filing routine ",XTRNAME X ^%ZOSF("SAVE") S XTRNAME=XTRNEXT G:RN]"" B
"RTN","XTSUMBLD",39,0)
 W !,"  DONE",!
"RTN","XTSUMBLD",40,0)
EXIT K ^UTILITY($J),DIC,DIR,XCN,XTRNAME,XTRNCNT,XU1,XTSIZE,XTDT,DIE,XTRNEXT,XT,X,Y
"RTN","XTSUMBLD",41,0)
 Q
"RTN","XTSUMBLD",42,0)
ADD S XCN=XCN+1,XTSIZE=XTSIZE+$L(XT)+2,@(DIE_XCN_",0)")=XT Q
"RTN","XTSUMBLD",43,0)
 Q
"RTN","XTSUMBLD",44,0)
CHECK ;Print the values of a set of routines.
"RTN","XTSUMBLD",45,0)
 N XPCH,X,DIR D MSG
"RTN","XTSUMBLD",46,0)
 S DIR(0)="SM^P:Package;B:Build",DIR("A")="Build from" D ^DIR K DIR Q:X[U
"RTN","XTSUMBLD",47,0)
 G CHKPKG:Y="P",CHKBLD:Y="B" Q
"RTN","XTSUMBLD",48,0)
CHKPKG W !! K ^UTILITY($J) X ^%ZOSF("RSEL") I $O(^UTILITY($J,0))']"" W !!,"NO SELECTED ROUTINES" G EXIT
"RTN","XTSUMBLD",49,0)
CHK2 S X=" " F XU1=0:0 S X=$O(^UTILITY($J,X)) Q:X']""  D
"RTN","XTSUMBLD",50,0)
 . W !,X,?10 X ^%ZOSF("TEST") I '$T W "Routine not in this UCI." Q
"RTN","XTSUMBLD",51,0)
 . X ^%ZOSF("RSUM") W "value = ",Y
"RTN","XTSUMBLD",52,0)
 . I $D(XPCH) X XPCH
"RTN","XTSUMBLD",53,0)
 . Q
"RTN","XTSUMBLD",54,0)
 W !,"done" G EXIT
"RTN","XTSUMBLD",55,0)
CHKBLD W !!,"This will check the routines from a BUILD file."
"RTN","XTSUMBLD",56,0)
 S DIC="^XPD(9.6,",DIC(0)="AEMQZ" D ^DIC G EXIT:Y'>0
"RTN","XTSUMBLD",57,0)
 S BLDA=+Y,X=$P(Y,"^",2)
"RTN","XTSUMBLD",58,0)
 I X["*" S XPCH="S L=$T(+2^@X) I $P(L,"";"",5)'?.E1P1"""_$P(X,"*",3)_"""1P.E W ?30,""Missing patch number"""
"RTN","XTSUMBLD",59,0)
 F IX=0:0 S IX=$O(^XPD(9.6,BLDA,"KRN",9.8,"NM",IX)) Q:IX'>0  S X=^(IX,0) S:'$P(X,U,3) ^UTILITY($J,$P(X,U))=""
"RTN","XTSUMBLD",60,0)
 F IX="INI","INIT","PRE" S X=$G(^XPD(9.6,BLDA,IX)) I X]"" S ^UTILITY($J,$S(X[U:$P(X,U,2),1:X))=""
"RTN","XTSUMBLD",61,0)
 G EXIT:$O(^UTILITY($J,""))=""
"RTN","XTSUMBLD",62,0)
 G CHK2
"RTN","XTSUMBLD",63,0)
 ;
"RTN","XTSUMBLD",64,0)
MSG W !!,"This option determines the current checksum of selected routine(s)."
"RTN","XTSUMBLD",65,0)
 W !,"The Checksum of the routine is determined as follows:",!
"RTN","XTSUMBLD",66,0)
 W !,"1. Any comment line with a single semi-colon is presumed to be"
"RTN","XTSUMBLD",67,0)
 W !,"   followed by comments and only the line tag will be included."
"RTN","XTSUMBLD",68,0)
 W !!,"2. Line 2 will be excluded from the count.",!
"RTN","XTSUMBLD",69,0)
 W !,"3. The total value of the routine is determined by taking, excluding the"
"RTN","XTSUMBLD",70,0)
 W !,"   exception, as noted above, and multipling the ASCII value of each"
"RTN","XTSUMBLD",71,0)
 W !,"   character by its position on the line being checked."
"RTN","XTSUMBLD",72,0)
 Q
"RTN","XTSUMBLD",73,0)
ROU ;;
"RTN","XTSUMBLD",74,0)
 ;; ;ISC/XTSUMBLD KERNEL - Package checksum checker ;
"RTN","XTSUMBLD",75,0)
 ;; ;;0.0;
"RTN","XTSUMBLD",76,0)
 ;; ;;7.3;10/1/94
"RTN","XTSUMBLD",77,0)
 ;; S XT4="I 1",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","XTSUMBLD",78,0)
 ;;CONT F XT1=1:1 S XT2=$T(ROU+XT1) Q:XT2=""  S X=$P(XT2," ",1),XT3=$P(XT2,";",3) X XT4 I $T W !,X X ^%ZOSF("TEST") S:'$T XT3=0 X:XT3 ^%ZOSF("RSUM") W ?10,$S('XT3:"Routine not in UCI",XT3'=Y:"Calculated "_$C(7)_Y_", off by "_(Y-XT3),1:"ok")
"RTN","XTSUMBLD",79,0)
 ;; ;
"RTN","XTSUMBLD",80,0)
 ;; K %1,%2,%3,X,Y,XT1,XT2,XT3,XT4 Q
"RTN","XTSUMBLD",81,0)
 ;;ONE S XT4="I $D(^UTILITY($J,X))",X=$T(+3) W !!,"Checksum routine created on ",$P(X,";",4)," by KERNEL V",$P(X,";",3),!
"RTN","XTSUMBLD",82,0)
 ;; W !,"Check a subset of routines:" K ^UTILITY($J) X ^%ZOSF("RSEL")
"RTN","XTSUMBLD",83,0)
 ;; W ! G CONT
"RTN","XTSUMBLD",84,0)
 ;;ROU ;;
"RTN","XTVNUM")
0^6^B12984715
"RTN","XTVNUM",1,0)
XTVNUM ;SF-ISC/RWF - TO UPDATE THE VERSION NUMBER ;09 Apr 2003 8:24 am
"RTN","XTVNUM",2,0)
 ;;7.3;TOOLKIT;**20,39,70**;Apr 25, 1995
"RTN","XTVNUM",3,0)
GO W !!,"THIS ROUTINE WILL UPDATE THE VERSION NUMBER OR PATCH LIST"
"RTN","XTVNUM",4,0)
 W !,"IN THE ROUTINES SELECTED"
"RTN","XTVNUM",5,0)
 ;XTV(2)=New Version or Patch, 3=Version #, 4=Package Name, 5=Clear patch
"RTN","XTVNUM",6,0)
 ;6=Date
"RTN","XTVNUM",7,0)
 N BLDA,XTV,XTVPCH,DIC,DIR,Y,X K ^UTILITY($J)
"RTN","XTVNUM",8,0)
 S XTV(5)=0,XTV(2)=0
"RTN","XTVNUM",9,0)
 S DIR(0)="SM^F:Free Form;B:Build File",DIR("A")="Build from" D ^DIR K DIR Q:X[U
"RTN","XTVNUM",10,0)
 S XTV=Y G PKG:Y="F",BUILD:Y="B" Q
"RTN","XTVNUM",11,0)
 ;
"RTN","XTVNUM",12,0)
PKG W !,"Will only update the Version number.",!
"RTN","XTVNUM",13,0)
 X ^%ZOSF("RSEL") G EXIT:$O(^UTILITY($J,0))="",BLD
"RTN","XTVNUM",14,0)
 ;
"RTN","XTVNUM",15,0)
BUILD W !!,"This will use the BUILD file for the list of routines to update."
"RTN","XTVNUM",16,0)
 W !,"It will update the Patch number of the patch list."
"RTN","XTVNUM",17,0)
 S DIC="^XPD(9.6,",DIC(0)="AEMQZ" D ^DIC G EXIT:Y'>0 S BLDA=+Y
"RTN","XTVNUM",18,0)
 S X=$P(Y,"^",2),XTV(4)=$$PKG^XPDUTL(X),XTV(3)=$$VER^XPDUTL(X)
"RTN","XTVNUM",19,0)
 I X["*" D
"RTN","XTVNUM",20,0)
 . S XTV(3)=$P(X,"*",2),XTVPCH=$P(X,"*",3),XTV(4)=$$GET1^DIQ(9.6,BLDA_",",1),XTV(5)=0,XTV(2)=1
"RTN","XTVNUM",21,0)
 . S XTV(99)="S Y=(T?.E1P1"""_XTVPCH_"""1P.E)"
"RTN","XTVNUM",22,0)
 . Q
"RTN","XTVNUM",23,0)
 D RTN^XTRUTL1(BLDA)
"RTN","XTVNUM",24,0)
 G EXIT:$O(^UTILITY($J,""))=""
"RTN","XTVNUM",25,0)
 G 3
"RTN","XTVNUM",26,0)
 ;
"RTN","XTVNUM",27,0)
BLD K DIR
"RTN","XTVNUM",28,0)
 S DIR(0)="FA^1:8^K:'(X?1.2N1"".""1.2N.1(1""T"",1""V"").2N) X",DIR("A")="WHAT IS THE VERSION NUMBER: ",DIR("?")="Enter a number of the form nn.nn[Tnn or Vnn]"
"RTN","XTVNUM",29,0)
 D ^DIR G EXIT:$D(DIRUT) S XTV(3)=X
"RTN","XTVNUM",30,0)
 ;
"RTN","XTVNUM",31,0)
2 K DIR
"RTN","XTVNUM",32,0)
 S DIR(0)="F^1:30^K:X[U X",DIR("A")="Package Name",DIR("?")="The package name will go into the 4th piece of the second line."
"RTN","XTVNUM",33,0)
 D ^DIR G EXIT:$D(DTOUT)!$D(DUOUT) S:X]"" XTV(4)=X
"RTN","XTVNUM",34,0)
 ;
"RTN","XTVNUM",35,0)
3 I XTV(2) W !,"This date is only used if building a new second line."
"RTN","XTVNUM",36,0)
 K DIR S DIR(0)="D",DIR("A")="Enter the Version Date",DIR("?")="The DATE of this Version"
"RTN","XTVNUM",37,0)
 D ^DIR G EXIT:$D(DIRUT) S XTV(6)=$$FMTE^XLFDT(Y,1) W "  ",XTV(6)
"RTN","XTVNUM",38,0)
 ;
"RTN","XTVNUM",39,0)
 K DIR S DIR(0)="Y",DIR("A")="Clear the 'Patch List'",DIR("B")="YES",DIR("?")="Answer YES to remove the list of patch numbers from the 5th piece of the second line."
"RTN","XTVNUM",40,0)
 I 'XTV(2) D ^DIR G EXIT:$D(DIRUT) S XTV(5)=Y
"RTN","XTVNUM",41,0)
 ;
"RTN","XTVNUM",42,0)
OK W "  OK.",!
"RTN","XTVNUM",43,0)
 K DIR
"RTN","XTVNUM",44,0)
 S DIR("A",1)=" SETTING "_$S(XTV(2):"Patch",1:"Version")_" number to "_$S(XTV(2):XTVPCH,1:XTV(3)),DIR(0)="Y",DIR("A")=" Are you ready",DIR("B")="NO"
"RTN","XTVNUM",45,0)
 D ^DIR G:Y'=1 EXIT
"RTN","XTVNUM",46,0)
 W ! N AQ,CQ,I,SQ,DQ,R,T,T1,TO,TAB
"RTN","XTVNUM",47,0)
 S AQ="**",CQ=",",SQ=";",DQ=" ",R=0,T1=" ;;"_XTV(3)_SQ_XTV(4)_";;"_XTV(6)
"RTN","XTVNUM",48,0)
 ;DoIt
"RTN","XTVNUM",49,0)
 F I=0:0 S R=$O(^UTILITY($J,R)) Q:'$L(R)  D XTV(R) W $J(R,9),?15,T,!
"RTN","XTVNUM",50,0)
 W !,"DONE",!
"RTN","XTVNUM",51,0)
EXIT K ^UTILITY($J),^TMP($J)
"RTN","XTVNUM",52,0)
 Q
"RTN","XTVNUM",53,0)
 ;
"RTN","XTVNUM",54,0)
XTV(RN) ;
"RTN","XTVNUM",55,0)
 N DIF,XCNP,DIE,XCN,IX,P
"RTN","XTVNUM",56,0)
 K ^TMP($J) S DIF="^TMP($J,",XCNP=0,X=RN X ^%ZOSF("LOAD")
"RTN","XTVNUM",57,0)
 S IX=2,(T,TO)=^TMP($J,IX,0)
"RTN","XTVNUM",58,0)
 S:T?.8E1" ;"1N.E $P(T,SQ)=$P(T,SQ)_SQ I T'?.8E1" ;;"1N.E S T=T1,IX=1.5,^TMP($J,IX,0)=T1
"RTN","XTVNUM",59,0)
 I 'XTV(2) S $P(T,SQ,3,4)=XTV(3)_SQ_XTV(4) S:XTV(5) $P(T,SQ,5)="" S $P(T,SQ,6)=XTV(6)
"RTN","XTVNUM",60,0)
 I XTV(2) X XTV(99) I 'Y S P=$P($P(T,SQ,5),AQ,2),P=AQ_$S($L(P):P_CQ_XTVPCH,1:XTVPCH)_AQ,$P(T,SQ,5)=P
"RTN","XTVNUM",61,0)
 I T'=TO S ^TMP($J,IX,0)=T
"RTN","XTVNUM",62,0)
 S DIE=DIF,XCN=0,X=RN X ^%ZOSF("SAVE")
"RTN","XTVNUM",63,0)
 Q
"RTN","XTVNUM",64,0)
 ;old code
"RTN","XTVNUM",65,0)
 ;X XTV(11),XTV(10):'XTV(2),XTV(12):XTV(2),XTV(15) W $J(R,9),?15,T,!"
"RTN","XTVNUM",66,0)
 ;ZR +2 ZI T ZS @R"
"RTN","ZTP1")
0^1^B15149784
"RTN","ZTP1",1,0)
%ZTP1 ;SF/RWF -  PRINTS 1ST LINES IN SIZE OR DATE ORDER ;06/30/2003  15:35
"RTN","ZTP1",2,0)
 ;;7.3;TOOLKIT;**20,70**;Apr 25, 1995
"RTN","ZTP1",3,0)
A W !!,"PRINTS FIRST LINES",!!
"RTN","ZTP1",4,0)
 N %L,%R,%ZN,A,B,C,HED,Z2,JR,S,X,Y,ZTP,ZTP1,ZP,RN,ZTSK
"RTN","ZTP1",5,0)
 K ^UTILITY($J) S DTIME=$G(DTIME,300)
"RTN","ZTP1",6,0)
 X ^%ZOSF("RSEL") G KIL:$O(^UTILITY($J,0))=""
"RTN","ZTP1",7,0)
A1 R !,"(A)lpha, (D)ate ,(P)atched, OR (S)ize ORDER: A//",ZTP1:DTIME
"RTN","ZTP1",8,0)
 S:ZTP1="" ZTP1="A" S ZTP1=$E(ZTP1,1) G KIL:ZTP1="^",A1:"ADPS"'[ZTP1
"RTN","ZTP1",9,0)
 S Z2=$S(ZTP1="P":"YES",1:"NO")
"RTN","ZTP1",10,0)
A2 W !,"Include line 2? ",Z2,"//" R X:DTIME
"RTN","ZTP1",11,0)
 G KIL:X["^"!('$T) S:X="" X=Z2 G A2:"YN"'[$E(X) S Z2=("Yy"[$E(X))
"RTN","ZTP1",12,0)
 S %ZIS="QM" D ^%ZIS G KIL:POP
"RTN","ZTP1",13,0)
 I $D(IO("Q")) D  D ^%ZISC Q
"RTN","ZTP1",14,0)
 . K IO("Q") S ZTRTN="B^%ZTP1",ZTSAVE("ZTP1")="",ZTSAVE("^UTILITY($J,")="",ZTSAVE("Z2")="",ZTDESC="FIRST LINES PRINT"
"RTN","ZTP1",15,0)
 . D ^%ZTLOAD K ZTSK Q
"RTN","ZTP1",16,0)
 ;Set RN for all loops
"RTN","ZTP1",17,0)
B S RN=" " G DATE:ZTP1="D",SIZE:ZTP1="S",PATCH:ZTP1="P"
"RTN","ZTP1",18,0)
 ;
"RTN","ZTP1",19,0)
ALPHA F JP=1:1 S RN=$O(^UTILITY($J,RN)) Q:RN=""  S ^UTILITY($J,1,JP,RN)=0
"RTN","ZTP1",20,0)
 S HED="    FIRST LINE LIST:"
"RTN","ZTP1",21,0)
 G LIST
"RTN","ZTP1",22,0)
 ;
"RTN","ZTP1",23,0)
SIZE ;Sort by routine size
"RTN","ZTP1",24,0)
 F JR=1:1 S RN=$O(^UTILITY($J,RN)) Q:RN=""  D
"RTN","ZTP1",25,0)
 . D LOAD(RN)
"RTN","ZTP1",26,0)
 . S Y=$$SIZE2 W RN," ",Y,?$X\19+1*19
"RTN","ZTP1",27,0)
 . D KEEP(Y,RN) W:$X>66 !
"RTN","ZTP1",28,0)
 S HED="    SIZE RANKING:"
"RTN","ZTP1",29,0)
 G LIST
"RTN","ZTP1",30,0)
 ;
"RTN","ZTP1",31,0)
LOAD(X,R) ;Load routine
"RTN","ZTP1",32,0)
 N DIF,XCNP K ^TMP($J)
"RTN","ZTP1",33,0)
 S DIF="^TMP($J,",XCNP=0 X ^%ZOSF("LOAD")
"RTN","ZTP1",34,0)
 I $D(R) S R(1)=$G(^TMP($J,1,0)),R(2)=$G(^TMP($J,2,0))
"RTN","ZTP1",35,0)
 Q
"RTN","ZTP1",36,0)
 ;
"RTN","ZTP1",37,0)
KEEP(IX1,IX2) ;
"RTN","ZTP1",38,0)
 S ^UTILITY($J,1,IX1,IX2)=2,^UTILITY($J,1,IX1,IX2,1)=^TMP($J,1,0),^UTILITY($J,1,IX1,IX2,2)=^TMP($J,2,0)
"RTN","ZTP1",39,0)
 Q
"RTN","ZTP1",40,0)
 ;
"RTN","ZTP1",41,0)
LIST ;All 3 sorts come here to print the list.
"RTN","ZTP1",42,0)
 N %X,QUIT,L,L1,L2,S,PL,X
"RTN","ZTP1",43,0)
 S PL=IOSL-3-Z2,X=$H X ^%ZOSF("ZD")
"RTN","ZTP1",44,0)
 S HED=Y_"   "_HED X ^%ZOSF("UCI") S HED=Y_"   "_HED
"RTN","ZTP1",45,0)
 U IO D HED
"RTN","ZTP1",46,0)
 S ZP=0,X=0,QUIT=0
"RTN","ZTP1",47,0)
 F S=0:0 S S=$O(^UTILITY($J,1,S)),RN="" Q:(S'>0)!(QUIT)  D
"RTN","ZTP1",48,0)
 . F S2=0:0 S RN=$O(^UTILITY($J,1,S,RN)) Q:'$L(RN)!QUIT  D
"RTN","ZTP1",49,0)
 . . D:$Y>PL WAIT I X["^" S RN="zz",S=" " Q
"RTN","ZTP1",50,0)
 . . S ZP=ZP+1 D L2
"RTN","ZTP1",51,0)
 I 'QUIT W !!?14,ZP," ROUTINES",!
"RTN","ZTP1",52,0)
KIL D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ZTP1",53,0)
 K %,%L,%R,%ZN,A,B,C,HED,Z2,JR,S,S2,X,Y,ZTP,ZTP1,ZP,RN,ZTSK
"RTN","ZTP1",54,0)
 K ^UTILITY($J)
"RTN","ZTP1",55,0)
 Q
"RTN","ZTP1",56,0)
 ;
"RTN","ZTP1",57,0)
L2 ;Write one
"RTN","ZTP1",58,0)
 I ^UTILITY($J,1,S,RN) S L1=^(RN,1),L2=^(2)
"RTN","ZTP1",59,0)
 I '$T S L=0 D LOAD(RN,.L) S L1=L(1),L2=L(2),L1=$P(L1," ",2,999)
"RTN","ZTP1",60,0)
 W RN,?10 W:ZTP1="S" $J(S,4)," - " S %X=$X D WR(L1) I Z2 W ?%X D WR(L2)
"RTN","ZTP1",61,0)
 Q
"RTN","ZTP1",62,0)
 ;
"RTN","ZTP1",63,0)
WR(STR) ;Write line w/ wrap
"RTN","ZTP1",64,0)
 N %1,%2
"RTN","ZTP1",65,0)
 S %1=$X,%2=IOM-1-%1 F  W $E(STR,1,%2) S STR=$E(STR,%2+1,9999) Q:'$L(STR)  W !,?%1
"RTN","ZTP1",66,0)
 W:$X>0 !
"RTN","ZTP1",67,0)
 Q
"RTN","ZTP1",68,0)
 ;
"RTN","ZTP1",69,0)
WAIT I IOST["C-" R !,"Enter Return to continue",X:120 Q:X["^"
"RTN","ZTP1",70,0)
HED W @IOF,!?8,HED,! Q
"RTN","ZTP1",71,0)
 ;
"RTN","ZTP1",72,0)
DATE ;Sort by date
"RTN","ZTP1",73,0)
 F JR=1:1 S RN=$O(^UTILITY($J,RN)) Q:RN=""  D
"RTN","ZTP1",74,0)
 . N L S L=0 D LOAD(RN,.L)
"RTN","ZTP1",75,0)
 . S X=$$DTF(L(1)) D KEEP(9999999-X,RN)
"RTN","ZTP1",76,0)
 . W RN," ",Y,?$X\19+1*19 W:$X>66 !
"RTN","ZTP1",77,0)
 . Q
"RTN","ZTP1",78,0)
 S HED="    REVERSE DATE ORDER:"
"RTN","ZTP1",79,0)
 G LIST
"RTN","ZTP1",80,0)
DTF(L) ;Find the date
"RTN","ZTP1",81,0)
 N %,PC,%DT,B,S
"RTN","ZTP1",82,0)
 F PC=2:1:$L(L,";") S B=1,X=$P(L,";",PC) D  Q:Y>0
"RTN","ZTP1",83,0)
 . S Y=-1,%DT="T"
"RTN","ZTP1",84,0)
 . S:X?.E1"["1.2N1"/"1.2N1"/"2N1" "1.2N1":"1.2N.E1"]  ".E X=$P($P(X,"[",2),"]",1)
"RTN","ZTP1",85,0)
 . F %=1:1:$L(X) D  Q:Y>0
"RTN","ZTP1",86,0)
 . . S S=$E(X,%)?1P S:B&S X=$E(X,1,%-1)_$E(X,%+1,999),%=%-1
"RTN","ZTP1",87,0)
 . . S:'S B=0 S:$E(X,%+1,999)?1N.N1":".E X=$E(X,1,%-1)_"@"_$E(X,%+1,999),%=999
"RTN","ZTP1",88,0)
 . . I %>$L(X) N % D ^%DT
"RTN","ZTP1",89,0)
 . . Q
"RTN","ZTP1",90,0)
 . Q
"RTN","ZTP1",91,0)
 Q Y
"RTN","ZTP1",92,0)
 ;,X=$P(ZTP,"" ;"",3) X A(1) S B=1,X=$P(ZTP,"";"",4) X:Y<0 A(1)
"RTN","ZTP1",93,0)
 ;
"RTN","ZTP1",94,0)
PATCH ;Sort by first patch number
"RTN","ZTP1",95,0)
 N S2
"RTN","ZTP1",96,0)
 F S2=0:0 S RN=$O(^UTILITY($J,RN)) Q:RN=""  D
"RTN","ZTP1",97,0)
 . N L S L=0 D LOAD(RN,.L)
"RTN","ZTP1",98,0)
 . S X=$P(L(2),";",5) I X]"" S S=+$P(X,"**",2) D KEEP(S,RN)
"RTN","ZTP1",99,0)
 S HED="    Patched routines"
"RTN","ZTP1",100,0)
 G LIST
"RTN","ZTP1",101,0)
 ;
"RTN","ZTP1",102,0)
SIZE2() ; Return size in bytes of routine in ^TMP($J)
"RTN","ZTP1",103,0)
 N NUM,LINE,SIZE ; line number, line text, size
"RTN","ZTP1",104,0)
 S SIZE=0
"RTN","ZTP1",105,0)
 F NUM=1:1 S LINE=$G(^TMP($J,NUM,0)) Q:LINE=""  S SIZE=SIZE+$L(LINE)+2
"RTN","ZTP1",106,0)
 Q SIZE
"RTN","ZTP1",107,0)
 ;
"RTN","ZTP1",108,0)
BUILD ;
"RTN","ZTP1",109,0)
 N Y,BLDA,%N,S2
"RTN","ZTP1",110,0)
 I '$D(^XPD(9.6,0)) W !,"No BUILD file to work from." Q
"RTN","ZTP1",111,0)
 S Y=$$BUILD^XTRUTL1 G KIL:Y'>0 S BLDA=+Y
"RTN","ZTP1",112,0)
 D RTN^XTRUTL1(BLDA)
"RTN","ZTP1",113,0)
 I '$D(^UTILITY($J)) W !,"No routines in this build." G KIL
"RTN","ZTP1",114,0)
 G A1
"RTN","ZTPP")
0^2^B11701778
"RTN","ZTPP",1,0)
%ZTPP ;SF/RWF - ROUTINE PRETTY PRINT OUTPUT ;12/06/96  15:53
"RTN","ZTPP",2,0)
 ;;7.3;TOOLKIT;**4,11,20,70**;Apr 25, 1995
"RTN","ZTPP",3,0)
 ;This program can produce routine listings in a paper-saving format
"RTN","ZTPP",4,0)
A W !,"Routine Print:"
"RTN","ZTPP",5,0)
 N FF,LN,ZTSK I $G(DTIME)'>0 N DTIME S DTIME=360
"RTN","ZTPP",6,0)
A2 R !,"Want to start each routine on a new page: Yes// ",FF:DTIME,! G EXIT:FF["^" I FF["?" W !,"Enter Yes to start each routine on a new page.",!?5,"No for the old way." G A2
"RTN","ZTPP",7,0)
A3 R !,"Want line numbers: No//",LN:DTIME,!
"RTN","ZTPP",8,0)
 G EXIT:LN["^" I LN["?" W !,"Enter Yes to have line numbers, O for offset numbers, No for no line numbers." G A3
"RTN","ZTPP",9,0)
 S FF=$TR($E(FF_"Y"),"YyNn","1100"),LN=$TR($E(LN_"N"),"YyNnOo","110022")
"RTN","ZTPP",10,0)
 K ^UTILITY($J) X ^%ZOSF("RSEL") I $O(^UTILITY($J," "))="" W !!,"NO routines selected." G EXIT
"RTN","ZTPP",11,0)
 K %ZIS,IOP,IOC,ZTIO S %ZIS="MQ" D ^%ZIS G:POP EXIT
"RTN","ZTPP",12,0)
 I $D(IO("Q")) S ZTRTN="DQ^%ZTPP",ZTDTH="",ZTDESC="ROUTINE LIST" F I="FF","LN","^UTILITY($J," S ZTSAVE(I)=""
"RTN","ZTPP",13,0)
 I $D(IO("Q")) K IO("Q") D ^%ZTLOAD W !,"REQUEST QUEUED" G EXIT
"RTN","ZTPP",14,0)
DQ ;FF start each routine on a new page, LN line numbers
"RTN","ZTPP",15,0)
 N RN,ST,HDR,LC,PG
"RTN","ZTPP",16,0)
 S U="^" D NOW^%DTC S Y=% D DD S HDR(2)=Y
"RTN","ZTPP",17,0)
 X ^%ZOSF("UCI") S HDR(1)="UCI: "_Y_"    Site: "_$G(^DD("SITE"),"VAMC")
"RTN","ZTPP",18,0)
 S IOC=(IO=IO(0)),IOC2=$E(IOST,1,2)["C-"
"RTN","ZTPP",19,0)
 U IO W:IOC2 @IOF I 'IOC U IO(0) W !!
"RTN","ZTPP",20,0)
 S RN=" ",%Y=IOSL-(255\IOM+1) K %D,%T,%TIM
"RTN","ZTPP",21,0)
 F  S RN=$O(^UTILITY($J,RN)) Q:RN=""  D  I 'ST D %Z5:IOC2&IOC
"RTN","ZTPP",22,0)
 . S X=RN,XCNP=0,DIF="RTN(" K RTN X ^%ZOSF("LOAD") S LC=XCNP-1
"RTN","ZTPP",23,0)
 . IF 'IOC U IO(0) W $J(RN,10) W:$X>70 !
"RTN","ZTPP",24,0)
 . U IO S BYTECNT=0,PG=0,OF=0 F I=1:1:LC S BYTECNT=BYTECNT+$L(RTN(I,0))+2
"RTN","ZTPP",25,0)
 . D RSUM,%Z3
"RTN","ZTPP",26,0)
 . F LI=1:1:LC S X=RTN(LI,0) D:%Y'>$Y %Z3 S Y=$P(X," ",1),X=$P(X," ",2,999) D  ;
"RTN","ZTPP",27,0)
 . . I 'LN F J=1:1 W !,Y,?J>1+6," " W:$X>8 "--",!,?8 W $E(X,1,IOM-(J>1+8)) S X=$E(X,IOM-(J>1+7),999),Y="" Q:X=""
"RTN","ZTPP",28,0)
 . . I LN S OF=$S(LN=1:LI,$L(Y):0,1:OF+1),J1=$S(LN=1:$J(LI,3),$L(Y):"",1:"+"_OF)
"RTN","ZTPP",29,0)
 . . I LN F J=1:1 W !,J1,?4,Y,?J>1+10," " W:$X>12 "--",!,?12 W $E(X,1,IOM-(J>1+12)) S X=$E(X,IOM-(J>1+11),999),Y="",J1="" Q:X=""
"RTN","ZTPP",30,0)
 . . Q
"RTN","ZTPP",31,0)
 . W:$Y<IOSL !
"RTN","ZTPP",32,0)
 . Q
"RTN","ZTPP",33,0)
 U IO W !
"RTN","ZTPP",34,0)
EXIT K %,%Y,RN,RTN,ST,I,IOC,J,J1,%Z33,HDR,LC,PG,S,X,Y
"RTN","ZTPP",35,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ZTPP",36,0)
 Q
"RTN","ZTPP",37,0)
 ;
"RTN","ZTPP",38,0)
DD S:Y Y=$S($E(Y,4,5):$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",+$E(Y,4,5))_" ",1:"")_$S($E(Y,6,7):+$E(Y,6,7)_",",1:"")_($E(Y,1,3)+1700)_$P("@"_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),"^",Y[".")
"RTN","ZTPP",39,0)
 Q
"RTN","ZTPP",40,0)
EXEC ;
"RTN","ZTPP",41,0)
RSUM N Y,Y2,%,%1,%2,%3 S (Y,Y2)=0
"RTN","ZTPP",42,0)
 F %=1,3:1:LC S %1=RTN(%,0),%3=$F(%1," "),%3=$S($E(%1,%3)'=";":$L(%1),$E(%1,%3+1)=";":$L(%1),1:%3-2) F %2=1:1:%3 S Y=$A(%1,%2)*%2+Y,Y2=$A(%1,%2)*(%2+%)+Y2
"RTN","ZTPP",43,0)
 S RSUM=Y,RSUM2=Y2
"RTN","ZTPP",44,0)
 Q
"RTN","ZTPP",45,0)
%Z3 S PG=PG+1,ST=0 D:(PG>1)&IOC2&IOC %Z5 Q:ST
"RTN","ZTPP",46,0)
 W:((LC+9+$Y'<IOSL)!FF)&($Y>3)!(PG>1) @IOF
"RTN","ZTPP",47,0)
 W RN," * *  ",$S(PG>1:"(cont.)",1:LC_" LINES,  "_BYTECNT_" BYTES,  RSUM: "_RSUM_"/"_RSUM2_" "),?60,"Page ",PG,!,?8,HDR(1),?49,HDR(2),!
"RTN","ZTPP",48,0)
 Q
"RTN","ZTPP",49,0)
%Z5 R !,"Press RETURN to continue or '^' to exit: ",ST:600 S ST=$S(ST["^":1,1:0) S:ST LI=9999,LC=0,RN="zzzz",X=""
"RTN","ZTPP",50,0)
 Q
"VER")
8.0^22.0
**END**
**END**
