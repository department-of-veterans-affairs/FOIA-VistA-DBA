Released IBD*3*16 SEQ #16
Extracted from mail message
**KIDS**:IBD*3.0*16^

**INSTALL NAME**
IBD*3.0*16
"BLD",665,0)
IBD*3.0*16^AUTOMATED INFO COLLECTION SYS^0^2971029^y
"BLD",665,1,0)
^^8^8^2980212^^^^
"BLD",665,1,1,0)
 
"BLD",665,1,2,0)
This patch fixes some misc. Forms Tracking items...
"BLD",665,1,3,0)
When a new clinic is created and has appts., encounter
"BLD",665,1,4,0)
forms print but they are not included on Forms Tracking
"BLD",665,1,5,0)
list for a single division facility without the division
"BLD",665,1,6,0)
field filled in.
"BLD",665,1,7,0)
Fixes Forms Tracking action SS Status Select for 
"BLD",665,1,8,0)
Pending Pages and Error Detected, Not Transmitted.
"BLD",665,4,0)
^9.64PA^^
"BLD",665,"ABPKG")
n
"BLD",665,"KRN",0)
^9.67PA^19^18
"BLD",665,"KRN",.4,0)
.4
"BLD",665,"KRN",.4,"NM",0)
^9.68A^^
"BLD",665,"KRN",.401,0)
.401
"BLD",665,"KRN",.401,"NM",0)
^9.68A^^
"BLD",665,"KRN",.402,0)
.402
"BLD",665,"KRN",.402,"NM",0)
^9.68A^^
"BLD",665,"KRN",.403,0)
.403
"BLD",665,"KRN",.5,0)
.5
"BLD",665,"KRN",.84,0)
.84
"BLD",665,"KRN",3.6,0)
3.6
"BLD",665,"KRN",3.8,0)
3.8
"BLD",665,"KRN",9.2,0)
9.2
"BLD",665,"KRN",9.8,0)
9.8
"BLD",665,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",665,"KRN",9.8,"NM",2,0)
IBDFSS^^0^B38407266
"BLD",665,"KRN",9.8,"NM",3,0)
IBDFFT^^0^B45918204
"BLD",665,"KRN",9.8,"NM",4,0)
IBDFFT1^^0^B80629506
"BLD",665,"KRN",9.8,"NM",5,0)
IBDFFT3^^0^B29992560
"BLD",665,"KRN",9.8,"NM","B","IBDFFT",3)

"BLD",665,"KRN",9.8,"NM","B","IBDFFT1",4)

"BLD",665,"KRN",9.8,"NM","B","IBDFFT3",5)

"BLD",665,"KRN",9.8,"NM","B","IBDFSS",2)

"BLD",665,"KRN",19,0)
19
"BLD",665,"KRN",19,"NM",0)
^9.68A^^
"BLD",665,"KRN",19.1,0)
19.1
"BLD",665,"KRN",101,0)
101
"BLD",665,"KRN",409.61,0)
409.61
"BLD",665,"KRN",771,0)
771
"BLD",665,"KRN",869.2,0)
869.2
"BLD",665,"KRN",870,0)
870
"BLD",665,"KRN",8994,0)
8994
"BLD",665,"KRN","B",.4,.4)

"BLD",665,"KRN","B",.401,.401)

"BLD",665,"KRN","B",.402,.402)

"BLD",665,"KRN","B",.403,.403)

"BLD",665,"KRN","B",.5,.5)

"BLD",665,"KRN","B",.84,.84)

"BLD",665,"KRN","B",3.6,3.6)

"BLD",665,"KRN","B",3.8,3.8)

"BLD",665,"KRN","B",9.2,9.2)

"BLD",665,"KRN","B",9.8,9.8)

"BLD",665,"KRN","B",19,19)

"BLD",665,"KRN","B",19.1,19.1)

"BLD",665,"KRN","B",101,101)

"BLD",665,"KRN","B",409.61,409.61)

"BLD",665,"KRN","B",771,771)

"BLD",665,"KRN","B",869.2,869.2)

"BLD",665,"KRN","B",870,870)

"BLD",665,"KRN","B",8994,8994)

"BLD",665,"QUES",0)
^9.62^^
"BLD",665,"REQB",0)
^9.611^^
"OER",421,0)
421^IBD
"OER",421,1,0)
^100.9951PA^13^13
"OER",421,1,1,0)
635
"OER",421,1,1,1,0)
^100.99511PA^1^1
"OER",421,1,1,1,1,0)
1228
"OER",421,1,2,0)
634
"OER",421,1,2,1,0)
^100.99511PA^1^1
"OER",421,1,2,1,1,0)
1228
"OER",421,1,3,0)
639
"OER",421,1,3,1,0)
^100.99511PA^1^1
"OER",421,1,3,1,1,0)
1228
"OER",421,1,4,0)
640
"OER",421,1,4,1,0)
^100.99511PA^1^1
"OER",421,1,4,1,1,0)
1228
"OER",421,1,5,0)
636
"OER",421,1,5,1,0)
^100.99511PA^1^1
"OER",421,1,5,1,1,0)
1228
"OER",421,1,6,0)
644
"OER",421,1,6,1,0)
^100.99511PA^1^1
"OER",421,1,6,1,1,0)
1228
"OER",421,1,7,0)
659
"OER",421,1,7,1,0)
^100.99511PA^1^1
"OER",421,1,7,1,1,0)
1228
"OER",421,1,8,0)
660
"OER",421,1,8,1,0)
^100.99511PA^1^1
"OER",421,1,8,1,1,0)
1228
"OER",421,1,9,0)
637
"OER",421,1,9,1,0)
^100.99511PA^1^1
"OER",421,1,9,1,1,0)
1228
"OER",421,1,10,0)
638
"OER",421,1,10,1,0)
^100.99511PA^1^1
"OER",421,1,10,1,1,0)
1228
"OER",421,1,11,0)
642
"OER",421,1,11,1,0)
^100.99511PA^1^1
"OER",421,1,11,1,1,0)
1228
"OER",421,1,12,0)
663
"OER",421,1,12,1,0)
^100.99511PA^1^1
"OER",421,1,12,1,1,0)
1228
"OER",421,1,13,0)
1665
"OER",421,1,13,1,0)
^100.99511PA^2^2
"OER",421,1,13,1,1,0)
1707
"OER",421,1,13,1,2,0)
1110
"OER",421,5,0)
^100.9955^^0
"PKG",421,-1)
1^1
"PKG",421,0)
AUTOMATED INFO COLLECTION SYS^IBD^The utilities for generating a paper encounter form.
"PKG",421,22,0)
^9.49I^1^1
"PKG",421,22,1,0)
3.0^2970212^2970424^1258
"PKG",421,22,1,"PAH",1,0)
16^2971029
"PKG",421,22,1,"PAH",1,1,0)
^^8^8^2980227
"PKG",421,22,1,"PAH",1,1,1,0)
 
"PKG",421,22,1,"PAH",1,1,2,0)
This patch fixes some misc. Forms Tracking items...
"PKG",421,22,1,"PAH",1,1,3,0)
When a new clinic is created and has appts., encounter
"PKG",421,22,1,"PAH",1,1,4,0)
forms print but they are not included on Forms Tracking
"PKG",421,22,1,"PAH",1,1,5,0)
list for a single division facility without the division
"PKG",421,22,1,"PAH",1,1,6,0)
field filled in.
"PKG",421,22,1,"PAH",1,1,7,0)
Fixes Forms Tracking action SS Status Select for 
"PKG",421,22,1,"PAH",1,1,8,0)
Pending Pages and Error Detected, Not Transmitted.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","IBDFFT")
0^3^B45918204
"RTN","IBDFFT",1,0)
IBDFFT ;ALB/MAF - FORMS TRACKING ; JUL 6 1995@800
"RTN","IBDFFT",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**16**;APR 24, 1997
"RTN","IBDFFT",3,0)
 ;
"RTN","IBDFFT",4,0)
 ;
"RTN","IBDFFT",5,0)
OUT S IBDF2=0
"RTN","IBDFFT",6,0)
 S DIR("B")="CLINIC",DIR(0)="SBM^C:CLINIC;P:PATIENT;G:GROUP (CLINIC)",DIR("A")="Sort by [C]linic, [P]atient, [G]roup (Clinic)" D ^DIR
"RTN","IBDFFT",7,0)
 K DIR I $D(DIRUT)&('$D(IBDF1))!(Y<0) G EXIT
"RTN","IBDFFT",8,0)
 I $D(DIRUT)&$D(IBDF1) G QUIT
"RTN","IBDFFT",9,0)
 S X=$S("Pp"[X:2,"Gg"[X:3,1:1)
"RTN","IBDFFT",10,0)
 S IBDFSR=$E(X)
"RTN","IBDFFT",11,0)
 I $D(^DG(43,1,"GL")) S IBDFMUL=$P(^DG(43,1,"GL"),"^",2)
"RTN","IBDFFT",12,0)
 S IBDFL=$S(IBDFSR=1:"CLN",IBDFSR=2:"PAT",IBDFSR=3:"GRP",1:"QUIT")
"RTN","IBDFFT",13,0)
 I $D(IBDFMUL),IBDFMUL D DIVISION^VAUTOMA G:Y=-1 QUIT
"RTN","IBDFFT",14,0)
 I 'IBDFMUL S IBDFDV=$O(^DG(40.8,0)) S VAUTD=0,VAUTD(+$O(^DG(40.8,0)))=$P($G(^DG(40.8,+$O(^DG(40.8,0)),0)),"^")
"RTN","IBDFFT",15,0)
 D @(IBDFL) G:Y=-1 QUIT ;I IBDFL="GRP" D GRP1
"RTN","IBDFFT",16,0)
 D DAT G:Y=-1 QUIT
"RTN","IBDFFT",17,0)
OKQ N IBQUEUE S %=1 W !!,"Do you want to queue this to a printer?" D YN^DICN I '% D YN G OKQ
"RTN","IBDFFT",18,0)
 I %=-1 G EXIT
"RTN","IBDFFT",19,0)
 I %=1 S IBQUEUE=1
"RTN","IBDFFT",20,0)
 I $D(IBQUEUE) G QUEUE
"RTN","IBDFFT",21,0)
 D WAIT^DICD
"RTN","IBDFFT",22,0)
 S IBDFDAT=$$HTE^XLFDT($H)
"RTN","IBDFFT",23,0)
 I '$D(IBDF1) D EN^VALM("IBDF FT REPORT")
"RTN","IBDFFT",24,0)
 I $D(IBDF1) D KILL,START^IBDFFT1 S VALMBCK="R",VALMBG=1
"RTN","IBDFFT",25,0)
 Q
"RTN","IBDFFT",26,0)
 ;
"RTN","IBDFFT",27,0)
 ;
"RTN","IBDFFT",28,0)
SAVE ;  -- save variables for queue
"RTN","IBDFFT",29,0)
 S ZTSAVE("^TMP(""FTRK"",$J,")="",ZTSAVE("^TMP(""COUNT"",$J,")="",ZTSAVE("^TMP(""FRM"",$J,")="",ZTSAVE("^TMP(""CNT"",$J,")="",ZTSAVE("^TMP(""STATS"",$J,")="",ZTSAVE("VA*")="",ZTSAVE("VAUTG(")="",ZTSAVE("VAUTN(")="",ZTSAVE("VAUTC(")=""
"RTN","IBDFFT",30,0)
 Q
"RTN","IBDFFT",31,0)
QUEUE W !!,$C(7),"** Report requires 132 columns and a page length of 80 lines. **",!
"RTN","IBDFFT",32,0)
 N ZTSK,ZTDTH,ZTRTN,ZTDESC,ZTSAVE,ZTION,X,Y
"RTN","IBDFFT",33,0)
 K %IS,%ZIS,IOP S IOP="Q",%ZIS="QM0",%ZIS("A")="OUTPUT DEVICE: " D ^%ZIS G:POP EXIT
"RTN","IBDFFT",34,0)
 I $D(IO("Q")) S ZTRTN="^IBDFFT3",ZTDESC="Forms Tracking Report",ZTSAVE("^TMP(""FTRK"",$J,")="",ZTSAVE("IB*")="" D SAVE D ^%ZTLOAD K IO("Q") W !,$S($D(ZTSK):"Request Queued Task="_ZTSK,1:"Request Canceled") D HOME^%ZIS G EXIT
"RTN","IBDFFT",35,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","IBDFFT",36,0)
CLEAR ; -- Clean up variables if task is not queued
"RTN","IBDFFT",37,0)
 D ^IBDFFT3
"RTN","IBDFFT",38,0)
 G EXIT ;K ^TMP("IBDF",$J),^TMP("IB",$J)
"RTN","IBDFFT",39,0)
 Q
"RTN","IBDFFT",40,0)
HDR ; -- header code
"RTN","IBDFFT",41,0)
 S VALMHDR(1)="Encounter forms - printed; scanned (to PCE, w/ERrors); pending pages;"
"RTN","IBDFFT",42,0)
 S VALMHDR(2)="data entry (to PCE,w/ERrors); error detected,not transmitted; not printed."
"RTN","IBDFFT",43,0)
 Q
"RTN","IBDFFT",44,0)
 ;
"RTN","IBDFFT",45,0)
CLN S VAUTNI=2,DIC="^SC(",DIC("S")="I $P(^(0),U,3)=""C""&$S(VAUTD:1,$D(VAUTD(+$P(^(0),U,15))):1,'+$P(^(0),U,15)&$D(VAUTD(+$O(^DG(40.8,0)))):1,1:0)",VAUTSTR="clinic",VAUTVB="VAUTC" D FIRST^VAUTOMA S:Y=-1 IBDF2=1 Q:IBDF2
"RTN","IBDFFT",46,0)
 Q
"RTN","IBDFFT",47,0)
 ;
"RTN","IBDFFT",48,0)
 ;
"RTN","IBDFFT",49,0)
PAT S VAUTNI=2 D PATIENT^VAUTOMA S:Y=-1 IBDF2=1 Q:IBDF2
"RTN","IBDFFT",50,0)
 Q
"RTN","IBDFFT",51,0)
 ;
"RTN","IBDFFT",52,0)
 ;
"RTN","IBDFFT",53,0)
GRP S VAUTNI=2,DIC="^IBD(357.99,",VAUTSTR="clinic group",VAUTVB="VAUTG" D FIRST^VAUTOMA S:Y=-1 IBDF2=1 Q:IBDF2
"RTN","IBDFFT",54,0)
 Q
"RTN","IBDFFT",55,0)
GRP1 N IBGROUP
"RTN","IBDFFT",56,0)
 I VAUTG=1 D
"RTN","IBDFFT",57,0)
 .S IBGROUP=0 F  S IBGROUP=$O(^IBD(357.99,IBGROUP)) Q:'IBGROUP  I $D(^IBD(357.99,IBGROUP,0)) S VAUTG(IBGROUP)=$P(^IBD(357.99,IBGROUP,0),"^",1)
"RTN","IBDFFT",58,0)
 .Q
"RTN","IBDFFT",59,0)
 S IBGROUP=0 F  S IBGROUP=$O(VAUTG(IBGROUP)) Q:'IBGROUP  D
"RTN","IBDFFT",60,0)
 .N IBCLI,IBDIV,IBCLNUM,IBDIVNUM
"RTN","IBDFFT",61,0)
 .S IBCLI=0 F  S IBCLI=$O(^IBD(357.99,IBGROUP,10,IBCLI)) Q:'IBCLI  I $D(^IBD(357.99,IBGROUP,10,IBCLI,0)) S IBCLNUM=+^IBD(357.99,IBGROUP,10,IBCLI,0) I $D(^SC(+IBCLNUM,0)) D
"RTN","IBDFFT",62,0)
 ..S VAUTG(IBGROUP,IBCLNUM)=$P(^SC(+IBCLNUM,0),"^",1)
"RTN","IBDFFT",63,0)
 ..Q
"RTN","IBDFFT",64,0)
 .S IBDIV=0 F  S IBDIV=$O(^IBD(357.99,IBGROUP,11,IBDIV)) Q:'IBDIV  I $D(^IBD(357.99,IBGROUP,11,IBDIV,0)) S IBDIVNUM=+^IBD(357.99,IBGROUP,11,IBDIV,0) I $D(^DG(40.8,IBDIVNUM,0)) D
"RTN","IBDFFT",65,0)
 ..S IBCLNUM=0 F  S IBCLNUM=$O(^SC(IBCLNUM)) Q:'IBCLNUM  I $D(^SC(IBCLNUM,0)) I +$P(^SC(IBCLNUM,0),"^",15)=IBDIVNUM S VAUTG(IBGROUP,IBCLNUM)=$P(^SC(IBCLNUM,0),"^",1)
"RTN","IBDFFT",66,0)
 ..Q
"RTN","IBDFFT",67,0)
 Q
"RTN","IBDFFT",68,0)
 ;
"RTN","IBDFFT",69,0)
 ;
"RTN","IBDFFT",70,0)
CHECK(CLIN) ;  -- Check to see if clinic has a form and its one that is not for
"RTN","IBDFFT",71,0)
 ;     future use only.
"RTN","IBDFFT",72,0)
 N IBDFNODE,IBDFCL,X
"RTN","IBDFFT",73,0)
 S QUIT=0
"RTN","IBDFFT",74,0)
 I $O(^SD(409.95,"B",+CLIN,0)) D
"RTN","IBDFFT",75,0)
 .S IBDFCL=$O(^SD(409.95,"B",+CLIN,0))
"RTN","IBDFFT",76,0)
 .S IBDFNODE=^SD(409.95,IBDFCL,0)
"RTN","IBDFFT",77,0)
 .S QUIT=0 F X=2:1:9 S:$P(IBDFNODE,"^",X)&("^1^2^3^4^5^6^8^9^"[X) QUIT=1 Q:QUIT
"RTN","IBDFFT",78,0)
 Q
"RTN","IBDFFT",79,0)
 ;
"RTN","IBDFFT",80,0)
 ;
"RTN","IBDFFT",81,0)
EXIT ;  -- Code executed at action exit
"RTN","IBDFFT",82,0)
 K IBDFL,IBDFL1,IBDFBG,IBDFBG1,IBDFBEG,IBDFBEG1,IBDFEND,IBDFEND1,VAUTD,VAUTN,VAUTC,IBDFC1,IBDFN1,IBDFDV1,VAUTD1,VAUTC1,VAUTN1,IBDFN,DNKA,VAUTG,IBDFGRO,%DT,VAL,POP,IBDFG1,DIR,VAUTVB
"RTN","IBDFFT",83,0)
 K %,DIC,DIRUT,IBDF1,VALMBCK,VALMBG,VALMHDR,VAUTG1,VAUTNI,VAUTSTR,ZTQUEUED,X,X1,X2,D0,DA,DIK,%ZIS,IOP,CLIN,APPT
"RTN","IBDFFT",84,0)
 K IBDCNT,IBDCNT1,IBDFCL,IBDFDV,IBDFGR,VALMCNT,IBDFPAGE,IFN,VALMY
"RTN","IBDFFT",85,0)
EXIT1 ;
"RTN","IBDFFT",86,0)
 K DFN,IBDFCLI,IBDFDA,IBDFDAT,IBDFIFN,IBDFMUL,IBDFSA,IBDFSR,IBDFT,IBDVAL,IBDFVAL,IBDVAL1,QUIT,IBDF2,IBDNKA,IBDX
"RTN","IBDFFT",87,0)
 K ^TMP("CNT",$J),^TMP("FRM",$J),^TMP("FTRK",$J),^TMP("STATS",$J),^TMP("FRMIDX",$J),^TMP("STAIDX",$J),^TMP("COUNT",$J),IBDFDIV,IBDFCLIN,IBDFNODE,IBDFGROP
"RTN","IBDFFT",88,0)
 D ^%ZISC
"RTN","IBDFFT",89,0)
 Q
"RTN","IBDFFT",90,0)
 ;
"RTN","IBDFFT",91,0)
 ;
"RTN","IBDFFT",92,0)
DAT ;  -- DATE RANGE
"RTN","IBDFFT",93,0)
BEG W ! S %DT="AEX",%DT("A")="BEGINNING DATE: " D ^%DT S IBDFBG=Y,IBDFBEG=Y-.0001 S:X="^"!(X="") Y=-1 Q:Y=-1
"RTN","IBDFFT",94,0)
END W ! S %DT("A")="ENDING DATE: " D ^%DT S:X="^"!(X="") Y=-1 Q:Y=-1  I Y<1 D HELP^%DTC G END
"RTN","IBDFFT",95,0)
 S IBDFEND=Y_.9999
"RTN","IBDFFT",96,0)
 I IBDFEND\1<IBDFBG W !!?5,"The ending date cannot be before the beginning date" G END
"RTN","IBDFFT",97,0)
 Q
"RTN","IBDFFT",98,0)
 ;
"RTN","IBDFFT",99,0)
 ;
"RTN","IBDFFT",100,0)
HELP ; -- help code
"RTN","IBDFFT",101,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBDFFT",102,0)
 Q
"RTN","IBDFFT",103,0)
CHGLST ;  -- Code to change list display
"RTN","IBDFFT",104,0)
 D FULL^VALM1
"RTN","IBDFFT",105,0)
 S IBDFL1=IBDFL,IBDFBG1=IBDFBG,IBDFBEG1=IBDFBEG,IBDFEND1=IBDFEND
"RTN","IBDFFT",106,0)
 S IBDFDV1=VAUTD S:$D(VAUTC) IBDFC1=VAUTC S:$D(VAUTN) IBDFN1=VAUTN
"RTN","IBDFFT",107,0)
 I $D(VAUTG) S IBDFG1=VAUTG
"RTN","IBDFFT",108,0)
 I VAUTD=0 F X=0:0 S X=$O(VAUTD(X)) Q:X']""  S VAUTD1(X)=VAUTD(X)
"RTN","IBDFFT",109,0)
 I $D(VAUTC),VAUTC=0 F X=0:0 S X=$O(VAUTC(X)) Q:X']""  S VAUTC1(X)=VAUTC(X)
"RTN","IBDFFT",110,0)
 I $D(VAUTN),VAUTN=0 F X=0:0 S X=$O(VAUTN(X)) Q:X']""  S VAUTN1(X)=VAUTN(X)
"RTN","IBDFFT",111,0)
 I $D(VAUTG) D
"RTN","IBDFFT",112,0)
 .N IBX
"RTN","IBDFFT",113,0)
 .S IBX=0
"RTN","IBDFFT",114,0)
 .F X=0:0 S X=$O(VAUTG(X)) Q:X']""  F Y=0:0 S Y=$O(VAUTG(X,Y)) Q:Y']""  S VAUTG1(X,Y)=VAUTG(X,Y)
"RTN","IBDFFT",115,0)
 D EXIT1,OUT
"RTN","IBDFFT",116,0)
 Q
"RTN","IBDFFT",117,0)
KILL ;  -- Kill extra array variables
"RTN","IBDFFT",118,0)
 N IBDFXX
"RTN","IBDFFT",119,0)
 S IBDFXX=$S(IBDFL="CLN":"VAUTC",IBDFL="GRP":"VAUTG",1:"VAUTN")
"RTN","IBDFFT",120,0)
 I IBDFXX="VAUTN" K VAUTC,VAUTG
"RTN","IBDFFT",121,0)
 I IBDFXX="VAUTC" K VAUTN,VAUTG
"RTN","IBDFFT",122,0)
 I IBDFXX="VAUTG" K VAUTN,VAUTC
"RTN","IBDFFT",123,0)
 Q
"RTN","IBDFFT",124,0)
QUIT ;  -- Kill variables and reset to last display if no change has taken place
"RTN","IBDFFT",125,0)
 I $D(IBDF1) S IBDFL=IBDFL1,IBDFBG=IBDFBG1,IBDFBEG=IBDFBEG1,IBDFEND=IBDFEND1,VAUTD=IBDFDV1 S:IBDFL="CLN" VAUTC=IBDFC1 S:IBDFL="PAT" VAUTN=IBDFN1 S:IBDFL="GRP" VAUTG=IBDFG1 D
"RTN","IBDFFT",126,0)
 .I VAUTD=0 F X=0:0 S X=$O(VAUTD1(X)) Q:X']""  S VAUTD(X)=VAUTD1(X)
"RTN","IBDFFT",127,0)
 .I $D(VAUTC),VAUTC=0 F X=0:0 S X=$O(VAUTC1(X)) Q:X']""  S VAUTC(X)=VAUTC1(X)
"RTN","IBDFFT",128,0)
 .I $D(VAUTN),VAUTN=0 F X=0:0 S X=$O(VAUTN1(X)) Q:X']""  S VAUTN(X)=VAUTN1(X)
"RTN","IBDFFT",129,0)
 .I $D(VAUTG) D
"RTN","IBDFFT",130,0)
 ..F X=0:0 S X=$O(VAUTG1(X)) Q:X']""  F Y=0:0 S Y=$O(VAUTG1(X,Y)) Q:Y']""  S VAUTG(X,Y)=VAUTG1(X,Y)
"RTN","IBDFFT",131,0)
 I '$D(IBDF1) G EXIT
"RTN","IBDFFT",132,0)
 D KILL,START^IBDFFT1 S VALMBCK="R",VALMBG=1
"RTN","IBDFFT",133,0)
 Q
"RTN","IBDFFT",134,0)
 ;
"RTN","IBDFFT",135,0)
SCHSTAT(DFN,APPT) ; -- return text of scheduling status
"RTN","IBDFFT",136,0)
 ;
"RTN","IBDFFT",137,0)
 N X
"RTN","IBDFFT",138,0)
 S X=$$REQ^IBDFDE0(DFN,APPT,+$G(^DPT(DFN,"S",APPT,0)),$$FNDSDOE^IBDFDE(DFN,APPT))
"RTN","IBDFFT",139,0)
 S X=$S(X=1:"CO Required",X=-1:"CO Complete",1:"CO Not Req.")
"RTN","IBDFFT",140,0)
 Q X
"RTN","IBDFFT",141,0)
YN W !?10,"Choose:",!?25,"Y for YES",!?25,"N for NO",! Q
"RTN","IBDFFT1")
0^4^B80629506
"RTN","IBDFFT1",1,0)
IBDFFT1 ;ALB/MAF - FORMS TRACKING CONTINUED - JUL 6 1995
"RTN","IBDFFT1",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**16**;APR 24, 1997
"RTN","IBDFFT1",3,0)
 ;
"RTN","IBDFFT1",4,0)
START ;
"RTN","IBDFFT1",5,0)
 N IBDCNT,IBDCNT1,IBDFTIME
"RTN","IBDFFT1",6,0)
 S (IBDCNT,IBDNKA,IBDCNT1,VALMCNT)=0
"RTN","IBDFFT1",7,0)
 D KILL^VALM10()
"RTN","IBDFFT1",8,0)
 D @(IBDFL)
"RTN","IBDFFT1",9,0)
 N IBDFDV,IBDFCL,IBDNODE,IBDFTMP,IBDFPAT,IBDFPT,IBDFT
"RTN","IBDFFT1",10,0)
 S (IBDFDV,IBDFCL,IBDFPT)=0
"RTN","IBDFFT1",11,0)
 ;
"RTN","IBDFFT1",12,0)
 I $D(VAUTG) D
"RTN","IBDFFT1",13,0)
 .N IBDFGR
"RTN","IBDFFT1",14,0)
 .S IBDFGR=0
"RTN","IBDFFT1",15,0)
 .F IBDFDIV=0:0 S IBDFDV=$O(^TMP("FTRK",$J,IBDFDV)) Q:IBDFDV']""  D:'$D(IBDFDIV(IBDFDV)) HEADER^IBDFFT2 F IBDFGRO=0:0 S IBDFGR=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR)) Q:IBDFGR']""  D
"RTN","IBDFFT1",16,0)
 ..F IBDFCLI=0:0 S IBDFCL=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL)) Q:IBDFCL']""  D:'$D(IBDFGROP(IBDFDV,IBDFGR)) HEADER2^IBDFFT2 D:'$D(IBDFCLIN(IBDFGR,IBDFCL)) HEADER1^IBDFFT2 D
"RTN","IBDFFT1",17,0)
 ...F IBDFT=0:0 S IBDFT=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT)) Q:'IBDFT  F IBDFPAT=0:0 S IBDFPT=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT,IBDFPT)) Q:IBDFPT']""  D
"RTN","IBDFFT1",18,0)
 ....F IBDFIFN=0:0 S IBDFIFN=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT,IBDFPT,IBDFIFN)) Q:'IBDFIFN  S IBDX="" F  S IBDX=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT,IBDFPT,IBDFIFN,IBDX)) Q:IBDX=""  S IBDFTMP=^(IBDX) D SETARR
"RTN","IBDFFT1",19,0)
 I '$D(VAUTG) D
"RTN","IBDFFT1",20,0)
 .F IBDFDIV=0:0 S IBDFDV=$O(^TMP("FTRK",$J,IBDFDV)) Q:IBDFDV']""  D:'$D(IBDFDIV(IBDFDV)) HEADER^IBDFFT2 F IBDFCLI=0:0 S IBDFCL=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL)) Q:IBDFCL']""  D:'$D(IBDFCLIN(IBDFDV,IBDFCL)) HEADER1^IBDFFT2 D
"RTN","IBDFFT1",21,0)
 ..F IBDFT=0:0 S IBDFT=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT)) Q:'IBDFT  F IBDFPAT=0:0 S IBDFPT=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT,IBDFPT)) Q:IBDFPT']""  D
"RTN","IBDFFT1",22,0)
 ...F IBDFIFN=0:0 S IBDFIFN=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT,IBDFPT,IBDFIFN)) Q:'IBDFIFN  S IBDX="" F  S IBDX=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT,IBDFPT,IBDFIFN,IBDX)) Q:IBDX=""  S IBDFTMP=^(IBDX) D SETARR
"RTN","IBDFFT1",23,0)
 I '$D(^TMP("FRM",$J)) D NUL^IBDFFT2
"RTN","IBDFFT1",24,0)
 Q
"RTN","IBDFFT1",25,0)
CLN ;  -- Loop clinics
"RTN","IBDFFT1",26,0)
 N IBDFCLIN
"RTN","IBDFFT1",27,0)
 I VAUTC=1 F IBDFCLIN=0:0 S IBDFCLIN=$O(^SC(IBDFCLIN)) Q:'IBDFCLIN  D CK(IBDFCLIN) I QUIT=1 D BLD
"RTN","IBDFFT1",28,0)
 I VAUTC=0 F IBDFCLIN=0:0 S IBDFCLIN=$O(VAUTC(IBDFCLIN)) Q:'IBDFCLIN  D CK(IBDFCLIN) I QUIT=1 D BLD
"RTN","IBDFFT1",29,0)
 D TRACKING Q
"RTN","IBDFFT1",30,0)
PAT ;  -- Loop patients
"RTN","IBDFFT1",31,0)
 N IBDFCLIN,IBDFPAT
"RTN","IBDFFT1",32,0)
 I VAUTN=1 F IBDFPAT=0:0 S IBDFPAT=$O(^DPT(IBDFPAT)) Q:'IBDFPAT  F IBDFT=IBDFBEG:0 S IBDFT=$O(^DPT(IBDFPAT,"S",IBDFT)) Q:'IBDFT!($P(IBDFT,".",1)>IBDFEND)  I $D(^DPT(IBDFPAT,"S",IBDFT,0)) D SET
"RTN","IBDFFT1",33,0)
 I VAUTN=0 F IBDFPAT=0:0 S IBDFPAT=$O(VAUTN(IBDFPAT)) Q:'IBDFPAT  F IBDFT=IBDFBEG:0 S IBDFT=$O(^DPT(IBDFPAT,"S",IBDFT)) Q:'IBDFT!($P(IBDFT,".",1)>IBDFEND)  I $D(^DPT(IBDFPAT,"S",IBDFT,0)) D SET
"RTN","IBDFFT1",34,0)
 D TRACKING Q
"RTN","IBDFFT1",35,0)
GRP D GRP1^IBDFFT
"RTN","IBDFFT1",36,0)
 N IBDFGRP,IBDFCLIN
"RTN","IBDFFT1",37,0)
 F IBDFGRP=0:0 S IBDFGRP=$O(VAUTG(IBDFGRP)) Q:'IBDFGRP  F IBDFCLIN=0:0 S IBDFCLIN=$O(VAUTG(IBDFGRP,IBDFCLIN)) Q:'IBDFCLIN  D CK(IBDFCLIN) I QUIT=1 D BLD
"RTN","IBDFFT1",38,0)
 D TRACKING Q
"RTN","IBDFFT1",39,0)
 ;
"RTN","IBDFFT1",40,0)
 ;
"RTN","IBDFFT1",41,0)
SET S IBDFCLIN=$P(^DPT(IBDFPAT,"S",IBDFT,0),"^",1) D CK(IBDFCLIN) I QUIT=1 S DFN=IBDFPAT D CK1 Q
"RTN","IBDFFT1",42,0)
 Q
"RTN","IBDFFT1",43,0)
 ;
"RTN","IBDFFT1",44,0)
 ;
"RTN","IBDFFT1",45,0)
CK(XCL) ;  -- Check clinic, division, form
"RTN","IBDFFT1",46,0)
 Q:'$D(^SC(+XCL,0))
"RTN","IBDFFT1",47,0)
 S QUIT=0
"RTN","IBDFFT1",48,0)
 S IBDFNODE=$G(^SC(XCL,0))
"RTN","IBDFFT1",49,0)
 Q:$P(IBDFNODE,"^",3)'="C"
"RTN","IBDFFT1",50,0)
 I $G(VAUTD)=0 I $P(IBDFNODE,"^",15)  Q:'$D(VAUTD($P(IBDFNODE,"^",15)))
"RTN","IBDFFT1",51,0)
 D CHECK^IBDFFT(XCL)
"RTN","IBDFFT1",52,0)
 Q:QUIT=0
"RTN","IBDFFT1",53,0)
 Q
"RTN","IBDFFT1",54,0)
 ;
"RTN","IBDFFT1",55,0)
 ;
"RTN","IBDFFT1",56,0)
BLD ; -- scan appts
"RTN","IBDFFT1",57,0)
 F IBDFT=IBDFBEG:0 S IBDFT=$O(^SC(IBDFCLIN,"S",IBDFT)) Q:'IBDFT!($P(IBDFT,".",1)>IBDFEND)  D
"RTN","IBDFFT1",58,0)
 .F IBDFDA=0:0 S IBDFDA=$O(^SC(IBDFCLIN,"S",IBDFT,1,IBDFDA)) Q:'IBDFDA  I $D(^SC(IBDFCLIN,"S",IBDFT,1,IBDFDA,0)) S IBDFSA=^(0) S DFN=+IBDFSA D CK1
"RTN","IBDFFT1",59,0)
 Q
"RTN","IBDFFT1",60,0)
CK1 ; -- 
"RTN","IBDFFT1",61,0)
 N IBDFXPC,IBDFYPC
"RTN","IBDFFT1",62,0)
 S IBDFXPC=$S($D(VAUTC)!($D(VAUTG)):$P(IBDFNODE,"^",1),1:$P(^DPT(IBDFPAT,0),"^",1))
"RTN","IBDFFT1",63,0)
 S IBDFYPC=$S($D(VAUTC)!($D(VAUTG)):$P(^DPT(DFN,0),"^",1),1:$P(IBDFNODE,"^",1))
"RTN","IBDFFT1",64,0)
 I $D(^IBD(357.96,"APTAP",DFN,IBDFT)) S IBDFIFN=0 F  S IBDFIFN=$O(^IBD(357.96,"APTAP",DFN,IBDFT,IBDFIFN)) Q:'IBDFIFN  I $D(^IBD(357.96,IBDFIFN,0)) D
"RTN","IBDFFT1",65,0)
 .I $D(VAUTG) S ^TMP("FTRK",$J,$S($D(^DG(40.8,+$P(IBDFNODE,"^",15),0)):$P(^DG(40.8,$P(IBDFNODE,"^",15),0),"^",1),1:"NOT SPECIFIED"),$P(^IBD(357.99,IBDFGRP,0),"^",1),IBDFXPC,IBDFT,IBDFYPC,DFN,+IBDFIFN)=IBDFCLIN_"^"_^IBD(357.96,IBDFIFN,0)
"RTN","IBDFFT1",66,0)
 .I '$D(VAUTG) S ^TMP("FTRK",$J,$S($D(^DG(40.8,+$P(IBDFNODE,"^",15),0)):$P(^DG(40.8,$P(IBDFNODE,"^",15),0),"^",1),1:"NOT SPECIFIED"),IBDFXPC,IBDFT,IBDFYPC,DFN,+IBDFIFN)=IBDFCLIN_"^"_^IBD(357.96,IBDFIFN,0)
"RTN","IBDFFT1",67,0)
 .Q
"RTN","IBDFFT1",68,0)
 E  D
"RTN","IBDFFT1",69,0)
 .I $D(VAUTG) S ^TMP("FTRK",$J,$S($D(^DG(40.8,+$P(IBDFNODE,"^",15),0)):$P(^DG(40.8,$P(IBDFNODE,"^",15),0),"^",1),1:"NOT SPECIFIED"),$P(^IBD(357.99,IBDFGRP,0),"^",1),IBDFXPC,IBDFT,IBDFYPC,DFN,0)=IBDFCLIN_"^^"_DFN_"^"_IBDFT
"RTN","IBDFFT1",70,0)
 .I '$D(VAUTG) S ^TMP("FTRK",$J,$S($D(^DG(40.8,+$P(IBDFNODE,"^",15),0)):$P(^DG(40.8,$P(IBDFNODE,"^",15),0),"^",1),1:"NOT SPECIFIED"),IBDFXPC,IBDFT,IBDFYPC,DFN,0)=IBDFCLIN_"^^"_DFN_"^"_IBDFT
"RTN","IBDFFT1",71,0)
 Q
"RTN","IBDFFT1",72,0)
 ;
"RTN","IBDFFT1",73,0)
SETARR ;  -- Set up Listman array
"RTN","IBDFFT1",74,0)
 S DFN=$P(IBDFTMP,"^",3)
"RTN","IBDFFT1",75,0)
 I '$D(^TMP("CNT",$J,$S(IBDFDV]"":IBDFDV,1:"NOT SPECIFIED"),IBDFCL)) D
"RTN","IBDFFT1",76,0)
 .S ^TMP("CNT",$J,$S(IBDFDV]"":IBDFDV,1:"NOT SPECIFIED"),IBDFCL)="0^0^0^0^0^0^0"
"RTN","IBDFFT1",77,0)
 .I $D(VAUTG) I '$D(^TMP("COUNT",$J,$S(IBDFDV]"":IBDFDV,1:"NOT SPECIFIED"),IBDFGR,IBDFCL)) D
"RTN","IBDFFT1",78,0)
 ..S ^TMP("COUNT",$J,$S(IBDFDV]"":IBDFDV,1:"NOT SPECIFIED"),IBDFGR,IBDFCL)=1
"RTN","IBDFFT1",79,0)
 I $D(VAUTG) K IBDFLAG I $D(^TMP("COUNT",$J,IBDFCL,IBDFT,IBDFIFN)) I IBDFGR=^TMP("COUNT",$J,IBDFCL,IBDFT,IBDFIFN) D COUNT
"RTN","IBDFFT1",80,0)
 I $D(VAUTG) I '$D(^TMP("COUNT",$J,IBDFCL,IBDFT,IBDFIFN)) D COUNT
"RTN","IBDFFT1",81,0)
 I '$D(VAUTG) S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",1)=$P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",1)+1
"RTN","IBDFFT1",82,0)
 S IBDCNT1=IBDCNT1+1
"RTN","IBDFFT1",83,0)
 S IBDCNT=IBDCNT+1,VALMCNT=VALMCNT+1
"RTN","IBDFFT1",84,0)
 S X=""
"RTN","IBDFFT1",85,0)
 S IBDFVAL=$J(IBDCNT1_")",5)
"RTN","IBDFFT1",86,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,1,5)
"RTN","IBDFFT1",87,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",2)
"RTN","IBDFFT1",88,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,7,8)
"RTN","IBDFFT1",89,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",4) I IBDFVAL S DNKA=$$DNKA(DFN,IBDFVAL),IBDFVAL=$P($$FMTE^XLFDT(IBDFVAL,2),":",1,2)
"RTN","IBDFFT1",90,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,17,14)
"RTN","IBDFFT1",91,0)
 I $D(VAUTC)!($D(VAUTG)) S (IBDFVAL,IBDFN)=$P($G(IBDFTMP),"^",3) I IBDFVAL]"" S IBDFVAL=$P(^DPT(IBDFVAL,0),"^",1)
"RTN","IBDFFT1",92,0)
 I $D(VAUTN) S (IBDFVAL,IBDFN)=$P($G(IBDFTMP),"^",1) I IBDFVAL]"" S IBDFVAL=$P(^SC(IBDFVAL,0),"^",1)
"RTN","IBDFFT1",93,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,34,15)
"RTN","IBDFFT1",94,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",6)
"RTN","IBDFFT1",95,0)
 I IBDFVAL]"" S IBDFVAL=$E(IBDFVAL,4,5)_"/"_$E(IBDFVAL,6,7)_"/"_$E(IBDFVAL,2,3) I '$D(VAUTG)!($D(VAUTG)&($D(IBDFLAG))) S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",2)=+($P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",2))+1
"RTN","IBDFFT1",96,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,50,8)
"RTN","IBDFFT1",97,0)
 S VAL=$P($G(IBDFTMP),"^",12)
"RTN","IBDFFT1",98,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",7)
"RTN","IBDFFT1",99,0)
 I IBDFVAL]"" S IBDFVAL=$E(IBDFVAL,4,5)_"/"_$E(IBDFVAL,6,7)_"/"_$E(IBDFVAL,2,3) I '$D(VAUTG)!($D(VAUTG)&($D(IBDFLAG))) I VAL=2 S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",3)=+($P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",3))+1
"RTN","IBDFFT1",100,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,61,8)
"RTN","IBDFFT1",101,0)
 N IBDFXX
"RTN","IBDFFT1",102,0)
 S IBDFXX=$S(VAL=3:3,VAL=6:5,1:"")
"RTN","IBDFFT1",103,0)
 I IBDFXX]"" I '$D(VAUTG)!($D(VAUTG)&($D(IBDFLAG))) S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",IBDFXX)=$P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",IBDFXX)+1 S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",6)=$P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",6)+1
"RTN","IBDFFT1",104,0)
 S VAL=$S(DNKA:$P(DNKA,"^",2),VAL=1:"PRINTED",VAL=2:"SCANNED",VAL=3:"SCD/PCE",VAL=4:"SCD w/ER",VAL=5:"DENTRY",VAL=6:"DE to PCE",VAL=7:"DE w/ER",VAL=11:"PEND Pgs",VAL=12:"ER/NOTRN",20:"AVAIL DE",1:"NOT PRNT")
"RTN","IBDFFT1",105,0)
 I DNKA S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",7)=+($P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",7))+1
"RTN","IBDFFT1",106,0)
 S X=$$SETSTR^VALM1(VAL,X,72,8)
"RTN","IBDFFT1",107,0)
 S IBDFVAL=$S(DNKA:"",1:$$SCHSTAT^IBDFFT($P(IBDFTMP,"^",3),$P(IBDFTMP,"^",4)))
"RTN","IBDFFT1",108,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,82,12)
"RTN","IBDFFT1",109,0)
 S IBDFVAL=$S($P(IBDFTMP,"^",14):" Yes",1:" No")
"RTN","IBDFFT1",110,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,96,6)
"RTN","IBDFFT1",111,0)
 ;
"RTN","IBDFFT1",112,0)
 ;
"RTN","IBDFFT1",113,0)
TMP ; -- Set up TMP Array
"RTN","IBDFFT1",114,0)
 S ^TMP("FRM",$J,IBDCNT,0)=$$LOWER^VALM1(X),^TMP("FRM",$J,"IDX",VALMCNT,IBDCNT1)=""
"RTN","IBDFFT1",115,0)
 S ^TMP("FRMIDX",$J,IBDCNT1)=VALMCNT_"^"_$P(IBDFTMP,"^",2)_"^"_$P(IBDFTMP,"^",3)_"^"_$P(IBDFTMP,"^",4)_"^"_$P(IBDFTMP,"^",6)_"^"_$P(IBDFTMP,"^",7)_"^"_$P(IBDFTMP,"^",12)
"RTN","IBDFFT1",116,0)
 D NOW^%DTC S IBDFTIME=% S X1=$S($P(IBDFTMP,"^",7):$P(IBDFTMP,"^",7),1:IBDFTIME),X2=$P(IBDFTMP,"^",4) D ^%DTC S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",4)=+($P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",4))+X
"RTN","IBDFFT1",117,0)
 Q
"RTN","IBDFFT1",118,0)
COUNT ;
"RTN","IBDFFT1",119,0)
 S ^TMP("COUNT",$J,IBDFCL,IBDFT,IBDFIFN)=IBDFGR,IBDFLAG=1
"RTN","IBDFFT1",120,0)
 S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",1)=$P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",1)+1
"RTN","IBDFFT1",121,0)
 Q
"RTN","IBDFFT1",122,0)
TRACKING ;  -- loops thru forms tracking file 357.96
"RTN","IBDFFT1",123,0)
 ;     X-reference ^IBD(357.96,"ADATNA", Appt date/time, 1 or 0, IFN).
"RTN","IBDFFT1",124,0)
 ;     1 = forms tracking file entry but no scheduled appt associated
"RTN","IBDFFT1",125,0)
 ;     0 = forms tracking file entry with associated scheduled appt.
"RTN","IBDFFT1",126,0)
 N IBDFCLIN,IBAPPTDT,IBDFPAT,IBDFTRK,IBDFX,IBDFT
"RTN","IBDFFT1",127,0)
 S IBDFX=""
"RTN","IBDFFT1",128,0)
 F IBDFT=IBDFBEG:0 S IBDFT=$O(^IBD(357.96,"ADATNA",IBDFT)) Q:'IBDFT!(IBDFT>IBDFEND)  S IBDFTRK=0 F  S IBDFTRK=$O(^IBD(357.96,"ADATNA",IBDFT,1,IBDFTRK)) Q:'IBDFTRK  D
"RTN","IBDFFT1",129,0)
 .Q:'$G(^IBD(357.96,IBDFTRK,0))
"RTN","IBDFFT1",130,0)
 .S IBDFCLIN=$P(^IBD(357.96,IBDFTRK,0),"^",10)
"RTN","IBDFFT1",131,0)
 .I IBDFCLIN']"" Q
"RTN","IBDFFT1",132,0)
 .S IBDFPAT=$P(^IBD(357.96,IBDFTRK,0),"^",2)
"RTN","IBDFFT1",133,0)
 .D CK(IBDFCLIN) I QUIT=1 D
"RTN","IBDFFT1",134,0)
 ..I $D(VAUTC),VAUTC=0,'$D(VAUTC(IBDFCLIN)) Q
"RTN","IBDFFT1",135,0)
 ..I $D(VAUTN),VAUTN=0,'$D(VAUTN(IBDFPAT)) Q
"RTN","IBDFFT1",136,0)
 ..N IBDFXPC,IBDFYPC
"RTN","IBDFFT1",137,0)
 ..S IBDFXPC=$S($D(VAUTC):$P(IBDFNODE,"^",1),$D(VAUTG):$P(IBDFNODE,"^",1),1:$P(^DPT(IBDFPAT,0),"^",1))
"RTN","IBDFFT1",138,0)
 ..S IBDFYPC=$S($D(VAUTC)!($D(VAUTG)):$P(^DPT(IBDFPAT,0),"^",1),1:$P(IBDFNODE,"^",1))
"RTN","IBDFFT1",139,0)
 ..I '$D(VAUTG) S ^TMP("FTRK",$J,$S($D(^DG(40.8,+$P(IBDFNODE,"^",15),0)):$P(^DG(40.8,$P(IBDFNODE,"^",15),0),"^",1),1:"NOT SPECIFIED"),IBDFXPC,IBDFT,IBDFYPC,IBDFPAT,IBDFTRK)=IBDFCLIN_"^"_^IBD(357.96,IBDFTRK,0)
"RTN","IBDFFT1",140,0)
 ..I $D(VAUTG) D
"RTN","IBDFFT1",141,0)
 ...N IBDFGRP,IBDFCLNN,IBDFCLN,IBDFGR
"RTN","IBDFFT1",142,0)
 ...S (IBDFCLN,IBDFGR)=0
"RTN","IBDFFT1",143,0)
 ...F IBDFGR=0:0 S IBDFGR=$O(VAUTG(IBDFGR)) Q:IBDFGR']""  F IBDFCLN=0:0 S IBDFCLN=$O(VAUTG(IBDFGR,IBDFCLN)) Q:IBDFCLN']""  I IBDFCLN=IBDFCLIN D
"RTN","IBDFFT1",144,0)
 ....N IBX,IBY
"RTN","IBDFFT1",145,0)
 ....S IBX=$P($G(^IBD(357.99,IBDFGR,0)),"^"),IBY=$P($G(^SC(IBDFCLN,0)),"^")
"RTN","IBDFFT1",146,0)
 ....S ^TMP("FTRK",$J,$S($D(^DG(40.8,+$P(IBDFNODE,"^",15),0)):$P(^DG(40.8,$P(IBDFNODE,"^",15),0),"^",1),1:"NOT SPECIFIED"),IBX,IBY,IBDFT,IBDFYPC,IBDFPAT,IBDFTRK)=IBDFCLIN_"^"_^IBD(357.96,IBDFTRK,0)
"RTN","IBDFFT1",147,0)
 Q
"RTN","IBDFFT1",148,0)
 ;
"RTN","IBDFFT1",149,0)
DNKA(DFN,APPT) ;
"RTN","IBDFFT1",150,0)
 ; -- return did not keep appointment
"RTN","IBDFFT1",151,0)
 N STATUS,DNKA
"RTN","IBDFFT1",152,0)
 S DNKA=0
"RTN","IBDFFT1",153,0)
 S STATUS=$P($G(^DPT(+$G(DFN),"S",+$G(APPT),0)),"^",2)
"RTN","IBDFFT1",154,0)
 I STATUS]"" I "^N^C^NA^CA^PC^PCA^"[STATUS S DNKA=1_"^"_$S(STATUS["N":"NO SHOW",1:"CANCELED")
"RTN","IBDFFT1",155,0)
 Q DNKA
"RTN","IBDFFT3")
0^5^B29992560
"RTN","IBDFFT3",1,0)
IBDFFT3 ;ALB/MAF - ROUTINE TO QUEUE FORMS TRACKING REPORT - 13 NOV 96
"RTN","IBDFFT3",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**16**;APR 24, 1997
"RTN","IBDFFT3",3,0)
 S IBDFDAT=$P($$HTE^XLFDT($H),":",1,2)
"RTN","IBDFFT3",4,0)
 N IBDCNT,IBDCNT1,IBDFTIME,IBFLAG,IBDFPAGE
"RTN","IBDFFT3",5,0)
 S (IBDCNT,IBDNKA,IBDFPAGE,IBDCNT1,VALMCNT)=0
"RTN","IBDFFT3",6,0)
 S IBDFL=IBDFL_"^IBDFFT1" D @(IBDFL)
"RTN","IBDFFT3",7,0)
 N IBDFDV,IBDFCL,IBDNODE,IBDFTMP,IBDFPAT,IBDFPT,IBDFT
"RTN","IBDFFT3",8,0)
 S (IBDFDV,IBDFCL,IBDFPT)=0
"RTN","IBDFFT3",9,0)
 I $D(VAUTG) D
"RTN","IBDFFT3",10,0)
 .N IBDFGR
"RTN","IBDFFT3",11,0)
 .S IBDFGR=0
"RTN","IBDFFT3",12,0)
 .F IBDFDIV=0:0 S IBDFDV=$O(^TMP("FTRK",$J,IBDFDV)) Q:IBDFDV']""  D:'$D(IBDFDIV(IBDFDV)) HEADER^IBDFFT4 F IBDFGRO=0:0 S IBDFGR=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR)) Q:IBDFGR']""  D
"RTN","IBDFFT3",13,0)
 ..F IBDFCLI=0:0 S IBDFCL=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL)) Q:IBDFCL']""  D:'$D(IBDFCLIN(IBDFGR,IBDFCL)) HEADER1^IBDFFT4 D
"RTN","IBDFFT3",14,0)
 ...F IBDFT=0:0 S IBDFT=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT)) Q:'IBDFT  F IBDFPAT=0:0 S IBDFPT=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT,IBDFPT)) Q:IBDFPT']""  D
"RTN","IBDFFT3",15,0)
 ....F IBDFIFN=0:0 S IBDFIFN=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT,IBDFPT,IBDFIFN)) Q:'IBDFIFN  S IBDX="" F  S IBDX=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT,IBDFPT,IBDFIFN,IBDX)) Q:IBDX=""  S IBDFTMP=^(IBDX) D PRINT
"RTN","IBDFFT3",16,0)
 I '$D(VAUTG) D
"RTN","IBDFFT3",17,0)
 .F IBDFDIV=0:0 S IBDFDV=$O(^TMP("FTRK",$J,IBDFDV)) Q:IBDFDV']""  D:'$D(IBDFDIV(IBDFDV)) HEADER^IBDFFT4 F IBDFCLI=0:0 S IBDFCL=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL)) Q:IBDFCL']""  D:'$D(IBDFCLIN(IBDFDV,IBDFCL)) HEADER1^IBDFFT4 D
"RTN","IBDFFT3",18,0)
 ..F IBDFT=0:0 S IBDFT=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT)) Q:'IBDFT  F IBDFPAT=0:0 S IBDFPT=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT,IBDFPT)) Q:IBDFPT']""  D
"RTN","IBDFFT3",19,0)
 ...F IBDFIFN=0:0 S IBDFIFN=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT,IBDFPT,IBDFIFN)) Q:'IBDFIFN  S IBDX="" F  S IBDX=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT,IBDFPT,IBDFIFN,IBDX)) Q:IBDX=""  S IBDFTMP=^(IBDX) D PRINT
"RTN","IBDFFT3",20,0)
 I '$D(^TMP("FRM",$J)) D NUL^IBDFFT4 Q
"RTN","IBDFFT3",21,0)
 ;Do statistics page right after printing list  D EN^IBDFST1
"RTN","IBDFFT3",22,0)
 D EN^IBDFST1
"RTN","IBDFFT3",23,0)
 Q
"RTN","IBDFFT3",24,0)
PRINT ;  -- Set up Listman array
"RTN","IBDFFT3",25,0)
 S DFN=$P(IBDFTMP,"^",3)
"RTN","IBDFFT3",26,0)
 I '$D(^TMP("CNT",$J,$S(IBDFDV]"":IBDFDV,1:"NOT SPECIFIED"),IBDFCL)) D
"RTN","IBDFFT3",27,0)
 .S ^TMP("CNT",$J,$S(IBDFDV]"":IBDFDV,1:"NOT SPECIFIED"),IBDFCL)="0^0^0^0^0^0"
"RTN","IBDFFT3",28,0)
 .I $D(VAUTG) I '$D(^TMP("COUNT",$J,$S(IBDFDV]"":IBDFDV,1:"NOT SPECIFIED"),IBDFGR,IBDFCL)) D
"RTN","IBDFFT3",29,0)
 ..S ^TMP("COUNT",$J,$S(IBDFDV]"":IBDFDV,1:"NOT SPECIFIED"),IBDFGR,IBDFCL)=1
"RTN","IBDFFT3",30,0)
 I $D(VAUTG) K IBDFLAG I $D(^TMP("COUNT",$J,IBDFCL,IBDFT,IBDFIFN)) I IBDFGR=^TMP("COUNT",$J,IBDFCL,IBDFT,IBDFIFN) D COUNT
"RTN","IBDFFT3",31,0)
 I $D(VAUTG) I '$D(^TMP("COUNT",$J,IBDFCL,IBDFT,IBDFIFN)) D COUNT
"RTN","IBDFFT3",32,0)
 I '$D(VAUTG) S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",1)=$P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",1)+1
"RTN","IBDFFT3",33,0)
 S IBDCNT1=IBDCNT1+1
"RTN","IBDFFT3",34,0)
 S IBDCNT=IBDCNT+1,VALMCNT=VALMCNT+1
"RTN","IBDFFT3",35,0)
 W !
"RTN","IBDFFT3",36,0)
 W $J(IBDCNT1_")",5)
"RTN","IBDFFT3",37,0)
 W ?7,$E($P($G(IBDFTMP),"^",2),1,8)
"RTN","IBDFFT3",38,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",4) I IBDFVAL S DNKA=$$DNKA^IBDFFT1(DFN,IBDFVAL),IBDFVAL=$$FMTE^XLFDT(IBDFVAL,2)
"RTN","IBDFFT3",39,0)
 W ?17,$E(IBDFVAL,1,14)
"RTN","IBDFFT3",40,0)
 I $D(VAUTC)!($D(VAUTG)) S (IBDFVAL,IBDFN)=$P($G(IBDFTMP),"^",3) I IBDFVAL]"" S IBDFVAL=$P(^DPT(IBDFVAL,0),"^",1)
"RTN","IBDFFT3",41,0)
 I $D(VAUTN) S (IBDFVAL,IBDFN)=$P($G(IBDFTMP),"^",1) I IBDFVAL]"" S IBDFVAL=$P(^SC(IBDFVAL,0),"^",1)
"RTN","IBDFFT3",42,0)
 W ?34,$E(IBDFVAL,1,15)
"RTN","IBDFFT3",43,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",6)
"RTN","IBDFFT3",44,0)
 I IBDFVAL]"" S IBDFVAL=$E(IBDFVAL,4,5)_"/"_$E(IBDFVAL,6,7)_"/"_$E(IBDFVAL,2,3) I '$D(VAUTG)!($D(VAUTG)&($D(IBDFLAG))) S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",2)=+($P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",2))+1
"RTN","IBDFFT3",45,0)
 W ?50,$E(IBDFVAL,1,8)
"RTN","IBDFFT3",46,0)
 S VAL=$P($G(IBDFTMP),"^",12)
"RTN","IBDFFT3",47,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",7)
"RTN","IBDFFT3",48,0)
 I IBDFVAL]"" S IBDFVAL=$E(IBDFVAL,4,5)_"/"_$E(IBDFVAL,6,7)_"/"_$E(IBDFVAL,2,3) I '$D(VAUTG)!($D(VAUTG)&($D(IBDFLAG))) I VAL=2 S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",3)=+($P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",3))+1
"RTN","IBDFFT3",49,0)
 W ?61,$E(IBDFVAL,1,8)
"RTN","IBDFFT3",50,0)
 N IBDFXX
"RTN","IBDFFT3",51,0)
 S IBDFXX=$S(VAL=3:3,VAL=6:5,1:"")
"RTN","IBDFFT3",52,0)
 I IBDFXX]"" I '$D(VAUTG)!($D(VAUTG)&($D(IBDFLAG))) S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",IBDFXX)=$P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",IBDFXX)+1 S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",6)=$P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",6)+1
"RTN","IBDFFT3",53,0)
 S VAL=$S(DNKA:$P(DNKA,"^",2),VAL=1:"PRINTED",VAL=2:"SCANNED",VAL=3:"SCD/PCE",VAL=4:"SCD w/ER",VAL=5:"DENTRY",VAL=6:"DE to PCE",VAL=7:"DE w/ER",VAL=11:"PEND Pgs",VAL=12:"ER/NOTRN",20:"AVAIL DE",1:"NOT PRNT")
"RTN","IBDFFT3",54,0)
 I DNKA S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",7)=+($P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",7))+1
"RTN","IBDFFT3",55,0)
 W ?72,$E(VAL,1,8)
"RTN","IBDFFT3",56,0)
 S IBDFVAL=$S(DNKA:"",1:$$SCHSTAT^IBDFFT($P(IBDFTMP,"^",3),$P(IBDFTMP,"^",4)))
"RTN","IBDFFT3",57,0)
 W ?82,$E(IBDFVAL,1,12)
"RTN","IBDFFT3",58,0)
 S IBDFVAL=$S($P(IBDFTMP,"^",14):" Yes",1:" No")
"RTN","IBDFFT3",59,0)
 W ?96,$E(IBDFVAL,1,6)
"RTN","IBDFFT3",60,0)
 ;
"RTN","IBDFFT3",61,0)
 ;
"RTN","IBDFFT3",62,0)
TMP ; -- Set up TMP Array
"RTN","IBDFFT3",63,0)
 S ^TMP("FRM",$J,IBDCNT,0)=$$LOWER^VALM1(X),^TMP("FRM",$J,"IDX",VALMCNT,IBDCNT1)=""
"RTN","IBDFFT3",64,0)
 S ^TMP("FRMIDX",$J,IBDCNT1)=VALMCNT_"^"_$P(IBDFTMP,"^",2)_"^"_$P(IBDFTMP,"^",3)_"^"_$P(IBDFTMP,"^",4)_"^"_$P(IBDFTMP,"^",6)_"^"_$P(IBDFTMP,"^",7)_"^"_$P(IBDFTMP,"^",12)
"RTN","IBDFFT3",65,0)
 D NOW^%DTC S IBDFTIME=% S X1=$S($P(IBDFTMP,"^",7):$P(IBDFTMP,"^",7),1:IBDFTIME),X2=$P(IBDFTMP,"^",4) D ^%DTC S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",4)=+($P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",4))+X
"RTN","IBDFFT3",66,0)
 Q
"RTN","IBDFFT3",67,0)
COUNT ;
"RTN","IBDFFT3",68,0)
 S ^TMP("COUNT",$J,IBDFCL,IBDFT,IBDFIFN)=IBDFGR,IBDFLAG=1
"RTN","IBDFFT3",69,0)
 S $P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",1)=$P(^TMP("CNT",$J,IBDFDV,IBDFCL),"^",1)+1
"RTN","IBDFFT3",70,0)
 Q
"RTN","IBDFSS")
0^2^B38407266
"RTN","IBDFSS",1,0)
IBDFSS ;ALB/MAF - STATUS SELECT ROUTINE (FORMS TRACKING) ; 11-JUL-1995
"RTN","IBDFSS",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**16**;APR 24, 1997
"RTN","IBDFSS",3,0)
 ;
"RTN","IBDFSS",4,0)
 ;
"RTN","IBDFSS",5,0)
START ;  -- Ask status to be displayed
"RTN","IBDFSS",6,0)
 D FULL^VALM1
"RTN","IBDFSS",7,0)
 K IBSTAT
"RTN","IBDFSS",8,0)
 S DIR("A")="Select ENCOUNTER FORM STATUS: ",DIR("B")="ALL"
"RTN","IBDFSS",9,0)
 S DIR(0)="SA^A:ALL;1:PRINTED;2:SCANNED;3:SCANNED TO PCE;4:SCANNED W/PCE ERROR;5:DATA ENTRY;6:DATA ENTRY TO PCE;7:DATA ENTRY W/PCE ERROR;11:PENDING PAGES;12:ERROR DETECTED, NOT TRANSMITTED;20:AVAILABLE FOR DATA ENTRY"
"RTN","IBDFSS",10,0)
 S DIR("?")="Enter desired status that you would like to have listed on the report"
"RTN","IBDFSS",11,0)
 D ^DIR
"RTN","IBDFSS",12,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","IBDFSS",13,0)
 I Y="A" D  K DIR Q
"RTN","IBDFSS",14,0)
 .F X=0,1,2,3,4,5,6,7,11,12,20 S IBSTAT(X)=""
"RTN","IBDFSS",15,0)
 .S IBDFALL=1
"RTN","IBDFSS",16,0)
 D SET
"RTN","IBDFSS",17,0)
 S $P(DIR(0),"^",1)=$P(DIR(0),"^",1)_"O",$P(DIR(0),"^",2)=$E($P(DIR(0),"^",2),7,999) K DIR("B")
"RTN","IBDFSS",18,0)
 S DIR("A")="Select another STATUS: "
"RTN","IBDFSS",19,0)
ASK D ^DIR I $D(DUOUT)!$D(DTOUT) Q
"RTN","IBDFSS",20,0)
 I X]"" D SET G ASK
"RTN","IBDFSS",21,0)
 K DIR Q
"RTN","IBDFSS",22,0)
 ;
"RTN","IBDFSS",23,0)
 ;
"RTN","IBDFSS",24,0)
SET S X=$S(Y=1:1,Y=2:2,Y=3:3,Y=4:4,Y=5:5,Y=6:6,Y=7:7,Y=11:11,Y=12:12,Y=20:20,1:0)
"RTN","IBDFSS",25,0)
 S IBSTAT(X)=""
"RTN","IBDFSS",26,0)
 Q
"RTN","IBDFSS",27,0)
 ;
"RTN","IBDFSS",28,0)
 ;
"RTN","IBDFSS",29,0)
EN ; -- main entry point for IBDF FT STATUS SELECT
"RTN","IBDFSS",30,0)
 D EN^VALM("IBDF FT STATUS SELECT")
"RTN","IBDFSS",31,0)
 Q
"RTN","IBDFSS",32,0)
 ;
"RTN","IBDFSS",33,0)
 ;
"RTN","IBDFSS",34,0)
SETARR ;  -- Set up Listman array
"RTN","IBDFSS",35,0)
 S IBDCNT1=IBDCNT1+1
"RTN","IBDFSS",36,0)
 S IBDCNT=IBDCNT+1,VALMCNT=VALMCNT+1
"RTN","IBDFSS",37,0)
 S X=""
"RTN","IBDFSS",38,0)
 S IBDFVAL=$J(IBDCNT1_")",5)
"RTN","IBDFSS",39,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,1,5)
"RTN","IBDFSS",40,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",2)
"RTN","IBDFSS",41,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,7,8)
"RTN","IBDFSS",42,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",4) I IBDFVAL S IBDFVAL=$$FMTE^XLFDT(IBDFVAL,2)
"RTN","IBDFSS",43,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,17,14)
"RTN","IBDFSS",44,0)
 I $D(VAUTC)!($D(VAUTG)) S IBDFVAL=$P($G(IBDFTMP),"^",3) I IBDFVAL]"" S IBDFVAL=$P(^DPT(IBDFVAL,0),"^",1)
"RTN","IBDFSS",45,0)
 I $D(VAUTN) S IBDFVAL=$P($G(IBDFTMP),"^",1) I IBDFVAL]"" S IBDFVAL=$P(^SC(IBDFVAL,0),"^",1)
"RTN","IBDFSS",46,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,34,15)
"RTN","IBDFSS",47,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",6) I IBDFVAL]"" S IBDFVAL=$E(IBDFVAL,4,5)_"/"_$E(IBDFVAL,6,7)_"/"_$E(IBDFVAL,2,3)
"RTN","IBDFSS",48,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,50,10)
"RTN","IBDFSS",49,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",7) I IBDFVAL]"" S IBDFVAL=$E(IBDFVAL,4,5)_"/"_$E(IBDFVAL,6,7)_"/"_$E(IBDFVAL,2,3)
"RTN","IBDFSS",50,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,62,10)
"RTN","IBDFSS",51,0)
 S IBDFVAL=$P($G(IBDFTMP),"^",12)
"RTN","IBDFSS",52,0)
 I IBDFVAL']""&($D(STATUS)) S IBDFVAL=$S(STATUS="":"AVL DE",STATUS["N":"NO SHOW","C^NA^CA^PC^PCA^"[STATUS:"CANCELED",1:"AVL DE")
"RTN","IBDFSS",53,0)
 S IBDFVAL=$S(IBDFVAL=1:"PRINTD",IBDFVAL=2:"SCANND",IBDFVAL=3:"SC/PCE",IBDFVAL=4:"SC/ER",IBDFVAL=5:"DENTRY",IBDFVAL=6:"DE/PCE",IBDFVAL=7:"DE/ER",IBDFVAL=11:"PENDNG",IBDFVAL=12:"ER/NTR",IBDFVAL=20:"AVL DE",1:IBDFVAL)
"RTN","IBDFSS",54,0)
 S X=$$SETSTR^VALM1(IBDFVAL,X,74,6)
"RTN","IBDFSS",55,0)
 ;
"RTN","IBDFSS",56,0)
 ;
"RTN","IBDFSS",57,0)
TMP ; -- Set up TMP Array
"RTN","IBDFSS",58,0)
 S ^TMP("SSEL",$J,IBDCNT,0)=$$LOWER^VALM1(X),^TMP("SSEL",$J,"IDX",VALMCNT,IBDCNT1)=""
"RTN","IBDFSS",59,0)
 S ^TMP("SELIDX",$J,IBDCNT1)=VALMCNT_"^"_$P(IBDFTMP,"^",2)_"^"_$P(IBDFTMP,"^",3)_"^"_$P(IBDFTMP,"^",4)_"^"_$P(IBDFTMP,"^",6)_"^"_$P(IBDFTMP,"^",7)_"^"_$P(IBDFTMP,"^",12)
"RTN","IBDFSS",60,0)
 Q
"RTN","IBDFSS",61,0)
 ;
"RTN","IBDFSS",62,0)
 ;
"RTN","IBDFSS",63,0)
HDR ; -- header code
"RTN","IBDFSS",64,0)
 S IBDFX=$P($$FMTE^XLFDT(IBDFBG),"@")
"RTN","IBDFSS",65,0)
 S IBDFY=$P($$FMTE^XLFDT(IBDFEND),"@")
"RTN","IBDFSS",66,0)
 S VALMHDR(1)="Encounter forms with selected status for the date range of "
"RTN","IBDFSS",67,0)
 S VALMHDR(2)=IBDFX_" to "_IBDFY
"RTN","IBDFSS",68,0)
 Q
"RTN","IBDFSS",69,0)
 ;
"RTN","IBDFSS",70,0)
 ;
"RTN","IBDFSS",71,0)
INIT ; -- init variables and list array
"RTN","IBDFSS",72,0)
 N IBDCNT,IBDCNT1,IBDFDV,IBDFCL,IBDFTMP,IBDFPT,IBDFPAT,IBDFT,STATUS
"RTN","IBDFSS",73,0)
 S (IBDFDV,IBDFCL,IBDCNT,IBDCNT1,IBDFPT,VALMCNT)=0
"RTN","IBDFSS",74,0)
 K ^TMP("SSEL",$J),^TMP("SELIDX",$J)
"RTN","IBDFSS",75,0)
 I $D(VAUTG) D
"RTN","IBDFSS",76,0)
 .N IBDFGR
"RTN","IBDFSS",77,0)
 .S IBDFGR=0
"RTN","IBDFSS",78,0)
 .F IBDFDIV=0:0 S IBDFDV=$O(^TMP("FTRK",$J,IBDFDV)) Q:IBDFDV']""  F IBDFGRO=0:0 S IBDFGR=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR)) Q:IBDFGR']""  F IBDFCLI=0:0 S IBDFCL=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL)) Q:IBDFCL']""  D
"RTN","IBDFSS",79,0)
 ..F IBDFT=0:0 S IBDFT=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT)) Q:'IBDFT  F IBDFPAT=0:0 S IBDFPT=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT,IBDFPT)) Q:IBDFPT']""  D
"RTN","IBDFSS",80,0)
 ...F IBDFIFN=0:0 S IBDFIFN=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT,IBDFPT,IBDFIFN)) Q:'IBDFIFN  S IBDX="" F  S IBDX=$O(^TMP("FTRK",$J,IBDFDV,IBDFGR,IBDFCL,IBDFT,IBDFPT,IBDFIFN,IBDX)) Q:IBDX=""  S IBDFTMP=^(IBDX) D
"RTN","IBDFSS",81,0)
 ....S STATUS=$P($G(^DPT(+$G(IBDFIFN),"S",+$G(IBDFT),0)),"^",2) I '$D(IBDFALL),STATUS]"" I "^N^C^NA^CA^PC^PCA^"[STATUS Q
"RTN","IBDFSS",82,0)
 ....S IBDFSTAT=$P(IBDFTMP,"^",12) I $D(IBSTAT(+IBDFSTAT))!($D(IBSTAT(20))&(IBDFSTAT="")) D:'$D(IBDFDIV1(IBDFDV)) HEADER^IBDFSS1 D:'$D(IBDFGRP1(IBDFDV,IBDFGR)) HEADER2^IBDFSS1 D:'$D(IBCLIN(IBDFGR,IBDFCL)) HEADER1^IBDFSS1 D SETARR
"RTN","IBDFSS",83,0)
 I '$D(VAUTG) D
"RTN","IBDFSS",84,0)
 .F IBDFDIV=0:0 S IBDFDV=$O(^TMP("FTRK",$J,IBDFDV)) Q:IBDFDV']""  F IBDFCLI=0:0 S IBDFCL=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL)) Q:IBDFCL']""  D
"RTN","IBDFSS",85,0)
 ..F IBDFT=0:0 S IBDFT=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT)) Q:'IBDFT  F IBDFPAT=0:0 S IBDFPT=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT,IBDFPT)) Q:IBDFPT']""  D
"RTN","IBDFSS",86,0)
 ...F IBDFIFN=0:0 S IBDFIFN=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT,IBDFPT,IBDFIFN)) Q:'IBDFIFN  S IBDX="" F  S IBDX=$O(^TMP("FTRK",$J,IBDFDV,IBDFCL,IBDFT,IBDFPT,IBDFIFN,IBDX)) Q:IBDX=""  S IBDFTMP=^(IBDX) D
"RTN","IBDFSS",87,0)
 ....S STATUS=$P($G(^DPT(+$G(IBDFIFN),"S",+$G(IBDFT),0)),"^",2) I '$D(IBDFALL),STATUS]"" I "^N^C^NA^CA^PC^PCA^"[STATUS Q
"RTN","IBDFSS",88,0)
 ....S IBDFSTAT=$P(IBDFTMP,"^",12) I $D(IBSTAT(+IBDFSTAT))!($D(IBSTAT(20))&(IBDFSTAT="")) D:'$D(IBDFDIV1(IBDFDV)) HEADER^IBDFSS1 D:'$D(IBCLIN(IBDFDV,IBDFCL)) HEADER1^IBDFSS1 D SETARR
"RTN","IBDFSS",89,0)
 I '$D(^TMP("SSEL",$J)) D NUL
"RTN","IBDFSS",90,0)
 Q
"RTN","IBDFSS",91,0)
 ;
"RTN","IBDFSS",92,0)
 ;
"RTN","IBDFSS",93,0)
NUL ; -- NULL MESSAGE
"RTN","IBDFSS",94,0)
 S ^TMP("SSEL",$J,1,0)=" ",^TMP("SSEL",$J,2,0)="There are no encounter forms that meet this criteria.",^TMP("SELIDX",$J,1)=1,^TMP("SELIDX",$J,2)=2
"RTN","IBDFSS",95,0)
 Q
"RTN","IBDFSS",96,0)
 ;
"RTN","IBDFSS",97,0)
 ;
"RTN","IBDFSS",98,0)
HELP ; -- help code
"RTN","IBDFSS",99,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBDFSS",100,0)
 Q
"RTN","IBDFSS",101,0)
 ;
"RTN","IBDFSS",102,0)
 ;
"RTN","IBDFSS",103,0)
EXIT ; -- exit code
"RTN","IBDFSS",104,0)
 K ^TMP("SSEL",$J),^TMP("SELIDX",$J),IBSTAT,IBCLIN,IBDFDIV1,DIR,IBDFSTAT,IBDFX,IBDFY,IBDFALL
"RTN","IBDFSS",105,0)
 Q
"RTN","IBDFSS",106,0)
 ;
"RTN","IBDFSS",107,0)
 ;
"RTN","IBDFSS",108,0)
EXPND ; -- expand code
"RTN","IBDFSS",109,0)
 Q
"RTN","IBDFSS",110,0)
 ;
"VER")
8.0^21.0
**END**
**END**
