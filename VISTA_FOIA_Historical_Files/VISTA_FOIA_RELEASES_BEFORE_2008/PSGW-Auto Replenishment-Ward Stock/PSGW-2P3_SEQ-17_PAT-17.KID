Released PSGW*2.3*17 SEQ #17
Extracted from mail message
**KIDS**:PSGW*2.3*17^

**INSTALL NAME**
PSGW*2.3*17
"BLD",5891,0)
PSGW*2.3*17^AUTO REPLENISHMENT/WARD STOCK^0^3041203^y
"BLD",5891,1,0)
^^3^3^3041118^
"BLD",5891,1,1,0)
 
"BLD",5891,1,2,0)
This patch will allow selection of Non-VA meds (X) to be selected for 
"BLD",5891,1,3,0)
Ward Stock.
"BLD",5891,4,0)
^9.64PA^^
"BLD",5891,"ABPKG")
n
"BLD",5891,"KRN",0)
^9.67PA^8989.52^19
"BLD",5891,"KRN",.4,0)
.4
"BLD",5891,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5891,"KRN",.401,0)
.401
"BLD",5891,"KRN",.402,0)
.402
"BLD",5891,"KRN",.403,0)
.403
"BLD",5891,"KRN",.5,0)
.5
"BLD",5891,"KRN",.84,0)
.84
"BLD",5891,"KRN",3.6,0)
3.6
"BLD",5891,"KRN",3.8,0)
3.8
"BLD",5891,"KRN",9.2,0)
9.2
"BLD",5891,"KRN",9.8,0)
9.8
"BLD",5891,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",5891,"KRN",9.8,"NM",1,0)
PSGWOD2^^0^B3426599
"BLD",5891,"KRN",9.8,"NM",2,0)
PSGWSTKI^^0^B7745197
"BLD",5891,"KRN",9.8,"NM",3,0)
PSGWUTL^^0^B22112870
"BLD",5891,"KRN",9.8,"NM",4,0)
PSGWCAD3^^0^B14438617
"BLD",5891,"KRN",9.8,"NM","B","PSGWCAD3",4)

"BLD",5891,"KRN",9.8,"NM","B","PSGWOD2",1)

"BLD",5891,"KRN",9.8,"NM","B","PSGWSTKI",2)

"BLD",5891,"KRN",9.8,"NM","B","PSGWUTL",3)

"BLD",5891,"KRN",19,0)
19
"BLD",5891,"KRN",19.1,0)
19.1
"BLD",5891,"KRN",101,0)
101
"BLD",5891,"KRN",409.61,0)
409.61
"BLD",5891,"KRN",771,0)
771
"BLD",5891,"KRN",771,"NM",0)
^9.68A^^
"BLD",5891,"KRN",870,0)
870
"BLD",5891,"KRN",870,"NM",0)
^9.68A^^
"BLD",5891,"KRN",8989.51,0)
8989.51
"BLD",5891,"KRN",8989.52,0)
8989.52
"BLD",5891,"KRN",8994,0)
8994
"BLD",5891,"KRN","B",.4,.4)
 
"BLD",5891,"KRN","B",.401,.401)
 
"BLD",5891,"KRN","B",.402,.402)
 
"BLD",5891,"KRN","B",.403,.403)
 
"BLD",5891,"KRN","B",.5,.5)
 
"BLD",5891,"KRN","B",.84,.84)
 
"BLD",5891,"KRN","B",3.6,3.6)
 
"BLD",5891,"KRN","B",3.8,3.8)
 
"BLD",5891,"KRN","B",9.2,9.2)
 
"BLD",5891,"KRN","B",9.8,9.8)
 
"BLD",5891,"KRN","B",19,19)
 
"BLD",5891,"KRN","B",19.1,19.1)
 
"BLD",5891,"KRN","B",101,101)
 
"BLD",5891,"KRN","B",409.61,409.61)
 
"BLD",5891,"KRN","B",771,771)
 
"BLD",5891,"KRN","B",870,870)
 
"BLD",5891,"KRN","B",8989.51,8989.51)
 
"BLD",5891,"KRN","B",8989.52,8989.52)
 
"BLD",5891,"KRN","B",8994,8994)
 
"BLD",5891,"QUES",0)
^9.62^^
"BLD",5891,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",124,-1)
1^1
"PKG",124,0)
AUTO REPLENISHMENT/WARD STOCK^PSGW^A method of drug distribution and inventory management.
"PKG",124,22,0)
^9.49I^1^1
"PKG",124,22,1,0)
2.3^2940104^2940416
"PKG",124,22,1,"PAH",1,0)
17^3041203
"PKG",124,22,1,"PAH",1,1,0)
^^3^3^3041203
"PKG",124,22,1,"PAH",1,1,1,0)
 
"PKG",124,22,1,"PAH",1,1,2,0)
This patch will allow selection of Non-VA meds (X) to be selected for 
"PKG",124,22,1,"PAH",1,1,3,0)
Ward Stock.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSGWCAD3")
0^4^B14438617
"RTN","PSGWCAD3",1,0)
PSGWCAD3 ;BHAM ISC/CML-Check for non-pharmacy items in AOUs before updating AMIS Stats ; 12/18/90 14:10
"RTN","PSGWCAD3",2,0)
 ;;2.3; Automatic Replenishment/Ward Stock ;**17**;4 JAN 94
"RTN","PSGWCAD3",3,0)
START ;Locate all non-pharmacy items in Drug file
"RTN","PSGWCAD3",4,0)
 K APP,AOU,ERR3 S (AOUCNT,DRGCNT)=0
"RTN","PSGWCAD3",5,0)
 S APP="" F JJ=0:0 S APP=$O(^PSDRUG("IU",APP)) Q:APP=""  I APP'["O"&(APP'["U")&(APP'["I")&(APP'["N")&(APP'["X") F DRG=0:0 S DRG=$O(^PSDRUG("IU",APP,DRG)) Q:'DRG  S APP(DRG)=""
"RTN","PSGWCAD3",6,0)
 Q
"RTN","PSGWCAD3",7,0)
AOU ;Check AOUs for non-pharmacy items
"RTN","PSGWCAD3",8,0)
 G:'$O(APP(0)) QUIT F AOU=0:0 S AOU=$O(^PSI(58.1,AOU)) Q:'AOU  I $S('$D(^PSI(58.1,AOU,"I")):1,'^("I"):1,^("I")>DT:1,1:0) S AOU(AOU)=""
"RTN","PSGWCAD3",9,0)
 G:'$O(AOU(0)) QUIT F AOU=0:0 S AOU=$O(AOU(AOU)) Q:'AOU  F ITM=0:0 S ITM=$O(^PSI(58.1,AOU,1,ITM)) Q:'ITM  S ITMNUM=$P(^PSI(58.1,AOU,1,ITM,0),"^") I $D(APP(ITMNUM)) D CHK
"RTN","PSGWCAD3",10,0)
 I $D(ERR3) D MAIL
"RTN","PSGWCAD3",11,0)
QUIT K %,%H,%I,AOU,AOUCNT,APP,CNT,DRG,DRGCNT,ERR3,I,INACT,ITM,ITMNUM,J,JJ,K,NUM,PRT1,PRT2,PRT3,PSGWDUZ,RDT,X,XMDUZ,XMKK,XMLOCK,XMR,XMSUB,XMT,XMTEXT,XMY,XMZ,Y,^TMP("PSGWMSG",$J) Q
"RTN","PSGWCAD3",12,0)
CHK ;Check non-pharmacy items for inactivation date in AOU
"RTN","PSGWCAD3",13,0)
 ;ERR3(ITMNUM,AOU)=""
"RTN","PSGWCAD3",14,0)
 S INACT=$P(^PSI(58.1,AOU,1,ITM,0),"^",3) I $S('INACT:1,INACT>DT:1,1:0) S ERR3(ITMNUM,AOU)=""
"RTN","PSGWCAD3",15,0)
 Q
"RTN","PSGWCAD3",16,0)
MAIL ;Send message for non-pharmacy items found in AOUs
"RTN","PSGWCAD3",17,0)
 Q:'$O(ERR3(0))  S NUM=6,CNT=0 F JJ=0:0 S JJ=$O(ERR3(JJ)) Q:'JJ  S DRGCNT=DRGCNT+1 F KK=0:0 S KK=$O(ERR3(JJ,KK)) Q:'KK  S AOUCNT=AOUCNT+1
"RTN","PSGWCAD3",18,0)
 K XMY,^TMP("PSGWMSG",$J) D NOW^%DTC S Y=X X ^DD("DD") S RDT=Y
"RTN","PSGWCAD3",19,0)
 F PSGWDUZ=0:0 S PSGWDUZ=$O(^XUSEC("PSGWMGR",PSGWDUZ)) Q:'PSGWDUZ  S XMY(PSGWDUZ)=""
"RTN","PSGWCAD3",20,0)
 I '$D(XMY) F PSGWDUZ=0:0 S PSGWDUZ=$O(^XUSEC("PSGW PARAM",PSGWDUZ)) Q:'PSGWDUZ  S XMY(PSGWDUZ)=""
"RTN","PSGWCAD3",21,0)
 S:'$D(XMY) XMY(.5)="" S PRT1=$S(AOUCNT>1:"AOUs",1:"AOU"),PRT2=$S(DRGCNT>1:"items",1:"item"),$P(PRT3,"-",78)=""
"RTN","PSGWCAD3",22,0)
 S ^TMP("PSGWMSG",$J,1,0)="On "_RDT_", the nightly job to update the AR/WS AMIS Stats file (#58.5)"
"RTN","PSGWCAD3",23,0)
 S ^TMP("PSGWMSG",$J,2,0)="identified the following "_PRT2_" in the following "_PRT1_" that "_$S(DRGCNT>1:"have",1:"has")_" been marked"
"RTN","PSGWCAD3",24,0)
 S ^TMP("PSGWMSG",$J,3,0)="in the Drug file (#50) for NON-PHARMACY use.",^TMP("PSGWMSG",$J,4,0)=""
"RTN","PSGWCAD3",25,0)
 S ^TMP("PSGWMSG",$J,5,0)="ITEM           AOU",^TMP("PSGWMSG",$J,6,0)=PRT3
"RTN","PSGWCAD3",26,0)
 F DRG=0:0 S DRG=$O(ERR3(DRG)) Q:'DRG  S NUM=NUM+1,CNT=CNT+1 S ^TMP("PSGWMSG",$J,NUM,0)=CNT_"."_" "_$P(^PSDRUG(DRG,0),"^") F AOU=0:0 S AOU=$O(ERR3(DRG,AOU)) Q:'AOU  D SET
"RTN","PSGWCAD3",27,0)
 S NUM=NUM+1,^TMP("PSGWMSG",$J,NUM,0)="",NUM=NUM+1,^TMP("PSGWMSG",$J,NUM,0)="It will be necessary to either inactivate "_$S(DRGCNT>1:"these ",1:"this ")_PRT2_" in the "_PRT1_" or mark"
"RTN","PSGWCAD3",28,0)
 S NUM=NUM+1,^TMP("PSGWMSG",$J,NUM,0)="the "_PRT2_" for PHARMACY use in the Drug file.  For further explanation, please"
"RTN","PSGWCAD3",29,0)
 S NUM=NUM+1,^TMP("PSGWMSG",$J,NUM,0)="refer to item #7 ([PSGW UPDATE AMIS STATS]) under the Supervisor's Menu in"
"RTN","PSGWCAD3",30,0)
 S NUM=NUM+1,^TMP("PSGWMSG",$J,NUM,0)="the AR/WS version 2.2 USER MANUAL."
"RTN","PSGWCAD3",31,0)
 S XMSUB="NON-PHARMACY ITEMS FOUND",XMDUZ="INPATIENT PHARMACY AR/WS",XMTEXT="^TMP(""PSGWMSG"",$J," D ^XMD
"RTN","PSGWCAD3",32,0)
 Q
"RTN","PSGWCAD3",33,0)
SET ;
"RTN","PSGWCAD3",34,0)
 S NUM=NUM+1,^TMP("PSGWMSG",$J,NUM,0)="               "_$P(^PSI(58.1,AOU,0),"^") Q
"RTN","PSGWOD2")
0^1^B3426599
"RTN","PSGWOD2",1,0)
PSGWOD2 ;BHAM ISC/MPH,PTD,CML-Enter an On-Demand Request (for Pharmacy Use) - CONTINUED ; 16 Apr 93 / 7:38 AM
"RTN","PSGWOD2",2,0)
 ;;2.3; Automatic Replenishment/Ward Stock ;**17**;4 JAN 94
"RTN","PSGWOD2",3,0)
DIENEW S PSGWD=$S('$D(^PSI(58.1,AOU,2,0)):0,$P(^PSI(58.1,AOU,2,0),"^",3)'="":$P(^PSI(58.1,AOU,2,$P(^PSI(58.1,AOU,2,0),"^",3),0),"^",1),1:0)
"RTN","PSGWOD2",4,0)
 S DR="1///0;30///TODAY;31///O;33///ONE TIME REQ.;16///"_PSGWODT
"RTN","PSGWOD2",5,0)
 ;I %=2 S DR(2,58.11)="1;10;3;5//^S X=$S(PSGWD'=0:$P(^DIC(42,PSGWD,0),""^"",1),1:"""");30;I X="""" S Y=16;31//O;I X'=""O"" S Y=16;33//ON-DEMAND REQ.;16///"_PSGWODT
"RTN","PSGWOD2",6,0)
 S DR(2,58.13)=".01"
"RTN","PSGWOD2",7,0)
 S DR(2,58.28)="S OLD=$P(^PSI(58.1,AOU,1,DA(1),5,DA,0),""^"",2);1;S QD=X-OLD;2////"_DUZ
"RTN","PSGWOD2",8,0)
 Q
"RTN","PSGWOD2",9,0)
 ;
"RTN","PSGWOD2",10,0)
SCR ;This subroutine will ONLY be called from DIC("S")
"RTN","PSGWOD2",11,0)
 S DRGDA=+^(0)
"RTN","PSGWOD2",12,0)
 I '$D(^PSDRUG(DRGDA,"I")) D SCR2 Q  ;Drug is NOT inactive in file #50 - OK
"RTN","PSGWOD2",13,0)
 I +^PSDRUG(DRGDA,"I")>DT D SCR2 Q  ;Drug is inactive in file #50 IN FUTURE - OK
"RTN","PSGWOD2",14,0)
 I '$D(^PSI(58.1,AOU,1,+Y,"I")) D SCR2 Q  ;Drug is inactive in file #50 but NOT file #58.1 - OK
"RTN","PSGWOD2",15,0)
 I +$O(^PSI(58.1,AOU,1,+Y,"I",0))>DT D SCR2 Q  ;Drug is inactive in file #50 and inactive in file #58.1 IN FUTURE - OK
"RTN","PSGWOD2",16,0)
 Q
"RTN","PSGWOD2",17,0)
SCR2 ;Check for NON-PHARMACY ITEMS
"RTN","PSGWOD2",18,0)
 I $S('$D(^PSDRUG(DRGDA,2)):1,$P(^(2),"^",3)="":1,$P(^(2),"^",3)["O":1,$P(^(2),"^",3)["U":1,$P(^(2),"^",3)["I":1,$P(^(2),"^",3)["X":1,1:$P(^(2),"^",3)["N") Q
"RTN","PSGWSTKI")
0^2^B7745197
"RTN","PSGWSTKI",1,0)
PSGWSTKI ;BHAM ISC/CML-Stock Item Enter/Edit ; 29 Dec 93 / 8:44 AM
"RTN","PSGWSTKI",2,0)
 ;;2.3; Automatic Replenishment/Ward Stock ;**17**;4 JAN 94
"RTN","PSGWSTKI",3,0)
AOU ; SELECT AOU
"RTN","PSGWSTKI",4,0)
 K DA,DIC F QQ=0:0 S DIC="^PSI(58.1,",DIC(0)="QEAMZ" W ! D ^DIC K DIC Q:Y'>0  S AOU=+Y S:'$D(^PSI(58.1,AOU,1,0)) ^(0)="^58.11IP^^" D ITEM
"RTN","PSGWSTKI",5,0)
QUIT K %,AOU,C,D0,D1,DI,DA,DQ,DR,I,ITEM,QQ,X,Y,CHK,DRGDA Q
"RTN","PSGWSTKI",6,0)
ITEM ; SELECT ITEM
"RTN","PSGWSTKI",7,0)
 F QQ=0:0 K DA S CHK=1,DA(1)=AOU,DIC="^PSI(58.1,"_AOU_",1,",DIC(0)="QEAMOLZ" D ^DIC K DIC Q:Y'>0  S ITEM=+Y D CHK I CHK S DA(1)=AOU,DA=ITEM,DIE="^PSI(58.1,"_AOU_",1,",DR="1;13;14;3;10;5",DR(2,58.13)=".01" D ^DIE K DIE W !
"RTN","PSGWSTKI",8,0)
 Q
"RTN","PSGWSTKI",9,0)
CHK ; CHECK FOR CURRENT INACTIVATION DATE
"RTN","PSGWSTKI",10,0)
 I '$D(^PSI(58.1,AOU,1,ITEM,"I")) D CHK2 Q
"RTN","PSGWSTKI",11,0)
 D CHK2 Q:'CHK
"RTN","PSGWSTKI",12,0)
 W *7,!!?5,"This Item is currently defined for this AOU with an INACTIVATION DATE.",!!?5,"If you want to add this Item as a new standard Stock Item for this AOU",!?5,"you must delete the INACTIVATION DATE.",!
"RTN","PSGWSTKI",13,0)
 S DA(1)=AOU,DA=ITEM,DIE="^PSI(58.1,"_AOU_",1,",DR=30 D ^DIE K DIE S CHK=$S($D(Y):0,$D(^PSI(58.1,AOU,1,ITEM,"I")):0,1:1) W !
"RTN","PSGWSTKI",14,0)
 Q
"RTN","PSGWSTKI",15,0)
CHK2 ; CHECK FOR NON-PHARMACY ITEMS
"RTN","PSGWSTKI",16,0)
 S DRGDA=+^PSI(58.1,AOU,1,ITEM,0)
"RTN","PSGWSTKI",17,0)
 S CHK=$S('$D(^PSDRUG(DRGDA,2)):1,$P(^(2),"^",3)="":1,$P(^(2),"^",3)["O":1,$P(^(2),"^",3)["U":1,$P(^(2),"^",3)["I":1,$P(^(2),"^",3)["X":1,1:$P(^(2),"^",3)["N") Q:CHK
"RTN","PSGWSTKI",18,0)
 I '$D(^PSI(58.1,AOU,1,ITEM,"I")) S DA(1)=AOU,DA=ITEM,DIE="^PSI(58.1,"_AOU_",1,",DR=30_"///"_DT D ^DIE K DIE
"RTN","PSGWSTKI",19,0)
 W *7,!!?5,"This item is currently defined for this AOU but appears to be a",!?5,"non-pharmacy drug.  It has been inactivated as of " S Y=$O(^PSI(58.1,AOU,1,ITEM,"I",0)) X ^DD("DD") W Y,!
"RTN","PSGWSTKI",20,0)
 Q
"RTN","PSGWUTL")
0^3^B22112870
"RTN","PSGWUTL",1,0)
PSGWUTL ;BHAM ISC/CML,KKA-Utility routine for FileMan functions ; 06 Dec 93 / 2:23 PM
"RTN","PSGWUTL",2,0)
 ;;2.3; Automatic Replenishment/Ward Stock ;**17**;4 JAN 94
"RTN","PSGWUTL",3,0)
OND ;Check quantities for On-Demands/Returns
"RTN","PSGWUTL",4,0)
 Q:'$D(^PSI(58.1,DA(2),1,DA(1),0))  Q:'$P(^(0),"^",2)  I X'>(2*$P(^(0),"^",2)) Q
"RTN","PSGWUTL",5,0)
 W *7,!!,"This quantity seems too high!  The normal Stock Level for this item is ",$P(^PSI(58.1,DA(2),1,DA(1),0),"^",2)
"RTN","PSGWUTL",6,0)
ASK W !?5,"Are you sure of this amount " S %=2 D YN^DICN I %=1 K %,%Y Q
"RTN","PSGWUTL",7,0)
 I %=0!(%=-1) W "    Enter 'YES' or 'NO'" G ASK
"RTN","PSGWUTL",8,0)
 K X,%,%Y Q
"RTN","PSGWUTL",9,0)
QUIT K %,%Y,ADT,AOU,LP,II,ITM Q
"RTN","PSGWUTL",10,0)
 ;SUBROUTINES FOR AMIS XREFS
"RTN","PSGWUTL",11,0)
QD ;SET "AMIS" XREF FOR QTY DISPENSED
"RTN","PSGWUTL",12,0)
 Q:$D(PSGWV)  I X'=0,$P(^PSI(58.1,DA(2),0),"^",3)'=1,$P(^(1,DA(1),1,DA,0),"^",4)'=1 Q:'$D(^PSI(58.19,DA))  S ADT=$P(^(DA,0),"^"),AOU=DA(2),ITM=$P(^PSI(58.1,DA(2),1,DA(1),0),"^"),^PSI(58.5,"AMIS",$H,ADT,"A",AOU,ITM,X)=""
"RTN","PSGWUTL",13,0)
 G QUIT
"RTN","PSGWUTL",14,0)
KQD ;KILL "AMIS" XREF FOR QTY DISPENSED
"RTN","PSGWUTL",15,0)
 Q:$D(PSGWV)  Q:'$D(^PSI(58.19,DA))  S ADT=$P(^(DA,0),"^"),AOU=DA(2),ITM=$P(^PSI(58.1,AOU,1,DA(1),0),"^"),LP="" F II=0:0 S LP=$O(^PSI(58.5,"AMIS",LP)) Q:'LP  I $D(^PSI(58.5,"AMIS",LP,ADT,"A",AOU,ITM)) K ^(ITM)
"RTN","PSGWUTL",16,0)
 G QUIT
"RTN","PSGWUTL",17,0)
OD ;SET "AMIS" XREF FOR ON-DEMAND REQUEST
"RTN","PSGWUTL",18,0)
 Q:$D(PSGWV)  I X'=0,$P(^PSI(58.1,DA(2),0),"^",3)'=1,$P(^(1,DA(1),5,DA,0),"^",4)'=1 S ADT=$P(^(0),"^"),AOU=DA(2),ITM=$P(^PSI(58.1,DA(2),1,DA(1),0),"^"),^PSI(58.5,"AMIS",$H,ADT,"W",AOU,ITM,X)=""
"RTN","PSGWUTL",19,0)
 G QUIT
"RTN","PSGWUTL",20,0)
KOD ;KILL "AMIS" XREF FOR ON-DEMAND REQUEST
"RTN","PSGWUTL",21,0)
 Q:$D(PSGWV)  S ADT=$P(^PSI(58.1,DA(2),1,DA(1),5,DA,0),"^"),AOU=DA(2),ITM=$P(^PSI(58.1,AOU,1,DA(1),0),"^"),LP="" F II=0:0 S LP=$O(^PSI(58.5,"AMIS",LP)) Q:'LP  I $D(^PSI(58.5,"AMIS",LP,ADT,"W",AOU,ITM)) K ^(ITM)
"RTN","PSGWUTL",22,0)
 G QUIT
"RTN","PSGWUTL",23,0)
RET ;SET "AMIS" XREF FOR RETURNS
"RTN","PSGWUTL",24,0)
 Q:$D(PSGWV)  I X'=0,$P(^PSI(58.1,DA(2),0),"^",3)'=1,$P(^(1,DA(1),3,DA,0),"^",4)'=1 S ADT=DA,AOU=DA(2),ITM=$P(^PSI(58.1,DA(2),1,DA(1),0),"^"),^PSI(58.5,"AMIS",$H,ADT,"R",AOU,ITM,X)=""
"RTN","PSGWUTL",25,0)
 G QUIT
"RTN","PSGWUTL",26,0)
KRET ;KILL "AMIS" XREF FOR RETURNS
"RTN","PSGWUTL",27,0)
 Q:$D(PSGWV)  S ADT=DA,AOU=DA(2),ITM=$P(^PSI(58.1,AOU,1,DA(1),0),"^"),LP="" F II=0:0 S LP=$O(^PSI(58.5,"AMIS",LP)) Q:'LP  I $D(^PSI(58.5,"AMIS",LP,ADT,"R",AOU,ITM)) K ^(ITM)
"RTN","PSGWUTL",28,0)
 G QUIT
"RTN","PSGWUTL",29,0)
QDERR ;SET "AMISERR" XREF ON QTY DISPENSED
"RTN","PSGWUTL",30,0)
 Q:$D(PSGWV)  I $D(^PSI(58.1,DA(2),"SITE")),^("SITE")]"" Q
"RTN","PSGWUTL",31,0)
 I X'=0,$P(^PSI(58.1,DA(2),0),"^",3)'=1,$P(^(1,DA(1),1,DA,0),"^",4)'=1 Q:'$D(^PSI(58.19,DA))  S ADT=$P(^(DA,0),"^"),AOU=DA(2),ITM=$P(^PSI(58.1,DA(2),1,DA(1),0),"^"),^PSI(58.5,"AMISERR",AOU,$H,ADT,"A",ITM,X)=""
"RTN","PSGWUTL",32,0)
 G QUIT
"RTN","PSGWUTL",33,0)
KQDERR ;KILL "AMISERR" XREF ON QTY DISPENSED
"RTN","PSGWUTL",34,0)
 Q:$D(PSGWV)  Q:'$D(^PSI(58.19,DA))  S ADT=$P(^(DA,0),"^"),AOU=DA(2),ITM=$P(^PSI(58.1,DA(2),1,DA(1),0),"^"),LP=""
"RTN","PSGWUTL",35,0)
 F II=0:0 S LP=$O(^PSI(58.5,"AMISERR",AOU,LP)) Q:'LP  I $D(^PSI(58.5,"AMISERR",AOU,LP,ADT,"A",ITM)) K ^(ITM)
"RTN","PSGWUTL",36,0)
 G QUIT
"RTN","PSGWUTL",37,0)
ODERR ;SET "AMISERR" XREF ON ON-DEMANDS
"RTN","PSGWUTL",38,0)
 Q:$D(PSGWV)  I $D(^PSI(58.1,DA(2),"SITE")),^("SITE")]"" Q
"RTN","PSGWUTL",39,0)
 I X'=0,$P(^PSI(58.1,DA(2),0),"^",3)'=1,$P(^(1,DA(1),5,DA,0),"^",4)'=1 S ADT=$P(^(0),"^"),AOU=DA(2),ITM=$P(^PSI(58.1,DA(2),1,DA(1),0),"^"),^PSI(58.5,"AMISERR",AOU,$H,ADT,"W",ITM,X)=""
"RTN","PSGWUTL",40,0)
 G QUIT
"RTN","PSGWUTL",41,0)
KODERR ;KILL "AMISERR" XREF ON ON-DEMANDS
"RTN","PSGWUTL",42,0)
 Q:$D(PSGWV)  S ADT=$P(^PSI(58.1,DA(2),1,DA(1),5,DA,0),"^"),AOU=DA(2),ITM=$P(^PSI(58.1,DA(2),1,DA(1),0),"^"),LP=""
"RTN","PSGWUTL",43,0)
 F II=0:0 S LP=$O(^PSI(58.5,"AMISERR",AOU,LP)) Q:'LP  I $D(^PSI(58.5,"AMISERR",AOU,LP,ADT,"A",ITM)) K ^(ITM)
"RTN","PSGWUTL",44,0)
 G QUIT
"RTN","PSGWUTL",45,0)
RETERR ;SET "AMISERR" XREF ON RETURNS
"RTN","PSGWUTL",46,0)
 Q:$D(PSGWV)  I $D(^PSI(58.1,DA(2),"SITE")),^("SITE")]"" Q
"RTN","PSGWUTL",47,0)
 I X'=0,$P(^PSI(58.1,DA(2),0),"^",3)'=1,$P(^(1,DA(1),3,DA,0),"^",4)'=1 S ADT=DA,AOU=DA(2),ITM=$P(^PSI(58.1,DA(2),1,DA(1),0),"^"),^PSI(58.5,"AMISERR",AOU,$H,ADT,"R",ITM,X)=""
"RTN","PSGWUTL",48,0)
 G QUIT
"RTN","PSGWUTL",49,0)
KRETERR ;KILL "AMISERR" XREF ON RETURNS
"RTN","PSGWUTL",50,0)
 Q:$D(PSGWV)  S ADT=DA,AOU=DA(2),ITM=$P(^PSI(58.1,DA(2),1,DA(1),0),"^"),LP=""
"RTN","PSGWUTL",51,0)
 F II=0:0 S LP=$O(^PSI(58.5,"AMISERR",AOU,LP)) Q:'LP  I $D(^PSI(58.5,"AMISERR",AOU,LP,ADT,"A",ITM)) K ^(ITM)
"RTN","PSGWUTL",52,0)
 G QUIT
"RTN","PSGWUTL",53,0)
INACT ;CHECK FOR INACTIVE DATE ON ITEM FOR "D" XREF (FILE 58.1)
"RTN","PSGWUTL",54,0)
 K PSGWFLG I '$D(^PSI(58.1,DA(2),1,DA(1),"I")) S PSGWFLG=1 Q
"RTN","PSGWUTL",55,0)
 S:$O(^PSI(58.1,DA(2),1,DA(1),"I"))>DT PSGWFLG=1 Q
"RTN","PSGWUTL",56,0)
DRGSCRN ;SCREEN DRUG FILE DRUGS FOR AR/WS FOR ^DD(58.11,.01,0) AND ^DD(58.11,.01,12.1)
"RTN","PSGWUTL",57,0)
 ; naked indicator set within VA FileMan in file 58.11
"RTN","PSGWUTL",58,0)
 ; this code is called as part of the input transform
"RTN","PSGWUTL",59,0)
 I $S('$D(^("I")):1,+^("I")>DT:1,1:0) S APU=$P($G(^(2)),"^",3) I $S(APU="":1,APU["O":1,APU["U":1,APU["I":1,APU["X":1,1:APU["N")
"RTN","PSGWUTL",60,0)
 K APU Q
"RTN","PSGWUTL",61,0)
DRGSCRN2 ;
"RTN","PSGWUTL",62,0)
 S DIC("S")="I $S('$D(^(""I"")):1,+^(""I"")>DT:1,1:0) S APU=$P($G(^(2)),""^"",3) I $S(APU="""":1,APU[""O"":1,APU[""U"":1,APU[""I"":1,APU[""X"":1,1:APU[""N"")"
"RTN","PSGWUTL",63,0)
 D ^DIC K DIC S DIC=DIE,X=+Y
"RTN","PSGWUTL",64,0)
 I Y<0 W !,"Enter name of drug being stocked in this AOU." K X
"RTN","PSGWUTL",65,0)
 K APU Q
"RTN","PSGWUTL",66,0)
EDCHK ;
"RTN","PSGWUTL",67,0)
 I $O(^PSI(58.1,D0,1,+$G(D1),0)) S Y=-1 K X W !,"  NO EDITING -- This item has activity.           "
"RTN","PSGWUTL",68,0)
 Q
"VER")
8.0^22.0
**END**
**END**
