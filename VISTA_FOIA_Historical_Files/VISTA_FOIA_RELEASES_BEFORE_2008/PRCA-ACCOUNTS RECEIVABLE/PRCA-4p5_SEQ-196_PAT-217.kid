Released PRCA*4.5*217 SEQ #196
Extracted from mail message
**KIDS**:PRCA*4.5*217^

**INSTALL NAME**
PRCA*4.5*217
"BLD",5618,0)
PRCA*4.5*217^ACCOUNTS RECEIVABLE^0^3041004^y
"BLD",5618,1,0)
^^9^9^3040921^
"BLD",5618,1,1,0)
This patch addresses 2 issues.
"BLD",5618,1,2,0)
  
"BLD",5618,1,3,0)
The first issue is regarding the Customizing option under the Agent Cashier
"BLD",5618,1,4,0)
Receipt Processing Option that was losing the customization features when
"BLD",5618,1,5,0)
a user was at site running a multi-node system.
"BLD",5618,1,6,0)
 
"BLD",5618,1,7,0)
The second issue is regarding a subscript error occurred at line
"BLD",5618,1,8,0)
EN+14^RCCPCBJ when there is no any AR CCPC statement available for
"BLD",5618,1,9,0)
transmission.
"BLD",5618,4,0)
^9.64PA^342.3^1
"BLD",5618,4,342.3,0)
342.3
"BLD",5618,4,342.3,222)
y^y^f^^^^n
"BLD",5618,4,"B",342.3,342.3)

"BLD",5618,"ABPKG")

"BLD",5618,"INIT")
EN^PRCAI217
"BLD",5618,"KRN",0)
^9.67PA^8989.52^19
"BLD",5618,"KRN",.4,0)
.4
"BLD",5618,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5618,"KRN",.401,0)
.401
"BLD",5618,"KRN",.402,0)
.402
"BLD",5618,"KRN",.403,0)
.403
"BLD",5618,"KRN",.5,0)
.5
"BLD",5618,"KRN",.84,0)
.84
"BLD",5618,"KRN",3.6,0)
3.6
"BLD",5618,"KRN",3.8,0)
3.8
"BLD",5618,"KRN",9.2,0)
9.2
"BLD",5618,"KRN",9.8,0)
9.8
"BLD",5618,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",5618,"KRN",9.8,"NM",1,0)
RCCPCBJ^^0^B5932316
"BLD",5618,"KRN",9.8,"NM",2,0)
RCDPRPLM^^0^B81841710
"BLD",5618,"KRN",9.8,"NM",3,0)
RCDPURE1^^0^B55071399
"BLD",5618,"KRN",9.8,"NM",4,0)
RCDPRPL2^^0^B68740543
"BLD",5618,"KRN",9.8,"NM",5,0)
RCDPRECT^^0^B17904044
"BLD",5618,"KRN",9.8,"NM","B","RCCPCBJ",1)

"BLD",5618,"KRN",9.8,"NM","B","RCDPRECT",5)

"BLD",5618,"KRN",9.8,"NM","B","RCDPRPL2",4)

"BLD",5618,"KRN",9.8,"NM","B","RCDPRPLM",2)

"BLD",5618,"KRN",9.8,"NM","B","RCDPURE1",3)

"BLD",5618,"KRN",19,0)
19
"BLD",5618,"KRN",19,"NM",0)
^9.68A^^
"BLD",5618,"KRN",19.1,0)
19.1
"BLD",5618,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5618,"KRN",101,0)
101
"BLD",5618,"KRN",101,"NM",0)
^9.68A^^
"BLD",5618,"KRN",409.61,0)
409.61
"BLD",5618,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",5618,"KRN",771,0)
771
"BLD",5618,"KRN",771,"NM",0)
^9.68A^^
"BLD",5618,"KRN",870,0)
870
"BLD",5618,"KRN",870,"NM",0)
^9.68A^^
"BLD",5618,"KRN",8989.51,0)
8989.51
"BLD",5618,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",5618,"KRN",8989.52,0)
8989.52
"BLD",5618,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",5618,"KRN",8994,0)
8994
"BLD",5618,"KRN",8994,"NM",0)
^9.68A^^
"BLD",5618,"KRN","B",.4,.4)

"BLD",5618,"KRN","B",.401,.401)

"BLD",5618,"KRN","B",.402,.402)

"BLD",5618,"KRN","B",.403,.403)

"BLD",5618,"KRN","B",.5,.5)

"BLD",5618,"KRN","B",.84,.84)

"BLD",5618,"KRN","B",3.6,3.6)

"BLD",5618,"KRN","B",3.8,3.8)

"BLD",5618,"KRN","B",9.2,9.2)

"BLD",5618,"KRN","B",9.8,9.8)

"BLD",5618,"KRN","B",19,19)

"BLD",5618,"KRN","B",19.1,19.1)

"BLD",5618,"KRN","B",101,101)

"BLD",5618,"KRN","B",409.61,409.61)

"BLD",5618,"KRN","B",771,771)

"BLD",5618,"KRN","B",870,870)

"BLD",5618,"KRN","B",8989.51,8989.51)

"BLD",5618,"KRN","B",8989.52,8989.52)

"BLD",5618,"KRN","B",8994,8994)

"BLD",5618,"PRE")

"BLD",5618,"QUES",0)
^9.62^^
"BLD",5618,"REQB",0)
^9.611^4^3
"BLD",5618,"REQB",1,0)
PRCA*4.5*214^2
"BLD",5618,"REQB",3,0)
PRCA*4.5*195^2
"BLD",5618,"REQB",4,0)
PRCA*4.5*220^2
"BLD",5618,"REQB","B","PRCA*4.5*195",3)

"BLD",5618,"REQB","B","PRCA*4.5*214",1)

"BLD",5618,"REQB","B","PRCA*4.5*220",4)

"FIA",342.3)
AR USER CUSTOMIZE
"FIA",342.3,0)
^RC(342.3,
"FIA",342.3,0,0)
342.3
"FIA",342.3,0,1)
y^y^f^^^^n
"FIA",342.3,0,10)

"FIA",342.3,0,11)

"FIA",342.3,0,"RLRO")

"FIA",342.3,0,"VR")
4.5^PRCA
"FIA",342.3,342.3)
0
"FIA",342.3,342.31)
0
"INIT")
EN^PRCAI217
"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
217^3041004^2447
"PKG",142,22,1,"PAH",1,1,0)
^^9^9^3041004
"PKG",142,22,1,"PAH",1,1,1,0)
This patch addresses 2 issues.
"PKG",142,22,1,"PAH",1,1,2,0)
  
"PKG",142,22,1,"PAH",1,1,3,0)
The first issue is regarding the Customizing option under the Agent Cashier
"PKG",142,22,1,"PAH",1,1,4,0)
Receipt Processing Option that was losing the customization features when
"PKG",142,22,1,"PAH",1,1,5,0)
a user was at site running a multi-node system.
"PKG",142,22,1,"PAH",1,1,6,0)
 
"PKG",142,22,1,"PAH",1,1,7,0)
The second issue is regarding a subscript error occurred at line
"PKG",142,22,1,"PAH",1,1,8,0)
EN+14^RCCPCBJ when there is no any AR CCPC statement available for
"PKG",142,22,1,"PAH",1,1,9,0)
transmission.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PRCAI217")
0^^B3948769
"RTN","PRCAI217",1,0)
PRCAI217 ;ALB/CXW - PRCA*4.5*217 POST-INIT ROUTINE
"RTN","PRCAI217",2,0)
 ;;4.5;Accounts Receivable;**217**;Mar 20, 1995
"RTN","PRCAI217",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAI217",4,0)
 Q
"RTN","PRCAI217",5,0)
EN ;convert the data stored in the global DISV(DUZ,"RCDPRPLM") file to the 
"RTN","PRCAI217",6,0)
 ;AR USER CUSTOMIZE file (#342.3).
"RTN","PRCAI217",7,0)
 ;^RC(342.3,da,0)=screen/options
"RTN","PRCAI217",8,0)
 ;^RC(342.3,da,1,da(1),0)=duz^selection^device
"RTN","PRCAI217",9,0)
 ;
"RTN","PRCAI217",10,0)
 N RCDUZ,RCSNOPT,RCREC,RCSEL,RCDEV,U,DA,X,DIC,DIE,DR
"RTN","PRCAI217",11,0)
 W !
"RTN","PRCAI217",12,0)
 W "PRCA*4.5*217 Post Install......",!
"RTN","PRCAI217",13,0)
 W "Converting the data stored in the ^DISV(DUZ,""RCDPRPLM"") global to",!
"RTN","PRCAI217",14,0)
 W "the AR USER CUSTOMIZE file (#342.3)."
"RTN","PRCAI217",15,0)
 S RCDUZ=0,U="^"
"RTN","PRCAI217",16,0)
 F  S RCDUZ=$O(^DISV(RCDUZ)) Q:'RCDUZ  I $D(^DISV(RCDUZ,"RCDPRPLM")) D
"RTN","PRCAI217",17,0)
 .S RCSNOPT=""
"RTN","PRCAI217",18,0)
 .L +^DISV(RCDUZ,"RCDPRPLM"):5
"RTN","PRCAI217",19,0)
 .F  S RCSNOPT=$O(^DISV(RCDUZ,"RCDPRPLM",RCSNOPT)) Q:RCSNOPT=""  D
"RTN","PRCAI217",20,0)
 ..S RCREC=$G(^DISV(RCDUZ,"RCDPRPLM",RCSNOPT))
"RTN","PRCAI217",21,0)
 ..I '$D(^RC(342.3,"B",RCSNOPT)) D
"RTN","PRCAI217",22,0)
 ...K DD,DO,DIC("DR") S DIC="^RC(342.3,",DIC(0)="",X=RCSNOPT
"RTN","PRCAI217",23,0)
 ...D FILE^DICN
"RTN","PRCAI217",24,0)
 ..S RCSEL=$S(RCSNOPT="215REPORT":"",1:$P(RCREC,U))
"RTN","PRCAI217",25,0)
 ..S RCDEV=$S(RCSNOPT="RECEIPT":$P(RCREC,U,2),RCSNOPT="215REPORT":$P(RCREC,U),1:"")
"RTN","PRCAI217",26,0)
 ..S DA(1)=$O(^RC(342.3,"B",RCSNOPT,0))
"RTN","PRCAI217",27,0)
 ..;if new then add entry
"RTN","PRCAI217",28,0)
 ..I '$D(^RC(342.3,DA(1),1,"B",RCDUZ)) D  Q
"RTN","PRCAI217",29,0)
 ...S DIC(0)="",DIC("P")=$P(^DD(342.3,1,0),U,2)
"RTN","PRCAI217",30,0)
 ...S DIC="^RC(342.3,"_DA(1)_",1,"
"RTN","PRCAI217",31,0)
 ...S X=RCDUZ
"RTN","PRCAI217",32,0)
 ...S DIC("DR")="1////"_RCSEL_";2////"_RCDEV
"RTN","PRCAI217",33,0)
 ...K DD,DO D FILE^DICN
"RTN","PRCAI217",34,0)
 ...;
"RTN","PRCAI217",35,0)
 ..;if existing then edit entry
"RTN","PRCAI217",36,0)
 ..S DA=$O(^RC(342.3,DA(1),1,"B",RCDUZ,0)),DR=".01////"_RCDUZ_";1////"_RCSEL_";2////"_RCDEV
"RTN","PRCAI217",37,0)
 ..S DIE="^RC(342.3,"_DA(1)_",1," D ^DIE
"RTN","PRCAI217",38,0)
 .W "."
"RTN","PRCAI217",39,0)
 .L -^DISV(RCDUZ,"RCDPRPLM")
"RTN","PRCAI217",40,0)
 W "Done!"
"RTN","PRCAI217",41,0)
 Q
"RTN","RCCPCBJ")
0^1^B5932316
"RTN","RCCPCBJ",1,0)
RCCPCBJ ;WASH-ISC@ALTOONA,PA/NYB-Background Driver for CCPC ;1/7/97  9:42 AM
"RTN","RCCPCBJ",2,0)
 ;;4.5;Accounts Receivable;**34,76,130,153,166,195,217**;Mar 20, 1995
"RTN","RCCPCBJ",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCCPCBJ",4,0)
EN ;Starts the background job for CCPC 5 days before statement day
"RTN","RCCPCBJ",5,0)
 N X,X1,X2,X3,ZTRTN,ZTIO,ZTDTH,ZTSK,ZTDESC
"RTN","RCCPCBJ",6,0)
 D ACK
"RTN","RCCPCBJ",7,0)
 S X1=$$STD^RCCPCFN,X2=-2 D C^%DTC
"RTN","RCCPCBJ",8,0)
 ;10-process end time/18-ccpc file built
"RTN","RCCPCBJ",9,0)
 I X=DT D  Q
"RTN","RCCPCBJ",10,0)
 . S X3=$O(^RCPS(349.2,0)) Q:'X3
"RTN","RCCPCBJ",11,0)
 . Q:'$P($P($G(^RCPS(349.2,X3,0)),"^",10),".")
"RTN","RCCPCBJ",12,0)
 . Q:'$P($G(^RCPS(349.2,X3,0)),"^",18)
"RTN","RCCPCBJ",13,0)
 . D EN^RCCPCML
"RTN","RCCPCBJ",14,0)
 ;quit if date created is yesterday's date
"RTN","RCCPCBJ",15,0)
 S X1=$$STD^RCCPCFN,X2=-1 D C^%DTC
"RTN","RCCPCBJ",16,0)
 I X=DT D  Q
"RTN","RCCPCBJ",17,0)
 . S X3=+$O(^RCT(349,0))
"RTN","RCCPCBJ",18,0)
 . S X3=$P($P($G(^RCT(349,X3,0)),"^",11),".")
"RTN","RCCPCBJ",19,0)
 . S X1=DT,X2=-1 D C^%DTC
"RTN","RCCPCBJ",20,0)
 . I X=X3 Q
"RTN","RCCPCBJ",21,0)
 . D EN^RCCPCML
"RTN","RCCPCBJ",22,0)
 ;
"RTN","RCCPCBJ",23,0)
 S X1=$$STD^RCCPCFN,X2=-3 D C^%DTC
"RTN","RCCPCBJ",24,0)
 I X'=DT Q
"RTN","RCCPCBJ",25,0)
 S ZTIO="",ZTRTN="OPEN^RCCPCBJ",ZTDESC="CCPC PATIENT STATEMENT"
"RTN","RCCPCBJ",26,0)
 S ZTDTH=$H D ^%ZTLOAD
"RTN","RCCPCBJ",27,0)
 Q
"RTN","RCCPCBJ",28,0)
OPEN ;Update Open status bills to Active or Cancellation status
"RTN","RCCPCBJ",29,0)
 N DAY,BN,DEBTOR,DA,DIE,DR,P,AMT
"RTN","RCCPCBJ",30,0)
 N ZTSAVE,ZTRTN,ZTDESC,ZTASK,%ZIS,ZTDTH
"RTN","RCCPCBJ",31,0)
 S DATE=$$STD^RCCPCFN,DAY=+$$STDY^RCCPCFN,DEBTOR=0 F  S DEBTOR=$O(^RCD(340,"AC",DAY,DEBTOR)) Q:'DEBTOR  D
"RTN","RCCPCBJ",32,0)
    .S BN=0 F  S BN=$O(^PRCA(430,"AS",DEBTOR,$O(^PRCA(430.3,"AC",112,0)),BN)) Q:'BN  D
"RTN","RCCPCBJ",33,0)
       ..S AMT=0 F P=1:1:5 S AMT=$P($G(^PRCA(430,+BN,7)),"^",P)+AMT
"RTN","RCCPCBJ",34,0)
       ..I $P($G(^PRCA(430,+BN,0)),"^",2)=$O(^PRCA(430.2,"AC",33,0)),AMT Q
"RTN","RCCPCBJ",35,0)
       ..S DIE="^PRCA(430,",DA=+BN,DR="8////^S X="_$S(AMT:$O(^PRCA(430.3,"AC",102,0)),1:$O(^PRCA(430.3,"AC",111,0))) D ^DIE K DA,DIE,DR
"RTN","RCCPCBJ",36,0)
       ..Q
"RTN","RCCPCBJ",37,0)
    .Q
"RTN","RCCPCBJ",38,0)
 ;
"RTN","RCCPCBJ",39,0)
 ;  update patient accounts with interest and admin
"RTN","RCCPCBJ",40,0)
 N RCLASDAT
"RTN","RCCPCBJ",41,0)
 S RCLASDAT=DATE
"RTN","RCCPCBJ",42,0)
 I DT>3010101 D FIRSTPTY^RCBECHGS
"RTN","RCCPCBJ",43,0)
 D ^RCCPCPS
"RTN","RCCPCBJ",44,0)
 D REFUND
"RTN","RCCPCBJ",45,0)
 Q
"RTN","RCCPCBJ",46,0)
 ;
"RTN","RCCPCBJ",47,0)
 ;
"RTN","RCCPCBJ",48,0)
REFUND ;Update Open status PREPAYMENT bills to REFUND REVIEW
"RTN","RCCPCBJ",49,0)
 S DEBTOR=0,DAY=+$$STDY^RCCPCFN
"RTN","RCCPCBJ",50,0)
 F  S DEBTOR=$O(^RCD(340,"AC",DAY,DEBTOR)) Q:'DEBTOR  D
"RTN","RCCPCBJ",51,0)
    .S BN=0 F  S BN=$O(^PRCA(430,"AS",DEBTOR,$O(^PRCA(430.3,"AC",112,0)),BN)) Q:'BN  D
"RTN","RCCPCBJ",52,0)
       ..I $P($G(^PRCA(430,+BN,0)),"^",2)=$O(^PRCA(430.2,"AC",33,0)) S X=$$EN^PRCARFU(+BN)
"RTN","RCCPCBJ",53,0)
       ..Q
"RTN","RCCPCBJ",54,0)
    .Q
"RTN","RCCPCBJ",55,0)
 Q
"RTN","RCCPCBJ",56,0)
 ;
"RTN","RCCPCBJ",57,0)
ACK ;CHECK FOR ACKNOWLEDGEMENTS
"RTN","RCCPCBJ",58,0)
 N DEB,MSG,NO,RCX,X,X1,X2
"RTN","RCCPCBJ",59,0)
 S X1=$$STD^RCCPCFN,X2=DT D ^%DTC I X>3 D
"RTN","RCCPCBJ",60,0)
 .D TRANCHK^RCCPCSV1
"RTN","RCCPCBJ",61,0)
 Q
"RTN","RCDPRECT")
0^5^B17904044
"RTN","RCDPRECT",1,0)
RCDPRECT ;WISC/RFJ-print a receipt ;1 Jun 99
"RTN","RCDPRECT",2,0)
 ;;4.5;Accounts Receivable;**114,148,217**;Mar 20, 1995
"RTN","RCDPRECT",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPRECT",4,0)
 Q
"RTN","RCDPRECT",5,0)
 ;
"RTN","RCDPRECT",6,0)
 ;
"RTN","RCDPRECT",7,0)
RECEIPT(RCRECTDA,RCTRANDA) ;  control printing of receipt for device selection
"RTN","RCDPRECT",8,0)
 N %,IOP,PRINT
"RTN","RCDPRECT",9,0)
 S PRINT=$$OPTCK^RCDPRPL2("RECEIPT",2)_"^"_$$OPTCK^RCDPRPL2("RECEIPT",3)
"RTN","RCDPRECT",10,0)
 ;  if not defined by user, ask for the device
"RTN","RCDPRECT",11,0)
 I PRINT="" S PRINT=2
"RTN","RCDPRECT",12,0)
 ;
"RTN","RCDPRECT",13,0)
 ;  never print receipt
"RTN","RCDPRECT",14,0)
 I $P(PRINT,"^")=0 Q
"RTN","RCDPRECT",15,0)
 ;
"RTN","RCDPRECT",16,0)
 ;  always print receipt to default device
"RTN","RCDPRECT",17,0)
 I $P(PRINT,"^")=1 D
"RTN","RCDPRECT",18,0)
 .   ;  test device without opening it
"RTN","RCDPRECT",19,0)
 .   S IOP=$P(PRINT,"^",2) I IOP="" S PRINT=2 Q
"RTN","RCDPRECT",20,0)
 .   S %ZIS="N"
"RTN","RCDPRECT",21,0)
 .   D ^%ZIS I POP S PRINT=2 Q
"RTN","RCDPRECT",22,0)
 .   D QUEUEIT
"RTN","RCDPRECT",23,0)
 ;
"RTN","RCDPRECT",24,0)
 ;  ask to print receipt
"RTN","RCDPRECT",25,0)
 I $P(PRINT,"^")=2 S %=$$DEVICE
"RTN","RCDPRECT",26,0)
 Q
"RTN","RCDPRECT",27,0)
 ;
"RTN","RCDPRECT",28,0)
 ;
"RTN","RCDPRECT",29,0)
DEVICE() ;  select the device and print receipt
"RTN","RCDPRECT",30,0)
 ;  returns 0 if not successful
"RTN","RCDPRECT",31,0)
 S %ZIS("A")="Print Receipt on DEVICE: "
"RTN","RCDPRECT",32,0)
 S %ZIS("B")=$$OPTCK^RCDPRPL2("RECEIPT",3)
"RTN","RCDPRECT",33,0)
 S %ZIS="Q"
"RTN","RCDPRECT",34,0)
 W ! D ^%ZIS
"RTN","RCDPRECT",35,0)
 I POP D ^%ZISC Q 0
"RTN","RCDPRECT",36,0)
 I $D(IO("Q")) D QUEUEIT Q "Print Receipt Queued"
"RTN","RCDPRECT",37,0)
 D PRINT
"RTN","RCDPRECT",38,0)
 Q "Receipt Printed"
"RTN","RCDPRECT",39,0)
 ;
"RTN","RCDPRECT",40,0)
 ;
"RTN","RCDPRECT",41,0)
QUEUEIT ;  queue printing receipt
"RTN","RCDPRECT",42,0)
 N ZTSK
"RTN","RCDPRECT",43,0)
 S ZTDTH=$H,ZTDESC="Print Payment Receipt",ZTRTN="PRINT^RCDPRECT"
"RTN","RCDPRECT",44,0)
 S ZTSAVE("RCRECTDA")="",ZTSAVE("RCTRANDA")="",ZTSAVE("ZTREQ")="@"
"RTN","RCDPRECT",45,0)
 D ^%ZTLOAD
"RTN","RCDPRECT",46,0)
 D ^%ZISC
"RTN","RCDPRECT",47,0)
 Q
"RTN","RCDPRECT",48,0)
 ;
"RTN","RCDPRECT",49,0)
 ;
"RTN","RCDPRECT",50,0)
PRINT ;  print a receipt
"RTN","RCDPRECT",51,0)
 ;  requires variables rcrectda and rctranda
"RTN","RCDPRECT",52,0)
 N %,%H,%I,ADDRESS,DATA,LINE,RCTYPE,X,Y
"RTN","RCDPRECT",53,0)
 U IO
"RTN","RCDPRECT",54,0)
 ;
"RTN","RCDPRECT",55,0)
 ;  print address for station at top
"RTN","RCDPRECT",56,0)
 S ADDRESS=$$SADD^RCFN01(1)
"RTN","RCDPRECT",57,0)
 W !?25,"Department Of Veterans Affairs"
"RTN","RCDPRECT",58,0)
 F %=1,2,3 I $P(ADDRESS,"^",%)'="" W !?((80-$L($P(ADDRESS,"^",%)))/2),$P(ADDRESS,"^",%)
"RTN","RCDPRECT",59,0)
 S ADDRESS=$P(ADDRESS,"^",4)_", "_$P(ADDRESS,"^",5)_"  "_$P(ADDRESS,"^",6)
"RTN","RCDPRECT",60,0)
 I $TR(ADDRESS,", ")'="" W !?((80-$L(ADDRESS))/2),ADDRESS
"RTN","RCDPRECT",61,0)
 ;
"RTN","RCDPRECT",62,0)
 S LINE="",$P(LINE,"-",80)=""
"RTN","RCDPRECT",63,0)
 W !,LINE
"RTN","RCDPRECT",64,0)
 ;
"RTN","RCDPRECT",65,0)
 S %="*** Payment Receipt ***"
"RTN","RCDPRECT",66,0)
 W !!?((80-$L(%))/2),%
"RTN","RCDPRECT",67,0)
 ;
"RTN","RCDPRECT",68,0)
 ;  account and name
"RTN","RCDPRECT",69,0)
 S DATA=$G(^RCY(344,RCRECTDA,1,RCTRANDA,0))
"RTN","RCDPRECT",70,0)
 I $P(DATA,"^",3)'="" D
"RTN","RCDPRECT",71,0)
 .   W !
"RTN","RCDPRECT",72,0)
 .   ;  account from patient file
"RTN","RCDPRECT",73,0)
 .   I $P(DATA,"^",3)[";DPT(" D  Q
"RTN","RCDPRECT",74,0)
 .   .   W $P($G(^DPT(+$P(DATA,"^",3),0)),"^")
"RTN","RCDPRECT",75,0)
 .   .   S %=$$SSN^RCFN01($P(DATA,"^",3))
"RTN","RCDPRECT",76,0)
 .   .   I $E(%,6,9)'="" W " (",$E(%,6,9),")"
"RTN","RCDPRECT",77,0)
 .   ;
"RTN","RCDPRECT",78,0)
 .   ;  account from bill file
"RTN","RCDPRECT",79,0)
 .   W $P($G(^PRCA(430,+$P(DATA,"^",3),0)),"^")
"RTN","RCDPRECT",80,0)
 .   W "  "
"RTN","RCDPRECT",81,0)
 .   W $$NAM^RCFN01($P($G(^PRCA(430,+$P(DATA,"^",3),0)),"^",9))
"RTN","RCDPRECT",82,0)
 .   S %=$$SSN^RCFN01($P($G(^PRCA(430,+$P(DATA,"^",3),0)),"^",9))
"RTN","RCDPRECT",83,0)
 .   I $E(%,6,9)'="" W " (",$E(%,6,9),")"
"RTN","RCDPRECT",84,0)
 ;
"RTN","RCDPRECT",85,0)
 W !,"     Receipt #: ",$P(^RCY(344,RCRECTDA,0),"^"),"/",$P(DATA,"^")
"RTN","RCDPRECT",86,0)
 D NOW^%DTC S Y=X D DD^%DT
"RTN","RCDPRECT",87,0)
 W ?53,"Date: ",Y
"RTN","RCDPRECT",88,0)
 W !,"  Payment Type: ",$P($G(^RC(341.1,+$P(^RCY(344,RCRECTDA,0),"^",4),0)),"^")
"RTN","RCDPRECT",89,0)
 S Y=$P(DATA,"^",6) I Y D DD^%DT
"RTN","RCDPRECT",90,0)
 W ?45,"Payment Date: ",Y
"RTN","RCDPRECT",91,0)
 ;
"RTN","RCDPRECT",92,0)
 S RCTYPE=$P($G(^RC(341.1,+$P(^RCY(344,RCRECTDA,0),"^",4),0)),"^",2)
"RTN","RCDPRECT",93,0)
 ;  type = 3 (district counsel), 4 (check), 5 (dept of justice)
"RTN","RCDPRECT",94,0)
 I RCTYPE=3!(RCTYPE=4)!(RCTYPE=5) D
"RTN","RCDPRECT",95,0)
 .   W !,"       Check #: ",$P(DATA,"^",7)
"RTN","RCDPRECT",96,0)
 .   S Y=$P(DATA,"^",10) I Y D DD^%DT
"RTN","RCDPRECT",97,0)
 .   W ?47,"Check Date: ",Y
"RTN","RCDPRECT",98,0)
 .   W !,"        Bank #: ",$P(DATA,"^",8)
"RTN","RCDPRECT",99,0)
 ;
"RTN","RCDPRECT",100,0)
 ;  type = 7 (credit card)
"RTN","RCDPRECT",101,0)
 I RCTYPE=7 D
"RTN","RCDPRECT",102,0)
 .   W !," Credit Card #: ",$P(DATA,"^",11)
"RTN","RCDPRECT",103,0)
 .   W !," Confirmation#: ",$P(DATA,"^",2)
"RTN","RCDPRECT",104,0)
 ;
"RTN","RCDPRECT",105,0)
 W !,"Payment Amount: $ ",$J($P(DATA,"^",4),0,2)
"RTN","RCDPRECT",106,0)
 W ?42,"Account Balance: $ ",$J($$BAL^PRCAFN($S($P(DATA,"^",3)[";PRCA(430":$P(^PRCA(430,+$P(DATA,"^",3),0),"^",9),1:$P(DATA,"^",3))),0,2)
"RTN","RCDPRECT",107,0)
 ;
"RTN","RCDPRECT",108,0)
 W !!,"IMPORTANT"
"RTN","RCDPRECT",109,0)
 W !!,"Note that checks or drafts are not valid until paid by your bank."
"RTN","RCDPRECT",110,0)
 W !!,"This receipt should be retained for your records."
"RTN","RCDPRECT",111,0)
 W !,"A detailed listing of how your payment has been applied to your"
"RTN","RCDPRECT",112,0)
 W !,"account will be provided on your patient statement, which you"
"RTN","RCDPRECT",113,0)
 W !,"will receive in the mail at a later date."
"RTN","RCDPRECT",114,0)
 W !!,LINE
"RTN","RCDPRECT",115,0)
 D ^%ZISC
"RTN","RCDPRECT",116,0)
 Q
"RTN","RCDPRPL2")
0^4^B68740543
"RTN","RCDPRPL2",1,0)
RCDPRPL2 ;WISC/RFJ-receipt profile listmanager options ;1 Jun 99
"RTN","RCDPRPL2",2,0)
 ;;4.5;Accounts Receivable;**114,148,173,217**;Mar 20, 1995
"RTN","RCDPRPL2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPRPL2",4,0)
 Q
"RTN","RCDPRPL2",5,0)
 ;
"RTN","RCDPRPL2",6,0)
 ;  this routine contains entry points for customize and printing
"RTN","RCDPRPL2",7,0)
 ;
"RTN","RCDPRPL2",8,0)
 ;
"RTN","RCDPRPL2",9,0)
ACCTPROF ;  option: account profile
"RTN","RCDPRPL2",10,0)
 D FULL^VALM1
"RTN","RCDPRPL2",11,0)
 S VALMBCK="R"
"RTN","RCDPRPL2",12,0)
 ;
"RTN","RCDPRPL2",13,0)
 N ACCT,RCDEBTDA,RCTRANDA
"RTN","RCDPRPL2",14,0)
 ;  select the payment transaction
"RTN","RCDPRPL2",15,0)
 S RCTRANDA=$$SELPAY^RCDPRPL1(RCRECTDA)
"RTN","RCDPRPL2",16,0)
 I RCTRANDA>0 D
"RTN","RCDPRPL2",17,0)
 .   ;  find debtor (file 340) entry
"RTN","RCDPRPL2",18,0)
 .   S RCDEBTDA=0
"RTN","RCDPRPL2",19,0)
 .   S ACCT=$P(^RCY(344,RCRECTDA,1,RCTRANDA,0),"^",3)
"RTN","RCDPRPL2",20,0)
 .   I ACCT[";DPT(" S RCDEBTDA=$O(^RCD(340,"B",ACCT,0))
"RTN","RCDPRPL2",21,0)
 .   I ACCT["PRCA(430," S RCDEBTDA=$P($G(^PRCA(430,+ACCT,0)),"^",9)
"RTN","RCDPRPL2",22,0)
 .   I 'RCDEBTDA S VALMSG="Account NOT found for payment transaction."
"RTN","RCDPRPL2",23,0)
 ;
"RTN","RCDPRPL2",24,0)
 ;  payment not selected ask to select an account
"RTN","RCDPRPL2",25,0)
 I '$D(RCDEBTDA) S RCDEBTDA=$$SELACCT^RCDPAPLM
"RTN","RCDPRPL2",26,0)
 ;
"RTN","RCDPRPL2",27,0)
 I $G(RCDEBTDA)'>0 Q
"RTN","RCDPRPL2",28,0)
 D EN^VALM("RCDP ACCOUNT PROFILE")
"RTN","RCDPRPL2",29,0)
 S VALMBCK="R"
"RTN","RCDPRPL2",30,0)
 ;  fast exit
"RTN","RCDPRPL2",31,0)
 I $G(RCDPFXIT) S VALMBCK="Q"
"RTN","RCDPRPL2",32,0)
 Q
"RTN","RCDPRPL2",33,0)
 ;
"RTN","RCDPRPL2",34,0)
 ;
"RTN","RCDPRPL2",35,0)
PRINRECT ;  option: print a receipt
"RTN","RCDPRPL2",36,0)
 D FULL^VALM1
"RTN","RCDPRPL2",37,0)
 S VALMBCK="R"
"RTN","RCDPRPL2",38,0)
 ;
"RTN","RCDPRPL2",39,0)
 N RCTRANDA
"RTN","RCDPRPL2",40,0)
 ;  select the payment transaction
"RTN","RCDPRPL2",41,0)
 S RCTRANDA=$$SELPAY^RCDPRPL1(RCRECTDA) I RCTRANDA<1 Q
"RTN","RCDPRPL2",42,0)
 ;
"RTN","RCDPRPL2",43,0)
 ;  check if transaction has a payment amount
"RTN","RCDPRPL2",44,0)
 I '$P($G(^RCY(344,RCRECTDA,1,RCTRANDA,0)),"^",4) S VALMSG="NO Payment Amount on Transaction." Q
"RTN","RCDPRPL2",45,0)
 ;
"RTN","RCDPRPL2",46,0)
 S VALMSG=$$DEVICE^RCDPRECT
"RTN","RCDPRPL2",47,0)
 I VALMSG=0 S VALMSG="Receipt NOT printed"
"RTN","RCDPRPL2",48,0)
 Q
"RTN","RCDPRPL2",49,0)
 ;
"RTN","RCDPRPL2",50,0)
 ;
"RTN","RCDPRPL2",51,0)
PRINT215 ;  print 215 report
"RTN","RCDPRPL2",52,0)
 N %ZIS,POP
"RTN","RCDPRPL2",53,0)
 D FULL^VALM1
"RTN","RCDPRPL2",54,0)
 S VALMBCK="R"
"RTN","RCDPRPL2",55,0)
 ;
"RTN","RCDPRPL2",56,0)
 N RECEIPDA,RCTYPE
"RTN","RCDPRPL2",57,0)
 S RECEIPDA=RCRECTDA
"RTN","RCDPRPL2",58,0)
 ;
"RTN","RCDPRPL2",59,0)
 S RCTYPE=$$GETTYPE^RCDPR215
"RTN","RCDPRPL2",60,0)
 I RCTYPE="" Q
"RTN","RCDPRPL2",61,0)
 ;
"RTN","RCDPRPL2",62,0)
 ;  select device
"RTN","RCDPRPL2",63,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP
"RTN","RCDPRPL2",64,0)
 I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK D ^%ZISC Q
"RTN","RCDPRPL2",65,0)
 .   S ZTDESC="Print 215 Report",ZTRTN="DQ^RCDPR215"
"RTN","RCDPRPL2",66,0)
 .   S ZTSAVE("RECEIPDA")="",ZTSAVE("RCTYPE")="",ZTSAVE("ZTREQ")="@"
"RTN","RCDPRPL2",67,0)
 W !!,"<*> please wait <*>"
"RTN","RCDPRPL2",68,0)
 D DQ^RCDPR215
"RTN","RCDPRPL2",69,0)
 Q
"RTN","RCDPRPL2",70,0)
 ;
"RTN","RCDPRPL2",71,0)
 ;
"RTN","RCDPRPL2",72,0)
CUSTOMIZ ;  option: customize display
"RTN","RCDPRPL2",73,0)
 D FULL^VALM1
"RTN","RCDPRPL2",74,0)
 S VALMBCK="R"
"RTN","RCDPRPL2",75,0)
 ;
"RTN","RCDPRPL2",76,0)
 W !!,"This option will allow the user to customize the screen and options"
"RTN","RCDPRPL2",77,0)
 W !,"used for receipt processing."
"RTN","RCDPRPL2",78,0)
 ;
"RTN","RCDPRPL2",79,0)
 ;  ask to show check/credit card data
"RTN","RCDPRPL2",80,0)
 I $$ASKCHECK=-1 Q
"RTN","RCDPRPL2",81,0)
 ;
"RTN","RCDPRPL2",82,0)
 ;  ask to show acct lookup, batch and sequence number
"RTN","RCDPRPL2",83,0)
 I $$ASKACCT=-1 D INIT^RCDPRPLM Q
"RTN","RCDPRPL2",84,0)
 ;
"RTN","RCDPRPL2",85,0)
 ;  ask to show comments
"RTN","RCDPRPL2",86,0)
 I $$ASKCOMM=-1 D INIT^RCDPRPLM Q
"RTN","RCDPRPL2",87,0)
 ;
"RTN","RCDPRPL2",88,0)
 ;  ask to show fms cr documents
"RTN","RCDPRPL2",89,0)
 I $$ASKFMS=-1 D INIT^RCDPRPLM Q
"RTN","RCDPRPL2",90,0)
 ;
"RTN","RCDPRPL2",91,0)
 ;  ask to show EOB detail information
"RTN","RCDPRPL2",92,0)
 I $$ASKEOB=-1 D INIT^RCDPRPLM Q
"RTN","RCDPRPL2",93,0)
 ;
"RTN","RCDPRPL2",94,0)
 ;  make sure form is rebuilt based on the above answers
"RTN","RCDPRPL2",95,0)
 D INIT^RCDPRPLM
"RTN","RCDPRPL2",96,0)
 ;
"RTN","RCDPRPL2",97,0)
 ;
"RTN","RCDPRPL2",98,0)
 W !!,"The next prompts will allow the user to individually set up the way receipts"
"RTN","RCDPRPL2",99,0)
 W !,"should be printed when entering payment transactions.  The user can set"
"RTN","RCDPRPL2",100,0)
 W !,"the software up to automatically print a receipt to a device, never print"
"RTN","RCDPRPL2",101,0)
 W !,"the receipt, or ask to print the receipt.  The user can also specify the"
"RTN","RCDPRPL2",102,0)
 W !,"printer used for printing receipts, preventing from having to re-enter it."
"RTN","RCDPRPL2",103,0)
 N DEVICE,TYPE
"RTN","RCDPRPL2",104,0)
 ;
"RTN","RCDPRPL2",105,0)
 ;  for printing receipts
"RTN","RCDPRPL2",106,0)
 D  Q:TYPE<0
"RTN","RCDPRPL2",107,0)
 .   W !
"RTN","RCDPRPL2",108,0)
 .   S TYPE=$$ASKRECT
"RTN","RCDPRPL2",109,0)
 .   I TYPE<0 Q
"RTN","RCDPRPL2",110,0)
 .   ;
"RTN","RCDPRPL2",111,0)
 .   ;  never print receipt
"RTN","RCDPRPL2",112,0)
 .   I TYPE=0 D RCSET("RECEIPT",0) Q
"RTN","RCDPRPL2",113,0)
 .   ;
"RTN","RCDPRPL2",114,0)
 .   ;  ask default printer device
"RTN","RCDPRPL2",115,0)
 .   S DEVICE=$$ASKDEVIC(1)
"RTN","RCDPRPL2",116,0)
 .   ;
"RTN","RCDPRPL2",117,0)
 .   ;  no default printer, always print receipt
"RTN","RCDPRPL2",118,0)
 .   I DEVICE="",TYPE=1 D  Q
"RTN","RCDPRPL2",119,0)
 .   .   W !,"Since you did not enter a default printer for printing receipts,"
"RTN","RCDPRPL2",120,0)
 .   .   W !,"I will change it so the software will ask you to print the receipt"
"RTN","RCDPRPL2",121,0)
 .   .   W !,"when entering a payment transaction."
"RTN","RCDPRPL2",122,0)
 .   .   D RCSET("RECEIPT",2)
"RTN","RCDPRPL2",123,0)
 .   ;
"RTN","RCDPRPL2",124,0)
 .   ;  set default printer for receipts
"RTN","RCDPRPL2",125,0)
 .   D RCSET("RECEIPT",TYPE_"^"_DEVICE)
"RTN","RCDPRPL2",126,0)
 ;
"RTN","RCDPRPL2",127,0)
 ;  for printing 215 report
"RTN","RCDPRPL2",128,0)
 W !!!,"You now have the option of setting up the default printer for automatically"
"RTN","RCDPRPL2",129,0)
 W !,"printing the 215 report when a receipt is processed.",!
"RTN","RCDPRPL2",130,0)
 ;  ask default printer device
"RTN","RCDPRPL2",131,0)
 S DEVICE=$$ASKDEVIC(2)
"RTN","RCDPRPL2",132,0)
 D RCSET("215REPORT",U_DEVICE)
"RTN","RCDPRPL2",133,0)
 Q
"RTN","RCDPRPL2",134,0)
RCSET(RCSNPT,RCSLDV) ;file the selected parameter & device
"RTN","RCDPRPL2",135,0)
 N DA,DIC,DIE,DR,X,Y
"RTN","RCDPRPL2",136,0)
 I '$D(^RC(342.3,"B",RCSNPT)) D
"RTN","RCDPRPL2",137,0)
 .K DD,DO,DIC("DR") S DIC="^RC(342.3,",DIC(0)="",X=RCSNPT D FILE^DICN
"RTN","RCDPRPL2",138,0)
 S DA(1)=$O(^RC(342.3,"B",RCSNPT,0))
"RTN","RCDPRPL2",139,0)
 I '$D(^RC(342.3,DA(1),1,"B",DUZ)) D  Q
"RTN","RCDPRPL2",140,0)
 .S DIC(0)="",DIC("P")=$P(^DD(342.3,1,0),U,2),DIC="^RC(342.3,"_DA(1)_",1,",X=DUZ
"RTN","RCDPRPL2",141,0)
 .S DIC("DR")="1////"_$P(RCSLDV,U)_";2////"_$P(RCSLDV,U,2)
"RTN","RCDPRPL2",142,0)
 .K DD,DO D FILE^DICN
"RTN","RCDPRPL2",143,0)
 S DA=$O(^RC(342.3,DA(1),1,"B",DUZ,0)),DR=".01////"_DUZ_";1////"_$P(RCSLDV,U)_";2////"_$P(RCSLDV,U,2)
"RTN","RCDPRPL2",144,0)
 S DIE="^RC(342.3,"_DA(1)_",1," D ^DIE
"RTN","RCDPRPL2",145,0)
 Q
"RTN","RCDPRPL2",146,0)
 ;
"RTN","RCDPRPL2",147,0)
OPTCK(RCSNPT,RCSLDV) ;return the selection in piece 2 and device in piece 3
"RTN","RCDPRPL2",148,0)
 N RCDA
"RTN","RCDPRPL2",149,0)
 S RCDA=$O(^RC(342.3,+$O(^RC(342.3,"B",RCSNPT,0)),1,"B",DUZ,0))
"RTN","RCDPRPL2",150,0)
 I RCDA S RCDA=$P($G(^RC(342.3,+$O(^RC(342.3,"B",RCSNPT,0)),1,RCDA,0)),U,RCSLDV)
"RTN","RCDPRPL2",151,0)
 Q RCDA
"RTN","RCDPRPL2",152,0)
 ;
"RTN","RCDPRPL2",153,0)
 ;
"RTN","RCDPRPL2",154,0)
ASKCHECK() ;  ask if its okay to show check/credit card data
"RTN","RCDPRPL2",155,0)
 ;  1 is yes, otherwise no
"RTN","RCDPRPL2",156,0)
 N DIR,DIQ2,DTOUT,DUOUT,X,Y
"RTN","RCDPRPL2",157,0)
 S DIR(0)="YO"
"RTN","RCDPRPL2",158,0)
 S DIR("B")="NO"
"RTN","RCDPRPL2",159,0)
 I $$OPTCK("SHOWCHECK",2) S DIR("B")="YES"
"RTN","RCDPRPL2",160,0)
 S DIR("A")="  Do you want to show check and credit card information"
"RTN","RCDPRPL2",161,0)
 W ! D ^DIR
"RTN","RCDPRPL2",162,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPRPL2",163,0)
 I Y'=-1 D RCSET("SHOWCHECK",Y)
"RTN","RCDPRPL2",164,0)
 Q Y
"RTN","RCDPRPL2",165,0)
 ;
"RTN","RCDPRPL2",166,0)
ASKEOB() ;  ask if its okay to show EOB detail data
"RTN","RCDPRPL2",167,0)
 ;  1 is yes, otherwise no
"RTN","RCDPRPL2",168,0)
 N DIR,DIQ2,DTOUT,DUOUT,X,Y
"RTN","RCDPRPL2",169,0)
 S DIR(0)="YO"
"RTN","RCDPRPL2",170,0)
 S DIR("B")="NO"
"RTN","RCDPRPL2",171,0)
 I $$OPTCK("SHOWEOB",2) S DIR("B")="YES"
"RTN","RCDPRPL2",172,0)
 S DIR("A")="  Do you want to show electronic EEOB detail data"
"RTN","RCDPRPL2",173,0)
 W ! D ^DIR
"RTN","RCDPRPL2",174,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPRPL2",175,0)
 I Y'=-1 D RCSET("SHOWEOB",Y)
"RTN","RCDPRPL2",176,0)
 Q Y
"RTN","RCDPRPL2",177,0)
 ;
"RTN","RCDPRPL2",178,0)
ASKACCT() ;  ask if its okay to show acct lookup, batch, and sequence
"RTN","RCDPRPL2",179,0)
 ;  1 is yes, otherwise no
"RTN","RCDPRPL2",180,0)
 N DIR,DIQ2,DTOUT,DUOUT,X,Y
"RTN","RCDPRPL2",181,0)
 S DIR(0)="YO"
"RTN","RCDPRPL2",182,0)
 S DIR("B")="NO"
"RTN","RCDPRPL2",183,0)
 I $$OPTCK("SHOWACCT",2) S DIR("B")="YES"
"RTN","RCDPRPL2",184,0)
 S DIR("A")="  Do you want to show acct lookup, batch and sequence information"
"RTN","RCDPRPL2",185,0)
 W ! D ^DIR
"RTN","RCDPRPL2",186,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPRPL2",187,0)
 I Y'=-1 D RCSET("SHOWACCT",Y)
"RTN","RCDPRPL2",188,0)
 Q Y
"RTN","RCDPRPL2",189,0)
 ;
"RTN","RCDPRPL2",190,0)
 ;
"RTN","RCDPRPL2",191,0)
ASKCOMM() ;  ask if its okay to show comments and posting errors
"RTN","RCDPRPL2",192,0)
 ;  1 is yes, otherwise no
"RTN","RCDPRPL2",193,0)
 N DIR,DIQ2,DTOUT,DUOUT,X,Y
"RTN","RCDPRPL2",194,0)
 S DIR(0)="YO"
"RTN","RCDPRPL2",195,0)
 S DIR("B")="NO"
"RTN","RCDPRPL2",196,0)
 I $$OPTCK("SHOWCOMMENTS",2) S DIR("B")="YES"
"RTN","RCDPRPL2",197,0)
 S DIR("A")="  Do you want to show comments"
"RTN","RCDPRPL2",198,0)
 W ! D ^DIR
"RTN","RCDPRPL2",199,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPRPL2",200,0)
 I Y'=-1 D RCSET("SHOWCOMMENTS",Y)
"RTN","RCDPRPL2",201,0)
 Q Y
"RTN","RCDPRPL2",202,0)
 ;
"RTN","RCDPRPL2",203,0)
 ;
"RTN","RCDPRPL2",204,0)
ASKFMS() ;  ask if its okay to show fms documents
"RTN","RCDPRPL2",205,0)
 ;  1 is yes, otherwise no
"RTN","RCDPRPL2",206,0)
 N DIR,DIQ2,DTOUT,DUOUT,X,Y
"RTN","RCDPRPL2",207,0)
 S DIR(0)="YO"
"RTN","RCDPRPL2",208,0)
 S DIR("B")="NO"
"RTN","RCDPRPL2",209,0)
 I $$OPTCK("SHOWFMS",2) S DIR("B")="YES"
"RTN","RCDPRPL2",210,0)
 S DIR("A")="  Do you want to show the FMS cash receipt documents"
"RTN","RCDPRPL2",211,0)
 W ! D ^DIR
"RTN","RCDPRPL2",212,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPRPL2",213,0)
 I Y'=-1 D RCSET("SHOWFMS",Y)
"RTN","RCDPRPL2",214,0)
 Q Y
"RTN","RCDPRPL2",215,0)
 ;
"RTN","RCDPRPL2",216,0)
 ;
"RTN","RCDPRPL2",217,0)
ASKRECT() ;  ask to print the receipt
"RTN","RCDPRPL2",218,0)
 ;  returns 0 (never), 1 (always), or 2 (ask)
"RTN","RCDPRPL2",219,0)
 N DEFAULT,DIR,DIQ2,DTOUT,DUOUT,X,Y
"RTN","RCDPRPL2",220,0)
 S DEFAULT="ALWAYS"
"RTN","RCDPRPL2",221,0)
 I $$OPTCK("RECEIPT",2)'=""!($$OPTCK("RECEIPT",3)'="") S DEFAULT=$$OPTCK("RECEIPT",2),DEFAULT=$S(DEFAULT=0:"NEVER",DEFAULT=1:"ALWAYS",1:"MAYBE")
"RTN","RCDPRPL2",222,0)
 S DIR(0)="SO^0:Never Print the Receipt;1:Always Print the Receipt;2:Maybe, Ask to Print the Receipt"
"RTN","RCDPRPL2",223,0)
 S DIR("A")="Print Receipt"
"RTN","RCDPRPL2",224,0)
 S DIR("B")=DEFAULT
"RTN","RCDPRPL2",225,0)
 D ^DIR
"RTN","RCDPRPL2",226,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCDPRPL2",227,0)
 Q Y
"RTN","RCDPRPL2",228,0)
 ;
"RTN","RCDPRPL2",229,0)
 ;
"RTN","RCDPRPL2",230,0)
ASKDEVIC(RCTYPE) ;  ask the default printer for receipts and for 215 report
"RTN","RCDPRPL2",231,0)
 ;  rctype=1 for receipts, rctype=2 for 215 report
"RTN","RCDPRPL2",232,0)
 N RCION
"RTN","RCDPRPL2",233,0)
 S %ZIS="NP0"
"RTN","RCDPRPL2",234,0)
 S %ZIS("A")="Enter the Default Printer for Printing Receipts: "
"RTN","RCDPRPL2",235,0)
 I RCTYPE=2 S %ZIS("A")="Enter the Default Printer for Printing the 215 Report: "
"RTN","RCDPRPL2",236,0)
 S %ZIS("B")=""
"RTN","RCDPRPL2",237,0)
 I RCTYPE=1,$$OPTCK("RECEIPT",3)'="" S %ZIS("B")=$$OPTCK("RECEIPT",3)
"RTN","RCDPRPL2",238,0)
 I RCTYPE=2,$$OPTCK("215REPORT",3)'="" S %ZIS("B")=$$OPTCK("215REPORT",3)
"RTN","RCDPRPL2",239,0)
 D ^%ZIS
"RTN","RCDPRPL2",240,0)
 I IO=IO(0) W !,"You cannot select your current device as a default printer." Q ""
"RTN","RCDPRPL2",241,0)
 S RCION=ION
"RTN","RCDPRPL2",242,0)
 ;  reset current device
"RTN","RCDPRPL2",243,0)
 D ^%ZISC
"RTN","RCDPRPL2",244,0)
 Q RCION
"RTN","RCDPRPL2",245,0)
 ;
"RTN","RCDPRPL2",246,0)
SHEOB ;  show EEOB detail if switch on - moved from RCDPRPLM
"RTN","RCDPRPL2",247,0)
 I $$OPTCK("SHOWEOB",2) D
"RTN","RCDPRPL2",248,0)
 .   N Z
"RTN","RCDPRPL2",249,0)
 .   S Z=$O(^RCY(344.4,"ARCT",RCRECTDA,0))
"RTN","RCDPRPL2",250,0)
 .   Q:'Z
"RTN","RCDPRPL2",251,0)
 .   S RCLINE=RCLINE+1 D SET^RCDPRPLM(" ",RCLINE,1,80)
"RTN","RCDPRPL2",252,0)
 .   S RCLINE=RCLINE+1 D SET^RCDPRPLM("EEOB Detail:",RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPRPL2",253,0)
 .   K ^TMP($J,"RCDISP") D DISP^RCDPEDS(Z)
"RTN","RCDPRPL2",254,0)
 .   S Z=0 F  S Z=$O(^TMP($J,"RCDISP",Z)) Q:'Z  S RCLINE=RCLINE+1 D SET^RCDPRPLM(^TMP($J,"RCDISP",Z),RCLINE,1,80)
"RTN","RCDPRPL2",255,0)
 .   K ^TMP($J,"RCDISP")
"RTN","RCDPRPL2",256,0)
 Q
"RTN","RCDPRPL2",257,0)
 ;
"RTN","RCDPRPLM")
0^2^B81841710
"RTN","RCDPRPLM",1,0)
RCDPRPLM ;WISC/RFJ-receipt profile listmanager top routine ;1 Jun 99
"RTN","RCDPRPLM",2,0)
 ;;4.5;Accounts Receivable;**114,148,149,173,196,220,217**;Mar 20, 1995
"RTN","RCDPRPLM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPRPLM",4,0)
 ;
"RTN","RCDPRPLM",5,0)
 N RCDPFXIT
"RTN","RCDPRPLM",6,0)
 ;
"RTN","RCDPRPLM",7,0)
RECTPROF ;  entry point called by link payment to prevent newing
"RTN","RCDPRPLM",8,0)
 ; fast exit var RCDPFXIT
"RTN","RCDPRPLM",9,0)
 N RCRECTDA
"RTN","RCDPRPLM",10,0)
 ;
"RTN","RCDPRPLM",11,0)
 F  D  Q:'RCRECTDA
"RTN","RCDPRPLM",12,0)
 . W !! S RCRECTDA=$$SELRECT^RCDPUREC(1)  ;allow adding new receipt
"RTN","RCDPRPLM",13,0)
 . I RCRECTDA<1 S RCRECTDA=0 Q
"RTN","RCDPRPLM",14,0)
 . D EN^VALM("RCDP RECEIPT PROFILE")
"RTN","RCDPRPLM",15,0)
 . ; fast exit
"RTN","RCDPRPLM",16,0)
 . I $G(RCDPFXIT) S RCRECTDA=0
"RTN","RCDPRPLM",17,0)
 Q
"RTN","RCDPRPLM",18,0)
 ;
"RTN","RCDPRPLM",19,0)
 ;
"RTN","RCDPRPLM",20,0)
INIT ; init for list manager
"RTN","RCDPRPLM",21,0)
 N DATE,FMSDOC,GECSDA1,GECSDATA,RCCANCEL,RCDPDATA,RCDPFCAN,RCLINE,RCTOTAL,RCTRDA,SPACE,RCEFT,X,Z,Z0,RCZ,RCZ0,RCZ1,RCZ2,EFTFUND
"RTN","RCDPRPLM",22,0)
 K ^TMP("RCDPRPLM",$J),^TMP("VALM VIDEO",$J)
"RTN","RCDPRPLM",23,0)
 ;
"RTN","RCDPRPLM",24,0)
 ; fast exit
"RTN","RCDPRPLM",25,0)
 I $G(RCDPFXIT) S VALMQUIT=1 Q
"RTN","RCDPRPLM",26,0)
 ;
"RTN","RCDPRPLM",27,0)
 D DIQ344(RCRECTDA,".02:200")
"RTN","RCDPRPLM",28,0)
 ;
"RTN","RCDPRPLM",29,0)
 ; set listmanager line #
"RTN","RCDPRPLM",30,0)
 S RCLINE=0
"RTN","RCDPRPLM",31,0)
 ;
"RTN","RCDPRPLM",32,0)
 K ^TMP($J,"RCEFT")
"RTN","RCDPRPLM",33,0)
 S EFTFUND=$S(DT<$$ADDPTEDT^PRCAACC():"5287.4/8NZZ ",1:"528704/8NZZ ")
"RTN","RCDPRPLM",34,0)
 S RCEFT=+$O(^RCY(344.3,"ARDEP",+$P($G(^RCY(344,RCRECTDA,0)),U,6),0))
"RTN","RCDPRPLM",35,0)
 I RCEFT D
"RTN","RCDPRPLM",36,0)
 . S Z=0 F  S Z=$O(^RCY(344.31,"B",RCEFT,Z)) Q:'Z  S Z0=$G(^RCY(344.31,+Z,0)) I $P(Z0,U,14) S ^TMP($J,"RCEFT",$P(Z0,U,14))=Z_U_$E($P(Z0,U,2),1,12)
"RTN","RCDPRPLM",37,0)
 S RCTRDA=0 F  S RCTRDA=$O(^RCY(344,RCRECTDA,1,RCTRDA)) Q:'RCTRDA  D
"RTN","RCDPRPLM",38,0)
 . D DIQ34401(RCRECTDA,RCTRDA)
"RTN","RCDPRPLM",39,0)
 . S RCLINE=RCLINE+1 D SET("",RCLINE,1,80,.01)
"RTN","RCDPRPLM",40,0)
 . ;check for payment cancelled
"RTN","RCDPRPLM",41,0)
 . S RCCANCEL=0
"RTN","RCDPRPLM",42,0)
 . I $P($G(^RCY(344,RCRECTDA,1,RCTRDA,0)),"^",4)=0,$P($G(^(1)),"^")'="" D
"RTN","RCDPRPLM",43,0)
 . . S RCCANCEL=1,RCDPFCAN=1
"RTN","RCDPRPLM",44,0)
 . . D SET("**",RCLINE,5,6)
"RTN","RCDPRPLM",45,0)
 . ;account
"RTN","RCDPRPLM",46,0)
 . I $G(RCDPDATA(344.01,RCTRDA,.03,"E"))="" D
"RTN","RCDPRPLM",47,0)
 . . S RCDPDATA(344.01,RCTRDA,.03,"E")="[ "_$S(RCEFT:EFTFUND_$P($G(^TMP($J,"RCEFT",RCTRDA)),U,2),1:"suspense"_$$GETUNAPP^RCXFMSCR(RCRECTDA,RCTRDA,0))_" ]"
"RTN","RCDPRPLM",48,0)
 . D SET("",RCLINE,7,33,.03)
"RTN","RCDPRPLM",49,0)
 . ;date of payment
"RTN","RCDPRPLM",50,0)
 . I RCDPDATA(344.01,RCTRDA,.06,"I") D
"RTN","RCDPRPLM",51,0)
 . . D SET($E(RCDPDATA(344.01,RCTRDA,.06,"I"),4,5)_"/"_$E(RCDPDATA(344.01,RCTRDA,.06,"I"),6,7)_"/"_$E(RCDPDATA(344.01,RCTRDA,.06,"I"),2,3),RCLINE,35,42)
"RTN","RCDPRPLM",52,0)
 . ;entered by
"RTN","RCDPRPLM",53,0)
 . I RCDPDATA(344.01,RCTRDA,.12,"E")'="" D
"RTN","RCDPRPLM",54,0)
 . . S X=$E($P(RCDPDATA(344.01,RCTRDA,.12,"E"),",",2))_$E(RCDPDATA(344.01,RCTRDA,.12,"E"))
"RTN","RCDPRPLM",55,0)
 . . I RCDPDATA(344.01,RCTRDA,.12,"I")=.5 S X="ar"
"RTN","RCDPRPLM",56,0)
 . . D SET(X,RCLINE,45,46)
"RTN","RCDPRPLM",57,0)
 . I RCDPDATA(344.01,RCTRDA,.14,"E")'="" D
"RTN","RCDPRPLM",58,0)
 . . S X=$E($P(RCDPDATA(344.01,RCTRDA,.14,"E"),",",2))_$E(RCDPDATA(344.01,RCTRDA,.14,"E"))
"RTN","RCDPRPLM",59,0)
 . . D SET(X,RCLINE,54,55)
"RTN","RCDPRPLM",60,0)
 . D SET($J(RCDPDATA(344.01,RCTRDA,.04,"E"),8,2),RCLINE,62,70)
"RTN","RCDPRPLM",61,0)
 . D SET($J(RCDPDATA(344.01,RCTRDA,.05,"E"),8,2),RCLINE,72,80)
"RTN","RCDPRPLM",62,0)
 . ;
"RTN","RCDPRPLM",63,0)
 . ;if not processed, show if amount > bill
"RTN","RCDPRPLM",64,0)
 . S X=$$CHECKPAY^RCDPRPL3(RCRECTDA,RCTRDA) I X D
"RTN","RCDPRPLM",65,0)
 . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",66,0)
 . . D SET("  WARNING: Pending Payments ($ "_$J($P(X,"^",3),0,2)_") exceed amount billed ($ "_$J($P(X,"^",2),0,2)_")",RCLINE,1,80)
"RTN","RCDPRPLM",67,0)
 . ;
"RTN","RCDPRPLM",68,0)
 . ;show line 2 for check/credit payment
"RTN","RCDPRPLM",69,0)
 . I $$OPTCK^RCDPRPL2("SHOWCHECK",2) D
"RTN","RCDPRPLM",70,0)
 . . ;receipt type of payment is check
"RTN","RCDPRPLM",71,0)
 . . I RCDPDATA(344,RCRECTDA,.04,"I")=4!(RCDPDATA(344,RCRECTDA,.04,"I")=12) D  Q
"RTN","RCDPRPLM",72,0)
 . . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",73,0)
 . . . D SET("      Check #",RCLINE,1,80,.07)
"RTN","RCDPRPLM",74,0)
 . . . I 'RCDPDATA(344.01,RCTRDA,.1,"I") S RCDPDATA(344.01,RCTRDA,.1,"I")="???????"
"RTN","RCDPRPLM",75,0)
 . . . D SET("Date: "_$E(RCDPDATA(344.01,RCTRDA,.1,"I"),4,5)_"/"_$E(RCDPDATA(344.01,RCTRDA,.1,"I"),6,7)_"/"_$E(RCDPDATA(344.01,RCTRDA,.1,"I"),2,3),RCLINE,32,80)
"RTN","RCDPRPLM",76,0)
 . . . D SET("Bank #",RCLINE,47,80,.08)
"RTN","RCDPRPLM",77,0)
 . . ;receipt type of payment is credit
"RTN","RCDPRPLM",78,0)
 . . I RCDPDATA(344,RCRECTDA,.04,"I")=7 D
"RTN","RCDPRPLM",79,0)
 . . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",80,0)
 . . . D SET("      Card #",RCLINE,1,80,.11)
"RTN","RCDPRPLM",81,0)
 . . . D SET("Confirmation #",RCLINE,35,80,.02)
"RTN","RCDPRPLM",82,0)
 . ;
"RTN","RCDPRPLM",83,0)
 . ;show line 3 for acct lookup, batch and seq #
"RTN","RCDPRPLM",84,0)
 . I $$OPTCK^RCDPRPL2("SHOWACCT",2) D
"RTN","RCDPRPLM",85,0)
 . . I RCDPDATA(344.01,RCTRDA,.21,"E")="",RCDPDATA(344.01,RCTRDA,.22,"E")="",RCDPDATA(344.01,RCTRDA,.23,"E")="" Q
"RTN","RCDPRPLM",86,0)
 . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",87,0)
 . . D SET("      AcctLU",RCLINE,1,80,.21)
"RTN","RCDPRPLM",88,0)
 . . D SET("Batch/Sequence: "_RCDPDATA(344.01,RCTRDA,.22,"E")_"/"_RCDPDATA(344.01,RCTRDA,.23,"E"),RCLINE,37,80)
"RTN","RCDPRPLM",89,0)
 . ;
"RTN","RCDPRPLM",90,0)
 . ;show if posting error
"RTN","RCDPRPLM",91,0)
 . I $$OPTCK^RCDPRPL2("SHOWCOMMENTS",2),RCDPDATA(344.01,RCTRDA,1.01,"E")'="" D
"RTN","RCDPRPLM",92,0)
 . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",93,0)
 . . S X="Posting Error"
"RTN","RCDPRPLM",94,0)
 . . I RCCANCEL S X="Cancel Data"
"RTN","RCDPRPLM",95,0)
 . . D SET("      "_X,RCLINE,1,80,1.01)
"RTN","RCDPRPLM",96,0)
 . ;
"RTN","RCDPRPLM",97,0)
 . ;show if comment
"RTN","RCDPRPLM",98,0)
 . I $$OPTCK^RCDPRPL2("SHOWCOMMENTS",2),RCDPDATA(344.01,RCTRDA,1.02,"E")'="" D
"RTN","RCDPRPLM",99,0)
 . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",100,0)
 . . D SET("      Comment",RCLINE,1,80,1.02)
"RTN","RCDPRPLM",101,0)
 . ;
"RTN","RCDPRPLM",102,0)
 . ;if EDI Lockbox pending adjustments, show it
"RTN","RCDPRPLM",103,0)
 . I $P($G(^RCY(344,RCRECTDA,0)),U,18),$G(RCDPDATA(344.01,RCTRDA,.27,"E")) D
"RTN","RCDPRPLM",104,0)
 . . S RCZ=$P(^RCY(344,RCRECTDA,0),U,18),RCZ0=RCDPDATA(344.01,RCTRDA,.27,"E")
"RTN","RCDPRPLM",105,0)
 . . S RCZ1=0 F  S RCZ1=$O(^RCY(344.49,RCZ,1,RCZ0,1,RCZ1)) Q:'RCZ1  S RCZ2=$G(^(RCZ1,0)) I $P(RCZ2,U,5)'="","12"[$P(RCZ2,U,5),'$P(RCZ2,U,8) D
"RTN","RCDPRPLM",106,0)
 . . . I $P(RCZ2,U,5)=1 S RCLINE=RCLINE+1 D SET("      Pending decrease adjustment for "_$J($P(RCZ2,U,3),"",2),RCLINE,1,80) Q
"RTN","RCDPRPLM",107,0)
 . . . I $$OPTCK^RCDPRPL2("SHOWCOMMENTS",2),$P(RCZ2,U,5)=2 S RCLINE=RCLINE+1 D SET("      Comment: "_$P(RCZ2,U,9),RCLINE,1,80) Q
"RTN","RCDPRPLM",108,0)
 . ;
"RTN","RCDPRPLM",109,0)
 . ;calculate totals
"RTN","RCDPRPLM",110,0)
 . S RCTOTAL(1)=$G(RCTOTAL(1))+RCDPDATA(344.01,RCTRDA,.04,"E")
"RTN","RCDPRPLM",111,0)
 . S RCTOTAL(2)=$G(RCTOTAL(2))+RCDPDATA(344.01,RCTRDA,.05,"E")
"RTN","RCDPRPLM",112,0)
 . ;
"RTN","RCDPRPLM",113,0)
 . ;kill local variable to prevent store errors
"RTN","RCDPRPLM",114,0)
 . K RCDPDATA(344.01,RCTRDA)
"RTN","RCDPRPLM",115,0)
 ;
"RTN","RCDPRPLM",116,0)
 ; show totals
"RTN","RCDPRPLM",117,0)
 K ^TMP($J,"RCEFT")
"RTN","RCDPRPLM",118,0)
 S RCLINE=RCLINE+1 D SET("",RCLINE,1,80)
"RTN","RCDPRPLM",119,0)
 D SET("--------  --------",RCLINE,62,80)
"RTN","RCDPRPLM",120,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",121,0)
 D SET("      TOTAL DOLLARS FOR RECEIPT",RCLINE,1,80)
"RTN","RCDPRPLM",122,0)
 D SET($J($G(RCTOTAL(1)),8,2),RCLINE,62,70)
"RTN","RCDPRPLM",123,0)
 D SET($J($G(RCTOTAL(2)),8,2),RCLINE,72,80)
"RTN","RCDPRPLM",124,0)
 ; show cancelled
"RTN","RCDPRPLM",125,0)
 I $G(RCDPFCAN) D
"RTN","RCDPRPLM",126,0)
 . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",127,0)
 . D SET("**indicates payment is CANCELLED",RCLINE,5,80)
"RTN","RCDPRPLM",128,0)
 ;
"RTN","RCDPRPLM",129,0)
 ; show history
"RTN","RCDPRPLM",130,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",131,0)
 D SET(" ",RCLINE,1,80)
"RTN","RCDPRPLM",132,0)
 ; start history on first line of a screen if it does not fit on
"RTN","RCDPRPLM",133,0)
 ; current screen
"RTN","RCDPRPLM",134,0)
 I (RCLINE#12)>8 F SPACE=(RCLINE#12):1:12 S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPRPLM",135,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",136,0)
 D SET("Receipt History",RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPRPLM",137,0)
 S DATE=RCDPDATA(344,RCRECTDA,.03,"E"),DATE=$P(DATE,"@")_"  "_$P($P(DATE,"@",2),":",1,2)
"RTN","RCDPRPLM",138,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",139,0)
 S SPACE="",$P(SPACE," ",80)=""
"RTN","RCDPRPLM",140,0)
 I RCDPDATA(344,RCRECTDA,.02,"I")=.5 S RCDPDATA(344,RCRECTDA,.02,"E")="accounts receivable"
"RTN","RCDPRPLM",141,0)
 D SET($E("   Opened By: "_RCDPDATA(344,RCRECTDA,.02,"E")_SPACE,1,39)_"Date/Time    Opened: "_DATE,RCLINE,1,80)
"RTN","RCDPRPLM",142,0)
 S DATE=RCDPDATA(344,RCRECTDA,.12,"E"),DATE=$P(DATE,"@")_"  "_$P($P(DATE,"@",2),":",1,2)
"RTN","RCDPRPLM",143,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",144,0)
 I RCDPDATA(344,RCRECTDA,.11,"I")=.5 S RCDPDATA(344,RCRECTDA,.11,"E")="accounts receivable"
"RTN","RCDPRPLM",145,0)
 D SET($E("Last Edit By: "_RCDPDATA(344,RCRECTDA,.11,"E")_SPACE,1,39)_"Date/Time Last Edit: "_DATE,RCLINE,1,80)
"RTN","RCDPRPLM",146,0)
 S DATE=RCDPDATA(344,RCRECTDA,.08,"E"),DATE=$P(DATE,"@")_"  "_$P($P(DATE,"@",2),":",1,2)
"RTN","RCDPRPLM",147,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",148,0)
 I RCDPDATA(344,RCRECTDA,.07,"I")=.5 S RCDPDATA(344,RCRECTDA,.07,"E")="accounts receivable"
"RTN","RCDPRPLM",149,0)
 D SET($E("Processed By: "_RCDPDATA(344,RCRECTDA,.07,"E")_SPACE,1,39)_"Date/Time Processed: "_DATE,RCLINE,1,80)
"RTN","RCDPRPLM",150,0)
 ;
"RTN","RCDPRPLM",151,0)
 ;show fms code sheets if switch on
"RTN","RCDPRPLM",152,0)
 I $$OPTCK^RCDPRPL2("SHOWFMS",2) D
"RTN","RCDPRPLM",153,0)
 . S FMSDOC=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPRPLM",154,0)
 . S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPRPLM",155,0)
 . S RCLINE=RCLINE+1 D SET("FMS Cash Receipt Document:",RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPRPLM",156,0)
 . D SET($P(FMSDOC,"^")_$S($P(FMSDOC,"^",3):"(on deposit)",1:""),RCLINE,28,80)
"RTN","RCDPRPLM",157,0)
 . D SET("Status: "_$P(FMSDOC,"^",2),RCLINE,55,80)
"RTN","RCDPRPLM",158,0)
 . N DIQ2 D DATA^GECSSGET($P(FMSDOC,"^"),1)
"RTN","RCDPRPLM",159,0)
 . I '$G(GECSDATA) Q
"RTN","RCDPRPLM",160,0)
 . S GECSDA1=0 F  S GECSDA1=$O(GECSDATA(2100.1,GECSDATA,10,GECSDA1)) Q:'GECSDA1  D
"RTN","RCDPRPLM",161,0)
 . . S RCLINE=RCLINE+1 D SET(GECSDATA(2100.1,GECSDATA,10,GECSDA1),RCLINE,1,80)
"RTN","RCDPRPLM",162,0)
 ;
"RTN","RCDPRPLM",163,0)
 ; show EEOB detail if switch on
"RTN","RCDPRPLM",164,0)
 D SHEOB^RCDPRPL2
"RTN","RCDPRPLM",165,0)
 ;
"RTN","RCDPRPLM",166,0)
 ; set valmcnt to # of lines in list
"RTN","RCDPRPLM",167,0)
 S VALMCNT=RCLINE
"RTN","RCDPRPLM",168,0)
 D HDR
"RTN","RCDPRPLM",169,0)
 Q
"RTN","RCDPRPLM",170,0)
 ;
"RTN","RCDPRPLM",171,0)
 ;
"RTN","RCDPRPLM",172,0)
SET(STRING,LINE,COLBEG,COLEND,FIELD,ON,OFF) ;  set array
"RTN","RCDPRPLM",173,0)
 I $G(FIELD) S STRING=STRING_$S(STRING="":"",1:": ")_$G(RCDPDATA(344.01,RCTRDA,FIELD,"E"))
"RTN","RCDPRPLM",174,0)
 I STRING="",'$G(FIELD) D SET^VALM10(LINE,$J("",80)) Q
"RTN","RCDPRPLM",175,0)
 I '$D(@VALMAR@(LINE,0)) D SET^VALM10(LINE,$J("",80))
"RTN","RCDPRPLM",176,0)
 D SET^VALM10(LINE,$$SETSTR^VALM1(STRING,@VALMAR@(LINE,0),COLBEG,COLEND-COLBEG+1))
"RTN","RCDPRPLM",177,0)
 I $G(ON)]""!($G(OFF)]"") D CNTRL^VALM10(LINE,COLBEG,$L(STRING),ON,OFF)
"RTN","RCDPRPLM",178,0)
 Q
"RTN","RCDPRPLM",179,0)
 ;
"RTN","RCDPRPLM",180,0)
 ;
"RTN","RCDPRPLM",181,0)
DIQ344(DA,DR) ; retrieves data for flds in file 344
"RTN","RCDPRPLM",182,0)
 N %I,D0,DIC,DIQ,DIQ2,YY
"RTN","RCDPRPLM",183,0)
 K RCDPDATA(344,DA)
"RTN","RCDPRPLM",184,0)
 S DIQ(0)="IE",DIC="^RCY(344,",DIQ="RCDPDATA" D EN^DIQ1
"RTN","RCDPRPLM",185,0)
 Q
"RTN","RCDPRPLM",186,0)
 ;
"RTN","RCDPRPLM",187,0)
 ;
"RTN","RCDPRPLM",188,0)
DIQ34401(DA,SUBDA) ; retrieves data for flds in file 344
"RTN","RCDPRPLM",189,0)
 ; da = receipt da
"RTN","RCDPRPLM",190,0)
 N %I,D0,DIC,DIQ,DIQ2,DR
"RTN","RCDPRPLM",191,0)
 K RCDPDATA(344.01,SUBDA)
"RTN","RCDPRPLM",192,0)
 S DR=1,DR(344.01)=".01:1.02",DA(344.01)=SUBDA
"RTN","RCDPRPLM",193,0)
 S DIQ(0)="IE",DIC="^RCY(344,",DIQ="RCDPDATA" D EN^DIQ1
"RTN","RCDPRPLM",194,0)
 Q
"RTN","RCDPRPLM",195,0)
 ;
"RTN","RCDPRPLM",196,0)
 ;
"RTN","RCDPRPLM",197,0)
HDR ; header code for list manager display
"RTN","RCDPRPLM",198,0)
 N DATE,FMSDOC,RCDPDATA,SPACE,RCEFT,Z
"RTN","RCDPRPLM",199,0)
 D DIQ344(RCRECTDA,".01;.04;.06;.08;.14;.17;.18;")
"RTN","RCDPRPLM",200,0)
 S SPACE="",$P(SPACE," ",80)=""
"RTN","RCDPRPLM",201,0)
 S VALMHDR(1)=$E("   Receipt #: "_RCDPDATA(344,RCRECTDA,.01,"E")_SPACE,1,39)_"Type of Payment: "_RCDPDATA(344,RCRECTDA,.04,"E")
"RTN","RCDPRPLM",202,0)
 S Z=RCDPDATA(344,RCRECTDA,.06,"E"),RCEFT=+$O(^RCY(344.3,"ARDEP",+$P($G(^RCY(344,RCRECTDA,0)),U,6),0))
"RTN","RCDPRPLM",203,0)
 S VALMHDR(2)=$E($S('RCEFT&'RCDPDATA(344,RCRECTDA,.17,"I"):"   Deposit #: "_Z,RCEFT:" EFT Deposit: "_Z,1:"EFT Detail #: "_RCDPDATA(344,RCRECTDA,.17,"E"))_" "_$P($G(^RCY(344.31,+RCDPDATA(344,RCRECTDA,.17,"I"),0)),U,2)_SPACE,1,23)
"RTN","RCDPRPLM",204,0)
 S VALMHDR(2)=VALMHDR(2)_$E($S(RCDPDATA(344,RCRECTDA,.18,"E")'="":"   ERA #: "_RCDPDATA(344,RCRECTDA,.18,"E"),1:"")_SPACE,1,16)_" Receipt Status: "_RCDPDATA(344,RCRECTDA,.14,"E")
"RTN","RCDPRPLM",205,0)
 ;  get fms document and status
"RTN","RCDPRPLM",206,0)
 S FMSDOC=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPRPLM",207,0)
 S VALMHDR(3)=$E("FMS Document: "_$TR($P(FMSDOC,"^")," ")_$S($P(FMSDOC,"^",3):"(on deposit)",1:"")_SPACE,1,39)_" FMS Doc Status: "_$P(FMSDOC,"^",2)
"RTN","RCDPRPLM",208,0)
 ;
"RTN","RCDPRPLM",209,0)
 I RCDPDATA(344,RCRECTDA,.08,"I") S VALMSG="Receipt processed on "_RCDPDATA(344,RCRECTDA,.08,"E")
"RTN","RCDPRPLM",210,0)
 Q
"RTN","RCDPRPLM",211,0)
 ;
"RTN","RCDPRPLM",212,0)
 ;
"RTN","RCDPRPLM",213,0)
EXIT ; exit option/clean up
"RTN","RCDPRPLM",214,0)
 K ^TMP("RCDPRPLM",$J)
"RTN","RCDPRPLM",215,0)
 Q
"RTN","RCDPURE1")
0^3^B55071399
"RTN","RCDPURE1",1,0)
RCDPURE1 ;WISC/RFJ-process a receipt ;1 Jun 99
"RTN","RCDPURE1",2,0)
 ;;4.5;Accounts Receivable;**114,148,153,169,204,173,214,217**;Mar 20, 1995
"RTN","RCDPURE1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPURE1",4,0)
 Q
"RTN","RCDPURE1",5,0)
 ;
"RTN","RCDPURE1",6,0)
 ;
"RTN","RCDPURE1",7,0)
PROCESS(RCRECTDA,RCSCREEN) ;  process a receipt, update ar, generate cr/tr documents to fms
"RTN","RCDPURE1",8,0)
 ;  the receipt and deposit must be locked before calling this label
"RTN","RCDPURE1",9,0)
 ;  if $g(rcscreen) = 1 show messages during processing
"RTN","RCDPURE1",10,0)
 ;  if $g(rcscreen) = 2 store messages during processing
"RTN","RCDPURE1",11,0)
 N RCPAYDA,RCDPFPAY,RCERROR,RCMSG,RCEFT,RCERA
"RTN","RCDPURE1",12,0)
 K ^TMP($J,"RCDPEMSG")
"RTN","RCDPURE1",13,0)
 ;
"RTN","RCDPURE1",14,0)
 ;  first mark the receipt as processed/closed to prevent changing the
"RTN","RCDPURE1",15,0)
 ;  data if the receipt does not fully process.  this will lock the
"RTN","RCDPURE1",16,0)
 ;  cancel payment, edit payment, etc. options.  once a receipt is
"RTN","RCDPURE1",17,0)
 ;  processed, even partially, it should not be changed.
"RTN","RCDPURE1",18,0)
 D MARKPROC^RCDPUREC(RCRECTDA,"")
"RTN","RCDPURE1",19,0)
 ;
"RTN","RCDPURE1",20,0)
 ; Special processing needed for EFT-related receipts
"RTN","RCDPURE1",21,0)
 ; RCEFT = 1 if EFT deposit, = 2 if receipt detail transfer, 0 if no EFT
"RTN","RCDPURE1",22,0)
 S RCEFT=+$$EDILB^RCDPEU(RCRECTDA)
"RTN","RCDPURE1",23,0)
 S RCERA=$P($G(^RCY(344,RCRECTDA,0)),U,18)
"RTN","RCDPURE1",24,0)
 ;
"RTN","RCDPURE1",25,0)
 ;  === no payments ===
"RTN","RCDPURE1",26,0)
 ;  if there are no payments for the receipt, quit
"RTN","RCDPURE1",27,0)
 I '$O(^RCY(344,RCRECTDA,1,0)) D  Q
"RTN","RCDPURE1",28,0)
 .   I $G(RCSCREEN) S RCMSG="Receipt does not have any payments and has been marked as processed/closed." D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",29,0)
 .   I RCERA D UPDERA(RCERA)
"RTN","RCDPURE1",30,0)
 ;
"RTN","RCDPURE1",31,0)
 ;  check to see if the payments have dollar amounts
"RTN","RCDPURE1",32,0)
 S RCPAYDA=0 F  S RCPAYDA=$O(^RCY(344,RCRECTDA,1,RCPAYDA)) Q:'RCPAYDA  I $P($G(^(RCPAYDA,0)),"^",4) S RCDPFPAY=1 Q
"RTN","RCDPURE1",33,0)
 I '$G(RCDPFPAY) D  Q
"RTN","RCDPURE1",34,0)
 .   I $G(RCSCREEN)  S RCMSG="Receipt does not have any payments and has been marked as processed/closed." D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",35,0)
 .   I RCERA D UPDERA(RCERA)
"RTN","RCDPURE1",36,0)
 ;
"RTN","RCDPURE1",37,0)
 ;  === update AR accounts ===
"RTN","RCDPURE1",38,0)
 I $G(RCSCREEN) S RCMSG="Updating AR accounts..." D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",39,0)
 ;
"RTN","RCDPURE1",40,0)
 ;  loop payments and apply to account in AR
"RTN","RCDPURE1",41,0)
 S RCPAYDA=0 F  S RCPAYDA=$O(^RCY(344,RCRECTDA,1,RCPAYDA)) Q:'RCPAYDA  D  I RCERROR Q
"RTN","RCDPURE1",42,0)
 .   S RCERROR=$$PROCESS^RCBEPAY(RCRECTDA,RCPAYDA)
"RTN","RCDPURE1",43,0)
 ;
"RTN","RCDPURE1",44,0)
 ;  an error occurred during processing a payment
"RTN","RCDPURE1",45,0)
 I $G(RCERROR) D  Q
"RTN","RCDPURE1",46,0)
 .   I '$G(RCSCREEN) Q
"RTN","RCDPURE1",47,0)
 .   S RCMSG="+-----------------------------------------------------------------------------+" D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",48,0)
 .   S RCMSG="|  An ERROR has occurred when processing payment "_RCPAYDA_" on receipt "_$P(^RCY(344,RCRECTDA,0),"^")_".",RCMSG=$E(RCMSG_$J("",77),1,77)_"|" D MSG(RCMSG,RCSCREEN,"!")
"RTN","RCDPURE1",49,0)
 .   S RCMSG="|  The error message returned during processing is:",RCMSG=$E(RCMSG_$J("",77),1,77)_"|" D MSG(RCMSG,RCSCREEN,"!")
"RTN","RCDPURE1",50,0)
 .   S RCMSG="|"_$J("",77)_"|" D MSG(RCMSG,RCSCREEN,"!")
"RTN","RCDPURE1",51,0)
 .   S RCMSG=$E("|  "_$P(RCERROR,"^",2)_$J("",77),1,77)_"|" D MSG(RCMSG,RCSCREEN,"!")
"RTN","RCDPURE1",52,0)
 .   S RCMSG="|"_$J("",77)_"|" D MSG(RCMSG,RCSCREEN,"!")
"RTN","RCDPURE1",53,0)
 .   S RCMSG=$E("|  You will need to correct the error before you can completely process the"_$J("",77),1,77)_"|" D MSG(RCMSG,RCSCREEN,"!")
"RTN","RCDPURE1",54,0)
 .   S RCMSG=$E("|  receipt.  Once the receipt is completely processed, the FMS "_$S(RCEFT'=2:"Cash Receipt",1:"'TR'")_$J("",77),1,77)_"|" D MSG(RCMSG,RCSCREEN,"!")
"RTN","RCDPURE1",55,0)
 .   S RCMSG=$E("|  document will be generated."_$J("",77),1,77)_"|" D MSG(RCMSG,RCSCREEN,"!")
"RTN","RCDPURE1",56,0)
 .   S RCMSG="+-----------------------------------------------------------------------------+" D MSG(RCMSG,RCSCREEN,"!")
"RTN","RCDPURE1",57,0)
 ;
"RTN","RCDPURE1",58,0)
 ;  all payments processed correctly
"RTN","RCDPURE1",59,0)
 I RCERA D UPDERA(RCERA)
"RTN","RCDPURE1",60,0)
 I $G(RCSCREEN) D MSG(" Done.",RCSCREEN)
"RTN","RCDPURE1",61,0)
 ;
"RTN","RCDPURE1",62,0)
 ;  if no deposit ticket and not related to EFT or is a HAC payment, do not send to fms
"RTN","RCDPURE1",63,0)
 I '$P(^RCY(344,RCRECTDA,0),"^",6),$S('RCEFT:1,1:$$HACEFT^RCDPEU(+$P(^RCY(344,RCRECTDA,0),U,17))) D  Q
"RTN","RCDPURE1",64,0)
 .   D 215
"RTN","RCDPURE1",65,0)
 .   I $G(RCSCREEN) S RCMSG="Receipt does not have a deposit ticket and will NOT be sent to FMS." D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",66,0)
 ;
"RTN","RCDPURE1",67,0)
 ;  === send fms cash receipt document ===
"RTN","RCDPURE1",68,0)
 N GECSDATA,FMSDOCNO,RESULT,REFMS
"RTN","RCDPURE1",69,0)
 ;  lookup fms document number to see if the receipt has been
"RTN","RCDPURE1",70,0)
 ;  sent to fms (field 200 in file 344)
"RTN","RCDPURE1",71,0)
 S FMSDOCNO=$P($G(^RCY(344,RCRECTDA,2)),"^")
"RTN","RCDPURE1",72,0)
 ;  if there is an entry, find the code sheet in gcs to rebuild
"RTN","RCDPURE1",73,0)
 ;  gecsdata will be the ien for file 2100.1
"RTN","RCDPURE1",74,0)
 I FMSDOCNO'="" S REFMS=1 N DIQ2 D DATA^GECSSGET(FMSDOCNO,0)
"RTN","RCDPURE1",75,0)
 ;
"RTN","RCDPURE1",76,0)
 I $G(RCSCREEN)&$G(GECSDATA) S RCMSG="Re-Transmitting CR document to FMS... " D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",77,0)
 I $G(RCSCREEN)&'$G(GECSDATA) S RCMSG="Transmitting CR document to FMS... " D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",78,0)
 ;
"RTN","RCDPURE1",79,0)
 ;  build and send the tr/cr document to fms
"RTN","RCDPURE1",80,0)
 I RCEFT'=2 D  ; Send CR doc
"RTN","RCDPURE1",81,0)
 . S RESULT=$$BUILDCR^RCXFMSCR(RCRECTDA,+$G(GECSDATA),RCEFT)
"RTN","RCDPURE1",82,0)
 E  D  ; Send TR doc
"RTN","RCDPURE1",83,0)
 . S RESULT=$$GETTR^RCXFMST1(RCRECTDA,+$G(GECSDATA))
"RTN","RCDPURE1",84,0)
 ;  error in building code sheet
"RTN","RCDPURE1",85,0)
 I 'RESULT D:$G(RCSCREEN) MSG("ERROR - "_$P(RESULT,"^",2),RCSCREEN,"!!") Q
"RTN","RCDPURE1",86,0)
 ;
"RTN","RCDPURE1",87,0)
 ;  no document to send
"RTN","RCDPURE1",88,0)
 I $P(RESULT,"^")=-1,$G(RCSCREEN) S RCMSG="NOTE - "_$P(RESULT,"^",2) S $P(RESULT,"^",2)="" D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",89,0)
 ;  document built and sent
"RTN","RCDPURE1",90,0)
 I $P(RESULT,"^")=1,$G(RCSCREEN) D
"RTN","RCDPURE1",91,0)
 . N Z,DIE,DR,DA
"RTN","RCDPURE1",92,0)
 . D MSG("Done. FMS document number "_$P(RESULT,"^",2),RCSCREEN,"!!")
"RTN","RCDPURE1",93,0)
 . I +$O(^RCY(344.4,"ARCT",RCRECTDA,0)) S DIE="^RCY(344.4,",DR=".14////1",DA=+$O(^RCY(344.4,"ARCT",RCRECTDA,0)) D ^DIE
"RTN","RCDPURE1",94,0)
 . I $P($G(^RCY(344,RCRECTDA,0)),U,17) S Z=$P($G(^RCY(344.31,+$P(^RCY(344,RCRECTDA,0),U,17),0)),U,15) I Z'="" S DA=RCRECTDA,DIE="^RCY(344,",DR=".16////"_Z D ^DIE
"RTN","RCDPURE1",95,0)
 I $G(RCSCREEN) D
"RTN","RCDPURE1",96,0)
 . I '$G(REFMS)&(DT>$$LDATE^RCRJR(DT)) S Y=$E($$FPS^RCAMFN01(DT,1),1,5)_"01" D DD^%DT W !! S RCMSG="   * * * * Transmission will be held until "_Y_" * * * *" D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",97,0)
 ;
"RTN","RCDPURE1",98,0)
 ;
"RTN","RCDPURE1",99,0)
 ;  store the fms document number (receipt already marked processed/
"RTN","RCDPURE1",100,0)
 ;  closed at the top of the routine just before posting the dollars.
"RTN","RCDPURE1",101,0)
 D MARKPROC^RCDPUREC(RCRECTDA,$P(RESULT,"^",2))
"RTN","RCDPURE1",102,0)
 I RCEFT=2 D MSG("No 215 report generated for this receipt",RCSCREEN,"!!") G Q215
"RTN","RCDPURE1",103,0)
 ;
"RTN","RCDPURE1",104,0)
 ;
"RTN","RCDPURE1",105,0)
215 ;  === print 215 report ===
"RTN","RCDPURE1",106,0)
 I $G(RCSCREEN) D MSG("Queuing 215 report...",RCSCREEN,"!!")
"RTN","RCDPURE1",107,0)
 N DEVICE
"RTN","RCDPURE1",108,0)
 S DEVICE=$$OPTCK^RCDPRPL2("215REPORT",3)
"RTN","RCDPURE1",109,0)
 I DEVICE="" D:$G(RCSCREEN) MSG(" Use Customize Option to set up the default printer.",RCSCREEN) Q
"RTN","RCDPURE1",110,0)
 ;
"RTN","RCDPURE1",111,0)
 S ZTIO=DEVICE,ZTDTH=$H,ZTRTN="DQ^RCDPR215",ZTSAVE("RECEIPDA")=RCRECTDA,ZTSAVE("RCTYPE")="A"
"RTN","RCDPURE1",112,0)
 D ^%ZTLOAD,^%ZISC
"RTN","RCDPURE1",113,0)
Q215 I $G(RCSCREEN) D MSG(" Done.",RCSCREEN)
"RTN","RCDPURE1",114,0)
 Q
"RTN","RCDPURE1",115,0)
 ;
"RTN","RCDPURE1",116,0)
UPDERA(RCERA) ; Update detail posted status for ERA entry RCERA
"RTN","RCDPURE1",117,0)
 ;
"RTN","RCDPURE1",118,0)
 N DA,DIE,DR
"RTN","RCDPURE1",119,0)
 S DA=+$G(RCERA),DR=".14////1",DIE="^RCY(344.4," D:DA ^DIE
"RTN","RCDPURE1",120,0)
 Q
"RTN","RCDPURE1",121,0)
 ;
"RTN","RCDPURE1",122,0)
MSG(RCMSG,RCSCREEN,PRELINE,POSTLINE) ; Write message or set into msg array
"RTN","RCDPURE1",123,0)
 ; RCMSG = text to write  RCSCREEN = screen flag
"RTN","RCDPURE1",124,0)
 ; PRELINE = the line feeds to print before the text
"RTN","RCDPURE1",125,0)
 ; POSTLINE = the line feeds to print after the text
"RTN","RCDPURE1",126,0)
 Q:'RCSCREEN
"RTN","RCDPURE1",127,0)
 N RCPRE,RCPOST,Z
"RTN","RCDPURE1",128,0)
 S RCPRE=$L($G(PRELINE),"!")-1,RCPOST=$L($G(POSTLINE),"!")-1
"RTN","RCDPURE1",129,0)
 I RCSCREEN=1 D  G MSGQ
"RTN","RCDPURE1",130,0)
 . F Z=1:1:RCPRE W !
"RTN","RCDPURE1",131,0)
 . W RCMSG
"RTN","RCDPURE1",132,0)
 . F Z=1:1:RCPOST W !
"RTN","RCDPURE1",133,0)
 F Z=1:1:RCPRE S ^TMP($J,"RCDPEMSG",+$O(^TMP("RCDPEMSG",""),-1)+1)=""
"RTN","RCDPURE1",134,0)
 S ^TMP($J,"RCDPEMSG",+$O(^TMP("RCDPEMSG",""),-1)+1)=RCMSG
"RTN","RCDPURE1",135,0)
 F Z=1:1:RCPOST S ^TMP($J,"RCDPEMSG",+$O(^TMP("RCDPEMSG",""),-1)+1)=""
"RTN","RCDPURE1",136,0)
MSGQ Q
"RTN","RCDPURE1",137,0)
 ;
"RTN","RCDPURE1",138,0)
EDIT4(DA,DR,RCDR1,RCDR2,RCDR3) ; Modify DR string for type of payment edit
"RTN","RCDPURE1",139,0)
 ;   for EDI Lockbox
"RTN","RCDPURE1",140,0)
 ; Input: DA,DR   Output: RCDR1,RCDR2,RCDR3
"RTN","RCDPURE1",141,0)
 ; If type unchanged, or neither old/new are EDI Lockbox, no chk needed
"RTN","RCDPURE1",142,0)
 ; If old type is EDI Lockbox and scratch pad exists, no change allowed
"RTN","RCDPURE1",143,0)
 ; If changed to EDI Lockbox and detail already exists, no chg allowed
"RTN","RCDPURE1",144,0)
 ; If changed to EDI Lockbox, ask for related EFT
"RTN","RCDPURE1",145,0)
 N Z,Z0,RCSTRT,RCLST,RCDR,RCOE,RCNE,RCNO,RCM,RCM1,RCM2,RCM3,RCO4,RCN4,RCP,DIPA
"RTN","RCDPURE1",146,0)
 S (RCDR1,RCDR2,RCDR3)=""
"RTN","RCDPURE1",147,0)
 ;
"RTN","RCDPURE1",148,0)
 S RCP=10 F Z=2:1 Q:DR'[("@"_RCP)&(DR'[("@"_(RCP+1)))&(DR'[("@"_(RCP+2)))&(DR'[("@"_(RCP+3)))&(DR'[("@"_(RCP+4)))  S RCP=RCP*Z
"RTN","RCDPURE1",149,0)
 ;
"RTN","RCDPURE1",150,0)
 S Z=$L(DR,".04;"),RCSTRT=1,RCLST=Z
"RTN","RCDPURE1",151,0)
 I Z>2 D  ; Find .04, not n.04
"RTN","RCDPURE1",152,0)
 . F  S Z0=$P(DR,".04;",RCSTRT) Q:Z0=""!'$E(Z0,$L(Z0))  S RCSTRT=RCSTRT+1
"RTN","RCDPURE1",153,0)
 ;
"RTN","RCDPURE1",154,0)
 ; If unchanged/changed from/to other than EDI Lockbox, jump over edits
"RTN","RCDPURE1",155,0)
 S RCDR1="S RCP="_RCP_" D SETV^RCDPURE1;"_$P(DR,".04;",1,RCSTRT)
"RTN","RCDPURE1",156,0)
 S RCDR2="@"_RCP_";.04;S RCNO=0,RCN4=X D TYP^RCDPUREC(.Y);.17////^S X=RCNE;S Y=""@"_(RCP+2)_""""
"RTN","RCDPURE1",157,0)
 ; Reset field .04 and .17 if not a valid type change
"RTN","RCDPURE1",158,0)
 S RCDR2=RCDR2_";@"_(RCP+1)_";.04////^S X=RCO4;I RCOE="""" S Y=""@"_(RCP+3)_""";.17////^S X=RCOE;@"_(RCP+3)_";W !,*7,$S(RCO4=14:$S('RCNO:RCM1,1:RCM2),1:RCM) S Y=""@"_RCP_""";@"_(RCP+2)
"RTN","RCDPURE1",159,0)
 S RCDR3=$P(DR,".04;",RCSTRT+1,RCLST)
"RTN","RCDPURE1",160,0)
 Q
"RTN","RCDPURE1",161,0)
 ;
"RTN","RCDPURE1",162,0)
SETV ; Set up variables needed to edit change of receipt type
"RTN","RCDPURE1",163,0)
 S DIPA("RCPT")=$G(^RCY(344,DA,0)),RCO4=$P(DIPA("RCPT"),U,4),RCOE=$P(DIPA("RCPT"),U,17)
"RTN","RCDPURE1",164,0)
 S RCM="EDI Lockbox payment type is invalid for this receipt",RCM1="Payment type can't be changed once detail has been loaded from the ERA",RCM2="Must have an EFT for an EFT Lockbox payment type"
"RTN","RCDPURE1",165,0)
 S RCM3=">>If receipt is for an ERA and a paper check, select the ERA now"
"RTN","RCDPURE1",166,0)
 Q
"RTN","RCDPURE1",167,0)
 ;
"RTN","RCDPURE1",168,0)
WL(DA) ; Function returns 0 if the worklist did not create the receipt
"RTN","RCDPURE1",169,0)
 ;  or the ien of the worklist entry if it did (344.4 and 344.49 are DINUMED)
"RTN","RCDPURE1",170,0)
 N Z
"RTN","RCDPURE1",171,0)
 S Z=+$O(^RCY(344.4,"AREC",DA,0))
"RTN","RCDPURE1",172,0)
 Q Z
"RTN","RCDPURE1",173,0)
 ;
"RTN","RCDPURE1",174,0)
HAC(RC) ; Returns 1 if the receipt in RC is related to a HAC EFT
"RTN","RCDPURE1",175,0)
 N Z,HAC
"RTN","RCDPURE1",176,0)
 S HAC=0
"RTN","RCDPURE1",177,0)
 ; ERA related to an EFT detail record
"RTN","RCDPURE1",178,0)
 S Z=+$G(^RCY(344.31,+$P($G(^RCY(344,RC,0)),U,17),0))
"RTN","RCDPURE1",179,0)
 ; Deposit # in EFT transmission starts with HAC
"RTN","RCDPURE1",180,0)
 I Z S Z=$P($G(^RCY(344.3,+Z,0)),U,6) I $E(Z,1,3)="HAC" S HAC=1
"RTN","RCDPURE1",181,0)
 Q HAC
"RTN","RCDPURE1",182,0)
 ;
"SEC","^DIC",342.3,342.3,0,"AUDIT")
@
"SEC","^DIC",342.3,342.3,0,"DD")
@
"SEC","^DIC",342.3,342.3,0,"DEL")
@
"SEC","^DIC",342.3,342.3,0,"LAYGO")
@
"SEC","^DIC",342.3,342.3,0,"RD")
@
"SEC","^DIC",342.3,342.3,0,"WR")
@
"VER")
8.0^22
"^DD",342.3,342.3,0)
FIELD^^1^2
"^DD",342.3,342.3,0,"DDA")
N
"^DD",342.3,342.3,0,"DT")
3040506
"^DD",342.3,342.3,0,"IX","B",342.3,.01)

"^DD",342.3,342.3,0,"NM","AR USER CUSTOMIZE")

"^DD",342.3,342.3,0,"VRPK")
PRCA
"^DD",342.3,342.3,.01,0)
SCREEN/OPTIONS^RF^^0;1^K:$L(X)>30!($L(X)<3) X
"^DD",342.3,342.3,.01,1,0)
^.1
"^DD",342.3,342.3,.01,1,1,0)
342.3^B
"^DD",342.3,342.3,.01,1,1,1)
S ^RC(342.3,"B",$E(X,1,30),DA)=""
"^DD",342.3,342.3,.01,1,1,2)
K ^RC(342.3,"B",$E(X,1,30),DA)
"^DD",342.3,342.3,.01,3)
Answer must be 3-30 characters in length.
"^DD",342.3,342.3,.01,21,0)
^.001^2^2^3040615^^^^
"^DD",342.3,342.3,.01,21,1,0)
This field contains the screen/options used as the routine entry
"^DD",342.3,342.3,.01,21,2,0)
point for customizing and printing.
"^DD",342.3,342.3,.01,"DT")
3040614
"^DD",342.3,342.3,1,0)
USER PARAMETERS^342.31PA^^1;0
"^DD",342.3,342.3,1,21,0)
^.001^2^2^3040615^^^^
"^DD",342.3,342.3,1,21,1,0)
This multiple stores user's set up to customize the screen and the 
"^DD",342.3,342.3,1,21,2,0)
printer options.
"^DD",342.3,342.3,1,"DT")
3040609
"^DD",342.3,342.31,0)
USER PARAMETERS SUB-FIELD^^2^3
"^DD",342.3,342.31,0,"DT")
3040506
"^DD",342.3,342.31,0,"IX","B",342.31,.01)

"^DD",342.3,342.31,0,"NM","USER PARAMETERS")

"^DD",342.3,342.31,0,"UP")
342.3
"^DD",342.3,342.31,.01,0)
ENTERED BY^RP200'^VA(200,^0;1^Q
"^DD",342.3,342.31,.01,1,0)
^.1
"^DD",342.3,342.31,.01,1,1,0)
342.31^B
"^DD",342.3,342.31,.01,1,1,1)
S ^RC(342.3,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",342.3,342.31,.01,1,1,2)
K ^RC(342.3,DA(1),1,"B",$E(X,1,30),DA)
"^DD",342.3,342.31,.01,21,0)
^.001^1^1^3040615^^^^
"^DD",342.3,342.31,.01,21,1,0)
This field contains the DUZ of each person who accesses the AR system.
"^DD",342.3,342.31,.01,"DT")
3040507
"^DD",342.3,342.31,1,0)
SELECTION^S^0:NO;1:YES;2:MAYBE;^0;2^Q
"^DD",342.3,342.31,1,21,0)
^^2^2^3040506^
"^DD",342.3,342.31,1,21,1,0)
This field contains a user's most recent selection to customize the 
"^DD",342.3,342.31,1,21,2,0)
screen/options.
"^DD",342.3,342.31,1,"DT")
3040608
"^DD",342.3,342.31,2,0)
DEVICE^F^^0;3^K:$L(X)>30!($L(X)<3) X
"^DD",342.3,342.31,2,3)
Answer must be 3-30 characters in length.
"^DD",342.3,342.31,2,21,0)
^^2^2^3040506^
"^DD",342.3,342.31,2,21,1,0)
This field contains the device for a user to print the receipt and the 
"^DD",342.3,342.31,2,21,2,0)
215 report.
"^DD",342.3,342.31,2,"DT")
3040506
"^DIC",342.3,342.3,0)
AR USER CUSTOMIZE^342.3
"^DIC",342.3,342.3,0,"GL")
^RC(342.3,
"^DIC",342.3,342.3,"%",0)
^1.005^^0
"^DIC",342.3,342.3,"%D",0)
^^2^2^3040614^
"^DIC",342.3,342.3,"%D",1,0)
This file stores the most recently selected parameters and the printer to 
"^DIC",342.3,342.3,"%D",2,0)
be called by a user when customizing the screen and the printer options.
"^DIC",342.3,"B","AR USER CUSTOMIZE",342.3)

**END**
**END**
