Released SD*5.3*336 SEQ #292
Extracted from mail message
**KIDS**:SD*5.3*336^

**INSTALL NAME**
SD*5.3*336
"BLD",5315,0)
SD*5.3*336^SCHEDULING^0^3040212^y
"BLD",5315,1,0)
^^3^3^3040212^
"BLD",5315,1,1,0)
Fix locking mechanism in SCRPW16 and dis-allow today's date from checkout 
"BLD",5315,1,2,0)
process.  Also, the Encounter Action Required Report is incorrectly 
"BLD",5315,1,3,0)
indicating Environmental Contaminants when it should be MST.
"BLD",5315,4,0)
^9.64PA^^
"BLD",5315,"KRN",0)
^9.67PA^8989.52^19
"BLD",5315,"KRN",.4,0)
.4
"BLD",5315,"KRN",.401,0)
.401
"BLD",5315,"KRN",.402,0)
.402
"BLD",5315,"KRN",.403,0)
.403
"BLD",5315,"KRN",.5,0)
.5
"BLD",5315,"KRN",.84,0)
.84
"BLD",5315,"KRN",3.6,0)
3.6
"BLD",5315,"KRN",3.8,0)
3.8
"BLD",5315,"KRN",9.2,0)
9.2
"BLD",5315,"KRN",9.8,0)
9.8
"BLD",5315,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5315,"KRN",9.8,"NM",1,0)
SCRPW16^^0^B42185215
"BLD",5315,"KRN",9.8,"NM","B","SCRPW16",1)

"BLD",5315,"KRN",19,0)
19
"BLD",5315,"KRN",19.1,0)
19.1
"BLD",5315,"KRN",101,0)
101
"BLD",5315,"KRN",409.61,0)
409.61
"BLD",5315,"KRN",771,0)
771
"BLD",5315,"KRN",870,0)
870
"BLD",5315,"KRN",8989.51,0)
8989.51
"BLD",5315,"KRN",8989.52,0)
8989.52
"BLD",5315,"KRN",8994,0)
8994
"BLD",5315,"KRN","B",.4,.4)

"BLD",5315,"KRN","B",.401,.401)

"BLD",5315,"KRN","B",.402,.402)

"BLD",5315,"KRN","B",.403,.403)

"BLD",5315,"KRN","B",.5,.5)

"BLD",5315,"KRN","B",.84,.84)

"BLD",5315,"KRN","B",3.6,3.6)

"BLD",5315,"KRN","B",3.8,3.8)

"BLD",5315,"KRN","B",9.2,9.2)

"BLD",5315,"KRN","B",9.8,9.8)

"BLD",5315,"KRN","B",19,19)

"BLD",5315,"KRN","B",19.1,19.1)

"BLD",5315,"KRN","B",101,101)

"BLD",5315,"KRN","B",409.61,409.61)

"BLD",5315,"KRN","B",771,771)

"BLD",5315,"KRN","B",870,870)

"BLD",5315,"KRN","B",8989.51,8989.51)

"BLD",5315,"KRN","B",8989.52,8989.52)

"BLD",5315,"KRN","B",8994,8994)

"BLD",5315,"QUES",0)
^9.62^^
"BLD",5315,"REQB",0)
^9.611^4^4
"BLD",5315,"REQB",1,0)
SD*5.3*139^2
"BLD",5315,"REQB",2,0)
SD*5.3*144^2
"BLD",5315,"REQB",3,0)
SD*5.3*155^2
"BLD",5315,"REQB",4,0)
SD*5.3*161^2
"BLD",5315,"REQB","B","SD*5.3*139",1)

"BLD",5315,"REQB","B","SD*5.3*144",2)

"BLD",5315,"REQB","B","SD*5.3*155",3)

"BLD",5315,"REQB","B","SD*5.3*161",4)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
336^3040212
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3040212
"PKG",16,22,1,"PAH",1,1,1,0)
Fix locking mechanism in SCRPW16 and dis-allow today's date from checkout 
"PKG",16,22,1,"PAH",1,1,2,0)
process.  Also, the Encounter Action Required Report is incorrectly 
"PKG",16,22,1,"PAH",1,1,3,0)
indicating Environmental Contaminants when it should be MST.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SCRPW16")
0^1^B42185215
"RTN","SCRPW16",1,0)
SCRPW16 ;RENO/KEITH - Encounter 'Action Required' Report ; 01 Jan 99  9:27 PM
"RTN","SCRPW16",2,0)
 ;;5.3;Scheduling;**139,144,155,161,336**;AUG 13, 1993
"RTN","SCRPW16",3,0)
 N SD,SDDIV,ZTSAVE,%DT,DIR,DTOUT,DUOUT,X,Y
"RTN","SCRPW16",4,0)
 D TITL^SCRPW50("Encounter 'Action Required' Report")
"RTN","SCRPW16",5,0)
 G:'$$DIVA^SCRPW17(.SDDIV) EXIT
"RTN","SCRPW16",6,0)
 D SUBT^SCRPW50("**** Date Range Selection ****")
"RTN","SCRPW16",7,0)
 W ! S %DT="AEPX",%DT("A")="Beginning date: " D ^%DT G:Y<1 EXIT S SD("BDT")=Y
"RTN","SCRPW16",8,0)
EDT S %DT("A")="   Ending date: " W ! D ^%DT G:Y<1 EXIT
"RTN","SCRPW16",9,0)
 I Y<SD("BDT") W !!,$C(7),"End date cannot be before begin date!",! G EDT
"RTN","SCRPW16",10,0)
 S SD("EDT")=Y_.999999
"RTN","SCRPW16",11,0)
 D SUBT^SCRPW50("*** Report Format Selection ***")
"RTN","SCRPW16",12,0)
 S DIR(0)="S^D:DETAILED REPORT;S:STATISTICS ONLY",DIR("A")="Select report type",DIR("B")="DETAILED REPORT" D ^DIR G:($D(DTOUT)!$D(DUOUT)) EXIT S SD("STAT")=Y
"RTN","SCRPW16",13,0)
 G:'$$ASK^SCRPW17(0,0,.SD,"",$S(SD("STAT")="D":"A",1:"A^1"),1) EXIT
"RTN","SCRPW16",14,0)
 I SD("STAT")="D" K DIR S DIR(0)="Y",DIR("A")="Would you like a separate page for every clinic",DIR("B")="NO" W ! D ^DIR G:($D(DTOUT)!$D(DUOUT)) EXIT S SD("PAGE")=Y
"RTN","SCRPW16",15,0)
 W !!,"This report requires 132 column output.",! S ZTSAVE("SDDIV")="",ZTSAVE("SDDIV(")="",ZTSAVE("SD(")="" D EN^XUTMDEVQ("RUN^SCRPW16","Enc. 'Act. Req.' Rpt.",.ZTSAVE) G EXIT
"RTN","SCRPW16",16,0)
 ;
"RTN","SCRPW16",17,0)
RUN ;Print report
"RTN","SCRPW16",18,0)
 K ^TMP("SCRPW",$J),SDSEG,SDSTR,SDT S (SDOUT,SDLK)=0
"RTN","SCRPW16",19,0)
 ;If date range includes TODAY, update appointment status
"RTN","SCRPW16",20,0)
 I SD("BDT")'>DT,SD("EDT")'<DT D  G:SDOUT EXIT
"RTN","SCRPW16",21,0)
 .D LOCK Q:SDOUT!'SDLK
"RTN","SCRPW16",22,0)
 .N SDBEG,SDEND,X,%,%H,%I D NOW^%DTC S SDBEG=DT,SDEND=%
"RTN","SCRPW16",23,0)
 .S SDEND=($P(SDEND,".")-1)_"."_999999
"RTN","SCRPW16",24,0)
 .D EN^SDAMQ3(SDBEG,SDEND) K ^TMP("SDSTATS",$J) L -^SCRPW16("ACTION REQUIRED REPORT") Q
"RTN","SCRPW16",25,0)
 S SDT(2)=$$T2^SCRPW18(),SDDT=SD("BDT"),SDSEG=$$SEGS^SCRPW18(.SDSEG) D STR^SCRPW18(.SDSTR) S (SDOUT,SDSTOP)=0,SDMD="",SDMD=$O(SDDIV(SDMD)),SDMD=$O(SDDIV(SDMD)) S:$P(SDDIV,U,2)="ALL DIVISIONS" SDMD=1
"RTN","SCRPW16",26,0)
 F  S SDDT=$O(^SCE("B",SDDT)) Q:'SDDT!(SDDT>SD("EDT"))!SDOUT  S SDOE=0 F  S SDOE=$O(^SCE("B",SDDT,SDOE)) Q:'SDOE!SDOUT  D EVAL
"RTN","SCRPW16",27,0)
 G:SDOUT EXIT
"RTN","SCRPW16",28,0)
 S SDIV="" F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""  D STOP Q:SDOUT  D
"RTN","SCRPW16",29,0)
 .S SDFCT(SDIV)=0,SDCG="" F  S SDCG=$O(^TMP("SCRPW",$J,SDIV,1,SDCG)) Q:SDCG=""  S SDTCT=0 D CT1 S ^TMP("SCRPW",$J,SDIV,1,SDCG)=SDTCT
"RTN","SCRPW16",30,0)
 .Q
"RTN","SCRPW16",31,0)
 G:SDOUT EXIT
"RTN","SCRPW16",32,0)
 S SDIV="" F  S SDIV=$O(SDDIV(SDIV)) Q:'SDIV  S SDIV(SDDIV(SDIV))=SDIV
"RTN","SCRPW16",33,0)
 I 'SDDIV,$P(SDDIV,U,2)'="ALL DIVISIONS" S SDIV($P(SDDIV,U,2))=$$PRIM^VASITE()
"RTN","SCRPW16",34,0)
 I $P(SDDIV,U,2)="ALL DIVISIONS" S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,SDI)) Q:'SDI  S SDX=$P($G(^DG(40.8,SDI,0)),U) S:$L(SDX) SDIV(SDX)=SDI
"RTN","SCRPW16",35,0)
 D HD1^SCRPW18 D:$E(IOST)="C" DISP0^SCRPW23 I '$O(^TMP("SCRPW",$J,0)) S SDIV=0 D DHDR^SCRPW40(3,.SDT) D HDR^SCRPW18(.SDT,"") Q:SDOUT  S SDX="No activity found within selected report parameters!" W !!?(IOM-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW16",36,0)
 S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  S SDIV=SDIV(SDIVN) D DPRT(.SDIV)
"RTN","SCRPW16",37,0)
 S SDI=0,SDI=$O(^TMP("SCRPW",$J,SDI)),SDMD=$O(^TMP("SCRPW",$J,SDI))
"RTN","SCRPW16",38,0)
 G:SDOUT EXIT I SDMD S SDIV=0 D DPRT(.SDIV)
"RTN","SCRPW16",39,0)
 I 'SDOUT,$E(IOST)="C" N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW16",40,0)
EXIT K SD,SDARY,SDBDAY,SDCCT,SDCL,SDCLN,SDCT,SDDPT,SDDT,SDEDAY,SDFCT,SDFF,SDI,SDLINE,SDOE,SDOE0,SDORD,SDPAGE,SDPNOW,DFN,SDPT0,SDPTNA,SDR,SDSN,SDSTR
"RTN","SCRPW16",41,0)
 K SDT,SDTCT,SDCG,SDX,SDMD,SDSTOP,%,SDFOUND,SDDEF,SDCO,SDAP0,SDDIV,SDIV,SDIVN,SDCI,SDCLPT,SDCLPTC,SDDIS,SDV,SDSDV,SDSDVC0,SDSEG,SDTY,SDY,%DT
"RTN","SCRPW16",42,0)
 K SDLK,SCRPW16,SDCS,SDCO,SDZ,SDOUT,DIR,DTOUT,DUOUT,X,Y,ZTSAVE D KVA^VADPT,END^SCRPW50 Q
"RTN","SCRPW16",43,0)
 ;
"RTN","SCRPW16",44,0)
LOCK ;Prevent simultaneous runs of the appointment status update
"RTN","SCRPW16",45,0)
 F SDI=1:1 L +^SCRPW16("ACTION REQUIRED REPORT"):1 D  Q:SDI>600!SDOUT!SDLK
"RTN","SCRPW16",46,0)
 .I $T S SDLK=1 Q
"RTN","SCRPW16",47,0)
 .D:SDI#60=0 STOP
"RTN","SCRPW16",48,0)
 .Q
"RTN","SCRPW16",49,0)
 Q
"RTN","SCRPW16",50,0)
 ;
"RTN","SCRPW16",51,0)
DPRT(SDIV) ;Print report for a division
"RTN","SCRPW16",52,0)
 D DHDR^SCRPW40(3,.SDT) I '$D(^TMP("SCRPW",$J,SDIV)) D HDR^SCRPW18(.SDT,"") Q:SDOUT  S X="No 'action required' activity found for this division!" W !!?(132-$L(X)\2),X Q
"RTN","SCRPW16",53,0)
 D:SDIV&(SD("STAT")="D") DET^SCRPW18 Q:SDOUT  D STAT^SCRPW18 Q
"RTN","SCRPW16",54,0)
 ;
"RTN","SCRPW16",55,0)
STOP ;Check for stop task request
"RTN","SCRPW16",56,0)
 S:$G(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW16",57,0)
 ;
"RTN","SCRPW16",58,0)
EVAL S SDSTOP=SDSTOP+1 I SDSTOP#3000=0 D STOP Q:SDOUT
"RTN","SCRPW16",59,0)
 S SDOE0=$$GETOE^SDOE(SDOE),SDIV=$P(SDOE0,U,11) Q:$P(SDOE0,U,6)!'SDIV  Q:$P(SDOE0,U,12)'=14  Q:'$$DIV(SDIV)
"RTN","SCRPW16",60,0)
 S SDCL=+$P(SDOE0,U,4),SDCLN=$S('SDCL:"**NONE**",1:$P(^SC(SDCL,0),U)),SDCG=$P($G(^SC(SDCL,0)),U,31),SDCG=$S(SD("FORMAT")'["G":"**NONE**",SDCG:$P(^SD(409.67,SDCG,0),U),1:"**NONE**")
"RTN","SCRPW16",61,0)
 I SD("FORMAT")="SC",'$D(SD("CLINIC",SDCLN)) Q
"RTN","SCRPW16",62,0)
 I SD("FORMAT")="RC",(($O(SD("CLINIC",""))]SDCLN)!(SDCLN]$O(SD("CLINIC",""),-1))) Q
"RTN","SCRPW16",63,0)
 I "SS^RS"[SD("FORMAT"),'$$STCO() Q
"RTN","SCRPW16",64,0)
 I SD("FORMAT")="SG",$P(SD("GROUP"),U,2)'=SDCG Q
"RTN","SCRPW16",65,0)
 S DFN=$P(SDOE0,U,2) Q:'DFN  D DEM^VADPT M SDDPT=VADM
"RTN","SCRPW16",66,0)
 I SD("ORDER")="A" S SDORD=SDDPT(1)
"RTN","SCRPW16",67,0)
 I SD("ORDER")="D" S SDORD=$P(SDOE0,U)
"RTN","SCRPW16",68,0)
 I SD("ORDER")="T" S SDSN=$P(SDDPT(2),U),SDORD=$E(SDSN,8,9)_$E(SDSN,6,7)_$E(SDSN,4,5)_$E(SDSN,1,3)_"."
"RTN","SCRPW16",69,0)
 K SDARY M SDARY=SDSEG S (SDFOUND,SDY)=0 I $$CHEK^SCRPW18(SDOE,.SDARY,.SDSTR) S SDI="" F  S SDI=$O(SDARY(SDI)) Q:SDI=""  S SDX="" F  S SDX=$O(SDARY(SDI,SDX)) Q:SDX=""  D SET(SDX)
"RTN","SCRPW16",70,0)
 K SDX D CLASK^SDCO2(SDOE,.SDX)
"RTN","SCRPW16",71,0)
 ; SD*5.3*336 so all existing and future classification types are pulled
"RTN","SCRPW16",72,0)
 I $D(SDX) S SDI=0 F  S SDI=$O(SDX(SDI)) Q:'SDI  I $P(SDX(SDI),U,2)="" D
"RTN","SCRPW16",73,0)
 . I '$D(^SD(409.41,SDI,0)) S SDX="Classification required" D SET(SDX) Q
"RTN","SCRPW16",74,0)
 . S SDX=$P($G(^SD(409.41,SDI,0)),U,1)_" classification required"
"RTN","SCRPW16",75,0)
 . D SET(SDX)
"RTN","SCRPW16",76,0)
 I 'SDFOUND,$P(SDOE0,U,8)=1,'$$CODT^SDCOU(DFN,SDDT,SDCL) S SDI=1,SDX="No check-out date" D SET(SDX)
"RTN","SCRPW16",77,0)
 I 'SDFOUND S SDCO="" D EN^SDCOM(SDOE,0,,.SDCO) Q:SDCO>0
"RTN","SCRPW16",78,0)
 I 'SDFOUND D
"RTN","SCRPW16",79,0)
 .K SDZ D GETDX^SDOE(SDOE,"SDZ") I '$G(SDZ) D SET("No diagnosis on file")
"RTN","SCRPW16",80,0)
 .K SDZ D GETPRV^SDOE(SDOE,"SDZ") I '$G(SDZ) D SET("No provider on file")
"RTN","SCRPW16",81,0)
 .K SDZ D GETCPT^SDOE(SDOE,"SDZ") I '$G(SDZ) D SET("No procedure code on file")
"RTN","SCRPW16",82,0)
 I 'SDFOUND S SDX="Unknown reason" D SET(SDX)
"RTN","SCRPW16",83,0)
 D EV1(SDIV) D:SDMD EV1(0)
"RTN","SCRPW16",84,0)
 Q
"RTN","SCRPW16",85,0)
 ;
"RTN","SCRPW16",86,0)
EV1(SDIV) S ^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN,SDOE)=SDOE0,^TMP("SCRPW",$J,SDIV,3,DFN)=SDDPT(1)_U_SDDPT(2)
"RTN","SCRPW16",87,0)
 Q
"RTN","SCRPW16",88,0)
 ;
"RTN","SCRPW16",89,0)
DIV(SDIV) ;Evaluate division
"RTN","SCRPW16",90,0)
 ;Required input: SDIV=division ifn
"RTN","SCRPW16",91,0)
 Q:'SDDIV 1  Q $D(SDDIV(SDIV))
"RTN","SCRPW16",92,0)
 ;
"RTN","SCRPW16",93,0)
STCO() ;Evaluate Stop Code
"RTN","SCRPW16",94,0)
 Q:'SDCL 0  S SDCS=$P($G(^SC(SDCL,0)),U,7) Q:'SDCS 0  S SDCS=$P($G(^DIC(40.7,SDCS,0)),U,2) Q:'SDCS 0
"RTN","SCRPW16",95,0)
 I SD("FORMAT")="SS" Q $D(SD("STOPCODE",SDCS))
"RTN","SCRPW16",96,0)
 I (($O(SD("STOPCODE",""))]SDCS)!(SDCS]$O(SD("STOPCODE",""),-1))) Q 0
"RTN","SCRPW16",97,0)
 Q 1
"RTN","SCRPW16",98,0)
 ;
"RTN","SCRPW16",99,0)
SET(SDX) D SET1(SDIV) D:SDMD SET1(0) Q
"RTN","SCRPW16",100,0)
 ;
"RTN","SCRPW16",101,0)
SET1(SDIV) S SDY=SDY+1,^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN,SDOE,SDY)=SDX
"RTN","SCRPW16",102,0)
 S ^TMP("SCRPW",$J,SDIV,2,SDCG,SDX)=$G(^TMP("SCRPW",$J,SDIV,2,SDCG,SDX))+1,SDFOUND=1
"RTN","SCRPW16",103,0)
 Q
"RTN","SCRPW16",104,0)
 ;
"RTN","SCRPW16",105,0)
CT1 S SDCLN="" F  S SDCLN=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN)) Q:SDCLN=""  S SDCCT=0 D CT2 S ^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN)=SDCCT
"RTN","SCRPW16",106,0)
 Q
"RTN","SCRPW16",107,0)
 ;
"RTN","SCRPW16",108,0)
CT2 S SDORD="" F  S SDORD=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD)) Q:SDORD=""  S DFN="" F  S DFN=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN)) Q:DFN=""  D CT3
"RTN","SCRPW16",109,0)
 Q
"RTN","SCRPW16",110,0)
 ;
"RTN","SCRPW16",111,0)
CT3 S SDOE=0 F  S SDOE=$O(^TMP("SCRPW",$J,SDIV,1,SDCG,SDCLN,SDORD,DFN,SDOE)) Q:'SDOE  S SDFCT(SDIV)=SDFCT(SDIV)+1,SDTCT=SDTCT+1,SDCCT=SDCCT+1
"RTN","SCRPW16",112,0)
 Q
"VER")
8.0^22
**END**
**END**
