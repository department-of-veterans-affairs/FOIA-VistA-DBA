Released TIU*1*157 SEQ #177
Extracted from mail message
**KIDS**:TIU*1.0*157^

**INSTALL NAME**
TIU*1.0*157
"BLD",5221,0)
TIU*1.0*157^TEXT INTEGRATION UTILITIES^0^3050211^y
"BLD",5221,1,0)
^^2^2^3041215^
"BLD",5221,1,1,0)
Please refer to the patch description in the national patch module for
"BLD",5221,1,2,0)
information regarding this patch.
"BLD",5221,4,0)
^9.64PA^8925.7^2
"BLD",5221,4,8925.7,0)
8925.7
"BLD",5221,4,8925.7,222)
y^y^f^^^^n
"BLD",5221,4,8925.99,0)
8925.99
"BLD",5221,4,8925.99,222)
y^y^f^^^^n
"BLD",5221,4,"B",8925.7,8925.7)

"BLD",5221,4,"B",8925.99,8925.99)

"BLD",5221,"INI")

"BLD",5221,"INIT")
TIU157PS
"BLD",5221,"KRN",0)
^9.67PA^8989.52^19
"BLD",5221,"KRN",.4,0)
.4
"BLD",5221,"KRN",.401,0)
.401
"BLD",5221,"KRN",.402,0)
.402
"BLD",5221,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",5221,"KRN",.402,"NM",1,0)
TIU BASIC PARAMETER EDIT    FILE #8925.99^8925.99^0
"BLD",5221,"KRN",.402,"NM","B","TIU BASIC PARAMETER EDIT    FILE #8925.99",1)

"BLD",5221,"KRN",.403,0)
.403
"BLD",5221,"KRN",.5,0)
.5
"BLD",5221,"KRN",.84,0)
.84
"BLD",5221,"KRN",3.6,0)
3.6
"BLD",5221,"KRN",3.8,0)
3.8
"BLD",5221,"KRN",9.2,0)
9.2
"BLD",5221,"KRN",9.8,0)
9.8
"BLD",5221,"KRN",9.8,"NM",0)
^9.68A^17^15
"BLD",5221,"KRN",9.8,"NM",1,0)
TIUTSK^^0^B20710718
"BLD",5221,"KRN",9.8,"NM",2,0)
TIULP^^0^B39535720
"BLD",5221,"KRN",9.8,"NM",3,0)
TIUSRVA^^0^B22071569
"BLD",5221,"KRN",9.8,"NM",4,0)
TIUSRVP^^0^B75223693
"BLD",5221,"KRN",9.8,"NM",5,0)
TIURS^^0^B59135200
"BLD",5221,"KRN",9.8,"NM",6,0)
TIUSRVR3^^0^B18170093
"BLD",5221,"KRN",9.8,"NM",7,0)
TIUPRPN8^^0^B28018900
"BLD",5221,"KRN",9.8,"NM",8,0)
TIULQ^^0^B15406577
"BLD",5221,"KRN",9.8,"NM",9,0)
TIUBR1^^0^B66608015
"BLD",5221,"KRN",9.8,"NM",10,0)
TIUASRPT^^0^B63814653
"BLD",5221,"KRN",9.8,"NM",12,0)
TIUADSIG^^0^B761021
"BLD",5221,"KRN",9.8,"NM",14,0)
TIU157PS^^0^B622860
"BLD",5221,"KRN",9.8,"NM",15,0)
TIUR3^^0^B28062156
"BLD",5221,"KRN",9.8,"NM",16,0)
TIUR4^^0^B6424298
"BLD",5221,"KRN",9.8,"NM",17,0)
TIURH2^^0^B381222
"BLD",5221,"KRN",9.8,"NM","B","TIU157PS",14)

"BLD",5221,"KRN",9.8,"NM","B","TIUADSIG",12)

"BLD",5221,"KRN",9.8,"NM","B","TIUASRPT",10)

"BLD",5221,"KRN",9.8,"NM","B","TIUBR1",9)

"BLD",5221,"KRN",9.8,"NM","B","TIULP",2)

"BLD",5221,"KRN",9.8,"NM","B","TIULQ",8)

"BLD",5221,"KRN",9.8,"NM","B","TIUPRPN8",7)

"BLD",5221,"KRN",9.8,"NM","B","TIUR3",15)

"BLD",5221,"KRN",9.8,"NM","B","TIUR4",16)

"BLD",5221,"KRN",9.8,"NM","B","TIURH2",17)

"BLD",5221,"KRN",9.8,"NM","B","TIURS",5)

"BLD",5221,"KRN",9.8,"NM","B","TIUSRVA",3)

"BLD",5221,"KRN",9.8,"NM","B","TIUSRVP",4)

"BLD",5221,"KRN",9.8,"NM","B","TIUSRVR3",6)

"BLD",5221,"KRN",9.8,"NM","B","TIUTSK",1)

"BLD",5221,"KRN",19,0)
19
"BLD",5221,"KRN",19,"NM",0)
^9.68A^11^10
"BLD",5221,"KRN",19,"NM",1,0)
TIU MAIN MENU MRT^^2
"BLD",5221,"KRN",19,"NM",2,0)
TIU REVIEW MRT ADD SGNR^^0
"BLD",5221,"KRN",19,"NM",4,0)
TIU REVIEW UNSIGNED ADDSIG^^0
"BLD",5221,"KRN",19,"NM",5,0)
TIU MAIN MENU PN CLINICIAN^^2
"BLD",5221,"KRN",19,"NM",6,0)
TIU MAIN MENU MIXED CLINICIAN^^0
"BLD",5221,"KRN",19,"NM",7,0)
TIU REVIEW UNDICTATED DOCS^^0
"BLD",5221,"KRN",19,"NM",8,0)
TIU REVIEW UNSIGNED^^0
"BLD",5221,"KRN",19,"NM",9,0)
TIU ENTER/EDIT^^0
"BLD",5221,"KRN",19,"NM",10,0)
TIU BROWSE DOCUMENT CLINICIAN^^0
"BLD",5221,"KRN",19,"NM",11,0)
TIU REVIEW SCREEN CLINICIAN^^0
"BLD",5221,"KRN",19,"NM","B","TIU BROWSE DOCUMENT CLINICIAN",10)

"BLD",5221,"KRN",19,"NM","B","TIU ENTER/EDIT",9)

"BLD",5221,"KRN",19,"NM","B","TIU MAIN MENU MIXED CLINICIAN",6)

"BLD",5221,"KRN",19,"NM","B","TIU MAIN MENU MRT",1)

"BLD",5221,"KRN",19,"NM","B","TIU MAIN MENU PN CLINICIAN",5)

"BLD",5221,"KRN",19,"NM","B","TIU REVIEW MRT ADD SGNR",2)

"BLD",5221,"KRN",19,"NM","B","TIU REVIEW SCREEN CLINICIAN",11)

"BLD",5221,"KRN",19,"NM","B","TIU REVIEW UNDICTATED DOCS",7)

"BLD",5221,"KRN",19,"NM","B","TIU REVIEW UNSIGNED",8)

"BLD",5221,"KRN",19,"NM","B","TIU REVIEW UNSIGNED ADDSIG",4)

"BLD",5221,"KRN",19.1,0)
19.1
"BLD",5221,"KRN",101,0)
101
"BLD",5221,"KRN",101,"NM",0)
^9.68A^14^14
"BLD",5221,"KRN",101,"NM",1,0)
TIU ACTION MENU CLINICIAN 2^^0
"BLD",5221,"KRN",101,"NM",2,0)
TIU ACTION EDIT^^0
"BLD",5221,"KRN",101,"NM",3,0)
TIU ACTION PRINT^^0
"BLD",5221,"KRN",101,"NM",4,0)
TIU ACTION SIGN/COSIGN^^0
"BLD",5221,"KRN",101,"NM",5,0)
TIU ACTION DETAILED DISPLAY^^0
"BLD",5221,"KRN",101,"NM",6,0)
TIU ACTION BROWSE FOR CLINICIAN^^0
"BLD",5221,"KRN",101,"NM",7,0)
TIU ACTION QUIT^^0
"BLD",5221,"KRN",101,"NM",8,0)
TIU ACTION MENU LINK^^0
"BLD",5221,"KRN",101,"NM",9,0)
TIU ACTION MAKE ADDENDUM^^0
"BLD",5221,"KRN",101,"NM",10,0)
TIU ACTION DELETE^^0
"BLD",5221,"KRN",101,"NM",11,0)
TIU ACTION DESIGNATE SIGNERS^^0
"BLD",5221,"KRN",101,"NM",12,0)
TIU ACTION EDIT ENCOUNTER^^0
"BLD",5221,"KRN",101,"NM",13,0)
TIU ACTION ID NOTE^^0
"BLD",5221,"KRN",101,"NM",14,0)
TIU ACTION EXPAND LIST^^0
"BLD",5221,"KRN",101,"NM","B","TIU ACTION BROWSE FOR CLINICIAN",6)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION DELETE",10)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION DESIGNATE SIGNERS",11)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION DETAILED DISPLAY",5)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION EDIT",2)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION EDIT ENCOUNTER",12)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION EXPAND LIST",14)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION ID NOTE",13)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION MAKE ADDENDUM",9)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION MENU CLINICIAN 2",1)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION MENU LINK",8)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION PRINT",3)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION QUIT",7)

"BLD",5221,"KRN",101,"NM","B","TIU ACTION SIGN/COSIGN",4)

"BLD",5221,"KRN",409.61,0)
409.61
"BLD",5221,"KRN",409.61,"NM",0)
^9.68A^3^1
"BLD",5221,"KRN",409.61,"NM",3,0)
TIU REVIEW UNSIGNED ADDSIG^^0
"BLD",5221,"KRN",409.61,"NM","B","TIU REVIEW UNSIGNED ADDSIG",3)

"BLD",5221,"KRN",771,0)
771
"BLD",5221,"KRN",870,0)
870
"BLD",5221,"KRN",8989.51,0)
8989.51
"BLD",5221,"KRN",8989.52,0)
8989.52
"BLD",5221,"KRN",8994,0)
8994
"BLD",5221,"KRN","B",.4,.4)

"BLD",5221,"KRN","B",.401,.401)

"BLD",5221,"KRN","B",.402,.402)

"BLD",5221,"KRN","B",.403,.403)

"BLD",5221,"KRN","B",.5,.5)

"BLD",5221,"KRN","B",.84,.84)

"BLD",5221,"KRN","B",3.6,3.6)

"BLD",5221,"KRN","B",3.8,3.8)

"BLD",5221,"KRN","B",9.2,9.2)

"BLD",5221,"KRN","B",9.8,9.8)

"BLD",5221,"KRN","B",19,19)

"BLD",5221,"KRN","B",19.1,19.1)

"BLD",5221,"KRN","B",101,101)

"BLD",5221,"KRN","B",409.61,409.61)

"BLD",5221,"KRN","B",771,771)

"BLD",5221,"KRN","B",870,870)

"BLD",5221,"KRN","B",8989.51,8989.51)

"BLD",5221,"KRN","B",8989.52,8989.52)

"BLD",5221,"KRN","B",8994,8994)

"BLD",5221,"QUES",0)
^9.62^^
"BLD",5221,"REQB",0)
^9.611^3^3
"BLD",5221,"REQB",1,0)
TIU*1.0*175^2
"BLD",5221,"REQB",2,0)
TIU*1.0*176^2
"BLD",5221,"REQB",3,0)
TIU*1.0*179^2
"BLD",5221,"REQB","B","TIU*1.0*175",1)

"BLD",5221,"REQB","B","TIU*1.0*176",2)

"BLD",5221,"REQB","B","TIU*1.0*179",3)

"FIA",8925.7)
TIU MULTIPLE SIGNATURE
"FIA",8925.7,0)
^TIU(8925.7,
"FIA",8925.7,0,0)
8925.7IP
"FIA",8925.7,0,1)
y^y^f^^^^n
"FIA",8925.7,0,10)

"FIA",8925.7,0,11)

"FIA",8925.7,0,"RLRO")

"FIA",8925.7,0,"VR")
1.0^TIU
"FIA",8925.7,8925.7)
0
"FIA",8925.99)
TIU PARAMETERS
"FIA",8925.99,0)
^TIU(8925.99,
"FIA",8925.99,0,0)
8925.99P
"FIA",8925.99,0,1)
y^y^f^^^^n
"FIA",8925.99,0,10)

"FIA",8925.99,0,11)

"FIA",8925.99,0,"RLRO")

"FIA",8925.99,0,"VR")
1.0^TIU
"FIA",8925.99,8925.99)
0
"FIA",8925.99,8925.992)
0
"INIT")
TIU157PS
"IX",8925.7,8925.7,"AC",0)
8925.7^AC^Index by note entry date and note ien^MU^^R^IR^I^8925.7^^^^^A
"IX",8925.7,8925.7,"AC",.1,0)
^^5^5^3041108^
"IX",8925.7,8925.7,"AC",.1,1,0)
This index is to facilitate the lookup of documents that require 
"IX",8925.7,8925.7,"AC",.1,2,0)
additional signatures.  This index will sort the documents by the 
"IX",8925.7,8925.7,"AC",.1,3,0)
document entry date/time. The mumps set and kill logic for this index
"IX",8925.7,8925.7,"AC",.1,4,0)
will control the existence of nodes in the "AC" index.  Nodes will only
"IX",8925.7,8925.7,"AC",.1,5,0)
exist for documents that have unsigned additional signatures.
"IX",8925.7,8925.7,"AC",1)
I $D(^TIU(8925,X2(1),0)) S ^TIU(8925.7,"AC",$P($G(^TIU(8925,X2(1),12)),U),X2(1))=""
"IX",8925.7,8925.7,"AC",1.4)
S X=(X2(1)'=""&(X2(2)=""))
"IX",8925.7,8925.7,"AC",2)
I $D(^TIU(8925,X2(1),0)) K ^TIU(8925.7,"AC",$P($G(^TIU(8925,X2(1),12)),U),X2(1))
"IX",8925.7,8925.7,"AC",2.4)
S X=X2(2)'=""
"IX",8925.7,8925.7,"AC",2.5)
K ^TIU(8925.7,"AC")
"IX",8925.7,8925.7,"AC",11.1,0)
^.114IA^2^2
"IX",8925.7,8925.7,"AC",11.1,1,0)
1^F^8925.7^.01^^^F
"IX",8925.7,8925.7,"AC",11.1,2,0)
2^F^8925.7^.04^^^F
"IX",8925.7,8925.7,"AES",0)
8925.7^AES^Find records requiring selected user's attention/signature^R^^R^IR^I^8925.7^^^^^S
"IX",8925.7,8925.7,"AES",.1,0)
^^3^3^2991021^
"IX",8925.7,8925.7,"AES",.1,1,0)
This multi-field cross-reference by EXPECTED SIGNER, TIU DOCUMENT NUMBER,
"IX",8925.7,8925.7,"AES",.1,2,0)
IEN will facilitate finding records for which a user has been listed as an
"IX",8925.7,8925.7,"AES",.1,3,0)
additional signer.
"IX",8925.7,8925.7,"AES",1)
S ^TIU(8925.7,"AES",X(1),X(2),DA)=""
"IX",8925.7,8925.7,"AES",1.4)
S X=$S(+$P($G(^TIU(8925.7,DA,0)),U,4):0,1:1)
"IX",8925.7,8925.7,"AES",2)
K ^TIU(8925.7,"AES",X(1),X(2),DA)
"IX",8925.7,8925.7,"AES",2.4)

"IX",8925.7,8925.7,"AES",2.5)
K ^TIU(8925.7,"AES")
"IX",8925.7,8925.7,"AES",11.1,0)
^.114IA^2^2
"IX",8925.7,8925.7,"AES",11.1,1,0)
1^F^8925.7^.03^^1^F
"IX",8925.7,8925.7,"AES",11.1,2,0)
2^F^8925.7^.01^^2^F
"KRN",.402,1865,-1)
0^1
"KRN",.402,1865,0)
TIU BASIC PARAMETER EDIT^3040825.1127^^8925.99^^^3050209
"KRN",.402,1865,"DR",1,8925.99)
.02;1.07;.05;I +$P($G(^TIU(8925.99,+DA,0)),U,4)'>0 S Y="@1";.04///@;@1;.14;.03;.06;.07;.08;1.06;3.1;3.2;
"KRN",19,4752,-1)
0^11
"KRN",19,4752,0)
TIU REVIEW SCREEN CLINICIAN^Multiple Patient Documents^^A^^^^^^^n^TEXT INTEGRATION UTILITIES^^1^1
"KRN",19,4752,1,0)
^^1^1^2960307^^^
"KRN",19,4752,1,1,0)
Drives Text Intgration Utilities Review Screen.
"KRN",19,4752,15)
K TIUEDT,TIULDT
"KRN",19,4752,20)
K VALMY D EN^VALM("TIU REVIEW SCREEN CLINICIAN")
"KRN",19,4752,99)
55480,26973
"KRN",19,4752,"U")
MULTIPLE PATIENT DOCUMENTS
"KRN",19,4753,-1)
0^10
"KRN",19,4753,0)
TIU BROWSE DOCUMENT CLINICIAN^Individual Patient Document^^A^^^^^^^^TEXT INTEGRATION UTILITIES^^1
"KRN",19,4753,1,0)
^^2^2^2951103^^^^
"KRN",19,4753,1,1,0)
Allows the user to interactively review, edit, or sign patient Clinical
"KRN",19,4753,1,2,0)
Documents.
"KRN",19,4753,20)
K ORVP D MAIN^TIUBRWS("TIU BROWSE FOR CLINICIAN")
"KRN",19,4753,"U")
INDIVIDUAL PATIENT DOCUMENT
"KRN",19,4754,-1)
0^9
"KRN",19,4754,0)
TIU ENTER/EDIT^Enter/edit Document^^A^^^^^^^n^TEXT INTEGRATION UTILITIES^^1
"KRN",19,4754,1,0)
^^2^2^2960916^^
"KRN",19,4754,1,1,0)
This option allows end-users to enter/edit clinical documents directly
"KRN",19,4754,1,2,0)
on-line.
"KRN",19,4754,20)
K ORVP D MAIN^TIUEDIT(38)
"KRN",19,4754,99)
55341,57619
"KRN",19,4754,"U")
ENTER/EDIT DOCUMENT
"KRN",19,4755,-1)
0^6
"KRN",19,4755,0)
TIU MAIN MENU MIXED CLINICIAN^Integrated Document Management^^M^^^^^^^y^TEXT INTEGRATION UTILITIES^^1^^^1
"KRN",19,4755,1,0)
^^1^1^2960326^^^^
"KRN",19,4755,1,1,0)
Main Text Integration Utilities menu for clinicians.
"KRN",19,4755,10,0)
^19.01IP^16^16
"KRN",19,4755,10,5,0)
4752^4^4
"KRN",19,4755,10,5,"^")
TIU REVIEW SCREEN CLINICIAN
"KRN",19,4755,10,8,0)
4756^2^2
"KRN",19,4755,10,8,"^")
TIU REVIEW UNSIGNED
"KRN",19,4755,10,12,0)
4753^1^1
"KRN",19,4755,10,12,"^")
TIU BROWSE DOCUMENT CLINICIAN
"KRN",19,4755,10,14,0)
4754^5^5
"KRN",19,4755,10,14,"^")
TIU ENTER/EDIT
"KRN",19,4755,10,15,0)
9036^3^3
"KRN",19,4755,10,15,"^")
TIU REVIEW UNDICTATED DOCS
"KRN",19,4755,10,16,0)
9744^6^6
"KRN",19,4755,10,16,"^")
TIU REVIEW UNSIGNED ADDSIG
"KRN",19,4755,15)

"KRN",19,4755,20)
S GMRPEN=1 Q
"KRN",19,4755,26)
W !!,$$CENTER^TIULS("--- Clinician's Menu ---")
"KRN",19,4755,99)
59941,51519
"KRN",19,4755,99.1)
57706,41294
"KRN",19,4755,"U")
INTEGRATED DOCUMENT MANAGEMENT
"KRN",19,4756,-1)
0^8
"KRN",19,4756,0)
TIU REVIEW UNSIGNED^All MY UNSIGNED Documents^^A^^^^^^^n^TEXT INTEGRATION UTILITIES^^1^1
"KRN",19,4756,1,0)
^^1^1^2940819^
"KRN",19,4756,1,1,0)
Gets all unsigned documents for review, edit, and signature.
"KRN",19,4756,15)
K TIUQUIK,TIUEDT,TIULDT
"KRN",19,4756,20)
K VALMY S TIUQUIK=1 D EN^VALM("TIU REVIEW SCREEN CLINICIAN")
"KRN",19,4756,99)
55441,53727
"KRN",19,4756,"U")
ALL MY UNSIGNED DOCUMENTS
"KRN",19,4762,-1)
2^1
"KRN",19,4762,0)
TIU MAIN MENU MRT^Text Integration Utilities (MRT)^^M^11^^^^^^y^193^^1^^^1
"KRN",19,4762,10,0)
^19.01IP^17^17
"KRN",19,4762,10,17,0)
9604^9^9
"KRN",19,4762,10,17,"^")
TIU REVIEW MRT ADD SGNR
"KRN",19,4762,"U")
TEXT INTEGRATION UTILITIES (MR
"KRN",19,5164,-1)
2^5
"KRN",19,5164,0)
TIU MAIN MENU PN CLINICIAN^Progress Notes User Menu^^M^11^^^^^^y^193^^1^^^1
"KRN",19,5164,10,0)
^19.01IP^10^10
"KRN",19,5164,10,10,0)
9744^9^10
"KRN",19,5164,10,10,"^")
TIU REVIEW UNSIGNED ADDSIG
"KRN",19,5164,"U")
PROGRESS NOTES USER MENU
"KRN",19,9036,-1)
0^7
"KRN",19,9036,0)
TIU REVIEW UNDICTATED DOCS^All MY UNDICTATED Documents^^A^^^^^^^n^TEXT INTEGRATION UTILITIES^^1^1
"KRN",19,9036,1,0)
^^1^1^3010501^
"KRN",19,9036,1,1,0)
Gets all UNDICTATED Documents for review, edit, and signature.
"KRN",19,9036,15)
K TIUQUIK,TIUEDT,TIULDT
"KRN",19,9036,20)
S TIUQUIK=2 D EN^VALM("TIU REVIEW UNDICTATED DOCS")
"KRN",19,9036,99)
55441,53727
"KRN",19,9036,"U")
ALL MY UNDICTATED DOCUMENTS
"KRN",19,9604,-1)
0^2
"KRN",19,9604,0)
TIU REVIEW MRT ADD SGNR^Review unsigned additional signatures^^A^^^^^^^^TEXT INTEGRATION UTILITIES^^1
"KRN",19,9604,20)
D BEGIN^TIUASRPT
"KRN",19,9604,"U")
REVIEW UNSIGNED ADDITIONAL SIG
"KRN",19,9744,-1)
0^4
"KRN",19,9744,0)
TIU REVIEW UNSIGNED ADDSIG^ALL Documents requiring my Additional Signature^^A^^^^^^^n^TEXT INTEGRATION UTILITIES^^1^1
"KRN",19,9744,1,0)
^^2^2^3050113^
"KRN",19,9744,1,1,0)
Gets all documents requiring my additional signature for review, edit and
"KRN",19,9744,1,2,0)
signature.
"KRN",19,9744,15)
K TIUQUIK,TIUEDT,TIULDT
"KRN",19,9744,20)
K VALMY S TIUQUIK=1 D EN^VALM("TIU REVIEW UNSIGNED ADDSIG")
"KRN",19,9744,99)
55441,53727
"KRN",19,9744,"U")
ALL DOCUMENTS REQUIRING MY ADD
"KRN",101,3500,-1)
0^2
"KRN",101,3500,0)
TIU ACTION EDIT^Edit^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3500,1,0)
^^4^4^2980304^^^^
"KRN",101,3500,1,1,0)
Allows authorized users to edit selected documents online...When electronic
"KRN",101,3500,1,2,0)
signature is enabled, physicians will be prompted for their signatures upon
"KRN",101,3500,1,3,0)
exit, thereby allowing doctors to review, edit and sign as a one-step
"KRN",101,3500,1,4,0)
process.
"KRN",101,3500,15)

"KRN",101,3500,20)
D EDIT^TIURA
"KRN",101,3500,24)
I '$G(TIUGLINK)
"KRN",101,3500,99)
57061,57315
"KRN",101,3501,-1)
0^3
"KRN",101,3501,0)
TIU ACTION PRINT^Print^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3501,1,0)
^^2^2^2980304^
"KRN",101,3501,1,1,0)
Allows authorized users to print copies of selected documents to a
"KRN",101,3501,1,2,0)
specified device.
"KRN",101,3501,20)
D PRINT^TIURA
"KRN",101,3501,24)
I '$G(TIUGLINK)
"KRN",101,3501,99)
58382,35756
"KRN",101,3502,-1)
0^4
"KRN",101,3502,0)
TIU ACTION SIGN/COSIGN^Sign/Cosign^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3502,1,0)
^^6^6^2980305^
"KRN",101,3502,1,1,0)
Allows clinicians to electronically sign selected documents or addenda.
"KRN",101,3502,1,2,0)
 
"KRN",101,3502,1,3,0)
NOTE:  Electronic signature carries the same legal ramifications that wet
"KRN",101,3502,1,4,0)
signature of a hard-copy document carries.  You are advised to carefully
"KRN",101,3502,1,5,0)
review each document for content and accuracy before exercising this
"KRN",101,3502,1,6,0)
option.
"KRN",101,3502,20)
D ELSIG^TIURS1
"KRN",101,3502,24)
I '$G(TIUGLINK)
"KRN",101,3502,99)
57061,57315
"KRN",101,3503,-1)
0^5
"KRN",101,3503,0)
TIU ACTION DETAILED DISPLAY^Detailed Display^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3503,1,0)
^^3^3^2980304^
"KRN",101,3503,1,1,0)
Displays the all of the details concerning the selected document's
"KRN",101,3503,1,2,0)
history, including audit trail and reassignment history, in addition to
"KRN",101,3503,1,3,0)
the narrative body of the document.
"KRN",101,3503,2,0)
^101.02A^2^2
"KRN",101,3503,2,1,0)
DT
"KRN",101,3503,2,2,0)
DD
"KRN",101,3503,2,"B","DD",2)

"KRN",101,3503,2,"B","DT",1)

"KRN",101,3503,20)
D DISPLAY^TIURA2
"KRN",101,3503,24)

"KRN",101,3503,99)
58382,35757
"KRN",101,3506,-1)
0^6
"KRN",101,3506,0)
TIU ACTION BROWSE FOR CLINICIAN^Browse^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3506,1,0)
^101.06^4^4^3010109^^^^
"KRN",101,3506,1,1,0)
Allows users to browse through Documents from the Review Screen.
"KRN",101,3506,1,2,0)
In addition to scrolling sequentially through the selected documents
"KRN",101,3506,1,3,0)
and their addenda, the user may Search for a particular word or
"KRN",101,3506,1,4,0)
phrase, or Print draft copies to a selected device.
"KRN",101,3506,15)

"KRN",101,3506,20)
D:$G(TIUGLINK) BROWSE^TIURA2("TIU BROWSE FOR READ ONLY") D:'$G(TIUGLINK) BROWSE^TIURA2("TIU BROWSE FOR CLINICIAN")
"KRN",101,3506,24)

"KRN",101,3506,99)
58382,35757
"KRN",101,3507,-1)
0^7
"KRN",101,3507,0)
TIU ACTION QUIT^Quit^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3507,1,0)
^^1^1^3010412^
"KRN",101,3507,1,1,0)
Allows user to quit the current menu level.
"KRN",101,3507,2,0)
^101.02A^^0
"KRN",101,3507,20)
Q
"KRN",101,3507,99)
58519,52195
"KRN",101,3516,-1)
0^10
"KRN",101,3516,0)
TIU ACTION DELETE^Delete Document^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3516,1,0)
^^2^2^2980304^
"KRN",101,3516,1,1,0)
Allows authorized users (as defined by your local business rules in ASU)
"KRN",101,3516,1,2,0)
to delete a document at the patient's request, per the Privacy Act.
"KRN",101,3516,20)
D DELETE^TIURB2
"KRN",101,3516,24)
I '$G(TIUGLINK)
"KRN",101,3516,99)
58382,35757
"KRN",101,3602,-1)
0^8
"KRN",101,3602,0)
TIU ACTION MENU LINK^Link ...^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,3602,1,0)
^^4^4^2980304^^
"KRN",101,3602,1,1,0)
Allows authorized users to link documents to either problems, visits, or 
"KRN",101,3602,1,2,0)
records in other applications (e.g., Consult Results to Consult Requests,
"KRN",101,3602,1,3,0)
Operative Reports to Sugical Cases, etc.). Such associations permit a
"KRN",101,3602,1,4,0)
variety of clinically useful "views" of the on-line record.
"KRN",101,3602,4)
26
"KRN",101,3602,10,0)
^101.01PA^3^3
"KRN",101,3602,15)

"KRN",101,3602,20)
S XQORM(0)="AD",VALMBCK=""
"KRN",101,3602,24)
I '$G(TIUGLINK)
"KRN",101,3602,26)
W !
"KRN",101,3602,28)
Specify Linkage: 
"KRN",101,3602,99)
59942,26262
"KRN",101,4054,-1)
0^9
"KRN",101,4054,0)
TIU ACTION MAKE ADDENDUM^Make Addendum^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4054,1,0)
^^4^4^2951213^^^^
"KRN",101,4054,1,1,0)
Allows authorized users to add addenda to selected documents online...
"KRN",101,4054,1,2,0)
When electronic signature is enabled, physicians will be prompted for
"KRN",101,4054,1,3,0)
their signatures upon exit, thereby allowing doctors to review, edit
"KRN",101,4054,1,4,0)
and sign as a one-step process.
"KRN",101,4054,20)
D ADDEND^TIURA1
"KRN",101,4054,24)
I '$G(TIUGLINK)
"KRN",101,4054,99)
58382,35758
"KRN",101,4159,-1)
0^11
"KRN",101,4159,0)
TIU ACTION DESIGNATE SIGNERS^Identify Signers^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,4159,1,0)
^^2^2^2960605^
"KRN",101,4159,1,1,0)
Allows authorized users to identify additional signers for a given
"KRN",101,4159,1,2,0)
document.
"KRN",101,4159,20)
D NAME^TIURA1
"KRN",101,4159,24)
I '$G(TIUGLINK)
"KRN",101,4159,99)
57061,57326
"KRN",101,5128,-1)
0^12
"KRN",101,5128,0)
TIU ACTION EDIT ENCOUNTER^Encounter Edit^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5128,1,0)
^^1^1^2980612^^
"KRN",101,5128,1,1,0)
Allows authorized users to Edit Encounter information on demand.
"KRN",101,5128,20)
D ENCNTR^TIURA1
"KRN",101,5128,24)
I '$G(TIUGLINK)
"KRN",101,5128,99)
57506,62136
"KRN",101,5491,-1)
0^14
"KRN",101,5491,0)
TIU ACTION EXPAND LIST^Expand/Collapse Entry^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5491,1,0)
^101.06^3^3^3010212^^
"KRN",101,5491,1,1,0)
Action EXPAND ENTRY permits users to expand notes to list any addenda or
"KRN",101,5491,1,2,0)
interdisciplinary children nested under the note.  If the note is already
"KRN",101,5491,1,3,0)
expanded when the action is taken, the note is collapsed.
"KRN",101,5491,2,0)
^101.02A^1^1
"KRN",101,5491,2,1,0)
EX
"KRN",101,5491,2,"B","EX",1)

"KRN",101,5491,15)
S VALMBCK="R"
"KRN",101,5491,20)
D EXPAND^TIURA2
"KRN",101,5491,24)

"KRN",101,5491,99)
58504,37012
"KRN",101,5740,-1)
0^13
"KRN",101,5740,0)
TIU ACTION ID NOTE^Interdiscipl'ry Note^^A^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,5740,1,0)
^^18^18^3010307^
"KRN",101,5740,1,1,0)
This action permits the user to add a new entry to an interdisciplinary
"KRN",101,5740,1,2,0)
note, attach a stand-alone note to an interdisciplinary note, or to detach
"KRN",101,5740,1,3,0)
an entry from an interdisciplinary note.
"KRN",101,5740,1,4,0)
 
"KRN",101,5740,1,5,0)
Only one note at a time can be selected for this action.
"KRN",101,5740,1,6,0)
 
"KRN",101,5740,1,7,0)
The action taken depends on the note selected.  If an interdisciplinary
"KRN",101,5740,1,8,0)
note is selected, the option attempts to add a new entry to it.  If a
"KRN",101,5740,1,9,0)
stand-alone note is selected, the option attempts to attach it to an
"KRN",101,5740,1,10,0)
interdisciplinary note, and the user is asked to select the note to attach
"KRN",101,5740,1,11,0)
it to. If an individual entry of an interdisciplinary note is selected,
"KRN",101,5740,1,12,0)
the option attempts to detach it from the interdisciplinary note.
"KRN",101,5740,1,13,0)
 
"KRN",101,5740,1,14,0)
All of these actions are governed by business rules.  The two
"KRN",101,5740,1,15,0)
business rule actions specific to ID notes are ATTACH TO ID NOTE, and
"KRN",101,5740,1,16,0)
ATTACH ID ENTRY. There is no business rule detach action.  Those users who
"KRN",101,5740,1,17,0)
can ATTACH a note TO AN ID NOTE are permitted to detach the note once it
"KRN",101,5740,1,18,0)
is attached.
"KRN",101,5740,2,0)
^101.02A^^0
"KRN",101,5740,15)
D IDNOTE^TIUGR
"KRN",101,5740,20)
S VALMBCK="R"
"KRN",101,5740,24)
I $G(^TMP("TIUR",$J,"CLASS"))'=244
"KRN",101,5740,99)
58382,35759
"KRN",101,6599,-1)
0^1
"KRN",101,6599,0)
TIU ACTION MENU CLINICIAN 2^Act on Documents^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",101,6599,1,0)
^101.06^1^1^3050111^^^^
"KRN",101,6599,1,1,0)
Menu of actions which may be executed by clinicians.
"KRN",101,6599,4)
26
"KRN",101,6599,10,0)
^101.01PA^21^13
"KRN",101,6599,10,1,0)
3500^^12^
"KRN",101,6599,10,1,"^")
TIU ACTION EDIT
"KRN",101,6599,10,2,0)
3501^^23^
"KRN",101,6599,10,2,"^")
TIU ACTION PRINT
"KRN",101,6599,10,3,0)
3502^^15^
"KRN",101,6599,10,3,"^")
TIU ACTION SIGN/COSIGN
"KRN",101,6599,10,4,0)
3503^^21^
"KRN",101,6599,10,4,"^")
TIU ACTION DETAILED DISPLAY
"KRN",101,6599,10,7,0)
3506^^22^
"KRN",101,6599,10,7,"^")
TIU ACTION BROWSE FOR CLINICIAN
"KRN",101,6599,10,8,0)
3507^^35^
"KRN",101,6599,10,8,"^")
TIU ACTION QUIT
"KRN",101,6599,10,14,0)
3602^^14^
"KRN",101,6599,10,14,"^")
TIU ACTION MENU LINK
"KRN",101,6599,10,16,0)
4054^^13^
"KRN",101,6599,10,16,"^")
TIU ACTION MAKE ADDENDUM
"KRN",101,6599,10,17,0)
3516^^31^
"KRN",101,6599,10,17,"^")
TIU ACTION DELETE
"KRN",101,6599,10,18,0)
4159^^24^
"KRN",101,6599,10,18,"^")
TIU ACTION DESIGNATE SIGNERS
"KRN",101,6599,10,19,0)
5128^^34^
"KRN",101,6599,10,19,"^")
TIU ACTION EDIT ENCOUNTER
"KRN",101,6599,10,20,0)
5740^^32^
"KRN",101,6599,10,20,"^")
TIU ACTION ID NOTE
"KRN",101,6599,10,21,0)
5491^^33^
"KRN",101,6599,10,21,"^")
TIU ACTION EXPAND LIST
"KRN",101,6599,20)
S XQORM("SH")=0 S:$G(VALMSG)'["*" VALMSG="+ Next Screen  - Prev Screen  ?? More Actions",VALM("MAX")=+$G(VALMCNT) S:$G(TIUGLINK) VALMSG=$$LINKMSG^TIUGR2(TIUGLINK)
"KRN",101,6599,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,6599,26)
S XQORM("#")=$G(^TMP("TIUR",$J,"#")) D RESIZE^TIULM(21,17),SHOW^VALM K XQORM("XLATE","FIND")
"KRN",101,6599,28)
Select Action:
"KRN",101,6599,99)
59911,47768
"KRN",409.61,931,-1)
0^3
"KRN",409.61,931,0)
TIU REVIEW UNSIGNED ADDSIG^1^^132^4^17^1^1^Document^TIU ACTION MENU CLINICIAN 2^Clinical Documents
"KRN",409.61,931,1)
^TIU HIDDEN ACTIONS
"KRN",409.61,931,"ARRAY")
 ^TMP("TIUR",$J)
"KRN",409.61,931,"COL",0)
^409.621^14^10
"KRN",409.61,931,"COL",1,0)
NUMBER^1^5
"KRN",409.61,931,"COL",2,0)
STATUS^70^10^Status
"KRN",409.61,931,"COL",3,0)
PATIENT NAME^6^14^Patient
"KRN",409.61,931,"COL",4,0)
REF DATE^60^8^Ref Date
"KRN",409.61,931,"COL",5,0)
SIG DATE^82^8^Completed
"KRN",409.61,931,"COL",10,0)
LAST I/LAST 4^20^7^^^0
"KRN",409.61,931,"COL",11,0)
AUTHOR^92^14^Author
"KRN",409.61,931,"COL",12,0)
EXPECTED COSIGNER^108^14^Exp. Cos.
"KRN",409.61,931,"COL",13,0)
DOCUMENT TYPE^28^31^Document^^1
"KRN",409.61,931,"COL",14,0)
DIVISION^124^8^Division
"KRN",409.61,931,"COL","AIDENT",0,10)

"KRN",409.61,931,"COL","AIDENT",1,13)

"KRN",409.61,931,"COL","B","AUTHOR",11)

"KRN",409.61,931,"COL","B","DIVISION",14)

"KRN",409.61,931,"COL","B","DOCUMENT TYPE",13)

"KRN",409.61,931,"COL","B","EXPECTED COSIGNER",12)

"KRN",409.61,931,"COL","B","LAST I/LAST 4",10)

"KRN",409.61,931,"COL","B","NUMBER",1)

"KRN",409.61,931,"COL","B","PATIENT NAME",3)

"KRN",409.61,931,"COL","B","REF DATE",4)

"KRN",409.61,931,"COL","B","SIG DATE",5)

"KRN",409.61,931,"COL","B","STATUS",2)

"KRN",409.61,931,"FNL")
D CLEAN^TIUR
"KRN",409.61,931,"HDR")
D HDR^TIURH2
"KRN",409.61,931,"HLP")
D PROTOCOL^TIUHELP
"KRN",409.61,931,"INIT")
D MAKELIST^TIUR3(38)
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
157^3050211^1461
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3050211
"PKG",193,22,1,"PAH",1,1,1,0)
Please refer to the patch description in the national patch module for
"PKG",193,22,1,"PAH",1,1,2,0)
information regarding this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
15
"RTN","TIU157PS")
0^14^B622860
"RTN","TIU157PS",1,0)
TIU157PS ; SLC/JMH - Patch 157 post-install routine ; [11/18/04 10:36am]
"RTN","TIU157PS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**157**;Jun 20, 1997
"RTN","TIU157PS",3,0)
REINDEX ;reindex the new "AC" index on file 8925.7
"RTN","TIU157PS",4,0)
 N TIUD0
"RTN","TIU157PS",5,0)
 S TIUD0=0
"RTN","TIU157PS",6,0)
 I $O(^TIU(8925.7,"AC","")) Q
"RTN","TIU157PS",7,0)
 F  S TIUD0=$O(^TIU(8925.7,TIUD0)) Q:'TIUD0  D
"RTN","TIU157PS",8,0)
 . N TIUDOC S TIUDOC=+$G(^TIU(8925.7,TIUD0,0)) Q:'TIUDOC
"RTN","TIU157PS",9,0)
 . Q:'+$G(^TIU(8925,TIUDOC,0))
"RTN","TIU157PS",10,0)
 . N TIUDT S TIUDT=$P($G(^TIU(8925.7,TIUD0,0)),U,4) Q:TIUDT
"RTN","TIU157PS",11,0)
 . S ^TIU(8925.7,"AC",$P($G(^TIU(8925,TIUDOC,12)),U),$G(TIUDOC))=""
"RTN","TIU157PS",12,0)
 Q
"RTN","TIUADSIG")
0^12^B761021
"RTN","TIUADSIG",1,0)
TIUADSIG ;SLC/JMH - Additional signature/surrogate methods ;10/13/04 [10/15/04 9:55am]
"RTN","TIUADSIG",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**157**;Jun 20, 1997
"RTN","TIUADSIG",3,0)
ASURG(TIUDA) ; checks if current user is a surrogate for an additional signer
"RTN","TIUADSIG",4,0)
 ; if so then it returns the 8925.7 record IEN
"RTN","TIUADSIG",5,0)
 N TIUASDA,TIUY
"RTN","TIUADSIG",6,0)
 S TIUASDA="",TIUY=0
"RTN","TIUADSIG",7,0)
 F  S TIUASDA=$O(^TIU(8925.7,"B",TIUDA,TIUASDA)) Q:'TIUASDA!(TIUY)  D
"RTN","TIUADSIG",8,0)
 . N TIUAS
"RTN","TIUADSIG",9,0)
 . S TIUAS=$P($G(^TIU(8925.7,TIUASDA,0)),U,3)
"RTN","TIUADSIG",10,0)
 . Q:'$G(TIUAS)
"RTN","TIUADSIG",11,0)
 . I +$P($G(^TIU(8925.7,+TIUASDA,0)),U,4) Q
"RTN","TIUADSIG",12,0)
 . I $$ISSURFOR(DUZ,TIUAS) S TIUY=TIUASDA
"RTN","TIUADSIG",13,0)
 Q TIUY
"RTN","TIUADSIG",14,0)
ISSURFOR(USER1,USER2) ; check with kernel to see if USER1 is a surrogate for
"RTN","TIUADSIG",15,0)
 ; USER2
"RTN","TIUADSIG",16,0)
 N ACTSUR ;actual surrogate
"RTN","TIUADSIG",17,0)
 S ACTSUR=$$CURRSURO^XQALSURO(USER2)
"RTN","TIUADSIG",18,0)
 I ACTSUR=USER1 Q 1
"RTN","TIUADSIG",19,0)
 Q 0
"RTN","TIUASRPT")
0^10^B63814653
"RTN","TIUASRPT",1,0)
TIUASRPT ; SLC/JMH - Review unsigned additional signer Documents by DIVISION ; [12/2/04 11:50am]
"RTN","TIUASRPT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**157**;Jun 20, 1997
"RTN","TIUASRPT",3,0)
BEGIN ; Select Division(s), Entry Date Range, Service, Type of Report
"RTN","TIUASRPT",4,0)
 N TIUI,TIUSTDT,TIUENDT,TIUSVCS
"RTN","TIUASRPT",5,0)
 D SELDIV^TIULA Q:SELDIV'>0
"RTN","TIUASRPT",6,0)
 I $D(TIUDI) D
"RTN","TIUASRPT",7,0)
 . S TIUI=0 F  S TIUI=$O(TIUDI(TIUI)) Q:'TIUI  D
"RTN","TIUASRPT",8,0)
 . . S TIUDI("ENTRIES")=$G(TIUDI("ENTRIES"))_TIUI_";"
"RTN","TIUASRPT",9,0)
 E  D
"RTN","TIUASRPT",10,0)
 . S TIUDI("ENTRIES")="ALL DIVISIONS"
"RTN","TIUASRPT",11,0)
 ;
"RTN","TIUASRPT",12,0)
 ;Ask Date Range, exit if timeout, '^' or no selection
"RTN","TIUASRPT",13,0)
 Q:'$$ASKRNG(.TIUSTDT,.TIUENDT)
"RTN","TIUASRPT",14,0)
 ;
"RTN","TIUASRPT",15,0)
 ;Select Service, exit if timeout, '^' or no selection
"RTN","TIUASRPT",16,0)
 Q:'$$SELSVC^TIULA(.TIUSVCS)
"RTN","TIUASRPT",17,0)
 ;
"RTN","TIUASRPT",18,0)
 N DIR,DIRUT,DTOUT,DUOUT,TIURPT
"RTN","TIUASRPT",19,0)
 S DIR(0)="S^F:FULL;S:SUMMARY",DIR("A")="Type of Report"
"RTN","TIUASRPT",20,0)
 S DIR("?",1)="Summary lists the number of documents by author's"
"RTN","TIUASRPT",21,0)
 S DIR("?",2)="service/section. Full lists detailed document"
"RTN","TIUASRPT",22,0)
 S DIR("?",3)="information by author's service/section."
"RTN","TIUASRPT",23,0)
 S DIR("?")="Enter ""^"", or a RETURN to quit."
"RTN","TIUASRPT",24,0)
 D ^DIR Q:$D(DIRUT)  S TIURPT=Y
"RTN","TIUASRPT",25,0)
 ;
"RTN","TIUASRPT",26,0)
DEV ; Device selection
"RTN","TIUASRPT",27,0)
 I TIURPT="F" D
"RTN","TIUASRPT",28,0)
 . W !!,"This report should be sent to a 132 Column Device"
"RTN","TIUASRPT",29,0)
 S %ZIS="Q" W ! D ^%ZIS I POP K POP G EXIT
"RTN","TIUASRPT",30,0)
 I $D(IO("Q")) D  G EXIT
"RTN","TIUASRPT",31,0)
 . S ZTRTN="BUILD^TIUASRPT"
"RTN","TIUASRPT",32,0)
 . S ZTSAVE("TIUDI(")="",ZTSAVE("TIURPT")=""
"RTN","TIUASRPT",33,0)
 . S ZTSAVE("TIUSTDT")="",ZTSAVE("TIUENDT")=""
"RTN","TIUASRPT",34,0)
 . S ZTSAVE("TIUSVCS")="",ZTSAVE("TIUSVCS(")=""
"RTN","TIUASRPT",35,0)
 . S ZTDESC="TIU PENDING ADD. SIGNATURES BY DIV"
"RTN","TIUASRPT",36,0)
 . D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","TIUASRPT",37,0)
 . K ZTSK,ZTDESC,ZTRTN,ZTSAVE,%ZIS,TIUDIV,TIURPT,TIUIFP
"RTN","TIUASRPT",38,0)
 . D HOME^%ZIS
"RTN","TIUASRPT",39,0)
 U IO D BUILD,^%ZISC
"RTN","TIUASRPT",40,0)
 Q
"RTN","TIUASRPT",41,0)
BUILD ; Build list
"RTN","TIUASRPT",42,0)
 N TIUIFP,TIUK
"RTN","TIUASRPT",43,0)
 K ^TMP("TIUD",$J)
"RTN","TIUASRPT",44,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","TIUASRPT",45,0)
 I +$G(TIUDI("ENTRIES")) D
"RTN","TIUASRPT",46,0)
 . S TIUK=0 F  S TIUK=$O(TIUDI(TIUK)) Q:'TIUK  D
"RTN","TIUASRPT",47,0)
 . . S TIUIFP=$G(TIUDI(TIUK))
"RTN","TIUASRPT",48,0)
 . . D GATHER(TIUIFP,TIUSTDT,TIUENDT,.TIUSVCS)
"RTN","TIUASRPT",49,0)
 E  D
"RTN","TIUASRPT",50,0)
 . S TIUIFP=0
"RTN","TIUASRPT",51,0)
 . F  S TIUIFP=$O(^TIU(8925,"ADIV",TIUIFP)) Q:+TIUIFP'>0  D
"RTN","TIUASRPT",52,0)
 . . D GATHER(TIUIFP,TIUSTDT,TIUENDT,.TIUSVCS)
"RTN","TIUASRPT",53,0)
 D PRINT
"RTN","TIUASRPT",54,0)
 ;
"RTN","TIUASRPT",55,0)
EXIT ; Clean up and exit
"RTN","TIUASRPT",56,0)
 K SELDIV,TIUDI,TIUSTDT,TIUENDT,TIUSVCS K ^TMP("TIUD",$J)
"RTN","TIUASRPT",57,0)
 Q
"RTN","TIUASRPT",58,0)
GATHER(TIUIFP,TIUSTDT,TIUENDT,TIUSVCS) ; Find records for the list
"RTN","TIUASRPT",59,0)
 ; Input   -- TIUIFP  INSTITUTION file (#4) IEN
"RTN","TIUASRPT",60,0)
 ;            (0 = gather all divisions)
"RTN","TIUASRPT",61,0)
 ;            TIUSTDT Start Date
"RTN","TIUASRPT",62,0)
 ;            TIUENDT End Date
"RTN","TIUASRPT",63,0)
 ;            TIUSVCS Service Selection Array
"RTN","TIUASRPT",64,0)
 ; Output  -- None
"RTN","TIUASRPT",65,0)
 N TIUDA,TIUJ,TIUS,TIUTP
"RTN","TIUASRPT",66,0)
 S TIUTP=TIUSTDT
"RTN","TIUASRPT",67,0)
 F  S TIUTP=$O(^TIU(8925.7,"AC",TIUTP)) Q:'TIUTP!(TIUTP>(TIUENDT+1))  D
"RTN","TIUASRPT",68,0)
 . N TIUIEN S TIUIEN=0
"RTN","TIUASRPT",69,0)
 . F  S TIUIEN=$O(^TIU(8925.7,"AC",TIUTP,TIUIEN)) Q:'TIUIEN  D
"RTN","TIUASRPT",70,0)
 . . I $P($G(^TIU(8925,TIUIEN,12)),U,12)'=TIUIFP Q
"RTN","TIUASRPT",71,0)
 . . D ADDELMNT(TIUIEN,.TIUSVCS)
"RTN","TIUASRPT",72,0)
 Q
"RTN","TIUASRPT",73,0)
 ;
"RTN","TIUASRPT",74,0)
ADDELMNT(TIUDA,TIUSVCS) ; Add each element to the list
"RTN","TIUASRPT",75,0)
 ; Input  -- TIUDA   TIU DOCUMENT file (#8925) IEN
"RTN","TIUASRPT",76,0)
 ;           TIUSVCS Service Selection Array
"RTN","TIUASRPT",77,0)
 ; Output -- None
"RTN","TIUASRPT",78,0)
 N TIUASREC,TIUSVC,TIUEDT,TIUD12,TIUIFP,TIUSTAT
"RTN","TIUASRPT",79,0)
 S TIUSTAT=$P($G(^TIU(8925,TIUDA,0)),U,5)
"RTN","TIUASRPT",80,0)
 I TIUSTAT>8 Q
"RTN","TIUASRPT",81,0)
 S TIUASREC=0
"RTN","TIUASRPT",82,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIUASRPT",83,0)
 S TIUEDT=+$P(TIUD12,U),TIUIFP=+$P(TIUD12,U,12)
"RTN","TIUASRPT",84,0)
 F  S TIUASREC=$O(^TIU(8925.7,"B",TIUDA,TIUASREC)) Q:'TIUASREC  D
"RTN","TIUASRPT",85,0)
 . N TIUAS,TIUASSVC
"RTN","TIUASRPT",86,0)
 . S TIUAS=$P(^TIU(8925.7,TIUASREC,0),U,3)
"RTN","TIUASRPT",87,0)
 . I 'TIUAS!$P(^TIU(8925.7,TIUASREC,0),U,4) Q
"RTN","TIUASRPT",88,0)
 . S TIUASSVC=$$PROVSVC^TIULV(TIUAS)
"RTN","TIUASRPT",89,0)
 . I $G(TIUSVCS)="ALL"!($D(TIUSVCS(+TIUASSVC))) D
"RTN","TIUASRPT",90,0)
 . . S TIUAS=$$PERSNAME^TIULC1(TIUAS)
"RTN","TIUASRPT",91,0)
 . . I $P(TIUASSVC,U,2)]"" S TIUASSVC=$P(TIUASSVC,U,2)
"RTN","TIUASRPT",92,0)
 . . E  S TIUASSVC="UNKNOWN"
"RTN","TIUASRPT",93,0)
 . . I TIUAS'="UNKNOWN" S TIUAS=$$NAME^TIULS(TIUAS,"LAST, FI MI")
"RTN","TIUASRPT",94,0)
 . . S ^TMP("TIUD",$J,TIUIFP,TIUASSVC,TIUAS,TIUEDT)=TIUDA
"RTN","TIUASRPT",95,0)
 Q
"RTN","TIUASRPT",96,0)
 ;
"RTN","TIUASRPT",97,0)
PRNT(TIUDA) ; Does document have a parent?
"RTN","TIUASRPT",98,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN
"RTN","TIUASRPT",99,0)
 ; Output -- TIUPRNT  Null= TIU Document file (#8925) entry does
"RTN","TIUASRPT",100,0)
 ;                          not have a parent
"RTN","TIUASRPT",101,0)
 ;                    Exists= TIU Document file (#8925) entry is
"RTN","TIUASRPT",102,0)
 ;                            an addendum or ID child.
"RTN","TIUASRPT",103,0)
 ;                            Value: Parent TIU Document file
"RTN","TIUASRPT",104,0)
 ;                                   (#8925) IEN 
"RTN","TIUASRPT",105,0)
 N ADDMPRNT,IDPRNT,TIUPRNT
"RTN","TIUASRPT",106,0)
 S TIUPRNT=""
"RTN","TIUASRPT",107,0)
 S ADDMPRNT=+$P($G(^TIU(8925,TIUDA,0)),U,6) ; Addm parent
"RTN","TIUASRPT",108,0)
 I '$D(^TIU(8925,ADDMPRNT,0)) S ADDMPRNT=0
"RTN","TIUASRPT",109,0)
 I ADDMPRNT D
"RTN","TIUASRPT",110,0)
 . S TIUPRNT=ADDMPRNT
"RTN","TIUASRPT",111,0)
 E  D
"RTN","TIUASRPT",112,0)
 . S IDPRNT=+$G(^TIU(8925,TIUDA,21)) ; ID parent
"RTN","TIUASRPT",113,0)
 . I '$D(^TIU(8925,IDPRNT,0)) S IDPRNT=0
"RTN","TIUASRPT",114,0)
 . I IDPRNT D
"RTN","TIUASRPT",115,0)
 . . S TIUPRNT=IDPRNT
"RTN","TIUASRPT",116,0)
 Q TIUPRNT
"RTN","TIUASRPT",117,0)
 ;
"RTN","TIUASRPT",118,0)
ASKRNG(STDT,ENDT) ;Prompt for entry date range
"RTN","TIUASRPT",119,0)
 ; Input  -- None
"RTN","TIUASRPT",120,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIUASRPT",121,0)
 ;           STDT  Start Date
"RTN","TIUASRPT",122,0)
 ;           ENDT  End Date
"RTN","TIUASRPT",123,0)
 N DIRUT,DTOUT,DUOUT,Y
"RTN","TIUASRPT",124,0)
 W !!,"Please specify an Entry Date Range:",!
"RTN","TIUASRPT",125,0)
 S STDT=+$$READ^TIUU("DA^:DT:E"," Start Entry Date: ")
"RTN","TIUASRPT",126,0)
 I $D(DIRUT)!(STDT'>0) G ASKRNGQ
"RTN","TIUASRPT",127,0)
 S ENDT=+$$READ^TIUU("DA^"_STDT_":DT:E","Ending Entry Date: ")_"."_235959
"RTN","TIUASRPT",128,0)
 I $D(DIRUT)!(ENDT'>0) G ASKRNGQ
"RTN","TIUASRPT",129,0)
 S Y=1
"RTN","TIUASRPT",130,0)
ASKRNGQ Q +$G(Y)
"RTN","TIUASRPT",131,0)
DHDR(TIUFP,TIUSTDT,TIUENDT) ;
"RTN","TIUASRPT",132,0)
 ;DIVISION HEADER
"RTN","TIUASRPT",133,0)
 N TIUR,TIURNG,TIUINST
"RTN","TIUASRPT",134,0)
 S TIUPG=(+$G(TIUPG))+1
"RTN","TIUASRPT",135,0)
 D DT^DILF("ET","NOW",.TIUR)
"RTN","TIUASRPT",136,0)
 S TIURNG=$$FMTE^XLFDT(TIUSTDT)_" thru "_$$FMTE^XLFDT(TIUENDT)
"RTN","TIUASRPT",137,0)
 S TIUINST=$S(TIUIFP:$P($$NS^XUAF4(TIUIFP),U),1:"ALL DIVISIONS")
"RTN","TIUASRPT",138,0)
 W @IOF,"Pending Additional Signature Documents for "_TIUINST
"RTN","TIUASRPT",139,0)
 W " on "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","TIUASRPT",140,0)
 W !,?10,TIURNG,?70,"Page: "_+$G(TIUPG)
"RTN","TIUASRPT",141,0)
 I TIURPT'="F" D
"RTN","TIUASRPT",142,0)
 . W !,"------------------------------------------------------------------------------"
"RTN","TIUASRPT",143,0)
 I TIURPT="F" D
"RTN","TIUASRPT",144,0)
 . W !,"------------------------------------------------------------------------------------------------------------------------------------"
"RTN","TIUASRPT",145,0)
 . W !,"IDENT. SIGNER",?17,"PATIENT",?27,"STATUS",?35,"ENTRY DATE"
"RTN","TIUASRPT",146,0)
 . W ?54,"DOCUMENT TITLE",?81,"DOCUMENT IEN"
"RTN","TIUASRPT",147,0)
 . W !,"------------------------------------------------------------------------------------------------------------------------------------"
"RTN","TIUASRPT",148,0)
 Q
"RTN","TIUASRPT",149,0)
SHDR(TIUSVC) ;
"RTN","TIUASRPT",150,0)
 ; SERVICE HEADER
"RTN","TIUASRPT",151,0)
 W !!?10,"SERVICE: ",TIUSVC
"RTN","TIUASRPT",152,0)
 Q
"RTN","TIUASRPT",153,0)
PRINT ;
"RTN","TIUASRPT",154,0)
 N TIUPG,TIUIFP,TIUOUT,TIUTOT
"RTN","TIUASRPT",155,0)
 S (TIUPG,TIUIFP,TIUOUT,TIUTOT)=0
"RTN","TIUASRPT",156,0)
 F  S TIUIFP=$O(^TMP("TIUD",$J,TIUIFP)) Q:'TIUIFP!(TIUOUT)  D
"RTN","TIUASRPT",157,0)
 . N TIUSVC,TIUDCNT
"RTN","TIUASRPT",158,0)
 . S (TIUSVC,TIUDCNT)=0
"RTN","TIUASRPT",159,0)
 . D DHDR(TIUIFP,TIUSTDT,TIUENDT)
"RTN","TIUASRPT",160,0)
 . F  S TIUSVC=$O(^TMP("TIUD",$J,TIUIFP,TIUSVC)) Q:TIUSVC=""!(TIUOUT)  D
"RTN","TIUASRPT",161,0)
 . . N TIUAS,TIUSVCNT
"RTN","TIUASRPT",162,0)
 . . S (TIUAS,TIUSVCNT)=0
"RTN","TIUASRPT",163,0)
 . . I $Y>(IOSL-5) D ASK Q:TIUOUT  D DHDR(TIUIFP,TIUSTDT,TIUENDT)
"RTN","TIUASRPT",164,0)
 . . I TIURPT="F" D SHDR(TIUSVC)
"RTN","TIUASRPT",165,0)
 . . F  S TIUAS=$O(^TMP("TIUD",$J,TIUIFP,TIUSVC,TIUAS)) Q:TIUAS=""!(TIUOUT)  D
"RTN","TIUASRPT",166,0)
 . . . N TIUEDT
"RTN","TIUASRPT",167,0)
 . . . S TIUEDT=""
"RTN","TIUASRPT",168,0)
 . . . F  S TIUEDT=$O(^TMP("TIUD",$J,TIUIFP,TIUSVC,TIUAS,TIUEDT)) Q:'TIUEDT!(TIUOUT)  D
"RTN","TIUASRPT",169,0)
 . . . . N TIUDA
"RTN","TIUASRPT",170,0)
 . . . . S TIUDA=^TMP("TIUD",$J,TIUIFP,TIUSVC,TIUAS,TIUEDT)
"RTN","TIUASRPT",171,0)
 . . . . I TIURPT="F" D PRNTITEM(TIUDA,TIUAS,TIUEDT)
"RTN","TIUASRPT",172,0)
 . . . . I $Y>(IOSL-5) D ASK Q:TIUOUT  D DHDR(TIUIFP,TIUSTDT,TIUENDT)
"RTN","TIUASRPT",173,0)
 . . . . S TIUSVCNT=TIUSVCNT+1,TIUDCNT=TIUDCNT+1
"RTN","TIUASRPT",174,0)
 . . W !,"  Totals for Service   ",TIUSVC,": ",?55,TIUSVCNT
"RTN","TIUASRPT",175,0)
 . . I $Y>(IOSL-5) D ASK Q:TIUOUT  D DHDR(TIUIFP,TIUSTDT,TIUENDT)
"RTN","TIUASRPT",176,0)
 . Q:TIUOUT
"RTN","TIUASRPT",177,0)
 . N TIUDVSTR S TIUDVSTR=$E($P($$NS^XUAF4(TIUIFP),U),1,25)
"RTN","TIUASRPT",178,0)
 . W !,"Totals for Division    ",TIUDVSTR,": ",?55,TIUDCNT
"RTN","TIUASRPT",179,0)
 . I $O(^TMP("TIUD",$J,TIUIFP)) D ASK Q:TIUOUT
"RTN","TIUASRPT",180,0)
 . S TIUTOT=TIUTOT+TIUDCNT
"RTN","TIUASRPT",181,0)
 Q:TIUOUT
"RTN","TIUASRPT",182,0)
 W !,"Totals for all Divisions: ",?55,TIUTOT
"RTN","TIUASRPT",183,0)
 Q
"RTN","TIUASRPT",184,0)
PRNTITEM(TIUDA,TIUAS,TIUEDT) ;
"RTN","TIUASRPT",185,0)
 N TIUPRNT,TIUPAT,TIUSTAT,TIUTYP,TIUD0,TIUD12,TIULST4,TIUDATE
"RTN","TIUASRPT",186,0)
 S TIUPRNT=$$PRNT(TIUDA)
"RTN","TIUASRPT",187,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUASRPT",188,0)
 S TIULST4=$E($$GET1^DIQ(2,$G(TIUPAT),.09),6,9)
"RTN","TIUASRPT",189,0)
 S TIUPAT=$$PATPRNT($P($G(TIUD0),U,2))
"RTN","TIUASRPT",190,0)
 S TIUSTAT=$P($G(TIUD0),U,5)
"RTN","TIUASRPT",191,0)
 S TIUSTAT=$S(TIUSTAT:$E($$EXTERNAL^DILFD(8925,.05,"",TIUSTAT),1,11),1:"UNKNOWN")
"RTN","TIUASRPT",192,0)
 S TIUSTAT=$$STATXFER(TIUSTAT)
"RTN","TIUASRPT",193,0)
 S TIUTYP=+TIUD0
"RTN","TIUASRPT",194,0)
 S TIUTYP=$E($P($G(^TIU(8925.1,TIUTYP,0)),U),1,25)
"RTN","TIUASRPT",195,0)
 S TIUDATE=$$FMTE^XLFDT(TIUEDT,2)
"RTN","TIUASRPT",196,0)
 W !,TIUAS,?17,$G(TIUPAT),?27," "_TIUSTAT,?35,$G(TIUDATE)
"RTN","TIUASRPT",197,0)
 W ?54,$G(TIUTYP),?81,TIUDA
"RTN","TIUASRPT",198,0)
 I +$G(TIUPRNT) W " PARENT = "_TIUPRNT
"RTN","TIUASRPT",199,0)
 Q
"RTN","TIUASRPT",200,0)
ASK ;
"RTN","TIUASRPT",201,0)
 I IO=IO(0),$E(IOST)="C" D
"RTN","TIUASRPT",202,0)
 . W ! N DIR,Y S DIR(0)="E" D ^DIR K DIR
"RTN","TIUASRPT",203,0)
 . I Y=""!(Y=0) S TIUOUT=1
"RTN","TIUASRPT",204,0)
 Q
"RTN","TIUASRPT",205,0)
STATXFER(TIUSTAT) ;format a small status string
"RTN","TIUASRPT",206,0)
 I TIUSTAT="COMPLETED"!(TIUSTAT="completed") Q "com"
"RTN","TIUASRPT",207,0)
 I TIUSTAT="UNSIGNED"!(TIUSTAT="unsigned") Q "uns"
"RTN","TIUASRPT",208,0)
 I TIUSTAT="UNCOSIGNED"!(TIUSTAT="uncosigned") Q "uncos"
"RTN","TIUASRPT",209,0)
 I TIUSTAT="UNDICTATED"!(TIUSTAT="undictated") Q "undic"
"RTN","TIUASRPT",210,0)
 I TIUSTAT="UNTRANSCRIBED"!(TIUSTAT="untranscribed") Q "untr"
"RTN","TIUASRPT",211,0)
 I TIUSTAT="UNRELEASED"!(TIUSTAT="unreleased") Q "unrel"
"RTN","TIUASRPT",212,0)
 I TIUSTAT="UNVERIFIED"!(TIUSTAT="unverified") Q "unver"
"RTN","TIUASRPT",213,0)
 I TIUSTAT="AMENDED"!(TIUSTAT="amended") Q "amend"
"RTN","TIUASRPT",214,0)
 Q "???"
"RTN","TIUASRPT",215,0)
PATPRNT(TIUPAT) ; format patient as initials and then last 6 SSN
"RTN","TIUASRPT",216,0)
 N PAT,LST4,INIT
"RTN","TIUASRPT",217,0)
 I 'TIUPAT Q ""
"RTN","TIUASRPT",218,0)
 S PAT=$$EXTERNAL^DILFD(8925,.02,"",TIUPAT)
"RTN","TIUASRPT",219,0)
 S LST4=$E($$GET1^DIQ(2,$G(TIUPAT),.09),4,9)
"RTN","TIUASRPT",220,0)
 S INIT=$E($P(PAT,",",2))_$E($P(PAT,","))
"RTN","TIUASRPT",221,0)
 Q INIT_LST4
"RTN","TIUBR1")
0^9^B66608015
"RTN","TIUBR1",1,0)
TIUBR1 ;SLC/JER - Enter TIU Browse with DFN and TIUDA ;8/21/01 [12/15/04 9:18am]
"RTN","TIUBR1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**31,100,123,176,157**;Jun 20, 1997
"RTN","TIUBR1",3,0)
 ; Move LOADSIG, XTRASIG, LOADFOR, LOADREC from TIUBR. **100**
"RTN","TIUBR1",4,0)
 ;
"RTN","TIUBR1",5,0)
LOADREC(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ^TMP
"RTN","TIUBR1",6,0)
 ;Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR1",7,0)
 ;Optional TIUGWHOL = 1 if we're mid-load for browse, and we're already
"RTN","TIUBR1",8,0)
 ;                    loading the whole note after the selected child,
"RTN","TIUBR1",9,0)
 ;                    so DON'T load the whole note again.
"RTN","TIUBR1",10,0)
 N TIUKID,TIUI,CANSEE,TIUPARNT,TIUPNAME,TIUPDATE
"RTN","TIUBR1",11,0)
 N TIUGPRNT,TIUPDATA,TIUHASKD
"RTN","TIUBR1",12,0)
 S TIUI=0
"RTN","TIUBR1",13,0)
 ; ---- If user cannot view TIUDA, say so,
"RTN","TIUBR1",14,0)
 ;      [load the rest of the ID note], & quit: ----
"RTN","TIUBR1",15,0)
 S CANSEE=$S(+$$ISCOMP^TIUBR(TIUDA)>0:1,1:$$CANDO^TIULP(+TIUDA,"VIEW"))
"RTN","TIUBR1",16,0)
 I +CANSEE'>0 D  Q
"RTN","TIUBR1",17,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",18,0)
 . S @VALMAR@(TIUL,0)=$P(CANSEE,U,2)
"RTN","TIUBR1",19,0)
 . I $P(TIUGDATA,U,2)!$P(TIUGDATA,U,3) D IDREST(TIUDA,.TIUL,TIUGDATA,.TIUGWHOL)
"RTN","TIUBR1",20,0)
 ; ---- Load text of TIUDA: ----
"RTN","TIUBR1",21,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUBR1",22,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",23,0)
 . S @VALMAR@(TIUL,0)=$G(^TIU(8925,+TIUDA,"TEXT",+TIUI,0))
"RTN","TIUBR1",24,0)
 ; ---- If TIUDA is a COMPONENT, QUIT
"RTN","TIUBR1",25,0)
 Q:+$$ISCOMP^TIUBR(TIUDA)
"RTN","TIUBR1",26,0)
 ; ---- If TIUDA **IS** an addendum, load addm signature,
"RTN","TIUBR1",27,0)
 ;         load original document, quit: ----
"RTN","TIUBR1",28,0)
 I +$$ISADDNDM^TIULC1(+TIUDA) D  Q
"RTN","TIUBR1",29,0)
 . N TIULINE S $P(TIULINE,"=",79)=""
"RTN","TIUBR1",30,0)
 . D LOADSIG(TIUDA,.TIUL)
"RTN","TIUBR1",31,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",32,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIULINE
"RTN","TIUBR1",33,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",34,0)
 . S TIUPARNT=+$P(^TIU(8925,+TIUDA,0),U,6)
"RTN","TIUBR1",35,0)
 . S TIUPNAME=$$PNAME^TIULC1(+^TIU(8925,TIUPARNT,0))
"RTN","TIUBR1",36,0)
 . S TIUPDATE=+$G(^TIU(8925,TIUPARNT,13))
"RTN","TIUBR1",37,0)
 . S TIUPDATE=$$DATE^TIULS(TIUPDATE,"MM/DD/YY")
"RTN","TIUBR1",38,0)
 . S TIUPDATA=$$IDDATA^TIURECL1(TIUPARNT)
"RTN","TIUBR1",39,0)
 . S TIUHASKD=$P(TIUPDATA,U,2),TIUGPRNT=+$P(TIUPDATA,U,3)
"RTN","TIUBR1",40,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",41,0)
 . I 'TIUHASKD,'TIUGPRNT D
"RTN","TIUBR1",42,0)
 . . S @VALMAR@(TIUL,0)=" --- Original Document ---"
"RTN","TIUBR1",43,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",44,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",45,0)
 . . S @VALMAR@(TIUL,0)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUBR1",46,0)
 . . D LOADREC(TIUPARNT,.TIUL,TIUGDATA)
"RTN","TIUBR1",47,0)
 . I TIUHASKD D
"RTN","TIUBR1",48,0)
 . . S @VALMAR@(TIUL,0)=" --- Addended Interdisciplinary Note ---"
"RTN","TIUBR1",49,0)
 . . D LOADID^TIUGBR(TIUPARNT,.TIUL,TIUPDATA,1)
"RTN","TIUBR1",50,0)
 . I TIUGPRNT D
"RTN","TIUBR1",51,0)
 . . S @VALMAR@(TIUL,0)=" --- Original Interdisciplinary Entry ---"
"RTN","TIUBR1",52,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",53,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",54,0)
 . . S @VALMAR@(TIUL,0)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUBR1",55,0)
 . . D LOADREC(TIUPARNT,.TIUL,TIUGDATA)
"RTN","TIUBR1",56,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",57,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",58,0)
 . . S @VALMAR@(TIUL,0)=" --- Interdisciplinary Note ---"
"RTN","TIUBR1",59,0)
 . . D LOADID^TIUGBR(TIUGPRNT,.TIUL,TIUPDATA,1)
"RTN","TIUBR1",60,0)
 ; ---- Load components of TIUDA: ----
"RTN","TIUBR1",61,0)
 S TIUKID=0
"RTN","TIUBR1",62,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUBR1",63,0)
 . I +$$ISADDNDM^TIULC1(TIUKID)'>0 D LOADREC(TIUKID,.TIUL,TIUGDATA)
"RTN","TIUBR1",64,0)
 ; ---- Load signature of TIUDA if TIUDA is not addm
"RTN","TIUBR1",65,0)
 ;           or comp: ----
"RTN","TIUBR1",66,0)
 I '$$ISCOMP^TIUBR(TIUDA) D LOADSIG(TIUDA,.TIUL)
"RTN","TIUBR1",67,0)
 ; ---- Load addenda of TIUDA: ----
"RTN","TIUBR1",68,0)
 S TIUKID=0
"RTN","TIUBR1",69,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUBR1",70,0)
 . ; If an addendum has focus, don't show it again unless
"RTN","TIUBR1",71,0)
 . ; loading whole ID note:
"RTN","TIUBR1",72,0)
 . I '$G(TIUGWHOL),+TIUKID=+$G(^TMP("TIU FOCUS",$J)) Q
"RTN","TIUBR1",73,0)
 . I +$$ISADDNDM^TIULC1(TIUKID) D LOADADD^TIUBR(TIUKID,.TIUL)
"RTN","TIUBR1",74,0)
 ; ---- Load the rest of the ID note display: ----
"RTN","TIUBR1",75,0)
 I $P(TIUGDATA,U,2)!$P(TIUGDATA,U,3) D IDREST(TIUDA,.TIUL,TIUGDATA,.TIUGWHOL)
"RTN","TIUBR1",76,0)
 Q
"RTN","TIUBR1",77,0)
 ;
"RTN","TIUBR1",78,0)
IDREST(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load rest of ID note display
"RTN","TIUBR1",79,0)
 N IDDAD
"RTN","TIUBR1",80,0)
 S IDDAD=+$P(TIUGDATA,U,3)
"RTN","TIUBR1",81,0)
 ; ---- If Browsed Record is an ID child, & this cycle hasn't begun
"RTN","TIUBR1",82,0)
 ;      loading the whole note, then load the whole ID Note after
"RTN","TIUBR1",83,0)
 ;      the browsed child: ----
"RTN","TIUBR1",84,0)
 I IDDAD,'$G(TIUGWHOL) D  Q
"RTN","TIUBR1",85,0)
 . S TIUGWHOL=1
"RTN","TIUBR1",86,0)
 . N TIULINE S $P(TIULINE,"=",79)=""
"RTN","TIUBR1",87,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",88,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIULINE
"RTN","TIUBR1",89,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",90,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" --- Interdisciplinary Note ---"
"RTN","TIUBR1",91,0)
 . D LOADID^TIUGBR(IDDAD,.TIUL,TIUGDATA,TIUGWHOL)
"RTN","TIUBR1",92,0)
 ; ---- If Browsed Record is an ID parent, & this cycle has
"RTN","TIUBR1",93,0)
 ;      just loaded the parent entry, OR
"RTN","TIUBR1",94,0)
 ;      If Browsed Record is an ID child, & this cycle has begun
"RTN","TIUBR1",95,0)
 ;      loading the whole ID note, and is currently loading the first
"RTN","TIUBR1",96,0)
 ;      entry of the whole note,
"RTN","TIUBR1",97,0)
 ;      Then load kids: ----
"RTN","TIUBR1",98,0)
 I $P(TIUGDATA,U,2)&(TIUDA=+TIUGDATA)!(IDDAD&$G(TIUGWHOL)&(TIUDA=IDDAD)) D
"RTN","TIUBR1",99,0)
 . D LOADKIDS^TIUBR(TIUDA,.TIUL,TIUGDATA,$G(TIUGWHOL)) K TIUGWHOL
"RTN","TIUBR1",100,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",101,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="                      << Interdisciplinary Note - End >>"
"RTN","TIUBR1",102,0)
 Q
"RTN","TIUBR1",103,0)
EXSTNOTE(DFN,TIUDA) ; Sample/display existing notes
"RTN","TIUBR1",104,0)
 N TIU,TIUPRM0,TIUPRM1,TIUSEE,TIUOUT,TIUY,TIUQUIT
"RTN","TIUBR1",105,0)
 D SETPARM^TIULE
"RTN","TIUBR1",106,0)
 Q:TIUDA'>0
"RTN","TIUBR1",107,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUBR1",108,0)
 I $D(TIU) D
"RTN","TIUBR1",109,0)
 . S TIUSEE=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUBR1",110,0)
 . I 'TIUSEE D  Q
"RTN","TIUBR1",111,0)
 . . W !!,$C(7),$P(TIUSEE,U,2),!
"RTN","TIUBR1",112,0)
 . . W:$$READ^TIUU("FOA","Press RETURN to continue...") ""
"RTN","TIUBR1",113,0)
 . D EN^VALM("TIU BROWSE FOR CLINICIAN")
"RTN","TIUBR1",114,0)
 . K ^TMP("TIUVIEW",$J)
"RTN","TIUBR1",115,0)
 . S:$D(TIUQUIT) TIUOUT=1
"RTN","TIUBR1",116,0)
 Q
"RTN","TIUBR1",117,0)
 ;
"RTN","TIUBR1",118,0)
LOADSIG(DA,TIUL) ; Get signature and co-signature blocks
"RTN","TIUBR1",119,0)
 N DIC,DIQ,DR,TIUSIG,TIUESIG1,TIUESIG2,TIUSIG1,TIUSIG2,TIUS1,TIUS2
"RTN","TIUBR1",120,0)
 N TIUSNM,TIUSTTL,TIUS1DT,TIUS2DT,TIUSDT
"RTN","TIUBR1",121,0)
 Q:'$D(^TIU(8925,DA,15))
"RTN","TIUBR1",122,0)
 S DIC=8925,DIQ="TIUSIG(",DIQ(0)="IE",DR="1204;1208;1501:1505;1507:1513;1601:1605"
"RTN","TIUBR1",123,0)
 D EN^DIQ1 I '$D(TIUSIG) Q
"RTN","TIUBR1",124,0)
 S TIUS1=$S(TIUSIG(8925,DA,1505,"I")="E":"/es/ ",TIUSIG(8925,DA,1505,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1503,"E"))
"RTN","TIUBR1",125,0)
 S TIUS2=$S(TIUSIG(8925,DA,1511,"I")="E":"/es/ ",TIUSIG(8925,DA,1511,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1509,"E"))
"RTN","TIUBR1",126,0)
 S TIUESIG1=$G(TIUSIG(8925,DA,1204,"I"))
"RTN","TIUBR1",127,0)
 S TIUSIG1=$G(TIUSIG(8925,DA,1502,"I"))
"RTN","TIUBR1",128,0)
 S TIUS1DT=$S(+$G(TIUSIG(8925,DA,1501,"I")):"Signed: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1501,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUBR1",129,0)
 S TIUESIG2=$G(TIUSIG(8925,DA,1208,"I"))
"RTN","TIUBR1",130,0)
 S TIUS2DT=$S(+$G(TIUSIG(8925,DA,1507,"I")):"Cosigned: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1507,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUBR1",131,0)
 S TIUSIG2=$G(TIUSIG(8925,DA,1508,"I"))
"RTN","TIUBR1",132,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR1",133,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUS1
"RTN","TIUBR1",134,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$G(TIUSIG(8925,DA,1504,"E"))
"RTN","TIUBR1",135,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUS1DT
"RTN","TIUBR1",136,0)
 I $G(TIUSIG(8925,DA,1505,"I"))="C" D
"RTN","TIUBR1",137,0)
 . N TIUONCH
"RTN","TIUBR1",138,0)
 . S TIUONCH=$G(TIUSIG(8925,DA,1512,"E")) I '$L(TIUONCH) S TIUONCH=$G(TIUSIG(8925,DA,1513,"E"))
"RTN","TIUBR1",139,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="Marked signed on chart by: "_TIUONCH
"RTN","TIUBR1",140,0)
 I TIUSIG1]"",(TIUSIG1'=TIUESIG1) D LOADFOR(TIUSIG1,TIUESIG1,.TIUL)
"RTN","TIUBR1",141,0)
 I +$G(TIUSIG(8925,DA,1507,"I"))>0 D
"RTN","TIUBR1",142,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR1",143,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUS2
"RTN","TIUBR1",144,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$G(TIUSIG(8925,DA,1510,"E"))
"RTN","TIUBR1",145,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUS2DT
"RTN","TIUBR1",146,0)
 . I $G(TIUSIG(8925,DA,1511,"I"))="C" D
"RTN","TIUBR1",147,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="Marked cosigned on chart by: "_$G(TIUSIG(8925,DA,1513,"E"))
"RTN","TIUBR1",148,0)
 I TIUSIG2]"",(TIUSIG2'=TIUESIG2) D LOADFOR(TIUSIG2,TIUESIG2,.TIUL)
"RTN","TIUBR1",149,0)
XTRA I +$O(^TIU(8925.7,"B",DA,0)) D XTRASIG(DA,.TIUL)
"RTN","TIUBR1",150,0)
 I +$G(TIUSIG(8925,DA,1601,"I")) D
"RTN","TIUBR1",151,0)
 . N TIUMODE
"RTN","TIUBR1",152,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR1",153,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR1",154,0)
 . S @VALMAR@(TIUL,0)=$$DATE^TIULS(TIUSIG(8925,DA,1601,"I"),"MM/DD/CCYY HR:MIN")_"  AMENDMENT FILED:"
"RTN","TIUBR1",155,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="",TIUL=+$G(TIUL)+1
"RTN","TIUBR1",156,0)
 . S TIUMODE=$S(+$G(TIUSIG(8925,DA,1603,"I")):"/es/ ",1:" /s/ ")
"RTN","TIUBR1",157,0)
 . S @VALMAR@(TIUL,0)=TIUMODE_$S($G(TIUSIG(8925,DA,1604,"E"))]"":$G(TIUSIG(8925,DA,1604,"E")),1:$G(TIUSIG(8925,DA,1602,"E")))
"RTN","TIUBR1",158,0)
 . I $L($G(TIUSIG(8925,DA,1605,"E"))) D
"RTN","TIUBR1",159,0)
 . . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$G(TIUSIG(8925,DA,1605,"E"))
"RTN","TIUBR1",160,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=$P($G(TIUPRM1),U,5)
"RTN","TIUBR1",161,0)
 Q
"RTN","TIUBR1",162,0)
XTRASIG(TIUDA,TIUL) ; Load additional signature blocks
"RTN","TIUBR1",163,0)
 N TIUI,DA,DR,DIC,DIQ,TIUXTRA S TIUI=0
"RTN","TIUBR1",164,0)
 S DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIUBR1",165,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR1",166,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)="Receipt Acknowledged By:"
"RTN","TIUBR1",167,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUBR1",168,0)
 . N TIUX,TIUSGNR,TIUSDT
"RTN","TIUBR1",169,0)
 . S DA=TIUI,DR=".03:.08",DIQ(0)="IE" D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIUBR1",170,0)
 . S TIUSGNR=$S($L($G(TIUXTRA(8925.7,DA,.06,"E"))):"/es/ "_$G(TIUXTRA(8925.7,DA,.06,"E")),1:"     "_$G(TIUXTRA(8925.7,DA,.03,"E")))
"RTN","TIUBR1",171,0)
 . S TIUSDT=$S(+$G(TIUXTRA(8925.7,DA,.04,"I")):$$DATE^TIULS(TIUXTRA(8925.7,DA,.04,"I"),"MM/DD/CCYY HR:MIN"),1:"* AWAITING SIGNATURE *")
"RTN","TIUBR1",172,0)
 . S TIUX=$$SETSTR^VALM1(TIUSDT,$G(TIUX),1,38)
"RTN","TIUBR1",173,0)
 . S TIUX=$$SETSTR^VALM1(TIUSGNR,$G(TIUX),25,55)
"RTN","TIUBR1",174,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUX,TIUX=""
"RTN","TIUBR1",175,0)
 . S TIUX=$$SETSTR^VALM1($G(TIUXTRA(8925.7,DA,.07,"E")),$G(TIUX),30,50)
"RTN","TIUBR1",176,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUX
"RTN","TIUBR1",177,0)
 . I $G(TIUXTRA(8925.7,DA,.05,"I")),$G(TIUXTRA(8925.7,DA,.05,"I"))'=$G(TIUXTRA(8925.7,DA,.03,"I")) D
"RTN","TIUBR1",178,0)
 . . N TIUFOR
"RTN","TIUBR1",179,0)
 . . S TIUX=""
"RTN","TIUBR1",180,0)
 . . S TIUFOR="for "_$P($G(TIUXTRA(8925.7,DA,.03,"E")),",",2)_" "_$P($G(TIUXTRA(8925.7,DA,.03,"E")),",")
"RTN","TIUBR1",181,0)
 . . S TIUX=$$SETSTR^VALM1(TIUFOR,$G(TIUX),26,55)
"RTN","TIUBR1",182,0)
 . . S TIUL=TIUL+1,@VALMAR@(TIUL,0)=TIUX
"RTN","TIUBR1",183,0)
 Q
"RTN","TIUBR1",184,0)
LOADFOR(TIUS1,TIUES1,TIUL) ; Apply "for" block
"RTN","TIUBR1",185,0)
 N TIUESN1,TIUEST1,TIUFORN,TIUFORT
"RTN","TIUBR1",186,0)
 S TIUESN1="for "_$$SIGNAME^TIULS(TIUES1),TIUEST1=$$SIGTITL^TIULS(TIUES1)
"RTN","TIUBR1",187,0)
 I +$G(TIUS1),($G(TIUS1)'=$G(TIUES1)) S TIUFORN=$$SETSTR^VALM1(TIUESN1,$G(TIUFORN),1,50),TIUFORT=$$SETSTR^VALM1(TIUEST1,$G(TIUFORT),1,50)
"RTN","TIUBR1",188,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUFORN
"RTN","TIUBR1",189,0)
 S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUFORT
"RTN","TIUBR1",190,0)
 Q
"RTN","TIULP")
0^2^B39535720
"RTN","TIULP",1,0)
TIULP ; SLC/JER - Functions determining privilege ; Jan 1, 2004 [12/20/04 11:52am]
"RTN","TIULP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**98,100,116,109,138,152,175,157**;Jun 20, 1997
"RTN","TIULP",3,0)
CANDO(TIUDA,TIUACT,PERSON) ; Can PERSON perform action now
"RTN","TIULP",4,0)
 ; Receives: TIUDA=Record number in file 8925
"RTN","TIULP",5,0)
 ;           TIUACT=Name of user action in 8930.8 (USR ACTION)
"RTN","TIULP",6,0)
 ;           PERSON=New Person file IFN.
"RTN","TIULP",7,0)
 ;                  Assumed to be DUZ if not received.
"RTN","TIULP",8,0)
 ;                  New **100** ID param, backward compatible.
"RTN","TIULP",9,0)
 ;  Returns:   TIUY=1:yes,0:no_"^"_why not message
"RTN","TIULP",10,0)
 N TIUI,TIUTYP,TIUROLE,STATUS,TIUY,TIUATYP,MSG,WHO,MODIFIER
"RTN","TIULP",11,0)
 S TIUY=0 I '$G(PERSON) S PERSON=DUZ
"RTN","TIULP",12,0)
 ;**100** was I +TIUACT'>0 S TIUACT etc.
"RTN","TIULP",13,0)
 S TIUACT=$$USREVNT(TIUACT) I +TIUACT'>0 S TIUY=0 G CANDOX
"RTN","TIULP",14,0)
 ; **152 Get status to evaluate for completed document.
"RTN","TIULP",15,0)
 S STATUS=+$P($G(^TIU(8925,+TIUDA,0)),U,5)
"RTN","TIULP",16,0)
 ; **152 prevents editing or sending back a completed document.
"RTN","TIULP",17,0)
 I STATUS>6,(+TIUACT=9)!(+TIUACT=17) D  G CANDOX
"RTN","TIULP",18,0)
 .; **152 Displays message to user
"RTN","TIULP",19,0)
 . I +TIUACT=9 S TIUY="0^ You may not edit a completed document."
"RTN","TIULP",20,0)
 . I +TIUACT=17 S TIUY="0^You may not send back this completed document."
"RTN","TIULP",21,0)
 ; -- In case business rules have changed, & children already existed:
"RTN","TIULP",22,0)
 I +TIUACT=24,$D(^TIU(8925,"GDAD",TIUDA)) D  G CANDOX
"RTN","TIULP",23,0)
 . S TIUY="0^ This note cannot be attached; it has its own children."
"RTN","TIULP",24,0)
 I +TIUACT=25,+$G(^TIU(8925,TIUDA,21)) D  G CANDOX
"RTN","TIULP",25,0)
 . S TIUY="0^ This note cannot receive interdisciplinary children; it is itself a child."
"RTN","TIULP",26,0)
 I +TIUACT=4!(+TIUACT=5),+$$BLANK^TIULC(TIUDA) D  G CANDOX
"RTN","TIULP",27,0)
 . S TIUY="0^ Contains blanks ("_$P(TIUPRM1,U,6)_") which must be filled before "_$P(TIUACT,U,2)_"ATURE."
"RTN","TIULP",28,0)
 S TIUROLE=$$USRROLE(TIUDA,PERSON)
"RTN","TIULP",29,0)
 S TIUTYP=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIULP",30,0)
 I $$ISADDNDM^TIULC1(+TIUDA) S TIUATYP=TIUTYP,TIUTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIULP",31,0)
 I TIUROLE']"" S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,PERSON)
"RTN","TIULP",32,0)
 F TIUI=1:1:($L(TIUROLE,U)-1) D  Q:+$G(TIUY)>0
"RTN","TIULP",33,0)
 . S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,PERSON,$P(TIUROLE,U,TIUI))
"RTN","TIULP",34,0)
 I +$G(TIUATYP) S TIUTYP=+$G(TIUATYP)
"RTN","TIULP",35,0)
 ;**100** update for PERSON param; update for verb modifier:
"RTN","TIULP",36,0)
 I +TIUY'>0 D  G CANDOX
"RTN","TIULP",37,0)
 . S WHO=" You"
"RTN","TIULP",38,0)
 . I PERSON'=DUZ S WHO=$$NAME^TIULS($$GET1^DIQ(200,PERSON,.01),"FIRST LAST")
"RTN","TIULP",39,0)
 . S MODIFIER=$P(TIUACT,U,3) I $L(MODIFIER) S MODIFIER=" "_MODIFIER
"RTN","TIULP",40,0)
 . ;e.g. "You may not ATTACH this UNSIGNED TELEPHONE NOTE TO AN ID NOTE."
"RTN","TIULP",41,0)
 . S MSG=WHO_" may not "_$P(TIUACT,U,2)_" this "_$P($G(^TIU(8925.6,+STATUS,0)),U)_" "_$$PNAME^TIULC1(TIUTYP)_MODIFIER_"."
"RTN","TIULP",42,0)
 . S TIUY=TIUY_U_MSG
"RTN","TIULP",43,0)
 I +TIUACT=15,$$HASIMG^TIURB2(+TIUDA) D  G CANDOX
"RTN","TIULP",44,0)
 . S TIUY="0^ This document contains linked images. You must ""delete"" the Images using the Imaging package before proceeding."
"RTN","TIULP",45,0)
CANDOX Q TIUY
"RTN","TIULP",46,0)
 ;
"RTN","TIULP",47,0)
CANLINK(TIUTYP) ; Can user (DUZ) link (attach) a document of a particular type
"RTN","TIULP",48,0)
 ;to an ID note.
"RTN","TIULP",49,0)
 ; For use in ADD NEW ID NOTE, where docmt is not entered yet.
"RTN","TIULP",50,0)
 ; Assume most favorable circumstances (user will complete
"RTN","TIULP",51,0)
 ;the note, so if user still can't attach, can tell them no,
"RTN","TIULP",52,0)
 ;when they first select title for the new entry.
"RTN","TIULP",53,0)
 ; Rule out if TIUTYP can be an ID parent, since ID parent
"RTN","TIULP",54,0)
 ;and ID kid function as mutually exclusive, (regardless of
"RTN","TIULP",55,0)
 ;business rules).
"RTN","TIULP",56,0)
 N TIUACT,STATUS,USRROLE,TIUY
"RTN","TIULP",57,0)
 S TIUACT=$$USREVNT("ATTACH TO ID NOTE"),STATUS=7 ; complete
"RTN","TIULP",58,0)
 S USRROLE=+$O(^USR(8930.2,"B","COMPLETER",0))
"RTN","TIULP",59,0)
 S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,DUZ,USRROLE)
"RTN","TIULP",60,0)
 I '$G(TIUY) S TIUY="0^ You may not use this title for interdisciplinary child entries." Q TIUY
"RTN","TIULP",61,0)
 ; -- If user can attach a certain note, but note can also receive
"RTN","TIULP",62,0)
 ;    ID entries, don't let user attach it. --
"RTN","TIULP",63,0)
 I $$POSSPRNT^TIULP(TIUTYP) S TIUY="0^ This interdisciplinary PARENT title cannot be used for CHILD entries."
"RTN","TIULP",64,0)
 ; -- If selected type is a CWAD, don't let user attach it: --
"RTN","TIULP",65,0)
 I $$ISCWAD^TIULX(TIUTYP) S TIUY="0^ CWAD titles cannot be used for interdisciplinary entries."
"RTN","TIULP",66,0)
 ; -- If selected type is a consult, don't let user attach it: --
"RTN","TIULP",67,0)
 I $$ISA^TIULX(TIUTYP,+$$CLASS^TIUCNSLT) S TIUY="0^ Consult titles cannot be used for interdisciplinary entries."
"RTN","TIULP",68,0)
 Q TIUY
"RTN","TIULP",69,0)
 ;
"RTN","TIULP",70,0)
POSSPRNT(TIUTYP) ; Is a docmt intended as a possible ID parent?
"RTN","TIULP",71,0)
 ;Returns 1^WHYCAN'TATTACH if there are business rules permitting ANYONE
"RTN","TIULP",72,0)
 ;to attach ID entries to notes of type TIUTYP.
"RTN","TIULP",73,0)
 ;Else returns 0.
"RTN","TIULP",74,0)
 N TIUACT,STATUS,TIUY,DADTYP
"RTN","TIULP",75,0)
 S TIUY=0,TIUACT=+$$USREVNT("ATTACH ID ENTRY")
"RTN","TIULP",76,0)
 F STATUS=6,7,8 D  G:TIUY POSSX
"RTN","TIULP",77,0)
 . I $O(^USR(8930.1,"AR",TIUTYP,STATUS,TIUACT,0)) S TIUY=1 Q
"RTN","TIULP",78,0)
 . I $O(^USR(8930.1,"AC",TIUTYP,STATUS,TIUACT,0)) S TIUY=1
"RTN","TIULP",79,0)
 ; -- If no rules for TIUTYP, try its parent: --
"RTN","TIULP",80,0)
 S DADTYP=$O(^TIU(8925.1,"AD",TIUTYP,0)) G:DADTYP'>0 POSSX
"RTN","TIULP",81,0)
 S TIUY=$$POSSPRNT(DADTYP)
"RTN","TIULP",82,0)
POSSX I TIUY S TIUY="1^ Interdisciplinary PARENT notes cannot be attached as CHILD entries."
"RTN","TIULP",83,0)
 Q TIUY
"RTN","TIULP",84,0)
 ;
"RTN","TIULP",85,0)
CANENTR(TIUTYP) ; Evaluate privilege to enter a document of a particular type
"RTN","TIULP",86,0)
 N TIUACT,STATUS,USRROLE,TIUY
"RTN","TIULP",87,0)
 S TIUACT=$$USREVNT("ENTRY"),STATUS=2 ; untranscribed
"RTN","TIULP",88,0)
 S USRROLE=3 ; transcriber
"RTN","TIULP",89,0)
 S TIUY=$$CANDO^USRLA(TIUTYP,STATUS,+TIUACT,DUZ,USRROLE)
"RTN","TIULP",90,0)
 Q TIUY
"RTN","TIULP",91,0)
USRROLE(TIUDA,PERSON) ; Identify the user's role with respect to the document
"RTN","TIULP",92,0)
 ; 3/20/00 **100** Added role COMPLETER
"RTN","TIULP",93,0)
 ; 3/20/00 **100** Added PERSON param
"RTN","TIULP",94,0)
 N TIU0,TIU12,TIU13,TIUY,TIU15,COMPLTR,STATUS
"RTN","TIULP",95,0)
 S PERSON=$G(PERSON,DUZ)
"RTN","TIULP",96,0)
 S TIU0=$G(^TIU(8925,+TIUDA,0)),STATUS=$P(TIU0,U,5)
"RTN","TIULP",97,0)
 S TIU12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIULP",98,0)
 S TIU13=$G(^TIU(8925,+TIUDA,13)),TIU15=$G(^TIU(8925,+TIUDA,15))
"RTN","TIULP",99,0)
 I PERSON=+$P(TIU13,U,2) S TIUY=+$O(^USR(8930.2,"B","TRANSCRIBER",0))_U
"RTN","TIULP",100,0)
 I PERSON=+$P(TIU12,U,2) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","AUTHOR/DICTATOR",0))_U
"RTN","TIULP",101,0)
 I PERSON=+$P(TIU12,U,9) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","ATTENDING PHYSICIAN",0))_U
"RTN","TIULP",102,0)
 I PERSON=+$P(TIU12,U,4) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","EXPECTED SIGNER",0))_U
"RTN","TIULP",103,0)
 I PERSON=+$P(TIU12,U,8) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","EXPECTED COSIGNER",0))_U
"RTN","TIULP",104,0)
 I $$ASURG^TIUADSIG(TIUDA) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","SURROGATE",0))_U
"RTN","TIULP",105,0)
 ;Check if the person can be an Interpreter for this document via a Consult API
"RTN","TIULP",106,0)
 I $$CPINTERP^GMRCCP(+TIUDA,PERSON) S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","INTERPRETER",0))_U
"RTN","TIULP",107,0)
 I STATUS>6 D  I COMPLTR S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","COMPLETER",0))_U
"RTN","TIULP",108,0)
 . S COMPLTR=0
"RTN","TIULP",109,0)
 . I PERSON=+$P(TIU15,U,8) S COMPLTR=1 Q
"RTN","TIULP",110,0)
 . I '$P(TIU15,U,8),PERSON=+$P(TIU15,U,2) S COMPLTR=1
"RTN","TIULP",111,0)
 I +$O(^TIU(8925.7,"AE",+TIUDA,+PERSON,0)) D
"RTN","TIULP",112,0)
 . N TIUXTRA S TIUXTRA=+$O(^TIU(8925.7,"AE",+TIUDA,+PERSON,0))
"RTN","TIULP",113,0)
 . I +$P($G(^TIU(8925.7,+TIUXTRA,0)),U,4) Q
"RTN","TIULP",114,0)
 . S TIUY=$G(TIUY)_+$O(^USR(8930.2,"B","ADDITIONAL SIGNER",0))_U
"RTN","TIULP",115,0)
 Q $G(TIUY)
"RTN","TIULP",116,0)
USREVNT(EVENT) ; Given event name, return:
"RTN","TIULP",117,0)
 ;EVENT = event pointer^user verb^verb modifier
"RTN","TIULP",118,0)
 ; **100** added verb modifier piece (.07)
"RTN","TIULP",119,0)
 N TIUY,TIUDA,NODE0
"RTN","TIULP",120,0)
 S TIUDA=+$O(^USR(8930.8,"B",EVENT,0))
"RTN","TIULP",121,0)
 S NODE0=$G(^USR(8930.8,TIUDA,0))
"RTN","TIULP",122,0)
 S TIUY=TIUDA_U_$P(NODE0,U,5)_U_$P(NODE0,U,7)
"RTN","TIULP",123,0)
 Q TIUY
"RTN","TIULP",124,0)
CANPICK(TIUTYP) ; Screens selection of title by title status and
"RTN","TIULP",125,0)
 ;(for status TEST), by owner.
"RTN","TIULP",126,0)
 N TIUPOWN,TIUCOWN,TIUT0,TIUTSTAT,TIUY S TIUY=0
"RTN","TIULP",127,0)
 S TIUT0=$G(^TIU(8925.1,+TIUTYP,0)),TIUTSTAT=$P(TIUT0,U,7)
"RTN","TIULP",128,0)
 I TIUTSTAT']"" S TIUY=0 G CANPIX
"RTN","TIULP",129,0)
 I TIUTSTAT=13 S TIUY=0 G CANPIX
"RTN","TIULP",130,0)
 I TIUTSTAT=11 S TIUY=1 G CANPIX
"RTN","TIULP",131,0)
 S TIUPOWN=$P(TIUT0,U,5),TIUCOWN=+$P(TIUT0,U,6)
"RTN","TIULP",132,0)
 I TIUTSTAT=10 S TIUY=$S(TIUPOWN=DUZ:1,+$$ISA^USRLM(DUZ,TIUCOWN):1,1:0)
"RTN","TIULP",133,0)
CANPIX Q +$G(TIUY)
"RTN","TIULP",134,0)
REQCOSIG(TIUTYP,TIUDA,USER,TIUDT) ; Evaluate whether user requires cosignature
"RTN","TIULP",135,0)
 N TIUI,TIUY,TIUDPRM S USER=$S(+$G(USER):+$G(USER),1:+$G(DUZ))
"RTN","TIULP",136,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,+$G(TIUDA))
"RTN","TIULP",137,0)
 I $G(TIUDPRM(5))="" G REQCOSX
"RTN","TIULP",138,0)
 I +$G(TIUDT)'>0 S TIUDT=+$P($P(+$G(^TIU(8925,+$G(TIUDA),13)),U),".")
"RTN","TIULP",139,0)
 F TIUI=1:1:$L(TIUDPRM(5),U) D  Q:+TIUY>0
"RTN","TIULP",140,0)
 . S TIUY=+$$ISA^USRLM(+USER,+$P(TIUDPRM(5),U,TIUI),,+$G(TIUDT))
"RTN","TIULP",141,0)
REQCOSX Q +$G(TIUY)
"RTN","TIULP",142,0)
 ;
"RTN","TIULP",143,0)
REQCPF(TIUCDA) ;Check if clinical procedure fields are required
"RTN","TIULP",144,0)
 ; Input  -- TIUCDA   Request/Consult File (#123) IEN
"RTN","TIULP",145,0)
 ; Output -- 1=Required and 0=Not Required
"RTN","TIULP",146,0)
 N TIUCPACT,REQF
"RTN","TIULP",147,0)
 I '$G(TIUCDA) G REQCPFQ
"RTN","TIULP",148,0)
 S TIUCPACT=$$CPACTM^GMRCCP(TIUCDA)
"RTN","TIULP",149,0)
 I TIUCPACT=1!(TIUCPACT=3) S REQF=1
"RTN","TIULP",150,0)
REQCPFQ Q +$G(REQF)
"RTN","TIULQ")
0^8^B15406577
"RTN","TIULQ",1,0)
TIULQ ; SLC/JER - Record Extract Using FM Retriever ;3/22/01 [10/18/04 8:49am]
"RTN","TIULQ",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,100,157**;Jun 20, 1997
"RTN","TIULQ",3,0)
EXTRACT(TIUDA,TIUROOT,TIUERR,DR,TIULINE,TIUTEXT,FORMAT,OVRRIDE,ORIGCHLD) ; Gets record & addenda and ID kids
"RTN","TIULQ",4,0)
 ; Do we need a new DBIA here? MARGY
"RTN","TIULQ",5,0)
 N DA,DIC,DIQ,TIULQ,X,Y
"RTN","TIULQ",6,0)
 S TIUROOT=$G(TIUROOT,"^TMP(""TIULQ"",$J)")
"RTN","TIULQ",7,0)
 S DA=TIUDA,DIC=8925,DIQ="TIULQ",DIQ(0)=$G(FORMAT,"IE")
"RTN","TIULQ",8,0)
 I $G(DR)']"" S DR=".01:.1;1201:1701"
"RTN","TIULQ",9,0)
 D EN^DIQ1
"RTN","TIULQ",10,0)
 I '$D(TIULQ) S TIUERR="1^ Record Extract Failed"
"RTN","TIULQ",11,0)
 M @TIUROOT@(TIUDA)=TIULQ(8925,TIUDA)
"RTN","TIULQ",12,0)
 D XTRASIGN(DA,+$G(TIULINE))
"RTN","TIULQ",13,0)
 D PROBLEMS(DA,+$G(TIULINE))
"RTN","TIULQ",14,0)
 I +$G(TIUTEXT) D TEXT(TIUDA,+$G(TIULINE),TIUDA,+$G(OVRRIDE),+$G(ORIGCHLD))
"RTN","TIULQ",15,0)
 Q
"RTN","TIULQ",16,0)
XTRASIGN(TIUDA,TIUJ) ; Get Extra Signers
"RTN","TIULQ",17,0)
 N TIUI,TIUXTRA,TIUC,DR,DIC,DIQ S TIUI=0
"RTN","TIULQ",18,0)
 F  S TIUI=$O(^TIU(8925.7,"B",+TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIULQ",19,0)
 . N TIUDT,TIUSGN,TIUSNM,TIUSTTL,TIUEIEN,TIUENAME
"RTN","TIULQ",20,0)
 . S DA=TIUI,DR=".03:.07",DIC="^TIU(8925.7,",DIQ="TIUXTRA",DIQ(0)="IE"
"RTN","TIULQ",21,0)
 . D EN^DIQ1 Q:$D(TIUXTRA)'>9
"RTN","TIULQ",22,0)
 . S TIUC=+$G(TIUC)+1
"RTN","TIULQ",23,0)
 . S TIUEIEN=$G(TIUXTRA(8925.7,DA,.03,"I"))
"RTN","TIULQ",24,0)
 . S TIUENAME=$G(TIUXTRA(8925.7,DA,.03,"E"))
"RTN","TIULQ",25,0)
 . S TIUDT=$G(TIUXTRA(8925.7,DA,.04,"I"))
"RTN","TIULQ",26,0)
 . S TIUSGN=$G(TIUXTRA(8925.7,DA,.05,"I"))
"RTN","TIULQ",27,0)
 . S TIUSNM=$G(TIUXTRA(8925.7,DA,.06,"E"))
"RTN","TIULQ",28,0)
 . S TIUSTTL=$G(TIUXTRA(8925.7,DA,.07,"E"))
"RTN","TIULQ",29,0)
 . S @TIUROOT@(TIUDA,"EXTRASGNR",(TIUJ+TIUC),"EXPIEN")=TIUEIEN
"RTN","TIULQ",30,0)
 . S @TIUROOT@(TIUDA,"EXTRASGNR",(TIUJ+TIUC),"EXPNAME")=TIUENAME
"RTN","TIULQ",31,0)
 . S @TIUROOT@(TIUDA,"EXTRASGNR",(TIUJ+TIUC),"DATE")=TIUDT
"RTN","TIULQ",32,0)
 . S @TIUROOT@(TIUDA,"EXTRASGNR",(TIUJ+TIUC),"EXTRA")=TIUSGN
"RTN","TIULQ",33,0)
 . S @TIUROOT@(TIUDA,"EXTRASGNR",(TIUJ+TIUC),"NAME")=TIUSNM
"RTN","TIULQ",34,0)
 . S @TIUROOT@(TIUDA,"EXTRASGNR",(TIUJ+TIUC),"TITLE")=TIUSTTL
"RTN","TIULQ",35,0)
 Q
"RTN","TIULQ",36,0)
PROBLEMS(TIUDA,TIUJ) ; Get associated problems
"RTN","TIULQ",37,0)
 N TIUI,TIUP,TIUPROB,TIUC,TIUX,DR,DIC,DIQ S TIUI=0
"RTN","TIULQ",38,0)
 F  S TIUI=$O(^TIU(8925.9,"B",+TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIULQ",39,0)
 . S DA=TIUI,DR=".02;.05",DIC="^TIU(8925.9,",DIQ="TIUPROB"
"RTN","TIULQ",40,0)
 . D EN^DIQ1 Q:$D(TIUPROB)'>9
"RTN","TIULQ",41,0)
 . S TIUC=+$G(TIUC)+1
"RTN","TIULQ",42,0)
 . S TIUP=$$MIXED^TIULS($G(TIUPROB(8925.9,TIUI,.05)))
"RTN","TIULQ",43,0)
 . S TIUX=$$SETSTR^VALM1($J(TIUC,2)_".",$G(TIUX),1,3)
"RTN","TIULQ",44,0)
 . S TIUX=$$SETSTR^VALM1(TIUP,$G(TIUX),5,35)
"RTN","TIULQ",45,0)
 . S TIUP=$G(TIUPROB(8925.9,TIUI,.02))
"RTN","TIULQ",46,0)
 . S TIUX=$$SETSTR^VALM1(TIUP,$G(TIUX),40,6)
"RTN","TIULQ",47,0)
 . S @TIUROOT@(TIUDA,"PROBLEM",(TIUJ+TIUC),0)=TIUX
"RTN","TIULQ",48,0)
 Q
"RTN","TIULQ",49,0)
TEXT(TIUDA,TIUJ,TIUDAD,TIUOVR,ORIGCHLD) ; Get each component
"RTN","TIULQ",50,0)
 N TIUKID,TIUDADT,TIUI,TIUD0,TIULVL,CANPRINT S TIUI=0
"RTN","TIULQ",51,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIULVL=$P($G(^TIU(8925.1,+TIUD0,0)),U,4)
"RTN","TIULQ",52,0)
 S CANPRINT=$S(TIULVL="DOC":$$CANDO^TIULP(TIUDA,"PRINT RECORD"),1:1)
"RTN","TIULQ",53,0)
 I +TIUOVR'>0,(+CANPRINT'>0) D  Q
"RTN","TIULQ",54,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIULQ",55,0)
 . S @TIUROOT@(TIUDAD,"TEXT",TIUJ,0)=$P(CANPRINT,U,2)
"RTN","TIULQ",56,0)
 . S @TIUROOT@(TIUDAD,"TEXT",0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIULQ",57,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIULQ",58,0)
 . S TIUJ=+$G(TIUJ)+1
"RTN","TIULQ",59,0)
 . S @TIUROOT@(TIUDAD,"TEXT",TIUJ,0)=$G(^TIU(8925,+TIUDA,"TEXT",TIUI,0))
"RTN","TIULQ",60,0)
 S @TIUROOT@(TIUDAD,"TEXT",0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIULQ",61,0)
 ; Iterate through children, and get their text fields
"RTN","TIULQ",62,0)
 S TIUKID=0
"RTN","TIULQ",63,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIULQ",64,0)
 . I +$$ISADDNDM^TIULC1(TIUKID) D
"RTN","TIULQ",65,0)
 . . N TIUADRT
"RTN","TIULQ",66,0)
 . . I TIUROOT[")" S TIUADRT=$P(TIUROOT,")")_","_TIUDAD_",""ZADD"")"
"RTN","TIULQ",67,0)
 . . E  S TIUADRT=TIUROOT_"("_TIUDAD_",""ZADD"")"
"RTN","TIULQ",68,0)
 . . D EXTRACT(TIUKID,TIUADRT,.TIUERR,DR,.TIUJ,1) I 1
"RTN","TIULQ",69,0)
 . E  D TEXT(TIUKID,.TIUJ,TIUDAD,+$G(TIUOVR))
"RTN","TIULQ",70,0)
 ; Get ID kids in correct sort order; extract data for each kid:
"RTN","TIULQ",71,0)
 Q:'$O(^TIU(8925,"GDAD",TIUDA,0))
"RTN","TIULQ",72,0)
 N TIUGDATA,TIUSORT,TIUK,TIUIDKID,TIUIDRT,CTR
"RTN","TIULQ",73,0)
 S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIULQ",74,0)
 S TIUSORT=$P(TIUGDATA,U,4)
"RTN","TIULQ",75,0)
 D GETIDKID^TIURECL2(TIUDA,TIUSORT)
"RTN","TIULQ",76,0)
 S TIUK=0,CTR=0
"RTN","TIULQ",77,0)
 F  S TIUK=$O(^TMP("TIUIDKID",$J,TIUDA,TIUK)) Q:'TIUK  D
"RTN","TIULQ",78,0)
 . S TIUIDKID=^TMP("TIUIDKID",$J,TIUDA,TIUK)
"RTN","TIULQ",79,0)
 . N TIUIDRT
"RTN","TIULQ",80,0)
 . I TIUROOT[")" S TIUIDRT=$P(TIUROOT,")")_","_TIUDAD_",""ZZID"","_TIUK_")"
"RTN","TIULQ",81,0)
 . E  S TIUIDRT=TIUROOT_"("_TIUDAD_",""ZZID"","_TIUK_")"
"RTN","TIULQ",82,0)
 . D EXTRACT(TIUIDKID,TIUIDRT,.TIUERR,DR,.TIUJ,1)
"RTN","TIULQ",83,0)
 . S CTR=CTR+1
"RTN","TIULQ",84,0)
 I CTR S @TIUROOT@(TIUDAD,"ZZID",0)=CTR ; How many ID kids TIUDAD has
"RTN","TIULQ",85,0)
 ;I CTR,$G(ORIGCHLD) S @TIUROOT@(TIUDAD,"REASON")="Note included because interdisciplinary child meets criteria."
"RTN","TIULQ",86,0)
 K ^TMP("TIUIDKID",$J)
"RTN","TIULQ",87,0)
 Q
"RTN","TIUPRPN8")
0^7^B28018900
"RTN","TIUPRPN8",1,0)
TIUPRPN8 ;SLC/MAM - Print SF 509-Progress Notes, Cont ;1/24/01 [10/19/04 1:24pm]
"RTN","TIUPRPN8",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,176,157**;Jun 20, 1997
"RTN","TIUPRPN8",3,0)
 ; 10/00 New rtn, created by moving SIGBLK here from TIUPRPN1
"RTN","TIUPRPN8",4,0)
 ;
"RTN","TIUPRPN8",5,0)
SIGBLK(TIUFOOT,TIUMISC,TIUCONT1,TIUCONT,TIUSIG,TIUROOT) ; Print signature block info
"RTN","TIUPRPN8",6,0)
 ; Requires array TIUFOOT, requires TIUMISC
"RTN","TIUPRPN8",7,0)
 ; Requires TIUCONT1
"RTN","TIUPRPN8",8,0)
 ; Receives TIUCONT by ref (req'd)
"RTN","TIUPRPN8",9,0)
 ; Receives array TIUSIG by ref, required.
"RTN","TIUPRPN8",10,0)
 ; Requires TIUROOT
"RTN","TIUPRPN8",11,0)
 N TIUDA,TIUFLAG
"RTN","TIUPRPN8",12,0)
 S TIUCONT=1,TIUDA=$P(TIUMISC,U,3),TIUFLAG=$P(TIUMISC,U)
"RTN","TIUPRPN8",13,0)
 ;S TIUGROOT=$NA(^TMP("TIULQ",$J,TIUDA))
"RTN","TIUPRPN8",14,0)
 I '+TIUSIG("SIGNDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",15,0)
 . W "**DRAFT COPY - DRAFT COPY -- ABOVE NOTE IS UNSIGNED--"
"RTN","TIUPRPN8",16,0)
 . W " DRAFT COPY - DRAFT COPY**",!
"RTN","TIUPRPN8",17,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN8",18,0)
 ;I TIUSIG("SIGNEDBY")]"",(+TIUSIG("SIGNEDBY")'=+TIUSIG("AUTHOR"))  D
"RTN","TIUPRPN8",19,0)
 ;. W ?21,"Author:      ",$P(TIUSIG("AUTHOR"),";",2),!
"RTN","TIUPRPN8",20,0)
 I +TIUSIG("SIGNDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",21,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",22,0)
 . W ?18,"Signed by:",$S($P(TIUSIG("SIGNMODE"),";")="C":" /s/  ",1:" /es/ "),?34,$S(TIUSIG("SIGNNAME")]"":TIUSIG("SIGNNAME"),1:$P(TIUSIG("SIGNEDBY"),";",2))
"RTN","TIUPRPN8",23,0)
 . I $L(TIUSIG("SIGTITL"))>45 D
"RTN","TIUPRPN8",24,0)
 . . N TIUFT
"RTN","TIUPRPN8",25,0)
 . . D WRAP^TIUFLD(TIUSIG("SIGTITL"),45)
"RTN","TIUPRPN8",26,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",27,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",28,0)
 . I $L(TIUSIG("SIGTITL"))<46,TIUSIG("SIGTITL")]"" W !?34,TIUSIG("SIGTITL")
"RTN","TIUPRPN8",29,0)
 . W !?34,$$DATE^TIULS(+TIUSIG("SIGNDATE"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",30,0)
 . I '+$G(TIUFLAG)!($E(IOST)="C") D
"RTN","TIUPRPN8",31,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U) W !?34,"Analog Pager: ",$P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U)
"RTN","TIUPRPN8",32,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U,2) W !?34,"Digital Pager: ",$P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U,2)
"RTN","TIUPRPN8",33,0)
 I $P(TIUSIG("SIGNMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",34,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",35,0)
 . N TIUONCH
"RTN","TIUPRPN8",36,0)
 . S TIUONCH=$P(TIUSIG("SIGCHRT"),";",2)
"RTN","TIUPRPN8",37,0)
 . I TIUONCH']"" S TIUONCH=$P(TIUSIG("COSCHRT"),";",2)
"RTN","TIUPRPN8",38,0)
 . W !?2,"Marked signed on chart by:",?34,$G(TIUONCH)
"RTN","TIUPRPN8",39,0)
 I TIUSIG("SIGNEDBY")]"",(+TIUSIG("SIGNEDBY")'=+TIUSIG("AUTHOR"))  D
"RTN","TIUPRPN8",40,0)
 . N TIUSIGTL
"RTN","TIUPRPN8",41,0)
 . W !?34,"for ",$P(TIUSIG("AUTHOR"),";",2)
"RTN","TIUPRPN8",42,0)
 . S TIUSIGTL=$$GET1^DIQ(200,$P(TIUSIG("AUTHOR"),";",1),20.3)
"RTN","TIUPRPN8",43,0)
 . I $D(TIUSIGTL) D
"RTN","TIUPRPN8",44,0)
 . . N TIUFT
"RTN","TIUPRPN8",45,0)
 . . D WRAP^TIUFLD(TIUSIGTL,45)
"RTN","TIUPRPN8",46,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",47,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",48,0)
 I $G(@TIUROOT@(.05,"E"))="UNCOSIGNED" D
"RTN","TIUPRPN8",49,0)
 . W !?34,"**REQUIRES COSIGNATURE**",!
"RTN","TIUPRPN8",50,0)
 ;I +$G(TIUADD) S TIUGROOT=$NA(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD))
"RTN","TIUPRPN8",51,0)
 I +$D(@TIUROOT@("EXTRASGNR")) D  Q:'TIUCONT  ;**100** added the quit
"RTN","TIUPRPN8",52,0)
 . N TIUI S TIUI=0
"RTN","TIUPRPN8",53,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",54,0)
 . W !?4,"Receipt Acknowledged By:"
"RTN","TIUPRPN8",55,0)
 . F  S TIUI=$O(@TIUROOT@("EXTRASGNR",TIUI)) Q:'TIUI  D
"RTN","TIUPRPN8",56,0)
 . . I +$G(@TIUROOT@("EXTRASGNR",TIUI,"DATE"))'>0 Q
"RTN","TIUPRPN8",57,0)
 . . I TIUI>1 S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",58,0)
 . . W !?29,"/es/ ",$G(@TIUROOT@("EXTRASGNR",TIUI,"NAME"))
"RTN","TIUPRPN8",59,0)
 . . I $L($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")))>45 D
"RTN","TIUPRPN8",60,0)
 . . . N TIUFT
"RTN","TIUPRPN8",61,0)
 . . . D WRAP^TIUFLD($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")),45)
"RTN","TIUPRPN8",62,0)
 . . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",63,0)
 . . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",64,0)
 . . I $L($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")))<46 W !?34,$G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE"))
"RTN","TIUPRPN8",65,0)
 . . I $G(@TIUROOT@("EXTRASGNR",TIUI,"EXTRA")),$G(@TIUROOT@("EXTRASGNR",TIUI,"EXPIEN"))'=$G(@TIUROOT@("EXTRASGNR",TIUI,"EXTRA")) D
"RTN","TIUPRPN8",66,0)
 . . . W !?30,"for ",$P($G(@TIUROOT@("EXTRASGNR",TIUI,"EXPNAME")),",",2)
"RTN","TIUPRPN8",67,0)
 . . . W " ",$P($G(@TIUROOT@("EXTRASGNR",TIUI,"EXPNAME")),",")
"RTN","TIUPRPN8",68,0)
 . . W !?34,$$DATE^TIULS($G(@TIUROOT@("EXTRASGNR",TIUI,"DATE")),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",69,0)
 . . I '+$G(TIUFLAG)!($E(IOST)="C") D
"RTN","TIUPRPN8",70,0)
 . . . N BEEP
"RTN","TIUPRPN8",71,0)
 . . . S BEEP=$$BEEP^TIULC1(+$G(@TIUROOT@("EXTRASGNR",TIUI,"EXTRA")))
"RTN","TIUPRPN8",72,0)
 . . . I +BEEP W !?34,"Analog Pager:  ",$P(BEEP,U)
"RTN","TIUPRPN8",73,0)
 . . . I +$P(BEEP,U,2) W !?34,"Digital Pager: ",$P(BEEP,U,2)
"RTN","TIUPRPN8",74,0)
 . ;K @TIUROOT@("EXTRASGNR") ;**100** commented out
"RTN","TIUPRPN8",75,0)
 ;I +TIUSIG("COSGDATE"),(+TIUSIG("COSGEDBY")'=+TIUSIG("SIGNEDBY")) D  Q:'TIUCONT
"RTN","TIUPRPN8",76,0)
 I +TIUSIG("COSGDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",77,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",78,0)
 . W !!?16,"Cosigned by:",$S($P(TIUSIG("COSGMODE"),";")="C":" /s/  ",1:" /es/ "),?34,$S(TIUSIG("COSGNAME")]"":TIUSIG("COSGNAME"),1:$P(TIUSIG("COSGEDBY"),";",2))
"RTN","TIUPRPN8",79,0)
 . I $L(TIUSIG("COSGTITL"))>45 D
"RTN","TIUPRPN8",80,0)
 . . N TIUFT
"RTN","TIUPRPN8",81,0)
 . . D WRAP^TIUFLD(TIUSIG("COSGTITL"),45)
"RTN","TIUPRPN8",82,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",83,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",84,0)
 . I $L(TIUSIG("COSGTITL"))<46 W !?34,TIUSIG("COSGTITL")
"RTN","TIUPRPN8",85,0)
 . W !?34,$$DATE^TIULS(+TIUSIG("COSGDATE"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",86,0)
 . I '+$G(TIUFLAG)!($E(IOST)="C") D
"RTN","TIUPRPN8",87,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U) W !?34,"Analog Pager: ",$P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U)
"RTN","TIUPRPN8",88,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U,2) W !?34,"Digital Pager: ",$P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U,2)
"RTN","TIUPRPN8",89,0)
 ;I +TIUSIG("COSCHRT"),$P(TIUSIG("COSGMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",90,0)
 I $P(TIUSIG("COSGMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",91,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",92,0)
 . W !,"Marked cosigned on chart by:",?34,$P(TIUSIG("COSCHRT"),";",2)
"RTN","TIUPRPN8",93,0)
 W !
"RTN","TIUPRPN8",94,0)
 ;K TIUCONT1 ; kills the cont on next page msgs since no longer in middle
"RTN","TIUPRPN8",95,0)
 ;of a note.  **100** moved down to amend code
"RTN","TIUPRPN8",96,0)
AMEND ; signature blocks of amender
"RTN","TIUPRPN8",97,0)
 ;N TIUY S TIUY=4 ;I don't think we need TIUY anymore **100**
"RTN","TIUPRPN8",98,0)
 I '$G(@TIUROOT@(1601,"I")) K TIUCONT1 Q
"RTN","TIUPRPN8",99,0)
 S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN8",100,0)
 K TIUCONT1 Q:'TIUCONT
"RTN","TIUPRPN8",101,0)
 I +$G(@TIUROOT@(1601,"I")) D
"RTN","TIUPRPN8",102,0)
 . W !!?12,"Amendment Filed:",?34,$$DATE^TIULS(@TIUROOT@(1601,"I"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",103,0)
 . I $G(@TIUROOT@(1603,"E"))']"" D
"RTN","TIUPRPN8",104,0)
 . . W !!?29 F TIUI=1:1:40 W "_"
"RTN","TIUPRPN8",105,0)
 . . W !?29,$$SIGNAME^TIULS(@TIUROOT@(1602,"I"))
"RTN","TIUPRPN8",106,0)
 . . W !?29,$$SIGTITL^TIULS(@TIUROOT@(1602,"I"))
"RTN","TIUPRPN8",107,0)
 . I $G(@TIUROOT@(1604,"E"))]"" D
"RTN","TIUPRPN8",108,0)
 . . W !?29,"/es/",?34,@TIUROOT@(1604,"E")
"RTN","TIUPRPN8",109,0)
 . . W !?34,@TIUROOT@(1605,"E")
"RTN","TIUPRPN8",110,0)
 Q
"RTN","TIUPRPN8",111,0)
 ;
"RTN","TIUR3")
0^15^B28062156
"RTN","TIUR3",1,0)
TIUR3 ; SLC/JER - Integrated Document Review ;11/01/03 [1/12/05 11:42am]
"RTN","TIUR3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**157**;Jun 20, 1997
"RTN","TIUR3",3,0)
 ;This routine was made from a copy of TIUR and modified to be used
"RTN","TIUR3",4,0)
 ; for option TIU REVIEW UNSIGNED ADDSIG
"RTN","TIUR3",5,0)
MAKELIST(TIUCLASS,TIUCHVW) ; Get Search Criteria
"RTN","TIUR3",6,0)
 N DIRUT,DTOUT,DUOUT,TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIUR3",7,0)
 N TIUDPRMT,TIUPICT,TIUOUT,STATWORD,STATIFN,NOWFLAG
"RTN","TIUR3",8,0)
 K DIROUT
"RTN","TIUR3",9,0)
 D INITRR^TIULRR(0)
"RTN","TIUR3",10,0)
 ;  TIURPN used in Order Entry 2.5, OR OE/RR MENU CLIN:
"RTN","TIUR3",11,0)
 I +$G(ORVP),(+$G(TIUCHVW)'>0) D EN^TIURPN(TIUCLASS,+ORVP) Q
"RTN","TIUR3",12,0)
STATUS S STATUS=$$STAT
"RTN","TIUR3",13,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIUR3",14,0)
 S TIUI=0
"RTN","TIUR3",15,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI!(+$G(TIUOUT))  D
"RTN","TIUR3",16,0)
 . I $P($G(TIUSTAT(TIUI)),U,3)="" S TIUOUT=1 Q
"RTN","TIUR3",17,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIUR3",18,0)
 . Q:'STATIFN
"RTN","TIUR3",19,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIUR3",20,0)
 I +$G(TIUOUT) S VALMQUIT=1 Q
"RTN","TIUR3",21,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIUR3",22,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR3",23,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIUR3",24,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIUR3",25,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIUR3",26,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIUR3",27,0)
 N TIUDCL K TIUPICT
"RTN","TIUR3",28,0)
 I $S(('$D(TIUQUIK)&'$D(ORVP)):1,($D(ORVP)&+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL,.TIUPICT)
"RTN","TIUR3",29,0)
 ; SELTYP sets array ^TMP("TIUTYP",$J);
"RTN","TIUR3",30,0)
 ; SELTYP used to set data into TIUTYP array
"RTN","TIUR3",31,0)
 ; Now TIUTYP just ="^TMP("TIUTYP",$J)"
"RTN","TIUR3",32,0)
 I $S($D(TIUQUIK):1,($D(ORVP)&'+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"F","ALL","DOC",0)
"RTN","TIUR3",33,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR3",34,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIUR3",35,0)
SCREEN ;
"RTN","TIUR3",36,0)
 N TIUNAME
"RTN","TIUR3",37,0)
 S TIUNAME=$$GET1^DIQ(200,+DUZ,.01)
"RTN","TIUR3",38,0)
 I $D(TIUQUIK) D  I 1 ; all my unsigned TIUQUIK=1
"RTN","TIUR3",39,0)
 . I $G(TIUQUIK)=3 S SCREEN(1)="ALL^ANY" Q
"RTN","TIUR3",40,0)
 . S SCREEN(1)="AAU^"_DUZ_U_TIUNAME
"RTN","TIUR3",41,0)
 . S:$G(TIUQUIK)=1 SCREEN(2)="ASUP^"_DUZ
"RTN","TIUR3",42,0)
 . S SCREEN="ALL"
"RTN","TIUR3",43,0)
 E  D SELCAT^TIULA1(.SCREEN,"A","AUTHOR")
"RTN","TIUR3",44,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR3",45,0)
 I $D(SCREEN)'>9 K @TIUTYP G DOCTYPE
"RTN","TIUR3",46,0)
 I $D(@TIUTYP)'>9 W !,$C(7),"You must select one or more TITLES..." G SCREEN
"RTN","TIUR3",47,0)
 D CHECKADD
"RTN","TIUR3",48,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIUR3",49,0)
 S TIUDPRMT=$S(TIUCLASS=244:"Discharge",1:"Reference")
"RTN","TIUR3",50,0)
 S TIUEDT=1
"RTN","TIUR3",51,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR3",52,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIUR3",53,0)
 S TIULDT=$S($D(TIUQUIK):9999999,$D(ORVP)&(+$G(TIUCHVW)'>0):+$$NOW^XLFDT,1:$P($$LDATE^TIULA(TIUDPRMT),U))
"RTN","TIUR3",54,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR3",55,0)
 I TIULDT'>0 G ERLY
"RTN","TIUR3",56,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIUR3",57,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT)
"RTN","TIUR3",58,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIUR3",59,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIUR3",60,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIUR3",61,0)
 D BUILD(TIUCLASS,.STATUS,.SCREEN,TIUEDT,TIULDT,NOWFLAG) ;11/30/00 removed param TIUTYP since BUILD uses global now.
"RTN","TIUR3",62,0)
 ; -- If attaching ID note & changed view,
"RTN","TIUR3",63,0)
 ;    update video for line to be attached: --
"RTN","TIUR3",64,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIUR3",65,0)
 ;K @TIUTYP ;11/30/00 keep ^TMP("TIUTYP",$J) for rebuild
"RTN","TIUR3",66,0)
 Q
"RTN","TIUR3",67,0)
STAT() ; Determine status
"RTN","TIUR3",68,0)
 N TIUY
"RTN","TIUR3",69,0)
 I +$G(TIUQUIK) D  G STATX
"RTN","TIUR3",70,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F",$S(TIUQUIK=1:"UNSIGNED,UNCOSIGNED",TIUQUIK>1:"UNDICTATED,UNTRANSCRIBED"))
"RTN","TIUR3",71,0)
 I $D(ORVP),'+$G(TIUCHVW) D  G STATX
"RTN","TIUR3",72,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F","COMPLETED")
"RTN","TIUR3",73,0)
 S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT^TIURM(DUZ))
"RTN","TIUR3",74,0)
STATX Q TIUY
"RTN","TIUR3",75,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIUR3",76,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIUR3",77,0)
 S (TIUI,HIT)=0
"RTN","TIUR3",78,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIUR3",79,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIUR3",80,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIUR3",81,0)
 Q
"RTN","TIUR3",82,0)
 ;
"RTN","TIUR3",83,0)
SWAP(TIUX,TIUY) ; Swap variables
"RTN","TIUR3",84,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIUR3",85,0)
 Q
"RTN","TIUR3",86,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIUR3",87,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIUR3",88,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIUR3",89,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIUR3",90,0)
 Q
"RTN","TIUR3",91,0)
BUILD(TIUCLASS,STATUS,SCREEN,EARLY,LATE,NOWFLAG) ; Build List.
"RTN","TIUR3",92,0)
 ;11/30/00 - removed param TYPES. 12/3 added param TIUCLASS
"RTN","TIUR3",93,0)
 ; BUILD (GATHER) uses docmt type info from ^TMP("TIUTYP",$J)
"RTN","TIUR3",94,0)
 N TIUDT,TIUI,TIUK
"RTN","TIUR3",95,0)
 N TIUT,TIUTP,XREF,TIUS,TIUPREF
"RTN","TIUR3",96,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIUR3",97,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIUR3",98,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIUR3",99,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIUR3",100,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIUR3",101,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIUR3",102,0)
 S ^TMP("TIUR",$J,"RTN")="TIUR3"
"RTN","TIUR3",103,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUR3",104,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUR3",105,0)
 D GATHER^TIUR4(TIUCLASS,TIUPREF)
"RTN","TIUR3",106,0)
 D PUTLIST^TIUR2(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIUR3",107,0)
 K ^TMP("TIUI",$J)
"RTN","TIUR3",108,0)
 Q
"RTN","TIUR3",109,0)
 ;
"RTN","TIUR3",110,0)
CLEAN ; Clean up your mess!
"RTN","TIUR3",111,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIUR3",112,0)
 K VALMY
"RTN","TIUR3",113,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIUR3",114,0)
 Q
"RTN","TIUR3",115,0)
 ;
"RTN","TIUR3",116,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIUR3",117,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIUR3",118,0)
 N TIURBLD,TIUI,TIUCLASS,NOWFLAG
"RTN","TIUR3",119,0)
 S TIURBLD=1
"RTN","TIUR3",120,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIUR3",121,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIUR3",122,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIUR3",123,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIUR3",124,0)
 S TIUSCRN="ALL",TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIUR3",125,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIUR3",126,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIUR3",127,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIUR3",128,0)
 K VALMHDR
"RTN","TIUR3",129,0)
 D BUILD(TIUCLASS,.STATUS,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIUR3",130,0)
 ; Reexpand previously expanded items:
"RTN","TIUR3",131,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIUR3",132,0)
 D BREATHE^TIUROR1(1)
"RTN","TIUR3",133,0)
 Q
"RTN","TIUR4")
0^16^B6424298
"RTN","TIUR4",1,0)
TIUR4 ; SLC/JER - Integrated Document Review ;11/01/03 [1/12/05 11:48am]
"RTN","TIUR4",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**157**;Jun 20, 1997
"RTN","TIUR4",3,0)
 ;This routine was created from a copy of TIUR1 and modified for use
"RTN","TIUR4",4,0)
 ; in option TIU REVIEW UNSIGNED ADDSIG
"RTN","TIUR4",5,0)
GATHER(CLASS,TIUPREF) ; Find/sort
"RTN","TIUR4",6,0)
 N TIUSFLD
"RTN","TIUR4",7,0)
 S TIUSFLD=$P(TIUPREF,U,3)
"RTN","TIUR4",8,0)
 I +$G(TIUQUIK)=1 D ADDSIGN(DUZ,CLASS,TIUSFLD)
"RTN","TIUR4",9,0)
 Q
"RTN","TIUR4",10,0)
DADINTYP(TIUDA) ; addendum's parent belong? 12/1/00 Removed param TYPES
"RTN","TIUR4",11,0)
 N TIUI,TIUDTYP,TIUY S (TIUI,TIUY)=0
"RTN","TIUR4",12,0)
 S TIUDTYP=+$G(^TIU(8925,+$P($G(^TIU(8925,+TIUDA,0)),U,6),0))
"RTN","TIUR4",13,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+TIUY  D
"RTN","TIUR4",14,0)
 . I +$P(^TMP("TIUTYP",$J,TIUI),U,2)=TIUDTYP S TIUY=1
"RTN","TIUR4",15,0)
 Q TIUY
"RTN","TIUR4",16,0)
RESOLVE(DA,DR) ; resolve sort field values
"RTN","TIUR4",17,0)
 N TIUD0,TIUD12,TIUD13,TIUD15,TIUY
"RTN","TIUR4",18,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUD12=$G(^TIU(8925,+DA,12))
"RTN","TIUR4",19,0)
 S TIUD13=$G(^TIU(8925,+DA,13)),TIUD15=$G(^TIU(8925,+DA,15))
"RTN","TIUR4",20,0)
 I DR=.01 S TIUY=$$PNAME^TIULC1(+TIUD0) G RESX
"RTN","TIUR4",21,0)
 I DR=.02 S TIUY=$$PTNAME^TIULC1(+$P(TIUD0,U,2)) G RESX
"RTN","TIUR4",22,0)
 I DR=.05 S TIUY=$P(TIUD0,U,5) G RESX
"RTN","TIUR4",23,0)
 I DR=1202 S TIUY=$$PERSNAME^TIULC1(+$P(TIUD12,U,2)) S:TIUY="UNKNOWN" TIUY="" G RESX
"RTN","TIUR4",24,0)
 I DR=1208 S TIUY=$$PERSNAME^TIULC1(+$P(TIUD12,U,8)) S:TIUY="UNKNOWN" TIUY="" G RESX
"RTN","TIUR4",25,0)
 I DR=1301 S TIUY=$P(TIUD13,U) G RESX
"RTN","TIUR4",26,0)
 ;I DR=1507,($P(TIUD0,U,5)=7),(+$P(TIUD15,U,7)'>0) S DR=1501
"RTN","TIUR4",27,0)
 I DR=1507,(($P(TIUD0,U,5)=7)!($P(TIUD0,U,5)=8)),(+$P(TIUD15,U,7)'>0) S DR=1501 ;TIU*1*100 amended notes were sorting at top w sortval=ZZZZEMPTY for sortfld=complete, even tho they had sign date and displayed it.
"RTN","TIUR4",28,0)
 I DR=1501 S TIUY=$P(TIUD15,U) G RESX
"RTN","TIUR4",29,0)
 I DR=1507 S TIUY=$P(TIUD15,U,7)
"RTN","TIUR4",30,0)
RESX I $G(TIUY)']"" S TIUY="ZZZZEMPTY"
"RTN","TIUR4",31,0)
 Q TIUY
"RTN","TIUR4",32,0)
 ;
"RTN","TIUR4",33,0)
ADDSIGN(USER,CLASS,SORTBY) ; Get documents for which the user is the additional signer
"RTN","TIUR4",34,0)
 N TIUI,TIUY S TIUI=0
"RTN","TIUR4",35,0)
 D NEEDSIG^TIULX(.TIUY,USER,CLASS)
"RTN","TIUR4",36,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR4",37,0)
 . N TIUDA,TIUD13,TIUQ,TIUJ
"RTN","TIUR4",38,0)
 . S TIUDA=+$G(@TIUY@(TIUI)),TIUD13=$G(^TIU(8925,TIUDA,13))
"RTN","TIUR4",39,0)
 . S TIUQ=$$RESOLVE(TIUDA,SORTBY),TIUJ=9999999-+TIUD13
"RTN","TIUR4",40,0)
 . ; S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)="" ; P113
"RTN","TIUR4",41,0)
 . S ^TMP("TIUI",$J,TIUQ,TIUJ,TIUDA)=1
"RTN","TIUR4",42,0)
 K @TIUY
"RTN","TIUR4",43,0)
 Q
"RTN","TIURH2")
0^17^B381222
"RTN","TIURH2",1,0)
TIURH2 ; SLC/JER - Review Screen Header ;5/7/03 [1/12/05 11:42am]
"RTN","TIURH2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**157**;Jun 20, 1997
"RTN","TIURH2",3,0)
 ; header used for the option TIU REVIEW UNSIGNED ADSIG
"RTN","TIURH2",4,0)
HDR ; Initialize header for clinician's review screen
"RTN","TIURH2",5,0)
 S VALM("TITLE")="My Identified Signer Docs"
"RTN","TIURH2",6,0)
 S VALMHDR(1)="             ALL DOCUMENTS Requiring My Additional Signature"
"RTN","TIURH2",7,0)
 Q
"RTN","TIURS")
0^5^B59135200
"RTN","TIURS",1,0)
TIURS ; SLC/JER - Electronic signature actions ;19-JAN-2001 11:14:07 [4/27/04 2:35pm] [12/20/04 8:55am]
"RTN","TIURS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,4,20,67,79,98,107,58,100,109,179,157**;Jun 20, 1997
"RTN","TIURS",3,0)
ACCEPT(TIUSLST,TIUI) ; Accept for signing
"RTN","TIURS",4,0)
 N TIUSGN,TIUMSG,TIUPR,TIUFLAG
"RTN","TIURS",5,0)
 I +$G(TIUDA),($G(TIUEVNT)]"") D  Q:'+$G(TIUSGN)
"RTN","TIURS",6,0)
 . S TIUSGN=$$CANDO^TIULP(TIUDA,TIUEVNT)
"RTN","TIURS",7,0)
 . I '+TIUSGN D
"RTN","TIURS",8,0)
 . . D FULL^VALM1
"RTN","TIURS",9,0)
 . . W !!,"Document has changed...",!,$P(TIUSGN,U,2)
"RTN","TIURS",10,0)
 . . W !!,"Item #",TIUI,": Removed from signature list.",!
"RTN","TIURS",11,0)
 . . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIURS",12,0)
 S TIUSLST(TIUI)=""
"RTN","TIURS",13,0)
 W !,"Item #",TIUI,": Added to signature list." ;H 2
"RTN","TIURS",14,0)
 I +$P($G(TIUDPRM(0)),U,8) D
"RTN","TIURS",15,0)
 . S TIUMSG="Print this note"
"RTN","TIURS",16,0)
 . S TIUPR=$$READ^TIUU("Y",TIUMSG,"No")
"RTN","TIURS",17,0)
 . I +TIUPR S TIUSLST(TIUI)=1
"RTN","TIURS",18,0)
 I +$G(TIUPR),+$P($G(TIUDPRM(0)),U,9) D
"RTN","TIURS",19,0)
 . S TIUFLAG=$$FLAG^TIUPRPN3
"RTN","TIURS",20,0)
 . I +TIUFLAG S $P(TIUSLST(TIUI),U,2)=1
"RTN","TIURS",21,0)
 I +$G(XTRASGNR) S $P(TIUSLST(TIUI),U,3)=$G(XTRASGNR)
"RTN","TIURS",22,0)
 Q
"RTN","TIURS",23,0)
EDSIG(TIUDA,TIUADD,TIUPASK) ; interactive sign
"RTN","TIURS",24,0)
 N TIU,TIU0,TIU12,ASK,X,X1,TIUTYPE,SIGNER,COSIGNER,TIUTYPE,TIUMSG,TIUSTAT
"RTN","TIURS",25,0)
 N TIUES,TIUACT,TIUDPRM,XTRASGNR,TIUCOM,TIU15,TIUCPFLD
"RTN","TIURS",26,0)
 I +$D(TIUSIGN),(TIUSIGN=0) Q
"RTN","TIURS",27,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURS",28,0)
 I '+$P(TIUPRM0,U,2) S VALMBCK="R" Q
"RTN","TIURS",29,0)
 S TIUADD=1
"RTN","TIURS",30,0)
 S TIU0=$G(^TIU(8925,+TIUDA,0)),TIU12=$G(^(12)),TIU15=$G(^(15))
"RTN","TIURS",31,0)
 S SIGNER=$S(+$P(TIU12,U,4):$P(TIU12,U,4),1:$P(TIU12,U,2))
"RTN","TIURS",32,0)
 S COSIGNER=$P(TIU12,U,8)
"RTN","TIURS",33,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIURS",34,0)
 I '$G(XTRASGNR) S XTRASGNR=$$ASURG^TIUADSIG(TIUDA)
"RTN","TIURS",35,0)
 S TIUSTAT=+$P(TIU0,U,5)
"RTN","TIURS",36,0)
 S TIUACT=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIURS",37,0)
 S ASK=$$CANDO^TIULP(TIUDA,TIUACT)
"RTN","TIURS",38,0)
 S TIUTYPE=$$PNAME^TIULC1(+TIU0)
"RTN","TIURS",39,0)
 I +ASK'>0 D  Q
"RTN","TIURS",40,0)
 . S VALMBCK="R"
"RTN","TIURS",41,0)
 . I +$$ISA^USRLM(+$G(DUZ),"MEDICAL INFORMATION SECTION"),(+$$ISPN^TIULX(+TIU0)'>0) Q
"RTN","TIURS",42,0)
 . I +$$ISA^USRLM(+$G(DUZ),"MAS TRANSCRIPTIONIST") Q
"RTN","TIURS",43,0)
 . I +$$ISA^USRLM(+$G(DUZ),"TRANSCRIPTIONIST") Q
"RTN","TIURS",44,0)
 . W !,$P(ASK,U,2)
"RTN","TIURS",45,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURS",46,0)
 W:$G(VALMAR)'="^TMP(""TIUVIEW"",$J)" !
"RTN","TIURS",47,0)
 ;If document is a clinical procedures (CP) title, and
"RTN","TIURS",48,0)
 ;(P179 for P182) this is not an additional signature,
"RTN","TIURS",49,0)
 ;check if CP fields are required. If required, prompt for them
"RTN","TIURS",50,0)
 ;and don't let user sign unless fields are defined. (P109)
"RTN","TIURS",51,0)
 I '$G(XTRASGNR),+$$ISA^TIULX(+TIU0,+$$CLASS^TIUCP),$$REQCPF^TIULP(+$P($G(^TIU(8925,+TIUDA,14)),U,5)) D  Q:+TIUCPFLD'>0
"RTN","TIURS",52,0)
 . I $G(^TIU(8925,+TIUDA,702)),$P(^(702),U)]"",$P(^(702),U,2)]"" S TIUCPFLD=1 Q
"RTN","TIURS",53,0)
 . S TIUCPFLD=$$ASKCPF(TIUDA)
"RTN","TIURS",54,0)
 . I +TIUCPFLD'>0 D
"RTN","TIURS",55,0)
 . . W !!,"The Procedure Summary Code and Date/Time Performed MUST be entered before",!,"you may sign.",!
"RTN","TIURS",56,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ;pause
"RTN","TIURS",57,0)
 I $S(+$$REQCOSIG^TIULP(+TIU0,+TIUDA,+SIGNER):1,+$P(TIU15,U,6):1,1:0),(+COSIGNER'>0) D  Q:+COSIGNER'>0
"RTN","TIURS",58,0)
 . S COSIGNER=$$ASKCSNR(TIUDA,SIGNER)
"RTN","TIURS",59,0)
 . I +COSIGNER'>0 D
"RTN","TIURS",60,0)
 . . W !!,"This ",TIUTYPE," MUST have a cosigner before you may sign.",!
"RTN","TIURS",61,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIURS",62,0)
 I TIUSTAT=5,$G(DUZ)'=SIGNER D
"RTN","TIURS",63,0)
 . S TIUMSG="Author hasn't signed, are you SURE you want to sign "_TIUTYPE
"RTN","TIURS",64,0)
 W ! I $G(TIUMSG)]"",$$READ^TIUU("YO",TIUMSG,"NO","^D SIG^TIUDIRH")'>0 S VALMBCK="R" Q
"RTN","TIURS",65,0)
 L +^TIU(8925,+TIUDA):1
"RTN","TIURS",66,0)
 E  W !?5,$C(7),"Another user is editing this entry.",! W:$$READ^TIUU("EA","Press RETURN to continue...") "" S TIUQUIT=2 Q
"RTN","TIURS",67,0)
 S TIUES=$$ASKSIG^TIULA1 L -^TIU(8925,+TIUDA) I '+TIUES Q
"RTN","TIURS",68,0)
 I $D(VALMAR) D FULL^VALM1
"RTN","TIURS",69,0)
 I +$G(XTRASGNR) D ADDSIG^TIURS1(TIUDA,XTRASGNR)
"RTN","TIURS",70,0)
 I '+$G(XTRASGNR) D ES(TIUDA,TIUES)
"RTN","TIURS",71,0)
 I $G(TIUACT)="COSIGNATURE",(+$$ISADDNDM^TIULC1(TIUDA)'>0) D  Q:+TIUCOM
"RTN","TIURS",72,0)
 . N TIUADDND S TIUCOM=0
"RTN","TIURS",73,0)
 . S TIUADDND=$$READ^TIUU("YO","Do you wish to add your comments in an addendum","NO")
"RTN","TIURS",74,0)
 . I +TIUADDND D ADD^TIUADD(TIUDA,.TIUCHNG) S TIUCOM=1
"RTN","TIURS",75,0)
 I '+$G(TIUPASK) Q
"RTN","TIURS",76,0)
 D DOCPRM^TIULC1(+TIU0,.TIUDPRM,TIUDA)
"RTN","TIURS",77,0)
 I +$P($G(TIUDPRM(0)),U,8) D PRINT^TIUEPRNT(TIUDA)
"RTN","TIURS",78,0)
 Q
"RTN","TIURS",79,0)
 ;
"RTN","TIURS",80,0)
ASKCPF(DA) ;Ask required clinical procedure fields
"RTN","TIURS",81,0)
 N DR,DIE,TIUY
"RTN","TIURS",82,0)
 D FULL^VALM1
"RTN","TIURS",83,0)
AGNCP W !!,$C(7),"You must designate the Procedure Summary Code and Date/Time Performed...",!
"RTN","TIURS",84,0)
 L +^TIU(8925,+DA):1
"RTN","TIURS",85,0)
 E  W !?5,$C(7),"Another user is editing this entry.",! W:$$READ^TIUU("EA","Press RETURN to continue...") "" G ASKCPFQ
"RTN","TIURS",86,0)
 S DR="70201R;70202R"
"RTN","TIURS",87,0)
 S DIE="^TIU(8925," D ^DIE
"RTN","TIURS",88,0)
ASKCPFQ L -^TIU(8925,+DA)
"RTN","TIURS",89,0)
 I $G(^TIU(8925,+DA,702)),$P(^(702),U)]"",$P(^(702),U,2)]"" S TIUY=1
"RTN","TIURS",90,0)
 Q +$G(TIUY)
"RTN","TIURS",91,0)
 ;
"RTN","TIURS",92,0)
ASKCSNR(DA,SIGNER) ; Ask cosigner
"RTN","TIURS",93,0)
 N DR,DIE,TIUY,TIUDCSNR,TIUPREF,TIUFLD
"RTN","TIURS",94,0)
 S TIUPREF=$$PERSPRF^TIULE(SIGNER)
"RTN","TIURS",95,0)
 S TIUDCSNR=$$PERSNAME^TIULC1($P(TIUPREF,U,9))
"RTN","TIURS",96,0)
 I TIUDCSNR="UNKNOWN" S TIUDCSNR=""
"RTN","TIURS",97,0)
 S TIUFLD=$S(+$$ISDS^TIULX(+$G(^TIU(8925,+DA,0))):"ATTENDING PHYSICIAN",1:"EXPECTED COSIGNER")
"RTN","TIURS",98,0)
 D FULL^VALM1
"RTN","TIURS",99,0)
AGN W !!,$C(7),"You must designate an ",TIUFLD,"...",!
"RTN","TIURS",100,0)
 L +^TIU(8925,+DA):1
"RTN","TIURS",101,0)
 E  W !?5,$C(7),"Another user is editing this entry.",! W:$$READ^TIUU("EA","Press RETURN to continue...") "" G ASKCOUT
"RTN","TIURS",102,0)
 I $E(TIUFLD)="A" S DR="1209R//^S X=TIUDCSNR;1208////^S X=$P(^TIU(8925,DA,12),U,9);1506////1"
"RTN","TIURS",103,0)
 E  S DR="1208R//^S X=TIUDCSNR;1506////1"
"RTN","TIURS",104,0)
 S DIE="^TIU(8925," D ^DIE
"RTN","TIURS",105,0)
ASKCOUT L -^TIU(8925,+DA)
"RTN","TIURS",106,0)
 S TIUY=+$P($G(^TIU(8925,+DA,12)),U,8)
"RTN","TIURS",107,0)
 Q TIUY
"RTN","TIURS",108,0)
ES(DA,TIUES,TIUI) ; ^DIE call for /es/
"RTN","TIURS",109,0)
 N SIGNER,DR,DIE,ESDT,TIUSTAT,TIUSTNOW,COSIGNER,SVCHIEF,CSREQ,TIUPRINT
"RTN","TIURS",110,0)
 N CSNEED,TIUTTL,TIUPSIG,TIUDPRM,DAO,TIUSTWAS,TIUSTIS,DAORIG
"RTN","TIURS",111,0)
 S TIUSTWAS=$P($G(^TIU(8925,DA,0)),U,5)
"RTN","TIURS",112,0)
 D DOCPRM^TIULC1(+$G(^TIU(8925,+DA,0)),.TIUDPRM,DA)
"RTN","TIURS",113,0)
 S TIUSTAT=$P($G(^TIU(8925,+DA,0)),U,5),ESDT=$$NOW^TIULC
"RTN","TIURS",114,0)
 S SVCHIEF=+$$ISA^USRLM(DUZ,"CLINICAL SERVICE CHIEF")
"RTN","TIURS",115,0)
 S SIGNER=$P(^TIU(8925,+DA,12),U,4),COSIGNER=$P(^(12),U,8),CSREQ=0
"RTN","TIURS",116,0)
 S CSNEED=+$P($G(^TIU(8925,+DA,15)),U,6)
"RTN","TIURS",117,0)
 I +CSNEED,(DUZ'=COSIGNER),'+$G(SVCHIEF),(TIUSTAT'=6) S CSREQ=1
"RTN","TIURS",118,0)
 I TIUSTAT=5 D
"RTN","TIURS",119,0)
 . S DR=".05////"_$S(+CSREQ:6,1:7)_";1501////"_ESDT_";1502////"_+DUZ
"RTN","TIURS",120,0)
 . I '+$G(CSREQ),+CSNEED,$S(DUZ=COSIGNER:1,+$G(SVCHIEF):1,1:0) D
"RTN","TIURS",121,0)
 . . S DR=DR_";1506////0;1507////"_ESDT_";1508////"_+DUZ_";1509///^S X=$P(TIUES,U,2);1510///^S X=$P(TIUES,U,3);1511////E"
"RTN","TIURS",122,0)
 I TIUSTAT=6 S DR=".05////7;1506////0;1507////"_ESDT_";1508////"_+DUZ
"RTN","TIURS",123,0)
 Q:'$D(DR)
"RTN","TIURS",124,0)
 S DIE=8925 D ^DIE W:'$D(XWBOS) "."
"RTN","TIURS",125,0)
 I TIUSTAT=5 S DR="1503///^S X=$P(TIUES,U,2);1504///^S X=$P(TIUES,U,3);1505////E"
"RTN","TIURS",126,0)
 I TIUSTAT=6 D
"RTN","TIURS",127,0)
 . N TIUSBY S DR="",TIUSBY=$P($G(^TIU(8925,+DA,15)),U,2)
"RTN","TIURS",128,0)
 . I +TIUSBY>0 S DR="1503///^S X=$$SIGNAME^TIULS("_TIUSBY_");1504///^S X=$$SIGTITL^TIULS("_TIUSBY_");"
"RTN","TIURS",129,0)
 . S DR=$G(DR)_"1509///^S X=$P(TIUES,U,2);1510///^S X=$P(TIUES,U,3);1511////E"
"RTN","TIURS",130,0)
 S DIE=8925 D ^DIE W:'$D(XWBOS) "." S:'+$G(TIUCHNG) TIUCHNG=1
"RTN","TIURS",131,0)
 D SEND^TIUALRT(DA),SIGNIRT^TIUDIRT(+DA)
"RTN","TIURS",132,0)
 S DAORIG=DA
"RTN","TIURS",133,0)
 I +$$ISADDNDM^TIULC1(DA) S DA=+$P($G(^TIU(8925,+DA,0)),U,6)
"RTN","TIURS",134,0)
 I +$G(CSREQ)'>0 D MAIN^TIUPD(DA,"S") I 1
"RTN","TIURS",135,0)
 ;If 'Credit Stop Code on Completion' is Yes
"RTN","TIURS",136,0)
 I +$P(^TIU(8925,+DA,0),U,11) D
"RTN","TIURS",137,0)
 . ;If workload does not exist, process using TIU's interview otherwise
"RTN","TIURS",138,0)
 . ;process as an edit using PCE's interview
"RTN","TIURS",139,0)
 . I '$$CHKVST^TIUPXAP2(+DA) D  I 1
"RTN","TIURS",140,0)
 . . N TIUCONT,TIUPRMT
"RTN","TIURS",141,0)
 . . Q:$D(XWBOS)
"RTN","TIURS",142,0)
 . . I $P(+$P(^TIU(8925,+DA,0),U,7),".")>DT D  Q
"RTN","TIURS",143,0)
 . . . W !!
"RTN","TIURS",144,0)
 . . . D QUE^TIUPXAP1
"RTN","TIURS",145,0)
 . . . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIURS",146,0)
 . . W !!
"RTN","TIURS",147,0)
 . . ;Check if workload should be entered
"RTN","TIURS",148,0)
 . . I $$CHKWKL^TIUPXAP2(+DA,.TIUDPRM) D CREDIT^TIUVSIT(DA)
"RTN","TIURS",149,0)
 . E  D
"RTN","TIURS",150,0)
 . . ;Check if workload should be entered
"RTN","TIURS",151,0)
 . . I $$CHKWKL^TIUPXAP2(+DA,.TIUDPRM) D EDTENC^TIUPXAP2(DA)
"RTN","TIURS",152,0)
 . D REMFLAG^TIUVSIT(+DA)
"RTN","TIURS",153,0)
 ;If document does not have a visit and docmt is associated with
"RTN","TIURS",154,0)
 ;an event type visit or call is invoked by broker, check if
"RTN","TIURS",155,0)
 ;docmt can be linked to an existing visit or try and create a new
"RTN","TIURS",156,0)
 ;visit. (P179)
"RTN","TIURS",157,0)
 I $D(^TIU(8925,+DA,0)),$P(^(0),U,3)'>0,($P(^(0),U,13)="E"!($$BROKER^XWBLIB)) D
"RTN","TIURS",158,0)
 . N D0,DFN,TIU,TIUVSIT
"RTN","TIURS",159,0)
 . ;Try to link docmt to an existing visit, quit if successful
"RTN","TIURS",160,0)
 . I $$LNKVST^TIUPXAP3(DA,.TIUVSIT) Q
"RTN","TIURS",161,0)
 . ;Otherwise set TIU array and DFN to use TIU API which calls PCE
"RTN","TIURS",162,0)
 . ;to resolve multiple visits or creates a new visit
"RTN","TIURS",163,0)
 . D GETTIU^TIULD(.TIU,DA)
"RTN","TIURS",164,0)
 . S DFN=$P($G(^TIU(8925,+DA,0)),U,2)
"RTN","TIURS",165,0)
 . D QUE^TIUPXAP1
"RTN","TIURS",166,0)
 ; post-signature action
"RTN","TIURS",167,0)
 N TIUCONS S TIUCONS=-1
"RTN","TIURS",168,0)
 D ISCNSLT^TIUCNSLT(.TIUCONS,+$G(^TIU(8925,DA,0)))
"RTN","TIURS",169,0)
 I TIUCONS S DA=DAORIG
"RTN","TIURS",170,0)
 S TIUSTIS=$P($G(^TIU(8925,DA,0)),U,5)
"RTN","TIURS",171,0)
 S TIUTTL=+$G(^TIU(8925,+DA,0)),TIUPSIG=$$POSTSIGN^TIULC1(TIUTTL)
"RTN","TIURS",172,0)
 I +$L(TIUPSIG),'+$G(CSREQ) X TIUPSIG
"RTN","TIURS",173,0)
 I TIUCONS,TIUSTIS=7,TIUSTWAS<7,$$HASKIDS^TIUSRVLI(DA) D
"RTN","TIURS",174,0)
 . N SEQUENCE,TIUKIDS,TIUINT,TIUK
"RTN","TIURS",175,0)
 . S SEQUENCE="D",TIUKIDS="TIUKIDS",TIUINT=0,TIUK=0
"RTN","TIURS",176,0)
 . D SETKIDS^TIUSRVLI(TIUKIDS,DA,TIUINT)
"RTN","TIURS",177,0)
 . F  S TIUK=$O(TIUKIDS(TIUK)) Q:'TIUK  D
"RTN","TIURS",178,0)
 . . I $P(TIUKIDS(TIUK),U,7)="completed" X TIUPSIG
"RTN","TIURS",179,0)
 Q
"RTN","TIUSRVA")
0^3^B22071569
"RTN","TIUSRVA",1,0)
TIUSRVA ; SLC/JER,AJB - API's for Authorization ; 03/18/04 [10/19/04 1:21pm]
"RTN","TIUSRVA",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,28,47,80,100,116,152,160,178,175,157**;Jun 20, 1997
"RTN","TIUSRVA",3,0)
 ;
"RTN","TIUSRVA",4,0)
 ;External reference to File ^AUPNVSIT supported by DBIA 3580
"RTN","TIUSRVA",5,0)
REQCOS(TIUY,TIUTYP,TIUDA,TIUSER,TIUDT) ; Evaluate cosignature requirement
"RTN","TIUSRVA",6,0)
 ; Initialize return value
"RTN","TIUSRVA",7,0)
 N TIUDPRM
"RTN","TIUSRVA",8,0)
 S TIUY=0
"RTN","TIUSRVA",9,0)
 I +$G(TIUTYP)'>0,'+$G(TIUDA) Q
"RTN","TIUSRVA",10,0)
 I +$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+$G(TIUDA),0))
"RTN","TIUSRVA",11,0)
 S:'+$G(TIUSER) TIUSER=+$G(DUZ)
"RTN","TIUSRVA",12,0)
 S TIUY=+$$REQCOSIG^TIULP(TIUTYP,+$G(TIUDA),+$G(TIUSER),+$G(TIUDT))
"RTN","TIUSRVA",13,0)
 Q
"RTN","TIUSRVA",14,0)
URGENCY(Y) ; -- retrieve set values from dd for discharge summary urgency
"RTN","TIUSRVA",15,0)
 N TIUDD,I,X
"RTN","TIUSRVA",16,0)
 D FIELD^DID(8925,.09,"","POINTER","TIUDD")
"RTN","TIUSRVA",17,0)
 F I=1:1 S X=$P(TIUDD("POINTER"),";",I) Q:X=""   S Y(I)=$TR(X,":","^")
"RTN","TIUSRVA",18,0)
 Q
"RTN","TIUSRVA",19,0)
CANDO(Y,TIUDA,TIUACT) ; Boolean function to evaluate privilege
"RTN","TIUSRVA",20,0)
 N TIUPOP,TIUDPRM S TIUPOP=0
"RTN","TIUSRVA",21,0)
 ; **152** code added to prevent editing a completed document.
"RTN","TIUSRVA",22,0)
 I $P($G(^TIU(8925,TIUDA,0)),U,5)>6,(TIUACT="EDIT RECORD") S Y="0^ You may not edit a completed document" Q
"RTN","TIUSRVA",23,0)
 I $S(TIUACT["SIGN":1,TIUACT="EDIT RECORD":1,TIUACT="DELETE RECORD":1,1:0) D  Q:+TIUPOP=1
"RTN","TIUSRVA",24,0)
 . L +^TIU(8925,+TIUDA):1
"RTN","TIUSRVA",25,0)
 . E  S Y="0^ Another session is editing this entry.",TIUPOP=1
"RTN","TIUSRVA",26,0)
 . L -^TIU(8925,+TIUDA)
"RTN","TIUSRVA",27,0)
 I TIUACT["SIGN",+$$NEEDCS(TIUDA) S Y="0^ You must name a cosigner before signing this document." Q
"RTN","TIUSRVA",28,0)
 S Y=$$CANDO^TIULP(TIUDA,TIUACT)
"RTN","TIUSRVA",29,0)
 Q
"RTN","TIUSRVA",30,0)
NEEDCS(TIUDA) ; Does user need a cosigner?
"RTN","TIUSRVA",31,0)
 N TIUD0,TIUD12,TIUY,SIGNER,COSIGNER,XTRASGNR
"RTN","TIUSRVA",32,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^(12))
"RTN","TIUSRVA",33,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8),XTRASGNR=0
"RTN","TIUSRVA",34,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVA",35,0)
 I +XTRASGNR S TIUY=0
"RTN","TIUSRVA",36,0)
 E  I +$$REQCOSIG^TIULP(+TIUD0,TIUDA,DUZ),(+$P(TIUD12,U,8)'>0) S TIUY=1
"RTN","TIUSRVA",37,0)
 Q +$G(TIUY)
"RTN","TIUSRVA",38,0)
USRINACT(TIUY,TIUDA) ; Is user inactive?
"RTN","TIUSRVA",39,0)
 S TIUY=+$$GET1^DIQ(200,TIUDA_",",7,"I")
"RTN","TIUSRVA",40,0)
 Q
"RTN","TIUSRVA",41,0)
AUTHSIGN(TIUY,TIUDA,TIUUSR) ; Has Author signed?
"RTN","TIUSRVA",42,0)
 ; if TIUY = 
"RTN","TIUSRVA",43,0)
 ; 0 = Author has NOT signed & TIUUSR = Expected Cosigner
"RTN","TIUSRVA",44,0)
 ; 1 = Author HAS signed or TIUUSR '= Expected Cosigner
"RTN","TIUSRVA",45,0)
 ;
"RTN","TIUSRVA",46,0)
 N TIUD12,TIUD15
"RTN","TIUSRVA",47,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12)),TIUD15=$G(^(15))
"RTN","TIUSRVA",48,0)
 S TIUY=1
"RTN","TIUSRVA",49,0)
 D:$P(TIUD12,U,8)=TIUUSR  Q
"RTN","TIUSRVA",50,0)
 . S:$P(TIUD12,U,2)'=$P(TIUD15,U,2) TIUY=0
"RTN","TIUSRVA",51,0)
 Q
"RTN","TIUSRVA",52,0)
TIUVISIT(TIUY,DOCTYP,DFN,VISIT) ;  Check for a 1 time only doc
"RTN","TIUSRVA",53,0)
 ;  TIUY    =    return value
"RTN","TIUSRVA",54,0)
 ;          = 0 if can add more than one or none already exist
"RTN","TIUSRVA",55,0)
 ;          = 1 if cannot add more than one and one already exists
"RTN","TIUSRVA",56,0)
 ;  DOCTYP  =    Pointer to ^TUI(8925.1,   TIU DOCUMENT DEFINITION
"RTN","TIUSRVA",57,0)
 ;  DFN     =    Patient IEN
"RTN","TIUSRVA",58,0)
 ;  VISIT   =    Visit String "LOC;VDATE;VTYP"
"RTN","TIUSRVA",59,0)
 I $$PATCH^XPDUTL("OR*3.0*195") D
"RTN","TIUSRVA",60,0)
 . Q:($G(DOCTYP)="")!($G(DFN)="")!($G(VISIT)="")
"RTN","TIUSRVA",61,0)
 . N TIUDPRM,TIUTEST
"RTN","TIUSRVA",62,0)
 . D DOCPRM^TIULC1(DOCTYP,.TIUDPRM)
"RTN","TIUSRVA",63,0)
 . S TIUY=$S($P(TIUDPRM(0),U,10)="":1,1:$P(TIUDPRM(0),U,10))
"RTN","TIUSRVA",64,0)
 . I TIUY=1 S TIUY=0 Q
"RTN","TIUSRVA",65,0)
 . I $L(VISIT,";")=3 D
"RTN","TIUSRVA",66,0)
 . . S TIUTEST=$$EXIST^TIUEDI3(DFN,DOCTYP,VISIT)
"RTN","TIUSRVA",67,0)
 . . I TIUTEST S TIUY=1
"RTN","TIUSRVA",68,0)
 . . I 'TIUTEST S TIUY=0
"RTN","TIUSRVA",69,0)
 I '$$PATCH^XPDUTL("OR*3.0*195") D
"RTN","TIUSRVA",70,0)
 . Q:($G(DOCTYP)="")!($G(DFN)="")!($G(VISIT)="")
"RTN","TIUSRVA",71,0)
 . N X3
"RTN","TIUSRVA",72,0)
 . S X3=+$O(^TIU(8925.95,"B",DOCTYP,""))
"RTN","TIUSRVA",73,0)
 . S TIUY=$P($G(^TIU(8925.95,X3,0)),U,10) S TIUY=$S(TIUY=0:1,1:0)
"RTN","TIUSRVA",74,0)
 . Q:'TIUY
"RTN","TIUSRVA",75,0)
 . S VISIT=((9999999-$P(VISIT,"."))_"."_$P(VISIT,".",2))
"RTN","TIUSRVA",76,0)
 . S VISIT=+$O(^AUPNVSIT("AA",DFN,VISIT,""))
"RTN","TIUSRVA",77,0)
 . S TIUY=$S($D(^TIU(8925,"AV",DFN,DOCTYP,VISIT)):0,1:1)
"RTN","TIUSRVA",78,0)
 . S TIUY=$S(TIUY=0:1,1:0)
"RTN","TIUSRVA",79,0)
 Q
"RTN","TIUSRVA",80,0)
WHATACT(Y,TIUDA) ; Evaluate/return whether signature or cosignature
"RTN","TIUSRVA",81,0)
 N TIUD0,TIUD12,TIUSTAT,SIGNER,COSIGNER,XTRASGNR
"RTN","TIUSRVA",82,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIUSRVA",83,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8)
"RTN","TIUSRVA",84,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVA",85,0)
 I '$G(XTRASGNR) S XTRASGNR=$$ASURG^TIUADSIG(TIUDA)
"RTN","TIUSRVA",86,0)
 S TIUSTAT=+$P(TIUD0,U,5)
"RTN","TIUSRVA",87,0)
 S Y=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIUSRVA",88,0)
 Q
"RTN","TIUSRVA",89,0)
CANCHCOS(Y,TIUDA) ; Evaluate/return whether user can change cosigner
"RTN","TIUSRVA",90,0)
 S Y=$$MAYCHNG^TIURA1(TIUDA)
"RTN","TIUSRVA",91,0)
 Q
"RTN","TIUSRVA",92,0)
NEEDJUST(Y,TIUDA) ; Is justification required for deletion?
"RTN","TIUSRVA",93,0)
 N TIUD0 S TIUD0=$G(^TIU(8925,+TIUDA,0)),Y=0
"RTN","TIUSRVA",94,0)
 I +$P(TIUD0,U,5)'<6 S Y=1
"RTN","TIUSRVA",95,0)
 Q
"RTN","TIUSRVA",96,0)
GETTITLE(Y,TIUDA) ; Get the title from a TIU Document Record
"RTN","TIUSRVA",97,0)
 S Y=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVA",98,0)
 Q
"RTN","TIUSRVA",99,0)
CANATTCH(Y,TIUDA) ; Can this document be attached as an ID Child
"RTN","TIUSRVA",100,0)
 N TITLEDA,PARENTDA
"RTN","TIUSRVA",101,0)
 S TITLEDA=+$G(^TIU(8925,TIUDA,0))
"RTN","TIUSRVA",102,0)
 I TITLEDA'>0 S Y="0^Document #"_TIUDA_" does not exist." Q
"RTN","TIUSRVA",103,0)
 S PARENTDA=+$G(^TIU(8925,TIUDA,21))
"RTN","TIUSRVA",104,0)
 S Y=$$POSSPRNT^TIULP(TITLEDA)
"RTN","TIUSRVA",105,0)
 I +Y S Y="-1"_U_$P(Y,U,2) Q
"RTN","TIUSRVA",106,0)
 I +$$ISCWAD^TIULX(TITLEDA) D  Q
"RTN","TIUSRVA",107,0)
 . S Y="0^ CWAD Documents may not be Attached as Interdisciplinary Entries."
"RTN","TIUSRVA",108,0)
 I +$$ISA^TIULX(TITLEDA,+$$CLASS^TIUCNSLT) D  Q
"RTN","TIUSRVA",109,0)
 . S Y="0^ Consult Results may not be Attached as Interdisciplinary Entries."
"RTN","TIUSRVA",110,0)
 S Y=$$CANDO^TIULP(TIUDA,"ATTACH TO ID NOTE")
"RTN","TIUSRVA",111,0)
 I PARENTDA D  ; action must be "detach"
"RTN","TIUSRVA",112,0)
 . I 'Y S Y="0^ You may not detach this note from an interdisciplinary note." Q
"RTN","TIUSRVA",113,0)
 . S Y=$$CANDO^TIULP(PARENTDA,"ATTACH ID ENTRY")
"RTN","TIUSRVA",114,0)
 . I 'Y S Y="0^ You may not detach this note from its interdisciplinary note."
"RTN","TIUSRVA",115,0)
 Q
"RTN","TIUSRVA",116,0)
CANRCV(Y,TIUDA) ; Can this document receive an ID Child?
"RTN","TIUSRVA",117,0)
 S Y=$$CANDO^TIULP(TIUDA,"ATTACH ID ENTRY")
"RTN","TIUSRVA",118,0)
 Q
"RTN","TIUSRVP")
0^4^B75223693
"RTN","TIUSRVP",1,0)
TIUSRVP ; SLC/JER - RPCs for CREATE & UPDATE ;11/01/03 [12/15/04 11:50am]
"RTN","TIUSRVP",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,7,19,28,47,89,104,100,115,109,167,113,112,175,157**;Jun 20, 1997
"RTN","TIUSRVP",3,0)
MAKE(SUCCESS,DFN,TITLE,VDT,VLOC,VSIT,TIUX,VSTR,SUPPRESS,NOASF) ; New Document
"RTN","TIUSRVP",4,0)
 ; SUCCESS = (by ref) TIU DOCUMENT # (PTR to 8925)
"RTN","TIUSRVP",5,0)
 ;         = 0^Explanatory message if no SUCCESS
"RTN","TIUSRVP",6,0)
 ; DFN     = Patient (#2)
"RTN","TIUSRVP",7,0)
 ; TITLE   = TIU Document Definition (#8925.1)
"RTN","TIUSRVP",8,0)
 ; [VDT]   = Date(/Time) of Visit
"RTN","TIUSRVP",9,0)
 ; [VLOC]  = Visit Location (HOSPITAL LOCATION)
"RTN","TIUSRVP",10,0)
 ; [VSIT]  = Visit file ien (#9000010)
"RTN","TIUSRVP",11,0)
 ; [VSTR]  = Visit string (i.e., VLOC;VDT;VTYPE)
"RTN","TIUSRVP",12,0)
 ; [NOASF] = if 1=Do Not Set ASAVE cross-reference
"RTN","TIUSRVP",13,0)
 ; TIUX    = (by ref) array containing field data and document body
"RTN","TIUSRVP",14,0)
 ;
"RTN","TIUSRVP",15,0)
 N TIU,TIUDA,LDT,NEWREC
"RTN","TIUSRVP",16,0)
 S SUCCESS=0
"RTN","TIUSRVP",17,0)
 I +$G(VSIT) S VSTR=$$VSTRBLD(+VSIT)
"RTN","TIUSRVP",18,0)
 I $L($G(VSTR)) D
"RTN","TIUSRVP",19,0)
 . S VDT=$S(+$G(VDT):+$G(VDT),1:$P(VSTR,";",2))
"RTN","TIUSRVP",20,0)
 . S LDT=$S(+$G(VDT):$$FMADD^XLFDT(VDT,"","",1),1:"")
"RTN","TIUSRVP",21,0)
 . S VLOC=$S(+$G(VLOC):+$G(VLOC),1:$P(VSTR,";"))
"RTN","TIUSRVP",22,0)
 . ; If note is for Ward Location, call MAIN^TIUMOVE
"RTN","TIUSRVP",23,0)
 . I $P($G(^SC(+VLOC,0)),U,3)="W" D MAIN^TIUMOVE(.TIU,DFN,"",VDT,LDT,1,"LAST",0,+VLOC) Q
"RTN","TIUSRVP",24,0)
 . ; Otherwise, call PATVADPT^TIULV
"RTN","TIUSRVP",25,0)
 . D PATVADPT^TIULV(.TIU,DFN,"",VSTR)
"RTN","TIUSRVP",26,0)
 I '+$G(VSIT),'$L($G(VSTR)),+$G(VDT),+$G(VLOC) D
"RTN","TIUSRVP",27,0)
 . S VDT=$G(VDT),LDT=$S(+$G(VDT):$$FMADD^XLFDT(VDT,"","",1),1:"")
"RTN","TIUSRVP",28,0)
 . ; If note is for Ward Location, call MAIN^TIUMOVE
"RTN","TIUSRVP",29,0)
 . I $P($G(^SC(+VLOC,0)),U,3)="W" D MAIN^TIUMOVE(.TIU,DFN,"",VDT,LDT,1,"LAST",0,+VLOC) Q
"RTN","TIUSRVP",30,0)
 . ; Otherwise, call MAIN^TIUVSIT
"RTN","TIUSRVP",31,0)
 . D MAIN^TIUVSIT(.TIU,DFN,"",VDT,LDT,"LAST",0,VLOC)
"RTN","TIUSRVP",32,0)
 I '+$G(TIU("VSTR")) D
"RTN","TIUSRVP",33,0)
 . D EVENT^TIUSRVP1(.TIU,DFN)
"RTN","TIUSRVP",34,0)
 S TIU("INST")=$$DIVISION^TIULC1(+TIU("LOC"))
"RTN","TIUSRVP",35,0)
 I $S($D(TIU)'>9:1,+$G(DFN)'>0:1,1:0) S SUCCESS="0^"_$$EZBLD^DIALOG(89250001) Q
"RTN","TIUSRVP",36,0)
 ;
"RTN","TIUSRVP",37,0)
 S TIUDA=$$GETREC(DFN,.TIU,TITLE,.NEWREC)
"RTN","TIUSRVP",38,0)
 I +TIUDA'>0 S SUCCESS="0^"_$$EZBLD^DIALOG(89250002) Q
"RTN","TIUSRVP",39,0)
 S SUCCESS=+TIUDA
"RTN","TIUSRVP",40,0)
 ;
"RTN","TIUSRVP",41,0)
 D STUFREC^TIUSRVP1(+TIUDA,.TIUX,DFN,,TITLE,.TIU)
"RTN","TIUSRVP",42,0)
 S:'+$G(NOASF) ^TIU(8925,"ASAVE",DUZ,TIUDA)=""
"RTN","TIUSRVP",43,0)
 K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",44,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUSRVP",45,0)
 D SETXT0(TIUDA)
"RTN","TIUSRVP",46,0)
 D FILE(.SUCCESS,+TIUDA,.TIUX,+$G(SUPPRESS))
"RTN","TIUSRVP",47,0)
 I +SUCCESS'>0 D DIK^TIURB2(TIUDA) Q
"RTN","TIUSRVP",48,0)
 I +$O(^TIU(8925,+TIUDA,"TEMP",0)) D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUSRVP",49,0)
 I +$G(TIU("STOP")) D DEFER^TIUVSIT(TIUDA,TIU("STOP")) I 1
"RTN","TIUSRVP",50,0)
 E  D QUE^TIUPXAP1
"RTN","TIUSRVP",51,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",52,0)
 . D RELEASE^TIUT(TIUDA,1)
"RTN","TIUSRVP",53,0)
 . D UPDTIRT^TIUDIRT(.TIU,TIUDA)
"RTN","TIUSRVP",54,0)
 K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",55,0)
 Q
"RTN","TIUSRVP",56,0)
VSTRBLD(VSIT) ; Given Visit ien, build Visit-Descriptor String
"RTN","TIUSRVP",57,0)
 N TIUY,VSIT0,VLOC,VDT,VSVCAT
"RTN","TIUSRVP",58,0)
 S VSIT0=$G(^AUPNVSIT(+VSIT,0)),VDT=+$P(VSIT0,U),VLOC=+$P(VSIT0,U,22)
"RTN","TIUSRVP",59,0)
 S VSVCAT=$P(VSIT0,U,7)
"RTN","TIUSRVP",60,0)
 S TIUY=VLOC_";"_VDT_";"_VSVCAT
"RTN","TIUSRVP",61,0)
 Q TIUY
"RTN","TIUSRVP",62,0)
SETXT0(TIUDA) ; Set root node of "TEMP" WP-field
"RTN","TIUSRVP",63,0)
 N TIUC,TIUI S (TIUC,TIUI)=0
"RTN","TIUSRVP",64,0)
 F  S TIUI=$O(^TIU(8925,TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVP",65,0)
 . S:$D(^TIU(8925,TIUDA,"TEMP",TIUI,0)) TIUC=TIUC+1
"RTN","TIUSRVP",66,0)
 S ^TIU(8925,TIUDA,"TEMP",0)="^^"_TIUC_U_TIUC_U_DT_"^^"
"RTN","TIUSRVP",67,0)
 Q
"RTN","TIUSRVP",68,0)
MAKEADD(TIUDADD,TIUDA,TIUX,SUPPRESS) ; Create addendum
"RTN","TIUSRVP",69,0)
 N DIE,DR,DA,DIC,X,Y,DLAYGO,TIUATYP,TIUCAN,TIUFPRIV,TIU S TIUFPRIV=1
"RTN","TIUSRVP",70,0)
 S TIUCAN=$$CANDO^TIULP(TIUDA,"MAKE ADDENDUM")
"RTN","TIUSRVP",71,0)
 I TIUCAN'>0 S TIUDADD="0^You may not MAKE AN ADDENDUM for this "_$$STATUS^TIULC(TIUDA)_" "_$$PNAME^TIULC1(+$G(^TIU(8925,+TIUDA,0))) Q
"RTN","TIUSRVP",72,0)
 S TIUATYP=+$$WHATITLE^TIUPUTU("ADDENDUM")
"RTN","TIUSRVP",73,0)
 S (DIC,DLAYGO)=8925,DIC(0)="L",X=""""_"`"_TIUATYP_""""
"RTN","TIUSRVP",74,0)
 D ^DIC
"RTN","TIUSRVP",75,0)
 S TIUDADD=+Y
"RTN","TIUSRVP",76,0)
 I +Y'>0 S TIUDADD=TIUDADD_"^Could not create addendum." Q
"RTN","TIUSRVP",77,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVP",78,0)
 S TIU("DOCTYP")=TIUATYP_U_$$PNAME^TIULC1(TIUATYP)
"RTN","TIUSRVP",79,0)
 D STUFREC^TIUSRVP1(+TIUDADD,.TIUX,DFN,+$G(TIUDA),TIUATYP,.TIU)
"RTN","TIUSRVP",80,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUSRVP",81,0)
 M ^TIU(8925,+TIUDADD,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUSRVP",82,0)
 D SETXT0(+TIUDADD)
"RTN","TIUSRVP",83,0)
 D FILE(.SUCCESS,+TIUDADD,.TIUX,+$G(SUPPRESS))
"RTN","TIUSRVP",84,0)
 I +SUCCESS'>0 D DIK^TIURB2(TIUDADD) Q
"RTN","TIUSRVP",85,0)
 I +$O(^TIU(8925,+TIUDADD,"TEMP",0)) D MERGTEXT^TIUEDI1(+TIUDADD,.TIU)
"RTN","TIUSRVP",86,0)
 I '+$G(SUPPRESS) D RELEASE^TIUT(+TIUDADD,1)
"RTN","TIUSRVP",87,0)
 K ^TIU(8925,+TIUDADD,"TEMP")
"RTN","TIUSRVP",88,0)
 Q
"RTN","TIUSRVP",89,0)
UPDATE(SUCCESS,TIUDA,TIUX,SUPPRESS) ; Update existing Document
"RTN","TIUSRVP",90,0)
 N TIU,TIUI,TIUC,TIUD0,TIUD12,TIUD15,TIUCPF,TITLE
"RTN","TIUSRVP",91,0)
 I $S(+$G(TIUDA)'>0:1,'$D(^TIU(8925,+TIUDA,0)):1,1:0) D  Q
"RTN","TIUSRVP",92,0)
 . S SUCCESS="0^ Cannot update a non-existent document..."
"RTN","TIUSRVP",93,0)
 I +$P($G(^TIU(8925,+TIUDA,0)),U,5)>6 D  Q
"RTN","TIUSRVP",94,0)
 . S SUCCESS="0^ TIU Document #"_TIUDA_" is already signed..."
"RTN","TIUSRVP",95,0)
 I $D(TIUX("TEXT")) D
"RTN","TIUSRVP",96,0)
 . K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",97,0)
 . M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT")
"RTN","TIUSRVP",98,0)
 . S (TIUC,TIUI)=0
"RTN","TIUSRVP",99,0)
 . F  S TIUI=$O(^TIU(8925,+TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVP",100,0)
 . . S TIUC=TIUC+1
"RTN","TIUSRVP",101,0)
 . I +TIUC>0 S ^TIU(8925,+TIUDA,"TEMP",0)="^^"_TIUC_U_TIUC_U_DT_"^^"
"RTN","TIUSRVP",102,0)
 . K TIUX("TEXT")
"RTN","TIUSRVP",103,0)
 I +$O(TIUX(""))'>0 S:+$G(SUPPRESS) SUCCESS=+TIUDA Q
"RTN","TIUSRVP",104,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^(12)),TITLE=+TIUD0
"RTN","TIUSRVP",105,0)
 ;Set a flag to indicate whether or not a Title is a member of the
"RTN","TIUSRVP",106,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRVP",107,0)
 S TIUCPF=+$$ISA^TIULX(TITLE,+$$CLASS^TIUCP)
"RTN","TIUSRVP",108,0)
 D SETCOS(TIUDA,.TIUX,TIUD0,TIUD12)
"RTN","TIUSRVP",109,0)
 ; Title changed? Refile DC
"RTN","TIUSRVP",110,0)
 I +$G(TIUX(.01))>0,(+$G(TIUX(.01))'=+TIUD0) D
"RTN","TIUSRVP",111,0)
 . S TIUX(.04)=$$DOCCLASS^TIULC1(+$G(TIUX(.01)))
"RTN","TIUSRVP",112,0)
 D FILE(.SUCCESS,+TIUDA,.TIUX,+$G(SUPPRESS),TIUCPF)
"RTN","TIUSRVP",113,0)
 I +SUCCESS'>0 K ^TIU(8925,+TIUDA,"TEMP") Q
"RTN","TIUSRVP",114,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVP",115,0)
 I $D(^TIU(8925,+TIUDA,"TEMP")) D
"RTN","TIUSRVP",116,0)
 . K ^TIU(8925,+TIUDA,"TEXT")
"RTN","TIUSRVP",117,0)
 . D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUSRVP",118,0)
 . K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVP",119,0)
 . S:'+$G(SUCCESS) SUCCESS=+TIUDA
"RTN","TIUSRVP",120,0)
 ; If signed, re-file /ES/
"RTN","TIUSRVP",121,0)
 S TIUD15=$G(^TIU(8925,+TIUDA,15))
"RTN","TIUSRVP",122,0)
 I +TIUD15 D
"RTN","TIUSRVP",123,0)
 . N TIUBY,DR,DIE,DA,X,Y S TIUBY=$P(TIUD15,U,2) Q:+TIUBY'>0
"RTN","TIUSRVP",124,0)
 . S DR="1503///^S X=$$SIGNAME^TIULS("_TIUBY_");1504///^S X=$$SIGTITL^TIULS("_TIUBY_")"
"RTN","TIUSRVP",125,0)
 . S DA=TIUDA,DIE=8925 D ^DIE
"RTN","TIUSRVP",126,0)
 ; send alerts
"RTN","TIUSRVP",127,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",128,0)
 . I +$P(TIUD0,U,5)<5,'$D(TIUX(.05)) D UPDSTAT(TIUDA,+$G(TIUD0))
"RTN","TIUSRVP",129,0)
 . D SEND^TIUALRT(TIUDA),SENDID^TIUALRT1(TIUDA):+$G(^TIU(8925,+TIUDA,21))
"RTN","TIUSRVP",130,0)
 . D UPDTIRT^TIUDIRT(.TIU,TIUDA)
"RTN","TIUSRVP",131,0)
 Q
"RTN","TIUSRVP",132,0)
SETCOS(TIUDA,TIUX,TIUD0,TIUD12) ; set cosig req
"RTN","TIUSRVP",133,0)
 N TIUDAD,TIUEXS,TIUNCS,TIUEXCS,TIURCS,TIUATT,TIUTTL,TIUDAD0
"RTN","TIUSRVP",134,0)
 S TIUEXS=$S(+$G(TIUX(1202)):+$G(TIUX(1202)),1:$P(TIUD12,U,4))
"RTN","TIUSRVP",135,0)
 S TIUNCS=$S(+$G(TIUX(1208)):+$G(TIUX(1208)),+$G(TIUX(1209)):+$G(TIUX(1209)),1:0)
"RTN","TIUSRVP",136,0)
 I TIUNCS S TIUX(1506)=$S(TIUNCS=TIUEXS:0,1:1) G SETCOSX
"RTN","TIUSRVP",137,0)
 S TIUEXCS=$P(TIUD12,U,8),TIUATT=$P(TIUD12,U,9)
"RTN","TIUSRVP",138,0)
 S TIUDAD=+$P(TIUD0,U,6),TIUDAD0=$G(^TIU(8925,+TIUDAD,0))
"RTN","TIUSRVP",139,0)
 I +$$ISDS^TIULX($S(+TIUDAD:+TIUDAD0,1:+TIUD0)) D  G SETCOSX
"RTN","TIUSRVP",140,0)
 . S TIUX(1506)=$S(TIUEXS=TIUEXCS:0,1:1)
"RTN","TIUSRVP",141,0)
 S TIUTTL=$S(+$G(TIUX(.01)):+$G(TIUX(.01)),1:+TIUD0)
"RTN","TIUSRVP",142,0)
 S TIUX(1506)=+$$REQCOSIG^TIULP(TIUTTL,TIUDA,TIUEXS)
"RTN","TIUSRVP",143,0)
SETCOSX S:'TIUX(1506) TIUX(1208)="@"
"RTN","TIUSRVP",144,0)
 Q
"RTN","TIUSRVP",145,0)
UPDSTAT(DA,TITLE) ; Update status on commit
"RTN","TIUSRVP",146,0)
 N DR,DIE S DR=".05////"_$$STATUS^TIUSRVP1(DA,0,TITLE)
"RTN","TIUSRVP",147,0)
 I '+$P($G(^TIU(8925,DA,13)),U,4) S DR=DR_";1304////^S X=$$NOW^XLFDT"
"RTN","TIUSRVP",148,0)
 S DIE=8925
"RTN","TIUSRVP",149,0)
 D ^DIE
"RTN","TIUSRVP",150,0)
 Q
"RTN","TIUSRVP",151,0)
GETREC(DFN,TIU,TITLE,TIUNEW) ; Get/create document record
"RTN","TIUSRVP",152,0)
 N DA,DIC,DIE,DLAYGO,DR,X,Y,TIUDPRM,TIUFPRIV,TIUHIT,TIUSCAT
"RTN","TIUSRVP",153,0)
 S (TIUHIT,DA)=0,TIUFPRIV=1
"RTN","TIUSRVP",154,0)
 S (DIC,DLAYGO)=8925,DIC(0)="FL"
"RTN","TIUSRVP",155,0)
 S X=""""_"`"_+TITLE_"""" D ^DIC K DIC("S")
"RTN","TIUSRVP",156,0)
 I +Y'>0 Q Y_U_" Insufficient data to create a new record."
"RTN","TIUSRVP",157,0)
 S DA=+Y,TIUNEW=+$P(Y,U,3)
"RTN","TIUSRVP",158,0)
 N DIE,DR,TIUVISIT S DIE=8925
"RTN","TIUSRVP",159,0)
 S TIUVISIT=$S(+$G(TIU("VISIT")):+$G(TIU("VISIT")),1:"")
"RTN","TIUSRVP",160,0)
 S TIUSCAT=$S(+$L($P($G(TIU("CAT")),U)):$P($G(TIU("CAT")),U),+$L($P($G(TIU("VSTR")),";",3)):$P($G(TIU("VSTR")),";",3),1:"")
"RTN","TIUSRVP",161,0)
 S DR=".04////"_$$DOCCLASS^TIULC1(+$P(Y,U,2))_";.13////"_TIUSCAT_";1205////"_$P($G(TIU("LOC")),U)_";1211////"_$P($G(TIU("VLOC")),U)_";1212////"_$P($G(TIU("INST")),U)
"RTN","TIUSRVP",162,0)
 D ^DIE
"RTN","TIUSRVP",163,0)
 Q +$G(DA)
"RTN","TIUSRVP",164,0)
FILE(SUCCESS,TIUDA,TIUX,SUPPRESS,TIUCPF) ; Call FM Filer & commit
"RTN","TIUSRVP",165,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIUCMMTX
"RTN","TIUSRVP",166,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS=""
"RTN","TIUSRVP",167,0)
 I +$G(TIUX(1202)) S TIUX(1204)=+$G(TIUX(1202))
"RTN","TIUSRVP",168,0)
 I +$G(TIUX(1209)) S TIUX(1208)=+$G(TIUX(1209))
"RTN","TIUSRVP",169,0)
 ;If the document is a member of the Clinical Procedures Class, set the
"RTN","TIUSRVP",170,0)
 ;Entered By field to the Author/Dictator field
"RTN","TIUSRVP",171,0)
 I $G(TIUCPF),+$G(TIUX(1202)) S TIUX(1302)=+$G(TIUX(1202))
"RTN","TIUSRVP",172,0)
 M @FDARR=TIUX
"RTN","TIUSRVP",173,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUSRVP",174,0)
 I $D(TIUMSG)>9 S SUCCESS=0_U_$G(TIUMSG("DIERR",1,"TEXT",1)) Q
"RTN","TIUSRVP",175,0)
 S SUCCESS=TIUDA
"RTN","TIUSRVP",176,0)
 I '+$G(SUPPRESS) D
"RTN","TIUSRVP",177,0)
 . N DA
"RTN","TIUSRVP",178,0)
 . S DA=TIUDA
"RTN","TIUSRVP",179,0)
 . S TIUCMMTX=$$COMMIT^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUSRVP",180,0)
 . I TIUCMMTX]"" X TIUCMMTX
"RTN","TIUSRVP",181,0)
 . K ^TIU(8925,"ASAVE",DUZ,TIUDA)
"RTN","TIUSRVP",182,0)
 Q
"RTN","TIUSRVP",183,0)
SIGN(ERR,TIUDA,TIUX) ; API for /es/
"RTN","TIUSRVP",184,0)
 N X,TIUACT,TIUSIGN,TIUD0,TIUD12,TIUSTAT,SIGNER,COSIGNER,VALID,XTRASGNR
"RTN","TIUSRVP",185,0)
 N TIUES S ERR=0
"RTN","TIUSRVP",186,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIUSRVP",187,0)
 S SIGNER=$P(TIUD12,U,4),COSIGNER=$P(TIUD12,U,8)
"RTN","TIUSRVP",188,0)
 I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIUSRVP",189,0)
 I $G(XTRASGNR),+$P($G(^TIU(8925.7,$G(XTRASGNR),0)),U,4) S XTRASGNR=""
"RTN","TIUSRVP",190,0)
 I '$G(XTRASGNR) S XTRASGNR=$$ASURG^TIUADSIG(TIUDA)
"RTN","TIUSRVP",191,0)
 S TIUSTAT=+$P(TIUD0,U,5)
"RTN","TIUSRVP",192,0)
 S TIUACT=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIUSRVP",193,0)
 S TIUSIGN=$$CANDO^TIULP(TIUDA,TIUACT)
"RTN","TIUSRVP",194,0)
 I +TIUSIGN'>0 S ERR="89250004^"_$P(TIUSIGN,U,2) Q
"RTN","TIUSRVP",195,0)
 S VALID=$$VALIDATE($$DECRYP^XUSRB1(TIUX))
"RTN","TIUSRVP",196,0)
 I +VALID'>0 S ERR="89250005^"_$$EZBLD^DIALOG(89250005) Q
"RTN","TIUSRVP",197,0)
 S TIUES=1_U_$$GET1^DIQ(200,+DUZ,20.2)_U_$$GET1^DIQ(200,+DUZ,20.3)
"RTN","TIUSRVP",198,0)
 I '+$G(XTRASGNR) D ES^TIURS(TIUDA,TIUES)
"RTN","TIUSRVP",199,0)
 I +$G(XTRASGNR) D ADDSIG^TIURS1(TIUDA,XTRASGNR)
"RTN","TIUSRVP",200,0)
 I +$G(^TIU(8925,TIUDA,21)),(TIUACT="SIGNATURE") D AUDLINK^TIUGR1(TIUDA,"a",+$G(^TIU(8925,TIUDA,21)))
"RTN","TIUSRVP",201,0)
 Q
"RTN","TIUSRVP",202,0)
VALIDATE(X) ; Validate /es/-code
"RTN","TIUSRVP",203,0)
 N TIUY S TIUY=0
"RTN","TIUSRVP",204,0)
 D HASH^XUSHSHP I X]"",(X=$P($G(^VA(200,+DUZ,20)),U,4)) S TIUY=1
"RTN","TIUSRVP",205,0)
 Q TIUY
"RTN","TIUSRVP",206,0)
DELETE(ERR,TIUDA,TIURSN,OVRRIDE) ; delete document
"RTN","TIUSRVP",207,0)
 N TIUDEL,TIUD0 S ERR=0
"RTN","TIUSRVP",208,0)
 I '+$G(OVRRIDE) D  Q:+$G(TIUDEL)'>0
"RTN","TIUSRVP",209,0)
 . S TIUDEL=$$CANDO^TIULP(TIUDA,"DELETE RECORD")
"RTN","TIUSRVP",210,0)
 . I TIUDEL'>0 S ERR="89250003^"_$$EZBLD^DIALOG(89250003)
"RTN","TIUSRVP",211,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVP",212,0)
 I +$P(TIUD0,U,5)'<6 D  Q
"RTN","TIUSRVP",213,0)
 . S TIURSN=$G(TIURSN,"A")
"RTN","TIUSRVP",214,0)
 . D DELTEXT^TIURB2(TIUDA,TIURSN)
"RTN","TIUSRVP",215,0)
 D DIK^TIURB2(TIUDA)
"RTN","TIUSRVP",216,0)
 D DELAUDIT^TIUEDI1(TIUDA)
"RTN","TIUSRVP",217,0)
 Q
"RTN","TIUSRVP",218,0)
LOCK(ERR,TIUDA) ; Bid for lock on a TIU Document record
"RTN","TIUSRVP",219,0)
 L +^TIU(8925,+TIUDA):1 I  S ERR=0
"RTN","TIUSRVP",220,0)
 E  S ERR="1^ Another session has this record locked."
"RTN","TIUSRVP",221,0)
 Q
"RTN","TIUSRVP",222,0)
UNLOCK(ERR,TIUDA) ; Decrement Lock on a TIU Document record
"RTN","TIUSRVP",223,0)
 L -^TIU(8925,+TIUDA) S ERR=0
"RTN","TIUSRVP",224,0)
 Q
"RTN","TIUSRVR3")
0^6^B18170093
"RTN","TIUSRVR3",1,0)
TIUSRVR3 ; SLC/JER - Load Signatures for record-wise GET ;4/12/01 [10/18/04 8:32am]
"RTN","TIUSRVR3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,176,157**;Jun 20, 1997
"RTN","TIUSRVR3",3,0)
 ; Created 4/12/01 by splitting TIUSRVR2
"RTN","TIUSRVR3",4,0)
LOADSIG(DA,TIUL) ; Get signature and co-signature blocks
"RTN","TIUSRVR3",5,0)
 N DIC,DIQ,DR,TIUSIG,TIUESIG1,TIUESIG2,TIUSIG1,TIUSIG2,TIUS1,TIUS2
"RTN","TIUSRVR3",6,0)
 N TIUSNM,TIUSTTL,TIUS1DT,TIUS2DT,TIUSDT
"RTN","TIUSRVR3",7,0)
 Q:'$D(^TIU(8925,DA,15))
"RTN","TIUSRVR3",8,0)
 S DIC=8925,DIQ="TIUSIG(",DIQ(0)="IE",DR="1204;1208;1501:1505;1507:1513;1601:1605"
"RTN","TIUSRVR3",9,0)
 D EN^DIQ1 I '$D(TIUSIG) Q
"RTN","TIUSRVR3",10,0)
 S TIUS1=$S(TIUSIG(8925,DA,1505,"I")="E":"/es/ ",TIUSIG(8925,DA,1505,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1503,"E"))
"RTN","TIUSRVR3",11,0)
 S TIUS2=$S(TIUSIG(8925,DA,1511,"I")="E":"/es/ ",TIUSIG(8925,DA,1511,"I")="C":"/s/ ",1:"")_$G(TIUSIG(8925,DA,1509,"E"))
"RTN","TIUSRVR3",12,0)
 S TIUESIG1=$G(TIUSIG(8925,DA,1204,"I"))
"RTN","TIUSRVR3",13,0)
 S TIUSIG1=$G(TIUSIG(8925,DA,1502,"I"))
"RTN","TIUSRVR3",14,0)
 S TIUS1DT=$S(+$G(TIUSIG(8925,DA,1501,"I")):"Signed: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1501,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUSRVR3",15,0)
 S TIUESIG2=$G(TIUSIG(8925,DA,1208,"I"))
"RTN","TIUSRVR3",16,0)
 S TIUS2DT=$S(+$G(TIUSIG(8925,DA,1507,"I")):"Cosigned: "_$$DATE^TIULS($G(TIUSIG(8925,DA,1507,"I")),"MM/DD/CCYY HR:MIN"),1:"")
"RTN","TIUSRVR3",17,0)
 S TIUSIG2=$G(TIUSIG(8925,DA,1508,"I"))
"RTN","TIUSRVR3",18,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=" "
"RTN","TIUSRVR3",19,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUS1
"RTN","TIUSRVR3",20,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(TIUSIG(8925,DA,1504,"E"))
"RTN","TIUSRVR3",21,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUS1DT
"RTN","TIUSRVR3",22,0)
 I $G(TIUSIG(8925,DA,1505,"I"))="C" D
"RTN","TIUSRVR3",23,0)
 . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="Marked signed on chart by: "_$G(TIUSIG(8925,DA,1512,"E"))
"RTN","TIUSRVR3",24,0)
 I TIUSIG1]"",(TIUSIG1'=TIUESIG1) D LOADFOR(TIUSIG1,TIUESIG1,.TIUL)
"RTN","TIUSRVR3",25,0)
 I +$G(TIUSIG(8925,DA,1507,"I"))>0 D
"RTN","TIUSRVR3",26,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=" "
"RTN","TIUSRVR3",27,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUS2
"RTN","TIUSRVR3",28,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(TIUSIG(8925,DA,1510,"E"))
"RTN","TIUSRVR3",29,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUS2DT
"RTN","TIUSRVR3",30,0)
 . I $G(TIUSIG(8925,DA,1511,"I"))="C" D
"RTN","TIUSRVR3",31,0)
 . . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)="Marked cosigned on chart by: "_$G(TIUSIG(8925,DA,1513,"E"))
"RTN","TIUSRVR3",32,0)
 I TIUSIG2]"",(TIUSIG2'=TIUESIG2) D LOADFOR(TIUSIG2,TIUESIG2,.TIUL)
"RTN","TIUSRVR3",33,0)
XTRA I +$O(^TIU(8925.7,"B",DA,0)) D XTRASIG(DA,.TIUL)
"RTN","TIUSRVR3",34,0)
 I +$G(TIUSIG(8925,DA,1601,"I")) D
"RTN","TIUSRVR3",35,0)
 . N TIUMODE,TIUY
"RTN","TIUSRVR3",36,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR3",37,0)
 . S TIUY=$$DATE^TIULS(TIUSIG(8925,DA,1601,"I"),"MM/DD/CCYY HR:MIN")
"RTN","TIUSRVR3",38,0)
 . S TIUY=TIUY_"  AMENDMENT FILED:"
"RTN","TIUSRVR3",39,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUY
"RTN","TIUSRVR3",40,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR3",41,0)
 . S TIUMODE=$S(+$G(TIUSIG(8925,DA,1603,"I")):"/es/ ",1:" /s/ ")
"RTN","TIUSRVR3",42,0)
 . S TIUY=$S($G(TIUSIG(8925,DA,1604,"E"))]"":$G(TIUSIG(8925,DA,1604,"E")),1:$G(TIUSIG(8925,DA,1602,"E")))
"RTN","TIUSRVR3",43,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUMODE_TIUY
"RTN","TIUSRVR3",44,0)
 . I $L($G(TIUSIG(8925,DA,1605,"E"))) D
"RTN","TIUSRVR3",45,0)
 . . S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(TIUSIG(8925,DA,1605,"E"))
"RTN","TIUSRVR3",46,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$P($G(TIUPRM1),U,5)
"RTN","TIUSRVR3",47,0)
 Q
"RTN","TIUSRVR3",48,0)
XTRASIG(TIUDA,TIUL) ; Load additional signature blocks
"RTN","TIUSRVR3",49,0)
 N TIUI S TIUI=0
"RTN","TIUSRVR3",50,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR3",51,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)="Receipt Acknowledged By:"
"RTN","TIUSRVR3",52,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR3",53,0)
 . N DA,DIC,DR,DIQ,TIUX,TIUXTRA,TIUSGNR,TIUSDT
"RTN","TIUSRVR3",54,0)
 . S DIC="^TIU(8925.7,",DIQ="TIUXTRA",DA=TIUI,DR=".03:.08",DIQ(0)="IE"
"RTN","TIUSRVR3",55,0)
 . D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIUSRVR3",56,0)
 . S TIUSGNR=$S($L($G(TIUXTRA(8925.7,DA,.06,"E"))):"/es/ "_$G(TIUXTRA(8925.7,DA,.06,"E")),1:"     "_$G(TIUXTRA(8925.7,DA,.03,"E")))
"RTN","TIUSRVR3",57,0)
 . S TIUSDT=$S(+$G(TIUXTRA(8925.7,DA,.04,"I")):$$DATE^TIULS(TIUXTRA(8925.7,DA,.04,"I"),"MM/DD/CCYY HR:MIN"),1:"* AWAITING SIGNATURE *")
"RTN","TIUSRVR3",58,0)
 . S TIUX=""
"RTN","TIUSRVR3",59,0)
 . S TIUX=$$SETSTR^VALM1(TIUSDT,TIUX,1,38)
"RTN","TIUSRVR3",60,0)
 . S TIUX=$$SETSTR^VALM1(TIUSGNR,$G(TIUX),25,55)
"RTN","TIUSRVR3",61,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUX,TIUX=""
"RTN","TIUSRVR3",62,0)
 . S TIUX=$$SETSTR^VALM1($G(TIUXTRA(8925.7,DA,.07,"E")),$G(TIUX),30,50)
"RTN","TIUSRVR3",63,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUX
"RTN","TIUSRVR3",64,0)
 . I $G(TIUXTRA(8925.7,DA,.05,"I")),$G(TIUXTRA(8925.7,DA,.05,"I"))'=$G(TIUXTRA(8925.7,DA,.03,"I")) D
"RTN","TIUSRVR3",65,0)
 . . N TIUFOR
"RTN","TIUSRVR3",66,0)
 . . S TIUX=""
"RTN","TIUSRVR3",67,0)
 . . S TIUFOR="for "_$P($G(TIUXTRA(8925.7,DA,.03,"E")),",",2)_" "_$P($G(TIUXTRA(8925.7,DA,.03,"E")),",")
"RTN","TIUSRVR3",68,0)
 . . S TIUX=$$SETSTR^VALM1(TIUFOR,$G(TIUX),26,55)
"RTN","TIUSRVR3",69,0)
 . . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUX
"RTN","TIUSRVR3",70,0)
 Q
"RTN","TIUSRVR3",71,0)
LOADFOR(TIUS1,TIUES1,TIUL) ; Apply "for" block(s)
"RTN","TIUSRVR3",72,0)
 N TIUESN1,TIUEST1,TIUFORN,TIUFORT
"RTN","TIUSRVR3",73,0)
 S TIUESN1="for "_$$SIGNAME^TIULS(TIUES1),TIUEST1=$$SIGTITL^TIULS(TIUES1)
"RTN","TIUSRVR3",74,0)
 I +$G(TIUS1),($G(TIUS1)'=$G(TIUES1)) S TIUFORN=$$SETSTR^VALM1(TIUESN1,$G(TIUFORN),1,50),TIUFORT=$$SETSTR^VALM1(TIUEST1,$G(TIUFORT),1,50)
"RTN","TIUSRVR3",75,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUFORN
"RTN","TIUSRVR3",76,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUFORT
"RTN","TIUSRVR3",77,0)
 Q
"RTN","TIUTSK")
0^1^B20710718
"RTN","TIUTSK",1,0)
TIUTSK ; SLC/JER - TIU's Nightly Daemon ;4/18/03 [10/18/04 10:34am]
"RTN","TIUTSK",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,53,100,113,157**;Jun 20, 1997
"RTN","TIUTSK",3,0)
MAIN ; All records are read. DC date updated, Record purged, Alerts are 
"RTN","TIUTSK",4,0)
 ; generated if appropriate
"RTN","TIUTSK",5,0)
 N TIUDA,TIUPRM0,TIUPRM1,TIUDATE,TIUENTDT,TIUPDT,TIUODT
"RTN","TIUTSK",6,0)
 N TIUSTART,TIUEND
"RTN","TIUTSK",7,0)
 D SETPARM^TIULE
"RTN","TIUTSK",8,0)
 S TIUSTART=$$TSKPARM(1),TIUEND=$$TSKPARM(2)
"RTN","TIUTSK",9,0)
 ; Traverse "FIX" X-ref to fix temporary reference dates & back-fill
"RTN","TIUTSK",10,0)
 ; Discharge Dates
"RTN","TIUTSK",11,0)
 S TIUDA="" F  S TIUDA=$O(^TIU(8925,"FIX",1,TIUDA)) Q:TIUDA'>0  D
"RTN","TIUTSK",12,0)
 . D UPDDCDT(TIUDA) ;Ref Date fixed/DC Date updated if missing
"RTN","TIUTSK",13,0)
 ; Traverse "F" X-ref to identify records for which the grace period
"RTN","TIUTSK",14,0)
 ; for purge has expired
"RTN","TIUTSK",15,0)
 S TIUPDT=$$FMADD^XLFDT(DT,-$P(TIUPRM0,U,4))
"RTN","TIUTSK",16,0)
 S TIUODT=$$FMADD^XLFDT(DT,-$P(TIUPRM0,U,5))
"RTN","TIUTSK",17,0)
 S TIUENTDT=0
"RTN","TIUTSK",18,0)
 ; Traverse "F" X-ref to identify records overdue for signature or purge
"RTN","TIUTSK",19,0)
 ; NOTE: Following VHA Directive 10-92-077, the purge is disabled until
"RTN","TIUTSK",20,0)
 ;       further notice **53**
"RTN","TIUTSK",21,0)
 F  S TIUENTDT=$O(^TIU(8925,"F",TIUENTDT)) Q:+TIUENTDT'>0!(TIUENTDT>TIUODT)  D
"RTN","TIUTSK",22,0)
 . S TIUDA=0 F  S TIUDA=$O(^TIU(8925,"F",+TIUENTDT,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUTSK",23,0)
 . . ; I (TIUPDT<$$FMADD^XLFDT(DT,-90)),+$$PURGE^TIULC(TIUDA) D PURGE(TIUDA) Purges old records (see NOTE above) **53**
"RTN","TIUTSK",24,0)
 . . I +$$OVERDUE(TIUDA,TIUSTART,TIUEND) D SEND^TIUALRT(TIUDA,1) ;Alert for overdue
"RTN","TIUTSK",25,0)
 ; If upload buffer rec older than 30 days, delete it & its alerts
"RTN","TIUTSK",26,0)
 S TIUDA=0 F  S TIUDA=$O(^TIU(8925.2,TIUDA)) Q:TIUDA'>0  D
"RTN","TIUTSK",27,0)
 . N TIUDATE
"RTN","TIUTSK",28,0)
 . S TIUDATE=$P($G(^TIU(8925.2,TIUDA,0)),U,3)
"RTN","TIUTSK",29,0)
 . Q:+TIUDATE'>0
"RTN","TIUTSK",30,0)
 . I $$FMDIFF^XLFDT(DT,TIUDATE)>30 D
"RTN","TIUTSK",31,0)
 . . N TIUEI S TIUEI=0
"RTN","TIUTSK",32,0)
 . . ; JOEL, 12/21/00:
"RTN","TIUTSK",33,0)
 . . F  S TIUEI=$O(^TIU(8925.2,TIUDA,"ERR",TIUEI)) Q:+TIUEI'>0  D
"RTN","TIUTSK",34,0)
 . . . N TIUEDA
"RTN","TIUTSK",35,0)
 . . . S TIUEDA=+$G(^TIU(8925.2,TIUDA,"ERR",TIUEI,0)) Q:+TIUEDA'>0
"RTN","TIUTSK",36,0)
 . . . D ALERTDEL^TIUPEVNT(TIUEDA)
"RTN","TIUTSK",37,0)
 . . D BUFPURGE^TIUPUTC(TIUDA)
"RTN","TIUTSK",38,0)
 Q
"RTN","TIUTSK",39,0)
UPDDCDT(TIUDA) ; If missing DC date & Patient Movement file has DC date,
"RTN","TIUTSK",40,0)
 ;         DC date updated.
"RTN","TIUTSK",41,0)
 N DFN,DIE,DR,TIU,TIUDAD,TIUDDT,TIUD0,TIUD14,TIUDGPM
"RTN","TIUTSK",42,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD14=$G(^TIU(8925,+TIUDA,14))
"RTN","TIUTSK",43,0)
 S TIUDGPM=+$P(TIUD14,U)
"RTN","TIUTSK",44,0)
 I +$P($G(^DGPM(+TIUDGPM,0)),U,17)'>0 D  Q
"RTN","TIUTSK",45,0)
 . I +$P(TIUD0,U,12)>0 Q
"RTN","TIUTSK",46,0)
 . S DIE=8925,DR=".12////1",DA=TIUDA D ^DIE
"RTN","TIUTSK",47,0)
 I TIUD0'="",'+$P(TIUD0,U,6),(($P(TIUD0,U,8)="")!(+$P(TIUD0,U,12)>0)) D
"RTN","TIUTSK",48,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUTSK",49,0)
 . I +$G(TIU("LDT"))>0 D
"RTN","TIUTSK",50,0)
 . . S TIUDAD=$P(TIUD0,U,6)
"RTN","TIUTSK",51,0)
 . . D FIXDC(TIUDA,TIUDAD,DFN,.TIU)
"RTN","TIUTSK",52,0)
 Q
"RTN","TIUTSK",53,0)
PURGE(DA) ; When purge criteria met, document and addenda purged
"RTN","TIUTSK",54,0)
 N DR,DIE,TIUTYP,TIUDA,X,Y S TIUDA=0
"RTN","TIUTSK",55,0)
 F  S TIUDA=+$O(^TIU(8925,"DAD",+DA,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUTSK",56,0)
 . I +$$ISADDNDM^TIULC1(TIUDA) D PURGE(TIUDA) I 1
"RTN","TIUTSK",57,0)
 . E  D DIK^TIURB2(TIUDA) ; Remove components entirely. 1/3/01 updated DIK^TIURB to DIK^TIURB2 - Margy
"RTN","TIUTSK",58,0)
 S DIE=8925,DR=".05///PURGED;1609////"_$$NOW^TIULC_";2///@" D ^DIE
"RTN","TIUTSK",59,0)
 S ^TIU(8925,+DA,"TEXT",0)="^^"_2_U_2_U_DT_"^^"
"RTN","TIUTSK",60,0)
 S ^TIU(8925,+DA,"TEXT",1,0)=" "
"RTN","TIUTSK",61,0)
 S ^TIU(8925,+DA,"TEXT",2,0)="  Document Purged on "_$$DATE^TIULS(DT,"MM/DD/YY")_"."
"RTN","TIUTSK",62,0)
 Q
"RTN","TIUTSK",63,0)
FIXDC(DA,PARENT,DFN,TIU) ; Stuff fixed field data
"RTN","TIUTSK",64,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG
"RTN","TIUTSK",65,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUTSK",66,0)
 I +$G(PARENT)'>0 D
"RTN","TIUTSK",67,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U)
"RTN","TIUTSK",68,0)
 . S @FDARR@(1402)=$P($G(TIU("TS")),U)
"RTN","TIUTSK",69,0)
 I +$G(PARENT)>0 D
"RTN","TIUTSK",70,0)
 . S @FDARR@(.08)=$P(TIU("LDT"),U)
"RTN","TIUTSK",71,0)
 . S @FDARR@(1401)=$P(^TIU(8925,+PARENT,14),U)
"RTN","TIUTSK",72,0)
 . S @FDARR@(1402)=$P(^TIU(8925,+PARENT,14),U,2)
"RTN","TIUTSK",73,0)
 S @FDARR@(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUTSK",74,0)
 S @FDARR@(1212)=$P($G(TIU("INST")),U)
"RTN","TIUTSK",75,0)
 S @FDARR@(.12)="@"
"RTN","TIUTSK",76,0)
 S @FDARR@(1301)=+$G(TIU("LDT"))
"RTN","TIUTSK",77,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUTSK",78,0)
 Q
"RTN","TIUTSK",79,0)
OVERDUE(TIUDA,TIUSTART,TIUEND) ;Checks whether or not a given document is overdue
"RTN","TIUTSK",80,0)
 ;This is the same as OVERDUE^TIULC exept for the following items:
"RTN","TIUTSK",81,0)
 ;    TIUPRM0 must be defined before calling
"RTN","TIUTSK",82,0)
 ;    also checks for additional signatures overdue
"RTN","TIUTSK",83,0)
 N TIUD0,TIUDATE,TIUY,TIUDPRM,TIUXTRA S TIUY=0,TIUD0=$G(^TIU(8925,TIUDA,0)),TIUXTRA=0
"RTN","TIUTSK",84,0)
 D DOCPRM^TIULC1(+TIUD0,.TIUDPRM,TIUDA)
"RTN","TIUTSK",85,0)
 I '$D(TIUDPRM) G OVERX
"RTN","TIUTSK",86,0)
 S TIUDATE=$S($$REQVER^TIULC(TIUDA,+$P(TIUDPRM(0),U,3)):$P($G(^TIU(8925,+TIUDA,13)),U,5),$P(TIUDPRM(0),U,2):$P($G(^TIU(8925,+TIUDA,13)),U,4),1:$P($G(^TIU(8925,+TIUDA,12)),U))
"RTN","TIUTSK",87,0)
 G:+TIUDATE'>0 OVERX
"RTN","TIUTSK",88,0)
 I $$FMDIFF^XLFDT(DT,TIUDATE)>$P(TIUPRM0,U,5),(+$P($G(^TIU(8925,+TIUDA,0)),U,5)>4),(+$P($G(^TIU(8925,+TIUDA,0)),U,5)<7) S TIUY=1 G OVERX
"RTN","TIUTSK",89,0)
 F  S TIUXTRA=$O(^TIU(8925.7,"B",TIUDA,TIUXTRA)) Q:'TIUXTRA  D
"RTN","TIUTSK",90,0)
 . I TIUDATE<$G(TIUSTART)!(TIUDATE>$G(TIUEND)) Q
"RTN","TIUTSK",91,0)
 . I '$$TSKPARM^TIUTSK(1) Q
"RTN","TIUTSK",92,0)
 . I $$FMDIFF^XLFDT(DT,TIUDATE)>$P(TIUPRM0,U,5),('$P($G(^TIU(8925.7,TIUXTRA,0)),U,4)) S TIUY=1
"RTN","TIUTSK",93,0)
OVERX Q TIUY
"RTN","TIUTSK",94,0)
TSKPARM(TIUDA) ;Calculate a tiu parameter for the nightly task
"RTN","TIUTSK",95,0)
 ; TIUDA = 1 then return NIGHTLY TASK START computation
"RTN","TIUTSK",96,0)
 ; TIUDA = 2 then return NIGHTLY TASK END computation
"RTN","TIUTSK",97,0)
 N TIUDIV,TIUPARM,TIUY,TIUVAL
"RTN","TIUTSK",98,0)
 S TIUY=0
"RTN","TIUTSK",99,0)
 I TIUDA=2 S TIUY=DT
"RTN","TIUTSK",100,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUTSK",101,0)
 I '$G(TIUPRM0) Q TIUY
"RTN","TIUTSK",102,0)
 S TIUDIV=$P(TIUPRM0,U,1)
"RTN","TIUTSK",103,0)
 I '$G(TIUDIV) Q TIUY
"RTN","TIUTSK",104,0)
 S TIUPARM=$O(^TIU(8925.99,"B",TIUDIV,""))
"RTN","TIUTSK",105,0)
 I '$G(TIUPARM) Q TIUY
"RTN","TIUTSK",106,0)
 S TIUVAL=$P($G(^TIU(8925.99,TIUPARM,3)),U,TIUDA)
"RTN","TIUTSK",107,0)
 I '$G(TIUVAL) Q TIUY
"RTN","TIUTSK",108,0)
 D DT^DILF("P","T-"_TIUVAL,.TIUY)
"RTN","TIUTSK",109,0)
 Q TIUY
"SEC","^DIC",8925.7,8925.7,0,"AUDIT")
@
"SEC","^DIC",8925.7,8925.7,0,"DD")
@
"SEC","^DIC",8925.99,8925.99,0,"AUDIT")
@
"SEC","^DIC",8925.99,8925.99,0,"DD")
@
"SEC","^DIC",8925.99,8925.99,0,"DEL")
@
"SEC","^DIC",8925.99,8925.99,0,"LAYGO")
@
"SEC","^DIC",8925.99,8925.99,0,"RD")
@
"SEC","^DIC",8925.99,8925.99,0,"WR")
@
"VER")
8.0^22.0
"^DD",8925.7,8925.7,0)
FIELD^^.08^8
"^DD",8925.7,8925.7,0,"DDA")
N
"^DD",8925.7,8925.7,0,"DT")
3000127
"^DD",8925.7,8925.7,0,"ID",.03)
S %I=Y,Y=$S('$D(^(0)):"",$D(^VA(200,+$P(^(0),U,3),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(200,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",8925.7,8925.7,0,"IX","AE",8925.7,.01)

"^DD",8925.7,8925.7,0,"IX","AE1",8925.7,.03)

"^DD",8925.7,8925.7,0,"IX","B",8925.7,.01)

"^DD",8925.7,8925.7,0,"NM","TIU MULTIPLE SIGNATURE")

"^DD",8925.7,8925.7,0,"VRPK")
TIU
"^DD",8925.7,8925.7,.01,0)
TIU DOCUMENT NUMBER^RP8925'^TIU(8925,^0;1^Q
"^DD",8925.7,8925.7,.01,1,0)
^.1
"^DD",8925.7,8925.7,.01,1,1,0)
8925.7^B
"^DD",8925.7,8925.7,.01,1,1,1)
S ^TIU(8925.7,"B",$E(X,1,30),DA)=""
"^DD",8925.7,8925.7,.01,1,1,2)
K ^TIU(8925.7,"B",$E(X,1,30),DA)
"^DD",8925.7,8925.7,.01,1,2,0)
8925.7^AE^MUMPS
"^DD",8925.7,8925.7,.01,1,2,1)
I $L($P(^TIU(8925.7,+DA,0),U,3)) S ^TIU(8925.7,"AE",+X,+$P(^TIU(8925.7,+DA,0),U,3),DA)=""
"^DD",8925.7,8925.7,.01,1,2,2)
I $L($P(^TIU(8925.7,+DA,0),U,3)) K ^TIU(8925.7,"AE",+X,+$P(^TIU(8925.7,+DA,0),U,3),DA)
"^DD",8925.7,8925.7,.01,1,2,"%D",0)
^^2^2^2961127^^
"^DD",8925.7,8925.7,.01,1,2,"%D",1,0)
This multi-field, MUMPS-type cross-reference by document and expected
"^DD",8925.7,8925.7,.01,1,2,"%D",2,0)
cosigner facilitates the identification of privilege to sign the document.
"^DD",8925.7,8925.7,.01,1,2,"DT")
2960610
"^DD",8925.7,8925.7,.01,3)
Please select the document for which this cosignature is expected.
"^DD",8925.7,8925.7,.01,21,0)
^^1^1^2940321^
"^DD",8925.7,8925.7,.01,21,1,0)
This is the record number in the TIU DOCUMENT FILE (#8925).
"^DD",8925.7,8925.7,.01,"DT")
3041105
"^DD",8925.7,8925.7,.02,0)
COSIGNATURE NEEDED^S^1:YES;0:NO;^0;2^Q
"^DD",8925.7,8925.7,.02,3)
Please indicate whether the cosignature is required.
"^DD",8925.7,8925.7,.02,"DT")
2940418
"^DD",8925.7,8925.7,.03,0)
EXPECTED SIGNER^*P200'^VA(200,^0;3^S DIC("S")="I +$$SCREEN^TIURA1(+$G(^TIU(8925.7,DA,0)),+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",8925.7,8925.7,.03,1,0)
^.1^^-1
"^DD",8925.7,8925.7,.03,1,1,0)
8925.7^AE1^MUMPS
"^DD",8925.7,8925.7,.03,1,1,1)
I $L($P(^TIU(8925.7,+DA,0),U)) S ^TIU(8925.7,"AE",+$P(^TIU(8925.7,+DA,0),U),+X,DA)=""
"^DD",8925.7,8925.7,.03,1,1,2)
I $L($P(^TIU(8925.7,+DA,0),U)) K ^TIU(8925.7,"AE",+$P(^TIU(8925.7,+DA,0),U),+X,DA)
"^DD",8925.7,8925.7,.03,1,1,"%D",0)
^^2^2^2961127^^
"^DD",8925.7,8925.7,.03,1,1,"%D",1,0)
This multi-field, MUMPS-type cross-reference by document and expected
"^DD",8925.7,8925.7,.03,1,1,"%D",2,0)
cosigner facilitates the identification of privilege to sign the document.
"^DD",8925.7,8925.7,.03,1,1,"DT")
2960610
"^DD",8925.7,8925.7,.03,3)
Enter the person whom you expect to sign.
"^DD",8925.7,8925.7,.03,12)
Certain persons shouldn't be selected.
"^DD",8925.7,8925.7,.03,12.1)
S DIC("S")="I +$$SCREEN^TIURA1(+$G(^TIU(8925.7,DA,0)),+Y)"
"^DD",8925.7,8925.7,.03,21,0)
^^1^1^2961127^
"^DD",8925.7,8925.7,.03,21,1,0)
This is the person who the author expects to sign the document.
"^DD",8925.7,8925.7,.03,"DT")
3041215
"^DD",8925.7,8925.7,.04,0)
COSIGNATURE DATE/TIME^D^^0;4^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",8925.7,8925.7,.04,3)
Please enter the date/time of cosignature
"^DD",8925.7,8925.7,.04,21,0)
^^1^1^2940322^
"^DD",8925.7,8925.7,.04,21,1,0)
This is the date/time at which the cosignature was obtained.
"^DD",8925.7,8925.7,.04,"DT")
3041105
"^DD",8925.7,8925.7,.05,0)
ACTUAL COSIGNER^P200'^VA(200,^0;5^Q
"^DD",8925.7,8925.7,.05,3)
Please indicate the user who actually cosigned the document.
"^DD",8925.7,8925.7,.05,"DT")
2940322
"^DD",8925.7,8925.7,.06,0)
COSIGNER'S SIGNATURE BLOCK^F^^0;6^K:$L(X)>60!($L(X)<3) X
"^DD",8925.7,8925.7,.06,3)
Answer must be 3-60 characters in length
"^DD",8925.7,8925.7,.06,"DT")
3000126
"^DD",8925.7,8925.7,.07,0)
COSIGNER'S TITLE^F^^0;7^K:$L(X)>60!($L(X)<2) X
"^DD",8925.7,8925.7,.07,3)
Answer must be 2-60 characters in length
"^DD",8925.7,8925.7,.07,"DT")
3000126
"^DD",8925.7,8925.7,.08,0)
COSIGNATURE MODE^S^E:electronic;C:chart;^0;8^Q
"^DD",8925.7,8925.7,.08,3)
Please indicate the method by which cosignature was obtained.
"^DD",8925.7,8925.7,.08,"DT")
2940322
"^DD",8925.99,8925.99,0)
FIELD^^3.2^25
"^DD",8925.99,8925.99,0,"DT")
3040831
"^DD",8925.99,8925.99,0,"IX","B",8925.99,.01)

"^DD",8925.99,8925.99,0,"NM","TIU PARAMETERS")

"^DD",8925.99,8925.99,0,"VRPK")
TIU
"^DD",8925.99,8925.99,.01,0)
INSTITUTION^RP4'^DIC(4,^0;1^Q
"^DD",8925.99,8925.99,.01,1,0)
^.1
"^DD",8925.99,8925.99,.01,1,1,0)
8925.99^B
"^DD",8925.99,8925.99,.01,1,1,1)
S ^TIU(8925.99,"B",$E(X,1,30),DA)=""
"^DD",8925.99,8925.99,.01,1,1,2)
K ^TIU(8925.99,"B",$E(X,1,30),DA)
"^DD",8925.99,8925.99,.01,3)
Enter your Institution.
"^DD",8925.99,8925.99,.01,21,0)
^^1^1^2990624^
"^DD",8925.99,8925.99,.01,21,1,0)
Please enter the DIVISION these parameters apply to.
"^DD",8925.99,8925.99,.01,"AUDIT")

"^DD",8925.99,8925.99,.01,"DT")
3050125
"^DD",8925.99,8925.99,.02,0)
ENABLE ELECTRONIC SIGNATURE^S^1:YES;0:NO;^0;2^Q
"^DD",8925.99,8925.99,.02,3)

"^DD",8925.99,8925.99,.02,21,0)
^^4^4^2990712^
"^DD",8925.99,8925.99,.02,21,1,0)
Electronic signature is enabled when this parameter is set to 1. Until
"^DD",8925.99,8925.99,.02,21,2,0)
such time as electronic signature is enabled, signatures are to be written
"^DD",8925.99,8925.99,.02,21,3,0)
on the chart copy of the TIU document, and provision must be made for TIU
"^DD",8925.99,8925.99,.02,21,4,0)
documents to be marked Signed on Chart.
"^DD",8925.99,8925.99,.02,"AUDIT")

"^DD",8925.99,8925.99,.02,"DT")
3050125
"^DD",8925.99,8925.99,.03,0)
CHARACTERS PER LINE^NJ2,0^^0;3^K:+X'=X!(X>80)!(X<10)!(X?.E1"."1N.N) X
"^DD",8925.99,8925.99,.03,3)
Enter the number of characters per line, for line count computation (a # from 10 to 80).
"^DD",8925.99,8925.99,.03,21,0)
^^5^5^2990624^
"^DD",8925.99,8925.99,.03,21,1,0)
This value (default 60) is divided into the total number of 'actual'
"^DD",8925.99,8925.99,.03,21,2,0)
characters in a given transcribed document to derive the line count for
"^DD",8925.99,8925.99,.03,21,3,0)
that document.  By 'actual' characters, we mean all printable ASCII
"^DD",8925.99,8925.99,.03,21,4,0)
characters, with multiple white space characters stripped. This prevents
"^DD",8925.99,8925.99,.03,21,5,0)
transcriptionists from "stuffing" line counts by adding white space.
"^DD",8925.99,8925.99,.03,"AUDIT")

"^DD",8925.99,8925.99,.03,"DT")
3050125
"^DD",8925.99,8925.99,.04,0)
GRACE PERIOD FOR PURGE^NJ4,0^^0;4^K:+X'=X!(X>7300)!(X<90)!(X?.E1"."1N.N) X
"^DD",8925.99,8925.99,.04,3)
Type a Number between 90 and 7300, 0 Decimal Digits
"^DD",8925.99,8925.99,.04,21,0)
^^9^9^2991020^
"^DD",8925.99,8925.99,.04,21,1,0)
OUT OF SERVICE.  Purging is disabled.
"^DD",8925.99,8925.99,.04,21,2,0)
 
"^DD",8925.99,8925.99,.04,21,3,0)
This is the number of days following transcription for which a document
"^DD",8925.99,8925.99,.04,21,4,0)
will be kept, prior to purge. Allowable range is from 90 to 7300 days (20
"^DD",8925.99,8925.99,.04,21,5,0)
years).
"^DD",8925.99,8925.99,.04,21,6,0)
 
"^DD",8925.99,8925.99,.04,21,7,0)
NOTE: Progress Notes and their addenda are not subject to purge,
"^DD",8925.99,8925.99,.04,21,8,0)
regardless of this parameter. IF YOU WANT TO DISABLE PURGING ALTOGETHER,
"^DD",8925.99,8925.99,.04,21,9,0)
LEAVE THIS PARAMETER EMPTY (or delete any existing value).
"^DD",8925.99,8925.99,.04,"AUDIT")

"^DD",8925.99,8925.99,.04,"DT")
3050125
"^DD",8925.99,8925.99,.05,0)
GRACE PERIOD FOR SIGNATURE^NJ2,0^^0;5^K:+X'=X!(X>10)!(X<1)!(X?.E1"."1N.N) X
"^DD",8925.99,8925.99,.05,3)
Enter the number of days to wait before notifying physician of an overdue signature (1 to 10 days).
"^DD",8925.99,8925.99,.05,21,0)
^^3^3^2990712^
"^DD",8925.99,8925.99,.05,21,1,0)
This is the number of days following transcription before an author or
"^DD",8925.99,8925.99,.05,21,2,0)
Attending Physician is notified of a deficiency.  If no grace period is
"^DD",8925.99,8925.99,.05,21,3,0)
entered, clinicians are not notified of overdue signatures.
"^DD",8925.99,8925.99,.05,"AUDIT")

"^DD",8925.99,8925.99,.05,"DT")
3050125
"^DD",8925.99,8925.99,.06,0)
OPTIMIZE LIST BUILDING FOR^S^P:performance;S:security;^0;6^Q
"^DD",8925.99,8925.99,.06,3)
Please indicate whether Performance or Security should be optimized.
"^DD",8925.99,8925.99,.06,21,0)
^^18^18^2990712^
"^DD",8925.99,8925.99,.06,21,1,0)
This parameter determines whether or not TIU list building functions
"^DD",8925.99,8925.99,.06,21,2,0)
invoke business rules, excluding from the list any documents the user is
"^DD",8925.99,8925.99,.06,21,3,0)
not authorized to see.  Checking business rules in this way optimizes
"^DD",8925.99,8925.99,.06,21,4,0)
list building for security.  It may be costly in terms of performance.
"^DD",8925.99,8925.99,.06,21,5,0)
 
"^DD",8925.99,8925.99,.06,21,6,0)
When optimized for performance (the default behavior of TIU), business
"^DD",8925.99,8925.99,.06,21,7,0)
rules excluding notes from view are bypassed when building lists of
"^DD",8925.99,8925.99,.06,21,8,0)
documents.
"^DD",8925.99,8925.99,.06,21,9,0)
 
"^DD",8925.99,8925.99,.06,21,10,0)
NOTE: This applies only to lists: when an unauthorized user attempts to
"^DD",8925.99,8925.99,.06,21,11,0)
view the contents of a document from the resulting list, he is prevented
"^DD",8925.99,8925.99,.06,21,12,0)
from doing so, with the following explanation:
"^DD",8925.99,8925.99,.06,21,13,0)
 
"^DD",8925.99,8925.99,.06,21,14,0)
Reviewing Item #1
"^DD",8925.99,8925.99,.06,21,15,0)
 
"^DD",8925.99,8925.99,.06,21,16,0)
 You may not VIEW this UNSIGNED NURSE'S NOTE.
"^DD",8925.99,8925.99,.06,21,17,0)
 
"^DD",8925.99,8925.99,.06,21,18,0)
RETURN to continue...
"^DD",8925.99,8925.99,.06,"AUDIT")

"^DD",8925.99,8925.99,.06,"DT")
3050125
"^DD",8925.99,8925.99,.07,0)
SUPPRESS REVIEW NOTES PROMPT^S^1:YES;0:NO;^0;7^Q
"^DD",8925.99,8925.99,.07,3)
Indicate whether to suppress the Review Notes prompt on entry
"^DD",8925.99,8925.99,.07,21,0)
^^5^5^2990712^
"^DD",8925.99,8925.99,.07,21,1,0)
Applies to Progress Notes only.  When this parameter is set to YES, TIU
"^DD",8925.99,8925.99,.07,21,2,0)
suppresses the prompt which asks if the user wishes to see available
"^DD",8925.99,8925.99,.07,21,3,0)
progress notes before entering a new note.  This parameter is overridden
"^DD",8925.99,8925.99,.07,21,4,0)
by the Personal Preference of same name.  If neither parameter is entered,
"^DD",8925.99,8925.99,.07,21,5,0)
the Review Notes prompt is NOT suppressed.
"^DD",8925.99,8925.99,.07,"DT")
2970320
"^DD",8925.99,8925.99,.08,0)
DEFAULT PRIMARY PROVIDER^S^0:NONE, DON'T PROMPT;1:DEFAULT, BY LOCATION;2:AUTHOR (IF PROVIDER);^0;8^Q
"^DD",8925.99,8925.99,.08,3)
Please indicate the source of the default for Primary Provider.
"^DD",8925.99,8925.99,.08,21,0)
^^9^9^2990713^
"^DD",8925.99,8925.99,.08,21,1,0)
This parameter determines the behavior of the Primary Provider prompt for
"^DD",8925.99,8925.99,.08,21,2,0)
a standalone encounter.
"^DD",8925.99,8925.99,.08,21,3,0)
 
"^DD",8925.99,8925.99,.08,21,4,0)
If the parameter has no value, the prompt has no default. If the parameter
"^DD",8925.99,8925.99,.08,21,5,0)
has value 0, the user is not prompted for primary provider. If the
"^DD",8925.99,8925.99,.08,21,6,0)
parameter has value 1, the default for the Primary Provider prompt is the
"^DD",8925.99,8925.99,.08,21,7,0)
site's default provider for the given location.  If the parameter has
"^DD",8925.99,8925.99,.08,21,8,0)
value 2, the default is the author if the author is a provider; if the
"^DD",8925.99,8925.99,.08,21,9,0)
author is not a provider, the prompt has no default.
"^DD",8925.99,8925.99,.08,"DT")
2980731
"^DD",8925.99,8925.99,.09,0)
ASCII UPLOAD SOURCE^S^H:host file server;R:remote computer;^0;9^Q
"^DD",8925.99,8925.99,.09,3)
Please specify the source of the ASCII data to be uploaded.
"^DD",8925.99,8925.99,.09,21,0)
^^6^6^2990712^
"^DD",8925.99,8925.99,.09,21,1,0)
Applies only when the ASCII upload protocol is used. This field specifies
"^DD",8925.99,8925.99,.09,21,2,0)
the source from which documents are uploaded. (H)ost indicates to the
"^DD",8925.99,8925.99,.09,21,3,0)
upload processor that the source of the data is an ASCII host file (VMS or
"^DD",8925.99,8925.99,.09,21,4,0)
DOS), while (R)emote indicates that the data is read from an ASCII stream
"^DD",8925.99,8925.99,.09,21,5,0)
coming to VISTA from a terminal emulator on a remote computer (for
"^DD",8925.99,8925.99,.09,21,6,0)
example, an IBM PC or compatible, or an Apple Macintosh).
"^DD",8925.99,8925.99,.09,"DT")
2920911
"^DD",8925.99,8925.99,.1,0)
RECORD HEADER SIGNAL^F^^0;10^K:$L(X)>10!($L(X)<1) X
"^DD",8925.99,8925.99,.1,3)
Enter 1-10 characters to distinguish a record's header from its report text.
"^DD",8925.99,8925.99,.1,21,0)
^^8^8^2990712^
"^DD",8925.99,8925.99,.1,21,1,0)
This is a free text tag or signal used by the upload process to determine
"^DD",8925.99,8925.99,.1,21,2,0)
that a new document record header has been encountered.  It may be as
"^DD",8925.99,8925.99,.1,21,3,0)
simple as the three-character string "MSH" or as complex as "HEADERBEGIN".
"^DD",8925.99,8925.99,.1,21,4,0)
The signal "@@@", used by the Surgery Package option to transmit operative
"^DD",8925.99,8925.99,.1,21,5,0)
notes, is another possibility.
"^DD",8925.99,8925.99,.1,21,6,0)
 
"^DD",8925.99,8925.99,.1,21,7,0)
NOTE: Although you may define this parameter independently for each
"^DD",8925.99,8925.99,.1,21,8,0)
DIVISION, we recommend that you choose just one such signal per site.
"^DD",8925.99,8925.99,.1,"DT")
2930211
"^DD",8925.99,8925.99,.11,0)
END OF MESSAGE SIGNAL^F^^0;11^K:$L(X)>10!($L(X)<3) X
"^DD",8925.99,8925.99,.11,3)
Enter 3-10 characters to signal end of upload message.
"^DD",8925.99,8925.99,.11,21,0)
^^3^3^2990712^
"^DD",8925.99,8925.99,.11,21,1,0)
Applies only to transfers made using the ASCII protocol.  This is the free
"^DD",8925.99,8925.99,.11,21,2,0)
text signal to the upload process that the entire file/stream has been
"^DD",8925.99,8925.99,.11,21,3,0)
transmitted without difficulty, and no more lines of data need to be read.
"^DD",8925.99,8925.99,.11,"DT")
2921019
"^DD",8925.99,8925.99,.12,0)
BEGIN REPORT TEXT SIGNAL^F^^0;12^K:$L(X)>10!($L(X)<1) X
"^DD",8925.99,8925.99,.12,3)
Enter 1-10 characters to delimit report text from record header.
"^DD",8925.99,8925.99,.12,21,0)
^^3^3^2921020^^
"^DD",8925.99,8925.99,.12,21,1,0)
This is the signal to the upload processor that the fixed-field header for
"^DD",8925.99,8925.99,.12,21,2,0)
a given report record has been fully read, and that the body of the
"^DD",8925.99,8925.99,.12,21,3,0)
narrative report follows.
"^DD",8925.99,8925.99,.12,"DT")
2921019
"^DD",8925.99,8925.99,.13,0)
MAJOR DELIMITER^F^^0;13^K:$L(X)>1!($L(X)<1)!'(X?1P) X
"^DD",8925.99,8925.99,.13,3)
Enter the major delimiter of the message header.
"^DD",8925.99,8925.99,.13,21,0)
^^4^4^2990712^
"^DD",8925.99,8925.99,.13,21,1,0)
This ASCII character separates the various pieces of fixed-field
"^DD",8925.99,8925.99,.13,21,2,0)
information in the message header. Please avoid using delimiters such as
"^DD",8925.99,8925.99,.13,21,3,0)
",", or ":", which may be contained within the data itself, using instead
"^DD",8925.99,8925.99,.13,21,4,0)
less common symbols such as "|", "\" or "~".
"^DD",8925.99,8925.99,.13,"DT")
2921020
"^DD",8925.99,8925.99,.14,0)
FUTURE APPOINTMENT RANGE^NJ3,0^^0;14^K:+X'=X!(X>180)!(X<1)!(X?.E1"."1N.N) X
"^DD",8925.99,8925.99,.14,3)
How many days in advance may future appointments be selected?
"^DD",8925.99,8925.99,.14,21,0)
^^4^4^2990628^
"^DD",8925.99,8925.99,.14,21,1,0)
This parameter determines how far in advance a future appointment may
"^DD",8925.99,8925.99,.14,21,2,0)
be selected when entering a document for outpatient care.
"^DD",8925.99,8925.99,.14,21,3,0)
 
"^DD",8925.99,8925.99,.14,21,4,0)
Allowable values range from 1 to 180 days, defaulting to 1 day.
"^DD",8925.99,8925.99,.14,"DT")
2981014
"^DD",8925.99,8925.99,.15,0)
PACE CHARACTER^FX^^0;15^K:$L(X)>3!($L(X)<1) X S:X'?1.3N X=$A(X)
"^DD",8925.99,8925.99,.15,3)
Enter the character used to prompt the remote for another line of text.
"^DD",8925.99,8925.99,.15,21,0)
^^13^13^2990712^
"^DD",8925.99,8925.99,.15,21,1,0)
Applies only to transfers which use the ASCII protocol.
"^DD",8925.99,8925.99,.15,21,2,0)
 
"^DD",8925.99,8925.99,.15,21,3,0)
This is the ASCII value of the character which VISTA sends to the remote
"^DD",8925.99,8925.99,.15,21,4,0)
computer to acknowledge receipt of the previous text line and to prompt
"^DD",8925.99,8925.99,.15,21,5,0)
the remote to transmit another line. You may choose any character with an
"^DD",8925.99,8925.99,.15,21,6,0)
ASCII value between 1 and 126.
"^DD",8925.99,8925.99,.15,21,7,0)
 
"^DD",8925.99,8925.99,.15,21,8,0)
If you are using the same remote to upload both MailMan messages and
"^DD",8925.99,8925.99,.15,21,9,0)
textual reports, then we recommend using the ">" symbol, ASCII 62.
"^DD",8925.99,8925.99,.15,21,10,0)
Otherwise, we suggest using the ACK character (ASCII 6).
"^DD",8925.99,8925.99,.15,21,11,0)
 
"^DD",8925.99,8925.99,.15,21,12,0)
NOTE: you may need to specify the same character as part of the ASCII
"^DD",8925.99,8925.99,.15,21,13,0)
PROTOCOL parameters of the terminal emulation software on the remote.
"^DD",8925.99,8925.99,.15,"DT")
2921020
"^DD",8925.99,8925.99,.16,0)
UPLOAD HEADER FORMAT^S^C:captioned;D:delimited string;^0;16^Q
"^DD",8925.99,8925.99,.16,3)
Enter the preferred format to be used for ASCII record headers.
"^DD",8925.99,8925.99,.16,21,0)
^^2^2^2990712^
"^DD",8925.99,8925.99,.16,21,1,0)
This field determines whether the upload filer expects delimited string or
"^DD",8925.99,8925.99,.16,21,2,0)
captioned formats for the header of each document.
"^DD",8925.99,8925.99,.16,"DT")
2930408
"^DD",8925.99,8925.99,.17,0)
UPLOAD PROTOCOL^S^a:ASCII;k:KERMIT;^0;17^Q
"^DD",8925.99,8925.99,.17,3)
Select preferred upload protocol
"^DD",8925.99,8925.99,.17,21,0)
^^2^2^2990712^
"^DD",8925.99,8925.99,.17,21,1,0)
This is the upload protocol used to transmit documents,
"^DD",8925.99,8925.99,.17,21,2,0)
with a for ASCII, or k for KERMIT.
"^DD",8925.99,8925.99,.17,"DT")
2930227
"^DD",8925.99,8925.99,.18,0)
RUN UPLOAD FILER IN FOREGROUND^S^1:YES;0:NO;^0;18^Q
"^DD",8925.99,8925.99,.18,3)
Indicate whether the upload filer should run interactively.
"^DD",8925.99,8925.99,.18,21,0)
^^4^4^2990628^
"^DD",8925.99,8925.99,.18,21,1,0)
This parameter specifies whether to run the filer for the upload process
"^DD",8925.99,8925.99,.18,21,2,0)
in the foreground or in the background (as a Task).
"^DD",8925.99,8925.99,.18,21,3,0)
 
"^DD",8925.99,8925.99,.18,21,4,0)
If no preference is specified, the filer runs in the BACKGROUND.
"^DD",8925.99,8925.99,.18,"DT")
2960327
"^DD",8925.99,8925.99,.22,0)
ENABLE CHART COPY PROMPT^S^1:YES;0:NO;^0;22^Q
"^DD",8925.99,8925.99,.22,3)

"^DD",8925.99,8925.99,.22,21,0)
^^1^1^2990712^
"^DD",8925.99,8925.99,.22,21,1,0)
OUT OF SERVICE.  See TIU Document Parameter ALLOW CHART PRINT OUTSIDE MAS.
"^DD",8925.99,8925.99,.22,"DT")
2930811
"^DD",8925.99,8925.99,1.05,0)
AMENDMENT SIGNATURE BLOCK^F^^1;5^K:$L(X)>80!($L(X)<3) X
"^DD",8925.99,8925.99,1.05,3)
Enter the Privacy Act Officer's signature block.
"^DD",8925.99,8925.99,1.05,21,0)
^^20^20^2990712^
"^DD",8925.99,8925.99,1.05,21,1,0)
OUT OF SERVICE.  The signer's normal signature block is used for
"^DD",8925.99,8925.99,1.05,21,2,0)
amendments.
"^DD",8925.99,8925.99,1.05,21,3,0)
 
"^DD",8925.99,8925.99,1.05,21,4,0)
This parameter allows the site to specify the format of the signature
"^DD",8925.99,8925.99,1.05,21,5,0)
block for an amendment. 
"^DD",8925.99,8925.99,1.05,21,6,0)
 
"^DD",8925.99,8925.99,1.05,21,7,0)
While Business Rules determine who may amend documents, generally it is
"^DD",8925.99,8925.99,1.05,21,8,0)
the user class CHIEF,MIS who may do so. If this user is not the site's
"^DD",8925.99,8925.99,1.05,21,9,0)
Privacy Act officer, then it may be desirable to enter a statement
"^DD",8925.99,8925.99,1.05,21,10,0)
indicating that the user is signing on behalf of the Privacy Act Officer.
"^DD",8925.99,8925.99,1.05,21,11,0)
 
"^DD",8925.99,8925.99,1.05,21,12,0)
For example, if the user's name is John Smith, while the site's Privacy
"^DD",8925.99,8925.99,1.05,21,13,0)
Act Officer is Jane Doe, RRT, then the AMENDMENT SIGNATURE BLOCK might be
"^DD",8925.99,8925.99,1.05,21,14,0)
entered as: "for Jane Doe, RRT, PRIVACY ACT OFFICER".
"^DD",8925.99,8925.99,1.05,21,15,0)
 
"^DD",8925.99,8925.99,1.05,21,16,0)
The amendment information on the document would then appear as:
"^DD",8925.99,8925.99,1.05,21,17,0)
 
"^DD",8925.99,8925.99,1.05,21,18,0)
            AMENDED 10/26/92
"^DD",8925.99,8925.99,1.05,21,19,0)
            /es/ JOHN SMITH
"^DD",8925.99,8925.99,1.05,21,20,0)
            for Jane Doe, RRT, PRIVACY ACT OFFICER
"^DD",8925.99,8925.99,1.05,"DT")
2921026
"^DD",8925.99,8925.99,1.06,0)
BLANK CHARACTER STRING^F^^1;6^K:$L(X)>3!($L(X)<3) X
"^DD",8925.99,8925.99,1.06,3)
Answer must be 3 characters in length.
"^DD",8925.99,8925.99,1.06,21,0)
^^3^3^2990628^
"^DD",8925.99,8925.99,1.06,21,1,0)
This string of characters is used by the transcriptionist to represent a
"^DD",8925.99,8925.99,1.06,21,2,0)
"blank" when a word or phrase in the dictation cannot be understood for
"^DD",8925.99,8925.99,1.06,21,3,0)
inclusion in the transcription.
"^DD",8925.99,8925.99,1.06,"DT")
2930114
"^DD",8925.99,8925.99,1.07,0)
ENABLE NOTIFICATIONS DATE^D^^1;7^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",8925.99,8925.99,1.07,3)
Enter the date on which to enable signature notifications.
"^DD",8925.99,8925.99,1.07,21,0)
^^4^4^2990628^^
"^DD",8925.99,8925.99,1.07,21,1,0)
This date indicates to TIU when to begin sending signature notifications
"^DD",8925.99,8925.99,1.07,21,2,0)
(available/overdue for signature) to expected signers/cosigners.
"^DD",8925.99,8925.99,1.07,21,3,0)
Notifications are sent beginning on this date, and only for documents
"^DD",8925.99,8925.99,1.07,21,4,0)
entered on/after this date.
"^DD",8925.99,8925.99,1.07,"DT")
2930203
"^DD",8925.99,8925.99,2,0)
UPLOAD ERROR ALERT RECIPIENT^8925.992P^^2;0
"^DD",8925.99,8925.99,2,21,0)
^^6^6^2990628^
"^DD",8925.99,8925.99,2,21,1,0)
These persons receive alerts from the upload/filer process when a document
"^DD",8925.99,8925.99,2,21,2,0)
cannot be filed/located or has missing fields.
"^DD",8925.99,8925.99,2,21,3,0)
 
"^DD",8925.99,8925.99,2,21,4,0)
This field is OVERRIDDEN by recipients set for the given document type in
"^DD",8925.99,8925.99,2,21,5,0)
parameter FILING ERROR ALERT RECIPIENTS in the TIU DOCUMENT PARAMETERS
"^DD",8925.99,8925.99,2,21,6,0)
file.
"^DD",8925.99,8925.99,2,"DT")
2930413
"^DD",8925.99,8925.99,3.1,0)
START OF ADD SGNR ALERT PERIOD^F^^3;1^K:$L(X)>5!($L(X)<1)!'(X?1.4N.(1"D",1"W",1"M")) X
"^DD",8925.99,8925.99,3.1,3)
This is the length in time to go back in searching for overdue additional signatures.  The value must be in a Fileman date range format such as 6D, 3W or 4M.
"^DD",8925.99,8925.99,3.1,21,0)
^^5^5^3040831^
"^DD",8925.99,8925.99,3.1,21,1,0)
This is the length of time that the TIU NIGHTLY TASK will go back in 
"^DD",8925.99,8925.99,3.1,21,2,0)
searching for documents that have overdue additional signatures.
"^DD",8925.99,8925.99,3.1,21,3,0)
 
"^DD",8925.99,8925.99,3.1,21,4,0)
If no value is entered, the TIU NIGHTLY TASK will begin with the very 
"^DD",8925.99,8925.99,3.1,21,5,0)
first Document in the TIU DOCUMENTS file (8925).
"^DD",8925.99,8925.99,3.1,"AUDIT")
n
"^DD",8925.99,8925.99,3.1,"DT")
3041215
"^DD",8925.99,8925.99,3.2,0)
END OF ADD SGNR ALERT PERIOD^F^^3;2^K:$L(X)>5!($L(X)<1)!'(X?1.4N.(1"D",1"W",1"M")) X
"^DD",8925.99,8925.99,3.2,3)
This is the length in time previous to the current date to stop searching for overdue additional signatures.  The value must be in a Fileman date range format such as 6D, 3W or 4M.
"^DD",8925.99,8925.99,3.2,21,0)
^^5^5^3040831^^
"^DD",8925.99,8925.99,3.2,21,1,0)
This is the length in time from the current date that the TIU NIGHTLY 
"^DD",8925.99,8925.99,3.2,21,2,0)
TASK will stop regenerating alerts for overdue additional signatures.
"^DD",8925.99,8925.99,3.2,21,3,0)
 
"^DD",8925.99,8925.99,3.2,21,4,0)
If no value is entered, the TIU NIGHTLY TASK will search for documents in 
"^DD",8925.99,8925.99,3.2,21,5,0)
the TIU DOCUMENT File (8925) up to the current date.
"^DD",8925.99,8925.99,3.2,"AUDIT")
n
"^DD",8925.99,8925.99,3.2,"DT")
3041215
"^DD",8925.99,8925.992,0)
UPLOAD ERROR ALERT RECIPIENT SUB-FIELD^^.01^1
"^DD",8925.99,8925.992,0,"IX","B",8925.992,.01)

"^DD",8925.99,8925.992,0,"NM","UPLOAD ERROR ALERT RECIPIENT")

"^DD",8925.99,8925.992,0,"UP")
8925.99
"^DD",8925.99,8925.992,.01,0)
ALERT RECIPIENT^MP200'^VA(200,^0;1^Q
"^DD",8925.99,8925.992,.01,1,0)
^.1
"^DD",8925.99,8925.992,.01,1,1,0)
8925.992^B
"^DD",8925.99,8925.992,.01,1,1,1)
S ^TIU(8925.99,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",8925.99,8925.992,.01,1,1,2)
K ^TIU(8925.99,DA(1),2,"B",$E(X,1,30),DA)
"^DD",8925.99,8925.992,.01,3)

"^DD",8925.99,8925.992,.01,21,0)
^^6^6^2990628^
"^DD",8925.99,8925.992,.01,21,1,0)
These persons receive alerts from the upload/filer process when a document
"^DD",8925.99,8925.992,.01,21,2,0)
cannot be filed/located or has missing fields.
"^DD",8925.99,8925.992,.01,21,3,0)
 
"^DD",8925.99,8925.992,.01,21,4,0)
This field is OVERRIDDEN by recipients set for the given document type in
"^DD",8925.99,8925.992,.01,21,5,0)
parameter FILING ERROR ALERT RECIPIENTS in the TIU DOCUMENT PARAMETERS
"^DD",8925.99,8925.992,.01,21,6,0)
file.
"^DD",8925.99,8925.992,.01,"DT")
2930412
"^DIC",8925.7,8925.7,0)
TIU MULTIPLE SIGNATURE^8925.7P
"^DIC",8925.7,8925.7,0,"GL")
^TIU(8925.7,
"^DIC",8925.7,8925.7,"%D",0)
^^5^5^2980612^^^^
"^DIC",8925.7,8925.7,"%D",1,0)
This file is intended to accommodate the case where multiple cosignatures 
"^DIC",8925.7,8925.7,"%D",2,0)
are applied to a document (e.g., team or multi-disciplinary notes, discharge 
"^DIC",8925.7,8925.7,"%D",3,0)
planning check-lists, etc.).  Rather than adding a multiple to the TIU 
"^DIC",8925.7,8925.7,"%D",4,0)
Document file, this file supports a 3NF decomposition, allowing multiple 
"^DIC",8925.7,8925.7,"%D",5,0)
cosignatures to be applied to the same document.
"^DIC",8925.7,"B","TIU MULTIPLE SIGNATURE",8925.7)

"^DIC",8925.99,8925.99,0)
TIU PARAMETERS^8925.99P
"^DIC",8925.99,8925.99,0,"GL")
^TIU(8925.99,
"^DIC",8925.99,8925.99,"%D",0)
^^3^3^2941101^^^^
"^DIC",8925.99,8925.99,"%D",1,0)
This file contains the site-configurable parameters for the Text Integration
"^DIC",8925.99,8925.99,"%D",2,0)
Utilities package.  It will have one entry for each division, to support
"^DIC",8925.99,8925.99,"%D",3,0)
variable definition of package behavior at multi-divisional facilities.
"^DIC",8925.99,"B","TIU PARAMETERS",8925.99)

**END**
**END**
