Released GMTS*2.7*74 SEQ #70
Extracted from mail message
**KIDS**:GMTS*2.7*74^

**INSTALL NAME**
GMTS*2.7*74
"BLD",5939,0)
GMTS*2.7*74^HEALTH SUMMARY^0^3050620^y
"BLD",5939,1,0)
^^3^3^3050617^
"BLD",5939,1,1,0)
Fixes algorithm used to process date field values for range of entries to 
"BLD",5939,1,2,0)
display in Health Summary component GLOBAL ASSESSMENT FUNCTIONING.
"BLD",5939,1,3,0)
Problem occurred only when user interaction was on the last day of month.
"BLD",5939,4,0)
^9.64PA^^
"BLD",5939,"KRN",0)
^9.67PA^8989.52^19
"BLD",5939,"KRN",.4,0)
.4
"BLD",5939,"KRN",.401,0)
.401
"BLD",5939,"KRN",.402,0)
.402
"BLD",5939,"KRN",.403,0)
.403
"BLD",5939,"KRN",.5,0)
.5
"BLD",5939,"KRN",.84,0)
.84
"BLD",5939,"KRN",3.6,0)
3.6
"BLD",5939,"KRN",3.8,0)
3.8
"BLD",5939,"KRN",9.2,0)
9.2
"BLD",5939,"KRN",9.8,0)
9.8
"BLD",5939,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5939,"KRN",9.8,"NM",1,0)
GMTSGAF^^0^B46430347
"BLD",5939,"KRN",9.8,"NM","B","GMTSGAF",1)

"BLD",5939,"KRN",19,0)
19
"BLD",5939,"KRN",19.1,0)
19.1
"BLD",5939,"KRN",101,0)
101
"BLD",5939,"KRN",409.61,0)
409.61
"BLD",5939,"KRN",771,0)
771
"BLD",5939,"KRN",870,0)
870
"BLD",5939,"KRN",8989.51,0)
8989.51
"BLD",5939,"KRN",8989.52,0)
8989.52
"BLD",5939,"KRN",8994,0)
8994
"BLD",5939,"KRN","B",.4,.4)

"BLD",5939,"KRN","B",.401,.401)

"BLD",5939,"KRN","B",.402,.402)

"BLD",5939,"KRN","B",.403,.403)

"BLD",5939,"KRN","B",.5,.5)

"BLD",5939,"KRN","B",.84,.84)

"BLD",5939,"KRN","B",3.6,3.6)

"BLD",5939,"KRN","B",3.8,3.8)

"BLD",5939,"KRN","B",9.2,9.2)

"BLD",5939,"KRN","B",9.8,9.8)

"BLD",5939,"KRN","B",19,19)

"BLD",5939,"KRN","B",19.1,19.1)

"BLD",5939,"KRN","B",101,101)

"BLD",5939,"KRN","B",409.61,409.61)

"BLD",5939,"KRN","B",771,771)

"BLD",5939,"KRN","B",870,870)

"BLD",5939,"KRN","B",8989.51,8989.51)

"BLD",5939,"KRN","B",8989.52,8989.52)

"BLD",5939,"KRN","B",8994,8994)

"BLD",5939,"QUES",0)
^9.62^^
"BLD",5939,"REQB",0)
^9.611^1^1
"BLD",5939,"REQB",1,0)
GMTS*2.7*49^2
"BLD",5939,"REQB","B","GMTS*2.7*49",1)

"MBREQ")
0
"PKG",240,-1)
1^1
"PKG",240,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",240,20,0)
^9.402P^^
"PKG",240,22,0)
^9.49I^1^1
"PKG",240,22,1,0)
2.7^2951020^2960313
"PKG",240,22,1,"PAH",1,0)
74^3050620^520637436
"PKG",240,22,1,"PAH",1,1,0)
^^3^3^3050620
"PKG",240,22,1,"PAH",1,1,1,0)
Fixes algorithm used to process date field values for range of entries to 
"PKG",240,22,1,"PAH",1,1,2,0)
display in Health Summary component GLOBAL ASSESSMENT FUNCTIONING.
"PKG",240,22,1,"PAH",1,1,3,0)
Problem occurred only when user interaction was on the last day of month.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","GMTSGAF")
0^1^B46430347
"RTN","GMTSGAF",1,0)
GMTSGAF ; SLC/KER - MH Gbl Assessment Funct (GAF)    ; 6/20/05 1:44pm
"RTN","GMTSGAF",2,0)
 ;;2.7;Health Summary;**35,44,49,74**;Oct 20, 1995
"RTN","GMTSGAF",3,0)
 ;                  
"RTN","GMTSGAF",4,0)
 ; External References
"RTN","GMTSGAF",5,0)
 ;   DBIA 10035  ^DPT(
"RTN","GMTSGAF",6,0)
 ;   DBIA 10003  ^%DT
"RTN","GMTSGAF",7,0)
 ;   DBIA 10088  DEM^VADPT
"RTN","GMTSGAF",8,0)
 ;   DBIA 10103  $$FMADD^XLFDT
"RTN","GMTSGAF",9,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSGAF",10,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSGAF",11,0)
 ;   DBIA  2896  GAFHX^YSGAFAPI
"RTN","GMTSGAF",12,0)
 ;                     
"RTN","GMTSGAF",13,0)
 Q
"RTN","GMTSGAF",14,0)
EN ; Global Assessment Functioning Score
"RTN","GMTSGAF",15,0)
 N MAX S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:9999999)
"RTN","GMTSGAF",16,0)
 S:+($G(GMTSBEG))'>2700101 GMTSBEG=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),-1095,0,0,1),GMTSEND=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),1,0,0,1),GMTS2=9999999-GMTSBEG,GMTS1=9999999-GMTSEND
"RTN","GMTSGAF",17,0)
 S:'$L($P(GMTSBEG,".",2)) GMTSBEG=$$FMADD^XLFDT(GMTSBEG,0,0,0,1)
"RTN","GMTSGAF",18,0)
 S:+($G(GMTSEND))'>2700101!(+($G(GMTSEND))>+($$FMADD^XLFDT($P($$NOW^XLFDT,".",1),+1,0,0,2))) GMTSEND=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),1,0,0,1),GMTS1=9999999-GMTSEND
"RTN","GMTSGAF",19,0)
 S:'$L($P(GMTSEND,".",2)) GMTSEND=$$FMADD^XLFDT(GMTSEND,0,0,0,1)
"RTN","GMTSGAF",20,0)
 S:+($G(GMTSEND))>0&(+($G(GMTS1))=0) GMTS1=9999999-GMTSEND S:+($G(GMTSBEG))>0&(+($G(GMTS2))=0) GMTS2=9999999-GMTSBEG
"RTN","GMTSGAF",21,0)
 S GMTSLO=+($G(GMTSLO)) S:GMTSLO=0 GMTSLO=3 S GMTSLPG=+($G(GMTSLPG)),GMTSDTM=$G(GMTSDTM) S:'$L(GMTSDTM) GMTSDTM=$$DTM
"RTN","GMTSGAF",22,0)
 S:'$D(GMTSTITL)!('$L($G(GMTSTITL))) GMTSTITL="GLOBAL ASSESSMENT FUNCTIONING"
"RTN","GMTSGAF",23,0)
 S DFN=+($G(DFN)) Q:'$L($P($G(^DPT(DFN,0)),"^",1))
"RTN","GMTSGAF",24,0)
 N %,%DT,%H,%I,%T,%X,I,N,VA,VADM,VAERR,X,Y,YS,YSGAF
"RTN","GMTSGAF",25,0)
 N GMTSBAR,GMTSCNT,GMTSCOM,GMTSCORE,GMTSCS,GMTSCW,GMTSDATE,GMTSDT
"RTN","GMTSGAF",26,0)
 N GMTSGAF,GMTSGAF1,GMTSGAF2,GMTSGAF3,GMTSGAFN,GMTSI,GMTSJ,GMTSLEN,GMTSPROV,GMTSRV
"RTN","GMTSGAF",27,0)
 S GMTSGAF1=$$EXT(+($G(GMTS1))),GMTSGAF2=$$ITM(+($G(GMTS2))),GMTSGAF3=$$TOM
"RTN","GMTSGAF",28,0)
 S GMTSGAFN=+($G(MAX)) S:GMTSGAFN=0 GMTSGAFN=10
"RTN","GMTSGAF",29,0)
 S GMTSCW(0)=+($G(IOM)) S:GMTSCW(0)=0 GMTSCW(0)=80
"RTN","GMTSGAF",30,0)
 S GMTSCW(1)=5,GMTSCW(2)=10,GMTSCW(3)=20,GMTSCW(4)=GMTSCW(0)-(GMTSCW(1)+GMTSCW(2)+GMTSCW(3)+8)
"RTN","GMTSGAF",31,0)
 S GMTSCW("L")=(GMTSCW(1)+GMTSCW(2)+GMTSCW(3)+GMTSCW(4)+6)
"RTN","GMTSGAF",32,0)
 S GMTSCS(1)=1,GMTSCS(2)=GMTSCS(1)+GMTSCW(1)+2,GMTSCS(3)=GMTSCS(2)+GMTSCW(2)+2,GMTSCS(4)=GMTSCS(3)+GMTSCW(3)+2
"RTN","GMTSGAF",33,0)
 S YS("DFN")=DFN,YS("BEGIN")=$S($L(GMTSGAF2):GMTSGAF2,1:GMTSGAF3)
"RTN","GMTSGAF",34,0)
 S YS("END")=$S($L(GMTSGAF1):GMTSGAF1,1:"01/01/1970"),YS("LIMIT")=GMTSGAFN
"RTN","GMTSGAF",35,0)
 D GET Q:'$D(^TMP($J,"GMTSGAF",DFN))  D OUT Q
"RTN","GMTSGAF",36,0)
OUT ; Output
"RTN","GMTSGAF",37,0)
 N GMTSI,GMTSJ,GMTSCORE,GMTSDATE,GMTSPROV,GMTSCOM S DFN=+($G(DFN)) Q:DFN=0  D HDR S GMTSI=0 F  S GMTSI=$O(^TMP($J,"GMTSGAF",DFN,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSGAF",38,0)
 . S GMTSJ=$G(^TMP($J,"GMTSGAF",DFN,GMTSI))
"RTN","GMTSGAF",39,0)
 . S GMTSCORE=$P(GMTSJ,"^",1),GMTSDATE=$P(GMTSJ,"^",2),GMTSPROV=$P(GMTSJ,"^",3),GMTSCOM=$P(GMTSJ,"^",4) S:GMTSCORE=""&(GMTSDATE["----")&($L(GMTSCOM)) GMTSCORE=">>" D LINE
"RTN","GMTSGAF",40,0)
 K ^TMP($J,"GMTSGAF",DFN) Q
"RTN","GMTSGAF",41,0)
LINE ; Output One Line
"RTN","GMTSGAF",42,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCS(1),$J($E(GMTSCORE,1,3),3),?GMTSCS(2),GMTSDATE,?GMTSCS(3),$E(GMTSPROV,1,GMTSCW(3)),?GMTSCS(4),GMTSCOM,! Q
"RTN","GMTSGAF",43,0)
HDR ; Header
"RTN","GMTSGAF",44,0)
 N GMTSI S GMTSI="",$P(GMTSI,"-",+($G(GMTSCW("L"))))="-"
"RTN","GMTSGAF",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W ?GMTSCS(1)," GAF ",?GMTSCS(2),"Date",!
"RTN","GMTSGAF",46,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W ?GMTSCS(1),"Score",?GMTSCS(2),"Determined",?GMTSCS(3),"Determined by",?GMTSCS(4),"Graph/Comment",!
"RTN","GMTSGAF",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W ?GMTSCS(1),GMTSI,!
"RTN","GMTSGAF",48,0)
 Q
"RTN","GMTSGAF",49,0)
GET ; Get and Format Data
"RTN","GMTSGAF",50,0)
 N %DT,X,Y,GMTSGPH,GMTSCORE,GMTSDT,GMTSDATE,GMTSPROV,GMTSCOM S DFN=+($G(DFN)),GMTSGPH=0 K ^TMP($J,"GMTSGAF",DFN),YSGAF D GAFHX^YSGAFAPI(.YSGAF,.YS),SPC
"RTN","GMTSGAF",51,0)
 I +($P($G(YSGAF("DEC")),".",1))>0 D
"RTN","GMTSGAF",52,0)
 . S GMTSDT=+($P($G(YSGAF("DEC")),".",1)),GMTSCOM="Deceased ("_$$FMTE^XLFDT(GMTSDT,"5ZD")_")" D SD(GMTSDT,DFN,"","","",GMTSCOM)
"RTN","GMTSGAF",53,0)
 I +($P($G(YSGAF("DUE")),".",1))>0 D
"RTN","GMTSGAF",54,0)
 . S GMTSDT=+($P($G(YSGAF("DUE")),".",1)) Q:GMTSDT>$$TOD  S GMTSCOM="Due since "_$$FMTE^XLFDT(GMTSDT,"5ZD") D SD(GMTSDT,DFN,"","","",GMTSCOM)
"RTN","GMTSGAF",55,0)
 N I S I=1 F  S I=$O(YSGAF(I)) Q:+I=0  D
"RTN","GMTSGAF",56,0)
 . S GMTSDT=$P(YSGAF(I),"^",1),GMTSDATE=$P(GMTSDT,".",1),GMTSDATE=$$FMTE^XLFDT(GMTSDATE,"5ZD")
"RTN","GMTSGAF",57,0)
 . Q:+($G(YSGAF("DEC")))>0&(+GMTSDATE>+($G(YSGAF("DEC"))))
"RTN","GMTSGAF",58,0)
 . S GMTSCORE=$P(YSGAF(I),"^",5),GMTSPROV=$P(YSGAF(I),"^",7)
"RTN","GMTSGAF",59,0)
 . S GMTSCOM=+($P($G(YSGAF("ERR",I)),".",1)) S:+GMTSCOM=0 GMTSCOM=""
"RTN","GMTSGAF",60,0)
 . S:+GMTSCOM>0 GMTSCOM="Entered in error ("_$$FMTE^XLFDT(GMTSCOM,"5ZD")_")"
"RTN","GMTSGAF",61,0)
 . S:GMTSCOM="" GMTSCOM=$$B(GMTSCORE,31)
"RTN","GMTSGAF",62,0)
 . D:'$D(YSGAF("ERR",I)) SD(GMTSDT,DFN,GMTSCORE,GMTSDATE,GMTSPROV,GMTSCOM)
"RTN","GMTSGAF",63,0)
 Q
"RTN","GMTSGAF",64,0)
SPC ; Get Special Case (Deceased, Due, Entered-in-Error)
"RTN","GMTSGAF",65,0)
 N GMTSI S YSGAF("P")=$P($G(^DPT(+($G(DFN)),0)),"^",1)
"RTN","GMTSGAF",66,0)
 S GMTSI=$$DEC(+($G(DFN))) S:+GMTSI>0 YSGAF("DEC")=GMTSI I +GMTSI=0 S GMTSI=$$DUE S:+GMTSI>0 YSGAF("DUE")=GMTSI
"RTN","GMTSGAF",67,0)
 K:+($G(YSGAF("DEC")))>0 YSGAF("DUE") S GMTSI=$$ERR S:+GMTSI>0 YSGAF("ERR")=GMTSI
"RTN","GMTSGAF",68,0)
 Q
"RTN","GMTSGAF",69,0)
SD(GMTSI,DFN,GMTSCORE,GMTSDATE,GMTSPROV,GMTSCOM) ; Save Data
"RTN","GMTSGAF",70,0)
 N GMTSIG S (GMTSCORE,GMTSIG)=$G(GMTSCORE),GMTSCORE=$$GAF(GMTSCORE),DFN=+($G(DFN))
"RTN","GMTSGAF",71,0)
 S GMTSIG=100-(+($G(GMTSIG)))
"RTN","GMTSGAF",72,0)
 S GMTSI=+($G(GMTSI)),GMTSI=9999999.999999-GMTSI
"RTN","GMTSGAF",73,0)
 S GMTSPROV=$G(GMTSPROV),GMTSDATE=$G(GMTSDATE)
"RTN","GMTSGAF",74,0)
 S GMTSIG=GMTSI_GMTSIG_GMTSPROV_GMTSDATE
"RTN","GMTSGAF",75,0)
 S:GMTSDATE="" GMTSDATE="--/--/----"
"RTN","GMTSGAF",76,0)
 S ^TMP($J,"GMTSGAF",DFN,GMTSIG)=GMTSCORE_"^"_GMTSDATE_"^"_GMTSPROV_"^"_$G(GMTSCOM)
"RTN","GMTSGAF",77,0)
 Q
"RTN","GMTSGAF",78,0)
ERR(X) ; Entered in Error
"RTN","GMTSGAF",79,0)
 N GMTSCNT,GMTSI,GMTSGAF,GMTSJ,GMTSDATE S (GMTSCNT,GMTSI)=0,GMTSDATE="" F  S GMTSI=$O(YSGAF(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSGAF",80,0)
 . S GMTSGAF=$P(YSGAF(GMTSI),"^",8) Q:GMTSGAF'["entered in error"
"RTN","GMTSGAF",81,0)
 . S YSGAF("ERR")="" F GMTSJ=1:1:$L(GMTSGAF," ") D
"RTN","GMTSGAF",82,0)
 .. S:$P(GMTSGAF," ",GMTSJ)["@"&(GMTSJ>2) GMTSDATE=$P(GMTSGAF," ",GMTSJ-1,GMTSJ) S:$L(GMTSDATE) GMTSDATE=$$ETF(GMTSDATE)
"RTN","GMTSGAF",83,0)
 . S:$L(GMTSDATE) YSGAF("ERR",GMTSI)=GMTSDATE,GMTSCNT=GMTSCNT+1
"RTN","GMTSGAF",84,0)
 S X=GMTSCNT Q X
"RTN","GMTSGAF",85,0)
DUE(X) ; GAF Score Due Date
"RTN","GMTSGAF",86,0)
 S:'$D(YSGAF(2)) YSGAF(1)="[NO DATA]" N GMTSI,GMTSJ,GMTSDATE S (GMTSI,GMTSJ,GMTSDATE)=0
"RTN","GMTSGAF",87,0)
 F  S GMTSI=$O(YSGAF(GMTSI)) Q:+GMTSI=0  S GMTSJ=$P(YSGAF(GMTSI),"^",1) S:GMTSJ>GMTSDATE GMTSDATE=GMTSJ
"RTN","GMTSGAF",88,0)
 S GMTSDATE=$S(GMTSDATE>0:$$FMADD^XLFDT(GMTSDATE,90,0,0,0),1:"") S X=GMTSDATE Q X
"RTN","GMTSGAF",89,0)
ITM(X) ; convert inverse internal date to internal date to external date
"RTN","GMTSGAF",90,0)
 N SAVX  ;  temp scratch variable to hold value of X
"RTN","GMTSGAF",91,0)
 S X=+($G(X)),X=9999999-X  ; produce an internal date
"RTN","GMTSGAF",92,0)
 S SAVX=X
"RTN","GMTSGAF",93,0)
 S X=$$FMTE^XLFDT(X,"5ZD") D ^%DT I Y=-1 D  ; if not valid date, default to 3 years ago
"RTN","GMTSGAF",94,0)
 . S X1=$$NOW^XLFDT,X2=-1095 D C^%DTC S SAVX=X
"RTN","GMTSGAF",95,0)
 S X=SAVX
"RTN","GMTSGAF",96,0)
 S X=$$FMTE^XLFDT(X,"5ZD")    ; produce external format
"RTN","GMTSGAF",97,0)
 Q X
"RTN","GMTSGAF",98,0)
EXT(X) ; convert inverse internal date to internal date, add one day, then to external date
"RTN","GMTSGAF",99,0)
 N SAVX  ;  temp scratch variable to hold value of X
"RTN","GMTSGAF",100,0)
 S X=+($G(X)),X=9999999-X  ; produce an internal date
"RTN","GMTSGAF",101,0)
 S SAVX=X
"RTN","GMTSGAF",102,0)
 S X=$$FMTE^XLFDT(X,"5ZD") D ^%DT I Y=-1 S SAVX=$$NOW^XLFDT ; if not valid date, set to NOW
"RTN","GMTSGAF",103,0)
 S X=SAVX
"RTN","GMTSGAF",104,0)
 S X=$$FMADD^XLFDT(X,1,0,0,0) ; add one day so any GAF data entered today will appear on output
"RTN","GMTSGAF",105,0)
 S X=$$FMTE^XLFDT(X,"5ZD")    ; output in external format
"RTN","GMTSGAF",106,0)
 Q X
"RTN","GMTSGAF",107,0)
ETF(X) ; External to Fileman format
"RTN","GMTSGAF",108,0)
 N %DT,Y S X=$G(X),%DT="PST" D ^%DT S X=Y S:+X'>0 X="" Q X
"RTN","GMTSGAF",109,0)
TOM(X) ; Tomorrow
"RTN","GMTSGAF",110,0)
 S X=$$FMTE^XLFDT($$FMADD^XLFDT($$NOW^XLFDT,1,0,0,0),"5ZD") Q X
"RTN","GMTSGAF",111,0)
TOD(X) ; Today
"RTN","GMTSGAF",112,0)
 S X=$$NOW^XLFDT Q X
"RTN","GMTSGAF",113,0)
DEC(X) ; Deceased Date
"RTN","GMTSGAF",114,0)
 N %,%H,%I,%X,%T,VA,VADM,VAERR,DFN S DFN=+($G(X)) Q:DFN=0 "" Q:'$D(^DPT(+DFN,0)) ""
"RTN","GMTSGAF",115,0)
 D DEM^VADPT S X=+$G(VADM(6)) S:X=0 X="" Q X
"RTN","GMTSGAF",116,0)
B(X,Y) ; Graph Bar
"RTN","GMTSGAF",117,0)
 N GMTSGAF,GMTSCHAR,GMTSCW,GMTSLEN,GMTSI,GMTSBAR S GMTSGAF=$G(X),GMTSCW=+($G(Y)) Q:GMTSCW=0 ""
"RTN","GMTSGAF",118,0)
 S GMTSCHAR="#" F  Q:$E(GMTSGAF,1)'="0"  S GMTSGAF=$E(GMTSGAF,2,$L(GMTSGAF))
"RTN","GMTSGAF",119,0)
 S GMTSGAF=+GMTSGAF Q:GMTSGAF=0 ""
"RTN","GMTSGAF",120,0)
 I GMTSGAF>99 S GMTSBAR="",$P(GMTSBAR,GMTSCHAR,GMTSCW)=GMTSCHAR
"RTN","GMTSGAF",121,0)
 I GMTSGAF'>99 S GMTSI=GMTSCW/100,GMTSLEN=GMTSI*GMTSGAF,GMTSLEN=$FN(GMTSLEN,"",0),GMTSBAR="",$P(GMTSBAR,GMTSCHAR,GMTSLEN)=GMTSCHAR
"RTN","GMTSGAF",122,0)
 S X=GMTSBAR Q X
"RTN","GMTSGAF",123,0)
GAF(X) ; 2 Digit GAF Score
"RTN","GMTSGAF",124,0)
 S X=$E($G(X),1,3) Q:X=""!(X="---") "" S X=+X Q:X=0 "  0" S:$L(X)=1 X="  "_X S:$L(X)=2 X=" "_X Q X
"RTN","GMTSGAF",125,0)
DTM(X) ; Current Date and Time (External)
"RTN","GMTSGAF",126,0)
 S X=$$NOW^XLFDT D REGDTM4^GMTSU Q X
"VER")
8.0^22.0
"BLD",5939,6)
^SEQ #70
**END**
**END**
