Released MPIF*1*11 SEQ #18
Extracted from mail message
**KIDS**:MPIF*1.0*11^

**INSTALL NAME**
MPIF*1.0*11
"BLD",1827,0)
MPIF*1.0*11^MASTER PATIENT INDEX VISTA^0^3011107^y
"BLD",1827,1,0)
^^3^3^3011101^
"BLD",1827,1,1,0)
CMOR REQUEST FIXES
"BLD",1827,1,2,0)
Refer to patch MPIF*1.0*11 in the FORUM Patch Module for a complete
"BLD",1827,1,3,0)
description.
"BLD",1827,4,0)
^9.64PA^984.9^1
"BLD",1827,4,984.9,0)
984.9
"BLD",1827,4,984.9,2,0)
^9.641^984.9^1
"BLD",1827,4,984.9,2,984.9,0)
MPIF CMOR REQUEST  (File-top level)
"BLD",1827,4,984.9,2,984.9,1,0)
^9.6411^.09^7
"BLD",1827,4,984.9,2,984.9,1,.02,0)
REQUESTED BY
"BLD",1827,4,984.9,2,984.9,1,.06,0)
STATUS
"BLD",1827,4,984.9,2,984.9,1,.07,0)
SITE
"BLD",1827,4,984.9,2,984.9,1,.09,0)
CMOR AFTER APPROVAL
"BLD",1827,4,984.9,2,984.9,1,1.03,0)
TYPE OF ACTION
"BLD",1827,4,984.9,2,984.9,1,2.01,0)
REVIEWED BY
"BLD",1827,4,984.9,2,984.9,1,3.01,0)
REVIEWER NAME
"BLD",1827,4,984.9,222)
y^n^p^^^^n
"BLD",1827,4,"APDD",984.9,984.9)

"BLD",1827,4,"APDD",984.9,984.9,.02)

"BLD",1827,4,"APDD",984.9,984.9,.06)

"BLD",1827,4,"APDD",984.9,984.9,.07)

"BLD",1827,4,"APDD",984.9,984.9,.09)

"BLD",1827,4,"APDD",984.9,984.9,1.03)

"BLD",1827,4,"APDD",984.9,984.9,2.01)

"BLD",1827,4,"APDD",984.9,984.9,3.01)

"BLD",1827,4,"B",984.9,984.9)

"BLD",1827,"ABNS",0)
^9.66A^^
"BLD",1827,"ABPKG")
n^^
"BLD",1827,"INID")
^y
"BLD",1827,"INIT")
MPIF111P
"BLD",1827,"KRN",0)
^9.67PA^19^17
"BLD",1827,"KRN",.4,0)
.4
"BLD",1827,"KRN",.401,0)
.401
"BLD",1827,"KRN",.402,0)
.402
"BLD",1827,"KRN",.402,"NM",0)
^9.68A^3^3
"BLD",1827,"KRN",.402,"NM",1,0)
MPIF REQUEST EDIT    FILE #984.9^984.9^1^
"BLD",1827,"KRN",.402,"NM",2,0)
MPIF PCMM REQUEST    FILE #984.9^984.9^1^
"BLD",1827,"KRN",.402,"NM",3,0)
MPIF REQUEST INCOMING    FILE #984.9^984.9^0
"BLD",1827,"KRN",.402,"NM","B","MPIF PCMM REQUEST    FILE #984.9",2)

"BLD",1827,"KRN",.402,"NM","B","MPIF REQUEST EDIT    FILE #984.9",1)

"BLD",1827,"KRN",.402,"NM","B","MPIF REQUEST INCOMING    FILE #984.9",3)

"BLD",1827,"KRN",.403,0)
.403
"BLD",1827,"KRN",.5,0)
.5
"BLD",1827,"KRN",.84,0)
.84
"BLD",1827,"KRN",3.6,0)
3.6
"BLD",1827,"KRN",3.8,0)
3.8
"BLD",1827,"KRN",9.2,0)
9.2
"BLD",1827,"KRN",9.8,0)
9.8
"BLD",1827,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",1827,"KRN",9.8,"NM",1,0)
MPIFREV^^0^B16526919
"BLD",1827,"KRN",9.8,"NM",2,0)
MPIFQUE4^^0^B57552946
"BLD",1827,"KRN",9.8,"NM",3,0)
MPIFRESS^^0^B19338138
"BLD",1827,"KRN",9.8,"NM",4,0)
MPIFREQ^^0^B26937042
"BLD",1827,"KRN",9.8,"NM",5,0)
MPIFEDIT^^0^B14400463
"BLD",1827,"KRN",9.8,"NM",6,0)
MPIFCMRP^^0^B19402659
"BLD",1827,"KRN",9.8,"NM",7,0)
MPIFNQ^^0^B9397863
"BLD",1827,"KRN",9.8,"NM",8,0)
MPIFCMOR^^0^B7636116
"BLD",1827,"KRN",9.8,"NM",9,0)
MPIFAREQ^^0^B3702537
"BLD",1827,"KRN",9.8,"NM",10,0)
MPIFUTL^^0^B9147813
"BLD",1827,"KRN",9.8,"NM",11,0)
MPIFHL7^^0^B1609123
"BLD",1827,"KRN",9.8,"NM",12,0)
MPIFQUE5^^0^B11145913
"BLD",1827,"KRN",9.8,"NM",13,0)
MPIFNEW^^0^B3287153
"BLD",1827,"KRN",9.8,"NM","B","MPIFAREQ",9)

"BLD",1827,"KRN",9.8,"NM","B","MPIFCMOR",8)

"BLD",1827,"KRN",9.8,"NM","B","MPIFCMRP",6)

"BLD",1827,"KRN",9.8,"NM","B","MPIFEDIT",5)

"BLD",1827,"KRN",9.8,"NM","B","MPIFHL7",11)

"BLD",1827,"KRN",9.8,"NM","B","MPIFNEW",13)

"BLD",1827,"KRN",9.8,"NM","B","MPIFNQ",7)

"BLD",1827,"KRN",9.8,"NM","B","MPIFQUE4",2)

"BLD",1827,"KRN",9.8,"NM","B","MPIFQUE5",12)

"BLD",1827,"KRN",9.8,"NM","B","MPIFREQ",4)

"BLD",1827,"KRN",9.8,"NM","B","MPIFRESS",3)

"BLD",1827,"KRN",9.8,"NM","B","MPIFREV",1)

"BLD",1827,"KRN",9.8,"NM","B","MPIFUTL",10)

"BLD",1827,"KRN",19,0)
19
"BLD",1827,"KRN",19,"NM",0)
^9.68A^16^16
"BLD",1827,"KRN",19,"NM",1,0)
MPIF CMOR MGR^^0
"BLD",1827,"KRN",19,"NM",2,0)
MPIF PUSH CMOR^^0
"BLD",1827,"KRN",19,"NM",3,0)
MPIF APPROVED REPORT^^0
"BLD",1827,"KRN",19,"NM",4,0)
MPIF DISAPPROVE REPORT^^0
"BLD",1827,"KRN",19,"NM",5,0)
MPIF EDIT REQUEST^^0
"BLD",1827,"KRN",19,"NM",6,0)
MPIF NEW REQUEST^^0
"BLD",1827,"KRN",19,"NM",7,0)
MPIF RECEIVED REQUESTS^^0
"BLD",1827,"KRN",19,"NM",8,0)
MPIF SENT REQUESTS^^0
"BLD",1827,"KRN",19,"NM",9,0)
MPIF VIEW REQUEST^^0
"BLD",1827,"KRN",19,"NM",10,0)
MPIF BATCH REVIEW^^0
"BLD",1827,"KRN",19,"NM",11,0)
MPIF REVIEW REQUEST^^0
"BLD",1827,"KRN",19,"NM",12,0)
MPIF CMOR REQUEST AUTO JOB^^0
"BLD",1827,"KRN",19,"NM",13,0)
MPIF COMP MAIN^^1^
"BLD",1827,"KRN",19,"NM",14,0)
MPIF CMOR COMP BATCH^^1^
"BLD",1827,"KRN",19,"NM",15,0)
MPIF CMOR COMP STATUS^^1^
"BLD",1827,"KRN",19,"NM",16,0)
MPIF CMOR COMP STOP/RESTART^^1^
"BLD",1827,"KRN",19,"NM","B","MPIF APPROVED REPORT",3)

"BLD",1827,"KRN",19,"NM","B","MPIF BATCH REVIEW",10)

"BLD",1827,"KRN",19,"NM","B","MPIF CMOR COMP BATCH",14)

"BLD",1827,"KRN",19,"NM","B","MPIF CMOR COMP STATUS",15)

"BLD",1827,"KRN",19,"NM","B","MPIF CMOR COMP STOP/RESTART",16)

"BLD",1827,"KRN",19,"NM","B","MPIF CMOR MGR",1)

"BLD",1827,"KRN",19,"NM","B","MPIF CMOR REQUEST AUTO JOB",12)

"BLD",1827,"KRN",19,"NM","B","MPIF COMP MAIN",13)

"BLD",1827,"KRN",19,"NM","B","MPIF DISAPPROVE REPORT",4)

"BLD",1827,"KRN",19,"NM","B","MPIF EDIT REQUEST",5)

"BLD",1827,"KRN",19,"NM","B","MPIF NEW REQUEST",6)

"BLD",1827,"KRN",19,"NM","B","MPIF PUSH CMOR",2)

"BLD",1827,"KRN",19,"NM","B","MPIF RECEIVED REQUESTS",7)

"BLD",1827,"KRN",19,"NM","B","MPIF REVIEW REQUEST",11)

"BLD",1827,"KRN",19,"NM","B","MPIF SENT REQUESTS",8)

"BLD",1827,"KRN",19,"NM","B","MPIF VIEW REQUEST",9)

"BLD",1827,"KRN",19.1,0)
19.1
"BLD",1827,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",1827,"KRN",101,0)
101
"BLD",1827,"KRN",101,"NM",0)
^9.68A^^0
"BLD",1827,"KRN",409.61,0)
409.61
"BLD",1827,"KRN",771,0)
771
"BLD",1827,"KRN",771,"NM",0)
^9.68A^^0
"BLD",1827,"KRN",870,0)
870
"BLD",1827,"KRN",870,"NM",0)
^9.68A^^0
"BLD",1827,"KRN",8994,0)
8994
"BLD",1827,"KRN",8994,"NM",0)
^9.68A^^
"BLD",1827,"KRN","B",.4,.4)

"BLD",1827,"KRN","B",.401,.401)

"BLD",1827,"KRN","B",.402,.402)

"BLD",1827,"KRN","B",.403,.403)

"BLD",1827,"KRN","B",.5,.5)

"BLD",1827,"KRN","B",.84,.84)

"BLD",1827,"KRN","B",3.6,3.6)

"BLD",1827,"KRN","B",3.8,3.8)

"BLD",1827,"KRN","B",9.2,9.2)

"BLD",1827,"KRN","B",9.8,9.8)

"BLD",1827,"KRN","B",19,19)

"BLD",1827,"KRN","B",19.1,19.1)

"BLD",1827,"KRN","B",101,101)

"BLD",1827,"KRN","B",409.61,409.61)

"BLD",1827,"KRN","B",771,771)

"BLD",1827,"KRN","B",870,870)

"BLD",1827,"KRN","B",8994,8994)

"BLD",1827,"PRET")

"BLD",1827,"QUES",0)
^9.62^^
"BLD",1827,"REQB",0)
^9.611^5^4
"BLD",1827,"REQB",1,0)
MPIF*1.0*1^2
"BLD",1827,"REQB",3,0)
MPIF*1.0*5^2
"BLD",1827,"REQB",4,0)
MPIF*1.0*6^2
"BLD",1827,"REQB",5,0)
MPIF*1.0*3^2
"BLD",1827,"REQB","B","MPIF*1.0*1",1)

"BLD",1827,"REQB","B","MPIF*1.0*3",5)

"BLD",1827,"REQB","B","MPIF*1.0*5",3)

"BLD",1827,"REQB","B","MPIF*1.0*6",4)

"FIA",984.9)
MPIF CMOR REQUEST
"FIA",984.9,0)
^MPIF(984.9,
"FIA",984.9,0,0)
984.9I
"FIA",984.9,0,1)
y^n^p^^^^n
"FIA",984.9,0,10)

"FIA",984.9,0,11)

"FIA",984.9,0,"RLRO")

"FIA",984.9,0,"VR")
1.0^MPIF
"FIA",984.9,984.9)
1
"FIA",984.9,984.9,.02)

"FIA",984.9,984.9,.06)

"FIA",984.9,984.9,.07)

"FIA",984.9,984.9,.09)

"FIA",984.9,984.9,1.03)

"FIA",984.9,984.9,2.01)

"FIA",984.9,984.9,3.01)

"INIT")
MPIF111P
"KRN",.402,1905,-1)
0^3
"KRN",.402,1905,0)
MPIF REQUEST INCOMING^3010718.0437^@^984.9^^@^3011105
"KRN",.402,1905,"DR",1,984.9)
1.03////^S X=TYPE;.08////^S X=1;.06////^S X=3;.03////^S X=NDATE;1.01////^S X=USER;.07///^S X=INST;1.02////^S X=REASON;.05////^S X=PHONE;.04////^S X=PATIEN;
"KRN",.402,1925,-1)
1^1
"KRN",.402,1925,0)
MPIF REQUEST EDIT    FILE #984.9
"KRN",.402,1926,-1)
1^2
"KRN",.402,1926,0)
MPIF PCMM REQUEST    FILE #984.9
"KRN",19,10209,-1)
0^1
"KRN",19,10209,0)
MPIF CMOR MGR^Coordinating Master of Record (CMOR) Request^^M^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",19,10209,1,0)
^^5^5^3010709^
"KRN",19,10209,1,1,0)
This is the main menu that contains options for managing incoming and
"KRN",19,10209,1,2,0)
outgoing CMOR requests.  Options provide the ability to display, review
"KRN",19,10209,1,3,0)
and process CMOR requests.  The ability to change the CMOR to another site
"KRN",19,10209,1,4,0)
(pushing the CMOR) is also included along with a number of useful tracking
"KRN",19,10209,1,5,0)
reports.
"KRN",19,10209,10,0)
^19.01IP^11^11
"KRN",19,10209,10,1,0)
10211^PEND^7
"KRN",19,10209,10,1,"^")
MPIF RECEIVED REQUESTS
"KRN",19,10209,10,2,0)
10210^SENT^8
"KRN",19,10209,10,2,"^")
MPIF SENT REQUESTS
"KRN",19,10209,10,3,0)
10212^^6
"KRN",19,10209,10,3,"^")
MPIF VIEW REQUEST
"KRN",19,10209,10,4,0)
10230^^1
"KRN",19,10209,10,4,"^")
MPIF NEW REQUEST
"KRN",19,10209,10,6,0)
10214^^4
"KRN",19,10209,10,6,"^")
MPIF REVIEW REQUEST
"KRN",19,10209,10,7,0)
10215^^5
"KRN",19,10209,10,7,"^")
MPIF BATCH REVIEW
"KRN",19,10209,10,8,0)
10231^^3
"KRN",19,10209,10,8,"^")
MPIF EDIT REQUEST
"KRN",19,10209,10,9,0)
10363^APP^10
"KRN",19,10209,10,9,"^")
MPIF APPROVED REPORT
"KRN",19,10209,10,10,0)
10364^DIS^9
"KRN",19,10209,10,10,"^")
MPIF DISAPPROVE REPORT
"KRN",19,10209,10,11,0)
10365^^2
"KRN",19,10209,10,11,"^")
MPIF PUSH CMOR
"KRN",19,10209,99)
58730,28586
"KRN",19,10209,"U")
COORDINATING MASTER OF RECORD 
"KRN",19,10210,-1)
0^8
"KRN",19,10210,0)
MPIF SENT REQUESTS^Report - Sent Requests Still Pending^^R^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",19,10210,1,0)
^^2^2^3010709^
"KRN",19,10210,1,1,0)
This report lists all CMOR requests entered that are still outstanding.
"KRN",19,10210,1,2,0)
The report sorts by station number and date requested.
"KRN",19,10210,25)
RPT1^MPIFNQ
"KRN",19,10210,"U")
REPORT - SENT REQUESTS STILL P
"KRN",19,10211,-1)
0^7
"KRN",19,10211,0)
MPIF RECEIVED REQUESTS^Report - Pending Received Requests^^R^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",19,10211,1,0)
^^2^2^3010709^
"KRN",19,10211,1,1,0)
This report lists all outstanding CMOR requests that need to be
"KRN",19,10211,1,2,0)
reviewed and processed.
"KRN",19,10211,25)
RPT2^MPIFNQ
"KRN",19,10211,99)
56810,32094
"KRN",19,10211,"U")
REPORT - PENDING RECEIVED REQU
"KRN",19,10212,-1)
0^9
"KRN",19,10212,0)
MPIF VIEW REQUEST^Display a CMOR Change Request^^R^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",19,10212,1,0)
^^1^1^2970710^^
"KRN",19,10212,1,1,0)
View all information for a particular CMOR request.
"KRN",19,10212,25)
INQ^MPIFNQ
"KRN",19,10212,"U")
DISPLAY A CMOR CHANGE REQUEST
"KRN",19,10214,-1)
0^11
"KRN",19,10214,0)
MPIF REVIEW REQUEST^Review Pending Change of CMOR Requests^^R^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",19,10214,1,0)
^^2^2^3010709^
"KRN",19,10214,1,1,0)
This option allows the user to review unprocessed CMOR requests that need
"KRN",19,10214,1,2,0)
to be approved or denied.
"KRN",19,10214,25)
EN^MPIFREV
"KRN",19,10214,"U")
REVIEW PENDING CHANGE OF CMOR 
"KRN",19,10215,-1)
0^10
"KRN",19,10215,0)
MPIF BATCH REVIEW^Batch Review of CMOR Change Requests^^R^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",19,10215,1,0)
^^2^2^3010709^
"KRN",19,10215,1,1,0)
This option allows the processing of pending CMOR requests by station
"KRN",19,10215,1,2,0)
rather than having to enter individual CMOR request numbers.
"KRN",19,10215,25)
BATCH^MPIFREV
"KRN",19,10215,"U")
BATCH REVIEW OF CMOR CHANGE RE
"KRN",19,10230,-1)
0^6
"KRN",19,10230,0)
MPIF NEW REQUEST^Create a New CMOR Change Request^^R^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",19,10230,1,0)
^^2^2^3010709^
"KRN",19,10230,1,1,0)
This option is used to request a change of CMOR from the current CMOR to
"KRN",19,10230,1,2,0)
the facility making the request (i.e., changing the CMOR to your site).
"KRN",19,10230,25)
NEW^MPIFEDIT
"KRN",19,10230,"U")
CREATE A NEW CMOR CHANGE REQUE
"KRN",19,10231,-1)
0^5
"KRN",19,10231,0)
MPIF EDIT REQUEST^Edit Open CMOR Change Request^^R^^^^^^^^MASTER PATIENT INDEX VISTA^^
"KRN",19,10231,1,0)
^^2^2^3010709^
"KRN",19,10231,1,1,0)
This option allows the user to edit existing CMOR change requests that
"KRN",19,10231,1,2,0)
have a status of OPEN.
"KRN",19,10231,20)

"KRN",19,10231,25)
EDIT^MPIFNEW
"KRN",19,10231,"U")
EDIT OPEN CMOR CHANGE REQUEST
"KRN",19,10363,-1)
0^3
"KRN",19,10363,0)
MPIF APPROVED REPORT^Report - CMOR Requests Approved^^R^^^^^^^^MASTER PATIENT INDEX VISTA^^
"KRN",19,10363,1,0)
^^2^2^3010709^
"KRN",19,10363,1,1,0)
This report prints the CMOR requests that have an approved status starting
"KRN",19,10363,1,2,0)
with the date selected by the user.
"KRN",19,10363,20)

"KRN",19,10363,25)
RPT3^MPIFNQ
"KRN",19,10363,"U")
REPORT - CMOR REQUESTS APPROVE
"KRN",19,10364,-1)
0^4
"KRN",19,10364,0)
MPIF DISAPPROVE REPORT^Report - CMOR Requests Disapproved^^R^^^^^^^^
"KRN",19,10364,1,0)
^^2^2^3010709^
"KRN",19,10364,1,1,0)
This report prints the CMOR requests that have a disapproved status
"KRN",19,10364,1,2,0)
starting with the date selected by the user.
"KRN",19,10364,25)
RPT4^MPIFNQ
"KRN",19,10364,"U")
REPORT - CMOR REQUESTS DISAPPR
"KRN",19,10365,-1)
0^2
"KRN",19,10365,0)
MPIF PUSH CMOR^Push CMOR Request^^R^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",19,10365,1,0)
^19.06^2^2^3001206^^
"KRN",19,10365,1,1,0)
This option will allow you to give up being the CMOR and give it to
"KRN",19,10365,1,2,0)
another site.
"KRN",19,10365,25)
NEW^MPIFCMRP
"KRN",19,10365,"U")
PUSH CMOR REQUEST
"KRN",19,10366,-1)
0^12
"KRN",19,10366,0)
MPIF CMOR REQUEST AUTO JOB^AUTO CHANGE CMOR NIGHT JOB^^R^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",19,10366,1,0)
^^3^3^3001206^
"KRN",19,10366,1,1,0)
This job will look at all pending CMOR requests that you have received and
"KRN",19,10366,1,2,0)
if they are older than 14 days, they will be processed as if the auto
"KRN",19,10366,1,3,0)
accept parameter was enabled.
"KRN",19,10366,25)
CHK^MPIFAREQ
"KRN",19,10366,"U")
AUTO CHANGE CMOR NIGHT JOB
"KRN",19,10406,-1)
1^13
"KRN",19,10406,0)
MPIF COMP MAIN
"KRN",19,10407,-1)
1^14
"KRN",19,10407,0)
MPIF CMOR COMP BATCH
"KRN",19,10408,-1)
1^15
"KRN",19,10408,0)
MPIF CMOR COMP STATUS
"KRN",19,10409,-1)
1^16
"KRN",19,10409,0)
MPIF CMOR COMP STOP/RESTART
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",474,-1)
1^1
"PKG",474,0)
MASTER PATIENT INDEX VISTA^MPIF^Master Patient Index VistA side
"PKG",474,20,0)
^9.402P^^
"PKG",474,22,0)
^9.49I^1^1
"PKG",474,22,1,0)
1.0^2990428^2990603^9139
"PKG",474,22,1,"PAH",1,0)
11^3011107^9139
"PKG",474,22,1,"PAH",1,1,0)
^^3^3^3011107
"PKG",474,22,1,"PAH",1,1,1,0)
CMOR REQUEST FIXES
"PKG",474,22,1,"PAH",1,1,2,0)
Refer to patch MPIF*1.0*11 in the FORUM Patch Module for a complete
"PKG",474,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","MPIF111P")
0^^B761614
"RTN","MPIF111P",1,0)
MPIF111P ;CMC/SF-MPI VISTA build post-init ;JUNE 19, 2001
"RTN","MPIF111P",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**11**;30 Apr 99
"RTN","MPIF111P",3,0)
 ;
"RTN","MPIF111P",4,0)
EN ; This post init deletes all entries in the CMOR Change Request file
"RTN","MPIF111P",5,0)
 D BMES^XPDUTL("Removing CMOR Change Request Entries from file 984.9")
"RTN","MPIF111P",6,0)
 N IEN,REQN,DIK,DA,CNT,TEXT
"RTN","MPIF111P",7,0)
 S (REQN,IEN)="",CNT=0
"RTN","MPIF111P",8,0)
 F  S REQN=$O(^MPIF(984.9,"B",REQN)) Q:REQN=""  D
"RTN","MPIF111P",9,0)
 .S IEN=""
"RTN","MPIF111P",10,0)
 .F  S IEN=$O(^MPIF(984.9,"B",REQN,IEN)) Q:IEN=""  D
"RTN","MPIF111P",11,0)
 ..S DA=IEN,DIK="^MPIF(984.9," D ^DIK
"RTN","MPIF111P",12,0)
 ..S CNT=CNT+1
"RTN","MPIF111P",13,0)
 S TEXT=CNT_" Entries deleted from file 984.9"
"RTN","MPIF111P",14,0)
 D BMES^XPDUTL(TEXT)
"RTN","MPIF111P",15,0)
 Q
"RTN","MPIF111P",16,0)
 ;
"RTN","MPIFAREQ")
0^9^B3702537
"RTN","MPIFAREQ",1,0)
MPIFAREQ ;BPCIO/CMC-AUTO ACCEPT REQUESTS NOT PROCEESED ; NOV 16, 2000
"RTN","MPIFAREQ",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**11**;30 Apr 99
"RTN","MPIFAREQ",3,0)
 ;
"RTN","MPIFAREQ",4,0)
 ; If a request goes unprocessed for more than 14 days, it will 
"RTN","MPIFAREQ",5,0)
 ; be processed as if auto-accept was enabled.
"RTN","MPIFAREQ",6,0)
 ;
"RTN","MPIFAREQ",7,0)
 ; This will be a job that will run in the background, nightly
"RTN","MPIFAREQ",8,0)
CHK ;
"RTN","MPIFAREQ",9,0)
 N IEN,RDT,NODE,X,Y,%,NDT,X1,X2,PAT,REQ
"RTN","MPIFAREQ",10,0)
 K ARRAY
"RTN","MPIFAREQ",11,0)
 S (REQ,IEN)=0
"RTN","MPIFAREQ",12,0)
 D NOW^%DTC
"RTN","MPIFAREQ",13,0)
 S NDT=X
"RTN","MPIFAREQ",14,0)
 F  S IEN=$O(^MPIF(984.9,"AC",3,IEN)) Q:IEN=""  D
"RTN","MPIFAREQ",15,0)
 .S NODE=$G(^MPIF(984.9,IEN,0))
"RTN","MPIFAREQ",16,0)
 .S RDT=$P(NODE,"^",3),PAT=$P(NODE,"^",4)
"RTN","MPIFAREQ",17,0)
 .S X1=NDT,X2=RDT
"RTN","MPIFAREQ",18,0)
 .D ^%DTC
"RTN","MPIFAREQ",19,0)
 .I X>14 D
"RTN","MPIFAREQ",20,0)
 ..K ARRAY
"RTN","MPIFAREQ",21,0)
 ..D OTHERS(PAT,IEN,.ARRAY)
"RTN","MPIFAREQ",22,0)
 ..I ARRAY(0)'=0 S REQ=0  F  S REQ=$O(ARRAY(REQ)) Q:REQ=""  D AUTODIS(ARRAY(REQ))
"RTN","MPIFAREQ",23,0)
 ..; ^ automatically disapprove any other requests for this patient that are pending
"RTN","MPIFAREQ",24,0)
 ..D AUTO^MPIFREQ(IEN)
"RTN","MPIFAREQ",25,0)
 ..; ^ auto approve request older than 14 days
"RTN","MPIFAREQ",26,0)
 K ARRAY
"RTN","MPIFAREQ",27,0)
 Q
"RTN","MPIFAREQ",28,0)
 ;
"RTN","MPIFAREQ",29,0)
OTHERS(PT,ENT,ARR) ;
"RTN","MPIFAREQ",30,0)
 N IEN,CNT
"RTN","MPIFAREQ",31,0)
 K ARR
"RTN","MPIFAREQ",32,0)
 S IEN="",CNT=0
"RTN","MPIFAREQ",33,0)
 F  S IEN=$O(^MPIF(984.9,"C",PT,IEN)) Q:IEN=""  D
"RTN","MPIFAREQ",34,0)
 .I IEN'=ENT,$P($G(^MPIF(984.9,IEN,0)),"^",6)=3 D
"RTN","MPIFAREQ",35,0)
 ..S CNT=CNT+1
"RTN","MPIFAREQ",36,0)
 ..S ARR(IEN)=$P($G(^MPIF(984.9,IEN,0)),"^")
"RTN","MPIFAREQ",37,0)
 S ARR(0)=CNT
"RTN","MPIFAREQ",38,0)
 Q
"RTN","MPIFAREQ",39,0)
 ;
"RTN","MPIFAREQ",40,0)
AUTODIS(REQNO) ;
"RTN","MPIFAREQ",41,0)
 N DIE,DA,DR,IEN,NOTES
"RTN","MPIFAREQ",42,0)
 S DIE="^MPIF(984.9,",IEN=$O(^MPIF(984.9,"B",REQNO,""))
"RTN","MPIFAREQ",43,0)
 Q:IEN=""
"RTN","MPIFAREQ",44,0)
 S DA=IEN,NOTES="Multiple Request to Change CMOR, Other Request received 1st"
"RTN","MPIFAREQ",45,0)
 S DR=".06///5;3.01///Automatic Processing;2.02///TODAY;3.02///"_NOTES
"RTN","MPIFAREQ",46,0)
 D ^DIE
"RTN","MPIFAREQ",47,0)
 D EN^MPIFRESS(IEN)
"RTN","MPIFAREQ",48,0)
 Q
"RTN","MPIFCMOR")
0^8^B7636116
"RTN","MPIFCMOR",1,0)
MPIFCMOR ;BHM/RGY-Set and broadcast CMOR changes ;FEB 20, 1998
"RTN","MPIFCMOR",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**1,6,11**;30 Apr 99
"RTN","MPIFCMOR",3,0)
 ;
"RTN","MPIFCMOR",4,0)
 ; Intergation Agreements Utilized:
"RTN","MPIFCMOR",5,0)
 ;   EXC^RGHLLOG    IA #2796
"RTN","MPIFCMOR",6,0)
 ;   START^RGHLLOG  IA #2796
"RTN","MPIFCMOR",7,0)
 ;   STOP^RGHLLOG   IA #2796
"RTN","MPIFCMOR",8,0)
 ;   $$EN^VAFCPID   IA #3015
"RTN","MPIFCMOR",9,0)
 ;
"RTN","MPIFCMOR",10,0)
BROAD(REQNO,ER) ;Broadcase CMOR change to everyone
"RTN","MPIFCMOR",11,0)
 N CN,RGL,HL,CNT,HLA,PDX,ICN,HOME,RGLINK,RGL,TMP,II,CLIENT,HLA,USER,N0,NDATE,RLST,SERVER,ERR
"RTN","MPIFCMOR",12,0)
 S ER=0
"RTN","MPIFCMOR",13,0)
 S SERVER="MPIF CMOR RESULT SERVER"
"RTN","MPIFCMOR",14,0)
 S CLIENT="MPIF CMOR RESULT CLIENT"
"RTN","MPIFCMOR",15,0)
 S N0=$G(^MPIF(984.9,REQNO,0))
"RTN","MPIFCMOR",16,0)
 S DFN=$P(N0,"^",4)
"RTN","MPIFCMOR",17,0)
 S NDATE=$P(N0,"^",3)
"RTN","MPIFCMOR",18,0)
 N X,Y,DIC
"RTN","MPIFCMOR",19,0)
 S DIC="^VA(200,",DIC(0)="MZO",X="`"_+$P(N0,"^",2)
"RTN","MPIFCMOR",20,0)
 D ^DIC
"RTN","MPIFCMOR",21,0)
 I $G(Y)<1 S USER="Automatic Processing"
"RTN","MPIFCMOR",22,0)
 I $G(Y)>0 S USER=$G(Y(0,0))
"RTN","MPIFCMOR",23,0)
 S SITE=+$P($$SITE^VASITE,"^",3)
"RTN","MPIFCMOR",24,0)
 S ICN=$$ICN^MPIFNQ(DFN)
"RTN","MPIFCMOR",25,0)
 S HOME=$P($$MPINODE^MPIFAPI(DFN),"^",3)
"RTN","MPIFCMOR",26,0)
 S CN=+$P($$MPINODE^MPIFAPI(DFN),"^",5)
"RTN","MPIFCMOR",27,0)
 S HL=0,CNT=0
"RTN","MPIFCMOR",28,0)
 K ^XTMP("MPIFCMOR","ERR")
"RTN","MPIFCMOR",29,0)
 D INIT^HLFNC2(SERVER,.HL)
"RTN","MPIFCMOR",30,0)
 I HL S ERR=HL D  Q
"RTN","MPIFCMOR",31,0)
 .D START^RGHLLOG()
"RTN","MPIFCMOR",32,0)
 .D EXC^RGHLLOG(220,"Unable to setup HL7 for Change CMOR Request # "_REQNO_" for ICN= "_ICN,DFN)
"RTN","MPIFCMOR",33,0)
 .D STOP^RGHLLOG()
"RTN","MPIFCMOR",34,0)
 .D RESET(DFN,REQNO)
"RTN","MPIFCMOR",35,0)
 K HLL("LINKS")
"RTN","MPIFCMOR",36,0)
 D LINK^MPIFQUE4
"RTN","MPIFCMOR",37,0)
 I '$D(HLL("LINKS")) D  Q
"RTN","MPIFCMOR",38,0)
 .D START^RGHLLOG()
"RTN","MPIFCMOR",39,0)
 .D EXC^RGHLLOG(224,"No Links found for Change CMOR Request # "_REQNO_" for ICN="_ICN,DFN)
"RTN","MPIFCMOR",40,0)
 .D STOP^RGHLLOG()
"RTN","MPIFCMOR",41,0)
 .D RESET(DFN,REQNO)
"RTN","MPIFCMOR",42,0)
 .S ER="-1^No Links found"
"RTN","MPIFCMOR",43,0)
 ;Broadcase new CMOR to other sites
"RTN","MPIFCMOR",44,0)
 S CNT=CNT+1,HLA("HLS",CNT)="EVN"_HL("FS")_"A31"_HL("FS")_NDATE_HL("FS")_HL("FS")_""_HL("FS")_USER
"RTN","MPIFCMOR",45,0)
 S CNT=CNT+1,PDX=$$EN^VAFCPID(DFN,"1,2,3,5,6,7,8,11,12,13,14,16,17,19")
"RTN","MPIFCMOR",46,0)
 S HLA("HLS",CNT)=PDX
"RTN","MPIFCMOR",47,0)
 S CNT=CNT+1,HLA("HLS",CNT)="PV1"_HL("FS")_HL("FS")_HL("FS")_$P($$NNT^XUAF4(+$P(N0,"^",7)),"^",2)_HL("FS")_HL("FS")_HL("FS")_$P($$SITE^VASITE,"^",3)
"RTN","MPIFCMOR",48,0)
 D GENERATE^HLMA(SERVER,"LM",1,.RLST,"",.HL)
"RTN","MPIFCMOR",49,0)
 I 'RLST D
"RTN","MPIFCMOR",50,0)
 .D START^RGHLLOG()
"RTN","MPIFCMOR",51,0)
 .D EXC^RGHLLOG(220,"Unable to Generate HL7 msg for Change CMOR Request # "_REQNO_" for ICN= "_ICN,DFN)
"RTN","MPIFCMOR",52,0)
 .D STOP^RGHLLOG()
"RTN","MPIFCMOR",53,0)
 .D RESET(DFN,REQNO)
"RTN","MPIFCMOR",54,0)
 .S ER="-1^error in HL7 sending msg"
"RTN","MPIFCMOR",55,0)
 Q
"RTN","MPIFCMOR",56,0)
RESET(DFN,REQNO) ;
"RTN","MPIFCMOR",57,0)
 ; reset status to pending approval and change CMOR to this site
"RTN","MPIFCMOR",58,0)
 N ERR
"RTN","MPIFCMOR",59,0)
 D RESET2^MPIFREQ(REQNO)
"RTN","MPIFCMOR",60,0)
 S ERR=$$CHANGE^MPIF001(DFN,+$$SITE^VASITE)
"RTN","MPIFCMOR",61,0)
 Q
"RTN","MPIFCMOR",62,0)
 ;
"RTN","MPIFCMOR",63,0)
SET(DFN,SITE) ;Set CMOR for patient to site
"RTN","MPIFCMOR",64,0)
 NEW RESULT
"RTN","MPIFCMOR",65,0)
 S RESULT=$$CHANGE^MPIF001(DFN,SITE)
"RTN","MPIFCMOR",66,0)
 Q
"RTN","MPIFCMRP")
0^6^B19402659
"RTN","MPIFCMRP",1,0)
MPIFCMRP ;BPCIO/CMC-PUSHING CMOR TO ANOTHER SITE; NOV 15, 2000
"RTN","MPIFCMRP",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**11**;30 Apr 99
"RTN","MPIFCMRP",3,0)
 ;
"RTN","MPIFCMRP",4,0)
 ; Integration Agreements Utilized:
"RTN","MPIFCMRP",5,0)
 ;
"RTN","MPIFCMRP",6,0)
 ; ^DGCN(391.91   IA #2751
"RTN","MPIFCMRP",7,0)
 ;
"RTN","MPIFCMRP",8,0)
 ;Entry point for option: PUSH CMOR REQUEST - create a new request
"RTN","MPIFCMRP",9,0)
 ; to change CMOR when your site is the CMOR.
"RTN","MPIFCMRP",10,0)
 ; No input or output variables.
"RTN","MPIFCMRP",11,0)
 ;
"RTN","MPIFCMRP",12,0)
 ;Only if the site is the CMOR can this option be used
"RTN","MPIFCMRP",13,0)
 ; note: code here is very similar to MPIFEDIT
"RTN","MPIFCMRP",14,0)
NEW ;
"RTN","MPIFCMRP",15,0)
 N DIC,X,Y,DTOUT,DUOUT,PAT
"RTN","MPIFCMRP",16,0)
 S DIC="^DPT(",DIC(0)="QEAMZ",DIC("A")="Select PATIENT: "
"RTN","MPIFCMRP",17,0)
 D ^DIC
"RTN","MPIFCMRP",18,0)
 Q:$D(DTOUT)!$D(DUOUT)!(Y=-1)
"RTN","MPIFCMRP",19,0)
 S PAT=+Y
"RTN","MPIFCMRP",20,0)
 I +$$GETICN^MPIF001(PAT)<0 W !,"Patient doesn't have ICN, try again" G NEW
"RTN","MPIFCMRP",21,0)
 I $E($$GETICN^MPIF001(PAT),1,3)=$P($$SITE^VASITE(),"^",3) W !,"Patient has a Local ICN, try again" G NEW
"RTN","MPIFCMRP",22,0)
 I $$GETVCCI^MPIF001(PAT)<0 W !,"Patient doesn't have a CMOR, try again" G NEW
"RTN","MPIFCMRP",23,0)
 I $$GETVCCI^MPIF001(PAT)'=$P($$SITE^VASITE(),"^",3) W !,"You are NOT the CMOR, to request to be the CMOR, use option: Create a New CMOR Change Request" G NEW
"RTN","MPIFCMRP",24,0)
 N TMP S TMP=$O(^DGCN(391.91,"APAT",PAT,"")) I $O(^DGCN(391.91,"APAT",PAT,TMP))="" W !,"Patient isn't SHARED - CAN'T change CMOR" Q
"RTN","MPIFCMRP",25,0)
 ; CHECK IF ALREADY OPEN/PENDING REQUEST
"RTN","MPIFCMRP",26,0)
 N ENT,STOP,REQNM
"RTN","MPIFCMRP",27,0)
 S ENT=0,STOP=0 F  S ENT=$O(^MPIF(984.9,"C",PAT,ENT)) Q:ENT=""!(STOP)  D
"RTN","MPIFCMRP",28,0)
 .I $P($G(^MPIF(984.9,ENT,0)),"^",6)<4 S STOP=1
"RTN","MPIFCMRP",29,0)
 I STOP W !!,"Already have request for this patient" G NEW
"RTN","MPIFCMRP",30,0)
 N N0,PHONE,DA,DIE,DR,DIR,ERROR,DIK,Y,DIRUT,REQ,TDA
"RTN","MPIFCMRP",31,0)
 S DA=$$ADD^MPIFNEW(),TDA=DA
"RTN","MPIFCMRP",32,0)
 S DIE="^MPIF(984.9,",DR=".04///`"_PAT D ^DIE
"RTN","MPIFCMRP",33,0)
 S REQ=$P($G(^MPIF(984.9,DA,0)),"^")
"RTN","MPIFCMRP",34,0)
 W !,"REQUEST NUMBER:",REQ
"RTN","MPIFCMRP",35,0)
EDIT I $D(DUZ) D
"RTN","MPIFCMRP",36,0)
 .S PHONE=$P($G(^MPIF(984.9,+$O(^MPIF(984.9,"AD",DUZ,""),-1),0)),"^",5)
"RTN","MPIFCMRP",37,0)
 .N DA,DIC,DIQ S DIQ="REQNM",DR=".01",DIQ(0)="E",DIC="^VA(200,",DA=DUZ
"RTN","MPIFCMRP",38,0)
 .D EN^DIQ1
"RTN","MPIFCMRP",39,0)
 .S REQNM=REQNM(200,DUZ,.01,"E")
"RTN","MPIFCMRP",40,0)
 I '$D(DUZ) S (PHONE,REQNM)=""
"RTN","MPIFCMRP",41,0)
 ;
"RTN","MPIFCMRP",42,0)
REASON S DIR("A")="Reason for Request",DIR("?")="Answer must be 3-60 characters in length.",DIR(0)="F^3:60" D ^DIR
"RTN","MPIFCMRP",43,0)
 I Y="" W !,"Answer must be 3-60 characters in length." G REASON
"RTN","MPIFCMRP",44,0)
 I Y="^" S DIK="^MPIF(984.9," D ^DIK W "... Request deleted" Q
"RTN","MPIFCMRP",45,0)
 S DIE="^MPIF(984.9,",DR="1.02///"_X D ^DIE
"RTN","MPIFCMRP",46,0)
REQNM S DIR("A")="Requestor's Name:",DIR("B")=REQNM,DIR("?")="Answer must be a valid user",DIR(0)="P^200:EQZ" D ^DIR K DIR("B")
"RTN","MPIFCMRP",47,0)
 I Y="" W !,"Must pick valid user" G REQNM
"RTN","MPIFCMRP",48,0)
 I Y="^" S DIK="^MPIF(984.9," D ^DIK W "... Request deleted" Q
"RTN","MPIFCMRP",49,0)
 S DIE="^MPIF(984.9,",DR=".02///`"_+Y D ^DIE
"RTN","MPIFCMRP",50,0)
PHONE S DIR("A")="Requestor's Phone:",DIR("B")=PHONE,DIR("?")="Answer must be 4-20 charaters in length.",DIR(0)="F" D ^DIR K DIR("B")
"RTN","MPIFCMRP",51,0)
 I Y="" W !,"Answer must be 4-20 charaters in length."  G PHONE
"RTN","MPIFCMRP",52,0)
 I Y="^" S DIK="^MPIF(984.9," D ^DIK W "... Request deleted" Q
"RTN","MPIFCMRP",53,0)
 S DIE="^MPIF(984.9,",DR=".05///"_X D ^DIE
"RTN","MPIFCMRP",54,0)
 ;
"RTN","MPIFCMRP",55,0)
CMOR S DIC("A")="Select Site to Be CMOR: ",DIC="^DIC(4,",DIC(0)="QEAM",DIC("S")="I $D(^DGCN(391.91,""APAT"",PAT,Y))"
"RTN","MPIFCMRP",56,0)
 D ^DIC
"RTN","MPIFCMRP",57,0)
 I Y="^" S DIK="^MPIF(984.9," D ^DIK W "... Request deleted" Q
"RTN","MPIFCMRP",58,0)
 N TSITE S TSITE=+Y
"RTN","MPIFCMRP",59,0)
 S DIE="^MPIF(984.9,",DR=".07///`"_TSITE_";1.03///3;.09///`"_TSITE D ^DIE
"RTN","MPIFCMRP",60,0)
 ;update site, type of action and cmor after approval
"RTN","MPIFCMRP",61,0)
 ;
"RTN","MPIFCMRP",62,0)
 I $$CHK^MPIFEDIT(DA) W !,"This request is missing required data." G EDIT
"RTN","MPIFCMRP",63,0)
 ;
"RTN","MPIFCMRP",64,0)
APP S DIR("A")="Select Request Action (SEND/EDIT/DELETE)? ",DIR("B")="SEND",DIR(0)="SAO^SEND:SEND;EDIT:EDIT;DELETE:DELETE"
"RTN","MPIFCMRP",65,0)
 D ^DIR K DIR
"RTN","MPIFCMRP",66,0)
 S DA=TDA
"RTN","MPIFCMRP",67,0)
 I $E(Y)="D"!$D(DIRUT) D  Q
"RTN","MPIFCMRP",68,0)
 .S DIK="^MPIF(984.9," D ^DIK W "... Request deleted"
"RTN","MPIFCMRP",69,0)
 .Q
"RTN","MPIFCMRP",70,0)
 I $E(Y)="E" G REASON
"RTN","MPIFCMRP",71,0)
 S DR=".08////^S X=2;.06////^S X=2",DIE="^MPIF(984.9," D ^DIE W !,"... Request will be sent"
"RTN","MPIFCMRP",72,0)
 ; removed event queue due to delivery issues - this msg must be sent first followed by the actual change cmor msg.
"RTN","MPIFCMRP",73,0)
 N ERR,MPIFHL7 S ERR="ERRS",MPIFHL7=""
"RTN","MPIFCMRP",74,0)
 D EN^MPIFREQ("CMOR CHANGE REQUEST",DA,.ERR,MPIFHL7)
"RTN","MPIFCMRP",75,0)
 ;
"RTN","MPIFCMRP",76,0)
 ;NOW CHANGE CMOR AND SEND CHANGE CMOR MESSAGE
"RTN","MPIFCMRP",77,0)
 N TEXT,DIR,DR,CMOR,TMP,ERROR
"RTN","MPIFCMRP",78,0)
 S TEXT="Auto change - pushed CMOR",ERROR=0
"RTN","MPIFCMRP",79,0)
 S DIE="^MPIF(984.9,",DA=TDA,DR=".06///^S X=4;3.01///^S X=TEXT"
"RTN","MPIFCMRP",80,0)
 D ^DIE
"RTN","MPIFCMRP",81,0)
 S CMOR=$P($G(^MPIF(984.9,TDA,0)),"^",7)
"RTN","MPIFCMRP",82,0)
 I CMOR="" D  Q
"RTN","MPIFCMRP",83,0)
 .W !,"New CMOR Not Defined, edit request"
"RTN","MPIFCMRP",84,0)
 .S ^DIE="^MPIF(984.9,",DA=TDA,DR=".06///^S X=1" D ^DIE
"RTN","MPIFCMRP",85,0)
 S TMP=$$CHANGE^MPIF001(PAT,CMOR)
"RTN","MPIFCMRP",86,0)
 I +TMP<0 S ^DIE="^MPIF(984.9,",DA=TDA,DR=".06///^S X=1" D ^DIE Q
"RTN","MPIFCMRP",87,0)
 D BROAD^MPIFCMOR(DA,.ERROR)
"RTN","MPIFCMRP",88,0)
 Q
"RTN","MPIFEDIT")
0^5^B14400463
"RTN","MPIFEDIT",1,0)
MPIFEDIT ;BHM/RGY-Request a CMOR for patient ;FEB 20, 1998
"RTN","MPIFEDIT",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**11**;30 Apr 99
"RTN","MPIFEDIT",3,0)
 ;
"RTN","MPIFEDIT",4,0)
 ; Integration Agreements Utilized:
"RTN","MPIFEDIT",5,0)
 ;
"RTN","MPIFEDIT",6,0)
 ; EN^RGEQ    IA #2792
"RTN","MPIFEDIT",7,0)
 ;
"RTN","MPIFEDIT",8,0)
NEW ;
"RTN","MPIFEDIT",9,0)
 ;Entry point for option: MPIF NEW REQUEST - create a new request
"RTN","MPIFEDIT",10,0)
 ; to change CMOR.  No input or output variables.
"RTN","MPIFEDIT",11,0)
 ;
"RTN","MPIFEDIT",12,0)
 ;Only if the site is not the CMOR can this option be used
"RTN","MPIFEDIT",13,0)
 N DIC,X,Y,DTOUT,DUOUT,PAT
"RTN","MPIFEDIT",14,0)
 S DIC="^DPT(",DIC(0)="QEAMZ",DIC("A")="Select PATIENT: "
"RTN","MPIFEDIT",15,0)
 D ^DIC
"RTN","MPIFEDIT",16,0)
 Q:$D(DTOUT)!$D(DUOUT)!(Y=-1)
"RTN","MPIFEDIT",17,0)
 S PAT=+Y
"RTN","MPIFEDIT",18,0)
 I +$$GETICN^MPIF001(PAT)<0 W !!,"Patient doesn't have ICN, try again" G NEW
"RTN","MPIFEDIT",19,0)
 I $$GETVCCI^MPIF001(PAT)<0 W !!,"Patient doesn't have a CMOR, try again" G NEW
"RTN","MPIFEDIT",20,0)
 I $$GETVCCI^MPIF001(PAT)=$P($$SITE^VASITE(),"^",3) W !!,"You are the CMOR, to push the CMOR to another site use option: PUSH CMOR REQUEST" G NEW
"RTN","MPIFEDIT",21,0)
 ; CHECK IF ALREADY OPEN/PENDING REQUEST
"RTN","MPIFEDIT",22,0)
 N ENT,STOP
"RTN","MPIFEDIT",23,0)
 S ENT=0,STOP=0 F  S ENT=$O(^MPIF(984.9,"C",PAT,ENT)) Q:ENT=""!(STOP)  D
"RTN","MPIFEDIT",24,0)
 .I $P($G(^MPIF(984.9,ENT,0)),"^",6)<4 S STOP=1
"RTN","MPIFEDIT",25,0)
 I STOP W !!,"Already have request for this patient" G NEW
"RTN","MPIFEDIT",26,0)
 ;
"RTN","MPIFEDIT",27,0)
 N N0,PHONE,DA,DIE,DR,DIR,ERROR,DIK,Y,DIRUT,REQ,CMOR,REQNM
"RTN","MPIFEDIT",28,0)
 S DA=$$ADD^MPIFNEW()
"RTN","MPIFEDIT",29,0)
 S DIE="^MPIF(984.9,",DR=".04///`"_PAT D ^DIE
"RTN","MPIFEDIT",30,0)
 S REQ=$P($G(^MPIF(984.9,DA,0)),"^")
"RTN","MPIFEDIT",31,0)
 W !,"REQUEST NUMBER:",REQ
"RTN","MPIFEDIT",32,0)
 S CMOR=$$HL7CMOR^MPIF001($P($G(^MPIF(984.9,DA,0)),"^",4),"^")
"RTN","MPIFEDIT",33,0)
 ;station # ^ Station Name
"RTN","MPIFEDIT",34,0)
 W !,"*** Current CMOR: "_$P(CMOR,"^",2)_" ("_+CMOR_") ***"
"RTN","MPIFEDIT",35,0)
 S DIE="^MPIF(984.9,",DR=".07///"_+CMOR_";1.03///1;.09///`"_+$$SITE^VASITE() D ^DIE
"RTN","MPIFEDIT",36,0)
 ; ^ update site, type of action, and cmor after approval
"RTN","MPIFEDIT",37,0)
 ;
"RTN","MPIFEDIT",38,0)
EDIT I $D(DUZ) D
"RTN","MPIFEDIT",39,0)
 .S PHONE=$P($G(^MPIF(984.9,+$O(^MPIF(984.9,"AD",DUZ,""),-1),0)),"^",5)
"RTN","MPIFEDIT",40,0)
 .N DA,DIC,DIQ S DIQ="REQNM",DR=".01",DIQ(0)="E",DIC="^VA(200,",DA=DUZ
"RTN","MPIFEDIT",41,0)
 .D EN^DIQ1
"RTN","MPIFEDIT",42,0)
 .S REQNM=REQNM(200,DUZ,.01,"E")
"RTN","MPIFEDIT",43,0)
 I '$D(DUZ) S (REQNM,PHONE)=""
"RTN","MPIFEDIT",44,0)
 ;
"RTN","MPIFEDIT",45,0)
REASON S DIR("A")="Reason for Request",DIR("?")="Answer must be 3-60 characters in length.",DIR(0)="F^3:60" D ^DIR
"RTN","MPIFEDIT",46,0)
 I Y="" W !,"Answer must be 3-60 characters in length." G REASON
"RTN","MPIFEDIT",47,0)
 I Y="^" S DIK="^MPIF(984.9," D ^DIK W "... Request deleted" Q
"RTN","MPIFEDIT",48,0)
 S DIE="^MPIF(984.9,",DR="1.02///"_X D ^DIE
"RTN","MPIFEDIT",49,0)
REQNM S DIR("A")="Requestor's Name:",DIR("B")=REQNM,DIR("?")="Answer must be a valid user",DIR(0)="P^200:EQZ" D ^DIR K DIR("B")
"RTN","MPIFEDIT",50,0)
 I Y="" W !,"Must pick valid user" G REQNM
"RTN","MPIFEDIT",51,0)
 I Y="^" S DIK="^MPIF(984.9," D ^DIK W "... Request deleted" Q
"RTN","MPIFEDIT",52,0)
 S DIE="^MPIF(984.9,",DR=".02///`"_+Y D ^DIE
"RTN","MPIFEDIT",53,0)
PHONE S DIR("A")="Requestor Phone:",DIR("B")=PHONE,DIR("?")="Answer must be 4-20 charaters in length.",DIR(0)="F" D ^DIR K DIR("B")
"RTN","MPIFEDIT",54,0)
 I Y="" W !,"Answer must be 4-20 charaters in length."  G PHONE
"RTN","MPIFEDIT",55,0)
 I Y="^" S DIK="^MPIF(984.9," D ^DIK W "... Request deleted" Q
"RTN","MPIFEDIT",56,0)
 S DIE="^MPIF(984.9,",DR=".05///"_X D ^DIE
"RTN","MPIFEDIT",57,0)
 I $$CHK^MPIFEDIT(DA) W !,"This request is missing required data." G EDIT
"RTN","MPIFEDIT",58,0)
 ;
"RTN","MPIFEDIT",59,0)
APP S DIR("A")="Select Request Action (SEND/EDIT/DELETE)? ",DIR("B")="SEND",DIR(0)="SAO^SEND:SEND;EDIT:EDIT;DELETE:DELETE"
"RTN","MPIFEDIT",60,0)
 D ^DIR K DIR
"RTN","MPIFEDIT",61,0)
 I $E(Y)="D"!$D(DIRUT) D  Q
"RTN","MPIFEDIT",62,0)
 .S DIK="^MPIF(984.9," D ^DIK W "... Request deleted"
"RTN","MPIFEDIT",63,0)
 .Q
"RTN","MPIFEDIT",64,0)
 I $E(Y)="E" G REASON
"RTN","MPIFEDIT",65,0)
 S DR=".08////^S X=2;.06////^S X=2",DIE="^MPIF(984.9," D ^DIE W !,"... Request will be sent"
"RTN","MPIFEDIT",66,0)
 D EN^RGEQ("MPIF CMOR REQUEST",DA)
"RTN","MPIFEDIT",67,0)
 Q
"RTN","MPIFEDIT",68,0)
CHK(IEN) ;
"RTN","MPIFEDIT",69,0)
 NEW X,ERROR
"RTN","MPIFEDIT",70,0)
 S ERROR=0
"RTN","MPIFEDIT",71,0)
 S N0=$G(^MPIF(984.9,IEN,0))
"RTN","MPIFEDIT",72,0)
 F X=1:1:7 I $P(N0,"^",X)="" S ERROR=1 Q
"RTN","MPIFEDIT",73,0)
 I $P($G(^MPIF(984.9,IEN,1)),"^",2)="" S ERROR=1
"RTN","MPIFEDIT",74,0)
 Q ERROR
"RTN","MPIFHL7")
0^11^B1609123
"RTN","MPIFHL7",1,0)
MPIFHL7 ;BHM/RGY-Processing incoming hl7 message ;FEB 20, 1998
"RTN","MPIFHL7",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**1,6,11**;30 Apr 99
"RTN","MPIFHL7",3,0)
IN ;
"RTN","MPIFHL7",4,0)
 ;Entry point used for MPIF CMOR RESPONSE protocol
"RTN","MPIFHL7",5,0)
 ; It process the inbound HL7 message to update CMOR
"RTN","MPIFHL7",6,0)
 N I,PHONE,COMMENTS,STATUS,ID,SITE,NDATE,USER,INST,ICN,HLNODE,HLQUIT,RES,CMOR
"RTN","MPIFHL7",7,0)
 S HLQUIT="",ID=""
"RTN","MPIFHL7",8,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","MPIFHL7",9,0)
 .I $P(HLNODE,HL("FS"),1)="NTE" D
"RTN","MPIFHL7",10,0)
 ..S PHONE=$P(HLNODE,HL("FS"),4)
"RTN","MPIFHL7",11,0)
 ..S COMMENTS=$P(HLNODE,HL("FS"),5)
"RTN","MPIFHL7",12,0)
 ..S STATUS=$P(HLNODE,HL("FS"),6)
"RTN","MPIFHL7",13,0)
 ..S ID=$P(HLNODE,HL("FS"),7)
"RTN","MPIFHL7",14,0)
 ..S SITE=$P(HLNODE,HL("FS"),8)
"RTN","MPIFHL7",15,0)
 .I $P(HLNODE,HL("FS"),1)="EVN" D
"RTN","MPIFHL7",16,0)
 ..S NDATE=$P(HLNODE,HL("FS"),3)
"RTN","MPIFHL7",17,0)
 ..S USER=$P(HLNODE,HL("FS"),6)
"RTN","MPIFHL7",18,0)
 .I $P(HLNODE,HL("FS"),1)="PID" S ICN=+$P(HLNODE,HL("FS"),3)
"RTN","MPIFHL7",19,0)
 .I $P(HLNODE,HL("FS"),1)="PV1" S SITE=+$P(HLNODE,HL("FS"),4)
"RTN","MPIFHL7",20,0)
 I $G(SITE) S SITE=$$LKUP^XUAF4(SITE)
"RTN","MPIFHL7",21,0)
 N DFN
"RTN","MPIFHL7",22,0)
 S RES=1,DFN=$$GETDFN^MPIF001(ICN)
"RTN","MPIFHL7",23,0)
 S CMOR=$$GETVCCI^MPIF001(DFN)
"RTN","MPIFHL7",24,0)
 ;PROCESSING CMOR CHANGE REQUEST
"RTN","MPIFHL7",25,0)
 D IN^MPIFREQ(SITE,USER,COMMENTS,NDATE,ICN,PHONE,ID)
"RTN","MPIFHL7",26,0)
 Q
"RTN","MPIFNEW")
0^13^B3287153
"RTN","MPIFNEW",1,0)
MPIFNEW ;BHM/RGY-Create new request for patient demographic change ;FEB 20, 1998
"RTN","MPIFNEW",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA **11**;;30 Apr 99
"RTN","MPIFNEW",3,0)
ADD(RNO) ;
"RTN","MPIFNEW",4,0)
 ;This function allows the addition of new CMOR Change requests to be
"RTN","MPIFNEW",5,0)
 ;added to the 984.9 file
"RTN","MPIFNEW",6,0)
 ; RNO - is the site making the request, optional
"RTN","MPIFNEW",7,0)
 ;Returned:  is the IEN of the new entry in 984.9
"RTN","MPIFNEW",8,0)
 ;  OR 0 if no entry is added.
"RTN","MPIFNEW",9,0)
 ;
"RTN","MPIFNEW",10,0)
 N DIC,D0,DIE,DA,X,DLAYGO,DR,RGOK,EVN,DINUM
"RTN","MPIFNEW",11,0)
 S RNO=$G(RNO)
"RTN","MPIFNEW",12,0)
 F EVN=+$P(^MPIF(984.9,0),"^",3)+1:1 L +^MPIF(984.9,EVN):0 I $T S RGOK=0 D  L -^MPIF(984.9,EVN) Q:RGOK
"RTN","MPIFNEW",13,0)
 .I $D(^MPIF(984.9,EVN)) Q
"RTN","MPIFNEW",14,0)
 .S DINUM=EVN,DIC="^MPIF(984.9,",DIC(0)="L",DLAYGO=984.9,X=$S(RNO="":$P($$SITE^VASITE(),"^",3)_"-"_EVN,1:RNO) K DD,D0 D FILE^DICN K DIC,DLAYGO,D0
"RTN","MPIFNEW",15,0)
 .S DIE="^MPIF(984.9,",DR="[MPIF OPEN REQUEST]",DA=EVN D ^DIE
"RTN","MPIFNEW",16,0)
 .S RGOK=1
"RTN","MPIFNEW",17,0)
 .Q
"RTN","MPIFNEW",18,0)
Q Q EVN
"RTN","MPIFNEW",19,0)
 ;
"RTN","MPIFNEW",20,0)
EDIT ; edit existing Requests that have a status of OPEN
"RTN","MPIFNEW",21,0)
 ;select a patient to edit request
"RTN","MPIFNEW",22,0)
 ;
"RTN","MPIFNEW",23,0)
 N ERR,PT,Y
"RTN","MPIFNEW",24,0)
 S DIC="^MPIF(984.9,",DIC(0)="AEMQZ",DIC("A")="Select Patient's Request you would like to edit (Must have a Status of Open): ",DIC("S")="I $D(^MPIF(984.9,""AC"",1,Y))"
"RTN","MPIFNEW",25,0)
 D ^DIC
"RTN","MPIFNEW",26,0)
 Q:+Y<0
"RTN","MPIFNEW",27,0)
 S PT=$P(^MPIF(984.9,+Y,0),"^",4)
"RTN","MPIFNEW",28,0)
 I +PT<0 W !,"No Patient associated with this Request." Q
"RTN","MPIFNEW",29,0)
 S DA=+Y
"RTN","MPIFNEW",30,0)
 D EDIT^MPIFEDIT
"RTN","MPIFNEW",31,0)
 K DA,ERR
"RTN","MPIFNEW",32,0)
 Q
"RTN","MPIFNQ")
0^7^B9397863
"RTN","MPIFNQ",1,0)
MPIFNQ ;BHM/RGY-Miscellaneous functions for CMOR ;FEB 20, 1998
"RTN","MPIFNQ",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**11**;30 Apr 99
"RTN","MPIFNQ",3,0)
 ;
"RTN","MPIFNQ",4,0)
 ; Integration Agreements Utilized:
"RTN","MPIFNQ",5,0)
 ;
"RTN","MPIFNQ",6,0)
 ; ^RGSITE(991.8,     IA #2746
"RTN","MPIFNQ",7,0)
 ;
"RTN","MPIFNQ",8,0)
 ;
"RTN","MPIFNQ",9,0)
PAT(IEN) ;Return patient CMOR (Site IEN)
"RTN","MPIFNQ",10,0)
 NEW RESULT
"RTN","MPIFNQ",11,0)
 S RESULT=$$GETVCCI^MPIF001(IEN)
"RTN","MPIFNQ",12,0)
 I RESULT<0 Q ""
"RTN","MPIFNQ",13,0)
 Q RESULT
"RTN","MPIFNQ",14,0)
ICN(IEN) ;Return patient ICN
"RTN","MPIFNQ",15,0)
 NEW RESULT
"RTN","MPIFNQ",16,0)
 S RESULT=$$GETICN^MPIF001(IEN)
"RTN","MPIFNQ",17,0)
 I RESULT<0 Q ""
"RTN","MPIFNQ",18,0)
 Q +RESULT
"RTN","MPIFNQ",19,0)
IEN(ICN) ;Return patient IEN
"RTN","MPIFNQ",20,0)
 NEW RESULT
"RTN","MPIFNQ",21,0)
 S RESULT=$$GETDFN^MPIF001(ICN)
"RTN","MPIFNQ",22,0)
 I RESULT<0 Q ""
"RTN","MPIFNQ",23,0)
 Q RESULT
"RTN","MPIFNQ",24,0)
AUTO() ;
"RTN","MPIFNQ",25,0)
 NEW TMX
"RTN","MPIFNQ",26,0)
 S TMX=+$P($G(^RGSITE(991.8,1,0)),"^",2)
"RTN","MPIFNQ",27,0)
 S:TMX'=1&(TMX'=0) TMX=0
"RTN","MPIFNQ",28,0)
 Q TMX
"RTN","MPIFNQ",29,0)
RPT1 ;
"RTN","MPIFNQ",30,0)
 ; Entry point for option MPIF SENT REQUEST.  This option prints
"RTN","MPIFNQ",31,0)
 ; all outstanding requests for Change of CMOR that this site has sent.
"RTN","MPIFNQ",32,0)
 ; NO input or output variables.
"RTN","MPIFNQ",33,0)
 N X1,X2,Y,USER,AGE,DIC,L,BY,FLDS,FROM,TO,DIR,DTOUT,DUTOUT,DIROUT,DIRUT,X
"RTN","MPIFNQ",34,0)
 S USER=""
"RTN","MPIFNQ",35,0)
 S DIR("A")="Do you only want to list the requests you entered? ",DIR("B")="YES",DIR(0)="YAO" D ^DIR K DIR Q:$D(DIRUT)
"RTN","MPIFNQ",36,0)
 I Y=1 S USER=DUZ
"RTN","MPIFNQ",37,0)
 S DIR("A")="Display requests entered on or before date: ",DIR("B")="TODAY",DIR(0)="DAO^::EP" D ^DIR K DIR Q:$D(DIRUT)
"RTN","MPIFNQ",38,0)
 S X2=Y,X1=DT D D^%DTC
"RTN","MPIFNQ",39,0)
 S AGE=X
"RTN","MPIFNQ",40,0)
 S DIC="^MPIF(984.9,",FLDS="[MPIF OUTSTANDING REQUESTS]",L=0
"RTN","MPIFNQ",41,0)
 S BY="[MPIF REQUEST SORT]",FR=",,2,"_USER_","_AGE,TO=",,2,"_USER_","
"RTN","MPIFNQ",42,0)
 D EN1^DIP
"RTN","MPIFNQ",43,0)
 Q
"RTN","MPIFNQ",44,0)
RPT2 ;
"RTN","MPIFNQ",45,0)
 ; Entry point for option:  MPIF RECEIVED REQUESTS to list all change 
"RTN","MPIFNQ",46,0)
 ; of CMOR requests that are still outstanding for review/processing
"RTN","MPIFNQ",47,0)
 ; NO input or output variables.
"RTN","MPIFNQ",48,0)
 N DIC,L,BY,FLDS,FROM,TO,DIR,DTOUT,DUTOUT,DIROUT
"RTN","MPIFNQ",49,0)
 S DIC="^MPIF(984.9,",FLDS="[MPIF OUTSTANDING REQUESTS]",L=0
"RTN","MPIFNQ",50,0)
 S BY="[MPIF PENDING REQUESTS]",FR="",TO=""
"RTN","MPIFNQ",51,0)
 D EN1^DIP
"RTN","MPIFNQ",52,0)
 Q
"RTN","MPIFNQ",53,0)
INQ ;View CMOR request
"RTN","MPIFNQ",54,0)
 N DIC,FLDS,FR,TO,L,BY,Y
"RTN","MPIFNQ",55,0)
ASK S DIC="^MPIF(984.9,",DIC(0)="QEAM",DIC("A")="Select Request #: " D ^DIC Q:+Y<0
"RTN","MPIFNQ",56,0)
 S FR=+Y,TO=+Y,L=0,FLDS="[MPIF REQUEST VIEW]",BY="@NUMBER" D EN1^DIP
"RTN","MPIFNQ",57,0)
 G ASK
"RTN","MPIFNQ",58,0)
 Q
"RTN","MPIFNQ",59,0)
RPT3 ; entry point for Approved Requests
"RTN","MPIFNQ",60,0)
 ;No input of output variables
"RTN","MPIFNQ",61,0)
 N FR,DIC,L,BY,FLDS,FROM,TO,DIR,DTOUT,DUTOUT,DIROUT,DIRUT,X
"RTN","MPIFNQ",62,0)
 S DIR("A")="Display requests APPROVED on or SINCE (date): ",DIR("B")="T-10",DIR(0)="DAO^::EP" D ^DIR K DIR Q:$D(DIRUT)
"RTN","MPIFNQ",63,0)
 S FROM=Y
"RTN","MPIFNQ",64,0)
 S DIC="^MPIF(984.9,",FLDS=".06,.01,2.02,.04,.07,1.02,.03"
"RTN","MPIFNQ",65,0)
 S BY=".06,2.02,.04"
"RTN","MPIFNQ",66,0)
 S FR="4,"_FROM_","
"RTN","MPIFNQ",67,0)
 S TO="4,,"
"RTN","MPIFNQ",68,0)
 D EN1^DIP
"RTN","MPIFNQ",69,0)
 Q
"RTN","MPIFNQ",70,0)
RPT4 ; entry point for Disapproved Requests
"RTN","MPIFNQ",71,0)
 ;No input of output variables
"RTN","MPIFNQ",72,0)
 N FR,DIC,L,BY,FLDS,FROM,TO,DIR,DTOUT,DUTOUT,DIROUT,DIRUT,X
"RTN","MPIFNQ",73,0)
 S DIR("A")="Display requests DISAPPROVED on or SINCE (date): ",DIR("B")="T-10",DIR(0)="DAO^::EP" D ^DIR K DIR Q:$D(DIRUT)
"RTN","MPIFNQ",74,0)
 S FROM=Y
"RTN","MPIFNQ",75,0)
 S DIC="^MPIF(984.9,",FLDS=".06,.01,2.02,.04,.07,1.02,.03,3.02"
"RTN","MPIFNQ",76,0)
 S BY=".06,2.02,.04"
"RTN","MPIFNQ",77,0)
 S FR="5,"_FROM_","
"RTN","MPIFNQ",78,0)
 S TO="5,,"
"RTN","MPIFNQ",79,0)
 D EN1^DIP
"RTN","MPIFNQ",80,0)
 Q
"RTN","MPIFQUE4")
0^2^B57552946
"RTN","MPIFQUE4",1,0)
MPIFQUE4 ;SF/TNV-Process the CMOR COMPARISON request ;FEB 25, 1998
"RTN","MPIFQUE4",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**1,3,11**;30 Apr 99
"RTN","MPIFQUE4",3,0)
 ;
"RTN","MPIFQUE4",4,0)
 ; Integration Agreements Utilized:
"RTN","MPIFQUE4",5,0)
 ;
"RTN","MPIFQUE4",6,0)
 ;   EXC^RGHLLOG     IA #2796
"RTN","MPIFQUE4",7,0)
 ;   START^RGHLLOG   IA #2796
"RTN","MPIFQUE4",8,0)
 ;   STOP^RGHLLOG    IA #2796
"RTN","MPIFQUE4",9,0)
 ;   CALC^RGVCCMR2   IA #2710
"RTN","MPIFQUE4",10,0)
 ;   $$EN^VAFCPID    IA #3015
"RTN","MPIFQUE4",11,0)
 ;
"RTN","MPIFQUE4",12,0)
 ; 
"RTN","MPIFQUE4",13,0)
 ; This routine will process the batch message from the sending CMOR
"RTN","MPIFQUE4",14,0)
 ; who wished to change the patient CMOR from you to their own.
"RTN","MPIFQUE4",15,0)
 ; PLEASE NOTE THAT THIS PROCESS WILL NOT BE TRACKED AS CMOR REQUEST
"RTN","MPIFQUE4",16,0)
 ; EVENT. SO NOTHING WILL BE RECORDED IN THAT FILE. (PER SRS 9-18-97)
"RTN","MPIFQUE4",17,0)
 ; Approving process:
"RTN","MPIFQUE4",18,0)
 ; The sender will give the CMOR score and the date for a patient
"RTN","MPIFQUE4",19,0)
 ; The receiver will look into the CMOR score on the system and compare
"RTN","MPIFQUE4",20,0)
 ; the date if the date is less than 90 days. Go and use the Current
"RTN","MPIFQUE4",21,0)
 ; CMOR score and compare. If the incoming CMOR score is 80% or more than
"RTN","MPIFQUE4",22,0)
 ; the system CMOR score. CMOR site will be changed to the requesting CMOR
"RTN","MPIFQUE4",23,0)
 ; site. An approved HL7 message will be send to ALL SITES in the
"RTN","MPIFQUE4",24,0)
 ; subscriber list and notify them the new CMOR site. MPI is included.
"RTN","MPIFQUE4",25,0)
 ; If the score is equal or greater than 90 days. CMOR score will be
"RTN","MPIFQUE4",26,0)
 ; recalulated for this patient and compare. Same process as above.
"RTN","MPIFQUE4",27,0)
 ; If the incoming CMOR score is not higher than 80% nothing will happen.
"RTN","MPIFQUE4",28,0)
BEGIN ; Entry point for CMOR COMPARISON request to process.
"RTN","MPIFQUE4",29,0)
 ; NO input or output variables
"RTN","MPIFQUE4",30,0)
 N IEN,RGLOG
"RTN","MPIFQUE4",31,0)
 K RGL
"RTN","MPIFQUE4",32,0)
 D NOW^%DTC
"RTN","MPIFQUE4",33,0)
 S ZTIO="",ZTDTH=%,ZTRTN="EN^MPIFQUE4"
"RTN","MPIFQUE4",34,0)
 S ZTDESC="BACKGROUND CMOR COMPARISON"
"RTN","MPIFQUE4",35,0)
 S ZTSAVE("HL*")=""
"RTN","MPIFQUE4",36,0)
 D ^%ZTLOAD,CLEAN
"RTN","MPIFQUE4",37,0)
 K COUNT,RGL,%,ZTIO,ZTDTH,ZTRTN,ZTDESC,ZTSAVE
"RTN","MPIFQUE4",38,0)
 Q
"RTN","MPIFQUE4",39,0)
 ;
"RTN","MPIFQUE4",40,0)
EN ; Background job to run for cmor comparison
"RTN","MPIFQUE4",41,0)
 K ERROR,MPICNT
"RTN","MPIFQUE4",42,0)
 N MPII,U,LINE,PARENT,COUNT,NDATE,IKI,MPIFFS,MPIFSFS,MPIFREAP,RGLOG
"RTN","MPIFQUE4",43,0)
 S MPIFFS=HL("FS"),MPIFSFS=$E(HL("ECH"),1),MPIFREAP=$E(HL("ECH"),2)
"RTN","MPIFQUE4",44,0)
 D START^RGHLLOG()
"RTN","MPIFQUE4",45,0)
 S U="^",(COUNT,MPICNT)=0
"RTN","MPIFQUE4",46,0)
 F MPII=1:1 X HLNEXT Q:HLQUIT'>0!($D(ERROR))  G:$$S^%ZTLOAD CLEAN D
"RTN","MPIFQUE4",47,0)
 . S LINE=HLNODE
"RTN","MPIFQUE4",48,0)
 . I $P(LINE,MPIFFS)["MSH" D MSH
"RTN","MPIFQUE4",49,0)
 . I $P(LINE,MPIFFS)["NTE" D NTE
"RTN","MPIFQUE4",50,0)
 . I $P(LINE,MPIFFS)["PID" D PID
"RTN","MPIFQUE4",51,0)
 . I $P(LINE,MPIFFS)["EVN" D EVN
"RTN","MPIFQUE4",52,0)
 . I COUNT=4,'$D(ERROR) D PROCES
"RTN","MPIFQUE4",53,0)
 K SERVER,CLIENT,ERROR
"RTN","MPIFQUE4",54,0)
 D STOP^RGHLLOG()
"RTN","MPIFQUE4",55,0)
 S ZTREQ="@"
"RTN","MPIFQUE4",56,0)
 Q
"RTN","MPIFQUE4",57,0)
 ;
"RTN","MPIFQUE4",58,0)
MSH ; Process MSH segment
"RTN","MPIFQUE4",59,0)
 S COUNT=COUNT+1
"RTN","MPIFQUE4",60,0)
 Q
"RTN","MPIFQUE4",61,0)
 ;
"RTN","MPIFQUE4",62,0)
NTE ; Process NTE segment
"RTN","MPIFQUE4",63,0)
 S COUNT=COUNT+1
"RTN","MPIFQUE4",64,0)
 S SITE=$P(LINE,MPIFFS,3)
"RTN","MPIFQUE4",65,0)
 I SITE="" S ERROR="HL7 Msg# "_$G(HL("MID"))_" is missing CMOR for ICN# "_$G(ICN) D EXC^RGHLLOG(221,ERROR) Q
"RTN","MPIFQUE4",66,0)
 S REASON=$P(LINE,MPIFFS,2)
"RTN","MPIFQUE4",67,0)
 I REASON'="COMPARISON" S ERROR="HL7 Msg# "_$G(HL("MID"))_" contained a unknown request reason for ICN# "_$G(ICN) D EXC^RGHLLOG(222,ERROR)
"RTN","MPIFQUE4",68,0)
 Q
"RTN","MPIFQUE4",69,0)
 ;
"RTN","MPIFQUE4",70,0)
PID ; Process PID segment
"RTN","MPIFQUE4",71,0)
 N NODE
"RTN","MPIFQUE4",72,0)
 S COUNT=COUNT+1
"RTN","MPIFQUE4",73,0)
 S ICN=+$P(LINE,MPIFFS,3)   ; get ICN out.
"RTN","MPIFQUE4",74,0)
 I ICN="" S ERROR="HL7 Msg# "_$G(HL("MID"))_" contains a null ICN in a PID segment." D EXC^RGHLLOG(219,ERROR) Q
"RTN","MPIFQUE4",75,0)
 S DFN=$$IEN^MPIFNQ(ICN)                  ; get DFN of this patient
"RTN","MPIFQUE4",76,0)
 I DFN="" S ERROR="Can't Process CMOR Compare for Patient with ICN "_ICN_". ICN not at this site. HL7 Message#: "_HLMTIEN D EXC^RGHLLOG(219,ERROR) Q
"RTN","MPIFQUE4",77,0)
 S NODE=$$MPINODE^MPIFAPI(+DFN)
"RTN","MPIFQUE4",78,0)
 S CMOR=$P(NODE,"^",3)               ; get the CMOR of this patient
"RTN","MPIFQUE4",79,0)
 S SCORE=$P(NODE,"^",6),NDATE=$P(NODE,"^",7)
"RTN","MPIFQUE4",80,0)
 ; if no score or score date recalc score and reset variables
"RTN","MPIFQUE4",81,0)
 I SCORE=""!(NDATE="") N RGDFN S RGDFN=DFN D CALC^RGVCCMR2
"RTN","MPIFQUE4",82,0)
 S NODE=$$MPINODE^MPIFAPI(+DFN),SCORE=$P(NODE,"^",6),NDATE=$P(NODE,"^",7)
"RTN","MPIFQUE4",83,0)
 Q
"RTN","MPIFQUE4",84,0)
 ;
"RTN","MPIFQUE4",85,0)
EVN ; Process EVN segment
"RTN","MPIFQUE4",86,0)
 S COUNT=COUNT+1
"RTN","MPIFQUE4",87,0)
 S X=$P(LINE,MPIFFS,3) D ^%DT S INDATE=Y
"RTN","MPIFQUE4",88,0)
 I INDATE=-1 S ERROR="CMOR score Date was missing for DFN "_DFN_" in CMOR Compare Inbound Message" Q
"RTN","MPIFQUE4",89,0)
 S INSCORE=$P($G(LINE),MPIFFS,4)
"RTN","MPIFQUE4",90,0)
 I INSCORE="" S INSCORE=0
"RTN","MPIFQUE4",91,0)
 Q
"RTN","MPIFQUE4",92,0)
 ;
"RTN","MPIFQUE4",93,0)
PROCES ; Process one complete message (MSH,PID,EVN,NTE)
"RTN","MPIFQUE4",94,0)
 N LIMIT
"RTN","MPIFQUE4",95,0)
 I $G(ERROR)]"" D CLEAN Q                ; Don't do anything if there is an error
"RTN","MPIFQUE4",96,0)
 S X="T-90" D ^%DT                       ; get the target date
"RTN","MPIFQUE4",97,0)
 I NDATE>Y D  Q                           ; RECORDED DATE is less than 90 days
"RTN","MPIFQUE4",98,0)
 . S LIMIT=$$PERCENT(INSCORE,SCORE)      ; Incoming CMOR score is above 80%
"RTN","MPIFQUE4",99,0)
 . I (LIMIT>80.5)&(INSCORE>SCORE) D CHANGE                 ; Incoming CMOR score is greater
"RTN","MPIFQUE4",100,0)
 . D CLEAN                               ; Incoming CMOR score is LESS
"RTN","MPIFQUE4",101,0)
 N RGDFN S RGDFN=DFN D CALC^RGVCCMR2                         ; Last calculation was greater than 90 days
"RTN","MPIFQUE4",102,0)
 S SCORE=$P($$MPINODE^MPIFAPI(DFN),"^",6)    ; Get the latest score
"RTN","MPIFQUE4",103,0)
 S LIMIT=$$PERCENT(INSCORE,SCORE)        ; Incoming CMOR score is above 80%
"RTN","MPIFQUE4",104,0)
 I (LIMIT>80.5)&(INSCORE>SCORE) D CHANGE                   ; Incoming CMOR score is greater
"RTN","MPIFQUE4",105,0)
 D CLEAN                                 ; Incoming CMOR score is LESS than the latest score
"RTN","MPIFQUE4",106,0)
 Q
"RTN","MPIFQUE4",107,0)
 ;
"RTN","MPIFQUE4",108,0)
PERCENT(NUM1,NUM2) ; Calculate the percent difference 80% or more need for change
"RTN","MPIFQUE4",109,0)
 ; of CMOR number
"RTN","MPIFQUE4",110,0)
 N DIF
"RTN","MPIFQUE4",111,0)
 I NUM1="" S NUM1=0
"RTN","MPIFQUE4",112,0)
 I NUM2="" S NUM2=0
"RTN","MPIFQUE4",113,0)
 Q:$$MAX^XLFMTH(NUM1,NUM2)=0 0
"RTN","MPIFQUE4",114,0)
 S DIF=(100-(($$MIN^XLFMTH(NUM1,NUM2))/($$MAX^XLFMTH(NUM1,NUM2))*100))
"RTN","MPIFQUE4",115,0)
 Q DIF
"RTN","MPIFQUE4",116,0)
 ;
"RTN","MPIFQUE4",117,0)
CHANGE ; Process the change CMOR request to the new CMOR site and Send out 
"RTN","MPIFQUE4",118,0)
 ; notification to the Subscriber list and MPI.
"RTN","MPIFQUE4",119,0)
 N CHANGE,MPIFSITE S MPIFSITE=$$LKUP^XUAF4(SITE)  ;get INSTITUTION (#4) IEN
"RTN","MPIFQUE4",120,0)
 I MPIFSITE=-1 S ERROR="HL7 Msg#"_$G(HL("MID"))_" contained an invalid STATION#"_$G(SITE)_" for ICN#"_$G(ICN) D EXC^RGHLLOG(211,ERROR,+DFN) Q
"RTN","MPIFQUE4",121,0)
 S CHANGE=$$CHANGE^MPIF001(+DFN,MPIFSITE)
"RTN","MPIFQUE4",122,0)
 I +CHANGE<1 S ERROR="Unable to change CMOR in HL7 Msg#"_$G(HL("MID"))_" from "_$P($$SITE^VASITE,"^",3)_" To "_$G(SITE)_" due to "_$P(CHANGE,"^",2) D EXC^RGHLLOG(211,ERROR,DFN) Q
"RTN","MPIFQUE4",123,0)
 S SERVER="MPIF CMOR RESULT SERVER",CLIENT="MPIF CMOR RESULT CLIENT"
"RTN","MPIFQUE4",124,0)
 D INIT^HLFNC2(SERVER,.HL)
"RTN","MPIFQUE4",125,0)
 I $G(HL) S ERROR=HL D EXC^RGHLLOG(220,ERROR,DFN) Q
"RTN","MPIFQUE4",126,0)
 D LINK
"RTN","MPIFQUE4",127,0)
 I $G(RESULT)=0 K RESULT Q
"RTN","MPIFQUE4",128,0)
 S HLA("HLS",1)=$$EN^VAFCPID(+DFN,"2,3,4,5,6,7,8,9,10")
"RTN","MPIFQUE4",129,0)
 S HLA("HLS",2)="EVN"_HL("FS")_"A31"_HL("FS")_INDATE_HL("FS")_INSCORE_HL("FS")_"POSTMASTER"
"RTN","MPIFQUE4",130,0)
 ;actually change the cmor
"RTN","MPIFQUE4",131,0)
 S HLA("HLS",3)="PV1"_HL("FS")_HL("FS")_HL("FS")_SITE_HL("FS")_HL("FS")_HL("FS")_$P($$NNT^XUAF4(CMOR),"^",2)
"RTN","MPIFQUE4",132,0)
 N RESLT
"RTN","MPIFQUE4",133,0)
 D GENERATE^HLMA(SERVER,"LM",1,.RESLT)
"RTN","MPIFQUE4",134,0)
 I $P(RESLT,U,2)'="" D EXC^RGHLLOG(220,"Error returned in GENERATE^HLMA  "_$P(RESLT,U,2),DFN)
"RTN","MPIFQUE4",135,0)
 K RESULT
"RTN","MPIFQUE4",136,0)
 S MPICNT=MPICNT+1 ;counting changes in CMOR
"RTN","MPIFQUE4",137,0)
 Q
"RTN","MPIFQUE4",138,0)
 ;
"RTN","MPIFQUE4",139,0)
LINK ; Give back the subscriber list in HLL(LINKS") array for this patient
"RTN","MPIFQUE4",140,0)
 N SUB,IEN,MPILINK,MPITF
"RTN","MPIFQUE4",141,0)
 K RGL
"RTN","MPIFQUE4",142,0)
 S RGL(0)=""
"RTN","MPIFQUE4",143,0)
 S RESULT=0
"RTN","MPIFQUE4",144,0)
 ;first make sure the sending site has a subscription
"RTN","MPIFQUE4",145,0)
 D CHKSUB($G(DFN),$$LKUP^XUAF4(SITE))
"RTN","MPIFQUE4",146,0)
 ;get all TF's before sending response  dbia# 2990
"RTN","MPIFQUE4",147,0)
 I '$$PATCH^XPDUTL("DG*5.3*261") S X=$$QUERYTF^VAFCTFU($G(ICN),"MPITF")
"RTN","MPIFQUE4",148,0)
 I $$PATCH^XPDUTL("DG*5.3*261") S X=$$QUERYTF^VAFCTFU1($G(ICN),"MPITF")
"RTN","MPIFQUE4",149,0)
 ;loop through checking TF's for subscriptions
"RTN","MPIFQUE4",150,0)
 S X=0 F  S X=$O(MPITF(X)) Q:'X  I +MPITF(X)'=+$$SITE^VASITE D CHKSUB($G(DFN),+MPITF(X))
"RTN","MPIFQUE4",151,0)
 S SUB=$P($$MPINODE^MPIFAPI(+DFN),U,5)    ; Subscriber list
"RTN","MPIFQUE4",152,0)
 I SUB="" D EXC^RGHLLOG(224,"No Subscription list for Patient DFN="_DFN,DFN) Q
"RTN","MPIFQUE4",153,0)
 S MPILINK=$$MPILINK^MPIFAPI()
"RTN","MPIFQUE4",154,0)
 I +MPILINK=-1 D EXC^RGHLLOG(224,"No MPI Link defined",DFN) Q
"RTN","MPIFQUE4",155,0)
 D GET^HLSUB(SUB,"",CLIENT,.HLL)
"RTN","MPIFQUE4",156,0)
 S RESULT=1,HLL("LINKS",9999)=CLIENT_U_MPILINK
"RTN","MPIFQUE4",157,0)
 Q
"RTN","MPIFQUE4",158,0)
CLEAN ; Clean up the partition and ready for the next message
"RTN","MPIFQUE4",159,0)
 D STOP^RGHLLOG()
"RTN","MPIFQUE4",160,0)
 K RGL,EVENT,SITE,REASON,ICN,DFN,CMOR,SCORE,X,Y,INDATE,INSCORE
"RTN","MPIFQUE4",161,0)
 S COUNT=0
"RTN","MPIFQUE4",162,0)
 Q
"RTN","MPIFQUE4",163,0)
CHKSUB(DFN,FAC) ;check for an existing subscription if one does not exist add it
"RTN","MPIFQUE4",164,0)
 N MPIFSCN,MPIF,MPIFLL,MPIFLLI,MPIFLLN,FLAG,LOOP,HLER
"RTN","MPIFQUE4",165,0)
 Q:FAC=""
"RTN","MPIFQUE4",166,0)
 Q:DFN=""
"RTN","MPIFQUE4",167,0)
 Q:FAC=+$$SITE^VASITE  ;don't add subscription for yourself
"RTN","MPIFQUE4",168,0)
 S MPIFSCN=$$GETSCN(DFN)
"RTN","MPIFQUE4",169,0)
 D GET^HLSUB(MPIFSCN,0,"MPIF CMOR RESULT CLIENT",.MPIFLL)
"RTN","MPIFQUE4",170,0)
 D LINK^HLUTIL3("`"_FAC,.MPIF,"I") S MPIFLLI=$O(MPIF(0)) S MPIFLLN=MPIF(MPIFLLI)
"RTN","MPIFQUE4",171,0)
 S FLAG=0,LOOP=0 F  S LOOP=$O(MPIFLL("LINKS",LOOP)) Q:'LOOP  I $P(MPIFLL("LINKS",LOOP),"^",2)=MPIFLLN S FLAG=1
"RTN","MPIFQUE4",172,0)
 I FLAG=0 D UPD^HLSUB(MPIFSCN,MPIFLLN,0,$$NOW^XLFDT,,,.HLER)
"RTN","MPIFQUE4",173,0)
 I $D(HLER) D EXC^RGHLLOG(224,"Msg#"_$G(HL("MID"))_" Unable to add/update SC for facility IEN "_FAC_", Link "_$G(MPIFLLN)_", for patient "_DFN_" SUB#"_$G(MPIFSCN),DFN) D STOP^RGHLLOG(1) Q  ; log exception
"RTN","MPIFQUE4",174,0)
 Q
"RTN","MPIFQUE4",175,0)
GETSCN(DFN) ;Return existing SCN or Activate a new subscription
"RTN","MPIFQUE4",176,0)
 ;DFN - PATIENT (#2) file ien
"RTN","MPIFQUE4",177,0)
 N MPIFAR,MPIFAN
"RTN","MPIFQUE4",178,0)
 ;get subscription control #
"RTN","MPIFQUE4",179,0)
 S MPIFSCN=+$P($$MPINODE^MPIFAPI(DFN),"^",5)
"RTN","MPIFQUE4",180,0)
 ;if no SCN, create new and update 991.05, then return result
"RTN","MPIFQUE4",181,0)
 I 'MPIFSCN S MPIFSCN=$$ACT^HLSUB S MPIFAR(991.05)=MPIFSCN S MPIFAN=$$UPDATE^MPIFAPI(DFN,"MPIFAR") I MPIFAN=-1 S MPIFSCN=""
"RTN","MPIFQUE4",182,0)
 Q MPIFSCN
"RTN","MPIFQUE5")
0^12^B11145913
"RTN","MPIFQUE5",1,0)
MPIFQUE5 ;SF/TNV-Process the RESULT from CMOR COMPARISON request ;FEB 20, 1998
"RTN","MPIFQUE5",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**1,6,11**;30 Apr 99
"RTN","MPIFQUE5",3,0)
 ;
"RTN","MPIFQUE5",4,0)
 ; Integration Agreements Utilized:
"RTN","MPIFQUE5",5,0)
 ;
"RTN","MPIFQUE5",6,0)
 ;  EXC^RGHLLOG     IA #2796
"RTN","MPIFQUE5",7,0)
 ;  START^RGHLLOG   IA #2796
"RTN","MPIFQUE5",8,0)
 ;  STOP^RGHLLOG    IA #2796
"RTN","MPIFQUE5",9,0)
 ;
"RTN","MPIFQUE5",10,0)
 ; This routine will process the message from the CMOR site to change
"RTN","MPIFQUE5",11,0)
 ; the CMOR as a result of a change cmor request
"RTN","MPIFQUE5",12,0)
 ;
"RTN","MPIFQUE5",13,0)
EN ; Entry point for process the update of CMOR
"RTN","MPIFQUE5",14,0)
 N U,LINE,IKI,ERROR,RGL,RGLOG
"RTN","MPIFQUE5",15,0)
 S U="^"
"RTN","MPIFQUE5",16,0)
 D START^RGHLLOG()
"RTN","MPIFQUE5",17,0)
 ;
"RTN","MPIFQUE5",18,0)
 N MPII,U,LINE,ERROR,PARENT,COUNT,NDATE,IKI,MPIFFS,MPIFSFS,MPIFREAP,RGLOG
"RTN","MPIFQUE5",19,0)
 F MPII=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","MPIFQUE5",20,0)
 . S LINE=HLNODE
"RTN","MPIFQUE5",21,0)
 . I $P(LINE,HL("FS"))["MSH" D MSH
"RTN","MPIFQUE5",22,0)
 . I $P(LINE,HL("FS"))["PV1" D PV1
"RTN","MPIFQUE5",23,0)
 . I $P(LINE,HL("FS"))["PID" D PID
"RTN","MPIFQUE5",24,0)
 I $G(ERROR)]"" D ACK Q          ; Any problems before changing the CMOR
"RTN","MPIFQUE5",25,0)
 I ($G(SITE)]"")&($G(DFN)]"") D CHANGE
"RTN","MPIFQUE5",26,0)
 I $G(SITE)=""!($G(DFN)="") D
"RTN","MPIFQUE5",27,0)
 .S ERROR="Missing new CMOR or Patient to be changed"
"RTN","MPIFQUE5",28,0)
 .D EXC^RGHLLOG(219,ERROR_" for change CMOR request HL7 msg "_$G(HL("MID")))
"RTN","MPIFQUE5",29,0)
 D ACK
"RTN","MPIFQUE5",30,0)
 Q
"RTN","MPIFQUE5",31,0)
 ;
"RTN","MPIFQUE5",32,0)
MSH ; Process MSH segment
"RTN","MPIFQUE5",33,0)
 I $P(LINE,HL("FS"),16)="AL" S ACK="YES"
"RTN","MPIFQUE5",34,0)
 I $P(LINE,HL("FS"),16)="ER" S ACK="ERROR"
"RTN","MPIFQUE5",35,0)
 Q
"RTN","MPIFQUE5",36,0)
 ;
"RTN","MPIFQUE5",37,0)
PV1 ; Process PV1 segment
"RTN","MPIFQUE5",38,0)
 S SITE=$P(LINE,HL("FS"),4)
"RTN","MPIFQUE5",39,0)
 I SITE="" S ERROR="Missing CMOR site number in Change CMOR message for ICN "_ICN_" HL7 msg# "_$G(HL("MID")) D EXC^RGHLLOG(221,ERROR)
"RTN","MPIFQUE5",40,0)
 Q
"RTN","MPIFQUE5",41,0)
NTE ; Process NTE segment
"RTN","MPIFQUE5",42,0)
 S SITE=$P(LINE,HL("FS"),8)
"RTN","MPIFQUE5",43,0)
 I SITE="" S ERROR="Missing CMOR site number in Change CMOR message for ICN "_ICN_" HL7 msg# "_$G(HL("MID")) D EXC^RGHLLOG(221,ERROR)
"RTN","MPIFQUE5",44,0)
 Q
"RTN","MPIFQUE5",45,0)
 ;
"RTN","MPIFQUE5",46,0)
PID ; Process PID segment
"RTN","MPIFQUE5",47,0)
 S ICN=+$P(LINE,HL("FS"),3)                  ; get ICN out.
"RTN","MPIFQUE5",48,0)
 I ICN<1 S ERROR="Missing Patient ICN in Change CMOR message HL7 msg# "_$G(HL("MID")) D EXC^RGHLLOG(219,ERROR) Q
"RTN","MPIFQUE5",49,0)
 S DFN=$$IEN^MPIFNQ(ICN)                  ; get DFN of this patient
"RTN","MPIFQUE5",50,0)
 I DFN="" S ERROR="ICN "_ICN_" not found from Change CMOR message HL7 msg# "_$G(HL("MID")) D EXC^RGHLLOG(219,ERROR) Q
"RTN","MPIFQUE5",51,0)
 Q
"RTN","MPIFQUE5",52,0)
 ;
"RTN","MPIFQUE5",53,0)
CHANGE ; Process the change CMOR to the new CMOR site (YOUR SITE NOW)
"RTN","MPIFQUE5",54,0)
 S DIC="^DIC(4,",DIC(0)="QMOZX",X=SITE D ^DIC K DIC          ; Figure out
"RTN","MPIFQUE5",55,0)
 I Y=-1 S ERROR="CMOR Site name is not on file for Station Number "_SITE_" processing Change CMOR msg for ICN "_ICN D EXC^RGHLLOG(211,ERROR,DFN) Q            ; the CMOR site
"RTN","MPIFQUE5",56,0)
 S CHANGE=$$CHANGE^MPIF001(+DFN,+Y)              ; name and change
"RTN","MPIFQUE5",57,0)
 I +CHANGE=-1 S ERROR="Unable to update CMOR for site "_SITE_". For DFN "_DFN_" Processing CHANGE CMOR message "_HLMTIEN D EXC^RGHLLOG(211,ERROR,DFN)
"RTN","MPIFQUE5",58,0)
 Q
"RTN","MPIFQUE5",59,0)
 ;
"RTN","MPIFQUE5",60,0)
ACK ; Clean up the partition.
"RTN","MPIFQUE5",61,0)
 ;
"RTN","MPIFQUE5",62,0)
 D STOP^RGHLLOG()
"RTN","MPIFQUE5",63,0)
 K X,Y,DFN,ICN,SITE,MPIFREAP,ACK,PARENT,CHANGE
"RTN","MPIFQUE5",64,0)
 Q
"RTN","MPIFREQ")
0^4^B26937042
"RTN","MPIFREQ",1,0)
MPIFREQ ;SF/TN/CMC-CMOR CHANGE REQUEST ;FEB 20, 1998
"RTN","MPIFREQ",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**1,6,11**;30 Apr 99
"RTN","MPIFREQ",3,0)
 ;
"RTN","MPIFREQ",4,0)
 ; Integration Agreements Utilized:
"RTN","MPIFREQ",5,0)
 ;
"RTN","MPIFREQ",6,0)
 ;   EXC^RGHLLOG     IA #2796
"RTN","MPIFREQ",7,0)
 ;   START^RGHLLOG   IA #2796
"RTN","MPIFREQ",8,0)
 ;   STOP^RGHLLOG    IA #2796
"RTN","MPIFREQ",9,0)
 ;   $$EN^VAFCPID    IA #3015
"RTN","MPIFREQ",10,0)
 ;
"RTN","MPIFREQ",11,0)
EN(TYPE,REQNO,ERROR,HL7) ;
"RTN","MPIFREQ",12,0)
 ; Create HL7 message for Change of CMOR Request
"RTN","MPIFREQ",13,0)
 N RGL,INST,USER,REASON,NDATE,ICN,PHONE,N0,CNT,HLA,HL,ID,XX,PID
"RTN","MPIFREQ",14,0)
 S CNT=0,HL=0
"RTN","MPIFREQ",15,0)
 S N0=$G(^MPIF(984.9,REQNO,0))
"RTN","MPIFREQ",16,0)
 I N0="" S ERROR="Node for request #"_REQNO_" is not defined" Q
"RTN","MPIFREQ",17,0)
 S INST=$P($$SITE^VASITE(),"^",3)
"RTN","MPIFREQ",18,0)
 N X,Y,DIC
"RTN","MPIFREQ",19,0)
 S DIC="^VA(200,",DIC(0)="MZO",X="`"_+$P(N0,"^",2)
"RTN","MPIFREQ",20,0)
 D ^DIC
"RTN","MPIFREQ",21,0)
 I $G(Y)<1 S USER=""
"RTN","MPIFREQ",22,0)
 I $G(Y)>0 S USER=$G(Y(0,0))
"RTN","MPIFREQ",23,0)
 S REASON=$P($G(^MPIF(984.9,REQNO,1)),"^",2)
"RTN","MPIFREQ",24,0)
 S NDATE=$P(N0,"^",3)
"RTN","MPIFREQ",25,0)
 S ICN=$$ICN^MPIFNQ(+$P(N0,"^",4))
"RTN","MPIFREQ",26,0)
 S PHONE=$P(N0,"^",5)
"RTN","MPIFREQ",27,0)
 S ID=$P(N0,"^")
"RTN","MPIFREQ",28,0)
 D INIT^HLFNC2("MPIF CMOR REQUEST",.HL)
"RTN","MPIFREQ",29,0)
 I HL D START^RGHLLOG(),EXC^RGHLLOG(220,"Unable to setup HL7 for sending Change of CMOR Request # "_REQNO_" FOR ICN= "_ICN,$P(N0,"^",4)),STOP^RGHLLOG() D RESET(REQNO) Q
"RTN","MPIFREQ",30,0)
 K HLL("LINKS")
"RTN","MPIFREQ",31,0)
 D LINK^HLUTIL3($P(N0,"^",7),.RGL)
"RTN","MPIFREQ",32,0)
 S XX=$O(RGL(0))
"RTN","MPIFREQ",33,0)
 I XX>0,$E($G(RGL(XX)),1,2)'="VA" D START^RGHLLOG(),EXC^RGHLLOG(224,"Unable to send Request to change CMOR request# "_REQNO_"  No HL7 logical link for site "_XX_" for ICN= "_ICN,$P(N0,"^",4)),STOP^RGHLLOG() D RESET(REQNO) Q
"RTN","MPIFREQ",34,0)
 I XX>0 S HLL("LINKS",1)="MPIF CMOR RESPONSE^"_RGL(XX)
"RTN","MPIFREQ",35,0)
 S CNT=CNT+1,PID=$$EN^VAFCPID(+$P(N0,"^",4),"1,2,4,5,6,7,8,11,12,13,14,16,17,19")
"RTN","MPIFREQ",36,0)
 S HLA("HLS",CNT)=PID
"RTN","MPIFREQ",37,0)
 S CNT=CNT+1
"RTN","MPIFREQ",38,0)
 S HLA("HLS",CNT)="NTE"_HL("FS")_HL("FS")_"P"_HL("FS")_PHONE_HL("FS")_REASON_HL("FS")_HL("FS")_ID_HL("FS")_INST
"RTN","MPIFREQ",39,0)
 S CNT=CNT+1
"RTN","MPIFREQ",40,0)
 S HLA("HLS",CNT)="EVN"_HL("FS")_"A31"_HL("FS")_NDATE_HL("FS")_HL("FS")_""_HL("FS")_USER
"RTN","MPIFREQ",41,0)
 N RLST
"RTN","MPIFREQ",42,0)
 D GENERATE^HLMA("MPIF CMOR REQUEST","LM",1,.RLST,"",.HL)
"RTN","MPIFREQ",43,0)
 I 'RLST D START^RGHLLOG(),EXC^RGHLLOG(220,"Unable to setup HL7 for sending Change of CMOR Request # "_REQNO_" for ICN= "_ICN,$P(N0,"^",4)),STOP^RGHLLOG(),RESET(REQNO)
"RTN","MPIFREQ",44,0)
 Q
"RTN","MPIFREQ",45,0)
 ;
"RTN","MPIFREQ",46,0)
RESET(REQNO) ; reset status to Open
"RTN","MPIFREQ",47,0)
 S DIE="^MPIF(984.9,",DA=REQNO,DR=".06///1" D ^DIE
"RTN","MPIFREQ",48,0)
 K DIE,DA,DR
"RTN","MPIFREQ",49,0)
 Q
"RTN","MPIFREQ",50,0)
 ;
"RTN","MPIFREQ",51,0)
IN(INST,USER,REASON,NDATE,ICN,PHONE,ID) ;Process an incoming CMOR request
"RTN","MPIFREQ",52,0)
 N PATIEN,MAIL,MPIF,TYPE,N0,IEN,XMCHAN,XMDUZ,XMTEXT,XMSUB,XMY,TEXT,X
"RTN","MPIFREQ",53,0)
 S PATIEN=$$GETDFN^MPIF001(ICN)
"RTN","MPIFREQ",54,0)
 I PATIEN<1 D  Q
"RTN","MPIFREQ",55,0)
 . D START^RGHLLOG()
"RTN","MPIFREQ",56,0)
 . D EXC^RGHLLOG(210,"Received CMOR Change Request for ICN "_ICN_" ICN not Found. Request # "_ID)
"RTN","MPIFREQ",57,0)
 . D STOP^RGHLLOG()
"RTN","MPIFREQ",58,0)
 S IEN=$$ADD^MPIFNEW(ID) ;add request to request file
"RTN","MPIFREQ",59,0)
 S TYPE=2 ;type of action to Request Received From
"RTN","MPIFREQ",60,0)
 S INST=$G(HL("SFN")) ; site that sent this message
"RTN","MPIFREQ",61,0)
 S DIE="^MPIF(984.9,",DA=IEN,DR="[MPIF REQUEST INCOMING]" D ^DIE
"RTN","MPIFREQ",62,0)
 I $$IFVCCI^MPIF001(+PATIEN)=-1 D PUSH(IEN) Q
"RTN","MPIFREQ",63,0)
 ; ^ your site isn't the CMOR, so this is a push to make you the CMOR
"RTN","MPIFREQ",64,0)
 S DIE="^MPIF(984.9,",DA=IEN,DR=".09///"_INST D ^DIE
"RTN","MPIFREQ",65,0)
 ; ^ update CMOR AFTER APPROVAL field
"RTN","MPIFREQ",66,0)
 I $$AUTO^MPIFNQ() D AUTO(IEN) Q
"RTN","MPIFREQ",67,0)
 S MAIL=$$MAIL^MPIFUTL()
"RTN","MPIFREQ",68,0)
 I MAIL="" S MAIL="MPIF EXCEPTIONS"
"RTN","MPIFREQ",69,0)
 S XMDUZ="MPI VISTA Package",XMTEXT="MPIF(1,",MPIF(1,1)="New Coordinating Master Of Record (CMOR) request received for patient "_$S($P($G(^DPT(+PATIEN,0)),U)]"":$P(^DPT(PATIEN,0),"^")_" ("_$E($P(^(0),"^",9),6,9)_")",1:"UNKNOWN")
"RTN","MPIFREQ",70,0)
 I MAIL="MPIF EXCEPTIONS" S XMTEXT=XMTEXT_" no mail group defined for CMOR requests"
"RTN","MPIFREQ",71,0)
 S XMSUB="CMOR Change Request #"_$P(^MPIF(984.9,IEN,0),"^"),XMY("G."_MAIL)="" D ^XMD
"RTN","MPIFREQ",72,0)
 Q
"RTN","MPIFREQ",73,0)
 ;
"RTN","MPIFREQ",74,0)
AUTO(REQNO) ;Process a request automatically
"RTN","MPIFREQ",75,0)
 N DFN,ERROR,DIE,DR,DA,CMOR,RES,CMORN
"RTN","MPIFREQ",76,0)
 S ERROR=0
"RTN","MPIFREQ",77,0)
 S DIE="^MPIF(984.9,",DR="[MPIF REVIEW AUTO]",DA=REQNO D ^DIE
"RTN","MPIFREQ",78,0)
 S DFN=$P($G(^MPIF(984.9,REQNO,0)),"^",4)
"RTN","MPIFREQ",79,0)
 S CMORN=$P($G(^MPIF(984.9,REQNO,0)),"^",7)
"RTN","MPIFREQ",80,0)
 S CMOR=$$CMORNAME^MPIF001(CMORN)
"RTN","MPIFREQ",81,0)
 I +CMOR=-1 D START^RGHLLOG(),EXC^RGHLLOG(220,"CMOR not sent in Change CMOR message for patient DFN= "_DFN_" Request # "_REQNO,DFN),STOP^RGHLLOG(),RESET2(REQNO)
"RTN","MPIFREQ",82,0)
 Q:+CMOR=-1      ;No CMOR defined
"RTN","MPIFREQ",83,0)
 I $P($G(^MPIF(984.9,REQNO,1)),"^",3)=2 D
"RTN","MPIFREQ",84,0)
 .S RES=1,RES=$$CHANGE^MPIF001(DFN,CMORN)
"RTN","MPIFREQ",85,0)
 .I +RES<1 I +RES<1 D START^RGHLLOG(),EXC^RGHLLOG(220,"Unable to Change CMOR to "_CMOR_" in a CMOR Change Message for Patient DFN= "_DFN_" Request # "+REQNO,DFN),STOP^RGHLLOG(),RESET2(REQNO)
"RTN","MPIFREQ",86,0)
 .Q:+RES<1
"RTN","MPIFREQ",87,0)
 .D BROAD^MPIFCMOR(REQNO,.ERROR)
"RTN","MPIFREQ",88,0)
 .I +ERROR=0 D EN^MPIFRESS(REQNO)
"RTN","MPIFREQ",89,0)
 .; ^ trigger approval msg
"RTN","MPIFREQ",90,0)
 Q
"RTN","MPIFREQ",91,0)
 ;
"RTN","MPIFREQ",92,0)
RESET2(REQNO) ; reset status to Pending Approval
"RTN","MPIFREQ",93,0)
 S DIE="^MPIF(984.9,",DA=REQNO,DR=".06///3" D ^DIE
"RTN","MPIFREQ",94,0)
 K DIE,DA,DR
"RTN","MPIFREQ",95,0)
 Q
"RTN","MPIFREQ",96,0)
 ;
"RTN","MPIFREQ",97,0)
PUSH(IEN) ;Change of CMOR Request is a Push
"RTN","MPIFREQ",98,0)
 ; just want to get request into 984.9 for
"RTN","MPIFREQ",99,0)
 ; tracking purposes, marking it as approved
"RTN","MPIFREQ",100,0)
 N DA,DIE,X,Y,TEXT
"RTN","MPIFREQ",101,0)
 S DIE="^MPIF(984.9,",DA=IEN,TEXT="Auto change - CMOR pushed here"
"RTN","MPIFREQ",102,0)
 S DR=".06///4;1.03///4;3.01///"_TEXT_";.09///`"_+$$SITE^VASITE()
"RTN","MPIFREQ",103,0)
 D ^DIE
"RTN","MPIFREQ",104,0)
 Q
"RTN","MPIFRESS")
0^3^B19338138
"RTN","MPIFRESS",1,0)
MPIFRESS ;BHM/RGY-Process a CMOR result ;FEB 27, 1998
"RTN","MPIFRESS",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**1,6,11**;30 Apr 99
"RTN","MPIFRESS",3,0)
 ;
"RTN","MPIFRESS",4,0)
 ; Integration Agreements Utilized:
"RTN","MPIFRESS",5,0)
 ;
"RTN","MPIFRESS",6,0)
 ;   EXC^RGHLLOG     IA #2796
"RTN","MPIFRESS",7,0)
 ;   START^RGHLLOG   IA #2796
"RTN","MPIFRESS",8,0)
 ;   STOP^RGHLLOG    IA #2796
"RTN","MPIFRESS",9,0)
 ;   $$EN^VAFCPID    IA #3015
"RTN","MPIFRESS",10,0)
 ;
"RTN","MPIFRESS",11,0)
EN(REQNO) ;
"RTN","MPIFRESS",12,0)
 N RGL,ID,COMMENTS,STATUS,NDATE,PHONE,REVIEWER,N0,CNT,HL,HLA,XX,ERROR
"RTN","MPIFRESS",13,0)
 S CNT=0,HL=0
"RTN","MPIFRESS",14,0)
 S N0=$G(^MPIF(984.9,REQNO,0))
"RTN","MPIFRESS",15,0)
 I N0="" D  Q
"RTN","MPIFRESS",16,0)
 .D START^RGHLLOG()
"RTN","MPIFRESS",17,0)
 .D EXC^RGHLLOG(210,"CMOR Request # "_REQNO_" Does Not Exist attempting to generate approved/not approved msg")
"RTN","MPIFRESS",18,0)
 .D STOP^RGHLLOG()
"RTN","MPIFRESS",19,0)
 S ID=$P(N0,"^")
"RTN","MPIFRESS",20,0)
 S STATUS=$P(N0,"^",6)
"RTN","MPIFRESS",21,0)
 S COMMENTS=$P($G(^MPIF(984.9,REQNO,3)),"^",2)
"RTN","MPIFRESS",22,0)
 I $P($G(^MPIF(984.9,REQNO,3)),"^")]"" S REVIEWER=$P(^(3),"^")
"RTN","MPIFRESS",23,0)
 I $P($G(^MPIF(984.9,REQNO,3)),"^")']"" D
"RTN","MPIFRESS",24,0)
 .N DIC,X,Y
"RTN","MPIFRESS",25,0)
 .S DIC="^VA(200,",DIC(0)="ZMO",X="`"_+$P(^MPIF(984.9,REQNO,2),"^")
"RTN","MPIFRESS",26,0)
 .D ^DIC
"RTN","MPIFRESS",27,0)
 .I $G(Y)>1 S REVIEWER=$G(Y(0,0))
"RTN","MPIFRESS",28,0)
 .I $G(Y)<1 S REVIEWER=""
"RTN","MPIFRESS",29,0)
 S NDATE=$P($G(^MPIF(984.9,REQNO,2)),"^",2)
"RTN","MPIFRESS",30,0)
 S PHONE=$P($G(^MPIF(984.9,REQNO,2)),"^",3)
"RTN","MPIFRESS",31,0)
 S COMMENTS=$P($G(^MPIF(984.9,REQNO,3)),"^",2)
"RTN","MPIFRESS",32,0)
 D INIT^HLFNC2("MPIF CMOR APPROVE/DISAPPROVE",.HL)
"RTN","MPIFRESS",33,0)
 I HL S ERROR=HL D  Q
"RTN","MPIFRESS",34,0)
 .D START^RGHLLOG()
"RTN","MPIFRESS",35,0)
 .D EXC^RGHLLOG(220,"Unable to setup HL7 for Change CMOR Request # "_REQNO_" for Approved/Not Approved msg HL Error"_HL,$P(N0,"^",4))
"RTN","MPIFRESS",36,0)
 .D STOP^RGHLLOG()
"RTN","MPIFRESS",37,0)
 K HLL("LINKS")
"RTN","MPIFRESS",38,0)
 D LINK^HLUTIL3($P(N0,"^",7),.RGL) ;get link for site
"RTN","MPIFRESS",39,0)
 S XX=$O(RGL(0))
"RTN","MPIFRESS",40,0)
 I XX>0,$E($G(RGL(XX)),1,2)'="VA" D START^RGHLLOG(),EXC^RGHLLOG(224,"Unable to send approve/not approved msg for CMOR request# "_REQNO_"  No logical link for site "_XX,$P(N0,"^",4)),STOP^RGHLLOG() Q
"RTN","MPIFRESS",41,0)
 I XX>0 S HLL("LINKS",1)="MPIF CMOR APP/DIS^"_RGL(XX)
"RTN","MPIFRESS",42,0)
 S CNT=CNT+1,HLA("HLS",CNT)="EVN"_HL("FS")_"A31"_HL("FS")_NDATE_HL("FS")_HL("FS")_""_HL("FS")_REVIEWER
"RTN","MPIFRESS",43,0)
 S CNT=CNT+1,HLA("HLS",CNT)="NTE"_HL("FS")_HL("FS")_"P"_HL("FS")_PHONE_HL("FS")_COMMENTS_HL("FS")_STATUS_HL("FS")_ID
"RTN","MPIFRESS",44,0)
 S CNT=CNT+1,HLA("HLS",CNT)=$$EN^VAFCPID(+$P(N0,"^",4),"1,2,4,5,6,7,8,11,12,13,14,16,17,19")
"RTN","MPIFRESS",45,0)
 N RLST
"RTN","MPIFRESS",46,0)
 D GENERATE^HLMA("MPIF CMOR APPROVE/DISAPPROVE","LM",1,.RLST,"",.HL)
"RTN","MPIFRESS",47,0)
 I 'RLST S ERROR=RLST D START^RGHLLOG(),EXC^RGHLLOG(220,"Error Generating HL7 msg for Approve/Not Approved CMOR Request # "_REQNO,$P(N0,"^",4))
"RTN","MPIFRESS",48,0)
 Q
"RTN","MPIFRESS",49,0)
 ;
"RTN","MPIFRESS",50,0)
IN ;
"RTN","MPIFRESS",51,0)
 ; Processing approve/not approve msg to update Request in 984.9 file
"RTN","MPIFRESS",52,0)
 N DFN,ENT,XMY,XMDUZ,XMTEXT,MPIF,XMSUB,FSITE,CMOR,PHONE,RESULT,REVIEWER,COMMENTS,NDATE,II,ICN
"RTN","MPIFRESS",53,0)
 S (HLQUIT,ID,COMMENTS,PHONE,REVIEWER)=""
"RTN","MPIFRESS",54,0)
 F II=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","MPIFRESS",55,0)
 .I $P(HLNODE,HL("FS"),1)="NTE" D
"RTN","MPIFRESS",56,0)
 ..S ID=$P(HLNODE,HL("FS"),7),RESULT=$P(HLNODE,HL("FS"),6)
"RTN","MPIFRESS",57,0)
 ..S PHONE=$P(HLNODE,HL("FS"),4)
"RTN","MPIFRESS",58,0)
 ..S COMMENTS=$P(HLNODE,HL("FS"),5)
"RTN","MPIFRESS",59,0)
 .I $P(HLNODE,HL("FS"),1)="EVN" D
"RTN","MPIFRESS",60,0)
 ..S NDATE=$P(HLNODE,HL("FS"),3)
"RTN","MPIFRESS",61,0)
 ..S REVIEWER=$P(HLNODE,HL("FS"),6)
"RTN","MPIFRESS",62,0)
 .I $P(HLNODE,HL("FS"),1)="PID" D
"RTN","MPIFRESS",63,0)
 ..S ICN=+$P(HLNODE,HL("FS"),3)
"RTN","MPIFRESS",64,0)
 S ENT=$O(^MPIF(984.9,"B",ID,0))
"RTN","MPIFRESS",65,0)
 ;; CHANGE FOR NOIS MAD-0900-42526
"RTN","MPIFRESS",66,0)
 I ENT="" D
"RTN","MPIFRESS",67,0)
 .D START^RGHLLOG()
"RTN","MPIFRESS",68,0)
 .D EXC^RGHLLOG(210,"CMOR Request # "_ID_" Does Not Exist CMORs may be out of sync for ICN "_ICN_". HL7 msg# "_HL("MID"))
"RTN","MPIFRESS",69,0)
 .D STOP^RGHLLOG()
"RTN","MPIFRESS",70,0)
 Q:ENT=""
"RTN","MPIFRESS",71,0)
 Q:'$D(^MPIF(984.9,ENT,0))
"RTN","MPIFRESS",72,0)
 S DFN=$P($G(^MPIF(984.9,ENT,0)),"^",4),FSITE=$P($G(^(0)),"^",7)
"RTN","MPIFRESS",73,0)
 S DIC="^DIC(4,",DIC(0)="MXNZ",X=FSITE D ^DIC
"RTN","MPIFRESS",74,0)
 I $G(Y)>0 S FSITE=$P(Y,"^",2)
"RTN","MPIFRESS",75,0)
 K Y,X,DIC
"RTN","MPIFRESS",76,0)
 S DIE="^MPIF(984.9,",DA=ENT,DR="[MPIF RESULT INCOMING]" D ^DIE K DIE,DA,DR
"RTN","MPIFRESS",77,0)
 S XMDUZ="MPI VISTA Package"
"RTN","MPIFRESS",78,0)
 S XMSUB="Request "_ID_" is "_$S(RESULT=4:"approved",1:"disapproved")
"RTN","MPIFRESS",79,0)
 N REQR S REQR=$P($G(^MPIF(984.9,ENT,0)),"^",2) I REQR="" S REQR="AUTO"
"RTN","MPIFRESS",80,0)
 S XMY(REQR)="",XMTEXT="MPIF(1,"
"RTN","MPIFRESS",81,0)
 S MPIF(1,1)=FSITE_" received CMOR request for "_$P($G(^DPT(+$P(^MPIF(984.9,ENT,0),"^",4),0)),"^")_" ("_$E($P(^(0),"^",9),6,9)_")."
"RTN","MPIFRESS",82,0)
 S MPIF(1,2)=XMSUB_"."
"RTN","MPIFRESS",83,0)
 S MPIF(1,3)="Processed by: "_$G(REVIEWER)
"RTN","MPIFRESS",84,0)
 S MPIF(1,4)="Phone: "_$G(PHONE)
"RTN","MPIFRESS",85,0)
 S MPIF(1,5)="Comments: "_$G(COMMENTS)
"RTN","MPIFRESS",86,0)
 D ^XMD
"RTN","MPIFRESS",87,0)
 Q
"RTN","MPIFREV")
0^1^B16526919
"RTN","MPIFREV",1,0)
MPIFREV ;BHM/RGY-Review CMOR request ;FEB 26, 1998
"RTN","MPIFREV",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**6,11**;30 Apr 99
"RTN","MPIFREV",3,0)
 ;
"RTN","MPIFREV",4,0)
 ; Integration Agreements Utilized:
"RTN","MPIFREV",5,0)
 ;
"RTN","MPIFREV",6,0)
 ;   EXC^RGHLLOG     IA #2796
"RTN","MPIFREV",7,0)
 ;   START^RGHLLOG   IA #2796
"RTN","MPIFREV",8,0)
 ;   STOP^RGHLLOG    IA #2796
"RTN","MPIFREV",9,0)
 ;
"RTN","MPIFREV",10,0)
EN ;
"RTN","MPIFREV",11,0)
 ; Entry point for option MPIF REVIEW REQUEST.  This option allows the
"RTN","MPIFREV",12,0)
 ; user to review CMOR Change requests and approve or deny them
"RTN","MPIFREV",13,0)
 ; No input or output variables.
"RTN","MPIFREV",14,0)
 N DIC
"RTN","MPIFREV",15,0)
ASK S DIC="^MPIF(984.9,",DIC("A")="Select CMOR request to review: "
"RTN","MPIFREV",16,0)
 S DIC(0)="QEAM",DIC("S")="I $D(^MPIF(984.9,""AC"",3,Y))"
"RTN","MPIFREV",17,0)
 D ^DIC Q:+Y<0
"RTN","MPIFREV",18,0)
 D EN1(+Y)
"RTN","MPIFREV",19,0)
 G ASK
"RTN","MPIFREV",20,0)
EN1(REQ,MSTOP) ;Review a CMOR request
"RTN","MPIFREV",21,0)
 N DFN,PHONE,RESULT,RES1,DIE,DA,DR,ENT,DIC,FR,BY,TO,FLDS,L,DIR,DUTOUT,X,Y,ERR,ER
"RTN","MPIFREV",22,0)
 S MSTOP=0,ER=0
"RTN","MPIFREV",23,0)
 I $P($G(^MPIF(984.9,+REQ,0)),"^",6)'=3 W !,"*** Request is not pending review ***" Q
"RTN","MPIFREV",24,0)
 N PAT S PAT=$P($G(^MPIF(984.9,+REQ,0)),"^",4)
"RTN","MPIFREV",25,0)
 ;checking for other requests pending for this patient
"RTN","MPIFREV",26,0)
 K ARRAY
"RTN","MPIFREV",27,0)
 D OTHERS^MPIFAREQ(PAT,+REQ,.ARRAY)
"RTN","MPIFREV",28,0)
 I $G(ARRAY(0))'=0 W !!!,"**** There are other PENDING Requests for this patient.  If you approve one the rest will automatically be disapproved. ***" H 5
"RTN","MPIFREV",29,0)
 S L=0,ENT=+REQ,DIC="^MPIF(984.9,",FR=+REQ,TO=+REQ,BY="@NUMBER",FLDS="[MPIF REQUEST VIEW]",IOP="HOME" D EN1^DIP
"RTN","MPIFREV",30,0)
APP S DIR("A")="Select Review Action ("_$S($P(^MPIF(984.9,+REQ,0),"^",4)]"":"APPROVE/",1:"")_"DISAPPROVE, OR '^' to Exit)? "
"RTN","MPIFREV",31,0)
 S DIR(0)="SAO^"_$S($P(^MPIF(984.9,+REQ,0),"^",4)]"":"A:APPROVE;",1:"")_"D:DISAPPROVE"
"RTN","MPIFREV",32,0)
 N DIRUT,DTOUT
"RTN","MPIFREV",33,0)
 D ^DIR K DIR
"RTN","MPIFREV",34,0)
 I $D(DIRUT) S:X="^"!$D(DTOUT) MSTOP=1 W " ... No Action!" Q
"RTN","MPIFREV",35,0)
 S (RESULT,RES1)=Y
"RTN","MPIFREV",36,0)
 S PHONE=$P($G(^MPIF(984.9,+$O(^MPIF(984.9,"AE",DUZ,""),-1),2)),"^",3)
"RTN","MPIFREV",37,0)
 S DIE="^MPIF(984.9,",DR="[MPIF REVIEW RESULT]",DA=+REQ D ^DIE
"RTN","MPIFREV",38,0)
 I $D(Y)!$D(DTOUT) S:$D(DTOUT) MSTOP=1 S DIE="^MPIF(984.9,",DR="[MPIF REVIEW RESET]",DA=+REQ D ^DIE W " ... No Action!" Q
"RTN","MPIFREV",39,0)
 W !!," Processing.....",!
"RTN","MPIFREV",40,0)
 S DFN=$P($G(^MPIF(984.9,+REQ,0)),"^",4)
"RTN","MPIFREV",41,0)
 I $E(RESULT)="A" D
"RTN","MPIFREV",42,0)
 .S ERR=$$CHANGE^MPIF001(DFN,+$P($G(^MPIF(984.9,+REQ,0)),"^",7))
"RTN","MPIFREV",43,0)
 .;log exception if problem with updating CMOR
"RTN","MPIFREV",44,0)
 .I +ERR<0 D  Q
"RTN","MPIFREV",45,0)
 ..D START^RGHLLOG()
"RTN","MPIFREV",46,0)
 ..D EXC^RGHLLOG(220,"Unable to change CMOR for Change CMOR Request for patient DFN= "_DFN_" Request # "_+REQ,DFN)
"RTN","MPIFREV",47,0)
 ..D STOP^RGHLLOG(),RESET2^MPIFREQ(+REQ)
"RTN","MPIFREV",48,0)
 ..W !!,"  Problem Changing CMOR, resetting status to pending approval.  May be duplicates in Institution file for new CMOR or Patient file entry was already being edited.",!!
"RTN","MPIFREV",49,0)
 .I +ERR>0 D BROAD^MPIFCMOR(+REQ,.ER)
"RTN","MPIFREV",50,0)
 I +ER=0 D EN^MPIFRESS(+REQ)
"RTN","MPIFREV",51,0)
 I +ER=-1 W !!," Problem during Broadcast - "_$P(ER,"^",2) Q
"RTN","MPIFREV",52,0)
 N ENT
"RTN","MPIFREV",53,0)
 I ARRAY(0)'=0&($E(RES1)="A") D
"RTN","MPIFREV",54,0)
 .S ENT=0
"RTN","MPIFREV",55,0)
 .W !,"Have others to Disapprove -- automatically"
"RTN","MPIFREV",56,0)
 .F  S ENT=$O(ARRAY(ENT)) Q:ENT=""  D AUTODIS^MPIFAREQ(ARRAY(ENT))
"RTN","MPIFREV",57,0)
 W !!," ... Done!",!!
"RTN","MPIFREV",58,0)
 Q
"RTN","MPIFREV",59,0)
 ;
"RTN","MPIFREV",60,0)
BATCH ;Approve in batch mode
"RTN","MPIFREV",61,0)
 NEW CSITE,DIR,DIRUT,IOP,MSTOP,IEN,PIEN
"RTN","MPIFREV",62,0)
 I $O(^MPIF(984.9,"AC",3,0))="" W !!,"*** No request to approve ***",! Q
"RTN","MPIFREV",63,0)
 S MSTOP=0,CSITE=0
"RTN","MPIFREV",64,0)
 S DIR("A")="Do you want to approve by SITE",DIR(0)="Y"
"RTN","MPIFREV",65,0)
 D ^DIR K DIR
"RTN","MPIFREV",66,0)
 Q:$D(DIRUT)
"RTN","MPIFREV",67,0)
 S IEN=0,PIEN=0
"RTN","MPIFREV",68,0)
 W !
"RTN","MPIFREV",69,0)
 I Y=0 D  Q
"RTN","MPIFREV",70,0)
 .F  S IEN=$O(^MPIF(984.9,"AC",3,IEN)) Q:'IEN  S IOP=ION D EN1(IEN,.MSTOP) Q:MSTOP
"RTN","MPIFREV",71,0)
 .Q
"RTN","MPIFREV",72,0)
SITE S DIC("A")="Select Site: ",DIC="^DIC(4,",DIC(0)="QEAM",DIC("S")="I $D(^MPIF(984.9,""AS"",Y,3))" D ^DIC Q:Y<0  S CSITE=+Y
"RTN","MPIFREV",73,0)
 I $O(^MPIF(984.9,"AS",CSITE,3,0))="" W !!,"*** No requests to approve for this site ***",! G SITE
"RTN","MPIFREV",74,0)
 W !
"RTN","MPIFREV",75,0)
 S MSTOP=0
"RTN","MPIFREV",76,0)
 F  S PIEN=$O(^MPIF(984.9,"AS",CSITE,3,PIEN)) Q:'PIEN  D
"RTN","MPIFREV",77,0)
 .S IOP=ION
"RTN","MPIFREV",78,0)
 .D EN1(PIEN,.MSTOP)
"RTN","MPIFREV",79,0)
 .Q:MSTOP=1
"RTN","MPIFREV",80,0)
 Q
"RTN","MPIFUTL")
0^10^B9147813
"RTN","MPIFUTL",1,0)
MPIFUTL ;BHM/RGY-CMOR Utilities ;FEB 26, 1998
"RTN","MPIFUTL",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**11**;30 Apr 99
"RTN","MPIFUTL",3,0)
 ;
"RTN","MPIFUTL",4,0)
 ; Integration Agreements Utilized:
"RTN","MPIFUTL",5,0)
 ;
"RTN","MPIFUTL",6,0)
 ;  ^DGCN(391.91     IA #2751
"RTN","MPIFUTL",7,0)
 ;
"RTN","MPIFUTL",8,0)
TYPE ;Set type of CMOR request change
"RTN","MPIFUTL",9,0)
 NEW DIE,DR,DA
"RTN","MPIFUTL",10,0)
 S DIE="^RGSITE(991.8,",DR="[MPIF SITE PARAMETERS]",DA=1 D ^DIE
"RTN","MPIFUTL",11,0)
 Q
"RTN","MPIFUTL",12,0)
MAIL() ;Get mailgroup for new requests
"RTN","MPIFUTL",13,0)
 N IEN,MGROUP
"RTN","MPIFUTL",14,0)
 S IEN=$P($G(^RGSITE(991.8,1,0)),"^",3)
"RTN","MPIFUTL",15,0)
 Q:IEN="" "-1^No Mailgroup defined"
"RTN","MPIFUTL",16,0)
 S MGROUP=$$EXTERNAL^DILFD(991.8,.03,,IEN)
"RTN","MPIFUTL",17,0)
 Q:MGROUP="" "-1^No Mailgroup defined"
"RTN","MPIFUTL",18,0)
 Q MGROUP
"RTN","MPIFUTL",19,0)
CHK1(D0) ;Check out a new request for patient data
"RTN","MPIFUTL",20,0)
 NEW PAT,X,OPEN
"RTN","MPIFUTL",21,0)
 S OPEN=0
"RTN","MPIFUTL",22,0)
 S PAT=+$P($G(^MPIF(984.9,D0,0)),"^",4)
"RTN","MPIFUTL",23,0)
 I PAT=0 W !!,"*** Patient not defined for this request ***" Q 1
"RTN","MPIFUTL",24,0)
 I '$$PAT^MPIFNQ(PAT) W !!,"*** Patient has not been assigned a CMOR Site ***",! Q 1
"RTN","MPIFUTL",25,0)
 F X=0:0 S X=$O(^MPIF(984.9,"C",PAT,X)) Q:'X  D:X'=D0  Q:OPEN
"RTN","MPIFUTL",26,0)
 .I $P(^MPIF(984.9,X,0),"^",6)'=4,$P(^(0),"^",6)'=5 S OPEN=X
"RTN","MPIFUTL",27,0)
 I OPEN W !,"*** Patient already has an open request (",$P(^MPIF(984.9,OPEN,0),"^"),") ***" Q 1
"RTN","MPIFUTL",28,0)
 Q 0
"RTN","MPIFUTL",29,0)
 ;
"RTN","MPIFUTL",30,0)
CHK2(D0) ;Check out a new requeste for site
"RTN","MPIFUTL",31,0)
 I $P(^MPIF(984.9,D0,0),"^",7)="" W !!,"*** You must enter a site to send this request to ***" Q 1
"RTN","MPIFUTL",32,0)
 I $P(^MPIF(984.9,D0,0),"^",7)=+$$SITE^VASITE() W !!,"*** You cannot send a request to your own site ***" Q 1
"RTN","MPIFUTL",33,0)
 N SITE,PT
"RTN","MPIFUTL",34,0)
 S SITE=$P(^MPIF(984.9,D0,0),"^",7),PT=$P(^MPIF(984.9,D0,0),"^",4)
"RTN","MPIFUTL",35,0)
 I '$D(^DGCN(391.91,"APAT",PT,SITE)) W !!,"*** You cannot send a request to a site that isn't a treating facility for this patient ***" Q 1
"RTN","MPIFUTL",36,0)
 Q 0
"RTN","MPIFUTL",37,0)
 ;
"RTN","MPIFUTL",38,0)
CCRDAT(PAT,ARR) ; API to return all known CMOR Change Request Information
"RTN","MPIFUTL",39,0)
 ; PAT - DFN of patient in Patient file (#2)
"RTN","MPIFUTL",40,0)
 ; ARR - Array to return information.  First subscript will be request number, next will be the field number.  field 9999 will be the display text
"RTN","MPIFUTL",41,0)
 ; ARR(0) will equal -1 eror message if there was a problem or no data found.  If data is found, ARR(0) will equal the number of requests found.
"RTN","MPIFUTL",42,0)
 ;
"RTN","MPIFUTL",43,0)
 I '$D(PAT)!('$D(ARR)) Q
"RTN","MPIFUTL",44,0)
 I $O(^MPIF(984.9,"C",PAT,""))="" S @ARR@(0)="-1^No Requests on File" Q
"RTN","MPIFUTL",45,0)
 N SITE,IEN,MPIFA,CNT,IENT,TEXT,REQN
"RTN","MPIFUTL",46,0)
 S IEN=0,CNT=0
"RTN","MPIFUTL",47,0)
 F  S IEN=$O(^MPIF(984.9,"C",PAT,IEN)) Q:IEN=""  D
"RTN","MPIFUTL",48,0)
 .I '$D(^MPIF(984.9,IEN)) Q
"RTN","MPIFUTL",49,0)
 .D GETS^DIQ(984.9,IEN,".01;.02;.03;.04;.05;.06;.07;.08;.09;1.01;1.02;1.03;2.01;2.02;2.03;3.01;3.02","","MPIFA")
"RTN","MPIFUTL",50,0)
 .S IENT=IEN_","
"RTN","MPIFUTL",51,0)
 .Q:MPIFA(984.9,IENT,.01)=""
"RTN","MPIFUTL",52,0)
 .S CNT=CNT+1
"RTN","MPIFUTL",53,0)
 .S REQN=MPIFA(984.9,IENT,.01)
"RTN","MPIFUTL",54,0)
 .M @ARR@(REQN)=MPIFA(984.9,IENT)
"RTN","MPIFUTL",55,0)
 .N SIEN S SIEN=$P(^MPIF(984.9,IEN,0),"^",7)
"RTN","MPIFUTL",56,0)
 .N STN I SIEN'="" S STN=$P($$NS^XUAF4(SIEN),"^",2)
"RTN","MPIFUTL",57,0)
 .N SIEN2 S SIEN2=$P(^MPIF(984.9,IEN,0),"^",9)
"RTN","MPIFUTL",58,0)
 .N STN2 I SIEN2'="" S STN2=$P($$NS^XUAF4(SIEN2),"^",2)
"RTN","MPIFUTL",59,0)
 .S TEXT=@ARR@(REQN,1.03)_" "_@ARR@(REQN,.07)_" (#"_$G(STN)_") to change CMOR to "_@ARR@(REQN,.09)_" (#"_$G(STN2)_")."
"RTN","MPIFUTL",60,0)
 .S @ARR@(REQN,999)=TEXT
"RTN","MPIFUTL",61,0)
 S @ARR@(0)=CNT
"RTN","MPIFUTL",62,0)
 Q
"VER")
8.0^22.0
"^DD",984.9,984.9,.02,0)
REQUESTED BY^RP200'^VA(200,^0;2^Q
"^DD",984.9,984.9,.02,1,0)
^.1
"^DD",984.9,984.9,.02,1,1,0)
984.9^AD
"^DD",984.9,984.9,.02,1,1,1)
S ^MPIF(984.9,"AD",$E(X,1,30),DA)=""
"^DD",984.9,984.9,.02,1,1,2)
K ^MPIF(984.9,"AD",$E(X,1,30),DA)
"^DD",984.9,984.9,.02,1,1,"DT")
2960703
"^DD",984.9,984.9,.02,3)
Select the person making the request from the New Person file.
"^DD",984.9,984.9,.02,21,0)
^^5^5^3011031^
"^DD",984.9,984.9,.02,21,1,0)
The REQUESTED BY field will exist at the originating station only.  Once
"^DD",984.9,984.9,.02,21,2,0)
the request is transmitted to another station, the receiving station
"^DD",984.9,984.9,.02,21,3,0)
will not have data in this field.  This is due to the fact that the
"^DD",984.9,984.9,.02,21,4,0)
receiving location will not have the originating person in their New 
"^DD",984.9,984.9,.02,21,5,0)
Person (#200) file.
"^DD",984.9,984.9,.02,"DT")
3011031
"^DD",984.9,984.9,.06,0)
STATUS^RS^1:OPEN;2:REQUESTED;3:PENDING APPROVAL;4:APPROVED;5:DISAPPROVED;^0;6^Q
"^DD",984.9,984.9,.06,1,0)
^.1
"^DD",984.9,984.9,.06,1,1,0)
984.9^AC
"^DD",984.9,984.9,.06,1,1,1)
S ^MPIF(984.9,"AC",$E(X,1,30),DA)=""
"^DD",984.9,984.9,.06,1,1,2)
K ^MPIF(984.9,"AC",$E(X,1,30),DA)
"^DD",984.9,984.9,.06,1,1,"DT")
2960703
"^DD",984.9,984.9,.06,1,2,0)
984.9^AS1^MUMPS
"^DD",984.9,984.9,.06,1,2,1)
S:$P(^MPIF(984.9,DA,0),"^",7)]"" ^MPIF(984.9,"AS",$P(^(0),"^",7),X,DA)=""
"^DD",984.9,984.9,.06,1,2,2)
K:$P(^MPIF(984.9,DA,0),"^",7)]"" ^MPIF(984.9,"AS",$P(^(0),"^",7),X,DA)
"^DD",984.9,984.9,.06,1,2,"%D",0)
^^1^1^3010709^
"^DD",984.9,984.9,.06,1,2,"%D",1,0)
Compound x-ref on site and status.
"^DD",984.9,984.9,.06,1,2,"DT")
3010709
"^DD",984.9,984.9,.06,3)

"^DD",984.9,984.9,.06,21,0)
^^7^7^3010613^
"^DD",984.9,984.9,.06,21,1,0)
This field tracks the progress of the CMOR change request.  As the
"^DD",984.9,984.9,.06,21,2,0)
request is being entered, it has a status of Open.  Once the requestor
"^DD",984.9,984.9,.06,21,3,0)
sends the request, the status is change to Requested.  At the receiving
"^DD",984.9,984.9,.06,21,4,0)
location, the status is set to Pending Approval.  Once it is processed, it
"^DD",984.9,984.9,.06,21,5,0)
will be set to Approved or Disapproved.  The requesting site will also
"^DD",984.9,984.9,.06,21,6,0)
update the status to Approved or Disapproved once the request has been
"^DD",984.9,984.9,.06,21,7,0)
processed.
"^DD",984.9,984.9,.06,"DT")
3010709
"^DD",984.9,984.9,.07,0)
SITE^P4'^DIC(4,^0;7^Q
"^DD",984.9,984.9,.07,1,0)
^.1
"^DD",984.9,984.9,.07,1,1,0)
984.9^AS2^MUMPS
"^DD",984.9,984.9,.07,1,1,1)
S:$P(^MPIF(984.9,DA,0),"^",6)]"" ^MPIF(984.9,"AS",X,$P(^(0),"^",6),DA)=""
"^DD",984.9,984.9,.07,1,1,2)
K:$P(^MPIF(984.9,DA,0),"^",6)]"" ^MPIF(984.9,"AS",X,$P(^(0),"^",6),DA)
"^DD",984.9,984.9,.07,1,1,"%D",0)
^^1^1^3010709^
"^DD",984.9,984.9,.07,1,1,"%D",1,0)
Compound x-ref on site and status
"^DD",984.9,984.9,.07,1,1,"DT")
3010709
"^DD",984.9,984.9,.07,3)

"^DD",984.9,984.9,.07,21,0)
^^3^3^3010618^
"^DD",984.9,984.9,.07,21,1,0)
At the site that has RECEIVED the Request/Push the site field will be the
"^DD",984.9,984.9,.07,21,2,0)
site that initiated the Request/Push.  At the site that has SENT the
"^DD",984.9,984.9,.07,21,3,0)
request it will be the site the request was sent to.
"^DD",984.9,984.9,.07,"DT")
3010709
"^DD",984.9,984.9,.09,0)
CMOR AFTER APPROVAL^P4'^DIC(4,^0;9^Q
"^DD",984.9,984.9,.09,21,0)
^^2^2^3010618^
"^DD",984.9,984.9,.09,21,1,0)
This field will contain the site that the request is asking to be the
"^DD",984.9,984.9,.09,21,2,0)
CMOR or the site that the Push is making the CMOR.
"^DD",984.9,984.9,.09,"DT")
3010618
"^DD",984.9,984.9,1.03,0)
TYPE OF ACTION^RS^1:REQUEST SENT TO;2:REQUEST RECEIVED FROM;3:PUSH SENT TO;4:PUSH RECEIVED FROM;^1;3^Q
"^DD",984.9,984.9,1.03,3)

"^DD",984.9,984.9,1.03,21,0)
^^2^2^3010613^
"^DD",984.9,984.9,1.03,21,1,0)
This field is used to show which request was made and whether it
"^DD",984.9,984.9,1.03,21,2,0)
originated at this facility or was received at this facility.
"^DD",984.9,984.9,1.03,"DT")
3010618
"^DD",984.9,984.9,2.01,0)
REVIEWED BY^P200'^VA(200,^2;1^Q
"^DD",984.9,984.9,2.01,1,0)
^.1
"^DD",984.9,984.9,2.01,1,1,0)
984.9^AE
"^DD",984.9,984.9,2.01,1,1,1)
S ^MPIF(984.9,"AE",$E(X,1,30),DA)=""
"^DD",984.9,984.9,2.01,1,1,2)
K ^MPIF(984.9,"AE",$E(X,1,30),DA)
"^DD",984.9,984.9,2.01,1,1,"DT")
2960722
"^DD",984.9,984.9,2.01,3)
Select the user making the request.
"^DD",984.9,984.9,2.01,21,0)
^^4^4^3010613^
"^DD",984.9,984.9,2.01,21,1,0)
The site processing this request will have this field populated with the
"^DD",984.9,984.9,2.01,21,2,0)
user that processed the request.  The site that made the request will not
"^DD",984.9,984.9,2.01,21,3,0)
have this field populated but will instead have the Reviewer Name field
"^DD",984.9,984.9,2.01,21,4,0)
populated.  
"^DD",984.9,984.9,2.01,"DT")
3010613
"^DD",984.9,984.9,3.01,0)
REVIEWER NAME^F^^3;1^K:$L(X)>30!($L(X)<3) X
"^DD",984.9,984.9,3.01,3)
Answer must be 3-30 characters in length.
"^DD",984.9,984.9,3.01,21,0)
^^5^5^3010613^
"^DD",984.9,984.9,3.01,21,1,0)
The reviewer name is a free-text name of the person reviewing the
"^DD",984.9,984.9,3.01,21,2,0)
CMOR request.  This field is blank at the reviewing site since the
"^DD",984.9,984.9,3.01,21,3,0)
Reviewed By field points to the person.  This field is used at the
"^DD",984.9,984.9,3.01,21,4,0)
originating station and is transmitted along with the result of the
"^DD",984.9,984.9,3.01,21,5,0)
request.
"^DD",984.9,984.9,3.01,"DT")
3010613
**END**
**END**
