Released PXRM*1.5*11 SEQ #11
Extracted from mail message
**KIDS**:PXRM*1.5*11^

**INSTALL NAME**
PXRM*1.5*11
"BLD",3743,0)
PXRM*1.5*11^CLINICAL REMINDERS^0^3020816^y
"BLD",3743,1,0)
^^1^1^3020723^
"BLD",3743,1,1,0)
NOIS fixes, see the National Patch Module for a complete description.
"BLD",3743,4,0)
^9.64PA^^0
"BLD",3743,"INI")

"BLD",3743,"INID")
^
"BLD",3743,"INIT")

"BLD",3743,"KRN",0)
^9.67PA^8989.52^19
"BLD",3743,"KRN",.4,0)
.4
"BLD",3743,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",3743,"KRN",.401,0)
.401
"BLD",3743,"KRN",.402,0)
.402
"BLD",3743,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",3743,"KRN",.403,0)
.403
"BLD",3743,"KRN",.5,0)
.5
"BLD",3743,"KRN",.84,0)
.84
"BLD",3743,"KRN",3.6,0)
3.6
"BLD",3743,"KRN",3.8,0)
3.8
"BLD",3743,"KRN",9.2,0)
9.2
"BLD",3743,"KRN",9.8,0)
9.8
"BLD",3743,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",3743,"KRN",9.8,"NM",1,0)
PXRMDRUG^^0^B42074946
"BLD",3743,"KRN",9.8,"NM",2,0)
PXRMXGPR^^0^B82373071
"BLD",3743,"KRN",9.8,"NM",3,0)
PXRMDGEN^^0^B12485773
"BLD",3743,"KRN",9.8,"NM",4,0)
PXRMDRCL^^0^B12694959
"BLD",3743,"KRN",9.8,"NM",5,0)
PXRMRAD^^0^B19971070
"BLD",3743,"KRN",9.8,"NM",6,0)
PXRMXD^^0^B79034626
"BLD",3743,"KRN",9.8,"NM","B","PXRMDGEN",3)

"BLD",3743,"KRN",9.8,"NM","B","PXRMDRCL",4)

"BLD",3743,"KRN",9.8,"NM","B","PXRMDRUG",1)

"BLD",3743,"KRN",9.8,"NM","B","PXRMRAD",5)

"BLD",3743,"KRN",9.8,"NM","B","PXRMXD",6)

"BLD",3743,"KRN",9.8,"NM","B","PXRMXGPR",2)

"BLD",3743,"KRN",19,0)
19
"BLD",3743,"KRN",19,"NM",0)
^9.68A^^0
"BLD",3743,"KRN",19.1,0)
19.1
"BLD",3743,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",3743,"KRN",101,0)
101
"BLD",3743,"KRN",101,"NM",0)
^9.68A^^
"BLD",3743,"KRN",409.61,0)
409.61
"BLD",3743,"KRN",771,0)
771
"BLD",3743,"KRN",870,0)
870
"BLD",3743,"KRN",8989.51,0)
8989.51
"BLD",3743,"KRN",8989.52,0)
8989.52
"BLD",3743,"KRN",8994,0)
8994
"BLD",3743,"KRN","B",.4,.4)

"BLD",3743,"KRN","B",.401,.401)

"BLD",3743,"KRN","B",.402,.402)

"BLD",3743,"KRN","B",.403,.403)

"BLD",3743,"KRN","B",.5,.5)

"BLD",3743,"KRN","B",.84,.84)

"BLD",3743,"KRN","B",3.6,3.6)

"BLD",3743,"KRN","B",3.8,3.8)

"BLD",3743,"KRN","B",9.2,9.2)

"BLD",3743,"KRN","B",9.8,9.8)

"BLD",3743,"KRN","B",19,19)

"BLD",3743,"KRN","B",19.1,19.1)

"BLD",3743,"KRN","B",101,101)

"BLD",3743,"KRN","B",409.61,409.61)

"BLD",3743,"KRN","B",771,771)

"BLD",3743,"KRN","B",870,870)

"BLD",3743,"KRN","B",8989.51,8989.51)

"BLD",3743,"KRN","B",8989.52,8989.52)

"BLD",3743,"KRN","B",8994,8994)

"BLD",3743,"QUES",0)
^9.62^^
"BLD",3743,"REQB",0)
^9.611^2^2
"BLD",3743,"REQB",1,0)
PXRM*1.5*10^2
"BLD",3743,"REQB",2,0)
PXRM*1.5*8^2
"BLD",3743,"REQB","B","PXRM*1.5*10",1)

"BLD",3743,"REQB","B","PXRM*1.5*8",2)

"MBREQ")
0
"PKG",364,-1)
1^1
"PKG",364,0)
CLINICAL REMINDERS^PXRM^Clinical Reminders^^^3020725
"PKG",364,20,0)
^9.402P^^
"PKG",364,22,0)
^9.49I^1^1
"PKG",364,22,1,0)
1.5^3000619^3000622^1342
"PKG",364,22,1,"PAH",1,0)
11^3020816
"PKG",364,22,1,"PAH",1,1,0)
^^1^1^3020816
"PKG",364,22,1,"PAH",1,1,1,0)
NOIS fixes, see the National Patch Module for a complete description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PXRMDGEN")
0^3^B12485773
"RTN","PXRMDGEN",1,0)
PXRMDGEN ; SLC/PKR - Handle VA GENERIC drug findings. ;07/18/2002
"RTN","PXRMDGEN",2,0)
 ;;1.5;CLINICAL REMINDERS;**2,5,11**;Jun 19, 2000
"RTN","PXRMDGEN",3,0)
 ;
"RTN","PXRMDGEN",4,0)
 ;=======================================================================
"RTN","PXRMDGEN",5,0)
EVALFI(DFN,FIEVAL) ;Evaluate VA GENERIC (file #50.6) findings.
"RTN","PXRMDGEN",6,0)
 N FIND0,FINDING,VAGIEN
"RTN","PXRMDGEN",7,0)
 S VAGIEN=""
"RTN","PXRMDGEN",8,0)
 F  S VAGIEN=$O(^PXD(811.9,PXRMITEM,20,"E","PSNDF(50.6,",VAGIEN)) Q:+VAGIEN=0  D
"RTN","PXRMDGEN",9,0)
 . S FINDING=""
"RTN","PXRMDGEN",10,0)
 . F  S FINDING=$O(^PXD(811.9,PXRMITEM,20,"E","PSNDF(50.6,",VAGIEN,FINDING)) Q:+FINDING=0  D
"RTN","PXRMDGEN",11,0)
 .. S FIND0=^PXD(811.9,PXRMITEM,20,FINDING,0)
"RTN","PXRMDGEN",12,0)
 .. D FIEVAL(DFN,VAGIEN,FIND0,"",FINDING,.FIEVAL)
"RTN","PXRMDGEN",13,0)
 Q
"RTN","PXRMDGEN",14,0)
 ;
"RTN","PXRMDGEN",15,0)
 ;=======================================================================
"RTN","PXRMDGEN",16,0)
EVALTERM(DFN,FINDING,TERMIEN,TFIEVAL) ;Evaluate VA GENERIC (file #50.6) terms.
"RTN","PXRMDGEN",17,0)
 N FIND0,TFIND0,TFINDING,VAGIEN
"RTN","PXRMDGEN",18,0)
 S FIND0=^PXD(811.9,PXRMITEM,20,FINDING,0)
"RTN","PXRMDGEN",19,0)
 S VAGIEN=""
"RTN","PXRMDGEN",20,0)
 F  S VAGIEN=$O(^PXRMD(811.5,TERMIEN,20,"E","PSNDF(50.6,",VAGIEN)) Q:+VAGIEN=0  D
"RTN","PXRMDGEN",21,0)
 . S TFINDING=""
"RTN","PXRMDGEN",22,0)
 . F  S TFINDING=$O(^PXRMD(811.5,TERMIEN,20,"E","PSNDF(50.6,",VAGIEN,TFINDING)) Q:+TFINDING=0  D
"RTN","PXRMDGEN",23,0)
 .. S TFIND0=^PXRMD(811.5,TERMIEN,20,TFINDING,0)
"RTN","PXRMDGEN",24,0)
 .. D FIEVAL(DFN,VAGIEN,FIND0,TFIND0,TFINDING,.TFIEVAL)
"RTN","PXRMDGEN",25,0)
 Q
"RTN","PXRMDGEN",26,0)
 ;
"RTN","PXRMDGEN",27,0)
 ;=======================================================================
"RTN","PXRMDGEN",28,0)
FIEVAL(DFN,VAGIEN,FIND0,TFIND0,FINDING,FIEVAL) ;
"RTN","PXRMDGEN",29,0)
 N DRUG,DRUGIEN,DSUP,LDATE,RDATE,RXTYPE,SDATE,STATUS,VAGEN,VALID
"RTN","PXRMDGEN",30,0)
 S RXTYPE=$P(TFIND0,U,13)
"RTN","PXRMDGEN",31,0)
 I RXTYPE="" S RXTYPE=$P(FIND0,U,13)
"RTN","PXRMDGEN",32,0)
 I RXTYPE="B" S RXTYPE=""
"RTN","PXRMDGEN",33,0)
 S VAGEN=$$VAGN^PSNAPIS(VAGIEN)
"RTN","PXRMDGEN",34,0)
 ;Use the "AND" cross-reference on file 50 to find all drugs in this
"RTN","PXRMDGEN",35,0)
 ;generic group.
"RTN","PXRMDGEN",36,0)
 S DATE=0
"RTN","PXRMDGEN",37,0)
 S DRUGIEN=0
"RTN","PXRMDGEN",38,0)
 F  S DRUGIEN=$O(^PSDRUG("AND",VAGIEN,DRUGIEN)) Q:+DRUGIEN=0  D
"RTN","PXRMDGEN",39,0)
 . S DRUG=$$GET1^DIQ(50,DRUGIEN,.01)
"RTN","PXRMDGEN",40,0)
 . D LDATE^PXRMDRUG(DFN,DRUG,RXTYPE,.DSUP,.LDATE,.RDATE,.SDATE,.STATUS)
"RTN","PXRMDGEN",41,0)
 . I LDATE>DATE D
"RTN","PXRMDGEN",42,0)
 .. K FIEVAL(FINDING)
"RTN","PXRMDGEN",43,0)
 .. S DATE=LDATE
"RTN","PXRMDGEN",44,0)
 .. S FIEVAL(FINDING,"DATE")=DATE
"RTN","PXRMDGEN",45,0)
 .. S FIEVAL(FINDING,"DRUG")=DRUG
"RTN","PXRMDGEN",46,0)
 .. I DSUP>0 S FIEVAL(FINDING,"DSUP")=DSUP
"RTN","PXRMDGEN",47,0)
 .. I RDATE>0 S FIEVAL(FINDING,"RDATE")=RDATE
"RTN","PXRMDGEN",48,0)
 .. I SDATE>0 S FIEVAL(FINDING,"SDATE")=SDATE
"RTN","PXRMDGEN",49,0)
 .. S FIEVAL(FINDING,"STATUS")=STATUS
"RTN","PXRMDGEN",50,0)
 ;If the last date is 0 then there is no release date and the finding
"RTN","PXRMDGEN",51,0)
 ;is false.
"RTN","PXRMDGEN",52,0)
 I +DATE=0 D  Q
"RTN","PXRMDGEN",53,0)
 . K FIEVAL(FINDING)
"RTN","PXRMDGEN",54,0)
 . S FIEVAL(FINDING)=0
"RTN","PXRMDGEN",55,0)
 ;Save the rest of the finding information.
"RTN","PXRMDGEN",56,0)
 S FIEVAL(FINDING)=1
"RTN","PXRMDGEN",57,0)
 S FIEVAL(FINDING,"GENERIC")=VAGEN
"RTN","PXRMDGEN",58,0)
 S FIEVAL(FINDING,"DATE")=DATE
"RTN","PXRMDGEN",59,0)
 S FIEVAL(FINDING,"FINDING")=VAGIEN_";PSNDF(50.6,"
"RTN","PXRMDGEN",60,0)
 ;Determine if the finding has expired.
"RTN","PXRMDGEN",61,0)
 S VALID=$$VALID^PXRMDATE(FIND0,TFIND0,DATE)
"RTN","PXRMDGEN",62,0)
 I 'VALID D
"RTN","PXRMDGEN",63,0)
 . S FIEVAL(FINDING)=0
"RTN","PXRMDGEN",64,0)
 . S FIEVAL(FINDING,"EXPIRED")=""
"RTN","PXRMDGEN",65,0)
 Q
"RTN","PXRMDGEN",66,0)
 ;
"RTN","PXRMDGEN",67,0)
 ;=======================================================================
"RTN","PXRMDGEN",68,0)
OUTPUT(NLINES,TEXT,FINDING,FIEVAL) ;Produce the clinical
"RTN","PXRMDGEN",69,0)
 ;maintenance output.
"RTN","PXRMDGEN",70,0)
 N DATE,DRUG,TEMP,VAGEN
"RTN","PXRMDGEN",71,0)
 S DATE=FIEVAL(FINDING,"DATE")
"RTN","PXRMDGEN",72,0)
 S TEMP=$$EDATE^PXRMDATE(DATE)
"RTN","PXRMDGEN",73,0)
 S TEMP=TEMP_" VA GENERIC Drug: "
"RTN","PXRMDGEN",74,0)
 S VAGEN=FIEVAL(FINDING,"GENERIC")
"RTN","PXRMDGEN",75,0)
 S TEMP=TEMP_VAGEN
"RTN","PXRMDGEN",76,0)
 S DRUG=FIEVAL(FINDING,"DRUG")
"RTN","PXRMDGEN",77,0)
 S TEMP=TEMP_" (Drug: "_DRUG_")"
"RTN","PXRMDGEN",78,0)
 ;If the finding has expired add "EXPIRED"
"RTN","PXRMDGEN",79,0)
 I $D(FIEVAL(FINDING,"EXPIRED")) S TEMP=TEMP_" - EXPIRED"
"RTN","PXRMDGEN",80,0)
 S NLINES=NLINES+1
"RTN","PXRMDGEN",81,0)
 S TEXT(NLINES)=TEMP
"RTN","PXRMDGEN",82,0)
 S TEMP="Status: "_FIEVAL(FINDING,"STATUS")
"RTN","PXRMDGEN",83,0)
 I $D(FIEVAL(FINDING,"RDATE")) S TEMP=TEMP_" Last release date:"_$$EDATE^PXRMDATE(FIEVAL(FINDING,"RDATE"))
"RTN","PXRMDGEN",84,0)
 I $D(FIEVAL(FINDING,"DSUP")) S TEMP=TEMP_" Days supply:"_FIEVAL(FINDING,"DSUP")
"RTN","PXRMDGEN",85,0)
 I $D(FIEVAL(FINDING,"SDATE")) S TEMP=TEMP_" Stop date:"_$$EDATE^PXRMDATE(FIEVAL(FINDING,"SDATE"))
"RTN","PXRMDGEN",86,0)
 S NLINES=NLINES+1
"RTN","PXRMDGEN",87,0)
 S TEXT(NLINES)=TEMP
"RTN","PXRMDGEN",88,0)
 I $D(PXRMDEV) D
"RTN","PXRMDGEN",89,0)
 . N UID
"RTN","PXRMDGEN",90,0)
 . S UID="VA GENERIC DRUG "_VAGEN
"RTN","PXRMDGEN",91,0)
 . S ^TMP(PXRMPID,$J,PXRMITEM,UID)=TEMP
"RTN","PXRMDGEN",92,0)
 Q
"RTN","PXRMDGEN",93,0)
 ;
"RTN","PXRMDRCL")
0^4^B12694959
"RTN","PXRMDRCL",1,0)
PXRMDRCL ; SLC/PKR - Handle VA DRUG CLASS findings. ;07/18/2002
"RTN","PXRMDRCL",2,0)
 ;;1.5;CLINICAL REMINDERS;**2,5,11**;Jun 19, 2000
"RTN","PXRMDRCL",3,0)
 ;
"RTN","PXRMDRCL",4,0)
 ;=======================================================================
"RTN","PXRMDRCL",5,0)
EVALFI(DFN,FIEVAL) ;Evaluate drug class (file #50.605) findings.
"RTN","PXRMDRCL",6,0)
 N DRCLIEN,FIND0,FINDING
"RTN","PXRMDRCL",7,0)
 S DRCLIEN=""
"RTN","PXRMDRCL",8,0)
 F  S DRCLIEN=$O(^PXD(811.9,PXRMITEM,20,"E","PS(50.605,",DRCLIEN)) Q:+DRCLIEN=0  D
"RTN","PXRMDRCL",9,0)
 . S FINDING=""
"RTN","PXRMDRCL",10,0)
 . F  S FINDING=$O(^PXD(811.9,PXRMITEM,20,"E","PS(50.605,",DRCLIEN,FINDING)) Q:+FINDING=0  D
"RTN","PXRMDRCL",11,0)
 .. S FIND0=^PXD(811.9,PXRMITEM,20,FINDING,0)
"RTN","PXRMDRCL",12,0)
 .. D FIEVAL(DFN,DRCLIEN,FIND0,"",FINDING,.FIEVAL)
"RTN","PXRMDRCL",13,0)
 Q
"RTN","PXRMDRCL",14,0)
 ;
"RTN","PXRMDRCL",15,0)
 ;=======================================================================
"RTN","PXRMDRCL",16,0)
EVALTERM(DFN,FINDING,TERMIEN,TFIEVAL) ;Evaluate drug class (file #50.605) terms.
"RTN","PXRMDRCL",17,0)
 N DRCLIEN,FIND0,TFIND0,TFINDING
"RTN","PXRMDRCL",18,0)
 S FIND0=^PXD(811.9,PXRMITEM,20,FINDING,0)
"RTN","PXRMDRCL",19,0)
 S DRCLIEN=""
"RTN","PXRMDRCL",20,0)
 F  S DRCLIEN=$O(^PXRMD(811.5,TERMIEN,20,"E","PS(50.605,",DRCLIEN)) Q:+DRCLIEN=0  D
"RTN","PXRMDRCL",21,0)
 . S TFINDING=""
"RTN","PXRMDRCL",22,0)
 . F  S TFINDING=$O(^PXRMD(811.5,TERMIEN,20,"E","PS(50.605,",DRCLIEN,TFINDING)) Q:+TFINDING=0  D
"RTN","PXRMDRCL",23,0)
 .. S TFIND0=^PXRMD(811.5,TERMIEN,20,TFINDING,0)
"RTN","PXRMDRCL",24,0)
 .. D FIEVAL(DFN,DRCLIEN,FIND0,TFIND0,TFINDING,.TFIEVAL)
"RTN","PXRMDRCL",25,0)
 Q
"RTN","PXRMDRCL",26,0)
 ;
"RTN","PXRMDRCL",27,0)
 ;=======================================================================
"RTN","PXRMDRCL",28,0)
FIEVAL(DFN,DRCLIEN,FIND0,TFIND0,FINDING,FIEVAL) ;
"RTN","PXRMDRCL",29,0)
 N DATE,DRUGCLAS,DRUG,DRUGIEN,DSUP,LDATE,RDATE,RXTYPE,SDATE,STATUS,VALID
"RTN","PXRMDRCL",30,0)
 S RXTYPE=$P(TFIND0,U,13)
"RTN","PXRMDRCL",31,0)
 I RXTYPE="" S RXTYPE=$P(FIND0,U,13)
"RTN","PXRMDRCL",32,0)
 I RXTYPE="B" S RXTYPE=""
"RTN","PXRMDRCL",33,0)
 S DRUGCLAS=$$CLASS2^PSNAPIS(DRCLIEN)
"RTN","PXRMDRCL",34,0)
 ;Use the "VAC" cross-reference on file 50 to find all drugs in this
"RTN","PXRMDRCL",35,0)
 ;class
"RTN","PXRMDRCL",36,0)
 S DATE=0
"RTN","PXRMDRCL",37,0)
 S DRUGIEN=0
"RTN","PXRMDRCL",38,0)
 F  S DRUGIEN=$O(^PSDRUG("VAC",DRCLIEN,DRUGIEN)) Q:+DRUGIEN=0  D
"RTN","PXRMDRCL",39,0)
 . S DRUG=$$GET1^DIQ(50,DRUGIEN,.01)
"RTN","PXRMDRCL",40,0)
 . D LDATE^PXRMDRUG(DFN,DRUG,RXTYPE,.DSUP,.LDATE,.RDATE,.SDATE,.STATUS)
"RTN","PXRMDRCL",41,0)
 . I LDATE>DATE D
"RTN","PXRMDRCL",42,0)
 .. K FIEVAL(FINDING)
"RTN","PXRMDRCL",43,0)
 .. S DATE=LDATE
"RTN","PXRMDRCL",44,0)
 .. S FIEVAL(FINDING,"DATE")=DATE
"RTN","PXRMDRCL",45,0)
 .. S FIEVAL(FINDING,"DRUG")=DRUG
"RTN","PXRMDRCL",46,0)
 .. I DSUP>0 S FIEVAL(FINDING,"DSUP")=DSUP
"RTN","PXRMDRCL",47,0)
 .. I RDATE>0 S FIEVAL(FINDING,"RDATE")=RDATE
"RTN","PXRMDRCL",48,0)
 .. I SDATE>0 S FIEVAL(FINDING,"SDATE")=SDATE
"RTN","PXRMDRCL",49,0)
 .. S FIEVAL(FINDING,"STATUS")=STATUS
"RTN","PXRMDRCL",50,0)
 ;If the last date is 0 then there is no release date or stop date
"RTN","PXRMDRCL",51,0)
 ;and the finding is false.
"RTN","PXRMDRCL",52,0)
 I +DATE=0 D  Q
"RTN","PXRMDRCL",53,0)
 . K FIEVAL(FINDING)
"RTN","PXRMDRCL",54,0)
 . S FIEVAL(FINDING)=0
"RTN","PXRMDRCL",55,0)
 ;Save the rest of the finding information.
"RTN","PXRMDRCL",56,0)
 S FIEVAL(FINDING)=1
"RTN","PXRMDRCL",57,0)
 S FIEVAL(FINDING,"DRUG CLASS")=DRUGCLAS
"RTN","PXRMDRCL",58,0)
 S FIEVAL(FINDING,"FINDING")=DRCLIEN_";PS(50.605,"
"RTN","PXRMDRCL",59,0)
 ;Determine if the finding has expired.
"RTN","PXRMDRCL",60,0)
 S VALID=$$VALID^PXRMDATE(FIND0,TFIND0,DATE)
"RTN","PXRMDRCL",61,0)
 I 'VALID D
"RTN","PXRMDRCL",62,0)
 . S FIEVAL(FINDING)=0
"RTN","PXRMDRCL",63,0)
 . S FIEVAL(FINDING,"EXPIRED")=""
"RTN","PXRMDRCL",64,0)
 Q
"RTN","PXRMDRCL",65,0)
 ;
"RTN","PXRMDRCL",66,0)
 ;=======================================================================
"RTN","PXRMDRCL",67,0)
OUTPUT(NLINES,TEXT,FINDING,FIEVAL) ;Produce the clinical
"RTN","PXRMDRCL",68,0)
 ;maintenance output.
"RTN","PXRMDRCL",69,0)
 N DATE,DRUG,DRUGCLAS,TEMP
"RTN","PXRMDRCL",70,0)
 S DATE=FIEVAL(FINDING,"DATE")
"RTN","PXRMDRCL",71,0)
 S TEMP=$$EDATE^PXRMDATE(DATE)
"RTN","PXRMDRCL",72,0)
 S TEMP=TEMP_" Drug Class: "
"RTN","PXRMDRCL",73,0)
 S DRUGCLAS=FIEVAL(FINDING,"DRUG CLASS")
"RTN","PXRMDRCL",74,0)
 S TEMP=TEMP_$P(DRUGCLAS,U,1)_"-"_$P(DRUGCLAS,U,2)
"RTN","PXRMDRCL",75,0)
 S DRUG=FIEVAL(FINDING,"DRUG")
"RTN","PXRMDRCL",76,0)
 S TEMP=TEMP_" (Drug: "_DRUG_")"
"RTN","PXRMDRCL",77,0)
 ;If the finding has expired add "EXPIRED"
"RTN","PXRMDRCL",78,0)
 I $D(FIEVAL(FINDING,"EXPIRED")) S TEMP=TEMP_" - EXPIRED"
"RTN","PXRMDRCL",79,0)
 S NLINES=NLINES+1
"RTN","PXRMDRCL",80,0)
 S TEXT(NLINES)=TEMP
"RTN","PXRMDRCL",81,0)
 S TEMP="Status: "_FIEVAL(FINDING,"STATUS")
"RTN","PXRMDRCL",82,0)
 I $D(FIEVAL(FINDING,"RDATE")) S TEMP=TEMP_" Last release date:"_$$EDATE^PXRMDATE(FIEVAL(FINDING,"RDATE"))
"RTN","PXRMDRCL",83,0)
 I $D(FIEVAL(FINDING,"DSUP")) S TEMP=TEMP_" Days supply:"_FIEVAL(FINDING,"DSUP")
"RTN","PXRMDRCL",84,0)
 I $D(FIEVAL(FINDING,"SDATE")) S TEMP=TEMP_" Stop date:"_$$EDATE^PXRMDATE(FIEVAL(FINDING,"SDATE"))
"RTN","PXRMDRCL",85,0)
 S NLINES=NLINES+1
"RTN","PXRMDRCL",86,0)
 S TEXT(NLINES)=TEMP
"RTN","PXRMDRCL",87,0)
 I $D(PXRMDEV) D
"RTN","PXRMDRCL",88,0)
 . N UID
"RTN","PXRMDRCL",89,0)
 . S UID="DRUG CLASS "_DRUGCLAS
"RTN","PXRMDRCL",90,0)
 . S ^TMP(PXRMPID,$J,PXRMITEM,UID)=TEMP
"RTN","PXRMDRCL",91,0)
 Q
"RTN","PXRMDRCL",92,0)
 ;
"RTN","PXRMDRUG")
0^1^B42074946
"RTN","PXRMDRUG",1,0)
PXRMDRUG ; SLC/PKR - Handle drug findings. ;05/31/2002
"RTN","PXRMDRUG",2,0)
 ;;1.5;CLINICAL REMINDERS;**2,5,8,11**;Jun 19, 2000
"RTN","PXRMDRUG",3,0)
 ;
"RTN","PXRMDRUG",4,0)
 ;=======================================================================
"RTN","PXRMDRUG",5,0)
BLDCACHE(DFN) ;Build the patient drug cache.
"RTN","PXRMDRUG",6,0)
 N PXRMDFN S PXRMDFN="PXRMDFN"_DFN
"RTN","PXRMDRUG",7,0)
 K ^TMP("PS",$J),^XTMP(PXRMDFN,"PSDRUG")
"RTN","PXRMDRUG",8,0)
 N DRUG,DRUGIEN,DSUP,IND,OITEM,ORDER,POI,RDATE,SDATE,STATUS,TEMP
"RTN","PXRMDRUG",9,0)
 ;Start the search for drugs on the patient's date of birth
"RTN","PXRMDRUG",10,0)
 ;to make sure we get all of them.
"RTN","PXRMDRUG",11,0)
 D OCL^PSOORRL(DFN,PXRMDOB,"")
"RTN","PXRMDRUG",12,0)
 S IND=0
"RTN","PXRMDRUG",13,0)
 F  S IND=$O(^TMP("PS",$J,IND)) Q:+IND=0  D
"RTN","PXRMDRUG",14,0)
 . S TEMP=^TMP("PS",$J,IND,0)
"RTN","PXRMDRUG",15,0)
 . S ORDER=$P(TEMP,U,1)
"RTN","PXRMDRUG",16,0)
 . I $L(ORDER)=0 Q
"RTN","PXRMDRUG",17,0)
 . S DRUG=$P(TEMP,U,2)
"RTN","PXRMDRUG",18,0)
 . S STATUS=$P(TEMP,U,9)
"RTN","PXRMDRUG",19,0)
 .;Look for DRUG file entries, if not there then probably pharmacy
"RTN","PXRMDRUG",20,0)
 .;orderable item.
"RTN","PXRMDRUG",21,0)
 . I $L(DRUG)=0 S DRUGIEN=0
"RTN","PXRMDRUG",22,0)
 . E  S DRUGIEN=+$O(^PSDRUG("B",DRUG,""))
"RTN","PXRMDRUG",23,0)
 . I DRUGIEN>0 D
"RTN","PXRMDRUG",24,0)
 .. I ORDER["O" D
"RTN","PXRMDRUG",25,0)
 ... S RDATE=+$P(TEMP,U,16)
"RTN","PXRMDRUG",26,0)
 ... S DSUP=+$P(TEMP,U,17)
"RTN","PXRMDRUG",27,0)
 ... S DATE=+$$FMADD^XLFDT(RDATE,DSUP)
"RTN","PXRMDRUG",28,0)
 ... S ^XTMP(PXRMDFN,"PSDRUG",DRUG,DATE)=ORDER_U_STATUS_U_RDATE_U_DSUP
"RTN","PXRMDRUG",29,0)
 .. I ORDER["I" D
"RTN","PXRMDRUG",30,0)
 ... S SDATE=+$P(TEMP,U,4)
"RTN","PXRMDRUG",31,0)
 ... I SDATE=0 D SDERR(ORDER)  Q
"RTN","PXRMDRUG",32,0)
 ... S ^XTMP(PXRMDFN,"PSDRUG",DRUG,SDATE)=ORDER_U_STATUS_SDATE
"RTN","PXRMDRUG",33,0)
 . E  S POI(ORDER)=""
"RTN","PXRMDRUG",34,0)
 K ^TMP("PS",$J)
"RTN","PXRMDRUG",35,0)
 ;Process the pharmacy orderable item list.
"RTN","PXRMDRUG",36,0)
 S ORDER=""
"RTN","PXRMDRUG",37,0)
 F  S ORDER=$O(POI(ORDER)) Q:ORDER=""  D
"RTN","PXRMDRUG",38,0)
 . D OEL^PSOORRL(DFN,ORDER)
"RTN","PXRMDRUG",39,0)
 . I '$D(^TMP("PS",$J,"DD")) K ^TMP("PS",$J) Q
"RTN","PXRMDRUG",40,0)
 . S TEMP=^TMP("PS",$J,0)
"RTN","PXRMDRUG",41,0)
 . S SDATE=+$P(TEMP,U,3)
"RTN","PXRMDRUG",42,0)
 . I SDATE=0 D SDERR(ORDER)  Q
"RTN","PXRMDRUG",43,0)
 . S STATUS=$P(TEMP,U,6)
"RTN","PXRMDRUG",44,0)
 . F IND=+$G(^TMP("PS",$J,"DD",0)) Q:+IND=0  D
"RTN","PXRMDRUG",45,0)
 ..;Get the dispense drug.
"RTN","PXRMDRUG",46,0)
 .. S DRUGIEN=+$P(^TMP("PS",$J,"DD",IND,0),U,1)
"RTN","PXRMDRUG",47,0)
 .. I (DRUGIEN=0) D  Q
"RTN","PXRMDRUG",48,0)
 ... I ($P(ORDER,";",1)'["P")!($P(ORDER,";",2)'="I") D
"RTN","PXRMDRUG",49,0)
 .... N XMSUB
"RTN","PXRMDRUG",50,0)
 .... K ^TMP("PXRMXMZ",$J)
"RTN","PXRMDRUG",51,0)
 .... S XMSUB="CLINICAL REMINDER DATA PROBLEM, INPATIENT MEDICATION"
"RTN","PXRMDRUG",52,0)
 .... S ^TMP("PXRMXMZ",$J,1,0)="Warning - Pharmacy order "_ORDER_", for patient DFN= "_DFN_","
"RTN","PXRMDRUG",53,0)
 .... S ^TMP("PXRMXMZ",$J,2,0)="is missing the dispense drug."
"RTN","PXRMDRUG",54,0)
 .... S OITEM=+$P(^TMP("PS",$J,"DD",IND,0),U,4)
"RTN","PXRMDRUG",55,0)
 .... I OITEM>0 S OITEM=$P(^ORD(101.43,OITEM,0),U,1)
"RTN","PXRMDRUG",56,0)
 .... E  S OITEM="Missing"
"RTN","PXRMDRUG",57,0)
 .... S ^TMP("PXRMXMZ",$J,3,0)="Orderable item: "_OITEM
"RTN","PXRMDRUG",58,0)
 .... S ^TMP("PXRMXMZ",$J,4,0)="This indicates a possible data problem."
"RTN","PXRMDRUG",59,0)
 .... D SEND^PXRMMSG(XMSUB)
"RTN","PXRMDRUG",60,0)
 .. S DRUG=$P(^PSDRUG(DRUGIEN,0),U,1)
"RTN","PXRMDRUG",61,0)
 .. S ^XTMP(PXRMDFN,"PSDRUG",DRUG,SDATE)=ORDER_U_STATUS_U_SDATE
"RTN","PXRMDRUG",62,0)
 . K ^TMP("PS",$J)
"RTN","PXRMDRUG",63,0)
 K ^TMP("PS",$J)
"RTN","PXRMDRUG",64,0)
 Q
"RTN","PXRMDRUG",65,0)
 ;
"RTN","PXRMDRUG",66,0)
 ;=======================================================================
"RTN","PXRMDRUG",67,0)
EVALFI(DFN,FIEVAL) ;Evaluate drug (file #50) findings.
"RTN","PXRMDRUG",68,0)
 N DRUGIEN,FIND0,FIND3,FINDING
"RTN","PXRMDRUG",69,0)
 S DRUGIEN=""
"RTN","PXRMDRUG",70,0)
 F  S DRUGIEN=$O(^PXD(811.9,PXRMITEM,20,"E","PSDRUG(",DRUGIEN)) Q:+DRUGIEN=0  D
"RTN","PXRMDRUG",71,0)
 . S FINDING=""
"RTN","PXRMDRUG",72,0)
 . F  S FINDING=$O(^PXD(811.9,PXRMITEM,20,"E","PSDRUG(",DRUGIEN,FINDING)) Q:+FINDING=0  D
"RTN","PXRMDRUG",73,0)
 .. S FIND0=^PXD(811.9,PXRMITEM,20,FINDING,0)
"RTN","PXRMDRUG",74,0)
 .. S FIND3=$G(^PXD(811.9,PXRMITEM,20,FINDING,3))
"RTN","PXRMDRUG",75,0)
 .. D FIEVAL(DFN,DRUGIEN,FIND0,FIND3,"","",FINDING,.FIEVAL)
"RTN","PXRMDRUG",76,0)
 Q
"RTN","PXRMDRUG",77,0)
 ;
"RTN","PXRMDRUG",78,0)
 ;=======================================================================
"RTN","PXRMDRUG",79,0)
EVALTERM(DFN,FINDING,TERMIEN,TFIEVAL) ;Evaluate drug (file #50) terms.
"RTN","PXRMDRUG",80,0)
 N DRUGIEN,FIND0,FIND3,TFIND0,TFIND3,TFINDING
"RTN","PXRMDRUG",81,0)
 S FIND0=^PXD(811.9,PXRMITEM,20,FINDING,0)
"RTN","PXRMDRUG",82,0)
 S FIND3=$G(^PXD(811.9,PXRMITEM,20,FINDING,3))
"RTN","PXRMDRUG",83,0)
 S DRUGIEN=""
"RTN","PXRMDRUG",84,0)
 F  S DRUGIEN=$O(^PXRMD(811.5,TERMIEN,20,"E","PSDRUG(",DRUGIEN)) Q:+DRUGIEN=0  D
"RTN","PXRMDRUG",85,0)
 . S TFINDING=""
"RTN","PXRMDRUG",86,0)
 . F  S TFINDING=$O(^PXRMD(811.5,TERMIEN,20,"E","PSDRUG(",DRUGIEN,TFINDING)) Q:+TFINDING=0  D
"RTN","PXRMDRUG",87,0)
 .. S TFIND0=^PXRMD(811.5,TERMIEN,20,TFINDING,0)
"RTN","PXRMDRUG",88,0)
 .. S TFIND3=$G(^PXRMD(811.5,TERMIEN,20,TFINDING,3))
"RTN","PXRMDRUG",89,0)
 .. D FIEVAL(DFN,DRUGIEN,FIND0,FIND3,TFIND0,TFIND3,TFINDING,.TFIEVAL)
"RTN","PXRMDRUG",90,0)
 Q
"RTN","PXRMDRUG",91,0)
 ;
"RTN","PXRMDRUG",92,0)
 ;=======================================================================
"RTN","PXRMDRUG",93,0)
FIEVAL(DFN,DRUGIEN,FIND0,FIND3,TFIND0,TFIND3,FINDING,FIEVAL) ;
"RTN","PXRMDRUG",94,0)
 N CONVAL,DRUG,DSUP,LDATE,RDATE,RXTYPE,SDATE,STATUS,VALID
"RTN","PXRMDRUG",95,0)
 S RXTYPE=$P(TFIND0,U,13)
"RTN","PXRMDRUG",96,0)
 I RXTYPE="" S RXTYPE=$P(FIND0,U,13)
"RTN","PXRMDRUG",97,0)
 I RXTYPE="B" S RXTYPE=""
"RTN","PXRMDRUG",98,0)
 S DRUG=$P(^PSDRUG(DRUGIEN,0),U,1)
"RTN","PXRMDRUG",99,0)
 D LDATE(DFN,DRUG,RXTYPE,.DSUP,.LDATE,.RDATE,.SDATE,.STATUS)
"RTN","PXRMDRUG",100,0)
 ;If the last date is 0 then there is no release or stop date and the
"RTN","PXRMDRUG",101,0)
 ;finding is false.
"RTN","PXRMDRUG",102,0)
 I +LDATE=0 S FIEVAL(FINDING)=0 Q
"RTN","PXRMDRUG",103,0)
 ;Save the rest of the finding information.
"RTN","PXRMDRUG",104,0)
 S FIEVAL(FINDING)=1
"RTN","PXRMDRUG",105,0)
 S FIEVAL(FINDING,"DATE")=LDATE
"RTN","PXRMDRUG",106,0)
 S FIEVAL(FINDING,"DRUG")=DRUG
"RTN","PXRMDRUG",107,0)
 I DSUP>0 S FIEVAL(FINDING,"DSUP")=DSUP
"RTN","PXRMDRUG",108,0)
 I RDATE>0 S FIEVAL(FINDING,"RDATE")=RDATE
"RTN","PXRMDRUG",109,0)
 I SDATE>0 S FIEVAL(FINDING,"SDATE")=SDATE
"RTN","PXRMDRUG",110,0)
 S FIEVAL(FINDING,"STATUS")=STATUS
"RTN","PXRMDRUG",111,0)
 S FIEVAL(FINDING,"FINDING")=DRUGIEN_";PSDRUG("
"RTN","PXRMDRUG",112,0)
 ;If this is being called as part of a term evaluation we are done.
"RTN","PXRMDRUG",113,0)
 I TFIND0'="" Q
"RTN","PXRMDRUG",114,0)
 ;Determine if the finding has expired.
"RTN","PXRMDRUG",115,0)
 S VALID=$$VALID^PXRMDATE(FIND0,TFIND0,LDATE)
"RTN","PXRMDRUG",116,0)
 I 'VALID D
"RTN","PXRMDRUG",117,0)
 . S FIEVAL(FINDING)=0
"RTN","PXRMDRUG",118,0)
 . S FIEVAL(FINDING,"EXPIRED")=""
"RTN","PXRMDRUG",119,0)
 ;If there is a condition for this finding evaluate it.
"RTN","PXRMDRUG",120,0)
 S CONVAL=$$COND^PXRMUTIL(FIND3,TFIND3,"")
"RTN","PXRMDRUG",121,0)
 I CONVAL'="" D
"RTN","PXRMDRUG",122,0)
 . I CONVAL D
"RTN","PXRMDRUG",123,0)
 .. S FIEVAL(FINDING)=CONVAL
"RTN","PXRMDRUG",124,0)
 .. S FIEVAL(FINDING,"CONDITION")=CONVAL
"RTN","PXRMDRUG",125,0)
 . E  D
"RTN","PXRMDRUG",126,0)
 .. K FIEVAL(FINDING)
"RTN","PXRMDRUG",127,0)
 .. S FIEVAL(FINDING)=0
"RTN","PXRMDRUG",128,0)
 Q
"RTN","PXRMDRUG",129,0)
 ;
"RTN","PXRMDRUG",130,0)
 ;=======================================================================
"RTN","PXRMDRUG",131,0)
LDATE(DFN,DRUG,RXTYPE,DSUP,LDATE,RDATE,SDATE,STATUS) ;Return last date
"RTN","PXRMDRUG",132,0)
 ;patient is on drug, refill date, days supply, or stop date, and status.
"RTN","PXRMDRUG",133,0)
 N DATE,ORDER,TEMP
"RTN","PXRMDRUG",134,0)
 I '$D(^XTMP(PXRMDFN,"PSDRUG")) D BLDCACHE(DFN)
"RTN","PXRMDRUG",135,0)
 I '$D(^XTMP(PXRMDFN,"PSDRUG",DRUG))="" S FIEVAL(FINDING)=0 Q 0
"RTN","PXRMDRUG",136,0)
 S (DSUP,RDATE,SDATE)=0
"RTN","PXRMDRUG",137,0)
 S LDATE=+$O(^XTMP(PXRMDFN,"PSDRUG",DRUG,""),-1)
"RTN","PXRMDRUG",138,0)
 I LDATE=0 Q
"RTN","PXRMDRUG",139,0)
 S TEMP=^XTMP(PXRMDFN,"PSDRUG",DRUG,LDATE)
"RTN","PXRMDRUG",140,0)
 S ORDER=$P(TEMP,U,1)
"RTN","PXRMDRUG",141,0)
 ;Make sure the Rx Type is in the order. Null RXTYPE is contained in
"RTN","PXRMDRUG",142,0)
 ;both I and O orders.
"RTN","PXRMDRUG",143,0)
 I ORDER[RXTYPE S STATUS=$P(TEMP,U,2)
"RTN","PXRMDRUG",144,0)
 E  S LDATE=0  Q
"RTN","PXRMDRUG",145,0)
 S DATE=$P(TEMP,U,3)
"RTN","PXRMDRUG",146,0)
 I ORDER["O" D
"RTN","PXRMDRUG",147,0)
 . S RDATE=DATE
"RTN","PXRMDRUG",148,0)
 . S DSUP=$P(TEMP,U,4)
"RTN","PXRMDRUG",149,0)
 E  S SDATE=DATE
"RTN","PXRMDRUG",150,0)
 Q
"RTN","PXRMDRUG",151,0)
 ;
"RTN","PXRMDRUG",152,0)
 ;=======================================================================
"RTN","PXRMDRUG",153,0)
OUTPUT(NLINES,TEXT,FINDING,FIEVAL) ;Produce the clinical
"RTN","PXRMDRUG",154,0)
 ;maintenance output.
"RTN","PXRMDRUG",155,0)
 N DATE,DRUG,TEMP
"RTN","PXRMDRUG",156,0)
 S DATE=FIEVAL(FINDING,"DATE")
"RTN","PXRMDRUG",157,0)
 S TEMP=$$EDATE^PXRMDATE(DATE)
"RTN","PXRMDRUG",158,0)
 S TEMP=TEMP_" Drug: "
"RTN","PXRMDRUG",159,0)
 S DRUG=FIEVAL(FINDING,"DRUG")
"RTN","PXRMDRUG",160,0)
 S TEMP=TEMP_DRUG
"RTN","PXRMDRUG",161,0)
 ;If the finding has expired add "EXPIRED"
"RTN","PXRMDRUG",162,0)
 I $D(FIEVAL(FINDING,"EXPIRED")) S TEMP=TEMP_" - EXPIRED"
"RTN","PXRMDRUG",163,0)
 S NLINES=NLINES+1
"RTN","PXRMDRUG",164,0)
 S TEXT(NLINES)=TEMP
"RTN","PXRMDRUG",165,0)
 S TEMP="Status: "_FIEVAL(FINDING,"STATUS")
"RTN","PXRMDRUG",166,0)
 I $D(FIEVAL(FINDING,"RDATE")) S TEMP=TEMP_" Last release date: "_$$EDATE^PXRMDATE(FIEVAL(FINDING,"RDATE"))
"RTN","PXRMDRUG",167,0)
 I $D(FIEVAL(FINDING,"DSUP")) S TEMP=TEMP_" Days supply: "_FIEVAL(FINDING,"DSUP")
"RTN","PXRMDRUG",168,0)
 I $D(FIEVAL(FINDING,"SDATE")) S TEMP=TEMP_" Stop date: "_$$EDATE^PXRMDATE(FIEVAL(FINDING,"SDATE"))
"RTN","PXRMDRUG",169,0)
 S NLINES=NLINES+1
"RTN","PXRMDRUG",170,0)
 S TEXT(NLINES)=TEMP
"RTN","PXRMDRUG",171,0)
 I $D(PXRMDEV) D
"RTN","PXRMDRUG",172,0)
 . N UID
"RTN","PXRMDRUG",173,0)
 . S UID="DRUG "_DRUG
"RTN","PXRMDRUG",174,0)
 . S ^TMP(PXRMPID,$J,PXRMITEM,UID)=TEMP
"RTN","PXRMDRUG",175,0)
 Q
"RTN","PXRMDRUG",176,0)
 ;
"RTN","PXRMDRUG",177,0)
 ;=======================================================================
"RTN","PXRMDRUG",178,0)
SDERR(ORDER) ;If the Stop Date is missing and the order is not pending
"RTN","PXRMDRUG",179,0)
 ;send an error message.
"RTN","PXRMDRUG",180,0)
 I ($P(ORDER,";",1)["P") Q
"RTN","PXRMDRUG",181,0)
 N XMSUB
"RTN","PXRMDRUG",182,0)
 K ^TMP("PXRMXMZ",$J)
"RTN","PXRMDRUG",183,0)
 S XMSUB="CLINICAL REMINDER DATA PROBLEM, INPATIENT MEDICATION"
"RTN","PXRMDRUG",184,0)
 S ^TMP("PXRMXMZ",$J,1,0)="Warning - Pharmacy order "_ORDER_", for patient DFN= "_DFN_","
"RTN","PXRMDRUG",185,0)
 S ^TMP("PXRMXMZ",$J,2,0)="is missing the stop date."
"RTN","PXRMDRUG",186,0)
 S ^TMP("PXRMXMZ",$J,3,0)="This indicates a possible data problem."
"RTN","PXRMDRUG",187,0)
 D SEND^PXRMMSG(XMSUB)
"RTN","PXRMDRUG",188,0)
 Q
"RTN","PXRMDRUG",189,0)
 ;
"RTN","PXRMRAD")
0^5^B19971070
"RTN","PXRMRAD",1,0)
PXRMRAD ; SLC/PKR - Handle radiology findings. ;07/22/2002
"RTN","PXRMRAD",2,0)
 ;;1.5;CLINICAL REMINDERS;**2,8,11**;Jun 19, 2000
"RTN","PXRMRAD",3,0)
 ;
"RTN","PXRMRAD",4,0)
 ;=======================================================================
"RTN","PXRMRAD",5,0)
EVALFI(DFN,FIEVAL) ;Evaluate radiology findings.
"RTN","PXRMRAD",6,0)
 N FIND0,FIND3,FINDING,RADPROC
"RTN","PXRMRAD",7,0)
 ;Build a list of radiology procedures.
"RTN","PXRMRAD",8,0)
 S RADPROC=""
"RTN","PXRMRAD",9,0)
 F  S RADPROC=$O(^PXD(811.9,PXRMITEM,20,"E","RAMIS(71,",RADPROC)) Q:+RADPROC=0  D
"RTN","PXRMRAD",10,0)
 . S FINDING=""
"RTN","PXRMRAD",11,0)
 . F  S FINDING=$O(^PXD(811.9,PXRMITEM,20,"E","RAMIS(71,",RADPROC,FINDING)) Q:+FINDING=0  D
"RTN","PXRMRAD",12,0)
 .. S FIND0=^PXD(811.9,PXRMITEM,20,FINDING,0)
"RTN","PXRMRAD",13,0)
 .. S FIND3=$G(^PXD(811.9,PXRMITEM,20,FINDING,3))
"RTN","PXRMRAD",14,0)
 .. D FIEVAL(DFN,RADPROC,FIND0,FIND3,"","",FINDING,.FIEVAL)
"RTN","PXRMRAD",15,0)
 Q
"RTN","PXRMRAD",16,0)
 ;
"RTN","PXRMRAD",17,0)
 ;=======================================================================
"RTN","PXRMRAD",18,0)
EVALTERM(DFN,FINDING,TERMIEN,TFIEVAL) ;Evaluate radiology terms.
"RTN","PXRMRAD",19,0)
 N FIND0,FIND3,RADPROC,TFIND0,TFIND3,TFINDING
"RTN","PXRMRAD",20,0)
 S FIND0=^PXD(811.9,PXRMITEM,20,FINDING,0)
"RTN","PXRMRAD",21,0)
 S FIND3=$G(^PXD(811.9,PXRMITEM,20,FINDING,3))
"RTN","PXRMRAD",22,0)
 ;Build a list of radiology procedures.
"RTN","PXRMRAD",23,0)
 S RADPROC=""
"RTN","PXRMRAD",24,0)
 F  S RADPROC=$O(^PXRMD(811.5,TERMIEN,20,"E","RAMIS(71,",RADPROC)) Q:+RADPROC=0  D
"RTN","PXRMRAD",25,0)
 . S TFINDING=""
"RTN","PXRMRAD",26,0)
 . F  S TFINDING=$O(^PXRMD(811.5,TERMIEN,20,"E","RAMIS(71,",RADPROC,TFINDING)) Q:+TFINDING=0  D
"RTN","PXRMRAD",27,0)
 .. S TFIND0=^PXRMD(811.5,TERMIEN,20,TFINDING,0)
"RTN","PXRMRAD",28,0)
 .. S TFIND3=$G(^PXRMD(811.5,TERMIEN,20,TFINDING,3))
"RTN","PXRMRAD",29,0)
 .. D FIEVAL(DFN,RADPROC,FIND0,FIND3,TFIND0,TFIND3,TFINDING,.TFIEVAL)
"RTN","PXRMRAD",30,0)
 Q
"RTN","PXRMRAD",31,0)
 ;
"RTN","PXRMRAD",32,0)
 ;=======================================================================
"RTN","PXRMRAD",33,0)
FIEVAL(DFN,RADPROC,FIND0,FIND3,TFIND0,TFIND3,FINDING,FIEVAL) ;
"RTN","PXRMRAD",34,0)
 N CONVAL,DATE,RADPTIEN,STATUS,TEMP,VALID
"RTN","PXRMRAD",35,0)
 S FIEVAL(FINDING)=0
"RTN","PXRMRAD",36,0)
 ;Get the matches
"RTN","PXRMRAD",37,0)
 D CLIN^RAO7PC2(DFN,RADPROC)
"RTN","PXRMRAD",38,0)
 ;If this is an unknown radiology patient we are done.
"RTN","PXRMRAD",39,0)
 I $G(^TMP($J,"RADPROC"))["Invalid" G DONE
"RTN","PXRMRAD",40,0)
 ;
"RTN","PXRMRAD",41,0)
 S RADPTIEN=$O(^TMP($J,"RADPROC",""))
"RTN","PXRMRAD",42,0)
 ;STATUS can be "CANCELLED", "COMPLETE", "IN PROGRESS", or "NONE".
"RTN","PXRMRAD",43,0)
 ;Ignore any that are cancelled.
"RTN","PXRMRAD",44,0)
 S STATUS=""
"RTN","PXRMRAD",45,0)
 F  S STATUS=$O(^TMP($J,"RADPROC",RADPTIEN,RADPROC,STATUS)) Q:STATUS=""  D
"RTN","PXRMRAD",46,0)
 . I (STATUS="NONE") Q
"RTN","PXRMRAD",47,0)
 .;If there is a "COMPLETE" status make sure we save it only.
"RTN","PXRMRAD",48,0)
 . I 'FIEVAL(FINDING) S FIEVAL(FINDING,"STATUS")=STATUS
"RTN","PXRMRAD",49,0)
 . I (STATUS="CANCELLED") D
"RTN","PXRMRAD",50,0)
 .. S FIEVAL(FINDING,"DATA")=^TMP($J,"RADPROC",RADPTIEN,RADPROC,STATUS)
"RTN","PXRMRAD",51,0)
 .. S FIEVAL(FINDING,"DATE")=$P(FIEVAL(FINDING,"DATA"),U,1)
"RTN","PXRMRAD",52,0)
 . I STATUS="COMPLETE" D
"RTN","PXRMRAD",53,0)
 .. S FIEVAL(FINDING)=1
"RTN","PXRMRAD",54,0)
 .. S FIEVAL(FINDING,"DATA")=^TMP($J,"RADPROC",RADPTIEN,RADPROC,STATUS)
"RTN","PXRMRAD",55,0)
 .. S (FIEVAL(FINDING,"DATE"),DATE)=$P(FIEVAL(FINDING,"DATA"),U,1)
"RTN","PXRMRAD",56,0)
 .;Save information about an "IN PROGRESS" procedure if it is more
"RTN","PXRMRAD",57,0)
 .;recent than the completed one or there is not a completed one.
"RTN","PXRMRAD",58,0)
 . I STATUS="IN PROGRESS" D
"RTN","PXRMRAD",59,0)
 .. S TEMP=^TMP($J,"RADPROC",RADPTIEN,RADPROC,STATUS)
"RTN","PXRMRAD",60,0)
 .. S DATE=$P(TEMP,U,1)
"RTN","PXRMRAD",61,0)
 .. I DATE>+$G(FIEVAL(FINDING,"DATE")) D
"RTN","PXRMRAD",62,0)
 ... I 'FIEVAL(FINDING) S FIEVAL(FINDING,"DATE")=DATE
"RTN","PXRMRAD",63,0)
 ... S FIEVAL(FINDING,"IN PROGRESS")=TEMP
"RTN","PXRMRAD",64,0)
 . S FIEVAL(FINDING,"FINDING")=RADPROC_";RAMIS(71,"
"RTN","PXRMRAD",65,0)
 ;If this is being called as part of a term evaluation we are done.
"RTN","PXRMRAD",66,0)
 I TFIND0'="" Q
"RTN","PXRMRAD",67,0)
 ;Determine if the finding has expired.
"RTN","PXRMRAD",68,0)
 I FIEVAL(FINDING) D
"RTN","PXRMRAD",69,0)
 . S VALID=$$VALID^PXRMDATE(FIND0,TFIND0,FIEVAL(FINDING,"DATE"))
"RTN","PXRMRAD",70,0)
 . I 'VALID D
"RTN","PXRMRAD",71,0)
 .. S FIEVAL(FINDING)=0
"RTN","PXRMRAD",72,0)
 .. S FIEVAL(FINDING,"EXPIRED")=""
"RTN","PXRMRAD",73,0)
 ;If there is a condition for this finding evaluate it.
"RTN","PXRMRAD",74,0)
 S CONVAL=$$COND^PXRMUTIL(FIND3,TFIND3,"")
"RTN","PXRMRAD",75,0)
 I CONVAL'="" D
"RTN","PXRMRAD",76,0)
 . I CONVAL D
"RTN","PXRMRAD",77,0)
 .. S FIEVAL(FINDING)=CONVAL
"RTN","PXRMRAD",78,0)
 .. S FIEVAL(FINDING,"CONDITION")=CONVAL
"RTN","PXRMRAD",79,0)
 . E  D
"RTN","PXRMRAD",80,0)
 .. K FIEVAL(FINDING)
"RTN","PXRMRAD",81,0)
 .. S FIEVAL(FINDING)=0
"RTN","PXRMRAD",82,0)
DONE K ^TMP($J,"RADPROC")
"RTN","PXRMRAD",83,0)
 Q
"RTN","PXRMRAD",84,0)
 ;
"RTN","PXRMRAD",85,0)
 ;=======================================================================
"RTN","PXRMRAD",86,0)
OUTPUT(NLINES,TEXT,FINDING,FIEVAL) ;Produce the clinical
"RTN","PXRMRAD",87,0)
 ;maintenance output.
"RTN","PXRMRAD",88,0)
 N CPT,CPTDATA,CODE,D0,DATE,NAME,RADPROC,SNAME,TEMP
"RTN","PXRMRAD",89,0)
 S RADPROC=$P(FIEVAL(FINDING,"FINDING"),";",1)
"RTN","PXRMRAD",90,0)
 S DATE=FIEVAL(FINDING,"DATE")
"RTN","PXRMRAD",91,0)
 S TEMP=$$EDATE^PXRMDATE(DATE)
"RTN","PXRMRAD",92,0)
 S TEMP=TEMP_" Radiology Procedure: "
"RTN","PXRMRAD",93,0)
 S D0=^RAMIS(71,RADPROC,0)
"RTN","PXRMRAD",94,0)
 S NAME=$P(D0,U,1)
"RTN","PXRMRAD",95,0)
 S CPT=$P(D0,U,9)
"RTN","PXRMRAD",96,0)
 S CPTDATA=$$CPT^ICPTCOD(CPT)
"RTN","PXRMRAD",97,0)
 S CODE=$P(CPTDATA,U,2)
"RTN","PXRMRAD",98,0)
 S SNAME=$P(CPTDATA,U,3)
"RTN","PXRMRAD",99,0)
 S TEMP=TEMP_CODE_" ("_NAME_")"
"RTN","PXRMRAD",100,0)
 S TEMP=TEMP_" - "_SNAME
"RTN","PXRMRAD",101,0)
 S TEMP=TEMP_"; status:  "_FIEVAL(FINDING,"STATUS")
"RTN","PXRMRAD",102,0)
 ;If the finding has expired add "EXPIRED"
"RTN","PXRMRAD",103,0)
 I $D(FIEVAL(FINDING,"EXPIRED")) S TEMP=TEMP_" - EXPIRED"
"RTN","PXRMRAD",104,0)
 S NLINES=NLINES+1
"RTN","PXRMRAD",105,0)
 S TEXT(NLINES)=TEMP
"RTN","PXRMRAD",106,0)
 I $D(PXRMDEV) D
"RTN","PXRMRAD",107,0)
 . N UID
"RTN","PXRMRAD",108,0)
 . S UID="RAD "_NAME
"RTN","PXRMRAD",109,0)
 . S ^TMP(PXRMPID,$J,PXRMITEM,UID)=TEMP
"RTN","PXRMRAD",110,0)
 ;
"RTN","PXRMRAD",111,0)
 ;If there is an "IN PROGRESS" as well as complete procedure and
"RTN","PXRMRAD",112,0)
 ;the "IN PROGRESS" is newer than the complete show some information
"RTN","PXRMRAD",113,0)
 ;on it.
"RTN","PXRMRAD",114,0)
 I (FIEVAL(FINDING))&($D(FIEVAL(FINDING,"IN PROGRESS"))) D
"RTN","PXRMRAD",115,0)
 . N IPDATE,STATUS
"RTN","PXRMRAD",116,0)
 . S IPDATE=$P(FIEVAL(FINDING,"IN PROGRESS"),U,1)
"RTN","PXRMRAD",117,0)
 . I IPDATE>DATE D
"RTN","PXRMRAD",118,0)
 .. S STATUS=$P(FIEVAL(FINDING,"IN PROGRESS"),U,2)
"RTN","PXRMRAD",119,0)
 .. S TEMP="This procedure is also in progress."
"RTN","PXRMRAD",120,0)
 .. S TEMP=TEMP_" "_$$EDATE^PXRMDATE(IPDATE)
"RTN","PXRMRAD",121,0)
 .. S TEMP=TEMP_" status:  "_STATUS
"RTN","PXRMRAD",122,0)
 .. S NLINES=NLINES+1
"RTN","PXRMRAD",123,0)
 .. S TEXT(NLINES)=TEMP
"RTN","PXRMRAD",124,0)
 Q
"RTN","PXRMRAD",125,0)
 ;
"RTN","PXRMXD")
0^6^B79034626
"RTN","PXRMXD",1,0)
PXRMXD ; SLC/PJH - Reminder Due reports DRIVER ;01/15/2002
"RTN","PXRMXD",2,0)
 ;;1.5;CLINICAL REMINDERS;**6,11**;August 16, 2002
"RTN","PXRMXD",3,0)
 ;
"RTN","PXRMXD",4,0)
START ; Arrays and strings
"RTN","PXRMXD",5,0)
 N PXRMIOD,PXRMXJB,PXRMXST,PXRMOPT,PXRMQUE,PXRMXTMP,PXRMSEL
"RTN","PXRMXD",6,0)
 N PXRMFAC,PXRMFACN,PXRMSCAT,PXRMSRT
"RTN","PXRMXD",7,0)
 N REMINDER,PXRMINP,PXRMFCMB,PXRMTOT
"RTN","PXRMXD",8,0)
 ; Addenda
"RTN","PXRMXD",9,0)
 N PXRMOTM,PXRMPAT,PXRMPCM,PXRMPRV,PXRMTMP,PXRMRCAT,PXRMREM
"RTN","PXRMXD",10,0)
 N PXRMCS,PXRMCSN,PXRMLOCN,PXRMLCHL,PXRMLCSC,PXRMCGRP,PXRMCGRN
"RTN","PXRMXD",11,0)
 ; Counters
"RTN","PXRMXD",12,0)
 N NCAT,NFAC,NLOC,NPAT,NPCM,NOTM,NPRV,NREM,NCS,NHL,NCGRP
"RTN","PXRMXD",13,0)
 ; Flags and Dates
"RTN","PXRMXD",14,0)
 N PXRMFD,PXRMLCMB,PXRMSDT,PXRMBDT,PXRMEDT,PXRMREP,PXRMPRIM,PXRMFUT
"RTN","PXRMXD",15,0)
 N PXRMRT,PXRMSSN,PXRMTABC,PXRMTABS,PXRMTMP,PXRMTYP,TITLE
"RTN","PXRMXD",16,0)
 N DUOUT,DTOUT
"RTN","PXRMXD",17,0)
 ;
"RTN","PXRMXD",18,0)
 S PXRMRT="PXRMX",PXRMTYP="X",PXRMFCMB="N",PXRMLCMB="N"
"RTN","PXRMXD",19,0)
 ;
"RTN","PXRMXD",20,0)
 I '$D(PXRMUSER) N PXRMUSER S PXRMUSER=0
"RTN","PXRMXD",21,0)
 ;
"RTN","PXRMXD",22,0)
 S PXRMXJB=$J
"RTN","PXRMXD",23,0)
 S PXRMXST=$$NOW^XLFDT
"RTN","PXRMXD",24,0)
 S PXRMXTMP=PXRMRT_PXRMXJB_PXRMXST
"RTN","PXRMXD",25,0)
 S ^XTMP(PXRMXTMP,0)=$$FMADD^XLFDT(DT,7)_U_DT_U_"PXRM Reminder Due Report"
"RTN","PXRMXD",26,0)
 ;
"RTN","PXRMXD",27,0)
 ;
"RTN","PXRMXD",28,0)
 ;Check for existing report templates
"RTN","PXRMXD",29,0)
REP D:PXRMUSER ^PXRMXTB D:'PXRMUSER ^PXRMXT I $D(DTOUT)!$D(DUOUT) G EXIT
"RTN","PXRMXD",30,0)
 ;Run report from template details
"RTN","PXRMXD",31,0)
 I PXRMTMP'="" D  G:$D(DUOUT)&'$D(DTOUT) REP Q
"RTN","PXRMXD",32,0)
 .D START^PXRMXTA("JOB^PXRMXD")
"RTN","PXRMXD",33,0)
 ;
"RTN","PXRMXD",34,0)
 ;Select sample criteria
"RTN","PXRMXD",35,0)
SEL D SELECT^PXRMXSD(.PXRMSEL) I $D(DTOUT) G EXIT
"RTN","PXRMXD",36,0)
 I $D(DUOUT) G:PXRMTMP="" EXIT G REP
"RTN","PXRMXD",37,0)
 ;
"RTN","PXRMXD",38,0)
FAC ;Get the facility list.
"RTN","PXRMXD",39,0)
 I "IPO"'[PXRMSEL D  G:$D(DTOUT) EXIT G:$D(DUOUT) SEL
"RTN","PXRMXD",40,0)
 .D FACILITY^PXRMXSU(.PXRMFAC) Q:$D(DTOUT)!$D(DUOUT)
"RTN","PXRMXD",41,0)
 ;
"RTN","PXRMXD",42,0)
 ;Check if combined facility report is required
"RTN","PXRMXD",43,0)
COMB I "IPO"'[PXRMSEL,NFAC>1 D  G:$D(DTOUT) EXIT G:$D(DUOUT) FAC
"RTN","PXRMXD",44,0)
 .D COMB^PXRMXSD(.PXRMFCMB,"Facilities","N")
"RTN","PXRMXD",45,0)
 ;
"RTN","PXRMXD",46,0)
OPT ;Variable prompts
"RTN","PXRMXD",47,0)
 ;
"RTN","PXRMXD",48,0)
 ;Get Patient list
"RTN","PXRMXD",49,0)
 I PXRMSEL="I" K PXRMPAT D PAT^PXRMXSU(.PXRMPAT)
"RTN","PXRMXD",50,0)
 ;Get OE/RRteam list
"RTN","PXRMXD",51,0)
 I PXRMSEL="O" K PXRMOTM D OERR^PXRMXSU(.PXRMOTM)
"RTN","PXRMXD",52,0)
 ;Get PCMM team
"RTN","PXRMXD",53,0)
 I PXRMSEL="T" K PXRMPCM D PCMM^PXRMXSU(.PXRMPCM)
"RTN","PXRMXD",54,0)
 ;Get provider list
"RTN","PXRMXD",55,0)
 I PXRMSEL="P" K PXRMPRV D PROV^PXRMXSU(.PXRMPRV)
"RTN","PXRMXD",56,0)
 ;Get the location list.
"RTN","PXRMXD",57,0)
 I PXRMSEL="L" K PXRMCS,PXRMCSN,PXRMLOCN,PXRMLCHL,PXRMCGRP,PXRMCGRN D
"RTN","PXRMXD",58,0)
 .D LOC^PXRMXSU("Determine encounter counts for","HS")
"RTN","PXRMXD",59,0)
 I $D(DTOUT) G EXIT
"RTN","PXRMXD",60,0)
 I $D(DUOUT) G:"IPO"[PXRMSEL SEL G:NFAC>1 COMB G FAC
"RTN","PXRMXD",61,0)
 ;
"RTN","PXRMXD",62,0)
 ;Check if inpatient location report
"RTN","PXRMXD",63,0)
 S PXRMINP=$$INP
"RTN","PXRMXD",64,0)
 ;
"RTN","PXRMXD",65,0)
 ; Primary Provider or All (PCMM Provider only)
"RTN","PXRMXD",66,0)
PRIME I PXRMSEL="P" D  G:$D(DTOUT) EXIT G:$D(DUOUT) OPT
"RTN","PXRMXD",67,0)
 .D PRIME^PXRMXSD(.PXRMPRIM)
"RTN","PXRMXD",68,0)
 ;
"RTN","PXRMXD",69,0)
DR ; Get the date range.
"RTN","PXRMXD",70,0)
 S PXRMFD="P"
"RTN","PXRMXD",71,0)
 ; No prompt if individual patients selected
"RTN","PXRMXD",72,0)
 ; Single dates only if PCMM teams/providers and OE/RR teams selected
"RTN","PXRMXD",73,0)
 ; Choice of previous/future date range if location selected
"RTN","PXRMXD",74,0)
 ;
"RTN","PXRMXD",75,0)
 ; Prior encounters/future appointments (location only)
"RTN","PXRMXD",76,0)
PREV I PXRMSEL="L" D PREV^PXRMXSD(.PXRMFD) G:$D(DTOUT) EXIT G:$D(DUOUT) OPT
"RTN","PXRMXD",77,0)
 ; Date range input (location only)
"RTN","PXRMXD",78,0)
 I PXRMSEL="L" D  G:$D(DTOUT) EXIT G:$D(DUOUT) PREV
"RTN","PXRMXD",79,0)
 .I PXRMFD="P" D PDR^PXRMXDUT(.PXRMBDT,.PXRMEDT,"ENCOUNTER")
"RTN","PXRMXD",80,0)
 .I PXRMFD="F" D FDR^PXRMXDUT(.PXRMBDT,.PXRMEDT,"APPOINTMENT")
"RTN","PXRMXD",81,0)
 .I PXRMFD="A" D PDR^PXRMXDUT(.PXRMBDT,.PXRMEDT,"ADMISSION")
"RTN","PXRMXD",82,0)
 .I PXRMFD="C" S PXRMBDT=DT,PXRMEDT=DT
"RTN","PXRMXD",83,0)
 ; Due Effective Date
"RTN","PXRMXD",84,0)
DUE D SDR^PXRMXDUT(.PXRMSDT) G:$D(DTOUT) EXIT
"RTN","PXRMXD",85,0)
 I $D(DUOUT) G:PXRMSEL="L" PREV G OPT
"RTN","PXRMXD",86,0)
 ;
"RTN","PXRMXD",87,0)
SCAT ;Get the service categories.
"RTN","PXRMXD",88,0)
 I PXRMSEL="L",PXRMFD="P" D
"RTN","PXRMXD",89,0)
 .D SCAT^PXRMXSC
"RTN","PXRMXD",90,0)
 .I $D(DTOUT)!$D(DUOUT) Q
"RTN","PXRMXD",91,0)
 I $D(DTOUT) G EXIT
"RTN","PXRMXD",92,0)
 I $D(DUOUT) G DUE
"RTN","PXRMXD",93,0)
 ;
"RTN","PXRMXD",94,0)
TYP ;Determine type of report (detail/summary)
"RTN","PXRMXD",95,0)
 S PXRMREP="S"
"RTN","PXRMXD",96,0)
 D REP^PXRMXSD(.PXRMREP) I $D(DTOUT) G EXIT
"RTN","PXRMXD",97,0)
 I $D(DUOUT) G SCAT
"RTN","PXRMXD",98,0)
 ;
"RTN","PXRMXD",99,0)
 ;
"RTN","PXRMXD",100,0)
 ;Check if combined location report is required
"RTN","PXRMXD",101,0)
LCOMB S NLOC=0
"RTN","PXRMXD",102,0)
 I PXRMREP="D",PXRMSEL="L" D  G:$D(DTOUT) EXIT G:$D(DUOUT) TYP
"RTN","PXRMXD",103,0)
 .N DEFAULT,TEXT
"RTN","PXRMXD",104,0)
 .D NLOC
"RTN","PXRMXD",105,0)
 .I NLOC>1 D COMB^PXRMXSD(.PXRMLCMB,TEXT,DEFAULT)
"RTN","PXRMXD",106,0)
 ;
"RTN","PXRMXD",107,0)
FUT ;For detailed report give option to display future appointments
"RTN","PXRMXD",108,0)
 S PXRMFUT="N"
"RTN","PXRMXD",109,0)
 I PXRMREP="D",'PXRMINP D  G:$D(DTOUT) EXIT I $D(DUOUT) G:(PXRMSEL="L")&(NLOC>1) LCOMB G TYP
"RTN","PXRMXD",110,0)
 .D FUTURE^PXRMXSD(.PXRMFUT)
"RTN","PXRMXD",111,0)
 ;
"RTN","PXRMXD",112,0)
SRT ;For detailed report give option to sort by appointment date
"RTN","PXRMXD",113,0)
 S PXRMSRT="N"
"RTN","PXRMXD",114,0)
 I PXRMREP="D",(PXRMSEL'="I") D  G:$D(DTOUT) EXIT I $D(DUOUT) G:(PXRMSEL="L")&(PXRMINP)&(NLOC>1) LCOMB G:PXRMINP TYP G FUT
"RTN","PXRMXD",115,0)
 .;Option to sort by Bed for inpatients
"RTN","PXRMXD",116,0)
 .I PXRMSEL="L",PXRMINP D BED^PXRMXSD(.PXRMSRT) Q
"RTN","PXRMXD",117,0)
 .;Otherwise option to sort by appt. date
"RTN","PXRMXD",118,0)
 .D SRT^PXRMXSD(.PXRMSRT)
"RTN","PXRMXD",119,0)
 ;
"RTN","PXRMXD",120,0)
 ;Option to print full SSN
"RTN","PXRMXD",121,0)
SSN I PXRMREP="D" D  G:$D(DTOUT) EXIT I $D(DUOUT) G:PXRMSEL="I" FUT G SRT
"RTN","PXRMXD",122,0)
 .D SSN^PXRMXSD(.PXRMSSN)
"RTN","PXRMXD",123,0)
 ;
"RTN","PXRMXD",124,0)
 ;Option to print without totals, with totals or totals only
"RTN","PXRMXD",125,0)
TOT I PXRMREP="S" D  G:$D(DTOUT) EXIT I $D(DUOUT) G TYP
"RTN","PXRMXD",126,0)
 .;Default is normal report
"RTN","PXRMXD",127,0)
 .S PXRMTOT="I"
"RTN","PXRMXD",128,0)
 .;Only prompt if more than one location, team or provider is selected
"RTN","PXRMXD",129,0)
 .I PXRMSEL="P",NPRV<2 Q
"RTN","PXRMXD",130,0)
 .I "OT"[PXRMSEL,NOTM<2 Q
"RTN","PXRMXD",131,0)
 .;Ignore reports for all locations
"RTN","PXRMXD",132,0)
 .I PXRMSEL="L",PXRMLCMB="Y" Q
"RTN","PXRMXD",133,0)
 .I PXRMSEL="L" N DEFAULT,TEXT D NLOC Q:NLOC<2
"RTN","PXRMXD",134,0)
 .;Prompt for options
"RTN","PXRMXD",135,0)
 .N LIT1,LIT2,LIT3
"RTN","PXRMXD",136,0)
 .D LIT,TOTALS^PXRMXSD(.PXRMTOT,LIT1,LIT2,LIT3)
"RTN","PXRMXD",137,0)
 ;
"RTN","PXRMXD",138,0)
 ;Reminder Category/Individual Reminder Selection
"RTN","PXRMXD",139,0)
RCAT D RCAT^PXRMXSU(.PXRMRCAT,.PXRMREM) I $D(DTOUT) G EXIT
"RTN","PXRMXD",140,0)
 I $D(DUOUT) G:PXRMREP="D" SSN G TOT
"RTN","PXRMXD",141,0)
 ;
"RTN","PXRMXD",142,0)
 ;Create combined reminder list
"RTN","PXRMXD",143,0)
 D MERGE^PXRMXS1
"RTN","PXRMXD",144,0)
 ;
"RTN","PXRMXD",145,0)
SAV ;Option to create a new report template
"RTN","PXRMXD",146,0)
 I PXRMTMP="" D ^PXRMXTU G:$D(DTOUT) EXIT I $D(DUOUT) G RCAT
"RTN","PXRMXD",147,0)
 ;
"RTN","PXRMXD",148,0)
 ;Option to print delimiter separated output
"RTN","PXRMXD",149,0)
TABS D  G:$D(DTOUT) EXIT I $D(DUOUT) G SAV
"RTN","PXRMXD",150,0)
 .D TABS^PXRMXSD(.PXRMTABS)
"RTN","PXRMXD",151,0)
 ;
"RTN","PXRMXD",152,0)
 ;Select chracter
"RTN","PXRMXD",153,0)
TCHAR I PXRMTABS="Y" D  G:$D(DTOUT) EXIT G:$D(DUOUT) TABS
"RTN","PXRMXD",154,0)
 .D TABSEL^PXRMXSD(.PXRMTABC)
"RTN","PXRMXD",155,0)
 ;
"RTN","PXRMXD",156,0)
 ;Determine whether the report should be queued.
"RTN","PXRMXD",157,0)
JOB N POP,%ZIS S %ZIS="QM"
"RTN","PXRMXD",158,0)
 W !
"RTN","PXRMXD",159,0)
 D ^%ZIS
"RTN","PXRMXD",160,0)
 I POP G EXIT
"RTN","PXRMXD",161,0)
 S PXRMIOD=ION_";"_IOST_";"_IOM_";"_IOSL
"RTN","PXRMXD",162,0)
 S PXRMQUE=$G(IO("Q"))
"RTN","PXRMXD",163,0)
 ;
"RTN","PXRMXD",164,0)
 I PXRMQUE D  Q
"RTN","PXRMXD",165,0)
 . ;Queue the report.
"RTN","PXRMXD",166,0)
 . N DESC,IODEV,ROUTINE,ZTDTH
"RTN","PXRMXD",167,0)
 . S DESC="Reminder Due Report - sort"
"RTN","PXRMXD",168,0)
 . S IODEV=""
"RTN","PXRMXD",169,0)
 . S ROUTINE="^PXRMXSE"
"RTN","PXRMXD",170,0)
 . M ^TMP("PXRM-MESS",$J)=^TMP("XM-MESS",$J)
"RTN","PXRMXD",171,0)
 . S ^XTMP(PXRMXTMP,"SORTZTSK")=$$QUE^PXRMXQUE(DESC,IODEV,ROUTINE,"SAVE^PXRMXD")
"RTN","PXRMXD",172,0)
 . M ^TMP("XM-MESS",$J)=^TMP("PXRM-MESS",$J)
"RTN","PXRMXD",173,0)
 . K ^TMP("PXRM-MESS",$J)
"RTN","PXRMXD",174,0)
 .;
"RTN","PXRMXD",175,0)
 . S DESC="Reminder Due Report - print"
"RTN","PXRMXD",176,0)
 . S IODEV=PXRMIOD
"RTN","PXRMXD",177,0)
 . S ROUTINE="^PXRMXPR"
"RTN","PXRMXD",178,0)
 . S ZTDTH="@"
"RTN","PXRMXD",179,0)
 . S ^XTMP(PXRMXTMP,"PRZTSK")=$$QUE^PXRMXQUE(DESC,IODEV,ROUTINE,"SAVE^PXRMXD")
"RTN","PXRMXD",180,0)
 I 'PXRMQUE D ^PXRMXSE
"RTN","PXRMXD",181,0)
 Q
"RTN","PXRMXD",182,0)
 ;
"RTN","PXRMXD",183,0)
 ;Option PXRM REMINDERS DUE (USER)
"RTN","PXRMXD",184,0)
USER N PXRMUSER
"RTN","PXRMXD",185,0)
 S PXRMUSER=+$G(DUZ)
"RTN","PXRMXD",186,0)
 G START
"RTN","PXRMXD",187,0)
 ;
"RTN","PXRMXD",188,0)
 ;
"RTN","PXRMXD",189,0)
EXIT ;Clean things up.
"RTN","PXRMXD",190,0)
 D EXIT^PXRMXGUT
"RTN","PXRMXD",191,0)
 Q
"RTN","PXRMXD",192,0)
 ;
"RTN","PXRMXD",193,0)
 ;Check if inpatient report
"RTN","PXRMXD",194,0)
INP() ;Applies to location reports only
"RTN","PXRMXD",195,0)
 I PXRMSEL'="L" Q 0
"RTN","PXRMXD",196,0)
 ;For all inpatient locations default is automatic
"RTN","PXRMXD",197,0)
 I $P(PXRMLCSC,U)="HAI" Q 1
"RTN","PXRMXD",198,0)
 ;For selected locations check if all locations are wards
"RTN","PXRMXD",199,0)
 I $P(PXRMLCSC,U)="HS" Q $$INP^PXRMXAP(PXRMLCSC,.PXRMLOCN)
"RTN","PXRMXD",200,0)
 ;Otherwise
"RTN","PXRMXD",201,0)
 Q 0
"RTN","PXRMXD",202,0)
 ;
"RTN","PXRMXD",203,0)
 ;Prompt text
"RTN","PXRMXD",204,0)
LIT N LIT
"RTN","PXRMXD",205,0)
 S LIT=$S(PXRMSEL="P":"Provider","OT"[PXRMSEL:"Team",1:"Location")
"RTN","PXRMXD",206,0)
 I PXRMFCMB="N" D
"RTN","PXRMXD",207,0)
 .S LIT1="Individual "_LIT_"s only"
"RTN","PXRMXD",208,0)
 .S LIT2="Individual "_LIT_"s plus Totals by Facility"
"RTN","PXRMXD",209,0)
 .S LIT3="Totals by Facility only"
"RTN","PXRMXD",210,0)
 I PXRMFCMB="Y" D
"RTN","PXRMXD",211,0)
 .S LIT1="Individual "_LIT_"s only"
"RTN","PXRMXD",212,0)
 .S LIT2="Individual "_LIT_"s plus Overall Total"
"RTN","PXRMXD",213,0)
 .S LIT3="Overall Total only"
"RTN","PXRMXD",214,0)
 Q
"RTN","PXRMXD",215,0)
 ;
"RTN","PXRMXD",216,0)
 ;Check if multiple locations
"RTN","PXRMXD",217,0)
NLOC S DEFAULT="N",NLOC=1,TEXT="Locations"
"RTN","PXRMXD",218,0)
 I $P(PXRMLCSC,U)["HA" S DEFAULT="Y",NLOC=999
"RTN","PXRMXD",219,0)
 I $P(PXRMLCSC,U)="CA" S DEFAULT="Y",NCS=999
"RTN","PXRMXD",220,0)
 I $E(PXRMLCSC)="C" S TEXT="Clinic Stops",NLOC=NCS
"RTN","PXRMXD",221,0)
 I $E(PXRMLCSC)="G" S TEXT="Clinic Groups",NLOC=NCGRP
"RTN","PXRMXD",222,0)
 I $P(PXRMLCSC,U)="HS" S NLOC=NHL S:$$INP TEXT="Inpatient Locations"
"RTN","PXRMXD",223,0)
 ;Special coding if more than one facility and location
"RTN","PXRMXD",224,0)
 I $P(PXRMLCSC,U)="HS",NFAC>1,NLOC>1 D
"RTN","PXRMXD",225,0)
 .N FAC,HLOCIEN,HLNAME,IC,MULT
"RTN","PXRMXD",226,0)
 .S IC=0 S:PXRMFCMB="Y" FAC="COMBINED"
"RTN","PXRMXD",227,0)
 .;Build list of locations by facility
"RTN","PXRMXD",228,0)
 .F  S IC=$O(PXRMLCHL(IC)) Q:'IC  D
"RTN","PXRMXD",229,0)
 ..S HLOCIEN=$P(PXRMLCHL(IC),U,2),FAC=$$FACL^PXRMXAP(HLOCIEN) Q:'FAC
"RTN","PXRMXD",230,0)
 ..S HLNAME=$P(PXRMLCHL(IC),U) Q:HLNAME=""
"RTN","PXRMXD",231,0)
 ..S MULT(FAC,HLNAME)=""
"RTN","PXRMXD",232,0)
 .S MULT=0,FAC=0
"RTN","PXRMXD",233,0)
 .;Count locations in each facility
"RTN","PXRMXD",234,0)
 .F  S FAC=$O(MULT(FAC)) Q:'FAC  D  Q:MULT
"RTN","PXRMXD",235,0)
 ..S IC=0,HLNAME=""
"RTN","PXRMXD",236,0)
 ..F  S HLNAME=$O(MULT(FAC,HLNAME)) Q:HLNAME=""  S IC=IC+1
"RTN","PXRMXD",237,0)
 ..I IC>1 S MULT=1
"RTN","PXRMXD",238,0)
 .;If only one location per facility suppress combined location option
"RTN","PXRMXD",239,0)
 .I 'MULT S NLOC=1
"RTN","PXRMXD",240,0)
 Q
"RTN","PXRMXD",241,0)
 ;
"RTN","PXRMXD",242,0)
SAVE ;Save the variables for queing.
"RTN","PXRMXD",243,0)
 S ZTSAVE("PXRMBDT")="",ZTSAVE("PXRMEDT")="",ZTSAVE("PXRMSDT")=""
"RTN","PXRMXD",244,0)
 S ZTSAVE("PXRMCS(")="",ZTSAVE("NCS")=""
"RTN","PXRMXD",245,0)
 S ZTSAVE("PXRMCGRP(")="",ZTSAVE("NCGRP")=""
"RTN","PXRMXD",246,0)
 S ZTSAVE("PXRMFAC(")="",ZTSAVE("NFAC")=""
"RTN","PXRMXD",247,0)
 S ZTSAVE("PXRMFACN(")=""
"RTN","PXRMXD",248,0)
 S ZTSAVE("PXRMFCMB")=""
"RTN","PXRMXD",249,0)
 S ZTSAVE("PXRMFUT")=""
"RTN","PXRMXD",250,0)
 S ZTSAVE("PXRMFD")=""
"RTN","PXRMXD",251,0)
 S ZTSAVE("PXRMINP")=""
"RTN","PXRMXD",252,0)
 S ZTSAVE("PXRMIOD")=""
"RTN","PXRMXD",253,0)
 S ZTSAVE("PXRMLCHL(")="",ZTSAVE("NHL")=""
"RTN","PXRMXD",254,0)
 S ZTSAVE("PXRMLCMB")=""
"RTN","PXRMXD",255,0)
 S ZTSAVE("PXRMLCSC")=""
"RTN","PXRMXD",256,0)
 S ZTSAVE("PXRMPRIM")=""
"RTN","PXRMXD",257,0)
 S ZTSAVE("PXRMQUE")=""
"RTN","PXRMXD",258,0)
 S ZTSAVE("PXRMREP")=""
"RTN","PXRMXD",259,0)
 S ZTSAVE("PXRMRT")=""
"RTN","PXRMXD",260,0)
 S ZTSAVE("PXRMSCAT")=""
"RTN","PXRMXD",261,0)
 S ZTSAVE("PXRMSEL")=""
"RTN","PXRMXD",262,0)
 S ZTSAVE("PXRMSRT")=""
"RTN","PXRMXD",263,0)
 S ZTSAVE("PXRMSSN")=""
"RTN","PXRMXD",264,0)
 S ZTSAVE("PXRMTABC")=""
"RTN","PXRMXD",265,0)
 S ZTSAVE("PXRMTABS")=""
"RTN","PXRMXD",266,0)
 S ZTSAVE("PXRMTMP")=""
"RTN","PXRMXD",267,0)
 S ZTSAVE("PXRMTOT")=""
"RTN","PXRMXD",268,0)
 S ZTSAVE("PXRMXTMP")=""
"RTN","PXRMXD",269,0)
 ; Time initiated
"RTN","PXRMXD",270,0)
 S ZTSAVE("PXRMXST")=""
"RTN","PXRMXD",271,0)
 ; New selection criteria
"RTN","PXRMXD",272,0)
 S ZTSAVE("PXRMOTM(")="",ZTSAVE("NOTM")=""
"RTN","PXRMXD",273,0)
 S ZTSAVE("PXRMPRV(")="",ZTSAVE("NPRV")=""
"RTN","PXRMXD",274,0)
 S ZTSAVE("PXRMPAT(")="",ZTSAVE("NPAT")=""
"RTN","PXRMXD",275,0)
 S ZTSAVE("PXRMPCM(")="",ZTSAVE("NPCM")=""
"RTN","PXRMXD",276,0)
 S ZTSAVE("PXRMREM(")="",ZTSAVE("NREM")=""
"RTN","PXRMXD",277,0)
 S ZTSAVE("PXRMRCAT(")="",ZTSAVE("NCAT")=""
"RTN","PXRMXD",278,0)
 S ZTSAVE("PXRMUSER")=""
"RTN","PXRMXD",279,0)
 ;Reminder list
"RTN","PXRMXD",280,0)
 S ZTSAVE("REMINDER(")=""
"RTN","PXRMXD",281,0)
 ; Arrays by IEN
"RTN","PXRMXD",282,0)
 S ZTSAVE("PXRMLOCN(")=""
"RTN","PXRMXD",283,0)
 S ZTSAVE("PXRMCSN(")=""
"RTN","PXRMXD",284,0)
 S ZTSAVE("PXRMCGRN(")=""
"RTN","PXRMXD",285,0)
 Q
"RTN","PXRMXGPR")
0^2^B82373071
"RTN","PXRMXGPR",1,0)
PXRMXGPR ; SLC/PJH - Reminder Due print calls ;07/31/2002
"RTN","PXRMXGPR",2,0)
 ;;1.5;CLINICAL REMINDERS;**6,11**;Jun 19, 2000
"RTN","PXRMXGPR",3,0)
 ;
"RTN","PXRMXGPR",4,0)
 ;Called from PXRMXPR
"RTN","PXRMXGPR",5,0)
 ;
"RTN","PXRMXGPR",6,0)
 ;Print Selection criteria
"RTN","PXRMXGPR",7,0)
HEAD(PSTART) ;
"RTN","PXRMXGPR",8,0)
 I SUB="TOTAL" N NAM S NAM="TOTAL REPORT"
"RTN","PXRMXGPR",9,0)
 I PXRMTABS="Y" D  Q
"RTN","PXRMXGPR",10,0)
 .N FFAC,FNAM
"RTN","PXRMXGPR",11,0)
 .S FNAM=NAM
"RTN","PXRMXGPR",12,0)
 .I "CES"[PXRMTABC S FNAM=$TR(FNAM,SEP,"_")
"RTN","PXRMXGPR",13,0)
 .I PXRMFCMB="N","LT"[PXRMSEL D  Q
"RTN","PXRMXGPR",14,0)
 ..S FFAC=$TR(FACPNAME,SEP,"_")
"RTN","PXRMXGPR",15,0)
 ..W !,"0"_SEP_FFAC_"_"_FNAM_SEP_SEP
"RTN","PXRMXGPR",16,0)
 .I PXRMFCMB="N","LT"'[PXRMSEL W !,"0"_SEP_FNAM_SEP_SEP Q
"RTN","PXRMXGPR",17,0)
 .I PXRMFCMB="Y" W !,"0"_SEP_"COMBINED_REPORT_"_FNAM_SEP_SEP Q
"RTN","PXRMXGPR",18,0)
 I "LT"[PXRMSEL D
"RTN","PXRMXGPR",19,0)
 .I PXRMFCMB="N" W !,?PSTART,"Facility: ",FACPNAME Q
"RTN","PXRMXGPR",20,0)
 .W !,?PSTART,"Combined Report: "
"RTN","PXRMXGPR",21,0)
 .N FACN,LENGTH,TEXT
"RTN","PXRMXGPR",22,0)
 .S FACN=0,LENGTH=17+PSTART
"RTN","PXRMXGPR",23,0)
 .F  S FACN=$O(PXRMFACN(FACN)) Q:'FACN  D
"RTN","PXRMXGPR",24,0)
 ..S TEXT=$P(PXRMFACN(FACN),U)_" ("_FACN_")"
"RTN","PXRMXGPR",25,0)
 ..I $O(PXRMFACN(FACN)) S TEXT=TEXT_", "
"RTN","PXRMXGPR",26,0)
 ..I (LENGTH+$L(TEXT))>80 S LENGTH=17+PSTART W !,?(17+PSTART)
"RTN","PXRMXGPR",27,0)
 ..W TEXT S LENGTH=LENGTH+$L(TEXT)
"RTN","PXRMXGPR",28,0)
 I "PTO"[PXRMSEL D
"RTN","PXRMXGPR",29,0)
 .I SUB="TOTAL" W !,?PSTART,NAM Q
"RTN","PXRMXGPR",30,0)
 .W !,?PSTART,"Reminders "_PXRMTX_" for ",NAM
"RTN","PXRMXGPR",31,0)
 I PXRMSEL="L" W !,?PSTART,"Reminders "_PXRMTX_" "_SD_" - ",NAM
"RTN","PXRMXGPR",32,0)
 I PXRMSEL="L" D
"RTN","PXRMXGPR",33,0)
 .I "PF"[PXRMFD W " for ",BD," to ",ED
"RTN","PXRMXGPR",34,0)
 .I PXRMFD="A" W " admissions from ",BD," to ",ED
"RTN","PXRMXGPR",35,0)
 .I PXRMFD="C" W " for current inpatients"
"RTN","PXRMXGPR",36,0)
 I PXRMSEL'="L" W " for ",SD
"RTN","PXRMXGPR",37,0)
 W:PXRMSEL="I" !
"RTN","PXRMXGPR",38,0)
 ;
"RTN","PXRMXGPR",39,0)
 Q
"RTN","PXRMXGPR",40,0)
 ;
"RTN","PXRMXGPR",41,0)
 ;Set up literals for display
"RTN","PXRMXGPR",42,0)
LITS I PXRMSEL="I" S PXRMFLD="Individual Patients"
"RTN","PXRMXGPR",43,0)
 I PXRMSEL="P" S PXRMFLD="PCMM Provider"
"RTN","PXRMXGPR",44,0)
 I PXRMSEL="O" S PXRMFLD="OE/RR Team"
"RTN","PXRMXGPR",45,0)
 I PXRMSEL="T" S PXRMFLD="PCMM Team"
"RTN","PXRMXGPR",46,0)
 I PXRMSEL="L" D
"RTN","PXRMXGPR",47,0)
 .S PXRMFLD="Location"
"RTN","PXRMXGPR",48,0)
 .I $P(PXRMLCSC,U)="HS" S DES="Selected Hospital Locations"
"RTN","PXRMXGPR",49,0)
 .I $P(PXRMLCSC,U)="HA" S DES="All Outpatient Locations"
"RTN","PXRMXGPR",50,0)
 .I $P(PXRMLCSC,U)="HAI" S DES="All Inpatient Locations"
"RTN","PXRMXGPR",51,0)
 .I $P(PXRMLCSC,U)="CS" S DES="Selected Clinic Stops"
"RTN","PXRMXGPR",52,0)
 .I $P(PXRMLCSC,U)="CA" S DES="All Clinic Stops"
"RTN","PXRMXGPR",53,0)
 .I $P(PXRMLCSC,U)="GS" S DES="Selected Clinic Groups"
"RTN","PXRMXGPR",54,0)
 .I PXRMFD="P" S DES=DES_" (Prior Encounters)"
"RTN","PXRMXGPR",55,0)
 .I PXRMFD="F" S DES=DES_" (Future Appoints.)"
"RTN","PXRMXGPR",56,0)
 .I PXRMFD="A" S DES=DES_" (Admissions)"
"RTN","PXRMXGPR",57,0)
 .I PXRMFD="C" S DES=DES_" (Current Inpatients)"
"RTN","PXRMXGPR",58,0)
 I PXRMSEL="P" D
"RTN","PXRMXGPR",59,0)
 .I PXRMPRIM="A" S CDES="All patients on list"
"RTN","PXRMXGPR",60,0)
 .I PXRMPRIM="P" S CDES="Primary care assigned patients only"
"RTN","PXRMXGPR",61,0)
 Q
"RTN","PXRMXGPR",62,0)
 ;
"RTN","PXRMXGPR",63,0)
 ;Output the provider report criteria
"RTN","PXRMXGPR",64,0)
CRIT(PSTART) ;
"RTN","PXRMXGPR",65,0)
 N RCCNT,RCDES,RICNT,RIDES,UNDL
"RTN","PXRMXGPR",66,0)
 S UNDL=$TR($J("",79)," ","_") D LITS
"RTN","PXRMXGPR",67,0)
 W !?(PSTART-8),"Report Criteria:"
"RTN","PXRMXGPR",68,0)
 I PXRMTMP'="" W !?PSTART,"Report Title:",?32,$P(PXRMTMP,U,3)
"RTN","PXRMXGPR",69,0)
 W !?PSTART,"Patient Sample:",?32,PXRMFLD
"RTN","PXRMXGPR",70,0)
 I PXRMSEL'="L" W !,?PSTART,PXRMFLD,":" D DISP
"RTN","PXRMXGPR",71,0)
 I PXRMSEL="L" D
"RTN","PXRMXGPR",72,0)
 .W !?PSTART,PXRMFLD,":",?32,DES
"RTN","PXRMXGPR",73,0)
 .I $E(PXRMLCSC,2)'="A" W ! D DISP
"RTN","PXRMXGPR",74,0)
 I $D(PXRMRCAT) D
"RTN","PXRMXGPR",75,0)
 .S RCCNT=0
"RTN","PXRMXGPR",76,0)
 .F  S RCCNT=$O(PXRMRCAT(RCCNT)) Q:'RCCNT  D
"RTN","PXRMXGPR",77,0)
 ..S RCDES=$P(PXRMRCAT(RCCNT),U,2) D CHECK(6)
"RTN","PXRMXGPR",78,0)
 ..I RCCNT=1 W !?PSTART,"Reminder Category:",?32,RCDES
"RTN","PXRMXGPR",79,0)
 ..I RCCNT>1 W !?32,RCDES
"RTN","PXRMXGPR",80,0)
 .S RICNT=0
"RTN","PXRMXGPR",81,0)
 .F  S RICNT=$O(PXRMREM(RICNT)) Q:'RICNT  D
"RTN","PXRMXGPR",82,0)
 ..S RIDES=$P(PXRMREM(RICNT),U,2) D CHECK(6)
"RTN","PXRMXGPR",83,0)
 ..I RICNT=1 W !?PSTART,"Individual Reminder:",?32,RIDES
"RTN","PXRMXGPR",84,0)
 ..I RICNT>1 W !?32,RIDES
"RTN","PXRMXGPR",85,0)
 D CHECK(6)
"RTN","PXRMXGPR",86,0)
 I PXRMREP="D" D
"RTN","PXRMXGPR",87,0)
 .W !,?PSTART,"Reminder:",?32,RDES
"RTN","PXRMXGPR",88,0)
 .;Display future appointments for Reminder Due report only
"RTN","PXRMXGPR",89,0)
 .I PXRMRT="PXRMX" W !,?PSTART,"Appointments:" D
"RTN","PXRMXGPR",90,0)
 ..I PXRMFUT="Y" W ?32,"All Future Appointments"
"RTN","PXRMXGPR",91,0)
 ..I PXRMFUT="N" W ?32,"Next Appointment only"
"RTN","PXRMXGPR",92,0)
 I PXRMSEL="P" W !,?PSTART,"All/Primary:",?32,CDES
"RTN","PXRMXGPR",93,0)
 I PXRMSEL="L" D
"RTN","PXRMXGPR",94,0)
 .W !?PSTART,"Date Range:",?32
"RTN","PXRMXGPR",95,0)
 .I "PAF"[PXRMFD W BD," to ",ED Q
"RTN","PXRMXGPR",96,0)
 .I PXRMFD="C" W "not applicable" Q
"RTN","PXRMXGPR",97,0)
 W !?PSTART,"Effective Due Date:",?32,SD
"RTN","PXRMXGPR",98,0)
 W !?PSTART,"Date run:",?32,RD
"RTN","PXRMXGPR",99,0)
 I PXRMTMP'="" D 
"RTN","PXRMXGPR",100,0)
 .W !?PSTART,"Template Name:",?32,$P(PXRMTMP,U,2)
"RTN","PXRMXGPR",101,0)
 .I PXRMUSER D CHECK(3) W !?PSTART,"Requested by:",?32,$P(^VA(200,DUZ,0),U)
"RTN","PXRMXGPR",102,0)
 I (PXRMFCMB="Y")!(PXRMLCMB="Y") D
"RTN","PXRMXGPR",103,0)
 .N LIT
"RTN","PXRMXGPR",104,0)
 .S LIT=$S(PXRMSEL="P":"Providers","OT"[PXRMSEL:"Teams",1:"Locations")
"RTN","PXRMXGPR",105,0)
 .W !?PSTART,"Combined report:",?32
"RTN","PXRMXGPR",106,0)
 .I PXRMFCMB="Y",PXRMLCMB="Y" W "Combined Facility and Combined "_LIT
"RTN","PXRMXGPR",107,0)
 .I PXRMFCMB="Y",PXRMLCMB="N" W "Combined Facility by Individual "_LIT
"RTN","PXRMXGPR",108,0)
 .I PXRMLCMB="Y",PXRMFCMB="N" W "By Facility with Combined "_LIT
"RTN","PXRMXGPR",109,0)
 .D CHECK(3)
"RTN","PXRMXGPR",110,0)
 I PXRMREP="S","IRT"[PXRMTOT D
"RTN","PXRMXGPR",111,0)
 .N LIT1,LIT2,LIT3
"RTN","PXRMXGPR",112,0)
 .D LIT^PXRMXD
"RTN","PXRMXGPR",113,0)
 .W !?PSTART,"Summary report:",?32
"RTN","PXRMXGPR",114,0)
 .I PXRMTOT="I" W LIT1
"RTN","PXRMXGPR",115,0)
 .I PXRMTOT="R" W LIT2
"RTN","PXRMXGPR",116,0)
 .I PXRMTOT="T" W LIT3
"RTN","PXRMXGPR",117,0)
 .D CHECK(3)
"RTN","PXRMXGPR",118,0)
 I $D(PXRMSCAT),PXRMFD="P" D OSCAT(PXRMSCAT,PSTART)
"RTN","PXRMXGPR",119,0)
 W !,UNDL,!
"RTN","PXRMXGPR",120,0)
 Q
"RTN","PXRMXGPR",121,0)
 ;
"RTN","PXRMXGPR",122,0)
 ;Display selected teams/providers
"RTN","PXRMXGPR",123,0)
DISP N IC
"RTN","PXRMXGPR",124,0)
 S IC=""
"RTN","PXRMXGPR",125,0)
 I PXRMSEL="P" F  S IC=$O(PXRMPRV(IC)) Q:IC=""  D
"RTN","PXRMXGPR",126,0)
 .W:IC>1 ! W ?32,$P(PXRMPRV(IC),U,2)
"RTN","PXRMXGPR",127,0)
 .D CHECK(3)
"RTN","PXRMXGPR",128,0)
 I PXRMSEL="T" F  S IC=$O(PXRMPCM(IC)) Q:IC=""  D
"RTN","PXRMXGPR",129,0)
 .W:IC>1 ! W ?32,$P(PXRMPCM(IC),U,2)
"RTN","PXRMXGPR",130,0)
 .D CHECK(3)
"RTN","PXRMXGPR",131,0)
 I PXRMSEL="O" F  S IC=$O(PXRMOTM(IC)) Q:IC=""  D
"RTN","PXRMXGPR",132,0)
 .W:IC>1 ! W ?32,$P(PXRMOTM(IC),U,3)
"RTN","PXRMXGPR",133,0)
 .D CHECK(3)
"RTN","PXRMXGPR",134,0)
 I PXRMSEL="I" F  S IC=$O(PXRMPAT(IC)) Q:IC=""  D
"RTN","PXRMXGPR",135,0)
 .W:IC>1 ! W ?32,$P(PXRMPAT(IC),U,2)
"RTN","PXRMXGPR",136,0)
 .D CHECK(3)
"RTN","PXRMXGPR",137,0)
 I PXRMSEL="L" D
"RTN","PXRMXGPR",138,0)
 .I $E(PXRMLCSC)="H" F  S IC=$O(PXRMLCHL(IC)) Q:IC=""  D
"RTN","PXRMXGPR",139,0)
 ..W:IC>1 ! W ?32,$P(PXRMLCHL(IC),U)
"RTN","PXRMXGPR",140,0)
 ..D CHECK(3)
"RTN","PXRMXGPR",141,0)
 .I $E(PXRMLCSC)="C" F  S IC=$O(PXRMCS(IC)) Q:IC=""  D
"RTN","PXRMXGPR",142,0)
 ..W:IC>1 ! W ?32,$P(PXRMCS(IC),U)," ",$P(PXRMCS(IC),U,3)
"RTN","PXRMXGPR",143,0)
 ..D CHECK(3)
"RTN","PXRMXGPR",144,0)
 .I $E(PXRMLCSC)="G" F  S IC=$O(PXRMCGRP(IC)) Q:IC=""  D
"RTN","PXRMXGPR",145,0)
 ..W:IC>1 ! W ?32,$P(PXRMCGRP(IC),U)," ",$P(PXRMCGRP(IC),U,2)
"RTN","PXRMXGPR",146,0)
 ..D CHECK(3)
"RTN","PXRMXGPR",147,0)
 Q
"RTN","PXRMXGPR",148,0)
 ;
"RTN","PXRMXGPR",149,0)
 ;Build array of locations/providers/teams with no patients
"RTN","PXRMXGPR",150,0)
NOPATS N IC
"RTN","PXRMXGPR",151,0)
 S IC=""
"RTN","PXRMXGPR",152,0)
 I PXRMSEL="P" F  S IC=$O(PXRMPRV(IC)) Q:IC=""  D TEST(.PXRMPRV)
"RTN","PXRMXGPR",153,0)
 I PXRMSEL="T" F  S IC=$O(PXRMPCM(IC)) Q:IC=""  D TEST(.PXRMPCM)
"RTN","PXRMXGPR",154,0)
 I PXRMSEL="O" F  S IC=$O(PXRMOTM(IC)) Q:IC=""  D TEST(.PXRMOTM)
"RTN","PXRMXGPR",155,0)
 I PXRMSEL="L" D
"RTN","PXRMXGPR",156,0)
 .I $E(PXRMLCSC)="H" F  S IC=$O(PXRMLCHL(IC)) Q:IC=""  D TEST(.PXRMLCHL)
"RTN","PXRMXGPR",157,0)
 .I $E(PXRMLCSC)="C" F  S IC=$O(PXRMCS(IC)) Q:IC=""  D TEST(.PXRMCS)
"RTN","PXRMXGPR",158,0)
 .I $E(PXRMLCSC)="G" F  S IC=$O(PXRMCGRP(IC)) Q:IC=""  D TEST(.PXRMCGRP)
"RTN","PXRMXGPR",159,0)
 Q
"RTN","PXRMXGPR",160,0)
 ;
"RTN","PXRMXGPR",161,0)
 ;Output the service categories
"RTN","PXRMXGPR",162,0)
OSCAT(SCL,PSTART) ;
"RTN","PXRMXGPR",163,0)
 N IC,CSTART,EM,SC,SCTEXT
"RTN","PXRMXGPR",164,0)
 S CSTART=PSTART+3
"RTN","PXRMXGPR",165,0)
 W !,?PSTART,"Service categories:",?32,SCL
"RTN","PXRMXGPR",166,0)
 F IC=1:1:$L(SCL) D
"RTN","PXRMXGPR",167,0)
 .S SC=$E(SCL,IC,IC)
"RTN","PXRMXGPR",168,0)
 .S SCTEXT=$$EXTERNAL^DILFD(9000010,.07,"",SC,.EM)
"RTN","PXRMXGPR",169,0)
 .D CHECK(3)
"RTN","PXRMXGPR",170,0)
 .W !,?CSTART,SC," - ",SCTEXT
"RTN","PXRMXGPR",171,0)
 Q
"RTN","PXRMXGPR",172,0)
 ;
"RTN","PXRMXGPR",173,0)
 ;If necessary, write the header
"RTN","PXRMXGPR",174,0)
COL(NEWPAGE) ;
"RTN","PXRMXGPR",175,0)
 I NEWPAGE D  Q:DONE
"RTN","PXRMXGPR",176,0)
 .I PXRMTABS="N" D PAGE
"RTN","PXRMXGPR",177,0)
 .I PXRMTABS="Y" W !!
"RTN","PXRMXGPR",178,0)
 D CHECK(0) Q:DONE
"RTN","PXRMXGPR",179,0)
 D HEAD(0)
"RTN","PXRMXGPR",180,0)
 S HEAD=0
"RTN","PXRMXGPR",181,0)
 I PXRMTABS="Y" Q
"RTN","PXRMXGPR",182,0)
 I PXRMREP="D" D
"RTN","PXRMXGPR",183,0)
 .N PNAM
"RTN","PXRMXGPR",184,0)
 .S PNAM=$P(PXRMREM(1),U,4) I PNAM="" S PNAM=$P(PXRMREM(1),U,2)
"RTN","PXRMXGPR",185,0)
 .W !!,PNAM,":  ",COUNT
"RTN","PXRMXGPR",186,0)
 .W:COUNT>1 " patients have reminder "_PXRMTX
"RTN","PXRMXGPR",187,0)
 .W:COUNT=1 " patient has reminder "_PXRMTX
"RTN","PXRMXGPR",188,0)
 N IC F IC=0:1:2 W !,?PXRMT(IC),PXRMH(IC)
"RTN","PXRMXGPR",189,0)
 Q
"RTN","PXRMXGPR",190,0)
 ;
"RTN","PXRMXGPR",191,0)
 ;form feed to new page
"RTN","PXRMXGPR",192,0)
PAGE I ($E(IOST)="C")&(IO=IO(0))&(PAGE>0) D
"RTN","PXRMXGPR",193,0)
 .S DIR(0)="E"
"RTN","PXRMXGPR",194,0)
 .W !
"RTN","PXRMXGPR",195,0)
 .D ^DIR K DIR
"RTN","PXRMXGPR",196,0)
 I $D(DUOUT)!($D(DTOUT))!($D(DIROUT)) S DONE=1 Q
"RTN","PXRMXGPR",197,0)
 W:$D(IOF)&(PAGE>0) @IOF
"RTN","PXRMXGPR",198,0)
 S PAGE=PAGE+1,FIRST=0
"RTN","PXRMXGPR",199,0)
 I $E(IOST)="C",IO=IO(0) W @IOF
"RTN","PXRMXGPR",200,0)
 E  W !
"RTN","PXRMXGPR",201,0)
 N TEMP,TEXTLEN
"RTN","PXRMXGPR",202,0)
 S TEMP=$$NOW^XLFDT,TEMP=$$FMTE^XLFDT(TEMP,"P")
"RTN","PXRMXGPR",203,0)
 S TEMP=TEMP_"  Page "_PAGE
"RTN","PXRMXGPR",204,0)
 S TEXTLEN=$L(TEMP)
"RTN","PXRMXGPR",205,0)
 W ?(IOM-TEXTLEN),TEMP
"RTN","PXRMXGPR",206,0)
 S TEXTLEN=$L(PXRMOPT)
"RTN","PXRMXGPR",207,0)
 I TEXTLEN>0 D
"RTN","PXRMXGPR",208,0)
 .W !!
"RTN","PXRMXGPR",209,0)
 .W ?((IOM-TEXTLEN)/2),PXRMOPT
"RTN","PXRMXGPR",210,0)
 Q
"RTN","PXRMXGPR",211,0)
 ;
"RTN","PXRMXGPR",212,0)
 ;count of patients in sample
"RTN","PXRMXGPR",213,0)
TOTAL N LIT
"RTN","PXRMXGPR",214,0)
 I PXRMTABS="Y" D  Q
"RTN","PXRMXGPR",215,0)
 .I PXRMREP="D" W !,"0"_SEP_"PATIENTS"_SEP_TOTAL_SEP_"APPLICABLE"_SEP_APPL Q
"RTN","PXRMXGPR",216,0)
 .I PXRMREP="S" W !,"0"_SEP_"PATIENTS"_SEP_TOTAL_SEP_SEP_$TR(SUB,SEP,"_") Q
"RTN","PXRMXGPR",217,0)
 I (PXRMRT="PXRMX")!(PXRMREP="S") W !
"RTN","PXRMXGPR",218,0)
 S LIT=" patient."
"RTN","PXRMXGPR",219,0)
 I TOTAL>1 S LIT=" patients."
"RTN","PXRMXGPR",220,0)
 W !,"Report run on "_TOTAL_LIT
"RTN","PXRMXGPR",221,0)
 I PXRMREP="D" D
"RTN","PXRMXGPR",222,0)
 .S LIT=" patient."
"RTN","PXRMXGPR",223,0)
 .I APPL>1 S LIT=" patients."
"RTN","PXRMXGPR",224,0)
 .W !,"Applicable to "_APPL_LIT
"RTN","PXRMXGPR",225,0)
 Q
"RTN","PXRMXGPR",226,0)
 ;
"RTN","PXRMXGPR",227,0)
 ;Null report prints if no patients found
"RTN","PXRMXGPR",228,0)
NULL I PXRMSEL="L" D
"RTN","PXRMXGPR",229,0)
 .I PXRMFD="P" W !!,"No patient visits found"
"RTN","PXRMXGPR",230,0)
 .I PXRMFD="A" W !!,"No patient admissions found"
"RTN","PXRMXGPR",231,0)
 .I PXRMFD="C" W !!,"No current inpatient found"
"RTN","PXRMXGPR",232,0)
 .I PXRMFD="F" W !!,"No patient appointments found"
"RTN","PXRMXGPR",233,0)
 I PXRMSEL="P" W !!,"No patients found for provider(s) selected"
"RTN","PXRMXGPR",234,0)
 I "OT"[PXRMSEL W !!,"No patients found for team(s) selected"
"RTN","PXRMXGPR",235,0)
 Q
"RTN","PXRMXGPR",236,0)
 ;
"RTN","PXRMXGPR",237,0)
 ;Null report if no patients due/satisfied - detailed report only
"RTN","PXRMXGPR",238,0)
NONE D PAGE
"RTN","PXRMXGPR",239,0)
 D HEAD(0)
"RTN","PXRMXGPR",240,0)
 W !!,"No patients with reminders "_PXRMTX
"RTN","PXRMXGPR",241,0)
 Q
"RTN","PXRMXGPR",242,0)
 ;
"RTN","PXRMXGPR",243,0)
 ;Report missed locations if report is partially successful
"RTN","PXRMXGPR",244,0)
MATCH(PSTART) ;
"RTN","PXRMXGPR",245,0)
 ;Delimited report from template
"RTN","PXRMXGPR",246,0)
 I PXRMTABS="Y",PXRMTMP'="" D  Q
"RTN","PXRMXGPR",247,0)
 .W !!?PSTART,"The following had no patients selected",!
"RTN","PXRMXGPR",248,0)
 .N SUB
"RTN","PXRMXGPR",249,0)
 .S SUB=""
"RTN","PXRMXGPR",250,0)
 .F  S SUB=$O(MISSED(SUB)) Q:SUB=""  D
"RTN","PXRMXGPR",251,0)
 ..W !?PSTART+10,SUB
"RTN","PXRMXGPR",252,0)
 ;Other reports
"RTN","PXRMXGPR",253,0)
 N LIT,SUB
"RTN","PXRMXGPR",254,0)
 D CHECK(5) Q:DONE
"RTN","PXRMXGPR",255,0)
 S LIT=PXRMFLD
"RTN","PXRMXGPR",256,0)
 I PXRMSEL="L",$E(PXRMLCSC)="G" S LIT="Clinic Group"
"RTN","PXRMXGPR",257,0)
 W !!?PSTART,"The following ",LIT,"(s) had no patients selected",!
"RTN","PXRMXGPR",258,0)
 S SUB=""
"RTN","PXRMXGPR",259,0)
 F  S SUB=$O(MISSED(SUB)) Q:SUB=""  D
"RTN","PXRMXGPR",260,0)
 .D CHECK(3) Q:DONE
"RTN","PXRMXGPR",261,0)
 .W !?PSTART+10,SUB
"RTN","PXRMXGPR",262,0)
 Q
"RTN","PXRMXGPR",263,0)
 ;
"RTN","PXRMXGPR",264,0)
 ;Check for match on location
"RTN","PXRMXGPR",265,0)
TEST(ARRAY) ;
"RTN","PXRMXGPR",266,0)
 N SUB
"RTN","PXRMXGPR",267,0)
 I $D(^XTMP(PXRMXTMP,"MARKED AS FOUND",IC)) Q
"RTN","PXRMXGPR",268,0)
 S MATCH=1
"RTN","PXRMXGPR",269,0)
 I PXRMSEL'="L" S SUB=$P(ARRAY(IC),U,2)
"RTN","PXRMXGPR",270,0)
 I PXRMSEL="L" S SUB=$P(ARRAY(IC),U,1)
"RTN","PXRMXGPR",271,0)
 I PXRMSEL="L",$E(PXRMLCSC)="H" D
"RTN","PXRMXGPR",272,0)
 .N HLOCIEN,FACNAM,FACNUM
"RTN","PXRMXGPR",273,0)
 .S HLOCIEN=$P(ARRAY(IC),U,2) Q:'HLOCIEN
"RTN","PXRMXGPR",274,0)
 .S FACNUM=$$FACL^PXRMXAP(HLOCIEN) Q:'FACNUM
"RTN","PXRMXGPR",275,0)
 .S FACNAM=$P($G(PXRMFACN(FACNUM)),U)
"RTN","PXRMXGPR",276,0)
 .I FACNAM'="" S SUB=SUB_" ("_FACNAM_")"
"RTN","PXRMXGPR",277,0)
 I PXRMSEL="L",$E(PXRMLCSC)="C" S SUB=SUB_" "_$P(ARRAY(IC),U,3)
"RTN","PXRMXGPR",278,0)
 I PXRMSEL="L",$E(PXRMLCSC)="G" S SUB=SUB_" "_$P(ARRAY(IC),U,2)
"RTN","PXRMXGPR",279,0)
 S MISSED(SUB)=""
"RTN","PXRMXGPR",280,0)
 Q
"RTN","PXRMXGPR",281,0)
 ;
"RTN","PXRMXGPR",282,0)
 ;Check for page throw
"RTN","PXRMXGPR",283,0)
CHECK(CNT) ;
"RTN","PXRMXGPR",284,0)
 I PXRMTABS="N",$Y>(IOSL-BMARG-CNT) D PAGE
"RTN","PXRMXGPR",285,0)
 Q
"VER")
8.0^22.0
**END**
**END**
