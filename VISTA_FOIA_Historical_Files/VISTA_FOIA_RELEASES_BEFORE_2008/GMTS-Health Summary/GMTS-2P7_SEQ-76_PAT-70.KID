Released GMTS*2.7*70 SEQ #76
Extracted from mail message
**KIDS**:GMTS*2.7*70^

**INSTALL NAME**
GMTS*2.7*70
"BLD",17040,0)
GMTS*2.7*70^HEALTH SUMMARY^0^3061109^y
"BLD",17040,4,0)
^9.64PA^142.99^1
"BLD",17040,4,142.99,0)
142.99
"BLD",17040,4,142.99,222)
y^y^f^^^^n
"BLD",17040,4,"B",142.99,142.99)

"BLD",17040,6.3)
5
"BLD",17040,"KRN",0)
^9.67PA^8989.52^19
"BLD",17040,"KRN",.4,0)
.4
"BLD",17040,"KRN",.401,0)
.401
"BLD",17040,"KRN",.402,0)
.402
"BLD",17040,"KRN",.403,0)
.403
"BLD",17040,"KRN",.5,0)
.5
"BLD",17040,"KRN",.84,0)
.84
"BLD",17040,"KRN",3.6,0)
3.6
"BLD",17040,"KRN",3.8,0)
3.8
"BLD",17040,"KRN",9.2,0)
9.2
"BLD",17040,"KRN",9.8,0)
9.8
"BLD",17040,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",17040,"KRN",9.8,"NM",1,0)
GMTSPCD^^0^B10732011
"BLD",17040,"KRN",9.8,"NM",2,0)
GMTSPD^^0^B35402318
"BLD",17040,"KRN",9.8,"NM",3,0)
GMTSPL^^0^B49944430
"BLD",17040,"KRN",9.8,"NM",4,0)
GMTSDA^^0^B7380587
"BLD",17040,"KRN",9.8,"NM",5,0)
GMTSMAIL^^0^B2508866
"BLD",17040,"KRN",9.8,"NM","B","GMTSDA",4)

"BLD",17040,"KRN",9.8,"NM","B","GMTSMAIL",5)

"BLD",17040,"KRN",9.8,"NM","B","GMTSPCD",1)

"BLD",17040,"KRN",9.8,"NM","B","GMTSPD",2)

"BLD",17040,"KRN",9.8,"NM","B","GMTSPL",3)

"BLD",17040,"KRN",19,0)
19
"BLD",17040,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",17040,"KRN",19,"NM",1,0)
GMTS IRM/ADPAC PARAMETER EDIT^^0
"BLD",17040,"KRN",19,"NM","B","GMTS IRM/ADPAC PARAMETER EDIT",1)

"BLD",17040,"KRN",19.1,0)
19.1
"BLD",17040,"KRN",101,0)
101
"BLD",17040,"KRN",409.61,0)
409.61
"BLD",17040,"KRN",771,0)
771
"BLD",17040,"KRN",870,0)
870
"BLD",17040,"KRN",8989.51,0)
8989.51
"BLD",17040,"KRN",8989.52,0)
8989.52
"BLD",17040,"KRN",8994,0)
8994
"BLD",17040,"KRN","B",.4,.4)

"BLD",17040,"KRN","B",.401,.401)

"BLD",17040,"KRN","B",.402,.402)

"BLD",17040,"KRN","B",.403,.403)

"BLD",17040,"KRN","B",.5,.5)

"BLD",17040,"KRN","B",.84,.84)

"BLD",17040,"KRN","B",3.6,3.6)

"BLD",17040,"KRN","B",3.8,3.8)

"BLD",17040,"KRN","B",9.2,9.2)

"BLD",17040,"KRN","B",9.8,9.8)

"BLD",17040,"KRN","B",19,19)

"BLD",17040,"KRN","B",19.1,19.1)

"BLD",17040,"KRN","B",101,101)

"BLD",17040,"KRN","B",409.61,409.61)

"BLD",17040,"KRN","B",771,771)

"BLD",17040,"KRN","B",870,870)

"BLD",17040,"KRN","B",8989.51,8989.51)

"BLD",17040,"KRN","B",8989.52,8989.52)

"BLD",17040,"KRN","B",8994,8994)

"BLD",17040,"QUES",0)
^9.62^^
"BLD",17040,"REQB",0)
^9.611^2^1
"BLD",17040,"REQB",2,0)
GMTS*2.7*56^2
"BLD",17040,"REQB","B","GMTS*2.7*56",2)

"FIA",142.99)
HEALTH SUMMARY PARAMETERS
"FIA",142.99,0)
^GMT(142.99,
"FIA",142.99,0,0)
142.99
"FIA",142.99,0,1)
y^y^f^^^^n
"FIA",142.99,0,10)

"FIA",142.99,0,11)

"FIA",142.99,0,"RLRO")

"FIA",142.99,0,"VR")
2.7^GMTS
"FIA",142.99,142.99)
0
"KRN",19,5536,-1)
0^1
"KRN",19,5536,0)
GMTS IRM/ADPAC PARAMETER EDIT^Edit Health Summary Site Parameters^^E^^^^^^^^
"KRN",19,5536,1,0)
^^3^3^2950824^^
"KRN",19,5536,1,1,0)
This option allows IRM staff or Health  Summary ADPAC to edit the Health
"KRN",19,5536,1,2,0)
Summary Parameters, to modify the behavior of Health Summary for your
"KRN",19,5536,1,3,0)
site.
"KRN",19,5536,15)

"KRN",19,5536,20)

"KRN",19,5536,30)
GMT(142.99,
"KRN",19,5536,31)
AEMQL
"KRN",19,5536,32)
Select HEALTH SUMMARY PARAMETERS:
"KRN",19,5536,33)

"KRN",19,5536,50)
GMT(142.99,
"KRN",19,5536,51)
.02;S:X=0 Y=.03;.05T;.03;.04;.06
"KRN",19,5536,99)
55649,45175
"KRN",19,5536,"U")
EDIT HEALTH SUMMARY SITE PARAM
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",56,-1)
1^1
"PKG",56,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",56,22,0)
^9.49I^1^1
"PKG",56,22,1,0)
2.7^2951020^2960605
"PKG",56,22,1,"PAH",1,0)
70^3061109^222222243
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","GMTSDA")
0^4^B7380587^B6844814
"RTN","GMTSDA",1,0)
GMTSDA ; SLC/DLT,KER/NDBI - Appointments ; 02/27/2002 [4/14/04 1:53pm]
"RTN","GMTSDA",2,0)
 ;;2.7;Health Summary;**5,19,28,49,70**;Oct 20, 1995;Build 5
"RTN","GMTSDA",3,0)
 ;               
"RTN","GMTSDA",4,0)
 ; External Reference
"RTN","GMTSDA",5,0)
 ;   DBIA  1024  ^DIC(40.7
"RTN","GMTSDA",6,0)
 ;   DBIA 10040  ^SC(
"RTN","GMTSDA",7,0)
 ;   DBIA  2065  ^SCE(
"RTN","GMTSDA",8,0)
 ;   DBIA  2065  ^SCE("ADFN"
"RTN","GMTSDA",9,0)
 ;   DBIA  2929  CVP^A7RHSM
"RTN","GMTSDA",10,0)
 ;   DBIA 10061  SDA^VADPT
"RTN","GMTSDA",11,0)
 ;                   
"RTN","GMTSDA",12,0)
PAST ; Gets Patient's Past Appointments for date range
"RTN","GMTSDA",13,0)
 N GMDT,GMIDT,MAX S X=1
"RTN","GMTSDA",14,0)
 S VASD("F")=$S(GMTSBEG=1:2560101,1:GMTSBEG),VASD("T")=$S(GMTS1=6666666:DT,1:9999999-GMTS1)
"RTN","GMTSDA",15,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSDA",16,0)
 S VASD("W")=123456789 D SDA^VADPT
"RTN","GMTSDA",17,0)
 I VAERR=2 D CKP^GMTSUP W "DATABASE NOT AVAILABLE",! D END Q
"RTN","GMTSDA",18,0)
 S (YCNT,Y)=0 F  S Y=$O(^UTILITY("VASD",$J,Y)) Q:'Y  S YCNT=YCNT+1,ADATE=$P(^(Y,"I"),U,1),^UTILITY("GMTSVASD",$J,9999999-ADATE)=ADATE_U_$P(^UTILITY("VASD",$J,Y,"E"),U,2,99)
"RTN","GMTSDA",19,0)
 S GMDT=VASD("F")
"RTN","GMTSDA",20,0)
 F  S GMDT=$O(^SCE("ADFN",DFN,GMDT)) Q:GMDT'>0!(GMDT>VASD("T"))  D
"RTN","GMTSDA",21,0)
 . S GMI=0 F  S GMI=$O(^SCE("ADFN",DFN,GMDT,GMI)) Q:GMI'>0  D
"RTN","GMTSDA",22,0)
 . . S GMIDT=9999999-GMDT
"RTN","GMTSDA",23,0)
 . . I '$D(^UTILITY("GMTSVASD",$J,GMIDT)) D
"RTN","GMTSDA",24,0)
 . . . Q:$P($G(^SCE(GMI,0)),U,6)'=""
"RTN","GMTSDA",25,0)
 . . . I $P($G(^SCE(GMI,0)),U,4) Q:$P($G(^SC($P(^SCE(GMI,0),U,4),"OOS")),U)
"RTN","GMTSDA",26,0)
 . . . S ^UTILITY("GMTSVASD",$J,GMIDT)=GMDT_U_$S(+$P(^SCE(GMI,0),U,4):$P($G(^SC(+$P(^(0),U,4),0)),U),1:$P($G(^DIC(40.7,$P(^SCE(GMI,0),U,3),0)),U))_U_"UNSCHEDULED"
"RTN","GMTSDA",27,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) CVP^A7RHSM
"RTN","GMTSDA",28,0)
 I '$D(^UTILITY("GMTSVASD",$J)) D END Q
"RTN","GMTSDA",29,0)
 S IDATE="",YCNT=0
"RTN","GMTSDA",30,0)
 F  S IDATE=$O(^UTILITY("GMTSVASD",$J,IDATE)) Q:+IDATE'>0!(YCNT=MAX)  D
"RTN","GMTSDA",31,0)
 . S ADATE=+^(IDATE),ADATE(0)=^(IDATE) D PRINT S YCNT=YCNT+1
"RTN","GMTSDA",32,0)
 D END Q
"RTN","GMTSDA",33,0)
FUTURE ; Gets Patient's Future Appointments 
"RTN","GMTSDA",34,0)
 D SDA^VADPT N MAX S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSDA",35,0)
 I VAERR=2 D CKP^GMTSUP W "DATABASE NOT AVAILABLE",! D END Q
"RTN","GMTSDA",36,0)
 S (YCNT,Y)=0 F  S Y=$O(^UTILITY("VASD",$J,Y)) Q:'Y  S YCNT=YCNT+1,ADATE=$P(^(Y,"I"),U,1),ADATE(0)=^UTILITY("VASD",$J,Y,"E") D PRINT Q:YCNT=MAX
"RTN","GMTSDA",37,0)
 D END Q
"RTN","GMTSDA",38,0)
PRINT ; Output
"RTN","GMTSDA",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S X=ADATE D REGDTM4^GMTSU,CKP^GMTSUP
"RTN","GMTSDA",40,0)
 W X,?18,$E($P(ADATE(0),"^",2),1,25),?58,$E($P(ADATE(0),"^",3),1,21)
"RTN","GMTSDA",41,0)
 W ! Q
"RTN","GMTSDA",42,0)
END ; Clean-up and Quit
"RTN","GMTSDA",43,0)
 K %I,IDATE,IDATES,ADATE,VASD,X,Y,YCNT,Z,^UTILITY("VASD",$J),^UTILITY("GMTSVASD",$J) Q
"RTN","GMTSMAIL")
0^5^B2508866^n/a
"RTN","GMTSMAIL",1,0)
GMTSMAIL ; SLC/JMH - HS mailman items ;01/25/2005 [1/27/05 9:01am]
"RTN","GMTSMAIL",2,0)
 ;;2.7;Health Summary;**70**;Oct 20, 1995;Build 5
"RTN","GMTSMAIL",3,0)
 ;read on ^XMB(3.8 field .01 covered by DBIA 10111
"RTN","GMTSMAIL",4,0)
MAIL(MSG,OPTION) ;Call to notify on Scheduling Error return 
"RTN","GMTSMAIL",5,0)
 N XMSUB,XMDUZ,XMZ,XMY,XMTEXT
"RTN","GMTSMAIL",6,0)
 N GMTSMAIL,GMTSPARM
"RTN","GMTSMAIL",7,0)
 S GMTSPARM=$O(^GMT(142.99,"B","HOSPITAL",0))
"RTN","GMTSMAIL",8,0)
 S GMTSMAIL=$P($G(^GMT(142.99,$G(GMTSPARM),0)),U,6)
"RTN","GMTSMAIL",9,0)
 Q:GMTSMAIL=""
"RTN","GMTSMAIL",10,0)
 I $P(GMTSMAIL,";",2)="VA(200," S XMY(+GMTSMAIL)="" ;recipient
"RTN","GMTSMAIL",11,0)
 I $P(GMTSMAIL,";",2)="XMB(3.8," S XMY("G."_$$GET1^DIQ(3.8,+GMTSMAIL_",",.01))="" ;mail group
"RTN","GMTSMAIL",12,0)
 S XMSUB="Health Summary Report Aborted"
"RTN","GMTSMAIL",13,0)
 S XMDUZ="Health Summary Package"
"RTN","GMTSMAIL",14,0)
 D XMZ^XMA2 ;message stub
"RTN","GMTSMAIL",15,0)
 S XMTEXT="XMTEXT"
"RTN","GMTSMAIL",16,0)
 S XMTEXT(1)="The following task reported an error due to a problem when calling"
"RTN","GMTSMAIL",17,0)
 S XMTEXT(2)="    the Scheduling package:"
"RTN","GMTSMAIL",18,0)
 S XMTEXT(3)=""
"RTN","GMTSMAIL",19,0)
 S XMTEXT(4)="    "_OPTION
"RTN","GMTSMAIL",20,0)
 S XMTEXT(5)=""
"RTN","GMTSMAIL",21,0)
 S XMTEXT(6)="Here is the error that was reported by the Scheduling package:"
"RTN","GMTSMAIL",22,0)
 S XMTEXT(7)=""
"RTN","GMTSMAIL",23,0)
 S XMTEXT(8)="    "_MSG
"RTN","GMTSMAIL",24,0)
 S XMTEXT(9)=""
"RTN","GMTSMAIL",25,0)
 S XMTEXT(10)="The task may have been aborted."
"RTN","GMTSMAIL",26,0)
 D ENL^XMD
"RTN","GMTSMAIL",27,0)
 D ENT1^XMD
"RTN","GMTSMAIL",28,0)
 Q
"RTN","GMTSPCD")
0^1^B10732011^B7068645
"RTN","GMTSPCD",1,0)
GMTSPCD ; SLC/DLT,KER - Queue HS Batch Print Clinic by Date ; 08/27/2002 [1/26/05 11:22am]
"RTN","GMTSPCD",2,0)
 ;;2.7;Health Summary;**28,56,70**;Oct 20, 1995;Build 5
"RTN","GMTSPCD",3,0)
 ;
"RTN","GMTSPCD",4,0)
 ; External References
"RTN","GMTSPCD",5,0)
 ;   DBIA  10026  ^DIR
"RTN","GMTSPCD",6,0)
 ;   DBIA  10063  ^%ZTLOAD
"RTN","GMTSPCD",7,0)
 ;   DBIA  10040  ^SC("B")
"RTN","GMTSPCD",8,0)
 ;   DBIA  10040  ^SC(  file #44
"RTN","GMTSPCD",9,0)
 ;   DBIA  10006  ^DIC  (file #44 and 3.5)
"RTN","GMTSPCD",10,0)
 ;   DBIA  10000  NOW^%DTC
"RTN","GMTSPCD",11,0)
 ;                        
"RTN","GMTSPCD",12,0)
MAIN ; Controls branching
"RTN","GMTSPCD",13,0)
 W !!,"This option will queue Health Summaries for a specified Visit Date"
"RTN","GMTSPCD",14,0)
 W !,"for all Outpatient Clinics with Appointments on that Visit Date.",!!
"RTN","GMTSPCD",15,0)
 N GMTSCDT
"RTN","GMTSPCD",16,0)
 S GMTSCDT=$$SELDATE Q:GMTSCDT'>0
"RTN","GMTSPCD",17,0)
 W ! N DIR S DIR(0)="D^::%DT",DIR("A")="Date and Time to Queue this Job to run",DIR("B")="NOW" D ^DIR Q:($D(DTOUT)!($D(DUOUT))!($D(DIROUT)))
"RTN","GMTSPCD",18,0)
 S ZTDTH=Y,ZTIO="",ZTSAVE("GMTSCDT")=""
"RTN","GMTSPCD",19,0)
 S ZTRTN="CLINICQ^GMTSPCD",ZTDESC="Create Task HS Jobs for Clinics by Visit Date"
"RTN","GMTSPCD",20,0)
 D ^%ZTLOAD
"RTN","GMTSPCD",21,0)
 Q
"RTN","GMTSPCD",22,0)
CLINICQ ; Loop thru clinics for appointments
"RTN","GMTSPCD",23,0)
 ;   Date stored in GMTSCDT 
"RTN","GMTSPCD",24,0)
 N GMTSARR,GMTSCNT,GMTSLOC,GMTSCL,GMTSTYP,GMTSJ
"RTN","GMTSPCD",25,0)
 ;GET ALL APPOINTMENTS ON DATE GMTSCDT
"RTN","GMTSPCD",26,0)
 S GMTSARR(1)=GMTSCDT_";"_GMTSCDT,GMTSARR("FLDS")="1;2",GMTSCNT=$$SDAPI^SDAMA301(.GMTSARR)
"RTN","GMTSPCD",27,0)
 ;IF ERROR IN SDAPI CALL, SEND MESSAGE AND QUIT
"RTN","GMTSPCD",28,0)
 I GMTSCNT<0 D MAIL^GMTSMAIL("SCHEDULING DATABASE ERROR "_GMTSCNT,"HS Batch Print Clinic by Date") K ^TMP($J,"SDAMA301") Q
"RTN","GMTSPCD",29,0)
 ;LOOP THROUGH RETURN ARRAY AND SORT BY CLINIC NAME REMOVING ANY CLINIC THAT IS NOT OF TYPE "C"
"RTN","GMTSPCD",30,0)
 I GMTSCNT>0 D
"RTN","GMTSPCD",31,0)
 .N GMTSI S GMTSI=0 F  S GMTSI=$O(^TMP($J,"SDAMA301",GMTSI)) Q:'GMTSI  D
"RTN","GMTSPCD",32,0)
 ..Q:$P($G(^SC(GMTSI,0)),U,3)'="C"
"RTN","GMTSPCD",33,0)
 ..N NAME,DFN,TIME,TEMP,TYPE
"RTN","GMTSPCD",34,0)
 ..S DFN=$O(^TMP($J,"SDAMA301",GMTSI,0))
"RTN","GMTSPCD",35,0)
 ..S TIME=$O(^TMP($J,"SDAMA301",GMTSI,DFN,0))
"RTN","GMTSPCD",36,0)
 ..S TEMP=$P(^TMP($J,"SDAMA301",GMTSI,DFN,TIME),U,2)
"RTN","GMTSPCD",37,0)
 ..S NAME=$P(TEMP,";",2)
"RTN","GMTSPCD",38,0)
 ..S TYPE=0,TYPE=$O(^GMT(142,"D",GMTSI,TYPE))
"RTN","GMTSPCD",39,0)
 ..I +TYPE>0 S ^TMP($J,"GMTSCL",NAME,GMTSI,TYPE)=""
"RTN","GMTSPCD",40,0)
 ;LOOP THROUGH CLINICS ALPHABETICALLY AND CALL QUEUE WITH GMTSTYP AND GMTSCL SET
"RTN","GMTSPCD",41,0)
 S GMTSJ="" F  S GMTSJ=$O(^TMP($J,"GMTSCL",GMTSJ)) Q:'$L(GMTSJ)  S GMTSCL=$O(^TMP($J,"GMTSCL",GMTSJ,0)) Q:'GMTSCL  S GMTSTYP=$O(^TMP($J,"GMTSCL",GMTSJ,GMTSCL,0)) D QUEUE
"RTN","GMTSPCD",42,0)
 K ^TMP($J,"GMTSCL"),^TMP($J,"SDAMA301")
"RTN","GMTSPCD",43,0)
 Q
"RTN","GMTSPCD",44,0)
QUEUE ; Queues HS batch print for particular HS Type and Location.
"RTN","GMTSPCD",45,0)
 N DIC,GMPSAP,GMTSCLI,GMTSLOC,GMTSSC,GMTSIO,GMTSDYS,GMV,QUEQIT,X,Y
"RTN","GMTSPCD",46,0)
 S QUEQIT=0
"RTN","GMTSPCD",47,0)
 S GMTSCLI=$O(^GMT(142,GMTSTYP,20,"B",GMTSCL,0))
"RTN","GMTSPCD",48,0)
 S GMTSLOC=$G(^GMT(142,GMTSTYP,20,GMTSCLI,0))
"RTN","GMTSPCD",49,0)
 S X=+GMTSLOC,DIC=44,DIC(0)="NXZ" D ^DIC
"RTN","GMTSPCD",50,0)
 I $S(+Y'>0:1,"WCOR"'[$P($G(Y(0)),U,3):1,1:0) Q
"RTN","GMTSPCD",51,0)
 S GMTSSC(1)=Y_U_$P(Y(0),U,3),$P(GMTSSC(1),U,4)=GMTSCDT
"RTN","GMTSPCD",52,0)
 S GMPSAP=$S($P(GMTSLOC,U,3)="Y":1,1:0)
"RTN","GMTSPCD",53,0)
 S ZTIO=$$GETIO($P(GMTSLOC,U,2)) Q:'$L(ZTIO)
"RTN","GMTSPCD",54,0)
 S ZTDTH=$H,ZTRTN="MAIN^GMTSPL",ZTDESC="Clinic Health Summaries by Visit Date"
"RTN","GMTSPCD",55,0)
 F GMV="GMTSTYP","GMPSAP" S ZTSAVE(GMV)=""
"RTN","GMTSPCD",56,0)
 S ZTSAVE("GMTSSC(")=""
"RTN","GMTSPCD",57,0)
 D ^%ZTLOAD
"RTN","GMTSPCD",58,0)
 Q
"RTN","GMTSPCD",59,0)
GETIO(X) ; Get device for queueing
"RTN","GMTSPCD",60,0)
 N %,%Y,C,DIC,Y
"RTN","GMTSPCD",61,0)
 S DIC=3.5,DIC(0)="NXZ" D ^DIC S Y=$S(+Y'>0:"",1:$P(Y(0),U))
"RTN","GMTSPCD",62,0)
 Q Y
"RTN","GMTSPCD",63,0)
SELDATE() ; Allows entry of Visit/Surgery date or date range
"RTN","GMTSPCD",64,0)
 ; for Print-by-Clinic
"RTN","GMTSPCD",65,0)
 N %,%H,%I,DIR,DEFDT,X,Y
"RTN","GMTSPCD",66,0)
 D NOW^%DTC S (X,DT)=$P(%,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPCD",67,0)
 S DIR(0)="D^::EX",DIR("B")=DEFDT
"RTN","GMTSPCD",68,0)
 S DIR("A")="Please enter the Visit date"
"RTN","GMTSPCD",69,0)
 D ^DIR
"RTN","GMTSPCD",70,0)
 I Y="^^" S DIROUT=1
"RTN","GMTSPCD",71,0)
 Q Y
"RTN","GMTSPD")
0^2^B35402318^B28728574
"RTN","GMTSPD",1,0)
GMTSPD ; SLC/JER,KER - Interactive Print-by-Location ; 04/30/2002 [1/26/05 1:50pm]
"RTN","GMTSPD",2,0)
 ;;2.7;Health Summary;**28,30,47,49,55,70**;Oct 20, 1995;Build 5
"RTN","GMTSPD",3,0)
 ;
"RTN","GMTSPD",4,0)
 ; External
"RTN","GMTSPD",5,0)
 ;    DBIA 10040  ^SC(
"RTN","GMTSPD",6,0)
 ;    DBIA 10040  ^SC("B"
"RTN","GMTSPD",7,0)
 ;    DBIA   641  ^SRF("AOR"
"RTN","GMTSPD",8,0)
 ;    DBIA   185  ^SRS("B"
"RTN","GMTSPD",9,0)
 ;    DBIA 10039  ^DIC(42
"RTN","GMTSPD",10,0)
 ;    DBIA   510  ^DISV(
"RTN","GMTSPD",11,0)
 ;    DBIA 10035  ^DPT("CN"
"RTN","GMTSPD",12,0)
 ;    DBIA 10000  C^%DTC
"RTN","GMTSPD",13,0)
 ;    DBIA 10000  NOW^%DTC
"RTN","GMTSPD",14,0)
 ;    DBIA 10006  ^DIC (file #42 and #44)
"RTN","GMTSPD",15,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSPD",16,0)
 ;    DBIA 10076  ^XUSEC("GMTS VIEW ONLY"
"RTN","GMTSPD",17,0)
 ;    DBIA 10104  $$UP^XLFSTR
"RTN","GMTSPD",18,0)
 ;                           
"RTN","GMTSPD",19,0)
MAIN ; Interactive Print by Location
"RTN","GMTSPD",20,0)
 N GMPSAP,GMTSCDT,GMTSTYP,GMLOC,GMTSTN,GMTSSC
"RTN","GMTSPD",21,0)
 S GMTSTYP=0 K DIROUT
"RTN","GMTSPD",22,0)
 F  D  Q:+GMTSTYP'>0!$D(DIROUT)
"RTN","GMTSPD",23,0)
 . S GMTSTYP=+($$SELTYP) Q:+GMTSTYP'>0!$D(DIROUT)
"RTN","GMTSPD",24,0)
 . F  D  Q:+$G(GMTSSC)'>0!$D(DIROUT)!$D(DUOUT)!($D(GMTSSC("ALL")))
"RTN","GMTSPD",25,0)
 . . K GMTSSC,DUOUT D SELLOC(.GMTSSC) Q:+$G(GMTSSC)'>0!$D(DIROUT)!$D(DUOUT)
"RTN","GMTSPD",26,0)
 . . D CHKLOC(.GMTSSC) Q:$O(GMTSSC(0))'>0!$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",27,0)
 . . S GMPSAP=$$RXAP^GMTSPD2 Q:$D(DIROUT)!$D(DUOUT)!$D(DTOUT)
"RTN","GMTSPD",28,0)
 . . N DIROUT D HSOUT^GMTSPD2 W ! S DUOUT=1
"RTN","GMTSPD",29,0)
 Q
"RTN","GMTSPD",30,0)
SELTYP() ; Select Health Summary type
"RTN","GMTSPD",31,0)
 N DIC,X,Y
"RTN","GMTSPD",32,0)
 I $D(^DISV(DUZ,"^GMT(142,")),+$G(GMTSTYP)=0 S DIC("B")=$P($G(^GMT(142,+$G(^DISV(DUZ,"^GMT(142,")),0)),U)
"RTN","GMTSPD",33,0)
 S DIC=142,DIC("A")="Select Health Summary Type: "
"RTN","GMTSPD",34,0)
 S DIC(0)="AEQM",DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSPD",35,0)
 S Y=$$TYPE^GMTSULT I +Y'>0,X="^^" S DIROUT=1
"RTN","GMTSPD",36,0)
 I +Y>0,$S($D(^GMT(142,+Y,1,0))=0:1,$O(^(0))'>0:1,1:0) D
"RTN","GMTSPD",37,0)
 . W !,"This Summary Type includes no components...Please choose another."
"RTN","GMTSPD",38,0)
 Q Y
"RTN","GMTSPD",39,0)
SELLOC(GMX) ; Select multiple Hospital Location
"RTN","GMTSPD",40,0)
 N DIC,LOC,Y,X,DIR,GMTSLC
"RTN","GMTSPD",41,0)
 S DIC=44,DIC(0)="AEMQZ",DIC("A")="Select Hospital Location: ",GMTSLC=0
"RTN","GMTSPD",42,0)
 I $D(^XUSEC("GMTS VIEW ONLY",+($G(DUZ)))) S GMTSLC=1
"RTN","GMTSPD",43,0)
 S DIC("S")="I ""WCOR""[$P(^(0),U,3)"
"RTN","GMTSPD",44,0)
 F  D  Q:+$G(GMX(+$G(Y)))'>0!$D(DIROUT)!$D(DTOUT)!$D(DUOUT)  Q:GMTSLC<0
"RTN","GMTSPD",45,0)
 . D:GMTSLC'>0 ASK Q:$D(GMX("ALL"))
"RTN","GMTSPD",46,0)
 . D:GMTSLC>0 ^DIC S GMTSLC=GMTSLC+1 Q:$G(DIROUT)=1
"RTN","GMTSPD",47,0)
 . I +Y'>0 S:X="^^" DIROUT=1 Q
"RTN","GMTSPD",48,0)
 . S GMX(+Y)=$P(Y,U,1,2)_U_$P(Y(0),U,3)
"RTN","GMTSPD",49,0)
 . S $P(GMX,U)=+Y
"RTN","GMTSPD",50,0)
 . I "COR"[$P(Y(0),U,3) S $P(GMX,U,3)="COR"
"RTN","GMTSPD",51,0)
 . S DIC("A")="Select Next Hospital Location: "
"RTN","GMTSPD",52,0)
 Q
"RTN","GMTSPD",53,0)
ASK ; Prompt for One or ALL
"RTN","GMTSPD",54,0)
 N ERR,DIC,DIR,LASTI,LAST
"RTN","GMTSPD",55,0)
ASK2 S DIR("A")="Select Hospital Location: "
"RTN","GMTSPD",56,0)
 S LASTI=$G(^DISV(+($G(DUZ)),"^SC(")),LAST=$S(+LASTI>0:$P($G(^SC(+LASTI,0)),"^",1),1:"")
"RTN","GMTSPD",57,0)
 S DIR(0)="FAO^1:30",DIR("?")="^D A1^GMTSPD",DIR("??")="^D A2^GMTSPD"
"RTN","GMTSPD",58,0)
 D ^DIR I $L($G(X)),$E($G(X),1)=" ",$L(LAST),+($G(LASTI))>0 D  Q
"RTN","GMTSPD",59,0)
 . W "  ",LAST S X=LAST,Y=+LASTI_"^"_LAST,Y(0)=$G(^SC(+LASTI,0)),Y(0,0)=LAST Q
"RTN","GMTSPD",60,0)
 I $$UP^XLFSTR(Y)="ALL" D  Q
"RTN","GMTSPD",61,0)
 . K GMX S GMX="1^ALL^COR",GMX("ALL")="",GMX(1)="1^ALL^C",GMTSLC=-1
"RTN","GMTSPD",62,0)
 S ERR=1,DIC=44,DIC(0)="EMZ"
"RTN","GMTSPD",63,0)
 S DIC("S")="I ""WCOR""[$P(^(0),U,3) S ERR=0"
"RTN","GMTSPD",64,0)
 D ^DIC
"RTN","GMTSPD",65,0)
 I $L(X),+($G(ERR))>0 D  W ! G ASK2
"RTN","GMTSPD",66,0)
 . W " ??",!!,?5,"Not a ward, clinic or operating room"
"RTN","GMTSPD",67,0)
 I +Y'>0 S:X["^^" DIROUT=1,GMTSEXIT="^^" Q
"RTN","GMTSPD",68,0)
 Q
"RTN","GMTSPD",69,0)
A1 ; Single ? Help
"RTN","GMTSPD",70,0)
 W !,"  Answer with HOSPITAL LOCATION NAME, or ABBREVIATION, TEAM or 'ALL'"
"RTN","GMTSPD",71,0)
 W !,"  for all hospital locations.  Enter '^' to return to Health Summary"
"RTN","GMTSPD",72,0)
 W !,"  Type Selection or '^^' to exit."
"RTN","GMTSPD",73,0)
 Q
"RTN","GMTSPD",74,0)
A2 ; Double ?? Help
"RTN","GMTSPD",75,0)
 N GMTSN,GMTSI,GMTSL,GMTSC,GMTSE,GMTSP,GMTSA S GMTSP=+($G(IOSL))-9 S:GMTSP'>0 GMTSP=15
"RTN","GMTSPD",76,0)
 S (GMTSA,GMTSC,GMTSE)=0,GMTSN="" D A1 W !
"RTN","GMTSPD",77,0)
 F  S GMTSN=$O(^SC("B",GMTSN)) Q:GMTSN=""  D  Q:GMTSE
"RTN","GMTSPD",78,0)
 . S GMTSI=0 F  S GMTSI=$O(^SC("B",GMTSN,GMTSI)) Q:GMTSI=""  D  Q:GMTSE
"RTN","GMTSPD",79,0)
 . . S GMTSL=$P($G(^SC(GMTSI,0)),"^",1) Q:'$L(GMTSL)  S GMTSC=GMTSC+1,GMTSA=GMTSA+1
"RTN","GMTSPD",80,0)
 . . W:GMTSC=1 !,?3,"Choose from:" W !,?3,GMTSL
"RTN","GMTSPD",81,0)
 . . I GMTSA'<GMTSP D CONT
"RTN","GMTSPD",82,0)
 Q
"RTN","GMTSPD",83,0)
CONT ; Continue Displaying List
"RTN","GMTSPD",84,0)
 S GMTSP=+($G(IOSL))-1 S:GMTSP'>0 GMTSP=23 S GMTSA=0
"RTN","GMTSPD",85,0)
 N DIR,DA,X,Y,DTOUT,DUOUT,DIRUT,DIROUT S DIR(0)="E",DIR("A")="   '^' TO STOP",(DIR("?"),DIR("??"))="^D C1^GMTSPD"
"RTN","GMTSPD",86,0)
 D ^DIR S:+($G(Y))=0 GMTSE=1
"RTN","GMTSPD",87,0)
 Q
"RTN","GMTSPD",88,0)
C1 ; Continue Help
"RTN","GMTSPD",89,0)
 W !,"     Enter ether RETURN or '^'" Q
"RTN","GMTSPD",90,0)
CHKLOC(LOC) ; Get date range for Clinics/ORs
"RTN","GMTSPD",91,0)
 I $P($G(LOC),U,3)="COR" D  Q:$D(DIROUT)!$D(DTOUT)!$D(DUOUT)
"RTN","GMTSPD",92,0)
 . S $P(LOC,U,4)=$$SELDATE
"RTN","GMTSPD",93,0)
 W ! S GMLOC=0 F  S GMLOC=$O(LOC(GMLOC)) Q:+GMLOC'>0  D
"RTN","GMTSPD",94,0)
 . I "COR"[$P(LOC(+GMLOC),U,3) S $P(LOC(+GMLOC),U,4)=$P(LOC,U,4,5)
"RTN","GMTSPD",95,0)
 Q
"RTN","GMTSPD",96,0)
SELDATE() ; Visit/Surgery date range for Print-by-Clinic
"RTN","GMTSPD",97,0)
 N %,%H,%I,DIR,DEFDT,X,Y,GMBEG,GMEND
"RTN","GMTSPD",98,0)
 S (GMBEG,GMEND)=0
"RTN","GMTSPD",99,0)
 D NOW^%DTC S (X,DT)=$P(%,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPD",100,0)
 S DIR(0)="D^::EX",DIR("B")=DEFDT
"RTN","GMTSPD",101,0)
 S DIR("A")="Please enter the beginning Visit or Surgery date"
"RTN","GMTSPD",102,0)
 D ^DIR
"RTN","GMTSPD",103,0)
 I Y="^^" S DIROUT=1
"RTN","GMTSPD",104,0)
 S GMBEG=Y
"RTN","GMTSPD",105,0)
 I +GMBEG>0 D
"RTN","GMTSPD",106,0)
 . S X=$P(GMBEG,".") D REGDT4^GMTSU S DEFDT=X
"RTN","GMTSPD",107,0)
 . S DIR(0)="DO^::EX",DIR("B")=DEFDT
"RTN","GMTSPD",108,0)
 . S DIR("A")="Please enter the ending Visit or Surgery date"
"RTN","GMTSPD",109,0)
 . D ^DIR
"RTN","GMTSPD",110,0)
 . I Y="^^" S DIROUT=1
"RTN","GMTSPD",111,0)
 . S GMEND=Y
"RTN","GMTSPD",112,0)
 Q $S(+GMEND>0&(GMEND>GMBEG):GMBEG_U_GMEND,+GMEND>0&(GMEND<GMBEG):GMEND_U_GMBEG,+GMEND>0&(GMEND=GMBEG):GMBEG,1:0)
"RTN","GMTSPD",113,0)
CKPAT(LOC) ; Checks for patients at selected location
"RTN","GMTSPD",114,0)
 N %,%H,%T,LTYPE,X1,X2,X,Y,GMY,GMBEG,GMTSDATE,GMTSCDT,GMTSRES
"RTN","GMTSPD",115,0)
 S LTYPE=$P(LOC,U,3)
"RTN","GMTSPD",116,0)
 I LTYPE="W" D
"RTN","GMTSPD",117,0)
 . S LOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U)
"RTN","GMTSPD",118,0)
 . S GMY=$S($G(LOC)']"":0,$O(^DPT("CN",LOC,0)):1,1:0)
"RTN","GMTSPD",119,0)
 I $L(LOC,U)=4!($L(LOC,U)=5) D
"RTN","GMTSPD",120,0)
 . S GMY=0
"RTN","GMTSPD",121,0)
 . I +$P(LOC,U,5) S X1=$P(LOC,U,5),X2=1 D C^%DTC
"RTN","GMTSPD",122,0)
 . I +$P(LOC,U,5)'>0 S X1=$P(LOC,U,4),X2=1 D C^%DTC
"RTN","GMTSPD",123,0)
 . S GMTSCDT=$P(LOC,U,4)
"RTN","GMTSPD",124,0)
 . D GETPLIST^SDAMA202(+LOC,"1",,GMTSCDT,X,.GMTSRES) Q:GMTSRES=0
"RTN","GMTSPD",125,0)
 . I GMTSRES<0 D  Q
"RTN","GMTSPD",126,0)
 . . S GMY=-1
"RTN","GMTSPD",127,0)
 . . N GMTSERR
"RTN","GMTSPD",128,0)
 . . S GMTSERR=$O(^TMP($J,"SDAMA202","GETPLIST","ERROR",0))
"RTN","GMTSPD",129,0)
 . . I 'GMTSERR Q
"RTN","GMTSPD",130,0)
 . . D MAIL^GMTSMAIL($G(^TMP($J,"SDAMA202","GETPLIST","ERROR",GMTSERR)),"Nightly Job to Queue HS Batch Print-by-Loc")
"RTN","GMTSPD",131,0)
 . . K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","GMTSPD",132,0)
 . N GMTSI S GMTSI=0,GMTSDATE=0
"RTN","GMTSPD",133,0)
 . F  S GMTSI=$O(^TMP($J,"SDAMA202","GETPLIST",GMTSI)) Q:'GMTSI  D
"RTN","GMTSPD",134,0)
 . . I $G(^TMP($J,"SDAMA202","GETPLIST",GMTSI,1))<X S GMTSDATE=$G(^TMP($J,"SDAMA202","GETPLIST",GMTSI,1))
"RTN","GMTSPD",135,0)
 . K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","GMTSPD",136,0)
 . I LTYPE="C",(+GMTSDATE),(+GMTSDATE'>X) S GMY=1
"RTN","GMTSPD",137,0)
 . I LTYPE="OR" D
"RTN","GMTSPD",138,0)
 . . N OLOC S GMY=0,OLOC=+$O(^SRS("B",+LOC,0))
"RTN","GMTSPD",139,0)
 . . I +OLOC,+$P(LOC,U,5)'>0,$O(^SRF("AOR",+OLOC,+$P(LOC,U,4),0)) S GMY=1
"RTN","GMTSPD",140,0)
 . . I +OLOC,+$P(LOC,U,5) D
"RTN","GMTSPD",141,0)
 . . . S GMBEG=$P(LOC,U,4)
"RTN","GMTSPD",142,0)
 . . . F  D  Q:GMBEG>$P(LOC,U,5)!(GMY>0)
"RTN","GMTSPD",143,0)
 . . . . I $O(^SRF("AOR",+OLOC,+GMBEG,0)) S GMY=1
"RTN","GMTSPD",144,0)
 . . . . E  S X1=GMBEG,X2=1 D C^%DTC S GMBEG=X
"RTN","GMTSPD",145,0)
 Q $G(GMY)
"RTN","GMTSPL")
0^3^B49944430^B36810974
"RTN","GMTSPL",1,0)
GMTSPL ; SLC/JER,KER - Print/Queue HS for Patient Lists ; 02/27/2002 [1/27/05 8:27am]
"RTN","GMTSPL",2,0)
 ;;2.7;Health Summary;**7,27,28,30,47,49,70**;Oct 20, 1995;Build 5
"RTN","GMTSPL",3,0)
 ;
"RTN","GMTSPL",4,0)
 ; External References
"RTN","GMTSPL",5,0)
 ;    DBIA 10090  ^DIC(4
"RTN","GMTSPL",6,0)
 ;    DBIA 10039  ^DIC(42
"RTN","GMTSPL",7,0)
 ;    DBIA 10035  ^DPT(
"RTN","GMTSPL",8,0)
 ;    DBIA 10035  ^DPT("CN"
"RTN","GMTSPL",9,0)
 ;    DBIA 10040  ^SC(
"RTN","GMTSPL",10,0)
 ;    DBIA    16  ^SRF(
"RTN","GMTSPL",11,0)
 ;    DBIA   641  ^SRF("AOR"
"RTN","GMTSPL",12,0)
 ;    DBIA   185  ^SRS("B"
"RTN","GMTSPL",13,0)
 ;    DBIA 10091  ^XMB(1
"RTN","GMTSPL",14,0)
 ;    DBIA 10000  C^%DTC
"RTN","GMTSPL",15,0)
 ;    DBIA 10000  NOW^%DTC
"RTN","GMTSPL",16,0)
 ;    DBIA 10026  ^DIR
"RTN","GMTSPL",17,0)
 ;    DBIA   183  DFN^PSOSD1
"RTN","GMTSPL",18,0)
 ;    DBIA 10104  $$UP^XLFSTR
"RTN","GMTSPL",19,0)
 ;    DBIA  2056  $$GET1^DIQ (file #44)
"RTN","GMTSPL",20,0)
 ;                          
"RTN","GMTSPL",21,0)
MAIN ; Print/Queue for Patient Lists
"RTN","GMTSPL",22,0)
 ;                          
"RTN","GMTSPL",23,0)
 ; Call with:  
"RTN","GMTSPL",24,0)
 ;                   
"RTN","GMTSPL",25,0)
 ;   GMTSTYP  = Pointer to file 142
"RTN","GMTSPL",26,0)
 ;   GMTSSC   = Pointer to file 44^Hosp Loc Name^
"RTN","GMTSPL",27,0)
 ;              Hosp Loc Type^Begin Visit/Surg Date^
"RTN","GMTSPL",28,0)
 ;              Opt end Visit/Surgery Date
"RTN","GMTSPL",29,0)
 ;   GMTSSC() = GMTSSC - Array of multiple locations
"RTN","GMTSPL",30,0)
 ;   [GMPSAP] = Optional flag set to 1 if OP Rx 
"RTN","GMTSPL",31,0)
 ;              Action Profile is to print
"RTN","GMTSPL",32,0)
 ;                        
"RTN","GMTSPL",33,0)
 N MULTLOC,GMTSEXIT S GMTSEXIT=0
"RTN","GMTSPL",34,0)
 I $D(GMTSSC("ALL")) D  Q
"RTN","GMTSPL",35,0)
 . N IEN,BEG,END,COR,PRM,RAN,PAT
"RTN","GMTSPL",36,0)
 . S PRM=$G(GMTSSC),BEG=$P(PRM,"^",4),END=$P(PRM,"^",5)
"RTN","GMTSPL",37,0)
 . S RAN=BEG S:$L(END)&($L(RAN)) RAN=RAN_"^"_END S:$L(END)&('$L(RAN)) RAN=END
"RTN","GMTSPL",38,0)
 . S IEN=0 F  S IEN=$O(^SC(IEN)) Q:+IEN=0  D  Q:$G(GMTSEXIT)["^^"
"RTN","GMTSPL",39,0)
 . . N GMTSSC,NAM S NAM=$$GET1^DIQ(44,(+IEN_","),.01) Q:'$L(NAM)
"RTN","GMTSPL",40,0)
 . . S COR=$$GET1^DIQ(44,(+IEN_","),2,"I") Q:COR=""  Q:"WCOR"'[COR
"RTN","GMTSPL",41,0)
 . . S GMTSSC=IEN_"^"_NAM_"^"_COR
"RTN","GMTSPL",42,0)
 . . S:"COR"[COR&($L($G(RAN))) GMTSSC=GMTSSC_"^"_RAN
"RTN","GMTSPL",43,0)
 . . S PAT=$$PAT(GMTSSC) Q:+PAT=0
"RTN","GMTSPL",44,0)
 . . D CTRL
"RTN","GMTSPL",45,0)
 I +$O(GMTSSC(0))'>0 D CTRL
"RTN","GMTSPL",46,0)
 I +$O(GMTSSC(0)) D
"RTN","GMTSPL",47,0)
 . S MULTLOC=0 F  S MULTLOC=$O(GMTSSC(MULTLOC)) Q:+MULTLOC'>0!$D(DIROUT)  D
"RTN","GMTSPL",48,0)
 . . S GMTSSC=GMTSSC(+MULTLOC) D CTRL
"RTN","GMTSPL",49,0)
 Q
"RTN","GMTSPL",50,0)
CTRL ; Controls Branching
"RTN","GMTSPL",51,0)
 N DFN,GMTDFN,GMLTYPE,GMTSLTR,GMPNM,PSOPAR,PSONOPG,PSOINST,PSTYPE K ^TMP("GMTSPL",$J) U IO
"RTN","GMTSPL",52,0)
 N GMTSBYE S GMTSBYE=0
"RTN","GMTSPL",53,0)
 S GMLTYPE=$P(GMTSSC,U,3) S:GMLTYPE="C" GMTSBYE=$$CLINIC(GMTSSC) D:GMLTYPE="W" WARD(GMTSSC) D:GMLTYPE="OR" OR(GMTSSC)
"RTN","GMTSPL",54,0)
 I GMTSBYE Q
"RTN","GMTSPL",55,0)
 I $L($P(GMTSSC,U,2)),($E(IOST,1)'="C") S GMTSLTR=$E($P(GMTSSC,U,2),1,10) D ^GMTSLTR
"RTN","GMTSPL",56,0)
 I $O(^TMP("GMTSPL",$J,0))="",$D(GMTSSC("ALL")) W !,"ALL" Q
"RTN","GMTSPL",57,0)
 I $O(^TMP("GMTSPL",$J,0))="" D NOPAT($P(GMTSSC,U,2)) Q
"RTN","GMTSPL",58,0)
 S GMPNM="" F  S GMPNM=$O(^TMP("GMTSPL",$J,GMPNM)) Q:(GMPNM="")!($D(DIROUT))  D
"RTN","GMTSPL",59,0)
 . S GMTDFN=0 F  S GMTDFN=$O(^TMP("GMTSPL",$J,GMPNM,GMTDFN)) Q:(GMTDFN'>0)!($D(DIROUT))  D
"RTN","GMTSPL",60,0)
 . . N GMDUOUT
"RTN","GMTSPL",61,0)
 . . S DFN=GMTDFN D DRIVER Q:$D(DIROUT)!+$G(GMDUOUT)
"RTN","GMTSPL",62,0)
 . . I +$G(GMPSAP) D
"RTN","GMTSPL",63,0)
 . . . S (PSTYPE,PSONOPG)=1
"RTN","GMTSPL",64,0)
 . . . S $P(PSOPAR,U)=$S($P($G(^GMT(142.99,1,0)),U,5)="Y":1,1:0)
"RTN","GMTSPL",65,0)
 . . . S PSOINST=$S(+$G(PSOINST):PSOINST,1:+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U))
"RTN","GMTSPL",66,0)
 . . . D DFN^PSOSD1,PAGE
"RTN","GMTSPL",67,0)
 K ^TMP("GMTSPL",$J)
"RTN","GMTSPL",68,0)
 Q
"RTN","GMTSPL",69,0)
PAGE ; Pause at BOP for interactive users
"RTN","GMTSPL",70,0)
 N DIR,X,Y
"RTN","GMTSPL",71,0)
 Q:$E(IOST)'="C"!(IOT="HFS")!((IOSL>998)&($G(GMPAT(+$O(GMPAT(""),-1)))'=$G(DFN)))
"RTN","GMTSPL",72,0)
 I IOSL>($Y+5) F  W ! Q:IOSL<($Y+6)!($Y'<22)
"RTN","GMTSPL",73,0)
 S DIR(0)="FO^1:1",DIR("A")="Press RETURN to continue or '^' to exit"
"RTN","GMTSPL",74,0)
 S DIR("?")="Enter '^' to quit present report or '^^' to quit to menu"
"RTN","GMTSPL",75,0)
 D ^DIR S:X["^^" DIROUT=1
"RTN","GMTSPL",76,0)
 Q
"RTN","GMTSPL",77,0)
NOPAT(LOC) ; Handles unpopulated Hospital location
"RTN","GMTSPL",78,0)
 N %,%H,%I,%T,%Y,GMTS,GMTSDTM,GMTSTN,GMTSHDR,GMTSPG,GMTSTITL,GMTSDTM,GMTSLFG,X,Y
"RTN","GMTSPL",79,0)
 D NOW^%DTC S X=% D REGDTM4^GMTSU S GMTSDTM=X,GMTSTN=$P($G(^GMT(142,+($G(GMTSTYP)),0)),"^",1)
"RTN","GMTSPL",80,0)
 S DIC=142,DIC(0)="NXF",X=GMTSTN S Y=$$TYPE^GMTSULT K DIC
"RTN","GMTSPL",81,0)
 S GMTSTITL=$S($D(^GMT(142,+Y,"T")):^("T"),1:$P(Y,U,2)),GMTSLFG=1
"RTN","GMTSPL",82,0)
 W @IOF D HEADER^GMTSUP W !!,"No Patients found at ",LOC," location.",!
"RTN","GMTSPL",83,0)
 Q
"RTN","GMTSPL",84,0)
CLINIC(LOC) ; Gets list of next-day appointments for clinic
"RTN","GMTSPL",85,0)
 N %,%H,%I,%T,%Y,GMI,X,X1,X2,VDT,Y,GMPNM,GMDT,GMBDT,GMEDT,GMTSRES,GMTSCDT,GMDFN,GMNAME,GMDATE,GMTSLAST
"RTN","GMTSPL",86,0)
 S GMTSCDT=$P(LOC,U,4),GMI=0
"RTN","GMTSPL",87,0)
 I 'GMTSCDT D NOW^%DTC S GMTSCDT=X
"RTN","GMTSPL",88,0)
 S X=+GMTSCDT D REGDT4^GMTSU S GMBDT=X
"RTN","GMTSPL",89,0)
 S X=+$P(LOC,U,5) D REGDT4^GMTSU S GMEDT=X
"RTN","GMTSPL",90,0)
 S:+$P(LOC,U,5) X1=$P(LOC,U,5),X2=1
"RTN","GMTSPL",91,0)
 S:+$P(LOC,U,5)'>0 X1=GMTSCDT,X2=1 D C^%DTC
"RTN","GMTSPL",92,0)
 S GMTSLAST=X
"RTN","GMTSPL",93,0)
 D GETPLIST^SDAMA202(+LOC,"1;4",,GMTSCDT,GMTSLAST,.GMTSRES)
"RTN","GMTSPL",94,0)
 I GMTSRES<0 D  Q "-1"
"RTN","GMTSPL",95,0)
 . N GMTSERR
"RTN","GMTSPL",96,0)
 . S GMTSERR=$O(^TMP($J,"SDAMA202","GETPLIST","ERROR",0))
"RTN","GMTSPL",97,0)
 . I 'GMTSERR Q
"RTN","GMTSPL",98,0)
 . D MAIL^GMTSMAIL($G(^TMP($J,"SDAMA202","GETPLIST","ERROR",GMTSERR)),"Print/Queue HS for Patient Lists")
"RTN","GMTSPL",99,0)
 . K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","GMTSPL",100,0)
 F  S GMI=$O(^TMP($J,"SDAMA202","GETPLIST",GMI)) Q:GMI=""  D
"RTN","GMTSPL",101,0)
 . N X
"RTN","GMTSPL",102,0)
 . S X=$G(^TMP($J,"SDAMA202","GETPLIST",GMI,1))
"RTN","GMTSPL",103,0)
 . Q:X>GMTSLAST
"RTN","GMTSPL",104,0)
 . D REGDT4^GMTSU S GMDATE=X
"RTN","GMTSPL",105,0)
 . S GMDFN=+$G(^TMP($J,"SDAMA202","GETPLIST",GMI,4))
"RTN","GMTSPL",106,0)
 . S GMNAME=$P($G(^TMP($J,"SDAMA202","GETPLIST",GMI,4)),U,2)
"RTN","GMTSPL",107,0)
 . S ^TMP("GMTSPL",$J,GMNAME,+GMDFN)=$S($D(^TMP("GMTSPL",$J,GMNAME,+GMDFN)):GMBDT_" TO "_GMEDT,1:GMDATE)
"RTN","GMTSPL",108,0)
 K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","GMTSPL",109,0)
 Q 0
"RTN","GMTSPL",110,0)
WARD(LOC) ; Gets list of patients for a ward
"RTN","GMTSPL",111,0)
 N DFN,GMLOC,X,Y,GMDT
"RTN","GMTSPL",112,0)
 S GMLOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U)
"RTN","GMTSPL",113,0)
 I $S('$L(GMLOC):1,'$O(^DPT("CN",GMLOC,0)):1,1:0) Q
"RTN","GMTSPL",114,0)
 S DFN=0 F  S DFN=$O(^DPT("CN",GMLOC,DFN)) Q:+DFN'>0  D
"RTN","GMTSPL",115,0)
 . N X
"RTN","GMTSPL",116,0)
 . S X=+$G(DT) D REGDT4^GMTSU S GMDT=X
"RTN","GMTSPL",117,0)
 . S ^TMP("GMTSPL",$J,$P($G(^DPT(+DFN,0)),U),+DFN)=GMDT
"RTN","GMTSPL",118,0)
 Q
"RTN","GMTSPL",119,0)
OR(LOC) ; Gets list of patients scheduled for surgery
"RTN","GMTSPL",120,0)
 N GMBEG,GMEND,DFN,GMI,GMJ,GMPNM,GMDT,%,%H,%I,%T,%Y,X,X1,X2,Y
"RTN","GMTSPL",121,0)
 S GMI=+$O(^SRS("B",+LOC,0)) I +GMI'>0 G ORX
"RTN","GMTSPL",122,0)
 S GMBEG=$P(LOC,U,4)-.0001,GMEND=$S(+$P(LOC,U,5)>0:$P(LOC,U,5),1:$P(LOC,U,4))
"RTN","GMTSPL",123,0)
 F  S GMBEG=$O(^SRF("AOR",+GMI,+GMBEG)) Q:+GMBEG'>0!(+GMBEG>+GMEND)  D
"RTN","GMTSPL",124,0)
 . S GMJ=0 F  S GMJ=$O(^SRF("AOR",+GMI,+GMBEG,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSPL",125,0)
 . . S DFN=+$G(^SRF(+GMJ,0)) Q:DFN'>0
"RTN","GMTSPL",126,0)
 . . S GMPNM=$P($G(^DPT(+DFN,0)),U)
"RTN","GMTSPL",127,0)
 . . N X
"RTN","GMTSPL",128,0)
 . . S X=+GMBEG D REGDT4^GMTSU S GMDT=X
"RTN","GMTSPL",129,0)
 . . S ^TMP("GMTSPL",$J,GMPNM,+DFN)=$S($D(^TMP("GMTSPL",$J,GMPNM,+DFN)):^(+DFN)_", "_GMDT,1:GMDT)
"RTN","GMTSPL",130,0)
ORX ; Exit Surgery
"RTN","GMTSPL",131,0)
 Q
"RTN","GMTSPL",132,0)
PAT(LOC) ; Checks for patients at selected location
"RTN","GMTSPL",133,0)
 N %,%H,%T,LTYPE,X1,X2,X,Y,GMY,GMBEG,GMTSDATE,GMTSCDT,GMTSRES S LTYPE=$P(LOC,U,3),GMY=0
"RTN","GMTSPL",134,0)
 I LTYPE="W" D
"RTN","GMTSPL",135,0)
 . S LOC=$P($G(^DIC(42,+$G(^SC(+LOC,42)),0)),U),GMY=$S($G(LOC)']"":0,$O(^DPT("CN",LOC,0)):1,1:0)
"RTN","GMTSPL",136,0)
 I $L(LOC,U)=4!($L(LOC,U)=5) D
"RTN","GMTSPL",137,0)
 . S GMY=0 S:+$P(LOC,U,5) X1=$P(LOC,U,5),X2=1 S:+$P(LOC,U,5)'>0 X1=$P(LOC,U,4),X2=1 D C^%DTC
"RTN","GMTSPL",138,0)
 . S GMTSCDT=$P(LOC,U,4)
"RTN","GMTSPL",139,0)
 . D GETPLIST^SDAMA202(+LOC,"1",,GMTSCDT,X,.GMTSRES) Q:GMTSRES=0
"RTN","GMTSPL",140,0)
 . I GMTSRES<0 D  Q
"RTN","GMTSPL",141,0)
 . . N GMTSERR
"RTN","GMTSPL",142,0)
 . . S GMTSERR=$O(^TMP($J,"SDAMA202","GETPLIST","ERROR",0))
"RTN","GMTSPL",143,0)
 . . I 'GMTSERR Q
"RTN","GMTSPL",144,0)
 . . D MAIL^GMTSMAIL($G(^TMP($J,"SDAMA202","GETPLIST","ERROR",GMTSERR)),"Print/Queue HS for Patient Lists")
"RTN","GMTSPL",145,0)
 . . K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","GMTSPL",146,0)
 . N GMTSI S GMTSI=0,GMTSDATE=0
"RTN","GMTSPL",147,0)
 . F  S GMTSI=$O(^TMP($J,"SDAMA202","GETPLIST",GMTSI)) Q:'GMTSI  D
"RTN","GMTSPL",148,0)
 . . I $G(^TMP($J,"SDAMA202","GETPLIST",GMTSI,1))<X S GMTSDATE=$G(^TMP($J,"SDAMA202","GETPLIST",GMTSI,1))
"RTN","GMTSPL",149,0)
 . K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","GMTSPL",150,0)
 . I LTYPE="C",(+GMTSDATE),(+GMTSDATE'>X) S GMY=1
"RTN","GMTSPL",151,0)
 . I LTYPE="OR" D
"RTN","GMTSPL",152,0)
 . . N OLOC S GMY=0,OLOC=+$O(^SRS("B",+LOC,0))
"RTN","GMTSPL",153,0)
 . . I +OLOC,+$P(LOC,U,5)'>0,$O(^SRF("AOR",+OLOC,+$P(LOC,U,4),0)) S GMY=1
"RTN","GMTSPL",154,0)
 . . I +OLOC,+$P(LOC,U,5) S GMBEG=$P(LOC,U,4) F  D  Q:GMBEG>$P(LOC,U,5)!(GMY>0)
"RTN","GMTSPL",155,0)
 . . . S:$O(^SRF("AOR",+OLOC,+GMBEG,0)) GMY=1 Q:+GMY>0  S X1=GMBEG,X2=1 D C^%DTC S GMBEG=X
"RTN","GMTSPL",156,0)
 Q $G(GMY)
"RTN","GMTSPL",157,0)
DRIVER ; Sets variables for GMTS1 and calls ^%ZTLOAD
"RTN","GMTSPL",158,0)
 N %T,C,D0,GMTS,GMTS0,GMTS1,GMTS2,GMTSDOB,GMTSDTM,GMTSLO,GMTSLOCK
"RTN","GMTSPL",159,0)
 N GMTSLPG,GMTSEG,GMTSEGC,GMTSTN,GMTSEGI,GMTSPNM,GMTSRB
"RTN","GMTSPL",160,0)
 N GMTSSN,GMTSTITL,GMTSWARD,GMTSX,GMTSPHDR,GMTSAGE,GMTSTOF,GMTSCDT
"RTN","GMTSPL",161,0)
 N GMW,I,SEX,VA,VADM,VAIN,VAINDT,VAROOT,X,Y
"RTN","GMTSPL",162,0)
 S GMTSCDT(0)=^TMP("GMTSPL",$J,GMPNM,+DFN),GMTSTN=$P($G(^GMT(142,+($G(GMTSTYP)),0)),"^",1)
"RTN","GMTSPL",163,0)
 S DIC=142,DIC(0)="NXF",X=GMTSTN S Y=$$TYPE^GMTSULT K DIC
"RTN","GMTSPL",164,0)
 S GMTSTITL=$$UP^XLFSTR($S($G(^GMT(142,+Y,"T"))]"":^("T"),1:$P(Y,U,2)))
"RTN","GMTSPL",165,0)
 D:$D(GMTSEG)'>9 SELTYP1^GMTS D EN^GMTS1
"RTN","GMTSPL",166,0)
 Q
"VER")
8.0^22.0
"^DD",142.99,142.99,0)
FIELD^^.06^6
"^DD",142.99,142.99,0,"DDA")
N
"^DD",142.99,142.99,0,"DT")
3061019
"^DD",142.99,142.99,0,"IX","B",142.99,.01)

"^DD",142.99,142.99,0,"NM","HEALTH SUMMARY PARAMETERS")

"^DD",142.99,142.99,0,"VRPK")
GMTS
"^DD",142.99,142.99,.01,0)
NAME^RFX^^0;1^I $L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E)!(X'="HOSPITAL") K X W "   NAME must be HOSPITAL."
"^DD",142.99,142.99,.01,1,0)
^.1
"^DD",142.99,142.99,.01,1,1,0)
142.99^B
"^DD",142.99,142.99,.01,1,1,1)
S ^GMT(142.99,"B",$E(X,1,30),DA)=""
"^DD",142.99,142.99,.01,1,1,2)
K ^GMT(142.99,"B",$E(X,1,30),DA)
"^DD",142.99,142.99,.01,3)
NAME MUST BE HOSPITAL
"^DD",142.99,142.99,.01,21,0)
^^3^3^2920914^
"^DD",142.99,142.99,.01,21,1,0)
This is the name of the entry in the Health Summary parameters file.
"^DD",142.99,142.99,.01,21,2,0)
The input transform will restrict entry to one record only, which must
"^DD",142.99,142.99,.01,21,3,0)
be named "HOSPITAL."
"^DD",142.99,142.99,.01,"DT")
2920427
"^DD",142.99,142.99,.02,0)
PROMPT FOR ACTION PROFILE^S^Y:yes;N:no;^0;2^Q
"^DD",142.99,142.99,.02,3)
Enter YES if you'd like users to be prompted to print Action Profiles
"^DD",142.99,142.99,.02,21,0)
^^3^3^2951006^^^
"^DD",142.99,142.99,.02,21,1,0)
If this parameter is set to Y or YES, the user will be prompted to include
"^DD",142.99,142.99,.02,21,2,0)
the Outpatient Pharmacy Action Profile when printing Health Summaries by
"^DD",142.99,142.99,.02,21,3,0)
location (both interactive and batch mode) and by patient.
"^DD",142.99,142.99,.02,"DT")
2951006
"^DD",142.99,142.99,.03,0)
INCLUDE COMMENTS FOR LABS^S^Y:yes;N:no;^0;3^Q
"^DD",142.99,142.99,.03,3)
Enter YES if comments should appear in Chemistry and Hematology, Lab Tests Selected, and Lab Cumulative Selected components
"^DD",142.99,142.99,.03,21,0)
^^13^13^2951006^
"^DD",142.99,142.99,.03,21,1,0)
If this parameter is set to Y or YES, the Chemistry & Hematology, the Lab
"^DD",142.99,142.99,.03,21,2,0)
Tests Selected and the Lab Cumulative Selected components will present
"^DD",142.99,142.99,.03,21,3,0)
comments for results. For the Chemistry & Hematology and the Lab Tests
"^DD",142.99,142.99,.03,21,4,0)
Selected components the comments will be displayed immediately following
"^DD",142.99,142.99,.03,21,5,0)
the results. For the Lab Cumulative Selected components a lower case
"^DD",142.99,142.99,.03,21,6,0)
letter will be displayed to the left of the date for entries with
"^DD",142.99,142.99,.03,21,7,0)
comments. Comments will be displayed after all the results are displayed
"^DD",142.99,142.99,.03,21,8,0)
with the comments being linked by the lower case letter. Up to 26 comments
"^DD",142.99,142.99,.03,21,9,0)
can be included. 
"^DD",142.99,142.99,.03,21,10,0)
 
"^DD",142.99,142.99,.03,21,11,0)
If blank, N or NO, the Chemistry & Hematology and the Lab Tests Selected
"^DD",142.99,142.99,.03,21,12,0)
components will present the symbol "!!" next to tests which include
"^DD",142.99,142.99,.03,21,13,0)
comments, and a footnote referring the user to the Lab Interim Report.
"^DD",142.99,142.99,.03,"DT")
2951006
"^DD",142.99,142.99,.04,0)
SPOOL DEVICE^*P3.5'^%ZIS(1,^0;4^S DIC("S")="I $P($G(^(""TYPE"")),U)=""SPL""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",142.99,142.99,.04,3)
Enter a SPOOL DEVICE NAME for Health Summary-PDX interface.
"^DD",142.99,142.99,.04,12)
Only allow device type of SPOOL to be chosen.
"^DD",142.99,142.99,.04,12.1)
S DIC("S")="I $P($G(^(""TYPE"")),U)=""SPL"""
"^DD",142.99,142.99,.04,21,0)
^^2^2^2950815^
"^DD",142.99,142.99,.04,21,1,0)
This is the SPOOL DEVICE to which Health Summary output can be directed
"^DD",142.99,142.99,.04,21,2,0)
during a PDX request for one or more Health Summary Components.
"^DD",142.99,142.99,.04,"DT")
2950815
"^DD",142.99,142.99,.05,0)
INCLUDE BAR CODES ON ACT PROF^S^Y:yes;N:no;^0;5^Q
"^DD",142.99,142.99,.05,.1)
INCLUDE BAR CODES ON ACTION PROFILES
"^DD",142.99,142.99,.05,3)
Enter YES to include bar codes when Action Profiles are printed by Health Summary.
"^DD",142.99,142.99,.05,21,0)
^^2^2^2951006^
"^DD",142.99,142.99,.05,21,1,0)
If this parameter is set to YES or YES, Bar Codes will be included when
"^DD",142.99,142.99,.05,21,2,0)
Outpatient Pharmacy Action Profiles are printed from Health Summary.
"^DD",142.99,142.99,.05,"DT")
2951006
"^DD",142.99,142.99,.06,0)
ERROR MESSAGE RECIPIENT^V^^0;6^
"^DD",142.99,142.99,.06,3)
Answer must be 1-25 characters in length
"^DD",142.99,142.99,.06,21,0)
^^4^4^3050126^
"^DD",142.99,142.99,.06,21,1,0)
This is the user or mail group that will recieve error messages from the 
"^DD",142.99,142.99,.06,21,2,0)
Health Summary Package when they are sent.  Instances of when error 
"^DD",142.99,142.99,.06,21,3,0)
messages are sent would be when a tasked batch print job needs to exit 
"^DD",142.99,142.99,.06,21,4,0)
without producing a report.
"^DD",142.99,142.99,.06,"DT")
3061019
"^DD",142.99,142.99,.06,"V",0)
^.12P^^2
"^DD",142.99,142.99,.06,"V",1,0)
200^NEW PERSON^1^P^n^n
"^DD",142.99,142.99,.06,"V",1,1)

"^DD",142.99,142.99,.06,"V",1,2)

"^DD",142.99,142.99,.06,"V",2,0)
3.8^MAIL GROUP^2^G^n^n
"^DD",142.99,142.99,.06,"V",2,1)

"^DD",142.99,142.99,.06,"V",2,2)

"^DIC",142.99,142.99,0)
HEALTH SUMMARY PARAMETERS^142.99
"^DIC",142.99,142.99,0,"GL")
^GMT(142.99,
"^DIC",142.99,142.99,"%D",0)
^^2^2^2950804^^^^
"^DIC",142.99,142.99,"%D",1,0)
This file contains any site parameters which may apply to the Health
"^DIC",142.99,142.99,"%D",2,0)
Summary package.
"^DIC",142.99,"B","HEALTH SUMMARY PARAMETERS",142.99)

"BLD",17040,6)
^76
**END**
**END**
