Released FB*3.5*91 SEQ #80
Extracted from mail message
**KIDS**:FB*3.5*91^

**INSTALL NAME**
FB*3.5*91
"BLD",6113,0)
FB*3.5*91^FEE BASIS^0^3050517^y
"BLD",6113,1,0)
^^5^5^3050517^
"BLD",6113,1,1,0)
This patch replaces a direct global read of the PSDRUG global by a VA 
"BLD",6113,1,2,0)
Fileman call in support of the Pharmacy Encapsulation project.  It also
"BLD",6113,1,3,0)
fixes a bug that prevented display of the generic drug equivalent during
"BLD",6113,1,4,0)
completion of a fee pharmacy invoice.  It also fixes problems with the 
"BLD",6113,1,5,0)
edit after review functionality of the Review Fee Prescription option.
"BLD",6113,4,0)
^9.64PA^162.1^1
"BLD",6113,4,162.1,0)
162.1
"BLD",6113,4,162.1,2,0)
^9.641^162.11^1
"BLD",6113,4,162.1,2,162.11,0)
PRESCRIPTION NUMBER  (sub-file)
"BLD",6113,4,162.1,2,162.11,1,0)
^9.6411^8.5^1
"BLD",6113,4,162.1,2,162.11,1,8.5,0)
SUBSTITUTE GENERIC DRUG
"BLD",6113,4,162.1,222)
y^n^p^^^^n^^n
"BLD",6113,4,162.1,224)

"BLD",6113,4,"APDD",162.1,162.11)

"BLD",6113,4,"APDD",162.1,162.11,8.5)

"BLD",6113,4,"B",162.1,162.1)

"BLD",6113,"INIT")
PS^FBXIP91
"BLD",6113,"KRN",0)
^9.67PA^8989.52^19
"BLD",6113,"KRN",.4,0)
.4
"BLD",6113,"KRN",.401,0)
.401
"BLD",6113,"KRN",.402,0)
.402
"BLD",6113,"KRN",.403,0)
.403
"BLD",6113,"KRN",.5,0)
.5
"BLD",6113,"KRN",.84,0)
.84
"BLD",6113,"KRN",3.6,0)
3.6
"BLD",6113,"KRN",3.8,0)
3.8
"BLD",6113,"KRN",9.2,0)
9.2
"BLD",6113,"KRN",9.8,0)
9.8
"BLD",6113,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6113,"KRN",9.8,"NM",1,0)
FBAACIE^^0^B15124561
"BLD",6113,"KRN",9.8,"NM",2,0)
FBAAPP0^^0^B4309645
"BLD",6113,"KRN",9.8,"NM",3,0)
FBAAPP^^0^B24856042
"BLD",6113,"KRN",9.8,"NM","B","FBAACIE",1)

"BLD",6113,"KRN",9.8,"NM","B","FBAAPP",3)

"BLD",6113,"KRN",9.8,"NM","B","FBAAPP0",2)

"BLD",6113,"KRN",19,0)
19
"BLD",6113,"KRN",19.1,0)
19.1
"BLD",6113,"KRN",101,0)
101
"BLD",6113,"KRN",409.61,0)
409.61
"BLD",6113,"KRN",771,0)
771
"BLD",6113,"KRN",870,0)
870
"BLD",6113,"KRN",8989.51,0)
8989.51
"BLD",6113,"KRN",8989.52,0)
8989.52
"BLD",6113,"KRN",8994,0)
8994
"BLD",6113,"KRN","B",.4,.4)

"BLD",6113,"KRN","B",.401,.401)

"BLD",6113,"KRN","B",.402,.402)

"BLD",6113,"KRN","B",.403,.403)

"BLD",6113,"KRN","B",.5,.5)

"BLD",6113,"KRN","B",.84,.84)

"BLD",6113,"KRN","B",3.6,3.6)

"BLD",6113,"KRN","B",3.8,3.8)

"BLD",6113,"KRN","B",9.2,9.2)

"BLD",6113,"KRN","B",9.8,9.8)

"BLD",6113,"KRN","B",19,19)

"BLD",6113,"KRN","B",19.1,19.1)

"BLD",6113,"KRN","B",101,101)

"BLD",6113,"KRN","B",409.61,409.61)

"BLD",6113,"KRN","B",771,771)

"BLD",6113,"KRN","B",870,870)

"BLD",6113,"KRN","B",8989.51,8989.51)

"BLD",6113,"KRN","B",8989.52,8989.52)

"BLD",6113,"KRN","B",8994,8994)

"BLD",6113,"QUES",0)
^9.62^^
"BLD",6113,"REQB",0)
^9.611^1^1
"BLD",6113,"REQB",1,0)
FB*3.5*80^2
"BLD",6113,"REQB","B","FB*3.5*80",1)

"FIA",162.1)
FEE BASIS PHARMACY INVOICE
"FIA",162.1,0)
^FBAA(162.1,
"FIA",162.1,0,0)
162.1
"FIA",162.1,0,1)
y^n^p^^^^n^^n
"FIA",162.1,0,10)

"FIA",162.1,0,11)

"FIA",162.1,0,"RLRO")

"FIA",162.1,0,"VR")
3.5^FB
"FIA",162.1,162.1)
1
"FIA",162.1,162.11)
1
"FIA",162.1,162.11,8.5)

"INIT")
PS^FBXIP91
"MBREQ")
0
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
91^3050517
"PKG",60,22,1,"PAH",1,1,0)
^^5^5^3050517
"PKG",60,22,1,"PAH",1,1,1,0)
This patch replaces a direct global read of the PSDRUG global by a VA 
"PKG",60,22,1,"PAH",1,1,2,0)
Fileman call in support of the Pharmacy Encapsulation project.  It also
"PKG",60,22,1,"PAH",1,1,3,0)
fixes a bug that prevented display of the generic drug equivalent during
"PKG",60,22,1,"PAH",1,1,4,0)
completion of a fee pharmacy invoice.  It also fixes problems with the 
"PKG",60,22,1,"PAH",1,1,5,0)
edit after review functionality of the Review Fee Prescription option.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","FBAACIE")
0^1^B15124561
"RTN","FBAACIE",1,0)
FBAACIE ;AISC/GRR-COMPLETE PHARMACY INVOICE ;4/21/2004
"RTN","FBAACIE",2,0)
 ;;3.5;FEE BASIS;**38,61,91**;JAN 30, 1995
"RTN","FBAACIE",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAACIE",4,0)
 D DT^DICRW,HOME^%ZIS I '$D(^FBAA(162.1,"AC",2)) W !!,*7,"There are no Invoices Pending completion!",!! Q
"RTN","FBAACIE",5,0)
 D SITEP^FBAAUTL I FBPOP W !,*7,"Fee Site Parameters must be Initialized!" K FBPOP Q
"RTN","FBAACIE",6,0)
 S FBAAOUT=1,FBMDF=$P(FBSITE(0),"^",10),UL="",$P(UL,"=",79)="="
"RTN","FBAACIE",7,0)
RINV W ! S FBINTOT=0,DIC="^FBAA(162.1,",DIC(0)="AEQM",DIC("S")="I $P(^(0),U,5)=2&($D(^(""RX"",""AC"",2)))" D ^DIC K DIC("S") G END:X="^"!(X=""),RINV:Y<0 S FBIN=+Y,FBINTOT=+$P(^(0),"^",7)
"RTN","FBAACIE",8,0)
 I '$D(^FBAA(162.1,FBIN,"RX","AC",2)) G RINV
"RTN","FBAACIE",9,0)
 S J=0 F  S J=$O(^FBAA(162.1,FBIN,"RX","AC",2,J)) Q:'J  I $D(^FBAA(162.1,FBIN,"RX",J,0)) S Y(0)=^(0) D GOT
"RTN","FBAACIE",10,0)
 I '$D(^FBAA(162.1,FBIN,"RX","AC",2)) K ^FBAA(162.1,"AC",2,FBIN) S ^FBAA(162.1,"AC",3,FBIN)="",$P(^FBAA(162.1,FBIN,0),"^",5)=3
"RTN","FBAACIE",11,0)
 I $D(^FBAA(162.1,"AC",3,FBIN)) W !!,"Invoice is Complete",?30,"Totals: $ "_$J(FBINTOT,1,2)
"RTN","FBAACIE",12,0)
 G RINV
"RTN","FBAACIE",13,0)
END K FBAAOUT,FBIN,FBRX,FBSITE,FBDATEF,FBDRUG,FBPATN,FBPID,FBVNAME,FBVID,FBAC,FBAAPR,DA,X,Y,D0,D1,DI,DIC,DIE,DIRUT,DIV,DQ,DR,FBAP,FBGEN,FBGENSUB,FBINTOT,FBMDF,FBQTY,FBRBC,FBSTR,FBVEN,S,UL,ULL,POP,J,DFN,Z,ZZ,FBSW,FBPOP,FB1725
"RTN","FBAACIE",14,0)
 K FBADJ,FBFPPSC,FBFPPSL,FBRRMK,DTOUT
"RTN","FBAACIE",15,0)
 Q
"RTN","FBAACIE",16,0)
GOT S FBDRUG=$P(Y(0),"^",2)
"RTN","FBAACIE",17,0)
 S FBGENSUB=$$GET1^DIQ(162.11,J_","_FBIN_",",8.5)
"RTN","FBAACIE",18,0)
 S FBGEN=$$GET1^DIQ(162.11,J_","_FBIN_",",9)
"RTN","FBAACIE",19,0)
 S FBRX=$P(Y(0),"^"),FBDATEF=$P(Y(0),"^",3),FBAC=$P(Y(0),"^",4),DFN=+$P(Y(0),"^",5),FBPATN=$$VET^FBUCUTL(DFN),FBPID=$$SSN^FBAAUTL(DFN)
"RTN","FBAACIE",20,0)
 S FBSTR=$P(Y(0),"^",12),FBQTY=$P(Y(0),"^",13),FBAAPR=$P(Y(0),"^",22)
"RTN","FBAACIE",21,0)
 S Y=$S($D(^FBAA(162.1,FBIN,0)):^(0),1:"")
"RTN","FBAACIE",22,0)
 S FBFPPSC=$P(Y,U,13)
"RTN","FBAACIE",23,0)
 S FBFPPSL=$P($G(^FBAA(162.1,FBIN,"RX",J,3)),U)
"RTN","FBAACIE",24,0)
 S FBVEN=+$P(Y,"^",4),FBVNAME=$$VEN^FBUCUTL(FBVEN),FBVID=$P($G(^FBAAV(FBVEN,0)),"^",2)
"RTN","FBAACIE",25,0)
 ; set FB1725 flag = true if payment for a 38 U.S.C. 1725 claim
"RTN","FBAACIE",26,0)
 S Y(2)=$G(^FBAA(162.1,FBIN,"RX",J,2))
"RTN","FBAACIE",27,0)
 S FB1725=$S($P(Y(2),U,6)["FB583":+$P($G(^FB583(+$P(Y(2),U,6),0)),U,28),1:0)
"RTN","FBAACIE",28,0)
 W @IOF,"Vendor: ",FBVNAME,"   Vendor ID: ",FBVID
"RTN","FBAACIE",29,0)
 W !!,"Patient: ",FBPATN,"   Patient ID: ",FBPID
"RTN","FBAACIE",30,0)
 W !,"FPPS Claim ID: ",$S(FBFPPSC="":"N/A",1:FBFPPSC)
"RTN","FBAACIE",31,0)
 W ?28,"FPPS Line Item: ",$S(FBFPPSL="":"N/A",1:FBFPPSL)
"RTN","FBAACIE",32,0)
 W !!,"Drug Name",?32,"   RX #  "," Strength  ","  Qty","   Amt Claimed   ",!,UL
"RTN","FBAACIE",33,0)
 W !,FBDRUG,?34,FBRX,?43,FBSTR,?54,FBQTY,?63,FBAC
"RTN","FBAACIE",34,0)
 I FBGENSUB]"" W !!,?4,"Generic Drug Issued: ",FBGENSUB,?30,"Generic Drug Name: ",$E(FBGEN,1,30)
"RTN","FBAACIE",35,0)
 W:FBAAPR]"" !!,?5,"Pharmacy Remarks: ",FBAAPR
"RTN","FBAACIE",36,0)
FEE S DIR(0)="161.4,9",DIR("B")=FBMDF,DIR("?")="Hit Return to accept default dispensing fee or enter a dollar amount between .01 and 20" D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBAACIE",37,0)
 W:FB1725 !?2,"**Payment is for emergency treatment under 38 U.S.C. 1725."
"RTN","FBAACIE",38,0)
 W !! S FBMDF=+Y K FBAP
"RTN","FBAACIE",39,0)
 S DA(1)=FBIN,DIE="^FBAA(162.1,"_FBIN_",""RX"",",DA=J,DIC=DIE,DR="5;S FBRBC=X;6.5//^S X=$S(FBRBC+FBMDF>FBAC:FBAC,1:FBRBC+FBMDF);S FBAP=X"
"RTN","FBAACIE",40,0)
 S DR(1,162.11,1)="I FBAP>FBAC S $P(^FBAA(162.1,DA(1),""RX"",DA,0),U,16)="""" W !,*7,""Amount Paid cannot be greater than the Amount Claimed"" S Y=6.5"
"RTN","FBAACIE",41,0)
 ;S DR(1,162.11,2)="S:(FBAC-FBAP)'>0 Y=8;6///^S X=FBAC-FBAP;Q;6R;7R;S:X'=4 Y=8;20;8////^S X=3"
"RTN","FBAACIE",42,0)
 S DR(1,162.11,2)="S FBX=$$ADJ^FBUTL2(FBAC-FBAP,.FBADJ,2,,,1)"
"RTN","FBAACIE",43,0)
 S DR(1,162.11,3)="S FBX=$$RR^FBUTL4(.FBRRMK,2);8////^S X=3"
"RTN","FBAACIE",44,0)
 D ^DIE K DIE Q:$D(Y)'=0
"RTN","FBAACIE",45,0)
 S:$D(FBAP) FBINTOT=FBINTOT+FBAP
"RTN","FBAACIE",46,0)
 S $P(^FBAA(162.1,FBIN,0),"^",7)=FBINTOT
"RTN","FBAACIE",47,0)
 G:$D(DTOUT) H^XUS
"RTN","FBAACIE",48,0)
 ; file adjustments
"RTN","FBAACIE",49,0)
 D FILEADJ^FBRXFA(DA_","_FBIN_",",.FBADJ)
"RTN","FBAACIE",50,0)
 ; file remittance remarks
"RTN","FBAACIE",51,0)
 D FILERR^FBRXFR(DA_","_FBIN_",",.FBRRMK)
"RTN","FBAACIE",52,0)
 Q
"RTN","FBAAPP")
0^3^B24856042
"RTN","FBAAPP",1,0)
FBAAPP ;AISC/GRR-ENTER FEE PHARMACY DETERMINATION ;5/10/2005
"RTN","FBAAPP",2,0)
 ;;3.5;FEE BASIS;**61,80,91**;JAN 30, 1995
"RTN","FBAAPP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAPP",4,0)
 N FBADJ,FBRRMK
"RTN","FBAAPP",5,0)
 D HOME^%ZIS S FBAAOUT=0 K ^TMP($J,"FBWP") D DT^DICRW
"RTN","FBAAPP",6,0)
 I '$D(^FBAA(162.1,"AC",1)) W !!,"There are no Fee Basis prescriptions Pending Pharmacy review" G END
"RTN","FBAAPP",7,0)
 D WAIT^DICD S (CNT,L,M)=0 F  S L=$O(^FBAA(162.1,"AC",1,L)) Q:L'>0  I $D(^FBAA(162.1,L,"RX","AC",1)) F  S M=$O(^FBAA(162.1,L,"RX","AC",1,M)) Q:M'>0  S CNT=CNT+1
"RTN","FBAAPP",8,0)
 W !!,*7,"There are ",CNT," Fee Prescription(s) Pending Pharmacy review"
"RTN","FBAAPP",9,0)
ASKRV Q:CNT'>0  W ! S DIR("A")="Want to review some now",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G END:$D(DIRUT)!('Y)
"RTN","FBAAPP",10,0)
RDIN W ! S FBAAOUT=0,DIC="^FBAA(162.1,",DIC(0)="AEQ",DIC("S")="S ZZ=^(0) I $P(ZZ,U,5)=1&($D(^FBAA(162.1,+ZZ,""RX"",""AC"",1))) K ZZ" D ^DIC K DIC G END:X=""!(X="^"),HELPI^FBAAPP0:X["?" S FBJ=+Y
"RTN","FBAAPP",11,0)
 L +^FBAA(162.1,"AC",1,FBJ):1 G:'$T ALRDY^FBAAPP0 I $D(^FBAA(162.1,FBJ,"RX","AC",1)) S FBK=0 F  S FBK=$O(^FBAA(162.1,FBJ,"RX","AC",1,FBK)) Q:FBK'>0!(FBAAOUT)  I $D(^FBAA(162.1,FBJ,"RX",FBK,0)) S FBY(0)=^(0) D GOT,CHK:$D(^FBAA(162.1,"AC",1))
"RTN","FBAAPP",12,0)
 L -^FBAA(162.1,"AC",1,FBJ) I '$D(^FBAA(162.1,"AC",1)) W !,*7,"No more prescriptions pending review!" G END
"RTN","FBAAPP",13,0)
 G RDIN
"RTN","FBAAPP",14,0)
END K DFN,FBJ,FBK,Y,X,FBAAOUT,L,CNT,STAT,DA,DAT,DIC,FBAAGP,FBAAPR,FBDX,FDT,SSN,HY,I,T,VIFN,Z,ZZ,VAL,FBAASC,M,W,FBY,FBASSOC,FB583,FB7078,FBPROG,FBTYPE,FBDMRA,FBAUT,^TMP($J,"FBWP")
"RTN","FBAAPP",15,0)
 K FBNO1,FBNO2,FBDA,FBDRUG,PI,DIRUT,DTOUT,DUOUT
"RTN","FBAAPP",16,0)
 Q
"RTN","FBAAPP",17,0)
GOT S STAT=2,DFN=$P(FBY(0),"^",5) Q:'$D(^DPT(+DFN,0))
"RTN","FBAAPP",18,0)
 S FBPROG=$P($G(^FBAA(162.1,FBJ,"RX",FBK,2)),"^",7),FBPROG=$S(FBPROG:"I FBI="_FBPROG,1:"")
"RTN","FBAAPP",19,0)
 S HY=Y,PI="" D ^FBAADEM
"RTN","FBAAPP",20,0)
 D FBPH^FBAAUTL2 W ! F X=1:1:IOM-1 W "-"
"RTN","FBAAPP",21,0)
 I $Y+5>IOSL,$E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR Q:'Y  W @IOF
"RTN","FBAAPP",22,0)
 S Y=HY,VIFN=$P(^FBAA(162.1,FBJ,0),"^",4)
"RTN","FBAAPP",23,0)
 W !!,"Vendor: ",$P($G(^FBAAV(+VIFN,0)),"^"),!
"RTN","FBAAPP",24,0)
 I $P(FBY(0),"^",20)="R" W *7,!?20,">> PATIENT REIMBURSEMENT <<",!
"RTN","FBAAPP",25,0)
 S FDT=$P(FBY(0),"^",3) W !,"Prescription #: ",$P(FBY(0),"^"),"    Drug: ",$P(FBY(0),"^",2),!!,"Fill Date: ",$E(FDT,4,5),"/",$E(FDT,6,7),"/",$E(FDT,2,3),"    Strength: ",$P(FBY(0),"^",12)
"RTN","FBAAPP",26,0)
 W "  Qty: ",$P(FBY(0),"^",13)
"RTN","FBAAPP",27,0)
DIR ; DISPLAY FOR PHARMACY EDIT
"RTN","FBAAPP",28,0)
 S (FBAAGP,FBAAPR,FBDA,FBDRUG,FBNO1,FBNO2)="" K FBADJ,FBRRMK
"RTN","FBAAPP",29,0)
 I '$D(IOM) D HOME^%ZIS
"RTN","FBAAPP",30,0)
DIR1 S DIR("A")="Is Prescription for an Authorized Condition"
"RTN","FBAAPP",31,0)
 S DIR("B")=$S(FBNO1'="":FBNO1,1:"Yes")
"RTN","FBAAPP",32,0)
 S DIR(0)="Y",DIR("?")="A 'No' answer will deny payment."
"RTN","FBAAPP",33,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBAAPP",34,0)
 I Y S FBNO1="Yes"
"RTN","FBAAPP",35,0)
 I 'Y S FBNO1="No" D   D NO1^FBAAPP0 Q:'$D(FBADJ)  G REVIEW
"RTN","FBAAPP",36,0)
 . S (FBAAGP,FBDA,FBDRUG,FBNO2)=""
"RTN","FBAAPP",37,0)
 ;
"RTN","FBAAPP",38,0)
 S DIR("A")="Was a Generic Drug issued to patient"
"RTN","FBAAPP",39,0)
 S DIR("B")=$S(FBAAGP'="":FBAAGP,1:"Yes")
"RTN","FBAAPP",40,0)
 S DIR(0)="Y"
"RTN","FBAAPP",41,0)
 S DIR("?")="A 'No' answer alerts FEE to pay the generic equivalent, if one exists."
"RTN","FBAAPP",42,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBAAPP",43,0)
 S FBAAGP=$S(Y:"Yes",1:"No")
"RTN","FBAAPP",44,0)
 ;
"RTN","FBAAPP",45,0)
 S DIR("A")="Enter VA Generic Drug equivalent"
"RTN","FBAAPP",46,0)
 I FBDRUG'="" S DIR("B")=FBDRUG
"RTN","FBAAPP",47,0)
 S DIR("?")="Match the drug entered by FEE to an entry in the VA Drug file."
"RTN","FBAAPP",48,0)
 S DIR(0)="Pr^50:EM"
"RTN","FBAAPP",49,0)
 D ^DIR K DIR Q:$D(DIRUT)!('Y)
"RTN","FBAAPP",50,0)
 S FBDA=+Y,FBDRUG=$P(Y,"^",2)
"RTN","FBAAPP",51,0)
 ;
"RTN","FBAAPP",52,0)
 S DIR("A")="Is this an emergency medication"
"RTN","FBAAPP",53,0)
 S DIR("B")=$S(FBNO2'="":FBNO2,1:"Yes")
"RTN","FBAAPP",54,0)
 S DIR("?")="A 'No' answer will DENY payment."
"RTN","FBAAPP",55,0)
 S DIR(0)="Y"
"RTN","FBAAPP",56,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","FBAAPP",57,0)
 I Y S FBNO2="Yes" K FBADJ,FBRRMK
"RTN","FBAAPP",58,0)
 I 'Y S FBNO2="No" D NO1^FBAAPP0 Q:'$D(FBADJ)
"RTN","FBAAPP",59,0)
 ;
"RTN","FBAAPP",60,0)
REVIEW W !
"RTN","FBAAPP",61,0)
 S DIR("A")="Optional Pharmacy Remarks "
"RTN","FBAAPP",62,0)
 S:FBAAPR]"" DIR("B")=FBAAPR
"RTN","FBAAPP",63,0)
 S DIR(0)="162.11,22"
"RTN","FBAAPP",64,0)
 K DA
"RTN","FBAAPP",65,0)
 D ^DIR K DIR Q:$D(DUOUT)!($D(DTOUT))
"RTN","FBAAPP",66,0)
 S FBAAPR=Y
"RTN","FBAAPP",67,0)
 ;
"RTN","FBAAPP",68,0)
 W ! F I=1:1:IOM-2 W "-"
"RTN","FBAAPP",69,0)
 W !!?22,">>>  PRESCRIPTION REVIEW  <<<",!
"RTN","FBAAPP",70,0)
 W !,"Rx for Authorized condition: ",FBNO1
"RTN","FBAAPP",71,0)
 W ?36,"Emergency Medication: ",FBNO2
"RTN","FBAAPP",72,0)
 W !,"Generic Drug Issued: ",FBAAGP
"RTN","FBAAPP",73,0)
 W ?36,"Generic Drug Name: ",$E(FBDRUG,1,25)
"RTN","FBAAPP",74,0)
 I $D(FBADJ) D
"RTN","FBAAPP",75,0)
 . N FBI
"RTN","FBAAPP",76,0)
 . W !!,"Current list of Adjustments: "
"RTN","FBAAPP",77,0)
 . I '$O(FBADJ(0)) W "none"
"RTN","FBAAPP",78,0)
 . S FBI=0 F  S FBI=$O(FBADJ(FBI)) Q:'FBI  D
"RTN","FBAAPP",79,0)
 . . W ?30,"Code: "
"RTN","FBAAPP",80,0)
 . . W:$P(FBADJ(FBI),U)]"" $P($G(^FB(161.91,$P(FBADJ(FBI),U),0)),U)
"RTN","FBAAPP",81,0)
 . . W ?44,"Group: "
"RTN","FBAAPP",82,0)
 . . W:$P(FBADJ(FBI),U,2)]"" $P($G(^FB(161.92,$P(FBADJ(FBI),U,2),0)),U)
"RTN","FBAAPP",83,0)
 . . W ?56,"Amount: "
"RTN","FBAAPP",84,0)
 . . W "$",$FN($P(FBADJ(FBI),U,3),"",2),!
"RTN","FBAAPP",85,0)
 . W !!,"Current list of Remittance Remarks: "
"RTN","FBAAPP",86,0)
 . I '$O(FBRRMK(0)) W "none"
"RTN","FBAAPP",87,0)
 . S FBI=0 F  S FBI=$O(FBRRMK(FBI)) Q:'FBI  D
"RTN","FBAAPP",88,0)
 . . W:$P(FBRRMK(FBI),U)]"" $P($G(^FB(161.93,$P(FBRRMK(FBI),U),0)),U),", "
"RTN","FBAAPP",89,0)
 W !!,"Optional Pharmacy Remarks: ",FBAAPR
"RTN","FBAAPP",90,0)
 ;
"RTN","FBAAPP",91,0)
 W !
"RTN","FBAAPP",92,0)
 S DIR("A")="Want to edit prior to release"
"RTN","FBAAPP",93,0)
 S DIR(0)="Y",DIR("B")="No"
"RTN","FBAAPP",94,0)
 D ^DIR K DIR Q:$D(DIRUT)  G DIR1:Y
"RTN","FBAAPP",95,0)
 ;
"RTN","FBAAPP",96,0)
 I $D(FBADJ) G GOON^FBAAPP0
"RTN","FBAAPP",97,0)
 S $P(FBY(0),"^",10)=FBDA
"RTN","FBAAPP",98,0)
 S $P(FBY(0),"^",11)=1
"RTN","FBAAPP",99,0)
 S $P(FBY(0),"^",14)=DUZ
"RTN","FBAAPP",100,0)
 S $P(FBY(0),"^",15)=DT
"RTN","FBAAPP",101,0)
 S $P(FBY(0),"^",9)=2
"RTN","FBAAPP",102,0)
 G RSET^FBAAPP0
"RTN","FBAAPP",103,0)
 ;
"RTN","FBAAPP",104,0)
CHK S FBAAOUT=0 W ! S DIR("A")="Want to review another Prescription",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR S:'Y FBAAOUT=1 K ^TMP($J,"FBWP"),FBDRUG
"RTN","FBAAPP",105,0)
 Q
"RTN","FBAAPP0")
0^2^B4309645
"RTN","FBAAPP0",1,0)
FBAAPP0 ;AISC/GRR-ENTER FEE PHARMACY DETERMINATION CONT ;4/27/2005
"RTN","FBAAPP0",2,0)
 ;;3.5;FEE BASIS;**61,91**;JAN 30, 1995
"RTN","FBAAPP0",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBAAPP0",4,0)
HELPI W !!,"Enter Invoice number you wish to make a determination on.  Must",!,"be an invoice which is 'Pending Determination' status." G RDIN^FBAAPP
"RTN","FBAAPP0",5,0)
ALRDY W !,*7,"Someone is editing that invoice now!" G RDIN^FBAAPP
"RTN","FBAAPP0",6,0)
 ;
"RTN","FBAAPP0",7,0)
NO1 ;ASK PHARMACIST TO SPECIFY ADJUSTMENT REASON
"RTN","FBAAPP0",8,0)
 N FBX
"RTN","FBAAPP0",9,0)
 ; prompt for adjustments
"RTN","FBAAPP0",10,0)
 S FBX=$$ADJ^FBUTL2($P(FBY(0),U,4),.FBADJ,2) Q:FBX=0
"RTN","FBAAPP0",11,0)
 ; prompt for remittance remarks
"RTN","FBAAPP0",12,0)
 S FBX=$$RR^FBUTL4(.FBRRMK,2) Q:FBX=0
"RTN","FBAAPP0",13,0)
 Q
"RTN","FBAAPP0",14,0)
 ;
"RTN","FBAAPP0",15,0)
GOON ; entry point when prescription was denied by pharmacy
"RTN","FBAAPP0",16,0)
 S STAT=3,$P(FBY(0),"^",11)=0,$P(FBY(0),"^",14)=DUZ,$P(FBY(0),"^",15)=DT,$P(FBY(0),"^",9)=3,$P(FBY(0),"^",16)=0
"RTN","FBAAPP0",17,0)
RSET ; entry point when prescription was not denied by pharmacy
"RTN","FBAAPP0",18,0)
 S $P(FBY(0),"^",21)=$S(FBAAGP="Yes":"Y",FBAAGP="No":"N",1:"")
"RTN","FBAAPP0",19,0)
 S $P(FBY(0),"^",22)=FBAAPR
"RTN","FBAAPP0",20,0)
 S ^FBAA(162.1,FBJ,"RX",FBK,0)=FBY(0)
"RTN","FBAAPP0",21,0)
 K ^FBAA(162.1,FBJ,"RX","AC",1,FBK) S ^FBAA(162.1,FBJ,"RX","AC",STAT,FBK)="",$P(^FBAA(162.1,FBJ,0),"^",5)=$S($D(^FBAA(162.1,FBJ,"RX","AC",1)):1,$D(^(2)):2,$D(^(3)):3,1:0)
"RTN","FBAAPP0",22,0)
 I '$D(^FBAA(162.1,FBJ,"RX","AC",1)) K ^FBAA(162.1,"AC",1,FBJ) S ^FBAA(162.1,"AC",2,FBJ)=""
"RTN","FBAAPP0",23,0)
 I $D(FBADJ) D
"RTN","FBAAPP0",24,0)
 . D FILEADJ^FBRXFA(FBK_","_FBJ_",",.FBADJ) ; file adjustments
"RTN","FBAAPP0",25,0)
 . D FILERR^FBRXFR(FBK_","_FBJ_",",.FBRRMK) ; file remittance remarks
"RTN","FBAAPP0",26,0)
 Q
"RTN","FBXIP91")
0^^B2776129
"RTN","FBXIP91",1,0)
FBXIP91 ;WCIOFO/SAB-PATCH INSTALL ROUTINE ;4/28/2005
"RTN","FBXIP91",2,0)
 ;;3.5;FEE BASIS;**91**;JAN 30, 1995
"RTN","FBXIP91",3,0)
 Q
"RTN","FBXIP91",4,0)
 ;
"RTN","FBXIP91",5,0)
PS ; post-install entry point
"RTN","FBXIP91",6,0)
 ; create KIDS checkpoints with call backs
"RTN","FBXIP91",7,0)
 N FBX,Y
"RTN","FBXIP91",8,0)
 F FBX="CVT" D
"RTN","FBXIP91",9,0)
 . S Y=$$NEWCP^XPDUTL(FBX,FBX_"^FBXIP91")
"RTN","FBXIP91",10,0)
 . I 'Y D BMES^XPDUTL("ERROR Creating "_FBX_" Checkpoint.")
"RTN","FBXIP91",11,0)
 Q
"RTN","FBXIP91",12,0)
 ;
"RTN","FBXIP91",13,0)
CVT ; Fix Invalid Data in Field #8.5 within the PRESCRIPTION muliple
"RTN","FBXIP91",14,0)
 ; of file 162.1
"RTN","FBXIP91",15,0)
 N FBC,FB85I,FBDA,FBDA1,FBFDA,FBTXT,FBX
"RTN","FBXIP91",16,0)
 D BMES^XPDUTL("  Fixing data in SubFile 162.11 Field #8.5...")
"RTN","FBXIP91",17,0)
 ;
"RTN","FBXIP91",18,0)
 S FBC=0 ; init count of corrected values
"RTN","FBXIP91",19,0)
 ; loop thru pharmacy invoices
"RTN","FBXIP91",20,0)
 S FBDA=0 F  S FBDA=$O(^FBAA(162.1,FBDA)) Q:'FBDA  D
"RTN","FBXIP91",21,0)
 . ; loop thru prescriptions
"RTN","FBXIP91",22,0)
 . S FBDA1=0 F  S FBDA1=$O(^FBAA(162.1,FBDA,"RX",FBDA1)) Q:'FBDA1  D
"RTN","FBXIP91",23,0)
 . . ; obtain internal value of field #8.5
"RTN","FBXIP91",24,0)
 . . S FB85I=$P($G(^FBAA(162.1,FBDA,"RX",FBDA1,0)),U,21)
"RTN","FBXIP91",25,0)
 . . S FBX=$S(FB85I="Yes":"Y",FB85I="No":"N",1:"")
"RTN","FBXIP91",26,0)
 . . Q:FBX=""  ; not one of the values that should be converted
"RTN","FBXIP91",27,0)
 . . S FBFDA(162.11,FBDA1_","_FBDA_",",8.5)=FBX
"RTN","FBXIP91",28,0)
 . . D FILE^DIE("","FBFDA")
"RTN","FBXIP91",29,0)
 . . S FBC=FBC+1
"RTN","FBXIP91",30,0)
 ;
"RTN","FBXIP91",31,0)
 S FBTXT="    "_FBC_" invalid value"_$S(FBC=1:" was",1:"s were")_" found and corrected."
"RTN","FBXIP91",32,0)
 D MES^XPDUTL(FBTXT)
"RTN","FBXIP91",33,0)
 Q
"RTN","FBXIP91",34,0)
 ;
"RTN","FBXIP91",35,0)
 ;FBXIP91
"UP",162.1,162.11,-1)
162.1^RX
"UP",162.1,162.11,0)
162.11
"VER")
8.0^22.0
"^DD",162.1,162.11,8.5,0)
SUBSTITUTE GENERIC DRUG^S^Y:YES;N:NO;^0;21^Q
"^DD",162.1,162.11,8.5,21,0)
^^2^2^2901105^^
"^DD",162.1,162.11,8.5,21,1,0)
This field shows if a generic drug was or could have been
"^DD",162.1,162.11,8.5,21,2,0)
dispensed to the patient.
"^DD",162.1,162.11,8.5,"DT")
3050420
"BLD",6113,6)
^SEQ #80
**END**
**END**
