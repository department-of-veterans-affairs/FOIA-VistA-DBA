Released PX*1*108 SEQ #94
Extracted from mail message
**KIDS**:PX*1.0*108^

**INSTALL NAME**
PX*1.0*108
"BLD",3471,0)
PX*1.0*108^PCE PATIENT CARE ENCOUNTER^0^3021205^y
"BLD",3471,1,0)
^^9^9^3021205^^^^
"BLD",3471,1,1,0)
Correctly evaluate and display different formats of CPT codes when entered
"BLD",3471,1,2,0)
separately or as multiple. Additionally prompts for the provider and other
"BLD",3471,1,3,0)
entries, related to the selected procedure, when procedures are entered as
"BLD",3471,1,4,0)
multiple.
"BLD",3471,1,5,0)
Calls for a list of providers for an encounter were redesigned to return
"BLD",3471,1,6,0)
the correct list without duplicates, if any. Also, the PCE will not change
"BLD",3471,1,7,0)
the primary provider if not requested.
"BLD",3471,1,8,0)

"BLD",3471,1,9,0)

"BLD",3471,4,0)
^9.64PA^^
"BLD",3471,"ABPKG")
n
"BLD",3471,"KRN",0)
^9.67PA^19^17
"BLD",3471,"KRN",.4,0)
.4
"BLD",3471,"KRN",.401,0)
.401
"BLD",3471,"KRN",.402,0)
.402
"BLD",3471,"KRN",.403,0)
.403
"BLD",3471,"KRN",.5,0)
.5
"BLD",3471,"KRN",.84,0)
.84
"BLD",3471,"KRN",3.6,0)
3.6
"BLD",3471,"KRN",3.8,0)
3.8
"BLD",3471,"KRN",9.2,0)
9.2
"BLD",3471,"KRN",9.8,0)
9.8
"BLD",3471,"KRN",9.8,"NM",0)
^9.68A^19^19
"BLD",3471,"KRN",9.8,"NM",1,0)
PXBGCPT2^^0^B35375264
"BLD",3471,"KRN",9.8,"NM",2,0)
PXBPMOD^^0^B5449916
"BLD",3471,"KRN",9.8,"NM",3,0)
PXBDCPT^^0^B33120266
"BLD",3471,"KRN",9.8,"NM",4,0)
PXBGCPT4^^0^B23123146
"BLD",3471,"KRN",9.8,"NM",5,0)
PXAIPOV^^0^B19125556
"BLD",3471,"KRN",9.8,"NM",6,0)
PXBMPOV^^0^B6677265
"BLD",3471,"KRN",9.8,"NM",7,0)
PXAIPRV^^0^B20971203
"BLD",3471,"KRN",9.8,"NM",8,0)
PXBMPRV^^0^B4831068
"BLD",3471,"KRN",9.8,"NM",9,0)
PXAPIOE^^0^B22906630
"BLD",3471,"KRN",9.8,"NM",10,0)
PXBPCPT1^^0^B20077533
"BLD",3471,"KRN",9.8,"NM",11,0)
PXBPPRV^^0^B33427447
"BLD",3471,"KRN",9.8,"NM",12,0)
PXBGPRV^^0^B42937330
"BLD",3471,"KRN",9.8,"NM",13,0)
PXBUTL^^0^B26167434
"BLD",3471,"KRN",9.8,"NM",14,0)
PXBMCPT^^0^B16530875
"BLD",3471,"KRN",9.8,"NM",15,0)
PXBUTL0^^0^B28032772
"BLD",3471,"KRN",9.8,"NM",16,0)
PXBMCPT2^^0^B11433435
"BLD",3471,"KRN",9.8,"NM",17,0)
PXKENC^^0^B23082331
"BLD",3471,"KRN",9.8,"NM",18,0)
PXAICPT^^0^B17272681
"BLD",3471,"KRN",9.8,"NM",19,0)
PXBDPRV^^0^B24451562
"BLD",3471,"KRN",9.8,"NM","B","PXAICPT",18)

"BLD",3471,"KRN",9.8,"NM","B","PXAIPOV",5)

"BLD",3471,"KRN",9.8,"NM","B","PXAIPRV",7)

"BLD",3471,"KRN",9.8,"NM","B","PXAPIOE",9)

"BLD",3471,"KRN",9.8,"NM","B","PXBDCPT",3)

"BLD",3471,"KRN",9.8,"NM","B","PXBDPRV",19)

"BLD",3471,"KRN",9.8,"NM","B","PXBGCPT2",1)

"BLD",3471,"KRN",9.8,"NM","B","PXBGCPT4",4)

"BLD",3471,"KRN",9.8,"NM","B","PXBGPRV",12)

"BLD",3471,"KRN",9.8,"NM","B","PXBMCPT",14)

"BLD",3471,"KRN",9.8,"NM","B","PXBMCPT2",16)

"BLD",3471,"KRN",9.8,"NM","B","PXBMPOV",6)

"BLD",3471,"KRN",9.8,"NM","B","PXBMPRV",8)

"BLD",3471,"KRN",9.8,"NM","B","PXBPCPT1",10)

"BLD",3471,"KRN",9.8,"NM","B","PXBPMOD",2)

"BLD",3471,"KRN",9.8,"NM","B","PXBPPRV",11)

"BLD",3471,"KRN",9.8,"NM","B","PXBUTL",13)

"BLD",3471,"KRN",9.8,"NM","B","PXBUTL0",15)

"BLD",3471,"KRN",9.8,"NM","B","PXKENC",17)

"BLD",3471,"KRN",19,0)
19
"BLD",3471,"KRN",19,"NM",0)
^9.68A^^
"BLD",3471,"KRN",19.1,0)
19.1
"BLD",3471,"KRN",101,0)
101
"BLD",3471,"KRN",409.61,0)
409.61
"BLD",3471,"KRN",771,0)
771
"BLD",3471,"KRN",870,0)
870
"BLD",3471,"KRN",8994,0)
8994
"BLD",3471,"KRN","B",.4,.4)

"BLD",3471,"KRN","B",.401,.401)

"BLD",3471,"KRN","B",.402,.402)

"BLD",3471,"KRN","B",.403,.403)

"BLD",3471,"KRN","B",.5,.5)

"BLD",3471,"KRN","B",.84,.84)

"BLD",3471,"KRN","B",3.6,3.6)

"BLD",3471,"KRN","B",3.8,3.8)

"BLD",3471,"KRN","B",9.2,9.2)

"BLD",3471,"KRN","B",9.8,9.8)

"BLD",3471,"KRN","B",19,19)

"BLD",3471,"KRN","B",19.1,19.1)

"BLD",3471,"KRN","B",101,101)

"BLD",3471,"KRN","B",409.61,409.61)

"BLD",3471,"KRN","B",771,771)

"BLD",3471,"KRN","B",870,870)

"BLD",3471,"KRN","B",8994,8994)

"BLD",3471,"QUES",0)
^9.62^^
"BLD",3471,"REQB",0)
^9.611^1^1
"BLD",3471,"REQB",1,0)
PX*1.0*89^2
"BLD",3471,"REQB","B","PX*1.0*89",1)

"MBREQ")
0
"PKG",413,-1)
1^1
"PKG",413,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)^
"PKG",413,20,0)
^9.402P^^
"PKG",413,22,0)
^9.49I^1^1
"PKG",413,22,1,0)
1.0^2960812^2960913^12537
"PKG",413,22,1,"PAH",1,0)
108^3021205^100892
"PKG",413,22,1,"PAH",1,1,0)
^^9^9^3021205
"PKG",413,22,1,"PAH",1,1,1,0)
Correctly evaluate and display different formats of CPT codes when entered
"PKG",413,22,1,"PAH",1,1,2,0)
separately or as multiple. Additionally prompts for the provider and other
"PKG",413,22,1,"PAH",1,1,3,0)
entries, related to the selected procedure, when procedures are entered as
"PKG",413,22,1,"PAH",1,1,4,0)
multiple.
"PKG",413,22,1,"PAH",1,1,5,0)
Calls for a list of providers for an encounter were redesigned to return
"PKG",413,22,1,"PAH",1,1,6,0)
the correct list without duplicates, if any. Also, the PCE will not change
"PKG",413,22,1,"PAH",1,1,7,0)
the primary provider if not requested.
"PKG",413,22,1,"PAH",1,1,8,0)

"PKG",413,22,1,"PAH",1,1,9,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
19
"RTN","PXAICPT")
0^18^B17272681
"RTN","PXAICPT",1,0)
PXAICPT ;ISL/JVS,ISA/KWP,ESW - SET THE PROCEDURE(CPT) NODES ; 10/31/02 12:00pm
"RTN","PXAICPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**19,73,108**;Aug 12, 1996
"RTN","PXAICPT",3,0)
 ;
"RTN","PXAICPT",4,0)
 ;
"RTN","PXAICPT",5,0)
 Q
"RTN","PXAICPT",6,0)
CPT ;--CREAT PROVIDERS
"RTN","PXAICPT",7,0)
 ;
"RTN","PXAICPT",8,0)
 ;
"RTN","PXAICPT",9,0)
SET ;--SET AND NEW VARIABLES
"RTN","PXAICPT",10,0)
 N AFTER0,AFTER1,AFTER12,AFTER801,AFTER802,AFTER811,AFTER812
"RTN","PXAICPT",11,0)
 N BEFOR0,BEFOR1,BEFOR12,BEFOR801,BEFOR802,BEFOR811,BEFOR812
"RTN","PXAICPT",12,0)
 N PXAA,PXAB,SUB,PIECE,PXAAX,IENB,STOP
"RTN","PXAICPT",13,0)
 ;New Modifier Variables
"RTN","PXAICPT",14,0)
 D SET^PXAIMOD
"RTN","PXAICPT",15,0)
 K PXAERR
"RTN","PXAICPT",16,0)
 S PXAERR(8)=PXAK
"RTN","PXAICPT",17,0)
 S PXAERR(7)="PROCEDURE"
"RTN","PXAICPT",18,0)
 ;
"RTN","PXAICPT",19,0)
 S SUB="" F  S SUB=$O(@PXADATA@("PROCEDURE",PXAK,SUB)) Q:SUB=""  D
"RTN","PXAICPT",20,0)
 .S PXAA(SUB)=$G(@PXADATA@("PROCEDURE",PXAK,SUB))
"RTN","PXAICPT",21,0)
 ;Setup PXAA array for Modifiers
"RTN","PXAICPT",22,0)
 S SUB=""
"RTN","PXAICPT",23,0)
 F  S SUB=$O(@PXADATA@("PROCEDURE",PXAK,"MODIFIERS",SUB)) Q:SUB=""  D
"RTN","PXAICPT",24,0)
 .S PXAA("MODIFIERS",SUB)=""
"RTN","PXAICPT",25,0)
 ;
"RTN","PXAICPT",26,0)
VAL ;--VALIDATE ENOUGH DATA
"RTN","PXAICPT",27,0)
 D VAL^PXAICPTV Q:$G(STOP)
"RTN","PXAICPT",28,0)
 ;
"RTN","PXAICPT",29,0)
 ;
"RTN","PXAICPT",30,0)
SETVARA ;--SET VISIT VARIABLES
"RTN","PXAICPT",31,0)
 S $P(AFTER0,"^",1)=$G(PXAA("PROCEDURE"))
"RTN","PXAICPT",32,0)
 I $G(PXAA("DELETE")) S $P(AFTER0,"^",1)="@"
"RTN","PXAICPT",33,0)
 S $P(AFTER0,"^",2)=$G(PATIENT)
"RTN","PXAICPT",34,0)
 S $P(AFTER0,"^",3)=$G(PXAVISIT)
"RTN","PXAICPT",35,0)
 S $P(AFTER0,"^",4)=$G(PXAA("NARRATIVE")) D
"RTN","PXAICPT",36,0)
 .I $G(PXAA("NARRATIVE"))']""!($L($G(PXAA("NARRATIVE")))>245) D
"RTN","PXAICPT",37,0)
 ..S $P(AFTER0,"^",4)=$$EXTTEXT^PXUTL1($G(PXAA("PROCEDURE")),1,81,2) ;--TEXT OF NARRATIVE
"RTN","PXAICPT",38,0)
 .I $G(PXAA("NARRATIVE"))]"" S $P(AFTER0,"^",4)=+$$PROVNARR^PXAPI($G(PXAA("NARRATIVE")),9000010.18)
"RTN","PXAICPT",39,0)
 I $P(AFTER0,"^",4)<0 D VAL04^PXAICPTV,ERR^PXAI Q:$D(STOP)
"RTN","PXAICPT",40,0)
 S $P(AFTER0,"^",5)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAICPT",41,0)
 I $G(PXAA("QTY"))="" S PXAA("QTY")=1
"RTN","PXAICPT",42,0)
 S $P(AFTER0,"^",16)=$G(PXAA("QTY")) I $G(PXAA("QTY"))<1 S PXAA("DELETE")=1
"RTN","PXAICPT",43,0)
 ;Set Modifier nodes in AFTER1
"RTN","PXAICPT",44,0)
 D SETVARA^PXAIMOD
"RTN","PXAICPT",45,0)
 ;
"RTN","PXAICPT",46,0)
 S $P(AFTER12,"^",1)=$G(PXAA("EVENT D/T"))
"RTN","PXAICPT",47,0)
 S $P(AFTER12,"^",4)=$G(PXAA("ENC PROVIDER"))
"RTN","PXAICPT",48,0)
 ;PX*1*108 - do not try to file a provider from a "DELETED" cpt
"RTN","PXAICPT",49,0)
 I $G(PXAA("ENC PROVIDER"))]"",'$G(PXAA("DELETE")) D
"RTN","PXAICPT",50,0)
 .S ^TMP("PXAIADDPRV",$J,$G(PXAA("ENC PROVIDER")))=""
"RTN","PXAICPT",51,0)
 ;
"RTN","PXAICPT",52,0)
 S $P(AFTER802,"^",1)=$G(PXAA("CATEGORY"))
"RTN","PXAICPT",53,0)
 I $G(PXAA("CATEGORY"))]"" S $P(AFTER802,"^",1)=+$$PROVNARR^PXAPI($G(PXAA("CATEGORY")),9000010.18)
"RTN","PXAICPT",54,0)
 I $P(AFTER802,"^",1)<0 D VAL45^PXAICPTV,ERR^PXAI Q:$D(STOP)
"RTN","PXAICPT",55,0)
 S $P(AFTER811,"^",1)=$G(PXAA("COMMENT"))
"RTN","PXAICPT",56,0)
 ;
"RTN","PXAICPT",57,0)
 ;
"RTN","PXAICPT",58,0)
 ;
"RTN","PXAICPT",59,0)
 ;--PACKAGE AND SOURCE
"RTN","PXAICPT",60,0)
 ;
"RTN","PXAICPT",61,0)
 S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAICPT",62,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAICPT",63,0)
 ;
"RTN","PXAICPT",64,0)
SETPXKA ;--SET PXK ARRAY AFTER
"RTN","PXAICPT",65,0)
 S ^TMP("PXK",$J,"CPT",PXAK,0,"AFTER")=AFTER0
"RTN","PXAICPT",66,0)
 ;Set ^TMP("PXK",$J,"CPT",PXAK,1,ien,"AFTER")=MODIEN
"RTN","PXAICPT",67,0)
 D SETPXKA^PXAIMOD
"RTN","PXAICPT",68,0)
 S ^TMP("PXK",$J,"CPT",PXAK,12,"AFTER")=AFTER12
"RTN","PXAICPT",69,0)
 S ^TMP("PXK",$J,"CPT",PXAK,802,"AFTER")=AFTER802
"RTN","PXAICPT",70,0)
 S ^TMP("PXK",$J,"CPT",PXAK,811,"AFTER")=AFTER811
"RTN","PXAICPT",71,0)
 S ^TMP("PXK",$J,"CPT",PXAK,812,"AFTER")=AFTER812
"RTN","PXAICPT",72,0)
 ;
"RTN","PXAICPT",73,0)
SETVARB ;--SET VARIABLES BEFORE
"RTN","PXAICPT",74,0)
 D
"RTN","PXAICPT",75,0)
 .N PXBKY,PXBSAM,PXBSKY,PXBCNT,PXI,PRV,ITEM
"RTN","PXAICPT",76,0)
 .D CPT^PXBGCPT(PXAVISIT)
"RTN","PXAICPT",77,0)
 .S PXAAX("PROCEDURE")=$P($G(^ICPT($G(PXAA("PROCEDURE")),0)),"^",1)
"RTN","PXAICPT",78,0)
 .I $G(PXAA("DELETE"))=1 S PXAAX("PROCEDURE")=$P($G(^ICPT($G(PXAA("PROCEDURE")),0)),"^",1)
"RTN","PXAICPT",79,0)
 .S ITEM=""
"RTN","PXAICPT",80,0)
 .I PXBCNT>0,$G(PXAAX("PROCEDURE"))]"" S ITEM=$O(PXBKY(PXAAX("PROCEDURE"),0))
"RTN","PXAICPT",81,0)
 .I ITEM]"" D
"RTN","PXAICPT",82,0)
 ..;--LOOK UP USING CPT AND PROVIDER
"RTN","PXAICPT",83,0)
 ..I '$G(PXAA("ENC PROVIDER")) Q
"RTN","PXAICPT",84,0)
 ..S PXI="" F  S PXI=$O(PXBKY(PXAAX("PROCEDURE"),PXI)) Q:PXI=""  D
"RTN","PXAICPT",85,0)
 ...S PRV=$P(^VA(200,$G(PXAA("ENC PROVIDER")),0),"^",1)
"RTN","PXAICPT",86,0)
 ...I $P($G(PXBKY(PXAAX("PROCEDURE"),PXI)),"^",3)=PRV D
"RTN","PXAICPT",87,0)
 ....S (^TMP("PXK",$J,"CPT",PXAK,"IEN"),IENB)=$O(PXBSKY(PXI,0))
"RTN","PXAICPT",88,0)
 I $G(IENB) D
"RTN","PXAICPT",89,0)
 .F PIECE=0,12,802,811,812 S ^TMP("PXK",$J,"CPT",PXAK,PIECE,"BEFORE")=$G(^AUPNVCPT(IENB,PIECE))
"RTN","PXAICPT",90,0)
 .;Set ^TMP("PXK",$J,"CPT",PXAK,1,ien,"BEFORE")=MODIEN
"RTN","PXAICPT",91,0)
 .D SETVARB^PXAIMOD
"RTN","PXAICPT",92,0)
 E  D
"RTN","PXAICPT",93,0)
 .S (BEFOR0,BEFOR12,BEFOR802,BEFOR811,BEFOR812)=""
"RTN","PXAICPT",94,0)
 .;
"RTN","PXAICPT",95,0)
SETPXKB .;--SET PXK ARRAY BEFORE
"RTN","PXAICPT",96,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,0,"BEFORE")=BEFOR0
"RTN","PXAICPT",97,0)
 .;Set ^TMP("PXK",$J,"CPT",PXAK,1,ien,"BEFORE")=MODIEN
"RTN","PXAICPT",98,0)
 .D SETPXKB^PXAIMOD
"RTN","PXAICPT",99,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,12,"BEFORE")=BEFOR12
"RTN","PXAICPT",100,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,802,"BEFORE")=BEFOR802
"RTN","PXAICPT",101,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,811,"BEFORE")=BEFOR811
"RTN","PXAICPT",102,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,812,"BEFORE")=BEFOR812
"RTN","PXAICPT",103,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,"IEN")=""
"RTN","PXAICPT",104,0)
 ;
"RTN","PXAICPT",105,0)
MISC ;--MISCELLANEOUS NODE
"RTN","PXAICPT",106,0)
 ;
"RTN","PXAICPT",107,0)
 Q
"RTN","PXAIPOV")
0^5^B19125556
"RTN","PXAIPOV",1,0)
PXAIPOV ;ISL/JVS,ESW - SET THE DIAGNOSIS/PROBLEM LIST NODES ; 10/31/02 12:01pm
"RTN","PXAIPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**28,73,69,108**;Aug 12, 1996
"RTN","PXAIPOV",3,0)
 ;
"RTN","PXAIPOV",4,0)
 Q
"RTN","PXAIPOV",5,0)
POV ;--CREATE DIAGNOSIS
"RTN","PXAIPOV",6,0)
 ;
"RTN","PXAIPOV",7,0)
SET ;--SET AND NEW VARIABLES
"RTN","PXAIPOV",8,0)
 N AFTER0,AFTER12,AFTER800,AFTER801,AFTER811,AFTER802,AFTER812
"RTN","PXAIPOV",9,0)
 N BEFOR0,BEFOR12,BEFOR800,BEFOR801,BEFOR811,BEFOR802,BEFOR812
"RTN","PXAIPOV",10,0)
 N PXAA,PXAB,SUB,PIECE,PXAAX,IENB,STOP,VAR,AFTER8A
"RTN","PXAIPOV",11,0)
 N FPRI,J,LNARR,GMPSAVED,NOPLLIST,PXDIGNS,VAR,PRI
"RTN","PXAIPOV",12,0)
 N POVI,PRVDR,PXBCNT,PXBCNTPL,PXBKY,PXBPMT,PXBSAM,PXBSKY,PXKDONE
"RTN","PXAIPOV",13,0)
 ;
"RTN","PXAIPOV",14,0)
 K PXAERR
"RTN","PXAIPOV",15,0)
 S PXAERR(8)=PXAK
"RTN","PXAIPOV",16,0)
 S PXAERR(7)="DX/PL"
"RTN","PXAIPOV",17,0)
 ;
"RTN","PXAIPOV",18,0)
 S SUB="" F  S SUB=$O(@PXADATA@("DX/PL",PXAK,SUB)) Q:SUB=""  D
"RTN","PXAIPOV",19,0)
 .S PXAA(SUB)=@PXADATA@("DX/PL",PXAK,SUB)
"RTN","PXAIPOV",20,0)
 ;
"RTN","PXAIPOV",21,0)
 ;--VALIDATE ENOUGH DATA
"RTN","PXAIPOV",22,0)
 D VAL^PXAIPOVV Q:$G(STOP)
"RTN","PXAIPOV",23,0)
 ;
"RTN","PXAIPOV",24,0)
SETVARA ;--SET VISIT VARIABLES
"RTN","PXAIPOV",25,0)
 S $P(AFTER0,"^",1)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIPOV",26,0)
 I $G(PXAA("DELETE")) S $P(AFTER0,"^",1)="@"
"RTN","PXAIPOV",27,0)
 S $P(AFTER0,"^",2)=$G(PATIENT),PXAA("PATIENT")=$G(PATIENT)
"RTN","PXAIPOV",28,0)
 S $P(AFTER0,"^",3)=$G(PXAVISIT)
"RTN","PXAIPOV",29,0)
 S $P(AFTER0,"^",4)=$G(PXAA("NARRATIVE")) D
"RTN","PXAIPOV",30,0)
 .I $G(PXAA("NARRATIVE"))']""!($L($G(PXAA("NARRATIVE")))>245) D
"RTN","PXAIPOV",31,0)
 ..S PXAA("NARRATIVE")=$$EXTTEXT^PXUTL1($G(PXAA("DIAGNOSIS")),1,80,10,3) ;--TEXT OF NARRATIVE
"RTN","PXAIPOV",32,0)
 .S $P(AFTER0,"^",4)=+$$PROVNARR^PXAPI($G(PXAA("NARRATIVE")),9000010.07)
"RTN","PXAIPOV",33,0)
 S $P(AFTER0,"^",12)=$S($G(PXAA("PRIMARY"))=1:"P",1:"S")
"RTN","PXAIPOV",34,0)
 ;--ADDED FOR PATCH 28
"RTN","PXAIPOV",35,0)
 S $P(AFTER0,"^",15)=$G(PXAA("LEXICON TERM"))
"RTN","PXAIPOV",36,0)
 S $P(AFTER0,"^",16)=$G(PXAA("PL IEN"))
"RTN","PXAIPOV",37,0)
 ;--END OF NEW PATCH 28
"RTN","PXAIPOV",38,0)
 S $P(AFTER12,"^",1)=$G(PXAA("EVENT D/T"))
"RTN","PXAIPOV",39,0)
 S $P(AFTER12,"^",4)=$G(PXAA("ENC PROVIDER"))
"RTN","PXAIPOV",40,0)
 ;PX*1*108
"RTN","PXAIPOV",41,0)
 I $G(PXAA("ENC PROVIDER"))]"",'$G(PXAA("DELETE")) D
"RTN","PXAIPOV",42,0)
 .S ^TMP("PXAIADDPRV",$J,$G(PXAA("ENC PROVIDER")))=""
"RTN","PXAIPOV",43,0)
 ;
"RTN","PXAIPOV",44,0)
 I $G(PXAA("CATEGORY"))]"" S $P(AFTER802,"^",1)=+$$PROVNARR^PXAPI($G(PXAA("CATEGORY")),9000010.07)
"RTN","PXAIPOV",45,0)
 S $P(AFTER811,"^",1)=$G(PXAA("COMMENT"))
"RTN","PXAIPOV",46,0)
 ;
"RTN","PXAIPOV",47,0)
 ;
"RTN","PXAIPOV",48,0)
 ;
"RTN","PXAIPOV",49,0)
 ;
"RTN","PXAIPOV",50,0)
 S $P(AFTER800,"^",1)=$G(PXAA("PL SC"))
"RTN","PXAIPOV",51,0)
 S $P(AFTER800,"^",2)=$G(PXAA("PL AO"))
"RTN","PXAIPOV",52,0)
 S $P(AFTER800,"^",3)=$G(PXAA("PL IR"))
"RTN","PXAIPOV",53,0)
 S $P(AFTER800,"^",4)=$G(PXAA("PL EC"))
"RTN","PXAIPOV",54,0)
 ;
"RTN","PXAIPOV",55,0)
 ;
"RTN","PXAIPOV",56,0)
 ;
"RTN","PXAIPOV",57,0)
 D SCC^PXUTLSCC(PATIENT,$P($G(^AUPNVSIT(PXAVISIT,0)),"^",1),$P($G(^AUPNVSIT(PXAVISIT,0)),"^",22),$G(PXAVISIT),AFTER800,.AFTER800)
"RTN","PXAIPOV",58,0)
 ;
"RTN","PXAIPOV",59,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAIPOV",60,0)
 S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAIPOV",61,0)
 ;
"RTN","PXAIPOV",62,0)
 D PL^PXAIPL
"RTN","PXAIPOV",63,0)
 ;
"RTN","PXAIPOV",64,0)
 ;
"RTN","PXAIPOV",65,0)
SETPXKA ;--SET PXK ARRAY AFTER
"RTN","PXAIPOV",66,0)
 S ^TMP("PXK",$J,"POV",PXAK,0,"AFTER")=$G(AFTER0)
"RTN","PXAIPOV",67,0)
 S ^TMP("PXK",$J,"POV",PXAK,12,"AFTER")=$G(AFTER12)
"RTN","PXAIPOV",68,0)
 S ^TMP("PXK",$J,"POV",PXAK,800,"AFTER")=$G(AFTER800)
"RTN","PXAIPOV",69,0)
 S ^TMP("PXK",$J,"POV",PXAK,802,"AFTER")=$G(AFTER802)
"RTN","PXAIPOV",70,0)
 S ^TMP("PXK",$J,"POV",PXAK,811,"AFTER")=$G(AFTER811)
"RTN","PXAIPOV",71,0)
 S ^TMP("PXK",$J,"POV",PXAK,812,"AFTER")=$G(AFTER812)
"RTN","PXAIPOV",72,0)
 ;
"RTN","PXAIPOV",73,0)
SETVARB ;--SET VARIABLES BEFORE
"RTN","PXAIPOV",74,0)
 ;
"RTN","PXAIPOV",75,0)
 ;--GET IEN FOR 'PXK NODE'
"RTN","PXAIPOV",76,0)
 D POV^PXBGPOV(PXAVISIT)
"RTN","PXAIPOV",77,0)
 I $D(^TMP("PXBGPOVMATCH",$J,$G(PXAA("DIAGNOSIS")),PXAPKG,PXASOURC)) D
"RTN","PXAIPOV",78,0)
 .S (^TMP("PXK",$J,"POV",PXAK,"IEN"),IENB)=$O(^TMP("PXBGPOVMATCH",$J,$G(PXAA("DIAGNOSIS")),PXAPKG,PXASOURC,0))
"RTN","PXAIPOV",79,0)
 K ^TMP("PXBGPOVMATCH",$J)
"RTN","PXAIPOV",80,0)
 ;
"RTN","PXAIPOV",81,0)
BEFOR ;
"RTN","PXAIPOV",82,0)
 I $G(IENB) D
"RTN","PXAIPOV",83,0)
 .F PIECE=0,12,800,802,811 S ^TMP("PXK",$J,"POV",PXAK,PIECE,"BEFORE")=$G(^AUPNVPOV(IENB,PIECE))
"RTN","PXAIPOV",84,0)
 .K ^TMP("PXK",$J,"POV",PXAK,812)
"RTN","PXAIPOV",85,0)
 E  D
"RTN","PXAIPOV",86,0)
 .S (BEFOR0,BEFOR12,BEFOR800,BEFOR802,BEFOR811,BEFOR812)=""
"RTN","PXAIPOV",87,0)
 .;
"RTN","PXAIPOV",88,0)
SETPXKB .;--SET PXK ARRAY BEFORE
"RTN","PXAIPOV",89,0)
 .S ^TMP("PXK",$J,"POV",PXAK,0,"BEFORE")=$G(BEFOR0)
"RTN","PXAIPOV",90,0)
 .S ^TMP("PXK",$J,"POV",PXAK,12,"BEFORE")=$G(BEFOR12)
"RTN","PXAIPOV",91,0)
 .S ^TMP("PXK",$J,"POV",PXAK,800,"BEFORE")=$G(BEFOR800)
"RTN","PXAIPOV",92,0)
 .S ^TMP("PXK",$J,"POV",PXAK,802,"BEFORE")=$G(BEFOR802)
"RTN","PXAIPOV",93,0)
 .S ^TMP("PXK",$J,"POV",PXAK,811,"BEFORE")=$G(BEFOR811)
"RTN","PXAIPOV",94,0)
 .S ^TMP("PXK",$J,"POV",PXAK,812,"BEFORE")=$G(BEFOR812)
"RTN","PXAIPOV",95,0)
 .S ^TMP("PXK",$J,"POV",PXAK,"IEN")=""
"RTN","PXAIPOV",96,0)
 ;
"RTN","PXAIPOV",97,0)
MISC ;--MISCELLANEOUS NODE
"RTN","PXAIPOV",98,0)
 ;
"RTN","PXAIPOV",99,0)
 Q
"RTN","PXAIPOV",100,0)
PRIM ;--SET A PROVIDER AS PRIMARY
"RTN","PXAIPOV",101,0)
 N PXBCNT,PXBKY,PXBSAM,PXBSKY,PRVDR,FPRI ;108
"RTN","PXAIPOV",102,0)
 D PRV^PXBGPRV(PXAVISIT,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI) ;108
"RTN","PXAIPOV",103,0)
 I $D(PRVDR) Q
"RTN","PXAIPOV",104,0)
 I '$D(PXBSKY) Q
"RTN","PXAIPOV",105,0)
 ;
"RTN","PXAIPOV",106,0)
 S $P(AFTER0,"^",1)=$P(^AUPNVPRV($O(PXBSKY(1,0)),0),"^",1)
"RTN","PXAIPOV",107,0)
 S $P(AFTER0,"^",2)=$P(^AUPNVSIT(PXAVISIT,0),"^",5)
"RTN","PXAIPOV",108,0)
 S $P(AFTER0,"^",3)=PXAVISIT
"RTN","PXAIPOV",109,0)
 S $P(AFTER0,"^",4)="P"
"RTN","PXAIPOV",110,0)
 S ^TMP("PXK",$J,"PRV",22222,0,"AFTER")=AFTER0
"RTN","PXAIPOV",111,0)
 S ^TMP("PXK",$J,"PRV",22222,0,"BEFORE")=$G(^AUPNVPRV($O(PXBSKY(1,0)),0))
"RTN","PXAIPOV",112,0)
 S ^TMP("PXK",$J,"PRV",22222,"IEN")=$O(PXBSKY(1,0))
"RTN","PXAIPOV",113,0)
 D EN1^PXKMAIN
"RTN","PXAIPOV",114,0)
 K PXRDR
"RTN","PXAIPOV",115,0)
 K ^TMP("PXBGPOVMATCH",$J)
"RTN","PXAIPOV",116,0)
 Q
"RTN","PXAIPRV")
0^7^B20971203
"RTN","PXAIPRV",1,0)
PXAIPRV ;ISL/JVS,ESW - SET THE PROVIDER NODES ; 11/25/02 3:36pm
"RTN","PXAIPRV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**5,108**;Aug 12, 1996
"RTN","PXAIPRV",3,0)
 ;
"RTN","PXAIPRV",4,0)
 Q
"RTN","PXAIPRV",5,0)
PRV ;--CREAT PROVIDERS
"RTN","PXAIPRV",6,0)
 ;
"RTN","PXAIPRV",7,0)
SET ;--SET AND NEW VARIABLES
"RTN","PXAIPRV",8,0)
 N AFTER0,AFTER12,AFTER801,AFTER811,AFTER812
"RTN","PXAIPRV",9,0)
 N BEFOR0,BEFOR12,BEFOR801,BEFOR811,BEFOR812
"RTN","PXAIPRV",10,0)
 N PXAA,PXAB,SUB,PIECE,PXAAX,IENB,STOP
"RTN","PXAIPRV",11,0)
 ;
"RTN","PXAIPRV",12,0)
 K PXAERR
"RTN","PXAIPRV",13,0)
 S PXAERR(8)=PXAK
"RTN","PXAIPRV",14,0)
 S PXAERR(7)="PROVIDER"
"RTN","PXAIPRV",15,0)
 ;
"RTN","PXAIPRV",16,0)
 S SUB="" F  S SUB=$O(@PXADATA@("PROVIDER",PXAK,SUB)) Q:SUB=""  D
"RTN","PXAIPRV",17,0)
 .S PXAA(SUB)=@PXADATA@("PROVIDER",PXAK,SUB)
"RTN","PXAIPRV",18,0)
 ;
"RTN","PXAIPRV",19,0)
 ;--VALIDATE ENOUGH DATA
"RTN","PXAIPRV",20,0)
 D VAL^PXAIPRVV Q:$G(STOP)
"RTN","PXAIPRV",21,0)
 ;
"RTN","PXAIPRV",22,0)
SETVARA ;--SET VISIT VARIABLES
"RTN","PXAIPRV",23,0)
 S $P(AFTER0,"^",1)=$G(PXAA("NAME"))
"RTN","PXAIPRV",24,0)
 I $G(PXAA("DELETE")) S $P(AFTER0,"^",1)="@"
"RTN","PXAIPRV",25,0)
 S $P(AFTER0,"^",2)=$G(PATIENT)
"RTN","PXAIPRV",26,0)
 S $P(AFTER0,"^",3)=$G(PXAVISIT)
"RTN","PXAIPRV",27,0)
 S $P(AFTER0,"^",4)=$S($G(PXAA("PRIMARY"))=1:"P",1:"S")
"RTN","PXAIPRV",28,0)
 S $P(AFTER0,"^",5)=$S($G(PXAA("ATTENDING"))=1:"A",$G(PXAA("ATTENDING"))=0:"@",1:"")
"RTN","PXAIPRV",29,0)
 S $P(AFTER811,"^",1)=$G(PXAA("COMMENT"))
"RTN","PXAIPRV",30,0)
 ;
"RTN","PXAIPRV",31,0)
 ;
"RTN","PXAIPRV",32,0)
 S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAIPRV",33,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAIPRV",34,0)
 ;
"RTN","PXAIPRV",35,0)
SETPXKA ;--SET PXK ARRAY AFTER
"RTN","PXAIPRV",36,0)
 S ^TMP("PXK",$J,"PRV",PXAK,0,"AFTER")=AFTER0
"RTN","PXAIPRV",37,0)
 S ^TMP("PXK",$J,"PRV",PXAK,811,"AFTER")=AFTER811
"RTN","PXAIPRV",38,0)
 S ^TMP("PXK",$J,"PRV",PXAK,812,"AFTER")=AFTER812
"RTN","PXAIPRV",39,0)
 ;
"RTN","PXAIPRV",40,0)
SETVARB ;--SET VARIABLES BEFORE
"RTN","PXAIPRV",41,0)
 ;
"RTN","PXAIPRV",42,0)
 ;--CHECK FOR PRIMARY DESIGNATION
"RTN","PXAIPRV",43,0)
 N ITEM,PXBSKY,PXBKY,PXBSAM,PXBCNT,PRVDR,FPRI
"RTN","PXAIPRV",44,0)
 D PRV^PXBGPRV(PXAVISIT,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI)
"RTN","PXAIPRV",45,0)
 ;CHECK NAME
"RTN","PXAIPRV",46,0)
 S PXAAX("NAME")=$P($G(^VA(200,$G(PXAA("NAME")),0)),"^",1)
"RTN","PXAIPRV",47,0)
 I '$G(PXAPREDT) D
"RTN","PXAIPRV",48,0)
1 .I $D(PRVDR),$P($G(PRVDR("PRIMARY")),U)'=PXAAX("NAME") S PRI=1
"RTN","PXAIPRV",49,0)
2 .I $G(PRI) S $P(^TMP("PXK",$J,"PRV",PXAK,0,"AFTER"),"^",4)="S"
"RTN","PXAIPRV",50,0)
3 .I $G(PRI),$G(PXAA("NAME"))'["@" D VAL04^PXAIPRVV,ERR^PXAI
"RTN","PXAIPRV",51,0)
4 .I $P(AFTER0,"^",4)="P" S PRI=1
"RTN","PXAIPRV",52,0)
 ;
"RTN","PXAIPRV",53,0)
 ;--GET IEN FOR 'PXK NODE'
"RTN","PXAIPRV",54,0)
 I $G(PXAA("DELETE"))=1 S PXAAX("NAME")=$P($G(^VA(200,PXAA("NAME"),0)),"^",1)
"RTN","PXAIPRV",55,0)
 S ITEM="" I PXBCNT>0,$G(PXAAX("NAME"))]"" S ITEM=$O(PXBKY(PXAAX("NAME"),0))
"RTN","PXAIPRV",56,0)
 I ITEM]"" S (^TMP("PXK",$J,"PRV",PXAK,"IEN"),IENB)=$O(PXBSKY(ITEM,0))
"RTN","PXAIPRV",57,0)
 ;
"RTN","PXAIPRV",58,0)
 I $G(IENB) D
"RTN","PXAIPRV",59,0)
 .F PIECE=0,811,812 S ^TMP("PXK",$J,"PRV",PXAK,PIECE,"BEFORE")=$G(^AUPNVPRV(IENB,PIECE))
"RTN","PXAIPRV",60,0)
 E  D
"RTN","PXAIPRV",61,0)
 .S (BEFOR0,BEFOR811,BEFOR812)=""
"RTN","PXAIPRV",62,0)
 .;
"RTN","PXAIPRV",63,0)
SETPXKB .;--SET PXK ARRAY BEFORE
"RTN","PXAIPRV",64,0)
 .S ^TMP("PXK",$J,"PRV",PXAK,0,"BEFORE")=BEFOR0
"RTN","PXAIPRV",65,0)
 .S ^TMP("PXK",$J,"PRV",PXAK,811,"BEFORE")=BEFOR811
"RTN","PXAIPRV",66,0)
 .S ^TMP("PXK",$J,"PRV",PXAK,812,"BEFORE")=BEFOR812
"RTN","PXAIPRV",67,0)
 .S ^TMP("PXK",$J,"PRV",PXAK,"IEN")=""
"RTN","PXAIPRV",68,0)
 ;
"RTN","PXAIPRV",69,0)
MISC ;--MISCELLANEOUS NODE
"RTN","PXAIPRV",70,0)
 ;
"RTN","PXAIPRV",71,0)
 Q
"RTN","PXAIPRV",72,0)
OTHER   ;---ADD OTHER PROVIDERS TO V PROVIDER FOR OTHER ENTRIES
"RTN","PXAIPRV",73,0)
 ;
"RTN","PXAIPRV",74,0)
 ; generate data, PXBSKY(), about currently filed providers
"RTN","PXAIPRV",75,0)
 ;
"RTN","PXAIPRV",76,0)
 N PXBSKY
"RTN","PXAIPRV",77,0)
 I $G(PXAVISIT) D PRV^PXBGPRV(PXAVISIT,.PXBSKY)
"RTN","PXAIPRV",78,0)
 ;
"RTN","PXAIPRV",79,0)
 N IEN,AFTER0,CNT,PXAK,STOP,FF
"RTN","PXAIPRV",80,0)
 S IEN="",CNT=1000
"RTN","PXAIPRV",81,0)
 ;
"RTN","PXAIPRV",82,0)
 ;---^TMP("PXAIADDPRV",$J,'IEN')=""
"RTN","PXAIPRV",83,0)
 ;
"RTN","PXAIPRV",84,0)
 F  S IEN=$O(^TMP("PXAIADDPRV",$J,IEN)),CNT=CNT+1 Q:IEN=""  D
"RTN","PXAIPRV",85,0)
 .;
"RTN","PXAIPRV",86,0)
 .;verify if an entry for a provider already exists
"RTN","PXAIPRV",87,0)
 .;
"RTN","PXAIPRV",88,0)
 .S STOP=0
"RTN","PXAIPRV",89,0)
 .I $D(^TMP("PXK",$J,"PRV")) S PXAK="" D  Q:STOP
"RTN","PXAIPRV",90,0)
 ..F  S PXAK=$O(^TMP("PXK",$J,"PRV",PXAK)) Q:PXAK=""  D  Q:STOP
"RTN","PXAIPRV",91,0)
 ...I +$G(^TMP("PXK",$J,"PRV",PXAK,0,"AFTER"))=IEN S STOP=1
"RTN","PXAIPRV",92,0)
 .S FF="PXBSKY" F  S FF=$Q(@FF) Q:FF=""  I @FF=IEN S STOP=1 Q
"RTN","PXAIPRV",93,0)
 .Q:STOP
"RTN","PXAIPRV",94,0)
 .;
"RTN","PXAIPRV",95,0)
 .S $P(AFTER0,"^",1)=IEN
"RTN","PXAIPRV",96,0)
 .S $P(AFTER0,"^",2)=$P(^AUPNVSIT(PXAVISIT,0),"^",5)
"RTN","PXAIPRV",97,0)
 .S $P(AFTER0,"^",3)=PXAVISIT
"RTN","PXAIPRV",98,0)
 .S $P(AFTER0,"^",4)="S"
"RTN","PXAIPRV",99,0)
 .S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAIPRV",100,0)
 .S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAIPRV",101,0)
 .S ^TMP("PXK",$J,"PRV",CNT,0,"AFTER")=$G(AFTER0)
"RTN","PXAIPRV",102,0)
 .S ^TMP("PXK",$J,"PRV",CNT,811,"AFTER")=""
"RTN","PXAIPRV",103,0)
 .S ^TMP("PXK",$J,"PRV",CNT,812,"AFTER")=$G(AFTER812)
"RTN","PXAIPRV",104,0)
 .S ^TMP("PXK",$J,"PRV",CNT,0,"BEFORE")=""
"RTN","PXAIPRV",105,0)
 .S ^TMP("PXK",$J,"PRV",CNT,811,"BEFORE")=""
"RTN","PXAIPRV",106,0)
 .S ^TMP("PXK",$J,"PRV",CNT,811,"BEFORE")=""
"RTN","PXAIPRV",107,0)
 .S ^TMP("PXK",$J,"PRV",CNT,"IEN")=""
"RTN","PXAIPRV",108,0)
 Q
"RTN","PXAIPRV",109,0)
PRIM ;--SET A PROVIDER AS PRIMARY
"RTN","PXAIPRV",110,0)
 N PXBCNT,PXBKY,PXBSAM,PXBSKY,AFTER0,FPRI,PRVDR,PXASOR
"RTN","PXAIPRV",111,0)
 D PRV^PXBGPRV(PXAVISIT,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI)
"RTN","PXAIPRV",112,0)
 I $D(PRVDR) Q
"RTN","PXAIPRV",113,0)
 I '$D(PXBSKY) Q
"RTN","PXAIPRV",114,0)
 ;----ADDED
"RTN","PXAIPRV",115,0)
 S PXASOR=$G(^TMP("PXK",$J,"SOR"))
"RTN","PXAIPRV",116,0)
 K ^TMP("PXK",$J)
"RTN","PXAIPRV",117,0)
 S ^TMP("PXK",$J,"SOR")=$G(PXASOR)
"RTN","PXAIPRV",118,0)
 S ^TMP("PXK",$J,"VST",1,"IEN")=PXAVISIT
"RTN","PXAIPRV",119,0)
 ;-------
"RTN","PXAIPRV",120,0)
 ;
"RTN","PXAIPRV",121,0)
 S $P(AFTER0,"^",1)=$P(^AUPNVPRV($O(PXBSKY(1,0)),0),"^",1)
"RTN","PXAIPRV",122,0)
 S $P(AFTER0,"^",2)=$P(^AUPNVSIT(PXAVISIT,0),"^",5)
"RTN","PXAIPRV",123,0)
 S $P(AFTER0,"^",3)=PXAVISIT
"RTN","PXAIPRV",124,0)
 S $P(AFTER0,"^",4)="P"
"RTN","PXAIPRV",125,0)
 S ^TMP("PXK",$J,"PRV",22222,0,"AFTER")=AFTER0
"RTN","PXAIPRV",126,0)
 S ^TMP("PXK",$J,"PRV",22222,0,"BEFORE")=$G(^AUPNVPRV($O(PXBSKY(1,0)),0))
"RTN","PXAIPRV",127,0)
 S ^TMP("PXK",$J,"PRV",22222,"IEN")=$O(PXBSKY(1,0))
"RTN","PXAIPRV",128,0)
 D EN1^PXKMAIN
"RTN","PXAIPRV",129,0)
 K PXRDR
"RTN","PXAIPRV",130,0)
 Q
"RTN","PXAPIOE")
0^9^B22906630
"RTN","PXAPIOE",1,0)
PXAPIOE ;ALB/MJK,ESW - Supported References for ACRP ; 12/5/02 11:27am
"RTN","PXAPIOE",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**39,73,108**;Aug 12, 1996
"RTN","PXAPIOE",3,0)
 ;
"RTN","PXAPIOE",4,0)
 ;
"RTN","PXAPIOE",5,0)
CPT(PXVIEN,PXERR) ; -- at least one cpt for visit??
"RTN","PXAPIOE",6,0)
 ;
"RTN","PXAPIOE",7,0)
 N PXOK
"RTN","PXAPIOE",8,0)
 S PXOK=0
"RTN","PXAPIOE",9,0)
 ;
"RTN","PXAPIOE",10,0)
 ; -- do validation checks
"RTN","PXAPIOE",11,0)
 IF '$$VALVST(PXVIEN,$G(PXERR)) G CPTQ
"RTN","PXAPIOE",12,0)
 ;
"RTN","PXAPIOE",13,0)
 S PXOK=($O(^AUPNVCPT("AD",PXVIEN,0))>0)
"RTN","PXAPIOE",14,0)
CPTQ Q PXOK
"RTN","PXAPIOE",15,0)
 ;
"RTN","PXAPIOE",16,0)
 ;
"RTN","PXAPIOE",17,0)
GETCPT(PXVIEN,PXCPT,PXERR) ; -- get cpt's for visit
"RTN","PXAPIOE",18,0)
 ;
"RTN","PXAPIOE",19,0)
 ; -- do validation checks
"RTN","PXAPIOE",20,0)
 IF '$$VALVST(PXVIEN,$G(PXERR)) G GETCPTQ
"RTN","PXAPIOE",21,0)
 ;
"RTN","PXAPIOE",22,0)
 N I,CNT S (I,CNT)=0 F  S I=$O(^AUPNVCPT("AD",PXVIEN,I)) Q:'I  D
"RTN","PXAPIOE",23,0)
 . IF $D(^AUPNVCPT(I,0)) S @PXCPT@(I)=^(0),CNT=CNT+1
"RTN","PXAPIOE",24,0)
 S @PXCPT=CNT
"RTN","PXAPIOE",25,0)
GETCPTQ Q
"RTN","PXAPIOE",26,0)
 ;
"RTN","PXAPIOE",27,0)
CPTARR(PXVIEN,PXCPT,PXERR) ;+API to return all CPT data for a visit.
"RTN","PXAPIOE",28,0)
 N IEN,CNT
"RTN","PXAPIOE",29,0)
 S (IEN,CNT)=0
"RTN","PXAPIOE",30,0)
 Q:'$$VALVST(PXVIEN,$G(PXERR))
"RTN","PXAPIOE",31,0)
 F  S IEN=$O(^AUPNVCPT("AD",PXVIEN,IEN)) Q:'IEN  D
"RTN","PXAPIOE",32,0)
 . Q:'$D(^AUPNVCPT(IEN))
"RTN","PXAPIOE",33,0)
 . M @PXCPT@(IEN)=^AUPNVCPT(IEN)
"RTN","PXAPIOE",34,0)
 . S CNT=CNT+1
"RTN","PXAPIOE",35,0)
 S @PXCPT=CNT
"RTN","PXAPIOE",36,0)
 Q
"RTN","PXAPIOE",37,0)
 ;
"RTN","PXAPIOE",38,0)
DX(PXVIEN,PXERR) ; -- at least one dx for visit??
"RTN","PXAPIOE",39,0)
 ;
"RTN","PXAPIOE",40,0)
 N PXOK
"RTN","PXAPIOE",41,0)
 S PXOK=0
"RTN","PXAPIOE",42,0)
 ;
"RTN","PXAPIOE",43,0)
 ; -- do validation checks
"RTN","PXAPIOE",44,0)
 IF '$$VALVST(PXVIEN,$G(PXERR)) G DXQ
"RTN","PXAPIOE",45,0)
 ;
"RTN","PXAPIOE",46,0)
 S PXOK=($O(^AUPNVPOV("AD",PXVIEN,0))>0)
"RTN","PXAPIOE",47,0)
DXQ Q PXOK
"RTN","PXAPIOE",48,0)
 ;
"RTN","PXAPIOE",49,0)
 ;
"RTN","PXAPIOE",50,0)
GETDX(PXVIEN,PXDX,PXERR) ; -- get dx's for visit
"RTN","PXAPIOE",51,0)
 ;
"RTN","PXAPIOE",52,0)
 ; -- do validation checks
"RTN","PXAPIOE",53,0)
 IF '$$VALVST(PXVIEN,$G(PXERR)) G GETDXQ
"RTN","PXAPIOE",54,0)
 ;
"RTN","PXAPIOE",55,0)
 N I,CNT S (I,CNT)=0 F  S I=$O(^AUPNVPOV("AD",PXVIEN,I)) Q:'I  D
"RTN","PXAPIOE",56,0)
 . IF $D(^AUPNVPOV(I,0)) S @PXDX@(I)=^(0),CNT=CNT+1
"RTN","PXAPIOE",57,0)
 S @PXDX=CNT
"RTN","PXAPIOE",58,0)
GETDXQ Q
"RTN","PXAPIOE",59,0)
 ;
"RTN","PXAPIOE",60,0)
 ;
"RTN","PXAPIOE",61,0)
PRV(PXVIEN,PXERR) ; -- at least one provider for visit?
"RTN","PXAPIOE",62,0)
 ;
"RTN","PXAPIOE",63,0)
 N PXOK
"RTN","PXAPIOE",64,0)
 S PXOK=0
"RTN","PXAPIOE",65,0)
 ;
"RTN","PXAPIOE",66,0)
 ; -- do validation checks
"RTN","PXAPIOE",67,0)
 IF '$$VALVST(PXVIEN,$G(PXERR)) G PRVQ
"RTN","PXAPIOE",68,0)
 S PXOK=($O(^AUPNVPRV("AD",PXVIEN,0))>0)
"RTN","PXAPIOE",69,0)
PRVQ Q PXOK
"RTN","PXAPIOE",70,0)
 ;
"RTN","PXAPIOE",71,0)
 ;
"RTN","PXAPIOE",72,0)
GETPRV(PXVIEN,PXPRV,PXERR) ; -- get provider's for visit;108
"RTN","PXAPIOE",73,0)
 ;
"RTN","PXAPIOE",74,0)
 ; -- do validation checks
"RTN","PXAPIOE",75,0)
 IF '$$VALVST(PXVIEN,$G(PXERR)) G GETPRVQ
"RTN","PXAPIOE",76,0)
 ;
"RTN","PXAPIOE",77,0)
 ;PX*1*108;look for duplicates to exclude them
"RTN","PXAPIOE",78,0)
 N I,CNT,PR,PRS,PS,PP,PRV
"RTN","PXAPIOE",79,0)
 S (I,CNT)=0 F  S I=$O(^AUPNVPRV("AD",PXVIEN,I)) Q:'I  D
"RTN","PXAPIOE",80,0)
 .IF $D(^AUPNVPRV(I,0)) D
"RTN","PXAPIOE",81,0)
 ..S @PXPRV@(I)=^(0),PR=+@PXPRV@(I),PS=$P(@PXPRV@(I),U,4)
"RTN","PXAPIOE",82,0)
 ..IF PS="P" D
"RTN","PXAPIOE",83,0)
 ...I 'CNT S PRV=PR,CNT=1 Q
"RTN","PXAPIOE",84,0)
 ...I PR=PRV K @PXPRV@(I)
"RTN","PXAPIOE",85,0)
 ..I PS="S" S PRS(PR,I)=""
"RTN","PXAPIOE",86,0)
 S PR="" F  S PR=$O(PRS(PR)) Q:PR=""  S I="" D
"RTN","PXAPIOE",87,0)
 .F PP=1:1 S I=$O(PRS(PR,I)) Q:I=""  D
"RTN","PXAPIOE",88,0)
 ..I PR=$G(PRV) K @PXPRV@(I) Q
"RTN","PXAPIOE",89,0)
 ..I PP>1 K @PXPRV@(I)
"RTN","PXAPIOE",90,0)
 ..E  S CNT=CNT+1
"RTN","PXAPIOE",91,0)
 S @PXPRV=CNT
"RTN","PXAPIOE",92,0)
GETPRVQ Q
"RTN","PXAPIOE",93,0)
 ;
"RTN","PXAPIOE",94,0)
 ;
"RTN","PXAPIOE",95,0)
VALVST(PXVIEN,PXERR) ; -- validate visit ien input
"RTN","PXAPIOE",96,0)
 ;
"RTN","PXAPIOE",97,0)
 ; -- do checks
"RTN","PXAPIOE",98,0)
 IF PXVIEN,$D(^AUPNVSIT(PXVIEN,0)) Q 1
"RTN","PXAPIOE",99,0)
 ;
"RTN","PXAPIOE",100,0)
 ; -- build error msg
"RTN","PXAPIOE",101,0)
 N PXIN,PXOUT
"RTN","PXAPIOE",102,0)
 S PXIN("ID")=PXVIEN
"RTN","PXAPIOE",103,0)
 S PXOUT("ID")=PXVIEN
"RTN","PXAPIOE",104,0)
 D BLD^DIALOG(1509000.001,.PXIN,.PXOUT,$G(PXERR),"F")
"RTN","PXAPIOE",105,0)
 Q 0
"RTN","PXAPIOE",106,0)
 ;
"RTN","PXAPIOE",107,0)
 ;
"RTN","PXAPIOE",108,0)
POST ; -- post error action logic
"RTN","PXAPIOE",109,0)
 ;ZW DO
"RTN","PXAPIOE",110,0)
 ;ZW DIPI
"RTN","PXAPIOE",111,0)
 ;ZW DIPE
"RTN","PXAPIOE",112,0)
 Q
"RTN","PXAPIOE",113,0)
 ;
"RTN","PXAPIOE",114,0)
 ;
"RTN","PXAPIOE",115,0)
PDX(VSTPOV,RANK) ; -- set primary dx for V POV entry
"RTN","PXAPIOE",116,0)
 ;
"RTN","PXAPIOE",117,0)
 N VSTRT,VSTSEQ
"RTN","PXAPIOE",118,0)
 N VSTIEN,X
"RTN","PXAPIOE",119,0)
 ;
"RTN","PXAPIOE",120,0)
 ; -- set up structures
"RTN","PXAPIOE",121,0)
 D INIT(.VSTRT,.VSTSEQ)
"RTN","PXAPIOE",122,0)
 ;
"RTN","PXAPIOE",123,0)
 ; -- set up visit
"RTN","PXAPIOE",124,0)
 S X=$G(^AUPNVPOV(VSTPOV,0))
"RTN","PXAPIOE",125,0)
 S VSTIEN=+$P(X,U,3)
"RTN","PXAPIOE",126,0)
 D VNODES(VSTIEN,VSTRT,VSTSEQ)
"RTN","PXAPIOE",127,0)
 ;
"RTN","PXAPIOE",128,0)
 ; -- set up dx
"RTN","PXAPIOE",129,0)
 D DXNODES(VSTPOV,VSTRT,VSTSEQ)
"RTN","PXAPIOE",130,0)
 S $P(@VSTRT@("POV",1,0,"AFTER"),U,12)=RANK
"RTN","PXAPIOE",131,0)
 ;
"RTN","PXAPIOE",132,0)
 ; -- file change and kill
"RTN","PXAPIOE",133,0)
 D FINAL(VSTRT)
"RTN","PXAPIOE",134,0)
 Q
"RTN","PXAPIOE",135,0)
 ;
"RTN","PXAPIOE",136,0)
 ;
"RTN","PXAPIOE",137,0)
PCLASS(VSTPRV) ; -- set provider class for V PRV entry
"RTN","PXAPIOE",138,0)
 ;
"RTN","PXAPIOE",139,0)
 N VSTRT,VSTSEQ
"RTN","PXAPIOE",140,0)
 N VSTIEN,X
"RTN","PXAPIOE",141,0)
 ;
"RTN","PXAPIOE",142,0)
 ; -- set up structures
"RTN","PXAPIOE",143,0)
 D INIT(.VSTRT,.VSTSEQ)
"RTN","PXAPIOE",144,0)
 ;
"RTN","PXAPIOE",145,0)
 ; -- set up visit
"RTN","PXAPIOE",146,0)
 S X=$G(^AUPNVPRV(VSTPRV,0))
"RTN","PXAPIOE",147,0)
 S VSTIEN=+$P(X,U,3)
"RTN","PXAPIOE",148,0)
 D VNODES(VSTIEN,VSTRT,VSTSEQ)
"RTN","PXAPIOE",149,0)
 ;
"RTN","PXAPIOE",150,0)
 ; -- set up provider ; pxkmain will automatically set class
"RTN","PXAPIOE",151,0)
 D PRVNODES(VSTPRV,VSTRT,VSTSEQ)
"RTN","PXAPIOE",152,0)
 ;
"RTN","PXAPIOE",153,0)
 ; -- file change and kill
"RTN","PXAPIOE",154,0)
 D FINAL(VSTRT)
"RTN","PXAPIOE",155,0)
 Q
"RTN","PXAPIOE",156,0)
 ;
"RTN","PXAPIOE",157,0)
 ;
"RTN","PXAPIOE",158,0)
INIT(VSTRT,VSTSEQ) ; -- set up structures
"RTN","PXAPIOE",159,0)
 S VSTRT=$NA(^TMP("PXK",$J))
"RTN","PXAPIOE",160,0)
 S VSTSEQ=1
"RTN","PXAPIOE",161,0)
 K @VSTRT
"RTN","PXAPIOE",162,0)
 S @VSTRT@("SOR")=$O(^PX(839.7,"B","PIMS",0))
"RTN","PXAPIOE",163,0)
 Q
"RTN","PXAPIOE",164,0)
 ;
"RTN","PXAPIOE",165,0)
 ;
"RTN","PXAPIOE",166,0)
FINAL(VSTRT) ; -- file data and clean up
"RTN","PXAPIOE",167,0)
 N PXKNOEVT
"RTN","PXAPIOE",168,0)
 S PXKNOEVT=1
"RTN","PXAPIOE",169,0)
 D EN1^PXKMAIN
"RTN","PXAPIOE",170,0)
 K @VSTRT
"RTN","PXAPIOE",171,0)
 Q
"RTN","PXAPIOE",172,0)
 ;
"RTN","PXAPIOE",173,0)
 ;
"RTN","PXAPIOE",174,0)
VNODES(VSTIEN,VSTRT,VSTSEQ) ; -- get visit nodes
"RTN","PXAPIOE",175,0)
 N NODE,X
"RTN","PXAPIOE",176,0)
 S @VSTRT@("VST",VSTSEQ,"IEN")=VSTIEN
"RTN","PXAPIOE",177,0)
 F NODE=0,21,150,800,811,812 D
"RTN","PXAPIOE",178,0)
 . S X=$G(^AUPNVSIT(VSTIEN,NODE))
"RTN","PXAPIOE",179,0)
 . S @VSTRT@("VST",VSTSEQ,NODE,"BEFORE")=X
"RTN","PXAPIOE",180,0)
 . S @VSTRT@("VST",VSTSEQ,NODE,"AFTER")=X
"RTN","PXAPIOE",181,0)
 Q
"RTN","PXAPIOE",182,0)
 ;
"RTN","PXAPIOE",183,0)
 ;
"RTN","PXAPIOE",184,0)
DXNODES(VSTPOV,VSTRT,VSTSEQ) ; -- get dx nodes
"RTN","PXAPIOE",185,0)
 N NODE,X
"RTN","PXAPIOE",186,0)
 S @VSTRT@("POV",VSTSEQ,"IEN")=VSTPOV
"RTN","PXAPIOE",187,0)
 F NODE=0,12,812 D
"RTN","PXAPIOE",188,0)
 . S X=$G(^AUPNVPOV(VSTPOV,NODE))
"RTN","PXAPIOE",189,0)
 . S @VSTRT@("POV",VSTSEQ,NODE,"BEFORE")=X
"RTN","PXAPIOE",190,0)
 . S @VSTRT@("POV",VSTSEQ,NODE,"AFTER")=X
"RTN","PXAPIOE",191,0)
 Q
"RTN","PXAPIOE",192,0)
 ;
"RTN","PXAPIOE",193,0)
 ;
"RTN","PXAPIOE",194,0)
PRVNODES(VSTPRV,VSTRT,VSTSEQ) ; -- get provider nodes
"RTN","PXAPIOE",195,0)
 N NODE,X
"RTN","PXAPIOE",196,0)
 S @VSTRT@("PRV",VSTSEQ,"IEN")=VSTPRV
"RTN","PXAPIOE",197,0)
 F NODE=0,12,812 D
"RTN","PXAPIOE",198,0)
 . S X=$G(^AUPNVPRV(VSTPRV,NODE))
"RTN","PXAPIOE",199,0)
 . S @VSTRT@("PRV",VSTSEQ,NODE,"BEFORE")=X
"RTN","PXAPIOE",200,0)
 . S @VSTRT@("PRV",VSTSEQ,NODE,"AFTER")=X
"RTN","PXAPIOE",201,0)
 Q
"RTN","PXAPIOE",202,0)
 ;
"RTN","PXBDCPT")
0^3^B33120266
"RTN","PXBDCPT",1,0)
PXBDCPT ;ISL/JVS,ESW - DISPLAY CPT ; 12/5/02 11:28am
"RTN","PXBDCPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,73,89,108**;Aug 12, 1996
"RTN","PXBDCPT",3,0)
 ;
"RTN","PXBDCPT",4,0)
 ;
"RTN","PXBDCPT",5,0)
EN0 ;---Main entry point
"RTN","PXBDCPT",6,0)
 ;
"RTN","PXBDCPT",7,0)
 ;
"RTN","PXBDCPT",8,0)
HEAD ;--HEADER ON LIST
"RTN","PXBDCPT",9,0)
 S HEAD="- - E N C O U N T E R  P R O C E D U R E S (CPT CODES) - -"
"RTN","PXBDCPT",10,0)
 W IOINHI,!,IOCUU,?(IOM-$L(HEAD))\2,HEAD,IOINLOW
"RTN","PXBDCPT",11,0)
 W IOELEOL K HEAD
"RTN","PXBDCPT",12,0)
 ;
"RTN","PXBDCPT",13,0)
 I $D(CLINIC) D PRV^PXBUTL2(CLINIC)
"RTN","PXBDCPT",14,0)
 ;
"RTN","PXBDCPT",15,0)
 ;I PXBCNT<11 D DISCPT1^PXBDCPT
"RTN","PXBDCPT",16,0)
 ;I PXBCNT<21&(PXBCNT>10) D DISCPT2^PXBDCPT
"RTN","PXBDCPT",17,0)
 ;I PXBCNT>20&(PXBCNT<31) D DISCPT3^PXBDCPT
"RTN","PXBDCPT",18,0)
 ;I PXBCNT>30&('$D(PXBNCPT)) 
"RTN","PXBDCPT",19,0)
 D DISCPT4^PXBDCPT("BEGIN")
"RTN","PXBDCPT",20,0)
 ;I PXBCNT>30&($D(PXBNCPT)) D DISCPT4^PXBDCPT("SAME")
"RTN","PXBDCPT",21,0)
 Q
"RTN","PXBDCPT",22,0)
 ;
"RTN","PXBDCPT",23,0)
 ;
"RTN","PXBDCPT",24,0)
 ;
"RTN","PXBDCPT",25,0)
ARRAY ;Set all CPT codes and modifiers into ^TMP("PXBDCPT",$J,"DSP"
"RTN","PXBDCPT",26,0)
 ;for display
"RTN","PXBDCPT",27,0)
 ;
"RTN","PXBDCPT",28,0)
 N PXSQ,ENTRY,PXMD,PXDESC
"RTN","PXBDCPT",29,0)
 S PXTMP="^TMP(""PXBDCPT"""_","_$J_","_"""DSP"")"
"RTN","PXBDCPT",30,0)
 K @PXTMP
"RTN","PXBDCPT",31,0)
 S (PXTLNS,PXSQ)=0
"RTN","PXBDCPT",32,0)
 F  S PXSQ=$O(PXBSAM(PXSQ)) Q:'PXSQ  D
"RTN","PXBDCPT",33,0)
 .S PXTLNS=PXTLNS+1
"RTN","PXBDCPT",34,0)
 .S ENTRY=PXBSAM(PXSQ)
"RTN","PXBDCPT",35,0)
 .S PXBSAM(PXSQ,"LINE")=PXTLNS
"RTN","PXBDCPT",36,0)
 .I $D(PXBNCPT($P(ENTRY,U))) D
"RTN","PXBDCPT",37,0)
 ..;I PXBNCPT($P(ENTRY,U))]"",'$D(PXBSKY(PXSQ,PXBNCPT($P(ENTRY,U)))) Q
"RTN","PXBDCPT",38,0)
 ..Q:'$D(PXBNCPT($P(ENTRY,U),$O(PXBSKY(PXSQ,0))))
"RTN","PXBDCPT",39,0)
 ..S $P(ENTRY,U)=$P(ENTRY,U)_"*"
"RTN","PXBDCPT",40,0)
 .S @PXTMP@(PXTLNS,0)=PXSQ_U_$P(ENTRY,U)_U_$P(ENTRY,U,2)_U_$P(ENTRY,U,4)_U_$E($P(ENTRY,U,3),1,24)
"RTN","PXBDCPT",41,0)
 .S PXMD=""
"RTN","PXBDCPT",42,0)
 .F  S PXMD=$O(PXBSAM(PXSQ,"MOD",PXMD)) Q:'PXMD  D
"RTN","PXBDCPT",43,0)
 ..S PXTLNS=PXTLNS+1
"RTN","PXBDCPT",44,0)
 ..S PXMOD=PXBSAM(PXSQ,"MOD",PXMD)
"RTN","PXBDCPT",45,0)
 ..S PXDESC=$P($$MODP^ICPTMOD($E(ENTRY,1,5),PXMOD,"E"),U,2) ;PX*108
"RTN","PXBDCPT",46,0)
 ..S @PXTMP@(PXTLNS,0)=0_U_PXMOD_U_$E(PXDESC,1,54)
"RTN","PXBDCPT",47,0)
 Q
"RTN","PXBDCPT",48,0)
DISCPT1 ;--Display the CPT Data
"RTN","PXBDCPT",49,0)
 ;
"RTN","PXBDCPT",50,0)
 N ENTRY,J
"RTN","PXBDCPT",51,0)
 D UNDON^PXBCC
"RTN","PXBDCPT",52,0)
 W !,"No.",?4,"CPT CODE",?14,"QUANTITY",?25,"DESCRIPTION",?55,"PROVIDER",?75,$C(32)
"RTN","PXBDCPT",53,0)
 W IOEDEOP
"RTN","PXBDCPT",54,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",55,0)
 ;
"RTN","PXBDCPT",56,0)
 ;
"RTN","PXBDCPT",57,0)
 S J=0
"RTN","PXBDCPT",58,0)
 F  S J=$O(PXBSAM(J)) Q:J=""  D
"RTN","PXBDCPT",59,0)
 .S ENTRY=$G(PXBSAM(J))
"RTN","PXBDCPT",60,0)
 .I $D(PXBNCPT($P(ENTRY,U,1))) S $P(ENTRY,U,1)=$P(ENTRY,U,1)_"*"
"RTN","PXBDCPT",61,0)
 .W !,J,?4,$P(ENTRY,U,1),?15,$P(ENTRY,U,2)
"RTN","PXBDCPT",62,0)
 .W ?25,$P(ENTRY,U,4),?55,$E($P(ENTRY,U,3),1,24)
"RTN","PXBDCPT",63,0)
 .;---Display associated modifiers
"RTN","PXBDCPT",64,0)
 .S PXSIEN=""
"RTN","PXBDCPT",65,0)
 .F  S PXSIEN=$O(PXBSAM(J,"MOD",PXSIEN)) Q:PXSIEN=""  D
"RTN","PXBDCPT",66,0)
 ..N PXWRAP,PXMOD,PXDESC,PXLN
"RTN","PXBDCPT",67,0)
 ..S PXMOD=PXBSAM(J,"MOD",PXSIEN)
"RTN","PXBDCPT",68,0)
 ..S PXDESC=$P($$MOD^ICPTMOD(PXMOD,"E"),U,3)
"RTN","PXBDCPT",69,0)
 ..D WRAP^PXCEVFI4(PXDESC,58,.PXWRAP)
"RTN","PXBDCPT",70,0)
 ..F PXLN=1:1 Q:$G(PXWRAP(PXLN))=""  D
"RTN","PXBDCPT",71,0)
 ...W:PXLN=1 !,?4,"CPT Modifier: "_PXMOD
"RTN","PXBDCPT",72,0)
 ...W:PXLN>1 !
"RTN","PXBDCPT",73,0)
 ...W ?22,PXWRAP(PXLN)
"RTN","PXBDCPT",74,0)
 ;---Write no entries if none exsist
"RTN","PXBDCPT",75,0)
 I '$D(PXBSAM) D NONE^PXBUTL(2)
"RTN","PXBDCPT",76,0)
 Q
"RTN","PXBDCPT",77,0)
 ;
"RTN","PXBDCPT",78,0)
DISCPT2 ;--display of cpt data two columns more that 10 entries.
"RTN","PXBDCPT",79,0)
 ;
"RTN","PXBDCPT",80,0)
 N ENTRY,J,PXA
"RTN","PXBDCPT",81,0)
 D GSET^%ZISS
"RTN","PXBDCPT",82,0)
 D UNDON^PXBCC W IOG1
"RTN","PXBDCPT",83,0)
 W !,"NO",?4,"CPT",?10,"QUA",?14,"DESCRIPTION",?39,IOVL
"RTN","PXBDCPT",84,0)
 W ?40,"NO",?44,"CPT",?50,"QUA",?54,"NARRATIVE"
"RTN","PXBDCPT",85,0)
 W IOEDEOP
"RTN","PXBDCPT",86,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",87,0)
 ;
"RTN","PXBDCPT",88,0)
 ;
"RTN","PXBDCPT",89,0)
 ;
"RTN","PXBDCPT",90,0)
 S J=0 F  S J=$O(PXBSAM(J)) Q:J=""  D
"RTN","PXBDCPT",91,0)
 .S ENTRY(J)=$G(PXBSAM(J)) I $D(PXBNCPT($P(ENTRY(J),U,1))) S $P(ENTRY(J),U,1)=$P(ENTRY(J),U,1)_"*"
"RTN","PXBDCPT",92,0)
 F J=1:1:10 D
"RTN","PXBDCPT",93,0)
 .W !,J,?4,$P(ENTRY(J),U,1),?11,$P(ENTRY(J),U,2),?14,$E($P(ENTRY(J),U,4),1,24)
"RTN","PXBDCPT",94,0)
 .I $D(ENTRY(J+10)) W ?39,IOVL,(J+10),?44,$P(ENTRY(J+10),U,1),?51,$P(ENTRY(J+10),U,2),?54,$E($P(ENTRY(J+10),U,4),1,24)
"RTN","PXBDCPT",95,0)
 W IOG0
"RTN","PXBDCPT",96,0)
 Q
"RTN","PXBDCPT",97,0)
 ;
"RTN","PXBDCPT",98,0)
DISCPT3 ;--display of cpt data three colums more that 20 entries.
"RTN","PXBDCPT",99,0)
 N ENTRY,J,PXA
"RTN","PXBDCPT",100,0)
 D GSET^%ZISS
"RTN","PXBDCPT",101,0)
 D UNDON^PXBCC W IOG1
"RTN","PXBDCPT",102,0)
 W !,"NO",?4,"CPT",?10,"QUA",?14,"NARRATIVE",?25,IOVL
"RTN","PXBDCPT",103,0)
 W ?26,"NO",?30,"CPT",?36,"QUA",?40,"NARRATIVE",?51,IOVL
"RTN","PXBDCPT",104,0)
 W ?52,"NO",?56,"CPT",?62,"QUA",?66,"NARRATIVE"
"RTN","PXBDCPT",105,0)
 W IOEDEOP
"RTN","PXBDCPT",106,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",107,0)
 ;
"RTN","PXBDCPT",108,0)
 S J=0 F  S J=$O(PXBSAM(J)) Q:J=""  D
"RTN","PXBDCPT",109,0)
 .S ENTRY(J)=$G(PXBSAM(J)) I $D(PXBNCPT($P(ENTRY(J),U,1))) S $P(ENTRY(J),U,1)=$P(ENTRY(J),U,1)_"*"
"RTN","PXBDCPT",110,0)
 F J=1:1:10 D
"RTN","PXBDCPT",111,0)
 .W !,J,?4,$P(ENTRY(J),U,1),?11,$P(ENTRY(J),U,2),?14,$E($P(ENTRY(J),U,4),1,10)
"RTN","PXBDCPT",112,0)
 .I $D(ENTRY(J+10)) W ?25,IOVL,(J+10),?30,$P(ENTRY(J+10),U,1),?37,$P(ENTRY(J+10),U,2),?40,$E($P(ENTRY(J+10),U,4),1,10)
"RTN","PXBDCPT",113,0)
 .I $D(ENTRY(J+20)) W ?51,IOVL,(J+20),?56,$P(ENTRY(J+20),U,1),?63,$P(ENTRY(J+20),U,2),?66,$E($P(ENTRY(J+20),U,4),1,10)
"RTN","PXBDCPT",114,0)
 W IOG0
"RTN","PXBDCPT",115,0)
 Q
"RTN","PXBDCPT",116,0)
 ;
"RTN","PXBDCPT",117,0)
DISCPT4(SIGN) ;--Display the CPT Data
"RTN","PXBDCPT",118,0)
 ;
"RTN","PXBDCPT",119,0)
 ;SIGN=
"RTN","PXBDCPT",120,0)
 ; '+' add 10 to the starting point in ^TMP("PXBDCPT",$J)
"RTN","PXBDCPT",121,0)
 ; '-' subtract 10 from the starting point but not less that 0
"RTN","PXBDCPT",122,0)
 ; 'BEGIN' start at the beginning
"RTN","PXBDCPT",123,0)
 ; 'SAME' start stays where it's at
"RTN","PXBDCPT",124,0)
 ; '3'--any number set start to that number
"RTN","PXBDCPT",125,0)
 ;
"RTN","PXBDCPT",126,0)
 N PXBSTART,PXTMP
"RTN","PXBDCPT",127,0)
 D ARRAY
"RTN","PXBDCPT",128,0)
 I SIGN="BEGIN" S ^TMP("PXBDCPT",$J,"START")=0,PXBSTART=0
"RTN","PXBDCPT",129,0)
 I SIGN="SAME" S PXBSTART=^TMP("PXBDCPT",$J,"START")
"RTN","PXBDCPT",130,0)
 I SIGN="+" D
"RTN","PXBDCPT",131,0)
 .S PXBSTART=($G(^TMP("PXBDCPT",$J,"START"))+10)
"RTN","PXBDCPT",132,0)
 .I PXBSTART'<PXTLNS S PXBSTART=PXBSTART-10
"RTN","PXBDCPT",133,0)
 .S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",134,0)
 I SIGN="-" D
"RTN","PXBDCPT",135,0)
 .S PXBSTART=$G(^TMP("PXBDCPT",$J,"START"))-10
"RTN","PXBDCPT",136,0)
 .S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",137,0)
 .I PXBSTART<0 S PXBSTART=0 S ^TMP("PXBDCPT",$J,"START")=0
"RTN","PXBDCPT",138,0)
 I +SIGN>0&(SIGN#10) D  Q:^TMP("PXBDCPT",$J,"START")=PXBSTART  S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",139,0)
 .S PXBSTART=$P((SIGN/10),".")*10
"RTN","PXBDCPT",140,0)
 .S:PXBSTART<10 PXBSTART=0
"RTN","PXBDCPT",141,0)
 I +SIGN>0&'(SIGN#10) D  Q:^TMP("PXBDCPT",$J,"START")=PXBSTART  S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",142,0)
 .S PXBSTART=(($P((SIGN/10),".")*10)-10)
"RTN","PXBDCPT",143,0)
 .S:PXBSTART<10 PXBSTART=0
"RTN","PXBDCPT",144,0)
 ;
"RTN","PXBDCPT",145,0)
 ;
"RTN","PXBDCPT",146,0)
 I SIGN'="BEGIN" D LOC^PXBCC(3,0) W IOEDEOP
"RTN","PXBDCPT",147,0)
 ;
"RTN","PXBDCPT",148,0)
HEAD4 ;--HEADER ON LIST
"RTN","PXBDCPT",149,0)
 S HEAD="- - E N C O U N T E R  P R O C E D U R E S (CPT CODES) - -"
"RTN","PXBDCPT",150,0)
 W IOINHI,!,IOCUU,?(IOM-$L(HEAD))\2,HEAD,IOINLOW
"RTN","PXBDCPT",151,0)
 W IOELEOL K HEAD
"RTN","PXBDCPT",152,0)
 ;
"RTN","PXBDCPT",153,0)
 ;
"RTN","PXBDCPT",154,0)
 N ENTRY,J
"RTN","PXBDCPT",155,0)
 D UNDON^PXBCC
"RTN","PXBDCPT",156,0)
 W !,"No.",?4,"CPT CODE",?14,"QUANTITY",?25,"DESCRIPTION",?55,"PROVIDER",?75,$C(32)
"RTN","PXBDCPT",157,0)
 W IOEDEOP
"RTN","PXBDCPT",158,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",159,0)
 ;
"RTN","PXBDCPT",160,0)
 ;
"RTN","PXBDCPT",161,0)
 N PXSIEN,PXDESC,PXMOD,PXQ,PXLNS
"RTN","PXBDCPT",162,0)
 S J=PXBSTART,PXQ=""
"RTN","PXBDCPT",163,0)
 S PXLNS=0
"RTN","PXBDCPT",164,0)
 F  S J=$O(@PXTMP@(J)) Q:J=""  D  Q:PXQ
"RTN","PXBDCPT",165,0)
 .S PXLNS=PXLNS+1
"RTN","PXBDCPT",166,0)
 .I '(PXLNS#11) D  Q
"RTN","PXBDCPT",167,0)
 ..S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",168,0)
 ..S PXQ=1
"RTN","PXBDCPT",169,0)
 .I +@PXTMP@(J,0) D
"RTN","PXBDCPT",170,0)
 ..W !,$P(^(0),U),?4,$P(^(0),U,2),?15,$P(^(0),U,3)
"RTN","PXBDCPT",171,0)
 ..W ?25,$P(^(0),U,4),?55,$P(^(0),U,5)
"RTN","PXBDCPT",172,0)
 .E  D
"RTN","PXBDCPT",173,0)
 ..W !?4,"CPT Modifier: "_$P(^(0),U,2)_"  "_$P(^(0),U,3)
"RTN","PXBDCPT",174,0)
 I SIGN'="BEGIN" W !!
"RTN","PXBDCPT",175,0)
 Q
"RTN","PXBDCPT",176,0)
 ;
"RTN","PXBDPRV")
0^19^B24451562
"RTN","PXBDPRV",1,0)
PXBDPRV ;ISL/JVS,ESW - ISC DISPLAY PROVIDERS ; 12/5/02 11:29am
"RTN","PXBDPRV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**7,11,108**;Aug 12, 1996
"RTN","PXBDPRV",3,0)
 ;
"RTN","PXBDPRV",4,0)
 ;
"RTN","PXBDPRV",5,0)
EN0 ;---Main entry point
"RTN","PXBDPRV",6,0)
 ;
"RTN","PXBDPRV",7,0)
 W IOINLOW
"RTN","PXBDPRV",8,0)
HEAD ;--HEADER ON LIST
"RTN","PXBDPRV",9,0)
 S HEAD="- - E N C O U N T E R  P R O V I D E R S - -"
"RTN","PXBDPRV",10,0)
 I $D(FROM),FROM="CPT" S HEAD="- - E N C O U N T E R  P R O V I D E R S - -"
"RTN","PXBDPRV",11,0)
 I $D(FROM),FROM="PL" S HEAD="- - E N C O U N T E R  P R O V I D E R S - -"
"RTN","PXBDPRV",12,0)
 W IOINHI,!,IOCUU,?(IOM-$L(HEAD))\2,HEAD
"RTN","PXBDPRV",13,0)
 W IOINLOW,IOELEOL K HEAD
"RTN","PXBDPRV",14,0)
 I $D(CLINIC) D PRV^PXBUTL2(CLINIC)
"RTN","PXBDPRV",15,0)
 ;
"RTN","PXBDPRV",16,0)
 ;
"RTN","PXBDPRV",17,0)
 I PXBCNT<11 D DPRV1
"RTN","PXBDPRV",18,0)
 I PXBCNT>10&($D(PXBNPRV)) D DPRV4("SAME")
"RTN","PXBDPRV",19,0)
 I PXBCNT>10&('$D(PXBNPRV)) D DPRV4("BEGIN")
"RTN","PXBDPRV",20,0)
 W IOINORM
"RTN","PXBDPRV",21,0)
 Q
"RTN","PXBDPRV",22,0)
 ;
"RTN","PXBDPRV",23,0)
 ;
"RTN","PXBDPRV",24,0)
DPRV1 ;--Display the PRV Data
"RTN","PXBDPRV",25,0)
 N ENTRY,Y
"RTN","PXBDPRV",26,0)
 S Y=+$G(^AUPNVSIT(PXBVST,0)) D DD^%DT
"RTN","PXBDPRV",27,0)
 D UNDON^PXBCC
"RTN","PXBDPRV",28,0)
 W !,"No.",?4,"PROVIDER",?34,"PERSON CLASS ON  "_Y,?75,$C(32)
"RTN","PXBDPRV",29,0)
 W IOEDEOP
"RTN","PXBDPRV",30,0)
 D UNDOFF^PXBCC
"RTN","PXBDPRV",31,0)
 ;
"RTN","PXBDPRV",32,0)
 ;
"RTN","PXBDPRV",33,0)
 S J=0,PXBCNT=0 F  S J=$O(PXBSAM(J)) Q:J=""  S PXBCNT=PXBCNT+1 D
"RTN","PXBDPRV",34,0)
 .S ENTRY=$G(PXBSAM(J)) I $D(PXBNPRV($P(ENTRY,"^",1))) S $P(ENTRY,"^",1)=$P(ENTRY,"^",1)_"*"
"RTN","PXBDPRV",35,0)
 .W !,J,?4,$E($P(ENTRY,"^",1),1,19),?25 W:$P(ENTRY,"^",2)["PRI" $P(ENTRY,"^",2) W ?34 W:ENTRY["**" IOINHI W $E($P(ENTRY,"^",3),1,42),IOINLOW
"RTN","PXBDPRV",36,0)
 .D DIS
"RTN","PXBDPRV",37,0)
 ;---Write no entries if none exists
"RTN","PXBDPRV",38,0)
 I '$D(PXBSAM) D NONE^PXBUTL(1)
"RTN","PXBDPRV",39,0)
 ;-----------UNCOMMENT LINE IF CLINIC PROVIDERS ON SCREEEN---------------
"RTN","PXBDPRV",40,0)
 ;D DEF^PXBDPRV("A")
"RTN","PXBDPRV",41,0)
 D DEF^PXBDPRV("D") I '$D(FIRST) K PXBDPRV,PRVDR
"RTN","PXBDPRV",42,0)
 Q
"RTN","PXBDPRV",43,0)
 ;
"RTN","PXBDPRV",44,0)
 ;
"RTN","PXBDPRV",45,0)
 ;
"RTN","PXBDPRV",46,0)
DPRV4(SIGN) ;--Display the PROVIDER Data
"RTN","PXBDPRV",47,0)
 ;
"RTN","PXBDPRV",48,0)
 ;SIGN=
"RTN","PXBDPRV",49,0)
 ; '+' add 10 to the starting point in ^TMP("PXBDPRV",$J)
"RTN","PXBDPRV",50,0)
 ; '-' subtract 10 from the starting point but not less that 0
"RTN","PXBDPRV",51,0)
 ; 'BEGIN' start at the beginning
"RTN","PXBDPRV",52,0)
 ; 'SAME' start stays where it's at
"RTN","PXBDPRV",53,0)
 ; '3'--any number set start to that number
"RTN","PXBDPRV",54,0)
 ;
"RTN","PXBDPRV",55,0)
 N PXBSTART
"RTN","PXBDPRV",56,0)
 I '$D(^TMP("PXBDPRV",$J,"START")) S ^TMP("PXBDPRV",$J,"START")=0
"RTN","PXBDPRV",57,0)
 I SIGN="BEGIN" S ^TMP("PXBDPRV",$J,"START")=0,PXBSTART=0
"RTN","PXBDPRV",58,0)
 I SIGN="SAME" S PXBSTART=^TMP("PXBDPRV",$J,"START")
"RTN","PXBDPRV",59,0)
 I SIGN="+" S PXBSTART=($G(^TMP("PXBDPRV",$J,"START"))+(10)) S:PXBSTART'<PXBCNT PXBSTART=(PXBCNT-(10)) S ^TMP("PXBDPRV",$J,"START")=PXBSTART
"RTN","PXBDPRV",60,0)
 I SIGN="-" S PXBSTART=$G(^TMP("PXBDPRV",$J,"START"))-10,^TMP("PXBDPRV",$J,"START")=PXBSTART I PXBSTART<0 S PXBSTART=0 S ^TMP("PXBDPRV",$J,"START")=0
"RTN","PXBDPRV",61,0)
 I +SIGN>0&(SIGN#10) S PXBSTART=$P((SIGN/10),".")*10 S:PXBSTART<10 PXBSTART=0  Q:^TMP("PXBDPRV",$J,"START")=PXBSTART  S ^TMP("PXBDPRV",$J,"START")=PXBSTART
"RTN","PXBDPRV",62,0)
 I +SIGN>0&'(SIGN#10) S PXBSTART=(($P((SIGN/10),".")*10)-10) S:PXBSTART<10 PXBSTART=0 Q:^TMP("PXBDPRV",$J,"START")=PXBSTART  S ^TMP("PXBDPRV",$J,"START")=PXBSTART
"RTN","PXBDPRV",63,0)
 ;
"RTN","PXBDPRV",64,0)
 ;
"RTN","PXBDPRV",65,0)
 I SIGN'="BEGIN" D LOC^PXBCC(3,0) W IOEDEOP
"RTN","PXBDPRV",66,0)
HEAD4 ;--HEADER ON LIST
"RTN","PXBDPRV",67,0)
 S HEAD="- - E N C O U N T E R  P R O V I D E R S - -"
"RTN","PXBDPRV",68,0)
 I $D(FROM),FROM="CPT" S HEAD="- - E N C O U N T E R  P R O V I D E R S - -"
"RTN","PXBDPRV",69,0)
 I $D(FROM),FROM="PL" S HEAD="- - E N C O U N T E R  P R O V I D E R S - -"
"RTN","PXBDPRV",70,0)
 W !,IORVON,IOCUU,?(IOM-$L(HEAD))\2,HEAD
"RTN","PXBDPRV",71,0)
 W IORVOFF,IOELEOL K HEAD
"RTN","PXBDPRV",72,0)
 I $D(CLINIC) D PRV^PXBUTL2(CLINIC)
"RTN","PXBDPRV",73,0)
 ;
"RTN","PXBDPRV",74,0)
 ;
"RTN","PXBDPRV",75,0)
 ;
"RTN","PXBDPRV",76,0)
 N ENTRY,J,Y
"RTN","PXBDPRV",77,0)
 D UNDON^PXBCC
"RTN","PXBDPRV",78,0)
 S Y=+$G(^AUPNVSIT(PXBVST,0)) D DD^%DT
"RTN","PXBDPRV",79,0)
 W !,"No.",?4,"PROVIDER",?34,"PERSON CLASS ON  "_Y,?75,$C(32)
"RTN","PXBDPRV",80,0)
 W IOEDEOP
"RTN","PXBDPRV",81,0)
 D UNDOFF^PXBCC
"RTN","PXBDPRV",82,0)
 ;
"RTN","PXBDPRV",83,0)
 ;
"RTN","PXBDPRV",84,0)
 S J=PXBSTART F  S J=$O(PXBSAM(J)) Q:J=""  Q:J=(PXBSTART+(11))  D
"RTN","PXBDPRV",85,0)
 .S ENTRY=$G(PXBSAM(J)) I $D(PXBNCPT($P(ENTRY,"^",1))) S $P(ENTRY,"^",1)=$P(ENTRY,"^",1)_"*"
"RTN","PXBDPRV",86,0)
 .W !,J,?4,$E($P(ENTRY,"^",1),1,19),?25 W:$P(ENTRY,"^",2)["PRI" $P(ENTRY,"^",2) W ?34 W:ENTRY["**" IOINHI W $E($P(ENTRY,"^",3),1,42),IOINLOW
"RTN","PXBDPRV",87,0)
 .D DIS
"RTN","PXBDPRV",88,0)
 I SIGN'="BEGIN" W !!
"RTN","PXBDPRV",89,0)
 ;----UNCOMMENT LINE TO HAVE CLINIC PROVIDERS ON SCREEN--------------
"RTN","PXBDPRV",90,0)
 ;D DEF^PXBDPRV("A")
"RTN","PXBDPRV",91,0)
 D DEF^PXBDPRV("D") I '$D(FIRST) K PXBDPRV,PRVDR
"RTN","PXBDPRV",92,0)
 Q
"RTN","PXBDPRV",93,0)
 ;
"RTN","PXBDPRV",94,0)
 ;
"RTN","PXBDPRV",95,0)
DEF(CODE) ;---PROCESS DEFAULT LIST OF PROVDIERS
"RTN","PXBDPRV",96,0)
 ; I CODE="D" JUST SEND DEFAULT
"RTN","PXBDPRV",97,0)
 ; I CODE="A" JUST SEND THE ARRAY OF PROVIDERS
"RTN","PXBDPRV",98,0)
 D PRV^PXBUTL2(CLINIC)
"RTN","PXBDPRV",99,0)
 N PRV,X,CLNAME,STOP,LIST,NAME,NUMBER
"RTN","PXBDPRV",100,0)
 I '$D(IORC) D TERM^PXBCC
"RTN","PXBDPRV",101,0)
 I '$D(CODE) W !,"SEND PARAMETER = TO 'D'efault OR 'A'rray" Q
"RTN","PXBDPRV",102,0)
 I $G(CODE)="D",$D(PXBPMT("DEF")) S NAME=$O(PXBPMT("DEF",0)) S NUMBER=$O(PXBPMT("DEF",NAME,0)) S PXBDPRV=NUMBER_"^"_NAME S:$D(PRVDR) PXBDPRV="^"_$P(PRVDR("PRIMARY"),U)
"RTN","PXBDPRV",103,0)
 I $G(CODE)="A" K PXBPMT("DEF") D
"RTN","PXBDPRV",104,0)
 .S (PRV,STOP)="" F  S PRV=$O(PXBPMT("PRV",PRV)) Q:PRV=""  Q:STOP=0  D
"RTN","PXBDPRV",105,0)
 ..I '$D(PXBKY(PRV)) S STOP=0
"RTN","PXBDPRV",106,0)
 .I STOP="" Q
"RTN","PXBDPRV",107,0)
 .S CLNAME=$P(^SC(CLINIC,0),"^",1)
"RTN","PXBDPRV",108,0)
 .S X="Other Providers associated with "_CLNAME_" clinic."
"RTN","PXBDPRV",109,0)
 .W:PXBCNT<7 ! W !,?(IOM-$L(X))/2,IOINHI,X,IOINLOW
"RTN","PXBDPRV",110,0)
 .S (PRV,LIST)="" F  S PRV=$O(PXBPMT("PRV",PRV)) Q:PRV=""  D
"RTN","PXBDPRV",111,0)
 ..I $D(PXBKY(PRV)) Q
"RTN","PXBDPRV",112,0)
 ..S LIST=LIST_PRV_"  " I $L(LIST,"  ")>4 W !,?(IOM-$L(LIST))/2,LIST S LIST=""
"RTN","PXBDPRV",113,0)
 I $G(LIST)]"" W !,?(IOM-$L(LIST))/2,LIST
"RTN","PXBDPRV",114,0)
 Q
"RTN","PXBDPRV",115,0)
 ;
"RTN","PXBDPRV",116,0)
DIS ;----DISPLAY
"RTN","PXBDPRV",117,0)
 Q
"RTN","PXBDPRV",118,0)
 I $D(PXBPMT("PRV",$P($P(ENTRY,"^",1),"*"))) W:PXBCNT>11 IORVON W ?37," --Associated with the Clinic--",IORVOFF
"RTN","PXBDPRV",119,0)
 Q
"RTN","PXBDPRV",120,0)
 ;
"RTN","PXBGCPT2")
0^1^B35375264
"RTN","PXBGCPT2",1,0)
PXBGCPT2 ;ISL/JVS,ESW - DOUBLE ?? GATHERING OF CPT CODES ; 10/31/02 12:05pm
"RTN","PXBGCPT2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,19,108**;Aug 12, 1996
"RTN","PXBGCPT2",3,0)
 ;
"RTN","PXBGCPT2",4,0)
 ;
"RTN","PXBGCPT2",5,0)
 ;
"RTN","PXBGCPT2",6,0)
 W !,"NOT" Q
"RTN","PXBGCPT2",7,0)
 ;
"RTN","PXBGCPT2",8,0)
DOUBLE(FROM) ;--Entry
"RTN","PXBGCPT2",9,0)
 ;
"RTN","PXBGCPT2",10,0)
 N FILE,FIELD,TITLE,HEADING,SUB,CODE,NAME,START,SCREEN,BACK,NUM
"RTN","PXBGCPT2",11,0)
 N SCREEN,TEMP,FIRST
"RTN","PXBGCPT2",12,0)
 S BACK="",NUM=0,SCREEN=""
"RTN","PXBGCPT2",13,0)
 D LOC
"RTN","PXBGCPT2",14,0)
 I $D(DIC("S")) S SCREEN=DIC("S")
"RTN","PXBGCPT2",15,0)
 ;
"RTN","PXBGCPT2",16,0)
START ;
"RTN","PXBGCPT2",17,0)
 ;
"RTN","PXBGCPT2",18,0)
 S TITLE="- - A L L  P R O C E D U R E (CPT CODES) - -"
"RTN","PXBGCPT2",19,0)
 ;
"RTN","PXBGCPT2",20,0)
 D SETUP
"RTN","PXBGCPT2",21,0)
 D LIST^DIC(FILE,"",FIELD,BACK,10,.START,"","",SCREEN,"","^TMP(""PXBTANA"",$J)","^TMP(""PXBTANA"",$J)")
"RTN","PXBGCPT2",22,0)
 ;
"RTN","PXBGCPT2",23,0)
 D LOC,HEAD,SUB
"RTN","PXBGCPT2",24,0)
 ;
"RTN","PXBGCPT2",25,0)
PROMPT ;--PROMPT
"RTN","PXBGCPT2",26,0)
 D WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBGCPT2",27,0)
 W !!,"Enter '^' to quit,  '-' for previous page."
"RTN","PXBGCPT2",28,0)
 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGCPT2",29,0)
 S DIR("?")="Enter ITEM 'No' to select , '^' to quit,  '-' for previous page."
"RTN","PXBGCPT2",30,0)
 S DIR(0)="N,A,O^0:10:0^I X'?.1""-"".1""^"".2N!(+X>10) K X"
"RTN","PXBGCPT2",31,0)
 D ^DIR
"RTN","PXBGCPT2",32,0)
 I X="-" S BACK="B" D BACK G START
"RTN","PXBGCPT2",33,0)
 I X="" S BACK="" D FORWARD G START
"RTN","PXBGCPT2",34,0)
 I $G(DIRUT) K DIRUT S VAL="^C" G EXIT
"RTN","PXBGCPT2",35,0)
FINISH ;--FINISH
"RTN","PXBGCPT2",36,0)
 ;
"RTN","PXBGCPT2",37,0)
 S VAL=$G(^TMP("PXBTANA",$J,"DILIST",2,X))_U_$G(^TMP("PXBTANA",$J,"DILIST","ID",X,FIRST))_"--"_$G(^TMP("PXBTANA",$J,"DILIST","ID",X,SECOND))
"RTN","PXBGCPT2",38,0)
EXIT ;--EXIT
"RTN","PXBGCPT2",39,0)
 K DIR,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGCPT2",40,0)
 Q VAL
"RTN","PXBGCPT2",41,0)
 ;
"RTN","PXBGCPT2",42,0)
DOUBLE1(FROM) ;--Entry
"RTN","PXBGCPT2",43,0)
 ;
"RTN","PXBGCPT2",44,0)
NEW ;
"RTN","PXBGCPT2",45,0)
 N FILE,FIELD,TITLE,HEADING,SUB,CODE,NAME,START,SCREEN,CNT,OK,INDEX,CYCLE
"RTN","PXBGCPT2",46,0)
 N TOTAL,FIRST,SUB2
"RTN","PXBGCPT2",47,0)
 ;---SETUP
"RTN","PXBGCPT2",48,0)
 S BACK="",INDEX=""
"RTN","PXBGCPT2",49,0)
 S START=DATA,SUB=0,SUB2=0
"RTN","PXBGCPT2",50,0)
 ;
"RTN","PXBGCPT2",51,0)
START1 ;--RECYCLE
"RTN","PXBGCPT2",52,0)
 S TITLE="- - S E L E C T E D  P R O C E D U R E S (CPT CODES) - -"
"RTN","PXBGCPT2",53,0)
 S FILE=81
"RTN","PXBGCPT2",54,0)
 S FIELD=".01;2"
"RTN","PXBGCPT2",55,0)
 N TMP,LL,TT
"RTN","PXBGCPT2",56,0)
 S LL=$L(DATA),TT="0000"
"RTN","PXBGCPT2",57,0)
 I DATA?1.4N!(DATA?1A.3N) D
"RTN","PXBGCPT2",58,0)
 .S START=$O(^ICPT("B",DATA_$E(TT,1,5-LL)),-1)
"RTN","PXBGCPT2",59,0)
 I DATA?5N!(DATA?1A4N)!(DATA?4N1A) D
"RTN","PXBGCPT2",60,0)
 .S START=$O(^ICPT("B",START),-1)
"RTN","PXBGCPT2",61,0)
XXX W IOCUOFF,IOCUF,IOCUF
"RTN","PXBGCPT2",62,0)
 N TMP
"RTN","PXBGCPT2",63,0)
 S SUBT=START,TOTAL=0 F  S SUBT=$O(^ICPT("B",SUBT)) Q:SUBT'[DATA  D
"RTN","PXBGCPT2",64,0)
 .I '$$CPTSCREN^PXBUTL($O(^ICPT("B",SUBT,0)),IDATE) Q
"RTN","PXBGCPT2",65,0)
 .S TOTAL=TOTAL+1 S PXBMOD=TOTAL#100 D WAIT^PXBUTL
"RTN","PXBGCPT2",66,0)
 .S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,.01)=SUBT
"RTN","PXBGCPT2",67,0)
 .S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,2)=$P(^ICPT($O(^ICPT("B",SUBT,0)),0),U,2)
"RTN","PXBGCPT2",68,0)
 .S TMP(SUBT)=""
"RTN","PXBGCPT2",69,0)
 I DATA?1.4N!(DATA?.3N1A) D
"RTN","PXBGCPT2",70,0)
 .S START=$O(^ICPT("B",$E(TT,1,5-LL)_DATA),-1)
"RTN","PXBGCPT2",71,0)
 .S SUBT=START F  S SUBT=$O(^ICPT("B",SUBT)) Q:SUBT'[DATA  D
"RTN","PXBGCPT2",72,0)
 ..Q:$D(TMP(SUBT))
"RTN","PXBGCPT2",73,0)
 ..I '$$CPTSCREN^PXBUTL($O(^ICPT("B",SUBT,0)),IDATE) Q
"RTN","PXBGCPT2",74,0)
 ..S TOTAL=TOTAL+1 S PXBMOD=TOTAL#100 D WAIT^PXBUTL
"RTN","PXBGCPT2",75,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,.01)=SUBT
"RTN","PXBGCPT2",76,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,2)=$P(^ICPT($O(^ICPT("B",SUBT,0)),0),U,2)
"RTN","PXBGCPT2",77,0)
 W IOCUON
"RTN","PXBGCPT2",78,0)
 ;
"RTN","PXBGCPT2",79,0)
 ;
"RTN","PXBGCPT2",80,0)
 ;
"RTN","PXBGCPT2",81,0)
 I DATA?2.A W IOCUOFF,IOCUF,IOCUF S SUBT=$O(^ICPT("C",DATA),-1) F  S SUBT=$O(^ICPT("C",SUBT)) Q:SUBT'[DATA  D
"RTN","PXBGCPT2",82,0)
 .N IEN,CODE
"RTN","PXBGCPT2",83,0)
 .S IEN="" F  S IEN=$O(^ICPT("C",SUBT,IEN)) Q:IEN=""  D
"RTN","PXBGCPT2",84,0)
 ..S CODE=$P(^ICPT(IEN,0),U) I '$$CPTSCREN^PXBUTL(CODE,IDATE) Q
"RTN","PXBGCPT2",85,0)
 ..S TOTAL=TOTAL+1 S PXBMOD=TOTAL#100 D WAIT^PXBUTL
"RTN","PXBGCPT2",86,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,.01)=$P(^ICPT(IEN,0),U)
"RTN","PXBGCPT2",87,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",TOTAL,2)=SUBT_", "_$P(^ICPT(IEN,0),U,2)
"RTN","PXBGCPT2",88,0)
 W IOCUON
"RTN","PXBGCPT2",89,0)
 K SUBT
"RTN","PXBGCPT2",90,0)
 ;
"RTN","PXBGCPT2",91,0)
 ;
"RTN","PXBGCPT2",92,0)
 ;
"RTN","PXBGCPT2",93,0)
 ;--NO MATCH
"RTN","PXBGCPT2",94,0)
 I TOTAL=0 D
"RTN","PXBGCPT2",95,0)
 .I DATA?1A W ! D HELP^PXBUTL0("CPT4")
"RTN","PXBGCPT2",96,0)
 .I DATA'?1A W ! D HELP^PXBUTL0("CPTM")
"RTN","PXBGCPT2",97,0)
 .S ERROR=1,CYCL=1
"RTN","PXBGCPT2",98,0)
 I TOTAL=0 Q TOTAL
"RTN","PXBGCPT2",99,0)
 ;
"RTN","PXBGCPT2",100,0)
 ;--LIST
"RTN","PXBGCPT2",101,0)
 S HEADING="W !,""ITEM"",?6,""CODE"",?15,""DESCRIPTION   "",IOINHI,TOTAL,"" MATCHES"",IOINLOW"
"RTN","PXBGCPT2",102,0)
LIST ;-DISPLAY LIST TO THE SCREEN
"RTN","PXBGCPT2",103,0)
 I TOTAL=1 S X=1 G VAL
"RTN","PXBGCPT2",104,0)
 D LOC W !
"RTN","PXBGCPT2",105,0)
 X HEADING
"RTN","PXBGCPT2",106,0)
 S SUB=SUB-1
"RTN","PXBGCPT2",107,0)
 S NUM=0 F  S SUB=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB)) S NUM=NUM+1 Q:NUM=11  Q:SUB'>0  S SUB2=SUB2+1 D
"RTN","PXBGCPT2",108,0)
 .S CODE=$G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGCPT2",109,0)
 .S NAME=$E($G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,2)),1,64)
"RTN","PXBGCPT2",110,0)
 .W !,SUB,?6,CODE,?15,NAME
"RTN","PXBGCPT2",111,0)
 ;
"RTN","PXBGCPT2",112,0)
 ;--one
"RTN","PXBGCPT2",113,0)
 I TOTAL=1 G PRMPT2
"RTN","PXBGCPT2",114,0)
 ;
"RTN","PXBGCPT2",115,0)
PRMPT ;--PROMPT
"RTN","PXBGCPT2",116,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGCPT2",117,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGCPT2",118,0)
 W !
"RTN","PXBGCPT2",119,0)
 I SUB>0 W !,"Enter '^' to quit"
"RTN","PXBGCPT2",120,0)
 E  I TOTAL>10 W !,"               END OF LIST"
"RTN","PXBGCPT2",121,0)
 I SUB>0 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGCPT2",122,0)
 E  S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to exit: "
"RTN","PXBGCPT2",123,0)
 S DIR("?")="Enter ITEM 'No' to select , '^' to quit"
"RTN","PXBGCPT2",124,0)
 S DIR(0)="N,A,O^0:"_SUB2_":0^I X'?.1""^"".N K X"
"RTN","PXBGCPT2",125,0)
 D ^DIR
"RTN","PXBGCPT2",126,0)
 I X="",SUB>0 G LIST
"RTN","PXBGCPT2",127,0)
 I X="",SUB'>0 S X="^"
"RTN","PXBGCPT2",128,0)
VAL ;--VAL equal value
"RTN","PXBGCPT2",129,0)
 S VAL=$G(^TMP("PXBTOTAL",$J,"DILIST",2,X))_U_$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,.01))_"--"_$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,2))
"RTN","PXBGCPT2",130,0)
EXITNEW ;--EXIT
"RTN","PXBGCPT2",131,0)
 K DIR,DIRUT,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGCPT2",132,0)
 K TANA,TOTAL
"RTN","PXBGCPT2",133,0)
 Q VAL
"RTN","PXBGCPT2",134,0)
 Q
"RTN","PXBGCPT2",135,0)
 ;
"RTN","PXBGCPT2",136,0)
 ;--SUBROUTINES
"RTN","PXBGCPT2",137,0)
BACK ;
"RTN","PXBGCPT2",138,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,1))
"RTN","PXBGCPT2",139,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,1))
"RTN","PXBGCPT2",140,0)
 Q
"RTN","PXBGCPT2",141,0)
FORWARD ;
"RTN","PXBGCPT2",142,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,10))
"RTN","PXBGCPT2",143,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,10))
"RTN","PXBGCPT2",144,0)
 Q
"RTN","PXBGCPT2",145,0)
LOC ;--LOCATE CURSOR
"RTN","PXBGCPT2",146,0)
 D LOC^PXBCC(3,1) ;--LOCATE THE CURSOR
"RTN","PXBGCPT2",147,0)
 W IOEDEOP ;--CLEAR THE PAGE
"RTN","PXBGCPT2",148,0)
 Q
"RTN","PXBGCPT2",149,0)
HEAD ;--HEAD
"RTN","PXBGCPT2",150,0)
 W !,IOCUU,IOBON,"HELP SCREEN",IOSGR0,?(IOM-$L(TITLE))\2,IOINHI,TITLE,IOINLOW,IOELEOL
"RTN","PXBGCPT2",151,0)
 Q
"RTN","PXBGCPT2",152,0)
SUB ;--LIST
"RTN","PXBGCPT2",153,0)
 I $P(^TMP("PXBTANA",$J,"DILIST",0),U)=0 W !!,"     E N D  O F  L I S T" Q
"RTN","PXBGCPT2",154,0)
 X HEADING
"RTN","PXBGCPT2",155,0)
 S SUB=0,CNT=0 F  S SUB=$O(^TMP("PXBTANA",$J,"DILIST","ID",SUB)) Q:SUB'>0  S CNT=CNT+1 D
"RTN","PXBGCPT2",156,0)
 .S CODE=$G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,FIRST))
"RTN","PXBGCPT2",157,0)
 .S NAME=$G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,SECOND))
"RTN","PXBGCPT2",158,0)
 .W !,SUB,?6,CODE,?15,NAME
"RTN","PXBGCPT2",159,0)
 Q
"RTN","PXBGCPT2",160,0)
SETUP ;--SET
"RTN","PXBGCPT2",161,0)
 S FILE=81,FIRST=.01,SECOND=2
"RTN","PXBGCPT2",162,0)
 S FIELD=FIRST_";"_SECOND
"RTN","PXBGCPT2",163,0)
 S HEADING="W !,""ITEM"",?6,""CODE"",?15,""DESCRIPTION"""
"RTN","PXBGCPT2",164,0)
 Q
"RTN","PXBGCPT2",165,0)
PRMPT2 ;--Yes and No prompt
"RTN","PXBGCPT2",166,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGCPT2",167,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGCPT2",168,0)
 S DIR("A")="Is this the correct entry "
"RTN","PXBGCPT2",169,0)
 S DIR("B")="YES"
"RTN","PXBGCPT2",170,0)
 S DIR(0)="Y"
"RTN","PXBGCPT2",171,0)
 D ^DIR
"RTN","PXBGCPT2",172,0)
 I Y=0 S X="^"
"RTN","PXBGCPT2",173,0)
 I Y=1 S X=1
"RTN","PXBGCPT2",174,0)
 G VAL
"RTN","PXBGCPT2",175,0)
 ;
"RTN","PXBGCPT4")
0^4^B23123146
"RTN","PXBGCPT4",1,0)
PXBGCPT4 ;ISL/JVS,ESW - DOUBLE ?? GATHERING OF FORM PROCEDURES ; 10/31/02 12:06pm
"RTN","PXBGCPT4",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,73,43,108**;Aug 12, 1996
"RTN","PXBGCPT4",3,0)
 ;
"RTN","PXBGCPT4",4,0)
 ;
"RTN","PXBGCPT4",5,0)
 ;
"RTN","PXBGCPT4",6,0)
 W !,"THIS IS NOT AN ENTRY POINT" Q
"RTN","PXBGCPT4",7,0)
 ;  
"RTN","PXBGCPT4",8,0)
 ;
"RTN","PXBGCPT4",9,0)
DOUBLE1(FROM) ;--Entry point
"RTN","PXBGCPT4",10,0)
 ;
"RTN","PXBGCPT4",11,0)
NEW ;
"RTN","PXBGCPT4",12,0)
 ;
"RTN","PXBGCPT4",13,0)
 N FILE,FIELD,TITLE,HEADING,SUB,NAME,START,SCREEN,OK,INDEX,CYCLE
"RTN","PXBGCPT4",14,0)
 N TOTAL,PRV,CNT,PXBPMT,CODE,SUB2,SUBM,MODSTR,CNUM,MNUM,CONT,QT,PXMDIEN
"RTN","PXBGCPT4",15,0)
 ;---SETUP VARIABLES
"RTN","PXBGCPT4",16,0)
 S BACK="",INDEX=""
"RTN","PXBGCPT4",17,0)
 S START=DATA,(CONT,SUB,SUB2,SUBM)=0
"RTN","PXBGCPT4",18,0)
 ;
"RTN","PXBGCPT4",19,0)
START1 ;--RECYCLE POINT
"RTN","PXBGCPT4",20,0)
 S TITLE="- - F O R M    P R O C E D U R E S - -"
"RTN","PXBGCPT4",21,0)
 ;
"RTN","PXBGCPT4",22,0)
 D GETLST^IBDF18A(CLINIC,$P($T(CPT^PXBAICS),";;",2),"PXBPMT",,,1)
"RTN","PXBGCPT4",23,0)
 ;
"RTN","PXBGCPT4",24,0)
 S TOTAL=PXBPMT(0)
"RTN","PXBGCPT4",25,0)
 I PXBPMT(0)>0 D
"RTN","PXBGCPT4",26,0)
 .S (SUB,CNT)=""
"RTN","PXBGCPT4",27,0)
 .F  S SUB=$O(PXBPMT(SUB)) Q:SUB=""  D
"RTN","PXBGCPT4",28,0)
 ..S CODE=$P(PXBPMT(SUB),U)
"RTN","PXBGCPT4",29,0)
 ..I '(CODE?5N!(CODE?1A4N)!(CODE?4N1A)) Q  ;PX*1.0*108
"RTN","PXBGCPT4",30,0)
 ..I $P($G(^ICPT($O(^ICPT("B",CODE,0)),0)),U,4) Q
"RTN","PXBGCPT4",31,0)
 ..S NAME=$P(PXBPMT(SUB),U,2)
"RTN","PXBGCPT4",32,0)
 ..S CNT=CNT+1
"RTN","PXBGCPT4",33,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",CNT,.01)=CODE
"RTN","PXBGCPT4",34,0)
 ..S ^TMP("PXBTOTAL",$J,"DILIST","ID",CNT,2)=NAME
"RTN","PXBGCPT4",35,0)
 ..S SUBM=0
"RTN","PXBGCPT4",36,0)
 ..F  S SUBM=$O(PXBPMT(SUB,"MODIFIER",SUBM)) Q:SUBM=""  D
"RTN","PXBGCPT4",37,0)
 ...S PXMDIEN=+$$MODP^ICPTMOD(CODE,PXBPMT(SUB,"MODIFIER",SUBM),"E")
"RTN","PXBGCPT4",38,0)
 ...S MODSTR=$$MOD^ICPTMOD(PXMDIEN,"I")
"RTN","PXBGCPT4",39,0)
 ...I +MODSTR>0,$P(MODSTR,U,7) D
"RTN","PXBGCPT4",40,0)
 ....S ^TMP("PXBTOTAL",$J,"DILIST","ID",CNT,"MODIFIER",SUBM)=$P(MODSTR,U,2)_U_$P(MODSTR,U,3)
"RTN","PXBGCPT4",41,0)
 I $D(CNT) S TOTAL=CNT
"RTN","PXBGCPT4",42,0)
 ;
"RTN","PXBGCPT4",43,0)
 ;--DISPLAY IF NO MATCH FOUND
"RTN","PXBGCPT4",44,0)
 I TOTAL=0 W IOCUU,IOCUU,!,IOELEOL D
"RTN","PXBGCPT4",45,0)
 .;D LOC,HEAD
"RTN","PXBGCPT4",46,0)
 .D LOC W !
"RTN","PXBGCPT4",47,0)
 .S RESULTS="NO PROCEDURE BLOCKS EXIST FOR AN ENCOUNTER FORM"
"RTN","PXBGCPT4",48,0)
 .W !!!,?(IOM-$L(RESULTS))\2,RESULTS
"RTN","PXBGCPT4",49,0)
 .D HELP1^PXBUTL1("CON")
"RTN","PXBGCPT4",50,0)
 .R OK:DTIME
"RTN","PXBGCPT4",51,0)
 I TOTAL=0 S TOTAL="^C" Q TOTAL
"RTN","PXBGCPT4",52,0)
 ;
"RTN","PXBGCPT4",53,0)
 ;
"RTN","PXBGCPT4",54,0)
 ;----DISPLAY LIST TO THE SCREEN
"RTN","PXBGCPT4",55,0)
 S HEADING="W !,""ITEM"",?6,""CODE"",?13,""DESCRIPTION   "",IOINHI,TOTAL,"" ENTRIES"",IOINLOW"
"RTN","PXBGCPT4",56,0)
 ;
"RTN","PXBGCPT4",57,0)
LIST ;-DISPLAY LIST TO THE SCREEN
"RTN","PXBGCPT4",58,0)
 ;D LOC,HEAD
"RTN","PXBGCPT4",59,0)
 D LOC W !
"RTN","PXBGCPT4",60,0)
 X HEADING
"RTN","PXBGCPT4",61,0)
 S SUB=$P(CONT,U)-1
"RTN","PXBGCPT4",62,0)
 S (QT,CNUM,MNUM)=0
"RTN","PXBGCPT4",63,0)
 F  S SUB=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB)) Q:SUB'>0  S SUB2=SUB2+1 D  Q:QT
"RTN","PXBGCPT4",64,0)
 .S CNUM=CNUM+1
"RTN","PXBGCPT4",65,0)
 .I CNUM+MNUM=11 S CONT=SUB_U_0,QT=1 Q
"RTN","PXBGCPT4",66,0)
 .S CODE=$G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGCPT4",67,0)
 .S NAME=$G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,2))
"RTN","PXBGCPT4",68,0)
 .W !,SUB,?6,CODE,?13,NAME
"RTN","PXBGCPT4",69,0)
 .S SUBM=$P(CONT,U,2)-1
"RTN","PXBGCPT4",70,0)
 .S:$P(CONT,U,2)>0 $P(CONT,U,2)=0
"RTN","PXBGCPT4",71,0)
 .F  S SUBM=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,"MODIFIER",SUBM)) Q:SUBM=""  D  Q:QT
"RTN","PXBGCPT4",72,0)
 ..S MNUM=MNUM+1
"RTN","PXBGCPT4",73,0)
 ..I MNUM+CNUM=11 S CONT=SUB_U_SUBM,QT=1 Q
"RTN","PXBGCPT4",74,0)
 ..S MODSTR=^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,"MODIFIER",SUBM)
"RTN","PXBGCPT4",75,0)
 ..W !?6,"CPT Modifier:",?21,$P(MODSTR,U),?25,$P(MODSTR,U,2)
"RTN","PXBGCPT4",76,0)
 ;
"RTN","PXBGCPT4",77,0)
 ;----If There is only one selection go to proper prompting
"RTN","PXBGCPT4",78,0)
 I TOTAL=1 G PRMPT2
"RTN","PXBGCPT4",79,0)
 ;
"RTN","PXBGCPT4",80,0)
PRMPT ;---WRITE PROMPT HERE
"RTN","PXBGCPT4",81,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGCPT4",82,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGCPT4",83,0)
 W !
"RTN","PXBGCPT4",84,0)
 I SUB>0 W !,"Enter '^' to quit"
"RTN","PXBGCPT4",85,0)
 E  I TOTAL>10 W !,"               END OF LIST"
"RTN","PXBGCPT4",86,0)
 I SUB>0 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGCPT4",87,0)
 E  S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to exit: "
"RTN","PXBGCPT4",88,0)
 S DIR("?")="Enter ITEM 'No' to select , '^' to quit"
"RTN","PXBGCPT4",89,0)
 S DIR(0)="N,A,O^0:"_SUB2_":0^I X'?.1""^"".N K X"
"RTN","PXBGCPT4",90,0)
 D ^DIR
"RTN","PXBGCPT4",91,0)
 I X="",SUB>0 G LIST
"RTN","PXBGCPT4",92,0)
 I X="",SUB'>0 S X="^"
"RTN","PXBGCPT4",93,0)
 I $G(DIRUT) K DIRUT S VAL="^C" G EXITNEW
"RTN","PXBGCPT4",94,0)
VAL ;-----Set the VAL equal to the value
"RTN","PXBGCPT4",95,0)
 S VAL=$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,2))_"^"_$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,.01))
"RTN","PXBGCPT4",96,0)
 S (MODSTR,SUBM)=""
"RTN","PXBGCPT4",97,0)
 F  S SUBM=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",X,"MODIFIER",SUBM)) Q:SUBM=""  D
"RTN","PXBGCPT4",98,0)
 .S MODSTR=MODSTR_$S(MODSTR]"":",",1:"")_$P(^TMP("PXBTOTAL",$J,"DILIST","ID",X,"MODIFIER",SUBM),U)
"RTN","PXBGCPT4",99,0)
EXITNEW ;--EXIT
"RTN","PXBGCPT4",100,0)
 K DIR,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGCPT4",101,0)
 K TANA,TOTAL
"RTN","PXBGCPT4",102,0)
 Q VAL_U_$G(MODSTR)
"RTN","PXBGCPT4",103,0)
 ;
"RTN","PXBGCPT4",104,0)
 ;-----------------SUBROUTINES--------------
"RTN","PXBGCPT4",105,0)
BACK ;
"RTN","PXBGCPT4",106,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,1))
"RTN","PXBGCPT4",107,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,1))
"RTN","PXBGCPT4",108,0)
 Q
"RTN","PXBGCPT4",109,0)
FORWARD ;
"RTN","PXBGCPT4",110,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,10))
"RTN","PXBGCPT4",111,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,10))
"RTN","PXBGCPT4",112,0)
 Q
"RTN","PXBGCPT4",113,0)
LOC ;--LOCATE CURSOR
"RTN","PXBGCPT4",114,0)
 D LOC^PXBCC(3,1) ;--LOCATE THE CURSOR
"RTN","PXBGCPT4",115,0)
 W IOEDEOP ;--CLEAR THE PAGE
"RTN","PXBGCPT4",116,0)
 Q
"RTN","PXBGCPT4",117,0)
HEAD ;--HEAD
"RTN","PXBGCPT4",118,0)
 W !,IOCUU,IOBON,"HELP SCREEN",IOSGR0
"RTN","PXBGCPT4",119,0)
 W ?(IOM-$L(TITLE))\2,IOINHI,TITLE,IOINLOW,IOELEOL
"RTN","PXBGCPT4",120,0)
 Q
"RTN","PXBGCPT4",121,0)
SUB ;--DISPLAY LIST TO THE SCREEN
"RTN","PXBGCPT4",122,0)
 I $P(^TMP("PXBTANA",$J,"DILIST",0),"^",1)=0 W !!,"     E N D  O F  L I S T" Q
"RTN","PXBGCPT4",123,0)
 X HEADING
"RTN","PXBGCPT4",124,0)
 S SUB=0,CNT=0
"RTN","PXBGCPT4",125,0)
 F  S SUB=$O(^TMP("PXBTANA",$J,"DILIST","ID",SUB)) Q:SUB'>0  S CNT=CNT+1 D
"RTN","PXBGCPT4",126,0)
 .S NAME=$G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGCPT4",127,0)
 .W !,SUB,?6,NAME
"RTN","PXBGCPT4",128,0)
 Q
"RTN","PXBGCPT4",129,0)
SETUP ;-SETP VARIABLES
"RTN","PXBGCPT4",130,0)
 S FILE=200,FIELD=.01
"RTN","PXBGCPT4",131,0)
 S HEADING="W !,""ITEM"",?6,""NAME"""
"RTN","PXBGCPT4",132,0)
 Q
"RTN","PXBGCPT4",133,0)
PRMPT2 ;-----Yes and No prompt if only one choice
"RTN","PXBGCPT4",134,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGCPT4",135,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGCPT4",136,0)
 S DIR("A")="Is this the correct entry "
"RTN","PXBGCPT4",137,0)
 S DIR("B")="YES"
"RTN","PXBGCPT4",138,0)
 S DIR(0)="Y"
"RTN","PXBGCPT4",139,0)
 D ^DIR
"RTN","PXBGCPT4",140,0)
 I Y=0 S X="^"
"RTN","PXBGCPT4",141,0)
 I Y=1 S X=1
"RTN","PXBGCPT4",142,0)
 G VAL
"RTN","PXBGCPT4",143,0)
 ;
"RTN","PXBGPRV")
0^12^B42937330
"RTN","PXBGPRV",1,0)
PXBGPRV ;ISL/JVS,ESW - GATHER PROVIDERS ; 12/5/02 11:35am
"RTN","PXBGPRV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**7,11,108**;Aug 12, 1996
"RTN","PXBGPRV",3,0)
 ;
"RTN","PXBGPRV",4,0)
PRV(VISIT,PXBSKY,PXBKY,PXBSAM,PXBCNT,PRVDR,FPRI) ;--Gather the entries in the V PROVIDER file
"RTN","PXBGPRV",5,0)
 ;
"RTN","PXBGPRV",6,0)
 ;Output:
"RTN","PXBGPRV",7,0)
 ;       PXBSKY(PXBC,IEN)=PRVI
"RTN","PXBGPRV",8,0)
 ;       PXBKY(NAME,PXBC)=NAME^P^TYPE^PRVI
"RTN","PXBGPRV",9,0)
 ;       PXBSAM(PXBC)=NAME^P^TYPE^PRVI
"RTN","PXBGPRV",10,0)
 ;       PRVDR("PRIMARY")=NAME^IEN^PRVI
"RTN","PXBGPRV",11,0)
 ;       PXBCNT
"RTN","PXBGPRV",12,0)
 ;       FPRI
"RTN","PXBGPRV",13,0)
 ;where:
"RTN","PXBGPRV",14,0)
 ;       PXBC - sequence in an order of providers name
"RTN","PXBGPRV",15,0)
 ;       IEN  - of ^AUPNVPRV(
"RTN","PXBGPRV",16,0)
 ;       NAME - provider's name (LAST,FIRST...)
"RTN","PXBGPRV",17,0)
 ;       P    - PRIMARY or SECONDARY
"RTN","PXBGPRV",18,0)
 ;       PRVI - IEN of ^VA(200,
"RTN","PXBGPRV",19,0)
 ;       PXBCNT - provider count
"RTN","PXBGPRV",20,0)
 ;       FPRI:
"RTN","PXBGPRV",21,0)
 ;             0 - Primary not selected
"RTN","PXBGPRV",22,0)
 ;             1 - Primary selected
"RTN","PXBGPRV",23,0)
 ;
"RTN","PXBGPRV",24,0)
 N IEN,QUANTITY,PROVIDER,PRIMARY,PRV,GROUP,PXBC
"RTN","PXBGPRV",25,0)
 N DIC,DR,DA,DIQ,PRVI,TYPE
"RTN","PXBGPRV",26,0)
 ;
"RTN","PXBGPRV",27,0)
 K ^TMP("PXBU",$J),PRV,PXBKY,VAUGHN,PXBSAM,PXBSKY,PXBCNT,PXBPRV,FPRI
"RTN","PXBGPRV",28,0)
 K PRVDR
"RTN","PXBGPRV",29,0)
 S FPRI=""
"RTN","PXBGPRV",30,0)
 ; create an array of current providers without duplicates, with their
"RTN","PXBGPRV",31,0)
 ; ^(0) node as a value
"RTN","PXBGPRV",32,0)
 I $D(^AUPNVPRV("AD",VISIT)) D
"RTN","PXBGPRV",33,0)
 .D GETPRV^PXAPIOE(VISIT,"^TMP(""PXBU"",$J,""PRV"")")
"RTN","PXBGPRV",34,0)
 ;
"RTN","PXBGPRV",35,0)
A ;--Set array with PROVIDERS
"RTN","PXBGPRV",36,0)
 ;
"RTN","PXBGPRV",37,0)
 I $G(^TMP("PXBU",$J,"PRV")) D
"RTN","PXBGPRV",38,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXBU",$J,"PRV",IEN)) Q:IEN'>0  D
"RTN","PXBGPRV",39,0)
 ..S PRIMARY=$S($P(^(IEN),U,4)="P":"PRIMARY",1:"SECONDARY")
"RTN","PXBGPRV",40,0)
 ..S PRVI=+^(IEN),TYPEI=$P(^(IEN),U,6)
"RTN","PXBGPRV",41,0)
 ..S DIC=200,DIC1=DIC,DR=.01,DA=PRVI,DIQ="PRVN" D EN^DIQ1 D
"RTN","PXBGPRV",42,0)
 ...S PRV=PRVN(DIC1,DA,DR)
"RTN","PXBGPRV",43,0)
 ..S FPRI=FPRI_$E(PRIMARY,1,3) ;-Creating Flag for Primary prompt
"RTN","PXBGPRV",44,0)
 ..S TYPE=$$OCCUP("","","",2,TYPEI) D
"RTN","PXBGPRV",45,0)
 ...N Y,DATE
"RTN","PXBGPRV",46,0)
 ...S Y=+$P($G(^AUPNVSIT(VISIT,0)),U) X ^DD("DD") S DATE=$P(Y,"@",1)
"RTN","PXBGPRV",47,0)
 ...I TYPEI="" S TYPE=$$GET^XUA4A72(PRVI,+$P($G(^AUPNVSIT(VISIT,0)),U))
"RTN","PXBGPRV",48,0)
 ...I +TYPE=-2 S TYPE="*** CLASS not 'ACTIVE' on "_DATE_"***"
"RTN","PXBGPRV",49,0)
 ...I +TYPE=-1 S TYPE=""
"RTN","PXBGPRV",50,0)
 ...;I +TYPE>0 S TYPE="**** DELETE and RE-ENTER PROVIDER****"
"RTN","PXBGPRV",51,0)
 ...I +TYPE>0 S TYPE=""
"RTN","PXBGPRV",52,0)
 ..S GROUP=PRV_U_PRIMARY_U_TYPE_U_PRVI
"RTN","PXBGPRV",53,0)
 ..I PRIMARY["PRI" S PRVDR("PRIMARY")=PRV_U_IEN_U_PRVI
"RTN","PXBGPRV",54,0)
 ..S PRV(PRV,IEN)=GROUP
"RTN","PXBGPRV",55,0)
 K ^TMP("PXBU",$J,"PRV")
"RTN","PXBGPRV",56,0)
 ;
"RTN","PXBGPRV",57,0)
B ;--Add line numbers
"RTN","PXBGPRV",58,0)
 ;create local arrays with data from existing providers
"RTN","PXBGPRV",59,0)
 I $D(PRV) D
"RTN","PXBGPRV",60,0)
 .S PXBC=0,PRV="" F  S PRV=$O(PRV(PRV)) Q:PRV=""  D
"RTN","PXBGPRV",61,0)
 ..S IEN=0 F  S IEN=$O(PRV(PRV,IEN)) Q:IEN=""  S PXBC=PXBC+1 D
"RTN","PXBGPRV",62,0)
 ...S PXBKY(PRV,PXBC)=$G(PRV(PRV,IEN)),PXBSAM(PXBC)=$G(PRV(PRV,IEN))
"RTN","PXBGPRV",63,0)
 ...S PXBSKY(PXBC,IEN)=$P(PRV(PRV,IEN),U,4)
"RTN","PXBGPRV",64,0)
 ...K PRV(PRV,IEN)
"RTN","PXBGPRV",65,0)
FINISH ;--Finish up some variables
"RTN","PXBGPRV",66,0)
 S:FPRI'["PRI" FPRI=0 S:FPRI["PRI" FPRI=1
"RTN","PXBGPRV",67,0)
 ;FPRI=0 Then there is no Primary Selected yet
"RTN","PXBGPRV",68,0)
EXIT ;--set a providers count
"RTN","PXBGPRV",69,0)
 S PXBCNT=+$G(PXBC)
"RTN","PXBGPRV",70,0)
 Q
"RTN","PXBGPRV",71,0)
 ;
"RTN","PXBGPRV",72,0)
OCCUP(IEN,DATE,CODE,RETURN,CLASSIEN) ;--FORMAT PERSON CLASS TO DISPLAY
"RTN","PXBGPRV",73,0)
 ; IEN      = Provider pointer to file# 200
"RTN","PXBGPRV",74,0)
 ; DATE     = Date of occurrence of service
"RTN","PXBGPRV",75,0)
 ; CODE     = Person class Code (if already known)
"RTN","PXBGPRV",76,0)
 ;          **(Required step) If you use code leave IEN and DATE Blank
"RTN","PXBGPRV",77,0)
 ; RETURN   = (Required) Flag to decide what format you want the
"RTN","PXBGPRV",78,0)
 ;          return value.
"RTN","PXBGPRV",79,0)
 ; CLASSIEN = Ien of entry in the PERSON CLASS file#8932.1 If the Ien
"RTN","PXBGPRV",80,0)
 ;            was saved this parameter could be sent in instead of CODE.
"RTN","PXBGPRV",81,0)
 ; 
"RTN","PXBGPRV",82,0)
 ;   1    = IEN^OCCUPATION^SPECIALITY^SUBSPECIALITY^STATUS^DATE INACTIVATED^VA CODE
"RTN","PXBGPRV",83,0)
 ;   2    = Short Description
"RTN","PXBGPRV",84,0)
 ;   3    = Short Description^VA CODE
"RTN","PXBGPRV",85,0)
 ;        *** If only CODE and RETURN = 1 There is no value or other
"RTN","PXBGPRV",86,0)
 ;            value in the STATUS and DATE INACTIVATED fields.
"RTN","PXBGPRV",87,0)
 ;
"RTN","PXBGPRV",88,0)
 ; Output:
"RTN","PXBGPRV",89,0)
 ;        -1 "no comment" function call to person class couldn't find
"RTN","PXBGPRV",90,0)
 ;            a class for that person.
"RTN","PXBGPRV",91,0)
 ;        -1^COMMENT This function is called incorrectly
"RTN","PXBGPRV",92,0)
 ;        -2 "no comment" There is no ACTIVE person class for provider
"RTN","PXBGPRV",93,0)
 ;            based on the date provided.
"RTN","PXBGPRV",94,0)
 ;
"RTN","PXBGPRV",95,0)
 N OCC,SPE,SUB,ENTRY,DIS,OCCL,TYPE,VACODE,ANS
"RTN","PXBGPRV",96,0)
 ;--VALIDATE
"RTN","PXBGPRV",97,0)
 I (+$G(IEN)'>0)&($L(IEN)>0) Q -1_"^INVALID PERSON IEN"
"RTN","PXBGPRV",98,0)
 I '$G(IEN),'$G(DATE),$G(CODE)="",'$G(RETURN),'$G(CLASSIEN) Q -1_"^NO PARAMETERS"
"RTN","PXBGPRV",99,0)
 I '$G(IEN),'$G(DATE),$G(CODE)="",$G(RETURN),'$G(CLASSIEN) Q -1_"^NO PARAMETERS"
"RTN","PXBGPRV",100,0)
 I '$G(RETURN) Q -1_"^NO RETURN PARAMETER (Required)"
"RTN","PXBGPRV",101,0)
 I $G(RETURN)]"",(RETURN'<4!(RETURN'>0)) Q -1_"^RETURN MUST BE 1,2,or 3"
"RTN","PXBGPRV",102,0)
 I DATE]"",+DATE'>0 Q -1_"^INVALID FILEMAN DATE"
"RTN","PXBGPRV",103,0)
 I $G(IEN) Q:'$D(^VA(200,$G(IEN))) -1_"^NO SUCH IEN IN FILE# 200"
"RTN","PXBGPRV",104,0)
 I $G(IEN),$G(DATE) D  I $G(RETURN)=1 Q TYPE
"RTN","PXBGPRV",105,0)
 .S TYPE=$$GET^XUA4A72(IEN,DATE),VACODE=$P(TYPE,U,7)
"RTN","PXBGPRV",106,0)
 I $G(IEN),$G(DATE),+TYPE<0 Q TYPE
"RTN","PXBGPRV",107,0)
 ;
"RTN","PXBGPRV",108,0)
 ;---CONVERT IEN TO CODE
"RTN","PXBGPRV",109,0)
 I $G(CLASSIEN) S CODE=$$IEN2CODE^XUA4A72(CLASSIEN)
"RTN","PXBGPRV",110,0)
 ;
"RTN","PXBGPRV",111,0)
 I $G(CODE)]"",'$G(IEN),'$G(DATE) S TYPE=$O(^USC(8932.1,"F",$G(CODE),0)),VACODE=CODE I $G(RETURN)=1 S ANS=TYPE_U_$G(^USC(8932.1,TYPE,0)) Q ANS
"RTN","PXBGPRV",112,0)
 S ENTRY=$G(^USC(8932.1,+TYPE,0))
"RTN","PXBGPRV",113,0)
OCC ;---OCCUPATION
"RTN","PXBGPRV",114,0)
 S OCCL=$P(ENTRY,U)
"RTN","PXBGPRV",115,0)
 S OCC=$P($P(ENTRY,U)," ",1)
"RTN","PXBGPRV",116,0)
 I OCCL["Physicians (M.D" S OCC="Physician"
"RTN","PXBGPRV",117,0)
 I OCCL["Physician Assistant" S OCC=OCCL
"RTN","PXBGPRV",118,0)
 I OCCL["Speech, Language" S OCC="Language"
"RTN","PXBGPRV",119,0)
 I OCCL["Technologists" S OCC="Technical"
"RTN","PXBGPRV",120,0)
 I OCCL["Eye and Vision" S OCC="Ophthalmic"
"RTN","PXBGPRV",121,0)
 I OCCL["Respiratory, Rehab" S OCC="Therapist"
"RTN","PXBGPRV",122,0)
 I OCCL["Podiatric" S OCC="Podiatry"
"RTN","PXBGPRV",123,0)
 ;
"RTN","PXBGPRV",124,0)
SPE ;--SPECIALITY
"RTN","PXBGPRV",125,0)
 S SPEL=$P(ENTRY,U,2)
"RTN","PXBGPRV",126,0)
 S SPE=$P(ENTRY,U,2)
"RTN","PXBGPRV",127,0)
 I SPEL["Registered Nurse" S SPE="R.N."
"RTN","PXBGPRV",128,0)
 I SPEL["Dentist" S SPE="Dentist"
"RTN","PXBGPRV",129,0)
 I SPEL["Clinical Services" S SPE="Clinical"
"RTN","PXBGPRV",130,0)
 I SPEL["Non-R.N.s" S SPE="Non R.N."
"RTN","PXBGPRV",131,0)
 I SPEL["Radiologic Sciences" S SPE="Radiology"
"RTN","PXBGPRV",132,0)
 I SPEL["Clinical Path" S SPE=""
"RTN","PXBGPRV",133,0)
 I SPEL["Physical Therap" S SPE="P.T."
"RTN","PXBGPRV",134,0)
 I SPEL["Obstetrics and Gynecology" S SPE="Ob. & Gyn."
"RTN","PXBGPRV",135,0)
 I SPEL["iatry and Neur" S SPE="Psyc & Neuro"
"RTN","PXBGPRV",136,0)
 I SPEL["Clinical Specialist" S SPE="Clinical"
"RTN","PXBGPRV",137,0)
 I SPEL["Registered Dietitian" S SPE="R. Dietitian"
"RTN","PXBGPRV",138,0)
 I SPEL["Rehabilitation Prac" S SPE="Rehabilitation"
"RTN","PXBGPRV",139,0)
 I OCC["Physician"&(SPE["Internal Medicine") S SPE="Internist"
"RTN","PXBGPRV",140,0)
 ;
"RTN","PXBGPRV",141,0)
SUB ;--SUBSPECIALITY
"RTN","PXBGPRV",142,0)
 S SUBL=$P(ENTRY,U,3)
"RTN","PXBGPRV",143,0)
 S SUB=$P(ENTRY,U,3)
"RTN","PXBGPRV",144,0)
 I SUB["Counselor"&(SPE["Counselor") S SPE=""
"RTN","PXBGPRV",145,0)
 I SUB["Therapist"&(SPE["Therapist") S SPE=""
"RTN","PXBGPRV",146,0)
 I SUB["Nurse"&(SPE["Nurse") S SPE=""
"RTN","PXBGPRV",147,0)
 I SUB["Pediatric"&(SPE["Pediatric") S SPE=""
"RTN","PXBGPRV",148,0)
 I SUB["Psychiatry"&(SPE["Psychiatry") S SPE=""
"RTN","PXBGPRV",149,0)
 I SUB["Podiatri"&(SPE["Podiatri") S SPE=""
"RTN","PXBGPRV",150,0)
 I SUB["Clinical and Laboratory Immunology" S SUB="Clin & Lab Immunology"
"RTN","PXBGPRV",151,0)
 I SUB["Clinical & Laboratory Immunology" S SUB="Clin & Lab Immunology"
"RTN","PXBGPRV",152,0)
 I SUB["cine-Envir" S SUB="Occ & Environmental"
"RTN","PXBGPRV",153,0)
 I SUB["Child and Adolescent Psyc" S SUB="Pediatric Mental Health"
"RTN","PXBGPRV",154,0)
 I SUB["ist in Meta" S SUB="Metabolic"
"RTN","PXBGPRV",155,0)
 I SUB["ist in Pedia" S SUB="Pediatric"
"RTN","PXBGPRV",156,0)
 I SUB["ist in Renal" S SUB="Renal"
"RTN","PXBGPRV",157,0)
 I SUB["tion Intern" S SUB="Intern"
"RTN","PXBGPRV",158,0)
 I SUB["tion Coordin" S SUB="Coordinator"
"RTN","PXBGPRV",159,0)
 I SUB["tion Counselor" S SUB="Counselor"
"RTN","PXBGPRV",160,0)
 I SUB["for the Blind" S SUB="Orientation for Blind"
"RTN","PXBGPRV",161,0)
 I SUB["Dosimetrist" S SUB="Planning, Dosimetrist"
"RTN","PXBGPRV",162,0)
 I SPEL["Respiratory Care Pr"&(SUB'="") S SPE=""
"RTN","PXBGPRV",163,0)
 ;
"RTN","PXBGPRV",164,0)
 ;--CALCULATE THE BEST DISPLAY
"RTN","PXBGPRV",165,0)
 S DISL=OCCL_"-"_SPEL_"-"_SUBL
"RTN","PXBGPRV",166,0)
 S DIS=OCC_"/"_SPE_"/"_SUB
"RTN","PXBGPRV",167,0)
 I SUB[SPE S DIS=OCC_"/"_SUB
"RTN","PXBGPRV",168,0)
 I SPE="" S DIS=OCC_"/"_SUB
"RTN","PXBGPRV",169,0)
 I SUB="" S DIS=OCC_"/"_SPE
"RTN","PXBGPRV",170,0)
AND I $L(DIS," and ")>1 D
"RTN","PXBGPRV",171,0)
 .N I F I=1:1:$L(DIS," ") I $P(DIS," ",I)="and" S $P(DIS," ",I)="&"
"RTN","PXBGPRV",172,0)
 I $L(DIS," and ")>1 G AND
"RTN","PXBGPRV",173,0)
 ;Q $E(DIS,1,40)_"   "_$L(DIS)
"RTN","PXBGPRV",174,0)
 ;Q $E(DIS,1,40)_"***"_OCCL
"RTN","PXBGPRV",175,0)
 ;Q SPE_"  ***  "_SPEL
"RTN","PXBGPRV",176,0)
 ;Q SUB_"  ***  "_SUBL
"RTN","PXBGPRV",177,0)
 ;Q DISL_"~"_DIS
"RTN","PXBGPRV",178,0)
 ;Q ""_"~"_DIS
"RTN","PXBGPRV",179,0)
 I $G(RETURN)=2 Q DIS
"RTN","PXBGPRV",180,0)
 I $G(RETURN)=3 Q DIS_U_VACODE
"RTN","PXBGPRV",181,0)
 Q -1_"^SOMETHING BAD WRONG_SHOULDN'T BE HERE"
"RTN","PXBMCPT")
0^14^B16530875
"RTN","PXBMCPT",1,0)
PXBMCPT ;ISL/JVS,ESW - MAIN ROUTINE CPT CODES ; 12/5/02 11:36am
"RTN","PXBMCPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,108**;Aug 12, 1996
"RTN","PXBMCPT",3,0)
 ;
"RTN","PXBMCPT",4,0)
 W !,"This is not the entry into this routine" Q
"RTN","PXBMCPT",5,0)
 ;
"RTN","PXBMCPT",6,0)
 ;  VARABLE LIST
"RTN","PXBMCPT",7,0)
 ;
"RTN","PXBMCPT",8,0)
 ;
"RTN","PXBMCPT",9,0)
CPT(PXBVST) ;---Real entry point
"RTN","PXBMCPT",10,0)
 Q:'$D(^AUPNVSIT(PXBVST))
"RTN","PXBMCPT",11,0)
 D CPT^PXBMCPT2(PXBVST) Q
"RTN","PXBMCPT",12,0)
 S TEST=1
"RTN","PXBMCPT",13,0)
 ; PXBVST  = Appointment-Encounter Visit IEN
"RTN","PXBMCPT",14,0)
 ; PXBDPRV = Default Provider for clinic appointment IEN
"RTN","PXBMCPT",15,0)
 ;--Set up
"RTN","PXBMCPT",16,0)
 N PXBCNT,I,J,IDATE,PRIP,PRIPOV,PRISEC,QUA,VISIT,PRI,POV,PRV,PXBENT,SAVE,PXBSKY,PXBKY,PXBSAM,PXBCNT,PRVDR
"RTN","PXBMCPT",17,0)
 N PXBUT,FPRI,ENTRY,PXBSAVE,NAME,VAR,DOUBLEQQ,CPTQUA,PXBPRV,ERROR
"RTN","PXBMCPT",18,0)
 N REQI,REQE,DATA,PROMPT,FIRSTCPT,KFIRST,FROM,IDATE,%,CYCL
"RTN","PXBMCPT",19,0)
 N PXBNCPT,PXBNPRV,PXBNPOV,FIRST,PXBWIN,CLINIC,PXBPMT,LEAVE,PATIENT
"RTN","PXBMCPT",20,0)
 N FROM,NOREV
"RTN","PXBMCPT",21,0)
 S (REQE,REQI)=""
"RTN","PXBMCPT",22,0)
 S CLINIC=$P(^AUPNVSIT(PXBVST,0),"^",22),PROMPT="CPT"
"RTN","PXBMCPT",23,0)
 ;--KILL OF THE TMP GLOGALS IN ALL PROMPTS
"RTN","PXBMCPT",24,0)
 S ^TMP("PXBDCPT",$J,"START")=0,FIRST=1,FIRSTCPT=1,PXBEXIT=1
"RTN","PXBMCPT",25,0)
 ;
"RTN","PXBMCPT",26,0)
P ;--Obtain the correct provider
"RTN","PXBMCPT",27,0)
 I $G(DOUBLEQQ) S FIRST=1
"RTN","PXBMCPT",28,0)
 D TERM^PXBCC
"RTN","PXBMCPT",29,0)
 D HDR^PXBUTL(PXBVST,1),REQ^PXBDREQ(4)
"RTN","PXBMCPT",30,0)
 D PRV^PXBGPRV(PXBVST,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI)
"RTN","PXBMCPT",31,0)
 I $G(TEST)=1 S FROM="CPT" D EN0^PXBDPRV K FROM
"RTN","PXBMCPT",32,0)
 I $G(TEST)=2 D CPT^PXBGCPT(PXBVST)
"RTN","PXBMCPT",33,0)
 I $G(TEST)=2 D EN0^PXBDCPT
"RTN","PXBMCPT",34,0)
R D WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBMCPT",35,0)
 K ERROR S FROM="CPT" D PRV^PXBPPRV W:$D(CYCL) IOSC K FROM G:$G(PXBEXIT)<1 CPTXIT G:$G(ERROR) R K CYCL
"RTN","PXBMCPT",36,0)
 W IOEDEOP
"RTN","PXBMCPT",37,0)
 I $G(DOUBLEQQ)=1,'$P(REQI,"^",1) G P
"RTN","PXBMCPT",38,0)
 I DATA["^P" D RSET^PXBDREQ("PRV") G P
"RTN","PXBMCPT",39,0)
 I $G(PXBUT)=1,'$D(FIRST) G CPTXIT
"RTN","PXBMCPT",40,0)
 I $G(PXBUT)=1,$D(LEAVE) G CPTXIT
"RTN","PXBMCPT",41,0)
 K FIRST
"RTN","PXBMCPT",42,0)
 ;
"RTN","PXBMCPT",43,0)
 ;--Prompt for Primary or Secondary Provider
"RTN","PXBMCPT",44,0)
 S PROMPT="CPT^PRV" D PRI^PXBPPRV1 S PROMPT="CPT"
"RTN","PXBMCPT",45,0)
 I $D(DIRUT) G P
"RTN","PXBMCPT",46,0)
 ;
"RTN","PXBMCPT",47,0)
 ;--Display the Requested Provider
"RTN","PXBMCPT",48,0)
 D PRINT^PXBDREQ(1)
"RTN","PXBMCPT",49,0)
 D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBMCPT",50,0)
 ;
"RTN","PXBMCPT",51,0)
 ;--File the Provider data into the V files
"RTN","PXBMCPT",52,0)
 D EN1^PXKMAIN
"RTN","PXBMCPT",53,0)
 ;
"RTN","PXBMCPT",54,0)
C ;--Display the CPT codes
"RTN","PXBMCPT",55,0)
 D LOC^PXBCC(3,1) W IOEDEOP
"RTN","PXBMCPT",56,0)
 D CPT^PXBGCPT(PXBVST)
"RTN","PXBMCPT",57,0)
 D EN0^PXBDCPT
"RTN","PXBMCPT",58,0)
R2 D WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBMCPT",59,0)
 K ERROR D CPT^PXBPCPT G:$G(PXBEXIT)<1 CPTXIT G:$G(ERROR) R2 W IOEDEOP
"RTN","PXBMCPT",60,0)
 I DATA=""!(DATA["^P") D RSET^PXBDREQ("CPT"),RSET^PXBDREQ("PRV") K DIRUT,PXBUT G P
"RTN","PXBMCPT",61,0)
 I DATA["^C" D RSET^PXBDREQ("CPT") G C
"RTN","PXBMCPT",62,0)
 I DATA=""!(DATA["^") D RSET^PXBDREQ("CPT"),RSET^PXBDREQ("PRV") K DIRUT,PXBUT G P
"RTN","PXBMCPT",63,0)
 ;
"RTN","PXBMCPT",64,0)
 ;--Display the requested CPT code
"RTN","PXBMCPT",65,0)
 D PRINT^PXBDREQ(2)
"RTN","PXBMCPT",66,0)
 ;
"RTN","PXBMCPT",67,0)
Q ;--Prompt of the QUANTITY of the CPT code
"RTN","PXBMCPT",68,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBMCPT",69,0)
 S PROMPT="CPT^QUA" D QUA^PXBPQUA S PROMPT="CPT"
"RTN","PXBMCPT",70,0)
 I EDATA["^C" D RSET^PXBDREQ("CPT") G C
"RTN","PXBMCPT",71,0)
 I EDATA["^P" D RSET^PXBDREQ("CPT"),RSET^PXBDREQ("PRV") K DIRUT,PXBUT G P
"RTN","PXBMCPT",72,0)
 ;
"RTN","PXBMCPT",73,0)
 ;--Create The ^TMP("PXK", ARRAY
"RTN","PXBMCPT",74,0)
 D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBMCPT",75,0)
 ;--File the data into the V files
"RTN","PXBMCPT",76,0)
 D EN1^PXKMAIN
"RTN","PXBMCPT",77,0)
 D RSET^PXBDREQ("CPT")
"RTN","PXBMCPT",78,0)
 G C
"RTN","PXBMCPT",79,0)
 ;
"RTN","PXBMCPT",80,0)
CPTXIT ;----EXIT AND CLEAN UP
"RTN","PXBMCPT",81,0)
 D KILL^PXBUTL3
"RTN","PXBMCPT",82,0)
 D PRIM^PXBUTL
"RTN","PXBMCPT",83,0)
 D FULL0^PXBCC
"RTN","PXBMCPT",84,0)
 D CLEAR1^PXBCC
"RTN","PXBMCPT",85,0)
 K PXBKY,PXBSAM,PXBSKY,PXBVST
"RTN","PXBMCPT",86,0)
 ;
"RTN","PXBMCPT",87,0)
 ;----Do the EVENT to the Protocol
"RTN","PXBMCPT",88,0)
 K ^TMP("PXBDCPT",$J),^TMP("PXBSTOR",$J),^TMP("PXK",$J)
"RTN","PXBMCPT",89,0)
 K ^TMP("PXBTOTAL",$J),^TMP("PXBTANA",$J)
"RTN","PXBMCPT",90,0)
 Q
"RTN","PXBMCPT",91,0)
 ;
"RTN","PXBMCPT",92,0)
TEST3 ;---THIRD SERERIO FOR PROMPTING FOR CPT'S
"RTN","PXBMCPT",93,0)
 I $G(DOUBLEQQ) S FIRST=1
"RTN","PXBMCPT",94,0)
 D TERM^PXBCC
"RTN","PXBMCPT",95,0)
 D HDR^PXBUTL(PXBVST,1),REQ^PXBDREQ(4)
"RTN","PXBMCPT",96,0)
 D TEST3C
"RTN","PXBMCPT",97,0)
 D TEST3Q
"RTN","PXBMCPT",98,0)
TEST3C ;--Display the CPT codes
"RTN","PXBMCPT",99,0)
 D LOC^PXBCC(3,1) W IOEDEOP
"RTN","PXBMCPT",100,0)
 D CPT^PXBGCPT(PXBVST)
"RTN","PXBMCPT",101,0)
 D EN0^PXBDCPT
"RTN","PXBMCPT",102,0)
R23 D WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBMCPT",103,0)
 K ERROR D CPT^PXBPCPT G:$G(PXBEXIT)<1 CPTXIT G:$G(ERROR) R2 W IOEDEOP
"RTN","PXBMCPT",104,0)
 I DATA=""!(DATA["^P") D RSET^PXBDREQ("CPT"),RSET^PXBDREQ("PRV") K DIRUT,PXBUT G P
"RTN","PXBMCPT",105,0)
 I DATA["^C" D RSET^PXBDREQ("CPT") G C
"RTN","PXBMCPT",106,0)
 I DATA=""!(DATA["^") D RSET^PXBDREQ("CPT"),RSET^PXBDREQ("PRV") K DIRUT,PXBUT G P
"RTN","PXBMCPT",107,0)
 ;
"RTN","PXBMCPT",108,0)
 ;--Display the requested CPT code
"RTN","PXBMCPT",109,0)
 D PRINT^PXBDREQ(2)
"RTN","PXBMCPT",110,0)
 Q
"RTN","PXBMCPT",111,0)
TEST3Q ;--Prompt of the QUANTITY of the CPT code
"RTN","PXBMCPT",112,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBMCPT",113,0)
 S PROMPT="CPT^QUA" D QUA^PXBPQUA S PROMPT="CPT"
"RTN","PXBMCPT",114,0)
 I EDATA["^C" D RSET^PXBDREQ("CPT") G C
"RTN","PXBMCPT",115,0)
 I EDATA["^P" D RSET^PXBDREQ("CPT"),RSET^PXBDREQ("PRV") K DIRUT,PXBUT G P
"RTN","PXBMCPT",116,0)
 ;
"RTN","PXBMCPT",117,0)
 ;--Create The ^TMP("PXK", ARRAY
"RTN","PXBMCPT",118,0)
 D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBMCPT",119,0)
 ;--File the data into the V files
"RTN","PXBMCPT",120,0)
 D EN1^PXKMAIN
"RTN","PXBMCPT",121,0)
 D RSET^PXBDREQ("CPT")
"RTN","PXBMCPT",122,0)
 G C
"RTN","PXBMCPT",123,0)
 Q
"RTN","PXBMCPT2")
0^16^B11433435
"RTN","PXBMCPT2",1,0)
PXBMCPT2 ;ISL/JVS,ESW - MAIN ROUTINE CPT CODES ; 12/5/02 11:37am
"RTN","PXBMCPT2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,73,88,89,108**;Aug 12, 1996
"RTN","PXBMCPT2",3,0)
 ;
"RTN","PXBMCPT2",4,0)
 W !,"This is not the entry into this routine" Q
"RTN","PXBMCPT2",5,0)
 ;
"RTN","PXBMCPT2",6,0)
 ;  VARABLE LIST
"RTN","PXBMCPT2",7,0)
 ;
"RTN","PXBMCPT2",8,0)
 ;
"RTN","PXBMCPT2",9,0)
CPT(PXBVST) ;---Real entry point
"RTN","PXBMCPT2",10,0)
 Q:'$D(^AUPNVSIT(PXBVST))
"RTN","PXBMCPT2",11,0)
 S TEST=1
"RTN","PXBMCPT2",12,0)
 ; PXBVST  = Appointment-Encounter Visit IEN
"RTN","PXBMCPT2",13,0)
 ; PXBDPRV = Default Provider for clinic appointment IEN
"RTN","PXBMCPT2",14,0)
 ;--Set up
"RTN","PXBMCPT2",15,0)
 N PXBCNT,I,J,IDATE,PRIP,PRIPOV,PRISEC,QUA,VISIT,PRI,POV,PRV,PXBENT,SAVE
"RTN","PXBMCPT2",16,0)
 N PXBUT,FPRI,ENTRY,PXBSAVE,NAME,VAR,DOUBLEQQ,CPTQUA,PXBPRV,ERROR
"RTN","PXBMCPT2",17,0)
 N REQI,REQE,DEL,COM,FROM,NOREV
"RTN","PXBMCPT2",18,0)
 N DATA,PROMPT,FIRSTCPT,KFIRST,FROM,IDATE,%,CYCL
"RTN","PXBMCPT2",19,0)
 N PXBNCPT,PXBNPRV,PXBNPOV,FIRST,PXBWIN,CLINIC
"RTN","PXBMCPT2",20,0)
 N PXBPMT,LEAVE,PATIENT,PXMODSTR,PXMDCNT,PXNEWIEN,PXMREQ,PXTLNS
"RTN","PXBMCPT2",21,0)
 S (REQE,REQI)=""
"RTN","PXBMCPT2",22,0)
 S CLINIC=$P(^AUPNVSIT(PXBVST,0),"^",22),PROMPT="CPT"
"RTN","PXBMCPT2",23,0)
 ;--KILL OF THE TMP GLOGALS IN ALL PROMPTS
"RTN","PXBMCPT2",24,0)
 S ^TMP("PXBDCPT",$J,"START")=0,FIRST=1,FIRSTCPT=1,PXBEXIT=1
"RTN","PXBMCPT2",25,0)
 ;
"RTN","PXBMCPT2",26,0)
TEST3 ;---THIRD SERERIO FOR PROMPTING FOR CPT'S
"RTN","PXBMCPT2",27,0)
 I $G(DOUBLEQQ) S FIRST=1
"RTN","PXBMCPT2",28,0)
 D TERM^PXBCC
"RTN","PXBMCPT2",29,0)
TEST3C ;--Display the CPT codes
"RTN","PXBMCPT2",30,0)
 D HEADER
"RTN","PXBMCPT2",31,0)
 ;---ADDED 11/4/96
"RTN","PXBMCPT2",32,0)
 D RSET^PXBDREQ("PRV")
"RTN","PXBMCPT2",33,0)
 ;------END--------
"RTN","PXBMCPT2",34,0)
R2 K ERROR,PXMODSTR
"RTN","PXBMCPT2",35,0)
 S (PXNEWIEN,PXMREQ)=""
"RTN","PXBMCPT2",36,0)
 D CPT^PXBPCPT G:$G(PXBEXIT)<1 CPTXIT G:$G(ERROR) R2 W IOEDEOP
"RTN","PXBMCPT2",37,0)
 I DATA["^C" D RSET^PXBDREQ("CPT") K PXMREQ G TEST3C
"RTN","PXBMCPT2",38,0)
 I DATA=""!(DATA["^") D RSET^PXBDREQ("CPT") K DIRUT,PXBUT,PXMREQ G CPTXIT
"RTN","PXBMCPT2",39,0)
 ;
"RTN","PXBMCPT2",40,0)
 ;--Display the requested CPT code
"RTN","PXBMCPT2",41,0)
 D PRINT^PXBDREQ(2)
"RTN","PXBMCPT2",42,0)
 ;
"RTN","PXBMCPT2",43,0)
 ;--Prompt for CPT Modifiers
"RTN","PXBMCPT2",44,0)
 D FULL0^PXBCC
"RTN","PXBMCPT2",45,0)
 S PXNEWIEN=""
"RTN","PXBMCPT2",46,0)
 S PXMDCNT=$$CODM^ICPTCOD($P(REQI,"^",3),"^TMP(""PXMODARR"",$J",PXBSOURC,PXBVSTDT)
"RTN","PXBMCPT2",47,0)
 K ^TMP("PXMODARR",$J)
"RTN","PXBMCPT2",48,0)
 D MOD^PXBPMOD(PXBVST,PXBPAT,$P(REQI,"^",3),$G(PXMODSTR),$P(REQI,"^",8),IDATE,PXMDCNT,.PXMREQ)
"RTN","PXBMCPT2",49,0)
 I DATA["^C" D RSET^PXBDREQ("CPT") K PXMREQ G TEST3
"RTN","PXBMCPT2",50,0)
 I PXNEWIEN]"" S PXBNCPT($P(REQI,"^",3),PXNEWIEN)=""
"RTN","PXBMCPT2",51,0)
 ;
"RTN","PXBMCPT2",52,0)
TEST3Q ;--Prompt of the QUANTITY of the CPT code
"RTN","PXBMCPT2",53,0)
 S DEL=0
"RTN","PXBMCPT2",54,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBMCPT2",55,0)
 D QUA^PXBPQUA S PROMPT="CPT"
"RTN","PXBMCPT2",56,0)
 I EDATA["^C" D  G TEST3
"RTN","PXBMCPT2",57,0)
 .I PXNEWIEN]"" D REMOVE^PXCEVFIL(PXNEWIEN)
"RTN","PXBMCPT2",58,0)
 .D RSET^PXBDREQ("CPT") K PXMREQ
"RTN","PXBMCPT2",59,0)
 ;
"RTN","PXBMCPT2",60,0)
 ;--Create The ^TMP("PXK", ARRAY
"RTN","PXBMCPT2",61,0)
 S COM="0@" I COM[$P(REQI,"^",4) D
"RTN","PXBMCPT2",62,0)
 .D EN0^PXBSTOR(PXBVST,PATIENT,REQI,.PXMREQ)
"RTN","PXBMCPT2",63,0)
 .D EN1^PXKMAIN
"RTN","PXBMCPT2",64,0)
 .S DEL=1
"RTN","PXBMCPT2",65,0)
 ;--File the data into the V files
"RTN","PXBMCPT2",66,0)
 I $G(DEL)=1 D  G TEST3C
"RTN","PXBMCPT2",67,0)
 .I PXNEWIEN]"" D REMOVE^PXCEVFIL(PXNEWIEN)
"RTN","PXBMCPT2",68,0)
 ;
"RTN","PXBMCPT2",69,0)
TEST3P ;--GET PROVIDER
"RTN","PXBMCPT2",70,0)
 N PXBSKY,PXBKY,PXBSAM,PXBCNT,PRVDR,FPRI ;108
"RTN","PXBMCPT2",71,0)
 D PRV^PXBGPRV(PXBVST,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI) W IOSC
"RTN","PXBMCPT2",72,0)
 S FROM="CPT" D PRV^PXBPPRV I DATA["^P" D  W IOCUU G TEST3P
"RTN","PXBMCPT2",73,0)
 .S $P(REQI,"^",1)="",$P(REQI,"^",2)="",$P(REQI,"^",7)=""
"RTN","PXBMCPT2",74,0)
 .K PXBDPRV
"RTN","PXBMCPT2",75,0)
 D EN0^PXBSTOR(PXBVST,PATIENT,REQI,.PXMREQ)
"RTN","PXBMCPT2",76,0)
 D EN1^PXKMAIN
"RTN","PXBMCPT2",77,0)
 D RSET^PXBDREQ("CPT") ;--RSET^PXBDREQ("PRV")
"RTN","PXBMCPT2",78,0)
 K PXMREQ
"RTN","PXBMCPT2",79,0)
 S $P(REQI,"^",7)=""
"RTN","PXBMCPT2",80,0)
 G TEST3C
"RTN","PXBMCPT2",81,0)
 ;
"RTN","PXBMCPT2",82,0)
 Q
"RTN","PXBMCPT2",83,0)
P ;--Obtain the correct provider
"RTN","PXBMCPT2",84,0)
 ;
"RTN","PXBMCPT2",85,0)
 Q
"RTN","PXBMCPT2",86,0)
HEADER ;--Display header and list CPT codes and associated modifiers
"RTN","PXBMCPT2",87,0)
 D HDR^PXBUTL(PXBVST,1)
"RTN","PXBMCPT2",88,0)
 D REQ^PXBDREQ(4)
"RTN","PXBMCPT2",89,0)
 D LOC^PXBCC(3,1)
"RTN","PXBMCPT2",90,0)
 W IOEDEOP
"RTN","PXBMCPT2",91,0)
 D CPT^PXBGCPT(PXBVST)
"RTN","PXBMCPT2",92,0)
 D EN0^PXBDCPT
"RTN","PXBMCPT2",93,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBMCPT2",94,0)
 D LOC^PXBCC(15,1)
"RTN","PXBMCPT2",95,0)
 Q
"RTN","PXBMCPT2",96,0)
CPTXIT ;----EXIT AND CLEAN UP
"RTN","PXBMCPT2",97,0)
 D KILL^PXBUTL3
"RTN","PXBMCPT2",98,0)
 D PRIM^PXBUTL
"RTN","PXBMCPT2",99,0)
 D FULL0^PXBCC
"RTN","PXBMCPT2",100,0)
 D CLEAR1^PXBCC
"RTN","PXBMCPT2",101,0)
 K PXBKY,PXBSAM,PXBSKY,PXKVST
"RTN","PXBMCPT2",102,0)
 ;
"RTN","PXBMCPT2",103,0)
 ;----Do the EVENT to the Protocol
"RTN","PXBMCPT2",104,0)
 ;D EVENT^PXKMAIN
"RTN","PXBMCPT2",105,0)
 K ^TMP("PXBDCPT",$J),^TMP("PXBSTOR",$J),^TMP("PXK",$J)
"RTN","PXBMCPT2",106,0)
 K ^TMP("PXBTOTAL",$J),^TMP("PXBTANA",$J)
"RTN","PXBMCPT2",107,0)
 Q
"RTN","PXBMPOV")
0^6^B6677265
"RTN","PXBMPOV",1,0)
PXBMPOV ;ISL/JVS,ESW - MAIN ROUTINE DIAGNOSIS ; 12/5/02 11:39am
"RTN","PXBMPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,14,108**;Aug 12, 1996
"RTN","PXBMPOV",3,0)
 ;
"RTN","PXBMPOV",4,0)
 W !,"This is not the entry into this routine" Q
"RTN","PXBMPOV",5,0)
 ;
"RTN","PXBMPOV",6,0)
 ;  VARABLE LIST
"RTN","PXBMPOV",7,0)
 ;
"RTN","PXBMPOV",8,0)
 ;
"RTN","PXBMPOV",9,0)
 ;
"RTN","PXBMPOV",10,0)
POV(PXBVST) ;---Real entry point
"RTN","PXBMPOV",11,0)
 Q:'$D(^AUPNVSIT(PXBVST))
"RTN","PXBMPOV",12,0)
 ; PXBVST  = Appointment-Encounter Visit IEN
"RTN","PXBMPOV",13,0)
 ; PXBDPRV = Default Provider for clinic appointment IEN
"RTN","PXBMPOV",14,0)
 ;--Set up
"RTN","PXBMPOV",15,0)
 N PXBCNT,I,J,IDATE,PRIP,PRIPOV,PRISEC,QUA,VISIT,PRI,POV,PRV,PXBENT,SAVE
"RTN","PXBMPOV",16,0)
 N PXBUT,FPRI,ENTRY,PXBSAVE,DATA,PXBPRBLM,PXBRES,PXBSPL,NAME,PATIENT
"RTN","PXBMPOV",17,0)
 N REQI,REQE,PROMPT,PROVIDER,PXDIGNS,CYCL,PXBNPOVL,FROM,NOREV,NOPLLIST
"RTN","PXBMPOV",18,0)
 N PXBNCPT,PXBNPRV,PXBNPOV,FIRST,PXBWIN,CLINIC,PXBPMT,LEAVE,VAR,%
"RTN","PXBMPOV",19,0)
 K ^TMP("PXBGPOVMATCH",$J)
"RTN","PXBMPOV",20,0)
 S CLINIC=$P(^AUPNVSIT(PXBVST,0),"^",22),PROMPT="POV",FIRST=1,PXBEXIT=1
"RTN","PXBMPOV",21,0)
 S (REQE,REQI)=""
"RTN","PXBMPOV",22,0)
 S ^TMP("PXBDPOV",$J,"START")=0
"RTN","PXBMPOV",23,0)
 ;
"RTN","PXBMPOV",24,0)
PPP ;--Obtain the POV (DIAGNOSIS)
"RTN","PXBMPOV",25,0)
 N PXBSKY,PXBKY,PXBSAM,PXBCNT,PRVDR,FPRI
"RTN","PXBMPOV",26,0)
 D PRV^PXBGPRV(PXBVST,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI)
"RTN","PXBMPOV",27,0)
 K PXBSPL
"RTN","PXBMPOV",28,0)
 D TERM^PXBCC
"RTN","PXBMPOV",29,0)
 D HDR^PXBUTL(PXBVST,1)
"RTN","PXBMPOV",30,0)
 D REQ^PXBDREQ(6)
"RTN","PXBMPOV",31,0)
 N LNARR D POV^PXBGPOV(PXBVST)
"RTN","PXBMPOV",32,0)
 D EN0^PXBDPOV
"RTN","PXBMPOV",33,0)
R D WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBMPOV",34,0)
 K ERROR D POV^PXBPPOV G:$G(PXBEXIT)<1 POVXIT G:$G(ERROR) R W IOEDEOP
"RTN","PXBMPOV",35,0)
 K FIRST
"RTN","PXBMPOV",36,0)
 I DATA["^P" D RSET^PXBDREQ("POV") G PPP
"RTN","PXBMPOV",37,0)
 I $G(PXBUT)=1,$D(LEAVE) G POVXIT
"RTN","PXBMPOV",38,0)
 ;
"RTN","PXBMPOV",39,0)
 ;--Prompt for Primary or Secondary DIAGNOSIS
"RTN","PXBMPOV",40,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBMPOV",41,0)
 D PRI^PXBPPOV1
"RTN","PXBMPOV",42,0)
 I $D(DIRUT) D RSET^PXBDREQ("POV") G PPP
"RTN","PXBMPOV",43,0)
 ;
"RTN","PXBMPOV",44,0)
 ;--Display the Requested Diagnosis
"RTN","PXBMPOV",45,0)
 D PRINT^PXBDREQ(4),EN0^PXBSTOR(PXBVST,PATIENT,REQI),EN1^PXKMAIN
"RTN","PXBMPOV",46,0)
 ;
"RTN","PXBMPOV",47,0)
 ;--Request entry to problem list
"RTN","PXBMPOV",48,0)
 I $D(DIRUT)!('$G(PXBPRBLM)) K DIRUT,PXBPRBLM D EN0^PXBSTOR(PXBVST,PATIENT,REQI),EN1^PXKMAIN D RSET^PXBDREQ("POV") G PPP
"RTN","PXBMPOV",49,0)
 ;
"RTN","PXBMPOV",50,0)
 ;--Request the Associated Provider
"RTN","PXBMPOV",51,0)
 ;---I NOT PROVIDER GO PPP
"RTN","PXBMPOV",52,0)
 ;
"RTN","PXBMPOV",53,0)
 ;--RETURN TO THE BEGINNING
"RTN","PXBMPOV",54,0)
 D RSET^PXBDREQ("POV"),RSET^PXBDREQ("PRV")
"RTN","PXBMPOV",55,0)
 G PPP
"RTN","PXBMPOV",56,0)
 Q
"RTN","PXBMPOV",57,0)
 ;
"RTN","PXBMPOV",58,0)
POVXIT ;----EXIT AND CLEAN UP
"RTN","PXBMPOV",59,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBMPOV",60,0)
 ;
"RTN","PXBMPOV",61,0)
 ;--Send the data to the problem list
"RTN","PXBMPOV",62,0)
PL I '$G(PXBEXIT)<1 D
"RTN","PXBMPOV",63,0)
 .I '$G(PXBPRBON) Q
"RTN","PXBMPOV",64,0)
 .I PXBCNT>0 N LNARR D SET^PXBPL
"RTN","PXBMPOV",65,0)
 D PRIM^PXBUTL
"RTN","PXBMPOV",66,0)
 ;D PRIMD^PXBUTL
"RTN","PXBMPOV",67,0)
 D FULL0^PXBCC
"RTN","PXBMPOV",68,0)
 D CLEAR1^PXBCC
"RTN","PXBMPOV",69,0)
 K PXBKY,PXBSAM,PXBSKY,PXBVST
"RTN","PXBMPOV",70,0)
 ;----Do the EVENT to the Protocol
"RTN","PXBMPOV",71,0)
 ;D EVENT^PXKMAIN
"RTN","PXBMPOV",72,0)
 K ^TMP("PXBDPOV",$J),^TMP("PXBSTOR",$J),^TMP("PXK",$J),^TMP("PXBDPL",$J)
"RTN","PXBMPOV",73,0)
 K ^TMP("PXBTOTAL",$J),^TMP("PXBTANA",$J),^TMP("PXBGPOVMATCH",$J)
"RTN","PXBMPOV",74,0)
 Q
"RTN","PXBMPOV",75,0)
 ;
"RTN","PXBMPRV")
0^8^B4831068
"RTN","PXBMPRV",1,0)
PXBMPRV ;ISL/JVS,ESW - MAIN ROUTINE PROVIDER ; 10/31/02 12:10pm
"RTN","PXBMPRV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,108**;Aug 12, 1996
"RTN","PXBMPRV",3,0)
 ;
"RTN","PXBMPRV",4,0)
 W !,"This is not the entry into this routine" Q
"RTN","PXBMPRV",5,0)
 ;
"RTN","PXBMPRV",6,0)
 ;  VARABLE LIST
"RTN","PXBMPRV",7,0)
 ;
"RTN","PXBMPRV",8,0)
 ;
"RTN","PXBMPRV",9,0)
PRV(PXBVST,FROM) ;-----PROVIDER STAND ALONE
"RTN","PXBMPRV",10,0)
 Q:'$D(^AUPNVSIT(PXBVST))
"RTN","PXBMPRV",11,0)
 ;
"RTN","PXBMPRV",12,0)
 ;--Obtain the correct provider
"RTN","PXBMPRV",13,0)
 ;--Set up
"RTN","PXBMPRV",14,0)
 N PXBCNT,I,J,IDATE,PRIP,PRIPOV,PRISEC,QUA,VISIT,PRI,POV,PRV,PXBENT,SAVE
"RTN","PXBMPRV",15,0)
 N PXBUT,FPRI,ENTRY,PXBSAVE,DATA,NAME,PATIENT,VAR,PROMPT,CYCL
"RTN","PXBMPRV",16,0)
 I '$G(PXBPRBLM) N REQI,REQE
"RTN","PXBMPRV",17,0)
 N PXBNCPT,PXBNPRV,PXBNPOV,FIRST,PXBWIN,CLINIC,PXBPMT,LEAVE,%,PXBNPRVL
"RTN","PXBMPRV",18,0)
 N FROM,NOREV
"RTN","PXBMPRV",19,0)
 S (REQI,REQE)=""
"RTN","PXBMPRV",20,0)
 S CLINIC=$P(^AUPNVSIT(PXBVST,0),"^",22)
"RTN","PXBMPRV",21,0)
 S ^TMP("PXBDPRV",$J,"START")=0,FIRST=1,PROMPT="PRV",PXBEXIT=1
"RTN","PXBMPRV",22,0)
 D HDR^PXBUTL(PXBVST,1)
"RTN","PXBMPRV",23,0)
 D REQ^PXBDREQ(5)
"RTN","PXBMPRV",24,0)
 ;
"RTN","PXBMPRV",25,0)
PP ;--------RECYCLE ENTRY POINT
"RTN","PXBMPRV",26,0)
 D TERM^PXBCC
"RTN","PXBMPRV",27,0)
 D LOC^PXBCC(3,1) W IOEDEOP
"RTN","PXBMPRV",28,0)
 N PXBSKY,PXBKY,PXBSAM,PXBCNT,PRVDR,FPRI ;108
"RTN","PXBMPRV",29,0)
 D PRV^PXBGPRV(PXBVST,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI)
"RTN","PXBMPRV",30,0)
 D EN0^PXBDPRV
"RTN","PXBMPRV",31,0)
R D WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBMPRV",32,0)
 K ERROR S FROM="PRV" D LOC^PXBCC(15,1),PRV^PXBPPRV G:$G(PXBEXIT)<1 PRVXIT G:$G(ERROR) R
"RTN","PXBMPRV",33,0)
 W IOEDEOP
"RTN","PXBMPRV",34,0)
 I DATA["^P" D RSET^PXBDREQ("PRV") G PP
"RTN","PXBMPRV",35,0)
 I $G(PXBUT)=1,'$D(FIRST) G PRVXIT
"RTN","PXBMPRV",36,0)
 I $G(PXBUT)=1,$D(LEAVE) G PRVXIT
"RTN","PXBMPRV",37,0)
 K FIRST
"RTN","PXBMPRV",38,0)
 I $G(PXBUT)=1 G PRVXIT
"RTN","PXBMPRV",39,0)
 ;
"RTN","PXBMPRV",40,0)
 ;--Prompt for Primary or Secondary Provider
"RTN","PXBMPRV",41,0)
 D PRI^PXBPPRV1
"RTN","PXBMPRV",42,0)
 I $D(DIRUT) D RSET^PXBDREQ("PRV") G PP
"RTN","PXBMPRV",43,0)
 ;
"RTN","PXBMPRV",44,0)
 ;--Store the DATA
"RTN","PXBMPRV",45,0)
 D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBMPRV",46,0)
 ;
"RTN","PXBMPRV",47,0)
 ;--Display the Requested Provider
"RTN","PXBMPRV",48,0)
 D PRINT^PXBDREQ(1)
"RTN","PXBMPRV",49,0)
 ;
"RTN","PXBMPRV",50,0)
 ;--File the data into the V files
"RTN","PXBMPRV",51,0)
 D EN1^PXKMAIN
"RTN","PXBMPRV",52,0)
 ;
"RTN","PXBMPRV",53,0)
 ;--IF called from DIAGNOSIS prompts
"RTN","PXBMPRV",54,0)
 I '$G(PXBPRBLM) D RSET^PXBDREQ("PRV")
"RTN","PXBMPRV",55,0)
 I $G(PXBPRBLM) G PRVXIT
"RTN","PXBMPRV",56,0)
 G PP
"RTN","PXBMPRV",57,0)
 ;
"RTN","PXBMPRV",58,0)
PRVXIT ;----EXIT AND CLEAN UP
"RTN","PXBMPRV",59,0)
 D PRIM^PXBUTL
"RTN","PXBMPRV",60,0)
 D FULL0^PXBCC
"RTN","PXBMPRV",61,0)
 D CLEAR1^PXBCC
"RTN","PXBMPRV",62,0)
 K PXBKY,PXBSAM,PXBSKY,PXBVST
"RTN","PXBMPRV",63,0)
 ;
"RTN","PXBMPRV",64,0)
 ;----Do the EVENT to the Protocol
"RTN","PXBMPRV",65,0)
 ;D EVENT^PXKMAIN
"RTN","PXBMPRV",66,0)
 K ^TMP("PXBSTOR",$J),^TMP("PXK",$J),^TMP("PXBDPRV",$J)
"RTN","PXBMPRV",67,0)
 K ^TMP("PXBTOTAL",$J),^TMP("PXBTANA",$J)
"RTN","PXBMPRV",68,0)
 Q
"RTN","PXBPCPT1")
0^10^B20077533
"RTN","PXBPCPT1",1,0)
PXBPCPT1 ;ISL/JVS,ESW - PROMPT CPT ; 10/31/02 12:11pm
"RTN","PXBPCPT1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**7,73,88,89,108**;Aug 12, 1996
"RTN","PXBPCPT1",3,0)
 ;
"RTN","PXBPCPT1",4,0)
 ;
"RTN","PXBPCPT1",5,0)
 ;
"RTN","PXBPCPT1",6,0)
 ;
"RTN","PXBPCPT1",7,0)
 ;
"RTN","PXBPCPT1",8,0)
ADDM ;--------If Multiple entries have been entered assume quantity 1
"RTN","PXBPCPT1",9,0)
 ;
"RTN","PXBPCPT1",10,0)
 ;
"RTN","PXBPCPT1",11,0)
 N OK,PXBLEN,BDATA,PXMDCNT
"RTN","PXBPCPT1",12,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBPCPT1",13,0)
 S NF=0,PXBLEN=0
"RTN","PXBPCPT1",14,0)
 D EDITMM
"RTN","PXBPCPT1",15,0)
 Q
"RTN","PXBPCPT1",16,0)
 I DATA[","&(DATA'["-")&($L($P(DATA,",",1))=5) S NF=1 D
"RTN","PXBPCPT1",17,0)
 .D HELP1^PXBUTL1("CPTMM"),HELP1^PXBUTL1("CON")
"RTN","PXBPCPT1",18,0)
 .R OK:DTIME
"RTN","PXBPCPT1",19,0)
 .S PXBLEN=$L(DATA,",") F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) D
"RTN","PXBPCPT1",20,0)
 ..I $L($G(PXBPIECE))'=5 S BAD($G(PXBPIECE))="" Q
"RTN","PXBPCPT1",21,0)
 ..I $L(PXBPIECE)=5 S X=PXBPIECE,DIC=81,DIC(0)="Z" D ^DIC
"RTN","PXBPCPT1",22,0)
 ..I Y=-1 S BAD(+$G(PXBPIECE))="" Q
"RTN","PXBPCPT1",23,0)
 ..S $P(REQI,"^",3)=+Y,$P(REQI,"^",4)=1
"RTN","PXBPCPT1",24,0)
 ..S PXBNCPT(PXBPIECE)=""
"RTN","PXBPCPT1",25,0)
 ..D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPCPT1",26,0)
 ..D EN1^PXKMAIN
"RTN","PXBPCPT1",27,0)
 ..D RSET^PXBDREQ("CPT")
"RTN","PXBPCPT1",28,0)
BAD ;----BAD CPT CODES
"RTN","PXBPCPT1",29,0)
 N Y I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPCPT1",30,0)
 .S (BDATA,EDATA)=""
"RTN","PXBPCPT1",31,0)
 .F  S BDATA=$O(BAD(BDATA)) Q:BDATA=""  S EDATA=EDATA_BDATA_"  "
"RTN","PXBPCPT1",32,0)
 .W ! D HELP^PXBUTL0("CPTM") W !
"RTN","PXBPCPT1",33,0)
 .S DIR(0)="E" D ^DIR K DIR,DIRUT
"RTN","PXBPCPT1",34,0)
 .S:Y=1 DATA="^C" S:Y=0!(Y="") DATA="^"
"RTN","PXBPCPT1",35,0)
 I $G(NF)&('$D(BAD)) S DATA="^C" Q
"RTN","PXBPCPT1",36,0)
 Q
"RTN","PXBPCPT1",37,0)
 ;
"RTN","PXBPCPT1",38,0)
BADD(PAR,EDATA) ;----BAD CPT CODES - DISPLAY
"RTN","PXBPCPT1",39,0)
 I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPCPT1",40,0)
 .W !,*7 D HELP^PXBUTL0(PAR) W !
"RTN","PXBPCPT1",41,0)
 Q
"RTN","PXBPCPT1",42,0)
EDITMM ;--ADD MULTIPLE ENTRIES
"RTN","PXBPCPT1",43,0)
 ;
"RTN","PXBPCPT1",44,0)
 N STOP,BAD,GONE,PXBLEN,PXBPIECE,BDATA,PX,PXI,YY,BAD
"RTN","PXBPCPT1",45,0)
 S STOP=0
"RTN","PXBPCPT1",46,0)
 I DATA[",",DATA'["-" D
"RTN","PXBPCPT1",47,0)
 .S PXBLEN=$L(DATA,",")
"RTN","PXBPCPT1",48,0)
 .S NF=1
"RTN","PXBPCPT1",49,0)
 .F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) Q:STOP=1  D
"RTN","PXBPCPT1",50,0)
 ..;----ADDED
"RTN","PXBPCPT1",51,0)
 ..I PXBPIECE="" Q
"RTN","PXBPCPT1",52,0)
 ..I $D(PXBKY(PXBPIECE)) S BAD(PXBPIECE)="" S NF=1 D BADD("CPTMDD",PXBPIECE) Q
"RTN","PXBPCPT1",53,0)
 ..I PXI>1 I ","_$P(DATA,",",1,PXI-1)_","[(","_PXBPIECE_",") W !!,*7,"PROCEDURE "_PXBPIECE_" was already processed." H 1 Q
"RTN","PXBPCPT1",54,0)
 ..S X=PXBPIECE,DIC=81,DIC(0)="ZB" D ^DIC
"RTN","PXBPCPT1",55,0)
 ..I Y<1 S BAD(PXBPIECE)="" S NF=1 D BADD("CPTM",PXBPIECE) Q
"RTN","PXBPCPT1",56,0)
 ..S $P(REQI,U,3)=+Y
"RTN","PXBPCPT1",57,0)
 ..S $P(REQI,U,8)=""
"RTN","PXBPCPT1",58,0)
 ..W !!,"For the PROCEDURE: "_X_"--"_$P(Y(0),U,2)
"RTN","PXBPCPT1",59,0)
 ..;--Prompt for CPT Modifiers
"RTN","PXBPCPT1",60,0)
 ..D FULL0^PXBCC
"RTN","PXBPCPT1",61,0)
 ..S PXMDCNT=$$CODM^ICPTCOD($P(REQI,"^",3),"^TMP(""PXMODARR"",$J",PXBSOURC,PXBVSTDT)
"RTN","PXBPCPT1",62,0)
 ..K ^TMP("PXMODARR",$J)
"RTN","PXBPCPT1",63,0)
 ..D MOD^PXBPMOD(PXBVST,PXBPAT,$P(REQI,"^",3),"",$P(REQI,"^",8),IDATE,PXMDCNT,.PXMREQ)
"RTN","PXBPCPT1",64,0)
 ..S:EDATA["^C" STOP=1
"RTN","PXBPCPT1",65,0)
 ..Q:STOP
"RTN","PXBPCPT1",66,0)
 ..S CPTQUA=1
"RTN","PXBPCPT1",67,0)
 ..D QUA^PXBPQUA
"RTN","PXBPCPT1",68,0)
 ..S:EDATA["^C" STOP=1 S:EDATA["^P" STOP=1 Q:STOP=1
"RTN","PXBPCPT1",69,0)
 ..;--Get Provider for CPT
"RTN","PXBPCPT1",70,0)
 ..N PXBSKY,PXBKY,PXBSAM,PXBCNT,PRVDR,FPRI
"RTN","PXBPCPT1",71,0)
 ..D PRV^PXBGPRV(PXBVST,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI) W IOSC
"RTN","PXBPCPT1",72,0)
 ..S FROM="CPT" D  Q:STOP
"RTN","PXBPCPT1",73,0)
 ...N DATA D PRV^PXBPPRV I DATA["^P" D  W IOCUU S STOP=1 Q
"RTN","PXBPCPT1",74,0)
 ....S $P(REQI,"^",1)="",$P(REQI,"^",2)="",$P(REQI,"^",7)=""
"RTN","PXBPCPT1",75,0)
 ....K PXBDPRV
"RTN","PXBPCPT1",76,0)
 ..S PXBNCPT(PXBPIECE)=""
"RTN","PXBPCPT1",77,0)
 ..D EN0^PXBSTOR(PXBVST,PATIENT,REQI,.PXMREQ)
"RTN","PXBPCPT1",78,0)
 ..D EN1^PXKMAIN
"RTN","PXBPCPT1",79,0)
 ..D RSET^PXBDREQ("CPT")
"RTN","PXBPCPT1",80,0)
 ..D RSET^PXBDREQ("PRV")
"RTN","PXBPCPT1",81,0)
 ..K PXMREQ
"RTN","PXBPCPT1",82,0)
 ..S $P(REQI,"^",7)=""
"RTN","PXBPCPT1",83,0)
 .S DATA="^C"
"RTN","PXBPCPT1",84,0)
 Q
"RTN","PXBPCPT1",85,0)
 ;
"RTN","PXBPCPT1",86,0)
DELM ;--------If Multiple deleting
"RTN","PXBPCPT1",87,0)
 N DELM,PXBJ,BAD,PXBPIECE,PXBLEN
"RTN","PXBPCPT1",88,0)
 S NF=0,PXBLEN=0 S $P(DELM,"^",2)=1
"RTN","PXBPCPT1",89,0)
 I $E(DATA,1)="@" D
"RTN","PXBPCPT1",90,0)
 .I '$$SURE^PXCEAE2 S DATA="^C" Q
"RTN","PXBPCPT1",91,0)
 .S DATA=$P(DATA,"@",2),NF=1
"RTN","PXBPCPT1",92,0)
 .S PXBLEN=$L(DATA,",")
"RTN","PXBPCPT1",93,0)
 .F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) D
"RTN","PXBPCPT1",94,0)
 ..I PXBPIECE'["-"&(PXBPIECE'>0!(PXBPIECE'<(PXBCNT+1))) S BAD(+$G(PXBPIECE))="" Q
"RTN","PXBPCPT1",95,0)
 ..I PXBPIECE'["-" D
"RTN","PXBPCPT1",96,0)
 ...I $D(GONE(PXBPIECE)) Q
"RTN","PXBPCPT1",97,0)
 ...Q:PXBPIECE'?.N
"RTN","PXBPCPT1",98,0)
 ...S $P(REQI,"^",8)=$O(PXBSKY(PXBPIECE,0)) ;-IEN
"RTN","PXBPCPT1",99,0)
 ...S X=$P(PXBSAM(PXBPIECE),"^",1),DIC=81,DIC(0)="ZM" D ^DIC
"RTN","PXBPCPT1",100,0)
 ...S $P(REQI,"^",3)=+Y K Y
"RTN","PXBPCPT1",101,0)
 ...S $P(REQI,"^",4)=0 ;-QUANTITY
"RTN","PXBPCPT1",102,0)
 ...S GONE(PXBPIECE)=""
"RTN","PXBPCPT1",103,0)
 ...D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPCPT1",104,0)
 ...D EN1^PXKMAIN
"RTN","PXBPCPT1",105,0)
 ..I PXBPIECE["-" D
"RTN","PXBPCPT1",106,0)
 ...F PXBJ=$P(PXBPIECE,"-",1):1:$P(PXBPIECE,"-",2) D
"RTN","PXBPCPT1",107,0)
 ....I $D(GONE(PXBJ)) Q
"RTN","PXBPCPT1",108,0)
 ....I PXBJ'>0!(PXBJ'<(PXBCNT+1)) S BAD(PXBJ)="" Q
"RTN","PXBPCPT1",109,0)
 ....S $P(REQI,"^",8)=$O(PXBSKY(PXBJ,0)) ;-IEN
"RTN","PXBPCPT1",110,0)
 ....S X=$P(PXBSAM(PXBJ),"^",1),DIC=81,DIC(0)="ZM" D ^DIC
"RTN","PXBPCPT1",111,0)
 ....S $P(REQI,"^",3)=+Y K Y
"RTN","PXBPCPT1",112,0)
 ....S $P(REQI,"^",4)=0 ;-QUANTITY
"RTN","PXBPCPT1",113,0)
 ....S GONE(PXBJ)=""
"RTN","PXBPCPT1",114,0)
 ....D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPCPT1",115,0)
 ....D EN1^PXKMAIN
"RTN","PXBPCPT1",116,0)
 K GONE
"RTN","PXBPCPT1",117,0)
 I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPCPT1",118,0)
 .S (BDATA,EDATA)=""
"RTN","PXBPCPT1",119,0)
 .F  S BDATA=$O(BAD(BDATA)) Q:BDATA=""  S EDATA=EDATA_BDATA_"  "
"RTN","PXBPCPT1",120,0)
 .W ! D HELP^PXBUTL0("CPTMD") W !
"RTN","PXBPCPT1",121,0)
 .S DIR(0)="E" D ^DIR K DIR
"RTN","PXBPCPT1",122,0)
 .S:Y=1 DATA="^C" S:Y=0!(Y="") DATA="^" K Y
"RTN","PXBPCPT1",123,0)
 I $G(NF)&('$D(BAD)) S DATA="^C" Q
"RTN","PXBPCPT1",124,0)
 Q
"RTN","PXBPMOD")
0^2^B5449916
"RTN","PXBPMOD",1,0)
PXBPMOD ;ISA/EW,ESW - PROMPT MOD ; 10/31/02 12:12pm
"RTN","PXBPMOD",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**73,88,89,108**Aug 12, 1996
"RTN","PXBPMOD",3,0)
 ;
"RTN","PXBPMOD",4,0)
 ;
"RTN","PXBPMOD",5,0)
 ;
"RTN","PXBPMOD",6,0)
 Q
"RTN","PXBPMOD",7,0)
 ;
"RTN","PXBPMOD",8,0)
MOD(PXVST,PXPAT,PXCPT,PXMODSTR,PXCPTIEN,PXVSTDAT,PXCNT,PXARR) ;
"RTN","PXBPMOD",9,0)
 ;CPT Modifier prompt
"RTN","PXBPMOD",10,0)
 ; Input:
"RTN","PXBPMOD",11,0)
 ;   PXVST    - Visit IEN.
"RTN","PXBPMOD",12,0)
 ;   PXPAT    - Patient IEN
"RTN","PXBPMOD",13,0)
 ;   PXCPT    - CPT code or IEN of its entry in CPT file (#81)
"RTN","PXBPMOD",14,0)
 ;   PXMODSTR - User entered string of modifier codes in external
"RTN","PXBPMOD",15,0)
 ;              format
"RTN","PXBPMOD",16,0)
 ;   PXCPTIEN - IEN of CPT code entry in V CPT file (#9000010.18)
"RTN","PXBPMOD",17,0)
 ;   PXVSTDAT - Visit date
"RTN","PXBPMOD",18,0)
 ;   PXCNT    - Number of active modifiers defined for CPT code
"RTN","PXBPMOD",19,0)
 ; Output:
"RTN","PXBPMOD",20,0)
 ;   PXARR    - Array containing modifiers.
"RTN","PXBPMOD",21,0)
 ;
"RTN","PXBPMOD",22,0)
 ;
"RTN","PXBPMOD",23,0)
 N DTOUT,DUOUT,DIROUT,DA,DIC,DR,PXGLB,Y
"RTN","PXBPMOD",24,0)
 S PXGLB="^AUPNVCPT"
"RTN","PXBPMOD",25,0)
 I $$VALCPT(PXCPT)<1 Q
"RTN","PXBPMOD",26,0)
 I +$$CPTOK^PXBUTL(PXCPT,PXVSTDAT)=0 Q
"RTN","PXBPMOD",27,0)
 I $G(PXCPTIEN)]"" S DA=PXCPTIEN
"RTN","PXBPMOD",28,0)
 I $G(PXCPTIEN)']"" D
"RTN","PXBPMOD",29,0)
 .D FILECPT
"RTN","PXBPMOD",30,0)
 .S (PXARR,PXNEWIEN)=DA
"RTN","PXBPMOD",31,0)
 ;Only prompt if there are active modifiers for the CPT code
"RTN","PXBPMOD",32,0)
 D:PXCNT>0 CPTMOD
"RTN","PXBPMOD",33,0)
 I $D(DTOUT)!$D(Y) D  Q
"RTN","PXBPMOD",34,0)
 .S (EDATA,DATA)="^C"
"RTN","PXBPMOD",35,0)
 .;Remove incomplete V CPT entry
"RTN","PXBPMOD",36,0)
 .I $G(PXNEWIEN)]"" D REMOVE^PXCEVFIL(PXNEWIEN)
"RTN","PXBPMOD",37,0)
 D BLDARRY
"RTN","PXBPMOD",38,0)
 Q
"RTN","PXBPMOD",39,0)
 ;
"RTN","PXBPMOD",40,0)
FILECPT ;Create a new entry in V CPT file and get IEN
"RTN","PXBPMOD",41,0)
 N X,Y,DD,DO,DR
"RTN","PXBPMOD",42,0)
 S DIC=PXGLB_"("
"RTN","PXBPMOD",43,0)
 S DIC(0)=""
"RTN","PXBPMOD",44,0)
 S X=PXCPT
"RTN","PXBPMOD",45,0)
 D FILE^DICN
"RTN","PXBPMOD",46,0)
 ;
"RTN","PXBPMOD",47,0)
 S DA=+Y
"RTN","PXBPMOD",48,0)
 S DIE=PXGLB_"("
"RTN","PXBPMOD",49,0)
 S DR=".02////^S X=PXPAT;.03////^S X=PXVST;"
"RTN","PXBPMOD",50,0)
 L +@(PXGLB_"(DA)"):10
"RTN","PXBPMOD",51,0)
 D ^DIE
"RTN","PXBPMOD",52,0)
 L -@(PXGLB_"(DA)")
"RTN","PXBPMOD",53,0)
 Q
"RTN","PXBPMOD",54,0)
 ;
"RTN","PXBPMOD",55,0)
CPTMOD ;Prompt for CPT Modifiers
"RTN","PXBPMOD",56,0)
 N PXMOD,PXERR,PXI
"RTN","PXBPMOD",57,0)
 S DR=1
"RTN","PXBPMOD",58,0)
 S DIE=PXGLB_"("
"RTN","PXBPMOD",59,0)
 S DIC(0)="AELMQ"
"RTN","PXBPMOD",60,0)
 L +@(PXGLB_"(DA)")
"RTN","PXBPMOD",61,0)
 ;--File modifiers entered before prompting user
"RTN","PXBPMOD",62,0)
 I $G(PXMODSTR)]"" D
"RTN","PXBPMOD",63,0)
 .I $L(PXMODSTR,",")=1 S DR="1//"_PXMODSTR Q
"RTN","PXBPMOD",64,0)
 .S PXMOD=""
"RTN","PXBPMOD",65,0)
 .F PXI=1:1 S PXMOD=$P(PXMODSTR,",",PXI) Q:PXMOD=""  D
"RTN","PXBPMOD",66,0)
 ..S PXERR=""
"RTN","PXBPMOD",67,0)
 ..D VAL^DIE(9000010.181,DA,.01,"",PXMOD,.PXERR)
"RTN","PXBPMOD",68,0)
 ..Q:PXERR="^"
"RTN","PXBPMOD",69,0)
 ..S DR="1///^S X=PXMOD"
"RTN","PXBPMOD",70,0)
 ..D ^DIE
"RTN","PXBPMOD",71,0)
 .S DR=1
"RTN","PXBPMOD",72,0)
 D ^DIE
"RTN","PXBPMOD",73,0)
 L -@(PXGLB_"(DA)")
"RTN","PXBPMOD",74,0)
 Q
"RTN","PXBPMOD",75,0)
 ;
"RTN","PXBPMOD",76,0)
BLDARRY ;Copy new modifiers into local array
"RTN","PXBPMOD",77,0)
 N PXFIL,PXSUBFIL,PXSUB,PXARR2
"RTN","PXBPMOD",78,0)
 S PXFIL=9000010.18,PXSUBFIL=9000010.181
"RTN","PXBPMOD",79,0)
 D GETS^DIQ(PXFIL,DA,"1*","I","PXARR2")
"RTN","PXBPMOD",80,0)
 S PXSUB=""
"RTN","PXBPMOD",81,0)
 F  S PXSUB=$O(PXARR2(PXSUBFIL,PXSUB)) Q:PXSUB=""  D
"RTN","PXBPMOD",82,0)
 .S PXARR(1,+PXSUB)=PXARR2(PXSUBFIL,PXSUB,.01,"I")
"RTN","PXBPMOD",83,0)
 Q
"RTN","PXBPMOD",84,0)
 ;
"RTN","PXBPMOD",85,0)
VALCPT(X) ;Determine if CPT code is valid
"RTN","PXBPMOD",86,0)
 ;internal or external value of CPT is evaluated
"RTN","PXBPMOD",87,0)
 N DIC,Y
"RTN","PXBPMOD",88,0)
 S DIC=81
"RTN","PXBPMOD",89,0)
 S DIC(0)="BN"
"RTN","PXBPMOD",90,0)
 D ^DIC
"RTN","PXBPMOD",91,0)
 Q Y
"RTN","PXBPPRV")
0^11^B33427447
"RTN","PXBPPRV",1,0)
PXBPPRV ;ISL/JVS,ESW - PROMPT PROVIDER ; 10/31/02 12:12pm
"RTN","PXBPPRV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**1,7,11,19,108**;Aug 12, 1996
"RTN","PXBPPRV",3,0)
 ;
"RTN","PXBPPRV",4,0)
 ; VARIABLE LIST
"RTN","PXBPPRV",5,0)
 ; SELINE= Line number of selected item
"RTN","PXBPPRV",6,0)
 ;
"RTN","PXBPPRV",7,0)
PRV ;--PROVIDER
"RTN","PXBPPRV",8,0)
 I $D(PXBNPRVL) W IOSC D LOC^PXBCC(2,0) W IOUON,"Previous Entry:   ",$G(PXBNPRVL(1)) F I=1:1:10 W " "
"RTN","PXBPPRV",9,0)
 I $D(PXBNPRVL) W IORC
"RTN","PXBPPRV",10,0)
 W IOUOFF
"RTN","PXBPPRV",11,0)
 N TIMED,EDATA,DIC,LINE,XFLAG,SELINE,UDATA,ECHO
"RTN","PXBPPRV",12,0)
 I '$D(^DISV(DUZ,"PXBPRV-4")) S ^DISV(DUZ,"PXBPRV-4")=" "
"RTN","PXBPPRV",13,0)
 I '$D(IOSC) D TERM^PXBCC
"RTN","PXBPPRV",14,0)
 S DOUBLEQQ=0
"RTN","PXBPPRV",15,0)
 S TIMED="I '$T!(DATA=""^"")"
"RTN","PXBPPRV",16,0)
P ;--Second Entry point
"RTN","PXBPPRV",17,0)
 W IOSC
"RTN","PXBPPRV",18,0)
 ;--DYNAMIC  HEADER--
"RTN","PXBPPRV",19,0)
 I '$D(CYCL) D
"RTN","PXBPPRV",20,0)
 .I PXBCNT=0,DOUBLEQQ=0,$G(WHAT)'["PRV" D LOC^PXBCC(1,10) W "...There are "_$G(PXBCNT)_" PROVIDER(S) associated with this encounter."
"RTN","PXBPPRV",21,0)
 .I PXBCNT=1,DOUBLEQQ=0,$G(WHAT)'["PRV" D LOC^PXBCC(1,10) W "...There is "_$G(PXBCNT)_" PROVIDER associated with this encounter."
"RTN","PXBPPRV",22,0)
 .I PXBCNT>1,DOUBLEQQ=0,$G(WHAT)'["PRV" D LOC^PXBCC(1,10) W "...There are "_$G(PXBCNT)_" PROVIDERS associated with this encounter."
"RTN","PXBPPRV",23,0)
 ;
"RTN","PXBPPRV",24,0)
 I $G(FROM)'="PL" D LOC^PXBCC(15,0)
"RTN","PXBPPRV",25,0)
 I $G(FROM)'["PRV" N PXBNPRVL
"RTN","PXBPPRV",26,0)
 I $D(FROM),FROM="PL" W IORC
"RTN","PXBPPRV",27,0)
 I $G(FROM)'="PL",PXBCNT>10&('$G(DOUBLEQQ)) W IOELEOL,!,"Enter '+' for next page, '-' for previous page."
"RTN","PXBPPRV",28,0)
 ;--Dynamic prompting for the provider--
"RTN","PXBPPRV",29,0)
 I '$D(^TMP("PXK",$J,"PRV")),'$D(FROM) W !,"Enter PROVIDER: " W IOELEOL
"RTN","PXBPPRV",30,0)
 I '$D(FROM),$D(^TMP("PXK",$J,"PRV")) W !,"Enter ",IOINHI,"NEXT",IOINLOW," PROVIDER: " W IOELEOL
"RTN","PXBPPRV",31,0)
 I $D(FROM),FROM="CPT",'$D(^TMP("PXK",$J,"PRV")) W IORC,!,"Enter PROVIDER associated with PROCEDURE: " W IOELEOL
"RTN","PXBPPRV",32,0)
 I $D(FROM),FROM="PRV" W !,"Enter PROVIDER: " W IOELEOL
"RTN","PXBPPRV",33,0)
 I $D(FROM),FROM="CPT",$D(^TMP("PXK",$J,"PRV")) W IORC,!,"Enter PROVIDER associated with PROCEDURES: " W IOELEOL
"RTN","PXBPPRV",34,0)
 I $D(FROM),FROM="PL"  W !,"Enter PROVIDER associated with PROBLEM: " W IOELEOL
"RTN","PXBPPRV",35,0)
 I $D(FROM),FROM="PL" S PXBDPRV="^"_$P($G(PRVDR("PRIMARY")),U) ;108
"RTN","PXBPPRV",36,0)
 I $D(PRVDR) S PXBDPRV="^"_$P(PRVDR("PRIMARY"),U) ;108
"RTN","PXBPPRV",37,0)
 I $D(FROM),FROM="CPT",$P(REQI,"^",1),$P(REQE,"^",1)'["..." S $P(PXBDPRV,"^",2)=$P(REQE,"^",1)
"RTN","PXBPPRV",38,0)
 W $P($G(PXBDPRV),"^",2) W:$D(PXBDPRV) " // ",IOELEOL
"RTN","PXBPPRV",39,0)
 ;
"RTN","PXBPPRV",40,0)
 R DATA:DTIME S (EDATA,ECHO)=DATA
"RTN","PXBPPRV",41,0)
P1 ;--Third entry point
"RTN","PXBPPRV",42,0)
 X TIMED I  S PXBUT=1 S:DATA="^" LEAVE=1 G PRVX
"RTN","PXBPPRV",43,0)
 I DATA?1.N1"E".NAP S DATA=" "_DATA
"RTN","PXBPPRV",44,0)
 I $L(DATA)>200 S (DATA,EDATA)=$E(DATA,1,199)
"RTN","PXBPPRV",45,0)
 I DATA?24.N S (DATA,EDATA)=$E(DATA,1,24)
"RTN","PXBPPRV",46,0)
 D CASE^PXBUTL
"RTN","PXBPPRV",47,0)
 ;---SPACE BAR
"RTN","PXBPPRV",48,0)
 I DATA=" ",$D(^DISV(DUZ,"PXBPRV-4")) S (DATA,EDATA)=^DISV(DUZ,"PXBPRV-4") W DATA
"RTN","PXBPPRV",49,0)
 ;-----------
"RTN","PXBPPRV",50,0)
 I DATA="^^" S PXBEXIT=0 G PRVX
"RTN","PXBPPRV",51,0)
 ;---I Prompt can jump to others put symbols in here
"RTN","PXBPPRV",52,0)
 I DATA["^P" G PRVX
"RTN","PXBPPRV",53,0)
 I DATA["^I" G PRVX
"RTN","PXBPPRV",54,0)
 ;
"RTN","PXBPPRV",55,0)
 I DATA="",$D(PXBDPRV) S DATA=$P($G(PXBDPRV),"^",2) I DATA="" S PXBUT=1 G PRVX
"RTN","PXBPPRV",56,0)
 I DATA="",'$D(PXBDPRV) S PXBUT=1 G PRVX
"RTN","PXBPPRV",57,0)
 ;
"RTN","PXBPPRV",58,0)
 I PXBCNT>10&((DATA="+")!(DATA="-")) D DPRV4^PXBDPRV(DATA) W IORC D WIN17^PXBCC(PXBCNT) G P
"RTN","PXBPPRV",59,0)
 ;
"RTN","PXBPPRV",60,0)
M ;--IF Multiple entries have been entered
"RTN","PXBPPRV",61,0)
 ;--CAN'T DO!!!!
"RTN","PXBPPRV",62,0)
 ;--IF Multiple deleting of entries
"RTN","PXBPPRV",63,0)
 D DELM^PXBPPRV1
"RTN","PXBPPRV",64,0)
 I $G(NF) G P1
"RTN","PXBPPRV",65,0)
 ;
"RTN","PXBPPRV",66,0)
LI ;--If picked a line number
"RTN","PXBPPRV",67,0)
 I (DATA>0)&(DATA<(PXBCNT+1))&($L(DATA)'>$L(PXBCNT)) S XFLAG=1 D REVPRV^PXBCC(DATA) S SELINE=DATA D
"RTN","PXBPPRV",68,0)
 .I $G(FROM)["PL" Q
"RTN","PXBPPRV",69,0)
 .I $G(FROM)["CPT"  K SELINE S DATA="NOT VALID" Q
"RTN","PXBPPRV",70,0)
 .F I=1:1:$L(DATA) W IOCUB,IOECH
"RTN","PXBPPRV",71,0)
 .S PRISEC=$P($G(PXBSAM(DATA)),"^",2) S:PRISEC["PRI" FPRI=0
"RTN","PXBPPRV",72,0)
 .S DATA=$P($G(PXBSAM(DATA)),"^",1)
"RTN","PXBPPRV",73,0)
 I $D(XFLAG),XFLAG=1 S Y=DATA G PFIN
"RTN","PXBPPRV",74,0)
 ;
"RTN","PXBPPRV",75,0)
 ;--If PRV is already in the file
"RTN","PXBPPRV",76,0)
 I DATA="" S PXBUT=1 G PRVX
"RTN","PXBPPRV",77,0)
 I '$G(DOUBLEQQ),$D(PXBKY(DATA)) D
"RTN","PXBPPRV",78,0)
 .I PXBCNT>10 D DPRV4^PXBDPRV($O(PXBKY(DATA,0)))
"RTN","PXBPPRV",79,0)
 .K Q D TIMES^PXBUTL(DATA)
"RTN","PXBPPRV",80,0)
 .I Q=1 S LINE=$O(PXBKY(DATA,0)) S XFLAG=1 D:$G(FROM)'="PL" REVPRV^PXBCC(LINE) S PRISEC=$P($G(PXBSAM(LINE)),"^",2) I $P(PXBSAM(LINE),"^",2)["PRI" S FPRI=0
"RTN","PXBPPRV",81,0)
 .I Q>1 S NLINE=0 F  S NLINE=$O(Q(NLINE)) Q:NLINE=""  D REVPRV^PXBCC(NLINE)
"RTN","PXBPPRV",82,0)
 I $D(Q),Q>1 D WHICH^PXBPWCH G LI
"RTN","PXBPPRV",83,0)
 I $D(XFLAG),XFLAG=1 S Y=DATA G PFIN
"RTN","PXBPPRV",84,0)
 ;--Need to do a DIC lookup on data
"RTN","PXBPPRV",85,0)
 ;
"RTN","PXBPPRV",86,0)
 K FIRST
"RTN","PXBPPRV",87,0)
 I DATA'="??" D:DATA="?" EN1^PXBHLP0("PXB","PRV",1,"",1) G:DATA="^P" P I DATA="?" G P
"RTN","PXBPPRV",88,0)
 I DATA="??" S DOUBLEQQ=1 D EN1^PXBHLP0("PXB","PRV","",1,2) S:DATA="P" UDATA="^P" S:$L(DATA,"^")>1 (Y,DATA,EDATA)=$P(DATA,"^",2) S:$G(UDATA)="" UDATA="^P" S:UDATA="^P" (DATA,EDATA,Y)=UDATA G:UDATA="^P" P1 G PFIN
"RTN","PXBPPRV",89,0)
 ;
"RTN","PXBPPRV",90,0)
 ;--If a "?" is NOT entered during lookup
"RTN","PXBPPRV",91,0)
 S FROM="PRV",(VAL,Y)=$$DOUBLE1^PXBGPRV2(FROM) I Y<1 S DATA="^P",DOUBLEQQ=1 G P1
"RTN","PXBPPRV",92,0)
 ;S (X,DATA,EDATA)=$P(VAL,"^",2),DIC="^VA(200,",DIC(0)="MZ" D ^DIC
"RTN","PXBPPRV",93,0)
 S X="`"_+Y,(DATA,EDATA)=$P(VAL,"^",2),DIC="^VA(200,",DIC(0)="MZ" D ^DIC
"RTN","PXBPPRV",94,0)
 I Y=-1 S PXBUT=1 G PRVX
"RTN","PXBPPRV",95,0)
 ;
"RTN","PXBPPRV",96,0)
 ;--If Y is good and already in file...
"RTN","PXBPPRV",97,0)
 ;I '$G(DOUBLEQQ),$D(Y),$D(PXBKY($P(Y,"^",2))) D
"RTN","PXBPPRV",98,0)
 I '$G(DOUBLEQQ),($P($G(Y),"^",2)]""),$D(PXBKY($P(Y,"^",2))) D
"RTN","PXBPPRV",99,0)
 .S LINE=$O(PXBKY($P(Y,"^",2),0))
"RTN","PXBPPRV",100,0)
 .S PRISEC=$P($G(PXBSAM(LINE)),"^",2) S:PRISEC["PRI" FPRI=0
"RTN","PXBPPRV",101,0)
 S PRV=Y(0)
"RTN","PXBPPRV",102,0)
 ;
"RTN","PXBPPRV",103,0)
PFIN ;--Finish the Provider
"RTN","PXBPPRV",104,0)
 I $L(Y,"^")'>1,$G(SELINE) S X="`"_$P(^AUPNVPRV($O(PXBSKY(SELINE,0)),0),"^",1),DIC="^VA(200,",DIC(0)="MZ" D ^DIC
"RTN","PXBPPRV",105,0)
 I $L(Y,"^")'>1,'$G(SELINE) S X=Y,DIC="^VA(200,",DIC(0)="MZ" D ^DIC
"RTN","PXBPPRV",106,0)
 I +Y<0 D HELP^PXBUTL0("PRVM") W IOCUU G P
"RTN","PXBPPRV",107,0)
 S PRV=Y(0)
"RTN","PXBPPRV",108,0)
 S PXBNPRV($P(PRV,"^",1))=""
"RTN","PXBPPRV",109,0)
 S PXBNPRVL(1)=$P(PRV,"^",1) S ^DISV(DUZ,"PXBPRV-4")=$P(PRV,"^",1)
"RTN","PXBPPRV",110,0)
 I $D(PXBKY($P(Y(0),"^"))),$G(SELINE) S $P(REQI,"^",7)=$O(PXBSKY(SELINE,0)),$P(REQI,"^",2)=$P($G(PXBSAM(SELINE)),"^",2)
"RTN","PXBPPRV",111,0)
 I $D(PXBKY($P(Y(0),"^"))),'$G(SELINE) S $P(REQI,"^",7)=$O(PXBSKY($O(PXBKY($P(Y(0),"^"),0)),0)) S PAT=$P(Y(0),"^",1),ITEM=$O(PXBKY(PAT,0)),$P(REQI,"^",2)=$E($P($G(PXBKY(PAT,ITEM)),"^",2),1),$P(REQE,"^",2)=$P($G(PXBKY(PAT,ITEM)),"^",2)
"RTN","PXBPPRV",112,0)
 S $P(REQI,"^",1)=+Y
"RTN","PXBPPRV",113,0)
 I $P(REQI,"^",2)']"" S $P(REQI,"^",2)="S",$P(REQE,"^",2)="SECONDARY"
"RTN","PXBPPRV",114,0)
 S $P(REQE,"^",1)=$P(PRV,"^",1)
"RTN","PXBPPRV",115,0)
 I '$D(REQI) S REQI=""
"RTN","PXBPPRV",116,0)
 ;---IF INACTIVE ISSUE A WARNING
"RTN","PXBPPRV",117,0)
 I DATA]"" D ACTIVE^PXBPPRV1
"RTN","PXBPPRV",118,0)
PRVX ;--EXIT AND CLEAN UP
"RTN","PXBPPRV",119,0)
 I $G(WHAT)="INTV",DATA="^" S PXBEXIT="^^"
"RTN","PXBPPRV",120,0)
 I '$D(REQI) S REQI=""
"RTN","PXBPPRV",121,0)
 I '$D(REQE) S REQE=""
"RTN","PXBPPRV",122,0)
 I $P(REQE,"^",1)="" S $P(REQE,"^",1)="...No Provider Selected..."
"RTN","PXBPPRV",123,0)
 I FROM="PRV",$L(EDATA)<40 D
"RTN","PXBPPRV",124,0)
 .F I=1:1:$L(ECHO) W IOCUB,IOELEOL
"RTN","PXBPPRV",125,0)
 .F I=1:1:$L(ECHO) W IOCUF
"RTN","PXBPPRV",126,0)
 .I $P(REQE,"^",1)'["...No" W $P(REQE,"^",1)
"RTN","PXBPPRV",127,0)
 Q
"RTN","PXBUTL")
0^13^B26167434
"RTN","PXBUTL",1,0)
PXBUTL ;ISL/JVS,ESW - UTILITIES FOR PROMPTS ; 10/31/02 12:13pm
"RTN","PXBUTL",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**32,108**;Aug 12, 1996
"RTN","PXBUTL",3,0)
 ;
"RTN","PXBUTL",4,0)
 ;
"RTN","PXBUTL",5,0)
 ;
"RTN","PXBUTL",6,0)
WAIT ;--SPINNING CURSOR
"RTN","PXBUTL",7,0)
 I PXBMOD=20 W IOCUB,"\"
"RTN","PXBUTL",8,0)
 I PXBMOD=40 W IOCUB,"|"
"RTN","PXBUTL",9,0)
 I PXBMOD=60 W IOCUB,"/"
"RTN","PXBUTL",10,0)
 I PXBMOD=80 W IOCUB,"-"
"RTN","PXBUTL",11,0)
 Q
"RTN","PXBUTL",12,0)
CASE ;--CHANGE LOWER CASE TO UPPER CASE
"RTN","PXBUTL",13,0)
 I $D(DATA) S DATA=$TR(DATA,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PXBUTL",14,0)
 I $D(EDATA) S EDATA=$TR(EDATA,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PXBUTL",15,0)
 I $D(NARR) S NARR=$TR(NARR,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PXBUTL",16,0)
 Q
"RTN","PXBUTL",17,0)
PRIM ;--PRIMARY PROVIDER
"RTN","PXBUTL",18,0)
 N PXBSKY,PXBKY,PXBSAM,PXBCNT,PRVDR,FPRI
"RTN","PXBUTL",19,0)
 D PRV^PXBGPRV(PXBVST,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI)
"RTN","PXBUTL",20,0)
 I $D(PRVDR) Q
"RTN","PXBUTL",21,0)
 I '$D(PXBSKY) Q
"RTN","PXBUTL",22,0)
 ;
"RTN","PXBUTL",23,0)
 D RSET^PXBDREQ("PRV")
"RTN","PXBUTL",24,0)
 S $P(REQI,"^",7)=$O(PXBSKY(1,0))
"RTN","PXBUTL",25,0)
 S $P(REQI,"^",2)="P"
"RTN","PXBUTL",26,0)
 S $P(REQI,"^",1)=$P(^AUPNVPRV($O(PXBSKY(1,0)),0),"^",1)
"RTN","PXBUTL",27,0)
 ;
"RTN","PXBUTL",28,0)
 D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBUTL",29,0)
 D EN1^PXKMAIN
"RTN","PXBUTL",30,0)
 Q
"RTN","PXBUTL",31,0)
PRIMD ;--PRIMARY DIAGNOSIS
"RTN","PXBUTL",32,0)
 D POV^PXBGPOV(PXBVST)
"RTN","PXBUTL",33,0)
 I $D(PXDIGNS) Q
"RTN","PXBUTL",34,0)
 I '$D(PXBSKY) Q
"RTN","PXBUTL",35,0)
 ;
"RTN","PXBUTL",36,0)
 D RSET^PXBDREQ("POV")
"RTN","PXBUTL",37,0)
 S $P(REQI,"^",9)=$O(PXBSKY(1,0))
"RTN","PXBUTL",38,0)
 S $P(REQI,"^",6)="P"
"RTN","PXBUTL",39,0)
 S $P(REQI,"^",5)=$P(^AUPNVPOV($O(PXBSKY(1,0)),0),"^",1)
"RTN","PXBUTL",40,0)
 ;
"RTN","PXBUTL",41,0)
 D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBUTL",42,0)
 D EN1^PXKMAIN
"RTN","PXBUTL",43,0)
 Q
"RTN","PXBUTL",44,0)
 ;
"RTN","PXBUTL",45,0)
 ;
"RTN","PXBUTL",46,0)
HDR(PXBVST,NO,PXBIOF) ;--Header for each screen PATIENT and DATE/TIME of Visit
"RTN","PXBUTL",47,0)
 N DATE,DIC,DIQ,DATE,DA,DR
"RTN","PXBUTL",48,0)
 N CLINICE
"RTN","PXBUTL",49,0)
 I '$D(IORVON) D TERM^PXBCC
"RTN","PXBUTL",50,0)
 S DIC=9000010,DR=".01;.05;.22",DA=PXBVST,DIQ="AMANDA(",DIQ(0)="EI" D EN^DIQ1
"RTN","PXBUTL",51,0)
 S PATIENT=$G(AMANDA(9000010,PXBVST,.05,"I"))
"RTN","PXBUTL",52,0)
 S NAME=$G(AMANDA(9000010,PXBVST,.05,"E"))
"RTN","PXBUTL",53,0)
 S DATE=$G(AMANDA(9000010,PXBVST,.01,"E"))
"RTN","PXBUTL",54,0)
 S IDATE=$G(AMANDA(9000010,PXBVST,.01,"I"))
"RTN","PXBUTL",55,0)
 S CLINIC=$G(AMANDA(9000010,PXBVST,.22,"I"))
"RTN","PXBUTL",56,0)
 S CLINICE=$G(AMANDA(9000010,PXBVST,.22,"E"))
"RTN","PXBUTL",57,0)
 I $L(CLINICE)>20 S CLINICE=$E(CLINICE,1,20)
"RTN","PXBUTL",58,0)
 K AMANDA
"RTN","PXBUTL",59,0)
 I '$G(PXBIOF) W @IOF
"RTN","PXBUTL",60,0)
 ;
"RTN","PXBUTL",61,0)
 I '$G(NO) W !
"RTN","PXBUTL",62,0)
 I $G(NO) D
"RTN","PXBUTL",63,0)
 .W IOINHI,!,IOCUU,"PAT/APPT/CLINIC:  ",$E(NAME,1,18),"  ",DATE,?((IOM-2)-$L(CLINICE)),CLINICE,IOINLOW
"RTN","PXBUTL",64,0)
 Q
"RTN","PXBUTL",65,0)
HDR2(FROM) ;--SECOND LINE IN THE HEADER
"RTN","PXBUTL",66,0)
 I '$D(FROM) Q
"RTN","PXBUTL",67,0)
 I FROM="STP" D LOC^PXBCC(1,0) D
"RTN","PXBUTL",68,0)
 .I PXBCNT=0 W "STOP CODE: ..There are ",$G(PXBCNT)," STOP CODES associated with this ENCOUNTER",IOELEOL
"RTN","PXBUTL",69,0)
 .I PXBCNT=1 W "STOP CODE: ..There is ",$G(PXBCNT)," STOP CODE associated with this ENCOUNTER",IOELEOL
"RTN","PXBUTL",70,0)
 .I PXBCNT>1 W "STOP CODE: ..There are ",$G(PXBCNT)," STOP CODES associated with this ENCOUNTER",IOELEOL
"RTN","PXBUTL",71,0)
 .D UNDON^PXBCC
"RTN","PXBUTL",72,0)
 .W !
"RTN","PXBUTL",73,0)
 .F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBUTL",74,0)
 .D UNDOFF^PXBCC
"RTN","PXBUTL",75,0)
 ;
"RTN","PXBUTL",76,0)
 ;
"RTN","PXBUTL",77,0)
 ;
"RTN","PXBUTL",78,0)
 I FROM="PRV" D LOC^PXBCC(1,0) D
"RTN","PXBUTL",79,0)
 .I PXBCNT=0 W "PROVIDER: ..There are ",$G(PXBCNT)," PROVIDERS associated with this ENCOUNTER",IOELEOL
"RTN","PXBUTL",80,0)
 .I PXBCNT=1 W "PROVIDER: ..There is ",$G(PXBCNT)," PROVIDER associated with this ENCOUNTER",IOELEOL
"RTN","PXBUTL",81,0)
 .I PXBCNT>1 W "PROVIDER: ..There are ",$G(PXBCNT)," PROVIDERS associated with this ENCOUNTER",IOELEOL
"RTN","PXBUTL",82,0)
 .D UNDON^PXBCC
"RTN","PXBUTL",83,0)
 .W !
"RTN","PXBUTL",84,0)
 .F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBUTL",85,0)
 .D UNDOFF^PXBCC
"RTN","PXBUTL",86,0)
 Q
"RTN","PXBUTL",87,0)
HDR3(DFN,NO,PXBIOF) ;--Header for each screen PATIENT and DATE/TIME of Visit
"RTN","PXBUTL",88,0)
 ;
"RTN","PXBUTL",89,0)
 ; NO  = IF 1 then just do line feed don't do header
"RTN","PXBUTL",90,0)
 ; PXBIOF = IF 1 then don't W @IOF
"RTN","PXBUTL",91,0)
 ;
"RTN","PXBUTL",92,0)
 ;
"RTN","PXBUTL",93,0)
 N DATE,DIC,DIQ,DATE,DA,DR
"RTN","PXBUTL",94,0)
 N NAME,SEX,AGE,SSN
"RTN","PXBUTL",95,0)
 I '$D(IORVON) D TERM^PXBCC
"RTN","PXBUTL",96,0)
 S DIC=2,DR=".01;.02;.033;.09",DA=DFN,DIQ="AMANDA(",DIQ(0)="EI" D EN^DIQ1
"RTN","PXBUTL",97,0)
 S NAME=$G(AMANDA(2,DFN,.01,"E"))
"RTN","PXBUTL",98,0)
 S SEX=$G(AMANDA(2,DFN,.02,"E"))
"RTN","PXBUTL",99,0)
 S AGE=$G(AMANDA(2,DFN,.033,"E"))
"RTN","PXBUTL",100,0)
 S SSN=$G(AMANDA(2,DFN,.09,"E"))
"RTN","PXBUTL",101,0)
 S SSN=$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)
"RTN","PXBUTL",102,0)
 K AMANDA
"RTN","PXBUTL",103,0)
 I '$G(PXBIOF) W @IOF
"RTN","PXBUTL",104,0)
 ;
"RTN","PXBUTL",105,0)
 I '$G(NO) W !
"RTN","PXBUTL",106,0)
 I $G(NO) W IOINHI,!,IOCUU,"PAT/SEX/AGE/SSN: ",$E(NAME,1,18),"    ",SEX,"    ",AGE_" Years    ",?67,SSN W IOINLOW
"RTN","PXBUTL",107,0)
 Q
"RTN","PXBUTL",108,0)
 ;
"RTN","PXBUTL",109,0)
TIMES(ENT) ;--Number of time the selection appears in v file from PXBKY
"RTN","PXBUTL",110,0)
 ;
"RTN","PXBUTL",111,0)
 N N
"RTN","PXBUTL",112,0)
 S N=0,Q=0 F  S N=$O(PXBKY(ENT,N)) Q:N=""  S Q=Q+1,Q(N)=""
"RTN","PXBUTL",113,0)
 Q
"RTN","PXBUTL",114,0)
 ;
"RTN","PXBUTL",115,0)
CPTOK(CODE,IDATE) ;--check the historical date to see if it was active
"RTN","PXBUTL",116,0)
 ;TO BE USED AS A FUNCTION (W $$CPT......)
"RTN","PXBUTL",117,0)
 ; OK=1-- IT WAS ACTIVE
"RTN","PXBUTL",118,0)
 ; OK=0-- IT WAS NOT ACTIVE
"RTN","PXBUTL",119,0)
 ; RETURNS  OK^INTERNAL FORM OF STATUS DATE^EXTERNAL FORM
"RTN","PXBUTL",120,0)
 N STADATE,STAFLAG,EDATE,STATUS,Y,DATE
"RTN","PXBUTL",121,0)
 S DATE=$P(IDATE,".",1)
"RTN","PXBUTL",122,0)
 S STATUS=$P($$CPT^ICPTCOD(CODE,DATE),U,6,7),STADATE=+STATUS,OK=+$P(STATUS,U,2)
"RTN","PXBUTL",123,0)
 S X=STADATE D H^%DTC,YX^%DTC S EDATE=Y K X,Y,%H,%T,%Y
"RTN","PXBUTL",124,0)
 Q OK_"^"_STADATE_"^"_EDATE
"RTN","PXBUTL",125,0)
 ;
"RTN","PXBUTL",126,0)
CPTSCREN(CODE,IDATE) ;
"RTN","PXBUTL",127,0)
 N OK,DATE
"RTN","PXBUTL",128,0)
 S DATE=$P(IDATE,".",1)
"RTN","PXBUTL",129,0)
 S OK=$P($$CPT^ICPTCOD(CODE,DATE),U,7)
"RTN","PXBUTL",130,0)
 Q +OK
"RTN","PXBUTL",131,0)
 ;
"RTN","PXBUTL",132,0)
CONPRV(PRV) ;---FUNCTION-Convert internal form or provider to external form
"RTN","PXBUTL",133,0)
 N DIC,DA,DR,DIQ,PXBPRV
"RTN","PXBUTL",134,0)
 S DIC=200,DA=PRV,DR=.01,DIQ="PRVA(",DIQ(0)="E" D EN^DIQ1
"RTN","PXBUTL",135,0)
 S PRV=$G(PRVA(200,PRV,.01,"E")) K PRVA
"RTN","PXBUTL",136,0)
 Q PXBPRV_"^"_PRV
"RTN","PXBUTL",137,0)
 ;
"RTN","PXBUTL",138,0)
NONE(NO) ;----Display's a None message to the screen if none is found
"RTN","PXBUTL",139,0)
 N X
"RTN","PXBUTL",140,0)
 I NO=1 S X="No PROVIDERS for this Encounter." D W
"RTN","PXBUTL",141,0)
 I NO=2 S X="No CPT CODES for this Encounter." D W
"RTN","PXBUTL",142,0)
 I NO=3 S X="No DIAGNOSIS for this Encounter." D W
"RTN","PXBUTL",143,0)
 I NO=4 S X="No PROBLEM LIST for this PATIENT." D W
"RTN","PXBUTL",144,0)
 I NO=5 S X="No STOP CODE for this ENCOUNTER." D W
"RTN","PXBUTL",145,0)
 I NO=6 S X="No ENCOUNTERS for this PATIENT." D W
"RTN","PXBUTL",146,0)
 Q
"RTN","PXBUTL",147,0)
W W !,?(IOM-$L(X))\2,IOINHI,X,IOINLOW
"RTN","PXBUTL",148,0)
 Q
"RTN","PXBUTL0")
0^15^B28032772
"RTN","PXBUTL0",1,0)
PXBUTL0 ;ISL/JVS,ESW - UTILITIES-3 LINE HELP MESSAGES ; 12/5/02 11:47am
"RTN","PXBUTL0",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**108**;Aug 12, 1996
"RTN","PXBUTL0",3,0)
 ;
"RTN","PXBUTL0",4,0)
HELP(CAT) ;Help messages written when ?'s are entered.
"RTN","PXBUTL0",5,0)
 ;Each message must have 3 line although any of them can be blank.
"RTN","PXBUTL0",6,0)
 N MES,I
"RTN","PXBUTL0",7,0)
 D @CAT,WR
"RTN","PXBUTL0",8,0)
 Q
"RTN","PXBUTL0",9,0)
 ;
"RTN","PXBUTL0",10,0)
WR ;--Write to the screen
"RTN","PXBUTL0",11,0)
 S I=0 F I=1:1:3 W !,IOELEOL,?(IOM-$L(MES(I)))\2,MES(I)
"RTN","PXBUTL0",12,0)
 Q
"RTN","PXBUTL0",13,0)
 ;
"RTN","PXBUTL0",14,0)
STP1 ;--STOP CODE 1 ?
"RTN","PXBUTL0",15,0)
 S MES(1)="Answer with CLINIC STOP NAME, or AMIS RPORTING STOP CODE."
"RTN","PXBUTL0",16,0)
 S MES(2)=""
"RTN","PXBUTL0",17,0)
 S MES(3)=""
"RTN","PXBUTL0",18,0)
 Q
"RTN","PXBUTL0",19,0)
STP3 ;--STOP CODE 3 ?
"RTN","PXBUTL0",20,0)
 S MES(1)="Enter the STOP CODE associated with this ENCOUNTER."
"RTN","PXBUTL0",21,0)
 S MES(2)="Enter '??' to get the entire list of possible STOP CODES"
"RTN","PXBUTL0",22,0)
 S MES(3)="'*' indicates that STOP CODE has been visited in this session."
"RTN","PXBUTL0",23,0)
 Q
"RTN","PXBUTL0",24,0)
STP900 ;--STOP CODE 900
"RTN","PXBUTL0",25,0)
 S MES(1)="The stop code 900 SPECIAL SERVICES is no longer in service."
"RTN","PXBUTL0",26,0)
 S MES(2)="If you wish to enter procedures, you must use the"
"RTN","PXBUTL0",27,0)
 S MES(3)="option provided to enter a PROCEDURE."
"RTN","PXBUTL0",28,0)
 Q
"RTN","PXBUTL0",29,0)
PRV1 ;--Provider 1 ?
"RTN","PXBUTL0",30,0)
 S MES(1)="Answer with PROVIDER'S NAME, or INITIALS, or SSN, or NICK NAME,"
"RTN","PXBUTL0",31,0)
 S MES(2)="or KEY DELEGATION LEVEL, OR USER CLASS, or LINE NUMBER"
"RTN","PXBUTL0",32,0)
 S MES(3)="from the above list."
"RTN","PXBUTL0",33,0)
 Q
"RTN","PXBUTL0",34,0)
PRV3 ;--Provider 3 ?
"RTN","PXBUTL0",35,0)
 S MES(1)="Enter the PROVIDER who performed or ordered the PROCEDURES"
"RTN","PXBUTL0",36,0)
 S MES(2)="that were performed on the patient during this Encounter."
"RTN","PXBUTL0",37,0)
 S MES(3)="'*' indicates that PROVIDER has been used in this session."
"RTN","PXBUTL0",38,0)
 Q
"RTN","PXBUTL0",39,0)
PRVM ;--CPT Add Multiple Provider(s)
"RTN","PXBUTL0",40,0)
 S MES(1)=$E(EDATA,1,50)
"RTN","PXBUTL0",41,0)
 S MES(2)="The above NAME is not a VALID PROVIDER."
"RTN","PXBUTL0",42,0)
 S MES(3)="" ;--Enter each one separately to get more complete help."
"RTN","PXBUTL0",43,0)
 Q
"RTN","PXBUTL0",44,0)
PRVMD ;--CPT Delete Multiple Providers(s)
"RTN","PXBUTL0",45,0)
 S MES(1)=$E(EDATA,1,50)
"RTN","PXBUTL0",46,0)
 S MES(2)="The above Item(s) are not VALID line numbers or Item numbers."
"RTN","PXBUTL0",47,0)
 S MES(3)=""
"RTN","PXBUTL0",48,0)
 Q
"RTN","PXBUTL0",49,0)
 ;
"RTN","PXBUTL0",50,0)
POV1 ;--Purpose of Visit 1 ?
"RTN","PXBUTL0",51,0)
 S MES(1)=""
"RTN","PXBUTL0",52,0)
 S MES(2)="Answer with ICD DIAGNOSIS CODE NUMBER or DESCRIPTION."
"RTN","PXBUTL0",53,0)
 S MES(3)=""
"RTN","PXBUTL0",54,0)
 Q
"RTN","PXBUTL0",55,0)
POV3 ;--Purpose of Visit 3 ?
"RTN","PXBUTL0",56,0)
 S MES(1)="Enter the DIAGNOSIS that is associated with this ENCOUNTER."
"RTN","PXBUTL0",57,0)
 S MES(2)="It is possible that there is more than one DIAGNOSIS."
"RTN","PXBUTL0",58,0)
 S MES(3)=""
"RTN","PXBUTL0",59,0)
 Q
"RTN","PXBUTL0",60,0)
PL1 ;--Problem list ?
"RTN","PXBUTL0",61,0)
 S MES(1)="Select an Item Number, a '+' or '-', or 'ENTER' or '^' to EXIT this prompt."
"RTN","PXBUTL0",62,0)
 S MES(2)="By selecting one of the PROBLEMS, it can then be entered as a"
"RTN","PXBUTL0",63,0)
 S MES(3)="Diagnosis for this ENCOUNTER with "_NAME_"."
"RTN","PXBUTL0",64,0)
 Q
"RTN","PXBUTL0",65,0)
PL11 ;--Problem List ?
"RTN","PXBUTL0",66,0)
 S MES(1)="Select an Item Number, or 'ENTER' or '^' to EXIT this prompt."
"RTN","PXBUTL0",67,0)
 S MES(2)="By selecting one of the PROBLEMS, it can then be entered as a"
"RTN","PXBUTL0",68,0)
 S MES(3)="Diagnosis for this ENCOUNTER with "_PNAME_"."
"RTN","PXBUTL0",69,0)
 Q
"RTN","PXBUTL0",70,0)
PLM ;--Problem List ?
"RTN","PXBUTL0",71,0)
 S MES(1)="The above is not a valid or active problem."
"RTN","PXBUTL0",72,0)
 S MES(2)=""
"RTN","PXBUTL0",73,0)
 S MES(3)=""
"RTN","PXBUTL0",74,0)
 Q
"RTN","PXBUTL0",75,0)
 ;
"RTN","PXBUTL0",76,0)
CPT1 ;--CPT Procedure 1 ?
"RTN","PXBUTL0",77,0)
 S MES(1)="Answer with CPT CODE or CPT CATEGORY or DESCRIPTION."
"RTN","PXBUTL0",78,0)
 S MES(2)="A '*' next to a procedure indicates that it was either"
"RTN","PXBUTL0",79,0)
 S MES(3)=" ADDED or EDITED during this session."
"RTN","PXBUTL0",80,0)
 Q
"RTN","PXBUTL0",81,0)
CPT4 ;--USE MORE THAN 1 LETTER ?
"RTN","PXBUTL0",82,0)
 S MES(1)="Please use more than 1 letter for your request."
"RTN","PXBUTL0",83,0)
 S MES(2)=""
"RTN","PXBUTL0",84,0)
 S MES(3)=""
"RTN","PXBUTL0",85,0)
 Q
"RTN","PXBUTL0",86,0)
CPT3 ;--CPT Procedure 3 ?
"RTN","PXBUTL0",87,0)
 S MES(1)="Enter the PROCEDURE(S) that were performed during this ENCOUNTER."
"RTN","PXBUTL0",88,0)
 S MES(2)="It may also be a procedure that occurred at another time but."
"RTN","PXBUTL0",89,0)
 S MES(3)="occurred as a result of this ENCOUNTER with the Patient."
"RTN","PXBUTL0",90,0)
 Q
"RTN","PXBUTL0",91,0)
CPTM ;--CPT Add Multiple Procedure(s)
"RTN","PXBUTL0",92,0)
 S MES(1)=$E(EDATA,1,50)
"RTN","PXBUTL0",93,0)
 S MES(2)="The above entry is not a VALID or ACTIVE Code(s)."
"RTN","PXBUTL0",94,0)
 S MES(3)=""
"RTN","PXBUTL0",95,0)
 ;S MES(3)="Enter each one separately to get more complete help."
"RTN","PXBUTL0",96,0)
 Q
"RTN","PXBUTL0",97,0)
CPTMDP ;--CPT Adding Procedure with Multiple that already exist
"RTN","PXBUTL0",98,0)
 S MES(1)=$E(EDATA,1,50)
"RTN","PXBUTL0",99,0)
 S MES(2)="The above entry was already entered for this Encounter."
"RTN","PXBUTL0",100,0)
 S MES(3)="Enter it separately if you still want to add/edit."
"RTN","PXBUTL0",101,0)
 Q
"RTN","PXBUTL0",102,0)
CPTMNO ;--CPT Add Multiple Procedure(s)
"RTN","PXBUTL0",103,0)
 W !,$E(EDATA,1,50)
"RTN","PXBUTL0",104,0)
 W !,"The above Item(s) are not VALID or ACTIVE Codes."
"RTN","PXBUTL0",105,0)
 W !,"Enter each one separately to get more complete help."
"RTN","PXBUTL0",106,0)
 Q
"RTN","PXBUTL0",107,0)
CPTMD ;--CPT Delete Multiple Procedure(s)
"RTN","PXBUTL0",108,0)
 S MES(1)=$E(EDATA,1,50)
"RTN","PXBUTL0",109,0)
 S MES(2)="The above Item(s) are not VALID line numbers or Item numbers."
"RTN","PXBUTL0",110,0)
 S MES(3)=""
"RTN","PXBUTL0",111,0)
 Q
"RTN","PXBUTL0",112,0)
WH1 ;--WHICH when selecting different line options 1 ?
"RTN","PXBUTL0",113,0)
 S MES(1)="Enter the line number of the entry that you are selecting."
"RTN","PXBUTL0",114,0)
 S MES(2)=""
"RTN","PXBUTL0",115,0)
 S MES(3)=""
"RTN","PXBUTL0",116,0)
 Q
"RTN","PXBUTL0",117,0)
 ;
"RTN","PXBUTL0",118,0)
WH2 ;--WHICH when selecting different line options 2 ?
"RTN","PXBUTL0",119,0)
 S MES(1)="You can select any line number that you wish."
"RTN","PXBUTL0",120,0)
 S MES(2)=""
"RTN","PXBUTL0",121,0)
 S MES(3)=""
"RTN","PXBUTL0",122,0)
 Q
"RTN","PXBUTL0",123,0)
 ;
"RTN","PXBUTL0",124,0)
WH3 ;--WHICH when selecting different line options 3 ?
"RTN","PXBUTL0",125,0)
 S MES(1)="Please select any line number that you wish or ""^"" to exit."
"RTN","PXBUTL0",126,0)
 S MES(2)=""
"RTN","PXBUTL0",127,0)
 S MES(3)=""
"RTN","PXBUTL0",128,0)
 Q
"RTN","PXBUTL0",129,0)
QU1 ;--QUANTITY when changing quantity of CPT's ?
"RTN","PXBUTL0",130,0)
 S MES(1)="This is the number of times this CPT was done to the patient"
"RTN","PXBUTL0",131,0)
 S MES(2)="during the encounter."
"RTN","PXBUTL0",132,0)
 S MES(3)=""
"RTN","PXBUTL0",133,0)
 Q
"RTN","PXBUTL0",134,0)
QU2 ;--QUANTITY when changing quantity of CPT'S ??
"RTN","PXBUTL0",135,0)
 S MES(1)="Enter a number between 0 and 99 indicating how many times"
"RTN","PXBUTL0",136,0)
 S MES(2)="this procedure was performed on the patient"
"RTN","PXBUTL0",137,0)
 S MES(3)="during this encounter."
"RTN","PXBUTL0",138,0)
 Q
"RTN","PXBUTL0",139,0)
 ;
"RTN","PXKENC")
0^17^B23082331
"RTN","PXKENC",1,0)
PXKENC ;ISL/dee,ESW - Builds the array of all encounter data for the event point ; 12/5/02 11:53am
"RTN","PXKENC",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**15,22,73,108**;Aug 12, 1996
"RTN","PXKENC",3,0)
 Q
"RTN","PXKENC",4,0)
 ;
"RTN","PXKENC",5,0)
GETENC(DFN,ENCDT,HLOC) ;Get all of the encounter data
"RTN","PXKENC",6,0)
 ;Parameters:
"RTN","PXKENC",7,0)
 ;  DFN    Pointer to the patient (#9000001)
"RTN","PXKENC",8,0)
 ;  ENCDT  Date/Time of the encounter in Fileman format
"RTN","PXKENC",9,0)
 ;  HLOC   Pointer to Hospital Location (#44)
"RTN","PXKENC",10,0)
 ;
"RTN","PXKENC",11,0)
 ;Returns:
"RTN","PXKENC",12,0)
 ;  -2  if called incorrectly
"RTN","PXKENC",13,0)
 ;  -1  if could not find encounter
"RTN","PXKENC",14,0)
 ;  >0  Visit ien(s) separated by ^
"RTN","PXKENC",15,0)
 ;
"RTN","PXKENC",16,0)
 ;  The encounter is returned in the array
"RTN","PXKENC",17,0)
 ;    ^TMP("PXKENC",$J,pointer to visit)
"RTN","PXKENC",18,0)
 ;  may contain more than one visit
"RTN","PXKENC",19,0)
 ;
"RTN","PXKENC",20,0)
 N VISITIEN,REVDT,RETURN
"RTN","PXKENC",21,0)
 K ^TMP("PXKENC",$J)
"RTN","PXKENC",22,0)
 S RETURN=-1
"RTN","PXKENC",23,0)
 Q:DFN'>0!(ENCDT<1800000)!(HLOC'>0) -2
"RTN","PXKENC",24,0)
 S REVDT=(9999999-$P(+ENCDT,".",1))_$S($P(+ENCDT,".",2)'="":"."_$P(+ENCDT,".",2),1:"")
"RTN","PXKENC",25,0)
 S VISITIEN=0
"RTN","PXKENC",26,0)
 F  S VISITIEN=$O(^AUPNVSIT("AA",+DFN,REVDT,VISITIEN)) Q:'VISITIEN  D
"RTN","PXKENC",27,0)
 . I $P($G(^AUPNVSIT(VISITIEN,0)),"^",22)=HLOC,"C~S"'[$P($G(^AUPNVSIT(VISITIEN,150)),"^",3) D
"RTN","PXKENC",28,0)
 .. D ENCEVENT(VISITIEN,1)
"RTN","PXKENC",29,0)
 .. I RETURN<1 S RETURN=VISITIEN
"RTN","PXKENC",30,0)
 .. E  S RETURN=RETURN_"^"_VISITIEN
"RTN","PXKENC",31,0)
 Q RETURN
"RTN","PXKENC",32,0)
 ;
"RTN","PXKENC",33,0)
ENCEVENT(VISITIEN,DONTKILL) ;Create the ^TMP("PXKENC",$J, array of all the
"RTN","PXKENC",34,0)
 ;  information about one encounter.
"RTN","PXKENC",35,0)
 ;Parameters:
"RTN","PXKENC",36,0)
 ;  VISITIEN  Pointer to the Visit (#9000010)
"RTN","PXKENC",37,0)
 ;  DONOTKILL is 1 if the output array is not to be killed before used
"RTN","PXKENC",38,0)
 ;            and 0 or null if the array is to be killed (cleaned out)
"RTN","PXKENC",39,0)
 ;
"RTN","PXKENC",40,0)
 ;  The encounter is returned in the array
"RTN","PXKENC",41,0)
 ;    ^TMP("PXKENC",$J,pointer to visit)
"RTN","PXKENC",42,0)
 ;
"RTN","PXKENC",43,0)
 I '$D(^AUPNVSIT(VISITIEN)) Q
"RTN","PXKENC",44,0)
 K:'$G(DONTKILL) ^TMP("PXKENC",$J)
"RTN","PXKENC",45,0)
 N PXKCNT,PXKROOT
"RTN","PXKENC",46,0)
 S PXKROOT=$NA(@("^TMP(""PXKENC"",$J,"_VISITIEN_")"))
"RTN","PXKENC",47,0)
 ;
"RTN","PXKENC",48,0)
 N IEN,FILE,VFILE,FILESTR,PXKNODE
"RTN","PXKENC",49,0)
 F FILE="SIT","CSTP","PRV","POV","CPT","TRT","IMM","PED","SK","HF","XAM" D
"RTN","PXKENC",50,0)
 . S FILESTR=$S(FILE="SIT":"VST",1:FILE)
"RTN","PXKENC",51,0)
 . S VFILE=$P($T(GLOBAL^@("PXKF"_$S(FILE="SIT":"VST",FILE="CSTP":"VST",1:FILE))),";;",2)
"RTN","PXKENC",52,0)
 . I FILE="SIT" D
"RTN","PXKENC",53,0)
 .. S IEN=VISITIEN
"RTN","PXKENC",54,0)
 .. S PXKNODE=""
"RTN","PXKENC",55,0)
 .. F  S PXKNODE=$O(@VFILE@(IEN,PXKNODE)) Q:PXKNODE=""  D
"RTN","PXKENC",56,0)
 ... S @PXKROOT@(FILESTR,IEN,PXKNODE)=@VFILE@(IEN,PXKNODE)
"RTN","PXKENC",57,0)
 . E  D
"RTN","PXKENC",58,0)
 .. I FILE="PRV" D EVALD(VISITIEN,PXKROOT,VFILE,FILESTR)
"RTN","PXKENC",59,0)
 .. I FILE'="PRV" S IEN="" F  S IEN=$O(@VFILE@("AD",VISITIEN,IEN)) Q:'IEN  D
"RTN","PXKENC",60,0)
 ... I FILE="CSTP","SC"'[$P($G(@VFILE@(IEN,150)),"^",3) Q
"RTN","PXKENC",61,0)
 ... S PXKNODE=""
"RTN","PXKENC",62,0)
 ... F  S PXKNODE=$O(@VFILE@(IEN,PXKNODE)) Q:PXKNODE=""  D:PXKNODE'=801
"RTN","PXKENC",63,0)
 .... ;for cpt modifiers
"RTN","PXKENC",64,0)
 .... I FILE="CPT",PXKNODE=1 D  Q
"RTN","PXKENC",65,0)
 ..... S @PXKROOT@(FILESTR,IEN,PXKNODE,0)=$G(@VFILE@(IEN,PXKNODE,0))
"RTN","PXKENC",66,0)
 ..... N SUBIEN
"RTN","PXKENC",67,0)
 ..... S SUBIEN=0
"RTN","PXKENC",68,0)
 ..... F  S SUBIEN=$O(@VFILE@(IEN,PXKNODE,SUBIEN)) Q:SUBIEN=""  D
"RTN","PXKENC",69,0)
 ...... S @PXKROOT@(FILESTR,IEN,PXKNODE,SUBIEN,0)=$G(@VFILE@(IEN,PXKNODE,SUBIEN,0))
"RTN","PXKENC",70,0)
 .... ;
"RTN","PXKENC",71,0)
 .... S @PXKROOT@(FILESTR,IEN,PXKNODE)=$G(@VFILE@(IEN,PXKNODE))
"RTN","PXKENC",72,0)
 Q
"RTN","PXKENC",73,0)
EVALD(VISITIEN,PXKROOT,VFILE,FILESTR) ;evaluation for duplicate providers
"RTN","PXKENC",74,0)
 N CNT,PR,PRS,PS,PP,PRV,STR
"RTN","PXKENC",75,0)
 S IEN="",CNT=0
"RTN","PXKENC",76,0)
 F  S IEN=$O(@VFILE@("AD",VISITIEN,IEN)) Q:'IEN  D
"RTN","PXKENC",77,0)
 .S STR=@VFILE@(IEN,0),PR=+STR,PS=$P(STR,U,4)
"RTN","PXKENC",78,0)
 .I PS="P",'CNT S PRV=PR,CNT=1 D PXKNODE(VFILE,FILESTR,IEN,PXKROOT)
"RTN","PXKENC",79,0)
 .I PS="S" S PRS(PR,IEN)="" D PXKNODE(VFILE,FILESTR,IEN,PXKROOT)
"RTN","PXKENC",80,0)
 .Q
"RTN","PXKENC",81,0)
 S PR="" F  S PR=$O(PRS(PR)) Q:PR=""  S IEN="" D
"RTN","PXKENC",82,0)
 .F PP=1:1 S IEN=$O(PRS(PR,IEN)) Q:IEN=""  D
"RTN","PXKENC",83,0)
 ..I PR=$G(PRV) K @PXKROOT@(FILESTR,IEN) Q
"RTN","PXKENC",84,0)
 ..I PP>1 K @PXKROOT@(FILESTR,IEN)
"RTN","PXKENC",85,0)
 Q
"RTN","PXKENC",86,0)
PXKNODE(VFILE,FILESTR,IEN,PXKROOT) ;
"RTN","PXKENC",87,0)
 N STRR S PXKNODE=""
"RTN","PXKENC",88,0)
 F  S PXKNODE=$O(@VFILE@(IEN,PXKNODE)) Q:PXKNODE=""  D:PXKNODE'=801
"RTN","PXKENC",89,0)
 . I $E($P($P(PXKROOT,","),"(",2),2,7)="PXKENC" D
"RTN","PXKENC",90,0)
 ..; ENCEVENT called
"RTN","PXKENC",91,0)
 .. S @PXKROOT@(FILESTR,IEN,PXKNODE)=$G(@VFILE@(IEN,PXKNODE))
"RTN","PXKENC",92,0)
 . E  I $E($P($P(PXKROOT,","),"(",2),2,6)="PXKCO" D
"RTN","PXKENC",93,0)
 ..; COEVENT called
"RTN","PXKENC",94,0)
 .. F STRR="BEFORE","AFTER" D
"RTN","PXKENC",95,0)
 ... S @PXKROOT@(FILESTR,IEN,PXKNODE,STRR)=$G(@VFILE@(IEN,PXKNODE))
"RTN","PXKENC",96,0)
 Q
"RTN","PXKENC",97,0)
 ;
"RTN","PXKENC",98,0)
COEVENT(VISITIEN) ;Add to the ^TMP("PXKCO",$J, array all of the
"RTN","PXKENC",99,0)
 ;   information that is not already there.
"RTN","PXKENC",100,0)
 I '$D(^AUPNVSIT(VISITIEN)) Q
"RTN","PXKENC",101,0)
 N PXKCNT,PXKROOT
"RTN","PXKENC",102,0)
 S PXKROOT=$NA(@("^TMP(""PXKCO"",$J,"_VISITIEN_")"))
"RTN","PXKENC",103,0)
 ;
"RTN","PXKENC",104,0)
 N IEN,FILE,VFILE,PXKNODE
"RTN","PXKENC",105,0)
 F FILE="CSTP","PRV","POV","CPT","TRT","IMM","PED","SK","HF","XAM" D
"RTN","PXKENC",106,0)
 . S VFILE=$P($T(GLOBAL^@("PXKF"_$S(FILE="CSTP":"VST",1:FILE))),";;",2)
"RTN","PXKENC",107,0)
 . I FILE="PRV" D EVALD(VISITIEN,PXKROOT,VFILE,FILE)
"RTN","PXKENC",108,0)
 . I FILE'="PRV" S IEN="" F  S IEN=$O(@VFILE@("AD",VISITIEN,IEN)) Q:'IEN  D
"RTN","PXKENC",109,0)
 .. I FILE="CSTP","SC"'[$P($G(@VFILE@(IEN,150)),"^",3) Q
"RTN","PXKENC",110,0)
 .. S PXKNODE=""
"RTN","PXKENC",111,0)
 .. I '$D(@PXKROOT@(FILE,IEN)) D
"RTN","PXKENC",112,0)
 ... F  S PXKNODE=$O(@VFILE@(IEN,PXKNODE)) Q:PXKNODE=""  D:PXKNODE'=801
"RTN","PXKENC",113,0)
 .... I FILE="CPT",PXKNODE=1 D  Q
"RTN","PXKENC",114,0)
 ..... N SUBIEN,MOD
"RTN","PXKENC",115,0)
 ..... S SUBIEN=0
"RTN","PXKENC",116,0)
 ..... F  S SUBIEN=$O(@VFILE@(IEN,PXKNODE,SUBIEN)) Q:'SUBIEN  D
"RTN","PXKENC",117,0)
 ...... S MOD=@VFILE@(IEN,PXKNODE,SUBIEN,0)
"RTN","PXKENC",118,0)
 ...... S @PXKROOT@(FILE,IEN,PXKNODE,"BEFORE",MOD)=""
"RTN","PXKENC",119,0)
 ...... S @PXKROOT@(FILE,IEN,PXKNODE,"AFTER",MOD)=""
"RTN","PXKENC",120,0)
 .... S @PXKROOT@(FILE,IEN,PXKNODE,"BEFORE")=$G(@VFILE@(IEN,PXKNODE))
"RTN","PXKENC",121,0)
 .... S @PXKROOT@(FILE,IEN,PXKNODE,"AFTER")=$G(@VFILE@(IEN,PXKNODE))
"RTN","PXKENC",122,0)
 Q
"RTN","PXKENC",123,0)
 ;
"VER")
8.0^22
**END**
**END**
