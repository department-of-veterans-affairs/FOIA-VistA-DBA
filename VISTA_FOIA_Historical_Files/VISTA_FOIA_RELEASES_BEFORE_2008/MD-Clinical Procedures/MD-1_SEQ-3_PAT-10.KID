Released MD*1*10 SEQ #3
Extracted from mail message
**KIDS**:MD*1.0*10^

**INSTALL NAME**
MD*1.0*10
"BLD",5488,0)
MD*1.0*10^CLINICAL PROCEDURES^0^3050121^y
"BLD",5488,1,0)
^^2^2^3050121^
"BLD",5488,1,1,0)
Please refer to the National Patch Module for the detail of this patch 
"BLD",5488,1,2,0)
build.
"BLD",5488,4,0)
^9.64PA^^
"BLD",5488,"KRN",0)
^9.67PA^8989.52^19
"BLD",5488,"KRN",.4,0)
.4
"BLD",5488,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5488,"KRN",.401,0)
.401
"BLD",5488,"KRN",.402,0)
.402
"BLD",5488,"KRN",.403,0)
.403
"BLD",5488,"KRN",.5,0)
.5
"BLD",5488,"KRN",.84,0)
.84
"BLD",5488,"KRN",3.6,0)
3.6
"BLD",5488,"KRN",3.8,0)
3.8
"BLD",5488,"KRN",9.2,0)
9.2
"BLD",5488,"KRN",9.8,0)
9.8
"BLD",5488,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5488,"KRN",9.8,"NM",1,0)
MDPS1^^0^B76430435
"BLD",5488,"KRN",9.8,"NM",2,0)
MDARP3^^0^B16081083
"BLD",5488,"KRN",9.8,"NM","B","MDARP3",2)

"BLD",5488,"KRN",9.8,"NM","B","MDPS1",1)

"BLD",5488,"KRN",19,0)
19
"BLD",5488,"KRN",19.1,0)
19.1
"BLD",5488,"KRN",101,0)
101
"BLD",5488,"KRN",409.61,0)
409.61
"BLD",5488,"KRN",771,0)
771
"BLD",5488,"KRN",870,0)
870
"BLD",5488,"KRN",8989.51,0)
8989.51
"BLD",5488,"KRN",8989.52,0)
8989.52
"BLD",5488,"KRN",8994,0)
8994
"BLD",5488,"KRN","B",.4,.4)

"BLD",5488,"KRN","B",.401,.401)

"BLD",5488,"KRN","B",.402,.402)

"BLD",5488,"KRN","B",.403,.403)

"BLD",5488,"KRN","B",.5,.5)

"BLD",5488,"KRN","B",.84,.84)

"BLD",5488,"KRN","B",3.6,3.6)

"BLD",5488,"KRN","B",3.8,3.8)

"BLD",5488,"KRN","B",9.2,9.2)

"BLD",5488,"KRN","B",9.8,9.8)

"BLD",5488,"KRN","B",19,19)

"BLD",5488,"KRN","B",19.1,19.1)

"BLD",5488,"KRN","B",101,101)

"BLD",5488,"KRN","B",409.61,409.61)

"BLD",5488,"KRN","B",771,771)

"BLD",5488,"KRN","B",870,870)

"BLD",5488,"KRN","B",8989.51,8989.51)

"BLD",5488,"KRN","B",8989.52,8989.52)

"BLD",5488,"KRN","B",8994,8994)

"BLD",5488,"QUES",0)
^9.62^^
"BLD",5488,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",365,-1)
1^1
"PKG",365,0)
CLINICAL PROCEDURES^MD^Clinical Procedures
"PKG",365,20,0)
^9.402P^^
"PKG",365,22,0)
^9.49I^1^1
"PKG",365,22,1,0)
1.0^3040429^2980529^363
"PKG",365,22,1,"PAH",1,0)
10^3050121
"PKG",365,22,1,"PAH",1,1,0)
^^2^2^3050121
"PKG",365,22,1,"PAH",1,1,1,0)
Please refer to the National Patch Module for the detail of this patch 
"PKG",365,22,1,"PAH",1,1,2,0)
build.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","MDARP3")
0^2^B16081083
"RTN","MDARP3",1,0)
MDARP3 ; HOIFO/NCA - Get Procedures for Medicine ;1/13/04  14:35
"RTN","MDARP3",2,0)
 ;;1.0;CLINICAL PROCEDURES;**10**;Apr 01, 2004
"RTN","MDARP3",3,0)
 ; Please Reference DBIA # 3397
"RTN","MDARP3",4,0)
EN(MCDFN,CODE) ;Get procedures for a patient
"RTN","MDARP3",5,0)
 S WH="" K ^TMP("OR",$J,"MCAR")
"RTN","MDARP3",6,0)
 N MDGBL,MDPTR
"RTN","MDARP3",7,0)
 S MDGBL="^MCAR(690,""AC"",MCDFN)"
"RTN","MDARP3",8,0)
 F  S MDGBL=$Q(@MDGBL) Q:MDGBL=""  Q:$QS(MDGBL,3)'=MCDFN  D
"RTN","MDARP3",9,0)
 .S MDPTR=$QS(MDGBL,6)_";"_$QS(MDGBL,5)_",",S4=$QS(MDGBL,4),S5=$QS(MDGBL,5),S6=$QS(MDGBL,6)
"RTN","MDARP3",10,0)
 .D CONT
"RTN","MDARP3",11,0)
 D PR0
"RTN","MDARP3",12,0)
 K S5 Q
"RTN","MDARP3",13,0)
CONT ;CONT+1 modified on 2-7-94,S MCFILE..2) added to conform w/alpha site
"RTN","MDARP3",14,0)
 Q:$O(^MDD(702,"ACONV",S6_";"_S5_",",0))
"RTN","MDARP3",15,0)
 I $D(^MCAR(+$P(S5,"(",2),S6,2005)) S MCFILE=+$P(S5,"(",2) D SUM^MCMAG
"RTN","MDARP3",16,0)
 I S5="MCAR(702.7" Q
"RTN","MDARP3",17,0)
 I S5="MCAR(699" S (LL,LL1)=$P($G(^MCAR(699,S6,0)),U,12) Q:LL'>0  S LL=$P($G(^MCAR(697.2,LL,0)),U) G:'$D(PE) CONT1 Q:PE'=LL  G CONT1
"RTN","MDARP3",18,0)
 I S5="MCAR(699.5",'$D(PE) D  Q  ;MC*2.3*8
"RTN","MDARP3",19,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MDARP3",20,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U) D CONT1
"RTN","MDARP3",21,0)
 I S5="MCAR(699.5",$D(PE) D  Q  ;MC*2.3*8
"RTN","MDARP3",22,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MDARP3",23,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U)
"RTN","MDARP3",24,0)
 .N LLX,LLY
"RTN","MDARP3",25,0)
 .S LLX=$O(^MCAR(697.2,"B",PE,0)) Q:'LLX  S LLY=$P($G(^MCAR(697.2,LLX,1)),U)
"RTN","MDARP3",26,0)
 .I LLY="S",LLX=LL6 D CONT1
"RTN","MDARP3",27,0)
 .I LLY="P",LLX=LL8 D CONT1
"RTN","MDARP3",28,0)
 I S5[694 S (LL,LL1)=$P($G(^MCAR(694,S6,0)),U,3) Q:'LL  S LL=$P(^MCAR(697.2,LL,0),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1
"RTN","MDARP3",29,0)
 ;MFD 2/5/93 I S5[700,$P($G(^MCAR(700,S6,2)),U)'="Y" Q  ;    exclude unreleased PFT
"RTN","MDARP3",30,0)
 S (LL,LL1)=$O(^MCAR(697.2,"C",S5,0)),LL=$P(^MCAR(697.2,LL,0),U,1)
"RTN","MDARP3",31,0)
CONT1 ;
"RTN","MDARP3",32,0)
 S REC=$O(^MCAR(697.2,"B",LL,0)) S:REC="" REC=0
"RTN","MDARP3",33,0)
 S MCARCODE=""
"RTN","MDARP3",34,0)
 S MCESON=$P($G(^MCAR(697.2,REC,0)),U,14),MCESKEY=$P($G(^MCAR(697.2,REC,0)),U,15),MCSUP=+$P($G(^MCAR(697.2,REC,0)),U,16)
"RTN","MDARP3",35,0)
 S (MCARSUM,MCARPSUM)="",MCARFILE=U_S5_","_S6_",.2)" S:$D(@MCARFILE) MCARSUM=$P(@MCARFILE,U,1),MCARPSUM=$P(@MCARFILE,U,2)
"RTN","MDARP3",36,0)
 K MCARFILE S S1=$S(WH="P":LL,1:S4),S2=$S(WH="P":S4,1:LL)
"RTN","MDARP3",37,0)
 S MCFILE=+$P(S5,"(",2)
"RTN","MDARP3",38,0)
 I MCESON,($G(MCESKEY)'=""),('$$SCRSUMPT^MCESSCR(MCESKEY,S6,MCSUP)) K MCARSUM,MCARPSUM,MCFILE,REC,MCSUP Q
"RTN","MDARP3",39,0)
 I '$$VALID^MCARUTL5(S5,S6,MCDFN) Q  ; MC*2.3*33
"RTN","MDARP3",40,0)
 I $P($G(@(U_S5_","_S6_",""ES"")")),U,7)="S" G EXIT  ;MC*2.3*8
"RTN","MDARP3",41,0)
 S S2=S2_U_S6  ;MC*2.3*8
"RTN","MDARP3",42,0)
 S ^TMP("OR",$J,"MCAR",S1,S2)=MCARSUM_U_S6_";"_S5_","_U_$P(^MCAR(697.2,LL1,0),U,5,7)
"RTN","MDARP3",43,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^CONSULTS" ; MC*2.3*33
"RTN","MDARP3",44,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^NONENDO" ; MC*2.3*33
"RTN","MDARP3",45,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^GI" ; MC*2.3*33
"RTN","MDARP3",46,0)
 I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^PARAC" ; MC*2.3*33
"RTN","MDARP3",47,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,10)=MCARPSUM
"RTN","MDARP3",48,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,11)=LL
"RTN","MDARP3",49,0)
 I S5="MCAR(699.5" D  ;MC*2.3*8
"RTN","MDARP3",50,0)
 .I LL8="" S LL8=" "
"RTN","MDARP3",51,0)
 .S $P(^TMP("OR",$J,"MCAR",S1,S2),U,12)=$E(($E($P($G(^MCAR(697.2,LL6,0)),U,8),1,13)_"/"_$P($G(^MCAR(697.2,LL8,0)),U)),1,31) K LL6,LL8
"RTN","MDARP3",52,0)
EXIT K MCARSUM,MCARPSUM,REC,MCSUP,MCESON Q
"RTN","MDARP3",53,0)
PR0 S I="",L=0
"RTN","MDARP3",54,0)
 F  S I=$O(^TMP("OR",$J,"MCAR",I)) Q:I=""  I I'="OT" D
"RTN","MDARP3",55,0)
 . S J="" F  S J=$O(^TMP("OR",$J,"MCAR",I,J)) Q:J=""  S PR=^(J) D
"RTN","MDARP3",56,0)
 .. Q:$P(PR,U,3,5)="^^"  ; MC*2.3*33
"RTN","MDARP3",57,0)
 .. S MCARDT=$S(WH="P":$P(J,U),1:I),MCARPROC=$S(WH="P":I,1:$P(J,U))
"RTN","MDARP3",58,0)
 .. S MCARPROC=$O(^MCAR(697.2,"B",MCARPROC,0)),MCARPROC=$P(^MCAR(697.2,MCARPROC,0),U,8)
"RTN","MDARP3",59,0)
 .. I $P(PR,U,12)'="" S MCARPROC=$P(PR,U,12)
"RTN","MDARP3",60,0)
 .. S DA=$P(PR,U,2),K=$P(PR,U),M=$P(PR,U,10)
"RTN","MDARP3",61,0)
 .. S K=$S(K="N"!(K="L"):"NORMAL",K="A":"ABNORMAL",K="B":"BORDERLINE",K="T":"TECHNICALLY UNSATISFACTORY",K="ND":"NON-DIAGNOSTIC",K="MI":"MILDLY ABNORMAL",K="MO":"MODERATELY ABNORMAL",K="S":"SEVERELY ABNORMAL",1:"")
"RTN","MDARP3",62,0)
 ..I CODE'="" Q:CODE'=K
"RTN","MDARP3",63,0)
 ..N MCDT S MCDT=MCARDT,Y=9999999.9999-MCARDT X ^DD("DD")
"RTN","MDARP3",64,0)
 ..S L=MCARPROC_"~"_DA
"RTN","MDARP3",65,0)
 ..S ^TMP("MDPLST",$J,MCDT,L)=MCARPROC_U_+DA_U_$P(PR,U,3,5)_U_J S $P(^(L),U,6)=Y,$P(^(L),U,7)=K,$P(^(L),U,10)=M,$P(^(L),U,11)=$S(WH="P":I_U_$P(J,U,2),1:J)
"RTN","MDARP3",66,0)
 K ^TMP("OR",$J,"MCAR")
"RTN","MDARP3",67,0)
 Q
"RTN","MDPS1")
0^1^B76430435
"RTN","MDPS1",1,0)
MDPS1 ; HOIFO/NCA - CP/Medicine Report Generator ;5/18/04  09:48
"RTN","MDPS1",2,0)
 ;;1.0;CLINICAL PROCEDURES;**2,10**;Apr 01, 2004
"RTN","MDPS1",3,0)
 ; Integration Agreements:
"RTN","MDPS1",4,0)
 ; IA# 2693 [Subscription] TIU Extractions.
"RTN","MDPS1",5,0)
 ; IA# 2926 [Subscription] Calls to GMRCGUIA.
"RTN","MDPS1",6,0)
 ; IA# 2944 [Subscription] Calls to TIUSRVR1.
"RTN","MDPS1",7,0)
 ; IA# 3067 [Private] Read fields in Consult file (#123) w/FM
"RTN","MDPS1",8,0)
 ; IA# 4110 [Subscription] Read access field #50 Associated Results in
"RTN","MDPS1",9,0)
 ;                         Consult file (#123) w/FM
"RTN","MDPS1",10,0)
 ; IA# 4230 [Subscription] Document MDPS1 calls.
"RTN","MDPS1",11,0)
 ; IA# 4231 [Subscription] Document CKP^GMTSUP usage.
"RTN","MDPS1",12,0)
 ; IA# 10104 [Supported] Routine XLFSTR calls
"RTN","MDPS1",13,0)
 ;
"RTN","MDPS1",14,0)
 ; Pre-existing local variables
"RTN","MDPS1",15,0)
 ; DFN,GMTS1,GMTS2,GMTSNDM,GMTSNPG,GMTSQIT
"RTN","MDPS1",16,0)
 ;
"RTN","MDPS1",17,0)
EN1(MDGLO,MDDFN,MDSDT,MDEDT,MDMAX,MDPSC,MDALL) ; Return the List of Completed Studies
"RTN","MDPS1",18,0)
 ; Input: MDGLO - Return Global Array (Required)
"RTN","MDPS1",19,0)
 ;        MDDFN - Patient DFN         (Required)
"RTN","MDPS1",20,0)
 ;        MDSDT - Start Date in FM Internal Format (Optional)
"RTN","MDPS1",21,0)
 ;        MDEDT - End Date in FM Internal Format (Optional)
"RTN","MDPS1",22,0)
 ;        MDMAX - Number of studies to return    (Optional)
"RTN","MDPS1",23,0)
 ;        MDPSC - Procedure Summary Code         (Optional)
"RTN","MDPS1",24,0)
 ;        MDALL - Return the all text reports with
"RTN","MDPS1",25,0)
 ;                the procedures list            (Optional)
"RTN","MDPS1",26,0)
 ; (Returns all studies for Patient, if no MDSDT, MDEDT,and MDMAX.)
"RTN","MDPS1",27,0)
 ;
"RTN","MDPS1",28,0)
 I '$G(MDDFN)!('$D(MDGLO)) Q
"RTN","MDPS1",29,0)
 I $G(MDGLO)="" S MDGLO=$NA(^TMP("MDHSP",$J))
"RTN","MDPS1",30,0)
 N MDARR,MDCODE,MDCON,MDCTR,MDDTE,MDLP,MDLP1,MDPLST,MDPROC,MDSTAT,MDT,MDTIUER,MDX,Y
"RTN","MDPS1",31,0)
 S (MDIMG,MDCTR)=0,(MDCODE,MDDTE,MDTIUER)="",MDC=$G(MDPSC)
"RTN","MDPS1",32,0)
 K ^TMP("MDPLST",$J) S MDPLST=$NA(^TMP("MDPLST",$J))
"RTN","MDPS1",33,0)
 ;
"RTN","MDPS1",34,0)
 ; If not converted call old medicine gather routine
"RTN","MDPS1",35,0)
 I $$GET^XPAR("SYS","MD MEDICINE CONVERTED",1) D GET702(.MDGLO,MDDFN,MDC,MDSDT,MDEDT,$S(+$G(MDMAX):MDMAX,1:999)) K ^TMP("MDPLST",$J) Q
"RTN","MDPS1",36,0)
 I '$G(MDSDT),'$G(MDEDT) D EN^MDARP3(MDDFN,MDC)
"RTN","MDPS1",37,0)
 E  D EN^MCARPS3(MDDFN,MDC,MDSDT,MDEDT)
"RTN","MDPS1",38,0)
 ;
"RTN","MDPS1",39,0)
 ; Get CP procedures
"RTN","MDPS1",40,0)
 D GET702(.MDGLO,MDDFN,MDC,MDSDT,MDEDT,$S(+$G(MDMAX):MDMAX,1:999))
"RTN","MDPS1",41,0)
 K ^TMP("MDPLST",$J)
"RTN","MDPS1",42,0)
 Q
"RTN","MDPS1",43,0)
 ;
"RTN","MDPS1",44,0)
GET702(MDGLO,MDDFN,MDC,MDSDT,MDEDT,MDMAX) ; Gather the new 702 entries
"RTN","MDPS1",45,0)
 S MDLP="" F  S MDLP=$O(^MDD(702,"B",MDDFN,MDLP)) Q:MDLP<1  D
"RTN","MDPS1",46,0)
 .S MDX=$G(^MDD(702,MDLP,0)) Q:$P(MDX,"^",9)'=3
"RTN","MDPS1",47,0)
 .S MDPROC=$$GET1^DIQ(702,MDLP_",",.04,"E") Q:MDPROC=""
"RTN","MDPS1",48,0)
 .Q:'$P(MDX,U,6)
"RTN","MDPS1",49,0)
 .K ^TMP("MDTIUST",$J) S MDTIUER=""
"RTN","MDPS1",50,0)
 .D EXTRACT^TIULQ($P(MDX,U,6),"^TMP(""MDTIUST"",$J)",MDTIUER,".01;.05;70201;70202") Q:+MDTIUER
"RTN","MDPS1",51,0)
 .S MDCODE=$G(^TMP("MDTIUST",$J,$P(MDX,U,6),70201,"E"))
"RTN","MDPS1",52,0)
 .S:MDCODE'="" MDCODE=$$UP^XLFSTR(MDCODE)
"RTN","MDPS1",53,0)
 .I $G(MDC)'="" Q:MDCODE'=$G(MDC)
"RTN","MDPS1",54,0)
 .S MDDTE=$G(^TMP("MDTIUST",$J,$P(MDX,U,6),70202,"I"))
"RTN","MDPS1",55,0)
 .S MDSTAT=$G(^TMP("MDTIUST",$J,$P(MDX,U,6),.05,"E"))
"RTN","MDPS1",56,0)
 .S:'MDDTE MDDTE=$$GET1^DIQ(702,MDLP_",",.02,"I")
"RTN","MDPS1",57,0)
 .K ^TMP("MDTIUST",$J)
"RTN","MDPS1",58,0)
 .S MDCON=$P(MDX,U,5)
"RTN","MDPS1",59,0)
 .I +$G(MDSDT) Q:MDDTE<+$G(MDSDT)
"RTN","MDPS1",60,0)
 .I +$G(MDEDT) Q:MDDTE>+$G(MDEDT)
"RTN","MDPS1",61,0)
 .I MDCON D  Q:MDSTAT'="COMPLETE"
"RTN","MDPS1",62,0)
 ..S MDSTAT=$$GET1^DIQ(123,MDCON_",",8,"E")
"RTN","MDPS1",63,0)
 ..I MDSTAT="" S MDSTAT=$$GET1^DIQ(123,MDCON_",",8,"I") S:+MDSTAT MDSTAT=$$GET1^DIQ(100.01,MDSTAT_",",.01,"E")
"RTN","MDPS1",64,0)
 ..Q
"RTN","MDPS1",65,0)
 .S Y=MDDTE X ^DD("DD")
"RTN","MDPS1",66,0)
 .I MDCON Q:$G(MDARR(MDCON))'=""  S MDARR(MDCON)=MDCON
"RTN","MDPS1",67,0)
 .S:$G(^TMP("MDPLST",$J,(9999999.9999-MDDTE),MDPROC_"~"_MDLP))="" ^(MDPROC_"~"_MDLP)=MDPROC_"^"_MDLP_"^"_"PR702"_"^"_"MDPS1"_"^^"_Y_"^"_MDCODE_"^^^^"_MDPROC_"^^"_MDCON
"RTN","MDPS1",68,0)
 .Q
"RTN","MDPS1",69,0)
 S MDCTR=0
"RTN","MDPS1",70,0)
 S MDLP="" F  S MDLP=$O(^TMP("MDPLST",$J,MDLP)) Q:MDLP=""  S MDLP1="" F  S MDLP1=$O(^TMP("MDPLST",$J,MDLP,MDLP1)) Q:MDLP1=""  S MDX=$G(^(MDLP1)) D
"RTN","MDPS1",71,0)
 .I +$G(MDMAX) Q:MDCTR=MDMAX
"RTN","MDPS1",72,0)
 .S MDCTR=MDCTR+1,@MDGLO@(MDCTR)=$G(MDX)
"RTN","MDPS1",73,0)
 K MDARR
"RTN","MDPS1",74,0)
 I +$G(MDALL) K ^TMP("MDPTXT",$J) S MDLP=0 F  S MDLP=$O(@MDGLO@(MDLP)) Q:MDLP<1  S MDX1=$G(@MDGLO@(MDLP)) D
"RTN","MDPS1",75,0)
 .S MCARGDA=+$P(MDX1,U,2),MCPRO=$P(MDX1,U,11),MCARPPS=$P(MDX1,U,3,4)
"RTN","MDPS1",76,0)
 .S MCARGRTN=$P(MDX1,U,5),MDT="RD"
"RTN","MDPS1",77,0)
 .D @MCARPPS
"RTN","MDPS1",78,0)
 K MCARGDA,MCARGRTN,MCPRO,MCARPPS
"RTN","MDPS1",79,0)
 Q
"RTN","MDPS1",80,0)
CPA ; Abnormal Report - Health Summary Component
"RTN","MDPS1",81,0)
 N MDHR,MDHSG,MDHDR,MDHFLG,MDLIM,MDTS1,MDTS2,MDX1
"RTN","MDPS1",82,0)
 Q:'$G(DFN)  Q:'$G(GMTS1)  Q:'$G(GMTS2)
"RTN","MDPS1",83,0)
 K ^TMP("MDHSP",$J) S MDHFLG=1
"RTN","MDPS1",84,0)
 S MDHSG=$NA(^TMP("MDHSP",$J)) D SET^MDPS2
"RTN","MDPS1",85,0)
 D EN1(.MDHSG,DFN,MDTS1,MDTS2,MDLIM,"ABNORMAL")
"RTN","MDPS1",86,0)
 I '$D(^TMP("MDHSP",$J)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"No Procedure Data for the patient." Q
"RTN","MDPS1",87,0)
 S MDHR=0 F  S MDHR=$O(^TMP("MDHSP",$J,MDHR)) Q:MDHR<1  S MDX1=$G(^(MDHR)) D
"RTN","MDPS1",88,0)
 .D HSHDR^MDPS2
"RTN","MDPS1",89,0)
 .S MCARGDA=+$P(MDX1,U,2),MCARPPS=$P(MDX1,U,3,4),MCPRO=$P(MDX1,U,11)
"RTN","MDPS1",90,0)
 .S MCARGRTN=$P(MDX1,U,5),MDT="RD",MDHDR=1
"RTN","MDPS1",91,0)
 .D @MCARPPS Q
"RTN","MDPS1",92,0)
 K ^TMP("MDHSP",$J),MCARGRTN,MCPRO,MCARPPS
"RTN","MDPS1",93,0)
 Q
"RTN","MDPS1",94,0)
CPB ; Brief Report - Health Summary Component
"RTN","MDPS1",95,0)
 N MDHR,MDHSG,MDLIM,MDTS1,MDTS2,MDX1
"RTN","MDPS1",96,0)
 Q:'$G(DFN)  Q:'$G(GMTS1)  Q:'$G(GMTS2)
"RTN","MDPS1",97,0)
 K ^TMP("MDHSP",$J)
"RTN","MDPS1",98,0)
 S MDHSG=$NA(^TMP("MDHSP",$J)) D SET^MDPS2
"RTN","MDPS1",99,0)
 D EN1(.MDHSG,DFN,MDTS1,MDTS2,MDLIM)
"RTN","MDPS1",100,0)
 I '$D(^TMP("MDHSP",$J)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"No Procedure Data for the patient." Q
"RTN","MDPS1",101,0)
 D HDR^MDPS2
"RTN","MDPS1",102,0)
 S MDHR=0 F  S MDHR=$O(^TMP("MDHSP",$J,MDHR)) Q:MDHR<1  S MDX1=$G(^(MDHR)) D
"RTN","MDPS1",103,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","MDPS1",104,0)
 .W !,$S(+$P(MDX1,U,13):$J($P(MDX1,U,13),9),1:""),?12,$E($P(MDX1,U,1),1,30),?44,$P(MDX1,U,6),?67,$P(MDX1,U,7)
"RTN","MDPS1",105,0)
 .Q
"RTN","MDPS1",106,0)
 K ^TMP("MDHSP",$J)
"RTN","MDPS1",107,0)
 Q
"RTN","MDPS1",108,0)
CPC ; Full Caption Report - Health Summary Component
"RTN","MDPS1",109,0)
 S MDT1="CD"
"RTN","MDPS1",110,0)
CPF ; Full Report - Health Summary Component
"RTN","MDPS1",111,0)
 N MDHR,MDHSG,MDHDR,MDHFLG,MDLIM,MDT,MDTS1,MDTS2,MDX1
"RTN","MDPS1",112,0)
 Q:'$G(DFN)  Q:'$G(GMTS1)  Q:'$G(GMTS2)
"RTN","MDPS1",113,0)
 K ^TMP("MDHSP",$J) S MDHFLG=1
"RTN","MDPS1",114,0)
 S MDHSG=$NA(^TMP("MDHSP",$J)) D SET^MDPS2
"RTN","MDPS1",115,0)
 D EN1(.MDHSG,DFN,MDTS1,MDTS2,MDLIM)
"RTN","MDPS1",116,0)
 I '$D(^TMP("MDHSP",$J)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"No Procedure Data for the patient." Q
"RTN","MDPS1",117,0)
 S MDHR=0 F  S MDHR=$O(^TMP("MDHSP",$J,MDHR)) Q:MDHR<1  S MDX1=$G(^(MDHR)) D
"RTN","MDPS1",118,0)
 .D HSHDR^MDPS2
"RTN","MDPS1",119,0)
 .S MCARGDA=+$P(MDX1,U,2),MCPRO=$P(MDX1,U,11),MCARPPS=$P(MDX1,U,3,4)
"RTN","MDPS1",120,0)
 .S MCARGRTN=$P(MDX1,U,5),MDT=$S($G(MDT1)="":"RD",1:"CD"),MDHDR=1
"RTN","MDPS1",121,0)
 .D @MCARPPS Q
"RTN","MDPS1",122,0)
 K ^TMP("MDHSP",$J),MCARGDA,MCARGRTN,MCPRO,MCARPPS,MDT1
"RTN","MDPS1",123,0)
 Q
"RTN","MDPS1",124,0)
CPS ; One Line Summary Report
"RTN","MDPS1",125,0)
 N MDHR,MDHSG,MDLIM,MDTS1,MDTS2,MDX1
"RTN","MDPS1",126,0)
 Q:'$G(DFN)  Q:'$G(GMTS1)  Q:'$G(GMTS2)
"RTN","MDPS1",127,0)
 K ^TMP("MDHSP",$J)
"RTN","MDPS1",128,0)
 S MDHSG=$NA(^TMP("MDHSP",$J)) D SET^MDPS2
"RTN","MDPS1",129,0)
 D EN1(.MDHSG,DFN,MDTS1,MDTS2,MDLIM)
"RTN","MDPS1",130,0)
 I '$D(^TMP("MDHSP",$J)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"No Procedure Data for the patient." Q
"RTN","MDPS1",131,0)
 S MDHR=0 F  S MDHR=$O(^TMP("MDHSP",$J,MDHR)) Q:MDHR<1  S MDX1=$G(^(MDHR)) D
"RTN","MDPS1",132,0)
 .D HSHDR^MDPS2
"RTN","MDPS1",133,0)
 K ^TMP("MDHSP",$J)
"RTN","MDPS1",134,0)
 Q
"RTN","MDPS1",135,0)
PR702 ; Return the Result Text for File 702 records
"RTN","MDPS1",136,0)
 Q:'$G(MCARGDA)
"RTN","MDPS1",137,0)
 N FFF,MDCLIN,MDCON,MDIMG,MDMCG,MDMED,MDREC,MDPTR,MDSTUDY,MDTIU,MDX4,PATID,MDRPG,RESULTS
"RTN","MDPS1",138,0)
 I '$G(MDALL) K ^TMP("MDPTXT",$J)
"RTN","MDPS1",139,0)
 S MDIMG=0,$P(FFF,"-",80)="",MDRPG=0
"RTN","MDPS1",140,0)
 S MDSTUDY=+$G(MCARGDA)
"RTN","MDPS1",141,0)
 S MDTIU=$$GET1^DIQ(702,MDSTUDY_",",.06,"I")
"RTN","MDPS1",142,0)
 S MDCON=$$GET1^DIQ(702,MDSTUDY_",",.05,"I")
"RTN","MDPS1",143,0)
 Q:'MDTIU
"RTN","MDPS1",144,0)
 I +$P($G(^MDD(702,MDSTUDY,.1,0)),U,4)>0 S MDIMG=1
"RTN","MDPS1",145,0)
 S RESULTS="",MDCLIN=0
"RTN","MDPS1",146,0)
 I 'MDCON D TGET^TIUSRVR1(.RESULTS,+MDTIU) M ^TMP("MDPTXT",$J,MCARGDA,MCPRO)=@RESULTS K ^TMP("TIUVIEW",$J) Q:+$G(MDALL)  D NXT Q
"RTN","MDPS1",147,0)
 I MDCON D  Q:+$G(MDMED)
"RTN","MDPS1",148,0)
 .S MDG=$NA(^TMP("MDPTXT",$J,MCARGDA,MCPRO))
"RTN","MDPS1",149,0)
 .S MDMED=$$CHKMED(MDCON)
"RTN","MDPS1",150,0)
 .I MDMED D GETARY(.MDG,MDCON) Q:+$G(MDALL)  Q:+$G(MDRDV)  D NXT Q
"RTN","MDPS1",151,0)
 .K ^TMP("MDGMRC",$J) S RESULTS=$NA(^TMP("MDGMRC",$J))
"RTN","MDPS1",152,0)
 .D RT^GMRCGUIA(MDCON,.RESULTS)
"RTN","MDPS1",153,0)
 .D SETLINE(.MDG,.RESULTS)
"RTN","MDPS1",154,0)
NXT Q:+$G(MDALL)  Q:+$G(MDRDV)
"RTN","MDPS1",155,0)
 I $D(ORHFS) U IO G PRINT
"RTN","MDPS1",156,0)
 G PRINT
"RTN","MDPS1",157,0)
PR690 ; Return the Result text for File 690 Medicine report record
"RTN","MDPS1",158,0)
 Q:'$G(MCARGDA)
"RTN","MDPS1",159,0)
 N MDSTUDY,RESULTS,MDTMP,PATID
"RTN","MDPS1",160,0)
 I '$G(MDALL) K ^TMP("MDPTXT",$J)
"RTN","MDPS1",161,0)
 S MDSTUDY=+$G(MCARGDA)
"RTN","MDPS1",162,0)
 S MDG=$NA(^TMP("MDPTXT",$J,MCARGDA,MCPRO))
"RTN","MDPS1",163,0)
 S MDTMP="",MDTMP=+$O(^MCAR(697.2,"B",MCPRO,MDTMP))
"RTN","MDPS1",164,0)
 S MDTMP=$G(^MCAR(697.2,+MDTMP,0)) Q:MDTMP=""
"RTN","MDPS1",165,0)
 S MDF=$P(MDTMP,U,2),MDF=$P(MDF,"(",2),MDR=+MCARGDA,MDPR=MCPRO,PATID=DFN S:$G(MDT)="" MDT="RD"
"RTN","MDPS1",166,0)
 D GETDATA^MDPS2(.MDG,DFN,MDPR,MDF,MDR,MDT,$S(+$G(MDHDR):MDHDR,1:0))
"RTN","MDPS1",167,0)
 Q:+$G(MDALL)  Q:+$G(MDRDV)
"RTN","MDPS1",168,0)
 I $D(ORHFS) U IO G PRINT
"RTN","MDPS1",169,0)
PRINT ; Print the text for Display
"RTN","MDPS1",170,0)
 N MDRE S MDREC=$NA(^TMP("MDPTXT",$J)),MDRPG=1,MDRE=+$P(MDREC,",",2)
"RTN","MDPS1",171,0)
 W:'$G(MDHFLG) @IOF,!!
"RTN","MDPS1",172,0)
 F  S MDREC=$Q(@MDREC) Q:MDREC=""  Q:$QS(MDREC,1)'="MDPTXT"  D
"RTN","MDPS1",173,0)
 .Q:$QS(MDREC,2)'=MDRE
"RTN","MDPS1",174,0)
 .I +$G(MDHFLG) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","MDPS1",175,0)
 .I '$G(MDHFLG)&($Y>(IOSL-3)) W @IOF D HDR^MDPS3
"RTN","MDPS1",176,0)
 .W !,$G(@MDREC)
"RTN","MDPS1",177,0)
 .Q
"RTN","MDPS1",178,0)
 I +$G(MDIMG) D
"RTN","MDPS1",179,0)
 .I +$G(MDHFLG) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","MDPS1",180,0)
 .W ! I +$G(MDHFLG) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","MDPS1",181,0)
 .W !,"NOTE: Images are associated with this procedure."
"RTN","MDPS1",182,0)
 .I +$G(MDHFLG) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","MDPS1",183,0)
 .W !,"      Please use Imaging Display to view the images."
"RTN","MDPS1",184,0)
 .Q
"RTN","MDPS1",185,0)
 K MCPRO,MCARPPS,MCARGRTN,^TMP("MDPTXT",$J)
"RTN","MDPS1",186,0)
 Q
"RTN","MDPS1",187,0)
CHKMED(MDCON) ; Check for Medicine results
"RTN","MDPS1",188,0)
 N MDCK,MDCX,MDY
"RTN","MDPS1",189,0)
 S MDY=0 D GETS^DIQ(123,MDCON_",","50*","I","MDCX")
"RTN","MDPS1",190,0)
 S MDCK="" F  S MDCK=$O(MDCX(123.03,MDCK)) Q:MDCK<1  S MDX4=$G(MDCX(123.03,MDCK,.01,"I")) D
"RTN","MDPS1",191,0)
 .I MDX4["MCAR" S MDY=1
"RTN","MDPS1",192,0)
 Q MDY
"RTN","MDPS1",193,0)
GETARY(MDG,MDCON) ; Get the Medicine Result
"RTN","MDPS1",194,0)
 N MDCK,MDCX,MDX4,MDGL
"RTN","MDPS1",195,0)
 K ^TMP("MDREST",$J) S MDGL=$NA(^TMP("MDREST",$J))
"RTN","MDPS1",196,0)
 D GETS^DIQ(123,MDCON_",","50*","I","MDCX")
"RTN","MDPS1",197,0)
 S MDCK="" F  S MDCK=$O(MDCX(123.03,MDCK)) Q:MDCK<1  S MDX4=$G(MDCX(123.03,MDCK,.01,"I")) D
"RTN","MDPS1",198,0)
 .I MDX4["MCAR" D  Q
"RTN","MDPS1",199,0)
 ..S MDR=+MDX4,MDF=+$P(MDX4,"(",2),PATID=DFN S:$G(MDT)="" MDT="RD"
"RTN","MDPS1",200,0)
 ..Q:MDX4=""  S MCPRO=$$PRO^MDPS3(MDX4),MDPR=MCPRO
"RTN","MDPS1",201,0)
 ..D GETDATA^MDPS2(.MDGL,DFN,MDPR,MDF,MDR,MDT,$S(+$G(MDHDR):1,1:0))
"RTN","MDPS1",202,0)
 ..D SETLINE(.MDG,.MDGL) K ^TMP("MDREST",$J)
"RTN","MDPS1",203,0)
 ..Q
"RTN","MDPS1",204,0)
 .I MDX4["TIU" D  Q
"RTN","MDPS1",205,0)
 ..S RESULTS="" D TGET^TIUSRVR1(.RESULTS,+MDX4)
"RTN","MDPS1",206,0)
 ..D SETLINE(.MDG,.RESULTS) K ^TMP("TIUVIEW",$J)
"RTN","MDPS1",207,0)
 ..S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)=FFF
"RTN","MDPS1",208,0)
 ..Q
"RTN","MDPS1",209,0)
 Q
"RTN","MDPS1",210,0)
SETLINE(MDG,MDGL) ; Set Global Lines
"RTN","MDPS1",211,0)
 N MDCK1,MDX3,MDSC,MDNAME,MDTITL
"RTN","MDPS1",212,0)
 I $G(MCPRO)'="" S MDNAME=$O(^MCAR(697.2,"B",MCPRO,0)) D
"RTN","MDPS1",213,0)
 .I MDNAME S MDTITL=$P($G(^MCAR(697.2,+MDNAME,0)),"^",8)
"RTN","MDPS1",214,0)
 .I $G(MDTITL)="" S MDNAME=$O(^MDS(702.01,"B",MCPRO,0)) S:MDNAME MDTITL=$P($G(^MDS(702.01,+MDNAME,0)),U)
"RTN","MDPS1",215,0)
 S MDCK1=MDGL,MDSC=$QS(MDCK1,1),MDRPG=MDRPG+1
"RTN","MDPS1",216,0)
 I '$G(MDHDR) D
"RTN","MDPS1",217,0)
 .Q:MDSC="MDREST"
"RTN","MDPS1",218,0)
 .S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)="Pg. "_MDRPG_$J(" ",25)_$$HOSP^MDPS2(DFN)
"RTN","MDPS1",219,0)
 .I $G(MDTITL)'="" S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)=$J(" ",25)_MDTITL
"RTN","MDPS1",220,0)
 .S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)=$$DEMO^MDPS2(DFN)
"RTN","MDPS1",221,0)
 .S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)=FFF
"RTN","MDPS1",222,0)
 F  S MDCK1=$Q(@MDCK1) Q:MDCK1=""  Q:$QS(MDCK1,1)'=MDSC  Q:$QS(MDGL,2)'=$QS(MDCK1,2)  S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)=$G(@MDCK1)
"RTN","MDPS1",223,0)
 Q
"VER")
8.0^22
**END**
**END**
