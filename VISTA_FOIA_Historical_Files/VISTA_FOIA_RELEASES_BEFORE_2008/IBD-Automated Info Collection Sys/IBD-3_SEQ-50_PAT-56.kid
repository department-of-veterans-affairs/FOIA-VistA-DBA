Released IBD*3*56 SEQ #50
Extracted from mail message
**KIDS**:IBD*3.0*56^

**INSTALL NAME**
IBD*3.0*56
"BLD",5270,0)
IBD*3.0*56^AUTOMATED INFO COLLECTION SYS^0^3031203^y
"BLD",5270,4,0)
^9.64PA^^
"BLD",5270,"KRN",0)
^9.67PA^8989.52^19
"BLD",5270,"KRN",.4,0)
.4
"BLD",5270,"KRN",.401,0)
.401
"BLD",5270,"KRN",.402,0)
.402
"BLD",5270,"KRN",.403,0)
.403
"BLD",5270,"KRN",.5,0)
.5
"BLD",5270,"KRN",.84,0)
.84
"BLD",5270,"KRN",3.6,0)
3.6
"BLD",5270,"KRN",3.8,0)
3.8
"BLD",5270,"KRN",9.2,0)
9.2
"BLD",5270,"KRN",9.8,0)
9.8
"BLD",5270,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5270,"KRN",9.8,"NM",1,0)
IBDF4^^0^B73953175
"BLD",5270,"KRN",9.8,"NM","B","IBDF4",1)

"BLD",5270,"KRN",19,0)
19
"BLD",5270,"KRN",19.1,0)
19.1
"BLD",5270,"KRN",101,0)
101
"BLD",5270,"KRN",409.61,0)
409.61
"BLD",5270,"KRN",771,0)
771
"BLD",5270,"KRN",870,0)
870
"BLD",5270,"KRN",8989.51,0)
8989.51
"BLD",5270,"KRN",8989.52,0)
8989.52
"BLD",5270,"KRN",8994,0)
8994
"BLD",5270,"KRN","B",.4,.4)

"BLD",5270,"KRN","B",.401,.401)

"BLD",5270,"KRN","B",.402,.402)

"BLD",5270,"KRN","B",.403,.403)

"BLD",5270,"KRN","B",.5,.5)

"BLD",5270,"KRN","B",.84,.84)

"BLD",5270,"KRN","B",3.6,3.6)

"BLD",5270,"KRN","B",3.8,3.8)

"BLD",5270,"KRN","B",9.2,9.2)

"BLD",5270,"KRN","B",9.8,9.8)

"BLD",5270,"KRN","B",19,19)

"BLD",5270,"KRN","B",19.1,19.1)

"BLD",5270,"KRN","B",101,101)

"BLD",5270,"KRN","B",409.61,409.61)

"BLD",5270,"KRN","B",771,771)

"BLD",5270,"KRN","B",870,870)

"BLD",5270,"KRN","B",8989.51,8989.51)

"BLD",5270,"KRN","B",8989.52,8989.52)

"BLD",5270,"KRN","B",8994,8994)

"BLD",5270,"QUES",0)
^9.62^^
"BLD",5270,"REQB",0)
^9.611^1^1
"BLD",5270,"REQB",1,0)
IBD*3.0*38^2
"BLD",5270,"REQB","B","IBD*3.0*38",1)

"MBREQ")
0
"PKG",421,-1)
1^1
"PKG",421,0)
AUTOMATED INFO COLLECTION SYS^IBD^The utilities for generating a paper encounter form.
"PKG",421,20,0)
^9.402P^^
"PKG",421,22,0)
^9.49I^1^1
"PKG",421,22,1,0)
3.0^2970212^2970424^1258
"PKG",421,22,1,"PAH",1,0)
56^3031203
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IBDF4")
0^1^B73953175
"RTN","IBDF4",1,0)
IBDF4 ;ALB/CJM - ENCOUNTER FORM - BUILD FORM(editing group's selections) ;NOV 16,1992
"RTN","IBDF4",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**19,38,56**;APR 24, 1997
"RTN","IBDF4",3,0)
 ;
"RTN","IBDF4",4,0)
SLCTNS ;
"RTN","IBDF4",5,0)
 N IBRTN
"RTN","IBDF4",6,0)
 Q:IBLIST'=$P($G(^IBE(357.4,IBGRP,0)),"^",3)
"RTN","IBDF4",7,0)
 S IBRTN=IBLIST("RTN")
"RTN","IBDF4",8,0)
 D RTNDSCR^IBDFU1B(.IBRTN)
"RTN","IBDF4",9,0)
 D KILL^IBDFUA
"RTN","IBDF4",10,0)
 D EN^VALM("IBDF EDIT GROUP'S SELECTIONS") ;call the list manager
"RTN","IBDF4",11,0)
 Q
"RTN","IBDF4",12,0)
ONENTRY ;entry code for list manager
"RTN","IBDF4",13,0)
 D IDXSLCTN
"RTN","IBDF4",14,0)
 Q
"RTN","IBDF4",15,0)
ONEXIT ;exit code for the list manager
"RTN","IBDF4",16,0)
 K @VALMAR
"RTN","IBDF4",17,0)
 Q
"RTN","IBDF4",18,0)
 ;
"RTN","IBDF4",19,0)
IDXSLCTN ;build an array of selections in print order for the list processor
"RTN","IBDF4",20,0)
 N SLCTN,ODR,NODE
"RTN","IBDF4",21,0)
 K @VALMAR
"RTN","IBDF4",22,0)
 S ODR="",VALMCNT=0
"RTN","IBDF4",23,0)
 F  S ODR=$O(^IBE(357.3,"APO",IBLIST,IBGRP,ODR)) Q:ODR=""  D
"RTN","IBDF4",24,0)
 .S SLCTN="" F  S SLCTN=$O(^IBE(357.3,"APO",IBLIST,IBGRP,ODR,SLCTN)) Q:'SLCTN  D
"RTN","IBDF4",25,0)
 ..;check for messed up index and take appropriate action
"RTN","IBDF4",26,0)
 ..S NODE=$G(^IBE(357.3,SLCTN,0))
"RTN","IBDF4",27,0)
 ..I ($P(NODE,"^",3)'=IBLIST)!($P(NODE,"^",4)'=IBGRP) D  Q
"RTN","IBDF4",28,0)
 ...K ^IBE(357.3,"APO",IBLIST,IBGRP,ODR,SLCTN)
"RTN","IBDF4",29,0)
 ...I $P(NODE,"^",3)'=IBLIST,$P(NODE,"^",4)=IBGRP D  Q
"RTN","IBDF4",30,0)
 ....K DIK,DA S DIK="^IBE(357.3,",DA=SLCTN D ^DIK K DIK,DA
"RTN","IBDF4",31,0)
 ...I $P(NODE,"^",3)=IBLIST,$P($G(^IBE(357.4,+IBGRP,0)),"^",3)'=IBLIST D  Q
"RTN","IBDF4",32,0)
 ....K DIK,DA S DIK="^IBE(357.3,",DA=SLCTN D ^DIK K DIK,DA
"RTN","IBDF4",33,0)
 ...K DIK,DA S DIK="^IBE(357.3,",DA=SLCTN D IX^DIK K DIK,DA
"RTN","IBDF4",34,0)
 ..;
"RTN","IBDF4",35,0)
 ..S VALMCNT=VALMCNT+1
"RTN","IBDF4",36,0)
 ..S @VALMAR@(VALMCNT,0)=$$DISPLAY(SLCTN,VALMCNT),@VALMAR@("IDX",VALMCNT,VALMCNT)=SLCTN
"RTN","IBDF4",37,0)
 ..D FLDCTRL^VALM10(VALMCNT,"ID") ;set video for ID column
"RTN","IBDF4",38,0)
 Q
"RTN","IBDF4",39,0)
LMGRPHDR ;header for the screen
"RTN","IBDF4",40,0)
 S VALMHDR(1)="SELECTIONS CURRENTLY DEFINED FOR '"_$$GRPNAME_"' PRINT GROUP"
"RTN","IBDF4",41,0)
 Q
"RTN","IBDF4",42,0)
 ;
"RTN","IBDF4",43,0)
GRPNAME() ;the name of the selection group
"RTN","IBDF4",44,0)
 Q $P($G(^IBE(357.4,IBGRP,0)),"^",1)
"RTN","IBDF4",45,0)
 ;
"RTN","IBDF4",46,0)
DISPLAY(SLCTN,COUNT) ;returns a line to display to the list containing a selection - SLCTN is a ptr to the selectin, COUNT is the number of the selection on the list
"RTN","IBDF4",47,0)
 N SC,SCDA,VAL,RET,W,NODE,ORDER
"RTN","IBDF4",48,0)
 ;W - an array cotaining the widths of the subcolumns that contain text
"RTN","IBDF4",49,0)
 S VAL=""
"RTN","IBDF4",50,0)
 S RET=$$PADRIGHT^IBDFU(COUNT,4)
"RTN","IBDF4",51,0)
 S NODE=$G(^IBE(357.3,SLCTN,0))
"RTN","IBDF4",52,0)
 S ORDER=$P(NODE,"^",5),RET=RET_$J(ORDER,6,2)
"RTN","IBDF4",53,0)
 I $P(NODE,"^",2) S RET=RET_$S($P(NODE,"^",7):" SH",1:" PH")_"| "_$P(NODE,"^",6)
"RTN","IBDF4",54,0)
 I '$P(NODE,"^",2) S RET=RET_"  ",SC="" F SC=1:1:8 S SCDA=$O(^IBE(357.3,SLCTN,1,"B",SC,"")) D
"RTN","IBDF4",55,0)
 .I $G(IBLIST("SCTYPE",SC))=1 S W(SC)=IBLIST("SCW",SC)*(1+IBLIST("BTWN"))
"RTN","IBDF4",56,0)
 .S:$G(W(SC)) VAL=$$PADRIGHT^IBDFU($S(SCDA:$P($G(^IBE(357.3,SLCTN,1,SCDA,0)),"^",2),1:""),W(SC))
"RTN","IBDF4",57,0)
 .S:VAL'="" RET=RET_" | "_VAL
"RTN","IBDF4",58,0)
 .S VAL=""
"RTN","IBDF4",59,0)
 I $D(^IBE(357.3,SLCTN,2)) S RET=RET_"  ",SC="" F SC=1:1:2 S SCDA=$P(^IBE(357.3,SLCTN,2),"^",SC) S:SC=2 SCDA=$S($D(^LEX)>1:$P($G(^LEX(757.01,+SCDA,0)),"^"),1:$P($G(^GMP(757.01,+SCDA,0)),"^")) D
"RTN","IBDF4",60,0)
 .S W(SC)=25
"RTN","IBDF4",61,0)
 .S VAL=$$PADRIGHT^IBDFU($S(SCDA]"":SCDA,1:""),W(SC))
"RTN","IBDF4",62,0)
 .S:VAL'="" RET=RET_" | "_VAL
"RTN","IBDF4",63,0)
 .S VAL=""
"RTN","IBDF4",64,0)
 Q RET
"RTN","IBDF4",65,0)
ADDSLCTN ;allows the user to add a selection to the selection group
"RTN","IBDF4",66,0)
 N QUIT,SUB
"RTN","IBDF4",67,0)
 ;
"RTN","IBDF4",68,0)
 S VALMBCK="R"
"RTN","IBDF4",69,0)
 D FULL^VALM1
"RTN","IBDF4",70,0)
 I IBRTN("ACTION")'=3 D NOGOOD G ADDEXIT
"RTN","IBDF4",71,0)
 K @IBRTN("DATA_LOCATION")
"RTN","IBDF4",72,0)
 S QUIT=0 F  D  Q:QUIT  W !!!,"Now for another SELECTION LIST entry!"
"RTN","IBDF4",73,0)
 .I '$$DORTN^IBDFU1B(.IBRTN) S QUIT=1 D NOGOOD Q
"RTN","IBDF4",74,0)
 .I '$D(@IBRTN("DATA_LOCATION")) S QUIT=1 Q
"RTN","IBDF4",75,0)
 .D ADDREC(.QUIT) ;edits and adds the selection
"RTN","IBDF4",76,0)
 .K @IBRTN("DATA_LOCATION")
"RTN","IBDF4",77,0)
ADDEXIT ;
"RTN","IBDF4",78,0)
 D IDXSLCTN
"RTN","IBDF4",79,0)
 Q
"RTN","IBDF4",80,0)
ADDREC(QUIT,ORDER,SLCTN) ;allows the user to number the selection, edit the editable subcolumns, then adds the record - sets QUIT=1 if user quits
"RTN","IBDF4",81,0)
 N SUB,COUNT,NODE,VAL,DLAYGO,QTY,DTOUT,DUOUT,DIRUT
"RTN","IBDF4",82,0)
 I $P($G(^IBE(357.6,$P($G(^IBE(357.2,+IBLIST,0)),"^",11),16)),"^",8) S DIR(0)="NO",DIR("A")="Quantity",DIR("B")=1,DIR("?")="Enter the number of occurrences" D ^DIR K DIR S:$D(DTOUT)!$D(DUOUT) QUIT=1 Q:QUIT  S QTY=$G(Y)
"RTN","IBDF4",83,0)
 I '$G(ORDER) D  Q:QUIT
"RTN","IBDF4",84,0)
 .K DIR S DIR(0)="357.3,.05",DIR("B")=$$NEXT^IBDF4A(IBLIST,IBGRP) D ^DIR K DIR I $D(DIRUT) S QUIT=1 Q
"RTN","IBDF4",85,0)
 .S ORDER=+Y
"RTN","IBDF4",86,0)
 S VAL=$G(@IBRTN("DATA_LOCATION"))
"RTN","IBDF4",87,0)
 Q:QUIT
"RTN","IBDF4",88,0)
 ;we have all the data needed to add the selection - so add it
"RTN","IBDF4",89,0)
 S NODE=$S($P(VAL,"^")'="":$P(VAL,"^"),1:ORDER)_"^^"_IBLIST_"^"_IBGRP_"^"_ORDER_$S($G(QTY):"^^^^"_QTY,1:"")
"RTN","IBDF4",90,0)
 K DIC,DD,DO,DINUM S DIC="^IBE(357.3,",X=$P(NODE,"^",1),DIC(0)="FL",DLAYGO=357.3
"RTN","IBDF4",91,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDF4",92,0)
 S SLCTN=$S(+Y<0:"",1:+Y)
"RTN","IBDF4",93,0)
 I 'SLCTN W !,"Unable to create a new selection record!" D PAUSE^VALM1 S QUIT=1 Q
"RTN","IBDF4",94,0)
 S ^IBE(357.3,SLCTN,0)=NODE
"RTN","IBDF4",95,0)
 ;--- move codes and add modifiers
"RTN","IBDF4",96,0)
 D CODES^IBDF4A,ADD^IBDF4C
"RTN","IBDF4",97,0)
 ;---move the subcolum set up
"RTN","IBDF4",98,0)
 F SUB=1:1:8 D  Q:QUIT
"RTN","IBDF4",99,0)
 .I $G(IBLIST("SCTYPE",SUB))=1 I IBLIST("SCPIECE",SUB),IBLIST("SCW",SUB) D
"RTN","IBDF4",100,0)
 ..S NODE=$$DATANODE^IBDFU1B(IBRTN,IBLIST("SCPIECE",SUB))
"RTN","IBDF4",101,0)
 ..I NODE]"" S VAL(SUB)=$P($G(@IBRTN("DATA_LOCATION")@(NODE)),"^",IBLIST("SCPIECE",SUB))
"RTN","IBDF4",102,0)
 ..E  S VAL(SUB)=$P(VAL,"^",IBLIST("SCPIECE",SUB))
"RTN","IBDF4",103,0)
 ..Q:('IBLIST("SCEDITABLE",SUB))!((IBRTN("WIDTH",1))&(IBLIST("SCPIECE",SUB)=1))
"RTN","IBDF4",104,0)
 ..W !!,"Subcolumn Header: "_IBLIST("SCHDR",SUB) K DIR S DIR(0)="FO^0:"_(IBLIST("SCW",SUB)*(1+IBLIST("BTWN"))),DIR("A")="Edit Subcolumn "_SUB,DIR("B")=VAL(SUB)_$S($G(QTY)>1:" x "_QTY,1:"")
"RTN","IBDF4",105,0)
 ..I $P($G(^IBE(357.3,SLCTN,3,0)),"^",4)>0 D
"RTN","IBDF4",106,0)
 ...S:DIR("B")'["w/ mod" DIR("B")=DIR("B")_"w/ mod"
"RTN","IBDF4",107,0)
 ..D ^DIR K DIR S:$D(DTOUT)!$D(DUOUT) QUIT=1 Q:QUIT  S VAL(SUB)=Y I IBLIST("SCPIECE",SUB)=1,X="" S QUIT=1
"RTN","IBDF4",108,0)
 ;
"RTN","IBDF4",109,0)
 ;add the subcolumn value multiple
"RTN","IBDF4",110,0)
 S COUNT=0 F SUB=1:1:8 I $G(VAL(SUB))'="" S COUNT=COUNT+1,^IBE(357.3,SLCTN,1,COUNT,0)=SUB_"^"_VAL(SUB)
"RTN","IBDF4",111,0)
 S ^IBE(357.3,SLCTN,1,0)="^357.31IA^"_COUNT_"^"_COUNT
"RTN","IBDF4",112,0)
 K DA S DA=SLCTN,DIK="^IBE(357.3," D IX^DIK K DIK,DA
"RTN","IBDF4",113,0)
 D NARR,TERM
"RTN","IBDF4",114,0)
 Q
"RTN","IBDF4",115,0)
 ;
"RTN","IBDF4",116,0)
NARR ; -- edit provider narrative, but only for selections where the
"RTN","IBDF4",117,0)
 ;    interface allows editing
"RTN","IBDF4",118,0)
 N DIE,DA,DR
"RTN","IBDF4",119,0)
 I $P($G(^IBE(357.6,+$P($G(^IBE(357.2,+IBLIST,0)),U,11),0)),U,17) D
"RTN","IBDF4",120,0)
 .S DIE="^IBE(357.3,",DA=SLCTN,DR=2.01 D ^DIE K DIE,DA,DR
"RTN","IBDF4",121,0)
 Q
"RTN","IBDF4",122,0)
 ;
"RTN","IBDF4",123,0)
TERM ; -- map selection to clinical lexicon, but only for selections where
"RTN","IBDF4",124,0)
 ;    the package interface allows editing
"RTN","IBDF4",125,0)
 N DIE,DA,DR,GMPTUN,GMPTSUB,GMPTSHOW,XTLKGLB,XTLKHLP,XTLKKSCH,XTLKSAY,IBDLEX
"RTN","IBDF4",126,0)
 I $P($G(^IBE(357.6,+$P($G(^IBE(357.2,+IBLIST,0)),U,11),0)),U,18) D
"RTN","IBDF4",127,0)
 .I $D(^LEX)>1 S X="LEXSET" X ^%ZOSF("TEST") I $T D CONFIG^LEXSET("GMPL","PL1") S IBDLEX=1
"RTN","IBDF4",128,0)
 .I '$D(IBDLEX) S X="GMPTSET" X ^%ZOSF("TEST") I $T D CONFIG^GMPTSET("GMPL","PL1") S IBDLEX=1
"RTN","IBDF4",129,0)
 .;D CONFIG^GMPTSET("ICD","ICD") (this is an alternate filter)
"RTN","IBDF4",130,0)
 .Q:'$D(IBDLEX)
"RTN","IBDF4",131,0)
 .S DIE="^IBE(357.3,",DA=SLCTN,DR="2.02//"_$P($G(^IBE(357.3,DA,0)),"^") D ^DIE
"RTN","IBDF4",132,0)
 K DIC
"RTN","IBDF4",133,0)
 Q
"RTN","IBDF4",134,0)
 ;
"RTN","IBDF4",135,0)
CODES ; -- allow selection of a second code to pass through for this entry
"RTN","IBDF4",136,0)
 ; -- only as if pi allows input of more than one code
"RTN","IBDF4",137,0)
 ;N PI S PI=+$P($G(^IBE(357.2,+IBLIST,0)),U,11)
"RTN","IBDF4",138,0)
 ;Q:'$P($G(^IBE(357.6,PI,16)),U,9)
"RTN","IBDF4",139,0)
 ;N IBI,QUIT,IBVAL S QUIT=0
"RTN","IBDF4",140,0)
 ;F IBI=1,2 D  Q:QUIT
"RTN","IBDF4",141,0)
 ;.W !,"****Select a ",$S(IBI=1:"second",1:"third")," code to pass along with original."
"RTN","IBDF4",142,0)
 ;.I '$$DORTN^IBDFU1B(.IBRTN) S QUIT=1 Q
"RTN","IBDF4",143,0)
 ;.I +Y'>0 S QUIT=1 Q
"RTN","IBDF4",144,0)
 ;.X $G(^IBE(357.6,PI,9)) S IBVAL=X
"RTN","IBDF4",145,0)
 ;.S DIE="^IBE(357.3,",DA=SLCTN,DR=$S(IBI=1:"2.03",1:"2.04")_"////^S X=IBVAL" D ^DIE K DIE,DA,DR
"RTN","IBDF4",146,0)
 ;Q
"RTN","IBDF4",147,0)
 ;
"RTN","IBDF4",148,0)
NOGOOD ;
"RTN","IBDF4",149,0)
 W !,"The package interface routine for selection is not properly defined" D PAUSE^VALM1
"RTN","IBDF4",150,0)
 Q
"RTN","IBDF4",151,0)
 ;
"RTN","IBDF4",152,0)
SEQUENCE ;allows the user to resequence all of the selections on the list
"RTN","IBDF4",153,0)
 ;
"RTN","IBDF4",154,0)
 N SUBCOL,CNT,P,SORT,GROUP,NODE,VALUE,ITEM,IEN,HDR,DTOUT,DUOUT,DIRUT,SORT1
"RTN","IBDF4",155,0)
 S VALMBCK="R"
"RTN","IBDF4",156,0)
 D FULL^VALM1
"RTN","IBDF4",157,0)
 ;
"RTN","IBDF4",158,0)
 ;sort by which subcolumn?
"RTN","IBDF4",159,0)
 K DIR S DIR("A")="Which subcolumn do you want to sort by?",DIR("?")=" "
"RTN","IBDF4",160,0)
 S SUBCOL=0 F  S SUBCOL=$O(IBLIST("SCTYPE",SUBCOL)) Q:'SUBCOL  I IBLIST("SCTYPE",SUBCOL)=1 S SUBCOL(SUBCOL)=""
"RTN","IBDF4",161,0)
 S (CNT,SUBCOL)=0,DIR(0)="SOX^"
"RTN","IBDF4",162,0)
 F CNT=1:1 S SUBCOL=$O(SUBCOL(SUBCOL)) Q:'SUBCOL  D
"RTN","IBDF4",163,0)
 .S P=IBLIST("SCPIECE",SUBCOL),P=$S(P=1:1,P=2:3,P=3:5,P=4:7,P=5:9,P=6:11,P=7:13,1:0),HDR=$P($G(^IBE(357.6,+IBLIST("RTN"),2)),"^",P),DIR("?",CNT)=SUBCOL_" = "_HDR
"RTN","IBDF4",164,0)
 .S HDR=$S($G(IBLIST("SCHDR",SUBCOL))="":HDR,1:IBLIST("SCHDR",SUBCOL))
"RTN","IBDF4",165,0)
 .S DIR(0)=DIR(0)_SUBCOL_":"_HDR_";"
"RTN","IBDF4",166,0)
 D ^DIR
"RTN","IBDF4",167,0)
 Q:$D(DIRUT)!(Y=-1)
"RTN","IBDF4",168,0)
 K SUBCOL S SUBCOL=+Y
"RTN","IBDF4",169,0)
 ;
"RTN","IBDF4",170,0)
 ;sort aphabetically or numerically?
"RTN","IBDF4",171,0)
 K DIR
"RTN","IBDF4",172,0)
 S DIR("A")="How should the list be sorted?",DIR(0)="SO^1:ALPHABETICALLY;2:NUMERICALLY;",DIR("B")="ALPHABETICALLY"
"RTN","IBDF4",173,0)
 D ^DIR
"RTN","IBDF4",174,0)
 Q:$D(DIRUT)!(Y=-1)
"RTN","IBDF4",175,0)
 S SORT=Y
"RTN","IBDF4",176,0)
 ;  -- Resequence by group or group and placeholders
"RTN","IBDF4",177,0)
 K DIR
"RTN","IBDF4",178,0)
 S DIR("A")="Resequence by Group or Group and Place Holders?",DIR(0)="SO^1:GROUP/PLACE HOLDERS;2:GROUP;",DIR("B")="GROUP/PLACE HOLDERS"
"RTN","IBDF4",179,0)
 D ^DIR
"RTN","IBDF4",180,0)
 Q:$D(DIRUT)!(Y=-1)
"RTN","IBDF4",181,0)
 S SORT1=Y
"RTN","IBDF4",182,0)
 ;
"RTN","IBDF4",183,0)
 ;sort
"RTN","IBDF4",184,0)
 I SORT1=2 D EN^IBDF4A Q
"RTN","IBDF4",185,0)
 N CNTR,GROUP1,IBGROUP,IBORDER
"RTN","IBDF4",186,0)
 K ^TMP("IBDF",$J)
"RTN","IBDF4",187,0)
 S (GROUP,GROUP1,CNTR,IBGROUP)=0
"RTN","IBDF4",188,0)
 ;  -- Resequence only specific groups in block.
"RTN","IBDF4",189,0)
 I $D(IBGRUP) F  S IBGROUP=$O(IBGRUP(IBGROUP)) Q:'IBGROUP  D RESEQ
"RTN","IBDF4",190,0)
 I $D(IBGRUP) D ORDER Q
"RTN","IBDF4",191,0)
 ;  -- Resequence all groups of the block.
"RTN","IBDF4",192,0)
 I '$D(IBGRUP) F  S IBGROUP=$O(^IBE(357.3,"APO",IBLIST,IBGROUP)) Q:'IBGROUP  D RESEQ
"RTN","IBDF4",193,0)
 I '$D(IBGRUP) D ORDER Q
"RTN","IBDF4",194,0)
 Q
"RTN","IBDF4",195,0)
RESEQ S IBORDER=0 F  S IBORDER=$O(^IBE(357.3,"APO",IBLIST,IBGROUP,IBORDER)) Q:'IBORDER  S ITEM=0 F  S ITEM=$O(^IBE(357.3,"APO",IBLIST,IBGROUP,IBORDER,ITEM)) Q:'ITEM  D
"RTN","IBDF4",196,0)
 .S NODE=$G(^IBE(357.3,ITEM,0))
"RTN","IBDF4",197,0)
 .I ($P(NODE,"^",3)'=IBLIST) Q
"RTN","IBDF4",198,0)
 .S GROUP1=GROUP,GROUP=+$P(NODE,"^",4)
"RTN","IBDF4",199,0)
 .Q:$P($G(^IBE(357.4,GROUP,0)),"^",3)'=IBLIST
"RTN","IBDF4",200,0)
 .I $P(NODE,"^",2)=1 D  Q
"RTN","IBDF4",201,0)
 ..S CNTR=CNTR+1
"RTN","IBDF4",202,0)
 ..S VALUE=$S(SORT=1:" ",1:+$P(NODE,"^",1))
"RTN","IBDF4",203,0)
 ..S ^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,CNTR,VALUE,ITEM)=""
"RTN","IBDF4",204,0)
 .S IEN=$O(^IBE(357.3,ITEM,1,"B",SUBCOL,0)) Q:'IEN
"RTN","IBDF4",205,0)
 .S VALUE=$P($G(^IBE(357.3,ITEM,1,IEN,0)),"^",2)
"RTN","IBDF4",206,0)
 .S VALUE=$S(SORT=1:VALUE=" "_VALUE,1:+$P(NODE,"^",1))
"RTN","IBDF4",207,0)
 .I GROUP'=GROUP1 S CNTR=CNTR+1
"RTN","IBDF4",208,0)
 .S ^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,CNTR,$E(VALUE,1,40),ITEM)=""
"RTN","IBDF4",209,0)
 ;set the order
"RTN","IBDF4",210,0)
ORDER S GROUP=0,CNTR=0
"RTN","IBDF4",211,0)
 F  S GROUP=$O(^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP)) Q:'GROUP  D
"RTN","IBDF4",212,0)
 .S VALUE="",CNT=0
"RTN","IBDF4",213,0)
 .F  S CNTR=$O(^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,CNTR)) Q:'CNTR  F  S VALUE=$O(^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,CNTR,VALUE)) Q:VALUE=""  D
"RTN","IBDF4",214,0)
 ..S ITEM=0 F  S ITEM=$O(^TMP("IBDF",$J,"RESEQUENCE LIST",GROUP,CNTR,VALUE,ITEM)) Q:'ITEM  D
"RTN","IBDF4",215,0)
 ...S CNT=CNT+1
"RTN","IBDF4",216,0)
 ...K DIE,DA,DR S DIE="^IBE(357.3,",DR=".05///"_CNT,DA=ITEM D ^DIE K DIE,DA,DR
"RTN","IBDF4",217,0)
 ;
"RTN","IBDF4",218,0)
 K Y,X,DIR,^TMP("IBDF",$J,"RESEQUENCE LIST")
"RTN","IBDF4",219,0)
 D IDXGRP^IBDF3
"RTN","IBDF4",220,0)
 Q
"VER")
8.0^22
**END**
**END**
