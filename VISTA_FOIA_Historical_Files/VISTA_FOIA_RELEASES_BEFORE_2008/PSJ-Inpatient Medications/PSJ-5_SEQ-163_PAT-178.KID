Released PSJ*5*178 SEQ #163
Extracted from mail message
**KIDS**:PSJ*5.0*178^

**INSTALL NAME**
PSJ*5.0*178
"BLD",5706,0)
PSJ*5.0*178^INPATIENT MEDICATIONS^0^3070201^y
"BLD",5706,1,0)
^^52^52^3070201^
"BLD",5706,1,1,0)
A site reported a problem with the fact that medication route did not
"BLD",5706,1,2,0)
appear on the IV label. This patch corrects this problem by adding the
"BLD",5706,1,3,0)
medication route to the IV label. PSI-05-107, HD115653
"BLD",5706,1,4,0)
 
"BLD",5706,1,5,0)
****Important Note****
"BLD",5706,1,6,0)
The decision of the workgroup was that the medication route should appear
"BLD",5706,1,7,0)
in a larger font than the remaining text. If you do not define the
"BLD",5706,1,8,0)
following correctly, the medication route will not be in a larger font.
"BLD",5706,1,9,0)
In order to allow this functionality, four new control codes must be set
"BLD",5706,1,10,0)
up. They are:
"BLD",5706,1,11,0)
 
"BLD",5706,1,12,0)
SM          Start Med Route
"BLD",5706,1,13,0)
EM          End Med Route
"BLD",5706,1,14,0)
SMF         Start Med Route field
"BLD",5706,1,15,0)
EMF         End Med Route field
"BLD",5706,1,16,0)
 
"BLD",5706,1,17,0)
These control codes are defined by using FileMan V. 22.0 and editing the
"BLD",5706,1,18,0)
CONTROL CODES multiple (#3.2055) of the TERMINAL TYPE file (#3.2).
"BLD",5706,1,19,0)
 
"BLD",5706,1,20,0)
Each printer can have different values required in order to properly
"BLD",5706,1,21,0)
print the route. Please note that it may be necessary to adjust the 
"BLD",5706,1,22,0)
label length through the SITE PARAMETERS (IV) option in order for the 
"BLD",5706,1,23,0)
label to print correctly.
"BLD",5706,1,24,0)
 
"BLD",5706,1,25,0)
The following is one example of the setup for a Zebra 105SL printer.
"BLD",5706,1,26,0)
 
"BLD",5706,1,27,0)
 
"BLD",5706,1,28,0)
NUMBER: 12                              CTRL CODE ABBREVIATION: SM
"BLD",5706,1,29,0)
  FULL NAME: START MED ROUTE
"BLD",5706,1,30,0)
  CONTROL CODE: W "^FO",PSJBARX,",",PSJBARY,"^A0N,36,30",!!
"BLD",5706,1,31,0)
NUMBER: 13                              CTRL CODE ABBREVIATION: EM
"BLD",5706,1,32,0)
  FULL NAME: END MED ROUTE              CONTROL CODE: S PSJBARY=PSJBARY+40
"BLD",5706,1,33,0)
NUMBER: 14                              CTRL CODE ABBREVIATION: SMF
"BLD",5706,1,34,0)
  FULL NAME: START MED ROUTE FIELD      CONTROL CODE: W "^FD"
"BLD",5706,1,35,0)
NUMBER: 15                              CTRL CODE ABBREVIATION: EMF
"BLD",5706,1,36,0)
  FULL NAME: END MED ROUTE FIELD        CONTROL CODE: W "^FS",!
"BLD",5706,1,37,0)
 
"BLD",5706,1,38,0)
The resulting Bar Code IV Label Example, which includes Medication Route
"BLD",5706,1,39,0)
is shown:
"BLD",5706,1,40,0)
 
"BLD",5706,1,41,0)
       *520V452*
"BLD",5706,1,42,0)
[65] 9111  ONE EAST 03/19/02
"BLD",5706,1,43,0)
PSJPATIENT1,ONE  B-12
"BLD",5706,1,44,0)
 
"BLD",5706,1,45,0)
ACETAMINOPHEN 100 MEQ
"BLD",5706,1,46,0)
0.9% SODIUM CHLORIDE 100 ML
"BLD",5706,1,47,0)
 
"BLD",5706,1,48,0)
Dose due at: ________
"BLD",5706,1,49,0)
ROUTE: INTRAVENOUS
"BLD",5706,1,50,0)
100 ml/hr
"BLD",5706,1,51,0)
Fld by: ____  Chkd by: ____
"BLD",5706,1,52,0)
1[1]
"BLD",5706,4,0)
^9.64PA^^
"BLD",5706,6)
6^
"BLD",5706,6.3)
9
"BLD",5706,"KRN",0)
^9.67PA^8989.52^19
"BLD",5706,"KRN",.4,0)
.4
"BLD",5706,"KRN",.401,0)
.401
"BLD",5706,"KRN",.402,0)
.402
"BLD",5706,"KRN",.403,0)
.403
"BLD",5706,"KRN",.5,0)
.5
"BLD",5706,"KRN",.84,0)
.84
"BLD",5706,"KRN",3.6,0)
3.6
"BLD",5706,"KRN",3.8,0)
3.8
"BLD",5706,"KRN",9.2,0)
9.2
"BLD",5706,"KRN",9.8,0)
9.8
"BLD",5706,"KRN",9.8,"NM",0)
^9.68A^8^6
"BLD",5706,"KRN",9.8,"NM",2,0)
PSIVHYPL^^0^B41785116
"BLD",5706,"KRN",9.8,"NM",3,0)
PSIVHYPR^^0^B39015292
"BLD",5706,"KRN",9.8,"NM",4,0)
PSIVLABL^^0^B36555447
"BLD",5706,"KRN",9.8,"NM",5,0)
PSIVLABR^^0^B33354776
"BLD",5706,"KRN",9.8,"NM",7,0)
PSIVALN^^0^B7728612
"BLD",5706,"KRN",9.8,"NM",8,0)
PSIVALNC^^0^B7788915
"BLD",5706,"KRN",9.8,"NM","B","PSIVALN",7)

"BLD",5706,"KRN",9.8,"NM","B","PSIVALNC",8)

"BLD",5706,"KRN",9.8,"NM","B","PSIVHYPL",2)

"BLD",5706,"KRN",9.8,"NM","B","PSIVHYPR",3)

"BLD",5706,"KRN",9.8,"NM","B","PSIVLABL",4)

"BLD",5706,"KRN",9.8,"NM","B","PSIVLABR",5)

"BLD",5706,"KRN",19,0)
19
"BLD",5706,"KRN",19,"NM",0)
^9.68A^^
"BLD",5706,"KRN",19.1,0)
19.1
"BLD",5706,"KRN",101,0)
101
"BLD",5706,"KRN",409.61,0)
409.61
"BLD",5706,"KRN",771,0)
771
"BLD",5706,"KRN",870,0)
870
"BLD",5706,"KRN",8989.51,0)
8989.51
"BLD",5706,"KRN",8989.52,0)
8989.52
"BLD",5706,"KRN",8994,0)
8994
"BLD",5706,"KRN","B",.4,.4)

"BLD",5706,"KRN","B",.401,.401)

"BLD",5706,"KRN","B",.402,.402)

"BLD",5706,"KRN","B",.403,.403)

"BLD",5706,"KRN","B",.5,.5)

"BLD",5706,"KRN","B",.84,.84)

"BLD",5706,"KRN","B",3.6,3.6)

"BLD",5706,"KRN","B",3.8,3.8)

"BLD",5706,"KRN","B",9.2,9.2)

"BLD",5706,"KRN","B",9.8,9.8)

"BLD",5706,"KRN","B",19,19)

"BLD",5706,"KRN","B",19.1,19.1)

"BLD",5706,"KRN","B",101,101)

"BLD",5706,"KRN","B",409.61,409.61)

"BLD",5706,"KRN","B",771,771)

"BLD",5706,"KRN","B",870,870)

"BLD",5706,"KRN","B",8989.51,8989.51)

"BLD",5706,"KRN","B",8989.52,8989.52)

"BLD",5706,"KRN","B",8994,8994)

"BLD",5706,"QUES",0)
^9.62^^
"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
178^3070201^10000000010
"PKG",197,22,1,"PAH",1,1,0)
^^52^52^3070201
"PKG",197,22,1,"PAH",1,1,1,0)
A site reported a problem with the fact that medication route did not
"PKG",197,22,1,"PAH",1,1,2,0)
appear on the IV label. This patch corrects this problem by adding the
"PKG",197,22,1,"PAH",1,1,3,0)
medication route to the IV label. PSI-05-107, HD115653
"PKG",197,22,1,"PAH",1,1,4,0)
 
"PKG",197,22,1,"PAH",1,1,5,0)
****Important Note****
"PKG",197,22,1,"PAH",1,1,6,0)
The decision of the workgroup was that the medication route should appear
"PKG",197,22,1,"PAH",1,1,7,0)
in a larger font than the remaining text. If you do not define the
"PKG",197,22,1,"PAH",1,1,8,0)
following correctly, the medication route will not be in a larger font.
"PKG",197,22,1,"PAH",1,1,9,0)
In order to allow this functionality, four new control codes must be set
"PKG",197,22,1,"PAH",1,1,10,0)
up. They are:
"PKG",197,22,1,"PAH",1,1,11,0)
 
"PKG",197,22,1,"PAH",1,1,12,0)
SM          Start Med Route
"PKG",197,22,1,"PAH",1,1,13,0)
EM          End Med Route
"PKG",197,22,1,"PAH",1,1,14,0)
SMF         Start Med Route field
"PKG",197,22,1,"PAH",1,1,15,0)
EMF         End Med Route field
"PKG",197,22,1,"PAH",1,1,16,0)
 
"PKG",197,22,1,"PAH",1,1,17,0)
These control codes are defined by using FileMan V. 22.0 and editing the
"PKG",197,22,1,"PAH",1,1,18,0)
CONTROL CODES multiple (#3.2055) of the TERMINAL TYPE file (#3.2).
"PKG",197,22,1,"PAH",1,1,19,0)
 
"PKG",197,22,1,"PAH",1,1,20,0)
Each printer can have different values required in order to properly
"PKG",197,22,1,"PAH",1,1,21,0)
print the route. Please note that it may be necessary to adjust the 
"PKG",197,22,1,"PAH",1,1,22,0)
label length through the SITE PARAMETERS (IV) option in order for the 
"PKG",197,22,1,"PAH",1,1,23,0)
label to print correctly.
"PKG",197,22,1,"PAH",1,1,24,0)
 
"PKG",197,22,1,"PAH",1,1,25,0)
The following is one example of the setup for a Zebra 105SL printer.
"PKG",197,22,1,"PAH",1,1,26,0)
 
"PKG",197,22,1,"PAH",1,1,27,0)
 
"PKG",197,22,1,"PAH",1,1,28,0)
NUMBER: 12                              CTRL CODE ABBREVIATION: SM
"PKG",197,22,1,"PAH",1,1,29,0)
  FULL NAME: START MED ROUTE
"PKG",197,22,1,"PAH",1,1,30,0)
  CONTROL CODE: W "^FO",PSJBARX,",",PSJBARY,"^A0N,36,30",!!
"PKG",197,22,1,"PAH",1,1,31,0)
NUMBER: 13                              CTRL CODE ABBREVIATION: EM
"PKG",197,22,1,"PAH",1,1,32,0)
  FULL NAME: END MED ROUTE              CONTROL CODE: S PSJBARY=PSJBARY+40
"PKG",197,22,1,"PAH",1,1,33,0)
NUMBER: 14                              CTRL CODE ABBREVIATION: SMF
"PKG",197,22,1,"PAH",1,1,34,0)
  FULL NAME: START MED ROUTE FIELD      CONTROL CODE: W "^FD"
"PKG",197,22,1,"PAH",1,1,35,0)
NUMBER: 15                              CTRL CODE ABBREVIATION: EMF
"PKG",197,22,1,"PAH",1,1,36,0)
  FULL NAME: END MED ROUTE FIELD        CONTROL CODE: W "^FS",!
"PKG",197,22,1,"PAH",1,1,37,0)
 
"PKG",197,22,1,"PAH",1,1,38,0)
The resulting Bar Code IV Label Example, which includes Medication Route
"PKG",197,22,1,"PAH",1,1,39,0)
is shown:
"PKG",197,22,1,"PAH",1,1,40,0)
 
"PKG",197,22,1,"PAH",1,1,41,0)
       *520V452*
"PKG",197,22,1,"PAH",1,1,42,0)
[65] 9111  ONE EAST 03/19/02
"PKG",197,22,1,"PAH",1,1,43,0)
PSJPATIENT1,ONE  B-12
"PKG",197,22,1,"PAH",1,1,44,0)
 
"PKG",197,22,1,"PAH",1,1,45,0)
ACETAMINOPHEN 100 MEQ
"PKG",197,22,1,"PAH",1,1,46,0)
0.9% SODIUM CHLORIDE 100 ML
"PKG",197,22,1,"PAH",1,1,47,0)
 
"PKG",197,22,1,"PAH",1,1,48,0)
Dose due at: ________
"PKG",197,22,1,"PAH",1,1,49,0)
ROUTE: INTRAVENOUS
"PKG",197,22,1,"PAH",1,1,50,0)
100 ml/hr
"PKG",197,22,1,"PAH",1,1,51,0)
Fld by: ____  Chkd by: ____
"PKG",197,22,1,"PAH",1,1,52,0)
1[1]
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PSIVALN")
0^7^B7728612^B7102021
"RTN","PSIVALN",1,0)
PSIVALN ;BIR/PR,CML3-LABEL ALIGNMENT ;16 DEC 97 / 1:39 PM 
"RTN","PSIVALN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,178**;16 DEC 97;Build 9
"RTN","PSIVALN",3,0)
 ;
"RTN","PSIVALN",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVALN",5,0)
 ;
"RTN","PSIVALN",6,0)
 W !!?2,"(Please make any initial adjustments before selecting the label device.)",!
"RTN","PSIVALN",7,0)
 K %ZIS,IO("Q"),IOP S %ZIS="Q",PSIVION=ION,%ZIS("A")="Print labels on DEVICE: ",%ZIS("B")=PSIVPL D ^%ZIS I POP S IOP=PSIVION D ^%ZIS W !?2,"No device selected." K PSIVION,IOP,%ZIS Q
"RTN","PSIVALN",8,0)
 N X0,PSJIO,I
"RTN","PSIVALN",9,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=^(I,0),PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVALN",10,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVALN",11,0)
 D PSET^%ZISP
"RTN","PSIVALN",12,0)
 S $P(L1,"_",$P(PSIVSITE,"^",13)+1)="" F Q=0:0 D PRNT,ASK Q:%'=2
"RTN","PSIVALN",13,0)
 ;
"RTN","PSIVALN",14,0)
 D ^%ZISC K %ZIS,IO("Q"),IOP,L1,L2,PSIVION,Q,QQ,X,%Y,POP,D,Y,Z,I,ZISI,Y Q
"RTN","PSIVALN",15,0)
 ;
"RTN","PSIVALN",16,0)
PRNT ;
"RTN","PSIVALN",17,0)
 G:'$D(IO("Q")) ENQ K ZTSK,ZTSAVE S ZTRTN="ENQ^PSIVALN",ZTDESC="IV LABEL ALIGNMENT",ZTIO=ION,ZTDTH=$H F G="L1","L2","PSIVSITE","PSJSYSW0","PSJSYSU","PSJIO" S ZTSAVE(G)=""
"RTN","PSIVALN",18,0)
 D ^%ZTLOAD Q
"RTN","PSIVALN",19,0)
 ;
"RTN","PSIVALN",20,0)
ENQ ;
"RTN","PSIVALN",21,0)
 U IO
"RTN","PSIVALN",22,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVALN",23,0)
 F QQ=1:1:3 D LP
"RTN","PSIVALN",24,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVALN",25,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSIVALN",26,0)
 Q
"RTN","PSIVALN",27,0)
 ;
"RTN","PSIVALN",28,0)
P F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALN",29,0)
 W X
"RTN","PSIVALN",30,0)
 F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALN",31,0)
 I 'PSJIO W !
"RTN","PSIVALN",32,0)
 Q
"RTN","PSIVALN",33,0)
 ;
"RTN","PSIVALN",34,0)
PMR F I="SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALN",35,0)
 W X
"RTN","PSIVALN",36,0)
 F I="EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALN",37,0)
 I 'PSJIO W !
"RTN","PSIVALN",38,0)
 Q
"RTN","PSIVALN",39,0)
LP ;
"RTN","PSIVALN",40,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVALN",41,0)
 S LINE=1
"RTN","PSIVALN",42,0)
 I 'PSJIO D
"RTN","PSIVALN",43,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVALN",44,0)
 . W "nnnVnnn"
"RTN","PSIVALN",45,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVALN",46,0)
 . W !
"RTN","PSIVALN",47,0)
 I PSJIO D
"RTN","PSIVALN",48,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALN",49,0)
 . W "nnnVnnn"
"RTN","PSIVALN",50,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALN",51,0)
 F LINE=LINE:1:PSIVSITE S X=L1 D P D PMR
"RTN","PSIVALN",52,0)
 I 'PSJIO D  Q
"RTN","PSIVALN",53,0)
 . F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVALN",54,0)
 I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVALN",55,0)
 Q
"RTN","PSIVALN",56,0)
 ;
"RTN","PSIVALN",57,0)
ASK ;
"RTN","PSIVALN",58,0)
 U IO(0) F Q=0:0 W !!,"Is the label alignment correct" S %=1 D YN^DICN Q:%  S HELP="ALGN" D ^PSIVHLP
"RTN","PSIVALN",59,0)
 I %=2 R !!,"Please make any adjustments necessary, and then press RETURN. ",X:DTIME W:'$T $C(7) I X="^"!'$T S %=-1
"RTN","PSIVALN",60,0)
 Q
"RTN","PSIVALNC")
0^8^B7788915^B7068177
"RTN","PSIVALNC",1,0)
PSIVALNC ;BIR/JLC - TEST CONTROL CODES ;16 DEC 97 / 1:39 PM 
"RTN","PSIVALNC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,178**;16 DEC 97;Build 9
"RTN","PSIVALNC",3,0)
 ;
"RTN","PSIVALNC",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVALNC",5,0)
 ;
"RTN","PSIVALNC",6,0)
 W !!?2,"(Please make any initial adjustments before selecting the label device.)",!
"RTN","PSIVALNC",7,0)
 K %ZIS,IO("Q"),IOP S %ZIS="Q",PSIVION=ION,%ZIS("A")="Print labels on DEVICE: ",%ZIS("B")=PSIVPL D ^%ZIS I POP S IOP=PSIVION D ^%ZIS W !?2,"No device selected." K PSIVION,IOP,%ZIS Q
"RTN","PSIVALNC",8,0)
 N X0,PSJIO,I
"RTN","PSIVALNC",9,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=^(I,0),PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVALNC",10,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVALNC",11,0)
 D PSET^%ZISP
"RTN","PSIVALNC",12,0)
 S $P(L1,"_",10)="" F  D PRNT,ASK Q:%'=2
"RTN","PSIVALNC",13,0)
 ;
"RTN","PSIVALNC",14,0)
 D ^%ZISC K %ZIS,IO("Q"),IOP,L1,L2,PSIVION,X,%Y,POP,D,Y,Z,I,ZISI,Y Q
"RTN","PSIVALNC",15,0)
 ;
"RTN","PSIVALNC",16,0)
PRNT ;
"RTN","PSIVALNC",17,0)
 G:'$D(IO("Q")) ENQ K ZTSK,ZTSAVE S ZTRTN="ENQ^PSIVALNC",ZTDESC="IV LABEL ALIGNMENT",ZTIO=ION,ZTDTH=$H F G="L1","L2","PSIVSITE","PSJSYSW0","PSJSYSU","PSJIO" S ZTSAVE(G)=""
"RTN","PSIVALNC",18,0)
 D ^%ZTLOAD Q
"RTN","PSIVALNC",19,0)
 ;
"RTN","PSIVALNC",20,0)
ENQ ;
"RTN","PSIVALNC",21,0)
 U IO
"RTN","PSIVALNC",22,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVALNC",23,0)
 D LP
"RTN","PSIVALNC",24,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVALNC",25,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSIVALNC",26,0)
 Q
"RTN","PSIVALNC",27,0)
 ;
"RTN","PSIVALNC",28,0)
P F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALNC",29,0)
 W X
"RTN","PSIVALNC",30,0)
 F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALNC",31,0)
 I 'PSJIO W !
"RTN","PSIVALNC",32,0)
 Q
"RTN","PSIVALNC",33,0)
 ;
"RTN","PSIVALNC",34,0)
PMR F I="SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALNC",35,0)
 W X
"RTN","PSIVALNC",36,0)
 F I="EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALNC",37,0)
 I 'PSJIO W !
"RTN","PSIVALNC",38,0)
 Q
"RTN","PSIVALNC",39,0)
LP ;
"RTN","PSIVALNC",40,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVALNC",41,0)
 S LINE=1
"RTN","PSIVALNC",42,0)
 I 'PSJIO D
"RTN","PSIVALNC",43,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVALNC",44,0)
 . W "nnnVnnn"
"RTN","PSIVALNC",45,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVALNC",46,0)
 . W !
"RTN","PSIVALNC",47,0)
 I PSJIO D
"RTN","PSIVALNC",48,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALNC",49,0)
 . W "nnnVnnn"
"RTN","PSIVALNC",50,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVALNC",51,0)
 S X=L1 D P D PMR
"RTN","PSIVALNC",52,0)
 I 'PSJIO D  Q
"RTN","PSIVALNC",53,0)
 . W !
"RTN","PSIVALNC",54,0)
 I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVALNC",55,0)
 Q
"RTN","PSIVALNC",56,0)
 ;
"RTN","PSIVALNC",57,0)
ASK ;
"RTN","PSIVALNC",58,0)
 U IO(0) F  W !!,"Is the label alignment correct" S %=1 D YN^DICN Q:%  S HELP="ALGN" D ^PSIVHLP
"RTN","PSIVALNC",59,0)
 I %=2 R !!,"Please make any adjustments necessary, and then press RETURN. ",X:DTIME W:'$T $C(7) I X="^"!'$T S %=-1
"RTN","PSIVALNC",60,0)
 Q
"RTN","PSIVALNC",61,0)
PGM ;;
"RTN","PSIVALNC",62,0)
 D ^PSIVXU Q:$D(XQUIT)  D ^PSIVALNC,ENIVKV^PSGSETU K I,Z,ZISI
"RTN","PSIVALNC",63,0)
 Q
"RTN","PSIVHYPL")
0^2^B41785116^B32678393
"RTN","PSIVHYPL",1,0)
PSIVHYPL ;BIR/PR-PRINT OUT LABELS ;26 FEB 97 / 3:20 PM
"RTN","PSIVHYPL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,96,128,178**;16 DEC 97;Build 9
"RTN","PSIVHYPL",3,0)
 ;
"RTN","PSIVHYPL",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVHYPL",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVHYPL",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVHYPL",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVHYPL",8,0)
 ; Reference to ^PS(50.4 is supported by DBIA 2175.
"RTN","PSIVHYPL",9,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVHYPL",10,0)
 ;
"RTN","PSIVHYPL",11,0)
 ;NEEDS DFN, ON AND PSIVNOL (Total number of labels to print) and
"RTN","PSIVHYPL",12,0)
 ;PSIVCT - $D(PSIVCT) NO COUNT LABEL
"RTN","PSIVHYPL",13,0)
SSWARD ;Get patient SS# and ward location
"RTN","PSIVHYPL",14,0)
 N X0,PSJIO,I
"RTN","PSIVHYPL",15,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=^(I,0),PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVHYPL",16,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVHYPL",17,0)
 D ENIV^PSJAC S VADM(2)=$E(VADM(2),6,9),PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),1:"Opt. IV")
"RTN","PSIVHYPL",18,0)
 G:PSIVNOL<1 Q D SETP,^PSIVHYP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVHYPL",19,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVHYPL",20,0)
 I $P(PSIVSITE,U,7) D
"RTN","PSIVHYPL",21,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVHYPL",22,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPL",23,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPL",24,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;QUIT IF "DOSE DUE AT" LINE IS SET TO NOT PRINT
"RTN","PSIVHYPL",25,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPL",26,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPL",27,0)
 . S X="Solution: _______________" D PRNTL S X="Additive: _______________" D PRNTL
"RTN","PSIVHYPL",28,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVHYPL",29,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPL",30,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVHYPL",31,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+PSIVNOL
"RTN","PSIVHYPL",32,0)
 K PSIVFLAG,PSIVSH
"RTN","PSIVHYPL",33,0)
START F PSIV1=1:1:PSIVNOL D
"RTN","PSIVHYPL",34,0)
 . S LINE=0 D RE
"RTN","PSIVHYPL",35,0)
 . Q:$D(PSIVFLAG) 
"RTN","PSIVHYPL",36,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPL",37,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVHYPL",38,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVHYPL",39,0)
 D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVHYPL",40,0)
Q K HYPL,LINE,MESS,P16,PDATE,PDOSE,PSIV,PSIVA,PSIV1,PSIV2,PSIVCT,PSIVDOSE,PSIVFLAG,PSIVRM,PSIVWD,TVOL,HYPLPRT Q
"RTN","PSIVHYPL",41,0)
RE I PSIV1 S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=1440/P(15)+.5\1
"RTN","PSIVHYPL",42,0)
 K DO
"RTN","PSIVHYPL",43,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVHYPL",44,0)
 I PSIV1 S PSJBCID=$$BCMA^PSIVBCID(DFN,ON,$D(PSIVCT),$G(PSIV1),$G(PSIV2),$G(PSIVNOL)) D BARCODE
"RTN","PSIVHYPL",45,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3) D PRNTL
"RTN","PSIVHYPL",46,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D PRNTL S X=" " D PRNTL
"RTN","PSIVHYPL",47,0)
 D:$P(PSIVSITE,U,12) TVOL
"RTN","PSIVHYPL",48,0)
 S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPL",49,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"*********")_"  "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVHYPL",50,0)
 . D PRNTL
"RTN","PSIVHYPL",51,0)
 . D MESS
"RTN","PSIVHYPL",52,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPL",53,0)
 . D SOL1,PRNTL
"RTN","PSIVHYPL",54,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPL",55,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVHYPL",56,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPL",57,0)
 . D SOL1,PRNTL I PSIV1 D UP3^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVHYPL",58,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPL",59,0)
 F I=0:0 S I=$O(HYPL(I)) Q:'I  S PSIV="" D
"RTN","PSIVHYPL",60,0)
 . F I=I:0 S PSIV=$O(HYPL(I,PSIV)) Q:PSIV=""  S Y="",X=0 D
"RTN","PSIVHYPL",61,0)
 .. X "F ZZ=0:0 S Y=$O(HYPL(I,PSIV,Y)) Q:Y=""""  I Y=""ALL""!(Y=""***"")!(Y[P(16)) S X=X+$P(HYPL(I,PSIV,Y),U),PSIVP=HYPL(I,PSIV,Y) D UPD"
"RTN","PSIVHYPL",62,0)
 .. I X D HYP
"RTN","PSIVHYPL",63,0)
 K HYPAD
"RTN","PSIVHYPL",64,0)
SOL S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPL",65,0)
 S X=" " D PRNTL I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVHYPL",66,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER^PSIVLABL S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D PRNTL
"RTN","PSIVHYPL",67,0)
 ;
"RTN","PSIVHYPL",68,0)
MEDRT ;Find Medication Route   
"RTN","PSIVHYPL",69,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPL",70,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPL",71,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPL",72,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPL",73,0)
 ;
"RTN","PSIVHYPL",74,0)
INF S X=$P(P(8),"@") D:X]"" PRNTL
"RTN","PSIVHYPL",75,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),U) D:X]"" PRNTL
"RTN","PSIVHYPL",76,0)
 S X=P(9) D:X]"" PRNTL
"RTN","PSIVHYPL",77,0)
 S X=P(11) D:X]"" PRNTL
"RTN","PSIVHYPL",78,0)
 I $D(MESS) S X=MESS D PRNTL
"RTN","PSIVHYPL",79,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D PRNTL
"RTN","PSIVHYPL",80,0)
 S X=PSIV1_"["_PSIVNOL_"]" D PRNTL
"RTN","PSIVHYPL",81,0)
 Q
"RTN","PSIVHYPL",82,0)
PRNTL N I F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPL",83,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPL",84,0)
 .. S LINE=1
"RTN","PSIVHYPL",85,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPL",86,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPL",87,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",88,0)
 . K ZZ
"RTN","PSIVHYPL",89,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",90,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPL",91,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",92,0)
 . I 'PSJIO W !
"RTN","PSIVHYPL",93,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPL",94,0)
 Q
"RTN","PSIVHYPL",95,0)
PMR ; Print Med Route on label
"RTN","PSIVHYPL",96,0)
 ;  
"RTN","PSIVHYPL",97,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPL",98,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPL",99,0)
 .. S LINE=1
"RTN","PSIVHYPL",100,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPL",101,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPL",102,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",103,0)
 . K ZZ
"RTN","PSIVHYPL",104,0)
 . ;
"RTN","PSIVHYPL",105,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",106,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPL",107,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",108,0)
 . I 'PSJIO W !
"RTN","PSIVHYPL",109,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPL",110,0)
 Q
"RTN","PSIVHYPL",111,0)
TVOL ;
"RTN","PSIVHYPL",112,0)
 S PSIV=TVOL F X=0:0 S X=$O(^PS(55,DFN,"IV",+ON,"AD",X)) Q:'X  S X=X_"^"_^(X,0) S:$P(X,U,4)[P(16)!($P(X,U,4)="")!'PSIV1 PSIV=PSIV+$S($P(^PS(52.6,$P(X,U,2),0),U,10):$P(X,U,3)/$P(^(0),U,10),1:0)
"RTN","PSIVHYPL",113,0)
 S X="Total Volume: "_(PSIV+.5\1) D PRNTL
"RTN","PSIVHYPL",114,0)
 Q
"RTN","PSIVHYPL",115,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),U)_" "_$P(^PS(55,DFN,"IV",+ON,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVHYPL",116,0)
HYP ;
"RTN","PSIVHYPL",117,0)
 I PSIV="*" S X="*** Error in "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive") D PRNTL Q
"RTN","PSIVHYPL",118,0)
 S PSIVA=$S(I=50.4:PSIV,I=52.7:+$G(^PS(55,DFN,"IV",+ON,"SOL",PSIV,0)),1:+$G(^PS(55,DFN,"IV",+ON,"AD",PSIV,0)))
"RTN","PSIVHYPL",119,0)
 S X=$S($D(^PS(I,PSIVA,0)):$P(^(0),U),1:"Undefined "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive"))_" "_$S(X<1:"0"_(X+.005\.01/100),1:(X+.005\.01/100))_" "_$P($P(HYPL(I,PSIV,$O(HYPL(I,PSIV,""))),U)," ",2)
"RTN","PSIVHYPL",120,0)
 D PRNTL
"RTN","PSIVHYPL",121,0)
 Q
"RTN","PSIVHYPL",122,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVHYPL",123,0)
 Q
"RTN","PSIVHYPL",124,0)
MESS I '$D(MESS) I $P(^PS(52.6,+Y,0),U,9)]"" S MESS=$P(^(0),U,9)
"RTN","PSIVHYPL",125,0)
 Q
"RTN","PSIVHYPL",126,0)
UPD N X,Y,PSIVEL,PSIVAD
"RTN","PSIVHYPL",127,0)
 S PSIVEL=$P(PSIVP,"^",2)
"RTN","PSIVHYPL",128,0)
 I I=50.4 F PSIVAD=0:0 S PSIVAD=$O(HYPLRPT(PSIVEL,"AD",PSIVAD)) Q:'PSIVAD  D
"RTN","PSIVHYPL",129,0)
 .I $D(HYPAD(+PSIVAD)) Q
"RTN","PSIVHYPL",130,0)
 .S YY=$G(^PS(55,DFN,"IV",+ON,"AD",+PSIVAD,0))
"RTN","PSIVHYPL",131,0)
 .S HYPAD(+PSIVAD)=""
"RTN","PSIVHYPL",132,0)
 .I +$P(YY,U,3),(+$P(YY,U,3)'=P(16)) Q
"RTN","PSIVHYPL",133,0)
 .D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVHYPL",134,0)
 I I'=50.4 S YY=$G(^PS(55,DFN,"IV",+ON,"AD",+PSIV,0)) D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVHYPL",135,0)
 Q
"RTN","PSIVHYPL",136,0)
BARCODE D PSET^%ZISP
"RTN","PSIVHYPL",137,0)
 I 'PSJIO D
"RTN","PSIVHYPL",138,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVHYPL",139,0)
 . W PSJBCID
"RTN","PSIVHYPL",140,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVHYPL",141,0)
 . W !
"RTN","PSIVHYPL",142,0)
 I PSJIO D
"RTN","PSIVHYPL",143,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",144,0)
 . W PSJBCID
"RTN","PSIVHYPL",145,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPL",146,0)
 Q
"RTN","PSIVHYPR")
0^3^B39015292^B30525743
"RTN","PSIVHYPR",1,0)
PSIVHYPR ;BIR/PR-REPRINT LABELS ;26 FEB 97 / 3:20 PM
"RTN","PSIVHYPR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,88,96,178**;16 DEC 97;Build 9
"RTN","PSIVHYPR",3,0)
 ;
"RTN","PSIVHYPR",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVHYPR",5,0)
 ; Reference to ^PS(50.4 is supported by DBIA 2175.
"RTN","PSIVHYPR",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVHYPR",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVHYPR",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVHYPR",9,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVHYPR",10,0)
 ;
"RTN","PSIVHYPR",11,0)
 ;NEEDS DFN, ON AND PSIVNOL (Total number of labels to print) and
"RTN","PSIVHYPR",12,0)
 ;PSIVCT - $D(PSIVCT) NO COUNT LABEL
"RTN","PSIVHYPR",13,0)
SSWARD ;Get patient SS# and ward location
"RTN","PSIVHYPR",14,0)
 N X0,PSJIO,I
"RTN","PSIVHYPR",15,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=^(I,0),PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVHYPR",16,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVHYPR",17,0)
 D ENIV^PSJAC S VADM(2)=$E(VADM(2),6,9),PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),1:"Opt. IV")
"RTN","PSIVHYPR",18,0)
 ;;NEW PSIVNOL,PSIV1 S (PSIVNOL,PSIV1)=1
"RTN","PSIVHYPR",19,0)
 NEW PSIV1 S PSIV1=1
"RTN","PSIVHYPR",20,0)
 G:PSIVNOL<1 Q D SETP,PSIVHYP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVHYPR",21,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVHYPR",22,0)
 ;PSJRPHD is defined in REPRT^PSIVLBRP
"RTN","PSIVHYPR",23,0)
 I $P(PSIVSITE,U,7),'$D(PSJRPHD) D
"RTN","PSIVHYPR",24,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVHYPR",25,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPR",26,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPR",27,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;QUIT IF "DOSE DUE AT" IS SET TO NOT PRINT
"RTN","PSIVHYPR",28,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPR",29,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPR",30,0)
 . S X="Solution: _______________" D PRNTL S X="Additive: _______________" D PRNTL
"RTN","PSIVHYPR",31,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVHYPR",32,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPR",33,0)
 . I PSJIO F I="EL","FE" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",34,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+1
"RTN","PSIVHYPR",35,0)
 K PSIVFLAG,PSIVSH
"RTN","PSIVHYPR",36,0)
START S PSIV1=1,LINE=0 D RE D
"RTN","PSIVHYPR",37,0)
 . Q:$D(PSIVFLAG) 
"RTN","PSIVHYPR",38,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVHYPR",39,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVHYPR",40,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVHYPR",41,0)
 ;;D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVHYPR",42,0)
 I '$D(PSIVCT) D ^PSIVSTAT S P(16)=P(16)+PSIVNOL
"RTN","PSIVHYPR",43,0)
Q K HYPL,LINE,MESS,P16,PDATE,PDOSE,PSIV,PSIVA,PSIV1,PSIV2,PSIVCT,PSIVDOSE,PSIVFLAG,PSIVRM,PSIVWD,TVOL Q
"RTN","PSIVHYPR",44,0)
RE ;I PSIV1 S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=1440/P(15)+.5\1
"RTN","PSIVHYPR",45,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVHYPR",46,0)
 I PSIV1 D BARCODE
"RTN","PSIVHYPR",47,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3) D PRNTL
"RTN","PSIVHYPR",48,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D PRNTL S X=" " D PRNTL
"RTN","PSIVHYPR",49,0)
 D:$P(PSIVSITE,U,12) TVOL
"RTN","PSIVHYPR",50,0)
 S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPR",51,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"*********")_" "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVHYPR",52,0)
 . D PRNTL,MESS
"RTN","PSIVHYPR",53,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPR",54,0)
 . D SOL1,PRNTL
"RTN","PSIVHYPR",55,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPR",56,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVHYPR",57,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVHYPR",58,0)
 . D SOL1,PRNTL
"RTN","PSIVHYPR",59,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D PRNTL
"RTN","PSIVHYPR",60,0)
 F I=0:0 S I=$O(HYPL(I)) Q:'I  S PSIV="" F I=I:0 S PSIV=$O(HYPL(I,PSIV)) Q:PSIV=""  D
"RTN","PSIVHYPR",61,0)
 . F Z="" S Z=$O(HYPL(I,PSIV,Z)) Q:Z=""  S PSIVA=$S(I=50.4:PSIV,I=52.7:+^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",+$P(HYPL(I,PSIV,Z),U,2),0),1:+^PS(55,DFN,"IVBCMA",PSJIDNO,"AD",+$P(HYPL(I,PSIV,Z),U,2),0)) D HYP
"RTN","PSIVHYPR",62,0)
SOL S X="",$P(X,"=",PSIVRM-1)="" D PRNTL
"RTN","PSIVHYPR",63,0)
 S X=" " D PRNTL I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVHYPR",64,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER^PSIVLABL S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D PRNTL
"RTN","PSIVHYPR",65,0)
 ;
"RTN","PSIVHYPR",66,0)
MEDRT ;Find Medication Route   
"RTN","PSIVHYPR",67,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVHYPR",68,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVHYPR",69,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVHYPR",70,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVHYPR",71,0)
 ;
"RTN","PSIVHYPR",72,0)
INF S X=$P(P(8),"@") D:X]"" PRNTL
"RTN","PSIVHYPR",73,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),U) D:X]"" PRNTL
"RTN","PSIVHYPR",74,0)
 S X=P(9) D:X]"" PRNTL
"RTN","PSIVHYPR",75,0)
 S X=P(11) D:X]"" PRNTL
"RTN","PSIVHYPR",76,0)
 I $D(MESS) S X=MESS D PRNTL
"RTN","PSIVHYPR",77,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D PRNTL
"RTN","PSIVHYPR",78,0)
 S X=$S('+$G(PSIV1):"0[0]",1:PSIVBAG) D PRNTL
"RTN","PSIVHYPR",79,0)
 Q
"RTN","PSIVHYPR",80,0)
PRNTL N I F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPR",81,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPR",82,0)
 .. S LINE=1
"RTN","PSIVHYPR",83,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPR",84,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPR",85,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",86,0)
 . K ZZ
"RTN","PSIVHYPR",87,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",88,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPR",89,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",90,0)
 . I 'PSJIO W !
"RTN","PSIVHYPR",91,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPR",92,0)
 Q
"RTN","PSIVHYPR",93,0)
PMR ; Print Med Route on label
"RTN","PSIVHYPR",94,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVHYPR",95,0)
 . I LINE>PSIVSITE D
"RTN","PSIVHYPR",96,0)
 .. S LINE=1
"RTN","PSIVHYPR",97,0)
 .. I 'PSJIO D  Q
"RTN","PSIVHYPR",98,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVHYPR",99,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",100,0)
 . K ZZ
"RTN","PSIVHYPR",101,0)
 . ;
"RTN","PSIVHYPR",102,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",103,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVHYPR",104,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",105,0)
 . I 'PSJIO W !
"RTN","PSIVHYPR",106,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVHYPR",107,0)
 Q 
"RTN","PSIVHYPR",108,0)
 ;
"RTN","PSIVHYPR",109,0)
TVOL ;
"RTN","PSIVHYPR",110,0)
 S PSIV=TVOL F X=0:0 S X=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"AD",X)) Q:'X  S X=X_"^"_^(X,0) S:$P(X,U,4)[P(16)!($P(X,U,4)="")!'PSIV1 PSIV=PSIV+$S($P(^PS(52.6,$P(X,U,2),0),U,10):$P(X,U,3)/$P(^(0),U,10),1:0)
"RTN","PSIVHYPR",111,0)
 S X="Total Volume: "_(PSIV+.5\1) D PRNTL
"RTN","PSIVHYPR",112,0)
 Q
"RTN","PSIVHYPR",113,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),U)_" "_$P(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVHYPR",114,0)
HYP ;
"RTN","PSIVHYPR",115,0)
 I PSIV="*" S X="*** Error in "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive") D PRNTL Q
"RTN","PSIVHYPR",116,0)
 S X=+HYPL(I,PSIV,Z)
"RTN","PSIVHYPR",117,0)
 S X=$S($D(^PS(I,PSIVA,0)):$P(^(0),U),1:"Undefined "_$S(I=50.4:"electrolyte",I=52.7:"solution",1:"additive"))_" "_(X+.005\.01/100)_" "_$P($P(HYPL(I,PSIV,Z),U)," ",2)
"RTN","PSIVHYPR",118,0)
 D PRNTL
"RTN","PSIVHYPR",119,0)
 Q
"RTN","PSIVHYPR",120,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVHYPR",121,0)
 Q
"RTN","PSIVHYPR",122,0)
MESS I '$D(MESS) I $P(^PS(52.6,+Y,0),U,9)]"" S MESS=$P(^(0),U,9)
"RTN","PSIVHYPR",123,0)
 Q
"RTN","PSIVHYPR",124,0)
BARCODE D PSET^%ZISP
"RTN","PSIVHYPR",125,0)
 I 'PSJIO D
"RTN","PSIVHYPR",126,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVHYPR",127,0)
 . W PSJBCID
"RTN","PSIVHYPR",128,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVHYPR",129,0)
 . W !
"RTN","PSIVHYPR",130,0)
 I PSJIO D
"RTN","PSIVHYPR",131,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",132,0)
 . W PSJBCID
"RTN","PSIVHYPR",133,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVHYPR",134,0)
 Q
"RTN","PSIVHYPR",135,0)
PSIVHYP ;
"RTN","PSIVHYPR",136,0)
 K HYPL S TVOL=0 F Z=52.6,52.7 F DRG=0:0 S DRG=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,$S(Z=52.6:"AD",1:"SOL"),DRG)) Q:'DRG  S DRG=DRG_"^"_^(DRG,0) S $P(DRG,"^",4)="ALL" D DRG^PSIVHYP
"RTN","PSIVHYPR",137,0)
 S TVOL=TVOL+.5\1 K EL,DRG,NAD,Z
"RTN","PSIVHYPR",138,0)
 Q
"RTN","PSIVLABL")
0^4^B36555447^B28071183
"RTN","PSIVLABL",1,0)
PSIVLABL ;BIR/PR-PRINT OUT LABELS ;17 Aug 2001  9:33 AM
"RTN","PSIVLABL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,82,104,127,178**;16 DEC 97;Build 9
"RTN","PSIVLABL",3,0)
 ;
"RTN","PSIVLABL",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVLABL",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVLABL",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVLABL",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVLABL",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVLABL",9,0)
 ;
"RTN","PSIVLABL",10,0)
 ;Needs DFN,ON, and PSIVNOL NOTE: If PSIVCT is defined then we do
"RTN","PSIVLABL",11,0)
 ;not count labels in the STATs file or increment cummulative doses or
"RTN","PSIVLABL",12,0)
 ;the last fill field.
"RTN","PSIVLABL",13,0)
 ;PSIVCT will be defined if reprinting scheduled labels, the suspense
"RTN","PSIVLABL",14,0)
 ;list, or if printing individual labels and they do not count.
"RTN","PSIVLABL",15,0)
 ;
"RTN","PSIVLABL",16,0)
DEM ;Get demographics and see if label is example only
"RTN","PSIVLABL",17,0)
 N X0,PSJIO,I
"RTN","PSIVLABL",18,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVLABL",19,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVLABL",20,0)
 D ENIV^PSJAC,NOW^%DTC S PSIVNOW=$$ENDTC^PSGMI(%),VADM(2)=$E(VADM(2),6,9),PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),1:"Opt. IV") I $D(PSIVEXAM) G ENX
"RTN","PSIVLABL",21,0)
 ;
"RTN","PSIVLABL",22,0)
 G:PSIVNOL<1 Q D SETP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVLABL",23,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVLABL",24,0)
 I $P(PSIVSITE,U,7) D
"RTN","PSIVLABL",25,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVLABL",26,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVLABL",27,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABL",28,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;DO NOT PRINT ROUTE IF "DOSE DUE AT" IS SET TO NOT PRINT.
"RTN","PSIVLABL",29,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABL",30,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABL",31,0)
 . S X="Solution: _______________" D P S X="Additive: _______________" D P
"RTN","PSIVLABL",32,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVLABL",33,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABL",34,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABL",35,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+PSIVNOL
"RTN","PSIVLABL",36,0)
 K PSIVFLAG,PSIVSH G START
"RTN","PSIVLABL",37,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVLABL",38,0)
 Q
"RTN","PSIVLABL",39,0)
ENX ;Print example label
"RTN","PSIVLABL",40,0)
 D SETP S PSIVFLAG=1,PSIVRM=$P(PSIVSITE,U,13) S:PSIVRM<1 PSIVRM=30
"RTN","PSIVLABL",41,0)
START F PSIV1=1:1:PSIVNOL D
"RTN","PSIVLABL",42,0)
 . S LINE=0 D RE
"RTN","PSIVLABL",43,0)
 . Q:$D(PSIVFLAG)
"RTN","PSIVLABL",44,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABL",45,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABL",46,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVLABL",47,0)
 D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVLABL",48,0)
Q K PSIV,PSIVDOSE,PSIVWD,P16,LINE,MESS,PSIVCT,PSIV2,PSIVFLAG,PSIVRM,PSIV1,PDOSE,PDATE,XX1,XX2,BAG,CX Q
"RTN","PSIVLABL",49,0)
RE ;
"RTN","PSIVLABL",50,0)
 K DO
"RTN","PSIVLABL",51,0)
 I PSIV1,P(4)="A"!(P(5)=0) S P(16)=PSIV1 I $G(PSIVT)]"" D
"RTN","PSIVLABL",52,0)
 . S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=PSIV1
"RTN","PSIVLABL",53,0)
 I PSIV1 S PSJBCID=$$BCMA^PSIVBCID(DFN,ON,$D(PSIVCT),$G(PSIV1),$G(PSIV2),$G(PSIVNOL))
"RTN","PSIVLABL",54,0)
 ;* Only if prt from ward or man list then store BCMA ID to set xref for
"RTN","PSIVLABL",55,0)
 ;* reprint later
"RTN","PSIVLABL",56,0)
 I PSIV1,$G(PSIVWMFL) S PSIVID($P(PSJBCID,"V",2))=""
"RTN","PSIVLABL",57,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVLABL",58,0)
 I PSIV1 D BARCODE
"RTN","PSIVLABL",59,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3) D P
"RTN","PSIVLABL",60,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D P S X=" " D P
"RTN","PSIVLABL",61,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),"^"),1:"*********")_" "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVLABL",62,0)
 . D P
"RTN","PSIVLABL",63,0)
 . ;I PSIV1 S YY=Y D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY) S Y=YY
"RTN","PSIVLABL",64,0)
 . D MESS
"RTN","PSIVLABL",65,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVLABL",66,0)
 ; IV BOTTLE functionality, 3rd piece of PS(55,DFN,"IV",+ON,"AD",PSIV,0) dictates labels per LABEL RUN on which the additive will print
"RTN","PSIVLABL",67,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"********")_" "_$P(Y,U,2) I ","_$P(Y,U,3)_","[(","_P(16)_",")!('$P(Y,U,3)) D
"RTN","PSIVLABL",68,0)
 . D P
"RTN","PSIVLABL",69,0)
 . I PSIV1 S YY=Y D UP2^PSIVBCID(DFN,PSJBLN,PSIV,YY) S Y=YY
"RTN","PSIVLABL",70,0)
 . D MESS
"RTN","PSIVLABL",71,0)
 ;
"RTN","PSIVLABL",72,0)
SOL F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVLABL",73,0)
 . D SOL1,P I PSIV1 D UP3^PSIVBCID(DFN,PSJBLN,PSIV,YY)
"RTN","PSIVLABL",74,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D P
"RTN","PSIVLABL",75,0)
 I P(23)'=""!(P(4)="S") S X="In Syringe: "_$E($P(^PS(55,DFN,"IV",+ON,2),U,4),1,25) D:P(4)="S"!(P(23)="S") P S X="*CAUTION* - CHEMOTHERAPY" D:P(23)'="" P
"RTN","PSIVLABL",76,0)
 S X=" " D P I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVLABL",77,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D P
"RTN","PSIVLABL",78,0)
 ;
"RTN","PSIVLABL",79,0)
MEDRT ;Find Medication Route   
"RTN","PSIVLABL",80,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVLABL",81,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABL",82,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABL",83,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABL",84,0)
 ;
"RTN","PSIVLABL",85,0)
INF      S X=$P(P(8),"@") D:X]"" P
"RTN","PSIVLABL",86,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),"^") D:X]"" P
"RTN","PSIVLABL",87,0)
 S X=P(9) D:X]"" P
"RTN","PSIVLABL",88,0)
 S X=P(11) D:X]"" P
"RTN","PSIVLABL",89,0)
 I $D(MESS) S X=MESS D P
"RTN","PSIVLABL",90,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D P
"RTN","PSIVLABL",91,0)
 S X=PSIV1_"["_$S(PSIV1:PSIVNOL,1:PSIV2)_"]"_"  "_$S('PSIV1:PSIVNOW,1:"") D P
"RTN","PSIVLABL",92,0)
 Q
"RTN","PSIVLABL",93,0)
 ;
"RTN","PSIVLABL",94,0)
P F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABL",95,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABL",96,0)
 .. S LINE=1
"RTN","PSIVLABL",97,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABL",98,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABL",99,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",100,0)
 . K ZZ
"RTN","PSIVLABL",101,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",102,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABL",103,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",104,0)
 . I 'PSJIO W !
"RTN","PSIVLABL",105,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABL",106,0)
 Q
"RTN","PSIVLABL",107,0)
PMR ; Print Med Route on label
"RTN","PSIVLABL",108,0)
 ;  
"RTN","PSIVLABL",109,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABL",110,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABL",111,0)
 .. S LINE=1
"RTN","PSIVLABL",112,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABL",113,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABL",114,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",115,0)
 . K ZZ
"RTN","PSIVLABL",116,0)
 . ;
"RTN","PSIVLABL",117,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",118,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABL",119,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",120,0)
 . I 'PSJIO W !
"RTN","PSIVLABL",121,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABL",122,0)
 Q
"RTN","PSIVLABL",123,0)
 ;               
"RTN","PSIVLABL",124,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),"^")_" "_$P(^PS(55,DFN,"IV",+ON,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVLABL",125,0)
MESS I '$D(MESS) I $P(^PS(52.6,+Y,0),U,9)]"" S MESS=$P(^(0),U,9)
"RTN","PSIVLABL",126,0)
 Q
"RTN","PSIVLABL",127,0)
CONVER ;Expand dose to date.dose and set in X
"RTN","PSIVLABL",128,0)
 I P(15)>1440 S X=$$CONVER1^PSIVORE2($P(PSIVDOSE," "),P(15),(PSIV1-1)) Q
"RTN","PSIVLABL",129,0)
 S PDOSE=X S:PSIV1=2 PDATE=$E($P(PSIVDOSE," "),1,7)
"RTN","PSIVLABL",130,0)
 I $P(PSIVDOSE," ",PSIV1-1)#1'<PDOSE!(P(15)>1440) S:$D(X1) XX1=X1 S:$D(X2) XX2=X2 S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 Q
"RTN","PSIVLABL",131,0)
 S X=PDATE_PDOSE
"RTN","PSIVLABL",132,0)
 Q
"RTN","PSIVLABL",133,0)
BARCODE D PSET^%ZISP
"RTN","PSIVLABL",134,0)
 I 'PSJIO D
"RTN","PSIVLABL",135,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVLABL",136,0)
 . W PSJBCID
"RTN","PSIVLABL",137,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVLABL",138,0)
 . W !
"RTN","PSIVLABL",139,0)
 I PSJIO D
"RTN","PSIVLABL",140,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",141,0)
 . W PSJBCID
"RTN","PSIVLABL",142,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABL",143,0)
 Q
"RTN","PSIVLABR")
0^5^B33354776^B25623535
"RTN","PSIVLABR",1,0)
PSIVLABR ;BIR/PR-REPRINT LABELS ;30 May 2001  12:36 PM
"RTN","PSIVLABR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,82,178**;16 DEC 97;Build 9
"RTN","PSIVLABR",3,0)
 ;
"RTN","PSIVLABR",4,0)
 ; Reference to ^%ZIS(2 is supported by DBIA 3435.
"RTN","PSIVLABR",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVLABR",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVLABR",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVLABR",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178. 
"RTN","PSIVLABR",9,0)
 ;
"RTN","PSIVLABR",10,0)
 ;Needs DFN,ON, and PSIVNOL NOTE: If PSIVCT is defined then we do
"RTN","PSIVLABR",11,0)
 ;not count labels in the STATs file or increment cummulative doses or
"RTN","PSIVLABR",12,0)
 ;the last fill field.
"RTN","PSIVLABR",13,0)
 ;PSIVCT will be defined if reprinting scheduled labels, the suspense
"RTN","PSIVLABR",14,0)
 ;list, or if printing individual labels and they do not count.
"RTN","PSIVLABR",15,0)
 ;
"RTN","PSIVLABR",16,0)
DEM ;Get demographics and see if label is example only
"RTN","PSIVLABR",17,0)
 N X0,PSJIO,I
"RTN","PSIVLABR",18,0)
 S I=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSJIO($P(X0,"^"))=^(1)
"RTN","PSIVLABR",19,0)
 S PSJIO=$S('$D(PSJIO):0,1:1)
"RTN","PSIVLABR",20,0)
 D ENIV^PSJAC,NOW^%DTC S PSIVNOW=$$ENDTC^PSGMI(%),VADM(2)=$E(VADM(2),6,9),PSIVWD=$S(+VAIN(4):$P(VAIN(4),U,2),1:"Opt. IV") I $D(PSIVEXAM) G ENX
"RTN","PSIVLABR",21,0)
 ;
"RTN","PSIVLABR",22,0)
 ;;NEW PSIVNOL,PSIV1 S (PSIVNOL,PSIV1)=1
"RTN","PSIVLABR",23,0)
 NEW PSIV1 S PSIV1=1
"RTN","PSIVLABR",24,0)
 G:PSIVNOL<1 Q D SETP S PSIVRM=$P(PSIVSITE,U,13),P16=$P($G(^PS(55,DFN,"IV",+ON,9)),U,3) S:PSIVRM<1 PSIVRM=30 I $D(PSIVCT),PSIVCT'=1 K PSIVCT
"RTN","PSIVLABR",25,0)
 I PSJIO,$G(PSJIO("FI"))]"" X PSJIO("FI")
"RTN","PSIVLABR",26,0)
 ;PSJRPHD is defined in REPRT^PSIVLBRP so header only print once.
"RTN","PSIVLABR",27,0)
 I $P(PSIVSITE,U,7),'$D(PSJRPHD) D
"RTN","PSIVLABR",28,0)
 . S PSIVFLAG=1,(LINE,PSIV1)=0,PSIV2=PSIVNOL,PSIVNOL=0 D RE
"RTN","PSIVLABR",29,0)
 . S PSIVRP="",PSIVRT=""
"RTN","PSIVLABR",30,0)
 . I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABR",31,0)
 .. I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) Q   ;QUIT IF "DOSE DUE AT" IS SET TO NOT PRINT
"RTN","PSIVLABR",32,0)
 .. S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABR",33,0)
 .. S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABR",34,0)
 . S X="Solution: _______________" D P S X="Additive: _______________" D P
"RTN","PSIVLABR",35,0)
 . S PSIVNOL=PSIV2
"RTN","PSIVLABR",36,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABR",37,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABR",38,0)
 ;;I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+PSIVNOL
"RTN","PSIVLABR",39,0)
 I '$D(PSIVCT) D NOW^%DTC S Y=%,$P(^PS(55,DFN,"IV",+ON,9),U,1,2)=Y_"^"_PSIVNOL,$P(^(9),U,3)=$P(^(9),U,3)+1
"RTN","PSIVLABR",40,0)
 K PSIVFLAG,PSIVSH G START
"RTN","PSIVLABR",41,0)
SETP S Y=^PS(55,DFN,"IV",+ON,0) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVLABR",42,0)
 Q
"RTN","PSIVLABR",43,0)
ENX ;Print example label
"RTN","PSIVLABR",44,0)
 D SETP S PSIVFLAG=1,PSIVRM=$P(PSIVSITE,U,13) S:PSIVRM<1 PSIVRM=30
"RTN","PSIVLABR",45,0)
START S PSIV1=1,LINE=0 D RE D
"RTN","PSIVLABR",46,0)
 . Q:$D(PSIVFLAG) 
"RTN","PSIVLABR",47,0)
 . I 'PSJIO F LINE=LINE+1:1:(PSIVSITE+$P(PSIVSITE,U,16)) W !
"RTN","PSIVLABR",48,0)
 . I PSJIO,$G(PSJIO("EL"))]"" X PSJIO("EL")
"RTN","PSIVLABR",49,0)
 I PSJIO,$G(PSJIO("FE"))]"" X PSJIO("FE")
"RTN","PSIVLABR",50,0)
 D:'$D(PSIVCT) ^PSIVSTAT
"RTN","PSIVLABR",51,0)
Q K PSIV,PSIVDOSE,PSIVCT,PSIVWD,P16,LINE,MESS,PSIV2,PSIVFLAG,PSIVRM,PSIV1,PDOSE,PDATE,XX1,XX2,BAG,CX Q
"RTN","PSIVLABR",52,0)
RE ;
"RTN","PSIVLABR",53,0)
 ;NEED THE CODE BELOW?
"RTN","PSIVLABR",54,0)
 ;;I PSIV1,P(4)="A"!(P(5)=0) S:P(15)>2880!('P(15)) P(15)=2880 S P(16)=P16+PSIV1#(1440/P(15)+.5\1) S:'P(16) P(16)=PSIV1
"RTN","PSIVLABR",55,0)
 I PSJIO,$G(PSJIO("SL"))]"" X PSJIO("SL")
"RTN","PSIVLABR",56,0)
 I PSIV1 D BARCODE
"RTN","PSIVLABR",57,0)
 S X="["_$P(^PS(55,DFN,"IV",+ON,0),U)_"]"_" "_VADM(2)_"  "_PSIVWD_"  "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3) D P
"RTN","PSIVLABR",58,0)
 S X=VADM(1) S:$P(PSIVSITE,U,9) X=X_"  "_$S(VAIN(5)]"":VAIN(5),1:"NF") D P S X=" " D P
"RTN","PSIVLABR",59,0)
 I $D(PSIVFLAG) F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IV",+ON,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),"^"),1:"*********")_" "_$P(Y,U,2)_" " S:$P(Y,U,3)]"" X=X_" ("_$P(Y,U,3)_")" D
"RTN","PSIVLABR",60,0)
 . D P,MESS
"RTN","PSIVLABR",61,0)
 G:$D(PSIVFLAG) SOL
"RTN","PSIVLABR",62,0)
 F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"AD",PSIV)) Q:'PSIV  S Y=^(PSIV,0),X=$S($D(^PS(52.6,+Y,0)):$P(^(0),U),1:"********")_" "_$P(Y,U,2) D
"RTN","PSIVLABR",63,0)
 . D P,MESS
"RTN","PSIVLABR",64,0)
SOL F PSIV=0:0 S PSIV=$O(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",PSIV)) Q:'PSIV  S PSIV=PSIV_"^"_+^(PSIV,0),YY=^(0) D
"RTN","PSIVLABR",65,0)
 . D SOL1,P
"RTN","PSIVLABR",66,0)
 . S X=$P(^PS(52.7,$P(PSIV,U,2),0),U,4) I X]"" S X="   "_X D P
"RTN","PSIVLABR",67,0)
 I P(23)'=""!(P(4)="S") S X="In Syringe: "_$E($P(^PS(55,DFN,"IV",+ON,2),U,4),1,25) D:P(4)="S"!(P(23)="S") P S X="*CAUTION* - CHEMOTHERAPY" D:P(23)'="" P
"RTN","PSIVLABR",68,0)
 S X=" " D P I PSIV1'>0!'$P(PSIVSITE,U,3)!($P(PSIVSITE,U,3)=1&(P(4)'="P"))!($P(PSIVSITE,U,3)=2&("AH"'[P(4))) G MEDRT
"RTN","PSIVLABR",69,0)
 S:'$D(PSIVDOSE) PSIVDOSE="" S X=$P(PSIVDOSE," ",PSIV1) D:$E(X)="." CONVER S X="Dose due at: "_$S(X="":"________",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)) D P
"RTN","PSIVLABR",70,0)
 ;
"RTN","PSIVLABR",71,0)
MEDRT ;Find Medication Route   
"RTN","PSIVLABR",72,0)
 S PSIVRP="",PSIVRT=""
"RTN","PSIVLABR",73,0)
 I $D(^PS(55,DFN,"IV",+ON,.2)) S PSIVRP=$P(^PS(55,DFN,"IV",+ON,.2),U,3) D
"RTN","PSIVLABR",74,0)
 .S PSIVRT=$P(^PS(51.2,PSIVRP,0),U,1)
"RTN","PSIVLABR",75,0)
 .S X="ROUTE: "_PSIVRT D:X]"" PMR
"RTN","PSIVLABR",76,0)
 ;
"RTN","PSIVLABR",77,0)
INF S X=$P(P(8),"@") D:X]"" P
"RTN","PSIVLABR",78,0)
 I $D(^PS(55,DFN,"IV",+ON,3)) S X=$P(^(3),"^") D:X]"" P
"RTN","PSIVLABR",79,0)
 S X=P(9) D:X]"" P
"RTN","PSIVLABR",80,0)
 S X=P(11) D:X]"" P
"RTN","PSIVLABR",81,0)
 I $D(MESS) S X=MESS D P
"RTN","PSIVLABR",82,0)
 I $D(^PS(59.5,PSIVSN,4)) S Y=^(4) F PSIV=1:1 S X=$P(Y,U,PSIV) Q:X=""  D P
"RTN","PSIVLABR",83,0)
 ;S X=PSIV1_"["_$S(PSIV1:PSIVNOL,1:PSIV2)_"]"_"  "_$S('PSIV1:PSIVNOW,1:"") D P
"RTN","PSIVLABR",84,0)
 S X=PSIVBAG D P
"RTN","PSIVLABR",85,0)
 Q
"RTN","PSIVLABR",86,0)
P F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABR",87,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABR",88,0)
 .. S LINE=1
"RTN","PSIVLABR",89,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABR",90,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABR",91,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",92,0)
 . K ZZ
"RTN","PSIVLABR",93,0)
 . F I="ST","STF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",94,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABR",95,0)
 . F I="ETF","ET" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",96,0)
 . I 'PSJIO W !
"RTN","PSIVLABR",97,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABR",98,0)
 Q
"RTN","PSIVLABR",99,0)
PMR ; Print Med Route on label
"RTN","PSIVLABR",100,0)
 ;
"RTN","PSIVLABR",101,0)
 F LINE=LINE+1:1 D  Q:$L(X)<1
"RTN","PSIVLABR",102,0)
 . I LINE>PSIVSITE D
"RTN","PSIVLABR",103,0)
 .. S LINE=1
"RTN","PSIVLABR",104,0)
 .. I 'PSJIO D  Q
"RTN","PSIVLABR",105,0)
 ... F ZZ=1:1 Q:ZZ>$P(PSIVSITE,"^",16)  W !
"RTN","PSIVLABR",106,0)
 .. F I="EL","SL" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",107,0)
 . K ZZ
"RTN","PSIVLABR",108,0)
 . ;
"RTN","PSIVLABR",109,0)
 . F I="ST","STF","SM","SMF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",110,0)
 . W $E(X,1,PSIVRM)
"RTN","PSIVLABR",111,0)
 . F I="ETF","ET","EMF","EM" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",112,0)
 . I 'PSJIO W !
"RTN","PSIVLABR",113,0)
 . S X=$E(X,PSIVRM+1,999)
"RTN","PSIVLABR",114,0)
 Q
"RTN","PSIVLABR",115,0)
SOL1 S X=$S($D(^PS(52.7,$P(PSIV,U,2),0)):$P(^(0),"^")_" "_$P(^PS(55,DFN,"IVBCMA",PSJIDNO,"SOL",+PSIV,0),U,2),1:"**********") Q
"RTN","PSIVLABR",116,0)
MESS I '$D(MESS) I $P(^PS(52.6,+Y,0),U,9)]"" S MESS=$P(^(0),U,9)
"RTN","PSIVLABR",117,0)
 Q
"RTN","PSIVLABR",118,0)
CONVER ;Expand dose to date.dose and set in X
"RTN","PSIVLABR",119,0)
 I P(15)>1440 S X=$$CONVER1^PSIVORE2($P(PSIVDOSE," "),P(15),(PSIV1-1)) Q
"RTN","PSIVLABR",120,0)
 S PDOSE=X S:PSIV1=2 PDATE=$E($P(PSIVDOSE," "),1,7)
"RTN","PSIVLABR",121,0)
 I $P(PSIVDOSE," ",PSIV1-1)#1'<PDOSE!(P(15)>1440) S:$D(X1) XX1=X1 S:$D(X2) XX2=X2 S X1=PDATE,X2=1 D C^%DTC S PDATE=X,X=X_PDOSE S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 Q
"RTN","PSIVLABR",122,0)
 S X=PDATE_PDOSE
"RTN","PSIVLABR",123,0)
 Q
"RTN","PSIVLABR",124,0)
BARCODE D PSET^%ZISP
"RTN","PSIVLABR",125,0)
 I 'PSJIO D
"RTN","PSIVLABR",126,0)
 . I IOBARON]"" W @IOBARON
"RTN","PSIVLABR",127,0)
 . W PSJBCID
"RTN","PSIVLABR",128,0)
 . I IOBAROFF]"" W @IOBAROFF
"RTN","PSIVLABR",129,0)
 . W !
"RTN","PSIVLABR",130,0)
 I PSJIO D
"RTN","PSIVLABR",131,0)
 . F I="SB","SBF" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",132,0)
 . W PSJBCID
"RTN","PSIVLABR",133,0)
 . F I="EBF","EB" I $G(PSJIO(I))]"" X PSJIO(I)
"RTN","PSIVLABR",134,0)
 Q
"VER")
8.0^22.0
"BLD",5706,6)
^163
**END**
**END**
