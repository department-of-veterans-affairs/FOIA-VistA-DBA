Released OSI*2*12 SEQ #11
Extracted from mail message
**KIDS**:OSI*2.0*12^

**INSTALL NAME**
OSI*2.0*12
"BLD",1216,0)
OSI*2.0*12^OS-OPENM^0^3000501^y
"BLD",1216,1,0)
^^2^2^3000501^^^
"BLD",1216,1,1,0)
This build contains revised Avanti System backup procedure routines
"BLD",1216,1,2,0)
for patch OSI*2.0*12.
"BLD",1216,4,0)
^9.64PA^^
"BLD",1216,"ABPKG")
n
"BLD",1216,"INI")
NVS12PRE
"BLD",1216,"INID")
^^y
"BLD",1216,"KRN",0)
^9.67PA^19^18
"BLD",1216,"KRN",.4,0)
.4
"BLD",1216,"KRN",.401,0)
.401
"BLD",1216,"KRN",.402,0)
.402
"BLD",1216,"KRN",.403,0)
.403
"BLD",1216,"KRN",.5,0)
.5
"BLD",1216,"KRN",.84,0)
.84
"BLD",1216,"KRN",3.6,0)
3.6
"BLD",1216,"KRN",3.8,0)
3.8
"BLD",1216,"KRN",9.2,0)
9.2
"BLD",1216,"KRN",9.8,0)
9.8
"BLD",1216,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",1216,"KRN",9.8,"NM",1,0)
NVSMSG^^0^B20945532
"BLD",1216,"KRN",9.8,"NM",2,0)
NVS12PRE^^0^B2579468
"BLD",1216,"KRN",9.8,"NM","B","NVS12PRE",2)

"BLD",1216,"KRN",9.8,"NM","B","NVSMSG",1)

"BLD",1216,"KRN",19,0)
19
"BLD",1216,"KRN",19,"NM",0)
^9.68A^^0
"BLD",1216,"KRN",19.1,0)
19.1
"BLD",1216,"KRN",101,0)
101
"BLD",1216,"KRN",101,"NM",0)
^9.68A^^0
"BLD",1216,"KRN",409.61,0)
409.61
"BLD",1216,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",1216,"KRN",771,0)
771
"BLD",1216,"KRN",869.2,0)
869.2
"BLD",1216,"KRN",870,0)
870
"BLD",1216,"KRN",8994,0)
8994
"BLD",1216,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",1216,"KRN","B",.4,.4)

"BLD",1216,"KRN","B",.401,.401)

"BLD",1216,"KRN","B",.402,.402)

"BLD",1216,"KRN","B",.403,.403)

"BLD",1216,"KRN","B",.5,.5)

"BLD",1216,"KRN","B",.84,.84)

"BLD",1216,"KRN","B",3.6,3.6)

"BLD",1216,"KRN","B",3.8,3.8)

"BLD",1216,"KRN","B",9.2,9.2)

"BLD",1216,"KRN","B",9.8,9.8)

"BLD",1216,"KRN","B",19,19)

"BLD",1216,"KRN","B",19.1,19.1)

"BLD",1216,"KRN","B",101,101)

"BLD",1216,"KRN","B",409.61,409.61)

"BLD",1216,"KRN","B",771,771)

"BLD",1216,"KRN","B",869.2,869.2)

"BLD",1216,"KRN","B",870,870)

"BLD",1216,"KRN","B",8994,8994)

"BLD",1216,"QUES",0)
^9.62^^
"BLD",1216,"REQB",0)
^9.611^1^1
"BLD",1216,"REQB",1,0)
OSI*2.0*11^1
"BLD",1216,"REQB","B","OSI*2.0*11",1)

"INI")
NVS12PRE
"MBREQ")
0
"PKG",540,-1)
1^1
"PKG",540,0)
OS-OPENM^OSI^This is a place-holder for OpenM information patches
"PKG",540,20,0)
^9.402P^^
"PKG",540,22,0)
^9.49I^1^1
"PKG",540,22,1,0)
2.0
"PKG",540,22,1,"PAH",1,0)
12^3000501
"PKG",540,22,1,"PAH",1,1,0)
^^2^2^3000501
"PKG",540,22,1,"PAH",1,1,1,0)
This build contains revised Avanti System backup procedure routines
"PKG",540,22,1,"PAH",1,1,2,0)
for patch OSI*2.0*12.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","NVS12PRE")
0^2^B2579468
"RTN","NVS12PRE",1,0)
NVS12PRE        ;nvsiss/maw-pre-installation routine for patch OSI*2.0*12 ;5/1/2000
"RTN","NVS12PRE",2,0)
 ;;2.0;PRE-INSTALLATION FOR PATCH OSI*2.0*12;01 May 2000
"RTN","NVS12PRE",3,0)
 ;
"RTN","NVS12PRE",4,0)
 ; This routine will ensure that the CURRENT VERSION field (#13) of the PACKAGE
"RTN","NVS12PRE",5,0)
 ; file (#9.4) equals 2 (this is the current version of the OSI "package".)
"RTN","NVS12PRE",6,0)
 ;
"RTN","NVS12PRE",7,0)
 N NVSCVER,NVSFDA,NVSOSI
"RTN","NVS12PRE",8,0)
 ;
"RTN","NVS12PRE",9,0)
 D BMES^XPDUTL("Checking CURRENT VERSION field for OS-OPENM Package file entry...")
"RTN","NVS12PRE",10,0)
 S NVSOSI=$$FIND1^DIC(9.4,"","AMX","OS-OPENM")
"RTN","NVS12PRE",11,0)
 I 'NVSOSI D  Q
"RTN","NVS12PRE",12,0)
 .D BMES^XPDUTL("WARNING: You do not have an ""OS-OPENM"" entry!")
"RTN","NVS12PRE",13,0)
 .D MES^XPDUTL("Aborting pre-installation!")
"RTN","NVS12PRE",14,0)
 ;
"RTN","NVS12PRE",15,0)
 D MES^XPDUTL("Okay, found it -- record number = "_NVSOSI)
"RTN","NVS12PRE",16,0)
 D BMES^XPDUTL("Checking CURRENT VERSION field...")
"RTN","NVS12PRE",17,0)
 I +$G(^DIC(9.4,NVSOSI,"VERSION"))=2 D  Q
"RTN","NVS12PRE",18,0)
 .D BMES^XPDUTL("CURRENT VERSION is already 2...you're all set.")
"RTN","NVS12PRE",19,0)
 ;
"RTN","NVS12PRE",20,0)
 D BMES^XPDUTL("Updating CURRENT VERSION to 2...")
"RTN","NVS12PRE",21,0)
 S NVSFDA(9.4,NVSOSI_",",13)=2
"RTN","NVS12PRE",22,0)
 D UPDATE^DIE("E","NVSFDA","","NVSERR")
"RTN","NVS12PRE",23,0)
 I +$G(^DIC(9.4,NVSOSI,"VERSION"))=2 D  Q
"RTN","NVS12PRE",24,0)
 .D MES^XPDUTL("Done...you're all set.")
"RTN","NVS12PRE",25,0)
 D MES^XPDUTL("ERROR!  CURRENT VERSION NOT UPDATED!")
"RTN","NVS12PRE",26,0)
 Q
"RTN","NVSMSG")
0^1^B20945532
"RTN","NVSMSG",1,0)
NVSMSG ;slcciofo/maw,mb-alert and messaging utility ;02:21 PM  19 Apr 2000
"RTN","NVSMSG",2,0)
 ;;2.0;NVS system management utility;**11,12**; Jan 01, 1999
"RTN","NVSMSG",3,0)
 ;
"RTN","NVSMSG",4,0)
 ; **NOTE: THIS ROUTINE IS USED ONLY ON INTERSYSTEMS CACHE SYSTEMS**
"RTN","NVSMSG",5,0)
 ;
"RTN","NVSMSG",6,0)
 ; This routine is invoked by various AVANTI system monitoring utilities
"RTN","NVSMSG",7,0)
 ; (e.g., the backup procedure (^BACKIRM) and the dead process check
"RTN","NVSMSG",8,0)
 ; (^NVSDEAD)).  It retrieves the text contained in a log file stored in
"RTN","NVSMSG",9,0)
 ; NT, sets it up as a mail message, and sends the message to the
"RTN","NVSMSG",10,0)
 ; <default> G.IRM mail group.  The mail group can be changed as the
"RTN","NVSMSG",11,0)
 ; site wishes by changing the lookup in the code below.
"RTN","NVSMSG",12,0)
 ;
"RTN","NVSMSG",13,0)
EN(NVSSTG,NVSLOG,NVSALERT)      ;
"RTN","NVSMSG",14,0)
 ;
"RTN","NVSMSG",15,0)
 ; NVSSTG   = a text string passed by value that will be used as the
"RTN","NVSMSG",16,0)
 ;              mail message and alert subject
"RTN","NVSMSG",17,0)
 ; NVSLOG   = log file name (drive:\directory\filename.LOG)
"RTN","NVSMSG",18,0)
 ;              -->y:\backup\01012000.log or y:\backup\deadchk.log
"RTN","NVSMSG",19,0)
 ;              passed by value from from the calling routine
"RTN","NVSMSG",20,0)
 ; NVSALERT = passed by value as 0 to not send an alert, just a mail
"RTN","NVSMSG",21,0)
 ;              message or 1 to send both an alert and a mail message
"RTN","NVSMSG",22,0)
 ;
"RTN","NVSMSG",23,0)
 S $ZT=$G(^%ZOSF("ERRTN"))
"RTN","NVSMSG",24,0)
 S U="^"
"RTN","NVSMSG",25,0)
 S NVSDEVOK=1
"RTN","NVSMSG",26,0)
 S NVSALERT=+$G(NVSALERT)
"RTN","NVSMSG",27,0)
 ;
"RTN","NVSMSG",28,0)
 ; if NVSALERT=1 then the situation is likely critical so let's get
"RTN","NVSMSG",29,0)
 ; a cstat...
"RTN","NVSMSG",30,0)
 I NVSALERT D
"RTN","NVSMSG",31,0)
 .S NVSCSTAT=1
"RTN","NVSMSG",32,0)
 .S X=$ZF(-1,"T:\ANONYMOUS\CSTAT\CSTAT.CMD")
"RTN","NVSMSG",33,0)
 ;
"RTN","NVSMSG",34,0)
 I $G(NVSSTG)="" S NVSSTG="SYSTEM PROCESS MESSAGE"
"RTN","NVSMSG",35,0)
 I $G(NVSLOG)'="" D
"RTN","NVSMSG",36,0)
 .F NVSI=1:1 S NVSFILE=$P(NVSLOG,"\",NVSI) Q:NVSFILE=""
"RTN","NVSMSG",37,0)
 .S NVSFILE=$P(NVSLOG,"\",NVSI-1)
"RTN","NVSMSG",38,0)
 .S NVSDIR=$P(NVSLOG,"\",1,NVSI-2)_"\"
"RTN","NVSMSG",39,0)
 .K NVSI
"RTN","NVSMSG",40,0)
 .;
"RTN","NVSMSG",41,0)
 .; delete any existing temp global used for this messaging utility...
"RTN","NVSMSG",42,0)
 .K ^TMP($J),^XTMP("NVSMSG")
"RTN","NVSMSG",43,0)
 .S ^XTMP("NVSMSG",0)=$$DT^XLFDT_U_$$DT^XLFDT_U_"NVS Procedure Error Message"
"RTN","NVSMSG",44,0)
 .;
"RTN","NVSMSG",45,0)
 .; call Kernel to retrieve the log file contents and set the temporary
"RTN","NVSMSG",46,0)
 .; global for us...
"RTN","NVSMSG",47,0)
 .S NVSDEVOK=$$FTG^%ZISH(NVSDIR,NVSFILE,"^XTMP(""NVSMSG"",1)",2,"OVF")
"RTN","NVSMSG",48,0)
 .;
"RTN","NVSMSG",49,0)
 .; if NVSDEVOK is 0, then the log file couldn't be retrieved, or the
"RTN","NVSMSG",50,0)
 .; temporary global array could not be set.  so, set up the message to
"RTN","NVSMSG",51,0)
 .; relay this information...
"RTN","NVSMSG",52,0)
 .I 'NVSDEVOK D
"RTN","NVSMSG",53,0)
 ..S ^TMP($J,1,0)="Log file: "_NVSLOG_" could not be retrieved!"
"RTN","NVSMSG",54,0)
 ..S ^TMP($J,2,0)="Check the Y: drive to see if it may be full."
"RTN","NVSMSG",55,0)
 ;
"RTN","NVSMSG",56,0)
 ; if NVSLOG was not passed, set up the message to relay this error...
"RTN","NVSMSG",57,0)
 I $G(NVSLOG)="" D
"RTN","NVSMSG",58,0)
 .S NVSDEVOK=0
"RTN","NVSMSG",59,0)
 .S ^TMP($J,1,0)="No log file was set up by the "_NVSSTG_"."
"RTN","NVSMSG",60,0)
 .S ^TMP($J,2,0)="Please check the y:\backup directory to confirm."
"RTN","NVSMSG",61,0)
 ;
"RTN","NVSMSG",62,0)
 ; retrieve the text from the temporary global and put into our local array...
"RTN","NVSMSG",63,0)
 I NVSDEVOK D
"RTN","NVSMSG",64,0)
 .S NVSLINCT=0
"RTN","NVSMSG",65,0)
 .F  S NVSLINCT=$O(^XTMP("NVSMSG",NVSLINCT)) Q:'NVSLINCT  D
"RTN","NVSMSG",66,0)
 ..S ^TMP($J,NVSLINCT)=^XTMP("NVSMSG",NVSLINCT)
"RTN","NVSMSG",67,0)
 ..I ^TMP($J,NVSLINCT)["WARNING"!(^TMP($J,NVSLINCT)["$ZE") S NVSWARN=1
"RTN","NVSMSG",68,0)
 .;
"RTN","NVSMSG",69,0)
 .; check for NVSWARN.  if it exists, then warnings and/or errors exist in
"RTN","NVSMSG",70,0)
 .; the log file.  let's insert a line right at the top of the message text
"RTN","NVSMSG",71,0)
 .; indicating that fact...
"RTN","NVSMSG",72,0)
 .I +$G(NVSWARN) D
"RTN","NVSMSG",73,0)
 ..S ^TMP($J,.1)="**********************>> WARNING <<***********************"
"RTN","NVSMSG",74,0)
 ..S ^TMP($J,.2)="* ERROR AND/OR WARNING MESSAGES EXIST IN THIS LOG FILE!! *"
"RTN","NVSMSG",75,0)
 ..S ^TMP($J,.3)="* RECOMMEND COMPLETE REVIEW OF THE LOG FILE AND          *"
"RTN","NVSMSG",76,0)
 ..S ^TMP($J,.4)="* CORRECTIVE ACTION BE TAKEN IMMEDIATELY!!               *"
"RTN","NVSMSG",77,0)
 ..S ^TMP($J,.5)="**********************************************************"
"RTN","NVSMSG",78,0)
 ..K NVSWARN
"RTN","NVSMSG",79,0)
 .;
"RTN","NVSMSG",80,0)
 .; if we generated a CSTAT because of the alert status of this message, let's
"RTN","NVSMSG",81,0)
 .; tell the recipients that we did that and what the file name is...
"RTN","NVSMSG",82,0)
 .I +$G(NVSCSTAT) D
"RTN","NVSMSG",83,0)
 ..S ^TMP($J,.6)=" "
"RTN","NVSMSG",84,0)
 ..S ^TMP($J,.7)="NOTE!! THE CSTAT COMMAND FILE WAS CALLED AS A RESULT OF THIS PROBLEM."
"RTN","NVSMSG",85,0)
 ..S ^TMP($J,.8)="Please look for the CSTAT reports in t:\anonymous\cstat\."
"RTN","NVSMSG",86,0)
 ..S ^TMP($J,.9)=" "
"RTN","NVSMSG",87,0)
 .K NVSLINCT        
"RTN","NVSMSG",88,0)
 ;
"RTN","NVSMSG",89,0)
 ; **send e-mail >> the site can change the default mail group from G.IRM to
"RTN","NVSMSG",90,0)
 ;                  some other group by editing the "IRM" in the x-ref lookup
"RTN","NVSMSG",91,0)
 ;                  below -- i.e., +$O(^XMB(3.8,"B","mail group name",0))
"RTN","NVSMSG",92,0)
 ;
"RTN","NVSMSG",93,0)
 ; check for the existence of G.IRM mail group, and that that group has at least
"RTN","NVSMSG",94,0)
 ; one member...
"RTN","NVSMSG",95,0)
 S NVSMGRP=+$O(^XMB(3.8,"B","IRM",0))
"RTN","NVSMSG",96,0)
 I '$O(^XMB(3.8,NVSMGRP,1,0)) S NVSMGRP=0
"RTN","NVSMSG",97,0)
 I NVSMGRP S NVSMGRP="G.IRM"
"RTN","NVSMSG",98,0)
 ;
"RTN","NVSMSG",99,0)
 ; if no such mail group or no members, send the message to postmaster...
"RTN","NVSMSG",100,0)
 I NVSMGRP=0 S NVSMGRP=.5
"RTN","NVSMSG",101,0)
 ;
"RTN","NVSMSG",102,0)
 S XMDUZ=.5
"RTN","NVSMSG",103,0)
 S XMSUB=NVSSTG_" "_$E(NVSFILE,1,2)_"/"_$E(NVSFILE,3,4)_"/"_$E(NVSFILE,5,8)_"@"_$E(NVSFILE,10,13)
"RTN","NVSMSG",104,0)
 S XMY(NVSMGRP)=""
"RTN","NVSMSG",105,0)
 ;
"RTN","NVSMSG",106,0)
 ; if the situation requires an alert be sent, it may be critical enough to
"RTN","NVSMSG",107,0)
 ; warrant national support attention.  add G.CSAVANTI@FORUM to the recipients...
"RTN","NVSMSG",108,0)
 I +$G(NVSALERT)=1 S XMY("G.CSAVANTI@FORUM.VA.GOV")=""
"RTN","NVSMSG",109,0)
 S XMTEXT="^TMP("_$J_","
"RTN","NVSMSG",110,0)
 D ^XMD
"RTN","NVSMSG",111,0)
 K XMDUZ
"RTN","NVSMSG",112,0)
 ;
"RTN","NVSMSG",113,0)
 ; send an alert to mailgroup...
"RTN","NVSMSG",114,0)
 I +$G(NVSALERT)=1 D
"RTN","NVSMSG",115,0)
 .S DUZ=".5"
"RTN","NVSMSG",116,0)
 .S XQA(NVSMGRP)=""
"RTN","NVSMSG",117,0)
 .S XQAMSG="** "_NVSSTG_" PROBLEM - PLEASE REFER TO MESSAGE NUMBER "_$G(XMZ)_" **"
"RTN","NVSMSG",118,0)
 .D SETUP^XQALERT
"RTN","NVSMSG",119,0)
 .K XQA,XQAMSG
"RTN","NVSMSG",120,0)
 ;
"RTN","NVSMSG",121,0)
 K NVSALERT,NVSCSTAT,NVSDEVOK,NVSDIR,NVSFILE,NVSLOG,NVSMGRP,NVSSTG
"RTN","NVSMSG",122,0)
 K XMSUB,XMTEXT,XMY,XMZ
"RTN","NVSMSG",123,0)
 K ^TMP($J),^XTMP("NVSMSG")
"RTN","NVSMSG",124,0)
 Q
"VER")
8.0^22.0
**END**
**END**
