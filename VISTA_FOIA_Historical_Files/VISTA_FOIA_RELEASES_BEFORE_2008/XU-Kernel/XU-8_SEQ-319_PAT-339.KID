Released XU*8*339 SEQ #319
Extracted from mail message
**KIDS**:XU*8.0*339^

**INSTALL NAME**
XU*8.0*339
"BLD",809,0)
XU*8.0*339^KERNEL^0^3051205^y
"BLD",809,1,0)
^^2^2^3040223^
"BLD",809,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"BLD",809,1,2,0)
Patch XU*8*339.
"BLD",809,4,0)
^9.64PA^^
"BLD",809,6.3)
3
"BLD",809,"KRN",0)
^9.67PA^8989.52^19
"BLD",809,"KRN",.4,0)
.4
"BLD",809,"KRN",.401,0)
.401
"BLD",809,"KRN",.402,0)
.402
"BLD",809,"KRN",.403,0)
.403
"BLD",809,"KRN",.5,0)
.5
"BLD",809,"KRN",.84,0)
.84
"BLD",809,"KRN",3.6,0)
3.6
"BLD",809,"KRN",3.8,0)
3.8
"BLD",809,"KRN",9.2,0)
9.2
"BLD",809,"KRN",9.8,0)
9.8
"BLD",809,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",809,"KRN",9.8,"NM",1,0)
ZTLOAD^^0^3991879
"BLD",809,"KRN",9.8,"NM",2,0)
ZTLOAD5^^0^10393417
"BLD",809,"KRN",9.8,"NM",3,0)
ZTLOAD2^^0^9439149
"BLD",809,"KRN",9.8,"NM","B","ZTLOAD",1)

"BLD",809,"KRN",9.8,"NM","B","ZTLOAD2",3)

"BLD",809,"KRN",9.8,"NM","B","ZTLOAD5",2)

"BLD",809,"KRN",19,0)
19
"BLD",809,"KRN",19.1,0)
19.1
"BLD",809,"KRN",101,0)
101
"BLD",809,"KRN",409.61,0)
409.61
"BLD",809,"KRN",771,0)
771
"BLD",809,"KRN",870,0)
870
"BLD",809,"KRN",8989.51,0)
8989.51
"BLD",809,"KRN",8989.52,0)
8989.52
"BLD",809,"KRN",8994,0)
8994
"BLD",809,"KRN","B",.4,.4)

"BLD",809,"KRN","B",.401,.401)

"BLD",809,"KRN","B",.402,.402)

"BLD",809,"KRN","B",.403,.403)

"BLD",809,"KRN","B",.5,.5)

"BLD",809,"KRN","B",.84,.84)

"BLD",809,"KRN","B",3.6,3.6)

"BLD",809,"KRN","B",3.8,3.8)

"BLD",809,"KRN","B",9.2,9.2)

"BLD",809,"KRN","B",9.8,9.8)

"BLD",809,"KRN","B",19,19)

"BLD",809,"KRN","B",19.1,19.1)

"BLD",809,"KRN","B",101,101)

"BLD",809,"KRN","B",409.61,409.61)

"BLD",809,"KRN","B",771,771)

"BLD",809,"KRN","B",870,870)

"BLD",809,"KRN","B",8989.51,8989.51)

"BLD",809,"KRN","B",8989.52,8989.52)

"BLD",809,"KRN","B",8994,8994)

"BLD",809,"QUES",0)
^9.62^^
"BLD",809,"REQB",0)
^9.611^2^2
"BLD",809,"REQB",1,0)
XU*8.0*49^2
"BLD",809,"REQB",2,0)
XU*8.0*127^2
"BLD",809,"REQB","B","XU*8.0*127",2)

"BLD",809,"REQB","B","XU*8.0*49",1)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
339^3051205
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3051205
"PKG",3,22,1,"PAH",1,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"PKG",3,22,1,"PAH",1,1,2,0)
Patch XU*8*339.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ZTLOAD")
0^1^B3991879
"RTN","ZTLOAD",1,0)
%ZTLOAD ;ISF/RDS,RWF - TaskMan: Programmer Interface: Entry Points ;10/19/2005
"RTN","ZTLOAD",2,0)
 ;;8.0;KERNEL;**67,118,127,339**;JUL 10, 1995;Build 3
"RTN","ZTLOAD",3,0)
 ;
"RTN","ZTLOAD",4,0)
QUEUE ;queue a task (create, schedule) (Entry Point = ^%ZTLOAD)
"RTN","ZTLOAD",5,0)
 G ^%ZTLOAD1
"RTN","ZTLOAD",6,0)
 ;
"RTN","ZTLOAD",7,0)
S(MSG) ;Entry Point: extrinsic variable returns boolean: should task stop?
"RTN","ZTLOAD",8,0)
 I $D(MSG),$G(ZTQUEUED)>.5 S ^%ZTSK(ZTQUEUED,.11)=MSG,$P(^%ZTSK(ZTQUEUED,.1),"^",2)=$H
"RTN","ZTLOAD",9,0)
 I $G(ZTQUEUED)>.5,$D(^%ZTSCH("TASK",ZTQUEUED)) S ^%ZTSCH("TASK",ZTQUEUED,1)=$H
"RTN","ZTLOAD",10,0)
 N ZTSTOP S ZTSTOP=0
"RTN","ZTLOAD",11,0)
 I $G(ZTQUEUED)>.5,$L($P($G(^%ZTSK(ZTQUEUED,.1)),"^",10)) S ZTSTOP=1
"RTN","ZTLOAD",12,0)
 Q ZTSTOP
"RTN","ZTLOAD",13,0)
 ;
"RTN","ZTLOAD",14,0)
TM() ;Entry Point: extrinsic variable returns boolean: is TM running?
"RTN","ZTLOAD",15,0)
 N ZTH,ZTR S ZTH=$H,ZTR=$G(^%ZTSCH("RUN"))
"RTN","ZTLOAD",16,0)
 Q ZTH-ZTR*86400+$P(ZTH,",",2)-$P(ZTR,",",2)<500
"RTN","ZTLOAD",17,0)
 ;
"RTN","ZTLOAD",18,0)
REQ ;Entry Point: requeue a task (edit, reschedule)
"RTN","ZTLOAD",19,0)
 G ^%ZTLOAD3
"RTN","ZTLOAD",20,0)
 ;
"RTN","ZTLOAD",21,0)
KILL ;Entry Point: delete a task
"RTN","ZTLOAD",22,0)
 S ZTSK=$G(ZTSK)
"RTN","ZTLOAD",23,0)
 K ZTSK(0) S ZTSK(0)=0
"RTN","ZTLOAD",24,0)
 I ZTSK>1,$D(^%ZTSK(ZTSK)) D  L -^%ZTSK(ZTSK) ;could be done!
"RTN","ZTLOAD",25,0)
 . L +^%ZTSK(ZTSK):20 Q:'$T
"RTN","ZTLOAD",26,0)
 . ;Don't kill running persistent tasks.
"RTN","ZTLOAD",27,0)
 . I $D(^%ZTSCH("ZTSK",ZTSK,"P")) Q
"RTN","ZTLOAD",28,0)
 . K ^%ZTSK(ZTSK) S ZTSK(0)=1
"RTN","ZTLOAD",29,0)
 Q
"RTN","ZTLOAD",30,0)
 ;
"RTN","ZTLOAD",31,0)
ISQED ;Entry Point: return whether task is pending (scheduled or waiting)
"RTN","ZTLOAD",32,0)
 G ^%ZTLOAD4
"RTN","ZTLOAD",33,0)
 ;
"RTN","ZTLOAD",34,0)
STAT ;Entry Point: return status of a task
"RTN","ZTLOAD",35,0)
 G ^%ZTLOAD5
"RTN","ZTLOAD",36,0)
 ;
"RTN","ZTLOAD",37,0)
DQ ;Entry Point: dequeue a task (unschedule)
"RTN","ZTLOAD",38,0)
 G ^%ZTLOAD6
"RTN","ZTLOAD",39,0)
 ;
"RTN","ZTLOAD",40,0)
DESC(DESC,LST) ;Find tasks with description
"RTN","ZTLOAD",41,0)
 G DESC^%ZTLOAD5
"RTN","ZTLOAD",42,0)
 ;
"RTN","ZTLOAD",43,0)
RTN(RTN,LST) ;Find tasks that call this routine
"RTN","ZTLOAD",44,0)
 G RTN^%ZTLOAD5
"RTN","ZTLOAD",45,0)
 ;
"RTN","ZTLOAD",46,0)
OPTION(OPNM,LST) ;Find tasks for this OPTION.
"RTN","ZTLOAD",47,0)
 G OPTION^%ZTLOAD5
"RTN","ZTLOAD",48,0)
 ;
"RTN","ZTLOAD",49,0)
JOB(ZTM) ;Return the job # for a running task
"RTN","ZTLOAD",50,0)
 G JOB^%ZTLOAD5
"RTN","ZTLOAD",51,0)
 ;
"RTN","ZTLOAD",52,0)
ZTSAVE(%,%1) ;input variables in string delimited by ; to build ZTSAVE array
"RTN","ZTLOAD",53,0)
 N %2 K:$G(%1) ZTSAVE
"RTN","ZTLOAD",54,0)
 F %1=1:1 S %2=$P(%,";",%1) Q:%2=""  S ZTSAVE(%2)=""
"RTN","ZTLOAD",55,0)
 Q
"RTN","ZTLOAD",56,0)
 ;
"RTN","ZTLOAD",57,0)
PSET(ZTM) ;e.f. Set the persistents node
"RTN","ZTLOAD",58,0)
 D TN Q:'$D(^%ZTSCH("TASK",ZTM)) 0
"RTN","ZTLOAD",59,0)
 S ^%ZTSCH("TASK",ZTM,"P")=""
"RTN","ZTLOAD",60,0)
 Q 1
"RTN","ZTLOAD",61,0)
 ;
"RTN","ZTLOAD",62,0)
PCLEAR(ZTM) ;Clear the persistents node
"RTN","ZTLOAD",63,0)
 D TN Q:'$D(^%ZTSCH("TASK",ZTM))
"RTN","ZTLOAD",64,0)
 K ^%ZTSCH("TASK",ZTM,"P")
"RTN","ZTLOAD",65,0)
 Q
"RTN","ZTLOAD",66,0)
 ;
"RTN","ZTLOAD",67,0)
ASKSTOP(ZTSK) ;E.F. Ask a task to stop.
"RTN","ZTLOAD",68,0)
 G ASKSTOP^%ZTLOAD2
"RTN","ZTLOAD",69,0)
 Q
"RTN","ZTLOAD",70,0)
 ;
"RTN","ZTLOAD",71,0)
TN S ZTM=$S($G(ZTM)>0:ZTM,$G(ZTQUEUED)>.9:ZTQUEUED,$G(ZTSK)>0:ZTSK,1:0)
"RTN","ZTLOAD",72,0)
 Q
"RTN","ZTLOAD2")
0^3^B9439149
"RTN","ZTLOAD2",1,0)
%ZTLOAD2 ;SEA/RDS-TaskMan:  Queue, Part 2 ;10/19/2005  12:20
"RTN","ZTLOAD2",2,0)
 ;;8.0;KERNEL;**1,67,118,275,339**;Jul 10, 1995;Build 3
"RTN","ZTLOAD2",3,0)
 ;
"RTN","ZTLOAD2",4,0)
REJECT(MSG) ;GET--reject bad task
"RTN","ZTLOAD2",5,0)
 I '$D(ZTQUEUED) W !,"QUEUE INFORMATION MISSING - NOT QUEUED",!,MSG
"RTN","ZTLOAD2",6,0)
 G EXIT
"RTN","ZTLOAD2",7,0)
 ;
"RTN","ZTLOAD2",8,0)
BADDEV(MSG) ;GET--Reject task because of device issue.
"RTN","ZTLOAD2",9,0)
 I '$D(ZTQUEUED) W !,"Queueing not allowed to device -- NOT QUEUED",!,MSG
"RTN","ZTLOAD2",10,0)
EXIT S %ZTLOAD("ERROR")=MSG
"RTN","ZTLOAD2",11,0)
 Q
"RTN","ZTLOAD2",12,0)
 ;
"RTN","ZTLOAD2",13,0)
RESTRCT ;GET--flag tasks with output restricted from certain times; check.
"RTN","ZTLOAD2",14,0)
 I $D(ZTQUEUED) Q
"RTN","ZTLOAD2",15,0)
 S ZTNOGO=0
"RTN","ZTLOAD2",16,0)
 I ZTDTH="@" Q
"RTN","ZTLOAD2",17,0)
 I ZTDTH'?1.5N1","1.5N Q
"RTN","ZTLOAD2",18,0)
 S X=$$HTFM^%ZTLOAD7(ZTDTH) D ^XQ92 I X="" S ZTDTH="" W !,"Sorry--that time is restricted!",!,$C(7)
"RTN","ZTLOAD2",19,0)
 Q
"RTN","ZTLOAD2",20,0)
 ;
"RTN","ZTLOAD2",21,0)
ASK ;GET--ask for start time
"RTN","ZTLOAD2",22,0)
 N %DT,Y
"RTN","ZTLOAD2",23,0)
 I $D(ZTQUEUED) D:ZTDTH]""  Q
"RTN","ZTLOAD2",24,0)
 . S %DT="FRS",X=ZTDTH D ^%DT
"RTN","ZTLOAD2",25,0)
 . S ZTDTH=$$FMTH^%ZTLOAD7(+Y) I Y'>0 S ZTDTH=""
"RTN","ZTLOAD2",26,0)
 . Q
"RTN","ZTLOAD2",27,0)
 S ZTDTH="",%DT="AERSX",%DT("A")="Requested Start Time: ",%DT("B")="NOW",%DT(0)="NOW"
"RTN","ZTLOAD2",28,0)
 I $D(ZTNOGO) D  I X="" Q
"RTN","ZTLOAD2",29,0)
 . S Y=+XQY D NEXT^XQ92 I X="" W !,"Output is never allowed from this option!",$C(7),$C(7) Q
"RTN","ZTLOAD2",30,0)
 . S %DT("B")=$$FMTE^%ZTLOAD7(X),%DT="AERSX"
"RTN","ZTLOAD2",31,0)
 . Q
"RTN","ZTLOAD2",32,0)
 I $D(ZTNOGO),'$D(XQNOGO) W !,"Output from this option is restricted during certain times."
"RTN","ZTLOAD2",33,0)
 F ZT=0:0 D ^%DT Q:(Y<0)!'$D(ZTNOGO)  S ZT=Y,X=Y D ^XQ92 S Y=ZT Q:X]""  W !!,"That is a restricted time!",!,$C(7)
"RTN","ZTLOAD2",34,0)
 S:Y>0 ZTDTH=$$FMTH^%ZTLOAD7(+Y)
"RTN","ZTLOAD2",35,0)
 K %DT,%T,X5,ZT
"RTN","ZTLOAD2",36,0)
 Q
"RTN","ZTLOAD2",37,0)
 ;
"RTN","ZTLOAD2",38,0)
OPTION ;GET--get option data
"RTN","ZTLOAD2",39,0)
 S ZTA4=$G(ZTSAVE("XQY")) I 'ZTA4 S ZTA4=$G(XQY) I 'ZTA4 S ZTA4=""
"RTN","ZTLOAD2",40,0)
 S ZTA1="O" I 'ZTA4 S ZTA1="" Q
"RTN","ZTLOAD2",41,0)
 S ZTA5=$P($G(^DIC(19,ZTA4,0)),U)
"RTN","ZTLOAD2",42,0)
 Q
"RTN","ZTLOAD2",43,0)
 ;
"RTN","ZTLOAD2",44,0)
ZTKIL ;GET--convert forget time
"RTN","ZTLOAD2",45,0)
 S ZTKIL=$S(ZTKIL?5N:ZTKIL,ZTKIL?5N1","1.5N:ZTKIL,ZTKIL?7N.".".N:$$FMTH^%ZTLOAD7(ZTKIL),1:"")
"RTN","ZTLOAD2",46,0)
 Q
"RTN","ZTLOAD2",47,0)
 ;
"RTN","ZTLOAD2",48,0)
SPOOL ;DEVICE--for predefined ZTIO spool device, pick up IO("DOC") if missing
"RTN","ZTLOAD2",49,0)
 I $G(IO("DOC"))="" Q
"RTN","ZTLOAD2",50,0)
 I ZTIO[IO("DOC") Q
"RTN","ZTLOAD2",51,0)
 I $P(ZTIO,";",2)?.N D
"RTN","ZTLOAD2",52,0)
 .S ZTIO=$P(ZTIO,";")_";"_IO("DOC")_";"_$P(ZTIO,";",2,999)
"RTN","ZTLOAD2",53,0)
 E  I $P(ZTIO,";",2)?1.2A1"-"1.ANP,$P(ZTIO,";",3)?.N D
"RTN","ZTLOAD2",54,0)
 .S ZTIO=$P(ZTIO,";",1,2)_";"_IO("DOC")_";"_$P(ZTIO,";",3,999)
"RTN","ZTLOAD2",55,0)
 Q
"RTN","ZTLOAD2",56,0)
 ;
"RTN","ZTLOAD2",57,0)
ASKSTOP ;e.f. Called from ASKSTOP^%ZTLOAD
"RTN","ZTLOAD2",58,0)
 ;Ask a task to stop. Unschedule if not started.
"RTN","ZTLOAD2",59,0)
 N % S ZTSK=$G(ZTSK)
"RTN","ZTLOAD2",60,0)
 S %=$$AKS L -^%ZTSK(ZTSK)
"RTN","ZTLOAD2",61,0)
 Q %
"RTN","ZTLOAD2",62,0)
 ;
"RTN","ZTLOAD2",63,0)
AKS() ;
"RTN","ZTLOAD2",64,0)
 N ZT1,ZT2,ZTDTH,%ZTIO
"RTN","ZTLOAD2",65,0)
 L +^%ZTSK(ZTSK):10 I '$T Q "0^Busy"
"RTN","ZTLOAD2",66,0)
 S ZTSK(0)=$G(^%ZTSK(ZTSK,0)),ZTSK(.1)=$G(^(.1))
"RTN","ZTLOAD2",67,0)
 I ZTSK(0)="" Q "1^Task missing"
"RTN","ZTLOAD2",68,0)
 S $P(^%ZTSK(ZTSK,.1),U,10)=$S($D(ZTNAME)#2:ZTNAME,1:$G(DUZ,.5))
"RTN","ZTLOAD2",69,0)
 I +ZTSK(.1)=6 Q "1^Finished running"
"RTN","ZTLOAD2",70,0)
 I +ZTSK(.1)=5 Q "2^Asked to stop"
"RTN","ZTLOAD2",71,0)
 S ZTDTH=$$H3^%ZTM($P(ZTSK(0),U,6))
"RTN","ZTLOAD2",72,0)
 K ^%ZTSCH(ZTDTH,ZTSK) ;Remove from schedule
"RTN","ZTLOAD2",73,0)
 S %ZTIO=$O(^%ZTSK(ZTSK,.26,"")) I %ZTIO]"" D DQ^%ZTM4 ;Remove from device lists.
"RTN","ZTLOAD2",74,0)
 L -^%ZTSK(ZTSK)
"RTN","ZTLOAD2",75,0)
 Q "2^Unscheduled"
"RTN","ZTLOAD5")
0^2^B10393417
"RTN","ZTLOAD5",1,0)
%ZTLOAD5 ;SEA/RDS-TaskMan: P I: Task Status ;03/30/2004  17:00
"RTN","ZTLOAD5",2,0)
 ;;8.0;KERNEL;**49,339**;JUL 10, 1995;Build 3
"RTN","ZTLOAD5",3,0)
 ;
"RTN","ZTLOAD5",4,0)
INPUT ;check input parameters for error conditions
"RTN","ZTLOAD5",5,0)
 N %,ZT1,ZT2,ZT3
"RTN","ZTLOAD5",6,0)
 S:$D(ZTSK)[0 ZTSK=""
"RTN","ZTLOAD5",7,0)
 I $D(ZTSK)>1 S %=ZTSK K ZTSK S ZTSK=%
"RTN","ZTLOAD5",8,0)
 S ZTSK(0)=0,ZTSK(1)=0,ZTSK(2)="Undefined"
"RTN","ZTLOAD5",9,0)
 I ZTSK<1!('$D(^%ZTSK(ZTSK,0))) Q
"RTN","ZTLOAD5",10,0)
 L +^%ZTSK(ZTSK) D SEARCH L -^%ZTSK(ZTSK)
"RTN","ZTLOAD5",11,0)
 Q
"RTN","ZTLOAD5",12,0)
 ;
"RTN","ZTLOAD5",13,0)
SEARCH ;search ^%ZTSCH for task
"RTN","ZTLOAD5",14,0)
 I $D(^%ZTSCH("TASK",ZTSK))#2 S ZTSK(0)=1,ZTSK(1)=2,ZTSK(2)="Active: Running" Q
"RTN","ZTLOAD5",15,0)
 S ZT1=0 D  Q:ZTSK(0)  ;*339
"RTN","ZTLOAD5",16,0)
 . F  S ZT1=$O(^%ZTSCH(ZT1)) Q:ZT1'>0  I $D(^%ZTSCH(ZT1,ZTSK))#2 S ZTSK(0)=1,ZTSK(1)=1,ZTSK(2)="Active: Pending" Q
"RTN","ZTLOAD5",17,0)
 S ZT1="" D  Q:ZTSK(0)
"RTN","ZTLOAD5",18,0)
 . F  S ZT1=$O(^%ZTSCH("IO",ZT1)),ZT2="" Q:ZT1=""  D  Q:ZTSK(0)
"RTN","ZTLOAD5",19,0)
 . . F  S ZT2=$O(^%ZTSCH("IO",ZT1,ZT2)) Q:ZT2=""  I $D(^(ZT2,ZTSK))#2 S ZTSK(0)=1,ZTSK(1)=1,ZTSK(2)="Active: Pending" Q
"RTN","ZTLOAD5",20,0)
 S ZT1="" D  Q:ZTSK(0)
"RTN","ZTLOAD5",21,0)
 . F  S ZT1=$O(^%ZTSCH("JOB",ZT1)) Q:ZT1=""  I $D(^(ZT1,ZTSK))#2 S ZTSK(0)=1,ZTSK(1)=1,ZTSK(2)="Active: Pending" Q
"RTN","ZTLOAD5",22,0)
 S ZT1="" D  Q:ZTSK(0)
"RTN","ZTLOAD5",23,0)
 . F  S ZT1=$O(^%ZTSCH("LINK",ZT1)),ZT2="" Q:ZT1=""  D  Q:ZTSK(0)
"RTN","ZTLOAD5",24,0)
 . . F  S ZT2=$O(^%ZTSCH("LINK",ZT1,ZT2)) Q:ZT2=""  I $D(^(ZT2,ZTSK))#2 S ZTSK(0)=1,ZTSK(1)=1,ZTSK(2)="Active: Pending" Q
"RTN","ZTLOAD5",25,0)
 S ZT1=0 D  Q:ZTSK(0)  ;*339
"RTN","ZTLOAD5",26,0)
 . F  S ZT1=$O(^%ZTSCH("C",ZT1)) Q:ZT1'>0  I $D(^(ZT1,ZTSK)) S ZTSK(0)=1,ZTSK(2)="Active: Pending" Q
"RTN","ZTLOAD5",27,0)
 ;
"RTN","ZTLOAD5",28,0)
FLAG ;If we didn't find it in a list, use status flag
"RTN","ZTLOAD5",29,0)
 I $D(^%ZTSK(ZTSK,.1))[0 Q
"RTN","ZTLOAD5",30,0)
 S ZT=$P(^%ZTSK(ZTSK,.1),U),ZTSK(0)=1
"RTN","ZTLOAD5",31,0)
 I ZT=2!(ZT=4) S ZTSK(1)=1,ZTSK(2)="Active: Pending" Q
"RTN","ZTLOAD5",32,0)
 I ZT=6 S ZTSK(1)=3,ZTSK(2)="Inactive: Finished" Q
"RTN","ZTLOAD5",33,0)
 I ZT="H"!(ZT="K") S ZTSK(1)=4,ZTSK(2)="Inactive: Available" Q
"RTN","ZTLOAD5",34,0)
 S ZTSK(1)=5,ZTSK(2)="Inactive: Interrupted"
"RTN","ZTLOAD5",35,0)
 Q
"RTN","ZTLOAD5",36,0)
 ;
"RTN","ZTLOAD5",37,0)
DESC ;Find tasks with matching description.
"RTN","ZTLOAD5",38,0)
 ;From %ZTLOAD input param DESC,LST
"RTN","ZTLOAD5",39,0)
 Q:$G(DESC)=""
"RTN","ZTLOAD5",40,0)
 N ZTSK,X D ENV
"RTN","ZTLOAD5",41,0)
 S:'$D(LST) LST="^TMP($J)" S ZTSK=0
"RTN","ZTLOAD5",42,0)
 F  S ZTSK=$O(^%ZTSK(ZTSK)) Q:ZTSK'>0  S X=$G(^%ZTSK(ZTSK,0)) D
"RTN","ZTLOAD5",43,0)
 . Q:$$SKIP()
"RTN","ZTLOAD5",44,0)
 . I $G(^%ZTSK(ZTSK,.03))=DESC S @LST@(ZTSK)=""
"RTN","ZTLOAD5",45,0)
 . Q
"RTN","ZTLOAD5",46,0)
 Q
"RTN","ZTLOAD5",47,0)
RTN ;Find tasks with matching routines
"RTN","ZTLOAD5",48,0)
 ;From %ZTLOAD input param RTN,LST
"RTN","ZTLOAD5",49,0)
 Q:$G(RTN)=""
"RTN","ZTLOAD5",50,0)
 N ZTSK,X D ENV
"RTN","ZTLOAD5",51,0)
 S:'$D(LST) LST="^TMP($J)" S:RTN'["^" RTN="^"_RTN S ZTSK=0
"RTN","ZTLOAD5",52,0)
 F  S ZTSK=$O(^%ZTSK(ZTSK)) Q:ZTSK'>0  S X=$G(^%ZTSK(ZTSK,0)) D
"RTN","ZTLOAD5",53,0)
 . Q:$$SKIP()
"RTN","ZTLOAD5",54,0)
 . I $P(X,"^",1,2)=RTN S @LST@(ZTSK)="" Q
"RTN","ZTLOAD5",55,0)
 . I "^"_($P(X,"^",2))=RTN S @LST@(ZTSK)=""
"RTN","ZTLOAD5",56,0)
 . Q
"RTN","ZTLOAD5",57,0)
 Q
"RTN","ZTLOAD5",58,0)
OPTION ;Find tasks with matching option names
"RTN","ZTLOAD5",59,0)
 ;From %ZTLOAD input param OPNM, LST
"RTN","ZTLOAD5",60,0)
 Q:$G(OPNM)=""  N ZTSK,X,FLG D ENV
"RTN","ZTLOAD5",61,0)
 S:'$D(LST) LST="^TMP($J)" S ZTSK=0,FLG=(OPNM?1.N1"^"1A.ANP)
"RTN","ZTLOAD5",62,0)
 Q:'FLG&(OPNM'?1A.ANP)
"RTN","ZTLOAD5",63,0)
 F  S ZTSK=$O(^%ZTSK(ZTSK)) Q:ZTSK'>0  S X=$G(^%ZTSK(ZTSK,0)) D
"RTN","ZTLOAD5",64,0)
 . Q:$$SKIP()
"RTN","ZTLOAD5",65,0)
 . I FLG,$P(X,"^",8,9)=OPNM S @LST@(ZTSK)="" Q
"RTN","ZTLOAD5",66,0)
 . I $P(X,"^",1,2)="ZTSK^XQ1",$P(X,"^",9)=OPNM S @LST@(ZTSK)=""
"RTN","ZTLOAD5",67,0)
 . Q
"RTN","ZTLOAD5",68,0)
 Q
"RTN","ZTLOAD5",69,0)
SKIP() ;Screen on ZTKEY, UCI, DUZ, return: 0=OK, 1=Skip
"RTN","ZTLOAD5",70,0)
 Q:ZTKEY 0
"RTN","ZTLOAD5",71,0)
 Q:($P(X,U,11)_","_$P(X,U,12))'=ZTUCI 1
"RTN","ZTLOAD5",72,0)
 Q:$P(X,U,3)'=DUZ 1
"RTN","ZTLOAD5",73,0)
 Q 0
"RTN","ZTLOAD5",74,0)
ENV ;Setup
"RTN","ZTLOAD5",75,0)
 S ZTKEY=$D(^XUSEC("ZTMQ",DUZ)),U="^"
"RTN","ZTLOAD5",76,0)
 X ^%ZOSF("UCI") S ZTUCI=Y
"RTN","ZTLOAD5",77,0)
 Q
"RTN","ZTLOAD5",78,0)
 ;
"RTN","ZTLOAD5",79,0)
JOB ;Return JOB # for running task. Called from JOB^ZTLOAD (*339)
"RTN","ZTLOAD5",80,0)
 N Z1,Z2 S Z1=""
"RTN","ZTLOAD5",81,0)
 I $G(ZTM)>0 S Z2=$G(^%ZTSCH("TASK",ZTM)),Z1=$S($L(Z2):$P(Z2,"^",10),1:"")
"RTN","ZTLOAD5",82,0)
 Q Z1
"VER")
8.0^22.0
"BLD",809,6)
^319
**END**
**END**
