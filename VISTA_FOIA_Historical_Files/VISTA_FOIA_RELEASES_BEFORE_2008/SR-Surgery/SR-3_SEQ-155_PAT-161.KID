Released SR*3*161 SEQ #155
Extracted from mail message
**KIDS**:SR*3.0*161^

**INSTALL NAME**
SR*3.0*161
"BLD",7145,0)
SR*3.0*161^SURGERY^0^3070426^y
"BLD",7145,1,0)
^^27^27^3070417^
"BLD",7145,1,1,0)
This patch addresses the following problems:
"BLD",7145,1,2,0)
 
"BLD",7145,1,3,0)
1.  HD136616  SROPCEP  Primary and Secondary Provider incorrect from 
"BLD",7145,1,4,0)
Surgery pkg
"BLD",7145,1,5,0)
The information  passed from the surgical package to PCE when received in 
"BLD",7145,1,6,0)
PCE the 
"BLD",7145,1,7,0)
SURGEON is listed as the PRIAMRY PROVIDER and the ATTENDING is listed as 
"BLD",7145,1,8,0)
the 
"BLD",7145,1,9,0)
SECONDARY PROVIDER.  Claims are being rejected if the PRIMARY PROVIDER is 
"BLD",7145,1,10,0)
a RESIDNET
"BLD",7145,1,11,0)
 
"BLD",7145,1,12,0)
2.  HD175983   SROCON   Error - <UNDEFINED>HELP+1^SROCON
"BLD",7145,1,13,0)
When entering Anesthesia data for a surgical case, ^SROCON routine errors 
"BLD",7145,1,14,0)
at the
"BLD",7145,1,15,0)
"Do you want to store this information in the concurrent case ?  YES//" 
"BLD",7145,1,16,0)
prompt if 
"BLD",7145,1,17,0)
a "?" is entered and concurrent cases exist.
"BLD",7145,1,18,0)
 
"BLD",7145,1,19,0)
3.  HD177449  SROREQ4   UNDEF ERROR
"BLD",7145,1,20,0)
When running the : Operation Requests for a Day  [SROP REQ] option the 
"BLD",7145,1,21,0)
report 
"BLD",7145,1,22,0)
generates an error <UNDEFINED>PRINT+2^SROREQ4
"BLD",7145,1,23,0)
 S S(0)=^SRF(SRTN,0),DFN=$P(S(0),"^"),CNT=CNT+1
"BLD",7145,1,24,0)
 
"BLD",7145,1,25,0)
4.  HD153358  SROCDX1   Error - <UNDEFINED>PADD1+4^SROCDX1
"BLD",7145,1,26,0)
An <UNDEFINDED> error was encountered when trying to verify some ICD-9 
"BLD",7145,1,27,0)
codes or Procedure codes.
"BLD",7145,4,0)
^9.64PA^^
"BLD",7145,6.3)
5
"BLD",7145,"ABPKG")
n
"BLD",7145,"KRN",0)
^9.67PA^8989.52^19
"BLD",7145,"KRN",.4,0)
.4
"BLD",7145,"KRN",.401,0)
.401
"BLD",7145,"KRN",.402,0)
.402
"BLD",7145,"KRN",.403,0)
.403
"BLD",7145,"KRN",.5,0)
.5
"BLD",7145,"KRN",.84,0)
.84
"BLD",7145,"KRN",3.6,0)
3.6
"BLD",7145,"KRN",3.8,0)
3.8
"BLD",7145,"KRN",9.2,0)
9.2
"BLD",7145,"KRN",9.8,0)
9.8
"BLD",7145,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",7145,"KRN",9.8,"NM",1,0)
SROPCEP^^0^B80453673
"BLD",7145,"KRN",9.8,"NM",2,0)
SROCON^^0^B9881406
"BLD",7145,"KRN",9.8,"NM",3,0)
SROREQ4^^0^B16096256
"BLD",7145,"KRN",9.8,"NM",4,0)
SROCDX1^^0^B25247822
"BLD",7145,"KRN",9.8,"NM","B","SROCDX1",4)

"BLD",7145,"KRN",9.8,"NM","B","SROCON",2)

"BLD",7145,"KRN",9.8,"NM","B","SROPCEP",1)

"BLD",7145,"KRN",9.8,"NM","B","SROREQ4",3)

"BLD",7145,"KRN",19,0)
19
"BLD",7145,"KRN",19.1,0)
19.1
"BLD",7145,"KRN",101,0)
101
"BLD",7145,"KRN",409.61,0)
409.61
"BLD",7145,"KRN",771,0)
771
"BLD",7145,"KRN",870,0)
870
"BLD",7145,"KRN",8989.51,0)
8989.51
"BLD",7145,"KRN",8989.52,0)
8989.52
"BLD",7145,"KRN",8994,0)
8994
"BLD",7145,"KRN","B",.4,.4)

"BLD",7145,"KRN","B",.401,.401)

"BLD",7145,"KRN","B",.402,.402)

"BLD",7145,"KRN","B",.403,.403)

"BLD",7145,"KRN","B",.5,.5)

"BLD",7145,"KRN","B",.84,.84)

"BLD",7145,"KRN","B",3.6,3.6)

"BLD",7145,"KRN","B",3.8,3.8)

"BLD",7145,"KRN","B",9.2,9.2)

"BLD",7145,"KRN","B",9.8,9.8)

"BLD",7145,"KRN","B",19,19)

"BLD",7145,"KRN","B",19.1,19.1)

"BLD",7145,"KRN","B",101,101)

"BLD",7145,"KRN","B",409.61,409.61)

"BLD",7145,"KRN","B",771,771)

"BLD",7145,"KRN","B",870,870)

"BLD",7145,"KRN","B",8989.51,8989.51)

"BLD",7145,"KRN","B",8989.52,8989.52)

"BLD",7145,"KRN","B",8994,8994)

"BLD",7145,"QUES",0)
^9.62^^
"BLD",7145,"REQB",0)
^9.611^4^4
"BLD",7145,"REQB",1,0)
SR*3.0*92^1
"BLD",7145,"REQB",2,0)
SR*3.0*119^1
"BLD",7145,"REQB",3,0)
SR*3.0*144^1
"BLD",7145,"REQB",4,0)
SR*3.0*142^1
"BLD",7145,"REQB","B","SR*3.0*119",2)

"BLD",7145,"REQB","B","SR*3.0*142",4)

"BLD",7145,"REQB","B","SR*3.0*144",3)

"BLD",7145,"REQB","B","SR*3.0*92",1)

"MBREQ")
0
"PKG",308,-1)
1^1
"PKG",308,0)
SURGERY^SR^SURGICAL DATA COLLECTION AND OPERATIONS SCHEDULING
"PKG",308,20,0)
^9.402P^^
"PKG",308,22,0)
^9.49I^1^1
"PKG",308,22,1,0)
3.0^2930624^2940818
"PKG",308,22,1,"PAH",1,0)
161^3070426
"PKG",308,22,1,"PAH",1,1,0)
^^27^27^3070426
"PKG",308,22,1,"PAH",1,1,1,0)
This patch addresses the following problems:
"PKG",308,22,1,"PAH",1,1,2,0)
 
"PKG",308,22,1,"PAH",1,1,3,0)
1.  HD136616  SROPCEP  Primary and Secondary Provider incorrect from 
"PKG",308,22,1,"PAH",1,1,4,0)
Surgery pkg
"PKG",308,22,1,"PAH",1,1,5,0)
The information  passed from the surgical package to PCE when received in 
"PKG",308,22,1,"PAH",1,1,6,0)
PCE the 
"PKG",308,22,1,"PAH",1,1,7,0)
SURGEON is listed as the PRIAMRY PROVIDER and the ATTENDING is listed as 
"PKG",308,22,1,"PAH",1,1,8,0)
the 
"PKG",308,22,1,"PAH",1,1,9,0)
SECONDARY PROVIDER.  Claims are being rejected if the PRIMARY PROVIDER is 
"PKG",308,22,1,"PAH",1,1,10,0)
a RESIDNET
"PKG",308,22,1,"PAH",1,1,11,0)
 
"PKG",308,22,1,"PAH",1,1,12,0)
2.  HD175983   SROCON   Error - <UNDEFINED>HELP+1^SROCON
"PKG",308,22,1,"PAH",1,1,13,0)
When entering Anesthesia data for a surgical case, ^SROCON routine errors 
"PKG",308,22,1,"PAH",1,1,14,0)
at the
"PKG",308,22,1,"PAH",1,1,15,0)
"Do you want to store this information in the concurrent case ?  YES//" 
"PKG",308,22,1,"PAH",1,1,16,0)
prompt if 
"PKG",308,22,1,"PAH",1,1,17,0)
a "?" is entered and concurrent cases exist.
"PKG",308,22,1,"PAH",1,1,18,0)
 
"PKG",308,22,1,"PAH",1,1,19,0)
3.  HD177449  SROREQ4   UNDEF ERROR
"PKG",308,22,1,"PAH",1,1,20,0)
When running the : Operation Requests for a Day  [SROP REQ] option the 
"PKG",308,22,1,"PAH",1,1,21,0)
report 
"PKG",308,22,1,"PAH",1,1,22,0)
generates an error <UNDEFINED>PRINT+2^SROREQ4
"PKG",308,22,1,"PAH",1,1,23,0)
 S S(0)=^SRF(SRTN,0),DFN=$P(S(0),"^"),CNT=CNT+1
"PKG",308,22,1,"PAH",1,1,24,0)
 
"PKG",308,22,1,"PAH",1,1,25,0)
4.  HD153358  SROCDX1   Error - <UNDEFINED>PADD1+4^SROCDX1
"PKG",308,22,1,"PAH",1,1,26,0)
An <UNDEFINDED> error was encountered when trying to verify some ICD-9 
"PKG",308,22,1,"PAH",1,1,27,0)
codes or Procedure codes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SROCDX1")
0^4^B25247822^B25057274
"RTN","SROCDX1",1,0)
SROCDX1 ;BIR/ADM,BAJ - ASSOCIATED DIAGNOSIS FOR CODER SCREENS ; 4/17/07 11:04am
"RTN","SROCDX1",2,0)
 ;;3.0; Surgery ;**142,161**;24 Jun 93;Build 5
"RTN","SROCDX1",3,0)
OTHADX ;Display ASDX for OTHER PROCS
"RTN","SROCDX1",4,0)
 N SRTMP,SRASSD,SROICD
"RTN","SROCDX1",5,0)
 S SRPADX=0,SROCNTR=1 F SRI=1:1 S SRPADX=$O(^SRO(136,SRTN,3,OTH,2,SRPADX)) Q:'SRPADX  D
"RTN","SROCDX1",6,0)
 .S SRICD9=^SRO(136,SRTN,3,OTH,2,SRPADX,0)
"RTN","SROCDX1",7,0)
 .S:SRICD9 SROICD=$$ICDSTR
"RTN","SROCDX1",8,0)
 .S SRTMP(SRI)=SROICD,SROCNTR=SROCNTR+1
"RTN","SROCDX1",9,0)
 S SROCNTR=0
"RTN","SROCDX1",10,0)
 D ADXDISP I '$O(^SRO(136,SRTN,3,OTH,2,0)) W "NOT ENTERED",!
"RTN","SROCDX1",11,0)
 D PASSDIAG,ASSDIAG
"RTN","SROCDX1",12,0)
 Q
"RTN","SROCDX1",13,0)
ASDX ;Display ASDX for PRIN Procs
"RTN","SROCDX1",14,0)
 N SRI,SRFIRST,SRICD9,SRPRIN,SRPADX,SRASSD K SRTMP
"RTN","SROCDX1",15,0)
 S SRI=0,SRFIRST=1 F  S SRI=$O(^SRO(136,SRTN,1,SRI)) Q:'SRI  S SRM=$P(^SRO(136,SRTN,1,SRI,0),U)
"RTN","SROCDX1",16,0)
 S SRPADX=0,SROCNTR=2 F SRI=1:1 S SRPADX=$O(^SRO(136,SRTN,2,SRPADX)) Q:'SRPADX  D
"RTN","SROCDX1",17,0)
 .S SRICD9=^SRO(136,SRTN,2,SRPADX,0)
"RTN","SROCDX1",18,0)
 .S:SRICD9 SROICD=$$ICDSTR
"RTN","SROCDX1",19,0)
 .S SRTMP(SRI)=SROICD,SROCNTR=SROCNTR+1
"RTN","SROCDX1",20,0)
 D ADXDISP I '$O(^SRO(136,SRTN,2,0)) W !,?5,SRMSG
"RTN","SROCDX1",21,0)
 D PASSDIAG,ASSDIAG
"RTN","SROCDX1",22,0)
 Q
"RTN","SROCDX1",23,0)
AASDX S SROICD=""
"RTN","SROCDX1",24,0)
 S:SRASSD SRICD9=$P($G(^SRO(136,SRTN,4,SRASSD,0)),U)
"RTN","SROCDX1",25,0)
 S:'SRASSD SRICD9=$P($G(^SRO(136,SRTN,0)),U,3)
"RTN","SROCDX1",26,0)
 S:SRICD9 SROICD=$$ICDSTR
"RTN","SROCDX1",27,0)
 Q
"RTN","SROCDX1",28,0)
PASSDIAG N ADCNT,SRICD9,SRFLG,SRCNTR,SRASSD  ;List PRIN DX to assoc.
"RTN","SROCDX1",29,0)
 K SRADX,SRDIRX,SRADIAG S SRICD9=$P($G(^SRO(136,SRTN,0)),U,3)
"RTN","SROCDX1",30,0)
 I SRICD9'="" S SRDIRX(1)=$$ICDSTR,SRADX(1)=$P(^ICD9(SRICD9,0),U,1),SRADIAG(1)=$P($G(^SRO(136,SRTN,0)),U,3)
"RTN","SROCDX1",31,0)
 I SRICD9="" S SRDIRX(1)="",SRADIAG(1)=""
"RTN","SROCDX1",32,0)
 Q
"RTN","SROCDX1",33,0)
ASSDIAG N SRDCNT,SRADCNT,SRQ ;DXs for assoc.
"RTN","SROCDX1",34,0)
 S (ADCNT,SRASSD)=0 S SRCNT=$S($G(SRDIRX(1))'="":1,1:0)
"RTN","SROCDX1",35,0)
 F  S ADCNT=$O(^SRO(136,SRTN,4,ADCNT)) Q:ADCNT=""  D
"RTN","SROCDX1",36,0)
 .S SRICD9=$P(^SRO(136,SRTN,4,ADCNT,0),U)
"RTN","SROCDX1",37,0)
 .S:SRICD9'="" SRCNT=SRCNT+1,SRDIRX(SRCNT)=$$ICDSTR,SRADX(SRCNT)=$P(^ICD9(SRICD9,0),U,1)
"RTN","SROCDX1",38,0)
 .S:SRICD9="" SRDIRX(SRCNT)=$P(^SRO(136,SRTN,4,ADCNT,0),U)
"RTN","SROCDX1",39,0)
 .S SRADIAG(SRCNT)=$P(^SRO(136,SRTN,4,ADCNT,0),U)
"RTN","SROCDX1",40,0)
 ;modified to use 1 as lower limit, SRCNT as upper (SRO*3.0*161)
"RTN","SROCDX1",41,0)
 S:$D(SRDIRX) SRDX2="LO^1:"_SRCNT
"RTN","SROCDX1",42,0)
 Q
"RTN","SROCDX1",43,0)
SRDIAGS() N SRDIAGS,SRDGCNT
"RTN","SROCDX1",44,0)
 S (SRDIAGS,SRDGCNT)=0 S:$D(^SRF(SRTN,34)) SRDIAGS=1
"RTN","SROCDX1",45,0)
 F I=1:1 S SRDGCNT=$O(^SRF(SRTN,15,SRDGCNT)) Q:SRDGCNT=""  S SRDIAGS=SRDIAGS+1
"RTN","SROCDX1",46,0)
 Q SRDIAGS
"RTN","SROCDX1",47,0)
ICDSTR() N SRICDSTR
"RTN","SROCDX1",48,0)
 S SRICDSTR=$P($$ICDDX^ICDCODE(SRICD9,SRSDATE),U,2)_"-"_$P($$ICDDX^ICDCODE(SRICD9,SRSDATE),U,4)
"RTN","SROCDX1",49,0)
 Q SRICDSTR
"RTN","SROCDX1",50,0)
PASSDS() N SRDX,SRI,SRJ,SRPADX,SRASSDS,SRPX
"RTN","SROCDX1",51,0)
 S SRASSDS="",SRPADX=0 F  S SRPADX=$O(^SRO(136,SRTN,2,SRPADX)) Q:'SRPADX  D
"RTN","SROCDX1",52,0)
 .S SRDX=$P(^SRO(136,SRTN,2,SRPADX,0),"^")
"RTN","SROCDX1",53,0)
 .S SRJ=0 F  S SRJ=$O(SRADIAG(SRJ)) Q:'SRJ  I SRADIAG(SRJ)=SRDX S SRPX=SRJ Q
"RTN","SROCDX1",54,0)
 .S SRASSDS=$S($L(SRASSDS)<1:SRPX,1:SRASSDS_","_SRPX)
"RTN","SROCDX1",55,0)
 Q SRASSDS
"RTN","SROCDX1",56,0)
OASSDS() N SRDX,SRI,SRJ,SRPADX,SRASSDS,SRPX
"RTN","SROCDX1",57,0)
 S SRASSDS="",SRPADX=0 F  S SRPADX=$O(^SRO(136,SRTN,3,SRPOTH,2,SRPADX)) Q:'SRPADX  D
"RTN","SROCDX1",58,0)
 .S SRDX=$P(^SRO(136,SRTN,3,SRPOTH,2,SRPADX,0),"^")
"RTN","SROCDX1",59,0)
 .S SRJ=0 F  S SRJ=$O(SRADIAG(SRJ)) Q:'SRJ  I SRADIAG(SRJ)=SRDX S SRPX=SRJ Q
"RTN","SROCDX1",60,0)
 .S SRASSDS=$S($L(SRASSDS)<1:SRPX,1:SRASSDS_","_SRPX)
"RTN","SROCDX1",61,0)
 Q SRASSDS
"RTN","SROCDX1",62,0)
OTHADXD N SRCOMMA,SROADX,SRICD9,SROADX1,SROODX,SRASSD,SRSUB ;OTHER PROCS ADXs
"RTN","SROCDX1",63,0)
 I '$O(^SRO(136,SRTN,3,OTH,2,0)) W !,?5,SRMSG Q
"RTN","SROCDX1",64,0)
 S SRSUB=1 D OTHADX
"RTN","SROCDX1",65,0)
 Q
"RTN","SROCDX1",66,0)
PADXD N SRCOMMA,SRPADX,SRICD9,SRPDX,SRPDX1,SROPRIN,SRSUB
"RTN","SROCDX1",67,0)
 S SRPADX=0,SROCNTR=2,SRSUB=1
"RTN","SROCDX1",68,0)
 I '$O(^SRO(136,SRTN,2,0)),$P(^SRO(136,SRTN,0),U,3) D
"RTN","SROCDX1",69,0)
 .S SRASSD=$P(^SRO(136,SRTN,0),U,3),SRFDA="136.02",SRIENU="+1"_","_SRTN_",",SRIENF=0_","_SRTN_"," D UPDATE,FILE
"RTN","SROCDX1",70,0)
 D ASDX
"RTN","SROCDX1",71,0)
 Q
"RTN","SROCDX1",72,0)
ADXDISP N SROCNTR ;ADXS for PROC
"RTN","SROCDX1",73,0)
 W !,?5,"Assoc. DX: " N SRFIRST
"RTN","SROCDX1",74,0)
 S (SROCNTR,SRDXCNT)=0,SRFIRST=1
"RTN","SROCDX1",75,0)
 F I=1:1  S SROCNTR=$O(SRTMP(SROCNTR)) Q:'SROCNTR  D
"RTN","SROCDX1",76,0)
 .I $D(SRSUB) D
"RTN","SROCDX1",77,0)
 ..W:'(I#2) ?48 W:I#2 ?16 W $E(SRTMP(SROCNTR),1,28)
"RTN","SROCDX1",78,0)
 ..I '(I#2),($O(SRTMP(SROCNTR))) W !
"RTN","SROCDX1",79,0)
 .I '$D(SRSUB) W:'SRFIRST ! W ?16,$E(SRTMP(SROCNTR),1,28) S SRFIRST=0
"RTN","SROCDX1",80,0)
 S SRDXCNT=I,SRDX1="LO^:"_SRDXCNT S:SRDXCNT>0 SRDX1="LO^:"_SRDXCNT
"RTN","SROCDX1",81,0)
 Q
"RTN","SROCDX1",82,0)
PADD1 ;PRIN ADX
"RTN","SROCDX1",83,0)
 N SRY,SRY0,SRY1,SRY2,SRC,REC,DIE,DA,DR,SRASSD
"RTN","SROCDX1",84,0)
 S SRY(0)=Y(0)
"RTN","SROCDX1",85,0)
 D KPADX^SROCDX2(SRTN)
"RTN","SROCDX1",86,0)
 S SRCNTR=0,SRASSD=SRADIAG($P(SRY(0),",",1)),SRFDA="136.02",SRIENU="+1"_","_SRTN_",",SRIENF=SRCNTR_","_SRTN_"," D UPDATE,FILE
"RTN","SROCDX1",87,0)
 S SRY(0)=$E(SRY(0),2,$L(SRY(0)))
"RTN","SROCDX1",88,0)
 F SRY2=1:1:$P(SRDX2,":",2) D
"RTN","SROCDX1",89,0)
 .S SRY0=$P(SRY(0),",",SRY2)
"RTN","SROCDX1",90,0)
 .Q:SRY0<1
"RTN","SROCDX1",91,0)
 .S SRCNTR=$P(^SRO(136,SRTN,2,0),U,3)+1,SRASSD=SRADIAG(SRY0),SRFDA="136.02",SRIENU="+1"_","_SRTN_",",SRIENF=SRCNTR_","_SRTN_"," D UPDATE,FILE
"RTN","SROCDX1",92,0)
 S Y(0)=SRY(0)
"RTN","SROCDX1",93,0)
 Q
"RTN","SROCDX1",94,0)
OADD1 N SRY,SRY0,SRY1,SRY2,SRCNTR,SRASSD ;Associate 1 Diagnosis to OTHER Procedure
"RTN","SROCDX1",95,0)
 S SRY(0)=Y(0),SRCNTR=0
"RTN","SROCDX1",96,0)
 S:$D(^SRO(136,SRTN,3,OTH,2)) SRCNTR=$P(^SRO(136,SRTN,3,OTH,2,0),U,3)+1
"RTN","SROCDX1",97,0)
 D KOADX^SROCDX2(SRTN,OTH)
"RTN","SROCDX1",98,0)
 S:'$D(^SRO(136,SRTN,3,OTH,2)) SRCNTR=1
"RTN","SROCDX1",99,0)
 S SRFDA="136.32",SRIENU="+1"_","_OTH_","_SRTN_","
"RTN","SROCDX1",100,0)
 F SRY2=1:1:$P(SRDX2,":",2) D
"RTN","SROCDX1",101,0)
 .S SRY0=$P(SRY(0),",",SRY2)
"RTN","SROCDX1",102,0)
 .Q:'SRY0
"RTN","SROCDX1",103,0)
 .S SRASSD=SRADIAG(SRY0),SRIENF=SRCNTR_","_OTH_","_SRTN_"," K SRY1 D UPDATE,FILE
"RTN","SROCDX1",104,0)
 .S SRCNTR=SRCNTR+1
"RTN","SROCDX1",105,0)
 S Y(0)=SRY(0)
"RTN","SROCDX1",106,0)
 Q
"RTN","SROCDX1",107,0)
UPDATE ;
"RTN","SROCDX1",108,0)
 S SRY1(SRFDA,SRIENU,".01")=SRASSD
"RTN","SROCDX1",109,0)
 D UPDATE^DIE("","SRY1")
"RTN","SROCDX1",110,0)
 Q
"RTN","SROCDX1",111,0)
FILE ;
"RTN","SROCDX1",112,0)
 S SRY1(SRFDA,SRIENF,".01")=SRASSD D FILE^DIE("","SRY1") K SRY1
"RTN","SROCDX1",113,0)
 Q
"RTN","SROCDX1",114,0)
CONT N DIR S DIR(0)="FO^",DIR("A")="Press RETURN to continue  " D ^DIR
"RTN","SROCDX1",115,0)
 Q
"RTN","SROCON")
0^2^B9881406^B9792980
"RTN","SROCON",1,0)
SROCON ;B'HAM ISC/MAM - STUFF ENTRY IN CONCURRENT CASE ;23 AUG 1990  9:15 AM
"RTN","SROCON",2,0)
 ;;3.0;Surgery;**78,119,161**;24 Jun 93;Build 5
"RTN","SROCON",3,0)
 I $D(SRNOCON),SRNOCON=1 Q
"RTN","SROCON",4,0)
 I $D(SRFLAG) S SRCON=$P(^SRF(DA(1),"CON"),"^")
"RTN","SROCON",5,0)
 I '$D(SRFLAG) S SRCON=$P(^SRF(DA,"CON"),"^")
"RTN","SROCON",6,0)
ASK W !!,"Do you want to store this information in the concurrent case ?  YES//  " R SRYN:DTIME I '$T!(SRYN["^") S SRYN="N" Q
"RTN","SROCON",7,0)
 S:SRYN="" SRYN="Y" S SRYN=$E(SRYN) I "YyNn"'[SRYN D HELP G ASK
"RTN","SROCON",8,0)
 I "Yy"'[SRYN W ! Q
"RTN","SROCON",9,0)
STUFF ; concatonate field to SRODR
"RTN","SROCON",10,0)
 W ! I $G(SRFLAG)=1 S SRODR(130.213,DA(2)_","_SRCON_",",SRFLD)=X K SRFLAG Q
"RTN","SROCON",11,0)
 S SRODR(130,SRCON_",",SRFLD)=X
"RTN","SROCON",12,0)
 Q
"RTN","SROCON",13,0)
HELP ;
"RTN","SROCON",14,0)
 S SRMX=X W @IOF S DFN=$P(^SRF(SRTN,0),"^") D DEM^VADPT S X=SRMX  ;; < RJS *161 >
"RTN","SROCON",15,0)
 W !!,"There is a concurrent surgical case associated with this procedure.  A brief",!,"description of that case is listed below."
"RTN","SROCON",16,0)
 S SROPER=$P(^SRF(SRCON,"OP"),"^") I $O(^SRF(SRCON,13,0)) S SROTHER=0 F I=0:0 S SROTHER=$O(^SRF(SRCON,13,SROTHER)) Q:'SROTHER  D OTHER
"RTN","SROCON",17,0)
 K SROPS,MM,MMM S:$L(SROPER)<65 SROPS(1)=SROPER I $L(SROPER)>64 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROCON",18,0)
 S SRSUR=$S($D(^SRF(SRCON,.1)):$P(^(.1),"^",4),1:"") S:'SRSUR SRSUR="NOT ENTERED" S:SRSUR SRSUR=$P(^VA(200,SRSUR,0),"^")
"RTN","SROCON",19,0)
 S SRSS=$P(^SRF(SRCON,0),"^",4) S:'SRSS SRSS="NOT ENTERED" S:SRSS SRSS=$P(^SRO(137.45,SRSS,0),"^")
"RTN","SROCON",20,0)
 W !!,"Surgeon: "_SRSUR,!,"Surgical Specialty: "_SRSS,!!,"Procedure: ",?12,SROPS(1) I $D(SROPS(2)) W !,?12,SROPS(2) I $D(SROPS(3)) W !,?12,SROPS(3) I $D(SROPS(4)) W !,?12,SROPS(4)
"RTN","SROCON",21,0)
 W !!,"If you answer 'YES', the information you entered for this field will also",!,"be stored for the concurrent case.  If this information is not pertinent for",!,"the concurrent case, enter 'NO'.",!!
"RTN","SROCON",22,0)
 Q
"RTN","SROCON",23,0)
OTHER ; other operations
"RTN","SROCON",24,0)
 S SRLONG=1 I $L(SROPER)+$L($P(^SRF(SRCON,13,SROTHER,0),"^"))>235 S SRLONG=0,SROTHER=999,SROPERS=" ..."
"RTN","SROCON",25,0)
 I SRLONG S SROPERS=$P(^SRF(SRCON,13,SROTHER,0),"^")
"RTN","SROCON",26,0)
 S SROPER=SROPER_$S(SROPERS=" ...":SROPERS,1:", "_SROPERS)
"RTN","SROCON",27,0)
 Q
"RTN","SROCON",28,0)
LOOP ; break procedure
"RTN","SROCON",29,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<65  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROCON",30,0)
 Q
"RTN","SROPCEP")
0^1^B80453673^B79067516
"RTN","SROPCEP",1,0)
SROPCEP ;BIR/TJH - PCE UPDATES ;04/26/05  9:28 AM
"RTN","SROPCEP",2,0)
 ;;3.0; Surgery ;**142,152,144,161**;24 Jun 93;Build 5
"RTN","SROPCEP",3,0)
 ;
"RTN","SROPCEP",4,0)
 ; Reference to $$DATA2PCE^PXAPI supported by DBIA #1889
"RTN","SROPCEP",5,0)
 ; Reference to $$DELVFILE^PXAPI supported by DBIA #1890
"RTN","SROPCEP",6,0)
 ; Reference to ^DIC(45.3 is supported by DBIA #218
"RTN","SROPCEP",7,0)
 ;
"RTN","SROPCEP",8,0)
 Q
"RTN","SROPCEP",9,0)
START ; entry for update to PCE with surgery & non-OR procedure data
"RTN","SROPCEP",10,0)
 I '$D(SRTN) S SRTN=$G(DA)
"RTN","SROPCEP",11,0)
 I SRTN="" Q
"RTN","SROPCEP",12,0)
 N DFN,SR,SRAO,SRATT,SRCHK,SRCPT,SRDATE,SRDIAG,SREC,SRHNC,SRIR,SRCV,SRPRJ,SRK,SRLOC,SRMST,SRNON,SROTH,SRPKG,SRPROV,SRS,SRSC,SRV,SRVSIT,SRX,SRX2
"RTN","SROPCEP",13,0)
 N SRPLSC,SRPLAO,SRPLIR,SRPLEC,SRPLMST,SRPLHNC,SRPLCV,SRPLPRJ,SRADX,SRCNT,SRD,SRDX,SRRPROV,SRUP,SRINOUT,SRO,SRDEPC,SRPFSSAR
"RTN","SROPCEP",14,0)
 N SRDP,SRDC,SRDI,SRDL,SRDIE,SRDG,SRDM,SRDR,SRDH,SRDK,SRDA,SRD0,SRDDER,SRDG,SRDIC,SRDIC1,SRDICRRE,SRDIEDA,SRDIG,SRDIH,SRDIIENS,SRDISL,SRDISYS,SRDIU,SRDIV,SRDIWT,SRDN,SRDQ,SRDX,SRDY
"RTN","SROPCEP",15,0)
 D FM1 K DIC S DIC=9.4,DIC(0)="XM",X="SURGERY" D ^DIC K DIC D FM2 Q:Y=-1  S SRPKG=+Y
"RTN","SROPCEP",16,0)
 S SRS="SURGERY DATA" K ^TMP("SRPXAPI",$J)
"RTN","SROPCEP",17,0)
 D UTIL I 'SRK D PCE
"RTN","SROPCEP",18,0)
 Q
"RTN","SROPCEP",19,0)
DEL ; delete data from the Visit file and V files
"RTN","SROPCEP",20,0)
 D FM1 K DA,DIE,DR S DA=SRTN,DIE=130,DR=".015///@" D ^DIE K DA,DIE,DR D FM2
"RTN","SROPCEP",21,0)
 D FM1 S SRV=$$DELVFILE^PXAPI("ALL",SRVSIT) K SRVSIT D FM2
"RTN","SROPCEP",22,0)
 Q
"RTN","SROPCEP",23,0)
UTIL ; set procedure variables
"RTN","SROPCEP",24,0)
 N SRDIV,SRSITE,SRSR
"RTN","SROPCEP",25,0)
 S SRSR="",SRK=0,SRDIV=$P($G(^SRF(SRTN,8)),"^") I SRDIV S SRSITE=$O(^SRO(133,"B",SRDIV,0)),X=^SRO(133,SRSITE,0),SRUP=$P(X,"^",15),SRSR=$P(X,"^",19) I SRUP=""!(SRUP="N") S SRK=1 Q
"RTN","SROPCEP",26,0)
 S SRX=$P($G(^SRF(SRTN,0)),"^",15) I SRX S SRVSIT=SRX D DEL I '$D(^SRF(SRTN,0)) S SRK=1 Q
"RTN","SROPCEP",27,0)
 S SR(0)=$G(^SRF(SRTN,0)) I SR(0)=""!$P($G(^SRF(SRTN,30)),"^") S SRK=1 Q
"RTN","SROPCEP",28,0)
 S DFN=$P(SR(0),"^")
"RTN","SROPCEP",29,0)
 S SRNON=$S($P($G(^SRF(SRTN,"NON")),"^")="Y":1,1:0),SRCPT=$P($G(^SRO(136,SRTN,0)),"^",2) I 'SRCPT S SRK=1 Q
"RTN","SROPCEP",30,0)
 Q:SRK  S SRDIAG=$P($G(^SRO(136,SRTN,0)),"^",3) I 'SRDIAG S SRK=1 Q
"RTN","SROPCEP",31,0)
 I 'SRNON D  I SRK Q
"RTN","SROPCEP",32,0)
 .S SRX=$P(SR(0),"^",21) I SRX S SRLOC=SRX
"RTN","SROPCEP",33,0)
 .I 'SRX S SRX=$P(^SRO(137.45,$P(SR(0),"^",4),0),"^",5) I SRX S SRLOC=SRX
"RTN","SROPCEP",34,0)
 .I 'SRX S SRX=$P(SR(0),"^",2) S:SRX SRLOC=$P(^SRS(SRX,0),"^") I 'SRX S SRK=1 Q
"RTN","SROPCEP",35,0)
 .S SRX=$G(^SRF(SRTN,.2)),SRCHK=$P(SRX,"^",12) I 'SRCHK S SRK=1 Q
"RTN","SROPCEP",36,0)
 .S SRDATE=$P(SRX,"^",10) I 'SRDATE S SRK=1 Q
"RTN","SROPCEP",37,0)
 .S SRX=$G(^SRF(SRTN,.1)),SRPROV=$P(SRX,"^",4),SRATT=$P(SRX,"^",13) I 'SRPROV S SRK=1 Q
"RTN","SROPCEP",38,0)
 .I SRSR'=0,'SRATT S SRK=1 Q
"RTN","SROPCEP",39,0)
 I SRNON D  I SRK Q
"RTN","SROPCEP",40,0)
 .S SRLOC=$P(SR(0),"^",21)
"RTN","SROPCEP",41,0)
 .S SRX=^SRF(SRTN,"NON"),SRCHK=$P(SRX,"^",5) I 'SRCHK S SRK=1 Q
"RTN","SROPCEP",42,0)
 .S SRDATE=$P(SRX,"^",4) I 'SRDATE S SRK=1 Q
"RTN","SROPCEP",43,0)
 .I 'SRLOC S SRLOC=$P(SRX,"^",2) I 'SRLOC S SRK=1 Q
"RTN","SROPCEP",44,0)
 .S SRPROV=$P(SRX,"^",6),SRATT=$P(SRX,"^",7) I 'SRPROV S SRK=1
"RTN","SROPCEP",45,0)
 .I SRSR'=0,'SRATT S SRK=1
"RTN","SROPCEP",46,0)
 S VAINDT=SRDATE
"RTN","SROPCEP",47,0)
 D INP^VADPT
"RTN","SROPCEP",48,0)
 I VAIN(1) S SRINOUT="I"
"RTN","SROPCEP",49,0)
 I 'VAIN(1) S SRINOUT="O"
"RTN","SROPCEP",50,0)
 K VAINDT,VAIN
"RTN","SROPCEP",51,0)
 I '$$CLINIC^SROUTL(SRLOC,SRTN) S SRK=1 Q
"RTN","SROPCEP",52,0)
 S SRX=0,SRX=$O(^SRO(136,SRTN,2,SRX)) I SRX="" S SRK=1 Q
"RTN","SROPCEP",53,0)
 S SRX=0 F  S SRX=$O(^SRO(136,SRTN,3,SRX)) Q:'SRX  S SRX2=0,SRX2=$O(^SRO(136,SRTN,3,SRX,2,SRX2)) I $D(^SRO(136,SRTN,3,SRX,0)),(SRX2="") S SRK=1  Q:SRK
"RTN","SROPCEP",54,0)
 S SRRPROV="" I $D(^SRF(SRTN,18)) S SRX=0,SRX=$O(^SRF(SRTN,18,SRX)) I SRX S SRRPROV=$P($G(^SRF(SRTN,18,SRX,0)),"^",7)
"RTN","SROPCEP",55,0)
 S SRO(0)=$G(^SRO(136,SRTN,0))
"RTN","SROPCEP",56,0)
 S (SRSC,SRAO,SREC,SRHNC,SRIR,SRMST,SRCV,SRPRJ)=0,SRSC=$P(SRO(0),"^",4),SRAO=$P(SRO(0),"^",5),SRIR=$P(SRO(0),"^",6),SREC=$P(SRO(0),"^",7),SRMST=$P(SRO(0),"^",8),SRHNC=$P(SRO(0),"^",9),SRCV=$P(SRO(0),"^",10),SRPRJ=$P(SRO(0),"^",11)
"RTN","SROPCEP",57,0)
 I $$SWSTAT^IBBAPI(),'SRNON D
"RTN","SROPCEP",58,0)
 .S SRX=$P(^SRO(137.45,$P(SR(0),"^",4),0),"^",2)
"RTN","SROPCEP",59,0)
 .I SRX S SRDEPC=$$GET1^DIQ(45.3,SRX,2)
"RTN","SROPCEP",60,0)
 Q
"RTN","SROPCEP",61,0)
PCE ;
"RTN","SROPCEP",62,0)
 N SRI,SRJ,SRCODE,SROTH D TMP
"RTN","SROPCEP",63,0)
D2PCE ;
"RTN","SROPCEP",64,0)
 S SRPFSSAR=$P($G(^SRF(SRTN,"PFSS")),"^")
"RTN","SROPCEP",65,0)
 I $$SWSTAT^IBBAPI() D FM1 S SRV=$$DATA2PCE^PXAPI("^TMP(""SRPXAPI"",$J)",SRPKG,SRS,.SRVSIT,,,,,,.SRPFSSAR) D FM2
"RTN","SROPCEP",66,0)
 I '$$SWSTAT^IBBAPI() D FM1 S SRV=$$DATA2PCE^PXAPI("^TMP(""SRPXAPI"",$J)",SRPKG,SRS,.SRVSIT) D FM2
"RTN","SROPCEP",67,0)
 I SRVSIT D FM1 K DA,DIE,DR S DA=SRTN,DIE=130,DR=".015////"_SRVSIT D ^DIE K DA,DIE,DR D FM2
"RTN","SROPCEP",68,0)
 K ^TMP("SRPXAPI",$J),SRVSIT
"RTN","SROPCEP",69,0)
 Q
"RTN","SROPCEP",70,0)
TMP ;
"RTN","SROPCEP",71,0)
ENC S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"ENC D/T")=SRDATE
"RTN","SROPCEP",72,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"PATIENT")=DFN
"RTN","SROPCEP",73,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"HOS LOC")=SRLOC
"RTN","SROPCEP",74,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"CHECKOUT D/T")=SRCHK
"RTN","SROPCEP",75,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"SERVICE CATEGORY")="S"
"RTN","SROPCEP",76,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"ENCOUNTER TYPE")="P"
"RTN","SROPCEP",77,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"APPT")=9
"RTN","SROPCEP",78,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"SC")=SRSC
"RTN","SROPCEP",79,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"AO")=SRAO
"RTN","SROPCEP",80,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"IR")=SRIR
"RTN","SROPCEP",81,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"EC")=SREC
"RTN","SROPCEP",82,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"MST")=SRMST
"RTN","SROPCEP",83,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"HNC")=SRHNC
"RTN","SROPCEP",84,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"CV")=SRCV
"RTN","SROPCEP",85,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"SHAD")=SRPRJ
"RTN","SROPCEP",86,0)
PROC S SRI=1,SRCODE=SRCPT D PMOD,CPT
"RTN","SROPCEP",87,0)
 S SROTH=0 F  S SROTH=$O(^SRO(136,SRTN,3,SROTH)) Q:'SROTH  S SRCODE=$P($G(^SRO(136,SRTN,3,SROTH,0)),"^") I SRCODE S SRI=SRI+1 D OMOD,CPT
"RTN","SROPCEP",88,0)
PROV S ^TMP("SRPXAPI",$J,"PROVIDER",1,"NAME")=SRPROV
"RTN","SROPCEP",89,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",1,"PRIMARY")=1
"RTN","SROPCEP",90,0)
 I 'SRNON S ^TMP("SRPXAPI",$J,"PROVIDER",1,"COMMENT")="Surgeon"
"RTN","SROPCEP",91,0)
 I SRPROV=SRATT!'SRATT S ^TMP("SRPXAPI",$J,"PROVIDER",1,"ATTENDING")=1 G DIAG
"RTN","SROPCEP",92,0)
 I 'SRATT G DIAG
"RTN","SROPCEP",93,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",2,"NAME")=SRATT
"RTN","SROPCEP",94,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",2,"ATTENDING")=1
"RTN","SROPCEP",95,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",2,"PRIMARY")=1
"RTN","SROPCEP",96,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",1,"PRIMARY")=0
"RTN","SROPCEP",97,0)
 I 'SRNON S ^TMP("SRPXAPI",$J,"PROVIDER",2,"COMMENT")="Attending Surgeon"
"RTN","SROPCEP",98,0)
DIAG S SRI=1,SRDX=SRDIAG D DX
"RTN","SROPCEP",99,0)
 S SRD=0 F  S SRD=$O(^SRO(136,SRTN,4,SRD)) Q:'SRD  S SRDX=$P(^SRO(136,SRTN,4,SRD,0),"^") I SRDX D DX
"RTN","SROPCEP",100,0)
 Q
"RTN","SROPCEP",101,0)
DX S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"DIAGNOSIS")=SRDX
"RTN","SROPCEP",102,0)
 I SRI=1 D
"RTN","SROPCEP",103,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PRIMARY")=1
"RTN","SROPCEP",104,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"ORD/RES")="R"
"RTN","SROPCEP",105,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL SC")=SRSC
"RTN","SROPCEP",106,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL AO")=SRAO
"RTN","SROPCEP",107,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL IR")=SRIR
"RTN","SROPCEP",108,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL EC")=SREC
"RTN","SROPCEP",109,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL MST")=SRMST
"RTN","SROPCEP",110,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL HNC")=SRHNC
"RTN","SROPCEP",111,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL CV")=SRCV
"RTN","SROPCEP",112,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL SHAD")=SRPRJ
"RTN","SROPCEP",113,0)
 I SRI'=1 D
"RTN","SROPCEP",114,0)
 .S SR(4)=$G(^SRO(136,SRTN,4,SRD,0))
"RTN","SROPCEP",115,0)
 .S (SRPLSC,SRPLAO,SRPLIR,SRPLEC,SRPLMST,SRPLHNC,SRPLCV,SRPLPRJ)=0,SRPLSC=$P(SR(4),"^",2),SRPLAO=$P(SR(4),"^",3)
"RTN","SROPCEP",116,0)
 .S SRPLIR=$P(SR(4),"^",4),SRPLMST=$P(SR(4),"^",5),SRPLHNC=$P(SR(4),"^",6),SRPLEC=$P(SR(4),"^",7),SRPLCV=$P(SR(4),"^",8),SRPLPRJ=$P(SR(4),"^",9)
"RTN","SROPCEP",117,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"ORD/RES")="R"
"RTN","SROPCEP",118,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL SC")=SRPLSC
"RTN","SROPCEP",119,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL AO")=SRPLAO
"RTN","SROPCEP",120,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL IR")=SRPLIR
"RTN","SROPCEP",121,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL EC")=SRPLEC
"RTN","SROPCEP",122,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL MST")=SRPLMST
"RTN","SROPCEP",123,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL HNC")=SRPLHNC
"RTN","SROPCEP",124,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL CV")=SRPLCV
"RTN","SROPCEP",125,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL SHAD")=SRPLPRJ
"RTN","SROPCEP",126,0)
 S SRI=SRI+1
"RTN","SROPCEP",127,0)
 Q
"RTN","SROPCEP",128,0)
CPT S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"ENC PROVIDER")=$S($P($G(^SRF(SRTN,.1)),"^",3)="R":SRATT,1:SRPROV)  ;; << *161 RJS
"RTN","SROPCEP",129,0)
 S:SRRPROV'="" ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"ORD PROVIDER")=SRRPROV
"RTN","SROPCEP",130,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"EVENT D/T")=SRDATE
"RTN","SROPCEP",131,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"PROCEDURE")=SRCODE
"RTN","SROPCEP",132,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"QTY")=1
"RTN","SROPCEP",133,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"COMMENT")=$S(SRI=1:"Principal Procedure",1:"Other Procedure")
"RTN","SROPCEP",134,0)
 I $G(SRDEPC) S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DEPARTMENT")=SRDEPC
"RTN","SROPCEP",135,0)
 I SRI=1 D
"RTN","SROPCEP",136,0)
 .S SRCNT=1,SRX=0 F  S SRX=$O(^SRO(136,SRTN,2,SRX)) Q:'SRX  D
"RTN","SROPCEP",137,0)
 ..S SRADX=$P(^SRO(136,SRTN,2,SRX,0),"^")
"RTN","SROPCEP",138,0)
 ..I SRCNT=1 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS")=SRADX
"RTN","SROPCEP",139,0)
 ..I SRCNT=2 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 2")=SRADX
"RTN","SROPCEP",140,0)
 ..I SRCNT=3 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 3")=SRADX
"RTN","SROPCEP",141,0)
 ..I SRCNT=4 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 4")=SRADX
"RTN","SROPCEP",142,0)
 ..I SRCNT=5 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 5")=SRADX
"RTN","SROPCEP",143,0)
 ..I SRCNT=6 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 6")=SRADX
"RTN","SROPCEP",144,0)
 ..I SRCNT=7 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 7")=SRADX
"RTN","SROPCEP",145,0)
 ..I SRCNT=8 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 8")=SRADX
"RTN","SROPCEP",146,0)
 ..S SRCNT=SRCNT+1
"RTN","SROPCEP",147,0)
 I SRI'=1 D
"RTN","SROPCEP",148,0)
 .S SRCNT=1,SRX=0 F  S SRX=$O(^SRO(136,SRTN,3,SROTH,2,SRX)) Q:'SRX  D
"RTN","SROPCEP",149,0)
 ..S SRADX=$P(^SRO(136,SRTN,3,SROTH,2,SRX,0),"^")
"RTN","SROPCEP",150,0)
 ..I SRCNT=1 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS")=SRADX
"RTN","SROPCEP",151,0)
 ..I SRCNT=2 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 2")=SRADX
"RTN","SROPCEP",152,0)
 ..I SRCNT=3 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 3")=SRADX
"RTN","SROPCEP",153,0)
 ..I SRCNT=4 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 4")=SRADX
"RTN","SROPCEP",154,0)
 ..I SRCNT=5 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 5")=SRADX
"RTN","SROPCEP",155,0)
 ..I SRCNT=6 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 6")=SRADX
"RTN","SROPCEP",156,0)
 ..I SRCNT=7 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 7")=SRADX
"RTN","SROPCEP",157,0)
 ..I SRCNT=8 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 8")=SRADX
"RTN","SROPCEP",158,0)
 ..S SRCNT=SRCNT+1
"RTN","SROPCEP",159,0)
 Q
"RTN","SROPCEP",160,0)
PMOD ;
"RTN","SROPCEP",161,0)
 N SRM,SRMOD,X
"RTN","SROPCEP",162,0)
 S SRM=0 F  S SRM=$O(^SRO(136,SRTN,1,SRM)) Q:'SRM  S X=$P(^SRO(136,SRTN,1,SRM,0),"^"),SRMOD=$P($$MOD^ICPTMOD(X,"I"),"^",2),^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"MODIFIERS",SRMOD)=""
"RTN","SROPCEP",163,0)
 Q
"RTN","SROPCEP",164,0)
OMOD ;
"RTN","SROPCEP",165,0)
 N SRM,SRMOD,X
"RTN","SROPCEP",166,0)
 S SRM=0 F  S SRM=$O(^SRO(136,SRTN,3,SROTH,1,SRM)) Q:'SRM  S X=$P(^SRO(136,SRTN,3,SROTH,1,SRM,0),"^"),SRMOD=$P($$MOD^ICPTMOD(X,"I"),"^",2),^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"MODIFIERS",SRMOD)=""
"RTN","SROPCEP",167,0)
 Q
"RTN","SROPCEP",168,0)
FM1 M SRDA=DA,SRDP=DP,SRDC=DC,SRDI=DI,SRDL=DL,SRDIE=DIE,SRDG=DG,SRDM=DM,SRDR=DR,SRDH=DH,SRDK=DK,SRD0=D0,SRDDER=DDER,SRDG=DG,SRDIC=DIC,SRDIC1=DIC1,SRDICRRE=DICRREC
"RTN","SROPCEP",169,0)
 M SRDIEDA=DIEDA,SRDIG=DIG,SRDIH=DIH,SRDIIENS=DIIENS,SRDISL=DISL,SRDISYS=DISYS,SRDIU=DIU,SRDIV=DIV,SRDIWT=DIWT,SRDN=DN,SRDQ=DQ,SRDX=DX,SRDY=DY
"RTN","SROPCEP",170,0)
FM2 M DA=SRDA,DP=SRDP,DC=SRDC,DI=SRDI,DL=SRDL,DIE=SRDIE,DG=SRDG,DM=SRDM,DR=SRDR,DH=SRDH,DK=SRDK,D0=SRD0,DDER=SRDDER,DG=SRDG,DIC=SRDIC,DIC1=SRDIC1,DICRREC=SRDICRRE
"RTN","SROPCEP",171,0)
 M DIEDA=SRDIEDA,DIG=SRDIG,DIH=SRDIH,DIIENS=SRDIIENS,DISL=SRDISL,DISYS=SRDISYS,DIU=SRDIU,DIV=SRDIV,DIWT=SRDIWT,DN=SRDN,DQ=SRDQ,DX=SRDX,DY=SRDY
"RTN","SROREQ4")
0^3^B16096256^B15921764
"RTN","SROREQ4",1,0)
SROREQ4 ;BIR/MAM - OPERATION REQUESTS (SHORT) ; [ 12/09/99  11:54 AM ]
"RTN","SROREQ4",2,0)
 ;;3.0; Surgery ;**26,48,92,161**;24 Jun 93;Build 5
"RTN","SROREQ4",3,0)
BEG ; entry when queued
"RTN","SROREQ4",4,0)
 K ^TMP("SR",$J) U IO S (CNT,DFN,SRSOUT)=0
"RTN","SROREQ4",5,0)
 S Y=SRSDATE,SRDT=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3) D D^DIQ S SRSDT=$E(Y,1,12)
"RTN","SROREQ4",6,0)
 F  S DFN=$O(^SRF("AR",SRSDATE,DFN)) Q:'DFN  S SRTN=0 F  S SRTN=$O(^SRF("AR",SRSDATE,DFN,SRTN)) Q:'SRTN  I $D(^SRF(SRTN,0)),$$DIV^SROUTL0(SRTN) D SET
"RTN","SROREQ4",7,0)
 W:$Y @IOF S SRSNM=0 F  S SRSNM=$O(^TMP("SR",$J,SRSNM)) Q:SRSNM=""!(SRSOUT)  D HDR S (SREQDT,CNT)=0 F  S SREQDT=$O(^TMP("SR",$J,SRSNM,SREQDT)) Q:SREQDT=""!(SRSOUT)  D MORE
"RTN","SROREQ4",8,0)
END W:$E(IOST)="P" @IOF I $D(ZTQUEUED) K ^TMP("SR",$J) Q:$G(ZTSTOP)  S ZTREQ="@" Q
"RTN","SROREQ4",9,0)
 S:$E(IOST)="P" SRSOUT=1 I 'SRSOUT W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SROREQ4",10,0)
 D ^%ZISC K SRTN D ^SRSKILL W @IOF
"RTN","SROREQ4",11,0)
 Q
"RTN","SROREQ4",12,0)
MORE ; continue looping
"RTN","SROREQ4",13,0)
 S SRTN=0 F  S SRTN=$O(^TMP("SR",$J,SRSNM,SREQDT,SRTN)) Q:'SRTN!(SRSOUT)  D PRINT
"RTN","SROREQ4",14,0)
 Q
"RTN","SROREQ4",15,0)
SET ; set ^TMP(
"RTN","SROREQ4",16,0)
 S SRSS=$P(^SRF(SRTN,0),"^",4),SRSNM=$S(SRSS:$P(^SRO(137.45,SRSS,0),"^"),1:"ZZ")
"RTN","SROREQ4",17,0)
 S SREQDT=$P($G(^SRF(SRTN,"1.0")),"^",11) S:'SREQDT SREQDT="ZZ"
"RTN","SROREQ4",18,0)
 S ^TMP("SR",$J,SRSNM,SREQDT,SRTN)=""
"RTN","SROREQ4",19,0)
 Q
"RTN","SROREQ4",20,0)
PRINT ; print from ^TMP("SR",$J)
"RTN","SROREQ4",21,0)
 I $Y+7>IOSL D PAGE I SRSOUT Q
"RTN","SROREQ4",22,0)
 S S(0)=$G(^SRF(SRTN,0)) Q:'S(0)  ; << RJS *161
"RTN","SROREQ4",23,0)
 S DFN=$P(S(0),"^"),CNT=CNT+1
"RTN","SROREQ4",24,0)
 D DEM^VADPT S SRNAME=VADM(1),SROPER=$P(^SRF(SRTN,"OP"),"^"),SRSUR=$P($G(^SRF(SRTN,.1)),"^",4),SRSUR=$S(SRSUR:$P(^VA(200,SRSUR,0),"^"),1:"NOT ENTERED")
"RTN","SROREQ4",25,0)
 S SRHRS=$P($G(^SRF(SRTN,.4)),"^"),SRD=$E(SRSDATE,4,5)_"/"_$E(SRSDATE,6,7)_"/"_$E(SRSDATE,2,3)
"RTN","SROREQ4",26,0)
 S:SRHRS="" SRHRS="NOT ENTERED" S C=$P(^DD(130,.035,0),"^",2),Y=$P(S(0),"^",10) D:Y'="" Y^DIQ S SRTYPE=Y,SRANES=$P($G(^SRF(SRTN,"1.0")),"^"),Y=SRANES,C=$P(^DD(130,1.01,0),"^",2) D:Y'="" Y^DIQ S SRANES=Y
"RTN","SROREQ4",27,0)
 S SRSORD=$P(S(0),"^",11),SSN=VA("PID"),SRWARD=$S($D(^DPT(DFN,.1)):^(.1),1:"") I SRTYPE'="" S SRTYPE=" ("_$P(SRTYPE,"(")_")"
"RTN","SROREQ4",28,0)
 K SROPS,MM,MMM S SROPER=SROPER_SRTYPE S:$L(SROPER)<63 SROPS(1)=SROPER I $L(SROPER)>62 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROREQ4",29,0)
 W !!,CNT_".",?5,"Case Number: "_SRTN,?40,"Operation Date: "_SRD,!,?5,"Patient: ",?14,SRNAME,?40,"Ward: ",SRWARD,!,?5,"ID#: ",?14,VA("PID"),?40,"Surgeon: "_SRSUR,!,?5,"Procedure: "_SROPS(1)
"RTN","SROREQ4",30,0)
 I $D(SROPS(2)) W !,?16,SROPS(2) I $D(SROPS(3)) W !,?16,SROPS(3) I $D(SROPS(4)) W !,?16,SROPS(4)
"RTN","SROREQ4",31,0)
 W !,?5,"Estimated Case Length: "_SRHRS W:SRSORD'="" !,?5,"Case Schedule Order:   "_SRSORD W:SRANES'="" !,?5,"Requested Anesthesia:  "_SRANES
"RTN","SROREQ4",32,0)
 K SRSCON I $D(^SRF(SRTN,"CON")),$P(^("CON"),"^") S SRSCON=$P(^("CON"),"^") K A S SROPER=$P(^SRF(SRSCON,"OP"),"^") S:$L(SROPER)<65 SROPS(1)=SROPER I $L(SROPER)>64 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MM=""
"RTN","SROREQ4",33,0)
 I $D(SRSCON) W !,"Concurrent Case # "_SRSCON,!,SROPS(1) I $D(SROPS(2)) W !,SROPS(2) I $D(SROPS(3)) W !,SROPS(3)
"RTN","SROREQ4",34,0)
 Q
"RTN","SROREQ4",35,0)
PAGE I $E(IOST)'="P" W !!,"Press RETURN to continue, or '^' to quit:  " R X:DTIME I X["^" S SRSOUT=1 Q
"RTN","SROREQ4",36,0)
 W:$Y @IOF
"RTN","SROREQ4",37,0)
HDR ; print heading
"RTN","SROREQ4",38,0)
 I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRSOUT=1 Q
"RTN","SROREQ4",39,0)
 I $Y+4>IOSL D PAGE Q
"RTN","SROREQ4",40,0)
 W !! F LINE=1:1:80 W "="
"RTN","SROREQ4",41,0)
 W !,"REQUESTS FOR "_$S(SRSNM'="ZZ":SRSNM,1:"UNKNOWN"),?70,SRDT,! F LINE=1:1:80 W "-"
"RTN","SROREQ4",42,0)
 Q
"RTN","SROREQ4",43,0)
LOOP ; break procedure if greater than 63 characters
"RTN","SROREQ4",44,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<63  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROREQ4",45,0)
 Q
"VER")
8.0^22.0
"BLD",7145,6)
^155
**END**
**END**
