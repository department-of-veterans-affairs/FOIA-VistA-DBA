Released IB*2*267 SEQ #266
Extracted from mail message
**KIDS**:IB*2.0*267^

**INSTALL NAME**
IB*2.0*267
"BLD",5180,0)
IB*2.0*267^INTEGRATED BILLING^0^3041012^y
"BLD",5180,1,0)
^^5^5^3040504^
"BLD",5180,1,1,0)
This patch is a re-release of IB*2.0*256 to standardize existing
"BLD",5180,1,2,0)
VistA Integrated Billing calls.  All direct IB touch points will
"BLD",5180,1,3,0)
be replaced with standard API's available to all VistA packages.
"BLD",5180,1,4,0)
This patch is enhancing the API call INSUR^IBBAPI that
"BLD",5180,1,5,0)
returns Insurance information.
"BLD",5180,4,0)
^9.64PA^^
"BLD",5180,"ABPKG")
n
"BLD",5180,"KRN",0)
^9.67PA^8989.52^19
"BLD",5180,"KRN",.4,0)
.4
"BLD",5180,"KRN",.401,0)
.401
"BLD",5180,"KRN",.402,0)
.402
"BLD",5180,"KRN",.403,0)
.403
"BLD",5180,"KRN",.5,0)
.5
"BLD",5180,"KRN",.84,0)
.84
"BLD",5180,"KRN",3.6,0)
3.6
"BLD",5180,"KRN",3.8,0)
3.8
"BLD",5180,"KRN",9.2,0)
9.2
"BLD",5180,"KRN",9.8,0)
9.8
"BLD",5180,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5180,"KRN",9.8,"NM",1,0)
IBBAPI^^0^B437505
"BLD",5180,"KRN",9.8,"NM",2,0)
IBBFAPI^^0^B30132460
"BLD",5180,"KRN",9.8,"NM",3,0)
IBBDOC^^0^B229151
"BLD",5180,"KRN",9.8,"NM","B","IBBAPI",1)

"BLD",5180,"KRN",9.8,"NM","B","IBBDOC",3)

"BLD",5180,"KRN",9.8,"NM","B","IBBFAPI",2)

"BLD",5180,"KRN",19,0)
19
"BLD",5180,"KRN",19.1,0)
19.1
"BLD",5180,"KRN",101,0)
101
"BLD",5180,"KRN",409.61,0)
409.61
"BLD",5180,"KRN",771,0)
771
"BLD",5180,"KRN",870,0)
870
"BLD",5180,"KRN",8989.51,0)
8989.51
"BLD",5180,"KRN",8989.52,0)
8989.52
"BLD",5180,"KRN",8994,0)
8994
"BLD",5180,"KRN","B",.4,.4)

"BLD",5180,"KRN","B",.401,.401)

"BLD",5180,"KRN","B",.402,.402)

"BLD",5180,"KRN","B",.403,.403)

"BLD",5180,"KRN","B",.5,.5)

"BLD",5180,"KRN","B",.84,.84)

"BLD",5180,"KRN","B",3.6,3.6)

"BLD",5180,"KRN","B",3.8,3.8)

"BLD",5180,"KRN","B",9.2,9.2)

"BLD",5180,"KRN","B",9.8,9.8)

"BLD",5180,"KRN","B",19,19)

"BLD",5180,"KRN","B",19.1,19.1)

"BLD",5180,"KRN","B",101,101)

"BLD",5180,"KRN","B",409.61,409.61)

"BLD",5180,"KRN","B",771,771)

"BLD",5180,"KRN","B",870,870)

"BLD",5180,"KRN","B",8989.51,8989.51)

"BLD",5180,"KRN","B",8989.52,8989.52)

"BLD",5180,"KRN","B",8994,8994)

"BLD",5180,"QUES",0)
^9.62^^
"BLD",5180,"REQB",0)
^9.611^1^1
"BLD",5180,"REQB",1,0)
IB*2.0*228^2
"BLD",5180,"REQB","B","IB*2.0*228",1)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)
 
"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
267^3041012
"PKG",200,22,1,"PAH",1,1,0)
^^5^5^3041012
"PKG",200,22,1,"PAH",1,1,1,0)
This patch is a re-release of IB*2.0*256 to standardize existing
"PKG",200,22,1,"PAH",1,1,2,0)
VistA Integrated Billing calls.  All direct IB touch points will
"PKG",200,22,1,"PAH",1,1,3,0)
be replaced with standard API's available to all VistA packages.
"PKG",200,22,1,"PAH",1,1,4,0)
This patch is enhancing the API call INSUR^IBBAPI that
"PKG",200,22,1,"PAH",1,1,5,0)
returns Insurance information.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","IBBAPI")
0^1^B437505
"RTN","IBBAPI",1,0)
IBBAPI ;OAK/ELZ - APIS FOR OTHER PACKAGES FOR PFSS ;6-MAY-2003
"RTN","IBBAPI",2,0)
 ;;2.0;INTEGRATED BILLING;**256,228,267**;21-MAR-94
"RTN","IBBAPI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBBAPI",4,0)
 ;
"RTN","IBBAPI",5,0)
 ; -- See IBBDOC for API details
"RTN","IBBAPI",6,0)
 ;
"RTN","IBBAPI",7,0)
INSUR(DFN,IBDT,IBSTAT,IBR,IBFLDS) ; Return Patient Insurance Information
"RTN","IBBAPI",8,0)
 ;
"RTN","IBBAPI",9,0)
 Q $$INSUR^IBBFAPI($G(DFN),$G(IBDT),$G(IBSTAT),.IBR,$G(IBFLDS))
"RTN","IBBAPI",10,0)
 ;
"RTN","IBBAPI",11,0)
 ;
"RTN","IBBDOC")
0^3^B229151
"RTN","IBBDOC",1,0)
IBBDOC ;OAK/ELZ - APIS FOR OTHER PACKAGES FOR PFSS - DOCUMENT ;5-AUG-2004
"RTN","IBBDOC",2,0)
 ;;2.0;INTEGRATED BILLING;**267**;21-MAR-94
"RTN","IBBDOC",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBBDOC",4,0)
 ;
"RTN","IBBDOC",5,0)
 ; Documents the calls to the routine IBBAPI.
"RTN","IBBDOC",6,0)
 ;
"RTN","IBBDOC",7,0)
INSUR ;(DFN,IBDT,IBSTAT,IBR,IBFLDS)
"RTN","IBBDOC",8,0)
 ; Function to return patient insurance information
"RTN","IBBDOC",9,0)
 ; --Input:
"RTN","IBBDOC",10,0)
 ;   DFN    = patient
"RTN","IBBDOC",11,0)
 ;   IBDT   = date insured (optional - default is today's date)
"RTN","IBBDOC",12,0)
 ;   IBSTAT = Insurance Status filter (combinable based on groups below)
"RTN","IBBDOC",13,0)
 ;      Group 1
"RTN","IBBDOC",14,0)
 ;          A = Inactive included (Default is active only)
"RTN","IBBDOC",15,0)
 ;      Group 2
"RTN","IBBDOC",16,0)
 ;          R = Not reimbursable included (Default is reimbursable only)
"RTN","IBBDOC",17,0)
 ;          B = Indemnity included (Default is not included)
"RTN","IBBDOC",18,0)
 ;      Group 3
"RTN","IBBDOC",19,0)
 ;          P = Prescription coverage required (Default is all coverages)
"RTN","IBBDOC",20,0)
 ;          O = Outpatient coverage required (Default is all coverages)
"RTN","IBBDOC",21,0)
 ;          I = Inpatient coverage only (Default is all coverages)
"RTN","IBBDOC",22,0)
 ;
"RTN","IBBDOC",23,0)
 ;   IBR    = Array to return insurance information - passed by reference
"RTN","IBBDOC",24,0)
 ;   IBFLDS = Lists of fields to return (1-19) in a comma separated list
"RTN","IBBDOC",25,0)
 ;
"RTN","IBBDOC",26,0)
 ; --Output:
"RTN","IBBDOC",27,0)
 ;   -1     = error occurred (error message passed back in
"RTN","IBBDOC",28,0)
 ;            IBR("IBBAPI","INSUR","ERROR",x) where x is error number
"RTN","IBBDOC",29,0)
 ;            between 101 & 111
"RTN","IBBDOC",30,0)
 ;    0     = No insurance found based on parameters
"RTN","IBBDOC",31,0)
 ;    1     = Insurance found
"RTN","IBBDOC",32,0)
 ;
"RTN","IBBFAPI")
0^2^B30132460
"RTN","IBBFAPI",1,0)
IBBFAPI ;OAK/ELZ - FOR OTHER PACKAGES TO QUERY INSURANCE INFO ;19-AUG-2004
"RTN","IBBFAPI",2,0)
 ;;2.0;INTEGRATED BILLING;**267**;21-MAR-94
"RTN","IBBFAPI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBBFAPI",4,0)
 ;
"RTN","IBBFAPI",5,0)
 ; -- see IBBDOC for API documentation
"RTN","IBBFAPI",6,0)
 ;    no applications should call here directly
"RTN","IBBFAPI",7,0)
INSUR(DFN,IBDT,IBSTAT,IBR,IBFLDS) ; Return Patient Insurance Information
"RTN","IBBFAPI",8,0)
 ;
"RTN","IBBFAPI",9,0)
 N ERROR,ERRORT,FCNT,IBPLN,ICNT,INSP,N,N1,NOK,PASS,PASS1,X,%
"RTN","IBBFAPI",10,0)
 K ERRORT D ERRORLD
"RTN","IBBFAPI",11,0)
 S NOK=-1
"RTN","IBBFAPI",12,0)
 S DFN=$G(DFN)
"RTN","IBBFAPI",13,0)
 S IBSTAT=$G(IBSTAT)
"RTN","IBBFAPI",14,0)
 S IBDT=$P($G(IBDT),".")
"RTN","IBBFAPI",15,0)
 S IBFLDS=$G(IBFLDS)
"RTN","IBBFAPI",16,0)
 I IBDT,IBSTAT["A" S ERROR=107 D ERROR Q NOK
"RTN","IBBFAPI",17,0)
 S (ERROR,PASS)=0 K IBR
"RTN","IBBFAPI",18,0)
 I 'DFN S ERROR=102 D ERROR Q NOK
"RTN","IBBFAPI",19,0)
 I '$D(^DPT(DFN)) S ERROR=106 D ERROR Q NOK
"RTN","IBBFAPI",20,0)
 I IBDT]"",IBDT'?7N S ERROR=104 D ERROR Q NOK
"RTN","IBBFAPI",21,0)
 I +IBDT=0 D NOW^%DTC S IBDT=$P(%,".",1)
"RTN","IBBFAPI",22,0)
 I IBSTAT]"" N Y F X=1:1:$L(IBSTAT) S Y=$E(IBSTAT,X) I '$F("^A^R^P^O^I^B^",(U_Y_U)) S ERROR=105 D ERROR Q
"RTN","IBBFAPI",23,0)
 I ERROR=105 Q NOK
"RTN","IBBFAPI",24,0)
 I IBFLDS]"",IBFLDS'="*" N Y F X=1:1:$L(IBFLDS,",") D
"RTN","IBBFAPI",25,0)
 . S Y=$P(IBFLDS,",",X)
"RTN","IBBFAPI",26,0)
 . I Y'?1N.N S ERROR=103
"RTN","IBBFAPI",27,0)
 . I Y?1N.N,(Y<1)!(Y>20) S ERROR=103
"RTN","IBBFAPI",28,0)
 I ERROR=103 D ERROR Q NOK
"RTN","IBBFAPI",29,0)
 K IBR
"RTN","IBBFAPI",30,0)
 S (ICNT,N)=0 F  S N=$O(^DPT(DFN,.312,N)) Q:'N  I $D(^(N,0)) D
"RTN","IBBFAPI",31,0)
 . S X=^DPT(DFN,.312,N,0)
"RTN","IBBFAPI",32,0)
 . N X1
"RTN","IBBFAPI",33,0)
 . S X1=$G(^DIC(36,+X,0)) I X1="" Q  ; no insurance company entry
"RTN","IBBFAPI",34,0)
 . S INSP=$P(X,U,1),IBPLN=$P(X,U,18)
"RTN","IBBFAPI",35,0)
 . I IBSTAT'["R",$P(X1,U,2)="N" Q  ; does not reimburse
"RTN","IBBFAPI",36,0)
 . I IBSTAT'["B",$$INDEM^IBCNS1(X) Q  ; indemnity policy
"RTN","IBBFAPI",37,0)
 . S PASS1=0
"RTN","IBBFAPI",38,0)
 . I IBSTAT'["A" D
"RTN","IBBFAPI",39,0)
 . . I $P(X,U,8),IBDT<$P(X,U,8) S PASS1=1 Q  ;effective after care date
"RTN","IBBFAPI",40,0)
 . . I $P(X,U,4),IBDT>$P(X,U,4) S PASS1=1 Q  ;terminated before care date
"RTN","IBBFAPI",41,0)
 . . I $P($G(^IBA(355.3,+$P(X,U,18),0)),U,11) S PASS1=1 Q  ;inactive plan
"RTN","IBBFAPI",42,0)
 . Q:PASS1
"RTN","IBBFAPI",43,0)
 . S ICNT=ICNT+1
"RTN","IBBFAPI",44,0)
 . S FCNT=$S(IBFLDS="*":20,1:$L(IBFLDS,",")) ; number of fields to pull
"RTN","IBBFAPI",45,0)
 . I IBFLDS="" S IBR("IBBAPI","INSUR",ICNT)=""  Q  ;no field info to pass
"RTN","IBBFAPI",46,0)
 . F N1=1:1:FCNT D
"RTN","IBBFAPI",47,0)
 . . N RET,RETVAL
"RTN","IBBFAPI",48,0)
 . . S RET=$S(IBFLDS="*":N1,1:$P(IBFLDS,",",N1)),RETVAL="" I RET?1N.N,RET>0,RET<21 D @RET S IBR("IBBAPI","INSUR",ICNT,RET)=RETVAL
"RTN","IBBFAPI",49,0)
 . I IBSTAT["P"!(IBSTAT["O")!(IBSTAT["I") D  I PASS1=0 K IBR("IBBAPI","INSUR",ICNT) S ICNT=ICNT-1
"RTN","IBBFAPI",50,0)
 . . S PASS1=0 Q:IBPLN=""
"RTN","IBBFAPI",51,0)
 . . I IBSTAT["P",+$$PLCOV(IBPLN,IBDT,"PHARMACY")>0 S PASS1=1
"RTN","IBBFAPI",52,0)
 . . I IBSTAT["O",+$$PLCOV(IBPLN,IBDT,"OUTPATIENT")>0 S PASS1=1
"RTN","IBBFAPI",53,0)
 . . I IBSTAT["I",+$$PLCOV(IBPLN,IBDT,"INPATIENT")>0 S PASS1=1
"RTN","IBBFAPI",54,0)
 I $D(IBR("IBBAPI","INSUR")),$O(IBR("IBBAPI","INSUR",0))'="ERROR" S PASS=1 F X=1:1 Q:'$D(IBR("IBBAPI","INSUR",X))  K:'$O(IBR("IBBAPI","INSUR",X,"")) IBR("IBBAPI","INSUR",X)
"RTN","IBBFAPI",55,0)
 Q PASS
"RTN","IBBFAPI",56,0)
ERRORLD ;  load error array
"RTN","IBBFAPI",57,0)
 F X=1:1:9 S ERRORT(X+100)=$P($T(ERRORLD1+X),";;",2)
"RTN","IBBFAPI",58,0)
 Q
"RTN","IBBFAPI",59,0)
 ;
"RTN","IBBFAPI",60,0)
ERRORLD1 ; error messages
"RTN","IBBFAPI",61,0)
 ;;DATABASE IS UNAVAILABLE
"RTN","IBBFAPI",62,0)
 ;;PATIENT ID IS REQUIRED
"RTN","IBBFAPI",63,0)
 ;;INVALID FIELD LIST
"RTN","IBBFAPI",64,0)
 ;;INVALID EFFECTIVE DATE
"RTN","IBBFAPI",65,0)
 ;;INVALID INSURANCE STATUS FILTER
"RTN","IBBFAPI",66,0)
 ;;INVALID PATIENT ID
"RTN","IBBFAPI",67,0)
 ;;INVALID COMBINATION, YOU CANNOT USE ""A"" WITH A DATE
"RTN","IBBFAPI",68,0)
 ;;DATA SOURCE IS NOT DEFINED
"RTN","IBBFAPI",69,0)
 ;;NO DATA ELEMENTS TO STORE
"RTN","IBBFAPI",70,0)
 ;;
"RTN","IBBFAPI",71,0)
ERROR ;
"RTN","IBBFAPI",72,0)
 K IBR S IBR("IBBAPI","INSUR","ERROR",ERROR)=ERRORT(ERROR)
"RTN","IBBFAPI",73,0)
 Q
"RTN","IBBFAPI",74,0)
 ;
"RTN","IBBFAPI",75,0)
1 ; Ins. Comp. name
"RTN","IBBFAPI",76,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",.01,"I")_U_$$GET1^DIQ(2.312,N_","_DFN_",",.01)
"RTN","IBBFAPI",77,0)
 Q
"RTN","IBBFAPI",78,0)
2 ; Ins. Comp. Street Address Line 1
"RTN","IBBFAPI",79,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.111)
"RTN","IBBFAPI",80,0)
 Q
"RTN","IBBFAPI",81,0)
3 ; Ins. Comp. City
"RTN","IBBFAPI",82,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.114)
"RTN","IBBFAPI",83,0)
 Q
"RTN","IBBFAPI",84,0)
4 ; Ins. Comp. State
"RTN","IBBFAPI",85,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.115,"I")_U_$$GET1^DIQ(36,INSP_",",.115)
"RTN","IBBFAPI",86,0)
 Q
"RTN","IBBFAPI",87,0)
5 ; Ins. Comp. Zip
"RTN","IBBFAPI",88,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.116)
"RTN","IBBFAPI",89,0)
 Q
"RTN","IBBFAPI",90,0)
6 ; Ins. Comp. Phone
"RTN","IBBFAPI",91,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.131)
"RTN","IBBFAPI",92,0)
 Q
"RTN","IBBFAPI",93,0)
7 ; Coordination of Benefits
"RTN","IBBFAPI",94,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",.2,"I")_U_$$GET1^DIQ(2.312,N_","_DFN_",",.2)
"RTN","IBBFAPI",95,0)
 I RETVAL="^" S RETVAL=""
"RTN","IBBFAPI",96,0)
 Q
"RTN","IBBFAPI",97,0)
8 ; Policy Name
"RTN","IBBFAPI",98,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",.18,"I"),RETVAL=RETVAL_U_$$GET1^DIQ(355.3,RETVAL,.03)
"RTN","IBBFAPI",99,0)
 Q
"RTN","IBBFAPI",100,0)
9 ; Policy Reimbursable?
"RTN","IBBFAPI",101,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",1,"I")
"RTN","IBBFAPI",102,0)
 S RETVAL=$S(RETVAL="Y":"1^YES",RETVAL="*":"1^YES",RETVAL="**":"1^YES",RETVAL="":"1^YES",1:"0^NO")
"RTN","IBBFAPI",103,0)
 Q
"RTN","IBBFAPI",104,0)
10 ; Policy Effective Date
"RTN","IBBFAPI",105,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",8,"I")
"RTN","IBBFAPI",106,0)
 Q
"RTN","IBBFAPI",107,0)
11 ; Policy Expiration Date
"RTN","IBBFAPI",108,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",3,"I")
"RTN","IBBFAPI",109,0)
 Q
"RTN","IBBFAPI",110,0)
12 ; Subscriber Relationship
"RTN","IBBFAPI",111,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",16,"I")
"RTN","IBBFAPI",112,0)
 S RETVAL=$S(RETVAL="01":"P^PATIENT",RETVAL="02":"S^SPOUSE",1:"O^OTHER")
"RTN","IBBFAPI",113,0)
 Q
"RTN","IBBFAPI",114,0)
13 ; Subscriber Name
"RTN","IBBFAPI",115,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",17)
"RTN","IBBFAPI",116,0)
 Q
"RTN","IBBFAPI",117,0)
14 ; Subscriber ID
"RTN","IBBFAPI",118,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",1)
"RTN","IBBFAPI",119,0)
 Q
"RTN","IBBFAPI",120,0)
15 ; Pharmacy Coverage?
"RTN","IBBFAPI",121,0)
 N IBCOV
"RTN","IBBFAPI",122,0)
 S IBCOV=$$PLCOV(IBPLN,IBDT,"PHARMACY")
"RTN","IBBFAPI",123,0)
 S RETVAL=$S(+IBCOV=0:"0^NO",1:"1^YES")
"RTN","IBBFAPI",124,0)
 Q
"RTN","IBBFAPI",125,0)
16 ; Outpatient Coverage?
"RTN","IBBFAPI",126,0)
 N IBCOV
"RTN","IBBFAPI",127,0)
 S IBCOV=$$PLCOV(IBPLN,IBDT,"OUTPATIENT")
"RTN","IBBFAPI",128,0)
 S RETVAL=$S(+IBCOV=0:"0^NO",1:"1^YES")
"RTN","IBBFAPI",129,0)
 Q
"RTN","IBBFAPI",130,0)
17 ; Inpatient Coverage?
"RTN","IBBFAPI",131,0)
 N IBCOV
"RTN","IBBFAPI",132,0)
 S IBCOV=$$PLCOV(IBPLN,IBDT,"INPATIENT")
"RTN","IBBFAPI",133,0)
 S RETVAL=$S(+IBCOV=0:"0^NO",1:"1^YES")
"RTN","IBBFAPI",134,0)
 Q
"RTN","IBBFAPI",135,0)
18 ; Group Number
"RTN","IBBFAPI",136,0)
 S RETVAL=$$GET1^DIQ(355.3,$$GET1^DIQ(2.312,N_","_DFN_",",.18,"I")_",",.04)
"RTN","IBBFAPI",137,0)
 Q
"RTN","IBBFAPI",138,0)
 ;
"RTN","IBBFAPI",139,0)
19 ; Patient Relationship to Subscriber
"RTN","IBBFAPI",140,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",16,"I")_U_$$GET1^DIQ(2.312,N_","_DFN_",",16)
"RTN","IBBFAPI",141,0)
 Q
"RTN","IBBFAPI",142,0)
 ;
"RTN","IBBFAPI",143,0)
20 ; VA Advantage plan subscriber
"RTN","IBBFAPI",144,0)
 S RETVAL=0  ; to be determined at a later date
"RTN","IBBFAPI",145,0)
 N PLN,TYP1,TYP2,RETVAL1
"RTN","IBBFAPI",146,0)
 S PLN=$$GET1^DIQ(2.312,N_","_DFN_",",.18,"I")
"RTN","IBBFAPI",147,0)
 S TYP1=$$GET1^DIQ(355.3,PLN_",",.09,"I")
"RTN","IBBFAPI",148,0)
 S TYP2=$$GET1^DIQ(355.1,TYP1_",",.03,"I")
"RTN","IBBFAPI",149,0)
 S RETVAL1=$S(TYP2=7:1,1:0)  ; determine Tricare plan
"RTN","IBBFAPI",150,0)
 S RETVAL=RETVAL_U_RETVAL1
"RTN","IBBFAPI",151,0)
 Q
"RTN","IBBFAPI",152,0)
 ;
"RTN","IBBFAPI",153,0)
PLCOV(IBPL,IBVDT,IBCAT) ; Determine if a specific plan covers a category of coverage as of a date
"RTN","IBBFAPI",154,0)
 ; IBPL - pointer to file 355.3 group insurance plan (req)
"RTN","IBBFAPI",155,0)
 ; IBVDT - fileman format visit date (req)
"RTN","IBBFAPI",156,0)
 ; IBCAT -  pointer to file 355.31 limitation of coverage category (req)
"RTN","IBBFAPI",157,0)
 N CATLIM,X,Y
"RTN","IBBFAPI",158,0)
 S X=0
"RTN","IBBFAPI",159,0)
 S IBCAT=$O(^IBE(355.31,"B",IBCAT,"")) G:IBCAT="" PLCOVQ
"RTN","IBBFAPI",160,0)
 S CATLIM=$O(^IBA(355.32,"APCD",IBPL,IBCAT,+$O(^IBA(355.32,"APCD",IBPL,IBCAT,-(IBVDT+1))),""))
"RTN","IBBFAPI",161,0)
 S X=$S(CATLIM="":1,1:+$P($G(^IBA(355.32,CATLIM,0)),U,4))
"RTN","IBBFAPI",162,0)
PLCOVQ Q X
"RTN","IBBFAPI",163,0)
 ;
"VER")
8.0^22
**END**
**END**
