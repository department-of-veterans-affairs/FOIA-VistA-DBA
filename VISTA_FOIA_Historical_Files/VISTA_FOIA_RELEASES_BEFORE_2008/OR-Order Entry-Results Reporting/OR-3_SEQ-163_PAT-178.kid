Released OR*3*178 SEQ #163
Extracted from mail message
**KIDS**:OR*3.0*178^

**INSTALL NAME**
OR*3.0*178
"BLD",4200,0)
OR*3.0*178^ORDER ENTRY/RESULTS REPORTING^0^3030402^y
"BLD",4200,4,0)
^9.64PA^^
"BLD",4200,"ABPKG")
n
"BLD",4200,"INI")
POST^ORY178
"BLD",4200,"KRN",0)
^9.67PA^8989.52^19
"BLD",4200,"KRN",.4,0)
.4
"BLD",4200,"KRN",.401,0)
.401
"BLD",4200,"KRN",.402,0)
.402
"BLD",4200,"KRN",.403,0)
.403
"BLD",4200,"KRN",.5,0)
.5
"BLD",4200,"KRN",.84,0)
.84
"BLD",4200,"KRN",3.6,0)
3.6
"BLD",4200,"KRN",3.8,0)
3.8
"BLD",4200,"KRN",9.2,0)
9.2
"BLD",4200,"KRN",9.8,0)
9.8
"BLD",4200,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",4200,"KRN",9.8,"NM",2,0)
ORCMED^^0^B40339522
"BLD",4200,"KRN",9.8,"NM",3,0)
ORWDX^^0^B73765779
"BLD",4200,"KRN",9.8,"NM",4,0)
ORWDXM1^^0^B66735132
"BLD",4200,"KRN",9.8,"NM",5,0)
ORY178^^0^B355300
"BLD",4200,"KRN",9.8,"NM","B","ORCMED",2)

"BLD",4200,"KRN",9.8,"NM","B","ORWDX",3)

"BLD",4200,"KRN",9.8,"NM","B","ORWDXM1",4)

"BLD",4200,"KRN",9.8,"NM","B","ORY178",5)

"BLD",4200,"KRN",19,0)
19
"BLD",4200,"KRN",19.1,0)
19.1
"BLD",4200,"KRN",101,0)
101
"BLD",4200,"KRN",409.61,0)
409.61
"BLD",4200,"KRN",771,0)
771
"BLD",4200,"KRN",870,0)
870
"BLD",4200,"KRN",8989.51,0)
8989.51
"BLD",4200,"KRN",8989.52,0)
8989.52
"BLD",4200,"KRN",8994,0)
8994
"BLD",4200,"KRN","B",.4,.4)

"BLD",4200,"KRN","B",.401,.401)

"BLD",4200,"KRN","B",.402,.402)

"BLD",4200,"KRN","B",.403,.403)

"BLD",4200,"KRN","B",.5,.5)

"BLD",4200,"KRN","B",.84,.84)

"BLD",4200,"KRN","B",3.6,3.6)

"BLD",4200,"KRN","B",3.8,3.8)

"BLD",4200,"KRN","B",9.2,9.2)

"BLD",4200,"KRN","B",9.8,9.8)

"BLD",4200,"KRN","B",19,19)

"BLD",4200,"KRN","B",19.1,19.1)

"BLD",4200,"KRN","B",101,101)

"BLD",4200,"KRN","B",409.61,409.61)

"BLD",4200,"KRN","B",771,771)

"BLD",4200,"KRN","B",870,870)

"BLD",4200,"KRN","B",8989.51,8989.51)

"BLD",4200,"KRN","B",8989.52,8989.52)

"BLD",4200,"KRN","B",8994,8994)

"BLD",4200,"QUES",0)
^9.62^^
"BLD",4200,"REQB",0)
^9.611^2^2
"BLD",4200,"REQB",1,0)
OR*3.0*141^2
"BLD",4200,"REQB",2,0)
OR*3.0*164^2
"BLD",4200,"REQB","B","OR*3.0*141",1)

"BLD",4200,"REQB","B","OR*3.0*164",2)

"INI")
POST^ORY178
"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
178^3030402
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","ORCMED")
0^2^B40339522
"RTN","ORCMED",1,0)
ORCMED ;SLC/MKB-Medication actions ;4/2/02  16:45
"RTN","ORCMED",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,7,38,48,94,141,178**;Dec 17, 1997
"RTN","ORCMED",3,0)
XFER ; -- transfer to in/outpt meds
"RTN","ORCMED",4,0)
 N ORPTLK,ORTYPE,ORXFER,ORCAT,OREVENT,X,ORINPT,ORIDLG,ORODLG,ORIVDLG,ORNMSP,ORCNT,ORI,NMBR,ORIFN,OLDIFN,ORDIALOG,ORDG,ORCHECK,ORQUIT,ORDUZ,ORLOG,FIRST,ORDITM,ORD,ORERR
"RTN","ORCMED",5,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK D  G XFQ ; lock pt chart
"RTN","ORCMED",6,0)
 . W !!,$C(7),$P(ORPTLK,U,2) H 2
"RTN","ORCMED",7,0)
 . S:'$D(VALMBCK) VALMBCK=""
"RTN","ORCMED",8,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("transfer") G:'ORNMBR XFQ
"RTN","ORCMED",9,0)
 D FULL^VALM1 S VALMBCK="R",ORTYPE="Q",ORXFER=1,ORDUZ=DUZ
"RTN","ORCMED",10,0)
 S X=$P($P($G(^TMP("OR",$J,"CURRENT",0)),U,3),";",3) S:X="" X=$G(ORWARD)
"RTN","ORCMED",11,0)
 S ORCAT=$S(X:"O",1:"I") I ORCAT="I"!$G(ORWARD) D  Q:$G(OREVENT)="^"
"RTN","ORCMED",12,0)
 . W !!,$$CURRENT^OREVNT
"RTN","ORCMED",13,0)
 . S X=$$DELAY^ORCACT I X="^" S OREVENT="^" Q
"RTN","ORCMED",14,0)
 . S:X OREVENT=+$$PTEVENT^OREVNT(+ORVP,1)
"RTN","ORCMED",15,0)
 I '$G(ORL) S ORL=$S($G(OREVENT):$$LOC^OREVNTX(OREVENT),1:$$LOCATION^ORCMENU1) G:ORL="^" XFQ
"RTN","ORCMED",16,0)
 S ORINPT=$$INPT^ORCD,ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" XFQ
"RTN","ORCMED",17,0)
 S ORIDLG=+$O(^ORD(101.41,"AB","PSJ OR PAT OE",0))
"RTN","ORCMED",18,0)
 S ORODLG=+$O(^ORD(101.41,"AB","PSO OERR",0))
"RTN","ORCMED",19,0)
 S ORIVDLG=+$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORCMED",20,0)
 D PROVIDER^ORCDPSIV G:$G(ORQUIT) XFQ ;X:$D(^ORD(101.41,ORDIALOG,3)) ^(3)
"RTN","ORCMED",21,0)
 S ORNMSP="PS" D DISPLAY^ORCHECK
"RTN","ORCMED",22,0)
 S ORCNT=$L(ORNMBR,",") S:$P(ORNMBR,",",ORCNT)'>0 ORCNT=ORCNT-1
"RTN","ORCMED",23,0)
XF1 F ORI=1:1:ORCNT S NMBR=$P(ORNMBR,",",ORI) D:NMBR  I $D(ORQUIT),ORI<ORCNT Q:'$$CONT  ;if not last one, ask
"RTN","ORCMED",24,0)
 . K ORIFN,ORDIALOG,ORDG,ORDOSE,ORCHECK,ORQUIT,ORERR
"RTN","ORCMED",25,0)
 . K ^TMP("PSJMR",$J),^TMP("ORWORD",$J),^TMP("ORSIG",$J)
"RTN","ORCMED",26,0)
 . S OLDIFN=+$P($G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),U,4)
"RTN","ORCMED",27,0)
 . S ORDITM=$$ORDITEM^ORCACT(OLDIFN) D SUBHDR^ORCACT(ORDITM)
"RTN","ORCMED",28,0)
 . I '$$VALID^ORCACT0(OLDIFN,"XFR",.ORERR) W !,ORERR H 2 Q
"RTN","ORCMED",29,0)
 . S ORD=$P($G(^OR(100,OLDIFN,0)),U,5) Q:ORD'["101.41"  ;error msg?
"RTN","ORCMED",30,0)
 . S ORDIALOG=$S(+ORD=ORIVDLG:ORIVDLG,ORCAT="I":ORIDLG,1:ORODLG)
"RTN","ORCMED",31,0)
 . S ORDG=+$P($G(^ORD(101.41,ORDIALOG,0)),U,5)
"RTN","ORCMED",32,0)
 . D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(OLDIFN)
"RTN","ORCMED",33,0)
 . I ORDIALOG'=ORIVDLG D OUT:ORCAT="I",IN:ORCAT="O" ;convert data
"RTN","ORCMED",34,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX START DATE/TIME"),1)
"RTN","ORCMED",35,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX NOW"),1)
"RTN","ORCMED",36,0)
 . S ORLOG=+$E($$NOW^XLFDT,1,12),FIRST=1
"RTN","ORCMED",37,0)
XF2 . D DIALOG^ORCDLG Q:$G(ORQUIT)&FIRST  K ORQUIT
"RTN","ORCMED",38,0)
 . D ACCEPT^ORCHECK(),DISPLAY^ORCDLG S X=$$OK^ORCDLG I X="^" S ORQUIT=1 Q
"RTN","ORCMED",39,0)
 . I X="E" K ORCHECK S FIRST=0 G XF2
"RTN","ORCMED",40,0)
 . I X="C" W !?10,"... order cancelled.",! Q
"RTN","ORCMED",41,0)
 . I X="P" D
"RTN","ORCMED",42,0)
 . . D EN^ORCSAVE W !?10,$S(ORIFN:"... order placed.",1:"ERROR"),!
"RTN","ORCMED",43,0)
 . . S:$G(ORIFN) ^TMP("ORNEW",$J,ORIFN,1)=""
"RTN","ORCMED",44,0)
 . . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^(ORDIALOG)=ORDIALOG M:$D(^TMP("ORWORD",$J)) ^TMP("ORECALL",$J,ORDIALOG)=^TMP("ORWORD",$J) ;save 1st values
"RTN","ORCMED",45,0)
XFQ D EXIT^ORCDPS1 ;X:$D(^ORD(101.41,ORDIALOG,4)) ^(4)
"RTN","ORCMED",46,0)
 K ^TMP("ORWORD",$J),^TMP("ORSIG",$J)
"RTN","ORCMED",47,0)
 D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCMED",48,0)
 Q
"RTN","ORCMED",49,0)
 ;
"RTN","ORCMED",50,0)
IN ; -- Kill extra values, Reset ID's/DD from Inpt dialog
"RTN","ORCMED",51,0)
 N P F P="START DATE/TIME","NOW" K ORDIALOG($$PTR(P),1)
"RTN","ORCMED",52,0)
 D DOSES("O")
"RTN","ORCMED",53,0)
 Q
"RTN","ORCMED",54,0)
 ;
"RTN","ORCMED",55,0)
OUT ; -- Kill extra values, Reset ID's/DD from Outpt dialog
"RTN","ORCMED",56,0)
 N P I '$O(ORDIALOG($$PTR("INSTRUCTIONS"),0)) D  ;old sig in comments
"RTN","ORCMED",57,0)
 . N WP S WP=$$PTR("WORD PROCESSING 1") K ^TMP("ORSIG",$J)
"RTN","ORCMED",58,0)
 . M ^TMP("ORSIG",$J)=^TMP("ORWORD",$J,WP,1)
"RTN","ORCMED",59,0)
 . K ORDIALOG(WP,1),^TMP("ORWORD",$J,WP,1)
"RTN","ORCMED",60,0)
 F P="PATIENT INSTRUCTIONS","START DATE/TIME","DAYS SUPPLY","QUANTITY","REFILLS","ROUTING","SERVICE CONNECTED" K ORDIALOG($$PTR(P),1)
"RTN","ORCMED",61,0)
 I $G(ORDIALOG($$PTR("URGENCY"),1))=99 K ORDIALOG($$PTR("URGENCY"),1)
"RTN","ORCMED",62,0)
 D DOSES("I")
"RTN","ORCMED",63,0)
 Q
"RTN","ORCMED",64,0)
 ;
"RTN","ORCMED",65,0)
DOSES(TYPE)     ; -- Convert doses to new TYPE, reset ID strings
"RTN","ORCMED",66,0)
 N PSOI,ORMED,PROMPT,DOSE,DRUG,I,X,DD,DRUG0,STR
"RTN","ORCMED",67,0)
 F I="DISPENSE DRUG","STRENGTH","DRUG NAME","SIG" K ORDIALOG($$PTR(I),1)
"RTN","ORCMED",68,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(ORDIALOG($$PTR("ORDERABLE ITEM"),1)),0)),U,2),ORMED=$P($G(^(0)),U)
"RTN","ORCMED",69,0)
 D DOSE^PSSORUTL(.ORDOSE,PSOI,TYPE,+ORVP) I $G(ORDOSE(1))=-1 K ORDOSE
"RTN","ORCMED",70,0)
 S PROMPT=$$PTR("INSTRUCTIONS"),DOSE=$$PTR("DOSE")
"RTN","ORCMED",71,0)
 S DRUG=$$PTR("DISPENSE DRUG") D D1^ORCDPS2
"RTN","ORCMED",72,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  D
"RTN","ORCMED",73,0)
 . K ORDIALOG(DOSE,I) S X=$G(ORDIALOG(PROMPT,I)) Q:'$L(X)
"RTN","ORCMED",74,0)
 . S X=$$UP^XLFSTR(X),DD=+$G(ORDIALOG(PROMPT,"LIST","D",X)) Q:'DD
"RTN","ORCMED",75,0)
 . S ORDIALOG(DOSE,I)=$TR($G(ORDOSE("DD",DD,X)),"^","&")
"RTN","ORCMED",76,0)
 . S ORDIALOG(DRUG,I)=DD,DRUG0=$G(ORDOSE("DD",DD))
"RTN","ORCMED",77,0)
 . S STR=$P(DRUG0,U,5)_$P(DRUG0,U,6)
"RTN","ORCMED",78,0)
 . I STR'>0 S:'$G(ORDOSE(1)) ORDIALOG($$PTR("DRUG NAME"),1)=$P(DRUG0,U) Q
"RTN","ORCMED",79,0)
 . I ORMED'[STR,TYPE="O"!'$G(ORDOSE(1)) S ORDIALOG($$PTR("STRENGTH"),1)=STR
"RTN","ORCMED",80,0)
 Q
"RTN","ORCMED",81,0)
 ;
"RTN","ORCMED",82,0)
CONT() ; -- Want to continue processing orders?
"RTN","ORCMED",83,0)
 N X,Y,DIR
"RTN","ORCMED",84,0)
 S DIR(0)="YA",DIR("A")="Do you want to continue transferring orders? ",DIR("B")="YES"
"RTN","ORCMED",85,0)
 S DIR("?")="Enter YES to continue transferring the remaining orders selected, or NO to quit this option."
"RTN","ORCMED",86,0)
 D ^DIR
"RTN","ORCMED",87,0)
 Q +Y
"RTN","ORCMED",88,0)
 ;
"RTN","ORCMED",89,0)
SHOWSIG ; -- Show old sig for transfer in ^TMP("ORSIG",$J)
"RTN","ORCMED",90,0)
 N ORTX,I,X,ORMAX S ORMAX=72
"RTN","ORCMED",91,0)
 S I=0 F  S I=$O(^TMP("ORSIG",$J,I)) Q:I'>0  S X=$G(^(I,0)) D:$L(X) TXT^ORCHTAB
"RTN","ORCMED",92,0)
 S I=0 F  S I=$O(ORTX(I)) Q:I'>0  W !,$S(I=1:"(Sig: ",1:"      ")_ORTX(I)
"RTN","ORCMED",93,0)
 W ")"
"RTN","ORCMED",94,0)
 Q
"RTN","ORCMED",95,0)
 ;
"RTN","ORCMED",96,0)
PTR(NAME) ; -- Returns pointer to OR GTX NAME
"RTN","ORCMED",97,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORCMED",98,0)
 ;
"RTN","ORCMED",99,0)
REFILLS ; -- Request a refill for med orders
"RTN","ORCMED",100,0)
 ;    ORNMBR = #,#,...,# of selected orders
"RTN","ORCMED",101,0)
 ;
"RTN","ORCMED",102,0)
 N ORLK,ORI,NMBR,IDX,ORIFN,ORDITM,ORERR,ORQUIT,OROUT
"RTN","ORCMED",103,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") G:'ORNMBR RFQ
"RTN","ORCMED",104,0)
 D FREEZE^ORCMENU S VALMBCK="R"
"RTN","ORCMED",105,0)
 S ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" RFQ
"RTN","ORCMED",106,0)
 S:'$G(ORL) ORL=$$LOCATION^ORCMENU1 G:ORL="^" RFQ
"RTN","ORCMED",107,0)
 S OROUT=$$ROUTING G:OROUT="^" RFQ
"RTN","ORCMED",108,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCMED",109,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR)),ORIFN=+$P(IDX,U,4)
"RTN","ORCMED",110,0)
 . Q:'ORIFN  I '$D(^OR(100,ORIFN,0)) W !,"Invalid order number!" H 2 Q
"RTN","ORCMED",111,0)
 . S ORDITM=$$ORDITEM^ORCACT(ORIFN) D SUBHDR^ORCACT(ORDITM)
"RTN","ORCMED",112,0)
 . I '$$VALID^ORCACT0(ORIFN,"RF",.ORERR) W !,ORERR H 2 Q
"RTN","ORCMED",113,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !,$P(ORLK,U,2) H 2 Q
"RTN","ORCMED",114,0)
 . D REF^ORMBLDPS(ORIFN,OROUT),UNLK1^ORX2(+ORIFN)
"RTN","ORCMED",115,0)
 . W !?10,"... refill requested.",$$RETURN
"RTN","ORCMED",116,0)
RFQ Q
"RTN","ORCMED",117,0)
 ;
"RTN","ORCMED",118,0)
RETURN() ; -- press return to cont
"RTN","ORCMED",119,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCMED",120,0)
 Q ""
"RTN","ORCMED",121,0)
 ;
"RTN","ORCMED",122,0)
ROUTING() ; -- Routing for refill
"RTN","ORCMED",123,0)
 N X,Y,DIR S DIR(0)="SAM^W:WINDOW;M:MAIL;C:ADMINISTERED IN CLINIC;"
"RTN","ORCMED",124,0)
 S DIR("A")="Routing: ",DIR("B")=$S($D(^PSX(550,"C")):"MAIL",1:"WINDOW")
"RTN","ORCMED",125,0)
 S DIR("?")="Select how the patient is to receive this refill, by mail or at the window or in the clinic"
"RTN","ORCMED",126,0)
 D ^DIR S:$D(DTOUT)!(X["^") Y="^"
"RTN","ORCMED",127,0)
 Q Y
"RTN","ORCMED",128,0)
 ;
"RTN","ORCMED",129,0)
NW ; -- Order New Medication from Meds tab
"RTN","ORCMED",130,0)
 ;    Requires ORDIALOG      = name of pkg dialog
"RTN","ORCMED",131,0)
 ;             OREVENT       = event, if delaying orders
"RTN","ORCMED",132,0)
 ;             OREVENT("TS") = treating spec, if admission or transfer
"RTN","ORCMED",133,0)
 N ORPTLK G:'$L($G(ORDIALOG)) NWQ
"RTN","ORCMED",134,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","ORCMED",135,0)
 D FREEZE^ORCMENU S VALMBCK="R"
"RTN","ORCMED",136,0)
 S ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" NWQ
"RTN","ORCMED",137,0)
 I '$G(ORL) S ORL=$S($G(OREVENT):$$LOC^OREVNTX(OREVENT),1:$$LOCATION^ORCMENU1) G:ORL["^" NWQ
"RTN","ORCMED",138,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",$E(ORDIALOG,1,63),0)) G:'ORDIALOG NWQ
"RTN","ORCMED",139,0)
 D ADD^ORCDLG,REBLD^ORCMENU:$D(^TMP("ORNEW",$J))
"RTN","ORCMED",140,0)
 K ORDIALOG,^TMP("ORWORD",$J),^TMP("ORECALL",$J) S VALMBCK="R"
"RTN","ORCMED",141,0)
NWQ D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCMED",142,0)
 Q
"RTN","ORWDX")
0^3^B73765779
"RTN","ORWDX",1,0)
ORWDX ; SLC/KCM/REV/JLI - Order dailog utilities ;2/20/03 9:30AM
"RTN","ORWDX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,132,141,164,178**;Dec 17, 1997
"RTN","ORWDX",3,0)
NXT() ; -- Gets index in array
"RTN","ORWDX",4,0)
 S ILST=ILST+1
"RTN","ORWDX",5,0)
 Q ILST
"RTN","ORWDX",6,0)
ORDITM(Y,FROM,DIR,XREF) ; Subset of orderable items
"RTN","ORWDX",7,0)
 ; Y(n)=IEN^.01 Name^.01 Name  -or-  IEN^Synonym <.01 Name>^.01 Name
"RTN","ORWDX",8,0)
 N I,IEN,CNT,X,DTXT,CURTM
"RTN","ORWDX",9,0)
 S I=0,CNT=44,CURTM=$$NOW^XLFDT
"RTN","ORWDX",10,0)
 F  Q:I'<CNT  S FROM=$O(^ORD(101.43,XREF,FROM),DIR) Q:FROM=""  D
"RTN","ORWDX",11,0)
 . S IEN="" F  S IEN=$O(^ORD(101.43,XREF,FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWDX",12,0)
 . . S X=^ORD(101.43,XREF,FROM,IEN)
"RTN","ORWDX",13,0)
 . . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDX",14,0)
 . . Q:$P(X,U,5)  S I=I+1
"RTN","ORWDX",15,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)
"RTN","ORWDX",16,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_"<"_$P(X,U,4)_">"_U_$P(X,U,4)
"RTN","ORWDX",17,0)
 Q
"RTN","ORWDX",18,0)
ODITMBC(Y,XREF,ODLST) ; --Info based on Orderable ItemIen
"RTN","ORWDX",19,0)
 N CNT,NM,XRF
"RTN","ORWDX",20,0)
 S CNT=0,NM=0,XRF=XREF
"RTN","ORWDX",21,0)
 F  S CNT=$O(ODLST(CNT)) Q:'CNT  D FNDINFO(.Y,ODLST(CNT))
"RTN","ORWDX",22,0)
 Q
"RTN","ORWDX",23,0)
FNDINFO(Y,ODIEN) ;
"RTN","ORWDX",24,0)
 N ODI,CRTM,FRM,XX
"RTN","ORWDX",25,0)
 S FRM="",CRTM=$$NOW^XLFDT
"RTN","ORWDX",26,0)
 F  S FRM=$O(^ORD(101.43,XRF,FRM)) Q:FRM=""  D
"RTN","ORWDX",27,0)
 . S ODI=0 F  S ODI=$O(^ORD(101.43,XRF,FRM,ODI)) Q:'ODI  D
"RTN","ORWDX",28,0)
 .. S XX=^ORD(101.43,XRF,FRM,ODI)
"RTN","ORWDX",29,0)
 .. I +$P(XX,U,3),$P(XX,U,3)<CRTM Q
"RTN","ORWDX",30,0)
 .. I ODI=ODIEN D
"RTN","ORWDX",31,0)
 ... S NM=NM+1
"RTN","ORWDX",32,0)
 ... I 'XX S Y(NM)=ODIEN_U_$P(XX,U,2)_U_$P(XX,U,2)
"RTN","ORWDX",33,0)
 ... E  S Y(NM)=ODIEN_U_$P(XX,U,2)_$C(9)_"<"_$P(XX,U,4)_">"_U_$P(XX,U,4)
"RTN","ORWDX",34,0)
 Q
"RTN","ORWDX",35,0)
DLGDEF(LST,DLG) ; Format mapping for a dlg
"RTN","ORWDX",36,0)
 N I,IEN,ILST,X0,X2,XW  S ILST=0
"RTN","ORWDX",37,0)
 I $O(^ORD(101.41,"AB",DLG,0))>0 S DLG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX",38,0)
 E  S DLG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX",39,0)
 Q:'DLG
"RTN","ORWDX",40,0)
 S I=0 F  S I=$O(^ORD(101.41,DLG,10,I)) Q:I'>0  D
"RTN","ORWDX",41,0)
 . S X0=$G(^ORD(101.41,DLG,10,I,0)),X2=$G(^(2)),IEN=+$P(X0,U,2)
"RTN","ORWDX",42,0)
 . S ILST=ILST+1,LST(ILST)=U_IEN_U_$P(X2,U,1,7)
"RTN","ORWDX",43,0)
 . I $P(X0,U,11) S $P(LST(ILST),U,11)=1
"RTN","ORWDX",44,0)
 . S $P(LST(ILST),U)=$P($G(^ORD(101.41,IEN,1)),U,3)
"RTN","ORWDX",45,0)
 . I $P($G(^ORD(101.41,IEN,0)),U)="OR GTX ADDITIVE" S $P(LST(ILST),U)="ADDITIVE"
"RTN","ORWDX",46,0)
 . I $L($P(LST(ILST),U))=0 S $P(LST(ILST),U)="ID"_IEN
"RTN","ORWDX",47,0)
 . I $D(^ORD(101.41,DLG,10,"DAD",IEN)) D
"RTN","ORWDX",48,0)
 .. N SEQ,DA,CHILD S CHILD=""
"RTN","ORWDX",49,0)
 .. S SEQ=0 F  S SEQ=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ)) Q:'SEQ  D
"RTN","ORWDX",50,0)
 ... S DA=0 F  S DA=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ,DA)) Q:'DA  D
"RTN","ORWDX",51,0)
 .... S CHILD=CHILD_+$P($G(^ORD(101.41,DLG,10,DA,0)),U,2)_"~"
"RTN","ORWDX",52,0)
 .. S $P(LST(ILST),U,10)=CHILD
"RTN","ORWDX",53,0)
 Q
"RTN","ORWDX",54,0)
DLGQUIK(LST,QO) ; Responses for quick order  (NOT USED)
"RTN","ORWDX",55,0)
 D LOADRSP(.LST,QO)
"RTN","ORWDX",56,0)
 Q
"RTN","ORWDX",57,0)
LOADRSP(LST,RSPID)      ; Load responses from 101.41 or 100
"RTN","ORWDX",58,0)
 ; RSPID:  C123456;1-3243 = cached copy,   134-3234 = cached quick
"RTN","ORWDX",59,0)
 ;         X123456;1      = change order,  134      = quick dialog
"RTN","ORWDX",60,0)
 N I,J,DLG,INST,ID,VAL,ILST,ROOT S ROOT=""
"RTN","ORWDX",61,0)
 I RSPID["-" S ROOT="^TMP(""ORWDXMQ"",$J,"""_RSPID_""")" G XROOT
"RTN","ORWDX",62,0)
 I $E(RSPID)="X" S ROOT="^OR(100,"_+$P(RSPID,"X",2)_",4.5)"  G XROOT
"RTN","ORWDX",63,0)
 I +RSPID=RSPID  S ROOT="^ORD(101.41,"_+RSPID_",6)" G XROOT
"RTN","ORWDX",64,0)
 Q:ROOT=""
"RTN","ORWDX",65,0)
XROOT S (ILST,I)=0 F  S I=$O(@ROOT@(I)) Q:I'>0  D
"RTN","ORWDX",66,0)
 . S DLG=$P(@ROOT@(I,0),U,2),INST=$P(^(0),U,3)
"RTN","ORWDX",67,0)
 . S ID=$P($G(^ORD(101.41,DLG,1)),U,3)
"RTN","ORWDX",68,0)
 . I '$L(ID) S ID="ID"_DLG
"RTN","ORWDX",69,0)
 . S VAL=$G(@ROOT@(I,1))
"RTN","ORWDX",70,0)
 . I $P($G(^ORD(101.41,DLG,0)),U)="OR GTX ADDITIVE" S ID="ADDITIVE"
"RTN","ORWDX",71,0)
 . I $E(RSPID)="C",(ID="START"),VAL Q  ; skip literal start time on copy
"RTN","ORWDX",72,0)
 . S LST($$NXT)="~"_DLG_U_INST_U_ID
"RTN","ORWDX",73,0)
 . I $L(VAL) D
"RTN","ORWDX",74,0)
 .. S LST($$NXT)="i"_VAL,LST($$NXT)="e"_$$EXTVAL(VAL,DLG)
"RTN","ORWDX",75,0)
 . I $D(@ROOT@(I,2))>1 D
"RTN","ORWDX",76,0)
 .. S J=0 F  S J=$O(@ROOT@(I,2,J)) Q:J'>0  D
"RTN","ORWDX",77,0)
 ... S LST($$NXT)="t"_$G(@ROOT@(I,2,J,0))
"RTN","ORWDX",78,0)
 I $E(ROOT,1,4)="^TMP" K ^TMP("ORWDXMQ",$J)
"RTN","ORWDX",79,0)
 Q
"RTN","ORWDX",80,0)
SAVE(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,ORDIALOG,ORDEA) ;
"RTN","ORWDX",81,0)
 ; ORVP=DFN, ORNP=Provider, ORL=Location, DLG=Order Dialog,
"RTN","ORWDX",82,0)
 ; ORDG=Display Group, ORIT=Quick Order Dialog,
"RTN","ORWDX",83,0)
 N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORLEAD,ORTRAIL,ORPKG,ORWP94,ORCATFN,OREVTYPE,ONPASS
"RTN","ORWDX",84,0)
 S ORCATFN=""
"RTN","ORWDX",85,0)
 I $L($P(DLG,U,2)) S ORCATFN=$P(DLG,U,2),DLG=$P(DLG,U,1)
"RTN","ORWDX",86,0)
 I $G(ORDIALOG("ORTS")) S ORTS=ORDIALOG("ORTS") K ORDIALOG("ORTS")
"RTN","ORWDX",87,0)
 I $G(ORDIALOG("ORSLOG")) S ORLOG=ORDIALOG("ORSLOG") K ORDIALOG("ORSLOG")
"RTN","ORWDX",88,0)
 I $D(ORDIALOG("OREVENT")) S OREVENT=ORDIALOG("OREVENT") K ORDIALOG("OREVENT")
"RTN","ORWDX",89,0)
 I $L($G(OREVENT)) D
"RTN","ORWDX",90,0)
 . S ONPASS=0
"RTN","ORWDX",91,0)
 . S OREVTYPE=$$TYPE^OREVNTX(OREVENT)
"RTN","ORWDX",92,0)
 . I OREVTYPE="T" D ISPASS^OREVNTX1(.ONPASS,+OREVENT,"T")
"RTN","ORWDX",93,0)
 . S ORCAT=$S(OREVTYPE="A":"I",OREVTYPE="T":"I",ONPASS=1:"O",1:"O")
"RTN","ORWDX",94,0)
 E  S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWDX",95,0)
 I DLG="PS MEDS" S ORWP94=1 D
"RTN","ORWDX",96,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO SUPPLY",0)) S DLG="PSO SUPPLY"
"RTN","ORWDX",97,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO OERR",0)) S DLG="PSO OERR"
"RTN","ORWDX",98,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSJ OR PAT OE",0)) S DLG="PSJ OR PAT OE"
"RTN","ORWDX",99,0)
 I DLG="PSO OERR" S ORCAT="O" I $G(OREVENT("EFFECTIVE")) D
"RTN","ORWDX",100,0)
 . S ORDIALOG($O(^ORD(101.41,"B","OR GTX START DATE"_$S($G(ORWP94):"/TIME",1:""),0)),1)=OREVENT("EFFECTIVE")
"RTN","ORWDX",101,0)
 I DLG="PSJ OR PAT OE" S ORCAT="I"
"RTN","ORWDX",102,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDX",103,0)
 K:'ORDG ORDG K:'ORIT ORIT ; Dgrp & Quick must be non-zero
"RTN","ORWDX",104,0)
 M ORCHECK=ORDIALOG("ORCHECK") K ORDIALOG("ORCHECK")
"RTN","ORWDX",105,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX",106,0)
 I 'ORDIALOG S ORDIALOG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX",107,0)
 I $D(ORDIALOG("ORLEAD")) S ORLEAD=ORDIALOG("ORLEAD")
"RTN","ORWDX",108,0)
 I $D(ORDIALOG("ORTRAIL")) S ORTRAIL=ORDIALOG("ORTRAIL")
"RTN","ORWDX",109,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORWDX",110,0)
 I $L(ORCATFN) S ORCAT=ORCATFN
"RTN","ORWDX",111,0)
 I $G(ORWP94) D
"RTN","ORWDX",112,0)
 . N SIGPRMT S SIGPRMT=$O(^ORD(101.41,"B","OR GTX SIG",0))
"RTN","ORWDX",113,0)
 . N INSPRMT S INSPRMT=$O(^ORD(101.41,"B","OR GTX INSTRUCTIONS",0))
"RTN","ORWDX",114,0)
 . I $L($G(ORDIALOG(SIGPRMT,1))) S ORDIALOG(INSPRMT,"FORMAT")="@"
"RTN","ORWDX",115,0)
 . I ORCAT="O" S ORPKG=$O(^DIC(9.4,"C","PSO",0))
"RTN","ORWDX",116,0)
 . I ORCAT="I" S ORPKG=$O(^DIC(9.4,"C","PSJ",0))
"RTN","ORWDX",117,0)
 I $G(ORIFN)="" D  ; new order
"RTN","ORWDX",118,0)
 . D EN^ORCSAVE
"RTN","ORWDX",119,0)
 . S REC="" I ORIFN D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",120,0)
 . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^TMP("ORECALL",$J,ORDIALOG)=ORDIALOG
"RTN","ORWDX",121,0)
 E  D
"RTN","ORWDX",122,0)
 . N OR0
"RTN","ORWDX",123,0)
 . S OR0=$G(^OR(100,+ORIFN,0)),ORSTS=$P($G(^(3)),U,3),ORDG=$P(OR0,U,11)
"RTN","ORWDX",124,0)
 . I $L($P(OR0,U,17)),ORSTS=10 S OREVENT=$P(OR0,U,17),OREVENT("TS")=$P(OR0,U,13)
"RTN","ORWDX",125,0)
 . D XX^ORCSAVE ; edit order
"RTN","ORWDX",126,0)
 . S REC="" S ORIFN=+ORIFN_";"_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",127,0)
 Q
"RTN","ORWDX",128,0)
SENDED(ORWLST,ORIENS,TS,LOC) ; Release EDOs to svc
"RTN","ORWDX",129,0)
 N OK,ORVP,ORWERR,ORSIGST,ORDA,ORNATURE,ORIX,X,PTEVT,ORIFN
"RTN","ORWDX",130,0)
 S ORWERR="",ORIX=0,LOC=LOC_";SC("
"RTN","ORWDX",131,0)
 F  S ORIX=$O(ORIENS(ORIX)) Q:'ORIX  D
"RTN","ORWDX",132,0)
 . S ORIFN=ORIENS(ORIX)
"RTN","ORWDX",133,0)
 . S ORDA=$P(ORIFN,";",2) S:'ORDA ORDA=1
"RTN","ORWDX",134,0)
 . S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2)
"RTN","ORWDX",135,0)
 . I $D(^OR(100,+ORIFN,8,ORDA,0)) D
"RTN","ORWDX",136,0)
 .. S ORSIGST=$P($G(^(0)),U,4)
"RTN","ORWDX",137,0)
 .. S ORNATURE=$P($G(^(0)),U,12)
"RTN","ORWDX",138,0)
 . S:$G(LOC) $P(^OR(100,+ORIFN,0),U,10)=LOC ;set location
"RTN","ORWDX",139,0)
 . S:$G(TS) $P(^OR(100,+ORIFN,0),U,13)=TS ;set specialty
"RTN","ORWDX",140,0)
 . S OK=$$LOCK1^ORX2(ORIFN) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",141,0)
 . I OK D EN2^ORCSEND(ORIENS(ORIX),ORSIGST,ORNATURE,.ORWERR),UNLK1^ORX2(ORIENS(ORIX))
"RTN","ORWDX",142,0)
 . S ORWLST(ORIX)=ORIENS(ORIX)
"RTN","ORWDX",143,0)
 . I $L(ORWERR) S ORWLST(ORIX)=ORWLST(ORIX)_"^E^"_ORWERR Q
"RTN","ORWDX",144,0)
 . E  D
"RTN","ORWDX",145,0)
 .. S PTEVT=$P($G(^OR(100,+ORIENS(ORIX),0)),U,17)
"RTN","ORWDX",146,0)
 .. D:$$TYPE^OREVNTX(PTEVT)="M" SAVE^ORMEVNT1(ORIENS(ORIX),PTEVT,2)
"RTN","ORWDX",147,0)
 . S X="RS"
"RTN","ORWDX",148,0)
 . S $P(ORWLST(ORIX),U,2)=X
"RTN","ORWDX",149,0)
 Q
"RTN","ORWDX",150,0)
SEND(ORWLST,DFN,ORNP,ORL,ES,ORWREC) ; Sign
"RTN","ORWDX",151,0)
 ; DFN=Patient, ORNP=Provider, ORL=Location, ES=Encrypted ES code
"RTN","ORWDX",152,0)
 ; ORWREC(n)=ORIFN;Action^Signature Sts^Release Sts^Nature of Order
"RTN","ORWDX",153,0)
SEND1 N ORVP,ORWI,ORWERR,ORWREL,ORWSIG,ORWNATR,ORDERID,ORBEF,ORLR,ORLAB,X
"RTN","ORWDX",154,0)
 S ORVP=DFN_";DPT(",ORL=ORL_";SC(",ORL(2)=ORL,ORWLST=0
"RTN","ORWDX",155,0)
 S ORLR=+$O(^DIC(9.4,"C","LR",0))
"RTN","ORWDX",156,0)
 S ORWI=0 F  S ORWI=$O(ORWREC(ORWI)) Q:'ORWI  D
"RTN","ORWDX",157,0)
 . S X=ORWREC(ORWI),ORWERR=""
"RTN","ORWDX",158,0)
 . S ORDERID=$P(X,U),ORWSIG=$P(X,U,2),ORWREL=$P(X,U,3),ORWNATR=$P(X,U,4)
"RTN","ORWDX",159,0)
 . S ORBEF=0
"RTN","ORWDX",160,0)
 . I '$D(^OR(100,+ORDERID,0)) Q
"RTN","ORWDX",161,0)
 . I $D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) S ORBEF=$P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),U,15)
"RTN","ORWDX",162,0)
 . S:$D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) ORWNATR=$S($P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),"^",4)=3:"",1:ORWNATR) ;If order doesn't require signature leave nature at electronic --added with patch 110
"RTN","ORWDX",163,0)
 . S ORWERR=$$CHKACT^ORWDXR(ORDERID,ORWSIG,ORWREL,ORWNATR)
"RTN","ORWDX",164,0)
 . I $L(ORWERR) S ORWERR="1^"_ORWERR
"RTN","ORWDX",165,0)
 . I '$L(ORWERR) D
"RTN","ORWDX",166,0)
 .. I $P(^OR(100,+ORDERID,0),U,14)=ORLR,'$G(ORLAB) D  ; lab batch start
"RTN","ORWDX",167,0)
 ... I $L($T(BHS^ORMBLD)) D BHS^ORMBLD(ORVP) S ORLAB=1
"RTN","ORWDX",168,0)
 .. N OK S OK=$$LOCK1^ORX2(ORDERID) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",169,0)
 .. I OK D EN^ORCSEND(ORDERID,"",ORWSIG,ORWREL,ORWNATR,"",.ORWERR),UNLK1^ORX2(ORDERID)
"RTN","ORWDX",170,0)
 . S ORWLST(ORWI)=ORDERID,X=""
"RTN","ORWDX",171,0)
 . I $L(ORWERR) S ORWLST(ORWI)=ORWLST(ORWI)_"^E^"_ORWERR Q
"RTN","ORWDX",172,0)
 . I ORWREL,((ORBEF=10)!(ORBEF=11)),($P(^OR(100,+ORDERID,3),U,3)'=10) S X="R"
"RTN","ORWDX",173,0)
 . I ORWSIG'=2 S X=X_"S"
"RTN","ORWDX",174,0)
 . S $P(ORWLST(ORWI),U,2)=X
"RTN","ORWDX",175,0)
 I $G(ORLAB) D BTS^ORMBLD(ORVP)
"RTN","ORWDX",176,0)
 Q
"RTN","ORWDX",177,0)
EXTVAL(IVAL,DLG) ; External value given a dlg ptr
"RTN","ORWDX",178,0)
 N ORDIALOG
"RTN","ORWDX",179,0)
 S ORDIALOG(DLG,0)=$P($G(^ORD(101.41,DLG,1)),U,1,2)
"RTN","ORWDX",180,0)
 S ORDIALOG(DLG,1)=IVAL
"RTN","ORWDX",181,0)
 I $E(ORDIALOG(DLG,0))="R",(+IVAL'=IVAL) Q IVAL  ; free text date/time
"RTN","ORWDX",182,0)
 Q $$EXT^ORCD(DLG,1)  ; all others
"RTN","ORWDX",183,0)
DLGID(VAL,ORIFN) ; return dlg IEN for order
"RTN","ORWDX",184,0)
 S VAL=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",185,0)
 S VAL=$S($P(VAL,";",2)="ORD(101.41,":+VAL,1:0)
"RTN","ORWDX",186,0)
 Q
"RTN","ORWDX",187,0)
FORMID(VAL,ORIFN)  ; Base dlg FormID for an order
"RTN","ORWDX",188,0)
 N DLG
"RTN","ORWDX",189,0)
 S VAL=0,DLG=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",190,0)
 Q:$P(DLG,";",2)'="ORD(101.41,"
"RTN","ORWDX",191,0)
 D FORMID^ORWDXM(.VAL,+DLG)
"RTN","ORWDX",192,0)
 Q
"RTN","ORWDX",193,0)
AGAIN(VAL,DLG)  ; return true to keep dlg for another order
"RTN","ORWDX",194,0)
 S VAL=''$P($G(^ORD(101.41,DLG,0)),U,9)
"RTN","ORWDX",195,0)
 Q
"RTN","ORWDX",196,0)
DGRP(VAL,DLG)   ; Display grp pointer for a dlg
"RTN","ORWDX",197,0)
 S DLG=$S($E(DLG)="`":+$P(DLG,"`",2),1:$O(^ORD(101.41,"AB",DLG,0))) ;kcm
"RTN","ORWDX",198,0)
 S VAL=$P($G(^ORD(101.41,DLG,0)),U,5)
"RTN","ORWDX",199,0)
 Q
"RTN","ORWDX",200,0)
DGNM(VAL,NM) ; Display grp pointer for name
"RTN","ORWDX",201,0)
 S VAL=$O(^ORD(100.98,"B",NM,0))
"RTN","ORWDX",202,0)
 Q
"RTN","ORWDX",203,0)
WRLST(LST,LOC) ; List of dlgs for writing orders
"RTN","ORWDX",204,0)
 G WRLST1^ORWDX1 ;moved to new routine
"RTN","ORWDX",205,0)
MSG(LST,IEN) ; Msg text for orderable item
"RTN","ORWDX",206,0)
 N I
"RTN","ORWDX",207,0)
 S I=0 F  S I=$O(^ORD(101.43,IEN,8,I)) Q:I'>0  S LST(I)=^(I,0)
"RTN","ORWDX",208,0)
 Q
"RTN","ORWDX",209,0)
DISMSG(VAL,IEN) ; Disabled mge for ordering dlg
"RTN","ORWDX",210,0)
 S VAL=$P($G(^ORD(101.41,+IEN,0)),U,3)
"RTN","ORWDX",211,0)
 Q
"RTN","ORWDX",212,0)
LOCK(OK,DFN) ; Attempt to lock pt for ordering
"RTN","ORWDX",213,0)
 S OK=$$LOCK^ORX2(DFN)
"RTN","ORWDX",214,0)
 Q
"RTN","ORWDX",215,0)
UNLOCK(OK,DFN) ; Unlock pt for ordering
"RTN","ORWDX",216,0)
 D UNLOCK^ORX2(DFN) S OK=1
"RTN","ORWDX",217,0)
 Q
"RTN","ORWDX",218,0)
LOCKORD(OK,ORIFN) ; Attempt to lock order
"RTN","ORWDX",219,0)
 S OK=$$LOCK1^ORX2(ORIFN)
"RTN","ORWDX",220,0)
 Q
"RTN","ORWDX",221,0)
UNLKORD(OK,ORIFN) ; Unlock order
"RTN","ORWDX",222,0)
 D UNLK1^ORX2(ORIFN) S OK=1
"RTN","ORWDX",223,0)
 Q
"RTN","ORWDXM1")
0^4^B66735132
"RTN","ORWDXM1",1,0)
ORWDXM1 ; SLC/KCM - Order Dialogs, Menus;2/19/03
"RTN","ORWDXM1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,131,132,141,178**;Dec 17, 1997
"RTN","ORWDXM1",3,0)
BLDQRSP(LST,ORIT,FLDS) ; Build responses for an order
"RTN","ORWDXM1",4,0)
 ; LST=QuickLevel^ResponseID(ORIT;$H)^Dialog^Type^FormID^DGrp
"RTN","ORWDXM1",5,0)
 ; LST(n)=verify text or rejection text
"RTN","ORWDXM1",6,0)
 ; ORIT= ptr to 101.41 for quick order, 100 for copy
"RTN","ORWDXM1",7,0)
 ;       1   2    3    4   5   6    7    8        11-20
"RTN","ORWDXM1",8,0)
 ; FLDS=DFN^LOC^ORNP^INPT^SEX^AGE^EVENT^SC%^^^Key Variables...
"RTN","ORWDXM1",9,0)
 ; ORIT=+ORIT: ptr to 101.41, $E(ORIT)=C: copy $E(ORIT)=X: change
"RTN","ORWDXM1",10,0)
 ; !! SHOULD ALSO CHECK for PRE-CPRS ORDERS (treat as text?)
"RTN","ORWDXM1",11,0)
 K ^TMP("ORWDXMQ",$J)
"RTN","ORWDXM1",12,0)
 N ORWMODE ; 0:Dialog,Quick 1:copy order 2:change order
"RTN","ORWDXM1",13,0)
 N TEMPCAT ; patient category from DPT file
"RTN","ORWDXM1",14,0)
 N ISXFER ; If it is transfer order   
"RTN","ORWDXM1",15,0)
 S ORWMODE=0,ISXFER=""
"RTN","ORWDXM1",16,0)
 S:$E(ORIT)="C" ORWMODE=1 S:$E(ORIT)="T" ORWMODE=1,ISXFER=";T" ;treat xfer as copy for now
"RTN","ORWDXM1",17,0)
 S:$E(ORIT)="X" ORWMODE=2
"RTN","ORWDXM1",18,0)
 I ORWMODE S ORIT=$E(ORIT,2,999)
"RTN","ORWDXM1",19,0)
 S LST(0)=""
"RTN","ORWDXM1",20,0)
 D CHKDSBL^ORWDXM3(.LST,ORIT,ORWMODE) Q:+LST(0)=8  ;disable
"RTN","ORWDXM1",21,0)
 D CHKVACT^ORWDXM3(.LST,ORIT,ORWMODE,$P(FLDS,U,3)) Q:+LST(0)=8  ;action
"RTN","ORWDXM1",22,0)
 I ORWMODE=1 D CHKCOPY^ORWDXM3(.LST,ORIT,FLDS) Q:+LST(0)=8  ;no copy
"RTN","ORWDXM1",23,0)
 I ORWMODE=2 D BLD4CHG^ORWDXM3(.LST,ORIT,FLDS) Q  ;change
"RTN","ORWDXM1",24,0)
 I 'ORWMODE,($P(^ORD(101.41,+ORIT,0),U,4)="D"),'($O(^DIC(9.4,"C","OR",0))[$P(^ORD(101.41,+ORIT,0),U,7)) S LST(0)="0^0^"_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER) Q
"RTN","ORWDXM1",25,0)
 ;radilogy specific variables
"RTN","ORWDXM1",26,0)
 N ORIMTYPE
"RTN","ORWDXM1",27,0)
 ;lab specific variables
"RTN","ORWDXM1",28,0)
 N LRFZX,LRFSAMP,LRFSPEC,LRFDATE,LRFURG,LRFSCH
"RTN","ORWDXM1",29,0)
 N ORTIME,ORCOLLCT,ORMAX,ORTEST,ORIMTIME,ORSMAX,ORSTMS,ORSCH
"RTN","ORWDXM1",30,0)
 ;pharmacy specific variables
"RTN","ORWDXM1",31,0)
 N PSJNOPC,ORMORE,ORINPT,ORXNP,ORSCHED,ORQTY,ORNOUNS,ORXNP,OREFILLS
"RTN","ORWDXM1",32,0)
 N ORCOMPLX,ORQTY,ORCOPAY,ORDRUG,ORWPSPIK,ORWPSWRG,ORSD,ORDSUP,ORWP94
"RTN","ORWDXM1",33,0)
 ;dietetics specific variables
"RTN","ORWDXM1",34,0)
 N ORPARAM,ORNPO,ORTIME,ORMEAL,ORTRAY,ORDATE
"RTN","ORWDXM1",35,0)
 ;consults specific variables
"RTN","ORWDXM1",36,0)
 N GMRCNOPD,GMRCNOAT,GMRCREAF
"RTN","ORWDXM1",37,0)
 ; setup general environment
"RTN","ORWDXM1",38,0)
 N ORTYPE,ORVP,ORL,ORNP,ORSEX,ORAGE,ORWARD,OREVENT,ORDIV,ORSC,KEYVAR
"RTN","ORWDXM1",39,0)
 N ORDG,ORDIALOG,ORCAT,FIRST,ORQUIT,X,ORTRAIL,ORLEAD,RSPREF,AUTOACK
"RTN","ORWDXM1",40,0)
 N OREVNTYP
"RTN","ORWDXM1",41,0)
 S ORWP94=$O(^ORD(101.41,"AB","PS MEDS",0))>0
"RTN","ORWDXM1",42,0)
 S ORVP=$P(FLDS,U,1)_";DPT(",ORNP=+$P(FLDS,U,3),ORSC=$P(FLDS,U,8)
"RTN","ORWDXM1",43,0)
 S ORL=$P(FLDS,U,2)_";SC(",ORL(2)=ORL
"RTN","ORWDXM1",44,0)
 S ORSEX=$P(FLDS,U,5),ORAGE=$P(FLDS,U,6),ORTYPE="Q",FIRST=1
"RTN","ORWDXM1",45,0)
 I $P(FLDS,U,4),$G(^SC(+ORL,42)) S ORWARD=+^SC(+ORL,42)
"RTN","ORWDXM1",46,0)
 I $L($P(FLDS,U,7))  D
"RTN","ORWDXM1",47,0)
 . S OREVENT=$P(FLDS,U,7)
"RTN","ORWDXM1",48,0)
 . S OREVNTYP=$P(OREVENT,";",2)
"RTN","ORWDXM1",49,0)
 . S OREVENT("TS")=$P(OREVENT,";",3)
"RTN","ORWDXM1",50,0)
 . S OREVENT("EFFECTIVE")=$P(OREVENT,";",4)
"RTN","ORWDXM1",51,0)
 . S OREVENT=+$P(OREVENT,";",1)
"RTN","ORWDXM1",52,0)
 I 'ORWMODE D
"RTN","ORWDXM1",53,0)
 . D SETKEYV^ORWDXM3($P(FLDS,U,11,20)) ; from menu path
"RTN","ORWDXM1",54,0)
 . S KEYVAR=$$KEYVAR^ORWDXM3(ORIT) ; from entry action
"RTN","ORWDXM1",55,0)
 . D SETKEYV^ORWDXM3(KEYVAR)
"RTN","ORWDXM1",56,0)
 K ^TMP("ORWORD",$J)
"RTN","ORWDXM1",57,0)
 ; initialize return record based on auto-accept
"RTN","ORWDXM1",58,0)
 I ORWMODE S LST(0)="2^"_ORIT ;verify on copy 
"RTN","ORWDXM1",59,0)
 E  S LST(0)=+$P($G(^ORD(101.41,ORIT,5)),U,8)_U_ORIT
"RTN","ORWDXM1",60,0)
 S TEMPCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWDXM1",61,0)
 I $L($G(OREVNTYP)) D
"RTN","ORWDXM1",62,0)
 . S ORCAT=$S(OREVNTYP="A":"I",OREVNTYP="T":"I",OREVNTYP="O":TEMPCAT,OREVNTYP="M":TEMPCAT,OREVNTYP="C":TEMPCAT,1:"O") I $G(OREVENT) D
"RTN","ORWDXM1",63,0)
 .. N X S X=$$EVT^OREVNTX(OREVENT),X=$P($G(^ORD(100.5,+X,0)),U,7)
"RTN","ORWDXM1",64,0)
 .. I OREVNTYP="T",X,X<4 S ORCAT="O" ;To pass=outpt
"RTN","ORWDXM1",65,0)
 .. I OREVNTYP="D",X=41 S ORCAT="I" ;From ASIH=inpt
"RTN","ORWDXM1",66,0)
 E  S ORCAT=TEMPCAT
"RTN","ORWDXM1",67,0)
 D SETUP^ORWDXM4 Q:+LST(0)=8
"RTN","ORWDXM1",68,0)
 S X=$S($G(ORWP94):"OR GTX START DATE/TIME",1:"OR GTX START DATE")
"RTN","ORWDXM1",69,0)
 I ORWMODE,(ORDG=+$O(^ORD(100.98,"B","O RX",0))) K ORDIALOG($$PTR^ORCD(X),1)
"RTN","ORWDXM1",70,0)
 ; pharmacy uses ORCAT to know which package the order goes to
"RTN","ORWDXM1",71,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSO OERR",0)) S ORCAT="O"
"RTN","ORWDXM1",72,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSJ OR PAT OE",0)) D
"RTN","ORWDXM1",73,0)
 . I ORCAT="O" S ORWPSWRG="" ; not auto-ack, pt not inpt
"RTN","ORWDXM1",74,0)
 . S ORCAT="I"
"RTN","ORWDXM1",75,0)
 I ORCAT="O",$D(OREVENT("EFFECTIVE")),(ORDG=+$O(^ORD(100.98,"B","O RX",0))) D
"RTN","ORWDXM1",76,0)
 . S ORDIALOG($O(^ORD(101.41,"B",X,0)),1)=OREVENT("EFFECTIVE")
"RTN","ORWDXM1",77,0)
 I ORDIALOG=$O(^ORD(101.41,"B","RA OERR EXAM",0))         D RA^ORWDXM2 G XENV
"RTN","ORWDXM1",78,0)
 I ORDIALOG=$O(^ORD(101.41,"B","LR OTHER LAB TESTS",0))   D LR^ORWDXM2 G XENV
"RTN","ORWDXM1",79,0)
 I ORDIALOG=$O(^ORD(101.41,"B","FHW1",0))                 D DO^ORWDXM2 G XENV
"RTN","ORWDXM1",80,0)
 I ORDIALOG=$O(^ORD(101.41,"B","FHW2",0))                 D EL^ORWDXM2 G XENV
"RTN","ORWDXM1",81,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSJ OR PAT OE",0))        D UD^ORWDXM2 G XENV
"RTN","ORWDXM1",82,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",0)) D IV^ORWDXM2 G XENV
"RTN","ORWDXM1",83,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSO OERR",0))             D OP^ORWDXM2 G XENV
"RTN","ORWDXM1",84,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSO SUPPLY",0))           D OP^ORWDXM2 G XENV
"RTN","ORWDXM1",85,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PS MEDS",0))              D PS^ORWDPS3 G XENV
"RTN","ORWDXM1",86,0)
 I ORDIALOG=$O(^ORD(101.41,"B","GMRAOR ALLERGY ENTER/EDIT",0)) S ORQUIT=1
"RTN","ORWDXM1",87,0)
XENV ;    end case
"RTN","ORWDXM1",88,0)
 Q:+LST(0)=8
"RTN","ORWDXM1",89,0)
 I $G(ORQUIT) S LST(0)="0^0^"_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER)_"^"_$G(KEYVAR) Q
"RTN","ORWDXM1",90,0)
 N SEQ,DA,XCODE,MUSTASK,PROMPT,INST,KEY,IVFID
"RTN","ORWDXM1",91,0)
 S IVFID=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",0))
"RTN","ORWDXM1",92,0)
 S AUTOACK=$S($D(ORWPSWRG):0,1:1)
"RTN","ORWDXM1",93,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:'SEQ  D
"RTN","ORWDXM1",94,0)
 . S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORWDXM1",95,0)
 . . ; skip if this is a child prompt
"RTN","ORWDXM1",96,0)
 . . I $P(^ORD(101.41,+ORDIALOG,10,DA,0),U,11) Q
"RTN","ORWDXM1",97,0)
 . . ; set default for prompt, see if needs to be interactive
"RTN","ORWDXM1",98,0)
 . . S PROMPT=$P(^ORD(101.41,+ORDIALOG,10,DA,0),U,2)
"RTN","ORWDXM1",99,0)
 . . D SETITEM(DA,PROMPT,1,.MUSTASK)
"RTN","ORWDXM1",100,0)
 . . I MUSTASK S AUTOACK=0 Q
"RTN","ORWDXM1",101,0)
 . . ; iterate through the child items if parent and editonly
"RTN","ORWDXM1",102,0)
 . . Q:'$D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT))
"RTN","ORWDXM1",103,0)
 . . N CSEQ,CDA,CPROMPT,INST,ORQUIT
"RTN","ORWDXM1",104,0)
 . . S CSEQ=0 F  S CSEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,CSEQ)) Q:'CSEQ  D  Q:$G(ORQUIT)
"RTN","ORWDXM1",105,0)
 . . . S CDA=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,CSEQ,0))
"RTN","ORWDXM1",106,0)
 . . . S CPROMPT=$P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,2)
"RTN","ORWDXM1",107,0)
 . . . ; if required and no instances then need interaction
"RTN","ORWDXM1",108,0)
 . . . I $P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,6),ORDIALOG'=IVFID,'$O(ORDIALOG(CPROMPT,0)) S AUTOACK=0
"RTN","ORWDXM1",109,0)
 . . . S INST=0 F  S INST=$O(ORDIALOG(CPROMPT,INST)) Q:'INST  D
"RTN","ORWDXM1",110,0)
 . . . . ; set default for each child prompt, if necessary
"RTN","ORWDXM1",111,0)
 . . . . D SETITEM(CDA,CPROMPT,INST,.MUSTASK)
"RTN","ORWDXM1",112,0)
 . . . . ; if no val and child prmpt required then need interaction
"RTN","ORWDXM1",113,0)
 . . . . I MUSTASK,$P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,6) S AUTOACK=0
"RTN","ORWDXM1",114,0)
 N IVDLG
"RTN","ORWDXM1",115,0)
 S IVDLG=$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORWDXM1",116,0)
 I $$ISMED(ORIT),(ORDIALOG'=IVDLG),(ORCAT="I") D
"RTN","ORWDXM1",117,0)
 . F P="PATIENT INSTRUCTIONS","START DATE/TIME","DAYS SUPPLY","QUANTITY","REFILLS","ROUTING","SERVICE CONNECTED" K ORDIALOG($$PTR(P),1)
"RTN","ORWDXM1",118,0)
 S KEY=$S(ORWMODE:"C",1:"")_ORIT_"-"_$P($H,",",2),SEQ=0
"RTN","ORWDXM1",119,0)
 S PROMPT=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:'PROMPT  D
"RTN","ORWDXM1",120,0)
 . I '$D(^ORD(101.41,ORDIALOG,10,"D",PROMPT)) K ORDIALOG(PROMPT) Q 
"RTN","ORWDXM1",121,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  D
"RTN","ORWDXM1",122,0)
 . . S SEQ=SEQ+1,^TMP("ORWDXMQ",$J,KEY,SEQ,0)=U_PROMPT_U_INST
"RTN","ORWDXM1",123,0)
 . . ; save word processing value
"RTN","ORWDXM1",124,0)
 . . I $E(ORDIALOG(PROMPT,0))="W",$L(ORDIALOG(PROMPT,INST)) D
"RTN","ORWDXM1",125,0)
 . . .  M ^TMP("ORWDXMQ",$J,KEY,SEQ,2)=@ORDIALOG(PROMPT,INST)
"RTN","ORWDXM1",126,0)
 . . ; save other types of values
"RTN","ORWDXM1",127,0)
 . . E  S ^TMP("ORWDXMQ",$J,KEY,SEQ,1)=ORDIALOG(PROMPT,INST)
"RTN","ORWDXM1",128,0)
 I AUTOACK D
"RTN","ORWDXM1",129,0)
 . I ORWMODE S AUTOACK=2
"RTN","ORWDXM1",130,0)
 . I 'ORWMODE,($P(^ORD(101.41,ORIT,0),U,8)!'LST(0)) S AUTOACK=2
"RTN","ORWDXM1",131,0)
 I $L($G(OREVNTYP)) D
"RTN","ORWDXM1",132,0)
 . I ('AUTOACK),("A,O,T,M"[OREVNTYP),($$ISMED(ORIT)) S AUTOACK=2
"RTN","ORWDXM1",133,0)
 I AUTOACK=2 D VERTXT^ORWDXM2
"RTN","ORWDXM1",134,0)
 S LST(0)=AUTOACK_U_KEY_U_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER)_"^"_$G(KEYVAR)
"RTN","ORWDXM1",135,0)
 I $P(LST(0),U,4)="D" S $P(LST(0),U,4)="Q"
"RTN","ORWDXM1",136,0)
 I ORWMODE=1 S $P(LST(0),U,4)="C"
"RTN","ORWDXM1",137,0)
 K ^TMP("ORWORD",$J)
"RTN","ORWDXM1",138,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J)
"RTN","ORWDXM1",139,0)
 Q
"RTN","ORWDXM1",140,0)
SETITEM(DA,PROMPT,INST,MUSTASK) ; set default value & return if must prompt
"RTN","ORWDXM1",141,0)
 N EDITONLY,Y,XCODE
"RTN","ORWDXM1",142,0)
 S MUSTASK=0,EDITONLY=0
"RTN","ORWDXM1",143,0)
 I $D(^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)) D
"RTN","ORWDXM1",144,0)
 . I $E(ORDIALOG(PROMPT,0))="W" D
"RTN","ORWDXM1",145,0)
 . . S ^TMP("ORWORD",$J,PROMPT,INST,1,0)=^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)
"RTN","ORWDXM1",146,0)
 . . S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")"
"RTN","ORWDXM1",147,0)
 . E  S ORDIALOG(PROMPT,INST)=^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)
"RTN","ORWDXM1",148,0)
 I $D(^TMP("ORWDHTM",$J,ORIT,PROMPT)) D
"RTN","ORWDXM1",149,0)
 . S ORDIALOG(PROMPT,INST)=^TMP("ORWDHTM",$J,ORIT,PROMPT)
"RTN","ORWDXM1",150,0)
 . ; NEED TO CLEAN UP ^TMP("ORWDHTM") after processing order set!!!
"RTN","ORWDXM1",151,0)
 ;
"RTN","ORWDXM1",152,0)
 ; skip if a value already exists for this prompt and not WP
"RTN","ORWDXM1",153,0)
 Q:$D(ORDIALOG(PROMPT,INST))&($E(ORDIALOG(PROMPT,0))'="W")
"RTN","ORWDXM1",154,0)
 ; execute default action if no value in QO, checking EDITONLY afterwards
"RTN","ORWDXM1",155,0)
 I '$D(ORDIALOG(PROMPT,INST)) D
"RTN","ORWDXM1",156,0)
 . I $E(ORDIALOG(PROMPT,0))="W",$D(^ORD(101.41,+ORDIALOG,10,DA,8))>9 D
"RTN","ORWDXM1",157,0)
 . . M ^TMP("ORWORD",$J,PROMPT,INST)=^ORD(101.41,+ORDIALOG,10,DA,8)
"RTN","ORWDXM1",158,0)
 . . S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")"
"RTN","ORWDXM1",159,0)
 . E  D
"RTN","ORWDXM1",160,0)
 . . S XCODE=$$SUBCODE($G(^ORD(101.41,+ORDIALOG,10,DA,7)))
"RTN","ORWDXM1",161,0)
 . . I $L(XCODE) X XCODE S:$D(Y) ORDIALOG(PROMPT,INST)=Y
"RTN","ORWDXM1",162,0)
 Q:$G(EDITONLY)
"RTN","ORWDXM1",163,0)
 I 'ORWMODE,$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,8) Q
"RTN","ORWDXM1",164,0)
 I ORWMODE,($P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,9)'["W"),'$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,6)!$D(ORDIALOG(PROMPT,INST)) Q
"RTN","ORWDXM1",165,0)
 I 'ORWMODE,LST(0),$D(ORDIALOG(PROMPT,INST)),($E(ORDIALOG(PROMPT,0))="W") Q
"RTN","ORWDXM1",166,0)
 I 'ORWMODE,LST(0),'$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,6) Q
"RTN","ORWDXM1",167,0)
 S XCODE=$$SUBCODE($G(^ORD(101.41,+ORDIALOG,10,DA,3)))
"RTN","ORWDXM1",168,0)
 I $L(XCODE) X XCODE Q:'$T
"RTN","ORWDXM1",169,0)
 S MUSTASK=1
"RTN","ORWDXM1",170,0)
 Q
"RTN","ORWDXM1",171,0)
SUBCODE(X) ; substitute code
"RTN","ORWDXM1",172,0)
 I X["$$REQDCOMM^ORCDLR" Q "I $$LRRQCM^ORWDXM2"
"RTN","ORWDXM1",173,0)
 I X["$$ASKSAMP^ORCDLR" Q "I $$LRASMP^ORWDXM2"
"RTN","ORWDXM1",174,0)
 I X["$$SCHEDULD^ORCDRA1" Q "I $$SCHEDULD^ORWDXM2"
"RTN","ORWDXM1",175,0)
 I X["(^PSX(550,""C"")" Q "S Y=$E($$DEFPICK^ORWDPS32) K:'$L(Y) Y"
"RTN","ORWDXM1",176,0)
 Q X
"RTN","ORWDXM1",177,0)
PTR(NAME) ; -- Returns pointer to OR GTX NAME
"RTN","ORWDXM1",178,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORWDXM1",179,0)
 ;
"RTN","ORWDXM1",180,0)
ISMED(IFN) ; return 1 if it use a pharmacy order dlg
"RTN","ORWDXM1",181,0)
 N PKG
"RTN","ORWDXM1",182,0)
 I 'ORWMODE S PKG=$P($G(^ORD(101.41,IFN,0)),U,7)
"RTN","ORWDXM1",183,0)
 E  S PKG=$P($G(^OR(100,+IFN,0)),U,14)
"RTN","ORWDXM1",184,0)
 Q $$NMSP^ORCD(PKG)="PS"
"RTN","ORY178")
0^5^B355300
"RTN","ORY178",1,0)
ORY178 ; SLC/KCM/JLI ;2/19/03
"RTN","ORY178",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**178**;Dec 17, 1997
"RTN","ORY178",3,0)
POST ;
"RTN","ORY178",4,0)
 N RPC
"RTN","ORY178",5,0)
 N MENU
"RTN","ORY178",6,0)
 S RPC="XUS GET TOKEN"
"RTN","ORY178",7,0)
 S MENU="OR CPRS GUI CHART"
"RTN","ORY178",8,0)
 D INSERT(MENU,RPC)
"RTN","ORY178",9,0)
 Q
"RTN","ORY178",10,0)
 ;
"RTN","ORY178",11,0)
INSERT(OPTION,RPC) ; Call FM Updater with each RPC
"RTN","ORY178",12,0)
 ; Input  -- OPTION   Option file (#19) Name field (#.01)
"RTN","ORY178",13,0)
 ;           RPC      RPC sub-file (#19.05) RPC field (#.01)
"RTN","ORY178",14,0)
 ; Output -- None
"RTN","ORY178",15,0)
 N FDA,FDAIEN,ERR,DIERR
"RTN","ORY178",16,0)
 S FDA(19,"?1,",.01)=OPTION
"RTN","ORY178",17,0)
 S FDA(19.05,"?+2,?1,",.01)=RPC
"RTN","ORY178",18,0)
 D UPDATE^DIE("E","FDA","FDAIEN","ERR")
"RTN","ORY178",19,0)
 Q
"RTN","ORY178",20,0)
 ;
"VER")
8.0^22.0
**END**
**END**
