Released XU*8*391 SEQ #322
Extracted from mail message
**KIDS**:XU*8.0*391^

**INSTALL NAME**
XU*8.0*391
"BLD",880,0)
XU*8.0*391^KERNEL^0^3051012^y
"BLD",880,1,0)
^^2^2^3050707^
"BLD",880,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"BLD",880,1,2,0)
XU*8*391 Limit %ZIS page length.
"BLD",880,4,0)
^9.64PA^3.5^1
"BLD",880,4,3.5,0)
3.5
"BLD",880,4,3.5,2,0)
^9.641^3.5^1
"BLD",880,4,3.5,2,3.5,0)
DEVICE  (File-top level)
"BLD",880,4,3.5,2,3.5,1,0)
^9.6411^51^1
"BLD",880,4,3.5,2,3.5,1,51,0)
OPEN COUNT
"BLD",880,4,3.5,222)
y^y^p^^^^n^^n
"BLD",880,4,3.5,224)

"BLD",880,4,"APDD",3.5,3.5)

"BLD",880,4,"APDD",3.5,3.5,51)

"BLD",880,4,"B",3.5,3.5)

"BLD",880,"KRN",0)
^9.67PA^8989.52^19
"BLD",880,"KRN",.4,0)
.4
"BLD",880,"KRN",.401,0)
.401
"BLD",880,"KRN",.402,0)
.402
"BLD",880,"KRN",.403,0)
.403
"BLD",880,"KRN",.5,0)
.5
"BLD",880,"KRN",.84,0)
.84
"BLD",880,"KRN",3.6,0)
3.6
"BLD",880,"KRN",3.8,0)
3.8
"BLD",880,"KRN",9.2,0)
9.2
"BLD",880,"KRN",9.8,0)
9.8
"BLD",880,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",880,"KRN",9.8,"NM",1,0)
ZIS1^^0^23639948
"BLD",880,"KRN",9.8,"NM",2,0)
ZIS3^^0^12189703
"BLD",880,"KRN",9.8,"NM","B","ZIS1",1)

"BLD",880,"KRN",9.8,"NM","B","ZIS3",2)

"BLD",880,"KRN",19,0)
19
"BLD",880,"KRN",19.1,0)
19.1
"BLD",880,"KRN",101,0)
101
"BLD",880,"KRN",409.61,0)
409.61
"BLD",880,"KRN",771,0)
771
"BLD",880,"KRN",870,0)
870
"BLD",880,"KRN",8989.51,0)
8989.51
"BLD",880,"KRN",8989.52,0)
8989.52
"BLD",880,"KRN",8994,0)
8994
"BLD",880,"KRN","B",.4,.4)

"BLD",880,"KRN","B",.401,.401)

"BLD",880,"KRN","B",.402,.402)

"BLD",880,"KRN","B",.403,.403)

"BLD",880,"KRN","B",.5,.5)

"BLD",880,"KRN","B",.84,.84)

"BLD",880,"KRN","B",3.6,3.6)

"BLD",880,"KRN","B",3.8,3.8)

"BLD",880,"KRN","B",9.2,9.2)

"BLD",880,"KRN","B",9.8,9.8)

"BLD",880,"KRN","B",19,19)

"BLD",880,"KRN","B",19.1,19.1)

"BLD",880,"KRN","B",101,101)

"BLD",880,"KRN","B",409.61,409.61)

"BLD",880,"KRN","B",771,771)

"BLD",880,"KRN","B",870,870)

"BLD",880,"KRN","B",8989.51,8989.51)

"BLD",880,"KRN","B",8989.52,8989.52)

"BLD",880,"KRN","B",8994,8994)

"BLD",880,"QUES",0)
^9.62^^
"BLD",880,"REQB",0)
^9.611^1^1
"BLD",880,"REQB",1,0)
XU*8.0*199^2
"BLD",880,"REQB","B","XU*8.0*199",1)

"FIA",3.5)
DEVICE
"FIA",3.5,0)
^%ZIS(1,
"FIA",3.5,0,0)
3.5Is
"FIA",3.5,0,1)
y^y^p^^^^n^^n
"FIA",3.5,0,10)

"FIA",3.5,0,11)

"FIA",3.5,0,"RLRO")

"FIA",3.5,0,"VR")
8.0^XU
"FIA",3.5,3.5)
1
"FIA",3.5,3.5,51)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
391^3051012
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3051012
"PKG",3,22,1,"PAH",1,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"PKG",3,22,1,"PAH",1,1,2,0)
XU*8*391 Limit %ZIS page length.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ZIS1")
0^1^B23639948
"RTN","ZIS1",1,0)
%ZIS1 ;SFISC/AC,RWF -- DEVICE HANDLER (DEVICE INPUT) ;07/07/2005  15:48
"RTN","ZIS1",2,0)
 ;;8.0;KERNEL;**18,49,69,104,112,199,391**;JUL 10, 1995
"RTN","ZIS1",3,0)
MAIN ;Called from %ZIS with a GO
"RTN","ZIS1",4,0)
 I '$D(IOP),$D(^%ZIS(1,%E,0)),'$P(^(0),"^",3) S %A=%H,%Z=^(0) D L2^%ZIS2 G EXIT
"RTN","ZIS1",5,0)
L1 ;Main Loop
"RTN","ZIS1",6,0)
 I '$D(IOP),$D(IO("Q")),POP D AQUE^%ZIS3 K:%=2 IO("Q") S:%=2 %ZISB=$S(%IS'["N":2,1:0) I %=-1 S POP=1 G EXIT
"RTN","ZIS1",7,0)
 S %E=%H,POP=0,%IS=%ZIS ;Reset %IS from %ZIS
"RTN","ZIS1",8,0)
 I %IS'["Q",$D(XQNOGO) S POP=1 W:'$D(IOP) !,*7,"OUTPUT IS NEVER ALLOWED FOR THIS OPTION" G EXIT
"RTN","ZIS1",9,0)
 D IOP:$D(IOP),R:'$D(IOP)
"RTN","ZIS1",10,0)
 G EXIT:$D(DTOUT)!$D(DUOUT)!(POP&$D(IOP)),L1:POP&'$D(IOP)
"RTN","ZIS1",11,0)
 D LKUP I %A'>0 S POP=1 D:'$D(DUOUT) MSG1 K DUOUT
"RTN","ZIS1",12,0)
 I POP G EXIT:$D(IOP),L1:'$D(IOP)
"RTN","ZIS1",13,0)
 I '$D(^%ZIS(1,%A,0)) D MSG1 K %ZISIOS S POP=1
"RTN","ZIS1",14,0)
 I POP G EXIT:$D(IOP),L1:'$D(IOP)
"RTN","ZIS1",15,0)
 S %E=%A,%Z=^%ZIS(1,%A,0),%Z1=$G(^(1))
"RTN","ZIS1",16,0)
 I $D(%ZIS("S")) N Y S Y=%E D XS^ZISX S:'$T POP=1 G G:POP
"RTN","ZIS1",17,0)
 W:'$D(IOP)&($P(%Z,"^",2)'=$I)&($P(%Z1,"^")]"") "  ",$P(%Z1,"^")
"RTN","ZIS1",18,0)
 D L2^%ZIS2
"RTN","ZIS1",19,0)
G G L1:POP&'$D(IOP)&'($D(DTOUT)!$D(DUOUT)) ;Didn't get it
"RTN","ZIS1",20,0)
 ;For type[TRM reset $X & $Y
"RTN","ZIS1",21,0)
 I 'POP,%ZTYPE["TRM",IO]"",$D(IO(1,IO)) U IO S:'(IO=IO(0)&'$D(IO("S"))&'$D(ZTQUEUED)) $X=0,$Y=0
"RTN","ZIS1",22,0)
 ;
"RTN","ZIS1",23,0)
EXIT I $D(IO)#2,IO]"",$D(IO(1,IO))#2,$D(%Z1),$P(%Z1,"^",11) S IO(1,IO,"NOFF")=1
"RTN","ZIS1",24,0)
 ;Do count of number of times device opened.  Field 51.
"RTN","ZIS1",25,0)
 I $L($G(IO)),$D(IO(1,IO))#2,'POP,$G(%ZISIOS) D
"RTN","ZIS1",26,0)
 . S $P(^(5),"^",1)=$P($G(^%ZIS(1,%ZISIOS,5)),"^",1)+1
"RTN","ZIS1",27,0)
 I 'POP,%ZIS["H" S IO(0)=IO,IO("HOME")=%ZISIOS_"^"_IO ;Make home device
"RTN","ZIS1",28,0)
 I %IS'[0,$G(IO(0))]"" U IO(0) ;Make sure return with home active
"RTN","ZIS1",29,0)
 G SETVAR:'POP!(%IS["T"),KILVAR
"RTN","ZIS1",30,0)
 ;
"RTN","ZIS1",31,0)
IOP ;Request with IOP set
"RTN","ZIS1",32,0)
 S (%ZISVT,%X)=IOP S:%X'?1.UNP %X=$$UP(%X) I %X'="Q" D SETQ Q
"RTN","ZIS1",33,0)
 S %IS=%IS_%X K IOP W %X D SETQ Q
"RTN","ZIS1",34,0)
 ;Get ready to ask user for device
"RTN","ZIS1",35,0)
R I %IS["Q",$D(XQNOGO) W !,*7,"AT THIS TIME, OUTPUT MUST BE QUEUED"
"RTN","ZIS1",36,0)
 S %A=$S($D(%IS("B")):%IS("B"),1:"HOME") ;Setup default
"RTN","ZIS1",37,0)
 I %IS["P",%A="HOME",$D(^%ZIS(1,%E,99)),$D(^%ZIS(1,+^(99),0)) S %A=$P(^(0),"^",1)
"RTN","ZIS1",38,0)
RD W !,$S($D(%IS("A")):%IS("A"),1:"DEVICE: ") W:%A]"" %A,"// " D SBR S:%X="" %X=%A S %ZISVT=%X
"RTN","ZIS1",39,0)
 I %X?2"?".E D EN2^%ZIS7 G R
"RTN","ZIS1",40,0)
 I %X?1"?".E D EN1^%ZIS7 G R
"RTN","ZIS1",41,0)
 I $D(DTOUT)!$D(DUOUT)!(%X'?.ANP)!($L($P(%X,";"))>31) S:%IS["T" IO="" S POP=1 Q
"RTN","ZIS1",42,0)
 S:%X'?1.UNP %X=$$UP(%X) D SETQ G R:$T Q
"RTN","ZIS1",43,0)
SETQ S %Y=$P(%X,";",2,9),%X=$P(%X,";",1) S:$L(";"_%Y,";/")=2 IO("P")=$P(";"_%Y,";/",2)
"RTN","ZIS1",44,0)
 I %IS["Q",%X="Q" S %X=%Y,%ZISVT=$P(%ZISVT,";",2,9),%ZISB=0,IO("Q")=1,%IS("A")="DEVICE: " S:$D(IOP) %Y=$P(%X,";",2,9),%X=$P(%X,";",1)
"RTN","ZIS1",45,0)
 I $T,'$D(IOP) W "UEUE TO PRINT ON" Q  ; Return $T value
"RTN","ZIS1",46,0)
 Q
"RTN","ZIS1",47,0)
LKUP S %ZISMY=$P(%ZISVT,";",2,999),%ZISVT=$P(%ZISVT,";")
"RTN","ZIS1",48,0)
 I %X="H" W:'$D(IOP) "ome" S %X=0
"RTN","ZIS1",49,0)
 I 0[%X!(%X="HOME")!(%X=$I) S %A=%H Q
"RTN","ZIS1",50,0)
 I $E(%ZISVT)="`",$D(IOP) S %A=+$E(%ZISVT,2,999) I $G(^%ZIS(1,%A,0))]"" Q
"RTN","ZIS1",51,0)
 S %A=0 I "P"[%X Q:$D(IOP)&('$D(^%ZIS(1,%E,99)))  I $D(^%ZIS(1,%E,99)) S %A=+^(99) Q
"RTN","ZIS1",52,0)
 I %X=" ",$D(DUZ)#2,$D(^DISV(+DUZ,"^%ZIS(1,")) S %A=^("^%ZIS(1,") Q
"RTN","ZIS1",53,0)
 S %A=+$O(^%ZIS(1,"B",%ZISVT,0)) Q:%A>0  ;mixed case lookup
"RTN","ZIS1",54,0)
 I %X'=%ZISVT S %A=+$O(^%ZIS(1,"B",%X,0)) Q:%A>0  ;uppercase lookup
"RTN","ZIS1",55,0)
 D VTLKUP^%ZIS S %A=%E Q:%A>0  ;mixed case lookup
"RTN","ZIS1",56,0)
 I %X'=%ZISVT S %ZISVT=%X D VTLKUP^%ZIS S %A=%E Q:%A>0  ;uppercase lookup
"RTN","ZIS1",57,0)
 N %XX,%YY S %XX=%X D 1^%ZIS5 S %A=+%YY Q
"RTN","ZIS1",58,0)
SBR K DFOUT,DTOUT,DUOUT R %X:$S($D(DTIME)#2:DTIME,1:300) E  W *7 S DTOUT=1 Q
"RTN","ZIS1",59,0)
 S:%X="."!(%X="^") DUOUT=1,%X="" Q
"RTN","ZIS1",60,0)
LC S %X=$$UP(%X)
"RTN","ZIS1",61,0)
 Q
"RTN","ZIS1",62,0)
LOW(%) Q $TR(%,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","ZIS1",63,0)
UP(%) Q $TR(%,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ZIS1",64,0)
YN W "? ",$P("YES// ^NO// ",U,%)
"RTN","ZIS1",65,0)
RYN R %X:$S($D(DTIME):DTIME,$D(%ZISDTIM):%ZISDTIM,1:300) E  S DTOUT=1,%X=U W *7
"RTN","ZIS1",66,0)
 S:%X]""!'% %=$A(%X),%=$S(%=89:1,%=121:1,%=78:2,%=110:2,%=94:-1,1:0)
"RTN","ZIS1",67,0)
 I '%,%X'?."?" W *7,"??",!?4,"ANSWER 'YES' OR 'NO': " G RYN
"RTN","ZIS1",68,0)
 W:$X>73 ! W $P("  (YES)^  (NO)",U,%) Q
"RTN","ZIS1",69,0)
MSG1 I '$D(IOP) W ?20,*7,"  [DEVICE DOES NOT EXIST]"
"RTN","ZIS1",70,0)
 Q
"RTN","ZIS1",71,0)
SETVAR ;Come here to setup the variables for the selected device
"RTN","ZIS1",72,0)
 S:$D(IO)[0 IO="" G KILVAR:%IS["T"&(IO="")
"RTN","ZIS1",73,0)
 I $G(%Z)="" S ION="Unknown device",POP=1 G KILVAR
"RTN","ZIS1",74,0)
 S:IO'=IO(0)&($D(DUZ)#2) ^DISV(+DUZ,"^%ZIS(1,")=%E
"RTN","ZIS1",75,0)
 S ION=$P(%Z,"^",1),IOM=+%Z91,IOF=$P(%Z91,"^",2),IOSL=$P(%Z91,"^",3),IOBS=$P(%Z91,"^",4),IOXY=$P(%Z91,"^",5)
"RTN","ZIS1",76,0)
 I IOSL>65530 S IOSL=65530 ;Cache rolls $Y at 65535
"RTN","ZIS1",77,0)
 S IOT=%ZTYPE,IOST(0)=%ZISIOST(0),IOST=%ZISIOST,IOPAR=%ZISOPAR,IOUPAR=%ZISUPAR,IOHG=%ZISHG
"RTN","ZIS1",78,0)
 S:IOF="" IOF="#" ;See that IOF has something
"RTN","ZIS1",79,0)
 K IOCPU S:$D(%ZISCPU) IOCPU=%ZISCPU G KIL
"RTN","ZIS1",80,0)
 ;
"RTN","ZIS1",81,0)
KILVAR ;Come here to restore the calling variables
"RTN","ZIS1",82,0)
 D SYMBOL^%ZISUTL(1,"%ZISOLD")
"RTN","ZIS1",83,0)
 S:'$L($G(IOF)) IOF="#" S:'$D(IOST(0)) IOST(0)=0
"RTN","ZIS1",84,0)
 ;See that all standard variables are defined
"RTN","ZIS1",85,0)
 F %I="IO","ION","IOM","IOBS","IOSL","IOST" S:$D(@%I)[0 @%I=""
"RTN","ZIS1",86,0)
 K IO("HFSIO"),IO("OPEN") I $D(%ZISCPU) S:'$D(IOCPU) IOCPU=%ZISCPU
"RTN","ZIS1",87,0)
KIL ;Final exit cleanup
"RTN","ZIS1",88,0)
 S:'POP IOS=%ZISIOS I POP K:%IS'["T" %ZISIOS I %IS["T" K IOS S:$D(%ZISIOS) IOS=%ZISIOS
"RTN","ZIS1",89,0)
 S:%IS["T" IO("T")=1 K %ZIS,%IS,%A,%E,%H,%ZISOS,%ZISV,IOP
"RTN","ZIS1",90,0)
K2 K %I,%X,%Y,%Z,%Z1,%Z91,%Z95,%ZTYPE,%ZTIME
"RTN","ZIS1",91,0)
 K %ZISCHK,%ZISCPU,%ZISI,%ZISR,%ZISVT,%ZISB,%ZISX,ZISI,%ZISHGL,%ZISHP,%ZISIO,%ZISIOS,%ZISIOM,%ZISIOF,%ZISIOSL,%ZISIOBS,%ZISIOST,%ZISIOST(0),%ZISTO,%ZISTP,%ZISHG,%ZISSIO,%ZISOPEN,%ZISOPAR,%ZISUPAR
"RTN","ZIS1",92,0)
 K %ZISMY,%ZISQUIT
"RTN","ZIS1",93,0)
 Q
"RTN","ZIS3")
0^2^B12189703
"RTN","ZIS3",1,0)
%ZIS3 ;SFISC/AC,RWF -- DEVICE HANDLER(DEVICE TYPES & PARAMETERS) ;10/06/2005  13:23
"RTN","ZIS3",2,0)
 ;;8.0;KERNEL;**18,36,69,104,391**;JUL 10, 1995
"RTN","ZIS3",3,0)
 I %ZIS'["T",$G(^%ZIS(1,+%E,"POX"))]"" D XPOX^ZISX(%E)
"RTN","ZIS3",4,0)
 I $D(%ZISQUIT) S POP=1 K %ZISQUIT
"RTN","ZIS3",5,0)
 S %ZISCHK=1
"RTN","ZIS3",6,0)
 I 'POP&(%ZISB)&(%ZTYPE'="RES")&(%ZTYPE'="OTH")&(%ZTYPE'="SDP")&(IO'["::") D DEVOK
"RTN","ZIS3",7,0)
 G Q:POP
"RTN","ZIS3",8,0)
 G @%ZTYPE:(%ZTYPE["TRM"),@(%ZTYPE_"^%ZIS6") ;Jump to next part
"RTN","ZIS3",9,0)
 ; 
"RTN","ZIS3",10,0)
Q I $D(%ZISUOUT) K %ZISUOUT,%ZISHP,%ZISHPOP Q
"RTN","ZIS3",11,0)
 I $D(%ZISHPOP)&$S(IO="":1,1:'$D(IO(1,IO))) D HGBSY^%ZIS2 Q
"RTN","ZIS3",12,0)
 I POP S:%IS'["T" IO="" I $D(%ZISHG(0)),%IS'["D",'$D(%ZISHPOP) G HUNT^%ZIS2
"RTN","ZIS3",13,0)
 Q
"RTN","ZIS3",14,0)
VTRM ;Virtual terminal type
"RTN","ZIS3",15,0)
TRM D OPEN^%ZIS4:'POP&(%ZISB&(%IS'["T")),MARGN:'POP,SETPAR:'POP ;Terminal type
"RTN","ZIS3",16,0)
 I 'POP,%IS'["T",%ZISB=1,'$D(IOP),IO'=IO(0),'$D(IO("Q")),%IS["Q" D AQUE
"RTN","ZIS3",17,0)
 W:'$D(IOP) ! I '$D(IO("Q")) D O^%ZIS4:'POP&(%ZISB&(%IS'["T"))
"RTN","ZIS3",18,0)
 G Q
"RTN","ZIS3",19,0)
DEVOK N X,Y,X1
"RTN","ZIS3",20,0)
 S X=IO,X1=%ZTYPE
"RTN","ZIS3",21,0)
 D DEVOK^%ZOSV I Y=-99!(Y=0)!(Y=$J) Q
"RTN","ZIS3",22,0)
 I Y>0 S POP=1 W:'$D(IOP)&('$D(%ZISHG(0))!(%IS["D")) !,*7,"[Device Unavailable]" Q
"RTN","ZIS3",23,0)
 I Y=-1 S IO="",POP=1 W:'$D(IOP)&('$D(ZISHG(0))!(%IS["D")) !,*7,"[Device does not Exist or Unavailable]" Q
"RTN","ZIS3",24,0)
 Q
"RTN","ZIS3",25,0)
 ;
"RTN","ZIS3",26,0)
MARGN ;Get the margin and page length
"RTN","ZIS3",27,0)
 S %A=$P(%Y,";",1)
"RTN","ZIS3",28,0)
 I %A?1A.ANP D SUBIEN(.%A,1) I $D(^%ZIS(2,%A,1)) K %Z91 D ST(1) S %Y=$P(%Y,";",2,9),%ZISMY=$P(%ZISMY,";",2,9) G MARGN
"RTN","ZIS3",29,0)
 I %A>3 S $P(%Z91,"^")=$S(%A>255:255,1:+%A)
"RTN","ZIS3",30,0)
 I $P(%Y,";",2) S $P(%Z91,"^",3)=+$S($P(%Y,";",2)>65530:65530,1:$P(%Y,";",2)) ;Cache fix for $Y#65535 wrap
"RTN","ZIS3",31,0)
 ;
"RTN","ZIS3",32,0)
ALTP I '$D(IO("P")) Q:%A>3  G ASKMAR:%ZTYPE["TRM" Q
"RTN","ZIS3",33,0)
 S %X=$F(IO("P"),"M") I %X S %A=+$E(IO("P"),%X,99),$P(%Z91,"^")=$S(%A>255:255,1:%A)
"RTN","ZIS3",34,0)
 S %X=$F(IO("P"),"L") I %X S $P(%Z91,"^",3)=+$E(IO("P"),%X,99)
"RTN","ZIS3",35,0)
 Q:%A>3!(%ZTYPE'["TRM")
"RTN","ZIS3",36,0)
ASKMAR I %IS["M",'$D(IOP),$S(%E=%H:+$P(%Z,"^",3),1:1),$P(%Z,"^",4) W "    Right Margin: " W:$P(%Z91,"^")]"" +%Z91,"// "
"RTN","ZIS3",37,0)
 E  Q
"RTN","ZIS3",38,0)
 D SBR^%ZIS1 I '$D(DTOUT)&'$D(DUOUT) S:%X=""&($P(%Z91,"^")]"") %X=+%Z91 G ASKMAR:%X'?1.N S $P(%Z91,"^")=$S(%X>255:255,1:%X) Q
"RTN","ZIS3",39,0)
 S POP=1 I %ZISB&(%ZTYPE["TRM")&(IO'=IO(0)) C IO K IO(1,IO) Q
"RTN","ZIS3",40,0)
 Q
"RTN","ZIS3",41,0)
SETPAR S:%ZISOPAR]""&($A(%ZISOPAR)-40) %ZISOPAR="("_%ZISOPAR_")"
"RTN","ZIS3",42,0)
 Q
"RTN","ZIS3",43,0)
AQUE W ! S %=$S($D(IO("Q")):1,1:2),U="^",%ZISDTIM=60
"RTN","ZIS3",44,0)
 I $D(IO("Q")) W !,"Previously, you have selected queueing."
"RTN","ZIS3",45,0)
 W !,"Do you "_$S($D(IO("Q")):"STILL ",1:"")_"want your output QUEUED"
"RTN","ZIS3",46,0)
 D YN^%ZIS1 K %ZISDTIM G AQUE:%=0 Q:$D(IO("Q"))
"RTN","ZIS3",47,0)
 I %=-1 S POP=1,%ZISHPOP=1,%ZISUOUT=1 C IO K IO(1,IO) Q
"RTN","ZIS3",48,0)
 I %=1 S IO("Q")=1 C IO K IO(1,IO) Q
"RTN","ZIS3",49,0)
 Q
"RTN","ZIS3",50,0)
ST(%ZISTP) ;
"RTN","ZIS3",51,0)
 S %ZISIOST(0)=%A,%ZISIOST=$P($G(^%ZIS(2,%A,0)),"^")
"RTN","ZIS3",52,0)
 S:'$D(%Z91) %Z91=$P($G(^%ZIS(2,%A,1),"132^#^60^$C(8)"),"^",1,4),$P(%Z91,"^",5)=$G(^("XY"))
"RTN","ZIS3",53,0)
 Q:%ZISTP
"RTN","ZIS3",54,0)
STP N %B ;%E is a pointer to the Device file
"RTN","ZIS3",55,0)
 S %B=$G(^%ZIS(1,%E,91))
"RTN","ZIS3",56,0)
 S:$P(%B,"^")]"" $P(%Z91,"^")=+%B S:$P(%B,"^",3)]"" $P(%Z91,"^",3)=$P(%B,"^",3) ;S $P(%Z91,"^",5)=$G(^%ZIS(2,%ZISIOST(0),"XY"))
"RTN","ZIS3",57,0)
 Q
"RTN","ZIS3",58,0)
SUBIEN(%1,%) ;Return Subtype ien. %1 is call by Ref.
"RTN","ZIS3",59,0)
 N %XX,%YY
"RTN","ZIS3",60,0)
 I $D(^%ZIS(2,"B",%1))>9 S %1=+$O(^%ZIS(2,"B",%1,0)) Q
"RTN","ZIS3",61,0)
 I '$G(%) S X="" Q
"RTN","ZIS3",62,0)
 S %XX=%1 D 2^%ZIS5 S %1=+%YY
"RTN","ZIS3",63,0)
 Q
"RTN","ZIS3",64,0)
SUBTYPE(%A) ;Called from %ZISH
"RTN","ZIS3",65,0)
 N %ZISIOST,%Z91
"RTN","ZIS3",66,0)
 S:$G(%A)="" %A="P-OTHER"
"RTN","ZIS3",67,0)
 D SUBIEN(.%A),ST(1)
"RTN","ZIS3",68,0)
 S IOM=$P(%Z91,U,1),IOF=$P(%Z91,U,2),IOSL=$P(%Z91,U,3),IOST=%ZISIOST,IOST(0)=%ZISIOST(0),IOBS="$C(8)"
"RTN","ZIS3",69,0)
 S:IOST="" IOST="P-OTHER",IOST(0)=0
"RTN","ZIS3",70,0)
 Q
"RTN","ZIS3",71,0)
 
"VER")
8.0^22.0
"^DD",3.5,3.5,51,0)
OPEN COUNT^NJ8,0^^5;1^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",3.5,3.5,51,3)
Type a Number between 0 and 99999999, 0 Decimal Digits
"^DD",3.5,3.5,51,21,0)
^^3^3^3051012^
"^DD",3.5,3.5,51,21,1,0)
This field holds a count of the number of times that %ZIS has 
"^DD",3.5,3.5,51,21,2,0)
successfully open this device.
"^DD",3.5,3.5,51,21,3,0)
The reason is to find LAT devices that are still in use.
"^DD",3.5,3.5,51,"DT")
3051012
"BLD",880,6)
^322
**END**
**END**
