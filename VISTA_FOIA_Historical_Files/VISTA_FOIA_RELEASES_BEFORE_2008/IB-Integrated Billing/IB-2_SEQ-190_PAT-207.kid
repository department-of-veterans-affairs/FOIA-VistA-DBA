Released IB*2*207 SEQ #190
Extracted from mail message
**KIDS**:IB*2.0*207^

**INSTALL NAME**
IB*2.0*207
"BLD",3743,0)
IB*2.0*207^INTEGRATED BILLING^0^3030121^y
"BLD",3743,1,0)
^^4^4^3030107^^
"BLD",3743,1,1,0)
This patch modifies two entries in file 364.7 - IB FORM FIELD CONTENT
"BLD",3743,1,2,0)
to address issues with Medicare rejections and Admit/Discharge dates.
"BLD",3743,1,3,0)
It also modifies the way box 24K is filled when billing secondary
"BLD",3743,1,4,0)
coverage on a claim where Medicare is primary.
"BLD",3743,4,0)
^9.64PA^399^1
"BLD",3743,4,399,0)
399
"BLD",3743,4,399,2,0)
^9.641^399.0222^1
"BLD",3743,4,399,2,399.0222,0)
PROVIDER  (sub-file)
"BLD",3743,4,399,2,399.0222,1,0)
^9.6411^.11^3
"BLD",3743,4,399,2,399.0222,1,.09,0)
PRIMARY PROV ID CARE UNIT
"BLD",3743,4,399,2,399.0222,1,.1,0)
SECONDRY PROV ID CARE UNIT
"BLD",3743,4,399,2,399.0222,1,.11,0)
TERTIARY PROV ID CARE UNIT
"BLD",3743,4,399,222)
y^n^p^^^^n
"BLD",3743,4,"APDD",399,399.0222)

"BLD",3743,4,"APDD",399,399.0222,.09)

"BLD",3743,4,"APDD",399,399.0222,.1)

"BLD",3743,4,"APDD",399,399.0222,.11)

"BLD",3743,4,"B",399,399)

"BLD",3743,"ABNS",0)
^9.66A^^
"BLD",3743,"ABPKG")
y^n
"BLD",3743,"INI")
IB20P207
"BLD",3743,"INID")
^^
"BLD",3743,"KRN",0)
^9.67PA^8989.52^19
"BLD",3743,"KRN",.4,0)
.4
"BLD",3743,"KRN",.4,"NM",0)
^9.68A^^
"BLD",3743,"KRN",.401,0)
.401
"BLD",3743,"KRN",.402,0)
.402
"BLD",3743,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",3743,"KRN",.402,"NM",1,0)
IB SCREEN8H    FILE #399^399^0
"BLD",3743,"KRN",.402,"NM",2,0)
IB SCREEN82    FILE #399^399^0
"BLD",3743,"KRN",.402,"NM","B","IB SCREEN82    FILE #399",2)

"BLD",3743,"KRN",.402,"NM","B","IB SCREEN8H    FILE #399",1)

"BLD",3743,"KRN",.403,0)
.403
"BLD",3743,"KRN",.5,0)
.5
"BLD",3743,"KRN",.84,0)
.84
"BLD",3743,"KRN",3.6,0)
3.6
"BLD",3743,"KRN",3.8,0)
3.8
"BLD",3743,"KRN",9.2,0)
9.2
"BLD",3743,"KRN",9.8,0)
9.8
"BLD",3743,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",3743,"KRN",9.8,"NM",1,0)
IBCEP3^^0^B39231705
"BLD",3743,"KRN",9.8,"NM",2,0)
IBCSC8H^^0^B22403551
"BLD",3743,"KRN",9.8,"NM",3,0)
IBCEU^^0^B54422781
"BLD",3743,"KRN",9.8,"NM","B","IBCEP3",1)

"BLD",3743,"KRN",9.8,"NM","B","IBCEU",3)

"BLD",3743,"KRN",9.8,"NM","B","IBCSC8H",2)

"BLD",3743,"KRN",19,0)
19
"BLD",3743,"KRN",19.1,0)
19.1
"BLD",3743,"KRN",101,0)
101
"BLD",3743,"KRN",409.61,0)
409.61
"BLD",3743,"KRN",771,0)
771
"BLD",3743,"KRN",870,0)
870
"BLD",3743,"KRN",8989.51,0)
8989.51
"BLD",3743,"KRN",8989.52,0)
8989.52
"BLD",3743,"KRN",8994,0)
8994
"BLD",3743,"KRN","B",.4,.4)

"BLD",3743,"KRN","B",.401,.401)

"BLD",3743,"KRN","B",.402,.402)

"BLD",3743,"KRN","B",.403,.403)

"BLD",3743,"KRN","B",.5,.5)

"BLD",3743,"KRN","B",.84,.84)

"BLD",3743,"KRN","B",3.6,3.6)

"BLD",3743,"KRN","B",3.8,3.8)

"BLD",3743,"KRN","B",9.2,9.2)

"BLD",3743,"KRN","B",9.8,9.8)

"BLD",3743,"KRN","B",19,19)

"BLD",3743,"KRN","B",19.1,19.1)

"BLD",3743,"KRN","B",101,101)

"BLD",3743,"KRN","B",409.61,409.61)

"BLD",3743,"KRN","B",771,771)

"BLD",3743,"KRN","B",870,870)

"BLD",3743,"KRN","B",8989.51,8989.51)

"BLD",3743,"KRN","B",8989.52,8989.52)

"BLD",3743,"KRN","B",8994,8994)

"BLD",3743,"QUES",0)
^9.62^^
"BLD",3743,"REQB",0)
^9.611^1^1
"BLD",3743,"REQB",1,0)
IB*2.0*137^2
"BLD",3743,"REQB","B","IB*2.0*137",1)

"FIA",399)
BILL/CLAIMS
"FIA",399,0)
^DGCR(399,
"FIA",399,0,0)
399I
"FIA",399,0,1)
y^n^p^^^^n
"FIA",399,0,10)

"FIA",399,0,11)

"FIA",399,0,"RLRO")

"FIA",399,0,"VR")
2.0^IB
"FIA",399,399)
1
"FIA",399,399.0222)
1
"FIA",399,399.0222,.09)

"FIA",399,399.0222,.1)

"FIA",399,399.0222,.11)

"INI")
IB20P207
"IX",399,399.0222,"AUPDID1",0)
399.0222^AUPDID1^UPDATE PRIMARY PROVIDER ID WHEN DATA FIELDS CHANGE AT PROVIDER LEVEL OF FILE^MU^^F^^I^399.0222^^^^^A
"IX",399,399.0222,"AUPDID1",.1,0)
^^6^6^3020206^
"IX",399,399.0222,"AUPDID1",.1,1,0)
This cross reference maintains the integrity of the rendering or 
"IX",399,399.0222,"AUPDID1",.1,2,0)
attending provider id whenever the primary insurance company care unit is
"IX",399,399.0222,"AUPDID1",.1,3,0)
added, deleted or changed on the claim.  If a valid provider number can be
"IX",399,399.0222,"AUPDID1",.1,4,0)
determined by the new value of the care unit, this id # is placed in the
"IX",399,399.0222,"AUPDID1",.1,5,0)
primary id field.  If no valid id can be determined for the provider, the
"IX",399,399.0222,"AUPDID1",.1,6,0)
primary id field for the provider is deleted.
"IX",399,399.0222,"AUPDID1",1)
D:X1(1)'=X2(1) SETID^IBCEP3(DA(1),1)
"IX",399,399.0222,"AUPDID1",2)
D:X1(1)'=X2(1)&(X(1)'="") DELID^IBCEP3(DA(1),1,1)
"IX",399,399.0222,"AUPDID1",2.5)
Q
"IX",399,399.0222,"AUPDID1",11.1,0)
^.114IA^1^1
"IX",399,399.0222,"AUPDID1",11.1,1,0)
1^F^399.0222^.09^^^F
"IX",399,399.0222,"AUPDID2",0)
399.0222^AUPDID2^UPDATE SECONDARY PROVIDER ID WHEN DATA FIELDS CHANGE AT PROVIDER LEVEL OF FILE^MU^^F^^I^399.0222^^^^^A
"IX",399,399.0222,"AUPDID2",.1,0)
^^6^6^3020206^
"IX",399,399.0222,"AUPDID2",.1,1,0)
This cross reference maintains the integrity of the rendering or 
"IX",399,399.0222,"AUPDID2",.1,2,0)
attending provider id whenever the secondary insurance company care unit
"IX",399,399.0222,"AUPDID2",.1,3,0)
is added, deleted or changed on the claim.  If a valid provider number can
"IX",399,399.0222,"AUPDID2",.1,4,0)
be determined by the new value of the care unit, this id # is placed in
"IX",399,399.0222,"AUPDID2",.1,5,0)
the secondary id field.  If no valid id can be determined for the
"IX",399,399.0222,"AUPDID2",.1,6,0)
provider, the secondary id field for the provider is deleted.
"IX",399,399.0222,"AUPDID2",1)
D:X1(1)'=X2(1) SETID^IBCEP3(DA(1),2)
"IX",399,399.0222,"AUPDID2",2)
D:X1(1)'=X2(1) DELID^IBCEP3(DA(1),2,1)
"IX",399,399.0222,"AUPDID2",2.5)
Q
"IX",399,399.0222,"AUPDID2",11.1,0)
^.114IA^1^1
"IX",399,399.0222,"AUPDID2",11.1,1,0)
1^F^399.0222^.1^^^F
"IX",399,399.0222,"AUPDID3",0)
399.0222^AUPDID3^UPDATE TERTIARY PROVIDER ID WHEN DATA FIELDS CHANGE AT PROVIDER LEVEL OF FILE^MU^^F^^I^399.0222^^^^^A
"IX",399,399.0222,"AUPDID3",.1,0)
^^6^6^3020206^
"IX",399,399.0222,"AUPDID3",.1,1,0)
This cross reference maintains the integrity of the rendering or attending
"IX",399,399.0222,"AUPDID3",.1,2,0)
provider id whenever the tertiary insurance company care unit is added,
"IX",399,399.0222,"AUPDID3",.1,3,0)
deleted or changed on the claim.  If a valid provider number can be
"IX",399,399.0222,"AUPDID3",.1,4,0)
determined by the new value of the care unit, this id # is placed in the
"IX",399,399.0222,"AUPDID3",.1,5,0)
tertiary id field.  If no valid id can be determined for the provider, the
"IX",399,399.0222,"AUPDID3",.1,6,0)
tertiary id field for the provider is deleted.
"IX",399,399.0222,"AUPDID3",1)
D:X1(1)'=X2(1) SETID^IBCEP3(DA(1),3)
"IX",399,399.0222,"AUPDID3",2)
D:X1(1)'=X2(1) DELID^IBCEP3(DA(1),3,1)
"IX",399,399.0222,"AUPDID3",2.5)
Q
"IX",399,399.0222,"AUPDID3",11.1,0)
^.114IA^1^1
"IX",399,399.0222,"AUPDID3",11.1,1,0)
1^F^399.0222^.11^^^F
"KRN",.402,1080,-1)
0^1
"KRN",.402,1080,0)
IB SCREEN8H^3021127.0909^@^399^^@^3030114
"KRN",.402,1080,"DIAB",1,0,399,1)
163;"PRIMARY AUTHORIZATION CODE"
"KRN",.402,1080,"DIAB",1,0,399,3)
232:
"KRN",.402,1080,"DIAB",8,0,399,0)
453;T
"KRN",.402,1080,"DIAB",10,0,399,0)
454;T
"KRN",.402,1080,"DIAB",10,1,399.0222,5)
.04;"REFERRING PROV STATE"
"KRN",.402,1080,"DR",1,399)
K DIPA S DIPA("I1")=$D(^DGCR(399,DA,"I1")),DIPA("I2")=$D(^("I2")),DIPA("I3")=$D(^("I3"));S:IBDR20'["81" Y="@82";166;167;@82;S:IBDR20'["82" Y="@83";215;453T~;S:'DIPA("I2") Y="@825";454T~;S:'DIPA("I3") Y="@825";455;@825;
"KRN",.402,1080,"DR",1,399,1)
163PRIMARY AUTHORIZATION CODE~;S:'DIPA("I2") Y="@83";230;S:'DIPA("I3") Y="@83";231;@83;S:IBDR20'["83" Y="@84";222;@84;S:IBDR20'["84" Y="@85";232;S DIPA("NVA_FC")=X S:DIPA("NVA_FC")="" Y="@85";
"KRN",.402,1080,"DR",1,399,2)
S DIPA("NVA_FC-0")=$G(^IBA(355.93,+DIPA("NVA_FC"),0)) S:$P(DIPA("NVA_FC-0"),U,5)'=""&($P(DIPA("NVA_FC-0"),U,6)'="")&($P(DIPA("NVA_FC-0"),U,7)'="") Y="@841";
"KRN",.402,1080,"DR",1,399,3)
^355.93^IBA(355.93,^^S I(0,0)=D0 S Y(1)=$S($D(^DGCR(399,D0,"U2")):^("U2"),1:"") S X=$P(Y(1),U,10),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");@841;233;234;@85;S:IBDR20'["85" Y="@86";459;D ASK19^IBCEU3(DA);236;237;
"KRN",.402,1080,"DR",1,399,4)
238//^S X=$S($$WNRBILL^IBEFUNC(DA):"31",1:"");@86;S:IBDR20'["86" Y="@99";S:$P($G(^IBE(350.9,1,0)),U,2)'=$P($G(^DG(40.8,+$P(^DGCR(399,DA,0),U,22),0)),U,7) Y="@861";401;@861;
"KRN",.402,1080,"DR",1,399,5)
S:'$P($G(^DGCR(399,DA,"TX")),U,8)&'$$TXMT^IBCEF4(DA) Y="@862";27//NO;@862;@99;
"KRN",.402,1080,"DR",2,355.93)
.05;.06;.07;.08;
"KRN",.402,1080,"DR",2,399.0222)
.01;S DIPA("RF")=X S:$D(^XUSEC("IB PROVIDER EDIT",DUZ)) DLAYGO=355.93;.02;K DLAYGO S DIPA("PRF")=X S:X="" Y="@98";
"KRN",.402,1080,"DR",2,399.0222,1)
N Z S Z=$$EXPAND^IBTRE(399.0222,.08,$P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,8)),DIPA("SPC")=$S(Z'="":Z,1:"UNSPECIFIED") W !,"    Prov Specialty On File: ",DIPA("SPC");
"KRN",.402,1080,"DR",2,399.0222,2)
N Z D SETT^IBCSC8H(.DIPA) S (Z,DIPA("CU1"))=$$CUNEED^IBCEP3(DA(1),1),Z=$S('$P(Z,U,2):1,'DIPA("I1"):2,1:0) S:Z Y="@830"_$P("1^",U,Z);D WRT2^IBCSC8H(1,.DIPA);.09;@8301;
"KRN",.402,1080,"DR",2,399.0222,3)
N Z S (Z,DIPA("CU2"))=$$CUNEED^IBCEP3(DA(1),2),Z=$S('$P(Z,U,3):1,'DIPA("I2"):2,1:0) S:Z Y="@830"_$P("2^",U,Z);D WRT2^IBCSC8H(2,.DIPA);.1;@8302;N Z S (Z,DIPA("CU3"))=$$CUNEED^IBCEP3(DA(1),3) S:'$P(Z,U,4)!'DIPA("I3") Y="@830";
"KRN",.402,1080,"DR",2,399.0222,4)
D WRT2^IBCSC8H(3,.DIPA);.11;@830;S DIPA("CRD")=$$CRED^IBCEU($P(^DGCR(399,DA(1),"PRV",DA,0),U,2));.03;K DIPA("W1") S:$G(DIPA("CRD"))'=$P(^DGCR(399,DA(1),"PRV",DA,0),U,3) DIPA("W1")=1;I $G(DIPA("W1")) D WRT1^IBCSC8H($G(DIPA("CRD")));
"KRN",.402,1080,"DR",2,399.0222,5)
K DIPA("W1");@8309;.05;S:'DIPA("I2") Y="@831";.06;S:'DIPA("I3") Y="@831";.07;@831;S:$G(DIPA("RF"))'=1 Y="@98";.04REFERRING PROV STATE~;@98;
"KRN",.402,1080,"ROU")
^IBXSC8H
"KRN",.402,1080,"ROUOLD")
IBXSC8H
"KRN",.402,1316,-1)
0^2
"KRN",.402,1316,0)
IB SCREEN82^3021127.0907^@^399^^@^3030114
"KRN",.402,1316,"DIAB",2,1,399.0222,6)
.04;"REFERRING PROVIDER STATE"
"KRN",.402,1316,"DIAB",4,0,399,0)
453;T
"KRN",.402,1316,"DIAB",6,0,399,0)
454;T
"KRN",.402,1316,"DIAB",8,0,399,0)
455;T
"KRN",.402,1316,"DIAB",10,0,399,0)
163;"PRIMARY AUTHORIZATION CODE"
"KRN",.402,1316,"DR",1,399)
K DIPA S DIPA("I1")=$D(^DGCR(399,DA,"I1")),DIPA("I2")=$D(^("I2")),DIPA("I3")=$D(^("I3"));S:IBDR20'["81" Y="@82";208;453T~;S:'DIPA("I2") Y="@8111";454T~;S:'DIPA("I3") Y="@8111";455T~;@8111;163PRIMARY AUTHORIZATION CODE~;
"KRN",.402,1316,"DR",1,399,1)
S:'DIPA("I2") Y="@811";230;S:'DIPA("I3") Y="@811";231;@811;215;159;@82;S:IBDR20'["82" Y="@83";222;@83;S:IBDR20'["83" Y="@84";450;451;@84;S:IBDR20'["84" Y="@85";452;@85;S:IBDR20'["85" Y="@86";456;458;@86;S:IBDR20'["86" Y="@87";
"KRN",.402,1316,"DR",1,399,2)
I '$P($G(^DGCR(399,DA,"TX")),U,8),'$$TXMT^IBCEF4(IBIFN) S Y="@861";27//NO FORCED PRINT;@861;@87;
"KRN",.402,1316,"DR",2,399.0222)
.01;S DIPA("RF")=X S:$D(^XUSEC("IB PROVIDER EDIT",DUZ)) DLAYGO=355.93;.02;K DLAYGO S DIPA("PRF")=X S:DIPA("PRF")="" Y="@98";
"KRN",.402,1316,"DR",2,399.0222,1)
N Z S Z=$$EXPAND^IBTRE(399.0222,.08,$P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,8)),DIPA("SPC")=$S(Z'="":Z,1:"UNSPECIFIED") W !,"    Prov Specialty On File: ",DIPA("SPC") W !,"    Provider Specialty On File: ",$G(DIPA("SPC"));
"KRN",.402,1316,"DR",2,399.0222,2)
N Z D SETT^IBCSC8H(.DIPA) S (Z,DIPA("CU1"))=$$CUNEED^IBCEP3(DA(1),1),Z=$S('$P(Z,U,2):1,'DIPA("I1"):2,1:0) S:Z Y="@820"_$P("1^",U,Z);D WRT2^IBCSC8H(1,.DIPA);.09;@8201;
"KRN",.402,1316,"DR",2,399.0222,3)
N Z S (Z,DIPA("CU2"))=$$CUNEED^IBCEP3(DA(1),2),Z=$S('$P(Z,U,3):1,'DIPA("I2"):2,1:0) S:Z Y="@820"_$P("2^",U,Z);D WRT2^IBCSC8H(2,.DIPA);.1;@8202;N Z S (Z,DIPA("CU3"))=$$CUNEED^IBCEP3(DA(1),3) S:'$P(Z,U,4)!'DIPA("I3") Y="@820";
"KRN",.402,1316,"DR",2,399.0222,4)
D WRT2^IBCSC8H(3,.DIPA);.11;@820;S DIPA("CRD")=$$CRED^IBCEU($P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,2));.03;K DIPA("W1") S:$G(DIPA("CRD"))'=$P($G(^DGCR(399,DA(1),"PRV",DA,0)),U,3) DIPA("W1")=1;
"KRN",.402,1316,"DR",2,399.0222,5)
I $G(DIPA("W1")) D WRT1^IBCSC8H($G(DIPA("CRD")));K DIPA("W1");@8209;.05;S DIPA("INS")=$P($G(^DGCR(399,DA(1),"M")),U,12,14);I '$P(DIPA("INS"),U,2) S Y="@821";.06;I '$P($G(DIPA("INS")),U,3) S Y="@821";.07;@821;
"KRN",.402,1316,"DR",2,399.0222,6)
I $G(DIPA("REF"))'=1 S Y="@98";.04REFERRING PROVIDER STATE~;@98;
"KRN",.402,1316,"ROU")
^IBXSC82
"KRN",.402,1316,"ROUOLD")
IBXSC82
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
207^3030121
"PKG",200,22,1,"PAH",1,1,0)
^^4^4^3030121
"PKG",200,22,1,"PAH",1,1,1,0)
This patch modifies two entries in file 364.7 - IB FORM FIELD CONTENT
"PKG",200,22,1,"PAH",1,1,2,0)
to address issues with Medicare rejections and Admit/Discharge dates.
"PKG",200,22,1,"PAH",1,1,3,0)
It also modifies the way box 24K is filled when billing secondary
"PKG",200,22,1,"PAH",1,1,4,0)
coverage on a claim where Medicare is primary.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","IB20P207")
0^^B11829648
"RTN","IB20P207",1,0)
IB20P207 ;BP/TJH; ENVIRONMENT CHECK WITH PRE-INIT CODE ; 01/03/2003
"RTN","IB20P207",2,0)
 ;;2.0;INTEGRATED BILLING;**207**;21-MAR-94
"RTN","IB20P207",3,0)
 ;
"RTN","IB20P207",4,0)
ENV ; environment check
"RTN","IB20P207",5,0)
 ; No special environment check at this time.
"RTN","IB20P207",6,0)
PRE ; set up check points for pre-init
"RTN","IB20P207",7,0)
 N %
"RTN","IB20P207",8,0)
 S %=$$NEWCP^XPDUTL("R28","R28^IB20P207")
"RTN","IB20P207",9,0)
 S %=$$NEWCP^XPDUTL("R900","R900^IB20P207")
"RTN","IB20P207",10,0)
 Q
"RTN","IB20P207",11,0)
 ;
"RTN","IB20P207",12,0)
R28 ; set new value into record 28 of file 364.7, re: WAS-0902-20562
"RTN","IB20P207",13,0)
 ; change the Format Code
"RTN","IB20P207",14,0)
 D BMES^XPDUTL("Updating format code for Admit Date.")
"RTN","IB20P207",15,0)
 N IBWPA,IBERRM,DA,DR,DIE,FILE,IENS,FIELD,FLAGS
"RTN","IB20P207",16,0)
 S DA=28,DR="1////"_$P($T(TEXT1),";",3),DIE="^IBA(364.7," D ^DIE
"RTN","IB20P207",17,0)
 ; change the Format Code Description
"RTN","IB20P207",18,0)
 D BMES^XPDUTL("Updating format code description for Admit Date.")
"RTN","IB20P207",19,0)
 S IBWPA(1)="Extract only date from date/time retrieved from IBXSAVE array previously"
"RTN","IB20P207",20,0)
 S IBWPA(2)="extracted.  For an outpatient claim not related to an inpatient episode,"
"RTN","IB20P207",21,0)
 S IBWPA(3)="output the statement 'To Date'.  Format date in CCYYMMDD format."
"RTN","IB20P207",22,0)
 S IBWPA(4)="If data element's value is null, do not output."
"RTN","IB20P207",23,0)
 S FILE=364.7,IENS="28,",FIELD=3,FLAGS=""
"RTN","IB20P207",24,0)
 D WP^DIE(FILE,IENS,FIELD,FLAGS,"IBWPA","IBERRM")
"RTN","IB20P207",25,0)
 D COMPLETE
"RTN","IB20P207",26,0)
 Q
"RTN","IB20P207",27,0)
 ;
"RTN","IB20P207",28,0)
R900 ; set new values into record 900 of file 364.7, re: CTX-1002-70456
"RTN","IB20P207",29,0)
 ; change the Data Element from 234 to 236
"RTN","IB20P207",30,0)
 D BMES^XPDUTL("For IEN 900, file 364.7: changing data element from")
"RTN","IB20P207",31,0)
 D MES^XPDUTL("N-OTHER INSURANCE CO TYPES to N-OTH INS POL TYPES.")
"RTN","IB20P207",32,0)
 N IBELE,IBWPA,IBERRM,DA,DR,DIE,FILE,IENS,FIELD,FLAGS
"RTN","IB20P207",33,0)
 S IBELE=+$O(^IBA(364.5,"B","N-OTH INS POL TYPES",0))
"RTN","IB20P207",34,0)
 S:'IBELE IBELE=236
"RTN","IB20P207",35,0)
 S DA=900,DR=".03////"_IBELE,DIE="^IBA(364.7," D ^DIE
"RTN","IB20P207",36,0)
 ; change the Format Code
"RTN","IB20P207",37,0)
 D BMES^XPDUTL("Updating format code for N-OTH INS POL TYPES.")
"RTN","IB20P207",38,0)
 S DA=900,DR="1////"_$P($T(TEXT2),";",3),DIE="^IBA(364.7," D ^DIE
"RTN","IB20P207",39,0)
 ; change the Format Code Description
"RTN","IB20P207",40,0)
 D BMES^XPDUTL("Updating format code description for N-OTH INS POL TYPES.")
"RTN","IB20P207",41,0)
 S IBWPA(1)="If any 'other' insurance company data is found, the data is formatted"
"RTN","IB20P207",42,0)
 S IBWPA(2)="from the electronic type of plan of the insurance company policy in X12"
"RTN","IB20P207",43,0)
 S IBWPA(3)="format.  Refer to the 837 V4010 (professional) field 2330/REF(3)/01"
"RTN","IB20P207",44,0)
 S IBWPA(4)="for details."
"RTN","IB20P207",45,0)
 S FILE=364.7,IENS="900,",FIELD=3,FLAGS=""
"RTN","IB20P207",46,0)
 D WP^DIE(FILE,IENS,FIELD,FLAGS,"IBWPA","IBERRM")
"RTN","IB20P207",47,0)
 D COMPLETE
"RTN","IB20P207",48,0)
 Q
"RTN","IB20P207",49,0)
 ;
"RTN","IB20P207",50,0)
COMPLETE ; display message that step has completed successfully
"RTN","IB20P207",51,0)
 D BMES^XPDUTL("Step complete.")
"RTN","IB20P207",52,0)
 Q
"RTN","IB20P207",53,0)
 ;
"RTN","IB20P207",54,0)
END ; display message that pre-init has completed successfully
"RTN","IB20P207",55,0)
 D BMES^XPDUTL("Pre-init complete")
"RTN","IB20P207",56,0)
 Q
"RTN","IB20P207",57,0)
 ;
"RTN","IB20P207",58,0)
TEXT ;Storage area for long strings of text
"RTN","IB20P207",59,0)
TEXT1 ;;S IBXDATA=$G(IBXSAVE("DISDT")) D:$S(IBXDATA="":'$$INPAT^IBCEF(IBXIEN,1),1:0) F^IBCEF("N-STATEMENT COVERS TO DATE",,,IBXIEN) I IBXDATA S IBXDATA=$$DT^IBCEFG1(IBXDATA\1,"","D8")
"RTN","IB20P207",60,0)
TEXT2 ;;N A,Z,Q S Q=IBXDATA K IBXDATA F Z=1,2 S A=$P(Q,U,Z) I $D(^DGCR(399,IBXIEN,"I"_(Z+1))) S IBXDATA(Z)=$S(A="":"G2","MAMB16"[A:"1C",A="TV"!(A="MC"):"1D",A="CH":"1H",A="BL":$S($$FT^IBCEF(IBXIEN)=2:"1B",1:"1A"),1:"G2")
"RTN","IBCEP3")
0^1^B39231705
"RTN","IBCEP3",1,0)
IBCEP3 ;ALB/TMP - EDI UTILITIES for provider ID ;25-SEP-00
"RTN","IBCEP3",2,0)
 ;;2.0;INTEGRATED BILLING;**137,207**;21-MAR-94
"RTN","IBCEP3",3,0)
 ;
"RTN","IBCEP3",4,0)
CUNEED(IBIFN,IBSEQ,IBPTYP,IBRET,IBEMC) ; Determine if care unit needed for
"RTN","IBCEP3",5,0)
 ; provider type and insurance company(s) on bill
"RTN","IBCEP3",6,0)
 ; IBIFN = ien of bill (file 399)
"RTN","IBCEP3",7,0)
 ; IBSEQ = specific COB sequence to check or null for check all
"RTN","IBCEP3",8,0)
 ; IBPTYP = the ien of the provider id type in file 355.97 or if null,
"RTN","IBCEP3",9,0)
 ;          the default performing provider ID type for the ins co's.
"RTN","IBCEP3",10,0)
 ; IBRET = flag to return insurance ien (0) or file 355.97 ien (1)
"RTN","IBCEP3",11,0)
 ; IBEMC = sent as 1 if check for EMC id instead of performing provider
"RTN","IBCEP3",12,0)
 ;
"RTN","IBCEP3",13,0)
 ; Function returns care unit needed flag (0=not needed, 1=needed) ^
"RTN","IBCEP3",14,0)
 ; AND   if IBSEQ="": primary ins or 355.97 ien if care unit needed ^
"RTN","IBCEP3",15,0)
 ;                    secondary ins or 355.97 ien if care unit needed ^
"RTN","IBCEP3",16,0)
 ;                    tertiary ins or 355.97 ien if care unit needed
"RTN","IBCEP3",17,0)
 ;                    (these would be '^' pieces 2,3,4)
"RTN","IBCEP3",18,0)
 ;       if IBSEQ   : IBSEQ seq ins or 355.97 ien if care unit needed
"RTN","IBCEP3",19,0)
 ;                    (this would be '^' piece 2)
"RTN","IBCEP3",20,0)
 ;
"RTN","IBCEP3",21,0)
 N Q,Z,Z0,Z4,IB,IBCTYP,IBFTYP,IBQ,IBRX,IBPT
"RTN","IBCEP3",22,0)
 S (IBRX,IB)=0
"RTN","IBCEP3",23,0)
 S IBFTYP=$$FT^IBCEF(IBIFN),IBCTYP=$$INPAT^IBCEF(IBIFN,1)
"RTN","IBCEP3",24,0)
 S IBFTYP=$S(IBFTYP=3:1,1:2) S:IBCTYP'=1 IBCTYP=2
"RTN","IBCEP3",25,0)
 I IBCTYP=2 S IBRX=$$ISRX^IBCEF1(IBIFN) ; Outpatient pharmacy
"RTN","IBCEP3",26,0)
 S IBPT=$G(IBPTYP)
"RTN","IBCEP3",27,0)
 ;
"RTN","IBCEP3",28,0)
 S (Z,IBQ)=0
"RTN","IBCEP3",29,0)
 F  D  Q:IBQ
"RTN","IBCEP3",30,0)
 . I $G(IBSEQ) S Z=IBSEQ,IBQ=1 ; Only once for specific COB sequence
"RTN","IBCEP3",31,0)
 . I '$G(IBSEQ) S Z=Z+1,IBPTYP=IBPT I Z>3 S IBQ=1 Q  ; Up to 3 times - all ins
"RTN","IBCEP3",32,0)
 . S Z0=$$INSSEQ^IBCEP1(IBIFN,Z),Z4=$G(^DIC(36,+Z0,4))
"RTN","IBCEP3",33,0)
 . I '$G(IBPTYP) S IBPTYP=$S('$G(IBEMC):+Z4,1:$$EMCID^IBCEP())
"RTN","IBCEP3",34,0)
 . I 'Z0!'IBPTYP S:'Z0 IBQ=1 Q
"RTN","IBCEP3",35,0)
 . S Q=$S($P(Z4,U,$S('$G(IBEMC):2,1:6))=5:$$CAREUN(Z0,IBPTYP,IBFTYP,IBCTYP,IBRX),1:0)
"RTN","IBCEP3",36,0)
 . I Q S $P(IB,U,$S($G(IBSEQ):Z+1,1:2))=$S($G(IBRET):Q,1:Z0)
"RTN","IBCEP3",37,0)
 ;
"RTN","IBCEP3",38,0)
 I $TR(IB,"^0") S $P(IB,U)=1
"RTN","IBCEP3",39,0)
 Q IB
"RTN","IBCEP3",40,0)
 ;
"RTN","IBCEP3",41,0)
CAREUN(IBINS,IBPTYP,IBFTYP,IBCTYP,IBRX) ; Find ien (file 355.96) for care
"RTN","IBCEP3",42,0)
 ; unit for the combination of ins co, prov type, form type and
"RTN","IBCEP3",43,0)
 ; care type
"RTN","IBCEP3",44,0)
 ; IBINS = ien of ins co (file 36)
"RTN","IBCEP3",45,0)
 ; IBPTYP = ien of provider id type (file 355.97)
"RTN","IBCEP3",46,0)
 ; IBFTYP = form type (1=UB92,2=HCFA)
"RTN","IBCEP3",47,0)
 ; IBCTYP = care type (1=inpat,2=outpat)
"RTN","IBCEP3",48,0)
 ; IBRX = 1 if outpat/Rx bill
"RTN","IBCEP3",49,0)
 ;
"RTN","IBCEP3",50,0)
 N IB
"RTN","IBCEP3",51,0)
 S IB=""
"RTN","IBCEP3",52,0)
 ;
"RTN","IBCEP3",53,0)
 I $G(IBRX) D
"RTN","IBCEP3",54,0)
 . N T
"RTN","IBCEP3",55,0)
 . S T=$O(^IBA(355.96,"AD",IBINS,IBFTYP,3,IBPTYP,0))
"RTN","IBCEP3",56,0)
 . I 'T S T=$O(^IBA(355.96,"AD",IBINS,0,3,IBPTYP,0))
"RTN","IBCEP3",57,0)
 . I T S IB=T
"RTN","IBCEP3",58,0)
 ;
"RTN","IBCEP3",59,0)
 I 'IB D  ; Find from most specific to least specific
"RTN","IBCEP3",60,0)
 . I $O(^IBA(355.96,"AD",IBINS,IBFTYP,IBCTYP,IBPTYP,0)) S IB=+$O(^(0)) Q
"RTN","IBCEP3",61,0)
 . I $O(^IBA(355.96,"AD",IBINS,IBFTYP,0,IBPTYP,0)) S IB=+$O(^(0)) Q
"RTN","IBCEP3",62,0)
 . I $O(^IBA(355.96,"AD",IBINS,0,IBCTYP,IBPTYP,0)) S IB=+$O(^(0)) Q
"RTN","IBCEP3",63,0)
 . I $O(^IBA(355.96,"AD",IBINS,0,0,IBPTYP,0)) S IB=+$O(^(0)) Q
"RTN","IBCEP3",64,0)
 ;
"RTN","IBCEP3",65,0)
 Q IB
"RTN","IBCEP3",66,0)
 ;
"RTN","IBCEP3",67,0)
DISP(IBINS,IBTYPE) ; Return the name of the type of care unit needed
"RTN","IBCEP3",68,0)
 ; IBINS = ien of ins co (file 36)
"RTN","IBCEP3",69,0)
 ; IBTYPE = 1:EMC ID    2:PERFORMING PROVIDER ID
"RTN","IBCEP3",70,0)
 I '$G(IBTYPE) S IBTYPE=2 ; Default if not passed is perf prov
"RTN","IBCEP3",71,0)
 Q $P($G(^DIC(36,+IBINS,4)),U,(IBTYPE+7))
"RTN","IBCEP3",72,0)
 ;
"RTN","IBCEP3",73,0)
DELID(IBIFN,IBSEQ,IBX) ; Delete all provider data specific to an ins co
"RTN","IBCEP3",74,0)
 ; represented by the COB sequence IBSEQ for bill IBIFN
"RTN","IBCEP3",75,0)
 ; IBX = 1 if called from care unit prompt - don't delete value
"RTN","IBCEP3",76,0)
 N IBZ,IBDR,X,Y
"RTN","IBCEP3",77,0)
 S IBZ=0
"RTN","IBCEP3",78,0)
 Q:'$G(IBSEQ)!($G(IBSEQ)>3)
"RTN","IBCEP3",79,0)
 F  S IBZ=$O(^DGCR(399,IBIFN,"PRV",IBZ)) Q:'IBZ  S Z0=$G(^(IBZ,0)),Z1=$G(^(1)) D
"RTN","IBCEP3",80,0)
 . ; Delete provider id's
"RTN","IBCEP3",81,0)
 . I $P(Z0,U,4+IBSEQ)'="" S IBDR(399.0222,IBZ_","_IBIFN_",",(4+IBSEQ/100))="@"
"RTN","IBCEP3",82,0)
 . Q:$G(IBX)
"RTN","IBCEP3",83,0)
 . ; Delete perf prov care unit
"RTN","IBCEP3",84,0)
 . I $P(Z0,U,8+IBSEQ)'="" S IBDR(399.0222,IBZ_","_IBIFN_",",(8+IBSEQ/100))="@"
"RTN","IBCEP3",85,0)
 . ; Delete EMC care units
"RTN","IBCEP3",86,0)
 . I $P(Z1,U,IBSEQ)'="" S IBDR(399.0222,IBZ_","_IBIFN_",",(IBSEQ/100))="@"
"RTN","IBCEP3",87,0)
 . I $D(IBDR) D FILE^DIE(,"IBDR")
"RTN","IBCEP3",88,0)
 Q
"RTN","IBCEP3",89,0)
 ;
"RTN","IBCEP3",90,0)
SETID(IBIFN,IBSEQ) ; Default provider id for bill IBIFN and ins co for COB
"RTN","IBCEP3",91,0)
 ; sequence IBSEQ
"RTN","IBCEP3",92,0)
 N IBZ,X,Y,IBDR
"RTN","IBCEP3",93,0)
 S IBZ=0
"RTN","IBCEP3",94,0)
 Q:'$G(IBSEQ)!($G(IBSEQ)>3)
"RTN","IBCEP3",95,0)
 F  S IBZ=$O(^DGCR(399,IBIFN,"PRV",IBZ)) Q:'IBZ  S Z0=$G(^(IBZ,0)),Z1=$G(^(1)) D
"RTN","IBCEP3",96,0)
 . ; Update provider id's if no care unit is needed
"RTN","IBCEP3",97,0)
 . I $P(Z0,U,2)'="" S IBDR(399.0222,IBZ_","_IBIFN_",",(4+IBSEQ/100))=$$GETID^IBCEP2(IBIFN,2,$P(Z0,U,2),IBSEQ)
"RTN","IBCEP3",98,0)
 . I $D(IBDR) D FILE^DIE(,"IBDR")
"RTN","IBCEP3",99,0)
 Q
"RTN","IBCEP3",100,0)
 ;
"RTN","IBCEP3",101,0)
ALLID(IBIFN,IBFLD,IBFUNC) ; If form type or care type (I/O/RX) changes,
"RTN","IBCEP3",102,0)
 ; determine new provider id values if possible and update them
"RTN","IBCEP3",103,0)
 ; this includes primary, secondary, tertiary id's
"RTN","IBCEP3",104,0)
 ; IBIFN = ien of claim (file 399)
"RTN","IBCEP3",105,0)
 ; IBFLD = ien of the field being changed when this call is made
"RTN","IBCEP3",106,0)
 ;         (.19 = form type   .25 = care type)
"RTN","IBCEP3",107,0)
 ; IBFUNC = 1 to add,  2 to delete
"RTN","IBCEP3",108,0)
 N Z,Z0,IBC,IBDR
"RTN","IBCEP3",109,0)
 S Z=0
"RTN","IBCEP3",110,0)
 F  S Z=$O(^DGCR(399,IBIFN,"PRV",Z)) Q:'Z  S Z0=$G(^(Z,0)) D
"RTN","IBCEP3",111,0)
 . F IBC=5:1:7 I $S(IBFUNC=2:$P(Z0,U,IBC)'="",1:1) S IBDR(399.0222,IBC_","_IBIFN_",",(IBC/100))=$S(IBFUNC=2:"@",1:$$GETID^IBCEP2(IBIFN,2,$P(Z0,U,2),IBC-4))
"RTN","IBCEP3",112,0)
 I $D(IBDR) D FILE^DIE(,"IBDR")
"RTN","IBCEP3",113,0)
 Q
"RTN","IBCEP3",114,0)
 ;
"RTN","IBCEP3",115,0)
CUMNT ; Add/edit care unit
"RTN","IBCEP3",116,0)
 N D,DIE,DIC,DIK,DIR,DA,X,Y,IB,IBINS,IBF,IBCT,IBOK,IBPTYP,IBOLD,IBY,IBINS1,IBPTYP1
"RTN","IBCEP3",117,0)
INS F  D  Q:Y'>0
"RTN","IBCEP3",118,0)
 . S DIC="^DIC(36,",DIC(0)="AEMQ" D ^DIC K DIC
"RTN","IBCEP3",119,0)
 . I $D(DUOUT)!$D(DTOUT) S Y=-1 Q
"RTN","IBCEP3",120,0)
 . I Y'>0 S DIR(0)="EA",DIR("A")="Insurance Co is required - press enter to continue: " D ^DIR K DIR Q
"RTN","IBCEP3",121,0)
 . S IBINS=+Y,IBF="A",IBINS1=$P(Y,U,2)
"RTN","IBCEP3",122,0)
 I $O(^IBA(355.96,"D",IBINS,""))'="" D
"RTN","IBCEP3",123,0)
 . W ! S DIR("A")="(A)dd or (E)dit entries?: ",DIR("B")="Add",DIR(0)="SA^A:Add;E:Edit" D ^DIR W ! K DIR
"RTN","IBCEP3",124,0)
 . S IBF=Y
"RTN","IBCEP3",125,0)
 Q:$G(IBF)=""!("AE"'[$G(IBF))
"RTN","IBCEP3",126,0)
 ;
"RTN","IBCEP3",127,0)
 I IBINS>0 D
"RTN","IBCEP3",128,0)
 . I IBF="A" D NEW^IBCEP4A(1)
"RTN","IBCEP3",129,0)
 . I IBF="E" D CHANGE^IBCEP4A(1)
"RTN","IBCEP3",130,0)
 ;
"RTN","IBCEP3",131,0)
 Q
"RTN","IBCEP3",132,0)
 ;
"RTN","IBCEP3",133,0)
DUP(IBDA,IBOLD,IBFUNC) ; Check if the combination of ins co, prov type, care
"RTN","IBCEP3",134,0)
 ; type and form already exists in file 355.96
"RTN","IBCEP3",135,0)
 ; IBDA = ien of entry in file 355.96
"RTN","IBCEP3",136,0)
 ; IBOLD = the 0-node before changes were made - used to reset the fields
"RTN","IBCEP3",137,0)
 N DUP,IB0,DR,X,Y,DIK,DIE,DA
"RTN","IBCEP3",138,0)
 S IB0=$G(^IBA(355.96,IBDA,0)),DUP=0
"RTN","IBCEP3",139,0)
 ;
"RTN","IBCEP3",140,0)
 I $O(^IBA(355.96,"AUNIQ",+$P(IB0,U,3),+IB0,+$P(IB0,U,4),+$P(IB0,U,5),+$P(IB0,U,6),0))'=IBDA!($O(^IBA(355.96,"AUNIQ",+$P(IB0,U,3),+IB0,+$P(IB0,U,4),+$P(IB0,U,5),+$P(IB0,U,6),""),-1)'=IBDA) D
"RTN","IBCEP3",141,0)
 . S DUP=1
"RTN","IBCEP3",142,0)
 . I IBFUNC="E" D
"RTN","IBCEP3",143,0)
 .. S DR=";.01///"_$P(IBOLD,U)_";.03///"_$S($P(IBOLD,U,3)'="":"/"_$P(IBOLD,U,3),1:"@")_";.04///"_$S($P(IBOLD,U,4)'="":"/"_$P(IBOLD,U,4),1:"@")
"RTN","IBCEP3",144,0)
 .. S DR=DR_";05///"_$S($P(IBOLD,U,5)'="":"/"_$P(IBOLD,U,5),1:"@")_";.06///"_$S($P(IBOLD,U,6)'="":"/"_$P(IBOLD,U,6),1:"@")
"RTN","IBCEP3",145,0)
 .. S DA=IBDA,DIE="^IBA(355.96," D ^DIE
"RTN","IBCEP3",146,0)
 . I IBFUNC="A" D
"RTN","IBCEP3",147,0)
 .. S DA=IBDA,DIK="^IBA(355.96," D ^DIK
"RTN","IBCEP3",148,0)
 Q DUP
"RTN","IBCEP3",149,0)
 ;
"RTN","IBCEP3",150,0)
PROFID(IBIFN,IBSEQ,IBID) ; Return id and type of rendering provider id
"RTN","IBCEP3",151,0)
 ; used for insurance co at COB seq IBSEQ for bill ien IBIFN
"RTN","IBCEP3",152,0)
 ; RETURN VALUES:
"RTN","IBCEP3",153,0)
 ; piece 1:
"RTN","IBCEP3",154,0)
 ;  1 = FEDERAL TAX ID
"RTN","IBCEP3",155,0)
 ;  2 = INSURANCE CO SPECIFIC ID
"RTN","IBCEP3",156,0)
 ;  3 = NETWORK ID
"RTN","IBCEP3",157,0)
 ; "" = not a HCFA bill or no id found
"RTN","IBCEP3",158,0)
 ; piece 2:
"RTN","IBCEP3",159,0)
 ;  the id #
"RTN","IBCEP3",160,0)
 N IBTYP,IBXDATA,IBZ
"RTN","IBCEP3",161,0)
 S:'$G(IBSEQ) IBSEQ=+$$COBN^IBCEF(IBXIEN)
"RTN","IBCEP3",162,0)
 S IBTYP=""_U_$G(IBID)
"RTN","IBCEP3",163,0)
 G:$$FT^IBCEF(IBIFN)'=2 PROFIDQ
"RTN","IBCEP3",164,0)
 I '$D(IBID) D F^IBCEF("N-ALL ATT/RENDERING PROV ID","IBZ",,IBIFN) S IBID=$$NOPUNCT^IBCEF($P(IBZ,U,IBSEQ+1))
"RTN","IBCEP3",165,0)
 G:IBID="" PROFIDQ
"RTN","IBCEP3",166,0)
 S IBTYP=$S($$NOPUNCT^IBCEF(IBID)=$$NOPUNCT^IBCEF($P($G(^IBE(350.9,1,1)),U,5)):1,$$NETWRK(IBIFN,IBID,IBSEQ):3,1:2)
"RTN","IBCEP3",167,0)
 S IBTYP=IBTYP_U_IBID
"RTN","IBCEP3",168,0)
 ;
"RTN","IBCEP3",169,0)
PROFIDQ Q IBTYP
"RTN","IBCEP3",170,0)
 ;
"RTN","IBCEP3",171,0)
NETWRK(IBIFN,IBID,IBSEQ) ; Determine if ID number IBID is the same as the
"RTN","IBCEP3",172,0)
 ; network id for the insurance co
"RTN","IBCEP3",173,0)
 ;  IBIFN = bill ien (file 399)
"RTN","IBCEP3",174,0)
 ;  IBSEQ = COB seq # of bill
"RTN","IBCEP3",175,0)
 ;   Returns 1 if network ID match is found for bill IBIFN, COB seq IBSEQ
"RTN","IBCEP3",176,0)
 N IBINS,IBNET
"RTN","IBCEP3",177,0)
 S IBNET=0
"RTN","IBCEP3",178,0)
 Q IBNET
"RTN","IBCEP3",179,0)
 ; This section needs work *********
"RTN","IBCEP3",180,0)
 I '$G(IBSEQ) S IBSEQ=+$$COBN^IBCEF(IBXIEN)
"RTN","IBCEP3",181,0)
 S IBINS=+$G(^DGCR(399,IBIFN,"I"_IBSEQ))
"RTN","IBCEP3",182,0)
 I $P($G(^IBE(355.97,+$$PPTYP^IBCEP0(IBINS),1)),U,6) D
"RTN","IBCEP3",183,0)
 . ; performing provider id type is a network id type
"RTN","IBCEP3",184,0)
 . I $$NOPUNCT^IBCEF($G(IBID))=$$NOPUNCT^IBCEF($$GETID^IBCEP2(IBIFN,3,$$PERFPRV^IBCEP2A(IBIFN),IBSEQ)) S IBNET=1
"RTN","IBCEP3",185,0)
 Q IBNET
"RTN","IBCEP3",186,0)
 ;
"RTN","IBCEU")
0^3^B54422781
"RTN","IBCEU",1,0)
IBCEU ;ALB/TMP - EDI UTILITIES ;02-OCT-96
"RTN","IBCEU",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,207**;21-MAR-94
"RTN","IBCEU",3,0)
 ; DBIA SUPPORTED REF: GET^XUA4A72 = 1625
"RTN","IBCEU",4,0)
 ; DBIA SUPPORTED REF: $$ESBLOCK^XUSESIG1 = 1557
"RTN","IBCEU",5,0)
 ;
"RTN","IBCEU",6,0)
TESTPT(DFN) ; Determine if pt is test pt
"RTN","IBCEU",7,0)
 ; Returns 1 if a test pt, 0 if not
"RTN","IBCEU",8,0)
 Q $E($P($G(^DPT(+DFN,0)),U,9),1,5)="00000"
"RTN","IBCEU",9,0)
 ;
"RTN","IBCEU",10,0)
MAINPRV(IBIFN) ; Returns name^id^ien^type code of 'main' prov on bill IBIFN
"RTN","IBCEU",11,0)
 N IBPRV,IBCOB,IBQ,Z
"RTN","IBCEU",12,0)
 D GETPRV(IBIFN,"3,4",.IBPRV)
"RTN","IBCEU",13,0)
 S IBQ="",IBCOB=$$COBN^IBCEF(IBIFN)
"RTN","IBCEU",14,0)
 F Z=3,4 I $G(IBPRV(Z,1))'="" D  Q
"RTN","IBCEU",15,0)
 . S IBQ=IBPRV(Z,1),$P(IBQ,U,4)=Z
"RTN","IBCEU",16,0)
 . I $G(IBPRV(Z,1,IBCOB))'="" S $P(IBQ,U,2)=IBPRV(Z,1,IBCOB)
"RTN","IBCEU",17,0)
 Q IBQ
"RTN","IBCEU",18,0)
 ;
"RTN","IBCEU",19,0)
PRVOK(VAL,IBIFN) ; Check bill form & prov function agree
"RTN","IBCEU",20,0)
 ; VAL = internal value of prov function
"RTN","IBCEU",21,0)
 ;
"RTN","IBCEU",22,0)
 ; OTHER(9) and REFERRING(1) valid all bills
"RTN","IBCEU",23,0)
 ; Valid functions by bill types
"RTN","IBCEU",24,0)
 ;  OUTPATIENT/UB-92: ATTENDING(4), OPERATING(2)-BILL TYPE 83X
"RTN","IBCEU",25,0)
 ;                     AND A PRIN. PROC EXISTS
"RTN","IBCEU",26,0)
 ;  INPATIENT/UB-92 : ATTENDING(4), OPERATING(2)-BILL TYPE 11X
"RTN","IBCEU",27,0)
 ;                     AND A PRIN. PROC EXISTS
"RTN","IBCEU",28,0)
 ;  OUTPATIENT/HCFA 1500 : RENDERING(3)
"RTN","IBCEU",29,0)
 ;  INPATIENT/HCFA 1500  : RENDERING(3)
"RTN","IBCEU",30,0)
 ;
"RTN","IBCEU",31,0)
 N OK,IBUB92
"RTN","IBCEU",32,0)
 S VAL=$$UP^XLFSTR(VAL)
"RTN","IBCEU",33,0)
 S OK=$S(VAL'="":1,1:0)
"RTN","IBCEU",34,0)
 G:'OK!'$G(IBIFN) PRVQ
"RTN","IBCEU",35,0)
 ;
"RTN","IBCEU",36,0)
 I VAL=9!(VAL=1) G PRVQ
"RTN","IBCEU",37,0)
 ;
"RTN","IBCEU",38,0)
 S IBUB92=($$FT^IBCEF(IBIFN)=3) ; 1 if UB-92 ; 0 if HCFA 1500
"RTN","IBCEU",39,0)
 ;
"RTN","IBCEU",40,0)
 I "24"[VAL,'IBUB92 S OK=0 G PRVQ
"RTN","IBCEU",41,0)
 I VAL=3,IBUB92 S OK=0 G PRVQ
"RTN","IBCEU",42,0)
 ;
"RTN","IBCEU",43,0)
PRVQ Q OK
"RTN","IBCEU",44,0)
 ;
"RTN","IBCEU",45,0)
PRVOK1(VAL,IBIFN) ; Check for both attending and rendering on bill
"RTN","IBCEU",46,0)
 N OK
"RTN","IBCEU",47,0)
 S OK=1
"RTN","IBCEU",48,0)
 I $S("34"'[VAL:0,1:$D(^DGCR(399,IBIFN,"PRV","B",$S(VAL=3:4,1:3)))) D EN^DDIOL($S(VAL=3:"ATTENDING",1:"RENDERING")_" ALREADY EXISTS - CAN'T HAVE BOTH ON ONE BILL") S OK=0
"RTN","IBCEU",49,0)
 Q OK
"RTN","IBCEU",50,0)
 ;
"RTN","IBCEU",51,0)
SPEC(IBPRV,IBDT) ; Returns spec code for vp ien IBPRV from file 355.9
"RTN","IBCEU",52,0)
 ;  (for new person entries, as of date in IBDT)
"RTN","IBCEU",53,0)
 ; DBIA 1625
"RTN","IBCEU",54,0)
 N IBSPEC
"RTN","IBCEU",55,0)
 S:'$G(IBDT) IBDT=DT
"RTN","IBCEU",56,0)
 I IBPRV'["IBA(355.93" S IBSPEC=$S(IBPRV:$P($$GET^XUA4A72(+IBPRV,IBDT),U,8),1:"") ; VA
"RTN","IBCEU",57,0)
 I IBPRV["IBA(355.93" S IBSPEC=$P($G(^IBA(355.93,+IBPRV,0)),U,4) ; Non-VA
"RTN","IBCEU",58,0)
 Q IBSPEC
"RTN","IBCEU",59,0)
 ;
"RTN","IBCEU",60,0)
CRED(IBPRV,IBIFN,IBPIEN,IBTYP) ; Returns prov credentials
"RTN","IBCEU",61,0)
 ; IBPRV = vp of provider for file 200 or 355.93
"RTN","IBCEU",62,0)
 ; IBIFN = bill ien in file 399 (optional)
"RTN","IBCEU",63,0)
 ; IBPIEN = prov ien - file 399.0222 (optional)
"RTN","IBCEU",64,0)
 ; IBTYP = the prov type
"RTN","IBCEU",65,0)
 ;
"RTN","IBCEU",66,0)
 N IBCRED
"RTN","IBCEU",67,0)
 S IBCRED=""
"RTN","IBCEU",68,0)
 I $G(IBIFN),'$D(^DGCR(399,IBIFN,"PRV",0)) G CREDQ
"RTN","IBCEU",69,0)
 I $G(IBIFN),($G(IBPIEN)!$G(IBTYP)) D
"RTN","IBCEU",70,0)
 . I '$G(IBPIEN) S IBPIEN=+$O(^DGCR(399,IBIFN,"PRV","B",IBTYP,0))
"RTN","IBCEU",71,0)
 . S IBCRED=$P($G(^DGCR(399,IBIFN,"PRV",IBPIEN,0)),U,3)
"RTN","IBCEU",72,0)
 I $G(IBPRV),IBCRED="" D
"RTN","IBCEU",73,0)
 . I IBPRV'["IBA(355.93" S IBCRED=$P($$ESBLOCK^XUSESIG1(+IBPRV),U,2)
"RTN","IBCEU",74,0)
 . I IBPRV["IBA(355.93" S IBCRED=$P($G(^IBA(355.93,+IBPRV,0)),U,3)
"RTN","IBCEU",75,0)
CREDQ Q IBCRED
"RTN","IBCEU",76,0)
 ;
"RTN","IBCEU",77,0)
GETPRV(IBIFN,IBTYP,IBPRV) ; Returns prov(s) of type(s) IBTYP for
"RTN","IBCEU",78,0)
 ;  bill ien IBIFN.
"RTN","IBCEU",79,0)
 ;  IBTYP = prov types needed, separated by ',' or ALL
"RTN","IBCEU",80,0)
 ; 
"RTN","IBCEU",81,0)
 ; OUTPUT:
"RTN","IBCEU",82,0)
 ;  IBPRV array: IBPRV(type)= 1 if prov is from old prov flds
"RTN","IBCEU",83,0)
 ;               IBPRV(type,ct)=name^current COB id^vp provider ien^cred
"RTN","IBCEU",84,0)
 ;               IBPRV(type,ct,seq)=COB seq specific id
"RTN","IBCEU",85,0)
 ;               IBPRV(type)=default nm^def id
"RTN","IBCEU",86,0)
 ;               IBPRV(type,"NOTOPT")= defined if a required prov type
"RTN","IBCEU",87,0)
 ;
"RTN","IBCEU",88,0)
 N IB,IBCT,IBD,IBY,IBZ,IBMRAND,IBID,IBWNR,IBPNM,Z ;,IBZFID
"RTN","IBCEU",89,0)
 ;S IBZFID=""
"RTN","IBCEU",90,0)
 D F^IBCEF("N-CURRENT INS POLICY TYPE","IBZ",,IBIFN)
"RTN","IBCEU",91,0)
 ;I IBZ="CI" D F^IBCEF("N-FEDERAL TAX ID","IBZFID",,IBIFN) S IBZFID=$TR(IBZFID,"-")
"RTN","IBCEU",92,0)
 S IBPRV=U_$G(IBZ),IBY=0
"RTN","IBCEU",93,0)
 S IBMRAND=$$MCRONBIL^IBEFUNC(IBIFN)
"RTN","IBCEU",94,0)
 I IBMRAND D
"RTN","IBCEU",95,0)
 . F Z=1:1:3 S:Z=3&($$FT^IBCEF(IBIFN)=3) Z=4 S IBPRV(Z)=$S(Z=3!(Z=4):"DEPT VETERANS AFFAIRS",1:"")_"^VAD000"
"RTN","IBCEU",96,0)
 . I '$$INPAT^IBCEF(IBIFN,1),$$FT^IBCEF(IBIFN)=3 S IBPRV(4,1)="^SLF000"
"RTN","IBCEU",97,0)
 ;
"RTN","IBCEU",98,0)
 I '$D(^DGCR(399,+IBIFN,"PRV",0)) D  G GETQ
"RTN","IBCEU",99,0)
 . N IBALL
"RTN","IBCEU",100,0)
 . S IBALL=(IBTYP="ALL")
"RTN","IBCEU",101,0)
 . I IBTYP[4!IBALL S:$P($G(^DGCR(399,+IBIFN,"U1")),U,13)'="" IBPRV(4,1)=$P(^("U1"),U,13),IBPRV(4)=1 Q:IBTYP=4
"RTN","IBCEU",102,0)
 . I IBTYP[3!IBALL S:$P($G(^DGCR(399,+IBIFN,"UF2")),U)'="" IBPRV(3,1)=$P(^("UF2"),U),IBPRV(3)=1 Q:IBTYP=3
"RTN","IBCEU",103,0)
 . I IBTYP[9!IBALL S:$P($G(^DGCR(399,+IBIFN,"U1")),U,14)'="" IBPRV(9,1)=$P(^("U1"),U,14),IBPRV(9)=1
"RTN","IBCEU",104,0)
 ;
"RTN","IBCEU",105,0)
 S IBID=4+$$COBN^IBCEF(IBIFN),IBWNR=$$WNRBILL^IBEFUNC(IBIFN)
"RTN","IBCEU",106,0)
 F IBZ=1:1:$S(IBTYP="ALL":99,1:$L(IBTYP,",")) S (IBCT,IB)=0,IBY=$S(IBTYP'="ALL":$P(IBTYP,",",IBZ),1:$O(^DGCR(399,+IBIFN,"PRV","B",IBY))) Q:IBY=""  F  S IB=$O(^DGCR(399,+IBIFN,"PRV","B",IBY,IB)) Q:'IB  D
"RTN","IBCEU",107,0)
 . S IBCT=IBCT+1
"RTN","IBCEU",108,0)
 . S IBD=$G(^DGCR(399,+IBIFN,"PRV",IB,0))
"RTN","IBCEU",109,0)
 . S IBPNM=$$EXPAND^IBTRE(399.0222,.02,$P(IBD,U,2))
"RTN","IBCEU",110,0)
 . I IBWNR Q:'$D(IBPRV(IBY))  S $P(IBD,U,IBID)=$P(IBPRV(IBY),U,2)
"RTN","IBCEU",111,0)
 . S IBPRV(IBY,IBCT)=IBPNM_U_$S($P(IBD,U,IBID)'="":$P(IBD,U,IBID),$P(IBPRV,U,2)'="":$P(IBPRV,U,2),1:"")_U_$P(IBD,U,2)
"RTN","IBCEU",112,0)
 . S $P(IBPRV(IBY,IBCT),U,4)=$$CRED($P(IBPRV(IBY,IBCT),U,3),IBIFN,$S($P(IBD,U,3)'=""!'$P(IBPRV(IBY,IBCT),U,3):IB,1:""))
"RTN","IBCEU",113,0)
 . F Z=1:1:3 D
"RTN","IBCEU",114,0)
 .. ;I IBZFID'="",'$$INPAT^IBCEF(IBIFN,1),$P(IBPRV(IBY,IBCT),U,2)="SLF000" S IBZFID=""
"RTN","IBCEU",115,0)
 .. ;I $S(Z=1:1,1:$D(^DGCR(399,IBIFN,"I"_Z))) S IBPRV(IBY,IBCT,Z)=$S($G(IBZFID)'="":IBZFID,$P(IBD,U,Z+4)'="":$P(IBD,U,Z+4),1:"")
"RTN","IBCEU",116,0)
 .. I $S(Z=1:1,1:$D(^DGCR(399,IBIFN,"I"_Z))) S IBPRV(IBY,IBCT,Z)=$S($P(IBD,U,Z+4)'="":$P(IBD,U,Z+4),1:"")
"RTN","IBCEU",117,0)
GETQ D NEEDPRV(IBIFN,IBTYP,.IBPRV)
"RTN","IBCEU",118,0)
 Q
"RTN","IBCEU",119,0)
 ;
"RTN","IBCEU",120,0)
NEEDPRV(IBIFN,IBTYP,IBPRV) ; Check for needed prov
"RTN","IBCEU",121,0)
 ; If needed, not entered, insert defaults for MCR only
"RTN","IBCEU",122,0)
 N IB0,IBINP,IBFT,IBMRAND,IBTOB
"RTN","IBCEU",123,0)
 S IB0=$G(^DGCR(399,+IBIFN,0))
"RTN","IBCEU",124,0)
 S IBFT=($$FT^IBCEF(IBIFN)=3),IBINP=$$INPAT^IBCEF(IBIFN,1),IBTOB=$$TOB^IBCBB(IB0)
"RTN","IBCEU",125,0)
 ; Only allow defaults for MCR
"RTN","IBCEU",126,0)
 S IBMRAND=$$WNRBILL^IBEFUNC(IBIFN) ;$$MCRONBIL^IBEFUNC(IBIFN)
"RTN","IBCEU",127,0)
 ;
"RTN","IBCEU",128,0)
 I IBTYP="ALL"!((IBTYP_",")["2,") D:IBFT
"RTN","IBCEU",129,0)
 . ; only for bill type inpt - 11X, outpt - 83X
"RTN","IBCEU",130,0)
 . Q:$S(IBINP:$E(IBTOB,1,2)'="11",1:$E(IBTOB,1,2)'="83")
"RTN","IBCEU",131,0)
 . ; UB-92 bill includes HCPCS procs - operating phys required
"RTN","IBCEU",132,0)
 . N Z
"RTN","IBCEU",133,0)
 . S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  I $P($G(^(Z,0)),U)["ICP" D  Q
"RTN","IBCEU",134,0)
 .. S IBPRV(2,"NOTOPT")=1
"RTN","IBCEU",135,0)
 .. Q:'IBMRAND
"RTN","IBCEU",136,0)
 .. I '$O(IBPRV(2,0)) S IBPRV(2,"REQ")=1,IBPRV(2,1)=$G(IBPRV(2))
"RTN","IBCEU",137,0)
 ;
"RTN","IBCEU",138,0)
 I IBTYP="ALL"!((IBTYP_",")["3,") D:'IBFT
"RTN","IBCEU",139,0)
 . ; if a HCFA 1500 bill, rendering is required
"RTN","IBCEU",140,0)
 . S IBPRV(3,"NOTOPT")=1
"RTN","IBCEU",141,0)
 . Q:'IBMRAND
"RTN","IBCEU",142,0)
 . I '$O(IBPRV(3,0)) S IBPRV(3,1)=$G(IBPRV(3)),IBPRV(3,"REQ")=1
"RTN","IBCEU",143,0)
 ;
"RTN","IBCEU",144,0)
 I IBTYP="ALL"!((IBTYP_",")["4,") D:IBFT
"RTN","IBCEU",145,0)
 . ; if a UB-92, attending required
"RTN","IBCEU",146,0)
 . S IBPRV(4,"NOTOPT")=1
"RTN","IBCEU",147,0)
 . Q:'IBMRAND
"RTN","IBCEU",148,0)
 . I '$O(IBPRV(4,0)) S IBPRV(4,1)=$G(IBPRV(4)),IBPRV(4,"REQ")=1
"RTN","IBCEU",149,0)
 Q
"RTN","IBCEU",150,0)
 ;
"RTN","IBCEU",151,0)
CKPROV(IBIFN,IBTYP,IBVAL) ; Checks if prov of type IBTYP in 'PRV' node
"RTN","IBCEU",152,0)
 ; of bill IBIFN
"RTN","IBCEU",153,0)
 ; If IBVAL = 1, skips the check for an existing provider, just looks
"RTN","IBCEU",154,0)
 ;               for existence of the function itself
"RTN","IBCEU",155,0)
 N OK,IBFT
"RTN","IBCEU",156,0)
 S OK=0,IBFT=$$FT^IBCEF(IBIFN)
"RTN","IBCEU",157,0)
 S Z=+$O(^DGCR(399,IBIFN,"PRV","B",+IBTYP,0))
"RTN","IBCEU",158,0)
 I $G(^DGCR(399,IBIFN,"PRV",Z,0))'="" D
"RTN","IBCEU",159,0)
 . ; Only outpt UB-92 can have SLF000 as prov ID with no name
"RTN","IBCEU",160,0)
 . I IBFT=3,'$$INPAT^IBCEF(IBIFN,1),$P(^DGCR(399,IBIFN,"PRV",Z,0),U,2)="",$P(^(0),U,5)="SLF000" S OK=1 Q
"RTN","IBCEU",161,0)
 . I '$G(IBVAL) Q:$P(^DGCR(399,IBIFN,"PRV",Z,0),U,2)=""
"RTN","IBCEU",162,0)
 . S OK=1
"RTN","IBCEU",163,0)
 Q OK
"RTN","IBCEU",164,0)
 ;
"RTN","IBCEU",165,0)
XFER(IBQ) ; Transfer DILIST
"RTN","IBCEU",166,0)
 ; IBQ = # of entries already found
"RTN","IBCEU",167,0)
 N Z,IBZ
"RTN","IBCEU",168,0)
 S (Z,IBZ)=0
"RTN","IBCEU",169,0)
 F  S Z=$O(^TMP("DILIST",$J,1,Z)) Q:'Z  S IBZ=IBZ+1,^TMP("IBLIST",$J,1,IBZ+IBQ)=^TMP("DILIST",$J,1,Z),^TMP("IBLIST",$J,2,IBZ+IBQ)=^TMP("DILIST",$J,2,Z) M ^TMP("IBLIST",$J,"ID",IBZ+IBQ)=^TMP("DILIST",$J,"ID",Z)
"RTN","IBCEU",170,0)
 ;
"RTN","IBCEU",171,0)
 I $D(^TMP("DILIST",$J,0)) S ^TMP("IBLIST",$J,0)=^TMP("DILIST",$J,0)
"RTN","IBCEU",172,0)
 S $P(^TMP("IBLIST",$J,0),U)=IBQ+IBZ
"RTN","IBCEU",173,0)
 Q
"RTN","IBCEU",174,0)
 ;
"RTN","IBCEU",175,0)
DATE(X) ; Convert date X in YYYYMMDD or YYMMDD to FM format
"RTN","IBCEU",176,0)
 ; FP = flag to indicate if past or future dates are expected
"RTN","IBCEU",177,0)
 N %DT,Y
"RTN","IBCEU",178,0)
 I $L(X)=8,$E(X,1,4)<2100,$E(X,5,6)<13,$E(X,7,8)<32 S X=$E(X,1,4)-1700_$E(X,5,8) G DTQ
"RTN","IBCEU",179,0)
 I $L(X)=6,$E(X,3,4)<13,$E(X,5,6)<32 S X=$E(X,3,4)_"/"_$E(X,5,6)_"/"_$E(X,1,2),%DT="N" D ^%DT I Y>0 S X=Y
"RTN","IBCEU",180,0)
DTQ Q X
"RTN","IBCEU",181,0)
 ;
"RTN","IBCEU",182,0)
BCLASS(IBIFN) ; Returns actual bill classif. code from ptr fld
"RTN","IBCEU",183,0)
 ;  .25 in file 399 for bill ien IBIFN
"RTN","IBCEU",184,0)
 Q $P($G(^DGCR(399.1,+$P($G(^DGCR(399,IBIFN,0)),U,25),0)),U,2)
"RTN","IBCEU",185,0)
 ;
"RTN","IBCEU",186,0)
ADMHR(IBIFN,IBDTTM) ; Extract admit hr from admit dt/tm
"RTN","IBCEU",187,0)
 ;  Default 99 if no time and bill is 11X or 18X
"RTN","IBCEU",188,0)
 N TM
"RTN","IBCEU",189,0)
 S TM=$P(IBDTTM,".",2)
"RTN","IBCEU",190,0)
 I TM="","18"[$$BCLASS(IBIFN),$P($G(^DGCR(399,IBIFN,0)),U,24)=1 S TM=99
"RTN","IBCEU",191,0)
 I TM'="",TM'=99 S TM=$E(TM_"0000",1,4)
"RTN","IBCEU",192,0)
 Q TM
"RTN","IBCEU",193,0)
 ;
"RTN","IBCEU",194,0)
OLAB(IBIFN) ; Returns 1 if bill IBIFN is outside lab
"RTN","IBCEU",195,0)
 N IBL,IBLAB
"RTN","IBCEU",196,0)
 S IBL=0
"RTN","IBCEU",197,0)
 S IBLAB=$P($G(^DGCR(399,IBIFN,"U2")),U,11)
"RTN","IBCEU",198,0)
 I IBLAB,"24"[IBLAB S IBL=1
"RTN","IBCEU",199,0)
 Q IBL
"RTN","IBCEU",200,0)
 ;
"RTN","IBCEU",201,0)
PSRV(IBIFN) ; Returns 1 if bill IBIFN has any purch services
"RTN","IBCEU",202,0)
 N IBZ,IBXDATA,IBXSAVE,Z
"RTN","IBCEU",203,0)
 S IBZ=0
"RTN","IBCEU",204,0)
 D F^IBCEF("N-HCFA 1500 PROCEDURES",,,IBIFN)
"RTN","IBCEU",205,0)
 S Z=0 F  S Z=$O(IBXSAVE("BOX24",Z)) Q:'Z  I $P(IBXSAVE("BOX24",Z),U,11) S IBZ=1 Q
"RTN","IBCEU",206,0)
 Q IBZ
"RTN","IBCEU",207,0)
 ;
"RTN","IBCEU",208,0)
SEQBILL(IBIFN) ; Returns the ien's of all bills in COB sequence for bill IBIFN
"RTN","IBCEU",209,0)
 ; Return value is "^" delimited: primary ien^secondary ien^tertiary ien
"RTN","IBCEU",210,0)
 N IBSEQ,Z
"RTN","IBCEU",211,0)
 S IBSEQ=$P($G(^DGCR(399,IBIFN,"M1")),U,5,7)
"RTN","IBCEU",212,0)
 S Z=$$COBN^IBCEF(IBIFN)
"RTN","IBCEU",213,0)
 I $P(IBSEQ,U,Z)="" S $P(IBSEQ,U,Z)=IBIFN
"RTN","IBCEU",214,0)
 Q IBSEQ
"RTN","IBCEU",215,0)
 ;
"RTN","IBCSC8H")
0^2^B22403551
"RTN","IBCSC8H",1,0)
IBCSC8H ;ALB/ARH - MCCR SCREEN 8 (BILL SPECIFIC INFO) HCFA 1500 ;4/21/92
"RTN","IBCSC8H",2,0)
 ;;2.0;INTEGRATED BILLING;**51,137,207**;21-MAR-94
"RTN","IBCSC8H",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCSC8H",4,0)
 ; HCFA 1500 screen 8
"RTN","IBCSC8H",5,0)
 ;
"RTN","IBCSC8H",6,0)
 ; MAP TO DGCRSC8H
"RTN","IBCSC8H",7,0)
 ;
"RTN","IBCSC8H",8,0)
EN D ^IBCSCU S IBSR=8,IBSR1="H",IBV1="0000000" S:IBV IBV1="1111111" F I="U","U1","UF2","UF3","U2","M","TX",0 S IB(I)=$G(^DGCR(399,IBIFN,I))
"RTN","IBCSC8H",9,0)
 N IBZ,IBPRV
"RTN","IBCSC8H",10,0)
 ;
"RTN","IBCSC8H",11,0)
 S IBPRV=""
"RTN","IBCSC8H",12,0)
 D GETPRV^IBCEU(IBIFN,"ALL",.IBPRV)
"RTN","IBCSC8H",13,0)
 K IB("PRV")
"RTN","IBCSC8H",14,0)
 S IBZ=0 F  S IBZ=$O(IBPRV(IBZ)) Q:'IBZ  I $O(IBPRV(IBZ,0))!$D(IBPRV(IBZ,"NOTOPT")) M IB("PRV",IBZ)=IBPRV(IBZ)
"RTN","IBCSC8H",15,0)
 ;
"RTN","IBCSC8H",16,0)
 D H^IBCSCU
"RTN","IBCSC8H",17,0)
 S Z=1,IBW=1 X IBWW W " Unable To Work From: " S Y=$P(IB("U"),U,16) X ^DD("DD") W $S(Y'="":Y,1:IBUN)
"RTN","IBCSC8H",18,0)
 W !?4,"Unable To Work To  : " S Y=$P(IB("U"),U,17) X ^DD("DD") W $S(Y'="":Y,1:IBUN)
"RTN","IBCSC8H",19,0)
 S Z=2,IBW=1 X IBWW W " Admitting Dx       : " S IBZ=$P(IB("U2"),U,1),IBZ=$G(^ICD9(+IBZ,0)) W $S(IBZ'="":$P(IBZ,U,1)_" - "_$P(IBZ,U,3),1:IBUN)
"RTN","IBCSC8H",20,0)
 S IBZ="",IBZ=$S($P(IB("UF3"),U,4)]"":"Pri: "_$P(IB("UF3"),U,4),1:"")_$S($P(IB("UF3"),U,5)'="":"  Sec: "_$P(IB("UF3"),U,5),1:"")_$S($P(IB("UF3"),U,6)'="":" Ter: "_$P(IB("UF3"),U,6),1:"")
"RTN","IBCSC8H",21,0)
 S:IBZ="" IBZ=IBUN
"RTN","IBCSC8H",22,0)
 W !,?4,"ICN/DCN(s)         : ",IBZ
"RTN","IBCSC8H",23,0)
 S IBZ=$$CKPROV^IBCEU(IBIFN,3)
"RTN","IBCSC8H",24,0)
 S IBZ="",IBZ=$S($P(IB("U"),U,13)]"":"Pri: "_$P(IB("U"),U,13),1:"")_$S($P(IB("U2"),U,8)'="":"  Sec: "_$P(IB("U2"),U,8),1:"")_$S($P(IB("U2"),U,9)'="":"  Ter: "_$P(IB("U2"),U,9),1:"")
"RTN","IBCSC8H",25,0)
 S:IBZ="" IBZ=IBUN
"RTN","IBCSC8H",26,0)
 W !?4,"Tx Auth. Code(s)   : ",IBZ
"RTN","IBCSC8H",27,0)
 S Z=3,IBW=1 X IBWW
"RTN","IBCSC8H",28,0)
 W " Providers          : ",$S('$O(IB("PRV",0)):IBU,1:"")
"RTN","IBCSC8H",29,0)
 I $D(IB("PRV")) D  ; at least 1 provider found
"RTN","IBCSC8H",30,0)
 . N IBQ,A,A1
"RTN","IBCSC8H",31,0)
 . S IBZ=0
"RTN","IBCSC8H",32,0)
 . F  S IBZ=$O(IB("PRV",IBZ)) Q:'IBZ  D
"RTN","IBCSC8H",33,0)
 .. S IBQ=""
"RTN","IBCSC8H",34,0)
 .. W !,?5,"- "
"RTN","IBCSC8H",35,0)
 .. S A=$$EXPAND^IBTRE(399.0222,.01,IBZ)
"RTN","IBCSC8H",36,0)
 .. I $P($G(IB("PRV",IBZ,1)),U,4)'="" S A1=" ("_$E($P(IB("PRV",IBZ,1),U,4),1,3)_")",A=$E(A,1,16-$L(A1))_A1
"RTN","IBCSC8H",37,0)
 .. W $E(A_$J("",16),1,16),": "
"RTN","IBCSC8H",38,0)
 .. I '$P($G(IB("PRV",IBZ,1)),U,3),$P($G(IB("PRV",IBZ,1)),U)="" W IBU Q
"RTN","IBCSC8H",39,0)
 .. I $P($G(IB("PRV",IBZ,1)),U)'="" W:'$G(IB("PRV",IBZ)) $E($P(IB("PRV",IBZ,1),U)_$J("",16),1,16) W:$G(IB("PRV",IBZ)) "(OLD BOX 31 DATA) "_$P(IB("PRV",IBZ,1),U)
"RTN","IBCSC8H",40,0)
 .. I $P($G(IB("PRV",IBZ,1)),U)="",$P($G(IB("PRV",IBZ)),U)'="" W $E($P(IB("PRV",IBZ),U)_$J("",16),1,16)
"RTN","IBCSC8H",41,0)
 .. I $P($G(IB("PRV",IBZ,1)),U,3) F Z=1:1:3 D
"RTN","IBCSC8H",42,0)
 ... I Z=1,$G(IB("PRV",IBZ,1,1))="",$P($G(IB("PRV",IBZ)),U,2)'="" S IBQ=IBQ_"[P]"_$P($G(IB("PRV",IBZ)),U,2) Q
"RTN","IBCSC8H",43,0)
 ... I $G(^DGCR(399,IBIFN,"I"_Z))'="" D
"RTN","IBCSC8H",44,0)
 .... N IBID
"RTN","IBCSC8H",45,0)
 .... S IBID=$S($G(IB("PRV",IBZ,1,Z))'="":IB("PRV",IBZ,1,Z),"34"'[IBZ:"",1:"??MISSING??")
"RTN","IBCSC8H",46,0)
 .... S IBQ=IBQ_$S(IBID'="":" ["_$E("PST",Z)_"]"_IBID,1:"")
"RTN","IBCSC8H",47,0)
 .. I $L(IBQ) W $E(IBQ,1,39)
"RTN","IBCSC8H",48,0)
 ;
"RTN","IBCSC8H",49,0)
 K IB("PRV")
"RTN","IBCSC8H",50,0)
 ;
"RTN","IBCSC8H",51,0)
 S Z=4,IBW=1 X IBWW
"RTN","IBCSC8H",52,0)
 W " Non-VA Facility    : " S IBZ=$$EXPAND^IBTRE(399,232,+$P(IB("U2"),U,10))
"RTN","IBCSC8H",53,0)
 W $S(IBZ'="":IBZ,$$PSRV^IBCEU(IBIFN):IBU,1:IBUN)
"RTN","IBCSC8H",54,0)
 S Z=5,IBW=1 X IBWW
"RTN","IBCSC8H",55,0)
 W " Form Locator 19    : " S IBZ=$P($G(^DGCR(399,IBIFN,"UF31")),U,3) W $S(IBZ'="":IBZ,1:IBUN)
"RTN","IBCSC8H",56,0)
 I $P(IB("U2"),U,14)'="" W !,?4,"Homebound          : ",$$EXPAND^IBTRE(399,236,$P(IB("U2"),U,14))
"RTN","IBCSC8H",57,0)
 I $P(IB("U2"),U,15)'="" W !,?4,"Date Last Seen     : ",$$EXPAND^IBTRE(399,237,$P(IB("U2"),U,15))
"RTN","IBCSC8H",58,0)
 I $P(IB("U2"),U,16)'="" W !,?4,"Spec Prog Indicator: " S IBZ=$$EXPAND^IBTRE(399,238,$P(IB("U2"),U,16)) W $S(IBZ'="":IBZ,$$WNRBILL^IBEFUNC(IBIFN):"31",1:"")
"RTN","IBCSC8H",59,0)
 S Z=6,IBW=1 X IBWW
"RTN","IBCSC8H",60,0)
 W " Print Main Facility Box 32: ",$S($P($G(^IBE(350.9,1,0)),U,2)'=$P($G(^DG(40.8,+$P(IB(0),U,22),0)),U,7):"[DOES NOT APPLY]",$P(IB("UF2"),U,2):$$EXPAND^IBTRE(399,401,$P(IB("UF2"),U,2)),1:IBUN)
"RTN","IBCSC8H",61,0)
 W !,?4,"Force To Print?    : " S IBZ=$$EXTERNAL^DILFD(399,27,,+$P(IB("TX"),U,8)) W $S(IBZ'=""&($P(IB("TX"),U,8)'=""):IBZ,'$$TXMT^IBCEF4(IBIFN):"[DOES NOT APPLY]",1:IBZ)
"RTN","IBCSC8H",62,0)
 S Z=7,IBW=1 X IBWW
"RTN","IBCSC8H",63,0)
 W " Provider ID Maint  : (Edit Provider ID information)"
"RTN","IBCSC8H",64,0)
 G ^IBCSCP
"RTN","IBCSC8H",65,0)
Q Q
"RTN","IBCSC8H",66,0)
 ;
"RTN","IBCSC8H",67,0)
WRT1(IBCRED) ; Write credentials mismatch
"RTN","IBCSC8H",68,0)
 W !,*7,"  **Warning** Credentials differ from those found in NEW PERSON or IB NON VA",!,$J("",14),"BILLING PROVIDER file (",$S(IBCRED="":"none",1:IBCRED),")"
"RTN","IBCSC8H",69,0)
 W !,$J("",14),"Changes will print local, but only credentials on file transmit"
"RTN","IBCSC8H",70,0)
 Q
"RTN","IBCSC8H",71,0)
 ;
"RTN","IBCSC8H",72,0)
WRT2(IBSEQ,DIPA) ; Message that care unit is needed
"RTN","IBCSC8H",73,0)
 W !,"  **",$P("Primary^Secondary^Tertiary",U,IBSEQ),DIPA("T1"),$$DISP^IBCEP3($P(DIPA("CU1"),U,2),2),DIPA("T2")
"RTN","IBCSC8H",74,0)
 Q
"RTN","IBCSC8H",75,0)
 ;
"RTN","IBCSC8H",76,0)
SETT(DIPA) ; Sets DIPA("T1") and DIPA("T2") for display of care units
"RTN","IBCSC8H",77,0)
 S DIPA("T1")=" ins co requires care unit ",DIPA("T2")=" for this claim"
"RTN","IBCSC8H",78,0)
 Q
"RTN","IBCSC8H",79,0)
 ;
"RTN","IBCSC8H",80,0)
 ;IBCSC8H
"UP",399,399.0222,-1)
399^PRV
"UP",399,399.0222,0)
399.0222
"VER")
8.0^22.0
"^DD",399,399.0222,.09,0)
PRIMARY PROV ID CARE UNIT^R*P355.96'^IBA(355.96,^0;9^S DIC("S")="I $$CAREUOK^IBCEP4(DA(1),+Y,1,1)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",399,399.0222,.09,1,0)
^.1^^0
"^DD",399,399.0222,.09,3)
Enter the care unit that applies to this bill for the primary insurance co's performing provider id
"^DD",399,399.0222,.09,4)
D CAREID^IBCEP1("PERF",1,DA(1))
"^DD",399,399.0222,.09,12)
Must be a valid care unit for the ins co, care type, form type and performing prov id type
"^DD",399,399.0222,.09,12.1)
S DIC("S")="I $$CAREUOK^IBCEP4(DA(1),+Y,1,1)"
"^DD",399,399.0222,.09,21,0)
^.001^5^5^3021126^^^^
"^DD",399,399.0222,.09,21,1,0)
The primary insurance company requires a specific care unit value
"^DD",399,399.0222,.09,21,2,0)
to identify the correct id for the performing provider.  You must
"^DD",399,399.0222,.09,21,3,0)
enter a care unit value here so a valid id can be determined.
"^DD",399,399.0222,.09,21,4,0)
This care unit must be valid for the insurance co, form type, care type
"^DD",399,399.0222,.09,21,5,0)
and provider type required by the insurance co.
"^DD",399,399.0222,.09,"DT")
3021120
"^DD",399,399.0222,.1,0)
SECONDRY PROV ID CARE UNIT^R*P355.96'^IBA(355.96,^0;10^S DIC("S")="I $$CAREUOK^IBCEP4(DA(1),+Y,1,2)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",399,399.0222,.1,1,0)
^.1^^0
"^DD",399,399.0222,.1,3)
Enter the care unit that applies to this bill for the secondary insurance co's performing provider id
"^DD",399,399.0222,.1,4)
D CAREID^IBCEP1("PERF",2,DA(1))
"^DD",399,399.0222,.1,12)
Must be a valid care unit for the ins co, care type, form type and performing prov id type
"^DD",399,399.0222,.1,12.1)
S DIC("S")="I $$CAREUOK^IBCEP4(DA(1),+Y,1,2)"
"^DD",399,399.0222,.1,21,0)
^.001^4^4^3030109^^^^
"^DD",399,399.0222,.1,21,1,0)
If the secondary insurance company requires a specific care unit
"^DD",399,399.0222,.1,21,2,0)
specification to identify the correct id for the performing provider, this
"^DD",399,399.0222,.1,21,3,0)
is the exact data value related to this claim that will allow the system
"^DD",399,399.0222,.1,21,4,0)
to perform this match.
"^DD",399,399.0222,.1,"DT")
3030121
"^DD",399,399.0222,.11,0)
TERTIARY PROV ID CARE UNIT^R*P355.96'^IBA(355.96,^0;11^S DIC("S")="I $$CAREUOK^IBCEP4(DA(1),+Y,1,3)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",399,399.0222,.11,1,0)
^.1^^0
"^DD",399,399.0222,.11,3)
Enter the care unit that applies to this bill for the tertiary insurance's performing provider id
"^DD",399,399.0222,.11,4)
D CAREID^IBCEP1("PERF",3,DA(1))
"^DD",399,399.0222,.11,12)
Must be a valid care unit for the ins co, care type, form type and performing prov id type
"^DD",399,399.0222,.11,12.1)
S DIC("S")="I $$CAREUOK^IBCEP4(DA(1),+Y,1,3)"
"^DD",399,399.0222,.11,21,0)
^.001^4^4^3010507^^^^
"^DD",399,399.0222,.11,21,1,0)
If the tertiary insurance company requires a specific care unit
"^DD",399,399.0222,.11,21,2,0)
specification to identify the correct id for the performing provider, this
"^DD",399,399.0222,.11,21,3,0)
is the exact data value related to this claim that will allow the system
"^DD",399,399.0222,.11,21,4,0)
to perform this match.
"^DD",399,399.0222,.11,"DT")
3021120
**END**
**END**
