Released IB*2*185 SEQ #200
Extracted from mail message
**KIDS**:IB*2.0*185^

**INSTALL NAME**
IB*2.0*185
"BLD",4418,0)
IB*2.0*185^INTEGRATED BILLING^0^3030311^y
"BLD",4418,1,0)
^^1^1^3030205^^^^
"BLD",4418,1,1,0)
REASONS NOT BILLABLE/FOLLOW-UP/VETS WITH UNVERIFIED ELIG. REPORTS
"BLD",4418,4,0)
^9.64PA^^
"BLD",4418,"ABPKG")
n
"BLD",4418,"KRN",0)
^9.67PA^8989.52^19
"BLD",4418,"KRN",.4,0)
.4
"BLD",4418,"KRN",.401,0)
.401
"BLD",4418,"KRN",.402,0)
.402
"BLD",4418,"KRN",.403,0)
.403
"BLD",4418,"KRN",.5,0)
.5
"BLD",4418,"KRN",.84,0)
.84
"BLD",4418,"KRN",3.6,0)
3.6
"BLD",4418,"KRN",3.8,0)
3.8
"BLD",4418,"KRN",9.2,0)
9.2
"BLD",4418,"KRN",9.8,0)
9.8
"BLD",4418,"KRN",9.8,"NM",0)
^9.68A^7^5
"BLD",4418,"KRN",9.8,"NM",3,0)
IBJDB2^^0^B16375763
"BLD",4418,"KRN",9.8,"NM",4,0)
IBJDB21^^0^B47981210
"BLD",4418,"KRN",9.8,"NM",5,0)
IBJDF5^^0^B27594520
"BLD",4418,"KRN",9.8,"NM",6,0)
IBJDF51^^0^B57319061
"BLD",4418,"KRN",9.8,"NM",7,0)
IBJDF53^^0^B23184217
"BLD",4418,"KRN",9.8,"NM","B","IBJDB2",3)

"BLD",4418,"KRN",9.8,"NM","B","IBJDB21",4)

"BLD",4418,"KRN",9.8,"NM","B","IBJDF5",5)

"BLD",4418,"KRN",9.8,"NM","B","IBJDF51",6)

"BLD",4418,"KRN",9.8,"NM","B","IBJDF53",7)

"BLD",4418,"KRN",19,0)
19
"BLD",4418,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",4418,"KRN",19,"NM",1,0)
IBJD INTAKE UNV ELIG^^0
"BLD",4418,"KRN",19,"NM","B","IBJD INTAKE UNV ELIG",1)

"BLD",4418,"KRN",19.1,0)
19.1
"BLD",4418,"KRN",101,0)
101
"BLD",4418,"KRN",409.61,0)
409.61
"BLD",4418,"KRN",771,0)
771
"BLD",4418,"KRN",870,0)
870
"BLD",4418,"KRN",8989.51,0)
8989.51
"BLD",4418,"KRN",8989.52,0)
8989.52
"BLD",4418,"KRN",8994,0)
8994
"BLD",4418,"KRN","B",.4,.4)

"BLD",4418,"KRN","B",.401,.401)

"BLD",4418,"KRN","B",.402,.402)

"BLD",4418,"KRN","B",.403,.403)

"BLD",4418,"KRN","B",.5,.5)

"BLD",4418,"KRN","B",.84,.84)

"BLD",4418,"KRN","B",3.6,3.6)

"BLD",4418,"KRN","B",3.8,3.8)

"BLD",4418,"KRN","B",9.2,9.2)

"BLD",4418,"KRN","B",9.8,9.8)

"BLD",4418,"KRN","B",19,19)

"BLD",4418,"KRN","B",19.1,19.1)

"BLD",4418,"KRN","B",101,101)

"BLD",4418,"KRN","B",409.61,409.61)

"BLD",4418,"KRN","B",771,771)

"BLD",4418,"KRN","B",870,870)

"BLD",4418,"KRN","B",8989.51,8989.51)

"BLD",4418,"KRN","B",8989.52,8989.52)

"BLD",4418,"KRN","B",8994,8994)

"BLD",4418,"QUES",0)
^9.62^^
"BLD",4418,"REQB",0)
^9.611^2^2
"BLD",4418,"REQB",1,0)
IB*2.0*123^1
"BLD",4418,"REQB",2,0)
IB*2.0*159^1
"BLD",4418,"REQB","B","IB*2.0*123",1)

"BLD",4418,"REQB","B","IB*2.0*159",2)

"KRN",19,6793,-1)
0^1
"KRN",19,6793,0)
IBJD INTAKE UNV ELIG^Veterans with Verified/Unverified Eligibility^^R^^^^^^^^INTEGRATED BILLING
"KRN",19,6793,1,0)
^19.06^3^3^3030113^^^^
"KRN",19,6793,1,1,0)
This report lists patients who have been treated at a facility, but
"KRN",19,6793,1,2,0)
whose eligibility has not been verified. This report will also list
"KRN",19,6793,1,3,0)
patients with verified eligibility for at least 2 years, if any.
"KRN",19,6793,25)
EN^IBJDI2
"KRN",19,6793,"U")
VETERANS WITH VERIFIED/UNVERIF
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^^0
"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
185^3030311
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3030311
"PKG",200,22,1,"PAH",1,1,1,0)
REASONS NOT BILLABLE/FOLLOW-UP/VETS WITH UNVERIFIED ELIG. REPORTS
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","IBJDB2")
0^3^B16375763
"RTN","IBJDB2",1,0)
IBJDB2 ;ALB/RB - REASONS NOT BILLABLE REPORT (INPUT);19-JUN-00
"RTN","IBJDB2",2,0)
 ;;2.0;INTEGRATED BILLING;**123,185**;21-MAR-94
"RTN","IBJDB2",3,0)
 ;
"RTN","IBJDB2",4,0)
 ; - Sort by division.
"RTN","IBJDB2",5,0)
 S IBSD=$$SDIV^IBJD() I IBSD["^" G ENQ
"RTN","IBJDB2",6,0)
 ;
"RTN","IBJDB2",7,0)
GDR ; - Get specific date range.
"RTN","IBJDB2",8,0)
 W !!,"Run report for (D)ATE ENTERED or (E)PISODE DATE: D// "
"RTN","IBJDB2",9,0)
 R X:DTIME G:'$T!(X["^") ENQ S X=$S(X="":"D",1:$E(X))
"RTN","IBJDB2",10,0)
 I "DdEe"'[X D HELP1 G GDR
"RTN","IBJDB2",11,0)
 S IBD=$S("Dd"[X:"DATE ENTERED",1:"EPISODE DATE") W " ",IBD
"RTN","IBJDB2",12,0)
 S DIR(0)="DA^:DT:EX",DIR("A")="   Start with "_IBD_": ",DIR("T")=DTIME
"RTN","IBJDB2",13,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDB2",14,0)
 S IBBDT=+Y K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDB2",15,0)
 S DIR(0)="DA^"_IBBDT_":DT:EX"
"RTN","IBJDB2",16,0)
 S DIR("A")="        Go to "_IBD_": ",DIR("T")=DTIME
"RTN","IBJDB2",17,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDB2",18,0)
 S IBEDT=+Y K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDB2",19,0)
 ;
"RTN","IBJDB2",20,0)
 ; - Get ALL/Specific reasons not billable.
"RTN","IBJDB2",21,0)
 D ALSP^IBJD("Reasons Not Billable^Reason Not Billable","^IBE(356.8,",.IBSRNB)
"RTN","IBJDB2",22,0)
 I IBSRNB["^" G ENQ
"RTN","IBJDB2",23,0)
 ;
"RTN","IBJDB2",24,0)
 ; - Get ALL/Specific Providers
"RTN","IBJDB2",25,0)
 D ALSP^IBJD("Providers^Provider","^VA(200,",.IBSPRV)
"RTN","IBJDB2",26,0)
 I IBSPRV["^" G ENQ
"RTN","IBJDB2",27,0)
 ;
"RTN","IBJDB2",28,0)
DS ; - Select a detailed or summary report.
"RTN","IBJDB2",29,0)
 D DS^IBJD G:IBRPT["^" ENQ
"RTN","IBJDB2",30,0)
 ;
"RTN","IBJDB2",31,0)
SEL ; - Select episode to print.
"RTN","IBJDB2",32,0)
 S IBPRT="Choose which episode to print:"
"RTN","IBJDB2",33,0)
 K IBEPS
"RTN","IBJDB2",34,0)
 S IBEPS(1)="INPATIENT"
"RTN","IBJDB2",35,0)
 S IBEPS(2)="OUTPATIENT"
"RTN","IBJDB2",36,0)
 S IBEPS(3)="PROSTHETICS"
"RTN","IBJDB2",37,0)
 S IBEPS(4)="PHARMACY"
"RTN","IBJDB2",38,0)
 S IBEPS(5)="ALL RECEIVABLES"
"RTN","IBJDB2",39,0)
 S IBSEL=$$MLTP^IBJD(IBPRT,.IBEPS,1) I 'IBSEL G ENQ
"RTN","IBJDB2",40,0)
 ;
"RTN","IBJDB2",41,0)
 ; - Get ALL/Specific Inpatient Specialties
"RTN","IBJDB2",42,0)
 I IBSEL["1" D  I IBSISP["^" G ENQ
"RTN","IBJDB2",43,0)
 . D ALSP^IBJD("Inpatient Specialties^Inpatient Specialty","^DIC(45.7,",.IBSISP)
"RTN","IBJDB2",44,0)
 ;
"RTN","IBJDB2",45,0)
 ; - Get ALL/Specific Outpatient Specialties
"RTN","IBJDB2",46,0)
 I IBSEL["2" D  I IBSOSP["^" G ENQ
"RTN","IBJDB2",47,0)
 . D ALSP^IBJD("Outpatient Specialties^Outpatient Specialty","^DIC(40.7,",.IBSOSP)
"RTN","IBJDB2",48,0)
 ;
"RTN","IBJDB2",49,0)
 I IBRPT="S" G DEV
"RTN","IBJDB2",50,0)
 ;
"RTN","IBJDB2",51,0)
RPS ; - Sort by RNB category/specialty/provider, if necessary.
"RTN","IBJDB2",52,0)
 S IBSORT="R" G:IBSEL'[1&(IBSEL'[2) EXCEL
"RTN","IBJDB2",53,0)
 W !!,"Sort report by (R)NB CATEGORY, (P)ROVIDER, or (S)PECIALTY: R// "
"RTN","IBJDB2",54,0)
 R X:DTIME G:'$T!(X["^") ENQ S X=$S(X="":"R",1:$E(X))
"RTN","IBJDB2",55,0)
 I "RrPpSs"'[X D HELP2 G RPS
"RTN","IBJDB2",56,0)
 W " ",$S("Pp"[X:"PROVIDER","Ss"[X:"SPECIALTY",1:"RNB CATEGORY")
"RTN","IBJDB2",57,0)
 S IBSORT=X
"RTN","IBJDB2",58,0)
 ;
"RTN","IBJDB2",59,0)
EXCEL ; - Determine whether to gather data for Excel report.
"RTN","IBJDB2",60,0)
 S IBEXCEL=$$EXCEL^IBJD() G ENQ:IBEXCEL="^"
"RTN","IBJDB2",61,0)
 ;
"RTN","IBJDB2",62,0)
DEV ; - Select a device.
"RTN","IBJDB2",63,0)
 I '$G(IBEXCEL) D
"RTN","IBJDB2",64,0)
 . S X=$S(IBRPT="S":80,1:132)
"RTN","IBJDB2",65,0)
 . W !!,"You will need a ",X," column printer for this report!",!
"RTN","IBJDB2",66,0)
 . W !,"Note: This report may take a while to run. You should  queue it"
"RTN","IBJDB2",67,0)
 . W !,"      to run after normal business hours.",!
"RTN","IBJDB2",68,0)
 ;
"RTN","IBJDB2",69,0)
 I $G(IBEXCEL) D EXMSG^IBJD
"RTN","IBJDB2",70,0)
 ;
"RTN","IBJDB2",71,0)
 S %ZIS="QM" D ^%ZIS G:POP ENQ
"RTN","IBJDB2",72,0)
 I $D(IO("Q")) D  G ENQ
"RTN","IBJDB2",73,0)
 .S ZTRTN="DQ^IBJDB2",ZTDESC="IB - REASONS NOT BILLABLE REPORT"
"RTN","IBJDB2",74,0)
 .F I="IB*","IBSRNB(","VAUTD","VAUTD(" S ZTSAVE(I)=""
"RTN","IBJDB2",75,0)
 .D ^%ZTLOAD
"RTN","IBJDB2",76,0)
 .I $D(ZTSK) W !!,"This job has been queued. Task number is "_ZTSK_"."
"RTN","IBJDB2",77,0)
 .E  W !!,"Unable to queue this job."
"RTN","IBJDB2",78,0)
 .K I,IO("Q"),ZTSK D HOME^%ZIS
"RTN","IBJDB2",79,0)
 ;
"RTN","IBJDB2",80,0)
 U IO
"RTN","IBJDB2",81,0)
 ;
"RTN","IBJDB2",82,0)
DQ ; - Tasked entry point.
"RTN","IBJDB2",83,0)
 ;
"RTN","IBJDB2",84,0)
 ; If called by the Extraction Module, change extract status for the 4
"RTN","IBJDB2",85,0)
 ; reports: Reasons not Billable Inpatient, Outpatient, Prosthetics and 
"RTN","IBJDB2",86,0)
 ; Pharmacy.
"RTN","IBJDB2",87,0)
 I $G(IBXTRACT) F I=25:1:36 D E^IBJDE(I,1)
"RTN","IBJDB2",88,0)
 ;
"RTN","IBJDB2",89,0)
 D ^IBJDB21 ; Compile and print report.
"RTN","IBJDB2",90,0)
 ;
"RTN","IBJDB2",91,0)
ENQ K ^TMP("IBJDB2",$J)
"RTN","IBJDB2",92,0)
 I $D(ZTQUEUED) S ZTREQ="@" G ENQ1
"RTN","IBJDB2",93,0)
 D ^%ZISC
"RTN","IBJDB2",94,0)
ENQ1 K IBBDT,IBCLK,IBD,IBEDT,IBEPD,IBEPS,IBEXCEL,IBPRT,IBRPT,IBSD,IBSEL
"RTN","IBJDB2",95,0)
 K IBSORT,IBSISP,IBSOSP,IBSPRV,IBSRNB
"RTN","IBJDB2",96,0)
 K POP,VAUTD,ZTDESC,ZTRTN,ZTSAVE,%ZIS,I,X,Y,%
"RTN","IBJDB2",97,0)
 Q
"RTN","IBJDB2",98,0)
 ;
"RTN","IBJDB2",99,0)
HELP1 ; - 'Run report by (D)ATE ENTERED...' prompt.
"RTN","IBJDB2",100,0)
 W !!?6,"Enter: '<CR>' - To enter a DATE ENTERED range for the report"
"RTN","IBJDB2",101,0)
 W !?16,"'E' - To enter a EPISODE DATE range for the report"
"RTN","IBJDB2",102,0)
 W !?16,"'^' - To quit this option"
"RTN","IBJDB2",103,0)
 Q
"RTN","IBJDB2",104,0)
 ;
"RTN","IBJDB2",105,0)
HELP2 ; - 'Sort report by (R)NB CATEGORY...' prompt.
"RTN","IBJDB2",106,0)
 W !!?6,"Enter: '<CR>' - To sort detail report by RNB category"
"RTN","IBJDB2",107,0)
 W !?16,"'P' - To sort detail report by provider"
"RTN","IBJDB2",108,0)
 W !?16,"'S' - To sort detail report by specialty"
"RTN","IBJDB2",109,0)
 W !?16,"'^' - To quit this option"
"RTN","IBJDB2",110,0)
 Q
"RTN","IBJDB21")
0^4^B47981210
"RTN","IBJDB21",1,0)
IBJDB21 ;ALB/RB - REASONS NOT BILLABLE REPORT (COMPILE) ;19-JUN-00
"RTN","IBJDB21",2,0)
 ;;2.0;INTEGRATED BILLING;**123,159,185**;21-MAR-94
"RTN","IBJDB21",3,0)
 ;
"RTN","IBJDB21",4,0)
EN ; - Entry point from IBJDB2.
"RTN","IBJDB21",5,0)
 K ^TMP("IBJDB2",$J),IB,IBE
"RTN","IBJDB21",6,0)
 I '$G(IBXTRACT) D
"RTN","IBJDB21",7,0)
 . F X=1:1:4 I IBSEL[X S IBE(X)=IBEPS(X) ; Set episodes for report.
"RTN","IBJDB21",8,0)
 ;
"RTN","IBJDB21",9,0)
 ; - Print the header line for the Excel spreadsheet
"RTN","IBJDB21",10,0)
 I $G(IBEXCEL) D PHDL
"RTN","IBJDB21",11,0)
 ;
"RTN","IBJDB21",12,0)
 ; - Compile reason not billable (RNB) data for episode.
"RTN","IBJDB21",13,0)
 S IBRNB=0 F  S IBRNB=$S(IBSRNB'="A":$O(IBSRNB(IBRNB)),1:$O(^IBE(356.8,IBRNB))) Q:'IBRNB  D
"RTN","IBJDB21",14,0)
 .S IB0=0 F  S IB0=$O(^IBT(356,"AR",IBRNB,IB0)) Q:'IB0  D
"RTN","IBJDB21",15,0)
 ..S IBN0=$G(^IBT(356,IB0,0)),IBN1=$G(^IBT(356,IB0,1)) Q:'IBN0!('IBN1)
"RTN","IBJDB21",16,0)
 ..S IBEP=+$P(IBN0,U,18) I IBSEL'[IBEP Q  ; Get episode.
"RTN","IBJDB21",17,0)
 ..S (IBRNB1,IBSORT1)=$P($G(^IBE(356.8,IBRNB,0)),U)
"RTN","IBJDB21",18,0)
 ..;
"RTN","IBJDB21",19,0)
 ..; - Get valid date entered/episode date and amount for report.
"RTN","IBJDB21",20,0)
 ..S IBEPD=+$P(IBN0,U,6)\1,IBDEN=+IBN1\1
"RTN","IBJDB21",21,0)
 ..S IBDT=$S($E(IBD)="D":IBDEN,1:IBEPD)
"RTN","IBJDB21",22,0)
 ..Q:IBDT<IBBDT!(IBDT>IBEDT)
"RTN","IBJDB21",23,0)
 ..S IBAMT=$$AMOUNT(IBEP,IB0)
"RTN","IBJDB21",24,0)
 ..;
"RTN","IBJDB21",25,0)
 ..; - Get division, if necessary.
"RTN","IBJDB21",26,0)
 ..I IBSD D  Q:'VAUTD&('$D(VAUTD(IBDIV)))
"RTN","IBJDB21",27,0)
 ...S IBDIV=$$DIV^IBJD1(IB0)
"RTN","IBJDB21",28,0)
 ..E  S IBDIV=$S($G(IBEXCEL):+$$PRIM^VASITE(),1:0)
"RTN","IBJDB21",29,0)
 ..;
"RTN","IBJDB21",30,0)
 ..; - Provider & Specialty
"RTN","IBJDB21",31,0)
 ..S (IBPRV,IBSPC)="",IBQT=0
"RTN","IBJDB21",32,0)
 ..I IBEP=1!(IBEP=2) D  I IBQT Q
"RTN","IBJDB21",33,0)
 ...S IBPRSP=$$PRVSPC(IBEP,IB0)
"RTN","IBJDB21",34,0)
 ...I IBSPRV'="A",'$D(IBSPRV(+IBPRSP)) S IBQT=1 Q
"RTN","IBJDB21",35,0)
 ...I IBEP=1,IBSISP'="A",'$D(IBSISP(+$P(IBPRSP,U,3))) S IBQT=1 Q
"RTN","IBJDB21",36,0)
 ...I IBEP=2,IBSOSP'="A",'$D(IBSOSP(+$P(IBPRSP,U,3))) S IBQT=1 Q
"RTN","IBJDB21",37,0)
 ...S IBPRV=$S($P(IBPRSP,U,2)'="":$P(IBPRSP,U,2),1:"** UNKNOWN **")
"RTN","IBJDB21",38,0)
 ...S IBSPC=$S($P(IBPRSP,U,4)'="":$P(IBPRSP,U,4),1:"** UNKNOWN **")
"RTN","IBJDB21",39,0)
 ..;
"RTN","IBJDB21",40,0)
 ..; - Get remaining data for detailed report.
"RTN","IBJDB21",41,0)
 ..S DFN=+$P(IBN0,U,2)
"RTN","IBJDB21",42,0)
 ..D DEM^VADPT S IBPT=$E(VADM(1),1,25),IBSSN=$P(VADM(2),U)
"RTN","IBJDB21",43,0)
 ..S DIC="^VA(200,",DA=+$P(IBN1,U,4),DR=".01",DIQ="IBCLK" D EN^DIQ1
"RTN","IBJDB21",44,0)
 ..S IBCLK=$E($G(IBCLK(200,DA,.01)),1,20)
"RTN","IBJDB21",45,0)
 ..;
"RTN","IBJDB21",46,0)
 ..; - Get totals for summary.
"RTN","IBJDB21",47,0)
 ..I '$D(IB(IBDIV,IBEP,IBRNB)) S IB(IBDIV,IBEP,IBRNB)="0^0"
"RTN","IBJDB21",48,0)
 ..S $P(IB(IBDIV,IBEP,IBRNB),U)=$P(IB(IBDIV,IBEP,IBRNB),U)+1
"RTN","IBJDB21",49,0)
 ..S $P(IB(IBDIV,IBEP,IBRNB),U,2)=$P(IB(IBDIV,IBEP,IBRNB),U,2)+IBAMT
"RTN","IBJDB21",50,0)
 ..I IBRPT="S" Q
"RTN","IBJDB21",51,0)
 ..;
"RTN","IBJDB21",52,0)
 ..S IBSORT1=$S(IBSORT="P":IBPRV,IBSORT="S":IBSPC,1:IBSORT1)
"RTN","IBJDB21",53,0)
 ..S:IBSORT1="" IBSORT1=" "
"RTN","IBJDB21",54,0)
 ..;
"RTN","IBJDB21",55,0)
 ..I $G(IBEXCEL) D  Q
"RTN","IBJDB21",56,0)
 ...W !,$E($P($G(^DG(40.8,IBDIV,0)),U),1,25),U
"RTN","IBJDB21",57,0)
 ...W $S(IBEP<4:$E(IBE(IBEP)),1:"H"),U,IBPT,U,IBSSN,U
"RTN","IBJDB21",58,0)
 ...W $$DT^IBJD(IBEPD,1),U,$$DT^IBJD(IBDEN,1),U
"RTN","IBJDB21",59,0)
 ...W $$DT^IBJD($P(IBN1,U,3),1),U,IBCLK,U,$E(IBRNB1,1,25),U
"RTN","IBJDB21",60,0)
 ...W $E(IBPRV,1,25),U,$E(IBSPC,1,25),U,IBAMT,U,$P(IBN1,U,8)
"RTN","IBJDB21",61,0)
 ..;
"RTN","IBJDB21",62,0)
 ..S X=IBEPD_U_IBDEN_U_$P(IBN1,U,3)_U_IBCLK_U_IBRNB1
"RTN","IBJDB21",63,0)
 ..S X=X_U_IBPRV_U_IBSPC_U_IBAMT_U_$E($P(IBN1,U,8),1,70)
"RTN","IBJDB21",64,0)
 ..S ^TMP("IBJDB2",$J,IBDIV,IBEP,IBSORT1,IBPT_"@@"_$E(IBSSN,6,10))=$$INS^IBJD1(+$P(IBN0,U,2),IBEPD)
"RTN","IBJDB21",65,0)
 ..S ^TMP("IBJDB2",$J,IBDIV,IBEP,IBSORT1,IBPT_"@@"_$E(IBSSN,6,10),+IBN0)=X
"RTN","IBJDB21",66,0)
 ;
"RTN","IBJDB21",67,0)
 I '$G(IBEXCEL) D EN^IBJDB22 ; Print report(s).
"RTN","IBJDB21",68,0)
 ;
"RTN","IBJDB21",69,0)
ENQ K ^TMP("IBJDB2")
"RTN","IBJDB21",70,0)
 K DA,DIC,DIQ,DR,IB,IB0,IBAMT,IBCLK,IBDEN,IBDIV,IBDT,IBE,IBEP,IBEPD,IBI
"RTN","IBJDB21",71,0)
 K IBN0,IBN1,IBN2,IBPRSP,IBPRV,IBPT,IBQT,IBRNB,IBRNB1,IBSORT1,IBSPC
"RTN","IBJDB21",72,0)
 K IBSSN,VADM,X1,X2
"RTN","IBJDB21",73,0)
 Q
"RTN","IBJDB21",74,0)
 ;
"RTN","IBJDB21",75,0)
AMOUNT(EPS,CLM) ; Return the Amount not billed 
"RTN","IBJDB21",76,0)
 ; Input: EPS - Episode(1=Inpatient,2=Outpatient,3=Prosthet.,4=Prescr.)
"RTN","IBJDB21",77,0)
 ;        CLM - Pointer to Claim Tracking File (#356)
"RTN","IBJDB21",78,0)
 ;Output: AMOUNT not billed
"RTN","IBJDB21",79,0)
 ;
"RTN","IBJDB21",80,0)
 N ADM,ADMDT,AMOUNT,BLBS,BLDT,CPT,CPTLST,DA,DR,DCHD,DFN,DIC,DIQ,DIV,DRG
"RTN","IBJDB21",81,0)
 N ENC,ENCDT,EPDT,PFT,PRST,PTF,RIMB,VCPT,TTCST,X
"RTN","IBJDB21",82,0)
 ;
"RTN","IBJDB21",83,0)
 S AMOUNT=0,X=$G(^IBT(356,CLM,0))
"RTN","IBJDB21",84,0)
 S ENC=+$P(X,U,4)     ; Encounter    (Pointer to #409.68)
"RTN","IBJDB21",85,0)
 S ADM=+$P(X,U,5)     ; Admission    (Pointer to #405)
"RTN","IBJDB21",86,0)
 S PRST=+$P(X,U,9)    ; Prothetics   (Pointer to #660)
"RTN","IBJDB21",87,0)
 S EPDT=$P(X,U,6)     ; Episode Date (FM format)
"RTN","IBJDB21",88,0)
 ;
"RTN","IBJDB21",89,0)
 ; - Assumes REIMBURSABLE INS. as the RATE TYPE
"RTN","IBJDB21",90,0)
 S RIMB=$O(^DGCR(399.3,"B","REIMBURSABLE INS.",0)) I 'RIMB S RIMB=8
"RTN","IBJDB21",91,0)
 ;
"RTN","IBJDB21",92,0)
 G @("AMT"_EPS)
"RTN","IBJDB21",93,0)
 ;
"RTN","IBJDB21",94,0)
AMT1 ; - Inpatient Charges
"RTN","IBJDB21",95,0)
 I 'ADM G QAMT
"RTN","IBJDB21",96,0)
 S X=$G(^DGPM(ADM,0)) G QAMT:X="" S PTF=$P(X,U,16) G QAMT:'PTF
"RTN","IBJDB21",97,0)
 S ADMDT=$P(X,U)\1,DFN=+$P(X,U,3)
"RTN","IBJDB21",98,0)
 I $P(X,U,17) S DCHD=$P($G(^DGPM(+$P(X,U,17),0)),U)\1
"RTN","IBJDB21",99,0)
 I '$G(DCHD) S DCHD=$$DT^XLFDT()
"RTN","IBJDB21",100,0)
 ;
"RTN","IBJDB21",101,0)
 K ^TMP($J,"IBCRC-PTF"),^TMP($J,"IBCRC-DIV"),^TMP($J,"IBCRC-INDT")
"RTN","IBJDB21",102,0)
 D PTF^IBCRBG(PTF) G QAMT:'$D(^TMP($J,"IBCRC-PTF"))
"RTN","IBJDB21",103,0)
 D PTFDV^IBCRBG(PTF) G QAMT:'$D(^TMP($J,"IBCRC-DIV"))
"RTN","IBJDB21",104,0)
 D BSLOS^IBCRBG(ADMDT,DCHD,1,ADM,0) G QAMT:'$D(^TMP($J,"IBCRC-INDT"))
"RTN","IBJDB21",105,0)
 ;
"RTN","IBJDB21",106,0)
 S BLDT=""
"RTN","IBJDB21",107,0)
 F  S BLDT=$O(^TMP($J,"IBCRC-INDT",BLDT)) Q:BLDT=""  D
"RTN","IBJDB21",108,0)
 .S X=^TMP($J,"IBCRC-INDT",BLDT)
"RTN","IBJDB21",109,0)
 .S BLBS=$P(X,U,2),DRG=$P(X,U,4),DIV=$P(X,U,5)
"RTN","IBJDB21",110,0)
 .;
"RTN","IBJDB21",111,0)
 .; - Tort Liable Charge (prior to 09/01/99)
"RTN","IBJDB21",112,0)
 .I BLDT<2990901 D  Q
"RTN","IBJDB21",113,0)
 ..S AMOUNT=AMOUNT+$$BICOST^IBCRCI(RIMB,1,BLDT,"INPATIENT BEDSECTION STAY",BLBS)
"RTN","IBJDB21",114,0)
 .;
"RTN","IBJDB21",115,0)
 .; - Reasonable Charges (on 09/01/99 or later)
"RTN","IBJDB21",116,0)
 .S AMOUNT=AMOUNT+$$BICOST^IBCRCI(RIMB,1,BLDT,"INPATIENT DRG",DRG,"",DIV,"",1)
"RTN","IBJDB21",117,0)
 ;
"RTN","IBJDB21",118,0)
 ; - Add the Professional Average Amount per Episode (Reason.Chg only)
"RTN","IBJDB21",119,0)
 I EPDT'<2990901 S AMOUNT=AMOUNT+$$AVG(EPDT)
"RTN","IBJDB21",120,0)
 ;
"RTN","IBJDB21",121,0)
 ; - Subtract the amount billed for this Episode
"RTN","IBJDB21",122,0)
 S AMOUNT=AMOUNT-$$CLAMT(DFN,EPDT,1)
"RTN","IBJDB21",123,0)
 ;
"RTN","IBJDB21",124,0)
 K ^TMP($J,"IBCRC-PTF"),^TMP($J,"IBCRC-DIV"),^TMP($J,"IBCRC-INDT")
"RTN","IBJDB21",125,0)
 ;
"RTN","IBJDB21",126,0)
 G QAMT
"RTN","IBJDB21",127,0)
 ;
"RTN","IBJDB21",128,0)
AMT2 ; - Outpatient Charges
"RTN","IBJDB21",129,0)
 S X=$$GETOE^SDOE(ENC),ENCDT=+$P(X,U),DFN=+$P(X,U,2),DIV=$P(X,U,11)
"RTN","IBJDB21",130,0)
 ;
"RTN","IBJDB21",131,0)
 ; - Tort Liable Charge (prior to 09/01/99)
"RTN","IBJDB21",132,0)
 I ENCDT<2990901 D  G QAMT
"RTN","IBJDB21",133,0)
 . S AMOUNT=+$$BICOST^IBCRCI(RIMB,3,ENCDT,"OUTPATIENT VISIT DATE")
"RTN","IBJDB21",134,0)
 ;
"RTN","IBJDB21",135,0)
 D GETCPT^SDOE(ENC,"CPTLST") S VCPT=0
"RTN","IBJDB21",136,0)
 F  S VCPT=$O(CPTLST(VCPT)) Q:VCPT=""  D
"RTN","IBJDB21",137,0)
 .S CPT=+CPTLST(VCPT)
"RTN","IBJDB21",138,0)
 .S AMOUNT=AMOUNT+$$BICOST^IBCRCI(RIMB,3,ENCDT,"PROCEDURE",CPT,"",DIV,"")
"RTN","IBJDB21",139,0)
 ;
"RTN","IBJDB21",140,0)
 ; - Subtract the amount billed for this Episode
"RTN","IBJDB21",141,0)
 S AMOUNT=AMOUNT-$$CLAMT(DFN,EPDT,0)
"RTN","IBJDB21",142,0)
 G QAMT
"RTN","IBJDB21",143,0)
 ;
"RTN","IBJDB21",144,0)
AMT3 ; Prosthetic Charges
"RTN","IBJDB21",145,0)
 S DIC="^RMPR(660,",DA=PRST,DR="14",DIQ="TTCST" D EN^DIQ1
"RTN","IBJDB21",146,0)
 S AMOUNT=+$G(TTCST(660,DA,14))
"RTN","IBJDB21",147,0)
 G QAMT
"RTN","IBJDB21",148,0)
 ;
"RTN","IBJDB21",149,0)
AMT4 ; - Prescription Charges 
"RTN","IBJDB21",150,0)
 ; - Tort Liable Charge & Reasonable Charge (same source)
"RTN","IBJDB21",151,0)
 S AMOUNT=+$$BICOST^IBCRCI(RIMB,3,EPDT,"PRESCRIPTION FILL")
"RTN","IBJDB21",152,0)
 ;
"RTN","IBJDB21",153,0)
QAMT I AMOUNT<0 S AMOUNT=0
"RTN","IBJDB21",154,0)
 Q AMOUNT
"RTN","IBJDB21",155,0)
 ;
"RTN","IBJDB21",156,0)
CLAMT(DFN,EPDT,PT) ; Returns the Total Amount of Claims for Patient/Episode
"RTN","IBJDB21",157,0)
 ;
"RTN","IBJDB21",158,0)
 ; Input:  DFN - Pointer to the Patient File #2
"RTN","IBJDB21",159,0)
 ;        EPDT - Episode Date
"RTN","IBJDB21",160,0)
 ;          PT - 0=Outpatient, 1=Inpatient
"RTN","IBJDB21",161,0)
 ;
"RTN","IBJDB21",162,0)
 N CLAMT,CLM,DAY,IBD,X
"RTN","IBJDB21",163,0)
 S CLAMT=0,DAY=EPDT-1,CLM=""
"RTN","IBJDB21",164,0)
 F  S CLM=$O(^DGCR(399,"C",DFN,CLM)) Q:'CLM  D
"RTN","IBJDB21",165,0)
 .S X=$G(^DGCR(399,CLM,0))
"RTN","IBJDB21",166,0)
 .I $P($P(X,U,3),".")=$P(EPDT,".") D
"RTN","IBJDB21",167,0)
 ..S IBD=$$CKBIL^IBTUBOU(CLM,PT) Q:IBD=""
"RTN","IBJDB21",168,0)
 ..I '$P(IBD,U,3) Q  ; Not authorized
"RTN","IBJDB21",169,0)
 ..S CLAMT=CLAMT+$G(^DGCR(399,CLM,"U1"))
"RTN","IBJDB21",170,0)
 ;
"RTN","IBJDB21",171,0)
QCLAMT Q CLAMT
"RTN","IBJDB21",172,0)
 ;
"RTN","IBJDB21",173,0)
AVG(EPDT) ; Returns the Average Amount of Inpatient Professional per
"RTN","IBJDB21",174,0)
 ;         Number of Episodes for the previous 12 months
"RTN","IBJDB21",175,0)
 N AVG,M,Z
"RTN","IBJDB21",176,0)
 S AVG=0,M=EPDT\100*100
"RTN","IBJDB21",177,0)
 I '$D(^IBE(356.19,M,1)) S M=$O(^IBE(356.19,M),-1) I 'M G QAVG
"RTN","IBJDB21",178,0)
 S Z=$G(^IBE(356.19,M,1)) I $P(Z,U,12) S AVG=$P(Z,U,11)/$P(Z,U,12)
"RTN","IBJDB21",179,0)
QAVG Q $J(AVG,0,2)
"RTN","IBJDB21",180,0)
 ;
"RTN","IBJDB21",181,0)
PRVSPC(EPS,CLM) ; Return the Provider and the Specialty
"RTN","IBJDB21",182,0)
 ;  Input: EPS - Episode(1 = Inpatient OR 2 = Outpatient)
"RTN","IBJDB21",183,0)
 ;         CLM - Pointer to Claim Tracking File (#356)
"RTN","IBJDB21",184,0)
 ; Output: Provider Code (Pointer to #200) ^ Provider Name ^
"RTN","IBJDB21",185,0)
 ;         Specialty Code (Pointer to #40.7 or #45.7) ^ Specialty Name
"RTN","IBJDB21",186,0)
 ;
"RTN","IBJDB21",187,0)
 N ADM,DFN,ENC,PRI,PRS,PRV,PRVLST,SPC,STP,X,VAIN,VAINDT
"RTN","IBJDB21",188,0)
 ;
"RTN","IBJDB21",189,0)
 S X=$G(^IBT(356,CLM,0))
"RTN","IBJDB21",190,0)
 S DFN=$P(X,U,2),ENC=$P(X,U,4),ADM=$P(X,U,5),PRS=$P(X,U,8)
"RTN","IBJDB21",191,0)
 ;
"RTN","IBJDB21",192,0)
 S (PRV,SPC)="^"
"RTN","IBJDB21",193,0)
 I EPS=1,ADM D  G QPS  ; Inpatient
"RTN","IBJDB21",194,0)
 .S X=$G(^DGPM(ADM,0)),VAINDT=$P(X,U)\1 I 'VAINDT Q
"RTN","IBJDB21",195,0)
 .D INP^VADPT S PRV=$G(VAIN(11)),SPC=$G(VAIN(3))
"RTN","IBJDB21",196,0)
 .S:PRV="" PRV="^" S:SPC="" SPC="^"
"RTN","IBJDB21",197,0)
 ;
"RTN","IBJDB21",198,0)
 I EPS=2,ENC D  G QPS  ; Outpatient
"RTN","IBJDB21",199,0)
 .D GETPRV^SDOE(ENC,"PRVLST")
"RTN","IBJDB21",200,0)
 .S (X,PRI)=""
"RTN","IBJDB21",201,0)
 .F  S X=$O(PRVLST(X),-1) Q:X=""!PRI  D
"RTN","IBJDB21",202,0)
 ..N IBX S PRV=+PRVLST(X)
"RTN","IBJDB21",203,0)
 ..I $P(PRVLST(X),U,4)="P" S PRI=1 ; Primary provider
"RTN","IBJDB21",204,0)
 ..I PRV S PRV=PRV_U_$P($G(^VA(200,+PRV,0)),U)
"RTN","IBJDB21",205,0)
 ..S IBX=$$GETOE^SDOE(ENC),STP=$P(IBX,U,3)
"RTN","IBJDB21",206,0)
 ..I STP'="" S SPC=STP_U_$P($G(^DIC(40.7,STP,0)),U)
"RTN","IBJDB21",207,0)
 ;
"RTN","IBJDB21",208,0)
QPS Q (PRV_U_SPC)
"RTN","IBJDB21",209,0)
 ;
"RTN","IBJDB21",210,0)
PHDL ; - Print the header line for the Excel spreadsheet
"RTN","IBJDB21",211,0)
 N X
"RTN","IBJDB21",212,0)
 S X="Division^Svc^Patient^SSN^Episode Dt^Dt Entered^Dt Lst Edit^"
"RTN","IBJDB21",213,0)
 S X=X_"Lst Edited By^RNB Cat^Provider^Specialty^Entry Amt^Comments"
"RTN","IBJDB21",214,0)
 W !,X
"RTN","IBJDB21",215,0)
 Q
"RTN","IBJDF5")
0^5^B27594520
"RTN","IBJDF5",1,0)
IBJDF5 ;ALB/RB - CHAMPVA/CHAMPUS-TRICARE FOLLOW-UP REPORT;15-APR-00
"RTN","IBJDF5",2,0)
 ;;2.0;INTEGRATED BILLING;**123,185**;21-MAR-94
"RTN","IBJDF5",3,0)
 ;
"RTN","IBJDF5",4,0)
EN ; - Option entry point.
"RTN","IBJDF5",5,0)
 ;
"RTN","IBJDF5",6,0)
 ; - Select AR categories to print.
"RTN","IBJDF5",7,0)
 S IBPRT="Choose which category of receivables to print:"
"RTN","IBJDF5",8,0)
 K IBCTG
"RTN","IBJDF5",9,0)
 S IBCTG(1)="CHAMPUS/TRICARE PATIENT"
"RTN","IBJDF5",10,0)
 S IBCTG(2)="SHARING AGREEMENTS"
"RTN","IBJDF5",11,0)
 S IBCTG(3)="CHAMPUS"
"RTN","IBJDF5",12,0)
 S IBCTG(4)="CHAMPUS THIRD PARTY"
"RTN","IBJDF5",13,0)
 S IBCTG(5)="CHAMPVA"
"RTN","IBJDF5",14,0)
 S IBCTG(6)="CHAMPVA THIRD PARTY"
"RTN","IBJDF5",15,0)
 S IBCTG(7)="ALL OF THE ABOVE"
"RTN","IBJDF5",16,0)
 S IBSEL=$$MLTP^IBJD(IBPRT,.IBCTG,1) I 'IBSEL G ENQ
"RTN","IBJDF5",17,0)
 ;
"RTN","IBJDF5",18,0)
 S IBSD=0 I IBSEL="1," G TYP
"RTN","IBJDF5",19,0)
 ;
"RTN","IBJDF5",20,0)
 ; - Sort by division, if necessary.
"RTN","IBJDF5",21,0)
 S IBSD=$$SDIV^IBJD() G:IBSD["^" ENQ G:'IBSD TYP
"RTN","IBJDF5",22,0)
 ;
"RTN","IBJDF5",23,0)
 ; - Issue prompt for division.
"RTN","IBJDF5",24,0)
 I IBSD,IBSEL[1 D
"RTN","IBJDF5",25,0)
 . W !!,"NOTE: CHAMPUS/Tricare Patient receivables will NOT be sorted"
"RTN","IBJDF5",26,0)
 . W !?6,"by division!",!,*7
"RTN","IBJDF5",27,0)
 ;
"RTN","IBJDF5",28,0)
TYP ; - Select type of receivables to print.
"RTN","IBJDF5",29,0)
 ; - Select AR categories to print.
"RTN","IBJDF5",30,0)
 S IBPRT="Choose which type of receivables to print:"
"RTN","IBJDF5",31,0)
 K IBTPR
"RTN","IBJDF5",32,0)
 S IBTPR(1)="INPATIENT"
"RTN","IBJDF5",33,0)
 S IBTPR(2)="OUTPATIENT"
"RTN","IBJDF5",34,0)
 S IBTPR(3)="PHARMACY REFILL"
"RTN","IBJDF5",35,0)
 S IBTPR(4)="ALL RECEIVABLES"
"RTN","IBJDF5",36,0)
 S IBSEL1=$$MLTP^IBJD(IBPRT,.IBTPR,1) I 'IBSEL1 G ENQ
"RTN","IBJDF5",37,0)
 ;
"RTN","IBJDF5",38,0)
 ; - Select a detailed or summary report.
"RTN","IBJDF5",39,0)
 D DS^IBJD G ENQ:IBRPT["^",DEV:IBRPT="S"
"RTN","IBJDF5",40,0)
 ;
"RTN","IBJDF5",41,0)
 ; - Determine sorting (By name or Last 4 SSN)
"RTN","IBJDF5",42,0)
 S IBSN=$$SNL^IBJD() G ENQ:IBSN="^"
"RTN","IBJDF5",43,0)
 ;
"RTN","IBJDF5",44,0)
 ; - Determine the range
"RTN","IBJDF5",45,0)
 S X=$$INTV^IBJD("PATIENT "_$S(IBSN="N":"NAME",1:"LAST 4")) G ENQ:X="^"
"RTN","IBJDF5",46,0)
 S IBSNF=$P(X,"^",1),IBSNL=$P(X,"^",2),IBSNA=$P(X,"^",3)
"RTN","IBJDF5",47,0)
 ;
"RTN","IBJDF5",48,0)
AGE ; - Determine if the active receivable must be within an age range.
"RTN","IBJDF5",49,0)
 W !!,"Include (A)LL active AR's or those within an AGE (R)ANGE: ALL// "
"RTN","IBJDF5",50,0)
 R X:DTIME G:'$T!(X["^") ENQ S:X="" X="A" S X=$E(X)
"RTN","IBJDF5",51,0)
 I "ARar"'[X S IBOFF=1 D HELP^IBJDF5H G AGE
"RTN","IBJDF5",52,0)
 W "  ",$S("Rr"[X:"RANGE",1:"ALL")
"RTN","IBJDF5",53,0)
 S IBSMN=$S("Rr"[X:"R",1:"A") G:IBSMN="A" AMT
"RTN","IBJDF5",54,0)
 ;
"RTN","IBJDF5",55,0)
 ; - Determine the active receivable age range.
"RTN","IBJDF5",56,0)
 S DIR(0)="NA^1:99999"
"RTN","IBJDF5",57,0)
 S DIR("A")="Enter the minimum age of the active receivable: "
"RTN","IBJDF5",58,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=9 D HELP^IBJDF5H"
"RTN","IBJDF5",59,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",60,0)
 S IBSMN=+Y W "   ",IBSMN," DAYS" K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDF5",61,0)
 ;
"RTN","IBJDF5",62,0)
 S DIR(0)="NA^"_IBSMN_":99999"
"RTN","IBJDF5",63,0)
 S DIR("A")="Enter the maximum age of the active receivable: "
"RTN","IBJDF5",64,0)
 S DIR("B")=IBSMN,DIR("T")=DTIME,DIR("?")="^S IBOFF=14 D HELP^IBJDF5H"
"RTN","IBJDF5",65,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",66,0)
 S IBSMX=+Y W "   ",IBSMX," DAYS" K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDF5",67,0)
 ;
"RTN","IBJDF5",68,0)
AMT ; - Print receivables with a minimum balance.
"RTN","IBJDF5",69,0)
 S DIR(0)="Y",DIR("B")="NO" W !
"RTN","IBJDF5",70,0)
 S DIR("A")="Print receivables with a minimum balance"
"RTN","IBJDF5",71,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=19 D HELP^IBJDF5H"
"RTN","IBJDF5",72,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",73,0)
 S IBSAM=+Y K DIROUT,DTOUT,DUOUT,DIRUT G:'IBSAM EXCEL
"RTN","IBJDF5",74,0)
 ;
"RTN","IBJDF5",75,0)
AMT1 ; - Determine the minimum balance amount.
"RTN","IBJDF5",76,0)
 S DIR(0)="NA^1:9999999"
"RTN","IBJDF5",77,0)
 S DIR("A")="Enter the minimum balance amount of the receivable: "
"RTN","IBJDF5",78,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=26 D HELP^IBJDF5H"
"RTN","IBJDF5",79,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",80,0)
 S IBSAM=+Y K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDF5",81,0)
 ;
"RTN","IBJDF5",82,0)
EXCEL ; - Determine whether to gather data for Excel report.
"RTN","IBJDF5",83,0)
 S IBEXCEL=$$EXCEL^IBJD() I Y S (IBEXCEL,IBSH)=1,IBSH1="M" G DEV
"RTN","IBJDF5",84,0)
 ;
"RTN","IBJDF5",85,0)
BCH ; - Determine whether to include the bill comment history.
"RTN","IBJDF5",86,0)
 S DIR(0)="Y",DIR("B")="NO" W !
"RTN","IBJDF5",87,0)
 S DIR("A")="Include the bill comment history with each receivable"
"RTN","IBJDF5",88,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=31 D HELP^IBJDF5H"
"RTN","IBJDF5",89,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",90,0)
 S IBSH=+Y K DIROUT,DTOUT,DUOUT,DIRUT G:'IBSH DEV
"RTN","IBJDF5",91,0)
 ;
"RTN","IBJDF5",92,0)
 S DIR(0)="SA^A:ALL;M:MOST RECENT"
"RTN","IBJDF5",93,0)
 S DIR("A")="Print (A)LL comments or the (M)OST RECENT comment: "
"RTN","IBJDF5",94,0)
 S DIR("B")="ALL",DIR("T")=DTIME,DIR("?")="^S IBOFF=40 D HELP^IBJDF5H"
"RTN","IBJDF5",95,0)
 D ^DIR K DIR G:$D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",96,0)
 S IBSH1=Y K DIROUT,DTOUT,DUOUT,DIRUT G:IBSH1="A" DEV
"RTN","IBJDF5",97,0)
 ;
"RTN","IBJDF5",98,0)
 S DIR(0)="NAO^1:999"
"RTN","IBJDF5",99,0)
 S DIR("A")="Minimum age of most recent bill comment (optional): "
"RTN","IBJDF5",100,0)
 S DIR("T")=DTIME,DIR("?")="^S IBOFF=47 D HELP^IBJDF5H"
"RTN","IBJDF5",101,0)
 D ^DIR K DIR G:$D(DTOUT)!$D(DUOUT)!$D(DIROUT) ENQ
"RTN","IBJDF5",102,0)
 S IBSH2=+Y W:IBSH2 " days" K DIROUT,DTOUT,DUOUT
"RTN","IBJDF5",103,0)
 ;
"RTN","IBJDF5",104,0)
DEV ; - Select a device.
"RTN","IBJDF5",105,0)
 I '$G(IBEXCEL) D
"RTN","IBJDF5",106,0)
 . S X=$S(IBRPT="S":80,1:132)
"RTN","IBJDF5",107,0)
 . W !!,"You will need a ",X," column printer for this report!",!
"RTN","IBJDF5",108,0)
 . W !,"Note: This report will search through all  active  receivables."
"RTN","IBJDF5",109,0)
 . W !,"      You should  queue it to run after normal business hours.",!
"RTN","IBJDF5",110,0)
 ;
"RTN","IBJDF5",111,0)
 I $G(IBEXCEL) D EXMSG^IBJD
"RTN","IBJDF5",112,0)
 ;
"RTN","IBJDF5",113,0)
 W ! S %ZIS="QM" D ^%ZIS G:POP ENQ
"RTN","IBJDF5",114,0)
 I $D(IO("Q")) D  G ENQ
"RTN","IBJDF5",115,0)
 .S ZTRTN="DQ^IBJDF5",ZTDESC="IB - CHAMPVA/CHAMPUS FOLLOW-UP REPORT"
"RTN","IBJDF5",116,0)
 .F I="IB*","VAUTD","VAUTD(" S ZTSAVE(I)=""
"RTN","IBJDF5",117,0)
 .D ^%ZTLOAD
"RTN","IBJDF5",118,0)
 .I $G(ZTSK) W !!,"This job has been queued. The task no. is ",ZTSK,"."
"RTN","IBJDF5",119,0)
 .E  W !!,"Unable to queue this job."
"RTN","IBJDF5",120,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBJDF5",121,0)
 ;
"RTN","IBJDF5",122,0)
 U IO
"RTN","IBJDF5",123,0)
 ;
"RTN","IBJDF5",124,0)
 ; If called by the Extraction Module, change extract status for the 6
"RTN","IBJDF5",125,0)
 ; reports: CHAMPUS/Tricare, Sharing Agreements, CHAMPUS, CHAMPUS 3rd 
"RTN","IBJDF5",126,0)
 ;          Party, CHAMPVA and CHAMPVA 3rd Party
"RTN","IBJDF5",127,0)
DQ I $G(IBXTRACT) F I=17:1:21 D E^IBJDE(I,1)
"RTN","IBJDF5",128,0)
 ;
"RTN","IBJDF5",129,0)
 D ST^IBJDF51 ;  Compile and print the report.
"RTN","IBJDF5",130,0)
 ;
"RTN","IBJDF5",131,0)
ENQ K IBSD,IBSEL,IBSEL1,IBSN,IBSNF,IBSNL,IBSNA,IBOFF,IBSH,IBSH1,IBSH2,IBSAM
"RTN","IBJDF5",132,0)
 K IBPRT,IBCTG,IBRPT,IBTPR,IBSMN,IBSMX,IBTEXT,IBI,IBEXCEL,DIROUT,DTOUT
"RTN","IBJDF5",133,0)
 K DTOUT,DIRUT,POP,VAUTD,%ZIS,ZTDESC,ZTRTN,ZTSAVE,I,X,Y
"RTN","IBJDF5",134,0)
 Q
"RTN","IBJDF51")
0^6^B57319061
"RTN","IBJDF51",1,0)
IBJDF51 ;ALB/RB - CHAMPVA/CHAMPUS-TRICARE FOLLOW-UP REPORT (COMPILE);15-APR-00
"RTN","IBJDF51",2,0)
 ;;2.0;INTEGRATED BILLING;**123,185**;21-MAR-94
"RTN","IBJDF51",3,0)
 ;
"RTN","IBJDF51",4,0)
ST ; - Tasked entry point.
"RTN","IBJDF51",5,0)
 K IB,^TMP("IBJDF5",$J) S IBQ=0
"RTN","IBJDF51",6,0)
 ;
"RTN","IBJDF51",7,0)
 ; - Set selected categories for report.
"RTN","IBJDF51",8,0)
 I IBSEL[1 S IBCAT(31)=1
"RTN","IBJDF51",9,0)
 I IBSEL[2 S IBCAT(19)=2
"RTN","IBJDF51",10,0)
 I IBSEL[3 S IBCAT(30)=3
"RTN","IBJDF51",11,0)
 I IBSEL[4 S IBCAT(32)=4
"RTN","IBJDF51",12,0)
 I IBSEL[5 S IBCAT(29)=5
"RTN","IBJDF51",13,0)
 I IBSEL[6 S IBCAT(28)=6
"RTN","IBJDF51",14,0)
 ;
"RTN","IBJDF51",15,0)
 ; Initialize the Summary Information
"RTN","IBJDF51",16,0)
 S IBCAT="" F  S IBCAT=$O(IBCAT(IBCAT)) Q:IBCAT=""  D
"RTN","IBJDF51",17,0)
 . S IBDIV=0
"RTN","IBJDF51",18,0)
 . I IBSD,IBCAT'=31 D  Q
"RTN","IBJDF51",19,0)
 . . F  S IBDIV=$O(VAUTD(IBDIV)) Q:IBDIV=""  D INIT^IBJDF53
"RTN","IBJDF51",20,0)
 . D INIT^IBJDF53
"RTN","IBJDF51",21,0)
 ;
"RTN","IBJDF51",22,0)
 ; - Print the header line for the Excel spreadsheet
"RTN","IBJDF51",23,0)
 I $G(IBEXCEL) D PHDL
"RTN","IBJDF51",24,0)
 ;
"RTN","IBJDF51",25,0)
 ; - Find data required for the report.
"RTN","IBJDF51",26,0)
 S IBA=0 F  S IBA=$O(^PRCA(430,"AC",16,IBA)) Q:'IBA  D  Q:IBQ
"RTN","IBJDF51",27,0)
 . I IBA#100=0 D  Q:IBQ
"RTN","IBJDF51",28,0)
 . . S IBQ=$$STOP^IBOUTL("CHAMPVA/CHAMPUS (Tricare) Follow-Up Report")
"RTN","IBJDF51",29,0)
 . S IBAR=$G(^PRCA(430,IBA,0)) Q:'IBAR
"RTN","IBJDF51",30,0)
 . I $P($G(^DGCR(399,IBA,0)),U,13)=7 Q  ;           Cancelled claim.
"RTN","IBJDF51",31,0)
 . S IBCAT=+$P(IBAR,U,2) Q:'$D(IBCAT(IBCAT))  ;     Invalid AR category.
"RTN","IBJDF51",32,0)
 . S IBCAT1=IBCAT(IBCAT)
"RTN","IBJDF51",33,0)
 . ;
"RTN","IBJDF51",34,0)
 . ; - Get division, if necessary.
"RTN","IBJDF51",35,0)
 . I IBCAT1=1 S IBDIV=0                       ; CHAMPVA/Tricare Patient
"RTN","IBJDF51",36,0)
 . ;
"RTN","IBJDF51",37,0)
 . I IBCAT1'=1 D                              ; Others
"RTN","IBJDF51",38,0)
 . . I 'IBSD S IBDIV=0 Q
"RTN","IBJDF51",39,0)
 . . S IBDIV=$$DIV(IBA)
"RTN","IBJDF51",40,0)
 . ;
"RTN","IBJDF51",41,0)
 . I IBSD,IBDIV,'VAUTD Q:'$D(VAUTD(IBDIV))  ; Not a selected division.
"RTN","IBJDF51",42,0)
 . ;
"RTN","IBJDF51",43,0)
 . ; - Determine whether AR has corresponding IB action or claim and
"RTN","IBJDF51",44,0)
 . ;   whether action/claim is inpatient, outpatient, or RX refill.
"RTN","IBJDF51",45,0)
 . S IBAC=$$CLMACT^IBJD(IBA,IBCAT) Q:IBAC=""!(+IBAC=3)
"RTN","IBJDF51",46,0)
 . I +IBAC=1 D
"RTN","IBJDF51",47,0)
 . . S X=$P($G(^IB($P(IBAC,U,2),0)),U,3)
"RTN","IBJDF51",48,0)
 . . S X=$P($G(^IBE(350.1,X,0)),U)
"RTN","IBJDF51",49,0)
 . . S IBTYP=$S(X["RX":3,X["OPT":2,1:1)
"RTN","IBJDF51",50,0)
 . I +IBAC'=1 D 
"RTN","IBJDF51",51,0)
 . . S IBTYP=$S($P($G(^DGCR(399,IBA,0)),U,5)>2:2,1:1)
"RTN","IBJDF51",52,0)
 . . I $D(^IBA(362.4,"C",IBA)) S IBTYP=3
"RTN","IBJDF51",53,0)
 . ;
"RTN","IBJDF51",54,0)
 . I IBSEL1'[IBTYP,IBSEL1'[4 Q
"RTN","IBJDF51",55,0)
 . ;
"RTN","IBJDF51",56,0)
 . I IBRPT="D" S IBPT=$$PAT(IBA) Q:IBPT=""  ; Get patient info.
"RTN","IBJDF51",57,0)
 . ;
"RTN","IBJDF51",58,0)
 . I '$G(IBEXCEL) D EN^IBJDF53 Q:IBRPT="S"  ; Get stats for summary.
"RTN","IBJDF51",59,0)
 . ;
"RTN","IBJDF51",60,0)
 . ; - Get insurance info.
"RTN","IBJDF51",61,0)
 . S (IBI,IBIN)=0
"RTN","IBJDF51",62,0)
 . I $D(^DGCR(399,IBA,"MP")) D  I 'IBI Q
"RTN","IBJDF51",63,0)
 . . S IBI=+$G(^DGCR(399,IBA,"MP")) I 'IBI S IBIN="*** UNKNOWN ***" Q
"RTN","IBJDF51",64,0)
 . . S IBIN=$P($G(^DIC(36,IBI,0)),U)_"@@"_IBI
"RTN","IBJDF51",65,0)
 . ;
"RTN","IBJDF51",66,0)
 . ; - Check the receivable age, if necessary.
"RTN","IBJDF51",67,0)
 . I IBSMN D  Q:IBARD<IBSMN!(IBARD>IBSMX)
"RTN","IBJDF51",68,0)
 . . S IBARD=+$$ACT^IBJDF2(IBA) S:IBARD IBARD=$$FMDIFF^XLFDT(DT,IBARD)
"RTN","IBJDF51",69,0)
 . ;
"RTN","IBJDF51",70,0)
 . ; - Check the minimum balance amount, if necessary.
"RTN","IBJDF51",71,0)
 . S IBBA=0 F X=1:1:5 S IBBA=IBBA+$P($G(^PRCA(430,IBA,7)),U,X)
"RTN","IBJDF51",72,0)
 . I IBSAM,IBBA<IBSAM Q
"RTN","IBJDF51",73,0)
 . ;
"RTN","IBJDF51",74,0)
 . ; - Get remaining AR/claim information.
"RTN","IBJDF51",75,0)
 . S IBDP=$P(IBAR,U,10),X=$$CLMACT^IBJD(IBA,IBCAT) Q:X=""
"RTN","IBJDF51",76,0)
 . S IBBU=$S(+IBAC=1:$G(^IB($P(IBAC,U,2),0)),1:$G(^DGCR(399,IBA,"U")))
"RTN","IBJDF51",77,0)
 . S IBFR=$P(IBBU,U,$S(+IBAC=1:14,1:1))
"RTN","IBJDF51",78,0)
 . S IBTO=$P(IBBU,U,$S(+IBAC=1:15,1:2))
"RTN","IBJDF51",79,0)
 . S DFN=$P(IBPT,U,5),IBSID=$$SID(DFN,IBI)
"RTN","IBJDF51",80,0)
 . S IBOI=$$OTH(DFN,IBI,IBFR),IBVA=$$VA^IBJD1(DFN)
"RTN","IBJDF51",81,0)
 . S IBBN=$P(IBAR,U),IBOR=$P(IBAR,U,3)
"RTN","IBJDF51",82,0)
 . ;
"RTN","IBJDF51",83,0)
 . ; - Set up indexes for detail report.
"RTN","IBJDF51",84,0)
 . I $G(IBEXCEL) D  Q
"RTN","IBJDF51",85,0)
 . . S IBDIV=$P($G(^DG(40.8,$S('IBDIV:+$$PRIM^VASITE(),1:IBDIV),0)),U)
"RTN","IBJDF51",86,0)
 . . ;
"RTN","IBJDF51",87,0)
 . . S IBEXCEL1=$P(IBPT,U,2)_U_IBVA_U_$P(IBPT,U,3)_U_$TR($P(IBPT,U,4),"-")
"RTN","IBJDF51",88,0)
 . . S IBEXCEL1=IBEXCEL1_U_$S(IBIN=0:"",1:$E($P(IBIN,"@@"),1,12))_U_$E(IBOI,1,12)
"RTN","IBJDF51",89,0)
 . . S IBEXCEL1=IBEXCEL1_U_$$DT^IBJD(IBDP,1)_U_$$DT^IBJD(IBFR,1)
"RTN","IBJDF51",90,0)
 . . S IBEXCEL1=IBEXCEL1_U_$$DT^IBJD(IBTO,1)_U_IBSID_U_IBBN_U_IBOR
"RTN","IBJDF51",91,0)
 . . S IBEXCEL1=IBEXCEL1_U_IBBA_U_$P($G(^PRCA(430.2,IBCAT,0)),U,2)
"RTN","IBJDF51",92,0)
 . . S IBEXCEL1=IBEXCEL1_U_$E("IOR",IBTYP)_U
"RTN","IBJDF51",93,0)
 . . I IBSH D COM  ; This will capture the Last Comment Date
"RTN","IBJDF51",94,0)
 . . S IBD=$$FMDIFF^XLFDT(DT,$S('$P(IBEXCEL1,U,16):IBDP,1:$G(DAT)))
"RTN","IBJDF51",95,0)
 . . S IBEXCEL1=IBEXCEL1_U_IBD_U_$E(IBDIV,1,12) W !,IBEXCEL1 K IBD,IBEXCEL1
"RTN","IBJDF51",96,0)
 . ;
"RTN","IBJDF51",97,0)
 . S IBKEY=$P(IBPT,U)_"@@"_$S($G(IBPT):IBDP,1:IBFR_"/"_IBTO)
"RTN","IBJDF51",98,0)
 . F X=IBTYP,4 I IBSEL1[X D
"RTN","IBJDF51",99,0)
 . . I '($D(^TMP("IBJDF5",$J,IBDIV,IBCAT,X,IBIN,IBKEY))#10) D
"RTN","IBJDF51",100,0)
 . . . S ^TMP("IBJDF5",$J,IBDIV,IBCAT,X,IBIN,IBKEY)=$P(IBPT,U,2)_" "_IBVA_U_$P(IBPT,U,3,4)_U_IBOI
"RTN","IBJDF51",101,0)
 . . S ^TMP("IBJDF5",$J,IBDIV,IBCAT,X,IBIN,IBKEY,IBBN)=IBDP_U_IBFR_U_IBTO_U_IBOR_U_IBBA_U_IBSID
"RTN","IBJDF51",102,0)
 . . I IBSH D COM
"RTN","IBJDF51",103,0)
 ;
"RTN","IBJDF51",104,0)
 I 'IBQ,'$G(IBEXCEL) D EN^IBJDF52 ; Print the report.
"RTN","IBJDF51",105,0)
 ;
"RTN","IBJDF51",106,0)
ENQ K ^TMP("IBJDF5",$J)
"RTN","IBJDF51",107,0)
 I $D(ZTQUEUED) S ZTREQ="@" G ENQ1
"RTN","IBJDF51",108,0)
 ;
"RTN","IBJDF51",109,0)
 D ^%ZISC
"RTN","IBJDF51",110,0)
ENQ1 K IB,IBA,IBA1,IBAR,IBARD,IBBU,IBC,IBCAT,IBCAT1,IBDIV,IBD,IBI,IBQ,IBPT
"RTN","IBJDF51",111,0)
 K IBDP,IBKEY,IBVA,IBAC,IBBA,IBBN,IBFR,IBIN,IBOI,IBOR,IBSID,IBTO,IBTYP
"RTN","IBJDF51",112,0)
 K COM,COM1,DAT,DFN,J,X,X1,X2,Y,Z D KVA^VADPT
"RTN","IBJDF51",113,0)
 Q
"RTN","IBJDF51",114,0)
 ;
"RTN","IBJDF51",115,0)
PAT(IBDA) ; - Find the claim patient and decide to include the claim.
"RTN","IBJDF51",116,0)
 ;    Input: IBDA=Pointer to the claim/AR in file #399/#430 plus all
"RTN","IBJDF51",117,0)
 ;             variable input in IBS*
"RTN","IBJDF51",118,0)
 ;   Output: Y=Sort key (name or last 4)_@@_patient IEN to file #2 
"RTN","IBJDF51",119,0)
 ;             ^ Patient name ^ Age ^ SSN ^ Patient IEN to file #2
"RTN","IBJDF51",120,0)
 N AGE,ALL,ARZ,DA,DBTR,DFN,DIC,DIQ,DOB,DR,END,IBZ,INI,KEY,NAME,RCZ,SSN
"RTN","IBJDF51",121,0)
 N VADM,Y,Z
"RTN","IBJDF51",122,0)
 ;
"RTN","IBJDF51",123,0)
 S Y="" G:'$G(IBDA) PATQ
"RTN","IBJDF51",124,0)
 S DFN=0,(NAME,AGE,SSN)="",ARZ=$G(^PRCA(430,IBDA,0))
"RTN","IBJDF51",125,0)
 ;
"RTN","IBJDF51",126,0)
 ; - Look for Patient (Corresponding Claim in IB)
"RTN","IBJDF51",127,0)
 I $D(^DGCR(399,IBDA,0)) D  I 'DFN S Y="" G PATQ
"RTN","IBJDF51",128,0)
 . S IBZ=^DGCR(399,IBDA,0),DFN=+$P(IBZ,"^",2)
"RTN","IBJDF51",129,0)
 . D DEM^VADPT S NAME=VADM(1),SSN=$P(VADM(2),"^",2),AGE=VADM(4)
"RTN","IBJDF51",130,0)
 ;
"RTN","IBJDF51",131,0)
 ; - Look for Debtor (No corresponding Claim in IB)
"RTN","IBJDF51",132,0)
 I '$D(^DGCR(399,IBDA,0)) D  I 'DFN S Y="" G PATQ
"RTN","IBJDF51",133,0)
 . S DBTR=+$P(ARZ,"^",9) I 'DBTR Q
"RTN","IBJDF51",134,0)
 . S RCZ=$G(^RCD(340,DBTR,0)),DFN=+RCZ
"RTN","IBJDF51",135,0)
 . I $P(RCZ,"^")["DPT" D
"RTN","IBJDF51",136,0)
 . . D DEM^VADPT S NAME=VADM(1),SSN=$P(VADM(2),"^",2),AGE=VADM(4)
"RTN","IBJDF51",137,0)
 . I $P(RCZ,"^")'["DPT" D
"RTN","IBJDF51",138,0)
 . . S DIC="^PRCA(430,",DA=IBDA,DR=9,DIQ="DEB" D EN^DIQ1
"RTN","IBJDF51",139,0)
 . . S NAME=$G(DEB(430,DA,9)),KEY=NAME
"RTN","IBJDF51",140,0)
 . . S DIC="^RCD(340,",DA=DBTR,DR=110,DIQ="DEB" D EN^DIQ1
"RTN","IBJDF51",141,0)
 . . S SSN=$G(DEB(340,DA,110))
"RTN","IBJDF51",142,0)
 . . I SSN S SSN=$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)
"RTN","IBJDF51",143,0)
 ;
"RTN","IBJDF51",144,0)
 S KEY=$S(IBSN="N":NAME,1:+$P(SSN,"-",3))
"RTN","IBJDF51",145,0)
 S INI=IBSNF,END=IBSNL,ALL=IBSNA
"RTN","IBJDF51",146,0)
 I (INI'="@"&('DFN)) S Y="" G PATQ
"RTN","IBJDF51",147,0)
 I ALL="ALL"&('DFN)!(ALL="NULL"&(DFN)) S Y="" G PATQ
"RTN","IBJDF51",148,0)
 I INI="@",END="zzzzz" G PATC
"RTN","IBJDF51",149,0)
 I INI]KEY!(KEY]END) S Y="" G PATQ
"RTN","IBJDF51",150,0)
 ;
"RTN","IBJDF51",151,0)
PATC ; - Find all patient data.
"RTN","IBJDF51",152,0)
 S Y=KEY_"@@"_DFN_U_$E(NAME,1,25)_U_AGE_U_SSN_"^"_DFN
"RTN","IBJDF51",153,0)
PATQ Q Y
"RTN","IBJDF51",154,0)
 ;
"RTN","IBJDF51",155,0)
DIV(CLM) ;Find the default division of the bill. 
"RTN","IBJDF51",156,0)
 S DIV=$P($G(^DGCR(399,CLM,0)),"^",22)
"RTN","IBJDF51",157,0)
QDIV S:'DIV DIV=$$PRIM^VASITE() S:DIV'>0 DIV=0
"RTN","IBJDF51",158,0)
 Q DIV
"RTN","IBJDF51",159,0)
SID(DFN,INS) ; - Find the subscriber ID for a bill (if any).
"RTN","IBJDF51",160,0)
 ;   Input: DFN=Pointer to the patient in file #2
"RTN","IBJDF51",161,0)
 ;          INS=Pointer to the patient's primary carrier in file #36
"RTN","IBJDF51",162,0)
 ;  Output: Subscriber ID no. or null
"RTN","IBJDF51",163,0)
 N X,Y,Z S Y="" G:'$G(DFN)!('$G(INS)) SIDQ
"RTN","IBJDF51",164,0)
 S Z=0 F  S Z=$O(^DPT(DFN,.312,Z)) Q:'Z  S X=$G(^(Z,0)) D  Q:Y]""
"RTN","IBJDF51",165,0)
 .I +X=INS S Y=$E($P(X,U,2),1,16)
"RTN","IBJDF51",166,0)
 ;
"RTN","IBJDF51",167,0)
SIDQ Q Y
"RTN","IBJDF51",168,0)
 ;
"RTN","IBJDF51",169,0)
PHDL ; - Print the header line for the Excel spreadsheet
"RTN","IBJDF51",170,0)
 N X
"RTN","IBJDF51",171,0)
 S X="Patient^VA Empl.?^Age^SSN^Prim.Ins.Carrier^Other Ins.Carrier^"
"RTN","IBJDF51",172,0)
 S X=X_"Dt Bill prep.^Bill From Dt^Bill To Dt^Subsc.ID^Bill #^"
"RTN","IBJDF51",173,0)
 S X=X_"Orig.Amt^Curr.Bal.^Cat.^Bill Type^Lst Comm.Dt^Days Lst Comm.^"
"RTN","IBJDF51",174,0)
 S X=X_"Division"
"RTN","IBJDF51",175,0)
 W !,X
"RTN","IBJDF51",176,0)
 Q
"RTN","IBJDF51",177,0)
 ;
"RTN","IBJDF51",178,0)
OTH(DFN,INS,DS) ; - Find a patient's other valid insurance carrier (if any).
"RTN","IBJDF51",179,0)
 ;   Input: DFN=Pointer to the patient in file #2
"RTN","IBJDF51",180,0)
 ;          INS=Pointer to the patient's primary carrier in file #36
"RTN","IBJDF51",181,0)
 ;           DS=Date of service for validity check
"RTN","IBJDF51",182,0)
 ;  Output: Valid insurance carrier (first 15 chars.) or null
"RTN","IBJDF51",183,0)
 N X,X1,Y,Z S Y="" G:'$G(DFN)!('$G(INS))!('$G(DS)) OTHQ
"RTN","IBJDF51",184,0)
 S Z=0 F  S Z=$O(^DPT(DFN,.312,Z)) Q:'Z  S X=$G(^(Z,0)) D:X  Q:Y]""
"RTN","IBJDF51",185,0)
 .I +X=INS Q
"RTN","IBJDF51",186,0)
 .S X1=$G(^DIC(36,+X,0)) Q:X1=""
"RTN","IBJDF51",187,0)
 .I $P(X1,U,2)'="N",$$CHK^IBCNS1(X,DS) S Y=$E($P(X1,U),1,15)
"RTN","IBJDF51",188,0)
 ;
"RTN","IBJDF51",189,0)
OTHQ Q Y
"RTN","IBJDF51",190,0)
 ;
"RTN","IBJDF51",191,0)
COM ; - Get bill comments.
"RTN","IBJDF51",192,0)
 S DAT=0,IBA1=$S(IBSH1="M":9999999,1:0)
"RTN","IBJDF51",193,0)
 F  S IBA1=$S(IBSH1="M":$O(^PRCA(433,"C",IBA,IBA1),-1),1:$O(^PRCA(433,"C",IBA,IBA1))) Q:'IBA1  D  I IBSH1="M",DAT Q
"RTN","IBJDF51",194,0)
 .S IBC=$G(^PRCA(433,IBA1,1)) Q:'IBC
"RTN","IBJDF51",195,0)
 .I $G(IBSH2),$$FMDIFF^XLFDT(DT,+IBC)<IBSH2 Q  ; Comment age not minimum.
"RTN","IBJDF51",196,0)
 .I $P(IBC,U,2)'=35,$P(IBC,U,2)'=45 Q  ;   Not decrease/comment transact.
"RTN","IBJDF51",197,0)
 .S DAT=$S(IBC:+IBC\1,1:+$P(IBC,U,9)\1)
"RTN","IBJDF51",198,0)
 .I $G(IBEXCEL),IBSH1="M" S IBEXCEL1=IBEXCEL1_$$DT^IBJD(DAT,1) Q
"RTN","IBJDF51",199,0)
 .;
"RTN","IBJDF51",200,0)
 .; - Append brief and transaction comments.
"RTN","IBJDF51",201,0)
 .K COM,COM1 S COM(0)=DAT,X1=0
"RTN","IBJDF51",202,0)
 .S COM1(1)=$P($G(^PRCA(433,IBA1,5)),U,2)
"RTN","IBJDF51",203,0)
 .S COM1(2)=$E($P($G(^PRCA(433,IBA1,8)),U,6),1,70)
"RTN","IBJDF51",204,0)
 .S COM(1)=COM1(1)_$S(COM1(1)]""&(COM1(2)]""):"|",1:"")_COM1(2)
"RTN","IBJDF51",205,0)
 .I COM(1)]"" S COM(1)="**"_COM(1)_"**",X1=1
"RTN","IBJDF51",206,0)
 .;
"RTN","IBJDF51",207,0)
 .; - Get main comments.
"RTN","IBJDF51",208,0)
 .S X2=0 F  S X2=$O(^PRCA(433,IBA1,7,X2)) Q:'X2  S COM($S(X1:X2+1,1:X2))=^(X2,0)
"RTN","IBJDF51",209,0)
 .;
"RTN","IBJDF51",210,0)
 .S X1="" F  S X1=$O(COM(X1)) Q:X1=""  D
"RTN","IBJDF51",211,0)
 ..S ^TMP("IBJDF5",$J,IBDIV,IBCAT,X,IBIN,IBKEY,IBBN,IBA1,X1)=COM(X1)
"RTN","IBJDF51",212,0)
 ;
"RTN","IBJDF51",213,0)
 Q
"RTN","IBJDF53")
0^7^B23184217
"RTN","IBJDF53",1,0)
IBJDF53 ;ALB/RB - CHAMPVA/CHAMPUS (TRICARE) FOLLOW-UP REPORT (SUMMARY);15-APR-00
"RTN","IBJDF53",2,0)
 ;;2.0;INTEGRATED BILLING;**123,185**;21-MAR-94
"RTN","IBJDF53",3,0)
 ;
"RTN","IBJDF53",4,0)
INIT ; - Initialize counters, if necessary.
"RTN","IBJDF53",5,0)
 ;   Pre-set variables  IBCAT, IBDIV, IBSEL1 required.
"RTN","IBJDF53",6,0)
 N I,IB0
"RTN","IBJDF53",7,0)
 I '$D(IB(IBDIV,IBCAT)) D
"RTN","IBJDF53",8,0)
 . F IB0=1:1:4 I IBSEL1[IB0 F I=1:1:8 S IB(IBDIV,IBCAT,IB0,I)=0
"RTN","IBJDF53",9,0)
 ;
"RTN","IBJDF53",10,0)
 Q
"RTN","IBJDF53",11,0)
 ;
"RTN","IBJDF53",12,0)
EN ; - Compile entry point from IBJDF51.
"RTN","IBJDF53",13,0)
 ;   Pre-set variables IB(, IBA, IBCAT, IBDIV, IBSEL1, IBTYP required.
"RTN","IBJDF53",14,0)
 N I,IB0,IBAGE,IBARD,IBOUT
"RTN","IBJDF53",15,0)
 ;
"RTN","IBJDF53",16,0)
 ; - Add totals for summary.
"RTN","IBJDF53",17,0)
 S IBARD=$$ACT^IBJDF2(IBA) G:'IBARD ENQ ; No activation date.
"RTN","IBJDF53",18,0)
 S IBOUT=0 F I=1:1:5 S IBOUT=IBOUT+$P($G(^PRCA(430,IBA,7)),U,I)
"RTN","IBJDF53",19,0)
 S IBAGE=$$FMDIFF^XLFDT(DT,IBARD),IB0=$$CAT(IBAGE)
"RTN","IBJDF53",20,0)
 F I=IBTYP,4 I IBSEL1[I D
"RTN","IBJDF53",21,0)
 . S $P(IB(IBDIV,IBCAT,I,IB0),U)=+IB(IBDIV,IBCAT,I,IB0)+1
"RTN","IBJDF53",22,0)
 . S $P(IB(IBDIV,IBCAT,I,IB0),U,2)=$P(IB(IBDIV,IBCAT,I,IB0),U,2)+IBOUT
"RTN","IBJDF53",23,0)
 ;
"RTN","IBJDF53",24,0)
ENQ Q
"RTN","IBJDF53",25,0)
 ;
"RTN","IBJDF53",26,0)
PRT ; - Print entry point from IBJDF52.
"RTN","IBJDF53",27,0)
 N IBDIV
"RTN","IBJDF53",28,0)
 ;
"RTN","IBJDF53",29,0)
 ; - Extract summary data.
"RTN","IBJDF53",30,0)
 I $G(IBXTRACT) D EXTMO(.IB) G ENQ1
"RTN","IBJDF53",31,0)
 ;
"RTN","IBJDF53",32,0)
 S IBDIV=""
"RTN","IBJDF53",33,0)
 F  S IBDIV=$O(IB(IBDIV)) Q:IBDIV=""  D
"RTN","IBJDF53",34,0)
 . S IBCAT=0
"RTN","IBJDF53",35,0)
 . F  S IBCAT=$O(IB(IBDIV,IBCAT)) Q:'IBCAT  D SUM(.IBCAT) Q:IBQ
"RTN","IBJDF53",36,0)
 ;
"RTN","IBJDF53",37,0)
ENQ1 Q
"RTN","IBJDF53",38,0)
 ;
"RTN","IBJDF53",39,0)
EXTMO(IBS) ; Extract/transmit data to DM Extract Module
"RTN","IBJDF53",40,0)
 ; IBS - Array containing the summary information
"RTN","IBJDF53",41,0)
 ;
"RTN","IBJDF53",42,0)
 N IB,IBCT,IBI,IBJ,IBR,IBSQ,IBTP,IBZ
"RTN","IBJDF53",43,0)
 ;
"RTN","IBJDF53",44,0)
 F IBI=1:1:6 F IBJ=1:1:16 S IB(IBI,IBJ)=$S(IBJ#2:0,1:"0.00")
"RTN","IBJDF53",45,0)
 ;
"RTN","IBJDF53",46,0)
 S IBCT=""
"RTN","IBJDF53",47,0)
 F  S IBCT=$O(IBS(0,IBCT)) Q:IBCT=""  D
"RTN","IBJDF53",48,0)
 . S IBTP=0
"RTN","IBJDF53",49,0)
 . I IBCT=31 S IBTP=1      ;  CHAMPUS/Tricare Patient
"RTN","IBJDF53",50,0)
 . I IBCT=19 Q             ;  Sharing Agreements (NOT EXTRACTED)
"RTN","IBJDF53",51,0)
 . I IBCT=30 S IBTP=2      ;  CHAMPUS
"RTN","IBJDF53",52,0)
 . I IBCT=32 S IBTP=3      ;  CHAMPUS THIRD PARTY
"RTN","IBJDF53",53,0)
 . I IBCT=28 S IBTP=4      ;  CHAMPVA
"RTN","IBJDF53",54,0)
 . I IBCT=29 S IBTP=5      ;  CHAMPVA THRID PARTY
"RTN","IBJDF53",55,0)
 . S IBSQ=1
"RTN","IBJDF53",56,0)
 . F IBI=1:1:7 D
"RTN","IBJDF53",57,0)
 . . S IBZ=$G(IBS(0,IBCT,4,IBI))
"RTN","IBJDF53",58,0)
 . . S IB(IBTP,IBSQ)=+IBZ
"RTN","IBJDF53",59,0)
 . . S IB(IBTP,IBSQ+1)=$FN(+$P(IBZ,"^",2),"",2)
"RTN","IBJDF53",60,0)
 . . S IB(IBTP,15)=IB(IBTP,15)+IBZ
"RTN","IBJDF53",61,0)
 . . S IB(IBTP,16)=IB(IBTP,16)+$P(IBZ,"^",2)
"RTN","IBJDF53",62,0)
 . . S IBSQ=IBSQ+2
"RTN","IBJDF53",63,0)
 . S IB(IBTP,16)=$FN(IB(IBTP,16),"",2)
"RTN","IBJDF53",64,0)
 ;
"RTN","IBJDF53",65,0)
 F IBR=17:1:21 D E^IBJDE(IBR,0)
"RTN","IBJDF53",66,0)
 Q
"RTN","IBJDF53",67,0)
 ;
"RTN","IBJDF53",68,0)
SUM(IBCAT) ; - Print summary for AR category.
"RTN","IBJDF53",69,0)
 ;  Input: IBCAT=AR category pointer to file #430.2, and pre-set
"RTN","IBJDF53",70,0)
 ;         variables IBDIV and IBRPT
"RTN","IBJDF53",71,0)
 N IBDH,IBTYP,IBTYPH,I,J
"RTN","IBJDF53",72,0)
 ;
"RTN","IBJDF53",73,0)
 S (IBFLG,IBTYP)=0 D HDR
"RTN","IBJDF53",74,0)
 F  S IBTYP=$O(IB(IBDIV,IBCAT,IBTYP)) Q:'IBTYP  D  Q:IBQ
"RTN","IBJDF53",75,0)
 . I $Y>(IOSL-16) D HDR Q:IBQ
"RTN","IBJDF53",76,0)
 . S IBTYPH=$G(IBCTG(IBCAT(IBCAT)))_" RECEIVABLES ("_$G(IBTPR(IBTYP))_")"
"RTN","IBJDF53",77,0)
 . W !!!?(80-$L(IBTYPH))\2,IBTYPH
"RTN","IBJDF53",78,0)
 . W !?(80-$L(IBTYPH)\2),$$DASH($L(IBTYPH))
"RTN","IBJDF53",79,0)
 . I IBDIV D
"RTN","IBJDF53",80,0)
 . . S IBDH="Division: "_$P($G(^DG(40.8,IBDIV,0)),U)
"RTN","IBJDF53",81,0)
 . . W !?(80-$L(IBDH)\2),IBDH
"RTN","IBJDF53",82,0)
 . W !!
"RTN","IBJDF53",83,0)
 . ;
"RTN","IBJDF53",84,0)
 . ; - Calculate totals first.
"RTN","IBJDF53",85,0)
 . F I=1:1:7 F J=1,2 S $P(IB(IBDIV,IBCAT,IBTYP,8),U,J)=$P(IB(IBDIV,IBCAT,IBTYP,8),U,J)+$P(IB(IBDIV,IBCAT,IBTYP,I),U,J)
"RTN","IBJDF53",86,0)
 . ;
"RTN","IBJDF53",87,0)
 . W "AR Category",?31,"# Receivables",?52,"Total Outstanding Balance",!
"RTN","IBJDF53",88,0)
 . W "-----------",?31,"-------------",?52,"-------------------------"
"RTN","IBJDF53",89,0)
 . I 'IB(IBDIV,IBCAT,IBTYP,8) D  D PAUSE Q
"RTN","IBJDF53",90,0)
 . . W !!,"There are no active receivables",$S(IBDIV:" for this division",1:""),"."
"RTN","IBJDF53",91,0)
 . . S IBFLG=1
"RTN","IBJDF53",92,0)
 . ;
"RTN","IBJDF53",93,0)
 . ; - Primary loop to write results.
"RTN","IBJDF53",94,0)
 . S Y=$P(IB(IBDIV,IBCAT,IBTYP,8),U,2)
"RTN","IBJDF53",95,0)
 . F I=1:1:8 S X=$P($T(CATN+I),";;",2,99) D
"RTN","IBJDF53",96,0)
 . . W:I=8 ! W !,X,?30,$J(+IB(IBDIV,IBCAT,IBTYP,I),6)
"RTN","IBJDF53",97,0)
 . . W "  (",$J(+IB(IBDIV,IBCAT,IBTYP,I)/+IB(IBDIV,IBCAT,IBTYP,8)*100,0,$S(I=8:0,1:2)),"%)"
"RTN","IBJDF53",98,0)
 . . S Z=$FN($P(IB(IBDIV,IBCAT,IBTYP,I),U,2),",",2)
"RTN","IBJDF53",99,0)
 . . W ?52,$J($S(I=1!(I=9):"$",1:"")_Z,15)
"RTN","IBJDF53",100,0)
 . . W "  (",$J($S('Y:0,1:$P(IB(IBDIV,IBCAT,IBTYP,I),U,2)/Y*100),0,$S(I=8:0,1:2)),"%)"
"RTN","IBJDF53",101,0)
 . ;
"RTN","IBJDF53",102,0)
 . D PAUSE
"RTN","IBJDF53",103,0)
 ;
"RTN","IBJDF53",104,0)
SUMQ Q
"RTN","IBJDF53",105,0)
 ;
"RTN","IBJDF53",106,0)
HDR ; - Write the summary report header.
"RTN","IBJDF53",107,0)
 N X
"RTN","IBJDF53",108,0)
 ;
"RTN","IBJDF53",109,0)
 I $E(IOST,1,2)="C-"!$G(IBPAG) W @IOF,*13
"RTN","IBJDF53",110,0)
 S IBPAG=$G(IBPAG)+1
"RTN","IBJDF53",111,0)
 W "CHAMPVA/CHAMPUS-TRICARE FOLLOW-UP SUMMARY REPORT"
"RTN","IBJDF53",112,0)
 W ?71,"Page: ",$J(IBPAG,3),!,"Run Date: ",IBRUN
"RTN","IBJDF53",113,0)
 S X=""
"RTN","IBJDF53",114,0)
 I IBRPT="D" D
"RTN","IBJDF53",115,0)
 . I IBSMN'="A" D
"RTN","IBJDF53",116,0)
 . . S X="  RECEIVABLES OVER "_IBSMN_" AND LESS THAN "_IBSMX_" DAYS OLD "
"RTN","IBJDF53",117,0)
 . I $G(IBSNA)'="ALL" D
"RTN","IBJDF53",118,0)
 . . S X=X_"/ PATIENTS FROM '"_$S(IBSNF="":"FIRST",1:IBSNF)_"' TO '"
"RTN","IBJDF53",119,0)
 . . S X=X_$S(IBSNL="zzzzz":"LAST",1:IBSNL)_"' "
"RTN","IBJDF53",120,0)
 . I $G(IBSAM) S X=X_"/ MINIMUM BALANCE: $"_$FN(IBSAM,",",2)_" "
"RTN","IBJDF53",121,0)
 S $E(X,1,2)=""
"RTN","IBJDF53",122,0)
 I X'="" F I=1:1 W !,$E(X,1,80) S X=$E(X,81,999) I X="" Q
"RTN","IBJDF53",123,0)
 ;
"RTN","IBJDF53",124,0)
 Q
"RTN","IBJDF53",125,0)
 ;
"RTN","IBJDF53",126,0)
DASH(X) ; - Return a dashed line.
"RTN","IBJDF53",127,0)
 Q $TR($J("",X)," ","=")
"RTN","IBJDF53",128,0)
 ;
"RTN","IBJDF53",129,0)
PAUSE ; - Page break.
"RTN","IBJDF53",130,0)
 I $E(IOST,1,2)'="C-" Q
"RTN","IBJDF53",131,0)
 N IBX,DIR,DIRUT,DUOUT,DTOUT,DIROUT,X,Y
"RTN","IBJDF53",132,0)
 F IBX=$Y:1:(IOSL-3) W !
"RTN","IBJDF53",133,0)
 S DIR(0)="E" D ^DIR S:$D(DIRUT)!($D(DUOUT)) IBQ=1
"RTN","IBJDF53",134,0)
 Q
"RTN","IBJDF53",135,0)
 ;
"RTN","IBJDF53",136,0)
CAT(X) ; - Determine category to place receivable.
"RTN","IBJDF53",137,0)
 Q $S($G(X)<31:1,X<61:2,X<91:3,X<121:4,X<181:5,X<366:6,1:7)
"RTN","IBJDF53",138,0)
 ;
"RTN","IBJDF53",139,0)
CATN ; - List of category names.
"RTN","IBJDF53",140,0)
 ;;Less than 30 days old
"RTN","IBJDF53",141,0)
 ;;31-60 days
"RTN","IBJDF53",142,0)
 ;;61-90 days
"RTN","IBJDF53",143,0)
 ;;91-120 days
"RTN","IBJDF53",144,0)
 ;;121-180 days
"RTN","IBJDF53",145,0)
 ;;181-365 days
"RTN","IBJDF53",146,0)
 ;;Over 365 days
"RTN","IBJDF53",147,0)
 ;;Total C/C-Tricare Receivables
"VER")
8.0^22
**END**
**END**
