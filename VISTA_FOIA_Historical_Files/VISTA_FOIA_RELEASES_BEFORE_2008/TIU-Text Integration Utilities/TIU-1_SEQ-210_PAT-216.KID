Released TIU*1*216 SEQ #210
Extracted from mail message
**KIDS**:TIU*1.0*216^

**INSTALL NAME**
TIU*1.0*216
"BLD",6749,0)
TIU*1.0*216^TEXT INTEGRATION UTILITIES^0^3060406^y
"BLD",6749,1,0)
^^1^1^3060406^
"BLD",6749,1,1,0)
Fix boilerplate "TRY" function and prompts in TIU REVIEW SCREEN MRT.
"BLD",6749,4,0)
^9.64PA^^
"BLD",6749,"ABPKG")
n
"BLD",6749,"KRN",0)
^9.67PA^8989.52^19
"BLD",6749,"KRN",.4,0)
.4
"BLD",6749,"KRN",.401,0)
.401
"BLD",6749,"KRN",.402,0)
.402
"BLD",6749,"KRN",.403,0)
.403
"BLD",6749,"KRN",.5,0)
.5
"BLD",6749,"KRN",.84,0)
.84
"BLD",6749,"KRN",3.6,0)
3.6
"BLD",6749,"KRN",3.8,0)
3.8
"BLD",6749,"KRN",9.2,0)
9.2
"BLD",6749,"KRN",9.8,0)
9.8
"BLD",6749,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6749,"KRN",9.8,"NM",1,0)
TIUEDI4^^0^54198761
"BLD",6749,"KRN",9.8,"NM",2,0)
TIURM^^0^23965891
"BLD",6749,"KRN",9.8,"NM","B","TIUEDI4",1)

"BLD",6749,"KRN",9.8,"NM","B","TIURM",2)

"BLD",6749,"KRN",19,0)
19
"BLD",6749,"KRN",19.1,0)
19.1
"BLD",6749,"KRN",101,0)
101
"BLD",6749,"KRN",409.61,0)
409.61
"BLD",6749,"KRN",771,0)
771
"BLD",6749,"KRN",870,0)
870
"BLD",6749,"KRN",8989.51,0)
8989.51
"BLD",6749,"KRN",8989.52,0)
8989.52
"BLD",6749,"KRN",8994,0)
8994
"BLD",6749,"KRN","B",.4,.4)

"BLD",6749,"KRN","B",.401,.401)

"BLD",6749,"KRN","B",.402,.402)

"BLD",6749,"KRN","B",.403,.403)

"BLD",6749,"KRN","B",.5,.5)

"BLD",6749,"KRN","B",.84,.84)

"BLD",6749,"KRN","B",3.6,3.6)

"BLD",6749,"KRN","B",3.8,3.8)

"BLD",6749,"KRN","B",9.2,9.2)

"BLD",6749,"KRN","B",9.8,9.8)

"BLD",6749,"KRN","B",19,19)

"BLD",6749,"KRN","B",19.1,19.1)

"BLD",6749,"KRN","B",101,101)

"BLD",6749,"KRN","B",409.61,409.61)

"BLD",6749,"KRN","B",771,771)

"BLD",6749,"KRN","B",870,870)

"BLD",6749,"KRN","B",8989.51,8989.51)

"BLD",6749,"KRN","B",8989.52,8989.52)

"BLD",6749,"KRN","B",8994,8994)

"BLD",6749,"QUES",0)
^9.62^^
"BLD",6749,"REQB",0)
^9.611^2^2
"BLD",6749,"REQB",1,0)
TIU*1.0*109^2
"BLD",6749,"REQB",2,0)
TIU*1.0*113^2
"BLD",6749,"REQB","B","TIU*1.0*109",1)

"BLD",6749,"REQB","B","TIU*1.0*113",2)

"MBREQ")
0
"PKG",506,-1)
1^1
"PKG",506,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",506,20,0)
^9.402P^^
"PKG",506,22,0)
^9.49I^1^1
"PKG",506,22,1,0)
1.0^2970620^2970916^3316
"PKG",506,22,1,"PAH",1,0)
216^3060406
"PKG",506,22,1,"PAH",1,1,0)
^^1^1^3060406
"PKG",506,22,1,"PAH",1,1,1,0)
Fix boilerplate "TRY" function and prompts in TIU REVIEW SCREEN MRT.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIUEDI4")
0^1^B54198761^B48842233
"RTN","TIUEDI4",1,0)
TIUEDI4 ; SLC/JER - Enter/Edit a Document ; 7-FEB-2001 08:01:51
"RTN","TIUEDI4",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,109,216**;Jun 20, 1997
"RTN","TIUEDI4",3,0)
 ;new rtn in TSC, created feb 2 from TIUEDIT
"RTN","TIUEDI4",4,0)
 ; 2/2: Moved LOADDFLT, BOIL, CANXEC, REPLACE, INSMULT to TIUEDI4
"RTN","TIUEDI4",5,0)
 ; 2/3 moved DIE, TEXTEDIT from TIUEDIT to TIUEDI4
"RTN","TIUEDI4",6,0)
 ; 3/2 moved SETTL, GETVST, ASKOK from TIUEDIT to TIUEDI4
"RTN","TIUEDI4",7,0)
 ;
"RTN","TIUEDI4",8,0)
SETTL(TIUTYP,TIUCLASS,TIUTITLE) ; Set array TIUTYP w/ title info
"RTN","TIUEDI4",9,0)
 ;  e.g. TIUTYP(1) = 1^113^CRISIS, where 113 is IFN of CRISIS title,
"RTN","TIUEDI4",10,0)
 ;          TIUTYP = 1 if gotten from TIUTITLE
"RTN","TIUEDI4",11,0)
 ;          TIUTYP = 113 if gotten from user
"RTN","TIUEDI4",12,0)
 ; Requires TIUCLASS
"RTN","TIUEDI4",13,0)
 ; Receives TIUTITLE - optional = Title DA or Title Name or DA^Name
"RTN","TIUEDI4",14,0)
 N TIUDFLT
"RTN","TIUEDI4",15,0)
 ; -- Get title from TIUTITLE if it's there: --
"RTN","TIUEDI4",16,0)
 I $G(TIUTITLE)]"",$S(+$G(NOSAVE):1,+$P(TIUTITLE,U,2):1,1:0) D  I 1
"RTN","TIUEDI4",17,0)
 . S TIUTYP=1,TIUTITLE=$P(TIUTITLE,U)
"RTN","TIUEDI4",18,0)
 . S TIUTYP(1)=1_U_$S(+$G(TIUTITLE)>0:+$G(TIUTITLE),1:+$O(^TIU(8925.1,"B",TIUTITLE,0)))
"RTN","TIUEDI4",19,0)
 . S $P(TIUTYP(1),U,3)=$$PNAME^TIULC1(+$P(TIUTYP(1),U,2))
"RTN","TIUEDI4",20,0)
 ; -- If not, ask user: --
"RTN","TIUEDI4",21,0)
 E  D
"RTN","TIUEDI4",22,0)
 . S TIUDFLT="LAST" ; use user's preferred list of docmts
"RTN","TIUEDI4",23,0)
 . D DOCSPICK^TIULA2(.TIUTYP,TIUCLASS,"1A",TIUDFLT,"","+$$CANPICK^TIULP(+Y),+$$CANENTR^TIULP(+Y)")
"RTN","TIUEDI4",24,0)
 I +$G(TIUTYP)'>0 S TIUOUT=1 Q
"RTN","TIUEDI4",25,0)
 S TIUTYP=+$P($G(TIUTYP(1)),U,2)
"RTN","TIUEDI4",26,0)
 Q
"RTN","TIUEDI4",27,0)
 ;
"RTN","TIUEDI4",28,0)
GETVST(DFN,TIUTYP,TIU,EVNTFLAG) ; Get visit, set array TIU
"RTN","TIUEDI4",29,0)
 ; -- If no eventflag & don't suppress visit, then execute
"RTN","TIUEDI4",30,0)
 ;    visit linkage method: --
"RTN","TIUEDI4",31,0)
 ; Requires DFN
"RTN","TIUEDI4",32,0)
 ; Requires simple variable TIUTYP = title DA
"RTN","TIUEDI4",33,0)
 ; Optional EVNTFLAG
"RTN","TIUEDI4",34,0)
 ; Returns array TIU
"RTN","TIUEDI4",35,0)
 N TIUVSUPP,TIULMETH
"RTN","TIUEDI4",36,0)
 S TIUVSUPP=0
"RTN","TIUEDI4",37,0)
 I '$G(EVNTFLAG) S TIUVSUPP=+$$SUPPVSIT^TIULC1(TIUTYP)
"RTN","TIUEDI4",38,0)
 ; -- execute visit linkage method for TIUTYP --
"RTN","TIUEDI4",39,0)
 I 'TIUVSUPP,'$G(EVNTFLAG) D  I 1
"RTN","TIUEDI4",40,0)
 . S TIULMETH=$$GETLMETH^TIUEDI1(TIUTYP)
"RTN","TIUEDI4",41,0)
 . I '$L(TIULMETH) D  S TIUOUT=1 Q
"RTN","TIUEDI4",42,0)
 . . W !,$C(7),"No Visit Linkage Method defined for "
"RTN","TIUEDI4",43,0)
 . . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIUEDI4",44,0)
 . ; -- TIULMETH for PN: D ENPN^TIUVSIT(.TIU,.DFN,1) --
"RTN","TIUEDI4",45,0)
 . X TIULMETH
"RTN","TIUEDI4",46,0)
 ; -- else create new historical "E" visit: --
"RTN","TIUEDI4",47,0)
 E  D EVENT^TIUSRVP1(.TIU,DFN)
"RTN","TIUEDI4",48,0)
 I $S($D(DIROUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 Q
"RTN","TIUEDI4",49,0)
 I '$D(TIU("VSTR")) D
"RTN","TIUEDI4",50,0)
 . W !,$C(7),"Patient & Visit required." H 2
"RTN","TIUEDI4",51,0)
 Q
"RTN","TIUEDI4",52,0)
 ;
"RTN","TIUEDI4",53,0)
ASKOK(TIUTYP,TIU,TIUBY,TIUASK) ; X Validation method.
"RTN","TIUEDI4",54,0)
 ; Receives and returns array TIU, simple var TIUTYP, [array TIUBY]
"RTN","TIUEDI4",55,0)
 ; Sets TIUASK = answer, = 0 for not OK or 1 for OK
"RTN","TIUEDI4",56,0)
 N TIUVMETH
"RTN","TIUEDI4",57,0)
 S TIUVMETH=$$GETVMETH^TIUEDI1(TIUTYP)
"RTN","TIUEDI4",58,0)
 I '$L(TIUVMETH) D  S TIUOUT=1 Q
"RTN","TIUEDI4",59,0)
 . W !,$C(7),"No Validation Method defined for "
"RTN","TIUEDI4",60,0)
 . W $$PNAME^TIULC1(TIUTYP),".",!,"Please contact IRM..."
"RTN","TIUEDI4",61,0)
 ; -- TIUVMETH for PN: S TIUASK=$$CHEKPN^TIULD(.TIU,.TIUBY) --
"RTN","TIUEDI4",62,0)
 X TIUVMETH
"RTN","TIUEDI4",63,0)
 ; -- If finish without a visit, then quit: --
"RTN","TIUEDI4",64,0)
 I '$D(TIU("VSTR")) D
"RTN","TIUEDI4",65,0)
 . W !,$C(7),"Patient & Visit required." H 2
"RTN","TIUEDI4",66,0)
 Q
"RTN","TIUEDI4",67,0)
 ;
"RTN","TIUEDI4",68,0)
DIE(DA,TIUQUIT,TIUCHNG) ; Invoke ^DIE
"RTN","TIUEDI4",69,0)
 N Y,DIE,DR
"RTN","TIUEDI4",70,0)
 I '$D(TIUPREF) S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUEDI4",71,0)
 L +^TIU(8925,+DA):1
"RTN","TIUEDI4",72,0)
 E  D  Q
"RTN","TIUEDI4",73,0)
 . W !!?5,$C(7),"Another user is editing this entry.",! S TIUQUIT=2
"RTN","TIUEDI4",74,0)
 . I $$READ^TIUU("FOA","Press RETURN to continue...") W ""
"RTN","TIUEDI4",75,0)
 S ^TIU(8925,"ASAVE",DUZ,DA)=""
"RTN","TIUEDI4",76,0)
 S DR=$$GETTMPL^TIUEDI1(+$P(^TIU(8925,+DA,0),U))
"RTN","TIUEDI4",77,0)
 I DR']"" W !?5,$C(7),"No Edit template defined for ",$$PNAME^TIULC1(+$P(^TIU(8925,+DA,0),U)),! S TIUQUIT=2 Q
"RTN","TIUEDI4",78,0)
 S DIE=8925 D ^DIE
"RTN","TIUEDI4",79,0)
 I $D(Y)!($D(DTOUT)) S TIUQUIT=1
"RTN","TIUEDI4",80,0)
 I +$G(TIUQUIT)>0,+$G(TIUNEW)>0 Q
"RTN","TIUEDI4",81,0)
 D:+$G(TIUQUIT) UPDTIRT^TIUDIRT(.TIU,DA),SEND^TIUALRT(DA)
"RTN","TIUEDI4",82,0)
 Q:+$G(TIUQUIT)
"RTN","TIUEDI4",83,0)
 D TEXTEDIT(DA,.TIUCHNG)
"RTN","TIUEDI4",84,0)
 I +$G(^TIU(8925,DA,0))'>0 S TIUQUIT=2 Q
"RTN","TIUEDI4",85,0)
 S DR=".05///"_$$STATUS^TIULC(DA),DIE=8925 D ^DIE
"RTN","TIUEDI4",86,0)
 D UPDTIRT^TIUDIRT(.TIU,DA),SEND^TIUALRT(DA)
"RTN","TIUEDI4",87,0)
 L -^TIU(8925,+DA)
"RTN","TIUEDI4",88,0)
 Q
"RTN","TIUEDI4",89,0)
TEXTEDIT(DA,TIUCMMT,TIUCHNG) ; Call DIWE
"RTN","TIUEDI4",90,0)
 N DIC,DIWE,DIWESUB,DIWPT,DR,DWHD,DWI,DWLC,DWLR,DWLW,DWO,DWPK,DDWRW
"RTN","TIUEDI4",91,0)
 N TIUCKSM0,TIUCKSM1,TIUESNM,TIUESBLK
"RTN","TIUEDI4",92,0)
 S TIUESNM=$$DECRYPT^TIULC1($P($G(^TIU(8925,DA,15)),U,3),1,$$CHKSUM^TIULC("^TIU(8925,"_+DA_",""TEXT"")"))
"RTN","TIUEDI4",93,0)
 S TIUESBLK=$$DECRYPT^TIULC1($P($G(^TIU(8925,DA,15)),U,4),1,$$CHKSUM^TIULC("^TIU(8925,"_+DA_",""TEXT"")"))
"RTN","TIUEDI4",94,0)
 W !!,"Calling text editor, please wait..." H 1
"RTN","TIUEDI4",95,0)
 X:$L($G(TIUPRM3)) TIUPRM3
"RTN","TIUEDI4",96,0)
 D BUFFER^TIUEDIU(DA) ; Load edit buffer to protect original from booboos
"RTN","TIUEDI4",97,0)
 S TIUCKSM0=$$CHKSUM^TIULC("^TIU(8925,"_+DA_",""TEMP"")")
"RTN","TIUEDI4",98,0)
 I $D(^TIU(8925,+DA,"TEXT"))'>9 D LOADDFLT(DA,+$P(TIUTYP(1),U,2))
"RTN","TIUEDI4",99,0)
 S DIWESUB="Patient: "_$G(TIU("PNM")),DIC="^TIU(8925,"_+DA_",""TEMP"","
"RTN","TIUEDI4",100,0)
 I $G(VALMAR)="^TMP(""TIUVIEW"",$J)",(+$G(VALMBG)>5),(+$G(VALMBG)'>(+$P($G(^TIU(8925,+DA,"TEXT",0)),U,3)+4)) S DDWRW=+$G(VALMBG)-4
"RTN","TIUEDI4",101,0)
 S DWPK=1,DWLW=74 D EN^DIWE
"RTN","TIUEDI4",102,0)
 ; DELETE if NOSAVE
"RTN","TIUEDI4",103,0)
 I +$G(NOSAVE) D DELETE^TIUEDIT(DA,0) S TIUQUIT=2 Q
"RTN","TIUEDI4",104,0)
 ; Save edit buffer
"RTN","TIUEDI4",105,0)
 S TIUCKSM1=$$CHKSUM^TIULC("^TIU(8925,"_+DA_",""TEMP"")")
"RTN","TIUEDI4",106,0)
 I TIUCKSM0'=TIUCKSM1 D  I 1
"RTN","TIUEDI4",107,0)
 . D COMMIT^TIUEDIU(DA),AUDIT^TIUEDI1(DA,TIUCKSM0,TIUCKSM1)
"RTN","TIUEDI4",108,0)
 . S TIUCHNG=1
"RTN","TIUEDI4",109,0)
 . ; re-file /es/-block
"RTN","TIUEDI4",110,0)
 . I $L(TIUESNM) D
"RTN","TIUEDI4",111,0)
 . . S DR="1503///^S X=TIUESNM;1504///^S X=TIUESBLK",DIE=8925
"RTN","TIUEDI4",112,0)
 . . D ^DIE
"RTN","TIUEDI4",113,0)
 E  W !,"No changes made..." D COMMIT^TIUEDIU(DA,1) S TIUCHNG=0
"RTN","TIUEDI4",114,0)
 S DIE=8925,DR=".1///"_$$LINECNT^TIULC(DA) D ^DIE
"RTN","TIUEDI4",115,0)
 Q
"RTN","TIUEDI4",116,0)
 ;
"RTN","TIUEDI4",117,0)
LOADDFLT(DA,TIUTYP) ; Load bp text
"RTN","TIUEDI4",118,0)
 N TIUI,TIUJ,TIUK,TIUL S TIUI=0
"RTN","TIUEDI4",119,0)
 S TIUJ=+$P($G(^TIU(8925,+DA,"TEMP",0)),U,3)+1
"RTN","TIUEDI4",120,0)
 ; - Set comp hdr -
"RTN","TIUEDI4",121,0)
 S ^TIU(8925,+DA,"TEMP",TIUJ,0)=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":$P(^TIU(8925.1,+TIUTYP,0),U)_":   ",1:"")
"RTN","TIUEDI4",122,0)
 I +TIUJ=1,($G(^TIU(8925,+DA,"TEMP",TIUJ,0))']"") K ^TIU(8925,+DA,"TEMP",TIUJ,0) S TIUJ=0
"RTN","TIUEDI4",123,0)
 S ^TIU(8925,+DA,"TEMP",0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIUEDI4",124,0)
 F  S TIUI=$O(^TIU(8925.1,+TIUTYP,"DFLT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUEDI4",125,0)
 . S TIUJ=TIUJ+1,X=$G(^TIU(8925.1,+TIUTYP,"DFLT",TIUI,0))
"RTN","TIUEDI4",126,0)
 . I $L($T(DOLMLINE^TIUSRVF1)),'$D(XWBOS),(X["{FLD:") S X=$$DOLMLINE^TIUSRVF1(X)
"RTN","TIUEDI4",127,0)
 . I X["|" S X=$$BOIL(X,TIUJ)
"RTN","TIUEDI4",128,0)
 . I X["~@" D INSMULT(X,"^TIU(8925,"_+DA_",""TEMP"")",.TIUJ) I 1
"RTN","TIUEDI4",129,0)
 . E  S ^TIU(8925,+DA,"TEMP",TIUJ,0)=X
"RTN","TIUEDI4",130,0)
 . S ^TIU(8925,+DA,"TEMP",0)="^^"_TIUJ_U_TIUJ_U_DT_"^^"
"RTN","TIUEDI4",131,0)
 I +$O(^TIU(8925.1,+TIUTYP,10,0)) D
"RTN","TIUEDI4",132,0)
 . N TIUFITEM,TIUI
"RTN","TIUEDI4",133,0)
 . D ITEMS^TIUFLT(+TIUTYP)
"RTN","TIUEDI4",134,0)
 . S TIUI=0 F  S TIUI=$O(TIUFITEM(TIUI)) Q:+TIUI'>0  D
"RTN","TIUEDI4",135,0)
 . . S TIUL=+$G(TIUFITEM(+TIUI)) D LOADDFLT(DA,TIUL)
"RTN","TIUEDI4",136,0)
 Q
"RTN","TIUEDI4",137,0)
BOIL(LINE,COUNT) ; execute objects
"RTN","TIUEDI4",138,0)
 N TIUI,DIC,X,Y,TIUFPRIV S TIUFPRIV=1
"RTN","TIUEDI4",139,0)
 N TIUOLDR,TIUNEWR,TIUOLDG,TIUNEWG
"RTN","TIUEDI4",140,0)
 S DIC=8925.1,DIC(0)="FMXZ"
"RTN","TIUEDI4",141,0)
 S DIC("S")="I $P($G(^TIU(8925.1,+Y,0)),U,4)=""O"""
"RTN","TIUEDI4",142,0)
 F TIUI=2:2:$L(LINE,"|") S X=$P(LINE,"|",TIUI) D
"RTN","TIUEDI4",143,0)
 . D ^DIC
"RTN","TIUEDI4",144,0)
 . I +Y'>0 S X="The OBJECT "_X_" was NOT found...Contact IRM."
"RTN","TIUEDI4",145,0)
 . I +Y>0 D
"RTN","TIUEDI4",146,0)
 . . I $D(^TIU(8925.1,+Y,9)),+$$CANXEC(+Y) X ^(9) S:X["~@" X=$$APPEND(X) I 1
"RTN","TIUEDI4",147,0)
 . . E  S X="The OBJECT "_X_" is INACTIVE...Contact IRM."
"RTN","TIUEDI4",148,0)
 . . I X["~@" D
"RTN","TIUEDI4",149,0)
 . . . I X'["^" D
"RTN","TIUEDI4",150,0)
 . . . . S TIUOLDR=$P(X,"~@",2),TIUNEWR=TIUOLDR_TIUI
"RTN","TIUEDI4",151,0)
 . . . . M @TIUNEWR=@TIUOLDR K @TIUOLDR
"RTN","TIUEDI4",152,0)
 . . . . S $P(X,"~@",2)=TIUNEWR
"RTN","TIUEDI4",153,0)
 . . . I X["^" D
"RTN","TIUEDI4",154,0)
 . . . . S TIUOLDG=$P(X,"~@",2),TIUNEWG="^TMP("_"""TIU201"""_","_$J_","_TIUI_")"
"RTN","TIUEDI4",155,0)
 . . . . M @TIUNEWG=@TIUOLDG
"RTN","TIUEDI4",156,0)
 . . . . S $P(X,"~@",2)=TIUNEWG
"RTN","TIUEDI4",157,0)
 . S LINE=$$REPLACE(LINE,X,TIUI)
"RTN","TIUEDI4",158,0)
 Q $TR(LINE,"|","")
"RTN","TIUEDI4",159,0)
CANXEC(TIUODA) ; Eval Obj Status
"RTN","TIUEDI4",160,0)
 N TIUOST,TIUY S TIUOST=+$P($G(^TIU(8925.1,+TIUODA,0)),U,7)
"RTN","TIUEDI4",161,0)
 S TIUY=$S(TIUOST=11:1,+$G(NOSAVE):1,1:0)
"RTN","TIUEDI4",162,0)
 Q +$G(TIUY)
"RTN","TIUEDI4",163,0)
REPLACE(LINE,X,TIUI) ; Replace TIUIth object in LINE
"RTN","TIUEDI4",164,0)
 S $P(LINE,"|",TIUI)=X
"RTN","TIUEDI4",165,0)
 Q LINE
"RTN","TIUEDI4",166,0)
INSMULT(LINE,TARGET,TIULCNT) ; Mult-valued results
"RTN","TIUEDI4",167,0)
 N TIUPC
"RTN","TIUEDI4",168,0)
 F TIUPC=2:2:$L(LINE,"~@") D
"RTN","TIUEDI4",169,0)
 . N TIUI,TIULINE,TIUX,TIUSRC,TIUSCNT,TIUTAIL
"RTN","TIUEDI4",170,0)
 . S TIUSRC=$P(LINE,"~@",TIUPC)
"RTN","TIUEDI4",171,0)
 . S TIUTAIL=$P(LINE,"~@",TIUPC+1)
"RTN","TIUEDI4",172,0)
 . S TIULINE=$P(LINE,"~@",(TIUPC-1)),(TIUI,TIUSCNT)=0
"RTN","TIUEDI4",173,0)
 . I $E(TIULINE)=" ",(TIUPC>2) S $E(TIULINE)=""
"RTN","TIUEDI4",174,0)
 . F  S TIUI=$O(@TIUSRC@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUEDI4",175,0)
 . . N TIUSLINE
"RTN","TIUEDI4",176,0)
 . . S TIUSCNT=TIUSCNT+1
"RTN","TIUEDI4",177,0)
 . . S TIUSLINE=$G(@TIUSRC@(TIUI,0))
"RTN","TIUEDI4",178,0)
 . . S:'+$O(@TIUSRC@(TIUI))&(TIUPC+2>$L(LINE,"~@")) TIUSLINE=TIUSLINE_TIUTAIL
"RTN","TIUEDI4",179,0)
 . . I TIUSCNT=1,($L(TIULINE_TIUSLINE)>73) D  Q
"RTN","TIUEDI4",180,0)
 . . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUEDI4",181,0)
 . . . S @TARGET@(TIULCNT,0)=TIULINE
"RTN","TIUEDI4",182,0)
 . . . S TIULCNT=TIULCNT+1
"RTN","TIUEDI4",183,0)
 . . . S @TARGET@(TIULCNT,0)=TIUSLINE
"RTN","TIUEDI4",184,0)
 . . I TIUSCNT=1,($L(TIULINE_TIUSLINE)'>73) D  Q
"RTN","TIUEDI4",185,0)
 . . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUEDI4",186,0)
 . . . S @TARGET@(TIULCNT,0)=TIULINE_TIUSLINE
"RTN","TIUEDI4",187,0)
 . . S:$D(@TARGET@(TIULCNT,0)) TIULCNT=TIULCNT+1
"RTN","TIUEDI4",188,0)
 . . S @TARGET@(TIULCNT,0)=$G(TIUSLINE)
"RTN","TIUEDI4",189,0)
 . K @TIUSRC
"RTN","TIUEDI4",190,0)
 Q
"RTN","TIUEDI4",191,0)
APPEND(X) ;
"RTN","TIUEDI4",192,0)
 N TIUXL S TIUXL=$L(X)
"RTN","TIUEDI4",193,0)
 I $E(X,TIUXL-1,TIUXL)'="~@" S X=X_"~@"
"RTN","TIUEDI4",194,0)
 Q X
"RTN","TIURM")
0^2^B23965891^B23864201
"RTN","TIURM",1,0)
TIURM ; SLC/JER - MIS Document Review ;9/24/03
"RTN","TIURM",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100,113,216**;Jun 20, 1997
"RTN","TIURM",3,0)
 ;12/7/00 split TIURM into TIURM & TIURM1
"RTN","TIURM",4,0)
MAKELIST(TIUCLASS) ; Get Search Criteria
"RTN","TIURM",5,0)
 N DIRUT,DTOUT,DUOUT,TIUI,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIURM",6,0)
 N TIUDPRMT,STATWORD,STATIFN,NOWFLAG,TIUK
"RTN","TIURM",7,0)
 K DIROUT
"RTN","TIURM",8,0)
 D INITRR^TIULRR(0)
"RTN","TIURM",9,0)
DIVISION ; Select Division(s)
"RTN","TIURM",10,0)
 D SELDIV^TIULA
"RTN","TIURM",11,0)
 I SELDIV'>0 S VALMQUIT=1 Q
"RTN","TIURM",12,0)
 I $D(TIUDI) D
"RTN","TIURM",13,0)
 . S TIUK=0 F  S TIUK=$O(TIUDI(TIUK)) Q:'TIUK  D
"RTN","TIURM",14,0)
 . . S TIUDI("ENTRIES")=$G(TIUDI("ENTRIES"))_TIUK_";"
"RTN","TIURM",15,0)
 E  S TIUDI("ENTRIES")="ALL DIVISIONS"
"RTN","TIURM",16,0)
STATUS S STATUS=$S($D(TIUQUIK):$$SELSTAT^TIULA(.TIUSTAT,"F","UNSIGNED,UNCOSIGNED"),1:$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT(DUZ)))
"RTN","TIURM",17,0)
 I +STATUS<0 S VALMQUIT=1 Q
"RTN","TIURM",18,0)
 S TIUI=0
"RTN","TIURM",19,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI  D
"RTN","TIURM",20,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIURM",21,0)
 . Q:'STATIFN
"RTN","TIURM",22,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIURM",23,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIURM",24,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIURM",25,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIURM",26,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIURM",27,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIURM",28,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIURM",29,0)
 N TIUDCL
"RTN","TIURM",30,0)
 ; -- Ask user for docmt types and set ^TMP("TIUTYP",$J):
"RTN","TIURM",31,0)
 D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL)
"RTN","TIURM",32,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",33,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) K @TIUTYP G STATUS
"RTN","TIURM",34,0)
 D CHECKADD
"RTN","TIURM",35,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIURM",36,0)
 S TIUDPRMT="Entry"
"RTN","TIURM",37,0)
 S TIUEDT=$S($D(TIUQUIK):1,1:$$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT))
"RTN","TIURM",38,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",39,0)
 I TIUEDT'>0 K @TIUTYP G DOCTYPE
"RTN","TIURM",40,0)
LATE S TIULDT=$S($D(TIUQUIK):9999999,1:$$LDATE^TIULA(TIUDPRMT))
"RTN","TIURM",41,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",42,0)
 I TIULDT'>0 G ERLY
"RTN","TIURM",43,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIURM",44,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT) ; P74.  Add late date time whether or not late date is same as early date.
"RTN","TIURM",45,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIURM",46,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIURM",47,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIURM",48,0)
 D BUILD(TIUCLASS,.STATUS,TIUEDT,TIULDT,NOWFLAG,.TIUDI)
"RTN","TIURM",49,0)
 ; -- If attaching ID note & changed view,
"RTN","TIURM",50,0)
 ;    update video for line to be attached: --
"RTN","TIURM",51,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIURM",52,0)
 K TIUDI,SELDIV
"RTN","TIURM",53,0)
 Q
"RTN","TIURM",54,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIURM",55,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIURM",56,0)
 S (TIUI,HIT)=0
"RTN","TIURM",57,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIURM",58,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIURM",59,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIURM",60,0)
 Q
"RTN","TIURM",61,0)
SWAP(TIUX,TIUY) ; Swap any two variables
"RTN","TIURM",62,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIURM",63,0)
 Q
"RTN","TIURM",64,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIURM",65,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIURM",66,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIURM",67,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIURM",68,0)
 Q
"RTN","TIURM",69,0)
BUILD(TIUCLASS,STATUS,EARLY,LATE,NOWFLAG,TIUDI) ; Build List
"RTN","TIURM",70,0)
 N TIUPREF
"RTN","TIURM",71,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIURM",72,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIURM",73,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIURM",74,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIURM",75,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIURM",76,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIURM",77,0)
 S ^TMP("TIUR",$J,"RTN")="TIURM"
"RTN","TIURM",78,0)
 I '$D(TIUPRM0)!'$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURM",79,0)
 S EARLY=+$G(EARLY,0),LATE=+$G(LATE,3333333)
"RTN","TIURM",80,0)
 D GATHER^TIURM1(TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,.TIUDI)
"RTN","TIURM",81,0)
 D PUTLIST^TIURM1(TIUPREF,TIUCLASS,.STATUS,.TIUDI)
"RTN","TIURM",82,0)
 K ^TMP("TIUI",$J)
"RTN","TIURM",83,0)
 Q
"RTN","TIURM",84,0)
CLEAN ; Clean up your mess!
"RTN","TIURM",85,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIURM",86,0)
 K VALMY
"RTN","TIURM",87,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIURM",88,0)
 Q
"RTN","TIURM",89,0)
URGENCY(TIUDA) ; What is the urgency of the current document
"RTN","TIURM",90,0)
 N TIUY,TIUD0,TIUDSTAT,TIUDURG
"RTN","TIURM",91,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUDSTAT=$P(TIUD0,U,5)
"RTN","TIURM",92,0)
 S TIUDURG=$P(TIUD0,U,9)
"RTN","TIURM",93,0)
 S TIUY=$S(TIUDSTAT<7:$S(TIUDURG="P":1,1:2),1:3)
"RTN","TIURM",94,0)
 Q TIUY
"RTN","TIURM",95,0)
DFLTSTAT(USER) ; Set default STATUS for current user
"RTN","TIURM",96,0)
 N TIUMIS,TIUMD,TIUY,TIUDPRM D DOCPRM^TIULC1(244,.TIUDPRM)
"RTN","TIURM",97,0)
 S TIUMIS=$$ISA^USRLM(DUZ,"MEDICAL INFORMATION SECTION")
"RTN","TIURM",98,0)
 I +TIUMIS,+$P($G(TIUDPRM(0)),U,3) S TIUY="UNVERIFIED" G DFLTX
"RTN","TIURM",99,0)
 I $$ISA^USRLM(DUZ,"PROVIDER") S TIUY="COMPLETED" G DFLTX
"RTN","TIURM",100,0)
 S TIUY="COMPLETED"
"RTN","TIURM",101,0)
DFLTX Q TIUY
"RTN","TIURM",102,0)
 ;
"RTN","TIURM",103,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIURM",104,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUEDT,TIULDT
"RTN","TIURM",105,0)
 N TIURBLD,TIUI,TIUCLASS,TIUDI
"RTN","TIURM",106,0)
 S TIURBLD=1
"RTN","TIURM",107,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIURM",108,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIURM",109,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIURM",110,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIURM",111,0)
 S TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIURM",112,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIURM",113,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIURM",114,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIURM",115,0)
 M TIUDI=^TMP("TIUR",$J,"DIV")
"RTN","TIURM",116,0)
 D BUILD(TIUCLASS,.STATUS,TIUEDT,TIULDT,NOWFLAG,.TIUDI)
"RTN","TIURM",117,0)
 ; Reexpand previously expanded items:
"RTN","TIURM",118,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIURM",119,0)
 D BREATHE^TIUROR1(1)
"RTN","TIURM",120,0)
 Q
"VER")
8.0^22.0
"BLD",6749,6)
^210
**END**
**END**
