Released RA*5*83 SEQ #71
Extracted from mail message
**KIDS**:RA*5.0*83^

**INSTALL NAME**
RA*5.0*83
"BLD",6544,0)
RA*5.0*83^RADIOLOGY/NUCLEAR MEDICINE^0^3070420^y
"BLD",6544,1,0)
^^1^1^3070314^
"BLD",6544,1,1,0)
Please refer to the Forum NPM patch description for details to this patch.
"BLD",6544,4,0)
^9.64PA^^
"BLD",6544,6.3)
4
"BLD",6544,"KRN",0)
^9.67PA^8989.52^19
"BLD",6544,"KRN",.4,0)
.4
"BLD",6544,"KRN",.401,0)
.401
"BLD",6544,"KRN",.402,0)
.402
"BLD",6544,"KRN",.403,0)
.403
"BLD",6544,"KRN",.5,0)
.5
"BLD",6544,"KRN",.84,0)
.84
"BLD",6544,"KRN",3.6,0)
3.6
"BLD",6544,"KRN",3.8,0)
3.8
"BLD",6544,"KRN",9.2,0)
9.2
"BLD",6544,"KRN",9.8,0)
9.8
"BLD",6544,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",6544,"KRN",9.8,"NM",1,0)
RASELCT^^0^B45378732
"BLD",6544,"KRN",9.8,"NM",2,0)
RAPMW^^0^B68972130
"BLD",6544,"KRN",9.8,"NM",3,0)
RAPMW1^^0^B84474637
"BLD",6544,"KRN",9.8,"NM",4,0)
RAPMW2^^0^B76504533
"BLD",6544,"KRN",9.8,"NM","B","RAPMW",2)

"BLD",6544,"KRN",9.8,"NM","B","RAPMW1",3)

"BLD",6544,"KRN",9.8,"NM","B","RAPMW2",4)

"BLD",6544,"KRN",9.8,"NM","B","RASELCT",1)

"BLD",6544,"KRN",19,0)
19
"BLD",6544,"KRN",19.1,0)
19.1
"BLD",6544,"KRN",101,0)
101
"BLD",6544,"KRN",409.61,0)
409.61
"BLD",6544,"KRN",771,0)
771
"BLD",6544,"KRN",870,0)
870
"BLD",6544,"KRN",8989.51,0)
8989.51
"BLD",6544,"KRN",8989.52,0)
8989.52
"BLD",6544,"KRN",8994,0)
8994
"BLD",6544,"KRN","B",.4,.4)

"BLD",6544,"KRN","B",.401,.401)

"BLD",6544,"KRN","B",.402,.402)

"BLD",6544,"KRN","B",.403,.403)

"BLD",6544,"KRN","B",.5,.5)

"BLD",6544,"KRN","B",.84,.84)

"BLD",6544,"KRN","B",3.6,3.6)

"BLD",6544,"KRN","B",3.8,3.8)

"BLD",6544,"KRN","B",9.2,9.2)

"BLD",6544,"KRN","B",9.8,9.8)

"BLD",6544,"KRN","B",19,19)

"BLD",6544,"KRN","B",19.1,19.1)

"BLD",6544,"KRN","B",101,101)

"BLD",6544,"KRN","B",409.61,409.61)

"BLD",6544,"KRN","B",771,771)

"BLD",6544,"KRN","B",870,870)

"BLD",6544,"KRN","B",8989.51,8989.51)

"BLD",6544,"KRN","B",8989.52,8989.52)

"BLD",6544,"KRN","B",8994,8994)

"BLD",6544,"QUES",0)
^9.62^^
"BLD",6544,"REQB",0)
^9.611^1^1
"BLD",6544,"REQB",1,0)
RA*5.0*79^2
"BLD",6544,"REQB","B","RA*5.0*79",1)

"MBREQ")
0
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
83^3070420
"PKG",18,22,1,"PAH",1,1,0)
^^1^1^3070420
"PKG",18,22,1,"PAH",1,1,1,0)
Please refer to the Forum NPM patch description for details to this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","RAPMW")
0^2^B68972130^B68206684
"RTN","RAPMW",1,0)
RAPMW ;HOIFO/SWM-Radiology Wait Time reports ;11/07/05 12:53
"RTN","RAPMW",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**67,79,83**;Mar 16, 1998;Build 4
"RTN","RAPMW",3,0)
 ;
"RTN","RAPMW",4,0)
 ; ___ set up RACESS array
"RTN","RAPMW",5,0)
 I $D(DUZ),($O(RACCESS(DUZ,""))']"") D CHECK^RADLQ3(DUZ)
"RTN","RAPMW",6,0)
 ; ___ new/set/kill other variables
"RTN","RAPMW",7,0)
 K ^TMP($J)
"RTN","RAPMW",8,0)
 ;**********************************************************
"RTN","RAPMW",9,0)
 ;*  On Dec. 14, 2006, Dr. Anderson requested that the
"RTN","RAPMW",10,0)
 ;*  RADIAION THERAPY procedure type be dropped from the
"RTN","RAPMW",11,0)
 ;*  Wait Times Report but it may be included in the future.
"RTN","RAPMW",12,0)
 ;*  
"RTN","RAPMW",13,0)
 ;*  If RADIATION THERAPY will be included again, the only
"RTN","RAPMW",14,0)
 ;*  coding that needs to be changed is the line below; it
"RTN","RAPMW",15,0)
 ;*  should be removed.  The rest of the coding that handles
"RTN","RAPMW",16,0)
 ;*  exclusion of Procedure Types don't have to be changed
"RTN","RAPMW",17,0)
 ;*  because it uses RAXCLUDE() to exclude procedure types.
"RTN","RAPMW",18,0)
 ;*
"RTN","RAPMW",19,0)
 S RAXCLUDE("RADIATION THERAPY")=""
"RTN","RAPMW",20,0)
 ;*
"RTN","RAPMW",21,0)
 ;***********************************************************
"RTN","RAPMW",22,0)
 D SETPTA
"RTN","RAPMW",23,0)
 S (RATOTAL,RAXIT)=0
"RTN","RAPMW",24,0)
 W @IOF
"RTN","RAPMW",25,0)
 W !,"Radiology Outpatient Procedure Wait Time Report"
"RTN","RAPMW",26,0)
 ; __ get report type
"RTN","RAPMW",27,0)
 D GETTYP I $D(DIRUT) G EXIT
"RTN","RAPMW",28,0)
 ; ___ get date range
"RTN","RAPMW",29,0)
 W !! D GETDATE I $D(DIRUT) G EXIT
"RTN","RAPMW",30,0)
 ; ___ get division
"RTN","RAPMW",31,0)
 S X=$$GETDIV() I X G EXIT
"RTN","RAPMW",32,0)
 ; ___ ask what to ask next, procedure or img typ
"RTN","RAPMW",33,0)
 D ASKIP I RANX="" G EXIT
"RTN","RAPMW",34,0)
 I RANX="P" D  W "."
"RTN","RAPMW",35,0)
 .W !!?5,"All PROCEDURE TYPES will be included"
"RTN","RAPMW",36,0)
 .I $O(RAXCLUDE(""))]"" D
"RTN","RAPMW",37,0)
 .W ", except "
"RTN","RAPMW",38,0)
 .S I="" F  S I=$O(RAXCLUDE(I)) Q:I=""  W I W:$O(RAXCLUDE(I))]"" ", "
"RTN","RAPMW",39,0)
 .Q
"RTN","RAPMW",40,0)
 I RANX="C" D  I RAQUIT G EXIT
"RTN","RAPMW",41,0)
 . ; ___ get procedure/CPT CODE(s)
"RTN","RAPMW",42,0)
 . D GETPROC
"RTN","RAPMW",43,0)
 . Q
"RTN","RAPMW",44,0)
 ; *79, skip ask spec imaing type
"RTN","RAPMW",45,0)
 I "B^D"[RATYP D  I $D(DIRUT) G EXIT
"RTN","RAPMW",46,0)
 . D ASKSORT I $D(DIRUT) Q
"RTN","RAPMW",47,0)
 . D ASKDAYS
"RTN","RAPMW",48,0)
 . Q
"RTN","RAPMW",49,0)
 I "B^D"[RATYP D
"RTN","RAPMW",50,0)
 .S RATXT="*** The detail report requires a 132 column output device ***"
"RTN","RAPMW",51,0)
 .S RALINE="",$P(RALINE,"*",$L(RATXT)+1)=""
"RTN","RAPMW",52,0)
 .W !!?(80-$L(RATXT)\2),RALINE,!?(80-$L(RATXT)\2),RATXT,!?(80-$L(RATXT)\2),RALINE,!
"RTN","RAPMW",53,0)
 .Q
"RTN","RAPMW",54,0)
 D GETDEV I RAPOP G EXIT
"RTN","RAPMW",55,0)
 D START
"RTN","RAPMW",56,0)
 Q
"RTN","RAPMW",57,0)
START ; taskman to del task after job, set Radiology IO
"RTN","RAPMW",58,0)
 S:$D(ZTQUEUED) ZTREQ="@" S RAIO=$S(IO="":0,1:1) ;RAIO true/false
"RTN","RAPMW",59,0)
 ; get data
"RTN","RAPMW",60,0)
 ;    remove: inpatient, cancelled
"RTN","RAPMW",61,0)
 ;    keep: specific proc/CPT, imag types if entered
"RTN","RAPMW",62,0)
 S RASAME=0 ; count # procedures cancelled and re-ordered same day
"RTN","RAPMW",63,0)
 S RANEG=0 ; count # negative Days Wait
"RTN","RAPMW",64,0)
 D GETDATA
"RTN","RAPMW",65,0)
 U:RAIO IO
"RTN","RAPMW",66,0)
 I "S^B"[RATYP D WRTSUM^RAPMW1 ; summary report
"RTN","RAPMW",67,0)
 I RATYP="B",$E(IOST,1,2)'="C-" W @IOF
"RTN","RAPMW",68,0)
 I "D^B"[RATYP D WRTDET^RAPMW2 ; detail report
"RTN","RAPMW",69,0)
 D EXIT
"RTN","RAPMW",70,0)
 Q
"RTN","RAPMW",71,0)
GETTYP ;
"RTN","RAPMW",72,0)
 S DIR(0)="S^S:Summary;D:Detail;B:Both"
"RTN","RAPMW",73,0)
 S DIR("A")="Select Report Type",DIR("B")="S"
"RTN","RAPMW",74,0)
 S DIR("?")="Enter Summary report OR Detail report OR Both reports"
"RTN","RAPMW",75,0)
 W !!,"Enter Report Type"
"RTN","RAPMW",76,0)
 D ^DIR K DIR
"RTN","RAPMW",77,0)
 Q:$D(DIRUT)
"RTN","RAPMW",78,0)
 S RATYP=Y
"RTN","RAPMW",79,0)
 Q
"RTN","RAPMW",80,0)
GETDATE ; start and end dates
"RTN","RAPMW",81,0)
 S DIR(0)="D^:"_DT_":AEX"
"RTN","RAPMW",82,0)
 W !?4,"The starting and ending dates are based upon what was entered at",!?4,"the ""Imaging Exam Date/Time"" prompt during Registration.",!
"RTN","RAPMW",83,0)
 S DIR("A")="Enter starting date"
"RTN","RAPMW",84,0)
 S DIR("?")="Enter date to begin searching Exam date from"
"RTN","RAPMW",85,0)
 D ^DIR K DIR
"RTN","RAPMW",86,0)
 Q:$D(DIRUT)
"RTN","RAPMW",87,0)
 S RABDATE=Y
"RTN","RAPMW",88,0)
 ;
"RTN","RAPMW",89,0)
 S RADD=$S(RATYP="S":91,1:31),X1=RABDATE,X2=RADD D C^%DTC S RAMAXDT=X
"RTN","RAPMW",90,0)
 I RAMAXDT>DT S RAMAXDT=DT W !!?4,"** Ending Date cannot be later than today's date. **",!
"RTN","RAPMW",91,0)
 S DIR(0)="D^"_RABDATE_":"_RAMAXDT_":AEX"
"RTN","RAPMW",92,0)
 S DIR("A")="Enter ending date"
"RTN","RAPMW",93,0)
 S DIR("?",1)="+91 days max. for Summary, +31 days max. for Detail."
"RTN","RAPMW",94,0)
 S DIR("?")="But the Ending Date cannot be later than today's date."
"RTN","RAPMW",95,0)
 D ^DIR K DIR
"RTN","RAPMW",96,0)
 Q:$D(DIRUT)
"RTN","RAPMW",97,0)
 ;
"RTN","RAPMW",98,0)
 ; RABDATE, RAEDATE original values
"RTN","RAPMW",99,0)
 ; RABEGDT, RAENDDT used in GETDATA 
"RTN","RAPMW",100,0)
 ; Set to end of day
"RTN","RAPMW",101,0)
 S RAEDATE=Y,RAENDDT=RAEDATE_.9999
"RTN","RAPMW",102,0)
 ; Set to include current day
"RTN","RAPMW",103,0)
 S RABEGDT=(RABDATE-1)_.9999
"RTN","RAPMW",104,0)
 Q
"RTN","RAPMW",105,0)
GETDIV() ;
"RTN","RAPMW",106,0)
 N X S X=$$SETUPDI^RAUTL7() Q:X 1
"RTN","RAPMW",107,0)
 D SELDIV^RAUTL7
"RTN","RAPMW",108,0)
 I '$D(^TMP($J,"RA D-TYPE"))!(RAQUIT) D  Q 1
"RTN","RAPMW",109,0)
 .K RACCESS(DUZ,"DIV-IMG"),^TMP($J,"DIV-IMG")
"RTN","RAPMW",110,0)
 .Q
"RTN","RAPMW",111,0)
 Q 0
"RTN","RAPMW",112,0)
ASKIP ;
"RTN","RAPMW",113,0)
 S RANX=""
"RTN","RAPMW",114,0)
 S DIR(0)="S^C:CPT Code/Procedure Name;P:Procedure Type"
"RTN","RAPMW",115,0)
 S DIR("?")=" "
"RTN","RAPMW",116,0)
 S DIR("?",1)="   ""CPT Code/Procedure Name"" will include only the"
"RTN","RAPMW",117,0)
 S DIR("?",2)="   user selected CPT Codes and Procedure names in this"
"RTN","RAPMW",118,0)
 S DIR("?",3)="   date range, except for cases that are cancelled, have"
"RTN","RAPMW",119,0)
 S DIR("?",4)="   no credit, and are inpatient."
"RTN","RAPMW",120,0)
 S DIR("?",5)=" "
"RTN","RAPMW",121,0)
 S DIR("?",6)="   ""Procedure Type"" will include all cases in this"
"RTN","RAPMW",122,0)
 S DIR("?",7)="   date range, except for the 3 exclusions above and also"
"RTN","RAPMW",123,0)
 S DIR("?",8)="   except if the case is part of a printset and it is not"
"RTN","RAPMW",124,0)
 S DIR("?",9)="   the highest ranked modality in the printset."
"RTN","RAPMW",125,0)
 S DIR("A")="What do you want to choose next",DIR("B")="P"
"RTN","RAPMW",126,0)
 W !!,"Enter next item to select."
"RTN","RAPMW",127,0)
 D ^DIR K DIR
"RTN","RAPMW",128,0)
 Q:$D(DIRUT)
"RTN","RAPMW",129,0)
 S RANX=Y
"RTN","RAPMW",130,0)
 Q
"RTN","RAPMW",131,0)
 ; *79 removed GETIMG() section
"RTN","RAPMW",132,0)
GETPROC ;
"RTN","RAPMW",133,0)
 S RADIC="^RAMIS(71,",RADIC(0)="QEAMZ"
"RTN","RAPMW",134,0)
 S RADIC("A")="Select Procedure/CPT Code: "
"RTN","RAPMW",135,0)
 S RAUTIL="RA WAIT"
"RTN","RAPMW",136,0)
 D EN1^RASELCT(.RADIC,RAUTIL)
"RTN","RAPMW",137,0)
 Q:RAQUIT
"RTN","RAPMW",138,0)
 S RA1=""
"RTN","RAPMW",139,0)
 F  S RA1=$O(^TMP($J,"RA WAIT",RA1)) Q:RA1=""  S RA2=0 D
"RTN","RAPMW",140,0)
 .F  S RA2=$O(^TMP($J,"RA WAIT",RA1,RA2)) Q:'RA2  S ^TMP($J,"RA WAIT2",RA2)="",^TMP($J,"RA WAIT1",RA1)=$P($$NAMCODE^RACPTMSC($P($G(^RAMIS(71,RA2,0)),U,9),DT),U) D
"RTN","RAPMW",141,0)
 ..;if parent was selected, then save iens of its descendents for FILTER2
"RTN","RAPMW",142,0)
 ..I $P(^RAMIS(71,RA2,0),U,6)="P" D
"RTN","RAPMW",143,0)
 ...S RA3=0 F  S RA3=$O(^RAMIS(71,RA2,4,"B",RA3)) Q:'RA3  S ^TMP($J,"RA WAIT2",RA3)=""
"RTN","RAPMW",144,0)
 ...Q
"RTN","RAPMW",145,0)
 ..Q
"RTN","RAPMW",146,0)
 .Q
"RTN","RAPMW",147,0)
 Q
"RTN","RAPMW",148,0)
ASKSORT ;
"RTN","RAPMW",149,0)
 S DIR(0)="S^CN:Case Number;CPT:CPT Code;DD:Date Desired;D:Days Wait;DO:Date of Order;DR:Date of Registration;I:Imaging Type;PN:Patient Name;PT:PROCEDURE TYPE;PROC:Procedure Name"
"RTN","RAPMW",150,0)
 S DIR("?")="Select which item to use for sorting the Detail Report"
"RTN","RAPMW",151,0)
 S DIR("A")="Sorted by",DIR("B")="D"
"RTN","RAPMW",152,0)
 W !!,"Sort report by"
"RTN","RAPMW",153,0)
 D ^DIR
"RTN","RAPMW",154,0)
 I $D(DIRUT) K DIR Q
"RTN","RAPMW",155,0)
 S RASORT=Y
"RTN","RAPMW",156,0)
 S RASORTNM=Y(0)
"RTN","RAPMW",157,0)
 S:RASORTNM["Regis" RASORTNM="Dt. Register"
"RTN","RAPMW",158,0)
 K DIR
"RTN","RAPMW",159,0)
 Q
"RTN","RAPMW",160,0)
ASKDAYS ;
"RTN","RAPMW",161,0)
 S DIR(0)="N^0:120"
"RTN","RAPMW",162,0)
 S DIR("A")="Print wait days greater than or equal to"
"RTN","RAPMW",163,0)
 S DIR("B")="0"
"RTN","RAPMW",164,0)
 S DIR("?",1)="Enter the minimum number of Days Wait between Date Desired and Registered Date."
"RTN","RAPMW",165,0)
 S DIR("?",2)="Only cases with Days Wait greater than or equal to this value"
"RTN","RAPMW",166,0)
 S DIR("?")="will be listed in the detail report."
"RTN","RAPMW",167,0)
 D ^DIR K DIR Q:$D(DIRUT)  S RASINCE=Y
"RTN","RAPMW",168,0)
 Q
"RTN","RAPMW",169,0)
GETDEV ;
"RTN","RAPMW",170,0)
 W:RATYP="B" !!,"Specify device for both summary and detail reports."
"RTN","RAPMW",171,0)
 D TASK
"RTN","RAPMW",172,0)
 D ZIS^RAUTL
"RTN","RAPMW",173,0)
 Q
"RTN","RAPMW",174,0)
TASK ; set vars for taskman
"RTN","RAPMW",175,0)
 S ZTRTN="START^RAPMW"
"RTN","RAPMW",176,0)
 S ZTSAVE("RA*")=""
"RTN","RAPMW",177,0)
 S ZTSAVE("^TMP($J,")=""
"RTN","RAPMW",178,0)
 S ZTDESC="Radiology Outpatient Wait Time Report"
"RTN","RAPMW",179,0)
 Q
"RTN","RAPMW",180,0)
GETDATA ;
"RTN","RAPMW",181,0)
 S RABAD=0 ;=0 means nothing bad, so accept case; =1 means reject case
"RTN","RAPMW",182,0)
 ;loop thru exam date (RADTE)
"RTN","RAPMW",183,0)
 S RADTE=RABEGDT
"RTN","RAPMW",184,0)
 F  S RADTE=$O(^RADPT("AR",RADTE)) Q:'RADTE  Q:(RADTE>RAENDDT)  D
"RTN","RAPMW",185,0)
 .S RADFN="" F  S RADFN=$O(^RADPT("AR",RADTE,RADFN)) Q:'RADFN  S RABAD=0 D
"RTN","RAPMW",186,0)
 ..S RADTI="" F  S RADTI=$O(^RADPT("AR",RADTE,RADFN,RADTI)) Q:'RADTI  D FILTER1^RAPMW1 I 'RABAD D
"RTN","RAPMW",187,0)
 ...S RACNI=0 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:'RACNI  D FILTER2^RAPMW1 I 'RABAD D CALC^RAPMW2
"RTN","RAPMW",188,0)
 ...Q
"RTN","RAPMW",189,0)
 ..Q
"RTN","RAPMW",190,0)
 .Q
"RTN","RAPMW",191,0)
 Q
"RTN","RAPMW",192,0)
EXIT ;
"RTN","RAPMW",193,0)
 D CLOSE^RAUTL ;close dev
"RTN","RAPMW",194,0)
 K I,J,POP,RA0,RA1,RA16,RA2,RA3,RA71REC,RA72,X,X1,X2,Y,^TMP($J)
"RTN","RAPMW",195,0)
 K RABAD,RABDATE,RABEGDT,RACHKDIV,RACN0,RACNI,RACNISAV,RACNL,RACOL
"RTN","RAPMW",196,0)
 K RACPT,RADASH,RADD,RADFN,RADIC,RADIV,RADSDT,RADTE,RADTI,RADTORD
"RTN","RAPMW",197,0)
 K RAEDATE,RAENDDT,RAH1,RAH3,RAH4,RAH5,RAH6,RAH7,RAH8,RAHD0,RAIMGTYP
"RTN","RAPMW",198,0)
 K RAIO,RAIOM,RAIT,RAITYP,RAKEY,RALINE,RAMAX,RAMAXDT,RANEG,RANOW,RANX
"RTN","RAPMW",199,0)
 K RAOREC,RAORIEN,RAPATND,RAPATNM,RAPG,RAPOP,RAPROCNM,RAPSTX,RAQUIT
"RTN","RAPMW",200,0)
 K RAR,RAREC,RASAME,RASAME2,RASELDIV,RASINCE,RASORT,RASORTNM
"RTN","RAPMW",201,0)
 K RAAVG,RATOTAL,RATYP,RAUTIL,RAWAITD,RATXT,RAXDT,RAXIT,RAXMST
"RTN","RAPMW",202,0)
 K RACPTC,RACPTI,RAHI,RAHIER,RAPCT,RAPRC,RAPTA,RARY,RAXCLUDE,RAMES
"RTN","RAPMW",203,0)
 ;
"RTN","RAPMW",204,0)
 ; ^TMP($J,"RA I-TYPE","CT SCAN",ienFile79.2)="" <--*79 not needed
"RTN","RAPMW",205,0)
 ; ^TMP($J,"RA D-TYPE","SUPPORT ISC",ienFile79)=""
"RTN","RAPMW",206,0)
 ; ^TMP($J,"RA WAIT",ProcNam,ienFile71)=""<--from EN1^RASELCT
"RTN","RAPMW",207,0)
 ; ^TMP($J,"RA WAIT1",ProcNam)=CPTcode<--hdr of rpt, SETHD^RAPMW1
"RTN","RAPMW",208,0)
 ; ^TMP($J,"RA WAIT2",ienFile71)=""<--screen cases, FILTER2^RAPMW1
"RTN","RAPMW",209,0)
 ;ex.   ^TMP($J,"RA WAIT","TEETH",31)=
"RTN","RAPMW",210,0)
 ;ex.   ^TMP($J,"RA WAIT1","TEETH")=70320
"RTN","RAPMW",211,0)
 ;ex.   ^TMP($J,"RA WAIT2",31)=
"RTN","RAPMW",212,0)
 ; ^TMP($J,"RA WAIT NO ORD",RADFN,RADTI,RACNI)=ienFile75.1
"RTN","RAPMW",213,0)
 ; ^TMP($J,"RA WAIT NO DSR DT",RADFN,RADTI,RACNI)=ienFile75.1
"RTN","RAPMW",214,0)
 ; ^TMP($J,"RA WAIT3",RASORT,RADTE,RAPATNM,RACNI)=""<--detail display
"RTN","RAPMW",215,0)
 Q
"RTN","RAPMW",216,0)
SETPTA ;Set up Proc Type Array, w Sherrill Snuggs' Xcel file
"RTN","RAPMW",217,0)
 ; also setup RATOTAL(), RACOL(,), RAHIER()
"RTN","RAPMW",218,0)
 N I,J
"RTN","RAPMW",219,0)
 S I=""
"RTN","RAPMW",220,0)
 ; RATOTAL(I) sub-total, each Proc Type
"RTN","RAPMW",221,0)
 ; RAWAITD(I) total wait days, each Proc Type
"RTN","RAPMW",222,0)
 ; RAAVG(I)   average wait days, each Proc Type
"RTN","RAPMW",223,0)
 F  S I=$O(^RA(73.2,"AC",I)) Q:I=""  S RATOTAL(I)=0,RAWAITD(I)=0,RAAVG(I)=0 F J=1:1:5 S RACOL(I,J)=0
"RTN","RAPMW",224,0)
 S I="unknown",RATOTAL(I)=0,RAWAITD(I)=0,RAAVG(I)=0 F J=1:1:5 S RACOL(I,J)=0
"RTN","RAPMW",225,0)
 ; Rank Proc Types, needed to pick case from printset
"RTN","RAPMW",226,0)
 ; 1=Interventional  2=MR  3=CT  4=Card. Stress Test  5=NM
"RTN","RAPMW",227,0)
 ; 6=US  7=Mammo  8=Plain Film (Gen Rad)  9=Other
"RTN","RAPMW",228,0)
 S I=""
"RTN","RAPMW",229,0)
 F  S I=$O(RATOTAL(I)) Q:I=""  D
"RTN","RAPMW",230,0)
 .S J=$E(I,1,3)
"RTN","RAPMW",231,0)
 .S RAHIER(I)=$S(J="CAR":4,J="COM":3,J="GEN":8,J="INT":1,J="MAG":2,J="MAM":7,J="NUC":5,J="ULT":6,1:9)
"RTN","RAPMW",232,0)
 .Q
"RTN","RAPMW",233,0)
 Q
"RTN","RAPMW1")
0^3^B84474637^B81237625
"RTN","RAPMW1",1,0)
RAPMW1 ;HOIFO/SWM-Radiology Wait Time reports ;12/05/05 13:40
"RTN","RAPMW1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**67,79,83**;Mar 16, 1998;Build 4
"RTN","RAPMW1",3,0)
 ; IA 10090 allows Read w/Fileman for entire file 4
"RTN","RAPMW1",4,0)
 ; summary
"RTN","RAPMW1",5,0)
 Q
"RTN","RAPMW1",6,0)
FILTER1 ;
"RTN","RAPMW1",7,0)
 S RABAD=0
"RTN","RAPMW1",8,0)
 I '$D(^RADPT(RADFN,"DT",RADTI)) S RABAD=1 Q  ;no exam data
"RTN","RAPMW1",9,0)
 ;division
"RTN","RAPMW1",10,0)
 S RASELDIV=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,3)
"RTN","RAPMW1",11,0)
 S RACHKDIV=$P($G(^DIC(4,+RASELDIV,0)),U)
"RTN","RAPMW1",12,0)
 I RACHKDIV'="",'$D(^TMP($J,"RA D-TYPE",RACHKDIV)) S RABAD=1 Q
"RTN","RAPMW1",13,0)
 ;imaging type
"RTN","RAPMW1",14,0)
 S RAITYP=$P($G(^RADPT(RADFN,"DT",RADTI,0)),U,2)
"RTN","RAPMW1",15,0)
 S RAIMGTYP=$P($G(^RA(79.2,+RAITYP,0)),U)
"RTN","RAPMW1",16,0)
 ; *79 removed check for imaging type
"RTN","RAPMW1",17,0)
 I RAIMGTYP="" S RAIMGTYP="(unk)"
"RTN","RAPMW1",18,0)
 Q
"RTN","RAPMW1",19,0)
FILTER2 ;
"RTN","RAPMW1",20,0)
 S RABAD=0
"RTN","RAPMW1",21,0)
 S RACN0=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAPMW1",22,0)
 I RACN0="" S RABAD=1 Q  ;no case level data
"RTN","RAPMW1",23,0)
 I RANX="C",'$D(^TMP($J,"RA WAIT2",+$P(RACN0,U,2))) S RABAD=1 Q
"RTN","RAPMW1",24,0)
 S RACNISAV=RACNI ; save orig. before it's changed due printset
"RTN","RAPMW1",25,0)
 I RANX="P",$P(RACN0,U,25)>1 D  G EXCL
"RTN","RAPMW1",26,0)
 .; If selecting by Proc Type, and case is from printset --
"RTN","RAPMW1",27,0)
 .; pick case with highest ranked Procedure Type
"RTN","RAPMW1",28,0)
 .; then skip remaining cases by setting a high RACNI
"RTN","RAPMW1",29,0)
 .S I=0
"RTN","RAPMW1",30,0)
 .K RARY ;array of cases and rank number
"RTN","RAPMW1",31,0)
 .F  S I=$O(^RADPT(RADFN,"DT",RADTI,"P",I)) Q:'I  S RACN0=$G(^(I,0)) D:RACN0'=""
"RTN","RAPMW1",32,0)
 ..S RABAD=0 D CHECK3 Q:RABAD  ;skip case if it meets 1 of 3 exclusions
"RTN","RAPMW1",33,0)
 ..D PTA^RAPMW2
"RTN","RAPMW1",34,0)
 ..;eg. rary(6,racni)=racn0 for Ultrasound
"RTN","RAPMW1",35,0)
 ..S RARY(RAHIER(RAPTA),I)=RACN0
"RTN","RAPMW1",36,0)
 ..Q
"RTN","RAPMW1",37,0)
 .S RAHI=$O(RARY("")) ;highest rank number from prtset cases
"RTN","RAPMW1",38,0)
 .I RAHI="" D  Q  ; no case in prtset can be used
"RTN","RAPMW1",39,0)
 ..S RABAD=1,RACNI=99999
"RTN","RAPMW1",40,0)
 ..Q
"RTN","RAPMW1",41,0)
 .S RACNI=$O(RARY(RAHI,0))
"RTN","RAPMW1",42,0)
 .I RACNI="" D  Q  ;should not happen
"RTN","RAPMW1",43,0)
 ..S RABAD=1,RACNI=99999
"RTN","RAPMW1",44,0)
 ..Q
"RTN","RAPMW1",45,0)
 .S RACN0=RARY(RAHI,RACNI) ;reset racn0
"RTN","RAPMW1",46,0)
 .S RA72=^RA(72,+$P(RACN0,U,3),0) ;reset ra72
"RTN","RAPMW1",47,0)
 .S RACNISAV=RACNI ; save orig. before it's changed due printset
"RTN","RAPMW1",48,0)
 .S RACNI=99999 ;set to 99999 so GETDATA loop would skip rest of prtset
"RTN","RAPMW1",49,0)
 .Q
"RTN","RAPMW1",50,0)
 D CHECK3
"RTN","RAPMW1",51,0)
EXCL ; skip case if its proc isn't among user-selected procs
"RTN","RAPMW1",52,0)
 D PTA^RAPMW2 ; *79, Procedure Type via CPT Code & Sherrill's Xcel sheet
"RTN","RAPMW1",53,0)
 I $D(RAXCLUDE(RAPTA)) S RABAD=1 Q
"RTN","RAPMW1",54,0)
 Q
"RTN","RAPMW1",55,0)
CHECK3 ; check inpatient, no credit, cancelled exam
"RTN","RAPMW1",56,0)
 ; CATEGORY OF EXAM is inpatient
"RTN","RAPMW1",57,0)
 I $P(RACN0,U,4)="I" S RABAD=1 Q
"RTN","RAPMW1",58,0)
 ; exam's credit method is 2 (no credit)
"RTN","RAPMW1",59,0)
 I $P(RACN0,U,26)=2 S RABAD=1 Q
"RTN","RAPMW1",60,0)
 ; exam status is cancelled
"RTN","RAPMW1",61,0)
 I $P(RACN0,U,3)="" S RABAD=1 Q  ;no exam status
"RTN","RAPMW1",62,0)
 S RA72=^RA(72,+$P(RACN0,U,3),0) ;file 72 node 0
"RTN","RAPMW1",63,0)
 I $P(RA72,U,3)=0 S RABAD=1 Q  ;skip cancelled exam
"RTN","RAPMW1",64,0)
 Q
"RTN","RAPMW1",65,0)
STORSUM ;
"RTN","RAPMW1",66,0)
 S RACOL=$S(RAWAITD'>30:1,RAWAITD'>60:2,RAWAITD'>90:3,RAWAITD'>120:4,1:5)
"RTN","RAPMW1",67,0)
 S RACOL(RAPTA,RACOL)=RACOL(RAPTA,RACOL)+1
"RTN","RAPMW1",68,0)
 S RATOTAL(RAPTA)=RATOTAL(RAPTA)+1,RATOTAL=RATOTAL+1
"RTN","RAPMW1",69,0)
 ; count negative Wait Days as 0
"RTN","RAPMW1",70,0)
 S RAWAITD(RAPTA)=RAWAITD(RAPTA)+$S(RAWAITD<0:0,1:RAWAITD)
"RTN","RAPMW1",71,0)
 Q
"RTN","RAPMW1",72,0)
WRTSUM ;
"RTN","RAPMW1",73,0)
 S RAHD0="Summary",RAPG=1
"RTN","RAPMW1",74,0)
 D SETHD
"RTN","RAPMW1",75,0)
 D PRTS Q:RAXIT
"RTN","RAPMW1",76,0)
 D FOOTS
"RTN","RAPMW1",77,0)
 Q
"RTN","RAPMW1",78,0)
SETHD ; Set up header & dev vars for identical parts of summary and detail reports
"RTN","RAPMW1",79,0)
 S RAIOM=$S(RATYP="S":80,1:IOM),$P(RADASH,"-",46)=""
"RTN","RAPMW1",80,0)
 S RAH1=RAHD0_" Radiology Outpatient Procedure Wait Time Report"
"RTN","RAPMW1",81,0)
 ; Hdr Line 3 -- Facility, Station, VISN
"RTN","RAPMW1",82,0)
 D GETS^DIQ(4,DUZ(2),".01;14*;99","E","RAR","RAMSG")
"RTN","RAPMW1",83,0)
 K X
"RTN","RAPMW1",84,0)
 S X(1)=RAR(4,DUZ(2)_",",.01,"E") ; Name of facility
"RTN","RAPMW1",85,0)
 S X(2)=RAR(4,DUZ(2)_",",99,"E") ;  Station Number
"RTN","RAPMW1",86,0)
 I $D(RAR(4.014)) D
"RTN","RAPMW1",87,0)
 . S X(3)=RAR(4.014,"1,"_DUZ(2)_",",.01,"E") ; Association
"RTN","RAPMW1",88,0)
 . S X(4)=RAR(4.014,"1,"_DUZ(2)_",",1,"E") ; Parent of Association
"RTN","RAPMW1",89,0)
 . S X(5)=$S(X(3)="VISN":X(4),1:"") ; should be VISN number
"RTN","RAPMW1",90,0)
 E  S X(5)=""
"RTN","RAPMW1",91,0)
 ;
"RTN","RAPMW1",92,0)
 S $P(X(6)," ",79)=""
"RTN","RAPMW1",93,0)
 S $E(X(6),1,(10+$L(X(1))))="Facility: "_X(1)
"RTN","RAPMW1",94,0)
 S $E(X(6),41,(50+$L(X(2))))="Station: "_X(2)
"RTN","RAPMW1",95,0)
 S $E(X(6),60,(66+$L(X(5))))="VISN: "_X(5)
"RTN","RAPMW1",96,0)
 S RAH3=X(6) ;Facility, Station, VISN
"RTN","RAPMW1",97,0)
 ; Hdr Line 4 -- Division(s)
"RTN","RAPMW1",98,0)
 K RAH4
"RTN","RAPMW1",99,0)
 I '$D(^TMP($J,"RA D-TYPE")) S RAH4(1)="No division selected"
"RTN","RAPMW1",100,0)
 E  D
"RTN","RAPMW1",101,0)
 .S RA1=1,RADIV="" S RAH4(1)="Division(s): "
"RTN","RAPMW1",102,0)
 .F  S RADIV=$O(^TMP($J,"RA D-TYPE",RADIV)) Q:RADIV=""  D
"RTN","RAPMW1",103,0)
 ..S:$L(RAH4(RA1))+$L(RADIV)>RAIOM RA1=RA1+1,$P(RAH4(RA1)," ",14)=""
"RTN","RAPMW1",104,0)
 ..S RAH4(RA1)=RAH4(RA1)_RADIV_$S($O(^TMP($J,"RA D-TYPE",RADIV))]"":", ",1:"")
"RTN","RAPMW1",105,0)
 ..Q
"RTN","RAPMW1",106,0)
 .Q
"RTN","RAPMW1",107,0)
 ; Hdr line 5 -- Exam Date Range
"RTN","RAPMW1",108,0)
 S RAH5="Exam Date Range: "_$$FMTE^XLFDT(RABDATE,"2D")_"-"_$$FMTE^XLFDT(RAEDATE,"2D")
"RTN","RAPMW1",109,0)
 ; Hdr line 6 -- Imaging Type(s) selected
"RTN","RAPMW1",110,0)
 K RAH6
"RTN","RAPMW1",111,0)
 I RANX="P" D
"RTN","RAPMW1",112,0)
 .S RAH6(1)="PROCEDURE TYPES: All" ;*79
"RTN","RAPMW1",113,0)
 .I $O(RAXCLUDE(""))]"" D
"RTN","RAPMW1",114,0)
 ..S RAH6(1)=RAH6(1)_", except "
"RTN","RAPMW1",115,0)
 ..S I="" F  S I=$O(RAXCLUDE(I)) Q:I=""  S RAH6(1)=RAH6(1)_I S:$O(RAXCLUDE(I))]"" RAH6(1)=RAH6(1)_", "
"RTN","RAPMW1",116,0)
 ..Q
"RTN","RAPMW1",117,0)
 .Q
"RTN","RAPMW1",118,0)
 ; Hdr line 7 -- CPT and Proc names
"RTN","RAPMW1",119,0)
 K RAH7 I RANX="C" D  ; *79
"RTN","RAPMW1",120,0)
 .S RAH7(0)="CPT CODES and PROCEDURES: "
"RTN","RAPMW1",121,0)
 .S RA1=1,RA2="",RAH7(1)=RAH7(0)
"RTN","RAPMW1",122,0)
 .F  S RA2=$O(^TMP($J,"RA WAIT1",RA2)) Q:RA2=""  D
"RTN","RAPMW1",123,0)
 ..S RA1=RA1+1
"RTN","RAPMW1",124,0)
 ..S RAH7(RA1)="     "_^TMP($J,"RA WAIT1",RA2)_"  "_RA2
"RTN","RAPMW1",125,0)
 ..Q
"RTN","RAPMW1",126,0)
 .Q
"RTN","RAPMW1",127,0)
 ;Hdr line 8 -- Run Date/Time
"RTN","RAPMW1",128,0)
 S RANOW=$$NOW^XLFDT,RANOW=$E(RANOW,1,12)
"RTN","RAPMW1",129,0)
 S RAH8="Run Date/Time: "_$$FMTE^XLFDT(RANOW,"2P")
"RTN","RAPMW1",130,0)
 Q
"RTN","RAPMW1",131,0)
HD ;
"RTN","RAPMW1",132,0)
 W:$E(IOST,1,2)="C-" @IOF W !?(RAIOM-$L(RAH1)\2),RAH1
"RTN","RAPMW1",133,0)
 W !,"Page: ",RAPG,!
"RTN","RAPMW1",134,0)
 W !,RAH3
"RTN","RAPMW1",135,0)
 S I=0 F  S I=$O(RAH4(I)) Q:'I  W !,RAH4(I)
"RTN","RAPMW1",136,0)
 W !,RAH5
"RTN","RAPMW1",137,0)
 S I=0 F  S I=$O(RAH6(I)) Q:'I  W !,RAH6(I)
"RTN","RAPMW1",138,0)
 S I=0 F  S I=$O(RAH7(I)) Q:'I  W !,RAH7(I) I ($Y+5)>IOSL D PRESS Q:RAXIT  W:$E(IOST,1,2)="C-" @IOF
"RTN","RAPMW1",139,0)
 Q:RAXIT
"RTN","RAPMW1",140,0)
 W !,RAH8
"RTN","RAPMW1",141,0)
 Q
"RTN","RAPMW1",142,0)
HDSUM ;
"RTN","RAPMW1",143,0)
 W !!,"Total number of procedures registered during specified exam date range: ",RATOTAL,!
"RTN","RAPMW1",144,0)
 Q
"RTN","RAPMW1",145,0)
PRTS ;
"RTN","RAPMW1",146,0)
 I RAPG=1 D HD Q:RAXIT  D HDSUM S RAPG=RAPG+1
"RTN","RAPMW1",147,0)
 S I="" F  S I=$O(RACOL(I)) Q:I=""  D
"RTN","RAPMW1",148,0)
 .F J=1:1:5 S RAPCT(I,J)=$S(RATOTAL(I)>0:$J(RACOL(I,J)/RATOTAL(I)*100,5,1),1:$J(0,5,1)),RACOL(I,J)=$J(RACOL(I,J),7)
"RTN","RAPMW1",149,0)
 .S RAAVG(I)=$S(RATOTAL(I)>0:$J(RAWAITD(I)/RATOTAL(I),7,0),1:"")
"RTN","RAPMW1",150,0)
 .I I="unknown",RATOTAL(I)=0 K RATOTAL(I),RACOL(I) Q  ;remove "unknown" row if 0s
"RTN","RAPMW1",151,0)
 .I RANX="C",RATOTAL(I)=0 K RATOTAL(I),RACOL(I) Q  ;remov 0 row if by CPT
"RTN","RAPMW1",152,0)
 .I $D(RAXCLUDE(I)) K RATOTAL(I),RACOL(I) Q  ;remove excluded Proc Type
"RTN","RAPMW1",153,0)
 .S RATOTAL(I)=$J(RATOTAL(I),8)
"RTN","RAPMW1",154,0)
 .Q
"RTN","RAPMW1",155,0)
 W !?30,"DAYS WAIT -- PERCENTAGES",! D COLHDS^RAPMW2(1)
"RTN","RAPMW1",156,0)
 S I="" F  S I=$O(RACOL(I)) Q:I=""  D
"RTN","RAPMW1",157,0)
 .W !,$E($S(I="unknown":""""_I_"""",1:I),1,26),?30,RAPCT(I,1),?40,RAPCT(I,2),?50,RAPCT(I,3),?60,RAPCT(I,4),?70,RAPCT(I,5)
"RTN","RAPMW1",158,0)
 .Q
"RTN","RAPMW1",159,0)
 D PRESS Q:RAXIT
"RTN","RAPMW1",160,0)
 W !!!!?30,"DAYS WAIT -- COUNTS",! D COLHDS^RAPMW2(2)
"RTN","RAPMW1",161,0)
 S I="" F  S I=$O(RACOL(I)) Q:I=""  D
"RTN","RAPMW1",162,0)
 .W !,$E($S(I="unknown":""""_I_"""",1:I),1,26),?27,RACOL(I,1),?34,RACOL(I,2),?41,RACOL(I,3),?48,RACOL(I,4),?55,RACOL(I,5),?62,RATOTAL(I),?69,$S(RAAVG(I)="":"      -",1:RAAVG(I))
"RTN","RAPMW1",163,0)
 .Q
"RTN","RAPMW1",164,0)
 W !!,"Number of procedures cancelled and re-ordered on the same day = ",RASAME
"RTN","RAPMW1",165,0)
 ; *79, deleted display of average wait days
"RTN","RAPMW1",166,0)
 Q
"RTN","RAPMW1",167,0)
FOOTS ;
"RTN","RAPMW1",168,0)
 I RANEG W !!?3,"(There ",$S(RANEG=1:"is",1:"are")," ",RANEG," case",$S(RANEG=1:"",1:"s")," with negative days wait included in the first column.)",!
"RTN","RAPMW1",169,0)
 D PRESS Q:RAXIT  W:$E(IOST,1,2)="C-" @IOF
"RTN","RAPMW1",170,0)
 S RAMAX=$S($D(RATOTAL("unknown")):33,1:28)
"RTN","RAPMW1",171,0)
 F I=1:1:RAMAX Q:RAXIT  W !?4,$P($T(FOOTS2+I),";;",2) I ($Y+5)>IOSL D PRESS Q:RAXIT  W:$E(IOST,1,2)="C-" @IOF
"RTN","RAPMW1",172,0)
 Q
"RTN","RAPMW1",173,0)
PRESS ;
"RTN","RAPMW1",174,0)
 Q:$D(ZTQUEUED)
"RTN","RAPMW1",175,0)
 I IO=IO(0) D
"RTN","RAPMW1",176,0)
 .I $E(IOST,1,2)="C-" R !,"Press RETURN to continue, ""^"" to exit:",RAKEY:DTIME
"RTN","RAPMW1",177,0)
 .S:$G(RAKEY)="^" RAXIT=1
"RTN","RAPMW1",178,0)
 .Q
"RTN","RAPMW1",179,0)
 Q
"RTN","RAPMW1",180,0)
FOOTS2 ;
"RTN","RAPMW1",181,0)
 ;;
"RTN","RAPMW1",182,0)
 ;;1. Cancelled, "No Credit", inpatient cases, and not the highest modality
"RTN","RAPMW1",183,0)
 ;;   of a printset are excluded from this report.  (See 3. below.)
"RTN","RAPMW1",184,0)
 ;;
"RTN","RAPMW1",185,0)
 ;;2. Columns represent # of days wait from the Registered date (the date/
"RTN","RAPMW1",186,0)
 ;;   time entered at the "Imaging Exam Date/Time:" prompt) backwards to the
"RTN","RAPMW1",187,0)
 ;;   Date Desired for the ordered procedure.  The calculation is based on
"RTN","RAPMW1",188,0)
 ;;   the number of different days and not rounded off by hours.  The "31-60"
"RTN","RAPMW1",189,0)
 ;;   column represents those orders that were registered 31 days or more but
"RTN","RAPMW1",190,0)
 ;;   less than 61 days after the Date Desired.
"RTN","RAPMW1",191,0)
 ;;
"RTN","RAPMW1",192,0)
 ;;3. If the user did not select a specific CPT Code or Procedure Name, 
"RTN","RAPMW1",193,0)
 ;;   then the cases from a printset (group of cases that share the same
"RTN","RAPMW1",194,0)
 ;;   report) will have only the case with the highest modality printed.  
"RTN","RAPMW1",195,0)
 ;;   The modalities have this hierarchical order, where (1) is the highest:
"RTN","RAPMW1",196,0)
 ;;   (1) Interventional, (2) MRI, (3) CT, (4) Cardiac Stress test, 
"RTN","RAPMW1",197,0)
 ;;   (5) Nuc Med, (6) US, (7) Mammo, (8) General Rad (9) Other
"RTN","RAPMW1",198,0)
 ;;
"RTN","RAPMW1",199,0)
 ;;4. "Procedure Types" are assigned by a national CPT code look-up table
"RTN","RAPMW1",200,0)
 ;;   and may differ from locally defined "Imaging Types."  Therefore the
"RTN","RAPMW1",201,0)
 ;;   number of procedures in each category may not be the same as other
"RTN","RAPMW1",202,0)
 ;;   radiology management reports.
"RTN","RAPMW1",203,0)
 ;;
"RTN","RAPMW1",204,0)
 ;;5. "Avg. Days" is the average days wait.  It is calculated from the sum
"RTN","RAPMW1",205,0)
 ;;   of the days wait for that Procedure Type, divided by the count of cases
"RTN","RAPMW1",206,0)
 ;;   included in this report for that Procedure Type.  Negative days wait
"RTN","RAPMW1",207,0)
 ;;   is counted as 0.  A "-" means an average cannot be calculated.
"RTN","RAPMW1",208,0)
 ;;
"RTN","RAPMW1",209,0)
 ;;6. Procedure Type of "unknown" refers to either cases that have no 
"RTN","RAPMW1",210,0)
 ;;   matching procedure type in the spreadsheet of CPT Codes provided
"RTN","RAPMW1",211,0)
 ;;   by the Office of Patient Care Services, or cases that are missing
"RTN","RAPMW1",212,0)
 ;;   data for the procedure.
"RTN","RAPMW1",213,0)
 ;;
"RTN","RAPMW2")
0^4^B76504533^B67754959
"RTN","RAPMW2",1,0)
RAPMW2 ;HOIFO/SWM-Radiology Wait Time reports ;12/05/05 13:41
"RTN","RAPMW2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**67,79,83**;Mar 16, 1998;Build 4
"RTN","RAPMW2",3,0)
 ; IA 10063 allows check for Task Stop Request
"RTN","RAPMW2",4,0)
 ; detail
"RTN","RAPMW2",5,0)
 Q
"RTN","RAPMW2",6,0)
STORDET ;
"RTN","RAPMW2",7,0)
 S RAREC=""
"RTN","RAPMW2",8,0)
 S RACNL=$E(RAXDT,4,5)_$E(RAXDT,6,7)_$E(RAXDT,2,3)_"-"_+RACN0 ;long CN
"RTN","RAPMW2",9,0)
 S RA71REC=$G(^RAMIS(71,+$P(RACN0,U,2),0))
"RTN","RAPMW2",10,0)
 S RAXMST=$P(RA72,U) ;exam status name
"RTN","RAPMW2",11,0)
 S RACPT=$P($$NAMCODE^RACPTMSC($P(RA71REC,U,9),RAXDT),U) ;CPT code
"RTN","RAPMW2",12,0)
 S RAPROCNM=$P(RA71REC,U) ;procedure name
"RTN","RAPMW2",13,0)
 S RAPATNM=$$GET1^DIQ(2,RADFN,.01) S:RAPATNM="" RAPATNM=" " ;pt.name
"RTN","RAPMW2",14,0)
 S RAPATNM=$E(RAPATNM,1,12) ;use 1st 12 chars of pat name
"RTN","RAPMW2",15,0)
 S RAPATND=RAPATNM_"-"_RADFN ;patname-DFN
"RTN","RAPMW2",16,0)
 S RADTORD=$P($P(RAOREC,U,16),".") ;date ordered
"RTN","RAPMW2",17,0)
 ; store items in this order -- piece no.;field descrp/
"RTN","RAPMW2",18,0)
 ; 1;pt.name/ 2;long case no./ 3;dt ordered/ 4;dt desired/ 5;exam dt/
"RTN","RAPMW2",19,0)
 ; 6;no. days wait/ 7;exm stat name/ 8;CPT code/ 9; proc name/
"RTN","RAPMW2",20,0)
 ; 10;img typ name/ 11;* if canc & re-ord same day/ 12;Proc Typ Name/
"RTN","RAPMW2",21,0)
 ; 13;"p" if case from print set (highest ranked proc type)
"RTN","RAPMW2",22,0)
 ;
"RTN","RAPMW2",23,0)
 S RAREC=RAPATNM_U_RACNL_U_$E(RADTORD,1,7)_U_$E(RADSDT,1,7)
"RTN","RAPMW2",24,0)
 S RAREC=RAREC_U_$E(RAXDT,1,7)_U_RAWAITD_U_$E(RAXMST,1,11)_U_RACPT
"RTN","RAPMW2",25,0)
 S RAREC=RAREC_U_$E(RAPROCNM,1,45)_U_$E(RAIMGTYP,1,3)_U_$S(RASAME2:"*",1:"")_U_RAPTA
"RTN","RAPMW2",26,0)
 S RAREC=RAREC_U_$S(RACNI=99999:"p",1:"") ;flag printset case picked
"RTN","RAPMW2",27,0)
 ; subscript 3 is the sort value
"RTN","RAPMW2",28,0)
 ; subscripts 4-6 combined should be unique to a case, prevent over-
"RTN","RAPMW2",29,0)
 ;    writing subscript 3 when >1 case has same sort value 
"RTN","RAPMW2",30,0)
 ; subscript 4 is the exam date in Fileman notation
"RTN","RAPMW2",31,0)
 ; subcript 5 is the patient name (1st 12 chars) and DFN
"RTN","RAPMW2",32,0)
 ; subscript 6 is the "P" level ien of file 70
"RTN","RAPMW2",33,0)
 I RASORT="CN" S ^TMP($J,"RA WAIT3",RACNL,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",34,0)
 I RASORT="CPT" S ^TMP($J,"RA WAIT3",RACPT,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",35,0)
 I RASORT="DD" S ^TMP($J,"RA WAIT3",RADSDT,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",36,0)
 I RASORT="D" S ^TMP($J,"RA WAIT3",RAWAITD,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",37,0)
 I RASORT="DO" S ^TMP($J,"RA WAIT3",RADTORD,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",38,0)
 I RASORT="DR" S ^TMP($J,"RA WAIT3",RAXDT,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",39,0)
 I RASORT="I" S ^TMP($J,"RA WAIT3",RAIMGTYP,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",40,0)
 I RASORT="PT" S ^TMP($J,"RA WAIT3",RAPTA,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",41,0)
 I RASORT="PN" S ^TMP($J,"RA WAIT3",RAPATNM,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",42,0)
 I RASORT="PROC" S ^TMP($J,"RA WAIT3",RAPROCNM,RADTE,RAPATND,RACNISAV)=RAREC
"RTN","RAPMW2",43,0)
 Q
"RTN","RAPMW2",44,0)
WRTDET ;
"RTN","RAPMW2",45,0)
 S RAHD0="Detail",RAPG=1
"RTN","RAPMW2",46,0)
 D SETHD^RAPMW1
"RTN","RAPMW2",47,0)
 D PRTD Q:RAXIT
"RTN","RAPMW2",48,0)
 D FOOTD
"RTN","RAPMW2",49,0)
 Q
"RTN","RAPMW2",50,0)
HDDET ;
"RTN","RAPMW2",51,0)
 W !!,"Sorted by: ",RASORTNM,?38,"Print only cases with minimum Days Wait of: ",RASINCE
"RTN","RAPMW2",52,0)
 W !,"Total number of procedures registered during specified exam date range: ",RATOTAL
"RTN","RAPMW2",53,0)
 Q
"RTN","RAPMW2",54,0)
COLHDD ;
"RTN","RAPMW2",55,0)
 I RAPG>1 W @IOF,!,"Page: ",RAPG
"RTN","RAPMW2",56,0)
 S RAPG=RAPG+1
"RTN","RAPMW2",57,0)
 W !!?27,"Date",?36,"Date",?45,"Date",?54,"Days",?59,"Exam",?71,"CPT",?122,"Img",?127,"PROC."
"RTN","RAPMW2",58,0)
 W !,"Patient Name",?14,"Case #",?27,"Ordered",?36,"Desired",?45,"Register",?54,"Wait",?59,"Status",?71,"Code",?77,"Name of Procedure",?122,"Type",?127,"TYPE"
"RTN","RAPMW2",59,0)
 W !,$E(RADASH,1,12),?14,$E(RADASH,1,12),?27,$E(RADASH,1,8),?36,$E(RADASH,1,8),?45,$E(RADASH,1,8),?54,$E(RADASH,1,4),?59,$E(RADASH,1,11),?71,$E(RADASH,1,5),?77,RADASH,?123,$E(RADASH,1,4),?127,$E(RADASH,1,5)
"RTN","RAPMW2",60,0)
 I $D(ZTQUEUED) D STOPCHK^RAUTL9 S:$G(ZTSTOP)=1 RAXIT=1 ;user stopped task
"RTN","RAPMW2",61,0)
 Q
"RTN","RAPMW2",62,0)
PRTD ;
"RTN","RAPMW2",63,0)
 I RATYP="B" D PRESS^RAPMW1 Q:RAXIT
"RTN","RAPMW2",64,0)
 N X
"RTN","RAPMW2",65,0)
 D HD^RAPMW1 Q:RAXIT  D HDDET,COLHDD
"RTN","RAPMW2",66,0)
 S RA0="",RAXIT=0
"RTN","RAPMW2",67,0)
 F  S RA0=$O(^TMP($J,"RA WAIT3",RA0)) Q:RA0=""  Q:RAXIT  S RA1=0 D
"RTN","RAPMW2",68,0)
 .F  S RA1=$O(^TMP($J,"RA WAIT3",RA0,RA1)) Q:'RA1  Q:RAXIT  S RA2=0 D
"RTN","RAPMW2",69,0)
 ..F  S RA2=$O(^TMP($J,"RA WAIT3",RA0,RA1,RA2)) Q:RA2=""  Q:RAXIT  S RA3=0 D
"RTN","RAPMW2",70,0)
 ...F  S RA3=$O(^TMP($J,"RA WAIT3",RA0,RA1,RA2,RA3)) Q:'RA3  Q:RAXIT  S X=^(RA3) D
"RTN","RAPMW2",71,0)
 ....D CKLINE Q:RAXIT
"RTN","RAPMW2",72,0)
 ....W !,$P(X,U),?13,$P(X,U,13),?14,$P(X,U,2),?27,$$FMTE^XLFDT($P(X,U,3),2),?36,$$FMTE^XLFDT($P(X,U,4),2),?45,$$FMTE^XLFDT($P(X,U,5),2),$P(X,U,11),?54,$J($P(X,U,6),4),?59,$P(X,U,7)
"RTN","RAPMW2",73,0)
 ....W ?71,$P(X,U,8),?77,$P(X,U,9),?123,$P(X,U,10),?127,$E($P(X,U,12),1,5)
"RTN","RAPMW2",74,0)
 ....Q
"RTN","RAPMW2",75,0)
 ...Q
"RTN","RAPMW2",76,0)
 ..Q
"RTN","RAPMW2",77,0)
 .Q
"RTN","RAPMW2",78,0)
 Q
"RTN","RAPMW2",79,0)
CKLINE ;
"RTN","RAPMW2",80,0)
 I ($Y+5)>IOSL D
"RTN","RAPMW2",81,0)
 . S RAXIT=$$S^%ZTLOAD("This task was in routine RAPMW2 when it was stopped.") I RAXIT S ZTSTOP=1 Q  ;IA10063
"RTN","RAPMW2",82,0)
 .D PRESS^RAPMW1
"RTN","RAPMW2",83,0)
 .Q:RAXIT
"RTN","RAPMW2",84,0)
 .D COLHDD
"RTN","RAPMW2",85,0)
 .Q
"RTN","RAPMW2",86,0)
 Q
"RTN","RAPMW2",87,0)
FOOTD ;
"RTN","RAPMW2",88,0)
 D PRESS^RAPMW1 Q:RAXIT  W:$E(IOST,1,2)="C-" @IOF
"RTN","RAPMW2",89,0)
 I RANEG W !!?3,"(There ",$S(RANEG=1:"is",1:"are")," ",RANEG," case",$S(RANEG=1:"",1:"s")," with negative days wait included in the listing.)",!
"RTN","RAPMW2",90,0)
 F I=1:1:28 Q:RAXIT  W !?4,$P($T(FOOTD2+I),";;",2) I ($Y+5)>IOSL D PRESS^RAPMW1 Q:RAXIT  W:$E(IOST,1,2)="C-" @IOF
"RTN","RAPMW2",91,0)
 Q
"RTN","RAPMW2",92,0)
CALC ;
"RTN","RAPMW2",93,0)
 S RASAME2=0 ;=1 if exm's order was cancelled & reordered same day
"RTN","RAPMW2",94,0)
 S RAORIEN=$P(RACN0,U,11)
"RTN","RAPMW2",95,0)
 S RAOREC=$G(^RAO(75.1,+RAORIEN,0))
"RTN","RAPMW2",96,0)
 I RAOREC="" S ^TMP($J,"RA WAIT NO ORD",RADFN,RADTI,RACNI)=RAORIEN Q
"RTN","RAPMW2",97,0)
 S RAXDT=9999999.9999-RADTI ; exam date FM format
"RTN","RAPMW2",98,0)
 S RADSDT=$P(RAOREC,U,21) ; Date Desired
"RTN","RAPMW2",99,0)
 I RADSDT="" S ^TMP($J,"RA WAIT NO DSR DT",RADFN,RADTI,RACNI)=RAORIEN Q
"RTN","RAPMW2",100,0)
 S RAWAITD=$$FMDIFF^XLFDT(RAXDT,RADSDT) ;Wait days btw exm & desired dt
"RTN","RAPMW2",101,0)
 S:RAWAITD<0 RANEG=RANEG+1
"RTN","RAPMW2",102,0)
 D STORSUM^RAPMW1 ;store summary counts for Summary, Detail, Both
"RTN","RAPMW2",103,0)
 S RA16=$P(RAOREC,U,16) ; request entered dt/tm
"RTN","RAPMW2",104,0)
 ; count if same proc cancelled and reordered same day
"RTN","RAPMW2",105,0)
 S RA1=$E(RA16,1,7)
"RTN","RAPMW2",106,0)
 ; loop start w Last Activity same date as order's entry date
"RTN","RAPMW2",107,0)
 F  S RA1=$O(^RAO(75.1,"AO",RA1)) Q:'RA1  Q:RA1>RA16  D
"RTN","RAPMW2",108,0)
 .S RA2=0  F  S RA2=$O(^RAO(75.1,"AO",RA1,RA2)) Q:'RA2  Q:RA2=RAORIEN  D
"RTN","RAPMW2",109,0)
 ..S RA3=^RAO(75.1,RA2,0) ;skip exm's order
"RTN","RAPMW2",110,0)
 ..; other order is discontinued,same patient,same ordered procedure
"RTN","RAPMW2",111,0)
 ..I $P(RA3,U,5)=1,$P(RA3,U,1)=RADFN,$P(RA3,U,2)=$P(RAOREC,U,2) S RASAME=RASAME+1,RASAME2=1
"RTN","RAPMW2",112,0)
 ..Q
"RTN","RAPMW2",113,0)
 .Q
"RTN","RAPMW2",114,0)
 ; store detail rows for Detail,Both IF days wait at least = RASINCE
"RTN","RAPMW2",115,0)
 I "B^D"[RATYP,((RAWAITD<0)!(RAWAITD'<RASINCE)) D STORDET
"RTN","RAPMW2",116,0)
 Q
"RTN","RAPMW2",117,0)
PTA ; *79
"RTN","RAPMW2",118,0)
 S RAPRC=$P(RACN0,U,2)
"RTN","RAPMW2",119,0)
 I RAPRC="" S RAPTA="unknown" Q
"RTN","RAPMW2",120,0)
 S RACPTI=+$P($G(^RAMIS(71,+RAPRC,0)),U,9)
"RTN","RAPMW2",121,0)
 S RACPTC=$P($$NAMCODE^RACPTMSC(RACPTI,DT),U)
"RTN","RAPMW2",122,0)
 S RAPTA=$S(RACPTI:$O(^RA(73.2,"B",RACPTC,0)),1:"")
"RTN","RAPMW2",123,0)
 S RAPTA=$P($G(^RA(73.2,+RAPTA,0)),U,2)
"RTN","RAPMW2",124,0)
 S RAPTA=$S(RAPTA="":"unknown",'$D(RACOL(RAPTA)):"unknown",1:RAPTA)
"RTN","RAPMW2",125,0)
 ; RAPTA should match one of the RATOTAL(rapta)
"RTN","RAPMW2",126,0)
 Q
"RTN","RAPMW2",127,0)
COLHDS(X) ; moved from RAPMW1
"RTN","RAPMW2",128,0)
 I X=1 D
"RTN","RAPMW2",129,0)
 .W !,"PROCEDURE",?31,"<=30",?40,"31-60",?50,"61-90",?59,"91-120",?71,">120"
"RTN","RAPMW2",130,0)
 .W !,"TYPE",?31,"Days",?41,"Days",?51,"Days",?61,"Days",?71,"Days"
"RTN","RAPMW2",131,0)
 .W !,"--------------------------",?29,"------",?39,"------",?49,"------",?59,"------",?69,"------"
"RTN","RAPMW2",132,0)
 .Q
"RTN","RAPMW2",133,0)
 I X=2 D
"RTN","RAPMW2",134,0)
 .W !,"PROCEDURE",?30,"<=30",?36,"31-60",?43,"61-90",?50,"91-120",?58,">120",?66,"ROW",?73,"Avg."
"RTN","RAPMW2",135,0)
 .W !,"TYPE",?30,"Days",?37,"Days",?44,"Days",?51,"Days",?58,"Days",?65,"TOTAL",?73,"Days"
"RTN","RAPMW2",136,0)
 .W !,"--------------------------",?28,"------",?35,"------",?42,"------",?49,"------",?56,"------",?64,"------",?72,"-----"
"RTN","RAPMW2",137,0)
 .Q
"RTN","RAPMW2",138,0)
 Q
"RTN","RAPMW2",139,0)
FOOTD2 ;
"RTN","RAPMW2",140,0)
 ;;
"RTN","RAPMW2",141,0)
 ;;1. Cancelled, "No Credit", inpatient cases, and not the highest modality of a printset are excluded from this report.
"RTN","RAPMW2",142,0)
 ;;   (See 3. below.)
"RTN","RAPMW2",143,0)
 ;;
"RTN","RAPMW2",144,0)
 ;;2. The "Days Wait" represent # of days from the Registered date (the date/time entered at the "Imaging Exam Date/Time:" prompt)
"RTN","RAPMW2",145,0)
 ;;   backwards to the Date Desired for the ordered procedure.  The calculation is based on the number of different days and 
"RTN","RAPMW2",146,0)
 ;;   not rounded off by hours.
"RTN","RAPMW2",147,0)
 ;;
"RTN","RAPMW2",148,0)
 ;;3. If the user did not select a specific CPT Code or Procedure Name, then the cases from a printset (group of cases that 
"RTN","RAPMW2",149,0)
 ;;   share the same report) will have only the case with the highest ranked modality printed.  Modalities are ranked 
"RTN","RAPMW2",150,0)
 ;;   in this order, (1) being the highest:
"RTN","RAPMW2",151,0)
 ;;   (1) Interventional, (2) MRI, (3) CT, (4) Cardiac Stress test, (5) Nuc Med, (6) US, (7) Mammo, (8) General Rad (9) Other
"RTN","RAPMW2",152,0)
 ;;   However, all the cases from an examset (group of cases that have separate reports) will all be listed.
"RTN","RAPMW2",153,0)
 ;;
"RTN","RAPMW2",154,0)
 ;;4. "Procedure Types" are assigned by a national CPT code look-up table and may differ from locally defined "Imaging Types."  
"RTN","RAPMW2",155,0)
 ;;   Therefore the number of procedures in each category may not be the same as other radiology management reports.
"RTN","RAPMW2",156,0)
 ;;
"RTN","RAPMW2",157,0)
 ;;5. Procedure Type of "unknown" refers to either cases that have no matching procedure type in the spreadsheet of CPT Codes
"RTN","RAPMW2",158,0)
 ;;   provided by the Office of Patient Care Services, or cases that are missing data for the procedure.
"RTN","RAPMW2",159,0)
 ;;
"RTN","RAPMW2",160,0)
 ;;6. CPT Code is not available for parent and broad procedures in the header section.  CPT Code of the parent order's highest
"RTN","RAPMW2",161,0)
 ;;   ranked modality case will be printed in the line by line section.  (See 3. above.)
"RTN","RAPMW2",162,0)
 ;;
"RTN","RAPMW2",163,0)
 ;;7. Date/Time Registered is the "Imaging Exam Date/Time" entered by the user during Registration.
"RTN","RAPMW2",164,0)
 ;;
"RTN","RAPMW2",165,0)
 ;;8. "*" under the "Date Register" column denotes the request was cancelled and re-ordered on the same day that it was cancelled.
"RTN","RAPMW2",166,0)
 ;;
"RTN","RAPMW2",167,0)
 ;;9. "p" under the "Case #" column, before the case number, denotes printset case with the highest ranked Procedure Type.
"RTN","RASELCT")
0^1^B45378732^B45079381
"RTN","RASELCT",1,0)
RASELCT ;HISC/DAD-Generic file entry selector ;7/1/98  15:48
"RTN","RASELCT",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**83**;Mar 16, 1998;Build 4
"RTN","RASELCT",3,0)
 ;
"RTN","RASELCT",4,0)
 ;*** SELECTS A GROUP OF RECORDS FROM A FILE ***
"RTN","RASELCT",5,0)
 ;
"RTN","RASELCT",6,0)
 ;REQUIRES:
"RTN","RASELCT",7,0)
 ;  RADIC      = FILE NUMBER OR GLOBAL ROOT
"RTN","RASELCT",8,0)
 ;  RADIC(0)   = DIC(0) STRING
"RTN","RASELCT",9,0)
 ;  RAUTIL     = NODE TO STORE DATA UNDER IN ^TMP($J,RAUTIL,
"RTN","RASELCT",10,0)
 ;
"RTN","RASELCT",11,0)
 ;OPTIONAL:
"RTN","RASELCT",12,0)
 ;  RADIC("A") = DIC("A") STRING
"RTN","RASELCT",13,0)
 ;  RADIC("B") = DIC("B") STRING
"RTN","RASELCT",14,0)
 ;  RADIC("S") = DIC("S") STRING
"RTN","RASELCT",15,0)
 ;  RADIC("W") = DIC("W") STRING
"RTN","RASELCT",16,0)
 ;     RAARRY  = LOCAL ARRAY TO STORE DATA IN
"RTN","RASELCT",17,0)
 ;     RAFLD   = field to sort by if valid data to be stored as
"RTN","RASELCT",18,0)
 ;               ^TMP($J,RAUTIL,external value of RAFLD,IEN)=""
"RTN","RASELCT",19,0)
 ;               RAFLD must reside on the zero (0) node to be valid!
"RTN","RASELCT",20,0)
 ;     RAINPUT = ONE/MANY/ALL DISTINCTION (1=ALL, 0=ONE/MANY)
"RTN","RASELCT",21,0)
 ;
"RTN","RASELCT",22,0)
 ;RETURNS:
"RTN","RASELCT",23,0)
 ;  1) RAQUIT     = $S(UP_ARROW_OUT:1 , NOTHING_SELECTED:1 , 1:0)
"RTN","RASELCT",24,0)
 ;  2) ^TMP($J,RAUTIL,EXTERNAL_.01_FIELD_DATA,IEN) = ""
"RTN","RASELCT",25,0)
 ;  3) if $D(RAFLD), ^TMP($J,RAUTIL,EXTERNAL_RAFLD_DATA,IEN) = ""
"RTN","RASELCT",26,0)
 ;
"RTN","RASELCT",27,0)
EN1(RADIC,RAUTIL,RAARRY,RAINPUT,RAFLD) ;
"RTN","RASELCT",28,0)
 S RAQUIT=0 I ($D(RADIC)[0)!($D(RADIC(0))[0)!($D(RAUTIL)[0) S RAQUIT=1 G EXIT
"RTN","RASELCT",29,0)
 I (RADIC="")!(RADIC(0)="")!(RAUTIL="") S RAQUIT=1 G EXIT
"RTN","RASELCT",30,0)
 I $G(RAINPUT)=0 K RADIC("B")
"RTN","RASELCT",31,0)
 D K S DIC=RADIC I DIC S (RADIC,DIC)=$S($D(^DIC(DIC,0,"GL"))#2:^("GL"),1:"") I DIC="" S RAQUIT=1 G EXIT
"RTN","RASELCT",32,0)
 S DIC(0)=RADIC(0),DIC(0)=$TR(DIC(0),"AL") S:DIC(0)'["Z" DIC(0)=DIC(0)_"Z" S RADIC(0)=DIC(0)
"RTN","RASELCT",33,0)
 D DO^DIC1 S RAFNUM=+DO(2),RAFNAME=$P(DO,"^"),RAFLD01=$P(^DD(RAFNUM,.01,0),"^"),RAFSCR=$S($D(DO("SCR"))#2:DO("SCR"),1:"") K DO
"RTN","RASELCT",34,0)
 I $G(RAFLD)]"" S RAQUIT=$$FLD(RAFNUM,RAFLD) G:RAQUIT EXIT
"RTN","RASELCT",35,0)
 S RACASE=$S($E(RAFLD01,($L(RAFLD01)))?1L:"s",1:"S")
"RTN","RASELCT",36,0)
 F X="A","B","S","W" S RADIC(X)=$S($D(RADIC(X))#2:RADIC(X),1:"")
"RTN","RASELCT",37,0)
 S:RADIC("A")="" RADIC("A")="Select "_RAFNAME_" "_RAFLD01_": "
"RTN","RASELCT",38,0)
 S RAALL=0,RANUM=1 K ^TMP($J,RAUTIL) D HOME^%ZIS
"RTN","RASELCT",39,0)
1 D SETDIC W !!,$S(RANUM>1:"Another one (Select/De-Select): ",1:DIC("A")),$S((RANUM=1)&(RADIC("B")]""):RADIC("B")_"// ",1:"")
"RTN","RASELCT",40,0)
 R X:DTIME S:('$T)!($E(X)="^") RAQUIT=1 G:RAQUIT EXIT S:(RANUM=1)&(X="")&(RADIC("B")]"") X=RADIC("B") G:X="" EXIT S RADSEL=$S(X?1"-"1.E:1,1:0) S:RADSEL X=$E(X,2,$L(X))
"RTN","RASELCT",41,0)
 ; RA*5*83 require exactly 3 chars when checking for "ALL"
"RTN","RASELCT",42,0)
 I $L(X),(($L(X)=3&("Aa"[$E(X))&("Ll"[$E(X,2))&("Ll"[$E(X,3)))!(X["*")) D ALL G EXIT:RAQUIT,1:RAALL
"RTN","RASELCT",43,0)
 D HELP:$E(X)="?"
"RTN","RASELCT",44,0)
 I $L($G(DIC("S")))<235 S DIC("S")=$S($G(DIC("S"))]"":DIC("S")_" ",1:"")_"I $$SEL^RASELCT(Y)"
"RTN","RASELCT",45,0)
 D ^DIC K DIC G:+Y'>0 1
"RTN","RASELCT",46,0)
 S RAMASK=+Y
"RTN","RASELCT",47,0)
 I $$CHFLD(RAFNUM)["D" D
"RTN","RASELCT",48,0)
 . N %DT,X
"RTN","RASELCT",49,0)
 . S X=Y(0,0),%DT="ST" D ^%DT S Y(0,0)=Y
"RTN","RASELCT",50,0)
 . Q
"RTN","RASELCT",51,0)
 S Y=RAMASK
"RTN","RASELCT",52,0)
 I $G(RAFLD)']"" D
"RTN","RASELCT",53,0)
 . I 'RADSEL,'$D(^TMP($J,RAUTIL,$E(Y(0,0),1,63),+Y)) S ^(+Y)="",RANUM=RANUM+1
"RTN","RASELCT",54,0)
 . I RADSEL,$D(^TMP($J,RAUTIL,$E(Y(0,0),1,63),+Y)) K ^(+Y) S RANUM=RANUM-$S(RANUM>0:1,1:0)
"RTN","RASELCT",55,0)
 . Q
"RTN","RASELCT",56,0)
 E  D
"RTN","RASELCT",57,0)
 . S RAVALUE=$$FLDSRT(RAFNUM,RAFLD) Q:RAVALUE']""
"RTN","RASELCT",58,0)
 . I 'RADSEL,'$D(^TMP($J,RAUTIL,$E(RAVALUE,1,63),+Y)) S ^(+Y)="",RANUM=RANUM+1
"RTN","RASELCT",59,0)
 . I RADSEL,$D(^TMP($J,RAUTIL,$E(RAVALUE,1,63),+Y)) K ^(+Y) S RANUM=RANUM-$S(RANUM>0:1,1:0)
"RTN","RASELCT",60,0)
 . Q
"RTN","RASELCT",61,0)
 G 1
"RTN","RASELCT",62,0)
EXIT ;
"RTN","RASELCT",63,0)
 I 'RAQUIT,($L($G(RAARRY))),('$D(@RAARRY)) D
"RTN","RASELCT",64,0)
 . S %X="^TMP($J,"""_RAUTIL_""",",%Y=RAARRY_"("
"RTN","RASELCT",65,0)
 . D %XY^%RCR
"RTN","RASELCT",66,0)
 . Q
"RTN","RASELCT",67,0)
 S RAQUIT=$S(RAQUIT:1,$O(^TMP($J,RAUTIL,""))="":1,1:0) K RADIC,RAUTIL
"RTN","RASELCT",68,0)
K K %,%X,%Y,%Z,C,D0,DA,DIC,DIK,DIR,DO,RA,RAALL,RACASE,RAD0,RADSEL,RAFLD01
"RTN","RASELCT",69,0)
 K RAFNAME,RAFNUM,RAFSCR,RALINE,RAMASK,RANUM,RAVALUE,X,Y
"RTN","RASELCT",70,0)
 Q
"RTN","RASELCT",71,0)
ALL ;
"RTN","RASELCT",72,0)
 ;I $G(RAINPUT)=0 Q
"RTN","RASELCT",73,0)
 S RAALL=1 ; Assume the user answers desires ALL entries!
"RTN","RASELCT",74,0)
 N PAT,RAX S RAX=X N X
"RTN","RASELCT",75,0)
 I RAX["*" D
"RTN","RASELCT",76,0)
 . N CHAR,I,TEMP
"RTN","RASELCT",77,0)
 . S PAT="Y'?",TEMP=""
"RTN","RASELCT",78,0)
 . F I=1:1:$L(RAX) D
"RTN","RASELCT",79,0)
 .. S CHAR=$E(RAX,I)
"RTN","RASELCT",80,0)
 .. I CHAR'="*" S TEMP=TEMP_CHAR Q
"RTN","RASELCT",81,0)
 .. D BLDPAT
"RTN","RASELCT",82,0)
 .. Q
"RTN","RASELCT",83,0)
 . D BLDPAT
"RTN","RASELCT",84,0)
 . Q
"RTN","RASELCT",85,0)
 F RAD0=0:0 S RAD0=$O(@(RADIC_"RAD0)")) Q:RAD0'>0  D AL
"RTN","RASELCT",86,0)
 W:RANUM=1&'RADSEL " ??",$C(7)
"RTN","RASELCT",87,0)
 Q
"RTN","RASELCT",88,0)
AL I RAFSCR]"" D SETDIC I $D(@(RADIC_"RAD0,0)"))#2 S (D0,DA,Y)=RAD0 X RAFSCR Q:'$T
"RTN","RASELCT",89,0)
 I RADIC("S")]"" D SETDIC I $D(@(RADIC_"RAD0,0)"))#2 S (D0,DA,Y)=RAD0 X DIC("S") Q:'$T
"RTN","RASELCT",90,0)
 S Y=$P($G(@(RADIC_"RAD0,0)")),"^"),C=$P(^DD(RAFNUM,.01,0),"^",2)
"RTN","RASELCT",91,0)
 Q:Y=""  D Y^DIQ
"RTN","RASELCT",92,0)
 I $$CHFLD(RAFNUM)["D" D
"RTN","RASELCT",93,0)
 . N %DT,X
"RTN","RASELCT",94,0)
 . S X=Y,%DT="ST" D ^%DT
"RTN","RASELCT",95,0)
 . Q
"RTN","RASELCT",96,0)
 I RAX["*",@PAT Q
"RTN","RASELCT",97,0)
 I $G(RAFLD)']"" D
"RTN","RASELCT",98,0)
 . I 'RADSEL,'$D(^TMP($J,RAUTIL,$E(Y,1,63),RAD0)) S ^(RAD0)="",RANUM=RANUM+1
"RTN","RASELCT",99,0)
 . I RADSEL,$D(^TMP($J,RAUTIL,$E(Y,1,63),RAD0)) K ^(RAD0) S RANUM=RANUM-$S(RANUM>0:1,1:0)
"RTN","RASELCT",100,0)
 . Q
"RTN","RASELCT",101,0)
 E  D
"RTN","RASELCT",102,0)
 . N Y S Y=+RAD0,Y(0)=$G(@(RADIC_+Y_",0)")),Y(0,0)=$P(Y(0),"^")
"RTN","RASELCT",103,0)
 . S RAVALUE=$$FLDSRT(RAFNUM,RAFLD) Q:RAVALUE']""
"RTN","RASELCT",104,0)
 . I 'RADSEL,'$D(^TMP($J,RAUTIL,$E(RAVALUE,1,63),RAD0)) S ^(RAD0)="",RANUM=RANUM+1
"RTN","RASELCT",105,0)
 . I RADSEL,$D(^TMP($J,RAUTIL,$E(RAVALUE,1,63),RAD0)) K ^(RAD0) S RANUM=RANUM-$S(RANUM>0:1,1:0)
"RTN","RASELCT",106,0)
 . Q
"RTN","RASELCT",107,0)
 Q
"RTN","RASELCT",108,0)
HELP ;
"RTN","RASELCT",109,0)
 N X S RA="Select a "_RAFNAME_" "_RAFLD01_" from the displayed list." D WRAP
"RTN","RASELCT",110,0)
 W !?5,"To deselect a ",RAFLD01," type a minus sign (-)",!?5,"in front of it, e.g.,  -",RAFLD01,"."
"RTN","RASELCT",111,0)
 I $G(RAINPUT)=1 W !?5,"To get all ",RAFLD01,"S type ALL."
"RTN","RASELCT",112,0)
 W !?5,"Use an asterisk (*) to do a wildcard selection, e.g.,"
"RTN","RASELCT",113,0)
 W !?5,"enter ",RAFLD01,"* to select all entries that begin"
"RTN","RASELCT",114,0)
 W !?5,"with the text '",RAFLD01,"'.  Wildcard selection is"
"RTN","RASELCT",115,0)
 W !?5,"case sensitive."
"RTN","RASELCT",116,0)
 G:$O(^TMP($J,RAUTIL,""))="" HLP
"RTN","RASELCT",117,0)
SHOW S RALINE=$Y,RA="" W !!,"You have already selected:"
"RTN","RASELCT",118,0)
 F  S RA=$O(^TMP($J,RAUTIL,RA)) Q:RA=""!RAQUIT  F RAD0=0:0 S RAD0=$O(^TMP($J,RAUTIL,RA,RAD0)) Q:RAD0'>0!RAQUIT  D SHO
"RTN","RASELCT",119,0)
HLP W ! S RAQUIT=0
"RTN","RASELCT",120,0)
 Q
"RTN","RASELCT",121,0)
SHO I $G(RAFLD)]"" S RA(0)=$P($G(@(RADIC_+RAD0_",0)")),"^")
"RTN","RASELCT",122,0)
 E  S RA(0)=RA
"RTN","RASELCT",123,0)
 I $$CHFLD(RAFNUM)["D" D
"RTN","RASELCT",124,0)
 . N Y
"RTN","RASELCT",125,0)
 . S Y=RA(0) X ^DD("DD") S RA(0)=Y
"RTN","RASELCT",126,0)
 . Q
"RTN","RASELCT",127,0)
 I RADIC(0)["N" W !?3,RAD0,?15,RA(0)
"RTN","RASELCT",128,0)
 E  W !?3,RA(0)
"RTN","RASELCT",129,0)
 D SETDIC I $D(DIC("W"))#2,DIC("W")]"",$D(@(RADIC_"RAD0,0)"))#2 S (D0,DA,Y)=RAD0 X DIC("W")
"RTN","RASELCT",130,0)
 I $Y>(IOSL+RALINE-3) D PAUSE S RALINE=$Y
"RTN","RASELCT",131,0)
 Q
"RTN","RASELCT",132,0)
WRAP ;
"RTN","RASELCT",133,0)
 W ! F  S Y=$L($E(RA,1,IOM-20)," ") W !?5,$P(RA," ",1,Y) S RA=$P(RA," ",Y+1,999) Q:RA=""
"RTN","RASELCT",134,0)
 Q
"RTN","RASELCT",135,0)
PAUSE ;
"RTN","RASELCT",136,0)
 K DIR S DIR(0)="E" D ^DIR K DIR S RAQUIT=$S(Y:0,1:1)
"RTN","RASELCT",137,0)
 Q
"RTN","RASELCT",138,0)
SETDIC ;
"RTN","RASELCT",139,0)
 K DIC,DO S DIC=RADIC
"RTN","RASELCT",140,0)
 F X="0","A","B","S","W" I RADIC(X)]"" S DIC(X)=RADIC(X)
"RTN","RASELCT",141,0)
 D DO^DIC1
"RTN","RASELCT",142,0)
 Q
"RTN","RASELCT",143,0)
CHFLD(X) ;
"RTN","RASELCT",144,0)
 N A
"RTN","RASELCT",145,0)
 S A=$P($G(^DD(X,.01,0)),U,2)
"RTN","RASELCT",146,0)
 Q:A'["P" A
"RTN","RASELCT",147,0)
 F  D  Q:A'["P"
"RTN","RASELCT",148,0)
 . S A=$TR(A,$TR(A,".0123456789"))
"RTN","RASELCT",149,0)
 . S A=$$CHFLD(A)
"RTN","RASELCT",150,0)
 . Q
"RTN","RASELCT",151,0)
 Q A
"RTN","RASELCT",152,0)
SEL(Y) ;
"RTN","RASELCT",153,0)
 N %DT,DA,DIC,DIQ,DR,RAEXTRN,RAPOINT,X
"RTN","RASELCT",154,0)
 S (RAPOINT,DA)=Y,DIC=RAFNUM,DR=.01,DIQ(0)="E",DIQ="RAEXTRN("
"RTN","RASELCT",155,0)
 D EN^DIQ1 S RAEXTRN=$G(RAEXTRN(RAFNUM,RAPOINT,.01,"E"))
"RTN","RASELCT",156,0)
 I $$CHFLD(RAFNUM)["D" S X=RAEXTRN,%DT="ST" D ^%DT S RAEXTRN=Y
"RTN","RASELCT",157,0)
 S X=$D(^TMP($J,RAUTIL,RAEXTRN,RAPOINT))
"RTN","RASELCT",158,0)
 Q $S(X#2&RADSEL:1,X[0&'RADSEL:1,1:0)
"RTN","RASELCT",159,0)
BLDPAT ;
"RTN","RASELCT",160,0)
 I TEMP]"" S PAT=PAT_"1"""_TEMP_""""
"RTN","RASELCT",161,0)
 I CHAR="*",$E(PAT,$L(PAT)-1,$L(PAT))'=".E" S PAT=PAT_".E"
"RTN","RASELCT",162,0)
 S TEMP=""
"RTN","RASELCT",163,0)
 Q
"RTN","RASELCT",164,0)
FLD(RAFNUM,RAFLD) ; Validate if field can be sorted on i.e, if 
"RTN","RASELCT",165,0)
 ; non-multiple and is either a pointer, free text, set of codes,
"RTN","RASELCT",166,0)
 ; numeric or a date/time field.
"RTN","RASELCT",167,0)
 ; 'RAFNUM' = File #           'RAFLD' = Field #
"RTN","RASELCT",168,0)
 ; returns RAPASS: 0 if valid, else 1
"RTN","RASELCT",169,0)
 Q:RAFLD=.01 1 ; .01 field is not valid!
"RTN","RASELCT",170,0)
 Q:'($D(^DD(RAFNUM,RAFLD,0))#2) 1 ; field does not exist
"RTN","RASELCT",171,0)
 N RA,RAPASS S RA(0)=$G(^DD(RAFNUM,RAFLD,0)),RA(2)=$P(RA(0),"^",2)
"RTN","RASELCT",172,0)
 S RA(4)=$P(RA(0),"^",4)
"RTN","RASELCT",173,0)
 Q:+RA(2)>0&($D(^DD(+RA(2),.01,0))) 1 ; field is a multiple, not valid
"RTN","RASELCT",174,0)
 Q:RA(4)'["0;" 1 ; field does not reside on the 0 node, not valid
"RTN","RASELCT",175,0)
 S RAPASS=1 ; set initially to not valid
"RTN","RASELCT",176,0)
 F RA="D","F","N","P","S" S:RA(2)[RA RAPASS=0 Q:'RAPASS
"RTN","RASELCT",177,0)
 Q RAPASS
"RTN","RASELCT",178,0)
FLDSRT(RAFNUM,RAFLD) ; Converts the internal value to the external value
"RTN","RASELCT",179,0)
 ; for sets of codes & pointers.
"RTN","RASELCT",180,0)
 ; 'RAFNUM' = File #           'RAFLD' = Field #
"RTN","RASELCT",181,0)
 ; 'RAPCE'  = piece position on 0 node
"RTN","RASELCT",182,0)
 N RAPCE S RAPCE=$P($P($G(^DD(RAFNUM,RAFLD,0)),"^",4),";",2)
"RTN","RASELCT",183,0)
 Q $$EXTERNAL^DILFD(RAFNUM,RAFLD,"",$P(Y(0),"^",RAPCE))
"VER")
8.0^22.0
"BLD",6544,6)
^71
**END**
**END**
