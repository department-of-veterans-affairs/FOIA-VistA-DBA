EMERGENCY Released PSU*3*30 SEQ #23
Extracted from mail message
**KIDS**:PSU*3.0*30^

**INSTALL NAME**
PSU*3.0*30
"BLD",4444,0)
PSU*3.0*30^PHARMACY BENEFITS MANAGEMENT^0^3030916^y
"BLD",4444,1,0)
^^6^6^3030916^
"BLD",4444,1,1,0)
Problem: The PBM extract element PATIENT STATUS would be set to 'NVA' if 
"BLD",4444,1,2,0)
the SC/A&A/OTHER/INPATIENT/NVA field (#6) were NULL in the RX PATIENT 
"BLD",4444,1,3,0)
STATUS file (#53).
"BLD",4444,1,4,0)
 
"BLD",4444,1,5,0)
Resolution: The code has been changed that for the above condition the 
"BLD",4444,1,6,0)
PBM PATIENT STATUS element will be set to "" (null).
"BLD",4444,4,0)
^9.64PA^^
"BLD",4444,"KRN",0)
^9.67PA^8989.52^19
"BLD",4444,"KRN",.4,0)
.4
"BLD",4444,"KRN",.401,0)
.401
"BLD",4444,"KRN",.402,0)
.402
"BLD",4444,"KRN",.403,0)
.403
"BLD",4444,"KRN",.5,0)
.5
"BLD",4444,"KRN",.84,0)
.84
"BLD",4444,"KRN",3.6,0)
3.6
"BLD",4444,"KRN",3.8,0)
3.8
"BLD",4444,"KRN",9.2,0)
9.2
"BLD",4444,"KRN",9.8,0)
9.8
"BLD",4444,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4444,"KRN",9.8,"NM",1,0)
PSUOP3^^0^B23482532
"BLD",4444,"KRN",9.8,"NM","B","PSUOP3",1)

"BLD",4444,"KRN",19,0)
19
"BLD",4444,"KRN",19.1,0)
19.1
"BLD",4444,"KRN",101,0)
101
"BLD",4444,"KRN",409.61,0)
409.61
"BLD",4444,"KRN",771,0)
771
"BLD",4444,"KRN",870,0)
870
"BLD",4444,"KRN",8989.51,0)
8989.51
"BLD",4444,"KRN",8989.52,0)
8989.52
"BLD",4444,"KRN",8994,0)
8994
"BLD",4444,"KRN","B",.4,.4)

"BLD",4444,"KRN","B",.401,.401)

"BLD",4444,"KRN","B",.402,.402)

"BLD",4444,"KRN","B",.403,.403)

"BLD",4444,"KRN","B",.5,.5)

"BLD",4444,"KRN","B",.84,.84)

"BLD",4444,"KRN","B",3.6,3.6)

"BLD",4444,"KRN","B",3.8,3.8)

"BLD",4444,"KRN","B",9.2,9.2)

"BLD",4444,"KRN","B",9.8,9.8)

"BLD",4444,"KRN","B",19,19)

"BLD",4444,"KRN","B",19.1,19.1)

"BLD",4444,"KRN","B",101,101)

"BLD",4444,"KRN","B",409.61,409.61)

"BLD",4444,"KRN","B",771,771)

"BLD",4444,"KRN","B",870,870)

"BLD",4444,"KRN","B",8989.51,8989.51)

"BLD",4444,"KRN","B",8989.52,8989.52)

"BLD",4444,"KRN","B",8994,8994)

"BLD",4444,"QUES",0)
^9.62^^
"BLD",4444,"REQB",0)
^9.611^1^1
"BLD",4444,"REQB",1,0)
PSU*3.0*28^2
"BLD",4444,"REQB","B","PSU*3.0*28",1)

"MBREQ")
0
"PKG",367,-1)
1^1
"PKG",367,0)
PHARMACY BENEFITS MANAGEMENT^PSU^PHARMACY BENEFITS MANAGEMENT
"PKG",367,20,0)
^9.402P^^
"PKG",367,22,0)
^9.49I^1^1
"PKG",367,22,1,0)
3.0^2981015^2981030^11595
"PKG",367,22,1,"PAH",1,0)
30^3030916
"PKG",367,22,1,"PAH",1,1,0)
^^6^6^3030916
"PKG",367,22,1,"PAH",1,1,1,0)
Problem: The PBM extract element PATIENT STATUS would be set to 'NVA' if 
"PKG",367,22,1,"PAH",1,1,2,0)
the SC/A&A/OTHER/INPATIENT/NVA field (#6) were NULL in the RX PATIENT 
"PKG",367,22,1,"PAH",1,1,3,0)
STATUS file (#53).
"PKG",367,22,1,"PAH",1,1,4,0)
 
"PKG",367,22,1,"PAH",1,1,5,0)
Resolution: The code has been changed that for the above condition the 
"PKG",367,22,1,"PAH",1,1,6,0)
PBM PATIENT STATUS element will be set to "" (null).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSUOP3")
0^1^B23482532
"RTN","PSUOP3",1,0)
PSUOP3 ;BIR/CFL,TJH,PDW-PSU PBM Outpatient Pharmacy shared variables for vers. 6 & 7 ;08/25/2003
"RTN","PSUOP3",2,0)
 ;;3.0;PHARMACY BENEFITS MANAGEMENT;**14,19,20,28,30**;Oct 15, 1998
"RTN","PSUOP3",3,0)
 ;
"RTN","PSUOP3",4,0)
 ; Reference to file #7 supported by DBIA 2495
"RTN","PSUOP3",5,0)
 ; Reference to file #50 supported by DBIA 221
"RTN","PSUOP3",6,0)
 ; Reference to file #53 supported by DBIA 2511
"RTN","PSUOP3",7,0)
 ; Reference to file #59 supported by DBIA 2510
"RTN","PSUOP3",8,0)
 ; Reference to file #200 supported by DBIA 10060
"RTN","PSUOP3",9,0)
 ; Reference to file #49  supported by DBIA 10093
"RTN","PSUOP3",10,0)
 ; Reference to file #52  supported by DBIA 2512
"RTN","PSUOP3",11,0)
 ;
"RTN","PSUOP3",12,0)
PROVDR ;Get provider data, site number and AMIS category
"RTN","PSUOP3",13,0)
 S PSUSITE=$S(PSUDIVP="":PSUSNDR,1:$$VALI^PSUTL(59,PSUDIVP,.06))
"RTN","PSUOP3",14,0)
 ;
"RTN","PSUOP3",15,0)
 ;Create storage global of division numbers and names for lab msgs.
"RTN","PSUOP3",16,0)
 S X=PSUSITE,DIC=59,DIC(0)="XM" D ^DIC
"RTN","PSUOP3",17,0)
 S X=+Y,PSUDIVNM=$$VAL^PSUTL(59,X,.01)
"RTN","PSUOP3",18,0)
 S ^XTMP("PSU_"_PSUJOB,"DIV",PSUSITE)=PSUDIVNM
"RTN","PSUOP3",19,0)
 ;
"RTN","PSUOP3",20,0)
GETVAR ;Get shared variables
"RTN","PSUOP3",21,0)
 ;Get AMIS workload category
"RTN","PSUOP3",22,0)
 S PSUPST=$$VALI^PSUTL(53,PSURXP,6)
"RTN","PSUOP3",23,0)
 S PSUSC=$S(PSUPST=1:"SC",PSUPST=2:"AA",PSUPST=3:"OT",PSUPST=4:"IP",1:"")
"RTN","PSUOP3",24,0)
 S:$$GET1^DIQ(52,PSURXIEN,201)="YES" PSUSC="NVA"
"RTN","PSUOP3",25,0)
 K PSUPROV
"RTN","PSUOP3",26,0)
 D GETS^PSUTL(200,PSUPRID,"9;29;53.5;53.6","PSUPROV","I")
"RTN","PSUOP3",27,0)
 I '$D(PSUPROV) D NOPROV Q
"RTN","PSUOP3",28,0)
 D MOVEI^PSUTL("PSUPROV")
"RTN","PSUOP3",29,0)
 S PSUPRSSN=PSUPROV(9)
"RTN","PSUOP3",30,0)
 I PSUPRSSN="" S PSUPRSSN=999999999
"RTN","PSUOP3",31,0)
 S ^XTMP("PSU_"_PSUJOB,"PSUPDR",PSUPRSSN,PSUPRID)=""
"RTN","PSUOP3",32,0)
 S PSUDOC(9)=PSUPRSSN
"RTN","PSUOP3",33,0)
 S PSUPTYP=$S(PSUPROV(53.6)=4:"F",1:"S")
"RTN","PSUOP3",34,0)
 S:$$GET1^DIQ(52,PSURXIEN,201)="YES" PSUPTYP="NVA"
"RTN","PSUOP3",35,0)
 S PSUPCLS="" I PSUPROV(53.5)'="" D
"RTN","PSUOP3",36,0)
 .S PSUPCLS=$$VALI^PSUTL(7,PSUPROV(53.5),1)
"RTN","PSUOP3",37,0)
 .I PSUPCLS="" S PSUPCLS=$$VALI^PSUTL(7,PSUPROV(53.5),.01)
"RTN","PSUOP3",38,0)
 S PSUPSV=$S($L(PSUPROV(29)):$$VAL^PSUTL(49,PSUPROV(29),.01),1:"")
"RTN","PSUOP3",39,0)
 S PSUPSV=$$UPPER^PSUTL(PSUPSV),PSUPSERV=""
"RTN","PSUOP3",40,0)
 I $L(PSUPSV),$D(PSECT(PSUPSV)) S PSUPSERV=PSECT(PSUPSV)
"RTN","PSUOP3",41,0)
 S PSUSPTY=$$GET^XUA4A72(PSUPRID,PSUFDT)
"RTN","PSUOP3",42,0)
 S PSUSP1=$P(PSUSPTY,U,3),PSUSP2=$P(PSUSPTY,U,4)
"RTN","PSUOP3",43,0)
 ;
"RTN","PSUOP3",44,0)
 Q
"RTN","PSUOP3",45,0)
 ;
"RTN","PSUOP3",46,0)
NOPROV ; set up PSUPROV array when provider isn't found in ^VA(200
"RTN","PSUOP3",47,0)
 F I=9,29,53.5,53.6 S PSUPROV(I)=""
"RTN","PSUOP3",48,0)
 S (PSUPRSSN,PSUPTYP,PSUPCLS,PSUPSERV,PSUSP1,PSUSP2)=""
"RTN","PSUOP3",49,0)
 Q
"RTN","PSUOP3",50,0)
GETDRUG ;Get drug data
"RTN","PSUOP3",51,0)
 K PSUDRUG
"RTN","PSUOP3",52,0)
 D GETS^PSUTL(50,PSUDR,".01;2;3;14.5;20;21;22;25;31;51;52","PSUDRUG","I")
"RTN","PSUOP3",53,0)
 D MOVEI^PSUTL("PSUDRUG")
"RTN","PSUOP3",54,0)
 I '$D(PSUDRUG) F I=.01,2,3,14.5,20,21,22,25,31,51,52 S PSUDRUG(I)=""
"RTN","PSUOP3",55,0)
 S PSUGNM=PSUDRUG(.01)
"RTN","PSUOP3",56,0)
 I PSUGNM="" S PSUGNM="Unknown Generic Name"
"RTN","PSUOP3",57,0)
 S PSUVANM=PSUDRUG(21)
"RTN","PSUOP3",58,0)
 I PSUVANM="" S PSUVANM="Unknown VA Product Name"
"RTN","PSUOP3",59,0)
 S PSUDEA=PSUDRUG(3)
"RTN","PSUOP3",60,0)
 S PSUNFI=$S(PSUDRUG(51)=1:"N/F",1:"")
"RTN","PSUOP3",61,0)
 S PSUDUN=PSUDRUG(14.5)
"RTN","PSUOP3",62,0)
 S PSUVACLS=PSUDRUG(2)
"RTN","PSUOP3",63,0)
 S PSUNDCL=PSUDRUG(22)
"RTN","PSUOP3",64,0)
 S PSUNAF=$S(PSUDRUG(52):"N/F",1:"")
"RTN","PSUOP3",65,0)
 S PSUNADR=PSUDRUG(20)
"RTN","PSUOP3",66,0)
 ;Get the National Formulary Indicator and Restriction
"RTN","PSUOP3",67,0)
 S (PSOPNFI,PSOPNFR)=""
"RTN","PSUOP3",68,0)
 I $$VERSION^XPDUTL("PSN")'<4 D
"RTN","PSUOP3",69,0)
 .S PSOPNFI=$$FORMI^PSNAPIS(PSUNADR,PSUNDCL)
"RTN","PSUOP3",70,0)
 .S PSOPNFR=$$FORMR^PSNAPIS(PSUNADR,PSUNDCL)
"RTN","PSUOP3",71,0)
GETDRUGQ Q
"RTN","PSUOP3",72,0)
 ;
"RTN","PSUOP3",73,0)
SETREC ;Set the record into the ^XTMP global
"RTN","PSUOP3",74,0)
 S:PSUDIVP="" PSUDIVP=PSUSNDR
"RTN","PSUOP3",75,0)
 S REC1="^",REC2="*",PSU2U="^"
"RTN","PSUOP3",76,0)
 S REC1=REC1_$TR(PSUSITE,"^","'")_PSU2U_$TR(PSUFD,"^","'")_PSU2U
"RTN","PSUOP3",77,0)
 S REC1=REC1_$TR(PSURELDT,"^","'")_PSU2U_$TR(PSURXN,"^","'")_PSU2U
"RTN","PSUOP3",78,0)
 S REC1=REC1_$TR(PSUSC,"^","'")_PSU2U_PSUSSN_PSU2U_$TR(PSUVANM,"^","'")_PSU2U
"RTN","PSUOP3",79,0)
 S REC1=REC1_$TR(PSUVACLS,"^","'")_PSU2U_$TR(PSUGNM,"^","'")_PSU2U
"RTN","PSUOP3",80,0)
 S REC1=REC1_$TR(PSUNDC,"^","'")_PSU2U_$TR(PSUNFI,"^","'")_PSU2U
"RTN","PSUOP3",81,0)
 S REC1=REC1_$TR(PSOPNFI,"^","'")_PSU2U_$TR(PSOPNFR,"^","'")_PSU2U
"RTN","PSUOP3",82,0)
 S REC1=REC1_$TR(PSUDEA,"^","'")_PSU2U_$TR(PSUTYP,"^","'")_PSU2U
"RTN","PSUOP3",83,0)
 S REC1=REC1_$TR(PSUCMOP,"^","'")_PSU2U_$TR(PSUMW,"^","'")_PSU2U
"RTN","PSUOP3",84,0)
 S REC1=REC1_$TR(PSUPRSSN,"^","'")_PSU2U_$TR(PSUPTYP,"^","'")_PSU2U
"RTN","PSUOP3",85,0)
 ;S REC1=REC1_$TR(PSUPCLS,"^","'")_PSU2U_$TR(PSUPSERV,"^","'")_PSU2U
"RTN","PSUOP3",86,0)
 ;S REC2=REC2_$TR(PSUSP1,"^","'")_PSU2U_$TR(PSUSP2,"^","'")_PSU2U
"RTN","PSUOP3",87,0)
 S REC2=REC2_$TR(PSUSIG,"^","'")_PSU2U_$TR(PSUWPC,"^","'")_PSU2U
"RTN","PSUOP3",88,0)
 S REC2=REC2_$TR(PSUDUN,"^","'")_PSU2U_$TR(PSUDRCT,"^","'")_PSU2U
"RTN","PSUOP3",89,0)
 S REC2=REC2_$TR(PSUDS,"^","'")_PSU2U_$TR(PSUQTY,"^","'")_PSU2U_PSUNAF_U
"RTN","PSUOP3",90,0)
 D ICN^PSUIV1 S PSUPICN=$P($G(^XTMP("PSU_"_PSUJOB,"PSUPICN")),U,1)
"RTN","PSUOP3",91,0)
 S REC2=REC2_$G(PSUPICN)_PSU2U_PSUPRID_PSU2U_$G(PSUCAN)_"^"
"RTN","PSUOP3",92,0)
 S PSURCT=1+$P($G(^XTMP(PSUOPSUB,"DATA",PSUSITE,PSURXIEN,0)),U,1)
"RTN","PSUOP3",93,0)
 S ^XTMP(PSUOPSUB,"DATA",PSUSITE,PSURXIEN,PSURCT,1)=REC1
"RTN","PSUOP3",94,0)
 S ^XTMP(PSUOPSUB,"DATA",PSUSITE,PSURXIEN,PSURCT,2)=REC2
"RTN","PSUOP3",95,0)
 S $P(^XTMP(PSUOPSUB,"DATA",PSUSITE,PSURXIEN,0),U,1)=PSURCT
"RTN","PSUOP3",96,0)
 I (($E(OPVER)=6)&(PSUTYP="P"))!($E(OPVER)>6) S ^XTMP(PSUOPSUB,"RXIEN",PSURXIEN)=""
"RTN","PSUOP3",97,0)
 I '$D(^XTMP("PSU_"_PSUJOB,"PSUOPFLG")) D
"RTN","PSUOP3",98,0)
 .D LAB^PSULR0("OP",PSUSITE,PSURXIEN,DFN,PSUGNM,PSUVACLS)
"RTN","PSUOP3",99,0)
SUMDRUG ; total drug info for summary report
"RTN","PSUOP3",100,0)
 S PSUVARS="PSUTPART,PSUTFIL,PSUTRFIL,PSUTCST,PSUTQTY"
"RTN","PSUOP3",101,0)
 S PSUREC=$G(^XTMP(PSUOPSUB,"DRUG",PSUSITE,PSUGNM,PSUCMOP))
"RTN","PSUOP3",102,0)
 F I=1:1:5 S @$P(PSUVARS,",",I)=+$P(PSUREC,U,I)
"RTN","PSUOP3",103,0)
 I PSUTYP="P" S PSUTPART=PSUTPART+1
"RTN","PSUOP3",104,0)
 I PSUTYP="N" S PSUTFIL=PSUTFIL+1
"RTN","PSUOP3",105,0)
 I PSUTYP="R" S PSUTRFIL=PSUTRFIL+1
"RTN","PSUOP3",106,0)
 S PSUTQTY=PSUQTY+PSUTQTY
"RTN","PSUOP3",107,0)
 S PSUTCST=(PSUDRCT*PSUQTY)+PSUTCST
"RTN","PSUOP3",108,0)
 S REC=PSUTPART_U_PSUTFIL_U_PSUTRFIL_U_$J(PSUTCST,0,2)_U_$J(PSUTQTY,0,2)
"RTN","PSUOP3",109,0)
 S $P(REC,U,6)=$S(PSUNFI="N/F":"*",1:"")
"RTN","PSUOP3",110,0)
 S $P(REC,U,7)=$S(PSOPNFI="0":"#",1:"")
"RTN","PSUOP3",111,0)
 S ^XTMP(PSUOPSUB,"DRUG",PSUSITE,PSUGNM,PSUCMOP)=REC
"RTN","PSUOP3",112,0)
 Q
"VER")
8.0^22.0
**END**
**END**
