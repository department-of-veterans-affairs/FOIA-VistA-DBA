Released OR*3*172 SEQ #192
Extracted from mail message
**KIDS**:OR*3.0*172^

**INSTALL NAME**
OR*3.0*172
"BLD",4190,0)
OR*3.0*172^ORDER ENTRY/RESULTS REPORTING^0^3040316^y
"BLD",4190,1,0)
^^1^1^3031204^^^^
"BLD",4190,1,1,0)
Refer to the patch description on the patch message.
"BLD",4190,4,0)
^9.64PA^^0
"BLD",4190,"ABNS",0)
^9.66A^^
"BLD",4190,"ABPKG")
n^y^G.LABTEST@ISC-SLC.VA.GOV
"BLD",4190,"INI")

"BLD",4190,"INIT")

"BLD",4190,"KRN",0)
^9.67PA^8989.52^20
"BLD",4190,"KRN",.4,0)
.4
"BLD",4190,"KRN",.401,0)
.401
"BLD",4190,"KRN",.402,0)
.402
"BLD",4190,"KRN",.403,0)
.403
"BLD",4190,"KRN",.5,0)
.5
"BLD",4190,"KRN",.84,0)
.84
"BLD",4190,"KRN",3.6,0)
3.6
"BLD",4190,"KRN",3.8,0)
3.8
"BLD",4190,"KRN",9.2,0)
9.2
"BLD",4190,"KRN",9.8,0)
9.8
"BLD",4190,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4190,"KRN",9.8,"NM",1,0)
ORWLR1^^0^B14133992
"BLD",4190,"KRN",9.8,"NM",2,0)
ORWLR2^^0^B64042431
"BLD",4190,"KRN",9.8,"NM",3,0)
ORCXPND3^^0^B36830502
"BLD",4190,"KRN",9.8,"NM",4,0)
ORCXPND1^^0^B65408417
"BLD",4190,"KRN",9.8,"NM","B","ORCXPND1",4)

"BLD",4190,"KRN",9.8,"NM","B","ORCXPND3",3)

"BLD",4190,"KRN",9.8,"NM","B","ORWLR1",1)

"BLD",4190,"KRN",9.8,"NM","B","ORWLR2",2)

"BLD",4190,"KRN",19,0)
19
"BLD",4190,"KRN",19,"NM",0)
^9.68A^^
"BLD",4190,"KRN",19.1,0)
19.1
"BLD",4190,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4190,"KRN",101,0)
101
"BLD",4190,"KRN",101,"NM",0)
^9.68A^1^1
"BLD",4190,"KRN",101,"NM",1,0)
ORS BLOOD BANK^^0
"BLD",4190,"KRN",101,"NM","B","ORS BLOOD BANK",1)

"BLD",4190,"KRN",409.61,0)
409.61
"BLD",4190,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",4190,"KRN",771,0)
771
"BLD",4190,"KRN",869.2,0)
869.2
"BLD",4190,"KRN",870,0)
870
"BLD",4190,"KRN",8989.51,0)
8989.51
"BLD",4190,"KRN",8989.52,0)
8989.52
"BLD",4190,"KRN",8994,0)
8994
"BLD",4190,"KRN","B",.4,.4)

"BLD",4190,"KRN","B",.401,.401)

"BLD",4190,"KRN","B",.402,.402)

"BLD",4190,"KRN","B",.403,.403)

"BLD",4190,"KRN","B",.5,.5)

"BLD",4190,"KRN","B",.84,.84)

"BLD",4190,"KRN","B",3.6,3.6)

"BLD",4190,"KRN","B",3.8,3.8)

"BLD",4190,"KRN","B",9.2,9.2)

"BLD",4190,"KRN","B",9.8,9.8)

"BLD",4190,"KRN","B",19,19)

"BLD",4190,"KRN","B",19.1,19.1)

"BLD",4190,"KRN","B",101,101)

"BLD",4190,"KRN","B",409.61,409.61)

"BLD",4190,"KRN","B",771,771)

"BLD",4190,"KRN","B",869.2,869.2)

"BLD",4190,"KRN","B",870,870)

"BLD",4190,"KRN","B",8989.51,8989.51)

"BLD",4190,"KRN","B",8989.52,8989.52)

"BLD",4190,"KRN","B",8994,8994)

"BLD",4190,"QUES",0)
^9.62^^
"BLD",4190,"REQB",0)
^9.611^4^2
"BLD",4190,"REQB",2,0)
OR*3.0*85^2
"BLD",4190,"REQB",4,0)
OR*3.0*188^2
"BLD",4190,"REQB","B","OR*3.0*188",4)

"BLD",4190,"REQB","B","OR*3.0*85",2)

"KRN",101,1686,-1)
0^1
"KRN",101,1686,0)
ORS BLOOD BANK^Blood Bank Report^^A^^^^^^^^ORDER ENTRY/RESULTS REPORTING
"KRN",101,1686,1,0)
^101.06^1^1^3030116^^^
"KRN",101,1686,1,1,0)
This protocol prints blood bank reports for the patient
"KRN",101,1686,20)
W !!,"Gets Patient Blood Bank Report."
"KRN",101,1686,99)
59367,34672
"KRN",101,1686,101.05,0)
^101.05I^20^1
"KRN",101,1686,101.05,20,0)
20
"KRN",101,1686,101.05,20,1)
D REPORT^ORWLR1 S ORSSTFLG=1
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
172^3040316^5
"PKG",110,22,1,"PAH",1,1,0)
^^1^1^3040316
"PKG",110,22,1,"PAH",1,1,1,0)
Refer to the patch description on the patch message.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","ORCXPND1")
0^4^B65408417
"RTN","ORCXPND1",1,0)
ORCXPND1 ; SLC/MKB - Expanded Display cont ; 02/20/2003
"RTN","ORCXPND1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**26,67,75,89,92,94,148,159,188,172**;Dec 17, 1997
"RTN","ORCXPND1",3,0)
 ;
"RTN","ORCXPND1",4,0)
 ; External References
"RTN","ORCXPND1",5,0)
 ;   DBIA  2387  ^LAB(60
"RTN","ORCXPND1",6,0)
 ;   DBIA  3420  ^DPT(  file #2
"RTN","ORCXPND1",7,0)
 ;   DBIA 10035  ^DPT(  file #2
"RTN","ORCXPND1",8,0)
 ;   DBIA 10037  EN^DGRPD
"RTN","ORCXPND1",9,0)
 ;   DBIA   700  DIS^DGRPDB
"RTN","ORCXPND1",10,0)
 ;   DBIA  2926  RT^GMRCGUIA
"RTN","ORCXPND1",11,0)
 ;   DBIA  2925  DT^GMRCSLM2
"RTN","ORCXPND1",12,0)
 ;   DBIA 10146  DISP^IBCNS
"RTN","ORCXPND1",13,0)
 ;   DBIA  2503  RR^LR7OR1
"RTN","ORCXPND1",14,0)
 ;   DBIA  2951  EN1^LR7OSBR
"RTN","ORCXPND1",15,0)
 ;   DBIA  2952  EN^LR7OSMZ0
"RTN","ORCXPND1",16,0)
 ;   DBIA  2400  OEL^PSOORRL
"RTN","ORCXPND1",17,0)
 ;   DBIA  2877  EN3^RAO7PC3
"RTN","ORCXPND1",18,0)
 ;   DBIA  2877  EN30^RAO7PC3
"RTN","ORCXPND1",19,0)
 ;   DBIA  1252  $$OUTPTPR^SDUTL3
"RTN","ORCXPND1",20,0)
 ;   DBIA  1252  $$OUTPTTM^SDUTL3
"RTN","ORCXPND1",21,0)
 ;   DBIA  2832  RPC^TIUSRV
"RTN","ORCXPND1",22,0)
 ;   DBIA 10061  DEM^VADPT
"RTN","ORCXPND1",23,0)
 ;   DBIA 10061  KVAR^VADPT
"RTN","ORCXPND1",24,0)
 ;   DBIA 10061  OAD^VADPT
"RTN","ORCXPND1",25,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","ORCXPND1",26,0)
 ;                       
"RTN","ORCXPND1",27,0)
COVER ; -- Cover Sheet
"RTN","ORCXPND1",28,0)
 N PKG S PKG=$P($G(^TMP("OR",$J,ORTAB,"IDX",NUM)),U,4)
"RTN","ORCXPND1",29,0)
 D ALLERGY^ORCXPND2:PKG="GMRA",NOTES:PKG="TIU"
"RTN","ORCXPND1",30,0)
 Q
"RTN","ORCXPND1",31,0)
NOTES ; -- Progress Notes
"RTN","ORCXPND1",32,0)
 N I,ORY,DATE,AUTHOR,PTLOC,SUBJ K ^TMP("TIUAUDIT",$J)
"RTN","ORCXPND1",33,0)
 D RPC^TIUSRV(.ORY,ID)
"RTN","ORCXPND1",34,0)
 S I=0 F  S I=$O(@ORY@(I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$G(@ORY@(I,0))
"RTN","ORCXPND1",35,0)
 K @ORY
"RTN","ORCXPND1",36,0)
 Q
"RTN","ORCXPND1",37,0)
PROBLEMS ; -- Problem List
"RTN","ORCXPND1",38,0)
 D PL^ORCXPND4
"RTN","ORCXPND1",39,0)
 Q
"RTN","ORCXPND1",40,0)
MEDS ; -- Pharmacy
"RTN","ORCXPND1",41,0)
 ;N NODE,ORIFN
"RTN","ORCXPND1",42,0)
 D OEL^PSOORRL(+ORVP,ID) ;S NODE=$G(^TMP("PS",$J,0)),ORIFN=+$P(NODE,U,11)
"RTN","ORCXPND1",43,0)
 S ID=+$P($G(^TMP("PS",$J,0)),U,11) D ORDERS
"RTN","ORCXPND1",44,0)
 ;D @($S($P($G(^OR(100,ORIFN,0)),U,11)=$O(^ORD(100.98,"B","IV RX",0)):"IV",1:"DRUG")_"^ORCXPND2")
"RTN","ORCXPND1",45,0)
 K ^TMP("PS",$J)
"RTN","ORCXPND1",46,0)
 Q
"RTN","ORCXPND1",47,0)
LABS ; -- Laboratory [RESULTS ONLY for ID=OE order #]
"RTN","ORCXPND1",48,0)
 N ORIFN,X,SUB,TEST,NAME,SS,IDE,IVDT,TST,CCNT,ORCY,IG,TCNT
"RTN","ORCXPND1",49,0)
 K ^TMP("LRRR",$J)
"RTN","ORCXPND1",50,0)
 S ORIFN=+ID,IDE=$G(^OR(100,+ID,4)) Q:'$L(IDE)  ; OE# -> Lab#
"RTN","ORCXPND1",51,0)
 I +IDE  D RR^LR7OR1(+ORVP,IDE) I '$D(^TMP("LRRR",$J,+ORVP)) S $P(IDE,";",1,3)=";;" ;Order possibly purged, reset to lookup on file 63
"RTN","ORCXPND1",52,0)
 I '+IDE,$P(IDE,";",5)  D RR^LR7OR1(+ORVP,,9999999-$P(IDE,";",5),9999999-$P(IDE,";",5),$P(IDE,";",4))
"RTN","ORCXPND1",53,0)
 K ORCY D TEXT^ORQ12(.ORCY,ORIFN,80)
"RTN","ORCXPND1",54,0)
 S IG=0 F  S IG=$O(ORCY(IG)) Q:IG<1  S X=ORCY(IG) D ITEM^ORCXPND(X)
"RTN","ORCXPND1",55,0)
 D BLANK^ORCXPND I '$D(^TMP("LRRR",$J,+ORVP)) S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="No data available." Q
"RTN","ORCXPND1",56,0)
 M TEST=^TMP("LRRR",$J,+ORVP) S CCNT=0,SS=""
"RTN","ORCXPND1",57,0)
 F  S SS=$O(TEST(SS)) Q:SS=""  S IVDT=0 F  S IVDT=$O(TEST(SS,IVDT)) Q:'IVDT  D
"RTN","ORCXPND1",58,0)
 . I SS="BB" D
"RTN","ORCXPND1",59,0)
 .. I $L($T(EN^ORWLR1)),$L($T(CPRS^VBECA3B)) D  Q  ;Transition to VBEC's interface
"RTN","ORCXPND1",60,0)
 ... K ^TMP("ORLRC",$J)
"RTN","ORCXPND1",61,0)
 ... D EN^ORWLR1(DFN)
"RTN","ORCXPND1",62,0)
 ... I '$O(^TMP("ORLRC",$J,0)) S ^TMP("ORLRC",$J,1,0)="",^TMP("ORLRC",$J,2,0)="No Blood Bank report available..."
"RTN","ORCXPND1",63,0)
 ... N I S I=0 F  S I=$O(^TMP("ORLRC",$J,I)) Q:I<1  S X=^(I,0),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND1",64,0)
 ... K ^TMP("ORLRC",$J)
"RTN","ORCXPND1",65,0)
 .. K ^TMP("LRC",$J) D EN1^LR7OSBR(+ORVP) Q:'$D(^TMP("LRC",$J))  D  Q
"RTN","ORCXPND1",66,0)
 ... N I S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I<1  S X=^(I,0),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND1",67,0)
 ... K ^TMP("LRC",$J)
"RTN","ORCXPND1",68,0)
 . I SS="MI" K ^TMP("LRC",$J) D EN^LR7OSMZ0(+ORVP) Q:'$D(^TMP("LRC",$J))  D  Q
"RTN","ORCXPND1",69,0)
 .. N I S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I<1  S X=^(I,0),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND1",70,0)
 .. K ^TMP("LRC",$J)
"RTN","ORCXPND1",71,0)
 . I SS="CH" D  Q
"RTN","ORCXPND1",72,0)
 .. S (TCNT,TST)=0 F  S TST=$O(TEST(SS,IVDT,TST)) Q:TST=""  S CCNT=0,TCNT=TCNT+1 D
"RTN","ORCXPND1",73,0)
 ... I TCNT=1 D
"RTN","ORCXPND1",74,0)
 .... S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="   Collection time:          "_$$FMTE^XLFDT(9999999-IVDT,1)
"RTN","ORCXPND1",75,0)
 .... S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$$S(1,CCNT," ")_$$S(3,CCNT,"Test Name")_$$S(29,CCNT,"Result")_$$S(39,CCNT,"Units")_$$S(55,CCNT,"Range") D:$D(IOUON) SETVIDEO^ORCXPND(LCNT,1,70,IOUON,IOUOFF)
"RTN","ORCXPND1",76,0)
 ... I TST S X=TEST(SS,IVDT,TST),CCNT=0 I +X D
"RTN","ORCXPND1",77,0)
 .... S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$$S(1,CCNT,$P(^LAB(60,+X,0),U))_$$S(26,CCNT,$J($P(X,U,2),7))_$$S(34,CCNT,$S($L($P(X,U,3)):$P(X,U,3),1:""))_$$S(39,CCNT,$P(X,U,4))_$$S(45,CCNT,$J($P(X,U,5),15))
"RTN","ORCXPND1",78,0)
 .... I $L($P(X,U,3)),$D(IOINHI) D SETVIDEO^ORCXPND(LCNT,26,8,IOINHI,IOINORM)
"RTN","ORCXPND1",79,0)
 .... I $P(X,U,3)["*",$D(IOBON),$D(IOINHI) D SETVIDEO^ORCXPND(LCNT,26,8,IOBON_IOINHI,IOBOFF_IOINORM)
"RTN","ORCXPND1",80,0)
 ... I TST="N" S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=" Comments: " D
"RTN","ORCXPND1",81,0)
 .... N CMT S CMT=0 F  S CMT=$O(TEST(SS,IVDT,"N",CMT)) Q:'CMT  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=" "_TEST(SS,IVDT,"N",CMT)
"RTN","ORCXPND1",82,0)
 K ^TMP("LRRR",$J)
"RTN","ORCXPND1",83,0)
 Q
"RTN","ORCXPND1",84,0)
 ;
"RTN","ORCXPND1",85,0)
DELAY ; -- Delayed Orders
"RTN","ORCXPND1",86,0)
NEW ; -- New Orders
"RTN","ORCXPND1",87,0)
ORDERS ; -- Orders
"RTN","ORCXPND1",88,0)
 I '$G(ORESULTS) D ORDERS^ORCXPND2 Q
"RTN","ORCXPND1",89,0)
 ; -- Results Display (Add more packages as available)
"RTN","ORCXPND1",90,0)
 N PKG,TAB,ORIFN
"RTN","ORCXPND1",91,0)
 S PKG=+$P($G(^OR(100,+ID,0)),"^",14),PKG=$$NMSP^ORCD(PKG)
"RTN","ORCXPND1",92,0)
 S TAB=$S(PKG="LR":"LABS",PKG="GMRC":"CONSULTS",PKG="RA":"XRAYS",1:"")
"RTN","ORCXPND1",93,0)
 I '$L(TAB)!(ID'>0) D  Q  ; no display available
"RTN","ORCXPND1",94,0)
 . N ORY,I D TEXT^ORQ12(.ORY,+ID,80)
"RTN","ORCXPND1",95,0)
 . S I=0 F  S I=$O(ORY(I)) Q:I'>0  D ITEM^ORCXPND(ORY(I))
"RTN","ORCXPND1",96,0)
 . D BLANK^ORCXPND
"RTN","ORCXPND1",97,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="There are no results to report."
"RTN","ORCXPND1",98,0)
 I $O(^OR(100,+ID,2,0)) S ORIFN=+ID,ID=0 F  S ID=$O(^OR(100,ORIFN,2,ID)) Q:ID<1  I $D(^OR(100,ID,0)) D @TAB
"RTN","ORCXPND1",99,0)
 I '$O(^OR(100,+ID,2,0)) D @TAB
"RTN","ORCXPND1",100,0)
 Q
"RTN","ORCXPND1",101,0)
REPORTS ; -- Patient Profiles
"RTN","ORCXPND1",102,0)
 D EN^ORCXPNDR ; Reports
"RTN","ORCXPND1",103,0)
 Q
"RTN","ORCXPND1",104,0)
CONSULTS ; -- Consults
"RTN","ORCXPND1",105,0)
 N I,X,SUB,ORTX ;,VALMAR
"RTN","ORCXPND1",106,0)
 I $G(ORTAB)="CONSULTS" S X=$P($G(^TMP("OR",$J,ORTAB,"IDX",NUM)),U,4)
"RTN","ORCXPND1",107,0)
 E  D TEXT^ORQ12(.ORTX,+ID) S X=ORTX(1),ID=+$G(^OR(100,+ID,4)) ; OE->GMRC order#
"RTN","ORCXPND1",108,0)
 D ITEM^ORCXPND(X),BLANK^ORCXPND
"RTN","ORCXPND1",109,0)
 I ID'>0 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="No data available." Q
"RTN","ORCXPND1",110,0)
 I '$G(ORESULTS) D  ;DT action
"RTN","ORCXPND1",111,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Consult No.:           "_ID
"RTN","ORCXPND1",112,0)
 . N GMRCOER S GMRCOER=2 D DT^GMRCSLM2(ID) S SUB="DT"
"RTN","ORCXPND1",113,0)
 I $G(ORESULTS) D RT^GMRCGUIA(ID,"^TMP(""GMRCR"",$J,""RT"")") S SUB="RT"
"RTN","ORCXPND1",114,0)
 S I=0 F  S I=$O(^TMP("GMRCR",$J,SUB,I)) Q:I'>0  S X=$G(^(I,0)),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND1",115,0)
 K ^TMP("GMRCR",$J)
"RTN","ORCXPND1",116,0)
 Q
"RTN","ORCXPND1",117,0)
XRAYS ; -- Radiology
"RTN","ORCXPND1",118,0)
 I '$G(ORESULTS) S ID=+ORVP_U_$TR(ID,"-","^") D EN3^RAO7PC3(ID)
"RTN","ORCXPND1",119,0)
 I $G(ORESULTS) S ID=+$G(^OR(100,+ID,4)) D EN30^RAO7PC3(ID)
"RTN","ORCXPND1",120,0)
 N CASE,PROC,PSET S PSET=$D(^TMP($J,"RAE3",+ORVP,"PRINT_SET"))
"RTN","ORCXPND1",121,0)
 S CASE=0 F  S CASE=$O(^TMP($J,"RAE3",+ORVP,CASE)) Q:CASE'>0  D
"RTN","ORCXPND1",122,0)
 . I PSET S PROC=$O(^TMP($J,"RAE3",+ORVP,CASE,"")) D ITEM^ORCXPND(PROC) Q
"RTN","ORCXPND1",123,0)
 . S PROC="" F  S PROC=$O(^TMP($J,"RAE3",+ORVP,CASE,PROC)) Q:PROC=""  D ITEM^ORCXPND(PROC),BLANK^ORCXPND,XRPT,BLANK^ORCXPND
"RTN","ORCXPND1",124,0)
 I PSET S CASE=$O(^TMP($J,"RAE3",+ORVP,0)),PROC=$O(^(CASE,"")) D BLANK^ORCXPND,XRPT,BLANK^ORCXPND ;printset=list all procs, then one report
"RTN","ORCXPND1",125,0)
 K ^TMP($J,"RAE3",+ORVP),^UTILITY($J,"W")
"RTN","ORCXPND1",126,0)
 S VALM("RM")=81
"RTN","ORCXPND1",127,0)
 Q
"RTN","ORCXPND1",128,0)
 ;
"RTN","ORCXPND1",129,0)
XRPT ; -- Body of Report for CASE, PROC
"RTN","ORCXPND1",130,0)
 N ORD,X,I
"RTN","ORCXPND1",131,0)
 S ORD=$S($L($G(^TMP($J,"RAE3",+ORVP,"ORD"))):^("ORD"),$L($G(^("ORD",CASE))):^(CASE),1:"") I $L(ORD),ORD'=PROC S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Proc Ord: "_ORD
"RTN","ORCXPND1",132,0)
 S I=1 F  S I=$O(^TMP($J,"RAE3",+ORVP,CASE,PROC,I)) Q:I'>0  S X=^(I),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X ;Skip pt ID on line 1
"RTN","ORCXPND1",133,0)
 Q
"RTN","ORCXPND1",134,0)
 ;
"RTN","ORCXPND1",135,0)
SUMMRIES ; -- Discharge Summaries
"RTN","ORCXPND1",136,0)
 N I,ORY,DATE,AUTHOR,PTLOC,SUBJ K ^TMP("TIUAUDIT",$J)
"RTN","ORCXPND1",137,0)
 D RPC^TIUSRV(.ORY,ID)
"RTN","ORCXPND1",138,0)
 S I=0 F  S I=$O(@ORY@(I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$G(@ORY@(I,0))
"RTN","ORCXPND1",139,0)
 K @ORY
"RTN","ORCXPND1",140,0)
 Q
"RTN","ORCXPND1",141,0)
PTINQ ; Print Patient Inquiry in List Manager
"RTN","ORCXPND1",142,0)
 N DFN,ORI,X
"RTN","ORCXPND1",143,0)
 S DFN=+ORVP
"RTN","ORCXPND1",144,0)
 D DGINQ(DFN)
"RTN","ORCXPND1",145,0)
 S ORI=4,LCNT=0
"RTN","ORCXPND1",146,0)
 F  S ORI=$O(^TMP("ORDATA",$J,1,ORI)) Q:'ORI  S X=^(ORI) D
"RTN","ORCXPND1",147,0)
 . S LCNT=LCNT+1
"RTN","ORCXPND1",148,0)
 . S ^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND1",149,0)
 K ^TMP("ORDATA",$J,1)
"RTN","ORCXPND1",150,0)
 Q
"RTN","ORCXPND1",151,0)
 ;
"RTN","ORCXPND1",152,0)
DGINQ(DFN) ; Patient Inquiry
"RTN","ORCXPND1",153,0)
 D START^ORWRP(80,"DGINQB^ORCXPND1(DFN)")
"RTN","ORCXPND1",154,0)
 Q
"RTN","ORCXPND1",155,0)
DGINQB(DFN) ; Build Patient Inquiry
"RTN","ORCXPND1",156,0)
 N ORDOC,ORTEAM,ORVP,XQORNOD,ORSSTRT,ORSSTOP,X,VAOA
"RTN","ORCXPND1",157,0)
 S ORVP=DFN_";DPT(",XQORNOD=1
"RTN","ORCXPND1",158,0)
 D EN^DGRPD ; MAS Patient Inquiry
"RTN","ORCXPND1",159,0)
 ;
"RTN","ORCXPND1",160,0)
 S ORDOC=$$OUTPTPR^SDUTL3(DFN)
"RTN","ORCXPND1",161,0)
 S ORTEAM=$$OUTPTTM^SDUTL3(DFN)
"RTN","ORCXPND1",162,0)
 I ORDOC!ORTEAM  D
"RTN","ORCXPND1",163,0)
 . W !!,"Primary Care Information:"
"RTN","ORCXPND1",164,0)
 . I ORDOC W !,"Primary Practitioner:  ",$P(ORDOC,"^",2)
"RTN","ORCXPND1",165,0)
 . I ORTEAM W !,"Primary Care Team:     ",$P(ORTEAM,"^",2)
"RTN","ORCXPND1",166,0)
 W !!,"Health Insurance Information:"
"RTN","ORCXPND1",167,0)
 D DISP^IBCNS
"RTN","ORCXPND1",168,0)
 W !!,"Service Connection/Rated Disabilities:"
"RTN","ORCXPND1",169,0)
 D DIS^DGRPDB
"RTN","ORCXPND1",170,0)
 D OAD^VADPT ;   Get NOK Information
"RTN","ORCXPND1",171,0)
 I VAOA(9)]"" D
"RTN","ORCXPND1",172,0)
 . W !!,"Next of Kin Information:"
"RTN","ORCXPND1",173,0)
 . W !,"Name:  ",VAOA(9)                          ;     NOK Name
"RTN","ORCXPND1",174,0)
 . I VAOA(10)]"" W " (",VAOA(10),")"              ;     Relationship
"RTN","ORCXPND1",175,0)
 . I VAOA(1)]"" W !?7,VAOA(1)                     ;     Address Line 1
"RTN","ORCXPND1",176,0)
 . I VAOA(2)]"" W !?7,VAOA(2)                     ;     Line 2
"RTN","ORCXPND1",177,0)
 . I VAOA(3)]"" W !?7,VAOA(3)                     ;     Line 3
"RTN","ORCXPND1",178,0)
 . I VAOA(4)]"" D
"RTN","ORCXPND1",179,0)
 . . W !?7,VAOA(4)                                ;     City
"RTN","ORCXPND1",180,0)
 . . I VAOA(5)]"" W ", "_$P(VAOA(5),"^",2)        ;     State
"RTN","ORCXPND1",181,0)
 . . W "  ",$P(VAOA(11),"^",2)                    ;     Zip+4
"RTN","ORCXPND1",182,0)
 . I VAOA(8)]"" W !!?7,"Phone number:  ",VAOA(8)  ;     Phone
"RTN","ORCXPND1",183,0)
 . I $P($G(^DPT(DFN,.21)),U,11)]"" W !?7,"Work phone number:  ",$P(^DPT(DFN,.21),U,11)
"RTN","ORCXPND1",184,0)
 D KVAR^VADPT
"RTN","ORCXPND1",185,0)
 Q
"RTN","ORCXPND1",186,0)
TRIM(X) ;   Trim Spaces
"RTN","ORCXPND1",187,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","ORCXPND1",188,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","ORCXPND1",189,0)
 Q X
"RTN","ORCXPND1",190,0)
S(X,Y,Z) ; Pad Over
"RTN","ORCXPND1",191,0)
 ;   X=Column #
"RTN","ORCXPND1",192,0)
 ;   Y=Current Length
"RTN","ORCXPND1",193,0)
 ;   Z=Text
"RTN","ORCXPND1",194,0)
 ;   SP=Text Sent
"RTN","ORCXPND1",195,0)
 ;   CCNT=Line Position After Input Text
"RTN","ORCXPND1",196,0)
 I '$D(Z) Q ""
"RTN","ORCXPND1",197,0)
 N SP S SP=Z I X,Y,X>Y S SP=$E("                                                                             ",1,X-Y)_Z
"RTN","ORCXPND1",198,0)
 S CCNT=$$INC(CCNT,SP)
"RTN","ORCXPND1",199,0)
 Q SP
"RTN","ORCXPND1",200,0)
INC(X,Y) ; Character Position Count
"RTN","ORCXPND1",201,0)
 ;   X=Current Count
"RTN","ORCXPND1",202,0)
 ;   Y=Text
"RTN","ORCXPND1",203,0)
 N INC S INC=X+$L(Y)
"RTN","ORCXPND1",204,0)
 Q INC
"RTN","ORCXPND3")
0^3^B36830502
"RTN","ORCXPND3",1,0)
ORCXPND3 ; SLC/MKB,dcm - Expanded display of Reports ;2/21/01  14:07
"RTN","ORCXPND3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**25,30,43,85,172**;Dec 17, 1997
"RTN","ORCXPND3",3,0)
LRA ; -- Anatomic Pathology Report
"RTN","ORCXPND3",4,0)
 N DFN,Y,I,LRLLOC,LRQ
"RTN","ORCXPND3",5,0)
 D TIT^ORCXPNDR("Anatomic Path Report") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",6,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",7,0)
 D RPT^ORWRP(.Y,ID,3)
"RTN","ORCXPND3",8,0)
 D ITEM^ORCXPND("Anatomic Path Report")
"RTN","ORCXPND3",9,0)
 S I=3 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("ORDATA",$J,1,I)
"RTN","ORCXPND3",10,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",11,0)
 Q
"RTN","ORCXPND3",12,0)
 ;
"RTN","ORCXPND3",13,0)
LRAA ; -- Alternate Anatomic Path Report
"RTN","ORCXPND3",14,0)
 N DFN,Y,I,LRLLOC,LRQ
"RTN","ORCXPND3",15,0)
 D TIT^ORCXPNDR("Alternate Anatomic Path Report") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",16,0)
 D PREP^ORCXPNDR I $$OS^ORCXPNDR() Q
"RTN","ORCXPND3",17,0)
 D AP^LR7OSUM(ID)
"RTN","ORCXPND3",18,0)
 D ITEM^ORCXPND("Anatomic Pathology Report")
"RTN","ORCXPND3",19,0)
 I '$O(^TMP("LRC",$J,0)) S ^TMP("LRC",$J,1,0)="No Anatomic Pathology reports available..."
"RTN","ORCXPND3",20,0)
 S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I<1  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("LRC",$J,I,0)
"RTN","ORCXPND3",21,0)
 K ^TMP("LRC",$J)
"RTN","ORCXPND3",22,0)
 Q
"RTN","ORCXPND3",23,0)
LRB1 ; -- Blood Bank Report
"RTN","ORCXPND3",24,0)
 N DFN,Y,I,LRBLOOD,LRCAPA,LRDT0,LRLABKY,LRLLOC,LRO,LRPCEVSO,LRPLASMA,LRSERUM,LRT,LRUNKNOW,LRURINE,LRVIDO,LRVIDOF
"RTN","ORCXPND3",25,0)
 D TIT^ORCXPNDR("Blood Bank Report") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",26,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",27,0)
 D RPT^ORWRP(.Y,ID,2)
"RTN","ORCXPND3",28,0)
 D ITEM^ORCXPND("Blood Bank Report")
"RTN","ORCXPND3",29,0)
 S I=5 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("ORDATA",$J,1,I)
"RTN","ORCXPND3",30,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",31,0)
 Q
"RTN","ORCXPND3",32,0)
 ;
"RTN","ORCXPND3",33,0)
LRB ; -- A better Blood Bank Report
"RTN","ORCXPND3",34,0)
 N DFN,ORY,I,SUBHEAD
"RTN","ORCXPND3",35,0)
 D TIT^ORCXPNDR("Blood Bank Report")
"RTN","ORCXPND3",36,0)
 S DFN=ID
"RTN","ORCXPND3",37,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",38,0)
 I $L($T(EN^ORWLR1)),$L($T(CPRS^VBECA3B)) D  Q  ;Transition to VBEC's interface
"RTN","ORCXPND3",39,0)
 . K ^TMP("ORLRC",$J)
"RTN","ORCXPND3",40,0)
 . D EN^ORWLR1(DFN)
"RTN","ORCXPND3",41,0)
 . I '$O(^TMP("ORLRC",$J,0)) S ^TMP("ORLRC",$J,1,0)="",^TMP("ORLRC",$J,2,0)="No Blood Bank report available..."
"RTN","ORCXPND3",42,0)
 . D ITEM^ORCXPND("Blood Bank Report"),BLANK^ORCXPND
"RTN","ORCXPND3",43,0)
 . S I=0 F  S I=$O(^TMP("ORLRC",$J,I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("ORLRC",$J,I,0)
"RTN","ORCXPND3",44,0)
 . K ^TMP("ORLRC",$J)
"RTN","ORCXPND3",45,0)
 S SUBHEAD("BLOOD BANK")=""
"RTN","ORCXPND3",46,0)
 D EN^LR7OSUM(.ORY,DFN,,,,,.SUBHEAD)
"RTN","ORCXPND3",47,0)
 I '$O(^TMP("LRC",$J,0)) S ^TMP("LRC",$J,1,0)="No Blood Bank report available..."
"RTN","ORCXPND3",48,0)
 D ITEM^ORCXPND("Blood Bank Report"),BLANK^ORCXPND
"RTN","ORCXPND3",49,0)
 S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("LRC",$J,I,0)
"RTN","ORCXPND3",50,0)
 K ^TMP("LRC",$J),^TMP("LRH",$J)
"RTN","ORCXPND3",51,0)
 Q
"RTN","ORCXPND3",52,0)
LRC ; -- Lab Cumulative
"RTN","ORCXPND3",53,0)
 N DFN,ORY,I,BEG,END,OREND,ORSSTRT,ORSSTOP
"RTN","ORCXPND3",54,0)
 D TIT^ORCXPNDR("Lab Cumulative")
"RTN","ORCXPND3",55,0)
 S DFN=ID
"RTN","ORCXPND3",56,0)
 D RANGE($S($G(ORWARD):7,1:180)) Q:OREND  S BEG=+ORSSTRT,END=+ORSSTOP
"RTN","ORCXPND3",57,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",58,0)
 D EN^LR7OSUM(.ORY,DFN,BEG,END)
"RTN","ORCXPND3",59,0)
 D ITEM^ORCXPND("Lab Cumulative"),BLANK^ORCXPND
"RTN","ORCXPND3",60,0)
 S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I'>0  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=^TMP("LRC",$J,I,0)
"RTN","ORCXPND3",61,0)
 K ^TMP("LRC",$J),^TMP("LRH",$J)
"RTN","ORCXPND3",62,0)
 Q
"RTN","ORCXPND3",63,0)
 ;
"RTN","ORCXPND3",64,0)
LRG ; -- Graph Lab Tests
"RTN","ORCXPND3",65,0)
 N DFN,Y,I,X,BCNT,LRSS,LRCW,LRFLAG,LRCTRL,LRNSET,N,LOW,LRPCEVSO,LRPRAC,LRRB,LRTREA,LRVIDO,LRVIDOF,OREND,ORSSTRT,ORSSTOP
"RTN","ORCXPND3",66,0)
 D TIT^ORCXPNDR("Graph Lab Tests") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",67,0)
 D RANGE($S($G(ORWARD):7,1:180)) Q:OREND
"RTN","ORCXPND3",68,0)
 S LRSS="CH",LRCW=8,LRFLAG="",LRCTRL=0,(LRNSET,N)=80
"RTN","ORCXPND3",69,0)
 D L2^LRDIST4 Q:'$D(LRTEST)
"RTN","ORCXPND3",70,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",71,0)
 D RPT^ORWRP(.Y,ID,8,,,,+ORSSTRT,+ORSSTOP)
"RTN","ORCXPND3",72,0)
 D ITEM^ORCXPND("Lab Graph")
"RTN","ORCXPND3",73,0)
 S I=4,BCNT=0
"RTN","ORCXPND3",74,0)
 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S X=^(I) D
"RTN","ORCXPND3",75,0)
 . I '$L(X) S BCNT=BCNT+1 I BCNT>1 Q
"RTN","ORCXPND3",76,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X S:$L(X) BCNT=0
"RTN","ORCXPND3",77,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",78,0)
 Q
"RTN","ORCXPND3",79,0)
 ;
"RTN","ORCXPND3",80,0)
LRI ; -- Interim Lab Results
"RTN","ORCXPND3",81,0)
 N ORX,DFN,Y,I,X,BCNT,LREDT,LRIDT,LRLLT,LRPCEVSO,LRPRAC,LRRB,LRTREA,LRVIDO,LRVIDOF,OREND,ORSSTRT,ORSSTOP
"RTN","ORCXPND3",82,0)
 D TIT^ORCXPNDR("Lab Interim Results") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",83,0)
 D RANGE($S($G(ORWARD):7,1:180)) Q:OREND
"RTN","ORCXPND3",84,0)
 D SET^LRRP4
"RTN","ORCXPND3",85,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",86,0)
 D RPT^ORWRP(.Y,ID,3,,,,+ORSSTRT,+ORSSTOP)
"RTN","ORCXPND3",87,0)
 D ITEM^ORCXPND("Lab Interim Report")
"RTN","ORCXPND3",88,0)
 S I=0,BCNT=0
"RTN","ORCXPND3",89,0)
 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S X=^(I) D
"RTN","ORCXPND3",90,0)
 . I '$L(X) S BCNT=BCNT+1 I BCNT>1 Q
"RTN","ORCXPND3",91,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X S:$L(X) BCNT=0
"RTN","ORCXPND3",92,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",93,0)
 Q
"RTN","ORCXPND3",94,0)
LRGEN ;Lab Results by Test
"RTN","ORCXPND3",95,0)
 N DFN,Y,I,II,X,BCNT,LRPRETTY,LREDT,LRLLT,LRPCEVSO,LRPRAC,LRRB,LRTREA,LRVIDO,LRVIDOF,LRCW,LREND,LRTP,LRIX,LRWPL,LRIDT,LRSC,DIC,LRTSTS,LRORD,LRTEST,LRSUB,LRHDR,LRSSP,LRHI,LRLO
"RTN","ORCXPND3",96,0)
 N LBL,LRBLOOD,LRDAT,LRDFN,LRDPF,LRDT0,LREX,LRFFLG,LRFOOT,LRLAB,LRLABKY,LRND,LRNG,LRNOP,LRNOTE,LRODT0,LRONESPC,LRONETST,LRPAGE,LRPARAM,LRPLASMA,LRPP,LRSERUM,LRPS,LRTN,LRUNKNOW,LRURINE,LRWRD,LRX,LRY
"RTN","ORCXPND3",97,0)
 N AGE,I,INC,LRIDT1,LRSV,OREND,ORSSTRT,ORSSTOP
"RTN","ORCXPND3",98,0)
 K ^TMP("LR",$J)
"RTN","ORCXPND3",99,0)
 D TIT^ORCXPNDR("Lab Results by Test") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",100,0)
 D RANGE($S($G(ORWARD):7,1:180)) Q:OREND
"RTN","ORCXPND3",101,0)
 D SET^LRGEN
"RTN","ORCXPND3",102,0)
 Q:LREND!'LRTSTS
"RTN","ORCXPND3",103,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",104,0)
 D RPT^ORWRP(.Y,ID,16,,,,+ORSSTRT,+ORSSTOP)
"RTN","ORCXPND3",105,0)
 D ITEM^ORCXPND("Lab Results by Test")
"RTN","ORCXPND3",106,0)
 S I=1,BCNT=0
"RTN","ORCXPND3",107,0)
 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S X=^(I) D
"RTN","ORCXPND3",108,0)
 . I '$L(X) S BCNT=BCNT+1 I BCNT>1 Q
"RTN","ORCXPND3",109,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X S:$L(X) BCNT=0
"RTN","ORCXPND3",110,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",111,0)
 Q
"RTN","ORCXPND3",112,0)
 ;
"RTN","ORCXPND3",113,0)
STAT ; -- Lab test status
"RTN","ORCXPND3",114,0)
 N DFN,Y,I,X,BCNT,OREND,ORSSTRT,ORSSTOP
"RTN","ORCXPND3",115,0)
 D TIT^ORCXPNDR("Lab Test Status") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",116,0)
 D RANGE($S($G(ORWARD):7,1:180)) Q:$G(OREND)
"RTN","ORCXPND3",117,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",118,0)
 D RPT^ORWRP(.Y,ID,9,,,,+ORSSTRT,+ORSSTOP)
"RTN","ORCXPND3",119,0)
 D ITEM^ORCXPND("Lab Test Status")
"RTN","ORCXPND3",120,0)
 S I=0,BCNT=0
"RTN","ORCXPND3",121,0)
 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S X=$S($D(^(I))#2:^(I),$D(^(I,0))#2:^(0),1:"") D
"RTN","ORCXPND3",122,0)
 . I '$L(X) S BCNT=BCNT+1 I BCNT>1 Q
"RTN","ORCXPND3",123,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X S:$L(X) BCNT=0
"RTN","ORCXPND3",124,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",125,0)
 Q
"RTN","ORCXPND3",126,0)
RANGE(BEG) ;Get date range for report
"RTN","ORCXPND3",127,0)
 ;BEG=# of days (T-BEG) for start default
"RTN","ORCXPND3",128,0)
 ;Output: ORSSTRT=Start date/time
"RTN","ORCXPND3",129,0)
 ;        ORSSTOP=Stop date/time
"RTN","ORCXPND3",130,0)
 ;        OREND=1 if user '^'s out, so look for it!
"RTN","ORCXPND3",131,0)
 S BEG=$$FMADD^XLFDT(DT,-$G(BEG)),END=$$NOW^XLFDT
"RTN","ORCXPND3",132,0)
 D RANGE^ORPRS01(BEG,END)
"RTN","ORCXPND3",133,0)
 Q
"RTN","ORCXPND3",134,0)
MED(MED) ; -- Medicine Summary of Patient Procedures
"RTN","ORCXPND3",135,0)
 N DFN,Y,I,X,BCNT,OREND,PROCID
"RTN","ORCXPND3",136,0)
 D TIT^ORCXPNDR("Summary of Patient Procedures") Q:$$OS^ORCXPNDR()
"RTN","ORCXPND3",137,0)
 D PREP^ORCXPNDR
"RTN","ORCXPND3",138,0)
 S DFN=+ID,PROCID=$P(MED,"~",2)
"RTN","ORCXPND3",139,0)
 D RPT^ORWRP(.Y,DFN,19,,,PROCID)
"RTN","ORCXPND3",140,0)
 D ITEM^ORCXPND("Summary of Patient Procedures")
"RTN","ORCXPND3",141,0)
 S I=4,BCNT=0
"RTN","ORCXPND3",142,0)
 F  S I=$O(^TMP("ORDATA",$J,1,I)) Q:I<1  S X=^(I) D
"RTN","ORCXPND3",143,0)
 . I '$L(X) S BCNT=BCNT+1 I BCNT>1 Q
"RTN","ORCXPND3",144,0)
 . I $E(X,1,4)="Pg. " Q
"RTN","ORCXPND3",145,0)
 . I X["PHYSICIANS' SIGNATURE" Q
"RTN","ORCXPND3",146,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X S:$L(X) BCNT=0
"RTN","ORCXPND3",147,0)
 K ^TMP("ORDATA",$J)
"RTN","ORCXPND3",148,0)
 Q
"RTN","ORWLR1")
0^1^B14133992
"RTN","ORWLR1",1,0)
ORWLR1 ; slc/dcm -  VBEC Blood Bank Report ;01/16/03  15:02
"RTN","ORWLR1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**172**;Dec 17, 1997
"RTN","ORWLR1",3,0)
 ;Re-write of ^LR7OSBR
"RTN","ORWLR1",4,0)
EN(DFN) ;Get Blood Bank Report
"RTN","ORWLR1",5,0)
 Q:'$G(DFN)
"RTN","ORWLR1",6,0)
 N GCNT,CCNT,GIOSL,GIOM,ORABORH,PATID,PATNAM,PATDOB,ORN
"RTN","ORWLR1",7,0)
 S PATID="`"_DFN,PATNAM=$P(^DPT(DFN,0),"^"),PATDOB=$P(^(0),"^",3) ;Why PATNAM and PATDOB???
"RTN","ORWLR1",8,0)
 K ^TMP("ORLRC",$J)
"RTN","ORWLR1",9,0)
 S GCNT=0,CCNT=1,GIOSL=999999,GIOM=80
"RTN","ORWLR1",10,0)
 S ORABORH=$$ABORH^VBECA1(PATID,PATNAM,PATDOB) ;Get ABO/RH
"RTN","ORWLR1",11,0)
 S ORN(2.91)="DIRECT AHG TEST COMMENT",ORN(8)="ANTIBODY SCREEN COMMENT"
"RTN","ORWLR1",12,0)
 S ORN(10.3)="ABO TESTING COMMENT",ORN(11.3)="RH TESTING COMMENT"
"RTN","ORWLR1",13,0)
 D EN^ORWLR2
"RTN","ORWLR1",14,0)
 Q
"RTN","ORWLR1",15,0)
 ;
"RTN","ORWLR1",16,0)
REPORT ;Blood Bank Report for M reports menu
"RTN","ORWLR1",17,0)
 Q:'$G(DFN)
"RTN","ORWLR1",18,0)
 N DIC,ID,ORDFN,ORY,PAGE,XQORNOD
"RTN","ORWLR1",19,0)
 S ORDFN=DFN,ID=2
"RTN","ORWLR1",20,0)
 D BLR^ORWRP1(.ORY,.ORDFN,.ID,.ORALPHA,.OROMEGA,.ORDAYSBK,.REMOTE)
"RTN","ORWLR1",21,0)
 Q:'$L(ORY)
"RTN","ORWLR1",22,0)
 S PAGE=1
"RTN","ORWLR1",23,0)
 D HEAD^ORWRPP1(ORDFN,PAGE,"PATIENT BLOOD BANK REPORT",$G(STATION))
"RTN","ORWLR1",24,0)
 D HURL^ORWRPP1(.ORY,ORDFN,"PATIENT BLOOD BANK REPORT",,,1)
"RTN","ORWLR1",25,0)
 Q
"RTN","ORWLR1",26,0)
TEST ;Test calls
"RTN","ORWLR1",27,0)
 N ORVP,PATID,PATNAM,PATDOB,LRDFN,ERR,ABORH,ID,ID1,ID2,ARR,GMI,DI2,BPN,VBECERR
"RTN","ORWLR1",28,0)
 D EN2^ORUDPA
"RTN","ORWLR1",29,0)
 Q:'ORVP
"RTN","ORWLR1",30,0)
 K ^TMP("BBD",$J),^TMP("TRRX",$J),^TMP("TRAN",$J)
"RTN","ORWLR1",31,0)
 S PATID="`"_+ORVP,PATNAM=ORPNM,PATDOB=$P(^DPT(+ORVP,0),"^",3)
"RTN","ORWLR1",32,0)
 D PAT^VBECA1A W !,LRDFN I $O(VBECERR(0)) S ERR=0 F  S ERR=$O(VBECERR(ERR)) Q:'ERR  W !?5," ERR:"_VBECERR(1)
"RTN","ORWLR1",33,0)
 S ABORH=$$ABORH^VBECA1(PATID,PATNAM,PATDOB) W !,"ABO/RH: "_ABORH
"RTN","ORWLR1",34,0)
 D ABID^VBECA1(PATID,PATNAM,PATDOB,.PARENT,.ARR) I $O(ARR("ABID",0)) D
"RTN","ORWLR1",35,0)
 . W !,"Antibodies Identified: " S ID=0 F  S ID=$O(ARR("ABID",ID)) Q:'ID  W !?2,ARR("ABID",ID)
"RTN","ORWLR1",36,0)
 D TRRX^VBECA1(PATID,PATNAM,PATDOB,.PARENT,.ARR) I $O(ARR("TRRX",0)) D
"RTN","ORWLR1",37,0)
 . W !,"Transfusion reactions: " S ID=0 F  S ID=$O(ARR("TRRX",ID)) Q:'ID  W !?2,ARR("TRRX",ID)
"RTN","ORWLR1",38,0)
 D DFN^VBECA3A(DFN),CPRS^VBECA3B
"RTN","ORWLR1",39,0)
 I $O(^TMP("BBD",$J,"CROSSMATCH",0)) D
"RTN","ORWLR1",40,0)
 . W !,"Crossmatched Units: " S ID=0 F  S ID=$O(^TMP("BBD",$J,"CROSSMATCH",ID)) Q:'ID  W !?2,^(ID)
"RTN","ORWLR1",41,0)
 I $O(^TMP("BBD",$J,"COMPONENT REQUEST",0)) D
"RTN","ORWLR1",42,0)
 . W !,"Component request: " S ID=0 F  S ID=$O(^TMP("BBD",$J,"COMPONENT REQUEST",ID)) Q:'ID  W !?2,^(ID) D
"RTN","ORWLR1",43,0)
 .. S ID1=0 F  S ID1=$O(^TMP("BBD",$J,"COMPONENT REQUEST",ID,ID1)) Q:'ID1  W !,"."_^(ID1)
"RTN","ORWLR1",44,0)
 D TRAN^VBECA4(+ORVP,"TRAN")
"RTN","ORWLR1",45,0)
 I $O(^TMP("TRAN",$J,0)) D
"RTN","ORWLR1",46,0)
 . N ID,GMR,GMA
"RTN","ORWLR1",47,0)
 . W !,"Transfused Units: ",! S ID=0
"RTN","ORWLR1",48,0)
 . F  S ID=$O(^TMP("TRAN",$J,ID)) Q:'ID  S GMR=^(ID) D
"RTN","ORWLR1",49,0)
 .. D PARSE,WRT
"RTN","ORWLR1",50,0)
 . I $O(^TMP("TRAN",$J,"A"))'="" D
"RTN","ORWLR1",51,0)
 .. W !
"RTN","ORWLR1",52,0)
 .. W " Blood Product Key: "
"RTN","ORWLR1",53,0)
 . S GMI="A" F  S GMI=$O(^TMP("TRAN",$J,GMI)) Q:GMI=""  D
"RTN","ORWLR1",54,0)
 .. W ?21,GMI," = ",$G(^TMP("TRAN",$J,GMI)),!
"RTN","ORWLR1",55,0)
 I $O(^TMP("BBD",$J,"SPECIMEN",0)) D
"RTN","ORWLR1",56,0)
 . W !,"Specimen: " S ID=0 F  S ID=$O(^TMP("BBD",$J,"SPECIMEN",ID)) Q:'ID  W !?2,^(ID) D
"RTN","ORWLR1",57,0)
 .. S ID1=0 F  S ID1=$O(^TMP("BBD",$J,"SPECIMEN",ID,ID1)) Q:'ID1  W:$D(^(ID1))#2 !,"."_^(ID1) D
"RTN","ORWLR1",58,0)
 ... S ID2=0 F  S ID2=$O(^TMP("BBD",$J,"SPECIMEN",ID,ID1,ID2)) Q:'ID2  W:$D(^(ID2))#2 !,".."_^(ID2)
"RTN","ORWLR1",59,0)
 K ^TMP("BBD",$J),^TMP("TRRX",$J),^TMP("TRAN",$J)
"RTN","ORWLR1",60,0)
 Q
"RTN","ORWLR1",61,0)
PARSE ;Parse Record
"RTN","ORWLR1",62,0)
  N GMI,X S TD=$$FMTE^XLFDT(+GMR)
"RTN","ORWLR1",63,0)
  S GMA(1)=$P(GMR,U,2),BPN=$L(GMA(1),";")
"RTN","ORWLR1",64,0)
  I $P(GMA(1),";",BPN)="" S BPN=BPN-1
"RTN","ORWLR1",65,0)
  F GMI=2:1:BPN S GMA(GMI)="("_$P($P(GMA(1),";",GMI),"\")_") "_$P($P(GMA(1),";",GMI),"\",2)
"RTN","ORWLR1",66,0)
  S GMA(1)="("_$P($P(GMA(1),";",1),"\")_") "_$P($P(GMA(1),";",1),"\",2)
"RTN","ORWLR1",67,0)
  Q
"RTN","ORWLR1",68,0)
WRT  ; Writes the Transfusion Record for each day
"RTN","ORWLR1",69,0)
  N GML,GMI1,GMI2,GMM,GMJ
"RTN","ORWLR1",70,0)
  S GMM=$S(BPN#4:1,1:0),GML=BPN\4+GMM
"RTN","ORWLR1",71,0)
  W TD
"RTN","ORWLR1",72,0)
  F GMI1=1:1:GML D
"RTN","ORWLR1",73,0)
  . F GMI2=1:1:($S((GMI1=GML)&(BPN#4):BPN#4,1:4)) D
"RTN","ORWLR1",74,0)
  .. S GMJ=((GMI1-1)*4)+GMI2
"RTN","ORWLR1",75,0)
  .. W ?(((GMI2-1)*15)+13),GMA(GMJ)
"RTN","ORWLR1",76,0)
  .. I $S(GMI2#4=0:1,GMI2=BPN:1,GMI2+(4*(GMI1-1))=BPN:1,1:0) W !
"RTN","ORWLR1",77,0)
  Q
"RTN","ORWLR2")
0^2^B64042431
"RTN","ORWLR2",1,0)
ORWLR2 ; slc/dcm -  VBEC Blood Bank Report ;01/16/03  15:02
"RTN","ORWLR2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**172**;Dec 17, 1997
"RTN","ORWLR2",3,0)
 ;from ORWLR1 - Re-write of ^LR7OSBR1
"RTN","ORWLR2",4,0)
EN ;
"RTN","ORWLR2",5,0)
 N %DT,A,B,C,CMT,H,ID,J,ORI,T,X,X0,Y,PARENT
"RTN","ORWLR2",6,0)
 D H
"RTN","ORWLR2",7,0)
 ;
"RTN","ORWLR2",8,0)
 ;Get Antibodies
"RTN","ORWLR2",9,0)
 D ABID^VBECA1(PATID,PATNAM,PATDOB,.PARENT,.ARR)
"RTN","ORWLR2",10,0)
 I $O(ARR("ABID",0)) D
"RTN","ORWLR2",11,0)
 . D LN
"RTN","ORWLR2",12,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,"Antibodies identified: ",.CCNT),ID=0
"RTN","ORWLR2",13,0)
 . F  S ID=$O(ARR("ABID",ID)) Q:'ID  D
"RTN","ORWLR2",14,0)
 .. I CCNT>(GIOM-15) D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,"   ",.CCNT)
"RTN","ORWLR2",15,0)
 .. S ^TMP("ORLRC",$J,GCNT,0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(CCNT,.CCNT,$P(ARR("ABID",ID),"^"),.CCNT)_$$S^ORU4(CCNT,.CCNT," : "_$P(ARR("ABID",ID),"^",2),.CCNT)
"RTN","ORWLR2",16,0)
 ;
"RTN","ORWLR2",17,0)
 ;Get Transfusion reactions 
"RTN","ORWLR2",18,0)
 ;Note TRRX API there's no way to differentiate between reactions with or without units identified.
"RTN","ORWLR2",19,0)
 D TRRX^VBECA1(PATID,PATNAM,PATDOB,.PARENT,.ARR)
"RTN","ORWLR2",20,0)
 I $O(ARR("TRRX",0)) D
"RTN","ORWLR2",21,0)
 . D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR2",22,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(0,.CCNT,"TRANSFUSION REACTIONS",.CCNT)_$$S^ORU4(51,.CCNT,"UNIT ID",.CCNT)_$$S^ORU4(66,.CCNT,"COMPONENT",.CCNT)
"RTN","ORWLR2",23,0)
 . S ID=0 F  S ID=$O(ARR("TRRX",ID)) Q:'ID  S X=ARR("TRRX",ID) D
"RTN","ORWLR2",24,0)
 .. S Y=$TR($$FMTE^XLFDT(+X,"M"),"@"," ")
"RTN","ORWLR2",25,0)
 .. D LN
"RTN","ORWLR2",26,0)
 .. S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(0,.CCNT,Y,.CCNT)_$$S^ORU4(21,.CCNT,$P(X,U,2),.CCNT)_$$S^ORU4(51,.CCNT,$P(X,U,4),.CCNT)_$$S^ORU4(69,.CCNT,$P(X,U,3),.CCNT)
"RTN","ORWLR2",27,0)
 .. I $O(ARR("TRRX",ID,0)) D
"RTN","ORWLR2",28,0)
 ... S CMT=0 F  S CMT=$O(ARR("TRRX",ID,CMT)) Q:'CMT  S C=ARR("TRRX",ID,CMT) D
"RTN","ORWLR2",29,0)
 .... D LN
"RTN","ORWLR2",30,0)
 .... S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(0,.CCNT,"  "_C,.CCNT)
"RTN","ORWLR2",31,0)
 D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM)
"RTN","ORWLR2",32,0)
 ;
"RTN","ORWLR2",33,0)
 ;Get Xmatched units, Component requests, AHG
"RTN","ORWLR2",34,0)
 K ^TMP("BBD",$J)
"RTN","ORWLR2",35,0)
 D DFN^VBECA3A(DFN),CPRS^VBECA3B
"RTN","ORWLR2",36,0)
 D CX,C,TRAN,AHG
"RTN","ORWLR2",37,0)
 ;
"RTN","ORWLR2",38,0)
 ;Get Specimen Tests
"RTN","ORWLR2",39,0)
 I '$O(^TMP("BBD",$J,"SPECIMEN",0)) Q
"RTN","ORWLR2",40,0)
 S ORI=""
"RTN","ORWLR2",41,0)
 F  S ORI=$O(^TMP("BBD",$J,"SPECIMEN",ORI),-1) Q:ORI=""  D
"RTN","ORWLR2",42,0)
 . S ID=^TMP("BBD",$J,"SPECIMEN",ORI)
"RTN","ORWLR2",43,0)
 . Q:'$L($P(ID,"^"))
"RTN","ORWLR2",44,0)
 . S T=ORI
"RTN","ORWLR2",45,0)
 . D T,LN
"RTN","ORWLR2",46,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,T,.CCNT)
"RTN","ORWLR2",47,0)
 . D W
"RTN","ORWLR2",48,0)
 K ^TMP("BBD",$J)
"RTN","ORWLR2",49,0)
 Q
"RTN","ORWLR2",50,0)
W ;
"RTN","ORWLR2",51,0)
 S ^(0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(21,.CCNT,$J($P(ID,"^",3),2),.CCNT)
"RTN","ORWLR2",52,0)
 S ^(0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(24,.CCNT,$E($P(ID,"^",9),1,3),.CCNT)
"RTN","ORWLR2",53,0)
 F H=5,6,7,8,10 S Y=$P(ID,"^",H) S ^(0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4((30+$S(H=6:5,H=7:10,H=8:15,H=10:32,1:0)),.CCNT,$E(Y,1,3),.CCNT)
"RTN","ORWLR2",54,0)
 F X=10.3,11.3,2.91 I $D(^TMP("BBD",$J,"SPECIMEN",ORI,X)) S J=0 D
"RTN","ORWLR2",55,0)
 . I $D(^TMP("BBD",$J,"SPECIMEN",ORI,X))#2 D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,ORN(X)_":"_^TMP("BBD",$J,"SPECIMEN",ORI,X),.CCNT)
"RTN","ORWLR2",56,0)
 I $D(^TMP("BBD",$J,"SPECIMEN",ORI,"63.012,.01")) S J=0 F  S J=$O(^TMP("BBD",$J,"SPECIMEN",ORI,"63.012,.01",J)) Q:'J  D
"RTN","ORWLR2",57,0)
 . S X=^TMP("BBD",$J,"SPECIMEN",ORI,"63.012,.01",J)
"RTN","ORWLR2",58,0)
 . D LN
"RTN","ORWLR2",59,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,"ELUATE ANTIBODY: "_X,.CCNT)
"RTN","ORWLR2",60,0)
 ;
"RTN","ORWLR2",61,0)
 I $D(^TMP("BBD",$J,"SPECIMEN",ORI,"63.46,.01")) S J=0 F  S J=$O(^TMP("BBD",$J,"SPECIMEN",ORI,"63.46,.01",J)) Q:'J  D
"RTN","ORWLR2",62,0)
 . S X=^TMP("BBD",$J,"SPECIMEN",ORI,"63.46,.01",J)
"RTN","ORWLR2",63,0)
 . D LN
"RTN","ORWLR2",64,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,"SERUM ANTIBODY IDENTIFIED: "_X,.CCNT)
"RTN","ORWLR2",65,0)
 ;
"RTN","ORWLR2",66,0)
 I $D(^TMP("BBD",$J,"SPECIMEN",ORI,"63.01,8")) S J=0 F  S J=$O(^TMP("BBD",$J,"SPECIMEN",ORI,"63.01,8",J)) Q:'J  D
"RTN","ORWLR2",67,0)
 . S X=^TMP("BBD",$J,"SPECIMEN",ORI,"63.01,8",J)
"RTN","ORWLR2",68,0)
 . D LN
"RTN","ORWLR2",69,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,"ANTIBODY SCREEN COMMENT: "_X,.CCNT)
"RTN","ORWLR2",70,0)
 ;
"RTN","ORWLR2",71,0)
 I $D(^TMP("BBD",$J,"SPECIMEN",ORI,"63.48,.01")) S J=0 F  S J=$O(^TMP("BBD",$J,"SPECIMEN",ORI,"63.48,.01",J)) Q:'J  D
"RTN","ORWLR2",72,0)
 . S X=^TMP("BBD",$J,"SPECIMEN",ORI,"63.48,.01",J)
"RTN","ORWLR2",73,0)
 . D LN
"RTN","ORWLR2",74,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,"ANTIBODY SCREEN COMMENT: "_X,.CCNT)
"RTN","ORWLR2",75,0)
 ;
"RTN","ORWLR2",76,0)
 I $D(^TMP("BBD",$J,"SPECIMEN",ORI,"63.199,.01")) S J=0 F  S J=$O(^TMP("BBD",$J,"SPECIMEN",ORI,"63.199,.01",J)) Q:'J  D
"RTN","ORWLR2",77,0)
 . S X=^TMP("BBD",$J,"SPECIMEN",ORI,"63.199,.01",J)
"RTN","ORWLR2",78,0)
 . D LN
"RTN","ORWLR2",79,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(8,.CCNT,X,.CCNT)
"RTN","ORWLR2",80,0)
 Q
"RTN","ORWLR2",81,0)
T ;Set Date/time format
"RTN","ORWLR2",82,0)
 S T=$$FMTE^XLFDT(T,2)
"RTN","ORWLR2",83,0)
 Q
"RTN","ORWLR2",84,0)
CX ;Crossmatch
"RTN","ORWLR2",85,0)
 N A,CNT,F,LOCAT
"RTN","ORWLR2",86,0)
 I '$O(^TMP("BBD",$J,"CROSSMATCH",0)) D  Q
"RTN","ORWLR2",87,0)
 . D LN
"RTN","ORWLR2",88,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,"No UNITS assigned/xmatched",.CCNT)
"RTN","ORWLR2",89,0)
 . D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM)
"RTN","ORWLR2",90,0)
 D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR2",91,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(6,.CCNT,"Unit assigned/xmatched:",.CCNT)_$$S^ORU4(46,.CCNT,"Exp date",.CCNT)_$$S^ORU4(64,.CCNT,"Loc",.CCNT)
"RTN","ORWLR2",92,0)
 S (CNT,A)=0 F  S A=$O(^TMP("BBD",$J,"CROSSMATCH",A)) Q:'A  D
"RTN","ORWLR2",93,0)
 . S F=^TMP("BBD",$J,"CROSSMATCH",A),CNT=CNT+1,LOCAT=$S($L($P(F,"^",7)):$P(F,"^",7),1:"BB-"_$P(F,"^",6))
"RTN","ORWLR2",94,0)
 . D LN
"RTN","ORWLR2",95,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,$J(CNT,2)_")",.CCNT)_$$S^ORU4(6,.CCNT,$P(F,"^"),.CCNT)_$$S^ORU4(17,.CCNT,$E($P(F,"^",2),1,19),.CCNT)_$$S^ORU4(38,.CCNT,$P(F,"^",3)_" "_$E($P(F,"^",4),1,3),.CCNT)
"RTN","ORWLR2",96,0)
 . S ^(0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(45,.CCNT,$P(F,"^",5),.CCNT)_$$S^ORU4(64,.CCNT,LOCAT,.CCNT)
"RTN","ORWLR2",97,0)
 D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM)
"RTN","ORWLR2",98,0)
 Q
"RTN","ORWLR2",99,0)
C ;Component Request
"RTN","ORWLR2",100,0)
 N %DT,A,F,T,X,Y
"RTN","ORWLR2",101,0)
 I '$O(^TMP("BBD",$J,"COMPONENT REQUEST",0)) D  Q
"RTN","ORWLR2",102,0)
 . D LN S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,"No component requests",.CCNT)
"RTN","ORWLR2",103,0)
 D LN
"RTN","ORWLR2",104,0)
 S X="Component requests"
"RTN","ORWLR2",105,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,X,.CCNT)_$$S^ORU4(26,.CCNT,"Units",.CCNT)_$$S^ORU4(32,.CCNT,"Request date",.CCNT)_$$S^ORU4(49,.CCNT,"Date wanted",.CCNT)_$$S^ORU4(65,.CCNT,"Requestor",.CCNT)_$$S^ORU4(77,.CCNT,"By",.CCNT)
"RTN","ORWLR2",106,0)
 S A=0 F  S A=$O(^TMP("BBD",$J,"COMPONENT REQUEST",A)) Q:'A  D
"RTN","ORWLR2",107,0)
 . S F=^TMP("BBD",$J,"COMPONENT REQUEST",A),T="",%DT="T",X=$P(F,"^",3),Y=-1
"RTN","ORWLR2",108,0)
 . I $L(X) D ^%DT
"RTN","ORWLR2",109,0)
 . I Y'=-1 S T=Y D T
"RTN","ORWLR2",110,0)
 . D LN
"RTN","ORWLR2",111,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,$E($P(F,"^"),1,25),.CCNT)_$$S^ORU4(26,.CCNT,$J($P(F,"^",2),3),.CCNT)_$$S^ORU4(32,.CCNT,T,.CCNT)
"RTN","ORWLR2",112,0)
 . S T="",%DT="T",X=$P(F,"^",4),Y=-1
"RTN","ORWLR2",113,0)
 . I $L(X) D ^%DT
"RTN","ORWLR2",114,0)
 . I Y'=-1 S T=Y D T
"RTN","ORWLR2",115,0)
 . S X=$S($P(F,"^",6):$P(F,"^",6)_",",1:""),X=$S($L(X):$$GET1^DIQ(200,X,1),1:$P(F,"^",6))
"RTN","ORWLR2",116,0)
 . S ^TMP("ORLRC",$J,GCNT,0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(49,.CCNT,T,.CCNT)_$$S^ORU4(65,.CCNT,$E($P(F,"^",5),1,10),.CCNT)_$$S^ORU4(77,.CCNT,X,.CCNT)
"RTN","ORWLR2",117,0)
 Q
"RTN","ORWLR2",118,0)
TRAN ;Transfusion Data
"RTN","ORWLR2",119,0)
 K ^TMP("TRAN",$J)
"RTN","ORWLR2",120,0)
 D TRAN^VBECA4(DFN,"TRAN")
"RTN","ORWLR2",121,0)
 Q:'$O(^TMP("TRAN",$J,0))
"RTN","ORWLR2",122,0)
 N ID,GMR,GMA,TD,C,BPN
"RTN","ORWLR2",123,0)
 D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR2",124,0)
 S X="Transfused Units ",^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,X,.CCNT),ID=0
"RTN","ORWLR2",125,0)
 D LN
"RTN","ORWLR2",126,0)
 F  S ID=$O(^TMP("TRAN",$J,ID)) Q:'ID  S GMR=^(ID) D
"RTN","ORWLR2",127,0)
 . D PARSE^ORWLR1,WRT
"RTN","ORWLR2",128,0)
 I $O(^TMP("TRAN",$J,"A"))'="" D
"RTN","ORWLR2",129,0)
 . D LN
"RTN","ORWLR2",130,0)
 . S X=" Blood Product Key: ",^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,X,.CCNT)
"RTN","ORWLR2",131,0)
 S GMI="A",C=0
"RTN","ORWLR2",132,0)
 F  S GMI=$O(^TMP("TRAN",$J,GMI)) Q:GMI=""  D
"RTN","ORWLR2",133,0)
 . S X=GMI_" = "_$G(^TMP("TRAN",$J,GMI))
"RTN","ORWLR2",134,0)
 . I C>0 D LN
"RTN","ORWLR2",135,0)
 . S C=C+1,^TMP("ORLRC",$J,GCNT,0)=$G(^TMP("ORLRC",$J,GCNT,0))_$$S^ORU4(21,.CCNT,X,.CCNT)
"RTN","ORWLR2",136,0)
 K ^TMP("TRAN",$J)
"RTN","ORWLR2",137,0)
 Q
"RTN","ORWLR2",138,0)
WRT  ; Sets the Transfusion Record for each day
"RTN","ORWLR2",139,0)
  N GML,GMI1,GMI2,GMM,GMJ,CL
"RTN","ORWLR2",140,0)
  S GMM=$S(BPN#4:1,1:0),GML=BPN\4+GMM
"RTN","ORWLR2",141,0)
  D LN
"RTN","ORWLR2",142,0)
  S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,TD,.CCNT)
"RTN","ORWLR2",143,0)
  F GMI1=1:1:GML D
"RTN","ORWLR2",144,0)
  . F GMI2=1:1:($S((GMI1=GML)&(BPN#4):BPN#4,1:4)) D
"RTN","ORWLR2",145,0)
  .. S GMJ=((GMI1-1)*4)+GMI2,CL=(((GMI2-1)*15)+14)
"RTN","ORWLR2",146,0)
  .. S ^TMP("ORLRC",$J,GCNT,0)=$G(^TMP("ORLRC",$J,GCNT,0))_$$S^ORU4(CL,.CCNT,GMA(GMJ),.CCNT)
"RTN","ORWLR2",147,0)
  .. I $S(GMI2#4=0:1,GMI2=BPN:1,GMI2+(4*(GMI1-1))=BPN:1,1:0) D LN
"RTN","ORWLR2",148,0)
  Q
"RTN","ORWLR2",149,0)
H ;Header
"RTN","ORWLR2",150,0)
 N X
"RTN","ORWLR2",151,0)
 D LN
"RTN","ORWLR2",152,0)
 S X=GIOM/2-(10/2+5),^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(X,.CCNT,"---- BLOOD BANK ----",.CCNT)
"RTN","ORWLR2",153,0)
 D LN
"RTN","ORWLR2",154,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(1,.CCNT,"ABO Rh: "_ORABORH,.CCNT)
"RTN","ORWLR2",155,0)
 Q
"RTN","ORWLR2",156,0)
AHG ;AHG Data
"RTN","ORWLR2",157,0)
 D LINE^ORU4("^TMP(""ORLRC"",$J)",GIOM),LN
"RTN","ORWLR2",158,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(30,.CCNT,"|---",.CCNT)_$$S^ORU4(39,.CCNT,"AHG(direct)",.CCNT)_$$S^ORU4(55,.CCNT,"---|",.CCNT)_$$S^ORU4(62,.CCNT,"|-AHG(indirect)-|",.CCNT)
"RTN","ORWLR2",159,0)
 D LN
"RTN","ORWLR2",160,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,"Date/time",.CCNT)_$$S^ORU4(20,.CCNT,"ABO",.CCNT)_$$S^ORU4(24,.CCNT,"Rh",.CCNT)_$$S^ORU4(30,.CCNT,"POLY",.CCNT)_$$S^ORU4(35,.CCNT,"IgG",.CCNT)_$$S^ORU4(40,.CCNT,"C3",.CCNT)
"RTN","ORWLR2",161,0)
 S ^(0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(45,.CCNT,"Interpretation",.CCNT)_$$S^ORU4(62,.CCNT,"(Antibody screen)",.CCNT)
"RTN","ORWLR2",162,0)
 D LN
"RTN","ORWLR2",163,0)
 S ^TMP("ORLRC",$J,GCNT,0)=$$S^ORU4(4,.CCNT,"---------",.CCNT)_$$S^ORU4(20,.CCNT,"---",.CCNT)_$$S^ORU4(24,.CCNT,"--",.CCNT)_$$S^ORU4(30,.CCNT,"----",.CCNT)_$$S^ORU4(35,.CCNT,"---",.CCNT)
"RTN","ORWLR2",164,0)
 S ^(0)=^TMP("ORLRC",$J,GCNT,0)_$$S^ORU4(40,.CCNT,"---",.CCNT)_$$S^ORU4(45,.CCNT,"--------------",.CCNT)_$$S^ORU4(62,.CCNT,"-----------------",.CCNT)
"RTN","ORWLR2",165,0)
 Q
"RTN","ORWLR2",166,0)
LN ;Increment counts
"RTN","ORWLR2",167,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","ORWLR2",168,0)
 Q
"VER")
8.0^22.0
**END**
**END**
