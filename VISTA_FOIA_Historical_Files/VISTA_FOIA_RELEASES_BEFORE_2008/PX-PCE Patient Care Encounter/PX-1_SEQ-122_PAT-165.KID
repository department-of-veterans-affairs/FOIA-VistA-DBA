Released PX*1*165 SEQ #122
Extracted from mail message
**KIDS**:PX*1.0*165^

**INSTALL NAME**
PX*1.0*165
"BLD",6046,0)
PX*1.0*165^PCE PATIENT CARE ENCOUNTER^0^3050307^y
"BLD",6046,1,0)
^^1^1^3050307^
"BLD",6046,1,1,0)
Errors on print from Patient Activity List
"BLD",6046,4,0)
^9.64PA^^
"BLD",6046,"ABPKG")
n
"BLD",6046,"KRN",0)
^9.67PA^8989.52^19
"BLD",6046,"KRN",.4,0)
.4
"BLD",6046,"KRN",.401,0)
.401
"BLD",6046,"KRN",.402,0)
.402
"BLD",6046,"KRN",.403,0)
.403
"BLD",6046,"KRN",.5,0)
.5
"BLD",6046,"KRN",.84,0)
.84
"BLD",6046,"KRN",3.6,0)
3.6
"BLD",6046,"KRN",3.8,0)
3.8
"BLD",6046,"KRN",9.2,0)
9.2
"BLD",6046,"KRN",9.8,0)
9.8
"BLD",6046,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6046,"KRN",9.8,"NM",1,0)
PXRRPAPI^^0^B63792719
"BLD",6046,"KRN",9.8,"NM","B","PXRRPAPI",1)

"BLD",6046,"KRN",19,0)
19
"BLD",6046,"KRN",19,"NM",0)
^9.68A^^
"BLD",6046,"KRN",19.1,0)
19.1
"BLD",6046,"KRN",101,0)
101
"BLD",6046,"KRN",409.61,0)
409.61
"BLD",6046,"KRN",771,0)
771
"BLD",6046,"KRN",870,0)
870
"BLD",6046,"KRN",8989.51,0)
8989.51
"BLD",6046,"KRN",8989.52,0)
8989.52
"BLD",6046,"KRN",8994,0)
8994
"BLD",6046,"KRN","B",.4,.4)

"BLD",6046,"KRN","B",.401,.401)

"BLD",6046,"KRN","B",.402,.402)

"BLD",6046,"KRN","B",.403,.403)

"BLD",6046,"KRN","B",.5,.5)

"BLD",6046,"KRN","B",.84,.84)

"BLD",6046,"KRN","B",3.6,3.6)

"BLD",6046,"KRN","B",3.8,3.8)

"BLD",6046,"KRN","B",9.2,9.2)

"BLD",6046,"KRN","B",9.8,9.8)

"BLD",6046,"KRN","B",19,19)

"BLD",6046,"KRN","B",19.1,19.1)

"BLD",6046,"KRN","B",101,101)

"BLD",6046,"KRN","B",409.61,409.61)

"BLD",6046,"KRN","B",771,771)

"BLD",6046,"KRN","B",870,870)

"BLD",6046,"KRN","B",8989.51,8989.51)

"BLD",6046,"KRN","B",8989.52,8989.52)

"BLD",6046,"KRN","B",8994,8994)

"BLD",6046,"QUES",0)
^9.62^^
"BLD",6046,"REQB",0)
^9.611^1^1
"BLD",6046,"REQB",1,0)
PX*1.0*121^2
"BLD",6046,"REQB","B","PX*1.0*121",1)

"MBREQ")
0
"PKG",413,-1)
1^1
"PKG",413,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)^
"PKG",413,20,0)
^9.402P^^
"PKG",413,22,0)
^9.49I^1^1
"PKG",413,22,1,0)
1.0^2960812^2960913^12537
"PKG",413,22,1,"PAH",1,0)
165^3050307
"PKG",413,22,1,"PAH",1,1,0)
^^1^1^3050307
"PKG",413,22,1,"PAH",1,1,1,0)
Errors on print from Patient Activity List
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PXRRPAPI")
0^1^B63792719
"RTN","PXRRPAPI",1,0)
PXRRPAPI ;ISL/PKR - Build the patient specific info for each patient on the list. ;6/27/97
"RTN","PXRRPAPI",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**18,121,165**;Aug 12, 1996
"RTN","PXRRPAPI",3,0)
 ;
"RTN","PXRRPAPI",4,0)
PAT ;
"RTN","PXRRPAPI",5,0)
 N ACTIVITY,BACDATE,BD,BUSY,DATE,DFN,EACDATE,ED,ERIEN,ERR
"RTN","PXRRPAPI",6,0)
 N IC,IEN,JC,FACIEN,FACNAM
"RTN","PXRRPAPI",7,0)
 N HLOCIEN,HLOCNAM,LABTEST,LOCIEN,LRDFN,NERM
"RTN","PXRRPAPI",8,0)
 N PNAME,SPEC,SSN,SSNF,UNITS
"RTN","PXRRPAPI",9,0)
 N TEMP
"RTN","PXRRPAPI",10,0)
 ;
"RTN","PXRRPAPI",11,0)
 ;Allow the task to be cleaned up upon successful completion.
"RTN","PXRRPAPI",12,0)
 S ZTREQ="@"
"RTN","PXRRPAPI",13,0)
 ;
"RTN","PXRRPAPI",14,0)
 S BACDATE=PXRRBCDT-.0001
"RTN","PXRRPAPI",15,0)
 S EACDATE=PXRRECDT+.2359
"RTN","PXRRPAPI",16,0)
 ;
"RTN","PXRRPAPI",17,0)
 ;Build a list of emergency room iens, get list from PCE parameter file.
"RTN","PXRRPAPI",18,0)
 S NERM=0
"RTN","PXRRPAPI",19,0)
 S IC=0
"RTN","PXRRPAPI",20,0)
 F  S IC=$O(^PX(815,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",21,0)
 . S JC=0
"RTN","PXRRPAPI",22,0)
 . F  S JC=$O(^PX(815,IC,"RR1",JC)) Q:+JC=0  D
"RTN","PXRRPAPI",23,0)
 .. S NERM=NERM+1
"RTN","PXRRPAPI",24,0)
 .. S TEMP=^PX(815,IC,"RR1",JC,0)
"RTN","PXRRPAPI",25,0)
 .. S ERIEN(NERM)=TEMP_U_$P(^SC(TEMP,0),U,1)
"RTN","PXRRPAPI",26,0)
 ;
"RTN","PXRRPAPI",27,0)
 I '(PXRRQUE!$D(IO("S"))) D INIT^PXRRBUSY(.BUSY)
"RTN","PXRRPAPI",28,0)
 ;
"RTN","PXRRPAPI",29,0)
 S FACIEN=""
"RTN","PXRRPAPI",30,0)
NFAC1 S FACIEN=$O(^XTMP(PXRRXTMP,"APPT",FACIEN))
"RTN","PXRRPAPI",31,0)
 I +FACIEN=0 G DONE
"RTN","PXRRPAPI",32,0)
 ;
"RTN","PXRRPAPI",33,0)
 S HLOCIEN=""
"RTN","PXRRPAPI",34,0)
NHLOC1 S HLOCIEN=$O(^XTMP(PXRRXTMP,"APPT",FACIEN,HLOCIEN))
"RTN","PXRRPAPI",35,0)
 I +HLOCIEN=0 G NFAC1
"RTN","PXRRPAPI",36,0)
 ;
"RTN","PXRRPAPI",37,0)
 ;Check for a user request to stop the task.
"RTN","PXRRPAPI",38,0)
 I $$S^%ZTLOAD S ZTSTOP=1 D EXIT^PXRRGUT
"RTN","PXRRPAPI",39,0)
 ;
"RTN","PXRRPAPI",40,0)
 S DFN=0
"RTN","PXRRPAPI",41,0)
NPAT S DFN=$O(^XTMP(PXRRXTMP,"APPT",FACIEN,HLOCIEN,DFN))
"RTN","PXRRPAPI",42,0)
 I +DFN=0 G NHLOC1
"RTN","PXRRPAPI",43,0)
 S ACTIVITY=0
"RTN","PXRRPAPI",44,0)
 ;
"RTN","PXRRPAPI",45,0)
 ;If this is an interactive session let the user know that something
"RTN","PXRRPAPI",46,0)
 ;is happening.
"RTN","PXRRPAPI",47,0)
 I '(PXRRQUE!$D(IO("S"))) D SPIN^PXRRBUSY("Sorting patient information",.BUSY)
"RTN","PXRRPAPI",48,0)
 ;
"RTN","PXRRPAPI",49,0)
 ;Emergency room visits.
"RTN","PXRRPAPI",50,0)
 I NERM>0 D
"RTN","PXRRPAPI",51,0)
 . S BD=BACDATE
"RTN","PXRRPAPI",52,0)
 . S ED=EACDATE
"RTN","PXRRPAPI",53,0)
 . F  S BD=$O(^AUPNVSIT("AET",DFN,BD)) Q:((BD>EACDATE)!(BD=""))  D
"RTN","PXRRPAPI",54,0)
 .. S LOCIEN=""
"RTN","PXRRPAPI",55,0)
 .. F  S LOCIEN=$O(^AUPNVSIT("AET",DFN,BD,LOCIEN)) Q:LOCIEN=""  D
"RTN","PXRRPAPI",56,0)
 ... F IC=1:1:NERM  D
"RTN","PXRRPAPI",57,0)
 .... I $P(ERIEN(IC),U,1)=LOCIEN D
"RTN","PXRRPAPI",58,0)
 ..... S ^TMP(PXRRXTMP,$J,"ER",DFN,BD)=ERIEN(IC)
"RTN","PXRRPAPI",59,0)
 . I $D(^TMP(PXRRXTMP,$J,"ER",DFN)) S ACTIVITY=1
"RTN","PXRRPAPI",60,0)
 ;
"RTN","PXRRPAPI",61,0)
 ;Build a list of future appointments.
"RTN","PXRRPAPI",62,0)
 D KVA^VADPT
"RTN","PXRRPAPI",63,0)
 S VASD("F")=PXRRBFDT
"RTN","PXRRPAPI",64,0)
 S VASD("T")=PXRREFDT
"RTN","PXRRPAPI",65,0)
 D SDA^VADPT
"RTN","PXRRPAPI",66,0)
 S IC=0
"RTN","PXRRPAPI",67,0)
 F  S IC=$O(^UTILITY("VASD",$J,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",68,0)
 . S ^TMP(PXRRXTMP,$J,"FUT",DFN,IC)=^UTILITY("VASD",$J,IC,"E")
"RTN","PXRRPAPI",69,0)
 K ^UTILITY("VASD",$J)
"RTN","PXRRPAPI",70,0)
 D KVA^VADPT
"RTN","PXRRPAPI",71,0)
 I $D(^TMP(PXRRXTMP,$J,"FUT",DFN)) S ACTIVITY=1
"RTN","PXRRPAPI",72,0)
 ;
"RTN","PXRRPAPI",73,0)
 ;Save all admissions and discharges in the date range.
"RTN","PXRRPAPI",74,0)
 ;We will need a DBIA to use the cross-ref.  Numerous similar
"RTN","PXRRPAPI",75,0)
 ;ones are already in place, i.e.,  DBIA244-D, DBIA325-B, DBIA966, DBIA1358.
"RTN","PXRRPAPI",76,0)
 S BD=BACDATE
"RTN","PXRRPAPI",77,0)
 S ED=EACDATE
"RTN","PXRRPAPI",78,0)
NADM S BD=$O(^DGPM("APTT1",DFN,BD))
"RTN","PXRRPAPI",79,0)
 ;If we have passed the ending date we are done.
"RTN","PXRRPAPI",80,0)
 I (BD>ED)!(BD="") G DIS
"RTN","PXRRPAPI",81,0)
 S IEN=$O(^DGPM("APTT1",DFN,BD,""))
"RTN","PXRRPAPI",82,0)
 S ^TMP(PXRRXTMP,$J,"ADM",DFN,BD,IEN)=""
"RTN","PXRRPAPI",83,0)
 G NADM
"RTN","PXRRPAPI",84,0)
 I $D(^TMP(PXRRXTMP,$J,"ADM",DFN)) S ACTIVITY=1
"RTN","PXRRPAPI",85,0)
 ;
"RTN","PXRRPAPI",86,0)
DIS S BD=BACDATE
"RTN","PXRRPAPI",87,0)
 S ED=EACDATE
"RTN","PXRRPAPI",88,0)
NDIS S BD=$O(^DGPM("APTT3",DFN,BD))
"RTN","PXRRPAPI",89,0)
 ;If we have passed the ending date we are done.
"RTN","PXRRPAPI",90,0)
 I (BD>ED)!(BD="") G CLAB
"RTN","PXRRPAPI",91,0)
 S IEN=$O(^DGPM("APTT3",DFN,BD,""))
"RTN","PXRRPAPI",92,0)
 S ^TMP(PXRRXTMP,$J,"DIS",DFN,BD,IEN)=""
"RTN","PXRRPAPI",93,0)
 G NDIS
"RTN","PXRRPAPI",94,0)
 I $D(^TMP(PXRRXTMP,$J,"DIS",DFN)) S ACTIVITY=1
"RTN","PXRRPAPI",95,0)
 ;
"RTN","PXRRPAPI",96,0)
 ;Get critical lab values.
"RTN","PXRRPAPI",97,0)
 ;This will probably require a DBIA to read DPT.
"RTN","PXRRPAPI",98,0)
 ;We will need a DBIA to look at lab stuff.
"RTN","PXRRPAPI",99,0)
CLAB S LRDFN=$G(^DPT(DFN,"LR"))
"RTN","PXRRPAPI",100,0)
 I LRDFN="" G SAVPAT
"RTN","PXRRPAPI",101,0)
 S ED=$$FMDFINVL(BACDATE,0)
"RTN","PXRRPAPI",102,0)
 S BD=$$FMDFINVL(EACDATE,0)
"RTN","PXRRPAPI",103,0)
NLAB S BD=$O(^LR(LRDFN,"CH",BD))
"RTN","PXRRPAPI",104,0)
 ;If we have passed the ending date we are done.
"RTN","PXRRPAPI",105,0)
 I (BD>ED)!(BD="") G SAVPAT
"RTN","PXRRPAPI",106,0)
 S IC=0
"RTN","PXRRPAPI",107,0)
 F  S IC=$O(^LR(LRDFN,"CH",BD,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",108,0)
 . S TEMP=$G(^LR(LRDFN,"CH",BD,IC))
"RTN","PXRRPAPI",109,0)
 . I $P(TEMP,U,2)["*" D
"RTN","PXRRPAPI",110,0)
 .. D FIELD^DID(63.04,IC,"","LABEL","LABTEST","ERR")
"RTN","PXRRPAPI",111,0)
 ..;Try to get the units.
"RTN","PXRRPAPI",112,0)
 .. S SPEC=$P(^LR(LRDFN,"CH",BD,0),U,5)
"RTN","PXRRPAPI",113,0)
 .. S JC=$O(^LAB(60,"C","CH;"_IC_";1",""))
"RTN","PXRRPAPI",114,0)
 .. S UNITS=$P($G(^LAB(60,JC,1,SPEC,0)),U,7)
"RTN","PXRRPAPI",115,0)
 .. S ^TMP(PXRRXTMP,$J,"CLAB",DFN,BD,IC)=LABTEST("LABEL")_U_TEMP_U_UNITS
"RTN","PXRRPAPI",116,0)
 G NLAB
"RTN","PXRRPAPI",117,0)
 I $D(^TMP(PXRRXTMP,$J,"CLAB",DFN)) S ACTIVITY=1
"RTN","PXRRPAPI",118,0)
 ;
"RTN","PXRRPAPI",119,0)
SAVPAT ;Save the patient data in XTMP in a format suitable for printing.
"RTN","PXRRPAPI",120,0)
 ;We only want those patients that had some activity.
"RTN","PXRRPAPI",121,0)
 I 'ACTIVITY G NPAT
"RTN","PXRRPAPI",122,0)
 S TEMP=$G(^DPT(DFN,0))
"RTN","PXRRPAPI",123,0)
 S PNAME=$P(TEMP,U,1)
"RTN","PXRRPAPI",124,0)
 S SSN=$P(TEMP,U,9)
"RTN","PXRRPAPI",125,0)
 S FACNAM=PXRRFACN(FACIEN)_U_FACIEN
"RTN","PXRRPAPI",126,0)
 S HLOCNAM=$P($G(^SC(HLOCIEN,0)),U,1)
"RTN","PXRRPAPI",127,0)
 S ^XTMP(PXRRXTMP,"ALPHA",FACNAM,HLOCNAM_U_HLOCIEN,PNAME,SSN)=DFN
"RTN","PXRRPAPI",128,0)
 D KVA^VADPT
"RTN","PXRRPAPI",129,0)
 D ADD^VADPT
"RTN","PXRRPAPI",130,0)
 S SSNF=$$SSNFORM(SSN)
"RTN","PXRRPAPI",131,0)
 S ^XTMP(PXRRXTMP,"PATIENT",DFN)=SSNF_U_VAPA(1)_U_VAPA(2)_U_VAPA(3)_U_VAPA(4)_U_VAPA(5)_U_VAPA(6)_U_VAPA(8)
"RTN","PXRRPAPI",132,0)
 D KVA^VADPT
"RTN","PXRRPAPI",133,0)
 ;
"RTN","PXRRPAPI",134,0)
 ;Appointment data.
"RTN","PXRRPAPI",135,0)
 S IC=0
"RTN","PXRRPAPI",136,0)
 F  S IC=$O(^XTMP(PXRRXTMP,"APPT",FACIEN,HLOCIEN,DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",137,0)
 . S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"APPT",IC)=^XTMP(PXRRXTMP,"APPT",FACIEN,HLOCIEN,DFN,IC)
"RTN","PXRRPAPI",138,0)
 ;
"RTN","PXRRPAPI",139,0)
 ;Process admission data, build a complete entry including discharge
"RTN","PXRRPAPI",140,0)
 ;date, last treating specialty, last provider, admitting diagnosis.
"RTN","PXRRPAPI",141,0)
 S IC=0
"RTN","PXRRPAPI",142,0)
 F  S IC=$O(^TMP(PXRRXTMP,$J,"ADM",DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",143,0)
 . S IEN=$O(^TMP(PXRRXTMP,$J,"ADM",DFN,IC,""))
"RTN","PXRRPAPI",144,0)
 . D ADMISS(DFN,IC,IEN)
"RTN","PXRRPAPI",145,0)
 ;
"RTN","PXRRPAPI",146,0)
 ;Process discharge admission data, build a complete entry just as for
"RTN","PXRRPAPI",147,0)
 ;admissions above.  Match the discharge to the admission, avoiding
"RTN","PXRRPAPI",148,0)
 ;duplicate entries.
"RTN","PXRRPAPI",149,0)
 S IC=0
"RTN","PXRRPAPI",150,0)
 F  S IC=$O(^TMP(PXRRXTMP,$J,"DIS",DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",151,0)
 . S IEN=$O(^TMP(PXRRXTMP,$J,"DIS",DFN,IC,""))
"RTN","PXRRPAPI",152,0)
 . D DISCHRG(DFN,IC,IEN)
"RTN","PXRRPAPI",153,0)
 ;
"RTN","PXRRPAPI",154,0)
 ;Look for any current inpatient data whose admission we may have
"RTN","PXRRPAPI",155,0)
 ;missed.
"RTN","PXRRPAPI",156,0)
 I '$D(^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ADMDIS")) D
"RTN","PXRRPAPI",157,0)
 . D KVA^VADPT
"RTN","PXRRPAPI",158,0)
 . D IN5^VADPT
"RTN","PXRRPAPI",159,0)
 . I $L(VAIP(13))>0 D
"RTN","PXRRPAPI",160,0)
 .. S DATE=$P(VAIP(13,1),U,1)
"RTN","PXRRPAPI",161,0)
 ..;The admission date must be less than the beginning activity date
"RTN","PXRRPAPI",162,0)
 ..;in order for the patient to be an inpatient during the activity
"RTN","PXRRPAPI",163,0)
 ..;date range.
"RTN","PXRRPAPI",164,0)
 .. I DATE<PXRRBCDT D
"RTN","PXRRPAPI",165,0)
 ...;Ward
"RTN","PXRRPAPI",166,0)
 ... S TEMP=$P(VAIP(14,4),U,2)
"RTN","PXRRPAPI",167,0)
 ...;Last treating specialty
"RTN","PXRRPAPI",168,0)
 ... S TEMP=TEMP_U_$P(VAIP(14,6),U,2)
"RTN","PXRRPAPI",169,0)
 ... ;Last provider
"RTN","PXRRPAPI",170,0)
 ... S TEMP=TEMP_U_$P(VAIP(14,5),U,2)
"RTN","PXRRPAPI",171,0)
 ...;Admitting diagnosis
"RTN","PXRRPAPI",172,0)
 ... S TEMP=TEMP_U_VAIP(13,7)
"RTN","PXRRPAPI",173,0)
 ... S DISDATE=DT+1
"RTN","PXRRPAPI",174,0)
 ... S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ADMDIS",DATE,DISDATE)=TEMP
"RTN","PXRRPAPI",175,0)
 ;
"RTN","PXRRPAPI",176,0)
 ;Critical lab data.
"RTN","PXRRPAPI",177,0)
 S IC=0
"RTN","PXRRPAPI",178,0)
 F  S IC=$O(^TMP(PXRRXTMP,$J,"CLAB",DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",179,0)
 . S TEMP=$$FMDFINVL(IC,1)
"RTN","PXRRPAPI",180,0)
 . S JC=0
"RTN","PXRRPAPI",181,0)
 . F  S JC=$O(^TMP(PXRRXTMP,$J,"CLAB",DFN,IC,JC)) Q:+JC=0  D
"RTN","PXRRPAPI",182,0)
 .. S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"CLAB",TEMP,JC)=^TMP(PXRRXTMP,$J,"CLAB",DFN,IC,JC)
"RTN","PXRRPAPI",183,0)
 ;
"RTN","PXRRPAPI",184,0)
 ;Emergency room visits.
"RTN","PXRRPAPI",185,0)
 S IC=0
"RTN","PXRRPAPI",186,0)
 F  S IC=$O(^TMP(PXRRXTMP,$J,"ER",DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",187,0)
 . S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ER",IC)=^TMP(PXRRXTMP,$J,"ER",DFN,IC)
"RTN","PXRRPAPI",188,0)
 ;
"RTN","PXRRPAPI",189,0)
 ;Future appointments.
"RTN","PXRRPAPI",190,0)
 S IC=0
"RTN","PXRRPAPI",191,0)
 F  S IC=$O(^TMP(PXRRXTMP,$J,"FUT",DFN,IC)) Q:+IC=0  D
"RTN","PXRRPAPI",192,0)
 . S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"FUT",IC)=^TMP(PXRRXTMP,$J,"FUT",DFN,IC)
"RTN","PXRRPAPI",193,0)
 ;
"RTN","PXRRPAPI",194,0)
 G NPAT
"RTN","PXRRPAPI",195,0)
DONE ;
"RTN","PXRRPAPI",196,0)
 I '(PXRRQUE!$D(IO("S"))) D DONE^PXRRBUSY("done")
"RTN","PXRRPAPI",197,0)
 ;
"RTN","PXRRPAPI",198,0)
EXIT ;
"RTN","PXRRPAPI",199,0)
 K ^TMP(PXRRXTMP)
"RTN","PXRRPAPI",200,0)
 ;
"RTN","PXRRPAPI",201,0)
 ;Print the report.
"RTN","PXRRPAPI",202,0)
 I PXRRQUE D 
"RTN","PXRRPAPI",203,0)
 .;Start the report that was queued but not scheduled.
"RTN","PXRRPAPI",204,0)
 . N DESC,ROUTINE,TASK
"RTN","PXRRPAPI",205,0)
 . S DESC="Patient Activity Report - print"
"RTN","PXRRPAPI",206,0)
 . S ROUTINE="PXRRPAPR"
"RTN","PXRRPAPI",207,0)
 . S ZTDTH=$$NOW^XLFDT
"RTN","PXRRPAPI",208,0)
 . S TASK=^XTMP(PXRRXTMP,"PRZTSK")
"RTN","PXRRPAPI",209,0)
 . D REQUE^PXRRQUE(DESC,ROUTINE,TASK)
"RTN","PXRRPAPI",210,0)
 E  D ^PXRRPAPR
"RTN","PXRRPAPI",211,0)
 Q
"RTN","PXRRPAPI",212,0)
 ;
"RTN","PXRRPAPI",213,0)
 ;=======================================================================
"RTN","PXRRPAPI",214,0)
ADMISS(DFN,DATE,IEN) ;Given a patient and an admission date find the
"RTN","PXRRPAPI",215,0)
 ;associated discharge, if any.  Save the other information listed
"RTN","PXRRPAPI",216,0)
 ;below.
"RTN","PXRRPAPI",217,0)
 N DISDATE,TEMP
"RTN","PXRRPAPI",218,0)
 D KVA^VADPT
"RTN","PXRRPAPI",219,0)
 S VAIP("D")=DATE
"RTN","PXRRPAPI",220,0)
 S VAIP("E")=IEN
"RTN","PXRRPAPI",221,0)
 S VAIP("M")=0
"RTN","PXRRPAPI",222,0)
 D IN5^VADPT
"RTN","PXRRPAPI",223,0)
 ;Store the information in TEMP in printing order.
"RTN","PXRRPAPI",224,0)
 ;Ward
"RTN","PXRRPAPI",225,0)
 S TEMP=$P(VAIP(14,4),U,2)
"RTN","PXRRPAPI",226,0)
 ;Last treating specialty
"RTN","PXRRPAPI",227,0)
 S TEMP=TEMP_U_$P(VAIP(14,6),U,2)
"RTN","PXRRPAPI",228,0)
 ;Last provider
"RTN","PXRRPAPI",229,0)
 S TEMP=TEMP_U_$P(VAIP(14,5),U,2)
"RTN","PXRRPAPI",230,0)
 ;Admitting diagnosis
"RTN","PXRRPAPI",231,0)
 S TEMP=TEMP_U_VAIP(13,7)
"RTN","PXRRPAPI",232,0)
 I $L(VAIP(17))>0 D
"RTN","PXRRPAPI",233,0)
 . S DISDATE=$P(VAIP(17,1),U,1)
"RTN","PXRRPAPI",234,0)
 E  D
"RTN","PXRRPAPI",235,0)
 . S DISDATE=DT+1
"RTN","PXRRPAPI",236,0)
 S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ADMDIS",DATE,DISDATE)=TEMP
"RTN","PXRRPAPI",237,0)
 ;
"RTN","PXRRPAPI",238,0)
ADMDONE ;
"RTN","PXRRPAPI",239,0)
 D KVA^VADPT
"RTN","PXRRPAPI",240,0)
 Q
"RTN","PXRRPAPI",241,0)
 ;
"RTN","PXRRPAPI",242,0)
 ;=======================================================================
"RTN","PXRRPAPI",243,0)
DISCHRG(DFN,DATE,IEN) ;Given a patient and a discharge date find the
"RTN","PXRRPAPI",244,0)
 ;associated admission.  Determine if the combined admission-discharge
"RTN","PXRRPAPI",245,0)
 ;data has already been stored.  If it has quit otherwise store it.
"RTN","PXRRPAPI",246,0)
 N ADMDATE,ICD9IEN,TEMP
"RTN","PXRRPAPI",247,0)
 D KVA^VADPT
"RTN","PXRRPAPI",248,0)
 S VAIP("D")=$P(DATE,".",1)
"RTN","PXRRPAPI",249,0)
 S VAIP("E")=IEN
"RTN","PXRRPAPI",250,0)
 S VAIP("M")=0
"RTN","PXRRPAPI",251,0)
 D IN5^VADPT
"RTN","PXRRPAPI",252,0)
 S ADMDATE=$P(VAIP(13,1),U,1)
"RTN","PXRRPAPI",253,0)
 I ADMDATE="" S ADMDATE=DATE_"NA"
"RTN","PXRRPAPI",254,0)
 I $D(^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ADMDIS",ADMDATE,DATE)) G DISDONE
"RTN","PXRRPAPI",255,0)
 ;Information is not already there, store the data.
"RTN","PXRRPAPI",256,0)
 ;Ward
"RTN","PXRRPAPI",257,0)
 S TEMP=""
"RTN","PXRRPAPI",258,0)
 ;Last treating specialty
"RTN","PXRRPAPI",259,0)
 S TEMP=TEMP_U_$P(VAIP(17,6),U,2)
"RTN","PXRRPAPI",260,0)
 ;Last provider
"RTN","PXRRPAPI",261,0)
 S TEMP=TEMP_U_$P(VAIP(17,5),U,2)
"RTN","PXRRPAPI",262,0)
 ;Admitting diagnosis
"RTN","PXRRPAPI",263,0)
 S TEMP=TEMP_U_VAIP(13,7)
"RTN","PXRRPAPI",264,0)
 ;Will need a DBIA for these reads.
"RTN","PXRRPAPI",265,0)
 ;Try to get DXLS
"RTN","PXRRPAPI",266,0)
 I +VAIP(12)>0 S ICD9IEN=$P($G(^DGPT(VAIP(12),70)),U,10)
"RTN","PXRRPAPI",267,0)
 ;I +$G(ICD9IEN)>0 S TEMP=TEMP_U_$P(^ICD9(ICD9IEN,0),U,3)
"RTN","PXRRPAPI",268,0)
 I +$G(ICD9IEN)>0 S TEMP=TEMP_U_$P($$ICDDX^ICDCODE(ICD9IEN),U,4)
"RTN","PXRRPAPI",269,0)
 ;
"RTN","PXRRPAPI",270,0)
 S ^XTMP(PXRRXTMP,FACIEN,HLOCIEN,DFN,"ADMDIS",ADMDATE,DATE)=TEMP
"RTN","PXRRPAPI",271,0)
DISDONE ;
"RTN","PXRRPAPI",272,0)
 D KVA^VADPT
"RTN","PXRRPAPI",273,0)
 Q
"RTN","PXRRPAPI",274,0)
 ;
"RTN","PXRRPAPI",275,0)
 ;=======================================================================
"RTN","PXRRPAPI",276,0)
SSNFORM(SSN) ;Format the social security number with dashes.
"RTN","PXRRPAPI",277,0)
 N FSSN,TEMP
"RTN","PXRRPAPI",278,0)
 S TEMP=$E(SSN,1,3)
"RTN","PXRRPAPI",279,0)
 S FSSN=TEMP_"-"
"RTN","PXRRPAPI",280,0)
 S TEMP=$E(SSN,4,5)
"RTN","PXRRPAPI",281,0)
 S FSSN=FSSN_TEMP_"-"
"RTN","PXRRPAPI",282,0)
 S TEMP=$E(SSN,6,9)
"RTN","PXRRPAPI",283,0)
 S FSSN=FSSN_TEMP
"RTN","PXRRPAPI",284,0)
 Q FSSN
"RTN","PXRRPAPI",285,0)
 ;
"RTN","PXRRPAPI",286,0)
 ;=======================================================================
"RTN","PXRRPAPI",287,0)
FMDFINVL(INVDT,DATE) ;Convert an inverse date (LABORATORY format
"RTN","PXRRPAPI",288,0)
 ;9999999-date) to Fileman format.
"RTN","PXRRPAPI",289,0)
 I $L(INVDT)=0 Q INVDT
"RTN","PXRRPAPI",290,0)
 N TEMP
"RTN","PXRRPAPI",291,0)
 S TEMP=9999999-INVDT
"RTN","PXRRPAPI",292,0)
 ;If DATE is TRUE return only the date portion.
"RTN","PXRRPAPI",293,0)
 I DATE S TEMP=$P(TEMP,".",1)
"RTN","PXRRPAPI",294,0)
 Q TEMP
"RTN","PXRRPAPI",295,0)
 ;
"VER")
8.0^22.0
**END**
**END**
