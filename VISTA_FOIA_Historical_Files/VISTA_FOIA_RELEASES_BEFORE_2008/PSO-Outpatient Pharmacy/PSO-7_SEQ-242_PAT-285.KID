Released PSO*7*285 SEQ #242
Extracted from mail message
**KIDS**:PSO*7.0*285^

**INSTALL NAME**
PSO*7.0*285
"BLD",7314,0)
PSO*7.0*285^OUTPATIENT PHARMACY^0^3071005^y
"BLD",7314,1,0)
^^15^15^3071005^
"BLD",7314,1,1,0)
This patch has enhancements which extend the capabilities of the Veterans
"BLD",7314,1,2,0)
Health Information Systems and Technology Architecture (VistA) electronic
"BLD",7314,1,3,0)
pharmacy (ePharmacy) system.  
"BLD",7314,1,4,0)
 
"BLD",7314,1,5,0)
This patch modifies the Outpatient Pharmacy (OP) V. 7.0 application in the
"BLD",7314,1,6,0)
following areas:
"BLD",7314,1,7,0)
 
"BLD",7314,1,8,0)
1.  For the Reject Information screen under the Third Party Payer 
"BLD",7314,1,9,0)
Rejects - Worklist [PSO REJECTS WORKLIST] option, the hidden action PL 
"BLD",7314,1,10,0)
for Print List is changed to PT for consistency with other Outpatient 
"BLD",7314,1,11,0)
Pharmacy options.  
"BLD",7314,1,12,0)
 
"BLD",7314,1,13,0)
2.  The ePharmacy Medication Profile (View Only) [PSO PMP] option is 
"BLD",7314,1,14,0)
changed to display discontinued prescriptions that do not have a cancel 
"BLD",7314,1,15,0)
date defined.
"BLD",7314,4,0)
^9.64PA^^
"BLD",7314,6.3)
4
"BLD",7314,"KRN",0)
^9.67PA^8989.52^19
"BLD",7314,"KRN",.4,0)
.4
"BLD",7314,"KRN",.401,0)
.401
"BLD",7314,"KRN",.402,0)
.402
"BLD",7314,"KRN",.403,0)
.403
"BLD",7314,"KRN",.5,0)
.5
"BLD",7314,"KRN",.84,0)
.84
"BLD",7314,"KRN",3.6,0)
3.6
"BLD",7314,"KRN",3.8,0)
3.8
"BLD",7314,"KRN",9.2,0)
9.2
"BLD",7314,"KRN",9.8,0)
9.8
"BLD",7314,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7314,"KRN",9.8,"NM",1,0)
PSOPMP1^^0^B27151615
"BLD",7314,"KRN",9.8,"NM","B","PSOPMP1",1)

"BLD",7314,"KRN",19,0)
19
"BLD",7314,"KRN",19.1,0)
19.1
"BLD",7314,"KRN",101,0)
101
"BLD",7314,"KRN",101,"NM",0)
^9.68A^19^18
"BLD",7314,"KRN",101,"NM",2,0)
PSO REJECT DISPLAY HIDDEN MENU^^0
"BLD",7314,"KRN",101,"NM",3,0)
VALM NEXT SCREEN^^0
"BLD",7314,"KRN",101,"NM",4,0)
VALM PREVIOUS SCREEN^^0
"BLD",7314,"KRN",101,"NM",5,0)
VALM UP ONE LINE^^0
"BLD",7314,"KRN",101,"NM",6,0)
VALM REFRESH^^0
"BLD",7314,"KRN",101,"NM",7,0)
VALM PRINT SCREEN^^0
"BLD",7314,"KRN",101,"NM",8,0)
VALM PRINT LIST^^0
"BLD",7314,"KRN",101,"NM",9,0)
VALM SEARCH LIST^^0
"BLD",7314,"KRN",101,"NM",10,0)
VALM QUIT^^0
"BLD",7314,"KRN",101,"NM",11,0)
VALM LAST SCREEN^^0
"BLD",7314,"KRN",101,"NM",12,0)
VALM FIRST SCREEN^^0
"BLD",7314,"KRN",101,"NM",13,0)
VALM GOTO PAGE^^0
"BLD",7314,"KRN",101,"NM",14,0)
PSO REJECT DISPLAY RX EDIT^^0
"BLD",7314,"KRN",101,"NM",15,0)
PSO REJECT DISPLAY CLARIFICATION CODE^^0
"BLD",7314,"KRN",101,"NM",16,0)
PSO REJECT DISPLAY ADD COMMENT^^0
"BLD",7314,"KRN",101,"NM",17,0)
VALM TURN ON/OFF MENUS^^0
"BLD",7314,"KRN",101,"NM",18,0)
PSO REJECT DISPLAY PRIOR AUTHORIZATION^^0
"BLD",7314,"KRN",101,"NM",19,0)
VALM DOWN A LINE^^0
"BLD",7314,"KRN",101,"NM","B","PSO REJECT DISPLAY ADD COMMENT",16)

"BLD",7314,"KRN",101,"NM","B","PSO REJECT DISPLAY CLARIFICATION CODE",15)

"BLD",7314,"KRN",101,"NM","B","PSO REJECT DISPLAY HIDDEN MENU",2)

"BLD",7314,"KRN",101,"NM","B","PSO REJECT DISPLAY PRIOR AUTHORIZATION",18)

"BLD",7314,"KRN",101,"NM","B","PSO REJECT DISPLAY RX EDIT",14)

"BLD",7314,"KRN",101,"NM","B","VALM DOWN A LINE",19)

"BLD",7314,"KRN",101,"NM","B","VALM FIRST SCREEN",12)

"BLD",7314,"KRN",101,"NM","B","VALM GOTO PAGE",13)

"BLD",7314,"KRN",101,"NM","B","VALM LAST SCREEN",11)

"BLD",7314,"KRN",101,"NM","B","VALM NEXT SCREEN",3)

"BLD",7314,"KRN",101,"NM","B","VALM PREVIOUS SCREEN",4)

"BLD",7314,"KRN",101,"NM","B","VALM PRINT LIST",8)

"BLD",7314,"KRN",101,"NM","B","VALM PRINT SCREEN",7)

"BLD",7314,"KRN",101,"NM","B","VALM QUIT",10)

"BLD",7314,"KRN",101,"NM","B","VALM REFRESH",6)

"BLD",7314,"KRN",101,"NM","B","VALM SEARCH LIST",9)

"BLD",7314,"KRN",101,"NM","B","VALM TURN ON/OFF MENUS",17)

"BLD",7314,"KRN",101,"NM","B","VALM UP ONE LINE",5)

"BLD",7314,"KRN",409.61,0)
409.61
"BLD",7314,"KRN",771,0)
771
"BLD",7314,"KRN",870,0)
870
"BLD",7314,"KRN",8989.51,0)
8989.51
"BLD",7314,"KRN",8989.52,0)
8989.52
"BLD",7314,"KRN",8994,0)
8994
"BLD",7314,"KRN","B",.4,.4)

"BLD",7314,"KRN","B",.401,.401)

"BLD",7314,"KRN","B",.402,.402)

"BLD",7314,"KRN","B",.403,.403)

"BLD",7314,"KRN","B",.5,.5)

"BLD",7314,"KRN","B",.84,.84)

"BLD",7314,"KRN","B",3.6,3.6)

"BLD",7314,"KRN","B",3.8,3.8)

"BLD",7314,"KRN","B",9.2,9.2)

"BLD",7314,"KRN","B",9.8,9.8)

"BLD",7314,"KRN","B",19,19)

"BLD",7314,"KRN","B",19.1,19.1)

"BLD",7314,"KRN","B",101,101)

"BLD",7314,"KRN","B",409.61,409.61)

"BLD",7314,"KRN","B",771,771)

"BLD",7314,"KRN","B",870,870)

"BLD",7314,"KRN","B",8989.51,8989.51)

"BLD",7314,"KRN","B",8989.52,8989.52)

"BLD",7314,"KRN","B",8994,8994)

"BLD",7314,"QUES",0)
^9.62^^
"BLD",7314,"REQB",0)
^9.611^1^1
"BLD",7314,"REQB",1,0)
PSO*7.0*260^2
"BLD",7314,"REQB","B","PSO*7.0*260",1)

"KRN",101,442,-1)
0^3
"KRN",101,442,0)
VALM NEXT SCREEN^Next Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,442,1,0)
^^2^2^2920519^^^
"KRN",101,442,1,1,0)
This action will allow the user to view the next screen
"KRN",101,442,1,2,0)
of entries, if any exist.
"KRN",101,442,2,0)
^101.02A^1^1
"KRN",101,442,2,1,0)
NX
"KRN",101,442,2,"B","NX",1)

"KRN",101,442,15)

"KRN",101,442,20)
D NEXT^VALM4
"KRN",101,442,99)
60899,36456
"KRN",101,443,-1)
0^4
"KRN",101,443,0)
VALM PREVIOUS SCREEN^Previous Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,443,1,0)
^^2^2^2920113^^
"KRN",101,443,1,1,0)
This action will allow the user to view the previous screen
"KRN",101,443,1,2,0)
of entries, if any exist.
"KRN",101,443,2,0)
^101.02A^3^2
"KRN",101,443,2,1,0)
PR
"KRN",101,443,2,2,0)
BK
"KRN",101,443,2,3,0)
PR
"KRN",101,443,2,"B","BK",2)

"KRN",101,443,2,"B","PR",1)

"KRN",101,443,2,"B","PR",3)

"KRN",101,443,20)
D PREV^VALM4
"KRN",101,443,99)
60899,36456
"KRN",101,444,-1)
0^6
"KRN",101,444,0)
VALM REFRESH^Re-Display Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,444,1,0)
^^1^1^2911024^
"KRN",101,444,1,1,0)
This actions allows the user to re-display the current screen.
"KRN",101,444,2,0)
^101.02A^1^1
"KRN",101,444,2,1,0)
RE
"KRN",101,444,2,"B","RE",1)

"KRN",101,444,10,0)
^101.01PA^0^0
"KRN",101,444,20)
D RE^VALM4
"KRN",101,444,99)
60899,36456
"KRN",101,445,-1)
0^11
"KRN",101,445,0)
VALM LAST SCREEN^Last Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,445,1,0)
^^1^1^2911026^
"KRN",101,445,1,1,0)
The action will display the last items.
"KRN",101,445,20)
D LAST^VALM4
"KRN",101,445,99)
60899,36456
"KRN",101,446,-1)
0^12
"KRN",101,446,0)
VALM FIRST SCREEN^First Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,446,1,0)
^^1^1^2960619^^
"KRN",101,446,1,1,0)
This action will display the first screen.
"KRN",101,446,15)

"KRN",101,446,20)
D FIRST^VALM4
"KRN",101,446,99)
60899,36456
"KRN",101,447,-1)
0^5
"KRN",101,447,0)
VALM UP ONE LINE^Up a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,447,1,0)
^^1^1^2911027^
"KRN",101,447,1,1,0)
Move up a line
"KRN",101,447,20)
D UP^VALM40
"KRN",101,447,99)
60899,36456
"KRN",101,448,-1)
0^19
"KRN",101,448,0)
VALM DOWN A LINE^Down a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,448,1,0)
^^2^2^2950628^^
"KRN",101,448,1,1,0)
Move down a line.
"KRN",101,448,1,2,0)

"KRN",101,448,3,0)
^101.03P^0^0
"KRN",101,448,20)
D DOWN^VALM40
"KRN",101,448,99)
60899,36456
"KRN",101,450,-1)
0^10
"KRN",101,450,0)
VALM QUIT^Quit^^A^^^^^^^^
"KRN",101,450,.1)
 
"KRN",101,450,1,0)
^^1^1^2911105^
"KRN",101,450,1,1,0)
This protocol can be used as a generic 'quit' action.
"KRN",101,450,2,0)
^101.02A^2^2
"KRN",101,450,2,1,0)
EXIT
"KRN",101,450,2,2,0)
QUIT
"KRN",101,450,2,"B","EXIT",1)

"KRN",101,450,2,"B","QUIT",2)

"KRN",101,450,15)

"KRN",101,450,20)
Q
"KRN",101,450,99)
60899,36456
"KRN",101,451,-1)
0^7
"KRN",101,451,0)
VALM PRINT SCREEN^Print Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,451,1,0)
^^3^3^2920113^^
"KRN",101,451,1,1,0)
This action allows the user to print the current List Manager
"KRN",101,451,1,2,0)
display screen.  The header and the current portion of the
"KRN",101,451,1,3,0)
list are printed.
"KRN",101,451,20)
D PRT^VALM1
"KRN",101,451,99)
60899,36456
"KRN",101,452,-1)
0^8
"KRN",101,452,0)
VALM PRINT LIST^Print List^^A^^^^^^^^LIST MANAGER
"KRN",101,452,1,0)
^^2^2^2920113^
"KRN",101,452,1,1,0)
This action allws the user to print the entire list of
"KRN",101,452,1,2,0)
entries currently being displayed.
"KRN",101,452,20)
D PRTL^VALM1
"KRN",101,452,99)
60899,36456
"KRN",101,454,-1)
0^17
"KRN",101,454,0)
VALM TURN ON/OFF MENUS^Auto-Display(On/Off)^^A^^^^^^^^LIST MANAGER
"KRN",101,454,20)
D MENU^VALM2
"KRN",101,454,99)
60899,36456
"KRN",101,456,-1)
0^9
"KRN",101,456,0)
VALM SEARCH LIST^Search List^^A^^^^^^^^LIST MANAGER
"KRN",101,456,1,0)
^^1^1^2920303^^
"KRN",101,456,1,1,0)
Finds text in list of entries.
"KRN",101,456,20)
D FIND^VALM40
"KRN",101,456,99)
60899,36456
"KRN",101,466,-1)
0^13
"KRN",101,466,0)
VALM GOTO PAGE^Go to Page^^A^^^^^^^^LIST MANAGER
"KRN",101,466,1,0)
^^1^1^2930113^
"KRN",101,466,1,1,0)

"KRN",101,466,20)
D GOTO^VALM40
"KRN",101,466,99)
60899,36456
"KRN",101,4033,-1)
0^14
"KRN",101,4033,0)
PSO REJECT DISPLAY RX EDIT^Edit Rx^^A^^^^^^^^
"KRN",101,4033,4)
^^^ED
"KRN",101,4033,20)
D EDT^PSOREJP1
"KRN",101,4033,99)
60899,36456
"KRN",101,4117,-1)
0^16
"KRN",101,4117,0)
PSO REJECT DISPLAY ADD COMMENT^Add Comments^^A^^^^^^^^
"KRN",101,4117,20)
D ADDCOM^PSOREJP3
"KRN",101,4117,99)
60899,36456
"KRN",101,4118,-1)
0^15
"KRN",101,4118,0)
PSO REJECT DISPLAY CLARIFICATION CODE^Submit Clarif. Code^^A^^^^^^^^
"KRN",101,4118,4)
^^^CLA
"KRN",101,4118,20)
D CLA^PSOREJP1
"KRN",101,4118,99)
60899,36456
"KRN",101,4155,-1)
0^2
"KRN",101,4155,0)
PSO REJECT DISPLAY HIDDEN MENU^Reject Display Hidden Menu^^M^^^^^^^^
"KRN",101,4155,1,0)
^101.06^1^1^3070320^^^^
"KRN",101,4155,1,1,0)
This is the hidden menu option for the Reject Information(UNRESOLVED) [PSO REJECT DISPLAY] ListMan screen.
"KRN",101,4155,4)
26^3
"KRN",101,4155,10,0)
^101.01PA^20^20
"KRN",101,4155,10,1,0)
442^+^10^
"KRN",101,4155,10,1,"^")
VALM NEXT SCREEN
"KRN",101,4155,10,2,0)
443^-^11^
"KRN",101,4155,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,4155,10,3,0)
447^UP^13^
"KRN",101,4155,10,3,"^")
VALM UP ONE LINE
"KRN",101,4155,10,5,0)
444^RD^19^
"KRN",101,4155,10,5,"^")
VALM REFRESH
"KRN",101,4155,10,6,0)
451^PS^20^
"KRN",101,4155,10,6,"^")
VALM PRINT SCREEN
"KRN",101,4155,10,7,0)
452^PT^21^
"KRN",101,4155,10,7,"^")
VALM PRINT LIST
"KRN",101,4155,10,10,0)
456^SL^22^
"KRN",101,4155,10,10,"^")
VALM SEARCH LIST
"KRN",101,4155,10,11,0)
450^QU^24^
"KRN",101,4155,10,11,"^")
VALM QUIT
"KRN",101,4155,10,12,0)
445^LS^17^
"KRN",101,4155,10,12,"^")
VALM LAST SCREEN
"KRN",101,4155,10,13,0)
446^FS^16^
"KRN",101,4155,10,13,"^")
VALM FIRST SCREEN
"KRN",101,4155,10,14,0)
466^GO^18^
"KRN",101,4155,10,14,"^")
VALM GOTO PAGE
"KRN",101,4155,10,15,0)
4033^ED^3^
"KRN",101,4155,10,15,"^")
PSO REJECT DISPLAY RX EDIT
"KRN",101,4155,10,16,0)
4118^CLA^2^
"KRN",101,4155,10,16,"^")
PSO REJECT DISPLAY CLARIFICATION CODE
"KRN",101,4155,10,17,0)
4117^COM^1^
"KRN",101,4155,10,17,"^")
PSO REJECT DISPLAY ADD COMMENT
"KRN",101,4155,10,18,0)
454^ADPL^23^
"KRN",101,4155,10,18,"^")
VALM TURN ON/OFF MENUS
"KRN",101,4155,10,19,0)
4156^PA^4^
"KRN",101,4155,10,19,"^")
PSO REJECT DISPLAY PRIOR AUTHORIZATION
"KRN",101,4155,10,20,0)
448^DN^12^
"KRN",101,4155,10,20,"^")
VALM DOWN A LINE
"KRN",101,4155,15)

"KRN",101,4155,99)
60908,40883
"KRN",101,4156,-1)
0^18
"KRN",101,4156,0)
PSO REJECT DISPLAY PRIOR AUTHORIZATION^Submit Prior Auth.^^A^^^^^^^^
"KRN",101,4156,4)
^^^PA
"KRN",101,4156,20)
D PA^PSOREJP1
"KRN",101,4156,99)
60899,36456
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,20,0)
^9.402P^^
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
285^3071005
"PKG",206,22,1,"PAH",1,1,0)
^^15^15^3071005
"PKG",206,22,1,"PAH",1,1,1,0)
This patch has enhancements which extend the capabilities of the Veterans
"PKG",206,22,1,"PAH",1,1,2,0)
Health Information Systems and Technology Architecture (VistA) electronic
"PKG",206,22,1,"PAH",1,1,3,0)
pharmacy (ePharmacy) system.  
"PKG",206,22,1,"PAH",1,1,4,0)
 
"PKG",206,22,1,"PAH",1,1,5,0)
This patch modifies the Outpatient Pharmacy (OP) V. 7.0 application in the
"PKG",206,22,1,"PAH",1,1,6,0)
following areas:
"PKG",206,22,1,"PAH",1,1,7,0)
 
"PKG",206,22,1,"PAH",1,1,8,0)
1.  For the Reject Information screen under the Third Party Payer 
"PKG",206,22,1,"PAH",1,1,9,0)
Rejects - Worklist [PSO REJECTS WORKLIST] option, the hidden action PL 
"PKG",206,22,1,"PAH",1,1,10,0)
for Print List is changed to PT for consistency with other Outpatient 
"PKG",206,22,1,"PAH",1,1,11,0)
Pharmacy options.  
"PKG",206,22,1,"PAH",1,1,12,0)
 
"PKG",206,22,1,"PAH",1,1,13,0)
2.  The ePharmacy Medication Profile (View Only) [PSO PMP] option is 
"PKG",206,22,1,"PAH",1,1,14,0)
changed to display discontinued prescriptions that do not have a cancel 
"PKG",206,22,1,"PAH",1,1,15,0)
date defined.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSOPMP1")
0^1^B27151615^B26858864
"RTN","PSOPMP1",1,0)
PSOPMP1 ;BIRM/MFR - Patient Medication Profile - Listmanager ;04/28/05
"RTN","PSOPMP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260,285**;DEC 1997;Build 4
"RTN","PSOPMP1",3,0)
 ;Reference to ^PSDRUG("AQ" supported by IA 3165
"RTN","PSOPMP1",4,0)
 ;Reference to EN1^GMRADPT supported by IA 10099
"RTN","PSOPMP1",5,0)
 ;Reference to ^PSXOPUTL supported by IA 2200
"RTN","PSOPMP1",6,0)
 ;
"RTN","PSOPMP1",7,0)
VIDEO() ; - Changes the Video Attributes for the list
"RTN","PSOPMP1",8,0)
 ;
"RTN","PSOPMP1",9,0)
 ; - Highlighting the PRESCRIPTION line if SIG is displayed
"RTN","PSOPMP1",10,0)
 I $G(PSOSIGDP) D
"RTN","PSOPMP1",11,0)
 . F I=1:1:LINE D
"RTN","PSOPMP1",12,0)
 . . I $D(HIGHLN(I)) D CNTRL^VALM10(I,1,80,IOINHI,IOINORM)
"RTN","PSOPMP1",13,0)
 ;
"RTN","PSOPMP1",14,0)
 ; - Highlighting the group lines (order type and status)
"RTN","PSOPMP1",15,0)
 I $D(GRPLN) D
"RTN","PSOPMP1",16,0)
 . S LN=0 F I=1:1 S LN=$O(GRPLN(LN)) Q:'LN  D
"RTN","PSOPMP1",17,0)
 . . S LBL=GRPLN(LN),POS=41-($L(LBL)\2)
"RTN","PSOPMP1",18,0)
 . . D CNTRL^VALM10(LN,1,POS-1,IOUON_IOINHI,IOINORM)
"RTN","PSOPMP1",19,0)
 . . D CNTRL^VALM10(LN,POS,$L(LBL),IORVON_IOINHI,IOINORM)
"RTN","PSOPMP1",20,0)
 . . D CNTRL^VALM10(LN,POS+$L(LBL),81-POS-$L(LBL),IOUON_IOINHI,IOINORM)
"RTN","PSOPMP1",21,0)
 Q
"RTN","PSOPMP1",22,0)
 ;
"RTN","PSOPMP1",23,0)
SETHDR() ; - Displays the Header Line
"RTN","PSOPMP1",24,0)
 N HDR,ORD,POS
"RTN","PSOPMP1",25,0)
 ;
"RTN","PSOPMP1",26,0)
 ; - Line 1
"RTN","PSOPMP1",27,0)
 S $E(HDR,57)="ISSUE",$E(HDR,66)="LAST",$E(HDR,74)="REF",$E(HDR,78)="DAY"
"RTN","PSOPMP1",28,0)
 S $E(HDR,81)="" D INSTR^VALM1(IORVON_HDR_IOINORM,1,6)
"RTN","PSOPMP1",29,0)
 ; - Line 2
"RTN","PSOPMP1",30,0)
 S HDR="  #",$E(HDR,5)="Rx#",$E(HDR,19)="DRUG",$E(HDR,49)="QTY",$E(HDR,53)="ST"
"RTN","PSOPMP1",31,0)
 S $E(HDR,57)="DATE",$E(HDR,66)="FILL",$E(HDR,74)="REM",$E(HDR,78)="SUP"
"RTN","PSOPMP1",32,0)
 S $E(HDR,81)="" D INSTR^VALM1(IORVON_HDR_IOINORM,1,7)
"RTN","PSOPMP1",33,0)
 S ORD=$S(PSORDER="A":"[^]",1:"[v]")
"RTN","PSOPMP1",34,0)
 S:PSOSRTBY="RX" POS=9 S:PSOSRTBY="DR" POS=24 S:PSOSRTBY="ID" POS=61 S:PSOSRTBY="LF" POS=70
"RTN","PSOPMP1",35,0)
 D INSTR^VALM1(IOINHI_IORVON_ORD_IOINORM,POS,7)
"RTN","PSOPMP1",36,0)
 Q
"RTN","PSOPMP1",37,0)
 ;
"RTN","PSOPMP1",38,0)
SETSIG(TYPE,RX,LINE,DFN) ; Set the SIG line
"RTN","PSOPMP1",39,0)
 N FSIG,L,X,DIWL,DIWR
"RTN","PSOPMP1",40,0)
 ;
"RTN","PSOPMP1",41,0)
 I TYPE="N" D  Q
"RTN","PSOPMP1",42,0)
 . K ^UTILITY($J,"W")
"RTN","PSOPMP1",43,0)
 . S X=$$SCHED^PSONVNEW($$GET1^DIQ(55.05,RX_","_DFN,4)),DIWL=1,DIWR=71 D ^DIWP
"RTN","PSOPMP1",44,0)
 . F L=1:1 Q:'$D(^UTILITY($J,"W",1,L))  D
"RTN","PSOPMP1",45,0)
 . . S X="" S:L=1 $E(X,5)="SIG:" S $E(X,10)=^UTILITY($J,"W",1,L,0)
"RTN","PSOPMP1",46,0)
 . . S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X
"RTN","PSOPMP1",47,0)
 ;
"RTN","PSOPMP1",48,0)
 D FSIG^PSOUTLA(TYPE,+RX,71)
"RTN","PSOPMP1",49,0)
 F L=1:1 Q:'$D(FSIG(L))  D
"RTN","PSOPMP1",50,0)
 . S X="" S:L=1 $E(X,5)="SIG:" S $E(X,10)=FSIG(L)
"RTN","PSOPMP1",51,0)
 . S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X
"RTN","PSOPMP1",52,0)
 Q
"RTN","PSOPMP1",53,0)
 ;
"RTN","PSOPMP1",54,0)
GROUP(LBL,CNT,LINE) ; Sets a group delimiter line
"RTN","PSOPMP1",55,0)
 N X,POS
"RTN","PSOPMP1",56,0)
 S LBL=LBL_$S(PSORDCNT:" ("_CNT_" order"_$S(CNT>1:"s",1:"")_")",1:"")
"RTN","PSOPMP1",57,0)
 S POS=41-($L(LBL)\2)
"RTN","PSOPMP1",58,0)
 S X="",$P(X," ",81)="",$E(X,POS,POS-1+$L(LBL))=LBL
"RTN","PSOPMP1",59,0)
 S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X,GRPLN(LINE)=LBL
"RTN","PSOPMP1",60,0)
 Q
"RTN","PSOPMP1",61,0)
 ;
"RTN","PSOPMP1",62,0)
PENHDR(DFN) ; Sets the Header in the ^TMP("PSOHDR",$J) global for displaying individual Pending Order
"RTN","PSOPMP1",63,0)
 N VADM,WT,HT,PSOERR,GMRA
"RTN","PSOPMP1",64,0)
 K ^TMP("PSOHDR",$J) D ^VADPT,ADD^VADPT
"RTN","PSOPMP1",65,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1),^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSOPMP1",66,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSOPMP1",67,0)
 S POERR=1 D RE^PSODEM K PSOERR
"RTN","PSOPMP1",68,0)
 S ^TMP("PSOHDR",$J,6,0)=$S(+$P(WT,"^",8):$J($P(WT,"^",9),6)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSOPMP1",69,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$J($P(HT,"^",9),6)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSOPMP1",70,0)
 S GMRA="0^0^111" D EN1^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSOPMP1",71,0)
 Q
"RTN","PSOPMP1",72,0)
 ;
"RTN","PSOPMP1",73,0)
FILTER(RX) ; - Filter Rx's that should not be displayed
"RTN","PSOPMP1",74,0)
 I $$GET1^DIQ(52,RX,26,"I")<PSOEXPDC Q 1
"RTN","PSOPMP1",75,0)
 I $$GET1^DIQ(52,RX,26.1,"I"),$$GET1^DIQ(52,RX,26.1,"I")<PSOEXPDC,$$GET1^DIQ(52,RX,100,"I")>11,$$GET1^DIQ(52,RX,100,"I")'=16 Q 1
"RTN","PSOPMP1",76,0)
 I $$GET1^DIQ(52,RX,100,"I")=""!($$GET1^DIQ(52,RX,100,"I")=13) Q 1
"RTN","PSOPMP1",77,0)
 I $$GET1^DIQ(52,RX,.01)="" Q 1
"RTN","PSOPMP1",78,0)
 Q 0
"RTN","PSOPMP1",79,0)
 ;
"RTN","PSOPMP1",80,0)
STSINFO(RX) ; Returns the Rx Status MNEMONIC^NAME
"RTN","PSOPMP1",81,0)
 ; Input: RX - Prescription IEN (#52)
"RTN","PSOPMP1",82,0)
 ;Output: Status Mnemonic ("A","DC",etc.)^Status Name ("ACTIVE","DISCONTINUED",etc.)
"RTN","PSOPMP1",83,0)
 ;
"RTN","PSOPMP1",84,0)
 N STS
"RTN","PSOPMP1",85,0)
 I '$D(^PSRX(RX,"STA")) Q ""
"RTN","PSOPMP1",86,0)
 S STS=$$GET1^DIQ(52,RX,100,"I")
"RTN","PSOPMP1",87,0)
 I STS=0 Q:$$GET1^DIQ(52,RX,26,"I")>DT PSOSTSEQ("A") Q PSOSTSEQ("E")
"RTN","PSOPMP1",88,0)
 I STS=1 Q PSOSTSEQ("N")
"RTN","PSOPMP1",89,0)
 I STS=3 Q PSOSTSEQ("H")
"RTN","PSOPMP1",90,0)
 I STS=5 Q PSOSTSEQ("S")
"RTN","PSOPMP1",91,0)
 I STS=11 Q PSOSTSEQ("E")
"RTN","PSOPMP1",92,0)
 I STS=12 Q PSOSTSEQ("DC")
"RTN","PSOPMP1",93,0)
 I STS=14 Q PSOSTSEQ("DP")
"RTN","PSOPMP1",94,0)
 I STS=15 Q PSOSTSEQ("DE")
"RTN","PSOPMP1",95,0)
 I STS=16 Q PSOSTSEQ("PH")
"RTN","PSOPMP1",96,0)
 Q "99^UNKNOWN^??"
"RTN","PSOPMP1",97,0)
 ; 
"RTN","PSOPMP1",98,0)
ISSDT(IEN,TYPE) ; Returns the Rx ISSUE DATE formatted MM-DD-YY
"RTN","PSOPMP1",99,0)
 ;Input: RX   - PrescrXiption IEN (#52)
"RTN","PSOPMP1",100,0)
 ;       TYPE - "R":Regular Rx, "P":Pending order
"RTN","PSOPMP1",101,0)
 N ISSDT
"RTN","PSOPMP1",102,0)
 I TYPE="R" S ISSDT=$$GET1^DIQ(52,IEN,1,"I")
"RTN","PSOPMP1",103,0)
 I TYPE="P" S ISSDT=$$GET1^DIQ(52.41,IEN,6,"I")
"RTN","PSOPMP1",104,0)
 I ISSDT'="" S ISSDT=ISSDT\1
"RTN","PSOPMP1",105,0)
 ;
"RTN","PSOPMP1",106,0)
 Q (ISSDT_"^"_$$DAT(ISSDT,"-"))
"RTN","PSOPMP1",107,0)
 ;
"RTN","PSOPMP1",108,0)
LSTFD(RX) ; Returns the Rx LAST FILL DATE formatted MM-DD-YY[R], where [R] = Returned to Stock
"RTN","PSOPMP1",109,0)
 ;Input: RX  - Prescription IEN (#52)
"RTN","PSOPMP1",110,0)
 N LSTFD,RTSTK,RFL
"RTN","PSOPMP1",111,0)
 S LSTFD=$$GET1^DIQ(52,RX,101,"I")\1 I LSTFD="" Q ""
"RTN","PSOPMP1",112,0)
 I '$$LSTRFL^PSOBPSU1(RX) D
"RTN","PSOPMP1",113,0)
 . I $$GET1^DIQ(52,RX,32.1,"I") S RTSTK="R"
"RTN","PSOPMP1",114,0)
 E  S RFL=0 F  S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  D
"RTN","PSOPMP1",115,0)
 . I $$RXFLDT^PSOBPSUT(RX,RFL)'=LSTFD Q
"RTN","PSOPMP1",116,0)
 . I $$GET1^DIQ(52.1,RFL_","_RX,14,"I") S RTSTK="R"
"RTN","PSOPMP1",117,0)
 ;
"RTN","PSOPMP1",118,0)
 Q (LSTFD_"^"_$$DAT(LSTFD,"-")_$G(RTSTK))
"RTN","PSOPMP1",119,0)
 ;
"RTN","PSOPMP1",120,0)
REFREM(RX) ; - Returns the number of refills remaining
"RTN","PSOPMP1",121,0)
 N REFREM,RFL
"RTN","PSOPMP1",122,0)
 S REFREM=+$$GET1^DIQ(52,RX,9)
"RTN","PSOPMP1",123,0)
 F RFL=0:1 S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  S REFREM=REFREM-1
"RTN","PSOPMP1",124,0)
 Q $S(REFREM<0:0,1:REFREM)
"RTN","PSOPMP1",125,0)
 ;
"RTN","PSOPMP1",126,0)
 ;
"RTN","PSOPMP1",127,0)
DAT(FMDT,SEP,Y4) ; - Formats FM dates to MM/DD/YY (SEP: Separator:"/","-",etc...)
"RTN","PSOPMP1",128,0)
 ;Input: (r) FMDT - Fileman Date
"RTN","PSOPMP1",129,0)
 ;       (r) SEP  - Separator
"RTN","PSOPMP1",130,0)
 ;       (o) Y4   - 4 digits year flag
"RTN","PSOPMP1",131,0)
 I $G(FMDT)="" Q ""
"RTN","PSOPMP1",132,0)
 I '$E(FMDT,6,7)!'$E(FMDT,4,7) Q $$UP^XLFSTR($TR($$FMTE^XLFDT(FMDT)," ","-"))
"RTN","PSOPMP1",133,0)
 Q ($E(FMDT,4,5)_SEP_$E(FMDT,6,7)_SEP_$S($G(Y4):$E(FMDT,1,3)+1700,1:$E(FMDT,2,3)))
"RTN","PSOPMP1",134,0)
 ;
"RTN","PSOPMP1",135,0)
COPAY(RX) ; Returns "$" is Rx has a copay and "" if not
"RTN","PSOPMP1",136,0)
 Q $S($D(^PSRX(RX,"IB")):"$",1:"")
"RTN","PSOPMP1",137,0)
 ;
"RTN","PSOPMP1",138,0)
CMOP(DRUG,RX) ; Returns the CMOP indicator (">", "T", etc)
"RTN","PSOPMP1",139,0)
 N CMOP,X,DA,PSXZ
"RTN","PSOPMP1",140,0)
 S CMOP="" I $D(^PSDRUG("AQ",DRUG)) S CMOP=">"
"RTN","PSOPMP1",141,0)
 I $G(RX) S DA=RX D ^PSXOPUTL I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S CMOP="T"
"RTN","PSOPMP1",142,0)
 Q CMOP
"RTN","PSOPMP1",143,0)
 ;
"RTN","PSOPMP1",144,0)
ALLERGY(LINE,DFN,POS) ; also called from PSONVAVW & PSOPMP0
"RTN","PSOPMP1",145,0)
 ; Input:  LINE - (r) text to concatenate allergy information to
"RTN","PSOPMP1",146,0)
 ;         DFN - (r) patient IEN used for ^GMRADTP
"RTN","PSOPMP1",147,0)
 ;         POS - (o) position # to include text
"RTN","PSOPMP1",148,0)
 ;Output: LINE - modified text
"RTN","PSOPMP1",149,0)
 N ALLERGY,PSONOAL
"RTN","PSOPMP1",150,0)
 S (PSONOAL,ALLERGY)=""
"RTN","PSOPMP1",151,0)
 D EN1^GMRADPT
"RTN","PSOPMP1",152,0)
 I GMRAL S ALLERGY="<A>"
"RTN","PSOPMP1",153,0)
 E  D ALLERGY^PSOORUT2 I PSONOAL'="" S ALLERGY="<NO ALLERGY ASSESSMENT>"
"RTN","PSOPMP1",154,0)
 S ALLERGY=IORVON_ALLERGY_IOINORM
"RTN","PSOPMP1",155,0)
 I '$G(POS) S POS=80-$L(ALLERGY)
"RTN","PSOPMP1",156,0)
 S LINE=$$SETSTR^VALM1(ALLERGY,LINE,POS,80)
"RTN","PSOPMP1",157,0)
 Q LINE
"VER")
8.0^22.0
"BLD",7314,6)
^242
**END**
**END**
