Released PX*1*133 SEQ #106
Extracted from mail message
**KIDS**:PX*1.0*133^

**INSTALL NAME**
PX*1.0*133
"BLD",5493,0)
PX*1.0*133^PCE PATIENT CARE ENCOUNTER^0^3040405^y
"BLD",5493,1,0)
^9.61A^1^1^3040405^^^
"BLD",5493,1,1,0)
Fix error in PCE Encounter Summary when clinic is null. 
"BLD",5493,4,0)
^9.64PA^^
"BLD",5493,"KRN",0)
^9.67PA^8989.52^19
"BLD",5493,"KRN",.4,0)
.4
"BLD",5493,"KRN",.401,0)
.401
"BLD",5493,"KRN",.402,0)
.402
"BLD",5493,"KRN",.403,0)
.403
"BLD",5493,"KRN",.5,0)
.5
"BLD",5493,"KRN",.84,0)
.84
"BLD",5493,"KRN",3.6,0)
3.6
"BLD",5493,"KRN",3.8,0)
3.8
"BLD",5493,"KRN",9.2,0)
9.2
"BLD",5493,"KRN",9.8,0)
9.8
"BLD",5493,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5493,"KRN",9.8,"NM",1,0)
PXRRWLS2^^0^B28396009
"BLD",5493,"KRN",9.8,"NM","B","PXRRWLS2",1)

"BLD",5493,"KRN",19,0)
19
"BLD",5493,"KRN",19.1,0)
19.1
"BLD",5493,"KRN",101,0)
101
"BLD",5493,"KRN",409.61,0)
409.61
"BLD",5493,"KRN",771,0)
771
"BLD",5493,"KRN",870,0)
870
"BLD",5493,"KRN",8989.51,0)
8989.51
"BLD",5493,"KRN",8989.52,0)
8989.52
"BLD",5493,"KRN",8994,0)
8994
"BLD",5493,"KRN","B",.4,.4)

"BLD",5493,"KRN","B",.401,.401)

"BLD",5493,"KRN","B",.402,.402)

"BLD",5493,"KRN","B",.403,.403)

"BLD",5493,"KRN","B",.5,.5)

"BLD",5493,"KRN","B",.84,.84)

"BLD",5493,"KRN","B",3.6,3.6)

"BLD",5493,"KRN","B",3.8,3.8)

"BLD",5493,"KRN","B",9.2,9.2)

"BLD",5493,"KRN","B",9.8,9.8)

"BLD",5493,"KRN","B",19,19)

"BLD",5493,"KRN","B",19.1,19.1)

"BLD",5493,"KRN","B",101,101)

"BLD",5493,"KRN","B",409.61,409.61)

"BLD",5493,"KRN","B",771,771)

"BLD",5493,"KRN","B",870,870)

"BLD",5493,"KRN","B",8989.51,8989.51)

"BLD",5493,"KRN","B",8989.52,8989.52)

"BLD",5493,"KRN","B",8994,8994)

"BLD",5493,"QUES",0)
^9.62^^
"BLD",5493,"REQB",0)
^9.611^1^1
"BLD",5493,"REQB",1,0)
PX*1.0*61^2
"BLD",5493,"REQB","B","PX*1.0*61",1)

"MBREQ")
0
"PKG",413,-1)
1^1
"PKG",413,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)^
"PKG",413,20,0)
^9.402P^^
"PKG",413,22,0)
^9.49I^1^1
"PKG",413,22,1,0)
1.0^2960812^2960913^12537
"PKG",413,22,1,"PAH",1,0)
133^3040405
"PKG",413,22,1,"PAH",1,1,0)
^^1^1^3040405
"PKG",413,22,1,"PAH",1,1,1,0)
Fix error in PCE Encounter Summary when clinic is null. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PXRRWLS2")
0^1^B28396009
"RTN","PXRRWLS2",1,0)
PXRRWLS2 ;ISA/Zoltan - Sort encounters for encounter summary report.;12/1/1998
"RTN","PXRRWLS2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**58,61,133**;Aug 12, 1996
"RTN","PXRRWLS2",3,0)
 ;
"RTN","PXRRWLS2",4,0)
 ; Code migrated from PXRRWLSE.
"RTN","PXRRWLS2",5,0)
 ;
"RTN","PXRRWLS2",6,0)
 ; Part 1:  migrated code.
"RTN","PXRRWLS2",7,0)
SORT2 ; Migrated from PXRRWLSE
"RTN","PXRRWLS2",8,0)
 I '(PXRRQUE!$D(IO("S"))) D INIT^PXRRBUSY(.BUSY)
"RTN","PXRRWLS2",9,0)
 ;
"RTN","PXRRWLS2",10,0)
 ;Location is true if we are screening by location.
"RTN","PXRRWLS2",11,0)
 I $P(PXRRWLSC,U,1)="L" D
"RTN","PXRRWLS2",12,0)
 . S LOCATION=1
"RTN","PXRRWLS2",13,0)
 . S ^XTMP(PXRRXTMP,"STOIND","LOCATION")=""
"RTN","PXRRWLS2",14,0)
 E  S LOCATION=0
"RTN","PXRRWLS2",15,0)
 ;
"RTN","PXRRWLS2",16,0)
 ;CSSCR is true if we want selected clinics.
"RTN","PXRRWLS2",17,0)
 I $P($G(PXRRLCSC),U,1)="CS" S CSSCR=1
"RTN","PXRRWLS2",18,0)
 E  S CSSCR=0
"RTN","PXRRWLS2",19,0)
 ;
"RTN","PXRRWLS2",20,0)
 ;CLINIC is true if we want clinics instead of hospital locations.
"RTN","PXRRWLS2",21,0)
 I $P($G(PXRRLCSC),U,1)["C" D
"RTN","PXRRWLS2",22,0)
 . S CLINIC=1
"RTN","PXRRWLS2",23,0)
 . S BYCLOC=$S($P(PXRRLCSC,U,3):1,1:0)
"RTN","PXRRWLS2",24,0)
 E  D
"RTN","PXRRWLS2",25,0)
 . S CLINIC=0
"RTN","PXRRWLS2",26,0)
 . S BYCLOC=0
"RTN","PXRRWLS2",27,0)
 ;
"RTN","PXRRWLS2",28,0)
 ;HSSCR is true if we want selected hospital locations.
"RTN","PXRRWLS2",29,0)
 I $P($G(PXRRLCSC),U,1)="HS" S HSSCR=1
"RTN","PXRRWLS2",30,0)
 E  S HSSCR=0
"RTN","PXRRWLS2",31,0)
 ;
"RTN","PXRRWLS2",32,0)
 ;PROVIDER is true if we select by provider.
"RTN","PXRRWLS2",33,0)
 I $P($G(PXRRWLSC),U,1)="P" D
"RTN","PXRRWLS2",34,0)
 . S PROVIDER=1
"RTN","PXRRWLS2",35,0)
 . S ^XTMP(PXRRXTMP,"STOIND","PROVIDER")=""
"RTN","PXRRWLS2",36,0)
 E  S PROVIDER=0
"RTN","PXRRWLS2",37,0)
 ;
"RTN","PXRRWLS2",38,0)
 ;PRVSCR is true if we have selected providers.
"RTN","PXRRWLS2",39,0)
 I $D(NPL) S PRVSCR=1
"RTN","PXRRWLS2",40,0)
 E  S PRVSCR=0
"RTN","PXRRWLS2",41,0)
 ;
"RTN","PXRRWLS2",42,0)
 ;Allow the task to be cleaned up upon successful completion.
"RTN","PXRRWLS2",43,0)
 S ZTREQ="@"
"RTN","PXRRWLS2",44,0)
 Q
"RTN","PXRRWLS2",45,0)
 ;
"RTN","PXRRWLS2",46,0)
VISIT2 ; Migrated from PXRRWLSE
"RTN","PXRRWLS2",47,0)
 ;Clinic screen.
"RTN","PXRRWLS2",48,0)
 I CSSCR D
"RTN","PXRRWLS2",49,0)
 . S FOUND=0
"RTN","PXRRWLS2",50,0)
 . S CLINIEN=$P(VISIT,U,8)
"RTN","PXRRWLS2",51,0)
 . F IC=1:1:NCS I $P(PXRRCS(IC),U,2)=CLINIEN D  Q
"RTN","PXRRWLS2",52,0)
 ..;Mark the clinic as being matched.
"RTN","PXRRWLS2",53,0)
 .. S $P(PXRRCS(IC),U,4)="M"
"RTN","PXRRWLS2",54,0)
 .. S HLOCNAM=$P(^DIC(40.7,CLINIEN,0),U,1)_U_CLINIEN
"RTN","PXRRWLS2",55,0)
 .. S FOUND=1
"RTN","PXRRWLS2",56,0)
 ;
"RTN","PXRRWLS2",57,0)
 ;Hospital location screen.
"RTN","PXRRWLS2",58,0)
 I HSSCR D
"RTN","PXRRWLS2",59,0)
 . S FOUND=0
"RTN","PXRRWLS2",60,0)
 . S HLOCIEN=$P(VISIT,U,22)
"RTN","PXRRWLS2",61,0)
 . F IC=1:1:NHL I $P(PXRRLCHL(IC),U,2)=HLOCIEN D  Q
"RTN","PXRRWLS2",62,0)
 ..;Mark the hospital location as being matched.
"RTN","PXRRWLS2",63,0)
 .. S $P(PXRRLCHL(IC),U,4)="M"
"RTN","PXRRWLS2",64,0)
 .. S CLINIEN=$P(^SC(HLOCIEN,0),U,7)
"RTN","PXRRWLS2",65,0)
 .. S HLOCNAM=$P(^SC(HLOCIEN,0),U,1)_U_HLOCIEN
"RTN","PXRRWLS2",66,0)
 .. S FOUND=1
"RTN","PXRRWLS2",67,0)
 Q
"RTN","PXRRWLS2",68,0)
 ;
"RTN","PXRRWLS2",69,0)
PRV2 ; Migrated from PXRRWLSE
"RTN","PXRRWLS2",70,0)
 ;At this point we have an encounter that can be added to the list.
"RTN","PXRRWLS2",71,0)
 ;
"RTN","PXRRWLS2",72,0)
 ;Get the hospital location or clinic and stop code.
"RTN","PXRRWLS2",73,0)
 I $L(HLOCNAM)'>0 D
"RTN","PXRRWLS2",74,0)
 . I 'CLINIC D
"RTN","PXRRWLS2",75,0)
 .. ;Get the hospital location.
"RTN","PXRRWLS2",76,0)
 .. S HLOCIEN=$P(VISIT,U,22)
"RTN","PXRRWLS2",77,0)
 .. I HLOCIEN>0 D
"RTN","PXRRWLS2",78,0)
 ... S HLOCNAM=$P(^SC(HLOCIEN,0),U,1)_U_HLOCIEN
"RTN","PXRRWLS2",79,0)
 ... S CLINIEN=$P(^SC(HLOCIEN,0),U,7)
"RTN","PXRRWLS2",80,0)
 .. E  D
"RTN","PXRRWLS2",81,0)
 ...;No hospital location, see if we can at least find the clinic.
"RTN","PXRRWLS2",82,0)
 ... S HLOCNAM="Unknown"
"RTN","PXRRWLS2",83,0)
 ... S CLINIEN=$P(VISIT,U,8)
"RTN","PXRRWLS2",84,0)
 . E  D
"RTN","PXRRWLS2",85,0)
 .. ;Get the clinic.
"RTN","PXRRWLS2",86,0)
 .. S CLINIEN=$P(VISIT,U,8)
"RTN","PXRRWLS2",87,0)
 .. I CLINIEN="" S CLINIEN=0
"RTN","PXRRWLS2",88,0)
 .. I CLINIEN,$D(^DIC(40.7,CLINIEN,0))[0 S CLINIEN=0
"RTN","PXRRWLS2",89,0)
 .. I CLINIEN>0 S HLOCNAM=$P(^DIC(40.7,CLINIEN,0),U,1)_U_CLINIEN
"RTN","PXRRWLS2",90,0)
 .. E  S HLOCNAM="Unknown"
"RTN","PXRRWLS2",91,0)
 ;
"RTN","PXRRWLS2",92,0)
 ;Append the clinic stop code.
"RTN","PXRRWLS2",93,0)
 I CLINIEN>0 S HLOCNAM=HLOCNAM_U_$P(^DIC(40.7,CLINIEN,0),U,2)
"RTN","PXRRWLS2",94,0)
 ;
"RTN","PXRRWLS2",95,0)
 I LOCATION S STOIND=HLOCNAM
"RTN","PXRRWLS2",96,0)
 ;Make sure that all providers are stored with the person class.
"RTN","PXRRWLS2",97,0)
 I PROVIDER D
"RTN","PXRRWLS2",98,0)
 . I $P(PPNAME,U,3)="" D
"RTN","PXRRWLS2",99,0)
 .. S PCLASS=$$OCCUP^PXBGPRV(NEWPIEN,BD,"",1,"")
"RTN","PXRRWLS2",100,0)
 .. S PPNAME=PPNAME_U_$P(PCLASS,U,7)
"RTN","PXRRWLS2",101,0)
 . S STOIND=PPNAME_U
"RTN","PXRRWLS2",102,0)
 . I PXRRPRLL S STOIND=STOIND_HLOCNAM
"RTN","PXRRWLS2",103,0)
 ;
"RTN","PXRRWLS2",104,0)
 ;Save the patient information.
"RTN","PXRRWLS2",105,0)
 S TEMP=^AUPNVSIT(VIEN,0)
"RTN","PXRRWLS2",106,0)
 S DATE=$P(TEMP,U,1)
"RTN","PXRRWLS2",107,0)
 S DAY=$P(DATE,".",1)
"RTN","PXRRWLS2",108,0)
 S DFN=$P(TEMP,U,5)
"RTN","PXRRWLS2",109,0)
 ;Get the patient status, 1 is in, 0 is out.
"RTN","PXRRWLS2",110,0)
 S INOUT=$P(VISIT150,U,2)
"RTN","PXRRWLS2",111,0)
 I $L(INOUT)=0 S INOUT=-1
"RTN","PXRRWLS2",112,0)
 Q
"RTN","PXRRWLS2",113,0)
 ;
"RTN","PXRRWLS2",114,0)
GC2 ; Migrated from PXRRWLSE
"RTN","PXRRWLS2",115,0)
 S CPT=$P(^AUPNVCPT(IC,0),U,1)
"RTN","PXRRWLS2",116,0)
 I +CPT'>0 D
"RTN","PXRRWLS2",117,0)
 . W !,"WARNING AUPNVCPT IS CORRUPTED! ENTRY ",IC," does not have a CPT code."
"RTN","PXRRWLS2",118,0)
 . S CPT=0
"RTN","PXRRWLS2",119,0)
 E  D
"RTN","PXRRWLS2",120,0)
 . S EM=$P($G(^IBE(357.69,CPT,0)),U,5)
"RTN","PXRRWLS2",121,0)
 . I EM="" S EM=0
"RTN","PXRRWLS2",122,0)
 ;
"RTN","PXRRWLS2",123,0)
 ;Increment the CPT and E&M counts.
"RTN","PXRRWLS2",124,0)
 S ^XTMP(PXRRXTMP,FACILITY,STOIND,"CPT")=$G(^XTMP(PXRRXTMP,FACILITY,STOIND,"CPT"))+1
"RTN","PXRRWLS2",125,0)
 S ^XTMP(PXRRXTMP,FACILITY,STOIND,"EM",EM)=$G(^XTMP(PXRRXTMP,FACILITY,STOIND,"EM",EM))+1
"RTN","PXRRWLS2",126,0)
 ;Calculate totals by facility for multiple provider encounters.
"RTN","PXRRWLS2",127,0)
 I MULTPR=1 D
"RTN","PXRRWLS2",128,0)
 . D FTOT(FACILITY,"&&","CPT")
"RTN","PXRRWLS2",129,0)
 . D FTOT1(FACILITY,"&&","EM",EM)
"RTN","PXRRWLS2",130,0)
 Q
"RTN","PXRRWLS2",131,0)
 ;
"RTN","PXRRWLS2",132,0)
 ;Totals for multiple provider encounters - used in PXRRWLPR.
"RTN","PXRRWLS2",133,0)
FTOT(FL,FLD,FL1) ;
"RTN","PXRRWLS2",134,0)
 S ^XTMP(PXRRXTMP,FL,FLD,FL1)=$G(^XTMP(PXRRXTMP,FL,FLD,FL1))+1
"RTN","PXRRWLS2",135,0)
 Q
"RTN","PXRRWLS2",136,0)
FTOT1(FL,FLD,FL1,FL2) ;
"RTN","PXRRWLS2",137,0)
 S ^XTMP(PXRRXTMP,FL,FLD,FL1,FL2)=$G(^XTMP(PXRRXTMP,FL,FLD,FL1,FL2))+1
"RTN","PXRRWLS2",138,0)
 Q
"RTN","PXRRWLS2",139,0)
 ;
"RTN","PXRRWLS2",140,0)
NF2 ; Migrated from PXRRWLSE
"RTN","PXRRWLS2",141,0)
 ;Count the total unique patients and visits at the facility.
"RTN","PXRRWLS2",142,0)
 S TOTUNIQ=0
"RTN","PXRRWLS2",143,0)
 S TOTVIS=0
"RTN","PXRRWLS2",144,0)
 S VISITS(0)=0
"RTN","PXRRWLS2",145,0)
 S VISITS(1)=0
"RTN","PXRRWLS2",146,0)
 S DFN=0
"RTN","PXRRWLS2",147,0)
 F  S DFN=$O(^TMP(PXRRXTMP,$J,FACILITY,"&","PATIENT",DFN)) Q:DFN=""  D
"RTN","PXRRWLS2",148,0)
 . S TOTUNIQ=TOTUNIQ+1
"RTN","PXRRWLS2",149,0)
 . S DAY=""
"RTN","PXRRWLS2",150,0)
 . F  S DAY=$O(^TMP(PXRRXTMP,$J,FACILITY,"&","PATIENT",DFN,DAY)) Q:DAY=""  D
"RTN","PXRRWLS2",151,0)
 .. S TOTVIS=TOTVIS+1
"RTN","PXRRWLS2",152,0)
 .. S INOUT=-1
"RTN","PXRRWLS2",153,0)
 .. F  S INOUT=$O(^TMP(PXRRXTMP,$J,FACILITY,"&","PATIENT",DFN,DAY,INOUT)) Q:INOUT=""  D
"RTN","PXRRWLS2",154,0)
 ... S VISITS(INOUT)=VISITS(INOUT)+1
"RTN","PXRRWLS2",155,0)
 S ^XTMP(PXRRXTMP,FACILITY,"&","TOTUNIQ")=TOTUNIQ
"RTN","PXRRWLS2",156,0)
 S ^XTMP(PXRRXTMP,FACILITY,"&","TOTVIS")=TOTVIS
"RTN","PXRRWLS2",157,0)
 S ^XTMP(PXRRXTMP,FACILITY,"&","TOTINOUT",0)=VISITS(0)
"RTN","PXRRWLS2",158,0)
 S ^XTMP(PXRRXTMP,FACILITY,"&","TOTINOUT",1)=VISITS(1)
"RTN","PXRRWLS2",159,0)
 Q
"RTN","PXRRWLS2",160,0)
 ;
"RTN","PXRRWLS2",161,0)
CLOC2 ; Migrated from PXRRWLSE
"RTN","PXRRWLS2",162,0)
 ;Save this to count the total number of unique patients and
"RTN","PXRRWLS2",163,0)
 ;the total unique in/out patient encounters.
"RTN","PXRRWLS2",164,0)
 S ^TMP(PXRRXTMP,$J,FACILITY,"&","PATIENT",DFN,DAY,INOUT)=""
"RTN","PXRRWLS2",165,0)
 ;
"RTN","PXRRWLS2",166,0)
 ;Save this to count the unique in/out patient encounters.
"RTN","PXRRWLS2",167,0)
 S ^TMP(PXRRXTMP,$J,FACILITY,STOIND,"PATIENT",DFN,DAY,INOUT)=""
"RTN","PXRRWLS2",168,0)
 ;
"RTN","PXRRWLS2",169,0)
 ;Save this information so we can search for appointments in PXRRWLSA.
"RTN","PXRRWLS2",170,0)
 S ^XTMP(PXRRXTMP,FACILITY,STOIND,"PATIENT",DFN,DATE,VIEN)=MULTPR
"RTN","PXRRWLS2",171,0)
 ;
"RTN","PXRRWLS2",172,0)
 ;Increment the encounter count.
"RTN","PXRRWLS2",173,0)
 S ^XTMP(PXRRXTMP,FACILITY,STOIND,"TOTENC")=$G(^XTMP(PXRRXTMP,FACILITY,STOIND,"TOTENC"))+1
"RTN","PXRRWLS2",174,0)
 ;
"RTN","PXRRWLS2",175,0)
 ;Calculate totals by facility for multiple provider encounters.
"RTN","PXRRWLS2",176,0)
 I MULTPR=1 D FTOT(FACILITY,"&&","TOTENC")
"RTN","PXRRWLS2",177,0)
 Q
"VER")
8.0^22
**END**
**END**
