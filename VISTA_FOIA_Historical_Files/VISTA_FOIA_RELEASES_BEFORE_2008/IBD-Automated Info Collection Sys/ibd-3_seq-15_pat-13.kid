Released IBD*3*13 SEQ #15
Extracted from mail message
**KIDS**:IBD*3.0*13^

**INSTALL NAME**
IBD*3.0*13
"BLD",667,0)
IBD*3.0*13^AUTOMATED INFO COLLECTION SYS^0^2980212^y
"BLD",667,1,0)
^^2^2^2980212^
"BLD",667,1,1,0)
Patched routine IBDFM1 to translate quote '"' and backslash '\' characters
"BLD",667,1,2,0)
for Paper Keyboard.
"BLD",667,4,0)
^9.64PA^^
"BLD",667,"ABPKG")
n
"BLD",667,"INIT")
IBDY313
"BLD",667,"KRN",0)
^9.67PA^19^18
"BLD",667,"KRN",.4,0)
.4
"BLD",667,"KRN",.401,0)
.401
"BLD",667,"KRN",.402,0)
.402
"BLD",667,"KRN",.403,0)
.403
"BLD",667,"KRN",.5,0)
.5
"BLD",667,"KRN",.84,0)
.84
"BLD",667,"KRN",3.6,0)
3.6
"BLD",667,"KRN",3.8,0)
3.8
"BLD",667,"KRN",9.2,0)
9.2
"BLD",667,"KRN",9.8,0)
9.8
"BLD",667,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",667,"KRN",9.8,"NM",1,0)
IBDFM1^^0^B31732532
"BLD",667,"KRN",9.8,"NM","B","IBDFM1",1)

"BLD",667,"KRN",19,0)
19
"BLD",667,"KRN",19.1,0)
19.1
"BLD",667,"KRN",101,0)
101
"BLD",667,"KRN",409.61,0)
409.61
"BLD",667,"KRN",771,0)
771
"BLD",667,"KRN",869.2,0)
869.2
"BLD",667,"KRN",870,0)
870
"BLD",667,"KRN",8994,0)
8994
"BLD",667,"KRN","B",.4,.4)

"BLD",667,"KRN","B",.401,.401)

"BLD",667,"KRN","B",.402,.402)

"BLD",667,"KRN","B",.403,.403)

"BLD",667,"KRN","B",.5,.5)

"BLD",667,"KRN","B",.84,.84)

"BLD",667,"KRN","B",3.6,3.6)

"BLD",667,"KRN","B",3.8,3.8)

"BLD",667,"KRN","B",9.2,9.2)

"BLD",667,"KRN","B",9.8,9.8)

"BLD",667,"KRN","B",19,19)

"BLD",667,"KRN","B",19.1,19.1)

"BLD",667,"KRN","B",101,101)

"BLD",667,"KRN","B",409.61,409.61)

"BLD",667,"KRN","B",771,771)

"BLD",667,"KRN","B",869.2,869.2)

"BLD",667,"KRN","B",870,870)

"BLD",667,"KRN","B",8994,8994)

"BLD",667,"QUES",0)
^9.62^^
"BLD",667,"REQB",0)
^9.611^1^1
"BLD",667,"REQB",1,0)
AUTOMATED INFO COLLECTION SYS 3.0^1
"BLD",667,"REQB","B","AUTOMATED INFO COLLECTION SYS 3.0",1)

"INIT")
IBDY313
"OER",421,0)
421^IBD
"OER",421,1,0)
^100.9951PA^13^13
"OER",421,1,1,0)
635
"OER",421,1,1,1,0)
^100.99511PA^1^1
"OER",421,1,1,1,1,0)
1228
"OER",421,1,2,0)
634
"OER",421,1,2,1,0)
^100.99511PA^1^1
"OER",421,1,2,1,1,0)
1228
"OER",421,1,3,0)
639
"OER",421,1,3,1,0)
^100.99511PA^1^1
"OER",421,1,3,1,1,0)
1228
"OER",421,1,4,0)
640
"OER",421,1,4,1,0)
^100.99511PA^1^1
"OER",421,1,4,1,1,0)
1228
"OER",421,1,5,0)
636
"OER",421,1,5,1,0)
^100.99511PA^1^1
"OER",421,1,5,1,1,0)
1228
"OER",421,1,6,0)
644
"OER",421,1,6,1,0)
^100.99511PA^1^1
"OER",421,1,6,1,1,0)
1228
"OER",421,1,7,0)
659
"OER",421,1,7,1,0)
^100.99511PA^1^1
"OER",421,1,7,1,1,0)
1228
"OER",421,1,8,0)
660
"OER",421,1,8,1,0)
^100.99511PA^1^1
"OER",421,1,8,1,1,0)
1228
"OER",421,1,9,0)
637
"OER",421,1,9,1,0)
^100.99511PA^1^1
"OER",421,1,9,1,1,0)
1228
"OER",421,1,10,0)
638
"OER",421,1,10,1,0)
^100.99511PA^1^1
"OER",421,1,10,1,1,0)
1228
"OER",421,1,11,0)
642
"OER",421,1,11,1,0)
^100.99511PA^1^1
"OER",421,1,11,1,1,0)
1228
"OER",421,1,12,0)
663
"OER",421,1,12,1,0)
^100.99511PA^1^1
"OER",421,1,12,1,1,0)
1228
"OER",421,1,13,0)
1665
"OER",421,1,13,1,0)
^100.99511PA^2^2
"OER",421,1,13,1,1,0)
1707
"OER",421,1,13,1,2,0)
1110
"OER",421,5,0)
^100.9955^^0
"PKG",421,-1)
1^1
"PKG",421,0)
AUTOMATED INFO COLLECTION SYS^IBD^The utilities for generating a paper encounter form.
"PKG",421,22,0)
^9.49I^1^1
"PKG",421,22,1,0)
3.0^2970212^2970424^1258
"PKG",421,22,1,"PAH",1,0)
13^2980212^12116
"PKG",421,22,1,"PAH",1,1,0)
^^2^2^2980212
"PKG",421,22,1,"PAH",1,1,1,0)
Patched routine IBDFM1 to translate quote '"' and backslash '\' characters
"PKG",421,22,1,"PAH",1,1,2,0)
for Paper Keyboard.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IBDFM1")
0^1^B31732532
"RTN","IBDFM1",1,0)
IBDFM1 ;ALB/CJM - ENCOUNTER FORM (compiling bubbles and hand print fields);3/1/93
"RTN","IBDFM1",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**13**;APR 24, 1997
"RTN","IBDFM1",3,0)
 ;
"RTN","IBDFM1",4,0)
DRWBBL(ROW,COL,PI,VALUE,FNAME,FID,ALLOWED,DISPLAY,HDR,QLFR,DYN,CNT,SUBHDR,QTY,ND2) ;
"RTN","IBDFM1",5,0)
 ;returns "" if no bubble created, else the ien
"RTN","IBDFM1",6,0)
 ;
"RTN","IBDFM1",7,0)
 N BUBBLE
"RTN","IBDFM1",8,0)
 S DISPLAY=$E(DISPLAY,1,80),HDR=$E(HDR,1,40)
"RTN","IBDFM1",9,0)
 S DISPLAY=$TR(DISPLAY,"""\","``")
"RTN","IBDFM1",10,0)
 S DYN=+$G(DYN),CNT=+$G(CNT)
"RTN","IBDFM1",11,0)
 ;
"RTN","IBDFM1",12,0)
 ;don't want to associate a value with the bubble if there is no input interface for the type of data
"RTN","IBDFM1",13,0)
 I 'PI S VALUE=""
"RTN","IBDFM1",14,0)
 ;
"RTN","IBDFM1",15,0)
 ;compiling blocks?
"RTN","IBDFM1",16,0)
 I IBPRINT("COMPILING_BLOCKS") D CMPBBL Q:'IBPRINT("WRITE_IF_COMPILING")
"RTN","IBDFM1",17,0)
 ;
"RTN","IBDFM1",18,0)
 ;don't draw a bubble if in the list processor
"RTN","IBDFM1",19,0)
 Q:IBDEVICE("LISTMAN")
"RTN","IBDFM1",20,0)
 ;
"RTN","IBDFM1",21,0)
 ;add the offsets for the block to position
"RTN","IBDFM1",22,0)
 S ROW=ROW+IBBLK("Y"),COL=COL+IBBLK("X")
"RTN","IBDFM1",23,0)
 ;
"RTN","IBDFM1",24,0)
 ;might not be creating a FORM DEFINITION TABLE - case of toolkit form
"RTN","IBDFM1",25,0)
 I IBFORM("TOOLKIT") S @IBARRAY("BUBBLES")@(ROW,COL)="" Q
"RTN","IBDFM1",26,0)
 ;
"RTN","IBDFM1",27,0)
 ;case of FORM DEFINITION TABLE being created - all forms but toolkit
"RTN","IBDFM1",28,0)
 Q:IBFORM("COMPILED")="F"  ;something already went wrong
"RTN","IBDFM1",29,0)
 I IBFORM("TYPE") I $D(^IBD(357.95,IBFORM("TYPE"),0))
"RTN","IBDFM1",30,0)
 E  S IBFORM("TYPE")=$$NEWTABLE(.IBFORM)
"RTN","IBDFM1",31,0)
 I 'IBFORM("TYPE") D UNCMPL^IBDF19(.IBFORM,1) Q
"RTN","IBDFM1",32,0)
 ;
"RTN","IBDFM1",33,0)
 ;add the bubble to the table
"RTN","IBDFM1",34,0)
 K DIC,D0,DINUM,DD S DIC="^IBD(357.95,"_IBFORM("TYPE")_",1,",X=ROW,DA(1)=IBFORM("TYPE"),DIC(0)=""
"RTN","IBDFM1",35,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDFM1",36,0)
 S BUBBLE=$S(+Y<0:"",1:+Y)
"RTN","IBDFM1",37,0)
 I 'BUBBLE D UNCMPL^IBDF19(.IBFORM,1) Q
"RTN","IBDFM1",38,0)
 I BUBBLE D
"RTN","IBDFM1",39,0)
 .D INPUT^IBDFU91(PI,.VALUE) I '$D(VALUE) S VALUE=""
"RTN","IBDFM1",40,0)
 .S ^IBD(357.95,IBFORM("TYPE"),1,BUBBLE,0)=ROW_"^"_COL_"^"_PI_"^"_VALUE_"^"_$G(FNAME)_"^"_FID_"^"_ALLOWED_"^"_DISPLAY_"^"_HDR_"^"_QLFR_"^"_DYN_"^"_CNT_"^"_$G(QTY)
"RTN","IBDFM1",41,0)
 .I $L($G(SUBHDR)) S ^IBD(357.95,IBFORM("TYPE"),1,BUBBLE,1)=$E(SUBHDR,1,250)
"RTN","IBDFM1",42,0)
 .I $L($G(ND2)) D
"RTN","IBDFM1",43,0)
 ..; -- change external format of 2nd & 3rd codes to internal format
"RTN","IBDFM1",44,0)
 ..N IBJ,IBVAL F IBJ=3,4 S IBVAL=$P(ND2,"^",IBJ) I IBVAL]"" D INPUT^IBDFU91(PI,.IBVAL) S $P(ND2,"^",IBJ)=$S($D(IBVAL):IBVAL,1:"")
"RTN","IBDFM1",45,0)
 ..S ^IBD(357.95,IBFORM("TYPE"),1,BUBBLE,2)=ND2
"RTN","IBDFM1",46,0)
 .K DIK,DA S DIK="^IBD(357.95,"_IBFORM("TYPE")_",1,",DA=BUBBLE,DA(1)=IBFORM("TYPE") D IX1^DIK K DIK,DA
"RTN","IBDFM1",47,0)
 Q
"RTN","IBDFM1",48,0)
 ;
"RTN","IBDFM1",49,0)
NEWTABLE(IBFORM) ;creates a new FORM DEFINITION table
"RTN","IBDFM1",50,0)
 ;returns the ien of the table created, "" if not created
"RTN","IBDFM1",51,0)
 N NODE,SUB,CNT
"RTN","IBDFM1",52,0)
 S IBFORM("TYPE")=$$FORMTYPE^IBDF18D(1)
"RTN","IBDFM1",53,0)
 Q:'IBFORM("TYPE")
"RTN","IBDFM1",54,0)
 S NODE=$G(^IBE(357,IBFORM,0))
"RTN","IBDFM1",55,0)
 S $P(^IBD(357.95,IBFORM("TYPE"),0),"^",9,19)=$P(NODE,"^",9,19) ;not all  19 pieces may exist
"RTN","IBDFM1",56,0)
 S $P(^IBD(357.95,IBFORM("TYPE"),0),"^",20,21)=DT_"^"_IBFORM
"RTN","IBDFM1",57,0)
 S $P(^IBE(357,IBFORM,0),"^",13)=IBFORM("TYPE")
"RTN","IBDFM1",58,0)
 S (CNT,SUB)=0 F  S SUB=$O(^IBE(357,IBFORM,2,SUB)) Q:'SUB  S NODE=$G(^IBE(357,IBFORM,2,SUB,0)) Q:('+NODE)!('$P(NODE,"^",2))  S CNT=CNT+1,^IBD(357.95,IBFORM("TYPE"),3,CNT,0)=+NODE_"^1",^IBD(357.95,IBFORM("TYPE"),3,"B",+NODE,CNT)=""
"RTN","IBDFM1",59,0)
 S $P(^IBD(357.95,IBFORM("TYPE"),3,0),"^",3,4)=CNT_"^"_CNT
"RTN","IBDFM1",60,0)
 Q IBFORM("TYPE")
"RTN","IBDFM1",61,0)
 ;
"RTN","IBDFM1",62,0)
CMPBBL ;save compiled bubbles for the block
"RTN","IBDFM1",63,0)
 S IBWRTCNT("B")=IBWRTCNT("B")+1
"RTN","IBDFM1",64,0)
 S ^IBE(357.1,IBBLK,"B",IBWRTCNT("B"),0)=ROW_"^"_COL_"^"_PI_"^"_VALUE_"^"_FNAME_"^"_FID_"^"_ALLOWED_"^"_DISPLAY_"^"_HDR_"^"_QLFR_"^"_DYN_"^"_CNT_"^"_$G(QTY)
"RTN","IBDFM1",65,0)
 I $L($G(SUBHDR)) S ^IBE(357.1,IBBLK,"B",IBWRTCNT("B"),1)=$E(SUBHDR,1,250)
"RTN","IBDFM1",66,0)
 I $L($G(ND2)) S ^IBE(357.1,IBBLK,"B",IBWRTCNT("B"),2)=ND2
"RTN","IBDFM1",67,0)
 Q
"RTN","IBDFM1",68,0)
 ;
"RTN","IBDFM1",69,0)
CMPHAND ;save compiled hand print fields for the block
"RTN","IBDFM1",70,0)
 S IBWRTCNT("H")=IBWRTCNT("H")+1
"RTN","IBDFM1",71,0)
 S ^IBE(357.1,IBBLK,"H",IBWRTCNT("H"),0)=ROW_"^"_COL_"^"_WIDTH_"^"_PI_"^^"_LINES_"^"_FID_"^"_FNAME_"^"_HDR_"^"_QLFR_"^^"_ITEM_"^^"_PRINT_"^"_READ_"^^"_TYPEDATA
"RTN","IBDFM1",72,0)
 Q
"RTN","IBDFM1",73,0)
 ;
"RTN","IBDFM1",74,0)
DRWHAND(ROW,COL,WIDTH,PI,LINES,FID,FNAME,HDR,QLFR,ITEM,PRINT,READ,TYPEDATA) ;creates hand print field
"RTN","IBDFM1",75,0)
 N NODE
"RTN","IBDFM1",76,0)
 S NODE=""
"RTN","IBDFM1",77,0)
 ;
"RTN","IBDFM1",78,0)
 S ITEM=$G(ITEM),PRINT=$G(PRINT),READ=$G(READ),TYPEDATA=$G(TYPEDATA)
"RTN","IBDFM1",79,0)
 ;returns "" if no hand print field created, else the ien
"RTN","IBDFM1",80,0)
 Q:('$D(ROW))!('$D(COL))
"RTN","IBDFM1",81,0)
 N HANDPRNT
"RTN","IBDFM1",82,0)
 S HDR=$E(HDR,1,40)
"RTN","IBDFM1",83,0)
 ;
"RTN","IBDFM1",84,0)
 ;compiling blocks?
"RTN","IBDFM1",85,0)
 I IBPRINT("COMPILING_BLOCKS") D CMPHAND Q:'IBPRINT("WRITE_IF_COMPILING")
"RTN","IBDFM1",86,0)
 ;
"RTN","IBDFM1",87,0)
 ;don't draw hand print field if in the list processor
"RTN","IBDFM1",88,0)
 Q:IBDEVICE("LISTMAN")
"RTN","IBDFM1",89,0)
 ;
"RTN","IBDFM1",90,0)
 ;add the offsets for the block to position
"RTN","IBDFM1",91,0)
 S ROW=ROW+IBBLK("Y"),COL=COL+IBBLK("X")
"RTN","IBDFM1",92,0)
 ;
"RTN","IBDFM1",93,0)
 ;might not be creating a FORM DEFINITION TABLE - case of toolkit form
"RTN","IBDFM1",94,0)
 I IBFORM("TOOLKIT") D  Q
"RTN","IBDFM1",95,0)
 .N CNT S CNT=+$G(@IBARRAY("HAND_PRINT"))+1
"RTN","IBDFM1",96,0)
 .S @IBARRAY("HAND_PRINT")@(ROW,COL,CNT)=ROW_"^"_COL_"^"_WIDTH_"^"_PI_"^"_FNAME_"^"_LINES_"^^"_FID_"^"_HDR_"^"_QLFR_"^^"_ITEM_"^^"_PRINT_"^"_READ_"^^"_TYPEDATA
"RTN","IBDFM1",97,0)
 ;
"RTN","IBDFM1",98,0)
 ;case of FORM DEFINITION TABLE being created - all forms but toolkit
"RTN","IBDFM1",99,0)
 Q:IBFORM("COMPILED")="F"  ;something already went wrong
"RTN","IBDFM1",100,0)
 I IBFORM("TYPE") I $D(^IBD(357.95,IBFORM("TYPE"),0))
"RTN","IBDFM1",101,0)
 E  S IBFORM("TYPE")=$$NEWTABLE(.IBFORM)
"RTN","IBDFM1",102,0)
 ;if 'IBFORM("TYPE") want to recompile this next time around
"RTN","IBDFM1",103,0)
 I 'IBFORM("TYPE") D UNCMPL^IBDF19(.IBFORM,1) Q
"RTN","IBDFM1",104,0)
 ;
"RTN","IBDFM1",105,0)
 ;add the handprint field to the table
"RTN","IBDFM1",106,0)
 K DIC,D0,DINUM,DD S DIC="^IBD(357.95,"_IBFORM("TYPE")_",2,",X=ROW,DA(1)=IBFORM("TYPE"),DIC(0)=""
"RTN","IBDFM1",107,0)
 D FILE^DICN K DIC,DIE,DA
"RTN","IBDFM1",108,0)
 S HANDPRNT=$S(+Y<0:"",1:+Y)
"RTN","IBDFM1",109,0)
 I 'HANDPRNT D UNCMPL^IBDF19(.IBFORM,1) Q
"RTN","IBDFM1",110,0)
 I HANDPRNT D
"RTN","IBDFM1",111,0)
 .S ^IBD(357.95,IBFORM("TYPE"),2,HANDPRNT,0)=ROW_"^"_COL_"^"_WIDTH_"^"_PI_"^"_FNAME_"^"_LINES_"^^"_FID_"^"_HDR_"^"_QLFR_"^^"_ITEM_"^^"_PRINT_"^"_READ_"^^"_TYPEDATA
"RTN","IBDFM1",112,0)
 .K DIK,DA S DIK="^IBD(357.95,"_IBFORM("TYPE")_",2,",DA=HANDPRNT,DA(1)=IBFORM("TYPE") D IX1^DIK K DIK,DA
"RTN","IBDFM1",113,0)
 Q
"RTN","IBDFM1",114,0)
 ;
"RTN","IBDFM1",115,0)
TRACKBBL(FID,COUNT,QLFR,PI,DISPLAY,VALUE) ;
"RTN","IBDFM1",116,0)
 ;IBPFID, the id in form tracking, should be defined
"RTN","IBDFM1",117,0)
 ;
"RTN","IBDFM1",118,0)
 ; -- do not re-file dynamic data if reprint
"RTN","IBDFM1",119,0)
 Q:$G(REPRINT)
"RTN","IBDFM1",120,0)
 ;N SUB,NODE
"RTN","IBDFM1",121,0)
 ;S NODE=$G(^IBD(357.96,IBPFID,1,0))
"RTN","IBDFM1",122,0)
 ;S SUB=$P(NODE,"^",3)
"RTN","IBDFM1",123,0)
 ;S SUB=SUB+1,$P(NODE,"^",3,4)=SUB_"^"_SUB
"RTN","IBDFM1",124,0)
 ;D INPUT^IBDFU91(PI,.VALUE) I '$D(VALUE) S VALUE=""
"RTN","IBDFM1",125,0)
 ;S ^IBD(357.96,IBPFID,1,SUB,0)=COUNT_"^^"_PI_"^"_VALUE_"^^"_FID_"^^"_DISPLAY_"^^"_QLFR
"RTN","IBDFM1",126,0)
 ;S ^IBD(357.96,IBPFID,1,0)=NODE
"RTN","IBDFM1",127,0)
 ;K DIK,DA S DIK="^IBD(357.96,IBPFID,1,",DA=SUB,DA(1)=IBPFID D IX^DIK K DIK,DA
"RTN","IBDFM1",128,0)
 D INPUT^IBDFU91(PI,.VALUE) I '$D(VALUE) S VALUE=""
"RTN","IBDFM1",129,0)
 S DIC="^IBD(357.96,IBPFID,1,",DIC(0)="L",DIC("P")=$P(^DD(357.96,1,0),"^",2),DA(1)=IBPFID,X=COUNT,DLAYGO=357.96,DIC("DR")=".03////^S X=PI;.04////^S X=VALUE;.06////^S X=FID;.08////^S X=$E(DISPLAY,1,80);.1////^S X=QLFR"
"RTN","IBDFM1",130,0)
 K DD,DO D FILE^DICN K DIC,DA,DLAYGO,DD,DO
"RTN","IBDFM1",131,0)
 Q
"RTN","IBDY313")
0^^B493990
"RTN","IBDY313",1,0)
IBDY313 ;ALB/JS - Post Install routine for IBD*3*13  - 28-Oct-97
"RTN","IBDY313",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**13**;APR 24, 1997
"RTN","IBDY313",3,0)
 ;
"RTN","IBDY313",4,0)
UNCOMP ; -- uncompile all forms --
"RTN","IBDY313",5,0)
 N ZTQUEUED
"RTN","IBDY313",6,0)
 D MES^XPDUTL(">>> Now uncompiling all Encounter Forms.")
"RTN","IBDY313",7,0)
 S ZTQUEUED=1
"RTN","IBDY313",8,0)
 D RECMPALL^IBDF19
"RTN","IBDY313",9,0)
 D MES^XPDUTL("  Okay, forms will be recompiled as they are printed.")
"RTN","IBDY313",10,0)
 Q
"VER")
8.0^21.0
**END**
**END**
