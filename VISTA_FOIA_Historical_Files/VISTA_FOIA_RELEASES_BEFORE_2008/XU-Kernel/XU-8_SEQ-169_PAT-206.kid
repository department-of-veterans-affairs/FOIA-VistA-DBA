Released XU*8*206 SEQ #169
Extracted from mail message
**KIDS**:XU*8.0*206^

**INSTALL NAME**
XU*8.0*206
"BLD",1523,0)
XU*8.0*206^KERNEL^0^3010709^y
"BLD",1523,1,0)
^^1^1^3010709^^^^
"BLD",1523,1,1,0)
See patch description.
"BLD",1523,4,0)
^9.64PA^4.1^2
"BLD",1523,4,4,0)
4
"BLD",1523,4,4,222)
y^n^f^^^^n
"BLD",1523,4,4.1,0)
4.1
"BLD",1523,4,4.1,222)
y^n^f^^^^n
"BLD",1523,4,"B",4,4)

"BLD",1523,4,"B",4.1,4.1)

"BLD",1523,"ABPKG")
n
"BLD",1523,"INI")
PRE^XUMFPOST
"BLD",1523,"INIT")
EN^XUMFPOST
"BLD",1523,"KRN",0)
^9.67PA^19^18
"BLD",1523,"KRN",.4,0)
.4
"BLD",1523,"KRN",.4,"NM",0)
^9.68A^^
"BLD",1523,"KRN",.401,0)
.401
"BLD",1523,"KRN",.402,0)
.402
"BLD",1523,"KRN",.403,0)
.403
"BLD",1523,"KRN",.5,0)
.5
"BLD",1523,"KRN",.84,0)
.84
"BLD",1523,"KRN",3.6,0)
3.6
"BLD",1523,"KRN",3.6,"NM",0)
^9.68A^2^2
"BLD",1523,"KRN",3.6,"NM",1,0)
XUMF ERROR^^0
"BLD",1523,"KRN",3.6,"NM",2,0)
XUMF INSTITUTION^^0
"BLD",1523,"KRN",3.6,"NM","B","XUMF ERROR",1)

"BLD",1523,"KRN",3.6,"NM","B","XUMF INSTITUTION",2)

"BLD",1523,"KRN",3.8,0)
3.8
"BLD",1523,"KRN",3.8,"NM",0)
^9.68A^2^2
"BLD",1523,"KRN",3.8,"NM",1,0)
XUMF INSTITUTION^^0
"BLD",1523,"KRN",3.8,"NM",2,0)
XUMF SERVER^^0
"BLD",1523,"KRN",3.8,"NM","B","XUMF INSTITUTION",1)

"BLD",1523,"KRN",3.8,"NM","B","XUMF SERVER",2)

"BLD",1523,"KRN",9.2,0)
9.2
"BLD",1523,"KRN",9.8,0)
9.8
"BLD",1523,"KRN",9.8,"NM",0)
^9.68A^36^12
"BLD",1523,"KRN",9.8,"NM",1,0)
XUMFI^^0^B62426615
"BLD",1523,"KRN",9.8,"NM",24,0)
XUMFH^^0^B33250853
"BLD",1523,"KRN",9.8,"NM",25,0)
XUMFP^^0^B12278127
"BLD",1523,"KRN",9.8,"NM",26,0)
XUMFP4^^0^B25861028
"BLD",1523,"KRN",9.8,"NM",27,0)
XUMF4^^0^B59728107
"BLD",1523,"KRN",9.8,"NM",28,0)
XUMF4A^^0^B55477469
"BLD",1523,"KRN",9.8,"NM",29,0)
XUMF4H^^0^B9186915
"BLD",1523,"KRN",9.8,"NM",30,0)
XUAF4^^0^B19380664
"BLD",1523,"KRN",9.8,"NM",31,0)
XUMFPFT^^0^B18434256
"BLD",1523,"KRN",9.8,"NM",33,0)
XUMFPOST^^0^B4379388
"BLD",1523,"KRN",9.8,"NM",34,0)
XUMFP4C^^0^B19207412
"BLD",1523,"KRN",9.8,"NM",36,0)
XUMFENV^^0^B956493
"BLD",1523,"KRN",9.8,"NM","B","XUAF4",30)

"BLD",1523,"KRN",9.8,"NM","B","XUMF4",27)

"BLD",1523,"KRN",9.8,"NM","B","XUMF4A",28)

"BLD",1523,"KRN",9.8,"NM","B","XUMF4H",29)

"BLD",1523,"KRN",9.8,"NM","B","XUMFENV",36)

"BLD",1523,"KRN",9.8,"NM","B","XUMFH",24)

"BLD",1523,"KRN",9.8,"NM","B","XUMFI",1)

"BLD",1523,"KRN",9.8,"NM","B","XUMFP",25)

"BLD",1523,"KRN",9.8,"NM","B","XUMFP4",26)

"BLD",1523,"KRN",9.8,"NM","B","XUMFP4C",34)

"BLD",1523,"KRN",9.8,"NM","B","XUMFPFT",31)

"BLD",1523,"KRN",9.8,"NM","B","XUMFPOST",33)

"BLD",1523,"KRN",19,0)
19
"BLD",1523,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",1523,"KRN",19,"NM",1,0)
XUMF INSTITUTION^^0
"BLD",1523,"KRN",19,"NM","B","XUMF INSTITUTION",1)

"BLD",1523,"KRN",19.1,0)
19.1
"BLD",1523,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",1523,"KRN",19.1,"NM",1,0)
XUMF INSTITUTION^^0
"BLD",1523,"KRN",19.1,"NM","B","XUMF INSTITUTION",1)

"BLD",1523,"KRN",101,0)
101
"BLD",1523,"KRN",101,"NM",0)
^9.68A^35^12
"BLD",1523,"KRN",101,"NM",3,0)
XUMF AUTO^^0
"BLD",1523,"KRN",101,"NM",4,0)
XUMF CHCK^^0
"BLD",1523,"KRN",101,"NM",9,0)
XUMF DSTA^^0
"BLD",1523,"KRN",101,"NM",17,0)
XUMF NAME^^0
"BLD",1523,"KRN",101,"NM",27,0)
XUMF LLCL^^0
"BLD",1523,"KRN",101,"NM",28,0)
XUMF NATL^^0
"BLD",1523,"KRN",101,"NM",29,0)
XUMF RDSN^^0
"BLD",1523,"KRN",101,"NM",30,0)
XUMF RDSN MENU^^0
"BLD",1523,"KRN",101,"NM",31,0)
XUMF MFR^^0
"BLD",1523,"KRN",101,"NM",32,0)
XUMF MFK^^0
"BLD",1523,"KRN",101,"NM",34,0)
XUMF MFN^^0
"BLD",1523,"KRN",101,"NM",35,0)
XUMF MFQ^^0
"BLD",1523,"KRN",101,"NM","B","XUMF AUTO",3)

"BLD",1523,"KRN",101,"NM","B","XUMF CHCK",4)

"BLD",1523,"KRN",101,"NM","B","XUMF DSTA",9)

"BLD",1523,"KRN",101,"NM","B","XUMF LLCL",27)

"BLD",1523,"KRN",101,"NM","B","XUMF MFK",32)

"BLD",1523,"KRN",101,"NM","B","XUMF MFN",34)

"BLD",1523,"KRN",101,"NM","B","XUMF MFQ",35)

"BLD",1523,"KRN",101,"NM","B","XUMF MFR",31)

"BLD",1523,"KRN",101,"NM","B","XUMF NAME",17)

"BLD",1523,"KRN",101,"NM","B","XUMF NATL",28)

"BLD",1523,"KRN",101,"NM","B","XUMF RDSN",29)

"BLD",1523,"KRN",101,"NM","B","XUMF RDSN MENU",30)

"BLD",1523,"KRN",409.61,0)
409.61
"BLD",1523,"KRN",409.61,"NM",0)
^9.68A^10^6
"BLD",1523,"KRN",409.61,"NM",1,0)
XUMF CHCK^^0
"BLD",1523,"KRN",409.61,"NM",3,0)
XUMF DSTA^^0
"BLD",1523,"KRN",409.61,"NM",7,0)
XUMF NAME^^0
"BLD",1523,"KRN",409.61,"NM",8,0)
XUMF LLCL^^0
"BLD",1523,"KRN",409.61,"NM",9,0)
XUMF NATL^^0
"BLD",1523,"KRN",409.61,"NM",10,0)
XUMF LIST^^0
"BLD",1523,"KRN",409.61,"NM","B","XUMF CHCK",1)

"BLD",1523,"KRN",409.61,"NM","B","XUMF DSTA",3)

"BLD",1523,"KRN",409.61,"NM","B","XUMF LIST",10)

"BLD",1523,"KRN",409.61,"NM","B","XUMF LLCL",8)

"BLD",1523,"KRN",409.61,"NM","B","XUMF NAME",7)

"BLD",1523,"KRN",409.61,"NM","B","XUMF NATL",9)

"BLD",1523,"KRN",771,0)
771
"BLD",1523,"KRN",771,"NM",0)
^9.68A^4^4
"BLD",1523,"KRN",771,"NM",1,0)
XUMF MFK^^0
"BLD",1523,"KRN",771,"NM",2,0)
XUMF MFQ^^0
"BLD",1523,"KRN",771,"NM",3,0)
XUMF MFR^^0
"BLD",1523,"KRN",771,"NM",4,0)
XUMF MFN^^0
"BLD",1523,"KRN",771,"NM","B","XUMF MFK",1)

"BLD",1523,"KRN",771,"NM","B","XUMF MFN",4)

"BLD",1523,"KRN",771,"NM","B","XUMF MFQ",2)

"BLD",1523,"KRN",771,"NM","B","XUMF MFR",3)

"BLD",1523,"KRN",869.2,0)
869.2
"BLD",1523,"KRN",869.2,"NM",0)
^9.68A^^0
"BLD",1523,"KRN",870,0)
870
"BLD",1523,"KRN",870,"NM",0)
^9.68A^1^1
"BLD",1523,"KRN",870,"NM",1,0)
XUMF FORUM^^0
"BLD",1523,"KRN",870,"NM","B","XUMF FORUM",1)

"BLD",1523,"KRN",8994,0)
8994
"BLD",1523,"KRN",8994,"NM",0)
^9.68A^^
"BLD",1523,"KRN","B",.4,.4)

"BLD",1523,"KRN","B",.401,.401)

"BLD",1523,"KRN","B",.402,.402)

"BLD",1523,"KRN","B",.403,.403)

"BLD",1523,"KRN","B",.5,.5)

"BLD",1523,"KRN","B",.84,.84)

"BLD",1523,"KRN","B",3.6,3.6)

"BLD",1523,"KRN","B",3.8,3.8)

"BLD",1523,"KRN","B",9.2,9.2)

"BLD",1523,"KRN","B",9.8,9.8)

"BLD",1523,"KRN","B",19,19)

"BLD",1523,"KRN","B",19.1,19.1)

"BLD",1523,"KRN","B",101,101)

"BLD",1523,"KRN","B",409.61,409.61)

"BLD",1523,"KRN","B",771,771)

"BLD",1523,"KRN","B",869.2,869.2)

"BLD",1523,"KRN","B",870,870)

"BLD",1523,"KRN","B",8994,8994)

"BLD",1523,"PRE")
XUMFENV
"BLD",1523,"QUES",0)
^9.62^^
"BLD",1523,"REQB",0)
^9.611^4^4
"BLD",1523,"REQB",1,0)
XU*8.0*43^1
"BLD",1523,"REQB",2,0)
XU*8.0*112^1
"BLD",1523,"REQB",3,0)
DG*5.3*357^0
"BLD",1523,"REQB",4,0)
MPIF*1.0*16^0
"BLD",1523,"REQB","B","DG*5.3*357",3)

"BLD",1523,"REQB","B","MPIF*1.0*16",4)

"BLD",1523,"REQB","B","XU*8.0*112",2)

"BLD",1523,"REQB","B","XU*8.0*43",1)

"FIA",4)
INSTITUTION
"FIA",4,0)
^DIC(4,
"FIA",4,0,0)
4I
"FIA",4,0,1)
y^n^f^^^^n
"FIA",4,0,10)

"FIA",4,0,11)

"FIA",4,0,"RLRO")

"FIA",4,0,"VR")
8.0^XU
"FIA",4,4)
0
"FIA",4,4.014)
0
"FIA",4,4.03)
0
"FIA",4,4.999)
0
"FIA",4.1)
FACILITY TYPE
"FIA",4.1,0)
^DIC(4.1,
"FIA",4.1,0,0)
4.1I
"FIA",4.1,0,1)
y^n^f^^^^n
"FIA",4.1,0,10)

"FIA",4.1,0,11)

"FIA",4.1,0,"RLRO")

"FIA",4.1,0,"VR")
8.0^XU
"FIA",4.1,4.1)
0
"INI")
PRE^XUMFPOST
"INIT")
EN^XUMFPOST
"KRN",3.6,172,-1)
0^2
"KRN",3.6,172,0)
XUMF INSTITUTION^Master File Server - update notification - INSTITUTION file
"KRN",3.6,172,1,0)
^3.61A^20^20^3010619^^^^
"KRN",3.6,172,1,1,0)
The following Master File Notification (MFN) message was
"KRN",3.6,172,1,2,0)
received and processed by the Master File Server:
"KRN",3.6,172,1,3,0)
 
"KRN",3.6,172,1,4,0)
  MID:  |1|
"KRN",3.6,172,1,5,0)
  
"KRN",3.6,172,1,6,0)
The following INSTITUTION (#4) file entry has been |2|:
"KRN",3.6,172,1,7,0)
 
"KRN",3.6,172,1,8,0)
  IEN: |3|   STATION NUMBER: |4|
"KRN",3.6,172,1,9,0)
 
"KRN",3.6,172,1,10,0)
  UPDATED ENTRY
"KRN",3.6,172,1,11,0)
  -------------
"KRN",3.6,172,1,12,0)
  NAME: |5|
"KRN",3.6,172,1,13,0)
  OFFICIAL VA NAME: |6|
"KRN",3.6,172,1,14,0)
  FACILITY TYPE: |7|
"KRN",3.6,172,1,15,0)
 
"KRN",3.6,172,1,16,0)
  OLD VALUES
"KRN",3.6,172,1,17,0)
  ----------
"KRN",3.6,172,1,18,0)
  NAME: |8|
"KRN",3.6,172,1,19,0)
  OFFICIAL VA NAME: |9|
"KRN",3.6,172,1,20,0)
  FACILITY TYPE: |10|
"KRN",3.6,172,3,0)
^3.63^1^1^3010619^^^^
"KRN",3.6,172,3,1,0)
This bulletin notifies the XUMF INSTITUTION mail group that an unsolicited update message has been received and processed by the Master File Server mechanism.  An INSTITUTION (#4) file entry has added/updated.
"KRN",3.6,172,4,0)
^3.64A^8^10
"KRN",3.6,172,4,1,0)
1
"KRN",3.6,172,4,1,1,0)
^3.65^1^1^3000802^^^
"KRN",3.6,172,4,1,1,1,0)
Message ID
"KRN",3.6,172,4,2,0)
2
"KRN",3.6,172,4,2,1,0)
^3.65^1^1^3000802^^^
"KRN",3.6,172,4,2,1,1,0)
Added or Updated
"KRN",3.6,172,4,3,0)
3
"KRN",3.6,172,4,3,1,0)
^3.65^1^1^3000802^^^
"KRN",3.6,172,4,3,1,1,0)
Internal Entry Number
"KRN",3.6,172,4,4,0)
4
"KRN",3.6,172,4,4,1,0)
^3.65^1^1^3000804^^^^
"KRN",3.6,172,4,4,1,1,0)
STATION NUMBER
"KRN",3.6,172,4,5,0)
5
"KRN",3.6,172,4,5,1,0)
^3.65^1^1^3000804^^^
"KRN",3.6,172,4,5,1,1,0)
NAME
"KRN",3.6,172,4,6,0)
6
"KRN",3.6,172,4,6,1,0)
^3.65^1^1^3000804^^^^
"KRN",3.6,172,4,6,1,1,0)
OFFICIAL VA NAME
"KRN",3.6,172,4,7,0)
7
"KRN",3.6,172,4,7,1,0)
^3.65^1^1^3000804^^^
"KRN",3.6,172,4,7,1,1,0)
FACILITY TYPE
"KRN",3.6,172,4,8,0)
8
"KRN",3.6,172,4,8,1,0)
^3.65^1^1^3010619^^
"KRN",3.6,172,4,8,1,1,0)
OLD NAME
"KRN",3.6,172,4,9,0)
9
"KRN",3.6,172,4,9,1,0)
^3.65^1^1^3010619^^^^
"KRN",3.6,172,4,9,1,1,0)
OLD OFFICAL VA NAME
"KRN",3.6,172,4,10,0)
10
"KRN",3.6,172,4,10,1,0)
^3.65^1^1^3010619^^^^
"KRN",3.6,172,4,10,1,1,0)
OLD FACILITY TYPE
"KRN",3.6,173,-1)
0^1
"KRN",3.6,173,0)
XUMF ERROR^Master File Server - error message
"KRN",3.6,173,1,0)
^3.61A^8^8^3010410^^^^
"KRN",3.6,173,1,1,0)
The Master File Server has received a Message Acknowledgement (MSA) segment
"KRN",3.6,173,1,2,0)
with an Acknowledgement Code indicating an application error for the following
"KRN",3.6,173,1,3,0)
message:
"KRN",3.6,173,1,4,0)

"KRN",3.6,173,1,5,0)
  MID:  |1|
"KRN",3.6,173,1,6,0)

"KRN",3.6,173,1,7,0)
This message must be investigated our the master file related to this message
"KRN",3.6,173,1,8,0)
will be out of sync with the national standard table.
"KRN",3.6,173,3,0)
^3.63^2^2^3010410^^^^
"KRN",3.6,173,3,1,0)
This bulletin is triggered upon receipt of a Master File Notification message
"KRN",3.6,173,3,2,0)
from the Master File Server.
"KRN",3.6,173,4,0)
^3.64A^1^1
"KRN",3.6,173,4,1,0)
1
"KRN",3.6,173,4,1,1,0)
^3.65^1^1^3010410^^^^
"KRN",3.6,173,4,1,1,1,0)
Message Control ID
"KRN",3.8,138,-1)
0^2
"KRN",3.8,138,0)
XUMF SERVER^PU^^^^0^
"KRN",3.8,138,2,0)
^3.801^1^1^3000728^^^^
"KRN",3.8,138,2,1,0)
This mail group receives messages related to the Master File Server.
"KRN",3.8,138,3)

"KRN",3.8,138,6,0)
^3.812^^0
"KRN",3.8,150,-1)
0^1
"KRN",3.8,150,0)
XUMF INSTITUTION^PU^^^^^
"KRN",3.8,150,2,0)
^^2^2^3000802^
"KRN",3.8,150,2,1,0)
This mail group notifies members of update messages received from the Master
"KRN",3.8,150,2,2,0)
File Server related to the INSTITUTION (#4) file.
"KRN",3.8,150,3)

"KRN",19,10212,-1)
0^1
"KRN",19,10212,0)
XUMF INSTITUTION^Institution File Query / Update^^R^^XUMF INSTITUTION^^^^^^KERNEL
"KRN",19,10212,1,0)
^^20^20^3000705^
"KRN",19,10212,1,1,0)
This option provides clean up utilities to check for duplicate station
"KRN",19,10212,1,2,0)
numbers and to get a copy of Institution Master File from FORUM for comparison
"KRN",19,10212,1,3,0)
and update purposes.
"KRN",19,10212,1,4,0)

"KRN",19,10212,1,5,0)
The clean up utilities will provide several lists to compare the local
"KRN",19,10212,1,6,0)
INSTITUTION (#4) file with the Institution Master File (IMF) -- the "gold"
"KRN",19,10212,1,7,0)
file of Institutions complete with all approved station numbers including
"KRN",19,10212,1,8,0)
inactive as well as active station numbers.  Utilities will be included to
"KRN",19,10212,1,9,0)
resolve duplicate station numbers and to automatically populate the local
"KRN",19,10212,1,10,0)
INSTITUTION (#4) file with national IMF data.
"KRN",19,10212,1,11,0)

"KRN",19,10212,1,12,0)
The INSTITUTION (#4) file clean up utilities utilize the query functionality
"KRN",19,10212,1,13,0)
provided by the Master File Server mechanism.  An HL7 Master File Query (MFQ)
"KRN",19,10212,1,14,0)
message is sent to FORUM to get the IFM.  The MFQ message is handled by the
"KRN",19,10212,1,15,0)
VistA HL7 package which invokes the Master File Sever (MFS) message handler.
"KRN",19,10212,1,16,0)
The MFS handler interprets the query and builds/sends the appropriate response
"KRN",19,10212,1,17,0)
to the local site in an HL7 Master File Response (MFR) message.  The VistA HL7
"KRN",19,10212,1,18,0)
package invokes the MFS handler on the local site which stores the IMF data
"KRN",19,10212,1,19,0)
in a temporary global.  The clean up utilities use this information for the
"KRN",19,10212,1,20,0)
displays and to automatically update the local INSTITUTION (#4) file.
"KRN",19,10212,25)
EN^XUMF4
"KRN",19,10212,"U")
INSTITUTION FILE QUERY / UPDAT
"KRN",19.1,359,-1)
0^1
"KRN",19.1,359,0)
XUMF INSTITUTION^Institution Master File Key
"KRN",19.1,359,1,0)
^19.11^1^1^3000705^
"KRN",19.1,359,1,1,0)
This key locks the XUMF INSTITUTION option.
"KRN",101,2147,-1)
0^17
"KRN",101,2147,0)
XUMF NAME^Names INSTITUTION vs national^^M^^^^^^^^KERNEL
"KRN",101,2147,4)
40^9
"KRN",101,2147,10,0)
^101.01PA^8^7
"KRN",101,2147,10,1,0)
2148^LLCL^12^
"KRN",101,2147,10,1,"^")
XUMF LLCL
"KRN",101,2147,10,2,0)
2149^DSTA^14^
"KRN",101,2147,10,2,"^")
XUMF DSTA
"KRN",101,2147,10,5,0)
2152^AUTO^24^
"KRN",101,2147,10,5,"^")
XUMF AUTO
"KRN",101,2147,10,6,0)
2153^NATL^18^
"KRN",101,2147,10,6,"^")
XUMF NATL
"KRN",101,2147,10,8,0)
2159^CHCK^99^
"KRN",101,2147,10,8,"^")
XUMF CHCK
"KRN",101,2147,26)
D SHOW^VALM
"KRN",101,2147,28)
Select Action:
"KRN",101,2147,99)
58484,29523
"KRN",101,2148,-1)
0^27
"KRN",101,2148,0)
XUMF LLCL^List local station numbers^^A^^^^^^^^KERNEL
"KRN",101,2148,15)

"KRN",101,2148,20)
D EN^VALM("XUMF LLCL")
"KRN",101,2148,99)
58294,49137
"KRN",101,2149,-1)
0^9
"KRN",101,2149,0)
XUMF DSTA^Delete local/dup. station #^^A^^^^^^^^KERNEL
"KRN",101,2149,20)
D EN^VALM("XUMF DSTA")
"KRN",101,2149,99)
58359,42174
"KRN",101,2152,-1)
0^3
"KRN",101,2152,0)
XUMF AUTO^Auto update with national data^^A^^^^^^^^KERNEL
"KRN",101,2152,20)
D EN^XUMF4A
"KRN",101,2152,99)
58288,51647
"KRN",101,2153,-1)
0^28
"KRN",101,2153,0)
XUMF NATL^List national data to merge^^A^^^^^^^^KERNEL
"KRN",101,2153,20)
D EN^VALM("XUMF NATL")
"KRN",101,2153,99)
58288,51647
"KRN",101,2155,-1)
0^29
"KRN",101,2155,0)
XUMF RDSN^Resolve duplicate station numbers^^A^^^^^^^^KERNEL
"KRN",101,2155,20)
D RDSN^XUMF4
"KRN",101,2155,99)
58288,51647
"KRN",101,2157,-1)
0^30
"KRN",101,2157,0)
XUMF RDSN MENU^Duplicale station number menu^^M^^^^^^^^KERNEL
"KRN",101,2157,4)
40^9
"KRN",101,2157,10,0)
^101.01PA^8^1
"KRN",101,2157,10,8,0)
2155^RDSN^20^
"KRN",101,2157,10,8,"^")
XUMF RDSN
"KRN",101,2157,26)
D SHOW^VALM
"KRN",101,2157,28)
Select Action:
"KRN",101,2157,99)
58288,51647
"KRN",101,2159,-1)
0^4
"KRN",101,2159,0)
XUMF CHCK^Required clean-up actions^^A^^^^^^^^KERNEL
"KRN",101,2159,10,0)
^101.01PA
"KRN",101,2159,20)
D EN^VALM("XUMF CHCK")
"KRN",101,2159,99)
58360,51633
"KRN",101,2232,-1)
0^34
"KRN",101,2232,0)
XUMF MFN^Master File Notification^^E^^^^^^^^
"KRN",101,2232,1,0)
^^1^1^3001011^^^^
"KRN",101,2232,1,1,0)
This protocol is the Master File Notification event driver for the Institution file.
"KRN",101,2232,4)
^^^
"KRN",101,2232,99)
58288,51647
"KRN",101,2232,770)
XUMF MFN^^MFN^M05^i^P^^^^2.3^MFN
"KRN",101,2232,771)

"KRN",101,2232,772)
D MAIN^XUMFH
"KRN",101,2232,775,0)
^101.0775PA^1^1
"KRN",101,2232,775,1,0)
2234
"KRN",101,2232,775,1,"^")
XUMF MFK
"KRN",101,2233,-1)
0^35
"KRN",101,2233,0)
XUMF MFQ^Master File Query^^E^^^^^^^^
"KRN",101,2233,1,0)
^^1^1^3000303^^^^
"KRN",101,2233,1,1,0)
This protocol is Master File Query event driver for the Institution file.
"KRN",101,2233,4)
^^^
"KRN",101,2233,99)
58288,51647
"KRN",101,2233,770)
XUMF MFQ^^MFQ^M05^i^P^^^^2.3^MFR
"KRN",101,2233,771)

"KRN",101,2233,772)
D MAIN^XUMFH
"KRN",101,2233,773)
^^^
"KRN",101,2233,774)

"KRN",101,2233,775,0)
^101.0775PA^1^1
"KRN",101,2233,775,1,0)
2235^^^
"KRN",101,2233,775,1,"^")
XUMF MFR
"KRN",101,2234,-1)
0^32
"KRN",101,2234,0)
XUMF MFK^Master File App ACK^^S^^^^^^^^
"KRN",101,2234,1,0)
^101.06^1^1^3000629^^^^
"KRN",101,2234,1,1,0)
This protocol handles Master File Notifications for the Institution file.
"KRN",101,2234,4)
^^^
"KRN",101,2234,99)
58288,51647
"KRN",101,2234,770)
^XUMF MFK^MFN^M05^i^P^^^^2.3^MFK^^i
"KRN",101,2234,771)
D MAIN^XUMFH
"KRN",101,2234,772)

"KRN",101,2234,773)
1^1^^1
"KRN",101,2234,774)
Q
"KRN",101,2235,-1)
0^31
"KRN",101,2235,0)
XUMF MFR^Master File Response^^S^^^^^^^^
"KRN",101,2235,1,0)
^^1^1^3000222^^^^
"KRN",101,2235,1,1,0)
This protocol handles Master File Query messages for the Institution file.
"KRN",101,2235,4)
^^^
"KRN",101,2235,99)
58288,51647
"KRN",101,2235,770)
^XUMF MFR^MFQ^M05^i^P^^^^2.3^MFR^^i
"KRN",101,2235,771)
D MAIN^XUMFH
"KRN",101,2235,773)
1^1^^1
"KRN",101,2235,774)
Q
"KRN",409.61,355,-1)
0^8
"KRN",409.61,355,0)
XUMF LLCL^2^^80^4^20^1^1^^^List local station numbers
"KRN",409.61,355,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,355,"ARRAY")
 ^TMP("XUMF LLCL",$J)
"KRN",409.61,355,"COL",0)
^409.621^4^4
"KRN",409.61,355,"COL",1,0)
STATION NUMBER^2^8^STA #
"KRN",409.61,355,"COL",2,0)
INSTITUTION NAME^17^30^INSTITUTION NAME
"KRN",409.61,355,"COL",3,0)
IEN^49^5^IEN
"KRN",409.61,355,"COL",4,0)
FACILITY TYPE^58^20^FACILITY TYPE
"KRN",409.61,355,"COL","B","FACILITY TYPE",4)

"KRN",409.61,355,"COL","B","IEN",3)

"KRN",409.61,355,"COL","B","INSTITUTION NAME",2)

"KRN",409.61,355,"COL","B","STATION NUMBER",1)

"KRN",409.61,355,"FNL")
D EXIT^XUMF4
"KRN",409.61,355,"HDR")

"KRN",409.61,355,"HLP")
D LLCL^XUMF4H
"KRN",409.61,355,"INIT")
D LLCL^XUMF4
"KRN",409.61,356,-1)
0^3
"KRN",409.61,356,0)
XUMF DSTA^1^^80^4^20^1^1^Duplicate Station #^XUMF RDSN MENU^Duplicate station numbers^1
"KRN",409.61,356,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,356,"ARRAY")
 ^TMP("XUMF DSTA",$J)
"KRN",409.61,356,"COL",0)
^409.621^4^4
"KRN",409.61,356,"COL",1,0)
STATION NUMBER^5^8^STA #
"KRN",409.61,356,"COL",2,0)
INSTITUTION NAME^20^30^INSTITUTION NAME
"KRN",409.61,356,"COL",3,0)
ENTRY NUMBER^1^4
"KRN",409.61,356,"COL",4,0)
IEN^55^10^IEN
"KRN",409.61,356,"COL","B","ENTRY NUMBER",3)

"KRN",409.61,356,"COL","B","IEN",4)

"KRN",409.61,356,"COL","B","INSTITUTION NAME",2)

"KRN",409.61,356,"COL","B","STATION NUMBER",1)

"KRN",409.61,356,"FNL")
D EXIT^XUMF4
"KRN",409.61,356,"HLP")
D DSTA^XUMF4H
"KRN",409.61,356,"INIT")
D DSTA^XUMF4
"KRN",409.61,357,-1)
0^7
"KRN",409.61,357,0)
XUMF NAME^1^^80^4^18^1^1^NAME^XUMF NAME^INSTITUTION name vs GOLD name^1
"KRN",409.61,357,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,357,"ARRAY")
 ^TMP("XUMF NAME",$J)
"KRN",409.61,357,"COL",0)
^409.621^4^3
"KRN",409.61,357,"COL",2,0)
STATION NUMBER^5^8^STA #
"KRN",409.61,357,"COL",3,0)
INSTITUTION NAME^18^30^INSTITUTION NAME
"KRN",409.61,357,"COL",4,0)
GOLD NAME^50^30^GOLD NAME
"KRN",409.61,357,"COL","B","GOLD NAME",4)

"KRN",409.61,357,"COL","B","INSTITUTION NAME",3)

"KRN",409.61,357,"COL","B","STATION NUMBER",2)

"KRN",409.61,357,"FNL")
D EXIT^XUMF4
"KRN",409.61,357,"HLP")
D NAME^XUMF4H
"KRN",409.61,357,"INIT")
D NAME^XUMF4
"KRN",409.61,361,-1)
0^9
"KRN",409.61,361,0)
XUMF NATL^2^^80^4^19^1^1^^^List national data to merge
"KRN",409.61,361,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,361,"ARRAY")
 ^TMP("XUMF NATL",$J)
"KRN",409.61,361,"COL",0)
^409.621^4^4
"KRN",409.61,361,"COL",1,0)
STATION NUMBER^5^8^STA #
"KRN",409.61,361,"COL",2,0)
NATIONAL NAME^12^30^INSTITUTION NAME
"KRN",409.61,361,"COL",3,0)
STATE^42^15^STATE
"KRN",409.61,361,"COL",4,0)
TYPE^60^20^FACILITY TYPE
"KRN",409.61,361,"COL","B","NATIONAL NAME",2)

"KRN",409.61,361,"COL","B","STATE",3)

"KRN",409.61,361,"COL","B","STATION NUMBER",1)

"KRN",409.61,361,"COL","B","TYPE",4)

"KRN",409.61,361,"FNL")
D EXIT^XUMF4
"KRN",409.61,361,"HDR")

"KRN",409.61,361,"HLP")
D NATL^XUMF4H
"KRN",409.61,361,"INIT")
D NATL^XUMF4
"KRN",409.61,363,-1)
0^1
"KRN",409.61,363,0)
XUMF CHCK^2^^80^4^19^1^1^CHECK^^Check if update is complete^1
"KRN",409.61,363,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,363,"ARRAY")
 ^TMP("XUMF CHCK",$J)
"KRN",409.61,363,"COL",0)
^409.621^1^1
"KRN",409.61,363,"COL",1,0)
MSG^1^80
"KRN",409.61,363,"COL","B","MSG",1)

"KRN",409.61,363,"FNL")
D EXIT^XUMF4
"KRN",409.61,363,"HLP")
D CHCK^XUMF4H
"KRN",409.61,363,"INIT")
D CHCK^XUMF4A
"KRN",409.61,373,-1)
0^10
"KRN",409.61,373,0)
XUMF LIST^2^^80^4^20^1^1^^^Institution list
"KRN",409.61,373,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,373,"ARRAY")
 ^TMP("XUMF LIST1",$J)
"KRN",409.61,373,"COL",0)
^409.621^8^7
"KRN",409.61,373,"COL",1,0)
STATION NUMBER^2^5^STA #
"KRN",409.61,373,"COL",2,0)
INSTITUTION NAME^9^30^INSTITUTION NAME
"KRN",409.61,373,"COL",4,0)
FACILITY TYPE^45^5^TYPE
"KRN",409.61,373,"COL",5,0)
INACTIVE DATE^66^13^INACTIVE DATE
"KRN",409.61,373,"COL",6,0)
STATE^41^2^ST
"KRN",409.61,373,"COL",7,0)
REALIGNED FROM^52^5^FROM
"KRN",409.61,373,"COL",8,0)
REALIGNED TO^59^5^TO
"KRN",409.61,373,"COL","B","FACILITY TYPE",4)

"KRN",409.61,373,"COL","B","INACTIVE DATE",5)

"KRN",409.61,373,"COL","B","INSTITUTION NAME",2)

"KRN",409.61,373,"COL","B","REALIGNED FROM",7)

"KRN",409.61,373,"COL","B","REALIGNED TO",8)

"KRN",409.61,373,"COL","B","STATE",6)

"KRN",409.61,373,"COL","B","STATION NUMBER",1)

"KRN",409.61,373,"FNL")
D EXIT^XUMF4L
"KRN",409.61,373,"HLP")

"KRN",409.61,373,"INIT")
D LIST^XUMF4L
"KRN",771,59,-1)
0^4
"KRN",771,59,0)
XUMF MFN^a^MFS^XUMF SERVER^^^USA
"KRN",771,59,"MSG",0)
^771.06P^1^1
"KRN",771,59,"MSG",1,0)
MSA
"KRN",771,59,"MSG",1,"R")
NONE
"KRN",771,59,"SEG",0)
^771.05P^1^1
"KRN",771,59,"SEG",1,0)
MSH
"KRN",771,59,"SEG",1,"F")
.01
"KRN",771,60,-1)
0^1
"KRN",771,60,0)
XUMF MFK^a^MFS^XUMF SERVER^^^USA
"KRN",771,60,"MSG",0)
^771.06P^1^1
"KRN",771,60,"MSG",1,0)
MSA
"KRN",771,60,"MSG",1,"R")
NONE
"KRN",771,60,"SEG",0)
^771.05P^1^1
"KRN",771,60,"SEG",1,0)
MSH
"KRN",771,60,"SEG",1,"F")
.01
"KRN",771,61,-1)
0^3
"KRN",771,61,0)
XUMF MFR^a^MFS^XUMF SERVER^^^USA
"KRN",771,61,"MSG",0)
^771.06P^2^1
"KRN",771,61,"MSG",2,0)
ZTA
"KRN",771,61,"MSG",2,"R")
NONE
"KRN",771,61,"SEG",0)
^771.05P^1^1
"KRN",771,61,"SEG",1,0)
MSH
"KRN",771,61,"SEG",1,"F")
.01
"KRN",771,62,-1)
0^2
"KRN",771,62,0)
XUMF MFQ^a^MFS^XUMF SERVER^^^USA
"KRN",771,62,"MSG",0)
^771.06P^1^1
"KRN",771,62,"MSG",1,0)
ZTA
"KRN",771,62,"MSG",1,"R")
NONE
"KRN",771,62,"SEG",0)
^771.05P^1^1
"KRN",771,62,"SEG",1,0)
MSH
"KRN",771,62,"SEG",1,"F")
.01
"KRN",870,165,-1)
0^1
"KRN",870,165,0)
XUMF FORUM^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,165,200)
^5^^^600^^^^^S
"KRN",870,165,400)
152.128.1.2^5000^C^^^
"MBREQ")
0
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1
"ORD",11,3.8,0)
MAIL GROUP
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",113,-1)
1^1
"PKG",113,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^XUDOCV7 NEW FEATURES
"PKG",113,20,0)
^9.402P^^
"PKG",113,22,0)
^9.49I^1^1
"PKG",113,22,1,0)
8.0^2950703^2960322^648
"PKG",113,22,1,"PAH",1,0)
206^3010709
"PKG",113,22,1,"PAH",1,1,0)
^^1^1^3010709
"PKG",113,22,1,"PAH",1,1,1,0)
See patch description.
"PRE")
XUMFENV
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","XUAF4")
0^30^B19380664
"RTN","XUAF4",1,0)
XUAF4 ;ISC-SF/RWF/RAM - Instutition file access. ;04/01/99  08:07
"RTN","XUAF4",2,0)
 ;;8.0;KERNEL;**43,112,206**;Aug 19, 1996
"RTN","XUAF4",3,0)
 Q  ;No access from the top.
"RTN","XUAF4",4,0)
 ;
"RTN","XUAF4",5,0)
PARENT(ROOT,CHILD,ASSO) ;sr. Return array of IEN's of parents
"RTN","XUAF4",6,0)
 N %,%0
"RTN","XUAF4",7,0)
 S CHILD=$$LKUP(CHILD),ASSO=$$ASSO($G(ASSO)),%=0
"RTN","XUAF4",8,0)
 F  S %=$O(^DIC(4,CHILD,7,%)) Q:%'>0  S %0=+$P(^(%,0),U,2) D
"RTN","XUAF4",9,0)
 . Q:+%'=ASSO
"RTN","XUAF4",10,0)
 . S @ROOT@("P",+%0)=$$NS(+%0)
"RTN","XUAF4",11,0)
 Q
"RTN","XUAF4",12,0)
CHILDREN(ROOT,PAR,ASSO,XUAC) ;sr. Return the children
"RTN","XUAF4",13,0)
 N %,%1 S %=0,PAR=$$LKUP(PAR),ASSO=$$ASSO($G(ASSO)),XUAC=$G(XUAC)
"RTN","XUAF4",14,0)
 Q:ASSO'>0
"RTN","XUAF4",15,0)
 F  S %=$O(^DIC(4,"AC",ASSO,PAR,%)) Q:%'>0  D
"RTN","XUAF4",16,0)
 . I XUAC,$$STATUS(%)="I" Q
"RTN","XUAF4",17,0)
 . S @ROOT@("C",%)=$$NS(%)
"RTN","XUAF4",18,0)
 Q
"RTN","XUAF4",19,0)
SIBLING(ROOT,CHILD,ASSO) ;sr. Return the siblings
"RTN","XUAF4",20,0)
 N % S %=0,ASSO=$$ASSO($G(ASSO))
"RTN","XUAF4",21,0)
 D PARENT(ROOT,CHILD,ASSO)
"RTN","XUAF4",22,0)
 F  S %=$O(@ROOT@("P",%)) Q:%'>0  D CHILDREN($NA(@ROOT@("P",%)),"`"_%,ASSO)
"RTN","XUAF4",23,0)
 Q
"RTN","XUAF4",24,0)
NNT(%) ;ef.sr. Return Name, Station Number, ASSO
"RTN","XUAF4",25,0)
 I %'>0 Q ""
"RTN","XUAF4",26,0)
 Q $$NS(%)_"^"_$$WHAT(%,13)
"RTN","XUAF4",27,0)
 ;
"RTN","XUAF4",28,0)
LKUP(%) ;ef.sr. Resolve a value into IEN
"RTN","XUAF4",29,0)
 I $E(%)="`" S %=+$E(%,2,99) Q:$D(^DIC(4,%,0))#2 % Q 0
"RTN","XUAF4",30,0)
 ;Q $$FIND1^DIC(4,,"MX",%)
"RTN","XUAF4",31,0)
 Q $$FIND1^DIC(4,,"MX",%,,"I $P(^(0),U,11)'=""I""") ;To screen Inactive
"RTN","XUAF4",32,0)
 ;
"RTN","XUAF4",33,0)
STATUS(%1) ;Get the status of a IEN
"RTN","XUAF4",34,0)
 Q $P(^DIC(4,%,0),U,11)
"RTN","XUAF4",35,0)
 ;
"RTN","XUAF4",36,0)
TYPE(%) ;Lookup a Faclity TYPE in file 4.1
"RTN","XUAF4",37,0)
 I %="" Q %
"RTN","XUAF4",38,0)
 I $D(^DIC(4.1,"B",%))>9 Q %
"RTN","XUAF4",39,0)
 S %=$$FIND1^DIC(4.1,,"MX",%)
"RTN","XUAF4",40,0)
 Q $P($G(^DIC(4.1,+%,0)),U)
"RTN","XUAF4",41,0)
 ;
"RTN","XUAF4",42,0)
ASSO(%) ;Lookup an Asso
"RTN","XUAF4",43,0)
 Q:+%=% % S:%="" %="VISN"
"RTN","XUAF4",44,0)
 S %=$$FIND1^DIC(4.05,,"MX",%)
"RTN","XUAF4",45,0)
 Q +%
"RTN","XUAF4",46,0)
 ;
"RTN","XUAF4",47,0)
NS(IEN) ;ef.sr. Return name and station #
"RTN","XUAF4",48,0)
 Q $P(^DIC(4,IEN,0),U,1)_U_$P($G(^DIC(4,+IEN,99)),U,1)
"RTN","XUAF4",49,0)
 ;
"RTN","XUAF4",50,0)
WHAT(IEN,FLD) ;ef.sr. Field to return
"RTN","XUAF4",51,0)
 Q $$GET1^DIQ(4,IEN_",",FLD,"")
"RTN","XUAF4",52,0)
 ;
"RTN","XUAF4",53,0)
CIRN(%1,%2) ;ef.sr. Is this a CIRN Enables inst.
"RTN","XUAF4",54,0)
 N % S %1=+$G(%1)
"RTN","XUAF4",55,0)
 Q:'$D(^DIC(4,%1,0)) -1
"RTN","XUAF4",56,0)
 I $G(%2)]"" N DIE,DR,DA S DA=%1,DR="990.1///"_%2,DIE="^DIC(4," D ^DIE
"RTN","XUAF4",57,0)
 Q $$WHAT(%1,990.1)
"RTN","XUAF4",58,0)
 ;
"RTN","XUAF4",59,0)
IEN(STA) ;return IEN for a station number
"RTN","XUAF4",60,0)
 S STA=$G(STA) Q:STA="" STA
"RTN","XUAF4",61,0)
 Q $O(^DIC(4,"D",STA,0))
"RTN","XUAF4",62,0)
 ;
"RTN","XUAF4",63,0)
STA(IEN) ;return station number for an IEN
"RTN","XUAF4",64,0)
 Q $P($G(^DIC(4,+IEN,99)),U)
"RTN","XUAF4",65,0)
 ;
"RTN","XUAF4",66,0)
TF(IEN) ;active treating facility? (1=YES,0=NO)
"RTN","XUAF4",67,0)
 N ARRAY Q:'$G(IEN) 0
"RTN","XUAF4",68,0)
 D F4($$STA(IEN),.ARRAY,"AM")
"RTN","XUAF4",69,0)
 Q $S(ARRAY:1,1:0)
"RTN","XUAF4",70,0)
 ;
"RTN","XUAF4",71,0)
RT(IEN) ;realigned to
"RTN","XUAF4",72,0)
 N ARRAY Q:'$G(IEN) 0
"RTN","XUAF4",73,0)
 D F4($$STA(IEN),.ARRAY)
"RTN","XUAF4",74,0)
 Q $G(ARRAY("REALIGNED TO"))
"RTN","XUAF4",75,0)
 ;
"RTN","XUAF4",76,0)
RF(IEN) ;realigned from
"RTN","XUAF4",77,0)
 N ARRAY Q:'$G(IEN) 0
"RTN","XUAF4",78,0)
 D F4($$STA(IEN),.ARRAY)
"RTN","XUAF4",79,0)
 Q $G(ARRAY("REALIGNED FROM"))
"RTN","XUAF4",80,0)
 ;
"RTN","XUAF4",81,0)
O99(IEN) ;returns pointer to new station number IEN
"RTN","XUAF4",82,0)
 Q:$O(^DIC(4,"AOLD99",+$G(IEN),""))="" ""
"RTN","XUAF4",83,0)
 Q $O(^DIC(4,"D",$O(^DIC(4,"AOLD99",+$G(IEN),"")),0))
"RTN","XUAF4",84,0)
 ;
"RTN","XUAF4",85,0)
F4(STA,ARRAY,FLAG,ONDT) ;File #4 multipurpose API
"RTN","XUAF4",86,0)
 ;
"RTN","XUAF4",87,0)
 ;INPUT
"RTN","XUAF4",88,0)
 ;       STA     Station number (required)
"RTN","XUAF4",89,0)
 ;
"RTN","XUAF4",90,0)
 ;    [.]ARRAY   $NAME reference for return values.  (required)
"RTN","XUAF4",91,0)
 ;
"RTN","XUAF4",92,0)
 ;       FLAG    A = Active entries only.  (optional)
"RTN","XUAF4",93,0)
 ;               M = Medical treating facilities only.
"RTN","XUAF4",94,0)
 ;
"RTN","XUAF4",95,0)
 ;       ONDT    Return name on this FM internal date.  (optional);
"RTN","XUAF4",96,0)
 ;
"RTN","XUAF4",97,0)
 ;OUTPUT
"RTN","XUAF4",98,0)
 ;       ARRAY                     IEN or '0^error message'
"RTN","XUAF4",99,0)
 ;       ARRAY("NAME")             name
"RTN","XUAF4",100,0)
 ;       ARRAY("VA NAME")          offical va name
"RTN","XUAF4",101,0)
 ;       ARRAY("STATION NUMBER")   station number
"RTN","XUAF4",102,0)
 ;       ARRAY("TYPE")             facilty type name
"RTN","XUAF4",103,0)
 ;       ARRAY("INACTIVE")         inactive date (0=not inactive)
"RTN","XUAF4",104,0)
 ;       note: if inactive date not available but entry inactive then 1
"RTN","XUAF4",105,0)
 ;
"RTN","XUAF4",106,0)
 ;       ARRAY("REALIGNED TO")     IEN^station number^date
"RTN","XUAF4",107,0)
 ;       ARRAY("REALIGNED FROM")   IEN^station number^date
"RTN","XUAF4",108,0)
 ;
"RTN","XUAF4",109,0)
 K ARRAY
"RTN","XUAF4",110,0)
 S STA=$G(STA),FLAG=$G(FLAG),ONDT=$G(ONDT)
"RTN","XUAF4",111,0)
 I STA="" S ARRAY="0^invalid input STA - required" Q
"RTN","XUAF4",112,0)
 ;
"RTN","XUAF4",113,0)
 N IEN,N99,TO,FM,I,RDT,NAME,VANAME,HDT
"RTN","XUAF4",114,0)
 ;
"RTN","XUAF4",115,0)
 S IEN=$$IEN(STA)
"RTN","XUAF4",116,0)
 I 'IEN S ARRAY="0^station number does not exist" Q
"RTN","XUAF4",117,0)
 S N99=$G(^DIC(4,+IEN,99))
"RTN","XUAF4",118,0)
 S ARRAY=$$SCRN() Q:'ARRAY
"RTN","XUAF4",119,0)
 ;
"RTN","XUAF4",120,0)
 S ARRAY("NAME")=$P(^DIC(4,IEN,0),U)
"RTN","XUAF4",121,0)
 S ARRAY("VA NAME")=$P(N99,U,3)
"RTN","XUAF4",122,0)
 S ARRAY("STATION NUMBER")=STA
"RTN","XUAF4",123,0)
 S ARRAY("TYPE")=$P($G(^DIC(4.1,+$G(^DIC(4,IEN,3)),0)),U)
"RTN","XUAF4",124,0)
 ;
"RTN","XUAF4",125,0)
 ;realignments
"RTN","XUAF4",126,0)
 S TO=$O(^DIC(4,"ARTO",IEN,0)) D:TO
"RTN","XUAF4",127,0)
 .S RDT=$O(^DIC(4,"ART",TO,IEN,0))
"RTN","XUAF4",128,0)
 .S ARRAY("REALIGNED TO")=TO_U_$$STA(TO)_U_RDT
"RTN","XUAF4",129,0)
 S FM=$O(^DIC(4,"ARFM",IEN,0)) D:FM
"RTN","XUAF4",130,0)
 .S ARRAY("REALIGNED FROM")=FM_U_$$STA(FM)_U_$O(^DIC(4,"ARF",FM,IEN,0))
"RTN","XUAF4",131,0)
 ;
"RTN","XUAF4",132,0)
 S I=$O(^DIC(4,"AI",IEN,0)),I=$S(I:I,$G(RDT):RDT,1:+$P(N99,U,4))
"RTN","XUAF4",133,0)
 S ARRAY("INACTIVE")=I
"RTN","XUAF4",134,0)
 ;
"RTN","XUAF4",135,0)
 Q:'ONDT
"RTN","XUAF4",136,0)
 ;
"RTN","XUAF4",137,0)
 ;get name for date
"RTN","XUAF4",138,0)
 S NAME=ARRAY("NAME")
"RTN","XUAF4",139,0)
 S VANAME=ARRAY("VA NAME")
"RTN","XUAF4",140,0)
 S HDT=DT
"RTN","XUAF4",141,0)
 F  S HDT=$O(^DIC(4,IEN,999,HDT),-1) Q:('HDT!(HDT<ONDT))  D
"RTN","XUAF4",142,0)
 .N X S X=$G(^DIC(4,IEN,999,HDT,0)) Q:X=""
"RTN","XUAF4",143,0)
 .S:$P(X,U,2)'="" NAME=$P(X,U,2)
"RTN","XUAF4",144,0)
 .S:$P(X,U,3)'="" VANAME=$P(X,U,3)
"RTN","XUAF4",145,0)
 S ARRAY("NAME")=NAME
"RTN","XUAF4",146,0)
 S ARRAY("VA NAME")=VANAME
"RTN","XUAF4",147,0)
 ;
"RTN","XUAF4",148,0)
 Q
"RTN","XUAF4",149,0)
 ;
"RTN","XUAF4",150,0)
IDT(IEN) ; inactive date
"RTN","XUAF4",151,0)
 N IDT,ND,XDT
"RTN","XUAF4",152,0)
 S IEN=$G(IEN) Q:'IEN IEN
"RTN","XUAF4",153,0)
 S XDT=9999999,IDT=""
"RTN","XUAF4",154,0)
 F  S XDT=$O(^DIC(4,+IEN,999,XDT),-1) Q:'XDT  D  Q:IDT
"RTN","XUAF4",155,0)
 .S ND=$G(^DIC(4,+IEN,999,XDT,0)) Q:ND="" ND
"RTN","XUAF4",156,0)
 .S IDT=$S($P(ND,U,5):XDT,$P(ND,U,7):XDT,1:IDT)
"RTN","XUAF4",157,0)
 Q IDT
"RTN","XUAF4",158,0)
 ;
"RTN","XUAF4",159,0)
SCRN() ;sreen IEN
"RTN","XUAF4",160,0)
 N X S X=$E(N99,1,3)
"RTN","XUAF4",161,0)
 I FLAG["A",$P(N99,U,4) Q "0^inactive facility"
"RTN","XUAF4",162,0)
 I FLAG["M",$S(X<400:1,X>759:1,X<700:0,X<750:1,1:0) Q "0^not a treating facility"
"RTN","XUAF4",163,0)
 Q IEN
"RTN","XUAF4",164,0)
 ;
"RTN","XUMF4")
0^27^B59728107
"RTN","XUMF4",1,0)
XUMF4 ;CIOFO-SF/RAM - Institution File Clean Up; 06/28/00
"RTN","XUMF4",2,0)
 ;;8.0;KERNEL;**206**;Jul 10, 1995
"RTN","XUMF4",3,0)
 ;
"RTN","XUMF4",4,0)
 ;
"RTN","XUMF4",5,0)
EN ; -- entry point
"RTN","XUMF4",6,0)
 ;
"RTN","XUMF4",7,0)
 N ERROR,PARAM,XUMFLAG
"RTN","XUMF4",8,0)
 ;
"RTN","XUMF4",9,0)
 S ERROR=0,XUMFLAG=0
"RTN","XUMF4",10,0)
 L +^TMP("XUMF ARRAY",$J):0 S:'$T ERROR=1
"RTN","XUMF4",11,0)
 I ERROR S ERROR="1^another process is using the Master File Server" Q
"RTN","XUMF4",12,0)
 ;
"RTN","XUMF4",13,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D
"RTN","XUMF4",14,0)
 .W !!,"...connecting with master file server..."
"RTN","XUMF4",15,0)
 .D MFS
"RTN","XUMF4",16,0)
 ;
"RTN","XUMF4",17,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D  Q
"RTN","XUMF4",18,0)
 .W !!,"Connection to master file server failed!",!
"RTN","XUMF4",19,0)
 .L -^TMP("XUMF ARRAY",$J)
"RTN","XUMF4",20,0)
 ;
"RTN","XUMF4",21,0)
 D EN^VALM("XUMF NAME")
"RTN","XUMF4",22,0)
 ;
"RTN","XUMF4",23,0)
 L -^TMP("XUMF ARRAY",$J)
"RTN","XUMF4",24,0)
 K ^TMP("XUMF ARRAY",$J),^TMP("XUMF MFS",$J)
"RTN","XUMF4",25,0)
 ;
"RTN","XUMF4",26,0)
 Q
"RTN","XUMF4",27,0)
 ;
"RTN","XUMF4",28,0)
RDSN ; - resolve duplicate station number
"RTN","XUMF4",29,0)
 ;
"RTN","XUMF4",30,0)
 I '$O(@VALMAR@("INDEX",0)) D  Q
"RTN","XUMF4",31,0)
 .W !!,"No duplicates to select from!",!
"RTN","XUMF4",32,0)
 .S VALMBCK="R" H 2
"RTN","XUMF4",33,0)
 ;
"RTN","XUMF4",34,0)
 N ENTRY,VALMY,DA,DR,DIE,STA,MERGED,FROM
"RTN","XUMF4",35,0)
 ;
"RTN","XUMF4",36,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","XUMF4",37,0)
 ;
"RTN","XUMF4",38,0)
 ;S ENTRY=0
"RTN","XUMF4",39,0)
 ;F  S ENTRY=$O(VALMY(ENTRY)) Q:'ENTRY  D
"RTN","XUMF4",40,0)
 ;.S DA=@VALMAR@("INDEX",ENTRY)
"RTN","XUMF4",41,0)
 ;.S DR="99///@",DIE=4
"RTN","XUMF4",42,0)
 ;.D ^DIE
"RTN","XUMF4",43,0)
 S DA=@VALMAR@("INDEX",+$O(VALMY(0)))
"RTN","XUMF4",44,0)
 S DR="99///@",DIE=4
"RTN","XUMF4",45,0)
 I DA D
"RTN","XUMF4",46,0)
 .I $O(^HLCS(870,"C",DA,0)) D  Q
"RTN","XUMF4",47,0)
 ..W !!?20,"Pointed to by HL7 Logical Link"
"RTN","XUMF4",48,0)
 ..W !?22,"*select other entry*",!!
"RTN","XUMF4",49,0)
 .D ^DIE
"RTN","XUMF4",50,0)
 ;
"RTN","XUMF4",51,0)
 D @($E($P(VALMAR,"XUMF ",2),1,4)_"^XUMF4")
"RTN","XUMF4",52,0)
 S VALMBCK="R"
"RTN","XUMF4",53,0)
 ;
"RTN","XUMF4",54,0)
 Q
"RTN","XUMF4",55,0)
 ;
"RTN","XUMF4",56,0)
 ;
"RTN","XUMF4",57,0)
DSTA ; -- duplicate station #s
"RTN","XUMF4",58,0)
 ;
"RTN","XUMF4",59,0)
 K ^TMP("XUMF DSTA",$J),^TMP("XUMF TMP",$J)
"RTN","XUMF4",60,0)
 ;
"RTN","XUMF4",61,0)
 I 'XUMFLAG D LOCAL
"RTN","XUMF4",62,0)
 ;
"RTN","XUMF4",63,0)
 S STA="",IEN=0
"RTN","XUMF4",64,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",65,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",66,0)
 ..Q:'$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4",67,0)
 ..S ^TMP("XUMF TMP",$J,STA,IEN)=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4",68,0)
 ;
"RTN","XUMF4",69,0)
 S STA="",(VALMCNT,IEN)=0
"RTN","XUMF4",70,0)
 F  S STA=$O(^TMP("XUMF TMP",$J,STA)) Q:STA=""  D
"RTN","XUMF4",71,0)
 .Q:'$O(^TMP("XUMF TMP",$J,STA,+$O(^TMP("XUMF TMP",$J,STA,0))))
"RTN","XUMF4",72,0)
 .F  S IEN=$O(^TMP("XUMF TMP",$J,STA,IEN)) Q:'IEN  D
"RTN","XUMF4",73,0)
 ..S VALMCNT=VALMCNT+1
"RTN","XUMF4",74,0)
 ..S VAR="",NAME=$P(^TMP("XUMF TMP",$J,STA,IEN),U)
"RTN","XUMF4",75,0)
 ..S VAR=$$SETFLD^VALM1(VALMCNT,VAR,"ENTRY NUMBER")
"RTN","XUMF4",76,0)
 ..S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",77,0)
 ..S VAR=$$SETFLD^VALM1(NAME,VAR,"INSTITUTION NAME")
"RTN","XUMF4",78,0)
 ..S VAR=$$SETFLD^VALM1(IEN,VAR,"IEN")
"RTN","XUMF4",79,0)
 ..D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",80,0)
 ..S @VALMAR@("INDEX",VALMCNT)=IEN
"RTN","XUMF4",81,0)
 ;
"RTN","XUMF4",82,0)
 D:'VALMCNT
"RTN","XUMF4",83,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***No duplicates***",VAR,"INSTITUTION NAME")
"RTN","XUMF4",84,0)
 .S VALMCNT=1
"RTN","XUMF4",85,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",86,0)
 ;
"RTN","XUMF4",87,0)
 K ^TMP("XUMF TMP",$J)
"RTN","XUMF4",88,0)
 ;
"RTN","XUMF4",89,0)
 Q
"RTN","XUMF4",90,0)
 ;
"RTN","XUMF4",91,0)
LOCAL ; -- auto-delete local/duplicate station numbers
"RTN","XUMF4",92,0)
 ;
"RTN","XUMF4",93,0)
 W !!,"This action will auto-delete local/duplicate station numbers."
"RTN","XUMF4",94,0)
 N Y
"RTN","XUMF4",95,0)
 S DIR(0)="Y",DIR("B")="YES" W !
"RTN","XUMF4",96,0)
 S DIR("A")="Do you wish to proceed"
"RTN","XUMF4",97,0)
 D ^DIR K DIR
"RTN","XUMF4",98,0)
 I 'Y Q
"RTN","XUMF4",99,0)
 ;
"RTN","XUMF4",100,0)
 S XUMFLAG=1
"RTN","XUMF4",101,0)
 D DXRF
"RTN","XUMF4",102,0)
 ;
"RTN","XUMF4",103,0)
 N IEN,STA,STANUM,VAR,NAME,FLAG,CNT
"RTN","XUMF4",104,0)
 ;
"RTN","XUMF4",105,0)
 S STA="",IEN=0,CNT=0
"RTN","XUMF4",106,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",107,0)
 .Q:'$O(^DIC(4,"D",STA,+$O(^DIC(4,"D",STA,0))))
"RTN","XUMF4",108,0)
 .S FLAG=0
"RTN","XUMF4",109,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",110,0)
 ..S:$O(^HLCS(870,"C",IEN,0)) FLAG=1
"RTN","XUMF4",111,0)
 .Q:'FLAG
"RTN","XUMF4",112,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",113,0)
 ..Q:$O(^HLCS(870,"C",IEN,0))
"RTN","XUMF4",114,0)
 ..W !?5,"deleting duplicate station number ",STA," from IEN: ",IEN
"RTN","XUMF4",115,0)
 ..H 1
"RTN","XUMF4",116,0)
 ..S DR="99///@",DIE=4,DA=IEN,CNT=CNT+1
"RTN","XUMF4",117,0)
 ..N IEN,STA,FLAG D ^DIE
"RTN","XUMF4",118,0)
 I CNT D EOP S CNT=0
"RTN","XUMF4",119,0)
 ;
"RTN","XUMF4",120,0)
 S STA="",IEN=0
"RTN","XUMF4",121,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",122,0)
 .Q:$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4",123,0)
 .Q:'$D(^TMP("XUMF ARRAY",$J))
"RTN","XUMF4",124,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",125,0)
 ..S DR="99///@",DIE=4,DA=IEN,CNT=CNT+1
"RTN","XUMF4",126,0)
 ..W !?5,"deleting local station number ",STA," from IEN: ",IEN
"RTN","XUMF4",127,0)
 ..H 1
"RTN","XUMF4",128,0)
 ..N IEN,STA D ^DIE
"RTN","XUMF4",129,0)
 I CNT D EOP S CNT=0
"RTN","XUMF4",130,0)
 ;
"RTN","XUMF4",131,0)
 Q
"RTN","XUMF4",132,0)
 ;
"RTN","XUMF4",133,0)
 ;
"RTN","XUMF4",134,0)
DXRF ; -- re-index "D" cross-reference
"RTN","XUMF4",135,0)
 ;
"RTN","XUMF4",136,0)
 N DIK
"RTN","XUMF4",137,0)
 ;
"RTN","XUMF4",138,0)
 K ^DIC(4,"D")
"RTN","XUMF4",139,0)
 ;
"RTN","XUMF4",140,0)
 S DIK="^DIC(4,",DIK(1)="99^D" D ENALL^DIK
"RTN","XUMF4",141,0)
 ;
"RTN","XUMF4",142,0)
 Q
"RTN","XUMF4",143,0)
 ;
"RTN","XUMF4",144,0)
 ;
"RTN","XUMF4",145,0)
LLCL ; -- local data
"RTN","XUMF4",146,0)
 ;
"RTN","XUMF4",147,0)
 K ^TMP("XUMF LLCL",$J)
"RTN","XUMF4",148,0)
 ;
"RTN","XUMF4",149,0)
 N STA,IEN,STANUM,VAR,NAME,FTYP
"RTN","XUMF4",150,0)
 ;
"RTN","XUMF4",151,0)
 S STA="",VALMCNT=0
"RTN","XUMF4",152,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",153,0)
 .S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4",154,0)
 .S FTYP=$P($G(^DIC(4.1,+$G(^DIC(4,+IEN,3)),0)),U)
"RTN","XUMF4",155,0)
 .Q:$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4",156,0)
 .S VALMCNT=VALMCNT+1
"RTN","XUMF4",157,0)
 .S VAR="",NAME=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4",158,0)
 .S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",159,0)
 .S VAR=$$SETFLD^VALM1(NAME,VAR,"INSTITUTION NAME")
"RTN","XUMF4",160,0)
 .S VAR=$$SETFLD^VALM1(IEN,VAR,"IEN")
"RTN","XUMF4",161,0)
 .S VAR=$$SETFLD^VALM1(FTYP,VAR,"FACILITY TYPE")
"RTN","XUMF4",162,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",163,0)
 .S @VALMAR@("INDEX",VALMCNT)=IEN
"RTN","XUMF4",164,0)
 ;
"RTN","XUMF4",165,0)
 D:'VALMCNT
"RTN","XUMF4",166,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***None found***",VAR,"INSTITUTION NAME")
"RTN","XUMF4",167,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4",168,0)
 ;
"RTN","XUMF4",169,0)
 Q
"RTN","XUMF4",170,0)
 ;
"RTN","XUMF4",171,0)
 ;
"RTN","XUMF4",172,0)
NATL ; -- national data to merge
"RTN","XUMF4",173,0)
 ;
"RTN","XUMF4",174,0)
 K ^TMP("XUMF NATL",$J)
"RTN","XUMF4",175,0)
 ;
"RTN","XUMF4",176,0)
 N STA,VAR,NAME,TYPE,STATE
"RTN","XUMF4",177,0)
 ;
"RTN","XUMF4",178,0)
 S STA="",VALMCNT=0
"RTN","XUMF4",179,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4",180,0)
 .Q:$D(^DIC(4,"D",STA))
"RTN","XUMF4",181,0)
 .S VALMCNT=VALMCNT+1
"RTN","XUMF4",182,0)
 .S VAR="",NAME=$P(^TMP("XUMF ARRAY",$J,STA),U,2)
"RTN","XUMF4",183,0)
 .S TYPE=$P($P(^TMP("XUMF ARRAY",$J,STA),U,5),"~")
"RTN","XUMF4",184,0)
 .S STATE=$P(^TMP("XUMF ARRAY",$J,STA),U,8)
"RTN","XUMF4",185,0)
 .S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",186,0)
 .S VAR=$$SETFLD^VALM1(NAME,VAR,"NATIONAL NAME")
"RTN","XUMF4",187,0)
 .S VAR=$$SETFLD^VALM1(STATE,VAR,"STATE")
"RTN","XUMF4",188,0)
 .S VAR=$$SETFLD^VALM1(TYPE,VAR,"TYPE")
"RTN","XUMF4",189,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",190,0)
 ;
"RTN","XUMF4",191,0)
 D:'VALMCNT
"RTN","XUMF4",192,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***None found***",VAR,"NATIONAL NAME")
"RTN","XUMF4",193,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4",194,0)
 ;
"RTN","XUMF4",195,0)
 Q
"RTN","XUMF4",196,0)
 ;
"RTN","XUMF4",197,0)
 ;
"RTN","XUMF4",198,0)
NAME ; -- compare INSTITUTION name vs national name
"RTN","XUMF4",199,0)
 ;
"RTN","XUMF4",200,0)
 K ^TMP("XUMF NAME",$J),^TMP("XUMF TABLE",$J)
"RTN","XUMF4",201,0)
 ;
"RTN","XUMF4",202,0)
 N STA,IEN,NAME,GOLD,NAME,VAR,ARRAY
"RTN","XUMF4",203,0)
 ;
"RTN","XUMF4",204,0)
 D DXRF
"RTN","XUMF4",205,0)
 ;
"RTN","XUMF4",206,0)
 S STA="",(IEN,VALMCNT)=0
"RTN","XUMF4",207,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",208,0)
 .S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4",209,0)
 .S GOLD=$P($G(^TMP("XUMF ARRAY",$J,STA)),U,2)
"RTN","XUMF4",210,0)
 .S NAME=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4",211,0)
 .S ^TMP("XUMF TABLE",$J,STA,IEN)=NAME_U_GOLD
"RTN","XUMF4",212,0)
 ;
"RTN","XUMF4",213,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4",214,0)
 .Q:$D(^TMP("XUMF TABLE",$J,STA))
"RTN","XUMF4",215,0)
 .S NAME=$P(^TMP("XUMF ARRAY",$J,STA),U,2)
"RTN","XUMF4",216,0)
 .S ^TMP("XUMF TABLE",$J,STA,9999)="^"_NAME
"RTN","XUMF4",217,0)
 ;
"RTN","XUMF4",218,0)
 S (IEN,VALMCNT)=0
"RTN","XUMF4",219,0)
 F  S STA=$O(^TMP("XUMF TABLE",$J,STA)) Q:STA=""  D
"RTN","XUMF4",220,0)
 .F  S IEN=$O(^TMP("XUMF TABLE",$J,STA,IEN)) Q:'IEN  D
"RTN","XUMF4",221,0)
 ..S GOLD=$P(^TMP("XUMF TABLE",$J,STA,IEN),U,2)
"RTN","XUMF4",222,0)
 ..S NAME=$P(^TMP("XUMF TABLE",$J,STA,IEN),U)
"RTN","XUMF4",223,0)
 ..S VALMCNT=VALMCNT+1,VAR=""
"RTN","XUMF4",224,0)
 ..S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",225,0)
 ..S VAR=$$SETFLD^VALM1(NAME,VAR,"INSTITUTION NAME")
"RTN","XUMF4",226,0)
 ..S VAR=$$SETFLD^VALM1(GOLD,VAR,"GOLD NAME")
"RTN","XUMF4",227,0)
 ..D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",228,0)
 ;
"RTN","XUMF4",229,0)
 D:'VALMCNT
"RTN","XUMF4",230,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***None found***",VAR,"INSTITUTION NAME")
"RTN","XUMF4",231,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4",232,0)
 ;
"RTN","XUMF4",233,0)
 K ^TMP("XUMF TABLE",$J)
"RTN","XUMF4",234,0)
 ;
"RTN","XUMF4",235,0)
 Q
"RTN","XUMF4",236,0)
 ;
"RTN","XUMF4",237,0)
 ;
"RTN","XUMF4",238,0)
MFS ; -- get national file from Master File Server
"RTN","XUMF4",239,0)
 ;
"RTN","XUMF4",240,0)
 D FACTYP^XUMF4A
"RTN","XUMF4",241,0)
 D STATE^XUMF4A
"RTN","XUMF4",242,0)
 ;
"RTN","XUMF4",243,0)
 ;S PARAM("LLNK")="XUMF MFR^XUMF VAA"
"RTN","XUMF4",244,0)
 S PARAM("LLNK")="XUMF MFR^XUMF FORUM"
"RTN","XUMF4",245,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMF4",246,0)
 ;
"RTN","XUMF4",247,0)
 W !!,"...getting FACILITY TYPE file..."
"RTN","XUMF4",248,0)
 D MAIN^XUMFP(4.1,"ALL",5,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",249,0)
 D MAIN^XUMFI(4.1,"ALL",5,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",250,0)
 D MAIN^XUMFH
"RTN","XUMF4",251,0)
 ;
"RTN","XUMF4",252,0)
 ;S PARAM("LLNK")="XUMF MFR^XUMF VAA"
"RTN","XUMF4",253,0)
 S PARAM("LLNK")="XUMF MFR^XUMF FORUM"
"RTN","XUMF4",254,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMF4",255,0)
 ;
"RTN","XUMF4",256,0)
 W !!,"...getting INSTITUTION file..."
"RTN","XUMF4",257,0)
 W !,"...please wait...(approx. 5 minutes)..."
"RTN","XUMF4",258,0)
 D MAIN^XUMFP(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",259,0)
 D MAIN^XUMFI(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",260,0)
 D MAIN^XUMFH
"RTN","XUMF4",261,0)
 ;
"RTN","XUMF4",262,0)
 Q
"RTN","XUMF4",263,0)
 ;
"RTN","XUMF4",264,0)
EXIT ; -- cleanup and quit
"RTN","XUMF4",265,0)
 ;
"RTN","XUMF4",266,0)
 K @VALMAR
"RTN","XUMF4",267,0)
 ;
"RTN","XUMF4",268,0)
 Q
"RTN","XUMF4",269,0)
 ;
"RTN","XUMF4",270,0)
EOP ; -- End-of-Page
"RTN","XUMF4",271,0)
 ;
"RTN","XUMF4",272,0)
 S DIR(0)="E"
"RTN","XUMF4",273,0)
 D ^DIR,CLEAR^VALM1
"RTN","XUMF4",274,0)
 S VALMBCK="R"
"RTN","XUMF4",275,0)
 Q
"RTN","XUMF4A")
0^28^B55477469
"RTN","XUMF4A",1,0)
XUMF4A ;CIOFO-SF/RAM - Institution File Clean Up; 06/28/99
"RTN","XUMF4A",2,0)
 ;;8.0;KERNEL;**206**;Jul 10, 1995
"RTN","XUMF4A",3,0)
 ;
"RTN","XUMF4A",4,0)
 ;
"RTN","XUMF4A",5,0)
EN ; -- entry point
"RTN","XUMF4A",6,0)
 ;
"RTN","XUMF4A",7,0)
 I $$CDSN D  Q
"RTN","XUMF4A",8,0)
 .D MSG^VALM10("Duplicates sta #s exist! -- NOTHING UPDATED!!!")
"RTN","XUMF4A",9,0)
 .H 5
"RTN","XUMF4A",10,0)
 .S VALMBCK="R"
"RTN","XUMF4A",11,0)
 ;
"RTN","XUMF4A",12,0)
 W "...working",!
"RTN","XUMF4A",13,0)
 D DSN,CSN,GOLD,ASSC,HIST
"RTN","XUMF4A",14,0)
 ;
"RTN","XUMF4A",15,0)
 K ^TMP("XUMF NAME",$J)
"RTN","XUMF4A",16,0)
 D NAME^XUMF4
"RTN","XUMF4A",17,0)
 S VALMBG=1
"RTN","XUMF4A",18,0)
 S VALMBCK="R"
"RTN","XUMF4A",19,0)
 ;
"RTN","XUMF4A",20,0)
 Q
"RTN","XUMF4A",21,0)
 ;
"RTN","XUMF4A",22,0)
DSN ; -- clean out local station numbers
"RTN","XUMF4A",23,0)
 ;
"RTN","XUMF4A",24,0)
 N IEN,DIE,DR,DA,XUMF,DIK
"RTN","XUMF4A",25,0)
 ;
"RTN","XUMF4A",26,0)
 S XUMF=1
"RTN","XUMF4A",27,0)
 ;
"RTN","XUMF4A",28,0)
 S IEN=0
"RTN","XUMF4A",29,0)
 F  S IEN=$O(^DIC(4,IEN)) Q:'IEN  D
"RTN","XUMF4A",30,0)
 .S STA=$P($G(^DIC(4,+IEN,99)),U) Q:STA=""
"RTN","XUMF4A",31,0)
 .Q:$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4A",32,0)
 .S DR="99///@",DIE=4,DA=IEN
"RTN","XUMF4A",33,0)
 .N IEN D ^DIE
"RTN","XUMF4A",34,0)
 ;
"RTN","XUMF4A",35,0)
 S STA="",IEN=0
"RTN","XUMF4A",36,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4A",37,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4A",38,0)
 ..Q:$P($G(^DIC(4,+IEN,99)),U)=STA
"RTN","XUMF4A",39,0)
 ..K ^DIC(4,"D",STA,IEN)
"RTN","XUMF4A",40,0)
 ;
"RTN","XUMF4A",41,0)
 S DIK="^DIC(4,",DIK(1)="99^D" D ENALL^DIK
"RTN","XUMF4A",42,0)
 ;
"RTN","XUMF4A",43,0)
 Q
"RTN","XUMF4A",44,0)
 ;
"RTN","XUMF4A",45,0)
CSN ; -- check/update status
"RTN","XUMF4A",46,0)
 ;
"RTN","XUMF4A",47,0)
 N IEN,DIE,DR,DA,XUMF,STATUS,STA
"RTN","XUMF4A",48,0)
 ;
"RTN","XUMF4A",49,0)
 S XUMF=1
"RTN","XUMF4A",50,0)
 ;
"RTN","XUMF4A",51,0)
 S IEN=0
"RTN","XUMF4A",52,0)
 F  S IEN=$O(^DIC(4,IEN)) Q:'IEN  D
"RTN","XUMF4A",53,0)
 .S STA=$P($G(^DIC(4,+IEN,99)),U)
"RTN","XUMF4A",54,0)
 .I STA S DR="11///N",DIE=4,DA=IEN N IEN D ^DIE Q
"RTN","XUMF4A",55,0)
 .S STATUS=$P(^DIC(4,IEN,0),U,11)
"RTN","XUMF4A",56,0)
 .I STATUS="I" S DR="101///I",DIE=4,DA=IEN N IEN D ^DIE
"RTN","XUMF4A",57,0)
 .S DR="11///L",DIE=4,DA=IEN N IEN D ^DIE
"RTN","XUMF4A",58,0)
 ;
"RTN","XUMF4A",59,0)
 Q
"RTN","XUMF4A",60,0)
 ;
"RTN","XUMF4A",61,0)
GOLD ; -- add missing national data from standard table
"RTN","XUMF4A",62,0)
 ;
"RTN","XUMF4A",63,0)
 N STA,NAME,FDA,ERROR,IEN,IENS,X,FLAG,CNT
"RTN","XUMF4A",64,0)
 N OLDNAME,OLDVANM,STATE,FACTYP,XUMF
"RTN","XUMF4A",65,0)
 ;
"RTN","XUMF4A",66,0)
 S XUMF=1
"RTN","XUMF4A",67,0)
 ;
"RTN","XUMF4A",68,0)
 S STA="",CNT=0
"RTN","XUMF4A",69,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",70,0)
 .S X=^TMP("XUMF ARRAY",$J,STA)
"RTN","XUMF4A",71,0)
 .S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4A",72,0)
 .S OLDNAME=$P($G(^DIC(4,+IEN,0)),U,1)
"RTN","XUMF4A",73,0)
 .S OLDVANM=$P($G(^DIC(4,+IEN,99)),U,3)
"RTN","XUMF4A",74,0)
 .S IENS=$S(IEN:IEN_",",1:"+1,")
"RTN","XUMF4A",75,0)
 .S NAME=$P(X,U,2)
"RTN","XUMF4A",76,0)
 .S FACTYP=$P(X,U,5)
"RTN","XUMF4A",77,0)
 .S VANAME=$P(X,U,6)
"RTN","XUMF4A",78,0)
 .S FLAG=$P(X,U,7)
"RTN","XUMF4A",79,0)
 .S STATE=$P(X,U,8)
"RTN","XUMF4A",80,0)
 .K FDA
"RTN","XUMF4A",81,0)
 .S FDA(4,IENS,.01)=NAME
"RTN","XUMF4A",82,0)
 .S FDA(4,IENS,.02)=STATE
"RTN","XUMF4A",83,0)
 .S FDA(4,IENS,99)=STA
"RTN","XUMF4A",84,0)
 .S FDA(4,IENS,11)="NATIONAL"
"RTN","XUMF4A",85,0)
 .S FDA(4,IENS,13)=$P(FACTYP,"~")
"RTN","XUMF4A",86,0)
 .S FDA(4,IENS,100)=VANAME
"RTN","XUMF4A",87,0)
 .S FDA(4,IENS,101)=FLAG
"RTN","XUMF4A",88,0)
 .D
"RTN","XUMF4A",89,0)
 ..N IEN,STA,NAME,VANAME,OLDNAME,OLDVANM
"RTN","XUMF4A",90,0)
 ..D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",91,0)
 .I 'IEN S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4A",92,0)
 .Q:'IEN
"RTN","XUMF4A",93,0)
 .I OLDNAME="" Q
"RTN","XUMF4A",94,0)
 .I OLDNAME=NAME,VANAME=OLDVANM Q
"RTN","XUMF4A",95,0)
 .S IENS="?+"_DT_","_IEN_","
"RTN","XUMF4A",96,0)
 .K FDA
"RTN","XUMF4A",97,0)
 .S FDA(4.999,IENS,.01)=DT
"RTN","XUMF4A",98,0)
 .S:NAME'=OLDNAME FDA(4.999,IENS,.02)=OLDNAME
"RTN","XUMF4A",99,0)
 .S:VANAME'=OLDVANM FDA(4.999,IENS,.03)=OLDVANM
"RTN","XUMF4A",100,0)
 .D
"RTN","XUMF4A",101,0)
 ..N STA
"RTN","XUMF4A",102,0)
 ..D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",103,0)
 ..S CNT=CNT+1 I '(CNT#10) W "."
"RTN","XUMF4A",104,0)
 ;
"RTN","XUMF4A",105,0)
 Q
"RTN","XUMF4A",106,0)
 ;
"RTN","XUMF4A",107,0)
ASSC ; -- populate associations (parent facility and VISN)
"RTN","XUMF4A",108,0)
 ;
"RTN","XUMF4A",109,0)
 N IEN,STA,VISN,PARENT,FDA,XUMF,CNT
"RTN","XUMF4A",110,0)
 ;
"RTN","XUMF4A",111,0)
 S XUMF=1
"RTN","XUMF4A",112,0)
 ;
"RTN","XUMF4A",113,0)
 S STA="",CNT=0
"RTN","XUMF4A",114,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",115,0)
 .S IEN=$O(^DIC(4,"D",STA,0)) Q:'IEN
"RTN","XUMF4A",116,0)
 .S VISN=$P(^TMP("XUMF ARRAY",$J,STA),U,9)
"RTN","XUMF4A",117,0)
 .I VISN'="" D
"RTN","XUMF4A",118,0)
 ..K FDA
"RTN","XUMF4A",119,0)
 ..S IENS="?+1,"_IEN_","
"RTN","XUMF4A",120,0)
 ..S FDA(4.014,IENS,.01)="VISN"
"RTN","XUMF4A",121,0)
 ..S FDA(4.014,IENS,1)=$P(VISN,"~")
"RTN","XUMF4A",122,0)
 ..D
"RTN","XUMF4A",123,0)
 ...N IEN,STA
"RTN","XUMF4A",124,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",125,0)
 .S PARENT=$P(^TMP("XUMF ARRAY",$J,STA),U,10)
"RTN","XUMF4A",126,0)
 .I PARENT'="" D
"RTN","XUMF4A",127,0)
 ..K FDA
"RTN","XUMF4A",128,0)
 ..S IENS="?+2,"_IEN_","
"RTN","XUMF4A",129,0)
 ..S FDA(4.014,IENS,.01)="PARENT FACILITY"
"RTN","XUMF4A",130,0)
 ..S FDA(4.014,IENS,1)=PARENT
"RTN","XUMF4A",131,0)
 ..D
"RTN","XUMF4A",132,0)
 ...N IEN,STA
"RTN","XUMF4A",133,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",134,0)
 ...S CNT=CNT+1 I '(CNT#10) W "."
"RTN","XUMF4A",135,0)
 ;
"RTN","XUMF4A",136,0)
 Q
"RTN","XUMF4A",137,0)
 ;
"RTN","XUMF4A",138,0)
HIST ; -- history
"RTN","XUMF4A",139,0)
 ;
"RTN","XUMF4A",140,0)
 N IEN,STA,EFFDT,FDA,XUMF,CNT
"RTN","XUMF4A",141,0)
 ;
"RTN","XUMF4A",142,0)
 S XUMF=1
"RTN","XUMF4A",143,0)
 ;
"RTN","XUMF4A",144,0)
 S STA="",CNT=0
"RTN","XUMF4A",145,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",146,0)
 .S IEN=$O(^DIC(4,"D",STA,0)) Q:'IEN
"RTN","XUMF4A",147,0)
 .S EFFDT=$P(^TMP("XUMF ARRAY",$J,STA),U,11)
"RTN","XUMF4A",148,0)
 .S EFFDT=$$FMDATE^HLFNC(+EFFDT)
"RTN","XUMF4A",149,0)
 .I EFFDT D
"RTN","XUMF4A",150,0)
 ..S IENS="?+"_EFFDT_","_IEN_","
"RTN","XUMF4A",151,0)
 ..K FDA
"RTN","XUMF4A",152,0)
 ..S FDA(4.999,IENS,.01)=EFFDT
"RTN","XUMF4A",153,0)
 ..S FDA(4.999,IENS,.06)=$P(^TMP("XUMF ARRAY",$J,STA),U,12)
"RTN","XUMF4A",154,0)
 ..D
"RTN","XUMF4A",155,0)
 ...N IEN,STA
"RTN","XUMF4A",156,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",157,0)
 .S EFFDT=$P(^TMP("XUMF ARRAY",$J,STA),U,13)
"RTN","XUMF4A",158,0)
 .S EFFDT=$$FMDATE^HLFNC(+EFFDT)
"RTN","XUMF4A",159,0)
 .I EFFDT D
"RTN","XUMF4A",160,0)
 ..S IENS="?+"_EFFDT_","_IEN_","
"RTN","XUMF4A",161,0)
 ..K FDA
"RTN","XUMF4A",162,0)
 ..S FDA(4.999,IENS,.01)=EFFDT
"RTN","XUMF4A",163,0)
 ..S FDA(4.999,IENS,.05)=$P(^TMP("XUMF ARRAY",$J,STA),U,14)
"RTN","XUMF4A",164,0)
 ..D
"RTN","XUMF4A",165,0)
 ...N IEN,STA
"RTN","XUMF4A",166,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",167,0)
 ...S CNT=CNT+1 I '(CNT#10) W "."
"RTN","XUMF4A",168,0)
 ;
"RTN","XUMF4A",169,0)
 Q
"RTN","XUMF4A",170,0)
 ;
"RTN","XUMF4A",171,0)
CDSN() ; -- check for duplicate sta # (true=duplicates, false=none)
"RTN","XUMF4A",172,0)
 ;
"RTN","XUMF4A",173,0)
 K ^TMP("XUMF TMP",$J)
"RTN","XUMF4A",174,0)
 ;
"RTN","XUMF4A",175,0)
 N IEN,STA,CNT
"RTN","XUMF4A",176,0)
 ;
"RTN","XUMF4A",177,0)
 S STA="",IEN=0
"RTN","XUMF4A",178,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4A",179,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4A",180,0)
 ..S ^TMP("XUMF TMP",$J,STA,IEN)=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4A",181,0)
 ;
"RTN","XUMF4A",182,0)
 S STA="",(CNT,IEN)=0
"RTN","XUMF4A",183,0)
 F  S STA=$O(^TMP("XUMF TMP",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",184,0)
 .Q:'$O(^TMP("XUMF TMP",$J,STA,+$O(^TMP("XUMF TMP",$J,STA,0))))
"RTN","XUMF4A",185,0)
 .F  S IEN=$O(^TMP("XUMF TMP",$J,STA,IEN)) Q:'IEN  D
"RTN","XUMF4A",186,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",187,0)
 ;
"RTN","XUMF4A",188,0)
 K ^TMP("XUMF TMP",$J)
"RTN","XUMF4A",189,0)
 ;
"RTN","XUMF4A",190,0)
 Q CNT
"RTN","XUMF4A",191,0)
 ;
"RTN","XUMF4A",192,0)
 N IEN,STA,CNT
"RTN","XUMF4A",193,0)
 ;
"RTN","XUMF4A",194,0)
 K ^TMP("XUMF STA",$J)
"RTN","XUMF4A",195,0)
 ;
"RTN","XUMF4A",196,0)
 S CNT=0
"RTN","XUMF4A",197,0)
 ;
"RTN","XUMF4A",198,0)
 ; check for duplicate sta #
"RTN","XUMF4A",199,0)
 S STA="",IEN=0
"RTN","XUMF4A",200,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4A",201,0)
 .Q:STA["ZZ"
"RTN","XUMF4A",202,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4A",203,0)
 ..S ^TMP("XUMF STA",$J,STA,IEN)=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4A",204,0)
 ;
"RTN","XUMF4A",205,0)
 S STA="",IEN=0
"RTN","XUMF4A",206,0)
 F  S STA=$O(^TMP("XUMF STA",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",207,0)
 .Q:'$O(^TMP("XUMF STA",$J,+$O(^TMP("XUMF STA",$J,STA,0))))
"RTN","XUMF4A",208,0)
 .F  S IEN=$O(^TMP("XUMF STA",$J,STA,IEN)) Q:'IEN  D
"RTN","XUMF4A",209,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",210,0)
 ;
"RTN","XUMF4A",211,0)
 K ^TMP("XUMF STA",$J)
"RTN","XUMF4A",212,0)
 ;
"RTN","XUMF4A",213,0)
 Q CNT
"RTN","XUMF4A",214,0)
 ;
"RTN","XUMF4A",215,0)
CMVD() ; -- check for missing national data
"RTN","XUMF4A",216,0)
 ;
"RTN","XUMF4A",217,0)
 N STA,CNT
"RTN","XUMF4A",218,0)
 ;
"RTN","XUMF4A",219,0)
 S CNT=0
"RTN","XUMF4A",220,0)
 ;
"RTN","XUMF4A",221,0)
 S STA=""
"RTN","XUMF4A",222,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",223,0)
 .Q:$D(^DIC(4,"D",STA))
"RTN","XUMF4A",224,0)
 .S CNT=CNT+1
"RTN","XUMF4A",225,0)
 ;
"RTN","XUMF4A",226,0)
 Q CNT
"RTN","XUMF4A",227,0)
 ;
"RTN","XUMF4A",228,0)
CHCK ; -- check if clean up is complete
"RTN","XUMF4A",229,0)
 ;
"RTN","XUMF4A",230,0)
 N VAR,FLD
"RTN","XUMF4A",231,0)
 ;
"RTN","XUMF4A",232,0)
 K ^TMP("XUMF CHCK",$J)
"RTN","XUMF4A",233,0)
 ;
"RTN","XUMF4A",234,0)
 S VALMCNT=0
"RTN","XUMF4A",235,0)
 ;
"RTN","XUMF4A",236,0)
 I $$CDSN D
"RTN","XUMF4A",237,0)
 .S VALMCNT=VALMCNT+1,VAR=""
"RTN","XUMF4A",238,0)
 .S FLD="Local/Duplicate station #s exist -- use DSTA"
"RTN","XUMF4A",239,0)
 .S VAR=$$SETFLD^VALM1(FLD,VAR,"MSG")
"RTN","XUMF4A",240,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4A",241,0)
 ;
"RTN","XUMF4A",242,0)
 I $$CMVD D
"RTN","XUMF4A",243,0)
 .S VALMCNT=VALMCNT+1,VAR=""
"RTN","XUMF4A",244,0)
 .S FLD="INSTITUTION file not updated with NATIONAL data -- use AUTO"
"RTN","XUMF4A",245,0)
 .S VAR=$$SETFLD^VALM1(FLD,VAR,"MSG")
"RTN","XUMF4A",246,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4A",247,0)
 ;
"RTN","XUMF4A",248,0)
 D:'VALMCNT
"RTN","XUMF4A",249,0)
 .S VAR="",FLD="CONGRATULATIONS!!!  Update complete!"
"RTN","XUMF4A",250,0)
 .S VAR=$$SETFLD^VALM1(FLD,VAR,"MSG")
"RTN","XUMF4A",251,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4A",252,0)
 ;
"RTN","XUMF4A",253,0)
 Q
"RTN","XUMF4A",254,0)
 ;
"RTN","XUMF4A",255,0)
FACTYP ;resolve duplicate facility types
"RTN","XUMF4A",256,0)
 ;
"RTN","XUMF4A",257,0)
 N FT,CNT,IEN,DA,DIE,DR
"RTN","XUMF4A",258,0)
 ;
"RTN","XUMF4A",259,0)
 S FT="",(CNT,IEN)=0
"RTN","XUMF4A",260,0)
 F  S FT=$O(^DIC(4.1,"B",FT)) Q:FT=""  D
"RTN","XUMF4A",261,0)
 .F  S IEN=$O(^DIC(4.1,"B",FT,IEN)) Q:'IEN  D
"RTN","XUMF4A",262,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",263,0)
 ..Q:CNT<2
"RTN","XUMF4A",264,0)
 ..S DA=IEN,DIE=4.1
"RTN","XUMF4A",265,0)
 ..S DR=".01///ZZ"_$P($G(^DIC(4.1,+IEN,0)),U)
"RTN","XUMF4A",266,0)
 ..D ^DIE
"RTN","XUMF4A",267,0)
 .S CNT=0
"RTN","XUMF4A",268,0)
 ;
"RTN","XUMF4A",269,0)
 Q
"RTN","XUMF4A",270,0)
 ;
"RTN","XUMF4A",271,0)
STATE ;resolve duplicate states
"RTN","XUMF4A",272,0)
 ;
"RTN","XUMF4A",273,0)
 N STATE,CNT,IEN,DA,DIE,DR
"RTN","XUMF4A",274,0)
 ;
"RTN","XUMF4A",275,0)
 ;name
"RTN","XUMF4A",276,0)
 S STATE="",(CNT,IEN)=0
"RTN","XUMF4A",277,0)
 F  S STATE=$O(^DIC(5,"B",STATE)) Q:STATE=""  D
"RTN","XUMF4A",278,0)
 .F  S IEN=$O(^DIC(5,"B",STATE,IEN)) Q:'IEN  D
"RTN","XUMF4A",279,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",280,0)
 ..Q:CNT<2
"RTN","XUMF4A",281,0)
 ..S DA=IEN,DIE=5
"RTN","XUMF4A",282,0)
 ..S DR=".01///ZZ"_$P($G(^DIC(5,+IEN,0)),U)
"RTN","XUMF4A",283,0)
 ..D ^DIE
"RTN","XUMF4A",284,0)
 .S CNT=0
"RTN","XUMF4A",285,0)
 ;
"RTN","XUMF4A",286,0)
 ;abbreviation
"RTN","XUMF4A",287,0)
 S STATE="",(CNT,IEN)=0
"RTN","XUMF4A",288,0)
 F  S STATE=$O(^DIC(5,"C",STATE)) Q:STATE=""  Q:STATE  D
"RTN","XUMF4A",289,0)
 .F  S IEN=$O(^DIC(5,"C",STATE,IEN)) Q:'IEN  D
"RTN","XUMF4A",290,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",291,0)
 ..Q:CNT<2
"RTN","XUMF4A",292,0)
 ..S DA=IEN,DIE=5
"RTN","XUMF4A",293,0)
 ..S DR="1///ZZ"_$P($G(^DIC(5,+IEN,0)),U,2)
"RTN","XUMF4A",294,0)
 ..D ^DIE
"RTN","XUMF4A",295,0)
 .S CNT=0
"RTN","XUMF4A",296,0)
 ;
"RTN","XUMF4A",297,0)
 Q
"RTN","XUMF4A",298,0)
 ;
"RTN","XUMF4H")
0^29^B9186915
"RTN","XUMF4H",1,0)
XUMF4H ;CIOFO-SF/RAM - Institution File Clean Up; 06/28/99
"RTN","XUMF4H",2,0)
 ;;8.0;KERNEL;**206**;Jul 10, 1995
"RTN","XUMF4H",3,0)
 ;
"RTN","XUMF4H",4,0)
 ;
"RTN","XUMF4H",5,0)
 ;
"RTN","XUMF4H",6,0)
DSTA ; -- duplicate station #s
"RTN","XUMF4H",7,0)
RDSN ; -- deleted duplicate station number
"RTN","XUMF4H",8,0)
 ;
"RTN","XUMF4H",9,0)
 W !!,"This list displays duplicate STATION NUMBER (#99)."
"RTN","XUMF4H",10,0)
 W !,"The action associated with this list will automatically"
"RTN","XUMF4H",11,0)
 W !,"remove the value from field #99 for local and duplicate"
"RTN","XUMF4H",12,0)
 W !,"entries.",!!
"RTN","XUMF4H",13,0)
 D EOP
"RTN","XUMF4H",14,0)
 ;
"RTN","XUMF4H",15,0)
 Q
"RTN","XUMF4H",16,0)
 ;
"RTN","XUMF4H",17,0)
 ;
"RTN","XUMF4H",18,0)
LLCL ; -- local data
"RTN","XUMF4H",19,0)
 ;
"RTN","XUMF4H",20,0)
 W !!,"This list displays entries that are in the INSTITUTION (#4)"
"RTN","XUMF4H",21,0)
 W !,"file but not in the national file."
"RTN","XUMF4H",22,0)
 W !!,"This list is informational only and has no actions associated"
"RTN","XUMF4H",23,0)
 W !,"with it.",!!
"RTN","XUMF4H",24,0)
 D EOP
"RTN","XUMF4H",25,0)
 ;
"RTN","XUMF4H",26,0)
 Q
"RTN","XUMF4H",27,0)
 ;
"RTN","XUMF4H",28,0)
NATL ; -- national
"RTN","XUMF4H",29,0)
 ;
"RTN","XUMF4H",30,0)
 W !!,"This list displays the Master Institutution File data.",!!
"RTN","XUMF4H",31,0)
 D EOP
"RTN","XUMF4H",32,0)
 ;
"RTN","XUMF4H",33,0)
 Q
"RTN","XUMF4H",34,0)
 ;
"RTN","XUMF4H",35,0)
MSTA ; -- missing station numbers
"RTN","XUMF4H",36,0)
 ;
"RTN","XUMF4H",37,0)
 W !!,"This list displays station numbers that are in the national"
"RTN","XUMF4H",38,0)
 W !,"file but not in the INSTITUTION (#4) file."
"RTN","XUMF4H",39,0)
 W !!,"This list is informational only and has no actions associated"
"RTN","XUMF4H",40,0)
 W !,"with it.",!!
"RTN","XUMF4H",41,0)
 D EOP
"RTN","XUMF4H",42,0)
 ;
"RTN","XUMF4H",43,0)
 Q
"RTN","XUMF4H",44,0)
 ;
"RTN","XUMF4H",45,0)
AUTO ; -- auto update with national data
"RTN","XUMF4H",46,0)
 ;
"RTN","XUMF4H",47,0)
 W !!,"This action will automatically update the INSTITUTION (#4) file"
"RTN","XUMF4H",48,0)
 W !,"with national data.",!!
"RTN","XUMF4H",49,0)
 D EOP
"RTN","XUMF4H",50,0)
 ;
"RTN","XUMF4H",51,0)
 Q
"RTN","XUMF4H",52,0)
 ;
"RTN","XUMF4H",53,0)
CHCK ; -- check if update is complete
"RTN","XUMF4H",54,0)
 ;
"RTN","XUMF4H",55,0)
 W !!,"Use this action to check if the all the required steps have"
"RTN","XUMF4H",56,0)
 W !,"been performed and the clean up has completed.",!!
"RTN","XUMF4H",57,0)
 D EOP
"RTN","XUMF4H",58,0)
 ;
"RTN","XUMF4H",59,0)
 Q
"RTN","XUMF4H",60,0)
 ;
"RTN","XUMF4H",61,0)
 ;
"RTN","XUMF4H",62,0)
NAME ; -- institution vs. national names
"RTN","XUMF4H",63,0)
 ;
"RTN","XUMF4H",64,0)
 W !!,"This main screen displays a side-by-side view of the INSTITUTION"
"RTN","XUMF4H",65,0)
 W !,"(#4) file and the national file names by station number.",!
"RTN","XUMF4H",66,0)
 W !,"LLCL - lists local station numbers to be deleted.",!
"RTN","XUMF4H",67,0)
 W !,"DSTA - automatically deletes local/duplicate station numbers.",!
"RTN","XUMF4H",68,0)
 W !,"NATL - lists Institution Master File entries to merge.",!
"RTN","XUMF4H",69,0)
 W !,"AUTO - merges national data with local INSTITUTION (#4) file.",!
"RTN","XUMF4H",70,0)
 W !,"CHCK - run this action to see pending clean up actions to perform.",!!
"RTN","XUMF4H",71,0)
 D EOP
"RTN","XUMF4H",72,0)
 ;
"RTN","XUMF4H",73,0)
 Q
"RTN","XUMF4H",74,0)
 ;
"RTN","XUMF4H",75,0)
EOP ; -- End-of-Page
"RTN","XUMF4H",76,0)
 ;
"RTN","XUMF4H",77,0)
 N DIR
"RTN","XUMF4H",78,0)
 S DIR(0)="E"
"RTN","XUMF4H",79,0)
 D ^DIR,CLEAR^VALM1
"RTN","XUMF4H",80,0)
 S VALMBCK="R"
"RTN","XUMF4H",81,0)
 Q
"RTN","XUMFENV")
0^36^B956493
"RTN","XUMFENV",1,0)
XUMFENV ;CIOFO-SF/RAM - ENVIRONMENT INIT ROUTINE ;06/28/00
"RTN","XUMFENV",2,0)
 ;;8.0;KERNEL;**206**;Jul 10, 1995
"RTN","XUMFENV",3,0)
 ;
"RTN","XUMFENV",4,0)
 ;
"RTN","XUMFENV",5,0)
EN ; -- enivornment check
"RTN","XUMFENV",6,0)
 ;
"RTN","XUMFENV",7,0)
 N I
"RTN","XUMFENV",8,0)
 ;
"RTN","XUMFENV",9,0)
 ;check STATE (#5) file
"RTN","XUMFENV",10,0)
 F I=1,2,4,5,6 S:'$D(^DIC(5,+I)) XPDQUIT=2
"RTN","XUMFENV",11,0)
 F I=8:1:13 S:'$D(^DIC(5,+I)) XPDQUIT=2
"RTN","XUMFENV",12,0)
 F I=15:1:42 S:'$D(^DIC(5,+I)) XPDQUIT=2
"RTN","XUMFENV",13,0)
 F I=44:1:51 S:'$D(^DIC(5,+I)) XPDQUIT=2
"RTN","XUMFENV",14,0)
 F I=53:1:56 S:'$D(^DIC(5,+I)) XPDQUIT=2
"RTN","XUMFENV",15,0)
 ;
"RTN","XUMFENV",16,0)
 Q:'$G(XPDQUIT)
"RTN","XUMFENV",17,0)
 ;
"RTN","XUMFENV",18,0)
 W !,"Your STATE (#5) file is missing required entries!"
"RTN","XUMFENV",19,0)
 W !,"You must fix the STATE (#5) file BEFORE installing this patch."
"RTN","XUMFENV",20,0)
 ;
"RTN","XUMFENV",21,0)
 Q
"RTN","XUMFENV",22,0)
 ;
"RTN","XUMFH")
0^24^B33250853
"RTN","XUMFH",1,0)
XUMFH ;CIOFO-SF/RAM - Master File HL7 Msg Handler; 06/28/00
"RTN","XUMFH",2,0)
 ;;8.0;KERNEL;**206**;Jul 10, 1995
"RTN","XUMFH",3,0)
 ;
"RTN","XUMFH",4,0)
 ; This routine handles Master File HL7 messages.
"RTN","XUMFH",5,0)
 ;
"RTN","XUMFH",6,0)
MAIN ; -- entry point
"RTN","XUMFH",7,0)
 ;
"RTN","XUMFH",8,0)
 N CNT,ERR,I,X,HLFS,HLCS,ERROR,HLRESLTA,IFN,IEN,MTPE,TYPE,ARRAY
"RTN","XUMFH",9,0)
 N CNODE,HDT,KEY,MID,REASON,VALUE,XREF,ALL,GROUP,PARAM,ROOT,SEG,QRD
"RTN","XUMFH",10,0)
 N QID,WHAT,WHO
"RTN","XUMFH",11,0)
 ;
"RTN","XUMFH",12,0)
 D INIT,PROCESS,REPLY,EXIT
"RTN","XUMFH",13,0)
 ;
"RTN","XUMFH",14,0)
 Q
"RTN","XUMFH",15,0)
 ;
"RTN","XUMFH",16,0)
INIT ; -- initialize
"RTN","XUMFH",17,0)
 ;
"RTN","XUMFH",18,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J)
"RTN","XUMFH",19,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH",20,0)
 ;
"RTN","XUMFH",21,0)
 S ERROR=0,CNT=0,TYPE=0
"RTN","XUMFH",22,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH"))
"RTN","XUMFH",23,0)
 ;
"RTN","XUMFH",24,0)
 Q
"RTN","XUMFH",25,0)
 ;
"RTN","XUMFH",26,0)
PROCESS ; -- pull message text
"RTN","XUMFH",27,0)
 ;
"RTN","XUMFH",28,0)
 F  X HLNEXT Q:HLQUIT'>0  D
"RTN","XUMFH",29,0)
 .Q:$P(HLNODE,HLFS)=""
"RTN","XUMFH",30,0)
 .D @($P(HLNODE,HLFS))
"RTN","XUMFH",31,0)
 ;
"RTN","XUMFH",32,0)
 Q
"RTN","XUMFH",33,0)
 ;
"RTN","XUMFH",34,0)
MSH ; -- MSH segment
"RTN","XUMFH",35,0)
 ;
"RTN","XUMFH",36,0)
 Q
"RTN","XUMFH",37,0)
 ;
"RTN","XUMFH",38,0)
MSA ; -- MSA segment
"RTN","XUMFH",39,0)
 ;
"RTN","XUMFH",40,0)
 N CODE
"RTN","XUMFH",41,0)
 ;
"RTN","XUMFH",42,0)
 S CODE=$P(HLNODE,HLFS,2)
"RTN","XUMFH",43,0)
 ;
"RTN","XUMFH",44,0)
 I CODE="AE"!(CODE="AR") D
"RTN","XUMFH",45,0)
 .D ERRB
"RTN","XUMFH",46,0)
 .S ERROR="1^"_$P(HLNODE,HLFS,4)
"RTN","XUMFH",47,0)
 ;
"RTN","XUMFH",48,0)
 Q
"RTN","XUMFH",49,0)
 ;
"RTN","XUMFH",50,0)
QRD ; -- QRD segment
"RTN","XUMFH",51,0)
 ;
"RTN","XUMFH",52,0)
 S QRD="QRD,QDT,QFC,QP,QID,DRT,DRDT,QLR,WHO,WHAT,WDDC,WDCVQ,QRL"
"RTN","XUMFH",53,0)
 ;
"RTN","XUMFH",54,0)
 F I=2:1:13 S PARAM($P(QRD,",",I))=$P(HLNODE,HLFS,I)
"RTN","XUMFH",55,0)
 S QID=$P(HLNODE,HLFS,5)
"RTN","XUMFH",56,0)
 S WHO=$P(HLNODE,HLFS,9)
"RTN","XUMFH",57,0)
 S WHAT=$P(HLNODE,HLFS,10)
"RTN","XUMFH",58,0)
 ;
"RTN","XUMFH",59,0)
 S ARRAY=$S(QID["ARRAY":1,1:0)
"RTN","XUMFH",60,0)
 S ALL=$S(WHO["ALL":1,1:0)
"RTN","XUMFH",61,0)
 S GROUP=$S(ALL:1,(WHO["IEN"):1,1:0)
"RTN","XUMFH",62,0)
 ;
"RTN","XUMFH",63,0)
 S:ARRAY TYPE=$S(GROUP:7,1:3)
"RTN","XUMFH",64,0)
 S:'ARRAY TYPE=$S(GROUP:5,1:1)
"RTN","XUMFH",65,0)
 S:HL("MTN")="MFR" TYPE=TYPE+10
"RTN","XUMFH",66,0)
 ;
"RTN","XUMFH",67,0)
 S IFN=+WHAT
"RTN","XUMFH",68,0)
 S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",69,0)
 S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",70,0)
 S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",71,0)
 ;
"RTN","XUMFH",72,0)
 K:ARRAY ^TMP("XUMF ARRAY",$J)
"RTN","XUMFH",73,0)
 ;
"RTN","XUMFH",74,0)
 Q
"RTN","XUMFH",75,0)
 ;
"RTN","XUMFH",76,0)
MFI ; -- MFI segment
"RTN","XUMFH",77,0)
 ;
"RTN","XUMFH",78,0)
 Q:$G(IFN)
"RTN","XUMFH",79,0)
 I $P(HLNODE,HLFS,2)="" S ERROR="1^no Master File Identifier" Q
"RTN","XUMFH",80,0)
 S IFN=$$MFI^XUMFP($P(HLNODE,HLFS,2))
"RTN","XUMFH",81,0)
 I 'IFN S ERROR="1^File not found" Q
"RTN","XUMFH",82,0)
 ;
"RTN","XUMFH",83,0)
 Q
"RTN","XUMFH",84,0)
 ;
"RTN","XUMFH",85,0)
MFE ; -- MFE segment
"RTN","XUMFH",86,0)
 ;
"RTN","XUMFH",87,0)
 S KEY=$P(HLNODE,HLFS,5) Q:ARRAY
"RTN","XUMFH",88,0)
 S XREF=$P(KEY,HLCS,3)
"RTN","XUMFH",89,0)
 S IEN=$$FIND1^DIC(IFN,,"BX",$P(KEY,HLCS),XREF,,"ERR")
"RTN","XUMFH",90,0)
 I 'IEN S IEN="NEW"
"RTN","XUMFH",91,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",92,0)
 ;
"RTN","XUMFH",93,0)
 Q
"RTN","XUMFH",94,0)
 ;
"RTN","XUMFH",95,0)
ZIN ; -- VHA Institution segment
"RTN","XUMFH",96,0)
ZFT ; -- VHA Facility Type
"RTN","XUMFH",97,0)
ZZZ ; -- get [Z...] segment(s)
"RTN","XUMFH",98,0)
 ;
"RTN","XUMFH",99,0)
 I $G(ARRAY) D ARRAY Q
"RTN","XUMFH",100,0)
 ;
"RTN","XUMFH",101,0)
 N FDA,IENS,FIELD,ERR,PRE,POST,XUMF,MULT,FDA1
"RTN","XUMFH",102,0)
 ;
"RTN","XUMFH",103,0)
 S PRE=$G(^TMP("XUMF MFS",$J,"PARAM","PRE"))
"RTN","XUMFH",104,0)
 D:PRE'="" @(PRE)
"RTN","XUMFH",105,0)
 ;
"RTN","XUMFH",106,0)
 S XUMF=1
"RTN","XUMFH",107,0)
 ;
"RTN","XUMFH",108,0)
 S SEG=$P(HLNODE,HLFS),CNODE=$O(HLNODE(""),-1),CN=0
"RTN","XUMFH",109,0)
 S IENS=$S(IEN:IEN,1:"+1")_","
"RTN","XUMFH",110,0)
 S SEQ=0
"RTN","XUMFH",111,0)
 F  S SEQ=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFH",112,0)
 .S FIELD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,0))
"RTN","XUMFH",113,0)
 .I FIELD=".01" D
"RTN","XUMFH",114,0)
 ..N FDA,IEN1
"RTN","XUMFH",115,0)
 ..S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",116,0)
 ..S VALUE=$S('CNODE:$P(HLNODE,HLFS,SEQ+1),1:$$VALUE(.HLNODE,.CN,SEQ))
"RTN","XUMFH",117,0)
 ..S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",118,0)
 ..S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",119,0)
 ..D UPDATE^DIE("E","FDA","IEN1","ERR")
"RTN","XUMFH",120,0)
 ..I $D(IEN1) S IENS=IEN1(1)_","
"RTN","XUMFH",121,0)
 .I 'FIELD D SUBFILE Q
"RTN","XUMFH",122,0)
 .S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",123,0)
 .S VALUE=$S('CNODE:$P(HLNODE,HLFS,SEQ+1),1:$$VALUE(.HLNODE,.CN,SEQ))
"RTN","XUMFH",124,0)
 .S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",125,0)
 .S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",126,0)
 ;
"RTN","XUMFH",127,0)
 M FDA=FDA1
"RTN","XUMFH",128,0)
 ;
"RTN","XUMFH",129,0)
 D FILE^DIE("E","FDA","ERR")
"RTN","XUMFH",130,0)
 ;
"RTN","XUMFH",131,0)
 S POST=$G(^TMP("XUMF MFS",$J,"PARAM","POST"))
"RTN","XUMFH",132,0)
 D:POST'="" @(POST)
"RTN","XUMFH",133,0)
 ;
"RTN","XUMFH",134,0)
 Q
"RTN","XUMFH",135,0)
 ;
"RTN","XUMFH",136,0)
SUBFILE ; -- process subfile record
"RTN","XUMFH",137,0)
 ;
"RTN","XUMFH",138,0)
 N IFN,IENS1,KEY1,FIELD,TYP,MKEY,ERR
"RTN","XUMFH",139,0)
 ;
"RTN","XUMFH",140,0)
 S IFN=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FILE")
"RTN","XUMFH",141,0)
 S FIELD=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FIELD")
"RTN","XUMFH",142,0)
 S TYP=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"DTYP")
"RTN","XUMFH",143,0)
 S VALUE=$S('CNODE:$P(HLNODE,HLFS,SEQ+1),1:$$VALUE(.HLNODE,.CN,SEQ))
"RTN","XUMFH",144,0)
 S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",145,0)
 ;
"RTN","XUMFH",146,0)
 S MULT=$G(^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",SEQ))
"RTN","XUMFH",147,0)
 S MKEY=$G(^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",SEQ))
"RTN","XUMFH",148,0)
 I MULT=SEQ Q:VALUE=""  D
"RTN","XUMFH",149,0)
 .N FDA,IEN
"RTN","XUMFH",150,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=VALUE
"RTN","XUMFH",151,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",152,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",153,0)
 I 'MULT D
"RTN","XUMFH",154,0)
 .N FDA,IEN
"RTN","XUMFH",155,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=MKEY
"RTN","XUMFH",156,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",157,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",158,0)
 .S FDA1(IFN,IENS1,.01)=MKEY
"RTN","XUMFH",159,0)
 I MULT,MULT'=SEQ S IENS1=$G(MULT(+MULT)) Q:IENS1=""
"RTN","XUMFH",160,0)
 S FDA1(IFN,IENS1,FIELD)=VALUE
"RTN","XUMFH",161,0)
 ;
"RTN","XUMFH",162,0)
 Q
"RTN","XUMFH",163,0)
 ;
"RTN","XUMFH",164,0)
VALUE(HLNODE,CN,SEQ) ; -- handle HL7 continuation nodes
"RTN","XUMFH",165,0)
 ;
"RTN","XUMFH",166,0)
 N X,NODE,NODE1
"RTN","XUMFH",167,0)
 ;
"RTN","XUMFH",168,0)
 S NODE=$S('CN:HLNODE,1:HLNODE(CN))
"RTN","XUMFH",169,0)
 S X=$P(NODE,HLFS,SEQ+1,999)
"RTN","XUMFH",170,0)
 I X["HLFS" Q $P(NODE,HLFS,SEQ+1)
"RTN","XUMFH",171,0)
 S CN=$O(HLNODE(CN)),NODE1=$P(HLNODE,HLFS)
"RTN","XUMFH",172,0)
 Q NODE_NODE1
"RTN","XUMFH",173,0)
 ;
"RTN","XUMFH",174,0)
ARRAY ; -- query data stored in array (not filed)
"RTN","XUMFH",175,0)
 ;
"RTN","XUMFH",176,0)
 M ^TMP("XUMF ARRAY",$J,$P(KEY,HLCS))=HLNODE
"RTN","XUMFH",177,0)
 ;
"RTN","XUMFH",178,0)
 Q
"RTN","XUMFH",179,0)
 ;
"RTN","XUMFH",180,0)
REPLY ; -- master file response
"RTN","XUMFH",181,0)
 ;
"RTN","XUMFH",182,0)
 Q:HL("MTN")="MFR"
"RTN","XUMFH",183,0)
 Q:HL("MTN")="MFK"
"RTN","XUMFH",184,0)
 ;
"RTN","XUMFH",185,0)
 S:(TYPE<10) TYPE=(TYPE+10)
"RTN","XUMFH",186,0)
 ;
"RTN","XUMFH",187,0)
 I HL("MTN")="MFQ" D
"RTN","XUMFH",188,0)
 .S IFN=+WHAT
"RTN","XUMFH",189,0)
 .S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",190,0)
 .S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",191,0)
 .S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",192,0)
 ;
"RTN","XUMFH",193,0)
 S IFN=$G(IFN),IEN=$G(IEN)
"RTN","XUMFH",194,0)
 ;
"RTN","XUMFH",195,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR) Q:ERROR
"RTN","XUMFH",196,0)
 D MAIN^XUMFI(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",197,0)
 ;
"RTN","XUMFH",198,0)
 Q
"RTN","XUMFH",199,0)
 ;
"RTN","XUMFH",200,0)
EXIT ; -- cleanup, and quit
"RTN","XUMFH",201,0)
 ;
"RTN","XUMFH",202,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J),^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH",203,0)
 ;
"RTN","XUMFH",204,0)
 Q
"RTN","XUMFH",205,0)
 ;
"RTN","XUMFH",206,0)
ERRB ; -- error bulletin
"RTN","XUMFH",207,0)
 ;
"RTN","XUMFH",208,0)
 N XMB
"RTN","XUMFH",209,0)
 S XMB="XUMF ERROR"
"RTN","XUMFH",210,0)
 S XMB(1)=HL("MID")
"RTN","XUMFH",211,0)
 D ^XMB
"RTN","XUMFH",212,0)
 Q
"RTN","XUMFH",213,0)
 ;
"RTN","XUMFI")
0^1^B62426615
"RTN","XUMFI",1,0)
XUMFI ;CIOFO-SF/RAM - Master File Interface ;06/28/00
"RTN","XUMFI",2,0)
 ;;8.0;KERNEL;**206**;Jul 10, 1995
"RTN","XUMFI",3,0)
 ;
"RTN","XUMFI",4,0)
 ; This routine is the Master File Server HL7 message builder API.
"RTN","XUMFI",5,0)
 ; The routine will generate messages for both trigger events and
"RTN","XUMFI",6,0)
 ; queries.
"RTN","XUMFI",7,0)
 ;
"RTN","XUMFI",8,0)
 ; Use the routine XUMFP to initialize the PARAM array.
"RTN","XUMFI",9,0)
 ; See XUMFP for a full description of the parameter.
"RTN","XUMFI",10,0)
 ;
"RTN","XUMFI",11,0)
MAIN(IFN,IEN,TYPE,PARAM,ERROR) ;  -- entry point
"RTN","XUMFI",12,0)
 ;
"RTN","XUMFI",13,0)
 ;Input  IFN             A file number (required)
"RTN","XUMFI",14,0)
 ;
"RTN","XUMFI",15,0)
 ;       IEN             Internal Entry Number (required)      Example
"RTN","XUMFI",16,0)
 ;                                                             -------
"RTN","XUMFI",17,0)
 ;
"RTN","XUMFI",18,0)
 ;                       particular record (pass by value)     IEN=1
"RTN","XUMFI",19,0)
 ;
"RTN","XUMFI",20,0)
 ;                       group records array (by reference)    IEN(1)=""
"RTN","XUMFI",21,0)
 ;                       IEN(IEN)=""                           IEN(2)=""
"RTN","XUMFI",22,0)
 ;
"RTN","XUMFI",23,0)
 ;                       ALL 'gold' records (by value)         IEN="ALL"
"RTN","XUMFI",24,0)
 ;
"RTN","XUMFI",25,0)
 ;       TYPE            Message TYPE (required)
"RTN","XUMFI",26,0)
 ;
"RTN","XUMFI",27,0)
 ;                       0  = MFN - unsolicited update
"RTN","XUMFI",28,0)
 ;                       1  = MFQ - query particular record and file
"RTN","XUMFI",29,0)
 ;                       3  = MFQ - query particular record in array
"RTN","XUMFI",30,0)
 ;                       5  = MFQ - query group records file
"RTN","XUMFI",31,0)
 ;                       7  = MFQ - query group records array
"RTN","XUMFI",32,0)
 ;                       10 = MFK - application acknowledgement
"RTN","XUMFI",33,0)
 ;                       11 = MFR - query response particular rec file
"RTN","XUMFI",34,0)
 ;                       13 = MFR - query response particular rec array
"RTN","XUMFI",35,0)
 ;                       15 = MFR - query response group records file
"RTN","XUMFI",36,0)
 ;                       17 = MFR - query response group records array
"RTN","XUMFI",37,0)
 ;
"RTN","XUMFI",38,0)
 ;       PARAM           parameters array (required) (by reference)
"RTN","XUMFI",39,0)
 ;
"RTN","XUMFI",40,0)
 ;OUTPUT
"RTN","XUMFI",41,0)
 ;       ERROR          Error flag '0^HL7 message ID' '1^error text'  
"RTN","XUMFI",42,0)
 ;
"RTN","XUMFI",43,0)
 ;
"RTN","XUMFI",44,0)
 ;
"RTN","XUMFI",45,0)
 N HLFS,HLCS,HLRESLT,QUERY,UPDATE,ALL,CNT,ROOT,PROTOCOL,MFR,MFQ,MTYP,I
"RTN","XUMFI",46,0)
 N ARRAY,GROUP,MFK
"RTN","XUMFI",47,0)
 ;
"RTN","XUMFI",48,0)
 M ^TMP("XUMF MFS",$J,"PARAM")=PARAM K PARAM
"RTN","XUMFI",49,0)
 ;
"RTN","XUMFI",50,0)
 D INIT,BUILD,LLNK,SEND,EXIT
"RTN","XUMFI",51,0)
 ;
"RTN","XUMFI",52,0)
 Q
"RTN","XUMFI",53,0)
 ;
"RTN","XUMFI",54,0)
INIT ; -- initialize
"RTN","XUMFI",55,0)
 ;
"RTN","XUMFI",56,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J)
"RTN","XUMFI",57,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFI",58,0)
 ;
"RTN","XUMFI",59,0)
 S IEN=$G(IEN),IFN=$G(IFN)
"RTN","XUMFI",60,0)
 S TYPE=$G(TYPE),ERROR=0,CNT=1
"RTN","XUMFI",61,0)
 S UPDATE=$S(TYPE#2:0,1:1)
"RTN","XUMFI",62,0)
 S QUERY='UPDATE
"RTN","XUMFI",63,0)
 S GROUP=$S(UPDATE:0,TYPE[5:1,TYPE[7:1,1:0)
"RTN","XUMFI",64,0)
 S ARRAY=$S(UPDATE:0,TYPE[3:1,TYPE[7:1,1:0)
"RTN","XUMFI",65,0)
 S ALL=$S(IEN["ALL":1,1:0)
"RTN","XUMFI",66,0)
 S PROTOCOL=$G(^TMP("XUMF MFS",$J,"PARAM","PROTOCOL"))
"RTN","XUMFI",67,0)
 S MFR=$S(UPDATE:0,TYPE>10:1,1:0)
"RTN","XUMFI",68,0)
 S MFQ=$S(UPDATE:0,'MFR:1,1:0)
"RTN","XUMFI",69,0)
 S MFK=$S(TYPE=10:1,1:0)
"RTN","XUMFI",70,0)
 S MTYP=$S(MFR:"HLA",MFK:"HLA",1:"HLS")
"RTN","XUMFI",71,0)
 ;
"RTN","XUMFI",72,0)
 ; -- get variables from HL7 package
"RTN","XUMFI",73,0)
 I $O(HL(""))="" D INIT^HLFNC2(PROTOCOL,.HL)
"RTN","XUMFI",74,0)
 I $O(HL(""))="" S ERROR="1^"_$P(HL,"^",2) Q
"RTN","XUMFI",75,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH"))
"RTN","XUMFI",76,0)
 ;
"RTN","XUMFI",77,0)
 ; -- check parameters
"RTN","XUMFI",78,0)
 I 'QUERY,'UPDATE S ERROR="1^invalid message type" Q
"RTN","XUMFI",79,0)
 I 'IFN S ERROR="1^invalid file number" Q
"RTN","XUMFI",80,0)
 I 'IEN,'ALL,'MFK S ERROR="1^invalid IEN" Q
"RTN","XUMFI",81,0)
 I '$$VFILE^DILFD(IFN) S ERROR="1^invalid file number" Q
"RTN","XUMFI",82,0)
 I UPDATE,'IEN S ERROR="1^update message requires an IEN" Q
"RTN","XUMFI",83,0)
 ;
"RTN","XUMFI",84,0)
 ; -- get root of file
"RTN","XUMFI",85,0)
 S ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFI",86,0)
 ;
"RTN","XUMFI",87,0)
 ; -- if IEN array input, merge with param
"RTN","XUMFI",88,0)
 I 'ALL,'IEN,$O(IEN(0)) M ^TMP("XUMF MFS",$J,"PARAM","IEN")=IEN
"RTN","XUMFI",89,0)
 ;
"RTN","XUMFI",90,0)
 ; -- get ALL file 'national' entries
"RTN","XUMFI",91,0)
 I ALL,'$D(^TMP("XUMF MFS",$J,"PARAM","IEN")) D
"RTN","XUMFI",92,0)
 .S I=0 F  S I=$O(@ROOT@("XUMF","N",I)) Q:'I  D
"RTN","XUMFI",93,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IEN",I)=""
"RTN","XUMFI",94,0)
 ;
"RTN","XUMFI",95,0)
 Q
"RTN","XUMFI",96,0)
 ;
"RTN","XUMFI",97,0)
BUILD ; -- build message
"RTN","XUMFI",98,0)
 ;
"RTN","XUMFI",99,0)
 I MFK D MFK Q
"RTN","XUMFI",100,0)
 ;
"RTN","XUMFI",101,0)
 Q:ERROR
"RTN","XUMFI",102,0)
 ;
"RTN","XUMFI",103,0)
 N ID,APP,EVENT,ENDT,EFFDT,RESP,MFI,MFN,EDT,CODE,MFE
"RTN","XUMFI",104,0)
 ;
"RTN","XUMFI",105,0)
 I QUERY D QRD Q:MFQ
"RTN","XUMFI",106,0)
 ;
"RTN","XUMFI",107,0)
 D MFI
"RTN","XUMFI",108,0)
 ;
"RTN","XUMFI",109,0)
 I GROUP D GROUP Q
"RTN","XUMFI",110,0)
 ;
"RTN","XUMFI",111,0)
 D MFE,ZZZ
"RTN","XUMFI",112,0)
 ;
"RTN","XUMFI",113,0)
 Q
"RTN","XUMFI",114,0)
 ;
"RTN","XUMFI",115,0)
MFK ; -- master file acknowledgement
"RTN","XUMFI",116,0)
 ;
"RTN","XUMFI",117,0)
 S ^TMP(MTYP,$J,CNT)="MSA"_HLFS_$S(ERROR:"AE",1:"AA")_HLFS_HL("MID")
"RTN","XUMFI",118,0)
 S CNT=CNT+1
"RTN","XUMFI",119,0)
 ;
"RTN","XUMFI",120,0)
 Q
"RTN","XUMFI",121,0)
 ;
"RTN","XUMFI",122,0)
QRD ; -- query definition segment
"RTN","XUMFI",123,0)
 ;
"RTN","XUMFI",124,0)
 I TYPE>10 D
"RTN","XUMFI",125,0)
 .S ^TMP(MTYP,$J,CNT)="MSA"_HLFS_$S(ERROR:"AE",1:"AA")_HLFS_HL("MID")
"RTN","XUMFI",126,0)
 .S CNT=CNT+1
"RTN","XUMFI",127,0)
 ;
"RTN","XUMFI",128,0)
 Q:ERROR
"RTN","XUMFI",129,0)
 ;
"RTN","XUMFI",130,0)
 N QDT,QFC,QP,QID,ZDRT,ZDRDT,QLR,WHO,WHAT,WDDC,WDCVQ,QRL,QRD
"RTN","XUMFI",131,0)
 ;
"RTN","XUMFI",132,0)
 S QDT=$G(^TMP("XUMF MFS",$J,"PARAM","QDT"))
"RTN","XUMFI",133,0)
 S QFC=$G(^TMP("XUMF MFS",$J,"PARAM","QFC"))
"RTN","XUMFI",134,0)
 S QP=$G(^TMP("XUMF MFS",$J,"PARAM","QP"))
"RTN","XUMFI",135,0)
 S QID=$G(^TMP("XUMF MFS",$J,"PARAM","QID"))
"RTN","XUMFI",136,0)
 S ZDRT=$G(^TMP("XUMF MFS",$J,"PARAM","DRT"))
"RTN","XUMFI",137,0)
 S ZDRDT=$G(^TMP("XUMF MFS",$J,"PARAM","DRDT"))
"RTN","XUMFI",138,0)
 S QLR=$G(^TMP("XUMF MFS",$J,"PARAM","QLR"))
"RTN","XUMFI",139,0)
 S WHO=$G(^TMP("XUMF MFS",$J,"PARAM","WHO"))
"RTN","XUMFI",140,0)
 S WHAT=$G(^TMP("XUMF MFS",$J,"PARAM","WHAT"))
"RTN","XUMFI",141,0)
 S WDDC=$G(^TMP("XUMF MFS",$J,"PARAM","WDDC"))
"RTN","XUMFI",142,0)
 S WDCVQ=$G(^TMP("XUMF MFS",$J,"PARAM","WDCVQ"))
"RTN","XUMFI",143,0)
 S QRL=$G(^TMP("XUMF MFS",$J,"PARAM","QRL"))
"RTN","XUMFI",144,0)
 S QRD="QRD"_HLFS_QDT_HLFS_QFC_HLFS_QP_HLFS_QID_HLFS_ZDRT_HLFS_ZDRDT
"RTN","XUMFI",145,0)
 S QRD=QRD_HLFS_QLR_HLFS_WHO_HLFS_WHAT_HLFS_WDDC_HLFS_WDCVQ_HLFS_QRL
"RTN","XUMFI",146,0)
 S ^TMP(MTYP,$J,CNT)=QRD
"RTN","XUMFI",147,0)
 S CNT=CNT+1
"RTN","XUMFI",148,0)
 ;
"RTN","XUMFI",149,0)
 Q
"RTN","XUMFI",150,0)
 ;
"RTN","XUMFI",151,0)
MFI ; master file identifier segment
"RTN","XUMFI",152,0)
 ;
"RTN","XUMFI",153,0)
 Q:ERROR
"RTN","XUMFI",154,0)
 ;
"RTN","XUMFI",155,0)
 N ID,APP,EVENT,ENDT,EFFDT,RESP,MFI
"RTN","XUMFI",156,0)
 ;
"RTN","XUMFI",157,0)
 S ID=$G(^TMP("XUMF MFS",$J,"PARAM","MFI"))
"RTN","XUMFI",158,0)
 S APP=$G(^TMP("XUMF MFS",$J,"PARAM","MFAI"))
"RTN","XUMFI",159,0)
 S EVENT=$G(^TMP("XUMF MFS",$J,"PARAM","FLEV"))
"RTN","XUMFI",160,0)
 S ENDT=$G(^TMP("XUMF MFS",$J,"PARAM","ENDT"))
"RTN","XUMFI",161,0)
 S EFFDT=$G(^TMP("XUMF MFS",$J,"PARAM","MFIEDT"))
"RTN","XUMFI",162,0)
 S RESP=$G(^TMP("XUMF MFS",$J,"PARAM","RLC"))
"RTN","XUMFI",163,0)
 S:APP="" APP="MFS" S:EVENT="" EVENT="REP" S:RESP="" RESP="NE"
"RTN","XUMFI",164,0)
 S:ENDT="" ENDT=$$NOW^XLFDT S:EFFDT="" EFFDT=$$NOW^XLFDT
"RTN","XUMFI",165,0)
 S MFI=$$MFI^VAFHLMFI(ID,APP,EVENT,ENDT,EFFDT,RESP)
"RTN","XUMFI",166,0)
 I $E(MFI)="-" S ERROR=MFI Q
"RTN","XUMFI",167,0)
 S ^TMP(MTYP,$J,CNT)=MFI
"RTN","XUMFI",168,0)
 S CNT=CNT+1
"RTN","XUMFI",169,0)
 ;
"RTN","XUMFI",170,0)
 Q
"RTN","XUMFI",171,0)
 ;
"RTN","XUMFI",172,0)
MFE ; master file entry segment
"RTN","XUMFI",173,0)
 ;
"RTN","XUMFI",174,0)
 Q:ERROR
"RTN","XUMFI",175,0)
 ;
"RTN","XUMFI",176,0)
 N EVENT,MFN,EDT,CODE,MFE
"RTN","XUMFI",177,0)
 ;
"RTN","XUMFI",178,0)
 S EVENT=$G(^TMP("XUMF MFS",$J,"PARAM","RLEC"))
"RTN","XUMFI",179,0)
 S MFN=$G(^TMP("XUMF MFS",$J,"PARAM","MFNCID"))
"RTN","XUMFI",180,0)
 S EDT=$G(^TMP("XUMF MFS",$J,"PARAM","MFEEDT"))
"RTN","XUMFI",181,0)
 S CODE=$G(^TMP("XUMF MFS",$J,"PARAM","PKV"))
"RTN","XUMFI",182,0)
 S:EDT="" EDT=$$NOW^XLFDT S:EVENT="" EVENT="MAD"
"RTN","XUMFI",183,0)
 S MFE=$$MFE^VAFHLMFE(EVENT,MFN,EDT,CODE)
"RTN","XUMFI",184,0)
 I $E(MFE)="-" S ERROR=MFE Q
"RTN","XUMFI",185,0)
 S ^TMP(MTYP,$J,CNT)=MFE
"RTN","XUMFI",186,0)
 S CNT=CNT+1
"RTN","XUMFI",187,0)
 ;
"RTN","XUMFI",188,0)
 Q
"RTN","XUMFI",189,0)
 ;
"RTN","XUMFI",190,0)
ZZZ ; [Z...] segment
"RTN","XUMFI",191,0)
 ;
"RTN","XUMFI",192,0)
 Q:ERROR
"RTN","XUMFI",193,0)
 ;
"RTN","XUMFI",194,0)
 N SEG,SEQ,ZZZ,FLD,FILE,IENS,VALUE,ERR,ZDTYP,FIELD
"RTN","XUMFI",195,0)
 ;
"RTN","XUMFI",196,0)
 S SEG="",SEQ=0
"RTN","XUMFI",197,0)
 F  S SEG=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG)) Q:SEG=""  D
"RTN","XUMFI",198,0)
 .S ZZZ=SEG
"RTN","XUMFI",199,0)
 .F  S SEQ=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFI",200,0)
 ..S FLD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,0))
"RTN","XUMFI",201,0)
 ..I 'FLD D
"RTN","XUMFI",202,0)
 ...S FILE=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FILE")
"RTN","XUMFI",203,0)
 ...S IENS=$G(^TMP("XUMF MFS",$J,"PARAM","IENS",SEG,SEQ))
"RTN","XUMFI",204,0)
 ...S FIELD=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FIELD")
"RTN","XUMFI",205,0)
 ...S ZDTYP=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"DTYP")
"RTN","XUMFI",206,0)
 ...I $P(ZDTYP,U,3)[":" S FIELD=FIELD_$P(ZDTYP,U,3)
"RTN","XUMFI",207,0)
 ...S VALUE=$$GET1^DIQ(FILE,IENS,FIELD)
"RTN","XUMFI",208,0)
 ...S VALUE=$$DTYP^XUMFP(VALUE,ZDTYP,HLCS,1)
"RTN","XUMFI",209,0)
 ...S $P(ZZZ,HLFS,SEQ+1)=VALUE
"RTN","XUMFI",210,0)
 ..I FLD D
"RTN","XUMFI",211,0)
 ...S ZDTYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FLD))
"RTN","XUMFI",212,0)
 ...I $P(ZDTYP,U,3)[":" S FLD=FLD_$P(ZDTYP,U,3)
"RTN","XUMFI",213,0)
 ...S VALUE=$$GET1^DIQ(IFN,IEN_",",FLD)
"RTN","XUMFI",214,0)
 ...S VALUE=$$DTYP^XUMFP(VALUE,ZDTYP,HLCS,1)
"RTN","XUMFI",215,0)
 ...S $P(ZZZ,HLFS,SEQ+1)=VALUE
"RTN","XUMFI",216,0)
 .S ^TMP(MTYP,$J,CNT)=ZZZ,CNT=CNT+1
"RTN","XUMFI",217,0)
 ;
"RTN","XUMFI",218,0)
 Q
"RTN","XUMFI",219,0)
 ;
"RTN","XUMFI",220,0)
GROUP ; -- query group records
"RTN","XUMFI",221,0)
 ;
"RTN","XUMFI",222,0)
 Q:ERROR
"RTN","XUMFI",223,0)
 ;
"RTN","XUMFI",224,0)
 S IEN=0
"RTN","XUMFI",225,0)
 F  S IEN=$O(^TMP("XUMF MFS",$J,"PARAM","IEN",IEN)) Q:'IEN  D
"RTN","XUMFI",226,0)
 .K ^TMP("XUMF MFS",$J,"PARAM","PKV")
"RTN","XUMFI",227,0)
 .K ^TMP("XUMF MFS",$J,"PARAM","IENS")
"RTN","XUMFI",228,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")
"RTN","XUMFI",229,0)
 .M ^TMP("XUMF MFS",$J,"PARAM","IENS")=^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS")
"RTN","XUMFI",230,0)
 .D MFE,ZZZ
"RTN","XUMFI",231,0)
 ;
"RTN","XUMFI",232,0)
 Q
"RTN","XUMFI",233,0)
 ;
"RTN","XUMFI",234,0)
SEND ; -- send HL7 message
"RTN","XUMFI",235,0)
 ;
"RTN","XUMFI",236,0)
 Q:ERROR
"RTN","XUMFI",237,0)
 ;
"RTN","XUMFI",238,0)
 S HLP("PRIORITY")="I"
"RTN","XUMFI",239,0)
 ;
"RTN","XUMFI",240,0)
 I 'TYPE D GENERATE^HLMA(PROTOCOL,"GM",1,.HLRESLT,"",.HLP)
"RTN","XUMFI",241,0)
 I TYPE,(TYPE<10) D DIRECT^HLMA(PROTOCOL,"GM",1,.HLRESLT,"",.HLP)
"RTN","XUMFI",242,0)
 I (TYPE>9) D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"GM",1,.HLRESLT)
"RTN","XUMFI",243,0)
 ;
"RTN","XUMFI",244,0)
 ; check for error
"RTN","XUMFI",245,0)
 I ($P($G(HLRESLT),U,3)'="") D  Q
"RTN","XUMFI",246,0)
 .S ERROR=1_U_$P(HLRESLT,HLFS,3)_U_$P(HLRESLT,HLFS,2)_U_$P(HLRESLT,U)
"RTN","XUMFI",247,0)
 ;
"RTN","XUMFI",248,0)
 ; successful call, message ID returned
"RTN","XUMFI",249,0)
 S ERROR="0^"_$P($G(HLRESLT),U,1)
"RTN","XUMFI",250,0)
 ;
"RTN","XUMFI",251,0)
 Q
"RTN","XUMFI",252,0)
 ;
"RTN","XUMFI",253,0)
EXIT ; -- exit
"RTN","XUMFI",254,0)
 ;
"RTN","XUMFI",255,0)
 D CLEAN^DILF
"RTN","XUMFI",256,0)
 ;
"RTN","XUMFI",257,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFI",258,0)
 K ^TMP("XUMF MFS",$J)
"RTN","XUMFI",259,0)
 ;
"RTN","XUMFI",260,0)
 Q
"RTN","XUMFI",261,0)
 ;
"RTN","XUMFI",262,0)
LLNK ; -- dynamic addressing BROADCAST
"RTN","XUMFI",263,0)
 ;
"RTN","XUMFI",264,0)
 Q:TYPE>9
"RTN","XUMFI",265,0)
 ;
"RTN","XUMFI",266,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","LLNK"))'="" D  Q
"RTN","XUMFI",267,0)
 .S HLL("LINKS",1)=^TMP("XUMF MFS",$J,"PARAM","LLNK")
"RTN","XUMFI",268,0)
 ;
"RTN","XUMFI",269,0)
 Q
"RTN","XUMFI",270,0)
 ;
"RTN","XUMFI",271,0)
 Q:TYPE
"RTN","XUMFI",272,0)
 Q:'$G(^TMP("XUMF MFS",$J,"PARAM","BROADCAST"))
"RTN","XUMFI",273,0)
 ;
"RTN","XUMFI",274,0)
 N I,J,LLNK
"RTN","XUMFI",275,0)
 ;
"RTN","XUMFI",276,0)
 S (I,J)=0
"RTN","XUMFI",277,0)
 F  S I=$O(^HLCS(870,"C",I)) Q:'I  D
"RTN","XUMFI",278,0)
 .S J=$O(^HLCS(870,"C",I,0)) Q:'J
"RTN","XUMFI",279,0)
 .S LLNK=$P($G(^HLCS(870,J,0)),U)
"RTN","XUMFI",280,0)
 .S HLL("LINKS",I)="XUMF MFK^"_LLNK
"RTN","XUMFI",281,0)
 ;
"RTN","XUMFI",282,0)
 Q
"RTN","XUMFI",283,0)
 ;
"RTN","XUMFP")
0^25^B12278127
"RTN","XUMFP",1,0)
XUMFP ;CIOFO-SF/RAM - Master File C/S Parameters; 06/28/00
"RTN","XUMFP",2,0)
 ;;8.0;KERNEL;**206**;Jul 10, 1995
"RTN","XUMFP",3,0)
 ;
"RTN","XUMFP",4,0)
 ;
"RTN","XUMFP",5,0)
 ;
"RTN","XUMFP",6,0)
MAIN(IFN,IEN,TYPE,PARAM,ERROR) ; -- parameters for master file server
"RTN","XUMFP",7,0)
 ;
"RTN","XUMFP",8,0)
 ;INPUT
"RTN","XUMFP",9,0)
 ;       IFN             Internal File Number (required)
"RTN","XUMFP",10,0)
 ;
"RTN","XUMFP",11,0)
 ;       IEN             Internal Entry Number (required)
"RTN","XUMFP",12,0)
 ;
"RTN","XUMFP",13,0)
 ;                       single entry (pass by value) example: IEN=1
"RTN","XUMFP",14,0)
 ;
"RTN","XUMFP",15,0)
 ;                       multiple entries (pass by reference)  IEN(1)=""
"RTN","XUMFP",16,0)
 ;                                                             IEN(2)=""
"RTN","XUMFP",17,0)
 ;
"RTN","XUMFP",18,0)
 ;                       ALL national entries (pass by value)  IEN="ALL"
"RTN","XUMFP",19,0)
 ;
"RTN","XUMFP",20,0)
 ;                       NEW entry (pass by value)             IEN="NEW"
"RTN","XUMFP",21,0)
 ;
"RTN","XUMFP",22,0)
 ;       TYPE            Message TYPE (required)
"RTN","XUMFP",23,0)
 ;
"RTN","XUMFP",24,0)
 ;                       0  = MFN - unsolicited update
"RTN","XUMFP",25,0)
 ;                       1  = MFQ - query particular record and file
"RTN","XUMFP",26,0)
 ;                       3  = MFQ - query particular record in array
"RTN","XUMFP",27,0)
 ;                       5  = MFQ - query group records file
"RTN","XUMFP",28,0)
 ;                       7  = MFQ - query group records array
"RTN","XUMFP",29,0)
 ;                       11 = MFR - query response particular rec file
"RTN","XUMFP",30,0)
 ;                       13 = MFR - query response particular rec array
"RTN","XUMFP",31,0)
 ;                       15 = MFR - query response group records file
"RTN","XUMFP",32,0)
 ;                       17 = MFR - query response group records array
"RTN","XUMFP",33,0)
 ;
"RTN","XUMFP",34,0)
 ;
"RTN","XUMFP",35,0)
 ;INPUT/OUTPUT
"RTN","XUMFP",36,0)
 ;
"RTN","XUMFP",37,0)
 ;       PARAM("PROTOCOL")       IEN Protocol (#101) file
"RTN","XUMFP",38,0)
 ;       PARAM("LLNK")           HLL("LINKS",n) 'protocol^logical link'
"RTN","XUMFP",39,0)
 ;       PARAM("PRE")            Pre-update record routine
"RTN","XUMFP",40,0)
 ;       PARAM("POST")           Post-update record routine
"RTN","XUMFP",41,0)
 ;
"RTN","XUMFP",42,0)
 ;       QRD -- Query definition segment
"RTN","XUMFP",43,0)
 ;       -------------------------------
"RTN","XUMFP",44,0)
 ;       PARAM("QDT")            Query Date/Time
"RTN","XUMFP",45,0)
 ;       PARAM("QFC")            Query Format Code
"RTN","XUMFP",46,0)
 ;       PARAM("QP")             Query Priority
"RTN","XUMFP",47,0)
 ;       PARAM("QID")            Query ID
"RTN","XUMFP",48,0)
 ;       PARAM("DRT")            Deferred Response Type
"RTN","XUMFP",49,0)
 ;       PARAM("DRDT")           Deferred Response Date/Time
"RTN","XUMFP",50,0)
 ;       PARAM("QLR")            Quantity Limited Request
"RTN","XUMFP",51,0)
 ;       PARAM("WHO")            Who Subject Filter
"RTN","XUMFP",52,0)
 ;       PARAM("WHAT")           What Subject Filter
"RTN","XUMFP",53,0)
 ;       PARAM("WDDC")           What Department Data Code
"RTN","XUMFP",54,0)
 ;       PARAM("WDCVQ")          What Data Code Value Qual
"RTN","XUMFP",55,0)
 ;       PARAM("QRL")            Query Results Level
"RTN","XUMFP",56,0)
 ;
"RTN","XUMFP",57,0)
 ;       MFI -- Master File Identification
"RTN","XUMFP",58,0)
 ;       ---------------------------------
"RTN","XUMFP",59,0)
 ;       PARAM("MFI")            Master File Identifier
"RTN","XUMFP",60,0)
 ;       PARAM("MFAI")           Master File Application Identifier
"RTN","XUMFP",61,0)
 ;       PARAM("FLEC")           File-Level Event Code
"RTN","XUMFP",62,0)
 ;       PARAM("ENDT")           Entered Data/Time
"RTN","XUMFP",63,0)
 ;       PARAM("MFIEDT")         Effective Date/Time
"RTN","XUMFP",64,0)
 ;       PARAM("RLC")            Response Level Code
"RTN","XUMFP",65,0)
 ; 
"RTN","XUMFP",66,0)
 ;       MFE -- Master File Entry
"RTN","XUMFP",67,0)
 ;       ------------------------
"RTN","XUMFP",68,0)
 ;       PARAM("RLEC")           Record-Level Event Code
"RTN","XUMFP",69,0)
 ;       PARAM("MFNCID")         MFN Control ID
"RTN","XUMFP",70,0)
 ;       PARAM("MFEEDT")         Effective Date/Time
"RTN","XUMFP",71,0)
 ;       PARAM("PKV")            Primary Key Value
"RTN","XUMFP",72,0)
 ;
"RTN","XUMFP",73,0)
 ;       [Z...] segment(s) parameters
"RTN","XUMFP",74,0)
 ;       -------------------------
"RTN","XUMFP",75,0)
 ;       PARAM("SEG",SEG)=""             HL7 segment name
"RTN","XUMFP",76,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,FLD#) seg sequence number and field
"RTN","XUMFP",77,0)
 ;  Note: Add HL7 data type + sub components (leave value/code blank) 
"RTN","XUMFP",78,0)
 ;  Example: Institution Facility Type  = "CE^~FACILILITY TYPE~VA"
"RTN","XUMFP",79,0)
 ;    If the FIELD is a pointer and you want the lookup to be other
"RTN","XUMFP",80,0)
 ;    than the pointed to .01 set the 3rd piece = to the extended ref.
"RTN","XUMFP",81,0)
 ;    I.e., Parent Facility in the Association mult of Institution
"RTN","XUMFP",82,0)
 ;    points back to Institution, if we want to get facility using
"RTN","XUMFP",83,0)
 ;    station number (#99) instead of name (.01) set the 3rd piece
"RTN","XUMFP",84,0)
 ;    equal to ":99" giving us "CE^~FACILILITY TYPE~VA^:99".
"RTN","XUMFP",85,0)
 ;
"RTN","XUMFP",86,0)
 ;       Files involving sub-records and/or extended reference
"RTN","XUMFP",87,0)
 ;       -----------------------------------------------------
"RTN","XUMFP",88,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"FILE")       See FM documentation
"RTN","XUMFP",89,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"IENS")       $$GET1^DIQ() for value
"RTN","XUMFP",90,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"FIELD")      of FILE, IENS, & FIELD.
"RTN","XUMFP",91,0)
 ;
"RTN","XUMFP",92,0)
 ;       PARAM("SEG",SEG,"SEQ",SEQ,"DTYP")      HL7 data type (above)
"RTN","XUMFP",93,0)
 ;
"RTN","XUMFP",94,0)
 ;
"RTN","XUMFP",95,0)
 ; *** NOTE: OUTPUT in ^TMP("XUMF MFS",$J,"PARAM") ***
"RTN","XUMFP",96,0)
 ;
"RTN","XUMFP",97,0)
 ;       Example: MFE PKV is ^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")
"RTN","XUMFP",98,0)
 ;                    SEG    ^TMP("XUMF MFS",$J,"PARAM","SEG")
"RTN","XUMFP",99,0)
 ;
"RTN","XUMFP",100,0)
 ;       and another node is required for sub-file IENS for group
"RTN","XUMFP",101,0)
 ;       ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS",SEG,SEQ)=IENS
"RTN","XUMFP",102,0)
 ;
"RTN","XUMFP",103,0)
 ;       Use XUMFP4 as a template/example routine
"RTN","XUMFP",104,0)
 ;
"RTN","XUMFP",105,0)
 N QUERY,UPDATE,ALL,MFR,MFQ,HLFS,HLCS,GROUP,ARRAY,ROOT,NEW,I
"RTN","XUMFP",106,0)
 ;
"RTN","XUMFP",107,0)
 K ^TMP("XUMF MFS",$J)
"RTN","XUMFP",108,0)
 M ^TMP("XUMF MFS",$J,"PARAM")=PARAM
"RTN","XUMFP",109,0)
 ;
"RTN","XUMFP",110,0)
 S IEN=$G(IEN),IFN=$G(IFN)
"RTN","XUMFP",111,0)
 S TYPE=+$G(TYPE),ERROR=0
"RTN","XUMFP",112,0)
 S UPDATE=$S(TYPE#2:0,1:1)
"RTN","XUMFP",113,0)
 S QUERY='UPDATE
"RTN","XUMFP",114,0)
 S GROUP=$S(UPDATE:0,TYPE[5:1,TYPE[7:1,1:0)
"RTN","XUMFP",115,0)
 S ARRAY=$S(UPDATE:0,TYPE[3:1,TYPE[7:1,1:0)
"RTN","XUMFP",116,0)
 S ALL=$S(IEN="ALL":1,1:0)
"RTN","XUMFP",117,0)
 S NEW=$S(IEN="NEW":1,1:0)
"RTN","XUMFP",118,0)
 S MFR=$S(UPDATE:0,TYPE>10:1,1:0)
"RTN","XUMFP",119,0)
 S MFQ=$S(UPDATE:0,'MFR:1,1:0)
"RTN","XUMFP",120,0)
 ;
"RTN","XUMFP",121,0)
 I 'IFN S ERROR="1^invalid IFN" Q
"RTN","XUMFP",122,0)
 ;
"RTN","XUMFP",123,0)
 ; -- get root of file
"RTN","XUMFP",124,0)
 S ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFP",125,0)
 ;
"RTN","XUMFP",126,0)
 ; -- if IEN array input, merge with param
"RTN","XUMFP",127,0)
 I 'ALL,'IEN,$O(IEN(0)) M ^TMP("XUMF MFS",$J,"PARAM","IEN")=IEN
"RTN","XUMFP",128,0)
 ;
"RTN","XUMFP",129,0)
 ; -- get ALL file 'national' entries
"RTN","XUMFP",130,0)
 I ALL,'$D(^TMP("XUMF MFS",$J,"PARAM","IEN")) D
"RTN","XUMFP",131,0)
 .S I=0 F  S I=$O(@ROOT@("XUMF","N",I)) Q:'I  D
"RTN","XUMFP",132,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS",I)=""
"RTN","XUMFP",133,0)
 ;
"RTN","XUMFP",134,0)
 ;  *** insert code below ***
"RTN","XUMFP",135,0)
 ; insert file number in string below to add an additional file
"RTN","XUMFP",136,0)
 I "^4^4.1^"'[(U_IFN_U) S ERROR="1^file not supported" Q
"RTN","XUMFP",137,0)
 ;  *** end insert code ***
"RTN","XUMFP",138,0)
 ;
"RTN","XUMFP",139,0)
 ;    note: also create a subroutine for each supported file with
"RTN","XUMFP",140,0)
 ;             the file number as the line TAG (replace decimal point
"RTN","XUMFP",141,0)
 ;             of file number with the letter 'P').  This subroutine
"RTN","XUMFP",142,0)
 ;             calls an associated routine for the specific file.
"RTN","XUMFP",143,0)
 ;             This file should use the XUMFP namespace.
"RTN","XUMFP",144,0)
 ;
"RTN","XUMFP",145,0)
 D @("F"_$TR(IFN,".","P"))
"RTN","XUMFP",146,0)
 ;
"RTN","XUMFP",147,0)
 K PARAM
"RTN","XUMFP",148,0)
 ;
"RTN","XUMFP",149,0)
 Q
"RTN","XUMFP",150,0)
 ;
"RTN","XUMFP",151,0)
F4 ; -- institution file
"RTN","XUMFP",152,0)
 ;
"RTN","XUMFP",153,0)
 D ^XUMFP4
"RTN","XUMFP",154,0)
 ;
"RTN","XUMFP",155,0)
 Q
"RTN","XUMFP",156,0)
 ;
"RTN","XUMFP",157,0)
F4P1 ; -- facility type file
"RTN","XUMFP",158,0)
 ;
"RTN","XUMFP",159,0)
 D ^XUMFPFT
"RTN","XUMFP",160,0)
 ;
"RTN","XUMFP",161,0)
 Q
"RTN","XUMFP",162,0)
 ;
"RTN","XUMFP",163,0)
 ;  *** insert subroutine here for additional files ***
"RTN","XUMFP",164,0)
 ;
"RTN","XUMFP",165,0)
TAG ;D ^ROUTINE
"RTN","XUMFP",166,0)
 ;Q
"RTN","XUMFP",167,0)
 ;
"RTN","XUMFP",168,0)
 ;
"RTN","XUMFP",169,0)
MFI(X) ; -- master file identifier function
"RTN","XUMFP",170,0)
 ;
"RTN","XUMFP",171,0)
 ;INPUT          X       master file indentifier (seq 1 MFI segment)
"RTN","XUMFP",172,0)
 ;OUTPUT         $$      IFN - Internal File Number or '0' for error
"RTN","XUMFP",173,0)
 ;
"RTN","XUMFP",174,0)
 Q:X="Z04" 4
"RTN","XUMFP",175,0)
 Q:X="Z4T" 4.1
"RTN","XUMFP",176,0)
 ;
"RTN","XUMFP",177,0)
 ; *** add code here for new files ***
"RTN","XUMFP",178,0)
 ;
"RTN","XUMFP",179,0)
 Q 0
"RTN","XUMFP",180,0)
 ;
"RTN","XUMFP",181,0)
DTYP(VALUE,TYP,HLCS,TOHL7) ;data type conversion
"RTN","XUMFP",182,0)
 ;INPUT
"RTN","XUMFP",183,0)
 ;   VALUE    value
"RTN","XUMFP",184,0)
 ;   TYP    HL7 data type
"RTN","XUMFP",185,0)
 ;   TOHL7   1=to HL7, 0=to FileMan
"RTN","XUMFP",186,0)
 ;OUTPUT
"RTN","XUMFP",187,0)
 ;   $$      formatted data
"RTN","XUMFP",188,0)
 ;
"RTN","XUMFP",189,0)
 N TEXT,CS
"RTN","XUMFP",190,0)
 S TYP=$G(TYP),VALUE=$G(VALUE),TOHL7=$G(TOHL7)
"RTN","XUMFP",191,0)
 Q:TYP="" VALUE Q:VALUE="" VALUE
"RTN","XUMFP",192,0)
 S TEXT=$P(TYP,U,2),TYP=$P(TYP,U)
"RTN","XUMFP",193,0)
 I TYP="ST"!(TYP="ID") Q VALUE
"RTN","XUMFP",194,0)
 I TYP="DT",TOHL7 D  Q $$HLDATE^HLFNC(VALUE)
"RTN","XUMFP",195,0)
 .N X,Y S X=VALUE D ^%DT S VALUE=+Y
"RTN","XUMFP",196,0)
 I TYP="DT" Q $$FMDATE^HLFNC(+VALUE)
"RTN","XUMFP",197,0)
 I 'TOHL7 Q $P(VALUE,HLCS)
"RTN","XUMFP",198,0)
 Q VALUE_$TR(TEXT,"~",HLCS)
"RTN","XUMFP",199,0)
 ;
"RTN","XUMFP4")
0^26^B25861028
"RTN","XUMFP4",1,0)
XUMFP4 ;CIOFO-SF/RAM - Master File C/S Params INSTITUTION ; 06/28/00
"RTN","XUMFP4",2,0)
 ;;8.0;KERNEL;**206**;Jul 10, 1995
"RTN","XUMFP4",3,0)
 ;
"RTN","XUMFP4",4,0)
 ;
"RTN","XUMFP4",5,0)
 ; This routine sets up the parameters required by the INSTITUTION (#4)
"RTN","XUMFP4",6,0)
 ; file for the Master File server mechanism.
"RTN","XUMFP4",7,0)
 ;
"RTN","XUMFP4",8,0)
 ;  ** This routine is not a supported interface -- use XUMFP **
"RTN","XUMFP4",9,0)
 ;
"RTN","XUMFP4",10,0)
 ;  See XUMFP for parameter list documentation
"RTN","XUMFP4",11,0)
 ;
"RTN","XUMFP4",12,0)
 N PKV,PROTOCOL,HLFS,HLCS,RT,RF
"RTN","XUMFP4",13,0)
 ;
"RTN","XUMFP4",14,0)
 S ^TMP("XUMF MFS",$J,"PARAM","PRE")="PRE^XUMFP4C"
"RTN","XUMFP4",15,0)
 S ^TMP("XUMF MFS",$J,"PARAM","POST")="POST^XUMFP4C"
"RTN","XUMFP4",16,0)
 ;
"RTN","XUMFP4",17,0)
 I $O(HL(""))="" D
"RTN","XUMFP4",18,0)
 .S:UPDATE PROTOCOL=$O(^ORD(101,"B","XUMF MFN",0))
"RTN","XUMFP4",19,0)
 .S:QUERY PROTOCOL=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMFP4",20,0)
 .S:'PROTOCOL ERROR="1^invalid protocol" Q:ERROR
"RTN","XUMFP4",21,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PROTOCOL")=PROTOCOL
"RTN","XUMFP4",22,0)
 .D INIT^HLFNC2(PROTOCOL,.HL)
"RTN","XUMFP4",23,0)
 ;
"RTN","XUMFP4",24,0)
 I $O(HL(""))="" S ERROR="1^"_$P(HL,U,2) Q
"RTN","XUMFP4",25,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH"))
"RTN","XUMFP4",26,0)
 ;
"RTN","XUMFP4",27,0)
 I QUERY D QRD^XUMFP4C
"RTN","XUMFP4",28,0)
 ;
"RTN","XUMFP4",29,0)
 ; MFI -- Master File Identification Segment
"RTN","XUMFP4",30,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFI")="Z04"  ;Master File Identifier
"RTN","XUMFP4",31,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFAI")=""  ;Application Identifier
"RTN","XUMFP4",32,0)
 S ^TMP("XUMF MFS",$J,"PARAM","FLEC")="UPD"  ;File-Level Event Code
"RTN","XUMFP4",33,0)
 S ^TMP("XUMF MFS",$J,"PARAM","ENDT")=""  ;Entered Data/Time
"RTN","XUMFP4",34,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFIEDT")=""  ;Effective Date/Time
"RTN","XUMFP4",35,0)
 S ^TMP("XUMF MFS",$J,"PARAM","RLC")="NE"  ;Response Level Code
"RTN","XUMFP4",36,0)
 ;
"RTN","XUMFP4",37,0)
 ; MFE -- Master File Entry
"RTN","XUMFP4",38,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","RLEC"))="" D  ;Record-Level Event Code
"RTN","XUMFP4",39,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","RLEC")="MUP"
"RTN","XUMFP4",40,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFNCID")=""  ;MFN Control ID
"RTN","XUMFP4",41,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","MFEEDT"))="" D  ;Effective Date/Time
"RTN","XUMFP4",42,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","MFEEDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFP4",43,0)
 ;
"RTN","XUMFP4",44,0)
SEG ; -- ZIN segment
"RTN","XUMFP4",45,0)
 ;
"RTN","XUMFP4",46,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",8)=""
"RTN","XUMFP4",47,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",8)="VISN"
"RTN","XUMFP4",48,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",9)=""
"RTN","XUMFP4",49,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",9)="PARENT FACILITY"
"RTN","XUMFP4",50,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",10)=10
"RTN","XUMFP4",51,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",11)=10
"RTN","XUMFP4",52,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",12)=12
"RTN","XUMFP4",53,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",13)=12
"RTN","XUMFP4",54,0)
 ;
"RTN","XUMFP4",55,0)
 I IEN D
"RTN","XUMFP4",56,0)
 .S PKV=$P($G(^DIC(4,+IEN,99)),U)_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4",57,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFP4",58,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",8)="1,"_IEN_","
"RTN","XUMFP4",59,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.014,"1,"_IEN_",")="VISN"
"RTN","XUMFP4",60,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",9)="2,"_IEN_","
"RTN","XUMFP4",61,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.014,"2,"_IEN_",")="PARENT FACILITY"
"RTN","XUMFP4",62,0)
 .S RF=$$RF^XUAF4(IEN) D:RF
"RTN","XUMFP4",63,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",10)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4",64,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",11)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4",65,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.999,$P(RF,U,3)_","_IEN_",")=$P(RF,U,3)
"RTN","XUMFP4",66,0)
 .S RT=$$RT^XUAF4(IEN) D:RT
"RTN","XUMFP4",67,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",12)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4",68,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",13)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4",69,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.999,$P(RT,U,3)_","_IEN_",")=$P(RT,U,3)
"RTN","XUMFP4",70,0)
 ;
"RTN","XUMFP4",71,0)
 I NEW D
"RTN","XUMFP4",72,0)
 .S PKV="NEW"_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4",73,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFP4",74,0)
 ;
"RTN","XUMFP4",75,0)
 ; ZIN -- VA Specific VHA Institution Segment sequence
"RTN","XUMFP4",76,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEGMENT")="ZIN"
"RTN","XUMFP4",77,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",1,.01)="ST"  ;name
"RTN","XUMFP4",78,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",2,99)="ST"  ;sta #
"RTN","XUMFP4",79,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",3,11)="ID"  ;status
"RTN","XUMFP4",80,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",4,13)="CE^~FACILITY TYPE~VA"  ;facility type
"RTN","XUMFP4",81,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",5,100)="ST"  ;official va name
"RTN","XUMFP4",82,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",6,101)="ST"  ;inactive facility flag
"RTN","XUMFP4",83,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",7,.02)="ST"  ;state
"RTN","XUMFP4",84,0)
 ; associations -- VISN
"RTN","XUMFP4",85,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",8,"FILE")=4.014
"RTN","XUMFP4",86,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",8,"FIELD")=1
"RTN","XUMFP4",87,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",8,"DTYP")="CE^~VISN~VA"
"RTN","XUMFP4",88,0)
 ; associations -- parent
"RTN","XUMFP4",89,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",9,"FILE")=4.014
"RTN","XUMFP4",90,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",9,"FIELD")="1"
"RTN","XUMFP4",91,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",9,"DTYP")="ST^^:99"
"RTN","XUMFP4",92,0)
 ; history -- old station number
"RTN","XUMFP4",93,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",10,"FILE")=4.999
"RTN","XUMFP4",94,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",10,"FIELD")=.01
"RTN","XUMFP4",95,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",10,"DTYP")="DT"
"RTN","XUMFP4",96,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",11,"FILE")=4.999
"RTN","XUMFP4",97,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",11,"FIELD")=".06"
"RTN","XUMFP4",98,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",11,"DTYP")="ST^^:99"
"RTN","XUMFP4",99,0)
 ; history -- new station number
"RTN","XUMFP4",100,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",12,"FILE")=4.999
"RTN","XUMFP4",101,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",12,"FIELD")=.01
"RTN","XUMFP4",102,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",12,"DTYP")="DT"
"RTN","XUMFP4",103,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",13,"FILE")=4.999
"RTN","XUMFP4",104,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",13,"FIELD")=".05"
"RTN","XUMFP4",105,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",13,"DTYP")="ST^^:99"
"RTN","XUMFP4",106,0)
 ;
"RTN","XUMFP4",107,0)
GROUP ; -- query group
"RTN","XUMFP4",108,0)
 ;
"RTN","XUMFP4",109,0)
 D GROUP^XUMFP4C
"RTN","XUMFP4",110,0)
 ;
"RTN","XUMFP4",111,0)
 Q
"RTN","XUMFP4",112,0)
 ;
"RTN","XUMFP4C")
0^34^B19207412
"RTN","XUMFP4C",1,0)
XUMFP4C ;CIOFO-SF/RAM - Master File C/S Params INSTITUTION ; 06/28/00
"RTN","XUMFP4C",2,0)
 ;;8.0;KERNEL;**206**;Jul 10, 1995
"RTN","XUMFP4C",3,0)
 ;
"RTN","XUMFP4C",4,0)
 ; this routine is a called by XUMFP4 and is a continuation of that
"RTN","XUMFP4C",5,0)
 ; routine
"RTN","XUMFP4C",6,0)
 ;
"RTN","XUMFP4C",7,0)
QRD ; -- query definition segment
"RTN","XUMFP4C",8,0)
 ;
"RTN","XUMFP4C",9,0)
 ;Query Date/Time
"RTN","XUMFP4C",10,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QDT")) D
"RTN","XUMFP4C",11,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFP4C",12,0)
 ;
"RTN","XUMFP4C",13,0)
 ;Query Format Code
"RTN","XUMFP4C",14,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QFC")) D
"RTN","XUMFP4C",15,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QFC")="R"
"RTN","XUMFP4C",16,0)
 ;
"RTN","XUMFP4C",17,0)
 ;Query Priority
"RTN","XUMFP4C",18,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QP")) D
"RTN","XUMFP4C",19,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QP")="I"
"RTN","XUMFP4C",20,0)
 ;
"RTN","XUMFP4C",21,0)
 ;Query ID
"RTN","XUMFP4C",22,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QID")) D
"RTN","XUMFP4C",23,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QID")="Z04 "_$S(ARRAY:"ARRAY",1:"FILE")
"RTN","XUMFP4C",24,0)
 ;
"RTN","XUMFP4C",25,0)
 ;Deferred Response Type (optional)
"RTN","XUMFP4C",26,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRT")) D
"RTN","XUMFP4C",27,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRT")=""
"RTN","XUMFP4C",28,0)
 ;
"RTN","XUMFP4C",29,0)
 ;Deferred Response Date/Time (optional)
"RTN","XUMFP4C",30,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRDT")) D
"RTN","XUMFP4C",31,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRDT")=""
"RTN","XUMFP4C",32,0)
 ;
"RTN","XUMFP4C",33,0)
 ;Quantity Limited Request
"RTN","XUMFP4C",34,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QLR")) D
"RTN","XUMFP4C",35,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QLR")="RD"_HLCS_999
"RTN","XUMFP4C",36,0)
 ;
"RTN","XUMFP4C",37,0)
 ;Who Subject Filter - sta#, D x-ref, assigning facility
"RTN","XUMFP4C",38,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHO")) D
"RTN","XUMFP4C",39,0)
 .N X S X=$S(ALL:"ALL",IEN:$P($G(^DIC(4,+IEN,99)),U),1:"IEN ARRAY")
"RTN","XUMFP4C",40,0)
 .S $P(X,HLCS,9,10)="D"_HLCS_"045A4"
"RTN","XUMFP4C",41,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHO")=X
"RTN","XUMFP4C",42,0)
 ;
"RTN","XUMFP4C",43,0)
 ;What Subject Filter
"RTN","XUMFP4C",44,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHAT")) D
"RTN","XUMFP4C",45,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHAT")="4"_HLCS_"IFN"_HLCS_"VA FM"
"RTN","XUMFP4C",46,0)
 ;
"RTN","XUMFP4C",47,0)
 ;What Department Data Code
"RTN","XUMFP4C",48,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDDC")) D
"RTN","XUMFP4C",49,0)
 .N X S X="INFRASTRUCTURE"_HLCS_"INFORMATION INFRASTRUCTURE"
"RTN","XUMFP4C",50,0)
 .S X=X_HLCS_"VA TS"
"RTN","XUMFP4C",51,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDDC")=X
"RTN","XUMFP4C",52,0)
 ;
"RTN","XUMFP4C",53,0)
 ;What Data Code Value Qual (optional)
"RTN","XUMFP4C",54,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDCVQ")) D
"RTN","XUMFP4C",55,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDCVQ")=""
"RTN","XUMFP4C",56,0)
 ;
"RTN","XUMFP4C",57,0)
 ;Query Results Level (optional)
"RTN","XUMFP4C",58,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QRL")) D
"RTN","XUMFP4C",59,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QRL")=""
"RTN","XUMFP4C",60,0)
 ;
"RTN","XUMFP4C",61,0)
 Q
"RTN","XUMFP4C",62,0)
 ;
"RTN","XUMFP4C",63,0)
PRE ; -- pre-update record
"RTN","XUMFP4C",64,0)
 ;
"RTN","XUMFP4C",65,0)
 S XUMF0=$G(^DIC(4,+IEN,0))
"RTN","XUMFP4C",66,0)
 S XUMF3=$G(^DIC(4,+IEN,3))
"RTN","XUMFP4C",67,0)
 S XUMF99=$G(^DIC(4,+IEN,99))
"RTN","XUMFP4C",68,0)
 ;
"RTN","XUMFP4C",69,0)
 Q
"RTN","XUMFP4C",70,0)
 ;
"RTN","XUMFP4C",71,0)
POST ; -- post-update record
"RTN","XUMFP4C",72,0)
 ;
"RTN","XUMFP4C",73,0)
 N NAME,VANAME,FACTYP,ONAM,OVANAM,OFACTYP,XMB,IENS,FDA,STANUM
"RTN","XUMFP4C",74,0)
 ;
"RTN","XUMFP4C",75,0)
 S ONAM=$P(XUMF0,U)
"RTN","XUMFP4C",76,0)
 S OFACTYP=$P($G(^DIC(4.1,+XUMF3,0)),U)
"RTN","XUMFP4C",77,0)
 S OVANAM=$P(XUMF99,U,3)
"RTN","XUMFP4C",78,0)
 ;
"RTN","XUMFP4C",79,0)
 S NAME=$P($G(^DIC(4,+IEN,0)),U)
"RTN","XUMFP4C",80,0)
 S FACTYP=$P($G(^DIC(4.1,+$G(^DIC(4,+IEN,3)),0)),U)
"RTN","XUMFP4C",81,0)
 S VANAME=$P($G(^DIC(4,+IEN,99)),U,3)
"RTN","XUMFP4C",82,0)
 S STANUM=$P($G(^DIC(4,+IEN,99)),U)
"RTN","XUMFP4C",83,0)
 ;
"RTN","XUMFP4C",84,0)
 ;I ONAM'="",ONAM'=NAME,OVANAM'=VANAME D
"RTN","XUMFP4C",85,0)
 I ONAM'=NAME,OVANAM'=VANAME D
"RTN","XUMFP4C",86,0)
 .S IENS="?+"_DT_","_IEN_","
"RTN","XUMFP4C",87,0)
 .K FDA
"RTN","XUMFP4C",88,0)
 .S FDA(4.999,IENS,.01)=DT
"RTN","XUMFP4C",89,0)
 .S:NAME'=ONAM FDA(4.999,IENS,.02)=ONAM
"RTN","XUMFP4C",90,0)
 .S:VANAME'=OVANAM FDA(4.999,IENS,.03)=OVANAM
"RTN","XUMFP4C",91,0)
 .D UPDATE^DIE("E","FDA")
"RTN","XUMFP4C",92,0)
 ;
"RTN","XUMFP4C",93,0)
 ; -- notification bulletin
"RTN","XUMFP4C",94,0)
 S XMB="XUMF INSTITUTION"
"RTN","XUMFP4C",95,0)
 S XMB(1)=HL("MID")
"RTN","XUMFP4C",96,0)
 S XMB(2)=$S(ONAM="":"Added",1:"Updated")
"RTN","XUMFP4C",97,0)
 S XMB(3)=IEN
"RTN","XUMFP4C",98,0)
 S XMB(4)=STANUM
"RTN","XUMFP4C",99,0)
 S XMB(5)=NAME
"RTN","XUMFP4C",100,0)
 S XMB(6)=VANAME
"RTN","XUMFP4C",101,0)
 S XMB(7)=FACTYP
"RTN","XUMFP4C",102,0)
 S XMB(8)=ONAM
"RTN","XUMFP4C",103,0)
 S XMB(9)=OVANAM
"RTN","XUMFP4C",104,0)
 S XMB(10)=OFACTYP
"RTN","XUMFP4C",105,0)
 D ^XMB
"RTN","XUMFP4C",106,0)
 ;
"RTN","XUMFP4C",107,0)
 K XUMF0,XUMF3,XUMF99
"RTN","XUMFP4C",108,0)
 ;
"RTN","XUMFP4C",109,0)
 Q
"RTN","XUMFP4C",110,0)
 ;
"RTN","XUMFP4C",111,0)
GROUP ; -- query group
"RTN","XUMFP4C",112,0)
 ;
"RTN","XUMFP4C",113,0)
 S IEN=0
"RTN","XUMFP4C",114,0)
 F  S IEN=$O(^TMP("XUMF MFS",$J,"PARAM","IENS",IEN)) Q:'IEN  D
"RTN","XUMFP4C",115,0)
 .S PKV=$P(^DIC(4,IEN,99),U)_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4C",116,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")=PKV
"RTN","XUMFP4C",117,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",8)="1,"_IEN_","
"RTN","XUMFP4C",118,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.014,"1,"_IEN_",")="VISN"
"RTN","XUMFP4C",119,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",9)="2,"_IEN_","
"RTN","XUMFP4C",120,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.014,"2,"_IEN_",")="PARENT FACILITY"
"RTN","XUMFP4C",121,0)
 .S RF=$$RF^XUAF4(IEN) D:RF
"RTN","XUMFP4C",122,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",10)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4C",123,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",11)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4C",124,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.999,$P(RF,U,3)_","_IEN_",")=$P(RF,U,3)
"RTN","XUMFP4C",125,0)
 .S RT=$$RT^XUAF4(IEN) D:RT
"RTN","XUMFP4C",126,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",12)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4C",127,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",13)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4C",128,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.999,$P(RT,U,3)_","_IEN_",")=$P(RT,U,3)
"RTN","XUMFP4C",129,0)
 ;
"RTN","XUMFP4C",130,0)
 Q
"RTN","XUMFP4C",131,0)
 ;
"RTN","XUMFPFT")
0^31^B18434256
"RTN","XUMFPFT",1,0)
XUMFPFT ;CIOFO-SF/RAM - Master File Param FACILITY TYPE ; 06/28/00
"RTN","XUMFPFT",2,0)
 ;;8.0;KERNEL;**206**;Jul 10, 1995
"RTN","XUMFPFT",3,0)
 ;
"RTN","XUMFPFT",4,0)
 ;
"RTN","XUMFPFT",5,0)
 ; This routine sets up the parameters required by the FACILITY TYPE
"RTN","XUMFPFT",6,0)
 ; (#4) file for the Master File server mechanism.
"RTN","XUMFPFT",7,0)
 ;
"RTN","XUMFPFT",8,0)
 ;  ** This routine is not a supported interface -- use XUMFP **
"RTN","XUMFPFT",9,0)
 ;
"RTN","XUMFPFT",10,0)
 ;  See XUMFP for parameter list documentation
"RTN","XUMFPFT",11,0)
 ;
"RTN","XUMFPFT",12,0)
 N PKV,PROTOCOL,HLFS,HLCS,RT,RF
"RTN","XUMFPFT",13,0)
 ;
"RTN","XUMFPFT",14,0)
 S PARAM("PRE")="PRE^XUMFPFT"
"RTN","XUMFPFT",15,0)
 S PARAM("POST")="POST^XUMFPFT"
"RTN","XUMFPFT",16,0)
 ;
"RTN","XUMFPFT",17,0)
 I $O(HL(""))="" D
"RTN","XUMFPFT",18,0)
 .S:UPDATE PROTOCOL=$O(^ORD(101,"B","XUMF MFN",0))
"RTN","XUMFPFT",19,0)
 .S:QUERY PROTOCOL=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMFPFT",20,0)
 .S:'PROTOCOL ERROR="1^invalid protocol" Q:ERROR
"RTN","XUMFPFT",21,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PROTOCOL")=PROTOCOL
"RTN","XUMFPFT",22,0)
 .D INIT^HLFNC2(PROTOCOL,.HL)
"RTN","XUMFPFT",23,0)
 ;
"RTN","XUMFPFT",24,0)
 I $O(HL(""))="" S ERROR="1^"_$P(HL,U,2) Q
"RTN","XUMFPFT",25,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH"))
"RTN","XUMFPFT",26,0)
 ;
"RTN","XUMFPFT",27,0)
 I QUERY D QRD
"RTN","XUMFPFT",28,0)
 ;
"RTN","XUMFPFT",29,0)
 ; MFI -- Master File Identification Segment
"RTN","XUMFPFT",30,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFI")="Z4T"  ;Master File Identifier
"RTN","XUMFPFT",31,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFAI")=""  ;Application Identifier
"RTN","XUMFPFT",32,0)
 S ^TMP("XUMF MFS",$J,"PARAM","FLEC")="UPD"  ;File-Level Event Code
"RTN","XUMFPFT",33,0)
 S ^TMP("XUMF MFS",$J,"PARAM","ENDT")=""  ;Entered Data/Time
"RTN","XUMFPFT",34,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFIEDT")=""  ;Effective Date/Time
"RTN","XUMFPFT",35,0)
 S ^TMP("XUMF MFS",$J,"PARAM","RLC")="NE"  ;Response Level Code
"RTN","XUMFPFT",36,0)
 ;
"RTN","XUMFPFT",37,0)
 ; MFE -- Master File Entry
"RTN","XUMFPFT",38,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","RLEC"))="" D  ;Record-Level Event Code
"RTN","XUMFPFT",39,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","RLEC")="MUP"
"RTN","XUMFPFT",40,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFNCID")=""  ;MFN Control ID
"RTN","XUMFPFT",41,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","MFEEDT"))="" D  ;Effective Date/Time
"RTN","XUMFPFT",42,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","MFEEDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFPFT",43,0)
 ;
"RTN","XUMFPFT",44,0)
SEG ; -- ZFT segment
"RTN","XUMFPFT",45,0)
 ;
"RTN","XUMFPFT",46,0)
 I IEN D
"RTN","XUMFPFT",47,0)
 .S PKV=$P($G(^DIC(4.1,+IEN,0)),U)_HLCS_"FACILITY TYPE"_HLCS_"B"
"RTN","XUMFPFT",48,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFPFT",49,0)
 I NEW D
"RTN","XUMFPFT",50,0)
 .S PKV="NEW"_HLCS_"FACILITY TYPE"_HLCS_"B"
"RTN","XUMFPFT",51,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFPFT",52,0)
 ;
"RTN","XUMFPFT",53,0)
 ; ZFT -- VA Specific VHA Facility Type Segment sequence
"RTN","XUMFPFT",54,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEGMENT")="ZFT"
"RTN","XUMFPFT",55,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZFT","SEQ",1,.01)="ST"  ;name
"RTN","XUMFPFT",56,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZFT","SEQ",2,1)="ST"  ;full name
"RTN","XUMFPFT",57,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZFT","SEQ",3,2)="ST"  ;title
"RTN","XUMFPFT",58,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZFT","SEQ",4,3)="ST"  ;status
"RTN","XUMFPFT",59,0)
 ;
"RTN","XUMFPFT",60,0)
 Q:'GROUP
"RTN","XUMFPFT",61,0)
 Q:$G(HL("MTN"))="MFR"
"RTN","XUMFPFT",62,0)
 ;
"RTN","XUMFPFT",63,0)
GROUP ; -- query group
"RTN","XUMFPFT",64,0)
 ;
"RTN","XUMFPFT",65,0)
 S IEN=0
"RTN","XUMFPFT",66,0)
 F  S IEN=$O(^TMP("XUMF MFS",$J,"PARAM","IENS",IEN)) Q:'IEN  D
"RTN","XUMFPFT",67,0)
 .S PKV=$P(^DIC(4.1,IEN,0),U)_HLCS_"FACILITY TYPE"_HLCS_"B"
"RTN","XUMFPFT",68,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")=PKV
"RTN","XUMFPFT",69,0)
 ;
"RTN","XUMFPFT",70,0)
 Q
"RTN","XUMFPFT",71,0)
 ;
"RTN","XUMFPFT",72,0)
QRD ; -- query definition segment
"RTN","XUMFPFT",73,0)
 ;
"RTN","XUMFPFT",74,0)
 ;Query Date/Time
"RTN","XUMFPFT",75,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QDT")) D
"RTN","XUMFPFT",76,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFPFT",77,0)
 ;
"RTN","XUMFPFT",78,0)
 ;Query Format Code
"RTN","XUMFPFT",79,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QFC")) D
"RTN","XUMFPFT",80,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QFC")="R"
"RTN","XUMFPFT",81,0)
 ;
"RTN","XUMFPFT",82,0)
 ;Query Priority
"RTN","XUMFPFT",83,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QP")) D
"RTN","XUMFPFT",84,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QP")="I"
"RTN","XUMFPFT",85,0)
 ;
"RTN","XUMFPFT",86,0)
 ;Query ID
"RTN","XUMFPFT",87,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QID")) D
"RTN","XUMFPFT",88,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QID")="Z4T "_$S(ARRAY:"ARRAY",1:"FILE")
"RTN","XUMFPFT",89,0)
 ;
"RTN","XUMFPFT",90,0)
 ;Deferred Response Type (optional)
"RTN","XUMFPFT",91,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRT")) D
"RTN","XUMFPFT",92,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRT")=""
"RTN","XUMFPFT",93,0)
 ;
"RTN","XUMFPFT",94,0)
 ;Deferred Response Date/Time (optional)
"RTN","XUMFPFT",95,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRDT")) D
"RTN","XUMFPFT",96,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRDT")=""
"RTN","XUMFPFT",97,0)
 ;
"RTN","XUMFPFT",98,0)
 ;Quantity Limited Request
"RTN","XUMFPFT",99,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QLR")) D
"RTN","XUMFPFT",100,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QLR")="RD"_HLCS_999
"RTN","XUMFPFT",101,0)
 ;
"RTN","XUMFPFT",102,0)
 ;Who Subject Filter - sta#, D x-ref, assigning facility
"RTN","XUMFPFT",103,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHO")) D
"RTN","XUMFPFT",104,0)
 .N X S X=$S(ALL:"ALL",IEN:$P($G(^DIC(4.1,+IEN,0)),U),1:"IEN ARRAY")
"RTN","XUMFPFT",105,0)
 .S $P(X,HLCS,9,10)="B"_HLCS_"VA"
"RTN","XUMFPFT",106,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHO")=X
"RTN","XUMFPFT",107,0)
 ;
"RTN","XUMFPFT",108,0)
 ;What Subject Filter
"RTN","XUMFPFT",109,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHAT")) D
"RTN","XUMFPFT",110,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHAT")="4.1"_HLCS_"IFN"_HLCS_"VA FM"
"RTN","XUMFPFT",111,0)
 ;
"RTN","XUMFPFT",112,0)
 ;What Department Data Code
"RTN","XUMFPFT",113,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDDC")) D
"RTN","XUMFPFT",114,0)
 .N X S X="INFRASTRUCTURE"_HLCS_"INFORMATION INFRASTRUCTURE"
"RTN","XUMFPFT",115,0)
 .S X=X_HLCS_"VA TS"
"RTN","XUMFPFT",116,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDDC")=X
"RTN","XUMFPFT",117,0)
 ;
"RTN","XUMFPFT",118,0)
 ;What Data Code Value Qual (optional)
"RTN","XUMFPFT",119,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDCVQ")) D
"RTN","XUMFPFT",120,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDCVQ")=""
"RTN","XUMFPFT",121,0)
 ;
"RTN","XUMFPFT",122,0)
 ;Query Results Level (optional)
"RTN","XUMFPFT",123,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QRL")) D
"RTN","XUMFPFT",124,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QRL")=""
"RTN","XUMFPFT",125,0)
 ;
"RTN","XUMFPFT",126,0)
 Q
"RTN","XUMFPFT",127,0)
 ;
"RTN","XUMFPFT",128,0)
PRE ; -- pre-update record
"RTN","XUMFPFT",129,0)
 ;
"RTN","XUMFPFT",130,0)
 Q
"RTN","XUMFPFT",131,0)
 ;
"RTN","XUMFPFT",132,0)
POST ; -- post-update record
"RTN","XUMFPFT",133,0)
 ;
"RTN","XUMFPFT",134,0)
 Q
"RTN","XUMFPFT",135,0)
 ;
"RTN","XUMFPOST")
0^33^B4379388
"RTN","XUMFPOST",1,0)
XUMFPOST ;CIOFO-SF/RAM - POST INIT ROUTINE ;06/28/00
"RTN","XUMFPOST",2,0)
 ;;8.0;KERNEL;**206**;Jul 10, 1995
"RTN","XUMFPOST",3,0)
 ;
"RTN","XUMFPOST",4,0)
 ;
"RTN","XUMFPOST",5,0)
EN ;
"RTN","XUMFPOST",6,0)
 N IEN,DR,DIE,DA,DIK,DIU
"RTN","XUMFPOST",7,0)
 ;
"RTN","XUMFPOST",8,0)
 S IEN=0
"RTN","XUMFPOST",9,0)
 F  S IEN=$O(^DIC(4,IEN)) Q:'IEN  D
"RTN","XUMFPOST",10,0)
 .S DR="7////@;10////@;12////@;.04////@;77////@"
"RTN","XUMFPOST",11,0)
 .S DIE=4,DA=IEN
"RTN","XUMFPOST",12,0)
 .N IEN D ^DIE
"RTN","XUMFPOST",13,0)
 ;
"RTN","XUMFPOST",14,0)
 F DA=7,10,12,.04,77 S DA(1)=4,DIK="^DD(4," D ^DIK
"RTN","XUMFPOST",15,0)
 ;
"RTN","XUMFPOST",16,0)
 S DIU=4.01,DIU(0)="S" D EN^DIU2
"RTN","XUMFPOST",17,0)
 ;
"RTN","XUMFPOST",18,0)
 K ^DD(4,0,"ID",.02)
"RTN","XUMFPOST",19,0)
 K ^DD(4,0,"ID",13)
"RTN","XUMFPOST",20,0)
 K ^DD(4,0,"ID",99)
"RTN","XUMFPOST",21,0)
 ;
"RTN","XUMFPOST",22,0)
 ;add mail group to bulletin
"RTN","XUMFPOST",23,0)
 N X,FDA
"RTN","XUMFPOST",24,0)
 S X=$O(^XMB(3.6,"B","XUMF INSTITUTION",0))
"RTN","XUMFPOST",25,0)
 S FDA(3.62,"?+1,"_X_",",.01)="XUMF INSTITUTION"
"RTN","XUMFPOST",26,0)
 D UPDATE^DIE("E","FDA",,"ERROR")
"RTN","XUMFPOST",27,0)
 ;
"RTN","XUMFPOST",28,0)
 Q
"RTN","XUMFPOST",29,0)
 ;
"RTN","XUMFPOST",30,0)
ENV ; -- enivornment check
"RTN","XUMFPOST",31,0)
 ;
"RTN","XUMFPOST",32,0)
 N I
"RTN","XUMFPOST",33,0)
 ;
"RTN","XUMFPOST",34,0)
 ;check STATE (#5) file
"RTN","XUMFPOST",35,0)
 F I=1,2,4,5,6 S:'$D(^DIC(5,+I)) XPDQUIT=2
"RTN","XUMFPOST",36,0)
 F I=8:1:13 S:'$D(^DIC(5,+I)) XPDQUIT=2
"RTN","XUMFPOST",37,0)
 F I=15:1:42 S:'$D(^DIC(5,+I)) XPDQUIT=2
"RTN","XUMFPOST",38,0)
 F I=44:1:51 S:'$D(^DIC(5,+I)) XPDQUIT=2
"RTN","XUMFPOST",39,0)
 F I=53:1:56 S:'$D(^DIC(5,+I)) XPDQUIT=2
"RTN","XUMFPOST",40,0)
 ;
"RTN","XUMFPOST",41,0)
 Q:'$G(XPDQUIT)
"RTN","XUMFPOST",42,0)
 ;
"RTN","XUMFPOST",43,0)
 W !,"Your STATE (#5) file is missing required entries!"
"RTN","XUMFPOST",44,0)
 W !,"You must fix the STATE (#5) file BEFORE installing this patch."
"RTN","XUMFPOST",45,0)
 ;
"RTN","XUMFPOST",46,0)
 Q
"RTN","XUMFPOST",47,0)
 ;
"RTN","XUMFPOST",48,0)
PRE ; -- pre-install
"RTN","XUMFPOST",49,0)
 ;
"RTN","XUMFPOST",50,0)
 N FDA
"RTN","XUMFPOST",51,0)
 ;
"RTN","XUMFPOST",52,0)
 ;guam
"RTN","XUMFPOST",53,0)
 I '$D(^DIC(5,66,0)) D
"RTN","XUMFPOST",54,0)
 .K FDA
"RTN","XUMFPOST",55,0)
 .S FDA(5,"?+66,",.01)="GUAM"
"RTN","XUMFPOST",56,0)
 .S FDA(5,"?+66,",1)="GU"
"RTN","XUMFPOST",57,0)
 .D UPDATE^DIE("E","FDA")
"RTN","XUMFPOST",58,0)
 ;puerto rico
"RTN","XUMFPOST",59,0)
 I '$D(^DIC(5,72,0)) D
"RTN","XUMFPOST",60,0)
 .K FDA
"RTN","XUMFPOST",61,0)
 .S FDA(5,"?+72,",.01)="PUERTO RICO"
"RTN","XUMFPOST",62,0)
 .S FDA(5,"?+72,",1)="PR"
"RTN","XUMFPOST",63,0)
 .D UPDATE^DIE("E","FDA")
"RTN","XUMFPOST",64,0)
 ;virgin islands
"RTN","XUMFPOST",65,0)
 I '$D(^DIC(5,78,0)) D
"RTN","XUMFPOST",66,0)
 .K FDA
"RTN","XUMFPOST",67,0)
 .S FDA(5,"?+78,",.01)="VIRGIN ISLANDS"
"RTN","XUMFPOST",68,0)
 .S FDA(5,"?+78,",1)="VI"
"RTN","XUMFPOST",69,0)
 .D UPDATE^DIE("E","FDA")
"RTN","XUMFPOST",70,0)
 ;philippines
"RTN","XUMFPOST",71,0)
 I '$D(^DIC(5,96,0)) D
"RTN","XUMFPOST",72,0)
 .K FDA
"RTN","XUMFPOST",73,0)
 .S FDA(5,"?+96,",.01)="PHILIPPINES"
"RTN","XUMFPOST",74,0)
 .S FDA(5,"?+96,",1)="PH"
"RTN","XUMFPOST",75,0)
 .D UPDATE^DIE("E","FDA")
"RTN","XUMFPOST",76,0)
 ;
"RTN","XUMFPOST",77,0)
 Q
"RTN","XUMFPOST",78,0)
 ;
"VER")
8.0^22.0
"^DD",4,4,0)
FIELD^NL^999.1^25
"^DD",4,4,0,0)
^4I
"^DD",4,4,0,"DDA")
N
"^DD",4,4,0,"DT")
3010111
"^DD",4,4,0,"ID","W1")
D EN^DDIOL($P($G(^DIC(5,+$P($G(^(0)),U,2),0)),U,2),,"?31")
"^DD",4,4,0,"ID","W2")
D EN^DDIOL($P($G(^DIC(4.1,+$G(^DIC(4,+Y,3)),0)),U),,"?35")
"^DD",4,4,0,"ID","W3")
D EN^DDIOL($P($G(^DIC(4,+Y,99)),U),,"?45")
"^DD",4,4,0,"ID","W4")
D:$P($G(^DIC(4,+Y,99)),U,4) EN^DDIOL("INACTIVE "_$$FMTE^XLFDT($$IDT^XUAF4(+Y),"D"),,"?54")
"^DD",4,4,0,"IX","AC",4.014,1)

"^DD",4,4,0,"IX","AD",4,.01)

"^DD",4,4,0,"IX","AI",4.999,.07)

"^DD",4,4,0,"IX","AP1",4,.01)

"^DD",4,4,0,"IX","ARF",4.999,.06)

"^DD",4,4,0,"IX","ARFM",4.999,.06)

"^DD",4,4,0,"IX","ART",4.999,.05)

"^DD",4,4,0,"IX","ARTO",4.999,.05)

"^DD",4,4,0,"IX","B",4,.01)

"^DD",4,4,0,"IX","C",4,100)

"^DD",4,4,0,"IX","D",4,99)

"^DD",4,4,0,"IX","LOC1",4,720)

"^DD",4,4,0,"IX","OLDNAM",4.999,.02)

"^DD",4,4,0,"IX","XUMF",4,11)

"^DD",4,4,0,"NM","INSTITUTION")

"^DD",4,4,0,"PT",2,.2911)

"^DD",4,4,0,"PT",2,.314)

"^DD",4,4,0,"PT",2,.393)

"^DD",4,4,0,"PT",2,21)

"^DD",4,4,0,"PT",2,27.02)

"^DD",4,4,0,"PT",2,33)

"^DD",4,4,0,"PT",2,991.03)

"^DD",4,4,0,"PT",2,1010.152)

"^DD",4,4,0,"PT",2,1010.154)

"^DD",4,4,0,"PT",2.07,9)

"^DD",4,4,0,"PT",2.0992,2)

"^DD",4,4,0,"PT",2.399,.393)

"^DD",4,4,0,"PT",4,96)

"^DD",4,4,0,"PT",4.014,1)

"^DD",4,4,0,"PT",4.3,217)

"^DD",4,4,0,"PT",4.999,.05)

"^DD",4,4,0,"PT",4.999,.06)

"^DD",4,4,0,"PT",9.4,11.5)

"^DD",4,4,0,"PT",9.4,11.6)

"^DD",4,4,0,"PT",9.409,.01)

"^DD",4,4,0,"PT",27.11,.06)

"^DD",4,4,0,"PT",40.8,.07)

"^DD",4,4,0,"PT",44,3)

"^DD",4,4,0,"PT",45.87,.1)

"^DD",4,4,0,"PT",59,100)

"^DD",4,4,0,"PT",59.4,1)

"^DD",4,4,0,"PT",60.11,.01)

"^DD",4,4,0,"PT",62.9,.02)

"^DD",4,4,0,"PT",62.9,.03)

"^DD",4,4,0,"PT",62.9,.031)

"^DD",4,4,0,"PT",62.9,.06)

"^DD",4,4,0,"PT",63.04,.111)

"^DD",4,4,0,"PT",63.04,.32)

"^DD",4,4,0,"PT",63.04,.33)

"^DD",4,4,0,"PT",64.03,4)

"^DD",4,4,0,"PT",64.06,.01)

"^DD",4,4,0,"PT",64.1,.01)

"^DD",4,4,0,"PT",65,.16)

"^DD",4,4,0,"PT",65.31,.03)

"^DD",4,4,0,"PT",66.1,.01)

"^DD",4,4,0,"PT",67.9,.01)

"^DD",4,4,0,"PT",67.901,.01)

"^DD",4,4,0,"PT",68.02,16.1)

"^DD",4,4,0,"PT",68.02,16.2)

"^DD",4,4,0,"PT",68.02,26)

"^DD",4,4,0,"PT",68.03,.01)

"^DD",4,4,0,"PT",68.14,3)

"^DD",4,4,0,"PT",69.01,25)

"^DD",4,4,0,"PT",69.03,14)

"^DD",4,4,0,"PT",69.03,15)

"^DD",4,4,0,"PT",69.6,1)

"^DD",4,4,0,"PT",69.6,2)

"^DD",4,4,0,"PT",69.9,3)

"^DD",4,4,0,"PT",69.9001,3)

"^DD",4,4,0,"PT",69.9006,.01)

"^DD",4,4,0,"PT",69.9007,.01)

"^DD",4,4,0,"PT",69.981,.01)

"^DD",4,4,0,"PT",79,.01)

"^DD",4,4,0,"PT",120.846,.01)

"^DD",4,4,0,"PT",123.9,.01)

"^DD",4,4,0,"PT",130,50)

"^DD",4,4,0,"PT",133,.01)

"^DD",4,4,0,"PT",154,3.2)

"^DD",4,4,0,"PT",154,3.3)

"^DD",4,4,0,"PT",154,3.4)

"^DD",4,4,0,"PT",154,8.4)

"^DD",4,4,0,"PT",154.1,2.11)

"^DD",4,4,0,"PT",154.1,2.12)

"^DD",4,4,0,"PT",158,15.6)

"^DD",4,4,0,"PT",158.9,.01)

"^DD",4,4,0,"PT",160.05,1)

"^DD",4,4,0,"PT",161.01,101)

"^DD",4,4,0,"PT",161.4,27)

"^DD",4,4,0,"PT",162.03,26)

"^DD",4,4,0,"PT",162.11,25)

"^DD",4,4,0,"PT",162.5,23)

"^DD",4,4,0,"PT",162.7,6)

"^DD",4,4,0,"PT",165,99)

"^DD",4,4,0,"PT",190.1,12)

"^DD",4,4,0,"PT",194.2,12)

"^DD",4,4,0,"PT",195.12,.01)

"^DD",4,4,0,"PT",195.9,.01)

"^DD",4,4,0,"PT",200.02,.01)

"^DD",4,4,0,"PT",213.2,.01)

"^DD",4,4,0,"PT",340,.01)

"^DD",4,4,0,"PT",341,.09)

"^DD",4,4,0,"PT",342,.01)

"^DD",4,4,0,"PT",350,.13)

"^DD",4,4,0,"PT",350.9,.02)

"^DD",4,4,0,"PT",389.9,.07)

"^DD",4,4,0,"PT",391.91,.02)

"^DD",4,4,0,"PT",394.2,4)

"^DD",4,4,0,"PT",394.26,.01)

"^DD",4,4,0,"PT",394.81,.01)

"^DD",4,4,0,"PT",394.82,.01)

"^DD",4,4,0,"PT",394.831,.01)

"^DD",4,4,0,"PT",396.12,.01)

"^DD",4,4,0,"PT",396.3,2)

"^DD",4,4,0,"PT",399,111)

"^DD",4,4,0,"PT",404.51,.07)

"^DD",4,4,0,"PT",404.9503,.01)

"^DD",4,4,0,"PT",405,.05)

"^DD",4,4,0,"PT",408,3)

"^DD",4,4,0,"PT",411,.1)

"^DD",4,4,0,"PT",412,.01)

"^DD",4,4,0,"PT",430,12)

"^DD",4,4,0,"PT",604.8,.01)

"^DD",4,4,0,"PT",631.9,4)

"^DD",4,4,0,"PT",660,8)

"^DD",4,4,0,"PT",660,40)

"^DD",4,4,0,"PT",660,70)

"^DD",4,4,0,"PT",660.1,14)

"^DD",4,4,0,"PT",663.4,4)

"^DD",4,4,0,"PT",664,18)

"^DD",4,4,0,"PT",664.1,.03)

"^DD",4,4,0,"PT",664.1,.04)

"^DD",4,4,0,"PT",664.1,.11)

"^DD",4,4,0,"PT",664.2,1.5)

"^DD",4,4,0,"PT",664.2,6)

"^DD",4,4,0,"PT",664.3,2)

"^DD",4,4,0,"PT",664.4,2)

"^DD",4,4,0,"PT",664.4,14)

"^DD",4,4,0,"PT",665,2)

"^DD",4,4,0,"PT",665.1,1)

"^DD",4,4,0,"PT",665.1,6)

"^DD",4,4,0,"PT",665.4,6)

"^DD",4,4,0,"PT",667,11)

"^DD",4,4,0,"PT",667.3,12)

"^DD",4,4,0,"PT",668,2)

"^DD",4,4,0,"PT",669.9,1)

"^DD",4,4,0,"PT",680.6,.04)

"^DD",4,4,0,"PT",688,1)

"^DD",4,4,0,"PT",694.5,2)

"^DD",4,4,0,"PT",698,7)

"^DD",4,4,0,"PT",721,3)

"^DD",4,4,0,"PT",740,.01)

"^DD",4,4,0,"PT",742.6,.01)

"^DD",4,4,0,"PT",747.13,.01)

"^DD",4,4,0,"PT",748.09,.01)

"^DD",4,4,0,"PT",748.3,.02)

"^DD",4,4,0,"PT",785,2)

"^DD",4,4,0,"PT",785.5,2)

"^DD",4,4,0,"PT",839.7,.04)

"^DD",4,4,0,"PT",850,3)

"^DD",4,4,0,"PT",850,16)

"^DD",4,4,0,"PT",869.3,.04)

"^DD",4,4,0,"PT",870,.02)

"^DD",4,4,0,"PT",912,5.01)

"^DD",4,4,0,"PT",914,5.01)

"^DD",4,4,0,"PT",984.9,.07)

"^DD",4,4,0,"PT",1020.1,8)

"^DD",4,4,0,"PT",1020.2,1)

"^DD",4,4,0,"PT",1020.5,.01)

"^DD",4,4,0,"PT",1020.8,.01)

"^DD",4,4,0,"PT",2101.7,.01)

"^DD",4,4,0,"PT",6925,3)

"^DD",4,4,0,"PT",6925,15.3)

"^DD",4,4,0,"PT",7105.07,1)

"^DD",4,4,0,"PT",8925.99,.01)

"^DD",4,4,0,"PT",8986.095,.01)

"^DD",4,4,0,"PT",8989.3,217)

"^DD",4,4,0,"PT",503338,.01)

"^DD",4,4,0,"PT",509850.8,.01)

"^DD",4,4,0,"PT",791813,.01)

"^DD",4,4,0,"PT",791813,2.01)

"^DD",4,4,0,"PT",9999999.06,.01)

"^DD",4,4,0,"VRPK")
KERNEL
"^DD",4,4,.01,0)
NAME^RRFX^^0;1^K:$L(X)>30!(+X=X)!($L(X)<3)!'(X'?1P.E) X K:($P($G(^DIC(4,+$G(DA),0)),U,11)="N")&'$G(XUMF) X
"^DD",4,4,.01,.1)
INSTITUTION NAME
"^DD",4,4,.01,1,0)
^.1
"^DD",4,4,.01,1,1,0)
4^B
"^DD",4,4,.01,1,1,1)
S ^DIC(4,"B",$E(X,1,30),DA)=""
"^DD",4,4,.01,1,1,2)
K ^DIC(4,"B",$E(X,1,30),DA)
"^DD",4,4,.01,1,2,0)
4^AP1^MUMPS
"^DD",4,4,.01,1,2,1)
F I=0:0 S I=$O(^DIC(4,DA,4,I)) Q:I'>0  S Y(1)=+^(I,0),Y(2)=$S($D(^DIC(9.4,Y(1),0)):^(0),1:"") S:Y(2)]"" ^DIC(4,"AP"_$P(Y(2),U,2),$E(X,1,30),DA)=""
"^DD",4,4,.01,1,2,2)
S Y="AP" F I=0:0 S Y=$O(^DIC(4,Y)) Q:$E(Y,1,2)'="AP"  K ^DIC(4,Y,$E(X,1,30),DA)
"^DD",4,4,.01,1,2,3)
Special Package X-ref
"^DD",4,4,.01,1,2,"DT")
2900103
"^DD",4,4,.01,1,3,0)
4^AD^MUMPS
"^DD",4,4,.01,1,3,1)
I $D(^AUTTLOC(0))#2 N DIC,DD,DO,DINUM,DS S DIC="^AUTTLOC(",DIC(0)="",(X,DINUM)=DA D FILE^DICN
"^DD",4,4,.01,1,3,2)
I $D(^AUTTLOC(0))#2 N DIK S DIK="^AUTTLOC(" D ^DIK
"^DD",4,4,.01,1,3,3)
Needed to keep PCE location file in sync.
"^DD",4,4,.01,1,3,"%D",0)
^^2^2^2980827^
"^DD",4,4,.01,1,3,"%D",1,0)
This MUMPS cross reference is used to keep the PCE location file
"^DD",4,4,.01,1,3,"%D",2,0)
(#9999999.06) synchronized with the Institution file.
"^DD",4,4,.01,1,3,"DT")
2980827
"^DD",4,4,.01,3)
Name must be 3-30 characters -- if national entry, do not edit!
"^DD",4,4,.01,21,0)
^^2^2^2920528^^^^
"^DD",4,4,.01,21,1,0)
This is the name of the institution with out modifiers like state
"^DD",4,4,.01,21,2,0)
or type.
"^DD",4,4,.01,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,.01,"DT")
3010518
"^DD",4,4,.02,0)
STATE^P5'X^DIC(5,^0;2^Q:$G(XUMF)  K:$P($G(^DIC(4,+DA,0)),U,11)="N" X
"^DD",4,4,.02,3)
Enter the state -- if national entry, do not edit!
"^DD",4,4,.02,21,0)
^^1^1^2920528^^^^
"^DD",4,4,.02,21,1,0)
State that the institution is in.
"^DD",4,4,.02,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,.02,"DT")
3010104
"^DD",4,4,.03,0)
DISTRICT^NJ2,0X^^0;3^K:+X'=X!(X>27)!(X<1)!(X?.E1"."1N.N) X
"^DD",4,4,.03,1,0)
^.1^^0
"^DD",4,4,.03,3)
TYPE A WHOLE NUMBER BETWEEN 1 AND 27
"^DD",4,4,.03,21,0)
^^2^2^2920702^
"^DD",4,4,.03,21,1,0)
This is the Medical District of the Institution file.  Therefore it is not
"^DD",4,4,.03,21,2,0)
to be changed except by appropriately knowledgeable individuals.
"^DD",4,4,.03,"DT")
2900409
"^DD",4,4,.05,0)
SHORT NAME^F^^0;5^K:$L(X)>80!($L(X)<4) X
"^DD",4,4,.05,3)
ANSWER MUST BE 4-80 CHARACTERS IN LENGTH
"^DD",4,4,.05,21,0)
^^1^1^2930330^
"^DD",4,4,.05,21,1,0)
Short version of name.
"^DD",4,4,.06,0)
VA TYPE CODE^S^MC:HOSP;DM:DOM;NH:NH;RO:RO;DP:DPC;OI:OC-IND;OM:OC-UNDER MMT;OS:OC-SUB;PC:PROTH;PD:PDC;RP:RPC;CO:VACO;CR:VACO-RO;MCDM:MC&DOM;MCDMNH:MC,DOM,NH;MCNH:MC&NH;MCRO:MC&RO;RODP:RO&DPC;^0;6^Q
"^DD",4,4,.06,21,0)
^^1^1^2920528^^^
"^DD",4,4,.06,21,1,0)
This field is being replaced by the Facitily type field.
"^DD",4,4,.07,0)
REGION^NJ1,0^^0;7^K:+X'=X!(X>7)!(X<1)!(X?.E1"."1N.N) X
"^DD",4,4,.07,1,0)
^.1^^0
"^DD",4,4,.07,3)
TYPE A WHOLE NUMBER BETWEEN 1 AND 7
"^DD",4,4,.07,21,0)
^^1^1^2920528^^^^
"^DD",4,4,.07,21,1,0)
VA region number.
"^DD",4,4,.07,"DT")
2900409
"^DD",4,4,1.01,0)
STREET ADDR. 1^F^^1;1^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,1.01,3)
ANSWER MUST BE 2-40 CHARACTERS IN LENGTH
"^DD",4,4,1.01,21,0)
^^1^1^2920528^^^^
"^DD",4,4,1.01,21,1,0)
First line of street address.
"^DD",4,4,1.01,"DT")
2880329
"^DD",4,4,1.02,0)
STREET ADDR. 2^F^^1;2^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,1.02,3)
ANSWER MUST BE 2-40 CHARACTERS IN LENGTH
"^DD",4,4,1.02,21,0)
^^1^1^2920528^^^^
"^DD",4,4,1.02,21,1,0)
Second line of street address.
"^DD",4,4,1.03,0)
CITY^F^^1;3^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,1.03,3)
ANSWER MUST BE 2-40 CHARACTERS IN LENGTH
"^DD",4,4,1.03,21,0)
^^1^1^2920528^^^^
"^DD",4,4,1.03,21,1,0)
City it is in.
"^DD",4,4,1.04,0)
ZIP^FX^^1;4^K:$L(X)>10!($L(X)<5)!'((X?5N)!(X?5N1"-"4N)) X
"^DD",4,4,1.04,3)
Enter ZIP code or ZIP + 4
"^DD",4,4,1.04,21,0)
^^1^1^2920528^^^^
"^DD",4,4,1.04,21,1,0)
Postal ZIP code.
"^DD",4,4,1.04,"DT")
2890522
"^DD",4,4,4,0)
CONTACT^4.03^^2;0
"^DD",4,4,4,21,0)
^^1^1^2920528^^^^
"^DD",4,4,4,21,1,0)
List of contacts.
"^DD",4,4,5,0)
MULTI-DIVISION FACILITY^S^Y:YES;N:NO;^DIV;1^Q
"^DD",4,4,5,21,0)
^^1^1^2930330^
"^DD",4,4,5,21,1,0)
Flag to indicate this is a multi-division facility.
"^DD",4,4,5,"DT")
3010104
"^DD",4,4,11,0)
STATUS^RSX^N:National;L:Local;^0;11^Q:$G(XUMF)  K:$P($G(^DIC(4,+DA,0)),U,11)="N"!(X["N") X
"^DD",4,4,11,1,0)
^.1
"^DD",4,4,11,1,1,0)
4^XUMF
"^DD",4,4,11,1,1,1)
S ^DIC(4,"XUMF",$E(X,1,30),DA)=""
"^DD",4,4,11,1,1,2)
K ^DIC(4,"XUMF",$E(X,1,30),DA)
"^DD",4,4,11,1,1,"%D",0)
^^2^2^3010524^
"^DD",4,4,11,1,1,"%D",1,0)
This x-ref. is used by the master file server query.  It loops this x-ref to
"^DD",4,4,11,1,1,"%D",2,0)
find all national entries.
"^DD",4,4,11,1,1,"DT")
3000302
"^DD",4,4,11,3)
Local or National -- if national, do not edit!
"^DD",4,4,11,21,0)
^^17^17^3010104^^
"^DD",4,4,11,21,1,0)
An Institution has a STATUS (#11) of either LOCAL or NATIONAL.
"^DD",4,4,11,21,2,0)

"^DD",4,4,11,21,3,0)
Inactive facilities are flagged as such by the field INACTIVE
"^DD",4,4,11,21,4,0)
FACILITY FLAG (#101).
"^DD",4,4,11,21,5,0)

"^DD",4,4,11,21,6,0)
National entries are facilities that have a STATION NUMBER (#99)
"^DD",4,4,11,21,7,0)
approved by Information Management Service (045A4).  National
"^DD",4,4,11,21,8,0)
entries are maintained by the Master File Server located on FORUM.
"^DD",4,4,11,21,9,0)

"^DD",4,4,11,21,10,0)
Local entries are facilities that are entered locally.  Local
"^DD",4,4,11,21,11,0)
entries no not have a STATION NUMBER (#99).  (Only offically
"^DD",4,4,11,21,12,0)
approved station numbers are allowed in the STATION NUMBER (#99)
"^DD",4,4,11,21,13,0)
field.)
"^DD",4,4,11,21,14,0)

"^DD",4,4,11,21,15,0)
All national entries will have a STATUS (#11) of NATIONAL.  Do
"^DD",4,4,11,21,16,0)
not edit the STATUS (#11) of a national entry.  Do not set a LOCAL
"^DD",4,4,11,21,17,0)
entry to a STATUS (#11) of NATIONAL.
"^DD",4,4,11,23,0)
^^17^17^3010104^
"^DD",4,4,11,23,1,0)
An Institution has a STATUS (#11) of either LOCAL or NATIONAL.
"^DD",4,4,11,23,2,0)

"^DD",4,4,11,23,3,0)
Inactive facilities are flagged as such by the field INACTIVE
"^DD",4,4,11,23,4,0)
FACILITY FLAG (#101).
"^DD",4,4,11,23,5,0)

"^DD",4,4,11,23,6,0)
National entries are facilities that have a STATION NUMBER (#99)
"^DD",4,4,11,23,7,0)
approved by Information Management Service (045A4).  National
"^DD",4,4,11,23,8,0)
entries are maintained by the Master File Server located on FORUM.
"^DD",4,4,11,23,9,0)

"^DD",4,4,11,23,10,0)
Local entries are facilities that are entered locally.  Local
"^DD",4,4,11,23,11,0)
entries no not have a STATION NUMBER (#99).  (Only offically
"^DD",4,4,11,23,12,0)
approved station numbers are allowed in the STATION NUMBER (#99)
"^DD",4,4,11,23,13,0)
field.)
"^DD",4,4,11,23,14,0)

"^DD",4,4,11,23,15,0)
All national entries will have a STATUS (#11) of NATIONAL.  Do
"^DD",4,4,11,23,16,0)
not edit the STATUS (#11) of a national entry.  Do not set a LOCAL
"^DD",4,4,11,23,17,0)
entry to a STATUS (#11) of NATIONAL.
"^DD",4,4,11,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,11,"DT")
3010108
"^DD",4,4,13,0)
FACILITY TYPE^P4.1X^DIC(4.1,^3;1^Q:$G(XUMF)  K:$P($G(^DIC(4,+DA,0)),U,11)="N" X
"^DD",4,4,13,3)
Enter Facility Type -- If national entry, do not edit!
"^DD",4,4,13,21,0)
^^1^1^2920706^^
"^DD",4,4,13,21,1,0)
The type of facility. A replacement for the type field.
"^DD",4,4,13,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,13,"DT")
3010104
"^DD",4,4,14,0)
ASSOCIATIONS^4.014P^^7;0
"^DD",4,4,51,0)
ACOS HOSPITAL ID^F^^5;1^K:$L(X)>6!($L(X)<6)!'(X?6N) X
"^DD",4,4,51,.1)
American College of Surgeons Hospital ID
"^DD",4,4,51,3)
Please enter American College of Surgeons 6 digit ID number.
"^DD",4,4,51,21,0)
^^6^6^2920513^^
"^DD",4,4,51,21,1,0)
This field holds the six-digit code assigned to this facility by
"^DD",4,4,51,21,2,0)
the American College of Surgeons (ACOS) Commission on Cancer, the
"^DD",4,4,51,21,3,0)
organization that accredits a hospital's Cancer Program and Tumor
"^DD",4,4,51,21,4,0)
Registry.  A facility will only have an ACOS number if they have
"^DD",4,4,51,21,5,0)
requested a Cancer Program survey from the ACOS (not all facilities
"^DD",4,4,51,21,6,0)
will have a number).
"^DD",4,4,51,"DT")
2900306
"^DD",4,4,60,0)
DOMAIN^P4.2'^DIC(4.2,^6;1^Q
"^DD",4,4,60,3)
This allows a link from the institution file to the domain file.
"^DD",4,4,60,21,0)
^^1^1^2920513^^^
"^DD",4,4,60,21,1,0)
A pointer to the domain so the institution can be linked to a E-mail domain.
"^DD",4,4,60,"DT")
2900516
"^DD",4,4,95,0)
AGENCY CODE^S^V:VA;AF:AIR FORCE;I:IHS;ARMY:ARMY;N:NAVY;O:OTHER;^99;5^Q
"^DD",4,4,95,1,0)
^.1
"^DD",4,4,95,1,1,0)
^^TRIGGER^4^97
"^DD",4,4,95,1,1,1)
K DIV,Y S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DIC(4,D0,99)):^(99),1:""),Y(2)=$P(Y(1),U,5),Y(3)=$P(Y(1),U,7) X ^DD(4,95,1,1,1.1) I X]"" S X=$O(^DIC(4.11,"B",X,0)) X ^DD(4,95,1,1,1.4)
"^DD",4,4,95,1,1,1.1)
S X=DIV S Y(5)=$C(59)_$S($D(^DD(4,95,0)):$P(^(0),U,3),1:""),X=$P($P(Y(5),$C(59)_DIV_":",2),$C(59),1),Y(4)=$S($D(^DIC(4.11,+Y(3),0)):^(0),1:"")
"^DD",4,4,95,1,1,1.4)
I Y(2)'=$P(Y(4),U,2) S DIU=Y(3),DIV=X,$P(^DIC(4,D0,99),U,7)=DIV,DIH=4,DIG=97 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",4,4,95,1,1,2)
Q  K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DIC(4,D0,99)):^(99),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X="" S DIH=$S($D(^DIC(4,DIV(0),99)):^(99),1:""),DIV=X S $P(^(99),U,7)=DIV,DIH=4,DIG=97 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",4,4,95,1,1,3)
Link to keep fields 95 and 97 in sync. (Edited)
"^DD",4,4,95,1,1,"CREATE VALUE")
AGENCY CODE
"^DD",4,4,95,1,1,"DELETE VALUE")
NO EFFECT
"^DD",4,4,95,1,1,"FIELD")
POINTER TO AGENCY
"^DD",4,4,95,3)
What type of instution is this. Other for non-goverment.
"^DD",4,4,95,5,1,0)
4^97^1
"^DD",4,4,95,21,0)
^^2^2^2920513^^^
"^DD",4,4,95,21,1,0)
A code to identify the Government agency that this site belongs to.
"^DD",4,4,95,21,2,0)
This is a duplicate of the POINTER TO AGENCY field.
"^DD",4,4,95,"DT")
2900103
"^DD",4,4,96,0)
REPORTING STATION^*P4'^DIC(4,^99;6^S DIC("S")="I $S($D(^(99)):$P(^(99),U,1)?3N,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",4,4,96,3)
Enter the consolidating reporting station.  (must have a 3 digit station number)
"^DD",4,4,96,12)
Can only select instutions with a 3 numeric station number.
"^DD",4,4,96,12.1)
S DIC("S")="I $S($D(^(99)):$P(^(99),U,1)?3N,1:0)"
"^DD",4,4,96,21,0)
^^2^2^2920513^^^
"^DD",4,4,96,21,1,0)
This is a pointer back to the Institution file that indicates the
"^DD",4,4,96,21,2,0)
site that does the reporting to VACO.
"^DD",4,4,96,"DT")
2890726
"^DD",4,4,97,0)
POINTER TO AGENCY^RP4.11'^DIC(4.11,^99;7^Q
"^DD",4,4,97,1,0)
^.1
"^DD",4,4,97,1,1,0)
^^TRIGGER^4^95
"^DD",4,4,97,1,1,1)
X ^DD(4,97,1,1,1.3) I X,Y(3)]"" S X=Y(3) X ^DD(4,97,1,1,1.4)
"^DD",4,4,97,1,1,1.3)
K DIV,Y S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X X ^DD(4,97,1,1,69.2) S Y(3)=$P(Y(101),U,2),X=(Y(2)'=Y(3)) S D0=I(0,0)
"^DD",4,4,97,1,1,1.4)
S DIH=$S($D(^DIC(4,DIV(0),99)):^(99),1:""),DIV=X,DIU=$P(DIH,U,5) S $P(^(99),U,5)=DIV,DIH=4,DIG=95 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",4,4,97,1,1,2)
Q
"^DD",4,4,97,1,1,3)
Link to keep fields 95 and 97 in sync. (Edited)
"^DD",4,4,97,1,1,69.2)
S I(0,0)=$S($D(D0):D0,1:""),Y(1)=$S($D(^DIC(4,D0,99)):^(99),1:"") S X=$P(Y(1),U,5),X=X S X=X,Y(2)=X,D0=Y(0) S:'$D(^DIC(4.11,+D0,0)) D0=-1 S Y(101)=$S($D(^DIC(4.11,D0,0)):^(0),1:"")
"^DD",4,4,97,1,1,"CREATE CONDITION")
INTERNAL(AGENCY CODE)'=INTERNAL(POINTER TO AGENCY:AGENCY CODE)
"^DD",4,4,97,1,1,"CREATE VALUE")
INTERNAL(POINTER TO AGENCY:AGENCY CODE)
"^DD",4,4,97,1,1,"DELETE VALUE")
NO EFFECT
"^DD",4,4,97,1,1,"DT")
2900103
"^DD",4,4,97,1,1,"FIELD")
AGENCY CODE
"^DD",4,4,97,5,1,0)
4^95^1
"^DD",4,4,97,21,0)
^^2^2^2920513^^^
"^DD",4,4,97,21,1,0)
A pointer to a file that identifies the government agency that
"^DD",4,4,97,21,2,0)
this site belongs to.  Keep in sync with the Agency code field.
"^DD",4,4,97,"DT")
2900103
"^DD",4,4,99,0)
STATION NUMBER^FX^^99;1^K:$L(X)>7!($L(X)<3)!'(X?3N.AN) X Q:$G(XUMF)  K X
"^DD",4,4,99,1,0)
^.1
"^DD",4,4,99,1,1,0)
4^D^MUMPS
"^DD",4,4,99,1,1,1)
S ^DIC(4,"D",$E(X,1,30),DA)=""
"^DD",4,4,99,1,1,2)
K ^DIC(4,"D",$E(X,1,30),DA) S ^DIC(4,"AOLD99",DA,$E(X,1,30))=""
"^DD",4,4,99,1,1,"%D",0)
^^3^3^3010524^
"^DD",4,4,99,1,1,"%D",1,0)
The "AOLD99" x-ref (kill statement 0f "D" x-ref) is used by $$O99^XUAF4 to get
"^DD",4,4,99,1,1,"%D",2,0)
the pointer to the valid entry with station number for duplicate station
"^DD",4,4,99,1,1,"%D",3,0)
numbers resolved by the clean up (patch xu*8.0*126).
"^DD",4,4,99,1,1,"DT")
3000703
"^DD",4,4,99,3)
No local station numbers allowed!
"^DD",4,4,99,20,0)
^.3LA^1^1
"^DD",4,4,99,20,1,0)
RUPP
"^DD",4,4,99,21,0)
^^1^1^2920513^^
"^DD",4,4,99,21,1,0)
This is the 3 digit station number plus any modifiers.
"^DD",4,4,99,"DT")
3010518
"^DD",4,4,100,0)
OFFICIAL VA NAME^FX^^99;3^K:$L(X)>80!($L(X)<2) X K:($P($G(^DIC(4,+$G(DA),0)),U,11)="N")&'$G(XUMF) X
"^DD",4,4,100,1,0)
^.1
"^DD",4,4,100,1,1,0)
4^C
"^DD",4,4,100,1,1,1)
S ^DIC(4,"C",$E(X,1,30),DA)=""
"^DD",4,4,100,1,1,2)
K ^DIC(4,"C",$E(X,1,30),DA)
"^DD",4,4,100,1,1,"DT")
2960828
"^DD",4,4,100,3)
Only national entries should have an official VA name.  If national entry, do not edit!
"^DD",4,4,100,21,0)
^^2^2^2960816^
"^DD",4,4,100,21,1,0)
This field holds the Offical VA name for this VA facility.
"^DD",4,4,100,21,2,0)
The value in this field should not be changed by the site.
"^DD",4,4,100,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,100,"DT")
3010518
"^DD",4,4,101,0)
INACTIVE FACILITY FLAG^SX^1:INACTIVE;^99;4^Q:$G(XUMF)  K:$P($G(^DIC(4,+DA,0)),U,11)="N" X
"^DD",4,4,101,3)
1 flags inactive entry.  If national entry, do not edit!
"^DD",4,4,101,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,101,"DT")
3010104
"^DD",4,4,720,0)
CURRENT LOCATION^S^1:YES;0:NO;^EC;1^Q
"^DD",4,4,720,1,0)
^.1
"^DD",4,4,720,1,1,0)
4^LOC1^MUMPS
"^DD",4,4,720,1,1,1)
I X S ^DIC(4,"LOC",$P(^DIC(4,DA,0),"^"),DA)=""
"^DD",4,4,720,1,1,2)
K ^DIC(4,"LOC",$P(^DIC(4,DA,0),"^"),DA)
"^DD",4,4,720,1,1,"%D",0)
^^1^1^2960507^
"^DD",4,4,720,1,1,"%D",1,0)
Sets and kills the "LOC" nodes.
"^DD",4,4,720,1,1,"DT")
2960507
"^DD",4,4,720,3)
Entering a 1 for YES means ACTIVE, a 0 for NO means INACTIVE.
"^DD",4,4,720,21,0)
^^5^5^2960507^^^
"^DD",4,4,720,21,1,0)
This field flags entries for use in the Event Capture software.
"^DD",4,4,720,21,2,0)
  
"^DD",4,4,720,21,3,0)
       '1'  for   'YES'   (ACTIVE)
"^DD",4,4,720,21,4,0)
  
"^DD",4,4,720,21,5,0)
       '0'  for   'NO'    (INACTIVE)
"^DD",4,4,720,"DT")
2960507
"^DD",4,4,999.1,0)
HISTORY^4.999DA^^999;0
"^DD",4,4.014,0)
ASSOCIATIONS SUB-FIELD^^1^2
"^DD",4,4.014,0,"DT")
2971021
"^DD",4,4.014,0,"IX","B",4.014,.01)

"^DD",4,4.014,0,"NM","ASSOCIATIONS")

"^DD",4,4.014,0,"UP")
4
"^DD",4,4.014,.01,0)
ASSOCIATIONS^P4.05'X^DIC(4.05,^0;1^S DINUM=X
"^DD",4,4.014,.01,1,0)
^.1^^-1
"^DD",4,4.014,.01,1,1,0)
4.014^B
"^DD",4,4.014,.01,1,1,1)
S ^DIC(4,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",4,4.014,.01,1,1,2)
K ^DIC(4,DA(1),7,"B",$E(X,1,30),DA)
"^DD",4,4.014,.01,21,0)
^^2^2^2971021^
"^DD",4,4.014,.01,21,1,0)
This multiple field is used to link groups if Institutions into
"^DD",4,4.014,.01,21,2,0)
associations.
"^DD",4,4.014,.01,"DT")
2971203
"^DD",4,4.014,1,0)
PARENT OF ASSOCIATION^RP4'^DIC(4,^0;2^Q
"^DD",4,4.014,1,1,0)
^.1
"^DD",4,4.014,1,1,1,0)
4^AC^MUMPS
"^DD",4,4.014,1,1,1,1)
S ^DIC(4,"AC",DA,X,DA(1))=""
"^DD",4,4.014,1,1,1,2)
K ^DIC(4,"AC",DA,X,DA(1))
"^DD",4,4.014,1,1,1,3)
This is needed by CIRN
"^DD",4,4.014,1,1,1,"%D",0)
^^2^2^2971021^
"^DD",4,4.014,1,1,1,"%D",1,0)
This X-ref is used to find the children of a patent for an Association
"^DD",4,4.014,1,1,1,"%D",2,0)
type.
"^DD",4,4.014,1,1,1,"DT")
2971021
"^DD",4,4.014,1,21,0)
^^2^2^2971021^^
"^DD",4,4.014,1,21,1,0)
This field points back to the Institution file to indicate the
"^DD",4,4.014,1,21,2,0)
parent of the association.
"^DD",4,4.014,1,"DT")
2971021
"^DD",4,4.03,0)
CONTACT SUB-FIELD^NL^.03^3
"^DD",4,4.03,0,"NM","CONTACT")

"^DD",4,4.03,0,"UP")
4
"^DD",4,4.03,.01,0)
CONTACT^MF^^0;1^K:$L(X)>30!($L(X)<2) X
"^DD",4,4.03,.01,3)
ANSWER MUST BE 2-30 CHARACTERS IN LENGTH
"^DD",4,4.03,.01,21,0)
^^1^1^2920528^^^^
"^DD",4,4.03,.01,21,1,0)
The name of a contact at the site.
"^DD",4,4.03,.02,0)
AREA^P44'^SC(^0;2^Q
"^DD",4,4.03,.02,21,0)
^^1^1^2920528^^^^
"^DD",4,4.03,.02,21,1,0)
Pointer to the part of the site the contact works in.
"^DD",4,4.03,.03,0)
PHONE #^F^^0;3^K:$L(X)>30!($L(X)<2) X
"^DD",4,4.03,.03,3)
ANSWER MUST BE 2-30 CHARACTERS IN LENGTH
"^DD",4,4.03,.03,21,0)
^^1^1^2920528^^^^
"^DD",4,4.03,.03,21,1,0)
Telephone number.
"^DD",4,4.999,0)
HISTORY SUB-FIELD^^.08^7
"^DD",4,4.999,0,"DT")
3000606
"^DD",4,4.999,0,"IX","B",4.999,.01)

"^DD",4,4.999,0,"NM","HISTORY")

"^DD",4,4.999,0,"UP")
4
"^DD",4,4.999,.01,0)
EFFECTIVE DATE^DX^^0;1^S %DT="EX" D ^%DT S X=Y K:X<1 X S DINUM=X
"^DD",4,4.999,.01,1,0)
^.1
"^DD",4,4.999,.01,1,1,0)
4.999^B
"^DD",4,4.999,.01,1,1,1)
S ^DIC(4,DA(1),999,"B",$E(X,1,30),DA)=""
"^DD",4,4.999,.01,1,1,2)
K ^DIC(4,DA(1),999,"B",$E(X,1,30),DA)
"^DD",4,4.999,.01,3)
The effective date of the change.
"^DD",4,4.999,.01,"DT")
3000605
"^DD",4,4.999,.02,0)
NAME (CHANGED FROM)^F^^0;2^K:$L(X)>30!($L(X)<3) X
"^DD",4,4.999,.02,1,0)
^.1
"^DD",4,4.999,.02,1,1,0)
4^OLDNAM
"^DD",4,4.999,.02,1,1,1)
S ^DIC(4,"OLDNAM",$E(X,1,30),DA(1),DA)=""
"^DD",4,4.999,.02,1,1,2)
K ^DIC(4,"OLDNAM",$E(X,1,30),DA(1),DA)
"^DD",4,4.999,.02,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.02,1,1,"%D",1,0)
This x-ref stores the old name.
"^DD",4,4.999,.02,1,1,"DT")
3000721
"^DD",4,4.999,.02,3)
If NAME changed, this field holds old value.
"^DD",4,4.999,.02,"DT")
3000721
"^DD",4,4.999,.03,0)
OFFICAL VA NAME (CHANGED FROM)^F^^0;3^K:$L(X)>80!($L(X)<3) X
"^DD",4,4.999,.03,3)
If OFFICAL VA NAME changed, this field holds old value.
"^DD",4,4.999,.03,"DT")
3000606
"^DD",4,4.999,.05,0)
REALIGNED TO^P4'^DIC(4,^0;5^Q
"^DD",4,4.999,.05,1,0)
^.1
"^DD",4,4.999,.05,1,1,0)
4^ART
"^DD",4,4.999,.05,1,1,1)
S ^DIC(4,"ART",$E(X,1,30),DA(1),DA)=""
"^DD",4,4.999,.05,1,1,2)
K ^DIC(4,"ART",$E(X,1,30),DA(1),DA)
"^DD",4,4.999,.05,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.05,1,1,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.05,1,1,"DT")
3000612
"^DD",4,4.999,.05,1,2,0)
4^ARTO^MUMPS
"^DD",4,4.999,.05,1,2,1)
S ^DIC(4,"ARTO",DA(1),X)=""
"^DD",4,4.999,.05,1,2,2)
K ^DIC(4,"ARTO",DA(1),X)
"^DD",4,4.999,.05,1,2,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.05,1,2,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.05,1,2,"DT")
3000612
"^DD",4,4.999,.05,3)
This field points to the new entry with valid station number.\]
"^DD",4,4.999,.05,"DT")
3000612
"^DD",4,4.999,.06,0)
REALIGNED FROM^P4'^DIC(4,^0;6^Q
"^DD",4,4.999,.06,1,0)
^.1
"^DD",4,4.999,.06,1,1,0)
4^ARF
"^DD",4,4.999,.06,1,1,1)
S ^DIC(4,"ARF",$E(X,1,30),DA(1),DA)=""
"^DD",4,4.999,.06,1,1,2)
K ^DIC(4,"ARF",$E(X,1,30),DA(1),DA)
"^DD",4,4.999,.06,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.06,1,1,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.06,1,1,"DT")
3000612
"^DD",4,4.999,.06,1,2,0)
4^ARFM^MUMPS
"^DD",4,4.999,.06,1,2,1)
S ^DIC(4,"ARFM",DA(1),X)=""
"^DD",4,4.999,.06,1,2,2)
K ^DIC(4,"ARFM",DA(1),X)
"^DD",4,4.999,.06,1,2,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.06,1,2,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.06,1,2,"DT")
3000612
"^DD",4,4.999,.06,3)
This field points to the old entry/sta# for this facility.
"^DD",4,4.999,.06,"DT")
3000612
"^DD",4,4.999,.07,0)
DEACTIVATED FACILITY / STA #^S^1:DEACTIVATED;^0;7^Q
"^DD",4,4.999,.07,1,0)
^.1
"^DD",4,4.999,.07,1,1,0)
4^AI^MUMPS
"^DD",4,4.999,.07,1,1,1)
S ^DIC(4,"AI",DA(1),DA)=""
"^DD",4,4.999,.07,1,1,2)
K ^DIC(4,"AI",DA(1),DA)
"^DD",4,4.999,.07,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.07,1,1,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.07,1,1,"DT")
3000613
"^DD",4,4.999,.07,3)
Flags deactivated facilities and/or station numbers.
"^DD",4,4.999,.07,"DT")
3000613
"^DD",4,4.999,.08,0)
ACTIVATED FACILITY^S^1:ACTIVATED;^0;8^Q
"^DD",4,4.999,.08,3)
Flags activated facilities for EFFECTIVE DATE.
"^DD",4,4.999,.08,"DT")
3000606
"^DD",4.1,4.1,0)
FIELD^^3^4
"^DD",4.1,4.1,0,"DDA")
N
"^DD",4.1,4.1,0,"DT")
3000626
"^DD",4.1,4.1,0,"ID",1)
W "   ",$P(^(0),U,2)
"^DD",4.1,4.1,0,"IX","B",4.1,.01)

"^DD",4.1,4.1,0,"IX","C",4.1,1)

"^DD",4.1,4.1,0,"IX","XUMF",4.1,3)

"^DD",4.1,4.1,0,"NM","FACILITY TYPE")

"^DD",4.1,4.1,0,"PT",4,13)

"^DD",4.1,4.1,0,"VRPK")
KERNEL
"^DD",4.1,4.1,.01,0)
NAME^RF^^0;1^K:$L(X)>11!($L(X)<1)!'(X'?1P.E) X
"^DD",4.1,4.1,.01,.1)
Type Code
"^DD",4.1,4.1,.01,1,0)
^.1
"^DD",4.1,4.1,.01,1,1,0)
4.1^B
"^DD",4.1,4.1,.01,1,1,1)
S ^DIC(4.1,"B",$E(X,1,30),DA)=""
"^DD",4.1,4.1,.01,1,1,2)
K ^DIC(4.1,"B",$E(X,1,30),DA)
"^DD",4.1,4.1,.01,3)
Answer must be 1-11 characters in length.
"^DD",4.1,4.1,.01,21,0)
^^1^1^2980723^^^
"^DD",4.1,4.1,.01,21,1,0)
This is the Facility type code.
"^DD",4.1,4.1,.01,"DT")
2890502
"^DD",4.1,4.1,1,0)
FULL NAME^F^^0;2^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>45!($L(X)<3) X
"^DD",4.1,4.1,1,1,0)
^.1
"^DD",4.1,4.1,1,1,1,0)
4.1^C
"^DD",4.1,4.1,1,1,1,1)
S ^DIC(4.1,"C",$E(X,1,30),DA)=""
"^DD",4.1,4.1,1,1,1,2)
K ^DIC(4.1,"C",$E(X,1,30),DA)
"^DD",4.1,4.1,1,3)
Answer must be 3-45 characters in length.
"^DD",4.1,4.1,1,21,0)
^^1^1^2920518^^
"^DD",4.1,4.1,1,21,1,0)
This is the full name of the facility type code.
"^DD",4.1,4.1,2,0)
TITLE^F^^0;3^K:$L(X)>45!($L(X)<3) X
"^DD",4.1,4.1,2,3)
Answer must be 3-45 characters in length.
"^DD",4.1,4.1,2,21,0)
^^1^1^2920518^^^
"^DD",4.1,4.1,2,21,1,0)
Reserved
"^DD",4.1,4.1,2,"DT")
2890502
"^DD",4.1,4.1,3,0)
STATUS^S^N:NATIONAL;L:LOCAL;^0;4^Q
"^DD",4.1,4.1,3,1,0)
^.1
"^DD",4.1,4.1,3,1,1,0)
4.1^XUMF
"^DD",4.1,4.1,3,1,1,1)
S ^DIC(4.1,"XUMF",$E(X,1,30),DA)=""
"^DD",4.1,4.1,3,1,1,2)
K ^DIC(4.1,"XUMF",$E(X,1,30),DA)
"^DD",4.1,4.1,3,1,1,"DT")
3000626
"^DD",4.1,4.1,3,3)
Local or National -- if national, do not edit!
"^DD",4.1,4.1,3,"DT")
3010104
"^DIC",4,4,0)
INSTITUTION^4I
"^DIC",4,4,0,"GL")
^DIC(4,
"^DIC",4,4,"%",0)
^1.005^2^2
"^DIC",4,4,"%",1,0)
XU
"^DIC",4,4,"%",2,0)
QAP
"^DIC",4,4,"%","B","QAP",2)

"^DIC",4,4,"%","B","XU",1)

"^DIC",4,4,"%D",0)
^^3^3^2950306^^^^
"^DIC",4,4,"%D",1,0)
This file contains a listing of VA institutions.  It is cross-referenced
"^DIC",4,4,"%D",2,0)
by name and station number.  The Number field is no longer meaningful (it
"^DIC",4,4,"%D",3,0)
had previously referenced the station number).
"^DIC",4,"B","INSTITUTION",4)

"^DIC",4.1,4.1,0)
FACILITY TYPE^4.1I
"^DIC",4.1,4.1,0,"GL")
^DIC(4.1,
"^DIC",4.1,4.1,"%",0)
^1.005^1^1
"^DIC",4.1,4.1,"%",1,0)
XU
"^DIC",4.1,4.1,"%","B","XU",1)

"^DIC",4.1,4.1,"%D",0)
^^5^5^2950306^^^
"^DIC",4.1,4.1,"%D",1,0)
This file is pointed to by the Institution File.  It containes a list
"^DIC",4.1,4.1,"%D",2,0)
of facility codes that had previously been stored in the VA Type Code
"^DIC",4.1,4.1,"%D",3,0)
field of the Institution File.  This file is distributed with data,
"^DIC",4.1,4.1,"%D",4,0)
and the new data should overwrite the old. It is cross-referenced by name
"^DIC",4.1,4.1,"%D",5,0)
and full name.
"^DIC",4.1,"B","FACILITY TYPE",4.1)

**END**
**END**
