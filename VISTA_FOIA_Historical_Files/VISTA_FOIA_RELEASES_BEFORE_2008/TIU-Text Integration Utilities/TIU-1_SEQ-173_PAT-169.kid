Released TIU*1*169 SEQ #173
Extracted from mail message
**KIDS**:TIU*1.0*169^

**INSTALL NAME**
TIU*1.0*169
"BLD",4838,0)
TIU*1.0*169^TEXT INTEGRATION UTILITIES^0^3041006^y
"BLD",4838,1,0)
^^2^2^3040728^^^
"BLD",4838,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",4838,1,2,0)
under TIU*1.0*169.
"BLD",4838,4,0)
^9.64PA^^
"BLD",4838,"INID")
n
"BLD",4838,"KRN",0)
^9.67PA^8989.52^19
"BLD",4838,"KRN",.4,0)
.4
"BLD",4838,"KRN",.401,0)
.401
"BLD",4838,"KRN",.402,0)
.402
"BLD",4838,"KRN",.403,0)
.403
"BLD",4838,"KRN",.5,0)
.5
"BLD",4838,"KRN",.84,0)
.84
"BLD",4838,"KRN",3.6,0)
3.6
"BLD",4838,"KRN",3.8,0)
3.8
"BLD",4838,"KRN",9.2,0)
9.2
"BLD",4838,"KRN",9.8,0)
9.8
"BLD",4838,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4838,"KRN",9.8,"NM",1,0)
TIUEN169^^0^B35363158
"BLD",4838,"KRN",9.8,"NM",2,0)
TIUPS169^^0^B51893189
"BLD",4838,"KRN",9.8,"NM",3,0)
TIU169D^^0^B24472489
"BLD",4838,"KRN",9.8,"NM","B","TIU169D",3)

"BLD",4838,"KRN",9.8,"NM","B","TIUEN169",1)

"BLD",4838,"KRN",9.8,"NM","B","TIUPS169",2)

"BLD",4838,"KRN",19,0)
19
"BLD",4838,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",4838,"KRN",19,"NM",1,0)
TIU169 DDEFS, C&P WORKSHEETS^^0
"BLD",4838,"KRN",19,"NM","B","TIU169 DDEFS, C&P WORKSHEETS",1)

"BLD",4838,"KRN",19.1,0)
19.1
"BLD",4838,"KRN",101,0)
101
"BLD",4838,"KRN",409.61,0)
409.61
"BLD",4838,"KRN",771,0)
771
"BLD",4838,"KRN",870,0)
870
"BLD",4838,"KRN",8989.51,0)
8989.51
"BLD",4838,"KRN",8989.52,0)
8989.52
"BLD",4838,"KRN",8994,0)
8994
"BLD",4838,"KRN","B",.4,.4)

"BLD",4838,"KRN","B",.401,.401)

"BLD",4838,"KRN","B",.402,.402)

"BLD",4838,"KRN","B",.403,.403)

"BLD",4838,"KRN","B",.5,.5)

"BLD",4838,"KRN","B",.84,.84)

"BLD",4838,"KRN","B",3.6,3.6)

"BLD",4838,"KRN","B",3.8,3.8)

"BLD",4838,"KRN","B",9.2,9.2)

"BLD",4838,"KRN","B",9.8,9.8)

"BLD",4838,"KRN","B",19,19)

"BLD",4838,"KRN","B",19.1,19.1)

"BLD",4838,"KRN","B",101,101)

"BLD",4838,"KRN","B",409.61,409.61)

"BLD",4838,"KRN","B",771,771)

"BLD",4838,"KRN","B",870,870)

"BLD",4838,"KRN","B",8989.51,8989.51)

"BLD",4838,"KRN","B",8989.52,8989.52)

"BLD",4838,"KRN","B",8994,8994)

"BLD",4838,"PRE")
TIUEN169
"BLD",4838,"QUES",0)
^9.62^^
"BLD",4838,"REQB",0)
^9.611^^0
"KRN",19,9397,-1)
0^1
"KRN",19,9397,0)
TIU169 DDEFS, C&P WORKSHEETS^Create DDEFS for C&P Worksheets^^A^^^^^^^n^TEXT INTEGRATION UTILITIES^^1
"KRN",19,9397,1,0)
^^12^12^3040211^
"KRN",19,9397,1,1,0)
This option creates new Document Definitions (DDEFS) for the C&P Worksheet
"KRN",19,9397,1,2,0)
Module. The option is exported with patch TIU*1*169.  It is this option,
"KRN",19,9397,1,3,0)
not the patch itself, which actually creates the new Document Definitions.
"KRN",19,9397,1,4,0)
 
"KRN",19,9397,1,5,0)
This option must be run after the patch is installed.  When the option has
"KRN",19,9397,1,6,0)
run successfully to the end and messages have indicated that all DDEFS
"KRN",19,9397,1,7,0)
have been created successfully with no problems encountered, the option
"KRN",19,9397,1,8,0)
may be deleted.
"KRN",19,9397,1,9,0)
 
"KRN",19,9397,1,10,0)
This option may be rerun if desired.  However, it will not attempt to
"KRN",19,9397,1,11,0)
recreate entries that were already created successfully the first time the
"KRN",19,9397,1,12,0)
option was run.
"KRN",19,9397,20)
D BEGIN^TIUPS169
"KRN",19,9397,"U")
CREATE DDEFS FOR C&P WORKSHEET
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
169^3041006
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3041006
"PKG",193,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",193,22,1,"PAH",1,1,2,0)
under TIU*1.0*169.
"PRE")
TIUEN169
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","TIU169D")
0^3^B24472489
"RTN","TIU169D",1,0)
TIU169D ; SLC/MAM - Data, etc for Option for TIU*1*169 ; 10/4/2004
"RTN","TIU169D",2,0)
 ;;1.0;Text Integration Utilities;**169**;Jun 20, 1997
"RTN","TIU169D",3,0)
 ;
"RTN","TIU169D",4,0)
ADDITEM(NUM,TIUDA,PIEN)  ; Add DDEF TIUDA to Parent; Return Item IEN
"RTN","TIU169D",5,0)
 N MENUTXT,TIUFPRIV,TIUFISCR
"RTN","TIU169D",6,0)
 N DIE,DR
"RTN","TIU169D",7,0)
 S TIUFPRIV=1
"RTN","TIU169D",8,0)
 N DA,DIC,DLAYGO,X,Y
"RTN","TIU169D",9,0)
 N I,DIY
"RTN","TIU169D",10,0)
 S DA(1)=PIEN
"RTN","TIU169D",11,0)
 S DIC="^TIU(8925.1,"_DA(1)_",10,",DIC(0)="LX"
"RTN","TIU169D",12,0)
 S DLAYGO=8925.14
"RTN","TIU169D",13,0)
 ; -- If TIUDA is say, x, and Parent has x as IFN in Item subfile,
"RTN","TIU169D",14,0)
 ;    code finds item x under parent instead of creating a new item,
"RTN","TIU169D",15,0)
 ;    so don't use "`"_TIUDA:
"RTN","TIU169D",16,0)
 S X=^TMP("TIU169",$J,"BASICS",NUM,"NAME")
"RTN","TIU169D",17,0)
 ; -- Make sure the DDEF it adds is TIUDA and not another w same name:
"RTN","TIU169D",18,0)
 S TIUFISCR=TIUDA ; activates item screen on fld 10, Subfld .01 in DD
"RTN","TIU169D",19,0)
 D ^DIC I Y'>0!($P(Y,U,3)'=1) S ^TMP("TIU169ERR",$J,NUM)="ADDITEM"
"RTN","TIU169D",20,0)
 Q Y
"RTN","TIU169D",21,0)
 ;
"RTN","TIU169D",22,0)
FILEITEM(NUM,PIEN,ITEMDA) ; File Menu Text for DDEF item ITEMDA
"RTN","TIU169D",23,0)
 ;under parent
"RTN","TIU169D",24,0)
 N TIUFPRIV,MENUTXT,ITEMFDA
"RTN","TIU169D",25,0)
 K TIUIERR
"RTN","TIU169D",26,0)
 S TIUFPRIV=1,MENUTXT=$G(^TMP("TIU169",$J,"DATA",NUM,"MENUTXT"))
"RTN","TIU169D",27,0)
 S ITEMFDA(8925.14,ITEMDA_","_PIEN_",",4)=MENUTXT
"RTN","TIU169D",28,0)
 D FILE^DIE("TE","ITEMFDA","TIUIERR")
"RTN","TIU169D",29,0)
 I $D(TIUIERR) S ^TMP("TIU169ERR",$J,NUM)="FILEITEM"
"RTN","TIU169D",30,0)
 Q
"RTN","TIU169D",31,0)
 ;
"RTN","TIU169D",32,0)
DELETE(TIUDA,PIEN,ITEMDA) ; Delete DDEF TIUDA; If parent PIEN and
"RTN","TIU169D",33,0)
 ;Item IEN ITEMDA sent, first delete item from parent
"RTN","TIU169D",34,0)
 N DA,DIK,X,Y,I
"RTN","TIU169D",35,0)
 I $G(PIEN),$G(ITEMDA) D
"RTN","TIU169D",36,0)
 . S DA(1)=PIEN,DA=ITEMDA,DIK="^TIU(8925.1,DA(1),10," D ^DIK
"RTN","TIU169D",37,0)
 N DA,DIK
"RTN","TIU169D",38,0)
 S DA=TIUDA,DIK="^TIU(8925.1," D ^DIK
"RTN","TIU169D",39,0)
 Q
"RTN","TIU169D",40,0)
 ;
"RTN","TIU169D",41,0)
PRINT ; Print out results from message array ^TMP("TIU169MSG",$J
"RTN","TIU169D",42,0)
 N TIUCNT,TIUCONT
"RTN","TIU169D",43,0)
 I $D(ZTQUEUED) S ZTREQ="@" ; Tell TaskMan to delete Task log entry
"RTN","TIU169D",44,0)
 I $E(IOST)="C-" W @IOF,!
"RTN","TIU169D",45,0)
 S TIUCNT="",TIUCONT=1
"RTN","TIU169D",46,0)
 F  S TIUCNT=$O(^TMP("TIU169MSG",$J,TIUCNT)) Q:TIUCNT=""  D  Q:'TIUCONT
"RTN","TIU169D",47,0)
 . S TIUCONT=$$SETCONT Q:'TIUCONT
"RTN","TIU169D",48,0)
 . W ^TMP("TIU169MSG",$J,TIUCNT),!
"RTN","TIU169D",49,0)
PRINTX Q
"RTN","TIU169D",50,0)
 ;
"RTN","TIU169D",51,0)
STOP() ;on screen paging check
"RTN","TIU169D",52,0)
 ; quits TIUCONT=1 if cont. ELSE quits TIUCONT=0
"RTN","TIU169D",53,0)
 N DIR,Y,TIUCONT
"RTN","TIU169D",54,0)
 S DIR(0)="E" D ^DIR
"RTN","TIU169D",55,0)
 S TIUCONT=Y
"RTN","TIU169D",56,0)
 I TIUCONT W @IOF,!
"RTN","TIU169D",57,0)
 Q TIUCONT
"RTN","TIU169D",58,0)
 ;
"RTN","TIU169D",59,0)
SETCONT() ; D form feed, Set TIUCONT
"RTN","TIU169D",60,0)
 N TIUCONT
"RTN","TIU169D",61,0)
 S TIUCONT=1
"RTN","TIU169D",62,0)
 I $E(IOST)="C-" G SETX:$Y+5<IOSL
"RTN","TIU169D",63,0)
 I $E(IOST)="C-" S TIUCONT=$$STOP G SETX
"RTN","TIU169D",64,0)
 G:$Y+8<IOSL SETX
"RTN","TIU169D",65,0)
 W @IOF
"RTN","TIU169D",66,0)
SETX Q TIUCONT
"RTN","TIU169D",67,0)
 ;
"RTN","TIU169D",68,0)
SETDATA ; Set more data for DDEFS
"RTN","TIU169D",69,0)
 ; Basic data set in TIUEN169.  See rtn TIUEN169 for numbered list of
"RTN","TIU169D",70,0)
 ;DDEF Names and Types.
"RTN","TIU169D",71,0)
 ; -- Set Print Name, Owner, Status, National, Exterior Type into
"RTN","TIU169D",72,0)
 ;    FILEDATA node of data array ^TMP("TIU169":
"RTN","TIU169D",73,0)
 ; -- First, set Docmt Class (#1):
"RTN","TIU169D",74,0)
 N NUM S NUM=1 D
"RTN","TIU169D",75,0)
 . S ^TMP("TIU169",$J,"FILEDATA",NUM,.03)=$G(^TMP("TIU169",$J,"BASICS",NUM,"NAME")) ;Name node MUST exist.  Using $G to ease testing of fewer DDEFS.
"RTN","TIU169D",76,0)
 . S ^TMP("TIU169",$J,"FILEDATA",NUM,.06)="CLINICAL COORDINATOR"
"RTN","TIU169D",77,0)
 . S ^TMP("TIU169",$J,"FILEDATA",NUM,.07)="ACTIVE"
"RTN","TIU169D",78,0)
 . S ^TMP("TIU169",$J,"FILEDATA",NUM,.13)="YES"
"RTN","TIU169D",79,0)
 . S ^TMP("TIU169",$J,"FILEDATA",1,.04)="DOCUMENT CLASS"
"RTN","TIU169D",80,0)
 ; -- Set Titles:
"RTN","TIU169D",81,0)
 N NUM F NUM=2:1:58 D
"RTN","TIU169D",82,0)
 . S ^TMP("TIU169",$J,"FILEDATA",NUM,.03)=$G(^TMP("TIU169",$J,"BASICS",NUM,"NAME"))
"RTN","TIU169D",83,0)
 . S ^TMP("TIU169",$J,"FILEDATA",NUM,.06)="CLINICAL COORDINATOR"
"RTN","TIU169D",84,0)
 . S ^TMP("TIU169",$J,"FILEDATA",NUM,.07)="INACTIVE"
"RTN","TIU169D",85,0)
 . S ^TMP("TIU169",$J,"FILEDATA",NUM,.13)="NO"
"RTN","TIU169D",86,0)
 . S ^TMP("TIU169",$J,"FILEDATA",NUM,.04)="TITLE"
"RTN","TIU169D",87,0)
 ; -- Set Parent and Menu Text into DATA nodes of ^TMP("TIU169":
"RTN","TIU169D",88,0)
 ; -- Set PIEN node = IEN of parent if known, or if not,
"RTN","TIU169D",89,0)
 ;    set PNUM node = DDEF# of parent                   
"RTN","TIU169D",90,0)
 ;    Parent must exist by the time this DDEF is created.
"RTN","TIU169D",91,0)
 ; -- Parent of DC is CL Progress Notes:
"RTN","TIU169D",92,0)
 S ^TMP("TIU169",$J,"DATA",1,"PIEN")=3 ;PN IEN is 3
"RTN","TIU169D",93,0)
 ; -- Parent of Titles is DC:
"RTN","TIU169D",94,0)
 N NUM F NUM=2:1:58 S ^TMP("TIU169",$J,"DATA",NUM,"PNUM")=1 ; DC DDEF #
"RTN","TIU169D",95,0)
 ; -- Menutext:
"RTN","TIU169D",96,0)
 F NUM=1:1:58 S ^TMP("TIU169",$J,"DATA",NUM,"MENUTXT")=$P($T(MENUTXT+NUM),";;",2,99)
"RTN","TIU169D",97,0)
 Q
"RTN","TIU169D",98,0)
 ;
"RTN","TIU169D",99,0)
MENUTXT ; Use $T to get menutext from this list. Cut off at 20 chars.
"RTN","TIU169D",100,0)
 ;;C&P Exam Reports
"RTN","TIU169D",101,0)
 ;;Examination
"RTN","TIU169D",102,0)
 ;;Multiple Exam
"RTN","TIU169D",103,0)
 ;;Acromegaly
"RTN","TIU169D",104,0)
 ;;A&A or Housebound
"RTN","TIU169D",105,0)
 ;;Arrhythmias
"RTN","TIU169D",106,0)
 ;;Arteries, Veins, Mis
"RTN","TIU169D",107,0)
 ;;Audio
"RTN","TIU169D",108,0)
 ;;Bones
"RTN","TIU169D",109,0)
 ;;Brain and Spinal Cor
"RTN","TIU169D",110,0)
 ;;Chronic Fatigue Synd
"RTN","TIU169D",111,0)
 ;;Cold Injury Protocol
"RTN","TIU169D",112,0)
 ;;Cranial Nerves
"RTN","TIU169D",113,0)
 ;;Cushing's Syndrome
"RTN","TIU169D",114,0)
 ;;Dental and Oral
"RTN","TIU169D",115,0)
 ;;Diabetes Mellitus
"RTN","TIU169D",116,0)
 ;;Digestive Conditions
"RTN","TIU169D",117,0)
 ;;Ear Disease
"RTN","TIU169D",118,0)
 ;;Eating Disorders
"RTN","TIU169D",119,0)
 ;;Endocrine Diseases
"RTN","TIU169D",120,0)
 ;;Epilepsy and Narcole
"RTN","TIU169D",121,0)
 ;;Esophagus & Hiatal H
"RTN","TIU169D",122,0)
 ;;Eye Examination
"RTN","TIU169D",123,0)
 ;;Feet
"RTN","TIU169D",124,0)
 ;;Fibromyalgia
"RTN","TIU169D",125,0)
 ;;General Medical
"RTN","TIU169D",126,0)
 ;;Genitourinary Exam
"RTN","TIU169D",127,0)
 ;;Gulf War
"RTN","TIU169D",128,0)
 ;;Gynecological Condit
"RTN","TIU169D",129,0)
 ;;Hand, Thumb, & Finge
"RTN","TIU169D",130,0)
 ;;Heart
"RTN","TIU169D",131,0)
 ;;Hemic Disorders
"RTN","TIU169D",132,0)
 ;;HIV-Related Illness
"RTN","TIU169D",133,0)
 ;;Hypertension
"RTN","TIU169D",134,0)
 ;;Infectious, Immune,
"RTN","TIU169D",135,0)
 ;;Intestines
"RTN","TIU169D",136,0)
 ;;Joints
"RTN","TIU169D",137,0)
 ;;Liver, Gall Bladder,
"RTN","TIU169D",138,0)
 ;;Lymphatic Disorders
"RTN","TIU169D",139,0)
 ;;Mental Disorders
"RTN","TIU169D",140,0)
 ;;Mouth, Lips, and Ton
"RTN","TIU169D",141,0)
 ;;Muscles
"RTN","TIU169D",142,0)
 ;;Neurological Disorde
"RTN","TIU169D",143,0)
 ;;Nose, Sinus, Larynx,
"RTN","TIU169D",144,0)
 ;;Peripheral Nerves
"RTN","TIU169D",145,0)
 ;;POW Protocol
"RTN","TIU169D",146,0)
 ;;PTSD, Initial
"RTN","TIU169D",147,0)
 ;;PTSD, Review
"RTN","TIU169D",148,0)
 ;;Pulmonary Tuberculos
"RTN","TIU169D",149,0)
 ;;Rectum and Anus
"RTN","TIU169D",150,0)
 ;;Residuals of Amputat
"RTN","TIU169D",151,0)
 ;;Respiratory
"RTN","TIU169D",152,0)
 ;;Scars
"RTN","TIU169D",153,0)
 ;;Sense of Smell and T
"RTN","TIU169D",154,0)
 ;;Skin Diseases
"RTN","TIU169D",155,0)
 ;;Spine
"RTN","TIU169D",156,0)
 ;;Stomach, Duodenum, P
"RTN","TIU169D",157,0)
 ;;Thyroid and Parathyr
"RTN","TIU169D",158,0)
 Q
"RTN","TIU169D",159,0)
 ;
"RTN","TIUEN169")
0^1^B35363158
"RTN","TIUEN169",1,0)
TIUEN169 ; SLC/MAM - Environment Check Rtn for TIU*1*169 ; 7/28/2004
"RTN","TIUEN169",2,0)
 ;;1.0;Text Integration Utilities;**169**;Jun 20, 1997
"RTN","TIUEN169",3,0)
 ; External References
"RTN","TIUEN169",4,0)
 ;   DBIA 3409  ^USR(8930,"B"
"RTN","TIUEN169",5,0)
MAIN ; Check environment.  If problems found, warn but do not abort install.
"RTN","TIUEN169",6,0)
 ; -- Check if done:
"RTN","TIUEN169",7,0)
 I $G(^XTMP("TIU169","DONE"))="ALL" W !,"All Document Definitions for C&P Worksheets have already been",!," created. You won't need to rerun the option." Q
"RTN","TIUEN169",8,0)
 I $O(^USR(8930,"B","CLINICAL COORDINATOR",""))="" W !,"I can't find User Class CLINICAL COORDINATOR. You won't be able to run",!,"the option that creates the Document Definitions without this class. See",!,"patch description.",!
"RTN","TIUEN169",9,0)
 W !,"Remember to run option TIU169 DDEFS, C&P WORKSHEETS",!,"after installing the patch."
"RTN","TIUEN169",10,0)
 Q
"RTN","TIUEN169",11,0)
 ;
"RTN","TIUEN169",12,0)
SETBASIC ; Set up basic data in ^TMP("TIU169",$J,"BASICS")
"RTN","TIUEN169",13,0)
 N NUMBER
"RTN","TIUEN169",14,0)
 ; -- Set ^TMP("TIU169",$J,"BASICS",[NUMBER],["INTTYPE" or "NAME"])
"RTN","TIUEN169",15,0)
 ; -- Set basic data NAME and interior TYPE for new DDEFS into TMP.
"RTN","TIUEN169",16,0)
 ;    Reference DDEFS by NUMBER.
"RTN","TIUEN169",17,0)
 ;    Number parent-to-be BEFORE child.
"RTN","TIUEN169",18,0)
 ;    Name MUST be upper case or ADDITEM fails
"RTN","TIUEN169",19,0)
 S ^TMP("TIU169",$J,"BASICS",1,"INTTYPE")="DC"
"RTN","TIUEN169",20,0)
 F NUMBER=2:1:58 S ^TMP("TIU169",$J,"BASICS",NUMBER,"INTTYPE")="DOC"
"RTN","TIUEN169",21,0)
 F NUMBER=1:1:58 S ^TMP("TIU169",$J,"BASICS",NUMBER,"NAME")=$P($T(NAME+NUMBER),";;",2,99)
"RTN","TIUEN169",22,0)
 Q
"RTN","TIUEN169",23,0)
 ;
"RTN","TIUEN169",24,0)
TIUDUPS(TIUDUPS,TIUDCDA) ; Set array TIUDUPS of potential duplicate DDEFS
"RTN","TIUEN169",25,0)
 ; TIUDCDA = IEN of designated DC or 0 if none desig.
"RTN","TIUEN169",26,0)
 ; Checks for Titles;
"RTN","TIUEN169",27,0)
 ; If no DC designated, checks for DC too.
"RTN","TIUEN169",28,0)
 N NUM
"RTN","TIUEN169",29,0)
 S (TIUDUPS("INDC"),TIUDUPS("NOTINDC"))=0
"RTN","TIUEN169",30,0)
 I $G(^XTMP("TIU169","DONE"))="ALL" Q
"RTN","TIUEN169",31,0)
 F NUM=1:1:58 Q:'NUM  D
"RTN","TIUEN169",32,0)
 . ; -- When looking for duplicates, ignore DDEF if
"RTN","TIUEN169",33,0)
 . ;    previously created, designated,or skipped by this patch:
"RTN","TIUEN169",34,0)
 . I $G(^XTMP("TIU169",NUM,"DONE")) Q
"RTN","TIUEN169",35,0)
 . ; -- If site already has DDEF w/ same Name & Type as one
"RTN","TIUEN169",36,0)
 . ;    we are exporting, set its number into array TIUDUPS:
"RTN","TIUEN169",37,0)
 . N NAME,TYPE,TIUDA S TIUDA=0
"RTN","TIUEN169",38,0)
 . S NAME=^TMP("TIU169",$J,"BASICS",NUM,"NAME")
"RTN","TIUEN169",39,0)
 . S TYPE=^TMP("TIU169",$J,"BASICS",NUM,"INTTYPE")
"RTN","TIUEN169",40,0)
 . F  S TIUDA=$O(^TIU(8925.1,"B",NAME,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUEN169",41,0)
 . . Q:$P($G(^TIU(8925.1,+TIUDA,0)),U,4)'=TYPE
"RTN","TIUEN169",42,0)
 . . I $$ISA^TIULX(+TIUDA,TIUDCDA) S TIUDUPS("INDC",NUM)=+TIUDA,TIUDUPS("INDC")=TIUDUPS("INDC")+1 I 1
"RTN","TIUEN169",43,0)
 . . E  I TIUDA'=+DESDC S TIUDUPS("NOTINDC",NUM)=+TIUDA,TIUDUPS("NOTINDC")=TIUDUPS("NOTINDC")+1
"RTN","TIUEN169",44,0)
 Q
"RTN","TIUEN169",45,0)
 ;
"RTN","TIUEN169",46,0)
LISTDUPS(TIUDUPS,INDCFLG) ; List duplicates by name
"RTN","TIUEN169",47,0)
 ; TIUDUPS = array as set in TIUDUPS. Required.
"RTN","TIUEN169",48,0)
 ; INDCFLG = 1: List dups in designated DC for skipping over
"RTN","TIUEN169",49,0)
 ; INDCFLG '= 1: List dups not in designated DC - Quit
"RTN","TIUEN169",50,0)
 N NUM,SUBSCPT,TIUCNT
"RTN","TIUEN169",51,0)
 I '$G(INDCFLG),$G(TIUDUPS("NOTINDC",1)) D  Q
"RTN","TIUEN169",52,0)
 . W !!,"You already have the Document Class exported by this patch, C&P EXAMINATION"
"RTN","TIUEN169",53,0)
 . W !,"REPORTS. Please designate it or change its name (and print name)."
"RTN","TIUEN169",54,0)
 I '$G(INDCFLG),$G(TIUDUPS("NOTINDC")) D
"RTN","TIUEN169",55,0)
 . S SUBSCPT="NOTINDC"
"RTN","TIUEN169",56,0)
 . W !!,"You already have the following DDEFS exported by this patch. I cannot create"
"RTN","TIUEN169",57,0)
 . W !,"duplicates. Please change their names so they no longer match exported DDEFS,"
"RTN","TIUEN169",58,0)
 . W !,"or if you are not using them, delete them. If you change the name of a DDEF"
"RTN","TIUEN169",59,0)
 . W !,"you plan to continue using, remember to update its Print Name as well."
"RTN","TIUEN169",60,0)
 . W !,"For help, contact Enterprise VistA Support."
"RTN","TIUEN169",61,0)
 . W !!,"You may not run this option until these matches are eliminated."
"RTN","TIUEN169",62,0)
 I $G(INDCFLG),$G(TIUDUPS("INDC")) D
"RTN","TIUEN169",63,0)
 . S SUBSCPT="INDC"
"RTN","TIUEN169",64,0)
 . W !!,"Your designated C&P Document Class already has matching Titles:"
"RTN","TIUEN169",65,0)
 Q:'$D(SUBSCPT)
"RTN","TIUEN169",66,0)
 S NUM=0
"RTN","TIUEN169",67,0)
 F TIUCNT=1:1:10 S NUM=$O(TIUDUPS(SUBSCPT,NUM)) Q:'NUM  D
"RTN","TIUEN169",68,0)
 . W !,"     "_^TMP("TIU169",$J,"BASICS",NUM,"NAME")
"RTN","TIUEN169",69,0)
 I TIUDUPS(SUBSCPT)>8 W !,"... and more; ",TIUDUPS(SUBSCPT)," in all."
"RTN","TIUEN169",70,0)
 Q
"RTN","TIUEN169",71,0)
 ;
"RTN","TIUEN169",72,0)
DESGNATE() ; Get Designated DC to create C&P titles under
"RTN","TIUEN169",73,0)
 ; Returns:
"RTN","TIUEN169",74,0)
 ; -1 - timeout, ^, lookup failed
"RTN","TIUEN169",75,0)
 ;  0 - none designated; create new DC
"RTN","TIUEN169",76,0)
 ;  DCIFN^DCNAME in 8925.1 - designated DC
"RTN","TIUEN169",77,0)
 N TIUY,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","TIUEN169",78,0)
 W !,"I can create a new C&P Document Class or you can designate an existing one."
"RTN","TIUEN169",79,0)
 W !,"If you designate an existing one, I will change its name to C&P EXAMINATION REPORTS. I will create the new C&P Titles under it, skipping any you already have."
"RTN","TIUEN169",80,0)
 S TIUY=$$READ^TIUU("YO","Do you want to designate a Document Class","YES")
"RTN","TIUEN169",81,0)
 I $D(DIRUT) Q -1
"RTN","TIUEN169",82,0)
 I +TIUY'=1 Q 0
"RTN","TIUEN169",83,0)
 N Y,DIC,DTOUT,DUOUT
"RTN","TIUEN169",84,0)
 S DIC=8925.1,DIC(0)="ABEFQ",DIC("S")="I $P(^(0),U,4)=""DC"",$D(^TIU(8925.1,3,10,""B"",Y))"
"RTN","TIUEN169",85,0)
 D ^DIC
"RTN","TIUEN169",86,0)
 Q Y
"RTN","TIUEN169",87,0)
 ;
"RTN","TIUEN169",88,0)
NAME ; Names of DDEFS in order from 1 to 58
"RTN","TIUEN169",89,0)
 ;;C&P EXAMINATION REPORTS
"RTN","TIUEN169",90,0)
 ;;C&P EXAMINATION
"RTN","TIUEN169",91,0)
 ;;C&P MULTIPLE EXAM
"RTN","TIUEN169",92,0)
 ;;C&P ACROMEGALY
"RTN","TIUEN169",93,0)
 ;;C&P AID AND ATTENDANCE OR HOUSEBOUND EXAM
"RTN","TIUEN169",94,0)
 ;;C&P ARRHYTHMIAS
"RTN","TIUEN169",95,0)
 ;;C&P ARTERIES, VEINS AND MISC
"RTN","TIUEN169",96,0)
 ;;C&P AUDIO
"RTN","TIUEN169",97,0)
 ;;C&P BONES
"RTN","TIUEN169",98,0)
 ;;C&P BRAIN AND SPINAL CORD
"RTN","TIUEN169",99,0)
 ;;C&P CHRONIC FATIGUE SYNDROME
"RTN","TIUEN169",100,0)
 ;;C&P COLD INJURY PROTOCOL
"RTN","TIUEN169",101,0)
 ;;C&P CRANIAL NERVES
"RTN","TIUEN169",102,0)
 ;;C&P CUSHING'S SYNDROME
"RTN","TIUEN169",103,0)
 ;;C&P DENTAL AND ORAL
"RTN","TIUEN169",104,0)
 ;;C&P DIABETES MELLITUS
"RTN","TIUEN169",105,0)
 ;;C&P DIGESTIVE CONDITIONS
"RTN","TIUEN169",106,0)
 ;;C&P EAR DISEASE
"RTN","TIUEN169",107,0)
 ;;C&P EATING DISORDERS
"RTN","TIUEN169",108,0)
 ;;C&P ENDOCRINE DISEASES
"RTN","TIUEN169",109,0)
 ;;C&P EPILEPSY AND NARCOLEPSY
"RTN","TIUEN169",110,0)
 ;;C&P ESOPHAGUS AND HIATAL HERNIA
"RTN","TIUEN169",111,0)
 ;;C&P EYE
"RTN","TIUEN169",112,0)
 ;;C&P FEET
"RTN","TIUEN169",113,0)
 ;;C&P FIBROMYALGIA
"RTN","TIUEN169",114,0)
 ;;C&P GENERAL MEDICAL
"RTN","TIUEN169",115,0)
 ;;C&P GENITOURINARY
"RTN","TIUEN169",116,0)
 ;;C&P GULF WAR PROTOCOL
"RTN","TIUEN169",117,0)
 ;;C&P GYNECOLOGICAL CONDITIONS AND DISORDERS OF THE BREAST
"RTN","TIUEN169",118,0)
 ;;C&P HAND, THUMB AND FINGERS
"RTN","TIUEN169",119,0)
 ;;C&P HEART
"RTN","TIUEN169",120,0)
 ;;C&P HEMIC DISORDERS
"RTN","TIUEN169",121,0)
 ;;C&P HIV-RELATED ILLNESS
"RTN","TIUEN169",122,0)
 ;;C&P HYPERTENSION
"RTN","TIUEN169",123,0)
 ;;C&P INFECTIOUS, IMMUNE AND NUTRITIONAL DISABILITIES
"RTN","TIUEN169",124,0)
 ;;C&P INTESTINES
"RTN","TIUEN169",125,0)
 ;;C&P JOINTS (SHOULDER, ELBOW, WRIST, HIP, KNEE, ANKLE)
"RTN","TIUEN169",126,0)
 ;;C&P LIVER, GALL BLADDER, AND PANCREAS
"RTN","TIUEN169",127,0)
 ;;C&P LYMPHATIC DISORDERS
"RTN","TIUEN169",128,0)
 ;;C&P MENTAL DISORDERS
"RTN","TIUEN169",129,0)
 ;;C&P MOUTH, LIPS, AND TONGUE
"RTN","TIUEN169",130,0)
 ;;C&P MUSCLES
"RTN","TIUEN169",131,0)
 ;;C&P NEUROLOGICAL DISORDERS
"RTN","TIUEN169",132,0)
 ;;C&P NOSE, SINUS, LARYNX, AND PHARYNX
"RTN","TIUEN169",133,0)
 ;;C&P PERIPHERAL NERVES
"RTN","TIUEN169",134,0)
 ;;C&P PRISONER OF WAR PROTOCOL
"RTN","TIUEN169",135,0)
 ;;C&P PTSD, INITIAL EVALUATION
"RTN","TIUEN169",136,0)
 ;;C&P PTSD, REVIEW
"RTN","TIUEN169",137,0)
 ;;C&P PULMONARY TUBERCULOSIS AND MYCOBACTERIAL DISEASES
"RTN","TIUEN169",138,0)
 ;;C&P RECTUM AND ANUS
"RTN","TIUEN169",139,0)
 ;;C&P RESIDUALS OF AMPUTATIONS
"RTN","TIUEN169",140,0)
 ;;C&P RESPIRATORY
"RTN","TIUEN169",141,0)
 ;;C&P SCARS
"RTN","TIUEN169",142,0)
 ;;C&P SENSE OF SMELL AND TASTE
"RTN","TIUEN169",143,0)
 ;;C&P SKIN DISEASES
"RTN","TIUEN169",144,0)
 ;;C&P SPINE
"RTN","TIUEN169",145,0)
 ;;C&P STOMACH, DUODENUM, AND PERITONEAL ADHESIONS
"RTN","TIUEN169",146,0)
 ;;C&P THYROID AND PARATHYROID DISEASES
"RTN","TIUEN169",147,0)
 Q
"RTN","TIUPS169")
0^2^B51893189
"RTN","TIUPS169",1,0)
TIUPS169 ; SLC/MAM - After installing TIU*1*169 ; 7/27/2004
"RTN","TIUPS169",2,0)
 ;;1.0;Text Integration Utilities;**169**;Jun 20, 1997
"RTN","TIUPS169",3,0)
 ; Option TIU169 DDEFS, C&P WORKSHEETS. Run after installing patch 169.
"RTN","TIUPS169",4,0)
 ; External References
"RTN","TIUPS169",5,0)
 ;   DBIA 3409  ^USR(8930,"B"
"RTN","TIUPS169",6,0)
BEGIN ; Create DDEFS
"RTN","TIUPS169",7,0)
 N TIUY,DESDC,TIUDUPS,TIUQUIT
"RTN","TIUPS169",8,0)
 W !!,"This option creates Document Definitions (DDEFS) for C&P Worksheets."
"RTN","TIUPS169",9,0)
 W !,"It may take one or two minutes to run.  It will tell you whether or not",!,"it is successful."
"RTN","TIUPS169",10,0)
 ; -- Set ^XTMP deletion date for about 2 years hence:
"RTN","TIUPS169",11,0)
 ;    Set it even if all are already created, in case it's in test
"RTN","TIUPS169",12,0)
 ;      for more than 2 years, so sites can reset it by running option.
"RTN","TIUPS169",13,0)
 S ^XTMP("TIU169",0)=$$FMADD^XLFDT(DT,730)_U_DT_U_"Tracks DDEFS created by Option TIU169 DDEFS, C&P WORKSHEETS"
"RTN","TIUPS169",14,0)
 ; -- Check if ALL done; check for Class Clinical Coord:
"RTN","TIUPS169",15,0)
 I $G(^XTMP("TIU169","DONE"))="ALL" D  Q
"RTN","TIUPS169",16,0)
 . W !,"All C&P Document Definitions have already been created."
"RTN","TIUPS169",17,0)
 I $O(^USR(8930,"B","CLINICAL COORDINATOR",""))="" D  Q
"RTN","TIUPS169",18,0)
 . W !,"I can't find User Class CLINICAL COORDINATOR. Option cannot be run without it."
"RTN","TIUPS169",19,0)
 ; -- Set basic DDEF data into BASICS node of data array ^TMP("TIU169":
"RTN","TIUPS169",20,0)
 D SETBASIC^TIUEN169
"RTN","TIUPS169",21,0)
 ; -- If DC was created or designated on previous run, set DESDC &
"RTN","TIUPS169",22,0)
 ;    check for new dups:
"RTN","TIUPS169",23,0)
 I $G(^XTMP("TIU169",1,"DONE")) D  Q:$G(TIUQUIT)
"RTN","TIUPS169",24,0)
 . S DESDC=^XTMP("TIU169",1,"DONE")
"RTN","TIUPS169",25,0)
 . W !!,"Proceeding with Document Class C&P EXAMINATION REPORTS..."
"RTN","TIUPS169",26,0)
 . D TIUDUPS^TIUEN169(.TIUDUPS,+DESDC)
"RTN","TIUPS169",27,0)
 . I $G(TIUDUPS("NOTINDC")) D LISTDUPS^TIUEN169(.TIUDUPS,0) S TIUQUIT=1 Q
"RTN","TIUPS169",28,0)
 ; -- If DC NOT created or designated on previous run, designate:
"RTN","TIUPS169",29,0)
 I '$G(^XTMP("TIU169",1,"DONE")) D  Q:$G(TIUQUIT)
"RTN","TIUPS169",30,0)
 . S DESDC=$$DESGNATE^TIUEN169
"RTN","TIUPS169",31,0)
 . I +DESDC=-1 W !,"Try later." S TIUQUIT=1 Q
"RTN","TIUPS169",32,0)
 . D TIUDUPS^TIUEN169(.TIUDUPS,+DESDC)
"RTN","TIUPS169",33,0)
 . I +$G(TIUDUPS("NOTINDC")) D LISTDUPS^TIUEN169(.TIUDUPS,0) S TIUQUIT=1 Q
"RTN","TIUPS169",34,0)
 . ; -- User has not designated a DC:
"RTN","TIUPS169",35,0)
 . I +DESDC=0 D  Q:$G(TIUQUIT)
"RTN","TIUPS169",36,0)
 . . S TIUY=$$READ^TIUU("YO","I will create a new Document Class with new Titles under it. OK","YES")
"RTN","TIUPS169",37,0)
 . . I +TIUY'=1 W !,"OK, try again when you're ready." S TIUQUIT=1
"RTN","TIUPS169",38,0)
 . ; -- No matching titles in Des DC:
"RTN","TIUPS169",39,0)
 . I +DESDC>0,'$G(TIUDUPS("INDC")) D  Q:$G(TIUQUIT)
"RTN","TIUPS169",40,0)
 . . S TIUY=$$READ^TIUU("YO","I will create the new Titles under Document Class "_$P(DESDC,U,2)_". OK","YES")
"RTN","TIUPS169",41,0)
 . . I +TIUY'=1 W !,"OK, try again when you're ready." S TIUQUIT=1
"RTN","TIUPS169",42,0)
 . ; -- Matching titles in Des DC:
"RTN","TIUPS169",43,0)
 . I +DESDC>0,+$G(TIUDUPS("INDC")) D  Q:$G(TIUQUIT)
"RTN","TIUPS169",44,0)
 . . D LISTDUPS^TIUEN169(.TIUDUPS,1)
"RTN","TIUPS169",45,0)
 . . S TIUY=$$READ^TIUU("YO","I will create the non-matching Titles under Document Class "_$P(DESDC,U,2)_", and skip the matching Titles. OK","YES")
"RTN","TIUPS169",46,0)
 . . I +TIUY'=1 W !,"OK, try again when you're ready." S TIUQUIT=1
"RTN","TIUPS169",47,0)
 . ; -- If user has designated DC and agreed, change Name & set DONE node:
"RTN","TIUPS169",48,0)
 . I +DESDC>0 D
"RTN","TIUPS169",49,0)
 . . N DCNAME,DA,DIE,DR,X,Y S DCNAME="C&P EXAMINATION REPORTS",DA=+DESDC,DIE=8925.1,DR=".01///^S X=DCNAME" D ^DIE
"RTN","TIUPS169",50,0)
 . . S ^XTMP("TIU169",1,"DONE")=+DESDC
"RTN","TIUPS169",51,0)
 ; -- If DDEFs are being skipped, set their DONE nodes:
"RTN","TIUPS169",52,0)
 N NUM,ALLFLG S ALLFLG=1
"RTN","TIUPS169",53,0)
 F NUM=2:1:58 D
"RTN","TIUPS169",54,0)
  . I '$G(TIUDUPS("INDC",NUM)),'$D(^XTMP("TIU169",NUM,"DONE")) S ALLFLG=0 Q
"RTN","TIUPS169",55,0)
  . I $G(TIUDUPS("INDC",NUM)) S ^XTMP("TIU169",NUM,"DONE")=TIUDUPS("INDC",NUM)
"RTN","TIUPS169",56,0)
 I ALLFLG S ^XTMP("TIU169","DONE")="ALL" D  Q
"RTN","TIUPS169",57,0)
 . W !,"All Document Definitions have already been created."
"RTN","TIUPS169",58,0)
 W ! K IOP N %ZIS S %ZIS="Q" D ^%ZIS
"RTN","TIUPS169",59,0)
 I POP W !,"Nothing created." K POP Q
"RTN","TIUPS169",60,0)
 I $D(IO("Q")) K IO("Q") D  Q
"RTN","TIUPS169",61,0)
 .S ZTRTN="MAIN^TIUPS169"
"RTN","TIUPS169",62,0)
 .S ZTDESC="Create DDEFS for C&P Worksheets - TIU*1*169"
"RTN","TIUPS169",63,0)
 .D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Canceled!")
"RTN","TIUPS169",64,0)
 .K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","TIUPS169",65,0)
 .D HOME^%ZIS
"RTN","TIUPS169",66,0)
 U IO D MAIN,^%ZISC
"RTN","TIUPS169",67,0)
 Q
"RTN","TIUPS169",68,0)
 ;
"RTN","TIUPS169",69,0)
MAIN ; Create DDEFS for C&P
"RTN","TIUPS169",70,0)
 N TMPCNT,TIUSTTS
"RTN","TIUPS169",71,0)
 K ^TMP("TIU169MSG",$J),^TMP("TIU169ERR",$J)
"RTN","TIUPS169",72,0)
 ; -- Begin message array ^TMP("TIU169MSG",$J:
"RTN","TIUPS169",73,0)
 S TMPCNT=0
"RTN","TIUPS169",74,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)="         ***** Document Definitions (DDEFS) for C&P Worksheets *****"
"RTN","TIUPS169",75,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)="Creating the Document Definitions..."
"RTN","TIUPS169",76,0)
 ; -- Set flds for FILE call & item data into nodes FILEDATA & DATA
"RTN","TIUPS169",77,0)
 ;    of array ^TMP("TIU169":
"RTN","TIUPS169",78,0)
 D SETDATA^TIU169D
"RTN","TIUPS169",79,0)
 ; -- Loop through DDEFS to create them:
"RTN","TIUPS169",80,0)
 N NUM
"RTN","TIUPS169",81,0)
 F NUM=1:1:58 D
"RTN","TIUPS169",82,0)
 . N TIUIEN,YDDEF,TIUDA,PIEN,ITEMDA
"RTN","TIUPS169",83,0)
 . ; -- If DDEF was previously created by this option, or is being
"RTN","TIUPS169",84,0)
 . ;    skipped, quit and get next DDEF:
"RTN","TIUPS169",85,0)
 . S TIUIEN=+$G(^XTMP("TIU169",NUM,"DONE")) Q:TIUIEN
"RTN","TIUPS169",86,0)
 . ; -- If not, create new DDEF:
"RTN","TIUPS169",87,0)
 . S YDDEF=$$CREATE(NUM)
"RTN","TIUPS169",88,0)
 . ; -- If DDEF couldn't be created or was found by lookup
"RTN","TIUPS169",89,0)
 . ;    instead of being created, quit and get next DDEF: 
"RTN","TIUPS169",90,0)
 . I $G(^TMP("TIU169ERR",$J,NUM))="CREATE" Q
"RTN","TIUPS169",91,0)
 . S TIUDA=+YDDEF
"RTN","TIUPS169",92,0)
 . ; -- Call FILE to stuff fields from ^TMP("TIU169",$J,"FILEDATA",NUM:
"RTN","TIUPS169",93,0)
 . D FILE(NUM,TIUDA)
"RTN","TIUPS169",94,0)
 . I $G(^TMP("TIU169ERR",$J,NUM))="FILE" D DELETE^TIU169D(TIUDA) Q
"RTN","TIUPS169",95,0)
 . ; -- Add item to parent, stuff item data:
"RTN","TIUPS169",96,0)
 . S PIEN=$$PARENT(NUM)
"RTN","TIUPS169",97,0)
 . I $G(^TMP("TIU169ERR",$J,NUM))="FINDPARENT" D DELETE^TIU169D(TIUDA) Q
"RTN","TIUPS169",98,0)
 . S ITEMDA=+$$ADDITEM^TIU169D(NUM,TIUDA,PIEN)
"RTN","TIUPS169",99,0)
 . I $G(^TMP("TIU169ERR",$J,NUM))="ADDITEM" D DELETE^TIU169D(TIUDA) Q
"RTN","TIUPS169",100,0)
 . D FILEITEM^TIU169D(NUM,PIEN,ITEMDA)
"RTN","TIUPS169",101,0)
 . I $G(^TMP("TIU169ERR",$J,NUM))="FILEITEM" D DELETE^TIU169D(TIUDA,PIEN,ITEMDA) Q
"RTN","TIUPS169",102,0)
 . ; -- DDEF NUM has been created and edited successfully:
"RTN","TIUPS169",103,0)
 . S ^XTMP("TIU169",NUM,"DONE")=TIUDA
"RTN","TIUPS169",104,0)
 . Q
"RTN","TIUPS169",105,0)
 ; -- Add results from CREATE loop to message array:
"RTN","TIUPS169",106,0)
 N NUM S NUM=0
"RTN","TIUPS169",107,0)
 I $O(^TMP("TIU169ERR",$J,NUM))="" D  G MAINX
"RTN","TIUPS169",108,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)="All Document Definitions have now been created successfully."
"RTN","TIUPS169",109,0)
 . S ^XTMP("TIU169","DONE")="ALL"
"RTN","TIUPS169",110,0)
 . ; -- Kill indiv DONE nodes:
"RTN","TIUPS169",111,0)
 . N NUMBER F NUMBER=1:1:58 K ^XTMP("TIU169",NUMBER)
"RTN","TIUPS169",112,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)=""
"RTN","TIUPS169",113,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)="Problems were encountered creating the following Document Definitions:"
"RTN","TIUPS169",114,0)
 F  S NUM=$O(^TMP("TIU169ERR",$J,NUM)) Q:NUM=""  D
"RTN","TIUPS169",115,0)
 . N PROB S PROB=^TMP("TIU169ERR",$J,NUM)
"RTN","TIUPS169",116,0)
 . D
"RTN","TIUPS169",117,0)
 . . I PROB="CREATE" S PROB="Couldn't create DDEF." Q
"RTN","TIUPS169",118,0)
 . . I PROB="FILE" S PROB="Couldn't file fields. DDEF deleted." Q
"RTN","TIUPS169",119,0)
 . . I PROB="FINDPARENT" S PROB="Couldn't find parent. DDEF deleted." Q
"RTN","TIUPS169",120,0)
 . . I PROB="ADDITEM" S PROB="Couldn't add DDEF to parent. DDEF deleted."
"RTN","TIUPS169",121,0)
 . . I PROB="FILEITEM" S PROB="Couldn't file Menu Text. DDEF deleted."
"RTN","TIUPS169",122,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)=$S(NUM=1:"Document Class ",1:"Title ")_^TMP("TIU169",$J,"BASICS",NUM,"NAME")_": "
"RTN","TIUPS169",123,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)="  "_PROB
"RTN","TIUPS169",124,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)=""
"RTN","TIUPS169",125,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)="Please contact Enterprise VistA Support. When problems have been resolved,"
"RTN","TIUPS169",126,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)="come back and rerun the option."
"RTN","TIUPS169",127,0)
MAINX ; Exit
"RTN","TIUPS169",128,0)
 ; -- Leave latest error arrays ^TMP("DIERR",$J) & TIUIERR around until
"RTN","TIUPS169",129,0)
 ;    now in case modules are run separately for debugging:
"RTN","TIUPS169",130,0)
 K TIUIERR,^TMP("DIERR",$J)
"RTN","TIUPS169",131,0)
 ; -- Finish message array ^TMP("TIU169MSG",$J and print it:
"RTN","TIUPS169",132,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)=""
"RTN","TIUPS169",133,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU169MSG",$J,TMPCNT)="                           *************"
"RTN","TIUPS169",134,0)
 D PRINT^TIU169D
"RTN","TIUPS169",135,0)
 K ^TMP("TIU169MSG",$J),^TMP("TIU169ERR",$J),^TMP("TIU169",$J)
"RTN","TIUPS169",136,0)
 Q
"RTN","TIUPS169",137,0)
 ;
"RTN","TIUPS169",138,0)
PARENT(NUM) ; Return IEN of parent new DDEF should be added to
"RTN","TIUPS169",139,0)
 N PIEN,PNUM
"RTN","TIUPS169",140,0)
 ; Parent node has form:
"RTN","TIUPS169",141,0)
 ;   ^TMP("TIU169",$J,"DATA",NUM,PIEN) = IEN of parent if known, or
"RTN","TIUPS169",142,0)
 ;   ^TMP("TIU169",$J,"DATA",NUM,PNUM) = DDEF# of parent if not
"RTN","TIUPS169",143,0)
 S PIEN=$G(^TMP("TIU169",$J,"DATA",NUM,"PIEN"))
"RTN","TIUPS169",144,0)
 ; -- If parent IEN is known, we're done:
"RTN","TIUPS169",145,0)
 I +PIEN G PARENTX
"RTN","TIUPS169",146,0)
 ; -- If not, get DDEF# of parent
"RTN","TIUPS169",147,0)
 S PNUM=+$G(^TMP("TIU169",$J,"DATA",NUM,"PNUM"))
"RTN","TIUPS169",148,0)
 ; -- Get Parent IEN from "DONE" node, which was set
"RTN","TIUPS169",149,0)
 ;    when parent was created:
"RTN","TIUPS169",150,0)
 S PIEN=+$G(^XTMP("TIU169",PNUM,"DONE"))
"RTN","TIUPS169",151,0)
PARENTX I 'PIEN!'$D(^TIU(8925.1,PIEN,0)) D
"RTN","TIUPS169",152,0)
 . S ^TMP("TIU169ERR",$J,NUM)="FINDPARENT"
"RTN","TIUPS169",153,0)
 Q PIEN
"RTN","TIUPS169",154,0)
 ;
"RTN","TIUPS169",155,0)
FILE(NUM,TIUDA) ; File fields for new DDEF TIUDA
"RTN","TIUPS169",156,0)
 ; Files ALL FIELDS set in "FILEDATA" nodes of ^TMP:
"RTN","TIUPS169",157,0)
 ;   ^TMP("TIU169",$J,"FILEDATA",NUM,Field#)
"RTN","TIUPS169",158,0)
 N TIUFPRIV,FDA
"RTN","TIUPS169",159,0)
 K ^TMP("DIERR",$J)
"RTN","TIUPS169",160,0)
 S TIUFPRIV=1
"RTN","TIUPS169",161,0)
 M FDA(8925.1,TIUDA_",")=^TMP("TIU169",$J,"FILEDATA",NUM)
"RTN","TIUPS169",162,0)
 D FILE^DIE("TE","FDA")
"RTN","TIUPS169",163,0)
 I $D(^TMP("DIERR",$J)) S ^TMP("TIU169ERR",$J,NUM)="FILE"
"RTN","TIUPS169",164,0)
 Q
"RTN","TIUPS169",165,0)
 ;
"RTN","TIUPS169",166,0)
CREATE(NUM) ; Create new DDEF entry
"RTN","TIUPS169",167,0)
 N DIC,DLAYGO,DA,X,Y
"RTN","TIUPS169",168,0)
 S DIC="^TIU(8925.1,",DLAYGO=8925.1
"RTN","TIUPS169",169,0)
 S DIC(0)="LX",X=^TMP("TIU169",$J,"BASICS",NUM,"NAME")
"RTN","TIUPS169",170,0)
 S DIC("S")="I $P(^(0),U,4)="_""""_^TMP("TIU169",$J,"BASICS",NUM,"INTTYPE")_""""
"RTN","TIUPS169",171,0)
 D ^DIC
"RTN","TIUPS169",172,0)
 I $P($G(Y),U,3)'=1 S ^TMP("TIU169ERR",$J,NUM)="CREATE"
"RTN","TIUPS169",173,0)
 Q $G(Y)
"VER")
8.0^22.0
**END**
**END**
