Released IVM*2*81 SEQ #68
Extracted from mail message
**KIDS**:IVM*2.0*81^

**INSTALL NAME**
IVM*2.0*81
"BLD",4828,0)
IVM*2.0*81^INCOME VERIFICATION MATCH^0^3030616^y
"BLD",4828,4,0)
^9.64PA^^
"BLD",4828,"KRN",0)
^9.67PA^8989.52^19
"BLD",4828,"KRN",.4,0)
.4
"BLD",4828,"KRN",.401,0)
.401
"BLD",4828,"KRN",.402,0)
.402
"BLD",4828,"KRN",.403,0)
.403
"BLD",4828,"KRN",.5,0)
.5
"BLD",4828,"KRN",.84,0)
.84
"BLD",4828,"KRN",3.6,0)
3.6
"BLD",4828,"KRN",3.8,0)
3.8
"BLD",4828,"KRN",9.2,0)
9.2
"BLD",4828,"KRN",9.8,0)
9.8
"BLD",4828,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4828,"KRN",9.8,"NM",1,0)
IVMPTRN4^^0^B14937636
"BLD",4828,"KRN",9.8,"NM",2,0)
IVMCZMT^^0^B49770491
"BLD",4828,"KRN",9.8,"NM","B","IVMCZMT",2)

"BLD",4828,"KRN",9.8,"NM","B","IVMPTRN4",1)

"BLD",4828,"KRN",19,0)
19
"BLD",4828,"KRN",19.1,0)
19.1
"BLD",4828,"KRN",101,0)
101
"BLD",4828,"KRN",409.61,0)
409.61
"BLD",4828,"KRN",771,0)
771
"BLD",4828,"KRN",870,0)
870
"BLD",4828,"KRN",8989.51,0)
8989.51
"BLD",4828,"KRN",8989.52,0)
8989.52
"BLD",4828,"KRN",8994,0)
8994
"BLD",4828,"KRN","B",.4,.4)

"BLD",4828,"KRN","B",.401,.401)

"BLD",4828,"KRN","B",.402,.402)

"BLD",4828,"KRN","B",.403,.403)

"BLD",4828,"KRN","B",.5,.5)

"BLD",4828,"KRN","B",.84,.84)

"BLD",4828,"KRN","B",3.6,3.6)

"BLD",4828,"KRN","B",3.8,3.8)

"BLD",4828,"KRN","B",9.2,9.2)

"BLD",4828,"KRN","B",9.8,9.8)

"BLD",4828,"KRN","B",19,19)

"BLD",4828,"KRN","B",19.1,19.1)

"BLD",4828,"KRN","B",101,101)

"BLD",4828,"KRN","B",409.61,409.61)

"BLD",4828,"KRN","B",771,771)

"BLD",4828,"KRN","B",870,870)

"BLD",4828,"KRN","B",8989.51,8989.51)

"BLD",4828,"KRN","B",8989.52,8989.52)

"BLD",4828,"KRN","B",8994,8994)

"BLD",4828,"QUES",0)
^9.62^^
"BLD",4828,"REQB",0)
^9.611^3^3
"BLD",4828,"REQB",1,0)
IVM*2.0*66^2
"BLD",4828,"REQB",2,0)
IVM*2.0*58^2
"BLD",4828,"REQB",3,0)
DG*5.3*519^2
"BLD",4828,"REQB","B","DG*5.3*519",3)

"BLD",4828,"REQB","B","IVM*2.0*58",2)

"BLD",4828,"REQB","B","IVM*2.0*66",1)

"MBREQ")
0
"PKG",220,-1)
1^1
"PKG",220,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",220,20,0)
^9.402P^^
"PKG",220,22,0)
^9.49I^1^1
"PKG",220,22,1,0)
2.0^2941021
"PKG",220,22,1,"PAH",1,0)
81^3030616
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IVMCZMT")
0^2^B49770491
"RTN","IVMCZMT",1,0)
IVMCZMT ;ALB/MLI/LD/CKN/TDM - Creation of  HL7 ZMT (means test) segment ; 06/12/2003
"RTN","IVMCZMT",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**17,53,49,58,81**;21-OCT-94
"RTN","IVMCZMT",3,0)
 ;
"RTN","IVMCZMT",4,0)
 ; This routine returns the ZMT segment which contains means test
"RTN","IVMCZMT",5,0)
 ; data for a selected patient. It differs from the standard segment
"RTN","IVMCZMT",6,0)
 ; builder in that it will add default values where needed for
"RTN","IVMCZMT",7,0)
 ; fields added by means test sharing - these fields may not have
"RTN","IVMCZMT",8,0)
 ; values for old tests, though for new tests the values should be there.
"RTN","IVMCZMT",9,0)
 ; 
"RTN","IVMCZMT",10,0)
 ;
"RTN","IVMCZMT",11,0)
 ;
"RTN","IVMCZMT",12,0)
EN(DFN,VAFSTR,VAFMTDT,VAFTYPE,SETID,DELETE,LIMIT) ; Entry point to get ZMT segment
"RTN","IVMCZMT",13,0)
 ;
"RTN","IVMCZMT",14,0)
 ;  Input:
"RTN","IVMCZMT",15,0)
 ;      DFN - as the IEN or corresponding patient in the PATIENT file
"RTN","IVMCZMT",16,0)
 ;   VAFSTR - as string of segment fields needed separated by commas
"RTN","IVMCZMT",17,0)
 ;  VAFMTDT - (optional) as date of desired means test (defaults to latest MT)
"RTN","IVMCZMT",18,0)
 ;  VAFTYPE - (optional) as type of test:  1 - Means Test (default=1)
"RTN","IVMCZMT",19,0)
 ;                                         2 - Copay Test
"RTN","IVMCZMT",20,0)
 ;                                         4 - LTC Copay Exemption Test
"RTN","IVMCZMT",21,0)
 ;  SETID -  (optional) value to use for SEQ 1, the set id field (1 used
"RTN","IVMCZMT",22,0)
 ;            as default if not passed.)
"RTN","IVMCZMT",23,0)
 ;  DELETE - (optional, pass by reference) This array is used to
"RTN","IVMCZMT",24,0)
 ;           indicate whether the segment is being used to notify of the
"RTN","IVMCZMT",25,0)
 ;           the deletion of a means test, pharmacy copay test, or a 
"RTN","IVMCZMT",26,0)
 ;           hardship determinatin.  If a means test or hardship is being
"RTN","IVMCZMT",27,0)
 ;           deleted, then VAFTYPE must equal 1.  If an Rx copay test is
"RTN","IVMCZMT",28,0)
 ;           being deleted, then VAFTYPE must equal 2.  The subscripts
"RTN","IVMCZMT",29,0)
 ;           are as follows:
"RTN","IVMCZMT",30,0)
 ;           DELETE("DATE OF TEST")=<date of test> - indicates
"RTN","IVMCZMT",31,0)
 ;                  the income year of the test that the deletion flags
"RTN","IVMCZMT",32,0)
 ;                  refer to
"RTN","IVMCZMT",33,0)
 ;           DELETE("HARDSHIP") -  if $G(DELETE("HARDSHIP"))=1 then the
"RTN","IVMCZMT",34,0)
 ;                  segment will be created to delete the hardship.
"RTN","IVMCZMT",35,0)
 ;           DELETE("MT") - if $G(DELETE("MT"))=1 then
"RTN","IVMCZMT",36,0)
 ;                  the segment will be created to delete a means test.
"RTN","IVMCZMT",37,0)
 ;           DELETE("RX")= if $G(DELETE("RX"))=1 then
"RTN","IVMCZMT",38,0)
 ;                  the segment will be created to delete a pharmacy
"RTN","IVMCZMT",39,0)
 ;                  copay test.
"RTN","IVMCZMT",40,0)
 ;           DELETE("LTC")= if $G(DELETE("LTC"))=1 then
"RTN","IVMCZMT",41,0)
 ;                  the segment will be created to delete a Long term
"RTN","IVMCZMT",42,0)
 ;                  care copay exemption test.
"RTN","IVMCZMT",43,0)
 ;  LIMIT - (optional) if $G(LIMIT)=1 then this indicates that a test in
"RTN","IVMCZMT",44,0)
 ;           a prior income year than indicated by the VAFMTDT parameter
"RTN","IVMCZMT",45,0)
 ;           should NOT be returned in the ZMT segment
"RTN","IVMCZMT",46,0)
 ;
"RTN","IVMCZMT",47,0)
 ;      ****Also assumes all HL7 variables are defined as returned ****
"RTN","IVMCZMT",48,0)
 ;          by the INIT^HLTRANS call
"RTN","IVMCZMT",49,0)
 ;
"RTN","IVMCZMT",50,0)
 ; Output - string in the form of the DHCP HL7 ZMT segment
"RTN","IVMCZMT",51,0)
 ;
"RTN","IVMCZMT",52,0)
 ;
"RTN","IVMCZMT",53,0)
 N NODE,PRIM,X,Y,VAFY,NODE2,MTIEN
"RTN","IVMCZMT",54,0)
 ;
"RTN","IVMCZMT",55,0)
 I '$G(DFN)!($G(VAFSTR)']"") G QUIT
"RTN","IVMCZMT",56,0)
 S $P(VAFY,HLFS,22)="",VAFSTR=","_VAFSTR_","
"RTN","IVMCZMT",57,0)
 S VAFTYPE=$S($G(VAFTYPE):VAFTYPE,1:1)
"RTN","IVMCZMT",58,0)
 S VAFMTDT=$S($G(VAFMTDT):VAFMTDT,1:DT)
"RTN","IVMCZMT",59,0)
 S $P(VAFY,HLFS,1)=$S($G(SETID):SETID,1:1)
"RTN","IVMCZMT",60,0)
 S (NODE,NODE2,PRIM)=""
"RTN","IVMCZMT",61,0)
 ;
"RTN","IVMCZMT",62,0)
 ;handle deletions of a test
"RTN","IVMCZMT",63,0)
 I ($G(DELETE("MT"))=1),VAFTYPE=1 D  G QUIT
"RTN","IVMCZMT",64,0)
 .S $P(VAFY,HLFS,2)=$$HLDATE^HLFNC(DELETE("DATE OF TEST")) ; MT Date
"RTN","IVMCZMT",65,0)
 .S $P(VAFY,HLFS,3)=HLQ
"RTN","IVMCZMT",66,0)
 .I ($G(DELETE("HARDSHIP"))=1) S $P(VAFY,HLFS,24)=HLQ
"RTN","IVMCZMT",67,0)
 .S $P(VAFY,HLFS,17)=VAFTYPE ; Type Of Test
"RTN","IVMCZMT",68,0)
 ;
"RTN","IVMCZMT",69,0)
 I ($G(DELETE("RX"))=1),VAFTYPE=2 D  G QUIT
"RTN","IVMCZMT",70,0)
 .S $P(VAFY,HLFS,2)=$$HLDATE^HLFNC(DELETE("DATE OF TEST")) ; MT Date
"RTN","IVMCZMT",71,0)
 .S $P(VAFY,HLFS,3)=HLQ
"RTN","IVMCZMT",72,0)
 .S $P(VAFY,HLFS,17)=VAFTYPE ; Type Of Test
"RTN","IVMCZMT",73,0)
 ;
"RTN","IVMCZMT",74,0)
 I ($G(DELETE("LTC"))=1),VAFTYPE=4 D  G QUIT
"RTN","IVMCZMT",75,0)
 .S $P(VAFY,HLFS,2)=$$HLDATE^HLFNC(DELETE("DATE OF TEST")) ; MT Date
"RTN","IVMCZMT",76,0)
 .S $P(VAFY,HLFS,3)=HLQ
"RTN","IVMCZMT",77,0)
 .S $P(VAFY,HLFS,17)=VAFTYPE ; Type Of Test
"RTN","IVMCZMT",78,0)
 ;
"RTN","IVMCZMT",79,0)
 ; Check for a current Income Test
"RTN","IVMCZMT",80,0)
 S MTIEN=+$$LST^DGMTU(DFN,VAFMTDT,$S($G(VAFTYPE):VAFTYPE,1:1))
"RTN","IVMCZMT",81,0)
 I MTIEN S NODE=$G(^DGMT(408.31,MTIEN,0)),PRIM=$G(^("PRIM")),NODE2=$G(^DGMT(408.31,MTIEN,2))
"RTN","IVMCZMT",82,0)
 ;
"RTN","IVMCZMT",83,0)
 ;if $$LST of ^DGMTU returned the wrong income yr, disregard it
"RTN","IVMCZMT",84,0)
 I ($G(LIMIT)=1),$E(VAFMTDT,1,3)'=$E(+NODE,1,3) S (NODE,NODE2,MTIEN,PRIM)=""
"RTN","IVMCZMT",85,0)
 ;
"RTN","IVMCZMT",86,0)
 ; Check for a future dated Income Test
"RTN","IVMCZMT",87,0)
 I 'MTIEN S MTIEN=+$$FUT^DGMTU(DFN,"",$S($G(VAFTYPE):VAFTYPE,1:1))
"RTN","IVMCZMT",88,0)
 I MTIEN S NODE=$G(^DGMT(408.31,MTIEN,0)),PRIM=$G(^("PRIM")),NODE2=$G(^DGMT(408.31,MTIEN,2))
"RTN","IVMCZMT",89,0)
 ;
"RTN","IVMCZMT",90,0)
 ;if $$FUT of ^DGMTU returned the wrong income yr, disregard it
"RTN","IVMCZMT",91,0)
 I ($G(LIMIT)=1),$E(VAFMTDT,1,3)'=$E(+NODE,1,3) S (NODE,NODE2,MTIEN,PRIM)=""
"RTN","IVMCZMT",92,0)
 ;
"RTN","IVMCZMT",93,0)
 I NODE'="" D
"RTN","IVMCZMT",94,0)
 .;add default values to new means test sharing fields
"RTN","IVMCZMT",95,0)
 .N STATUS,CODE,TDSTATUS,TDCODE,HARDSHIP,DATA,SOURCE,TIME
"RTN","IVMCZMT",96,0)
 .S TDSTATUS=$P(NODE2,"^",3)
"RTN","IVMCZMT",97,0)
 .S HARDSHIP=$P(NODE,"^",20)
"RTN","IVMCZMT",98,0)
 .I TDSTATUS="" D
"RTN","IVMCZMT",99,0)
 ..S STATUS=$P(NODE,"^",3)
"RTN","IVMCZMT",100,0)
 ..Q:'STATUS
"RTN","IVMCZMT",101,0)
 ..S CODE=$$GETCODE^DGMTH(STATUS)
"RTN","IVMCZMT",102,0)
 ..I CODE'="","ABCEGMP"[CODE D
"RTN","IVMCZMT",103,0)
 ...I VAFTYPE=1,HARDSHIP D
"RTN","IVMCZMT",104,0)
 ....I "AG"[CODE D  Q
"RTN","IVMCZMT",105,0)
 .....I CODE="A",($P(NODE,"^",4)'>$P(NODE,"^",27)) S TDSTATUS=$$GETSTAT^DGMTH("G",1) Q  ;Income <= GMT Threshold
"RTN","IVMCZMT",106,0)
 .....S TDSTATUS=$$GETSTAT^DGMTH("C",1)
"RTN","IVMCZMT",107,0)
 ....S TDSTATUS=STATUS
"RTN","IVMCZMT",108,0)
 ...S DATA(2.03)=TDSTATUS,$P(NODE2,"^",3)=TDSTATUS
"RTN","IVMCZMT",109,0)
 .S SOURCE=$P(NODE,"^",23)
"RTN","IVMCZMT",110,0)
 .I SOURCE=1 D
"RTN","IVMCZMT",111,0)
 ..S TIME=$P(NODE2,"^",2)
"RTN","IVMCZMT",112,0)
 ..I TIME="" S TIME=$$NOW^XLFDT,$P(NODE2,"^",2)=TIME,DATA(2.02)=TIME
"RTN","IVMCZMT",113,0)
 ..I $P(NODE2,"^",5)="",$P(NODE,"^",6) S $P(NODE2,"^",5)=$$GETSITE^DGMTU4($P(NODE,"^",6)),DATA(2.05)=$P(NODE2,"^",5)
"RTN","IVMCZMT",114,0)
 .I HARDSHIP,$P(NODE2,"^",4)="",$P(NODE,"^",22) S $P(NODE2,"^",4)=$$GETSITE^DGMTU4($P(NODE,"^",22)),DATA(2.04)=$P(NODE2,"^",4)
"RTN","IVMCZMT",115,0)
 .I $D(DATA),$$UPD^DGENDBS(408.31,MTIEN,.DATA)
"RTN","IVMCZMT",116,0)
 .;
"RTN","IVMCZMT",117,0)
 I VAFSTR[",2," S $P(VAFY,HLFS,2)=$S(+NODE:$$HLDATE^HLFNC(+NODE),1:HLQ) ; MT Date
"RTN","IVMCZMT",118,0)
 I VAFSTR[",3," S X=$P($G(^DG(408.32,+$P(NODE,"^",3),0)),"^",2),$P(VAFY,HLFS,3)=$S(X]"":X,1:"") ; MT Status
"RTN","IVMCZMT",119,0)
 I VAFSTR[",4," S $P(VAFY,HLFS,4)=$S($P(NODE,"^",4)]"":$P(NODE,"^",4),1:HLQ) ; Income
"RTN","IVMCZMT",120,0)
 I VAFSTR[",5," S $P(VAFY,HLFS,5)=$S($P(NODE,"^",5)]"":$P(NODE,"^",5),1:HLQ) ; Net Worth
"RTN","IVMCZMT",121,0)
 I VAFSTR[",6," S $P(VAFY,HLFS,6)=$S($P(NODE,"^",10):$$HLDATE^HLFNC($P(NODE,"^",10)),1:HLQ) ; Adjudication Date/Time
"RTN","IVMCZMT",122,0)
 I VAFSTR[",7," S $P(VAFY,HLFS,7)=$$YN^VAFHLFNC($P(NODE,"^",11)) ; Agreed To Pay
"RTN","IVMCZMT",123,0)
 I VAFSTR[",8," S $P(VAFY,HLFS,8)=$S($P(NODE,"^",12):$P(NODE,"^",12),1:HLQ) ; Threshold A
"RTN","IVMCZMT",124,0)
 I VAFSTR[",9," S $P(VAFY,HLFS,9)=$S($P(NODE,"^",15)]"":$P(NODE,"^",15),1:HLQ) ; Deductible Expenses
"RTN","IVMCZMT",125,0)
 I VAFSTR[",10," S $P(VAFY,HLFS,10)=$S($P(NODE,"^",7):$$HLDATE^HLFNC($P(NODE,"^",7)),1:HLQ) ; Date/Time Completed
"RTN","IVMCZMT",126,0)
 I VAFSTR[",11," S $P(VAFY,HLFS,11)=$$YN^VAFHLFNC($P(NODE,"^",16)) ; Previous Year Means Test Threshold Flag
"RTN","IVMCZMT",127,0)
 I VAFSTR[",12," S $P(VAFY,HLFS,12)=$S($P(NODE,"^",18)]"":$P(NODE,"^",18),1:HLQ) ; Total Dependents
"RTN","IVMCZMT",128,0)
 I VAFSTR[",13," S $P(VAFY,HLFS,13)=$$YN^VAFHLFNC($P(NODE,"^",20)) ; Hardship
"RTN","IVMCZMT",129,0)
 I VAFSTR[",14," S $P(VAFY,HLFS,14)=$S($P(NODE,"^",21):$$HLDATE^HLFNC($P(NODE,"^",21)),1:HLQ) ; Hardship Review Date
"RTN","IVMCZMT",130,0)
 I VAFSTR[",15," S $P(VAFY,HLFS,15)=$S($P(NODE,"^",24):$$HLDATE^HLFNC($P(NODE,"^",24)),1:HLQ) ; Date Vet Signed Test
"RTN","IVMCZMT",131,0)
 I VAFSTR[",16," S $P(VAFY,HLFS,16)=$$YN^VAFHLFNC($P(NODE,"^",14)) ; Declines To Give Income Info
"RTN","IVMCZMT",132,0)
 I VAFSTR[",17," S $P(VAFY,HLFS,17)=$S($P(NODE,"^",19):$P(NODE,"^",19),1:VAFTYPE) ; Type Of Test
"RTN","IVMCZMT",133,0)
 I VAFSTR[",18," S $P(VAFY,HLFS,18)=$S($P(NODE,"^",23)]"":$P(NODE,"^",23),1:HLQ) ; Source Of Test
"RTN","IVMCZMT",134,0)
 I VAFSTR[",19," S $P(VAFY,HLFS,19)=$$YN^VAFHLFNC(PRIM) ; Primary Test?
"RTN","IVMCZMT",135,0)
 I VAFSTR[",20," S $P(VAFY,HLFS,20)=$S($P(NODE,"^",25):$$HLDATE^HLFNC($P(NODE,"^",25)),1:HLQ) ; Date IVM Verified MT Completed
"RTN","IVMCZMT",136,0)
 I VAFSTR[",21," S $P(VAFY,HLFS,21)=$$YN^VAFHLFNC($P(NODE,"^",26)) ; Refused To Sign
"RTN","IVMCZMT",137,0)
 ;
"RTN","IVMCZMT",138,0)
 ;
"RTN","IVMCZMT",139,0)
 I VAFSTR[",22," S $P(VAFY,HLFS,22)=$P(NODE2,"^",5) ;Site Conducting Test
"RTN","IVMCZMT",140,0)
 I VAFSTR[",23," S $P(VAFY,HLFS,23)=$P(NODE2,"^",4) ;Site Granting Hardship
"RTN","IVMCZMT",141,0)
 I VAFSTR[",24," S $P(VAFY,HLFS,24)=$S($P(NODE2,"^"):$$HLDATE^HLFNC($P(NODE2,"^")),1:"") ;Hardship Effective Date
"RTN","IVMCZMT",142,0)
 I VAFSTR[",25," S $P(VAFY,HLFS,25)=$S($P(NODE2,"^",2):$$HLDATE^HLFNC($P(NODE2,"^",2)),1:"") ;Dt/Tm Test Last Edited
"RTN","IVMCZMT",143,0)
 I VAFSTR[",26," S $P(VAFY,HLFS,26)=$S($P(NODE2,"^",3):$$GETCODE^DGMTH($P(NODE2,"^",3)),1:"") ; Test Determined Status
"RTN","IVMCZMT",144,0)
 I VAFSTR[",28," S $P(VAFY,HLFS,28)=$P(NODE,"^",27)  ;GMT Threshold
"RTN","IVMCZMT",145,0)
 I VAFSTR[",29," S $P(VAFY,HLFS,29)=$P(NODE2,"^",9)  ;Hardship Reason
"RTN","IVMCZMT",146,0)
 ;
"RTN","IVMCZMT",147,0)
 ;can only transmit the deletion of a hardship if the segment is for a means test - and the income years must match if there is a means test
"RTN","IVMCZMT",148,0)
 ;
"RTN","IVMCZMT",149,0)
 I VAFTYPE=1,($G(DELETE("HARDSHIP"))=1),('(+NODE)!($E(DELETE("DATE OF TEST"),1,3)=$E((+NODE),1,3))) S $P(VAFY,HLFS,24)=HLQ
"RTN","IVMCZMT",150,0)
 ;
"RTN","IVMCZMT",151,0)
QUIT Q "ZMT"_HLFS_$G(VAFY)
"RTN","IVMPTRN4")
0^1^B14937636
"RTN","IVMPTRN4",1,0)
IVMPTRN4 ;ALB/SEK - SEND RE-TRANSMISSIONS TO THE IVM CENTER ; 06/12/2003
"RTN","IVMPTRN4",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**9,11,17,34,66,81**; 21-OCT-94
"RTN","IVMPTRN4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMPTRN4",4,0)
 ;
"RTN","IVMPTRN4",5,0)
 ; This routine checks STATUS field of IVM TRANSMISSION LOG file (301.6)
"RTN","IVMPTRN4",6,0)
 ; to see if acknowledgment of the transmission has been received from
"RTN","IVMPTRN4",7,0)
 ; the IVM Center.  If transmission is waiting at the site, a message is
"RTN","IVMPTRN4",8,0)
 ; sent to the recipients of the IVM MESSAGES mail group.  Else the
"RTN","IVMPTRN4",9,0)
 ; message is re-transmitted to the IVM Center.
"RTN","IVMPTRN4",10,0)
 ;
"RTN","IVMPTRN4",11,0)
 ;
"RTN","IVMPTRN4",12,0)
ENTRY ; Check if message has not been transmitted in 3 days
"RTN","IVMPTRN4",13,0)
 S IVMDTM3=$$FMADD^XLFDT(DT,-3),IVM14=$$FMADD^XLFDT(DT,-14)
"RTN","IVMPTRN4",14,0)
 S IVMDTMST=+$P($G(^IVM(301.9,1,0)),"^",6)
"RTN","IVMPTRN4",15,0)
 S:IVMDTMST<IVM14 IVMDTMST=IVM14
"RTN","IVMPTRN4",16,0)
 ;
"RTN","IVMPTRN4",17,0)
 ; INITIALIZE HL7 VARIABLES
"RTN","IVMPTRN4",18,0)
 N HL,HLEID
"RTN","IVMPTRN4",19,0)
 S HLEID="VAMC "_$P($$SITE^VASITE,"^",3)_" ORU-Z07 SERVER"
"RTN","IVMPTRN4",20,0)
 S HLEID=$O(^ORD(101,"B",HLEID,0))
"RTN","IVMPTRN4",21,0)
 D INIT^IVMUFNC(HLEID,.HL) S HLMTN="ORU" ; Initialize variables for HL7/IVM
"RTN","IVMPTRN4",22,0)
 ;
"RTN","IVMPTRN4",23,0)
 ; check Transmission Date/Time in AB x-ref
"RTN","IVMPTRN4",24,0)
 ; Note 2 oddities about this loop:
"RTN","IVMPTRN4",25,0)
 ;   1) Only checks back 2 weeks, if somehow retransmission not done within this window then it won't be done.
"RTN","IVMPTRN4",26,0)
 ;   2) Assumes IVMDAT will map to exactly one msgid for HL7 message - assumption made in $$MSGN^IVMPTRN4.
"RTN","IVMPTRN4",27,0)
 ;
"RTN","IVMPTRN4",28,0)
 S IVMDAT=IVMDTMST F  S IVMDAT=$O(^IVM(301.6,"AB",IVMDAT)) Q:'IVMDAT!($P(IVMDAT,".")>IVMDTM3)  D MAILMSGN
"RTN","IVMPTRN4",29,0)
 ;
"RTN","IVMPTRN4",30,0)
 ;
"RTN","IVMPTRN4",31,0)
 ;transmit remaining records
"RTN","IVMPTRN4",32,0)
 D
"RTN","IVMPTRN4",33,0)
 .N IVMEVENT
"RTN","IVMPTRN4",34,0)
 .; event code for Full Data Transmission
"RTN","IVMPTRN4",35,0)
 .S IVMEVENT="Z07"
"RTN","IVMPTRN4",36,0)
 .D FILE^IVMPTRN3
"RTN","IVMPTRN4",37,0)
 ;
"RTN","IVMPTRN4",38,0)
 ;clean-up
"RTN","IVMPTRN4",39,0)
 D END^IVMPTRN
"RTN","IVMPTRN4",40,0)
 ;
"RTN","IVMPTRN4",41,0)
ENTRYQ K IVMDAT,IVMMAILF,IVMDTM3,IVMDTMST,IVM14
"RTN","IVMPTRN4",42,0)
 Q
"RTN","IVMPTRN4",43,0)
 ;
"RTN","IVMPTRN4",44,0)
 ;
"RTN","IVMPTRN4",45,0)
MAILMSGN ; Get Mailman message number related to this transmission
"RTN","IVMPTRN4",46,0)
 S IVMMAILN=$$MSGN(IVMDAT)  ;returns #773 IEN for v1.6
"RTN","IVMPTRN4",47,0)
 ;
"RTN","IVMPTRN4",48,0)
 Q:'IVMMAILN                                   ; if no #773 IEN found
"RTN","IVMPTRN4",49,0)
 ;
"RTN","IVMPTRN4",50,0)
 ; find if awaiting initial transmission
"RTN","IVMPTRN4",51,0)
 N SLLN
"RTN","IVMPTRN4",52,0)
 S SLLN=+$P($G(^HLMA(IVMMAILN,0)),"^",7)       ; sending logical link
"RTN","IVMPTRN4",53,0)
 I SLLN,$D(^HLMA("AC","O",SLLN,IVMMAILN)) D  Q
"RTN","IVMPTRN4",54,0)
 .Q:$G(IVMMAILF)  ; already sent message once
"RTN","IVMPTRN4",55,0)
 .S XMSUB="MESSAGES 'AWAITING TRANSMISSION'"
"RTN","IVMPTRN4",56,0)
 .S IVMTEXT(1)="HL7 message number "_IVMMAILN_" is awaiting transmission."
"RTN","IVMPTRN4",57,0)
 .S IVMTEXT(2)="Please call the IVM Center (Atlanta, GA) to ensure the HL7 logical links and filers are running "
"RTN","IVMPTRN4",58,0)
 .S IVMTEXT(3)="if the HL7 logical link and filers are running at your station."
"RTN","IVMPTRN4",59,0)
 .S IVMTEXT(4)=" "
"RTN","IVMPTRN4",60,0)
 .S IVMTEXT(5)="Please note that you may have other messages that are awaiting transmission"
"RTN","IVMPTRN4",61,0)
 .S IVMTEXT(6)="to the IVM Center."
"RTN","IVMPTRN4",62,0)
 .D MAIL^IVMUFNC()
"RTN","IVMPTRN4",63,0)
 .S IVMMAILF=1
"RTN","IVMPTRN4",64,0)
 ;
"RTN","IVMPTRN4",65,0)
 ; Transmission has left site - get individual patient and re-transmit
"RTN","IVMPTRN4",66,0)
 K IVMQUERY("LTD"),IVMQUERY("OVIS") ;Variables needed to open/close last visit date and outpt visit QUERIES
"RTN","IVMPTRN4",67,0)
 F IVMDA=0:0 S IVMDA=$O(^IVM(301.6,"AB",IVMDAT,IVMDA)) Q:'IVMDA  D
"RTN","IVMPTRN4",68,0)
 .;
"RTN","IVMPTRN4",69,0)
 .N IVMTLOG,EVENTS
"RTN","IVMPTRN4",70,0)
 .;
"RTN","IVMPTRN4",71,0)
 .Q:'$$GET^IVMTLOG(IVMDA,.IVMTLOG)
"RTN","IVMPTRN4",72,0)
 .S IVM3015P=IVMTLOG("PAT") Q:'IVM3015P
"RTN","IVMPTRN4",73,0)
 .S IVMNODE=$G(^IVM(301.5,+IVM3015P,0)),IVMDT=+$P(IVMNODE,"^",2),DFN=+IVMNODE
"RTN","IVMPTRN4",74,0)
 .I 'DFN!'IVMDT Q
"RTN","IVMPTRN4",75,0)
 .S IVMMTDT=($E(IVMDT,1,3)+1)_"1231.9999"
"RTN","IVMPTRN4",76,0)
 .I $E(IVMMTDT,1,3)'=($E(IVMDT,1,3)+1) S IVMMTDT=$E(IVMDT,1,3)+1_"0101"
"RTN","IVMPTRN4",77,0)
 .;
"RTN","IVMPTRN4",78,0)
 .M EVENTS=IVMTLOG("EVENTS")
"RTN","IVMPTRN4",79,0)
 .;
"RTN","IVMPTRN4",80,0)
 .; Prepare FULL transmission
"RTN","IVMPTRN4",81,0)
 .D FULL^IVMPTRN7(DFN,IVMMTDT,.EVENTS,.IVMCT,.IVMGTOT,,,,.IVMQUERY)
"RTN","IVMPTRN4",82,0)
 .;
"RTN","IVMPTRN4",83,0)
 .;change status to retransmitted
"RTN","IVMPTRN4",84,0)
 .I $$SETSTAT^IVMTLOG(IVMDA,2)
"RTN","IVMPTRN4",85,0)
 F Z="LTD","OVIS" I $G(IVMQUERY(Z)) D CLOSE^SDQ(IVMQUERY(Z)) K IVMQUERY(Z)
"RTN","IVMPTRN4",86,0)
 Q
"RTN","IVMPTRN4",87,0)
 ;
"RTN","IVMPTRN4",88,0)
MSGN(IVMDT) ; Find the mailman message number for an HL7 message
"RTN","IVMPTRN4",89,0)
 ; Input:   IVMDT  --  The date/time (301.6;.02) the msg was sent
"RTN","IVMPTRN4",90,0)
 ; Output:  Pointer to the message in file #773, or zero if not found
"RTN","IVMPTRN4",91,0)
 N IVMMSG,X S IVMMSG=0
"RTN","IVMPTRN4",92,0)
 S X=+$O(^IVM(301.6,"AB",IVMDT,0)),X=$G(^IVM(301.6,X,0))
"RTN","IVMPTRN4",93,0)
 I X S IVMMSG=$$MMN(+$P($P(X,"^",5),"-"))
"RTN","IVMPTRN4",94,0)
MSGNQ Q IVMMSG
"RTN","IVMPTRN4",95,0)
 ;
"RTN","IVMPTRN4",96,0)
MMN(Y) ; Do look-up on file #772 and find mail message number.
"RTN","IVMPTRN4",97,0)
 ;  Input:   Y  --  Message Control ID
"RTN","IVMPTRN4",98,0)
 ;  Output:  Mail Message Number
"RTN","IVMPTRN4",99,0)
 N Z S Z=0
"RTN","IVMPTRN4",100,0)
 S Y=$O(^HL(772,"C",Y,0))
"RTN","IVMPTRN4",101,0)
 I Y S Z=+$O(^HLMA("B",Y,0))  ;Y=#772 IEN, Z=#773 IEN
"RTN","IVMPTRN4",102,0)
MMNQ Q Z
"VER")
8.0^22
**END**
**END**
