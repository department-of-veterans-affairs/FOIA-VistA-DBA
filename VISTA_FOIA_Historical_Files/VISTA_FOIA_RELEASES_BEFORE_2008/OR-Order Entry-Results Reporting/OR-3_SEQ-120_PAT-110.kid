Released OR*3*110 SEQ #120
Extracted from mail message
**KIDS**:OR*3.0*110^

**INSTALL NAME**
OR*3.0*110
"BLD",3317,0)
OR*3.0*110^ORDER ENTRY/RESULTS REPORTING^0^3020107^y
"BLD",3317,1,0)
^^1^1^3011211^
"BLD",3317,1,1,0)
Please see FORUM patch description for a complete analysis of this patch.
"BLD",3317,4,0)
^9.64PA^^
"BLD",3317,"ABPKG")
n
"BLD",3317,"INIT")
ORY110
"BLD",3317,"KRN",0)
^9.67PA^8989.52^19
"BLD",3317,"KRN",.4,0)
.4
"BLD",3317,"KRN",.401,0)
.401
"BLD",3317,"KRN",.402,0)
.402
"BLD",3317,"KRN",.403,0)
.403
"BLD",3317,"KRN",.5,0)
.5
"BLD",3317,"KRN",.84,0)
.84
"BLD",3317,"KRN",3.6,0)
3.6
"BLD",3317,"KRN",3.8,0)
3.8
"BLD",3317,"KRN",9.2,0)
9.2
"BLD",3317,"KRN",9.8,0)
9.8
"BLD",3317,"KRN",9.8,"NM",0)
^9.68A^8^7
"BLD",3317,"KRN",9.8,"NM",1,0)
ORCSIGN^^0^B63140853
"BLD",3317,"KRN",9.8,"NM",3,0)
ORMRA^^0^B48363657
"BLD",3317,"KRN",9.8,"NM",4,0)
ORCMEDT1^^0^B41953303
"BLD",3317,"KRN",9.8,"NM",5,0)
ORY110^^0^B13400185
"BLD",3317,"KRN",9.8,"NM",6,0)
ORCDLG1^^0^B71871408
"BLD",3317,"KRN",9.8,"NM",7,0)
ORCHTAB3^^0^B42604740
"BLD",3317,"KRN",9.8,"NM",8,0)
ORWORR^^0^B51024682
"BLD",3317,"KRN",9.8,"NM","B","ORCDLG1",6)

"BLD",3317,"KRN",9.8,"NM","B","ORCHTAB3",7)

"BLD",3317,"KRN",9.8,"NM","B","ORCMEDT1",4)

"BLD",3317,"KRN",9.8,"NM","B","ORCSIGN",1)

"BLD",3317,"KRN",9.8,"NM","B","ORMRA",3)

"BLD",3317,"KRN",9.8,"NM","B","ORWORR",8)

"BLD",3317,"KRN",9.8,"NM","B","ORY110",5)

"BLD",3317,"KRN",19,0)
19
"BLD",3317,"KRN",19,"NM",0)
^9.68A^^
"BLD",3317,"KRN",19.1,0)
19.1
"BLD",3317,"KRN",101,0)
101
"BLD",3317,"KRN",409.61,0)
409.61
"BLD",3317,"KRN",771,0)
771
"BLD",3317,"KRN",870,0)
870
"BLD",3317,"KRN",8989.51,0)
8989.51
"BLD",3317,"KRN",8989.52,0)
8989.52
"BLD",3317,"KRN",8994,0)
8994
"BLD",3317,"KRN","B",.4,.4)

"BLD",3317,"KRN","B",.401,.401)

"BLD",3317,"KRN","B",.402,.402)

"BLD",3317,"KRN","B",.403,.403)

"BLD",3317,"KRN","B",.5,.5)

"BLD",3317,"KRN","B",.84,.84)

"BLD",3317,"KRN","B",3.6,3.6)

"BLD",3317,"KRN","B",3.8,3.8)

"BLD",3317,"KRN","B",9.2,9.2)

"BLD",3317,"KRN","B",9.8,9.8)

"BLD",3317,"KRN","B",19,19)

"BLD",3317,"KRN","B",19.1,19.1)

"BLD",3317,"KRN","B",101,101)

"BLD",3317,"KRN","B",409.61,409.61)

"BLD",3317,"KRN","B",771,771)

"BLD",3317,"KRN","B",870,870)

"BLD",3317,"KRN","B",8989.51,8989.51)

"BLD",3317,"KRN","B",8989.52,8989.52)

"BLD",3317,"KRN","B",8994,8994)

"BLD",3317,"QUES",0)
^9.62^^
"BLD",3317,"REQB",0)
^9.611^8^8
"BLD",3317,"REQB",1,0)
OR*3.0*85^1
"BLD",3317,"REQB",2,0)
OR*3.0*108^1
"BLD",3317,"REQB",3,0)
OR*3.0*48^1
"BLD",3317,"REQB",4,0)
OR*3.0*7^1
"BLD",3317,"REQB",5,0)
OR*3.0*3^1
"BLD",3317,"REQB",6,0)
OR*3.0*95^1
"BLD",3317,"REQB",7,0)
OR*3.0*92^1
"BLD",3317,"REQB",8,0)
OR*3.0*116^1
"BLD",3317,"REQB","B","OR*3.0*108",2)

"BLD",3317,"REQB","B","OR*3.0*116",8)

"BLD",3317,"REQB","B","OR*3.0*3",5)

"BLD",3317,"REQB","B","OR*3.0*48",3)

"BLD",3317,"REQB","B","OR*3.0*7",4)

"BLD",3317,"REQB","B","OR*3.0*85",1)

"BLD",3317,"REQB","B","OR*3.0*92",7)

"BLD",3317,"REQB","B","OR*3.0*95",6)

"INIT")
ORY110
"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
110^3020107^1326
"PKG",110,22,1,"PAH",1,1,0)
^^1^1^3020107
"PKG",110,22,1,"PAH",1,1,1,0)
Please see FORUM patch description for a complete analysis of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","ORCDLG1")
0^6^B71871408
"RTN","ORCDLG1",1,0)
ORCDLG1 ; SLC/MKB - Order dialogs cont ;11/21/01  08:03
"RTN","ORCDLG1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**60,71,95,110**;Dec 17, 1997
"RTN","ORCDLG1",3,0)
EN(ITM,INST) ; -- ask each ITM prompt where
"RTN","ORCDLG1",4,0)
 ;    ORDIALOG(PROMPT,#) = internal form of each response
"RTN","ORCDLG1",5,0)
 ;
"RTN","ORCDLG1",6,0)
 N ITEM,COND,MULT,REQD,EDITONLY,DATATYPE,DOMAIN,DIR,Y,ACTION,PROMPT,ORX,VALIDEF
"RTN","ORCDLG1",7,0)
 S ITEM=$G(^ORD(101.41,+ORDIALOG,10,ITM,0)),COND=$G(^(3))
"RTN","ORCDLG1",8,0)
 S PROMPT=$P(ITEM,U,2) Q:'PROMPT  S:'$G(INST) INST=1
"RTN","ORCDLG1",9,0)
 S MULT=$P(ITEM,U,7),ACTION=$P(ITEM,U,9)
"RTN","ORCDLG1",10,0)
 S REQD=$P(ITEM,U,6),EDITONLY=$P(ITEM,U,8) S:$G(ORTYPE)="Z" (REQD,EDITONLY)=0
"RTN","ORCDLG1",11,0)
 I $D(^ORD(101.41,+ORDIALOG,10,ITM,9)) X ^(9) G:$G(ORQUIT) ENQ ;Entry
"RTN","ORCDLG1",12,0)
 I $G(ORTYPE)="Q",$D(ORDIALOG(PROMPT,INST)),$E(ORDIALOG(PROMPT,0))'="W" S EDITONLY=1
"RTN","ORCDLG1",13,0)
 I '$D(ORDIALOG(PROMPT,INST)) D  ; get default value
"RTN","ORCDLG1",14,0)
 . I $E(ORDIALOG(PROMPT,0))="W",$D(^ORD(101.41,+ORDIALOG,10,ITM,8))>9 M ^TMP("ORWORD",$J,PROMPT,INST)=^(8) S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")" Q
"RTN","ORCDLG1",15,0)
 . K Y X:$D(^ORD(101.41,+ORDIALOG,10,ITM,7)) ^(7)
"RTN","ORCDLG1",16,0)
 . I $D(Y) S VALIDEF=$$VALID S:VALIDEF ORDIALOG(PROMPT,INST)=Y ;**95
"RTN","ORCDLG1",17,0)
 . I $G(VALIDEF)=0 W !,"The DEFAULT value for the ",$G(ORDIALOG(PROMPT,"A"))," prompt is invalid." S EDITONLY=0 ;**95
"RTN","ORCDLG1",18,0)
 . K VALIDEF ;**95
"RTN","ORCDLG1",19,0)
 I $G(AUTO),'REQD!($E(ORDIALOG(PROMPT,0))="W"&$D(ORDIALOG(PROMPT,INST))) S EDITONLY=1 ;Auto-accept
"RTN","ORCDLG1",20,0)
EN0 I FIRST&EDITONLY D:$D(ORDIALOG(PROMPT,INST))  G ENQ  ;ck child prompts
"RTN","ORCDLG1",21,0)
 . Q:'$D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT))  N SEQ,DA,ITEM,PRMT,X,Y,VALIDEF ;**95
"RTN","ORCDLG1",22,0)
 . S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D  Q:$G(ORQUIT)
"RTN","ORCDLG1",23,0)
 . . K VALIDEF ;110
"RTN","ORCDLG1",24,0)
 . . S ITEM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)),PRMT=$P(ITEM,U,2)
"RTN","ORCDLG1",25,0)
 . . Q:$D(ORDIALOG(PRMT,INST))  ; already has a value
"RTN","ORCDLG1",26,0)
 . . K Y X:$D(^ORD(101.41,+ORDIALOG,10,DA,7)) ^(7)
"RTN","ORCDLG1",27,0)
 . . I $D(Y) S VALIDEF=$$VALID ;**95
"RTN","ORCDLG1",28,0)
 . . I $G(VALIDEF)!('$P(ITEM,U,6)) S:$G(VALIDEF) ORDIALOG(PRMT,INST)=Y Q  ;**95
"RTN","ORCDLG1",29,0)
 . . D EN(DA,INST) ; ask
"RTN","ORCDLG1",30,0)
 I ($G(OREDIT)&(ACTION'["C"))!($G(ORENEW)&(ACTION'["R")) G ENQ ;ask?
"RTN","ORCDLG1",31,0)
 I $G(OREWRITE),ACTION'["W",FIRST,'REQD!$D(ORDIALOG(PROMPT,INST)) G ENQ
"RTN","ORCDLG1",32,0)
 I $L(COND) X COND G:'$T ENQ ; failed condition
"RTN","ORCDLG1",33,0)
 M DIR=ORDIALOG(PROMPT) S DATATYPE=$E(DIR(0)),DOMAIN=$P(DIR(0),U,2)
"RTN","ORCDLG1",34,0)
 I 'MULT D WP^ORCDLG2:DATATYPE="W",ONE(INST,REQD):DATATYPE'="W" G ENQ
"RTN","ORCDLG1",35,0)
EN1 ; -- loop for multiples
"RTN","ORCDLG1",36,0)
 I '$O(ORDIALOG(PROMPT,0)) D  G:$G(ORQUIT)!('$O(ORDIALOG(PROMPT,0)))!FIRST ENQ
"RTN","ORCDLG1",37,0)
M1 . D ADDMULT Q:$G(ORQUIT)
"RTN","ORCDLG1",38,0)
 . Q:'REQD!$O(ORDIALOG(PROMPT,0))  I FIRST,$G(SEQ)=1 S ORQUIT=1 Q
"RTN","ORCDLG1",39,0)
 . W $C(7),!!,$$REQUIRED,! G M1
"RTN","ORCDLG1",40,0)
 F  S ORX=$$SELECT Q:ORX=""  S:ORX="^" ORQUIT=1 Q:$G(ORQUIT)  D  Q:$G(DIROUT)
"RTN","ORCDLG1",41,0)
 . S DIR("A")=ORDIALOG(PROMPT,"A"),X=$S('REQD:0,$$ONLY(ORX):1,1:0)
"RTN","ORCDLG1",42,0)
 . D ADDMULT:ORX="A",ONE(ORX,X):ORX Q:$G(DIROUT)  K ORQUIT,DIR("B")
"RTN","ORCDLG1",43,0)
 . I REQD,'$O(ORDIALOG(PROMPT,0)) W $C(7),!!,$$REQUIRED,!
"RTN","ORCDLG1",44,0)
ENQ X:$D(^ORD(101.41,+ORDIALOG,10,ITM,10)) ^(10) ; exit action
"RTN","ORCDLG1",45,0)
 Q
"RTN","ORCDLG1",46,0)
 ;
"RTN","ORCDLG1",47,0)
REQUIRED() ; -- Required response message
"RTN","ORCDLG1",48,0)
 Q "A response is required!  Enter '^' to quit."
"RTN","ORCDLG1",49,0)
 ;
"RTN","ORCDLG1",50,0)
SELECT() ; -- select instance of multiple to edit
"RTN","ORCDLG1",51,0)
 N DIR,X,Y,CNT,I,MAX,TOTAL,DONE
"RTN","ORCDLG1",52,0)
 S MAX=+$G(ORDIALOG(PROMPT,"MAX")),TOTAL=+$G(ORDIALOG(PROMPT,"TOT"))
"RTN","ORCDLG1",53,0)
 S DIR("A",1)=$S($L($G(ORDIALOG(PROMPT,"TTL"))):ORDIALOG(PROMPT,"TTL"),1:ORDIALOG(PROMPT,"A"))
"RTN","ORCDLG1",54,0)
 S (I,CNT)=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  S CNT=CNT+1,CNT(CNT)=I,DIR("A",CNT+1)=$J(CNT,3)_": "_$$ITEM^ORCDLG(PROMPT,I) ; parent+children
"RTN","ORCDLG1",55,0)
 I 'MAX!(MAX&(MAX>TOTAL)) S CNT=CNT+1,CNT(CNT)="A",DIR("A",CNT+1)=$J(CNT,3)_": <enter more>"
"RTN","ORCDLG1",56,0)
 S DIR("A")="Select "_$S(CNT>1:"(1-"_CNT_")",1:1)_" or <return> to continue: "
"RTN","ORCDLG1",57,0)
 S DIR(0)="NAO^1:"_CNT,DIR("?")="Select the instance you wish to change"
"RTN","ORCDLG1",58,0)
S1 D ^DIR I $D(DTOUT)!(Y="^") Q "^"
"RTN","ORCDLG1",59,0)
 I Y?1"^".E D UJUMP Q:$G(ORQUIT)!($G(DONE)) "" G S1
"RTN","ORCDLG1",60,0)
 I Y="" Q Y
"RTN","ORCDLG1",61,0)
 Q CNT(Y)
"RTN","ORCDLG1",62,0)
 ;
"RTN","ORCDLG1",63,0)
ONLY(I) ; -- I the only instance?
"RTN","ORCDLG1",64,0)
 N J,Z S J=0,Z=1
"RTN","ORCDLG1",65,0)
 F  S J=$O(ORDIALOG(PROMPT,J)) Q:J'>0  I J'=I S Z=0 Q
"RTN","ORCDLG1",66,0)
 Q Z
"RTN","ORCDLG1",67,0)
 ;
"RTN","ORCDLG1",68,0)
ADDMULT ; -- add new instances of multiple
"RTN","ORCDLG1",69,0)
 N DONE,LAST,INST,MAX,ANOTHER
"RTN","ORCDLG1",70,0)
 S MAX=+$G(ORDIALOG(PROMPT,"MAX")) I MAX,MAX'>$G(ORDIALOG(PROMPT,"TOT")) W $C(7),!,"Only "_MAX_" items may be selected!",! Q
"RTN","ORCDLG1",71,0)
 S ANOTHER=$G(ORDIALOG(PROMPT,"MORE")) S:'$L(ANOTHER) ANOTHER="Another "
"RTN","ORCDLG1",72,0)
 S DIR("A")=$S($O(ORDIALOG(PROMPT,0)):ANOTHER,1:"")_ORDIALOG(PROMPT,"A")
"RTN","ORCDLG1",73,0)
 F  D  Q:$G(ORQUIT)!($G(DONE))  I MAX Q:MAX'>$G(ORDIALOG(PROMPT,"TOT"))
"RTN","ORCDLG1",74,0)
 . S INST=$O(ORDIALOG(PROMPT,"?"),-1)+1
"RTN","ORCDLG1",75,0)
 . D ONE(INST,0) I '$D(ORDIALOG(PROMPT,INST)) S DONE=1 Q
"RTN","ORCDLG1",76,0)
 . S ORDIALOG(PROMPT,"TOT")=+$G(ORDIALOG(PROMPT,"TOT"))+1,DIR("A")=ANOTHER_ORDIALOG(PROMPT,"A")
"RTN","ORCDLG1",77,0)
 Q
"RTN","ORCDLG1",78,0)
 ;
"RTN","ORCDLG1",79,0)
ONE(ORI,REQD) ; -- ask single-valued prompt
"RTN","ORCDLG1",80,0)
 N DONE,ORESET
"RTN","ORCDLG1",81,0)
 S:$D(ORDIALOG(PROMPT,ORI)) DIR("B")=$$EXT^ORCD(PROMPT,ORI),ORESET=ORDIALOG(PROMPT,ORI)
"RTN","ORCDLG1",82,0)
 F  D  Q:$G(DONE)  I $G(ORQUIT) Q:FIRST  Q:'REQD!$D(ORDIALOG(PROMPT,ORI))  S FIRST=$$DONE^ORCDLG2 Q:FIRST  K ORQUIT
"RTN","ORCDLG1",83,0)
 . D DIR^ORCDLG2 I $D(DTOUT)!$D(DIROUT)!(X=U) S ORQUIT=1 Q
"RTN","ORCDLG1",84,0)
 . I X="" S DONE=1 Q
"RTN","ORCDLG1",85,0)
 . I X?1"^".E D UJUMP Q
"RTN","ORCDLG1",86,0)
 . I X="@" D DELETE Q
"RTN","ORCDLG1",87,0)
 . S ORDIALOG(PROMPT,ORI)=$P(Y,U),DONE=1
"RTN","ORCDLG1",88,0)
 . X:$L($G(^ORD(101.41,+ORDIALOG,10,ITM,5))) ^(5) I '$G(DONE) D RESET Q  ; validate - if failed, K DONE to reask
"RTN","ORCDLG1",89,0)
 . D:$D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT)) CHILDREN(PROMPT,ORI) I '$G(DONE),'FIRST D DELCHILD(PROMPT,ORI),RESET Q
"RTN","ORCDLG1",90,0)
 Q
"RTN","ORCDLG1",91,0)
 ;
"RTN","ORCDLG1",92,0)
CHILDREN(PARENT,INST) ; -- ask child prompts
"RTN","ORCDLG1",93,0)
 N SEQ,DA,ORQUIT S SEQ=0
"RTN","ORCDLG1",94,0)
 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D EN(DA,INST) Q:$G(ORQUIT)
"RTN","ORCDLG1",95,0)
 K:$G(ORQUIT) DONE ; reask parent
"RTN","ORCDLG1",96,0)
 Q
"RTN","ORCDLG1",97,0)
 ;
"RTN","ORCDLG1",98,0)
RESET ; -- Reset original prompt value
"RTN","ORCDLG1",99,0)
 K ORDIALOG(PROMPT,ORI)
"RTN","ORCDLG1",100,0)
 S:$D(ORESET) ORDIALOG(PROMPT,ORI)=ORESET
"RTN","ORCDLG1",101,0)
 Q
"RTN","ORCDLG1",102,0)
 ;
"RTN","ORCDLG1",103,0)
UJUMP ; -- ^-jump
"RTN","ORCDLG1",104,0)
 N XP,P,CNT,MATCH,I,DIR,NEWSEQ ; XP=$$UP(X),P=PROMPT
"RTN","ORCDLG1",105,0)
 I $G(NOJUMP) W $C(7),"  ^-jumping not allowed!" Q
"RTN","ORCDLG1",106,0)
 S XP=$$UP^XLFSTR($P(X,U,2)) I "^"[XP S ORQUIT=1 Q
"RTN","ORCDLG1",107,0)
 I $G(ORDIALOG("B",XP)) S NEWSEQ=+ORDIALOG("B",XP) G UJQ
"RTN","ORCDLG1",108,0)
 S CNT=0,P=XP F  S P=$O(ORDIALOG("B",P)) Q:P=""  Q:$E(P,1,$L(XP))'=XP  Q:FIRST&(+ORDIALOG("B",P)'<SEQ)  S CNT=CNT+1,MATCH(CNT)=+ORDIALOG("B",P)_U_P ; =SEQ^TEXT
"RTN","ORCDLG1",109,0)
 I 'CNT W $C(7),"  ??" Q
"RTN","ORCDLG1",110,0)
 I CNT=1 S P=$P(MATCH(1),U,2) W $E(P,$L(XP)+1,$L(P)) S NEWSEQ=+MATCH(1) G UJQ
"RTN","ORCDLG1",111,0)
 F I=1:1:CNT S DIR("A",I)=I_"  "_$P(MATCH(I),U,2)
"RTN","ORCDLG1",112,0)
 S DIR("A")="Select 1-"_CNT_": ",DIR(0)="NAO^1:"_CNT
"RTN","ORCDLG1",113,0)
 S DIR("?")="Select the field you wish to jump to, by number"
"RTN","ORCDLG1",114,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT))!(Y="") Q
"RTN","ORCDLG1",115,0)
 S NEWSEQ=+MATCH(Y)
"RTN","ORCDLG1",116,0)
UJQ I FIRST,NEWSEQ'<SEQ W $C(7),"  ^-jumping ahead not allowed now!" Q
"RTN","ORCDLG1",117,0)
 S SEQ=NEWSEQ-.01,DONE=1
"RTN","ORCDLG1",118,0)
 Q
"RTN","ORCDLG1",119,0)
 ;
"RTN","ORCDLG1",120,0)
DELETE ; -- delete response
"RTN","ORCDLG1",121,0)
 I '$D(DIR("B")) W $C(7),"  ??" Q
"RTN","ORCDLG1",122,0)
 Q:'$$SURE  S DONE=1
"RTN","ORCDLG1",123,0)
 K ORDIALOG(PROMPT,ORI),DIR("B")
"RTN","ORCDLG1",124,0)
 S:$G(ORDIALOG(PROMPT,"TOT")) ORDIALOG(PROMPT,"TOT")=ORDIALOG(PROMPT,"TOT")-1
"RTN","ORCDLG1",125,0)
 I $D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT)) D DELCHILD(PROMPT,ORI)
"RTN","ORCDLG1",126,0)
 Q
"RTN","ORCDLG1",127,0)
 ;
"RTN","ORCDLG1",128,0)
DELCHILD(PARENT,INST) ; -- delete child prompts
"RTN","ORCDLG1",129,0)
 N SEQ,DA,PTR S:'$G(INST) INST=1
"RTN","ORCDLG1",130,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)),PTR=+$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,2) K:PTR ORDIALOG(PTR,INST)
"RTN","ORCDLG1",131,0)
 Q
"RTN","ORCDLG1",132,0)
 ;
"RTN","ORCDLG1",133,0)
SURE() ; -- sure you want to delete?
"RTN","ORCDLG1",134,0)
 N X,Y,DIR
"RTN","ORCDLG1",135,0)
 S DIR(0)="YA",DIR("A")="  Are you sure you want to delete this value? "
"RTN","ORCDLG1",136,0)
 S DIR("B")="NO" W $C(7) D ^DIR
"RTN","ORCDLG1",137,0)
 S:$D(DTOUT) Y="^"
"RTN","ORCDLG1",138,0)
 Q Y
"RTN","ORCDLG1",139,0)
 ;
"RTN","ORCDLG1",140,0)
VALID() ;Check to see if default value is valid.  Returns 0 or 1
"RTN","ORCDLG1",141,0)
 ;Entire section added in patch 95
"RTN","ORCDLG1",142,0)
 N TYPE,RANGE,MIN,MAX,DIR,X,ORDIC,DDS,RTYPE,ORIG
"RTN","ORCDLG1",143,0)
 I Y="" Q 1 ;If default is null allow to pass ;110
"RTN","ORCDLG1",144,0)
 S DIR(0)=$G(ORDIALOG(PROMPT,0)),(ORIG,X)=Y,DIR("V")="" ;Set reader type, default input, silent call
"RTN","ORCDLG1",145,0)
 S TYPE=$E($P(DIR(0),"^")) ;Get type of look-up being done
"RTN","ORCDLG1",146,0)
 I TYPE="W" Q 1 ;If word processing assume value is valid, may be referencing a global location
"RTN","ORCDLG1",147,0)
 I TYPE="R" S $P(DIR(0),"^")="D"_$E($P(DIR(0),"^"),2,999),TYPE="D",RTYPE=1 ;If type is R then change to date look up
"RTN","ORCDLG1",148,0)
 I TYPE="D" I X="AM"!(X="NEXT")!(X="NEXTA")!(X="CLOSEST") Q 1 ;If date/time prompt default is AM, NEXT, NEXTA, or CLOSEST then accept without checking
"RTN","ORCDLG1",149,0)
 S:TYPE="P"&(X=+X) X="`"_X ;If pointer type add ` to IEN for DIR call
"RTN","ORCDLG1",150,0)
 I TYPE="P" S ORDIC=$P(DIR(0),"^",2) S $P(ORDIC,":",2)=$TR($P(ORDIC,":",2),"QE","") S $P(DIR(0),"^",2)=ORDIC ;If pointer type remove Q&E from DIC(0) so no echo and no ?? on erroneous input
"RTN","ORCDLG1",151,0)
 I TYPE="D" S ORDIC=$P(DIR(0),"^",2) S $P(ORDIC,":",3)=$TR($P(ORDIC,":",3),"E",""),$P(ORDIC,":")=$TR($P(ORDIC,":"),"DTNOW",""),$P(DIR(0),"^",2)=ORDIC ;Remove "E" so no echo, remove DT and NOW so DIR call works correctly
"RTN","ORCDLG1",152,0)
 I TYPE="Y" S:"^Y^YE^YES^"[("^"_$TR(X,"yes","YES")_"^")!(X=1) X="YES" S:"^N^NO^"[("^"_$TR(X,"no","NO")_"^")!(X=0) X="NO" ;If yes/no type convert input to uppercase full entry to avoid echo
"RTN","ORCDLG1",153,0)
 I TYPE="S" S DDS=1 ;Stops DIR call from echoing rest of entry for set of codes
"RTN","ORCDLG1",154,0)
 D ^DIR
"RTN","ORCDLG1",155,0)
 I TYPE="D"&('$D(Y(0))) Q 0 ;Date not valid
"RTN","ORCDLG1",156,0)
 I TYPE="L"&($G(Y)="") Q 0 ;List/Range not valid
"RTN","ORCDLG1",157,0)
 I TYPE="N"&('$D(Y)) Q 0 ;Numeric not valid
"RTN","ORCDLG1",158,0)
 I TYPE="P"&($G(Y)=-1) Q 0 ;Pointer not valid
"RTN","ORCDLG1",159,0)
 I TYPE="S"&($G(Y(0))="") Q 0 ;Set of codes not valid
"RTN","ORCDLG1",160,0)
 I TYPE="Y"&($G(Y(0))="") Q 0 ;Yes/No not valid
"RTN","ORCDLG1",161,0)
 I TYPE="F" S RANGE=$P(DIR(0),"^",2),MIN=$S($P(RANGE,":"):$P(RANGE,":"),1:1),MAX=$S($P(RANGE,":",2):$P(RANGE,":",2),1:240) I $L(Y)<MIN!($L(Y)>MAX) Q 0 ;Free text and not within valid limit
"RTN","ORCDLG1",162,0)
 I $G(RTYPE) S Y=ORIG ;Set y back to relative date
"RTN","ORCDLG1",163,0)
 I TYPE="P" S Y=$P(Y,"^") ;only store IEN ;110
"RTN","ORCDLG1",164,0)
 Q 1 ;Must be valid
"RTN","ORCHTAB3")
0^7^B42604740
"RTN","ORCHTAB3",1,0)
ORCHTAB3 ;SLC/MKB,dcm-Add item to tab listing ;12/6/01  15:06
"RTN","ORCHTAB3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**27,45,86,92,110**;Dec 17, 1997
"RTN","ORCHTAB3",3,0)
ORDER ; -- order
"RTN","ORCHTAB3",4,0)
 N ID,ORACT,OR0,OR3,ORA0,DATES,TIMES,STATUS,PROV,ORVER,DATA,ORIGVIEW,ORTX,IDX,ORJ,J
"RTN","ORCHTAB3",5,0)
 S ID=ORIFN,ORACT=+$P(ORIFN,";",2) S:'ORACT ORACT=1
"RTN","ORCHTAB3",6,0)
 S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3)),ORA0=$G(^(8,ORACT,0))
"RTN","ORCHTAB3",7,0)
 D DATES S ORVER=$$VERIFIED ;set DATES, [TIMES], ORVER
"RTN","ORCHTAB3",8,0)
 S STATUS=$S($P(ORA0,U,15):$P(ORA0,U,15),1:$P(OR3,U,3))
"RTN","ORCHTAB3",9,0)
 I $P(ORA0,U,15)=10,$P(OR3,U,3)=14 S STATUS=14 ;delayed-lapsed order
"RTN","ORCHTAB3",10,0)
 S:FRMT="S" STATUS=$$LOW^XLFSTR($P($G(^ORD(100.01,+STATUS,0)),U)),DATA(1)=$$PAD^ORCHTAB(DATES,16)_$$PAD^ORCHTAB(STATUS,17)_ORVER,DATA=1
"RTN","ORCHTAB3",11,0)
ORD1 I FRMT'="S" D
"RTN","ORCHTAB3",12,0)
 . S STATUS=$P($G(^ORD(100.01,+STATUS,0)),U,2)
"RTN","ORCHTAB3",13,0)
 . S PROV=+$S($P(ORA0,U,5):$P(ORA0,U,5),1:$P(ORA0,U,3))
"RTN","ORCHTAB3",14,0)
 . S DATA(1)=$$PAD^ORCHTAB($$LNAMEF^ORCHTAB(PROV),12)_$$PAD^ORCHTAB(DATES,17)_$$PAD^ORCHTAB(STATUS,4)_ORVER,DATA=1
"RTN","ORCHTAB3",15,0)
 . I $L($G(TIMES)) S DATA=2,DATA(2)="            "_TIMES
"RTN","ORCHTAB3",16,0)
 S ORIGVIEW=$S(MULT:0,$P(CONTEXT,";",3)'=2:1,'ORYD:1,$P(ORA0,U)'<ORYD:0,1:1)
"RTN","ORCHTAB3",17,0)
 D TEXT^ORQ12(.ORTX,ORIFN,40) ; get order text
"RTN","ORCHTAB3",18,0)
ORD2 D ADD^ORCHTAB S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NUM))
"RTN","ORCHTAB3",19,0)
 I $O(^OR(100,+ORIFN,2,0)) S ORJ=+$P(IDX,U,2),$E(^TMP("OR",$J,ORTAB,ORJ,0),5)="+" ;child orders exist
"RTN","ORCHTAB3",20,0)
 I $P(ORA0,U,14)>1 S ORJ=+$P(IDX,U,2),$E(^TMP("OR",$J,ORTAB,ORJ,0),5)="*" ;pkg updated
"RTN","ORCHTAB3",21,0)
 I $P($G(^OR(100,+ORIFN,8,ORACT,3)),U) D  ; flagged
"RTN","ORCHTAB3",22,0)
 . S ORJ=+$P(IDX,U,2) K ^TMP("OR",$J,ORTAB,"VIDEO",ORJ)
"RTN","ORCHTAB3",23,0)
 . D SETVIDEO^ORCHTAB(ORJ,1,3,IORVON,IORVOFF)
"RTN","ORCHTAB3",24,0)
 F ORJ=+$P(IDX,U,2):1:($P(IDX,U,2)+$P(IDX,U,3)-1) D  ; unsigned
"RTN","ORCHTAB3",25,0)
 . S J=$F(^TMP("OR",$J,ORTAB,ORJ,0),"*UNSIGNED*")
"RTN","ORCHTAB3",26,0)
 . D:J SETVIDEO^ORCHTAB(ORJ,J-10,10,IOINHI,IOINORM)
"RTN","ORCHTAB3",27,0)
 Q
"RTN","ORCHTAB3",28,0)
 ;
"RTN","ORCHTAB3",29,0)
DELAYED ; -- Delayed order
"RTN","ORCHTAB3",30,0)
 N OR0,ORA0,OR3,ORIGVIEW,ORTX,PROV,SPEC,ID,IDX,ORJ,J,STATUS,ORC,ORD,ORVER,DATA
"RTN","ORCHTAB3",31,0)
 S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3)),ORA0=$G(^(8,1,0))
"RTN","ORCHTAB3",32,0)
 S PROV=+$S($P(ORA0,U,5):$P(ORA0,U,5),1:$P(ORA0,U,3)),ORIGVIEW=1
"RTN","ORCHTAB3",33,0)
 S STATUS=$$LOW^XLFSTR($P($G(^ORD(100.01,+$P(OR3,U,3),0)),U))
"RTN","ORCHTAB3",34,0)
 S SPEC=$P($G(^DIC(45.7,+$P(OR0,U,13),0)),U),ORVER=$$VERIFIED
"RTN","ORCHTAB3",35,0)
 S ORD=$S(STS=16:STATUS,1:SPEC),ORC=$S(STS=16:"Status",1:"To Specialty")
"RTN","ORCHTAB3",36,0)
 I FRMT="S" S DATA(1)=$$PAD^ORCHTAB(ORD,33)_ORVER,ORCAPTN("DATA")=ORC
"RTN","ORCHTAB3",37,0)
 I FRMT'="S" S DATA(1)=$$PAD^ORCHTAB($$LNAMEF^ORCHTAB(PROV),12)_$$PAD^ORCHTAB($E(ORD,1,21),21)_ORVER,ORCAPTN("DATA")="Provider    "_ORC
"RTN","ORCHTAB3",38,0)
 D TEXT^ORQ12(.ORTX,ORIFN,40) S ID=ORIFN,DATA=1
"RTN","ORCHTAB3",39,0)
 D ADD^ORCHTAB S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NUM))
"RTN","ORCHTAB3",40,0)
 F ORJ=+$P(IDX,U,2):1:($P(IDX,U,2)+$P(IDX,U,3)-1) D  ; unsigned
"RTN","ORCHTAB3",41,0)
 . S J=$F(^TMP("OR",$J,ORTAB,ORJ,0),"*UNSIGNED*")
"RTN","ORCHTAB3",42,0)
 . D:J SETVIDEO^ORCHTAB(ORJ,J-10,10,IOINHI,IOINORM)
"RTN","ORCHTAB3",43,0)
 Q
"RTN","ORCHTAB3",44,0)
 ;
"RTN","ORCHTAB3",45,0)
DATES ; -- Return start and stop dates for display in DATES [,TIMES]
"RTN","ORCHTAB3",46,0)
 N SHORT,ACT,START,STOP,T1,T2
"RTN","ORCHTAB3",47,0)
 S DATES="",SHORT=(FRMT="S"),ACT=$P(ORA0,U,2)
"RTN","ORCHTAB3",48,0)
 S START=$S($P(OR3,U,3)=11:$$VALUE^ORX8(+ORIFN,"START"),ACT="NW"!(ACT="XX")!(ACT="RL"):$P(OR0,U,8),ACT="DC":"",1:$P(ORA0,U)) ;110
"RTN","ORCHTAB3",49,0)
 S STOP=$S(SHORT:"",$P(OR3,U,3)=11:$$VALUE^ORX8(+ORIFN,"STOP"),ACT="HD":$P($G(^OR(100,+ORIFN,8,ORACT,2)),U),1:$P(OR0,U,9))
"RTN","ORCHTAB3",50,0)
 I '$L(STOP) D  Q  ;Short format or no Stop date/time
"RTN","ORCHTAB3",51,0)
 . S START=$$DATETIME^ORCHTAB(START) S:SHORT DATES=$E(START,1,14)
"RTN","ORCHTAB3",52,0)
 . S:'SHORT DATES=$E($P(START," "),1,14),TIMES=$E($P(START," ",2),1,14)
"RTN","ORCHTAB3",53,0)
 S STOP=$$DATETIME^ORCHTAB(STOP),T2=$P(STOP," ",2)
"RTN","ORCHTAB3",54,0)
 I '$L(START) D  Q  ;Long format but no Start date/time
"RTN","ORCHTAB3",55,0)
 . S DATES=$J($E($P(STOP," "),1,14),15)
"RTN","ORCHTAB3",56,0)
 . S:$L(T2) TIMES=$J($E(T2,1,14),15)
"RTN","ORCHTAB3",57,0)
 S START=$$DATETIME^ORCHTAB(START,1),T1=$P(START," ",2)
"RTN","ORCHTAB3",58,0)
 S DATES=$$LJ^XLFSTR($E($P(START," "),1,5),5)_"  "_$J($E($P(STOP," "),1,8),8)
"RTN","ORCHTAB3",59,0)
 S:$L(T1)!$L(T2) TIMES=$$LJ^XLFSTR($E(T1,1,5),10)_$J($E(T2,1,5),5)
"RTN","ORCHTAB3",60,0)
 Q
"RTN","ORCHTAB3",61,0)
 ;
"RTN","ORCHTAB3",62,0)
VERIFIED() ; -- Returns string of verifiers' initials
"RTN","ORCHTAB3",63,0)
 N ORV,ORX,ORVER S ORVER=""
"RTN","ORCHTAB3",64,0)
 F ORV=8,10,18 D  ;ck nurse, clerk, and chart reviewers
"RTN","ORCHTAB3",65,0)
 . S ORX=$P(ORA0,U,ORV) I ORX'>0 S ORVER=ORVER_"       " Q
"RTN","ORCHTAB3",66,0)
 . S ORX=$$INITIALS(ORX),ORVER=ORVER_$$LJ^XLFSTR(ORX,7)
"RTN","ORCHTAB3",67,0)
 Q ORVER
"RTN","ORCHTAB3",68,0)
 ;
"RTN","ORCHTAB3",69,0)
INITIALS(USER) ; -- Return initials of USER
"RTN","ORCHTAB3",70,0)
 N X,Y S X=$G(^VA(200,+$G(USER),0)),Y=$P(X,U,2)
"RTN","ORCHTAB3",71,0)
 S:'$L(Y) Y=" x "
"RTN","ORCHTAB3",72,0)
 Q Y
"RTN","ORCHTAB3",73,0)
 ;
"RTN","ORCHTAB3",74,0)
MEDS ; -- medications
"RTN","ORCHTAB3",75,0)
 N ID,START,STOP,STATUS,ORIFN,TYPE,DATA,ORTX,PROV,I,X,IDX,ORJ
"RTN","ORCHTAB3",76,0)
 S ID=$P(ORX,U),STOP=$P(ORX,U,4),ORIFN=$P(ORX,U,8)
"RTN","ORCHTAB3",77,0)
 S PROV=$S($G(^TMP("PS",$J,ORI,"P",0)):+^(0),1:+$P($G(^OR(100,+ORIFN,0)),U,4))
"RTN","ORCHTAB3",78,0)
 S STATUS=$$LOW^XLFSTR($P(ORX,U,9)) S:STATUS["(edit)" STATUS="dc/edit"
"RTN","ORCHTAB3",79,0)
 S:STATUS="suspended" STATUS="active/susp"
"RTN","ORCHTAB3",80,0)
 S:'INPT DATA(1)=$$PAD^ORCHTAB($$LNAMEF^ORCHTAB(PROV),12)_$$PAD^ORCHTAB($$DATE^ORCHTAB(STOP),10)_STATUS,DATA=1 I INPT D
"RTN","ORCHTAB3",81,0)
 . S START=$P($G(^OR(100,+ORIFN,0)),U,8),START=$$DATETIME^ORCHTAB(START)
"RTN","ORCHTAB3",82,0)
 . S STOP=$$DATETIME^ORCHTAB(STOP)
"RTN","ORCHTAB3",83,0)
 . S DATA(1)=$$PAD^ORCHTAB($P(START," "),10)_$$PAD^ORCHTAB($P(STOP," "),10)_STATUS
"RTN","ORCHTAB3",84,0)
 . S DATA=2,DATA(2)=$$PAD^ORCHTAB($P(START," ",2),10)_$P(STOP," ",2)
"RTN","ORCHTAB3",85,0)
 S TYPE=$S($O(^TMP("PS",$J,ORI,"B",0)):"IV",$O(^TMP("PS",$J,ORI,"A",0)):"IV",1:"DRUG") D @TYPE
"RTN","ORCHTAB3",86,0)
 D ADD^ORCHTAB K ORTX,DATA I INPT D
"RTN","ORCHTAB3",87,0)
 . S I=0 F  S I=$O(^TMP("PS",$J,ORI,"SIO",I)) Q:I'>0  S X=$G(^(I,0)) D:$L(X) TXT^ORCHTAB
"RTN","ORCHTAB3",88,0)
 . S I=0 F  S I=$O(ORTX(I)) Q:I'>0  S X=ORTX(I) D:$L(X) LINE^ORCHTAB
"RTN","ORCHTAB3",89,0)
 I 'INPT,$P(ORX,U,10) D
"RTN","ORCHTAB3",90,0)
 . S X=" Last Filled: "_$$DATE^ORCHTAB($P(ORX,U,10))_", "_+$P(ORX,U,5)_" refill(s) left"
"RTN","ORCHTAB3",91,0)
 . D LINE^ORCHTAB
"RTN","ORCHTAB3",92,0)
 S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NUM))
"RTN","ORCHTAB3",93,0)
 I $O(^OR(100,+ORIFN,8,"C","XX",0)) S ORJ=+$P(IDX,U,2),$E(^TMP("OR",$J,ORTAB,ORJ,0),5)="*" ;pkg updated
"RTN","ORCHTAB3",94,0)
 Q
"RTN","ORCHTAB3",95,0)
 ;
"RTN","ORCHTAB3",96,0)
DRUG ; -- UD or Outpt med
"RTN","ORCHTAB3",97,0)
 N I,X,NODE S X=$P(ORX,U,2),NODE="" ; drug name
"RTN","ORCHTAB3",98,0)
 I 'INPT,$P(ORX,U,12) S X=X_"  Qty: "_$P(ORX,U,12)_$S($P(ORX,U,11):" for "_$P(ORX,U,11)_" days",1:"")
"RTN","ORCHTAB3",99,0)
 S:$L(X)'>ORMAX ORTX=1,ORTX(1)=X I $L(X)>ORMAX D TXT^ORCHTAB
"RTN","ORCHTAB3",100,0)
 S ORTX=ORTX+1,ORTX(ORTX)=$S(INPT:" Give:",1:" Sig:")_$S($P(ORX,U,13):" *** NOT TO BE GIVEN ***",1:"")
"RTN","ORCHTAB3",101,0)
 I INPT S X=$S($L($P(ORX,U,6)):$P(ORX,U,6),1:$P(ORX,U,7)) I $L(X) D TXT^ORCHTAB G D1
"RTN","ORCHTAB3",102,0)
 S NODE=$S(INPT:"SIG",$O(^TMP("PS",$J,ORI,"SIG",0)):"SIG",1:"SIO")
"RTN","ORCHTAB3",103,0)
 S I=0 F  S I=$O(^TMP("PS",$J,ORI,NODE,I)) Q:I'>0  S X=$G(^(I,0)) D:$L(X) TXT^ORCHTAB ; instructions or sig
"RTN","ORCHTAB3",104,0)
D1 I 'INPT,NODE'="SIO" Q  ; done
"RTN","ORCHTAB3",105,0)
 S I=$O(^TMP("PS",$J,ORI,"MDR",0)),X=$G(^(+I,0)) D:$L(X) TXT^ORCHTAB
"RTN","ORCHTAB3",106,0)
 S I=$O(^TMP("PS",$J,ORI,"SCH",0)),X=$P($G(^(+I,0)),U) D:$L(X) TXT^ORCHTAB
"RTN","ORCHTAB3",107,0)
 Q
"RTN","ORCHTAB3",108,0)
 ;
"RTN","ORCHTAB3",109,0)
IV ; -- IV Fluid
"RTN","ORCHTAB3",110,0)
 N I,X
"RTN","ORCHTAB3",111,0)
 S I=0,X="" F  S I=$O(^TMP("PS",$J,ORI,"A",I)) Q:I'>0  S X=X_$S($L(X):", ",1:"")_$TR(^(I,0),"^"," ")
"RTN","ORCHTAB3",112,0)
 I $L(X) S X=X_" in" D TXT^ORCHTAB
"RTN","ORCHTAB3",113,0)
 S I=0,X="" F  S I=$O(^TMP("PS",$J,ORI,"B",I)) Q:I'>0  S X=X_$S($L(X):", ",1:"")_$TR(^(I,0),"^"," ")
"RTN","ORCHTAB3",114,0)
 D:$L(X) TXT^ORCHTAB S I=$O(^TMP("PS",$J,ORI,"SCH",0))
"RTN","ORCHTAB3",115,0)
 I I S X=$P($G(^(I,0)),U) D:$L(X) TXT^ORCHTAB Q  ;add schedule and Q if exists
"RTN","ORCHTAB3",116,0)
 S X=$P(ORX,U,3) D:$L(X) TXT^ORCHTAB ;infusion rate
"RTN","ORCHTAB3",117,0)
 Q
"RTN","ORCHTAB3",118,0)
 ;
"RTN","ORCHTAB3",119,0)
SORT(TYPE) ; -- sort Meds tab by status into ^TMP("ORPS",$J,STS)
"RTN","ORCHTAB3",120,0)
 N ACTIVE,NONACT,NONVER,I,X,ID,STS,SUB
"RTN","ORCHTAB3",121,0)
 S ACTIVE="^ACTIVE^REINSTATED^RENEWED^HOLD^ON CALL^SUSPENDED^REFILL^PROVIDER HOLD^",NONVER="^PENDING^NON-VERIFIED^NON VERIFIED^INCOMPLETE^DRUG INTERACTIONS^"
"RTN","ORCHTAB3",122,0)
 S NONACT="^DONE^EXPIRED^DISCONTINUED^DELETED^PURGE^DISCONTINUED (EDIT)^DISCONTINUED (RENEWAL)^DISCONTINUED BY PROVIDER^"
"RTN","ORCHTAB3",123,0)
 S I=0 F  S I=$O(^TMP("PS",$J,I)) Q:I'>0  S X=$G(^(I,0)) D
"RTN","ORCHTAB3",124,0)
 . S ID=$P(X,U) Q:INPT&($P(ID,";",2)'="I")  Q:'INPT&($P(ID,";",2)="I")
"RTN","ORCHTAB3",125,0)
 . S STS=U_$P(X,U,9)_U,SUB=$S(ACTIVE[STS:1,NONVER[STS:2,1:3),^TMP("ORPS",$J,SUB,I)=""
"RTN","ORCHTAB3",126,0)
 Q
"RTN","ORCMEDT1")
0^4^B41953303
"RTN","ORCMEDT1",1,0)
ORCMEDT1 ;SLC/MKB-QO,Set editor ;11/6/01  13:33
"RTN","ORCMEDT1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**8,46,57,95,110**;Dec 17, 1997
"RTN","ORCMEDT1",3,0)
OI ; -- Enter/edit generic orderable items
"RTN","ORCMEDT1",4,0)
 N X,Y,DA,DR,DIE,DIC,ID,DLAYGO,ORDG
"RTN","ORCMEDT1",5,0)
 F  S ORDG=$$DGRP Q:ORDG'>0  D  W !!
"RTN","ORCMEDT1",6,0)
 . F  S D="S."_$P(ORDG,U,4) D   Q:Y'>0  S DA=+Y,ID=DA_";99ORD",DR=".01"_$S($P(Y,U,3):";2///^S X=ID;5////"_+ORDG,1:"") D ^DIE W ! ;110
"RTN","ORCMEDT1",7,0)
 .. S DIC="^ORD(101.43,",DIC(0)="AEQL",DLAYGO=101.43,DIE=DIC D IX^DIC ;110
"RTN","ORCMEDT1",8,0)
 Q
"RTN","ORCMEDT1",9,0)
 ;
"RTN","ORCMEDT1",10,0)
DGRP() ; -- Returns sub-display group of Nursing or Other for generic OI
"RTN","ORCMEDT1",11,0)
 N X,Y,DIC,ORGRP,ORDG,ORI
"RTN","ORCMEDT1",12,0)
 F ORI="NURS","OTHER" S ORDG=+$O(^ORD(100.98,"B",ORI,0)) D DG^ORCHANG1(ORDG,"BILD",.ORGRP)
"RTN","ORCMEDT1",13,0)
 S DIC="^ORD(100.98,",DIC(0)="AEQ",DIC("S")="I $D(ORGRP(+Y))"
"RTN","ORCMEDT1",14,0)
 S DIC("A")="Type of Orderable: " D ^DIC
"RTN","ORCMEDT1",15,0)
 S:Y>0 Y=+Y_U_$G(^ORD(100.98,+Y,0))
"RTN","ORCMEDT1",16,0)
 Q Y
"RTN","ORCMEDT1",17,0)
 ;
"RTN","ORCMEDT1",18,0)
QUICK ; -- Enter/edit quick order dialogs
"RTN","ORCMEDT1",19,0)
 N ORQDLG,ORDG
"RTN","ORCMEDT1",20,0)
 F  S ORQDLG=$$DIALOG^ORCMEDT0("Q") Q:ORQDLG="^"  D QCK0(ORQDLG) W !
"RTN","ORCMEDT1",21,0)
 Q
"RTN","ORCMEDT1",22,0)
QCK0(ORQDLG) ; -- edit quick order ORQDLG
"RTN","ORCMEDT1",23,0)
 N ORDIALOG,DA,DR,DIE,ORQUIT,ORVP,ORL,ACTION,FIRST,ORTYPE,ORNAME,X,Y
"RTN","ORCMEDT1",24,0)
 Q:'$G(ORQDLG)  S DA=ORQDLG,(ORVP,ORL)=0,FIRST=1,ORTYPE="Z"
"RTN","ORCMEDT1",25,0)
 S ORNAME=$$NAME^ORCMEDT4(ORQDLG) Q:(ORNAME="@")!(ORNAME="^")  ;deleted,^
"RTN","ORCMEDT1",26,0)
 S DR=".01///^S X=ORNAME;2;8;20"_$S(DUZ(0)="@":";30",1:""),DIE="^ORD(101.41,"
"RTN","ORCMEDT1",27,0)
 D ^DIE Q:$D(Y)!$D(DTOUT)  D GETQDLG^ORCD(ORQDLG) Q:'$G(ORDIALOG)
"RTN","ORCMEDT1",28,0)
 I '$P($G(^ORD(101.41,ORQDLG,0)),U,7) S X=+$P($G(^ORD(101.41,+ORDIALOG,0)),U,7) S:X $P(^ORD(101.41,ORQDLG,0),U,7)=X,^ORD(101.41,"APKG",X,ORQDLG)=""
"RTN","ORCMEDT1",29,0)
 W ! I $D(^ORD(101.41,+ORDIALOG,3.1)) X ^(3.1) G:$G(ORQUIT) QQ
"RTN","ORCMEDT1",30,0)
Q1 D DIALOG^ORCDLG G:$G(ORQUIT) QQ
"RTN","ORCMEDT1",31,0)
 D DISPLAY^ORCDLG S ACTION=$$OK G:ACTION="^" QQ
"RTN","ORCMEDT1",32,0)
 D:ACTION="P" SAVE^ORCMEDT0,AUTO(ORQDLG) I ACTION="E" S FIRST=0 G Q1 ;fall thru if "C"
"RTN","ORCMEDT1",33,0)
QQ X:$D(^ORD(101.41,+ORDIALOG,4)) ^(4)
"RTN","ORCMEDT1",34,0)
 Q
"RTN","ORCMEDT1",35,0)
 ;
"RTN","ORCMEDT1",36,0)
OK() ; -- Ready to save?
"RTN","ORCMEDT1",37,0)
 N X,Y,DIR S DIR(0)="SAM^P:PLACE;E:EDIT;C:CANCEL;",DIR("B")="PLACE"
"RTN","ORCMEDT1",38,0)
 S DIR("A")="(P)lace, (E)dit, or (C)ancel this quick order? "
"RTN","ORCMEDT1",39,0)
 S DIR("?")="Enter P to save this quick order, or E to change any of the displayed values; enter C to quit without saving these responses"
"RTN","ORCMEDT1",40,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCMEDT1",41,0)
 Q Y
"RTN","ORCMEDT1",42,0)
 ;
"RTN","ORCMEDT1",43,0)
SAVE G SAVE^ORCMEDT0
"RTN","ORCMEDT1",44,0)
 ;
"RTN","ORCMEDT1",45,0)
AUTO(DLG) ; -- set AutoAccept flag for GUI
"RTN","ORCMEDT1",46,0)
 N X,Y,DIR
"RTN","ORCMEDT1",47,0)
 S DIR(0)="YA",DIR("A")="Auto-accept this order? "
"RTN","ORCMEDT1",48,0)
 S DIR("B")=$S($P($G(^ORD(101.41,+DLG,5)),U,8):"YES",1:"NO")
"RTN","ORCMEDT1",49,0)
 S DIR("?")="Enter YES if this order can be placed simply by selecting it, or NO if the dialog should be presented to complete the order."
"RTN","ORCMEDT1",50,0)
 D ^DIR S:Y=1!(Y=0) $P(^ORD(101.41,+DLG,5),U,8)=$S(Y:1,1:"")
"RTN","ORCMEDT1",51,0)
 I $P($G(^ORD(101.41,+DLG,0)),"^",8)'=1&($P($G(^(0)),"^",9)=2)&(Y) D EXPLAIN S $P(^ORD(101.41,+DLG,5),"^",8)="" ;Reset auto-accept to no if explanation required. 
"RTN","ORCMEDT1",52,0)
 Q
"RTN","ORCMEDT1",53,0)
 ;
"RTN","ORCMEDT1",54,0)
SET ; -- Order Sets
"RTN","ORCMEDT1",55,0)
 N ORSET,ORDG
"RTN","ORCMEDT1",56,0)
 F  S ORSET=$$DIALOG^ORCMEDT0("O") Q:ORSET="^"  D SET0(ORSET) W !
"RTN","ORCMEDT1",57,0)
 Q
"RTN","ORCMEDT1",58,0)
SET0(ORSET) ; -- edit order set ORSET
"RTN","ORCMEDT1",59,0)
 N DA,DR,DIE,DIC,DIK,X,Y,SEQ,ITM,LCNT,QUIT,ORNAME Q:'$G(ORSET)
"RTN","ORCMEDT1",60,0)
 S ORNAME=$$NAME^ORCMEDT4(ORSET) Q:(ORNAME="@")!(ORNAME="^")  ;deleted,^
"RTN","ORCMEDT1",61,0)
 S DR=".01///^S X=ORNAME;2;20"_$S(DUZ(0)="@":";30;40",1:""),DA=ORSET
"RTN","ORCMEDT1",62,0)
 S DIE="^ORD(101.41," D ^DIE Q:$D(Y)  Q:'$G(DA)
"RTN","ORCMEDT1",63,0)
S1 I $O(^ORD(101.41,+ORSET,10,0)) D  Q:QUIT  ;Show existing components
"RTN","ORCMEDT1",64,0)
 . W !,"ORDER SET COMPONENTS:" S (SEQ,LCNT,QUIT)=0
"RTN","ORCMEDT1",65,0)
 . S DIK="^ORD(101.41,"_+ORSET_",10,",DA(1)=+ORSET ;just in case
"RTN","ORCMEDT1",66,0)
 . F  S SEQ=$O(^ORD(101.41,+ORSET,10,"B",SEQ)) Q:SEQ'>0  D
"RTN","ORCMEDT1",67,0)
 . . S DA=0 F  S DA=$O(^ORD(101.41,+ORSET,10,"B",SEQ,DA)) Q:DA'>0  D
"RTN","ORCMEDT1",68,0)
 . . . S ITM=$P($G(^ORD(101.41,+ORSET,10,DA,0)),U,2) I ITM'>0 D ^DIK Q
"RTN","ORCMEDT1",69,0)
 . . . S LCNT=LCNT+1 I LCNT>(IOSL-3) R !,"Press <return> to continue ...",X:DTIME S LCNT=0 I X["^" S QUIT=1 Q
"RTN","ORCMEDT1",70,0)
 . . . W !?3,SEQ,?10,$P(^ORD(101.41,ITM,0),U)
"RTN","ORCMEDT1",71,0)
S2 S QUIT=0 F  D  Q:QUIT  W ! ;Enter/edit components
"RTN","ORCMEDT1",72,0)
 . S DIC="^ORD(101.41,"_+ORSET_",10,",DIC(0)="AEQLM",D="B^D"
"RTN","ORCMEDT1",73,0)
 . S DIC("A")="Select COMPONENT SEQUENCE#: ",DIC("P")=$P(^DD(101.41,10,0),U,2)
"RTN","ORCMEDT1",74,0)
 . K DA S DA(1)=+ORSET D MIX^DIC1 I Y'>0 S QUIT=1 Q
"RTN","ORCMEDT1",75,0)
 . S DA=+Y,DIE=DIC,DR=".01;2R" D ^DIE Q:'$G(DA)
"RTN","ORCMEDT1",76,0)
 . I $D(^ORD(101.41,+ORSET,10,DA,0)),'$P(^(0),U,2) S DIK=DIE D ^DIK
"RTN","ORCMEDT1",77,0)
 Q
"RTN","ORCMEDT1",78,0)
 ;
"RTN","ORCMEDT1",79,0)
PROTOCOL ; -- Convert additional protocols to dialogs
"RTN","ORCMEDT1",80,0)
 N X,Y,DIC,ORERR
"RTN","ORCMEDT1",81,0)
 F  S DIC="^ORD(101,",DIC(0)="AEQM" D ^DIC Q:Y'>0  D  W !
"RTN","ORCMEDT1",82,0)
 . S ORP=+Y,ORM=$$MENU Q:ORM="^"  ; What about "^^"-jumping? (ORWARD)
"RTN","ORCMEDT1",83,0)
 . W !,"Converting ..." D ONE(ORP,ORM,.ORERR) I '$G(ORERR) W " done." Q
"RTN","ORCMEDT1",84,0)
 . W " unable to convert.",!,">> "_$P(ORERR,U,2) K ORERR
"RTN","ORCMEDT1",85,0)
 Q
"RTN","ORCMEDT1",86,0)
ONE(PITEM,ORADD,ERROR) ; -- Convert single item protocol, add to menu(s)
"RTN","ORCMEDT1",87,0)
 N PMENU,DMENU,NAME,ORPOS,POS,XUTL,DA,DIK
"RTN","ORCMEDT1",88,0)
 I $D(^ORD(100.99,1,101.41,PITEM,0)) S DA=PITEM,DA(1)=1,DIK="^ORD(100.99,1,101.41," D ^DIK ; delete error entry
"RTN","ORCMEDT1",89,0)
 S NAME=$P($G(^ORD(101,PITEM,0)),U),DITEM=$$ITEM^ORCONVRT(PITEM)
"RTN","ORCMEDT1",90,0)
 I 'DITEM!$D(^ORD(100.99,1,101.41,PITEM,0)) S ERROR=$G(^(0)) Q
"RTN","ORCMEDT1",91,0)
 Q:'$G(ORADD)  ;to add, may enter here with PITEM & DITEM defined
"RTN","ORCMEDT1",92,0)
ADD S PMENU=0 F  S PMENU=$O(^ORD(101,"AD",PITEM,PMENU)) Q:PMENU'>0  D  W "."
"RTN","ORCMEDT1",93,0)
 . S DMENU=$O(^ORD(101.41,"AB",$P(^ORD(101,PMENU,0),U),0)) Q:'DMENU
"RTN","ORCMEDT1",94,0)
 . S ORPOS=$$FINDXUTL(PMENU,PITEM) Q:'ORPOS
"RTN","ORCMEDT1",95,0)
 . S XUTL=$G(^XUTL("XQORM",PMENU_";ORD(101,",ORPOS,0))
"RTN","ORCMEDT1",96,0)
 . S DA=$O(^ORD(101.41,DMENU,10,"B",ORPOS,0)) I DA Q:$P(^ORD(101.41,DMENU,10,DA,0),U,2)=DITEM  S POS=$O(^ORD(101.41,DMENU,10,"B",""),-1),ORPOS=($P(POS,".")+1)_".1",DA="" ; move to end, if collision
"RTN","ORCMEDT1",97,0)
 . S DA=$$NEXT^ORCONVRT(DMENU)
"RTN","ORCMEDT1",98,0)
 . S ^ORD(101.41,DMENU,10,DA,0)=ORPOS_U_DITEM_U_$P(XUTL,U,4)_U_$S($P(XUTL,U,3)'=$P(^ORD(101.41,DITEM,0),U,2):$P(XUTL,U,3),1:"")
"RTN","ORCMEDT1",99,0)
 . S ^ORD(101.41,DMENU,10,"B",ORPOS,DA)="",^ORD(101.41,DMENU,10,"D",DITEM,DA)=""
"RTN","ORCMEDT1",100,0)
 . S ^ORD(101.41,"AD",DITEM,DMENU,DA)="",^ORD(101.41,DMENU,99)=$H
"RTN","ORCMEDT1",101,0)
 Q
"RTN","ORCMEDT1",102,0)
 ;
"RTN","ORCMEDT1",103,0)
FINDXUTL(MENU,ITEM) ; -- Returns position of ITEM in MENU
"RTN","ORCMEDT1",104,0)
 N XQORM,POS
"RTN","ORCMEDT1",105,0)
 S XQORM=MENU_";ORD(101," D XREF^XQORM
"RTN","ORCMEDT1",106,0)
 S POS=0 F  S POS=$O(^XUTL("XQORM",XQORM,POS)) Q:POS'>0  I $P(^(POS,0),U,2)=ITEM Q
"RTN","ORCMEDT1",107,0)
 Q POS
"RTN","ORCMEDT1",108,0)
 ;
"RTN","ORCMEDT1",109,0)
MENU() ; -- Add converted item to menus?
"RTN","ORCMEDT1",110,0)
 N X,Y,DIR S DIR(0)="YA"
"RTN","ORCMEDT1",111,0)
 S DIR("A")="Add this item to the same menus again? ",DIR("B")="YES"
"RTN","ORCMEDT1",112,0)
 S DIR("?")="Enter YES to have this item placed on the same menus in the Order Dialog file as it was in the Protocol file"
"RTN","ORCMEDT1",113,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCMEDT1",114,0)
 Q Y
"RTN","ORCMEDT1",115,0)
EXPLAIN ;Give reason why user can't set auto-accept to yes
"RTN","ORCMEDT1",116,0)
 W !!,"The combination of VERIFY set to NO and ASK FOR ANOTHER ORDER set to",!,"YES, DON'T ASK and AUTO-ACCEPT set to YES is not allowed."
"RTN","ORCMEDT1",117,0)
 W !!,"This combination of settings could cause CPRS to enter into an infinite loop",!,"creating the same order over and over.  If you wish to have"
"RTN","ORCMEDT1",118,0)
 W !,"AUTO-ACCEPT set to YES you must change one of the other two fields",!,"to a different value.",!!,"AUTO-ACCEPT is being set to NO for you."
"RTN","ORCMEDT1",119,0)
 Q
"RTN","ORCSIGN")
0^1^B63140853
"RTN","ORCSIGN",1,0)
ORCSIGN ;SLC/MKB-Sign/Release orders ;10/29/01  11:44
"RTN","ORCSIGN",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,56,48,79,108,110**;Dec 17, 1997
"RTN","ORCSIGN",3,0)
EN ; -- start here
"RTN","ORCSIGN",4,0)
 I '$D(^XUSEC("ORES",DUZ)),'$D(^XUSEC("ORELSE",DUZ)),'$D(^XUSEC("OREMAS",DUZ)) W !,"Insufficient privilege!" H 1 Q
"RTN","ORCSIGN",5,0)
 N ORPTLK,ORI,NMBR,IDX,ORIFN,ORSIG,OREL,ORNATR,ORPRNT,ORPRINT,ORCHART,ORQUIT,ORERR,ORES,ORDER,OROLDSTS,ORACT,X,OR0,ORA0,ORLAB,ORWAIT,ORDA,ORWORK,ORCCNAT,ORCL,ORLR
"RTN","ORCSIGN",6,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","ORCSIGN",7,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") Q:'ORNMBR
"RTN","ORCSIGN",8,0)
 D FREEZE^ORCMENU S VALMBCK="R" K OREBUILD
"RTN","ORCSIGN",9,0)
 I '$G(ORL) S ORL=$$FINDLOC S:'ORL ORL=$$LOCATION^ORCMENU1 G:ORL="^" ENQ
"RTN","ORCSIGN",10,0)
 S ORACT=$S($D(^XUSEC("ORES",DUZ)):"ES",$D(^XUSEC("OREMAS",DUZ)):"OC",$D(^XUSEC("ORELSE",DUZ)):$$SELSIG,1:"^") G:ORACT="^" ENQ
"RTN","ORCSIGN",11,0)
 S ORNATR=$S(ORACT="RS":$$NATURE,1:"") Q:ORNATR="^"
"RTN","ORCSIGN",12,0)
 S ORLR=+$O(^DIC(9.4,"C","LR",0))
"RTN","ORCSIGN",13,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) I NMBR D
"RTN","ORCSIGN",14,0)
 . S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),ORDER=$P(IDX,U)
"RTN","ORCSIGN",15,0)
 . Q:'ORDER  S:'$P(ORDER,";",2) ORDER=+ORDER_";1"
"RTN","ORCSIGN",16,0)
 . S ORIFN=+ORDER,ORDA=+$P(ORDER,";",2) K ORQUIT
"RTN","ORCSIGN",17,0)
 . D VALID Q:$G(ORQUIT)  S ORES(ORDER)=""
"RTN","ORCSIGN",18,0)
 . S:$P($G(^OR(100,ORIFN,0)),U,14)=ORLR ORES("LAB")=1
"RTN","ORCSIGN",19,0)
 . S:$P($G(^OR(100,ORIFN,8,ORDA,0)),U,4)=2 ORES("ES")=1
"RTN","ORCSIGN",20,0)
EN1 G:'$O(ORES(0)) ENQ K ORQUIT,ORWAIT
"RTN","ORCSIGN",21,0)
 D ORDCHK^ORCMENU1 G:'$O(ORES(0)) ENQ0
"RTN","ORCSIGN",22,0)
 I $G(ORQUIT) D UNLOCK G ENQ ;quit - ^ at override reason
"RTN","ORCSIGN",23,0)
 S ORSIG=$S($G(ORES("ES")):2,1:3),OREL=0
"RTN","ORCSIGN",24,0)
 I ORSIG=3 W !,"These order(s) do not require a signature."
"RTN","ORCSIGN",25,0)
 E  D  I ORSIG=2,'OREL W !,"Nothing signed or released!" D UNLOCK H 2 G ENQ
"RTN","ORCSIGN",26,0)
 . I ORACT="ES" S:$$ESIG ORSIG=1,OREL=1 Q
"RTN","ORCSIGN",27,0)
 . I ORACT="OC" S:$$ONCHART ORSIG=0,OREL=1,ORNATR="W" Q
"RTN","ORCSIGN",28,0)
 . I ORACT="RS" W:ORNATR'="I" !!,"A signature is required to RELEASE these orders; the responsible provider will",!,"be alerted to electronically sign them." S:$$ESIG ORSIG=$S(ORNATR="I":1,1:$$SIGSTS^ORX1(ORNATR)),OREL=1
"RTN","ORCSIGN",29,0)
 S ORPRNT=$$GET^XPAR("ALL","ORPF PRINT CHART COPY WHEN"),ORPRINT=0
"RTN","ORCSIGN",30,0)
 S ORCCNAT=$$CHART^ORX1($S(ORNATR="":"E",1:ORNATR)),ORCHART=0
"RTN","ORCSIGN",31,0)
 S ORLAB=0 I '$D(^XUSEC("ORES",DUZ))!$$GET^XPAR("ALL","ORPF SHOW LAB #") S ORLAB=ORLR ;show Lab# when released
"RTN","ORCSIGN",32,0)
 W !!,"Processing orders ..." D:$G(ORES("LAB")) BHS^ORMBLD(ORVP)
"RTN","ORCSIGN",33,0)
EN2 S ORDER=0 F  S ORDER=$O(ORES(ORDER)) Q:ORDER'>0  D
"RTN","ORCSIGN",34,0)
 . S OROLDSTS=$P($G(^OR(100,+ORDER,3)),U,3),OR0=$G(^(0)),ORA0=$G(^(8,+$P(ORDER,";",2),0))
"RTN","ORCSIGN",35,0)
 . N ORNP S ORNP=$P(ORA0,U,3),ORIFN=+ORDER,ORDA=+$P(ORDER,";",2)
"RTN","ORCSIGN",36,0)
 . S ORNATR=$S($P(ORA0,U,4)=3:"",1:ORNATR) ; reset nature of order for sig not reqd orders --added with patch 110
"RTN","ORCSIGN",37,0)
 . D EN^ORCSEND(ORDER,,ORSIG,OREL,ORNATR,,.ORERR),UNLK1^ORX2(ORIFN)
"RTN","ORCSIGN",38,0)
 . I $D(^TMP("ORNEW",$J,ORIFN,ORDA)) K ^(ORDA) D UNLK1^ORX2(ORIFN)
"RTN","ORCSIGN",39,0)
 . I $G(ORERR) D  S ORWAIT=1 Q
"RTN","ORCSIGN",40,0)
 . . W !!,$$ORDITEM^ORCACT(ORDER)_" "_$$STATUS(ORDER)
"RTN","ORCSIGN",41,0)
 . . W:$L($P($G(ORERR),U,2)) !,"  >> "_$P(ORERR,U,2)
"RTN","ORCSIGN",42,0)
 . I $P(ORA0,U,2)="NW",OROLDSTS=11,$P(OR0,U,14)=ORLAB,$G(^OR(100,ORIFN,4)) W !,$$ORDITEM^ORCACT(ORIFN)_"  (LB #"_+^OR(100,ORIFN,4)_")" S ORWAIT=1
"RTN","ORCSIGN",43,0)
 . I $P(ORA0,U,2)="DC",$P(OR0,U,11)=$O(^ORD(100.98,"B","DO",0)),OROLDSTS=6 D  ;dc'd active NPO
"RTN","ORCSIGN",44,0)
 . . N ORSTRT,ORDATE S ORSTRT=+$E($P($$NOW^XLFDT,".",2)_"0000",1,4)
"RTN","ORCSIGN",45,0)
 . . S ORDATE=DT D LTRAY^ORCDFH ;need late tray for reinstated diet?
"RTN","ORCSIGN",46,0)
 . D SETPRINT W "."
"RTN","ORCSIGN",47,0)
 D:$G(ORES("LAB")) BTS^ORMBLD(ORVP)
"RTN","ORCSIGN",48,0)
EN3 I $O(ORCHART(0))!$O(ORPRINT(0)) S ORCL=$$LOC^ORMEVNT I ORCL,ORCL'=ORL D
"RTN","ORCSIGN",49,0)
 . N X,Y,DIR S DIR(0)="YA",DIR("B")="YES"
"RTN","ORCSIGN",50,0)
 . S DIR("A",1)="This patient's location has been changed to "_$P($G(^SC(+ORCL,0)),U)_"."
"RTN","ORCSIGN",51,0)
 . S DIR("A")="Should the orders be printed using the new location? "
"RTN","ORCSIGN",52,0)
 . S DIR("?")="Enter NO to continue using "_$P($G(^SC(+ORL,0)),U)_" for ordering and printing, or YES to switch to the patient's current location instead"
"RTN","ORCSIGN",53,0)
 . D ^DIR S:Y ORL=ORCL
"RTN","ORCSIGN",54,0)
 D:$O(ORCHART(0)) PRINT^ORPR02(ORVP,.ORCHART,,ORL,"1^0^0^0^0")
"RTN","ORCSIGN",55,0)
 D:$O(ORPRINT(0)) PRINT^ORPR02(ORVP,.ORPRINT,,ORL,"0^1^1^1^"_$$WORK(ORNATR))
"RTN","ORCSIGN",56,0)
ENQ0 D UNOTIF S OREBUILD=1
"RTN","ORCSIGN",57,0)
ENQ D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) D:$G(ORWAIT) READ ;output
"RTN","ORCSIGN",58,0)
 Q
"RTN","ORCSIGN",59,0)
 ;
"RTN","ORCSIGN",60,0)
ESIG() ; -- Get electronic signature
"RTN","ORCSIGN",61,0)
 N CODE,X,X1,Y
"RTN","ORCSIGN",62,0)
 S CODE=$P($G(^VA(200,DUZ,20)),U,4),Y=0 I '$L(CODE) D  Q Y
"RTN","ORCSIGN",63,0)
 . W $C(7),!,"You do not have an electronic signature code."
"RTN","ORCSIGN",64,0)
 . W !,"Please contact your IRM office." ; allow to enter code here?
"RTN","ORCSIGN",65,0)
 D SIG^XUSESIG S Y=(X1'="")
"RTN","ORCSIGN",66,0)
 Q Y
"RTN","ORCSIGN",67,0)
 ;
"RTN","ORCSIGN",68,0)
ONCHART() ; -- Signed on Chart?
"RTN","ORCSIGN",69,0)
 N X,Y,DIR S DIR(0)="YA"
"RTN","ORCSIGN",70,0)
 S DIR("B")=$S($$GET^XPAR("ALL","OR SIGNED ON CHART"):"YES",1:"NO")
"RTN","ORCSIGN",71,0)
 S DIR("A")="Are you sure you want to mark these orders as already Signed on Chart? "
"RTN","ORCSIGN",72,0)
 S DIR("?")="Enter YES only if these orders have already been signed in the patient's paper chart"
"RTN","ORCSIGN",73,0)
 D ^DIR S:$D(DTOUT)!($D(DUOUT)) Y="^"
"RTN","ORCSIGN",74,0)
 Q Y
"RTN","ORCSIGN",75,0)
 ;
"RTN","ORCSIGN",76,0)
SELSIG() ; -- Select type of signature &/or release [ORELSE holders only]
"RTN","ORCSIGN",77,0)
 N X,Y,DIR,ES,ELSE
"RTN","ORCSIGN",78,0)
 D CKAUTH(.ES,.ELSE) I ES,'ELSE Q "ES" ;all may be elec signed
"RTN","ORCSIGN",79,0)
 S DIR("A")="Sign or release: ",DIR(0)="SAOM^"_$S($G(ES):"ES:Electronic Signature;",1:"")_"OC:Signed on Chart;RS:Release w/o MD Signature"
"RTN","ORCSIGN",80,0)
 S DIR("B")=$S($G(ES):"Electronic Signature",$$GET^XPAR("ALL","OR SIGNATURE DEFAULT ACTION")="OC":"Signed on Chart",1:"Release w/o MD Signature")
"RTN","ORCSIGN",81,0)
 S:$G(ES) DIR("?",1)="To electronically sign those orders that you are priviledged to, select ES."
"RTN","ORCSIGN",82,0)
 S DIR("?")="If these orders have already been signed on the paper chart, select OC.  To simply release these orders to the appropriate service for action, select RS; the requesting clinician will receive an alert to sign them."
"RTN","ORCSIGN",83,0)
 W !!,$S($G(ES):"  ES Electronic Signature  ",1:"")_"  OC Signed on Chart    RS Release w/o MD Signature",!
"RTN","ORCSIGN",84,0)
 D ^DIR S:$D(DTOUT)!($D(DUOUT))!(X="") Y="^"
"RTN","ORCSIGN",85,0)
 Q Y
"RTN","ORCSIGN",86,0)
 ;
"RTN","ORCSIGN",87,0)
CKAUTH(SIGN,NOT) ; -- Ck authorization needed
"RTN","ORCSIGN",88,0)
 N I,N,IFN,ACT S (SIGN,NOT)=0
"RTN","ORCSIGN",89,0)
 F I=1:1:$L(ORNMBR,",") S N=$P(ORNMBR,",",I) I N D
"RTN","ORCSIGN",90,0)
 . S IFN=$P($G(^TMP("OR",$J,ORTAB,"IDX",N)),U) Q:'IFN
"RTN","ORCSIGN",91,0)
 . S ACT=$P(IFN,";",2),IFN=+IFN S:ACT'>0 ACT=1
"RTN","ORCSIGN",92,0)
 . I $P($G(^OR(100,IFN,0)),U,16)<2 S SIGN=SIGN+1
"RTN","ORCSIGN",93,0)
 . E  S NOT=NOT+1
"RTN","ORCSIGN",94,0)
 Q
"RTN","ORCSIGN",95,0)
 ;
"RTN","ORCSIGN",96,0)
NATURE() ; -- Returns nature of order/activity
"RTN","ORCSIGN",97,0)
 N X,Y,DIR S DIR("A")="NATURE OF ORDER ACTIVITY: "
"RTN","ORCSIGN",98,0)
 S DIR("B")=$S($G(ORNP)=DUZ:"Policy",1:"Verbal")
"RTN","ORCSIGN",99,0)
 S DIR(0)="SAM^V:Verbal;T:Telephoned;P:Policy;"
"RTN","ORCSIGN",100,0)
 S DIR("?")="Enter how this order was requested or originated."
"RTN","ORCSIGN",101,0)
 D ^DIR S:$D(DTOUT)!($D(DUOUT)) Y="^" S:Y="P" Y="I" S:Y="T" Y="P"
"RTN","ORCSIGN",102,0)
 Q Y
"RTN","ORCSIGN",103,0)
 ;
"RTN","ORCSIGN",104,0)
SETPRINT ; -- Set print arrays
"RTN","ORCSIGN",105,0)
 I $P(^OR(100,ORIFN,3),U,3)=10 Q  ; Still delayed
"RTN","ORCSIGN",106,0)
 N Y S Y=$S($P(ORA0,U,15)=10:1,$P(ORA0,U,15)=11:1,1:0)
"RTN","ORCSIGN",107,0)
 S:Y ORPRINT=ORPRINT+1,ORPRINT(ORPRINT)=ORDER
"RTN","ORCSIGN",108,0)
 I ("R"[ORPRNT&Y)!(ORPRNT="S"&(ORSIG'=2)),ORCCNAT S ORCHART=ORCHART+1,ORCHART(ORCHART)=ORDER
"RTN","ORCSIGN",109,0)
 Q
"RTN","ORCSIGN",110,0)
 ;
"RTN","ORCSIGN",111,0)
WORK(NATR) ; -- Returns 1 or 0, to print work copies for NATR
"RTN","ORCSIGN",112,0)
 S:$G(NATR)="" NATR="E" S:'NATR NATR=+$O(^ORD(100.02,"C",NATR,0))
"RTN","ORCSIGN",113,0)
 Q +$P($G(^ORD(100.02,NATR,1)),U,5)
"RTN","ORCSIGN",114,0)
 ;
"RTN","ORCSIGN",115,0)
CHART ; -- Trigger chart signature notification
"RTN","ORCSIGN",116,0)
 N ORB S ORB=+ORVP_U_+ORIFN_U_ORNP_"^^1"
"RTN","ORCSIGN",117,0)
 D EN^OCXOERR(ORB)
"RTN","ORCSIGN",118,0)
 Q
"RTN","ORCSIGN",119,0)
 ;
"RTN","ORCSIGN",120,0)
NOTIF ; -- Trigger unsigned orders notification
"RTN","ORCSIGN",121,0)
 N ORB S ORB=+ORVP_U_+ORIFN_U_ORNP_"^^^^^1"
"RTN","ORCSIGN",122,0)
 D EN^OCXOERR(ORB)
"RTN","ORCSIGN",123,0)
 Q
"RTN","ORCSIGN",124,0)
 ;
"RTN","ORCSIGN",125,0)
UNOTIF ; -- Undo unsigned orders notification
"RTN","ORCSIGN",126,0)
 Q:$O(^OR(100,"AS",ORVP,0))  ; more left
"RTN","ORCSIGN",127,0)
 N XQAKILL,ORNIFN
"RTN","ORCSIGN",128,0)
 S ORNIFN=$O(^ORD(100.9,"B","ORDER REQUIRES ELEC SIGNATURE",0))
"RTN","ORCSIGN",129,0)
 S XQAKILL=$$XQAKILL^ORB3F1(ORNIFN) ; unsigned orders notif
"RTN","ORCSIGN",130,0)
 I $D(XQAID),$P($P(XQAID,";"),",",3)=ORNIFN D DELETE^XQALERT
"RTN","ORCSIGN",131,0)
 I '$D(XQAID) S XQAID=$P($G(^ORD(100.9,ORNIFN,0)),U,2)_","_+ORVP_","_ORNIFN D DELETEA^XQALERT K XQAID
"RTN","ORCSIGN",132,0)
 Q
"RTN","ORCSIGN",133,0)
 ;
"RTN","ORCSIGN",134,0)
VALID ; -- validate ORDER for signature/release
"RTN","ORCSIGN",135,0)
 N ORLK,ORDIALOG,OROUT
"RTN","ORCSIGN",136,0)
 I '$$VALID^ORCACT0(ORDER,ORACT,.ORERR,ORNATR) W !!,"Cannot sign "_$$ORDITEM^ORCACT(ORDER),!,"  >> "_ORERR S (ORQUIT,ORWAIT)=1 Q
"RTN","ORCSIGN",137,0)
 S ORLK=$$LOCK1^ORX2(ORIFN) I 'ORLK W !!,"Cannot sign "_$$ORDITEM^ORCACT(ORDER),!,"  >> "_$P(ORLK,U,2) S (ORQUIT,ORWAIT)=1 Q  ;order locked
"RTN","ORCSIGN",138,0)
 Q:$P($G(^OR(100,ORIFN,8,ORDA,0)),U,15)'=11  ;already released
"RTN","ORCSIGN",139,0)
 S ORDIALOG=+$P(^OR(100,ORIFN,0),U,5),OROUT=$$MSG^ORXD(ORDIALOG)
"RTN","ORCSIGN",140,0)
 I OROUT W !!,"Cannot release "_$$ORDITEM^ORCACT(ORDER),!,"  >> "_$P(OROUT,U,2) S (ORQUIT,ORWAIT)=1 Q  ;dlg out of order
"RTN","ORCSIGN",141,0)
 I ORDA'>1,$L($G(^ORD(101.41,ORDIALOG,7))) X ^(7) ;validate new orders
"RTN","ORCSIGN",142,0)
 Q
"RTN","ORCSIGN",143,0)
 ;
"RTN","ORCSIGN",144,0)
UNLOCK ; -- Unlock orders in ORES(ORDER)
"RTN","ORCSIGN",145,0)
 N ORIFN S ORIFN=0
"RTN","ORCSIGN",146,0)
 F  S ORIFN=$O(ORES(ORIFN)) Q:ORIFN'>0  D UNLK1^ORX2(+ORIFN)
"RTN","ORCSIGN",147,0)
 Q
"RTN","ORCSIGN",148,0)
 ;
"RTN","ORCSIGN",149,0)
STATUS(ORD) ; -- return [release] status of order ORD
"RTN","ORCSIGN",150,0)
 N STS,X,Y S STS=$P($G(^OR(100,+ORD,8,+$P(ORD,";",2),0)),U,15)
"RTN","ORCSIGN",151,0)
 I STS S Y=$S(STS=10:"delayed",STS=11:"not released",STS=13:"cancelled",1:"")
"RTN","ORCSIGN",152,0)
 E  S X=$P($G(^OR(100,+ORD,3)),U,3),X=$P($G(^ORD(100.01,+X,0)),U),Y=$$LOW^XLFSTR(X)
"RTN","ORCSIGN",153,0)
 Q Y
"RTN","ORCSIGN",154,0)
 ;
"RTN","ORCSIGN",155,0)
READ ; -- Press return to continue
"RTN","ORCSIGN",156,0)
 N X,Y,DIR
"RTN","ORCSIGN",157,0)
 S DIR(0)="EA",DIR("A")="Press <return> to continue ..."
"RTN","ORCSIGN",158,0)
 D ^DIR
"RTN","ORCSIGN",159,0)
 Q
"RTN","ORCSIGN",160,0)
 ;
"RTN","ORCSIGN",161,0)
FINDLOC() ; -- Determine location from selected orders
"RTN","ORCSIGN",162,0)
 N ORI,ORN,ORIFN,ORX,ORY S ORY=""
"RTN","ORCSIGN",163,0)
 F ORI=1:1:$L(ORNMBR,",") S ORN=+$P(ORNMBR,",",ORI) I ORN D  Q:ORY="^"
"RTN","ORCSIGN",164,0)
 . S ORIFN=+$G(^TMP("OR",$J,ORTAB,"IDX",ORN)) Q:'ORIFN
"RTN","ORCSIGN",165,0)
 . S ORX=$P($G(^OR(100,ORIFN,0)),U,10) Q:'ORX  S:ORY="" ORY=ORX
"RTN","ORCSIGN",166,0)
 . I ORY'="",ORY'=ORX S ORY="^" Q  ;different loc's -> prompt
"RTN","ORCSIGN",167,0)
 Q ORY
"RTN","ORMRA")
0^3^B48363657
"RTN","ORMRA",1,0)
ORMRA ; SLC/MKB - Process Radiology ORM msgs ;12/6/01  09:03
"RTN","ORMRA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,53,92,110**;Dec 17, 1997
"RTN","ORMRA",3,0)
EN ; -- entry point for RA messages
"RTN","ORMRA",4,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMRA",5,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMRA",6,0)
 S OREASON=$S($P(OREASON,U,6)="99RAR":$P(OREASON,U,5),1:$P(OREASON,U,2))
"RTN","ORMRA",7,0)
 S:'ORDUZ ORDUZ=DUZ S:'ORLOG ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORMRA",8,0)
 D @ORDCNTRL
"RTN","ORMRA",9,0)
 Q
"RTN","ORMRA",10,0)
 ;
"RTN","ORMRA",11,0)
ZP ; -- Purged
"RTN","ORMRA",12,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))  K ^OR(100,+ORIFN,4)
"RTN","ORMRA",13,0)
 ; - Set status=lapsed, if still active
"RTN","ORMRA",14,0)
 I "^3^5^6^8^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(ORIFN,14)
"RTN","ORMRA",15,0)
 Q
"RTN","ORMRA",16,0)
 ;
"RTN","ORMRA",17,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMRA",18,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMRA",19,0)
 Q
"RTN","ORMRA",20,0)
 ;
"RTN","ORMRA",21,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMRA",22,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; update Last Activity
"RTN","ORMRA",23,0)
 Q
"RTN","ORMRA",24,0)
 ;
"RTN","ORMRA",25,0)
OK ; -- Order accepted, RA order # assigned [ack]
"RTN","ORMRA",26,0)
 N ORSTS,OBR S ^OR(100,+ORIFN,4)=PKGIFN,ORSTS=5 ; 5=pending
"RTN","ORMRA",27,0)
 ; Ck if also scheduled, else quit
"RTN","ORMRA",28,0)
 S OBR=$O(@ORMSG@(+ORC)) G:'OBR OKQ G:$E(@ORMSG@(OBR),1,3)'="OBR" OKQ
"RTN","ORMRA",29,0)
 S ORSTRT=$$FMDATE^ORM($P(@ORMSG@(OBR),"|",37))
"RTN","ORMRA",30,0)
 D:ORSTRT DATES^ORCSAVE2(+ORIFN,ORSTRT)
"RTN","ORMRA",31,0)
OKQ D STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMRA",32,0)
 Q
"RTN","ORMRA",33,0)
 ;
"RTN","ORMRA",34,0)
XX ; -- Change order
"RTN","ORMRA",35,0)
 N ORDIALOG,ORDG,ORDA,ORX,ORP S:'$L(ORNATR) ORNATR="S"
"RTN","ORMRA",36,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)  S ORIFN=+ORIFN
"RTN","ORMRA",37,0)
 S ORDA=$$ACTION^ORCSAVE("XX",ORIFN,ORNP,OREASON,ORLOG,ORDUZ)
"RTN","ORMRA",38,0)
 I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMRA",39,0)
 ; -Update sts of order to active, last action to dc/edit:
"RTN","ORMRA",40,0)
 S ORX=+$P($G(^OR(100,ORIFN,3)),U,7)
"RTN","ORMRA",41,0)
 S:$P($G(^OR(100,ORIFN,8,ORX,0)),U,15)="" $P(^(0),U,15)=12
"RTN","ORMRA",42,0)
 S $P(^OR(100,ORIFN,3),U,7)=ORDA D STATUS^ORCSAVE2(ORIFN,6)
"RTN","ORMRA",43,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMRA",44,0)
 ; -If unsigned edit, leave XX unsigned & mark ORX as Sig Not Req'd
"RTN","ORMRA",45,0)
 S ORSIG=$S($P($G(^OR(100,ORIFN,8,ORX,0)),U,4)'=2:1,1:0)
"RTN","ORMRA",46,0)
 D SIGSTS^ORCSAVE2(ORIFN,ORDA):ORSIG,SIGN^ORCSAVE2(ORIFN,,,5,ORX):'ORSIG
"RTN","ORMRA",47,0)
 ; -Update responses, get/save new order text:
"RTN","ORMRA",48,0)
 K ^OR(100,ORIFN,4.5) D RESPONSE^ORCSAVE,ORDTEXT^ORCSAVE1(ORIFN_";"_ORDA)
"RTN","ORMRA",49,0)
 S $P(^OR(100,ORIFN,8,ORDA,0),U,14)=ORDA
"RTN","ORMRA",50,0)
 I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMRA",51,0)
 Q
"RTN","ORMRA",52,0)
 ;
"RTN","ORMRA",53,0)
SN ; -- New backdoor order: return NA msg w/ORIFN, or DE msg
"RTN","ORMRA",54,0)
 N ORDIALOG,ORDG,ORP K ^TMP("ORWORD",$J) S:'$L(ORNATR) ORNATR="W"
"RTN","ORMRA",55,0)
 I ORDUZ,'$D(^VA(200,ORDUZ,0)) S ORERR="Invalid entering person" Q
"RTN","ORMRA",56,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMRA",57,0)
 I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMRA",58,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)
"RTN","ORMRA",59,0)
SNQ D EN^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMRA",60,0)
 I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMRA",61,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR),SIGSTS^ORCSAVE2(ORIFN,1)
"RTN","ORMRA",62,0)
 D STATUS^ORCSAVE2(ORIFN,5) S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMRA",63,0)
 I $G(ORL) S ORP(1)=ORIFN_";1^1" D PRINTS^ORWD1(.ORP,+ORL) ; chart copy
"RTN","ORMRA",64,0)
 Q
"RTN","ORMRA",65,0)
 ;
"RTN","ORMRA",66,0)
DLG ; -- Build ORDIALOG() from msg
"RTN","ORMRA",67,0)
 N OBR,OI,MODS,J,X,Y,ILOC,MODE,CH,CHI,OBX,NTE
"RTN","ORMRA",68,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","RA OERR EXAM",0))
"RTN","ORMRA",69,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMRA",70,0)
 S ORDIALOG($$PTR("CATEGORY"),1)=$G(ORCAT)
"RTN","ORMRA",71,0)
 S ORDIALOG($$PTR("START DATE/TIME"),1)=ORSTRT
"RTN","ORMRA",72,0)
 S ORDIALOG($$PTR("URGENCY"),1)=ORURG
"RTN","ORMRA",73,0)
 S:$P(ORC,"|",12) ORDIALOG($$PTR("PROVIDER"),1)=+$P(ORC,"|",12)
"RTN","ORMRA",74,0)
D1 S OBR=$O(@ORMSG@(+ORC)) I 'OBR!($E($G(@ORMSG@(OBR)),1,3)'="OBR") S ORERR="Missing OBR segment" Q
"RTN","ORMRA",75,0)
 S OI=$$ORDITEM^ORM($P(@ORMSG@(OBR),"|",5))
"RTN","ORMRA",76,0)
 I 'OI S ORERR="Invalid procedure" Q
"RTN","ORMRA",77,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=OI
"RTN","ORMRA",78,0)
 S ORDG=$P($G(^ORD(101.43,+OI,"RA")),U,3) S:$L(ORDG) ORDG=+$O(^ORD(100.98,"B",ORDG,0)) I 'ORDG S ORDG=$P(^ORD(101.41,+ORDIALOG,0),U,5) ; Im Type
"RTN","ORMRA",79,0)
 S MODS=$P(@ORMSG@(OBR),"|",19) I $L(MODS) D
"RTN","ORMRA",80,0)
 . F J=1:1:$L(MODS,"~") S X=$P(MODS,"~",J) I $L(X) S Y=$O(^RAMIS(71.2,"B",X,0)) S:Y ORDIALOG($$PTR("MODIFIERS"),J)=Y
"RTN","ORMRA",81,0)
 S ILOC=+$P(@ORMSG@(OBR),"|",20),MODE=$P(@ORMSG@(OBR),"|",31)
"RTN","ORMRA",82,0)
 S:ILOC ORDIALOG($$PTR("IMAGING LOCATION"),1)=ILOC
"RTN","ORMRA",83,0)
 S ORDIALOG($$PTR("MODE OF TRANSPORT"),1)=$S(MODE="WALK":"A",MODE="CART":"S",1:$E(MODE))
"RTN","ORMRA",84,0)
 I ORDCNTRL="XX" S NTE=+$O(@ORMSG@(OBR)) I NTE,$E($G(@ORMSG@(NTE)),1,3)="NTE" S OREASON=$P(@ORMSG@(NTE),"|",4) ;Tech's Comments
"RTN","ORMRA",85,0)
D2 ; might the procedure be scheduled at this point ??  Not in spec
"RTN","ORMRA",86,0)
 S CH=$$PTR("WORD PROCESSING 1"),CHI=0
"RTN","ORMRA",87,0)
 S OBX=OBR F  S OBX=$O(@ORMSG@(OBX)) Q:OBX'>0  S J=$E(@ORMSG@(OBX),1,3) Q:J="ORC"  Q:J="MSH"  I J="OBX" D
"RTN","ORMRA",88,0)
 . N NAME,VALUE,X0 S VALUE=$P(@ORMSG@(OBX),"|",6)
"RTN","ORMRA",89,0)
 . S NAME=$$UP^XLFSTR($P($P(@ORMSG@(OBX),"|",4),U,2))
"RTN","ORMRA",90,0)
 . I NAME="CONTRACT/SHARING SOURCE" S X0=$G(^DIC(34,+VALUE,0)) S:$L(X0) ORDIALOG($$PTR(NAME),1)=+VALUE,ORDIALOG($$PTR("CATEGORY"),1)=$P(X0,U,2) Q
"RTN","ORMRA",91,0)
 . I NAME="RESEARCH SOURCE" S ORDIALOG($$PTR(NAME),1)=VALUE,ORDIALOG($$PTR("CATEGORY"),1)="R" Q
"RTN","ORMRA",92,0)
 . I NAME="PREGNANT" S ORDIALOG($$PTR(NAME),1)=VALUE Q
"RTN","ORMRA",93,0)
 . I NAME="PRE-OP SCHEDULED DATE/TIME" S ORDIALOG($$PTR(NAME),1)=$$FMDATE^ORM(VALUE) Q
"RTN","ORMRA",94,0)
 . S CHI=CHI+1,^TMP("ORWORD",$J,CH,1,CHI,0)=VALUE
"RTN","ORMRA",95,0)
 S:CHI ^TMP("ORWORD",$J,CH,1,0)="^^"_CHI_U_CHI_U_DT_U,ORDIALOG(CH,1)="^TMP(""ORWORD"",$J,"_CH_",1)"
"RTN","ORMRA",96,0)
 Q
"RTN","ORMRA",97,0)
 ;
"RTN","ORMRA",98,0)
PTR(X) ; -- Returns ptr to prompt in Order Dialog file #101.41
"RTN","ORMRA",99,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORMRA",100,0)
 ;
"RTN","ORMRA",101,0)
SC ; -- Status changed (scheduled, registered, or unverified)
"RTN","ORMRA",102,0)
 N ORSTS,OBR,OR3 ;110
"RTN","ORMRA",103,0)
 S ORSTS=$S(ORDSTS="ZR":6,ORDSTS="ZU":6,1:8),OR3=$G(^OR(100,+ORIFN,3)) ;110
"RTN","ORMRA",104,0)
 S OBR=$O(@ORMSG@(+ORC)) I 'OBR!($E($G(@ORMSG@(OBR)),1,3)'="OBR") S ORERR="Missing OBR segment" Q
"RTN","ORMRA",105,0)
 S ORSTRT=$$FMDATE^ORM($P(@ORMSG@(OBR),"|",37))
"RTN","ORMRA",106,0)
 D:ORSTRT DATES^ORCSAVE2(+ORIFN,ORSTRT)
"RTN","ORMRA",107,0)
 I $P(OR3,U,3)=3,$P($G(^OR(100,+ORIFN,8,+$P(OR3,U,7),0)),U,2)="HD" D RL ;If status is hold and current action is hold then release.  Added with 110
"RTN","ORMRA",108,0)
SCQ D STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMRA",109,0)
 Q
"RTN","ORMRA",110,0)
 ;
"RTN","ORMRA",111,0)
RE ; -- Completed, w/results
"RTN","ORMRA",112,0)
 D STATUS^ORCSAVE2(ORIFN,2)
"RTN","ORMRA",113,0)
 Q
"RTN","ORMRA",114,0)
 ;
"RTN","ORMRA",115,0)
OH ; -- Held
"RTN","ORMRA",116,0)
 D UPDATE(3,"HD")
"RTN","ORMRA",117,0)
 Q
"RTN","ORMRA",118,0)
 ;
"RTN","ORMRA",119,0)
OC ; -- Cancelled/Unable to accept [ack]
"RTN","ORMRA",120,0)
UA ; -- Unable to accept [ack]
"RTN","ORMRA",121,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMRA",122,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_U_ORLOG_U_U_OREASON
"RTN","ORMRA",123,0)
 D STATUS^ORCSAVE2(ORIFN,13)
"RTN","ORMRA",124,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMRA",125,0)
 N DA S DA=+$P(ORIFN,";",2) I DA D
"RTN","ORMRA",126,0)
 . S $P(^OR(100,+ORIFN,8,DA,0),U,15)=13 ;Request rejected
"RTN","ORMRA",127,0)
 . S:$L(OREASON) ^OR(100,+ORIFN,8,DA,1)=OREASON
"RTN","ORMRA",128,0)
 Q
"RTN","ORMRA",129,0)
 ;
"RTN","ORMRA",130,0)
OD ; -- Discontinued
"RTN","ORMRA",131,0)
 S:$G(DGPMT) ORDUZ="" ;auto-dc on movement
"RTN","ORMRA",132,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORDUZ_U_ORLOG_U_U_OREASON
"RTN","ORMRA",133,0)
 D UPDATE(1,"DC")
"RTN","ORMRA",134,0)
 Q
"RTN","ORMRA",135,0)
 ;
"RTN","ORMRA",136,0)
DR ; -- Discontinued [ack]
"RTN","ORMRA",137,0)
 D STATUS^ORCSAVE2(ORIFN,1)
"RTN","ORMRA",138,0)
 Q
"RTN","ORMRA",139,0)
 ;
"RTN","ORMRA",140,0)
UPDATE(ORSTS,ORACT) ; -- continue processing
"RTN","ORMRA",141,0)
 N ORX,ORDA,ORP D:$G(ORSTS) STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMRA",142,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMRA",143,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON,ORLOG,ORDUZ)
"RTN","ORMRA",144,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMRA",145,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMRA",146,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMRA",147,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMRA",148,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMRA",149,0)
 I 'ORX D  ;no new action created
"RTN","ORMRA",150,0)
 . I ORACT="DC" S:'$$ACTV^ORX1(ORNATR) $P(^OR(100,+ORIFN,3),U,7)=0 Q
"RTN","ORMRA",151,0)
 . S:ORACT="HD"&$L(OREASON) ^OR(100,+ORIFN,8,1,1)=OREASON ;pend/sch only
"RTN","ORMRA",152,0)
 D:ORACT="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMRA",153,0)
 Q
"RTN","ORMRA",154,0)
 ;
"RTN","ORMRA",155,0)
RL ;Release hold --entire section added with patch 110
"RTN","ORMRA",156,0)
 S ^OR(100,+ORIFN,8,$P(OR3,U,7),2)=ORLOG_"^"_ORDUZ  ;Set release hold date/time and release hold user
"RTN","ORMRA",157,0)
 S ORNATR=$S($L(ORNATR):ORNATR,1:$P(^OR(100,+ORIFN,8,$P(OR3,U,7),0),U,12)) ;set nature of order for release equal to nature of order for hold if it doesn't exist
"RTN","ORMRA",158,0)
 I $G(ORSTS)="" S ORSTS=6
"RTN","ORMRA",159,0)
 D UPDATE(ORSTS,"RL")
"RTN","ORMRA",160,0)
 Q
"RTN","ORWORR")
0^8^B51024682
"RTN","ORWORR",1,0)
ORWORR ; SLC/KCM - Retrieve Orders for Broker ;12/11/01  11:15
"RTN","ORWORR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,92,116,110**;Dec 17, 1997
"RTN","ORWORR",3,0)
 ;
"RTN","ORWORR",4,0)
 ;
"RTN","ORWORR",5,0)
GET(LST,DFN,FILTER,GROUPS) ; procedure
"RTN","ORWORR",6,0)
 Q  ; don't call until using same treating specialty logic as AGET
"RTN","ORWORR",7,0)
 ;    also until MULT, ORWARD, & ORIGVIEW implemented
"RTN","ORWORR",8,0)
 ;    also until the date ranges are implemented
"RTN","ORWORR",9,0)
 ;
"RTN","ORWORR",10,0)
 ; Get orders for a patient
"RTN","ORWORR",11,0)
 ;        1   2    3     4      5     6   7   8   9   10     11    12
"RTN","ORWORR",12,0)
 ; .LST=~IFN^Grp^ActTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^ActDA
"RTN","ORWORR",13,0)
 ; .LST=tOrder Text (repeating as necessary)
"RTN","ORWORR",14,0)
 ;     DFN=Patient ID
"RTN","ORWORR",15,0)
 ;  FILTER=number indicates which orders to return, default=2 (current)
"RTN","ORWORR",16,0)
 ;  GROUPS=display group of orders to show (default=ALL)
"RTN","ORWORR",17,0)
 ;
"RTN","ORWORR",18,0)
 ; -- this section uses ORQ1 to get the orders list rather than XGET --
"RTN","ORWORR",19,0)
 N ORLIST,ORIFN,X0,X3,X8,IDX,IFN,ACT,PRV,LN,TXT,STRT,STOP,CSTS,EYE
"RTN","ORWORR",20,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",21,0)
 S (IDX,LST)=0 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",22,0)
 D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"","","",0,1)
"RTN","ORWORR",23,0)
 S EYE=0 F  S EYE=$O(^TMP("ORR",$J,ORLIST,EYE)) Q:'EYE  S IFN=^(EYE) D
"RTN","ORWORR",24,0)
 . S ACT=$P(IFN,";",2),IFN=+IFN,X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",25,0)
 . D GETFLDS
"RTN","ORWORR",26,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",27,0)
 G EXIT
"RTN","ORWORR",28,0)
 ;
"RTN","ORWORR",29,0)
AGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU) ; Get an abbreviated order list for a patient
"RTN","ORWORR",30,0)
 ; returns ^TMP("ORR",$J,ORLIST,n)=IFN^DGrp^ActTm
"RTN","ORWORR",31,0)
 ; see above for input parameters
"RTN","ORWORR",32,0)
 ;
"RTN","ORWORR",33,0)
 ; -- this section uses ORQ1 to get the orders list rather than XGET --
"RTN","ORWORR",34,0)
 N ORLIST,ORIFN,IFN,I,ORWTS,TOT,MULT,ORWARD,TXTVW,ORYD
"RTN","ORWORR",35,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",36,0)
 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",37,0)
 S ORWTS=+$P(FILTER,U,2),FILTER=+FILTER
"RTN","ORWORR",38,0)
 S MULT=$S("^1^6^8^9^10^11^13^14^20^22^"[(U_FILTER_U):1,1:0)
"RTN","ORWORR",39,0)
 I $L($G(^DPT(DFN,.1))) S ORWARD=1 ; should normally be ptr to 42
"RTN","ORWORR",40,0)
 D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",$G(DTFROM),$G(DTTHRU),0,MULT)
"RTN","ORWORR",41,0)
 S TOT=^TMP("ORR",$J,ORLIST,"TOT") K ^TMP("ORR",$J,ORLIST,"TOT")
"RTN","ORWORR",42,0)
 S I=.1 F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:'I  S IFN=^(I) D
"RTN","ORWORR",43,0)
 . I ORWTS,(+$P($G(^OR(100,+IFN,0)),U,13)'=ORWTS) K ^TMP("ORR",$J,ORLIST,I) S TOT=TOT-1 Q
"RTN","ORWORR",44,0)
 . S ^TMP("ORR",$J,ORLIST,I)=IFN_U_$P($G(^OR(100,+IFN,0)),U,11)_U_$P($G(^(8,+$P(IFN,";",2),0)),U)
"RTN","ORWORR",45,0)
 S TXTVW=$S(MULT:0,FILTER=2:2,1:1) D:FILTER=2 ORYD^ORDD100
"RTN","ORWORR",46,0)
 S ^TMP("ORR",$J,ORLIST,.1)=TOT_U_TXTVW_U_$G(ORYD,0)
"RTN","ORWORR",47,0)
 S REF=$NA(^TMP("ORR",$J,ORLIST))
"RTN","ORWORR",48,0)
 Q
"RTN","ORWORR",49,0)
 ;
"RTN","ORWORR",50,0)
XGET ; -- this was the retrieval algorithm before all the AC xref changes
"RTN","ORWORR",51,0)
 N X,X0,X3,IDX,IFN,LN,TIME,DGRP,MASK,TXT,ACT,PRV,ID
"RTN","ORWORR",52,0)
 S DFN=DFN_";DPT(",IDX=0,LST=0
"RTN","ORWORR",53,0)
 I '$G(FILTER) S FILTER=2                    ; Default: Current/Active
"RTN","ORWORR",54,0)
 I $D(GROUPS)=1 D
"RTN","ORWORR",55,0)
 . S:'GROUPS GROUPS=$O(^ORD(100.98,"B",GROUPS,0))
"RTN","ORWORR",56,0)
 . D XPND(GROUPS)
"RTN","ORWORR",57,0)
 ;
"RTN","ORWORR",58,0)
 I FILTER=1  D DOALL G EXIT                  ; All
"RTN","ORWORR",59,0)
 I FILTER=2  D DOCUR G EXIT                  ; Current
"RTN","ORWORR",60,0)
 I FILTER=3  S PASS=";1;"                    ; Discontinued
"RTN","ORWORR",61,0)
 I FILTER=4  S PASS=";2;7;"                  ; Comp/Expired
"RTN","ORWORR",62,0)
 I FILTER=5  S PASS=";3;4;5;6;8;9;"          ; Expiring
"RTN","ORWORR",63,0)
 I FILTER=6  S PASS=";1;2;3;4;5;6;7;8;9;11;" ; New Activity
"RTN","ORWORR",64,0)
 I FILTER=7  S PASS=";5;"                    ; Pending
"RTN","ORWORR",65,0)
 I FILTER=8  Q                               ; Expanded
"RTN","ORWORR",66,0)
 I FILTER=9  S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Nurse
"RTN","ORWORR",67,0)
 I FILTER=10 S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Clerk
"RTN","ORWORR",68,0)
 I FILTER=11 S PASS=";3;4;5;6;7;8;11;"       ; Unsigned
"RTN","ORWORR",69,0)
 I FILTER=12 S PASS=";4;"                    ; Flagged
"RTN","ORWORR",70,0)
 I FILTER=13 S PASS=""                       ; Verbal/Phone
"RTN","ORWORR",71,0)
 I FILTER=14 S PASS=""                       ; Verbal/Phone Unsigned
"RTN","ORWORR",72,0)
 D DOGET
"RTN","ORWORR",73,0)
EXIT I LST=0 D
"RTN","ORWORR",74,0)
 . N %,X,%I D NOW^%DTC
"RTN","ORWORR",75,0)
 . S LST(1)="~0^0^"_%_"^^^97",LST(2)="tNo Orders Found."
"RTN","ORWORR",76,0)
 Q
"RTN","ORWORR",77,0)
 ;
"RTN","ORWORR",78,0)
DOGET ; Come here if need to filter the orders 
"RTN","ORWORR",79,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",80,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",81,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",82,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",83,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",84,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",85,0)
 . . . I $L(PASS),(PASS'[(";"_$P(X3,U,3)_";")) Q  ;filter by status
"RTN","ORWORR",86,0)
 . . . ; do any other filtering
"RTN","ORWORR",87,0)
 . . . D GETFLDS
"RTN","ORWORR",88,0)
 Q
"RTN","ORWORR",89,0)
DOALL ; Come here if retrieve all orders (no filter by status)
"RTN","ORWORR",90,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",91,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",92,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",93,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",94,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",95,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",96,0)
 . . . D GETFLDS
"RTN","ORWORR",97,0)
 Q
"RTN","ORWORR",98,0)
DOCUR ; Come here to retrieve all current orders
"RTN","ORWORR",99,0)
 N AOCTXT,STS,STOP,%
"RTN","ORWORR",100,0)
 S X=-$$GET^XPAR("ALL","ORPF ACTIVE ORDERS CONTEXT HRS")
"RTN","ORWORR",101,0)
 S %H=$H,X=(%H*86400+$P(%H,",",2))+(X*3600),%H=(X\86400)_","_(X#86400)
"RTN","ORWORR",102,0)
 D YMD^%DTC S AOCTXT=X_%
"RTN","ORWORR",103,0)
 S MASK="110000100101110"   ; mask out STS=1,2,7,10,12,13,14
"RTN","ORWORR",104,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AC",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",105,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AC",DFN,TIME,IFN)) Q:'IFN  D
"RTN","ORWORR",106,0)
 . . ; filter out display groups here
"RTN","ORWORR",107,0)
 . . S ACT=0 F  S ACT=$O(^OR(100,"AC",DFN,TIME,IFN,ACT)) Q:'ACT  D
"RTN","ORWORR",108,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",109,0)
 . . . S STS=$P(X3,U,3),STOP=$P(X0,U,9)
"RTN","ORWORR",110,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!(STS=99) Q
"RTN","ORWORR",111,0)
 . . . I $P(X8,U,15)=13,($P(X8,U)<AOCTXT) D ACKILL Q
"RTN","ORWORR",112,0)
 . . . I $P(X8,U,15)=13!($P(X8,U,15)=""),("RN^XX"[$P(X8,U,2)) D ACKILL Q
"RTN","ORWORR",113,0)
 . . . I $E(MASK,STS),STOP<AOCTXT D ACKILL Q
"RTN","ORWORR",114,0)
 . . . D GETFLDS
"RTN","ORWORR",115,0)
 Q
"RTN","ORWORR",116,0)
ACKILL ; called only from DOCUR - kill AC xref
"RTN","ORWORR",117,0)
 ; K ^OR(100,"AC",DFN,TIME,IFN,ACT)  ; let ORQ1 kill if for now
"RTN","ORWORR",118,0)
 Q
"RTN","ORWORR",119,0)
GET4V11(LST,TXTVW,ORYD,IFNLST) ; get the order fields TEMPORARY
"RTN","ORWORR",120,0)
 G GET41
"RTN","ORWORR",121,0)
GET4LST(LST,IFNLST)     ; get the order fields for a list of orders
"RTN","ORWORR",122,0)
GET41 N ACT,ACTID,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,IFN,IFNIDX,ORIGVIEW
"RTN","ORWORR",123,0)
 S (IDX,LST,IFNIDX)=0
"RTN","ORWORR",124,0)
 F  S IFNIDX=$O(IFNLST(IFNIDX)) Q:'IFNIDX  S IFN=IFNLST(IFNIDX) D
"RTN","ORWORR",125,0)
 . S ACT=$S($P(IFN,";",2):$P(IFN,";",2),1:1),IFN=+IFN
"RTN","ORWORR",126,0)
 . S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)),X8=$G(^(8,ACT,0))
"RTN","ORWORR",127,0)
 . D GETFLDS
"RTN","ORWORR",128,0)
 Q
"RTN","ORWORR",129,0)
GETBYIFN(LST,IFN) ; procedure
"RTN","ORWORR",130,0)
 ; get the fields for a single order
"RTN","ORWORR",131,0)
 ; .LST(n)=as described above in GET
"RTN","ORWORR",132,0)
 ;     IFN=internal entry number for order
"RTN","ORWORR",133,0)
 ;
"RTN","ORWORR",134,0)
 I 'IFN Q
"RTN","ORWORR",135,0)
 N ACT,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,ACTID,ORIGVIEW,ORYD,TXTVW
"RTN","ORWORR",136,0)
 S IDX=0,LST=0,ORYD=0
"RTN","ORWORR",137,0)
 S X0=$G(^OR(100,+IFN,0)),X3=$G(^(3))
"RTN","ORWORR",138,0)
 S ACT=$S($P(IFN,";",2):$P(IFN,";",2),$P(X3,U,7):$P(X3,U,7),1:1)
"RTN","ORWORR",139,0)
 S IFN=+IFN,X8=$G(^OR(100,IFN,8,ACT,0))
"RTN","ORWORR",140,0)
 ;
"RTN","ORWORR",141,0)
GETFLDS ; used by entry points to place order fields into list
"RTN","ORWORR",142,0)
 ; expects IDX=sequence #, IFN=order, X0=node 0, X3=node 3, LST=results
"RTN","ORWORR",143,0)
 ; LST(IDX)=~IFN^Grp^OrdTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^Act^Flagged[^DCType]^ChartRev
"RTN","ORWORR",144,0)
 S PRV=$P(X8,U,5) S:'PRV PRV=$P(X8,U,3) S PRV=PRV_U
"RTN","ORWORR",145,0)
 I PRV S PRV=PRV_$P(^VA(200,+PRV,0),U)  ; get provider
"RTN","ORWORR",146,0)
 S IDX=IDX+1,LST=LST+1,ID=IFN_";"_ACT,ACTID=$P(X8,U,2)
"RTN","ORWORR",147,0)
 S CSTS=$S($P(X8,U,15):$P(X8,U,15),1:$P(X3,U,3))
"RTN","ORWORR",148,0)
 I $P(X8,U,15)=10,$P(X3,U,3)=14 S CSTS=14 ;delayed-lapsed order
"RTN","ORWORR",149,0)
 S STRT=$S($P(X3,U,3)=11:$$RSTRT,ACTID="NW"!(ACTID="XX")!(ACTID="RL"):$P(X0,U,8),ACTID="DC":"",1:$P(X8,U)) ;110
"RTN","ORWORR",150,0)
 S STOP=$S($P(X3,U,3)=11:$$RSTOP,ACTID="HD":$P($G(^OR(100,+IFN,8,ACT,2)),U),1:$P(X0,U,9))
"RTN","ORWORR",151,0)
 S LST(IDX)="~"_ID_U_$P(X0,U,11)_U_$P(X8,U)_U_STRT_U_STOP_U_CSTS_U_$P(X8,U,4)_U_$P(X8,U,8)_U_$P(X8,U,10)_U_PRV
"RTN","ORWORR",152,0)
 S $P(LST(IDX),U,13)=+$G(^OR(100,IFN,8,ACT,3))    ; flagged
"RTN","ORWORR",153,0)
 I +$P(X8,U,8) S $P(LST(IDX),U,8)=$$INITIALS^ORCHTAB2(+$P(X8,U,8))    ;nurse
"RTN","ORWORR",154,0)
 I +$P(X8,U,10) S $P(LST(IDX),U,9)=$$INITIALS^ORCHTAB2(+$P(X8,U,10))  ;clerk
"RTN","ORWORR",155,0)
 I +$P(X8,U,18) S $P(LST(IDX),U,15)=$$INITIALS^ORCHTAB2(+$P(X8,U,18)) ;chart review
"RTN","ORWORR",156,0)
 S ORIGVIEW=$S($G(TXTVW)=0:0,$G(TXTVW)=1:1,ORYD=-1:1,'ORYD:1,$P(X8,U)'<ORYD:0,1:1)
"RTN","ORWORR",157,0)
 K TXT D TEXT^ORQ12(.TXT,ID,255)                  ; optimize this later
"RTN","ORWORR",158,0)
 I $O(^OR(100,+IFN,2,0)) S LN=$O(TXT(0)),TXT(LN)="+"_TXT(LN)
"RTN","ORWORR",159,0)
 I $O(^OR(100,+IFN,8,"C","XX",0)) S LN=$O(TXT(0)),TXT(LN)="*"_TXT(LN)
"RTN","ORWORR",160,0)
 S LN=0 F  S LN=$O(TXT(LN)) Q:'LN  S IDX=IDX+1,LST(IDX)="t"_TXT(LN)
"RTN","ORWORR",161,0)
 Q
"RTN","ORWORR",162,0)
RSTRT() ; return start date from responses
"RTN","ORWORR",163,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","START",0)),1))
"RTN","ORWORR",164,0)
 ;
"RTN","ORWORR",165,0)
RSTOP() ; return stop date from responses
"RTN","ORWORR",166,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","STOP",0)),1))
"RTN","ORWORR",167,0)
 ;
"RTN","ORWORR",168,0)
GETTXT(LST,IFN)     ; get the text of an order
"RTN","ORWORR",169,0)
 I $L(IFN,";")=1 S IFN=IFN_";1"
"RTN","ORWORR",170,0)
 D TEXT^ORQ12(.LST,IFN,255)
"RTN","ORWORR",171,0)
 Q
"RTN","ORWORR",172,0)
XPND(AGRP) ; procedure
"RTN","ORWORR",173,0)
 ; Expand a display group (GROUPS must be defined outside of call)
"RTN","ORWORR",174,0)
 N I,CHLD
"RTN","ORWORR",175,0)
 S GROUPS(AGRP)=^ORD(100.98,AGRP,0),I=0
"RTN","ORWORR",176,0)
 F  S I=$O(^ORD(100.98,AGRP,1,I)) Q:'I  S CHLD=$P(^(I,0),U) D XPND(CHLD)
"RTN","ORWORR",177,0)
 Q
"RTN","ORY110")
0^5^B13400185
"RTN","ORY110",1,0)
ORY110 ;SLC/DAN--Clean up orderable items file ;1/4/02  13:57
"RTN","ORY110",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**110**;Dec 17, 1997
"RTN","ORY110",3,0)
 N IEN,DIK,IEN6,COUNT
"RTN","ORY110",4,0)
 K ^ORD(101.43,"B") ;Delete "B" cross reference to be rebuilt below
"RTN","ORY110",5,0)
 D MES^XPDUTL("Re-indexing the B cross reference of the SYNONYM field...")
"RTN","ORY110",6,0)
 S IEN=0 F  S IEN=$O(^ORD(101.43,IEN)) Q:'+IEN  D
"RTN","ORY110",7,0)
 .I $G(^ORD(101.43,IEN,0))="" K ^ORD(101.43,IEN) Q  ;Delete extraneous nodes when 0 node doesn't exist
"RTN","ORY110",8,0)
 .I $O(^ORD(101.43,IEN,2,0)) K ^ORD(101.43,IEN,2,"B") S DIK="^ORD(101.43,IEN,2,",DIK(1)=".01^B",DA(1)=IEN D ENALL^DIK ;Reset "B" cross reference for synonym multiple
"RTN","ORY110",9,0)
 ;
"RTN","ORY110",10,0)
 K DIK,DA
"RTN","ORY110",11,0)
 D MES^XPDUTL("Re-indexing the B cross reference of the ORDERABLE ITEMS file")
"RTN","ORY110",12,0)
 S DIK="^ORD(101.43,",DIK(1)=".01^B" D ENALL^DIK ;Rebuild B cross reference at the file level
"RTN","ORY110",13,0)
 ;
"RTN","ORY110",14,0)
 D BMES^XPDUTL("Reviewing ORDER DIALOG file for incorrect pointer default values.")
"RTN","ORY110",15,0)
 S IEN=0 F  S IEN=$O(^ORD(101.41,IEN)) Q:'+IEN  I $D(^(IEN,6)) D
"RTN","ORY110",16,0)
 .S IEN6=0 F  S IEN6=$O(^ORD(101.41,IEN,6,IEN6)) Q:'+IEN6  I $L($G(^(IEN6,1)),"^")>1 S ^ORD(101.41,IEN,6,IEN6,1)=$P(^ORD(101.41,IEN,6,IEN6,1),"^"),COUNT=$G(COUNT)+1
"RTN","ORY110",17,0)
 D MES^XPDUTL("Finished."_$S($G(COUNT)>0:" Fixed "_$G(COUNT)_" node"_$S($G(COUNT)>1:"s.",1:"."),1:""))
"RTN","ORY110",18,0)
 ;
"RTN","ORY110",19,0)
 S ZTRTN="DQ^ORY110",ZTDTH=$H,ZTDESC="Patch OR*3*110 ORDER file cleanup",ZTSAVE("DUZ")="",ZTIO="" D ^%ZTLOAD
"RTN","ORY110",20,0)
 D MES^XPDUTL("Starting ORDER file clean-up job in the background.  Task # "_+$G(ZTSK))
"RTN","ORY110",21,0)
 Q
"RTN","ORY110",22,0)
 ;
"RTN","ORY110",23,0)
DQ ;Entry point for background job to clean up ORDER file
"RTN","ORY110",24,0)
 N IEN,SUB,COUNT
"RTN","ORY110",25,0)
 S IEN=$$GETIEN(3010826.24)-1 ;get first IEN for date, subtract one so first IEN is reviewed
"RTN","ORY110",26,0)
 I IEN=-1 D MAIL Q
"RTN","ORY110",27,0)
 F  S IEN=$O(^OR(100,IEN)) Q:'+IEN  D
"RTN","ORY110",28,0)
 .S SUB=0 F  S SUB=$O(^OR(100,IEN,.1,SUB)) Q:'+SUB  D
"RTN","ORY110",29,0)
 ..I $L($G(^(SUB,0)),"^")>1 D
"RTN","ORY110",30,0)
 ...N DIK,DA
"RTN","ORY110",31,0)
 ...K ^OR(100,IEN,.1,"B",$G(^OR(100,IEN,.1,SUB,0))) ;delete current B xref
"RTN","ORY110",32,0)
 ...S ^OR(100,IEN,.1,SUB,0)=$P(^OR(100,IEN,.1,SUB,0),"^") ;remove extra pieces
"RTN","ORY110",33,0)
 ...S DIK="^OR(100,IEN,.1,",DIK(1)=".01^B" ;set index to be reset and global node
"RTN","ORY110",34,0)
 ...S DA=SUB,DA(1)=IEN ;DA is subfile IEN, DA(1) is file level IEN
"RTN","ORY110",35,0)
 ...D EN1^DIK ;Set B xref for this entry
"RTN","ORY110",36,0)
 ...Q
"RTN","ORY110",37,0)
 .S SUB=0 F  S SUB=$O(^OR(100,IEN,4.5,SUB)) Q:'+SUB  D
"RTN","ORY110",38,0)
 ..I $L($G(^(SUB,1)),"^")>1 S ^(1)=$P(^(1),"^"),COUNT=$G(COUNT)+1 ;remove extra pieces, count changes
"RTN","ORY110",39,0)
 ;
"RTN","ORY110",40,0)
 D MAIL ;Send mail notification upon completion
"RTN","ORY110",41,0)
 Q
"RTN","ORY110",42,0)
 ;
"RTN","ORY110",43,0)
GETIEN(STDT) ;Find first IEN associated with given start date
"RTN","ORY110",44,0)
 N DONE,IEN
"RTN","ORY110",45,0)
 S (DONE,IEN)=0
"RTN","ORY110",46,0)
 F  S STDT=$O(^OR(100,"AF",STDT)) Q:'+STDT!(DONE)  D
"RTN","ORY110",47,0)
 .S IEN=0 F  S IEN=$O(^OR(100,"AF",STDT,IEN)) Q:'+IEN  I $O(^(IEN,0))=1 S DONE=1 Q  ;Find first ORDER that is a new order
"RTN","ORY110",48,0)
 Q IEN
"RTN","ORY110",49,0)
 ;
"RTN","ORY110",50,0)
MAIL ;Send email when finished
"RTN","ORY110",51,0)
 N XMSUB,XMTEXT,XMDUZ,ORTXT,XMY
"RTN","ORY110",52,0)
 S XMDUZ="Patch OR*3*110 Post-Init"
"RTN","ORY110",53,0)
 S XMY(.5)="" S:$G(DUZ) XMY(DUZ)=""
"RTN","ORY110",54,0)
 S ORTXT(1)="The ORDER file clean-up initiated by patch OR*3*110 has completed."
"RTN","ORY110",55,0)
 S ORTXT(2)=""
"RTN","ORY110",56,0)
 S ORTXT(3)="There were "_$S($G(COUNT):COUNT,1:"no")_" changes made to the ORDER file."
"RTN","ORY110",57,0)
 S XMTEXT="ORTXT("
"RTN","ORY110",58,0)
 S XMSUB="Patch OR*3*110 ORDER file clean-up completed."
"RTN","ORY110",59,0)
 D ^XMD
"RTN","ORY110",60,0)
 Q
"VER")
8.0^22.0
**END**
**END**
