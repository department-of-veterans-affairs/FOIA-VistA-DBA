Released LR*5.2*368 SEQ #289
Extracted from mail message
**KIDS**:LR*5.2*368^

**INSTALL NAME**
LR*5.2*368
"BLD",7379,0)
LR*5.2*368^LAB SERVICE^0^3070614^y
"BLD",7379,1,0)
^^1^1^3070614^^^^
"BLD",7379,1,1,0)
This patch corrects an improperly formatted FileMan call.
"BLD",7379,4,0)
^9.64PA^^
"BLD",7379,6.3)
1
"BLD",7379,"ABPKG")
n
"BLD",7379,"KRN",0)
^9.67PA^8989.52^19
"BLD",7379,"KRN",.4,0)
.4
"BLD",7379,"KRN",.401,0)
.401
"BLD",7379,"KRN",.402,0)
.402
"BLD",7379,"KRN",.403,0)
.403
"BLD",7379,"KRN",.5,0)
.5
"BLD",7379,"KRN",.84,0)
.84
"BLD",7379,"KRN",3.6,0)
3.6
"BLD",7379,"KRN",3.8,0)
3.8
"BLD",7379,"KRN",9.2,0)
9.2
"BLD",7379,"KRN",9.8,0)
9.8
"BLD",7379,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7379,"KRN",9.8,"NM",1,0)
LRAPMRL^^0^B64848132
"BLD",7379,"KRN",9.8,"NM","B","LRAPMRL",1)

"BLD",7379,"KRN",19,0)
19
"BLD",7379,"KRN",19.1,0)
19.1
"BLD",7379,"KRN",101,0)
101
"BLD",7379,"KRN",409.61,0)
409.61
"BLD",7379,"KRN",771,0)
771
"BLD",7379,"KRN",870,0)
870
"BLD",7379,"KRN",8989.51,0)
8989.51
"BLD",7379,"KRN",8989.52,0)
8989.52
"BLD",7379,"KRN",8994,0)
8994
"BLD",7379,"KRN","B",.4,.4)

"BLD",7379,"KRN","B",.401,.401)

"BLD",7379,"KRN","B",.402,.402)

"BLD",7379,"KRN","B",.403,.403)

"BLD",7379,"KRN","B",.5,.5)

"BLD",7379,"KRN","B",.84,.84)

"BLD",7379,"KRN","B",3.6,3.6)

"BLD",7379,"KRN","B",3.8,3.8)

"BLD",7379,"KRN","B",9.2,9.2)

"BLD",7379,"KRN","B",9.8,9.8)

"BLD",7379,"KRN","B",19,19)

"BLD",7379,"KRN","B",19.1,19.1)

"BLD",7379,"KRN","B",101,101)

"BLD",7379,"KRN","B",409.61,409.61)

"BLD",7379,"KRN","B",771,771)

"BLD",7379,"KRN","B",870,870)

"BLD",7379,"KRN","B",8989.51,8989.51)

"BLD",7379,"KRN","B",8989.52,8989.52)

"BLD",7379,"KRN","B",8994,8994)

"BLD",7379,"QUES",0)
^9.62^^
"BLD",7379,"REQB",0)
^9.611^2^2
"BLD",7379,"REQB",1,0)
LR*5.2*317^2
"BLD",7379,"REQB",2,0)
DI*22.0*149^2
"BLD",7379,"REQB","B","DI*22.0*149",2)

"BLD",7379,"REQB","B","LR*5.2*317",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
368^3070614
"PKG",26,22,1,"PAH",1,1,0)
^^1^1^3070614
"PKG",26,22,1,"PAH",1,1,1,0)
This patch corrects an improperly formatted FileMan call.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","LRAPMRL")
0^1^B64848132^B65434742
"RTN","LRAPMRL",1,0)
LRAPMRL ;DALOI/WTY/KLL- AP MODIFY RELEASED REPORT;12/04/01
"RTN","LRAPMRL",2,0)
 ;;5.2;LAB SERVICE;**259,295,317,368**;Sep 27, 1994;Build 1
"RTN","LRAPMRL",3,0)
 ;
"RTN","LRAPMRL",4,0)
MAIN ;
"RTN","LRAPMRL",5,0)
 N LRQUIT,LRMSG,LREND,LRDATA,LRREL,LRAU,LREFPD,LRWM,LRCT,LRTMP,LRGMDF
"RTN","LRAPMRL",6,0)
 N LRFLD,LRDSC,LRCHG,LRXTMP,LRYTMP,LRIENS1,LRFILE,LRFLDA,LRAD1,LRIENS
"RTN","LRAPMRL",7,0)
 N LRORIEN,LRWPROOT,LRFDA,LRDA,LRFIELD,LRFILE1,LRIENS2,LRDT0,LRESCPT
"RTN","LRAPMRL",8,0)
 N LRQUIT1,LREDIAG,LRLOCK,LRNOTXT,LRORIEN
"RTN","LRAPMRL",9,0)
 S LRESCPT=0
"RTN","LRAPMRL",10,0)
 D TITLE
"RTN","LRAPMRL",11,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",12,0)
 D NOTICE
"RTN","LRAPMRL",13,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",14,0)
 D SECTION
"RTN","LRAPMRL",15,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",16,0)
 D WHAT
"RTN","LRAPMRL",17,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",18,0)
 D CPTCHK
"RTN","LRAPMRL",19,0)
 ;D SECTION
"RTN","LRAPMRL",20,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",21,0)
 D ASK
"RTN","LRAPMRL",22,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",23,0)
 D SETDR^LRAPMRL1
"RTN","LRAPMRL",24,0)
 D ACCYR
"RTN","LRAPMRL",25,0)
 I LRQUIT D END Q
"RTN","LRAPMRL",26,0)
 D ACCPN
"RTN","LRAPMRL",27,0)
 D END
"RTN","LRAPMRL",28,0)
 Q
"RTN","LRAPMRL",29,0)
ACCPN ;Prompt for accesion number or patient name
"RTN","LRAPMRL",30,0)
 F  D  Q:LREND
"RTN","LRAPMRL",31,0)
 .S (LRQUIT,LREND)=0
"RTN","LRAPMRL",32,0)
 .D CPTCHK
"RTN","LRAPMRL",33,0)
 .D LOOKUP^LRAPUTL(.LRDATA,LRH(0),LRO(68),LRSS,LRAD,LRAA)
"RTN","LRAPMRL",34,0)
 .I (LRDATA<1)!('$G(LRAN))!($G(LRAN)=-1) S LREND=1 Q
"RTN","LRAPMRL",35,0)
 .S LRDFN=LRDATA,LRI=LRDATA(1)
"RTN","LRAPMRL",36,0)
 .S LRLOCK="^LR(LRDFN"_$S(LRAU:")",1:",LRSS,LRI)")
"RTN","LRAPMRL",37,0)
 .L +@(LRLOCK):5 I '$T D  Q
"RTN","LRAPMRL",38,0)
 ..S LRMSG="This record is locked by another user.  "
"RTN","LRAPMRL",39,0)
 ..S LRMSG=LRMSG_"Please try again later."
"RTN","LRAPMRL",40,0)
 ..D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPMRL",41,0)
 .S LRIENS=$S('LRAU:LRI_",",1:"")_LRDFN_","
"RTN","LRAPMRL",42,0)
 .D RELCHK^LRAPMRL1
"RTN","LRAPMRL",43,0)
 .I LRQUIT D UNLOCK Q
"RTN","LRAPMRL",44,0)
 .D RELEASE^LRAPMRL1
"RTN","LRAPMRL",45,0)
 .D QUEUPD^LRAPMRL1
"RTN","LRAPMRL",46,0)
 .D:LRCAPA&'LRAU C^LRAPSWK
"RTN","LRAPMRL",47,0)
 .D:'LREDIAG SETDR^LRAPMRL1,EDIT^LRAPMRL1
"RTN","LRAPMRL",48,0)
 .I LRQUIT D UNLOCK Q
"RTN","LRAPMRL",49,0)
 .I 'LRAU D
"RTN","LRAPMRL",50,0)
 ..F LRFLD=1,1.1,1.4,1.3 D  Q:LRQUIT
"RTN","LRAPMRL",51,0)
 ...Q:LREDIAG&(LRFLD'=1.4)
"RTN","LRAPMRL",52,0)
 ...Q:'LREDIAG&(LRFLD=1.4)
"RTN","LRAPMRL",53,0)
 ...Q:LRFLD=1.3&(LRSS'="SP")
"RTN","LRAPMRL",54,0)
 ...D ASK2 Q:LRQUIT!('LRGMDF)
"RTN","LRAPMRL",55,0)
 ...D SAVTXT
"RTN","LRAPMRL",56,0)
 ...K DR S DR=LRFLD
"RTN","LRAPMRL",57,0)
 ...D EDIT^LRAPMRL1
"RTN","LRAPMRL",58,0)
 ...D COMPARE Q:LRQUIT
"RTN","LRAPMRL",59,0)
 ...D AUDIT Q:LRQUIT
"RTN","LRAPMRL",60,0)
 ...D STORE
"RTN","LRAPMRL",61,0)
 .I LRAU,LREDIAG D
"RTN","LRAPMRL",62,0)
 ..S LRDSC="PATHOLOGICAL DIAGNOSIS"
"RTN","LRAPMRL",63,0)
 ..S LRFLD=32.3
"RTN","LRAPMRL",64,0)
 ..D SAVTXT
"RTN","LRAPMRL",65,0)
 ..K DR S DR=LRFLD
"RTN","LRAPMRL",66,0)
 ..D EDIT^LRAPMRL1
"RTN","LRAPMRL",67,0)
 ..D COMPARE
"RTN","LRAPMRL",68,0)
 .I $G(SEX)["F","SPCY"[LRSS D DEL^LRWOMEN
"RTN","LRAPMRL",69,0)
 .I LRQUIT D UNLOCK Q
"RTN","LRAPMRL",70,0)
 .I LREDIAG D UNLOCK Q
"RTN","LRAPMRL",71,0)
 .D:LRESCPT CPTCODE^LRAPMRL1
"RTN","LRAPMRL",72,0)
 .D UNLOCK
"RTN","LRAPMRL",73,0)
 Q
"RTN","LRAPMRL",74,0)
TITLE ;Title
"RTN","LRAPMRL",75,0)
 S (LRQUIT,LRQUIT1)=0
"RTN","LRAPMRL",76,0)
 D CK^LRAP
"RTN","LRAPMRL",77,0)
 I Y=-1 S LRQUIT=1 Q
"RTN","LRAPMRL",78,0)
 W @IOF
"RTN","LRAPMRL",79,0)
 S LRMSG="Modify Released Pathology Reports"
"RTN","LRAPMRL",80,0)
 S LRMSG(1)=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPMRL",81,0)
 S LRMSG(1,"F")="!!"
"RTN","LRAPMRL",82,0)
 S LRMSG(2)="",LRMSG(2,"F")="!"
"RTN","LRAPMRL",83,0)
 D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPMRL",84,0)
 Q
"RTN","LRAPMRL",85,0)
NOTICE ;Warn the user and allow an exit
"RTN","LRAPMRL",86,0)
 K LRMSG
"RTN","LRAPMRL",87,0)
 S LRMSG="NOTICE"
"RTN","LRAPMRL",88,0)
 S LRMSG(1)=$$CJ^XLFSTR(LRMSG,IOM),LRMSG(1,"F")="!!"
"RTN","LRAPMRL",89,0)
 S LRMSG(2)="",LRMSG(2,"F")="!"
"RTN","LRAPMRL",90,0)
 S LRMSG(3)=$C(7)_"This option allows modification of a verified/"
"RTN","LRAPMRL",91,0)
 S LRMSG(3)=LRMSG(3)_"released pathology report."
"RTN","LRAPMRL",92,0)
 S LRMSG(3,"F")="!?3"
"RTN","LRAPMRL",93,0)
 S LRMSG(4)="Continuing with this option will unrelease the report "
"RTN","LRAPMRL",94,0)
 S LRMSG(4)=LRMSG(4)_"and flag the report",LRMSG(4,"F")="!?3"
"RTN","LRAPMRL",95,0)
 S LRMSG(5)="as modified even if the data is unchanged.  It will "
"RTN","LRAPMRL",96,0)
 S LRMSG(5)=LRMSG(5)_"also be queued to the",LRMSG(5,"F")="!?3"
"RTN","LRAPMRL",97,0)
 S LRMSG(6)="final report queue so that it may be verified/released "
"RTN","LRAPMRL",98,0)
 S LRMSG(6)=LRMSG(6)_"again.",LRMSG(6,"F")="!?3"
"RTN","LRAPMRL",99,0)
 D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPMRL",100,0)
 W !!
"RTN","LRAPMRL",101,0)
 S DIR(0)="Y",DIR("A")="Do you wish to continue",DIR("B")="NO"
"RTN","LRAPMRL",102,0)
 D ^DIR
"RTN","LRAPMRL",103,0)
 S:Y<1 LRQUIT=1
"RTN","LRAPMRL",104,0)
 Q
"RTN","LRAPMRL",105,0)
WHAT ;What is to be edited
"RTN","LRAPMRL",106,0)
 W !
"RTN","LRAPMRL",107,0)
 K DIR
"RTN","LRAPMRL",108,0)
 ;Don't ask to Edit Diagnosis if initial entry of diagnosis is turned
"RTN","LRAPMRL",109,0)
 ;  off at data entry for SP, CY, EM's
"RTN","LRAPMRL",110,0)
 S LRASK=1,XASK=""
"RTN","LRAPMRL",111,0)
 I 'LRAU D
"RTN","LRAPMRL",112,0)
 .S XASK=$S(LRSS="SP":11.2,LRSS="CY":11.3,1:"")
"RTN","LRAPMRL",113,0)
 .S:XASK="" XASK=$S(LRSS="EM":11.4,1:"")
"RTN","LRAPMRL",114,0)
 .S LRASK=$$GET1^DIQ(69.9,"1,",XASK,"I")
"RTN","LRAPMRL",115,0)
 S:LRASK DIR(0)="S^1:Edit Report;2:Edit Diagnosis"
"RTN","LRAPMRL",116,0)
 S:LRASK DIR("A")="Enter selection",DIR("B")=1
"RTN","LRAPMRL",117,0)
 S:'LRASK DIR(0)="Y",DIR("B")="YES",DIR("A")="Edit Report?"
"RTN","LRAPMRL",118,0)
 D ^DIR
"RTN","LRAPMRL",119,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) S LRQUIT=1 Q
"RTN","LRAPMRL",120,0)
 S:Y=0 LRQUIT=1
"RTN","LRAPMRL",121,0)
 Q:LRQUIT=1
"RTN","LRAPMRL",122,0)
 S LREDIAG=Y
"RTN","LRAPMRL",123,0)
 S LREDIAG=$S(LREDIAG=2:1,1:0)
"RTN","LRAPMRL",124,0)
 Q
"RTN","LRAPMRL",125,0)
CPTCHK ;Determine if CPT is activated
"RTN","LRAPMRL",126,0)
 Q:$T(ES^LRCAPES)=""
"RTN","LRAPMRL",127,0)
 S LRESCPT=$$ES^LRCAPES()
"RTN","LRAPMRL",128,0)
 Q
"RTN","LRAPMRL",129,0)
SECTION ;Choose Anatomic Pathology section (AU,SP,CY,EM)
"RTN","LRAPMRL",130,0)
 W !
"RTN","LRAPMRL",131,0)
 D ^LRAP
"RTN","LRAPMRL",132,0)
 I '$D(Y)!('$D(LRSS)) S LRQUIT=1 Q
"RTN","LRAPMRL",133,0)
 S:LRO(68)="EM" LRO(68)="ELECTRON MICROSCOPY"
"RTN","LRAPMRL",134,0)
 S LRAU=0            ; LRAU = 0 - Not Autopsy
"RTN","LRAPMRL",135,0)
 S:LRSS="AU" LRAU=1  ;      = 1 - Autosy
"RTN","LRAPMRL",136,0)
 I LRCAPA D @(LRSS_"^LRAPSWK")
"RTN","LRAPMRL",137,0)
 S LRMSG(1)=LRO(68)_" ("_LRABV_")",LRMSG(1,"F")="!?20"
"RTN","LRAPMRL",138,0)
 S LRMSG(2)="",LRMSG(2,"F")="!"
"RTN","LRAPMRL",139,0)
 D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPMRL",140,0)
 Q
"RTN","LRAPMRL",141,0)
ASK ;Ask etiology,function,procedure,disease,weights,measures
"RTN","LRAPMRL",142,0)
 I LREDIAG D  Q
"RTN","LRAPMRL",143,0)
 .S:'LRAU LREFPD=0
"RTN","LRAPMRL",144,0)
 .S:LRAU LRWM=0
"RTN","LRAPMRL",145,0)
 W !
"RTN","LRAPMRL",146,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPMRL",147,0)
 S DIR("A")="Edit etiology, function, procedure & disease"
"RTN","LRAPMRL",148,0)
 D ^DIR
"RTN","LRAPMRL",149,0)
 I Y="^" S LRQUIT=1 Q
"RTN","LRAPMRL",150,0)
 S LREFPD=$S(+Y:1,1:0)
"RTN","LRAPMRL",151,0)
 I LRAU D
"RTN","LRAPMRL",152,0)
 .W !
"RTN","LRAPMRL",153,0)
 .S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPMRL",154,0)
 .S DIR("A")="Edit weights and measures"
"RTN","LRAPMRL",155,0)
 .D ^DIR
"RTN","LRAPMRL",156,0)
 .I Y="^" S LRQUIT=1 Q
"RTN","LRAPMRL",157,0)
 .S LRWM=$S(+Y:1,1:0)
"RTN","LRAPMRL",158,0)
 Q
"RTN","LRAPMRL",159,0)
ACCYR ;Determine Accession Year
"RTN","LRAPMRL",160,0)
 D ACCYR^LRAPUTL(.LRAD1,LRH(0),LRAA,LRO(68))
"RTN","LRAPMRL",161,0)
 I LRAD1=-1 S LRQUIT=1 Q
"RTN","LRAPMRL",162,0)
 I LRAD1 S LRAD=$P(LRAD1,U),LRH(0)=$P(LRAD1,U,2)
"RTN","LRAPMRL",163,0)
 Q
"RTN","LRAPMRL",164,0)
ASK2 ;Ask about other fields
"RTN","LRAPMRL",165,0)
 S LRGMDF=0
"RTN","LRAPMRL",166,0)
 K LRDSC
"RTN","LRAPMRL",167,0)
 I LRFLD=1!(LRFLD=1.1) D
"RTN","LRAPMRL",168,0)
 .S:LRFLD=1 LRFLDA=7
"RTN","LRAPMRL",169,0)
 .S:LRFLD=1.1 LRFLDA=4
"RTN","LRAPMRL",170,0)
 .S LRDSC=$S(LRFLD=1:"GROSS",LRFLD=1.1:"MICROSCOPIC",1:"")
"RTN","LRAPMRL",171,0)
 .S LRDSC=LRDSC_" DESCRIPTION"
"RTN","LRAPMRL",172,0)
 S:LRFLD=1.4 LRDSC="DIAGNOSIS",LRFLDA=5
"RTN","LRAPMRL",173,0)
 S:LRFLD=1.3 LRDSC="FROZEN SECTION",LRFLDA=6
"RTN","LRAPMRL",174,0)
 I 'LREDIAG D
"RTN","LRAPMRL",175,0)
 .S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPMRL",176,0)
 .S DIR("A")="Edit "_LRDSC
"RTN","LRAPMRL",177,0)
 .D ^DIR
"RTN","LRAPMRL",178,0)
 .I Y="^" S LRQUIT=1 Q
"RTN","LRAPMRL",179,0)
 .S LRGMDF=$S(+Y:1,1:0)
"RTN","LRAPMRL",180,0)
 S:LREDIAG LRGMDF=1
"RTN","LRAPMRL",181,0)
 Q
"RTN","LRAPMRL",182,0)
SAVTXT ;Save word processing field text.
"RTN","LRAPMRL",183,0)
 S LRNOTXT=0
"RTN","LRAPMRL",184,0)
 K ^TMP("DIQ1",$J)
"RTN","LRAPMRL",185,0)
 S:'LRAU LRIENS=LRI_","_LRDFN_",",LRFILE=LRSF
"RTN","LRAPMRL",186,0)
 S:LRAU LRIENS=LRDFN_",",LRFILE=63
"RTN","LRAPMRL",187,0)
 Q:LRFLD=""
"RTN","LRAPMRL",188,0)
 S LRTMP=$$GET1^DIQ(LRFILE,LRIENS,LRFLD,"","^TMP(""DIQ1"",$J)")
"RTN","LRAPMRL",189,0)
 I LRTMP="" D
"RTN","LRAPMRL",190,0)
 .K LRMSG
"RTN","LRAPMRL",191,0)
 .S LRMSG(1)="There is no "_LRDSC_" text to modify."
"RTN","LRAPMRL",192,0)
 .S LRMSG(1,"F")="!!"
"RTN","LRAPMRL",193,0)
 .S LRMSG(2)="Report was released before entering text."
"RTN","LRAPMRL",194,0)
 .S LRMSG(2,"F")="!"
"RTN","LRAPMRL",195,0)
 .D EN^DDIOL(.LRMSG)
"RTN","LRAPMRL",196,0)
 .S LRNOTXT=1
"RTN","LRAPMRL",197,0)
 Q
"RTN","LRAPMRL",198,0)
COMPARE ;Compare report text
"RTN","LRAPMRL",199,0)
 S (LRCHG,LRQUIT,LRCT)=0
"RTN","LRAPMRL",200,0)
 S:'LRAU LRFILE="^LR(LRDFN,LRSS,LRI,LRFLD,"
"RTN","LRAPMRL",201,0)
 S:LRAU LRFILE="^LR(LRDFN,82,"
"RTN","LRAPMRL",202,0)
 I '$D(@(LRFILE_"0)")) D  Q
"RTN","LRAPMRL",203,0)
 .Q:LRNOTXT
"RTN","LRAPMRL",204,0)
 .S LRQUIT=1
"RTN","LRAPMRL",205,0)
 F  S LRCT=$O(@(LRFILE_"LRCT)")) Q:'LRCT  D
"RTN","LRAPMRL",206,0)
 .S LRXTMP=@(LRFILE_"LRCT,0)")
"RTN","LRAPMRL",207,0)
 .I '$D(^TMP("DIQ1",$J,LRCT)) S LRCHG=1 Q
"RTN","LRAPMRL",208,0)
 .S LRYTMP=^TMP("DIQ1",$J,LRCT)
"RTN","LRAPMRL",209,0)
 .I LRXTMP'=LRYTMP S LRCHG=1
"RTN","LRAPMRL",210,0)
 I 'LRCHG D
"RTN","LRAPMRL",211,0)
 .S LRCT=0 F  S LRCT=$O(^TMP("DIQ1",$J,LRCT)) Q:'LRCT  D
"RTN","LRAPMRL",212,0)
 ..I '$D(@(LRFILE_"LRCT,0)")) S LRCHG=1
"RTN","LRAPMRL",213,0)
 I 'LRCHG D  Q
"RTN","LRAPMRL",214,0)
 .D EN^DDIOL("No changes made to "_LRDSC_".","","!!")
"RTN","LRAPMRL",215,0)
 .W !
"RTN","LRAPMRL",216,0)
 .K ^TMP("DIQ1",$J)
"RTN","LRAPMRL",217,0)
 I LRCHG&(LRFLD=1.4!(LRFLD=32.3)) D  ;Indicate that the diagnosis
"RTN","LRAPMRL",218,0)
 .K LRFDA                            ;has been modified.
"RTN","LRAPMRL",219,0)
 .S:'LRAU LRFDA(LRSF,LRIENS,.172)=1
"RTN","LRAPMRL",220,0)
 .;KLL-CORRECT BUG WHERE LRSF IS NULL, REPLACE LRSF WITH 63
"RTN","LRAPMRL",221,0)
 .S:LRAU LRFDA(63,LRIENS,102.2)=1
"RTN","LRAPMRL",222,0)
 .;S:LRAU LRFDA(LRSF,LRIENS,102.2)=1
"RTN","LRAPMRL",223,0)
 .D FILE^DIE("","LRFDA")
"RTN","LRAPMRL",224,0)
 Q
"RTN","LRAPMRL",225,0)
AUDIT ;
"RTN","LRAPMRL",226,0)
 N LRNTIME
"RTN","LRAPMRL",227,0)
 K LRFDA
"RTN","LRAPMRL",228,0)
 D NOW^%DTC S LRNTIME=%
"RTN","LRAPMRL",229,0)
 S LRIENS1="+1,"_LRIENS
"RTN","LRAPMRL",230,0)
 S LRFILE=+$$GET1^DID(LRSF,LRFLDA,"","SPECIFIER")
"RTN","LRAPMRL",231,0)
 I LRFILE="" S LRQUIT=1 Q
"RTN","LRAPMRL",232,0)
 S LRFDA(1,LRFILE,LRIENS1,.01)=LRNTIME
"RTN","LRAPMRL",233,0)
 S LRFDA(1,LRFILE,LRIENS1,.02)=DUZ
"RTN","LRAPMRL",234,0)
 D UPDATE^DIE("","LRFDA(1)","LRORIEN")
"RTN","LRAPMRL",235,0)
 Q
"RTN","LRAPMRL",236,0)
STORE ;
"RTN","LRAPMRL",237,0)
 K LRIENS1
"RTN","LRAPMRL",238,0)
 S LRIENS1=LRORIEN(1)_","_LRIENS
"RTN","LRAPMRL",239,0)
 S LRWPROOT="^TMP(""DIQ1"",$J)"
"RTN","LRAPMRL",240,0)
 D WP^DIE(LRFILE,LRIENS1,1,"",LRWPROOT)
"RTN","LRAPMRL",241,0)
 K ^TMP("DIQ1",$J)
"RTN","LRAPMRL",242,0)
 Q
"RTN","LRAPMRL",243,0)
SUPRPT ;Supplementary Report
"RTN","LRAPMRL",244,0)
 K DIR
"RTN","LRAPMRL",245,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPMRL",246,0)
 S DIR("A")="Edit SUPPLEMENTARY REPORTS"
"RTN","LRAPMRL",247,0)
 D ^DIR
"RTN","LRAPMRL",248,0)
 I Y="^" S LRQUIT1=1 Q
"RTN","LRAPMRL",249,0)
 Q:Y<1
"RTN","LRAPMRL",250,0)
 N LRX,LRRLS,LRA,LRFLG,LRNOW
"RTN","LRAPMRL",251,0)
 D GETRPT^LRAPDSR Q:LRQUIT
"RTN","LRAPMRL",252,0)
 S LRRLS=1,LRRLS1=0
"RTN","LRAPMRL",253,0)
 D COPY^LRAPDSR Q:LRQUIT
"RTN","LRAPMRL",254,0)
 D RPT^LRAPDSR Q:LRQUIT
"RTN","LRAPMRL",255,0)
 S Y=LRDA
"RTN","LRAPMRL",256,0)
 D RELEAS2^LRAPDSR
"RTN","LRAPMRL",257,0)
 D COMPARE^LRAPDSR Q:LRQUIT
"RTN","LRAPMRL",258,0)
 D UNRELEAS^LRAPDSR
"RTN","LRAPMRL",259,0)
 D UPDATE^LRAPDSR Q:LRQUIT
"RTN","LRAPMRL",260,0)
 D STORE^LRAPDSR
"RTN","LRAPMRL",261,0)
 Q
"RTN","LRAPMRL",262,0)
UNLOCK ;Unlock the record
"RTN","LRAPMRL",263,0)
 D UPDATE^LRPXRM(LRDFN,$G(LRSS,"AU"),$G(LRI))
"RTN","LRAPMRL",264,0)
 L -@(LRLOCK)
"RTN","LRAPMRL",265,0)
 Q
"RTN","LRAPMRL",266,0)
END ;Clean-up variables and quit
"RTN","LRAPMRL",267,0)
 K ^TMP("LRAPBR",$J),^TMP("TIUP",$J)
"RTN","LRAPMRL",268,0)
 D CLEAN^DILF
"RTN","LRAPMRL",269,0)
 D:$T(CLEAN^LRCAPES)'="" CLEAN^LRCAPES
"RTN","LRAPMRL",270,0)
 D V^LRU
"RTN","LRAPMRL",271,0)
 Q
"VER")
8.0^22.0
"BLD",7379,6)
^289
**END**
**END**
