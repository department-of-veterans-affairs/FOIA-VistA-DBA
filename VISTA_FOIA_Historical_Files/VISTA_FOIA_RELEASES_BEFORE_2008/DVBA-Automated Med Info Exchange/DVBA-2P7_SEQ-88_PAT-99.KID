Released DVBA*2.7*99 SEQ #88
Extracted from mail message
**KIDS**:DVBA*2.7*99^

**INSTALL NAME**
DVBA*2.7*99
"BLD",5637,0)
DVBA*2.7*99^AUTOMATED MED INFO EXCHANGE^0^3050722^y
"BLD",5637,1,0)
^^1^1^3050721^
"BLD",5637,1,1,0)
This patch fixes problems with the CAPRI Discharge Report.
"BLD",5637,4,0)
^9.64PA^^
"BLD",5637,"KRN",0)
^9.67PA^8989.52^19
"BLD",5637,"KRN",.4,0)
.4
"BLD",5637,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5637,"KRN",.401,0)
.401
"BLD",5637,"KRN",.402,0)
.402
"BLD",5637,"KRN",.403,0)
.403
"BLD",5637,"KRN",.5,0)
.5
"BLD",5637,"KRN",.84,0)
.84
"BLD",5637,"KRN",3.6,0)
3.6
"BLD",5637,"KRN",3.8,0)
3.8
"BLD",5637,"KRN",9.2,0)
9.2
"BLD",5637,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",5637,"KRN",9.8,0)
9.8
"BLD",5637,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5637,"KRN",9.8,"NM",1,0)
DVBAB53^^0^B21597257
"BLD",5637,"KRN",9.8,"NM","B","DVBAB53",1)

"BLD",5637,"KRN",19,0)
19
"BLD",5637,"KRN",19.1,0)
19.1
"BLD",5637,"KRN",101,0)
101
"BLD",5637,"KRN",409.61,0)
409.61
"BLD",5637,"KRN",771,0)
771
"BLD",5637,"KRN",870,0)
870
"BLD",5637,"KRN",8989.51,0)
8989.51
"BLD",5637,"KRN",8989.52,0)
8989.52
"BLD",5637,"KRN",8994,0)
8994
"BLD",5637,"KRN",8994,"NM",0)
^9.68A^^
"BLD",5637,"KRN","B",.4,.4)

"BLD",5637,"KRN","B",.401,.401)

"BLD",5637,"KRN","B",.402,.402)

"BLD",5637,"KRN","B",.403,.403)

"BLD",5637,"KRN","B",.5,.5)

"BLD",5637,"KRN","B",.84,.84)

"BLD",5637,"KRN","B",3.6,3.6)

"BLD",5637,"KRN","B",3.8,3.8)

"BLD",5637,"KRN","B",9.2,9.2)

"BLD",5637,"KRN","B",9.8,9.8)

"BLD",5637,"KRN","B",19,19)

"BLD",5637,"KRN","B",19.1,19.1)

"BLD",5637,"KRN","B",101,101)

"BLD",5637,"KRN","B",409.61,409.61)

"BLD",5637,"KRN","B",771,771)

"BLD",5637,"KRN","B",870,870)

"BLD",5637,"KRN","B",8989.51,8989.51)

"BLD",5637,"KRN","B",8989.52,8989.52)

"BLD",5637,"KRN","B",8994,8994)

"BLD",5637,"QUES",0)
^9.62^^
"BLD",5637,"REQB",0)
^9.611^1^1
"BLD",5637,"REQB",1,0)
DVBA*2.7*35^1
"BLD",5637,"REQB","B","DVBA*2.7*35",1)

"MBREQ")
0
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^3010328
"PKG",223,22,1,"PAH",1,0)
99^3050722
"PKG",223,22,1,"PAH",1,1,0)
^^1^1^3050722
"PKG",223,22,1,"PAH",1,1,1,0)
This patch fixes problems with the CAPRI Discharge Report.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","DVBAB53")
0^1^B21597257
"RTN","DVBAB53",1,0)
DVBAB53 ;ALB/SPH - CAPRI DISCHARGE REPORT ; 20 Jul 2005  3:39 PM
"RTN","DVBAB53",2,0)
 ;;2.7;AMIE;**35,99**;Apr 10, 1995
"RTN","DVBAB53",3,0)
 ;
"RTN","DVBAB53",4,0)
STRT(ZMSG,BDATE,EDATE,ADTYPE)    ;
"RTN","DVBAB53",5,0)
 I BDATE'["." S BDATE=BDATE-.0001
"RTN","DVBAB53",6,0)
 S DVBABCNT=0
"RTN","DVBAB53",7,0)
 S RONUM=0
"RTN","DVBAB53",8,0)
 S RO="N"
"RTN","DVBAB53",9,0)
 S HEAD="",HEAD1=""
"RTN","DVBAB53",10,0)
 K ^TMP($J) G TERM
"RTN","DVBAB53",11,0)
 ;
"RTN","DVBAB53",12,0)
SET Q:'$D(^DPT(DA,0))  S DFN=DA,DVBASC="" D RCV^DVBAVDPT Q:CFLOC'=RONUM&(RO="Y")&(CFLOC'=0)&(CFLOC'=376)  Q:ADTYPE="S"&(DVBASC'="Y")  Q:ADTYPE="A"&(RCVAA'=1)  Q:ADTYPE="P"&(RCVPEN'="1")
"RTN","DVBAB53",13,0)
 S TDIS=$S($D(^DGPM(+MB,0)):$P(^(0),U,18),1:"")
"RTN","DVBAB53",14,0)
 I $D(^DG(405.2,+TDIS,0)) DO
"RTN","DVBAB53",15,0)
 . ; I '$D(^TMP("DVBA",$J,"DUP",+TDIS)) Q
"RTN","DVBAB53",16,0)
 .I '$D(DISTYPE(+TDIS)) Q
"RTN","DVBAB53",17,0)
 .S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBAB53",18,0)
 .S ^TMP($J,XCN,CFLOC,MB,DA)=MA_U_RCVAA_U_RCVPEN_U_CNUM_U_TDIS
"RTN","DVBAB53",19,0)
 .Q
"RTN","DVBAB53",20,0)
 Q
"RTN","DVBAB53",21,0)
 ;
"RTN","DVBAB53",22,0)
PRINTB S MA=$P(DATA,U),RCVAA=$P(DATA,U,2),RCVPEN=$P(DATA,U,3),CNUM=$P(DATA,U,4),TDIS=$P(DATA,U,5),DFN=DA,QUIT1=1 D DCHGDT^DVBAVDPT
"RTN","DVBAB53",23,0)
 W:(IOST?1"C-".E)!($D(DVBAON2)) @IOF
"RTN","DVBAB53",24,0)
 W !!!,?(80-$L(HEAD)\2),HEAD,!,?(80-$L(HEAD1)\2),HEAD1,!!
"RTN","DVBAB53",25,0)
 S ZMSG(DVBABCNT)="",DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",26,0)
 ;
"RTN","DVBAB53",27,0)
 S ZMSG(DVBABCNT)="          Patient Name:    "_PNAM  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",28,0)
 S ZMSG(DVBABCNT)="              Claim No:    "_CNUM  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",29,0)
 S ZMSG(DVBABCNT)="      Claim Folder Loc:    "_CFLOC  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",30,0)
 S ZMSG(DVBABCNT)="         Social Sec No:    "_SSN  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",31,0)
 S ZMSG(DVBABCNT)="        Discharge Date:    "_$$FMTE^XLFDT(DCHGDT,"5DZ"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",32,0)
 S ZMSG(DVBABCNT)="     Type of Discharge:    "_TDIS,DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",33,0)
 D LOS^DVBAUTIL
"RTN","DVBAB53",34,0)
 S ZMSG(DVBABCNT)="        Length of Stay:    "_LOS_$S(LOS="":"Discharged same day",LOS=1:" day",1:" days"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",35,0)
 S ZMSG(DVBABCNT)="           Bed Service:    "_BEDSEC,DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",36,0)
 S ZMSG(DVBABCNT)="             Recv A&A?:    "_$S(RCVAA="0":"NO",RCVAA="1":"YES",1:"Not specified"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",37,0)
 S ZMSG(DVBABCNT)="              Pension?:    "_$S(RCVPEN="0":"NO",RCVPEN="1":"YES",1:"Not specified"),DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",38,0)
 ;
"RTN","DVBAB53",39,0)
 ;
"RTN","DVBAB53",40,0)
 ; ELIG INFO...
"RTN","DVBAB53",41,0)
 S ELIG=DVBAELIG,INCMP=""
"RTN","DVBAB53",42,0)
 ;S ZMSG(DVBABCNT)="      Eligibility data:"
"RTN","DVBAB53",43,0)
 I ELIG]"" S ELIG=ELIG_" ("_$S(DVBAELST="P":"Pend Ver",DVBAELST="R":"Pend Re-verif",DVBAELST="V":"Verified",1:"Not Verified")_")"
"RTN","DVBAB53",44,0)
 I $D(^DPT(DA,.29)) S INCMP=$S($P(^(.29),U,12)=1:"Incompetent",1:"")
"RTN","DVBAB53",45,0)
 S ZMSG(DVBABCNT)="       Eligibility data:   "_ELIG_$S(ELIG]"":", ",1:"")  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",46,0)
 W:$X>60 !?26 S ZMSG(DVBABCNT)=INCMP  S DVBABCNT=DVBABCNT+1
"RTN","DVBAB53",47,0)
 Q
"RTN","DVBAB53",48,0)
 ;END OF ELIG INFO
"RTN","DVBAB53",49,0)
 ;
"RTN","DVBAB53",50,0)
 ;I IOST?1"C-".E W *7,!,"Press RETURN to continue or ""^"" to stop    " R ANS:DTIME S:ANS=U!('$T) QUIT=1 I ANS=U S DVBAQUIT=1
"RTN","DVBAB53",51,0)
 S DVBAON2=""
"RTN","DVBAB53",52,0)
 Q
"RTN","DVBAB53",53,0)
 ;
"RTN","DVBAB53",54,0)
PRINT U IO S QUIT=""
"RTN","DVBAB53",55,0)
 S XCN="" F M=0:0 S XCN=$O(^TMP($J,XCN)) Q:XCN=""!(QUIT=1)  S CFLOC="" F J=0:0 S CFLOC=$O(^TMP($J,XCN,CFLOC)) Q:CFLOC=""!(QUIT=1)  D PRINT1
"RTN","DVBAB53",56,0)
 Q
"RTN","DVBAB53",57,0)
PRINT1 S ADM="" F K=0:0 S ADM=$O(^TMP($J,XCN,CFLOC,ADM)) Q:ADM=""!(QUIT=1)  S DA="" F L=0:0 S DA=$O(^TMP($J,XCN,CFLOC,ADM,DA)) Q:DA=""!(QUIT=1)  S DATA=^(DA) D PRINTB
"RTN","DVBAB53",58,0)
 Q
"RTN","DVBAB53",59,0)
 ;
"RTN","DVBAB53",60,0)
TERM ;D HOME^%ZIS K NOASK
"RTN","DVBAB53",61,0)
 ;
"RTN","DVBAB53",62,0)
SETUP ;W @IOF,!,"VARO DISCHARGE REPORT" D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL S DTAR=^DVB(396.1,1,0),FDT(0)=$$FMTE^XLFDT(DT,"5DZ")
"RTN","DVBAB53",63,0)
 S DSRP=1
"RTN","DVBAB53",64,0)
 ;S HEAD1="FOR "_$P(DTAR,U,1)_" ON "_FDT(0) W !,HEAD1
"RTN","DVBAB53",65,0)
 ;
"RTN","DVBAB53",66,0)
EN1 ;W !!,"Please enter dates for search, oldest date first, most recent date last.",!!,"Last report was run on " S Y=$P(DTAR,U,4) X ^DD("DD") W Y,!!
"RTN","DVBAB53",67,0)
 ;D DATE^DVBAUTIL
"RTN","DVBAB53",68,0)
 ;G:X=""!(Y<0) KILL
"RTN","DVBAB53",69,0)
 ;
"RTN","DVBAB53",70,0)
ADTYPE ;D ADTYPE^DVBAUTL2 G:$D(DVBAQUIT) KILL^DVBAUTIL
"RTN","DVBAB53",71,0)
 ;W @IOF
"RTN","DVBAB53",72,0)
 ;K DVBACEPT
"RTN","DVBAB53",73,0)
 D EN^DVBAB99("DVBA DISCHARGE TYPES")
"RTN","DVBAB53",74,0)
 D ACCEPT^DVBALD
"RTN","DVBAB53",75,0)
 I '$D(DVBACEPT) D KILL^DVBAUTIL Q
"RTN","DVBAB53",76,0)
 I '$O(^TMP("DVBA",$J,"DUP",0)) D KILL^DVBAUTIL Q
"RTN","DVBAB53",77,0)
 M DISTYPE=^TMP("DVBA",$J,"DUP")
"RTN","DVBAB53",78,0)
 ;
"RTN","DVBAB53",79,0)
 W !!! S %ZIS="Q" D ^%ZIS K %ZIS G:POP KILL^DVBAUTIL
"RTN","DVBAB53",80,0)
 ;
"RTN","DVBAB53",81,0)
QUEUE I $D(IO("Q")) S ZTRTN="DEQUE^DVBADSRT",ZTIO=ION,NOASK=1,ZTDESC="AMIE DISCHARGE REPORT" F I="DISTYPE(","ADTYPE","DVBATYPS","BDATE","BDATE1","EDATE","FDT(0)","HEAD","HEAD1","HD","RO","RONUM","NOASK" S ZTSAVE(I)=""
"RTN","DVBAB53",82,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",! G KILL
"RTN","DVBAB53",83,0)
 ;
"RTN","DVBAB53",84,0)
GO S MA=BDATE F J=0:0 S MA=$O(^DGPM("AMV3",MA)) Q:MA>EDATE!(MA="")  W:'$D(NOASK) "." F DA=0:0 S DA=$O(^DGPM("AMV3",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV3",MA,DA,MB)) Q:MB=""  D SET
"RTN","DVBAB53",85,0)
 I '$D(^TMP($J)) U IO W !!,*7,"No data found for parameters entered.",!! H 2 G KILL
"RTN","DVBAB53",86,0)
 D PRINT I $D(DVBAQUIT) K DVBAON2,DISTYPE G KILL^DVBAUTIL
"RTN","DVBAB53",87,0)
 ;
"RTN","DVBAB53",88,0)
KILL D ^%ZISC D:$D(ZTQUEUED) KILL^%ZTLOAD S X=4 K DVBAON2,DISTYPE G FINAL^DVBAUTIL
"RTN","DVBAB53",89,0)
 ;
"RTN","DVBAB53",90,0)
DEQUE K ^TMP($J) G GO
"VER")
8.0^22.0
"BLD",5637,6)
^88
**END**
**END**
