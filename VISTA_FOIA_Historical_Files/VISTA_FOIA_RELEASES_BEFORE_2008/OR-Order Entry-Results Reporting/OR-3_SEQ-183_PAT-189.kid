Released OR*3*189 SEQ #183
Extracted from mail message
**KIDS**:OR*3.0*189^

**INSTALL NAME**
OR*3.0*189
"BLD",4516,0)
OR*3.0*189^ORDER ENTRY/RESULTS REPORTING^0^3030812^y
"BLD",4516,1,0)
^^1^1^3021212^^^^
"BLD",4516,1,1,0)
Refer to the patch description on the patch message.
"BLD",4516,4,0)
^9.64PA^^0
"BLD",4516,"ABNS",0)
^9.66A^^
"BLD",4516,"ABPKG")
n^y^G.LABTEST@ISC-SLC.VA.GOV
"BLD",4516,"INI")

"BLD",4516,"INIT")

"BLD",4516,"KRN",0)
^9.67PA^8989.52^20
"BLD",4516,"KRN",.4,0)
.4
"BLD",4516,"KRN",.401,0)
.401
"BLD",4516,"KRN",.402,0)
.402
"BLD",4516,"KRN",.403,0)
.403
"BLD",4516,"KRN",.5,0)
.5
"BLD",4516,"KRN",.84,0)
.84
"BLD",4516,"KRN",3.6,0)
3.6
"BLD",4516,"KRN",3.8,0)
3.8
"BLD",4516,"KRN",9.2,0)
9.2
"BLD",4516,"KRN",9.8,0)
9.8
"BLD",4516,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4516,"KRN",9.8,"NM",1,0)
ORPRS02^^0^B8818479
"BLD",4516,"KRN",9.8,"NM",2,0)
ORWORR^^0^B61679744
"BLD",4516,"KRN",9.8,"NM",3,0)
ORCHTAB1^^0^B65243514
"BLD",4516,"KRN",9.8,"NM","B","ORCHTAB1",3)

"BLD",4516,"KRN",9.8,"NM","B","ORPRS02",1)

"BLD",4516,"KRN",9.8,"NM","B","ORWORR",2)

"BLD",4516,"KRN",19,0)
19
"BLD",4516,"KRN",19,"NM",0)
^9.68A^^
"BLD",4516,"KRN",19.1,0)
19.1
"BLD",4516,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4516,"KRN",101,0)
101
"BLD",4516,"KRN",101,"NM",0)
^9.68A^^0
"BLD",4516,"KRN",409.61,0)
409.61
"BLD",4516,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",4516,"KRN",771,0)
771
"BLD",4516,"KRN",869.2,0)
869.2
"BLD",4516,"KRN",870,0)
870
"BLD",4516,"KRN",8989.51,0)
8989.51
"BLD",4516,"KRN",8989.52,0)
8989.52
"BLD",4516,"KRN",8994,0)
8994
"BLD",4516,"KRN","B",.4,.4)

"BLD",4516,"KRN","B",.401,.401)

"BLD",4516,"KRN","B",.402,.402)

"BLD",4516,"KRN","B",.403,.403)

"BLD",4516,"KRN","B",.5,.5)

"BLD",4516,"KRN","B",.84,.84)

"BLD",4516,"KRN","B",3.6,3.6)

"BLD",4516,"KRN","B",3.8,3.8)

"BLD",4516,"KRN","B",9.2,9.2)

"BLD",4516,"KRN","B",9.8,9.8)

"BLD",4516,"KRN","B",19,19)

"BLD",4516,"KRN","B",19.1,19.1)

"BLD",4516,"KRN","B",101,101)

"BLD",4516,"KRN","B",409.61,409.61)

"BLD",4516,"KRN","B",771,771)

"BLD",4516,"KRN","B",869.2,869.2)

"BLD",4516,"KRN","B",870,870)

"BLD",4516,"KRN","B",8989.51,8989.51)

"BLD",4516,"KRN","B",8989.52,8989.52)

"BLD",4516,"KRN","B",8994,8994)

"BLD",4516,"QUES",0)
^9.62^^
"BLD",4516,"REQB",0)
^9.611^3^3
"BLD",4516,"REQB",1,0)
OR*3.0*121^2
"BLD",4516,"REQB",2,0)
OR*3.0*163^2
"BLD",4516,"REQB",3,0)
OR*3.0*141^2
"BLD",4516,"REQB","B","OR*3.0*121",1)

"BLD",4516,"REQB","B","OR*3.0*141",3)

"BLD",4516,"REQB","B","OR*3.0*163",2)

"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
189^3030812
"PKG",110,22,1,"PAH",1,1,0)
^^1^1^3030812
"PKG",110,22,1,"PAH",1,1,1,0)
Refer to the patch description on the patch message.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ORCHTAB1")
0^3^B65243514
"RTN","ORCHTAB1",1,0)
ORCHTAB1 ;SLC/MKB-Build Chart-tabs cont ;6/14/02  12:49
"RTN","ORCHTAB1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**2,27,58,72,141,189**;Dec 17, 1997
"RTN","ORCHTAB1",3,0)
EN ; -- rebuild ORTAB listing
"RTN","ORCHTAB1",4,0)
 Q:'$L($T(@ORTAB))  G @ORTAB
"RTN","ORCHTAB1",5,0)
 Q
"RTN","ORCHTAB1",6,0)
 ;
"RTN","ORCHTAB1",7,0)
DT(X) ; -- Returns FM date for X
"RTN","ORCHTAB1",8,0)
 N Y,%DT S %DT="T",Y="" D:X'="" ^%DT
"RTN","ORCHTAB1",9,0)
 Q Y
"RTN","ORCHTAB1",10,0)
 ;
"RTN","ORCHTAB1",11,0)
COVER ; -- cover sheet
"RTN","ORCHTAB1",12,0)
 N LBL,X
"RTN","ORCHTAB1",13,0)
 F LBL="GMRA","CWAD","GMRV","IMM","SC" D @(LBL_"^ORCHTAB2"),BLANK^ORCHTAB
"RTN","ORCHTAB1",14,0)
 S ORMENU="ORCHART COVER MENU",DEFCXT=1
"RTN","ORCHTAB1",15,0)
 S ORTITLE="Cover Sheet",ORACTNS="ORC COVER ACTIONS",ORRM=81
"RTN","ORCHTAB1",16,0)
 S ORCAPTN("ITEM")="Item",ORCAPTN("DATA")="Entered",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",17,0)
 Q
"RTN","ORCHTAB1",18,0)
 ;
"RTN","ORCHTAB1",19,0)
NOTES ; -- progress notes
"RTN","ORCHTAB1",20,0)
 N BEG,END,STS,AUTHOR,ORY,ORI,ORX,OCCLIM,SUBJ
"RTN","ORCHTAB1",21,0)
 I '$L(CONTEXT) S CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT NOTES"),DEFCXT=1,OCCLIM=$P($$PERSPRF^TIULE(DUZ),U,10) S:+OCCLIM>0 $P(CONTEXT,";",5)=OCCLIM
"RTN","ORCHTAB1",22,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),STS=$P(CONTEXT,";",3),AUTHOR=$P(CONTEXT,";",4),OCCLIM=$P(CONTEXT,";",5),SUBJ=$P(CONTEXT,";",6)
"RTN","ORCHTAB1",23,0)
 D CONTEXT^TIUSRVLO(.ORY,3,STS,+ORVP,BEG,END,AUTHOR,OCCLIM) S ORI=0
"RTN","ORCHTAB1",24,0)
 I $L($G(ORY)) F  S ORI=$O(@ORY@(ORI)) Q:ORI'>0  S ORX=@ORY@(ORI) D NOTE^ORCHTAB2
"RTN","ORCHTAB1",25,0)
 S ORTITLE=$S(STS=2:"Unsigned",STS=3:"Uncosigned",1:"Signed")_" Notes"_$S(AUTHOR:" by "_$$LNAMEF^ORCHTAB(AUTHOR),1:"")
"RTN","ORCHTAB1",26,0)
 S ORCAPTN("ITEM")="Title",ORCAPTN("DATA")="Written         Author      SigSt",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",27,0)
 S ORACTNS="ORC TIU ACTIONS",ORCHANGE="ORCHANGE NOTES",ORRM=81
"RTN","ORCHTAB1",28,0)
 S ORMENU="ORCHART NOTES MENU" K @ORY
"RTN","ORCHTAB1",29,0)
 Q
"RTN","ORCHTAB1",30,0)
 ;
"RTN","ORCHTAB1",31,0)
SUMMRIES ; -- discharge summary
"RTN","ORCHTAB1",32,0)
 N BEG,END,STS,AUTHOR,ORY,ORI,ORX
"RTN","ORCHTAB1",33,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT SUMMRIES"),DEFCXT=1
"RTN","ORCHTAB1",34,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),STS=$P(CONTEXT,";",3),AUTHOR=$P(CONTEXT,";",4)
"RTN","ORCHTAB1",35,0)
 D CONTEXT^TIUSRVLO(.ORY,244,STS,+ORVP,BEG,END,AUTHOR) S ORI=0
"RTN","ORCHTAB1",36,0)
 I $L($G(ORY)) F  S ORI=$O(@ORY@(ORI)) Q:ORI'>0  S ORX=@ORY@(ORI) D SUMM^ORCHTAB2
"RTN","ORCHTAB1",37,0)
 S ORCAPTN("ITEM")="Title",ORCAPTN("DATA")="Ref Date     Author         SigSt",ORCAPTN("MORE")="Admitted  Discharged             "
"RTN","ORCHTAB1",38,0)
 S ORACTNS="ORC TIU ACTIONS",ORMENU="ORCHART SUMMARIES MENU",ORCHANGE="ORCHANGE NOTES",ORRM=114
"RTN","ORCHTAB1",39,0)
 S ORTITLE=$S(STS=2:"Unsigned",STS=3:"Uncosigned",1:"Signed")_" D/C Summaries"_$S(AUTHOR:" by "_$$LNAMEF^ORCHTAB(AUTHOR),1:"") K @ORY
"RTN","ORCHTAB1",40,0)
 Q
"RTN","ORCHTAB1",41,0)
 ;
"RTN","ORCHTAB1",42,0)
PROBLEMS ; -- problem list
"RTN","ORCHTAB1",43,0)
 N COMM,ST,ORY,ORI,ORX
"RTN","ORCHTAB1",44,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT PROBLEMS"),DEFCXT=1
"RTN","ORCHTAB1",45,0)
 S ST=$P(CONTEXT,";",3),COMM=$P(CONTEXT,";",4) ;,PROV=$P(CONTEXT,";",5)
"RTN","ORCHTAB1",46,0)
 D LIST^GMPLUTL2(.ORY,+ORVP,ST,COMM)
"RTN","ORCHTAB1",47,0)
 S ORI=0 F  S ORI=$O(ORY(ORI)) Q:ORI'>0  S ORX=ORY(ORI) D PROB^ORCHTAB2
"RTN","ORCHTAB1",48,0)
 S ORCAPTN("ITEM")="Problem",ORCAPTN("DATA")="Onset     Updated   Status",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",49,0)
 S ORTITLE=$S(ST="A":"Active",ST="I":"Inactive",1:"All")_" Problems"
"RTN","ORCHTAB1",50,0)
 S ORACTNS="ORC PROBLEM ACTIONS",ORCHANGE="ORCHANGE PROBLEMS",ORRM=81
"RTN","ORCHTAB1",51,0)
 S ORMENU="ORCHART PROBLEMS MENU"
"RTN","ORCHTAB1",52,0)
 Q
"RTN","ORCHTAB1",53,0)
 ;
"RTN","ORCHTAB1",54,0)
NEW ; -- new orders in ORNEW()
"RTN","ORCHTAB1",55,0)
 N OREVENT S CONTEXT=";;19;ALL;L",DEFCXT=1 G ORDERS
"RTN","ORCHTAB1",56,0)
DELAY ; -- delayed orders [from ORCACT3]
"RTN","ORCHTAB1",57,0)
 N OREVENT S CONTEXT=";;24;ALL;L",DEFCXT=1 G ORDERS
"RTN","ORCHTAB1",58,0)
 ;
"RTN","ORCHTAB1",59,0)
ORDERS ; -- orders
"RTN","ORCHTAB1",60,0)
 N DGRP,STS,BEG,END,ORLIST,ORIFN,ORI,MULT,ORYD,FRMT,DELAY,EVT
"RTN","ORCHTAB1",61,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT ORDERS"),DEFCXT=1
"RTN","ORCHTAB1",62,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2))
"RTN","ORCHTAB1",63,0)
 S DGRP=$P(CONTEXT,";",4),FRMT=$P(CONTEXT,";",5),EVT=$P(CONTEXT,";",8)
"RTN","ORCHTAB1",64,0)
 S:'$L(DGRP) DGRP="ALL" S DGRP=+$O(^ORD(100.98,"B",DGRP,0))
"RTN","ORCHTAB1",65,0)
 S STS=+$P(CONTEXT,";",3),DELAY=$S("^15^16^17^24^25^26^"[(U_STS_U):1,'EVT:0,$P($G(^ORE(100.2,+EVT,1)),U,5):1,$O(^ORE(100.2,"DAD",+EVT,0)):1,1:0)
"RTN","ORCHTAB1",66,0)
 S MULT=$S("^1^6^8^9^10^11^13^14^20^22^"[(U_STS_U):1,1:0)
"RTN","ORCHTAB1",67,0)
 S ORTITLE=$$STATUS(STS,EVT)_$S(DGRP>1:" "_$P($G(^ORD(100.98,+DGRP,0)),U,2),1:"")_" Orders",ORRM=114
"RTN","ORCHTAB1",68,0)
 S ORCAPTN("ITEM")="Item Ordered",ORCAPTN("MORE")="NRS    CLK    Chart             "
"RTN","ORCHTAB1",69,0)
 S:FRMT="S" ORCAPTN("DATA")="Start Date      Order Status"
"RTN","ORCHTAB1",70,0)
 S:FRMT'="S" ORCAPTN("DATA")="Provider    Start      Stop  Sts"
"RTN","ORCHTAB1",71,0)
 D EN^ORQ1(ORVP,DGRP,+STS,,BEG,END,,MULT,,1,EVT),ORYD^ORDD100 ;Get list
"RTN","ORCHTAB1",72,0)
 S ORI=0 F  S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI'>0  S ORIFN=$G(^(ORI)) D ORDER^ORCHTAB3:'DELAY,DELAYED^ORCHTAB3:DELAY
"RTN","ORCHTAB1",73,0)
 S DELAY=$S("^15^16^17^24^25^26^"[(U_STS_U):1,$G(OREVENT):1,1:0)
"RTN","ORCHTAB1",74,0)
 S ORACTNS="ORC "_$S(ORTAB="NEW":"NEW",DELAY:"DELAYED ORDER",$D(^XUSEC("ORES",DUZ)):"ORES ORDER",$D(^XUSEC("ORELSE",DUZ)):"ORELSE ORDER",$D(^XUSEC("OREMAS",DUZ)):"OREMAS ORDER",1:"ORDER")_" ACTIONS"
"RTN","ORCHTAB1",75,0)
 I ORTAB'="NEW" S ORCHANGE="ORCHANGE ORDERS "_$S(FRMT="L":"LONG",1:"SHORT")
"RTN","ORCHTAB1",76,0)
 K ^TMP("ORR",$J,ORLIST)
"RTN","ORCHTAB1",77,0)
 Q
"RTN","ORCHTAB1",78,0)
 ;
"RTN","ORCHTAB1",79,0)
STATUS(X,Y) ; -- Return name of context/status number
"RTN","ORCHTAB1",80,0)
 N Z I $G(Y) S Z=$$NAME^OREVNTX(Y),Z=$$LOWER^VALM1(Z) Q Z  ;Event
"RTN","ORCHTAB1",81,0)
 S Z="All^Active^Discontinued^Completed/Expired^Expiring^Recent^Pending^Unverified^Unverified^Unverified^Unsigned^Flagged^Verbal^Unsigned Verbal^Admission^Discharge^Transfer^Held^New^Unverified^^Lapsed^Current^Delayed^O.R.^Delayed"
"RTN","ORCHTAB1",82,0)
 Q $P(Z,U,+X)
"RTN","ORCHTAB1",83,0)
 ;
"RTN","ORCHTAB1",84,0)
MEDS ; -- medications
"RTN","ORCHTAB1",85,0)
 N BEG,END,INPT,ORI,ORJ,ORX
"RTN","ORCHTAB1",86,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT MEDS"),DEFCXT=1
"RTN","ORCHTAB1",87,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2))
"RTN","ORCHTAB1",88,0)
 S INPT=$P(CONTEXT,";",3) S:'$L(INPT) INPT=$S($G(ORWARD):1,1:0)
"RTN","ORCHTAB1",89,0)
 D OCL^PSOORRL(+ORVP,BEG,END),SORT^ORCHTAB3(INPT)
"RTN","ORCHTAB1",90,0)
 S ORJ=0 F  S ORJ=$O(^TMP("ORPS",$J,ORJ)) Q:ORJ'>0  S ORI=0 F  S ORI=$O(^TMP("ORPS",$J,ORJ,ORI)) Q:ORI'>0  S ORX=$G(^TMP("PS",$J,ORI,0)) D MEDS^ORCHTAB3
"RTN","ORCHTAB1",91,0)
 S ORCAPTN("ITEM")="Medication",ORCAPTN("MORE")="",ORRM=81
"RTN","ORCHTAB1",92,0)
 S:INPT ORCAPTN("DATA")="Start     Stop      Status"
"RTN","ORCHTAB1",93,0)
 S:'INPT ORCAPTN("DATA")="Requestor   Expires   Status"
"RTN","ORCHTAB1",94,0)
 S ORACTNS="ORC "_$S(INPT:"IN",1:"OUT")_"PT MED ACTIONS",ORMENU="ORCHART MEDS MENU"
"RTN","ORCHTAB1",95,0)
 S ORCHANGE="ORCHANGE MEDS "_$S(INPT:"INPT",1:"OUTPT")
"RTN","ORCHTAB1",96,0)
 S ORTITLE=$S($L(BEG)!$L(END):"",1:"Active ")_$S(INPT:"In",1:"Out")_"patient Medications"
"RTN","ORCHTAB1",97,0)
 K ^TMP("PS",$J),^TMP("ORPS",$J)
"RTN","ORCHTAB1",98,0)
 Q
"RTN","ORCHTAB1",99,0)
 ;
"RTN","ORCHTAB1",100,0)
LABS ; -- laboratory
"RTN","ORCHTAB1",101,0)
 N BEG,END,TYPE,SUB,X
"RTN","ORCHTAB1",102,0)
 I '$L(CONTEXT) S CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT "_$S($G(ORWARD):"IN",1:"OUT")_"PT LABS"),DEFCXT=1
"RTN","ORCHTAB1",103,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),TYPE=$P(CONTEXT,";",3),ORRM=81
"RTN","ORCHTAB1",104,0)
 I TYPE="C" D LRCUM^ORCHTAB4 Q  ; cum
"RTN","ORCHTAB1",105,0)
 D RR^LR7OR1(+ORVP,,BEG,END)
"RTN","ORCHTAB1",106,0)
 S SUB="CH" D LABS^ORCHTAB4,BLANK^ORCHTAB ; MI,AP,BB ??
"RTN","ORCHTAB1",107,0)
 S ORTITLE="Lab Tests" ;,ORACTNS="ORC LAB ACTIONS"
"RTN","ORCHTAB1",108,0)
 S ORCAPTN("ITEM")="Test       Result    Units      Range"
"RTN","ORCHTAB1",109,0)
 S ORCAPTN("DATA")="Collected       Accession     Sts",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",110,0)
 S ORCHANGE="ORCHANGE LAB LIST",ORMENU="ORCHART LABS MENU"
"RTN","ORCHTAB1",111,0)
 K ^TMP("LRRR",$J)
"RTN","ORCHTAB1",112,0)
 Q
"RTN","ORCHTAB1",113,0)
 ;
"RTN","ORCHTAB1",114,0)
XRAYS ; -- radiology
"RTN","ORCHTAB1",115,0)
 N BEG,END,MAX,ORI,ORX
"RTN","ORCHTAB1",116,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT XRAYS"),DEFCXT=1
"RTN","ORCHTAB1",117,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),MAX=$P(CONTEXT,";",5)
"RTN","ORCHTAB1",118,0)
 S ORX=$L($T(EN1^RAO7PC1),",") D EN1^RAO7PC1(+ORVP,BEG,END,MAX):ORX=4
"RTN","ORCHTAB1",119,0)
 D EN1^RAO7PC1(+ORVP,BEG,END,MAX,1):ORX>4 ;incl cancelled exams
"RTN","ORCHTAB1",120,0)
 S ORI=0 F  S ORI=$O(^TMP($J,"RAE1",+ORVP,ORI)) Q:ORI'>0  S ORX=$G(^(ORI)) D XRAY^ORCHTAB4
"RTN","ORCHTAB1",121,0)
 S ORCAPTN("ITEM")="Procedure",ORCAPTN("DATA")="Exam Date       Case  Report Sts",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",122,0)
 S ORACTNS="ORC XRAY ACTIONS",ORCHANGE="ORCHANGE XRAYS",ORRM=81
"RTN","ORCHTAB1",123,0)
 S ORTITLE="Imaging Procedures",ORMENU="ORCHART XRAYS MENU"
"RTN","ORCHTAB1",124,0)
 K ^TMP($J,"RAE1")
"RTN","ORCHTAB1",125,0)
 Q
"RTN","ORCHTAB1",126,0)
 ;
"RTN","ORCHTAB1",127,0)
CONSULTS ; -- consults
"RTN","ORCHTAB1",128,0)
 N BEG,END,STS,SERV,ORI,ORX
"RTN","ORCHTAB1",129,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT CONSULTS"),DEFCXT=1
"RTN","ORCHTAB1",130,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),STS=$P(CONTEXT,";",3),SERV=$P(CONTEXT,";",4)
"RTN","ORCHTAB1",131,0)
 S ORTITLE=$S($L(STS,",")>1:"Selected",STS:$$LOWER^VALM1($P(^ORD(100.01,+STS,0),U)),1:"All")_" "_$S('SERV:"",$L($G(^GMR(123.5,+SERV,.1))):^(.1)_" ",1:$P($G(^GMR(123.5,+SERV,0)),U)_" ")_"Consults"
"RTN","ORCHTAB1",132,0)
 D OER^GMRCSLM1(+ORVP,SERV,BEG,END,STS)
"RTN","ORCHTAB1",133,0)
 S ORI=0 F  S ORI=$O(^TMP("GMRCR",$J,"CS",ORI)) Q:ORI'>0  S ORX=$G(^(ORI,0)) Q:$E(ORX)="<"  D CSLT^ORCHTAB4
"RTN","ORCHTAB1",134,0)
 S ORCAPTN("ITEM")="Consult/Procedure",ORCAPTN("DATA")="Requested    No.  Status",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",135,0)
 S ORACTNS="ORC CONSULT ACTIONS",ORCHANGE="ORCHANGE CONSULTS",ORRM=81
"RTN","ORCHTAB1",136,0)
 S ORMENU="ORCHART CONSULTS MENU"
"RTN","ORCHTAB1",137,0)
 K ^TMP("GMRCR",$J)
"RTN","ORCHTAB1",138,0)
 Q
"RTN","ORCHTAB1",139,0)
 ;
"RTN","ORCHTAB1",140,0)
REPORTS ; -- patient profiles
"RTN","ORCHTAB1",141,0)
 N X,BEG,END,MAX D RPT^ORCHTAB4
"RTN","ORCHTAB1",142,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT REPORTS"),DEFCXT=1 S X="Radiology"
"RTN","ORCHTAB1",143,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),MAX=$P(CONTEXT,";",5)
"RTN","ORCHTAB1",144,0)
 S X="Imaging ("_$$DATE^ORCHTAB(BEG)_" to "_$$DATE^ORCHTAB(END)_$S(MAX:", limit "_MAX,1:"")_")"
"RTN","ORCHTAB1",145,0)
 D BLANK^ORCHTAB,SUBHDR^ORCHTAB(X),XRAYS
"RTN","ORCHTAB1",146,0)
 I $L($T(EN^MCARPS2)) D BLANK^ORCHTAB,SUBHDR^ORCHTAB("Summary of Patient Procedures"),MED^ORCHTAB5
"RTN","ORCHTAB1",147,0)
 S ORCAPTN("ITEM")="Report",ORCAPTN("DATA")="Date            Case  Status",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",148,0)
 S ORACTNS="ORC REPORT ACTIONS",ORMENU="ORCHART REPORTS MENU",ORRM=81
"RTN","ORCHTAB1",149,0)
 S ORCHANGE="ORCHANGE REPORTS",ORTITLE="Reports"
"RTN","ORCHTAB1",150,0)
 Q
"RTN","ORPRS02")
0^1^B8818479
"RTN","ORPRS02",1,0)
ORPRS02 ; slc/dcm - Jurasic Prints ;11/18/96  20:20
"RTN","ORPRS02",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**11,69,99,121,189**;Dec 17, 1997
"RTN","ORPRS02",3,0)
DAY ; Process 24-hr Order Summary
"RTN","ORPRS02",4,0)
 N I,ORATTEND,ORTIT,ORPRES,ORSHORT,ORDG,ORGRP,ORSEL,ORSEQ
"RTN","ORPRS02",5,0)
 S OREND=0,ORTIT="DAILY ORDER SUMMARY",ORPRES=1,ORSHORT=$$SHORT
"RTN","ORPRS02",6,0)
 S ORDG=1,ORGRP("NAM")="ALL",ORGRP("ROOT")=1
"RTN","ORPRS02",7,0)
 D WRT
"RTN","ORPRS02",8,0)
 Q
"RTN","ORPRS02",9,0)
RANGE ; Order Summary for Date/time Range
"RTN","ORPRS02",10,0)
 N I,ORATTEND,ORTIT,ORPRES,ORSHORT,ORDG,ORGRP,ORSEL,ORSEQ
"RTN","ORPRS02",11,0)
 S OREND=0,ORTIT="ORDER SUMMARY",ORPRES=1,ORSHORT=$$SHORT
"RTN","ORPRS02",12,0)
 S ORDG=1,ORGRP("NAM")="ALL",ORGRP("ROOT")=1
"RTN","ORPRS02",13,0)
 D WRT
"RTN","ORPRS02",14,0)
 Q
"RTN","ORPRS02",15,0)
CUSTOM ; Customized Order Summary
"RTN","ORPRS02",16,0)
 N I,ORATTEND,ORTIT,ORSHORT,ORGRP,ORSEL,ORSEQ
"RTN","ORPRS02",17,0)
 S OREND=0,ORSHORT=$$SHORT
"RTN","ORPRS02",18,0)
 S ORGRP("NAM")=^ORD(100.98,ORDG,0),ORGRP("ROOT")=ORBUF,ORGRP("NAM")=$S($L($P(ORGRP("NAM"),"^",3)):$P(ORGRP("NAM"),"^",3),1:$E($P(ORGRP("NAM"),"^"),1,5))
"RTN","ORPRS02",19,0)
 S ORTIT=$P(ORPRES,";",2)_" for "_ORGRP("NAM")_" SERVICES"
"RTN","ORPRS02",20,0)
 D WRT
"RTN","ORPRS02",21,0)
 Q
"RTN","ORPRS02",22,0)
CHART ; Set up call to print chart copy for patient
"RTN","ORPRS02",23,0)
 N OREND,OREARLY,ORLATE,DFN
"RTN","ORPRS02",24,0)
 S OREARLY=+$G(ORSSTRT),ORLATE=+$G(ORSSTOP)
"RTN","ORPRS02",25,0)
 S DFN=+ORVP D PATIENT^ORPRS06(DFN,OREARLY,ORLATE,IO,21,+$G(ORL))
"RTN","ORPRS02",26,0)
 Q
"RTN","ORPRS02",27,0)
WORK ;Set up call for Work Copy patient summary
"RTN","ORPRS02",28,0)
 N OREND,OREARLY,ORLATE,DFN
"RTN","ORPRS02",29,0)
 S OREARLY=+$G(ORSSTRT),ORLATE=+$G(ORSSTOP)
"RTN","ORPRS02",30,0)
 S DFN=+ORVP D WORK^ORPRS06(DFN,OREARLY,ORLATE,IO)
"RTN","ORPRS02",31,0)
 Q
"RTN","ORPRS02",32,0)
CONT ; Print Report
"RTN","ORPRS02",33,0)
 N ZTRTN,ZTDESC
"RTN","ORPRS02",34,0)
 S ZTRTN="WRT^ORPRS02",ZTDESC=ORTIT
"RTN","ORPRS02",35,0)
 D @ZTRTN
"RTN","ORPRS02",36,0)
 Q
"RTN","ORPRS02",37,0)
WRT ;Entry point for Batch Processing 
"RTN","ORPRS02",38,0)
 ;Setup display group list, patient list, and process reports  
"RTN","ORPRS02",39,0)
 N %,%H,%I,DFN,DX,DY,I,II,J,K,ODATE,ORAGE,ORDAD,ORDOB,ORFLAG,ORI,ORIFN
"RTN","ORPRS02",40,0)
 N ORL,ORLIST,ORLST,ORMD,ORNP,ORODT,ORPD,ORPNM,ORPV,ORREQ,ORSEX
"RTN","ORPRS02",41,0)
 N ORSSN,ORSTOP,ORSTRT,ORSTS,ORASTS,ORTERM,ORTM,ORTS,ORTX,ORUSER,ORWARD
"RTN","ORPRS02",42,0)
 N ORSLTR,ORAW,VA,VAROOT,X,X0,X1,X3,Y,Z
"RTN","ORPRS02",43,0)
 S ORAW=$S(+$$GET^XPAR("SYS","OR ORDER SUMMARY CONTEXT",1,"I"):"AW",1:"")
"RTN","ORPRS02",44,0)
 U IO
"RTN","ORPRS02",45,0)
 D EN^ORQ1(ORVP,ORDG,+ORPRES,0,+ORSSTRT,+ORSSTOP,0,1,ORAW,1)
"RTN","ORPRS02",46,0)
 N ORPI,ORPA,ORPN,X,ORPIFN
"RTN","ORPRS02",47,0)
 S ORPI=0 F  S ORPI=$O(^TMP("ORR",$J,ORLIST,ORPI)) Q:'ORPI  D
"RTN","ORPRS02",48,0)
 . S ORPIFN=+^TMP("ORR",$J,ORLIST,ORPI),ORPA=$P(^(ORPI),";",2)
"RTN","ORPRS02",49,0)
 . I $D(^OR(100,ORPIFN,8,ORPA,0)) S X=^(0),ORPN=$P(X,"^",12)
"RTN","ORPRS02",50,0)
 . I $G(ORPN),$D(^ORD(100.02,ORPN,1)),'$P(^(1),"^",3) K ^TMP("ORR",$J,ORLIST,ORPI)
"RTN","ORPRS02",51,0)
 I $$GET^XPAR("ALL","ORPF SUMMARY SORT FORWARD",1,"I") D SORT
"RTN","ORPRS02",52,0)
 D @$S(ORSHORT:"EN^ORPRS04",1:"EN^ORPRS03")
"RTN","ORPRS02",53,0)
 K ^TMP("ORR",$J,ORLIST)
"RTN","ORPRS02",54,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ORPRS02",55,0)
 Q
"RTN","ORPRS02",56,0)
SHORT() ; Check whether user prefers condensed or expanded printout
"RTN","ORPRS02",57,0)
 Q +$$GET^XPAR("ALL","ORPF CONDENSED ORDER SUMMARY",1,"I")
"RTN","ORPRS02",58,0)
 ;
"RTN","ORPRS02",59,0)
SORT ;Re sort ^TMP("ORR",$J in inverse order
"RTN","ORPRS02",60,0)
 Q:'$D(^TMP("ORR",$J,ORLIST))
"RTN","ORPRS02",61,0)
 K ^TMP("ORRF",$J)
"RTN","ORPRS02",62,0)
 N I,C
"RTN","ORPRS02",63,0)
 S C=0,I=9999999
"RTN","ORPRS02",64,0)
 F  S I=$O(^TMP("ORR",$J,ORLIST,I),-1) Q:I<1  S C=C+1,^TMP("ORRF",$J,C)=^(I)
"RTN","ORPRS02",65,0)
 K ^TMP("ORR",$J,ORLIST)
"RTN","ORPRS02",66,0)
 M ^TMP("ORR",$J,ORLIST)=^TMP("ORRF",$J)
"RTN","ORPRS02",67,0)
 K ^TMP("ORRF",$J)
"RTN","ORPRS02",68,0)
 Q
"RTN","ORWORR")
0^2^B61679744
"RTN","ORWORR",1,0)
ORWORR ; SLC/KCM/JLI - Retrieve Orders for Broker ;2/5/03 3PM
"RTN","ORWORR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,92,116,110,132,141,163,189**;Dec 17, 1997
"RTN","ORWORR",3,0)
 ;
"RTN","ORWORR",4,0)
GET(LST,DFN,FILTER,GROUPS) ; procedure
"RTN","ORWORR",5,0)
 Q  ; don't call until using same treating specialty logic as AGET
"RTN","ORWORR",6,0)
 ;    also until MULT, ORWARD, & ORIGVIEW implemented
"RTN","ORWORR",7,0)
 ;    also until the date ranges are implemented
"RTN","ORWORR",8,0)
 ; Get orders for a patient
"RTN","ORWORR",9,0)
 ;        1   2    3     4      5     6   7   8   9   10     11    12    13    14     15     16 17    18
"RTN","ORWORR",10,0)
 ; .LST=~IFN^Grp^ActTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^ActDA^Flag^DCType^ChrtRev^DEA#^^Schedule
"RTN","ORWORR",11,0)
 ; .LST=tOrder Text (repeating as necessary)
"RTN","ORWORR",12,0)
 ;     DFN=Patient ID
"RTN","ORWORR",13,0)
 ;  FILTER=number indicates which orders to return, default=2 (current)
"RTN","ORWORR",14,0)
 ;  GROUPS=display group of orders to show (default=ALL)
"RTN","ORWORR",15,0)
 ; -- this section uses ORQ1 to get the orders list rather than XGET --
"RTN","ORWORR",16,0)
 N ORLIST,ORIFN,X0,X3,X8,IDX,IFN,ACT,PRV,LN,TXT,STRT,STOP,CSTS,EYE,DEA ;PKI
"RTN","ORWORR",17,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",18,0)
 S (IDX,LST)=0 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",19,0)
 D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"","","",0,1)
"RTN","ORWORR",20,0)
 S EYE=0 F  S EYE=$O(^TMP("ORR",$J,ORLIST,EYE)) Q:'EYE  S IFN=^(EYE) D
"RTN","ORWORR",21,0)
 . S ACT=$P(IFN,";",2),IFN=+IFN,X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",22,0)
 . D GETFLDS
"RTN","ORWORR",23,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",24,0)
 G EXIT
"RTN","ORWORR",25,0)
AGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT) ;Get an abbreviated event delayed order list for a patient 
"RTN","ORWORR",26,0)
 ; returns ^TMP("ORR",$J,ORLIST,n)=IFN^DGrp^ActTm
"RTN","ORWORR",27,0)
 ; see above for input parameters
"RTN","ORWORR",28,0)
 ; -- from ORWORR
"RTN","ORWORR",29,0)
 ; -- this section uses ORQ1 to get the orders list rather than XGET --
"RTN","ORWORR",30,0)
 N ORLIST,ORIFN,IFN,I,ORWTS,TOT,MULT,ORWARD,TXTVW,ORYD,PTEVTID,EVTNAME
"RTN","ORWORR",31,0)
 S (PTEVTID,EVTNAME)=""
"RTN","ORWORR",32,0)
 K ^TMP("ORR",$J),^TMP("ORRJD",$J)
"RTN","ORWORR",33,0)
 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",34,0)
 S ORWTS=+$P(FILTER,U,2),FILTER=+FILTER
"RTN","ORWORR",35,0)
 S MULT=$S("^1^6^8^9^10^11^13^14^20^22^"[(U_FILTER_U):1,1:0)
"RTN","ORWORR",36,0)
 I $L($G(^DPT(DFN,.1))) S ORWARD=1 ; should normally be ptr to 42
"RTN","ORWORR",37,0)
 S:'$L($G(DTFROM)) DTFROM=0
"RTN","ORWORR",38,0)
 S:'$L($G(DTTHRU)) DTTHRU=0
"RTN","ORWORR",39,0)
 S:'$L($G(EVENT)) EVENT=0
"RTN","ORWORR",40,0)
 I $G(EVTDCREL)="TRUE" D
"RTN","ORWORR",41,0)
 . D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,2,MULT,"",1,EVENT)
"RTN","ORWORR",42,0)
 . D GET2^ORWORR1
"RTN","ORWORR",43,0)
 E  D
"RTN","ORWORR",44,0)
 . D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,0,MULT,"",1,EVENT)
"RTN","ORWORR",45,0)
 . D GET1^ORWORR1
"RTN","ORWORR",46,0)
 Q
"RTN","ORWORR",47,0)
RGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT) ;Orders of AutoDC/Release Event
"RTN","ORWORR",48,0)
 N EVTDCREL
"RTN","ORWORR",49,0)
 S EVTDCREL="TRUE"
"RTN","ORWORR",50,0)
 D AGET(.REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT)
"RTN","ORWORR",51,0)
 Q
"RTN","ORWORR",52,0)
XGET ; -- this was the retrieval algorithm before all the AC xref changes
"RTN","ORWORR",53,0)
 N X,X0,X3,IDX,IFN,LN,TIME,DGRP,MASK,TXT,ACT,PRV,ID,DEA,PASS ;PKI
"RTN","ORWORR",54,0)
 S DFN=DFN_";DPT(",IDX=0,LST=0
"RTN","ORWORR",55,0)
 I '$G(FILTER) S FILTER=2                    ; Default: Current/Active
"RTN","ORWORR",56,0)
 I $D(GROUPS)=1 D
"RTN","ORWORR",57,0)
 . S:'GROUPS GROUPS=$O(^ORD(100.98,"B",GROUPS,0))
"RTN","ORWORR",58,0)
 . D XPND(GROUPS)
"RTN","ORWORR",59,0)
 I FILTER=1  D DOALL G EXIT                  ; All
"RTN","ORWORR",60,0)
 I FILTER=2  D DOCUR G EXIT                  ; Current
"RTN","ORWORR",61,0)
 I FILTER=3  S PASS=";1;"                    ; Discontinued
"RTN","ORWORR",62,0)
 I FILTER=4  S PASS=";2;7;"                  ; Comp/Expired
"RTN","ORWORR",63,0)
 I FILTER=5  S PASS=";3;4;5;6;8;9;"          ; Expiring
"RTN","ORWORR",64,0)
 I FILTER=6  S PASS=";1;2;3;4;5;6;7;8;9;11;" ; New Activity
"RTN","ORWORR",65,0)
 I FILTER=7  S PASS=";5;"                    ; Pending
"RTN","ORWORR",66,0)
 I FILTER=8  Q                               ; Expanded
"RTN","ORWORR",67,0)
 I FILTER=9  S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Nurse
"RTN","ORWORR",68,0)
 I FILTER=10 S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Clerk
"RTN","ORWORR",69,0)
 I FILTER=11 S PASS=";3;4;5;6;7;8;11;"       ; Unsigned
"RTN","ORWORR",70,0)
 I FILTER=12 S PASS=";4;"                    ; Flagged
"RTN","ORWORR",71,0)
 I FILTER=13 S PASS=""                       ; Verbal/Phone
"RTN","ORWORR",72,0)
 I FILTER=14 S PASS=""                       ; Verbal/Phone Unsigned
"RTN","ORWORR",73,0)
 D DOGET
"RTN","ORWORR",74,0)
EXIT I LST=0 D
"RTN","ORWORR",75,0)
 . N %,X,%I D NOW^%DTC
"RTN","ORWORR",76,0)
 . S LST(1)="~0^0^"_%_"^^^97",LST(2)="tNo Orders Found."
"RTN","ORWORR",77,0)
 Q
"RTN","ORWORR",78,0)
DOGET ; Come here if need to filter the orders 
"RTN","ORWORR",79,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",80,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",81,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",82,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",83,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",84,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",85,0)
 . . . I $L(PASS),(PASS'[(";"_$P(X3,U,3)_";")) Q  ;filter by status
"RTN","ORWORR",86,0)
 . . . ; do any other filtering
"RTN","ORWORR",87,0)
 . . . D GETFLDS
"RTN","ORWORR",88,0)
 Q
"RTN","ORWORR",89,0)
DOALL ; Come here if retrieve all orders (no filter by status)
"RTN","ORWORR",90,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",91,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",92,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",93,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",94,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",95,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",96,0)
 . . . D GETFLDS
"RTN","ORWORR",97,0)
 Q
"RTN","ORWORR",98,0)
DOCUR ; Come here to retrieve all current orders
"RTN","ORWORR",99,0)
 N AOCTXT,STS,STOP,%
"RTN","ORWORR",100,0)
 S X=-$$GET^XPAR("ALL","ORPF ACTIVE ORDERS CONTEXT HRS")
"RTN","ORWORR",101,0)
 S %H=$H,X=(%H*86400+$P(%H,",",2))+(X*3600),%H=(X\86400)_","_(X#86400)
"RTN","ORWORR",102,0)
 D YMD^%DTC S AOCTXT=X_%
"RTN","ORWORR",103,0)
 S MASK="110000100101110"   ; mask out STS=1,2,7,10,12,13,14
"RTN","ORWORR",104,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AC",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",105,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AC",DFN,TIME,IFN)) Q:'IFN  D
"RTN","ORWORR",106,0)
 . . ; filter out display groups here
"RTN","ORWORR",107,0)
 . . S ACT=0 F  S ACT=$O(^OR(100,"AC",DFN,TIME,IFN,ACT)) Q:'ACT  D
"RTN","ORWORR",108,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",109,0)
 . . . S STS=$P(X3,U,3),STOP=$P(X0,U,9)
"RTN","ORWORR",110,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!(STS=99) Q
"RTN","ORWORR",111,0)
 . . . I $P(X8,U,15)=13,($P(X8,U)<AOCTXT) D ACKILL Q
"RTN","ORWORR",112,0)
 . . . I $P(X8,U,15)=13!($P(X8,U,15)=""),("RN^XX"[$P(X8,U,2)) D ACKILL Q
"RTN","ORWORR",113,0)
 . . . I $E(MASK,STS),STOP<AOCTXT D ACKILL Q
"RTN","ORWORR",114,0)
 . . . D GETFLDS
"RTN","ORWORR",115,0)
 Q
"RTN","ORWORR",116,0)
ACKILL ; called only from DOCUR - kill AC xref
"RTN","ORWORR",117,0)
 ; K ^OR(100,"AC",DFN,TIME,IFN,ACT)  ; let ORQ1 kill if for now
"RTN","ORWORR",118,0)
 Q
"RTN","ORWORR",119,0)
GET4V11(LST,TXTVW,ORYD,IFNLST) ; get the order fields TEMPORARY
"RTN","ORWORR",120,0)
 G GET41
"RTN","ORWORR",121,0)
GET4LST(LST,IFNLST)     ; get the order fields for a list of orders
"RTN","ORWORR",122,0)
GET41 N ACT,ACTID,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,IFN,IFNIDX,ORIGVIEW,DEA ;PKI
"RTN","ORWORR",123,0)
 S (IDX,LST,IFNIDX)=0
"RTN","ORWORR",124,0)
 F  S IFNIDX=$O(IFNLST(IFNIDX)) Q:'IFNIDX  S IFN=IFNLST(IFNIDX) D
"RTN","ORWORR",125,0)
 . S ACT=$S($P(IFN,";",2):$P(IFN,";",2),1:1),IFN=+IFN
"RTN","ORWORR",126,0)
 . S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)),X8=$G(^(8,ACT,0))
"RTN","ORWORR",127,0)
 . D GETFLDS
"RTN","ORWORR",128,0)
 Q
"RTN","ORWORR",129,0)
GETBYIFN(LST,IFN) ; procedure
"RTN","ORWORR",130,0)
 ; get the fields for a single order
"RTN","ORWORR",131,0)
 ; .LST(n)=as described above in GET
"RTN","ORWORR",132,0)
 ;     IFN=internal entry number for order
"RTN","ORWORR",133,0)
 I 'IFN Q
"RTN","ORWORR",134,0)
 N ACT,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,ACTID,ORIGVIEW,ORYD,TXTVW,DEA ;PKI
"RTN","ORWORR",135,0)
 S IDX=0,LST=0,ORYD=0
"RTN","ORWORR",136,0)
 S X0=$G(^OR(100,+IFN,0)),X3=$G(^(3))
"RTN","ORWORR",137,0)
 S ACT=$S($P(IFN,";",2):$P(IFN,";",2),$P(X3,U,7):$P(X3,U,7),1:1)
"RTN","ORWORR",138,0)
 S IFN=+IFN,X8=$G(^OR(100,IFN,8,ACT,0))
"RTN","ORWORR",139,0)
GETFLDS ; used by entry points to place order fields into list
"RTN","ORWORR",140,0)
 ; expects IDX=sequence #, IFN=order, X0=node 0, X3=node 3, LST=results
"RTN","ORWORR",141,0)
 ; LST(IDX)=~IFN^Grp^OrdTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^Act^Flagged[^DCType]^ChartRev^DEA#^^DigSig
"RTN","ORWORR",142,0)
 S PRV=$P(X8,U,5) S:'PRV PRV=$P(X8,U,3) S PRV=PRV_U
"RTN","ORWORR",143,0)
 I PRV S PRV=PRV_$P(^VA(200,+PRV,0),U)
"RTN","ORWORR",144,0)
 S DEA=$$DEA^XUSER(,+PRV) ; get user DEA info - PKI
"RTN","ORWORR",145,0)
 S IDX=IDX+1,LST=LST+1,ID=IFN_";"_ACT,ACTID=$P(X8,U,2)
"RTN","ORWORR",146,0)
 S CSTS=$S($P(X8,U,15):$P(X8,U,15),1:$P(X3,U,3))
"RTN","ORWORR",147,0)
 I $P(X8,U,15)=10,$P(X3,U,3)=14 S CSTS=14 ;delayed-lapsed order
"RTN","ORWORR",148,0)
 S STRT=$S($P(X3,U,3)=11:$$RSTRT,ACTID="NW"!(ACTID="XX")!(ACTID="RL"):$P(X0,U,8),ACTID="DC":"",1:$P(X8,U)) ;110
"RTN","ORWORR",149,0)
 S STOP=$S($P(X3,U,3)=11:$$RSTOP,ACTID="HD":$P($G(^OR(100,+IFN,8,ACT,2)),U),1:$P(X0,U,9))
"RTN","ORWORR",150,0)
 S LST(IDX)="~"_ID_U_$P(X0,U,11)_U_$P(X8,U)_U_STRT_U_STOP_U_CSTS_U_$P(X8,U,4)_U_$P(X8,U,8)_U_$P(X8,U,10)_U_PRV
"RTN","ORWORR",151,0)
 S $P(LST(IDX),U,13)=+$G(^OR(100,IFN,8,ACT,3))    ; flagged
"RTN","ORWORR",152,0)
 I +$P(X8,U,8) S $P(LST(IDX),U,8)=$$INITIALS^ORCHTAB2(+$P(X8,U,8))    ;nurse
"RTN","ORWORR",153,0)
 I +$P(X8,U,10) S $P(LST(IDX),U,9)=$$INITIALS^ORCHTAB2(+$P(X8,U,10))  ;clerk
"RTN","ORWORR",154,0)
 I +$P(X8,U,18) S $P(LST(IDX),U,15)=$$INITIALS^ORCHTAB2(+$P(X8,U,18)) ;chart review
"RTN","ORWORR",155,0)
 I $L($G(DEA)) S $P(LST(IDX),U,16)=DEA ;PKI
"RTN","ORWORR",156,0)
 I $P($G(^OR(100,IFN,8,ACT,2)),"^",5) S $P(LST(IDX),U,18)=$P(^(2),"^",4)
"RTN","ORWORR",157,0)
 I '$P($G(^OR(100,IFN,8,ACT,2)),"^",5),$P(X0,"^",5) D  ;Copy orders PKI fix
"RTN","ORWORR",158,0)
 . N OI,ORVP,ORCAT,PKG
"RTN","ORWORR",159,0)
 . S OI=+$O(^OR(100,IFN,4.5,"ID","ORDERABLE",0)),OI=+$G(^OR(100,IFN,4.5,OI,1)) Q:'OI
"RTN","ORWORR",160,0)
 . S ORVP=$P(X0,"^",2),PKG=$P(X0,"^",14)
"RTN","ORWORR",161,0)
 . S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWORR",162,0)
 . I PKG'=$O(^DIC(9.4,"B","OUTPATIENT PHARMACY",0)) Q
"RTN","ORWORR",163,0)
 . D PKI^ORWDPS1(.ORY,OI,ORCAT,+ORVP,$$GET^XPAR("ALL^USR.`"_DUZ,"ORWOR PKI USE",1,"Q"))
"RTN","ORWORR",164,0)
 . I $E($G(ORY))=2 S $P(LST(IDX),U,18)=ORY
"RTN","ORWORR",165,0)
 S ORIGVIEW=$S($G(TXTVW)=0:0,$G(TXTVW)=1:1,ORYD=-1:1,'ORYD:1,$P(X8,U)'<ORYD:0,1:1)
"RTN","ORWORR",166,0)
 K TXT D TEXT^ORQ12(.TXT,ID,255)                  ; optimize this later
"RTN","ORWORR",167,0)
 I $O(^OR(100,+IFN,2,0)) S LN=$O(TXT(0)),TXT(LN)="+"_TXT(LN)
"RTN","ORWORR",168,0)
 I $O(^OR(100,+IFN,8,"C","XX",0)) S LN=$O(TXT(0)),TXT(LN)="*"_TXT(LN)
"RTN","ORWORR",169,0)
 S LN=0 F  S LN=$O(TXT(LN)) Q:'LN  S IDX=IDX+1,LST(IDX)="t"_TXT(LN)
"RTN","ORWORR",170,0)
 I $O(^OR(100,+IFN,8,1,.2,0)) S IDX=IDX+1,LST(IDX)="|" D  ;PKI XMLText
"RTN","ORWORR",171,0)
 . S I=0 F  S I=$O(^OR(100,+IFN,8,1,.2,I)) Q:'I  S IDX=IDX+1,LST(IDX)="x"_^(I,0)
"RTN","ORWORR",172,0)
 Q
"RTN","ORWORR",173,0)
RSTRT() ; return start date from responses
"RTN","ORWORR",174,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","START",0)),1))
"RTN","ORWORR",175,0)
RSTOP() ; return stop date from responses
"RTN","ORWORR",176,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","STOP",0)),1))
"RTN","ORWORR",177,0)
GETTXT(LST,IFN)     ; get the text of an order
"RTN","ORWORR",178,0)
 I $L(IFN,";")=1 S IFN=IFN_";1"
"RTN","ORWORR",179,0)
 D TEXT^ORQ12(.LST,IFN,255)
"RTN","ORWORR",180,0)
 Q
"RTN","ORWORR",181,0)
XPND(AGRP) ; procedure
"RTN","ORWORR",182,0)
 ; Expand a display group (GROUPS must be defined outside of call)
"RTN","ORWORR",183,0)
 N I,CHLD
"RTN","ORWORR",184,0)
 S GROUPS(AGRP)=^ORD(100.98,AGRP,0),I=0
"RTN","ORWORR",185,0)
 F  S I=$O(^ORD(100.98,AGRP,1,I)) Q:'I  S CHLD=$P(^(I,0),U) D XPND(CHLD)
"RTN","ORWORR",186,0)
 Q
"RTN","ORWORR",187,0)
GETPKG(Y,IFN) ; get package for an order
"RTN","ORWORR",188,0)
 N ORDERID,PKGID
"RTN","ORWORR",189,0)
 Q:+IFN<1
"RTN","ORWORR",190,0)
 S ORDERID=+IFN,Y=""
"RTN","ORWORR",191,0)
 S PKGID=$P(OR(100,ORDERID,0),U,14)
"RTN","ORWORR",192,0)
 S:PKGID>0 Y=$P(^DIC(9.4,PKGID,0),U,2)
"RTN","ORWORR",193,0)
 Q
"VER")
8.0^22.0
**END**
**END**
