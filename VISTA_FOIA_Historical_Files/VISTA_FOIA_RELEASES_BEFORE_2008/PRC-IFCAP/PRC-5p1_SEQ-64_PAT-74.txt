$TXT Created by NIXON,TONY at MNTVBB.FO-WASH.MED.VA.GOV  (KIDS) on Tuesday, 04/06/04 at 16:33
=============================================================================
Run Date: MAY 26, 2004                     Designation: PRC*5.1*74
Package : PRC - IFCAP                         Priority: Mandatory
Version : 5.1        SEQ #64                    Status: Released
                  Compliance Date: JUN 26, 2004
=============================================================================

Associated patches: (v)PRC*5.1*59  <<= must be installed BEFORE `PRC*5.1*74'
                    (v)PRC*5.1*76  <<= must be installed BEFORE `PRC*5.1*74'

Subject: D CROSS-REF NOT RESETTING AFTER AMENDING P.O.

Category: 
  - Routine

Description:
============

 This patch will ensure that the "D" cross-reference for the PROCUREMENT
 & ACCOUNTING TRANSACTIONS file (#442) gets updated when amending a P.O.
 with multiple edits.  It also removes a temporary global placed at the
 sites by another patch.
  
 This patch addresses the following New Service Request (NSR):
 -------------------------------------------------------------
 There is no NSR associated with this patch.
  
  
 This patch addresses the following NOIS message(s):
 ---------------------------------------------------
 1. FGH-1202-32075: D CROSS-REF NOT RESETTING AFTER AMENDING P.O.
 2. UNY-0304-12760     NIXON GLOBAL, PRC*5.1*76 
  
  
 Overview of NOIS Message(s):
 ----------------------------
 1. FGH-1202-32075: D CROSS-REF NOT RESETTING AFTER AMENDING P.O.
  
 Problem:
 --------
 When a user performs multiple edits to amend a purchase order, and one of
 those edits is "Change Vendor", the "D" cross reference for the
 PROCUREMENT & ACCOUNTING TRANSACTIONS file (#442) fails to update. As a
 result, the purchase order fails to list under the new vendor.
  
    i.e.  The user does a PURCHASE ORDER DISPLAY [PRCH DISPLAY PO], and
          enters the new vendor at the "P.O./REQ.NO.:" prompt.  The P.O.
          does not list.
  
    If the amended P.O. has only one edit and that edit is "Change Vendor",
    there is no problem. 
  
 Resolution:
 -----------
 Modify routine PRCHAMYA. The "D" cross reference for the PROCUREMENT & 
 ACCOUNTING TRANSACTIONS file (#442) gets updated when the user amends a
 P.O. with multiple edits.
    
    TYPE OF EDITS
    -------------                       
    1. F.C.P. Edit
    2. Change VENDOR
    3. AUTHORITY Edit
    4. LINE ITEM Add
    5. LINE ITEM Delete
    6. LINE ITEM Edit
    7. F.O.B. Point/BOC
  
    SINGLE EDIT AMENDMENT   => The amendment has only one type of edit.
                               i.e. "Change Vendor" OR "LINE ITEM Edit"
                                
    MULTIPLE EDIT AMENDMENT => The amendment has more than one type of edit.
                               i.e. "Change Vendor" AND "LINE ITEM Edit"
  
  
 2. UNY-0304-12760     NIXON GLOBAL, PRC*5.1*76
  
 Problem:
 --------
 A temporary global (^NIXON) was introduced to the sites by PRC*5.1*76.
  
 Resolution:
 -----------
 Modify routine PRCB1A3 so it can no longer create ^NIXON.
 Use post install routine PRC5174 to delete the global from the system. 
  
 The post-install routine will display following messages:
 --------------------------------------------------------
 >>> Checking for non-namespaced global ^NIXON
 >>> Global ^NIXON has been removed from your system
  
 >>> ALL DONE!
  
  
 Test Sites:
 -----------
 Central Texas VHCS
 Gainesville VAMC
 GLAHS - West LA Campus
 North Texas VHCS
 VAMROC Wilmington
  
  
  
   ================== INSTALLATION INSTRUCTIONS ==================
  
 If installed during the normal workday it is recommended that the
 following menu options (File #19) and all of their descendants be disabled
 to prevent possible conflicts while running the KIDS Install. Other VISTA
 users will not be affected.
  
         Combined A&MM Menus                     [PRCHUSER MASTER]  
         Control Point Official's Menu           [PRCSCP OFFICIAL]  
         Funds Distribution & Accounting Menu    [PRCF MASTER]      
         IFCAP Application Coordinator Menu      [PRCHUSER COORDINATOR]
         Purchase Card Menu                      [PRCH PURCHASE CARD MENU]
         Delivery Orders Menu                    [PRCH DELIVERY ORDER MENU] 
          
         Install Time - Less than 5 minutes 
  
    
   1.   LOAD TRANSPORT GLOBAL 
        ---------------------
        Choose the PackMan message containing this patch and invoke the 
        INSTALL/CHECK MESSAGE PackMan option.  
  
              
   2.   DISABLE ROUTINE MAPPING   (DSM for Open VMS sites only) 
        -----------------------
        Disable routine mapping on all systems for the routines listed in 
        step 3 below.  
  
        NOTE:  If the routines included in this patch are not currently in 
        your mapped routine set, please skip this step.
  
   
   3.   COMPONENTS SENT WITH PATCH 
        --------------------------
        The following is a list of the routines included in this patch.  
        The second line of each of these routines now looks like: 
  
            ;;5.1;IFCAP;**[patch list]**;Oct 20, 2000
        
   
                       CHECK^XTSUMBLD results
  
        Routine       Before Patch     After Patch     Patch List 
        -------       ------------     -----------     ----------
        PRC5174       New              Deleted **      74 
        PRCB1A3       5128577          5068495         76,74
        PRCHAMYA      14289740         14578870        6,21,59,74    
        PRCHDP8       7903491          8860858         74              
  
        Total number of routines = 4
        Total number of routines modified = 3
        Total number of new routines = 1
        Total number of deleted routines = 1
  
        ** PRC5174 will be automatically deleted.
  
   4.   START UP KIDS 
        -------------
        Start up the Kernel Installation and Distribution System Menu 
        [XPD MAIN]: 
    
             Edits and Distribution ...  
             Utilities ...  
             Installation ...  
    
   Select Kernel Installation & Distribution System Option: INStallation 
                                                            ---
             Load a Distribution 
             Print Transport Global 
             Compare Transport Global to Current System 
             Verify Checksums in Transport Global 
             Install Package(s) 
             Restart Install of Package(s) 
             Unload a Distribution 
             Backup a Transport Global 
    
   Select Installation Option: 
  
    
   5.   Select Installation Option: 
        ---------------------------
        NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
               NAME, enter PRC*5.1*74):
      
        a.  Backup a Transport Global - This option will create a backup
            message of any routines exported with this patch. It will not
            backup any other changes such as DD's or templates.
        b.  Compare Transport Global to Current System - This option will
            allow you to view all changes that will be made when this patch
            is installed.  It compares all components of this patch
            (routines, DD's, templates, etc.).
        c.  Verify Checksums in Transport Global - This option will allow
            you to ensure the integrity of the routines that are in the
            transport global.
      
   6.   Select Installation Option: Install Package(s) 
                                    ------------------
        **This is the step to start the installation of this KIDS patch: 
    
        a.  Choose the Install Package(s) option to start the patch install.
        b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install?
            YES//' answer NO (unless otherwise indicated).
        c.  When prompted 'Want to DISABLE Scheduled Options, Menu 
            Options, and Protocols? YES//' answer YES.
        d.  When prompted 'Enter options you wish to mark as 'Out Of
            Order':'  Enter the following options:
  
         Combined A&MM Menus                     [PRCHUSER MASTER]  
         Control Point Official's Menu           [PRCSCP OFFICIAL]  
         Funds Distribution & Accounting Menu    [PRCF MASTER]      
         IFCAP Application Coordinator Menu      [PRCHUSER COORDINATOR]
         Purchase Card Menu                      [PRCH PURCHASE CARD MENU]
         Delivery Orders Menu                    [PRCH DELIVERY ORDER MENU] 
  
        e.  When prompted 'Enter protocols you wish to mark as 'Out Of
            Order':' press <return>.
  
    7.  REBUILD MAPPED ROUTINE(S)   (DSM for Open VMS sites only)
        -------------------------
        Optional - Include the routines distributed with this patch in the
        mapped routine set.
  
        NOTE: This step is only necessary if you performed step 2 or if you
        wish to include the routines in your mapped set.

Routine Information:
====================

Routine Name:
  - PRCHAMYA

 ;There has been a change in vendor.  Update the files.
 ;See NOIS FGH-1202-32075
  N NEWVEN,OLDVEN,NODE,AMEND
  S NEWVEN=$G(FIELD(443.6,PRCHPO,5,"I"))
  I NEWVEN D  ;
  . S AMEND=$P(^PRC(443.6,PRCHPO,6,0),U,3)
  . S NODE=$O(^PRC(443.6,PRCHPO,6,AMEND,3,"AC",31,5,""))
  . S OLDVEN=^PRC(443.6,PRCHPO,6,AMEND,3,NODE,1,1,0)
  . I OLDVEN KILL ^PRC(442,"D",OLDVEN,PRCHPO)
  . S DA=PRCHPO,DR="5////"_NEWVEN,DIE="^PRC(442,"
  . D ^DIE
  ;

Routine Checksum:

Routine Name:
  - PRCHDP8

 E31     ;Change VENDOR PRINT
         N CHANGE,OLD,VEN,LCNT,DATA,CNT,CNT1,CNT2,AA
         S CHANGE=0,CNT=0,CNT2=0 D LCNT^PRCHDP9(.LCNT)
         ;
         ;Check for multiple vendor changes
         F  S CNT=$O(^PRC(442,PRCHPO,6,CNT)) Q:'CNT  D
         . S CNT1=0
         . F  S CNT1=$O(^PRC(442,PRCHPO,6,CNT,3,CNT1)) Q:'CNT1  D
         . . S TYPE=$G(^PRC(442,PRCHPO,6,CNT,3,CNT1,0))
         . . S TYPE=$P(TYPE,U,2) I TYPE'=31 Q
         . . S VEN=$G(^PRC(442,PRCHPO,6,CNT,3,CNT1,1,1,0))
         . . Q:VEN=""
         . . S CNT2=CNT2+1,AA(CNT)=VEN ;Count/track vendor changes
         ;
         F  S CHANGE=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AC",AMEND,5,CHANGE)) Q:CHANGE'>0  D
         .;Print vendor amendments.
         .I CNT2>1 D E31A Q
         .S OLD=^PRC(442,PRCHPO,6,PRCHAM,3,CHANGE,1,1,0),OLD=$P(^PRC(440,OLD,0),U
 )
         .S VEN=$P(^PRC(442,PRCHPO,1),U),VEN=$P(^PRC(440,VEN,0),U)
         .D LINE^PRCHDP9(.LCNT,2) S DATA="Vendor "_OLD_" has been changed to "_VEN
         .D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
         Q
         ;
 E31A    ;Print multiple vendor changes.
         S OLD=$P(^PRC(440,AA(PRCHAM),0),U)
         S VEN=$O(AA(PRCHAM))
         I VEN="" S VEN=$P(^PRC(442,PRCHPO,1),U)
         E  S VEN=AA(VEN)
         S VEN=$P(^PRC(440,VEN,0),U)
         ;
         D LINE^PRCHDP9(.LCNT,2)
         S DATA="Vendor "_OLD_" has been changed to "_VEN
         D DATA^PRCHDP9(.LCNT,DATA),LCNT1^PRCHDP9(LCNT)
         Q

Routine Checksum:

Routine Name:
  - PRCB1A3

 This routine is from patch PRC*5.1*76.  It inadvertently added
 a non-namespaced global.  The code setting up the non-namespaced
 global has been removed.

Routine Checksum:

Routine Name:
  - PRC5174

 This is a post install & environment check routine.
 
 PRC5174 ;WISC/TN-IFCAP Post init routine for PRC*5.1*74 ;03/26/04
         ;;5.1;IFCAP;**74**;Oct 20, 2000
         ;---------------------------------------------------------
         ;This post-install routine removes a non-namespaced global
         ;introduced by PRC*5.1*76
         ;
         ;There is also an environmental check for CoreFLS
         ;---------------------------------------------------------
         N X S X="PRCLOP4" X ^%ZOSF("TEST")
         I $T,$$SYS^PRCLOP4>0 D  S XPDQUIT=1 Q
         . N PRCT S PRCT(1)="IFCAP has been shut down, so no further IFCAP 
 patches"
        . S PRCT(2)="  should be installed." D MES^XPDUTL(.PRCT)
         ;
         QUIT  ;End environmental check
         ;
         ;---------------------------------------------------------
 START   ;Remove a non-namespaced global introduced by PRC*5.1*76
         ;---------------------------------------------------------
         NEW TEXT,CNT
         ;
         S CNT=0
         S TEXT=">>> Checking for non-namespaced global ^NIXON"
         DO MES^XPDUTL(TEXT)
         ;
         I '$D(^NIXON) D  QUIT
         . S TEXT=">>> Global ^NIXON does not exist on your system"
         . DO MES^XPDUTL(TEXT)
         . DO BMES^XPDUTL(">>> ALL DONE!")
         ;
         F  S CNT=$O(^NIXON(CNT)) Q:'CNT  KILL ^NIXON(CNT)
         ;
         S TEXT=">>> Global ^NIXON has been removed from your system"
         DO MES^XPDUTL(TEXT)
         DO BMES^XPDUTL(">>> ALL DONE!")
         ;
         QUIT

Routine Checksum:

=============================================================================
User Information:
Entered By  : NIXON,ANTOINE                 Date Entered  : NOV 14, 2003
Completed By: ROBBINS,BRADLEY               Date Completed: MAY 25, 2004
Released By : NELSON,VICKI M                Date Released : MAY 26, 2004
=============================================================================


Packman Mail Message:
=====================

$END TXT
