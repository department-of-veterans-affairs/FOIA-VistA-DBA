$TXT Created by MULLER,RICHARD at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Monday, 06/16/03 at 10:03
=============================================================================
Run Date: JUL 24, 2003                     Designation: IVM*2*81
Package : IVM - INCOME VERIFICATION MATCH    Priority: Mandatory
Version : 2        SEQ #68                      Status: Released
                  Compliance Date: AUG 24, 2003
=============================================================================

Associated patches: (v)IVM*2*58    <<= must be installed BEFORE `IVM*2*81'
                    (v)IVM*2*66    <<= must be installed BEFORE `IVM*2*81'
                    (v)DG*5.3*519  <<= must be installed BEFORE `IVM*2*81'

Subject: FIX QUERY RESPONSE FOR FUTURE MT

Category: 
  - Routine

Description: 
============

  
 Issue #1: Corrupted Income Tests at the HEC
  
 Problem:    
 ========
  
 Future Dated Income Tests are not correctly being identified, and the 
 resulting IVM FULL DATA (Z07) Transmission to the HEC is not containing 
 the test data.  This is causing the Income Tests to be deleted from the 
 IVM CLIENT INCOME (#300.13) File at the HEC.
  
 Resolution: 
 ===========
  
 The code in the Z07 Builder will be modified to correctly identify future 
 dated Income Tests when no current dated Income Test is found for the 
 Income Year in the transmission.
  
  
 Issue #2: Update IVM BACKGROUND JOB Re-Send Functionality
  
 Problem:    
 ========
 On October 22, 2002, patch IVM*2.0*66 (Extend Z07 resend date 3 to 14) 
 was released.  Due to problems at the HEC in processing ORU~Z07s, the 
 acknowledgment to these messages was frequently not returned within three 
 days.  This caused the site's software to re-transmit the ORU-Z07, 
 causing duplicate transmissions and increased the backlog of messages at 
 the HEC.
  
 The resend date was extended from 3 days to 14 days, to the HEC to 
 process ORU~Z07 transmissions without extensive duplication.  This is no 
 longer an issue, and the resend process needs to revert back to the 
 original three-day waiting period.
  
 Resolution: 
 ===========
 The process that checks for records that require re-transmission to the 
 HEC, will be modified to contain a three day waiting period before 
 resending ORU~Z07 transmissions.
  
 Note:
 =====
 Patch DG*5.3*519 (FIX QUERY RESPONSE FOR FUTURE MT) is a pre requisite 
 for this patch IVM*2.0*81.  It contains a minor modification to the 
 Future Dated Income Test look-up API.
  
  
 This patch addresses the following E3R(s):
 ------------------------------------------
 There are no E3Rs associated with this patch.
  
  
  
 This patch addresses the following NOIS message(s):
 ---------------------------------------------------
 IVM-0503-30088: Means Tests Corrupted in File at HEC
  
  
 Overview of NOIS Message(s):
 ---------------------------
  
 NOIS: IVM-0503-30088 - Means Tests Corrupted in File at HEC
  
 Problem:  Means Tests are being corrupted in the INCOME YEAR sub-file 
 (#300.1313) record in the IVM CLIENT INCOME File (#300.13).
  
 Resolution:  The IVM BACKGROUND JOB (Z07 Builder) will be modified to 
 correctly identify and transmit the future dated Income Tests.
  
  
 Test Sites:
 -----------
 Madison
 Milwaukee
  
        ================INSTALLATION INSTRUCTIONS =================
  
 If installed during the normal workday, it is recommended that the 
 following menu options (File #19) and all of their descendants be 
 disabled to prevent possible conflicts while running the KIDS Install. 
 Other VISTA users will not be affected.
  
          [IVM BACKGROUND JOB]       IVM BACKGROUND JOB
  
 You may wish to stop the HL7 filers prior to the install to prevent 
 possible 'No Source Errors' from occurring. No transmissions will be lost 
 if the filers are not stopped first, they will be picked up once the 
 filers are restarted.
  
 The patch should be installed during non-peak hours.
  
  
 Install Time - 15 minutes
  
  
   1.   LOAD TRANSPORT GLOBAL 
        ---------------------
        Choose the PackMan message containing this patch and invoke the 
        INSTALL/CHECK MESSAGE PackMan option.  
              
   2.   DISABLE ROUTINE MAPPING   (DSM for Open VMS sites only) 
        -----------------------
        Disable routine mapping on all systems for the routines listed in 
        step 3 below.  
       
 NOTE:  If the routines included in this patch are not currently in 
               your mapped routine set, please skip this step.
   
   3.   COMPONENTS SENT WITH PATCH 
        ------------------------
        The following is a list of the routines included in this patch.  
        The second line of each of these routines now looks like: 
   
            ;;2.0;INCOME VERIFICATION MATCH;**[patch list]**;21-OCT-94 
   
                            CHECK^XTSUMBLD results
  
        Routine          Before Patch     After Patch    Patch List 
        -------          ------------     -----------    ----------
        IVMCZMT          14064057         14028257       17,53,49,58,81
        IVMPTRN4         5481419          5478061        9,11,17,34,66
                                                         81
           Total number of routines - 2
   
   4.   START UP KIDS 
        -------------
        Start up the Kernel Installation and Distribution System Menu 
        [XPD MAIN]: 
    
             Edits and Distribution ...  
             Utilities ...  
             Installation ...  
    
   Select Kernel Installation & Distribution System Option: INStallation 
                                                            ---
             Load a Distribution 
             Print Transport Global 
             Compare Transport Global to Current System 
             Verify Checksums in Transport Global 
             Install Package(s) 
             Restart Install of Package(s) 
             Unload a Distribution 
             Backup a Transport Global 
    
   Select Installation Option: 
    
   5.   Select Installation Option: 
        --------------------------
        NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
               NAME, enter IVM*2.0*81):
       
        a.  Backup a Transport Global - This option will create a backup
            message of any routines exported with this patch. It will not
            backup any other changes such as DD's or templates.
        b.  Compare Transport Global to Current System - This option will
            allow you to view all changes that will be made when this patch
            is installed.  It compares all components of this patch
            (routines, DD's, templates, etc.).
        c.  Verify Checksums in Transport Global - This option will allow
            you to ensure the integrity of the routines that are in the
            transport global.
      
   6.   Select Installation Option: Install Package(s) 
                                    ----------------
        **This is the step to start the installation of this KIDS patch: 
    
       a.  Choose the Install Package(s) option to start the patch install.
       b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
           YES//' answer NO (unless otherwise indicated)
       c.  When prompted 'Want to DISABLE Scheduled Options, Menu 
           Options, and Protocols? YES//' answer YES (unless otherwise
           indicated)
       d.  When prompted 'Enter options you wish to mark as 'Out Of
           Order':'  Enter the following options:
   
             IVM BACKGROUND JOB  [IVM BACKGROUND JOB]
  
       e.  When prompted 'Enter protocols you wish to mark as 'Out Of
           Order':' press <return>.
  
   7.   REBUILD MAPPED ROUTINE(S)  (DSM for Open VMS sites only)
        -------------------------
        Optional - Include the routines distributed with this patch
        in the mapped routine set.
      
        NOTE: This step is only necessary if you performed step 2 or 
              if you wish to include the routines in your mapped set.
  
   8.  When the installation is complete, be sure to re-start the filers 
       if you chose to stop them.

Routine Information:
====================

Routine Name:
  - IVMCZMT

 Before:
   ;
   S X=$$LST^DGMTU(DFN,VAFMTDT,$S($G(VAFTYPE):VAFTYPE,1:1))
   S MTIEN=+X
   I MTIEN S NODE=$G(^DGMT(408.31,+X,0)),PRIM=$G(^("PRIM")),NODE2=$G(^DGMT(
 408.31,+X,2))
   ;
   ;if $$LST of ^DGMTU returned the wrong income yr, disregard it
   I ($G(LIMIT)=1),$E(VAFMTDT,1,3)'=$E(+NODE,1,3) S (NODE,NODE2,X,PRIM)=""
   ;
   ; Check $$FUT
   I 'X D
   . N OK2SND,DGMTI,Y
   . S OK2SND=0
   . S Y=$$FUT^DGMTU(DFN,"",$S($G(VAFTYPE):VAFTYPE,1:1))
   . I +Y,$P($G(^DG(408.34,+$P(Y,U,5),0)),U)="DCD",$$VERSION^XPDUTL("IVMC")
  S X=Y
   S MTIEN=+X
   I MTIEN S NODE=$G(^DGMT(408.31,+X,0)),PRIM=$G(^("PRIM")),NODE2=$G(^DGMT(
 408.31,+X,2))
   ;
   ;if $$FUT of ^DGMTU returned the wrong income yr, disregard it
   I ($G(LIMIT)=1),$E(VAFMTDT,1,3)'=$E(+NODE,1,3) S (NODE,NODE2,X,PRIM)=""
   ;
  
  
 After:
   ;
   ; Check for a current Income Test
   S MTIEN=+$$LST^DGMTU(DFN,VAFMTDT,$S($G(VAFTYPE):VAFTYPE,1:1))
   I MTIEN S NODE=$G(^DGMT(408.31,MTIEN,0)),PRIM=$G(^("PRIM")),NODE2=$G(
 ^DGMT(408.31,MTIEN,2))
   ;
   ;if $$LST of ^DGMTU returned the wrong income yr, disregard it
   I ($G(LIMIT)=1),$E(VAFMTDT,1,3)'=$E(+NODE,1,3) S (NODE,NODE2,MTIEN,PRIM)
 =""
   ;
   ; Check for a future dated Income Test
   I 'MTIEN S MTIEN=+$$FUT^DGMTU(DFN,"",$S($G(VAFTYPE):VAFTYPE,1:1))
   I MTIEN S NODE=$G(^DGMT(408.31,MTIEN,0)),PRIM=$G(^("PRIM")),NODE2=$G(
 ^DGMT(408.31,MTIEN,2))
   ;
   ;if $$FUT of ^DGMTU returned the wrong income yr, disregard it
   I ($G(LIMIT)=1),$E(VAFMTDT,1,3)'=$E(+NODE,1,3) S (NODE,NODE2,MTIEN,PRIM)
 =""
   ;

Routine Checksum:

Routine Name:
  - IVMPTRN4

 Before:
   ;
 ENTRY  ; Check if message has not been transmitted in 3 days
   S IVMDTM3=$$FMADD^XLFDT(DT,-14),IVM14=$$FMADD^XLFDT(DT,-14)
   S IVMDTMST=+$P($G(^IVM(301.9,1,0)),"^",6)
   S:IVMDTMST<IVM14 IVMDTMST=IVM14
   ;
  
 After:
   ;
 ENTRY  ; Check if message has not been transmitted in 3 days
   S IVMDTM3=$$FMADD^XLFDT(DT,-3),IVM14=$$FMADD^XLFDT(DT,-14)
   S IVMDTMST=+$P($G(^IVM(301.9,1,0)),"^",6)
   S:IVMDTMST<IVM14 IVMDTMST=IVM14
   ;

Routine Checksum:

=============================================================================
User Information:                               
Entered By  : MULLER,RICHARD                 Date Entered : JUN 03, 2003
Completed By: HUA,PATRICK                   Date Completed: JUL 24, 2003
Released By : GANUS,MAUNETTE                Date Released : JUL 24, 2003
=============================================================================


Packman Mail Message:
=====================

$END TXT
