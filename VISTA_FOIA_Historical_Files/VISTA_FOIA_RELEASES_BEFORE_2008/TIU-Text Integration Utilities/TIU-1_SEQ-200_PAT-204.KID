Released TIU*1*204 SEQ #200
Extracted from mail message
**KIDS**:TIU*1.0*204^

**INSTALL NAME**
TIU*1.0*204
"BLD",6601,0)
TIU*1.0*204^TEXT INTEGRATION UTILITIES^0^3060208^y
"BLD",6601,1,0)
^^3^3^3060206^
"BLD",6601,1,1,0)
UNDEFINED ERROR IN TIUPUTS WHEN THERE IS NO DATE/TIME OUT OF OR.  TIU 
"BLD",6601,1,2,0)
VITALS OBJECTS (WEIGHT, HEIGHT AND TEMP) NOT WORKING PROPERLY WHEN 
"BLD",6601,1,3,0)
RESULTS ARE REFUSED, UNAVAILABLE OR PASS.
"BLD",6601,4,0)
^9.64PA^^
"BLD",6601,"KRN",0)
^9.67PA^8989.52^19
"BLD",6601,"KRN",.4,0)
.4
"BLD",6601,"KRN",.401,0)
.401
"BLD",6601,"KRN",.402,0)
.402
"BLD",6601,"KRN",.403,0)
.403
"BLD",6601,"KRN",.5,0)
.5
"BLD",6601,"KRN",.84,0)
.84
"BLD",6601,"KRN",3.6,0)
3.6
"BLD",6601,"KRN",3.8,0)
3.8
"BLD",6601,"KRN",9.2,0)
9.2
"BLD",6601,"KRN",9.8,0)
9.8
"BLD",6601,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6601,"KRN",9.8,"NM",1,0)
TIULO^^0^B50991778
"BLD",6601,"KRN",9.8,"NM",2,0)
TIUPUTS^^0^B35578522
"BLD",6601,"KRN",9.8,"NM","B","TIULO",1)
 
"BLD",6601,"KRN",9.8,"NM","B","TIUPUTS",2)
 
"BLD",6601,"KRN",19,0)
19
"BLD",6601,"KRN",19.1,0)
19.1
"BLD",6601,"KRN",101,0)
101
"BLD",6601,"KRN",409.61,0)
409.61
"BLD",6601,"KRN",771,0)
771
"BLD",6601,"KRN",870,0)
870
"BLD",6601,"KRN",8989.51,0)
8989.51
"BLD",6601,"KRN",8989.52,0)
8989.52
"BLD",6601,"KRN",8994,0)
8994
"BLD",6601,"KRN","B",.4,.4)
 
"BLD",6601,"KRN","B",.401,.401)
 
"BLD",6601,"KRN","B",.402,.402)
 
"BLD",6601,"KRN","B",.403,.403)
 
"BLD",6601,"KRN","B",.5,.5)
 
"BLD",6601,"KRN","B",.84,.84)
 
"BLD",6601,"KRN","B",3.6,3.6)
 
"BLD",6601,"KRN","B",3.8,3.8)
 
"BLD",6601,"KRN","B",9.2,9.2)
 
"BLD",6601,"KRN","B",9.8,9.8)
 
"BLD",6601,"KRN","B",19,19)
 
"BLD",6601,"KRN","B",19.1,19.1)
 
"BLD",6601,"KRN","B",101,101)
 
"BLD",6601,"KRN","B",409.61,409.61)
 
"BLD",6601,"KRN","B",771,771)
 
"BLD",6601,"KRN","B",870,870)
 
"BLD",6601,"KRN","B",8989.51,8989.51)
 
"BLD",6601,"KRN","B",8989.52,8989.52)
 
"BLD",6601,"KRN","B",8994,8994)
 
"BLD",6601,"QUES",0)
^9.62^^
"BLD",6601,"REQB",0)
^9.611^2^2
"BLD",6601,"REQB",1,0)
TIU*1.0*148^1
"BLD",6601,"REQB",2,0)
TIU*1.0*195^1
"BLD",6601,"REQB","B","TIU*1.0*148",1)
 
"BLD",6601,"REQB","B","TIU*1.0*195",2)
 
"MBREQ")
0
"PKG",470,-1)
1^1
"PKG",470,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",470,20,0)
^9.402P^^
"PKG",470,22,0)
^9.49I^1^1
"PKG",470,22,1,0)
1.0^3010801^3010806^66481
"PKG",470,22,1,"PAH",1,0)
204^3060208
"PKG",470,22,1,"PAH",1,1,0)
^^3^3^3060208
"PKG",470,22,1,"PAH",1,1,1,0)
UNDEFINED ERROR IN TIUPUTS WHEN THERE IS NO DATE/TIME OUT OF OR.  TIU 
"PKG",470,22,1,"PAH",1,1,2,0)
VITALS OBJECTS (WEIGHT, HEIGHT AND TEMP) NOT WORKING PROPERLY WHEN 
"PKG",470,22,1,"PAH",1,1,3,0)
RESULTS ARE REFUSED, UNAVAILABLE OR PASS.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIULO")
0^1^B50991778^B49931371
"RTN","TIULO",1,0)
TIULO ; SLC/JER - Embedded Objects ;11/29/02
"RTN","TIULO",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**34,70,101,148,204**;Jun 20, 1997
"RTN","TIULO",3,0)
DEM(DFN,VADM) ; Calls DEM^VADPT
"RTN","TIULO",4,0)
 D DEM^VADPT
"RTN","TIULO",5,0)
 Q
"RTN","TIULO",6,0)
NAME(DFN) ; Patient NAME
"RTN","TIULO",7,0)
 I '$D(VADM(1)) D DEM(DFN,.VADM)
"RTN","TIULO",8,0)
 Q $S(VADM(1)]"":VADM(1),1:"NAME UNKNOWN")
"RTN","TIULO",9,0)
SSN(DFN) ; Patient SSN
"RTN","TIULO",10,0)
 I '$D(VADM(2)) D DEM(DFN,.VADM)
"RTN","TIULO",11,0)
 Q $S($P(VADM(2),U,2)]"":$P(VADM(2),U,2),1:"SSN UNKNOWN")
"RTN","TIULO",12,0)
AGE(DFN) ; Patient AGE
"RTN","TIULO",13,0)
 I '$D(VADM(4)) D DEM(DFN,.VADM)
"RTN","TIULO",14,0)
 Q $S(VADM(4)]"":VADM(4),1:"AGE UNKNOWN")
"RTN","TIULO",15,0)
DOB(DFN) ; Patient DATE OF BIRTH
"RTN","TIULO",16,0)
 I '$D(VADM(3)) D DEM(DFN,.VADM)
"RTN","TIULO",17,0)
 Q $S($P(VADM(3),U,2)]"":$P(VADM(3),U,2),1:"DOB UNKNOWN")
"RTN","TIULO",18,0)
DOD(DFN) ; Patient DATE OF DEATH
"RTN","TIULO",19,0)
 I '$D(VADM(6)) D DEM(DFN,.VADM)
"RTN","TIULO",20,0)
 Q $S($P(VADM(6),U,2)]"":$P(VADM(6),U,2),1:"DATE OF DEATH UNKNOWN")
"RTN","TIULO",21,0)
SEX(DFN) ; Patient SEX
"RTN","TIULO",22,0)
 I '$D(VADM(5)) D DEM(DFN,.VADM)
"RTN","TIULO",23,0)
 Q $S($P(VADM(5),U,2)]"":$P(VADM(5),U,2),1:"SEX UNKNOWN")
"RTN","TIULO",24,0)
RACE(DFN) ; Patient RACE TIU*148
"RTN","TIULO",25,0)
 N TIUI
"RTN","TIULO",26,0)
 I '$D(VADM(12)) D DEM(DFN,.VADM)
"RTN","TIULO",27,0)
 I +$G(VADM(12))=1 S X=$P($G(VADM(12,1)),U,2)
"RTN","TIULO",28,0)
 I +$G(VADM(12))>1 D
"RTN","TIULO",29,0)
 . S X=$P($G(VADM(12,1)),U,2) F TIUI=2:1:VADM(12) D
"RTN","TIULO",30,0)
 . . S X=X_", "_$P($G(VADM(12,TIUI)),U,2)
"RTN","TIULO",31,0)
 I +$G(VADM(12))=0,$P(VADM(8),U,2)="" S X="RACE UNKNOWN"
"RTN","TIULO",32,0)
 I +$G(VADM(12))=0,$P(VADM(8),U,2)]"" S X=$P(VADM(8),U,2)
"RTN","TIULO",33,0)
 Q X
"RTN","TIULO",34,0)
ETHNIC(DFN) ; Patient ETHNICITY  TIU*148
"RTN","TIULO",35,0)
 N TIUI
"RTN","TIULO",36,0)
 I '$D(VADM(11,1)) D DEM(DFN,.VADM)
"RTN","TIULO",37,0)
 I +$G(VADM(11))=0 S X="ETHNICITY UNKNOWN"
"RTN","TIULO",38,0)
 I +$G(VADM(11))=1 S X=$P($G(VADM(11,1)),U,2)
"RTN","TIULO",39,0)
 I +$G(VADM(11))>1 D
"RTN","TIULO",40,0)
 . S X=$P($G(VADM(11,1)),U,2) F TIUI=2:1:VADM(11) D
"RTN","TIULO",41,0)
 . . S X=X_", "_$P($G(VADM(11,TIUI)),U,2)
"RTN","TIULO",42,0)
 I +$G(VADM(11))=0 S X="ETHNICITY UNKNOWN"
"RTN","TIULO",43,0)
 Q X
"RTN","TIULO",44,0)
HEIGHT(DFN) ; Gets most recent Height from VITALS
"RTN","TIULO",45,0)
 Q $$DOVITALS(DFN,"HT")
"RTN","TIULO",46,0)
WEIGHT(DFN) ; Gets most recent Weight from VITALS
"RTN","TIULO",47,0)
 Q $$DOVITALS(DFN,"WT")
"RTN","TIULO",48,0)
TEMP(DFN) ; Gets most recent Temperature from VITALS
"RTN","TIULO",49,0)
 Q $$DOVITALS(DFN,"T")
"RTN","TIULO",50,0)
PULSE(DFN) ; Gets most recent Pulse from VITALS
"RTN","TIULO",51,0)
 Q $$DOVITALS(DFN,"P")
"RTN","TIULO",52,0)
RESP(DFN) ; Gets most recent Respiration from VITALS
"RTN","TIULO",53,0)
 Q $$DOVITALS(DFN,"R")
"RTN","TIULO",54,0)
BP(DFN) ; Gets most recent Blood Pressure from VITALS
"RTN","TIULO",55,0)
 Q $$DOVITALS(DFN,"BP")
"RTN","TIULO",56,0)
PAIN(DFN) ; Gets most recent Pain score from VITALS
"RTN","TIULO",57,0)
 Q $$DOVITALS(DFN,"PN")
"RTN","TIULO",58,0)
DOVITALS(DFN,TIUVITC) ; INTERNAL ROUTINE TO GET SPECIFIED VITALS (**34**)
"RTN","TIULO",59,0)
 N TIUVIT,TIUVT,TIUVDT,TIUVDA,TIUY,VDT,TIUI,TIUCWRAP,TIUMAXW
"RTN","TIULO",60,0)
 N TIUVCNT,TIUVCNT2,TIUVDONE,TIUVDATE,TIUY1,TIUVTEMP,CONV
"RTN","TIULO",61,0)
 D VITALS(.TIUVIT,DFN,TIUVITC)
"RTN","TIULO",62,0)
 S (TIUVDT,TIUVDONE,TIUVCNT)=0
"RTN","TIULO",63,0)
 F  S TIUVDT=$O(TIUVIT(TIUVITC,TIUVDT)) Q:+TIUVDT'>0!TIUVDONE  D
"RTN","TIULO",64,0)
 . S TIUVDA=0
"RTN","TIULO",65,0)
 . F  S TIUVDA=$O(TIUVIT(TIUVITC,TIUVDT,TIUVDA)) Q:+TIUVDA'>0!TIUVDONE  D
"RTN","TIULO",66,0)
 . . I $D(TIUVDATE),TIUVDATE'=TIUVDT S TIUVDONE=1
"RTN","TIULO",67,0)
 . . E  D
"RTN","TIULO",68,0)
 . . . S TIUVDATE=TIUVDT,TIUVCNT=TIUVCNT+1
"RTN","TIULO",69,0)
 . . . S TIUVTEMP=$G(TIUVIT(TIUVITC,TIUVDT,TIUVDA))
"RTN","TIULO",70,0)
 . . . S VDT=$$DATE^TIULS($P(TIUVTEMP,U,1),"MM/DD/CCYY HR:MIN")
"RTN","TIULO",71,0)
 . . . S TIUY=$P(TIUVTEMP,U,8)
"RTN","TIULO",72,0)
 . . . I TIUVITC="WT" D
"RTN","TIULO",73,0)
 . . . . Q:+TIUY'>0
"RTN","TIULO",74,0)
 . . . . S CONV=$J((+TIUY/2.2),3,1)
"RTN","TIULO",75,0)
 . . . . S TIUY=TIUY_" lb ["_CONV_" kg]"
"RTN","TIULO",76,0)
 . . . I TIUVITC="HT" D
"RTN","TIULO",77,0)
 . . . . Q:+TIUY'>0
"RTN","TIULO",78,0)
 . . . . S CONV=$J((+TIUY*2.54),3,1)
"RTN","TIULO",79,0)
 . . . . S TIUY=TIUY_" in ["_CONV_" cm]"
"RTN","TIULO",80,0)
 . . . I TIUVITC="T" D
"RTN","TIULO",81,0)
 . . . . Q:+TIUY'>0
"RTN","TIULO",82,0)
 . . . . S CONV=+TIUY-32
"RTN","TIULO",83,0)
 . . . . S CONV=$J((CONV*(5/9)),3,1)
"RTN","TIULO",84,0)
 . . . . S TIUY=TIUY_" F ["_CONV_" C]"
"RTN","TIULO",85,0)
 . . . S TIUY=TIUY_" ("_VDT
"RTN","TIULO",86,0)
 . . . S TIUCWRAP=$L(TIUY)+17
"RTN","TIULO",87,0)
 . . . I TIUVCNT=1 S TIUY1=TIUY_")",TIUMAXW=59
"RTN","TIULO",88,0)
 . . . E  S TIUY="               "_TIUY,TIUMAXW=74
"RTN","TIULO",89,0)
 . . . S TIUVTEMP=$P(TIUVTEMP,U,17)
"RTN","TIULO",90,0)
 . . . I $L(TIUVTEMP)>0  D
"RTN","TIULO",91,0)
 . . . . S TIUVTEMP=", "_TIUVTEMP
"RTN","TIULO",92,0)
 . . . . F  S TIUI=$F(TIUVTEMP,";") Q:TIUI'>0  D
"RTN","TIULO",93,0)
 . . . . . S TIUVTEMP=$E(TIUVTEMP,1,TIUI-2)_", "_$E(TIUVTEMP,TIUI,999)
"RTN","TIULO",94,0)
 . . . S TIUY=TIUY_TIUVTEMP_")"
"RTN","TIULO",95,0)
 . . . I $L(TIUY)<TIUMAXW S TIUVITMP(TIUVCNT,0)=TIUY
"RTN","TIULO",96,0)
 . . . E  D  ; Wrap the line if it's too long
"RTN","TIULO",97,0)
 . . . . S TIUVCNT2=0,TIUVTEMP="",$P(TIUVTEMP," ",TIUCWRAP)=" "
"RTN","TIULO",98,0)
 . . . . F  Q:$L(TIUY)'>0  D
"RTN","TIULO",99,0)
 . . . . . F TIUI=TIUMAXW:-1:1  Q:$E(TIUY,TIUI,TIUI+1)=", "
"RTN","TIULO",100,0)
 . . . . . I TIUI>1 D
"RTN","TIULO",101,0)
 . . . . . . S TIUVITMP(TIUVCNT+TIUVCNT2,0)=$E(TIUY,1,TIUI)
"RTN","TIULO",102,0)
 . . . . . . S TIUVCNT2=TIUVCNT2+.01
"RTN","TIULO",103,0)
 . . . . . . S TIUY=TIUVTEMP_$E(TIUY,TIUI+2,999)
"RTN","TIULO",104,0)
 . . . . . E  D
"RTN","TIULO",105,0)
 . . . . . . S TIUVITMP(TIUVCNT+TIUVCNT2,0)=TIUY
"RTN","TIULO",106,0)
 . . . . . . S TIUY=""
"RTN","TIULO",107,0)
 I TIUVCNT<2 D
"RTN","TIULO",108,0)
 . S TIUY=$G(TIUY1)
"RTN","TIULO",109,0)
 . K TIUVITMP
"RTN","TIULO",110,0)
 E  S TIUY="~@TIUVITMP"
"RTN","TIULO",111,0)
 Q $G(TIUY)
"RTN","TIULO",112,0)
VITALS(TIUY,DFN,GMRVSTR,TIUEDT,TIULDT,TIUOCC) ; Vital measurements
"RTN","TIULO",113,0)
 N TIUVT,TIUVDT,TIUVDA K ^UTILITY($J,"GMRVD")
"RTN","TIULO",114,0)
 S GMRVSTR(0)=$G(TIUEDT)_U_$G(TIULDT)_U_$G(TIUOCC,1)_"^0"
"RTN","TIULO",115,0)
 I $L($T(EN1^GMRVUT0)) D EN1^GMRVUT0
"RTN","TIULO",116,0)
 I +$D(^UTILITY($J,"GMRVD")) D
"RTN","TIULO",117,0)
 . S TIUVT=""
"RTN","TIULO",118,0)
 . F  S TIUVT=$O(^UTILITY($J,"GMRVD",TIUVT)) Q:TIUVT']""  D
"RTN","TIULO",119,0)
 . . S TIUVDT=0
"RTN","TIULO",120,0)
 . . F  S TIUVDT=$O(^UTILITY($J,"GMRVD",TIUVT,TIUVDT)) Q:+TIUVDT'>0  D
"RTN","TIULO",121,0)
 . . . S TIUVDA=0
"RTN","TIULO",122,0)
 . . . F  S TIUVDA=$O(^UTILITY($J,"GMRVD",TIUVT,TIUVDT,TIUVDA)) Q:+TIUVDA'>0  D
"RTN","TIULO",123,0)
 . . . . S TIUY(TIUVT,TIUVDT,TIUVDA)=$G(^UTILITY($J,"GMRVD",TIUVT,TIUVDT,TIUVDA))
"RTN","TIULO",124,0)
 K ^UTILITY($J,"GMRVD")
"RTN","TIULO",125,0)
 Q
"RTN","TIULO",126,0)
LIPIDS(TIUY,DFN,TIUEDT,TIULDT) ; Get LIPID profile
"RTN","TIULO",127,0)
 N TIUTST,TIUI,TIURY,TIUDT,TIULDT
"RTN","TIULO",128,0)
 S TIUTST=$O(^LAB(60,"B","LIPID PROFILE",0))
"RTN","TIULO",129,0)
 I '+$G(TIUTST) Q
"RTN","TIULO",130,0)
 D TEST^LR7OR2(.TIUY,DFN,"",$G(TIUEDT),$G(TIULDT),"",TIUTST)
"RTN","TIULO",131,0)
 I '$D(TIUY)!($G(TIUY(1))="No Lab Data") Q
"RTN","TIULO",132,0)
 S TIUI=0 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIULO",133,0)
 . S TIUTST=$$MAPPER($P(@TIUY@(TIUI),U,17)),TIUDT=+@TIUY@(TIUI)
"RTN","TIULO",134,0)
 . S:TIUDT'=+$G(TIULDT) TIURY("BASELINE LIPID PROFILES",TIUDT)=$$DATE^TIULS(TIUDT,"MM/DD/YY")
"RTN","TIULO",135,0)
 . S TIURY(TIUTST,TIUDT)=$P(@TIUY@(TIUI),U,4)
"RTN","TIULO",136,0)
 F TIUI="CHYLOMI","TURBID","VLDL" K TIURY(TIUI)
"RTN","TIULO",137,0)
 K @TIUY
"RTN","TIULO",138,0)
 I $D(TIURY) M TIUY=TIURY
"RTN","TIULO",139,0)
 Q
"RTN","TIULO",140,0)
MAPPER(TIUX,TIUI) ; Remap test names
"RTN","TIULO",141,0)
 N TIUNM,Y S TIUNM("CHOL","TOTAL CHOLESTEROL")=""
"RTN","TIULO",142,0)
 S (TIUNM("HDL","HDL CHOLESTEROL"),TIUNM("LDL","LDL CHOLESTEROL"))=""
"RTN","TIULO",143,0)
 S TIUNM("TRIGLYC","TRIGLYCERIDES")=""
"RTN","TIULO",144,0)
 S Y=$O(TIUNM(TIUX,"")) I Y']"" S Y=TIUX
"RTN","TIULO",145,0)
 Q Y
"RTN","TIULO",146,0)
TSHT4(DFN,TIUEDT,TIULDT) ; Get TSH/T4
"RTN","TIULO",147,0)
 N TIUY,TIUTSH,TIUT4 S TIUTSH=+$O(^LAB(60,"B","TSH",0))
"RTN","TIULO",148,0)
 S TIUT4=+$O(^LAB(60,"B","T-4",0))
"RTN","TIULO",149,0)
 I '+$G(TIUTSH)!'+$G(TIUT4) G TSHX
"RTN","TIULO",150,0)
 D TEST^LR7OR2(.TIUY,DFN,"",$G(TIUEDT),$G(TIULDT),"",TIUTSH)
"RTN","TIULO",151,0)
 S TIUTSH=$S($D(TIUY)#2:$P($G(@TIUY@(1)),U,4),1:"____")
"RTN","TIULO",152,0)
 I $D(TIUY)#2 K @TIUY
"RTN","TIULO",153,0)
 D TEST^LR7OR2(.TIUY,DFN,"",$G(TIUEDT),$G(TIULDT),"",TIUT4)
"RTN","TIULO",154,0)
 S TIUT4=$S($D(TIUY)#2:$P($G(@TIUY@(1)),U,4),1:"____")
"RTN","TIULO",155,0)
 I $D(TIUY)#2 K @TIUY
"RTN","TIULO",156,0)
 S TIUY=TIUTSH_"/"_TIUT4
"RTN","TIULO",157,0)
TSHX Q $G(TIUY)
"RTN","TIULO",158,0)
SGOT(DFN,TIUEDT,TIULDT) ; Get SGOT
"RTN","TIULO",159,0)
 N TIUY,TIUSGOT S TIUSGOT=+$O(^LAB(60,"B","SGOT",0))
"RTN","TIULO",160,0)
 I '+$G(TIUSGOT) Q
"RTN","TIULO",161,0)
 D TEST^LR7OR2(.TIUY,DFN,"",$G(TIUEDT),$G(TIULDT),"",TIUSGOT)
"RTN","TIULO",162,0)
 S TIUSGOT=$S($D(TIUY)#2:$P($G(@TIUY@(1)),U,4),1:"____")
"RTN","TIULO",163,0)
 I $D(TIUY)#2 K @TIUY
"RTN","TIULO",164,0)
SGOTX Q $G(TIUSGOT)
"RTN","TIULO",165,0)
HGBA1C(DFN,TIUEDT,TIULDT) ; Get Hemoglobin A1C
"RTN","TIULO",166,0)
 N TIUY,TIUHGB S TIUHGB=+$O(^LAB(60,"B","HEMOGLOBIN A1C",0))
"RTN","TIULO",167,0)
 I '+$G(TIUHGB) G HGBX
"RTN","TIULO",168,0)
 D TEST^LR7OR2(.TIUY,DFN,"",$G(TIUEDT),$G(TIULDT),"",TIUHGB)
"RTN","TIULO",169,0)
 S TIUHGB=$S($D(TIUY)#2:$P($G(@TIUY@(1)),U,4),1:"____")
"RTN","TIULO",170,0)
 I $D(TIUY)#2 K @TIUY
"RTN","TIULO",171,0)
HGBX Q $G(TIUHGB)
"RTN","TIULO",172,0)
URICACID(DFN,TIUEDT,TIULDT) ; Get Uric Acid
"RTN","TIULO",173,0)
 N TIUY,TIUURIC S TIUURIC=+$O(^LAB(60,"B","URIC ACID",0))
"RTN","TIULO",174,0)
 I '+$G(TIUURIC) G URICX
"RTN","TIULO",175,0)
 D TEST^LR7OR2(.TIUY,DFN,"",$G(TIUEDT),$G(TIULDT),"",TIUURIC)
"RTN","TIULO",176,0)
 S TIUURIC=$S($D(TIUY)#2:$P($G(@TIUY@(1)),U,4),1:"____")
"RTN","TIULO",177,0)
 I $D(TIUY)#2 K @TIUY
"RTN","TIULO",178,0)
URICX Q $G(TIUURIC)
"RTN","TIULO",179,0)
FBG(DFN,TIUEDT,TIULDT) ; Get FBG
"RTN","TIULO",180,0)
 N TIUY,TIUFBG S TIUFBG=+$O(^LAB(60,"B","FBS",0))
"RTN","TIULO",181,0)
 I '+$G(TIUFBG) G FBGX
"RTN","TIULO",182,0)
 D TEST^LR7OR2(.TIUY,DFN,"",$G(TIUEDT),$G(TIULDT),"",TIUFBG)
"RTN","TIULO",183,0)
 S TIUFBG=$S($D(TIUY)#2:$P($G(@TIUY@(1)),U,4),1:"____")
"RTN","TIULO",184,0)
 I $D(TIUY)#2 K @TIUY
"RTN","TIULO",185,0)
FBGX Q $G(TIUFBG)
"RTN","TIULO",186,0)
ADM(DFN) ;Current Admission Date/Time
"RTN","TIULO",187,0)
 N VAIN,J
"RTN","TIULO",188,0)
 D INP^VADPT
"RTN","TIULO",189,0)
 S J=$P(VAIN(7),U,2),J(1)=$P(J,"@",1),J(2)=$P(J,"@",2),J(3)=$E(J(2),1,5),Y=J(1)_" "_J(3) K J
"RTN","TIULO",190,0)
ADMX Q Y
"RTN","TIULO",191,0)
TODAY() ;Today's Date
"RTN","TIULO",192,0)
 N X,Y
"RTN","TIULO",193,0)
 S X=$G(DT) I X'="" S Y=X D DD^%DT
"RTN","TIULO",194,0)
TODAYX Q Y
"RTN","TIULO",195,0)
NOW() ;Current Date/Time
"RTN","TIULO",196,0)
NOWX Q $$DATE^TIULS($$NOW^TIULC,"AMTH DD, CCYY HR:MIN")
"RTN","TIUPUTS")
0^2^B35578522^B35000705
"RTN","TIUPUTS",1,0)
TIUPUTS ; SLC/JER - Surgery Look-up, etc. ; 04/19/2004
"RTN","TIUPUTS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**112,187,173,195,204**;Jun 20, 1997
"RTN","TIUPUTS",3,0)
LOOKUP ; Look-up code used by router/filer
"RTN","TIUPUTS",4,0)
 ; Required: TIUSRCN, TIUSDA, TIUSSN, TIUODT
"RTN","TIUPUTS",5,0)
 N SRODT,DFN,TIUSR0,TIUD0,TIUDAD
"RTN","TIUPUTS",6,0)
 I $S('$D(TIUSSN):1,$G(TIUSSN)?4N:1,$G(TIUSSN)']"":1,+$G(TIUODT)'>0:1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTS",7,0)
 I TIUSSN?3N1P2N1P4N.E S TIUSSN=$TR(TIUSSN,"-/","")
"RTN","TIUPUTS",8,0)
 I TIUSSN["?" S Y=-1 G LOOKUPX
"RTN","TIUPUTS",9,0)
 S DFN=+$$PATIENT^TIULA(TIUSSN)
"RTN","TIUPUTS",10,0)
 I DFN'>0 S Y=-1 G LOOKUPX
"RTN","TIUPUTS",11,0)
 I +$G(TIUSRCN)=0 S TIUSRCN=$$FINDCASE(DFN,+$$IDATE^TIULC(TIUODT))
"RTN","TIUPUTS",12,0)
 I +$G(TIUSRCN)'>0 S Y=-1 G LOOKUPX
"RTN","TIUPUTS",13,0)
 I +$G(TIUSDA)'>0,$D(^SRF(TIUSRCN,"TIU")) S TIUSDA=$$GETSDA(TIUSRCN)
"RTN","TIUPUTS",14,0)
 I +$G(TIUSDA)'>0 D  G LOOKUPX
"RTN","TIUPUTS",15,0)
 . S Y=-1
"RTN","TIUPUTS",16,0)
 . I '$D(^SRF(TIUSRCN,"TIU")),'$D(ZTQUEUED) D
"RTN","TIUPUTS",17,0)
 . . W !!,"Time Out of O.R. has not yet been entered for Surgical Case #",TIUSRCN
"RTN","TIUPUTS",18,0)
 . . W !,"the Surgical Service must complete this step before the Operation"
"RTN","TIUPUTS",19,0)
 . . W !,"Report can be uploaded..."
"RTN","TIUPUTS",20,0)
 K TIUHDR(.001),TIUHDR(.02),TIUHDR(.07),TIUHDR(1405)
"RTN","TIUPUTS",21,0)
 S TIUD0=$G(^TIU(8925,TIUSDA,0)),TIUSR0=$G(^SRF(TIUSRCN,0))
"RTN","TIUPUTS",22,0)
 ;Confirm that SURGICAL CASE is for correct patient
"RTN","TIUPUTS",23,0)
 I +TIUSR0'=DFN S Y=-1 G LOOKUPX
"RTN","TIUPUTS",24,0)
 ;Confirm that TIU DOCUMENT is for correct patient
"RTN","TIUPUTS",25,0)
 I +$P(TIUD0,U,2)'=DFN S Y=-1 G LOOKUPX
"RTN","TIUPUTS",26,0)
 ;Confirm that OPERATION DATE is correct
"RTN","TIUPUTS",27,0)
 I +$$IDATE^TIULC(TIUODT)'=$P($P(TIUSR0,U,9),".") S Y=-1 G LOOKUPX
"RTN","TIUPUTS",28,0)
 S Y=$$CALLDIC(TIUSDA)
"RTN","TIUPUTS",29,0)
 I '+$$CANEDIT(+Y) D
"RTN","TIUPUTS",30,0)
 . W !,"Existing document may not be edited...Creating Addendum."
"RTN","TIUPUTS",31,0)
 . S TIUDAD=+Y,Y=$$MAKEADD^TIUPUTU()
"RTN","TIUPUTS",32,0)
 . D COPYDAD(Y,TIUDAD)
"RTN","TIUPUTS",33,0)
LOOKUPX K TIUSRCN,TIUSDA
"RTN","TIUPUTS",34,0)
 Q
"RTN","TIUPUTS",35,0)
CANEDIT(DA) ; Check whether or not document is released
"RTN","TIUPUTS",36,0)
 Q $S(+$P($G(^TIU(8925,+DA,0)),U,5)<4:1,1:0)
"RTN","TIUPUTS",37,0)
COPYDAD(DA,PARENT) ; copy fixed field data for addenda
"RTN","TIUPUTS",38,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIUOPDT,TIURDT,TIUD0,TIUD12,TIUD14
"RTN","TIUPUTS",39,0)
 S TIUD0=$G(^TIU(8925,+PARENT,0)),TIUD12=$G(^(12)),TIUD14=$G(^(14))
"RTN","TIUPUTS",40,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTS",41,0)
 S @FDARR@(.02)=$P(TIUD0,U,2)
"RTN","TIUPUTS",42,0)
 S @FDARR@(.03)=$P(TIUD0,U,3),@FDARR@(.05)=3
"RTN","TIUPUTS",43,0)
 S @FDARR@(.06)=PARENT,@FDARR@(.08)=$P(TIUD0,U,8)
"RTN","TIUPUTS",44,0)
 S @FDARR@(1401)=$P(TIUD14,U)
"RTN","TIUPUTS",45,0)
 S @FDARR@(1402)=$P(TIUD14,U,2)
"RTN","TIUPUTS",46,0)
 S @FDARR@(1405)=TIUSRCN_";SRF("
"RTN","TIUPUTS",47,0)
 S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTS",48,0)
 S @FDARR@(1205)=$P(TIUD12,U,5)
"RTN","TIUPUTS",49,0)
 S TIUOPDT=+$$IDATE^TIULC($G(TIUODT))
"RTN","TIUPUTS",50,0)
 S TIURDT=$S(+$G(TIUOPDT)>0:+$G(TIUOPDT),1:+$$NOW^XLFDT)
"RTN","TIUPUTS",51,0)
 S @FDARR@(1301)=TIURDT,@FDARR@(1303)="U"
"RTN","TIUPUTS",52,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPUTS",53,0)
 Q
"RTN","TIUPUTS",54,0)
FINDCASE(DFN,TIUODT) ; Find Surgical Case for Pt & Dt, if unique
"RTN","TIUPUTS",55,0)
 N TIUY,TIUCN,TIUHIT,TIUPOP S TIUCN="",(TIUY,TIUHIT,TIUPOP)=0
"RTN","TIUPUTS",56,0)
 F  S TIUCN=$O(^SRF("B",DFN,TIUCN),-1) Q:TIUCN'>0!+TIUPOP  D
"RTN","TIUPUTS",57,0)
 . N TIUSR0 S TIUSR0=$G(^SRF(TIUCN,0))
"RTN","TIUPUTS",58,0)
 . I +$G(TIUODT)=$P($P(TIUSR0,U,9),".") D
"RTN","TIUPUTS",59,0)
 . . I +TIUHIT S TIUPOP=1 Q
"RTN","TIUPUTS",60,0)
 . . S TIUHIT=TIUCN
"RTN","TIUPUTS",61,0)
 I 'TIUPOP,TIUHIT S TIUY=TIUHIT
"RTN","TIUPUTS",62,0)
 Q TIUY
"RTN","TIUPUTS",63,0)
GETSDA(TIUSRCN) ; Get Op Report for Case
"RTN","TIUPUTS",64,0)
 N TIUY S TIUY=+$P(^SRF(TIUSRCN,"TIU"),U)
"RTN","TIUPUTS",65,0)
 I 'TIUY S TIUY=+$P(^SRF(TIUSRCN,"TIU"),U,3)
"RTN","TIUPUTS",66,0)
 Q TIUY
"RTN","TIUPUTS",67,0)
CALLDIC(TIUX) ; Call ^DIC to get the IEN for the TIU DOCUMENT
"RTN","TIUPUTS",68,0)
 N DA,DIC,X,Y
"RTN","TIUPUTS",69,0)
 S DIC=8925,DIC(0)="NX",X="`"_TIUX D ^DIC
"RTN","TIUPUTS",70,0)
 Q Y
"RTN","TIUPUTS",71,0)
FOLLOWUP(TIUDA) ; Post-filing code for Operation Reports
"RTN","TIUPUTS",72,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIU
"RTN","TIUPUTS",73,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTS",74,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPUTS",75,0)
 I $L($G(TIU("EDT"))) S @FDARR@(.07)=$P($G(TIU("EDT")),U)
"RTN","TIUPUTS",76,0)
 S @FDARR@(1204)=$$WHOSIGNS^TIULC1(TIUDA)
"RTN","TIUPUTS",77,0)
 S @FDARR@(1208)=$$WHOCOSIG^TIULC1(TIUDA)
"RTN","TIUPUTS",78,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTS",79,0)
 I +$P($G(^TIU(8925,+TIUDA,12)),U,4)'=+$P($G(^(12)),U,9) D
"RTN","TIUPUTS",80,0)
 . S @FDARR@(1506)=1 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTS",81,0)
 D RELEASE^TIUT(TIUDA,1)
"RTN","TIUPUTS",82,0)
 D AUDIT^TIUEDI1(TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUPUTS",83,0)
 Q
"RTN","TIUPUTS",84,0)
FIX ; Filing error resolution code for Operation Reports
"RTN","TIUPUTS",85,0)
 N TIUOUT,TIUDA,TIUD0,TIUX,TIUPRM0,TIUPRM1,SUCCESS,TIUBUF,TIUHIT
"RTN","TIUPUTS",86,0)
 N TIUADD,TIUTYP,TIU,DUOUT,DTOUT
"RTN","TIUPUTS",87,0)
 S TIUHIT=0
"RTN","TIUPUTS",88,0)
 ; -- first, determine the correct TIU DOCUMENT record --
"RTN","TIUPUTS",89,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!+$G(TIUOUT)
"RTN","TIUPUTS",90,0)
 . N D,D0,DK,DL,DIC,X,Y,DA,DX,A,S,TIUFPRIV
"RTN","TIUPUTS",91,0)
 . S X=+$$PATIENT^TIULA
"RTN","TIUPUTS",92,0)
 . I X'>0 D  Q
"RTN","TIUPUTS",93,0)
 . . W !!,"Okay, no harm done...",!
"RTN","TIUPUTS",94,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUPUTS",95,0)
 . . S TIUOUT=1
"RTN","TIUPUTS",96,0)
 . S DIC=8925,DIC(0)="UXEV",D="C"
"RTN","TIUPUTS",97,0)
 . W !
"RTN","TIUPUTS",98,0)
 . S DIC("W")="D DICW^TIUPUTS(+Y)"
"RTN","TIUPUTS",99,0)
 . S DIC("S")="I +$$DICS^TIUPUTS(+Y)"
"RTN","TIUPUTS",100,0)
 . D IX^DIC
"RTN","TIUPUTS",101,0)
 . I +Y'>0 D  Q
"RTN","TIUPUTS",102,0)
 . . W !!,$S(+$O(^TIU(8925,"C",+X,0))'>0:"No OPERATION REPORTS Available to Update.",1:"No OPERATION REPORT Selected..."),!
"RTN","TIUPUTS",103,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUPUTS",104,0)
 . . S TIUOUT=1
"RTN","TIUPUTS",105,0)
 . W ! S (DA,TIUHIT)=+Y D EN^DIQ
"RTN","TIUPUTS",106,0)
 . S TIUOUT=$$READ^TIUU("Y","... OK","YES") W !
"RTN","TIUPUTS",107,0)
 . I +TIUOUT S TIUDA=DA
"RTN","TIUPUTS",108,0)
 Q:$D(DUOUT)!$D(DIROUT)!+$G(DTOUT)!'+$G(TIUDA)
"RTN","TIUPUTS",109,0)
 ; -- next, load fields from upload buffer entry --
"RTN","TIUPUTS",110,0)
 S TIUBUF=$S(+$G(XQADATA):+$G(XQADATA),+$G(BUFDA):+$G(BUFDA),1:"")
"RTN","TIUPUTS",111,0)
 ; -- if TIUDA may be edited, file data, else make addendum --
"RTN","TIUPUTS",112,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUTYP=+TIUD0
"RTN","TIUPUTS",113,0)
 I +$$CANEDIT(TIUDA)'>0 D  G FIXX
"RTN","TIUPUTS",114,0)
 . W !!,"Existing document may not be edited...Creating Addendum.",!
"RTN","TIUPUTS",115,0)
 . D MAKEADD^TIUPEFIX(.TIUADD,TIUDA,TIUBUF)
"RTN","TIUPUTS",116,0)
 . S SUCCESS=TIUADD
"RTN","TIUPUTS",117,0)
 ; -- Load the array TIUX from the buffer
"RTN","TIUPUTS",118,0)
 D LOADTIUX^TIUPEFIX(.TIUX,TIUBUF)
"RTN","TIUPUTS",119,0)
 ; -- finally, file data in TIU DOCUMENT file --
"RTN","TIUPUTS",120,0)
 K ^TIU(8925,+TIUDA,"TEMP"),TIUX(.001),TIUX(.01),TIUX(.02),TIUX(.03),TIUX(.05)
"RTN","TIUPUTS",121,0)
 K TIUX(.13),TIUX(1205),TIUX(1211),TIUX(1405)
"RTN","TIUPUTS",122,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUPUTS",123,0)
 D FILE^TIUPEFIX(.SUCCESS,+TIUDA,.TIUX,TIUTYP)
"RTN","TIUPUTS",124,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPUTS",125,0)
 D MERGTEXT^TIUEDI1(+TIUDA,.TIU) K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUPUTS",126,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUTYP)
"RTN","TIUPUTS",127,0)
 S TIUREC("#")=TIUDA
"RTN","TIUPUTS",128,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPUTS",129,0)
FIXX D ALERTDEL^TIUPEVNT(+TIUBUF)
"RTN","TIUPUTS",130,0)
 D RESOLVE^TIUPEVNT($S($D(XQADATA):+$P(XQADATA,";",3),1:$G(ERRDA)),1)
"RTN","TIUPUTS",131,0)
 D BUFPURGE^TIUPUTC(+TIUBUF)
"RTN","TIUPUTS",132,0)
 W "Done."
"RTN","TIUPUTS",133,0)
 S TIUDONE=1
"RTN","TIUPUTS",134,0)
 Q
"RTN","TIUPUTS",135,0)
DICW(TIUDA) ; Write identifiers
"RTN","TIUPUTS",136,0)
 ;VMP OIFO BAY PINES;ELR;TIU*1.0*195;MODIFIED THIS TAG
"RTN","TIUPUTS",137,0)
 N X,Y,VADM,VA,VAERR,TIUD0,TIUD12,TIUD13,TIUD14,TIUPRNM
"RTN","TIUPUTS",138,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13)),TIUD14=$G(^(14))
"RTN","TIUPUTS",139,0)
 W ?35,"Dated: ",$$DATE^TIULS(+TIUD13,"MM/DD/CCYY@HR:MIN"),?62,"By: ",$E($$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD12,U,2)),"LAST,FI MI"),1,13)
"RTN","TIUPUTS",140,0)
 ;VMP OIFO BAY PINES;ELR;TIU*1.0*195;ADDED FROM HERE DOWN
"RTN","TIUPUTS",141,0)
 Q:$G(TIUCLASS)'=38
"RTN","TIUPUTS",142,0)
 S TIUD14=+$P(TIUD14,U,5)
"RTN","TIUPUTS",143,0)
 Q:$L(TIUD14)'>0
"RTN","TIUPUTS",144,0)
 D ONE^SROESTV(.TIUPRNM,TIUD14)      ;IA 3533
"RTN","TIUPUTS",145,0)
 N TIUS0 S TIUS0=$G(@TIUPRNM@(TIUD14))
"RTN","TIUPUTS",146,0)
 Q:$L(TIUS0)'>0
"RTN","TIUPUTS",147,0)
 W !?11,"Case #: ",TIUD14,"  ",$P(@TIUPRNM@(TIUD14),U,2)
"RTN","TIUPUTS",148,0)
 Q
"RTN","TIUPUTS",149,0)
DICS(TIUDA) ; Filter IX^DIC list
"RTN","TIUPUTS",150,0)
 N TIUD0,TIUY S TIUY=0
"RTN","TIUPUTS",151,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUPUTS",152,0)
 I +$$ISA^TIULX(+TIUD0,+$$CLASS^TIUSROI("OPERATION REPORTS")) S TIUY=1 I 1
"RTN","TIUPUTS",153,0)
 E  I +$$ISA^TIULX(+TIUD0,+$$CLASS^TIUSROI("PROCEDURE REPORT (NON-O.R.)")) S TIUY=1
"RTN","TIUPUTS",154,0)
 Q TIUY
"VER")
8.0^22.0
"BLD",6601,6)
^200
**END**
**END**
