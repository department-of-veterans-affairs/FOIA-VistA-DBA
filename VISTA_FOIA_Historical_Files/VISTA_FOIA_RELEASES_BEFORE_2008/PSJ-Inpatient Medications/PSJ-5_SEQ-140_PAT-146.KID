Released PSJ*5*146 SEQ #140
Extracted from mail message
**KIDS**:PSJ*5.0*146^

**INSTALL NAME**
PSJ*5.0*146
"BLD",5316,0)
PSJ*5.0*146^INPATIENT MEDICATIONS^0^3051019^y
"BLD",5316,1,0)
^^6^6^3050909^^
"BLD",5316,1,1,0)
This patch adds the capability of doing order checking between local VA 
"BLD",5316,1,2,0)
facilities and remote VA or Department of Defense (DoD) facilities where 
"BLD",5316,1,3,0)
veterans have received prescriptions.
"BLD",5316,1,4,0)
 
"BLD",5316,1,5,0)
The order checking includes checking for duplicate drugs, duplicate drug 
"BLD",5316,1,6,0)
classes, drug interactions, and drug allergies.
"BLD",5316,4,0)
^9.64PA^^
"BLD",5316,6)
5^
"BLD",5316,"ABPKG")
n
"BLD",5316,"KRN",0)
^9.67PA^8989.52^19
"BLD",5316,"KRN",.4,0)
.4
"BLD",5316,"KRN",.401,0)
.401
"BLD",5316,"KRN",.402,0)
.402
"BLD",5316,"KRN",.403,0)
.403
"BLD",5316,"KRN",.5,0)
.5
"BLD",5316,"KRN",.84,0)
.84
"BLD",5316,"KRN",3.6,0)
3.6
"BLD",5316,"KRN",3.8,0)
3.8
"BLD",5316,"KRN",9.2,0)
9.2
"BLD",5316,"KRN",9.8,0)
9.8
"BLD",5316,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",5316,"KRN",9.8,"NM",1,0)
PSJLMUT1^^0^B65316144
"BLD",5316,"KRN",9.8,"NM",2,0)
PSJLMUT2^^0^B6130551
"BLD",5316,"KRN",9.8,"NM",3,0)
PSGSICHK^^0^B48075149
"BLD",5316,"KRN",9.8,"NM",4,0)
PSIVBCID^^0^B6780776
"BLD",5316,"KRN",9.8,"NM","B","PSGSICHK",3)

"BLD",5316,"KRN",9.8,"NM","B","PSIVBCID",4)

"BLD",5316,"KRN",9.8,"NM","B","PSJLMUT1",1)

"BLD",5316,"KRN",9.8,"NM","B","PSJLMUT2",2)

"BLD",5316,"KRN",19,0)
19
"BLD",5316,"KRN",19,"NM",0)
^9.68A^^
"BLD",5316,"KRN",19.1,0)
19.1
"BLD",5316,"KRN",101,0)
101
"BLD",5316,"KRN",409.61,0)
409.61
"BLD",5316,"KRN",771,0)
771
"BLD",5316,"KRN",870,0)
870
"BLD",5316,"KRN",8989.51,0)
8989.51
"BLD",5316,"KRN",8989.52,0)
8989.52
"BLD",5316,"KRN",8994,0)
8994
"BLD",5316,"KRN","B",.4,.4)

"BLD",5316,"KRN","B",.401,.401)

"BLD",5316,"KRN","B",.402,.402)

"BLD",5316,"KRN","B",.403,.403)

"BLD",5316,"KRN","B",.5,.5)

"BLD",5316,"KRN","B",.84,.84)

"BLD",5316,"KRN","B",3.6,3.6)

"BLD",5316,"KRN","B",3.8,3.8)

"BLD",5316,"KRN","B",9.2,9.2)

"BLD",5316,"KRN","B",9.8,9.8)

"BLD",5316,"KRN","B",19,19)

"BLD",5316,"KRN","B",19.1,19.1)

"BLD",5316,"KRN","B",101,101)

"BLD",5316,"KRN","B",409.61,409.61)

"BLD",5316,"KRN","B",771,771)

"BLD",5316,"KRN","B",870,870)

"BLD",5316,"KRN","B",8989.51,8989.51)

"BLD",5316,"KRN","B",8989.52,8989.52)

"BLD",5316,"KRN","B",8994,8994)

"BLD",5316,"QUES",0)
^9.62^^
"BLD",5316,"REQB",0)
^9.611^1^1
"BLD",5316,"REQB",1,0)
PSJ*5.0*139^2
"BLD",5316,"REQB","B","PSJ*5.0*139",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
146^3051019^11881
"PKG",197,22,1,"PAH",1,1,0)
^^6^6^3051019
"PKG",197,22,1,"PAH",1,1,1,0)
This patch adds the capability of doing order checking between local VA 
"PKG",197,22,1,"PAH",1,1,2,0)
facilities and remote VA or Department of Defense (DoD) facilities where 
"PKG",197,22,1,"PAH",1,1,3,0)
veterans have received prescriptions.
"PKG",197,22,1,"PAH",1,1,4,0)
 
"PKG",197,22,1,"PAH",1,1,5,0)
The order checking includes checking for duplicate drugs, duplicate drug 
"PKG",197,22,1,"PAH",1,1,6,0)
classes, drug interactions, and drug allergies.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSGSICHK")
0^3^B48075149
"RTN","PSGSICHK",1,0)
PSGSICHK ;BIR/CML3-CHECKS SPECIAL INSTRUCTIONS ;17 Aug 98 / 8:33 AM
"RTN","PSGSICHK",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,9,26,29,44,49,59,110,139,146**;16 DEC 97
"RTN","PSGSICHK",3,0)
 ;
"RTN","PSGSICHK",4,0)
 ; Reference to EN^PSOORDRG is supported by DBIA 2190.
"RTN","PSGSICHK",5,0)
 ; Reference to ^PSI(58.1 is supported by DBIA 2284.
"RTN","PSGSICHK",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGSICHK",7,0)
 ; Reference to ^PSD(58.8 is supported by DBIA 2283.
"RTN","PSGSICHK",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGSICHK",9,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGSICHK",10,0)
 ; Reference to ^PS(51 is supported by DBIA 2176.
"RTN","PSGSICHK",11,0)
 ; Reference to ^XTMP("ORRDI" is supported by DBIA 4660.
"RTN","PSGSICHK",12,0)
 ;
"RTN","PSGSICHK",13,0)
START ;
"RTN","PSGSICHK",14,0)
 I $S(X'?.ANP:1,X["^":1,1:$L(X)>180) K X Q
"RTN","PSGSICHK",15,0)
 S Y="" F Y(1)=1:1:$L(X," ") S Y(2)=$P(X," ",Y(1)) I Y(2)]"" D CHK Q:'$D(X)
"RTN","PSGSICHK",16,0)
 ;I $D(X),Y]"",X'=$E(Y,1,$L(Y)-1) W !?3,"EXPANDS TO:",! F Y(1)=1:1 S Y(2)=$P(Y," ",Y(1)) Q:Y(2)=""  W:$L(Y(2))+$X>78 ! W Y(2)," "
"RTN","PSGSICHK",17,0)
 I $D(X),Y]"",X'=$E(Y,1,$L(Y)-1) D EN^DDIOL("EXPANDS TO: ") W Y F Y(1)=1:1 S Y(2)=$P(Y," ",Y(1)) Q:Y(2)=""  D:$L(Y(2))+$X>78 EN^DDIOL(Y(2)_" ")
"RTN","PSGSICHK",18,0)
 Q
"RTN","PSGSICHK",19,0)
 ;
"RTN","PSGSICHK",20,0)
CHK ;
"RTN","PSGSICHK",21,0)
 I $L(Y(2))<31,$D(^PS(51,+$O(^PS(51,"B",Y(2),0)),0)),$P(^(0),"^",2)]"",$P(^(0),"^",4) S Y(2)=$P(^(0),"^",2)
"RTN","PSGSICHK",22,0)
 I $L(Y)+$L(Y(2))>180 K X Q
"RTN","PSGSICHK",23,0)
 S Y=Y_Y(2)_" " Q
"RTN","PSGSICHK",24,0)
 ;
"RTN","PSGSICHK",25,0)
ENSET(X) ; expands the SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSGSICHK",26,0)
 N X1,X2,Y S Y=""
"RTN","PSGSICHK",27,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) I X2]"" S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSGSICHK",28,0)
 S Y=$E(Y,1,$L(Y)-1) Q Y
"RTN","PSGSICHK",29,0)
 ;
"RTN","PSGSICHK",30,0)
END ; used by DRUG (55.06,101 & 53.1,101) x-refs to warn user if patient is receiving or about to receive the drug just ordered
"RTN","PSGSICHK",31,0)
 Q:$D(PSJHLSKP)
"RTN","PSGSICHK",32,0)
 N Z,ZZ,STATUSNP I $G(PSJPWD)&($P($G(PSJSYSU),";")=3)&($G(PSGDRG)) I ($D(^PSI(58.1,"D",PSGDRG,PSJPWD)))!($D(^PSD(58.8,"D",PSGDRG,PSJPWD))) D EN^DDIOL("                         *** A WARD STOCK ITEM ***")
"RTN","PSGSICHK",33,0)
 D NOW^%DTC
"RTN","PSGSICHK",34,0)
 N PSJDCHK F Z=%:0 S Z=$O(^PS(55,+PSGP,5,"AUS",Z)) Q:'Z!$D(DUOUT)  F ZZ=0:0 S ZZ=$O(^PS(55,+PSGP,5,"AUS",Z,ZZ)) Q:'ZZ!$D(DUOUT)  I +$G(^PS(55,+PSGP,5,ZZ,.2))=PSGX D PDWCHK(+PSGP,ZZ_"U") S PSJDCHK=1
"RTN","PSGSICHK",35,0)
 F STATUSNP="N","P" F Z=0:0 S Z=$O(^PS(53.1,"AS",STATUSNP,+PSGP,Z)) Q:'Z!$D(DUOUT)  I +$G(^PS(53.1,+Z,.2))=PSGX D PDWCHK(+PSGP,Z_"P") S PSJDCHK=1
"RTN","PSGSICHK",36,0)
 I $D(PSJDCHK) N DIR D
"RTN","PSGSICHK",37,0)
 .S DIR(0)="Y",DIR("A")="Do you wish to continue entering this order",DIR("?",1)="Enter ""N"" if you wish to exit without creating a new order,"
"RTN","PSGSICHK",38,0)
 .S DIR("?")="or ""Y"" to continue with the order entry process." D ^DIR S:'Y Y=-1,X="^"
"RTN","PSGSICHK",39,0)
 K Z,ZZ
"RTN","PSGSICHK",40,0)
 Q
"RTN","PSGSICHK",41,0)
 ;
"RTN","PSGSICHK",42,0)
ENDDC(PSGP,PSJDD) ; Perform Duplicate Drug, Duplicate Class,
"RTN","PSGSICHK",43,0)
 ; Drug-Drug interaction check, Drug-Allergy interaction check.
"RTN","PSGSICHK",44,0)
 N PSJLINE,Z,ZZ,PSJFST
"RTN","PSGSICHK",45,0)
 S (PSJLINE,PSJFST)=0
"RTN","PSGSICHK",46,0)
 I $G(PSJPWD)&($P($G(PSJSYSU),";")=3)&($G(PSJDD)) I ($D(^PSI(58.1,"D",PSJDD,PSJPWD)))!($D(^PSD(58.8,"D",PSJDD,PSJPWD))) W !?25,"*** A WARD STOCK ITEM ***"
"RTN","PSGSICHK",47,0)
 D EN^PSOORDRG(PSGP,PSJDD) K PSJPDRG N INTERVEN,PSJIREQ,PSJRXREQ S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)="" S DFN=PSGP
"RTN","PSGSICHK",48,0)
 I $P($G(^XTMP("ORRDI","PSOO",PSGP,0)),"^",3)<0 W !,"Remote data not available - Only local order checks processed." D PAUSE^PSJLMUT1
"RTN","PSGSICHK",49,0)
 I $D(^TMP($J,"DD")) D ORDCHK^PSJLMUT1(PSGP,"DD",4)
"RTN","PSGSICHK",50,0)
 I $D(^TMP($J,"DC")) D ORDCHK^PSJLMUT1(PSGP,"DC",6)
"RTN","PSGSICHK",51,0)
IVSOL ;*** Start order check for IV solution at this point.
"RTN","PSGSICHK",52,0)
 I '$D(PSJFST) N PSJFST S PSJFST=0
"RTN","PSGSICHK",53,0)
 I $D(^TMP($J,"DI")) S INTERVEN=1 D ORDCHK^PSJLMUT1(PSGP,"DI",8)
"RTN","PSGSICHK",54,0)
 ;*** Allergy/adverse reaction check.
"RTN","PSGSICHK",55,0)
 N PTR,X
"RTN","PSGSICHK",56,0)
 S PTR=$P($G(^PSDRUG(PSJDD,"ND")),U)_"."_$P($G(^PSDRUG(PSJDD,"ND")),U,3)
"RTN","PSGSICHK",57,0)
 K ^TMP("PSJDAI",$J) S PSJACK=$$ORCHK^GMRAOR(DFN,"DR",PTR) D:$G(PSJACK)=1
"RTN","PSGSICHK",58,0)
 .S ^TMP("PSJDAI",$J,0)=1
"RTN","PSGSICHK",59,0)
 .S I=0 F  S I=$O(GMRAING(I)) Q:'I  S ^TMP("PSJDAI",$J,I,0)=GMRAING(I)
"RTN","PSGSICHK",60,0)
 I $D(^TMP("PSJDAI",$J)) S PSJPDRG=1 D
"RTN","PSGSICHK",61,0)
 .W $C(7),!!,"A Drug-Allergy Reaction exists for this medication!",!!
"RTN","PSGSICHK",62,0)
 .W !?7,"Drug: "_$P($G(^PSDRUG(PSJDD,0)),"^") I $O(^TMP("PSJDAI",$J)) W !,"Ingredients: " D
"RTN","PSGSICHK",63,0)
 ..S I=0 F  S I=$O(^TMP("PSJDAI",$J,I)) Q:'I  W:$X+$L($G(^(I,0)))+2>IOM !?19 W:I=1 $G(^TMP("PSJDAI",$J,I,0)) W:I>1 ", ",$G(^TMP("PSJDAI",$J,I,0))
"RTN","PSGSICHK",64,0)
 .W !!
"RTN","PSGSICHK",65,0)
 K PSJACK,GMRAING,I,^TMP($J)
"RTN","PSGSICHK",66,0)
 D ALGCLASS
"RTN","PSGSICHK",67,0)
CONT ; Ask user if they wish to continue in spite of an order check.
"RTN","PSGSICHK",68,0)
 Q:'$D(PSJPDRG)  N DIR S DIR(0)="Y",DIR("A")="Do you wish to continue entering this order",DIR("?",1)="Enter ""N"" if you wish to exit without creating a new order,"
"RTN","PSGSICHK",69,0)
 S DIR("?")="or ""Y"" to continue with the order entry process.",DIR("B")="NO" D ^DIR I 'Y S PSGORQF=1,X="^",COMQUIT=1 Q
"RTN","PSGSICHK",70,0)
 I 'INTERVEN!($P(PSJSYSU,";")'=3) Q
"RTN","PSGSICHK",71,0)
 ;I PSJIREQ D ^PSJRXI S:$G(PSJRXI("QFLG")) PSGORQF=1,X=U Q
"RTN","PSGSICHK",72,0)
 NEW PSJY
"RTN","PSGSICHK",73,0)
 W:PSJIREQ !!,"This is a CRITICAL interaction, you must enter an intervention log to continue"
"RTN","PSGSICHK",74,0)
 S DIR(0)="Y",DIR("A")="Do you wish to log an intervention",DIR("?",1)="Enter ""N"" if you do not wish to log an intervention,",DIR("?")="or ""Y"" to log an intervention." D ^DIR S PSJY=Y D:Y ^PSJRXI
"RTN","PSGSICHK",75,0)
 I 'PSJY,PSJIREQ S PSGORQF=1,COMQUIT=1
"RTN","PSGSICHK",76,0)
 ;I 'Y,$P(ND,U,4)="CRITICAL" S PSGORQF=1,X="^"
"RTN","PSGSICHK",77,0)
 Q
"RTN","PSGSICHK",78,0)
 ;
"RTN","PSGSICHK",79,0)
ENDL ; used by PSGTRAIN DRUG LOOK-UP option
"RTN","PSGSICHK",80,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGSICHK",81,0)
 F  S DIC="^PSDRUG(",DIC(0)="AEIMOQZ",DIC("A")="Select DRUG: " W ! D ^DIC K DIC Q:+Y'>0  D SF
"RTN","PSGSICHK",82,0)
 D ENKV^PSGSETU K N5,ND,Q,Y Q
"RTN","PSGSICHK",83,0)
 ;
"RTN","PSGSICHK",84,0)
SF ;
"RTN","PSGSICHK",85,0)
 S Y=+Y,ND=$G(^PSDRUG(Y,0)),PSGID=+$G(^("I")) I PSGID W !!,"THIS DRUG IS INACTIVE AS OF ",$E($$ENDTC^PSGMI(PSGID),1,8)
"RTN","PSGSICHK",86,0)
 W !!,$S($P(ND,"^",9):"NON-",1:""),"FORMULARY ITEM" W:$P(ND,"^",10)]"" !,$P(ND,"^",10)
"RTN","PSGSICHK",87,0)
 S ND=$P($G(^PSDRUG(Y,2)),"^",3)["U" W !,$P("NOT^","^",ND+1)," A UNIT DOSE DRUG" W ! S ND=$G(^(8)),N5=$G(^(8.5)) W !?2,"DAY (nD) or DOSE (nL) LIMIT: " I ND W $P(ND,"^")
"RTN","PSGSICHK",88,0)
 W !?10,"UNIT DOSE MED ROUTE: " I $P(ND,"^",2) W $S($D(^PS(51.2,$P(ND,"^",2),0)):$P(^(0),"^"),1:$P(ND,"^",2))
"RTN","PSGSICHK",89,0)
 ; NAKED REF below refers to ^PS(51.2, on line above.
"RTN","PSGSICHK",90,0)
 W !?6,"UNIT DOSE SCHEDULE TYPE: " I $P(ND,"^",3)]"" W $P($P(";"_$P(^(0),"^",3),";"_$P(ND,"^",3)_":",2),";")
"RTN","PSGSICHK",91,0)
 W !?11,"UNIT DOSE SCHEDULE: " I $P(ND,"^",4)]"" W $P(ND,"^",4)
"RTN","PSGSICHK",92,0)
 W !,"CORRESPONDING OUTPATIENT DRUG: " I $P(ND,"^",5) W $S('$D(^PSDRUG(+$P(ND,"^",5),0)):$P(ND,"^",5),$P(^(0),"^")]"":$P(^(0),"^"),1:$P(ND,"^",5))
"RTN","PSGSICHK",93,0)
 W !?17,"ATC MNEMONIC: " I $P(N5,"^",2)]"" W $P(N5,"^",2)
"RTN","PSGSICHK",94,0)
 ;Q:'$D(^DD(50,212,0))  W !?17,$P(^(0),"^"),": " F Q=0:0 S Q=$O(^PSDRUG(Y,212,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$P(ND,"^",2) W ?31,$S('$D(^PS(57.5,+ND,0)):+ND_";PS(57.5,",$P(^(0),"^")]"":$P(^(0),"^"),1:+ND_";PS(57.5,"),?56,$P(ND,"^",2),!
"RTN","PSGSICHK",95,0)
 W !?17,"ATC CANISTER: " F Q=0:0 S Q=$O(^PSDRUG(Y,212,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$P(ND,"^",2) W ?31,$S('$D(^PS(57.5,+ND,0)):+ND_";PS(57.5,",$P(^(0),"^")]"":$P(^(0),"^"),1:+ND_";PS(57.5,"),?56,$P(ND,"^",2),!
"RTN","PSGSICHK",96,0)
 Q
"RTN","PSGSICHK",97,0)
 ;
"RTN","PSGSICHK",98,0)
OCHK ; Add drugs in current order to ^TMP("ORDERS" and call order checker.
"RTN","PSGSICHK",99,0)
 ; Set PSJOCHK=1 so OP order check doesn't Kill array.
"RTN","PSGSICHK",100,0)
 ;
"RTN","PSGSICHK",101,0)
 K ^TMP($J,"ORDERS")
"RTN","PSGSICHK",102,0)
 N PSJOCHK S PSJOCHK=1
"RTN","PSGSICHK",103,0)
PDWCHK(DFN,ON) ; Print Dup Drug order.
"RTN","PSGSICHK",104,0)
 N ND,ND0,ND2,X
"RTN","PSGSICHK",105,0)
 W:'$D(PSJDCHK) $C(7),$C(7),!!,"WARNING! THIS PATIENT HAS THE FOLLOWING ORDER(S) FOR THIS MEDICATION:",!!
"RTN","PSGSICHK",106,0)
 S ND=$$DRUGNAME^PSJLMUTL(DFN,ON)
"RTN","PSGSICHK",107,0)
 S F=$S(ON["P":"^PS(53.1,",1:"^PS(55,"_DFN_",5,"),ND0=$G(@(F_+ON_",0)")),ND2=$G(^(2)),X=$P(ND,U,2),X=$S(X=.2:$P($G(^(.2)),U,2),1:$G(^(.3)))
"RTN","PSGSICHK",108,0)
 W ?10,$P(ND,U),!,?13,"Give: ",X," ",$$ENMRN^PSGMI(+$P(ND0,U,3))," ",$P(ND2,U),!!
"RTN","PSGSICHK",109,0)
 Q
"RTN","PSGSICHK",110,0)
ALGCLASS ; checks any Drug allergies or reactions to see if
"RTN","PSGSICHK",111,0)
 ;         the new drug is the same class
"RTN","PSGSICHK",112,0)
 ; this call can be removed by commenting out the call on IVSOL+16
"RTN","PSGSICHK",113,0)
 N PSJLIST,CT,CLS,CLCHK,CNT,PSJL,LIST,DCCNT
"RTN","PSGSICHK",114,0)
 S GMRA="0^0^111" D EN1^GMRADPT
"RTN","PSGSICHK",115,0)
 F PSJLIST=0:0 S PSJLIST=$O(GMRAL(PSJLIST)) Q:'PSJLIST  D
"RTN","PSGSICHK",116,0)
 .K PSJAGL D EN1^GMRAOR2(PSJLIST,"PSJAGL")
"RTN","PSGSICHK",117,0)
 .; is the allergy/reaction drug class first four digits the same as the
"RTN","PSGSICHK",118,0)
 .; the class for the drug being entered?
"RTN","PSGSICHK",119,0)
 .S (CT,CLS)="",DCCNT=0
"RTN","PSGSICHK",120,0)
 .I $D(PSJAGL("V")) D
"RTN","PSGSICHK",121,0)
 ..F  S DCCNT=$O(PSJAGL("V",DCCNT)) Q:'DCCNT  S:$E($P($G(PSJAGL("V",DCCNT)),"^"),1,4)=$E($P($G(^PSDRUG(PSJDD,0)),"^",2),1,4) (PSJPDRG,CLCHK)=1,CNT=$S('$D(CNT):1,1:CNT+1),LIST(CNT)=$P($G(PSJAGL),"^")_"^"_$P($G(PSJAGL("V",DCCNT)),"^",2)
"RTN","PSGSICHK",122,0)
 D:$G(CLCHK)
"RTN","PSGSICHK",123,0)
 .W !!,$C(7),"A Drug-Allergy Reaction exists for this medication and/or class!"
"RTN","PSGSICHK",124,0)
 .F PSJL=0:0 S PSJL=$O(LIST(PSJL)) Q:'PSJL  D
"RTN","PSGSICHK",125,0)
 ..W !?6,"Drug: "_$P(LIST(PSJL),"^"),!,"Drug Class: "_$P(LIST(PSJL),"^",2),!
"RTN","PSGSICHK",126,0)
 Q
"RTN","PSIVBCID")
0^4^B6780776
"RTN","PSIVBCID",1,0)
PSIVBCID ;BIR/JLC - BAR CODE ID SUBROUTINES ;16 FEB 01
"RTN","PSIVBCID",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,80,146**;16 DEC 97
"RTN","PSIVBCID",3,0)
 ;
"RTN","PSIVBCID",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSIVBCID",5,0)
 ;
"RTN","PSIVBCID",6,0)
BCMA(PSJDFN,PSJON,PSIVCTD,PSIV1,PSIV2,PSIVNOL) ;determine unique ID# for bar code labels and update initial data for bar code ID
"RTN","PSIVBCID",7,0)
 ;Input:  PSJDFN - patient's DFN
"RTN","PSIVBCID",8,0)
 ;        PSJON - patient's ON - order number
"RTN","PSIVBCID",9,0)
 ;        PSJBCID - bar code ID to be filed
"RTN","PSIVBCID",10,0)
 ;        PSIVCTD - the $D(PSIVCT) from the calling routine, if PSIVCT was defined, then the labels won't be counted
"RTN","PSIVBCID",11,0)
 ;        PSIV1   - current label number
"RTN","PSIVBCID",12,0)
 ;        PSIV2   -
"RTN","PSIVBCID",13,0)
 ;        PSIVNOL - total number of labels
"RTN","PSIVBCID",14,0)
 ;
"RTN","PSIVBCID",15,0)
 ;Output:  PSJBCID - unique ID# for this label
"RTN","PSIVBCID",16,0)
 ;                   format:  DFN_"A"_ON"_seq#
"RTN","PSIVBCID",17,0)
 ;                   If unable to calculate ID #, return "ERROR"
"RTN","PSIVBCID",18,0)
 ;
"RTN","PSIVBCID",19,0)
 S PSIV1=$G(PSIV1),PSIV2=$G(PSIV2),PSIVNOL=$G(PSIVNOL)
"RTN","PSIVBCID",20,0)
 L +^PS(55,PSJDFN,"IVBCMA"):10
"RTN","PSIVBCID",21,0)
 E  W "Waiting for lock..." F  L +^PS(55,PSJDFN,"IVBCMA"):5 Q:$T  W "."
"RTN","PSIVBCID",22,0)
 S SEQ=$O(^PS(55,PSJDFN,"IVBCMA"," "),-1)
"RTN","PSIVBCID",23,0)
 S PSJBCID=PSJDFN_"V"_(SEQ+1)
"RTN","PSIVBCID",24,0)
 D UP1^PSIVBCID(DFN,ON,PSJBCID,PSIVCTD,PSIV1,PSIV2,PSIVNOL)
"RTN","PSIVBCID",25,0)
 L -^PS(55,PSJDFN,"IVBCMA")
"RTN","PSIVBCID",26,0)
 Q PSJBCID
"RTN","PSIVBCID",27,0)
 ;
"RTN","PSIVBCID",28,0)
UP1(DFN,ON,PSJBCID,PSIVCTD,PSIV1,PSIV2,PSIVNOL) ;update initial data for bar code ID
"RTN","PSIVBCID",29,0)
 ;Input:  DFN     - patient's IEN
"RTN","PSIVBCID",30,0)
 ;        ON      - Order number for this bar code ID
"RTN","PSIVBCID",31,0)
 ;        PSJBCID - bar code ID to be filed
"RTN","PSIVBCID",32,0)
 ;        PSIVCTD - the $D(PSIVCT) from the calling routine, if PSIVCT was defined, then the labels won't be counted
"RTN","PSIVBCID",33,0)
 ;        PSIV1   - current label number
"RTN","PSIVBCID",34,0)
 ;        PSIV2   -
"RTN","PSIVBCID",35,0)
 ;        PSIVNOL - total number of labels
"RTN","PSIVBCID",36,0)
 ;
"RTN","PSIVBCID",37,0)
 ;Output:  PSJBLN - label sequence number
"RTN","PSIVBCID",38,0)
 ;
"RTN","PSIVBCID",39,0)
 S PSIV1=$G(PSIV1),PSIV2=$G(PSIV2),PSIVNOL=$G(PSIVNOL)
"RTN","PSIVBCID",40,0)
 K DIC,DIE,DO S DIC(0)="L",DA(1)=DFN,X=PSJBCID,DIC="^PS(55,"_DA(1)_",""IVBCMA""," D FILE^DICN
"RTN","PSIVBCID",41,0)
 K DA,DR,DIE S DIE=DIC,DA=+Y,DA(1)=DFN,PSJBLN=DA D NOW^%DTC
"RTN","PSIVBCID",42,0)
 S DR=".02////"_+ON_";3////"_$S(PSIVCTD:0,1:1)_";4////"_$E(%,1,12)_";6////"_PSIV1_"["_$S(PSIV1:PSIVNOL,1:PSIV2)_"]" D ^DIE
"RTN","PSIVBCID",43,0)
 K DIC,DIE,D0,DA,DR
"RTN","PSIVBCID",44,0)
 Q
"RTN","PSIVBCID",45,0)
UP2(DFN,PSJBLN,PSIV,YY) ;update additive data for bar code ID
"RTN","PSIVBCID",46,0)
 ;
"RTN","PSIVBCID",47,0)
 ;Input:  DFN    - Patient's IEN
"RTN","PSIVBCID",48,0)
 ;        PSJBLN - The IEN for the bar code ID
"RTN","PSIVBCID",49,0)
 ;        PSIV   - the sequence number for this additive
"RTN","PSIVBCID",50,0)
 ;        YY     - ADDITIVE ^ STRENGTH ^ BOTTLE
"RTN","PSIVBCID",51,0)
 ;
"RTN","PSIVBCID",52,0)
 K DA,DR,DIC,DO S DIC(0)="L",DA(1)=DFN,DA(2)=PSJBLN,X=PSIV,DIC="^PS(55,"_DA(1)_",""IVBCMA"","_DA(2)_",""AD""," D FILE^DICN
"RTN","PSIVBCID",53,0)
 K DA,DR,DIE S DIE=DIC,DA=+Y,DA(1)=PSJBLN,DA(2)=DFN S DR=".01////"_$P(YY,U)_";1////"_$P(YY,U,2)_";2////"_$P(YY,U,3) D ^DIE
"RTN","PSIVBCID",54,0)
 K DA,DR,DIC,D0,DIE
"RTN","PSIVBCID",55,0)
 Q
"RTN","PSIVBCID",56,0)
 ;
"RTN","PSIVBCID",57,0)
UP3(DFN,PSJBLN,PSIV,YY) ;update solution data for bar code ID
"RTN","PSIVBCID",58,0)
 ;
"RTN","PSIVBCID",59,0)
 ;Input:  DFN    - Patient's IEN
"RTN","PSIVBCID",60,0)
 ;        PSJBLN - The IEN for the bar code ID
"RTN","PSIVBCID",61,0)
 ;        PSIV   - the sequence number for this solution
"RTN","PSIVBCID",62,0)
 ;        YY     - SOLUTION ^ VOLUME
"RTN","PSIVBCID",63,0)
 ;
"RTN","PSIVBCID",64,0)
 K DA,DR,DIC,DO S DIC(0)="L",DA(1)=DFN,DA(2)=PSJBLN,X=$P(PSIV,U),DIC="^PS(55,"_DA(1)_",""IVBCMA"","_DA(2)_",""SOL""," D FILE^DICN
"RTN","PSIVBCID",65,0)
 K DA,DR,DIE S DIE=DIC,DA=+Y,DA(1)=PSJBLN,DA(2)=DFN S DR=".01////"_$P(YY,U)_";1////"_$P(YY,U,2) D ^DIE
"RTN","PSIVBCID",66,0)
 K DA,DR,DIC,D0,DIE
"RTN","PSIVBCID",67,0)
 Q
"RTN","PSJLMUT1")
0^1^B65316144
"RTN","PSJLMUT1",1,0)
PSJLMUT1 ;BIR/MLM-DRUG NAME DISPLAY ;05 Feb 98 / 1:39 PM
"RTN","PSJLMUT1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,27,29,49,58,107,110,146**;16 DEC 97
"RTN","PSJLMUT1",3,0)
 ;
"RTN","PSJLMUT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJLMUT1",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJLMUT1",6,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJLMUT1",7,0)
 ; Reference to EN^PSODRDU2 is supported by DBIA# 2189.
"RTN","PSJLMUT1",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJLMUT1",9,0)
 ;
"RTN","PSJLMUT1",10,0)
DRGDISP(DFN,ON,NL,GL,NAME,DRUGONLY)       ;
"RTN","PSJLMUT1",11,0)
 ;; DRUGONLY = 1/0 - Only the drug name will be returned.
"RTN","PSJLMUT1",12,0)
 ;; NL       = The drug name display length
"RTN","PSJLMUT1",13,0)
 ;; GL       = The give line display length, total length-6 ("Give: ")
"RTN","PSJLMUT1",14,0)
 ;; NAME(X)  = Drug name and give line in displayable format.
"RTN","PSJLMUT1",15,0)
 ;; ON       = IEN#_U/P (U=Unit Dose; P=Pending)
"RTN","PSJLMUT1",16,0)
 ;
"RTN","PSJLMUT1",17,0)
 NEW F,OIND,MARX,MR,NOTGV,SCH,PSGUPDDO,PSGGV,X,PSGX,PSGINS,DRUGNAME
"RTN","PSJLMUT1",18,0)
 K NAME S PSGINS=""
"RTN","PSJLMUT1",19,0)
 S:ON["U" F="^PS(55,DFN,5,+ON,"
"RTN","PSJLMUT1",20,0)
 I ON["P" S F="^PS(53.1,+ON,",X=$G(@(F_".3)")),PSGINS=$S(X]"":X,1:"")
"RTN","PSJLMUT1",21,0)
 I $G(@(F_"0)"))="" S NAME(1)="NOT FOUND" Q
"RTN","PSJLMUT1",22,0)
 S OIND=$G(@(F_".2)")),PSGUPDDO=$P(OIND,U,2),X=@(F_"0)"),NOTGV=$P(X,U,22),MR=$$ENMRN^PSGMI(+$P(X,U,3))
"RTN","PSJLMUT1",23,0)
 I '+OIND,($P(X,U,4)'="U") NEW DRG D GTDRG^PSIVORFA F X="AD","SOL" Q:+OIND  F PSGX=0:0 S PSGX=$O(DRG(X,PSGX)) Q:'PSGX  S OIND=$P(DRG(X,PSGX),U,6) Q:+OIND
"RTN","PSJLMUT1",24,0)
 S SCH=$P($G(@(F_"2)")),U)
"RTN","PSJLMUT1",25,0)
 I +$O(@(F_"1,0)")),'+$O(@(F_"1,1)")),PSGUPDDO="" D DD(F,.DRUGNAME)
"RTN","PSJLMUT1",26,0)
 S:($G(DRUGNAME)=""!($G(DRUGNAME)["NOT FOUND")) DRUGNAME=$$OIDF(OIND)
"RTN","PSJLMUT1",27,0)
 ;S PSGGV=$S(NOTGV:"*** NOT TO BE GIVEN *** ",1:"")_PSGINS_PSGUPDDO_" "_MR_" "_SCH
"RTN","PSJLMUT1",28,0)
 S PSGGV=$S(NOTGV:"*** NOT TO BE GIVEN *** ",1:"")_$S(('$D(PSJPDDDP)&('$L(PSGUPDDO))):PSGINS,1:PSGUPDDO)_" "_MR_" "_SCH
"RTN","PSJLMUT1",29,0)
 S PSGX=0 K PSJPDDDP
"RTN","PSJLMUT1",30,0)
 D TXT^PSGMUTL(DRUGNAME,NL) F X=0:0 S X=$O(MARX(X)) Q:'X  S NAME(X)=$S(X>1:"  ",1:"")_MARX(X),PSGX=X
"RTN","PSJLMUT1",31,0)
 Q:+DRUGONLY
"RTN","PSJLMUT1",32,0)
 D TXT^PSGMUTL(PSGGV,GL) F X=0:0 S X=$O(MARX(X)) Q:'X  D
"RTN","PSJLMUT1",33,0)
 . I X=1 S NAME(PSGX+X)="Give: "_MARX(X) Q
"RTN","PSJLMUT1",34,0)
 . S NAME(PSGX+X)=$S(X>1:"      ",1:"")_MARX(X)
"RTN","PSJLMUT1",35,0)
 Q
"RTN","PSJLMUT1",36,0)
OIDF(OIND)    ; Return Orderable Item name and Dosage form.
"RTN","PSJLMUT1",37,0)
 ;; +OIND = orderable item IEN
"RTN","PSJLMUT1",38,0)
 NEW X,NAME
"RTN","PSJLMUT1",39,0)
 S X=$G(^PS(50.7,+OIND,0))
"RTN","PSJLMUT1",40,0)
 S:$P(X,U)]"" NAME=$P(X,U)_" "_$P($G(^PS(50.606,+$P(X,U,2),0)),U)
"RTN","PSJLMUT1",41,0)
 Q $S($G(NAME)]"":NAME,1:"NOT FOUND "_+OIND_";PS(50.7")
"RTN","PSJLMUT1",42,0)
 ;
"RTN","PSJLMUT1",43,0)
DD(F,NAME)        ; Return Dispense drug name.
"RTN","PSJLMUT1",44,0)
 ;; F = "^PS(55,DFN,5,+ON," or "^PS(53.1,+ON,"
"RTN","PSJLMUT1",45,0)
 NEW X K NAME
"RTN","PSJLMUT1",46,0)
 S X=$O(@(F_"1,0)")),X=$G(@(F_"1,"_+X_",0)"))
"RTN","PSJLMUT1",47,0)
 I $P(X,U)]"" S NAME=$P($G(^PSDRUG(+X,0)),U)
"RTN","PSJLMUT1",48,0)
 E  S NAME="NOT FOUND "_+X_";PSDRUG"
"RTN","PSJLMUT1",49,0)
 I '$O(@(F_"1,1)")),+$P(X,U,2)>1 S PSGUPDDO=+$P(X,U,2)
"RTN","PSJLMUT1",50,0)
 S PSJPDDDP=1
"RTN","PSJLMUT1",51,0)
 Q
"RTN","PSJLMUT1",52,0)
DSPLORDU(PSGP,ON)   ; Display UD order for order check as in the Inpat Profile.
"RTN","PSJLMUT1",53,0)
 NEW DRUGNAME,F,NODE0,NODE2,PSJID,PSJX,SCH,SD,STAT,X,Y
"RTN","PSJLMUT1",54,0)
 S F=$S(ON["U":"^PS(55,PSGP,5,"_+ON_",",1:"^PS(53.1,"_+ON_",")
"RTN","PSJLMUT1",55,0)
 S NODE0=$G(@(F_"0)")),NODE2=$G(@(F_"2)"))
"RTN","PSJLMUT1",56,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJLMUT1",57,0)
 I ON["P",$P(NODE0,U,4)="F" D DSPLORDV(PSGP,ON) Q
"RTN","PSJLMUT1",58,0)
 S SCH=$P(NODE0,U,7)
"RTN","PSJLMUT1",59,0)
 S STAT=$P(NODE0,U,9) I STAT="A",$P(NODE0,U,27)="R" S STAT="R"
"RTN","PSJLMUT1",60,0)
 I STAT'="P" S PSJID=$E($$ENDTC^PSGMI($P(NODE2,U,2)),1,5),SD=$E($$ENDTC^PSGMI($P(NODE2,U,4)),1,5)
"RTN","PSJLMUT1",61,0)
 I STAT="P" S (PSJID,SD)="*****",SCH="?"
"RTN","PSJLMUT1",62,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJLMUT1",63,0)
 . S:PSJX=1 X=SCH_"  "_PSJID_"  "_SD_"  "_$E(STAT,1)
"RTN","PSJLMUT1",64,0)
 . S:PSJX=1 DRUGNAME(1)=$$SETSTR^VALM1(X,$E(DRUGNAME(1),1,40),42,20)
"RTN","PSJLMUT1",65,0)
 . S PSJOC(ON,PSJLINE)="        "_DRUGNAME(PSJX)
"RTN","PSJLMUT1",66,0)
 . S PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",67,0)
 Q
"RTN","PSJLMUT1",68,0)
DSPLORDV(DFN,ON)   ; Display IV order for order check as in the Inpat Profile.
"RTN","PSJLMUT1",69,0)
 N DRG,DRGI,DRGT,DRGX,FIL,ND,ON55,P,PSJIVFLG,PSJORIFN,TYP,X,Y
"RTN","PSJLMUT1",70,0)
 S TYP="?" I ON["V" D
"RTN","PSJLMUT1",71,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSJLMUT1",72,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJLMUT1",73,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJLMUT1",74,0)
 S PSJCT=0,PSJL=""
"RTN","PSJLMUT1",75,0)
 I ON'["V" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJLMUT1",76,0)
 S PSJIVFLG=1 D PIVAD,SOL
"RTN","PSJLMUT1",77,0)
 Q
"RTN","PSJLMUT1",78,0)
SOL ;
"RTN","PSJLMUT1",79,0)
 S PSJL=$S($G(PSJIVFLG):PSJL,1:"")_"        in"
"RTN","PSJLMUT1",80,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP S PSJL="      "
"RTN","PSJLMUT1",81,0)
 Q
"RTN","PSJLMUT1",82,0)
PIVAD ; Print IV Additives.
"RTN","PSJLMUT1",83,0)
 F DRG=0:0 S DRG=$O(DRG("AD",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1) F DRGX=0:0 S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP
"RTN","PSJLMUT1",84,0)
 Q
"RTN","PSJLMUT1",85,0)
 ;
"RTN","PSJLMUT1",86,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJLMUT1",87,0)
 K PSJIVFLG
"RTN","PSJLMUT1",88,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJLMUT1",89,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,67,1)
"RTN","PSJLMUT1",90,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,73,1)
"RTN","PSJLMUT1",91,0)
 Q
"RTN","PSJLMUT1",92,0)
SETTMP ;
"RTN","PSJLMUT1",93,0)
 S PSJOC(ON,PSJLINE)=PSJL,PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",94,0)
 Q
"RTN","PSJLMUT1",95,0)
ORDCHK(DFN,TYPE,PIECE)   ;
"RTN","PSJLMUT1",96,0)
 ;TYPE ="DD" - Duplicate drug
"RTN","PSJLMUT1",97,0)
 ;     ="DC" - Duplicate class
"RTN","PSJLMUT1",98,0)
 ;     -"DI" - Drug Interaction
"RTN","PSJLMUT1",99,0)
 ;PIECE = The piece order number is return from ^TMP($J,"DD"...
"RTN","PSJLMUT1",100,0)
 ;PSJOC(ON,x) = Array of inpatient orders to be displayed
"RTN","PSJLMUT1",101,0)
 ;
"RTN","PSJLMUT1",102,0)
 NEW ON,PSJL,PSIVX,PSJOC,PSJORIEN,PSJPACK,PSJLINE
"RTN","PSJLMUT1",103,0)
 S PSJOC=0,PSJLINE=1
"RTN","PSJLMUT1",104,0)
 F PSIVX=0:0 S PSIVX=$O(^TMP($J,TYPE,PSIVX)) Q:'PSIVX  D
"RTN","PSJLMUT1",105,0)
 . S PSJPACK=$P(^TMP($J,TYPE,PSIVX,0),U,PIECE)
"RTN","PSJLMUT1",106,0)
 . I $G(PSGORD) S PSJORD=PSGORD ; Set PSJORD if PSGORD exists and is not Null
"RTN","PSJLMUT1",107,0)
 . I $G(PSJORD)]"" I $S($D(PSJORD):$G(PSJORD),1:$G(PSGORD))'["V",$P(PSJPACK,";")=$S($D(PSJORD):$G(PSJORD),1:$G(PSGORD)) Q  ; don't flag order that is being renewed as duplicate, only checks Unit Dose orders
"RTN","PSJLMUT1",108,0)
 . I $G(PSJCOM),($G(PSJORD)["P") Q:$D(^PS(53.1,"ACX",PSJCOM,+PSJPACK))
"RTN","PSJLMUT1",109,0)
 . ; Don't flag if pending renewal from CPRS
"RTN","PSJLMUT1",110,0)
 . I $G(PSJORD)]"",(PSJORD["P"),($P($G(^PS(53.1,+PSJORD,0)),"^",24)="R"),($P(PSJPACK,";")["U"),($P($G(^PS(55,DFN,5,+$P(PSJPACK,";"),0)),"^",27)="R"),($P($G(^PS(55,DFN,5,+$P(PSJPACK,";"),0)),"^",26)=PSJORD) Q
"RTN","PSJLMUT1",111,0)
 . I $G(PSIVRNFG),$G(ON55)["V",$P(PSJPACK,";")=$G(ON55) Q  ;PSIVRNFG set and kill in R+2^PSIVOPT2. Needed to do dupl. check on new order but not renew.
"RTN","PSJLMUT1",112,0)
 . S PSJORIEN=$P(^TMP($J,TYPE,PSIVX,0),U,PIECE-1)
"RTN","PSJLMUT1",113,0)
 . I TYPE="DI",($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL") S PSJIREQ=1
"RTN","PSJLMUT1",114,0)
 . ; Adding Drug Interactions check for use in Intervention defaults in PSJRXI.
"RTN","PSJLMUT1",115,0)
 . I TYPE="DI" S PSJRXREQ=$S($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL":1,1:2)
"RTN","PSJLMUT1",116,0)
 . ;I $P(PSJPACK,";",2)["O" D  Q
"RTN","PSJLMUT1",117,0)
 . N X S X=$P(PSJPACK,";",2) I X["O" D  Q
"RTN","PSJLMUT1",118,0)
 ..  D:PSJFST=1 PAUSE
"RTN","PSJLMUT1",119,0)
 ..  W !!,"The patient has this "_$S($P(PSJPACK,";")["N":"Non-VA Meds",$P(PSJPACK,";",2)["O":"Outpatient",1:"")_" order:",!
"RTN","PSJLMUT1",120,0)
 ..  I $D(^TMP($J,TYPE,PSIVX,1)) D SHOR^PSJLMUT2(TYPE,PSIVX),PAUSE S PSJFST=$S(PSJFST=0:PSJFST+2,1:PSJFST+1) Q
"RTN","PSJLMUT1",121,0)
 ..  D EN^PSODRDU2(DFN,PSJPACK),PAUSE S PSJPDRG=1,PSJFST=$S(PSJFST=0:PSJFST+2,1:PSJFST+1)
"RTN","PSJLMUT1",122,0)
 . S ON=$P(PSJPACK,";") Q:$D(PSJOC(ON))
"RTN","PSJLMUT1",123,0)
 . I ON=$G(PSIVOCON),+PSJORIEN Q
"RTN","PSJLMUT1",124,0)
 . I ON=$G(PSIVOCON),'+PSJORIEN D SETPSJOC Q
"RTN","PSJLMUT1",125,0)
 . ;S PSJOC=PSJOC+1,PSJPDRG=1 D:PSJOC=1 WRITE(TYPE)
"RTN","PSJLMUT1",126,0)
 . I ON["V" D
"RTN","PSJLMUT1",127,0)
 .. I '$O(^PS(55,DFN,"IV",+ON,0)) D SETPSJOC Q
"RTN","PSJLMUT1",128,0)
 .. D DSPLORDV(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLMUT1",129,0)
 . I ON'["V" D DSPLORDU(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLMUT1",130,0)
 . S PSJOC(ON,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",131,0)
 D:PSJOC WRITE(TYPE)
"RTN","PSJLMUT1",132,0)
 S ON="" F  S ON=$O(PSJOC(ON)) Q:ON=""  W ! S PSJLINE=PSJLINE+1,PSJFST=PSJFST+1 D
"RTN","PSJLMUT1",133,0)
 . F PSIVX=0:0 S PSIVX=$O(PSJOC(ON,PSIVX)) Q:'PSIVX  W !,PSJOC(ON,PSIVX) S PSJLINE=PSJLINE+1 D:'(PSIVX#6) PAUSE
"RTN","PSJLMUT1",134,0)
 W !
"RTN","PSJLMUT1",135,0)
 Q
"RTN","PSJLMUT1",136,0)
SETPSJOC ;Set PSJOC array to be displayed later
"RTN","PSJLMUT1",137,0)
 NEW PIECE S PIECE=$S(TYPE="DC":4,1:2)
"RTN","PSJLMUT1",138,0)
 S X=$$SETSTR^VALM1($P(^TMP($J,TYPE,PSIVX,0),U,PIECE),"",9,40)
"RTN","PSJLMUT1",139,0)
 S X=$$SETSTR^VALM1("* EXISTS IN CURRENT ORDER *",X,50,27)
"RTN","PSJLMUT1",140,0)
 S PSJOC(ON,PSJLINE)=X,PSJLINE=PSJLINE+1,PSJOC=PSJOC+1
"RTN","PSJLMUT1",141,0)
 Q
"RTN","PSJLMUT1",142,0)
WRITE(TYPE)        ;Display order check description
"RTN","PSJLMUT1",143,0)
 S PSJPDRG=1
"RTN","PSJLMUT1",144,0)
 I TYPE="DD" W !!,"This patient is already receiving the following order",$S(PSJOC>1:"s",1:"")," for ",$S($G(PSJDD)]"":$P($G(^PSDRUG(PSJDD,0)),U),1:"this drug"),":",!
"RTN","PSJLMUT1",145,0)
 I TYPE="DC" W !!,"This patient is already receiving ",$S(PSJOC>1:"orders",1:"an order")," for the following drug",$S(PSJOC>1:"s",1:"")," in the same",!,"class as ",$S($G(PSJDD)]"":$P($G(^PSDRUG(PSJDD,0)),U),1:"the drug selected"),":",!
"RTN","PSJLMUT1",146,0)
 I TYPE="DI" W !!,"This patient is receiving the following medication",$S(PSJOC>1:"s",1:"")," that ha",$S(PSJOC>1:"ve",1:"s")," an interaction",!,"with ",$P($G(^PSDRUG(PSJDD,0)),U),":",!
"RTN","PSJLMUT1",147,0)
 Q
"RTN","PSJLMUT1",148,0)
PAUSE ;
"RTN","PSJLMUT1",149,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSJLMUT1",150,0)
 Q
"RTN","PSJLMUT2")
0^2^B6130551
"RTN","PSJLMUT2",1,0)
PSJLMUT2 ;BIR/JLC-DISPLAY UTILITIES ;22 Jun 05
"RTN","PSJLMUT2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**146**;16 DEC 97
"RTN","PSJLMUT2",3,0)
 ;
"RTN","PSJLMUT2",4,0)
SHOR(PSJT,PSJI)       ;Display outpatient remote order checks.
"RTN","PSJLMUT2",5,0)
 ;; PSJT = Type of order check in ^TMP
"RTN","PSJLMUT2",6,0)
 ;; PSJI = Index to ^TMP to find order check detail
"RTN","PSJLMUT2",7,0)
 ;
"RTN","PSJLMUT2",8,0)
 N PSJD0,PSJD1,PSJRX,PSJRS,FSIG,PSJULN,PSJLF,PSJDN
"RTN","PSJLMUT2",9,0)
 S PSJD0=^TMP($J,PSJT,PSJI,0),PSJD1=^(1)
"RTN","PSJLMUT2",10,0)
 I PSJT="DD" S PSJRX=$P($P(PSJD0,"^",4),";"),PSJRS=$P(PSJD0,"^",5),PSJDN=$P(PSJD0,"^",2)
"RTN","PSJLMUT2",11,0)
 I PSJT="DC" S PSJRX=$P($P(PSJD0,"^",6),";"),PSJRS=$P(PSJD0,"^",7),PSJDN=$P(PSJD0,"^",4)
"RTN","PSJLMUT2",12,0)
 I PSJT="DI" S PSJRX=$P($P(PSJD0,"^",8),";"),PSJRS=$P(PSJD0,"^",9),PSJDN=$P(PSJD0,"^",2)
"RTN","PSJLMUT2",13,0)
 S PSJLF=$P(PSJD1,"^",3),$P(PSJULN,"-",79)=""
"RTN","PSJLMUT2",14,0)
 W !,PSJULN,!
"RTN","PSJLMUT2",15,0)
 W PSJRS I $L(PSJRS)>13 W !
"RTN","PSJLMUT2",16,0)
 W ?14,"Rx #: ",$E(PSJRX,1,$L(PSJRX)-1) I $A($L(PSJRX))<54 W $E(PSJRX,$L(PSJRX))
"RTN","PSJLMUT2",17,0)
 W ?39,PSJDN,! I PSJT="DI" W ?39,$P(PSJD0,"^",4)," INTERACTION",!
"RTN","PSJLMUT2",18,0)
 W $J("Status: ",20),$P(PSJD1,"^",2),?40,$J("Issued: ",20),$P(PSJD1,"^",9)
"RTN","PSJLMUT2",19,0)
 D FSIG(.FSIG)
"RTN","PSJLMUT2",20,0)
 W !,$J("SIG: ",20) F I=1:1 Q:'$D(FSIG(I))  W ?20,FSIG(I),!
"RTN","PSJLMUT2",21,0)
 W $J("QTY: ",20)_$P(PSJD1,"^",5)
"RTN","PSJLMUT2",22,0)
 W !,$J("Provider: ",20),$P(PSJD1,"^",8),?40,$J("Refills remaining: ",20),$P(PSJD1,"^",6)
"RTN","PSJLMUT2",23,0)
 W !?40,$J("Last filled on: ",20),PSJLF
"RTN","PSJLMUT2",24,0)
 W !?40,$J("Days Supply: ",20)_$P(PSJD1,"^",4)
"RTN","PSJLMUT2",25,0)
 W !,PSJULN
"RTN","PSJLMUT2",26,0)
 Q
"RTN","PSJLMUT2",27,0)
FSIG(FSIG) ;Format sig from remote site
"RTN","PSJLMUT2",28,0)
 ;returned in the FSIG array
"RTN","PSJLMUT2",29,0)
 N FFF,NNN,CNT,FVAR,FVAR1,FLIM,HSIG,II,I
"RTN","PSJLMUT2",30,0)
 F I=0:1 Q:'$D(^TMP($J,PSJT,PSJI,1,I))  S HSIG(I+1)=^(I)
"RTN","PSJLMUT2",31,0)
FSTART S (FVAR,FVAR1)="",II=1
"RTN","PSJLMUT2",32,0)
 F FFF=0:0 S FFF=$O(HSIG(FFF)) Q:'FFF  S CNT=0 F NNN=1:1:$L(HSIG(FFF)) I $E(HSIG(FFF),NNN)=" "!($L(HSIG(FFF))=NNN) S CNT=CNT+1 D  I $L(FVAR)>52 S FSIG(II)=FLIM_" ",II=II+1,FVAR=FVAR1
"RTN","PSJLMUT2",33,0)
 .S FVAR1=$P(HSIG(FFF)," ",(CNT))
"RTN","PSJLMUT2",34,0)
 .S FLIM=FVAR
"RTN","PSJLMUT2",35,0)
 .S FVAR=$S(FVAR="":FVAR1,1:FVAR_" "_FVAR1)
"RTN","PSJLMUT2",36,0)
 I $G(FVAR)'="" S FSIG(II)=FVAR
"RTN","PSJLMUT2",37,0)
 I $G(FSIG(1))=""!($G(FSIG(1))=" ") S FSIG(1)=$G(FSIG(2)) K FSIG(2)
"RTN","PSJLMUT2",38,0)
FQUIT Q
"RTN","PSJLMUT2",39,0)
PAUSE ;
"RTN","PSJLMUT2",40,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSJLMUT2",41,0)
 Q
"VER")
8.0^22.0
"BLD",5316,6)
^140
**END**
**END**
