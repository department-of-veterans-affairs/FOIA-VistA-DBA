 
=============================================================================
Run Date: FEB 21, 2007                     Designation: DG*5.3*725
Package : DG - REGISTRATION                   Priority: Mandatory
Version : 5.3       SEQ #656                    Status: Released
                  Compliance Date: MAR 24, 2007
=============================================================================

Associated patches: (v)DG*5.3*485  <<= must be installed BEFORE `DG*5.3*725'
                    (v)DG*5.3*538  <<= must be installed BEFORE `DG*5.3*725'
                    (v)DG*5.3*568  <<= must be installed BEFORE `DG*5.3*725'
                    (v)DG*5.3*585  <<= must be installed BEFORE `DG*5.3*725'
                    (v)DG*5.3*598  <<= must be installed BEFORE `DG*5.3*725'

Subject: SD ENCAPSULATION

Category: 
  - Routine
  - Enhancement (Mandatory)

Description:
============

 This patch will allow the implementation of the Scheduling Encapsulation
 Update project in order to meet the needs of the Scheduling Replacement
 Team.  
  
                          I M P O R T A N T 
  *************************************************************************
  This Registration patch, DG*5.3*725, along with Enrollment Application
  System EAS*1.0*77 and Beneficiary Travel patch DGBT*1.0*13, is being
  released in a single KIDS software distribution, host file 
  DG_53_P725.KID. This patch description includes only the informational
  portion of DG*5.3*725.
  
  Please refer to the "Software Retrieval" and  "Installation Instructions"
  sections of this patch description for instructions on how to acquire,
  install, and implement the patch software.
  *************************************************************************
  
 In the Fall of 2004, the Scheduling Replacement Team released the
 Scheduling API to retrieve appointment data. In December, 2004, the
 Enrollment Maintenance Team released software implementing the API into
 the Registration, Beneficiary Travel, Enrollment Application System, and
 Income Verification Match software packages. Recent modifications to the
 Scheduling API have necessitated further modifications to the software.
  
 The Scheduling Encapsulation Update project will require modifications
 in the VistA environment only, with the scope of these modifications
 encompassing the following activities:
  
 - Deleting data that may not have been cleared from temporary global
    workspace
 - Minor changes to Appointment Status filter to return wanted values only
 - Minor changes to Appointment Type parameter passing to return wanted 
    values only
 - Database error not displaying when the Replacement Scheduling 
    Application (RSA) database is down
 - Implement RSA database performance suggestions in several routines
 - Enhance error message handling to include all three Error Messages 101, 
    115 and 117 (see #5 below).
  
 This patch includes the following changes to the stated routines:
  
  
 1.  Update Appointment Status Filter to Return Wanted Values Only:
 ------------------------------------------------------------------ 
 Routine VAFHUTL requires modifications to correctly identify
 records based on their appointment status.  The appointment status
 returned from the Scheduling API (SDAPI) will never be null, but the
 code in this routine is looking for it. Routine VAFHUTL has been
 modified to check a value of "R" which maps to the previous API 
 return value of NULL when the scheduling API is called.
  
 In routines DGENRPD2 and DGMTOFA, the code is excluding records based on
 unwanted appointment status values. Valid appointment statuses returned
 from SDAPI are:  NT, NS, NSR, CC, CCR, CP, CPR, and I. The values returned
 from Scheduling API do not match the list of excluded values. Routines
 DGENRPD2 and DGMTOFA have been modified to include the records with the
 wanted (valid) appointment statuses returned from the Scheduling API.
  
 2.  Correct Database Error Display/Handling Issues When RSA Database Is
 Down:                                                                
 ----------------------------------------------------------------------- 
 When the Appointment API returns an error message, certain routines ignore
 the error message and continue their processing as if there were no
 appointments for the veterans. Routines DGDEATH, DGMTOFA, DGQESC2,
 DGENRPT2, DGENRPT5, DGYPSDE2 and VAUTOMA have been modified to check for
 error handling and stop processing if an error has been encountered.
  
 A function call has been added to routine DGENRPT2 to evaluate error
 messages if they occur.
  
 3.  Implement RSA Database Performance Enhancements:
 ----------------------------------------------------------------------
 Routine DGDEATH has been modified to filter appointment statuses that
 haven't been cancelled or no-showed, by setting the status filter to "I;R"
 before calling the Scheduling API. Routine DGRP14 has been modified to
 eliminate a direct global reference to the "S" node in the PATIENT File
 #2.  The code calling the Scheduling API has been updated to include the
 STATUS (#3) field of the APPOINTMENT (#2.98) subfile of the PATIENT (#2)
 file with the field data being returned from the RSA Database.
  
 4.  Update Routines to Use Scheduling API:
 ----------------------------------------------------------------------- 
 Routine DGFFPLM has been modified to use the Scheduling API to return the
 patient's appointment information from the RSA Database.
  
 5.  Enhance Error Message Handling to Include All Three Messages:
 ----------------------------------------------------------------------- 
 The Scheduling API has been enhanced to include two additional error
 messages, Error 115 and Error 117, to help the users diagnose issues with
 the Appointment (RSA) Database. Routines DGDEATH, DGQPTQ2, DGENRPD2,
 DGRP14, DGENRPT2, VAFHCOPT and VAFCCOPT have been modified to check for
 the following errors:
  
 Error 101: 
 The Appointment Database is not currently available.  
 Please try again later.
  
 Error 115: 
 Appointment request contains invalid values.  
 Please contact National Help Desk. 
  
 Error 117: 
 An error has occurred, check the RSA Error Log.
  
  
 This patch addresses the following New Service Request (NSR):
 -------------------------------------------------------------
 There is no NSR associated with this patch.
  
  
 This patch addresses the following NOIS/Remedy Tickets:
 ---------------------------------------------------------
 There are no NOIS/Remedy tickets for this patch.
  
  
 Test Sites
 ----------
 WILKES BARRE, PA (Medium)
 SALEM, VA (Medium)
 EASTERN COLORADO HCS (Integrated)
  
  
 Components Sent With Patch
 --------------------------
 ROUTINES: DGDEATH
           DGENRPD2
           DGENRPT2
           DGENRPT5
           DGFFPLM
           DGMTOFA
           DGQESC2
           DGQPTQ2
           DGRP14
           DGRRLU0
           DGYPSDE2
           VAFCCCAP
           VAFCCOPT
           VAFHCCAP
           VAFHCOPT
           VAFHUTL
  
  
  ROUTINE SUMMARY:
  ================
  The following is a list of the routines included in this patch.  The
  second line of each of these routines will look like:
  
      <tab>;;5.3;Registration;**[patch list]**;Aug 13, 1993
  
                              CHECK^XTSUMBLD results
  Routine       Before Patch   After Patch              Patch List
  =======       ============   ===========              ==========
  DGDEATH           13498173      13771966           45,84,101,149,392
                                                    545,595,568,563,725
  DGENRPD2           8208655       9677122          147,232,568,585,725
  DGENRPT2          10116831      10046533          232,306,417,456,491
                                                        513,568,725
  DGENRPT5           1864873       2853782                568,725
  DGFFPLM            1026886       2369648                485,725
  DGMTOFA            9559866       9638770           3,50,182,326,426
                                                          568,725
  DGQESC2            5672073       5734621              73,568,725
  DGQPTQ2           12327520      12327597              447,598,725
  DGRP14             3632662       2127153              568,585,725
  DGRRLU0            8643365       8737562                538,725
  DGYPSDE2           4664408       4696027                568,725
  VAFCCCAP          10502924      10366629          91,179,553,582,568
                                                        585,662,725
  VAFCCOPT           3896959       3505479          91,298,568,585,725
  VAFHCCAP           9295148       9158853          91,582,568,585,725
  VAFHCOPT           3083745       2784682            91,568,585,725
  VAFHUTL            5746118       5488469          91,151,568,585,725
  
 Number of routines in patch:          16
  Number of routines changed:          16
  
  
  
                       CHECK1^XTSUMBLD (new method) results
  Routine       Before Patch   After Patch              Patch List
  =======       ============   ===========              ==========
  DGDEATH           33387401      34349715           45,84,101,149,392
                                                    545,595,568,563,725
  DGENRPD2          39967881      45286648          147,232,568,585,725
  DGENRPT2          40693413      40929861          232,306,417,456,491
                                                        513,568,725
  DGENRPT5           3142456       5443273                568,725
  DGFFPLM            3073677       6269305                485,725
  DGMTOFA           19851647      19818712           3,50,182,326,426
                                                          568,725
  DGQESC2           21692668      21637202              73,568,725
  DGQPTQ2           36446013      36432808              447,598,725
  DGRP14             4523776       3348919              568,585,725
  DGRRLU0           36764979      37459964                538,725
  DGYPSDE2          12403558      12451578                568,725
  VAFCCCAP          23889939      23061055          91,179,553,582,568
                                                        585,662,725
  VAFCCOPT          12640858      11265330          91,298,568,585,725
  VAFHCCAP          19098716      18442978          91,582,568,585,725
  VAFHCOPT           9367770       8310849            91,568,585,725
  VAFHUTL           21137485      19820205          91,151,568,585,725
  
 Number of routines in patch:          16
  Number of routines changed:          16
  
  
 V. SOFTWARE RETRIEVAL
  
 The software for this patch is not being distributed through the National
 Patch Module. This patch, DG*5.3*725, along with Beneficiary Travel patch 
 DGBT*1.0*13 and Enrollment Application System EAS*1.0*77, is being released
 in a single KIDS software distribution (host file).
  
   Host file name: DG_53_P725.KID
         Build(s): DG*5.3*725
                   EAS*1.0*77
                   DGBT*1.0*13
  
 Sites may retrieve the host file directly via FTP. The preferred method is
 to FTP the files from:
  
      download.vista.med.va.gov
  
 This transmits the files from the first available FTP server.  Sites may 
 also elect to retrieve software directly from the ANONYMOUS.SOFTWARE 
 directory from a specific server as follows:
  
   OIFO               FTP ADDRESS                  DIRECTORY
   ------------       ------------------------     -------------
   Albany             ftp.fo-albany.med.va.gov     anonymous.software
   Hines              ftp.fo-hines.med.va.gov      anonymous.software
   Salt Lake City     ftp.fo-slc.med.va.gov        anonymous.software
  
   The following file will be available:
  
   FILE NAME             DESCRIPTION
   -----------------     -------------------------------
   DG_53_P725.KID        Host file containing KIDS software distribution
  
  
   * Note:  Use ASCII mode when transferring the .KID file.
       
  
  
        ================INSTALLATION INSTRUCTIONS =================
  
 If installed during the normal workday, it is recommended that the
 following selections in the OPTION (#19) file be disabled to prevent
 possible conflicts while running the KIDS Install. Other VISTA users will
 not be affected.
  
 Death Entry                      [DG DEATH ENTRY]
 Register a Patient               [DG REGISTER PATIENT]
 Required Means Test At Next      [DG MEANS TEST FUTURE LIST] 
                 Appointment
 Copay Exempt Test Needing        [DG CO-PAY TEST FUTURE LIST]
        Update At Next Appt.
 Disposition Log Edit             [DG DISPOSITION EDIT]
 Upcoming Appointments without    [DGEN APPTS, NOT ENROLLED]
                    Enrollment
 EGT Impact Report                [DGEN EGT IMPACT REPORT(P)]
 EGT Impact Report                [DGEN EGT IMPACT REPORT(A)]
 Fugitive Felon Inquiry           [DGFFP FFP INQUIRY]
 Outpatient Card Download         [DGQE DATA CARD OUT]
 Inpatient Card Download          [DGQE DATA CARD IN]
 Appointment Check-in/Check-out   [SDAM APPT CHECK IN/OUT]
 OUTPATIENT BATCH JOB HL7 v2.3    [VAFC BATCH OUTPATIENT]
 UPDATE BATCH JOB FOR HL7 v2.3    [VAFH BATCH UPDATE]
  
 Additionally, be sure to disable the options listed in the Installation 
 Instructions section of the patch descriptions for EAS*1.0*77 and 
 DGBT*1.0*13. The options are repeated here for convenience.
  
 Daily Means Test Expiration Report        [EAS MT EXPIRATION BG PRINT]
 Means Test Expiration Report OR HL7 v2.3  [EAS MT EXPIRATIONS]
 Claim Enter/Edit                          [DG BENE TRAVEL SCREEN]
  
 Install Time  less than 5 minutes (unless otherwise indicated)
  
  
   1. Download the KIDS file DG_53_P725.KID from the ANONYMOUS.SOFTWARE
      directory of any of Albany, Hines or the Salt Lake OIFO to the
      appropriate directory on your system.
  
   2. Use LOAD A DISTRIBUTION option on the KIDS INSTALLATION menu, and
      enter:  the directory onto which you have downloaded the host file,
      immediately followed by DG_53_P725.KID.
  
   3. From the 'Kernel Installation & Distribution System' menu, select the
      Installation menu.
  
   4. From this menu, you may now elect to use the following options (when
      prompted for INSTALL NAME, enter DG*5.3*725).
  
      a. Backup a Transport Global - This option will create a backup
         message of any routines exported with the patch.  It will NOT
         backup any changes such as DDs or templates.
  
      b. Compare Transport Global to Current System - This option will
         allow you to view all changes that will be made when the patch is
         installed.  It compares all components of the patch (routines,
         DDs, templates, etc.).
  
      c. Verify Checksums in Transport Global - This option will allow you
         to ensure the integrity of the routines that are in the transport
         global.
  
      d. Print Transport Global - this option will allow you to view the
         components of the KIDS build.
  
   5. Use the Install Package(s) option and select package DG*5.3*725.
  
   6. When prompted 'Want KIDS to Rebuild Menu Trees Upon Completion of
      Install? YES//', respond NO.
  
   7. When prompted 'Want KIDS to INHIBIT LOGONs during the install?
      YES//', it is recommended you answer NO.
  
   8. When prompted to 'Want to DISABLE Scheduled Options, Menu Options,
      and Protocols? YES//', respond YES.  When prompted to select the
      options you would like to place out of order, enter the options 
      listed above.

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: DGDEATH
    Before: B33387401  After: B34349715  **45,84,101,149,392,545,595,568,
                                          563,725**
Routine Name: DGENRPD2
    Before: B39967881  After: B45286648  **147,232,568,585,725**
Routine Name: DGENRPT2
    Before: B40693413  After: B40929861  **232,306,417,456,491,513,568,725**
Routine Name: DGENRPT5
    Before:  B3142456  After:  B5443273  **568,725**
Routine Name: DGFFPLM
    Before:  B3073677  After:  B6269305  **485,725**
Routine Name: DGMTOFA
    Before: B19851647  After: B19818712  **3,50,182,326,426,568,725**
Routine Name: DGQESC2
    Before: B21692668  After: B21637202  **73,568,725**
Routine Name: DGQPTQ2
    Before: B36446013  After: B36432808  **447,598,725**
Routine Name: DGRP14
    Before:  B4523776  After:  B3348919  **568,585,725**
Routine Name: DGRRLU0
    Before: B36764979  After: B37459964  **538,725**
Routine Name: DGYPSDE2
    Before: B12403558  After: B12451578  **568,725**
Routine Name: VAFCCCAP
    Before: B23889939  After: B23061055  **91,179,553,582,568,585,662,725**
Routine Name: VAFCCOPT
    Before: B12640858  After: B11265330  **91,298,568,585,725**
Routine Name: VAFHCCAP
    Before: B19098716  After: B18442978  **91,582,568,585,725**
Routine Name: VAFHCOPT
    Before:  B9367770  After:  B8310849  **91,568,585,725**
Routine Name: VAFHUTL
    Before: B21137485  After: B19820205  **91,151,568,585,725**

=============================================================================
User Information:
Entered By  : HUA,PATRICK                   Date Entered  : AUG 01, 2006
Completed By: RUDINGER,NANCY L.             Date Completed: FEB 12, 2007
Released By : FITCH,DONNA                   Date Released : FEB 21, 2007
=============================================================================


Packman Mail Message:
=====================

