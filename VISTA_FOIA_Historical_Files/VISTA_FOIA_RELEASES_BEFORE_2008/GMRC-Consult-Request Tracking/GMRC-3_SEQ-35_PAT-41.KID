Released GMRC*3*41 SEQ #35
Extracted from mail message
**KIDS**:GMRC*3.0*41^

**INSTALL NAME**
GMRC*3.0*41
"BLD",5495,0)
GMRC*3.0*41^CONSULT/REQUEST TRACKING^0^3050408^y
"BLD",5495,1,0)
^^2^2^3050209^
"BLD",5495,1,1,0)
See the National Patch Module for complete details of the enhancements 
"BLD",5495,1,2,0)
included in this patch.
"BLD",5495,4,0)
^9.64PA^^
"BLD",5495,"INI")
PRE^GMRCYP41
"BLD",5495,"INID")
^n^n
"BLD",5495,"INIT")
POST^GMRCYP41
"BLD",5495,"KRN",0)
^9.67PA^8989.52^19
"BLD",5495,"KRN",.4,0)
.4
"BLD",5495,"KRN",.401,0)
.401
"BLD",5495,"KRN",.402,0)
.402
"BLD",5495,"KRN",.403,0)
.403
"BLD",5495,"KRN",.5,0)
.5
"BLD",5495,"KRN",.84,0)
.84
"BLD",5495,"KRN",3.6,0)
3.6
"BLD",5495,"KRN",3.8,0)
3.8
"BLD",5495,"KRN",9.2,0)
9.2
"BLD",5495,"KRN",9.8,0)
9.8
"BLD",5495,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5495,"KRN",9.8,"NM",1,0)
GMRCSTL7^^0^B48976284
"BLD",5495,"KRN",9.8,"NM",2,0)
GMRCSTL8^^0^B25461061
"BLD",5495,"KRN",9.8,"NM","B","GMRCSTL7",1)

"BLD",5495,"KRN",9.8,"NM","B","GMRCSTL8",2)

"BLD",5495,"KRN",19,0)
19
"BLD",5495,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",5495,"KRN",19,"NM",1,0)
GMRC RPT PERF MONITOR^^0
"BLD",5495,"KRN",19,"NM",2,0)
GMRC REPORTS^^2
"BLD",5495,"KRN",19,"NM","B","GMRC REPORTS",2)

"BLD",5495,"KRN",19,"NM","B","GMRC RPT PERF MONITOR",1)

"BLD",5495,"KRN",19.1,0)
19.1
"BLD",5495,"KRN",101,0)
101
"BLD",5495,"KRN",409.61,0)
409.61
"BLD",5495,"KRN",771,0)
771
"BLD",5495,"KRN",870,0)
870
"BLD",5495,"KRN",8989.51,0)
8989.51
"BLD",5495,"KRN",8989.52,0)
8989.52
"BLD",5495,"KRN",8994,0)
8994
"BLD",5495,"KRN","B",.4,.4)

"BLD",5495,"KRN","B",.401,.401)

"BLD",5495,"KRN","B",.402,.402)

"BLD",5495,"KRN","B",.403,.403)

"BLD",5495,"KRN","B",.5,.5)

"BLD",5495,"KRN","B",.84,.84)

"BLD",5495,"KRN","B",3.6,3.6)

"BLD",5495,"KRN","B",3.8,3.8)

"BLD",5495,"KRN","B",9.2,9.2)

"BLD",5495,"KRN","B",9.8,9.8)

"BLD",5495,"KRN","B",19,19)

"BLD",5495,"KRN","B",19.1,19.1)

"BLD",5495,"KRN","B",101,101)

"BLD",5495,"KRN","B",409.61,409.61)

"BLD",5495,"KRN","B",771,771)

"BLD",5495,"KRN","B",870,870)

"BLD",5495,"KRN","B",8989.51,8989.51)

"BLD",5495,"KRN","B",8989.52,8989.52)

"BLD",5495,"KRN","B",8994,8994)

"BLD",5495,"QUES",0)
^9.62^^
"INI")
PRE^GMRCYP41
"INIT")
POST^GMRCYP41
"KRN",19,4142,-1)
2^2
"KRN",19,4142,0)
GMRC REPORTS^Consult Tracking Reports^^M^1326^^^^^^^128
"KRN",19,4142,10,0)
^19.01IP^17^14
"KRN",19,4142,10,17,0)
9767^PM
"KRN",19,4142,10,17,"^")
GMRC RPT PERF MONITOR
"KRN",19,4142,"U")
CONSULT TRACKING REPORTS
"KRN",19,9767,-1)
0^1
"KRN",19,9767,0)
GMRC RPT PERF MONITOR^Consult Performance Monitor Report^^R^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",19,9767,1,0)
^^2^2^3050209^
"KRN",19,9767,1,1,0)
This report provides data to be submitted for the National Performance 
"KRN",19,9767,1,2,0)
Monitor.
"KRN",19,9767,25)
EN^GMRCSTL7
"KRN",19,9767,"U")
CONSULT PERFORMANCE MONITOR RE
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^13
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
41^3050408
"PKG",128,22,1,"PAH",1,1,0)
^^2^2^3050408
"PKG",128,22,1,"PAH",1,1,1,0)
See the National Patch Module for complete details of the enhancements 
"PKG",128,22,1,"PAH",1,1,2,0)
included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","GMRCSTL7")
0^1^B48976284
"RTN","GMRCSTL7",1,0)
GMRCSTL7 ;SLC/JFR - DRIVER FOR CSLT PER MONITOR ;4/8/05 10:28
"RTN","GMRCSTL7",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**41**;DEC 27, 1997
"RTN","GMRCSTL7",3,0)
 ;
"RTN","GMRCSTL7",4,0)
 Q
"RTN","GMRCSTL7",5,0)
 ;
"RTN","GMRCSTL7",6,0)
EN ; start here
"RTN","GMRCSTL7",7,0)
 K GMRCQUT
"RTN","GMRCSTL7",8,0)
 N DIROUT,DTOUT,DUOUT,DIR,DIRUT,GMRCTMP,GMRCDG,GMRCSVC,GMRCSVNM,GMRCDT1
"RTN","GMRCSTL7",9,0)
 N GMRCDT2,GMRCFMT,GMRCGRP,VALMBCK,GMRCSAVE
"RTN","GMRCSTL7",10,0)
 ;
"RTN","GMRCSTL7",11,0)
 ;Ask for service
"RTN","GMRCSTL7",12,0)
 N Y
"RTN","GMRCSTL7",13,0)
 S DIR(0)="PO^123.5:EMQ",DIR("??")="^D LISTALL^GMRCASV"
"RTN","GMRCSTL7",14,0)
 S DIR("A")="Select Service/Specialty"
"RTN","GMRCSTL7",15,0)
 D ^DIR
"RTN","GMRCSTL7",16,0)
 I Y<1 Q
"RTN","GMRCSTL7",17,0)
 S GMRCDG=+Y,GMRCSVNM=$P(Y,U,2)
"RTN","GMRCSTL7",18,0)
 ;
"RTN","GMRCSTL7",19,0)
 ;Ask for date range
"RTN","GMRCSTL7",20,0)
 D ^GMRCSPD
"RTN","GMRCSTL7",21,0)
 I $D(GMRCQUT) G EXIT
"RTN","GMRCSTL7",22,0)
 ;
"RTN","GMRCSTL7",23,0)
 ; what type of report
"RTN","GMRCSTL7",24,0)
 K DIR,X,Y
"RTN","GMRCSTL7",25,0)
 S DIR(0)="S:O^S:Summary;D:Delimited",DIR("A")="What type of report"
"RTN","GMRCSTL7",26,0)
 D ^DIR
"RTN","GMRCSTL7",27,0)
 I Y="" G EXIT
"RTN","GMRCSTL7",28,0)
 S GMRCFMT=$S(Y="S":"CP",1:"DEL")
"RTN","GMRCSTL7",29,0)
 ;
"RTN","GMRCSTL7",30,0)
 W @IOF
"RTN","GMRCSTL7",31,0)
 S GMRCSAVE("GMRCFMT")=""
"RTN","GMRCSTL7",32,0)
 S GMRCSAVE("GMRCDG")=""
"RTN","GMRCSTL7",33,0)
 S GMRCSAVE("GMRCDT1")=""
"RTN","GMRCSTL7",34,0)
 S GMRCSAVE("GMRCDT2")=""
"RTN","GMRCSTL7",35,0)
 S GMRCSAVE("GMRCSVNM")=""
"RTN","GMRCSTL7",36,0)
 ;
"RTN","GMRCSTL7",37,0)
 D EN^XUTMDEVQ("PRNTQ^GMRCSTL7","CONSULT PERFORMANCE MONITOR",.GMRCSAVE)
"RTN","GMRCSTL7",38,0)
 ;
"RTN","GMRCSTL7",39,0)
 D EXIT
"RTN","GMRCSTL7",40,0)
 ;
"RTN","GMRCSTL7",41,0)
 Q
"RTN","GMRCSTL7",42,0)
 ;
"RTN","GMRCSTL7",43,0)
ENOR(RETURN,GMRCSVC,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCARRN) ;Entry point 
"RTN","GMRCSTL7",44,0)
 ;.RETURN:   This is the root to the returned temp array.
"RTN","GMRCSTL7",45,0)
 ;GMRCSVC:  Service for which consults are to be displayed.
"RTN","GMRCSTL7",46,0)
 ;GMRCDT1:  Starting date or "ALL"
"RTN","GMRCSTL7",47,0)
 ;GMRCDT2:  Ending date if not GMRCDT1="ALL"
"RTN","GMRCSTL7",48,0)
 ;GMRCSTAT: The list of status to include separated by commas
"RTN","GMRCSTL7",49,0)
 ;GMRCARRN: Format of report becomes ^TMP array element
"RTN","GMRCSTL7",50,0)
 ;          "CP": Summary Report; "DEL": Delimited Report
"RTN","GMRCSTL7",51,0)
 ;
"RTN","GMRCSTL7",52,0)
 ;This temp array is used internally by the report:
"RTN","GMRCSTL7",53,0)
 ;^TMP("GMRCSLIST",$J,n)=ien^name^parient ien^"+" if grouper^status
"RTN","GMRCSTL7",54,0)
 ;  status is "" tracking and/or grouper
"RTN","GMRCSTL7",55,0)
 ;            1  grouper only
"RTN","GMRCSTL7",56,0)
 ;            2  tracking only
"RTN","GMRCSTL7",57,0)
 ;            9  disabled
"RTN","GMRCSTL7",58,0)
 ;
"RTN","GMRCSTL7",59,0)
 N GMRCEDT1,GMRCEDT2,GMRCDG,GMRCHEAD,GMRCGRP,VALMCNT,VALMBCK
"RTN","GMRCSTL7",60,0)
 K ^TMP("GMRCR",$J,GMRCARRN)
"RTN","GMRCSTL7",61,0)
 S RETURN="^TMP(""GMRCR"",$J,GMRCARRN)"
"RTN","GMRCSTL7",62,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTL7",63,0)
 Q:'$D(^GMR(123.5,$G(GMRCSVC),0))
"RTN","GMRCSTL7",64,0)
 ;Build service array
"RTN","GMRCSTL7",65,0)
 S GMRCDG=GMRCSVC
"RTN","GMRCSTL7",66,0)
 D SERV1^GMRCASV
"RTN","GMRCSTL7",67,0)
 ;Get external form of date range
"RTN","GMRCSTL7",68,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL"
"RTN","GMRCSTL7",69,0)
 S:GMRCDT1="ALL" GMRCDT2=0
"RTN","GMRCSTL7",70,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,$G(GMRCDT2),.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTL7",71,0)
 ;
"RTN","GMRCSTL7",72,0)
 N GMRCDA,INDEX,STATUS,LOOP,GROUPER
"RTN","GMRCSTL7",73,0)
 N STS,GMRCD,GMRCDT,GMRCSVCG,TEMP,GMRCPT,LINETEMP
"RTN","GMRCSTL7",74,0)
 N GMRCPTN,GMRCPTSN,GMRCDLA,GMRCXDT,GMRCLOC,GMRCSVCP
"RTN","GMRCSTL7",75,0)
 N GRP,GMRCIRF,GMRCIRFN,GMRCIDD,GMRCST,GMRCRDT
"RTN","GMRCSTL7",76,0)
 ;
"RTN","GMRCSTL7",77,0)
 K ^TMP("GMRCR",$J,GMRCARRN),^TMP("GMRCRINDEX",$J),^TMP("GMRCTOT",$J)
"RTN","GMRCSTL7",78,0)
 ;
"RTN","GMRCSTL7",79,0)
 S GROUPER=0
"RTN","GMRCSTL7",80,0)
 S GROUPER(0)=0
"RTN","GMRCSTL7",81,0)
 I GMRCARRN="DEL" D
"RTN","GMRCSTL7",82,0)
 . N STR
"RTN","GMRCSTL7",83,0)
 . S STR="Service;Total;Unresolved;Complete;Comp w/Results;%Complete;"
"RTN","GMRCSTL7",84,0)
 . S STR=STR_"%Comp w/Results"
"RTN","GMRCSTL7",85,0)
 . S ^TMP("GMRCR",$J,GMRCARRN,1,0)=STR
"RTN","GMRCSTL7",86,0)
 S INDEX=""
"RTN","GMRCSTL7",87,0)
 ;Loop on Service
"RTN","GMRCSTL7",88,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTL7",89,0)
 .S GMRCSVC=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTL7",90,0)
 .S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,INDEX),"^",2)
"RTN","GMRCSTL7",91,0)
 .S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)
"RTN","GMRCSTL7",92,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=0
"RTN","GMRCSTL7",93,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"P")=0
"RTN","GMRCSTL7",94,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"R")=0
"RTN","GMRCSTL7",95,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"C")=0
"RTN","GMRCSTL7",96,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"T")=0
"RTN","GMRCSTL7",97,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"P")=0
"RTN","GMRCSTL7",98,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"R")=0
"RTN","GMRCSTL7",99,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"C")=0
"RTN","GMRCSTL7",100,0)
 . ;Check if starting a new Grouper
"RTN","GMRCSTL7",101,0)
 . F  Q:GROUPER(GROUPER)=GMRCSVCG  D
"RTN","GMRCSTL7",102,0)
 ..;End of a group so print the group totals
"RTN","GMRCSTL7",103,0)
 ..I GROUPER(GROUPER)=GMRCSVCG D 
"RTN","GMRCSTL7",104,0)
 ... I GMRCARRN="CP" D
"RTN","GMRCSTL7",105,0)
 .... D PRTTOT^GMRCSTL8(2,GROUPER(GROUPER),GMRCARRN)
"RTN","GMRCSTL7",106,0)
 ... I GMRCARRN="DEL" D
"RTN","GMRCSTL7",107,0)
 .... D DELTOT^GMRCSTL8(2,GROUPER(GROUPER),GMRCARRN)
"RTN","GMRCSTL7",108,0)
 ..;pop grouper from stack
"RTN","GMRCSTL7",109,0)
 ..S GROUPER=GROUPER-1
"RTN","GMRCSTL7",110,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",4)="+" D
"RTN","GMRCSTL7",111,0)
 ..;push new grouper on stack
"RTN","GMRCSTL7",112,0)
 ..S GROUPER=GROUPER+1
"RTN","GMRCSTL7",113,0)
 ..S GROUPER(GROUPER)=GMRCSVC
"RTN","GMRCSTL7",114,0)
 .;Loop for one status at a time
"RTN","GMRCSTL7",115,0)
 .F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) D
"RTN","GMRCSTL7",116,0)
 .. D ONESTAT^GMRCSTL8(GMRCARRN,INDEX,STATUS,GMRCDT1,GMRCDT2)
"RTN","GMRCSTL7",117,0)
 .F GRP=GROUPER:-1:1 D
"RTN","GMRCSTL7",118,0)
 ..;  pending for this service to all of its groupers
"RTN","GMRCSTL7",119,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"P")
"RTN","GMRCSTL7",120,0)
 .. ; completed w/results for all groupers
"RTN","GMRCSTL7",121,0)
 .. S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"R")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"R"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"R")
"RTN","GMRCSTL7",122,0)
 ..;  for all status for this service to all of its groupers
"RTN","GMRCSTL7",123,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"T")
"RTN","GMRCSTL7",124,0)
 .. ; add all completed for all groupers
"RTN","GMRCSTL7",125,0)
 .. S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"C")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"C"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"C")
"RTN","GMRCSTL7",126,0)
 .;
"RTN","GMRCSTL7",127,0)
 .;Print the totals for this service that are >0
"RTN","GMRCSTL7",128,0)
 . I GMRCARRN="CP" D 
"RTN","GMRCSTL7",129,0)
 .. D PRTTOT^GMRCSTL8(1,GMRCSVC,GMRCSVCP,GMRCARRN)
"RTN","GMRCSTL7",130,0)
 . I GMRCARRN="DEL" D
"RTN","GMRCSTL7",131,0)
 .. D DELTOT^GMRCSTL8(1,GMRCSVC,GMRCSVCP,GMRCARRN)
"RTN","GMRCSTL7",132,0)
 . Q
"RTN","GMRCSTL7",133,0)
 ;
"RTN","GMRCSTL7",134,0)
 ;Done, so now list the group totals for the top group
"RTN","GMRCSTL7",135,0)
 ;F GROUPER=GROUPER:-1:1 D  ; left for looking at all totals in future
"RTN","GMRCSTL7",136,0)
 I $G(GROUPER) S GROUPER=1 D
"RTN","GMRCSTL7",137,0)
 . I GMRCARRN="CP" D 
"RTN","GMRCSTL7",138,0)
 .. D PRTTOT^GMRCSTL8(2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),GMRCARRN)
"RTN","GMRCSTL7",139,0)
 . I GMRCARRN="DEL" D
"RTN","GMRCSTL7",140,0)
 .. D DELTOT^GMRCSTL8(2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),GMRCARRN)
"RTN","GMRCSTL7",141,0)
 Q
"RTN","GMRCSTL7",142,0)
 ;
"RTN","GMRCSTL7",143,0)
PRNTQ   ;Build report and print it
"RTN","GMRCSTL7",144,0)
 ;
"RTN","GMRCSTL7",145,0)
 N GMRCPG,GMRCTMP,IDX,GMRCQUT,TEMP
"RTN","GMRCSTL7",146,0)
 S GMRCPG=1
"RTN","GMRCSTL7",147,0)
 D SERV1^GMRCASV
"RTN","GMRCSTL7",148,0)
 D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",149,0)
 W !,$J("",23)_"Consult/Request Performance Monitor"
"RTN","GMRCSTL7",150,0)
 S TEMP="FROM: "_$$FMTE^XLFDT(GMRCDT1)_"  TO: "_$$FMTE^XLFDT(GMRCDT2)
"RTN","GMRCSTL7",151,0)
 I GMRCDT1="ALL" S TEMP="ALL DATES"
"RTN","GMRCSTL7",152,0)
 W !,$J("",40-($L(TEMP)/2)+.5)_TEMP,!
"RTN","GMRCSTL7",153,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) D  G EXIT
"RTN","GMRCSTL7",154,0)
 . W !!,"No records to print"
"RTN","GMRCSTL7",155,0)
 D ENOR^GMRCSTL7(.GMRCTMP,GMRCDG,GMRCDT1,GMRCDT2,"5,6,8,2,9",GMRCFMT)
"RTN","GMRCSTL7",156,0)
 I '$D(^TMP("GMRCR",$J,GMRCFMT)) D
"RTN","GMRCSTL7",157,0)
 . W !!,"No records to print",!
"RTN","GMRCSTL7",158,0)
 S IDX=""
"RTN","GMRCSTL7",159,0)
 F  S IDX=$O(^TMP("GMRCR",$J,GMRCFMT,IDX)) Q:'IDX!($G(GMRCQUT))  D
"RTN","GMRCSTL7",160,0)
 . I IOSL-$Y<3 D
"RTN","GMRCSTL7",161,0)
 .. I $E(IOST,1,2)["C-" D
"RTN","GMRCSTL7",162,0)
 ... N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTL7",163,0)
 ... I 'Y S GMRCQUT=1
"RTN","GMRCSTL7",164,0)
 .. Q:$G(GMRCQUT)
"RTN","GMRCSTL7",165,0)
 .. D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",166,0)
 . Q:$G(GMRCQUT)
"RTN","GMRCSTL7",167,0)
 . W ^TMP("GMRCR",$J,GMRCFMT,IDX,0),!
"RTN","GMRCSTL7",168,0)
 I GMRCFMT="CP",'$G(GMRCQUT) D
"RTN","GMRCSTL7",169,0)
 . Q:$O(^TMP("GMRCTOT",$J,0,""))=""
"RTN","GMRCSTL7",170,0)
 . I IOSL-$Y<6 D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",171,0)
 . W !!!,$$REPEAT^XLFSTR("-",IOM-5)
"RTN","GMRCSTL7",172,0)
 . W !,"Consult services with no activity meeting the criteria of this report in",!,"the specified date range:",!
"RTN","GMRCSTL7",173,0)
 . S IDX=""
"RTN","GMRCSTL7",174,0)
 . F  S IDX=$O(^TMP("GMRCTOT",$J,0,IDX)) Q:IDX=""!($G(GMRCQUT))  D
"RTN","GMRCSTL7",175,0)
 .. I IOSL-$Y<3 D
"RTN","GMRCSTL7",176,0)
 ... I $E(IOST,1,2)["C-" D
"RTN","GMRCSTL7",177,0)
 .... N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTL7",178,0)
 .... I 'Y S GMRCQUT=1
"RTN","GMRCSTL7",179,0)
 ... Q:$G(GMRCQUT)
"RTN","GMRCSTL7",180,0)
 ... D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTL7",181,0)
 .. Q:$G(GMRCQUT)
"RTN","GMRCSTL7",182,0)
 .. W ?4,IDX,!
"RTN","GMRCSTL7",183,0)
 D ^%ZISC
"RTN","GMRCSTL7",184,0)
 D EXIT
"RTN","GMRCSTL7",185,0)
 Q
"RTN","GMRCSTL7",186,0)
 ;
"RTN","GMRCSTL7",187,0)
HEAD(PAGE) ; print header for CPM
"RTN","GMRCSTL7",188,0)
 W @IOF
"RTN","GMRCSTL7",189,0)
 W "Consult Performance Monitor",?40,$$HTE^XLFDT($H)
"RTN","GMRCSTL7",190,0)
 W ?73,"Page: ",PAGE,!
"RTN","GMRCSTL7",191,0)
 W $$REPEAT^XLFSTR("-",IOM-2),!
"RTN","GMRCSTL7",192,0)
 Q
"RTN","GMRCSTL7",193,0)
 ;
"RTN","GMRCSTL7",194,0)
EXIT F ARR="GMRCR","GMRCS","GMRCSLIST","GMRCTOT" K ^TMP(ARR,$J)
"RTN","GMRCSTL7",195,0)
 K ARR
"RTN","GMRCSTL7",196,0)
 Q
"RTN","GMRCSTL7",197,0)
 ;
"RTN","GMRCSTL8")
0^2^B25461061
"RTN","GMRCSTL8",1,0)
GMRCSTL8 ;SLC/JFR - Totals format for CPM ; 4/05/05 10:39
"RTN","GMRCSTL8",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**41**;DEC 27, 1997
"RTN","GMRCSTL8",3,0)
 ; This routine invokes IA #875, #2638
"RTN","GMRCSTL8",4,0)
 ; This routine invokes IA #10035,#44, #10040
"RTN","GMRCSTL8",5,0)
 ;
"RTN","GMRCSTL8",6,0)
 ; portions copied from GMRCSTL1 & GMRCSTL2
"RTN","GMRCSTL8",7,0)
 ;
"RTN","GMRCSTL8",8,0)
 Q  ; can't start here
"RTN","GMRCSTL8",9,0)
 ;
"RTN","GMRCSTL8",10,0)
PRTTOT(GEN,INDEX,NAME,ARRN) ; totals for printed report
"RTN","GMRCSTL8",11,0)
 N COUNT
"RTN","GMRCSTL8",12,0)
 S COUNT=$O(^TMP("GMRCR",$J,ARRN," "),-1)
"RTN","GMRCSTL8",13,0)
 I GEN=2 D
"RTN","GMRCSTL8",14,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL8",15,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)=""
"RTN","GMRCSTL8",16,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL8",17,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="     GROUPER: "_NAME_" Totals:"
"RTN","GMRCSTL8",18,0)
 I GEN=1 D
"RTN","GMRCSTL8",19,0)
 . I ^TMP("GMRCTOT",$J,1,INDEX,"T")=0 D  Q  ;collect zero servs for summ
"RTN","GMRCSTL8",20,0)
 .. Q:$P(^GMR(123.5,INDEX,0),U,2)=1
"RTN","GMRCSTL8",21,0)
 .. S ^TMP("GMRCTOT",$J,0,NAME)=""
"RTN","GMRCSTL8",22,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL8",23,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)=" "
"RTN","GMRCSTL8",24,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL8",25,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="SERVICE: "_NAME
"RTN","GMRCSTL8",26,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL8",27,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Total Requests To Service:"_$J(^TMP("GMRCTOT",$J,1,INDEX,"T"),30,0)
"RTN","GMRCSTL8",28,0)
 I GEN=2,^TMP("GMRCTOT",$J,2,INDEX,"T")>0 D
"RTN","GMRCSTL8",29,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL8",30,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Total Requests To Grouper:"_$J(^TMP("GMRCTOT",$J,2,INDEX,"T"),30,0)
"RTN","GMRCSTL8",31,0)
 I $G(^TMP("GMRCTOT",$J,GEN,INDEX,"T"))>0 D
"RTN","GMRCSTL8",32,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL8",33,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Total Requests Pending Resolution: "_$J(^TMP("GMRCTOT",$J,GEN,INDEX,"P"),21,0)
"RTN","GMRCSTL8",34,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL8",35,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Total Requests completed: "_$J(^TMP("GMRCTOT",$J,GEN,INDEX,"C"),30,0)
"RTN","GMRCSTL8",36,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL8",37,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Total Requests completed with Results: "_$J(^TMP("GMRCTOT",$J,GEN,INDEX,"R"),17,0)
"RTN","GMRCSTL8",38,0)
 . N GMRCPCT
"RTN","GMRCSTL8",39,0)
 . I ^TMP("GMRCTOT",$J,GEN,INDEX,"T")=0 S GMRCPCT="N/A"
"RTN","GMRCSTL8",40,0)
 . I '$D(GMRCPCT) S GMRCPCT=(^TMP("GMRCTOT",$J,GEN,INDEX,"C")/^TMP("GMRCTOT",$J,GEN,INDEX,"T"))*100
"RTN","GMRCSTL8",41,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL8",42,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Percentage of total requests completed: "_$S(+GMRCPCT'=GMRCPCT:$J(GMRCPCT,16),1:($J(GMRCPCT,19,2)_"%"))
"RTN","GMRCSTL8",43,0)
 . K GMRCPCT
"RTN","GMRCSTL8",44,0)
 . I ^TMP("GMRCTOT",$J,GEN,INDEX,"C")=0 S GMRCPCT="N/A"
"RTN","GMRCSTL8",45,0)
 . I '$D(GMRCPCT) S GMRCPCT=(^TMP("GMRCTOT",$J,GEN,INDEX,"R")/^TMP("GMRCTOT",$J,GEN,INDEX,"C"))*100
"RTN","GMRCSTL8",46,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL8",47,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Percentage of total completed requests with results: "_$S(+GMRCPCT'=GMRCPCT:GMRCPCT,1:($J(GMRCPCT,6,2)_"%"))
"RTN","GMRCSTL8",48,0)
 Q
"RTN","GMRCSTL8",49,0)
 ;
"RTN","GMRCSTL8",50,0)
DELTOT(GEN,INDEX,NAME,ARRN) ; format for delimited
"RTN","GMRCSTL8",51,0)
 ;
"RTN","GMRCSTL8",52,0)
 I ^TMP("GMRCTOT",$J,GEN,INDEX,"T")=0 Q
"RTN","GMRCSTL8",53,0)
 N STRING,COUNT
"RTN","GMRCSTL8",54,0)
 S COUNT=$O(^TMP("GMRCR",$J,ARRN," "),-1)
"RTN","GMRCSTL8",55,0)
 S STRING=$S(GEN=2:"GROUPER: ",1:"")_NAME_";"
"RTN","GMRCSTL8",56,0)
 S STRING=STRING_^TMP("GMRCTOT",$J,GEN,INDEX,"T")_";"
"RTN","GMRCSTL8",57,0)
 S STRING=STRING_^TMP("GMRCTOT",$J,GEN,INDEX,"P")_";"
"RTN","GMRCSTL8",58,0)
 S STRING=STRING_^TMP("GMRCTOT",$J,GEN,INDEX,"C")_";"
"RTN","GMRCSTL8",59,0)
 S STRING=STRING_^TMP("GMRCTOT",$J,GEN,INDEX,"R")_";"
"RTN","GMRCSTL8",60,0)
 D  ;get % completed
"RTN","GMRCSTL8",61,0)
 . N GMRCPCT
"RTN","GMRCSTL8",62,0)
 . S GMRCPCT=(^TMP("GMRCTOT",$J,GEN,INDEX,"C")/^TMP("GMRCTOT",$J,GEN,INDEX,"T"))*100
"RTN","GMRCSTL8",63,0)
 . S STRING=STRING_$J(GMRCPCT,0,2)_";"
"RTN","GMRCSTL8",64,0)
 . Q
"RTN","GMRCSTL8",65,0)
 D  ; get % completed w/results
"RTN","GMRCSTL8",66,0)
 . I ^TMP("GMRCTOT",$J,GEN,INDEX,"C")=0 S STRING=STRING_"N/A;" Q
"RTN","GMRCSTL8",67,0)
 . N GMRCPCT
"RTN","GMRCSTL8",68,0)
 . S GMRCPCT=(^TMP("GMRCTOT",$J,GEN,INDEX,"R")/^TMP("GMRCTOT",$J,GEN,INDEX,"C"))*100
"RTN","GMRCSTL8",69,0)
 . S STRING=STRING_$J(GMRCPCT,0,2)
"RTN","GMRCSTL8",70,0)
 . Q
"RTN","GMRCSTL8",71,0)
 S COUNT=COUNT+1
"RTN","GMRCSTL8",72,0)
 S ^TMP("GMRCR",$J,ARRN,COUNT,0)=STRING
"RTN","GMRCSTL8",73,0)
 Q
"RTN","GMRCSTL8",74,0)
 ;
"RTN","GMRCSTL8",75,0)
ONESTAT(ARRN,SVCN,STAT,DT1,DT2) ;Process one status
"RTN","GMRCSTL8",76,0)
 ; Input -- ARRN  "CP"  - to be printed 
"RTN","GMRCSTL8",77,0)
 ;                "DEL" - in delimited format
"RTN","GMRCSTL8",78,0)
 ;          SVCN = node in ^TMP("GMRCLIST,$J
"RTN","GMRCSTL8",79,0)
 ;          STAT = status being worked on
"RTN","GMRCSTL8",80,0)
 ;          DT1 = starting date
"RTN","GMRCSTL8",81,0)
 ;          DT2 = ending date
"RTN","GMRCSTL8",82,0)
 ;
"RTN","GMRCSTL8",83,0)
 ; Output - None
"RTN","GMRCSTL8",84,0)
 ;
"RTN","GMRCSTL8",85,0)
 N GMRCPT,GMRCXDT,TEMP,GMRCSVC,GMRCSVCG,GMRCSVCP
"RTN","GMRCSTL8",86,0)
 S GMRCSVC=$P(^TMP("GMRCSLIST",$J,SVCN),"^",1)
"RTN","GMRCSTL8",87,0)
 S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,SVCN),"^",2)
"RTN","GMRCSTL8",88,0)
 S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,SVCN),"^",3)
"RTN","GMRCSTL8",89,0)
 S GMRCXDT=$S(DT1="ALL":0,1:9999999-DT2-.6)
"RTN","GMRCSTL8",90,0)
 F  S GMRCXDT=$O(^GMR(123,"AE",GMRCSVC,STAT,GMRCXDT)) Q:GMRCXDT=""!(GMRCXDT>(9999999-DT1))  D
"RTN","GMRCSTL8",91,0)
 .S GMRCPT=0
"RTN","GMRCSTL8",92,0)
 .;Loop for one consult at a time
"RTN","GMRCSTL8",93,0)
 .F  S GMRCPT=$O(^GMR(123,"AE",GMRCSVC,STAT,GMRCXDT,GMRCPT)) Q:GMRCPT=""  D
"RTN","GMRCSTL8",94,0)
 .. N PROS
"RTN","GMRCSTL8",95,0)
 ..; Check for bad "AE" x-ref
"RTN","GMRCSTL8",96,0)
 ..I '$D(^GMR(123,GMRCPT,0)) D  Q
"RTN","GMRCSTL8",97,0)
 ...K ^GMR(123,"AE",GMRCSVC,STAT,GMRCXDT,GMRCPT)
"RTN","GMRCSTL8",98,0)
 .. I $$TESTPAT^VADPT(+$P(^GMR(123,GMRCPT,0),U,2)) Q  ; exclude test pats
"RTN","GMRCSTL8",99,0)
 .. D  I $G(PROS) Q
"RTN","GMRCSTL8",100,0)
 ... N SVC S SVC=$P(^GMR(123,GMRCPT,0),U,5)
"RTN","GMRCSTL8",101,0)
 ... I +$G(^GMR(123.5,SVC,"INT")) S PROS=1 ; exclude PROS consults
"RTN","GMRCSTL8",102,0)
 .. I $P($G(^GMR(123,GMRCPT,12)),U,5)="P" Q  ; exclude IFC placer
"RTN","GMRCSTL8",103,0)
 ..; Add to totals
"RTN","GMRCSTL8",104,0)
 ..; for all status for this service
"RTN","GMRCSTL8",105,0)
 ..S ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=^TMP("GMRCTOT",$J,1,GMRCSVC,"T")+1
"RTN","GMRCSTL8",106,0)
 ..;  pending for this service
"RTN","GMRCSTL8",107,0)
 ..S:",3,4,5,6,8,9,11,99,"[(","_STAT_",") ^TMP("GMRCTOT",$J,1,GMRCSVC,"P")=^TMP("GMRCTOT",$J,1,GMRCSVC,"P")+1
"RTN","GMRCSTL8",108,0)
 .. I STAT=2 D
"RTN","GMRCSTL8",109,0)
 ... S ^TMP("GMRCTOT",$J,1,GMRCSVC,"C")=+$G(^TMP("GMRCTOT",$J,1,GMRCSVC,"C"))+1
"RTN","GMRCSTL8",110,0)
 ... Q:'$O(^GMR(123,+$G(GMRCPT),50,0))  ; Q if no results
"RTN","GMRCSTL8",111,0)
 ... S ^TMP("GMRCTOT",$J,1,GMRCSVC,"R")=+$G(^TMP("GMRCTOT",$J,1,GMRCSVC,"R"))+1
"RTN","GMRCSTL8",112,0)
 Q
"RTN","GMRCSTL8",113,0)
 ;
"RTN","GMRCYP41")
0^^B5921956
"RTN","GMRCYP41",1,0)
GMRCYP41 ;SLC/JFR - PRE/POST INSTALL FOR GMRC*3*41; 2/4/05 13:29
"RTN","GMRCYP41",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**41**;DEC 27, 1997
"RTN","GMRCYP41",3,0)
 ;
"RTN","GMRCYP41",4,0)
 ; This routine invokes one-time IA #4605
"RTN","GMRCYP41",5,0)
 ;
"RTN","GMRCYP41",6,0)
 Q
"RTN","GMRCYP41",7,0)
PRE ; pre-install
"RTN","GMRCYP41",8,0)
 ; This pre-install will delete the "AE", "AE1" and "AE2" MUMPS
"RTN","GMRCYP41",9,0)
 ; cross-references on the REQUEST/CONSULTATION (#123) file
"RTN","GMRCYP41",10,0)
 ; and replace them with a new-style index "AE" during the install
"RTN","GMRCYP41",11,0)
 ; that will have the same format as the prior "AE" cross-reference.
"RTN","GMRCYP41",12,0)
 ; This will insure greater reliability in the setting and
"RTN","GMRCYP41",13,0)
 ; killing of the "AE" cross-reference.
"RTN","GMRCYP41",14,0)
 ;
"RTN","GMRCYP41",15,0)
 N GMRCAE,GMRCAE1,GMRCAE2,IDX
"RTN","GMRCYP41",16,0)
 S (GMRCAE,GMRCAE1,GMRCAE2)=0
"RTN","GMRCYP41",17,0)
 K ^GMR(123,"AE") ; kill off all existing data
"RTN","GMRCYP41",18,0)
 S IDX=0
"RTN","GMRCYP41",19,0)
 F  S IDX=$O(^DD(123,1,1,IDX)) Q:'IDX  D
"RTN","GMRCYP41",20,0)
 . Q:$P($G(^DD(123,1,1,IDX,0)),U,2)'="AE"
"RTN","GMRCYP41",21,0)
 . S GMRCAE=IDX
"RTN","GMRCYP41",22,0)
 . D DELIX^DDMOD(123,1,GMRCAE)
"RTN","GMRCYP41",23,0)
 . S IDX=" " ;quit the loop
"RTN","GMRCYP41",24,0)
 . Q
"RTN","GMRCYP41",25,0)
 S IDX=0
"RTN","GMRCYP41",26,0)
 F  S IDX=$O(^DD(123,3,1,IDX)) Q:'IDX  D
"RTN","GMRCYP41",27,0)
 . Q:$P($G(^DD(123,3,1,IDX,0)),U,2)'="AE1"
"RTN","GMRCYP41",28,0)
 . S GMRCAE1=IDX
"RTN","GMRCYP41",29,0)
 . D DELIX^DDMOD(123,3,GMRCAE1)
"RTN","GMRCYP41",30,0)
 . S IDX=" " ; quit the loop
"RTN","GMRCYP41",31,0)
 . Q
"RTN","GMRCYP41",32,0)
 S IDX=0
"RTN","GMRCYP41",33,0)
 F  S IDX=$O(^DD(123,8,1,IDX)) Q:'IDX  D
"RTN","GMRCYP41",34,0)
 . Q:$P($G(^DD(123,8,1,IDX,0)),U,2)'="AE2"
"RTN","GMRCYP41",35,0)
 . S GMRCAE2=IDX
"RTN","GMRCYP41",36,0)
 . D DELIX^DDMOD(123,8,GMRCAE2)
"RTN","GMRCYP41",37,0)
 . S IDX=" " ; quit the loop
"RTN","GMRCYP41",38,0)
 . Q
"RTN","GMRCYP41",39,0)
 Q
"RTN","GMRCYP41",40,0)
 ;
"RTN","GMRCYP41",41,0)
POST ; post-install to create and build new "AE" index
"RTN","GMRCYP41",42,0)
 N GMRCXR,GMRCRES,GMRCOUT
"RTN","GMRCYP41",43,0)
 S GMRCXR("FILE")=123
"RTN","GMRCYP41",44,0)
 S GMRCXR("NAME")="AE"
"RTN","GMRCYP41",45,0)
 S GMRCXR("TYPE")="R"
"RTN","GMRCYP41",46,0)
 S GMRCXR("USE")="S"
"RTN","GMRCYP41",47,0)
 S GMRCXR("EXECUTION")="R"
"RTN","GMRCYP41",48,0)
 S GMRCXR("ACTIVITY")="IR"
"RTN","GMRCYP41",49,0)
 S GMRCXR("SHORT DESCR")="Index by SERVICE, STATUS, DATE OF REQUEST"
"RTN","GMRCYP41",50,0)
 S GMRCXR("DESCR",1)="This cross reference is used for services to see all consults by service,"
"RTN","GMRCYP41",51,0)
 S GMRCXR("DESCR",2)="OE/RR status and Date of Request."
"RTN","GMRCYP41",52,0)
 S GMRCXR("VAL",1)=1
"RTN","GMRCYP41",53,0)
 S GMRCXR("VAL",1,"SUBSCRIPT")=1
"RTN","GMRCYP41",54,0)
 S GMRCXR("VAL",1,"LENGTH")=5
"RTN","GMRCYP41",55,0)
 S GMRCXR("VAL",1,"COLLATION")="F"
"RTN","GMRCYP41",56,0)
 S GMRCXR("VAL",2)=8
"RTN","GMRCYP41",57,0)
 S GMRCXR("VAL",2,"SUBSCRIPT")=2
"RTN","GMRCYP41",58,0)
 S GMRCXR("VAL",2,"LENGTH")=5
"RTN","GMRCYP41",59,0)
 S GMRCXR("VAL",2,"COLLATION")="F"
"RTN","GMRCYP41",60,0)
 S GMRCXR("VAL",3)=3
"RTN","GMRCYP41",61,0)
 S GMRCXR("VAL",3,"SUBSCRIPT")=3
"RTN","GMRCYP41",62,0)
 S GMRCXR("VAL",3,"LENGTH")=20
"RTN","GMRCYP41",63,0)
 S GMRCXR("VAL",3,"COLLATION")="F"
"RTN","GMRCYP41",64,0)
 S GMRCXR("VAL",3,"XFORM FOR STORAGE")="S X=9999999-X"
"RTN","GMRCYP41",65,0)
 D CREIXN^DDMOD(.GMRCXR,"S",.GMRCRES,"GMRCOUT")
"RTN","GMRCYP41",66,0)
 Q
"VER")
8.0^22.0
**END**
**END**
