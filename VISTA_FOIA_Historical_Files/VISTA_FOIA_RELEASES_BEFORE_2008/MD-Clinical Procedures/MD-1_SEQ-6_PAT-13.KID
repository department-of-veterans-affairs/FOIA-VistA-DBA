Released MD*1*13 SEQ #6
Extracted from mail message
**KIDS**:MD*1.0*13^

**INSTALL NAME**
MD*1.0*13
"BLD",5596,0)
MD*1.0*13^CLINICAL PROCEDURES^0^3060911^y
"BLD",5596,1,0)
^^2^2^3050411^^^
"BLD",5596,1,1,0)
Please refer to the National Patch Module for the detail of this patch 
"BLD",5596,1,2,0)
build.
"BLD",5596,4,0)
^9.64PA^^
"BLD",5596,6.3)
19
"BLD",5596,"ABPKG")
n
"BLD",5596,"INI")

"BLD",5596,"INID")
^^
"BLD",5596,"KRN",0)
^9.67PA^8989.52^19
"BLD",5596,"KRN",.4,0)
.4
"BLD",5596,"KRN",.401,0)
.401
"BLD",5596,"KRN",.402,0)
.402
"BLD",5596,"KRN",.403,0)
.403
"BLD",5596,"KRN",.5,0)
.5
"BLD",5596,"KRN",.84,0)
.84
"BLD",5596,"KRN",3.6,0)
3.6
"BLD",5596,"KRN",3.8,0)
3.8
"BLD",5596,"KRN",9.2,0)
9.2
"BLD",5596,"KRN",9.8,0)
9.8
"BLD",5596,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",5596,"KRN",9.8,"NM",1,0)
MDPS1^^0^B77051543
"BLD",5596,"KRN",9.8,"NM",2,0)
MDPS3^^0^B10769284
"BLD",5596,"KRN",9.8,"NM",3,0)
MDPS4^^0^B13230454
"BLD",5596,"KRN",9.8,"NM",4,0)
MDPS5^^0^B6121176
"BLD",5596,"KRN",9.8,"NM",5,0)
MCORMN^^0^B28222030
"BLD",5596,"KRN",9.8,"NM",6,0)
MDARP3^^0^B16358381
"BLD",5596,"KRN",9.8,"NM",7,0)
MCARPS2^^0^B18407793
"BLD",5596,"KRN",9.8,"NM",8,0)
MCARPS3^^0^B17359352
"BLD",5596,"KRN",9.8,"NM","B","MCARPS2",7)

"BLD",5596,"KRN",9.8,"NM","B","MCARPS3",8)

"BLD",5596,"KRN",9.8,"NM","B","MCORMN",5)

"BLD",5596,"KRN",9.8,"NM","B","MDARP3",6)

"BLD",5596,"KRN",9.8,"NM","B","MDPS1",1)

"BLD",5596,"KRN",9.8,"NM","B","MDPS3",2)

"BLD",5596,"KRN",9.8,"NM","B","MDPS4",3)

"BLD",5596,"KRN",9.8,"NM","B","MDPS5",4)

"BLD",5596,"KRN",19,0)
19
"BLD",5596,"KRN",19.1,0)
19.1
"BLD",5596,"KRN",101,0)
101
"BLD",5596,"KRN",409.61,0)
409.61
"BLD",5596,"KRN",771,0)
771
"BLD",5596,"KRN",870,0)
870
"BLD",5596,"KRN",8989.51,0)
8989.51
"BLD",5596,"KRN",8989.52,0)
8989.52
"BLD",5596,"KRN",8994,0)
8994
"BLD",5596,"KRN","B",.4,.4)

"BLD",5596,"KRN","B",.401,.401)

"BLD",5596,"KRN","B",.402,.402)

"BLD",5596,"KRN","B",.403,.403)

"BLD",5596,"KRN","B",.5,.5)

"BLD",5596,"KRN","B",.84,.84)

"BLD",5596,"KRN","B",3.6,3.6)

"BLD",5596,"KRN","B",3.8,3.8)

"BLD",5596,"KRN","B",9.2,9.2)

"BLD",5596,"KRN","B",9.8,9.8)

"BLD",5596,"KRN","B",19,19)

"BLD",5596,"KRN","B",19.1,19.1)

"BLD",5596,"KRN","B",101,101)

"BLD",5596,"KRN","B",409.61,409.61)

"BLD",5596,"KRN","B",771,771)

"BLD",5596,"KRN","B",870,870)

"BLD",5596,"KRN","B",8989.51,8989.51)

"BLD",5596,"KRN","B",8989.52,8989.52)

"BLD",5596,"KRN","B",8994,8994)

"BLD",5596,"QUES",0)
^9.62^^
"BLD",5596,"REQB",0)
^9.611^1^1
"BLD",5596,"REQB",1,0)
MD*1.0*5^2
"BLD",5596,"REQB","B","MD*1.0*5",1)

"MBREQ")
0
"PKG",365,-1)
1^1
"PKG",365,0)
CLINICAL PROCEDURES^MD^Clinical Procedures
"PKG",365,20,0)
^9.402P^^
"PKG",365,22,0)
^9.49I^1^1
"PKG",365,22,1,0)
1.0^3040429^2980529^363
"PKG",365,22,1,"PAH",1,0)
13^3060911^4558
"PKG",365,22,1,"PAH",1,1,0)
^^2^2^3060911
"PKG",365,22,1,"PAH",1,1,1,0)
Please refer to the National Patch Module for the detail of this patch 
"PKG",365,22,1,"PAH",1,1,2,0)
build.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","MCARPS2")
0^7^B18407793^B18375280
"RTN","MCARPS2",1,0)
MCARPS2 ;SLC/dcm,WAA Summary of patient procedures for CPRS ;4/5/06  09:57
"RTN","MCARPS2",2,0)
 ;;1.0;CLINICAL PROCEDURES;**5,13**;Apr 01, 2004;Build 19
"RTN","MCARPS2",3,0)
 ;Modified from MCARPS1 for CPRS
"RTN","MCARPS2",4,0)
 ; Reference DBIA # 3397 Medicine Report Support from CPRS.
"RTN","MCARPS2",5,0)
 ;                # 2263 XPAR parameter call.
"RTN","MCARPS2",6,0)
EN(DFN) ;Get procedures for a patient
"RTN","MCARPS2",7,0)
 I '$$PATCH^XPDUTL("MD*1.0*2") G MED
"RTN","MCARPS2",8,0)
 I $$FIND1^DIC(9.4,"","MX","MEDICINE") Q:$$GET^XPAR("SYS","MD MEDICINE CONVERTED",1)&$D(S5)
"RTN","MCARPS2",9,0)
 N MCGLB,MCBLK,MCRT K ^TMP("OR",$J,"MCAR") S MCGLB=$NA(^TMP("OR",$J,"MCAR","OT"))
"RTN","MCARPS2",10,0)
 S MCBLK="" I '$D(S5) D EN1^MDPS1(.MCGLB,DFN,MCBLK,MCBLK,99999,MCBLK,MCBLK) Q
"RTN","MCARPS2",11,0)
 I $D(S5) G MED
"RTN","MCARPS2",12,0)
 Q
"RTN","MCARPS2",13,0)
MED S WH=""
"RTN","MCARPS2",14,0)
 K ^TMP("OR",$J,"MCAR") S S4="" F M=1:1 S S4=$O(^MCAR(690,"AC",DFN,S4)) Q:S4=""  D LOCFIL
"RTN","MCARPS2",15,0)
 D PR0
"RTN","MCARPS2",16,0)
 Q
"RTN","MCARPS2",17,0)
LOCFIL G LOCFIL1:$D(S5) S S5="" F K=1:1 S S5=$O(^MCAR(690,"AC",DFN,S4,S5)) Q:S5=""  D LOCFIL1
"RTN","MCARPS2",18,0)
 K S5 Q
"RTN","MCARPS2",19,0)
LOCFIL1 S S6="" F L=1:1 S S6=$O(^MCAR(690,"AC",DFN,S4,S5,S6)) Q:S6=""  D CONT
"RTN","MCARPS2",20,0)
 Q
"RTN","MCARPS2",21,0)
CONT ;CONT+1 modified on 2-7-94,S MCFILE..2) added to conform w/alpha site
"RTN","MCARPS2",22,0)
 Q:$O(^MDD(702,"ACONV",S6_";"_S5_",",0))
"RTN","MCARPS2",23,0)
 I $D(^MCAR(+$P(S5,"(",2),S6,2005)) S MCFILE=+$P(S5,"(",2) D SUM^MCMAG
"RTN","MCARPS2",24,0)
 I S5="MCAR(702.7" Q
"RTN","MCARPS2",25,0)
 I S5="MCAR(699" S (LL,LL1)=$P($G(^MCAR(699,S6,0)),U,12) Q:LL'>0  S LL=$P($G(^MCAR(697.2,LL,0)),U) G:'$D(PE) CONT1 Q:PE'=LL  G CONT1
"RTN","MCARPS2",26,0)
 ;I S5="MCAR(699.5" S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1  ;MC*2.3*8
"RTN","MCARPS2",27,0)
 I S5="MCAR(699.5",'$D(PE) D  Q  ;MC*2.3*8
"RTN","MCARPS2",28,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MCARPS2",29,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U) D CONT1
"RTN","MCARPS2",30,0)
 I S5="MCAR(699.5",$D(PE) D  Q  ;MC*2.3*8
"RTN","MCARPS2",31,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MCARPS2",32,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U)
"RTN","MCARPS2",33,0)
 .N LLX,LLY
"RTN","MCARPS2",34,0)
 .S LLX=$O(^MCAR(697.2,"B",PE,0)) Q:'LLX  S LLY=$P($G(^MCAR(697.2,LLX,1)),U)
"RTN","MCARPS2",35,0)
 .I LLY="S",LLX=LL6 D CONT1
"RTN","MCARPS2",36,0)
 .I LLY="P",LLX=LL8 D CONT1
"RTN","MCARPS2",37,0)
 I S5[694 S (LL,LL1)=$P($G(^MCAR(694,S6,0)),U,3) Q:'LL  S LL=$P(^MCAR(697.2,LL,0),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1
"RTN","MCARPS2",38,0)
 ;MFD 2/5/93 I S5[700,$P($G(^MCAR(700,S6,2)),U)'="Y" Q  ;    exclude unreleased PFT
"RTN","MCARPS2",39,0)
 S (LL,LL1)=$O(^MCAR(697.2,"C",S5,0)),LL=$P(^MCAR(697.2,LL,0),U,1)
"RTN","MCARPS2",40,0)
CONT1 ;
"RTN","MCARPS2",41,0)
 S REC=$O(^MCAR(697.2,"B",LL,0)) S:REC="" REC=0
"RTN","MCARPS2",42,0)
 S MCARCODE=""
"RTN","MCARPS2",43,0)
 S MCESON=$P($G(^MCAR(697.2,REC,0)),U,14),MCESKEY=$P($G(^MCAR(697.2,REC,0)),U,15),MCSUP=+$P($G(^MCAR(697.2,REC,0)),U,16)
"RTN","MCARPS2",44,0)
 S (MCARSUM,MCARPSUM)="",MCARFILE=U_S5_","_S6_",.2)" S:$D(@MCARFILE) MCARSUM=$P(@MCARFILE,U,1),MCARPSUM=$P(@MCARFILE,U,2)
"RTN","MCARPS2",45,0)
 K MCARFILE S S1=$S(WH="P":LL,1:S4),S2=$S(WH="P":S4,1:LL)
"RTN","MCARPS2",46,0)
 S MCFILE=+$P(S5,"(",2)
"RTN","MCARPS2",47,0)
 I MCESON,($G(MCESKEY)'=""),('$$SCRSUMPT^MCESSCR(MCESKEY,S6,MCSUP)) K MCARSUM,MCARPSUM,MCFILE,REC,MCSUP Q
"RTN","MCARPS2",48,0)
 I '$$VALID^MCARUTL5(S5,S6,DFN) Q  ; MC*2.3*33
"RTN","MCARPS2",49,0)
 I $P($G(@(U_S5_","_S6_",""ES"")")),U,7)="S" G EXIT  ;MC*2.3*8
"RTN","MCARPS2",50,0)
 S S2=S2_U_S6  ;MC*2.3*8
"RTN","MCARPS2",51,0)
 S ^TMP("OR",$J,"MCAR",S1,S2)=MCARSUM_U_S6_U_$P(^MCAR(697.2,LL1,0),U,5,7)
"RTN","MCARPS2",52,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^CONSULTS" ; MC*2.3*33
"RTN","MCARPS2",53,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^NONENDO" ; MC*2.3*33
"RTN","MCARPS2",54,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^GI" ; MC*2.3*33
"RTN","MCARPS2",55,0)
 I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^PARAC" ; MC*2.3*33
"RTN","MCARPS2",56,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,10)=MCARPSUM
"RTN","MCARPS2",57,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,11)=LL
"RTN","MCARPS2",58,0)
 I S5="MCAR(699.5" D  ;MC*2.3*8
"RTN","MCARPS2",59,0)
 .I LL8="" S LL8=" "
"RTN","MCARPS2",60,0)
 .S $P(^TMP("OR",$J,"MCAR",S1,S2),U,12)=$E(($E($P($G(^MCAR(697.2,LL6,0)),U,8),1,13)_"/"_$P($G(^MCAR(697.2,LL8,0)),U)),1,31) K LL6,LL8
"RTN","MCARPS2",61,0)
EXIT K MCARSUM,MCARPSUM,REC,MCSUP,MCESON Q
"RTN","MCARPS2",62,0)
PR0 S I="",L=0
"RTN","MCARPS2",63,0)
 F  S I=$O(^TMP("OR",$J,"MCAR",I)) Q:I=""  I I'="OT" D
"RTN","MCARPS2",64,0)
 . S J="" F  S J=$O(^TMP("OR",$J,"MCAR",I,J)) Q:J=""  S PR=^(J) D
"RTN","MCARPS2",65,0)
 .. Q:$P(PR,U,3,5)="^^"  ; MC*2.3*33
"RTN","MCARPS2",66,0)
 .. S MCARDT=$S(WH="P":$P(J,U),1:I),MCARPROC=$S(WH="P":I,1:$P(J,U))
"RTN","MCARPS2",67,0)
 .. S MCARPROC=$O(^MCAR(697.2,"B",MCARPROC,0)),MCARPROC=$P(^MCAR(697.2,MCARPROC,0),U,8)
"RTN","MCARPS2",68,0)
 .. I $P(PR,U,12)'="" S MCARPROC=$P(PR,U,12)
"RTN","MCARPS2",69,0)
 .. S DA=$P(PR,U,2),K=$P(PR,U),M=$P(PR,U,10)
"RTN","MCARPS2",70,0)
 .. S K=$S(K="N"!(K="L"):"NORMAL",K="A":"ABNORMAL",K="B":"BORDERLINE",K="T":"TECHNICALLY UNSATISFACTORY",K="ND":"NON-DIAGNOSTIC",K="MI":"MILDLY ABNORMAL",K="MO":"MODERATELY ABNORMAL",K="S":"SEVERELY ABNORMAL",1:"")
"RTN","MCARPS2",71,0)
 .. S Y=9999999.9999-MCARDT X ^DD("DD")
"RTN","MCARPS2",72,0)
 .. S L=L+1 S ^TMP("OR",$J,"MCAR","OT",L)=MCARPROC_U_DA_U_$P(PR,U,3,5)_U_J S $P(^(L),U,6)=Y,$P(^(L),U,7)=K,$P(^(L),U,10)=M,$P(^(L),U,11)=$S(WH="P":I_U_$P(J,U,2),1:J)
"RTN","MCARPS2",73,0)
 Q
"RTN","MCARPS3")
0^8^B17359352^B17072262
"RTN","MCARPS3",1,0)
MCARPS3 ; HOIFO/NCA - Get Procedures for Medicine and CP ;1/13/04  14:35
"RTN","MCARPS3",2,0)
 ;;1.0;CLINICAL PROCEDURES;**5,13**;Apr 01, 2004;Build 19
"RTN","MCARPS3",3,0)
 ;Modified from MCARPS2 for CPRS
"RTN","MCARPS3",4,0)
 ; Please Reference DBIA # 3397
"RTN","MCARPS3",5,0)
EN(MCDFN,CODE,MDSDT,MDEDT) ;Get procedures for a patient
"RTN","MCARPS3",6,0)
 Q:$$GET^XPAR("SYS","MD MEDICINE CONVERTED",1)
"RTN","MCARPS3",7,0)
 S WH="" K ^TMP("OR",$J,"MCAR")
"RTN","MCARPS3",8,0)
 N MDGBL,MDPTR
"RTN","MCARPS3",9,0)
 S MDGBL="^MCAR(690,""AC"",MCDFN)"
"RTN","MCARPS3",10,0)
 F  S MDGBL=$Q(@MDGBL) Q:MDGBL=""  Q:$QS(MDGBL,3)'=MCDFN  D
"RTN","MCARPS3",11,0)
 .S MDPTR=$QS(MDGBL,6)_";"_$QS(MDGBL,5)_",",S4=$QS(MDGBL,4),S5=$QS(MDGBL,5),S6=$QS(MDGBL,6)
"RTN","MCARPS3",12,0)
 .D CONT
"RTN","MCARPS3",13,0)
 D PR0
"RTN","MCARPS3",14,0)
 K S5 Q
"RTN","MCARPS3",15,0)
CONT ;CONT+1 modified on 2-7-94,S MCFILE..2) added to conform w/alpha site
"RTN","MCARPS3",16,0)
 Q:$O(^MDD(702,"ACONV",S6_";"_S5_",",0))
"RTN","MCARPS3",17,0)
 I $D(^MCAR(+$P(S5,"(",2),S6,2005)) S MCFILE=+$P(S5,"(",2) D SUM^MCMAG
"RTN","MCARPS3",18,0)
 I S5="MCAR(702.7" Q
"RTN","MCARPS3",19,0)
 I S5="MCAR(699" S (LL,LL1)=$P($G(^MCAR(699,S6,0)),U,12) Q:LL'>0  S LL=$P($G(^MCAR(697.2,LL,0)),U) G:'$D(PE) CONT1 Q:PE'=LL  G CONT1
"RTN","MCARPS3",20,0)
 I S5="MCAR(699.5",'$D(PE) D  Q  ;MC*2.3*8
"RTN","MCARPS3",21,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MCARPS3",22,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U) D CONT1
"RTN","MCARPS3",23,0)
 I S5="MCAR(699.5",$D(PE) D  Q  ;MC*2.3*8
"RTN","MCARPS3",24,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MCARPS3",25,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U)
"RTN","MCARPS3",26,0)
 .N LLX,LLY
"RTN","MCARPS3",27,0)
 .S LLX=$O(^MCAR(697.2,"B",PE,0)) Q:'LLX  S LLY=$P($G(^MCAR(697.2,LLX,1)),U)
"RTN","MCARPS3",28,0)
 .I LLY="S",LLX=LL6 D CONT1
"RTN","MCARPS3",29,0)
 .I LLY="P",LLX=LL8 D CONT1
"RTN","MCARPS3",30,0)
 I S5[694 S (LL,LL1)=$P($G(^MCAR(694,S6,0)),U,3) Q:'LL  S LL=$P(^MCAR(697.2,LL,0),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1
"RTN","MCARPS3",31,0)
 ;MFD 2/5/93 I S5[700,$P($G(^MCAR(700,S6,2)),U)'="Y" Q  ;    exclude unreleased PFT
"RTN","MCARPS3",32,0)
 S (LL,LL1)=$O(^MCAR(697.2,"C",S5,0)),LL=$P(^MCAR(697.2,LL,0),U,1)
"RTN","MCARPS3",33,0)
CONT1 ;
"RTN","MCARPS3",34,0)
 S REC=$O(^MCAR(697.2,"B",LL,0)) S:REC="" REC=0
"RTN","MCARPS3",35,0)
 S MCARCODE=""
"RTN","MCARPS3",36,0)
 S MCESON=$P($G(^MCAR(697.2,REC,0)),U,14),MCESKEY=$P($G(^MCAR(697.2,REC,0)),U,15),MCSUP=+$P($G(^MCAR(697.2,REC,0)),U,16)
"RTN","MCARPS3",37,0)
 S (MCARSUM,MCARPSUM)="",MCARFILE=U_S5_","_S6_",.2)" S:$D(@MCARFILE) MCARSUM=$P(@MCARFILE,U,1),MCARPSUM=$P(@MCARFILE,U,2)
"RTN","MCARPS3",38,0)
 K MCARFILE S S1=$S(WH="P":LL,1:S4),S2=$S(WH="P":S4,1:LL)
"RTN","MCARPS3",39,0)
 S MCFILE=+$P(S5,"(",2)
"RTN","MCARPS3",40,0)
 I MCESON,($G(MCESKEY)'=""),('$$SCRSUMPT^MCESSCR(MCESKEY,S6,MCSUP)) K MCARSUM,MCARPSUM,MCFILE,REC,MCSUP Q
"RTN","MCARPS3",41,0)
 I '$$VALID^MCARUTL5(S5,S6,MCDFN) Q  ; MC*2.3*33
"RTN","MCARPS3",42,0)
 I $P($G(@(U_S5_","_S6_",""ES"")")),U,7)="S" G EXIT  ;MC*2.3*8
"RTN","MCARPS3",43,0)
 S S2=S2_U_S6  ;MC*2.3*8
"RTN","MCARPS3",44,0)
 S ^TMP("OR",$J,"MCAR",S1,S2)=MCARSUM_U_S6_";"_S5_","_U_$P(^MCAR(697.2,LL1,0),U,5,7)
"RTN","MCARPS3",45,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^CONSULTS" ; MC*2.3*33
"RTN","MCARPS3",46,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^NONENDO" ; MC*2.3*33
"RTN","MCARPS3",47,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^GI" ; MC*2.3*33
"RTN","MCARPS3",48,0)
 I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^PARAC" ; MC*2.3*33
"RTN","MCARPS3",49,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,10)=MCARPSUM
"RTN","MCARPS3",50,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,11)=LL
"RTN","MCARPS3",51,0)
 I S5="MCAR(699.5" D  ;MC*2.3*8
"RTN","MCARPS3",52,0)
 .I LL8="" S LL8=" "
"RTN","MCARPS3",53,0)
 .S $P(^TMP("OR",$J,"MCAR",S1,S2),U,12)=$E(($E($P($G(^MCAR(697.2,LL6,0)),U,8),1,13)_"/"_$P($G(^MCAR(697.2,LL8,0)),U)),1,31) K LL6,LL8
"RTN","MCARPS3",54,0)
EXIT K MCARSUM,MCARPSUM,REC,MCSUP,MCESON Q
"RTN","MCARPS3",55,0)
PR0 S I="",L=0
"RTN","MCARPS3",56,0)
 F  S I=$O(^TMP("OR",$J,"MCAR",I)) Q:I=""  I I'="OT" D
"RTN","MCARPS3",57,0)
 . S J="" F  S J=$O(^TMP("OR",$J,"MCAR",I,J)) Q:J=""  S PR=^(J) D
"RTN","MCARPS3",58,0)
 .. Q:$P(PR,U,3,5)="^^"  ; MC*2.3*33
"RTN","MCARPS3",59,0)
 .. S MCARDT=$S(WH="P":$P(J,U),1:I),MCARPROC=$S(WH="P":I,1:$P(J,U))
"RTN","MCARPS3",60,0)
 .. S MCARPROC=$O(^MCAR(697.2,"B",MCARPROC,0)),MCARPROC=$P(^MCAR(697.2,MCARPROC,0),U,8)
"RTN","MCARPS3",61,0)
 .. I $P(PR,U,12)'="" S MCARPROC=$P(PR,U,12)
"RTN","MCARPS3",62,0)
 .. S DA=$P(PR,U,2),K=$P(PR,U),M=$P(PR,U,10)
"RTN","MCARPS3",63,0)
 .. S K=$S(K="N"!(K="L"):"NORMAL",K="A":"ABNORMAL",K="B":"BORDERLINE",K="T":"TECHNICALLY UNSATISFACTORY",K="ND":"NON-DIAGNOSTIC",K="MI":"MILDLY ABNORMAL",K="MO":"MODERATELY ABNORMAL",K="S":"SEVERELY ABNORMAL",1:"")
"RTN","MCARPS3",64,0)
 ..I CODE'="" Q:CODE'=K
"RTN","MCARPS3",65,0)
 ..I +$G(MDSDT) Q:(9999999.9999-MCARDT)<+$G(MDSDT)
"RTN","MCARPS3",66,0)
 ..I +$G(MDEDT) Q:(9999999.9999-MCARDT)>+$G(MDEDT)
"RTN","MCARPS3",67,0)
 ..N MCDT S MCDT=MCARDT,Y=9999999.9999-MCARDT X ^DD("DD")
"RTN","MCARPS3",68,0)
 ..S L=MCARPROC_"~"_DA
"RTN","MCARPS3",69,0)
 ..S ^TMP("MDPLST",$J,MCDT,L)=MCARPROC_U_+DA_U_"PR690^MDPS1"_U_$P(PR,U,5)_U_J S $P(^(L),U,6)=Y,$P(^(L),U,7)=K,$P(^(L),U,10)=M,$P(^(L),U,11)=$S(WH="P":I_U_$P(J,U,2),1:J)
"RTN","MCARPS3",70,0)
 K ^TMP("OR",$J,"MCAR")
"RTN","MCARPS3",71,0)
 Q
"RTN","MCORMN")
0^5^B28222030^B27253923
"RTN","MCORMN",1,0)
MCORMN ;WISC/DCB-Front-end for Health Summary ;4/26/04  11:54
"RTN","MCORMN",2,0)
 ;;1.0;CLINICAL PROCEDURES;**5,13**;Apr 01, 2004;Build 19
"RTN","MCORMN",3,0)
 ; Reference IA #1236 for Medicine and Health Summary interface.
"RTN","MCORMN",4,0)
 ;              #3778 for Medicine and Health Summary interface for RDV
"RTN","MCORMN",5,0)
 ;              #10070 for XMD API call.
"RTN","MCORMN",6,0)
 ;              #10064 for XM call.
"RTN","MCORMN",7,0)
 ;              #10090 DIC(4) Read Access.
"RTN","MCORMN",8,0)
 ;              #10106 for HLFNC calls.
"RTN","MCORMN",9,0)
 ;              #10113 for Access to ^XMB(3.9,#,2)
"RTN","MCORMN",10,0)
HL7(MESSNUMB) ;This is the HL7 entry point for queries
"RTN","MCORMN",11,0)
 N MSH,TEMP,ORD,ST,MSTR,BDATE,EDATE,OCC,PROC,PATID,MCTDEC,XMZ,MCLINE
"RTN","MCORMN",12,0)
 N QDT,QFC,QP,QID,RAP,GNODE,ATYPE
"RTN","MCORMN",13,0)
 Q:+MESSNUMB=0 0
"RTN","MCORMN",14,0)
 S GNODE="^XMB(3.9,"_MESSNUMB_",2)"
"RTN","MCORMN",15,0)
 S MSH=$G(@GNODE@(1,0)) I MSH="" D ERROR Q 0
"RTN","MCORMN",16,0)
 S MSTR=$E(MSH,4,9) D SLIP^MCORMN0(MSTR)
"RTN","MCORMN",17,0)
 S QRD=$G(@GNODE@(2,0)) I QRD="" D ERROR Q 0
"RTN","MCORMN",18,0)
 S QFC=$P(QRD,ST(1),3) I QFC'="R" D ERROR Q 0
"RTN","MCORMN",19,0)
 S QLR=$P(QRD,ST(1),8),OCC=$P(QLR,ST(2),2),ATYPE=$P(QLR,ST(2),1)
"RTN","MCORMN",20,0)
 S PATID=+$P(QRD,ST(1),9)
"RTN","MCORMN",21,0)
 I '$D(^MCAR(690,"AC",PATID)) D ERROR Q ""
"RTN","MCORMN",22,0)
 S PROC=$P(QRD,ST(1),11)
"RTN","MCORMN",23,0)
 S TEMP=$P(QRD,ST(1),12) S BDATE=$P(TEMP,ST(2),1),EDATE=$P(TEMP,ST(2),2)
"RTN","MCORMN",24,0)
 S BDATE=$$FMDATE^HLFNC(BDATE),EDATE=$$FMDATE^HLFNC(EDATE)
"RTN","MCORMN",25,0)
 S RAP=$P(MSH,ST(1),3)
"RTN","MCORMN",26,0)
 S MCTDEC="^TMP(""MCAR1"",$J)",GLOBAL=1
"RTN","MCORMN",27,0)
 D HSUM(RAP,PATID,BDATE,EDATE,OCC,PROC,MSTR,MCTDEC,.GLOBAL,ATYPE)
"RTN","MCORMN",28,0)
 I GLOBAL=0 S ^TMP("MCAR1",$J,1)="" Q 0
"RTN","MCORMN",29,0)
 I GLOBAL'=0 D
"RTN","MCORMN",30,0)
 .S XMSUB="Medicine Response",XMDUN="Medicine",XMDUZ=.5
"RTN","MCORMN",31,0)
 .S XMTEXT="^TMP(""MCAR1"",$J,",XMY("G.MC MESSAGING SERVER")=""
"RTN","MCORMN",32,0)
 .;S XMY(DUZ)=""
"RTN","MCORMN",33,0)
 .D ^XMD
"RTN","MCORMN",34,0)
 .S GLOBAL=+$G(XMZ)
"RTN","MCORMN",35,0)
 D KILL^XM
"RTN","MCORMN",36,0)
 K ^TMP("MCAR1",$J)
"RTN","MCORMN",37,0)
 Q GLOBAL
"RTN","MCORMN",38,0)
ERROR ;HL7 Messaging Error
"RTN","MCORMN",39,0)
 D KILL^XM Q
"RTN","MCORMN",40,0)
SERVER ;A do nothing routine
"RTN","MCORMN",41,0)
 Q
"RTN","MCORMN",42,0)
HSUM(RAP,PATID,BDATE,EDATE,OCC,PE,MSTR,MCTDEC,GLOBAL,ATYPE) ;Sending Message Builder
"RTN","MCORMN",43,0)
 N LOC,REC,RNF,SNF,SAP,MST,PCI,VID,MCDFN,TMP,ENDDATE,BEGDATE,MCIMAGE
"RTN","MCORMN",44,0)
 N LOOP,DFN,COUNT,MCPROC,MCFILE,PREC,SENDATE,FILE,MCREC,MCDEST
"RTN","MCORMN",45,0)
 N MCER,MCERR,MCVAL,TEMP,WH,S5
"RTN","MCORMN",46,0)
 I +PATID'=PATID S GLOBAL=0 Q
"RTN","MCORMN",47,0)
 I '$D(^MCAR(690,"AC",PATID))&('$D(^MDD(702,"B",PATID))) S GLOBAL=0 Q
"RTN","MCORMN",48,0)
 I PE'="" D
"RTN","MCORMN",49,0)
 .S S5=+$O(^MCAR(697.2,"B",PE,0))
"RTN","MCORMN",50,0)
 .S S5=$P($G(^MCAR(697.2,S5,0)),U,2)
"RTN","MCORMN",51,0)
 .I S5="" S PE="" K S5
"RTN","MCORMN",52,0)
 S MCVAL=DUZ(2),REC=$$FIND1^DIC(4,"","X",MCVAL,"D","","MCER")
"RTN","MCORMN",53,0)
 S LOC=$S(+REC:$$GET1^DIQ(4,+REC_",",.01),1:"")
"RTN","MCORMN",54,0)
 S (RNF,SNF)=LOC
"RTN","MCORMN",55,0)
 S SAP="Medicine",MST="HS",PCI="P"
"RTN","MCORMN",56,0)
 S VID=$P($T(+2),";",3),MCDFN=PATID,MCLINE=0
"RTN","MCORMN",57,0)
 S:EDATE="" EDATE=9999999.9999
"RTN","MCORMN",58,0)
 S:BDATE="" BDATE=0
"RTN","MCORMN",59,0)
 S:+OCC=0 OCC=999999
"RTN","MCORMN",60,0)
 I EDATE<BDATE S TEMP=EDATE,EDATE=BDATE,BDATE=TEMP
"RTN","MCORMN",61,0)
 S ENDDATE=(9999999.9999-EDATE)-.00001
"RTN","MCORMN",62,0)
 S BEGDATE=(9999999.9999-BDATE)+.00001
"RTN","MCORMN",63,0)
 S LOOP=ENDDATE,COUNT=0
"RTN","MCORMN",64,0)
 N L,LL,LL1,K,M,PE,REC,S1,S2,S4,S6
"RTN","MCORMN",65,0)
 N MCARCODE,MCARFILE,MCARPSUM,MCARSUM,MCESKEY,MCESON,MCSUP,MCESSEC
"RTN","MCORMN",66,0)
 S MCIMAGE=""
"RTN","MCORMN",67,0)
 K ^TMP("MCAR",$J)
"RTN","MCORMN",68,0)
 S DFN=PATID,WH="P" D ^MCARPS1
"RTN","MCORMN",69,0)
PROCN ;
"RTN","MCORMN",70,0)
 N MCRESULT,MDHOLDR,MCROU
"RTN","MCORMN",71,0)
 I $$PATCH^XPDUTL("MD*1.0*2")!('$$FIND1^DIC(9.4,"","MX","MEDICINE")) D
"RTN","MCORMN",72,0)
 .S MDRDV=1 K ^TMP("MDPLST",$J)
"RTN","MCORMN",73,0)
 .S MCRESULT=$NA(^TMP("MDPLST",$J)) N MCLP,MCLP1,MCXG
"RTN","MCORMN",74,0)
 .S MCROU="D GET702^MDPS3(.MCRESULT,PATID,"""",BDATE,EDATE,OCC)"
"RTN","MCORMN",75,0)
 .X MCROU
"RTN","MCORMN",76,0)
 .S MCLP="" F  S MCLP=$O(^TMP("MDPLST",$J,MCLP)) Q:MCLP=""  S MCLP1="" F  S MCLP1=$O(^TMP("MDPLST",$J,MCLP,MCLP1)) Q:MCLP1=""  S MCXG=$G(^(MCLP1)) D
"RTN","MCORMN",77,0)
 ..S:$G(^TMP("MCAR",$J,MCLP,MCLP1))="" ^TMP("MCAR",$J,MCLP,MCLP1)=MCXG
"RTN","MCORMN",78,0)
 .K ^TMP("MDPLST",$J)
"RTN","MCORMN",79,0)
 S MCPROC="",COUNT=0 N MCG
"RTN","MCORMN",80,0)
 F  S MCPROC=$O(^TMP("MCAR",$J,MCPROC)) Q:MCPROC=""  D
"RTN","MCORMN",81,0)
 .S MCDTIME=ENDDATE
"RTN","MCORMN",82,0)
 .F  S MCDTIME=$O(^TMP("MCAR",$J,MCPROC,MCDTIME)) Q:MCDTIME=""  Q:COUNT'<OCC  Q:MCDTIME>BEGDATE  S MCG=$G(^(MCDTIME)) D
"RTN","MCORMN",83,0)
 ..S MCREC=$P(MCG,U,2) Q:+MCREC=0
"RTN","MCORMN",84,0)
 ..S MCDEST=MCTDEC,SENDATE=9999999.9999-MCDTIME,MDHOLDR=MCPROC
"RTN","MCORMN",85,0)
 ..I +$G(BDATE) Q:SENDATE<+$G(BDATE)
"RTN","MCORMN",86,0)
 ..I +$G(EDATE) Q:SENDATE>+$G(EDATE)
"RTN","MCORMN",87,0)
 ..I $P(MCG,U,4)["MDPS1" S MCARGDA=+$P(MCG,U,2) Q:'MCARGDA  D PR690 S COUNT=COUNT+1,MCPROC=MDHOLDR Q
"RTN","MCORMN",88,0)
 ..I $P(MCG,U,4)["MDPS4" S MCARGDA=+$P(MCG,U,2) Q:'MCARGDA  D PR690 S COUNT=COUNT+1,MCPROC=MDHOLDR Q
"RTN","MCORMN",89,0)
 ..S PREC=$O(^MCAR(697.2,"B",MCPROC,"")) Q:PREC=""
"RTN","MCORMN",90,0)
 ..S FILE=$P($G(^MCAR(697.2,PREC,0)),U,2) Q:FILE=""
"RTN","MCORMN",91,0)
 ..S MCFILE=+$P(FILE,"MCAR(",2)
"RTN","MCORMN",92,0)
 ..S MCERR=$$BUILD^MCORMN0(RAP,DFN,SAP,SNF,RNF,MST,PCI,VID,.MCLINE,MSTR,MCDEST,MCPROC,MCFILE,MCREC,SENDATE,ATYPE)
"RTN","MCORMN",93,0)
 ..S:MCERR=0 COUNT=COUNT+1
"RTN","MCORMN",94,0)
 K ^TMP("MCAR",$J),^TMP("MDPTXT",$J),MCPRO,MCARPPS,MCARGRTN,MDT,MDHDR,MDRDV
"RTN","MCORMN",95,0)
 Q
"RTN","MCORMN",96,0)
PR690 ; Set node for CP Reports
"RTN","MCORMN",97,0)
 N HLECH,MCRREC,ST
"RTN","MCORMN",98,0)
 S MCPRO=$P(MCG,U,11),MCARPPS=$P(MCG,U,3,4),MCARGRTN=$P(MCG,U,5),MDT="RD",MDHDR=1
"RTN","MCORMN",99,0)
 S HLECH=$E(MSTR,2,4) D SLIP^MCORMN0(MSTR)
"RTN","MCORMN",100,0)
 D SETNODE(MCDEST,$$MSH^MCORMN01(MCPROC,SAP,SNF,RAP,RNF,MST,PCI,VID))
"RTN","MCORMN",101,0)
 D SETNODE(MCDEST,$$PID^MCORMN01(MCDFN))
"RTN","MCORMN",102,0)
 D SETNODE(MCDEST,$$OBR1(SENDATE,MCPROC,HLECH))
"RTN","MCORMN",103,0)
 D SETNODE(MCDEST,$$OBX1^MCORMN01("W","ST","702~.1~702.1^^DD",1,""))
"RTN","MCORMN",104,0)
 D @MCARPPS S MCRREC=$NA(^TMP("MDPTXT",$J))
"RTN","MCORMN",105,0)
 F  S MCRREC=$Q(@MCRREC) Q:MCRREC=""  Q:$QS(MCRREC,1)'="MDPTXT"  D
"RTN","MCORMN",106,0)
 .D SETNODE(MCTDEC,$G(@MCRREC))
"RTN","MCORMN",107,0)
 D SETNODE(MCDEST,"||")
"RTN","MCORMN",108,0)
 Q
"RTN","MCORMN",109,0)
OBR1(SDATE,MCPROC,HLECH) ; OBX Messaging Line
"RTN","MCORMN",110,0)
 N LOOP,TEMP,TMP,STAT,STR
"RTN","MCORMN",111,0)
 S TMP="OTH"
"RTN","MCORMN",112,0)
 S STAT="COMPLETE"
"RTN","MCORMN",113,0)
 S TEMP=$$CONVERT^MCORMN01("D",SDATE),STR="OBR",$P(STR,ST(1),8)=TEMP
"RTN","MCORMN",114,0)
 S $P(STR,ST(1),16)=TMP,$P(STR,ST(1),26)=STAT
"RTN","MCORMN",115,0)
 Q STR
"RTN","MCORMN",116,0)
SETNODE(NODE,VALUE) ; Set the node with the HL7 message string
"RTN","MCORMN",117,0)
 S MCLINE=MCLINE+1,@NODE@(MCLINE,0)=VALUE
"RTN","MCORMN",118,0)
 Q
"RTN","MCORMN",119,0)
HL1(MCSAP,MCDFN,MCB,MCE,MCOCC,MCTYP) ; Alternate Entry Point for Data View
"RTN","MCORMN",120,0)
 N MSH,TEMP,ORD,ST,MSTR,BDATE,EDATE,OCC,PROC,PATID,MCTDEC,XMZ,MCLINE
"RTN","MCORMN",121,0)
 N QDT,QFC,QP,QID,RAP,GNODE,ATYPE
"RTN","MCORMN",122,0)
 S GLOBAL=1 K ^TMP("MCAR1",$J)
"RTN","MCORMN",123,0)
 D HSUM(MCSAP,MCDFN,MCB,MCE,MCOCC,"","|^~\&|","^TMP(""MCAR1"",$J)",.GLOBAL,MCTYP)
"RTN","MCORMN",124,0)
 I GLOBAL=0 S ^TMP("MCAR1",$J,1,0)=""
"RTN","MCORMN",125,0)
 Q
"RTN","MDARP3")
0^6^B16358381^B16081083
"RTN","MDARP3",1,0)
MDARP3 ; HOIFO/NCA - Get Procedures for Medicine ;1/13/04  14:35
"RTN","MDARP3",2,0)
 ;;1.0;CLINICAL PROCEDURES;**10,13**;Apr 01, 2004;Build 19
"RTN","MDARP3",3,0)
 ; Please Reference DBIA # 3397
"RTN","MDARP3",4,0)
EN(MCDFN,CODE) ;Get procedures for a patient
"RTN","MDARP3",5,0)
 Q:$$GET^XPAR("SYS","MD MEDICINE CONVERTED",1)
"RTN","MDARP3",6,0)
 S WH="" K ^TMP("OR",$J,"MCAR")
"RTN","MDARP3",7,0)
 N MDGBL,MDPTR
"RTN","MDARP3",8,0)
 S MDGBL="^MCAR(690,""AC"",MCDFN)"
"RTN","MDARP3",9,0)
 F  S MDGBL=$Q(@MDGBL) Q:MDGBL=""  Q:$QS(MDGBL,3)'=MCDFN  D
"RTN","MDARP3",10,0)
 .S MDPTR=$QS(MDGBL,6)_";"_$QS(MDGBL,5)_",",S4=$QS(MDGBL,4),S5=$QS(MDGBL,5),S6=$QS(MDGBL,6)
"RTN","MDARP3",11,0)
 .D CONT
"RTN","MDARP3",12,0)
 D PR0
"RTN","MDARP3",13,0)
 K S5 Q
"RTN","MDARP3",14,0)
CONT ;CONT+1 modified on 2-7-94,S MCFILE..2) added to conform w/alpha site
"RTN","MDARP3",15,0)
 Q:$O(^MDD(702,"ACONV",S6_";"_S5_",",0))
"RTN","MDARP3",16,0)
 I $D(^MCAR(+$P(S5,"(",2),S6,2005)) S MCFILE=+$P(S5,"(",2) D SUM^MCMAG
"RTN","MDARP3",17,0)
 I S5="MCAR(702.7" Q
"RTN","MDARP3",18,0)
 I S5="MCAR(699" S (LL,LL1)=$P($G(^MCAR(699,S6,0)),U,12) Q:LL'>0  S LL=$P($G(^MCAR(697.2,LL,0)),U) G:'$D(PE) CONT1 Q:PE'=LL  G CONT1
"RTN","MDARP3",19,0)
 I S5="MCAR(699.5",'$D(PE) D  Q  ;MC*2.3*8
"RTN","MDARP3",20,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MDARP3",21,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U) D CONT1
"RTN","MDARP3",22,0)
 I S5="MCAR(699.5",$D(PE) D  Q  ;MC*2.3*8
"RTN","MDARP3",23,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MDARP3",24,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U)
"RTN","MDARP3",25,0)
 .N LLX,LLY
"RTN","MDARP3",26,0)
 .S LLX=$O(^MCAR(697.2,"B",PE,0)) Q:'LLX  S LLY=$P($G(^MCAR(697.2,LLX,1)),U)
"RTN","MDARP3",27,0)
 .I LLY="S",LLX=LL6 D CONT1
"RTN","MDARP3",28,0)
 .I LLY="P",LLX=LL8 D CONT1
"RTN","MDARP3",29,0)
 I S5[694 S (LL,LL1)=$P($G(^MCAR(694,S6,0)),U,3) Q:'LL  S LL=$P(^MCAR(697.2,LL,0),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1
"RTN","MDARP3",30,0)
 ;MFD 2/5/93 I S5[700,$P($G(^MCAR(700,S6,2)),U)'="Y" Q  ;    exclude unreleased PFT
"RTN","MDARP3",31,0)
 S (LL,LL1)=$O(^MCAR(697.2,"C",S5,0)),LL=$P(^MCAR(697.2,LL,0),U,1)
"RTN","MDARP3",32,0)
CONT1 ;
"RTN","MDARP3",33,0)
 S REC=$O(^MCAR(697.2,"B",LL,0)) S:REC="" REC=0
"RTN","MDARP3",34,0)
 S MCARCODE=""
"RTN","MDARP3",35,0)
 S MCESON=$P($G(^MCAR(697.2,REC,0)),U,14),MCESKEY=$P($G(^MCAR(697.2,REC,0)),U,15),MCSUP=+$P($G(^MCAR(697.2,REC,0)),U,16)
"RTN","MDARP3",36,0)
 S (MCARSUM,MCARPSUM)="",MCARFILE=U_S5_","_S6_",.2)" S:$D(@MCARFILE) MCARSUM=$P(@MCARFILE,U,1),MCARPSUM=$P(@MCARFILE,U,2)
"RTN","MDARP3",37,0)
 K MCARFILE S S1=$S(WH="P":LL,1:S4),S2=$S(WH="P":S4,1:LL)
"RTN","MDARP3",38,0)
 S MCFILE=+$P(S5,"(",2)
"RTN","MDARP3",39,0)
 I MCESON,($G(MCESKEY)'=""),('$$SCRSUMPT^MCESSCR(MCESKEY,S6,MCSUP)) K MCARSUM,MCARPSUM,MCFILE,REC,MCSUP Q
"RTN","MDARP3",40,0)
 I '$$VALID^MCARUTL5(S5,S6,MCDFN) Q  ; MC*2.3*33
"RTN","MDARP3",41,0)
 I $P($G(@(U_S5_","_S6_",""ES"")")),U,7)="S" G EXIT  ;MC*2.3*8
"RTN","MDARP3",42,0)
 S S2=S2_U_S6  ;MC*2.3*8
"RTN","MDARP3",43,0)
 S ^TMP("OR",$J,"MCAR",S1,S2)=MCARSUM_U_S6_";"_S5_","_U_$P(^MCAR(697.2,LL1,0),U,5,7)
"RTN","MDARP3",44,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^CONSULTS" ; MC*2.3*33
"RTN","MDARP3",45,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^NONENDO" ; MC*2.3*33
"RTN","MDARP3",46,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^GI" ; MC*2.3*33
"RTN","MDARP3",47,0)
 I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^PARAC" ; MC*2.3*33
"RTN","MDARP3",48,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,10)=MCARPSUM
"RTN","MDARP3",49,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,11)=LL
"RTN","MDARP3",50,0)
 I S5="MCAR(699.5" D  ;MC*2.3*8
"RTN","MDARP3",51,0)
 .I LL8="" S LL8=" "
"RTN","MDARP3",52,0)
 .S $P(^TMP("OR",$J,"MCAR",S1,S2),U,12)=$E(($E($P($G(^MCAR(697.2,LL6,0)),U,8),1,13)_"/"_$P($G(^MCAR(697.2,LL8,0)),U)),1,31) K LL6,LL8
"RTN","MDARP3",53,0)
EXIT K MCARSUM,MCARPSUM,REC,MCSUP,MCESON Q
"RTN","MDARP3",54,0)
PR0 S I="",L=0
"RTN","MDARP3",55,0)
 F  S I=$O(^TMP("OR",$J,"MCAR",I)) Q:I=""  I I'="OT" D
"RTN","MDARP3",56,0)
 . S J="" F  S J=$O(^TMP("OR",$J,"MCAR",I,J)) Q:J=""  S PR=^(J) D
"RTN","MDARP3",57,0)
 .. Q:$P(PR,U,3,5)="^^"  ; MC*2.3*33
"RTN","MDARP3",58,0)
 .. S MCARDT=$S(WH="P":$P(J,U),1:I),MCARPROC=$S(WH="P":I,1:$P(J,U))
"RTN","MDARP3",59,0)
 .. S MCARPROC=$O(^MCAR(697.2,"B",MCARPROC,0)),MCARPROC=$P(^MCAR(697.2,MCARPROC,0),U,8)
"RTN","MDARP3",60,0)
 .. I $P(PR,U,12)'="" S MCARPROC=$P(PR,U,12)
"RTN","MDARP3",61,0)
 .. S DA=$P(PR,U,2),K=$P(PR,U),M=$P(PR,U,10)
"RTN","MDARP3",62,0)
 .. S K=$S(K="N"!(K="L"):"NORMAL",K="A":"ABNORMAL",K="B":"BORDERLINE",K="T":"TECHNICALLY UNSATISFACTORY",K="ND":"NON-DIAGNOSTIC",K="MI":"MILDLY ABNORMAL",K="MO":"MODERATELY ABNORMAL",K="S":"SEVERELY ABNORMAL",1:"")
"RTN","MDARP3",63,0)
 ..I CODE'="" Q:CODE'=K
"RTN","MDARP3",64,0)
 ..N MCDT S MCDT=MCARDT,Y=9999999.9999-MCARDT X ^DD("DD")
"RTN","MDARP3",65,0)
 ..S L=MCARPROC_"~"_DA
"RTN","MDARP3",66,0)
 ..S ^TMP("MDPLST",$J,MCDT,L)=MCARPROC_U_+DA_U_$P(PR,U,3,5)_U_J S $P(^(L),U,6)=Y,$P(^(L),U,7)=K,$P(^(L),U,10)=M,$P(^(L),U,11)=$S(WH="P":I_U_$P(J,U,2),1:J)
"RTN","MDARP3",67,0)
 K ^TMP("OR",$J,"MCAR")
"RTN","MDARP3",68,0)
 Q
"RTN","MDPS1")
0^1^B77051543^B76430435
"RTN","MDPS1",1,0)
MDPS1 ; HOIFO/NCA - CP/Medicine Report Generator ;5/18/04  09:48
"RTN","MDPS1",2,0)
 ;;1.0;CLINICAL PROCEDURES;**2,10,13**;Apr 01, 2004;Build 19
"RTN","MDPS1",3,0)
 ; Integration Agreements:
"RTN","MDPS1",4,0)
 ; IA# 2693 [Subscription] TIU Extractions.
"RTN","MDPS1",5,0)
 ; IA# 2926 [Subscription] Calls to GMRCGUIA.
"RTN","MDPS1",6,0)
 ; IA# 2944 [Subscription] Calls to TIUSRVR1.
"RTN","MDPS1",7,0)
 ; IA# 3067 [Private] Read fields in Consult file (#123) w/FM
"RTN","MDPS1",8,0)
 ; IA# 4110 [Subscription] Read access field #50 Associated Results in
"RTN","MDPS1",9,0)
 ;                         Consult file (#123) w/FM
"RTN","MDPS1",10,0)
 ; IA# 4230 [Subscription] Document MDPS1 calls.
"RTN","MDPS1",11,0)
 ; IA# 4231 [Subscription] Document CKP^GMTSUP usage.
"RTN","MDPS1",12,0)
 ; IA# 4792 [Private] CANDO^TIUSRVA call
"RTN","MDPS1",13,0)
 ; IA# 10104 [Supported] Routine XLFSTR calls
"RTN","MDPS1",14,0)
 ;
"RTN","MDPS1",15,0)
 ; Pre-existing local variables
"RTN","MDPS1",16,0)
 ; DFN,GMTS1,GMTS2,GMTSNDM,GMTSNPG,GMTSQIT
"RTN","MDPS1",17,0)
 ;
"RTN","MDPS1",18,0)
EN1(MDGLO,MDDFN,MDSDT,MDEDT,MDMAX,MDPSC,MDALL) ; Return the List of Completed Studies
"RTN","MDPS1",19,0)
 ; Input: MDGLO - Return Global Array (Required)
"RTN","MDPS1",20,0)
 ;        MDDFN - Patient DFN         (Required)
"RTN","MDPS1",21,0)
 ;        MDSDT - Start Date in FM Internal Format (Optional)
"RTN","MDPS1",22,0)
 ;        MDEDT - End Date in FM Internal Format (Optional)
"RTN","MDPS1",23,0)
 ;        MDMAX - Number of studies to return    (Optional)
"RTN","MDPS1",24,0)
 ;        MDPSC - Procedure Summary Code         (Optional)
"RTN","MDPS1",25,0)
 ;        MDALL - Return the all text reports with
"RTN","MDPS1",26,0)
 ;                the procedures list            (Optional)
"RTN","MDPS1",27,0)
 ; (Returns all studies for Patient, if no MDSDT, MDEDT,and MDMAX.)
"RTN","MDPS1",28,0)
 ;
"RTN","MDPS1",29,0)
 I '$G(MDDFN)!('$D(MDGLO)) Q
"RTN","MDPS1",30,0)
 I $G(MDGLO)="" S MDGLO=$NA(^TMP("MDHSP",$J))
"RTN","MDPS1",31,0)
 N MDARR,MDCODE,MDCON,MDCTR,MDDTE,MDLP,MDLP1,MDPLST,MDPROC,MDSTAT,MDT,MDTIUER,MDX,Y
"RTN","MDPS1",32,0)
 S (MDIMG,MDCTR)=0,(MDCODE,MDDTE,MDTIUER)="",MDC=$G(MDPSC)
"RTN","MDPS1",33,0)
 K ^TMP("MDPLST",$J) S MDPLST=$NA(^TMP("MDPLST",$J))
"RTN","MDPS1",34,0)
 ;
"RTN","MDPS1",35,0)
 ; If not converted call old medicine gather routine
"RTN","MDPS1",36,0)
 D:$G(MDC)="" GP^MDPS4(MDDFN,MDSDT,MDEDT)
"RTN","MDPS1",37,0)
 I '$G(MDSDT),'$G(MDEDT) D EN^MDARP3(MDDFN,MDC)
"RTN","MDPS1",38,0)
 E  D EN^MCARPS3(MDDFN,MDC,MDSDT,MDEDT)
"RTN","MDPS1",39,0)
 ;
"RTN","MDPS1",40,0)
 ; Get CP procedures
"RTN","MDPS1",41,0)
 D GET702(.MDGLO,MDDFN,MDC,MDSDT,MDEDT,$S(+$G(MDMAX):MDMAX,1:999))
"RTN","MDPS1",42,0)
 K ^TMP("MDPLST",$J)
"RTN","MDPS1",43,0)
 Q
"RTN","MDPS1",44,0)
 ;
"RTN","MDPS1",45,0)
GET702(MDGLO,MDDFN,MDC,MDSDT,MDEDT,MDMAX) ; Gather the new 702 entries
"RTN","MDPS1",46,0)
 S MDLP="" F  S MDLP=$O(^MDD(702,"B",MDDFN,MDLP)) Q:MDLP<1  D
"RTN","MDPS1",47,0)
 .S MDX=$G(^MDD(702,MDLP,0)) Q:$P(MDX,"^",9)'=3
"RTN","MDPS1",48,0)
 .S MDPROC=$$GET1^DIQ(702,MDLP_",",.04,"E") Q:MDPROC=""
"RTN","MDPS1",49,0)
 .Q:'$P(MDX,U,6)
"RTN","MDPS1",50,0)
 .K ^TMP("MDTIUST",$J) S MDTIUER=""
"RTN","MDPS1",51,0)
 .D EXTRACT^TIULQ($P(MDX,U,6),"^TMP(""MDTIUST"",$J)",MDTIUER,".01;.05;70201;70202") Q:+MDTIUER
"RTN","MDPS1",52,0)
 .S MDCODE=$G(^TMP("MDTIUST",$J,$P(MDX,U,6),70201,"E"))
"RTN","MDPS1",53,0)
 .S:MDCODE'="" MDCODE=$$UP^XLFSTR(MDCODE)
"RTN","MDPS1",54,0)
 .I $G(MDC)'="" Q:MDCODE'=$G(MDC)
"RTN","MDPS1",55,0)
 .S MDDTE=$G(^TMP("MDTIUST",$J,$P(MDX,U,6),70202,"I"))
"RTN","MDPS1",56,0)
 .S MDSTAT=$G(^TMP("MDTIUST",$J,$P(MDX,U,6),.05,"E"))
"RTN","MDPS1",57,0)
 .S:'MDDTE MDDTE=$$GET1^DIQ(702,MDLP_",",.02,"I")
"RTN","MDPS1",58,0)
 .K ^TMP("MDTIUST",$J)
"RTN","MDPS1",59,0)
 .S MDCON=$P(MDX,U,5)
"RTN","MDPS1",60,0)
 .I +$G(MDSDT) Q:MDDTE<+$G(MDSDT)
"RTN","MDPS1",61,0)
 .I +$G(MDEDT) Q:MDDTE>+$G(MDEDT)
"RTN","MDPS1",62,0)
 .I MDCON D  Q:MDSTAT'="COMPLETE"&(MDSTAT'="PARTIAL RESULTS")
"RTN","MDPS1",63,0)
 ..S MDSTAT=$$GET1^DIQ(123,MDCON_",",8,"E")
"RTN","MDPS1",64,0)
 ..I MDSTAT="" S MDSTAT=$$GET1^DIQ(123,MDCON_",",8,"I") S:+MDSTAT MDSTAT=$$GET1^DIQ(100.01,MDSTAT_",",.01,"E")
"RTN","MDPS1",65,0)
 ..Q
"RTN","MDPS1",66,0)
 .S Y=MDDTE X ^DD("DD")
"RTN","MDPS1",67,0)
 .I MDCON Q:$G(MDARR(MDCON))'=""  S MDARR(MDCON)=MDCON
"RTN","MDPS1",68,0)
 .S:$G(^TMP("MDPLST",$J,(9999999.9999-MDDTE),MDPROC_"~"_MDLP))="" ^(MDPROC_"~"_MDLP)=MDPROC_"^"_MDLP_"^"_"PR702"_"^"_"MDPS1"_"^^"_Y_"^"_MDCODE_"^^^^"_MDPROC_"^^"_MDCON_"^"_+$P(MDX,U,6)
"RTN","MDPS1",69,0)
 .Q
"RTN","MDPS1",70,0)
 S MDCTR=0
"RTN","MDPS1",71,0)
 S MDLP="" F  S MDLP=$O(^TMP("MDPLST",$J,MDLP)) Q:MDLP=""  S MDLP1="" F  S MDLP1=$O(^TMP("MDPLST",$J,MDLP,MDLP1)) Q:MDLP1=""  S MDX=$G(^(MDLP1)) D
"RTN","MDPS1",72,0)
 .I +$G(MDMAX) Q:MDCTR=MDMAX
"RTN","MDPS1",73,0)
 .S MDCTR=MDCTR+1,@MDGLO@(MDCTR)=$G(MDX)
"RTN","MDPS1",74,0)
 K MDARR
"RTN","MDPS1",75,0)
 I +$G(MDALL) K ^TMP("MDPTXT",$J) S MDLP=0 F  S MDLP=$O(@MDGLO@(MDLP)) Q:MDLP<1  S MDX1=$G(@MDGLO@(MDLP)) D
"RTN","MDPS1",76,0)
 .S MCARGDA=+$P(MDX1,U,2),MCPRO=$P(MDX1,U,11),MCARPPS=$P(MDX1,U,3,4)
"RTN","MDPS1",77,0)
 .S MCARGRTN=$P(MDX1,U,5),MDT="RD"
"RTN","MDPS1",78,0)
 .D @MCARPPS
"RTN","MDPS1",79,0)
 K MCARGDA,MCARGRTN,MCPRO,MCARPPS
"RTN","MDPS1",80,0)
 Q
"RTN","MDPS1",81,0)
CPA ; Abnormal Report - Health Summary Component
"RTN","MDPS1",82,0)
 N MDHR,MDHSG,MDHDR,MDHFLG,MDLIM,MDTS1,MDTS2,MDX1
"RTN","MDPS1",83,0)
 Q:'$G(DFN)  Q:'$G(GMTS1)  Q:'$G(GMTS2)
"RTN","MDPS1",84,0)
 K ^TMP("MDHSP",$J) S MDHFLG=1
"RTN","MDPS1",85,0)
 S MDHSG=$NA(^TMP("MDHSP",$J)) D SET^MDPS2
"RTN","MDPS1",86,0)
 D EN1(.MDHSG,DFN,MDTS1,MDTS2,MDLIM,"ABNORMAL")
"RTN","MDPS1",87,0)
 I '$D(^TMP("MDHSP",$J)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"No Procedure Data for the patient." Q
"RTN","MDPS1",88,0)
 S MDHR=0 F  S MDHR=$O(^TMP("MDHSP",$J,MDHR)) Q:MDHR<1  S MDX1=$G(^(MDHR)) D
"RTN","MDPS1",89,0)
 .D HSHDR^MDPS2
"RTN","MDPS1",90,0)
 .S MCARGDA=+$P(MDX1,U,2),MCARPPS=$P(MDX1,U,3,4),MCPRO=$P(MDX1,U,11)
"RTN","MDPS1",91,0)
 .S MCARGRTN=$P(MDX1,U,5),MDT="RD",MDHDR=1
"RTN","MDPS1",92,0)
 .D @MCARPPS Q
"RTN","MDPS1",93,0)
 K ^TMP("MDHSP",$J),MCARGRTN,MCPRO,MCARPPS
"RTN","MDPS1",94,0)
 Q
"RTN","MDPS1",95,0)
CPB ; Brief Report - Health Summary Component
"RTN","MDPS1",96,0)
 N MDHR,MDHSG,MDLIM,MDTS1,MDTS2,MDX1
"RTN","MDPS1",97,0)
 Q:'$G(DFN)  Q:'$G(GMTS1)  Q:'$G(GMTS2)
"RTN","MDPS1",98,0)
 K ^TMP("MDHSP",$J)
"RTN","MDPS1",99,0)
 S MDHSG=$NA(^TMP("MDHSP",$J)) D SET^MDPS2
"RTN","MDPS1",100,0)
 D EN1(.MDHSG,DFN,MDTS1,MDTS2,MDLIM)
"RTN","MDPS1",101,0)
 I '$D(^TMP("MDHSP",$J)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"No Procedure Data for the patient." Q
"RTN","MDPS1",102,0)
 D HDR^MDPS2
"RTN","MDPS1",103,0)
 S MDHR=0 F  S MDHR=$O(^TMP("MDHSP",$J,MDHR)) Q:MDHR<1  S MDX1=$G(^(MDHR)) D
"RTN","MDPS1",104,0)
 .D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","MDPS1",105,0)
 .W !,$S(+$P(MDX1,U,13):$J($P(MDX1,U,13),9),1:""),?12,$E($P(MDX1,U,1),1,30),?44,$P(MDX1,U,6),?67,$P(MDX1,U,7)
"RTN","MDPS1",106,0)
 .Q
"RTN","MDPS1",107,0)
 K ^TMP("MDHSP",$J)
"RTN","MDPS1",108,0)
 Q
"RTN","MDPS1",109,0)
CPC ; Full Caption Report - Health Summary Component
"RTN","MDPS1",110,0)
 S MDT1="CD"
"RTN","MDPS1",111,0)
CPF ; Full Report - Health Summary Component
"RTN","MDPS1",112,0)
 N MDHR,MDHSG,MDHDR,MDHFLG,MDLIM,MDT,MDTS1,MDTS2,MDX1
"RTN","MDPS1",113,0)
 Q:'$G(DFN)  Q:'$G(GMTS1)  Q:'$G(GMTS2)
"RTN","MDPS1",114,0)
 K ^TMP("MDHSP",$J) S MDHFLG=1
"RTN","MDPS1",115,0)
 S MDHSG=$NA(^TMP("MDHSP",$J)) D SET^MDPS2
"RTN","MDPS1",116,0)
 D EN1(.MDHSG,DFN,MDTS1,MDTS2,MDLIM)
"RTN","MDPS1",117,0)
 I '$D(^TMP("MDHSP",$J)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"No Procedure Data for the patient." Q
"RTN","MDPS1",118,0)
 S MDHR=0 F  S MDHR=$O(^TMP("MDHSP",$J,MDHR)) Q:MDHR<1  S MDX1=$G(^(MDHR)) D
"RTN","MDPS1",119,0)
 .D HSHDR^MDPS2
"RTN","MDPS1",120,0)
 .S MCARGDA=+$P(MDX1,U,2),MCPRO=$P(MDX1,U,11),MCARPPS=$P(MDX1,U,3,4)
"RTN","MDPS1",121,0)
 .S MCARGRTN=$P(MDX1,U,5),MDT=$S($G(MDT1)="":"RD",1:"CD"),MDHDR=1
"RTN","MDPS1",122,0)
 .D @MCARPPS Q
"RTN","MDPS1",123,0)
 K ^TMP("MDHSP",$J),MCARGDA,MCARGRTN,MCPRO,MCARPPS,MDT1
"RTN","MDPS1",124,0)
 Q
"RTN","MDPS1",125,0)
CPS ; One Line Summary Report
"RTN","MDPS1",126,0)
 N MDHR,MDHSG,MDLIM,MDTS1,MDTS2,MDX1
"RTN","MDPS1",127,0)
 Q:'$G(DFN)  Q:'$G(GMTS1)  Q:'$G(GMTS2)
"RTN","MDPS1",128,0)
 K ^TMP("MDHSP",$J)
"RTN","MDPS1",129,0)
 S MDHSG=$NA(^TMP("MDHSP",$J)) D SET^MDPS2
"RTN","MDPS1",130,0)
 D EN1(.MDHSG,DFN,MDTS1,MDTS2,MDLIM)
"RTN","MDPS1",131,0)
 I '$D(^TMP("MDHSP",$J)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"No Procedure Data for the patient." Q
"RTN","MDPS1",132,0)
 S MDHR=0 F  S MDHR=$O(^TMP("MDHSP",$J,MDHR)) Q:MDHR<1  S MDX1=$G(^(MDHR)) D
"RTN","MDPS1",133,0)
 .D HSHDR^MDPS2
"RTN","MDPS1",134,0)
 K ^TMP("MDHSP",$J)
"RTN","MDPS1",135,0)
 Q
"RTN","MDPS1",136,0)
PR702 ; Return the Result Text for File 702 records
"RTN","MDPS1",137,0)
 Q:'$G(MCARGDA)
"RTN","MDPS1",138,0)
 N FFF,MDCLIN,MDCON,MDIMG,MDMCG,MDMED,MDREC,MDPRILV,MDPTR,MDSTUDY,MDTIU,MDX4,PATID,MDRPG,RESULTS
"RTN","MDPS1",139,0)
 I '$G(MDALL) K ^TMP("MDPTXT",$J)
"RTN","MDPS1",140,0)
 S MDIMG=0,$P(FFF,"-",80)="",MDRPG=0
"RTN","MDPS1",141,0)
 S MDSTUDY=+$G(MCARGDA)
"RTN","MDPS1",142,0)
 S MDTIU=$$GET1^DIQ(702,MDSTUDY_",",.06,"I")
"RTN","MDPS1",143,0)
 S MDCON=$$GET1^DIQ(702,MDSTUDY_",",.05,"I")
"RTN","MDPS1",144,0)
 Q:'MDTIU
"RTN","MDPS1",145,0)
 I +$P($G(^MDD(702,MDSTUDY,.1,0)),U,4)>0 S MDIMG=1
"RTN","MDPS1",146,0)
 S (MDPRILV,RESULTS)="",MDCLIN=0
"RTN","MDPS1",147,0)
 D CANDO^TIUSRVA(.MDPRILV,+MDTIU,"VIEW")
"RTN","MDPS1",148,0)
 I +MDPRILV<1 S ^TMP("MDPTXT",$J,MCARGDA,MCPRO,1)=$P(MDPRILV,U,2) D NXT Q
"RTN","MDPS1",149,0)
 I 'MDCON D TGET^TIUSRVR1(.RESULTS,+MDTIU) M ^TMP("MDPTXT",$J,MCARGDA,MCPRO)=@RESULTS K ^TMP("TIUVIEW",$J) Q:+$G(MDALL)  D NXT Q
"RTN","MDPS1",150,0)
 I MDCON D  Q:+$G(MDMED)
"RTN","MDPS1",151,0)
 .S MDG=$NA(^TMP("MDPTXT",$J,MCARGDA,MCPRO))
"RTN","MDPS1",152,0)
 .S MDMED=$$CHKMED^MDPS3(MDCON)
"RTN","MDPS1",153,0)
 .I MDMED D GETARY(.MDG,MDCON) Q:+$G(MDALL)  Q:+$G(MDRDV)  D NXT Q
"RTN","MDPS1",154,0)
 .K ^TMP("MDGMRC",$J) S RESULTS=$NA(^TMP("MDGMRC",$J))
"RTN","MDPS1",155,0)
 .D RT^GMRCGUIA(MDCON,.RESULTS)
"RTN","MDPS1",156,0)
 .D SETLINE(.MDG,.RESULTS)
"RTN","MDPS1",157,0)
NXT Q:+$G(MDALL)  Q:+$G(MDRDV)
"RTN","MDPS1",158,0)
 I $D(ORHFS) U IO G PRINT
"RTN","MDPS1",159,0)
 G PRINT
"RTN","MDPS1",160,0)
PR690 ; Return the Result text for File 690 Medicine report record
"RTN","MDPS1",161,0)
 Q:'$G(MCARGDA)
"RTN","MDPS1",162,0)
 N MDSTUDY,RESULTS,MDTMP,PATID
"RTN","MDPS1",163,0)
 I '$G(MDALL) K ^TMP("MDPTXT",$J)
"RTN","MDPS1",164,0)
 S MDSTUDY=+$G(MCARGDA)
"RTN","MDPS1",165,0)
 S MDG=$NA(^TMP("MDPTXT",$J,MCARGDA,MCPRO))
"RTN","MDPS1",166,0)
 S MDTMP="",MDTMP=+$O(^MCAR(697.2,"B",MCPRO,MDTMP))
"RTN","MDPS1",167,0)
 S MDTMP=$G(^MCAR(697.2,+MDTMP,0)) Q:MDTMP=""
"RTN","MDPS1",168,0)
 S MDF=$P(MDTMP,U,2),MDF=$P(MDF,"(",2),MDR=+MCARGDA,MDPR=MCPRO,PATID=DFN S:$G(MDT)="" MDT="RD"
"RTN","MDPS1",169,0)
 D GETDATA^MDPS2(.MDG,DFN,MDPR,MDF,MDR,MDT,$S(+$G(MDHDR):MDHDR,1:0))
"RTN","MDPS1",170,0)
 Q:+$G(MDALL)  Q:+$G(MDRDV)
"RTN","MDPS1",171,0)
 I $D(ORHFS) U IO G PRINT
"RTN","MDPS1",172,0)
PRINT ; Print the text for Display
"RTN","MDPS1",173,0)
 N MDRE S MDREC=$NA(^TMP("MDPTXT",$J)),MDRPG=1,MDRE=+$P(MDREC,",",2)
"RTN","MDPS1",174,0)
 W:'$G(MDHFLG) @IOF,!!
"RTN","MDPS1",175,0)
 F  S MDREC=$Q(@MDREC) Q:MDREC=""  Q:$QS(MDREC,1)'="MDPTXT"  D
"RTN","MDPS1",176,0)
 .Q:$QS(MDREC,2)'=MDRE
"RTN","MDPS1",177,0)
 .I +$G(MDHFLG) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","MDPS1",178,0)
 .I '$G(MDHFLG)&($Y>(IOSL-6)!($Y<1)) W @IOF D HDR^MDPS3
"RTN","MDPS1",179,0)
 .W !,$G(@MDREC)
"RTN","MDPS1",180,0)
 .Q
"RTN","MDPS1",181,0)
 I +$G(MDIMG) D
"RTN","MDPS1",182,0)
 .I +$G(MDHFLG) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","MDPS1",183,0)
 .W ! I +$G(MDHFLG) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","MDPS1",184,0)
 .W !,"NOTE: Images are associated with this procedure."
"RTN","MDPS1",185,0)
 .I +$G(MDHFLG) D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","MDPS1",186,0)
 .W !,"      Please use Imaging Display to view the images."
"RTN","MDPS1",187,0)
 .Q
"RTN","MDPS1",188,0)
 K MCPRO,MCARPPS,MCARGRTN,^TMP("MDPTXT",$J)
"RTN","MDPS1",189,0)
 Q
"RTN","MDPS1",190,0)
GETARY(MDG,MDCON) ; Get the Medicine Result
"RTN","MDPS1",191,0)
 N MDCK,MDCX,MDX4,MDGL
"RTN","MDPS1",192,0)
 K ^TMP("MDREST",$J) S MDGL=$NA(^TMP("MDREST",$J))
"RTN","MDPS1",193,0)
 D GETS^DIQ(123,MDCON_",","50*","I","MDCX")
"RTN","MDPS1",194,0)
 S MDCK="" F  S MDCK=$O(MDCX(123.03,MDCK)) Q:MDCK<1  S MDX4=$G(MDCX(123.03,MDCK,.01,"I")) D
"RTN","MDPS1",195,0)
 .I MDX4["MCAR" D  Q
"RTN","MDPS1",196,0)
 ..S MDR=+MDX4,MDF=+$P(MDX4,"(",2),PATID=DFN S:$G(MDT)="" MDT="RD"
"RTN","MDPS1",197,0)
 ..Q:MDX4=""  S MCPRO=$$PRO^MDPS3(MDX4),MDPR=MCPRO
"RTN","MDPS1",198,0)
 ..D GETDATA^MDPS2(.MDGL,DFN,MDPR,MDF,MDR,MDT,$S(+$G(MDHDR):1,1:0))
"RTN","MDPS1",199,0)
 ..D SETLINE(.MDG,.MDGL) K ^TMP("MDREST",$J)
"RTN","MDPS1",200,0)
 ..Q
"RTN","MDPS1",201,0)
 .I MDX4["TIU" D  Q
"RTN","MDPS1",202,0)
 ..S RESULTS="" D TGET^TIUSRVR1(.RESULTS,+MDX4)
"RTN","MDPS1",203,0)
 ..D SETLINE(.MDG,.RESULTS) K ^TMP("TIUVIEW",$J)
"RTN","MDPS1",204,0)
 ..S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)=FFF
"RTN","MDPS1",205,0)
 ..Q
"RTN","MDPS1",206,0)
 Q
"RTN","MDPS1",207,0)
SETLINE(MDG,MDGL) ; Set Global Lines
"RTN","MDPS1",208,0)
 N MDCK1,MDX3,MDSC,MDNAME,MDTITL,MDDTM
"RTN","MDPS1",209,0)
 D NOW^%DTC S X=% D DTIME^MCARP S MDDTM=$$FMTE^XLFDT(X,2) K %
"RTN","MDPS1",210,0)
 I $G(MCPRO)'="" S MDNAME=$O(^MCAR(697.2,"B",MCPRO,0)) D
"RTN","MDPS1",211,0)
 .I MDNAME S MDTITL=$P($G(^MCAR(697.2,+MDNAME,0)),"^",8)
"RTN","MDPS1",212,0)
 .I $G(MDTITL)="" S MDNAME=$O(^MDS(702.01,"B",MCPRO,0)) S:MDNAME MDTITL=$P($G(^MDS(702.01,+MDNAME,0)),U)
"RTN","MDPS1",213,0)
 S MDCK1=MDGL,MDSC=$QS(MDCK1,1),MDRPG=MDRPG+1
"RTN","MDPS1",214,0)
 I '$G(MDHDR) D
"RTN","MDPS1",215,0)
 .Q:MDSC="MDREST"
"RTN","MDPS1",216,0)
 .S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)="Pg. "_MDRPG_$J(" ",25)_$$HOSP^MDPS2(DFN)_$J(" ",25)_MDDTM
"RTN","MDPS1",217,0)
 .I $G(MDTITL)'="" S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)=$J(" ",25)_MDTITL
"RTN","MDPS1",218,0)
 .S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)=$$DEMO^MDPS2(DFN)
"RTN","MDPS1",219,0)
 .S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)=FFF
"RTN","MDPS1",220,0)
 F  S MDCK1=$Q(@MDCK1) Q:MDCK1=""  Q:$QS(MDCK1,1)'=MDSC  Q:$QS(MDGL,2)'=$QS(MDCK1,2)  S MDCLIN=MDCLIN+1,@MDG@(MDCLIN,0)=$G(@MDCK1)
"RTN","MDPS1",221,0)
 Q
"RTN","MDPS3")
0^2^B10769284^B8616457
"RTN","MDPS3",1,0)
MDPS3 ; HOIFO/NCA - Remote Data View Data Retriever for CP ;8/26/05  14:37
"RTN","MDPS3",2,0)
 ;;1.0;CLINICAL PROCEDURES;**2,5,13**;Apr 01, 2004;Build 19
"RTN","MDPS3",3,0)
 ; Integration Agreements:
"RTN","MDPS3",4,0)
 ; Reference IA# 2693 [Subscription] TIU Extractions.
"RTN","MDPS3",5,0)
 ;               3067 [Private] Read fields in Consult file (#123) w/FM
"RTN","MDPS3",6,0)
 ;               10104 [Supported] Routine XLFSTR calls.
"RTN","MDPS3",7,0)
 ;                 875 [Subscription] Access Order Status file (#100.01)
"RTN","MDPS3",8,0)
 ;
"RTN","MDPS3",9,0)
GET702(MDGLO,MDDFN,MDC,MDSDT,MDEDT,MDMAX) ; Gather the new 702 entries
"RTN","MDPS3",10,0)
 N MDARR,MDCON,MDDTE,MDLP,MDCODE,MDPROC,MDSTAT,MDX
"RTN","MDPS3",11,0)
 D GP^MDPS5(MDDFN,MDSDT,MDEDT)
"RTN","MDPS3",12,0)
 S MDLP="" F  S MDLP=$O(^MDD(702,"B",MDDFN,MDLP)) Q:MDLP<1  D
"RTN","MDPS3",13,0)
 .S MDX=$G(^MDD(702,MDLP,0)) Q:$P(MDX,"^",9)'=3
"RTN","MDPS3",14,0)
 .S MDPROC=$$GET1^DIQ(702,MDLP_",",.04,"E") Q:MDPROC=""
"RTN","MDPS3",15,0)
 .Q:'$P(MDX,U,6)
"RTN","MDPS3",16,0)
 .K ^TMP("MDTIUST",$J) S MDTIUER=""
"RTN","MDPS3",17,0)
 .D EXTRACT^TIULQ($P(MDX,U,6),"^TMP(""MDTIUST"",$J)",MDTIUER,".01;.05;70201;70202") Q:+MDTIUER
"RTN","MDPS3",18,0)
 .S MDCODE=$G(^TMP("MDTIUST",$J,$P(MDX,U,6),70201,"E"))
"RTN","MDPS3",19,0)
 .S:MDCODE'="" MDCODE=$$UP^XLFSTR(MDCODE)
"RTN","MDPS3",20,0)
 .I $G(MDC)'="" Q:MDCODE'=$G(MDC)
"RTN","MDPS3",21,0)
 .S MDDTE=$G(^TMP("MDTIUST",$J,$P(MDX,U,6),70202,"I"))
"RTN","MDPS3",22,0)
 .S MDSTAT=$G(^TMP("MDTIUST",$J,$P(MDX,U,6),.05,"E"))
"RTN","MDPS3",23,0)
 .S:'MDDTE MDDTE=$$GET1^DIQ(702,MDLP_",",.02,"I")
"RTN","MDPS3",24,0)
 .K ^TMP("MDTIUST",$J)
"RTN","MDPS3",25,0)
 .S MDCON=$P(MDX,U,5)
"RTN","MDPS3",26,0)
 .I +$G(MDSDT) Q:MDDTE<+$G(MDSDT)
"RTN","MDPS3",27,0)
 .I +$G(MDEDT) Q:MDDTE>+$G(MDEDT)
"RTN","MDPS3",28,0)
 .I MDCON D  Q:MDSTAT'="COMPLETE"&(MDSTAT'="PARTIAL RESULTS")
"RTN","MDPS3",29,0)
 ..S MDSTAT=$$GET1^DIQ(123,MDCON_",",8,"E")
"RTN","MDPS3",30,0)
 ..I MDSTAT="" S MDSTAT=$$GET1^DIQ(123,MDCON_",",8,"I") S:+MDSTAT MDSTAT=$$GET1^DIQ(100.01,MDSTAT_",",.01,"E")
"RTN","MDPS3",31,0)
 ..Q
"RTN","MDPS3",32,0)
 .S Y=MDDTE X ^DD("DD") N MDREV S MDREV=(9999999.9999-MDDTE)
"RTN","MDPS3",33,0)
 .I MDCON Q:$G(MDARR(MDCON))'=""  S MDARR(MDCON)=MDCON
"RTN","MDPS3",34,0)
 .S:$G(^TMP("MDPLST",$J,MDPROC,MDREV_"^"_MDLP))="" ^(MDREV_"^"_MDLP)=MDPROC_"^"_MDLP_"^"_"PR702"_"^"_"MDPS1"_"^^"_Y_"^"_MDCODE_"^^^^"_MDPROC_"^^"_MDCON_"^"_+$P(MDX,U,6)
"RTN","MDPS3",35,0)
 .Q
"RTN","MDPS3",36,0)
 K MDARR
"RTN","MDPS3",37,0)
 Q
"RTN","MDPS3",38,0)
PRO(RESULT) ;  Function to return info on single procedure.
"RTN","MDPS3",39,0)
 ;
"RTN","MDPS3",40,0)
 ; RESULT = variable pointer to a medicine file
"RTN","MDPS3",41,0)
 ;          (e.g. "12;MCAR(691.5,") (required)
"RTN","MDPS3",42,0)
 N MDVAL,LL,S3,S4,S5
"RTN","MDPS3",43,0)
 S S3=+RESULT,S4=$P(RESULT,";",2),S4=$P(S4,",")
"RTN","MDPS3",44,0)
 I S4="MCAR(702.7" Q ""
"RTN","MDPS3",45,0)
 I S4="MCAR(699" S LL=$P($G(^MCAR(699,+S3,0)),U,12),MDVAL=$P($G(^MCAR(697.2,+LL,0)),U) Q MDVAL
"RTN","MDPS3",46,0)
 I S4="MCAR(699.5" S LL=$P($G(^MCAR(699.5,+S3,0)),U,6),MDVAL=$P($G(^MCAR(697.2,+LL,0)),U) Q MDVAL
"RTN","MDPS3",47,0)
 I S4="MCAR(694" S LL=$P($G(^MCAR(699.5,+S3,0)),U,6),MDVAL=$P($G(^MCAR(697.2,+LL,0)),U) Q MDVAL
"RTN","MDPS3",48,0)
 S LL=$O(^MCAR(697.2,"C",S4,0)),MDVAL=$P(^MCAR(697.2,LL,0),U)
"RTN","MDPS3",49,0)
 Q MDVAL
"RTN","MDPS3",50,0)
CHKMED(MDCON) ; Check for Medicine results
"RTN","MDPS3",51,0)
 N MDCK,MDCX,MDY
"RTN","MDPS3",52,0)
 S MDY=0 D GETS^DIQ(123,MDCON_",","50*","I","MDCX")
"RTN","MDPS3",53,0)
 S MDCK="" F  S MDCK=$O(MDCX(123.03,MDCK)) Q:MDCK<1  S MDX4=$G(MDCX(123.03,MDCK,.01,"I")) D
"RTN","MDPS3",54,0)
 .I MDX4["MCAR" S MDY=1
"RTN","MDPS3",55,0)
 Q MDY
"RTN","MDPS3",56,0)
HDR ; Print Header for Report Form Feed
"RTN","MDPS3",57,0)
 N FFL,MDNM,MDNAME,MDTITL,MDTM S $P(FFL,"-",80)=""
"RTN","MDPS3",58,0)
 S MDNM=$QS(MDREC,4),MDNAME=$O(^MCAR(697.2,"B",MDNM,0))
"RTN","MDPS3",59,0)
 I MDNAME S MDTITL=$P($G(^MCAR(697.2,+MDNAME,0)),"^",8)
"RTN","MDPS3",60,0)
 I $G(MDTITL)="" S MDNAME=$O(^MDS(702.01,"B",MDNM,0)) S:MDNAME MDTITL=$P($G(^MDS(702.01,+MDNAME,0)),U)
"RTN","MDPS3",61,0)
 W !! D NOW^%DTC S X=% D DTIME^MCARP S MDTM=$$FMTE^XLFDT(X,2) K %
"RTN","MDPS3",62,0)
 S MDRPG=MDRPG+1 W !,"Pg. "_MDRPG_$J(" ",25)_$$HOSP^MDPS2(DFN)_$J(" ",25)_MDTM
"RTN","MDPS3",63,0)
 I $G(MDTITL)'="" W !,$J(" ",25)_MDTITL
"RTN","MDPS3",64,0)
 W !,$$DEMO^MDPS2(DFN)
"RTN","MDPS3",65,0)
 W !,FFL
"RTN","MDPS3",66,0)
 Q
"RTN","MDPS4")
0^3^B13230454^n/a
"RTN","MDPS4",1,0)
MDPS4 ; HOIFO/NCA - Retrieve List of Consult Procedures ;1/26/06  12:45
"RTN","MDPS4",2,0)
 ;;1.0;CLINICAL PROCEDURES;**13**;Apr 01, 2004;Build 19
"RTN","MDPS4",3,0)
 ; Integration Agreements:
"RTN","MDPS4",4,0)
 ; Reference IA# 2740 [Subscription] Routine GMRCSLM1.
"RTN","MDPS4",5,0)
 ; IA# 2693 [Subscription] TIU Extractions.
"RTN","MDPS4",6,0)
 ; IA# 2944 [Subscription] Calls to TIUSRVR1.
"RTN","MDPS4",7,0)
 ; IA# 3067 [Private] Read fields in Consult file (#123) w/FM
"RTN","MDPS4",8,0)
 ; IA# 4792 [Private] CANDO^TIUSRVA call
"RTN","MDPS4",9,0)
 ;
"RTN","MDPS4",10,0)
GP(MDDFN,MDSDT,MDEDT) ; Gather the completed procedure list
"RTN","MDPS4",11,0)
 N MDCPR,MDCK,MDCPRO,MDCX,MDDTE,MDLP,MDFIL,MDX4,MDSTK,MDX S MDSTK="2,9",MDFIL=123
"RTN","MDPS4",12,0)
 D OER^GMRCSLM1(MDDFN,"",MDSDT,MDEDT,MDSTK,1)
"RTN","MDPS4",13,0)
 I $G(^TMP("GMRCR",$J,"CS",1,0))["< PATIENT DOES NOT HAVE ANY CONSULTS/REQUESTS" Q
"RTN","MDPS4",14,0)
 S MDLP=0 F  S MDLP=$O(^TMP("GMRCR",$J,"CS",MDLP)) Q:MDLP="AD"!(MDLP<1)  S MDX=$G(^(MDLP,0)) D
"RTN","MDPS4",15,0)
 .S MDCPRO=$P(MDX,U,5),MDX=+MDX
"RTN","MDPS4",16,0)
 .Q:$$GET1^DIQ(MDFIL,+MDX_",",13,"I")'="P"
"RTN","MDPS4",17,0)
 .;S MDFIL=123,MDCPR=$$GET1^DIQ(MDFIL,+MDX_",",4,"I")
"RTN","MDPS4",18,0)
 .;Q:MDCPR'["GMR(123.3"
"RTN","MDPS4",19,0)
 .;S MDCPR=+MDCPR S MDFIL=123.3 Q:'$$GET1^DIQ(MDFIL,+MDCPR_",",.05,"I")
"RTN","MDPS4",20,0)
 .Q:$O(^MDD(702,"ACON",+MDX,0))
"RTN","MDPS4",21,0)
 .S MDFIL=123 K MDCX D GETS^DIQ(MDFIL,+MDX_",","50*","I","MDCX")
"RTN","MDPS4",22,0)
 .S MDCK="" F  S MDCK=$O(MDCX(123.03,MDCK)) Q:MDCK<1  S MDX4=$G(MDCX(123.03,MDCK,.01,"I")) D
"RTN","MDPS4",23,0)
 ..I MDX4["TIU" D
"RTN","MDPS4",24,0)
 ...S MDFIL=8925,MDDTE=$$GET1^DIQ(MDFIL,+MDX4_",",1201,"I")
"RTN","MDPS4",25,0)
 ...S Y=MDDTE X ^DD("DD") N MDREV S MDREV=(9999999.9999-MDDTE)
"RTN","MDPS4",26,0)
 ...S:$G(^TMP("MDPLST",$J,MDREV,MDCPRO_"~"_+MDX4))="" ^(MDCPRO_"~"_+MDX4)=MDCPRO_"^"_+MDX4_"^"_"PRPRO"_"^"_"MDPS4"_"^^"_Y_"^^^^^"_MDCPRO_"^^"_+MDX_"^"_+MDX4,MDFIL=123
"RTN","MDPS4",27,0)
 ...Q
"RTN","MDPS4",28,0)
 ..Q
"RTN","MDPS4",29,0)
 .Q
"RTN","MDPS4",30,0)
 K ^TMP("GMRCR",$J,"CS")
"RTN","MDPS4",31,0)
 Q
"RTN","MDPS4",32,0)
PRPRO ; Return the Result Text for File Consult Procedure records
"RTN","MDPS4",33,0)
 Q:'$G(MCARGDA)
"RTN","MDPS4",34,0)
 N FFF,MDCK1,MDCLIN,MDCON,MDFIL,MDIMG,MDLCT,MDMCG,MDMED,MDNAME,MDREC,MDPRILV,MDPTR,MDSTUDY,MDTIM,MDTIU,MDTL,MDX4,PATID,MDRPG,RESULTS,MDXX,X
"RTN","MDPS4",35,0)
 I '$G(MDALL) K ^TMP("MDPTXT",$J)
"RTN","MDPS4",36,0)
 K ^TMP("MDTMPT",$J) D NOW^%DTC S X=% D DTIME^MCARP S MDTIM=$$FMTE^XLFDT(X,2) K %
"RTN","MDPS4",37,0)
 S MDIMG=0,$P(FFF,"-",80)="",(MDLCT,MDRPG)=0,MDF=123
"RTN","MDPS4",38,0)
 S MDSTUDY=+$G(MCARGDA)
"RTN","MDPS4",39,0)
 S (MDPRILV,RESULTS)="",MDCLIN=0
"RTN","MDPS4",40,0)
 D CANDO^TIUSRVA(.MDPRILV,+MDSTUDY,"VIEW")
"RTN","MDPS4",41,0)
 I +MDPRILV D TGET^TIUSRVR1(.RESULTS,+MDSTUDY) M ^TMP("MDTMPT",$J,MCARGDA,MCPRO)=@RESULTS K ^TMP("TIUVIEW",$J) Q:+$G(MDALL)
"RTN","MDPS4",42,0)
 S:+MDPRILV<1 ^TMP("MDTMPT",$J,MCARGDA,MCPRO,1)=$P(MDPRILV,U,2)
"RTN","MDPS4",43,0)
 K ^TMP("MDTIUST",$J) N MDTIUER,MDTST S (MDNAME,MDTIUER,MDTST)=""
"RTN","MDPS4",44,0)
 D EXTRACT^TIULQ(+MDSTUDY,"^TMP(""MDTIUST"",$J)",MDTIUER,".01;.02;1405","IE") Q:+MDTIUER
"RTN","MDPS4",45,0)
 S MDTST=$G(^TMP("MDTIUST",$J,+MDSTUDY,1405,"I")),MDTST=$S(MDTST["GMR(123":+MDTST,1:0)
"RTN","MDPS4",46,0)
 S MDNAME=$G(^TMP("MDTIUST",$J,+MDSTUDY,.02,"E")),MDRPG=MDRPG+1
"RTN","MDPS4",47,0)
 S MDXX=$G(^TMP("MDTIUST",$J,+MDSTUDY,.01,"E"))
"RTN","MDPS4",48,0)
 S MDFIL=123 S MDTL=$S(+MDTST:$$GET1^DIQ(MDFIL,+MDTST_",",4,"E"),1:MDXX)
"RTN","MDPS4",49,0)
 I '$G(MDHDR) D
"RTN","MDPS4",50,0)
 .S MDLCT=MDLCT+1,^TMP("MDPTXT",$J,MCARGDA,MCPRO,MDLCT)="Pg. "_MDRPG_$J(" ",25)_$$HOSP^MDPS2(DFN)_$J(" ",25)_MDTIM
"RTN","MDPS4",51,0)
 .S MDLCT=MDLCT+1 S ^TMP("MDPTXT",$J,MCARGDA,MCPRO,MDLCT)=$J(" ",25)_MDTL
"RTN","MDPS4",52,0)
 .S MDLCT=MDLCT+1 S ^TMP("MDPTXT",$J,MCARGDA,MCPRO,MDLCT)=$$DEMO^MDPS2(DFN)
"RTN","MDPS4",53,0)
 .S MDLCT=MDLCT+1 S ^TMP("MDPTXT",$J,MCARGDA,MCPRO,MDLCT)=FFF
"RTN","MDPS4",54,0)
 S MDCK1="" F  S MDCK1=$O(^TMP("MDTMPT",$J,MCARGDA,MCPRO,MDCK1)) Q:MDCK1<1  S MDXX=$G(^(MDCK1)),MDLCT=MDLCT+1,^TMP("MDPTXT",$J,MCARGDA,MCPRO,MDLCT)=MDXX
"RTN","MDPS4",55,0)
 K ^TMP("MDTMPT",$J,MCARGDA,MCPRO)
"RTN","MDPS4",56,0)
NXT Q:+$G(MDALL)  Q:+$G(MDRDV)
"RTN","MDPS4",57,0)
 I $D(ORHFS) U IO G PRINT^MDPS1
"RTN","MDPS4",58,0)
 G PRINT^MDPS1
"RTN","MDPS5")
0^4^B6121176^n/a
"RTN","MDPS5",1,0)
MDPS5 ; HOIFO/NCA - Retrieve List of Consult Procedures for RDV ;3/4/05  13:29
"RTN","MDPS5",2,0)
 ;;1.0;CLINICAL PROCEDURES;**13**;Apr 01, 2004;Build 19
"RTN","MDPS5",3,0)
 ; Integration Agreements:
"RTN","MDPS5",4,0)
 ; Reference IA# 2740 [Subscription] Routine GMRCSLM1.
"RTN","MDPS5",5,0)
 ; IA# 2944 [Subscription] Calls to TIUSRVR1.
"RTN","MDPS5",6,0)
 ; IA# 3067 [Private] Read fields in Consult file (#123) w/FM
"RTN","MDPS5",7,0)
 ;
"RTN","MDPS5",8,0)
GP(MDDFN,MDSDT,MDEDT) ; Gather the completed procedure list
"RTN","MDPS5",9,0)
 N MDCPR,MDCK,MDCPRO,MDCX,MDDTE,MDLP,MDFIL,MDSTK,MDX4 S MDFIL=123,MDSTK="2,9"
"RTN","MDPS5",10,0)
 D OER^GMRCSLM1(MDDFN,"",MDSDT,MDEDT,MDSTK,1)
"RTN","MDPS5",11,0)
 I $G(^TMP("GMRCR",$J,"CS",1,0))["< PATIENT DOES NOT HAVE ANY CONSULTS/REQUESTS" Q
"RTN","MDPS5",12,0)
 S MDLP="" F  S MDLP=$O(^TMP("GMRCR",$J,"CS",MDLP)) Q:MDLP="AD"  S MDX=$G(^(MDLP,0)) D
"RTN","MDPS5",13,0)
 .S MDCPRO=$P(MDX,U,5),MDX=+MDX
"RTN","MDPS5",14,0)
 .Q:$$GET1^DIQ(MDFIL,+MDX_",",13,"I")'="P"
"RTN","MDPS5",15,0)
 .S MDCPR=$$GET1^DIQ(MDFIL,+MDX_",",4,"I")
"RTN","MDPS5",16,0)
 .Q:MDCPR'["GMR(123.3"
"RTN","MDPS5",17,0)
 .S MDCPR=+MDCPR S MDFIL=123.3 Q:'$$GET1^DIQ(MDFIL,+MDCPR_",",.05,"I")
"RTN","MDPS5",18,0)
 .Q:$O(^MDD(702,"ACON",+MDX,0))
"RTN","MDPS5",19,0)
 .S MDFIL=123 K MDCX D GETS^DIQ(MDFIL,+MDX_",","50*","I","MDCX")
"RTN","MDPS5",20,0)
 .S MDCK="" F  S MDCK=$O(MDCX(123.03,MDCK)) Q:MDCK<1  S MDX4=$G(MDCX(123.03,MDCK,.01,"I")) D
"RTN","MDPS5",21,0)
 ..I MDX4["TIU" D
"RTN","MDPS5",22,0)
 ...S MDFIL=8925,MDDTE=$$GET1^DIQ(MDFIL,+MDX4_",",1201,"I")
"RTN","MDPS5",23,0)
 ...S Y=MDDTE X ^DD("DD") N MDREV S MDREV=(9999999.9999-MDDTE)
"RTN","MDPS5",24,0)
 ...S:$G(^TMP("MDPLST",$J,MDCPRO,MDREV_"^"_+MDX4))="" ^(MDREV_"^"_+MDX4)=MDCPRO_"^"_+MDX4_"^"_"PRPRO"_"^"_"MDPS4"_"^^"_Y_"^^^^^"_MDCPRO_"^^"_+MDX_"^"_+MDX4,MDFIL=123
"RTN","MDPS5",25,0)
 ...Q
"RTN","MDPS5",26,0)
 ..Q
"RTN","MDPS5",27,0)
 .Q
"RTN","MDPS5",28,0)
 K ^TMP("GMRCR",$J,"CS")
"RTN","MDPS5",29,0)
 Q
"RTN","MDPS5",30,0)
PRPRO ; Return the Result Text for File Consult Procedure records
"RTN","MDPS5",31,0)
 Q:'$G(MCARGDA)
"RTN","MDPS5",32,0)
 N FFF,MDCLIN,MDCON,MDF,MDIMG,MDMCG,MDMED,MDREC,MDPRILV,MDPTR,MDSTUDY,MDTIU,MDX4,PATID,MDRPG,RESULTS
"RTN","MDPS5",33,0)
 I '$G(MDALL) K ^TMP("MDPTXT",$J)
"RTN","MDPS5",34,0)
 S MDIMG=0,$P(FFF,"-",80)="",MDRPG=0,MDF=123
"RTN","MDPS5",35,0)
 S MDSTUDY=+$G(MCARGDA)
"RTN","MDPS5",36,0)
 S (MDPRILV,RESULTS)="",MDCLIN=0
"RTN","MDPS5",37,0)
 I +MDPRILV D TGET^TIUSRVR1(.RESULTS,+MDSTUDY) M ^TMP("MDPTXT",$J,MCARGDA,MCPRO)=@RESULTS K ^TMP("TIUVIEW",$J) Q:+$G(MDALL)
"RTN","MDPS5",38,0)
 S:+MDPRILV<1 ^TMP("MDPTXT",$J,MCARGDA,MCPRO,1)=$P(MDPRILV,U,2)
"RTN","MDPS5",39,0)
NXT Q:+$G(MDALL)  Q:+$G(MDRDV)
"RTN","MDPS5",40,0)
 I $D(ORHFS) U IO G PRINT^MDPS1
"RTN","MDPS5",41,0)
 G PRINT^MDPS1
"VER")
8.0^22.0
"BLD",5596,6)
^6
**END**
**END**
