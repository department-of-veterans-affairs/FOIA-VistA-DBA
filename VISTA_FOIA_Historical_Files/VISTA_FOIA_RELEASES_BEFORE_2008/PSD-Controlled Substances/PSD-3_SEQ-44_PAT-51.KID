Released PSD*3*51 SEQ #44
Extracted from mail message
**KIDS**:PSD*3.0*51^

**INSTALL NAME**
PSD*3.0*51
"BLD",5396,0)
PSD*3.0*51^CONTROLLED SUBSTANCES^0^3041116^y
"BLD",5396,1,0)
^^3^3^3041116^
"BLD",5396,1,1,0)
This patch will correct the problems identified in NOIS calls
"BLD",5396,1,2,0)
 SBY-0904-30620 ERROR - MSG+1^PSDORD4
"BLD",5396,1,3,0)
 PRE-1004-60136 PROBLEM SCANNING DRUG FOR SIGN OUT FOR PT
"BLD",5396,4,0)
^9.64PA^^
"BLD",5396,"ABPKG")
n
"BLD",5396,"KRN",0)
^9.67PA^8989.52^19
"BLD",5396,"KRN",.4,0)
.4
"BLD",5396,"KRN",.401,0)
.401
"BLD",5396,"KRN",.402,0)
.402
"BLD",5396,"KRN",.403,0)
.403
"BLD",5396,"KRN",.5,0)
.5
"BLD",5396,"KRN",.84,0)
.84
"BLD",5396,"KRN",3.6,0)
3.6
"BLD",5396,"KRN",3.8,0)
3.8
"BLD",5396,"KRN",9.2,0)
9.2
"BLD",5396,"KRN",9.8,0)
9.8
"BLD",5396,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5396,"KRN",9.8,"NM",1,0)
PSDRF^^0^B21036728
"BLD",5396,"KRN",9.8,"NM",2,0)
PSDORD^^0^B20832774
"BLD",5396,"KRN",9.8,"NM","B","PSDORD",2)

"BLD",5396,"KRN",9.8,"NM","B","PSDRF",1)

"BLD",5396,"KRN",19,0)
19
"BLD",5396,"KRN",19,"NM",0)
^9.68A^^
"BLD",5396,"KRN",19.1,0)
19.1
"BLD",5396,"KRN",101,0)
101
"BLD",5396,"KRN",409.61,0)
409.61
"BLD",5396,"KRN",771,0)
771
"BLD",5396,"KRN",870,0)
870
"BLD",5396,"KRN",8989.51,0)
8989.51
"BLD",5396,"KRN",8989.52,0)
8989.52
"BLD",5396,"KRN",8994,0)
8994
"BLD",5396,"KRN","B",.4,.4)

"BLD",5396,"KRN","B",.401,.401)

"BLD",5396,"KRN","B",.402,.402)

"BLD",5396,"KRN","B",.403,.403)

"BLD",5396,"KRN","B",.5,.5)

"BLD",5396,"KRN","B",.84,.84)

"BLD",5396,"KRN","B",3.6,3.6)

"BLD",5396,"KRN","B",3.8,3.8)

"BLD",5396,"KRN","B",9.2,9.2)

"BLD",5396,"KRN","B",9.8,9.8)

"BLD",5396,"KRN","B",19,19)

"BLD",5396,"KRN","B",19.1,19.1)

"BLD",5396,"KRN","B",101,101)

"BLD",5396,"KRN","B",409.61,409.61)

"BLD",5396,"KRN","B",771,771)

"BLD",5396,"KRN","B",870,870)

"BLD",5396,"KRN","B",8989.51,8989.51)

"BLD",5396,"KRN","B",8989.52,8989.52)

"BLD",5396,"KRN","B",8994,8994)

"BLD",5396,"QUES",0)
^9.62^^
"BLD",5396,"REQB",0)
^9.611^1^1
"BLD",5396,"REQB",1,0)
PSD*3.0*25^1
"BLD",5396,"REQB","B","PSD*3.0*25",1)

"MBREQ")
0
"PKG",113,-1)
1^1
"PKG",113,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",113,20,0)
^9.402P^^
"PKG",113,22,0)
^9.49I^1^1
"PKG",113,22,1,0)
3.0^2970213^2970403^24
"PKG",113,22,1,"PAH",1,0)
51^3041116
"PKG",113,22,1,"PAH",1,1,0)
^^3^3^3041116
"PKG",113,22,1,"PAH",1,1,1,0)
This patch will correct the problems identified in NOIS calls
"PKG",113,22,1,"PAH",1,1,2,0)
 SBY-0904-30620 ERROR - MSG+1^PSDORD4
"PKG",113,22,1,"PAH",1,1,3,0)
 PRE-1004-60136 PROBLEM SCANNING DRUG FOR SIGN OUT FOR PT
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSDORD")
0^2^B20832774
"RTN","PSDORD",1,0)
PSDORD ;BIR/JPW,LTL - Nurse CS Order Request Entry DIR style; 8 Aug 94
"RTN","PSDORD",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;**51**;13 Feb 97
"RTN","PSDORD",3,0)
 ;Any requests not ordered?
"RTN","PSDORD",4,0)
 K PSD,PSDA,PSDB S PSD=0
"RTN","PSDORD",5,0)
 W !,"Searching for ",$P($G(^VA(200,DUZ,.1)),U,4),"'s pending requests."
"RTN","PSDORD",6,0)
 F  S PSD=$O(^PSD(58.8,"AC",.5,+NAOU,PSD)) Q:'PSD  D
"RTN","PSDORD",7,0)
 .S PSD(1)=0 F  S PSD(1)=$O(^PSD(58.8,"AC",.5,+NAOU,PSD,PSD(1))) Q:'PSD(1)  W "." S:$P($G(^PSD(58.8,+NAOU,1,+PSD,3,PSD(1),0)),U,4)=DUZ PSDA(PSD,PSD(1))=$G(^(0))
"RTN","PSDORD",8,0)
 I $O(PSDA(0)) D ^PSDORD1 G:$G(PSDOUT) END
"RTN","PSDORD",9,0)
 W:'$O(PSDA(0)) "  No pending requests.",!
"RTN","PSDORD",10,0)
DRUG ;select drug
"RTN","PSDORD",11,0)
 S MSG=0 ;; PSD*3*51 - RJS
"RTN","PSDORD",12,0)
 K DA,DIC,PSDR S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" W $S('$G(^PSD(58.8,NAOU,1,Y,0)):"" NOT STOCKED BY ""_NAOUN,$P(^(0),U,14)&($P(^(0),U,14)'>DT):"" INACTIVE on ""_NAOUN,1:"""")"
"RTN","PSDORD",13,0)
 S DIC("S")="I '$P($G(^(7)),U,2),$S('$P(^(0),""^"",14):1,+$P(^(0),""^"",14)>DT:1,1:0)"
"RTN","PSDORD",14,0)
 S DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_+PSDS_",1,"
"RTN","PSDORD",15,0)
 ;one time requests not allowed by dispensing site
"RTN","PSDORD",16,0)
 D:'$P($G(^PSD(58.8,+PSDS,0)),U,13)
"RTN","PSDORD",17,0)
 .S DIC("W")="W:$P(^PSDRUG(Y,0),U,9) ""  N/F"" I $P(^PSD(58.8,NAOU,1,Y,0),U,14)]"""",$P(^(0),U,14)'>DT W $C(7),""  *** INACTIVE ***"""
"RTN","PSDORD",18,0)
 .S DIC("S")="I $S('$P(^(0),U,14):1,+$P(^(0),U,14)>DT:1,1:0)"
"RTN","PSDORD",19,0)
 .S DA(1)=+NAOU,DIC="^PSD(58.8,"_NAOU_",1,"
"RTN","PSDORD",20,0)
 D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT)) END G:Y<1&($O(PSDA(0))) ^PSDORD1 G:Y<1 END S PSDR=+Y,PSDRN=$S($P(^PSDRUG(PSDR,0),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDORD",21,0)
 I $S('$D(^PSD(58.8,NAOU,1,PSDR,0)):1,$P(^(0),U,14)&($P(^(0),U,14)'>DT):1,1:0) D ^PSDORD4 G:$D(DIRUT) END G DRUG
"RTN","PSDORD",22,0)
 I '$D(^PSD(58.8,NAOU,1,PSDR,0)) D MSG G END
"RTN","PSDORD",23,0)
 I '$D(^PSD(58.8,+PSDS,1,PSDR,0)) S MSG=2 D MSG G END
"RTN","PSDORD",24,0)
 S NBKU=$P(^PSD(58.8,+PSDS,1,PSDR,0),"^",8),NPKG=+$P(^(0),"^",9)
"RTN","PSDORD",25,0)
 I NBKU']"" S MSG1=3 D MSG G END
"RTN","PSDORD",26,0)
 I 'NPKG S MSG1=4 D MSG G END
"RTN","PSDORD",27,0)
 D LIST^PSDORL
"RTN","PSDORD",28,0)
 ;Perpetual?
"RTN","PSDORD",29,0)
 G:$P($G(^PSD(58.8,+NAOU,2)),U,5) ^PSDORD3
"RTN","PSDORD",30,0)
QTY K ORD S PSDOUT=0 S DIR(0)="58.800118,5A"
"RTN","PSDORD",31,0)
 S DIR("A")="QUANTITY ("_NBKU_"/"_NPKG_"): ",DIR("B")=NPKG
"RTN","PSDORD",32,0)
 D ^DIR K DIR G:$D(DIRUT) END G:Y<1 DRUG
"RTN","PSDORD",33,0)
 I Y=NPKG S PSDQTY=Y D DIE W ! G DRUG
"RTN","PSDORD",34,0)
 I X["?"!(X'?1.N)!(X#NPKG)!('X) W !!,"Quantity must be "_NPKG_" or a multiple of "_NPKG,! G QTY
"RTN","PSDORD",35,0)
 S CNT=X/NPKG W !!,"This will be "_CNT_" separate order requests.  The quantity is "_NPKG_" per request."
"RTN","PSDORD",36,0)
 W ! K DA,DIR,DIRUT S DIR(0)="Y",DIR("A")="Do you want me to generate the "_CNT_" separate order requests",DIR("B")="YES",DIR("?",1)="Answer 'YES' to create the multiple order requests,"
"RTN","PSDORD",37,0)
 S DIR("?")="Answer 'NO' to edit your comments or '^' to quit." D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDORD",38,0)
 I 'Y W !,"No order request created.  You must edit quantity.",! G QTY
"RTN","PSDORD",39,0)
 I Y W !!,"The "_CNT_" requests are being created.",! S PSDQTY=NPKG D  W ! G DRUG
"RTN","PSDORD",40,0)
 .F ORD=1:1:CNT W !!,"Creating your order request # "_ORD_" of "_CNT_" for "_PSDRN D DIE S PSDA(+PSDR,PSDA)=$G(^PSD(58.8,+NAOU,1,+PSDR,3,+PSDA,0))
"RTN","PSDORD",41,0)
 I '$G(PSDOUT) W ! G DRUG
"RTN","PSDORD",42,0)
END K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDORD",43,0)
 K NAOU,NAOUN,NBKU,NPKG,OK,OKTYP,ORD,PSD,PSDA,PSDB,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDORD",44,0)
 Q
"RTN","PSDORD",45,0)
DIE ;create the order request
"RTN","PSDORD",46,0)
 S:'$D(^PSD(58.8,NAOU,1,PSDR,3,0)) ^(0)="^58.800118A^^"
"RTN","PSDORD",47,0)
 S PSDA=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 I $D(^PSD(58.8,NAOU,1,PSDR,3,PSDA)) S $P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)=$P(^PSD(58.8,NAOU,1,PSDR,3,0),"^",3)+1 G DIE
"RTN","PSDORD",48,0)
 K DA,DIC,DIE,DD,DR,DO S DIC(0)="L",(DIC,DIE)="^PSD(58.8,"_NAOU_",1,"_PSDR_",3,",DA(2)=NAOU,DA(1)=PSDR,(X,DINUM)=PSDA D FILE^DICN K DIC
"RTN","PSDORD",49,0)
 D NOW^%DTC S PSDT=+$E(%,1,12) W ?10,!!,"processing now..."
"RTN","PSDORD",50,0)
 S DA=PSDA,DA(1)=PSDR,DA(2)=NAOU,DR="1////"_PSDT_";2////"_+PSDS_";3////"_PSDUZ_";10////.5;5////"_PSDQTY_";13" D ^DIE K DIE,DR
"RTN","PSDORD",51,0)
 S PSDA(+PSDR,+PSDA)=$G(^PSD(58.8,+NAOU,1,+PSDR,3,PSDA,0))
"RTN","PSDORD",52,0)
 Q
"RTN","PSDORD",53,0)
MSG ;display error message
"RTN","PSDORD",54,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDORD",55,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDORD",56,0)
 Q
"RTN","PSDRF")
0^1^B21036728
"RTN","PSDRF",1,0)
PSDRF ;BIR/JPW,LTL - Nurse RF Dispensing ; 8 Aug 94
"RTN","PSDRF",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;**25,51**;13 Feb 97
"RTN","PSDRF",3,0)
 ;Reference to ^PSD(58.8 are covered by DBIA #2711
"RTN","PSDRF",4,0)
 ;Reference to ^PSD(58.81 are covered by DBIA #2808
"RTN","PSDRF",5,0)
 ;Reference to ^PSDRUG( are covered by DBIA #221
"RTN","PSDRF",6,0)
 ;Reference to $$WITNESS^XUVERIFY are covered by DBIA #1513
"RTN","PSDRF",7,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDRF",8,0)
 ;S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,1:0) I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to order",!,?12,"narcotic supplies.",! K OK Q
"RTN","PSDRF",9,0)
 I $P($G(^VA(200,DUZ,20)),U,4)']"" N XQH S XQH="PSD ESIG" D EN^XQH G END
"RTN","PSDRF",10,0)
 S PSDUZ=DUZ,(MSG,MSG1)=0,Y=DT X ^DD("DD") S REQD=Y
"RTN","PSDRF",11,0)
NURSE N X,X1 D SIG^XUSESIG I X1="" G END
"RTN","PSDRF",12,0)
NAOU ;select NAOU to dispense from
"RTN","PSDRF",13,0)
 I $G(NAOU) S PSDS=+$P(^PSD(58.8,NAOU,0),U,4) G PATIENT
"RTN","PSDRF",14,0)
 W !!,"Please enter the ward from which the drug(s) will be signed out."
"RTN","PSDRF",15,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select Ward: "
"RTN","PSDRF",16,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDRF",17,0)
 W ! D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDRF",18,0)
 I '$D(^PSD(58.8,NAOU,0)) S MSG=1 D MSG G END
"RTN","PSDRF",19,0)
 I '$O(^PSD(58.8,NAOU,1,0)) S MSG=1,MSG1=2 D MSG G END
"RTN","PSDRF",20,0)
 I '$P(^PSD(58.8,NAOU,0),U,4) S MSG=2 D MSG G END
"RTN","PSDRF",21,0)
 S PSDS=+$P(^PSD(58.8,NAOU,0),"^",4),PSDS=PSDS_"^"_+$P(^PSD(58.8,+PSDS,0),"^",5) I '+PSDS S (MSG,MSG1)=1 D MSG G END
"RTN","PSDRF",22,0)
 I '$D(^PSD(58.8,+PSDS,0)) S MSG=2 D MSG G END
"RTN","PSDRF",23,0)
 I '$O(^PSD(58.8,+PSDS,1,0)) S MSG=2,MSG1=2 D MSG G END
"RTN","PSDRF",24,0)
 ;S TYPE=$P(^PSD(58.8,+PSDS,0),"^",2),OKTYP=$S(TYPE="M":1,TYPE="S":1,1:0) I 'OKTYP W !!,"Contact your Pharmacy Coordinator.",!,"The Pharmacy Dispensing Site is invalid for this NAOU." G END
"RTN","PSDRF",25,0)
PATIENT N DIC,DTOUT,DUOUT,X,Y,PSDOUT S DIC="^DPT(",DIC(0)="AEMQ"
"RTN","PSDRF",26,0)
 S DIC("A")="Scan/Enter Patient: "
"RTN","PSDRF",27,0)
 W ! D ^DIC K DIC G:Y<1 END S PAT=+Y
"RTN","PSDRF",28,0)
DRUG ;select drug
"RTN","PSDRF",29,0)
 N DIR,PSD,PSDR,PSDQ,WQTY
"RTN","PSDRF",30,0)
 S DIR(0)="FAO^1:40"
"RTN","PSDRF",31,0)
 S DIR("A")="Scan Drug Label or Enter Label # or Drug: "
"RTN","PSDRF",32,0)
 W ! D ^DIR K DIR G:Y="" PATIENT G:$D(DIRUT) END
"RTN","PSDRF",33,0)
 I $L(Y)=1,Y'=" " W $C(7),!!,"Please enter more than one character.",! G DRUG
"RTN","PSDRF",34,0)
 I $O(^PSD(58.81,"D",Y,0)) D  I '$G(PSDR) W $C(7),!!,"This is not a valid Pharmacy Dispensing number for this ward.",!! G END
"RTN","PSDRF",35,0)
 .S PSD=0
"RTN","PSDRF",36,0)
 .F  S PSD=$O(^PSD(58.81,"D",Y,PSD)) Q:'PSD  S PSD(1)=$G(^PSD(58.81,PSD,0)) I $P(PSD(1),U,11)>3,$P(PSD(1),U,18)=NAOU S PSDR=$P(PSD(1),U,5),PSDPN=$P(PSD(1),U,17),PSDTYP=17 Q
"RTN","PSDRF",37,0)
 W:$G(PSDR) !!,$P($G(^PSDRUG(PSDR,0)),U)
"RTN","PSDRF",38,0)
 D:'$G(PSDR)  G:$D(DTOUT)!($D(DUOUT)) END G:Y<1 PATIENT
"RTN","PSDRF",39,0)
 .S DIC="^PSD(58.8,NAOU,1,",DIC(0)="EMQSZ",DA(1)=NAOU
"RTN","PSDRF",40,0)
 .W ! D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)
"RTN","PSDRF",41,0)
 .S PSDR=+Y,PSDTYP=17
"RTN","PSDRF",42,0)
BAL S PSDR(1)=$G(^PSD(58.8,NAOU,1,PSDR,0)),OQTY=$P(PSDR(1),U,4)
"RTN","PSDRF",43,0)
 W:'OQTY&$D(Y(0,0)) !,?12,Y(0,0)
"RTN","PSDRF",44,0)
 I 'OQTY,'$P($G(^PSD(58.81,+$G(PSD),9)),U) W !!,"Sorry, this drug has a zero balance." G DRUG
"RTN","PSDRF",45,0)
 ;PSD*3*25 (DAVE B)
"RTN","PSDRF",46,0)
 K PSDDAVE D ^PSDRFV I $G(PSDDAVE)=1 K PSDDAVE S PSDOUT=1 G END
"RTN","PSDRF",47,0)
 S DIR(0)="Y",DIR("A")="Starting Balance:  "_OQTY_" "_$P(PSDR(1),U,8)_"     Correct count"
"RTN","PSDRF",48,0)
 S DIR("B")="Yes",NUR1=DUZ
"RTN","PSDRF",49,0)
 S DIR("?")="Answer Yes if the amount on hand equals the starting balance."
"RTN","PSDRF",50,0)
 W ! D ^DIR K DIR G:$D(DIRUT) END
"RTN","PSDRF",51,0)
 I Y=0 D ^PSDRF2 G:$G(PSDOUT) END S $P(PSDR(1),U,4)=PSDQ(1),OQTY=PSDQ(1),PSDTYP=17
"RTN","PSDRF",52,0)
 G:'$G(PSDS) END
"RTN","PSDRF",53,0)
LIQ G:$P($G(^PSD(58.8,+PSDS,1,PSDR,7)),U) ^PSDRFL
"RTN","PSDRF",54,0)
QTY S DIR(0)="NA^.01:"_OQTY_":2",DIR("A")="Amount given: "
"RTN","PSDRF",55,0)
 S DIR("B")=1 W ! D ^DIR K DIR G:Y'>0 END S (PSDQ,OQTY)=Y
"RTN","PSDRF",56,0)
WASTE I PSDQ#1 D  G:$G(PSDOUT) END
"RTN","PSDRF",57,0)
 .W ?30,"Amount wasted: ",1-PSDQ#1,! S WQTY=1-PSDQ#1
"RTN","PSDRF",58,0)
 .W !,"You have sixty seconds to find a witness.",!
"RTN","PSDRF",59,0)
WIT .W:$G(NUR2(1)) !,"OK, sixty more seconds, but that's it.",!
"RTN","PSDRF",60,0)
 .S NUR2=$$WITNESS^XUVERIFY("WITNESS"),NUR2(1)=$G(NUR2(1))+1
"RTN","PSDRF",61,0)
 .I NUR2=DUZ W !!,"Wait a minute, you can't witness yourself!",$C(7) G WIT
"RTN","PSDRF",62,0)
 .G:NUR2'>0&(NUR2(1)<2) WIT I NUR2'>0 S PSDOUT=1 Q
"RTN","PSDRF",63,0)
 .W !!,"Thank you, ",$S($P($G(^VA(200,NUR2,.1)),U,4)]"":$P($G(^(.1)),U,4),1:$P($G(^VA(200,NUR2,0)),U)) S PSDQ=PSDQ+(1-PSDQ#1)
"RTN","PSDRF",64,0)
 W !!,"Remaining Balance: ",$P(PSDR(1),U,4)-PSDQ," ",$P(PSDR(1),U,8)
"RTN","PSDRF",65,0)
 D UPDAT^PSDRF1 G DRUG
"RTN","PSDRF",66,0)
END W:$G(PSDOUT) !!,"No dose signed out.",$C(7),!! K %,%DT,%H,%I,CNT,CNT1,DA,DIC,DIE,DINUM,DIR,DIROUT,DIRUT,DIWF,DIWL,DIWR,DR,DTOUT,DUOUT,LN,MSG,MSG1
"RTN","PSDRF",67,0)
 K NAOU,NAOUN,NBKU,NPKG,NUR2,OK,OKTYP,ORD,PAT,PSDA,PSDEM,PSDOUT,PSDQTY,PSDRD,PSDR,PSDRN,PSDS,PSDT,PSDUZ,PSDUZN,REQD,TEXT,TYPE,WORD,X,Y
"RTN","PSDRF",68,0)
 Q
"RTN","PSDRF",69,0)
MSG ;display error message
"RTN","PSDRF",70,0)
 W $C(7),!!,?10,"Contact your Pharmacy Coordinator.",!,?10,"This "_$S(MSG=2:"Dispensing Site",MSG=1:"NAOU",1:"Drug")_" is missing "
"RTN","PSDRF",71,0)
 W $S(MSG1=1:"Primary Disp. Site",MSG1=2:"stocked drugs",MSG1=3:"narcotic breakdown unit",MSG1=4:"narcotic package size",1:"data")_".",!
"RTN","PSDRF",72,0)
 Q
"VER")
8.0^22
**END**
**END**
