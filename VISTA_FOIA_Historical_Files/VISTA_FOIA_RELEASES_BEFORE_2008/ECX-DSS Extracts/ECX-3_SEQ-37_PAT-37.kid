Released ECX*3*37 SEQ #37
Extracted from mail message
**KIDS**:ECX*3.0*37^

**INSTALL NAME**
ECX*3.0*37
"BLD",3680,0)
ECX*3.0*37^DSS EXTRACTS^0^3011003^y
"BLD",3680,4,0)
^9.64PA^^
"BLD",3680,"KRN",0)
^9.67PA^19^17
"BLD",3680,"KRN",.4,0)
.4
"BLD",3680,"KRN",.401,0)
.401
"BLD",3680,"KRN",.402,0)
.402
"BLD",3680,"KRN",.403,0)
.403
"BLD",3680,"KRN",.5,0)
.5
"BLD",3680,"KRN",.84,0)
.84
"BLD",3680,"KRN",3.6,0)
3.6
"BLD",3680,"KRN",3.8,0)
3.8
"BLD",3680,"KRN",9.2,0)
9.2
"BLD",3680,"KRN",9.8,0)
9.8
"BLD",3680,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",3680,"KRN",9.8,"NM",1,0)
ECXUTL3^^0^B49846097
"BLD",3680,"KRN",9.8,"NM",2,0)
ECXLABR^^0^B11460632
"BLD",3680,"KRN",9.8,"NM",3,0)
ECXLAB1^^0^B1312874
"BLD",3680,"KRN",9.8,"NM",4,0)
ECXSCNS^^0^B21811766
"BLD",3680,"KRN",9.8,"NM",5,0)
ECXPRO1^^0^B18021475
"BLD",3680,"KRN",9.8,"NM","B","ECXLAB1",3)

"BLD",3680,"KRN",9.8,"NM","B","ECXLABR",2)

"BLD",3680,"KRN",9.8,"NM","B","ECXPRO1",5)

"BLD",3680,"KRN",9.8,"NM","B","ECXSCNS",4)

"BLD",3680,"KRN",9.8,"NM","B","ECXUTL3",1)

"BLD",3680,"KRN",19,0)
19
"BLD",3680,"KRN",19.1,0)
19.1
"BLD",3680,"KRN",101,0)
101
"BLD",3680,"KRN",409.61,0)
409.61
"BLD",3680,"KRN",771,0)
771
"BLD",3680,"KRN",870,0)
870
"BLD",3680,"KRN",8994,0)
8994
"BLD",3680,"KRN","B",.4,.4)

"BLD",3680,"KRN","B",.401,.401)

"BLD",3680,"KRN","B",.402,.402)

"BLD",3680,"KRN","B",.403,.403)

"BLD",3680,"KRN","B",.5,.5)

"BLD",3680,"KRN","B",.84,.84)

"BLD",3680,"KRN","B",3.6,3.6)

"BLD",3680,"KRN","B",3.8,3.8)

"BLD",3680,"KRN","B",9.2,9.2)

"BLD",3680,"KRN","B",9.8,9.8)

"BLD",3680,"KRN","B",19,19)

"BLD",3680,"KRN","B",19.1,19.1)

"BLD",3680,"KRN","B",101,101)

"BLD",3680,"KRN","B",409.61,409.61)

"BLD",3680,"KRN","B",771,771)

"BLD",3680,"KRN","B",870,870)

"BLD",3680,"KRN","B",8994,8994)

"BLD",3680,"QUES",0)
^9.62^^
"BLD",3680,"REQB",0)
^9.611^4^2
"BLD",3680,"REQB",1,0)
DG*5.3*314^2
"BLD",3680,"REQB",4,0)
ECX*3.0*35^2
"BLD",3680,"REQB","B","DG*5.3*314",1)

"BLD",3680,"REQB","B","ECX*3.0*35",4)

"MBREQ")
0
"PKG",513,-1)
1^1
"PKG",513,0)
DSS EXTRACTS^ECX^Decision Support System. (DSS)
"PKG",513,20,0)
^9.402P^^
"PKG",513,22,0)
^9.49I^1^1
"PKG",513,22,1,0)
3.0^3010618^2980112^11714
"PKG",513,22,1,"PAH",1,0)
37^3011003
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","ECXLAB1")
0^3^B1312874
"RTN","ECXLAB1",1,0)
ECXLAB1 ;ALB/JAP,BIR/CML,-Driver Routine for DSS Lab Extract; [ 03/20/97  11:54 AM ] ; 8/8/01 4:16pm
"RTN","ECXLAB1",2,0)
 ;;3.0;DSS EXTRACTS;**8,37**;Dec 22, 1997
"RTN","ECXLAB1",3,0)
EN ;entry point from option
"RTN","ECXLAB1",4,0)
 N JJ,SS,LN,X,Y,DIRUT,DTOUT,DUOUT,DIR
"RTN","ECXLAB1",5,0)
 I '$O(^ECX(728,0)) D  Q
"RTN","ECXLAB1",6,0)
 .W $C(7),!!,"You have not yet defined your facility in the DSS EXTRACTS file (#728)!"
"RTN","ECXLAB1",7,0)
 .I ($E(IOST)="C") D
"RTN","ECXLAB1",8,0)
 ..S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXLAB1",9,0)
 ..K X,Y
"RTN","ECXLAB1",10,0)
 ..S DIR(0)="E" W ! D ^DIR K DIR
"RTN","ECXLAB1",11,0)
 ;Check for lmip flag (field .5) in file (#728), if empty string write message and terminate extract
"RTN","ECXLAB1",12,0)
 I $G(^ECX(728,1,"LMIP"))'=1 D  Q
"RTN","ECXLAB1",13,0)
 .S $P(LN,"-",80)=""
"RTN","ECXLAB1",14,0)
 .W !,"LAB Extracts cannot be generated without LMIP Codes.",!,"Please check with your LAB ADPAC or LAB Service."
"RTN","ECXLAB1",15,0)
 .W !,"...exiting."
"RTN","ECXLAB1",16,0)
 D BEG^ECXLABN
"RTN","ECXLAB1",17,0)
 Q
"RTN","ECXLABR")
0^2^B11460632
"RTN","ECXLABR",1,0)
ECXLABR ;ALB/JAP,BIR/CML-LAR Extract for DSS (New Format - With LMIP Codes) ; 6/14/01 2:21pm
"RTN","ECXLABR",2,0)
 ;;3.0;DSS EXTRACTS;**8,24,33,37**;Dec 22, 1997
"RTN","ECXLABR",3,0)
BEG ;entry point from option
"RTN","ECXLABR",4,0)
 D SETUP I ECFILE="" Q
"RTN","ECXLABR",5,0)
 D ^ECXTRAC,^ECXKILL
"RTN","ECXLABR",6,0)
 Q
"RTN","ECXLABR",7,0)
 ;
"RTN","ECXLABR",8,0)
START ; entry when queued
"RTN","ECXLABR",9,0)
 N X,OK
"RTN","ECXLABR",10,0)
 K ^LAR(64.036) S LRSDT=ECSD,LREDT=ECED
"RTN","ECXLABR",11,0)
 D ^LRCAPDAR
"RTN","ECXLABR",12,0)
 ;quit if no completion date for API compile
"RTN","ECXLABR",13,0)
 I '$P($G(^LAR(64.036,1,2,1,0)),U,4) Q
"RTN","ECXLABR",14,0)
 ;build local array of workload codes for local lab tests linked to
"RTN","ECXLABR",15,0)
 ;DSS tests
"RTN","ECXLABR",16,0)
 K ECLOC S ECDTST=0
"RTN","ECXLABR",17,0)
 F  S ECDTST=$O(^ECX(727.2,1,1,ECDTST)) Q:('ECDTST)  S ECLTST=0 D
"RTN","ECXLABR",18,0)
 .F  S ECLTST=$O(^ECX(727.2,1,1,ECDTST,"LOC",ECLTST)) Q:'ECLTST  D
"RTN","ECXLABR",19,0)
 ..S ECLTIEN=+^ECX(727.2,1,1,ECDTST,"LOC",ECLTST,0)
"RTN","ECXLABR",20,0)
 ..S ECWCDA=+$G(^LAB(60,ECLTIEN,64))
"RTN","ECXLABR",21,0)
 ..I ECWCDA S ECWC=$P(^LAM(ECWCDA,0),U,2),ECLOC(ECWCDA)=ECWC
"RTN","ECXLABR",22,0)
 K ECLTIEN
"RTN","ECXLABR",23,0)
 ;process temporary lab file #64.036
"RTN","ECXLABR",24,0)
 S QFLG=0,ECLRN=1
"RTN","ECXLABR",25,0)
 F  S ECLRN=$O(^LAR(64.036,ECLRN)) Q:('ECLRN)!(QFLG)  D
"RTN","ECXLABR",26,0)
 .I $D(^LAR(64.036,ECLRN,0))  D
"RTN","ECXLABR",27,0)
 ..S EC1=^LAR(64.036,ECLRN,0),ECF=$P(EC1,U,2)
"RTN","ECXLABR",28,0)
 ..Q:ECF=""
"RTN","ECXLABR",29,0)
 ..S ECXDFN=$P(EC1,U,3)
"RTN","ECXLABR",30,0)
 ..S ECXTIME=$S($P(EC1,U,10)="":"000300",1:$P(EC1,U,10))
"RTN","ECXLABR",31,0)
 ..S ECXDATE=$P(EC1,U,9)_"."_$P(EC1,U,10)
"RTN","ECXLABR",32,0)
 ..S ECORDT=$$ECXDATE^ECXUTL($P(EC1,U,4),ECXYM)
"RTN","ECXLABR",33,0)
 ..S ECORTM=$$ECXTIME^ECXUTL($P(EC1,U,4)_"."_$P(EC1,U,5))
"RTN","ECXLABR",34,0)
 ..S ECREDT=$$ECXDATE^ECXUTL($P(EC1,U,6),ECXYM)
"RTN","ECXLABR",35,0)
 ..S ECRETM=$$ECXTIME^ECXUTL($P(EC1,U,6)_"."_$P(EC1,U,7))
"RTN","ECXLABR",36,0)
 ..S ECSCDT=$$ECXDATE^ECXUTL($P(EC1,U,9),ECXYM)
"RTN","ECXLABR",37,0)
 ..S ECSCTM=$$ECXTIME^ECXUTL($P(EC1,U,9)_"."_$P(EC1,U,10))
"RTN","ECXLABR",38,0)
 ..S (ECXDOM,ECXDSSD,ECXPNM,ECXSSN,ECXA,ECXMN,ECXTS)=""
"RTN","ECXLABR",39,0)
 ..I ECF=2 D  Q:'OK
"RTN","ECXLABR",40,0)
 ...K ECXPAT S OK=$$PAT^ECXUTL3(ECXDFN,ECXDATE,"1;",.ECXPAT)
"RTN","ECXLABR",41,0)
 ...Q:'OK
"RTN","ECXLABR",42,0)
 ...S ECXPNM=ECXPAT("NAME"),ECXSSN=ECXPAT("SSN"),ECXMPI=ECXPAT("MPI")
"RTN","ECXLABR",43,0)
 ...S X=$$INP^ECXUTL2(ECXDFN,ECXDATE),ECXA=$P(X,U)
"RTN","ECXLABR",44,0)
 ...S ECXMN=$P(X,U,2),ECXTS=$P(X,U,3),ECXDOM=$P(X,U,10)
"RTN","ECXLABR",45,0)
 ..;allow for referral patients in future??
"RTN","ECXLABR",46,0)
 ..;I ECF=67 S ECSN="000123456",ECNA="RFRL"
"RTN","ECXLABR",47,0)
 ..;loop on results multiple
"RTN","ECXLABR",48,0)
 ..S ECRES=0
"RTN","ECXLABR",49,0)
 ..F  S ECRES=$O(^LAR(64.036,ECLRN,1,ECRES)) Q:('ECRES)!(QFLG)  D
"RTN","ECXLABR",50,0)
 ...I $D(^LAR(64.036,ECLRN,1,ECRES,0)) D  Q:QFLG
"RTN","ECXLABR",51,0)
 ....S EC2=^LAR(64.036,ECLRN,1,ECRES,0),ECN=$P(EC2,U),ECRS=$P(EC2,U,2)
"RTN","ECXLABR",52,0)
 ....S ECHL=$E($P(EC2,U,3)),ECWC=+$P(EC2,U,4)
"RTN","ECXLABR",53,0)
 ....S ECWC=$S($D(ECLOC(ECWC)):ECLOC(ECWC),1:"")
"RTN","ECXLABR",54,0)
 ....I ECWC]"" D FILE
"RTN","ECXLABR",55,0)
 K ^LAR(64.036) S ^LAR(64.036,0)="LAB DSS LAR EXTRACT^64.036^"
"RTN","ECXLABR",56,0)
 Q
"RTN","ECXLABR",57,0)
 ;
"RTN","ECXLABR",58,0)
FILE ;file record
"RTN","ECXLABR",59,0)
 ;node0
"RTN","ECXLABR",60,0)
 ;facility (ECINST)^dfn (ECXDFN)^ssn (ECXSSN)^name(ECXPNM)^in/out (ECXA)^
"RTN","ECXLABR",61,0)
 ;day(ECSCDT)^
"RTN","ECXLABR",62,0)
 ;lab test code (ECN)^results (ECRS)^hi/lo indicator (ECHL)^
"RTN","ECXLABR",63,0)
 ;date ordered (ECORDT)^time ordered (ECORTM)^date ready (ECREDT)^
"RTN","ECXLABR",64,0)
 ;time ready (ECRETM)^
"RTN","ECXLABR",65,0)
 ;movement file # (ECXTS)^treating specialty (ECXTS)^
"RTN","ECXLABR",66,0)
 ;workload code(ECWC)^
"RTN","ECXLABR",67,0)
 ;node1
"RTN","ECXLABR",68,0)
 ;mpi (ECXMPI)^dss dept (ECXDSSD)^dom (ECXDOM)^time (ECSCTM)^
"RTN","ECXLABR",69,0)
 ;extended op (ECXEOP)
"RTN","ECXLABR",70,0)
 N DA,DIK
"RTN","ECXLABR",71,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXLABR",72,0)
 S ECODE=EC7_U_EC23_U_ECINST_U_ECXDFN_U_ECXSSN_U_ECXPNM_U_ECXA_U
"RTN","ECXLABR",73,0)
 S ECODE=ECODE_ECSCDT_U_$$RJ^XLFSTR(ECN,4,0)_U_ECRS_U_ECHL_U_ECORDT_U
"RTN","ECXLABR",74,0)
 S ECODE=ECODE_$$LJ^XLFSTR(ECORTM,6,0)_U
"RTN","ECXLABR",75,0)
 S ECODE=ECODE_ECREDT_U_$$LJ^XLFSTR(ECRETM,6,0)_U_ECXMN_U_ECXTS_U_ECWC_U
"RTN","ECXLABR",76,0)
 S ECODE1=ECXMPI_U_ECXDSSD_U_ECXDOM_U_ECSCTM_U_$G(ECXEOP)
"RTN","ECXLABR",77,0)
 S ^ECX(ECFILE,EC7,0)=ECODE,^ECX(ECFILE,EC7,1)=ECODE1,ECRN=ECRN+1
"RTN","ECXLABR",78,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX1^DIK K DIK,DA
"RTN","ECXLABR",79,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S QFLG=1
"RTN","ECXLABR",80,0)
 Q
"RTN","ECXLABR",81,0)
 ;
"RTN","ECXLABR",82,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXLABR",83,0)
 S ECHEAD="LAR"
"RTN","ECXLABR",84,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXLABR",85,0)
 Q
"RTN","ECXLABR",86,0)
 ;
"RTN","ECXLABR",87,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXLABR",88,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"RTN","ECXPRO1")
0^5^B18021475
"RTN","ECXPRO1",1,0)
ECXPRO1 ;ALB/GTS - Prosthetics Extract for DSS (Continued) ; July 16, 1998
"RTN","ECXPRO1",2,0)
 ;;3.0;DSS EXTRACTS;**9,11,13,15,21,24,33,37**;Dec 22, 1997
"RTN","ECXPRO1",3,0)
 ;
"RTN","ECXPRO1",4,0)
NTEG(ECXDFN,ECXLNE,ECXPIEN,ECXN0,ECXNLB,ECINST,ECXFORM) ;** Check for required fields
"RTN","ECXPRO1",5,0)
 ;   Input
"RTN","ECXPRO1",6,0)
 ;    ECXDFN   - ien in file #2
"RTN","ECXPRO1",7,0)
 ;    ECXLNE   - line number variable (passed by reference)
"RTN","ECXPRO1",8,0)
 ;    ECXPIEN  - IEN for the Prosthetics record
"RTN","ECXPRO1",9,0)
 ;    ECXN0    - zero node of the Prosthetics record
"RTN","ECXPRO1",10,0)
 ;    ECXNLB   - LB node of the Prosthetics record
"RTN","ECXPRO1",11,0)
 ;    ECINST   - station number being extracted
"RTN","ECXPRO1",12,0)
 ;    ECXFORM  - Form Requested On
"RTN","ECXPRO1",13,0)
 ;   Output (to be KILLed by calling routine)
"RTN","ECXPRO1",14,0)
 ;    ^TMP("ECX-PRO EXC",$J) - Array for the exception message       
"RTN","ECXPRO1",15,0)
 ;    ECXLNE                 - The number of the next line in the msg
"RTN","ECXPRO1",16,0)
 ;    ECXSTAT2               - Patient Station Number
"RTN","ECXPRO1",17,0)
 ;    ECXDATE                - Delivery Date of Prosthesis
"RTN","ECXPRO1",18,0)
 ;    ECXTYPE                - Type of Transaction work performed
"RTN","ECXPRO1",19,0)
 ;    ECXSRCE                - Source of prosthesis
"RTN","ECXPRO1",20,0)
 ;    ECXHCPCS               - CPT/HCPCS code for prosthesis
"RTN","ECXPRO1",21,0)
 ;    ECXRQST                - Requesting Station
"RTN","ECXPRO1",22,0)
 ;    ECXRCST                - Receiving Station
"RTN","ECXPRO1",23,0)
 ;    ECXPHCPC               - PSAS HCPCS code; if 'unknown', then use CPT/HCPCS code 
"RTN","ECXPRO1",24,0)
 ;   Output (KILLed by NTEG)
"RTN","ECXPRO1",25,0)
 ;    ECXMISS                - 1 indicates missing information
"RTN","ECXPRO1",26,0)
 ;    ECXGOOD                - 0 indicates record should not be extracted
"RTN","ECXPRO1",27,0)
 ;
"RTN","ECXPRO1",28,0)
 N ECXGOOD,ECXMISS
"RTN","ECXPRO1",29,0)
 S (ECXRCST,ECXRQST)="",ECXGOOD=1,ECXSTAT2=$P(ECXN0,U,10)
"RTN","ECXPRO1",30,0)
 I ECXSTAT2]"" D
"RTN","ECXPRO1",31,0)
 .K ECXDIC
"RTN","ECXPRO1",32,0)
 .S DA=ECXSTAT2,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99"
"RTN","ECXPRO1",33,0)
 .D EN^DIQ1 S ECXSTAT2=$G(ECXDIC(4,DA,99,"I")) K DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXPRO1",34,0)
 .S:(ECINST'=$E(ECXSTAT2,1,3)) ECXGOOD=0 ;*Screen for incorrect Station
"RTN","ECXPRO1",35,0)
 ;
"RTN","ECXPRO1",36,0)
 ;** Screen out records
"RTN","ECXPRO1",37,0)
 S:($P(ECXN0,U,17)'="") ECXGOOD=0 ;*SHIP/DEL is not NULL
"RTN","ECXPRO1",38,0)
 S:($P(ECXN0,U,26)'="") ECXGOOD=0 ;*PICKUP/DEL is not NULL
"RTN","ECXPRO1",39,0)
 S:(+($P($G(^RMPR(660,ECXPIEN,"AM")),U,2))=1) ECXGOOD=0 ;*NO ADMIN CT=1
"RTN","ECXPRO1",40,0)
 S:(($P(ECXN0,U,15))'="") ECXGOOD=0 ;*HISTORICAL DATA is not NULL
"RTN","ECXPRO1",41,0)
 ;
"RTN","ECXPRO1",42,0)
 S ECXDATE=$P(ECXN0,U,12),ECXTYPE=$P(ECXN0,U,4),ECXSRCE=$P(ECXN0,U,14)
"RTN","ECXPRO1",43,0)
 S ECXHCPCS=$P($G(^ICPT(+$P(ECXN0,U,22),0)),U,1),ECXCMOD=""
"RTN","ECXPRO1",44,0)
 S ECXHCPCS=$$CPT^ECXUTL3(ECXHCPCS,ECXCMOD)
"RTN","ECXPRO1",45,0)
 ;get psas hcpcs code from file #661.1
"RTN","ECXPRO1",46,0)
 S ECXPHCPC=$P($G(^RMPR(660,ECXPIEN,1)),U,4) D
"RTN","ECXPRO1",47,0)
 .I +ECXPHCPC S ECXPHCPC=$P($G(^RMPR(661.1,ECXPHCPC,0)),U,1)
"RTN","ECXPRO1",48,0)
 .I ECXPHCPC="UNKNOWN" S ECXPHCPC=$E(ECXHCPCS,1,5)
"RTN","ECXPRO1",49,0)
 ;
"RTN","ECXPRO1",50,0)
 ;* Get Requesting Station Number
"RTN","ECXPRO1",51,0)
 I ECXFORM["-3" D
"RTN","ECXPRO1",52,0)
 .S ECXRQST=$P(ECXNLB,U,1)
"RTN","ECXPRO1",53,0)
 .I ECXRQST]"" D
"RTN","ECXPRO1",54,0)
 ..S DA=ECXRQST,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99"
"RTN","ECXPRO1",55,0)
 ..D EN^DIQ1 S ECXRQST=$G(ECXDIC(4,DA,99,"I")) K DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXPRO1",56,0)
 S:(ECXFORM'["-3") ECXRQST=""
"RTN","ECXPRO1",57,0)
 ;
"RTN","ECXPRO1",58,0)
 ;* Screen out records
"RTN","ECXPRO1",59,0)
 S:(+$P(ECXFORM,U,2)=13) ECXGOOD=0 ;*FORM REQUESTED ON = 13
"RTN","ECXPRO1",60,0)
 ;
"RTN","ECXPRO1",61,0)
 ;* Get Receiving Station Number
"RTN","ECXPRO1",62,0)
 I ECXFORM["-3" D
"RTN","ECXPRO1",63,0)
 .S ECXRCST=$P(ECXNLB,U,4)
"RTN","ECXPRO1",64,0)
 .I ECXRCST]"" D
"RTN","ECXPRO1",65,0)
 ..S DA=ECXRCST,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99"
"RTN","ECXPRO1",66,0)
 ..D EN^DIQ1 S ECXRCST=$G(ECXDIC(4,DA,99,"I")) K DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXPRO1",67,0)
 S:(ECXFORM'["-3") ECXRCST=""
"RTN","ECXPRO1",68,0)
 ;
"RTN","ECXPRO1",69,0)
 ;** Check for integrity and set up the problem variable if right DIV
"RTN","ECXPRO1",70,0)
 I ECXGOOD D CHK
"RTN","ECXPRO1",71,0)
 Q ECXGOOD
"RTN","ECXPRO1",72,0)
 ;
"RTN","ECXPRO1",73,0)
CHK ;*Check variables
"RTN","ECXPRO1",74,0)
 ; Input
"RTN","ECXPRO1",75,0)
 ;  Variables set in and Output from NTEG^ECXPRO1
"RTN","ECXPRO1",76,0)
 ; Output
"RTN","ECXPRO1",77,0)
 ;  ^TMP("ECX-PRO EXC",$J,   - Global of records with integrity problems
"RTN","ECXPRO1",78,0)
 ;
"RTN","ECXPRO1",79,0)
 S ECXMISS=""
"RTN","ECXPRO1",80,0)
 I ECXSTAT2']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",81,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",82,0)
 I ECXDFN=0 S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",83,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",84,0)
 ;I ECXSSN']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",85,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",86,0)
 ;I ECXNA="    " S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",87,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",88,0)
 I ECXDATE']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",89,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",90,0)
 I ECXTYPE']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",91,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",92,0)
 I ECXSRCE']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",93,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",94,0)
 I ECXHCPCS']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",95,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",96,0)
 I ECXFORM["-3" D
"RTN","ECXPRO1",97,0)
 .I ECXRQST']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",98,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",99,0)
 I ECXFORM']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",100,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",101,0)
 I ECXFORM["-3" D
"RTN","ECXPRO1",102,0)
 .I ECXRCST']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",103,0)
 I ECXMISS'="^^^^^^^^^^" D
"RTN","ECXPRO1",104,0)
 .S ECXGOOD=0
"RTN","ECXPRO1",105,0)
 .D ECXMISLN^ECXPRO2(ECXMISS,.ECXLNE,ECXPIEN)
"RTN","ECXPRO1",106,0)
 Q
"RTN","ECXPRO1",107,0)
 ;
"RTN","ECXPRO1",108,0)
PROSINFO(ECXDA,ECXLB,ECX0,ECXFORM) ;*Get Prosthetics Information
"RTN","ECXPRO1",109,0)
 ;
"RTN","ECXPRO1",110,0)
 ;  Input
"RTN","ECXPRO1",111,0)
 ;    ECDA    - The IEN for the Prosthetics record
"RTN","ECXPRO1",112,0)
 ;    ECX0    - The zero node of the Prosthetics record
"RTN","ECXPRO1",113,0)
 ;    ECXLB   - The LB node of the Prosthetics record
"RTN","ECXPRO1",114,0)
 ;    ECXFORM - The Form Requested On (to determine Lab transactions)
"RTN","ECXPRO1",115,0)
 ;
"RTN","ECXPRO1",116,0)
 ;  Output (to be KILLed by calling routine)
"RTN","ECXPRO1",117,0)
 ;    ECXCTAMT   - The Cost of Transaction
"RTN","ECXPRO1",118,0)
 ;    ECXLLC     - The Lab Labor Cost
"RTN","ECXPRO1",119,0)
 ;    ECXLMC     - The Lab Material Cost
"RTN","ECXPRO1",120,0)
 ;    ECXGRPR    - The AMIS Grouper number
"RTN","ECXPRO1",121,0)
 ;    ECXBILST   - The Billing Status
"RTN","ECXPRO1",122,0)
 ;    ECXQTY     - The Quantity
"RTN","ECXPRO1",123,0)
 ;
"RTN","ECXPRO1",124,0)
 S (ECXLLC,ECXLMC,ECXCTAMT)="",ECXBILST=$P($G(^RMPR(660,ECXDA,"AM")),U,3)
"RTN","ECXPRO1",125,0)
 S ECXQTY=$P(ECX0,U,7)
"RTN","ECXPRO1",126,0)
 S:(+ECXQTY=0) ECXQTY=1
"RTN","ECXPRO1",127,0)
 S ECXGRPR=$P($G(^RMPR(660,ECXDA,"AMS")),U,1),ECXCTAMT=$P(ECX0,U,16)
"RTN","ECXPRO1",128,0)
 I ECXFORM["-3" D
"RTN","ECXPRO1",129,0)
 .S ECXCTAMT=$P(ECXLB,U,9),ECXLLC=$P(ECXLB,U,7),ECXLMC=$P(ECXLB,U,8)
"RTN","ECXPRO1",130,0)
 ;
"RTN","ECXPRO1",131,0)
 ;- If Stock Issue or Inventory Issue, Cost of Transaction=0
"RTN","ECXPRO1",132,0)
 I $P(ECXFORM,U,2)=11!($P(ECXFORM,U,2)=12) S ECXCTAMT=0
"RTN","ECXPRO1",133,0)
 S:ECXCTAMT="" ECXCTAMT=0 S:ECXCTAMT>999999 ECXCTAMT=999999
"RTN","ECXPRO1",134,0)
 S:ECXLLC="" ECXLLC=0 S:ECXLLC>999999 ECXLLC=999999
"RTN","ECXPRO1",135,0)
 S:ECXLMC="" ECXLMC=0 S:ECXLMC>999999 ECXLMC=999999
"RTN","ECXPRO1",136,0)
 ;
"RTN","ECXPRO1",137,0)
 ;- Round to next dollar amount
"RTN","ECXPRO1",138,0)
 I (ECXCTAMT#1)>.50 S ECXCTAMT=(ECXCTAMT+1)\1
"RTN","ECXPRO1",139,0)
 I (ECXLLC#1)>.50 S ECXLLC=(ECXLLC+1)\1
"RTN","ECXPRO1",140,0)
 I (ECXLMC#1)>.50 S ECXLMC=(ECXLMC+1)\1
"RTN","ECXPRO1",141,0)
 Q
"RTN","ECXSCNS")
0^4^B21811766
"RTN","ECXSCNS",1,0)
ECXSCNS ;ALB/JAP,BIR/DMA,PTD-No Show Clinic Extract ; 9/28/01 10:34am
"RTN","ECXSCNS",2,0)
 ;;3.0;DSS EXTRACTS;**11,8,13,20,24,30,33,37**;Dec 22, 1997
"RTN","ECXSCNS",3,0)
BEG ;entry point from option
"RTN","ECXSCNS",4,0)
 D SETUP I ECFILE="" Q
"RTN","ECXSCNS",5,0)
 D ^ECXTRAC,^ECXKILL
"RTN","ECXSCNS",6,0)
 Q
"RTN","ECXSCNS",7,0)
 ;
"RTN","ECXSCNS",8,0)
START ;start package specific extract
"RTN","ECXSCNS",9,0)
 N DIC,DA,DIQ,SC,ECD,ECDA,LOCARR,JI,X,Y
"RTN","ECXSCNS",10,0)
 K ^TMP($J,"ECXS"),^TMP($J,"ECXCL")
"RTN","ECXSCNS",11,0)
 S (QFLG,SC)=0,ECED=ECED+.3
"RTN","ECXSCNS",12,0)
 ;get clinics - default appt length, type, division, provider, etc.
"RTN","ECXSCNS",13,0)
 F  S SC=$O(^SC(SC)) Q:'SC  D
"RTN","ECXSCNS",14,0)
 .K LOCARR S DIC=44,DA=SC,DR="2;3.5;16;1912",DIQ(0)="I",DIQ="LOCARR" D EN^DIQ1
"RTN","ECXSCNS",15,0)
 .S ALEN=+$G(LOCARR(44,SC,1912,"I")),^TMP($J,"ECXCL",SC)=ALEN,ALEN=$$RJ^XLFSTR(ALEN,3,0)
"RTN","ECXSCNS",16,0)
 .S ^TMP($J,"ECXCL",SC)=^TMP($J,"ECXCL",SC)_"^"_ALEN_"^"_$G(LOCARR(44,SC,2,"I"))_"^"_+$G(LOCARR(44,SC,3.5,"I"))
"RTN","ECXSCNS",17,0)
 .S ECXPROV=LOCARR(44,SC,16,"I"),ECXPROVP="",ECXPROVN="" I ECXPROV D
"RTN","ECXSCNS",18,0)
 ..S ECXPROVP=$$PRVCLASS^ECXUTL(ECXPROV,ECSD1)
"RTN","ECXSCNS",19,0)
 ..S ECXPROV="2"_ECXPROV
"RTN","ECXSCNS",20,0)
 .S ^TMP($J,"ECXCL",SC)=^TMP($J,"ECXCL",SC)_"^"_ECXPROV_"^"_ECXPROVP_"^"_ECXPROVN
"RTN","ECXSCNS",21,0)
 .D FEEDER^ECXSCX1(SC,ECSD1,.ECXP1,.ECXP2,.ECXP3,.ECXSEND,.ECXDIV)
"RTN","ECXSCNS",22,0)
 .K ECXP1,ECXP2,ECXP3,ECXSEND,ECXDIV
"RTN","ECXSCNS",23,0)
 ;extract
"RTN","ECXSCNS",24,0)
 S SC=0
"RTN","ECXSCNS",25,0)
 F  S SC=$O(^SC(SC)) Q:('SC)!(QFLG)  I $D(^TMP($J,"ECXCL",SC)) S EC=^TMP($J,"ECXCL",SC) I $P(EC,U,3)="C" D  Q:QFLG
"RTN","ECXSCNS",26,0)
 .D FEEDER^ECXSCX1(SC,ECSD1,.ECXP1,.ECXP2,.ECXP3,.ECXSEND,.ECXDIV)
"RTN","ECXSCNS",27,0)
 .Q:ECXSEND=6
"RTN","ECXSCNS",28,0)
 .S ECXDSS=ECXP1_ECXP2,ECXDSSD=""
"RTN","ECXSCNS",29,0)
 .;get default provider for clinic
"RTN","ECXSCNS",30,0)
 .S (ECXPROV,ECXPROVP,ECXPROVN)=""
"RTN","ECXSCNS",31,0)
 .S ECXPROV=$P($G(^TMP($J,"ECXCL",SC)),U,5) I ECXPROV D
"RTN","ECXSCNS",32,0)
 ..S ECXPROVP=$P(^TMP($J,"ECXCL",SC),U,6),ECXPROVN=$P(^TMP($J,"ECXCL",SC),U,7)
"RTN","ECXSCNS",33,0)
 .;find appts in date range
"RTN","ECXSCNS",34,0)
 .S ECD=ECSD1
"RTN","ECXSCNS",35,0)
 .F  S ECD=$O(^SC(SC,"S",ECD)) Q:('ECD)!(ECD>ECED)  D  Q:QFLG
"RTN","ECXSCNS",36,0)
 ..;get noshows only - no data in check-in/check-out node
"RTN","ECXSCNS",37,0)
 ..S JI=0 F  S JI=$O(^SC(SC,"S",ECD,JI)) Q:'JI  S ECDA=0 F  S ECDA=$O(^SC(SC,"S",ECD,JI,ECDA)) Q:'ECDA  I $D(^(ECDA,0)) D
"RTN","ECXSCNS",38,0)
 ...S ECXDFN=$P(^SC(SC,"S",ECD,JI,ECDA,0),U) Q:ECXDFN=""
"RTN","ECXSCNS",39,0)
 ...S ECXDATE=ECD,ECXERR=0
"RTN","ECXSCNS",40,0)
 ...I $D(^DPT(ECXDFN,"S",ECD,0)) D
"RTN","ECXSCNS",41,0)
 ....Q:$P(^DPT(ECXDFN,"S",ECD,0),U)'=SC
"RTN","ECXSCNS",42,0)
 ....Q:($P(^DPT(ECXDFN,"S",ECD,0),U,2)'="N")&($P(^(0),U,2)'="NA")
"RTN","ECXSCNS",43,0)
 ....D PAT(ECXDFN,ECXDATE,.ECXERR)
"RTN","ECXSCNS",44,0)
 ....Q:ECXERR
"RTN","ECXSCNS",45,0)
 ....;log noshows only for outpatients
"RTN","ECXSCNS",46,0)
 ....I ECXA=1 D FILE
"RTN","ECXSCNS",47,0)
 K ^TMP($J,"ECXS"),^TMP($J,"ECXCL")
"RTN","ECXSCNS",48,0)
 Q
"RTN","ECXSCNS",49,0)
 ;
"RTN","ECXSCNS",50,0)
PAT(ECXDFN,ECXDATE,ECXERR) ;get patient demographic data
"RTN","ECXSCNS",51,0)
 N OK,X
"RTN","ECXSCNS",52,0)
 ;set patient data
"RTN","ECXSCNS",53,0)
 S OK=1
"RTN","ECXSCNS",54,0)
 K ECXPAT
"RTN","ECXSCNS",55,0)
 S OK=$$PAT^ECXUTL3(ECXDFN,$P(ECXDATE,"."),"1;2;3;5",.ECXPAT)
"RTN","ECXSCNS",56,0)
 I 'OK S ECXERR=1 Q
"RTN","ECXSCNS",57,0)
 S ECXSSN=ECXPAT("SSN")
"RTN","ECXSCNS",58,0)
 S ECXPNM=ECXPAT("NAME"),ECXMPI=ECXPAT("MPI")
"RTN","ECXSCNS",59,0)
 S ECXSEX=ECXPAT("SEX"),ECXDOB=ECXPAT("DOB")
"RTN","ECXSCNS",60,0)
 S ECXELIG=ECXPAT("ELIG"),ECXVET=ECXPAT("VET")
"RTN","ECXSCNS",61,0)
 S ECXRACE=ECXPAT("RACE"),ECXPST=ECXPAT("POW STAT")
"RTN","ECXSCNS",62,0)
 S ECXPLOC=ECXPAT("POW LOC"),ECXRST=ECXPAT("IR STAT")
"RTN","ECXSCNS",63,0)
 S ECXAST=ECXPAT("AO STAT"),ECXMST=ECXPAT("MST STAT")
"RTN","ECXSCNS",64,0)
 S ECXSTATE=ECXPAT("STATE"),ECXCNTY=ECXPAT("COUNTY")
"RTN","ECXSCNS",65,0)
 S ECXZIP=ECXPAT("ZIP"),ECXENRL=ECXPAT("ENROLL LOC")
"RTN","ECXSCNS",66,0)
 ;2001 changes
"RTN","ECXSCNS",67,0)
 S ECXPOS=ECXPAT("POS") I $$ENROLLM^ECXUTL2(ECXDFN)
"RTN","ECXSCNS",68,0)
 ;get sharing agreement data
"RTN","ECXSCNS",69,0)
 S (ECXPAYOR,ECXSAI)=""
"RTN","ECXSCNS",70,0)
 D VISN19^ECXUTL2(ECXDFN,.ECXPAYOR,.ECXSAI)
"RTN","ECXSCNS",71,0)
 ;get inpatient data
"RTN","ECXSCNS",72,0)
 S X=$$INP^ECXUTL2(ECXDFN,ECXDATE)
"RTN","ECXSCNS",73,0)
 S ECXA=$P(X,U),ECXMN=$P(X,U,2),ECXTS=$P(X,U,3),ECXDOM=$P(X,U,10)
"RTN","ECXSCNS",74,0)
 Q:ECXA'=1
"RTN","ECXSCNS",75,0)
 ;get primary care data
"RTN","ECXSCNS",76,0)
 S X=$$PRIMARY^ECXUTL2(ECXDFN,$P(ECXDATE,"."))
"RTN","ECXSCNS",77,0)
 S ECPTTM=$P(X,U,1)
"RTN","ECXSCNS",78,0)
 S ECPTPR=$P(X,U,2),ECCLAS=$P(X,U,3),ECPTNPI=$P(X,U,4)
"RTN","ECXSCNS",79,0)
 S ECASPR=$P(X,U,5),ECCLAS2=$P(X,U,6),ECASNPI=$P(X,U,7)
"RTN","ECXSCNS",80,0)
 Q
"RTN","ECXSCNS",81,0)
 ;
"RTN","ECXSCNS",82,0)
FILE ;file record
"RTN","ECXSCNS",83,0)
 ;node0
"RTN","ECXSCNS",84,0)
 ;fac^dfn^ssn^name^in/out (ECXA)^day^^mov #^treat spec^dob^elig^
"RTN","ECXSCNS",85,0)
 ;vet^time^primary care team^primary care provider^
"RTN","ECXSCNS",86,0)
 ;provider^race^dss identifier
"RTN","ECXSCNS",87,0)
 ;node1
"RTN","ECXSCNS",88,0)
 ;mpi^dss dept^pc provider npi^provider npi^
"RTN","ECXSCNS",89,0)
 ;pc prov person class^provider person class^
"RTN","ECXSCNS",90,0)
 ;pow status^pow loc^ir status^ao status
"RTN","ECXSCNS",91,0)
 ;sharing agree payor^sharing agree ins^mst status^
"RTN","ECXSCNS",92,0)
 ;enroll loc^state^county^zip^sex^assoc pc prov^
"RTN","ECXSCNS",93,0)
 ;assoc pc prov person class^assoc pc prov npi
"RTN","ECXSCNS",94,0)
 N DA,DIK
"RTN","ECXSCNS",95,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXSCNS",96,0)
 S ECODE=EC7_U_EC23_U
"RTN","ECXSCNS",97,0)
 S ECODE=ECODE_ECXDIV_U_ECXDFN_U_ECXSSN_U_ECXPNM_U_ECXA_U
"RTN","ECXSCNS",98,0)
 S ECODE=ECODE_$$ECXDATE^ECXUTL(ECXDATE,ECXYM)_U
"RTN","ECXSCNS",99,0)
 S ECODE=ECODE_U_ECXMN_U_ECXTS_U_ECXDOB_U_ECXELIG_U_ECXVET_U
"RTN","ECXSCNS",100,0)
 S ECODE=ECODE_$$ECXTIME^ECXUTL(ECXDATE)_U_ECPTTM_U_ECPTPR_U_ECXPROV_U
"RTN","ECXSCNS",101,0)
 S ECODE=ECODE_ECXRACE_U_ECXDSS_U
"RTN","ECXSCNS",102,0)
 S ECODE1=ECXMPI_U_ECXDSSD_U_ECPTNPI_U_ECXPROVN_U_ECCLAS_U_ECXPROVP_U
"RTN","ECXSCNS",103,0)
 S ECODE1=ECODE1_ECXPST_U_ECXPLOC_U_ECXRST_U_ECXAST_U
"RTN","ECXSCNS",104,0)
 S ECODE1=ECODE1_ECXPAYOR_U_ECXSAI_U_ECXMST_U_ECXENRL_U_ECXSTATE_U
"RTN","ECXSCNS",105,0)
 S ECODE1=ECODE1_ECXCNTY_U_ECXZIP_U_ECXSEX_U_ECASPR_U_ECCLAS2_U
"RTN","ECXSCNS",106,0)
 S ECODE1=ECODE1_ECASNPI_U_ECXDOM_U_ECXCAT_U_ECXSTAT_U_ECXPRIOR_U
"RTN","ECXSCNS",107,0)
 S ECODE1=ECODE1_ECXPOS_U_$G(ECXEOP)
"RTN","ECXSCNS",108,0)
 S ^ECX(ECFILE,EC7,0)=ECODE,^ECX(ECFILE,EC7,1)=ECODE1,ECRN=ECRN+1
"RTN","ECXSCNS",109,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX1^DIK K DIK,DA
"RTN","ECXSCNS",110,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S QFLG=1
"RTN","ECXSCNS",111,0)
 Q
"RTN","ECXSCNS",112,0)
 ;
"RTN","ECXSCNS",113,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXSCNS",114,0)
 S ECHEAD="NOS"
"RTN","ECXSCNS",115,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXSCNS",116,0)
 Q
"RTN","ECXSCNS",117,0)
 ;
"RTN","ECXSCNS",118,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXSCNS",119,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"RTN","ECXUTL3")
0^1^B49846097
"RTN","ECXUTL3",1,0)
ECXUTL3 ;ALB/GTS - Utilities for DSS Extracts ; 8/1/01 9:47am
"RTN","ECXUTL3",2,0)
 ;;3.0;DSS EXTRACTS;**11,24,32,33,35,37**;Dec 22,1997
"RTN","ECXUTL3",3,0)
 ;
"RTN","ECXUTL3",4,0)
OUTPTTM(ECXDFN,ECXDT) ;* Return PC Team from PCMM files or DPT
"RTN","ECXUTL3",5,0)
 ; Variables -
"RTN","ECXUTL3",6,0)
 ;            ECXDFN - IEN from Patient file (Required)
"RTN","ECXUTL3",7,0)
 ;            ECXDT  - Relevant Date for Primary Care Team
"RTN","ECXUTL3",8,0)
 ;                      (Defaults to DT)
"RTN","ECXUTL3",9,0)
 ;
"RTN","ECXUTL3",10,0)
 ; Returned: ECXTM -
"RTN","ECXUTL3",11,0)
 ;            Pointer to team file (#404.51)
"RTN","ECXUTL3",12,0)
 ;            or, if error or none defined, returns 0
"RTN","ECXUTL3",13,0)
 ;
"RTN","ECXUTL3",14,0)
 Q:'$G(ECXDFN) 0 ;** Quit if ECXDFN not defined
"RTN","ECXUTL3",15,0)
 N ECXTM
"RTN","ECXUTL3",16,0)
 S:'$D(ECXDT) ECXDT=DT
"RTN","ECXUTL3",17,0)
 I $T(OUTPTTM^SDUTL3)[",SCDATE" D
"RTN","ECXUTL3",18,0)
 .S ECXTM=+$$OUTPTTM^SDUTL3(ECXDFN,ECXDT)
"RTN","ECXUTL3",19,0)
 I $T(OUTPTTM^SDUTL3)'[",SCDATE" D
"RTN","ECXUTL3",20,0)
 .S ECXTM=+$$OUTPTTM^SDUTL3(ECXDFN)
"RTN","ECXUTL3",21,0)
 I ECXTM=0 D
"RTN","ECXUTL3",22,0)
 .S ECXTM=+$P($G(^DPT(+ECXDFN,"PC")),U,2)
"RTN","ECXUTL3",23,0)
 Q ECXTM
"RTN","ECXUTL3",24,0)
 ;
"RTN","ECXUTL3",25,0)
OUTPTPR(ECXDFN,ECXDT) ;* Return PC Provider from PCMM files or DPT
"RTN","ECXUTL3",26,0)
 ; Variables -
"RTN","ECXUTL3",27,0)
 ;            ECXDFN - IEN from Patient file (Required)
"RTN","ECXUTL3",28,0)
 ;            ECXDT  - Relevant Date for Primary Care Provider
"RTN","ECXUTL3",29,0)
 ;                      (Defaults to DT)
"RTN","ECXUTL3",30,0)
 ;
"RTN","ECXUTL3",31,0)
 ; Returned: ECXPR -
"RTN","ECXUTL3",32,0)
 ;            Pointer to file #200 
"RTN","ECXUTL3",33,0)
 ;            or, if error or none defined, returns a 0
"RTN","ECXUTL3",34,0)
 ;
"RTN","ECXUTL3",35,0)
 Q:'$G(ECXDFN) 0 ;** Quit if ECXDFN not defined
"RTN","ECXUTL3",36,0)
 N ECXPR
"RTN","ECXUTL3",37,0)
 S:'$D(ECXDT) ECXDT=DT
"RTN","ECXUTL3",38,0)
 I $T(OUTPTPR^SDUTL3)[",SCDATE" D
"RTN","ECXUTL3",39,0)
 .S ECXPR=+$$OUTPTPR^SDUTL3(ECXDFN,ECXDT)
"RTN","ECXUTL3",40,0)
 I $T(OUTPTPR^SDUTL3)'[",SCDATE" D
"RTN","ECXUTL3",41,0)
 .S ECXPR=+$$OUTPTPR^SDUTL3(ECXDFN)
"RTN","ECXUTL3",42,0)
 I ECXPR=0 D
"RTN","ECXUTL3",43,0)
 .S ECXPR=+$G(^DPT(+ECXDFN,"PC"))
"RTN","ECXUTL3",44,0)
 Q ECXPR
"RTN","ECXUTL3",45,0)
 ;
"RTN","ECXUTL3",46,0)
PAT(ECXDFN,ECXDATE,ECXDATA,ECXPAT) ;Return basic patient data for extract
"RTN","ECXUTL3",47,0)
 ; Will not return data associated with test patients (SSN begin w 00000)
"RTN","ECXUTL3",48,0)
 ; Variables -
"RTN","ECXUTL3",49,0)
 ;  Input  ECXDFN - Patient internal entry number, DFN file#2; required
"RTN","ECXUTL3",50,0)
 ;         ECXDATE- Date used to get specific data from GETSTAT^DGMSTAPI
"RTN","ECXUTL3",51,0)
 ;                  for MST. If no date, defaults to today's date,
"RTN","ECXUTL3",52,0)
 ;                  standard FM format, optional
"RTN","ECXUTL3",53,0)
 ;         ECXDATA- Code indicating which data to return, optional.
"RTN","ECXUTL3",54,0)
 ;                  If code not specified then returns all. Codes are:
"RTN","ECXUTL3",55,0)
 ;                  1 - DEM^VADPT (demographic data)
"RTN","ECXUTL3",56,0)
 ;                  2 - ADD^VADPT (current address)
"RTN","ECXUTL3",57,0)
 ;                  3 - ELIG^VADPT (eligibility & enrollment location)
"RTN","ECXUTL3",58,0)
 ;                  4 - OPD^VADPT (other patient data)
"RTN","ECXUTL3",59,0)
 ;                  5 - SVC^VADPT & GETSTAT^DGMSTAPI (service & MST inf)
"RTN","ECXUTL3",60,0)
 ;         ECXPAT(- Passed by referece; required
"RTN","ECXUTL3",61,0)
 ;
"RTN","ECXUTL3",62,0)
 ;  Output:
"RTN","ECXUTL3",63,0)
 ;         ECXPAT   0 error or test patient no data in ECXPAT array
"RTN","ECXUTL3",64,0)
 ;                  1 data returneed in ECXPAT array
"RTN","ECXUTL3",65,0)
 ;         ECXPAT(  Local array with patient data.
"RTN","ECXUTL3",66,0)
 ;
"RTN","ECXUTL3",67,0)
 N SSN,I,ECXCOD,ECXDAT,DFN,VAPA,VADM,VAEL,VAPD,VASV,STR,ECXAR,DIC,DIQ
"RTN","ECXUTL3",68,0)
 N DA,DR,PELG,MELIG,ZIP,MPI
"RTN","ECXUTL3",69,0)
 I ECXDFN="" Q 0
"RTN","ECXUTL3",70,0)
 S SSN=$$GET1^DIQ(2,ECXDFN,.09,"I"),DFN=ECXDFN,ECXPAT=0
"RTN","ECXUTL3",71,0)
 I $E(SSN,1,5)="00000"!(SSN="") K ECXPAT Q 0  ;test patient
"RTN","ECXUTL3",72,0)
 S STR="NAME;SSN;DOB;SEX;RACE;RELIGION;STATE;COUNTY;ZIP;SC%;MEANS;ELIG;"
"RTN","ECXUTL3",73,0)
 S STR=STR_"EMPLOY;AO STAT;IR STAT;EC STAT;POW STAT;POW LOC;MST STAT;"
"RTN","ECXUTL3",74,0)
 S STR=STR_"ENROLL LOC;MPI;VIETNAM;POS;MARITAL"
"RTN","ECXUTL3",75,0)
 ;initialize return array values
"RTN","ECXUTL3",76,0)
 F I=1:1 S ECXDAT=$P(STR,";",I) Q:ECXDAT=""  S ECXPAT(ECXDAT)=""
"RTN","ECXUTL3",77,0)
 F I=1:1:$L(ECXDATA,";") S ECXDAT=$P(ECXDATA,";",I) I ECXDAT'="" D
"RTN","ECXUTL3",78,0)
 . S ECXCOD(ECXDAT)=""
"RTN","ECXUTL3",79,0)
 ;
"RTN","ECXUTL3",80,0)
 ;- Get ICN if MPI installed
"RTN","ECXUTL3",81,0)
 S X="MPIF001" X ^%ZOSF("TEST") I $T D
"RTN","ECXUTL3",82,0)
 .;
"RTN","ECXUTL3",83,0)
 .;- Get 1st piece (either ICN # or -1 if error)
"RTN","ECXUTL3",84,0)
 . S MPI=+$$GETICN^MPIF001(DFN)
"RTN","ECXUTL3",85,0)
 .;
"RTN","ECXUTL3",86,0)
 .;- If error, set to null
"RTN","ECXUTL3",87,0)
 . S ECXPAT("MPI")=$S(MPI>0:MPI,1:"")
"RTN","ECXUTL3",88,0)
 D  ;get demographic data
"RTN","ECXUTL3",89,0)
 . I ECXDATA'="",'$D(ECXCOD(1)) Q
"RTN","ECXUTL3",90,0)
 . D DEM^VADPT
"RTN","ECXUTL3",91,0)
 . S ECXPAT("NAME")=$E($P(VADM(1),",")_"    ",1,4)
"RTN","ECXUTL3",92,0)
 . S ECXPAT("SSN")=$P(VADM(2),U),ECXPAT("MARITAL")=$P(VADM(10),U)
"RTN","ECXUTL3",93,0)
 . S ECXPAT("DOB")=$$ECXDOB^ECXUTL($P(VADM(3),U))
"RTN","ECXUTL3",94,0)
 . S ECXPAT("SEX")=$P(VADM(5),U),ECXPAT("RELIGION")=$P(VADM(9),U)
"RTN","ECXUTL3",95,0)
 . S DIC=10,DR=2,DA=+VADM(8),DIQ="ECXAR",DIQ(0)="I" D EN^DIQ1
"RTN","ECXUTL3",96,0)
 . S ECXPAT("RACE")=$G(ECXAR(10,DA,DR,"I")),ECXPAT=1
"RTN","ECXUTL3",97,0)
 D  ;get address information
"RTN","ECXUTL3",98,0)
 . I ECXDATA'="",'$D(ECXCOD(2)) Q
"RTN","ECXUTL3",99,0)
 . D ADD^VADPT
"RTN","ECXUTL3",100,0)
 . S DIC=5,DR=2,DA=+VAPA(5),DIQ="ECXAR",DIQ(0)="I" D EN^DIQ1
"RTN","ECXUTL3",101,0)
 . S ECXPAT("STATE")=$G(ECXAR(5,DA,DR,"I"))
"RTN","ECXUTL3",102,0)
 . S DIC=5,DA=+VAPA(5),DR=3,DR(5.01)=2,DA(5.01)=+VAPA(7),DIQ="ECXAR"
"RTN","ECXUTL3",103,0)
 . S DIQ(0)="I" D EN^DIQ1
"RTN","ECXUTL3",104,0)
 . S ECXPAT("COUNTY")=$G(ECXAR(5.01,DA(5.01),2,"I"))
"RTN","ECXUTL3",105,0)
 . S ECXPAT("ZIP")=$P(VAPA(11),U,2),ECXPAT=1
"RTN","ECXUTL3",106,0)
 D  ;get eligibility information
"RTN","ECXUTL3",107,0)
 . I ECXDATA'="",'$D(ECXCOD(3)) Q
"RTN","ECXUTL3",108,0)
 . D ELIG^VADPT
"RTN","ECXUTL3",109,0)
 . S PELG=$P(VAEL(1),U),MELIG=$S(PELG="":"",1:$$GET1^DIQ(8,PELG,8,"I"))
"RTN","ECXUTL3",110,0)
 . S ECXPAT("POS")=$P($G(^DIC(21,+VAEL(2),0)),U,3)
"RTN","ECXUTL3",111,0)
 . S ECXPAT("SC STAT")=$S(+VAEL(3):"Y",+VAEL(3)=0:"N",1:"")
"RTN","ECXUTL3",112,0)
 . S ECXPAT("SC%")=$P(VAEL(3),U,2)
"RTN","ECXUTL3",113,0)
 . S ECXPAT("VET")=$S(VAEL(4):"Y",VAEL(4)=0:"N",1:"")
"RTN","ECXUTL3",114,0)
 . S ECXPAT("MEANS")=$P(VAEL(9),U),ECXPAT=1
"RTN","ECXUTL3",115,0)
 . S ECXPAT("ELIG")=$$ELIG(MELIG,ECXPAT("SC%"))
"RTN","ECXUTL3",116,0)
 . ;get enrollment location
"RTN","ECXUTL3",117,0)
 . S DIC=2,DR=27.02,DA=ECXDFN,DIQ="ECXAR",DIQ(0)="I" D EN^DIQ1
"RTN","ECXUTL3",118,0)
 . S ECXDAT=$G(ECXAR(2,ECXDFN,DR,"I")) I ECXDAT K ECXAR D
"RTN","ECXUTL3",119,0)
 . . S DIC=4,DA=ECXDAT,DR=99,DIQ="ECXAR",DIQ(0)="I" D EN^DIQ1
"RTN","ECXUTL3",120,0)
 . . S ECXPAT("ENROLL LOC")=ECXAR(4,ECXDAT,DR,"I")
"RTN","ECXUTL3",121,0)
 D  ;get other patient information
"RTN","ECXUTL3",122,0)
 . I ECXDATA'="",'$D(ECXCOD(4)) Q
"RTN","ECXUTL3",123,0)
 . D OPD^VADPT
"RTN","ECXUTL3",124,0)
 . S ECXPAT("EMPLOY")=$P(VAPD(7),U),ECXPAT=1
"RTN","ECXUTL3",125,0)
 D  ;get service information
"RTN","ECXUTL3",126,0)
 . I ECXDATA'="",'$D(ECXCOD(5)) Q
"RTN","ECXUTL3",127,0)
 . D SVC^VADPT
"RTN","ECXUTL3",128,0)
 . S ECXPAT("VIETNAM")=$S(VASV(1):"Y",VASV(2)=0:"N",1:"U")
"RTN","ECXUTL3",129,0)
 . S ECXPAT("AO STAT")=$S(VASV(2):"Y",VASV(2)=0:"N",1:"U")
"RTN","ECXUTL3",130,0)
 . S ECXPAT("IR STAT")=$S(VASV(3):"Y",VASV(3)=0:"N",1:"U")
"RTN","ECXUTL3",131,0)
 . S ECXPAT("EC STAT")=$$GET1^DIQ(2,ECXDFN,.322013,"I")
"RTN","ECXUTL3",132,0)
 . S ECXPAT("POW STAT")=$S(VASV(4):"Y",VASV(4)=0:"N",1:"U")
"RTN","ECXUTL3",133,0)
 . S ECXPAT("POW LOC")=$P(VASV(4,3),U),ECXPAT=1
"RTN","ECXUTL3",134,0)
 . S ECXPAT("PHI")=$S(VASV(9)=1:"Y",VASV(9)=0:"N",1:"")
"RTN","ECXUTL3",135,0)
 . ;get patient current MST status
"RTN","ECXUTL3",136,0)
 . I ECXDATE'="",ECXDATE'["." S ECXDATE=ECXDATE+.9
"RTN","ECXUTL3",137,0)
 . S X="DGMSTAPI" X ^%ZOSF("TEST") I $T D
"RTN","ECXUTL3",138,0)
 . . S ECXDAT=$$GETSTAT^DGMSTAPI(DFN,ECXDATE)
"RTN","ECXUTL3",139,0)
 . . S ECXPAT("MST STAT")=$S(+ECXDAT>0:$P(ECXDAT,U,2),1:"")
"RTN","ECXUTL3",140,0)
 I 'ECXPAT K ECXPAT Q 0
"RTN","ECXUTL3",141,0)
 Q 1
"RTN","ECXUTL3",142,0)
 ;
"RTN","ECXUTL3",143,0)
ELIG(ECXELIG,ECXSVCP) ;Converts veteran eligibility code to NPCD code
"RTN","ECXUTL3",144,0)
 ; Variables -
"RTN","ECXUTL3",145,0)
 ;  Input  ECXELIG - Pointer to MAS ELIGIBILITY CODE file #8.1
"RTN","ECXUTL3",146,0)
 ;         ECXSVCP - Number value rep. service connected percentage.
"RTN","ECXUTL3",147,0)
 ;
"RTN","ECXUTL3",148,0)
 ;  Output:
"RTN","ECXUTL3",149,0)
 ;         ECXNCPD  NPCD Eligibility Code
"RTN","ECXUTL3",150,0)
 ;
"RTN","ECXUTL3",151,0)
 N TEXT,IEN,SCPER,FND,NPCD,I,ECXBG,ECXEN,ECXNPCD
"RTN","ECXUTL3",152,0)
 I ECXELIG="" Q ""
"RTN","ECXUTL3",153,0)
 F I=1:1 S TEXT=$P($T(ELGTXT+I),";",3,999) Q:TEXT="END"  D  I $D(NPCD) Q
"RTN","ECXUTL3",154,0)
 . S IEN=$P(TEXT,";"),SCPER=$P(TEXT,";",2)
"RTN","ECXUTL3",155,0)
 . I ECXELIG=IEN D
"RTN","ECXUTL3",156,0)
 . . I SCPER="" S NPCD=$P(TEXT,";",3) Q
"RTN","ECXUTL3",157,0)
 . . S ECXBG=$S($E(SCPER)="<":0,$E(SCPER)=">":$P(SCPER,">",2)+1,SCPER["-":+SCPER,1:"")
"RTN","ECXUTL3",158,0)
 . . S ECXEN=$S($E(SCPER)="<":$P(SCPER,"<",2),$E(SCPER)=">":100,SCPER["-":$P(SCPER,"-",2),1:"")
"RTN","ECXUTL3",159,0)
 . . I ECXSVCP'<ECXBG,ECXSVCP'>ECXEN S NPCD=$P(TEXT,";",3)
"RTN","ECXUTL3",160,0)
 S ECXNPCD=$G(NPCD)
"RTN","ECXUTL3",161,0)
 Q ECXNPCD
"RTN","ECXUTL3",162,0)
ELGTXT ;Eligibility codes
"RTN","ECXUTL3",163,0)
 ;;1;>49;10;SC 50-100%
"RTN","ECXUTL3",164,0)
 ;;2;;20;Aid & Attendance
"RTN","ECXUTL3",165,0)
 ;;15;;21;Housebound
"RTN","ECXUTL3",166,0)
 ;;16;;22;Mexican Border War
"RTN","ECXUTL3",167,0)
 ;;17;;23;WWI
"RTN","ECXUTL3",168,0)
 ;;18;;24;POW
"RTN","ECXUTL3",169,0)
 ;;3;40-49;30;SC 40-49%
"RTN","ECXUTL3",170,0)
 ;;3;30-39;31;SC 30-39%
"RTN","ECXUTL3",171,0)
 ;;3;20-29;32;SC 20-29%
"RTN","ECXUTL3",172,0)
 ;;3;10-19;33;SC 10-19%
"RTN","ECXUTL3",173,0)
 ;;3;<10;34;SC less than 10%
"RTN","ECXUTL3",174,0)
 ;;4;;40;NSC - VA Pension
"RTN","ECXUTL3",175,0)
 ;;5;;50;NSC
"RTN","ECXUTL3",176,0)
 ;;21;;60;Catastrophic Disability
"RTN","ECXUTL3",177,0)
 ;;12;;101;CHAMPVA
"RTN","ECXUTL3",178,0)
 ;;13;;102;Collateral of Veteran
"RTN","ECXUTL3",179,0)
 ;;14;;103;Employee
"RTN","ECXUTL3",180,0)
 ;;6;;104;Other Federal Agency
"RTN","ECXUTL3",181,0)
 ;;7;;105;Allied Veteran
"RTN","ECXUTL3",182,0)
 ;;8;;106;Humanitarian Emergency
"RTN","ECXUTL3",183,0)
 ;;9;;107;Sharing Agreement
"RTN","ECXUTL3",184,0)
 ;;10;;108;;Reimbursable Insurance
"RTN","ECXUTL3",185,0)
 ;;19;;109;;TRICARE/CHAMPUS
"RTN","ECXUTL3",186,0)
 ;;END
"RTN","ECXUTL3",187,0)
 ;
"RTN","ECXUTL3",188,0)
CPT(ECXCPT,ECXMOD,ECXQUA) ;Returns a str with CPT code and modifier codes
"RTN","ECXUTL3",189,0)
 ;Return string is composed of a 5 character CPT code 2 character quanity
"RTN","ECXUTL3",190,0)
 ;plus up to 5 modifier codes, 2 characters each.
"RTN","ECXUTL3",191,0)
 ; Variables -
"RTN","ECXUTL3",192,0)
 ;  Input  ECXCPT  - Pointer value to the CPT file (#81)
"RTN","ECXUTL3",193,0)
 ;         ECXMOD - A string with pointer values to the CPT
"RTN","ECXUTL3",194,0)
 ;                   MODIFIER file (#81.3) separated by ";"
"RTN","ECXUTL3",195,0)
 ;         ECXQUA  - Number of time this procedure performed
"RTN","ECXUTL3",196,0)
 ;
"RTN","ECXUTL3",197,0)
 ;  Output:
"RTN","ECXUTL3",198,0)
 ;         CPTMOD  - String of up to 17 characters, 5 character CPT
"RTN","ECXUTL3",199,0)
 ;                   code 2 character quanity plus up to 5 2-character
"RTN","ECXUTL3",200,0)
 ;                   code modifiers.
"RTN","ECXUTL3",201,0)
 ;
"RTN","ECXUTL3",202,0)
 N CPT,MOD,I,CPTMOD
"RTN","ECXUTL3",203,0)
 S ECXQUA=$G(ECXQUA,"01"),ECXMOD=$G(ECXMOD)
"RTN","ECXUTL3",204,0)
 S:$L(ECXQUA)'=2 ECXQUA="0"_ECXQUA
"RTN","ECXUTL3",205,0)
 S CPT=$$CPT^ICPTCOD(ECXCPT,"") I +CPT=-1 Q ""
"RTN","ECXUTL3",206,0)
 S CPT=$P(CPT,U,2)_ECXQUA
"RTN","ECXUTL3",207,0)
 F I=1:1:99 I $P(ECXMOD,";",I)'="" D
"RTN","ECXUTL3",208,0)
 . S MOD=$$MOD^ICPTMOD($P(ECXMOD,";",I),"I","")
"RTN","ECXUTL3",209,0)
 . I +MOD>0,$P(MOD,U,2)'="99" S CPT=CPT_$P(MOD,U,2)
"RTN","ECXUTL3",210,0)
 S CPTMOD=$TR($E(CPT,1,17)," ")
"RTN","ECXUTL3",211,0)
 Q CPTMOD
"RTN","ECXUTL3",212,0)
 ;
"RTN","ECXUTL3",213,0)
CPTOUT(ECXCPT) ;output transform for CPT code plus modifiers
"RTN","ECXUTL3",214,0)
 ;input  ECXCPT  - character string of CPT code plus modifiers (required)
"RTN","ECXUTL3",215,0)
 ;
"RTN","ECXUTL3",216,0)
 N J,CPTX,MOD,MODS,MODX,CPTMOD
"RTN","ECXUTL3",217,0)
 Q:$G(ECXCPT)="" ""
"RTN","ECXUTL3",218,0)
 S (CPTMOD,MODX)=""
"RTN","ECXUTL3",219,0)
 S CPTX="("_+$E(ECXCPT,6,7)_") "_$E(ECXCPT,1,5),MODS=$E(ECXCPT,8,17)
"RTN","ECXUTL3",220,0)
 F J=1:2:9 S MOD=$E(MODS,J,J+1) Q:MOD=""  D
"RTN","ECXUTL3",221,0)
 .I J>1 S MODX=MODX_", "_MOD Q
"RTN","ECXUTL3",222,0)
 .S MODX=MODX_"-"_MOD
"RTN","ECXUTL3",223,0)
 S:$L(CPTX)>3 CPTMOD=CPTMOD_CPTX_MODX
"RTN","ECXUTL3",224,0)
 Q CPTMOD
"VER")
8.0^22.0
**END**
**END**
