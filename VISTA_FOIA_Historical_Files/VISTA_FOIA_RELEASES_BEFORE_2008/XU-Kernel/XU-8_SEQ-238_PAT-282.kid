Released XU*8*282 SEQ #238
Extracted from mail message
**KIDS**:XU*8.0*282^

**INSTALL NAME**
XU*8.0*282
"BLD",658,0)
XU*8.0*282^KERNEL^0^3030320^y
"BLD",658,1,0)
^9.61A^2^2^3030320^^^
"BLD",658,1,1,0)
Patch XU*8*282 PERSON CLASS EXPIRED. Please refer to the Description in Forum
"BLD",658,1,2,0)
Patch Module for details.
"BLD",658,4,0)
^9.64PA^^
"BLD",658,"ABPKG")
n
"BLD",658,"KRN",0)
^9.67PA^8989.52^19
"BLD",658,"KRN",.4,0)
.4
"BLD",658,"KRN",.401,0)
.401
"BLD",658,"KRN",.402,0)
.402
"BLD",658,"KRN",.403,0)
.403
"BLD",658,"KRN",.5,0)
.5
"BLD",658,"KRN",.84,0)
.84
"BLD",658,"KRN",3.6,0)
3.6
"BLD",658,"KRN",3.8,0)
3.8
"BLD",658,"KRN",9.2,0)
9.2
"BLD",658,"KRN",9.8,0)
9.8
"BLD",658,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",658,"KRN",9.8,"NM",1,0)
XUINPCH2^^0^B12390663
"BLD",658,"KRN",9.8,"NM",2,0)
XUS3A^^0^B4884572
"BLD",658,"KRN",9.8,"NM","B","XUINPCH2",1)

"BLD",658,"KRN",9.8,"NM","B","XUS3A",2)

"BLD",658,"KRN",19,0)
19
"BLD",658,"KRN",19.1,0)
19.1
"BLD",658,"KRN",101,0)
101
"BLD",658,"KRN",409.61,0)
409.61
"BLD",658,"KRN",771,0)
771
"BLD",658,"KRN",870,0)
870
"BLD",658,"KRN",8989.51,0)
8989.51
"BLD",658,"KRN",8989.52,0)
8989.52
"BLD",658,"KRN",8994,0)
8994
"BLD",658,"KRN","B",.4,.4)

"BLD",658,"KRN","B",.401,.401)

"BLD",658,"KRN","B",.402,.402)

"BLD",658,"KRN","B",.403,.403)

"BLD",658,"KRN","B",.5,.5)

"BLD",658,"KRN","B",.84,.84)

"BLD",658,"KRN","B",3.6,3.6)

"BLD",658,"KRN","B",3.8,3.8)

"BLD",658,"KRN","B",9.2,9.2)

"BLD",658,"KRN","B",9.8,9.8)

"BLD",658,"KRN","B",19,19)

"BLD",658,"KRN","B",19.1,19.1)

"BLD",658,"KRN","B",101,101)

"BLD",658,"KRN","B",409.61,409.61)

"BLD",658,"KRN","B",771,771)

"BLD",658,"KRN","B",870,870)

"BLD",658,"KRN","B",8989.51,8989.51)

"BLD",658,"KRN","B",8989.52,8989.52)

"BLD",658,"KRN","B",8994,8994)

"BLD",658,"QUES",0)
^9.62^^
"BLD",658,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
282^3030320^82
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3030320
"PKG",3,22,1,"PAH",1,1,1,0)
Patch XU*8*282 PERSON CLASS EXPIRED. Please refer to the Description in Forum
"PKG",3,22,1,"PAH",1,1,2,0)
Patch Module for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XUINPCH2")
0^1^B12390663
"RTN","XUINPCH2",1,0)
XUINPCH2 ;ISF/RWF - Post INIT for Person class file v2.; 3/10/03 1:40pm
"RTN","XUINPCH2",2,0)
 ;;8.0;KERNEL;**106,159,282**;Jul 10, 1995
"RTN","XUINPCH2",3,0)
 Q
"RTN","XUINPCH2",4,0)
PREXXX ;This is the pre-init
"RTN","XUINPCH2",5,0)
 ;Remove data from USC(8932.1)
"RTN","XUINPCH2",6,0)
 S ^USC="" K ^USC(8932.1)
"RTN","XUINPCH2",7,0)
 Q
"RTN","XUINPCH2",8,0)
 ;
"RTN","XUINPCH2",9,0)
POST G AUTO
"RTN","XUINPCH2",10,0)
AUTO ;Loop through and repoint the ones we can.
"RTN","XUINPCH2",11,0)
 N VA200,PC,R1,R2
"RTN","XUINPCH2",12,0)
 D BMES^XPDUTL("Now repointing entries with direct mappings.")
"RTN","XUINPCH2",13,0)
 D PINIT ;Build list
"RTN","XUINPCH2",14,0)
 F VA200=.9:0 S VA200=$O(^VA(200,VA200)) Q:VA200'>0  D
"RTN","XUINPCH2",15,0)
 . S PC=$O(^VA(200,VA200,"USC1","A"),-1) Q:PC'>0
"RTN","XUINPCH2",16,0)
 . S R1=^VA(200,VA200,"USC1",PC,0) Q:$P(R1,U,3)>0
"RTN","XUINPCH2",17,0)
 . S R1=+R1,R2=$G(^TMP($J,R1)) Q:R2=""
"RTN","XUINPCH2",18,0)
 . D REPOINT(VA200,PC,R1,R2)
"RTN","XUINPCH2",19,0)
 . Q
"RTN","XUINPCH2",20,0)
 Q
"RTN","XUINPCH2",21,0)
 ;
"RTN","XUINPCH2",22,0)
MANUAL ;Find person class entries need to ask about
"RTN","XUINPCH2",23,0)
 N DA,PC,R1,R2,VA200,DUOUT,LAST,XXX
"RTN","XUINPCH2",24,0)
 W !,"Now to re-map person class entries."
"RTN","XUINPCH2",25,0)
 D AINIT
"RTN","XUINPCH2",26,0)
 S DIR(0)="S^C:Continue;R:Recheck all",DIR("A")="Where do you want to start",DIR("B")="C"
"RTN","XUINPCH2",27,0)
 D ^DIR Q:$D(DIRUT)
"RTN","XUINPCH2",28,0)
 S LAST=.9 S:Y["C" LAST=$G(^XTMP("A4A7","LAST"),.9)
"RTN","XUINPCH2",29,0)
 F VA200=LAST:0 S VA200=$O(^VA(200,VA200)) Q:VA200'>0  I $$LOCK(VA200,1) D  D LOCK(VA200,0)
"RTN","XUINPCH2",30,0)
 . S PC=$O(^VA(200,VA200,"USC1","A"),-1) Q:PC'>0
"RTN","XUINPCH2",31,0)
 . S R1=^VA(200,VA200,"USC1",PC,0) Q:$P(R1,U,3)>0
"RTN","XUINPCH2",32,0)
 . I $P($$ACTIVE^XUSER(VA200),"^",2)="TERMINATED"  D  Q
"RTN","XUINPCH2",33,0)
 . . K XXX
"RTN","XUINPCH2",34,0)
 . . S XXX(200.05,PC_","_VA200_",",3)=DT
"RTN","XUINPCH2",35,0)
 . . D UPDATE^DIE("","XXX")
"RTN","XUINPCH2",36,0)
 . . W !,"Terminated User ("_$P(^VA(200,VA200,0),"^")_") has been automatically processed."
"RTN","XUINPCH2",37,0)
 . . Q
"RTN","XUINPCH2",38,0)
 . S R1=+R1,R2=$G(^TMP($J,R1)) Q:R2=""
"RTN","XUINPCH2",39,0)
 . S R2=$$ASK(R1,R2) I R2>0 D REPOINT(VA200,PC,R1,R2),MARK(VA200)
"RTN","XUINPCH2",40,0)
 . S:$D(DUOUT) VA200=9E10
"RTN","XUINPCH2",41,0)
 . Q
"RTN","XUINPCH2",42,0)
 W !,$S($D(DUOUT):"Come back soon to finish up.",1:"That's the end."),!
"RTN","XUINPCH2",43,0)
 Q
"RTN","XUINPCH2",44,0)
ASK(OLD,OFFER) ;Ask what to point to.
"RTN","XUINPCH2",45,0)
 N DIR,DIC,NEW K DUOUT
"RTN","XUINPCH2",46,0)
AK W !!,"User "_$P(^VA(200,VA200,0),U)," has the following person class:",!
"RTN","XUINPCH2",47,0)
 D SHOW(OLD)
"RTN","XUINPCH2",48,0)
 W !,"This has been discontinued.  Please select a new entry.",!
"RTN","XUINPCH2",49,0)
 W $P(OFFER,"A, ",2,9)
"RTN","XUINPCH2",50,0)
 S DIC="^USC(8932.1,",DIC(0)="AEMQ" D ^DIC S NEW=+Y
"RTN","XUINPCH2",51,0)
 I NEW>0 W !! D SHOW(NEW) S DIR(0)="Y",DIR("A")="Is this the one you want" D ^DIR
"RTN","XUINPCH2",52,0)
 Q:Y=1 NEW Q:$D(DUOUT)!(NEW=-1) 0
"RTN","XUINPCH2",53,0)
 G AK
"RTN","XUINPCH2",54,0)
 ;
"RTN","XUINPCH2",55,0)
LOCK(DA,%) ;Lock/Unlock user
"RTN","XUINPCH2",56,0)
 I '% L -^VA(200,DA,"USC1") Q
"RTN","XUINPCH2",57,0)
 I % L +^VA(200,DA,"USC1"):0 I '$T Q 0
"RTN","XUINPCH2",58,0)
 Q 1
"RTN","XUINPCH2",59,0)
RPOLD(DA1,DA,OLD,NEW) ;Don't use FM here.  Too many protections.
"RTN","XUINPCH2",60,0)
 N VA200,PC,R1,R2
"RTN","XUINPCH2",61,0)
 I $P(^VA(200,DA1,"USC1",DA,0),U)'=OLD Q
"RTN","XUINPCH2",62,0)
 K ^VA(200,DA1,"USC1","B",OLD,DA) S ^VA(200,DA1,"USC1","B",NEW,DA)=""
"RTN","XUINPCH2",63,0)
 S $P(^VA(200,DA1,"USC1",DA,0),U,1)=NEW
"RTN","XUINPCH2",64,0)
 Q
"RTN","XUINPCH2",65,0)
REPOINT(DA1,DA,OLD,NEW) ;Use FM so to fire X-ref's
"RTN","XUINPCH2",66,0)
 N VA200,PC,RX1,RX2,DUZ
"RTN","XUINPCH2",67,0)
 I $P(^VA(200,DA1,"USC1",DA,0),U)'=OLD Q
"RTN","XUINPCH2",68,0)
 S RX1(200.05,"+1,"_DA1_",",.01)=NEW L ^VA(200,DA1,"USC1"):30
"RTN","XUINPCH2",69,0)
 D UPDATE^DIE("S","RX1","RX2")
"RTN","XUINPCH2",70,0)
 Q
"RTN","XUINPCH2",71,0)
 ;
"RTN","XUINPCH2",72,0)
SHOW(DA) ;
"RTN","XUINPCH2",73,0)
 N X S X=$G(^USC(8932.1,DA,0))
"RTN","XUINPCH2",74,0)
 W $P(X,U,1) W:$P(X,U,2)]"" !,?3,$P(X,U,2) W:$P(X,U,3)]"" !,?6,$P(X,U,3)
"RTN","XUINPCH2",75,0)
 Q
"RTN","XUINPCH2",76,0)
PINIT ;Build swap array
"RTN","XUINPCH2",77,0)
 K ^TMP($J)
"RTN","XUINPCH2",78,0)
 F I=1:1:674 S X=$P(^USC(8932.1,I,0),U,8) I X["P" D
"RTN","XUINPCH2",79,0)
 . S J=$P(X,"P",2),^TMP($J,I)=J
"RTN","XUINPCH2",80,0)
 . Q
"RTN","XUINPCH2",81,0)
 Q
"RTN","XUINPCH2",82,0)
AINIT ;Build swap array for the Ask user
"RTN","XUINPCH2",83,0)
 K ^TMP($J)
"RTN","XUINPCH2",84,0)
 F I=1:1:674 S X=$P(^USC(8932.1,I,0),U,8) I X["A" D
"RTN","XUINPCH2",85,0)
 . S ^TMP($J,I)=X
"RTN","XUINPCH2",86,0)
 . Q
"RTN","XUINPCH2",87,0)
 Q
"RTN","XUINPCH2",88,0)
BUILD ;
"RTN","XUINPCH2",89,0)
 D AINIT S IEN=17,DA=0,DATE=2960101
"RTN","XUINPCH2",90,0)
 F  S DA=$O(^TMP($J,DA)) Q:DA'>0  D
"RTN","XUINPCH2",91,0)
 . S DATE=$$FMADD^XLFDT(DATE,2),ID=$O(^VA(200,IEN,"USC1",999),-1)
"RTN","XUINPCH2",92,0)
 . S $P(^VA(200,IEN,"USC1",ID,0),U,3)=DATE,^VA(200,IEN,"USC1",(ID+1),0)=DA_U_DATE
"RTN","XUINPCH2",93,0)
 . Q
"RTN","XUINPCH2",94,0)
 Q
"RTN","XUINPCH2",95,0)
MARK(Y) ;Set checkmark
"RTN","XUINPCH2",96,0)
 S ^XTMP("A4A7",0)=DT,^("LAST")=Y
"RTN","XUINPCH2",97,0)
 Q
"RTN","XUINPCH2",98,0)
 ;
"RTN","XUINPCH2",99,0)
CLEANUP ;Cleanup after done.
"RTN","XUINPCH2",100,0)
 ;D DEL^XPDMENU("XXX") ;no line found
"RTN","XUINPCH2",101,0)
 K ^XTMP("A4A7")
"RTN","XUINPCH2",102,0)
 ;S X="XUINPCH2" X "X ^%ZOSV(""DEL"") HALT"
"RTN","XUINPCH2",103,0)
 ;
"RTN","XUS3A")
0^2^B4884572
"RTN","XUS3A",1,0)
XUS3A ;SF-ISC/STAFF - CHANGE UCI'S ; 2/4/03 9:51am
"RTN","XUS3A",2,0)
 ;;8.0;KERNEL;**13,282**;Jul 10, 1995
"RTN","XUS3A",3,0)
 Q
"RTN","XUS3A",4,0)
 ;PICK A UCI TO SWITCH TO
"RTN","XUS3A",5,0)
SWITCH ;Allow users that have the UCI field in there NP file to switch UCI's.
"RTN","XUS3A",6,0)
 W !!,"Switch UCI's option.",!
"RTN","XUS3A",7,0)
 I $$PROGMODE^%ZOSV() W !,$C(7),"No switching UCI's in Programmer Mode." Q
"RTN","XUS3A",8,0)
 I $O(^VA(200,DUZ,.2,0))'>0 D  Q
"RTN","XUS3A",9,0)
 . W !,"Sorry but you do not have any UCI's that you are allowed to"
"RTN","XUS3A",10,0)
 . W !,"switch to."
"RTN","XUS3A",11,0)
 . Q
"RTN","XUS3A",12,0)
 N DIR,X,Y,PGM,%UCI,DEF
"RTN","XUS3A",13,0)
 S DEF="ZU" ;DEF is default routine to switch to.
"RTN","XUS3A",14,0)
UCI S DIR(0)="F",DIR("A")="Select UCI:ROUTINE",DIR("??")="^D SHOW^XUS3A"
"RTN","XUS3A",15,0)
 S DIR("?")="Enter a UCI name (:Routine) to switch to."
"RTN","XUS3A",16,0)
 D ^DIR K DIR I $D(DUOUT)!$D(DTOUT)!(X="^") Q
"RTN","XUS3A",17,0)
 I Y?.N,$D(^VA(200,DUZ,.2,Y,0)) S UC=^(0),Y=$P(UC,U)_":"_$P($P(UC,U,2),":")
"RTN","XUS3A",18,0)
 S X=$P(Y,":"),PGM=$P(Y,":",2,3) S:PGM[":" X=$P(Y,":",1,2),PGM=$P(Y,":",3) ;for M/vx
"RTN","XUS3A",19,0)
 S:PGM="" PGM=DEF
"RTN","XUS3A",20,0)
SAME I X="" Q  ;Didn't select anything.
"RTN","XUS3A",21,0)
 D PM S %UCI=X X ^%ZOSF("UCICHECK") I 0[Y G BAD
"RTN","XUS3A",22,0)
 F DA=0:0 S DA=$O(^VA(200,DUZ,.2,DA)) Q:DA'>0  S Y=^(DA,0) D  G:GO NXT
"RTN","XUS3A",23,0)
 . S GO=0,X=$P(Y,U),XUA=$P(Y,U,2) D PM Q:%UCI'=X 
"RTN","XUS3A",24,0)
 . I XUA="" S XUA=DEF
"RTN","XUS3A",25,0)
 . F %=1:1:20 I $P(XUA,":",%)=PGM S GO=1 Q
"RTN","XUS3A",26,0)
 . Q
"RTN","XUS3A",27,0)
BAD W !,"UCI not found!" D SHOW G UCI
"RTN","XUS3A",28,0)
 ;
"RTN","XUS3A",29,0)
NXT ;Here we go.
"RTN","XUS3A",30,0)
 D C^XUSCLEAN K ^XUTL("XQ",$J),^XUTL($J),^TMP($J),^UTILITY($J)
"RTN","XUS3A",31,0)
 ;K DA S XQZ="^"_PGM_"["_%UCI_"]" D DO^%XUCI G ^XUSCLEAN
"RTN","XUS3A",32,0)
 K DA G GO^%XUCI
"RTN","XUS3A",33,0)
 ;
"RTN","XUS3A",34,0)
 ;
"RTN","XUS3A",35,0)
SHOW W ! S I=0,UC="",X=$S($D(^VA(200,DUZ,201)):+^(201),1:0)
"RTN","XUS3A",36,0)
 W !,"Enter ^ to return to your current menu, or select from:"
"RTN","XUS3A",37,0)
 F I=0:0 S I=$O(^VA(200,DUZ,.2,I)) Q:I'>0  D
"RTN","XUS3A",38,0)
 . W !,?5 S UC=$G(^VA(200,DUZ,.2,I,0)),X=$P(UC,U,1),UC=$P(UC,U,2,99)
"RTN","XUS3A",39,0)
 . I UC'[":" W I
"RTN","XUS3A",40,0)
 . D PM W ?10,X X ^%ZOSF("UCICHECK") I 0[Y W " -- Not currently a valid  UCI!",$C(7) Q
"RTN","XUS3A",41,0)
 . W:UC]"" ":"_UC
"RTN","XUS3A",42,0)
 . Q
"RTN","XUS3A",43,0)
 Q
"RTN","XUS3A",44,0)
 ;
"RTN","XUS3A",45,0)
PM I X="PROD"!(X="MGR") S X=^%ZOSF(X)
"RTN","XUS3A",46,0)
 Q
"VER")
8.0^22.0
**END**
**END**
