Released GMRC*3*12 SEQ #13
Extracted from mail message
**KIDS**:GMRC*3.0*12^

**INSTALL NAME**
GMRC*3.0*12
"BLD",1884,0)
GMRC*3.0*12^CONSULT/REQUEST TRACKING^0^3000503^y
"BLD",1884,1,0)
^^2^2^3000202^
"BLD",1884,1,1,0)
See National Patch Module for complete details of enhancements included in
"BLD",1884,1,2,0)
this patch.
"BLD",1884,4,0)
^9.64PA^123.1^3
"BLD",1884,4,123,0)
123
"BLD",1884,4,123,2,0)
^9.641^123^1
"BLD",1884,4,123,2,123,0)
REQUEST/CONSULTATION  (File-top level)
"BLD",1884,4,123,2,123,1,0)
^9.6411^30.1^1
"BLD",1884,4,123,2,123,1,30.1,0)
PROVISIONAL DIAGNOSIS CODE
"BLD",1884,4,123,222)
y^n^p^^^^n
"BLD",1884,4,123.1,0)
123.1
"BLD",1884,4,123.1,222)
n^y^f^^y^^y^o^n
"BLD",1884,4,123.1,224)
I Y=8!(Y=21)
"BLD",1884,4,123.5,0)
123.5
"BLD",1884,4,123.5,2,0)
^9.641^123.51^2
"BLD",1884,4,123.5,2,123.5,0)
REQUEST SERVICES  (File-top level)
"BLD",1884,4,123.5,2,123.5,1,0)
^9.6411^125^7
"BLD",1884,4,123.5,2,123.5,1,1.01,0)
PROVISIONAL DX PROMPT
"BLD",1884,4,123.5,2,123.5,1,1.02,0)
PROVISIONAL DX INPUT
"BLD",1884,4,123.5,2,123.5,1,1.03,0)
RESTRICT DEFAULT REASON EDIT
"BLD",1884,4,123.5,2,123.5,1,1.04,0)
NOTIFY SERVICE ON DC
"BLD",1884,4,123.5,2,123.5,1,1.05,0)
REPRINT 513 ON DC
"BLD",1884,4,123.5,2,123.5,1,124,0)
DEFAULT REASON FOR REQUEST
"BLD",1884,4,123.5,2,123.5,1,125,0)
PREREQUISITE
"BLD",1884,4,123.5,2,123.51,0)
SUB-SERVICE  (sub-file)
"BLD",1884,4,123.5,2,123.51,1,0)
^9.6411^.01^1
"BLD",1884,4,123.5,2,123.51,1,.01,0)
SUB-SERVICE/SPECIALTY
"BLD",1884,4,123.5,222)
y^n^p^^^^n
"BLD",1884,4,"APDD",123,123)

"BLD",1884,4,"APDD",123,123,30.1)

"BLD",1884,4,"APDD",123.5,123.5)

"BLD",1884,4,"APDD",123.5,123.5,1.01)

"BLD",1884,4,"APDD",123.5,123.5,1.02)

"BLD",1884,4,"APDD",123.5,123.5,1.03)

"BLD",1884,4,"APDD",123.5,123.5,1.04)

"BLD",1884,4,"APDD",123.5,123.5,1.05)

"BLD",1884,4,"APDD",123.5,123.5,124)

"BLD",1884,4,"APDD",123.5,123.5,125)

"BLD",1884,4,"APDD",123.5,123.51)

"BLD",1884,4,"APDD",123.5,123.51,.01)

"BLD",1884,4,"B",123,123)

"BLD",1884,4,"B",123.1,123.1)

"BLD",1884,4,"B",123.5,123.5)

"BLD",1884,"ABPKG")
n
"BLD",1884,"KRN",0)
^9.67PA^19^18
"BLD",1884,"KRN",.4,0)
.4
"BLD",1884,"KRN",.401,0)
.401
"BLD",1884,"KRN",.402,0)
.402
"BLD",1884,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",1884,"KRN",.402,"NM",1,0)
GMRC SETUP REQUEST SERVICE    FILE #123.5^123.5^0
"BLD",1884,"KRN",.402,"NM","B","GMRC SETUP REQUEST SERVICE    FILE #123.5",1)

"BLD",1884,"KRN",.403,0)
.403
"BLD",1884,"KRN",.5,0)
.5
"BLD",1884,"KRN",.84,0)
.84
"BLD",1884,"KRN",3.6,0)
3.6
"BLD",1884,"KRN",3.8,0)
3.8
"BLD",1884,"KRN",9.2,0)
9.2
"BLD",1884,"KRN",9.8,0)
9.8
"BLD",1884,"KRN",9.8,"NM",0)
^9.68A^31^31
"BLD",1884,"KRN",9.8,"NM",1,0)
GMRCDRFR^^0^B4592184
"BLD",1884,"KRN",9.8,"NM",2,0)
GMRCHL7^^0^B30345234
"BLD",1884,"KRN",9.8,"NM",3,0)
GMRCHL7A^^0^B29948326
"BLD",1884,"KRN",9.8,"NM",4,0)
GMRCHL7B^^0^B16688289
"BLD",1884,"KRN",9.8,"NM",5,0)
GMRCHL7U^^0^B21735359
"BLD",1884,"KRN",9.8,"NM",6,0)
GMRCUTL1^^0^B8649023
"BLD",1884,"KRN",9.8,"NM",7,0)
GMRCEDT1^^0^B34210569
"BLD",1884,"KRN",9.8,"NM",8,0)
GMRCEDT4^^0^B79860732
"BLD",1884,"KRN",9.8,"NM",9,0)
GMRCEDT2^^0^B14196686
"BLD",1884,"KRN",9.8,"NM",10,0)
GMRCGUIC^^0^B47711944
"BLD",1884,"KRN",9.8,"NM",11,0)
GMRCGUIU^^0^B13213484
"BLD",1884,"KRN",9.8,"NM",12,0)
GMRCGUIA^^0^B40266329
"BLD",1884,"KRN",9.8,"NM",13,0)
GMRCGUIB^^0^B25697393
"BLD",1884,"KRN",9.8,"NM",14,0)
GMRCPR0^^0^B15609646
"BLD",1884,"KRN",9.8,"NM",15,0)
GMRCAFRD^^0^B31938577
"BLD",1884,"KRN",9.8,"NM",16,0)
GMRCADC^^0^B11031013
"BLD",1884,"KRN",9.8,"NM",17,0)
GMRCHL72^^0^B14027940
"BLD",1884,"KRN",9.8,"NM",18,0)
GMRCA1^^0^B20202871
"BLD",1884,"KRN",9.8,"NM",19,0)
GMRCAAC^^0^B7153655
"BLD",1884,"KRN",9.8,"NM",20,0)
GMRCP5^^0^B44831066
"BLD",1884,"KRN",9.8,"NM",21,0)
GMRCP5A^^0^B54084490
"BLD",1884,"KRN",9.8,"NM",22,0)
GMRCASV^^0^B58747088
"BLD",1884,"KRN",9.8,"NM",23,0)
GMRCSLM^^0^B34848103
"BLD",1884,"KRN",9.8,"NM",24,0)
GMRCSLM1^^0^B44568838
"BLD",1884,"KRN",9.8,"NM",25,0)
GMRCSLM4^^0^B19294992
"BLD",1884,"KRN",9.8,"NM",26,0)
GMRCREXT^^0^B2232546
"BLD",1884,"KRN",9.8,"NM",27,0)
GMRCP5D^^0^B46633787
"BLD",1884,"KRN",9.8,"NM",28,0)
GMRCP5B^^0^B29033813
"BLD",1884,"KRN",9.8,"NM",29,0)
GMRCTIUE^^0^B32556151
"BLD",1884,"KRN",9.8,"NM",30,0)
GMRCAU^^0^B52026948
"BLD",1884,"KRN",9.8,"NM",31,0)
GMRCTIU^^0^B12727015
"BLD",1884,"KRN",9.8,"NM","B","GMRCA1",18)

"BLD",1884,"KRN",9.8,"NM","B","GMRCAAC",19)

"BLD",1884,"KRN",9.8,"NM","B","GMRCADC",16)

"BLD",1884,"KRN",9.8,"NM","B","GMRCAFRD",15)

"BLD",1884,"KRN",9.8,"NM","B","GMRCASV",22)

"BLD",1884,"KRN",9.8,"NM","B","GMRCAU",30)

"BLD",1884,"KRN",9.8,"NM","B","GMRCDRFR",1)

"BLD",1884,"KRN",9.8,"NM","B","GMRCEDT1",7)

"BLD",1884,"KRN",9.8,"NM","B","GMRCEDT2",9)

"BLD",1884,"KRN",9.8,"NM","B","GMRCEDT4",8)

"BLD",1884,"KRN",9.8,"NM","B","GMRCGUIA",12)

"BLD",1884,"KRN",9.8,"NM","B","GMRCGUIB",13)

"BLD",1884,"KRN",9.8,"NM","B","GMRCGUIC",10)

"BLD",1884,"KRN",9.8,"NM","B","GMRCGUIU",11)

"BLD",1884,"KRN",9.8,"NM","B","GMRCHL7",2)

"BLD",1884,"KRN",9.8,"NM","B","GMRCHL72",17)

"BLD",1884,"KRN",9.8,"NM","B","GMRCHL7A",3)

"BLD",1884,"KRN",9.8,"NM","B","GMRCHL7B",4)

"BLD",1884,"KRN",9.8,"NM","B","GMRCHL7U",5)

"BLD",1884,"KRN",9.8,"NM","B","GMRCP5",20)

"BLD",1884,"KRN",9.8,"NM","B","GMRCP5A",21)

"BLD",1884,"KRN",9.8,"NM","B","GMRCP5B",28)

"BLD",1884,"KRN",9.8,"NM","B","GMRCP5D",27)

"BLD",1884,"KRN",9.8,"NM","B","GMRCPR0",14)

"BLD",1884,"KRN",9.8,"NM","B","GMRCREXT",26)

"BLD",1884,"KRN",9.8,"NM","B","GMRCSLM",23)

"BLD",1884,"KRN",9.8,"NM","B","GMRCSLM1",24)

"BLD",1884,"KRN",9.8,"NM","B","GMRCSLM4",25)

"BLD",1884,"KRN",9.8,"NM","B","GMRCTIU",31)

"BLD",1884,"KRN",9.8,"NM","B","GMRCTIUE",29)

"BLD",1884,"KRN",9.8,"NM","B","GMRCUTL1",6)

"BLD",1884,"KRN",19,0)
19
"BLD",1884,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",1884,"KRN",19,"NM",1,0)
GMRC TEST DEFAULT REASON^^0
"BLD",1884,"KRN",19,"NM",2,0)
GMRC MGR^^2
"BLD",1884,"KRN",19,"NM",3,0)
GMRC LIST HIERARCHY^^0
"BLD",1884,"KRN",19,"NM","B","GMRC LIST HIERARCHY",3)

"BLD",1884,"KRN",19,"NM","B","GMRC MGR",2)

"BLD",1884,"KRN",19,"NM","B","GMRC TEST DEFAULT REASON",1)

"BLD",1884,"KRN",19.1,0)
19.1
"BLD",1884,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",1884,"KRN",101,0)
101
"BLD",1884,"KRN",101,"NM",0)
^9.68A^24^24
"BLD",1884,"KRN",101,"NM",1,0)
GMRCU SELECT DEF REAS PATIENT^^0
"BLD",1884,"KRN",101,"NM",2,0)
GMRCU SELECT DEF REASON SERV^^0
"BLD",1884,"KRN",101,"NM",3,0)
GMRCACTM DEFAULT REASON^^0
"BLD",1884,"KRN",101,"NM",4,0)
GMRCACT SCHEDULED REQUEST^^0
"BLD",1884,"KRN",101,"NM",5,0)
GMRCACTM SERVICE ACTION MENU^^0
"BLD",1884,"KRN",101,"NM",6,0)
GMRCACT PRINT CONSULT FORM^^0
"BLD",1884,"KRN",101,"NM",7,0)
GMRCACT DETAILED DISPLAY^^0
"BLD",1884,"KRN",101,"NM",8,0)
GMRCACT RESULTS DISPLAY^^0
"BLD",1884,"KRN",101,"NM",9,0)
GMRCACT NEW PATIENT^^0
"BLD",1884,"KRN",101,"NM",10,0)
GMRCACTM CHANGE VIEW^^0
"BLD",1884,"KRN",101,"NM",11,0)
GMRCACT RECEIVED REQUEST^^0
"BLD",1884,"KRN",101,"NM",12,0)
GMRCACT FORWARD^^0
"BLD",1884,"KRN",101,"NM",13,0)
GMRCACT COMMENT ORDERS^^0
"BLD",1884,"KRN",101,"NM",14,0)
GMRCACT COMPLETE^^0
"BLD",1884,"KRN",101,"NM",15,0)
GMRCACT DISCONTINUE^^0
"BLD",1884,"KRN",101,"NM",16,0)
GMRCACT CANCEL REQUEST^^0
"BLD",1884,"KRN",101,"NM",17,0)
GMRCACT MAKE ADDENDUM^^0
"BLD",1884,"KRN",101,"NM",18,0)
GMRCACT SIGNIFICANT FINDINGS^^0
"BLD",1884,"KRN",101,"NM",19,0)
GMRCACT SELECT SERVICE^^0
"BLD",1884,"KRN",101,"NM",20,0)
GMRCACT TRK DATE CHANGE^^0
"BLD",1884,"KRN",101,"NM",21,0)
GMRCACT VIEW BY STATUS^^0
"BLD",1884,"KRN",101,"NM",22,0)
GMRCB BLANK LINE^^0
"BLD",1884,"KRN",101,"NM",23,0)
GMRCACTM ALERT SERVICE ACTIONS^^0
"BLD",1884,"KRN",101,"NM",24,0)
GMRCACTM ALERT BASIC ACTIONS^^0
"BLD",1884,"KRN",101,"NM","B","GMRCACT CANCEL REQUEST",16)

"BLD",1884,"KRN",101,"NM","B","GMRCACT COMMENT ORDERS",13)

"BLD",1884,"KRN",101,"NM","B","GMRCACT COMPLETE",14)

"BLD",1884,"KRN",101,"NM","B","GMRCACT DETAILED DISPLAY",7)

"BLD",1884,"KRN",101,"NM","B","GMRCACT DISCONTINUE",15)

"BLD",1884,"KRN",101,"NM","B","GMRCACT FORWARD",12)

"BLD",1884,"KRN",101,"NM","B","GMRCACT MAKE ADDENDUM",17)

"BLD",1884,"KRN",101,"NM","B","GMRCACT NEW PATIENT",9)

"BLD",1884,"KRN",101,"NM","B","GMRCACT PRINT CONSULT FORM",6)

"BLD",1884,"KRN",101,"NM","B","GMRCACT RECEIVED REQUEST",11)

"BLD",1884,"KRN",101,"NM","B","GMRCACT RESULTS DISPLAY",8)

"BLD",1884,"KRN",101,"NM","B","GMRCACT SCHEDULED REQUEST",4)

"BLD",1884,"KRN",101,"NM","B","GMRCACT SELECT SERVICE",19)

"BLD",1884,"KRN",101,"NM","B","GMRCACT SIGNIFICANT FINDINGS",18)

"BLD",1884,"KRN",101,"NM","B","GMRCACT TRK DATE CHANGE",20)

"BLD",1884,"KRN",101,"NM","B","GMRCACT VIEW BY STATUS",21)

"BLD",1884,"KRN",101,"NM","B","GMRCACTM ALERT BASIC ACTIONS",24)

"BLD",1884,"KRN",101,"NM","B","GMRCACTM ALERT SERVICE ACTIONS",23)

"BLD",1884,"KRN",101,"NM","B","GMRCACTM CHANGE VIEW",10)

"BLD",1884,"KRN",101,"NM","B","GMRCACTM DEFAULT REASON",3)

"BLD",1884,"KRN",101,"NM","B","GMRCACTM SERVICE ACTION MENU",5)

"BLD",1884,"KRN",101,"NM","B","GMRCB BLANK LINE",22)

"BLD",1884,"KRN",101,"NM","B","GMRCU SELECT DEF REAS PATIENT",1)

"BLD",1884,"KRN",101,"NM","B","GMRCU SELECT DEF REASON SERV",2)

"BLD",1884,"KRN",409.61,0)
409.61
"BLD",1884,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",1884,"KRN",409.61,"NM",1,0)
GMRC DEFAULT REASON^^0
"BLD",1884,"KRN",409.61,"NM","B","GMRC DEFAULT REASON",1)

"BLD",1884,"KRN",771,0)
771
"BLD",1884,"KRN",869.2,0)
869.2
"BLD",1884,"KRN",870,0)
870
"BLD",1884,"KRN",8994,0)
8994
"BLD",1884,"KRN","B",.4,.4)

"BLD",1884,"KRN","B",.401,.401)

"BLD",1884,"KRN","B",.402,.402)

"BLD",1884,"KRN","B",.403,.403)

"BLD",1884,"KRN","B",.5,.5)

"BLD",1884,"KRN","B",.84,.84)

"BLD",1884,"KRN","B",3.6,3.6)

"BLD",1884,"KRN","B",3.8,3.8)

"BLD",1884,"KRN","B",9.2,9.2)

"BLD",1884,"KRN","B",9.8,9.8)

"BLD",1884,"KRN","B",19,19)

"BLD",1884,"KRN","B",19.1,19.1)

"BLD",1884,"KRN","B",101,101)

"BLD",1884,"KRN","B",409.61,409.61)

"BLD",1884,"KRN","B",771,771)

"BLD",1884,"KRN","B",869.2,869.2)

"BLD",1884,"KRN","B",870,870)

"BLD",1884,"KRN","B",8994,8994)

"BLD",1884,"QUES",0)
^9.62^^
"BLD",1884,"REQB",0)
^9.611^6^6
"BLD",1884,"REQB",1,0)
GMRC*3.0*4^2
"BLD",1884,"REQB",2,0)
GMRC*3.0*5^2
"BLD",1884,"REQB",3,0)
GMRC*3.0*11^2
"BLD",1884,"REQB",4,0)
GMRC*3.0*10^2
"BLD",1884,"REQB",5,0)
GMRC*3.0*13^2
"BLD",1884,"REQB",6,0)
GMRC*3.0*14^2
"BLD",1884,"REQB","B","GMRC*3.0*10",4)

"BLD",1884,"REQB","B","GMRC*3.0*11",3)

"BLD",1884,"REQB","B","GMRC*3.0*13",5)

"BLD",1884,"REQB","B","GMRC*3.0*14",6)

"BLD",1884,"REQB","B","GMRC*3.0*4",1)

"BLD",1884,"REQB","B","GMRC*3.0*5",2)

"DATA",123.1,8,0)
SCHEDULED^8^^^SC^^ZC^Scheduled^
"DATA",123.1,21,0)
RECEIVED^6^^^SC^^SC^Receive^
"FIA",123)
REQUEST/CONSULTATION
"FIA",123,0)
^GMR(123,
"FIA",123,0,0)
123DI
"FIA",123,0,1)
y^n^p^^^^n
"FIA",123,0,10)

"FIA",123,0,11)

"FIA",123,0,"RLRO")

"FIA",123,0,"VR")
3.0^GMRC
"FIA",123,123)
1
"FIA",123,123,30.1)

"FIA",123.1)
REQUEST ACTION TYPES
"FIA",123.1,0)
^GMR(123.1,
"FIA",123.1,0,0)
123.1
"FIA",123.1,0,1)
n^y^f^^y^^y^o^n
"FIA",123.1,0,10)

"FIA",123.1,0,11)
I Y=8!(Y=21)
"FIA",123.1,0,"RLRO")

"FIA",123.1,0,"VR")
3.0^GMRC
"FIA",123.1,123.1)
0
"FIA",123.5)
REQUEST SERVICES
"FIA",123.5,0)
^GMR(123.5,
"FIA",123.5,0,0)
123.5
"FIA",123.5,0,1)
y^n^p^^^^n
"FIA",123.5,0,10)

"FIA",123.5,0,11)

"FIA",123.5,0,"RLRO")

"FIA",123.5,0,"VR")
3.0^GMRC
"FIA",123.5,123.5)
1
"FIA",123.5,123.5,1.01)

"FIA",123.5,123.5,1.02)

"FIA",123.5,123.5,1.03)

"FIA",123.5,123.5,1.04)

"FIA",123.5,123.5,1.05)

"FIA",123.5,123.5,10)

"FIA",123.5,123.5,124)

"FIA",123.5,123.5,125)

"FIA",123.5,123.51)
1
"FIA",123.5,123.51,.01)

"FIA",123.5,123.5124)
0
"FIA",123.5,123.5125)
0
"FRV1",123.1,"21,0",2)
ACTIVE
"FRV1",123.1,"21,0",2,"F")
;ORD(100.01,
"FRV1",123.1,"8,0",2)
SCHEDULED
"FRV1",123.1,"8,0",2,"F")
;ORD(100.01,
"KRN",.402,763,-1)
0^1
"KRN",.402,763,0)
GMRC SETUP REQUEST SERVICE^3000324.1032^^123.5^^^3000503
"KRN",.402,763,"DIAB",1,1,123.51,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.52,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.53,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.54,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.55,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.555,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.57,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.58,0)
ALL
"KRN",.402,763,"DIAB",1,1,123.59,0)
ALL
"KRN",.402,763,"DIAB",3,0,123.5,0)
1.11;"ABBREVIATED PRINT NAME (Optional)"
"KRN",.402,763,"DR",1,123.5)
.01;123.01///^S X="CONSULTS";1.11ABBREVIATED PRINT NAME (Optional)~;1.1;123.03///^S X="GMRCACTM SERVICE ACTION MENU";2;123.09;1.04;1.05;1.01;1.02;125;124;1.03;D EN^DDIOL(" ");123.08;123.1;123.2;.08;D EN^DDIOL(" ");123.3;123.31;
"KRN",.402,763,"DR",1,123.5,1)
123.35;123.33;123.34;.07;D EN^DDIOL(" ");123.5;.06;10;101;
"KRN",.402,763,"DR",2,123.51)
.01:2
"KRN",.402,763,"DR",2,123.5101)
.01;
"KRN",.402,763,"DR",2,123.52)
.01
"KRN",.402,763,"DR",2,123.53)
.01
"KRN",.402,763,"DR",2,123.54)
.01:2
"KRN",.402,763,"DR",2,123.55)
.01
"KRN",.402,763,"DR",2,123.555)
.01:.02
"KRN",.402,763,"DR",2,123.57)
.01
"KRN",.402,763,"DR",2,123.58)
.01:.02
"KRN",.402,763,"DR",2,123.59)
.01
"KRN",19,2046,-1)
2^2
"KRN",19,2046,0)
GMRC MGR^Consult Management^^M^.5^^^^^^^128
"KRN",19,2046,10,0)
^19.01IP^17^16
"KRN",19,2046,10,15,0)
7884^TD^29
"KRN",19,2046,10,15,"^")
GMRC TEST DEFAULT REASON
"KRN",19,2046,10,17,0)
8003^LH^30
"KRN",19,2046,10,17,"^")
GMRC LIST HIERARCHY
"KRN",19,2046,"U")
CONSULT MANAGEMENT
"KRN",19,7884,-1)
0^1
"KRN",19,7884,0)
GMRC TEST DEFAULT REASON^Test Default Reason for Request^^R^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",19,7884,1,0)
^19.06^7^7^3000315^^
"KRN",19,7884,1,1,0)
This option will allow the Clinical Coordinator or IRM to test the default
"KRN",19,7884,1,2,0)
reason for request for a given service without placing an order.
"KRN",19,7884,1,3,0)
 
"KRN",19,7884,1,4,0)
This option prompts for the selection of a service from the consult
"KRN",19,7884,1,5,0)
hierarchy and a patient name. The default reason will be presented based
"KRN",19,7884,1,6,0)
on the selected patient in a list manager format. This format allows
"KRN",19,7884,1,7,0)
searching, printing etc. 
"KRN",19,7884,25)
EN^GMRCDRFR
"KRN",19,7884,"U")
TEST DEFAULT REASON FOR REQUES
"KRN",19,8003,-1)
0^3
"KRN",19,8003,0)
GMRC LIST HIERARCHY^List Consult Service Hierarchy^^R^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",19,8003,1,0)
^^4^4^3000315^
"KRN",19,8003,1,1,0)
This option will allow the Consult Service hierarchy to be printed. The
"KRN",19,8003,1,2,0)
listing will include all disabled and tracking only services. Any services
"KRN",19,8003,1,3,0)
in the REQUEST SERVICES (#123.5) file that are not part of the hierarchy
"KRN",19,8003,1,4,0)
will be listed at the end. 
"KRN",19,8003,25)
LISTOPT^GMRCASV
"KRN",19,8003,"U")
LIST CONSULT SERVICE HIERARCHY
"KRN",101,1402,-1)
0^19
"KRN",101,1402,0)
GMRCACT SELECT SERVICE^Service^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1402,1,0)
^^1^1^2980703^^
"KRN",101,1402,1,1,0)
Select a service/specialty to review consults
"KRN",101,1402,4)
^^^SS
"KRN",101,1402,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1402,20)
D SS^GMRCSLM,ENTRY^GMRCSLMA("HL")
"KRN",101,1402,21,0)
^101.021A^^0
"KRN",101,1402,99)
57910,46910
"KRN",101,1712,-1)
0^8
"KRN",101,1712,0)
GMRCACT RESULTS DISPLAY^Results Display^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1712,1,0)
^^3^3^3000209^^^^
"KRN",101,1712,1,1,0)
Display the consult result using the RT. This will list all TIU consult
"KRN",101,1712,1,2,0)
reports (with addenda), all Medicine package results, and resolution
"KRN",101,1712,1,3,0)
comments.
"KRN",101,1712,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1712,20)
D RT^GMRCA1(""),ENTRY^GMRCSLMA("H")
"KRN",101,1712,26)
S XQORM("A")="Select Action: "
"KRN",101,1712,28)

"KRN",101,1712,99)
57471,48368
"KRN",101,1712,101.04)
^
"KRN",101,1717,-1)
0^13
"KRN",101,1717,0)
GMRCACT COMMENT ORDERS^Add Comment^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1717,.1)

"KRN",101,1717,1,0)
^^1^1^2980804^^^^
"KRN",101,1717,1,1,0)
Add a comment to a consult.
"KRN",101,1717,2,0)
^101.02A^^0
"KRN",101,1717,4)
^3
"KRN",101,1717,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1717,20)
D COMMENT^GMRCA1(""),ENTRY^GMRCSLMA("")
"KRN",101,1717,99)
57471,48368
"KRN",101,1718,-1)
0^7
"KRN",101,1718,0)
GMRCACT DETAILED DISPLAY^Detailed Display ^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1718,1,0)
^^1^1^2981019^^^^
"KRN",101,1718,1,1,0)
Display consult details for order, audit log, and results
"KRN",101,1718,4)
^3
"KRN",101,1718,10,0)
^101.01PA^0^0
"KRN",101,1718,15)
D EXIT^GMRCSLDT,EXIT^GMRCSLMA("R")
"KRN",101,1718,20)
D EN^GMRCSLDT,ENTRY^GMRCSLMA("H")
"KRN",101,1718,99)
57471,48368
"KRN",101,1720,-1)
0^9
"KRN",101,1720,0)
GMRCACT NEW PATIENT^Select Patient^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1720,1,0)
^^1^1^2981019^^^^
"KRN",101,1720,1,1,0)
Select a new patient
"KRN",101,1720,10,0)
^101.01PA^0^0
"KRN",101,1720,15)
S VALMBCK="R",VALMBG=1 K GMRCSEL,GMRCO,GMRCND
"KRN",101,1720,20)
D SP^GMRCSLM S VALMBCK="R" Q:$D(GMRCQUT)  D INIT^GMRCSLM,HDR^GMRCSLM
"KRN",101,1720,99)
57471,48368
"KRN",101,1723,-1)
0^6
"KRN",101,1723,0)
GMRCACT PRINT CONSULT FORM^Print Form 513^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1723,1,0)
^^1^1^2980915^^^^
"KRN",101,1723,1,1,0)
Print Consult Std Form 513 for an order
"KRN",101,1723,10,0)
^101.01PA^0^0
"KRN",101,1723,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1723,20)
S VALMBCK="R" D SEL^GMRCP5 Q:$D(GMRCQUT)  D EN^GMRCP5(GMRCND),ENTRY^GMRCSLMA("")
"KRN",101,1723,21,0)
^101.021A
"KRN",101,1723,99)
57471,48368
"KRN",101,1973,-1)
0^12
"KRN",101,1973,0)
GMRCACT FORWARD^Forward^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1973,1,0)
^^1^1^2980727^^^^
"KRN",101,1973,1,1,0)
Forward order to another service
"KRN",101,1973,4)
^3
"KRN",101,1973,10,0)
^101.01PA^0^0
"KRN",101,1973,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1973,20)
D FR^GMRCAFRD("") S:$D(GMRCSS) GMRCDG=GMRCSS D:$D(GMRCDG) SERV1^GMRCASV D ENTRY^GMRCSLMA("HL")
"KRN",101,1973,99)
57471,48368
"KRN",101,1999,-1)
0^15
"KRN",101,1999,0)
GMRCACT DISCONTINUE^Discontinue^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,1999,1,0)
^^1^1^2980714^^
"KRN",101,1999,1,1,0)
Discontinue an order. (Updates OE/RR status to "dc")
"KRN",101,1999,4)
24^2
"KRN",101,1999,10,0)
^101.01PA^0^0
"KRN",101,1999,15)
D EXIT^GMRCSLMA("R")
"KRN",101,1999,20)
S GMRCA=6 D DC^GMRCA1("",GMRCA),ENTRY^GMRCSLMA("L")
"KRN",101,1999,99)
57471,48368
"KRN",101,2070,-1)
0^16
"KRN",101,2070,0)
GMRCACT CANCEL REQUEST^Cancel (Deny)^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,2070,1,0)
^^3^3^2980714^^
"KRN",101,2070,1,1,0)
The service may cancel a consult request, with an explanation. (Updates
"KRN",101,2070,1,2,0)
OE/RR status to "x").  Requestors of cancelled consults may edit and
"KRN",101,2070,1,3,0)
resubmit the request.
"KRN",101,2070,4)
^3
"KRN",101,2070,15)
D EXIT^GMRCSLMA("R")
"KRN",101,2070,20)
S GMRCA=19 D DC^GMRCA1("",GMRCA),ENTRY^GMRCSLMA("L")
"KRN",101,2070,99)
57471,48368
"KRN",101,2071,-1)
0^14
"KRN",101,2071,0)
GMRCACT COMPLETE^Complete/Update^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,2071,1,0)
^^1^1^2980804^^^^
"KRN",101,2071,1,1,0)
Complete/Update the results for a consult.
"KRN",101,2071,4)
^^^CT
"KRN",101,2071,10,0)
^101.01PA^0^0
"KRN",101,2071,15)
D EXIT^GMRCSLMA("R")
"KRN",101,2071,20)
D ENTER^GMRCTIU(""),ENTRY^GMRCSLMA("LH")
"KRN",101,2071,99)
57471,48368
"KRN",101,2112,-1)
0^5
"KRN",101,2112,0)
GMRCACTM SERVICE ACTION MENU^Service Action Menu^^Q^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,2112,1,0)
^^4^4^2980826^^^^
"KRN",101,2112,1,1,0)
This is the menu of actions which may be used for a service to keep
"KRN",101,2112,1,2,0)
track service activities for consults and requests.  There are paging,
"KRN",101,2112,1,3,0)
print and tracking actions included.  The tracking actions perform an
"KRN",101,2112,1,4,0)
activity tracking audit trail.
"KRN",101,2112,4)
18^3
"KRN",101,2112,10,0)
^101.01PA^25^14
"KRN",101,2112,10,5,0)
1723^PF^23^^^
"KRN",101,2112,10,5,"^")
GMRCACT PRINT CONSULT FORM
"KRN",101,2112,10,6,0)
1718^DD^21^^^
"KRN",101,2112,10,6,"^")
GMRCACT DETAILED DISPLAY
"KRN",101,2112,10,7,0)
1712^RT^22^^^
"KRN",101,2112,10,7,"^")
GMRCACT RESULTS DISPLAY
"KRN",101,2112,10,9,0)
1720^SP^1^^^
"KRN",101,2112,10,9,"^")
GMRCACT NEW PATIENT
"KRN",101,2112,10,10,0)
5042^CV^2^^^
"KRN",101,2112,10,10,"^")
GMRCACTM CHANGE VIEW
"KRN",101,2112,10,13,0)
2121^RC^3^^^
"KRN",101,2112,10,13,"^")
GMRCACT RECEIVED REQUEST
"KRN",101,2112,10,14,0)
1973^FR^9^^^
"KRN",101,2112,10,14,"^")
GMRCACT FORWARD
"KRN",101,2112,10,15,0)
1717^CM^12^^^
"KRN",101,2112,10,15,"^")
GMRCACT COMMENT ORDERS
"KRN",101,2112,10,17,0)
2071^CT^14^^^
"KRN",101,2112,10,17,"^")
GMRCACT COMPLETE
"KRN",101,2112,10,18,0)
1999^DC^11^^^
"KRN",101,2112,10,18,"^")
GMRCACT DISCONTINUE
"KRN",101,2112,10,19,0)
2070^CX^10^^^
"KRN",101,2112,10,19,"^")
GMRCACT CANCEL REQUEST
"KRN",101,2112,10,23,0)
5021^MA^15^^^
"KRN",101,2112,10,23,"^")
GMRCACT MAKE ADDENDUM
"KRN",101,2112,10,24,0)
5628^SC^4^^^Schedule
"KRN",101,2112,10,24,"^")
GMRCACT SCHEDULED REQUEST
"KRN",101,2112,10,25,0)
5121^SF^16^
"KRN",101,2112,10,25,"^")
GMRCACT SIGNIFICANT FINDINGS
"KRN",101,2112,26)
D PHDR^GMRCSLMA
"KRN",101,2112,28)
Select Action: 
"KRN",101,2112,99)
58154,29735
"KRN",101,2121,-1)
0^11
"KRN",101,2121,0)
GMRCACT RECEIVED REQUEST^Receive^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,2121,1,0)
^101.06^1^1^3000320^^^^
"KRN",101,2121,1,1,0)
Acknowledge the receipt of a consult (updates CPRS status to active).
"KRN",101,2121,4)
^3^^RC
"KRN",101,2121,10,0)
^101.01PA^0^0
"KRN",101,2121,15)
D EXIT^GMRCSLMA("R")
"KRN",101,2121,20)
D RC^GMRCA1(""),ENTRY^GMRCSLMA("L")
"KRN",101,2121,28)

"KRN",101,2121,99)
57471,48369
"KRN",101,3730,-1)
0^20
"KRN",101,3730,0)
GMRCACT TRK DATE CHANGE^Date Range^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,3730,1,0)
^^1^1^2980703^^^^
"KRN",101,3730,1,1,0)
Select a new date range for displaying consults.
"KRN",101,3730,2,0)
^101.02A^1^1
"KRN",101,3730,2,1,0)
DT
"KRN",101,3730,2,"B","DT",1)

"KRN",101,3730,4)
18^4
"KRN",101,3730,10,0)
^101.01PA^0^0
"KRN",101,3730,15)
D EXIT^GMRCSLMA("R")
"KRN",101,3730,20)
D ^GMRCSPD,SELEXIT^GMRCSLMA
"KRN",101,3730,26)

"KRN",101,3730,28)

"KRN",101,3730,99)
57323,51958
"KRN",101,3994,-1)
0^23
"KRN",101,3994,0)
GMRCACTM ALERT SERVICE ACTIONS^Protocol to process actions from alert menu's.^^M^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,3994,1,0)
^^5^5^2980430^^^^
"KRN",101,3994,1,1,0)
This protocol is used with the GMRC ALERT ACTIONS List manager template
"KRN",101,3994,1,2,0)
and is called when an alert is received by a service user who wishes to
"KRN",101,3994,1,3,0)
process the protocol from the alert menu. The consult displayed in the
"KRN",101,3994,1,4,0)
alert is shown, along with all of the actions necessary to process the
"KRN",101,3994,1,5,0)
protocol.
"KRN",101,3994,4)
24^3
"KRN",101,3994,10,0)
^101.01PA^12^11
"KRN",101,3994,10,1,0)
1718^DD^21^^^
"KRN",101,3994,10,1,"^")
GMRCACT DETAILED DISPLAY
"KRN",101,3994,10,3,0)
1717^CM^14^^^
"KRN",101,3994,10,3,"^")
GMRCACT COMMENT ORDERS
"KRN",101,3994,10,4,0)
1723^PT^23^^^
"KRN",101,3994,10,4,"^")
GMRCACT PRINT CONSULT FORM
"KRN",101,3994,10,5,0)
1973^FR^11^^^
"KRN",101,3994,10,5,"^")
GMRCACT FORWARD
"KRN",101,3994,10,6,0)
1999^DC^13^^^
"KRN",101,3994,10,6,"^")
GMRCACT DISCONTINUE
"KRN",101,3994,10,7,0)
2070^CX^12^^^
"KRN",101,3994,10,7,"^")
GMRCACT CANCEL REQUEST
"KRN",101,3994,10,8,0)
2121^RC^10^^^
"KRN",101,3994,10,8,"^")
GMRCACT RECEIVED REQUEST
"KRN",101,3994,10,9,0)
2071^CT^15^^^
"KRN",101,3994,10,9,"^")
GMRCACT COMPLETE
"KRN",101,3994,10,10,0)
1712^RT^22^^^
"KRN",101,3994,10,10,"^")
GMRCACT RESULTS DISPLAY
"KRN",101,3994,10,11,0)
5021^MA^16^
"KRN",101,3994,10,11,"^")
GMRCACT MAKE ADDENDUM
"KRN",101,3994,10,12,0)
5628^SC^17^^^Schedule
"KRN",101,3994,10,12,"^")
GMRCACT SCHEDULED REQUEST
"KRN",101,3994,15)
S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"KRN",101,3994,20)
D INIT^GMRCALRT
"KRN",101,3994,26)
D SHOW^VALM S XQORM("#")=$O(^ORD(101,"B","GMRC SELECT ITEM",0))_"^1:"_VALMCNT,XQORM("A")="Select Consult: "
"KRN",101,3994,99)
58188,54978
"KRN",101,4037,-1)
0^21
"KRN",101,4037,0)
GMRCACT VIEW BY STATUS^Status^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,4037,1,0)
^^1^1^2980703^
"KRN",101,4037,1,1,0)
Allows a user to specify the status of the Consults to be displayed.
"KRN",101,4037,2,0)
^101.02A^1^1
"KRN",101,4037,2,1,0)
ST
"KRN",101,4037,2,"B","ST",1)

"KRN",101,4037,15)
D EXIT^GMRCSLMA("R")
"KRN",101,4037,20)
D EN^GMRCSTAT,ENTRY^GMRCSLMA("HL")
"KRN",101,4037,99)
57323,50919
"KRN",101,5021,-1)
0^17
"KRN",101,5021,0)
GMRCACT MAKE ADDENDUM^Make Addendum^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5021,1,0)
^^1^1^2980716^^^^
"KRN",101,5021,1,1,0)
Make an addendum to the Result of the Consult in TIU.
"KRN",101,5021,4)
^3
"KRN",101,5021,15)
D EXIT^GMRCSLMA("R")
"KRN",101,5021,20)
D ADDEND^GMRCTIU(""),ENTRY^GMRCSLMA("LH")
"KRN",101,5021,99)
57471,48369
"KRN",101,5041,-1)
0^24
"KRN",101,5041,0)
GMRCACTM ALERT BASIC ACTIONS^Basic, no update, actions from alert menu's.^^M^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5041,1,0)
^^4^4^2980710^^^^
"KRN",101,5041,1,1,0)
This protocol is used with the GMRC ALERT ACTIONS List Manager template
"KRN",101,5041,1,2,0)
and is called as the default protocol menu, unless the user has service
"KRN",101,5041,1,3,0)
update capabilities.  Then this protocol menu will be replaced (hijacked)
"KRN",101,5041,1,4,0)
by the GMRCACTM ALERT SERVICE ACTIONS protocol menu.
"KRN",101,5041,4)
^3
"KRN",101,5041,10,0)
^101.01PA^4^4
"KRN",101,5041,10,1,0)
1718^DD^1^^^
"KRN",101,5041,10,1,"^")
GMRCACT DETAILED DISPLAY
"KRN",101,5041,10,2,0)
1723^PT^3^^^
"KRN",101,5041,10,2,"^")
GMRCACT PRINT CONSULT FORM
"KRN",101,5041,10,3,0)
1712^RT^2^^^Results Display
"KRN",101,5041,10,3,"^")
GMRCACT RESULTS DISPLAY
"KRN",101,5041,10,4,0)
1717^CM^4^
"KRN",101,5041,10,4,"^")
GMRCACT COMMENT ORDERS
"KRN",101,5041,20)

"KRN",101,5041,26)
D SHOW^VALM S XQORM("#")=$O(^ORD(101,"B","GMRC SELECT ITEM",0))_"^1:"_VALMCNT,XQORM("A")="Select Action: "
"KRN",101,5041,99)
58189,53472
"KRN",101,5042,-1)
0^10
"KRN",101,5042,0)
GMRCACTM CHANGE VIEW^Change View ...^^M^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5042,1,0)
^^2^2^2980819^^^^
"KRN",101,5042,1,1,0)
This is the menu of selection criteria for consults (date range, service,
"KRN",101,5042,1,2,0)
or status).
"KRN",101,5042,10,0)
^101.01PA^4^4
"KRN",101,5042,10,1,0)
3730^DT^1^
"KRN",101,5042,10,1,"^")
GMRCACT TRK DATE CHANGE
"KRN",101,5042,10,2,0)
4037^ST^2^
"KRN",101,5042,10,2,"^")
GMRCACT VIEW BY STATUS
"KRN",101,5042,10,3,0)
1402^SS^3^
"KRN",101,5042,10,3,"^")
GMRCACT SELECT SERVICE
"KRN",101,5042,10,4,0)
5043^^^
"KRN",101,5042,10,4,"^")
GMRCB BLANK LINE
"KRN",101,5042,15)
D EXIT^GMRCSLMA("R")
"KRN",101,5042,26)
W ""
"KRN",101,5042,99)
57952,56438
"KRN",101,5043,-1)
0^22
"KRN",101,5043,0)
GMRCB BLANK LINE^   ^^A^^^^^^^^
"KRN",101,5043,1,0)
^^2^2^2971217^^^^
"KRN",101,5043,1,1,0)
   
"KRN",101,5043,1,2,0)
Displays a blank line.  (Item text is 3 spaces.)  Use to get whitespace.
"KRN",101,5043,2,0)
^101.02A^1^1
"KRN",101,5043,2,1,0)
BLANK
"KRN",101,5043,2,"B","BLANK",1)

"KRN",101,5043,99)
57471,48369
"KRN",101,5121,-1)
0^18
"KRN",101,5121,0)
GMRCACT SIGNIFICANT FINDINGS^Sig Findings^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5121,1,0)
^^1^1^2980804^^^^
"KRN",101,5121,1,1,0)
Update the significant findings flag for a consult.
"KRN",101,5121,2,0)
^101.02A^2^1
"KRN",101,5121,2,2,0)
SF
"KRN",101,5121,2,"B","SF",2)

"KRN",101,5121,4)
^3
"KRN",101,5121,15)
D EXIT^GMRCSLMA("R")
"KRN",101,5121,20)
D SF^GMRCASF(""),ENTRY^GMRCSLMA("LH")
"KRN",101,5121,99)
57471,48369
"KRN",101,5423,-1)
0^3
"KRN",101,5423,0)
GMRCACTM DEFAULT REASON^Testing actions for default reason^^M^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5423,4)
26^5
"KRN",101,5423,10,0)
^101.01PA^2^2
"KRN",101,5423,10,1,0)
5424^SS^1^
"KRN",101,5423,10,1,"^")
GMRCU SELECT DEF REASON SERV
"KRN",101,5423,10,2,0)
5425^SP^2^
"KRN",101,5423,10,2,"^")
GMRCU SELECT DEF REAS PATIENT
"KRN",101,5423,15)

"KRN",101,5423,20)

"KRN",101,5423,26)
D SHOW^VALM
"KRN",101,5423,99)
57911,23078
"KRN",101,5424,-1)
0^2
"KRN",101,5424,0)
GMRCU SELECT DEF REASON SERV^Select new service^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5424,1,0)
^^2^2^3000202^
"KRN",101,5424,1,1,0)
This protocol allows the selection of a consult service for which to test
"KRN",101,5424,1,2,0)
the default reason for request.
"KRN",101,5424,15)
S VALMBCK="R"
"KRN",101,5424,20)
D SELSS^GMRCDRFR,HDR^GMRCDRFR,INIT^GMRCDRFR
"KRN",101,5424,99)
57910,48080
"KRN",101,5425,-1)
0^1
"KRN",101,5425,0)
GMRCU SELECT DEF REAS PATIENT^Select new patient^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5425,1,0)
^^2^2^3000202^
"KRN",101,5425,1,1,0)
This protocol allows patient selection for testing the default reason for
"KRN",101,5425,1,2,0)
request.
"KRN",101,5425,15)
S VALMBCK="R"
"KRN",101,5425,20)
D SELPT^GMRCDRFR,HDR^GMRCDRFR,INIT^GMRCDRFR
"KRN",101,5425,99)
57910,48179
"KRN",101,5628,-1)
0^4
"KRN",101,5628,0)
GMRCACT SCHEDULED REQUEST^Update request to Scheduled^^A^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",101,5628,1,0)
^^3^3^3000321^
"KRN",101,5628,1,1,0)
This action allows the request to be marked as scheduled. A comment may
"KRN",101,5628,1,2,0)
 also be added to the request. There is NO linkage to the Scheduling
"KRN",101,5628,1,3,0)
 software via this action.
"KRN",101,5628,15)
D EXIT^GMRCSLMA("R")
"KRN",101,5628,20)
D RC^GMRCA1("",1),ENTRY^GMRCSLMA("L")
"KRN",101,5628,99)
58154,29461
"KRN",409.61,745,-1)
0^1
"KRN",409.61,745,0)
GMRC DEFAULT REASON^1^^80^5^19^1^1^^GMRCACTM DEFAULT REASON^Default Reason for Request^1^^1
"KRN",409.61,745,1)
^GMRCACTM DISPLAY ACTIONS
"KRN",409.61,745,"ARRAY")
 ^TMP("GMRCRFR",$J)
"KRN",409.61,745,"FNL")
D EXIT^GMRCDRFR
"KRN",409.61,745,"HDR")
D HDR^GMRCDRFR
"KRN",409.61,745,"HLP")
D HELP^GMRCDRFR
"KRN",409.61,745,"INIT")
D INIT^GMRCDRFR
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PGL",123.1,0,2,1)
RELATED OE/RR STATUS^P100.01'^ORD(100.01,^0;2^Q
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
12^3000503
"PKG",128,22,1,"PAH",1,1,0)
^^2^2^3000503
"PKG",128,22,1,"PAH",1,1,1,0)
See National Patch Module for complete details of enhancements included in
"PKG",128,22,1,"PAH",1,1,2,0)
this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
31
"RTN","GMRCA1")
0^18^B20202871
"RTN","GMRCA1",1,0)
GMRCA1 ;SLC/DLT,DCM - Actions taken from Review Screens ;6/29/98  23:50
"RTN","GMRCA1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,10,12**;DEC 27, 1997
"RTN","GMRCA1",3,0)
DC(GMRCO,GMRCA) ;Discontinue/Cancel(Deny) logic
"RTN","GMRCA1",4,0)
 ;GMRCO = File 123 IEN of consult
"RTN","GMRCA1",5,0)
 ;GMRCA = Action to take: 6=DISCONTINUED, 19=CANCELLED
"RTN","GMRCA1",6,0)
 ;GMRCOM=comments array
"RTN","GMRCA1",7,0)
 I '$G(GMRCA) S GMRCMSG="This Action not defined!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCA1",8,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",9,0)
 D DC^GMRCADC(GMRCO,GMRCA)
"RTN","GMRCA1",10,0)
 D END
"RTN","GMRCA1",11,0)
 Q
"RTN","GMRCA1",12,0)
 ;
"RTN","GMRCA1",13,0)
COMMENT(GMRCO) ;Add a comment without changing the status
"RTN","GMRCA1",14,0)
 N GMRCA,GMRCLCK
"RTN","GMRCA1",15,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",16,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",17,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",18,0)
 I '$$LOCK(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",19,0)
 S GMRCLCK=1
"RTN","GMRCA1",20,0)
 D COMMENT^GMRCACMT(+GMRCO)
"RTN","GMRCA1",21,0)
 D END
"RTN","GMRCA1",22,0)
 Q
"RTN","GMRCA1",23,0)
 ;
"RTN","GMRCA1",24,0)
RC(GMRCO,GMRCSCH) ;Service tracking request received or scheduled
"RTN","GMRCA1",25,0)
 ; GMRCSCH=1  - schedule action
"RTN","GMRCA1",26,0)
 K GMRCQUT,GMRCQIT,GMRCSEL,GMRCAGN
"RTN","GMRCA1",27,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",28,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",29,0)
 I '$$LOCK(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",30,0)
 ;
"RTN","GMRCA1",31,0)
 N GMRCDA,GMRCIFN,GMRCLCK,GMRCAD
"RTN","GMRCA1",32,0)
 S GMRCLCK=1
"RTN","GMRCA1",33,0)
 S GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCA1",34,0)
 S DFN=$P(GMRC(0),"^",2)
"RTN","GMRCA1",35,0)
 I $S($P(GMRC(0),"^",12)=2:1,$P(^(0),"^",12)=1:1,$P(^(0),"^",12)=13:1,1:0) D  S GMRCQUT=1 D END Q
"RTN","GMRCA1",36,0)
 .S GMRCMSG="This consult has already been "_$S($P(GMRC(0),"^",12)=2:"Completed",$P(^(0),"^",12)=13:"Cancelled",1:"Discontinued")_"."
"RTN","GMRCA1",37,0)
 .S GMRCMSG(1)=" This action may not be taken now."
"RTN","GMRCA1",38,0)
 .D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCA1",39,0)
 .K GMRCMSG
"RTN","GMRCA1",40,0)
 .Q
"RTN","GMRCA1",41,0)
 ;I $P(^GMR(123.5,$P(GMRC(0),"^",5),0),"^",2)=9 S GMRCMSG=$P(^(0),"^",1)_" is an INACTIVE service. No Receive action is possible",GMRCMSG(1)="for this consult on this Service!" D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCA1",42,0)
 I '$G(GMRCSCH),$P(GMRC(0),"^",12)'=5 D  Q
"RTN","GMRCA1",43,0)
 . S GMRCMSG="The receive action may only be taken when the consult"
"RTN","GMRCA1",44,0)
 . S GMRCMSG=GMRCMSG_" has a pending status."
"RTN","GMRCA1",45,0)
 . D EXAC^GMRCADC(GMRCMSG),END
"RTN","GMRCA1",46,0)
 . S GMRCQUT=1
"RTN","GMRCA1",47,0)
 I $G(GMRCSCH),"56"'[$P(GMRC(0),"^",12) D  Q
"RTN","GMRCA1",48,0)
 . S GMRCMSG="This consult may not be scheduled with the current status"
"RTN","GMRCA1",49,0)
 . D EXAC^GMRCADC(GMRCMSG),END
"RTN","GMRCA1",50,0)
 . S GMRCQUT=1
"RTN","GMRCA1",51,0)
 ;
"RTN","GMRCA1",52,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCA1",53,0)
 N GETPROV
"RTN","GMRCA1",54,0)
 S GETPROV=$S($G(GMRCSCH):"Who scheduled it?",1:"Who received it?")
"RTN","GMRCA1",55,0)
 D GETPROV^GMRCAU K GETPROV I $D(GMRCQIT) D END S GMRCQIT="Q",GMRCQUT=1 Q
"RTN","GMRCA1",56,0)
 I '$G(GMRCSCH) S GMRCAD=$$GETDT^GMRCUTL1("Date/Time Actually Received")
"RTN","GMRCA1",57,0)
 I $G(GMRCSCH) S GMRCAD=$$NOW^XLFDT
"RTN","GMRCA1",58,0)
 I GMRCAD="^" D  Q
"RTN","GMRCA1",59,0)
 . W !,$C(7) D EXAC^GMRCADC("Consult not updated with Received action.")
"RTN","GMRCA1",60,0)
 . D END
"RTN","GMRCA1",61,0)
 . S GMRCQUT=1
"RTN","GMRCA1",62,0)
 ;The activity date is stored in GMRCAD
"RTN","GMRCA1",63,0)
 I '$G(GMRCSCH) D
"RTN","GMRCA1",64,0)
 . S GMRCA=21 ;for "Received"
"RTN","GMRCA1",65,0)
 . I $P(GMRC(0),"^",12)=5 S GMRCSTS=6,$P(GMRC(0),"^",12)=GMRCSTS
"RTN","GMRCA1",66,0)
 . E  S GMRCSTS=$P(GMRC(0),"^",12)
"RTN","GMRCA1",67,0)
 I $G(GMRCSCH) S GMRCA=8,GMRCSTS=8
"RTN","GMRCA1",68,0)
 D STATUS^GMRCP
"RTN","GMRCA1",69,0)
 S GMRCOM=1 D AUDIT^GMRCP
"RTN","GMRCA1",70,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCWARD),"SC",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,$G(GMRCAD))
"RTN","GMRCA1",71,0)
 I $G(GMRCSCH),$P(GMRCOM,U,2)=1 D
"RTN","GMRCA1",72,0)
 . N TXT S TXT="Scheduled Consult: "
"RTN","GMRCA1",73,0)
 . D PROCALRT^GMRCACMT(TXT,"",20,GMRCO)
"RTN","GMRCA1",74,0)
 D END
"RTN","GMRCA1",75,0)
 Q
"RTN","GMRCA1",76,0)
 ;
"RTN","GMRCA1",77,0)
RT(GMRCO) ;Results Display logic
"RTN","GMRCA1",78,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCA1",79,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",80,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",81,0)
 D RT^GMRCART(GMRCO)
"RTN","GMRCA1",82,0)
 D END
"RTN","GMRCA1",83,0)
 Q
"RTN","GMRCA1",84,0)
 ;
"RTN","GMRCA1",85,0)
PS(GMRCO) ;Print Service Copy (CPRS entry point)
"RTN","GMRCA1",86,0)
 K GMRCQUT,GMRCQIT,GMRCSEL
"RTN","GMRCA1",87,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCA1",88,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCA1",89,0)
 S GMRC(0)=^GMR(123,GMRCO,0)
"RTN","GMRCA1",90,0)
 D EN^GMRCP5(GMRCO)
"RTN","GMRCA1",91,0)
 D END
"RTN","GMRCA1",92,0)
 Q
"RTN","GMRCA1",93,0)
 ;
"RTN","GMRCA1",94,0)
END ;kill off variables and exit
"RTN","GMRCA1",95,0)
 I $G(GMRCLCK) D UNLOCK(GMRCO)
"RTN","GMRCA1",96,0)
 I '$D(GMRC("NMBR")) K GMRCSEL,GMRCO
"RTN","GMRCA1",97,0)
 K GMRC(0),GMRCA,GMRCACTM,GMRCAGN,GMRCDFN,GMRCENTR,GMRCFL,GMRCIEN,GMRCMSG,GMRCOM,GMRCO,GMRCORFN,GMRCORN,GMRCORTX,GMRCRTFL,GMRCSEL,GMRCSTS,GMRCTRLC,GMRCEND,GMRCSA,GMRCSR,GMRCBM,GMRCTM,GMRCADUZ,ORIFN,OREND,SF,STS
"RTN","GMRCA1",98,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCA1",99,0)
 K DTOUT,DIROUT,DUOUT
"RTN","GMRCA1",100,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCA1",101,0)
 Q
"RTN","GMRCA1",102,0)
LOCK(GMRCIFN) ;;lock a consult record using OE/RR order number
"RTN","GMRCA1",103,0)
 N GMRCORD,GMRCLOCK
"RTN","GMRCA1",104,0)
 S GMRCORD=$P($G(^GMR(123,GMRCIFN,0)),U,3) Q:'GMRCORD 1
"RTN","GMRCA1",105,0)
 S GMRCLOCK=$$LOCK1^ORX2(GMRCORD) I +GMRCLOCK Q 1
"RTN","GMRCA1",106,0)
 ;Q:$G(GMRCGUI)
"RTN","GMRCA1",107,0)
 D EXAC^GMRCADC($P(GMRCLOCK,U,2))
"RTN","GMRCA1",108,0)
 Q 0
"RTN","GMRCA1",109,0)
UNLOCK(GMRCIFN) ;unlock a consult record using OE/RR order number
"RTN","GMRCA1",110,0)
 N GMRCORD
"RTN","GMRCA1",111,0)
 S GMRCORD=$P($G(^GMR(123,GMRCIFN,0)),U,3) Q:'GMRCORD
"RTN","GMRCA1",112,0)
 D UNLK1^ORX2(GMRCORD)
"RTN","GMRCA1",113,0)
 Q
"RTN","GMRCAAC")
0^19^B7153655
"RTN","GMRCAAC",1,0)
GMRCAAC ;SLC/DLT - Administrative Complete action consult logic ;7/16/98  01:47
"RTN","GMRCAAC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12**;DEC 27, 1997
"RTN","GMRCAAC",3,0)
COMP(GMRCO) ;Clerk action to Complete an order
"RTN","GMRCAAC",4,0)
 ;GMRCO is the selected consult
"RTN","GMRCAAC",5,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCAAC",6,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCAAC",7,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAAC",8,0)
 ;
"RTN","GMRCAAC",9,0)
 N GMRC,GMRCSTS,GMRCQUT
"RTN","GMRCAAC",10,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0)) Q:GMRC(0)=""
"RTN","GMRCAAC",11,0)
 ;
"RTN","GMRCAAC",12,0)
 ;Completion action restricted if status is 1,2,or 13
"RTN","GMRCAAC",13,0)
 S GMRCSTS=$P(GMRC(0),"^",12)
"RTN","GMRCAAC",14,0)
 I $S(GMRCSTS<3:1,GMRCSTS=13:1,1:0) D  Q
"RTN","GMRCAAC",15,0)
 . N GMRCMSG
"RTN","GMRCAAC",16,0)
 . S GMRCMSG="This order has already been "_$S(GMRCSTS=1:"discontinued",GMRCSTS=2:"completed",1:"cancelled")_"!"
"RTN","GMRCAAC",17,0)
 . D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCAAC",18,0)
 . S GMRCQUT=1
"RTN","GMRCAAC",19,0)
 . D END
"RTN","GMRCAAC",20,0)
 ;
"RTN","GMRCAAC",21,0)
 ;Get the provider, activity date, and significant findings
"RTN","GMRCAAC",22,0)
 N DFN,ORIFN,ORGY,GMRCSF,GMRCSTS,GMRCA,GMRCDR,GMRCORNP,GMRCAD,GMRCADUZ
"RTN","GMRCAAC",23,0)
 S ORGY="",(GMRCIFN,ORIFN)=$P(GMRC(0),"^",3),GMRCORVP=$P(GMRC(0),"^",2)_";DPT("
"RTN","GMRCAAC",24,0)
 S DFN=+GMRCORVP
"RTN","GMRCAAC",25,0)
 N GETPROV D GETPROV^GMRCAU I $G(GMRCQIT)="Q" D END Q
"RTN","GMRCAAC",26,0)
 S GMRCAD=$$GETDT^GMRCUTL1 I GMRCAD="^" S GMRCQIT="Q" D END Q
"RTN","GMRCAAC",27,0)
 S GMRCSFO=$P(GMRC(0),"^",19)
"RTN","GMRCAAC",28,0)
 S GMRCSF=$$GETSIGF^GMRCASF(GMRCSFO) I GMRCSF=0 D END Q
"RTN","GMRCAAC",29,0)
 ;
"RTN","GMRCAAC",30,0)
 ;Update status, last action and significant findings
"RTN","GMRCAAC",31,0)
 S GMRCSTS=2,GMRCA=10
"RTN","GMRCAAC",32,0)
 S GMRCDR="8////^S X=GMRCSTS;9////^S X=GMRCA;15////^S X=GMRCSF"
"RTN","GMRCAAC",33,0)
 D STATUS^GMRCP
"RTN","GMRCAAC",34,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG) Q
"RTN","GMRCAAC",35,0)
 ;Update the Activity Log for an audit trail
"RTN","GMRCAAC",36,0)
 S GMRCOM=1 D AUDIT^GMRCP
"RTN","GMRCAAC",37,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCAAC",38,0)
 ;
"RTN","GMRCAAC",39,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,$G(GMRCAD))
"RTN","GMRCAAC",40,0)
 S GMRCADUZ=""
"RTN","GMRCAAC",41,0)
 I $P(^GMR(123,GMRCO,0),"^",14) S GMRCADUZ($P(^(0),"^",14))=""
"RTN","GMRCAAC",42,0)
 S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCAAC",43,0)
 D MSG^GMRCP($P(^GMR(123,GMRCO,0),"^",2),GMRCORTX,+GMRCO,23,.GMRCADUZ,0)
"RTN","GMRCAAC",44,0)
 Q
"RTN","GMRCAAC",45,0)
 ;
"RTN","GMRCAAC",46,0)
NOUPD ;Exit without making an update
"RTN","GMRCAAC",47,0)
 S GMRCMSG="Completion activity ignored."
"RTN","GMRCAAC",48,0)
 D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCAAC",49,0)
 Q
"RTN","GMRCAAC",50,0)
END K DUOUT,X,Y,GMRCPL,GMRCPLI,GMRCURG,GMRCURGI,GMRCPRI,XQORM
"RTN","GMRCAAC",51,0)
 I '$D(GMRCNM) K GMRCVP
"RTN","GMRCAAC",52,0)
 K GMRCDT,GMRCAD,GMRCL,GMRCTYPE
"RTN","GMRCAAC",53,0)
 I '$D(GMRCO) S (GMRCO,ORIFN)=""
"RTN","GMRCAAC",54,0)
 K GMRCIFN,GMRCMSG,GMRCORTX,GMRCSA,GMRCSTS,GMRCADUZ,STS
"RTN","GMRCAAC",55,0)
 Q
"RTN","GMRCADC")
0^16^B11031013
"RTN","GMRCADC",1,0)
GMRCADC ;SLC/DLT/DCM - Discontinue Action taken from List Manager ;6/17/98  10:22
"RTN","GMRCADC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,10,12**;DEC 27, 1997
"RTN","GMRCADC",3,0)
EXAC(MSG) ;Exit message asking for user to press <ENTER>; EXAC=Exit Action
"RTN","GMRCADC",4,0)
 N ND
"RTN","GMRCADC",5,0)
 W $C(7),!,MSG I $O(MSG(0)) S ND=0 F  S ND=$O(MSG(ND)) Q:ND=""  W !,MSG(ND)
"RTN","GMRCADC",6,0)
 W !,"Press <RETURN> to continue: " R X:DTIME W !!
"RTN","GMRCADC",7,0)
 Q
"RTN","GMRCADC",8,0)
DC(GMRCO,GMRCA) ;Discontinue a consult logic from DC^GMRCA1
"RTN","GMRCADC",9,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCADC",10,0)
 N GMRCDA,GMRCACTM,GMRCADUZ,GMRCSERV,GMRCAD
"RTN","GMRCADC",11,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCADC",12,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) Q
"RTN","GMRCADC",13,0)
 I '+$G(GMRCO) S GMRCQUT=1 Q
"RTN","GMRCADC",14,0)
 I '$$LOCK^GMRCA1(GMRCO) S GMRCQUT=1 Q
"RTN","GMRCADC",15,0)
 ;
"RTN","GMRCADC",16,0)
 S GMRC(0)=^GMR(123,GMRCO,0),GMRCDA=GMRCO
"RTN","GMRCADC",17,0)
 S (GMRCDFN,DFN)=$P(GMRC(0),"^",2)
"RTN","GMRCADC",18,0)
 I $D(GMRCA),+GMRCA S GMRCACTM=$S(GMRCA=6:"Discontinued",GMRCA=19:"Cancelled",1:$P($G(GMR(123.1,+GMRCA,0)),"^",1))
"RTN","GMRCADC",19,0)
 ;
"RTN","GMRCADC",20,0)
 D PROC I $D(GMRCQUT) D UNLOCK^GMRCA1(GMRCO) S GMRCQUT=1 Q
"RTN","GMRCADC",21,0)
 ;send 513 back to service printer if request DC'd or Cancelled
"RTN","GMRCADC",22,0)
 I GMRCA=6,$$DCPRNT^GMRCUTL1(+GMRCO,DUZ) D
"RTN","GMRCADC",23,0)
 . D PRNT^GMRCUTL1(+$P(GMRC(0),U,5),+GMRCO)
"RTN","GMRCADC",24,0)
 S GMRCTRLC=$S(GMRCA=19:"OC",1:"OD")
"RTN","GMRCADC",25,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),GMRCTRLC,GMRCORNP,$G(GMRCVSIT),.GMRCOM,,$G(GMRCAD))
"RTN","GMRCADC",26,0)
 D UNLOCK^GMRCA1(GMRCO)
"RTN","GMRCADC",27,0)
 Q
"RTN","GMRCADC",28,0)
 ;
"RTN","GMRCADC",29,0)
PROC ;Check validity of action and if valid process the discontinue action
"RTN","GMRCADC",30,0)
 I $P(GMRC(0),"^",12)=1 S GMRCMSG="This consult has already been discontinued!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",31,0)
 I $P(GMRC(0),"^",12)=2 S GMRCMSG="This consult has already been completed!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",32,0)
 I $P(GMRC(0),"^",12)=9 S GMRCMSG="Action invalid. This consult has partial results!",GMRCMSG(1)="Remove the associated results and then discontinue." D EXAC(.GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",33,0)
 I $P(GMRC(0),"^",12)=13 S GMRCMSG="This consult has already been cancelled!" D EXAC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCADC",34,0)
 ;
"RTN","GMRCADC",35,0)
 S GMRCORVP=GMRCDFN_";DPT("
"RTN","GMRCADC",36,0)
 N GETPROV
"RTN","GMRCADC",37,0)
 D GETPROV^GMRCAU I $D(DIROUT)!$D(DTOUT)!$D(DUOUT) S GMRCQUT=1 Q
"RTN","GMRCADC",38,0)
 S GMRCAD=$$GETDT^GMRCUTL1 ;Returns GMRCAD as the entered date
"RTN","GMRCADC",39,0)
 I GMRCAD="^" S GMRCQUT=1 Q
"RTN","GMRCADC",40,0)
 S GMRCSTS=$S(GMRCA=6:1,1:13),$P(GMRC(0),"^",12)=GMRCSTS
"RTN","GMRCADC",41,0)
 S GMRCOM=1
"RTN","GMRCADC",42,0)
 D STATUS^GMRCP
"RTN","GMRCADC",43,0)
 D AUDIT^GMRCP
"RTN","GMRCADC",44,0)
 ;
"RTN","GMRCADC",45,0)
 S GMRCORTX=$S($L($G(GMRCACTM)):GMRCACTM,+GMRCA:$P(^GMR(123.1,GMRCA,0),U,1),1:"ACTION UNKNOWN FOR")_" consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCADC",46,0)
 S GMRCADUZ="",GMRCFL=0
"RTN","GMRCADC",47,0)
 I +$P($G(^GMR(123,+GMRCO,0)),"^",14),+$P(^(0),"^",14)'=DUZ S GMRCADUZ($P(^(0),"^",14))=""
"RTN","GMRCADC",48,0)
 ;I +$P($G(^GMR(123,+GMRCO,0)),"^",14)=DUZ S GMRCFL=1
"RTN","GMRCADC",49,0)
 I GMRCA=6 S GMRCFL=$$DCNOTE(GMRCO,DUZ) ;check NOTIFY SERVICE ON DC
"RTN","GMRCADC",50,0)
 I GMRCA=19 S GMRCFL=1
"RTN","GMRCADC",51,0)
 ;send notification info to routine to be sent to OERR
"RTN","GMRCADC",52,0)
 N NOTYPE S NOTYPE=$S(GMRCA=6:23,1:30)
"RTN","GMRCADC",53,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,NOTYPE,.GMRCADUZ,GMRCFL)
"RTN","GMRCADC",54,0)
 Q
"RTN","GMRCADC",55,0)
DCNOTE(IEN,USER) ;determine if service users receive alerts based on 1.04
"RTN","GMRCADC",56,0)
 N SERV,DCFLG
"RTN","GMRCADC",57,0)
 S SERV=$P(^GMR(123,IEN,0),U,5)
"RTN","GMRCADC",58,0)
 S DCFLG=$P($G(^GMR(123.5,SERV,1)),U,4)
"RTN","GMRCADC",59,0)
 I 'DCFLG Q 1
"RTN","GMRCADC",60,0)
 I DCFLG=2 Q 0
"RTN","GMRCADC",61,0)
 I DCFLG=1,'$$VALID^GMRCAU(SERV,IEN,USER) Q 1
"RTN","GMRCADC",62,0)
 Q 0
"RTN","GMRCAFRD")
0^15^B31938577
"RTN","GMRCAFRD",1,0)
GMRCAFRD ;SLC/DLT,DCM - Forward Req (FR) Action from Review Screen ;7/16/98  01:48
"RTN","GMRCAFRD",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,10,12**;DEC 27, 1997
"RTN","GMRCAFRD",3,0)
FR(GMRCO) ;Forward Request to a new service
"RTN","GMRCAFRD",4,0)
 N ORVP,GMRCLCK
"RTN","GMRCAFRD",5,0)
 W !!,"Forward Request To Another Service For Action."
"RTN","GMRCAFRD",6,0)
 W !,"Select the service to send the consult to.",!
"RTN","GMRCAFRD",7,0)
 S:$D(GMRCSS) GMRCSSS=GMRCSS
"RTN","GMRCAFRD",8,0)
 N GMRCPL,GMRCPR,GMRCURG,GMRCDG,GMRCFF,GMRCORNP,GMRCAD,GMRCTO,GMRCADUZ
"RTN","GMRCAFRD",9,0)
 K GMRCQUT,GMRCSEL
"RTN","GMRCAFRD",10,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCAFRD",11,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",12,0)
 I '$$LOCK^GMRCA1(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",13,0)
 S GMRCLCK=1
"RTN","GMRCAFRD",14,0)
 ;
"RTN","GMRCAFRD",15,0)
 I $P(^GMR(123,GMRCO,0),"^",12)<3 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Completed Or Discontinued." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",16,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=13 S GMRCMSG="NO ACTION POSSIBLE. This Consult Has Already Been Cancelled." D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",17,0)
 I $P(^GMR(123,GMRCO,0),"^",12)=9 D  Q:+$G(GMRCQUT)
"RTN","GMRCAFRD",18,0)
 .S GMRCMSG="Invalid action. This consult has partial results."
"RTN","GMRCAFRD",19,0)
 .S GMRCMSG(1)="Remove the associated results before forwarding."
"RTN","GMRCAFRD",20,0)
 .D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",21,0)
 ;
"RTN","GMRCAFRD",22,0)
 I $D(IOBM),$D(IOTM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCAFRD",23,0)
 I $P(^GMR(123,GMRCO,0),"^",16) W !!,"This is a SERVICE ENTERED order stub.  Please send the written consult to the",!,"Service, in addition to the automated forwarding!"
"RTN","GMRCAFRD",24,0)
 S DFN=+$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCAFRD",25,0)
 S GMRCTO=1,GMRCASV="Forward Consult To Which Service/Specialty: "
"RTN","GMRCAFRD",26,0)
 D ASRV^GMRCASV K GMRCASV I $S($D(DTOUT):1,$D(DIROUT):1,$D(GMRCQUT):1,1:0) D END Q
"RTN","GMRCAFRD",27,0)
 I 'GMRCDG S GMRCMSG="No Service Was Selected. Consult Was Not Forwarded To Any Service!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",28,0)
 S GMRCFF=$P(^GMR(123,GMRCO,0),"^",5) I GMRCFF=+GMRCDG S GMRCMSG="The Forwarding Service Cannot Forward A Consult To Itself!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",29,0)
 S GETPROV="Who is responsible for Forwarding the Consult?"
"RTN","GMRCAFRD",30,0)
 D GETPROV^GMRCAU I '$D(GMRCORNP) D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",31,0)
 S GMRCAD=$$GETDT^GMRCUTL1 I GMRCAD="^" D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",32,0)
 I '$G(GMRCAD) S GMRCAD=$$NOW^XLFDT
"RTN","GMRCAFRD",33,0)
 N GMRCSS,GMRCSSNM,GMRCA,GMRCMSG
"RTN","GMRCAFRD",34,0)
 D DEFAULT
"RTN","GMRCAFRD",35,0)
 S GMRCSS=+GMRCDG
"RTN","GMRCAFRD",36,0)
 I +GMRCSS,'$D(^GMR(123.5,+GMRCSS,0)) S GMRCMSG="Error in Service Chosen - SERVICE Does Not Exist!" D EXAC^GMRCADC(GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",37,0)
 S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSS,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSS,0)),U,1))
"RTN","GMRCAFRD",38,0)
 D URG I $D(GMRCEND),GMRCEND D END S GMRCQUT=1 Q
"RTN","GMRCAFRD",39,0)
 S GMRCA=17,DIE="^GMR(123,",DA=GMRCO,ORSTS=5
"RTN","GMRCAFRD",40,0)
 S DR="1////^S X=GMRCSS;5////^S X=GMRCURGI;8////^S X=ORSTS;9////^S X=GMRCA;.1///@"
"RTN","GMRCAFRD",41,0)
 L +^GMR(123,GMRCO):2 I '$T K DIE,DA,DR S GMRCMSG="Another User Is Accessing This Record. UPDATE WAS UNSUCCESSFUL.",GMRCMSG(1)="Try Again Later." D EXAC^GMRCADC(.GMRCMSG),END S GMRCQUT=1 Q
"RTN","GMRCAFRD",42,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCAFRD",43,0)
 S GMRCOM=1 D AUDIT^GMRCP ;GMRCORNP is the responsible provider here
"RTN","GMRCAFRD",44,0)
 ;
"RTN","GMRCAFRD",45,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(GMRCO) ;unlk before FWD changes order #
"RTN","GMRCAFRD",46,0)
 ;
"RTN","GMRCAFRD",47,0)
FRMSG ; Common logic used by GUI and List Manager to process the HL7 message
"RTN","GMRCAFRD",48,0)
 ; to update the order in OE/RR and then forward an alert to recipients
"RTN","GMRCAFRD",49,0)
 ; is passed in as the DUZ instead of the responsible provider
"RTN","GMRCAFRD",50,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),"XX^FORWARD",$G(DUZ),$G(VISIT),.GMRCOM,,$G(GMRCAD))
"RTN","GMRCAFRD",51,0)
 S GMRCADUZ=""
"RTN","GMRCAFRD",52,0)
 S GMRCORNP=$P(^GMR(123,GMRCO,0),"^",14) ;This is the original provider that ordered the consult
"RTN","GMRCAFRD",53,0)
 I +$G(GMRCORNP) S GMRCADUZ(+GMRCORNP)="" ;alert original provider of forward
"RTN","GMRCAFRD",54,0)
 S GMRCORTX="Forwarded consult "_$$ORTX^GMRCAU(+GMRCO)_" ("_GMRCURG_")"
"RTN","GMRCAFRD",55,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,1) ;GMRCO=IEN of consult from file 123; 27 is notification entry from file ORD(100.9
"RTN","GMRCAFRD",56,0)
 K GMRCOM
"RTN","GMRCAFRD",57,0)
 S GMRCDEV=$P($G(^GMR(123.5,GMRCSS,123)),"^",9)
"RTN","GMRCAFRD",58,0)
 I GMRCDEV D PRNT^GMRCUTL1(GMRCSS,+GMRCO)
"RTN","GMRCAFRD",59,0)
 D END
"RTN","GMRCAFRD",60,0)
 Q
"RTN","GMRCAFRD",61,0)
URG ;Get the default urgency
"RTN","GMRCAFRD",62,0)
 N X,Y,XQORM,DIROUT,DTOUT,DIRUT,DUOUT
"RTN","GMRCAFRD",63,0)
 I $P(^GMR(123,+GMRCO,0),"^",18)["I" D
"RTN","GMRCAFRD",64,0)
 .I GMRCTYPE="GMRCOR CONSULT" S X="GMRCURGENCYM CSLT - INPATIENT"
"RTN","GMRCAFRD",65,0)
 .S X="GMRCURGENCYM REQ - INPATIENT"
"RTN","GMRCAFRD",66,0)
 E  S X="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCAFRD",67,0)
 I '$D(GMRCURG) S GMRCURGI=$O(^ORD(101,"B","GMRCURGENCY - ROUTINE","")) S:+GMRCURGI GMRCURG=$P($G(^ORD(101,+GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",68,0)
 S Y=$O(^ORD(101,"B",X,""))
"RTN","GMRCAFRD",69,0)
 S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Urgency: ",XQORM("NO^^")=""
"RTN","GMRCAFRD",70,0)
 S:$L(GMRCURG) XQORM("B")=GMRCURG D EN^XQORM I X="^"!($D(DIROUT)) K XQORM S GMRCEND=1 Q
"RTN","GMRCAFRD",71,0)
 K XQORM(0),XQORM("A"),XQORM("B"),XQORM("NO^^") S XQORM=""
"RTN","GMRCAFRD",72,0)
 I '$D(Y) S GMRCEND=1 Q
"RTN","GMRCAFRD",73,0)
 I $D(Y(1)) S GMRCURG=$P(Y(1),"^",3),GMRCURGI=$P(Y(1),"^",2)
"RTN","GMRCAFRD",74,0)
 Q
"RTN","GMRCAFRD",75,0)
DEFAULT ;Set up defaults for editing to be equal to the existing data.
"RTN","GMRCAFRD",76,0)
 D DEM^GMRCU
"RTN","GMRCAFRD",77,0)
 N GMRC,GMRCDIC,GMRCPLI,GMRCPRI
"RTN","GMRCAFRD",78,0)
 Q:'$D(GMRCO)  S (GMRCSS,GMRCSSNM,GMRCPL,GMRCPR,GMRCPRI,GMRCURG)=""
"RTN","GMRCAFRD",79,0)
 S GMRCOM=0,GMRC(0)=$S($D(^GMR(123,+GMRCO,0)):^(0),1:"")
"RTN","GMRCAFRD",80,0)
 S GMRCSS=$P(GMRC(0),"^",5) I +GMRCSS,$D(^GMR(123.5,+GMRCSS,0)) S GMRCSSNM=$S($L($P($G(^GMR(123.5,+GMRCSS,0)),U,1)):$P(^(0),U,1),1:"")
"RTN","GMRCAFRD",81,0)
 S GMRCPLI=$P(GMRC(0),"^",10) I GMRCPLI S GMRCPL=$P($G(^ORD(101,GMRCPLI,0)),"^",2)
"RTN","GMRCAFRD",82,0)
 S GMRCURGI=$P(GMRC(0),"^",9) I GMRCURGI S GMRCURG=$P($G(^ORD(101,GMRCURGI,0)),"^",2)
"RTN","GMRCAFRD",83,0)
 S GMRCPRI=$P(GMRC(0),"^",8),GMRCDIC=$P(GMRCPRI,";",2) I $L(GMRCDIC) S GMRCDIC="^"_GMRCDIC_$P(GMRCPRI,";")_",0)",GMRCPR=$S($D(@(GMRCDIC)):$P(^(0),"^",2),1:"")
"RTN","GMRCAFRD",84,0)
TYPE ;This entry point is used when the only default needed is the GMRCTYPE
"RTN","GMRCAFRD",85,0)
 ;Called by GMRCGUIA to get variables ready for FRMSG call.
"RTN","GMRCAFRD",86,0)
 S GMRCTYPE=$P($G(^GMR(123,+GMRCO,0)),"^",17),GMRCTYPE=$S('GMRCTYPE:"GMRCOR CONSULT",1:$P($G(^ORD(101,GMRCTYPE,0)),"^"))
"RTN","GMRCAFRD",87,0)
 Q
"RTN","GMRCAFRD",88,0)
END ;Kill off variables and exit
"RTN","GMRCAFRD",89,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(GMRCO)
"RTN","GMRCAFRD",90,0)
 K GETPROV,GMRCDG,GMRCDEV,GMRCEND,GMRCFF,GMRCOM,GMRCIFN,GMRCO,GMRCORNP
"RTN","GMRCAFRD",91,0)
 K GMRCTYPE,GMRCORTX,GMRCPL,GMRCPR,GMRCSEL,GMRCURG,GMRCADUZ,Y
"RTN","GMRCAFRD",92,0)
 K DTOUT,DIROUT,DUOUT
"RTN","GMRCAFRD",93,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCAFRD",94,0)
 Q
"RTN","GMRCASV")
0^22^B58747088
"RTN","GMRCASV",1,0)
GMRCASV ;SLC/KCM,DLT - Build ^TMP("GMRCS" of Svc(s)/Specialties ;5/20/98  14:20
"RTN","GMRCASV",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,12**;DEC 27, 1997
"RTN","GMRCASV",3,0)
ASRV ;Ask for service/specialty group {output} GMRCDG,GMRCBUF,GMRCACT,^TMP("GMRCS",$J,^TMP("GMRCSLIST",$J
"RTN","GMRCASV",4,0)
 K GMRCQUT
"RTN","GMRCASV",5,0)
 N GMRCSEL
"RTN","GMRCASV",6,0)
 D SERV0 D:GMRCDG SERV1
"RTN","GMRCASV",7,0)
 K W,X,Y Q
"RTN","GMRCASV",8,0)
SERV0 ;Assume that the lookup must begin with ALL SERVICES, or value of GMRCSVNM
"RTN","GMRCASV",9,0)
 ;GMRCASV=the ask prompt text
"RTN","GMRCASV",10,0)
 ;GMRCSVNM=text to use for default name
"RTN","GMRCASV",11,0)
 S GMRCDG=0
"RTN","GMRCASV",12,0)
 S:$G(GMRCASV)["Forward" GMRCTO=1
"RTN","GMRCASV",13,0)
 F  D ASKPRMPT S:X["^^" DIROUT=1 S:X["^" GMRCQUT=1 Q:X["^"  D @$S(X["?":"LISTALL",1:"LKUP") D:($L($G(GMRCSVNM))&GMRCDG) LISTSRV Q:GMRCDG
"RTN","GMRCASV",14,0)
 Q
"RTN","GMRCASV",15,0)
ASKPRMPT ;Write the prompt and do the Read to get the user text entered in X
"RTN","GMRCASV",16,0)
 W !!,$S($D(GMRCASV):GMRCASV,1:"Select Service/Specialty: ")_$S($L($G(GMRCSVNM)):GMRCSVNM,1:"ALL SERVICES")_"// "
"RTN","GMRCASV",17,0)
 R X:DTIME
"RTN","GMRCASV",18,0)
 I '$T S X="^"
"RTN","GMRCASV",19,0)
 I X'["^" S X=$S($G(GMRCASV)["Forward"&('$L(X)):"^",'$L(X):"ALL SERVICES",1:X) Q
"RTN","GMRCASV",20,0)
 Q
"RTN","GMRCASV",21,0)
SERV1 ;Create selected SERVICE ^TMP array of service information
"RTN","GMRCASV",22,0)
 ;If GMRCTO=1 then the BILD section will not include disabled or tracking services which the user cannot send to.
"RTN","GMRCASV",23,0)
 N GMRCDGT
"RTN","GMRCASV",24,0)
 S GMRCBUF=GMRCDG
"RTN","GMRCASV",25,0)
 I GMRCBUF>0 D
"RTN","GMRCASV",26,0)
 . K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCASV",27,0)
 . S GMRCDGT=0,GMRCSEL="BILD" D EN
"RTN","GMRCASV",28,0)
 . S GMRCGRP("NAM")=^GMR(123.5,GMRCBUF,0)
"RTN","GMRCASV",29,0)
 . S (GMRCDG,GMRCGRP("ROOT"))=GMRCBUF
"RTN","GMRCASV",30,0)
 . S GMRCGRP("NAM")=$S($L($P(GMRCGRP("NAM"),"^",3)):$P(GMRCGRP("NAM"),"^",3),1:$E($P(GMRCGRP("NAM"),"^"),1,5))
"RTN","GMRCASV",31,0)
 K GMRCSEQ,GMRCBUF
"RTN","GMRCASV",32,0)
 Q
"RTN","GMRCASV",33,0)
LKUP ;Ask the user for the service; use the value of x for lookup; branch to list on ??
"RTN","GMRCASV",34,0)
 S DIC="^GMR(123.5,",DIC(0)="MNEQZ",DIC("W")="W ""   "",$P(Y,""^"",2)"
"RTN","GMRCASV",35,0)
 D ^DIC K DIC I '$D(Y(0)) D LISTALL Q
"RTN","GMRCASV",36,0)
 N W,GMRCEXCL I +$G(GMRCTO) D
"RTN","GMRCASV",37,0)
 . S W=Y(0),GMRCDG=+Y
"RTN","GMRCASV",38,0)
 . S GMRCEXCL=0 D EXCLUDE
"RTN","GMRCASV",39,0)
 . I GMRCEXCL=1 S GMRCSVNM=Y(0,0),GMRCEXCL=0 Q
"RTN","GMRCASV",40,0)
 . K GMRCSVNM ;Service selected is not a grouper for lookup
"RTN","GMRCASV",41,0)
 . I GMRCEXCL=9 S GMRCMSG="You have selected a disabled service!" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",42,0)
 . N GMRCDAD D CHECKDAD
"RTN","GMRCASV",43,0)
 . I GMRCEXCL=90 S GMRCMSG="You have selected a service that is not part of the ALL SERVICES heirarchy!",GMRCMSG(1)="Contact Consult ADPAC" D EXAC^GMRCADC(.GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",44,0)
 . I GMRCEXCL=9 S GMRCMSG="You have selected a service whose parent is disabled!" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",45,0)
 . I GMRCEXCL=2 S GMRCMSG="You have selected a service whose parent is a tracking service!",GMRCMSG(1)="You do not have authorization to send consults to this service." D EXAC^GMRCADC(.GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",46,0)
 I +$G(GMRCEXCL) S Y=0,GMRCDG=0
"RTN","GMRCASV",47,0)
 S:Y>0 GMRCDG=+Y ;falls to here when service is a grouper or not excluded
"RTN","GMRCASV",48,0)
 Q
"RTN","GMRCASV",49,0)
 ;
"RTN","GMRCASV",50,0)
QUEUE ; queue up the print
"RTN","GMRCASV",51,0)
 N ZTRTN,ZTSK,ZTIO,ZTDTH,ZTDESC
"RTN","GMRCASV",52,0)
 S ZTRTN="PRTLST^GMRCASV",ZTDESC="Consult Service Hierarchy List"
"RTN","GMRCASV",53,0)
 S ZTIO=ION,ZTDTH=$H
"RTN","GMRCASV",54,0)
 D ^%ZTLOAD
"RTN","GMRCASV",55,0)
 I $G(ZTSK) W !,"Queued to Print, Task # ",ZTSK
"RTN","GMRCASV",56,0)
 E  W !,"Sorry, Try again Later"
"RTN","GMRCASV",57,0)
 Q
"RTN","GMRCASV",58,0)
 ;
"RTN","GMRCASV",59,0)
LISTOPT ;called from option to list hierarchy
"RTN","GMRCASV",60,0)
 S %ZIS="Q"
"RTN","GMRCASV",61,0)
 D ^%ZIS I POP Q
"RTN","GMRCASV",62,0)
 I $D(IO("Q")) D QUEUE D ^%ZISC,HOME^%ZIS Q
"RTN","GMRCASV",63,0)
 D PRTLST
"RTN","GMRCASV",64,0)
 D ^%ZISC,HOME^%ZIS
"RTN","GMRCASV",65,0)
 Q
"RTN","GMRCASV",66,0)
 ;
"RTN","GMRCASV",67,0)
PRTLST ;queued entry point or just print it
"RTN","GMRCASV",68,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","GMRCASV",69,0)
 U IO
"RTN","GMRCASV",70,0)
 N GMRCPRT,GMRCPG,GMRCTO,GMRCDG,GMRCOUT
"RTN","GMRCASV",71,0)
 N DUOUT,DTOUT,DIROUT
"RTN","GMRCASV",72,0)
 S GMRCPG=0,GMRCPRT=1
"RTN","GMRCASV",73,0)
 D PAGE(.GMRCPG)
"RTN","GMRCASV",74,0)
 D LISTALL I $D(GMRCOUT) Q
"RTN","GMRCASV",75,0)
 I $Y>(IOSL-4) D READ I $D(GMRCOUT) Q
"RTN","GMRCASV",76,0)
 W !!,"Services not currently part of the Consults Hierarchy:"
"RTN","GMRCASV",77,0)
 N SERV S SERV=1
"RTN","GMRCASV",78,0)
 F  S SERV=$O(^GMR(123.5,SERV)) Q:'SERV  Q:$D(GMRCOUT)  D
"RTN","GMRCASV",79,0)
 . I '$D(^GMR(123.5,"APC",SERV)) D
"RTN","GMRCASV",80,0)
 .. I $Y>(IOSL-4) D READ I $D(GMRCOUT) Q
"RTN","GMRCASV",81,0)
 .. W !,?3,$P(^GMR(123.5,SERV,0),U) I '$P(^(0),U,2) Q
"RTN","GMRCASV",82,0)
 .. N USE S USE=$P(^GMR(123.5,SERV,0),U,2)
"RTN","GMRCASV",83,0)
 .. W "  ("
"RTN","GMRCASV",84,0)
 .. W $S(USE=1:"Grouper Only",USE=9:"Disabled",1:"Tracking Only")_")"
"RTN","GMRCASV",85,0)
 K GMRCDG D EXIT
"RTN","GMRCASV",86,0)
 Q
"RTN","GMRCASV",87,0)
LISTALL ;display LIST of Services in their heirarchy beginning with ALL SERVICES
"RTN","GMRCASV",88,0)
 S GMRCDG=$O(^GMR(123.5,"B","ALL SERVICES",0)) Q:'GMRCDG
"RTN","GMRCASV",89,0)
 S GMRCSEL="DISP" W:'$D(GMRCPRT) @IOF D EN
"RTN","GMRCASV",90,0)
 S GMRCDG=0 W !
"RTN","GMRCASV",91,0)
 Q
"RTN","GMRCASV",92,0)
LISTSRV ;display LIST of sub-services beginning with a selected service
"RTN","GMRCASV",93,0)
 S GMRC1=0,GMRCDG=$O(^GMR(123.5,"B",GMRCSVNM,0)) Q:'GMRCDG
"RTN","GMRCASV",94,0)
 S GMRCSEL="DISP" W @IOF D EN
"RTN","GMRCASV",95,0)
 S GMRCDG=0 W !
"RTN","GMRCASV",96,0)
 Q
"RTN","GMRCASV",97,0)
EN ;Setup Specialty groups   entry: GMRCDG,GMRCSEL   exit: GMRCGRP if GMRCSEL="BILD"
"RTN","GMRCASV",98,0)
 N GMRCSTK,PARENT,GMRCUSG,GMRCEXCL
"RTN","GMRCASV",99,0)
 S GMRCSTK=0,PARENT=0 ;beginning service logic
"RTN","GMRCASV",100,0)
 D @GMRCSEL Q:$D(DUOUT)!($D(DIROUT))!($D(GMRCOUT))
"RTN","GMRCASV",101,0)
EN1 ;GMRCSTK is used to manage the level of stacks under beginning service
"RTN","GMRCASV",102,0)
 S GMRCSTK=1,GMRCSTK(GMRCSTK)=GMRCDG_"^0",GMRCSTK(0)=0,GMRCMEM=0,GMRCNAM=""
"RTN","GMRCASV",103,0)
 F  S GMRCNAM=$O(^GMR(123.5,+GMRCSTK(GMRCSTK),10,"AC",GMRCNAM)) D  D @$S(+GMRCMEM'>0:"POP",1:"PROC") Q:GMRCSTK<1
"RTN","GMRCASV",104,0)
 . I $G(GMRCEXCL) S GMRCMEM=0 Q  ;Exclude children of excluded parent
"RTN","GMRCASV",105,0)
 . I '$L(GMRCNAM) S GMRCMEM=0 ;No more 10th node children
"RTN","GMRCASV",106,0)
 . E  S GMRCMEM=$O(^GMR(123.5,+GMRCSTK(GMRCSTK),10,"AC",GMRCNAM,""))
"RTN","GMRCASV",107,0)
 K DUOUT,GMRCMEM,GMRCNAM,GMRCSTK,GMRCSEL
"RTN","GMRCASV",108,0)
 Q
"RTN","GMRCASV",109,0)
POP ;Go back one level in service stack heirarchy and initialize exclude
"RTN","GMRCASV",110,0)
 S GMRCSTK=GMRCSTK-1,GMRCMEM=$P(GMRCSTK(GMRCSTK),"^",2),GMRCNAM=$P(GMRCSTK(GMRCSTK),"^",3),GMRCEXCL=0
"RTN","GMRCASV",111,0)
 Q
"RTN","GMRCASV",112,0)
PROC ;GMRCMEM is the member ien in the 10th node being processed
"RTN","GMRCASV",113,0)
 ;GMRCDG is the ien of file 123.5 being processed
"RTN","GMRCASV",114,0)
 ;GMRCNAM is the services name
"RTN","GMRCASV",115,0)
 S $P(GMRCSTK(GMRCSTK),"^",2)=GMRCMEM
"RTN","GMRCASV",116,0)
 S $P(GMRCSTK(GMRCSTK),"^",3)=GMRCNAM
"RTN","GMRCASV",117,0)
 S GMRCDG=$P(^GMR(123.5,+GMRCSTK(GMRCSTK),10,GMRCMEM,0),"^",1)
"RTN","GMRCASV",118,0)
 S PARENT=+GMRCSTK(GMRCSTK)
"RTN","GMRCASV",119,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",120,0)
 I $G(GMRCTO)=1 S GMRCEXCL=0 D EXCLUDE S:GMRCEXCL=1 GMRCEXCL=0 ;Includes grouper only
"RTN","GMRCASV",121,0)
 D:'+$G(GMRCEXCL) @GMRCSEL G:($D(DUOUT)!$D(DIROUT)) EXIT
"RTN","GMRCASV",122,0)
 ;Initialize a stack level entry to process children of the multiple
"RTN","GMRCASV",123,0)
 S GMRCSTK=GMRCSTK+1,GMRCSTK(GMRCSTK)=GMRCDG_"^0",GMRCMEM=0,GMRCNAM=""
"RTN","GMRCASV",124,0)
 Q
"RTN","GMRCASV",125,0)
DISP ;Display individual entries alphabetically for each service as processed
"RTN","GMRCASV",126,0)
 Q:$D(GMRCOUT)
"RTN","GMRCASV",127,0)
 I $Y>(IOSL-4) D READ S:$D(DUOUT)!($D(DIROUT)) GMRCSTK=0 G:GMRCSTK=0 EXIT
"RTN","GMRCASV",128,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",129,0)
 S GMRCUSG=$P(W,"^",2)
"RTN","GMRCASV",130,0)
 W !,?((GMRCSTK*2)),$S(GMRCUSG=9:"<",1:"")_$P(W,"^")_$S(GMRCUSG=9:">",1:"")_"  "_$S(GMRCUSG=1:"(Grouper Only)",GMRCUSG=2:"(Tracking Only)",GMRCUSG=9:"<Disabled>",1:"")
"RTN","GMRCASV",131,0)
 Q
"RTN","GMRCASV",132,0)
BILD ;The following logic will build an array for review for GUI
"RTN","GMRCASV",133,0)
 ;GMRCDGT=sequential number,GMRCDG=service pointer,
"RTN","GMRCASV",134,0)
 ;W=^GMR(123.5,GMRCDG,0),1st piece is name, 2nd piece usage
"RTN","GMRCASV",135,0)
 ;If GMRCTO=1 then services that only consults can be sent to will be
"RTN","GMRCASV",136,0)
 ;included with the exception of "grouper only" which keeps the
"RTN","GMRCASV",137,0)
 ;heirarchy in order.
"RTN","GMRCASV",138,0)
 N CHILD
"RTN","GMRCASV",139,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",140,0)
 S ^TMP("GMRCS",$J,GMRCDG)=$P(W,"^")
"RTN","GMRCASV",141,0)
 S GMRCDGT=GMRCDGT+1
"RTN","GMRCASV",142,0)
 S CHILD=$O(^GMR(123.5,GMRCDG,10,0)) S CHILD=$S(+CHILD:"+",1:"")
"RTN","GMRCASV",143,0)
 S ^TMP("GMRCSLIST",$J,GMRCDGT)=GMRCDG_U_$P(W,"^")_U_PARENT_U_CHILD_U_$P(W,"^",2)
"RTN","GMRCASV",144,0)
 Q
"RTN","GMRCASV",145,0)
EXCLUDE ;This logic excludes services the user cannot send a consult to.
"RTN","GMRCASV",146,0)
 ;If GMRCTO=1 the user is forwarding or sending a consult
"RTN","GMRCASV",147,0)
 ;W=zeroth node of service,GMRCDG=ien of service,GMRCO=ien of consult (optional)
"RTN","GMRCASV",148,0)
 Q:'$L($G(W))
"RTN","GMRCASV",149,0)
 S GMRCEXCL=+$P(W,"^",2) ;Include grouper for heirarchy building only
"RTN","GMRCASV",150,0)
 I GMRCEXCL=2 D  ;tracking service exclusion check
"RTN","GMRCASV",151,0)
 . N GMRCSRV I +$G(GMRCO) S GMRCSRV=$P($G(^GMR(123,+GMRCO,0)),"^",5) I $D(^GMR(123.5,"APC",+GMRCDG,+GMRCSRV)) S GMRCEXCL=0 Q  ;Checks if parent is the consults current service
"RTN","GMRCASV",152,0)
 . I $D(^GMR(123.5,+GMRCDG,123.3,"B",DUZ)) S GMRCEXCL=0  ;Assumes user updates selected service
"RTN","GMRCASV",153,0)
 . Q
"RTN","GMRCASV",154,0)
 Q
"RTN","GMRCASV",155,0)
CHECKDAD ;Check the service usage statuses for a selected services parents
"RTN","GMRCASV",156,0)
 ;There are two passes, one to get any user accessable parent
"RTN","GMRCASV",157,0)
 ;and the second pass is through the GMRCDAD array to check the parents usage
"RTN","GMRCASV",158,0)
 ;The GMRCEXCL value is returned for exclusion due to parent
"RTN","GMRCASV",159,0)
 S GMRCDAD=""
"RTN","GMRCASV",160,0)
 ;FIRST PASS
"RTN","GMRCASV",161,0)
 F  S GMRCDAD=$O(^GMR(123.5,"APC",+GMRCDG,GMRCDAD)) Q:GMRCDAD=""  D  I $P($G(GMRCDAD(+GMRCDAD)),U,2)="OK" S GMRCEXCL="OK"
"RTN","GMRCASV",162,0)
 . S GMRCDAD(+GMRCDAD)=$P(^GMR(123.5,+GMRCDAD,0),U,2) ;dads service usage
"RTN","GMRCASV",163,0)
 . I $P($G(^GMR(123.5,+GMRCDAD,0)),U,1)="ALL SERVICES" S $P(GMRCDAD(GMRCDAD),U,2,3)="OK^ALL" Q  ;If one of the dad's is all services, than OK to send to if not previously excluded.
"RTN","GMRCASV",164,0)
 . I GMRCDAD(+GMRCDAD)=1 S $P(GMRCDAD(+GMRCDAD),"^",2)="OK" Q  ;Groupers Only are OK!
"RTN","GMRCASV",165,0)
 . I $D(^GMR(123.5,+GMRCDAD,123.3,"B",DUZ)) S $P(GMRCDAD(GMRCDAD),U,2,3)="OK^Update access" Q
"RTN","GMRCASV",166,0)
 . Q
"RTN","GMRCASV",167,0)
 I GMRCEXCL="OK" S GMRCEXCL=0 Q  ;There is a parent which user has access to.
"RTN","GMRCASV",168,0)
 ;Second Pass of the GMRCDAD array (multiple parents)
"RTN","GMRCASV",169,0)
 S GMRCDAD=$O(GMRCDAD("")) I 'GMRCDAD S GMRCEXCL=90 Q  ;Not part of heirarchy; missing dad
"RTN","GMRCASV",170,0)
 ;Use first parent found in heirarchy.
"RTN","GMRCASV",171,0)
 S GMRCEXCL=+GMRCDAD(GMRCDAD)
"RTN","GMRCASV",172,0)
 Q
"RTN","GMRCASV",173,0)
READ ;;Hold screen
"RTN","GMRCASV",174,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","GMRCASV",175,0)
 W ! I $D(IOSL),$Y<(IOSL-4) G READ
"RTN","GMRCASV",176,0)
 N X W !?5,"Press RETURN to continue, ^ to exit: " R X:DTIME
"RTN","GMRCASV",177,0)
 S:X="^" DUOUT=1 S:'$T!(X="^^") DIROUT=1
"RTN","GMRCASV",178,0)
 I $D(DUOUT)!$D(DIROUT) S:$D(GMRCPRT) GMRCOUT=1
"RTN","GMRCASV",179,0)
 W @IOF
"RTN","GMRCASV",180,0)
 I '$D(DTOUT),('$D(DUOUT))&($D(GMRCPRT)) D PAGE(.GMRCPG)
"RTN","GMRCASV",181,0)
 Q
"RTN","GMRCASV",182,0)
PAGE(PG) ;print header and increment page
"RTN","GMRCASV",183,0)
 S PG=PG+1
"RTN","GMRCASV",184,0)
 W !,"Consult Hierarchy list",?60,"Page: ",PG
"RTN","GMRCASV",185,0)
 W !,$$REPEAT^XLFSTR("-",78)
"RTN","GMRCASV",186,0)
 Q
"RTN","GMRCASV",187,0)
EXIT ;Kill off variables and quit
"RTN","GMRCASV",188,0)
 K DIROUT,DUOUT,DTOUT,DIRUT
"RTN","GMRCASV",189,0)
 Q
"RTN","GMRCAU")
0^30^B52026948
"RTN","GMRCAU",1,0)
GMRCAU ;SLC/DLT,JFR - Action Utilities  ;9/8/98  03:33
"RTN","GMRCAU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,11,14,12**;DEC 27, 1997
"RTN","GMRCAU",3,0)
GETPROV K GMRCORNP N DIR S DIR(0)="123.02,3"
"RTN","GMRCAU",4,0)
 S DIR("A")=$S($D(GETPROV):GETPROV,1:"Responsible Clinician")
"RTN","GMRCAU",5,0)
 D ^DIR K DIR I $D(DTOUT)!$D(DIROUT)!(X="^") S GMRCQIT="Q" Q
"RTN","GMRCAU",6,0)
 G:Y<1 GETPROV S GMRCORNP=+Y
"RTN","GMRCAU",7,0)
 Q
"RTN","GMRCAU",8,0)
GETDT ;Get actual activity date
"RTN","GMRCAU",9,0)
 K GMRCQIT
"RTN","GMRCAU",10,0)
 D NOW^%DTC S (X,GMRCDT)=% D REGDTM^GMRCU S GMRCAD=X
"RTN","GMRCAU",11,0)
 S DIR(0)="123.02,2",DIR("A")=$S($D(GETDT):GETDT,1:"Date/Time of Actual Activity"),DIR("B")="NOW" D ^DIR K DIR I $D(DIRUT) S GMRCQIT="Q" Q
"RTN","GMRCAU",12,0)
 I X="NOW" K GMRCAD,Y Q
"RTN","GMRCAU",13,0)
 S GMRCAD=Y K X,Y,DIRUT,DUOUT
"RTN","GMRCAU",14,0)
 Q
"RTN","GMRCAU",15,0)
ORTX(GMRCO) ;Get the abbreviated text for alert displays
"RTN","GMRCAU",16,0)
 ;GMRCO is the consult entry from 123
"RTN","GMRCAU",17,0)
 N GMRCSVC,GMRCSSNM,GMRCPROC,GMRCORTX
"RTN","GMRCAU",18,0)
 S GMRCSSNM=$$SVC(GMRCO)
"RTN","GMRCAU",19,0)
 S GMRCPROC=$$PROC(GMRCO)
"RTN","GMRCAU",20,0)
 S GMRCORTX=$S($L(GMRCPROC):($E(GMRCSSNM,1,10)_" "_$E(GMRCPROC,1,10)),1:$E(GMRCSSNM,1,20))
"RTN","GMRCAU",21,0)
 Q GMRCORTX
"RTN","GMRCAU",22,0)
 ;
"RTN","GMRCAU",23,0)
SVC(GMRCO) ;Get abbreviated service text
"RTN","GMRCAU",24,0)
 N GMRCSSNM,GMRCSVC
"RTN","GMRCAU",25,0)
 S GMRCSVC=$P(^GMR(123,+GMRCO,0),"^",5),GMRCSSNM=""
"RTN","GMRCAU",26,0)
 I +GMRCSVC S GMRCSSNM=$S($L($G(^GMR(123.5,+GMRCSVC,.1))):^(.1),1:$P($G(^GMR(123.5,+GMRCSVC,0)),U,1))
"RTN","GMRCAU",27,0)
 Q GMRCSSNM
"RTN","GMRCAU",28,0)
PROC(GMRCO) ;Get abbreviated procedure text
"RTN","GMRCAU",29,0)
 N GMRCPROC
"RTN","GMRCAU",30,0)
 S GMRCPROC=$P(^GMR(123,+GMRCO,0),"^",8)
"RTN","GMRCAU",31,0)
 I +GMRCPROC S GMRCPROC=$S($L($G(^ORD(101,+GMRCPROC,.1))):^(.1),1:$P($G(^ORD(101,+GMRCPROC,0)),"^",2))
"RTN","GMRCAU",32,0)
 Q GMRCPROC
"RTN","GMRCAU",33,0)
 ;
"RTN","GMRCAU",34,0)
LMTX(GMRCO) ;Get the text for list manager displays
"RTN","GMRCAU",35,0)
 ;GMRCO is the consult entry from 123
"RTN","GMRCAU",36,0)
 N GMRCSVC,GMRCSSNM,GMRCREQ,GMRCORTX
"RTN","GMRCAU",37,0)
 S GMRCSVC=$P(^GMR(123,+GMRCO,0),"^",5),GMRCSSNM=""
"RTN","GMRCAU",38,0)
 I +GMRCSVC S GMRCSSNM=$P($G(^GMR(123.5,+GMRCSVC,0)),U,1)
"RTN","GMRCAU",39,0)
 S GMRCREQ=$P(^GMR(123,+GMRCO,0),"^",8)
"RTN","GMRCAU",40,0)
 I +GMRCREQ S GMRCREQ=$S($L($G(^ORD(101,+GMRCREQ,.1))):^(.1),1:$P($G(^ORD(101,+GMRCPROC,0)),"^",2))
"RTN","GMRCAU",41,0)
 S GMRCORTX=$S($L(GMRCPROC):($E(GMRCSSNM,1,10)_" "_$E(GMRCREQ,1,10)),1:$E(GMRCSSNM,1,20))
"RTN","GMRCAU",42,0)
 Q GMRCORTX
"RTN","GMRCAU",43,0)
 ;
"RTN","GMRCAU",44,0)
 ;
"RTN","GMRCAU",45,0)
VALID(GMRCSER,GMRCO,GMRCUSER,GMRCTST) ;Get users update authority
"RTN","GMRCAU",46,0)
 ; check GMRCSS and all parents for authority
"RTN","GMRCAU",47,0)
 ; codes returned are same as $$VALIDU
"RTN","GMRCAU",48,0)
 N GMRCUPDL,GMRCLIS,GMRCHKD,GMRCNT,GMRCLP,GMRCQUIT
"RTN","GMRCAU",49,0)
 I '$G(GMRCUSER) S GMRCUSER=DUZ
"RTN","GMRCAU",50,0)
 ; check initial service first
"RTN","GMRCAU",51,0)
 S GMRCUPDL=$$VALIDU(GMRCSER,GMRCUSER) I +GMRCUPDL D  G VALEX
"RTN","GMRCAU",52,0)
 . I $G(GMRCTST) S $P(GMRCUPDL,U,3)=$P($G(^GMR(123.5,+GMRCSER,0)),U)
"RTN","GMRCAU",53,0)
 S GMRCHKD(GMRCSER)="",GMRCNT=1
"RTN","GMRCAU",54,0)
 ; find parents if set to process, quit if none
"RTN","GMRCAU",55,0)
 I '$P($G(^GMR(123.5,+GMRCSER,0)),U,7) G VALEX ;process parents = 0
"RTN","GMRCAU",56,0)
 D FINDPAR(GMRCSER,.GMRCNT) I '$D(GMRCLIS) S GMRCUPDL=0 G VALEX
"RTN","GMRCAU",57,0)
 S GMRCLP=0
"RTN","GMRCAU",58,0)
 F  S GMRCLP=$O(GMRCLIS(GMRCLP)) Q:'GMRCLP!($D(GMRCQUIT))  D  I +GMRCUPDL G VALEX
"RTN","GMRCAU",59,0)
 . I +$P(GMRCLIS(GMRCLP),U,2) K GMRCLIS(GMRCLP) Q  ;been checked
"RTN","GMRCAU",60,0)
 . I '$D(GMRCHKD(+GMRCLIS(GMRCLP))) D
"RTN","GMRCAU",61,0)
 .. ; check parent 
"RTN","GMRCAU",62,0)
 .. S GMRCUPDL=$$VALIDU(+GMRCLIS(GMRCLP),GMRCUSER)
"RTN","GMRCAU",63,0)
 .. S GMRCHKD(+GMRCLIS(GMRCLP))=""
"RTN","GMRCAU",64,0)
 . S $P(GMRCLIS(GMRCLP),U,2)=1
"RTN","GMRCAU",65,0)
 . I +GMRCUPDL D  Q  ;got one
"RTN","GMRCAU",66,0)
 .. S:$G(GMRCTST) $P(GMRCUPDL,U,3)=$P($G(^GMR(123.5,+GMRCLIS(GMRCLP),0)),U)
"RTN","GMRCAU",67,0)
 . I $P(^GMR(123.5,+GMRCLIS(GMRCLP),0),U,7) D  ;process parents
"RTN","GMRCAU",68,0)
 .. D FINDPAR(+GMRCLIS(GMRCLP),.GMRCNT)
"RTN","GMRCAU",69,0)
 . S GMRCLP=0 ;start back at top and don't miss any
"RTN","GMRCAU",70,0)
VALEX Q GMRCUPDL
"RTN","GMRCAU",71,0)
FINDPAR(SERV,ARCNT)     ;find parents of SERV
"RTN","GMRCAU",72,0)
 ; SERV = service to find parents of
"RTN","GMRCAU",73,0)
 ; ARCNT = next array element
"RTN","GMRCAU",74,0)
 N PARENT
"RTN","GMRCAU",75,0)
 S PARENT=0
"RTN","GMRCAU",76,0)
 F  S PARENT=$O(^GMR(123.5,"APC",SERV,PARENT)) Q:'PARENT  D
"RTN","GMRCAU",77,0)
 . S GMRCLIS(ARCNT)=PARENT
"RTN","GMRCAU",78,0)
 . S ARCNT=ARCNT+1
"RTN","GMRCAU",79,0)
 Q
"RTN","GMRCAU",80,0)
 ;
"RTN","GMRCAU",81,0)
VALIDU(GMRCSS,GMRCUSR) ;Check to see if user is an update user
"RTN","GMRCAU",82,0)
 ;The value returned is the equivalent of this set of codes:
"RTN","GMRCAU",83,0)
 ;    0 = not an update user
"RTN","GMRCAU",84,0)
 ;    2 = update user
"RTN","GMRCAU",85,0)
 ;    3 = administrative update user
"RTN","GMRCAU",86,0)
 N GMRCUPD
"RTN","GMRCAU",87,0)
 I '$G(GMRCUSR) S GMRCUSR=DUZ
"RTN","GMRCAU",88,0)
 I '+$G(GMRCSS) Q 0
"RTN","GMRCAU",89,0)
 I +$P($G(^GMR(123.5,GMRCSS,0)),U,6) Q 2_$$FIELD(.06)
"RTN","GMRCAU",90,0)
 I $D(^GMR(123.5,+GMRCSS,123.3,"B",GMRCUSR)) Q 2_$$FIELD(123.3)
"RTN","GMRCAU",91,0)
 I GMRCUSR=$P($G(^GMR(123.5,+GMRCSS,123)),"^",8) Q 2_$$FIELD(123.08)
"RTN","GMRCAU",92,0)
 I $D(^GMR(123.5,+GMRCSS,123.33,"B",GMRCUSR)) Q 3_$$FIELD(123.33)
"RTN","GMRCAU",93,0)
 ;
"RTN","GMRCAU",94,0)
 S GMRCUPD=0
"RTN","GMRCAU",95,0)
 ; check service teams to notify, update teams w/o and admin teams w/o
"RTN","GMRCAU",96,0)
 N NODE F NODE=123.1,123.31,123.34 D  I +GMRCUPD Q
"RTN","GMRCAU",97,0)
 . I '$D(^GMR(123.5,+GMRCSS,NODE)) Q
"RTN","GMRCAU",98,0)
 . D TEAM(.GMRCUPD,NODE,GMRCUSR)
"RTN","GMRCAU",99,0)
 I +GMRCUPD Q GMRCUPD
"RTN","GMRCAU",100,0)
 ;
"RTN","GMRCAU",101,0)
 ; check ASU user classes in field 123.35
"RTN","GMRCAU",102,0)
 S GMRCUPD=$$USR(GMRCSS,GMRCUSR)
"RTN","GMRCAU",103,0)
 I +GMRCUPD Q GMRCUPD
"RTN","GMRCAU",104,0)
 ;
"RTN","GMRCAU",105,0)
 I $D(^GMR(123.5,+GMRCSS,123.2)) D LOC(.GMRCUPD) Q:+GMRCUPD GMRCUPD
"RTN","GMRCAU",106,0)
 Q 0
"RTN","GMRCAU",107,0)
 ;
"RTN","GMRCAU",108,0)
LOC(GMRCUPD) ;Check for the DUZ in the NOTIFICATION BY PT LOCATION multiple
"RTN","GMRCAU",109,0)
 N GMRCL,GMRCTM
"RTN","GMRCAU",110,0)
 S GMRCL=0 ;Check if DUZ is associated with any location/ward
"RTN","GMRCAU",111,0)
 F  S GMRCL=$O(^GMR(123.5,+GMRCSS,123.2,GMRCL))  Q:'GMRCL!+GMRCUPD  D  Q:+GMRCUPD
"RTN","GMRCAU",112,0)
 . ;Get user and/or team assigned to location
"RTN","GMRCAU",113,0)
 . S GMRCL(0)=$G(^GMR(123.5,+GMRCSS,123.2,+GMRCL,0))
"RTN","GMRCAU",114,0)
 . I $P(GMRCL(0),"^",2)=DUZ S GMRCUPD=2 Q
"RTN","GMRCAU",115,0)
 . I $P(GMRCL(0),"^",3) S GMRCTM=$P(GMRCL(0),"^",3) ;D CHKTM
"RTN","GMRCAU",116,0)
 Q
"RTN","GMRCAU",117,0)
 ;
"RTN","GMRCAU",118,0)
TEAM(TYPE,SUBSC,USER) ;Check for the DUZ in the multiple of SUBSC
"RTN","GMRCAU",119,0)
 N GMRCTM,GMRCHIT
"RTN","GMRCAU",120,0)
 S GMRCTM=""
"RTN","GMRCAU",121,0)
 I '$G(USER) S USER=DUZ
"RTN","GMRCAU",122,0)
 F  S GMRCTM=$O(^GMR(123.5,GMRCSS,SUBSC,"B",GMRCTM)) Q:'GMRCTM!+TYPE  D
"RTN","GMRCAU",123,0)
 . S GMRCHIT=$$CHKTM(GMRCTM,USER) Q:'GMRCHIT
"RTN","GMRCAU",124,0)
 . S TYPE=$S(SUBSC=123.34:3,1:2)_$$FIELD(SUBSC)
"RTN","GMRCAU",125,0)
 Q
"RTN","GMRCAU",126,0)
 ;
"RTN","GMRCAU",127,0)
CHKTM(TEAM,PERS) ;checks for PERS in list of users on TEAM
"RTN","GMRCAU",128,0)
 ;Input:  TEAM must be set to the Order Team entry number
"RTN","GMRCAU",129,0)
 ;Output: 1 will be returned PERS is on TEAM
"RTN","GMRCAU",130,0)
 N ND,GMRCLST,FOUND
"RTN","GMRCAU",131,0)
 S GMRCLST=""
"RTN","GMRCAU",132,0)
 D TEAMPROV^ORQPTQ1(.GMRCLST,TEAM)
"RTN","GMRCAU",133,0)
 I $P(GMRCLST(1),"^",2)="No providers found." Q 0
"RTN","GMRCAU",134,0)
 S ND=0
"RTN","GMRCAU",135,0)
 F  S ND=$O(GMRCLST(ND)) Q:ND=""  I +GMRCLST(ND)=PERS S FOUND=1 Q
"RTN","GMRCAU",136,0)
 Q $S($G(FOUND):1,1:0)
"RTN","GMRCAU",137,0)
 ;
"RTN","GMRCAU",138,0)
USR(SERV,USER) ; check USR classes for user
"RTN","GMRCAU",139,0)
 N UCLS,UPD
"RTN","GMRCAU",140,0)
 I '$O(^GMR(123.5,+SERV,123.35,0)) Q 0
"RTN","GMRCAU",141,0)
 S UCLS=0,UPD=0
"RTN","GMRCAU",142,0)
 F  S UCLS=$O(^GMR(123.5,+SERV,123.35,"B",UCLS)) Q:'UCLS!(+UPD)  D
"RTN","GMRCAU",143,0)
 . Q:'UCLS
"RTN","GMRCAU",144,0)
 . S UPD=$$ISA^USRLM(USER,UCLS)
"RTN","GMRCAU",145,0)
 . I +UPD S UPD=2_$$FIELD(123.35)
"RTN","GMRCAU",146,0)
 . Q
"RTN","GMRCAU",147,0)
 Q UPD
"RTN","GMRCAU",148,0)
FIELD(GMRCFLD) ;return field name where became update user
"RTN","GMRCAU",149,0)
 I '$G(GMRCTST) Q ""
"RTN","GMRCAU",150,0)
 D FIELD^DID(123.5,GMRCFLD,,"LABEL","GMRCFLD")
"RTN","GMRCAU",151,0)
 Q "^"_$G(GMRCFLD("LABEL"))
"RTN","GMRCAU",152,0)
COMPLETE(GMRCA) ;Determine if the action is a complete action (10,13,14)
"RTN","GMRCAU",153,0)
 S GMRCA=$G(GMRCA)
"RTN","GMRCAU",154,0)
 Q $S(GMRCA=13:1,GMRCA=14:1,GMRCA=10:1,1:0)
"RTN","GMRCAU",155,0)
 ;   10=administrative complete, 13=ADDENDUM ADDED, 14=New Note
"RTN","GMRCAU",156,0)
 ;
"RTN","GMRCAU",157,0)
RESOLUA(GMRCA) ;Determine if action has resolution info for clinician
"RTN","GMRCAU",158,0)
 ;Action value is based on value in ^ORD(100.01,"
"RTN","GMRCAU",159,0)
 ;Returns 1 for consult resolution, 0 for pending resolution
"RTN","GMRCAU",160,0)
 S GMRCA=$G(GMRCA)
"RTN","GMRCAU",161,0)
 Q $S(GMRCA=4:1,GMRCA=6:1,GMRCA=10:1,GMRCA=11:1,GMRCA=12:1,GMRCA=13:1,GMRCA=14:1,GMRCA=19:1,1:0)
"RTN","GMRCAU",162,0)
 ;    4=Sig Findings, 6=discontinued, 10=administrative complete
"RTN","GMRCAU",163,0)
 ;    11=Edit/resubmit
"RTN","GMRCAU",164,0)
 ;    12=Disassociate result, 13=Addendum Added, 14=New Note
"RTN","GMRCAU",165,0)
 ;    19=cancelled
"RTN","GMRCAU",166,0)
 ;
"RTN","GMRCAU",167,0)
RESOLUS(GMRCSTS) ;Determine status indicates the consult has a resolution
"RTN","GMRCAU",168,0)
 ;Status value is based on values in ^ORD(100.01,"
"RTN","GMRCAU",169,0)
 ;Returns 1 for consult resolution, 0 for pending resolution
"RTN","GMRCAU",170,0)
 S GMRCSTS=$G(GMRCSTS)
"RTN","GMRCAU",171,0)
 Q $S(GMRCSTS:1,GMRCSTS=2:1,GMRCSTS=13:1,1:0)
"RTN","GMRCAU",172,0)
 ;    1=dc,2=comp,13=canc
"RTN","GMRCAU",173,0)
 ;
"RTN","GMRCAU",174,0)
TEST ;called from GMRC UPDATE AUTHORITY
"RTN","GMRCAU",175,0)
 ; determines how a user gets update authority for a service 
"RTN","GMRCAU",176,0)
 W !
"RTN","GMRCAU",177,0)
 N GMRCSRV,GMRCUSR,UPD,GMRCDG,GMRC1
"RTN","GMRCAU",178,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","GMRCAU",179,0)
 S DIR(0)="PO^123.5:EM",DIR("A")="Select Consult Service"
"RTN","GMRCAU",180,0)
 S DIR("?")="Choose the consult service to check update status of user"
"RTN","GMRCAU",181,0)
 S DIR("??")="^D TESTHELP^GMRCAU(""ALL SERVICES"")" D ^DIR
"RTN","GMRCAU",182,0)
 I $D(DIRUT) Q
"RTN","GMRCAU",183,0)
 S GMRCSRV=+Y
"RTN","GMRCAU",184,0)
 N DIR
"RTN","GMRCAU",185,0)
 S DIR(0)="PO^200:EM",DIR("A")="Choose user to check for update status"
"RTN","GMRCAU",186,0)
 D ^DIR I $D(DIRUT) Q
"RTN","GMRCAU",187,0)
 S GMRCUSR=+Y
"RTN","GMRCAU",188,0)
 S UPD=$$VALID(GMRCSRV,,GMRCUSR,1)
"RTN","GMRCAU",189,0)
 I +UPD=0 W !!,"This user has no update authority"
"RTN","GMRCAU",190,0)
 I +UPD D
"RTN","GMRCAU",191,0)
 . I +UPD=2 W !!,"This user is an update user for: ",$P(UPD,U,3)
"RTN","GMRCAU",192,0)
 . I +UPD=3 W !!,"This user is an administrative user for: ",$P(UPD,U,3)
"RTN","GMRCAU",193,0)
 . W !,"via the ",$P(UPD,U,2)," field."
"RTN","GMRCAU",194,0)
 . W ! I $L($P(UPD,U,3)) D
"RTN","GMRCAU",195,0)
 .. I $P(UPD,U,3)'=$P(^GMR(123.5,+GMRCSRV,0),U) D HIER^GMRCT($P(UPD,U,3))
"RTN","GMRCAU",196,0)
 W !!
"RTN","GMRCAU",197,0)
 K GMRCSRV,GMRCUSR,UPD
"RTN","GMRCAU",198,0)
 K DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","GMRCAU",199,0)
 G TEST
"RTN","GMRCAU",200,0)
TESTHELP(GMRCSVNM) ;wrapper for LISTSRV^GMRCASV
"RTN","GMRCAU",201,0)
 N DIR,GMRC1,GMRCDG
"RTN","GMRCAU",202,0)
 D LISTSRV^GMRCASV
"RTN","GMRCAU",203,0)
 Q
"RTN","GMRCAU",204,0)
TSTINTRO ;entry action of GMRC UPDATE AUTHORITY option
"RTN","GMRCAU",205,0)
 W !!,"This option will allow you to check a user's update authority for any given"
"RTN","GMRCAU",206,0)
 W !,"service in the consults hierarchy.  If the PROCESS PARENTS FOR UPDATES field"
"RTN","GMRCAU",207,0)
 W !,"is set to YES, all ancestors of the selected service will be checked."
"RTN","GMRCAU",208,0)
 W !,"The type of update authority and the service to which they are assigned will"
"RTN","GMRCAU",209,0)
 W !,"be displayed.",!!
"RTN","GMRCAU",210,0)
 Q
"RTN","GMRCDRFR")
0^1^B4592184
"RTN","GMRCDRFR",1,0)
GMRCDRFR ;SLC/JFR - DEFAULT REASON FOR REQUEST UTILS ; 7/21/99 12:00
"RTN","GMRCDRFR",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**12**;DEC 27, 1997
"RTN","GMRCDRFR",3,0)
EN ; -- main entry point for GMRC DEFAULT REASON
"RTN","GMRCDRFR",4,0)
 N GMRCSV,GMRCDFN
"RTN","GMRCDRFR",5,0)
 D SELSS Q:'$D(GMRCSV)
"RTN","GMRCDRFR",6,0)
 D SELPT Q:'$D(GMRCPAT)
"RTN","GMRCDRFR",7,0)
 D INIT
"RTN","GMRCDRFR",8,0)
 D EN^VALM("GMRC DEFAULT REASON")
"RTN","GMRCDRFR",9,0)
 Q
"RTN","GMRCDRFR",10,0)
 ;
"RTN","GMRCDRFR",11,0)
SELPT ;get new patient 
"RTN","GMRCDRFR",12,0)
 N DIR,X,Y,DIRUT,DUOUT,DTOUT
"RTN","GMRCDRFR",13,0)
 D FULL^VALM1
"RTN","GMRCDRFR",14,0)
 S DIR(0)="PO^2:EQM" D ^DIR
"RTN","GMRCDRFR",15,0)
 I $D(DIRUT) Q
"RTN","GMRCDRFR",16,0)
 S GMRCPAT=+Y
"RTN","GMRCDRFR",17,0)
 K ^TMP("GMRCRFR",$J)
"RTN","GMRCDRFR",18,0)
 Q
"RTN","GMRCDRFR",19,0)
 ;
"RTN","GMRCDRFR",20,0)
SELSS ; get new service
"RTN","GMRCDRFR",21,0)
 N DIR,X,Y,DIRUT,DUOUT,DTOUT
"RTN","GMRCDRFR",22,0)
 D FULL^VALM1
"RTN","GMRCDRFR",23,0)
 S DIR(0)="PO^123.5:EMQ",DIR("A")="Select Service"
"RTN","GMRCDRFR",24,0)
 D ^DIR
"RTN","GMRCDRFR",25,0)
 I $D(DIRUT) Q
"RTN","GMRCDRFR",26,0)
 S GMRCSV=+Y
"RTN","GMRCDRFR",27,0)
 K ^TMP("GMRCRFR",$J)
"RTN","GMRCDRFR",28,0)
 Q
"RTN","GMRCDRFR",29,0)
 ;
"RTN","GMRCDRFR",30,0)
HDR ; -- header code
"RTN","GMRCDRFR",31,0)
 S VALMHDR(1)="Service: "_$P(^GMR(123.5,+GMRCSV,0),U)
"RTN","GMRCDRFR",32,0)
 S VALMHDR(2)="Patient: "_$$GET1^DIQ(2,+GMRCPAT,.01)
"RTN","GMRCDRFR",33,0)
 Q
"RTN","GMRCDRFR",34,0)
 ;
"RTN","GMRCDRFR",35,0)
INIT ; -- init variables and list array
"RTN","GMRCDRFR",36,0)
 Q:$D(^TMP("GMRCRFR",$J))
"RTN","GMRCDRFR",37,0)
 D GETDEF($NA(^TMP("GMRCRFR",$J)),GMRCSV,GMRCPAT,1)
"RTN","GMRCDRFR",38,0)
 I '$D(^TMP("GMRCRFR",$J)) D
"RTN","GMRCDRFR",39,0)
 . S ^TMP("GMRCRFR",$J,1,0)="No default Reason for Request exists for the selected service."
"RTN","GMRCDRFR",40,0)
 S VALMCNT=$O(^TMP("GMRCRFR",$J,999999),-1)
"RTN","GMRCDRFR",41,0)
 S VALMBG=1
"RTN","GMRCDRFR",42,0)
 Q
"RTN","GMRCDRFR",43,0)
 ;
"RTN","GMRCDRFR",44,0)
HELP ; -- help code
"RTN","GMRCDRFR",45,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCDRFR",46,0)
 Q
"RTN","GMRCDRFR",47,0)
 ;
"RTN","GMRCDRFR",48,0)
EXIT ; -- exit code
"RTN","GMRCDRFR",49,0)
 K GMRCSV,GMRCPAT
"RTN","GMRCDRFR",50,0)
 Q
"RTN","GMRCDRFR",51,0)
 ;
"RTN","GMRCDRFR",52,0)
EXPND ; -- expand code
"RTN","GMRCDRFR",53,0)
 Q
"RTN","GMRCDRFR",54,0)
 ;
"RTN","GMRCDRFR",55,0)
GETDEF(GMRCARR,GMRCSRV,GMRCDFN,RESOLV) ; return default reason for request
"RTN","GMRCDRFR",56,0)
 ; GMRCARR = array to return containing default RFR
"RTN","GMRCDRFR",57,0)
 ; GMRCSRV = IEN from file 123.5
"RTN","GMRCDRFR",58,0)
 ; GMRCDFN = patient identifier if to return resolved
"RTN","GMRCDRFR",59,0)
 ; RESOLV = 1 or 0 ; if RESOLV=1 GMRCARR will be returned resolved 
"RTN","GMRCDRFR",60,0)
 Q:'+GMRCSRV
"RTN","GMRCDRFR",61,0)
 Q:'$D(^GMR(123.5,+GMRCSRV,124))
"RTN","GMRCDRFR",62,0)
 ;S GMRCARR=$NA(GMRCARR)
"RTN","GMRCDRFR",63,0)
 I '$D(GMRCDFN)!('$G(RESOLV)) D  Q
"RTN","GMRCDRFR",64,0)
 . M @GMRCARR=^GMR(123.5,+GMRCSRV,124)
"RTN","GMRCDRFR",65,0)
 D BLRPLT^TIUSRVD(,,GMRCDFN,,$NA(^GMR(123.5,+GMRCSRV,124)))
"RTN","GMRCDRFR",66,0)
 I $D(^TMP("TIUBOIL",$J)) M @GMRCARR=^TMP("TIUBOIL",$J)
"RTN","GMRCDRFR",67,0)
 K ^TMP("TIUBOIL",$J)
"RTN","GMRCDRFR",68,0)
 Q
"RTN","GMRCDRFR",69,0)
REAF(GMRCSS) ;return value of RESTRICT DEFAULT REASON EDIT field to CPRS
"RTN","GMRCDRFR",70,0)
 I '$O(^GMR(123.5,GMRCSS,124,0)) Q 0
"RTN","GMRCDRFR",71,0)
 Q +$P($G(^GMR(123.5,GMRCSS,1)),U,3)
"RTN","GMRCEDT1")
0^7^B34210569
"RTN","GMRCEDT1",1,0)
GMRCEDT1 ;SLC/DCM,JFR - EDIT A CONSULT AND RE-SEND AS NEW ;1/3/99 23:19
"RTN","GMRCEDT1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12**;DEC 27, 1997
"RTN","GMRCEDT1",3,0)
EN(GMRCO) ;GMRCO=IEN of consult from file 123
"RTN","GMRCEDT1",4,0)
 ;GMRCSS=To Service   GMRCPROC=Procedure Request Type
"RTN","GMRCEDT1",5,0)
 ;GMRCURG=Urgency     GMRCPL=Place Of Consultation
"RTN","GMRCEDT1",6,0)
 ;GMRCATN=Attention   GMRCINO=Service is In/Out Patient
"RTN","GMRCEDT1",7,0)
 ;GMRCPNM=Patient Name  GMRCDIAG=Provisional Diagnosis
"RTN","GMRCEDT1",8,0)
 N GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCINO,GMRCDIAG,LN
"RTN","GMRCEDT1",9,0)
 K ^TMP("GMRCR",$J,"ED") S GMRCLNO=1
"RTN","GMRCEDT1",10,0)
 I $L($P(^GMR(123,+GMRCO,0),"^",12)) S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CURRENT STATUS: (Not Editable): "_$P(^ORD(100.01,$P(^(0),"^",12),0),"^",1),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",11,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="" F  S GMRCDD=$O(^GMR(123,GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",12,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=19 S LN=0 D
"RTN","GMRCEDT1",13,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CANCELLED BY (Not Editable): "_$P(^VA(200,$P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",5),0),"^",1),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",14,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CANCELLED COMMENT (Not Editable):",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",15,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG)
"RTN","GMRCEDT1",16,0)
 ..I '$D(FLG) S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",17,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",$P(^(0),"-",79)="",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",18,0)
 ..Q
"RTN","GMRCEDT1",19,0)
 .Q
"RTN","GMRCEDT1",20,0)
 S GMRCSS=$S($D(GMRCEDT(1)):GMRCEDT(1),1:$P(^GMR(123,+GMRCO,0),"^",5)_U_$P(^GMR(123.5,$P(^GMR(123,+GMRCO,0),"^",5),0),U))
"RTN","GMRCEDT1",21,0)
 S GMRCPROC=$S($D(GMRCED(1)):GMRCED(1),1:$P(^GMR(123,+GMRCO,0),"^",8)_U_$$GET1^DIQ(101,+$P(^GMR(123,+GMRCO,0),"^",8),1))
"RTN","GMRCEDT1",22,0)
 S GMRCURG=$S($D(GMRCED(3)):GMRCED(3),1:$P(^GMR(123,+GMRCO,0),"^",9)_U_$$GET1^DIQ(101,+$P(^(0),"^",9),1))
"RTN","GMRCEDT1",23,0)
 S GMRCPL=$S($D(GMRCED(4)):GMRCED(4),1:$P(^GMR(123,+GMRCO,0),"^",10)_U_$$GET1^DIQ(101,+$P(^(0),U,10),1))
"RTN","GMRCEDT1",24,0)
 S GMRCATN=$S($D(GMRCED(5)):GMRCED(5),1:$P(^GMR(123,+GMRCO,0),"^",11)_U_$$GET1^DIQ(200,+$P(^(0),U,11),.01))
"RTN","GMRCEDT1",25,0)
 I '$D(^GMR(123,GMRCO,30.1)) D
"RTN","GMRCEDT1",26,0)
 . I $D(GMRCED(6)),$L($P(GMRCED(6),U,2)) D  Q
"RTN","GMRCEDT1",27,0)
 .. S GMRCDIAG=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT1",28,0)
 . S GMRCDIAG=$S($D(GMRCED(6)):GMRCED(6),1:$G(^GMR(123,+GMRCO,30)))
"RTN","GMRCEDT1",29,0)
 I $D(^GMR(123,GMRCO,30.1)) D
"RTN","GMRCEDT1",30,0)
 . I $D(GMRCED(6)),$L(GMRCED(6)) D  Q
"RTN","GMRCEDT1",31,0)
 .. S GMRCDIAG=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT1",32,0)
 . S GMRCDIAG=$G(^GMR(123,+GMRCO,30))
"RTN","GMRCEDT1",33,0)
 I $D(GMRCED(2)) S GMRCINO=GMRCED(2)
"RTN","GMRCEDT1",34,0)
 I '$D(GMRCINO) S GMRCINO=$P(^GMR(123,+GMRCO,0),U,18)_U_$S($P(^(0),U,18)="I":"Inpatient",1:"Outpatient")
"RTN","GMRCEDT1",35,0)
 S GMRCREQ=$$GET1^DIQ(101,+$P(^GMR(123,+GMRCO,0),U,17),1)
"RTN","GMRCEDT1",36,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="SENDING PROVIDER (Not Editable): "_$$GET1^DIQ(200,+$P(^GMR(123,+GMRCO,0),"^",14),.01),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",37,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="REQUEST TYPE (Not Editable): "_GMRCREQ,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",38,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=$$REPEAT^XLFSTR("-",79),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",39,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  TO SERVICE (Not Editable): "_$P(GMRCSS,U,2) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",40,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=" ",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",41,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="1 PROCEDURE: "_$P(GMRCPROC,U,2)
"RTN","GMRCEDT1",42,0)
 D:+GMRCPROC RVRS(GMRCLNO,$D(GMRCED(1))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",43,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="2 Performed as INPT OR OUTPT: "_$P(GMRCINO,U,2) D RVRS(GMRCLNO,$D(GMRCED(2))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",44,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="3 URGENCY: "_$P(GMRCURG,U,2) D RVRS(GMRCLNO,$D(GMRCED(3))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",45,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="4 PLACE OF CONSULTATION: "_$P(GMRCPL,U,2) D RVRS(GMRCLNO,$D(GMRCED(4))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",46,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="5 ATTENTION (CONSULTANT): "_$P(GMRCATN,U,2) D RVRS(GMRCLNO,$D(GMRCED(5))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",47,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="6 PROVISIONAL DIAGNOSIS: "_GMRCDIAG D RVRS(GMRCLNO,$D(GMRCED(6))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",48,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="7 REASON FOR REQUEST:" D RVRS(GMRCLNO,$D(^TMP("GMRCED",$J,20))) S GMRCLNO=GMRCLNO+1 D
"RTN","GMRCEDT1",49,0)
 . I $D(^TMP("GMRCED",$J,20)) D  Q
"RTN","GMRCEDT1",50,0)
 .. N ND S ND=0
"RTN","GMRCEDT1",51,0)
 .. F  S ND=$O(^TMP("GMRCED",$J,20,ND)) Q:'ND  D
"RTN","GMRCEDT1",52,0)
 ... D KILL^VALM10(GMRCLNO)
"RTN","GMRCEDT1",53,0)
 ... S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCED",$J,20,ND,0)
"RTN","GMRCEDT1",54,0)
 ... S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",55,0)
 . N ND S ND=0
"RTN","GMRCEDT1",56,0)
 . F  S ND=$O(^GMR(123,+GMRCO,20,ND)) Q:ND=""  D
"RTN","GMRCEDT1",57,0)
 .. S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^GMR(123,+GMRCO,20,ND,0)
"RTN","GMRCEDT1",58,0)
 .. S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",59,0)
 .Q
"RTN","GMRCEDT1",60,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,^TMP("GMRCR",$J,"ED",GMRCLNO,0)="8 COMMENT(S): (Add Only)" D RVRS(GMRCLNO) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",61,0)
 I $D(^TMP("GMRCED",$J,40)) D
"RTN","GMRCEDT1",62,0)
 . D KILL^VALM10(GMRCLNO)
"RTN","GMRCEDT1",63,0)
 . S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  New Comment:",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",64,0)
 . N ND S ND=0 F  S ND=$O(^TMP("GMRCED",$J,40,ND)) Q:'ND  D
"RTN","GMRCEDT1",65,0)
 .. S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCED",$J,40,ND,0)
"RTN","GMRCEDT1",66,0)
 .. S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",67,0)
 N GMRCEDCT
"RTN","GMRCEDT1",68,0)
 S GMRCD=0,GMRCEDCT=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="",GMRCDD=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",69,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=20 S LN=0,GMRCEDCT=GMRCEDCT+1,GMRCEDCM(GMRCEDCT)=GMRCDD D
"RTN","GMRCEDT1",70,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,^TMP("GMRCR",$J,"ED",GMRCLNO,0)="ADDED COMMENT (Not Editable) Entered: "_$P($$FMTE^XLFDT($P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",1)),"@",1)
"RTN","GMRCEDT1",71,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCR",$J,"ED",GMRCLNO,0)_" BY: "_$S($L($P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",4)):$P(^VA(200,$P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",4),0),"^",1),1:"UNKNOWN"),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",72,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG) Q
"RTN","GMRCEDT1",73,0)
 ..S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",74,0)
 ..Q
"RTN","GMRCEDT1",75,0)
 .Q
"RTN","GMRCEDT1",76,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=""
"RTN","GMRCEDT1",77,0)
 K FLG
"RTN","GMRCEDT1",78,0)
 Q
"RTN","GMRCEDT1",79,0)
RVRS(LINE,EDITED) ;reverse video for fields that can be edited
"RTN","GMRCEDT1",80,0)
 I '$G(EDITED) D CNTRL^VALM10(LINE,1,1,IORVON,IORVOFF) Q
"RTN","GMRCEDT1",81,0)
 D CNTRL^VALM10(LINE,1,1,IORVON_IOINHI,IORVOFF_IOINORM)
"RTN","GMRCEDT1",82,0)
 Q
"RTN","GMRCEDT2")
0^9^B14196686
"RTN","GMRCEDT2",1,0)
GMRCEDT2 ;SLC/JFR,DCM - RESUBMIT A CANCELLED CONSULT ;1/4/99 00:27
"RTN","GMRCEDT2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12**;DEC 27, 1997
"RTN","GMRCEDT2",3,0)
EN(GMRCO,COMNO) ;entry point into the routine
"RTN","GMRCEDT2",4,0)
 ;COMNO=CMDA from ^GMRCEDT2=comments array IEN from ^GMR(123,IEN,40,
"RTN","GMRCEDT2",5,0)
 ;GMRCO=IEN of the consult from file 123
"RTN","GMRCEDT2",6,0)
 I $S($P(^GMR(123,GMRCO,0),"^",12)'=13:1,$D(GMRCRSUB):1,1:0) D  Q
"RTN","GMRCEDT2",7,0)
 .S GMRCMSG="***     Consult Has Already Been Resubmitted   ***"
"RTN","GMRCEDT2",8,0)
 .S GMRCMSG(1)="***  No Further Action Is Required Or Allowed ***"
"RTN","GMRCEDT2",9,0)
 .D EXAC^GMRCADC(.GMRCMSG)
"RTN","GMRCEDT2",10,0)
 .S:'$D(GMRCRSUB) GMRCRSUB=1
"RTN","GMRCEDT2",11,0)
 .Q
"RTN","GMRCEDT2",12,0)
 N MSG S MSG=$$EDRESOK(GMRCO)
"RTN","GMRCEDT2",13,0)
 I '+MSG D EXAC^GMRCADC($P(MSG,U,2)) Q
"RTN","GMRCEDT2",14,0)
 I '$D(GMRCGUIF) W !,"Resubmitting Consult ... One moment please ..."
"RTN","GMRCEDT2",15,0)
 K ^TMP("GMRCSUB",$J) S ^TMP("GMRCSUB",$J)=0
"RTN","GMRCEDT2",16,0)
 I $D(GMRCEDT(1)) S ^TMP("GMRCSUB",$J,1)="GMRCSS^"_+GMRCEDT(1)
"RTN","GMRCEDT2",17,0)
 I $D(GMRCED(1)) D
"RTN","GMRCEDT2",18,0)
 . I $P(GMRCED(1),U)=$P(^GMR(123,+GMRCO,0),U,8) K GMRCED(1) Q
"RTN","GMRCEDT2",19,0)
 . S ^TMP("GMRCSUB",$J,2)="GMRCPROC^"_+GMRCED(1)_";ORD(101,"
"RTN","GMRCEDT2",20,0)
 I $D(GMRCED(2)) D
"RTN","GMRCEDT2",21,0)
 . I $P(GMRCED(2),U)=$P(^GMR(123,+GMRCO,0),U,18) K GMRCED(2) Q
"RTN","GMRCEDT2",22,0)
 . S ^TMP("GMRCSUB",$J,3)="GMRCION^"_$P(GMRCED(2),U)
"RTN","GMRCEDT2",23,0)
 I $D(GMRCED(3)) D
"RTN","GMRCEDT2",24,0)
 . I $P(GMRCED(3),U)=$P(^GMR(123,+GMRCO,0),U,9) K GMRCED(3) Q
"RTN","GMRCEDT2",25,0)
 . S ^TMP("GMRCSUB",$J,4)="GMRCURG^"_$P(GMRCED(3),U)
"RTN","GMRCEDT2",26,0)
 I $D(GMRCED(4)) D
"RTN","GMRCEDT2",27,0)
 . I $P(GMRCED(4),U)=$P(^GMR(123,+GMRCO,0),U,10) K GMRCED(4) Q
"RTN","GMRCEDT2",28,0)
 . S ^TMP("GMRCSUB",$J,5)="GMRCPL^"_$P(GMRCED(4),U)
"RTN","GMRCEDT2",29,0)
 I $D(GMRCED(5)) D
"RTN","GMRCEDT2",30,0)
 . I $P(GMRCED(5),U)=$P(^GMR(123,+GMRCO,0),U,11) K GMRCED(5) Q
"RTN","GMRCEDT2",31,0)
 . I '$L($P(GMRCED(5),U)) S $P(GMRCED(5),U)="@"
"RTN","GMRCEDT2",32,0)
 . S ^TMP("GMRCSUB",$J,6)="GMRCATN^"_$P(GMRCED(5),U)
"RTN","GMRCEDT2",33,0)
 I $D(GMRCED(6)) D
"RTN","GMRCEDT2",34,0)
 . I GMRCED(6)=$G(^GMR(123,+GMRCO,30)) K GMRCED(6) Q
"RTN","GMRCEDT2",35,0)
 . I $P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"=$G(^GMR(123,GMRCO,30)) K GMRCED(6) Q
"RTN","GMRCEDT2",36,0)
 . I '$L($P(GMRCED(6),U)) S $P(GMRCED(6),U,1,2)="@"
"RTN","GMRCEDT2",37,0)
 . I $L($P(GMRCED(6),U,2)),$P(GMRCED(6),U,2)'="@" D
"RTN","GMRCEDT2",38,0)
 .. S $P(GMRCED(6),U)=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT2",39,0)
 . S ^TMP("GMRCSUB",$J,7)="GMRCDIAG^"_GMRCED(6)
"RTN","GMRCEDT2",40,0)
 I $D(^TMP("GMRCED",$J,20)) S ^TMP("GMRCSUB",$J,20)="GMRCRFQ^" D
"RTN","GMRCEDT2",41,0)
 . N ND S ND=0
"RTN","GMRCEDT2",42,0)
 . F  S ND=$O(^TMP("GMRCED",$J,20,ND)) Q:'ND  D
"RTN","GMRCEDT2",43,0)
 .. S ^TMP("GMRCSUB",$J,20,ND)=^TMP("GMRCED",$J,20,ND,0)
"RTN","GMRCEDT2",44,0)
 I $D(^TMP("GMRCED",$J,40)) S ^TMP("GMRCSUB",$J,40)="COMMENT^" D
"RTN","GMRCEDT2",45,0)
 . N ND S ND=0
"RTN","GMRCEDT2",46,0)
 . F  S ND=$O(^TMP("GMRCED",$J,40,ND)) Q:'ND  D
"RTN","GMRCEDT2",47,0)
 .. S ^TMP("GMRCSUB",$J,40,ND)=^TMP("GMRCED",$J,40,ND,0)
"RTN","GMRCEDT2",48,0)
 D FILE^GMRCGUIC(+GMRCO,$NAME(^TMP("GMRCSUB",$J)),1)
"RTN","GMRCEDT2",49,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCEDT2",50,0)
 S DFN=$P(^GMR(123,+GMRCO,0),"^",2),GMRCPROV=$P(^(0),"^",14)
"RTN","GMRCEDT2",51,0)
 S GMRCTYPE=$P(^(0),"^",17),GMRCTRLC="XX",VISIT="",RMBED=""
"RTN","GMRCEDT2",52,0)
 S DIE="^GMR(123,",DA=+GMRCO,DR="8////^S X=5;9////^S X=11" D ^DIE
"RTN","GMRCEDT2",53,0)
 K DIE,DA,DR
"RTN","GMRCEDT2",54,0)
 S GMRCRSUB=1
"RTN","GMRCEDT2",55,0)
 S GMRCURG=$P(^GMR(123,+GMRCO,0),"^",9)
"RTN","GMRCEDT2",56,0)
 I +$P(^GMR(123,+GMRCO,0),"^",11) S GMRCADUZ($P(^(0),"^",11))=""
"RTN","GMRCEDT2",57,0)
 S GMRCSVC=$P(^GMR(123,+GMRCO,0),"^",5)
"RTN","GMRCEDT2",58,0)
 I +GMRCSVC D
"RTN","GMRCEDT2",59,0)
 . D EN^GMRCT(GMRCSVC)
"RTN","GMRCEDT2",60,0)
 S GMRCORTX="Resubmitted consult "_$$ORTX^GMRCAU(+GMRCO)_$S(+GMRCURG:" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",1:"")
"RTN","GMRCEDT2",61,0)
 K GMRCFL,GMRCPROV,GMRCTYPE,GMRCTRLC,VISIT,RMBED,GMRCOM,GMRCURG
"RTN","GMRCEDT2",62,0)
 K GMRCSVC,GMRCORTX
"RTN","GMRCEDT2",63,0)
 Q
"RTN","GMRCEDT2",64,0)
EDRESOK(GMRCDA) ;check cslt or proc to see if still resubmittable
"RTN","GMRCEDT2",65,0)
 ; if procedure is inactive or no services, not resubmittable
"RTN","GMRCEDT2",66,0)
 ; if service is grouper or disabled, not resubmittable
"RTN","GMRCEDT2",67,0)
 N MSG,GMRC
"RTN","GMRCEDT2",68,0)
 Q:'$D(^GMR(123,+$G(GMRCDA),0)) "0^Invalid Consult Number"
"RTN","GMRCEDT2",69,0)
 S GMRC(0)=^GMR(123,+GMRCDA,0)
"RTN","GMRCEDT2",70,0)
 I '$P(GMRC(0),U,8) D  Q MSG
"RTN","GMRCEDT2",71,0)
 . I "19"[+$P(^GMR(123.5,+$P(GMRC(0),U,5),0),U,2) D  Q
"RTN","GMRCEDT2",72,0)
 .. S MSG="0^The service for this Consult is no longer orderable."
"RTN","GMRCEDT2",73,0)
 . S MSG=1
"RTN","GMRCEDT2",74,0)
 S MSG=1
"RTN","GMRCEDT2",75,0)
 I "19"[+$P(^GMR(123.5,+$P(GMRC(0),U,5),0),U,2) S MSG=0
"RTN","GMRCEDT2",76,0)
 I '$L($$GET1^DIQ(101,+$P(GMRC(0),U,8),.01)) S MSG=0
"RTN","GMRCEDT2",77,0)
 I $L($$GET1^DIQ(101,+$P(GMRC(0),U,8),2)) S MSG=0
"RTN","GMRCEDT2",78,0)
 I '$D(^GMR(123.5,"APR",+$P(GMRC(0),U,8),+$P(GMRC(0),U,5))) S MSG=0
"RTN","GMRCEDT2",79,0)
 I MSG=0 D
"RTN","GMRCEDT2",80,0)
 . S MSG=MSG_"^This procedure may no longer be ordered or the service "
"RTN","GMRCEDT2",81,0)
 . S MSG=MSG_"may no longer perform it."
"RTN","GMRCEDT2",82,0)
 Q MSG
"RTN","GMRCEDT4")
0^8^B79860732
"RTN","GMRCEDT4",1,0)
GMRCEDT4 ;SLC/DCM,JFR - UTILITIES FOR EDITING FIELDS ;1/3/99 23:12
"RTN","GMRCEDT4",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12**;DEC 27, 1997
"RTN","GMRCEDT4",3,0)
ADDCM(GMRCO)    ;set up to add comment when none exists or to add a new comment
"RTN","GMRCEDT4",4,0)
 ;returns DA for the entry it sets up
"RTN","GMRCEDT4",5,0)
 N X
"RTN","GMRCEDT4",6,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^" S X=$S($P(^GMR(123,GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1),$P(^GMR(123,GMRCO,40,0),"^",3,4)=X_"^"_X
"RTN","GMRCEDT4",7,0)
 Q X
"RTN","GMRCEDT4",8,0)
AUDIT0(DA,GMRCDA)       ;Add the necessary tracking information to word processing fields
"RTN","GMRCEDT4",9,0)
 N DIE
"RTN","GMRCEDT4",10,0)
 S DIE="^GMR(123,"_GMRCDA_",40,",DA(1)=GMRCDA,DR=".01////^S X=DT;1////^S X=GMRCA;2////^S X=DT;3////^S X=DUZ;4////^S X=DUZ"
"RTN","GMRCEDT4",11,0)
 D ^DIE
"RTN","GMRCEDT4",12,0)
 S @(DIE_"""B"","_DT_","_DA_")")=""
"RTN","GMRCEDT4",13,0)
 Q
"RTN","GMRCEDT4",14,0)
EDITFLD(GMRCO)    ;edit field in file 123.
"RTN","GMRCEDT4",15,0)
 ;GMRCO=IEN of consult record in file 123
"RTN","GMRCEDT4",16,0)
 N DIR,X,Y,GMRCSS,GMRCPROC,GMRCPROC,GMRCURG,GMRCPL,GMRCREND,GMRCY,GMRCX
"RTN","GMRCEDT4",17,0)
 N GMRCMSG,GMRCTAG
"RTN","GMRCEDT4",18,0)
 I $S($P(^GMR(123,GMRCO,0),"^",12)'=13:1,$D(GMRCRSUB):1,1:0) D  Q
"RTN","GMRCEDT4",19,0)
 .S GMRCMSG="This consult is no longer editable." D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCEDT4",20,0)
 S GMRCMSG=$$EDRESOK^GMRCEDT2(GMRCO)
"RTN","GMRCEDT4",21,0)
 I '+GMRCMSG D EXAC^GMRCADC($P(GMRCMSG,U,2)) Q
"RTN","GMRCEDT4",22,0)
 S DIR(0)="LAO^1:8",DIR("A")="Select the fields to edit: "
"RTN","GMRCEDT4",23,0)
 D ^DIR I $D(DIRUT) Q
"RTN","GMRCEDT4",24,0)
 I $P(Y,",")<1 Q
"RTN","GMRCEDT4",25,0)
 S GMRCY=Y
"RTN","GMRCEDT4",26,0)
 F GMRCX=1:1:8 S GMRCTAG=$P(GMRCY,",",GMRCX) Q:'GMRCTAG  D
"RTN","GMRCEDT4",27,0)
 . D SETUP
"RTN","GMRCEDT4",28,0)
 . D @GMRCTAG
"RTN","GMRCEDT4",29,0)
 . K DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCEDT4",30,0)
 . D EN^GMRCEDT1(+GMRCO),INIT^GMRCEDIT
"RTN","GMRCEDT4",31,0)
 Q
"RTN","GMRCEDT4",32,0)
SETUP   ;get info needed for edit (save global reads)
"RTN","GMRCEDT4",33,0)
 S:$D(GMRCEDT(1)) GMRCSS=GMRCEDT(1)
"RTN","GMRCEDT4",34,0)
 I '$D(GMRCSS) S GMRCSS=$P(^GMR(123,+GMRCO,0),U,5),GMRCSS=GMRCSS_U_$P(^GMR(123.5,GMRCSS,0),U)
"RTN","GMRCEDT4",35,0)
 S:$D(GMRCED(1)) GMRCPROC=GMRCED(1)
"RTN","GMRCEDT4",36,0)
 I '$D(GMRCPROC) S GMRCPROC=+$P(^GMR(123,+GMRCO,0),U,8),GMRCPROC=GMRCPROC_U_$$GET1^DIQ(101,+GMRCPROC,1)
"RTN","GMRCEDT4",37,0)
 S:$D(GMRCED(2)) GMRCREND=GMRCED(2)
"RTN","GMRCEDT4",38,0)
 I '$D(GMRCREND) S GMRCREND=$P(^GMR(123,GMRCO,0),U,18),GMRCREND=GMRCREND_U_$S(GMRCREND="I":"In",1:"Out")_"patient"
"RTN","GMRCEDT4",39,0)
 S:$D(GMRCED(3)) GMRCURG=GMRCED(3)
"RTN","GMRCEDT4",40,0)
 I '$D(GMRCURG) S GMRCURG=$P(^GMR(123,+GMRCO,0),U,9),GMRCURG=GMRCURG_U_$$GET1^DIQ(101,+GMRCURG,1)
"RTN","GMRCEDT4",41,0)
 S:$D(GMRCED(4)) GMRCPL=GMRCED(4)
"RTN","GMRCEDT4",42,0)
 I '$D(GMRCPL) S GMRCPL=$P(^GMR(123,+GMRCO,0),U,10),GMRCPL=GMRCPL_U_$$GET1^DIQ(101,+GMRCPL,1)
"RTN","GMRCEDT4",43,0)
 Q
"RTN","GMRCEDT4",44,0)
01       ;edit TO SERVICE
"RTN","GMRCEDT4",45,0)
 N I,PROCSERV,DIR,X,Y
"RTN","GMRCEDT4",46,0)
 I $G(GMRCPROC) D  Q:'PROCSERV
"RTN","GMRCEDT4",47,0)
 . N I S I=0,PROCSERV=0 F  S I=$O(^GMR(123.5,"APR",+GMRCPROC,I)) Q:'I  D
"RTN","GMRCEDT4",48,0)
 .. S PROCSERV(I)="",PROCSERV=PROCSERV+1
"RTN","GMRCEDT4",49,0)
 . I PROCSERV=1 W !,"Only one SERVICE can perform this procedure.",!
"RTN","GMRCEDT4",50,0)
 S DIR(0)="PA^123.5:EMQ"
"RTN","GMRCEDT4",51,0)
 I $G(PROCSERV) D
"RTN","GMRCEDT4",52,0)
 . I $D(PROCSERV(+GMRCSS)) Q
"RTN","GMRCEDT4",53,0)
 . S DIR("B")=$$GET1^DIQ(123.5,$O(PROCSERV(0)),.01)
"RTN","GMRCEDT4",54,0)
 I '$D(DIR("B")) S DIR("B")=$P(GMRCSS,U,2)
"RTN","GMRCEDT4",55,0)
 S DIR("A")="Select the Service to perform this request: "
"RTN","GMRCEDT4",56,0)
 S DIR("S")="I $P(^(0),U,2)<1"
"RTN","GMRCEDT4",57,0)
 I +$G(GMRCPROC) S DIR("S")=DIR("S")_",$D(PROCSERV(+Y))"
"RTN","GMRCEDT4",58,0)
 S DIR("??")="^D LISTALL^GMRCASV"
"RTN","GMRCEDT4",59,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) Q
"RTN","GMRCEDT4",60,0)
 I Y<1!(+Y=+GMRCSS) W !,$$NOCHG,! Q
"RTN","GMRCEDT4",61,0)
 S GMRCEDT(1)=Y,GMRCSS=Y
"RTN","GMRCEDT4",62,0)
 Q
"RTN","GMRCEDT4",63,0)
1 ;edit Procedure
"RTN","GMRCEDT4",64,0)
 W !,$C(7),"The procedure associated with a request may not be changed."
"RTN","GMRCEDT4",65,0)
 W !,"Place a new request if a diffrent procedure is desired"
"RTN","GMRCEDT4",66,0)
 H 2 Q
"RTN","GMRCEDT4",67,0)
 I $$GET1^DIQ(101,+$P(^GMR(123,+GMRCO,0),U,17),.01)["CONS" D  Q
"RTN","GMRCEDT4",68,0)
 . W !,"Procedures may only be selected for Procedure requests.",!
"RTN","GMRCEDT4",69,0)
 . H 2
"RTN","GMRCEDT4",70,0)
 N DIC,PROCED,X,Y
"RTN","GMRCEDT4",71,0)
 S DIC=101.43,DIC(0)="AEQZ",D="S.PROC",DIC("B")=$P(GMRCPROC,U,2)
"RTN","GMRCEDT4",72,0)
 S DIC("A")="Select Procedure: "
"RTN","GMRCEDT4",73,0)
 S DIC("S")="I $D(^GMR(123.5,""APR"",+$P(^(0),U,2),+GMRCSS))"
"RTN","GMRCEDT4",74,0)
 D IX^DIC
"RTN","GMRCEDT4",75,0)
 I $D(DUOUT)!($D(DTOUT)) Q
"RTN","GMRCEDT4",76,0)
 I Y<1!(+$P(Y(0),U,3)=$P(GMRCPROC,U,2)) W !,$$NOCHG,! Q
"RTN","GMRCEDT4",77,0)
 S PROCED=+$P(Y(0),U,2)_U_$$UP^XLFSTR($P(Y(0),U))
"RTN","GMRCEDT4",78,0)
 I '$D(^GMR(123.5,"APR",+PROCED,+GMRCSS)) D
"RTN","GMRCEDT4",79,0)
 . ;never executed; service non-editable
"RTN","GMRCEDT4",80,0)
 . N GMRCEDD1,GMRCSSV,GMRCPROC
"RTN","GMRCEDT4",81,0)
 . W !,"The service is no longer appropriate for this procedure.",!
"RTN","GMRCEDT4",82,0)
 . S GMRCSSV=GMRCSS,GMRCPROC=PROCED
"RTN","GMRCEDT4",83,0)
 . S:$D(GMRCEDT(1)) GMRCEDD1=GMRCEDT(1)
"RTN","GMRCEDT4",84,0)
 . D 01
"RTN","GMRCEDT4",85,0)
 . I '$D(^GMR(123.5,"APR",+PROCED,+GMRCSS)) D
"RTN","GMRCEDT4",86,0)
 .. W !,$C(7),"Unable to change procedure.",!
"RTN","GMRCEDT4",87,0)
 .. K PROCED,GMRCEDT(1) S GMRCSS=GMRCSSV
"RTN","GMRCEDT4",88,0)
 .. I $D(GMRCEDD1) S GMRCEDT(1)=GMRCEDD1
"RTN","GMRCEDT4",89,0)
 I $D(PROCED) S (GMRCPROC,GMRCED(1))=PROCED
"RTN","GMRCEDT4",90,0)
 Q
"RTN","GMRCEDT4",91,0)
2       ;edit service rendered
"RTN","GMRCEDT4",92,0)
 N DIR,X,Y,GMRCURSV,GMRCPLSV,GMRCED4,GMRCED5,RENDED
"RTN","GMRCEDT4",93,0)
 S DIR(0)="S:A^I:Inpatient;O:Outpatient",DIR("B")=$P(GMRCREND,U,2)
"RTN","GMRCEDT4",94,0)
 S DIR("A")="Service to be performed Inpatient or Outpatient: "
"RTN","GMRCEDT4",95,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) W !,$$NOCHG,! Q
"RTN","GMRCEDT4",96,0)
 I Y'=$P(GMRCREND,U) S RENDED=Y_U_Y(0)
"RTN","GMRCEDT4",97,0)
 I '$D(RENDED) Q
"RTN","GMRCEDT4",98,0)
 I '$$VALIDUR(GMRCURG,RENDED,+$G(GMRCPROC)) D  I '$D(RENDED) Q
"RTN","GMRCEDT4",99,0)
 . N GMRCREND,CHGIO S GMRCREND=RENDED
"RTN","GMRCEDT4",100,0)
 . W $C(7),!!,"The urgency of this request is no longer valid.",!
"RTN","GMRCEDT4",101,0)
 . S GMRCURSV=GMRCURG S:$D(GMRCED(3)) GMRCED3=GMRCED(3)
"RTN","GMRCEDT4",102,0)
 . S CHGREND="" D 3
"RTN","GMRCEDT4",103,0)
 . I '$$VALIDUR(GMRCURG,RENDED,+$G(GMRCPROC)) D  Q
"RTN","GMRCEDT4",104,0)
 .. W !,$C(7),"Unable to change the way service is rendered.",!
"RTN","GMRCEDT4",105,0)
 .. K RENDED S GMRCURG=GMRCURSV S:$D(GMRCED3) GMRCED(3)=GMRCED3
"RTN","GMRCEDT4",106,0)
 I '$$VALIDPL(GMRCPL,RENDED) D  I '$D(RENDED) Q
"RTN","GMRCEDT4",107,0)
 . N GMRCREND,CHGREND S GMRCREND=RENDED
"RTN","GMRCEDT4",108,0)
 . W $C(7),!!,"The Place of Consultation is no longer valid.",!
"RTN","GMRCEDT4",109,0)
 . S GMRCPLSV=GMRCPL S:$D(GMRCED(4)) GMRCED4=GMRCED(4) S CHGREND="" D 4
"RTN","GMRCEDT4",110,0)
 . I '$$VALIDPL(GMRCPL,RENDED) D  Q
"RTN","GMRCEDT4",111,0)
 .. W !,$C(7),"Unable to change the way service is rendered.",!
"RTN","GMRCEDT4",112,0)
 .. K RENDED S GMRCPL=GMRCPLSV S:$D(GMRCED4) GMRCED(4)=GMRCED4
"RTN","GMRCEDT4",113,0)
 .. S:$D(GMRCURSV) GMRCURG=GMRCURSV
"RTN","GMRCEDT4",114,0)
 .. S:$D(GMRCED3) GMRCED(3)=GMRCED3
"RTN","GMRCEDT4",115,0)
 S (GMRCREND,GMRCED(2))=RENDED
"RTN","GMRCEDT4",116,0)
 Q
"RTN","GMRCEDT4",117,0)
3 ;edit urgency
"RTN","GMRCEDT4",118,0)
 N X,Y,XQORM
"RTN","GMRCEDT4",119,0)
 I $P(GMRCREND,U)="O" S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM - OUTPATIENT")
"RTN","GMRCEDT4",120,0)
 I '$D(Y) D  ;inpatient
"RTN","GMRCEDT4",121,0)
 .I '$G(GMRCPROC) S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM CSLT - INPATIENT") Q
"RTN","GMRCEDT4",122,0)
 .S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM REQ - INPATIENT")
"RTN","GMRCEDT4",123,0)
 I 'Y W !,$C(7),"Unable to change urgency." Q
"RTN","GMRCEDT4",124,0)
 S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Urgency: "
"RTN","GMRCEDT4",125,0)
 S XQORM("^^NO")=0
"RTN","GMRCEDT4",126,0)
 S:'$D(CHGREND) XQORM("B")=$P($G(GMRCURG),U,2)
"RTN","GMRCEDT4",127,0)
 D EN^XQORM
"RTN","GMRCEDT4",128,0)
 Q:Y'>0
"RTN","GMRCEDT4",129,0)
 I $P(Y(1),U,2)'=+GMRCURG D
"RTN","GMRCEDT4",130,0)
 . S GMRCED(3)=$P(Y(1),U,2)_U_$P(Y(1),U,3),GMRCURG=GMRCED(3)
"RTN","GMRCEDT4",131,0)
 Q
"RTN","GMRCEDT4",132,0)
4 ;edit place of CSLT
"RTN","GMRCEDT4",133,0)
 N X,Y,XQORM
"RTN","GMRCEDT4",134,0)
 S Y=$$FIND1^DIC(101,,"QX","GMRCPLACEM - "_$$UP^XLFSTR($P(GMRCREND,U,2))) Q:'Y
"RTN","GMRCEDT4",135,0)
 S XQORM=Y_";ORD(101,"
"RTN","GMRCEDT4",136,0)
 S XQORM(0)="1AR\",XQORM("A")="Place of Consultation: ",XQORM("NO^^")=""
"RTN","GMRCEDT4",137,0)
 S:'$D(CHGREND) XQORM("B")=$P($G(GMRCPL),U,2)
"RTN","GMRCEDT4",138,0)
 D EN^XQORM
"RTN","GMRCEDT4",139,0)
 Q:Y'>0
"RTN","GMRCEDT4",140,0)
 I $P(Y(1),U,2)'=+GMRCPL D
"RTN","GMRCEDT4",141,0)
 . S GMRCED(4)=$P(Y(1),U,2)_U_$P(Y(1),U,3),GMRCPL=GMRCED(4)
"RTN","GMRCEDT4",142,0)
 Q
"RTN","GMRCEDT4",143,0)
5 ;edit ATTN person
"RTN","GMRCEDT4",144,0)
 N X,Y,DIR
"RTN","GMRCEDT4",145,0)
 S DIR(0)="PAO^200:EQM",DIR("A")="Select ATTENTION person: "
"RTN","GMRCEDT4",146,0)
 S DIR("B")=$$GET1^DIQ(200,+$P(^GMR(123,+GMRCO,0),U,11),.01)
"RTN","GMRCEDT4",147,0)
 S:$D(GMRCED(5)) DIR("B")=$P($G(GMRCED(5)),U,2)
"RTN","GMRCEDT4",148,0)
 K:'$L(DIR("B")) DIR("B")
"RTN","GMRCEDT4",149,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) Q
"RTN","GMRCEDT4",150,0)
 I $G(DIR("B"))=$P(Y,U,2) Q
"RTN","GMRCEDT4",151,0)
 S GMRCED(5)=$S(Y=-1:"",1:Y)
"RTN","GMRCEDT4",152,0)
 I GMRCED(5)="" W !,?5,"<DELETED>",!
"RTN","GMRCEDT4",153,0)
 Q
"RTN","GMRCEDT4",154,0)
6 ;edit prov. DX
"RTN","GMRCEDT4",155,0)
 N X,Y,DIC,DIR,PRMPT
"RTN","GMRCEDT4",156,0)
 S PRMPT=$$PROVDX^GMRCUTL1(+$P(^GMR(123,+GMRCO,0),U,5))
"RTN","GMRCEDT4",157,0)
 I $P(PRMPT,U,2)="F" D
"RTN","GMRCEDT4",158,0)
 . S DIR(0)="FA^2:180",DIR("A")="Provisional Diagnosis: "
"RTN","GMRCEDT4",159,0)
 . I $P(PRMPT,U)'="R" S $P(DIR(0),U)="FAO"
"RTN","GMRCEDT4",160,0)
 . S:$D(GMRCED(6)) DIR("B")=$P(GMRCED(6),U)
"RTN","GMRCEDT4",161,0)
 . I '$D(DIR("B")) S DIR("B")=$G(^GMR(123,+GMRCO,30))
"RTN","GMRCEDT4",162,0)
 . K:'$L(DIR("B")) DIR("B")
"RTN","GMRCEDT4",163,0)
 . D ^DIR Q:$D(DTOUT)!($D(DUOUT))  Q:Y=$G(DIR("B"))
"RTN","GMRCEDT4",164,0)
 . I '$L(Y) W !,?5,"<DELETED>",!
"RTN","GMRCEDT4",165,0)
 . S GMRCED(6)=Y
"RTN","GMRCEDT4",166,0)
 I $P(PRMPT,U,2)="L" D
"RTN","GMRCEDT4",167,0)
 . D CONFIG^LEXSET("ICD","ICD")
"RTN","GMRCEDT4",168,0)
 . S DIR(0)="PA"_$S($P(PRMPT,U)'="R":"O",1:"")_"^757.01:EQM"
"RTN","GMRCEDT4",169,0)
 . S DIR("A")="Provisional Diagnosis: "
"RTN","GMRCEDT4",170,0)
 . I $D(GMRCED(6)) S DIR("B")=$P(GMRCED(6),U)
"RTN","GMRCEDT4",171,0)
 . I '$D(DIR("B")),$D(^GMR(123,+GMRCO,30.1)) D
"RTN","GMRCEDT4",172,0)
 .. S DIR("B")=$P(^GMR(123,GMRCO,30),(" ("_^(30.1)_")"))
"RTN","GMRCEDT4",173,0)
 . D ^DIR Q:$D(DTOUT)!($D(DUOUT))
"RTN","GMRCEDT4",174,0)
 . I $G(^GMR(123,GMRCO,30.1)),$D(Y(1)),^(30.1)=Y(1) Q
"RTN","GMRCEDT4",175,0)
 . S GMRCED(6)=$S(Y=-1:"",1:$P(Y,U,2)_U_$G(Y(1)))
"RTN","GMRCEDT4",176,0)
 . ;I $D(GMRCED(6)) S $P(GMRCED(6),U,2)=$G(Y(1))
"RTN","GMRCEDT4",177,0)
 . Q
"RTN","GMRCEDT4",178,0)
 Q
"RTN","GMRCEDT4",179,0)
7 ;edit Reason for Request
"RTN","GMRCEDT4",180,0)
 N DIC,DIWESUB,DWLW,DWPK
"RTN","GMRCEDT4",181,0)
 I $D(^TMP("GMRCED",$J,20)) M ^TMP("GMRCEDSV",$J,20)=^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",182,0)
 I '$D(^TMP("GMRCED",$J,20)) M ^TMP("GMRCED",$J,20)=^GMR(123,+GMRCO,20)
"RTN","GMRCEDT4",183,0)
 S DIC="^TMP(""GMRCED"",$J,20,",DIWESUB="Reason for Request"
"RTN","GMRCEDT4",184,0)
 W !,"Editing Reason for Request:",!
"RTN","GMRCEDT4",185,0)
 S DWPK=1,DWLW=74 D EN^DIWE
"RTN","GMRCEDT4",186,0)
 I '$$DIFFRFR($D(^TMP("GMRCEDSV",$J,20))) D  Q
"RTN","GMRCEDT4",187,0)
 . I $D(^TMP("GMRCEDSV",$J,20)) K ^TMP("GMRCEDSV",$J,20) Q
"RTN","GMRCEDT4",188,0)
 . K ^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",189,0)
 K ^TMP("GMRCEDSV",$J,20)
"RTN","GMRCEDT4",190,0)
 I '$D(^TMP("GMRCED",$J,20))!('$O(^TMP("GMRCED",$J,20,0))) D
"RTN","GMRCEDT4",191,0)
 . N GMRCMSG
"RTN","GMRCEDT4",192,0)
 . S GMRCMSG="Unable to delete Reason for Request (REQUIRED)"
"RTN","GMRCEDT4",193,0)
 . D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCEDT4",194,0)
 . K ^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",195,0)
 Q
"RTN","GMRCEDT4",196,0)
8 ;add comment
"RTN","GMRCEDT4",197,0)
 N DIC,DIWEPSE,DIWESUB,DWLW,DWPK
"RTN","GMRCEDT4",198,0)
 I $D(^TMP("GMRCED",$J,40)) D
"RTN","GMRCEDT4",199,0)
 . W !,"An unsaved comment exists. You may edit this comment.",!
"RTN","GMRCEDT4",200,0)
 . S DIWEPSE=1
"RTN","GMRCEDT4",201,0)
 S DIC="^TMP(""GMRCED"",$J,40,",DIWESUB="New Comment"
"RTN","GMRCEDT4",202,0)
 W !,"Adding new comment:",!
"RTN","GMRCEDT4",203,0)
 S DWPK=1,DWLW=74 D EN^DIWE
"RTN","GMRCEDT4",204,0)
 I '$O(^TMP("GMRCED",$J,40,0)) K ^TMP("GMRCED",$J,40)
"RTN","GMRCEDT4",205,0)
 Q
"RTN","GMRCEDT4",206,0)
DIFFRFR(SAVED) ;edited reason for req same as original?
"RTN","GMRCEDT4",207,0)
 N I,DIFF
"RTN","GMRCEDT4",208,0)
 I SAVED,$P($G(^TMP("GMRCED",$J,20,0)),U,3,4)'=$P($G(^TMP("GMRCEDSV",$J,20,0)),U,3,4) S DIFF=1 Q 1
"RTN","GMRCEDT4",209,0)
 I 'SAVED,$P($G(^TMP("GMRCED",$J,20,0)),U,3,4)'=$P($G(^GMR(123,+GMRCO,20,0)),U,3,4) S DIFF=1 Q 1
"RTN","GMRCEDT4",210,0)
 I SAVED S I=0 F  S I=$O(^TMP("GMRCED",$J,20,I)) Q:'I!($D(DIFF))  D
"RTN","GMRCEDT4",211,0)
 . I ^TMP("GMRCED",$J,20,I,0)=$G(^TMP("GMRCEDSV",$J,20,I,0)) Q
"RTN","GMRCEDT4",212,0)
 . S DIFF=1
"RTN","GMRCEDT4",213,0)
 . Q
"RTN","GMRCEDT4",214,0)
 I 'SAVED S I=0 F  S I=$O(^TMP("GMRCED",$J,20,I)) Q:'I!($D(DIFF))  D
"RTN","GMRCEDT4",215,0)
 . I ^TMP("GMRCED",$J,20,I,0)'=$G(^GMR(123,+GMRCO,20,I,0)) S DIFF=1
"RTN","GMRCEDT4",216,0)
 . Q
"RTN","GMRCEDT4",217,0)
 Q $G(DIFF)
"RTN","GMRCEDT4",218,0)
VALIDPL(PL,REND) ; place still valid?
"RTN","GMRCEDT4",219,0)
 N PLMENU
"RTN","GMRCEDT4",220,0)
 S PLMENU=$S($P(REND,U)="I":"IN",1:"OUT")
"RTN","GMRCEDT4",221,0)
 S PLMENU="GMRCPLACEM - "_PLMENU_"PATIENT"
"RTN","GMRCEDT4",222,0)
 S PLMENU=$$FIND1^DIC(101,,"QX",PLMENU) Q:PLMENU'>1 0
"RTN","GMRCEDT4",223,0)
 Q $D(^ORD(101,PLMENU,10,"B",+PL))
"RTN","GMRCEDT4",224,0)
VALIDUR(URG,REND,PROC) ;urgency still valid?
"RTN","GMRCEDT4",225,0)
 N URMENU
"RTN","GMRCEDT4",226,0)
 I $P(REND,U)="I" D
"RTN","GMRCEDT4",227,0)
 .I 'PROC S URMENU="GMRCURGENCYM CSLT - INPATIENT" Q
"RTN","GMRCEDT4",228,0)
 .S URMENU="GMRCURGENCYM REQ - INPATIENT" Q
"RTN","GMRCEDT4",229,0)
 I '$D(URMENU) S URMENU="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCEDT4",230,0)
 S URMENU=$$FIND1^DIC(101,,"QX",URMENU) Q:URMENU<0 0
"RTN","GMRCEDT4",231,0)
 Q $D(^ORD(101,URMENU,10,"B",+URG))
"RTN","GMRCEDT4",232,0)
 Q
"RTN","GMRCEDT4",233,0)
NOCHG() ;no changes made
"RTN","GMRCEDT4",234,0)
 Q "No Changes made!"
"RTN","GMRCGUIA")
0^12^B40266329
"RTN","GMRCGUIA",1,0)
GMRCGUIA ;SLC/DCM,JFR - File Consult actions from GUI  ;8/30/99  01:51
"RTN","GMRCGUIA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12**;DEC 27, 1997
"RTN","GMRCGUIA",3,0)
NEW(DFN,GMRCDA,GMRCLOC,GMRCTYPE,GMRCSVC,GMRCPROV,GMRCURG,GMRCPLI,GMRCNP,GMRCATN,GMRCINOT,GMRCDIAG,GMRCRFQ) ;Add a new consult for a patient.
"RTN","GMRCGUIA",4,0)
 ;DFN=Patient ^DPT( file number
"RTN","GMRCGUIA",5,0)
 ;GMRCRFQ=Reason For Request, why the consult is being ordered. Passed in as
"RTN","GMRCGUIA",6,0)
 ;    an array
"RTN","GMRCGUIA",7,0)
 ;GMRCDIAG=Povisional diagnosis; what is suspected to be the problem
"RTN","GMRCGUIA",8,0)
 ;GMRCTYPE=Request type -Consult or Procedure
"RTN","GMRCGUIA",9,0)
 ;GMRCLOC=Patient location.
"RTN","GMRCGUIA",10,0)
 ;GMRCDA=Date Time of Request
"RTN","GMRCGUIA",11,0)
 ;GMRCSVC=To Service; consulting service
"RTN","GMRCGUIA",12,0)
 ;GMRCLOC=Hospital Location ordering consult
"RTN","GMRCGUIA",13,0)
 ;GMRCPR=If a procedure, the procedure ordered (pointer to file 101)
"RTN","GMRCGUIA",14,0)
 ;GMRCURG=Urgency of request (stat, routine, etc) from file 101
"RTN","GMRCGUIA",15,0)
 ;GMRCPLI=Place of consultation (bedside, consultants choice, etc.) from file 101
"RTN","GMRCGUIA",16,0)
 ;GMRCPROV=Sending Provider
"RTN","GMRCGUIA",17,0)
 ;GMRCATN=if consult is to go to a specific provider, this provider is identified here.
"RTN","GMRCGUIA",18,0)
 ;GMRCINOT=Service provided as Inpatient or Outpatient
"RTN","GMRCGUIA",19,0)
 N DIC,DLAYGO,Y,DIE,GMRCADUZ,X,GMRCO,DR
"RTN","GMRCGUIA",20,0)
 S DIC="^GMR(123,",DIC(0)="L",X="""N""",DLAYGO=123 D ^DIC K DLAYGO
"RTN","GMRCGUIA",21,0)
 S (DA,GMRCO)=+Y,GMRCSTS=5,GMRCA=1,DIE=DIC
"RTN","GMRCGUIA",22,0)
 L +^GMR(123,GMRC0)
"RTN","GMRCGUIA",23,0)
 S DR=".02////^S X=DFN;.04////^S X=GMRCLOC;1////^S X=GMRCSVC;3////^S X=GMRCDA;4////^S X=GMRCPR;5////^S X=GMRCURG;6////^S X=GMRCPLI"_$S(GMRCATN]"":"7////^S X=GMRCATN",1:"")
"RTN","GMRCGUIA",24,0)
 D ^DIE
"RTN","GMRCGUIA",25,0)
 S DR="8////^S X=GMRCSTS;9////^S X=GMRCA;10////^S X=GMRCPROV;11////^S X=GMRCATN;13////^S X=GMRCTYPE;14////^S X=GMRCINOT"_$S($D(GMRCDIAG):"30:////^S X=GMRCDIAG",1:"")
"RTN","GMRCGUIA",26,0)
 D ^DIE L -^GMR(123,GMRCO)
"RTN","GMRCGUIA",27,0)
 I $O(GMRCRFQ(0)) D REASON^GMRCGUIB(GMRCO,GMRCRFQ,GMRCDA)
"RTN","GMRCGUIA",28,0)
 D EN^GMRCHL7(DFN,GMRCDA,GMRCTYPE,$G(GMRCRB),"NW",DUZ,$G(VISIT),"")
"RTN","GMRCGUIA",29,0)
 D EXIT
"RTN","GMRCGUIA",30,0)
 Q
"RTN","GMRCGUIA",31,0)
 ;
"RTN","GMRCGUIA",32,0)
RC(GMRCO,GMRCORNP,GMRCAD,GMRCMT,GMRCDUZ) ;Receive consult into service
"RTN","GMRCGUIA",33,0)
 ;
"RTN","GMRCGUIA",34,0)
 ;Input variables:
"RTN","GMRCGUIA",35,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIA",36,0)
 ;GMRCORNP - Name of the person who actually 'Received'the consult 
"RTN","GMRCGUIA",37,0)
 ;GMRCDUZ - DUZ of person entering the consult as being 'RECEIVED'.
"RTN","GMRCGUIA",38,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIA",39,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIA",40,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIA",41,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIA",42,0)
 ;GMRCDUZ - DUZ of person entering the consult as being 'RECEIVED'
"RTN","GMRCGUIA",43,0)
 ;
"RTN","GMRCGUIA",44,0)
 ;Output:
"RTN","GMRCGUIA",45,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIA",46,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",47,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",48,0)
 ;
"RTN","GMRCGUIA",49,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIA",50,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",51,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",52,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIA",53,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",54,0)
 S GMRCSTS=6,GMRCA=21
"RTN","GMRCGUIA",55,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",56,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIA",57,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIA",58,0)
 . S DA=$$SETDA^GMRCGUIB
"RTN","GMRCGUIA",59,0)
 . D SETCOM^GMRCGUIB(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIA",60,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","")
"RTN","GMRCGUIA",61,0)
 D EXIT
"RTN","GMRCGUIA",62,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",63,0)
 ;
"RTN","GMRCGUIA",64,0)
DC(GMRCO,GMRCORNP,GMRCAD,GMRCACTM,GMRCOM) ;Discontinue or Deny a consult
"RTN","GMRCGUIA",65,0)
 ;
"RTN","GMRCGUIA",66,0)
 ;Input variables:
"RTN","GMRCGUIA",67,0)
 ;GMRCO - Internal file number of consult from File 123
"RTN","GMRCGUIA",68,0)
 ;GMRCORNP - Provider who Discontinued or Denied consult
"RTN","GMRCGUIA",69,0)
 ;GMRCAD - FM date/time of actual activity.
"RTN","GMRCGUIA",70,0)
 ;GMRCACTM - set to "DY" if 'CANCELLED'(old DENY)
"RTN","GMRCGUIA",71,0)
 ;           set to "DC" if consult is Discontinued 
"RTN","GMRCGUIA",72,0)
 ;GMRCOM - Comment array containing explanation of action
"RTN","GMRCGUIA",73,0)
 ;    Passed by reference in the following form :
"RTN","GMRCGUIA",74,0)
 ;     ARRAY(1)="xxx xxx xxx"
"RTN","GMRCGUIA",75,0)
 ;     ARRAY(2)="XXX XXX"
"RTN","GMRCGUIA",76,0)
 ;     ARRAY(3)="XXX XXX xx", etc.
"RTN","GMRCGUIA",77,0)
 ;  Comment is a required field when consult is denied or discontinued.
"RTN","GMRCGUIA",78,0)
 ;
"RTN","GMRCGUIA",79,0)
 ;Output:
"RTN","GMRCGUIA",80,0)
 ;GMRCERR=Error Flag: 0 if no error, 1 if error occurred 
"RTN","GMRCGUIA",81,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIA",82,0)
 ; returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",83,0)
 ;
"RTN","GMRCGUIA",84,0)
 N GMRCDUZ,DFN,GMRCNOW,GMRCSTS,GMRCERR,GMRCERMS,GMRCADUZ,GMRCTRLC
"RTN","GMRCGUIA",85,0)
 S GMRCERR=0,GMRCERMS=""
"RTN","GMRCGUIA",86,0)
 S GMRCDUZ=DUZ,GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",87,0)
 K GMRCQUT
"RTN","GMRCGUIA",88,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIA",89,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",90,0)
 I '$D(GMRCOM) S GMRCERR=1,GMRCERMS="Comments are required for this action." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",91,0)
 S GMRCSTS=$P(^ORD(100.01,$P(^GMR(123,GMRCO,0),"^",12),0),U,2)
"RTN","GMRCGUIA",92,0)
 I GMRCSTS="dc" S GMRCERR=1,GMRCERMS="Order Has Already Been Discontinued." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",93,0)
 I GMRCSTS="ca" S GMRCERR=1,GMRCERMS="Order Has Already Been Cancelled." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",94,0)
 I GMRCSTS="comp" S GMRCERR=1,GMRCERMS="Order Has Already Been Completed." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",95,0)
 S GMRCA=$S(GMRCACTM="DC":6,1:19),GMRCSTS=$S(GMRCA=6:1,1:13)
"RTN","GMRCGUIA",96,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",97,0)
 I GMRCACTM="DC",$$DCPRNT^GMRCUTL1(GMRCO,DUZ) D PRNT^GMRCUTL1("",GMRCO)
"RTN","GMRCGUIA",98,0)
 S DA=$$SETDA^GMRCGUIB D SETCOM^GMRCGUIB(.GMRCOM)
"RTN","GMRCGUIA",99,0)
 S GMRCTRLC=$S(GMRCACTM="DC":"OD",1:"OC")
"RTN","GMRCGUIA",100,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),GMRCTRLC,GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIA",101,0)
 S GMRCORTX=$S(GMRCACTM="DY":"Cancelled",1:"Discontinued")_" consult "
"RTN","GMRCGUIA",102,0)
 S GMRCORTX=GMRCORTX_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIA",103,0)
 S GMRCADUZ="",GMRCFL=0
"RTN","GMRCGUIA",104,0)
 I GMRCACTM="DC" D
"RTN","GMRCGUIA",105,0)
 . S GMRCFL=$$DCNOTE^GMRCADC(GMRCO,DUZ) ;NOTIFY SERVICE ON DC ?
"RTN","GMRCGUIA",106,0)
 I +$P($G(^GMR(123,+GMRCO,0)),"^",14),$P(^(0),"^",14)'=DUZ D
"RTN","GMRCGUIA",107,0)
 . S GMRCADUZ($P(^(0),"^",14))=""
"RTN","GMRCGUIA",108,0)
 ;send notification
"RTN","GMRCGUIA",109,0)
 N NOTYPE S NOTYPE=$S(GMRCA=6:23,1:30)
"RTN","GMRCGUIA",110,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,NOTYPE,.GMRCADUZ,GMRCFL)
"RTN","GMRCGUIA",111,0)
 D EXIT
"RTN","GMRCGUIA",112,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",113,0)
 ;
"RTN","GMRCGUIA",114,0)
FR(GMRCO,GMRCSS,GMRCORNP,GMRCATTN,GMRCURGI,GMRCOM,GMRCAD) ;FWD consult
"RTN","GMRCGUIA",115,0)
 ;to another service
"RTN","GMRCGUIA",116,0)
 ;
"RTN","GMRCGUIA",117,0)
 ;Input variables:
"RTN","GMRCGUIA",118,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIA",119,0)
 ;GMRCSS=service being forwarded to; ptr to REQUEST SERVICES (#123.5)
"RTN","GMRCGUIA",120,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIA",121,0)
 ;GMRCATTN=NEW PERSON to whose attention action should be directed
"RTN","GMRCGUIA",122,0)
 ;GMRCURGI=urgency from PROTOCOL(#101) file
"RTN","GMRCGUIA",123,0)
 ;GMRCOM=Comment array containing explanation of action
"RTN","GMRCGUIA",124,0)
 ;    Passed by reference in the following form :
"RTN","GMRCGUIA",125,0)
 ;     ARRAY(1)="xxx xxx xxx"
"RTN","GMRCGUIA",126,0)
 ;     ARRAY(2)="XXX XXX"
"RTN","GMRCGUIA",127,0)
 ;     ARRAY(3)="XXX XXX xx", etc.
"RTN","GMRCGUIA",128,0)
 ;GMRCAD=FM date/time of actual activity
"RTN","GMRCGUIA",129,0)
 ;
"RTN","GMRCGUIA",130,0)
 ;Output:
"RTN","GMRCGUIA",131,0)
 ;  GMRCERR=Error Flag: 0 if no error, 1 if error occurred 
"RTN","GMRCGUIA",132,0)
 ;  GMRCERMS - Error message or null
"RTN","GMRCGUIA",133,0)
 ;     returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIA",134,0)
 ;
"RTN","GMRCGUIA",135,0)
 N DR,GMRCDUZ,GMRCNOW,GMRCFF,GMRCFR,GMRCADUZ,GMRCURG
"RTN","GMRCGUIA",136,0)
 N GMRCERR,GMRCERMS
"RTN","GMRCGUIA",137,0)
 S GMRCERR=0,GMRCERMS=""
"RTN","GMRCGUIA",138,0)
 S DFN=$P(^GMR(123,+GMRCO,0),U,2)
"RTN","GMRCGUIA",139,0)
 S GMRCDUZ=DUZ,GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIA",140,0)
 S:'$G(GMRCAD) GMRCAD=GMRCNOW  ;Actual FM date/time consult was FWD'd 
"RTN","GMRCGUIA",141,0)
 S:'$G(GMRCURGI) GMRCURGI=$P(^GMR(123,GMRCO,0),U,9)
"RTN","GMRCGUIA",142,0)
 S GMRCA=17,GMRCSTS=5
"RTN","GMRCGUIA",143,0)
 S GMRCFF=$P($G(^GMR(123.5,+GMRCSS,123)),U,9) ;printed to new serv
"RTN","GMRCGUIA",144,0)
 S GMRCFR=$P($G(^GMR(123,+GMRCO,0)),"^",5) ;Get current service 
"RTN","GMRCGUIA",145,0)
 S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCGUIA",146,0)
 S DR="1////^S X=$G(GMRCSS);5////^S X=$G(GMRCURGI);8////^S X=$G(GMRCSTS);9////^S X=$G(GMRCA);.1///@"_$S($L($G(GMRCATTN)):";7////^S X=GMRCATTN",1:"")
"RTN","GMRCGUIA",147,0)
 L +^GMR(123,GMRCO):3 I '$T K DIE,DA,DR S GMRCERR=1,GMRCERMS="Data Not Filed - File In Use By Another User." D EXIT Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",148,0)
 D ^DIE L -^GMR(123,GMRCO) K DIE,DA,DR
"RTN","GMRCGUIA",149,0)
 S DA=$$SETDA^GMRCGUIB D SETCOM^GMRCGUIB(.GMRCOM)
"RTN","GMRCGUIA",150,0)
 S GMRCURG=$P($G(^ORD(101,+GMRCURGI,0)),"^",2)
"RTN","GMRCGUIA",151,0)
 D DEM^GMRCU ;sets GMRCRB and other variables
"RTN","GMRCGUIA",152,0)
 D TYPE^GMRCAFRD ;sets GMRCTYPE
"RTN","GMRCGUIA",153,0)
 D FRMSG^GMRCAFRD ;create XX HL7 message for OE/RR and send alert 
"RTN","GMRCGUIA",154,0)
 D EXIT
"RTN","GMRCGUIA",155,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIA",156,0)
 ;
"RTN","GMRCGUIA",157,0)
RT(GMRCO,TMPGLOB) ;Set ^TMP("GMRCR",$J,"DT", with results from med and TIU
"RTN","GMRCGUIA",158,0)
 ;GMRCO=IEN of consult from file 123
"RTN","GMRCGUIA",159,0)
 ;Set TMPGLOB to a ^TMP global other than ^TMP("GMRCR",$J,"MCAR", or ^TMP("GMRCR",$J,"RES", i.e., S TMPGLOB="^TMP(""GMRCR"",$J,""RT"")"'
"RTN","GMRCGUIA",160,0)
 Q:'$G(GMRCO)
"RTN","GMRCGUIA",161,0)
 K @TMPGLOB
"RTN","GMRCGUIA",162,0)
 S GMRCDVL="",$P(GMRCDVL,"-",41)=""
"RTN","GMRCGUIA",163,0)
 S GMRCSR=$P(^GMR(123,+GMRCO,0),"^",15),GMRCTUFN=$P(^(0),"^",20)
"RTN","GMRCGUIA",164,0)
 S GMRCRTFL=$S('+GMRCSR&('GMRCTUFN):1,1:0)
"RTN","GMRCGUIA",165,0)
 ;
"RTN","GMRCGUIA",166,0)
 D GETRSLT^GMRCART(TMPGLOB)
"RTN","GMRCGUIA",167,0)
 ;
"RTN","GMRCGUIA",168,0)
 D EXIT
"RTN","GMRCGUIA",169,0)
 Q
"RTN","GMRCGUIA",170,0)
EXIT ;kill off variables for exit from actions
"RTN","GMRCGUIA",171,0)
 K GMRCA,GMRCDVL,GMRCSR,GMRCRTFL,GMRCFL,GMRCORNP,GMRCQUT,GMRCSTS,GMRCTUFN
"RTN","GMRCGUIA",172,0)
 K GMRCRTFL,GMRCADUZ,GMRCORTX
"RTN","GMRCGUIA",173,0)
 Q
"RTN","GMRCGUIB")
0^13^B25697393
"RTN","GMRCGUIB",1,0)
GMRCGUIB ;SLC/DCM,JFR - GUI actions for consults ;9/1/99 22:00
"RTN","GMRCGUIB",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12**;DEC 27, 1997
"RTN","GMRCGUIB",3,0)
SETDA() ;set DA of where audit actions are to be filed
"RTN","GMRCGUIB",4,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCGUIB",5,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCGUIB",6,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCGUIB",7,0)
 Q DA
"RTN","GMRCGUIB",8,0)
REASON(GMRCFN,GMRCRQ,GMRCDT) ;Load the reason for the request into ^GMR(123,GMRCO,20
"RTN","GMRCGUIB",9,0)
 ;GMRCFN=File 123 IFN; GMRCRQ=Array containing Reason For Request
"RTN","GMRCGUIB",10,0)
 ;GMRCDT=Date time of entry
"RTN","GMRCGUIB",11,0)
 S ^GMR(123,GMRCFN,20,0)="^^^"_GMRCDT_"^"
"RTN","GMRCGUIB",12,0)
 S L=0,LN=1 F  S L=$O(GMRCRQ(L)) Q:L=""  S ^GMR(123,GMRCFN,20,LN,0)=GMRCRQ(L),LN=LN+1
"RTN","GMRCGUIB",13,0)
 S LN=LN-1,$P(^GMR(123,GMRCFN,20,0),"^",3)=LN
"RTN","GMRCGUIB",14,0)
 K LN,L
"RTN","GMRCGUIB",15,0)
 Q
"RTN","GMRCGUIB",16,0)
SETCOM(COMMENT,WHO) ;Set comment array into tracking actions
"RTN","GMRCGUIB",17,0)
 N GMRCNOW,DR,DIE
"RTN","GMRCGUIB",18,0)
 S GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",19,0)
 S DIE="^GMR(123,GMRCO,40,",DA(1)=GMRCO,DR=".01////^S X=GMRCNOW;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=$G(GMRCORNP);4////^S X=$S($G(WHO):WHO,1:DUZ);6////^S X=$G(GMRCFR);8////^S X=$G(GMRCFF)"
"RTN","GMRCGUIB",20,0)
 D ^DIE
"RTN","GMRCGUIB",21,0)
 S ^GMR(123,GMRCO,40,DA,1,0)="^^^^"_GMRCAD_"^"
"RTN","GMRCGUIB",22,0)
 S (GMRCND,GMRCND1)=0 F  S GMRCND1=$O(COMMENT(GMRCND1)) Q:GMRCND1=""  S GMRCND=GMRCND+1,^GMR(123,GMRCO,40,DA,1,GMRCND,0)=COMMENT(GMRCND)
"RTN","GMRCGUIB",23,0)
 S $P(^GMR(123,GMRCO,40,DA,1,0),"^",3)=GMRCND,$P(^(0),"^",4)=GMRCND,^GMR(123,GMRCO,40,"B",GMRCNOW,DA)=""
"RTN","GMRCGUIB",24,0)
 K GMRCND,GMRCND1
"RTN","GMRCGUIB",25,0)
 Q
"RTN","GMRCGUIB",26,0)
CMT(GMRCO,GMRCOM,GMRCADUZ,GMRCWHN,GMRCWHO) ;add comment to consult record
"RTN","GMRCGUIB",27,0)
 ; GMRCO = IEN from file 123
"RTN","GMRCGUIB",28,0)
 ; GMRCOM = array of comments in format GMRCOM(1)="xxxx", GMRCOM(2)="xxx"
"RTN","GMRCGUIB",29,0)
 ; GMRCADUZ= array of alert recipients as GMRCADUZ(DUZ)="" (optional)
"RTN","GMRCGUIB",30,0)
 ; GMRCWHO= IEN from file 200 who's responsible activity (optional)
"RTN","GMRCGUIB",31,0)
 ; GMRCWHN= date time of activity in FM format
"RTN","GMRCGUIB",32,0)
 ;
"RTN","GMRCGUIB",33,0)
 N DA,GMRCA,GMRCAD,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",34,0)
 S DA=$$SETDA ; get next activity tracking entry
"RTN","GMRCGUIB",35,0)
 S GMRCA=20,GMRCAD=GMRCWHN S:$G(GMRCWHO) GMRCORNP=GMRCWHO
"RTN","GMRCGUIB",36,0)
 D SETCOM(.GMRCOM,$G(GMRCWHO))
"RTN","GMRCGUIB",37,0)
 Q:'$D(GMRCADUZ)
"RTN","GMRCGUIB",38,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCGUIB",39,0)
 S GMRCORTX="Comment Added to Consult "
"RTN","GMRCGUIB",40,0)
 S GMRCORTX=GMRCORTX_$$GET1^DIQ(123.5,$P(^GMR(123,+GMRCO,0),U,5),.01)
"RTN","GMRCGUIB",41,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,0)
"RTN","GMRCGUIB",42,0)
 Q
"RTN","GMRCGUIB",43,0)
SFILE(GMRCO,GMRCA,GMRCSF,GMRCORNP,GMRCDUZ,GMRCOM,GMRCALF,GMRCATO,GMRCAD) ;Process various file update functions from the GUI for a consult
"RTN","GMRCGUIB",44,0)
 ; ADMIN COMPLETE or SIGNIFICANT FINDINGS
"RTN","GMRCGUIB",45,0)
 ;Input variables:
"RTN","GMRCGUIB",46,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIB",47,0)
 ;GMRCA=pointer to REQUEST ACTION TYPES (#123.1) 10=complete, 4=Sig find.
"RTN","GMRCGUIB",48,0)
 ;GMRCSF=Significant Findings flag: 'Y'= significant finding
"RTN","GMRCGUIB",49,0)
 ;                                : 'N'= no significant finding
"RTN","GMRCGUIB",50,0)
 ;                                : 'U'=unknown significant finding
"RTN","GMRCGUIB",51,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIB",52,0)
 ;GMRCDUZ=Person actually doing the action
"RTN","GMRCGUIB",53,0)
 ;GMRCOM=An array of comments by reference ARRAY(1)="xxx",ARRAY(2)="xxx"
"RTN","GMRCGUIB",54,0)
 ;GMRCALF=Flag to signal that alerts are to be sent; 'N'=NO, 'Y'=YES
"RTN","GMRCGUIB",55,0)
 ;GMRCATO=Who alerts are to be sent to; a comma delimited string of DUZ's
"RTN","GMRCGUIB",56,0)
 ;GMRCAD =FM date/time of activity
"RTN","GMRCGUIB",57,0)
 ;
"RTN","GMRCGUIB",58,0)
 ;Output:
"RTN","GMRCGUIB",59,0)
 ; GMRCERR=Error Flag: 0 if no error, 1 if error occurred 
"RTN","GMRCGUIB",60,0)
 ; GMRCERMS - Error message or null
"RTN","GMRCGUIB",61,0)
 ;    returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",62,0)
 ;
"RTN","GMRCGUIB",63,0)
 N GMRCERR,GMRCERMS
"RTN","GMRCGUIB",64,0)
 L +^GMR(123,GMRCO):5 I '$T S GMRCERR=1,GMRCERMS="Record Locked. File Update Not Accomplished." Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",65,0)
 S GMRCERR=0,GMRCERMS="",DR="",GMRCORTX=""
"RTN","GMRCGUIB",66,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCGUIB",67,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCSTS=$P(^GMR(123,+GMRCO,0),"^",12),GMRCDFN=$P(^(0),"^",2)
"RTN","GMRCGUIB",68,0)
 I '$G(GMRCDUZ) S GMRCDUZ=DUZ
"RTN","GMRCGUIB",69,0)
 I '$G(GMRCAD) S GMRCAD=GMRCNOW
"RTN","GMRCGUIB",70,0)
 I +$G(GMRCA),GMRCA=10 D
"RTN","GMRCGUIB",71,0)
 .S GMRCSF=$G(GMRCSF,"")
"RTN","GMRCGUIB",72,0)
 .S GMRCSTS=2
"RTN","GMRCGUIB",73,0)
 .S DR="8////^S X=GMRCSTS;9////^S X=GMRCA"
"RTN","GMRCGUIB",74,0)
 .S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(+GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCGUIB",75,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",76,0)
 .Q
"RTN","GMRCGUIB",77,0)
 I $G(GMRCALF)=1 D
"RTN","GMRCGUIB",78,0)
 .N I
"RTN","GMRCGUIB",79,0)
 .F I=1:1  S X=$P(GMRCATO,";",I) Q:X=""  S GMRCADUZ(X)=""
"RTN","GMRCGUIB",80,0)
 .Q
"RTN","GMRCGUIB",81,0)
 I $L(GMRCA),GMRCA=4 S DR=DR_$S($L(DR):";",1:"")_"9////^S X=GMRCA;15////^S X=GMRCSF" D
"RTN","GMRCGUIB",82,0)
 .S GMRCORTX=$S(GMRCSF="Y":"Sig Findings ",GMRCSF="N":"No Sig Findings ",1:"Unknown Sig Findings ")_"for consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",83,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",84,0)
 .Q
"RTN","GMRCGUIB",85,0)
 I $L(DR) S DIE="^GMR(123,",DA=GMRCO D ^DIE K DIE,DR
"RTN","GMRCGUIB",86,0)
 I '$O(GMRCOM(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",87,0)
 I $D(GMRCOM),$O(GMRCOM(0)) D
"RTN","GMRCGUIB",88,0)
 .N DA
"RTN","GMRCGUIB",89,0)
 .S DA=$$SETDA()
"RTN","GMRCGUIB",90,0)
 .D SETCOM(.GMRCOM,GMRCDUZ)
"RTN","GMRCGUIB",91,0)
 .Q
"RTN","GMRCGUIB",92,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCGUIB",93,0)
 I +$G(GMRCALF) D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,$S(GMRCA=20:27,1:23),.GMRCADUZ,0)
"RTN","GMRCGUIB",94,0)
 I $S(GMRCA=10:1,1:0) D EN^GMRCHL7($P(^GMR(123,GMRCO,0),"^",2),GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIB",95,0)
 K DIE,DR,DA,GMRCDT,GMRCNOW,GMRCAD,GMRCORNP,GMRCDUZ,GMRCRSLT,GMRCSTS,GMRCADUZ,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",96,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",97,0)
 ;
"RTN","GMRCGUIB",98,0)
SCH(GMRCO,GMRCORNP,GMRCAD,GMRCADUZ,GMRCMT) ;schedule a consult API
"RTN","GMRCGUIB",99,0)
 ; Input variables:
"RTN","GMRCGUIB",100,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIB",101,0)
 ;GMRCORNP - Name of the person who actually 'Received'the consult 
"RTN","GMRCGUIB",102,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIB",103,0)
 ;GMRCADUZ - array of alert recipients as chosen by user (by reference)
"RTN","GMRCGUIB",104,0)
 ;   ARRAY(DUZ)="" 
"RTN","GMRCGUIB",105,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIB",106,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIB",107,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIB",108,0)
 ;
"RTN","GMRCGUIB",109,0)
 ;Output:
"RTN","GMRCGUIB",110,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIB",111,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIB",112,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",113,0)
        ;
"RTN","GMRCGUIB",114,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIB",115,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",116,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIB",117,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIB",118,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" D  Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",119,0)
 . S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found."
"RTN","GMRCGUIB",120,0)
 . D EXIT^GMRCGUIA
"RTN","GMRCGUIB",121,0)
 S GMRCSTS=8,GMRCA=8
"RTN","GMRCGUIB",122,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT^GMRCGUIA Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",123,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",124,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIB",125,0)
 . S DA=$$SETDA
"RTN","GMRCGUIB",126,0)
 . D SETCOM(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIB",127,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","","",GMRCAD)
"RTN","GMRCGUIB",128,0)
 I $D(GMRCADUZ),$O(GMRCMT(0)) D
"RTN","GMRCGUIB",129,0)
 . N TXT S TXT="Scheduled Consult: "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",130,0)
 . D MSG^GMRCP(DFN,TXT,GMRCO,27,.GMRCADUZ,0)
"RTN","GMRCGUIB",131,0)
 D EXIT^GMRCGUIA
"RTN","GMRCGUIB",132,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIC")
0^10^B47711944
"RTN","GMRCGUIC",1,0)
GMRCGUIC ;SLC/DCM,JFR - GUI actions for editing consults; 12/17/98 14:19
"RTN","GMRCGUIC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12**;DEC 27, 1997
"RTN","GMRCGUIC",3,0)
RFQ(GMRCO,MSG,ND,NOW) ;File Reason For Request field 20
"RTN","GMRCGUIC",4,0)
 N GMRCND,GMRCNT
"RTN","GMRCGUIC",5,0)
 S GMRCND=$O(^GMR(123,GMRCO,20,0)) I GMRCND="" S GMRCFLD(20)="Reason For Request: No Previous Value^20" Q
"RTN","GMRCGUIC",6,0)
 M ^TMP("GMRCFLD20",$J,20)=^GMR(123,GMRCO,20)
"RTN","GMRCGUIC",7,0)
 S GMRCFLD(20)=$NAME(^TMP("GMRCFLD20",$J,20))
"RTN","GMRCGUIC",8,0)
 K ^GMR(123,GMRCO,20)
"RTN","GMRCGUIC",9,0)
 S ^GMR(123,GMRCO,20,0)="^^^^"_DT_"^"
"RTN","GMRCGUIC",10,0)
 S GMRCND="",GMRCNT=1 F  S GMRCND=$O(@MSG@(ND,GMRCND)) Q:GMRCND=""  S ^GMR(123,GMRCO,20,GMRCNT,0)=@MSG@(ND,GMRCND),GMRCNT=GMRCNT+1
"RTN","GMRCGUIC",11,0)
 S $P(^GMR(123,GMRCO,20,0),"^",3)=GMRCNT-1,$P(^(0),"^",4)=GMRCNT-1
"RTN","GMRCGUIC",12,0)
 Q
"RTN","GMRCGUIC",13,0)
FILE(GMRCO,MSG,GMRCLM) ;File Edit changes
"RTN","GMRCGUIC",14,0)
 ;GMRCO=Record IEN,  GMRCCOM=Comment Array
"RTN","GMRCGUIC",15,0)
 ;MSG=^TMP global where the data resides, i.e., MSG="^TMP(""GMRCR"",$J)"
"RTN","GMRCGUIC",16,0)
 ;    Data is stored in subscripted nodes: ^TMP("GMRCR",$J,1)="GMRCSS^2"
"RTN","GMRCGUIC",17,0)
 ;    Word processing data is stored in second subscripted node:
"RTN","GMRCGUIC",18,0)
 ;    ^TMP("GMRCR",$J,9,1)="This is word processing data."
"RTN","GMRCGUIC",19,0)
 ;GMRCSS=To Service     GMRCPROC=procedure/Request Type
"RTN","GMRCGUIC",20,0)
 ;GMRCURG=Urgency       GMRCPL=Place Of Consultation
"RTN","GMRCGUIC",21,0)
 ;GMRCATN=Attention To  GMRCINO=Service is In/Out Patient
"RTN","GMRCGUIC",22,0)
 ;GMRCDIAG=Provisional Diagnosis  .GMRCRFQ=Reason For Request array
"RTN","GMRCGUIC",23,0)
 ;GMRCREQ=Procedure or Request; i.e., GMRCRQT=1727=^ORD(101,1727,0)='Procedure';GMRCRQT=1296=^ORD(101,1296,0)='Consult'
"RTN","GMRCGUIC",24,0)
 ;GMRCITM=Item ordered for field .1 (stored in ^GMR(123,GMRCO,1.11,
"RTN","GMRCGUIC",25,0)
 ;GMRCLM=coming from List Manager instead of the GUI
"RTN","GMRCGUIC",26,0)
 ;
"RTN","GMRCGUIC",27,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",28,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCGUIC",29,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCGUIC",30,0)
 F  S GMRCNOD=$O(@MSG@(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=@MSG@(GMRCNOD) D
"RTN","GMRCGUIC",31,0)
 .I $P(GMRCMSG,"^",1)="COMMENT" D COMMENT^GMRCGUIU(GMRCO,MSG,GMRCNOD,$P(GMRCMSG,"^",2)) Q
"RTN","GMRCGUIC",32,0)
 .I $P(GMRCMSG,"^",1)="GMRCRFQ" D RFQ(GMRCO,MSG,GMRCNOD,GMRCDT) Q
"RTN","GMRCGUIC",33,0)
 .I $P(GMRCMSG,"^",1)="GMRCSS" S GMRCSS=$P(GMRCMSG,"^",2),GMRCFLD(1)=$P(^GMR(123.5,$P(^GMR(123,GMRCO,0),"^",5),0),"^",1)_"^1" Q
"RTN","GMRCGUIC",34,0)
 .I $P(GMRCMSG,"^",1)="GMRCITM" S GMRCITM=$P(GMRCMSG,"^",2),GMRCFLD(.1)=^GMR(123,GMRCO,1.11)_"^.1" Q
"RTN","GMRCGUIC",35,0)
 .I $P(GMRCMSG,"^",1)="GMRCPROC" Q  ;S GMRCFLD(4)=+$P(^GMR(123,+GMRCO,0),"^",8)_"^4" D  Q ;ignore procedure, can't be changed currently
"RTN","GMRCGUIC",36,0)
 .; ..S GMRCPROC=$S($L($P(GMRCMSG,"^",2)):$P(GMRCMSG,"^",2),1:1296) I $L($P(^GMR(123,GMRCO,0),"^",8)),$P(GMRCMSG,"^",2)="" S GMRCPROC="DELETE"
"RTN","GMRCGUIC",37,0)
 .I $P(GMRCMSG,"^",1)="GMRCURG" S GMRCURG=$P(GMRCMSG,"^",2),GMRCFLD(5)=$S(+$P(^GMR(123,+GMRCO,0),"^",9):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",9),0),"^",2),1:"")_"^"_$P(^GMR(123,+GMRCO,0),"^",9) Q
"RTN","GMRCGUIC",38,0)
 .I $P(GMRCMSG,"^",1)="GMRCPL" D  Q
"RTN","GMRCGUIC",39,0)
 ..S GMRCPL=$P(GMRCMSG,"^",2) I '+GMRCPL D
"RTN","GMRCGUIC",40,0)
 ...S GMRCPL="GMRCPLACE - "_$S(GMRCPL="C":"ON CALL",GMRCPL="B":"BEDSIDE",GMRCPL="E":"EMERGENCY ROOM",1:GMRCPL),GMRCPL=$O(^ORD(101,"B",GMRCPL,0))
"RTN","GMRCGUIC",41,0)
 ..S GMRCFLD(6)=$S(+$P(^GMR(123,+GMRCO,0),"^",10):$P($P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",10),0),"^",1)," - ",2),1:"")_"^6"
"RTN","GMRCGUIC",42,0)
 ..Q
"RTN","GMRCGUIC",43,0)
 .I $P(GMRCMSG,"^",1)="GMRCATN" S GMRCATN=$P(GMRCMSG,"^",2),GMRCFLD(7)=$S(+$P(^GMR(123,+GMRCO,0),"^",11):$P(^VA(200,+$P(^GMR(123,+GMRCO,0),"^",11),0),"^",1),1:"")_"^7" Q
"RTN","GMRCGUIC",44,0)
 .I $P(GMRCMSG,"^",1)="GMRCREQ" S GMRCREQ=$P(GMRCMSG,"^",2),GMRCFLD(13)=$S(+$P(^GMR(123,+GMRCO,0),"^",17):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",17),0),"^",2),1:"")_"^13" Q
"RTN","GMRCGUIC",45,0)
 .I $P(GMRCMSG,"^",1)="GMRCION" S GMRCION=$P(GMRCMSG,"^",2),GMRCFLD(14)=$S($P(^GMR(123,+GMRCO,0),"^",18)="I":"Inpatient",$P(^(0),"^",18)="O":"Outpatient",1:"")_"^14" Q
"RTN","GMRCGUIC",46,0)
 .I $P(GMRCMSG,"^",1)="GMRCDIAG" D  Q
"RTN","GMRCGUIC",47,0)
 ..S GMRCDIAG=$P(GMRCMSG,"^",2)
"RTN","GMRCGUIC",48,0)
 ..S GMRCFLD(30)=$G(^GMR(123,+GMRCO,30))_"^30"
"RTN","GMRCGUIC",49,0)
 ..I $P(GMRCFLD(30),U)="" S $P(GMRCFLD(30),U)="No Previous Value"
"RTN","GMRCGUIC",50,0)
 ..I $L($P(GMRCMSG,U,3)) D
"RTN","GMRCGUIC",51,0)
 ...S GMRCDXCD=$P(GMRCMSG,"^",3)
"RTN","GMRCGUIC",52,0)
 ...S GMRCFLD(30.1)=$G(^GMR(123,+GMRCO,30.1))
"RTN","GMRCGUIC",53,0)
 .Q
"RTN","GMRCGUIC",54,0)
 S:'$D(GMRCLM) GMRCGUIF=1
"RTN","GMRCGUIC",55,0)
 D EN^GMRCEDT3(GMRCO)
"RTN","GMRCGUIC",56,0)
 S DR=$$SETDA^GMRCGUIU($G(GMRCSS),$G(GMRCPROC),$G(GMRCURG),$G(GMRCPL),$G(GMRCATN),$G(GMRCRQT),$G(GMRCION),$G(GMRCDIAG),$G(GMRCDXCD)) I $L(DR) D
"RTN","GMRCGUIC",57,0)
 .S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCGUIC",58,0)
 .L +^GMR(123,GMRCO)
"RTN","GMRCGUIC",59,0)
 .D ^DIE
"RTN","GMRCGUIC",60,0)
 .S DR="8////^S X=5;9////^S X=11"
"RTN","GMRCGUIC",61,0)
 .D ^DIE
"RTN","GMRCGUIC",62,0)
 .L -^GMR(123,GMRCO)
"RTN","GMRCGUIC",63,0)
 .K DIE,DR,DA
"RTN","GMRCGUIC",64,0)
 .Q
"RTN","GMRCGUIC",65,0)
 S DFN=$P(^GMR(123,+GMRCO,0),"^",2),GMRCPROV=$P(^(0),"^",14),GMRCTYPE=$P(^(0),"^",17),GMRCTRLC="XX^RESUBMIT",VISIT="",RMBED=""
"RTN","GMRCGUIC",66,0)
 D EN^GMRCHL7(DFN,+GMRCO,GMRCTYPE,RMBED,GMRCTRLC,$G(DUZ),VISIT,.GMRCOM)
"RTN","GMRCGUIC",67,0)
 S GMRCSVC=$S($G(GMRCSS):GMRCSS,1:$P(^GMR(123,+GMRCO,0),U,5))
"RTN","GMRCGUIC",68,0)
 S GMRCORTX="Resubmitted consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIC",69,0)
 S GMRCORTX=GMRCORTX_$S($G(GMRCURG):" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",+$P(^GMR(123,+GMRCO,0),U,9):"( "_$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),U,9),0),"^",2)_" )",1:"")
"RTN","GMRCGUIC",70,0)
 S GMRCFL=1
"RTN","GMRCGUIC",71,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,GMRCFL) ;Send notification of NEW consult
"RTN","GMRCGUIC",72,0)
 D PRNT^GMRCUTL1(+$P(^GMR(123,+GMRCO,0),U,5),+GMRCO) ;send 513 to service
"RTN","GMRCGUIC",73,0)
 ;Next line gets rid of alert
"RTN","GMRCGUIC",74,0)
 I $D(XQAID),$L(XQAID) D
"RTN","GMRCGUIC",75,0)
 . N GMRCCORY
"RTN","GMRCGUIC",76,0)
 . S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.GMRCCORY,XQAID)
"RTN","GMRCGUIC",77,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",78,0)
 Q
"RTN","GMRCGUIC",79,0)
SEND(GMRCO,GLOBAL) ;Get data fields to send to GUI for editing consult
"RTN","GMRCGUIC",80,0)
 ;GMRCO=record being edited GLOBAL=Global Referece, i.e., "^TMP("GMRCR",$J)"
"RTN","GMRCGUIC",81,0)
 K @GLOBAL
"RTN","GMRCGUIC",82,0)
 N ND,GMRCSX,TYPE
"RTN","GMRCGUIC",83,0)
 S ND=1,GMRCSX=""
"RTN","GMRCGUIC",84,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",85,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0)) Q:'$L(GMRC(0))
"RTN","GMRCGUIC",86,0)
 S GMRCSS=$P(GMRC(0),"^",5),GMRCPROC=$P(GMRC(0),"^",8)
"RTN","GMRCGUIC",87,0)
 S GMRCURG=$P(GMRC(0),"^",9),GMRCPL=$P(GMRC(0),"^",10)
"RTN","GMRCGUIC",88,0)
 S GMRCATN=$P(GMRC(0),"^",11),GMRCINO=$P(GMRC(0),"^",18)
"RTN","GMRCGUIC",89,0)
 S GMRCREQ=$P(GMRC(0),"^",17)
"RTN","GMRCGUIC",90,0)
 S GMRCDIAG=$G(^GMR(123,+GMRCO,30)) I $L($G(^(30.1))) D
"RTN","GMRCGUIC",91,0)
 . S GMRCDIAG=GMRCDIAG_U_$G(^GMR(123,+GMRCO,30.1))
"RTN","GMRCGUIC",92,0)
 S GMRCPROV=$S($P(^GMR(123,+GMRCO,0),U,14):$$GET1^DIQ(200,+$P(^(0),U,14),.01),1:"")
"RTN","GMRCGUIC",93,0)
 S @GLOBAL@(ND,0)="~SERVICE",ND=ND+1
"RTN","GMRCGUIC",94,0)
 I +GMRCSS S GMRCSX=$P(^GMR(123.5,GMRCSS,0),"^",1),@GLOBAL@(ND,0)="d"_GMRCSX_"^"_GMRCSS_"^",ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",95,0)
 E  S @GLOBAL@(ND,0)="d"_"^^",ND=ND+1
"RTN","GMRCGUIC",96,0)
 S @GLOBAL@(ND,0)="~PROCEDURE",ND=ND+1
"RTN","GMRCGUIC",97,0)
 I $L(GMRCPROC),+GMRCPROC D
"RTN","GMRCGUIC",98,0)
 .S GMRCSX=$$UP^XLFSTR($$GET1^DIQ(101,+GMRCPROC,1))
"RTN","GMRCGUIC",99,0)
 .S GMRCSY=$S($L(GMRCSX):$$FIND1^DIC(101.43,,"QX",GMRCSX,"S.PROC"),1:"")
"RTN","GMRCGUIC",100,0)
 .I +GMRCSY D
"RTN","GMRCGUIC",101,0)
 ..S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX,ND=ND+1
"RTN","GMRCGUIC",102,0)
 ..Q
"RTN","GMRCGUIC",103,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",104,0)
 S @GLOBAL@(ND,0)="~TYPE",ND=ND+1
"RTN","GMRCGUIC",105,0)
 I +GMRCREQ S GMRCSX=$P($P(^ORD(101,GMRCREQ,0),"^",1),"GMRCOR ",2),@GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCREQ,ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",106,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",107,0)
 S @GLOBAL@(ND,0)="~CATEGORY",ND=ND+1
"RTN","GMRCGUIC",108,0)
 I $L(GMRCINO) D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",109,0)
 .S @GLOBAL@(ND,0)="d"_GMRCINO_"^"_$S(GMRCINO="I":"INPATIENT",1:"OUTPATIENT")_"^"
"RTN","GMRCGUIC",110,0)
 .S @GLOBAL@(ND,0)=@GLOBAL@(ND,0)_$S(GMRCINO="I":$O(^ORD(101,"B","GMRCURGENCYM CSLT - INPATIENT",0)),1:$O(^ORD(101,"B","GMRCURGENCYM - OUTPATIENT",0)))
"RTN","GMRCGUIC",111,0)
 .Q
"RTN","GMRCGUIC",112,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",113,0)
 S @GLOBAL@(ND,0)="~DIAGNOSIS",ND=ND+1
"RTN","GMRCGUIC",114,0)
 I $L(GMRCDIAG) S @GLOBAL@(ND,0)="d"_GMRCDIAG,ND=ND+1
"RTN","GMRCGUIC",115,0)
 E  S @GLOBAL@(ND,0)="d"
"RTN","GMRCGUIC",116,0)
 S @GLOBAL@(ND,0)="~PLACE",ND=ND+1
"RTN","GMRCGUIC",117,0)
 I +GMRCPL D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",118,0)
 .S GMRCSX=$P($P(^ORD(101,GMRCPL,0),"^",1),"GMRCPLACE - ",2),GMRCSX=$S(GMRCSX="ON CALL":"CONSULTANTS CHOICE",1:GMRCSX),@GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCPL
"RTN","GMRCGUIC",119,0)
 .Q
"RTN","GMRCGUIC",120,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",121,0)
 S @GLOBAL@(ND,0)="~ATTENTION",ND=ND+1
"RTN","GMRCGUIC",122,0)
 I +GMRCATN S GMRCSX=$P(^VA(200,GMRCATN,0),"^",1),@GLOBAL@(ND,0)="d"_GMRCATN_"^"_GMRCSX_"^"_GMRCATN,ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",123,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",124,0)
 S @GLOBAL@(ND,0)="~URGENCY",ND=ND+1
"RTN","GMRCGUIC",125,0)
 I +GMRCURG S GMRCSX=$P($P(^ORD(101,GMRCURG,0),"^",1),"GMRCURGENCY - ",2),GMRCURGY=$O(^ORD(101.42,"S.GMRCO",GMRCSX,0)) I $L(GMRCSX) D
"RTN","GMRCGUIC",126,0)
 .S GMRCSY=$O(^ORD(101.42,"B",GMRCSX,0))
"RTN","GMRCGUIC",127,0)
 .S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX_"^"_GMRCURG,ND=ND+1
"RTN","GMRCGUIC",128,0)
 .S GMRCSX="" K GMRCSY
"RTN","GMRCGUIC",129,0)
 .Q
"RTN","GMRCGUIC",130,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",131,0)
 ;Get reason for request
"RTN","GMRCGUIC",132,0)
 S @GLOBAL@(ND,0)="~REASON",ND=ND+1
"RTN","GMRCGUIC",133,0)
 I $O(^GMR(123,+GMRCO,20,0)) S NDX=0 F  S NDX=$O(^GMR(123,+GMRCO,20,NDX)) Q:NDX=""  S @GLOBAL@(ND,0)="t"_^GMR(123,+GMRCO,20,NDX,0),ND=ND+1
"RTN","GMRCGUIC",134,0)
 E  S @GLOBAL@(ND,0)="~REASON",ND=ND+1,@GLOBAL@(ND,0)="tREASON "
"RTN","GMRCGUIC",135,0)
 ;Get Comments, including Deny Comments
"RTN","GMRCGUIC",136,0)
 D SENDCOMT^GMRCGUIU(GMRCO,.ND)
"RTN","GMRCGUIC",137,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",138,0)
 Q
"RTN","GMRCGUIU")
0^11^B13213484
"RTN","GMRCGUIU",1,0)
GMRCGUIU ;SLC/DCM - Kill off variables from GUI routines; 12/18/98 14:19
"RTN","GMRCGUIU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12**;DEC 27, 1997
"RTN","GMRCGUIU",3,0)
GUIC ;Kill variables from GMRCGUIC
"RTN","GMRCGUIU",4,0)
 K GMRC(0),GMRCA,GMRCATN,GMRCD,GMRCDD,GMRCDIAG,GMRCDT,GMRCED,GMRCEDCM
"RTN","GMRCGUIU",5,0)
 K GMRCFL,GMRCFLD,GMRCION,GMRCLNO,GMRCNATO,GMRCNT,GMRCORTX,GMRCPL
"RTN","GMRCGUIU",6,0)
 K GMRCPROC,GMRCRQT,GMRCS38,GMRCSS,GMRCSVC,GMRCTRLC,GMRCTYPE,GMRCURG
"RTN","GMRCGUIU",7,0)
 K GMRCX,LN,GMRCADUZ,ORDG,RMBED,VISIT
"RTN","GMRCGUIU",8,0)
 K GMRCITM,GMRCMSG,GMRCND1,GMRCNOD,GMRCPROV,GMRCOUNT,GMRCGUIF,GMRCREQ
"RTN","GMRCGUIU",9,0)
 K GMRCSS,GMRCPROC,GMRCURG,GMRCURGY,GMRCPL,GMRCATN,GMRCINO,GMRCREQ
"RTN","GMRCGUIU",10,0)
 K GMRCDIAG,GMRCDXCD,GMRCPROV,ND,NDX
"RTN","GMRCGUIU",11,0)
 K XQAKILL
"RTN","GMRCGUIU",12,0)
 Q
"RTN","GMRCGUIU",13,0)
SETDA(GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCRQT,GMRCION,GMRCDIAG,GMRCDXCD)  ;Set DA in ^GMR(123,GMRCO,40
"RTN","GMRCGUIU",14,0)
 N X
"RTN","GMRCGUIU",15,0)
 S X=""
"RTN","GMRCGUIU",16,0)
 I +GMRCSS S X="1////^S X=+GMRCSS;.1///@;"
"RTN","GMRCGUIU",17,0)
 I +GMRCPROC S X=X_"4////^S X=GMRCPROC;.1///@;"
"RTN","GMRCGUIU",18,0)
 I +GMRCURG S X=X_"5////^S X=GMRCURG;"
"RTN","GMRCGUIU",19,0)
 I +GMRCPL S X=X_"6////^S X=GMRCPL;"
"RTN","GMRCGUIU",20,0)
 I +GMRCATN S X=X_"7////^S X=GMRCATN;"
"RTN","GMRCGUIU",21,0)
 I $G(GMRCATN)="@" S X=X_"7///@;"
"RTN","GMRCGUIU",22,0)
 I $L(GMRCION) S X=X_"14///^S X=GMRCION;"
"RTN","GMRCGUIU",23,0)
 I $L(GMRCDIAG) D 
"RTN","GMRCGUIU",24,0)
 . I GMRCDIAG="@" S X=X_"30///@;30.1///@;" Q
"RTN","GMRCGUIU",25,0)
 . S X=X_"30////^S X=GMRCDIAG;"
"RTN","GMRCGUIU",26,0)
 I $L(GMRCDXCD) S X=X_"30.1////^S X=GMRCDXCD;"
"RTN","GMRCGUIU",27,0)
 I $L(X) S X=$E(X,1,$L(X)-1)
"RTN","GMRCGUIU",28,0)
 Q X
"RTN","GMRCGUIU",29,0)
 ;
"RTN","GMRCGUIU",30,0)
COMMENT(GMRCO,MSG,ND,GMRCDA)    ;File comments from GUI edits
"RTN","GMRCGUIU",31,0)
 N Y
"RTN","GMRCGUIU",32,0)
 S GMRCDA=$$ADDCM^GMRCEDT4(GMRCO),GMRCA=20
"RTN","GMRCGUIU",33,0)
 D AUDIT0^GMRCEDT4(GMRCDA,GMRCO)
"RTN","GMRCGUIU",34,0)
 S Y=$$FMTE^XLFDT(DT,"1D"),GMRCFLD(40)="COMMENT ADDED: "_Y_"^"_GMRCDA
"RTN","GMRCGUIU",35,0)
 S GMRCND="",GMRCNT=1 F  S GMRCND=$O(@MSG@(ND,GMRCND)) Q:GMRCND=""  S ^GMR(123,GMRCO,40,GMRCDA,1,GMRCNT,0)=@MSG@(ND,GMRCND),GMRCNT=GMRCNT+1
"RTN","GMRCGUIU",36,0)
 S ^GMR(123,GMRCO,40,GMRCDA,1,0)="^^"_(GMRCNT-1)_"^"_(GMRCNT-1)_"^"_GMRCDT_"^"
"RTN","GMRCGUIU",37,0)
 Q
"RTN","GMRCGUIU",38,0)
 ;
"RTN","GMRCGUIU",39,0)
SENDCOMT(GMRCO,ND1)     ;Get comments
"RTN","GMRCGUIU",40,0)
 N NDX,NDY,CMTDT,SENDR,TYPE
"RTN","GMRCGUIU",41,0)
 S NDX=0,CMTDT="",SENDR=""
"RTN","GMRCGUIU",42,0)
 S NDX=0 F  S NDX=$O(^GMR(123,GMRCO,40,NDX)) Q:NDX?1A.E!(NDX="")  S TYPE=$P(^GMR(123,GMRCO,40,NDX,0),"^",2) I $S(TYPE=19:1,TYPE=20:1,1:0) S TYPE(TYPE,NDX)=""
"RTN","GMRCGUIU",43,0)
 I $O(TYPE(19,0)) S @GLOBAL@(ND1,0)="~DENY COMMENT",ND1=ND1+1 D
"RTN","GMRCGUIU",44,0)
 .S NDX=0 F  S NDX=$O(TYPE(19,NDX)) Q:NDX=""   D
"RTN","GMRCGUIU",45,0)
 ..S CMTDT=$$FMTE^XLFDT($P(^GMR(123,GMRCO,40,NDX,0),"^",1)),SENDR=$S($L($P(^GMR(123,GMRCO,40,NDX,0),"^",4)):$P(^VA(200,$P(^(0),"^",4),0),"^",1),1:"Missing Data")
"RTN","GMRCGUIU",46,0)
 ..S @GLOBAL@(ND1,0)="t"_"CANCELLED: "_CMTDT_" BY: "_SENDR,ND1=ND1+1,NDY=0
"RTN","GMRCGUIU",47,0)
 ..S NDY=0 F  S NDY=$O(^GMR(123,GMRCO,40,NDX,1,NDY)) Q:NDY=""  S @GLOBAL@(ND1,0)="t"_^GMR(123,GMRCO,40,NDX,1,NDY,0),ND1=ND1+1
"RTN","GMRCGUIU",48,0)
 ..S @GLOBAL@(ND1,0)="t",$P(@GLOBAL@(ND1,0),"-",81)="",ND1=ND1+1
"RTN","GMRCGUIU",49,0)
 ..Q
"RTN","GMRCGUIU",50,0)
 .Q
"RTN","GMRCGUIU",51,0)
 S NDX=0 F  S NDX=$O(TYPE(20,NDX)) Q:NDX=""  S @GLOBAL@(ND1,0)="~ADDED COMMENT",ND1=ND1+1 D
"RTN","GMRCGUIU",52,0)
 .S CMTDT=$$FMTE^XLFDT($P(^GMR(123,GMRCO,40,NDX,0),"^",1)),SENDR=$S($L($P(^GMR(123,GMRCO,40,NDX,0),"^",4)):$P(^VA(200,$P(^GMR(123,GMRCO,40,NDX,0),"^",4),0),"^",1),1:"UNKNOWN")
"RTN","GMRCGUIU",53,0)
 .S @GLOBAL@(ND1,0)="t"_"COMMENT on "_CMTDT_" BY: "_SENDR,ND1=ND1+1
"RTN","GMRCGUIU",54,0)
 .S NDY=0 F  S NDY=$O(^GMR(123,GMRCO,40,NDX,1,NDY)) Q:NDY=""  S @GLOBAL@(ND,0)="t"_^GMR(123,GMRCO,40,NDX,1,NDY,0),ND1=ND1+1
"RTN","GMRCGUIU",55,0)
 .S @GLOBAL@(ND1,0)="t",$P(@GLOBAL@(ND1,0),"-",81)="",ND1=ND1+1
"RTN","GMRCGUIU",56,0)
 .Q
"RTN","GMRCGUIU",57,0)
 Q
"RTN","GMRCHL7")
0^2^B30345234
"RTN","GMRCHL7",1,0)
GMRCHL7 ;SLC/DCM,JFR - HL-7 formatting routine for consult information to be passed to OER ;2/24/00  11:52
"RTN","GMRCHL7",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12**;DEC 27, 1997
"RTN","GMRCHL7",3,0)
 ;;Format the HL-7 Message header
"RTN","GMRCHL7",4,0)
 Q
"RTN","GMRCHL7",5,0)
INIT S HLQ=""""""
"RTN","GMRCHL7",6,0)
 S SEP1="|",SEP2="^",SEP3="~",SEP4="\",SEP5="&"
"RTN","GMRCHL7",7,0)
 Q
"RTN","GMRCHL7",8,0)
MSH(X) ;Format MSH segment of HL-7 message.
"RTN","GMRCHL7",9,0)
 ;FROM=GMRC CONSULTS - the sending application
"RTN","GMRCHL7",10,0)
 N X
"RTN","GMRCHL7",11,0)
 I '$D(HLQ) D INIT
"RTN","GMRCHL7",12,0)
 S X="MSH|^~\&|CONSULTS|"_$S(+$G(DUZ(2)):DUZ(2),1:$$SITE^VASITE())_"|||||ORM"
"RTN","GMRCHL7",13,0)
 Q X
"RTN","GMRCHL7",14,0)
PID(GMRCIEN) ;Format the HL-7 PID segment
"RTN","GMRCHL7",15,0)
 ;GMRCIEN=IEN of consult from File 123
"RTN","GMRCHL7",16,0)
 N X
"RTN","GMRCHL7",17,0)
 S GMRCDPT=$P(^GMR(123,GMRCIEN,0),"^",2)
"RTN","GMRCHL7",18,0)
 S GMRCPTN=$P($G(^DPT(GMRCDPT,0)),"^")
"RTN","GMRCHL7",19,0)
 S X="PID|||"_+GMRCDPT_"||"_GMRCPTN
"RTN","GMRCHL7",20,0)
 K GMRCDPT,GMRCPTN
"RTN","GMRCHL7",21,0)
 Q X
"RTN","GMRCHL7",22,0)
PV1(GMRCIEN,RMBED,VISIT) ;Format the HL-7 PV1 segment
"RTN","GMRCHL7",23,0)
 N GMRCSTS,SEP1,X,Y
"RTN","GMRCHL7",24,0)
 S HOSPLOC=$P(^GMR(123,GMRCIEN,0),"^",4)
"RTN","GMRCHL7",25,0)
 S VISIT=$$HL7DT(VISIT),GMRCSTS=$S($P(^GMR(123,GMRCIEN,0),"^",18)]"":$P(^(0),"^",18),HOSPLOC]"":"I",1:"O")
"RTN","GMRCHL7",26,0)
 S X="PV1"_"||"_GMRCSTS_"|"_$S(HOSPLOC]"":HOSPLOC,1:"")_"^"_$S(RMBED]"":RMBED,1:"")_"|"_$S(VISIT]"":VISIT,1:"")
"RTN","GMRCHL7",27,0)
 K Y,HOSPLOC,VISIT,GMRCSTS
"RTN","GMRCHL7",28,0)
 Q X
"RTN","GMRCHL7",29,0)
NTE(NTE,ND) ;Format the HL-7 NTE segment
"RTN","GMRCHL7",30,0)
 Q:'$D(NTE)  Q:'$O(NTE(0))
"RTN","GMRCHL7",31,0)
 S GMRCND=1,GMRCND1=0 D
"RTN","GMRCHL7",32,0)
 .S GMRCND1=$O(NTE(GMRCND1)),@(MSG_"("_ND_")")=NTE(GMRCND1)
"RTN","GMRCHL7",33,0)
 .F  S GMRCND1=$O(NTE(GMRCND1)) Q:GMRCND1=""  I NTE(GMRCND1)]"" S @(MSG_"("_ND_","_GMRCND_")")=NTE(GMRCND1),GMRCND=GMRCND+1
"RTN","GMRCHL7",34,0)
 .Q
"RTN","GMRCHL7",35,0)
 Q
"RTN","GMRCHL7",36,0)
EN(PATID,GMRCIEN,GMRCRTYP,RMBED,ORCTRL,GMRCPLCR,VISIT,GMRCOM,GRPUPD,ACTDT) ;;Main entry point
"RTN","GMRCHL7",37,0)
 ;PATID=DFN - Patients internal entry number from ^DPT(
"RTN","GMRCHL7",38,0)
 ;GMRCIEN=IEN of consult, from File 123
"RTN","GMRCHL7",39,0)
 ;RMBED=Hospital Room/Bed if patient is hospitalized
"RTN","GMRCHL7",40,0)
 ;ORCTRL=Code from HL-7 table 119 (Appendix A) Order Control Codes
"RTN","GMRCHL7",41,0)
 ;VISIT=Visit as a DATE/TIME in Fileman Format.
"RTN","GMRCHL7",42,0)
 ;GMRCPROV=Provider - IEN from file 200
"RTN","GMRCHL7",43,0)
 ;GMRCRTYP=consult type: GMRC REQUEST or GMRC CONSULT
"RTN","GMRCHL7",44,0)
 ;GMRCPLCR=who is entering the order ; usually passed as DUZ for new order, "" for existing order
"RTN","GMRCHL7",45,0)
 ;GMRCOM=comment array flag: 1 if there is comment array, 0 otherwise
"RTN","GMRCHL7",46,0)
 ;GMRCOM(0)=DA of where comment is located: ^GMR(123,IEN,40,DA,
"RTN","GMRCHL7",47,0)
 ;GRPUPD = group update of consults - sends nature as MAINTENANCE
"RTN","GMRCHL7",48,0)
 ;ACTDT = date/time of activity if sent
"RTN","GMRCHL7",49,0)
 Q:'$L(ORCTRL)
"RTN","GMRCHL7",50,0)
 K GMRCMSS
"RTN","GMRCHL7",51,0)
 N MSG,MSH,PID,PV1,ORC,NTE,OBR,OBX,ZSV,GMRCA,GMRCURGI,GMRCPLI
"RTN","GMRCHL7",52,0)
 N GMRCPR,GMRCSS,GMRCTYPE,ORCPLCR
"RTN","GMRCHL7",53,0)
 S MSH="",MSH=$$MSH(MSH)
"RTN","GMRCHL7",54,0)
 S PID=$$PID(GMRCIEN)
"RTN","GMRCHL7",55,0)
 I ORCTRL'="Z@" S PV1=$$PV1(GMRCIEN,RMBED,VISIT)
"RTN","GMRCHL7",56,0)
 D ORC(GMRCIEN,ORCTRL,GMRCPLCR,$G(GRPUPD),$G(ACTDT))
"RTN","GMRCHL7",57,0)
 S ORCTRL=$P(ORCTRL,U)
"RTN","GMRCHL7",58,0)
 I ORCTRL="Z@" S ORC=$P(ORC,SEP1,1,4)
"RTN","GMRCHL7",59,0)
 D:ORCTRL'="Z@" OBR^GMRCHL72(GMRCIEN,$G(GMRCAUTH),$G(ACTDT))
"RTN","GMRCHL7",60,0)
 ;GMRCAUTH=principle results interpreter
"RTN","GMRCHL7",61,0)
 D ZSV(GMRCIEN)
"RTN","GMRCHL7",62,0)
 I $S(ORCTRL="SN":1,ORCTRL="RE":1,ORCTRL="XX":1,1:0) D OBX^GMRCHL72(GMRCIEN)
"RTN","GMRCHL7",63,0)
 I $S(ORCTRL="OC":1,ORCTRL="OD":1,ORCTRL="XX":1,ORCTRL="SC":1,1:0),$G(GMRCOM(0)) D NTE^GMRCHL72(GMRCIEN,.GMRCOM,ORCTRL)
"RTN","GMRCHL7",64,0)
 D BLD(MSH,PID,$G(PV1),$G(ORC),$G(OBR),$G(ZSV),.OBX,.NTE,ORCTRL)
"RTN","GMRCHL7",65,0)
 ;M GMRCMSS=GMRCMSG ;HL-7 message debugging aid - remove from final version
"RTN","GMRCHL7",66,0)
 D MSG^XQOR("GMRC EVSEND OR",.GMRCMSG)
"RTN","GMRCHL7",67,0)
 K GMRCND,GMRCND1,GMRCMSG,GMRCNOD,GMRCORFN,GMRCPLI,GMRCPRI,HL7DT,HLQ,J,ND,ND1,ND2,NOTIFY,OBXND,OBXNO,ORCACT,ORCDT,ORURG,SEP1,SEP2,SEP3,SEP4,SEP5
"RTN","GMRCHL7",68,0)
 Q
"RTN","GMRCHL7",69,0)
BLD(MSH,PID,PV1,ORC,OBR,ZSV,OBX,NTE,CTRLCD) ;Build the HL-7 message global to pass to OR
"RTN","GMRCHL7",70,0)
 S MSG="GMRCMSG",ND=1
"RTN","GMRCHL7",71,0)
 K @(MSG)
"RTN","GMRCHL7",72,0)
 F J="MSH","PID","PV1" I $G(@J)]"" S @(MSG_"("_ND_")")=@J,ND=ND+1
"RTN","GMRCHL7",73,0)
 I ORC]"" S @(MSG_"("_ND_")")=ORC,ND=ND+1
"RTN","GMRCHL7",74,0)
 I $D(NTE),$O(NTE(0)) D NTE(.NTE,ND) S ND=ND+1
"RTN","GMRCHL7",75,0)
 I OBR]"" S @(MSG_"("_ND_")")=OBR,ND=ND+1
"RTN","GMRCHL7",76,0)
 I $L($G(ZSV)) S @(MSG_"("_ND_")")=ZSV,ND=ND+1
"RTN","GMRCHL7",77,0)
 I $O(OBX("")) S OBXND=0 D
"RTN","GMRCHL7",78,0)
 .S OBXND=$O(OBX(OBXND)) Q:OBXND=""  S @(MSG_"("_ND_")")=OBX(OBXND)
"RTN","GMRCHL7",79,0)
 .S GMRCND1=0 F  S GMRCND1=$O(OBX(OBXND,GMRCND1)) Q:GMRCND1=""  S @(MSG_"("_ND_","_GMRCND1_")")=OBX(OBXND,GMRCND1)
"RTN","GMRCHL7",80,0)
 .S ND=ND+1,OBXND=$O(OBX(OBXND)) I $L(OBXND) S @(MSG_"("_ND_")")=OBX(OBXND)
"RTN","GMRCHL7",81,0)
 .Q
"RTN","GMRCHL7",82,0)
 ;I CTRLCD'="XX",$D(NTE),$O(NTE(0)) D NTE(.NTE,ND) S ND=ND+1
"RTN","GMRCHL7",83,0)
 Q
"RTN","GMRCHL7",84,0)
HL7DT(DATE) ;Convert Fileman Date to HL-7 Date
"RTN","GMRCHL7",85,0)
 N X
"RTN","GMRCHL7",86,0)
 S X="" I DATE S X=17000000+$P(DATE,".",1)_$P(DATE,".",2)
"RTN","GMRCHL7",87,0)
 Q X
"RTN","GMRCHL7",88,0)
FMDATE(DATE) ;Convert HL-7 formatted date to a Fileman formatted date
"RTN","GMRCHL7",89,0)
 N X
"RTN","GMRCHL7",90,0)
 S X="" I DATE D
"RTN","GMRCHL7",91,0)
 . S X=($E(DATE,1,8)-17000000)_$S($L($E(DATE,9)):"."_$E(DATE,9,14),1:"")
"RTN","GMRCHL7",92,0)
 Q X
"RTN","GMRCHL7",93,0)
ORC(GMRCIEN,GMRCTRL,ORCPLCR,MAINT,GMRCDT) ;Build ORC segment of HL-7 msg
"RTN","GMRCHL7",94,0)
 ;GMRCTRL=Order Control Code (table 119)
"RTN","GMRCHL7",95,0)
 ;GMRCIEN=File 123 IEN
"RTN","GMRCHL7",96,0)
 ;ORPLCR=GMRCPLCR - the person entering the order
"RTN","GMRCHL7",97,0)
 ;MAINT=1 - group update of requests
"RTN","GMRCHL7",98,0)
 ;GMRCDT=date/time of activity 
"RTN","GMRCHL7",99,0)
 N GMRCURG,ORCACT,ORCDT,ORCPRV,ORCDT,ORIEN,ORCSTS,STS,ORCNATR,QUANT,REAS
"RTN","GMRCHL7",100,0)
 S REAS=$P(GMRCTRL,U,2),GMRCTRL=$P(GMRCTRL,U)
"RTN","GMRCHL7",101,0)
 S ORCDT=$P(^GMR(123,GMRCIEN,0),"^",7),ORCPRV=$P(^GMR(123,GMRCIEN,0),"^",14),ORURG=$P(^(0),"^",9),ORURG=$S(ORURG]"":$P(^ORD(101,ORURG,0),"^",1),1:"") S:ORURG]"" ORURG=$P(ORURG," - ",2)
"RTN","GMRCHL7",102,0)
 S ORURG=$S(ORURG="EMERGENCY":"STAT",ORURG="NOW":"STAT",ORURG="OUTPATIENT":"ROUTINE",1:ORURG)
"RTN","GMRCHL7",103,0)
 S:ORURG="" GMRCURG="" I ORURG]"" S GMRCURG=$O(^ORD(101.42,"B",ORURG,0)),GMRCURG=$S(+GMRCURG:$P(^ORD(101.42,GMRCURG,0),"^",2),1:"")
"RTN","GMRCHL7",104,0)
 S ORCDT=$$HL7DT(ORCDT)
"RTN","GMRCHL7",105,0)
 I '$G(GMRCDT) S GMRCDT=$$NOW^XLFDT
"RTN","GMRCHL7",106,0)
 S STS=$P(^GMR(123,GMRCIEN,0),"^",12)
"RTN","GMRCHL7",107,0)
 S ORCACT=$P($G(^ORD(100.01,+STS,0)),U,1) S:'$L(ORCACT) ORCACT="NO STATUS"
"RTN","GMRCHL7",108,0)
 S ORIEN=$P(^GMR(123,GMRCIEN,0),"^",3)
"RTN","GMRCHL7",109,0)
 S ORCSTS=$S(STS=1:"DC",STS=2:"CM",STS=5:"IP",STS=6:"SC",STS=9:"A",STS=12:"RP",STS=13:"CA",STS=8:"ZC",1:"IP")
"RTN","GMRCHL7",110,0)
 S ORCNATR=""
"RTN","GMRCHL7",111,0)
 I GMRCTRL="XX" S ORCNATR="S^SERVICE CORRECTION^99ORN^^"_REAS_"^"
"RTN","GMRCHL7",112,0)
 I $G(MAINT) S ORCNATR="M^MAINTENANCE^99ORN^^^"
"RTN","GMRCHL7",113,0)
 ;References to GMRCXMF refer to foreign facility sending of messages
"RTN","GMRCHL7",114,0)
 ;Need to work out details of which ien: local or foreign processing
"RTN","GMRCHL7",115,0)
 I $D(GMRCXMF),$P(^GMR(123,GMRCIEN,0),"^",22) S GMRCOFN=GMRCIEN N GMRCIEN S GMRCIEN=$P(^(0),"^",22)
"RTN","GMRCHL7",116,0)
 S QUANT=$S(GMRCURG]"":"^^^^^"_GMRCURG,1:"")
"RTN","GMRCHL7",117,0)
 S GMRCDT=$$HL7DT(GMRCDT)
"RTN","GMRCHL7",118,0)
 S ORC="ORC|"_GMRCTRL_"|"_$S(ORIEN]"":ORIEN_";1^OR",1:"")_"|"
"RTN","GMRCHL7",119,0)
 S ORC=ORC_GMRCIEN_";GMRC^"_"GMRC"_"||"_ORCSTS_"||"_QUANT_"||"
"RTN","GMRCHL7",120,0)
 S ORC=ORC_GMRCDT_"|"_ORCPLCR_"||"_ORCPRV_"|||"_ORCDT_"|"_ORCNATR
"RTN","GMRCHL7",121,0)
 Q
"RTN","GMRCHL7",122,0)
ZSV(GMRCO) ;build ZSV segment for at least forward
"RTN","GMRCHL7",123,0)
 N SERV,SERVNM,CTYPE
"RTN","GMRCHL7",124,0)
 S SERV=$P($G(^GMR(123,GMRCO,0)),U,5)
"RTN","GMRCHL7",125,0)
 I 'SERV Q
"RTN","GMRCHL7",126,0)
 S SERVNM=$P($G(^GMR(123.5,SERV,0)),U)
"RTN","GMRCHL7",127,0)
 S CTYPE=$G(^GMR(123,GMRCO,1.11))
"RTN","GMRCHL7",128,0)
 I CTYPE=SERVNM S CTYPE=""
"RTN","GMRCHL7",129,0)
 I $P(^GMR(123,GMRCO,0),U,8) S CTYPE=""
"RTN","GMRCHL7",130,0)
 S ZSV="ZSV|^^^"_SERV_U_SERVNM_"^99CON|"_CTYPE
"RTN","GMRCHL7",131,0)
 Q
"RTN","GMRCHL72")
0^17^B14027940
"RTN","GMRCHL72",1,0)
GMRCHL72 ;SLC/DCM - HL-7 formats OBX and NTE segments ;10/12/99  03:53
"RTN","GMRCHL72",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12**;DEC 27, 1997
"RTN","GMRCHL72",3,0)
OBX(GMRCIFN) ;Build the OBX segment of the HL-7 message
"RTN","GMRCHL72",4,0)
 ;GMRCIFN=GMRCIEN - the internal file # of the record from file 123
"RTN","GMRCHL72",5,0)
 S OBXSEGNO=0
"RTN","GMRCHL72",6,0)
 I ORCTRL'="RT",$D(^GMR(123,GMRCIFN,20,0)) S GMRCND=0,GMRCND1=0 D
"RTN","GMRCHL72",7,0)
 . S OBXSEGNO=OBXSEGNO+1
"RTN","GMRCHL72",8,0)
 . S GMRCND=$O(^GMR(123,GMRCIFN,20,GMRCND))
"RTN","GMRCHL72",9,0)
 . S OBX(OBXSEGNO)="OBX|"_OBXSEGNO
"RTN","GMRCHL72",10,0)
 . S OBX(OBXSEGNO)=OBX(OBXSEGNO)_"|TX|2000.02^REASON FOR REQUEST^AS4||"
"RTN","GMRCHL72",11,0)
 . S OBX(OBXSEGNO)=OBX(OBXSEGNO)_^GMR(123,GMRCIFN,20,GMRCND,0)
"RTN","GMRCHL72",12,0)
 . S GMRCND1=GMRCND1+1
"RTN","GMRCHL72",13,0)
 . F  S GMRCND=$O(^GMR(123,GMRCIFN,20,GMRCND)) Q:GMRCND=""  D
"RTN","GMRCHL72",14,0)
 .. S OBX(OBXSEGNO,GMRCND1)=^GMR(123,GMRCIFN,20,GMRCND,0)
"RTN","GMRCHL72",15,0)
 .. S GMRCND1=GMRCND1+1
"RTN","GMRCHL72",16,0)
 .Q
"RTN","GMRCHL72",17,0)
 I $D(^GMR(123,GMRCIFN,30)) S OBXSEGNO=OBXSEGNO+1 D
"RTN","GMRCHL72",18,0)
 . S OBX(OBXSEGNO)="OBX|"_OBXSEGNO
"RTN","GMRCHL72",19,0)
 . N OBXSEG
"RTN","GMRCHL72",20,0)
 . I '$D(^GMR(123,GMRCIFN,30.1)) D
"RTN","GMRCHL72",21,0)
 .. S OBXSEG="|TX|^PROVISIONAL DIAGNOSIS^||"_$G(^GMR(123,GMRCIFN,30))
"RTN","GMRCHL72",22,0)
 . I $D(^GMR(123,GMRCIFN,30.1)) D
"RTN","GMRCHL72",23,0)
 .. S OBXSEG="|CE|^PROVISIONAL DIAGNOSIS^||"_^GMR(123,GMRCIFN,30.1)_U
"RTN","GMRCHL72",24,0)
 .. S OBXSEG=OBXSEG_$P(^GMR(123,GMRCIFN,30),(" ("_^(30.1)))_U_"I9C"
"RTN","GMRCHL72",25,0)
 . S OBX(OBXSEGNO)=OBX(OBXSEGNO)_OBXSEG
"RTN","GMRCHL72",26,0)
 Q
"RTN","GMRCHL72",27,0)
 ;
"RTN","GMRCHL72",28,0)
NTE(GMRCFN,GMRCND,GMRCTRL) ;Build the NTE segment of the HL7 message
"RTN","GMRCHL72",29,0)
 ;GMRCND=GMRCOM, an array. GMRCND = flag that a comment exists.
"RTN","GMRCHL72",30,0)
 ;GMRCND(0)= DA = the internal entry in node 40: ^GMR(123,IEN,40,DA
"RTN","GMRCHL72",31,0)
 ;GMRCTRL=HL7 control code from table 119
"RTN","GMRCHL72",32,0)
 Q:'$D(GMRCND(0))  S ND=GMRCND(0)
"RTN","GMRCHL72",33,0)
 S ND2=1,NTE(ND2)="NTE|16|L|"
"RTN","GMRCHL72",34,0)
 I $S($P(^GMR(123,GMRCFN,40,ND,0),"^",2)=6:1,$P(^(0),"^",2)=20:1,$P(^(0),"^",2)=7:1,$P(^(0),"^",2)=5:1,GMRCTRL="XX":1,1:0) D
"RTN","GMRCHL72",35,0)
 .S ND1=0,ND1=$O(^GMR(123,GMRCFN,40,ND,1,ND1)) Q:ND1=""  S NTE(ND2)=NTE(ND2)_^GMR(123,GMRCFN,40,ND,1,ND1,0),ND2=ND2+1
"RTN","GMRCHL72",36,0)
 .F  S ND1=$O(^GMR(123,GMRCFN,40,ND,1,ND1)) Q:ND1=""  S NTE(ND2)=^GMR(123,GMRCFN,40,ND,1,ND1,0),ND2=ND2+1
"RTN","GMRCHL72",37,0)
 .Q
"RTN","GMRCHL72",38,0)
 I $P(NTE(1),"|",4)="",$S(GMRCTRL="OD":1,GMRCTRL="OC":1,1:0) S $P(NTE(1),"|",4)=$P(^GMR(123.1,$P(^GMR(123,GMRCFN,40,ND,0),"^",2),0),"^",1)_$S($P(^(0),"^",2)]"":" BY SERVICE",1:"")
"RTN","GMRCHL72",39,0)
 I $P(NTE(1),"|",4)="",GMRCTRL="XX" S $P(NTE(1),"|",4)=$P(^GMR(123.1,$P(^GMR(123,GMRCFN,40,ND,0),"^",2),0),"^",1)_" "_$S($P(^GMR(123,GMRCFN,40,ND,0),"^",6)]"":$P(^GMR(123.5,$P(^GMR(123,GMRCFN,40,ND,0),"^",6),0),"^",1),1:GMRCSSNM)
"RTN","GMRCHL72",40,0)
 K N,ND1,ND2
"RTN","GMRCHL72",41,0)
 Q
"RTN","GMRCHL72",42,0)
OBR(GMRCIEN,RESBY,GMRCACDT) ;Build the OBR segment of the HL-7 message
"RTN","GMRCHL72",43,0)
 ;GMRCIEN=IEN of the consult from file 123
"RTN","GMRCHL72",44,0)
 ;NOTIFY=Person who is notified when consult is ordered/completed
"RTN","GMRCHL72",45,0)
 ;RESBY=Person entering/interpreting result & signing report- GMRCPROV
"RTN","GMRCHL72",46,0)
 K OBR
"RTN","GMRCHL72",47,0)
 N OI,PROCID,PROCNM,STS,RESTATUS,SERVID,ORCDT,CONLOC,CONSVC,HL7DT
"RTN","GMRCHL72",48,0)
 ;I +$P(^GMR(123,GMRCIEN,0),"^",5)'>0,$S($D(GMRCSSNM):1,+GMRCGRP("ROOT"):1,1:0) S $P(^(0),"^",5)=$S(+GMRCGRP("ROOT"):GMRCGRP("ROOT"),1:$O(^GMR(123.5,"B",GMRCSSNM,0)))
"RTN","GMRCHL72",49,0)
 S STS=$P(^GMR(123,GMRCIEN,0),"^",12),RESTATUS=$S(STS=1:"X",STS=2:"F",STS=5:"O",STS=6:"I",STS=8:"S",STS=9:"R",1:"X")
"RTN","GMRCHL72",50,0)
 S SERVID=$P(^GMR(123,GMRCIEN,0),"^",5),ORCDT=$P(^(0),"^",7),CONLOC=$P(^(0),"^",10) I CONLOC]"" S CONLOC=$S($P(^ORD(101,CONLOC,0),"^",1)["BEDSIDE":"B",$P(^(0),"^",1)["EMERGENCY":"E",1:"OC")
"RTN","GMRCHL72",51,0)
 S NOTIFY=$P(^GMR(123,GMRCIEN,0),"^",11),CONSVC=$S(+SERVID]"":$P($G(^GMR(123.5,+SERVID,0)),"^",1),1:"")
"RTN","GMRCHL72",52,0)
 I +$P(^GMR(123,+GMRCIEN,0),U,8) D
"RTN","GMRCHL72",53,0)
 . S PROCID=+$P(^GMR(123,+GMRCIEN,0),U,8)
"RTN","GMRCHL72",54,0)
 . S PROCNM=$$GET1^DIQ(101,PROCID,1)
"RTN","GMRCHL72",55,0)
 . S OI=PROCID_U_PROCNM_"^99PRO"
"RTN","GMRCHL72",56,0)
 I '$D(OI) S OI=SERVID_U_CONSVC_"^99CON"
"RTN","GMRCHL72",57,0)
 S HL7DT=$$HL7DT^GMRCHL7($S($G(GMRCACDT):GMRCACDT,1:$$NOW^XLFDT))
"RTN","GMRCHL72",58,0)
 S OBR="OBR||||^^^"_OI_"||||||||||||||"_CONLOC_"|"_NOTIFY_"|||"_HL7DT_"|||"_RESTATUS_$S(RESBY]"":"|||||||"_RESBY,1:"")
"RTN","GMRCHL72",59,0)
 K STS,RESTATUS,SERVID,ORCDT,CONLOC,CONSVC,HL7DT
"RTN","GMRCHL72",60,0)
 Q
"RTN","GMRCHL7A")
0^3^B29948326
"RTN","GMRCHL7A",1,0)
GMRCHL7A ;SLC/DCM - Receive HL-7 Message form OERR and break it into its components and store it in File 123 ;3/5/99 15:25
"RTN","GMRCHL7A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12**;DEC 27, 1997
"RTN","GMRCHL7A",3,0)
URG(X) ;Return Urgency give Z-code from HL-7 segment; see ORC+9
"RTN","GMRCHL7A",4,0)
 S X=$S(X="S":"STAT",X="R":"ROUTINE",X="ZT":"TODAY",X="Z24":"WITHIN 24 HOURS",X="Z48":"WITHIN 48 HOURS",X="Z72":"WITHIN 72 HOURS",X="ZW":"WITHIN 1 WEEK",X="ZM":"WITHIN 1 MONTH",X="ZNA":"NEXT AVAILABLE",1:X)
"RTN","GMRCHL7A",5,0)
 I $E(X,1)="Z" S X=$S(X="ZT":"TODAY",X="ZE":"EMERGENCY",1:"")
"RTN","GMRCHL7A",6,0)
 Q X
"RTN","GMRCHL7A",7,0)
 ;
"RTN","GMRCHL7A",8,0)
ORC(GMRCORC) ;Get fields from ORC segment and set into GMRC variables
"RTN","GMRCHL7A",9,0)
 ;GMRCTRLC=ORC control code from HL7 Table 119
"RTN","GMRCHL7A",10,0)
 ;GMRCURGI=priority/urgency     GMRCPLCR=who entered the order
"RTN","GMRCHL7A",11,0)
 ;GMRCORNP=provider             GMRCNATO=nature of order
"RTN","GMRCHL7A",12,0)
 ;GMRCAD=date of request        GMRCOCR=order request reason
"RTN","GMRCHL7A",13,0)
 ;GMRCORFN=oe/rr file number    GMRCO=file 123 IEN - if not a new order
"RTN","GMRCHL7A",14,0)
 ;GMRCS38=order status - taken from Table 38, HL7 standard
"RTN","GMRCHL7A",15,0)
 S GMRCTRLC=$P(GMRCORC,SEP1,2),GMRCORFN=$P(GMRCORC,SEP1,3),GMRCORFN=$P($P(GMRCORFN,SEP2,1),";",1),GMRCAPP=$P($P(GMRCORC,SEP1,3),SEP2,2)
"RTN","GMRCHL7A",16,0)
 S GMRCS38=$P(GMRCORC,SEP1,6),GMRCURGI=$P($P(GMRCORC,SEP1,8),SEP2,6),GMRCPLCR=$P(GMRCORC,SEP1,11),GMRCORNP=$P(GMRCORC,SEP1,13)
"RTN","GMRCHL7A",17,0)
 I $L(GMRCURGI) S GMRCURGI="GMRCURGENCY - "_$$URG(GMRCURGI),GMRCURGI=$O(^ORD(101,"B",GMRCURGI,0))
"RTN","GMRCHL7A",18,0)
 S GMRCO=+$P($P(GMRCORC,SEP1,4),SEP2,1)
"RTN","GMRCHL7A",19,0)
 S GMRCODT=$P(GMRCORC,SEP1,16),GMRCAD=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",20,0)
 S GMRCOCR=$P(GMRCORC,SEP1,17),GMRCNATO=$P(GMRCOCR,SEP2,5)
"RTN","GMRCHL7A",21,0)
 Q
"RTN","GMRCHL7A",22,0)
OBR(GMRCOBR) ;Get fields from OBR segment and set into GMRC variables
"RTN","GMRCHL7A",23,0)
 ;GMRCTYPE=GMRC consult or GMRC request  GMRCSS=To Service
"RTN","GMRCHL7A",24,0)
 ;GMRCPLI=place of consultation          GMRCODT=observation date/time
"RTN","GMRCHL7A",25,0)
 ;GMRCATN=person to alert (attention)    GMRCSTDT=status change date/time
"RTN","GMRCHL7A",26,0)
 ;GMRCS123=results status (table 123)    GMRCINTR=results interpreter
"RTN","GMRCHL7A",27,0)
 ;GMRCPRI=procedure from file ^ORD(101,  
"RTN","GMRCHL7A",28,0)
 ;GMRCXMF=foreign consult service
"RTN","GMRCHL7A",29,0)
 ;        a flag that tells the HL7 routine that
"RTN","GMRCHL7A",30,0)
 ;        consults does not need to return CPRS a file
"RTN","GMRCHL7A",31,0)
 ;        IEN for file 123. See routine ^GMRCXMF
"RTN","GMRCHL7A",32,0)
 S GMRCPR=$P($P(GMRCOBR,SEP1,5),SEP2,6)
"RTN","GMRCHL7A",33,0)
 S GMRCTYPE=$S(GMRCPR="99PRO":"GMRCOR REQUEST",1:"GMRCOR CONSULT"),GMRCTYPE=$O(^ORD(101,"B",GMRCTYPE,0))
"RTN","GMRCHL7A",34,0)
 S GMRCPRI="",GMRCSS=""
"RTN","GMRCHL7A",35,0)
 I GMRCPR="99PRO" D
"RTN","GMRCHL7A",36,0)
 . S GMRCPRI=$P($P(GMRCOBR,SEP1,5),SEP2,4)
"RTN","GMRCHL7A",37,0)
 . S GMRCPRI=$S(+GMRCPRI:GMRCPRI_";ORD(101,",1:"")
"RTN","GMRCHL7A",38,0)
 . I +GMRCPRI S GMRCSS=+$P($G(^ORD(101,+GMRCPRI,5)),U,1)
"RTN","GMRCHL7A",39,0)
 . Q
"RTN","GMRCHL7A",40,0)
 E  S GMRCSS=$P($P(GMRCOBR,SEP1,5),SEP2,4)
"RTN","GMRCHL7A",41,0)
 ;
"RTN","GMRCHL7A",42,0)
 S GMRCOTXT=$P($P(GMRCOBR,SEP1,5),SEP2,5) ;consult type or service name
"RTN","GMRCHL7A",43,0)
 S GMRCODT=$P(GMRCOBR,SEP1,7) I GMRCODT]"" S GMRCODT=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",44,0)
 S GMRCPLI=$P(GMRCOBR,SEP1,19) I GMRCPLI]"" S GMRCPLI="GMRCPLACE - "_$S(GMRCPLI="OC":"ON CALL",GMRCPLI="B":"BEDSIDE",GMRCPLI="E":"EMERGENCY ROOM",1:GMRCPLI),GMRCPLI=$O(^ORD(101,"B",GMRCPLI,0))
"RTN","GMRCHL7A",45,0)
 S GMRCATN=$P(GMRCOBR,SEP1,20),GMRCSTDT=$P(GMRCOBR,SEP1,23),GMRCSTDT=$$FMDATE^GMRCHL7(GMRCSTDT)
"RTN","GMRCHL7A",46,0)
 S GMRCS123=$P(GMRCOBR,SEP1,26),GMRCINTR=$P(GMRCOBR,SEP1,33)
"RTN","GMRCHL7A",47,0)
 Q
"RTN","GMRCHL7A",48,0)
ZSV(GMRCZSV) ;Get service from ZSV segment and set into GMRCSS
"RTN","GMRCHL7A",49,0)
 S GMRCZSS=$P($P(GMRCZSV,SEP1,2),SEP2,4)
"RTN","GMRCHL7A",50,0)
 I +$G(GMRCZSS) S GMRCSS=+$G(GMRCZSS) ;Set the service if ZSV provided
"RTN","GMRCHL7A",51,0)
 I $L($P(GMRCZSV,"|",3)) S GMRCOTXT=$P(GMRCZSV,"|",3) ;consult type
"RTN","GMRCHL7A",52,0)
 Q
"RTN","GMRCHL7A",53,0)
OBX(GMRCOBX) ;Get fields from OBX segment and set into GMRC variables
"RTN","GMRCHL7A",54,0)
 ;GMRCVTYP=Value type from table 123 - i.e. TX(text), ST(string data),etc.
"RTN","GMRCHL7A",55,0)
 ;GMRCOID=observation id identifying value in seg. 5
"RTN","GMRCHL7A",56,0)
 ;GMRCVAL=observation value coded by segment 3
"RTN","GMRCHL7A",57,0)
 ;GMRCPRDG=provisional diagnosis
"RTN","GMRCHL7A",58,0)
 ;    free text or code^free text^I9C
"RTN","GMRCHL7A",59,0)
 S GMRCMSG=MSG(GMRCOBX)
"RTN","GMRCHL7A",60,0)
 S GMRCVTYP=$P(GMRCMSG,SEP1,3),GMRCOID=$P($P(GMRCMSG,SEP1,4),SEP2,2),GMRCVAL=$P(GMRCOID,SEP2,3)
"RTN","GMRCHL7A",61,0)
 I GMRCOID="REASON FOR REQUEST" D
"RTN","GMRCHL7A",62,0)
 .S GMRCRFQ(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",63,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCRFQ(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",64,0)
 .Q
"RTN","GMRCHL7A",65,0)
 I GMRCOID="PROVISIONAL DIAGNOSIS" D  Q
"RTN","GMRCHL7A",66,0)
 . I GMRCVTYP="TX" S GMRCPRDG=$P(GMRCMSG,SEP1,6) Q
"RTN","GMRCHL7A",67,0)
 . I GMRCVTYP="CE" D  Q
"RTN","GMRCHL7A",68,0)
 .. N PRDXSEG S PRDXSEG=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",69,0)
 .. S GMRCPRDG=$P(PRDXSEG,"^",2)_" ("_$P(PRDXSEG,"^")_")"
"RTN","GMRCHL7A",70,0)
 .. S GMRCPRCD=$P(PRDXSEG,"^")
"RTN","GMRCHL7A",71,0)
 I GMRCOID["COMMENT" D
"RTN","GMRCHL7A",72,0)
 .S GMRCCMT(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",73,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,NL)) Q:LN=""  S GMRCCMT(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",74,0)
 .Q
"RTN","GMRCHL7A",75,0)
 K LN
"RTN","GMRCHL7A",76,0)
 Q
"RTN","GMRCHL7A",77,0)
EN(MSG) ;Entry point to routine
"RTN","GMRCHL7A",78,0)
 ;MSG = local array which contains the HL-7 segments
"RTN","GMRCHL7A",79,0)
 ;GMRCSEND=sending application   GMRCFAC=sending facility
"RTN","GMRCHL7A",80,0)
 ;GMRCMTP=message type
"RTN","GMRCHL7A",81,0)
 N DFN,GMRCACT,GMRCADD,GMRCFAC,GMRCMTP,GMRCPNM,GMRCO,GMRCOCR,GMRCORNP
"RTN","GMRCHL7A",82,0)
 N GMRCORFN,GMRCPLCR,GMRCRB,GMRCSEND,GMRCSTS,GMRCTRLC,GMRCWARD,ORIFN
"RTN","GMRCHL7A",83,0)
 N GMRCTRLC,GMRCAD,ORC,GMRCSBR,GMRCZSS,GMRCSS,GMRCOTXT
"RTN","GMRCHL7A",84,0)
 S GMRCMSG="",GMRCNOD=0 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) I $E(GMRCMSG,1,3)="MSH" D INIT^GMRCHL7U(GMRCMSG) D  Q
"RTN","GMRCHL7A",85,0)
 .S GMRCSEND=$P(GMRCMSG,SEP1,3),GMRCFAC=$P(GMRCMSG,SEP1,4),GMRCMTP=$P(GMRCMSG,SEP1,9)
"RTN","GMRCHL7A",86,0)
 .Q
"RTN","GMRCHL7A",87,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCHL7A",88,0)
 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) D
"RTN","GMRCHL7A",89,0)
 .I $E(GMRCMSG,1,3)="PID" D PID^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",90,0)
 .I $E(GMRCMSG,1,3)="PV1" D PV1^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",91,0)
 .I $E(GMRCMSG,1,3)="ORC" D ORC(GMRCMSG) Q
"RTN","GMRCHL7A",92,0)
 .I $E(GMRCMSG,1,3)="OBR" D OBR(GMRCMSG) Q
"RTN","GMRCHL7A",93,0)
 .I $E(GMRCMSG,1,3)="ZSV" D ZSV(GMRCMSG) Q
"RTN","GMRCHL7A",94,0)
 .I $E(GMRCMSG,1,3)="OBX" D OBX(GMRCNOD) Q
"RTN","GMRCHL7A",95,0)
 .I $E(GMRCMSG,1,3)="NTE" D NTE^GMRCHL7U(.MSG,GMRCNOD,GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",96,0)
 .I $E(GMRCMSG,1,3)="ZXX" S GMRCOFN=+$P(GMRCMSG,SEP1,2) K MSG(GMRCNOD) Q 
"RTN","GMRCHL7A",97,0)
 .Q
"RTN","GMRCHL7A",98,0)
 ;Note, ZXX is not used yet; planned for future sharing consults with foreign facilities.
"RTN","GMRCHL7A",99,0)
 I '$D(GMRCTRLC) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",100,0)
 I GMRCTRLC="Z@" D CPRSPURG^GMRCPURG(+GMRCO),EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",101,0)
 I GMRCTRLC="NW" D NEW^GMRCHL7B D
"RTN","GMRCHL7A",102,0)
 . I $G(GMRCO) D RETURN^GMRCHL7U(GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",103,0)
 . D REJECT^GMRCHL7U(.MSG,"unable to file order")
"RTN","GMRCHL7A",104,0)
 I $D(GMRCXMF) D
"RTN","GMRCHL7A",105,0)
 .;Set GMRCO=to the file number at this site for a new consult/request before sending HL-7 message to CPRS
"RTN","GMRCHL7A",106,0)
 .S GMRCNOD=0 F  S GMRCNOD=$O(@GMRCMSG(ND)) Q:GMRCNOD=""  I $P(@(GMRCMSG(NOD)),"|",1)="ORC" S $P(@(GMRCMSG(GMRCNOD)),"|",3)=$G(GMRCO) Q
"RTN","GMRCHL7A",107,0)
 .Q
"RTN","GMRCHL7A",108,0)
 I '$D(GMRCO) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",109,0)
 I $S(GMRCTRLC="CA":1,GMRCTRLC="DC":1,1:0) D DC^GMRCHL7B(GMRCO,GMRCTRLC),RETURN^GMRCHL7U(GMRCO,GMRCTRLC)
"RTN","GMRCHL7A",110,0)
 I GMRCTRLC="NA" D RTN(GMRCORFN,GMRCO)
"RTN","GMRCHL7A",111,0)
 I GMRCTRLC="XX" D MODIFY^GMRCHL7B ;Not currently returned by CPRS
"RTN","GMRCHL7A",112,0)
 ; If consults sends an XX, CPRS returns an NA.
"RTN","GMRCHL7A",113,0)
 D EXIT^GMRCHL7U
"RTN","GMRCHL7A",114,0)
 Q
"RTN","GMRCHL7A",115,0)
RTN(GMRCORN,DA) ;Put ^OR(100, ien for order into ^GMR(123, 
"RTN","GMRCHL7A",116,0)
 S DIE="^GMR(123,",DR=".03////^S X=GMRCORN"
"RTN","GMRCHL7A",117,0)
 L +^GMR(123,DA) D ^DIE L -^GMR(123,DA)
"RTN","GMRCHL7A",118,0)
 K DIE,DR
"RTN","GMRCHL7A",119,0)
 Q
"RTN","GMRCHL7B")
0^4^B16688289
"RTN","GMRCHL7B",1,0)
GMRCHL7B ;SLC/DCM - Process order parameters from ^GMRCHL7A and place data into ^GMR(123 global ;9/8/98  03:51
"RTN","GMRCHL7B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12**;DEC 27, 1997
"RTN","GMRCHL7B",3,0)
NEW ;Add new order
"RTN","GMRCHL7B",4,0)
 ;GMRCO=^GMR(123,IFN, the new file number in file ^GMR(123,
"RTN","GMRCHL7B",5,0)
 ;GMRCORFN=OE/RR file number       GMRCWARD=ward patient is on
"RTN","GMRCHL7B",6,0)
 ;GMRCSS=service consult sent to   GMRCAD=date/time of request
"RTN","GMRCHL7B",7,0)
 ;GMRCPRI=procedure/request        GMRCURGI=urgency
"RTN","GMRCHL7B",8,0)
 ;GMRCATN=attention                GMRCSTS=OE/RR order status
"RTN","GMRCHL7B",9,0)
 ;GMRCORNP=patient's provider      GMRCTYPE=request type (request or consult)
"RTN","GMRCHL7B",10,0)
 ;GMRCSBR=service rendered on what basis (Inpatient, or Outpatient)
"RTN","GMRCHL7B",11,0)
 ;GMRCRFQ=reason for request array - word processing fields
"RTN","GMRCHL7B",12,0)
 ;GMRCOTXT=order display text from dialog or orderable item
"RTN","GMRCHL7B",13,0)
 ;GMRCPRDG=provisional DX
"RTN","GMRCHL7B",14,0)
 ;GMRCPRCD=provisional DX code 
"RTN","GMRCHL7B",15,0)
 N DIC,DLAYGO,X,DR,DIE,GMRCADUZ
"RTN","GMRCHL7B",16,0)
 S DIC="^GMR(123,",DIC(0)="L",X="""N""",DLAYGO=123 D ^DIC K DLAYGO Q:Y<1
"RTN","GMRCHL7B",17,0)
 S (DA,GMRCO)=+Y,GMRCSTS=5,GMRCA=1,DIE=DIC
"RTN","GMRCHL7B",18,0)
 L +^GMR(123,GMRCO)
"RTN","GMRCHL7B",19,0)
 S DR=".02////^S X=DFN;.03////^S X=GMRCORFN;.04////^S X=GMRCWARD;.05////^S X=GMRCFAC;.06////^S X=$G(GMRCOFN);1////^S X=GMRCSS;2////^S X=$G(GMRCWARD);3////^S X=GMRCAD;4////^S X=GMRCPRI;5////^S X=GMRCURGI;7////^S X=$G(GMRCATN)"
"RTN","GMRCHL7B",20,0)
 D ^DIE
"RTN","GMRCHL7B",21,0)
 I GMRCOTXT=$$GET1^DIQ(123.5,+GMRCSS,.01) S GMRCOTXT=""
"RTN","GMRCHL7B",22,0)
 ;Added new field .1 to DR on 7/11/98 to save the order text
"RTN","GMRCHL7B",23,0)
 S DR="6////^S X=GMRCPLI;8////^S X=GMRCSTS;9////^S X=GMRCA;10////^S X=GMRCORNP;13////^S X=GMRCTYPE;14////^S X=$G(GMRCSBR);30////^S X=$G(GMRCPRDG);.1////^S X=$G(GMRCOTXT)"
"RTN","GMRCHL7B",24,0)
 I $D(GMRCPRCD) S DR=DR_";30.1///^S X=GMRCPRCD"
"RTN","GMRCHL7B",25,0)
 D ^DIE
"RTN","GMRCHL7B",26,0)
 I $O(GMRCRFQ(0)) D REASON
"RTN","GMRCHL7B",27,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCHL7B",28,0)
 S GMRCA=1 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",29,0)
 I $D(GMRCXMF),$D(GMRCOFN) S $P(^GMR(123,GMRCO,0),"^",21)=GMRCOFN
"RTN","GMRCHL7B",30,0)
 I $D(GMRCACTN) S GMRCADUZ(GMRCACTN)=""
"RTN","GMRCHL7B",31,0)
 D ALERT^GMRCHL7U(DFN,GMRCSS,GMRCPRI,GMRCO,GMRCURGI,"")
"RTN","GMRCHL7B",32,0)
 D PRNT^GMRCUTL1(GMRCSS,GMRCO) ;contains print audit update
"RTN","GMRCHL7B",33,0)
 D EXIT
"RTN","GMRCHL7B",34,0)
 Q
"RTN","GMRCHL7B",35,0)
DC(GMRCO,ACTRL) ;Discontinue request from OERR
"RTN","GMRCHL7B",36,0)
 ;Denied request also gets this action. Deny request updates status to dc
"RTN","GMRCHL7B",37,0)
 ;GMRCO=IEN of record in file ^GMR(123, i.e., ^GMR(123,DA,
"RTN","GMRCHL7B",38,0)
 ;ACTRL=GMRCCTRL=control code defining action -
"RTN","GMRCHL7B",39,0)
 ;         DC control code = action DC for discontinued 
"RTN","GMRCHL7B",40,0)
 ;         CA control code = action DY for denied
"RTN","GMRCHL7B",41,0)
 ;Update the last action taken, order status, and processing activity
"RTN","GMRCHL7B",42,0)
 Q:'$L(GMRCO)
"RTN","GMRCHL7B",43,0)
 N GMRCSVC,GMRCDFN,GMRCFL,GMRCADUZ,GMRCRQR,DA
"RTN","GMRCHL7B",44,0)
 S GMRCACT=$O(^GMR(123.1,"D",ACTRL,0))
"RTN","GMRCHL7B",45,0)
 S GMRCSTS=$P(^GMR(123.1,GMRCACT,0),"^",2)
"RTN","GMRCHL7B",46,0)
 S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCHL7B",47,0)
 S DR="8////^S X=GMRCSTS;9////^S X=GMRCACT" ; upd status + last action
"RTN","GMRCHL7B",48,0)
 D ^DIE
"RTN","GMRCHL7B",49,0)
 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",50,0)
 ; send 513 back through service printer if order DC'd
"RTN","GMRCHL7B",51,0)
 I $G(ACTRL)="DC",$$DCPRNT^GMRCUTL1(GMRCO,DUZ) D
"RTN","GMRCHL7B",52,0)
 . D PRNT^GMRCUTL1(+$P(^GMR(123,GMRCO,0),U,5),GMRCO)
"RTN","GMRCHL7B",53,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCHL7B",54,0)
 S GMRCFL=$$DCNOTE^GMRCADC(GMRCO,DUZ),GMRCADUZ=""
"RTN","GMRCHL7B",55,0)
 S GMRCRQR=+$P($G(^GMR(123,+GMRCO,0)),"^",14)
"RTN","GMRCHL7B",56,0)
 I +GMRCRQR,GMRCRQR'=DUZ S GMRCADUZ(GMRCRQR)=""
"RTN","GMRCHL7B",57,0)
 S GMRCSVC=$P($G(^GMR(123,+GMRCO,0)),"^",5)
"RTN","GMRCHL7B",58,0)
 I +GMRCSVC S GMRCSVC=$S($D(^GMR(123.5,GMRCSVC,.1)):^(.1),1:$P(^GMR(123.5,GMRCSVC,0),"^",1))
"RTN","GMRCHL7B",59,0)
 E  S GMRCSVC="Unknown Service: Consult # "_GMRCO
"RTN","GMRCHL7B",60,0)
 S GMRCORTX=$S(ACTRL="DC":"Discontinued",1:"Cancelled")
"RTN","GMRCHL7B",61,0)
 S GMRCORTX=GMRCORTX_" Consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCHL7B",62,0)
 N NOTYPE S NOTYPE=$S(ACTRL="DC":23,1:30)
"RTN","GMRCHL7B",63,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,NOTYPE,.GMRCADUZ,GMRCFL)
"RTN","GMRCHL7B",64,0)
 D EXIT
"RTN","GMRCHL7B",65,0)
 Q
"RTN","GMRCHL7B",66,0)
MODIFY ;Change an order/request when an HL7 'XX' code is received
"RTN","GMRCHL7B",67,0)
 ;This is currently not used.
"RTN","GMRCHL7B",68,0)
 ;    When Consults sends an XX, CPRS returns NA with a new order ien.
"RTN","GMRCHL7B",69,0)
 ;GMRCACT=processing activity - from file ^GMR(123.1,
"RTN","GMRCHL7B",70,0)
 S DIE="^GMR(123,",DA=+GMRCO
"RTN","GMRCHL7B",71,0)
 S GMRCWARD=$G(GMRCWARD),GMRCPRI=$G(GMRCPRI),GMRCURGI=$G(GMRCURGI),GMRCSTS=$G(GMRCSTS),GMRCTYPE=$G(GMRCTYPE),GMRCSS=$G(GMRCSS)
"RTN","GMRCHL7B",72,0)
 S GMRCACT=$O(^GMR(123.1,"D",GMRCTRLC,0))
"RTN","GMRCHL7B",73,0)
 S GMRCSTS=$P(^GMR(123.1,GMRCACT,0),"^",2)
"RTN","GMRCHL7B",74,0)
 S DIE=123,DR=".04////^S X=$G(GMRCWARD);1////^S X=$G(GMRCSS);4////^S X=$G(GMRCPRI);5////^S X=$G(GMRCURGI);8////^S X=$G(GMRCSTS);9////^S X=GMRCACT"
"RTN","GMRCHL7B",75,0)
 D ^DIE
"RTN","GMRCHL7B",76,0)
 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",77,0)
 D EXIT Q
"RTN","GMRCHL7B",78,0)
REASON ;load the reason for request into ^GMR(123,IFN,20
"RTN","GMRCHL7B",79,0)
 S ^GMR(123,GMRCO,20,0)="^^^"_$S($D(GMRCDA):GMRCDA,1:DT)_"^"
"RTN","GMRCHL7B",80,0)
 S L=0,LN=1 F  S L=$O(GMRCRFQ(L)) Q:L=""  S ^GMR(123,GMRCO,20,LN,0)=GMRCRFQ(L),LN=LN+1
"RTN","GMRCHL7B",81,0)
 S LN=LN-1,$P(^GMR(123,GMRCO,20,0),"^",3)=LN
"RTN","GMRCHL7B",82,0)
 K L,LN
"RTN","GMRCHL7B",83,0)
 Q
"RTN","GMRCHL7B",84,0)
COMMENT(GMRCARY) ;add comments to the record.  Add the comment header, then the comment lines, and lastly, the number of comment lines to the header
"RTN","GMRCHL7B",85,0)
 ;GMRCARY= GMRCNTC array
"RTN","GMRCHL7B",86,0)
 S LN=0,^GMR(123,GMRCO,40,DA,1,0)="^^^^"_$P(GMRCDA,".",1)_"^"
"RTN","GMRCHL7B",87,0)
 F  S LN=$O(GMRCARY(LN)) Q:LN=""  S ^GMR(123,+GMRCO,40,DA,1,LN,0)=GMRCARY(LN),LN1=LN
"RTN","GMRCHL7B",88,0)
 S $P(^GMR(123,+GMRCO,40,DA,1,0),"^",3,4)=LN1_"^"_LN1
"RTN","GMRCHL7B",89,0)
 K LN,LN1 Q
"RTN","GMRCHL7B",90,0)
 Q
"RTN","GMRCHL7B",91,0)
EXIT ;kill off all variables
"RTN","GMRCHL7B",92,0)
 K DA,DIC,DIE,DR,GMRCORTX,GMRCADUZ
"RTN","GMRCHL7B",93,0)
 Q
"RTN","GMRCHL7U")
0^5^B21735359
"RTN","GMRCHL7U",1,0)
GMRCHL7U ;SLC/DCM - Utilities associated with HL7 messages ;9/8/98  03:53
"RTN","GMRCHL7U",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12**;DEC 27, 1997
"RTN","GMRCHL7U",3,0)
INIT(MSH) ;break out MSH segment separators and set other neeed variables
"RTN","GMRCHL7U",4,0)
 ;MSH = MSH segment of the HL-7 message
"RTN","GMRCHL7U",5,0)
 N X
"RTN","GMRCHL7U",6,0)
 S (SEP1,SEP2,SEP3,SEP4,SEP5)=""
"RTN","GMRCHL7U",7,0)
 S SEP1=$E(MSH,4),X=$P(MSH,SEP1,2)
"RTN","GMRCHL7U",8,0)
 S SEP2=$E(X,1),SEP3=$E(X,2),SEP4=$E(X,3),SEP5=$E(X,4)
"RTN","GMRCHL7U",9,0)
 Q
"RTN","GMRCHL7U",10,0)
PID(GMRCPID) ;Get fields from PID segment and set into GMRC variables.
"RTN","GMRCHL7U",11,0)
 S DFN=$P(GMRCPID,SEP1,4),GMRCPNM=$P(GMRCPID,SEP1,6)
"RTN","GMRCHL7U",12,0)
 Q
"RTN","GMRCHL7U",13,0)
NTE(MSG,GMRCNTE,GMRCNODE,CTRLCODE) ;set NTE segments of HL-7 message into variables and globals
"RTN","GMRCHL7U",14,0)
 ;MSG = whole HL-7 array.
"RTN","GMRCHL7U",15,0)
 ;GMRCNTE = Node in array where NTE message begins
"RTN","GMRCHL7U",16,0)
 ;CTRLCODE = segment 1 of the ORC segment of HL-7 message
"RTN","GMRCHL7U",17,0)
 ;GMRCNODE = IEN of entry int file ^GMR(123,
"RTN","GMRCHL7U",18,0)
 N GMRCACT ;not sure why this is newed here
"RTN","GMRCHL7U",19,0)
 S GMRCAD=$G(GMRCAD),GMRCORNP=$G(GMRCORNP),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA),GMRCDEV=$G(GMRCDEV)
"RTN","GMRCHL7U",20,0)
 S GMRCACT=$S(CTRLCODE="CA":19,CTRLCODE="DC":6,CTRLCODE="NW":1,1:$O(^GMR(123.1,"D",CTRLCODE,0)))
"RTN","GMRCHL7U",21,0)
 S GMRCNTC(1)=$P(MSG(GMRCNTE),SEP1,4)
"RTN","GMRCHL7U",22,0)
 S LN=0,LN1=2 F  S LN=$O(MSG(GMRCNTE,LN)) Q:LN=""  S GMRCNTC(LN1)=MSG(GMRCNTE,LN),LN1=LN1+1
"RTN","GMRCHL7U",23,0)
 K LN,LN1
"RTN","GMRCHL7U",24,0)
 Q
"RTN","GMRCHL7U",25,0)
PV1(GMRCPV1) ;Get fields from PV1 segment of HL-7 message and set into GMRC variables
"RTN","GMRCHL7U",26,0)
 ;GMRCRB  = patients room/bed            GMRCWARD=patients ward
"RTN","GMRCHL7U",27,0)
 ;GMRCSBR = service basis to be rendered (Inpatient or Outpatient)
"RTN","GMRCHL7U",28,0)
 N X
"RTN","GMRCHL7U",29,0)
 S X=$P(GMRCPV1,SEP1,3),GMRCSBR=$S(X]"":X,1:"")
"RTN","GMRCHL7U",30,0)
 S X=$P(GMRCPV1,SEP1,4),GMRCWARD=$S($P(X,SEP2,1)]"":$P(X,SEP2,1),1:""),VISIT=$S($P(GMRCPV1,SEP1,20)]"":$P(GMRCPV1,SEP1,20),1:"")
"RTN","GMRCHL7U",31,0)
 S GMRCRB=$S($P(X,SEP2,2)]"":$P(X,SEP2,2),1:"")
"RTN","GMRCHL7U",32,0)
 S:VISIT]"" GMRCVSIT=$$FMDATE^GMRCHL7(VISIT)
"RTN","GMRCHL7U",33,0)
 Q
"RTN","GMRCHL7U",34,0)
 ;
"RTN","GMRCHL7U",35,0)
REJECT(GMRCMSG,REAS) ;action can't be filed send reject message
"RTN","GMRCHL7U",36,0)
 N MSH,ORC,I ;GMRCMESS
"RTN","GMRCHL7U",37,0)
 S I=0 F  S I=$O(GMRCMSG(I)) Q:'I  D
"RTN","GMRCHL7U",38,0)
 . I $P(GMRCMSG(I),"|")="PID" S PID=GMRCMSG(I)
"RTN","GMRCHL7U",39,0)
 . I $P(GMRCMSG(I),"|")="ORC" D
"RTN","GMRCHL7U",40,0)
 .. N ORFN,GMRCFN,P17,CTRLCD
"RTN","GMRCHL7U",41,0)
 .. S ORFN=$P(GMRCMSG(I),"|",3),GMRCFN=$P(GMRCMSG(I),"|",4)
"RTN","GMRCHL7U",42,0)
 .. S CTRLCD=$P(GMRCMSG(I),"|",2)
"RTN","GMRCHL7U",43,0)
 .. S ORC="ORC|"_$S(CTRLCD="NW":"UA",1:"UD")_"|"_ORFN_"|"_GMRCFN
"RTN","GMRCHL7U",44,0)
 .. S P17=$S($D(REAS):REAS,1:"UNABLE TO FILE ACTION")
"RTN","GMRCHL7U",45,0)
 .. S $P(ORC,"|",17)="X^REJECTED^99ORN^^"_P17
"RTN","GMRCHL7U",46,0)
 S MSH=$$MSH^GMRCHL7
"RTN","GMRCHL7U",47,0)
 S $P(MSH,SEP1,9)="ORR"
"RTN","GMRCHL7U",48,0)
 S GMRCMESS(1)=MSH
"RTN","GMRCHL7U",49,0)
 S GMRCMESS(2)=PID
"RTN","GMRCHL7U",50,0)
 S GMRCMESS(3)=ORC
"RTN","GMRCHL7U",51,0)
 ;D MSG^XQOR("GMRC EVSEND OR",.GMRCMESS)
"RTN","GMRCHL7U",52,0)
 Q
"RTN","GMRCHL7U",53,0)
 ;
"RTN","GMRCHL7U",54,0)
RETURN(GMRCIEN,GMRCTRLC) ;return IEN of record in ^GMR(123,IEN, to OERR
"RTN","GMRCHL7U",55,0)
 ;GMRCIEN = internal record number of record in ^GMR(123,
"RTN","GMRCHL7U",56,0)
 ;GMRCTRLC=Control code from HL-7 Table 119
"RTN","GMRCHL7U",57,0)
 N MSH,PID,ORC
"RTN","GMRCHL7U",58,0)
 S SEP1="|",GMRCORCC=$S(GMRCTRLC="NW":"OK",GMRCTRLC="DC":"DR",1:"OK")
"RTN","GMRCHL7U",59,0)
 S MSH=$$MSH^GMRCHL7($G(X)) S $P(MSH,SEP1,9)="ORR"
"RTN","GMRCHL7U",60,0)
 S PID=$$PID^GMRCHL7(GMRCIEN)
"RTN","GMRCHL7U",61,0)
 D ORC^GMRCHL7(GMRCIEN,GMRCORCC,"") S ORC=$P(ORC,"|",1,4)
"RTN","GMRCHL7U",62,0)
 D BLD^GMRCHL7(MSH,PID,"",ORC,"","",,"",GMRCTRLC)
"RTN","GMRCHL7U",63,0)
 D MSG^XQOR("GMRC EVSEND OR",.GMRCMSG)
"RTN","GMRCHL7U",64,0)
 Q
"RTN","GMRCHL7U",65,0)
FILE(GMRCO,DR) ;File data into ^GMR(123,IEN,40 using ^DIE
"RTN","GMRCHL7U",66,0)
 N DIE,DA
"RTN","GMRCHL7U",67,0)
 ;GMRCO = IEN of record from file ^GMR(123,
"RTN","GMRCHL7U",68,0)
 ;DR = DR string required by ^DIE
"RTN","GMRCHL7U",69,0)
 L +^GMR(123,+GMRCO,40) S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCHL7U",70,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1),DA(1)=+GMRCO
"RTN","GMRCHL7U",71,0)
 S DIE="^GMR(123,"_GMRCO_",40,"
"RTN","GMRCHL7U",72,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCHL7U",73,0)
 D ^DIE
"RTN","GMRCHL7U",74,0)
 I $D(GMRCNTC) D COMMENT^GMRCHL7B(.GMRCNTC)
"RTN","GMRCHL7U",75,0)
 I $D(GMRCCMT) D COMMENT^GMRCHL7B(.GMRCCMT)
"RTN","GMRCHL7U",76,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCHL7U",77,0)
 Q
"RTN","GMRCHL7U",78,0)
EXIT ;Kill variables and exit
"RTN","GMRCHL7U",79,0)
 K HLQ,J,LN,ND,ND1,ND2,SEP1,SEP2,SEP3,SEP4,SEP5
"RTN","GMRCHL7U",80,0)
 K GMRCA,GMRCACT,GMRCAD,GMRCAP,GMRCAPP,GMRCATN,GMRCDA,GMRCDEV,GMRCFAC,GMRCFF,GMRCINTR,GMRCMTP,GMRCMSG,GMRCMSH,GMRCNOD,GMRCNTC,GMRCODT,GMRCOID,GMRCORFN,GMRCPA,GMRCPLCR,GMRCPLI,GMRCPNM,GMRCPR,GMRCPRI,GMRCFQ
"RTN","GMRCHL7U",81,0)
 K GMRCPRDG,GMRCSEND,GMRCSTDT,GMRCSTS,GMRCURGI,GMRCVAL,GMRCVTYP,GMRCWARD,GMRCPRV,GMRCTYPE,GMRCND,GMRCND1,VISIT
"RTN","GMRCHL7U",82,0)
 K GMRCRB,GMRCPRA,GMRCRFQ,MSH,OBXND,PID,GMRCORPV,GMRCOTXT
"RTN","GMRCHL7U",83,0)
 K:'$D(GMRCXMF) GMRCTRLC,GMRCSS,GMRCO,GMRCORNP
"RTN","GMRCHL7U",84,0)
 Q
"RTN","GMRCHL7U",85,0)
AUDIT0 ;place activity audit tracking info into global ^GMR(123,IEN,40,
"RTN","GMRCHL7U",86,0)
 ;GMRCACT=processing activity (from ^GMR(123.1,
"RTN","GMRCHL7U",87,0)
 ;GMRCDA=date/time file entered     GMRCAD=date/time activity took place
"RTN","GMRCHL7U",88,0)
 ;GMRCORNP=name of provider         GMRCFF=forwared from (if forwarded)
"RTN","GMRCHL7U",89,0)
 ;GMRCPA=provider previously assigned
"RTN","GMRCHL7U",90,0)
 ;GMRCDEV=device printed to        GMRCCMT=comment array from OBX segment
"RTN","GMRCHL7U",91,0)
 N GMRCDA
"RTN","GMRCHL7U",92,0)
 S X="NOW" D NOW^%DTC S GMRCDA=%
"RTN","GMRCHL7U",93,0)
 L +^GMR(123,+GMRCO,40) S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,+GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCHL7U",94,0)
 S GMRCAD=$S($D(GMRCAD):GMRCAD,1:GMRCDA),GMRCORNP=$G(GMRCORNP),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA),GMRCDEV=$G(GMRCDEV),GMRCPLCR=$G(GMRCPLCR)
"RTN","GMRCHL7U",95,0)
 ;Use the Control code from CPRS in 123.1 to determine the action.
"RTN","GMRCHL7U",96,0)
 ;If action undefined, then use "ADDED COMMENT", entry 20.
"RTN","GMRCHL7U",97,0)
 S GMRCACT=$O(^GMR(123.1,"D",GMRCTRLC,0))
"RTN","GMRCHL7U",98,0)
 S:'GMRCACT GMRCACT=20
"RTN","GMRCHL7U",99,0)
 S DR=".01////^S X=GMRCDA;1////^S X=GMRCACT;2////^S X=GMRCAD;3////^S X=GMRCORNP;4////^S X=GMRCPLCR;6////^S X=GMRCFF;7////^S X=GMRCPA;8////^S X=GMRCDEV"
"RTN","GMRCHL7U",100,0)
 D FILE(GMRCO,DR)
"RTN","GMRCHL7U",101,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCHL7U",102,0)
 Q
"RTN","GMRCHL7U",103,0)
ALERT(GMRCDFN,GMRCSS,GMRCPR,GMRCFN,GMRCURG,GMRCORA) ;generate an alert when receiving a consult
"RTN","GMRCHL7U",104,0)
 ;GMRCDFN=patient DFN from file 2
"RTN","GMRCHL7U",105,0)
 ;GMRCSS=Service
"RTN","GMRCHL7U",106,0)
 ;GMRCPR=procedure being ordered
"RTN","GMRCHL7U",107,0)
 ;GMRCFN=File 123 IEN
"RTN","GMRCHL7U",108,0)
 ;GMRCURG=urgency of request from protocol file
"RTN","GMRCHL7U",109,0)
 ;GMRCADUZ=array of those who receive alerts
"RTN","GMRCHL7U",110,0)
 ;GMRCORA=action to take on alert: 27 is for new alert
"RTN","GMRCHL7U",111,0)
 N GMRCORTX
"RTN","GMRCHL7U",112,0)
 S GMRCORTX="New consult "_$$ORTX^GMRCAU(+GMRCO)_$S(+GMRCURG:" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",1:"")
"RTN","GMRCHL7U",113,0)
 S:'$D(GMRCORA) GMRCORA=27 S:GMRCORA="" GMRCORA=27
"RTN","GMRCHL7U",114,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,GMRCFN,GMRCORA,.GMRCADUZ,1)
"RTN","GMRCHL7U",115,0)
 K GMRCADUZ
"RTN","GMRCHL7U",116,0)
 Q
"RTN","GMRCP5")
0^20^B44831066
"RTN","GMRCP5",1,0)
GMRCP5 ;SLC/DCM,RJS - Print Consult form 513 (main entry) ;5/14/98  11:09
"RTN","GMRCP5",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13,12**;Dec 27, 1997
"RTN","GMRCP5",3,0)
 ;
"RTN","GMRCP5",4,0)
TIUEN(GMRCIEN) ;Entry point for TIU to print 513
"RTN","GMRCP5",5,0)
 ;
"RTN","GMRCP5",6,0)
 N GMRCPLEN,GMRCTASK,GMRCX
"RTN","GMRCP5",7,0)
 ;
"RTN","GMRCP5",8,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",9,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",10,0)
 ;
"RTN","GMRCP5",11,0)
 Q:'+GMRCIEN  D PRNT^GMRCP5A(GMRCIEN,1,0,"",0)
"RTN","GMRCP5",12,0)
 ;
"RTN","GMRCP5",13,0)
 Q
"RTN","GMRCP5",14,0)
 ;
"RTN","GMRCP5",15,0)
GUI(ROOT,GMRCIFN) ;Entry point into routine for the GUI
"RTN","GMRCP5",16,0)
 ;
"RTN","GMRCP5",17,0)
 ; GMRCIFN = IFN of the record from file 123.
"RTN","GMRCP5",18,0)
 ;
"RTN","GMRCP5",19,0)
 N GMRCCPY,GMRCPLEN,GMRCX
"RTN","GMRCP5",20,0)
 ;
"RTN","GMRCP5",21,0)
 S GMRCPLEN=99998
"RTN","GMRCP5",22,0)
 S GMRCCPY="W"
"RTN","GMRCP5",23,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",24,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",25,0)
 ;
"RTN","GMRCP5",26,0)
 D PRNT^GMRCP5A(GMRCIFN,0,0,GMRCCPY,GMRCPLEN)
"RTN","GMRCP5",27,0)
 ;
"RTN","GMRCP5",28,0)
 S ROOT=$NA(^TMP("GMRC",$J,"SF513"))
"RTN","GMRCP5",29,0)
 ;
"RTN","GMRCP5",30,0)
 Q
"RTN","GMRCP5",31,0)
 ;
"RTN","GMRCP5",32,0)
EN(GMRCIFN,GMRCCPY,GMRCDEV,GMRCSTAT) ;Entry point into routine -GMRCIFN=IFN from file 123
"RTN","GMRCP5",33,0)
 ;GMRCIFN = IFN of the record from file 123.
"RTN","GMRCP5",34,0)
 ;
"RTN","GMRCP5",35,0)
 N GMRCPLEN,GMRCTASK
"RTN","GMRCP5",36,0)
 ;
"RTN","GMRCP5",37,0)
 S GMRCSTAT=0
"RTN","GMRCP5",38,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5",39,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5",40,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCP5",41,0)
 ;
"RTN","GMRCP5",42,0)
 I $D(GMRCDEV) D  Q
"RTN","GMRCP5",43,0)
 .S GMRCTASK=$$QUEUE(GMRCIFN,GMRCCPY,GMRCDEV)
"RTN","GMRCP5",44,0)
 .I GMRCTASK S GMRCSTAT="0^Queued as task # "_GMRCTASK
"RTN","GMRCP5",45,0)
 .E  S GMRCSTAT="-1^Not Queued"
"RTN","GMRCP5",46,0)
 ;
"RTN","GMRCP5",47,0)
 I '$D(GMRCCPY) S GMRCCPY=$$CCOPY Q:(GMRCCPY=U)
"RTN","GMRCP5",48,0)
 Q:'$$DEVICE
"RTN","GMRCP5",49,0)
 ;
"RTN","GMRCP5",50,0)
 I $D(IO("Q")) D  Q
"RTN","GMRCP5",51,0)
 .S GMRCTASK=$$QUEUE(GMRCIFN,GMRCCPY)
"RTN","GMRCP5",52,0)
 .I GMRCTASK S GMRCSTAT="0^Queued as task # "_GMRCTASK
"RTN","GMRCP5",53,0)
 .E  S GMRCSTAT="-1^Not Queued"
"RTN","GMRCP5",54,0)
 .W "  ",$P(GMRCSTAT,U,2) H 2
"RTN","GMRCP5",55,0)
 ;
"RTN","GMRCP5",56,0)
 D PRNT^GMRCP5A(GMRCIFN,0,0,GMRCCPY,0)
"RTN","GMRCP5",57,0)
 ;
"RTN","GMRCP5",58,0)
 Q
"RTN","GMRCP5",59,0)
 ;
"RTN","GMRCP5",60,0)
SEL ;Select the consult/request to print
"RTN","GMRCP5",61,0)
 K GMRCQUT,DTOUT,DIRUOUT,GMRCSEL
"RTN","GMRCP5",62,0)
 I '$D(^TMP("GMRCR",$J,"CS","AD")) W $C(7),!,"No Orders To Print!",! S GMRCQUT=1 Q
"RTN","GMRCP5",63,0)
 I $D(GMRC("NMBR")) S GMRCSEL=GMRC("NMBR") I $S(GMRCSEL<1:1,GMRCSEL>BLK:1,1:0) K GMRCSEL D AGAIN^GMRCSLMV(GMRC("NMBR"))
"RTN","GMRCP5",64,0)
 I '$O(^TMP("GMRCR",$J,"CS","AD")),BLK=1 S GMRCSEL=BLK
"RTN","GMRCP5",65,0)
 I $S('$D(GMRCSEL):1,'$L(GMRCSEL):1,1:0) D SEL^GMRCA2 I $D(DTOUT)!($D(DIRUOUT)) S GMRCQUT=1 Q
"RTN","GMRCP5",66,0)
 I $S(GMRCSEL<1:1,GMRCSEL>BLK:1,GMRCSEL="":1,1:0) W $C(7),!,"Select A Number In The Range 1 To "_BLK G SEL
"RTN","GMRCP5",67,0)
 I GMRCSEL="" S GMRCQUT=1 Q
"RTN","GMRCP5",68,0)
 S GMRCND=$O(^TMP("GMRCR",$J,"CS","AD",GMRCSEL,GMRCSEL,0))
"RTN","GMRCP5",69,0)
 I $S('$L(GMRCND):1,1:0) S GMRCMSG="The Consult to print is not defined in the list to select from!" D EXAC^GMRCADC(GMRCMSG) S GMRCQUT=1 Q
"RTN","GMRCP5",70,0)
 Q
"RTN","GMRCP5",71,0)
 ;
"RTN","GMRCP5",72,0)
QUEUE(GMRCIFN,GMRCCPY,GMRCDEV) ;
"RTN","GMRCP5",73,0)
 ;
"RTN","GMRCP5",74,0)
 N ZTCPU,ZTDESC,ZTDTH,ZTIO,ZTPAR,ZTPRE,ZTPRI,ZTRTN
"RTN","GMRCP5",75,0)
 N ZTSAVE,ZTSK,ZTUCI
"RTN","GMRCP5",76,0)
 ;
"RTN","GMRCP5",77,0)
 S ZTDESC="CONSULT/REQUEST PACKAGE PRINT FORM 513"
"RTN","GMRCP5",78,0)
 ;
"RTN","GMRCP5",79,0)
 I $D(GMRCDEV) S ZTIO=GMRCDEV
"RTN","GMRCP5",80,0)
 E  S ZTIO=ION
"RTN","GMRCP5",81,0)
 ;
"RTN","GMRCP5",82,0)
 S ZTDTH=$H
"RTN","GMRCP5",83,0)
 S ZTRTN="PRNT^GMRCP5A("_(+GMRCIFN)_",0,1,"""_(GMRCCPY)_""",0)"
"RTN","GMRCP5",84,0)
 D ^%ZTLOAD
"RTN","GMRCP5",85,0)
 D:'$D(GMRCDEV) ^%ZISC
"RTN","GMRCP5",86,0)
 ;
"RTN","GMRCP5",87,0)
 Q $G(ZTSK)
"RTN","GMRCP5",88,0)
 ;
"RTN","GMRCP5",89,0)
CCOPY() ; Determine if this is a "Chart" copy or a "Working" copy
"RTN","GMRCP5",90,0)
 ;
"RTN","GMRCP5",91,0)
 N GMRCSTAT,GMRCX,GMRCDEF
"RTN","GMRCP5",92,0)
 ;
"RTN","GMRCP5",93,0)
 ;  GMRCDEF=1   CHART
"RTN","GMRCP5",94,0)
 ;  GMRCDEF=0   WORKING
"RTN","GMRCP5",95,0)
 ;
"RTN","GMRCP5",96,0)
 S GMRCSTAT=$G(^GMR(123,GMRCIFN,0)) Q:'$L(GMRCSTAT) ""
"RTN","GMRCP5",97,0)
 S GMRCSTAT=$P(GMRCSTAT,U,12)
"RTN","GMRCP5",98,0)
 S GMRCDEF=(GMRCSTAT=2)
"RTN","GMRCP5",99,0)
 ;
"RTN","GMRCP5",100,0)
 F  D  Q:$L(GMRCX)
"RTN","GMRCP5",101,0)
 .;
"RTN","GMRCP5",102,0)
 .W !,$$COPY(GMRCDEF)_" Copy (Y/N)? Y//"
"RTN","GMRCP5",103,0)
 .R GMRCX:DTIME E  S GMRCX=U
"RTN","GMRCP5",104,0)
 .Q:(GMRCX[U)
"RTN","GMRCP5",105,0)
 .;
"RTN","GMRCP5",106,0)
 .S:'$L(GMRCX) GMRCX="Y"
"RTN","GMRCP5",107,0)
 .S GMRCX=$E(GMRCX,1)
"RTN","GMRCP5",108,0)
 .S GMRCX=$TR(GMRCX,"ynwc","YNWC")
"RTN","GMRCP5",109,0)
 .;
"RTN","GMRCP5",110,0)
 .I '("YNWC"[GMRCX) S GMRCX="?"
"RTN","GMRCP5",111,0)
 .;
"RTN","GMRCP5",112,0)
 .I GMRCX["?" D  S GMRCX="" Q
"RTN","GMRCP5",113,0)
 ..W !
"RTN","GMRCP5",114,0)
 ..W !,"    Type 'Y' To Print A '"_$$COPY(GMRCDEF)_"' Copy Of The Form 513,"
"RTN","GMRCP5",115,0)
 ..W !," or Type 'N' To Print A '"_$$COPY('GMRCDEF)_"' Copy Of The Form 513,"
"RTN","GMRCP5",116,0)
 ..W !," or Type 'C' To Print A 'Chart' Copy Of The Form 513,"
"RTN","GMRCP5",117,0)
 ..W !," or Type 'W' To Print A 'Working' Copy Of The Form 513."
"RTN","GMRCP5",118,0)
 ..W !
"RTN","GMRCP5",119,0)
 ;
"RTN","GMRCP5",120,0)
 I (GMRCX="Y") Q $E($$COPY(GMRCDEF),1)
"RTN","GMRCP5",121,0)
 I (GMRCX="N") Q $E($$COPY('GMRCDEF),1)
"RTN","GMRCP5",122,0)
 Q GMRCX
"RTN","GMRCP5",123,0)
 ;
"RTN","GMRCP5",124,0)
COPY(X) Q:X "Chart" Q "Working"
"RTN","GMRCP5",125,0)
 ;
"RTN","GMRCP5",126,0)
DEVICE() ;Ask output device / set up output device print parameters
"RTN","GMRCP5",127,0)
 N POP,%ZIS,%IS
"RTN","GMRCP5",128,0)
 S POP=0,%ZIS="MQ" D ^%ZIS
"RTN","GMRCP5",129,0)
 Q $S(POP:0,IO="":0,1:1)
"RTN","GMRCP5",130,0)
 ;
"RTN","GMRCP5",131,0)
 ;
"RTN","GMRCP5",132,0)
SETUP ;
"RTN","GMRCP5",133,0)
 ;
"RTN","GMRCP5",134,0)
 N LINE,%ZIS,%IS,POP,IOP
"RTN","GMRCP5",135,0)
 ;
"RTN","GMRCP5",136,0)
 W !!,"Print consults printer setup page.",!
"RTN","GMRCP5",137,0)
 K IOP S %ZIS="MQ" D ^%ZIS Q:POP
"RTN","GMRCP5",138,0)
 ;
"RTN","GMRCP5",139,0)
 I $D(IO("Q")) D  Q
"RTN","GMRCP5",140,0)
 .;
"RTN","GMRCP5",141,0)
 .N ZTCPU,ZTDESC,ZTDTH,ZTIO,ZTPAR,ZTPRE,ZTPRI,ZTRTN
"RTN","GMRCP5",142,0)
 .N ZTSAVE,ZTSK,ZTUCI
"RTN","GMRCP5",143,0)
 .;
"RTN","GMRCP5",144,0)
 .S ZTDESC="CONSULT/REQUEST PACKAGE PRINTER TEST PAGE"
"RTN","GMRCP5",145,0)
 .S ZTIO=ION,ZTDTH=$H,ZTRTN="SETPRNT^GMRCP5"
"RTN","GMRCP5",146,0)
 .S ZTSAVE("DUZ")=""
"RTN","GMRCP5",147,0)
 .;
"RTN","GMRCP5",148,0)
 .D ^%ZTLOAD,^%ZISC
"RTN","GMRCP5",149,0)
 .;
"RTN","GMRCP5",150,0)
 .I ZTSK W !!,"Queued as task #",ZTSK
"RTN","GMRCP5",151,0)
 .E  W !!,"  not queued."
"RTN","GMRCP5",152,0)
 ;
"RTN","GMRCP5",153,0)
SETPRNT ;
"RTN","GMRCP5",154,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","GMRCP5",155,0)
 N LINE
"RTN","GMRCP5",156,0)
 U IO D
"RTN","GMRCP5",157,0)
 .W @IOF,1
"RTN","GMRCP5",158,0)
 .W !,2
"RTN","GMRCP5",159,0)
 .W !,3,"           *******CONSULTS PRINT SETUP PAGE*******"
"RTN","GMRCP5",160,0)
 .W !,4
"RTN","GMRCP5",161,0)
 .W !,5,?4,$$REPEAT^XLFSTR("*",70)
"RTN","GMRCP5",162,0)
 .W !,6,?4," Printed by: ",$$GET1^DIQ(200,+$G(DUZ),.01)," on "
"RTN","GMRCP5",163,0)
 .W $$FMTE^XLFDT($$NOW^XLFDT)
"RTN","GMRCP5",164,0)
 .W !,7,?4,$$REPEAT^XLFSTR("*",70)
"RTN","GMRCP5",165,0)
 .W !,8
"RTN","GMRCP5",166,0)
 .W !,9,"     Print Device: ",$G(ION)
"RTN","GMRCP5",167,0)
 .W !,10,"    Terminal Type: ",$G(IOST)
"RTN","GMRCP5",168,0)
 .W !,11,"    Defined lines per page for this device: ",+$G(IOSL)
"RTN","GMRCP5",169,0)
 .W !,12,"    Defined margin width for this device: ",+$G(IOM)
"RTN","GMRCP5",170,0)
 .W !,13
"RTN","GMRCP5",171,0)
 .W !,14," There should be numbers listed down the lefthand side of"
"RTN","GMRCP5",172,0)
 .W !,15," this page all the way to the bottom. The number at the"
"RTN","GMRCP5",173,0)
 .W !,16," bottom of the page is the number of lines the PRINTER"
"RTN","GMRCP5",174,0)
 .W !,17," thinks there are on a page. The COMPUTER thinks there are ",+$G(IOSL)
"RTN","GMRCP5",175,0)
 .W !,18," lines on a page. The number at the bottom of the page needs to"
"RTN","GMRCP5",176,0)
 .W !,19," be EQUAL to ",+$G(IOSL)," so the consults program can print"
"RTN","GMRCP5",177,0)
 .W !,20," without running off the end of the page. If the number at the"
"RTN","GMRCP5",178,0)
 .W !,21," bottom of the page is NOT EQUAL to ",+$G(IOSL)," then have"
"RTN","GMRCP5",179,0)
 .W !,22," someone in IRM adjust the"
"RTN","GMRCP5",180,0)
 .W !,23
"RTN","GMRCP5",181,0)
 .W !,24," DEVICE file (file 3.5) *PAGE LENGTH field (#11)"
"RTN","GMRCP5",182,0)
 .W !,25,"           for device: ",$G(ION)
"RTN","GMRCP5",183,0)
 .W !,26
"RTN","GMRCP5",184,0)
 .W !,27," and the TERMINAL TYPE file (file 3.2) PAGE LENGTH field (#3)"
"RTN","GMRCP5",185,0)
 .W !,28,"    for terminal type: ",$G(IOST)
"RTN","GMRCP5",186,0)
 .W !,29
"RTN","GMRCP5",187,0)
 .W !,30," to be a value EQUAL to the number at the bottom of the page."
"RTN","GMRCP5",188,0)
 .F LINE=31:1:100 W !,LINE
"RTN","GMRCP5",189,0)
 U IO(0) D ^%ZISC
"RTN","GMRCP5",190,0)
 ;
"RTN","GMRCP5",191,0)
 I $G(ZTSK) D KILL^%ZTLOAD
"RTN","GMRCP5",192,0)
 ;
"RTN","GMRCP5",193,0)
 Q
"RTN","GMRCP5A")
0^21^B54084490
"RTN","GMRCP5A",1,0)
GMRCP5A ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - TIU Results) ;7/15/98  13:00
"RTN","GMRCP5A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13,12**;Dec 27, 1997
"RTN","GMRCP5A",3,0)
 ;
"RTN","GMRCP5A",4,0)
PRNT(GMRCIFN,TIUFLG,GMRCQUED,GMRCCPY,GMRCGUI) ;
"RTN","GMRCP5A",5,0)
 ;
"RTN","GMRCP5A",6,0)
 ; Input Arguments:
"RTN","GMRCP5A",7,0)
 ;
"RTN","GMRCP5A",8,0)
 ;  GMRCIFN: IEN of the Consult/Request in file 123
"RTN","GMRCP5A",9,0)
 ;   TIUFLG: Called from TIU ?  1=yes 0=no
"RTN","GMRCP5A",10,0)
 ; GMRCQUED: Queued job ?  1=yes 0=no
"RTN","GMRCP5A",11,0)
 ;  GMRCCPY: Chart Copy ? C=Chart Copy  W=Working Copy  null=Not Applicable
"RTN","GMRCP5A",12,0)
 ;  GMRCGUI: Called from the GUI. (Only produce output in a formatted global.)
"RTN","GMRCP5A",13,0)
 ;
"RTN","GMRCP5A",14,0)
 N GMRCSIG,GMRCSDT,GMRCCSIG,GMRCSIGT,GMRCADDS
"RTN","GMRCP5A",15,0)
 ;
"RTN","GMRCP5A",16,0)
 I GMRCGUI D  Q
"RTN","GMRCP5A",17,0)
 . D FORMAT(80)
"RTN","GMRCP5A",18,0)
 . D ASSMBL^GMRCP5C(GMRCGUI,80)
"RTN","GMRCP5A",19,0)
 . F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5A",20,0)
 . K ^TMP("GMRC",$J,"OUTPUT")
"RTN","GMRCP5A",21,0)
 . Q
"RTN","GMRCP5A",22,0)
 ;
"RTN","GMRCP5A",23,0)
 I 'TIUFLG,'GMRCQUED W @IOF I '$$CRT^GMRCP5C,$L($G(IO(0))),'(IO=IO(0)) U IO(0) W !,"PRINTING... "
"RTN","GMRCP5A",24,0)
 ;
"RTN","GMRCP5A",25,0)
 U IO D FORMAT(IOM),ASSMBL^GMRCP5C(IOSL,IOM),PRINT^GMRCP5C(IOSL,IOM)
"RTN","GMRCP5A",26,0)
 ;
"RTN","GMRCP5A",27,0)
 I 'TIUFLG,'$$CRT^GMRCP5C U IO(0) D ^%ZISC
"RTN","GMRCP5A",28,0)
 ;
"RTN","GMRCP5A",29,0)
 I $G(GMRCQUED),$G(ZTSK) D KILL^%ZTLOAD
"RTN","GMRCP5A",30,0)
 ;
"RTN","GMRCP5A",31,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5A",32,0)
 F GMRCX="GMRCTIU","RES" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5A",33,0)
 Q
"RTN","GMRCP5A",34,0)
 ;
"RTN","GMRCP5A",35,0)
FORMAT(PAGEWID) ;
"RTN","GMRCP5A",36,0)
 ;
"RTN","GMRCP5A",37,0)
 N %I,CMT,COUNT,D0,DFN,DIC,DIQ2,DR,GLOBAL,GMRC400,GMRCADD,GMRCADDT,GMRCAGE,GMRCCSDT
"RTN","GMRCP5A",38,0)
 N GMRCCTIT,GMRCDFN,GMRCDOB,GMRCDVL,GMRCELIG,GMRCEQL,GMRCERR,GMRCFAC,GMRCFP
"RTN","GMRCP5A",39,0)
 N GMRCFTR,GMRCLAST,GMRCMODE,GMRCND,GMRCNDX,GMRCNT,GMRCPG,GMRCPGR,GMRCPNM,GMRCPRNM
"RTN","GMRCP5A",40,0)
 N GMRCPTR,GMRCQSTR,GMRCQSTT,GMRCR0,GMRCR1,GMRCR2,GMRCRB,GMRCRD,GMRCRPT,GMRCSG,GMRCSGAD,GMRCSIGM
"RTN","GMRCP5A",41,0)
 N GMRCSN,GMRCSR,GMRCSVC,GMRCTO,GMRCUL,GMRCWARD,GMRCWLI,GMRCX,LN,MCFILE,MCPROC
"RTN","GMRCP5A",42,0)
 N ND,ND1,ND2,NDS,ORACTION,SEX,TAB,X,Y
"RTN","GMRCP5A",43,0)
 ;
"RTN","GMRCP5A",44,0)
 S GMRCFTR=13,GMRCFP=0,GMRCPG=0
"RTN","GMRCP5A",45,0)
 S GMRCRD=$G(^GMR(123,GMRCIFN,0)),(DFN,GMRCDFN)=$P(GMRCRD,U,2)
"RTN","GMRCP5A",46,0)
 Q:'(DFN)
"RTN","GMRCP5A",47,0)
 D ELIG^VADPT S GMRCELIG=$P(VAEL(6),U,2) K VAEL
"RTN","GMRCP5A",48,0)
 S GMRCDVL="",$P(GMRCDVL,"-",PAGEWID+1)=""
"RTN","GMRCP5A",49,0)
 S GMRCEQL="",$P(GMRCEQL,"=",PAGEWID+1)=""
"RTN","GMRCP5A",50,0)
 S GMRCUL="",$P(GMRCUL,"_",40)=""
"RTN","GMRCP5A",51,0)
 S DFN=GMRCDFN D DEM^GMRCU
"RTN","GMRCP5A",52,0)
 ;
"RTN","GMRCP5A",53,0)
 S GMRCFAC=+$P(GMRCRD,U,21)
"RTN","GMRCP5A",54,0)
 I 'GMRCFAC S GMRCFAC=+$G(DUZ(2))
"RTN","GMRCP5A",55,0)
 I 'GMRCFAC S GMRCFAC=+$$SITE^VASITE()
"RTN","GMRCP5A",56,0)
 I +GMRCFAC S GMRCFAC=$$GET1^DIQ(4,+GMRCFAC,.01)
"RTN","GMRCP5A",57,0)
 E  S GMRCFAC="" Q
"RTN","GMRCP5A",58,0)
 ;
"RTN","GMRCP5A",59,0)
 I +$P(GMRCRD,U,20),(TIUFLG)!($P(GMRCRD,U,12)=2) D PRINT^GMRCTIUP(GMRCIFN,0,0)
"RTN","GMRCP5A",60,0)
 ;
"RTN","GMRCP5A",61,0)
 K GMRCSG I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",62,0)
 .;
"RTN","GMRCP5A",63,0)
 .S GMRCR0=0 F  Q:$D(GMRCSG)  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",64,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",65,0)
 ..Q:'$L($G(GMRCSIG))
"RTN","GMRCP5A",66,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S GMRCSG(GMRCV)=@GMRCV
"RTN","GMRCP5A",67,0)
 ;
"RTN","GMRCP5A",68,0)
 D INIT^GMRCP5B(.GMRCSG) ; Build Header, Footer, Request, and Primary Diagnosis Segments
"RTN","GMRCP5A",69,0)
 ;
"RTN","GMRCP5A",70,0)
 I $L($G(GMRCCPY)) D
"RTN","GMRCP5A",71,0)
 .D BLD("RES",1,1,0,$$CENTER($S(GMRCCPY="C":"C H A R T   C O P Y",1:"W O R K I N G   C O P Y")))
"RTN","GMRCP5A",72,0)
 I ($P(GMRCRD,U,19)="Y") D
"RTN","GMRCP5A",73,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Significant Findings *******"))
"RTN","GMRCP5A",74,0)
 I ($P(GMRCRD,U,19)="N") D
"RTN","GMRCP5A",75,0)
 .D BLD("RES",1,1,0,$$CENTER("******* No Significant Findings *******"))
"RTN","GMRCP5A",76,0)
 I ($P(GMRCRD,U,19)="U") D
"RTN","GMRCP5A",77,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Unknown Significant Findings *******"))
"RTN","GMRCP5A",78,0)
 ;
"RTN","GMRCP5A",79,0)
 I $P(GMRCRD,U,12)=1  D BLD("RES",1,2,0,$$CENTER("**** REQUEST CANCELLED    REQUEST CANCELLED ****"))
"RTN","GMRCP5A",80,0)
 I '$D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",81,0)
 .I $L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results for "_GMRCRPT_" available."))
"RTN","GMRCP5A",82,0)
 .I '$L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results available."))
"RTN","GMRCP5A",83,0)
 ;
"RTN","GMRCP5A",84,0)
 I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",85,0)
 .;
"RTN","GMRCP5A",86,0)
 .S (GMRCNT,GMRCR0)=0 F  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",87,0)
 ..N GMRCCSDT,GMRCCSGM,GMRCCSIG,GMRCCTIT,GMRCRPT,GMRCSDT
"RTN","GMRCP5A",88,0)
 ..N GMRCSIG,GMRCSIGM,GMRCSIGT,GMRCV,GMRCENT,GMRCVIS,GMRCVLOC
"RTN","GMRCP5A",89,0)
 ..;
"RTN","GMRCP5A",90,0)
 ..F GMRCV="GMRCCSDT","GMRCCSGM","GMRCCSIG","GMRCCTIT","GMRCRPT","GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT","GMRCVIS","GMRCENT","GMRCVLOC" D
"RTN","GMRCP5A",91,0)
 ...S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",92,0)
 ..;
"RTN","GMRCP5A",93,0)
 ..S GMRCNDX=$O(^TMP("GMRC",$J,"OUTPUT","RES"," "),-1)+1
"RTN","GMRCP5A",94,0)
 ..I $L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results #"_GMRCR0_" for "_GMRCRPT_" continued.")
"RTN","GMRCP5A",95,0)
 ..I '$L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results #"_GMRCR0_" continued.")
"RTN","GMRCP5A",96,0)
 ..D SUB("H","RES",GMRCNDX," ")
"RTN","GMRCP5A",97,0)
 ..I $L($G(GMRCSIG)) D
"RTN","GMRCP5A",98,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",99,0)
 ...I (GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /es/ "_$$EXDT($G(GMRCSDT))
"RTN","GMRCP5A",100,0)
 ...I '(GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /chart/ " S:$L($G(GMRCSDT)) GMRCX=GMRCX_$$EXDT(GMRCSDT)
"RTN","GMRCP5A",101,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",102,0)
 ...D:$L($G(GMRCSIGT)) SUB("F","RES",GMRCNDX,"                    "_GMRCSIGT)
"RTN","GMRCP5A",103,0)
 ..I $L($G(GMRCCSIG)) D
"RTN","GMRCP5A",104,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",105,0)
 ...I (GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /es/ "_$$EXDT($G(GMRCCSDT))
"RTN","GMRCP5A",106,0)
 ...I '(GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /chart/ " S:$L($G(GMRCCSDT)) GMRCX=GMRCX_$$EXDT(GMRCCSDT)
"RTN","GMRCP5A",107,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",108,0)
 ...D:$L($G(GMRCCTIT)) SUB("F","RES",GMRCNDX,"                      "_GMRCCTIT)
"RTN","GMRCP5A",109,0)
 ..;extra signers
"RTN","GMRCP5A",110,0)
 .. I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA")) D
"RTN","GMRCP5A",111,0)
 ... D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",112,0)
 ... D SUB("F","RES",GMRCNDX," Concurrent Signatures: ")
"RTN","GMRCP5A",113,0)
 ... N XTRA S XTRA=0 F  S XTRA=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA)) Q:'XTRA  D
"RTN","GMRCP5A",114,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,0))
"RTN","GMRCP5A",115,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,1))
"RTN","GMRCP5A",116,0)
 ..;
"RTN","GMRCP5A",117,0)
 ..I GMRCNT D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",118,0)
 ..I $L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE #"_GMRCR0_" FOR "_GMRCRPT))
"RTN","GMRCP5A",119,0)
 ..I '$L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE #"_GMRCR0))
"RTN","GMRCP5A",120,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",121,0)
 ..I $L($G(GMRCENT)) D
"RTN","GMRCP5A",122,0)
 ...S GMRCX=" Entry Date: "_$$EXDT($G(GMRCENT))
"RTN","GMRCP5A",123,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",124,0)
 ..I $L($G(GMRCVIS)) S GMRCX=" Visit: "_$$EXDT($G(GMRCVIS)) D
"RTN","GMRCP5A",125,0)
 ...I $L($G(GMRCVLOC)) S GMRCX=GMRCX_"   "_GMRCVLOC
"RTN","GMRCP5A",126,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",127,0)
 ..I $L($G(GMRCVLOC)) S GMRCX=GMRCVLOC
"RTN","GMRCP5A",128,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",129,0)
 ..I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0)) D  I 1
"RTN","GMRCP5A",130,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0))
"RTN","GMRCP5A",131,0)
 ..E  I '$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","")) D
"RTN","GMRCP5A",132,0)
 ...D BLD("RES",1,1,0,$$CENTER("CONSULTATION NOTE TEXT NOT AVAILABLE"))
"RTN","GMRCP5A",133,0)
 ..S GMRCR1=0 F  S GMRCR1=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1)) Q:'GMRCR1  D
"RTN","GMRCP5A",134,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1,0))
"RTN","GMRCP5A",135,0)
 ..;
"RTN","GMRCP5A",136,0)
 ..;  GET ADDENDUMS TO THIS NOTE
"RTN","GMRCP5A",137,0)
 ..;
"RTN","GMRCP5A",138,0)
 ..I +$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",0)) D ADDEND^GMRCP5D(GMRCIFN,GMRCR0,GMRCNDX,GMRCRD,PAGEWID)
"RTN","GMRCP5A",139,0)
 ;
"RTN","GMRCP5A",140,0)
 D FORMAT^GMRCP5D(GMRCIFN,GMRCRD,PAGEWID) ;  GET SERVICE REPORTS AND COMMENTS
"RTN","GMRCP5A",141,0)
 ;
"RTN","GMRCP5A",142,0)
 Q
"RTN","GMRCP5A",143,0)
 ;
"RTN","GMRCP5A",144,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5A",145,0)
 ;
"RTN","GMRCP5A",146,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5A",147,0)
 Q:'$L(X) ""
"RTN","GMRCP5A",148,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5A",149,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5A",150,0)
 ;
"RTN","GMRCP5A",151,0)
CENTER(X) ;
"RTN","GMRCP5A",152,0)
 ;
"RTN","GMRCP5A",153,0)
 N TEXT,COL
"RTN","GMRCP5A",154,0)
 S COL=35-($L(X)\2) Q:(COL<1) X
"RTN","GMRCP5A",155,0)
 S $E(TEXT,COL)=X
"RTN","GMRCP5A",156,0)
 Q TEXT
"RTN","GMRCP5A",157,0)
 ;
"RTN","GMRCP5A",158,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5A",159,0)
 ;
"RTN","GMRCP5A",160,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5A",161,0)
 N LINECNT
"RTN","GMRCP5A",162,0)
 ;
"RTN","GMRCP5A",163,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5A",164,0)
 ;
"RTN","GMRCP5A",165,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5A",166,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5A",167,0)
 ;
"RTN","GMRCP5A",168,0)
 S GMRCLAST=SUB
"RTN","GMRCP5A",169,0)
 Q
"RTN","GMRCP5A",170,0)
 ;
"RTN","GMRCP5A",171,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5A",172,0)
 ;
"RTN","GMRCP5A",173,0)
 N NEXT
"RTN","GMRCP5A",174,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5A",175,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5A",176,0)
 Q
"RTN","GMRCP5A",177,0)
 ;
"RTN","GMRCP5A",178,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5A",179,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5A",180,0)
 ;
"RTN","GMRCP5B")
0^28^B29033813
"RTN","GMRCP5B",1,0)
GMRCP5B ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - Footers, Provisional Diagnosis and Reason For Request) ;6/24/98  13:06
"RTN","GMRCP5B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13,12**;Dec 27, 1997
"RTN","GMRCP5B",3,0)
 ;
"RTN","GMRCP5B",4,0)
 Q
"RTN","GMRCP5B",5,0)
 ;
"RTN","GMRCP5B",6,0)
INIT(GMRCSG) ; Initialize the form
"RTN","GMRCP5B",7,0)
 ;
"RTN","GMRCP5B",8,0)
 D HDR^GMRCP5D,FTR(.GMRCSG),REQUEST,PDIAG Q
"RTN","GMRCP5B",9,0)
 ;
"RTN","GMRCP5B",10,0)
REQUEST ;
"RTN","GMRCP5B",11,0)
 N GMRCX
"RTN","GMRCP5B",12,0)
 ;
"RTN","GMRCP5B",13,0)
 I $L($T(OUTPTPR^SDUTL3)) D
"RTN","GMRCP5B",14,0)
 .S GMRCX=$P($$OUTPTPR^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",15,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"Primary Care Provider: "_GMRCX)
"RTN","GMRCP5B",16,0)
 ;
"RTN","GMRCP5B",17,0)
 I $L($T(OUTPTTM^SDUTL3)) D
"RTN","GMRCP5B",18,0)
 .S GMRCX=$P($$OUTPTTM^SDUTL3(DFN),U,2)
"RTN","GMRCP5B",19,0)
 .D:$L(GMRCX) BLD("REQ",1,1,0,"            Care Team: "_GMRCX)
"RTN","GMRCP5B",20,0)
 ;
"RTN","GMRCP5B",21,0)
 I $O(^TMP("GMRC",$J,"OUTPUT","REQ",0)) D BLD("REQ",1,1,0,"")
"RTN","GMRCP5B",22,0)
 ;
"RTN","GMRCP5B",23,0)
 D SUB("H","REQ",1,"Reason For Request continued.")
"RTN","GMRCP5B",24,0)
 D SUB("H","REQ",1," ")
"RTN","GMRCP5B",25,0)
 ;
"RTN","GMRCP5B",26,0)
 D BLD("REQ",1,1,0,"REASON FOR REQUEST: (Complaints and findings)")
"RTN","GMRCP5B",27,0)
 I '$O(^GMR(123,GMRCIFN,20,0)) D BLD("REQ",1,1,0,"") I 1
"RTN","GMRCP5B",28,0)
 E  D
"RTN","GMRCP5B",29,0)
 .N LN S LN=0 F  S LN=$O(^GMR(123,GMRCIFN,20,LN)) Q:LN=""  D
"RTN","GMRCP5B",30,0)
 ..D BLD("REQ",1,1,0,^GMR(123,GMRCIFN,20,LN,0))
"RTN","GMRCP5B",31,0)
 ;
"RTN","GMRCP5B",32,0)
 Q
"RTN","GMRCP5B",33,0)
PDIAG ;
"RTN","GMRCP5B",34,0)
 ;
"RTN","GMRCP5B",35,0)
 D BLD("PDIAG",1,1,0,"PROVISIONAL DIAG: "_$G(^GMR(123,GMRCIFN,30)))
"RTN","GMRCP5B",36,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",37,0)
 ;
"RTN","GMRCP5B",38,0)
 S GMRCQSTR=$P(GMRCRD,U,14)
"RTN","GMRCP5B",39,0)
 S:'GMRCQSTR GMRCQSTR=$$GET1^DIQ(100,+$P(GMRCRD,U,3),1)
"RTN","GMRCP5B",40,0)
 S GMRCX=$G(^VA(200,+GMRCQSTR,.13))
"RTN","GMRCP5B",41,0)
 S GMRCPGR=$P(GMRCX,U,7) S:'$L(GMRCPGR) GMRCPGR=$P(GMRCX,U,8)
"RTN","GMRCP5B",42,0)
 S:$L(GMRCPGR) GMRCPGR="(Pager: "_GMRCPGR_")"
"RTN","GMRCP5B",43,0)
 I '$L(GMRCPGR) S GMRCPGR=$P(GMRCX,U,2) S:$L(GMRCPGR) GMRCPGR="(Phone: "_GMRCPGR_")"
"RTN","GMRCP5B",44,0)
 ;
"RTN","GMRCP5B",45,0)
 S GMRCQSTT=$P($G(^VA(200,+GMRCQSTR,20)),U,3)
"RTN","GMRCP5B",46,0)
 S:'$L(GMRCQSTT) GMRCQSTT=$$GET1^DIQ(200,+GMRCQSTR,8)
"RTN","GMRCP5B",47,0)
 S GMRCQSTR=$P($G(^VA(200,+GMRCQSTR,0)),U,1)
"RTN","GMRCP5B",48,0)
 ;
"RTN","GMRCP5B",49,0)
 D BLD("PDIAG",1,1,0,"REQUESTED BY: "_GMRCPGR)
"RTN","GMRCP5B",50,0)
 D BLD("PDIAG",1,0,35,"|PLACE:")
"RTN","GMRCP5B",51,0)
 D BLD("PDIAG",1,0,59,"|URGENCY:")
"RTN","GMRCP5B",52,0)
 ;
"RTN","GMRCP5B",53,0)
 D BLD("PDIAG",1,1,0,$E(GMRCQSTR,1,37))
"RTN","GMRCP5B",54,0)
 D BLD("PDIAG",1,0,35,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,10),0)),U,2),1,20))
"RTN","GMRCP5B",55,0)
 D BLD("PDIAG",1,0,59,"|"_$E($P($G(^ORD(101,+$P(GMRCRD,U,9),0)),U,2),1,18))
"RTN","GMRCP5B",56,0)
 ;
"RTN","GMRCP5B",57,0)
 I $L(GMRCQSTT) D
"RTN","GMRCP5B",58,0)
 .D BLD("PDIAG",1,1,0,GMRCQSTT)
"RTN","GMRCP5B",59,0)
 .D BLD("PDIAG",1,0,35,"|")
"RTN","GMRCP5B",60,0)
 .D BLD("PDIAG",1,0,59,"|")
"RTN","GMRCP5B",61,0)
 D BLD("PDIAG",1,1,0,GMRCDVL)
"RTN","GMRCP5B",62,0)
 ;
"RTN","GMRCP5B",63,0)
 Q
"RTN","GMRCP5B",64,0)
 ;
"RTN","GMRCP5B",65,0)
FTR(GMRCSG) ;Footer of form 513
"RTN","GMRCP5B",66,0)
 ;
"RTN","GMRCP5B",67,0)
 N GMRCRMBD,GMRCFAC1,GMRCLOC,GMRCX,SUB,GMRCX,VAIN,VAPA,VAERR
"RTN","GMRCP5B",68,0)
 ;
"RTN","GMRCP5B",69,0)
 D ADD^VADPT,INP^VADPT
"RTN","GMRCP5B",70,0)
 ;
"RTN","GMRCP5B",71,0)
 S (GMRCLOC,GMRCRMBD)=""
"RTN","GMRCP5B",72,0)
 S GMRCLOC=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5B",73,0)
 S GMRCRMBD=$G(VAIN(5))
"RTN","GMRCP5B",74,0)
 S:'$L(GMRCLOC) GMRCLOC=$P($G(^SC(+$P($G(^GMR(123,+GMRCIFN,0)),U,4),0)),U,1)
"RTN","GMRCP5B",75,0)
 S:'$L(GMRCLOC) GMRCLOC=GMRCUL
"RTN","GMRCP5B",76,0)
 ;
"RTN","GMRCP5B",77,0)
 D BLD("FTR",0,1,0,GMRCEQL)
"RTN","GMRCP5B",78,0)
 D BLD("FTR",1,1,0,GMRCEQL)
"RTN","GMRCP5B",79,0)
 ;
"RTN","GMRCP5B",80,0)
 I ($G(GMRCSG("GMRCSIGM"))="electronic") D  I 1
"RTN","GMRCP5B",81,0)
 .D BLD("FTR",0,1,0,"SIGNATURE & TITLE: ")
"RTN","GMRCP5B",82,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG"))_" /es/")
"RTN","GMRCP5B",83,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",84,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",85,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",86,0)
 E  D
"RTN","GMRCP5B",87,0)
 .D BLD("FTR",0,1,0,"AUTHOR & TITLE: ")
"RTN","GMRCP5B",88,0)
 .D BLD("FTR",0,0,20,$G(GMRCSG("GMRCSIG")))
"RTN","GMRCP5B",89,0)
 .D BLD("FTR",0,0,54,"|")
"RTN","GMRCP5B",90,0)
 .D BLD("FTR",0,1,20,$G(GMRCSG("GMRCSIGT")))
"RTN","GMRCP5B",91,0)
 .D BLD("FTR",0,0,54,"|DATE: "_$$EXDT($G(GMRCSG("GMRCSDT"))))
"RTN","GMRCP5B",92,0)
 ;
"RTN","GMRCP5B",93,0)
 S GMRCFAC1=+$G(DUZ(2))
"RTN","GMRCP5B",94,0)
 S:'GMRCFAC1 GMRCFAC1=+$$SITE^VASITE()
"RTN","GMRCP5B",95,0)
 S GMRCFAC1=$$GET1^DIQ(4,+GMRCFAC1,.01)
"RTN","GMRCP5B",96,0)
 ;
"RTN","GMRCP5B",97,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",98,0)
 D BLD("FTR",0,1,0,"ID #:"_$E(GMRCUL,1,8))
"RTN","GMRCP5B",99,0)
 D BLD("FTR",0,0,12,"|ORGANIZATION:"_$J($E(GMRCFAC1,1,17),17))
"RTN","GMRCP5B",100,0)
 D BLD("FTR",0,0,45,"|REG #:"_$E(GMRCUL,1,4))
"RTN","GMRCP5B",101,0)
 D BLD("FTR",0,0,58,"|LOC: "_$E($G(GMRCLOC),1,11))
"RTN","GMRCP5B",102,0)
 ;
"RTN","GMRCP5B",103,0)
 I $L(GMRCRMBD) D  I 1
"RTN","GMRCP5B",104,0)
 .D BLD("FTR",0,1,12,"|")
"RTN","GMRCP5B",105,0)
 .D BLD("FTR",0,0,45,"|")
"RTN","GMRCP5B",106,0)
 .D BLD("FTR",0,0,58,"|RM/BD: "_GMRCRMBD)
"RTN","GMRCP5B",107,0)
 ;
"RTN","GMRCP5B",108,0)
 D BLD("FTR",0,1,0,GMRCDVL)
"RTN","GMRCP5B",109,0)
 ;
"RTN","GMRCP5B",110,0)
 F SUB=0,1 D
"RTN","GMRCP5B",111,0)
 .D BLD("FTR",SUB,1,0,$P($G(^DPT(GMRCDFN,0)),U,1)_"  "_GMRCELIG)
"RTN","GMRCP5B",112,0)
 .I 'SUB D BLD("FTR",SUB,0,45,"CONSULTATION SHEET")
"RTN","GMRCP5B",113,0)
 .I SUB D BLD("FTR",SUB,0,45,"CONSULTATION SHEET  (Continued)")
"RTN","GMRCP5B",114,0)
 .D BLD("FTR",SUB,1,0,GMRCSN)
"RTN","GMRCP5B",115,0)
 .D BLD("FTR",SUB,0,20,$$EXDT(GMRCDOB))
"RTN","GMRCP5B",116,0)
 .D BLD("FTR",SUB,0,45,"Standard Form 513 (Rev 9-77)")
"RTN","GMRCP5B",117,0)
 ;
"RTN","GMRCP5B",118,0)
 ;                                  ADDRESS LINES 1-3
"RTN","GMRCP5B",119,0)
 F GMRCX=1,2,3 D:$L(VAPA(GMRCX)) BLD("FTR",0,1,0,VAPA(GMRCX))
"RTN","GMRCP5B",120,0)
 ;
"RTN","GMRCP5B",121,0)
 ;         CITY              STATE                ZIP CODE
"RTN","GMRCP5B",122,0)
 S GMRCX=VAPA(4)_"   "_$P(VAPA(5),U,2)_"      "_VAPA(6)
"RTN","GMRCP5B",123,0)
 ;
"RTN","GMRCP5B",124,0)
 I $L(VAPA(8)) S GMRCX=GMRCX_"      Phone: "_VAPA(8)   ; TELEPHONE (IF AVAILABLE)
"RTN","GMRCP5B",125,0)
 ;
"RTN","GMRCP5B",126,0)
 D BLD("FTR",0,1,0,GMRCX)
"RTN","GMRCP5B",127,0)
 ;
"RTN","GMRCP5B",128,0)
 Q
"RTN","GMRCP5B",129,0)
 ;
"RTN","GMRCP5B",130,0)
CONSRQ(GMRCRQ) ;
"RTN","GMRCP5B",131,0)
 ;
"RTN","GMRCP5B",132,0)
 N ORND,ORFL,REF
"RTN","GMRCP5B",133,0)
 I '$L(GMRCRQ) Q "Consult"
"RTN","GMRCP5B",134,0)
 S ORND=$P(GMRCRQ,";",1),ORFL=$P(GMRCRQ,";",2),REF=U_ORFL_ORND_",0)"
"RTN","GMRCP5B",135,0)
 S GMRCRQ=$P($G(@(REF)),U,2)
"RTN","GMRCP5B",136,0)
 Q:$L(GMRCRQ) GMRCRQ Q "Consult"
"RTN","GMRCP5B",137,0)
 ;
"RTN","GMRCP5B",138,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5B",139,0)
 ;
"RTN","GMRCP5B",140,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5B",141,0)
 Q:'$L(X) ""
"RTN","GMRCP5B",142,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5B",143,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5B",144,0)
 ;
"RTN","GMRCP5B",145,0)
PRCMT(CMT) ;
"RTN","GMRCP5B",146,0)
 ;
"RTN","GMRCP5B",147,0)
 Q $P($G(^GMR(123.1,+CMT,0)),U,8)
"RTN","GMRCP5B",148,0)
 ;
"RTN","GMRCP5B",149,0)
 ;
"RTN","GMRCP5B",150,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5B",151,0)
 ;
"RTN","GMRCP5B",152,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5B",153,0)
 N LINECNT
"RTN","GMRCP5B",154,0)
 ;
"RTN","GMRCP5B",155,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5B",156,0)
 ;
"RTN","GMRCP5B",157,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5B",158,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5B",159,0)
 ;
"RTN","GMRCP5B",160,0)
 S GMRCLAST=SUB
"RTN","GMRCP5B",161,0)
 Q
"RTN","GMRCP5B",162,0)
 ;
"RTN","GMRCP5B",163,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5B",164,0)
 ;
"RTN","GMRCP5B",165,0)
 N NEXT
"RTN","GMRCP5B",166,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5B",167,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5B",168,0)
 Q
"RTN","GMRCP5B",169,0)
 ;
"RTN","GMRCP5B",170,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5B",171,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5B",172,0)
 ;
"RTN","GMRCP5D")
0^27^B46633787
"RTN","GMRCP5D",1,0)
GMRCP5D ;SLC/DCM,RJS - Print Consult form 513 (Gather Data - Addendums, Headers, Service reports and Comments) ;7/15/98  13:00;
"RTN","GMRCP5D",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12**;Dec 27, 1997
"RTN","GMRCP5D",3,0)
 ;
"RTN","GMRCP5D",4,0)
FORMAT(GMRCIFN,GMRCRD,PAGEWID) ;
"RTN","GMRCP5D",5,0)
 ;
"RTN","GMRCP5D",6,0)
 I $L($P(GMRCRD,U,15)) D
"RTN","GMRCP5D",7,0)
 .S GMRCTO=$P(GMRCRD,U,5),GMRCSR=$P(GMRCRD,U,15),ORACTION=8
"RTN","GMRCP5D",8,0)
 .I $E($P(GMRCSR,";",2),1,2)="MC" D  Q:'MCPROC
"RTN","GMRCP5D",9,0)
 ..S MCFILE=$P(GMRCSR,";",2),MCFILE=$P(MCFILE,",")
"RTN","GMRCP5D",10,0)
 ..S MCPROC=$O(^MCAR(697.2,"C",MCFILE,"")) Q:'MCPROC
"RTN","GMRCP5D",11,0)
 .;
"RTN","GMRCP5D",12,0)
 .S GMRCPRNM=$P($G(^MCAR(697.2,MCPROC,0)),U,8)
"RTN","GMRCP5D",13,0)
 .;
"RTN","GMRCP5D",14,0)
 .S GMRCX=$G(^GMR(123.5,+GMRCTO,20))
"RTN","GMRCP5D",15,0)
 .;
"RTN","GMRCP5D",16,0)
 .;
"RTN","GMRCP5D",17,0)
 .I $O(^TMP("GMRCR",$J,"MCAR",0)) D
"RTN","GMRCP5D",18,0)
 ..S GMRCSVC=$P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1)
"RTN","GMRCP5D",19,0)
 ..S:$L(GMRCSVC) GMRCSVC=GMRCSVC_" "
"RTN","GMRCP5D",20,0)
 ..;
"RTN","GMRCP5D",21,0)
 ..S GMRCR0=0 F  S GMRCR0=$O(^TMP("GMRCR",$J,"MCAR",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5D",22,0)
 ...D SUB("H","SREP",1,GMRCSVC_"Service Report #"_GMRCR0_" continued.")
"RTN","GMRCP5D",23,0)
 ...D SUB("H","SREP",1," ")
"RTN","GMRCP5D",24,0)
 ...D BLD("SREP",1,1,0,$$CENTER(GMRCSVC_"Service Report #"_GMRCR0))
"RTN","GMRCP5D",25,0)
 ...D BLD("SREP",1,1,0,"")
"RTN","GMRCP5D",26,0)
 ...S LN=0 F  S LN=$O(^TMP("GMRCR",$J,"MCAR",GMRCR0,LN)) Q:'LN  D
"RTN","GMRCP5D",27,0)
 ....D BLD("SREP",1,1,0,$G(^TMP("GMRCR",$J,"MCAR",GMRCR0,LN,0)))
"RTN","GMRCP5D",28,0)
 ;
"RTN","GMRCP5D",29,0)
 S GMRCR0=0 F  S GMRCR0=$O(^GMR(123,GMRCIFN,40,GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5D",30,0)
 .N GMRCR1,GMRC400,CMT,USER,GMRCDT,RPRV
"RTN","GMRCP5D",31,0)
 .S GMRCR1=+$O(^GMR(123,GMRCIFN,40,GMRCR0,0)) Q:'GMRCR1
"RTN","GMRCP5D",32,0)
 .S GMRC400=$G(^GMR(123,GMRCIFN,40,GMRCR0,0))
"RTN","GMRCP5D",33,0)
 .S CMT=$$PRCMT^GMRCP5B(+$P(GMRC400,U,2)) Q:'$L(CMT)
"RTN","GMRCP5D",34,0)
 .S GMRCDT=$P(GMRC400,U,3) S:'GMRCDT GMRCDT=$P(GMRC400,U,1)
"RTN","GMRCP5D",35,0)
 .S GMRCDT=$$EXDT(GMRCDT)
"RTN","GMRCP5D",36,0)
 .;
"RTN","GMRCP5D",37,0)
 .S RPRV=$$GET1^DIQ(200,+$P(GMRC400,U,4),.01)
"RTN","GMRCP5D",38,0)
 .S:($L(RPRV)) RPRV="Responsible Person: "_RPRV
"RTN","GMRCP5D",39,0)
 .S USER=$$GET1^DIQ(200,+$P(GMRC400,U,5),.01)
"RTN","GMRCP5D",40,0)
 .S USER="Entered by: "_USER_" - "_GMRCDT
"RTN","GMRCP5D",41,0)
 .D SUB("H","COM",GMRCR0,CMT_" Comment ("_USER_") continued.")
"RTN","GMRCP5D",42,0)
 .D SUB("H","COM",GMRCR0," ")
"RTN","GMRCP5D",43,0)
 .D BLD("COM",GMRCR0,1,0,"")
"RTN","GMRCP5D",44,0)
 .D BLD("COM",GMRCR0,1,0,$$CENTER("("_CMT_" Comment)"))
"RTN","GMRCP5D",45,0)
 .D BLD("COM",GMRCR0,1,5,USER)
"RTN","GMRCP5D",46,0)
 .D:($L(RPRV)) BLD("COM",GMRCR0,1,5,RPRV)
"RTN","GMRCP5D",47,0)
 .;
"RTN","GMRCP5D",48,0)
 .S GMRCR2=0 F  S GMRCR2=$O(^GMR(123,GMRCIFN,40,GMRCR0,GMRCR1,GMRCR2)) Q:'GMRCR2  D
"RTN","GMRCP5D",49,0)
 ..D BLD("COM",GMRCR0,1,0,$G(^GMR(123,GMRCIFN,40,GMRCR0,GMRCR1,GMRCR2,0)))
"RTN","GMRCP5D",50,0)
 ;
"RTN","GMRCP5D",51,0)
 Q
"RTN","GMRCP5D",52,0)
 ;
"RTN","GMRCP5D",53,0)
ADDEND(GMRCIFN,GMRCR0,GMRCNDX,GMRCRD,PAGEWID) ;
"RTN","GMRCP5D",54,0)
 ;
"RTN","GMRCP5D",55,0)
 N GMRCADD,GMRCNDX,GMRCR1,GMRCV,TEXT,GMRCX
"RTN","GMRCP5D",56,0)
 ;
"RTN","GMRCP5D",57,0)
 S GMRCADD=0 F  S GMRCADD=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD)) Q:'GMRCADD  D
"RTN","GMRCP5D",58,0)
 .N GMRCSGNM,GMRCNMDT,GMRCTIT,GMRCMODE,GMRCCSDT,GMRCCTIT,GMRCCSGM
"RTN","GMRCP5D",59,0)
 .;
"RTN","GMRCP5D",60,0)
 .F GMRCV="GMRCSGNM","GMRCNMDT","GMRCTIT","GMRCMODE" D
"RTN","GMRCP5D",61,0)
 ..S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCV))
"RTN","GMRCP5D",62,0)
 .;
"RTN","GMRCP5D",63,0)
 . F GMRCV="GMRCCSDT","GMRCCTIT","GMRCCSGM","GMRCCSIG" D
"RTN","GMRCP5D",64,0)
 .. S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCV))
"RTN","GMRCP5D",65,0)
 .S GMRCNDX=$O(^TMP("GMRC",$J,"OUTPUT","RES"," "),-1)+1
"RTN","GMRCP5D",66,0)
 .I $L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Addendum #"_GMRCADD_" To Consult Note #"_GMRCR0_" for "_GMRCRPT_" continued.")
"RTN","GMRCP5D",67,0)
 .I '$L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Addendum #"_GMRCADD_" To Consult Note #"_GMRCR0_" continued.")
"RTN","GMRCP5D",68,0)
 .D SUB("H","RES",GMRCNDX," ")
"RTN","GMRCP5D",69,0)
 .I $L($G(GMRCSGNM)) D
"RTN","GMRCP5D",70,0)
 ..D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5D",71,0)
 ..I (GMRCMODE="electronic") S GMRCX=" Addendum Signature: "_GMRCSGNM_" /es/ "_$$EXDT($G(GMRCNMDT))
"RTN","GMRCP5D",72,0)
 ..I '(GMRCMODE="electronic") S GMRCX=" Addendum Author: "_GMRCSGNM S:$L($G(GMRCNMDT)) GMRCX=GMRCX_" Last edited: "_$$EXDT(GMRCNMDT)
"RTN","GMRCP5D",73,0)
 ..D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5D",74,0)
 ..D:$L($G(GMRCTIT)) SUB("F","RES",GMRCNDX,"                     "_GMRCTIT)
"RTN","GMRCP5D",75,0)
 .I $L($G(GMRCCSDT)) D
"RTN","GMRCP5D",76,0)
 ..D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5D",77,0)
 ..I (GMRCCSGM="electronic") S GMRCX=" Addendum CoSignature: "_GMRCCSIG_" /es/ "_$$EXDT(GMRCCSDT)
"RTN","GMRCP5D",78,0)
 ..I '(GMRCCSGM="electronic") S GMRCX=" Addendum CoSignature: "_GMRCCSIG_" /chart/ "_$$EXDT(GMRCCSDT)
"RTN","GMRCP5D",79,0)
 ..D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5D",80,0)
 ..D:$L($G(GMRCCTIT)) SUB("F","RES",GMRCNDX,"                       "_GMRCCTIT)
"RTN","GMRCP5D",81,0)
 .D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5D",82,0)
 .I $L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("ADDENDUM #"_GMRCADD_" TO CONSULT NOTE #"_GMRCR0_" FOR "_GMRCRPT))
"RTN","GMRCP5D",83,0)
 .I '$L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("ADDENDUM #"_GMRCADD_" TO CONSULT NOTE #"_GMRCR0))
"RTN","GMRCP5D",84,0)
 .D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5D",85,0)
 .S GMRCR1=0 F  S GMRCR1=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCR1)) Q:'GMRCR1  D
"RTN","GMRCP5D",86,0)
 ..D BLD("RES",GMRCNDX,1,0,$G(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",GMRCADD,GMRCR1,0)))
"RTN","GMRCP5D",87,0)
 Q
"RTN","GMRCP5D",88,0)
 ;
"RTN","GMRCP5D",89,0)
HDR ; Header code for form 513
"RTN","GMRCP5D",90,0)
 ;
"RTN","GMRCP5D",91,0)
 N PG,GMRCFROM
"RTN","GMRCP5D",92,0)
 ;
"RTN","GMRCP5D",93,0)
 F PG=0,1 D
"RTN","GMRCP5D",94,0)
 .D BLD("HDR",PG,1,0,GMRCDVL)
"RTN","GMRCP5D",95,0)
 .D BLD("HDR",PG,1,6,"MEDICAL RECORD")
"RTN","GMRCP5D",96,0)
 .D BLD("HDR",PG,0,29,"|")
"RTN","GMRCP5D",97,0)
 .D BLD("HDR",PG,0,36,"CONSULTATION SHEET")
"RTN","GMRCP5D",98,0)
 .I PG D BLD("HDR",PG,0,60,"Page ","GMRCPG,65") I 1
"RTN","GMRCP5D",99,0)
 .E  I '$G(GMRCGUI) D BLD("HDR",PG,0,60,"Page ","GMRCPG,65")
"RTN","GMRCP5D",100,0)
 .;
"RTN","GMRCP5D",101,0)
 .D BLD("HDR",PG,1,0,GMRCDVL)
"RTN","GMRCP5D",102,0)
 .D BLD("HDR",PG,1,0,"Consult Request: "_$$CONSRQ(GMRCIFN))
"RTN","GMRCP5D",103,0)
 .D BLD("HDR",PG,0,55,"|Consult No.: "_GMRCIFN)
"RTN","GMRCP5D",104,0)
 .;
"RTN","GMRCP5D",105,0)
 D BLD("HDR",1,1,0,GMRCEQL)
"RTN","GMRCP5D",106,0)
 D BLD("HDR",0,1,0,GMRCDVL)
"RTN","GMRCP5D",107,0)
 ;
"RTN","GMRCP5D",108,0)
 I $G(CMT) D BLD("HDR",0,1,27,"("_$$PRCMT^GMRCP5B(CMT)_")") Q
"RTN","GMRCP5D",109,0)
 ;
"RTN","GMRCP5D",110,0)
 S GMRCFROM=$P($G(^SC(+$P(GMRCRD,U,6),0)),U,1)
"RTN","GMRCP5D",111,0)
 ;
"RTN","GMRCP5D",112,0)
 I '$L(GMRCFROM) D
"RTN","GMRCP5D",113,0)
 .N VAIN
"RTN","GMRCP5D",114,0)
 .D INP^VADPT
"RTN","GMRCP5D",115,0)
 .S GMRCFROM=$P($G(VAIN(4)),U,2)
"RTN","GMRCP5D",116,0)
 .I $L($G(VAIN(5))) S GMRCFROM=GMRCFROM_" (Rm/Bd: "_$G(VAIN(5))_" )"
"RTN","GMRCP5D",117,0)
 ;
"RTN","GMRCP5D",118,0)
 D BLD("HDR",0,1,0,"To: "_$P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1))
"RTN","GMRCP5D",119,0)
 ;I $L($G(^GMR(123,+GMRCIFN,1.11))) D
"RTN","GMRCP5D",120,0)
 . N SERV S SERV=$$UP^XLFSTR($P($G(^GMR(123.5,+$P(GMRCRD,U,5),0)),U,1))
"RTN","GMRCP5D",121,0)
 . N TYPE S TYPE=$$UP^XLFSTR(^GMR(123,+GMRCIFN,1.11)) I TYPE'=SERV D  Q
"RTN","GMRCP5D",122,0)
 .. D BLD("HDR",0,1,0,"Type: "_TYPE) Q
"RTN","GMRCP5D",123,0)
 .. D BLD("HDR",0,0,49,"Type: "_$E(TYPE,1,23)) Q
"RTN","GMRCP5D",124,0)
 D BLD("HDR",0,1,5,"From: "_GMRCFROM)
"RTN","GMRCP5D",125,0)
 D BLD("HDR",0,0,49,"|Requested: "_$$EXDT($P(GMRCRD,U,7)))
"RTN","GMRCP5D",126,0)
 ;
"RTN","GMRCP5D",127,0)
 D BLD("HDR",0,1,0,GMRCDVL)
"RTN","GMRCP5D",128,0)
 D BLD("HDR",0,1,0,"Requesting Facility: "_$E(GMRCFAC,1,22))
"RTN","GMRCP5D",129,0)
 I $P(GMRCRD,U,11) D BLD("HDR",0,0,45,"|ATTENTION: "_$E($P($G(^VA(200,+$P(GMRCRD,U,11),0)),U,1),1,21))
"RTN","GMRCP5D",130,0)
 D BLD("HDR",0,1,0,GMRCEQL)
"RTN","GMRCP5D",131,0)
 ;
"RTN","GMRCP5D",132,0)
 Q
"RTN","GMRCP5D",133,0)
 ;
"RTN","GMRCP5D",134,0)
CENTER(X) ;
"RTN","GMRCP5D",135,0)
 ;
"RTN","GMRCP5D",136,0)
 N TEXT,COL
"RTN","GMRCP5D",137,0)
 S COL=35-($L(X)\2) Q:(COL<1) X
"RTN","GMRCP5D",138,0)
 S $E(TEXT,COL)=X
"RTN","GMRCP5D",139,0)
 Q TEXT
"RTN","GMRCP5D",140,0)
 ;
"RTN","GMRCP5D",141,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5D",142,0)
 ;
"RTN","GMRCP5D",143,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5D",144,0)
 N LINECNT
"RTN","GMRCP5D",145,0)
 ;
"RTN","GMRCP5D",146,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5D",147,0)
 ;
"RTN","GMRCP5D",148,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5D",149,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5D",150,0)
 ;
"RTN","GMRCP5D",151,0)
 S GMRCLAST=SUB
"RTN","GMRCP5D",152,0)
 Q
"RTN","GMRCP5D",153,0)
 ;
"RTN","GMRCP5D",154,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5D",155,0)
 ;
"RTN","GMRCP5D",156,0)
 N NEXT
"RTN","GMRCP5D",157,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5D",158,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5D",159,0)
 Q
"RTN","GMRCP5D",160,0)
 ;
"RTN","GMRCP5D",161,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5D",162,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5D",163,0)
 ;
"RTN","GMRCP5D",164,0)
CONSRQ(IFN) ;
"RTN","GMRCP5D",165,0)
 ;
"RTN","GMRCP5D",166,0)
 N PTR,LINK,REF,GMRCRQ
"RTN","GMRCP5D",167,0)
 I +$P(^GMR(123,+IFN,0),U,8) D
"RTN","GMRCP5D",168,0)
 . S GMRCRQ=$P(^GMR(123,+IFN,0),U,8)
"RTN","GMRCP5D",169,0)
 . S PTR=$P(GMRCRQ,";",1),LINK=$P(GMRCRQ,";",2),REF=U_LINK_PTR_",0)"
"RTN","GMRCP5D",170,0)
 . S GMRCRQ=$P($G(@(REF)),U,2)
"RTN","GMRCP5D",171,0)
 . I '$L(GMRCRQ) S GMRCRQ="Procedure"
"RTN","GMRCP5D",172,0)
 I $L($G(GMRCRQ)) Q GMRCRQ
"RTN","GMRCP5D",173,0)
 I $L($G(^GMR(123,IFN,1.11))) D
"RTN","GMRCP5D",174,0)
 . N SERV,TYPE
"RTN","GMRCP5D",175,0)
 . S SERV=$$UP^XLFSTR($$GET1^DIQ(123.5,$P(^GMR(123,IFN,0),U,5),.01))
"RTN","GMRCP5D",176,0)
 . S TYPE=$$UP^XLFSTR(^GMR(123,IFN,1.11)) I TYPE'=SERV D
"RTN","GMRCP5D",177,0)
 . I TYPE'=SERV S GMRCRQ=$E(^GMR(123,IFN,1.11),1,36)
"RTN","GMRCP5D",178,0)
 Q:$L($G(GMRCRQ)) GMRCRQ Q "Consult"
"RTN","GMRCP5D",179,0)
 ;
"RTN","GMRCP5D",180,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5D",181,0)
 ;
"RTN","GMRCP5D",182,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5D",183,0)
 Q:'$L(X) ""
"RTN","GMRCP5D",184,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5D",185,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5D",186,0)
 ;
"RTN","GMRCPR0")
0^14^B15609646
"RTN","GMRCPR0",1,0)
GMRCPR0 ; SLC/DLT - Data Entry Promptint actions ;9/8/98  03:59
"RTN","GMRCPR0",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12**;DEC 27, 1997
"RTN","GMRCPR0",3,0)
ASK ;ASK FOR TO, PROCEDURE,URGENCY, AND PLACE OF CONSULT
"RTN","GMRCPR0",4,0)
 I $D(GMRCPR),'$D(GMRCPRI) S GMRCPRI=+GMRCPR_";ORD(101,",GMRCORSV=$S(+^ORD(101,+GMRCPR,5):+^(5),1:GMRCSS),GMRCSRVC=$P(^GMR(123.5,GMRCORSV,0),"^",1) K GMRCORSV
"RTN","GMRCPR0",5,0)
 I $S('$D(GMRCPR):1,GMRCPR="":1,1:0) D PROC Q:GMRCEND  S GMRCORSV=^ORD(101,+GMRCPRI,5),GMRCORSV=+GMRCORSV,GMRCSRVC=$P(^GMR(123.5,GMRCORSV,0),"^",1) K GMRCORSV
"RTN","GMRCPR0",6,0)
 I '$D(GMRCSRVC) S GMRCSRVC=GMRCSSNM
"RTN","GMRCPR0",7,0)
ASK1 I $L(GMRCWARD) S GMRCIOPT="I"
"RTN","GMRCPR0",8,0)
 E  S GMRCIOPT="O"
"RTN","GMRCPR0",9,0)
 S DIR(0)="123,14",DIR("A")="Service rendered on (I)npatient or (O)utpatient basis?",DIR("B")=GMRCIOPT D ^DIR K DIR I $D(DTOUT)!($D(DUOUT))!($D(DIROUT)) S GMRCEND=1 K DTOUT,DUOUT,DIROUT Q
"RTN","GMRCPR0",10,0)
 S GMRCIOPT=Y
"RTN","GMRCPR0",11,0)
 I GMRCIOPT="I" S X="GMRCURGENCYM REQ - INPATIENT"
"RTN","GMRCPR0",12,0)
 E  S X="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCPR0",13,0)
 S DIC=101,DIC(0)="X" D ^DIC K DIC Q:Y<0
"RTN","GMRCPR0",14,0)
 S XQORM("??")="D URGHELP^GMRCPH",XQORM=+Y_";ORD(101,",XQORM(0)="1A\"
"RTN","GMRCPR0",15,0)
 S XQORM("A")="URGENCY: ",XQORM("NO^^")=""
"RTN","GMRCPR0",16,0)
 S GMRCURG1=$G(^DISV(DUZ,"XQORM",XQORM,1)) I '$L(GMRCURG1) K GMRCURG1
"RTN","GMRCPR0",17,0)
 I $D(GMRCURG1) S GMRCURG1=$$UP^XLFSTR(GMRCURG1) I $O(^XUTL("XQORM",XQORM,"B",GMRCURG1,0)) S XQORM("B")=^DISV(DUZ,"XQORM",XQORM,1)
"RTN","GMRCPR0",18,0)
 F  D  Q:Y  I $D(GMRCEND),GMRCEND Q
"RTN","GMRCPR0",19,0)
 .K GMRCURG1
"RTN","GMRCPR0",20,0)
 .D EN^XQORM I X="^"!($D(DIROUT)) S GMRCEND=1 K DIROUT,DTOUT,DUOUT Q
"RTN","GMRCPR0",21,0)
 .I Y<0 S GMRCMSG="The URGENCY is a required response." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG
"RTN","GMRCPR0",22,0)
 .Q
"RTN","GMRCPR0",23,0)
 I $D(GMRCEND),GMRCEND Q
"RTN","GMRCPR0",24,0)
 I $D(Y(1)) S GMRCURG=$P(Y(1),"^",3),GMRCURGI=$P(Y(1),"^",2)
"RTN","GMRCPR0",25,0)
 I GMRCIOPT="I" S X="GMRCPLACEM - INPATIENT"
"RTN","GMRCPR0",26,0)
 E  S X="GMRCPLACEM - OUTPATIENT"
"RTN","GMRCPR0",27,0)
 S DIC=101,DIC(0)="X" D ^DIC Q:Y<0
"RTN","GMRCPR0",28,0)
 K XQORM S XQORM("??")="D PLHELP^GMRCPH",XQORM=+Y_";ORD(101,",XQORM(0)="1A\"
"RTN","GMRCPR0",29,0)
 S XQORM("A")="PLACE OF CONSULTATION: "
"RTN","GMRCPR0",30,0)
 S XQORM("B")=$P($G(^XUTL("XQORM",XQORM,1.1,0)),U,3),XQORM("NO^^")=""
"RTN","GMRCPR0",31,0)
 D EN^XQORM I X="^"!($D(DIROUT)) K XQORM,DIROUT,DTOUT,DUOUT S GMRCEND=1 Q
"RTN","GMRCPR0",32,0)
 I Y<0 D  Q:+$G(GMRCEND)
"RTN","GMRCPR0",33,0)
 .W $C(7),!!,"  The PLACE OF CONSULTATION is a required response!",!
"RTN","GMRCPR0",34,0)
 .D EN^XQORM K XQORM I X="^"!($D(DIROUT))!(Y<1) K DIROUT,DTOUT,DUOUT S GMRCEND=1 Q
"RTN","GMRCPR0",35,0)
 K XQORM I $D(Y(1)) S GMRCPL=$P(Y(1),"^",3),GMRCPLI=$P(Y(1),"^",2)
"RTN","GMRCPR0",36,0)
 Q
"RTN","GMRCPR0",37,0)
TO ;Get Service from File Link field
"RTN","GMRCPR0",38,0)
 S GMRCSS=$P($G(^ORD(101,+GMRCPRI,5)),"^")
"RTN","GMRCPR0",39,0)
 I '+GMRCSS D ASKTO Q:GMRCEND
"RTN","GMRCPR0",40,0)
 I +GMRCSS S GMRCSS=+GMRCSS,GMRCSSNM=$P($G(^GMR(123.5,GMRCSS,.1)),"^") I '$L(GMRCSSNM) S GMRCSSNM=$P($G(^GMR(123.5,GMRCSS,0)),"^",1)
"RTN","GMRCPR0",41,0)
 S ORTO=$O(^ORD(100.98,"B","CONSULTS",""))
"RTN","GMRCPR0",42,0)
 Q
"RTN","GMRCPR0",43,0)
ASKTO ;Ask for service when file link not defined in protocol file
"RTN","GMRCPR0",44,0)
 D SERV^GMRCPS I 'GMRCDG S GMRCEND=1 Q
"RTN","GMRCPR0",45,0)
 S GMRCSS=GMRCDG
"RTN","GMRCPR0",46,0)
 Q
"RTN","GMRCPR0",47,0)
PROC ;Use XQORM to select procedure
"RTN","GMRCPR0",48,0)
 S GMRCEND=0 N XQORM
"RTN","GMRCPR0",49,0)
 S DIC=101,X="GMRCRM REQUEST TYPES",DIC(0)="X" D ^DIC Q:Y<0
"RTN","GMRCPR0",50,0)
 S XQORM("??")="D PROCHELP^GMRCPH",XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Select PROCEDURE: ",XQORM("NO^^")="" I $D(GMRCPR),$L(GMRCPR) S XQORM("B")=GMRCPR
"RTN","GMRCPR0",51,0)
 D EN^XQORM K XQORM I X="^"!('$L(X))!($D(DIROUT)) S (GMRCQUT,GMRCEND)=1 K DIROUT,DTOUT,DUOUT Q
"RTN","GMRCPR0",52,0)
 I $D(Y(1)) S (GMRCVP,GMRCPRI)=$P(Y(1),"^",2)_";ORD(101,",GMRCPR=$S($D(^ORD(101,$P(Y(1),"^",2),.1)):$P(^(.1),"^"),1:"") I '$L(GMRCPR) S GMRCPR=$P(Y(1),"^",3)
"RTN","GMRCPR0",53,0)
 S X=$S($D(^ORD(101,+GMRCPRI,20)):$P(^(20)," D ",1),1:"") X:X]"" X S GMRCEN=$S($G(GMRCEN)]"":GMRCEN,1:""),GMRCTYPE=$S(GMRCEN="R":"GMRCOR REQUEST",1:"GMRCOR CONSULT")
"RTN","GMRCPR0",54,0)
 Q
"RTN","GMRCPR0",55,0)
 ;
"RTN","GMRCPR0",56,0)
GETSVC(SLIST,PROC) ;Get the services that process a procedure type (GMRCR protocol entry)
"RTN","GMRCPR0",57,0)
 N SVC,SCNT
"RTN","GMRCPR0",58,0)
 I '+$G(PROC) Q
"RTN","GMRCPR0",59,0)
 S SCNT=0,SLIST=SCNT
"RTN","GMRCPR0",60,0)
 S SVC=0
"RTN","GMRCPR0",61,0)
 F  S SVC=$O(^GMR(123.5,"APR",+PROC,SVC)) Q:'SVC  D
"RTN","GMRCPR0",62,0)
 . S SCNT=SCNT+1
"RTN","GMRCPR0",63,0)
 . S SLIST(SCNT)=SVC_"^"_$P($G(^GMR(123.5,SVC,0)),U,1)
"RTN","GMRCPR0",64,0)
 . Q
"RTN","GMRCPR0",65,0)
 S SLIST=SCNT
"RTN","GMRCPR0",66,0)
 Q
"RTN","GMRCREXT")
0^26^B2232546
"RTN","GMRCREXT",1,0)
GMRCREXT ;SLC/DCM - clean-up all variables and ^TMP globals upon exit ;7/16/98  03:49
"RTN","GMRCREXT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12**;DEC 27, 1997
"RTN","GMRCREXT",3,0)
 K ^TMP("GMRCR",$J),^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCREXT",4,0)
 K DFN,BLK,C,CDT,CNT,TAB,LNCT,CTRLCOL,D1,DATA,GMRCDT,GMRCND,GMRCNO,GMRCDT1,GMRCDT2,GMRCSEX,GMRCPNM,GMRCSSN,SEX,GMRCPTN,GMRCERR,GMRCWLI,GMRCPTR,GMRCSVCP,GMRCWRD,GMRCWT,GMRCDFN
"RTN","GMRCREXT",5,0)
 K GMRCRB,GMRCAGE,GMRCCT,GMRCSN,GMRCSSNM,GMRCDOB,GMRCDGT,GMRCDOB,GMRCGRP,GMRCWRD,GMRCNUL,GMRCQUIT,GMRCELIG,GMRCNUL,GMRCOER,GMRCSEL,GMRCOK,GMRCSSS
"RTN","GMRCREXT",6,0)
 K VAEL,VADM,VAERR
"RTN","GMRCREXT",7,0)
 K GMRCBM,GMRCTM,GMRCNUL,GMRCAD,GMRCXMF,GMRC,GMRCO,GMRCND
"RTN","GMRCREXT",8,0)
 Q
"RTN","GMRCSLM")
0^23^B34848103
"RTN","GMRCSLM",1,0)
GMRCSLM ;SLC/DCM,JFR - List Mgr routine for consult tracking list ;9/8/99 14:52
"RTN","GMRCSLM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,14,12**;DEC 27, 1997
"RTN","GMRCSLM",3,0)
EN ; -- main entry point for GMRC CONSULT TRACKING
"RTN","GMRCSLM",4,0)
 K GMRCOER
"RTN","GMRCSLM",5,0)
 S GMRCEN=1 K GMRCQUT
"RTN","GMRCSLM",6,0)
 D SP K GMRCEN I $D(GMRCQUT) K GMRCQUT Q
"RTN","GMRCSLM",7,0)
 D EN^VALM("GMRC CONSULT TRACKING")
"RTN","GMRCSLM",8,0)
 Q
"RTN","GMRCSLM",9,0)
 ;
"RTN","GMRCSLM",10,0)
HDR ; -- header code
"RTN","GMRCSLM",11,0)
 D HDR1 ;format line 1 of header
"RTN","GMRCSLM",12,0)
 D:$L(GMRCWT) HDR2("")
"RTN","GMRCSLM",13,0)
 Q
"RTN","GMRCSLM",14,0)
 ;
"RTN","GMRCSLM",15,0)
HDR1 ;format VALMHDR(1) with patient information
"RTN","GMRCSLM",16,0)
 N GMRCX,GMRCX1,GMRCX2,GMRCX3,TIUCWAD,GMRVSTR,X
"RTN","GMRCSLM",17,0)
 ;Expects DFN
"RTN","GMRCSLM",18,0)
 S GMRVSTR="WT" D EN6^GMRVUTL
"RTN","GMRCSLM",19,0)
 S GMRCWT="Wt.(lb): "_$S($L($P(X,U,8)):$P(X,U,8),1:"No Entry")
"RTN","GMRCSLM",20,0)
 D DEM^GMRCU ;returns GMRCPNM,GMRCSN,GMRCAGE,SEX,GMRCWARD,GMRCRB,GMRCDOB,GMRCWLI
"RTN","GMRCSLM",21,0)
 S GMRCX1=GMRCPNM_"   "_GMRCSN
"RTN","GMRCSLM",22,0)
 ;
"RTN","GMRCSLM",23,0)
 S GMRCLOC=+$G(^DIC(42,+GMRCWLI,44))_";SC(" I 'GMRCLOC,'$D(XQAID) S GMRCLOC=""
"RTN","GMRCSLM",24,0)
 S GMRCX2="" I +$G(GMRCLOC) D
"RTN","GMRCSLM",25,0)
 . N L S L=$G(^SC(+GMRCLOC,0)),GMRCX2=$P(L,U,2)
"RTN","GMRCSLM",26,0)
 . S:'$L(GMRCX2) GMRCX2=$E($P(L,U),1,4)
"RTN","GMRCSLM",27,0)
 S:$L($G(GMRCRB)) GMRCX2=GMRCX2_"/"_GMRCRB
"RTN","GMRCSLM",28,0)
 ;
"RTN","GMRCSLM",29,0)
 S GMRCX=GMRCX1_$J(GMRCX2,40+($L(GMRCX2)\2)-$L(GMRCX1))
"RTN","GMRCSLM",30,0)
 S GMRCX3=" "_GMRCDOB_" ("_GMRCAGE_")"
"RTN","GMRCSLM",31,0)
 S TIUCWAD=$$CWAD^ORQPT2(+DFN) S:TIUCWAD]"" GMRCX3=GMRCX3_"   <"_TIUCWAD_">"
"RTN","GMRCSLM",32,0)
 S VALMHDR(1)=GMRCX_$J(GMRCX3,79-$L(GMRCX))
"RTN","GMRCSLM",33,0)
 K VALMHDR(2)
"RTN","GMRCSLM",34,0)
 Q
"RTN","GMRCSLM",35,0)
HDR2(GMRCX) ;format VALMHDR(2) with patient weight
"RTN","GMRCSLM",36,0)
 S VALMHDR(2)=$G(GMRCX)_$J($G(GMRCWT),79-$L($G(GMRCX)))
"RTN","GMRCSLM",37,0)
 Q
"RTN","GMRCSLM",38,0)
 ;
"RTN","GMRCSLM",39,0)
INIT ; -- init variables and list array
"RTN","GMRCSLM",40,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCSLM",41,0)
 S DSPLINE=0,DATA="",VALMAR="^TMP(""GMRCR"",$J,""LIST"")"
"RTN","GMRCSLM",42,0)
 F LINE=1:1:LNCT S DSPLINE=$O(^TMP("GMRCR",$J,"CS",DSPLINE)) Q:DSPLINE=""!(DSPLINE?1A.E)  S DATA=^(DSPLINE,0) D SET^VALM10(LINE,DATA)
"RTN","GMRCSLM",43,0)
 S VALMCNT=LNCT,VALMPGE=1,XQORM("A")="Select Action: "
"RTN","GMRCSLM",44,0)
 K DSPLINE,DATA,LINE
"RTN","GMRCSLM",45,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCSLM",46,0)
 Q
"RTN","GMRCSLM",47,0)
 ;
"RTN","GMRCSLM",48,0)
HELP ; -- help code
"RTN","GMRCSLM",49,0)
 N X,DX,DY D FULL^VALM1
"RTN","GMRCSLM",50,0)
 W !!,"Enter the display number of the item you wish to act on, or select an action."
"RTN","GMRCSLM",51,0)
 W !!,"If you'd like another view of the consults, enter CV."
"RTN","GMRCSLM",52,0)
 W !!,"Status key:",!?5,"'a' - active",?27,"'c' - complete",?50,"'dc' - discontinued",!?5,"'p' - pending",?27,"'x' - cancelled",?50,"'pr' - partial results",!?5,"'s' - scheduled",?27,"'e' - expired"
"RTN","GMRCSLM",53,0)
 W !!,"Enter ?? to see a list of actions available for navigating the list."
"RTN","GMRCSLM",54,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","GMRCSLM",55,0)
 S VALMBCK="R"
"RTN","GMRCSLM",56,0)
 ; S VALMSG=$$MSG
"RTN","GMRCSLM",57,0)
 S (DX,DY)=0 X ^%ZOSF("XY")
"RTN","GMRCSLM",58,0)
 D EXIT^GMRCSLMA("R")
"RTN","GMRCSLM",59,0)
 Q
"RTN","GMRCSLM",60,0)
 ;
"RTN","GMRCSLM",61,0)
EXIT ; -- exit code
"RTN","GMRCSLM",62,0)
 K ^TMP("GMRCR",$J,"LIST")
"RTN","GMRCSLM",63,0)
 K VALMCNT,VALMBCK,VALMPGE
"RTN","GMRCSLM",64,0)
 D ^GMRCREXT
"RTN","GMRCSLM",65,0)
 Q
"RTN","GMRCSLM",66,0)
 ;
"RTN","GMRCSLM",67,0)
PHYEN ;Entry Point When Provider's service is known and only needs to look at consults for that service
"RTN","GMRCSLM",68,0)
 Q:'$D(DUZ)  Q:'$D(^VA(200,DUZ,5))  Q:'$L(^VA(200,DUZ,5))
"RTN","GMRCSLM",69,0)
 S DIC="^DIC(49,",DIC(0)="MNO",X=^VA(200,DUZ,5) D ^DIC K DIC S GMRCSSNM=$S($L($P(Y,"^",2)):$P(Y,"^",2),1:"") I $L(GMRCSSNM) S GMRCSS=$O(^GMR(123.5,"B",GMRCSSNM,0))
"RTN","GMRCSLM",70,0)
 S GMRCFL=1 D SP I $D(GMRCQUT),GMRCQUT=1 Q
"RTN","GMRCSLM",71,0)
 D SPD I $D(GMRCQUT) D END,EXIT Q
"RTN","GMRCSLM",72,0)
 K GMRCFL
"RTN","GMRCSLM",73,0)
 D AD^GMRCSLM1
"RTN","GMRCSLM",74,0)
 I GMRCSSNM'["MEDICINE" D EN^VALM("GMRC CONSULT TRACKING"),END,EXIT Q
"RTN","GMRCSLM",75,0)
 D EN^VALM("GMRC TRK MEDICINE CONSULTS"),END,EXIT Q
"RTN","GMRCSLM",76,0)
 Q
"RTN","GMRCSLM",77,0)
SP ;;Select a new patient and return DFN and GMRCSSNM to display consults and requested Service.
"RTN","GMRCSLM",78,0)
 I $D(VALM) D FULL^VALM1
"RTN","GMRCSLM",79,0)
 K GMRCQUT S GMRCDFN1=$S($D(DFN):DFN,1:0)
"RTN","GMRCSLM",80,0)
 D SELPT^GMRCS I $S($D(GMRCQUT):1,'$D(DFN):1,1:0) S GMRCQUT=1,DFN=GMRCDFN1 G SPK
"RTN","GMRCSLM",81,0)
 I $D(Y),Y<0&(X["^") S GMRCQUT=1 G SPK
"RTN","GMRCSLM",82,0)
 I $D(Y),Y<0 S DFN=GMRCDFN1 S GMRCQUT=1 G SPK
"RTN","GMRCSLM",83,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLM",84,0)
 S GMRCWRD=GMRCWARD
"RTN","GMRCSLM",85,0)
 I $D(GMRCFL) D SPK Q
"RTN","GMRCSLM",86,0)
 D ASRV^GMRCASV I $S($D(GMRCQUT):1,$D(DTOUT):1,$D(DUOUT):1,1:0) K DTOUT,DIROUT,DUOUT S (GMRCQUT,GMRCQIT)=1 Q
"RTN","GMRCSLM",87,0)
 S GMRCSS=GMRCDG,GMRCSSNM=$P(^GMR(123.5,GMRCSS,0),"^",1) S GMRCSTCK=""
"RTN","GMRCSLM",88,0)
 D EN^GMRCMENU
"RTN","GMRCSLM",89,0)
SPD ;Enter a date range for serching consults;  null entry selects all consults and does not exclude by date
"RTN","GMRCSLM",90,0)
 D ^GMRCSPD Q:$D(GMRCQUT)
"RTN","GMRCSLM",91,0)
 I $D(GMRCEN) D SPK Q  ;GMRCEN defined if branched to here from EN^GMRCSLM
"RTN","GMRCSLM",92,0)
 S GMRCOER=0
"RTN","GMRCSLM",93,0)
 D AD^GMRCSLM1 ;Do not delete. Needed to get new Pt. data into ^TMP("GMRCR",
"RTN","GMRCSLM",94,0)
 S VALMCNT=LNCT,VALMBCK="R",VALMPGE=1 K GMRCDFN1
"RTN","GMRCSLM",95,0)
 Q
"RTN","GMRCSLM",96,0)
SPQ ;New patient has not been selected - keep current patient
"RTN","GMRCSLM",97,0)
 I '$D(DFN),GMRCDFN1<1 S GMRCQUT=1 K GMRCDFN1 Q
"RTN","GMRCSLM",98,0)
 S DFN=GMRCDFN1 Q:DFN<1  W " "_GMRCPNM K GMRCDFN1
"RTN","GMRCSLM",99,0)
 S VALMBCK="R",GMRCQUT=1 K GMRCDFN1
"RTN","GMRCSLM",100,0)
SPK ;Kill variables
"RTN","GMRCSLM",101,0)
 ;I $D(GMRCTM),$D(GMRCBM),$D(IOSTBM) S IOTM=GMRCTM,IOBM=IOSTBM
"RTN","GMRCSLM",102,0)
 K GMRCDFN1,GMRCBM,GMRCTM
"RTN","GMRCSLM",103,0)
 Q
"RTN","GMRCSLM",104,0)
SS ;Select A New Service or ALL SERVICES to Display Patient Consults
"RTN","GMRCSLM",105,0)
 K GMRCQUT,GMRCVP S GMRCOER=0
"RTN","GMRCSLM",106,0)
 D FULL^VALM1
"RTN","GMRCSLM",107,0)
 D ASRV^GMRCASV I $D(GMRCQUT),GMRCQUT=1 Q
"RTN","GMRCSLM",108,0)
 S GMRCSS=GMRCDG,GMRCSSNM=$P(^GMR(123.5,GMRCSS,0),"^",1)
"RTN","GMRCSLM",109,0)
 D AD^GMRCSLM1,INIT,HDR
"RTN","GMRCSLM",110,0)
 S VALMBCK="R",VALMCNT=LNCT
"RTN","GMRCSLM",111,0)
 D EN^GMRCACTM,EN^GMRCMENU
"RTN","GMRCSLM",112,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLM",113,0)
 Q
"RTN","GMRCSLM",114,0)
STS ;Select a status for view. i.e., only active, pendings, DC'd, etc.
"RTN","GMRCSLM",115,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCSLM",116,0)
 S GMRCERR=0
"RTN","GMRCSLM",117,0)
 N DIR,X,Y
"RTN","GMRCSLM",118,0)
 S DIR(0)="SAOM^dc:Discontinued;c:Complete;p:Pending;a:Active;pr:Partial Results;s:Scheduled;x:Cancelled"
"RTN","GMRCSLM",119,0)
 S $P(DIR(0),U,2)="al:All Status's;"_$P(DIR(0),U,2)
"RTN","GMRCSLM",120,0)
 S DIR("A")="Only Display Consults With Status of: "
"RTN","GMRCSLM",121,0)
 S DIR("B")="All Status's"
"RTN","GMRCSLM",122,0)
 I $G(GMRCSTCK) D
"RTN","GMRCSLM",123,0)
 . S DIR("A")="Another Status to display: "
"RTN","GMRCSLM",124,0)
 . K DIR("B")
"RTN","GMRCSLM",125,0)
 D ^DIR
"RTN","GMRCSLM",126,0)
 I $D(DUOUT)!($D(DTOUT))!('$L(Y)) G END
"RTN","GMRCSLM",127,0)
 D STCK($$LOW^XLFSTR(Y)) I $G(GMRCSTCK)="" D:$D(GMRC("NMBR"))  G END
"RTN","GMRCSLM",128,0)
 . D RESET^GMRCSLMV(GMRC("NMBR"))
"RTN","GMRCSLM",129,0)
 . K GMRC("NMBR")
"RTN","GMRCSLM",130,0)
 . Q
"RTN","GMRCSLM",131,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLM",132,0)
 G STS
"RTN","GMRCSLM",133,0)
STCK(RES)     ;change code to status
"RTN","GMRCSLM",134,0)
 N CODE
"RTN","GMRCSLM",135,0)
 I RES="al" S GMRCSTCK="" Q
"RTN","GMRCSLM",136,0)
 I RES="dc" S CODE=1
"RTN","GMRCSLM",137,0)
 I RES="c" S CODE=2
"RTN","GMRCSLM",138,0)
 I RES="p" S CODE=5
"RTN","GMRCSLM",139,0)
 I RES="a" S CODE=6
"RTN","GMRCSLM",140,0)
 I RES="pr" S CODE=9
"RTN","GMRCSLM",141,0)
 I RES="x" S CODE=13
"RTN","GMRCSLM",142,0)
 I RES="s" S CODE=8
"RTN","GMRCSLM",143,0)
 I $D(GMRCSTCK)  I $$FND(CODE) W $C(7),!,"Already selected" Q
"RTN","GMRCSLM",144,0)
 I +$G(GMRCSTCK) S GMRCSTCK=GMRCSTCK_","_CODE Q
"RTN","GMRCSLM",145,0)
 S GMRCSTCK=CODE
"RTN","GMRCSLM",146,0)
 Q
"RTN","GMRCSLM",147,0)
FND(CD) ;status already selected?
"RTN","GMRCSLM",148,0)
 I GMRCSTCK=CD Q 1
"RTN","GMRCSLM",149,0)
 I $F(GMRCSTCK,(CD_",")) Q 1
"RTN","GMRCSLM",150,0)
 I $E(GMRCSTCK,$L(GMRCSTCK))=CD Q 1
"RTN","GMRCSLM",151,0)
 Q 0
"RTN","GMRCSLM",152,0)
END K DIR,GMRCERR,Y
"RTN","GMRCSLM",153,0)
 Q
"RTN","GMRCSLM1")
0^24^B44568838
"RTN","GMRCSLM1",1,0)
GMRCSLM1 ;SLC/DCM - Gather data and format ^TMP global for consult tracking Silent call for use by List Manager and GUI ;9/8/98  03:37
"RTN","GMRCSLM1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,10,12**;DEC 27, 1997
"RTN","GMRCSLM1",3,0)
 ;USING LIST MANAGER.
"RTN","GMRCSLM1",4,0)
 G AD
"RTN","GMRCSLM1",5,0)
SVC(NODE) ;Check for a valid service
"RTN","GMRCSLM1",6,0)
 K GMRCDEAV
"RTN","GMRCSLM1",7,0)
 I '$D(^GMR(123,NODE,0)) Q 0
"RTN","GMRCSLM1",8,0)
 I '+$P(^GMR(123,NODE,0),"^",5) Q 0
"RTN","GMRCSLM1",9,0)
 I '$D(^TMP("GMRCS",$J,$P(^GMR(123,NODE,0),"^",5))) Q 0
"RTN","GMRCSLM1",10,0)
 Q 1
"RTN","GMRCSLM1",11,0)
AD ;Main entry point. Loop through AD x-ref in file 123; Find consults that have been released to requested service
"RTN","GMRCSLM1",12,0)
 ;;DFN and GMRCSSNM must be defined when this entry point is called
"RTN","GMRCSLM1",13,0)
 ;;DFN=Internal File Number of Patient in ^DPT
"RTN","GMRCSLM1",14,0)
 ;;GMRCSSNM=Service Name of a Hospital Service from file ^GMR(123.5
"RTN","GMRCSLM1",15,0)
 ;;If GMRCSSNM is not defined or is null, then no records will be found.
"RTN","GMRCSLM1",16,0)
 ;;GMRCOER must be passed so that proper formatting for GUI or List Manager can be performed.  GMRCOER is passed as 0 for List Manager, 1 for GUI.
"RTN","GMRCSLM1",17,0)
 ;;GMRCDT1 and GMRCDT2 are passed in as start and stop dates for the lookup. If GMRCDT1="" or GMRCDT1="ALL", then all dates are searched.
"RTN","GMRCSLM1",18,0)
 ;;  ***********************************************************
"RTN","GMRCSLM1",19,0)
 K ^TMP("GMRCR",$J,"CS"),GMRCNUL
"RTN","GMRCSLM1",20,0)
 I $D(GMRCSSS) S (GMRCDG,GMRCSS)=GMRCSSS,GMRCSSNM=($P($G(^GMR(123.5,+GMRCSS,0)),"^",1)) D SERV1^GMRCASV K GMRCSSS ;reset after forward
"RTN","GMRCSLM1",21,0)
 S TAB="",$P(TAB," ",41)="",BLK=0,LNCT=1 S:'$D(GMRCOER) GMRCOER=0
"RTN","GMRCSLM1",22,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,"AD",DFN,GMRCD)) Q:'GMRCD  S GMRCDA=0 F  S GMRCDA=$O(^GMR(123,"AD",DFN,GMRCD,GMRCDA)) Q:'GMRCDA  I $$SVC(GMRCDA) D SET
"RTN","GMRCSLM1",23,0)
 D END Q
"RTN","GMRCSLM1",24,0)
SET ;;Format entries into a word processing 'TMP("GMRCR",$J,"CS",' global that List Manager can display
"RTN","GMRCSLM1",25,0)
 ;;GMRCOER is a variable that signals that data is being formatted for the OE/RR GUI; this data is formatted differently than the data for List Manager.
"RTN","GMRCSLM1",26,0)
 ;;GMRCOER=0 : Data is List Manager formatted.
"RTN","GMRCSLM1",27,0)
 ;;GMRCOER=1 : Data is OE/RR GUI formatted.
"RTN","GMRCSLM1",28,0)
 S:'$D(TAB) TAB="",$P(TAB," ",30)=""
"RTN","GMRCSLM1",29,0)
 S GMRCIFN=$G(GMRCDA) I '$L(GMRCIFN),$D(XQADATA) S (GMRCDA,GMRCIFN)=+XQADATA
"RTN","GMRCSLM1",30,0)
 S GMRCSEX=$S($P(^DPT(DFN,0),"^",2)="M":"MALE",1:"FEMALE")
"RTN","GMRCSLM1",31,0)
 I '$D(^GMR(123,+GMRCIFN,0)) S GMRCQUT=1 Q
"RTN","GMRCSLM1",32,0)
 S PROC="",GMRC(0)=^GMR(123,GMRCIFN,0)
"RTN","GMRCSLM1",33,0)
 I $D(GMRCSTCK),GMRCSTCK'="" N STATUS,TITLE D  Q:'STATUS
"RTN","GMRCSLM1",34,0)
 . N I
"RTN","GMRCSLM1",35,0)
 . F I=1:1 S STATUS=$P(GMRCSTCK,",",I) Q:STATUS=$P(GMRC(0),"^",12)  Q:'STATUS
"RTN","GMRCSLM1",36,0)
 . Q
"RTN","GMRCSLM1",37,0)
 I $D(GMRCVP),GMRCVP'=$P(GMRC(0),"^",8) Q
"RTN","GMRCSLM1",38,0)
 S (GMRCFMDT,X)=$P(GMRC(0),"^",7) I GMRCDT1'="ALL",$P(X,".",1)<GMRCDT1!($P(X,".",1)>GMRCDT2) Q
"RTN","GMRCSLM1",39,0)
 S BLK=BLK+1,^TMP("GMRCR",$J,"CS","AD",BLK,LNCT,GMRCDA)=""
"RTN","GMRCSLM1",40,0)
 D REGDTM^GMRCU S CDT=$P(X," ")
"RTN","GMRCSLM1",41,0)
 S PROC=$S($$GET1^DIQ(101,+$P(GMRC(0),U,17),.01)["CONS":"Consult",1:"")
"RTN","GMRCSLM1",42,0)
 I PROC'="Consult" S PROC=$$GET1^DIQ(101,+$P(GMRC(0),"^",8),1)
"RTN","GMRCSLM1",43,0)
 S:PROC="" PROC="Consult"
"RTN","GMRCSLM1",44,0)
 S TO=+$P(GMRC(0),"^",5)
"RTN","GMRCSLM1",45,0)
 I +TO S TOD=$S($P($G(^GMR(123.5,+TO,0)),"^",2)=9:1,1:0)
"RTN","GMRCSLM1",46,0)
 I '$D(TOD) S TOD=0
"RTN","GMRCSLM1",47,0)
 S TO=$S(+TO:$P($G(^GMR(123.5,+TO,0)),"^",1),1:"")
"RTN","GMRCSLM1",48,0)
 S TO=$S(TOD:"<",1:"")_TO
"RTN","GMRCSLM1",49,0)
 S TO=$S(GMRCOER:TO,1:$E(TO,1,40))_$S(TOD:">",1:"")
"RTN","GMRCSLM1",50,0)
 I '$L(TO) S TO="**Unknown Service**"
"RTN","GMRCSLM1",51,0)
 S STS=$P(GMRC(0),"^",12) I +STS,$D(^ORD(100.01,+STS,0)) S:'+GMRCOER STS=$P(^ORD(100.01,+STS,.1),"^",1) I +GMRCOER S STS=$S(GMRCOER=1:$P(^ORD(100.01,+STS,0),"^",1),1:$P(^ORD(100.01,+STS,.1),"^",1))
"RTN","GMRCSLM1",52,0)
 I $S(STS="":1,'$D(^ORD(100.01,+$P(GMRC(0),"^",12),0)):1,1:0) S STS=99,$P(GMRC(0),"^",12)=STS,STS=$S(GMRCOER=1:$P(^ORD(100.01,5,0),"^",1),1:$P(^ORD(100.01,+STS,.1),"^",1))
"RTN","GMRCSLM1",53,0)
 D SERVPROC
"RTN","GMRCSLM1",54,0)
 I 'GMRCOER D  Q
"RTN","GMRCSLM1",55,0)
 . S ^TMP("GMRCR",$J,"CS",LNCT,0)=BLK_$E(TAB,1,(4-$L(BLK)))_CDT_"   "_$E(STS,1,3)_$S(STS?1A:"  ",STS?2A:" ",1:"")_" "_$J(GMRCDA,7)_" "_$S($P(GMRC(0),"^",19)="Y":"*",1:" ")_TITLE
"RTN","GMRCSLM1",56,0)
 .S LNCT=LNCT+1 Q
"RTN","GMRCSLM1",57,0)
 I GMRCOER D
"RTN","GMRCSLM1",58,0)
 . S ^TMP("GMRCR",$J,"CS",LNCT,0)=GMRCDA_U_GMRCFMDT_U_STS_U_TO_U_PROC_U_$S($P(GMRC(0),U,19)="Y":"*",1:"")_U_TITLE_U_$P(GMRC(0),U,3)
"RTN","GMRCSLM1",59,0)
 . ;pass ORIFN to CPRS with array
"RTN","GMRCSLM1",60,0)
 . S LNCT=LNCT+1
"RTN","GMRCSLM1",61,0)
 . K STSOER Q
"RTN","GMRCSLM1",62,0)
 Q
"RTN","GMRCSLM1",63,0)
END I LNCT<2 S (BLK,LNCT,GMRCNUL)=1,GMRCNPM="< PATIENT DOES NOT HAVE ANY CONSULTS/REQUESTS "_$S($D(GMRCPRNM):"FOR "_GMRCPRNM,1:"")_" ON FILE. >",GMRCNPM=$E(TAB,1,(80-$L(GMRCNPM))\80)_GMRCNPM,^TMP("GMRCR",$J,"CS",LNCT,0)=GMRCNPM D
"RTN","GMRCSLM1",64,0)
 .I GMRCDT1'="ALL",$D(GMRCDT1)&($D(GMRCDT2)) S LNCT=LNCT+1,^TMP("GMRCR",$J,"CS",LNCT,0)="Between Dates: "_$$FMTE^XLFDT(GMRCDT1)_" and "_$$FMTE^XLFDT(GMRCDT2)
"RTN","GMRCSLM1",65,0)
 .I $D(GMRCSTCK),$L(GMRCSTCK) S LNCT=LNCT+1,^TMP("GMRCR",$J,"CS",LNCT,0)="With Status: " S STS="" F I=1:1 S STS=$P(GMRCSTCK,",",I) Q:STS=""  S ^TMP("GMRCR",$J,"CS",LNCT,0)=^(0)_$P($G(^ORD(100.01,+STS,0)),"^",1)_" "
"RTN","GMRCSLM1",66,0)
 .Q
"RTN","GMRCSLM1",67,0)
 E  S (BLK,LNCT)=LNCT-1,^TMP("GMRCR",$J,"CS",0)="^^^"_LNCT
"RTN","GMRCSLM1",68,0)
 I $D(GMRCALFL) S (BLK,LNCT)=1
"RTN","GMRCSLM1",69,0)
 K TO,TOD,END,FLG,GMRC(0),GMRCD,GMRCDG,GMRCIFN,GMRCFMDT,GMRCNPM,GMRCWARD,I,PROC,STS,URG
"RTN","GMRCSLM1",70,0)
 Q
"RTN","GMRCSLM1",71,0)
OER(DFN,GMRCDG,GMRCDT1,GMRCDT2,GMRCSTCK,GMRCOER) ;;GUI interface for CPRS
"RTN","GMRCSLM1",72,0)
 ;;DFN=Patient internal file number
"RTN","GMRCSLM1",73,0)
 ;;GMRCDG:  Internal file number of consult service (from file ^GMR(123.5,)
"RTN","GMRCSLM1",74,0)
 ;;GMRCDT1:  Beginning date for lookup
"RTN","GMRCSLM1",75,0)
 ;;GMRCDT2:  Ending date for lookup
"RTN","GMRCSLM1",76,0)
 ;;GMRCSTCK: IEN from OER Status File [^OER(100.01)] to screen results
"RTN","GMRCSLM1",77,0)
 ;;     so that only consults with a desired status are displayed
"RTN","GMRCSLM1",78,0)
 ;;     Can be sent as a set of statuses: i.e., 6,5,2
"RTN","GMRCSLM1",79,0)
 ;;      (GMRCSTCK=GMRC STATUS CHECK)
"RTN","GMRCSLM1",80,0)
 ;;GMRCOER=0 if request is from CONSULTS; GMRCOER=1 if request is for CPRS List Manager, 2 if for CPRS GUI
"RTN","GMRCSLM1",81,0)
 I GMRCDT1="" S GMRCDT1="ALL"
"RTN","GMRCSLM1",82,0)
 I GMRCDG="" S GMRCDG=$O(^GMR(123.5,"B","ALL SERVICES",0))
"RTN","GMRCSLM1",83,0)
 S:'$D(GMRCOER) GMRCOER=1
"RTN","GMRCSLM1",84,0)
 D SERV1^GMRCASV,AD
"RTN","GMRCSLM1",85,0)
 K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCSLM1",86,0)
 Q
"RTN","GMRCSLM1",87,0)
SERVPROC ; Build contents of SERV/PROC field for List Manager
"RTN","GMRCSLM1",88,0)
 S TITLE=""
"RTN","GMRCSLM1",89,0)
 S TYPE=""
"RTN","GMRCSLM1",90,0)
 S OTXT=$P($G(^GMR(123,GMRCDA,1.11)),"^")
"RTN","GMRCSLM1",91,0)
 I OTXT="" D BUILD2
"RTN","GMRCSLM1",92,0)
 I OTXT'="" D BUILD1
"RTN","GMRCSLM1",93,0)
 Q
"RTN","GMRCSLM1",94,0)
BUILD1 ;OTXT does contain information
"RTN","GMRCSLM1",95,0)
 N FLG,BADFLG,TPROC,TTO
"RTN","GMRCSLM1",96,0)
 S TPROC=$$UP^XLFSTR(PROC),TTO=$$UP^XLFSTR(TO)
"RTN","GMRCSLM1",97,0)
 S TITLE=OTXT,OTXT=$$UP^XLFSTR(OTXT)
"RTN","GMRCSLM1",98,0)
 S BADFLG=0
"RTN","GMRCSLM1",99,0)
 I PROC="Consult" S FLG=1,TYPE="Cons"
"RTN","GMRCSLM1",100,0)
 I PROC'="Consult" S FLG=0,TYPE="Proc"
"RTN","GMRCSLM1",101,0)
 S LEN=$L(TITLE)
"RTN","GMRCSLM1",102,0)
 I TO="" S TO="No Service"
"RTN","GMRCSLM1",103,0)
 I LEN<30,FLG=1,OTXT'=TTO S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",104,0)
 I LEN<30,FLG=1,OTXT=TTO S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",105,0)
 I TO["<" S BADFLG=1
"RTN","GMRCSLM1",106,0)
 S ABBRS=$$SVC^GMRCAU(GMRCDA),ABBRP=$$PROC^GMRCAU(GMRCDA)
"RTN","GMRCSLM1",107,0)
 I LEN<30,FLG=0,TPROC'=OTXT,TTO'=TPROC S TITLE=TITLE_" "_PROC_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",108,0)
 I LEN<30,FLG=0,TPROC=OTXT,TTO'=TPROC S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",109,0)
 I LEN<30,FLG=0,TPROC=OTXT,TTO=TPROC S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",110,0)
 I LEN>30,FLG=1,TTO'=OTXT S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",111,0)
 I LEN>30,FLG=1,TTO=OTXT S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",112,0)
 I LEN>30,FLG=0,TPROC'=OTXT,TTO'=TPROC S TITLE=TITLE_" "_ABBRP_" "_TYPE Q
"RTN","GMRCSLM1",113,0)
 I LEN>30,FLG=0,TTO'=OTXT,BADFLG=0 S TITLE=TITLE_" "_ABBRS_" "_TYPE Q
"RTN","GMRCSLM1",114,0)
 I LEN>30,FLG=0,TTO'=OTXT,BADFLG=1 S TITLE=TITLE_" "_"<"_ABBRS_">"_TYPE Q
"RTN","GMRCSLM1",115,0)
 Q
"RTN","GMRCSLM1",116,0)
BUILD2 ;OTXT contains no information
"RTN","GMRCSLM1",117,0)
 N FLG,TPROC,TTO
"RTN","GMRCSLM1",118,0)
 S TPROC=$$UP^XLFSTR(PROC),TTO=$$UP^XLFSTR(TO)
"RTN","GMRCSLM1",119,0)
 I PROC="Consult" S TITLE=TO,LEN=$L(TITLE),FLG=1,TYPE="Cons"
"RTN","GMRCSLM1",120,0)
 I PROC'="Consult" S TITLE=PROC,LEN=$L(TITLE),FLG=0,TYPE="Proc"
"RTN","GMRCSLM1",121,0)
 I FLG=1 S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",122,0)
 I FLG=0,TTO=TPROC S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",123,0)
 I FLG=0,TTO'=TPROC S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",124,0)
 Q
"RTN","GMRCSLM4")
0^25^B19294992
"RTN","GMRCSLM4",1,0)
GMRCSLM4 ;SLC/DCM - List Manager routine - Activity Log Detailed Display ;1/28/99 10:30
"RTN","GMRCSLM4",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12**;DEC 27,1997
"RTN","GMRCSLM4",3,0)
ACTLOG(GMRCO) ;Print activity log
"RTN","GMRCSLM4",4,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",5,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Activity"_$E(TAB,1,17)_"Date/Time"_$E(TAB,1,6)_"Responsible Person"_$E(TAB,1,2)_"Entered By",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",6,0)
 N GMRCD,GMRCDA
"RTN","GMRCSLM4",7,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDA="" F  S GMRCDA=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDA)) Q:'GMRCDA  D BLDALN(GMRCO,GMRCDA)
"RTN","GMRCSLM4",8,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",9,0)
 Q
"RTN","GMRCSLM4",10,0)
 ;
"RTN","GMRCSLM4",11,0)
BLDALN(GMRCO,GMRCDA) ;Build Activity Log Lines for an activity
"RTN","GMRCSLM4",12,0)
 ; GMRCO=  consult internal entry number
"RTN","GMRCSLM4",13,0)
 ; GMRCDA= activity internal entry number
"RTN","GMRCSLM4",14,0)
 N GMRCACT,GMRCSLN,XDT1,XDT2,FLG,LN,LINE,DASH,X,GMRCX,GMRCDEV
"RTN","GMRCSLM4",15,0)
 S GMRCDA(0)=^GMR(123,+GMRCO,40,GMRCDA,0)
"RTN","GMRCSLM4",16,0)
 S GMRCACT=$P(GMRCDA(0),"^",2)
"RTN","GMRCSLM4",17,0)
 D BLDLN1
"RTN","GMRCSLM4",18,0)
 D BLDLN2
"RTN","GMRCSLM4",19,0)
 D BLDCMTS
"RTN","GMRCSLM4",20,0)
 Q
"RTN","GMRCSLM4",21,0)
 ;
"RTN","GMRCSLM4",22,0)
BLDLN1 ;Build the first line for the activity
"RTN","GMRCSLM4",23,0)
 ;GMRCX is scratch pad variable
"RTN","GMRCSLM4",24,0)
 S GMRCX=$P($G(^GMR(123.1,+GMRCACT,0)),"^",1)
"RTN","GMRCSLM4",25,0)
 S:'$L(GMRCX) GMRCX=GMRCACT_" action?"
"RTN","GMRCSLM4",26,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCX
"RTN","GMRCSLM4",27,0)
 ;
"RTN","GMRCSLM4",28,0)
 ;Add to line for Printed to (action 22) when device name <13 characters
"RTN","GMRCSLM4",29,0)
 I GMRCACT=22 D
"RTN","GMRCSLM4",30,0)
 . S GMRCDEV=$$GET1^DIQ(3.5,+$P(GMRCDA(0),"^",8),.01)
"RTN","GMRCSLM4",31,0)
 . I '$L(GMRCDEV) S GMRCDEV=$P(GMRCDA(0),"^",8)
"RTN","GMRCSLM4",32,0)
 . I $L(GMRCDEV)<13 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_" "_GMRCDEV K GMRCDEV
"RTN","GMRCSLM4",33,0)
 ;
"RTN","GMRCSLM4",34,0)
 ;Add on generic fields that apply to every activity
"RTN","GMRCSLM4",35,0)
 ;Date/time of Actual Activity, Who's Responsible for Activity,
"RTN","GMRCSLM4",36,0)
 ;and Who entered activity
"RTN","GMRCSLM4",37,0)
 S X=$P(GMRCDA(0),"^",3) D REGDTM^GMRCU S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$S($D(^TMP("GMRCR",$J,"DT",GMRCCT,0)):^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,25-$L(^(0)))_X,1:X)
"RTN","GMRCSLM4",38,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,40-$L(^(0)))_$S($P(GMRCDA(0),"^",4):$E($P($G(^VA(200,$P(GMRCDA(0),"^",4),0)),"^"),1,18),1:$E(TAB,1,19))
"RTN","GMRCSLM4",39,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,60-$L(^(0)))_$S($P(GMRCDA(0),"^",5):$E($P($G(^VA(200,$P(GMRCDA(0),"^",5),0)),"^"),1,19),1:$E(TAB,1,19))
"RTN","GMRCSLM4",40,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",41,0)
 Q
"RTN","GMRCSLM4",42,0)
 ;
"RTN","GMRCSLM4",43,0)
BLDLN2 ;SECOND line for activity
"RTN","GMRCSLM4",44,0)
 ;Get Incomplete Report and Complete result # for second line of action
"RTN","GMRCSLM4",45,0)
 N GMRCSLN S GMRCSLN="" ;saved SECOND line
"RTN","GMRCSLM4",46,0)
 I +$P(GMRCDA(0),"^",9) D
"RTN","GMRCSLM4",47,0)
 . S GMRCSLN=$E(TAB,1,5)_"Note# "_+$P(GMRCDA(0),"^",9)
"RTN","GMRCSLM4",48,0)
 ;
"RTN","GMRCSLM4",49,0)
 ;If GMRCDEV is defined, than print the device name on the second line
"RTN","GMRCSLM4",50,0)
 I GMRCACT=22,$D(GMRCDEV) D
"RTN","GMRCSLM4",51,0)
 . S GMRCSLN=$E(TAB,1,5)_$E(GMRCDEV,1,17) K GMRCDEV
"RTN","GMRCSLM4",52,0)
 ;
"RTN","GMRCSLM4",53,0)
 ;Build line for forwarded to (action 17)
"RTN","GMRCSLM4",54,0)
 I GMRCACT=17 D
"RTN","GMRCSLM4",55,0)
 . S GMRCX=$P($G(^GMR(123.5,+$P(GMRCDA(0),"^",6),0)),"^")
"RTN","GMRCSLM4",56,0)
 . S:'$L(GMRCX) GMRCX=$P(GMRCDA(0),"^",6)_" ??"
"RTN","GMRCSLM4",57,0)
 . S GMRCSLN=$E(TAB,1,5)_GMRCX
"RTN","GMRCSLM4",58,0)
 ;
"RTN","GMRCSLM4",59,0)
 ; Check if the entry date and specified actual date are different
"RTN","GMRCSLM4",60,0)
 S XDT1=$P(GMRCDA(0),"^",1),XDT2=$P(GMRCDA(0),"^",3),GMRCX=0
"RTN","GMRCSLM4",61,0)
 S:XDT2>XDT1 X=XDT1,XDT1=XDT2,XDT2=X
"RTN","GMRCSLM4",62,0)
 S GMRCDIF=$$FMDIFF^XLFDT(XDT1,XDT2,3)
"RTN","GMRCSLM4",63,0)
 I $L(GMRCDIF) D
"RTN","GMRCSLM4",64,0)
 . I +$P(GMRCDIF," ",1)>0 S GMRCX=1 Q  ;Check Days
"RTN","GMRCSLM4",65,0)
 . S GMRCDIF=$P(GMRCDIF," ",2)
"RTN","GMRCSLM4",66,0)
 . I +$P(GMRCDIF,":",1)>0 S GMRCX=1 Q  ;Check Hours
"RTN","GMRCSLM4",67,0)
 . I +$P(GMRCDIF,":",2)>1 S GMRCX=1 Q  ;Check Minutes
"RTN","GMRCSLM4",68,0)
 . Q
"RTN","GMRCSLM4",69,0)
 I GMRCX D
"RTN","GMRCSLM4",70,0)
 . S X=$P(GMRCDA(0),"^",1) D REGDTM^GMRCU
"RTN","GMRCSLM4",71,0)
 . S GMRCSLN=$E(GMRCSLN_TAB,1,25)_X_" (entered)"
"RTN","GMRCSLM4",72,0)
 . Q
"RTN","GMRCSLM4",73,0)
 ;
"RTN","GMRCSLM4",74,0)
 I $L(GMRCSLN) D
"RTN","GMRCSLM4",75,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCSLN
"RTN","GMRCSLM4",76,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",77,0)
 . Q
"RTN","GMRCSLM4",78,0)
 Q
"RTN","GMRCSLM4",79,0)
 ;
"RTN","GMRCSLM4",80,0)
BLDCMTS ;Build lines for Comment activity.
"RTN","GMRCSLM4",81,0)
 I GMRCACT=11 D BLDCMT Q
"RTN","GMRCSLM4",82,0)
 ;
"RTN","GMRCSLM4",83,0)
 ;Build lines for general comments on any activity
"RTN","GMRCSLM4",84,0)
 I $D(^GMR(123,+GMRCO,40,+GMRCDA,1)) D  Q
"RTN","GMRCSLM4",85,0)
 . S LN=$O(^GMR(123,+GMRCO,40,+GMRCDA,1,0)) Q:'+LN
"RTN","GMRCSLM4",86,0)
 . ;Check for edited fields generated text with lines <75 characters
"RTN","GMRCSLM4",87,0)
 . I $G(^GMR(123,+GMRCO,40,+GMRCDA,1,LN,0))["EDITED FIELDS" D BLDCMT Q
"RTN","GMRCSLM4",88,0)
 . D BLDCMT
"RTN","GMRCSLM4",89,0)
 . Q
"RTN","GMRCSLM4",90,0)
 . I $L($G(^GMR(123,+GMRCO,40,+GMRCDA,1,LN,0)))'>75 D BLDCMT Q
"RTN","GMRCSLM4",91,0)
 . ;Use utilities for long line formating
"RTN","GMRCSLM4",92,0)
 . S FLG=1,LINE="     "
"RTN","GMRCSLM4",93,0)
 . D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDA,1)","^TMP(""GMRCR"",$J,""DT"")",LINE,.GMRCCT,TAB,FLG)
"RTN","GMRCSLM4",94,0)
 . D BLDASH
"RTN","GMRCSLM4",95,0)
 . Q
"RTN","GMRCSLM4",96,0)
 Q
"RTN","GMRCSLM4",97,0)
 ;
"RTN","GMRCSLM4",98,0)
BLDCMT ;Build comment lines
"RTN","GMRCSLM4",99,0)
 ;DASH is 1 or "" for print dash line after comment
"RTN","GMRCSLM4",100,0)
 S LN=0
"RTN","GMRCSLM4",101,0)
 F  S LN=$O(^GMR(123,+GMRCO,40,+GMRCDA,1,LN)) Q:'+LN  D
"RTN","GMRCSLM4",102,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^GMR(123,+GMRCO,40,GMRCDA,1,LN,0) ;$P(^GMR(123,+GMRCO,40,GMRCDA,1,LN,0),"^",1)
"RTN","GMRCSLM4",103,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",104,0)
 . Q
"RTN","GMRCSLM4",105,0)
 ;D BLDASH
"RTN","GMRCSLM4",106,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",107,0)
 Q
"RTN","GMRCSLM4",108,0)
 ;
"RTN","GMRCSLM4",109,0)
BLDASH ;Build separater line with dashes
"RTN","GMRCSLM4",110,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",111,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",112,0)
 Q
"RTN","GMRCTIU")
0^31^B12727015
"RTN","GMRCTIU",1,0)
GMRCTIU ;SLC/DCM - TIU utilities for exchanging info with Consults ;9/8/98  04:35
"RTN","GMRCTIU",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12**;DEC 27, 1997
"RTN","GMRCTIU",3,0)
GET(GMRCO,GMRCTUFN,GMRCTUST,GMRCAUTH) ;Receive the IEN of TIU file for a patient from TIU; also recieve TIU status update.
"RTN","GMRCTIU",4,0)
 ;GMRCO=IFN from file 123
"RTN","GMRCTIU",5,0)
 ;GMRCTUFN=TIU IFN
"RTN","GMRCTIU",6,0)
 ;GMRCTUST=TIU status of report
"RTN","GMRCTIU",7,0)
 ;GMRCAUTH=Author of Document
"RTN","GMRCTIU",8,0)
 N GMRCA,GMRCSTS,GMRCDFN,GMRCAD
"RTN","GMRCTIU",9,0)
 S GMRCA=$S($G(GMRCTUST)["INCOMPLETE":9,1:10),GMRCSTS=$S(GMRCA=10:2,1:9)
"RTN","GMRCTIU",10,0)
 I '+$G(GMRCA) S GMRCA=99,GMRCSTS=99
"RTN","GMRCTIU",11,0)
 D:+$G(GMRCA) STATUS^GMRCTIU1
"RTN","GMRCTIU",12,0)
 K GMRCOM,GMRCND,GMRCORNP,GMRCORTX,GMRCSA,GMRCSTS
"RTN","GMRCTIU",13,0)
 Q
"RTN","GMRCTIU",14,0)
 ;
"RTN","GMRCTIU",15,0)
DSPLAY(GMRCTUFN,LINECT) ;Get TIU results narrative and get it ready for display
"RTN","GMRCTIU",16,0)
 ;GMRCTUFN=TIU IEN of results record     LINECT=line count for list manager
"RTN","GMRCTIU",17,0)
 ;K VALMAR
"RTN","GMRCTIU",18,0)
 N ND,GMRCARR
"RTN","GMRCTIU",19,0)
 D RPC^TIUSRV(.GMRCARR,GMRCTUFN)
"RTN","GMRCTIU",20,0)
 S ND=0
"RTN","GMRCTIU",21,0)
 F  S ND=$O(@GMRCARR@(ND)) Q:ND=""  S ^TMP("GMRCR",$J,"DT",LINECT,0)=@GMRCARR@(ND,0),LINECT=LINECT+1
"RTN","GMRCTIU",22,0)
 ;D CLEAN^VALM10
"RTN","GMRCTIU",23,0)
 K @GMRCARR,RESFL,GMRCTIUY
"RTN","GMRCTIU",24,0)
 S:LINECT>1 LINECT=LINECT-1
"RTN","GMRCTIU",25,0)
 Q
"RTN","GMRCTIU",26,0)
ENTER(GMRCO) ; Complete a consult with TIU note
"RTN","GMRCTIU",27,0)
 N XQADATA,XQA,XQAID,XQAROU,XQFLG,XQAKILL
"RTN","GMRCTIU",28,0)
 D ENTER^GMRCTIUE(GMRCO)
"RTN","GMRCTIU",29,0)
 Q
"RTN","GMRCTIU",30,0)
 ;
"RTN","GMRCTIU",31,0)
ADDEND(GMRCO) ; Make an addendum to a consult result
"RTN","GMRCTIU",32,0)
 N XQADATA,XQA,XQAID,XQAROU,XQFLG,XQAKILL
"RTN","GMRCTIU",33,0)
 D ADDEND^GMRCTIUE(GMRCO)
"RTN","GMRCTIU",34,0)
 Q
"RTN","GMRCTIU",35,0)
 ;
"RTN","GMRCTIU",36,0)
SEND(DFN,OVRRIDE) ;Get the patients consult list and return in ^TMP for TIU
"RTN","GMRCTIU",37,0)
 ;DFN=Patient's Internal file number from file 2
"RTN","GMRCTIU",38,0)
 ;OVRRIDE=BOOLEAN flag to override user validation
"RTN","GMRCTIU",39,0)
 N GMRCI,TAB
"RTN","GMRCTIU",40,0)
 Q:DFN=""!(DFN<1)
"RTN","GMRCTIU",41,0)
 S TAB="",$P(TAB," ",30)=""
"RTN","GMRCTIU",42,0)
 K ^TMP("GMRCR",$J,"TIU")
"RTN","GMRCTIU",43,0)
 D GETCONSL(DFN,2,$G(OVRRIDE)) ;2=returns TIU format in ^TMP array
"RTN","GMRCTIU",44,0)
 Q
"RTN","GMRCTIU",45,0)
 ;
"RTN","GMRCTIU",46,0)
RPCLIST(GMRCY,DFN) ;Get the patients consult list and return in GMRCY for GUI
"RTN","GMRCTIU",47,0)
 N GMRCI
"RTN","GMRCTIU",48,0)
 I '+$G(DFN) S GMRCY(0)=0
"RTN","GMRCTIU",49,0)
 D GETCONSL(DFN,1) ;1=returns GUI format in GMRCY array
"RTN","GMRCTIU",50,0)
 ; The consults will be returned from GETCONSL in the GMRCY array.
"RTN","GMRCTIU",51,0)
 S GMRCY(0)=+$G(GMRCI)
"RTN","GMRCTIU",52,0)
 Q
"RTN","GMRCTIU",53,0)
GETCONSL(DFN,ORIGIN,OVRRIDE) ;Get the patients consults
"RTN","GMRCTIU",54,0)
 ;ORIGIN is whether the the request is for GUI=1 or LM=2.
"RTN","GMRCTIU",55,0)
 ;The logic loops through the "F" cross-reference to find consults
"RTN","GMRCTIU",56,0)
 ;The output will be formated in GMRCY for the GUI if ORIGIN is 1.
"RTN","GMRCTIU",57,0)
 ;The output will be formated in ^TMP("GMRCR",$J,"TIU" if ORIGIN is 2.
"RTN","GMRCTIU",58,0)
 ;
"RTN","GMRCTIU",59,0)
 N GMRCQIT,GMRC,GMRCDT,GMRCEDT,GMRCYR,GMRCSP,GMRCST,GMRCSTS
"RTN","GMRCTIU",60,0)
 N GMRCTIU,GMRCTIUC,GMRCSS,GMRCSVC,GMRCPROC,GMRCNOTE,Y,GMRCDAT
"RTN","GMRCTIU",61,0)
 S GMRCYR=9999999-$$FMADD^XLFDT(DT,-365),GMRCDAT=0
"RTN","GMRCTIU",62,0)
 F  S GMRCDAT=$O(^GMR(123,"AD",DFN,GMRCDAT)) Q:'GMRCDAT  D
"RTN","GMRCTIU",63,0)
 . Q:GMRCDAT>GMRCYR
"RTN","GMRCTIU",64,0)
 . N GMRCDA S GMRCDA=0
"RTN","GMRCTIU",65,0)
 . F  S GMRCDA=$O(^GMR(123,"AD",DFN,GMRCDAT,GMRCDA)) Q:'GMRCDA  D
"RTN","GMRCTIU",66,0)
 .. S GMRC(0)=$G(^GMR(123,GMRCDA,0))
"RTN","GMRCTIU",67,0)
 .. S GMRCST=$P(GMRC(0),U,12)
"RTN","GMRCTIU",68,0)
 .. I "25689"'[GMRCST Q  ;only return statuses c,p,a,s,pr
"RTN","GMRCTIU",69,0)
 .. S GMRCDT=+GMRC(0)
"RTN","GMRCTIU",70,0)
 .. S GMRCSS=$P(GMRC(0),U,5)
"RTN","GMRCTIU",71,0)
 .. I '+$G(OVRRIDE) Q:'$$VALID^GMRCAU(GMRCSS,GMRCDA) 
"RTN","GMRCTIU",72,0)
 .. S GMRCTIUC=0
"RTN","GMRCTIU",73,0)
 .. D GETLIST^GMRCTIUL(GMRCDA,0,1,.GMRCTIUC)
"RTN","GMRCTIU",74,0)
 .. I ORIGIN=1 D BLDGMRCY Q
"RTN","GMRCTIU",75,0)
 .. I ORIGIN=2 D BLDTMP Q
"RTN","GMRCTIU",76,0)
 .. Q
"RTN","GMRCTIU",77,0)
 . Q
"RTN","GMRCTIU",78,0)
 Q
"RTN","GMRCTIU",79,0)
 ;
"RTN","GMRCTIU",80,0)
BLDGMRCY ;Build the GMRCY array of existing consults
"RTN","GMRCTIU",81,0)
 S GMRCSTS=$P($G(^ORD(100.01,+GMRCST,0)),"^",1)
"RTN","GMRCTIU",82,0)
 S GMRCSS=$P(GMRC(0),U,5),GMRCSVC=$P($G(^GMR(123.5,GMRCSS,0)),U)
"RTN","GMRCTIU",83,0)
 S GMRCPROC=$P($G(^ORD(101,+$P(GMRC(0),U,8),0)),U,2)
"RTN","GMRCTIU",84,0)
 S GMRCI=+$G(GMRCI)+1
"RTN","GMRCTIU",85,0)
 S GMRCY(GMRCI)=GMRCDA_U_GMRCDT_U_GMRCSVC_U_GMRCPROC_U_GMRCSTS_U_+GMRCTIUC(0)
"RTN","GMRCTIU",86,0)
 Q
"RTN","GMRCTIU",87,0)
BLDTMP ;Build TMP global for TIU
"RTN","GMRCTIU",88,0)
 S GMRCSTS=$G(^ORD(100.01,+GMRCST,.1))
"RTN","GMRCTIU",89,0)
 S GMRCSP=$$ORTX^GMRCAU(GMRCDA)
"RTN","GMRCTIU",90,0)
 S GMRCNOTE=$S(GMRCTIUC(0)=1:" note",1:" notes")
"RTN","GMRCTIU",91,0)
 S GMRCEDT=$$FMTE^XLFDT(GMRCDT,"D")
"RTN","GMRCTIU",92,0)
 S GMRCI=+$G(GMRCI)+1
"RTN","GMRCTIU",93,0)
 S ^TMP("GMRCR",$J,"TIU",GMRCI,0)=$J(GMRCI,3)_"> "_$E(GMRCEDT_TAB,1,12)_" C#"_$E(GMRCDA_TAB,1,9)_$E(GMRCSP_TAB,1,21)_$E(GMRCSTS_TAB,1,4)_$E(+GMRCTIUC(0)_GMRCNOTE_TAB,1,10)
"RTN","GMRCTIU",94,0)
 S ^TMP("GMRCR",$J,"TIU","B",GMRCI,GMRCDA)=""
"RTN","GMRCTIU",95,0)
 Q
"RTN","GMRCTIUE")
0^29^B32556151
"RTN","GMRCTIUE",1,0)
GMRCTIUE ;SLC/DCM,DLT - Complete/Update TIU notes ;7/16/98  02:10
"RTN","GMRCTIUE",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,10,14,12**;DEC 27, 1997
"RTN","GMRCTIUE",3,0)
ENTER(GMRCO) ; Enter a note in TIU for the consult result
"RTN","GMRCTIUE",4,0)
 ;If consult from list is defined in GMRCO, than use it.
"RTN","GMRCTIUE",5,0)
 K GMRCQUT N TIUDA,TIUCLASS,GMRCLCK
"RTN","GMRCTIUE",6,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO)
"RTN","GMRCTIUE",7,0)
 Q:$D(GMRCQUT)!'$L($G(GMRCO))
"RTN","GMRCTIUE",8,0)
 I '$$LOCK^GMRCA1(GMRCO) D EDEX Q
"RTN","GMRCTIUE",9,0)
 S GMRCLCK=1
"RTN","GMRCTIUE",10,0)
 D CHKSTS I $G(GMRCQUT) D EDEX Q
"RTN","GMRCTIUE",11,0)
 I $D(VALM) D FULL^VALM1
"RTN","GMRCTIUE",12,0)
 ;
"RTN","GMRCTIUE",13,0)
 ;If service administrative user, then use administrative complete logic
"RTN","GMRCTIUE",14,0)
 I $$VALID^GMRCAU($P(^GMR(123,GMRCO,0),U,5))=3 D  Q
"RTN","GMRCTIUE",15,0)
 . D COMP^GMRCAAC(+GMRCO)
"RTN","GMRCTIUE",16,0)
 . D EDEX
"RTN","GMRCTIUE",17,0)
 ;
"RTN","GMRCTIUE",18,0)
 ;Assume the user is a clinical user
"RTN","GMRCTIUE",19,0)
 ;Get list of notes If no new notes, add new then quit
"RTN","GMRCTIUE",20,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCTIUE",21,0)
 I '$$GETLIST(GMRCDFN,GMRCO,.GMRCTIUC) D NEW,EDEX Q
"RTN","GMRCTIUE",22,0)
 ;
"RTN","GMRCTIUE",23,0)
 ;If single TIU doc. exists, use single record edit/add new, and quit
"RTN","GMRCTIUE",24,0)
 S GMRCVF="TIU(8925,"
"RTN","GMRCTIUE",25,0)
 I GMRCTIUC(GMRCVF)=1 D  Q
"RTN","GMRCTIUE",26,0)
 . N DIR,X,Y,DTOUT,DUOUT
"RTN","GMRCTIUE",27,0)
 . D SHOWTIU^GMRCTIUL
"RTN","GMRCTIUE",28,0)
 . S DIR(0)="YA",DIR("B")="Yes",DIR("A")="Edit/Review this note? "
"RTN","GMRCTIUE",29,0)
 . D ^DIR I Y>0 D
"RTN","GMRCTIUE",30,0)
 .. S GMRCTUFN=$$SINGLE(GMRCVF)
"RTN","GMRCTIUE",31,0)
 .. I +GMRCTUFN D EDITNOTE(GMRCTUFN)
"RTN","GMRCTIUE",32,0)
 . S DIR(0)="YA"
"RTN","GMRCTIUE",33,0)
 . S DIR("B")="No",DIR("A")="Would you like to enter a new note? "
"RTN","GMRCTIUE",34,0)
 . W ! D ^DIR I Y>0 D NEW
"RTN","GMRCTIUE",35,0)
 . D EDEX
"RTN","GMRCTIUE",36,0)
 . Q
"RTN","GMRCTIUE",37,0)
 ;
"RTN","GMRCTIUE",38,0)
 ;Show the list of multiple tiu results for selection
"RTN","GMRCTIUE",39,0)
 D SHOWTIU^GMRCTIUL
"RTN","GMRCTIUE",40,0)
 ;
"RTN","GMRCTIUE",41,0)
 ;Select a note from the list and then get the TIU internal entry
"RTN","GMRCTIUE",42,0)
 S GMRCSELR=$$SELR^GMRCTIUL(.GMRCTIUC)
"RTN","GMRCTIUE",43,0)
 I $D(GMRCQUT) D EDEX Q
"RTN","GMRCTIUE",44,0)
 I '+(GMRCSELR) D  D EDEX Q
"RTN","GMRCTIUE",45,0)
 . ;didn't select existing note, allow a new entry
"RTN","GMRCTIUE",46,0)
 . N DIR,X,Y
"RTN","GMRCTIUE",47,0)
 . S DIR(0)="Y",DIR("A")="Would you like to enter a new note"
"RTN","GMRCTIUE",48,0)
 . S DIR("B")="N" D ^DIR
"RTN","GMRCTIUE",49,0)
 . I Y<1 K DTOUT,DUOUT,X,Y Q
"RTN","GMRCTIUE",50,0)
 . D NEW
"RTN","GMRCTIUE",51,0)
 S GMRCTUFN=$$GETTUFN(GMRCSELR)
"RTN","GMRCTIUE",52,0)
 ;
"RTN","GMRCTIUE",53,0)
 I +GMRCTUFN D EDITNOTE(GMRCTUFN)
"RTN","GMRCTIUE",54,0)
 ;
"RTN","GMRCTIUE",55,0)
 D EDEX
"RTN","GMRCTIUE",56,0)
 Q
"RTN","GMRCTIUE",57,0)
 ;
"RTN","GMRCTIUE",58,0)
SAUSER() ; admin user?
"RTN","GMRCTIUE",59,0)
 N GMRCSS,GMRCADUS
"RTN","GMRCTIUE",60,0)
 S GMRCSS=+$P($G(^GMR(123,+GMRCO,0)),"^",5) Q:'+GMRCSS 0
"RTN","GMRCTIUE",61,0)
 I $D(^GMR(123.5,+$P($G(^GMR(123,+GMRCO,0)),"^",5),123.33,"B",DUZ)) Q 1
"RTN","GMRCTIUE",62,0)
 I '$L($TEXT(VALIDU^GMRCAU)) Q 0
"RTN","GMRCTIUE",63,0)
 S GMRCADUS=0
"RTN","GMRCTIUE",64,0)
 I $L($TEXT(VALIDU^GMRCAU)) D TEAM^GMRCAU(.GMRCADUS,123.34,DUZ)
"RTN","GMRCTIUE",65,0)
 Q +GMRCADUS
"RTN","GMRCTIUE",66,0)
 ;
"RTN","GMRCTIUE",67,0)
CHKSTS ;Check the order status before allowing entry of a note
"RTN","GMRCTIUE",68,0)
 N STATUS S STATUS=$P($G(^GMR(123,+GMRCO,0)),"^",12)
"RTN","GMRCTIUE",69,0)
 I $S(STATUS=1:1,STATUS=13:1,1:0) D
"RTN","GMRCTIUE",70,0)
 . W !,"This order has been "
"RTN","GMRCTIUE",71,0)
 . W $S(STATUS=1:"DISCONTINUED",1:"CANCELLED")
"RTN","GMRCTIUE",72,0)
 . W ".  A note cannot be entered."
"RTN","GMRCTIUE",73,0)
 . D PAUSE S GMRCQUT=1
"RTN","GMRCTIUE",74,0)
 Q
"RTN","GMRCTIUE",75,0)
 ;
"RTN","GMRCTIUE",76,0)
EDITNOTE(GMRCTUFN) ;use TIU LM for an existing note
"RTN","GMRCTIUE",77,0)
 I +$D(^TIU(8925,+GMRCTUFN,0)) D  Q
"RTN","GMRCTIUE",78,0)
 . D EXSTNOTE^TIUBR1(+GMRCDFN,+GMRCTUFN)
"RTN","GMRCTIUE",79,0)
 ;
"RTN","GMRCTIUE",80,0)
 ; link is missing
"RTN","GMRCTIUE",81,0)
 W !,"A note #"_+GMRCTUFN_" is linked to the consult,"
"RTN","GMRCTIUE",82,0)
 W !,"  but the note is no longer in TIU!"
"RTN","GMRCTIUE",83,0)
 D PAUSE
"RTN","GMRCTIUE",84,0)
 Q
"RTN","GMRCTIUE",85,0)
 ;
"RTN","GMRCTIUE",86,0)
SINGLE(GMRCVF) ;Get the single result entry from the list for the file type
"RTN","GMRCTIUE",87,0)
 N RSLT,GMRCVP
"RTN","GMRCTIUE",88,0)
 S RSLT="",GMRCVP=0
"RTN","GMRCTIUE",89,0)
 F  S RSLT=$O(^TMP("GMRC50",$J,RSLT)) Q:RSLT=""  D  Q:+GMRCVP
"RTN","GMRCTIUE",90,0)
 . I $P(RSLT,";",2)=GMRCVF S GMRCVP=RSLT
"RTN","GMRCTIUE",91,0)
 Q +GMRCVP
"RTN","GMRCTIUE",92,0)
 ;
"RTN","GMRCTIUE",93,0)
GETTUFN(GMRCSELR) ;Get the result entry from the selected entry
"RTN","GMRCTIUE",94,0)
 N RSLT
"RTN","GMRCTIUE",95,0)
 S RSLT=$O(^TMP("GMRC50R",$J,GMRCSELR,""))
"RTN","GMRCTIUE",96,0)
 Q RSLT
"RTN","GMRCTIUE",97,0)
 ;
"RTN","GMRCTIUE",98,0)
NEW ;Enter a new result through TIU if implemented or old Completion logic
"RTN","GMRCTIUE",99,0)
 S TIUCLASS=+$$CLASS
"RTN","GMRCTIUE",100,0)
 I TIUCLASS'>0 D  Q
"RTN","GMRCTIUE",101,0)
 . W !!,$C(7),"Consult Resulting through TIU is not yet implemented."
"RTN","GMRCTIUE",102,0)
 . W !,"Proceeding with Administrative Complete."
"RTN","GMRCTIUE",103,0)
 . D COMP^GMRCAAC(+GMRCO)
"RTN","GMRCTIUE",104,0)
 ;
"RTN","GMRCTIUE",105,0)
 D MAIN^TIUEDIT(TIUCLASS,.GMRCTIDA,GMRCDFN,"","","","",1)
"RTN","GMRCTIUE",106,0)
 ;
"RTN","GMRCTIUE",107,0)
 ;If TIU returns TIUDA, than update file 123
"RTN","GMRCTIUE",108,0)
 ;I +$G(TIUDA),$D(^TIU(8925,+$G(TIUDA),0)) D ADD^GMRCTIUA(+TIUDA,GMRCO)
"RTN","GMRCTIUE",109,0)
 Q
"RTN","GMRCTIUE",110,0)
 ;
"RTN","GMRCTIUE",111,0)
CLASS() ; What is the TIU Class (or Document Class) for CONSULTS
"RTN","GMRCTIUE",112,0)
 N GMRCY
"RTN","GMRCTIUE",113,0)
 S GMRCY=+$O(^TIU(8925.1,"B","CONSULTS",0))
"RTN","GMRCTIUE",114,0)
 I +GMRCY>0,$S($P($G(^TIU(8925.1,+GMRCY,0)),U,4)="CL":0,$P($G(^(0)),U,4)="DC":0,1:1) S GMRCY=0
"RTN","GMRCTIUE",115,0)
 Q GMRCY
"RTN","GMRCTIUE",116,0)
 ;
"RTN","GMRCTIUE",117,0)
GETLIST(GMRCDFN,GMRCO,GMRCLIST) ;
"RTN","GMRCTIUE",118,0)
 ;
"RTN","GMRCTIUE",119,0)
 N GMRCVF
"RTN","GMRCTIUE",120,0)
 ;
"RTN","GMRCTIUE",121,0)
 D GETLIST^GMRCTIUL(GMRCO,2,1,.GMRCTIUC)
"RTN","GMRCTIUE",122,0)
 S GMRCVF="TIU(8925,"
"RTN","GMRCTIUE",123,0)
 Q +$G(GMRCTIUC(GMRCVF))
"RTN","GMRCTIUE",124,0)
 ;
"RTN","GMRCTIUE",125,0)
ADDEND(GMRCO) ; Make an addendum action for a selected consult
"RTN","GMRCTIUE",126,0)
 N TIUDA,GMRCTX,GMRCDFN,GMRCADUZ,RSLTINFO,GMRCACT,GMRCTIUC,GMRCLCK
"RTN","GMRCTIUE",127,0)
 K GMRCQUT
"RTN","GMRCTIUE",128,0)
 I '$L($G(GMRCO)) D SELECT^GMRCA2(.GMRCO)
"RTN","GMRCTIUE",129,0)
 Q:$D(GMRCQUT)!'+($G(GMRCO))
"RTN","GMRCTIUE",130,0)
 ;
"RTN","GMRCTIUE",131,0)
 ;If service administrative user, then QUIT.
"RTN","GMRCTIUE",132,0)
 I $$VALID^GMRCAU($P(^GMR(123,+GMRCO,0),U,5))=3 D  Q
"RTN","GMRCTIUE",133,0)
 . D EXAC^GMRCADC("You do not have the ability to edit this note.")
"RTN","GMRCTIUE",134,0)
 ;
"RTN","GMRCTIUE",135,0)
 ;Assume the user is a clinical user
"RTN","GMRCTIUE",136,0)
 ;
"RTN","GMRCTIUE",137,0)
 ;Get list of notes for this consult. if no notes, then quit.
"RTN","GMRCTIUE",138,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCTIUE",139,0)
 I '$$GETLIST(GMRCDFN,+GMRCO,.GMRCTIUC) D  Q
"RTN","GMRCTIUE",140,0)
 . W !,"This consult does not yet have an associated note."
"RTN","GMRCTIUE",141,0)
 . W !,"  Use the Complete action to enter a new note."
"RTN","GMRCTIUE",142,0)
 . D PAUSE,EDEX
"RTN","GMRCTIUE",143,0)
 ;
"RTN","GMRCTIUE",144,0)
 I '$$LOCK^GMRCA1(GMRCO) D EDEX Q
"RTN","GMRCTIUE",145,0)
 S GMRCLCK=1
"RTN","GMRCTIUE",146,0)
 ;If TIU Document already exists, use single record edit, and quit
"RTN","GMRCTIUE",147,0)
 S GMRCVF="TIU(8925,"
"RTN","GMRCTIUE",148,0)
 I GMRCTIUC(GMRCVF)=1 D  D EDEX Q
"RTN","GMRCTIUE",149,0)
 . S GMRCTUFN=$$SINGLE(GMRCVF)
"RTN","GMRCTIUE",150,0)
 . Q:'+GMRCTUFN
"RTN","GMRCTIUE",151,0)
 . D SHOWTIU^GMRCTIUL
"RTN","GMRCTIUE",152,0)
 . N GMRCVP,RSLTINFO,AUTHOR
"RTN","GMRCTIUE",153,0)
 . S GMRCVP=+GMRCTUFN_";"_GMRCVF
"RTN","GMRCTIUE",154,0)
 . S RSLTIEN=$O(^TMP("GMRC50",$J,GMRCVP,0))
"RTN","GMRCTIUE",155,0)
 . S RSLTINFO=$G(^TMP("GMRC50",$J,GMRCVP,RSLTIEN))
"RTN","GMRCTIUE",156,0)
 . I $P(RSLTINFO,"^",6)="completed" D ADDEND1(+GMRCTUFN) Q
"RTN","GMRCTIUE",157,0)
 . I (DUZ=+$P(RSLTINFO,"^",4)) D EDITNOTE(+GMRCTUFN) Q
"RTN","GMRCTIUE",158,0)
 . W !,"You may not addend to the incomplete associated note."
"RTN","GMRCTIUE",159,0)
 . W !,"You are not the author of the existing note."
"RTN","GMRCTIUE",160,0)
 . I $$READ^GMRCACMT("Y","Do you want to add a new note ","YES") D NEW
"RTN","GMRCTIUE",161,0)
 . Q
"RTN","GMRCTIUE",162,0)
 ;
"RTN","GMRCTIUE",163,0)
 ;Show the list of multiple tiu results for selection
"RTN","GMRCTIUE",164,0)
 D SHOWTIU^GMRCTIUL
"RTN","GMRCTIUE",165,0)
 ;
"RTN","GMRCTIUE",166,0)
 ;Select a note from the list and then get the TIU internal entry
"RTN","GMRCTIUE",167,0)
 S GMRCSELR=$$SELR^GMRCTIUL(.GMRCTIUC)
"RTN","GMRCTIUE",168,0)
 I $D(GMRCQUT)!'+(GMRCSELR) D EDEX Q
"RTN","GMRCTIUE",169,0)
 S GMRCTUFN=$$GETTUFN(GMRCSELR)
"RTN","GMRCTIUE",170,0)
 ;
"RTN","GMRCTIUE",171,0)
 I +GMRCTUFN D ADDEND1(+GMRCTUFN),EDEX Q
"RTN","GMRCTIUE",172,0)
 ;
"RTN","GMRCTIUE",173,0)
 D EDEX
"RTN","GMRCTIUE",174,0)
 Q
"RTN","GMRCTIUE",175,0)
ADDEND1(TIUDA) ;Add an addendum
"RTN","GMRCTIUE",176,0)
 ;
"RTN","GMRCTIUE",177,0)
 D FULL^VALM1,ADDEND1^TIURA1
"RTN","GMRCTIUE",178,0)
 Q
"RTN","GMRCTIUE",179,0)
 ;
"RTN","GMRCTIUE",180,0)
EDEX ;
"RTN","GMRCTIUE",181,0)
 I $G(GMRCLCK) D UNLOCK^GMRCA1(GMRCO)
"RTN","GMRCTIUE",182,0)
 K GMRCDFN,GMRCO,GMRCQUT,GMRCTUFN,GMRCSEL
"RTN","GMRCTIUE",183,0)
 Q
"RTN","GMRCTIUE",184,0)
 ;
"RTN","GMRCTIUE",185,0)
PAUSE ; Pause for user
"RTN","GMRCTIUE",186,0)
 ;
"RTN","GMRCTIUE",187,0)
 N X W !,"Press <RETURN> to continue: " R X:DTIME E  W " (timeout)"
"RTN","GMRCTIUE",188,0)
 Q
"RTN","GMRCTIUE",189,0)
 ;
"RTN","GMRCUTL1")
0^6^B8649023
"RTN","GMRCUTL1",1,0)
GMRCUTL1 ;SLC/DCM,JFR - General Utilities ;7/08/98  14:31
"RTN","GMRCUTL1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12**;DEC 27, 1997
"RTN","GMRCUTL1",3,0)
ACTM ;;Set correct variables to complete, discontinue, etc. a consult
"RTN","GMRCUTL1",4,0)
 K GMRCQUT
"RTN","GMRCUTL1",5,0)
 S:'+$G(GMRCA) GMRCA=$O(^GMR(123.1,"B",GMRCACTM,""))
"RTN","GMRCUTL1",6,0)
 S GMRCACTM=$P($G(^GMR(123.1,+GMRCA,0)),"^")
"RTN","GMRCUTL1",7,0)
 S ORSTS=$S(GMRCA:$P(^GMR(123.1,GMRCA,0),"^",2),1:0)
"RTN","GMRCUTL1",8,0)
 I 'GMRCA S GMRCQUT=1
"RTN","GMRCUTL1",9,0)
 Q
"RTN","GMRCUTL1",10,0)
PRNT(SRVCIFN,GMRCO) ;print form 513 to a printer when new consult is entered
"RTN","GMRCUTL1",11,0)
 N ORVP,GMRCDEV,GMRCQUED
"RTN","GMRCUTL1",12,0)
 I '$G(SRVCIFN) S SRVCIFN=+$P(^GMR(123,GMRCO,0),U,5)
"RTN","GMRCUTL1",13,0)
 Q:'$D(^GMR(123.5,SRVCIFN,123))  Q:'$P(^GMR(123.5,SRVCIFN,123),"^",9)
"RTN","GMRCUTL1",14,0)
 S IOP="`"_$P(^GMR(123.5,SRVCIFN,123),"^",9)
"RTN","GMRCUTL1",15,0)
 S %ZIS="N" D ^%ZIS I POP D HOME^%ZIS Q
"RTN","GMRCUTL1",16,0)
 S GMRCDEV=ION,GMRCQUED=1
"RTN","GMRCUTL1",17,0)
 S ZTRTN="PRNT^GMRCP5A("_(+GMRCO)_","_(+$G(TIUFLG))_",1,"""_$G(GMRCCPY,"W")_""",0)"
"RTN","GMRCUTL1",18,0)
 S ZTDESC="CONSULT/REQUEST PACKAGE PRINT FORM 513 FOR NEW CONSULT"
"RTN","GMRCUTL1",19,0)
 S ZTIO=GMRCDEV,ZTDTH=$H
"RTN","GMRCUTL1",20,0)
 D ^%ZTLOAD
"RTN","GMRCUTL1",21,0)
 D PRNTAUDT
"RTN","GMRCUTL1",22,0)
 D HOME^%ZIS
"RTN","GMRCUTL1",23,0)
 K GMRCQUED,GMRCDEV1
"RTN","GMRCUTL1",24,0)
 Q
"RTN","GMRCUTL1",25,0)
PRNTAUDT ;Update the last activity field in 123 and Processing Activity multiple
"RTN","GMRCUTL1",26,0)
 ;Printed To activity updates last activity taken for consult
"RTN","GMRCUTL1",27,0)
 N GMRCOM,GMRCORNP,GMRCFF,GMRCPA,GMRCAD,GMRCA
"RTN","GMRCUTL1",28,0)
 S GMRCA=22
"RTN","GMRCUTL1",29,0)
 S DIE="^GMR(123,",DA=+GMRCO,DR="9////^S X=GMRCA"
"RTN","GMRCUTL1",30,0)
 L +^GMR(123,GMRCO):5
"RTN","GMRCUTL1",31,0)
 D ^DIE
"RTN","GMRCUTL1",32,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCUTL1",33,0)
 ;Update activity other than HL7 original msg received
"RTN","GMRCUTL1",34,0)
 D AUDIT^GMRCP
"RTN","GMRCUTL1",35,0)
 Q
"RTN","GMRCUTL1",36,0)
END K GMRCDEV,GMRCDEV1,GMRCOREC,GMRCFMT
"RTN","GMRCUTL1",37,0)
 Q
"RTN","GMRCUTL1",38,0)
PROVDX(SERV) ;return PROV DX prompting info from 123.5
"RTN","GMRCUTL1",39,0)
 ;    Input:
"RTN","GMRCUTL1",40,0)
 ;       SERV = IEN from REQUEST SERVICES (#123.5) file
"RTN","GMRCUTL1",41,0)
 ;
"RTN","GMRCUTL1",42,0)
 ;    Returns:  string  A^B
"RTN","GMRCUTL1",43,0)
 ;       A = O (optional), R (required) or S (suppress)
"RTN","GMRCUTL1",44,0)
 ;       B = F (free-text) or L (lexicon)
"RTN","GMRCUTL1",45,0)
 ;
"RTN","GMRCUTL1",46,0)
 Q:'+$G(SERV) "^"
"RTN","GMRCUTL1",47,0)
 Q:'$D(^GMR(123.5,+SERV)) "^"
"RTN","GMRCUTL1",48,0)
 N STRING,NODE1
"RTN","GMRCUTL1",49,0)
 S NODE1=$G(^GMR(123.5,SERV,1)) I NODE1="" Q "O^F"
"RTN","GMRCUTL1",50,0)
 S $P(STRING,U)=$S($L($P(NODE1,U)):$P(NODE1,U),1:"O")
"RTN","GMRCUTL1",51,0)
 S $P(STRING,U,2)=$S($L($P(NODE1,U,2)):$P(NODE1,U,2),1:"F")
"RTN","GMRCUTL1",52,0)
 Q STRING
"RTN","GMRCUTL1",53,0)
ORIFN(GMRC123) ;return ORIFN associated with give record in ^GMR(123,
"RTN","GMRCUTL1",54,0)
 ; GMRC123 = ien of consult record in file 123
"RTN","GMRCUTL1",55,0)
 Q $P($G(^GMR(123,GMRC123,0)),U,3)
"RTN","GMRCUTL1",56,0)
GETDT(PROMPT,DEFAULT) ;prompt and return FM date
"RTN","GMRCUTL1",57,0)
 ;Input:
"RTN","GMRCUTL1",58,0)
 ;  PROMPT  = text of prompt - DIR("A")          (optional)
"RTN","GMRCUTL1",59,0)
 ;  DEFAULT = default date to prompt - DIR("B")  (optional)
"RTN","GMRCUTL1",60,0)
 ; 
"RTN","GMRCUTL1",61,0)
 ;Output:
"RTN","GMRCUTL1",62,0)
 ; FM date/time if successfully answered, "^" if exit or timeout
"RTN","GMRCUTL1",63,0)
 N DIR,DIRUT,DIROUT,DTOUT,DUOUT,X,Y
"RTN","GMRCUTL1",64,0)
 S DIR(0)="DA^::EPT"
"RTN","GMRCUTL1",65,0)
 S DIR("?")="Enter the date/time the activity took place."
"RTN","GMRCUTL1",66,0)
 S DIR("A")=$S($D(PROMPT):PROMPT_" ",1:"Actual Date/Time of Activity: ")
"RTN","GMRCUTL1",67,0)
 S DIR("B")=$S($D(DEFAULT):DEFAULT,1:"NOW")
"RTN","GMRCUTL1",68,0)
 D ^DIR
"RTN","GMRCUTL1",69,0)
 I $D(DUOUT)!($D(DTOUT)) S Y="^"
"RTN","GMRCUTL1",70,0)
 Q Y
"RTN","GMRCUTL1",71,0)
 ;
"RTN","GMRCUTL1",72,0)
DCPRNT(IEN,USER) ;reprint SF-513 on DC?
"RTN","GMRCUTL1",73,0)
 N SERV,REPR
"RTN","GMRCUTL1",74,0)
 S SERV=$P(^GMR(123,IEN,0),U,5) I 'SERV Q 0
"RTN","GMRCUTL1",75,0)
 S REPR=$P($G(^GMR(123.5,SERV,1)),U,5)
"RTN","GMRCUTL1",76,0)
 I 'REPR Q 1
"RTN","GMRCUTL1",77,0)
 I REPR=2 Q 0
"RTN","GMRCUTL1",78,0)
 I REPR=1,'$$VALID^GMRCAU(SERV,IEN,USER) Q 1
"RTN","GMRCUTL1",79,0)
 Q 0
"RTN","GMRCUTL1",80,0)
 ;
"RTN","GMRCUTL1",81,0)
PREREQ(GMRCARR,GMRCSRV,GMRCDFN,UNRESOLV) ; return service pre-requisite
"RTN","GMRCUTL1",82,0)
 ; pre-requisite stored in ^GMR(123.5,ien,125,...
"RTN","GMRCUTL1",83,0)
 ; GMRCARR = array to return containing pre-requisite
"RTN","GMRCUTL1",84,0)
 ; GMRCSRV = IEN from file 123.5
"RTN","GMRCUTL1",85,0)
 ; GMRCDFN = patient identifier if to return resolved
"RTN","GMRCUTL1",86,0)
 ; UNRESOLV = 1 or 0 ; if UNRESOLV=1 GMRCARR will be returned unresolved
"RTN","GMRCUTL1",87,0)
 Q:'+GMRCSRV
"RTN","GMRCUTL1",88,0)
 Q:'$D(^GMR(123.5,+GMRCSRV,125))
"RTN","GMRCUTL1",89,0)
 I '$D(GMRCDFN)!($G(UNRESOLV)) D  Q
"RTN","GMRCUTL1",90,0)
 . M @GMRCARR=^GMR(123.5,+GMRCSRV,125)
"RTN","GMRCUTL1",91,0)
 D BLRPLT^TIUSRVD(,,GMRCDFN,,$NA(^GMR(123.5,+GMRCSRV,125)))
"RTN","GMRCUTL1",92,0)
 I $D(^TMP("TIUBOIL",$J)) M @GMRCARR=^TMP("TIUBOIL",$J)
"RTN","GMRCUTL1",93,0)
 K ^TMP("TIUBOIL",$J)
"RTN","GMRCUTL1",94,0)
 Q
"UP",123.5,123.51,-1)
123.5^10
"UP",123.5,123.51,0)
123.51
"UP",123.5,123.5124,-1)
123.5^124
"UP",123.5,123.5124,0)
123.5124
"UP",123.5,123.5125,-1)
123.5^125
"UP",123.5,123.5125,0)
123.5125
"VER")
8.0^22.0
"^DD",123,123,30.1,0)
PROVISIONAL DIAGNOSIS CODE^F^^30.1;1^K:$L(X)>20!($L(X)<2) X
"^DD",123,123,30.1,3)
Answer must be 2-20 characters in length
"^DD",123,123,30.1,21,0)
^^2^2^2991201^
"^DD",123,123,30.1,21,1,0)
This field is used to store the coded portion of the Provisional Diagnosis
"^DD",123,123,30.1,21,2,0)
if an ICD-9 coded diagnosis is sent via CPRS. 
"^DD",123,123,30.1,"DT")
2990924
"^DD",123.1,123.1,0)
FIELD^^7^8
"^DD",123.1,123.1,0,"DDA")
N
"^DD",123.1,123.1,0,"DT")
2980701
"^DD",123.1,123.1,0,"IX","AC",123.1,1)

"^DD",123.1,123.1,0,"IX","B",123.1,.01)

"^DD",123.1,123.1,0,"IX","D",123.1,5)

"^DD",123.1,123.1,0,"NM","REQUEST ACTION TYPES")

"^DD",123.1,123.1,0,"PT",101,6)

"^DD",123.1,123.1,0,"PT",123,9)

"^DD",123.1,123.1,0,"PT",123.02,1)

"^DD",123.1,123.1,0,"VRPK")
GMRC
"^DD",123.1,123.1,.001,0)
NUMBER^NJ6,0^^ ^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",123.1,123.1,.001,3)
Enter a number between your sites prefix_000 and your sites prefix_999.
"^DD",123.1,123.1,.001,21,0)
^^1^1^2971205^
"^DD",123.1,123.1,.001,21,1,0)
The internal entry number of the Request Action Type.
"^DD",123.1,123.1,.001,"DT")
2971205
"^DD",123.1,123.1,.01,0)
ACTION TYPE^RFX^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>80!($L(X)<3)!'(X'?1P.E)!(X'?.ANP) X
"^DD",123.1,123.1,.01,1,0)
^.1^^-1
"^DD",123.1,123.1,.01,1,1,0)
123.1^B
"^DD",123.1,123.1,.01,1,1,1)
S ^GMR(123.1,"B",$E(X,1,30),DA)=""
"^DD",123.1,123.1,.01,1,1,2)
K ^GMR(123.1,"B",$E(X,1,30),DA)
"^DD",123.1,123.1,.01,3)
ENTER THE ACTION NAME. ANSWER MUST BE 3-80 CHARACTERS IN LENGTH
"^DD",123.1,123.1,.01,21,0)
^^6^6^2970911^^^^
"^DD",123.1,123.1,.01,21,1,0)
This file contains the tracking actions which may be taken to track
"^DD",123.1,123.1,.01,21,2,0)
a Consult or Request order from its entry in CPRS through its
"^DD",123.1,123.1,.01,21,3,0)
resolution.
"^DD",123.1,123.1,.01,21,4,0)
 
"^DD",123.1,123.1,.01,21,5,0)
This file also contains relationships of CPRS statuses which are the
"^DD",123.1,123.1,.01,21,6,0)
result of the action taken.
"^DD",123.1,123.1,.01,"DT")
2910529
"^DD",123.1,123.1,1,0)
RELATED OE/RR STATUS^P100.01'^ORD(100.01,^0;2^Q
"^DD",123.1,123.1,1,1,0)
^.1
"^DD",123.1,123.1,1,1,1,0)
123.1^AC
"^DD",123.1,123.1,1,1,1,1)
S ^GMR(123.1,"AC",$E(X,1,30),DA)=""
"^DD",123.1,123.1,1,1,1,2)
K ^GMR(123.1,"AC",$E(X,1,30),DA)
"^DD",123.1,123.1,1,1,1,"%D",0)
^^3^3^2920608^^^
"^DD",123.1,123.1,1,1,1,"%D",1,0)
This cross-reference is used when the call to RESULT^GMRCR returns an
"^DD",123.1,123.1,1,1,1,"%D",2,0)
OE/RR status.  This OE/RR status is used to determine the action type to
"^DD",123.1,123.1,1,1,1,"%D",3,0)
use to update activity tracking.
"^DD",123.1,123.1,1,1,1,"DT")
2910529
"^DD",123.1,123.1,1,3)
This is the CPRS Status used to update the order in CPRS.
"^DD",123.1,123.1,1,21,0)
^^2^2^2970911^^^^
"^DD",123.1,123.1,1,21,1,0)
This is the CPRS status which will be used to update the order in OE/RR
"^DD",123.1,123.1,1,21,2,0)
when this action is taken.
"^DD",123.1,123.1,1,"DT")
2970911
"^DD",123.1,123.1,3,0)
DISABLED MESSAGE^F^^0;4^K:$L(X)>40!($L(X)<1) X
"^DD",123.1,123.1,3,3)
Enter the message that will display when this action is disabled, 1-40 characters.
"^DD",123.1,123.1,3,21,0)
^^2^2^2970911^^^^
"^DD",123.1,123.1,3,21,1,0)
This field displays a 'DISABLED' message when this CPRS status has been
"^DD",123.1,123.1,3,21,2,0)
disabled.
"^DD",123.1,123.1,3,"DT")
2920225
"^DD",123.1,123.1,4,0)
HL7 CONTROL CODE FROM CONSULTS^F^^0;5^K:$L(X)>2!($L(X)<1) X
"^DD",123.1,123.1,4,3)
Enter 2 character HL7 code related to the action.
"^DD",123.1,123.1,4,21,0)
^^12^12^2971112^
"^DD",123.1,123.1,4,21,1,0)
This field indicates what HL7 control code is passed to CPRS from
"^DD",123.1,123.1,4,21,2,0)
Consults.
"^DD",123.1,123.1,4,21,3,0)
    Example: 
"^DD",123.1,123.1,4,21,4,0)
             "SN"=Service entered, backdoor consult, automatically
"^DD",123.1,123.1,4,21,5,0)
released from CPRS, though signatures may still be required depending on
"^DD",123.1,123.1,4,21,6,0)
nature of order
"^DD",123.1,123.1,4,21,7,0)
             "OD"=Discontinued
"^DD",123.1,123.1,4,21,8,0)
             "OC"=Denied by service (Cancelled)
"^DD",123.1,123.1,4,21,9,0)
             "SC"=Service status update (generic status change) for active
"^DD",123.1,123.1,4,21,10,0)
and partial results
"^DD",123.1,123.1,4,21,11,0)
             "XX"=Forwarded
"^DD",123.1,123.1,4,21,12,0)
             "RE"=Completed
"^DD",123.1,123.1,4,"DT")
2971112
"^DD",123.1,123.1,5,0)
HL7 CONTROL CODE FROM CPRS^F^^0;6^K:$L(X)>2!($L(X)<1) X
"^DD",123.1,123.1,5,1,0)
^.1
"^DD",123.1,123.1,5,1,1,0)
123.1^D
"^DD",123.1,123.1,5,1,1,1)
S ^GMR(123.1,"D",$E(X,1,30),DA)=""
"^DD",123.1,123.1,5,1,1,2)
K ^GMR(123.1,"D",$E(X,1,30),DA)
"^DD",123.1,123.1,5,1,1,"%D",0)
^^2^2^2971112^
"^DD",123.1,123.1,5,1,1,"%D",1,0)
This cross-reference allows Consults to convert an order control from
"^DD",123.1,123.1,5,1,1,"%D",2,0)
HL7 Table 0119 to a Consult activity for tracking.
"^DD",123.1,123.1,5,1,1,"DT")
2971112
"^DD",123.1,123.1,5,3)
Enter the HL7 Control code passed from CPRS for this action.
"^DD",123.1,123.1,5,21,0)
^^5^5^2971112^
"^DD",123.1,123.1,5,21,1,0)
This field indicates what HL7 control code is passed from CPRS to
"^DD",123.1,123.1,5,21,2,0)
Consults.
"^DD",123.1,123.1,5,21,3,0)
    Example: "NW"=New consult entered and released through CPRS
"^DD",123.1,123.1,5,21,4,0)
             "CA"=Cancelled via the orders tab
"^DD",123.1,123.1,5,21,5,0)
             "DC"=Discontinued
"^DD",123.1,123.1,5,"DT")
2971112
"^DD",123.1,123.1,6,0)
HL7 TABLE 38 ORDER STATUS^F^^0;7^K:$L(X)>2!($L(X)<1) X
"^DD",123.1,123.1,6,3)
Enter the 1-2 character code from HL7 Table 0038
"^DD",123.1,123.1,6,21,0)
^^2^2^2971114^
"^DD",123.1,123.1,6,21,1,0)
This field is for documenting purposes and contains the related Table 38
"^DD",123.1,123.1,6,21,2,0)
order status from HL7 for each activity.
"^DD",123.1,123.1,6,"DT")
2971114
"^DD",123.1,123.1,7,0)
ACTION PRINT NAME^F^^0;8^K:$L(X)>30!($L(X)<1) X
"^DD",123.1,123.1,7,3)
Enter the text to appear before comments on the 513
"^DD",123.1,123.1,7,21,0)
^^1^1^2980624^
"^DD",123.1,123.1,7,21,1,0)
This field is used on the 513 Form as a header for comments.
"^DD",123.1,123.1,7,"DT")
2980624
"^DD",123.5,123.5,1.01,0)
PROVISIONAL DX PROMPT^S^O:OPTIONAL;R:REQUIRE;S:SUPPRESS;^1;1^Q
"^DD",123.5,123.5,1.01,3)
Enter a code to determine the restraints placed on the provisional diagnosis prompt when ordering via CPRS.
"^DD",123.5,123.5,1.01,21,0)
^^7^7^3000209^^^^
"^DD",123.5,123.5,1.01,21,1,0)
This field will be used by CPRS to determine how to prompt for the
"^DD",123.5,123.5,1.01,21,2,0)
provisional diagnosis when ordering consults for this service. If this
"^DD",123.5,123.5,1.01,21,3,0)
field is set to OPTIONAL, the user will be prompted for the provisional
"^DD",123.5,123.5,1.01,21,4,0)
diagnosis but may bypass answering the prompt. If the field is set to
"^DD",123.5,123.5,1.01,21,5,0)
SUPPRESS, the user will not be presented with the provisional diagnosis
"^DD",123.5,123.5,1.01,21,6,0)
prompt. If set to REQUIRED, the user must answer the prompt to continue
"^DD",123.5,123.5,1.01,21,7,0)
placing the order.
"^DD",123.5,123.5,1.01,"DT")
2990916
"^DD",123.5,123.5,1.02,0)
PROVISIONAL DX INPUT^S^F:FREE TEXT;L:LEXICON;^1;2^Q
"^DD",123.5,123.5,1.02,3)
Enter a code to indicate the type of input allowed by CPRS when entering a provisional diagnosis
"^DD",123.5,123.5,1.02,21,0)
^^5^5^3000209^^^^
"^DD",123.5,123.5,1.02,21,1,0)
This field will determine the method that CPRS will use to prompt the user
"^DD",123.5,123.5,1.02,21,2,0)
for input of the provisional diagnosis when ordering. If set to FREE TEXT,
"^DD",123.5,123.5,1.02,21,3,0)
the user may type any text from 2-80 characters in length. If set to
"^DD",123.5,123.5,1.02,21,4,0)
LEXICON, the user will be required to select a coded diagnosis from the
"^DD",123.5,123.5,1.02,21,5,0)
Clinical Lexicon.
"^DD",123.5,123.5,1.02,"DT")
2990916
"^DD",123.5,123.5,1.03,0)
RESTRICT DEFAULT REASON EDIT^S^0:UNRESTRICTED;1:ASK ON EDIT ONLY;2:NO EDITING;^1;3^Q
"^DD",123.5,123.5,1.03,3)
Choose 0, 1 or 2
"^DD",123.5,123.5,1.03,21,0)
^^17^17^2991203^
"^DD",123.5,123.5,1.03,21,1,0)
If a DEFAULT REASON FOR REQUEST exists for this service this field effects
"^DD",123.5,123.5,1.03,21,2,0)
the ordering person's ability to edit the default reason while placing an
"^DD",123.5,123.5,1.03,21,3,0)
order.
"^DD",123.5,123.5,1.03,21,4,0)
 
"^DD",123.5,123.5,1.03,21,5,0)
        0 - UNRESTRICTED
"^DD",123.5,123.5,1.03,21,6,0)
            User will be able to edit the default text at any time.
"^DD",123.5,123.5,1.03,21,7,0)
 
"^DD",123.5,123.5,1.03,21,8,0)
        1 - ASK ON EDIT ONLY
"^DD",123.5,123.5,1.03,21,9,0)
            User will only be allowed to edit the default reason if the
"^DD",123.5,123.5,1.03,21,10,0)
            order is edited before releasing to the service.
"^DD",123.5,123.5,1.03,21,11,0)
 
"^DD",123.5,123.5,1.03,21,12,0)
        2 - NO EDITING
"^DD",123.5,123.5,1.03,21,13,0)
            User will not be allowed to edit the default reason at any
"^DD",123.5,123.5,1.03,21,14,0)
            time.
"^DD",123.5,123.5,1.03,21,15,0)
 
"^DD",123.5,123.5,1.03,21,16,0)
The value of this field will be ignored if no DEFAULT REASON FOR REQUEST
"^DD",123.5,123.5,1.03,21,17,0)
exists for this service.
"^DD",123.5,123.5,1.03,"DT")
2991130
"^DD",123.5,123.5,1.04,0)
NOTIFY SERVICE ON DC^S^0:ALWAYS;1:REQUESTOR ACTION;2:NEVER;^1;4^Q
"^DD",123.5,123.5,1.04,3)
Enter one of the codes.
"^DD",123.5,123.5,1.04,21,0)
^.001^16^16^3000317^^^
"^DD",123.5,123.5,1.04,21,1,0)
This field controls when members configured to receive notifications for
"^DD",123.5,123.5,1.04,21,2,0)
this service in the Consult hierarchy will be alerted to a consult being
"^DD",123.5,123.5,1.04,21,3,0)
discontinued.
"^DD",123.5,123.5,1.04,21,4,0)
 
"^DD",123.5,123.5,1.04,21,5,0)
0 - ALWAYS
"^DD",123.5,123.5,1.04,21,6,0)
    service update users will receive notification of a discontinue
"^DD",123.5,123.5,1.04,21,7,0)
    regardless of who DC's the order
"^DD",123.5,123.5,1.04,21,8,0)
 
"^DD",123.5,123.5,1.04,21,9,0)
1 - REQUESTOR ACTION
"^DD",123.5,123.5,1.04,21,10,0)
    service update users will receive notification of a discontinue only
"^DD",123.5,123.5,1.04,21,11,0)
    if the user discontinuing the consult is not an update user for the
"^DD",123.5,123.5,1.04,21,12,0)
    service
"^DD",123.5,123.5,1.04,21,13,0)
 
"^DD",123.5,123.5,1.04,21,14,0)
2 - NEVER
"^DD",123.5,123.5,1.04,21,15,0)
    service update users will never receive notification of a discontinued
"^DD",123.5,123.5,1.04,21,16,0)
    consult
"^DD",123.5,123.5,1.04,"DT")
3000317
"^DD",123.5,123.5,1.05,0)
REPRINT 513 ON DC^S^0:ALWAYS;1:REQUESTOR ACTION;2:NEVER;^1;5^Q
"^DD",123.5,123.5,1.05,3)
Enter one of the codes
"^DD",123.5,123.5,1.05,21,0)
^^14^14^3000317^
"^DD",123.5,123.5,1.05,21,1,0)
This field will determine if the SF-513 should reprint to the consulting
"^DD",123.5,123.5,1.05,21,2,0)
service when a consult is discontinued.
"^DD",123.5,123.5,1.05,21,3,0)
 
"^DD",123.5,123.5,1.05,21,4,0)
0 - ALWAYS
"^DD",123.5,123.5,1.05,21,5,0)
    the SF-513 will always reprint to the SERVICE PRINTER when a consult
"^DD",123.5,123.5,1.05,21,6,0)
    is discontinued
"^DD",123.5,123.5,1.05,21,7,0)
 
"^DD",123.5,123.5,1.05,21,8,0)
1 - REQUESTOR ACTION
"^DD",123.5,123.5,1.05,21,9,0)
    the SF-513 will reprint to the SERVICE PRINTER only when a consult is
"^DD",123.5,123.5,1.05,21,10,0)
    discontinued by a user that is not an update user for the service in
"^DD",123.5,123.5,1.05,21,11,0)
    
"^DD",123.5,123.5,1.05,21,12,0)
2 - NEVER
"^DD",123.5,123.5,1.05,21,13,0)
    the SF-513 will never reprint to the SERVICE printer regardless of who
"^DD",123.5,123.5,1.05,21,14,0)
    discontinued the consult 
"^DD",123.5,123.5,1.05,"DT")
3000317
"^DD",123.5,123.5,10,0)
SUB-SERVICE^123.51P^^10;0
"^DD",123.5,123.5,10,20,0)
^.3LA^^0
"^DD",123.5,123.5,10,21,0)
^.001^4^4^3000404^^^^
"^DD",123.5,123.5,10,21,1,0)
This is the set of services or specialties that may be grouped under
"^DD",123.5,123.5,10,21,2,0)
the Service/Specialty.  A member of this sub-service may also be defined
"^DD",123.5,123.5,10,21,3,0)
to have its own sub-service/specialties. There is no limit to the
"^DD",123.5,123.5,10,21,4,0)
depth of the hierarchy beneath ALL SERVICES.
"^DD",123.5,123.5,10,"DT")
2910710
"^DD",123.5,123.5,124,0)
DEFAULT REASON FOR REQUEST^123.5124^^124;0
"^DD",123.5,123.5,124,21,0)
^^7^7^2990721^^
"^DD",123.5,123.5,124,21,1,0)
This field will allow a boilerplate of text to be imported into the reason
"^DD",123.5,123.5,124,21,2,0)
for request when placing consult or procedure orders for this service. If
"^DD",123.5,123.5,124,21,3,0)
the user places an order using a quick order having boilerplate text, that
"^DD",123.5,123.5,124,21,4,0)
text will supersede any default text stored. 
"^DD",123.5,123.5,124,21,5,0)
 
"^DD",123.5,123.5,124,21,6,0)
This field may contain any text including TIU objects. TIU Objects must be
"^DD",123.5,123.5,124,21,7,0)
enclosed in vertical bars (e.g. |PATIENT NAME| ).
"^DD",123.5,123.5,125,0)
PREREQUISITE^123.5125^^125;0
"^DD",123.5,123.51,0)
SUB-SERVICE SUB-FIELD^^2^2
"^DD",123.5,123.51,0,"NM","SUB-SERVICE")

"^DD",123.5,123.51,.01,0)
SUB-SERVICE/SPECIALTY^MP123.5'^GMR(123.5,^0;1^Q
"^DD",123.5,123.51,.01,1,0)
^.1
"^DD",123.5,123.51,.01,1,1,0)
123.51^B
"^DD",123.5,123.51,.01,1,1,1)
S ^GMR(123.5,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.51,.01,1,1,2)
K ^GMR(123.5,DA(1),10,"B",$E(X,1,30),DA)
"^DD",123.5,123.51,.01,1,2,0)
123.5^APC^MUMPS
"^DD",123.5,123.51,.01,1,2,1)
S ^GMR(123.5,"APC",$E(X,1,30),DA(1),DA)=""
"^DD",123.5,123.51,.01,1,2,2)
K ^GMR(123.5,"APC",$E(X,1,30),DA(1),DA)
"^DD",123.5,123.51,.01,1,2,"%D",0)
^^3^3^2971103^^
"^DD",123.5,123.51,.01,1,2,"%D",1,0)
This cross-reference is used to find the parents of a given service. This
"^DD",123.5,123.51,.01,1,2,"%D",2,0)
helps identify AC cross-references that need to be updated when the .01
"^DD",123.5,123.51,.01,1,2,"%D",3,0)
name changes, and helps manage forwarding to services.
"^DD",123.5,123.51,.01,1,2,"DT")
2971103
"^DD",123.5,123.51,.01,1,3,0)
123.51^AC^MUMPS
"^DD",123.5,123.51,.01,1,3,1)
I $L($P($G(^GMR(123.5,X,0)),U)) S ^GMR(123.5,DA(1),10,"AC",$P($G(^GMR(123.5,X,0)),U),DA)=""
"^DD",123.5,123.51,.01,1,3,2)
I $L($P($G(^GMR(123.5,X,0)),U)) K ^GMR(123.5,DA(1),10,"AC",$P($G(^GMR(123.5,X,0)),U),DA)
"^DD",123.5,123.51,.01,1,3,"%D",0)
^^2^2^2971103^^
"^DD",123.5,123.51,.01,1,3,"%D",1,0)
This cross-reference is used to build a hierarchical listing of the
"^DD",123.5,123.51,.01,1,3,"%D",2,0)
services alphabetically.
"^DD",123.5,123.51,.01,1,3,"DT")
2971103
"^DD",123.5,123.51,.01,3)
Enter the name of the Service which is to be a SUB-service of the parent service.
"^DD",123.5,123.51,.01,21,0)
^.001^7^7^3000404^^^^
"^DD",123.5,123.51,.01,21,1,0)
This is the menu of sub-service/specialties that are grouped under this
"^DD",123.5,123.51,.01,21,2,0)
Service.  The sub-service/specialty entries must each be defined as 
"^DD",123.5,123.51,.01,21,3,0)
entries in this file.
"^DD",123.5,123.51,.01,21,4,0)
  
"^DD",123.5,123.51,.01,21,5,0)
There is no limit on how deep the hierarchy of services may be defined.
"^DD",123.5,123.51,.01,21,6,0)
The only requirement is that the "ALL SERVICES" entry be at the top of
"^DD",123.5,123.51,.01,21,7,0)
the hierarchy.
"^DD",123.5,123.51,.01,23,0)
3^.001^3^3^3000404^^^^
"^DD",123.5,123.51,.01,23,1,0)
This file is similar to the Option File and Protocol File.  The same
"^DD",123.5,123.51,.01,23,2,0)
concepts for setting up options should be used to define the Service/
"^DD",123.5,123.51,.01,23,3,0)
Specialty entries.
"^DD",123.5,123.51,.01,"DT")
3000404
"^DD",123.5,123.5124,0)
DEFAULT REASON FOR REQUEST SUB-FIELD^^.01^1
"^DD",123.5,123.5124,0,"DT")
2990720
"^DD",123.5,123.5124,0,"NM","DEFAULT REASON FOR REQUEST")

"^DD",123.5,123.5124,0,"UP")
123.5
"^DD",123.5,123.5124,.01,0)
DEFAULT REASON FOR REQUEST^W^^0;1^Q
"^DD",123.5,123.5124,.01,3)
Enter the default text to be used as the reason for request when ordering a consult for this service.
"^DD",123.5,123.5124,.01,21,0)
^^7^7^2990721^
"^DD",123.5,123.5124,.01,21,1,0)
This field will allow a boilerplate of text to be imported into the reason
"^DD",123.5,123.5124,.01,21,2,0)
for request when placing consult or procedure orders for this service. If
"^DD",123.5,123.5124,.01,21,3,0)
the user places an order using a quick order having boilerplate text, that
"^DD",123.5,123.5124,.01,21,4,0)
text will supersede any default text stored. 
"^DD",123.5,123.5124,.01,21,5,0)
 
"^DD",123.5,123.5124,.01,21,6,0)
This field may contain any text including TIU objects. TIU Objects must be
"^DD",123.5,123.5124,.01,21,7,0)
enclosed in vertical bars (e.g. |PATIENT NAME| ).
"^DD",123.5,123.5124,.01,"DT")
2990720
"^DD",123.5,123.5125,0)
PREREQUISITE SUB-FIELD^^.01^1
"^DD",123.5,123.5125,0,"DT")
3000321
"^DD",123.5,123.5125,0,"NM","PREREQUISITE")

"^DD",123.5,123.5125,0,"UP")
123.5
"^DD",123.5,123.5125,.01,0)
PREREQUISITE^W^^0;1^Q
"^DD",123.5,123.5125,.01,3)
Enter any pre-requisite information for ordering a consult to this service.
"^DD",123.5,123.5125,.01,21,0)
^^11^11^3000321^
"^DD",123.5,123.5125,.01,21,1,0)
This word-processing field is utilized to communicate pre-requisite
"^DD",123.5,123.5125,.01,21,2,0)
information to the ordering person prior to ordering a consult to this
"^DD",123.5,123.5125,.01,21,3,0)
service.
"^DD",123.5,123.5125,.01,21,4,0)
 
"^DD",123.5,123.5125,.01,21,5,0)
This field will be presented to the ordering person upon selecting a
"^DD",123.5,123.5125,.01,21,6,0)
Consult service and will allow them to abort the ordering at that time if
"^DD",123.5,123.5125,.01,21,7,0)
they choose.
"^DD",123.5,123.5125,.01,21,8,0)
 
"^DD",123.5,123.5125,.01,21,9,0)
TIU objects may be embedded within this field which will be resolved for
"^DD",123.5,123.5125,.01,21,10,0)
the current patient during ordering. Any TIU objects must be contained
"^DD",123.5,123.5125,.01,21,11,0)
within vertical bars (e.g. |BLOOD PRESSURE| ). 
"^DD",123.5,123.5125,.01,"DT")
3000321
"^DIC",123.1,123.1,0)
REQUEST ACTION TYPES^123.1
"^DIC",123.1,123.1,0,"GL")
^GMR(123.1,
"^DIC",123.1,123.1,"%D",0)
^^6^6^2921119^^^^
"^DIC",123.1,123.1,"%D",1,0)
This file identifies the action types which may be used by a service to 
"^DIC",123.1,123.1,"%D",2,0)
track activity related to a consult or request.
"^DIC",123.1,123.1,"%D",3,0)
  
"^DIC",123.1,123.1,"%D",4,0)
Certain action types may have a "GMRCACT " protocol entry in the Protocol
"^DIC",123.1,123.1,"%D",5,0)
File (101) which corresponds to the action type.  Two actions should not 
"^DIC",123.1,123.1,"%D",6,0)
point to the same protocol.
"^DIC",123.1,"B","REQUEST ACTION TYPES",123.1)

**END**
**END**
