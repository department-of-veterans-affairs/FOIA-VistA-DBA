Released EAS*1*15 SEQ #16
Extracted from mail message
**KIDS**:EAS*1.0*15^

**INSTALL NAME**
EAS*1.0*15
"BLD",4113,0)
EAS*1.0*15^ENROLLMENT APPLICATION SYSTEM^0^3020725^y
"BLD",4113,1,0)
^^3^3^3020610^
"BLD",4113,1,1,0)
This patch distributes several enhancements to the EAS MT means test 
"BLD",4113,1,2,0)
letters and appointment blocking application as required by the Rossio 22 
"BLD",4113,1,3,0)
report and the subsequent VA Directive.
"BLD",4113,4,0)
^9.64PA^713^1
"BLD",4113,4,713,0)
713
"BLD",4113,4,713,2,0)
^9.641^713.025^2
"BLD",4113,4,713,2,713,0)
EAS MT PARAMETERS  (File-top level)
"BLD",4113,4,713,2,713,1,0)
^9.6411^8^2
"BLD",4113,4,713,2,713,1,8,0)
ALLOW FILTERING BY LOCATION?
"BLD",4113,4,713,2,713,1,9,0)
FORCE PRIMARY RETURN ADDRESS
"BLD",4113,4,713,2,713.025,0)
*ADDITIONAL PRINT LOCATIONS  (sub-file)
"BLD",4113,4,713,2,713.025,1,0)
^9.6411^^
"BLD",4113,4,713,222)
y^y^p^^^^n
"BLD",4113,4,"APDD",713,713)

"BLD",4113,4,"APDD",713,713,8)

"BLD",4113,4,"APDD",713,713,9)

"BLD",4113,4,"APDD",713,713.025)

"BLD",4113,4,"B",713,713)

"BLD",4113,"KRN",0)
^9.67PA^8989.52^19
"BLD",4113,"KRN",.4,0)
.4
"BLD",4113,"KRN",.401,0)
.401
"BLD",4113,"KRN",.402,0)
.402
"BLD",4113,"KRN",.403,0)
.403
"BLD",4113,"KRN",.5,0)
.5
"BLD",4113,"KRN",.84,0)
.84
"BLD",4113,"KRN",3.6,0)
3.6
"BLD",4113,"KRN",3.8,0)
3.8
"BLD",4113,"KRN",9.2,0)
9.2
"BLD",4113,"KRN",9.8,0)
9.8
"BLD",4113,"KRN",9.8,"NM",0)
^9.68A^13^10
"BLD",4113,"KRN",9.8,"NM",1,0)
EASMTRP3^^0^B16609567
"BLD",4113,"KRN",9.8,"NM",3,0)
EASMTUTL^^0^B46284685
"BLD",4113,"KRN",9.8,"NM",4,0)
EASMTPAR^^0^B2683703
"BLD",4113,"KRN",9.8,"NM",7,0)
EASMTL6^^0^B57670617
"BLD",4113,"KRN",9.8,"NM",8,0)
EASMTL6A^^0^B19394386
"BLD",4113,"KRN",9.8,"NM",9,0)
EASMTL6B^^0^B1521524
"BLD",4113,"KRN",9.8,"NM",10,0)
EASMTRP2^^0^B11447149
"BLD",4113,"KRN",9.8,"NM",11,0)
EASMTCHK^^0^B24612873
"BLD",4113,"KRN",9.8,"NM",12,0)
EASMTRPT^^0^B56616937
"BLD",4113,"KRN",9.8,"NM",13,0)
EASMTL10^^0^B34412568
"BLD",4113,"KRN",9.8,"NM","B","EASMTCHK",11)

"BLD",4113,"KRN",9.8,"NM","B","EASMTL10",13)

"BLD",4113,"KRN",9.8,"NM","B","EASMTL6",7)

"BLD",4113,"KRN",9.8,"NM","B","EASMTL6A",8)

"BLD",4113,"KRN",9.8,"NM","B","EASMTL6B",9)

"BLD",4113,"KRN",9.8,"NM","B","EASMTPAR",4)

"BLD",4113,"KRN",9.8,"NM","B","EASMTRP2",10)

"BLD",4113,"KRN",9.8,"NM","B","EASMTRP3",1)

"BLD",4113,"KRN",9.8,"NM","B","EASMTRPT",12)

"BLD",4113,"KRN",9.8,"NM","B","EASMTUTL",3)

"BLD",4113,"KRN",19,0)
19
"BLD",4113,"KRN",19,"NM",0)
^9.68A^9^9
"BLD",4113,"KRN",19,"NM",1,0)
EAS MT APPT EXPIRATION RPT^^0
"BLD",4113,"KRN",19,"NM",2,0)
EAS MT REPORT MENU^^0
"BLD",4113,"KRN",19,"NM",3,0)
EAS MT TEST LETTER^^0
"BLD",4113,"KRN",19,"NM",4,0)
EAS MT SETUP MENU^^2
"BLD",4113,"KRN",19,"NM",5,0)
EAS MT EXPIRATIONS^^0
"BLD",4113,"KRN",19,"NM",6,0)
EAS MT SUMMARY REPORT^^0
"BLD",4113,"KRN",19,"NM",7,0)
EAS MT PENDING LETTERS^^0
"BLD",4113,"KRN",19,"NM",8,0)
EAS MT STATISTICS SUMMARY^^0
"BLD",4113,"KRN",19,"NM",9,0)
EAS MT UNRETURNED LETTERS^^0
"BLD",4113,"KRN",19,"NM","B","EAS MT APPT EXPIRATION RPT",1)

"BLD",4113,"KRN",19,"NM","B","EAS MT EXPIRATIONS",5)

"BLD",4113,"KRN",19,"NM","B","EAS MT PENDING LETTERS",7)

"BLD",4113,"KRN",19,"NM","B","EAS MT REPORT MENU",2)

"BLD",4113,"KRN",19,"NM","B","EAS MT SETUP MENU",4)

"BLD",4113,"KRN",19,"NM","B","EAS MT STATISTICS SUMMARY",8)

"BLD",4113,"KRN",19,"NM","B","EAS MT SUMMARY REPORT",6)

"BLD",4113,"KRN",19,"NM","B","EAS MT TEST LETTER",3)

"BLD",4113,"KRN",19,"NM","B","EAS MT UNRETURNED LETTERS",9)

"BLD",4113,"KRN",19.1,0)
19.1
"BLD",4113,"KRN",101,0)
101
"BLD",4113,"KRN",409.61,0)
409.61
"BLD",4113,"KRN",771,0)
771
"BLD",4113,"KRN",870,0)
870
"BLD",4113,"KRN",8989.51,0)
8989.51
"BLD",4113,"KRN",8989.52,0)
8989.52
"BLD",4113,"KRN",8994,0)
8994
"BLD",4113,"KRN","B",.4,.4)

"BLD",4113,"KRN","B",.401,.401)

"BLD",4113,"KRN","B",.402,.402)

"BLD",4113,"KRN","B",.403,.403)

"BLD",4113,"KRN","B",.5,.5)

"BLD",4113,"KRN","B",.84,.84)

"BLD",4113,"KRN","B",3.6,3.6)

"BLD",4113,"KRN","B",3.8,3.8)

"BLD",4113,"KRN","B",9.2,9.2)

"BLD",4113,"KRN","B",9.8,9.8)

"BLD",4113,"KRN","B",19,19)

"BLD",4113,"KRN","B",19.1,19.1)

"BLD",4113,"KRN","B",101,101)

"BLD",4113,"KRN","B",409.61,409.61)

"BLD",4113,"KRN","B",771,771)

"BLD",4113,"KRN","B",870,870)

"BLD",4113,"KRN","B",8989.51,8989.51)

"BLD",4113,"KRN","B",8989.52,8989.52)

"BLD",4113,"KRN","B",8994,8994)

"BLD",4113,"QUES",0)
^9.62^^
"BLD",4113,"REQB",0)
^9.611^3^2
"BLD",4113,"REQB",2,0)
EAS*1.0*12^1
"BLD",4113,"REQB",3,0)
EAS*1.0*14^1
"BLD",4113,"REQB","B","EAS*1.0*12",2)

"BLD",4113,"REQB","B","EAS*1.0*14",3)

"FIA",713)
EAS MT PARAMETERS
"FIA",713,0)
^EAS(713,
"FIA",713,0,0)
713
"FIA",713,0,1)
y^y^p^^^^n
"FIA",713,0,10)

"FIA",713,0,11)

"FIA",713,0,"RLRO")

"FIA",713,0,"VR")
1.0^EAS
"FIA",713,713)
1
"FIA",713,713,8)

"FIA",713,713,9)

"FIA",713,713,25)

"FIA",713,713.025)
0
"KRN",19,11368,-1)
0^6
"KRN",19,11368,0)
EAS MT SUMMARY REPORT^Automated MT Letters Summary Report^^A^^^^^^^^ENROLLMENT APPLICATION SYSTEM^^1
"KRN",19,11368,1,0)
^19.06^1^1^3020116^^^^
"KRN",19,11368,1,1,0)
Lists count summaries of unreturned means tests grouped by letter type.
"KRN",19,11368,20)
D SUMMRY^EASMTRPT
"KRN",19,11368,25)

"KRN",19,11368,"U")
AUTOMATED MT LETTERS SUMMARY R
"KRN",19,11370,-1)
0^2
"KRN",19,11370,0)
EAS MT REPORT MENU^Report Menu^^M^^^^^^^^ENROLLMENT APPLICATION SYSTEM
"KRN",19,11370,1,0)
^19.06^1^1^3020610^^^^
"KRN",19,11370,1,1,0)
Report sub-menu for EAS MT auto-letters
"KRN",19,11370,10,0)
^19.01IP^6^6
"KRN",19,11370,10,1,0)
11368^^2
"KRN",19,11370,10,1,"^")
EAS MT SUMMARY REPORT
"KRN",19,11370,10,2,0)
11371^^1
"KRN",19,11370,10,2,"^")
EAS MT PENDING LETTERS
"KRN",19,11370,10,3,0)
11373^^3
"KRN",19,11370,10,3,"^")
EAS MT STATISTICS SUMMARY
"KRN",19,11370,10,4,0)
11377^^4
"KRN",19,11370,10,4,"^")
EAS MT UNRETURNED LETTERS
"KRN",19,11370,10,5,0)
11381^EX^6
"KRN",19,11370,10,5,"^")
EAS MT EXPIRATIONS
"KRN",19,11370,10,6,0)
11456^AP^5
"KRN",19,11370,10,6,"^")
EAS MT APPT EXPIRATION RPT
"KRN",19,11370,99)
58965,33147
"KRN",19,11370,99.1)
58863,54271
"KRN",19,11370,"U")
REPORT MENU
"KRN",19,11371,-1)
0^7
"KRN",19,11371,0)
EAS MT PENDING LETTERS^Count of pending letters to be printed^^A^^^^^^^^ENROLLMENT APPLICATION SYSTEM^^1
"KRN",19,11371,1,0)
^19.06^1^1^3020220^^^^
"KRN",19,11371,1,1,0)
Indicates how many letters or forms that have not printed yet.
"KRN",19,11371,20)
D QUE^EASMTRP2
"KRN",19,11371,25)

"KRN",19,11371,"U")
COUNT OF PENDING LETTERS TO BE
"KRN",19,11373,-1)
0^8
"KRN",19,11373,0)
EAS MT STATISTICS SUMMARY^Means Test Letters Statistic Report^^A^^^^^^^^ENROLLMENT APPLICATION SYSTEM^^1
"KRN",19,11373,1,0)
^19.06^1^1^3011115^^^^
"KRN",19,11373,1,1,0)
A statistical report for a given processing date range.
"KRN",19,11373,20)
D LTRSTAT^EASMTRPT
"KRN",19,11373,60)

"KRN",19,11373,62)

"KRN",19,11373,63)

"KRN",19,11373,64)

"KRN",19,11373,65)

"KRN",19,11373,66)

"KRN",19,11373,"U")
MEANS TEST LETTERS STATISTIC R
"KRN",19,11377,-1)
0^9
"KRN",19,11377,0)
EAS MT UNRETURNED LETTERS^Unreturned Letter Statistic Report^^A^^^^^^^^ENROLLMENT APPLICATION SYSTEM^^1
"KRN",19,11377,1,0)
^^1^1^3010713^
"KRN",19,11377,1,1,0)
Count of letters printed but not returned by threshold date, summary report
"KRN",19,11377,20)
D UNRTN^EASMTRPT
"KRN",19,11377,"U")
UNRETURNED LETTER STATISTIC RE
"KRN",19,11379,-1)
2^4
"KRN",19,11379,0)
EAS MT SETUP MENU^EAS MT Parameter Menu^^M^66481^EAS MTSUPV^^^^^^552
"KRN",19,11379,10,0)
^19.01IP^6^6
"KRN",19,11379,10,6,0)
11457^^6
"KRN",19,11379,10,6,"^")
EAS MT TEST LETTER
"KRN",19,11379,"U")
EAS MT PARAMETER MENU
"KRN",19,11381,-1)
0^5
"KRN",19,11381,0)
EAS MT EXPIRATIONS^Means Test Expiration Report^^A^^^^^^^^ENROLLMENT APPLICATION SYSTEM^^1
"KRN",19,11381,1,0)
^^1^1^3011029^
"KRN",19,11381,1,1,0)
Expiration report of means tests for selected anniversary date range.
"KRN",19,11381,20)
D EN^EASMTRP1
"KRN",19,11381,"U")
MEANS TEST EXPIRATION REPORT
"KRN",19,11456,-1)
0^1
"KRN",19,11456,0)
EAS MT APPT EXPIRATION RPT^Means Test Expiration by Appt Date^^A^^^^^^^^ENROLLMENT APPLICATION SYSTEM^^1
"KRN",19,11456,1,0)
^^4^4^3020610^
"KRN",19,11456,1,1,0)
This report provides a list by clinic and appointment date of patients
"KRN",19,11456,1,2,0)
whose means test anniversary date will be reached on the date of their 
"KRN",19,11456,1,3,0)
appointment.  Report displays by clinic the name, last four, anniversary
"KRN",19,11456,1,4,0)
date and time of appointment.
"KRN",19,11456,20)
D QUE^EASMTRP3
"KRN",19,11456,"U")
MEANS TEST EXPIRATION BY APPT 
"KRN",19,11457,-1)
0^3
"KRN",19,11457,0)
EAS MT TEST LETTER^Print a Test Letter (EAS MT)^^A^^^^^^^^ENROLLMENT APPLICATION SYSTEM^^1
"KRN",19,11457,1,0)
^^4^4^3020610^
"KRN",19,11457,1,1,0)
This option prints a generic test letter from the EAS MT LETTERS File, 
"KRN",19,11457,1,2,0)
#713.3.  User will be asked to select the type of letter to print in a
"KRN",19,11457,1,3,0)
test format.  The printed letter includes a "DO NOT MAIL" warning as
"KRN",19,11457,1,4,0)
part of the patient name.
"KRN",19,11457,20)
D TESTLTR^EASMTUTL
"KRN",19,11457,"U")
PRINT A TEST LETTER (EAS MT)
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",552,-1)
1^1
"PKG",552,0)
ENROLLMENT APPLICATION SYSTEM^EAS^ENROLLMENT
"PKG",552,20,0)
^9.402P^2^1
"PKG",552,20,2,0)
2^^EASXDR
"PKG",552,20,2,1)

"PKG",552,20,"B",2,2)

"PKG",552,22,0)
^9.49I^1^1
"PKG",552,22,1,0)
1.0^3010315^3010419^66481
"PKG",552,22,1,"PAH",1,0)
15^3020725
"PKG",552,22,1,"PAH",1,1,0)
^^3^3^3020725
"PKG",552,22,1,"PAH",1,1,1,0)
This patch distributes several enhancements to the EAS MT means test 
"PKG",552,22,1,"PAH",1,1,2,0)
letters and appointment blocking application as required by the Rossio 22 
"PKG",552,22,1,"PAH",1,1,3,0)
report and the subsequent VA Directive.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","EASMTCHK")
0^11^B24612873
"RTN","EASMTCHK",1,0)
EASMTCHK ;ALB/SCK -  MEANS TEST BLOCKING CHECK ; 8/13/01
"RTN","EASMTCHK",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,12,15**;MAR 15,2001
"RTN","EASMTCHK",3,0)
 ; This routine provides an API, which when called from Appointment Management will allow 
"RTN","EASMTCHK",4,0)
 ; for the blocking of future appointments and appointment check-in/out if the patient 
"RTN","EASMTCHK",5,0)
 ; requires a Means Test or has a Means Test Status of Required. $$LST^DGMTU is used 
"RTN","EASMTCHK",6,0)
 ; to determine if a MT is REQUIRED.  If a MT does not have a status of REQUIRED, 
"RTN","EASMTCHK",7,0)
 ; but is more than 365 days out (same criteria used in OLD^DGMTU4), the MT will 
"RTN","EASMTCHK",8,0)
 ; be considered "REQUIRED" for blocking purposes. If a Means Test is required, the 
"RTN","EASMTCHK",9,0)
 ; following combinations of appointment actions will be blocked:
"RTN","EASMTCHK",10,0)
 ;    o Making a future appt for a Regular appt type
"RTN","EASMTCHK",11,0)
 ;    o Check In/Out an appt which is either a Regular or Research type
"RTN","EASMTCHK",12,0)
 ;
"RTN","EASMTCHK",13,0)
 ; A Walk-in will see the alert notice, and will be warned NOT to CHECK-IN the walk-in 
"RTN","EASMTCHK",14,0)
 ; appointment. Unscheduled/Walk-ins can ONLY be checked out.
"RTN","EASMTCHK",15,0)
 ;
"RTN","EASMTCHK",16,0)
 ; This API may be passed a flag to "silence" the screen display of the alert message, and 
"RTN","EASMTCHK",17,0)
 ; will accept an array variable to return the alert text in. Inpatient appointments 
"RTN","EASMTCHK",18,0)
 ; are not affected in any way.  Domicilary are not considered inpatients for the purpose 
"RTN","EASMTCHK",19,0)
 ; of Means Test Blocking for appointments
"RTN","EASMTCHK",20,0)
 ;
"RTN","EASMTCHK",21,0)
MT(DFN,EASAPT,EASACT,EASDT,EASQT,EASMSG) ; Entry point for MT Check
"RTN","EASMTCHK",22,0)
 ; Input Variables
"RTN","EASMTCHK",23,0)
 ;    DFN    - Patient's IEN in File #2
"RTN","EASMTCHK",24,0)
 ;    EASAPT - Appointment Type (File #409.1) [Optional]
"RTN","EASMTCHK",25,0)
 ;    EASACT - Appointment Action Flag [Optional] Default = "Other"
"RTN","EASMTCHK",26,0)
 ;             "M"  - Make an Appointment
"RTN","EASMTCHK",27,0)
 ;             "C"  - Check In/Out an existing appointment
"RTN","EASMTCHK",28,0)
 ;             "W"  - Unscheduled/Walk-in appointment
"RTN","EASMTCHK",29,0)
 ;             "O"  - Other
"RTN","EASMTCHK",30,0)
 ;             "L"  - Letters
"RTN","EASMTCHK",31,0)
 ;
"RTN","EASMTCHK",32,0)
 ;    EASDT  - Appointment Date/Time [Optional]
"RTN","EASMTCHK",33,0)
 ;    EASQT  - Silent flag [Optional], if set will prevent display of alert message
"RTN","EASMTCHK",34,0)
 ;    EASMSG - Return array for alert message [Optional], if passed in, the alert 
"RTN","EASMTCHK",35,0)
 ;             message text will be copied to this array
"RTN","EASMTCHK",36,0)
 ;
"RTN","EASMTCHK",37,0)
 ; Output
"RTN","EASMTCHK",38,0)
 ;    1  - Block action (MT Required)
"RTN","EASMTCHK",39,0)
 ;    0  - Don't block action (MT Not required)
"RTN","EASMTCHK",40,0)
 ;
"RTN","EASMTCHK",41,0)
 N RSLT,EASMT,EASTXT,EASX,EAMTS,DSPLY,IENS
"RTN","EASMTCHK",42,0)
 ;
"RTN","EASMTCHK",43,0)
 S RSLT=0
"RTN","EASMTCHK",44,0)
 S EASQT=+$G(EASQT)
"RTN","EASMTCHK",45,0)
 S EASAPT=+$G(EASAPT)
"RTN","EASMTCHK",46,0)
 S EASDT=$G(EASDT)
"RTN","EASMTCHK",47,0)
 S EASACT=$G(EASACT)
"RTN","EASMTCHK",48,0)
 S:EASACT']"" EASACT="O"
"RTN","EASMTCHK",49,0)
 ; If Appt type is not defined, action is CI/CO, get appt date
"RTN","EASMTCHK",50,0)
 I 'EASAPT,EASACT="C" D
"RTN","EASMTCHK",51,0)
 . S IENS=EASDT_","_DFN
"RTN","EASMTCHK",52,0)
 . S EASAPT=$$GET1^DIQ(2.98,IENS,9.5,"I")
"RTN","EASMTCHK",53,0)
 ;
"RTN","EASMTCHK",54,0)
 Q:$$INP(DFN) RSLT       ; Quit if inpatient
"RTN","EASMTCHK",55,0)
 S EAMTS=$$MTCHK(DFN,EASACT)    ; Get MT Check flag
"RTN","EASMTCHK",56,0)
 Q:'EAMTS RSLT
"RTN","EASMTCHK",57,0)
 ;
"RTN","EASMTCHK",58,0)
 ;Build Alert message 
"RTN","EASMTCHK",59,0)
 D BLDMSG(EASACT,.EASTXT)
"RTN","EASMTCHK",60,0)
 I $D(EASMSG) M @EASMSG=EASTXT ; If output array defined,copy message test
"RTN","EASMTCHK",61,0)
 ;
"RTN","EASMTCHK",62,0)
 ; Check appointment action and appointment type.  Set blocking action
"RTN","EASMTCHK",63,0)
 I EASACT="M",EASAPT=9 S (DSPLY,RSLT)=1 ; Make an Appt.
"RTN","EASMTCHK",64,0)
 ;
"RTN","EASMTCHK",65,0)
 I EASACT="C" D  ; Check-in an appt.
"RTN","EASMTCHK",66,0)
 . I $G(EASAPT)=9 S (DSPLY,RSLT)=1
"RTN","EASMTCHK",67,0)
 ;
"RTN","EASMTCHK",68,0)
 I "W,O"[EASACT D  ; Walk-in/Other appt.
"RTN","EASMTCHK",69,0)
 . S:$G(EASAPT)=9 DSPLY=1
"RTN","EASMTCHK",70,0)
 ;
"RTN","EASMTCHK",71,0)
 I $G(DSPLY) D
"RTN","EASMTCHK",72,0)
 . Q:EASQT  ; If silent flag is set, do not display alert
"RTN","EASMTCHK",73,0)
 . S EASX=0
"RTN","EASMTCHK",74,0)
 . W !?5,$CHAR(7),"******************************************************"
"RTN","EASMTCHK",75,0)
 . F  S EASX=$O(EASTXT(EASX)) Q:'EASX  D
"RTN","EASMTCHK",76,0)
 . . W !?5,EASTXT(EASX)
"RTN","EASMTCHK",77,0)
 ;
"RTN","EASMTCHK",78,0)
 ; Check for override key on making appointments
"RTN","EASMTCHK",79,0)
 I EASACT="M" D
"RTN","EASMTCHK",80,0)
 . I $D(^XUSEC("EAS MTOVERRIDE",DUZ)) S RSLT=0
"RTN","EASMTCHK",81,0)
 Q $G(RSLT)
"RTN","EASMTCHK",82,0)
 ;
"RTN","EASMTCHK",83,0)
MTCHK(DFN,EASACT) ; Check Means Test Status
"RTN","EASMTCHK",84,0)
 ; Input
"RTN","EASMTCHK",85,0)
 ;     DFN
"RTN","EASMTCHK",86,0)
 ;
"RTN","EASMTCHK",87,0)
 ; Output  
"RTN","EASMTCHK",88,0)
 ;     0   OK
"RTN","EASMTCHK",89,0)
 ;     1   MEANS TEST Required
"RTN","EASMTCHK",90,0)
 ;
"RTN","EASMTCHK",91,0)
 N RSLT,EASTAT,EASDT
"RTN","EASMTCHK",92,0)
 ;
"RTN","EASMTCHK",93,0)
 S RSLT=0
"RTN","EASMTCHK",94,0)
 S EASTAT=$$LST^DGMTU(DFN,"",1)
"RTN","EASMTCHK",95,0)
 I EASTAT]"" D
"RTN","EASMTCHK",96,0)
 . I $P(EASTAT,U,4)="R" S RSLT=1 Q
"RTN","EASMTCHK",97,0)
 . ;; Condition Check: Cat C or Pending Adj. AND Agrees to pay Deductible AND MT date after 10/5/1999
"RTN","EASMTCHK",98,0)
 . I "C,P"[$P(EASTAT,U,4),$$GET1^DIQ(408.31,+EASTAT,.11,"I"),$P(EASTAT,U,2)>2991005 Q
"RTN","EASMTCHK",99,0)
 . ;; Condition Check: Cat C AND Declines to give income information AND Agreed to pay deductible
"RTN","EASMTCHK",100,0)
 . I $P(EASTAT,U,4)="C",$$GET1^DIQ(408.31,+EASTAT,.14,"I"),$$GET1^DIQ(408.31,+EASTAT,.11,"I") Q
"RTN","EASMTCHK",101,0)
 . S EASDT=$P(EASTAT,U,2)
"RTN","EASMTCHK",102,0)
 . I ($$FMDIFF^XLFDT(DT,EASDT)>365) S RSLT=1
"RTN","EASMTCHK",103,0)
 . I $G(EASACT)="L" D
"RTN","EASMTCHK",104,0)
 . . ;; For letters, need to check for letters past 60-day threshold
"RTN","EASMTCHK",105,0)
 . . I ($$FMDIFF^XLFDT(DT,EASDT)>304) S RSLT=1
"RTN","EASMTCHK",106,0)
 ;
"RTN","EASMTCHK",107,0)
 I $P(EASTAT,U,4)="N" S RSLT=0
"RTN","EASMTCHK",108,0)
 Q $G(RSLT)
"RTN","EASMTCHK",109,0)
 ;
"RTN","EASMTCHK",110,0)
BLDMSG(EASACT,EASTXT) ; Build alert message to user
"RTN","EASMTCHK",111,0)
 N LINE
"RTN","EASMTCHK",112,0)
 ;
"RTN","EASMTCHK",113,0)
 S LINE=1
"RTN","EASMTCHK",114,0)
 S EASTXT(LINE)="Means Test Alert",LINE=LINE+1
"RTN","EASMTCHK",115,0)
 S EASTXT(LINE)="A Means Test is required or needs to be completed.",LINE=LINE+1
"RTN","EASMTCHK",116,0)
 ;
"RTN","EASMTCHK",117,0)
 I "M,C,W"[EASACT D
"RTN","EASMTCHK",118,0)
 . S EASTXT(LINE)="Please perform MEANS TEST or instruct patient",LINE=LINE+1
"RTN","EASMTCHK",119,0)
 . S EASTXT(LINE)="to report for Means Test interview.",LINE=LINE+1
"RTN","EASMTCHK",120,0)
 ;
"RTN","EASMTCHK",121,0)
 I EASACT="M" D
"RTN","EASMTCHK",122,0)
 . S EASTXT(LINE)=">> A future appointment cannot be made at this time."
"RTN","EASMTCHK",123,0)
 . S:$D(^XUSEC("EAS MTOVERRIDE",DUZ)) EASTXT(LINE)=">> Override Key in Effect."
"RTN","EASMTCHK",124,0)
 . S LINE=LINE+1
"RTN","EASMTCHK",125,0)
 ;
"RTN","EASMTCHK",126,0)
 I EASACT="C" S EASTXT(LINE)=">> This action may not be completed at this time.",LINE=LINE+1
"RTN","EASMTCHK",127,0)
 I EASACT="W" D
"RTN","EASMTCHK",128,0)
 . S EASTXT(LINE)=">> Check-Out ONLY.  Do NOT Check-In (CI) a walk-in appointment",LINE=LINE+1
"RTN","EASMTCHK",129,0)
 . S EASTXT(LINE)="   You will not be able to check-out the appt. if you do so.",LINE=LINE+1
"RTN","EASMTCHK",130,0)
 Q
"RTN","EASMTCHK",131,0)
 ;
"RTN","EASMTCHK",132,0)
INP(DFN) ; Check on Inpatient status
"RTN","EASMTCHK",133,0)
 ;  Input
"RTN","EASMTCHK",134,0)
 ;     DFN   - IEN from patient file
"RTN","EASMTCHK",135,0)
 ;  Output
"RTN","EASMTCHK",136,0)
 ;     1 - Patient has Inpatient status 
"RTN","EASMTCHK",137,0)
 ;     0 - Patient does not have Inpatient status
"RTN","EASMTCHK",138,0)
 ;  Default
"RTN","EASMTCHK",139,0)
 ;     Inpatient API defaults to TODAY for inpatient status check
"RTN","EASMTCHK",140,0)
 ;
"RTN","EASMTCHK",141,0)
 N VAERR,EAIN,VAROOT,VAINDT
"RTN","EASMTCHK",142,0)
 ;
"RTN","EASMTCHK",143,0)
 S VAINDT=$$NOW^XLFDT,VAROOT="EAIN"
"RTN","EASMTCHK",144,0)
 ;; Modified to treat DOM patients as inpatients for the purpose of appointment blocking.
"RTN","EASMTCHK",145,0)
 ;; EAS*1*12
"RTN","EASMTCHK",146,0)
 D INP^VADPT
"RTN","EASMTCHK",147,0)
 Q $S(+$G(EAIN(1)):1,1:0)
"RTN","EASMTL10")
0^13^B34412568
"RTN","EASMTL10",1,0)
EASMTL10 ;MIN/TCM ALB/SCK - AUTOMATED MEANS TEST LETTERS - RERUN LETTERS ; 7/17/01
"RTN","EASMTL10",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,15**;Mar 15, 2001
"RTN","EASMTL10",3,0)
 ;
"RTN","EASMTL10",4,0)
RERUN ;  Main entry point to rerun a processing date
"RTN","EASMTL10",5,0)
 N EASDDD,DIR,DIRUT,EATYP,ZTSAVE,EASLOC,EASKIP,EASLOC,EASIEN,EASX
"RTN","EASMTL10",6,0)
 ;
"RTN","EASMTL10",7,0)
 S EASLOC=-1
"RTN","EASMTL10",8,0)
 I $$GET1^DIQ(713,1,8,"I") D  Q:$D(DIRUT)
"RTN","EASMTL10",9,0)
 . S DIR(0)="YAO",DIR("A")="Filter letters by Preferred Facility? "
"RTN","EASMTL10",10,0)
 . S DIR("B")="NO"
"RTN","EASMTL10",11,0)
 . S DIR("?")="Enter 'YES' to limit letters to a specific Facility or 'NO' to print all letters"
"RTN","EASMTL10",12,0)
 . D ^DIR K DIR
"RTN","EASMTL10",13,0)
 . Q:$D(DIRUT)!('Y)
"RTN","EASMTL10",14,0)
 . S DIR(0)="P^EAS(713,1,2,:QEM"
"RTN","EASMTL10",15,0)
 . S EASLOC=$$FACNUM^EASMTL6
"RTN","EASMTL10",16,0)
 E  D
"RTN","EASMTL10",17,0)
 . S EASLOC=0
"RTN","EASMTL10",18,0)
 ;
"RTN","EASMTL10",19,0)
 D LIST^EASMTL10 ; Display available processing dates
"RTN","EASMTL10",20,0)
ASKDT ; Ask for processing date to look for letters
"RTN","EASMTL10",21,0)
 S DIR(0)="DAO^:DT:EP"
"RTN","EASMTL10",22,0)
 S DIR("?")="^D LIST^EASMTL10"
"RTN","EASMTL10",23,0)
 S DIR("?",1)="Select Processing Date:"
"RTN","EASMTL10",24,0)
 S DIR("A",1)=""
"RTN","EASMTL10",25,0)
 S DIR("A")="Enter processing date to re-run letters: "
"RTN","EASMTL10",26,0)
 D ^DIR K DIR
"RTN","EASMTL10",27,0)
 Q:$D(DIRUT)
"RTN","EASMTL10",28,0)
 I '$D(^EAS(713.2,"AD",+Y)) D  G ASKDT
"RTN","EASMTL10",29,0)
 . W !!?5,$CHAR(7),"There are no entries with this processing date, type '?' for list.",!
"RTN","EASMTL10",30,0)
 S EASDDD=+Y
"RTN","EASMTL10",31,0)
 Q:'EASDDD
"RTN","EASMTL10",32,0)
 ;
"RTN","EASMTL10",33,0)
TYPE ;  Ask for a specific type of letter to print
"RTN","EASMTL10",34,0)
 S DIR(0)="SO^1:60-Day;2:30-Day;4:0-Day"
"RTN","EASMTL10",35,0)
 S DIR("A")="Select letter type",DIR("A",1)=""
"RTN","EASMTL10",36,0)
 S DIR("?")="Select the type of letter to re-print "
"RTN","EASMTL10",37,0)
 D ^DIR K DIR
"RTN","EASMTL10",38,0)
 Q:$D(DIRUT)
"RTN","EASMTL10",39,0)
 S EATYP=+Y
"RTN","EASMTL10",40,0)
 ;
"RTN","EASMTL10",41,0)
QUE1 ;  Queue off the print job
"RTN","EASMTL10",42,0)
 K IOP,IO("Q")
"RTN","EASMTL10",43,0)
 ;
"RTN","EASMTL10",44,0)
 S %ZIS="QP",%ZIS("B")=$$GET1^DIQ(713,1,5)
"RTN","EASMTL10",45,0)
 D ^%ZIS K %ZIS
"RTN","EASMTL10",46,0)
 Q:POP
"RTN","EASMTL10",47,0)
 I $D(IO("Q")) D QUEIT Q
"RTN","EASMTL10",48,0)
 D EN1
"RTN","EASMTL10",49,0)
 D ^%ZISC
"RTN","EASMTL10",50,0)
 Q
"RTN","EASMTL10",51,0)
 ;
"RTN","EASMTL10",52,0)
QUEIT ;
"RTN","EASMTL10",53,0)
 N ZTRTN,ZTDESC,ZTSAVE,TSK,ZTDTH,ZTQUEUED
"RTN","EASMTL10",54,0)
 ;
"RTN","EASMTL10",55,0)
 S ZTRTN="EN1^EASMTL10"
"RTN","EASMTL10",56,0)
 S ZTDESC="EAS MT LETTERS REPRINT"
"RTN","EASMTL10",57,0)
 F EASX="EASDDD","EATYP","EASLOC" S ZTSAVE(EASX)=""
"RTN","EASMTL10",58,0)
 S ZTDTH="NOW"
"RTN","EASMTL10",59,0)
 ;
"RTN","EASMTL10",60,0)
 D ^%ZTLOAD
"RTN","EASMTL10",61,0)
 I $D(ZTSK)[0 W !!?5,"Reprint canceled"
"RTN","EASMTL10",62,0)
 E  W !!?5,"Letters queued, [",ZTSK,"]"
"RTN","EASMTL10",63,0)
 D HOME^%ZIS
"RTN","EASMTL10",64,0)
 Q
"RTN","EASMTL10",65,0)
 ;
"RTN","EASMTL10",66,0)
EN1 ;  Queued entry point for letter rerun
"RTN","EASMTL10",67,0)
 N EASIEN,EASABRT,EASTMP
"RTN","EASMTL10",68,0)
 ;
"RTN","EASMTL10",69,0)
 S EASTMP="^TMP(""EASRP"",$J)"
"RTN","EASMTL10",70,0)
 K @EASTMP
"RTN","EASMTL10",71,0)
 ;
"RTN","EASMTL10",72,0)
 I '$D(ZTQUEUED) W !,"...Gathering letters to re-print..."
"RTN","EASMTL10",73,0)
 D BLD(EATYP,EASLOC,EASDDD,EASTMP)
"RTN","EASMTL10",74,0)
 I '$D(ZTQUEUED),'$D(@EASTMP) D  Q
"RTN","EASMTL10",75,0)
 . W !?3,$CHAR(7),">> No letters found to reprint for these parameters.",!
"RTN","EASMTL10",76,0)
 D PRINT(EASTMP,EATYP)
"RTN","EASMTL10",77,0)
 K @EASTMP
"RTN","EASMTL10",78,0)
 Q
"RTN","EASMTL10",79,0)
 ;
"RTN","EASMTL10",80,0)
PRINT(EASTMP,EATYP) ;
"RTN","EASMTL10",81,0)
 N EASIEN,EASABRT
"RTN","EASMTL10",82,0)
 ;
"RTN","EASMTL10",83,0)
 U IO
"RTN","EASMTL10",84,0)
 S EASIEN=0
"RTN","EASMTL10",85,0)
 F  S EASIEN=$O(@EASTMP@(EASIEN)) Q:'EASIEN  D  Q:$G(EASABRT)
"RTN","EASMTL10",86,0)
 . D LETTER^EASMTL6A(EASIEN,EATYP)
"RTN","EASMTL10",87,0)
 . I '$D(IO("Q")),$E(IOST,1,2)="C-" D
"RTN","EASMTL10",88,0)
 . . S DIR(0)="E"
"RTN","EASMTL10",89,0)
 . . D ^DIR K DIR
"RTN","EASMTL10",90,0)
 . . S:'Y EASABRT=1
"RTN","EASMTL10",91,0)
 Q
"RTN","EASMTL10",92,0)
 ;
"RTN","EASMTL10",93,0)
BLD(EATYP,EASLOC,EASDDD,EASTMP) ;  Sort letters for processing date in groups by type
"RTN","EASMTL10",94,0)
 N EASIEN,EASPTR,DFN,EASLTR
"RTN","EASMTL10",95,0)
 ;
"RTN","EASMTL10",96,0)
 S EASIEN=0
"RTN","EASMTL10",97,0)
 F  S EASIEN=$O(^EAS(713.2,"AD",EASDDD,EASIEN)) Q:'EASIEN  D
"RTN","EASMTL10",98,0)
 . ; Begin Checks
"RTN","EASMTL10",99,0)
 . S EASPTR=$$GET1^DIQ(713.2,EASIEN,2,"I")
"RTN","EASMTL10",100,0)
 . S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTL10",101,0)
 . ;; Filter by site, Quit if filter not met
"RTN","EASMTL10",102,0)
 . I +$G(EASLOC)>0 Q:$$GET1^DIQ(2,DFN,27.02,"I")'=+EASLOC
"RTN","EASMTL10",103,0)
 . Q:$D(^EAS(713.2,"AC",1,EASIEN))  ; Quit if MT has been returned
"RTN","EASMTL10",104,0)
 . Q:$D(^EAS(713.1,"AP",1,EASPTR))  ; Quit if prohibit flag set
"RTN","EASMTL10",105,0)
 . Q:$$CHECKMT^EASMTUTL(EASPTR,EASIEN)  ; Quit if MT no longer required
"RTN","EASMTL10",106,0)
 . Q:$$FUTMT^EASMTUTL(EASIEN)  ; Quit if future MT on file
"RTN","EASMTL10",107,0)
 . Q:$$DECEASED^EASMTUTL(EASIEN)  ; Quit if patient deceased
"RTN","EASMTL10",108,0)
 . I $$CHKADR^EASMTL6A(EASPTR),EATYP'=3 Q
"RTN","EASMTL10",109,0)
 . S @EASTMP@(EASIEN)=EATYP
"RTN","EASMTL10",110,0)
 Q
"RTN","EASMTL10",111,0)
 ;
"RTN","EASMTL10",112,0)
SINGLE ;  Rerun a single letter
"RTN","EASMTL10",113,0)
 N Y,DIR,DIRUT,EASPTR,DFN,EASIEN,ZTSAVE,EASLOC,IOP,EAX,PRNOVRD
"RTN","EASMTL10",114,0)
 ;
"RTN","EASMTL10",115,0)
ASKPAT ;  Select patient to reprint a letter for
"RTN","EASMTL10",116,0)
 S DIR(0)="PAO^713.1:EMZ"
"RTN","EASMTL10",117,0)
 S DIR("A")="Select PATIENT: "
"RTN","EASMTL10",118,0)
 S DIR("?")="Select Patient Letter status entry to reprint"
"RTN","EASMTL10",119,0)
 D ^DIR K DIR
"RTN","EASMTL10",120,0)
 Q:$D(DIRUT)
"RTN","EASMTL10",121,0)
 S EASPTR=+Y ; Ptr to file 713.1
"RTN","EASMTL10",122,0)
 S DFN=+Y(0)
"RTN","EASMTL10",123,0)
 Q:'DFN
"RTN","EASMTL10",124,0)
 ;
"RTN","EASMTL10",125,0)
 I $D(^EAS(713.1,"AP",1,EASPTR)) D  Q
"RTN","EASMTL10",126,0)
 . W !!?4,$CHAR(7),"The Prohibit flag is set for this patient"
"RTN","EASMTL10",127,0)
 I $$DECEASED^EASMTUTL("",DFN) D  Q
"RTN","EASMTL10",128,0)
 . W !!?4,$CHAR(7),"Patient is deceased"
"RTN","EASMTL10",129,0)
 ;
"RTN","EASMTL10",130,0)
ASKLTR ;  Select LETTER STATUS file entry
"RTN","EASMTL10",131,0)
 S DIR(0)="P^713.2:EMZ"
"RTN","EASMTL10",132,0)
 S DIR("?",1)="Select Processing Date: "
"RTN","EASMTL10",133,0)
 S DIR("A")="Select the letter processing date for this patient"
"RTN","EASMTL10",134,0)
 S DIR("S")="I $P(^(0),U,2)=EASPTR" ; Set screen for selected patient
"RTN","EASMTL10",135,0)
 D ^DIR K DIR
"RTN","EASMTL10",136,0)
 Q:$D(DIRUT)
"RTN","EASMTL10",137,0)
 S EASIEN=+Y
"RTN","EASMTL10",138,0)
 ;
"RTN","EASMTL10",139,0)
 I $$GET1^DIQ(713.2,EASIEN,4,"I") D  Q
"RTN","EASMTL10",140,0)
 . W !!?4,$CHAR(7),"A Means Test has already been returned by this patient"
"RTN","EASMTL10",141,0)
 ;
"RTN","EASMTL10",142,0)
 I $$CHECKMT^EASMTUTL(EASPTR,EASIEN) D  Q
"RTN","EASMTL10",143,0)
 . W !!?4,$CHAR(7),"Patient's Means Test is no longer required"
"RTN","EASMTL10",144,0)
 ;
"RTN","EASMTL10",145,0)
ASKTYP ; Allow only letters already sent to be reprinted
"RTN","EASMTL10",146,0)
 N EASSC,EAX
"RTN","EASMTL10",147,0)
 ;
"RTN","EASMTL10",148,0)
 F EAX=6,4,"Z" D
"RTN","EASMTL10",149,0)
 . I $P(^EAS(713.2,EASIEN,EAX),U,3) D
"RTN","EASMTL10",150,0)
 . . I EAX=6 S EASSC=$G(EASSC)_"1:60-Day;"
"RTN","EASMTL10",151,0)
 . . I EAX=4 S EASSC=$G(EASSC)_"2:30-Day;"
"RTN","EASMTL10",152,0)
 . . I EAX="Z" S EASSC=$G(EASSC)_"4:0-Day"
"RTN","EASMTL10",153,0)
 I $G(EASSC)']""  D  Q
"RTN","EASMTL10",154,0)
 . W !!?4,$CHAR(7),"There are no letters to re-print for this patient"
"RTN","EASMTL10",155,0)
 ;
"RTN","EASMTL10",156,0)
 S DIR(0)="SO^"_EASSC,DIR("A")="Select letter type"
"RTN","EASMTL10",157,0)
 S DIR("?")="Select letter type to re-print"
"RTN","EASMTL10",158,0)
 D ^DIR K DIR
"RTN","EASMTL10",159,0)
 Q:$D(DIRUT)
"RTN","EASMTL10",160,0)
 S EATYP=+Y
"RTN","EASMTL10",161,0)
 ;
"RTN","EASMTL10",162,0)
QUE2 ;  Que off print letter
"RTN","EASMTL10",163,0)
 S ZTSAVE("EASIEN")="",ZTSAVE("EASPTR")="",ZTSAVE("EATYP")="",ZTSAVE("EASLOC")=""
"RTN","EASMTL10",164,0)
 D EN^XUTMDEVQ("EN2^EASMTL10","EAS MT RERUN SINGLE LETTER",.ZTSAVE)
"RTN","EASMTL10",165,0)
 Q
"RTN","EASMTL10",166,0)
 ;
"RTN","EASMTL10",167,0)
EN2 ;  Queued entry point to re-run a single letter
"RTN","EASMTL10",168,0)
 ;
"RTN","EASMTL10",169,0)
 D LETTER^EASMTL6A(EASIEN,EATYP)
"RTN","EASMTL10",170,0)
 Q
"RTN","EASMTL10",171,0)
 ;
"RTN","EASMTL10",172,0)
LIST ;  List last processing dates for the Letter Status file
"RTN","EASMTL10",173,0)
 N EAX
"RTN","EASMTL10",174,0)
 ;
"RTN","EASMTL10",175,0)
 W !!,"Available Processing Dates:"
"RTN","EASMTL10",176,0)
 S EAX=0
"RTN","EASMTL10",177,0)
 F  S EAX=$O(^EAS(713.2,"AD",EAX)) Q:'EAX  D
"RTN","EASMTL10",178,0)
 . W !?6,$$FMTE^XLFDT(EAX,"2D")
"RTN","EASMTL10",179,0)
 Q
"RTN","EASMTL6")
0^7^B57670617
"RTN","EASMTL6",1,0)
EASMTL6 ; ALB/SCK - AUTOMATED MEANS TEST LETTER-INTERACTIVE PRINT ; 7-13-01
"RTN","EASMTL6",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,14,15**;MAR 15,2001
"RTN","EASMTL6",3,0)
 ;
"RTN","EASMTL6",4,0)
EN ; Main entry point
"RTN","EASMTL6",5,0)
 ; Input, set in option call, if not passed in, or called interactively, user is asked to specify.
"RTN","EASMTL6",6,0)
 ;    EATYP - Used for selective printing of letters and forms
"RTN","EASMTL6",7,0)
 ;         1 : 60-Day
"RTN","EASMTL6",8,0)
 ;         2 : 30-Day
"RTN","EASMTL6",9,0)
 ;         4 :  0-Day
"RTN","EASMTL6",10,0)
 ;
"RTN","EASMTL6",11,0)
 N DIR,DIRUT,POP,EASLOC
"RTN","EASMTL6",12,0)
 ;
"RTN","EASMTL6",13,0)
 ;; Select type of letter to print
"RTN","EASMTL6",14,0)
 I '$G(EATYP) D  Q:$D(DIRUT)
"RTN","EASMTL6",15,0)
 . S DIR(0)="SO^1:60-Day;2:30-Day;4:0-Day"
"RTN","EASMTL6",16,0)
 . S DIR("?")="Select the type of letter to print"
"RTN","EASMTL6",17,0)
 . D ^DIR K DIR
"RTN","EASMTL6",18,0)
 . S EATYP=+Y
"RTN","EASMTL6",19,0)
 ;
"RTN","EASMTL6",20,0)
 ;; Select facility filter if appropiate
"RTN","EASMTL6",21,0)
 S EASLOC=-1
"RTN","EASMTL6",22,0)
 I $$GET1^DIQ(713,1,8,"I") D  Q:$D(DIRUT)
"RTN","EASMTL6",23,0)
 . S DIR(0)="YAO",DIR("A")="Filter letters by Preferred Facility? "
"RTN","EASMTL6",24,0)
 . S DIR("B")="NO"
"RTN","EASMTL6",25,0)
 . S DIR("?")="Enter 'YES' to limit letters to a specific Facility or 'NO' to print all letters."
"RTN","EASMTL6",26,0)
 . D ^DIR K DIR
"RTN","EASMTL6",27,0)
 . Q:$D(DIRUT)!('Y)
"RTN","EASMTL6",28,0)
 . S EASLOC=$$FACNUM
"RTN","EASMTL6",29,0)
 ;
"RTN","EASMTL6",30,0)
 K IOP,IO("Q")
"RTN","EASMTL6",31,0)
 ;
"RTN","EASMTL6",32,0)
 S %ZIS="QP",%ZIS("B")=$$GET1^DIQ(713,1,5)
"RTN","EASMTL6",33,0)
 D ^%ZIS K %ZIS
"RTN","EASMTL6",34,0)
 Q:POP
"RTN","EASMTL6",35,0)
 I $D(IO("Q")) D QUE Q
"RTN","EASMTL6",36,0)
 D LTR
"RTN","EASMTL6",37,0)
 D ^%ZISC
"RTN","EASMTL6",38,0)
 K EATYP
"RTN","EASMTL6",39,0)
 Q
"RTN","EASMTL6",40,0)
 ;
"RTN","EASMTL6",41,0)
QUE ; Queue the report
"RTN","EASMTL6",42,0)
 N ZTRTN,ZTDESC,ZTSAVE,ZTSK,ZTDTH,ZTQUEUED
"RTN","EASMTL6",43,0)
 ;
"RTN","EASMTL6",44,0)
 S ZTRTN="LTR^EASMTL6"
"RTN","EASMTL6",45,0)
 S ZTDESC="EAS MT LETTERS PRINT JOB"
"RTN","EASMTL6",46,0)
 S ZTSAVE("EATYP")="",ZTSAVE("EASLOC")=""
"RTN","EASMTL6",47,0)
 S ZTDTH="NOW"
"RTN","EASMTL6",48,0)
 ;
"RTN","EASMTL6",49,0)
 D ^%ZTLOAD
"RTN","EASMTL6",50,0)
 I $D(ZTSK)[0 W !!?5,"Letters canceled!"
"RTN","EASMTL6",51,0)
 E  W !!?5,"Letters queued! [ ",ZTSK," ]"
"RTN","EASMTL6",52,0)
 D HOME^%ZIS
"RTN","EASMTL6",53,0)
 Q
"RTN","EASMTL6",54,0)
 ;
"RTN","EASMTL6",55,0)
LTR ;
"RTN","EASMTL6",56,0)
 N EASTMP,EASKP
"RTN","EASMTL6",57,0)
 ;
"RTN","EASMTL6",58,0)
 S EASTMP="^TMP(""EASMT"",$J)"
"RTN","EASMTL6",59,0)
 K @EASTMP
"RTN","EASMTL6",60,0)
 ;
"RTN","EASMTL6",61,0)
 I '$D(ZTQUEUED) W !,"...Gathering letters to print...Please wait"
"RTN","EASMTL6",62,0)
 D BLD(EATYP,EASLOC,EASTMP,.EASKP)
"RTN","EASMTL6",63,0)
 D RESULT(.EASKP,EATYP)
"RTN","EASMTL6",64,0)
 I '$D(ZTQUEUED) W !,"...Printing letters..."
"RTN","EASMTL6",65,0)
 D PRINT(EASTMP,EATYP)
"RTN","EASMTL6",66,0)
 K @EASTMP,EATYP
"RTN","EASMTL6",67,0)
 Q
"RTN","EASMTL6",68,0)
 ;
"RTN","EASMTL6",69,0)
RESULT(EASKP,EATYP) ; Send results of letter printing to mail group
"RTN","EASMTL6",70,0)
 N MSG,XMSUB,XMY,XMTEXT,XMDUZ,TOT,X1
"RTN","EASMTL6",71,0)
 ;
"RTN","EASMTL6",72,0)
 S MSG(1)="Letters to print: "_$J($FN(EASKP("CNT"),","),8)
"RTN","EASMTL6",73,0)
 S MSG(2)="Letters where the print date has not reached: "_$J($FN(EASKP("T"),","),8)
"RTN","EASMTL6",74,0)
 S MSG(2.5)=""
"RTN","EASMTL6",75,0)
 S MSG(3)="The following letters were found but not printed for the following reasons:"
"RTN","EASMTL6",76,0)
 S MSG(4)="Incomplete Addr :           "_$J($FN(EASKP("I"),","),8)
"RTN","EASMTL6",77,0)
 S MSG(5)="Deceased :                  "_$J($FN(EASKP("D"),","),8)
"RTN","EASMTL6",78,0)
 S MSG(6)="MT Changed:                 "_$J($FN(EASKP("C"),","),8)
"RTN","EASMTL6",79,0)
 S MSG(7)="Prohibit flag set:          "_$J($FN(EASKP("P"),","),8)
"RTN","EASMTL6",80,0)
 S MSG(8)="MT not 'owned' by facility: "_$J($FN(EASKP("O"),","),8)
"RTN","EASMTL6",81,0)
 S MSG(9)=""
"RTN","EASMTL6",82,0)
 S TOT=0 F X1="I","D","C","P","O","T","CNT" S TOT=TOT+EASKP(X1)
"RTN","EASMTL6",83,0)
 S MSG(10)="Total Letters Processed: "_$J($FN(TOT,","),8)_" (MT not returned)"
"RTN","EASMTL6",84,0)
 ;
"RTN","EASMTL6",85,0)
 S XMSUB=$S(EATYP=1:"60-Day",EATYP=2:"30-Day",1:"0-Day")_" Print Letter Results"
"RTN","EASMTL6",86,0)
 S XMTEXT="MSG("
"RTN","EASMTL6",87,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTL6",88,0)
 S XMDUZ="AUTOMATED MT LETTERS"
"RTN","EASMTL6",89,0)
 D ^XMD
"RTN","EASMTL6",90,0)
 Q
"RTN","EASMTL6",91,0)
 ;
"RTN","EASMTL6",92,0)
BLD(EATYP,EASLOC,EASTMP,EASKP) ; Build TMP array of letters to print
"RTN","EASMTL6",93,0)
 N DFN,EASIEN,COUNT,EAX2,EASPTR,EASABRT
"RTN","EASMTL6",94,0)
 ;
"RTN","EASMTL6",95,0)
 F EAX2="P","D","C","F","T","I","O","CNT" S EASKP(EAX2)=0
"RTN","EASMTL6",96,0)
 S COUNT=0
"RTN","EASMTL6",97,0)
 ;
"RTN","EASMTL6",98,0)
 S EASIEN=0 ; Begin loop through un-returned means tests
"RTN","EASMTL6",99,0)
 F  S EASIEN=$O(^EAS(713.2,"AC",0,EASIEN)) Q:'EASIEN  D  Q:$G(EASABRT)
"RTN","EASMTL6",100,0)
 . S EASPTR=$$GET1^DIQ(713.2,EASIEN,2,"I") ; Pointer to File 713.1
"RTN","EASMTL6",101,0)
 . ;; begin checks
"RTN","EASMTL6",102,0)
 . Q:$$LTRTYP^EASMTL6B(EASIEN)'=EATYP  ;  Check for appropriate letter type
"RTN","EASMTL6",103,0)
 . S DFN=$P(^EAS(713.1,$P(^EAS(713.2,EASIEN,0),U,2),0),U,1)
"RTN","EASMTL6",104,0)
 . ;; Filter by site, quit if filter not met
"RTN","EASMTL6",105,0)
 . I +$G(EASLOC)>0 Q:$$GET1^DIQ(2,DFN,27.02,"I")'=+EASLOC
"RTN","EASMTL6",106,0)
 . ;; Quit if the MT is not 'owned' by the facility
"RTN","EASMTL6",107,0)
 . I '$$OWNED($P($G(^EAS(713.1,EASPTR,0)),U,1),EASIEN) D  Q
"RTN","EASMTL6",108,0)
 . . S EASKP("O")=EASKP("O")+1
"RTN","EASMTL6",109,0)
 . I $D(^EAS(713.1,"AP",1,EASPTR)) D  Q  ; Check Prohibit letter
"RTN","EASMTL6",110,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",111,0)
 . . S EASKP("P")=EASKP("P")+1
"RTN","EASMTL6",112,0)
 . I $$DECEASED^EASMTUTL(EASIEN) D  Q  ; Check Deceased
"RTN","EASMTL6",113,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",114,0)
 . . S EASKP("D")=EASKP("D")+1
"RTN","EASMTL6",115,0)
 . I $$CHECKMT^EASMTUTL(EASPTR,EASIEN) D  Q  ; Check MT changed?
"RTN","EASMTL6",116,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",117,0)
 . . S EASKP("C")=EASKP("C")+1 Q
"RTN","EASMTL6",118,0)
 . I $$FUTMT^EASMTUTL(EASIEN) D  Q  ; Check for a Future MT
"RTN","EASMTL6",119,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",120,0)
 . . S EASKP("F")=EASKP("F")+1
"RTN","EASMTL6",121,0)
 . I '$$THRSHLD(EATYP,EASIEN) D  Q  ; Quit if letter threshold not reached
"RTN","EASMTL6",122,0)
 . . S EASKP("T")=EASKP("T")+1
"RTN","EASMTL6",123,0)
 . I $$CHKADR^EASMTL6A(EASPTR) D  Q  ; Check for valid address
"RTN","EASMTL6",124,0)
 . . S EASKP("I")=EASKP("I")+1
"RTN","EASMTL6",125,0)
 . S @EASTMP@(EASIEN)=EATYP ; Build entry
"RTN","EASMTL6",126,0)
 . S EASKP("CNT")=EASKP("CNT")+1
"RTN","EASMTL6",127,0)
 . I $D(IO("Q")),$$S^%ZTLOAD("STOPPED BY USER") S EASABRT=1
"RTN","EASMTL6",128,0)
 Q
"RTN","EASMTL6",129,0)
 ;
"RTN","EASMTL6",130,0)
OWNED(PTR1,EAIEN) ;  Check - Does this facility "own" this means test
"RTN","EASMTL6",131,0)
 ;  Returns '1' if means test 'owned' by facility
"RTN","EASMTL6",132,0)
 ;          '0' if not owned
"RTN","EASMTL6",133,0)
 ;
"RTN","EASMTL6",134,0)
 N MTNODE,MTLST,MTOWN,RSLT
"RTN","EASMTL6",135,0)
 ;
"RTN","EASMTL6",136,0)
 S RSLT=0
"RTN","EASMTL6",137,0)
 S MTLST=$$LST^DGMTU(PTR1)
"RTN","EASMTL6",138,0)
 I $P(MTLST,U,1)>0 D
"RTN","EASMTL6",139,0)
 . S MTNODE=$G(^DGMT(408.31,$P(MTLST,U,1),0))
"RTN","EASMTL6",140,0)
 . S MTOWN=$$GET1^DIQ(408.34,$P(MTNODE,U,23),.01)
"RTN","EASMTL6",141,0)
 . I MTOWN="VAMC" S RSLT=1 Q
"RTN","EASMTL6",142,0)
 . I MTOWN="DCD",$$VERSION^XPDUTL("IVMC") S RSLT=1
"RTN","EASMTL6",143,0)
 ;
"RTN","EASMTL6",144,0)
 ;; If another facility 'owns' this MT, update MT Status information
"RTN","EASMTL6",145,0)
 I 'RSLT D
"RTN","EASMTL6",146,0)
 . Q:'EAIEN
"RTN","EASMTL6",147,0)
 . S DIE="^EAS(713.2,",DA=EAIEN
"RTN","EASMTL6",148,0)
 . S DR="4///YES;5///TODAY;7///MT 'OWNED' BY ANOTHER FACILITY;9///NO;12///NO;18///NO"
"RTN","EASMTL6",149,0)
 . D ^DIE K DIE
"RTN","EASMTL6",150,0)
 ;
"RTN","EASMTL6",151,0)
 Q RSLT
"RTN","EASMTL6",152,0)
 ;
"RTN","EASMTL6",153,0)
PRINT(EASTMP,EATYP) ; Print letters
"RTN","EASMTL6",154,0)
 N EASIEN,EASABRT
"RTN","EASMTL6",155,0)
 ;
"RTN","EASMTL6",156,0)
 U IO
"RTN","EASMTL6",157,0)
 S EASIEN=0
"RTN","EASMTL6",158,0)
 F  S EASIEN=$O(@EASTMP@(EASIEN)) Q:'EASIEN  D  Q:$G(EASABRT)
"RTN","EASMTL6",159,0)
 . D LETTER^EASMTL6A(EASIEN,EATYP) ; Print letter
"RTN","EASMTL6",160,0)
 . D UPDSTAT(EASIEN,EATYP) ; Update Letter status file, #713.2
"RTN","EASMTL6",161,0)
 . I $D(IO("Q")),$$S^%ZTLOAD("STOPPED BY USER") S EASABRT=1 Q
"RTN","EASMTL6",162,0)
 . I '$D(IO("Q")),$E(IOST,1,2)="C-" D
"RTN","EASMTL6",163,0)
 . . S DIR(0)="E"
"RTN","EASMTL6",164,0)
 . . D ^DIR K DIR
"RTN","EASMTL6",165,0)
 . . S:'Y EASABRT=1
"RTN","EASMTL6",166,0)
 Q
"RTN","EASMTL6",167,0)
 ;
"RTN","EASMTL6",168,0)
THRSHLD(EATYP,EASIEN) ; Check threshold for letter types
"RTN","EASMTL6",169,0)
 ; Input
"RTN","EASMTL6",170,0)
 ;    EATYP  - Letter type to print
"RTN","EASMTL6",171,0)
 ;    EASIEN - IEN for file #713.2
"RTN","EASMTL6",172,0)
 ;
"RTN","EASMTL6",173,0)
 ; Output
"RTN","EASMTL6",174,0)
 ;    RSLT = 1: Letter is inside threshold to print
"RTN","EASMTL6",175,0)
 ;           0: Letter is outside threshold (Don't print)
"RTN","EASMTL6",176,0)
 ;
"RTN","EASMTL6",177,0)
 N DIFF,THRESH,RSLT,ANVDT,MTDT
"RTN","EASMTL6",178,0)
 ;
"RTN","EASMTL6",179,0)
 S RSLT=1
"RTN","EASMTL6",180,0)
 Q:'$G(EATYP)
"RTN","EASMTL6",181,0)
 S THRESH=$S(EATYP=1:60,EATYP=2:30,1:0)
"RTN","EASMTL6",182,0)
 S MTDT=$$GET1^DIQ(713.2,EASIEN,3,"I")
"RTN","EASMTL6",183,0)
 S ANVDT=$$FMADD^XLFDT(MTDT,365)
"RTN","EASMTL6",184,0)
 S DIFF=$$FMDIFF^XLFDT(ANVDT,$$DT^XLFDT)
"RTN","EASMTL6",185,0)
 I DIFF>THRESH S RSLT=0
"RTN","EASMTL6",186,0)
 Q RSLT
"RTN","EASMTL6",187,0)
 ;
"RTN","EASMTL6",188,0)
UPDSTAT(EASN,EAX) ; Update Letter status file, #713.2
"RTN","EASMTL6",189,0)
 N DIE,DR,DA,EAPD,EAFLG,NXTFLG
"RTN","EASMTL6",190,0)
 ;
"RTN","EASMTL6",191,0)
 S DIE="^EAS(713.2,",DA=EASN
"RTN","EASMTL6",192,0)
 S DR=$S(EAX=1:10,EAX=2:13,EAX=4:19,1:0)
"RTN","EASMTL6",193,0)
 Q:'DR
"RTN","EASMTL6",194,0)
 S EAPD=DR_".5",EAFLG=DR-1
"RTN","EASMTL6",195,0)
 S DR=DR_"///1;"_EAPD_"///^S X=$$DT^XLFDT;"_EAFLG_"///0"
"RTN","EASMTL6",196,0)
 S NXTFLG=$S(EAFLG=9:12,EAFLG=12:18,1:0)
"RTN","EASMTL6",197,0)
 S:NXTFLG>0 DR=DR_";"_NXTFLG_"///1"
"RTN","EASMTL6",198,0)
 D ^DIE K DIE
"RTN","EASMTL6",199,0)
 D CLRFLG^EASMTUTL(EAX,EASN)
"RTN","EASMTL6",200,0)
 Q
"RTN","EASMTL6",201,0)
 ;
"RTN","EASMTL6",202,0)
FACNUM() ;  Get facility number
"RTN","EASMTL6",203,0)
 N RSLT,DIR
"RTN","EASMTL6",204,0)
 ;
"RTN","EASMTL6",205,0)
 S DIR(0)="P^4:EMZ"
"RTN","EASMTL6",206,0)
 S DIR("S")="I '$P($G(^DIC(4,Y,99)),U,4)"
"RTN","EASMTL6",207,0)
 D ^DIR K DIR
"RTN","EASMTL6",208,0)
 I $D(DIRUT) S RSLT=0
"RTN","EASMTL6",209,0)
 E  S RSLT=+Y_"^"_$P($G(^DIC(4,+Y,99)),U,1)
"RTN","EASMTL6",210,0)
 ;
"RTN","EASMTL6",211,0)
 Q RSLT
"RTN","EASMTL6",212,0)
 ;
"RTN","EASMTL6",213,0)
GETFAC(EADFN,EASARY) ;  set facility return address information
"RTN","EASMTL6",214,0)
 N EASFAC,EAX,EASF,EAS4
"RTN","EASMTL6",215,0)
 ;
"RTN","EASMTL6",216,0)
 I $$GET1^DIQ(713,1,9,"I") D
"RTN","EASMTL6",217,0)
 . S EASFAC=$$GET1^DIQ(2,EADFN,27.02,"I")
"RTN","EASMTL6",218,0)
 . Q:'EASFAC
"RTN","EASMTL6",219,0)
 . ;; Check for inactive flag
"RTN","EASMTL6",220,0)
 . Q:$$GET1^DIQ(4,EASFAC,101,"I")
"RTN","EASMTL6",221,0)
 . D GETS^DIQ(4,EASFAC,".01;1.01;1.02;1.03;1.04;.02;100","EI","EAS4")
"RTN","EASMTL6",222,0)
 . S EASF=EASFAC_","
"RTN","EASMTL6",223,0)
 . ;; Check for valid address information
"RTN","EASMTL6",224,0)
 . I EAS4(4,EASF,1.01,"E")]"",EAS4(4,EASF,1.03,"E")]"",EAS4(4,EASF,.02,"E")]"" S EASARY("TYP")="P"
"RTN","EASMTL6",225,0)
 ;
"RTN","EASMTL6",226,0)
 I $G(EASARY("TYP"))'="P" D
"RTN","EASMTL6",227,0)
 . S EASFAC=$$SITE^VASITE
"RTN","EASMTL6",228,0)
 . D GETS^DIQ(4,+EASFAC,".01;1.01;1.02;1.03;1.04;.02;100","EI","EAS4")
"RTN","EASMTL6",229,0)
 . S EASARY("TYP")="F"
"RTN","EASMTL6",230,0)
 ;
"RTN","EASMTL6",231,0)
 S EASARY("FACNUM")=+EASFAC
"RTN","EASMTL6",232,0)
 S EASARY("FAC")=$$GET1^DIQ(4,+EASFAC,.01,"I")
"RTN","EASMTL6",233,0)
 F EAX=1.01,1.02,1.03,1.04,100 D
"RTN","EASMTL6",234,0)
 .  S EASARY(EAX)=EAS4(4,+EASFAC_",",EAX,"E")
"RTN","EASMTL6",235,0)
 S EASARY(.02)=EAS4(4,+EASFAC_",",.02,"E")_"^"_$$GET1^DIQ(5,EAS4(4,+EASFAC_",",.02,"I"),1)
"RTN","EASMTL6",236,0)
 Q
"RTN","EASMTL6A")
0^8^B19394386
"RTN","EASMTL6A",1,0)
EASMTL6A ; MIN/TCM ALB/SCK - AUTOMATED MEANS TEST LETTER-PRINT LETTERS CONT ; 7-13-01
"RTN","EASMTL6A",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,14,15**;MAR 15,2001
"RTN","EASMTL6A",3,0)
 ;
"RTN","EASMTL6A",4,0)
LETTER(EASN,TYPE) ;Print letter
"RTN","EASMTL6A",5,0)
 ; Input
"RTN","EASMTL6A",6,0)
 ;     EASN    - File #713.2 IEN
"RTN","EASMTL6A",7,0)
 ;     TYPE    - Letter type
"RTN","EASMTL6A",8,0)
 ;
"RTN","EASMTL6A",9,0)
 N DFN,EASADD,EASIN,EASNME,EALNE,EASFAC,MSG,TAB,EAFIEN,EAX,LINE,EASANV,EASX,VADM,VAROOT,OFFSET,EASPTR,EASLIEN,EASITE,EASRTE,EASDEM,POP
"RTN","EASMTL6A",10,0)
 ;
"RTN","EASMTL6A",11,0)
 S TAB=3 ; Tab spacing for letters
"RTN","EASMTL6A",12,0)
 S OFFSET=+$$GET1^DIQ(713,1,10) ; Get print offset for address
"RTN","EASMTL6A",13,0)
 ;
"RTN","EASMTL6A",14,0)
 ;  Get patient data for letter
"RTN","EASMTL6A",15,0)
 S EASPTR=$$GET1^DIQ(713.2,EASN,2,"I")
"RTN","EASMTL6A",16,0)
 I EASPTR]"" S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTL6A",17,0)
 E  S DFN=-1
"RTN","EASMTL6A",18,0)
 ; Get patient mailing information
"RTN","EASMTL6A",19,0)
 D GETPAT(DFN,.EASDEM,.EASADD)
"RTN","EASMTL6A",20,0)
 ;  Get return address info
"RTN","EASMTL6A",21,0)
 D GETFAC^EASMTL6(DFN,.EASFAC)
"RTN","EASMTL6A",22,0)
 ;
"RTN","EASMTL6A",23,0)
 W @IOF
"RTN","EASMTL6A",24,0)
 I EASFAC(100)]"" D
"RTN","EASMTL6A",25,0)
 . W !!?TAB+OFFSET,EASFAC(100)
"RTN","EASMTL6A",26,0)
 E  D
"RTN","EASMTL6A",27,0)
 . W !!?TAB+OFFSET,"VA MEDICAL CENTER"
"RTN","EASMTL6A",28,0)
 ;
"RTN","EASMTL6A",29,0)
 W !?TAB+OFFSET,EASFAC(1.01)
"RTN","EASMTL6A",30,0)
 I EASFAC(1.02)]"" W !?TAB+OFFSET,EASFAC(1.02)
"RTN","EASMTL6A",31,0)
 W !?TAB+OFFSET,EASFAC(1.03)_" "_$P(EASFAC(.02),U,2)_" "_EASFAC(1.04)
"RTN","EASMTL6A",32,0)
 W !!!?TAB+OFFSET,$$FMTE^XLFDT(DT,1)
"RTN","EASMTL6A",33,0)
 ;
"RTN","EASMTL6A",34,0)
 ;; generic test letter setup
"RTN","EASMTL6A",35,0)
 I DFN>0 D
"RTN","EASMTL6A",36,0)
 . S EASNME("FILE")=2,EASNME("IENS")=DFN,EASNME("FIELD")=.01
"RTN","EASMTL6A",37,0)
 . W !!!!?TAB+OFFSET,$$NAMEFMT^XLFNAME(.EASNME,"G")
"RTN","EASMTL6A",38,0)
 E  D
"RTN","EASMTL6A",39,0)
 . W !!!!?TAB+OFFSET,"TEST LETTER (DO NOT MAIL!)"
"RTN","EASMTL6A",40,0)
 W "  (",EASDEM(2),")" ;; Patch 15
"RTN","EASMTL6A",41,0)
 ;;
"RTN","EASMTL6A",42,0)
 W !?TAB+OFFSET,EASADD(1)
"RTN","EASMTL6A",43,0)
 ;
"RTN","EASMTL6A",44,0)
 I EASADD(2)]"" W !?TAB+OFFSET,EASADD(2)
"RTN","EASMTL6A",45,0)
 W !?TAB+OFFSET,EASADD(4)
"RTN","EASMTL6A",46,0)
 I +EASADD(5) W " ",$$GET1^DIQ(5,$P(EASADD(5),U),1)
"RTN","EASMTL6A",47,0)
 W " ",$P(EASADD(11),U,2)
"RTN","EASMTL6A",48,0)
 ;
"RTN","EASMTL6A",49,0)
 S EASANV=$$GET1^DIQ(713.2,EASN,3,"I")
"RTN","EASMTL6A",50,0)
 W !!!!,?TAB,"MEANS TEST ANNIVERSARY DATE: ",$$FMTE^XLFDT($$FMADD^XLFDT(EASANV,365))
"RTN","EASMTL6A",51,0)
 ;
"RTN","EASMTL6A",52,0)
 S EASX=$P(EASDEM(5),U)
"RTN","EASMTL6A",53,0)
 ;; Patch 15
"RTN","EASMTL6A",54,0)
 W !!,?TAB,"Dear ",$S(EASX="M":"Mr. ",EASX="F":"Ms. ",1:"Mr./Ms. ")
"RTN","EASMTL6A",55,0)
 W $S(DFN>0:$$NAMEFMT^XLFNAME(.EASNME,"O","M"),1:"TEST"),":"
"RTN","EASMTL6A",56,0)
 ;;
"RTN","EASMTL6A",57,0)
 ;  Print letter body
"RTN","EASMTL6A",58,0)
 S EASLIEN=$O(^EAS(713.3,"C",TYPE,0))
"RTN","EASMTL6A",59,0)
 Q:'EASLIEN
"RTN","EASMTL6A",60,0)
 S EALNE=0
"RTN","EASMTL6A",61,0)
 ;
"RTN","EASMTL6A",62,0)
 W !
"RTN","EASMTL6A",63,0)
 F  S EALNE=$O(^EAS(713.3,EASLIEN,1,EALNE)) Q:'EALNE  D
"RTN","EASMTL6A",64,0)
 . S LINE=^EAS(713.3,EASLIEN,1,EALNE,0)
"RTN","EASMTL6A",65,0)
 . I LINE["|ANNVDT|" W !?TAB,$P(LINE,"|ANNVDT|",1),$$FMTE^XLFDT($$FMADD^XLFDT(EASANV,365)),$P(LINE,"|ANNVDT|",2) Q
"RTN","EASMTL6A",66,0)
 . W !?TAB,LINE
"RTN","EASMTL6A",67,0)
 ;
"RTN","EASMTL6A",68,0)
 ; Retrieve division section of letter
"RTN","EASMTL6A",69,0)
 S EAFIEN=$O(^EAS(713.3,EASLIEN,2,"B",+EASFAC("FACNUM"),0))
"RTN","EASMTL6A",70,0)
 ;
"RTN","EASMTL6A",71,0)
 I 'EAFIEN D  ; Print default signature block
"RTN","EASMTL6A",72,0)
 . N EAX,LINE
"RTN","EASMTL6A",73,0)
 . F EAX=1:1:9  D
"RTN","EASMTL6A",74,0)
 . . S LINE=$P($T(DEFSIG+EAX),";;",2)
"RTN","EASMTL6A",75,0)
 . . I LINE["|FAC|" W !?TAB,$P(LINE,"|FAC|",1),$S(EASFAC(100)]"":EASFAC(100),1:"VA Medical Center"),$P(LINE,"|FAC|",2) Q
"RTN","EASMTL6A",76,0)
 . . W !?TAB,LINE
"RTN","EASMTL6A",77,0)
 ;
"RTN","EASMTL6A",78,0)
 I EAFIEN D  ; Print division/facility signature block
"RTN","EASMTL6A",79,0)
 . S EALNE=0
"RTN","EASMTL6A",80,0)
 . F  S EALNE=$O(^EAS(713.3,EASLIEN,2,EAFIEN,1,EALNE)) Q:'EALNE  D
"RTN","EASMTL6A",81,0)
 . . W !?TAB,^EAS(713.3,EASLIEN,2,EAFIEN,1,EALNE,0)
"RTN","EASMTL6A",82,0)
 ;
"RTN","EASMTL6A",83,0)
 W !!?TAB,"Enclosure"
"RTN","EASMTL6A",84,0)
 Q
"RTN","EASMTL6A",85,0)
 ;
"RTN","EASMTL6A",86,0)
GETPAT(DFN,EASDEM,EASADD) ; Get patient information
"RTN","EASMTL6A",87,0)
 N VAROOT,VA
"RTN","EASMTL6A",88,0)
 ;
"RTN","EASMTL6A",89,0)
 ;; Patch 15, Generic test letter
"RTN","EASMTL6A",90,0)
 I DFN<0 D  Q
"RTN","EASMTL6A",91,0)
 . S EASDEM(2)="6789"
"RTN","EASMTL6A",92,0)
 . S EASDEM(5)="M"
"RTN","EASMTL6A",93,0)
 . S EASADD(1)="THIS IS A TEST LETTER STREET ADDRESS"
"RTN","EASMTL6A",94,0)
 . S EASADD(2)=""
"RTN","EASMTL6A",95,0)
 . S EASADD(4)="ANYTOWN"
"RTN","EASMTL6A",96,0)
 . S EASADD(5)="36^NEW YORK"
"RTN","EASMTL6A",97,0)
 . S EASADD(11)="111110000^11111-0000"
"RTN","EASMTL6A",98,0)
 ;; End patch 15
"RTN","EASMTL6A",99,0)
 ;
"RTN","EASMTL6A",100,0)
 S VAROOT="EASADD"
"RTN","EASMTL6A",101,0)
 D ADD^VADPT
"RTN","EASMTL6A",102,0)
 ;
"RTN","EASMTL6A",103,0)
 S VAROOT="EASDEM"
"RTN","EASMTL6A",104,0)
 D DEM^VADPT
"RTN","EASMTL6A",105,0)
 ;
"RTN","EASMTL6A",106,0)
 D PID^VADPT6
"RTN","EASMTL6A",107,0)
 S EASDEM(2)=VA("BID")
"RTN","EASMTL6A",108,0)
 Q
"RTN","EASMTL6A",109,0)
 ;
"RTN","EASMTL6A",110,0)
CHKADR(EASPTR) ; Check for valid address
"RTN","EASMTL6A",111,0)
 N EASADD,RSLT,DFN,VAROOT
"RTN","EASMTL6A",112,0)
 ;
"RTN","EASMTL6A",113,0)
 S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTL6A",114,0)
 S RSLT=1
"RTN","EASMTL6A",115,0)
 S VAROOT="EASADD"
"RTN","EASMTL6A",116,0)
 D ADD^VADPT
"RTN","EASMTL6A",117,0)
 ;; Check for valid mailing address
"RTN","EASMTL6A",118,0)
 I EASADD(1)]"",EASADD(4)]"",EASADD(5)]"",EASADD(11)]"" S RSLT=0
"RTN","EASMTL6A",119,0)
 D:RSLT ADRERR^EASMTUTL(.EASADD,DFN)
"RTN","EASMTL6A",120,0)
 Q $G(RSLT)
"RTN","EASMTL6A",121,0)
 ;
"RTN","EASMTL6A",122,0)
DEFSIG ; Default closing and signature block
"RTN","EASMTL6A",123,0)
 ;;Thank you for your assistance and cooperation.  If you have any
"RTN","EASMTL6A",124,0)
 ;;questions or need assistance in the completion of the information
"RTN","EASMTL6A",125,0)
 ;;requested, please contact the |FAC| Business 
"RTN","EASMTL6A",126,0)
 ;;Office between 8:00am and 4:00pm Monday through Friday.
"RTN","EASMTL6A",127,0)
 ;;
"RTN","EASMTL6A",128,0)
 ;;Sincerely,
"RTN","EASMTL6A",129,0)
 ;;
"RTN","EASMTL6A",130,0)
 ;;
"RTN","EASMTL6A",131,0)
 ;;
"RTN","EASMTL6B")
0^9^B1521524
"RTN","EASMTL6B",1,0)
EASMTL6B ;ALB/SCK - EAS QUEUED MEANS TEST LETTERS ; 2/25/02
"RTN","EASMTL6B",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,15**;MAR 15,2001
"RTN","EASMTL6B",3,0)
 ;
"RTN","EASMTL6B",4,0)
BCKJOB ;  Queued entry point for tasked letter printing
"RTN","EASMTL6B",5,0)
 N EATYP,EASMULT,EASKP,EASARY,EASTMP,EASPTR,DFN,EASPRF,EASDEV,EASPRM,EAX,EASTSK,EASERR,EADPTR,EATYP
"RTN","EASMTL6B",6,0)
 ;
"RTN","EASMTL6B",7,0)
 S EASTMP="^TMP(""EASMT"",$J)"
"RTN","EASMTL6B",8,0)
 K @EASTMP
"RTN","EASMTL6B",9,0)
 ;
"RTN","EASMTL6B",10,0)
 F EATYP=1,2,4 D
"RTN","EASMTL6B",11,0)
 . D BLD^EASMTL6(EATYP,0,EASTMP,.EASKP)
"RTN","EASMTL6B",12,0)
 . D RESULT^EASMTL6(.EASKP,EATYP)
"RTN","EASMTL6B",13,0)
 . Q:'$D(@EASTMP)
"RTN","EASMTL6B",14,0)
 . S EASIEN=0
"RTN","EASMTL6B",15,0)
 . F  S EASIEN=$O(@EASTMP@(EASIEN)) Q:'EASIEN  D
"RTN","EASMTL6B",16,0)
 . . D LETTER^EASMTL6A(EASIEN,EATYP)
"RTN","EASMTL6B",17,0)
 . . D UPDSTAT^EASMTL6(EASIEN,EATYP)
"RTN","EASMTL6B",18,0)
 . K @EASTMP
"RTN","EASMTL6B",19,0)
 ;
"RTN","EASMTL6B",20,0)
 Q
"RTN","EASMTL6B",21,0)
 ;
"RTN","EASMTL6B",22,0)
LTRTYP(EASIEN) ;  Function lookup for current pending letter type.
"RTN","EASMTL6B",23,0)
 ;  Input
"RTN","EASMTL6B",24,0)
 ;     EASIEN - IEN in the Letter status file, #713.2
"RTN","EASMTL6B",25,0)
 ;
"RTN","EASMTL6B",26,0)
 ;  Output
"RTN","EASMTL6B",27,0)
 ;     Current pending to print letter type
"RTN","EASMTL6B",28,0)
 ;        60-DAY = 1
"RTN","EASMTL6B",29,0)
 ;        30-DAY = 2
"RTN","EASMTL6B",30,0)
 ;         0-DAY = 4
"RTN","EASMTL6B",31,0)
 ;     Unable to determine = 0
"RTN","EASMTL6B",32,0)
 ;
"RTN","EASMTL6B",33,0)
 N RSLT
"RTN","EASMTL6B",34,0)
 ;
"RTN","EASMTL6B",35,0)
 S RSLT=0
"RTN","EASMTL6B",36,0)
 I $P($G(^EAS(713.2,EASIEN,"Z")),U,2) S RSLT=4
"RTN","EASMTL6B",37,0)
 I $P($G(^EAS(713.2,EASIEN,4)),U,2) S RSLT=2
"RTN","EASMTL6B",38,0)
 I $P($G(^EAS(713.2,EASIEN,6)),U,2) S RSLT=1
"RTN","EASMTL6B",39,0)
 Q $G(RSLT)
"RTN","EASMTPAR")
0^4^B2683703
"RTN","EASMTPAR",1,0)
EASMTPAR ; ALB/SCK - EAS MT PARAMETER ENTRY/EDIT ; 11/9/01
"RTN","EASMTPAR",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,15**;MAR 15,2001
"RTN","EASMTPAR",3,0)
 ;
"RTN","EASMTPAR",4,0)
WR ;  Write current parameters
"RTN","EASMTPAR",5,0)
 N EANODE,U,EASHD,LINE,SPACE,EAX,TAB,TAB2,IOP,EDT,DIRUT
"RTN","EASMTPAR",6,0)
 ;
"RTN","EASMTPAR",7,0)
 S U="^",IOP="HOME",TAB=5,TAB2=43
"RTN","EASMTPAR",8,0)
 D ^%ZIS K IOP
"RTN","EASMTPAR",9,0)
 ;
"RTN","EASMTPAR",10,0)
 S EASHD="EAS MEANS TEST LETTERS PARAMETER ENTRY/EDIT"
"RTN","EASMTPAR",11,0)
 S SPACE=(IOM-$L(EASHD))/2
"RTN","EASMTPAR",12,0)
 S $P(LINE,"=",IOM)=""
"RTN","EASMTPAR",13,0)
 ;
"RTN","EASMTPAR",14,0)
 W @IOF,!?SPACE,EASHD,!,LINE
"RTN","EASMTPAR",15,0)
 ;
"RTN","EASMTPAR",16,0)
 S EANODE=$G(^EAS(713,1,0))
"RTN","EASMTPAR",17,0)
 W !!,"[1]",?TAB,"Parameters"
"RTN","EASMTPAR",18,0)
 W !?TAB,"Primary Print Device:",?TAB2,": "
"RTN","EASMTPAR",19,0)
 I +$P($G(EANODE),U,5) W $$GET1^DIQ(3.5,$P(EANODE,U,5),.01)
"RTN","EASMTPAR",20,0)
 W !?TAB,"Allow Filtering by Location?",?TAB2,": ",$S($P(EANODE,U,8):"YES",1:"NO")
"RTN","EASMTPAR",21,0)
 W !?TAB,"Send Means Test Completion Notice?",?TAB2,": ",$S($P(EANODE,U,7):"YES",1:"NO")
"RTN","EASMTPAR",22,0)
 W !?TAB,"Envelope Offset",?TAB2,": ",+$$GET1^DIQ(713,1,10)
"RTN","EASMTPAR",23,0)
 W !?TAB,"Allow Alternate Return Address?",?TAB2,": ",$S($P(EANODE,U,9):"YES",1:"NO")
"RTN","EASMTPAR",24,0)
 ;
"RTN","EASMTPAR",25,0)
 S DIR(0)="YAO",DIR("A")="Edit Parameters? ",DIR("B")="YES",DIR("A",1)=""
"RTN","EASMTPAR",26,0)
 D ^DIR K DIR
"RTN","EASMTPAR",27,0)
 Q:$D(DIRUT)!('Y)
"RTN","EASMTPAR",28,0)
 I Y D EDT
"RTN","EASMTPAR",29,0)
 G WR
"RTN","EASMTPAR",30,0)
 Q
"RTN","EASMTPAR",31,0)
 ;
"RTN","EASMTPAR",32,0)
EDT ; Edit parameter set 1
"RTN","EASMTPAR",33,0)
 N DIE,DA,DR
"RTN","EASMTPAR",34,0)
 ;
"RTN","EASMTPAR",35,0)
 S DIE="^EAS(713,",DA=1
"RTN","EASMTPAR",36,0)
 S DR="5;8;7;10;9"
"RTN","EASMTPAR",37,0)
 D ^DIE K DIE
"RTN","EASMTPAR",38,0)
 Q
"RTN","EASMTRP2")
0^10^B11447149
"RTN","EASMTRP2",1,0)
EASMTRP2 ; ALB/SCK - MEANS TEST REPORTS 2 ; 2/19/02
"RTN","EASMTRP2",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,15**;MAR 15,2001
"RTN","EASMTRP2",3,0)
 ;
"RTN","EASMTRP2",4,0)
QUE ; Que pending letter count (letters flagged to print)
"RTN","EASMTRP2",5,0)
 N ZTSAVE,DIR,EASUM
"RTN","EASMTRP2",6,0)
 ;
"RTN","EASMTRP2",7,0)
 S DIR(0)="YAO",DIR("A")="Print Summary Only? ",DIR("B")="YES"
"RTN","EASMTRP2",8,0)
 S DIR("?")="'YES' will print a summary total only, 'NO' will print the summary and a detail listing by scheduled print date"
"RTN","EASMTRP2",9,0)
 D ^DIR K DIR
"RTN","EASMTRP2",10,0)
 Q:$D(DIRUT)
"RTN","EASMTRP2",11,0)
 S EASUM=+Y
"RTN","EASMTRP2",12,0)
 S ZTSAVE("EASUM")=""
"RTN","EASMTRP2",13,0)
 D EN^XUTMDEVQ("PEND^EASMTRP2","EAS LETTERS DETAILED PENDING REPORT",.ZTSAVE)
"RTN","EASMTRP2",14,0)
 Q
"RTN","EASMTRP2",15,0)
PEND ; Print report
"RTN","EASMTRP2",16,0)
 N CNT,EASIEN,PCNT,RCNT,EASX,TOT,PAGE,EAS0,EAS4,EAS6,EASPDT,EAX,TOTALS
"RTN","EASMTRP2",17,0)
 ;
"RTN","EASMTRP2",18,0)
 K ^TMP("EASPND",$J)
"RTN","EASMTRP2",19,0)
 ;
"RTN","EASMTRP2",20,0)
 F EAX=0,30,60 S TOTALS(EAX)=0
"RTN","EASMTRP2",21,0)
 S EASIEN=0
"RTN","EASMTRP2",22,0)
 F  S EASIEN=$O(^EAS(713.2,"AC",0,EASIEN)) Q:'EASIEN  D
"RTN","EASMTRP2",23,0)
 . I $P($G(^EAS(713.2,EASIEN,"Z")),U,2) D  Q
"RTN","EASMTRP2",24,0)
 . . S EAS0=$P($G(^EAS(713.2,EASIEN,"Z")),U,1)
"RTN","EASMTRP2",25,0)
 . . S ^TMP("EASPND",$J,EAS0,0)=$G(^TMP("EASPND",$J,EAS0,0))+1
"RTN","EASMTRP2",26,0)
 . . S TOTALS(0)=TOTALS(0)+1
"RTN","EASMTRP2",27,0)
 . ;
"RTN","EASMTRP2",28,0)
 . I $P($G(^EAS(713.2,EASIEN,4)),U,2) D  Q
"RTN","EASMTRP2",29,0)
 . . S EAS4=$P($G(^EAS(713.2,EASIEN,4)),U,1)
"RTN","EASMTRP2",30,0)
 . . S ^TMP("EASPND",$J,EAS4,4)=$G(^TMP("EASPND",$J,EAS4,4))+1
"RTN","EASMTRP2",31,0)
 . . S TOTALS(30)=TOTALS(30)+1
"RTN","EASMTRP2",32,0)
 . ;
"RTN","EASMTRP2",33,0)
 . I $P($G(^EAS(713.2,EASIEN,6)),U,2) D
"RTN","EASMTRP2",34,0)
 . . S EAS6=$P($G(^EAS(713.2,EASIEN,6)),U,1)
"RTN","EASMTRP2",35,0)
 . . S ^TMP("EASPND",$J,EAS6,6)=$G(^TMP("EASPND",$J,EAS6,6))+1
"RTN","EASMTRP2",36,0)
 . . S TOTALS(60)=TOTALS(60)+1
"RTN","EASMTRP2",37,0)
 ;;
"RTN","EASMTRP2",38,0)
 D HDR1
"RTN","EASMTRP2",39,0)
 I 'EASUM,$E(IOST,1,2)="C-" D  Q:$D(DUOUT)
"RTN","EASMTRP2",40,0)
 . S DIR(0)="FAO",DIR("A")="Press any key to continue..."
"RTN","EASMTRP2",41,0)
 . D ^DIR K DIR
"RTN","EASMTRP2",42,0)
 . Q:$D(DUOUT)
"RTN","EASMTRP2",43,0)
 ;
"RTN","EASMTRP2",44,0)
 D:'EASUM DETAIL
"RTN","EASMTRP2",45,0)
 Q
"RTN","EASMTRP2",46,0)
 ;
"RTN","EASMTRP2",47,0)
DETAIL ;
"RTN","EASMTRP2",48,0)
 N EASPDT,DIRUT
"RTN","EASMTRP2",49,0)
 ;
"RTN","EASMTRP2",50,0)
 D HDR
"RTN","EASMTRP2",51,0)
 S EASPDT=0
"RTN","EASMTRP2",52,0)
 F  S EASPDT=$O(^TMP("EASPND",$J,EASPDT)) Q:'EASPDT  D  Q:$D(DIRUT)
"RTN","EASMTRP2",53,0)
 . I ($Y+4)>IOSL D
"RTN","EASMTRP2",54,0)
 . . S DIR(0)="E"
"RTN","EASMTRP2",55,0)
 . . D ^DIR K DIR
"RTN","EASMTRP2",56,0)
 . . Q:$D(DIRUT)
"RTN","EASMTRP2",57,0)
 . . D HDR
"RTN","EASMTRP2",58,0)
 . W !?4,$$FMTE^XLFDT(EASPDT),?20
"RTN","EASMTRP2",59,0)
 . S TOT=0
"RTN","EASMTRP2",60,0)
 . F EAX=6,4,0 D
"RTN","EASMTRP2",61,0)
 . . S CNT=$G(^TMP("EASPND",$J,EASPDT,EAX))
"RTN","EASMTRP2",62,0)
 . . W $J(+CNT,6),"    "
"RTN","EASMTRP2",63,0)
 . . S TOT=$G(TOT)+(+CNT)
"RTN","EASMTRP2",64,0)
 . W $J(TOT,8)
"RTN","EASMTRP2",65,0)
 ;
"RTN","EASMTRP2",66,0)
 K ^TMP("EASPND",$J)
"RTN","EASMTRP2",67,0)
 Q
"RTN","EASMTRP2",68,0)
 ;
"RTN","EASMTRP2",69,0)
HDR1 ;
"RTN","EASMTRP2",70,0)
 N TAB,LINE,DASH
"RTN","EASMTRP2",71,0)
 ;
"RTN","EASMTRP2",72,0)
 W @IOF
"RTN","EASMTRP2",73,0)
 S LINE(1)="Count of Letters Pending to Print (Flag to Print marked 'YES')"
"RTN","EASMTRP2",74,0)
 S LINE(2)="Printed: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","EASMTRP2",75,0)
 S LINE(60)="60-Day letters flagged to print:    "_$FN(TOTALS(60),",")
"RTN","EASMTRP2",76,0)
 S LINE(30)="30-Day letters flagged to print:    "_$FN(TOTALS(30),",")
"RTN","EASMTRP2",77,0)
 S LINE(0)=" 0-Day letters flagged to print:    "_$FN(TOTALS(0),",")
"RTN","EASMTRP2",78,0)
 ;
"RTN","EASMTRP2",79,0)
 S TAB=(IOM-$L(LINE(1)))/2
"RTN","EASMTRP2",80,0)
 W !?TAB,LINE(1)
"RTN","EASMTRP2",81,0)
 W !?TAB,LINE(2)
"RTN","EASMTRP2",82,0)
 S $P(DASH,"=",IOM)=""
"RTN","EASMTRP2",83,0)
 W !,DASH
"RTN","EASMTRP2",84,0)
 ;
"RTN","EASMTRP2",85,0)
 F EAX=60,30,0 D
"RTN","EASMTRP2",86,0)
 . S TAB=(IOM-$L(LINE(EAX)))/2
"RTN","EASMTRP2",87,0)
 . W !?TAB,LINE(EAX)
"RTN","EASMTRP2",88,0)
 Q
"RTN","EASMTRP2",89,0)
 ;
"RTN","EASMTRP2",90,0)
HDR ;
"RTN","EASMTRP2",91,0)
 N TAB,LINE
"RTN","EASMTRP2",92,0)
 ;
"RTN","EASMTRP2",93,0)
 W @IOF
"RTN","EASMTRP2",94,0)
 W !,"Detailed List of Letters Flagged to Print"
"RTN","EASMTRP2",95,0)
 W !,"Printed: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","EASMTRP2",96,0)
 S PAGE=$G(PAGE)+1
"RTN","EASMTRP2",97,0)
 S TAB=IOM-8
"RTN","EASMTRP2",98,0)
 W ?TAB,"PAGE: ",PAGE
"RTN","EASMTRP2",99,0)
 W !!?4,"Sched. Date",?20,"60-Day","    ","30-Day","    "," 0-day","    ","   TOTAL"
"RTN","EASMTRP2",100,0)
 S $P(LINE,"=",IOM)="" W !,LINE
"RTN","EASMTRP2",101,0)
 Q
"RTN","EASMTRP3")
0^1^B16609567
"RTN","EASMTRP3",1,0)
EASMTRP3 ; ALB/SCK - MEANS TEST ANV DATES BY APPT DATE ; 6/6/2002
"RTN","EASMTRP3",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,15**;MAR 15,2001
"RTN","EASMTRP3",3,0)
 ;
"RTN","EASMTRP3",4,0)
QUE ;  Que off the appointment list search by MT anniversary date
"RTN","EASMTRP3",5,0)
 N EASDT,ZTSAVE
"RTN","EASMTRP3",6,0)
 ;
"RTN","EASMTRP3",7,0)
 S DIR(0)="DAO^DT::EX"
"RTN","EASMTRP3",8,0)
 S DIR("B")="TODAY",DIR("A")="Run report for date: ",DIR("?")="^D HELP^%DTC"
"RTN","EASMTRP3",9,0)
 D ^DIR K DIR
"RTN","EASMTRP3",10,0)
 Q:$D(DIRUT)
"RTN","EASMTRP3",11,0)
 S EASDT=Y
"RTN","EASMTRP3",12,0)
 ;
"RTN","EASMTRP3",13,0)
 S ZTSAVE("EASDT")=""
"RTN","EASMTRP3",14,0)
 D EN^XUTMDEVQ("EN^EASMTRP3","EAS MT DUE BY APPOINTMENT RPT",.ZTSAVE)
"RTN","EASMTRP3",15,0)
 Q
"RTN","EASMTRP3",16,0)
 ;
"RTN","EASMTRP3",17,0)
EN ;  Main entry point for appointment list by MT anniversary date
"RTN","EASMTRP3",18,0)
 N EASSC,EASSD,EASEND,PAGE
"RTN","EASMTRP3",19,0)
 ;
"RTN","EASMTRP3",20,0)
 K ^TMP("EASAP",$J)
"RTN","EASMTRP3",21,0)
 ;
"RTN","EASMTRP3",22,0)
 S PAGE=1
"RTN","EASMTRP3",23,0)
 S ^TMP("EASAP",$J,"APDT")=EASDT
"RTN","EASMTRP3",24,0)
 S EASSD=0
"RTN","EASMTRP3",25,0)
 F  S EASSD=$O(^SC("B",EASSD)) Q:EASSD']""!($G(EASEND))  D CLN(EASSD,EASDT)
"RTN","EASMTRP3",26,0)
 D PRINT
"RTN","EASMTRP3",27,0)
 Q
"RTN","EASMTRP3",28,0)
 ;
"RTN","EASMTRP3",29,0)
CLN(EASSD,EASDT) ;  Loop through clinics looking for appointments
"RTN","EASMTRP3",30,0)
 N EASSC ; Clinic IEN
"RTN","EASMTRP3",31,0)
 ;
"RTN","EASMTRP3",32,0)
 S EASSC=0
"RTN","EASMTRP3",33,0)
 F  S EASSC=$O(^SC("B",EASSD,EASSC)) Q:'EASSC>0!$G(EASEND)  D
"RTN","EASMTRP3",34,0)
 . I $D(^SC(EASSC,0)),$P(^(0),"^",3)="C" D LOOP(EASSC,EASDT)  ; Quit if location is not a clinic
"RTN","EASMTRP3",35,0)
 Q
"RTN","EASMTRP3",36,0)
 ;
"RTN","EASMTRP3",37,0)
LOOP(EASSC,EASDT) ; Loop through a clinic's appointment list
"RTN","EASMTRP3",38,0)
 N EAX,EAX1,SDT,DFN,EASANV
"RTN","EASMTRP3",39,0)
 ;
"RTN","EASMTRP3",40,0)
 S EAX=0
"RTN","EASMTRP3",41,0)
 F SDT=EASDT:0 S SDT=$O(^SC(EASSC,"S",SDT)) Q:'SDT!(SDT\1-EASDT)  D
"RTN","EASMTRP3",42,0)
 . F EAX1=0:0 S EAX1=$O(^SC(EASSC,"S",SDT,1,EAX1)) Q:'EAX1  D
"RTN","EASMTRP3",43,0)
 . . Q:$P(^SC(EASSC,"S",SDT,1,EAX1,0),"^",9)["C"  ; Quit if appointment is cancelled
"RTN","EASMTRP3",44,0)
 . . S DFN=$P($G(^SC(EASSC,"S",SDT,1,EAX1,0)),"^",1)
"RTN","EASMTRP3",45,0)
 . . S LASTMT=$$LST^DGMTU(DFN)  ; Get patient's last Means test
"RTN","EASMTRP3",46,0)
 . . Q:"N,P"[$P(LASTMT,U,4)  ; Quit if means test is no longer required or pending
"RTN","EASMTRP3",47,0)
 . . I $P(LASTMT,U,4)="C",$$GET1^DIQ(408.31,+LASTMT,.11,"I"),$P(LASTMT,U,2)>2991005 Q  ; Quit if veteran is Cat C, agreed to pay deductible and last MT was later than Oct 5, 1999
"RTN","EASMTRP3",48,0)
 . . Q:$$FUT^DGMTU(DFN)  ; Quit if future MT is on file
"RTN","EASMTRP3",49,0)
 . . S EASANV=$$FMADD^XLFDT($P(LASTMT,U,2),365)
"RTN","EASMTRP3",50,0)
 . . I EASDT'<EASANV D  ; If appt dt is later than anniversary dt, add veteran to list.
"RTN","EASMTRP3",51,0)
 . . . S ^TMP("EASAP",$J,"CLN",EASSC,DFN,SDT)=""
"RTN","EASMTRP3",52,0)
 Q
"RTN","EASMTRP3",53,0)
 ;
"RTN","EASMTRP3",54,0)
PRINT ;  Print Report
"RTN","EASMTRP3",55,0)
 N EACLN,DFN,LASTMT,VA,ANVDT,PAGE,EASABRT,APDT,XX
"RTN","EASMTRP3",56,0)
 ;
"RTN","EASMTRP3",57,0)
 I '$D(^TMP("EASAP",$J,"CLN")) D  Q
"RTN","EASMTRP3",58,0)
 . S PAGE=1 S XX=$$HDR("")
"RTN","EASMTRP3",59,0)
 . W !!?3,"No MT Anniversary dates found for this appointment date."
"RTN","EASMTRP3",60,0)
 ;
"RTN","EASMTRP3",61,0)
 W !
"RTN","EASMTRP3",62,0)
 S EACLN=0
"RTN","EASMTRP3",63,0)
 F  S EACLN=$O(^TMP("EASAP",$J,"CLN",EACLN)) Q:'EACLN  D  Q:$G(EASABRT)
"RTN","EASMTRP3",64,0)
 . S PAGE=1 S EASABRT=$$HDR(EACLN) Q:$G(EASABRT)
"RTN","EASMTRP3",65,0)
 . S DFN=0
"RTN","EASMTRP3",66,0)
 . F  S DFN=$O(^TMP("EASAP",$J,"CLN",EACLN,DFN)) Q:'DFN  D  Q:$G(EASABRT)
"RTN","EASMTRP3",67,0)
 . . S ANVDT=$P($$LST^DGMTU(DFN),U,2)
"RTN","EASMTRP3",68,0)
 . . I ANVDT>0 S ANVDT=$$FMADD^XLFDT(ANVDT,365)
"RTN","EASMTRP3",69,0)
 . . W !?3,$$GET1^DIQ(2,DFN,.01)
"RTN","EASMTRP3",70,0)
 . . D PID^VADPT6
"RTN","EASMTRP3",71,0)
 . . W ?30,VA("BID") K VA
"RTN","EASMTRP3",72,0)
 . . W ?38,$S(ANVDT>0:$$FMTE^XLFDT(ANVDT),1:"")
"RTN","EASMTRP3",73,0)
 . . S APDT=0
"RTN","EASMTRP3",74,0)
 . . F  S APDT=$O(^TMP("EASAP",$J,"CLN",EACLN,DFN,APDT)) Q:'APDT  D  Q:$G(EASABRT)
"RTN","EASMTRP3",75,0)
 . . . W ?55,$$FMTE^XLFDT(APDT,"2P"),!
"RTN","EASMTRP3",76,0)
 . . . I ($Y+5)>IOSL S EASABRT=$$HDR(EASCLN)
"RTN","EASMTRP3",77,0)
 ;
"RTN","EASMTRP3",78,0)
 Q
"RTN","EASMTRP3",79,0)
 ;
"RTN","EASMTRP3",80,0)
HDR(EASCLN) ; Report Header
"RTN","EASMTRP3",81,0)
 N TAB,LINE,CLINIC,RSLT
"RTN","EASMTRP3",82,0)
 ;
"RTN","EASMTRP3",83,0)
 S RSLT=0
"RTN","EASMTRP3",84,0)
 I $E(IOST,1,2)="C-" D  I RSLT Q RSLT
"RTN","EASMTRP3",85,0)
 . S DIR(0)="E"
"RTN","EASMTRP3",86,0)
 . D ^DIR K DIR
"RTN","EASMTRP3",87,0)
 . I 'Y S RSLT=1
"RTN","EASMTRP3",88,0)
 ;
"RTN","EASMTRP3",89,0)
 W @IOF
"RTN","EASMTRP3",90,0)
 S CLINIC=$S(EASCLN>0:$$GET1^DIQ(44,EASCLN,.01),1:"")
"RTN","EASMTRP3",91,0)
 W "Means Test Expiration Report by Appt Date "_$S(CLINIC]"":"for "_CLINIC,1:"")
"RTN","EASMTRP3",92,0)
 W !!,"For Appointment Date: ",$$FMTE^XLFDT(^TMP("EASAP",$J,"APDT"))
"RTN","EASMTRP3",93,0)
 W !,"Print Date: ",$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","EASMTRP3",94,0)
 S TAB=IOM-10
"RTN","EASMTRP3",95,0)
 W ?TAB,"Page "_PAGE
"RTN","EASMTRP3",96,0)
 S PAGE=PAGE+1
"RTN","EASMTRP3",97,0)
 ;
"RTN","EASMTRP3",98,0)
 W !!?30,"Last",?38,"Anniversary",?55,"Appointment"
"RTN","EASMTRP3",99,0)
 W !?3,"Name",?30,"Four",?38,"Date",?55,"Time"
"RTN","EASMTRP3",100,0)
 S $P(LINE,"=",IOM)="" W !,LINE,!
"RTN","EASMTRP3",101,0)
 ;
"RTN","EASMTRP3",102,0)
 Q 0
"RTN","EASMTRP3",103,0)
 ;
"RTN","EASMTRP3",104,0)
PAUSE ;
"RTN","EASMTRP3",105,0)
 Q
"RTN","EASMTRPT")
0^12^B56616937
"RTN","EASMTRPT",1,0)
EASMTRPT ; MIN/TCM ALB/SCK - AUTOMATED MEANS TEST LETTERS REPORTS ; 7/6/01
"RTN","EASMTRPT",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,12,15**;MAR 15,2001
"RTN","EASMTRPT",3,0)
 ;
"RTN","EASMTRPT",4,0)
UNRTN ;  Unreturned letters report
"RTN","EASMTRPT",5,0)
 N EASN,CTR,EASNODE,TOT,EAS6,EASIEN,EAX
"RTN","EASMTRPT",6,0)
 ;
"RTN","EASMTRPT",7,0)
 W @IOF
"RTN","EASMTRPT",8,0)
 D WAIT^DICD
"RTN","EASMTRPT",9,0)
 ;
"RTN","EASMTRPT",10,0)
 F EAX=0,30,60 S CTR(EAX)=0
"RTN","EASMTRPT",11,0)
 ;
"RTN","EASMTRPT",12,0)
 S EASIEN=0
"RTN","EASMTRPT",13,0)
 F  S EASIEN=$O(^EAS(713.2,"AC",0,EASIEN)) Q:'EASIEN  D
"RTN","EASMTRPT",14,0)
 . I $P($G(^EAS(713.2,EASIEN,"Z")),U,3) S CTR(0)=CTR(0)+1 Q
"RTN","EASMTRPT",15,0)
 . I $P($G(^EAS(713.2,EASIEN,4)),U,3) S CTR(30)=CTR(30)+1 Q
"RTN","EASMTRPT",16,0)
 . I $P($G(^EAS(713.2,EASIEN,6)),U,3) S CTR(60)=CTR(60)+1 Q
"RTN","EASMTRPT",17,0)
PRT1 ;
"RTN","EASMTRPT",18,0)
 W !!,$CHAR(7),"Summary of Most Recent Unreturned Means Test Letters"
"RTN","EASMTRPT",19,0)
 ;
"RTN","EASMTRPT",20,0)
 W !!,"60-day letters printed: ",$J(CTR(60),6)
"RTN","EASMTRPT",21,0)
 W !!,"30-day letters printed: ",$J(CTR(30),6)
"RTN","EASMTRPT",22,0)
 W !!," 0-day letters printed: ",$J(CTR(0),6)
"RTN","EASMTRPT",23,0)
 W !,"=============================="
"RTN","EASMTRPT",24,0)
 S TOT=CTR(60)+CTR(30)+CTR(0)
"RTN","EASMTRPT",25,0)
 W !!,"                 Total: ",$J(TOT,6)
"RTN","EASMTRPT",26,0)
 ;
"RTN","EASMTRPT",27,0)
 W !!
"RTN","EASMTRPT",28,0)
 D PAUSE^EASMTUTL
"RTN","EASMTRPT",29,0)
 ;
"RTN","EASMTRPT",30,0)
 Q
"RTN","EASMTRPT",31,0)
 ;
"RTN","EASMTRPT",32,0)
LTRSTAT ; Means Test Letter Statistics Report
"RTN","EASMTRPT",33,0)
 N EASDT,EASB,EASE,ZTSAVE
"RTN","EASMTRPT",34,0)
 ;
"RTN","EASMTRPT",35,0)
 S EASDT=$$ASK("Processing")
"RTN","EASMTRPT",36,0)
 Q:'EASDT
"RTN","EASMTRPT",37,0)
 ;
"RTN","EASMTRPT",38,0)
 S EASB=$P(EASDT,U,1),EASE=$P(EASDT,U,2)
"RTN","EASMTRPT",39,0)
 S ZTSAVE("EASB")="",ZTSAVE("EASE")=""
"RTN","EASMTRPT",40,0)
 ;
"RTN","EASMTRPT",41,0)
 D EN^XUTMDEVQ("QUE2^EASMTRPT","EAS MT LETTER STATISTICS REPORT",.ZTSAVE)
"RTN","EASMTRPT",42,0)
 Q
"RTN","EASMTRPT",43,0)
 ;
"RTN","EASMTRPT",44,0)
QUE2 ; Queued entry point for letters statistics
"RTN","EASMTRPT",45,0)
 N EAYTOT,EAYRTN,EAPRHB,EAS1,EASX,EAX,EASCMT,EAIEN
"RTN","EASMTRPT",46,0)
 ;
"RTN","EASMTRPT",47,0)
 ; Begin search Letter Status File, #713.2
"RTN","EASMTRPT",48,0)
 ; Set counters
"RTN","EASMTRPT",49,0)
 S EAPRHB=0
"RTN","EASMTRPT",50,0)
 F EASX=0,30,60 S EAYTOT(EASX)=0
"RTN","EASMTRPT",51,0)
 F EASX="AG","OTR","OWN","FUT" S EAYRTN(EASX)=0
"RTN","EASMTRPT",52,0)
 ;
"RTN","EASMTRPT",53,0)
 S EAS1=$$FMADD^XLFDT(EASB,"","","",-1)
"RTN","EASMTRPT",54,0)
 F  S EAS1=$O(^EAS(713.2,"B",EAS1)) Q:'EAS1!(EAS1>EASE)  D
"RTN","EASMTRPT",55,0)
 . S EAIEN=0
"RTN","EASMTRPT",56,0)
 . F  S EAIEN=$O(^EAS(713.2,"B",EAS1,EAIEN)) Q:'EAIEN  D
"RTN","EASMTRPT",57,0)
 . . I $P($G(^EAS(713.2,EAIEN,"Z")),U,3) S EAYTOT(0)=EAYTOT(0)+1
"RTN","EASMTRPT",58,0)
 . . I $P($G(^EAS(713.2,EAIEN,4)),U,3) S EAYTOT(30)=EAYTOT(30)+1
"RTN","EASMTRPT",59,0)
 . . I $P($G(^EAS(713.2,EAIEN,6)),U,3) S EAYTOT(60)=EAYTOT(60)+1
"RTN","EASMTRPT",60,0)
 . . D INCPRHB(EAIEN,.EAPRHB)
"RTN","EASMTRPT",61,0)
 . . I $P(^EAS(713.2,EAIEN,0),U,4) D
"RTN","EASMTRPT",62,0)
 . . . K EASCMT
"RTN","EASMTRPT",63,0)
 . . . S EAX=$$GET1^DIQ(713.2,EAIEN,7,"","EASCMT")
"RTN","EASMTRPT",64,0)
 . . . I $G(EASCMT(1))["AUTO-GENERATED" S EAYRTN("AG")=EAYRTN("AG")+1 Q
"RTN","EASMTRPT",65,0)
 . . . I $G(EASCMT(1))["'OWNED'" S EAYRTN("OWN")=EAYRTN("OWN")+1 Q
"RTN","EASMTRPT",66,0)
 . . . I $G(EASCMT(1))["FUTURE MEANS TEST" S EAYRTN("FUT")=EAYRTN("FUT")+1 Q
"RTN","EASMTRPT",67,0)
 . . . S EAYRTN("OTR")=EAYRTN("OTR")+1
"RTN","EASMTRPT",68,0)
 ;
"RTN","EASMTRPT",69,0)
PRT2 ;
"RTN","EASMTRPT",70,0)
 N LINE,TAB
"RTN","EASMTRPT",71,0)
 ;
"RTN","EASMTRPT",72,0)
 W @IOF
"RTN","EASMTRPT",73,0)
 W !,"MEANS TEST LETTERS STATISTIC REPORT"
"RTN","EASMTRPT",74,0)
 W !,"Letter Processing Date Range: ",$$FMTE^XLFDT(EASB)," thru ",$$FMTE^XLFDT(EASE)
"RTN","EASMTRPT",75,0)
 W !,"Print Date: ",$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","EASMTRPT",76,0)
 ;
"RTN","EASMTRPT",77,0)
 W !!,"Letter type:",?25,"60-day",?35,"30-day",?45,"0-day",?55,"Totals"
"RTN","EASMTRPT",78,0)
 S $P(LINE,"=",IOM)="" W !,LINE
"RTN","EASMTRPT",79,0)
 ;
"RTN","EASMTRPT",80,0)
 W !!,"Letters printed:"
"RTN","EASMTRPT",81,0)
 W ?25,EAYTOT(60),?35,EAYTOT(30),?45,EAYTOT(0)
"RTN","EASMTRPT",82,0)
 W ?55,EAYTOT(60)+EAYTOT(30)+EAYTOT(0)
"RTN","EASMTRPT",83,0)
 ;
"RTN","EASMTRPT",84,0)
 W !!,"Means Test returned Totals"
"RTN","EASMTRPT",85,0)
 W !,"           AUTO-GENERATED:",?35,$FN(EAYRTN("AG"),",")
"RTN","EASMTRPT",86,0)
 W !,"                Future MT:",?35,$FN(EAYRTN("FUT"),",")
"RTN","EASMTRPT",87,0)
 W !,"      Owned by Other Site:",?35,$FN(EAYRTN("OWN"),",")
"RTN","EASMTRPT",88,0)
 W !,"      Returned by Veteran:",?35,$FN(EAYRTN("OTR"),",")
"RTN","EASMTRPT",89,0)
 W !,"                    Total:",?35,$FN(EAYRTN("AG")+EAYRTN("OWN")+EAYRTN("OTR")+EAYRTN("FUT"),",")
"RTN","EASMTRPT",90,0)
 W !!,"Count of patient records set to prohibit letter during date range: ",$G(EAPRHB)
"RTN","EASMTRPT",91,0)
 I $E(IOST,1,2)="C-" D PAUSE^EASMTUTL
"RTN","EASMTRPT",92,0)
 Q
"RTN","EASMTRPT",93,0)
 ;
"RTN","EASMTRPT",94,0)
SUMMRY ;  Automated MT Ltrs Summary
"RTN","EASMTRPT",95,0)
 N SDATE,EDATE,EASDT,SDISP,EDISP,EAX
"RTN","EASMTRPT",96,0)
 ;
"RTN","EASMTRPT",97,0)
 S EASDT=$$ASK("Processing")
"RTN","EASMTRPT",98,0)
 Q:'EASDT
"RTN","EASMTRPT",99,0)
 S (SDATE,SDISP)=$P(EASDT,U)
"RTN","EASMTRPT",100,0)
 S (EDATE,EDISP)=$P(EASDT,U,2)
"RTN","EASMTRPT",101,0)
 S SDATE=$$FMADD^XLFDT(SDATE,"","","",-1)
"RTN","EASMTRPT",102,0)
 S ZTSAVE("SDATE")="",ZTSAVE("EDATE")="",ZTSAVE("SDISP")="",ZTSAVE("EDISP")=""
"RTN","EASMTRPT",103,0)
 W !!,$CHAR(7),"A 132-Column printer is required for this report"
"RTN","EASMTRPT",104,0)
 D EN^XUTMDEVQ("QUE3^EASMTRPT","EAS MT PROCESSING SUMMARY REPORT",.ZTSAVE)
"RTN","EASMTRPT",105,0)
 Q
"RTN","EASMTRPT",106,0)
 ;
"RTN","EASMTRPT",107,0)
QUE3 ;  PROCESSING SUMMARY REPORT
"RTN","EASMTRPT",108,0)
 N EASN,EASIEN,EANODE,EALNE,EATYP,PAGE,EASABRT,COL,EAWP,WP
"RTN","EASMTRPT",109,0)
 N COL1,COL2,COL3,COL4,COL5,COL6,COL7,COL8,COL9
"RTN","EASMTRPT",110,0)
 ;
"RTN","EASMTRPT",111,0)
 S COL1=0,COL2=10,COL3=50,COL4=63,COL5=73,COL6=84,COL7=95,COL8=108,COL9=120
"RTN","EASMTRPT",112,0)
 S PAGE=1
"RTN","EASMTRPT",113,0)
 D HDR("AUTOMATED MT LETTERS SUMMARY",SDISP,EDISP)
"RTN","EASMTRPT",114,0)
 ;
"RTN","EASMTRPT",115,0)
 W !!,"Entry",?COL2,"Patient",?COL3,"Means Test",?COL4,"Letter",?COL5,"Print",?COL6,"Flag to",?COL7,"Letter",?COL8,"Print",?COL9,"Prohibit"
"RTN","EASMTRPT",116,0)
 W !,?COL3,"Date",?COL4,"Type",?COL5,"Date",?COL6,"Print",?COL7,"Printed?",?COL8,"Date",?COL9,"Flag?",!
"RTN","EASMTRPT",117,0)
 ;
"RTN","EASMTRPT",118,0)
 S EASN=SDATE
"RTN","EASMTRPT",119,0)
 F  S EASN=$O(^EAS(713.2,"AD",EASN)) Q:'EASN!(EASN>EDATE)  D  Q:$G(EASABRT)
"RTN","EASMTRPT",120,0)
 . S EASIEN=0
"RTN","EASMTRPT",121,0)
 . F  S EASIEN=$O(^EAS(713.2,"AD",EASN,EASIEN)) Q:'EASIEN  D  Q:$G(EASABRT)
"RTN","EASMTRPT",122,0)
 . . K EANODE0 S EANODE0=$G(^EAS(713.2,EASIEN,0))
"RTN","EASMTRPT",123,0)
 . . W !,EASIEN,?COL2,$E($$GET1^DIQ(713.2,EASIEN,2),1,25)_" ("_$$LAST4($P(EANODE0,U,2))_")"
"RTN","EASMTRPT",124,0)
 . . I $$DECEASED^EASMTUTL(EASIEN) W " *D*"
"RTN","EASMTRPT",125,0)
 . . W ?COL3,$$FMTE^XLFDT($P(EANODE0,U,3),"2D")
"RTN","EASMTRPT",126,0)
 . . K EANODE6 S EANODE6=$G(^EAS(713.2,EASIEN,6))
"RTN","EASMTRPT",127,0)
 . . W ?COL4,"60-Day",?COL5,$$FMTE^XLFDT($P(EANODE6,U,1),"2D"),?COL6,$S($P(EANODE6,U,2)=1:"YES",1:"NO")
"RTN","EASMTRPT",128,0)
 . . W ?COL7,$S($P(EANODE6,U,3)=1:"YES",1:"NO"),?COL8,$$FMTE^XLFDT($P(EANODE6,U,4),"2D"),?COL9
"RTN","EASMTRPT",129,0)
 . . I $D(^EAS(713.1,"AP",1,$P(EANODE0,U,2))) W "YES"
"RTN","EASMTRPT",130,0)
 . . W !
"RTN","EASMTRPT",131,0)
 . . I $P($G(EANODE0),U,4) W ?15,"MT Returned: ",$$FMTE^XLFDT($P(EANODE0,U,5),"2D")
"RTN","EASMTRPT",132,0)
 . . K EANODE4 S EANODE4=$G(^EAS(713.2,EASIEN,4))
"RTN","EASMTRPT",133,0)
 . . W ?COL4,"30-Day",?COL5,$$FMTE^XLFDT($P(EANODE4,U,1),"2D"),?COL6,$S($P(EANODE4,U,2)=1:"YES",1:"NO")
"RTN","EASMTRPT",134,0)
 . . W ?COL7,$S($P(EANODE4,U,3)=1:"YES",1:"NO"),?COL8,$$FMTE^XLFDT($P(EANODE4,U,4),"2D"),!
"RTN","EASMTRPT",135,0)
 . . W ?15 I $P($G(EANODE0),U,4) K WP S EAWP=$$GET1^DIQ(713.2,EASIEN,7,"","WP") D
"RTN","EASMTRPT",136,0)
 . . . Q:$G(EAWP)']""
"RTN","EASMTRPT",137,0)
 . . . W $E(WP(1),1,30)
"RTN","EASMTRPT",138,0)
 . . K EANODEZ S EANODEZ=$G(^EAS(713.2,EASIEN,"Z"))
"RTN","EASMTRPT",139,0)
 . . W ?COL4,"0-Day",?COL5,$$FMTE^XLFDT($P(EANODEZ,U,1),"2D"),?COL6,$S($P(EANODEZ,U,2)=1:"YES",1:"NO")
"RTN","EASMTRPT",140,0)
 . . W ?COL7,$S($P(EANODEZ,U,3)=1:"YES",1:"NO"),?COL8,$$FMTE^XLFDT($P(EANODEZ,U,4),"2D"),!
"RTN","EASMTRPT",141,0)
 . . S $P(LINE,"-",IOM)="" W !?42,$E(LINE,1,IOM-42)
"RTN","EASMTRPT",142,0)
 . . I ($Y+6)>IOSL D
"RTN","EASMTRPT",143,0)
 . . . D HDR("AUTOMATED MT LETTERS SUMMARY",SDISP,EDISP)
"RTN","EASMTRPT",144,0)
 . . . Q:$G(EASABRT)
"RTN","EASMTRPT",145,0)
 . . . W !!,"Entry",?COL2,"Patient",?COL3,"Means Test",?COL4,"Letter",?COL5,"Print",?COL6,"Flag to",?COL7,"Letter",?COL8,"Print",?COL9,"Prohibit"
"RTN","EASMTRPT",146,0)
 . . . W !,?COL3,"Date",?COL4,"Type",?COL5,"Date",?COL6,"Print",?COL7,"Printed?",?COL8,"Date",?COL9,"Flag?",!
"RTN","EASMTRPT",147,0)
 Q
"RTN","EASMTRPT",148,0)
 ;
"RTN","EASMTRPT",149,0)
HDR(TITLE,SDISP,EDISP) ;  Print report header
"RTN","EASMTRPT",150,0)
 N LINE,TAB
"RTN","EASMTRPT",151,0)
 ;
"RTN","EASMTRPT",152,0)
 I $E(IOST,1,2)="C-" D  Q:$G(EASABRT)
"RTN","EASMTRPT",153,0)
 . S DIR(0)="E"
"RTN","EASMTRPT",154,0)
 . D ^DIR K DIR
"RTN","EASMTRPT",155,0)
 . I 'Y S EASABRT=1
"RTN","EASMTRPT",156,0)
 ;
"RTN","EASMTRPT",157,0)
 W @IOF
"RTN","EASMTRPT",158,0)
 W TITLE
"RTN","EASMTRPT",159,0)
 I SDISP>0,EDISP>0 W !,"Date Range: ",$$FMTE^XLFDT(SDISP)," thru ",$$FMTE^XLFDT(EDISP)
"RTN","EASMTRPT",160,0)
 ;
"RTN","EASMTRPT",161,0)
 W !!,"Print Date: ",$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","EASMTRPT",162,0)
 S TAB=IOM-8
"RTN","EASMTRPT",163,0)
 I $G(PAGE) W ?TAB,"Page "_PAGE S PAGE=PAGE+1
"RTN","EASMTRPT",164,0)
 ;
"RTN","EASMTRPT",165,0)
 S $P(LINE,"=",IOM)="" W !,LINE
"RTN","EASMTRPT",166,0)
 Q
"RTN","EASMTRPT",167,0)
 ;
"RTN","EASMTRPT",168,0)
ASK(PRMPT)   ; Get Date range
"RTN","EASMTRPT",169,0)
 N DIR,DIRUT,SDATE,EDATE
"RTN","EASMTRPT",170,0)
 ;
"RTN","EASMTRPT",171,0)
 ; Get date range for the report
"RTN","EASMTRPT",172,0)
 S DIR(0)="DAO^2881001:DT:EX"
"RTN","EASMTRPT",173,0)
 S DIR("A")="Start with "_PRMPT_" date: "
"RTN","EASMTRPT",174,0)
 S DIR("?",1)="Date cannot be earlier than October 1, 1988"
"RTN","EASMTRPT",175,0)
 S DIR("?")="^D HELP^%DTC"
"RTN","EASMTRPT",176,0)
 S DIR("B")="OCT 1, 1998"
"RTN","EASMTRPT",177,0)
 D ^DIR
"RTN","EASMTRPT",178,0)
 I $D(DIRUT) Q 0
"RTN","EASMTRPT",179,0)
 S SDATE=Y
"RTN","EASMTRPT",180,0)
 ;
"RTN","EASMTRPT",181,0)
 S DIR(0)="DAO^"_SDATE_"::EX"
"RTN","EASMTRPT",182,0)
 S DIR("A")="Ending "_PRMPT_" date: "
"RTN","EASMTRPT",183,0)
 S DIR("?",1)="Date must after "_$$FMTE^XLFDT(SDATE)
"RTN","EASMTRPT",184,0)
 S DIR("?")="^D HELP^%DTC"
"RTN","EASMTRPT",185,0)
 S DIR("B")="TODAY"
"RTN","EASMTRPT",186,0)
 D ^DIR K DIR
"RTN","EASMTRPT",187,0)
 I $D(DIRUT) Q 0
"RTN","EASMTRPT",188,0)
 S EDATE=Y
"RTN","EASMTRPT",189,0)
 Q $G(SDATE)_U_$G(EDATE)
"RTN","EASMTRPT",190,0)
 ;
"RTN","EASMTRPT",191,0)
INCPRHB(EASN,EAPRHB) ; Increment Prohibited Letters Flag count
"RTN","EASMTRPT",192,0)
 ; Input
"RTN","EASMTRPT",193,0)
 ;    EASN   -
"RTN","EASMTRPT",194,0)
 ;    EAPRHB -
"RTN","EASMTRPT",195,0)
 ;
"RTN","EASMTRPT",196,0)
 N EASPAT,EASDFN
"RTN","EASMTRPT",197,0)
 ;
"RTN","EASMTRPT",198,0)
 Q:'EASN
"RTN","EASMTRPT",199,0)
 S EASPAT=$G(^EAS(713.2,EASN,2))
"RTN","EASMTRPT",200,0)
 Q:'EASPAT
"RTN","EASMTRPT",201,0)
 I $D(^EAS(713.1,"AP",1,EASPAT))  D
"RTN","EASMTRPT",202,0)
 . S EAPRHB=EAPRHB+1
"RTN","EASMTRPT",203,0)
 . S EASDFN=$O(^EAS(713.1,"B",EASPAT,0))
"RTN","EASMTRPT",204,0)
 . S EAPRHB(EASDFN)=""
"RTN","EASMTRPT",205,0)
 Q
"RTN","EASMTRPT",206,0)
 ;
"RTN","EASMTRPT",207,0)
LAST4(EASIEN) ; Return last four for patient
"RTN","EASMTRPT",208,0)
 N DFN,RSLT
"RTN","EASMTRPT",209,0)
 ;
"RTN","EASMTRPT",210,0)
 S DFN=$$GET1^DIQ(713.1,EASIEN,.01,"I")
"RTN","EASMTRPT",211,0)
 I '$G(DFN) Q 0
"RTN","EASMTRPT",212,0)
 D PID^VADPT
"RTN","EASMTRPT",213,0)
 S RSLT=VA("BID")
"RTN","EASMTRPT",214,0)
 D KVA^VADPT
"RTN","EASMTRPT",215,0)
 Q RSLT
"RTN","EASMTUTL")
0^3^B46284685
"RTN","EASMTUTL",1,0)
EASMTUTL ; ALB/SCK - AUTOMATED MEANS TEST LETTERS UTILITIES ; 7/2/01
"RTN","EASMTUTL",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,14,15**;MAR 15,2001
"RTN","EASMTUTL",3,0)
 ;
"RTN","EASMTUTL",4,0)
 ;
"RTN","EASMTUTL",5,0)
PAUSE ;  Screen pause, user must press key to continue
"RTN","EASMTUTL",6,0)
 S DIR(0)="FAO",DIR("A")="Press any key to continue..."
"RTN","EASMTUTL",7,0)
 D ^DIR K DIR
"RTN","EASMTUTL",8,0)
 Q
"RTN","EASMTUTL",9,0)
 ;
"RTN","EASMTUTL",10,0)
CLRFLG(EAX,DA) ; Clears flags in File #713.2, For development
"RTN","EASMTUTL",11,0)
 N DIE,DR
"RTN","EASMTUTL",12,0)
 ;
"RTN","EASMTUTL",13,0)
 Q:EAX=1
"RTN","EASMTUTL",14,0)
 S:EAX=2 DR="9///0"
"RTN","EASMTUTL",15,0)
 S:EAX=3 DR="9///0;12///0"
"RTN","EASMTUTL",16,0)
 S:EAX=4 DR="9///0;12///0"
"RTN","EASMTUTL",17,0)
 S:EAX=0 DR="9///0;12///0;18///0"
"RTN","EASMTUTL",18,0)
 S DIE="^EAS(713.2,"
"RTN","EASMTUTL",19,0)
 D ^DIE K DIE
"RTN","EASMTUTL",20,0)
 Q
"RTN","EASMTUTL",21,0)
 ;
"RTN","EASMTUTL",22,0)
LOCK(ACTION) ; Flag IN USE field in EAS Parameters file, #713
"RTN","EASMTUTL",23,0)
 ; Input
"RTN","EASMTUTL",24,0)
 ;   ACTION - Locking action
"RTN","EASMTUTL",25,0)
 ;            1 = Flag IN USE for Automated Generator is running
"RTN","EASMTUTL",26,0)
 ;            0 = Flag IN USE for Automated Generator is not running
"RTN","EASMTUTL",27,0)
 ; Output
"RTN","EASMTUTL",28,0)
 ;        1 if action was successful
"RTN","EASMTUTL",29,0)
 ;        0 if action was not successful
"RTN","EASMTUTL",30,0)
 N RSLT
"RTN","EASMTUTL",31,0)
 ;
"RTN","EASMTUTL",32,0)
 I ACTION,$D(^EAS(713,"ALOCK",1)) Q $G(RSLT)
"RTN","EASMTUTL",33,0)
 ;
"RTN","EASMTUTL",34,0)
 S DIE="^EAS(713,",DA=1,DR="30////^S X=ACTION"
"RTN","EASMTUTL",35,0)
 D ^DIE K DIE
"RTN","EASMTUTL",36,0)
 S RSLT=1
"RTN","EASMTUTL",37,0)
 Q +$G(RSLT)
"RTN","EASMTUTL",38,0)
 ;
"RTN","EASMTUTL",39,0)
ALERT(ERRMSG) ; Post an alert message to the EAS Letters Mail group
"RTN","EASMTUTL",40,0)
 N XMY,XMTEXT,XMDUZ,XMSUB,MSG
"RTN","EASMTUTL",41,0)
 ;
"RTN","EASMTUTL",42,0)
 S MSG(1)="Notification:"
"RTN","EASMTUTL",43,0)
 S MSG(2)=ERRMSG
"RTN","EASMTUTL",44,0)
 ;
"RTN","EASMTUTL",45,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTUTL",46,0)
 S XMTEXT="MSG("
"RTN","EASMTUTL",47,0)
 S XMDUZ="EAS Auto MT Letters"
"RTN","EASMTUTL",48,0)
 S XMSUB="EAS Means Test Letter's Notice"
"RTN","EASMTUTL",49,0)
 D ^XMD
"RTN","EASMTUTL",50,0)
 Q
"RTN","EASMTUTL",51,0)
 ;
"RTN","EASMTUTL",52,0)
ADRERR(EASADD,DFN) ; Error notification for missing or invalid patient address
"RTN","EASMTUTL",53,0)
 N MSG,XMY,XMTEXT,XMDUZ,XMSUB,VAROOT,EASDEM,VA,EASPRF
"RTN","EASMTUTL",54,0)
 ;
"RTN","EASMTUTL",55,0)
 S VAROOT="EASDEM"
"RTN","EASMTUTL",56,0)
 D DEM^VADPT
"RTN","EASMTUTL",57,0)
 D PID^VADPT6
"RTN","EASMTUTL",58,0)
 S EASPRF=$$GET1^DIQ(2,DFN,27.02)
"RTN","EASMTUTL",59,0)
 I EASPRF']"" S EASPRF="No Preferred Facility"
"RTN","EASMTUTL",60,0)
 ;
"RTN","EASMTUTL",61,0)
 S MSG(1)="The following patient does not have a complete permanent mailing"
"RTN","EASMTUTL",62,0)
 S MSG(2)="address.  A means test reminder letter could not be mailed."
"RTN","EASMTUTL",63,0)
 S MSG(3)=" "
"RTN","EASMTUTL",64,0)
 S MSG(4)="       Patient : "_EASDEM(1)
"RTN","EASMTUTL",65,0)
 S MSG(5)="        Last 4 : "_VA("BID")
"RTN","EASMTUTL",66,0)
 S MSG(6)="Address Line 1 : "_EASADD(1)
"RTN","EASMTUTL",67,0)
 S MSG(7)="          City : "_EASADD(4)
"RTN","EASMTUTL",68,0)
 S MSG(8)="         State : "_$P(EASADD(5),U,2)
"RTN","EASMTUTL",69,0)
 S MSG(9)="       Zipcode : "_$P(EASADD(11),U,2)
"RTN","EASMTUTL",70,0)
 S MSG(10)=""
"RTN","EASMTUTL",71,0)
 S MSG(11)="           DFN : "_$G(DFN)
"RTN","EASMTUTL",72,0)
 S MSG(13)=""
"RTN","EASMTUTL",73,0)
 S MSG(14)="This patient's letter entry will stay in 'FLAGGED-TO-PRINT' status until"
"RTN","EASMTUTL",74,0)
 S MSG(15)="the address is corrected."
"RTN","EASMTUTL",75,0)
 ;
"RTN","EASMTUTL",76,0)
 I +EASADD(9)>0!(+EASADD(10)>0) D
"RTN","EASMTUTL",77,0)
 . S MSG(5.5)="** Temporary Address in effect **"
"RTN","EASMTUTL",78,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTUTL",79,0)
 S XMTEXT="MSG("
"RTN","EASMTUTL",80,0)
 S XMDUZ="EAS Auto MT Letters"
"RTN","EASMTUTL",81,0)
 S XMSUB="Incomplete Addr: "_EASPRF
"RTN","EASMTUTL",82,0)
 D ^XMD
"RTN","EASMTUTL",83,0)
 Q
"RTN","EASMTUTL",84,0)
 ;
"RTN","EASMTUTL",85,0)
CLRLCK ;  Clears IN USE field of the EAS MT PARAMETERS if an error occurs and locks the field
"RTN","EASMTUTL",86,0)
 N DIE,DR,DA
"RTN","EASMTUTL",87,0)
 ;
"RTN","EASMTUTL",88,0)
 S DA=1,DIE="^EAS(713,",DR="30///0"
"RTN","EASMTUTL",89,0)
 D ^DIE
"RTN","EASMTUTL",90,0)
 Q
"RTN","EASMTUTL",91,0)
 ;
"RTN","EASMTUTL",92,0)
PROHBIT ; Set or delete the Prohibit fields in the Patient Status file, #713.1
"RTN","EASMTUTL",93,0)
 N DIR,DIRUT,EASF,DIC,DIE,Y,X,EASIEN,DR,DA,DFN
"RTN","EASMTUTL",94,0)
 ;
"RTN","EASMTUTL",95,0)
 S DIR(0)="S^S:Set Prohibit Flag;R:Remove Prohibit Flag"
"RTN","EASMTUTL",96,0)
 S DIR("A")="Set or remove the MT Prohibit flag"
"RTN","EASMTUTL",97,0)
 S DIR("?")="Select 'S' to set flag, 'R' to remove the flag"
"RTN","EASMTUTL",98,0)
 D ^DIR K DIR
"RTN","EASMTUTL",99,0)
 Q:$D(DIRUT)
"RTN","EASMTUTL",100,0)
 S EASF=Y
"RTN","EASMTUTL",101,0)
 ;
"RTN","EASMTUTL",102,0)
 I EASF="R"!(EASF="r") D  Q:$D(DIRUT) 
"RTN","EASMTUTL",103,0)
 . S DIR(0)="PAO^713.1:EMZ"
"RTN","EASMTUTL",104,0)
 . S DIR("A")="Select Patient: "
"RTN","EASMTUTL",105,0)
 . D ^DIR K DIR
"RTN","EASMTUTL",106,0)
 . S EASIEN=+Y
"RTN","EASMTUTL",107,0)
 ;
"RTN","EASMTUTL",108,0)
 I EASF="S"!(EASF="s") D  Q:$D(DIRUT)
"RTN","EASMTUTL",109,0)
 . S DIR(0)="PAO^2:EMZ"
"RTN","EASMTUTL",110,0)
 . S DIR("A")="Select Patient: "
"RTN","EASMTUTL",111,0)
 . D ^DIR K DIR
"RTN","EASMTUTL",112,0)
 . Q:$D(DIRUT)
"RTN","EASMTUTL",113,0)
 . S DFN=+Y
"RTN","EASMTUTL",114,0)
 . I '$D(^EAS(713.1,"B",DFN)) D  Q:$D(DIRUT)
"RTN","EASMTUTL",115,0)
 . . S DIR(0)="Y",DIR("B")="YES"
"RTN","EASMTUTL",116,0)
 . . S DIR("A")="Add patient to the Patient Status File"
"RTN","EASMTUTL",117,0)
 . . D ^DIR K DIR
"RTN","EASMTUTL",118,0)
 . . Q:$D(DIRUT)
"RTN","EASMTUTL",119,0)
 . . I 'Y S DIRUT=1 Q
"RTN","EASMTUTL",120,0)
 . . S DIC="^EAS(713.1,",DIC(0)="Z",X=DFN
"RTN","EASMTUTL",121,0)
 . . D FILE^DICN
"RTN","EASMTUTL",122,0)
 . . S EASIEN=+Y
"RTN","EASMTUTL",123,0)
 . I $D(^EAS(713.1,"B",DFN)) S EASIEN=$O(^EAS(713.1,"B",DFN,0))
"RTN","EASMTUTL",124,0)
 ;
"RTN","EASMTUTL",125,0)
 Q:'$G(EASIEN)
"RTN","EASMTUTL",126,0)
 ;
"RTN","EASMTUTL",127,0)
 S DIE="^EAS(713.1,",DA=EASIEN
"RTN","EASMTUTL",128,0)
 S:EASF="S" DR="2///YES;3;5///^S X=$$NOW^XLFDT;4///^S X=DUZ;10"
"RTN","EASMTUTL",129,0)
 S:EASF="R" DR="2///@;3///@;5///@;4///@;10///@"
"RTN","EASMTUTL",130,0)
 D ^DIE K DIE
"RTN","EASMTUTL",131,0)
 ;
"RTN","EASMTUTL",132,0)
 Q
"RTN","EASMTUTL",133,0)
 ;
"RTN","EASMTUTL",134,0)
EDTLTRS ;
"RTN","EASMTUTL",135,0)
 N DIR,EASIEN
"RTN","EASMTUTL",136,0)
 ;
"RTN","EASMTUTL",137,0)
 S DIR(0)="P^713.3:EMZ"
"RTN","EASMTUTL",138,0)
 S DIR("A")="Select Letter"
"RTN","EASMTUTL",139,0)
 D ^DIR K DIR
"RTN","EASMTUTL",140,0)
 Q:$D(DIRUT)
"RTN","EASMTUTL",141,0)
 S EASIEN=+Y
"RTN","EASMTUTL",142,0)
 ;
"RTN","EASMTUTL",143,0)
 S DIE="^EAS(713.3,",DA=EASIEN,DR="4"
"RTN","EASMTUTL",144,0)
 D ^DIE
"RTN","EASMTUTL",145,0)
 Q
"RTN","EASMTUTL",146,0)
 ;
"RTN","EASMTUTL",147,0)
MTRTN ; Update the letter status file, #713.2, with returned Means Test information
"RTN","EASMTUTL",148,0)
 N DIE,DIC,EASIEN,DR,DA,Y
"RTN","EASMTUTL",149,0)
 ;
"RTN","EASMTUTL",150,0)
 S DIC="^EAS(713.2,",DIC(0)="AEQM",DIC("A")="Select the Letter Status entry to update: "
"RTN","EASMTUTL",151,0)
 D ^DIC K DIC
"RTN","EASMTUTL",152,0)
 Q:Y<0
"RTN","EASMTUTL",153,0)
 S EASIEN=+Y
"RTN","EASMTUTL",154,0)
 ;
"RTN","EASMTUTL",155,0)
 S DIE="^EAS(713.2,",DA=EASIEN
"RTN","EASMTUTL",156,0)
 S DR="4;I X=0 S Y=0;5;7;6////^S X=DUZ;9///0;12///0;18///0"
"RTN","EASMTUTL",157,0)
 L +^EAS(713.2,EASIEN):0 I $T D 
"RTN","EASMTUTL",158,0)
 . D ^DIE K DIE
"RTN","EASMTUTL",159,0)
 E  W !,$CHAR(7),"Entry is being edited by another user."
"RTN","EASMTUTL",160,0)
 L -^EAS(713.2,EASIEN)
"RTN","EASMTUTL",161,0)
 ;
"RTN","EASMTUTL",162,0)
 Q
"RTN","EASMTUTL",163,0)
 ;
"RTN","EASMTUTL",164,0)
DECEASED(EASIEN,DFN) ;  Check deceased status for patient
"RTN","EASMTUTL",165,0)
 N RSLT,EADEM,EAS1,VAROOT
"RTN","EASMTUTL",166,0)
 ;
"RTN","EASMTUTL",167,0)
 S EASIEN=$G(EASIEN)
"RTN","EASMTUTL",168,0)
 S DFN=$G(DFN)
"RTN","EASMTUTL",169,0)
 I EASIEN>0 D
"RTN","EASMTUTL",170,0)
 . S EAS1=$$GET1^DIQ(713.2,EASIEN,2,"I")
"RTN","EASMTUTL",171,0)
 . S DFN=$$GET1^DIQ(713.1,EAS1,.01,"I")
"RTN","EASMTUTL",172,0)
 Q:'DFN 0
"RTN","EASMTUTL",173,0)
 S RSLT=0
"RTN","EASMTUTL",174,0)
 ;
"RTN","EASMTUTL",175,0)
 S VAROOT="EADEM"
"RTN","EASMTUTL",176,0)
 D DEM^VADPT
"RTN","EASMTUTL",177,0)
 S:+EADEM(6) RSLT=1
"RTN","EASMTUTL",178,0)
 D KVA^VADPT
"RTN","EASMTUTL",179,0)
 Q RSLT
"RTN","EASMTUTL",180,0)
 ;
"RTN","EASMTUTL",181,0)
CHECKMT(EASPT,EAIEN) ; Check current MT status
"RTN","EASMTUTL",182,0)
 N DFN,RTN,EACHK,DIE,DR,DA
"RTN","EASMTUTL",183,0)
 ;
"RTN","EASMTUTL",184,0)
 S RTN=0
"RTN","EASMTUTL",185,0)
 I '$G(EASPT) S RTN=1 G CHKQ ; Safety check
"RTN","EASMTUTL",186,0)
 S DFN=$$GET1^DIQ(713.1,EASPT,.01,"I") ; Get DFN
"RTN","EASMTUTL",187,0)
 I '$G(DFN) S RTN=1 G CHKQ ; Safety check
"RTN","EASMTUTL",188,0)
 ;
"RTN","EASMTUTL",189,0)
 S EACHK=$$MTCHK^EASMTCHK(DFN,"L") ; Check current MT to see if it's changed
"RTN","EASMTUTL",190,0)
 I 'EACHK D  ; If MT no longer required, update letter status file
"RTN","EASMTUTL",191,0)
 . S DIE="^EAS(713.2,",DA=EAIEN
"RTN","EASMTUTL",192,0)
 . S DR="4///YES;5///TODAY;7///AUTO-GENERATED;9///NO;12///NO;18///NO"
"RTN","EASMTUTL",193,0)
 . D ^DIE K DIE ;; Remove before release
"RTN","EASMTUTL",194,0)
 . S RTN=1
"RTN","EASMTUTL",195,0)
 ;
"RTN","EASMTUTL",196,0)
CHKQ Q RTN
"RTN","EASMTUTL",197,0)
 ;
"RTN","EASMTUTL",198,0)
FUTMT(EASIEN) ; Check for a future MT
"RTN","EASMTUTL",199,0)
 ;  Input
"RTN","EASMTUTL",200,0)
 ;    EASIEN - IEN for record in Letter Status file
"RTN","EASMTUTL",201,0)
 ;
"RTN","EASMTUTL",202,0)
 ;  Output
"RTN","EASMTUTL",203,0)
 ;     1 - Future MT exist's (API call)
"RTN","EASMTUTL",204,0)
 ;     0 - Future MT does not exist
"RTN","EASMTUTL",205,0)
 ;
"RTN","EASMTUTL",206,0)
 N EASPTR,DFN,EASFUT
"RTN","EASMTUTL",207,0)
 ;
"RTN","EASMTUTL",208,0)
 S RTN=0
"RTN","EASMTUTL",209,0)
 S EASPTR=$$GET1^DIQ(713.2,EASIEN,2,"I")
"RTN","EASMTUTL",210,0)
 S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTUTL",211,0)
 ;
"RTN","EASMTUTL",212,0)
 ;; Call API for future MT check
"RTN","EASMTUTL",213,0)
 S EASFUT=$$FUT^DGMTU(DFN)
"RTN","EASMTUTL",214,0)
 ;
"RTN","EASMTUTL",215,0)
 I +$G(EASFUT) D  ; Turn off letters if future MT present
"RTN","EASMTUTL",216,0)
 . Q:'EASIEN
"RTN","EASMTUTL",217,0)
 . S DIE="^EAS(713.2,",DA=EASIEN
"RTN","EASMTUTL",218,0)
 . S DR="4///YES;5///TODAY;7///FUTURE MEANS TEST;9///NO;12///NO;18///NO"
"RTN","EASMTUTL",219,0)
 . D ^DIE K DIE
"RTN","EASMTUTL",220,0)
 . S RTN=1
"RTN","EASMTUTL",221,0)
 Q RTN
"RTN","EASMTUTL",222,0)
 ;
"RTN","EASMTUTL",223,0)
TESTLTR ;
"RTN","EASMTUTL",224,0)
 N EASIEN,EATYP,DIR,DIRUT
"RTN","EASMTUTL",225,0)
 ;
"RTN","EASMTUTL",226,0)
 S DIR(0)="SO^1:60-Day;2:30-Day;4:0-Day"
"RTN","EASMTUTL",227,0)
 S DIR("A")="Select letter type to test"
"RTN","EASMTUTL",228,0)
 S DIR("?")="Select the type of letter to print a test output of"
"RTN","EASMTUTL",229,0)
 D ^DIR K DIR
"RTN","EASMTUTL",230,0)
 Q:$D(DIRUT)
"RTN","EASMTUTL",231,0)
 S EATYP=+Y
"RTN","EASMTUTL",232,0)
 S EASIEN=-1
"RTN","EASMTUTL",233,0)
 S ZTSAVE("EASIEN")="",ZTSAVE("EATYP")=""
"RTN","EASMTUTL",234,0)
 D EN^XUTMDEVQ("ZTEST^EASMTUTL","EAS MT TEST LETTER",.ZTSAVE)
"RTN","EASMTUTL",235,0)
 Q
"RTN","EASMTUTL",236,0)
 ;
"RTN","EASMTUTL",237,0)
TESTIT ;
"RTN","EASMTUTL",238,0)
 D LETTER^EASMTL6A(EASIEN,EATYP)
"RTN","EASMTUTL",239,0)
 Q
"RTN","EASMTUTL",240,0)
 ;
"RTN","EASMTUTL",241,0)
ZTEST ;
"RTN","EASMTUTL",242,0)
 D LETTER^EASMTL6A(EASIEN,EATYP)
"RTN","EASMTUTL",243,0)
 Q
"UP",713,713.025,-1)
713^2
"UP",713,713.025,0)
713.025
"VER")
8.0^22
"^DD",713,713,8,0)
ALLOW FILTERING BY LOCATION?^S^1:YES;0:NO;^0;8^Q
"^DD",713,713,8,3)
Enter 'YES' to allow filtering by Preferred Facility, 'NO' to not allow filtering by Facility
"^DD",713,713,8,21,0)
^^3^3^3020723^
"^DD",713,713,8,21,1,0)
This switch allows the filtering by PREFERRED FACILITY to be truned on or 
"^DD",713,713,8,21,2,0)
off by the site.  If on, users will be prompted to filter letters for a 
"^DD",713,713,8,21,3,0)
specific Preferred Facility.  
"^DD",713,713,8,"DT")
3020723
"^DD",713,713,9,0)
ALLOW OTHER RETURN ADDRESS^S^1:YES;0:NO;^0;9^Q
"^DD",713,713,9,3)
YES will allow use of other than the primary facility's return address
"^DD",713,713,9,21,0)
^^4^4^3020702^
"^DD",713,713,9,21,1,0)
A NO will force all letters to print the primary facility's return 
"^DD",713,713,9,21,2,0)
address on the letters.  A YES will allow the printing of the return 
"^DD",713,713,9,21,3,0)
address listed for the preferred facility as entered in the PATIENT File, 
"^DD",713,713,9,21,4,0)
#2.
"^DD",713,713,9,"DT")
3020702
"^DD",713,713,25,0)
*ADDITIONAL PRINT LOCATIONS^713.025PA^^2;0
"^DD",713,713,25,"DT")
3020705
"^DD",713,713.025,0)
*ADDITIONAL PRINT LOCATIONS SUB-FIELD^^1^2
"^DD",713,713.025,0,"DT")
3011113
"^DD",713,713.025,0,"IX","B",713.025,.01)

"^DD",713,713.025,0,"NM","*ADDITIONAL PRINT LOCATIONS")

"^DD",713,713.025,0,"UP")
713
"^DD",713,713.025,.01,0)
LOCATION^P4'^DIC(4,^0;1^Q
"^DD",713,713.025,.01,1,0)
^.1
"^DD",713,713.025,.01,1,1,0)
713.025^B
"^DD",713,713.025,.01,1,1,1)
S ^EAS(713,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",713,713.025,.01,1,1,2)
K ^EAS(713,DA(1),2,"B",$E(X,1,30),DA)
"^DD",713,713.025,.01,3)
Select Division/Location where letters are to be printed
"^DD",713,713.025,.01,21,0)
^^5^5^3011113^
"^DD",713,713.025,.01,21,1,0)
This is the location where the Means Test letters may be printed.  If a
"^DD",713,713.025,.01,21,2,0)
veteran has specified a Preferred Facility and the printing of letters to
"^DD",713,713.025,.01,21,3,0)
alternate locations has been activated, then if there is a matching
"^DD",713,713.025,.01,21,4,0)
facility/location here, the letters will be directed to the associated
"^DD",713,713.025,.01,21,5,0)
print device.
"^DD",713,713.025,.01,"DT")
3011113
"^DD",713,713.025,1,0)
PRINT DEVICE AT LOCATION^P3.5'^%ZIS(1,^0;2^Q
"^DD",713,713.025,1,3)
Enter the print device for this location
"^DD",713,713.025,1,"DT")
3011109
**END**
**END**
