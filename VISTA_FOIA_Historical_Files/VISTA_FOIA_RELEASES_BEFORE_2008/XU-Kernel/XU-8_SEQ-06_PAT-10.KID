Released XU*8*10 SEQ #6
Extracted from mail message
**KIDS**:XU*8.0*10^

**INSTALL NAME**
XU*8.0*10
"BLD",22,0)
XU*8.0*10^KERNEL^0^2951026^y
"BLD",22,1,0)
^^29^29^2951026^^^^
"BLD",22,1,1,0)
This is Patch 10 to Kernel version 8.0.
"BLD",22,1,2,0)
You can install this patch with users on the system.
"BLD",22,1,3,0)
This patch contains a new Option and bug fixes for KIDS.
"BLD",22,1,4,0)
========================================================================= 
"BLD",22,1,5,0)
OPTIONS:
"BLD",22,1,6,0)
 XPD BACKUP - Backup a Transport Global
"BLD",22,1,7,0)
 This option creates a MailMan message that will backup all current routines
"BLD",22,1,8,0)
 on your system that would be replaced by the Packages in this Transport
"BLD",22,1,9,0)
 Global. Those components that are not routines must be backed up separately
"BLD",22,1,10,0)
 if they need to be preserved.
"BLD",22,1,11,0)

"BLD",22,1,12,0)
ROUTINES:
"BLD",22,1,13,0)
 XPDIB new routine to support the option XPD BACKUP.
"BLD",22,1,14,0)

"BLD",22,1,15,0)
 XPDI and XPDIA were changed to remove the ability to take Protocols out of
"BLD",22,1,16,0)
 order.  Since Protocols are called from options, they don't need to be taken
"BLD",22,1,17,0)
 out of order duing an install. Also, Lab needs to invoke a Protocol during 
"BLD",22,1,18,0)
 the install process
"BLD",22,1,19,0)

"BLD",22,1,20,0)
 XPDT combined two prompts into one when transporting a Build. The new prompt
"BLD",22,1,21,0)
 is 'Transport through (HF)Host File or (PM)PackMan'
"BLD",22,1,22,0)

"BLD",22,1,23,0)
 XPDTC was changed so the entire Package file entry wasn't sent for a patch,
"BLD",22,1,24,0)
 only the patch information is now sent.
"BLD",22,1,25,0)
 
"BLD",22,1,26,0)
 XPDRSUM the algorithm for checksums on globals was changed.
"BLD",22,1,27,0)

"BLD",22,1,28,0)
 XQOO and XQOO1 were change to support the removing of Protocols from the
"BLD",22,1,29,0)
 out of order list in KIDS.
"BLD",22,4,0)
^9.64PA^^0
"BLD",22,"KRN",0)
^9.67PA^.84^14
"BLD",22,"KRN",.4,0)
.4
"BLD",22,"KRN",.401,0)
.401
"BLD",22,"KRN",.402,0)
.402
"BLD",22,"KRN",.403,0)
.403
"BLD",22,"KRN",.5,0)
.5
"BLD",22,"KRN",.84,0)
.84
"BLD",22,"KRN",3.6,0)
3.6
"BLD",22,"KRN",9.2,0)
9.2
"BLD",22,"KRN",9.2,"NM",0)
^9.68A^^0
"BLD",22,"KRN",9.8,0)
9.8
"BLD",22,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",22,"KRN",9.8,"NM",1,0)
XQOO^^0^B39667406
"BLD",22,"KRN",9.8,"NM",2,0)
XQOO1^^0^B55261934
"BLD",22,"KRN",9.8,"NM",3,0)
XPDI^^0^B35207355
"BLD",22,"KRN",9.8,"NM",4,0)
XPDIA^^0^B18854007
"BLD",22,"KRN",9.8,"NM",5,0)
XPDRSUM^^0^B1716873
"BLD",22,"KRN",9.8,"NM",6,0)
XPDT^^0^B30658329
"BLD",22,"KRN",9.8,"NM",7,0)
XPDTC^^0^B21839057
"BLD",22,"KRN",9.8,"NM",8,0)
XPDIB^^0^B3837712
"BLD",22,"KRN",9.8,"NM","B","XPDI",3)

"BLD",22,"KRN",9.8,"NM","B","XPDIA",4)

"BLD",22,"KRN",9.8,"NM","B","XPDIB",8)

"BLD",22,"KRN",9.8,"NM","B","XPDRSUM",5)

"BLD",22,"KRN",9.8,"NM","B","XPDT",6)

"BLD",22,"KRN",9.8,"NM","B","XPDTC",7)

"BLD",22,"KRN",9.8,"NM","B","XQOO",1)

"BLD",22,"KRN",9.8,"NM","B","XQOO1",2)

"BLD",22,"KRN",19,0)
19
"BLD",22,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",22,"KRN",19,"NM",1,0)
XPD BACKUP^^0
"BLD",22,"KRN",19,"NM",2,0)
XPD INSTALLATION MENU^^2
"BLD",22,"KRN",19,"NM","B","XPD BACKUP",1)

"BLD",22,"KRN",19,"NM","B","XPD INSTALLATION MENU",2)

"BLD",22,"KRN",19.1,0)
19.1
"BLD",22,"KRN",101,0)
101
"BLD",22,"KRN","B",.4,.4)

"BLD",22,"KRN","B",.401,.401)

"BLD",22,"KRN","B",.402,.402)

"BLD",22,"KRN","B",.403,.403)

"BLD",22,"KRN","B",.5,.5)

"BLD",22,"KRN","B",.84,.84)

"BLD",22,"KRN","B",3.6,3.6)

"BLD",22,"KRN","B",9.2,9.2)

"BLD",22,"KRN","B",9.8,9.8)

"BLD",22,"KRN","B",19,19)

"BLD",22,"KRN","B",19.1,19.1)

"BLD",22,"KRN","B",101,101)

"BLD",22,"QUES",0)
^9.62^^
"KRN",19,1414,-1)
2^2
"KRN",19,1414,0)
XPD INSTALLATION MENU^Installation^^M^^XUPROGMODE^^^^^^
"KRN",19,1414,1,0)
^^2^2^2950130^^^^
"KRN",19,1414,1,1,0)
This menu contains options to load, install, and restart the install 
"KRN",19,1414,1,2,0)
of a KIDS Distribution.
"KRN",19,1414,10,0)
^19.01IP^9^8
"KRN",19,1414,10,9,0)
2629
"KRN",19,1414,10,9,"^")
XPD BACKUP
"KRN",19,1414,99)
56546,45992
"KRN",19,1414,"U")
INSTALLATION
"KRN",19,2629,-1)
0^1
"KRN",19,2629,0)
XPD BACKUP^Backup a Transport Global^^R^^^^^^^^KIDS
"KRN",19,2629,1,0)
^^4^4^2951026^^^
"KRN",19,2629,1,1,0)
This option creates a MailMan message that will backup all current routines
"KRN",19,2629,1,2,0)
on your system that would be replaced by the Packages in this Transport
"KRN",19,2629,1,3,0)
Global. Those components that are not routines must be backed up separately
"KRN",19,2629,1,4,0)
if they need to be preserved. 
"KRN",19,2629,25)
EN^XPDIB
"KRN",19,2629,"U")
BACKUP A TRANSPORT GLOBAL
"ORD",12,19)
19;12;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",12,19,0)
OPTION
"PKG",131,-1)
1^1
"PKG",131,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",131,22,0)
^9.49I^1^1
"PKG",131,22,1,0)
8.0^2950729
"PKG",131,22,1,"PAH",1,0)
10^2951026^1
"PKG",131,22,1,"PAH",1,1,0)
^^29^29^2951026
"PKG",131,22,1,"PAH",1,1,1,0)
This is Patch 10 to Kernel version 8.0.
"PKG",131,22,1,"PAH",1,1,2,0)
You can install this patch with users on the system.
"PKG",131,22,1,"PAH",1,1,3,0)
This patch contains a new Option and bug fixes for KIDS.
"PKG",131,22,1,"PAH",1,1,4,0)
========================================================================= 
"PKG",131,22,1,"PAH",1,1,5,0)
OPTIONS:
"PKG",131,22,1,"PAH",1,1,6,0)
 XPD BACKUP - Backup a Transport Global
"PKG",131,22,1,"PAH",1,1,7,0)
 This option creates a MailMan message that will backup all current routines
"PKG",131,22,1,"PAH",1,1,8,0)
 on your system that would be replaced by the Packages in this Transport
"PKG",131,22,1,"PAH",1,1,9,0)
 Global. Those components that are not routines must be backed up separately
"PKG",131,22,1,"PAH",1,1,10,0)
 if they need to be preserved.
"PKG",131,22,1,"PAH",1,1,11,0)

"PKG",131,22,1,"PAH",1,1,12,0)
ROUTINES:
"PKG",131,22,1,"PAH",1,1,13,0)
 XPDIB new routine to support the option XPD BACKUP.
"PKG",131,22,1,"PAH",1,1,14,0)

"PKG",131,22,1,"PAH",1,1,15,0)
 XPDI and XPDIA were changed to remove the ability to take Protocols out of
"PKG",131,22,1,"PAH",1,1,16,0)
 order.  Since Protocols are called from options, they don't need to be taken
"PKG",131,22,1,"PAH",1,1,17,0)
 out of order duing an install. Also, Lab needs to invoke a Protocol during 
"PKG",131,22,1,"PAH",1,1,18,0)
 the install process
"PKG",131,22,1,"PAH",1,1,19,0)

"PKG",131,22,1,"PAH",1,1,20,0)
 XPDT combined two prompts into one when transporting a Build. The new prompt
"PKG",131,22,1,"PAH",1,1,21,0)
 is 'Transport through (HF)Host File or (PM)PackMan'
"PKG",131,22,1,"PAH",1,1,22,0)

"PKG",131,22,1,"PAH",1,1,23,0)
 XPDTC was changed so the entire Package file entry wasn't sent for a patch,
"PKG",131,22,1,"PAH",1,1,24,0)
 only the patch information is now sent.
"PKG",131,22,1,"PAH",1,1,25,0)
 
"PKG",131,22,1,"PAH",1,1,26,0)
 XPDRSUM the algorithm for checksums on globals was changed.
"PKG",131,22,1,"PAH",1,1,27,0)

"PKG",131,22,1,"PAH",1,1,28,0)
 XQOO and XQOO1 were change to support the removing of Protocols from the
"PKG",131,22,1,"PAH",1,1,29,0)
 out of order list in KIDS.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options and Options
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","XPDI")
0^3^B35207355
"RTN","XPDI",1,0)
XPDI ;SFISC/RSD - Install Process ; 24 Oct 95 15:42
"RTN","XPDI",2,0)
 ;;8.0;KERNEL;**10**;Jul 10, 1995
"RTN","XPDI",3,0)
EN ;install
"RTN","XPDI",4,0)
 N DIR,DIRUT,POP,XPD,XPDA,XPDD,XPDIJ,XPDDIQ,XPDNM,XPDNOQUE,XPDPKG,XPDST,XPDSET,XPDT,XPDQUIT,XPDQUES,Y,ZTSK,%
"RTN","XPDI",5,0)
 S %="I '$P(^(0),U,9),$D(^XPD(9.7,""ASP"",Y,1,Y)),$D(^XTMP(""XPDI"",Y))",XPDST=$$LOOK(%)
"RTN","XPDI",6,0)
 Q:'XPDST!$D(XPDQUIT)  S XPDT=0,XPDSET=$P(^XPD(9.7,XPDST,0),U)
"RTN","XPDI",7,0)
 F  S XPDT=$O(XPDT(XPDT)) Q:'XPDT  D  Q:$D(XPDT)<11!$D(XPDQUIT)
"RTN","XPDI",8,0)
 .S XPDA=+XPDT(XPDT),XPDNM=$P(XPDT(XPDT),U,2),XPDPKG=+$P($G(^XPD(9.7,+XPDT(XPDT),0)),U,2),%=$P(^(0),U,5)
"RTN","XPDI",9,0)
 .Q:$$ENV^XPDIL1(1)
"RTN","XPDI",10,0)
 .D QUES(XPDA) Q:'$D(XPDT(+XPDT))!$D(XPDQUIT)
"RTN","XPDI",11,0)
 .S:$D(^XTMP("XPDI",XPDA,"RTN","XPDIJ")) XPDIJ=XPDA
"RTN","XPDI",12,0)
 .D XQSET(XPDA)
"RTN","XPDI",13,0)
 G NONE^XPDIL:'$O(XPDT(""))!$D(XPDQUIT)
"RTN","XPDI",14,0)
 W ! S XPDA=XPDST,XPDNM=XPDSET
"RTN","XPDI",15,0)
 D DIR^XPDIQ("XPZ") I $D(DIRUT) D ABRTALL(2) Q
"RTN","XPDI",16,0)
 D  I XPDSET="^" D ABRTALL(2) Q
"RTN","XPDI",17,0)
 .I '$G(XPDQUES("XPZ1")) K ^XTMP("XQOO",XPDSET) S XPDSET="",Y=0
"RTN","XPDI",18,0)
 .E  D  Q:XPDSET="^"!(XPDSET="")
"RTN","XPDI",19,0)
 ..M ^XTMP("XQOO")=^TMP($J,"XQOO")
"RTN","XPDI",20,0)
 ..D INIT^XQOO(.XPDSET) Q:"^"[XPDSET
"RTN","XPDI",21,0)
 ..N DIR S DIR(0)="N^0:60:0",DIR("B")=0
"RTN","XPDI",22,0)
 ..S DIR("A")="Delay Install (Minutes)",DIR("?")="Enter the number of minutes to delay the installing of Routines after the Disable of Options"
"RTN","XPDI",23,0)
 ..W ! D ^DIR I $D(DIRUT) S XPDSET="^"
"RTN","XPDI",24,0)
 .K XPD S XPD(9.7,XPDST_",",7)=$S(XPDSET]"":XPDSET,1:"@"),XPD(9.7,XPDST_",",8)=Y
"RTN","XPDI",25,0)
 .D FILE^DIE("","XPD")
"RTN","XPDI",26,0)
 I $G(XPDQUES("XPZ2")) D
"RTN","XPDI",27,0)
 .N DA,DIE,DR,Y
"RTN","XPDI",28,0)
 .S DA=XPDA,DIE="^XPD(9.7,",DR=30,DR(2,9.703)=".01"
"RTN","XPDI",29,0)
 .W !!,"Please enter the VOLUME SETS you want me to update.",!
"RTN","XPDI",30,0)
 .D ^DIE I '$O(^XPD(9.7,XPDA,"VOL",0)) W !!,"No VOLUME SETS selected!!" Q
"RTN","XPDI",31,0)
 .I '$$TM^%ZTLOAD W !!,"TASKMAN is not running. You must run the routine XPDCPU in the production",!,"UCI for each of the VOLUME SETS you have listed once the installation starts!!",*7,*7,!!
"RTN","XPDI",32,0)
DEV S POP=0 S:'$D(^DD(3.5,0)) POP=1
"RTN","XPDI",33,0)
 I 'POP S IOP="",%ZIS=0 D ^%ZIS
"RTN","XPDI",34,0)
 ;Kernel Virgin Install
"RTN","XPDI",35,0)
 I POP S XPDA=XPDST D:$G(XPDIJ) XPDIJ G EN^XPDIJ
"RTN","XPDI",36,0)
 W !!,"Enter the Device you want to print the Install messages."
"RTN","XPDI",37,0)
 W:'$D(XPDNOQUE) !,"You can queue the install by enter a 'Q' at the device prompt."
"RTN","XPDI",38,0)
 W !,"Enter a '^' to abort the install.",!
"RTN","XPDI",39,0)
 S XPDA=XPDST,%ZIS=$P("Q",U,'$D(XPDNOQUE))
"RTN","XPDI",40,0)
 D ^%ZIS G:POP ASKABRT
"RTN","XPDI",41,0)
 S XPDD=$$FMADD^XLFDT(DT,7),^XTMP("XPDI",0)=XPDD_U_DT
"RTN","XPDI",42,0)
 I $D(IO("Q")) D  G ASKABRT:$D(ZTSK)[0,XPDIJ:$G(XPDIJ) Q
"RTN","XPDI",43,0)
 .N %DT
"RTN","XPDI",44,0)
 .S %DT="AEFRSX",%DT("A")="Requested Start Time: ",(%DT("B"),%DT(0))="NOW"
"RTN","XPDI",45,0)
 .F  D ^%DT Q:$D(DTOUT)  D:$$FMDIFF^XLFDT(XPDD,Y)<0  Q:Y>0
"RTN","XPDI",46,0)
 ..W !!,"Start Date shouldn't be more than a week in the future!",*7
"RTN","XPDI",47,0)
 ..S Y=-1
"RTN","XPDI",48,0)
 .Q:$D(DTOUT)
"RTN","XPDI",49,0)
 .S ZTDTH=Y,ZTRTN="EN^XPDIJ",ZTDESC="KIDS install",ZTSAVE("XPDA")=""
"RTN","XPDI",50,0)
 .D ^%ZTLOAD,HOME^%ZIS K IO("Q")
"RTN","XPDI",51,0)
 .Q:$D(ZTSK)[0
"RTN","XPDI",52,0)
 .W !,"Install Queued!",!!
"RTN","XPDI",53,0)
 .K XPD S XPD(9.7,XPDST_",",5)=ZTSK,XPDT=0
"RTN","XPDI",54,0)
 .F  S XPDT=$O(XPDT(XPDT)) Q:'XPDT  S XPD(9.7,+XPDT(XPDT)_",",.02)=1 D FILE^DIE("","XPD") K XPD
"RTN","XPDI",55,0)
 U IO D:$G(XPDIJ) XPDIJ G EN^XPDIJ
"RTN","XPDI",56,0)
 Q
"RTN","XPDI",57,0)
QUES(XPDA) ;install questions; XPDA=ien in file 9.7
"RTN","XPDI",58,0)
 N XPDANS,XPDFIL,XPDFILN,XPDFILO,XPDNM,XPDQUES,X,Y
"RTN","XPDI",59,0)
 S XPDNM=$P(^XPD(9.7,XPDA,0),U) W !!,"Install Questions for ",XPDNM,!
"RTN","XPDI",60,0)
 D DIR^XPDIQ("PRE") I $D(XPDQUIT) D ASKABRT Q
"RTN","XPDI",61,0)
 S XPDFIL=0
"RTN","XPDI",62,0)
 F  S XPDFIL=$O(^XTMP("XPDI",XPDA,"FIA",XPDFIL)) Q:'XPDFIL  S X=^(XPDFIL),X(0)=^(XPDFIL,0),X(1)=^(XPDFIL),XPDFILO=^(0,1) D  I $D(XPDQUIT) Q
"RTN","XPDI",63,0)
 .I $G(^(10))]"" N XPDSCR S XPDSCR=^(10) ;^(10) is ref to ^XTMP("XPDI",XPDA,"FIA",XPDFIL,0,10) from prev line
"RTN","XPDI",64,0)
 .S XPDFILN=X_X(0)_U_X(1),XPDANS='($D(^DIC(XPDFIL,0))#2)_"^^"_''$O(@(X(0)_"0)"))
"RTN","XPDI",65,0)
 .W ! D DIR^XPDIQ("XPF",XPDFIL_"#") Q:$D(XPDQUIT)
"RTN","XPDI",66,0)
 .S:$G(XPDQUES("XPF"_XPDFIL_"#2"))=0 $P(XPDANS,U,5)=1
"RTN","XPDI",67,0)
 .S ^XTMP("XPDI",XPDA,"FIA",XPDFIL,0,2)=XPDANS
"RTN","XPDI",68,0)
 .F I=1:1:2 K XPDQUES("XPF"_XPDFIL_"#"_I)
"RTN","XPDI",69,0)
 I $D(XPDQUIT) D ASKABRT Q
"RTN","XPDI",70,0)
 W ! D DIR^XPDIQ("POS") I $D(DIRUT)!$D(XPDQUIT) D ASKABRT Q
"RTN","XPDI",71,0)
 Q
"RTN","XPDI",72,0)
LOOK(XPDS) ;lookup Install
"RTN","XPDI",73,0)
 N DIC,Y,XPD,%
"RTN","XPDI",74,0)
 K XPDT
"RTN","XPDI",75,0)
 S DIC(0)="QEAMZ",DIC="^XPD(9.7,"
"RTN","XPDI",76,0)
 S:$L($G(XPDS)) DIC("S")=XPDS
"RTN","XPDI",77,0)
 D ^DIC Q:Y<0 0
"RTN","XPDI",78,0)
 S XPD=+Y,XPDT=0
"RTN","XPDI",79,0)
 W !!,"This Distribution was loaded on ",$$FMTE^XLFDT($P(Y(0),U,3))," with header of ",!,$G(^XPD(9.7,XPD,2)),!,"It consisted of the following Install(s):",!
"RTN","XPDI",80,0)
 F  S XPDT=$O(^XPD(9.7,"ASP",XPD,XPDT)) Q:'XPDT  S Y=+$O(^(XPDT,0)) D
"RTN","XPDI",81,0)
 .S %=$P($G(^XPD(9.7,Y,0)),U)
"RTN","XPDI",82,0)
 .I %="" W "**ERROR in Install, You need to remove the Distribution and reload it**",!  S XPDQUIT=1 Q
"RTN","XPDI",83,0)
 .S XPDT(XPDT)=Y_U_%,(XPDT("DA",Y),XPDT("NM",%))=XPDT W %,!
"RTN","XPDI",84,0)
 S:'$O(XPDT(0)) XPDQUIT=1
"RTN","XPDI",85,0)
 Q XPD
"RTN","XPDI",86,0)
 ;
"RTN","XPDI",87,0)
XQSET(XPDA) ;
"RTN","XPDI",88,0)
 N I,X,Y K ^TMP($J)
"RTN","XPDI",89,0)
 S ^TMP($J,"XQOO",XPDSET,0)="Package being installed^"_DT_U_DUZ
"RTN","XPDI",90,0)
 S I=0 F  S I=$O(^XTMP("XPDI",XPDA,"KRN",19,I)) Q:'I  S X=^(I,0) D
"RTN","XPDI",91,0)
 .S Y=$O(^DIC(19,"B",$P(X,U),0))
"RTN","XPDI",92,0)
 .I Y,$D(^DIC(19,Y,0)) S ^TMP($J,"XQOO",XPDSET,19,Y)=$P(^(0),U,1,2)
"RTN","XPDI",93,0)
 Q  ;patch 10, don't do Protocols
"RTN","XPDI",94,0)
 S I=0 F  S I=$O(^XTMP("XPDI",XPDA,"KRN",101,I)) Q:'I  S X=^(I,0) D
"RTN","XPDI",95,0)
 .S Y=$O(^ORD(101,"B",$P(X,U),0))
"RTN","XPDI",96,0)
 .I Y,$D(^ORD(101,Y,0)) S ^TMP($J,"XQOO",XPDSET,101,Y)=$P(^(0),U,1,2)
"RTN","XPDI",97,0)
 Q
"RTN","XPDI",98,0)
XPDIJ N DIE,XPDA,XCM,XCN,XCS,X
"RTN","XPDI",99,0)
 S XPDA=XPDIJ,DIE="^XTMP(""XPDI"",XPDIJ,""RTN"",""XPDIJ"",",XCN=0,X="XPDIJ"
"RTN","XPDI",100,0)
 X ^%ZOSF("SAVE")
"RTN","XPDI",101,0)
 S XCN=$$RTNUP^XPDUTL("XPDIJ",2)
"RTN","XPDI",102,0)
 Q
"RTN","XPDI",103,0)
 ;
"RTN","XPDI",104,0)
ABORT(XPDA,XPDK,XPDALL) ;abort install of Build XPDA
"RTN","XPDI",105,0)
 N %,DA,DIK,XPDJ,XPDNM,Y
"RTN","XPDI",106,0)
 Q:'$D(^XPD(9.7,XPDA,0))  S XPDNM=$P(^(0),U)
"RTN","XPDI",107,0)
 W !,XPDNM," Build will not be installed",$S(XPDK=1:", Transport Global deleted!",1:""),! Q:XPDK=2
"RTN","XPDI",108,0)
 S DIK="^XPD(9.7,",XPDJ=XPDT("NM",XPDNM),DA=XPDA
"RTN","XPDI",109,0)
 K XPDT("NM",XPDNM),XPDT("DA",XPDA),XPDT(XPDJ),XPDT("GP"),^XTMP("XPDI",XPDA)
"RTN","XPDI",110,0)
 I '$G(XPDALL),XPDA=XPDST S Y=$O(XPDT(0)) D:Y
"RTN","XPDI",111,0)
 .S XPDST=+XPDT(Y),XPDT(1)=XPDT(Y),XPDT("DA",XPDST)=1,XPDT("NM",$P(XPDT(Y),U,2))=1,XPDIT=0
"RTN","XPDI",112,0)
 .K XPDT(Y) N XPD
"RTN","XPDI",113,0)
 .S %="XPD(9.7,"""_XPDST_","")",@%@(3)=XPDST,@%@(4)=1
"RTN","XPDI",114,0)
 .F  S Y=$O(XPDT(Y)) Q:'Y  D
"RTN","XPDI",115,0)
 ..S XPD(9.7,+XPDT(Y)_",",3)=XPDST
"RTN","XPDI",116,0)
 .D FILE^DIE("","XPD")
"RTN","XPDI",117,0)
 D ^DIK
"RTN","XPDI",118,0)
 Q
"RTN","XPDI",119,0)
ASKABRT ;ask if want to unload distribution
"RTN","XPDI",120,0)
 N DIR,DIRUT,X,Y
"RTN","XPDI",121,0)
 S XPDQUIT=1,DIR(0)="Y",DIR("A")="Install ABORTED, Want to remove the Transport Globals",DIR("B")="YES"
"RTN","XPDI",122,0)
 W ! D ^DIR I Y D ABRTALL(1)
"RTN","XPDI",123,0)
 Q
"RTN","XPDI",124,0)
ABRTALL(XPDK) ;abort all Builds
"RTN","XPDI",125,0)
 N XPDA
"RTN","XPDI",126,0)
 S XPDT=0
"RTN","XPDI",127,0)
 F  S XPDT=$O(XPDT(XPDT)) Q:'XPDT  S XPDA=+XPDT(XPDT) D ABORT(XPDA,XPDK,1)
"RTN","XPDI",128,0)
 Q
"RTN","XPDIA")
0^4^B18854007
"RTN","XPDIA",1,0)
XPDIA ;SFISC/RSD - Install Pre/Post Actions for Kernel Files ; 13 Oct 95 11:21
"RTN","XPDIA",2,0)
 ;;8.0;KERNEL;**10**;Jul 10, 1995
"RTN","XPDIA",3,0)
 Q
"RTN","XPDIA",4,0)
OPTF1 ;options file pre
"RTN","XPDIA",5,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA",6,0)
 Q
"RTN","XPDIA",7,0)
OPTE1 ;options entry pre
"RTN","XPDIA",8,0)
 N %,I
"RTN","XPDIA",9,0)
 S ^TMP($J,"XPD",DA)=""
"RTN","XPDIA",10,0)
 I XPDFL=2 S XPDQUIT=1 Q
"RTN","XPDIA",11,0)
 I $P(Y,U,3) D:$D(XPDSET)  Q
"RTN","XPDIA",12,0)
 .S $P(^XTMP("XPDI",XPDA,"KRN",19,OLDA,0),U,3)=$P(XPDSET,U,2)
"RTN","XPDIA",13,0)
 .D ADD^XQOO1($P(XPDSET,U),19,DA)
"RTN","XPDIA",14,0)
 S I=^XTMP("XPDI",XPDA,"KRN",19,OLDA,0),%=^DIC(19,DA,0)
"RTN","XPDIA",15,0)
 S $P(I,U,3)=$P(%,U,3)
"RTN","XPDIA",16,0)
 S:$P(I,U,6)="" $P(I,U,6)=$P(%,U,6)
"RTN","XPDIA",17,0)
 I $P($G(^XTMP("XPDI",XPDA,"KRN",19,OLDA,3)),U)="",$L($P($G(^DIC(19,DA,3)),U)) S $P(I,U,16)=$P(%,U,16),$P(^XTMP("XPDI",XPDA,"KRN",19,OLDA,3),U)=$P(^(3),U)
"RTN","XPDIA",18,0)
 S ^XTMP("XPDI",XPDA,"KRN",19,OLDA,0)=I
"RTN","XPDIA",19,0)
 K:$O(^XTMP("XPDI",XPDA,"KRN",19,OLDA,1,0)) ^DIC(19,DA,1)
"RTN","XPDIA",20,0)
 S I=$G(^DIC(19,DA,"U")) I I]"",I'=$G(^XTMP("XPDI",XPDA,"KRN",19,OLDA,"U")) K ^DIC(19,"C",I)
"RTN","XPDIA",21,0)
 S I=0
"RTN","XPDIA",22,0)
 Q:XPDFL=3
"RTN","XPDIA",23,0)
 F  S I=$O(^DIC(19,DA,10,I)) Q:'I  S %=+$G(^(I,0)) K:% ^DIC(19,"AD",%,DA,I)
"RTN","XPDIA",24,0)
 K ^DIC(19,DA,10) Q
"RTN","XPDIA",25,0)
OPTF2 ;options file post
"RTN","XPDIA",26,0)
 N DA,DIK,I,X,Y,Y0
"RTN","XPDIA",27,0)
 S DA=0,DIK=DIC F  S DA=$O(^TMP($J,"XPD",DA)) Q:'DA  D
"RTN","XPDIA",28,0)
 .S Y0=$G(^DIC(19,DA,220)) I Y0]"" S $P(Y0,U)=$$LK("^XMB(3.6)",$P(Y0,U)),$P(Y0,U,3)=$$LK("^XMB(3.8)",$P(Y0,U,3)),^DIC(19,DA,220)=Y0
"RTN","XPDIA",29,0)
 .S Y0=$G(^DIC(19,DA,24)) I Y0]"" S $P(Y0,U)=$$LK("^XTV(8995)",$P(Y0,U)),^DIC(19,DA,220)=Y0
"RTN","XPDIA",30,0)
 .S Y0=^DIC(19,DA,0),$P(Y0,U,12)=$$LK("^DIC(9.4)",$P(Y0,U,12)),$P(Y0,U,7)=$$LK("^DIC(9.2)",$P(Y0,U,7)),^DIC(19,DA,0)=Y0
"RTN","XPDIA",31,0)
 .S I=0 F  S I=$O(^TMP($J,"XPD",DA,10,I)) Q:'I  S Y0=$G(^(I,0)),X=$G(^(U)) D:X]"" MENU(DA,X,Y0)
"RTN","XPDIA",32,0)
 .S (I,X)=0 F  S I=$O(^DIC(19,DA,10,I)) Q:'I  S Y0=$G(^(I,U)) D
"RTN","XPDIA",33,0)
 ..I $L(Y0) D  Q:'Y
"RTN","XPDIA",34,0)
 ...S Y=$$LK("^DIC(19)",Y0)
"RTN","XPDIA",35,0)
 ...K ^DIC(19,DA,10,I,U) S:Y $P(^(0),U)=Y
"RTN","XPDIA",36,0)
 ...K:'Y ^DIC(19,DA,10,I)
"RTN","XPDIA",37,0)
 ..S X=X+1_U_I
"RTN","XPDIA",38,0)
 .S:X $P(^DIC(19,DA,10,0),U,3,4)=$P(X,U,2)_U_+X
"RTN","XPDIA",39,0)
 .D IX1^DIK
"RTN","XPDIA",40,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA",41,0)
 Q
"RTN","XPDIA",42,0)
OPTDEL ;option delete
"RTN","XPDIA",43,0)
 D DEL("^DIC(19,",DUZ)
"RTN","XPDIA",44,0)
 D OPT^XPDIA2
"RTN","XPDIA",45,0)
 Q
"RTN","XPDIA",46,0)
PROF1 ;protocols file pre
"RTN","XPDIA",47,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA",48,0)
 Q
"RTN","XPDIA",49,0)
PROE1 ;protocols entry pre
"RTN","XPDIA",50,0)
 N %,I
"RTN","XPDIA",51,0)
 S ^TMP($J,"XPD",DA)=""
"RTN","XPDIA",52,0)
 I XPDFL=2 S XPDQUIT=1 Q
"RTN","XPDIA",53,0)
 I $P(Y,U,3) Q  D:$D(XPDSET)  Q  ;patch 10, don't disable protocols
"RTN","XPDIA",54,0)
 .S $P(^XTMP("XPDI",XPDA,"KRN",101,OLDA,0),U,3)=$P(XPDSET,U,2)
"RTN","XPDIA",55,0)
 .D ADD^XQOO1($P(XPDSET,U),101,DA)
"RTN","XPDIA",56,0)
 S I=^XTMP("XPDI",XPDA,"KRN",101,OLDA,0),%=^ORD(101,DA,0)
"RTN","XPDIA",57,0)
 S $P(I,U,3)=$P(%,U,3)
"RTN","XPDIA",58,0)
 S:$P(I,U,6)="" $P(I,U,6)=$P(%,U,6)
"RTN","XPDIA",59,0)
 S ^XTMP("XPDI",XPDA,"KRN",101,OLDA,0)=I
"RTN","XPDIA",60,0)
 K:$O(^XTMP("XPDI",XPDA,"KRN",101,OLDA,1,0)) ^ORD(101,DA,1)
"RTN","XPDIA",61,0)
 K ^ORD(101,DA,3) S I=0
"RTN","XPDIA",62,0)
 Q:XPDFL=3
"RTN","XPDIA",63,0)
 F  S I=$O(^ORD(101,DA,10,I)) Q:'I  S %=+$G(^(I,0)) K:% ^ORD(101,"AD",%,DA,I)
"RTN","XPDIA",64,0)
 K ^ORD(101,DA,10) Q
"RTN","XPDIA",65,0)
PROF2 ;protocols file post
"RTN","XPDIA",66,0)
 N DA,DIK,I,X,Y,Y0
"RTN","XPDIA",67,0)
 S DA=0,DIK=DIC F  S DA=$O(^TMP($J,"XPD",DA)) Q:'DA  D
"RTN","XPDIA",68,0)
 .S Y0=^ORD(101,DA,0) S:$L($P(Y0,U,12)) $P(Y0,U,12)=$$LK("^DIC(9.4)",$P(Y0,U,12)),^ORD(101,DA,0)=Y0
"RTN","XPDIA",69,0)
 .S Y0=$P($G(^ORD(101,DA,5)),U),Y=$P(Y0,";",2),Y0=$P(Y0,";")
"RTN","XPDIA",70,0)
 .I $L(Y0) S Y0=$O(@("^"_Y_"""B"","""_Y0_""",0)")),$P(^ORD(101,DA,5),U)=$S(Y0:Y0_";"_Y,1:"")
"RTN","XPDIA",71,0)
 .S I=0 F  S I=$O(^TMP($J,"XPD",DA,10,I)) Q:'I  S Y0=$G(^(I,0)),X=$G(^(U)) D:X]"" MENU(DA,X,Y0)
"RTN","XPDIA",72,0)
 .S (I,X)=0 F  S I=$O(^ORD(101,DA,10,I)) Q:'I  S Y0=$G(^(I,U)) D
"RTN","XPDIA",73,0)
 ..I $L(Y0) D  Q:'Y
"RTN","XPDIA",74,0)
 ...S Y=$$LK("^ORD(101)",Y0)
"RTN","XPDIA",75,0)
 ...K ^ORD(101,DA,10,I,U) S:Y $P(^(0),U)=Y
"RTN","XPDIA",76,0)
 ...K:'Y ^ORD(101,DA,10,I)
"RTN","XPDIA",77,0)
 ..S X=X+1_U_I
"RTN","XPDIA",78,0)
 .S:X $P(^ORD(101,DA,10,0),U,3,4)=$P(X,U,2)_U_+X
"RTN","XPDIA",79,0)
 .S (I,X)=0 F  S I=$O(^ORD(101,DA,3,I)) Q:'I  S Y0=$G(^(I,0)) D
"RTN","XPDIA",80,0)
 ..S Y0=$$LK("^DIC(19.1)",Y0)
"RTN","XPDIA",81,0)
 ..S:Y0 ^ORD(101,DA,3,I,0)=Y0,X=X+1_Y0
"RTN","XPDIA",82,0)
 ..K:'Y0 ^ORD(101,DA,3,I)
"RTN","XPDIA",83,0)
 .D IX1^DIK
"RTN","XPDIA",84,0)
 K ^TMP($J,"XPD")
"RTN","XPDIA",85,0)
 Q
"RTN","XPDIA",86,0)
PRODEL ;option delete
"RTN","XPDIA",87,0)
 D DEL("^ORD(101,",DUZ)
"RTN","XPDIA",88,0)
 Q
"RTN","XPDIA",89,0)
LK(GR,X) ;lookup, GR=global root, X=lookup value
"RTN","XPDIA",90,0)
 Q:$G(X)="" ""
"RTN","XPDIA",91,0)
 N I S I=$O(@GR@("B",X,0))
"RTN","XPDIA",92,0)
 I I,$D(@GR@(I,0))#2 Q I
"RTN","XPDIA",93,0)
 Q ""
"RTN","XPDIA",94,0)
 ;
"RTN","XPDIA",95,0)
MENU(DA,X,X0) ;DA=ien of option/protocol, X=Menu item, X0=0 node of menu item
"RTN","XPDIA",96,0)
 N DIC,DLAYGO,DIK,D0,D1,I,Y,Y0
"RTN","XPDIA",97,0)
 S DIC=$S(XPDFIL=19:"^DIC(19,",1:"^ORD(101,")_DA_",10,",DIC(0)="L",DLAYGO=XPDFIL,(D0,DA(1))=DA
"RTN","XPDIA",98,0)
 S:'$D(@(DIC_"0)")) @(DIC_"0)")=U_$P(^DD(XPDFIL,10,0),U,2)
"RTN","XPDIA",99,0)
 S:$L($G(X0)) DIC("DR")="2///"_$P(X0,U,2)_";3///"_$P(X0,U,3)_$S($L($P(X0,U,4)):";4///"_$P(X0,U,4)_";5///"_$P(X0,U,5)_";6///"_$P(X0,U,6),1:"")
"RTN","XPDIA",100,0)
 D ^DIC
"RTN","XPDIA",101,0)
 Q
"RTN","XPDIA",102,0)
DEL(DIK,DUZ) ;delete
"RTN","XPDIA",103,0)
 N DA,XPDI,XPDF
"RTN","XPDIA",104,0)
 S XPDI=0,DUZ(0)="@",XPDF=+$P(DIK,"(",2)
"RTN","XPDIA",105,0)
 F  S XPDI=$O(^TMP($J,"XPDEL",XPDI)) Q:'XPDI  D
"RTN","XPDIA",106,0)
 .K ^TMP("DIFIXPT",$J) S DA=XPDI
"RTN","XPDIA",107,0)
 .D ^DIK ;FIXPT^DIA3("D",XPDF,XPDI)
"RTN","XPDIA",108,0)
 .I $D(^TMP("DIFIXPT",$J))  D WP^XPDUTL("^TMP(""DIFIXPT"",$J)")
"RTN","XPDIA",109,0)
 Q
"RTN","XPDIB")
0^8^B3837712
"RTN","XPDIB",1,0)
XPDIB ;SFISC/RSD - Backup installed Package ; 26 Oct 95 10:00
"RTN","XPDIB",2,0)
 ;;8.0;KERNEL;**10**;Jul 10, 1995
"RTN","XPDIB",3,0)
EN ;
"RTN","XPDIB",4,0)
 N XCNP,DIF,DIR,DIRUT,XMSUB,XMDUZ,XMDISPI,XMZ,XPD,XPDA,XPDNM,XPDQUIT,XPDST,XPDT,X,Y,%
"RTN","XPDIB",5,0)
 S %="I '$P(^(0),U,9),$D(^XPD(9.7,""ASP"",Y,1,Y)),$D(^XTMP(""XPDI"",Y))",XPDST=$$LOOK^XPDI(%)
"RTN","XPDIB",6,0)
 Q:'XPDST!$D(XPDQUIT)
"RTN","XPDIB",7,0)
 S DIR(0)="F^3:65",DIR("A")="Subject",DIR("?")="Enter the subject for this Packman Backup Message"
"RTN","XPDIB",8,0)
 D ^DIR Q:$D(DIRUT)
"RTN","XPDIB",9,0)
 S XMSUB=Y,XMDUZ=+DUZ
"RTN","XPDIB",10,0)
 D XMZ^XMA2 Q:XMZ<1
"RTN","XPDIB",11,0)
 S Y=$$NOW^XLFDT,%=$$DOW^XLFDT(Y),Y=$$FMTE^XLFDT(Y,2)
"RTN","XPDIB",12,0)
 S X="PACKMAN BACKUP Created on "_%_", "_$P(Y,"@")_" at "_$P(Y,"@",2)
"RTN","XPDIB",13,0)
 I $D(^VA(200,DUZ,0)) S X=X_" by "_$P(^(0),U)_" "
"RTN","XPDIB",14,0)
 S:$D(^XMB("NAME")) X=X_"at "_$P(^("NAME"),U)_" "
"RTN","XPDIB",15,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92A^^^"_DT,^(1,0)="$TXT "_X,XCNP=1
"RTN","XPDIB",16,0)
 S XPDT=0
"RTN","XPDIB",17,0)
 F  S XPDT=$O(XPDT(XPDT)) Q:'XPDT  D
"RTN","XPDIB",18,0)
 .S XPDA=+XPDT(XPDT),XPDNM=$P(XPDT(XPDT),U,2),XPD=""
"RTN","XPDIB",19,0)
 .I '$D(^XTMP("XPDI",XPDA,"RTN")) W !,"No routines for ",XPDNM,! Q
"RTN","XPDIB",20,0)
 .W !,"Loading Routines for ",XPDNM
"RTN","XPDIB",21,0)
 .F  S XPD=$O(^XTMP("XPDI",XPDA,"RTN",XPD)) Q:XPD=""  D ROU(XPD) W "."
"RTN","XPDIB",22,0)
 D EN3^XMD
"RTN","XPDIB",23,0)
 Q
"RTN","XPDIB",24,0)
 ;
"RTN","XPDIB",25,0)
ROU(X) N %N,DIF
"RTN","XPDIB",26,0)
 X ^%ZOSF("TEST") E  W !,"Routine ",X," is not on the disk." Q
"RTN","XPDIB",27,0)
 S XCNP=XCNP+1,^XMB(3.9,XMZ,2,XCNP,0)="$ROU "_X_" (PACKMAN_BACKUP)",DIF="^XMB(3.9,XMZ,2,"
"RTN","XPDIB",28,0)
 X ^%ZOSF("LOAD")
"RTN","XPDIB",29,0)
 S $P(^XMB(3.9,XMZ,2,0),U,3,4)=XCNP_U_XCNP,^(XCNP,0)="$END ROU "_X_" (PACKMAN-BACKUP)"
"RTN","XPDIB",30,0)
 Q
"RTN","XPDRSUM")
0^5^B1716873
"RTN","XPDRSUM",1,0)
XPDRSUM ;SFISC/RWF - Routine checksum utilities ; 13 Oct 95 11:21
"RTN","XPDRSUM",2,0)
 ;;8.0;KERNEL;**10**;Jul 10, 1995
"RTN","XPDRSUM",3,0)
 Q
"RTN","XPDRSUM",4,0)
SUMA(GLO) ;This tag builds the old RSUM value
"RTN","XPDRSUM",5,0)
 ;Call with a reference to a global that has the routine
"RTN","XPDRSUM",6,0)
 N Y,%,%1,%2,%3 S Y=0
"RTN","XPDRSUM",7,0)
 F %=1,3:1 S %1=$G(@GLO@(%,0)),%3=$F(%1," ") Q:'%3  S %3=$S($E(%1,%3)'=";":$L(%1),$E(%1,%3+1)=";":$L(%1),1:%3-2) F %2=1:1:%3 S Y=$A(%1,%2)*%2+Y
"RTN","XPDRSUM",8,0)
 Q Y
"RTN","XPDRSUM",9,0)
SUMB(GLO) ;This tag builds the new RSUM value
"RTN","XPDRSUM",10,0)
 ;Call with a reference to a global that has the routine
"RTN","XPDRSUM",11,0)
 N Y,%,%1,%2,%3 S Y=0
"RTN","XPDRSUM",12,0)
 F %=1,3:1 S %1=$G(@GLO@(%,0)),%3=$F(%1," ") Q:'%3  S %3=$S($E(%1,%3)'=";":$L(%1),$E(%1,%3+1)=";":$L(%1),1:%3-2) F %2=1:1:%3 S Y=$A(%1,%2)*(%2+%)+Y
"RTN","XPDRSUM",13,0)
 Q Y
"RTN","XPDRSUM",14,0)
SUMC(GLO) ;This tag builds the new checksum for global
"RTN","XPDRSUM",15,0)
 ;Call with a reference to a global
"RTN","XPDRSUM",16,0)
 N Y,%,%1,%2,%3,%4,%5
"RTN","XPDRSUM",17,0)
 S Y=0,%=$NA(@GLO),%1=$E(%,1,$L(%)-1),%2=$L(%1)
"RTN","XPDRSUM",18,0)
 F %5=1:1 S GLO=$Q(@GLO) Q:GLO=""!($E(GLO,1,%2)'=%1)  S %3=@GLO F %4=1:1:$L(%3) S Y=$A(%3,%4)*(%4+%5)+Y
"RTN","XPDRSUM",19,0)
 Q Y
"RTN","XPDT")
0^6^B30658329
"RTN","XPDT",1,0)
XPDT ;SFISC/RSD - Transport a package; 25 Oct 95 09:19
"RTN","XPDT",2,0)
 ;;8.0;KERNEL;**2,10**;Jul 10, 1995
"RTN","XPDT",3,0)
EN ;build XTMP("XPDT",ien, XPDA=ien,XPDNM=name
"RTN","XPDT",4,0)
 N DIR,DIRUT,I,POP,XPD,XPDA,XPDERR,XPDGP,XPDH,XPDHD,XPDI,XPDNM,XPDSEQ,XPDSIZ,XPDSIZA,XPDT,XPDTP,XPDVER,X,Y,Z
"RTN","XPDT",5,0)
 K ^TMP($J,"XPD")
"RTN","XPDT",6,0)
 S XPD="First Package Name: ",XPDT=0,DIR(0)="Y",DIR("A")="   Use this Transport Global",DIR("?")="Yes, will use the current Transport Global on your system. No, will create a new one."
"RTN","XPDT",7,0)
 W !!,"Enter the Package Names to be transported. The order in which",!,"they are entered will be the order in which they are installed.",!!
"RTN","XPDT",8,0)
 F  S XPDA=$$DIC^XPDE("AEMQZ",XPD) Q:'XPDA  D  Q:$D(DIRUT)!$D(XPDERR)
"RTN","XPDT",9,0)
 .S:'XPDT XPD="Another Package Name: "
"RTN","XPDT",10,0)
 .S XPDI=$P(Y(0),U)_"^"
"RTN","XPDT",11,0)
 .I $D(XPDT("DA",XPDA)) W "   ",$P(Y(0),U)," already listed",! Q
"RTN","XPDT",12,0)
 .I $P(Y(0),U,3)=2 W "   GLOBAL PACKAGE" D  Q:$D(DIRUT)
"RTN","XPDT",13,0)
 ..I XPDT S DIRUT=1 W !,"A GLOBAL PACKAGE cannot be sent with any other packages" Q
"RTN","XPDT",14,0)
 ..W !?10,"will transport the following globals:",! S X=0,XPDGP=""
"RTN","XPDT",15,0)
 ..F  S X=$O(^XPD(9.6,XPDA,"GLO",X)) Q:'X  S Z=$G(^(X,0)) I $P(Z,U)]"" S XPDGP=XPDGP_($P(Z,U,2)="y")_";"_$P(Z,U)_"^" W ?12,$P(Z,U),!
"RTN","XPDT",16,0)
 ..S XPDERR=1
"RTN","XPDT",17,0)
 .S XPDT=XPDT+1,XPDT(XPDT)=XPDA_U_XPDI,XPDT("DA",XPDA)=XPDT
"RTN","XPDT",18,0)
 .I $D(^XTMP("XPDT",XPDA)) W "     **Transport Global exists**" D ^DIR S $P(XPDT(XPDT),U,3)=Y
"RTN","XPDT",19,0)
 G:'XPDT!$D(DIRUT) QUIT K XPDERR
"RTN","XPDT",20,0)
 W !!,"ORDER   PACKAGE",!
"RTN","XPDT",21,0)
 F XPDT=1:1:XPDT S Y=$P(XPDT(XPDT),U,2) W ?2,XPDT,?7,Y D  W !
"RTN","XPDT",22,0)
 .W:$P(XPDT(XPDT),U,3) "     **will use current Transport Global**"
"RTN","XPDT",23,0)
 S DIR(0)="Y",DIR("A")="OK to continue",DIR("B")="NO",XPDH=""
"RTN","XPDT",24,0)
 W !! D ^DIR G:$D(DIRUT)!'Y QUIT K DIR
"RTN","XPDT",25,0)
 S DIR(0)="SAO^HF:Host File;PM:PackMan",DIR("A")="Transport through (HF)Host File or (PM)PackMan: ",DIR("?")="Enter the method of transport for the package(s)."
"RTN","XPDT",26,0)
 D ^DIR G:$D(DTOUT)!$D(DUOUT) QUIT K DIR
"RTN","XPDT",27,0)
 I Y="" W !,"No Transport Method selected, will only write Transport Global to ^XTMP." S XPDH=""
"RTN","XPDT",28,0)
 S:Y="PM" XPDTP=1
"RTN","XPDT",29,0)
 I Y="HF" D DEV G:POP QUIT
"RTN","XPDT",30,0)
 I $G(XPDTP),XPDT>1 W !!,"You cannot send multiple Builds through PackMan." G QUIT
"RTN","XPDT",31,0)
 W !!
"RTN","XPDT",32,0)
 F XPDT=1:1:XPDT S XPDA=XPDT(XPDT),XPDNM=$P(XPDA,U,2) D  G:$D(XPDERR) ABORT
"RTN","XPDT",33,0)
 .W !?5,XPDNM,"..." Q:$P(XPDA,U,3)
"RTN","XPDT",34,0)
 .S XPDA=+XPDA,XPDVER=$S($P(^XPD(9.6,XPDA,0),U,2):$$VER^XPDUTL(XPDNM)_U_$$PKG^XPDUTL(XPDNM),1:"")
"RTN","XPDT",35,0)
 .K ^XTMP("XPDT",XPDA)
"RTN","XPDT",36,0)
 .I $D(XPDGP) D  S XPDT=1 Q
"RTN","XPDT",37,0)
 ..I $G(XPDTP) S XPDERR=1 Q
"RTN","XPDT",38,0)
 ..I '$$GLOPKG^XPDV(XPDA) S XPDERR=1 Q
"RTN","XPDT",39,0)
 ..F Y="PRE","INIT" I $G(^XPD(9.6,XPDA,Y))]"" S X=^(Y) D
"RTN","XPDT",40,0)
 ...S ^XTMP("XPDT",XPDA,Y)=X,X=$P(X,U,$L(X,U)),%=$$LOAD^XPDTA(X,"0^")
"RTN","XPDT",41,0)
 ..D BLD^XPDTC
"RTN","XPDT",42,0)
 .F X="DD^XPDTC","KRN^XPDTC","QUES^XPDTC","INT^XPDTC","BLD^XPDTC" D @X Q:$D(XPDERR)
"RTN","XPDT",43,0)
 I $G(XPDTP) S XPDA=+XPDT(XPDT) D ^XPDTP G QUIT
"RTN","XPDT",44,0)
 I $L(XPDH) D GO G QUIT
"RTN","XPDT",45,0)
 W !! F XPDT=1:1:XPDT W "Transport Global ^XTMP(""XPDT"","_+XPDT(XPDT)_") created for ",$P(XPDT(XPDT),U,2),!
"RTN","XPDT",46,0)
 Q
"RTN","XPDT",47,0)
DEV N FIL,DIR,IOP,X,Y,%ZIS W !
"RTN","XPDT",48,0)
 D HOME^%ZIS
"RTN","XPDT",49,0)
 S DIR(0)="F^3:45",DIR("A")="Enter a Host File",DIR("?")="Enter a filename and/or path to output package(s).",POP=0
"RTN","XPDT",50,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) S POP=1 Q
"RTN","XPDT",51,0)
 Q:Y=""  S FIL=Y
"RTN","XPDT",52,0)
 S DIR(0)="F^3:80",DIR("A")="Header Comment"
"RTN","XPDT",53,0)
 D ^DIR I $D(DIRUT) S POP=1 Q
"RTN","XPDT",54,0)
 S XPDH=Y,%ZIS="",%ZIS("HFSNAME")=FIL,%ZIS("HFSMODE")="W",IOP="HFS",(XPDSIZ,XPDSIZA)=0,XPDSEQ=1
"RTN","XPDT",55,0)
 I ^%ZOSF("OS")["MSM",FIL?1(1"A",1"B")1":"1.E D  Q:POP
"RTN","XPDT",56,0)
 .S DIR(0)="N^0:5000",DIR("A")="Size of Diskette (1K blocks)",DIR("B")=1400,DIR("?")="Enter the number of 1K blocks which each diskette will hold, 0 means unlimited space"
"RTN","XPDT",57,0)
 .D ^DIR I $D(DIRUT) S POP=1 Q
"RTN","XPDT",58,0)
 .S XPDSIZ=$S(Y:Y*1024,1:0)
"RTN","XPDT",59,0)
 D ^%ZIS I POP W !!,"**Incorrect Host File name**",!,$C(7) Q
"RTN","XPDT",60,0)
 S XPDHD="KIDS Distribution saved on "_$$HTE^XLFDT($H)
"RTN","XPDT",61,0)
 U IO W $$SUM(XPDHD),!,$$SUM(XPDH),!
"RTN","XPDT",62,0)
 U IO(0) Q
"RTN","XPDT",63,0)
 ;
"RTN","XPDT",64,0)
GO S I=1,Y="" U IO
"RTN","XPDT",65,0)
 I $D(XPDGP) W $$SUM("**KIDS**GLOBALS:"_$P(XPDT(1),U,2)_U_XPDGP),! G GO1
"RTN","XPDT",66,0)
 E  F  D  W $$SUM("**KIDS**:"_Y),! Q:I=XPDT  S Y="",I=I+1
"RTN","XPDT",67,0)
 .F I=I:1 S Y=Y_$P(XPDT(I),U,2)_"^" Q:$L(Y)>200!(I=XPDT)
"RTN","XPDT",68,0)
GO1 W ! S XPDSIZA=XPDSIZA+2
"RTN","XPDT",69,0)
 F XPDT=1:1:XPDT S XPDA=+XPDT(XPDT),XPDNM=$P(XPDT(XPDT),U,2) D GW K ^XTMP("XPDT",XPDA)
"RTN","XPDT",70,0)
 W "**END**",!
"RTN","XPDT",71,0)
 I $D(XPDGP) D GPW W "**END**",!
"RTN","XPDT",72,0)
 W "**END**",! D ^%ZISC
"RTN","XPDT",73,0)
 W !!,"Package Transported Successfully",!
"RTN","XPDT",74,0)
 Q
"RTN","XPDT",75,0)
GW ;global write
"RTN","XPDT",76,0)
 N GR,GCK,GL
"RTN","XPDT",77,0)
 S GCK="^XTMP(""XPDT"","_XPDA,GR=GCK_")",GCK=GCK_",",GL=$L(GCK)
"RTN","XPDT",78,0)
 W $$SUM("**INSTALL NAME**",1),!,$$SUM(XPDNM),!
"RTN","XPDT",79,0)
 F  Q:$D(DIRUT)  S GR=$Q(@GR) Q:GR=""!($E(GR,1,GL)'=GCK)  W $$SUM($P(GR,GCK,2),1),!,$$SUM(@GR),!
"RTN","XPDT",80,0)
 Q
"RTN","XPDT",81,0)
GPW ;global package write
"RTN","XPDT",82,0)
 N I,G,GR,GCK,GL
"RTN","XPDT",83,0)
 W !
"RTN","XPDT",84,0)
 F I=1:1 S G=$P(XPDGP,U,I) Q:G=""  D
"RTN","XPDT",85,0)
 .S GR="^"_$P(G,";",2),GCK=$S(GR[")":$E(GR,1,$L(GR)-1)_",",1:GR_"("),GL=$L(GCK)
"RTN","XPDT",86,0)
 .W $$SUM("**GLOBAL**",1),!,$$SUM(GR),!
"RTN","XPDT",87,0)
 .F  Q:$D(DIRUT)  S GR=$Q(@GR) Q:GR=""!($E(GR,1,GL)'=GCK)  W $$SUM($P(GR,GCK,2),1),!,$$SUM(@GR),!
"RTN","XPDT",88,0)
 Q
"RTN","XPDT",89,0)
QUIT F XPDT=1:1:XPDT L -^XPD(9.6,+XPDT(XPDT))
"RTN","XPDT",90,0)
 Q
"RTN","XPDT",91,0)
ABORT W !!,"**TRANSPORT ABORTED**",*7
"RTN","XPDT",92,0)
 D QUIT
"RTN","XPDT",93,0)
 F XPDT=1:1:XPDT K ^XTMP("XPDT",+XPDT(XPDT))
"RTN","XPDT",94,0)
 D ^%ZISC
"RTN","XPDT",95,0)
 Q
"RTN","XPDT",96,0)
SUM(X,Z) ;X=string to write, Z 0=don't check size
"RTN","XPDT",97,0)
 S XPDSIZA=XPDSIZA+$L(X)+2
"RTN","XPDT",98,0)
 ;this code is for MSM system only
"RTN","XPDT",99,0)
 I $G(Z),XPDSIZ,XPDSIZ-XPDSIZA<1024 D
"RTN","XPDT",100,0)
 .W "**CONTINUE**",!,"**END**",!
"RTN","XPDT",101,0)
 .C IO U IO(0)
"RTN","XPDT",102,0)
 .N DIR,G,GR,GCK,GL,I,X,Y
"RTN","XPDT",103,0)
 .W !!,"Diskette #",XPDSEQ," is full."
"RTN","XPDT",104,0)
 .S DIR(0)="E",DIR("A")="Insert the next diskette and Press the return key",DIR("?")="The current diskette is full, insert a new diskette to continue."
"RTN","XPDT",105,0)
 .D ^DIR I $D(DIRUT) D ABORT Q
"RTN","XPDT",106,0)
 .W ! S XPDSEQ=XPDSEQ+1,XPDSIZA=0
"RTN","XPDT",107,0)
 .O @(""""_IO_""":"_IOPAR) U IO
"RTN","XPDT",108,0)
 .W $$SUM("Continuation #"_XPDSEQ_" of "_XPDHD),!,$$SUM(XPDH),!,$$SUM("**SEQ**:"_XPDSEQ),!!
"RTN","XPDT",109,0)
 .S XPDSIZA=XPDSIZA+2
"RTN","XPDT",110,0)
 Q X
"RTN","XPDTC")
0^7^B21839057
"RTN","XPDTC",1,0)
XPDTC ;SFISC/RSD - Transport calls ; 25 Oct 95 09:19
"RTN","XPDTC",2,0)
 ;;8.0;KERNEL;**10**;Jul 10, 1995
"RTN","XPDTC",3,0)
 Q
"RTN","XPDTC",4,0)
 ;^XTMP("XPDT",XPDA,data type,file #,
"RTN","XPDTC",5,0)
 ;XPDA=ien of File 9.6, XPDNM=.01 field
"RTN","XPDTC",6,0)
DD ;build DD
"RTN","XPDTC",7,0)
 N FILE,FGR,FNAM,Z2,Z3,Z4
"RTN","XPDTC",8,0)
 S FILE=0,FGR="^XTMP(""XPDT"",XPDA)",FNAM=$NA(^XPD(9.6,XPDA,4,"APDD"))
"RTN","XPDTC",9,0)
 F  S FILE=$O(^XPD(9.6,XPDA,4,FILE)) Q:'FILE  D
"RTN","XPDTC",10,0)
 .S Z2=$G(^XPD(9.6,XPDA,4,FILE,222)),Z3=$G(^(223)),Z4=$G(^(224))
"RTN","XPDTC",11,0)
 .Q:$$DATA^XPDV(FILE,Z2)
"RTN","XPDTC",12,0)
 .D FIA^DIFROMSU(FILE,"",FNAM,FGR,Z2,Z3,Z4,XPDVER),DIERR:$D(DIERR)
"RTN","XPDTC",13,0)
 Q:'$D(^XTMP("XPDT",XPDA,"FIA"))
"RTN","XPDTC",14,0)
 D DDOUT^DIFROMS("","","",FGR),DIERR:$D(DIERR),DATAOUT^DIFROMS("","","",FGR),DIERR:$D(DIERR)
"RTN","XPDTC",15,0)
 Q
"RTN","XPDTC",16,0)
DIERR ;record error
"RTN","XPDTC",17,0)
 D MSG^DIALOG("EW",.XPD) S XPDERR=1
"RTN","XPDTC",18,0)
 Q
"RTN","XPDTC",19,0)
KRN ;build Kernel Files
"RTN","XPDTC",20,0)
 N %,%1,%2,DA,EACT,FACT,FGR,XPDFILE,XPDOLDA,XPDI,Y0
"RTN","XPDTC",21,0)
 F XPDFILE=1:1 S Y0=$P($T(FILES+XPDFILE^XPDE),";;",2,99) Q:Y0=""  S XPDI(+Y0)=Y0
"RTN","XPDTC",22,0)
 S XPDFILE=0
"RTN","XPDTC",23,0)
 F  S XPDFILE=$O(^XPD(9.6,XPDA,"KRN",XPDFILE)) Q:'XPDFILE  S XPDI=$G(XPDI(XPDFILE)),FACT=$P(XPDI,";",4),EACT=$P(XPDI,";",5) D  Q:$D(XPDERR)  D:FACT]"" ACT(FACT)
"RTN","XPDTC",24,0)
 .S XPDOLDA=0,FGR=$$FILE^XPDV(XPDFILE) I FGR="" S XPDERR=1 Q
"RTN","XPDTC",25,0)
 .K ^TMP($J,"XPD")
"RTN","XPDTC",26,0)
 .F  S XPDOLDA=$O(^XPD(9.6,XPDA,"KRN",XPDFILE,"NM",XPDOLDA)) Q:'XPDOLDA  S Y0=$G(^(XPDOLDA,0)) D
"RTN","XPDTC",27,0)
 ..I $P(Y0,U,3)=1 S DA=$O(@FGR@(" "),-1)+1 F DA=DA:1 Q:'$D(^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA))
"RTN","XPDTC",28,0)
 ..E  S:$P(Y0,U,2) $P(Y0,U)=$P(Y0,"    FILE #") S DA=$$ENTRY^XPDV(Y0)
"RTN","XPDTC",29,0)
 ..I 'DA S XPDERR=1 Q
"RTN","XPDTC",30,0)
 ..S ^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA,-1)=+$P(Y0,U,3)_"^"_XPDOLDA
"RTN","XPDTC",31,0)
 ..I $P(Y0,U,3)=1 S ^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA,0)=$P(Y0,U),$P(^XPD(9.6,XPDA,"KRN",XPDFILE,"NM",XPDOLDA),U,4)="" Q
"RTN","XPDTC",32,0)
 ..M ^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA)=@FGR@(DA)
"RTN","XPDTC",33,0)
 ..D:EACT]"" ACT(EACT)
"RTN","XPDTC",34,0)
 .Q:'$O(^XTMP("XPDT",XPDA,"KRN",XPDFILE,0))
"RTN","XPDTC",35,0)
 .S %=$P(^DIC(XPDFILE,0),U),^XTMP("XPDT",XPDA,"ORD",+$P(XPDI,";",2),XPDFILE)=XPDI,^(XPDFILE,0)=%
"RTN","XPDTC",36,0)
 .Q
"RTN","XPDTC",37,0)
 Q
"RTN","XPDTC",38,0)
QUES ;build from Install Questions multiple
"RTN","XPDTC",39,0)
 N I,J,X,%
"RTN","XPDTC",40,0)
 S X=""
"RTN","XPDTC",41,0)
 F  S X=$O(^XPD(9.6,XPDA,"QUES","B",X)) Q:X=""  S I=$$QUES^XPDV(X) S:'I XPDERR=1 D:I
"RTN","XPDTC",42,0)
 .S J=0 F  S J=$O(^XPD(9.6,XPDA,"QUES",I,J)) Q:J=""  D
"RTN","XPDTC",43,0)
 ..I $L(J)=1!(J="QQ") S ^XTMP("XPDT",XPDA,"QUES",X,$TR(J,"1ABQ","0AB?"))=^(J) Q  ;^(J) ref to ^XPD(9.6,XPDA,"QUES",I,J)
"RTN","XPDTC",44,0)
 ..F %=1:1 Q:'$D(^XPD(9.6,XPDA,"QUES",I,J,%,0))  S ^XTMP("XPDT",XPDA,"QUES",X,$TR(J,"AQ10","A?"),%)=^(0)
"RTN","XPDTC",45,0)
 F I=1:2 S X=$P($T(QUESTION+I),";;",2) Q:X=""  S Y=$P($T(QUESTION+I+1),";;",2) D
"RTN","XPDTC",46,0)
 .S ^XTMP("XPDT",XPDA,"QUES",$P(X,";"),0)=$P(X,";",2),^("A")=$P(X,";",3),^("B")=$P(X,";",4),^("??")=$P(X,";",5) S:Y]"" ^("M")=Y
"RTN","XPDTC",47,0)
 Q
"RTN","XPDTC",48,0)
INT ;build pre,post, & enviroment init routines
"RTN","XPDTC",49,0)
 N %,I,X
"RTN","XPDTC",50,0)
 F I="PRE","INI","INIT" I $G(^XPD(9.6,XPDA,I))]"" S X=^(I) D
"RTN","XPDTC",51,0)
 .S ^XTMP("XPDT",XPDA,I)=X,X=$P(X,U,$L(X,U)) Q:$D(^("RTN",X))
"RTN","XPDTC",52,0)
 .I '$$RTN^XPDV(X) W !,"Routine ",X," **NOT FOUND**" S XPDERR=1 Q
"RTN","XPDTC",53,0)
 .S %=$$LOAD^XPDTA(X,"0^")
"RTN","XPDTC",54,0)
 Q
"RTN","XPDTC",55,0)
BLD ;build Build file, Package file and Order Parameter file
"RTN","XPDTC",56,0)
 N %,DIC,X,XPD,XPDI,XPDV,Y
"RTN","XPDTC",57,0)
 S ^XTMP("XPDT",XPDA,"VER")=$$VERSION^XPDUTL("XU")_U_$$VERSION^XPDUTL("VA FILEMAN")
"RTN","XPDTC",58,0)
 M ^XTMP("XPDT",XPDA,"BLD",XPDA)=^XPD(9.6,XPDA)
"RTN","XPDTC",59,0)
 S XPDI=+$P(^XPD(9.6,XPDA,0),U,2) Q:'XPDI
"RTN","XPDTC",60,0)
 S $P(^XTMP("XPDT",XPDA,"BLD",XPDA,0),U,2)=$$PT^XPDTA("^DIC(9.4)",XPDI)
"RTN","XPDTC",61,0)
 Q:'$D(^DIC(9.4,XPDI))
"RTN","XPDTC",62,0)
 S XPD=$$VER^XPDUTL(XPDNM)_U_$P(^XTMP("XPDT",XPDA,"BLD",XPDA,0),U,4)
"RTN","XPDTC",63,0)
 S:$D(^XTMP("XPDT",XPDA,"BLD",XPDA,1)) XPD(1)=$NA(^(1))
"RTN","XPDTC",64,0)
 S ^XTMP("XPDT",XPDA,"PKG",XPDI,0)=^DIC(9.4,XPDI,0),^XTMP("XPDT",XPDA,"PKG",XPDI,22,0)=$P(^DIC(9.4,XPDI,22,0),"^",1,2)_"^1^1"
"RTN","XPDTC",65,0)
 I XPDNM'["*" D
"RTN","XPDTC",66,0)
 .S XPDV=$$PKGVER^XPDIP(XPDI,.XPD)
"RTN","XPDTC",67,0)
 .F %=1,5,7,20,"DEV","VERSION" M ^XTMP("XPDT",XPDA,"PKG",XPDI,%)=^DIC(9.4,XPDI,%)
"RTN","XPDTC",68,0)
 .M ^XTMP("XPDT",XPDA,"PKG",XPDI,22,1)=^DIC(9.4,XPDI,22,XPDV)
"RTN","XPDTC",69,0)
 E  D
"RTN","XPDTC",70,0)
 .S %=$P(XPD,U),$P(XPD,U)=$P(XPDNM,"*",3),XPDV=$$PKGPAT^XPDIP(XPDI,%,.XPD)
"RTN","XPDTC",71,0)
 .S ^XTMP("XPDT",XPDA,"PKG",XPDI,22,1,0)=^DIC(9.4,XPDI,22,+XPDV,0)
"RTN","XPDTC",72,0)
 .M ^XTMP("XPDT",XPDA,"PKG",XPDI,22,1,"PAH",1)=^DIC(9.4,XPDI,22,+XPDV,"PAH",+$P(XPDV,U,2))
"RTN","XPDTC",73,0)
 ;M ^XTMP("XPDT",XPDA,"PKG",XPDI)=^DIC(9.4,XPDI)
"RTN","XPDTC",74,0)
 S ^XTMP("XPDT",XPDA,"PKG",XPDI,-1)="1^1"
"RTN","XPDTC",75,0)
 S %=+$P(^DIC(9.4,XPDI,0),U,4) S:% $P(^XTMP("XPDT",XPDA,"PKG",XPDI,0),U,4)=$$PT^XPDTA("^DIC(9.2)",%)
"RTN","XPDTC",76,0)
 Q:'$D(^ORD(100.99,1,5,XPDI,0))!$D(XPDGP)
"RTN","XPDTC",77,0)
 M ^XTMP("XPDT",XPDA,"OER",XPDI)=^ORD(100.99,1,5,XPDI)
"RTN","XPDTC",78,0)
 S %=+$P(^ORD(100.99,1,5,XPDI,0),U,4) S:% $P(^XTMP("XPDT",XPDA,"OER",XPDI,0),U,4)=$$PT^XPDTA("^ORD(100.98)",%)
"RTN","XPDTC",79,0)
 Q
"RTN","XPDTC",80,0)
 ;
"RTN","XPDTC",81,0)
ACT(%) ;execute action
"RTN","XPDTC",82,0)
 N EACT,FACT,FGR,K0,Y0
"RTN","XPDTC",83,0)
 S:%'["^" %="^"_%
"RTN","XPDTC",84,0)
 D @% Q
"RTN","XPDTC",85,0)
 ;
"RTN","XPDTC",86,0)
QUESTION ;package install questions
"RTN","XPDTC",87,0)
 ;;XPF1;Y;Shall I write over your |FLAG| File;YES;^D REP^XPDH
"RTN","XPDTC",88,0)
 ;;D XPF1^XPDIQ
"RTN","XPDTC",89,0)
 ;;XPF2;Y;Want my data |FLAG| yours;YES;^D DTA^XPDH
"RTN","XPDTC",90,0)
 ;;D XPF2^XPDIQ
"RTN","XPDTC",91,0)
 ;;XPZ1;Y;Want to DISABLE Scheduled Options and Options;YES;^D OPT^XPDH
"RTN","XPDTC",92,0)
 ;;D XPZ1^XPDIQ
"RTN","XPDTC",93,0)
 ;;XPZ2;Y;Want to MOVE routines to other CPUs;NO;^D RTN^XPDH
"RTN","XPDTC",94,0)
 ;;D XPZ2^XPDIQ
"RTN","XQOO")
0^1^B39667406
"RTN","XQOO",1,0)
XQOO ;SEATTLE/LUKE - Out Of Order, Man ;10/25/95  13:27
"RTN","XQOO",2,0)
 ;;8.0;KERNEL;**10**;Jul 03, 1995
"RTN","XQOO",3,0)
INIT(XQSET) ;Call for Out-of-order set creation, called by KIDS
"RTN","XQOO",4,0)
 ;
"RTN","XQOO",5,0)
 ;The variable XQSET should be null if this is the first pass
"RTN","XQOO",6,0)
 ;or if KIDS thinks the user wants a new set of options
"RTN","XQOO",7,0)
 ;
"RTN","XQOO",8,0)
 S XQINI="",XQK=0 ;XQINI used as a flag to see if it's KIDS calling
"RTN","XQOO",9,0)
 I XQSET]"" S:'$D(^XTMP("XQOO",XQSET,0)) XQSET="^"
"RTN","XQOO",10,0)
 I XQSET="^" G OUT
"RTN","XQOO",11,0)
 I XQSET]"" S XQMESS=$P(^XTMP("XQOO",XQSET,0),U) G ASK1
"RTN","XQOO",12,0)
 ;
"RTN","XQOO",13,0)
EN ;Entry point for Define Out Of Order Options Set option
"RTN","XQOO",14,0)
 S XQK=0,U="^",XQSET=U
"RTN","XQOO",15,0)
 ;
"RTN","XQOO",16,0)
NAME ;Get name for this option set
"RTN","XQOO",17,0)
 W !!,"Enter a short name for this set of options"_$S('$D(XQINI):" and or protocols",1:"")_": " R XQSET:DTIME S:'$T XQSET=U G:XQSET=U OUT
"RTN","XQOO",18,0)
 I XQSET="?" W !!,"Enter a name of 20 characters or less for this set, '^' to quit, or '??' for help" G NAME
"RTN","XQOO",19,0)
 I XQSET["??" S XQH=$S($D(XQINI):"XQOO-KIDSNAME",1:"XQOO-NAME") D EN^XQH G NAME
"RTN","XQOO",20,0)
 I XQSET=""!($L(XQSET)>20) W !!,"Out-of-order sets must be named with 20 or less characters.  Enter '^' to quit." G NAME
"RTN","XQOO",21,0)
 I $D(^XTMP("XQOO",XQSET,0)) D  G:$D(DIRUT) OUT G:Y=0 NAME G ASK1
"RTN","XQOO",22,0)
 .S XQMESS=$P(^XTMP("XQOO",XQSET,0),U)
"RTN","XQOO",23,0)
 .W !!,"WARNING: The Out-of-order set '",XQSET,"' already exists.",!
"RTN","XQOO",24,0)
 .S DIR("A")="Do you want to modify it? (Y/N) " S DIR(0)="Y",DIR("B")="YES" D ^DIR
"RTN","XQOO",25,0)
 .Q
"RTN","XQOO",26,0)
 ;
"RTN","XQOO",27,0)
MESS ;Get the Out Of Order Message
"RTN","XQOO",28,0)
 R !!,"What should the Out Of Order message text be? :",XQMESS:DTIME S:'$T XQMESS=U G:XQMESS=U OUT
"RTN","XQOO",29,0)
 I XQMESS="?" W !!,"This is the message that will be shown with the options",!,"that are made out of order. For instance, ""Laboratory install in progress""" G MESS
"RTN","XQOO",30,0)
 I XQMESS["??" S XQH="XQOO-MESS" D EN^XQH G MESS
"RTN","XQOO",31,0)
 ;
"RTN","XQOO",32,0)
ASK1 S XQFIL=19
"RTN","XQOO",33,0)
ASK ;Get options to mark
"RTN","XQOO",34,0)
 S (XQ,XQN)=""
"RTN","XQOO",35,0)
 W !!,"Enter "_$S(XQFIL=19:"options",1:"protocols")_" you wish to mark as 'Out Of Order': "
"RTN","XQOO",36,0)
 R XQ:DTIME S:'$T XQ=U G:XQ=U OUT G:XQ="" SET I XQ="?" W !!,"Enter an option name, an option preceded by a minus, '^' to quit, or '??' for help." G ASK
"RTN","XQOO",37,0)
 I XQ["??" S XQH="XQOO" D:XQ="??" EN^XQH D:XQ="???" LIST D:XQ="????" LSTFIL S XQH="XQOO-MAIN" D:XQ="?????" EN^XQH G ASK
"RTN","XQOO",38,0)
 I $E(XQ,1,3)="^OP"!($E(XQ,1,3)="^op") S XQFIL=19,XQSWTCH="" G ASK
"RTN","XQOO",39,0)
 I $E(XQ,1,3)="^PR"!($E(XQ,1,3)="^pr") S XQFIL=101,XQSWTCH="" G ASK
"RTN","XQOO",40,0)
 S XQDEL=0 I $E(XQ,1)="-" S XQDEL=1,XQ=$E(XQ,2,99)
"RTN","XQOO",41,0)
 I XQ="*",XQDEL K ^XTMP("XQOO",XQSET) W !," All options removed.  Start again or '^' to quit. " G ASK
"RTN","XQOO",42,0)
 I XQ="*" S XQSTART=1,XQEND="ZZZZZ" D FIND G ASK
"RTN","XQOO",43,0)
 I XQ?.E1"*" S XQSTART=$E(XQ,1,$L(XQ)-1),XQEND=XQSTART_$C(127) D FIND G ASK
"RTN","XQOO",44,0)
 I XQ?1E.E1"-"1E.E W ! S DIR("A")="Do mean the options from "_$P(XQ,"-")_" to "_$P(XQ,"-",2)_"? (Y/N)",DIR("B")="YES",DIR(0)="Y" D ^DIR I Y S XQSTART=$P(XQ,"-",1),XQEND=$P(XQ,"-",2) D FIND G ASK
"RTN","XQOO",45,0)
 S X=XQ,DIC=XQFIL,DIC(0)="MEZ" D ^DIC S:Y'<0 XQ=$P(Y,U,2) I Y<0 W !," ??",*7 G ASK
"RTN","XQOO",46,0)
 I XQDEL K ^XTMP("XQOO",XQSET,XQFIL,+Y) G ASK
"RTN","XQOO",47,0)
 S:$E(Y(0),1,4)'="XQOO" ^XTMP("XQOO",XQSET,XQFIL,+Y)=$P(Y(0),U)_U_$P(Y(0),U,2) G ASK
"RTN","XQOO",48,0)
 ;
"RTN","XQOO",49,0)
FIND ;Find first option in wildcard list
"RTN","XQOO",50,0)
 S XQN="" S:$L(XQSTART)>2 XQN=$E(XQSTART,1,$L(XQSTART)-1)
"RTN","XQOO",51,0)
 I XQFIL=19 F XQI=0:0 S XQN=$O(^DIC(XQFIL,"B",XQN)) Q:XQN=""!($E(XQN,1,$L(XQSTART))=XQSTART)
"RTN","XQOO",52,0)
 E  F XQI=0:0 S XQN=$O(^ORD(101,"B",XQN)) Q:XQN=""!($E(XQN,1,$L(XQSTART))=XQSTART)
"RTN","XQOO",53,0)
 I XQN="" W !," No such ",$S(XQFIL=19:"option(s).",1:"protocol(s).") Q
"RTN","XQOO",54,0)
 S XQSTART=XQN
"RTN","XQOO",55,0)
 I XQFIL=19 S XQON=$O(^DIC(XQFIL,"B",XQN,0)),XQON0=^DIC(XQFIL,+XQON,0)
"RTN","XQOO",56,0)
 E  S XQON=$O(^ORD(XQFIL,"B",XQN,0)),XQON0=^ORD(XQFIL,+XQON,0)
"RTN","XQOO",57,0)
 I XQDEL D DELET Q
"RTN","XQOO",58,0)
 ;
"RTN","XQOO",59,0)
GET ;Get the first option selected and put it in ^XTMP
"RTN","XQOO",60,0)
 S XQN=XQSTART I $E(XQON,1,4)'="XQOO" S ^XTMP("XQOO",XQSET,XQFIL,+XQON)=$P(XQON0,U)_U_$P(XQON0,U,2),XQK=XQK+1
"RTN","XQOO",61,0)
 S DIC=XQFIL,DIC(0)="MZ"
"RTN","XQOO",62,0)
 ;
"RTN","XQOO",63,0)
NEXT ;Find the rest of the options in this range and do likewise
"RTN","XQOO",64,0)
 I XQFIL=19 F  Q:XQN=XQEND  S XQN=$O(^DIC(XQFIL,"B",XQN)) Q:XQN=""!(XQN]XQEND)  S XQON=$O(^DIC(XQFIL,"B",XQN,0)),XQON0=^DIC(XQFIL,+XQON,0) I $E(XQON,1,4)'="XQOO" S ^XTMP("XQOO",XQSET,XQFIL,+XQON)=$P(XQON0,U)_U_$P(XQON0,U,2),XQK=XQK+1
"RTN","XQOO",65,0)
 E  F  Q:XQN=XQEND  S XQN=$O(^ORD(XQFIL,"B",XQN)) Q:XQN=""!(XQN]XQEND)  S XQON=$O(^ORD(XQFIL,"B",XQN,0)),XQON0=^ORD(XQFIL,+XQON,0) I $E(XQON,1,4)'="XQOO" S ^XTMP("XQOO",XQSET,XQFIL,+XQON)=$P(XQON0,U)_U_$P(XQON0,U,2),XQK=XQK+1
"RTN","XQOO",66,0)
 Q
"RTN","XQOO",67,0)
 ;
"RTN","XQOO",68,0)
DELET ;Delete option(s) from the list in ^XTMP
"RTN","XQOO",69,0)
 W !,XQON,"  ",XQSTART,"  ",XQDEL
"RTN","XQOO",70,0)
 S XQN=XQSTART,XQDEL=0
"RTN","XQOO",71,0)
 I XQFIL=19 F  K ^XTMP("XQOO",XQSET,XQFIL,+XQON) S XQN=$O(^DIC(XQFIL,"B",XQN)),XQX=XQK-1 Q:XQN=""!(XQN]XQEND)  S XQON=$O(^DIC(XQFIL,"B",XQN,0))
"RTN","XQOO",72,0)
 E  F  K ^XTMP("XQOO",XQSET,XQFIL,+XQON) S XQN=$O(^ORD(XQFIL,"B",XQN)),XQX=XQK-1 Q:XQN=""!(XQN]XQEND)  S XQON=$O(^ORD(XQFIL,"B",XQN,0))
"RTN","XQOO",73,0)
 Q
"RTN","XQOO",74,0)
 ;
"RTN","XQOO",75,0)
REMOV R !!,"Remove all options previously selected? ",XQ:DTIME S:'$T XQ=U G:XQ[U OUT I XQ["N"!(XQ["n") W !!,"OK, you may continue." G ASK
"RTN","XQOO",76,0)
 K ^XTMP("XQOO",XQSET)
"RTN","XQOO",77,0)
 Q
"RTN","XQOO",78,0)
LSTFIL ;Show Option File
"RTN","XQOO",79,0)
 N XQE,XQR,XQS
"RTN","XQOO",80,0)
 D RANGE^XQOO2(.XQS,.XQE,.XQR) I XQR D BXREF^XQOO2(XQS,XQE)
"RTN","XQOO",81,0)
 Q
"RTN","XQOO",82,0)
 ;
"RTN","XQOO",83,0)
LIST ;List users and options selected so far.
"RTN","XQOO",84,0)
 W @IOF S (XQT,XQM)=0
"RTN","XQOO",85,0)
 F XQFIL0=19,101 D
"RTN","XQOO",86,0)
 .Q:($D(XQINI)&(XQFIL0=101))
"RTN","XQOO",87,0)
 .S XQT=0,XQN="",XQN=$O(^XTMP("XQOO",XQSET,XQFIL0,XQN)) I XQN="" W !!,"No "_$S(XQFIL0=19:"menu options",1:"protocols")_" selected yet" Q
"RTN","XQOO",88,0)
 .W !!,"You will place Out Of Order the following "_$S(XQFIL0=19:"options:",1:"protocols:"),! F XQI=0:0 D:$Y+3>IOSL WAIT Q:XQ=U  W !,$P(^XTMP("XQOO",XQSET,XQFIL0,XQN),U,2)_"   ["_$P(^(XQN),U)_"]   (IEN = "_XQN_")" S XQN=$O(^(XQN)) Q:XQN=""
"RTN","XQOO",89,0)
 .Q
"RTN","XQOO",90,0)
 Q
"RTN","XQOO",91,0)
 ;
"RTN","XQOO",92,0)
WAIT ;Skip to the head of the next page
"RTN","XQOO",93,0)
 I 1 S XQ="" R:IOST["C-" !!,"Press RETURN to continue, or '^' to quit.",XQ:DTIME S:'$T XQ=U W @IOF
"RTN","XQOO",94,0)
 Q
"RTN","XQOO",95,0)
 ;
"RTN","XQOO",96,0)
SET ;Set 0th node in ^XTMP global
"RTN","XQOO",97,0)
 I XQFIL=19,'$D(XQSWTCH),'$D(XQINI) S XQFIL=101 G ASK
"RTN","XQOO",98,0)
 D ^XQDATE
"RTN","XQOO",99,0)
 I $D(^XTMP("XQOO",XQSET,0)) S XQMESS=$P(^(0),U)
"RTN","XQOO",100,0)
 S ^XTMP("XQOO",XQSET,0)=XQMESS_U_%Y_U_$P(^VA(200,DUZ,0),",")
"RTN","XQOO",101,0)
 S ^XTMP("XQOO",0)=DT_U_DT+7
"RTN","XQOO",102,0)
 ;
"RTN","XQOO",103,0)
OUT ;Clean up
"RTN","XQOO",104,0)
 ;
"RTN","XQOO",105,0)
 I '$D(XPDNM),$D(^XTMP("XQOO",XQSET,0)) D
"RTN","XQOO",106,0)
 .S DIR(0)="Y",DIR("B")="N"
"RTN","XQOO",107,0)
 .I $D(XQINI) S DIR("A")="Should I mark these options Out-Of-Order now? (Y/N) "
"RTN","XQOO",108,0)
 .I '$D(XQINI) S DIR("A")="Should I mark these options/protocols out-of-order now? (Y/N) "
"RTN","XQOO",109,0)
 .D ^DIR I Y D OFF^XQOO1(XQSET)
"RTN","XQOO",110,0)
 .Q
"RTN","XQOO",111,0)
 ;
"RTN","XQOO",112,0)
 K %,%Y,XQ,XQDEL,XQEND,XQFIL,XQFIL0,XQI,XQINI,XQK,XQMESS,XQN,XQON,XQON0,XQSTART,XQSWTCH,Y
"RTN","XQOO",113,0)
 Q
"RTN","XQOO1")
0^2^B55261934
"RTN","XQOO1",1,0)
XQOO1   ;Luke/SEA - Out-of-order set calls ;10/13/95  08:16
"RTN","XQOO1",2,0)
 ;;8.0;KERNEL;**10**;Jul 10, 1995
"RTN","XQOO1",3,0)
 ;
"RTN","XQOO1",4,0)
OFF(XQSET) ;Mark options and protocols Out Of Order
"RTN","XQOO1",5,0)
 I '$D(^XTMP("XQOO",XQSET,0))#2 S XQSET="^" Q
"RTN","XQOO1",6,0)
 S XQMESS=$P(^XTMP("XQOO",XQSET,0),U)
"RTN","XQOO1",7,0)
 ;
"RTN","XQOO1",8,0)
 S XQN=0
"RTN","XQOO1",9,0)
 I $D(^XTMP("XQOO",XQSET,19)) F  Q:XQN=""  D
"RTN","XQOO1",10,0)
 .S XQN=$O(^XTMP("XQOO",XQSET,19,XQN))
"RTN","XQOO1",11,0)
 .Q:XQN=""
"RTN","XQOO1",12,0)
 .I $D(^DIC(19,XQN,0))#2,$P(^(0),U,3)="" S $P(^(0),U,3)=XQMESS,DA=XQN D REDO^XQ7
"RTN","XQOO1",13,0)
 .Q
"RTN","XQOO1",14,0)
 ;
"RTN","XQOO1",15,0)
 I '$D(XPDSET) D
"RTN","XQOO1",16,0)
 .S XQN=0
"RTN","XQOO1",17,0)
 .I $D(^XTMP("XQOO",XQSET,101)) F  Q:XQN=""  D
"RTN","XQOO1",18,0)
 ..S XQN=$O(^XTMP("XQOO",XQSET,101,XQN))
"RTN","XQOO1",19,0)
 ..Q:XQN=""
"RTN","XQOO1",20,0)
 ..I $D(^ORD(101,XQN,0))#2,$P(^(0),U,3)="" S $P(^(0),U,3)=XQMESS
"RTN","XQOO1",21,0)
 ..Q
"RTN","XQOO1",22,0)
 .Q
"RTN","XQOO1",23,0)
 D KICK^XQ7
"RTN","XQOO1",24,0)
 G OUT
"RTN","XQOO1",25,0)
 ;
"RTN","XQOO1",26,0)
ON(XQSET) ;Remove Out Of Order messages from the set XQSET
"RTN","XQOO1",27,0)
 I '$D(^XTMP("XQOO",XQSET,0))#2 S XQSET="^" Q
"RTN","XQOO1",28,0)
 S XQMESS=$P(^XTMP("XQOO",XQSET,0),U)
"RTN","XQOO1",29,0)
 ;
"RTN","XQOO1",30,0)
 S XQN=0
"RTN","XQOO1",31,0)
 I $D(^XTMP("XQOO",XQSET,19)) F  Q:XQN=""  D
"RTN","XQOO1",32,0)
 .S XQN=$O(^XTMP("XQOO",XQSET,19,XQN))
"RTN","XQOO1",33,0)
 .Q:XQN=""
"RTN","XQOO1",34,0)
 .I $D(^DIC(19,XQN,0))#2,$P(^(0),U,3)=XQMESS S $P(^(0),U,3)="",DA=XQN D REDO^XQ7
"RTN","XQOO1",35,0)
 .Q
"RTN","XQOO1",36,0)
 ;
"RTN","XQOO1",37,0)
 I '$D(XPDSET) D
"RTN","XQOO1",38,0)
 .S XQN=0
"RTN","XQOO1",39,0)
 .I $D(^XTMP("XQOO",XQSET,101)) F  Q:XQN=""  D
"RTN","XQOO1",40,0)
 ..S XQN=$O(^XTMP("XQOO",XQSET,101,XQN))
"RTN","XQOO1",41,0)
 ..Q:XQN=""
"RTN","XQOO1",42,0)
 ..I $D(^ORD(101,XQN,0))#2,$P(^(0),U,3)=XQMESS S $P(^(0),U,3)=""
"RTN","XQOO1",43,0)
 ..Q
"RTN","XQOO1",44,0)
 .Q
"RTN","XQOO1",45,0)
 ;
"RTN","XQOO1",46,0)
 I '$D(XPDSET) D
"RTN","XQOO1",47,0)
 .S DIR(0)="Y",DIR("B")="Y"
"RTN","XQOO1",48,0)
 .S DIR("A")="Should I remove the option set "_XQSET_" from ^XTMP?"
"RTN","XQOO1",49,0)
 .S DIR("?")=XQSET_" is the list of options and/or protocols you just turned on."
"RTN","XQOO1",50,0)
 .D ^DIR
"RTN","XQOO1",51,0)
 .I Y K ^XTMP("XQOO",XQSET)
"RTN","XQOO1",52,0)
 .K DIR,Y
"RTN","XQOO1",53,0)
 .Q
"RTN","XQOO1",54,0)
 G OUT
"RTN","XQOO1",55,0)
 ;
"RTN","XQOO1",56,0)
ADD(XQSET,XQFIL,XQN) ; 
"RTN","XQOO1",57,0)
 I '$D(^XTMP("XQOO",XQSET,0)) S XQSET="^" Q
"RTN","XQOO1",58,0)
 S XQMESS=$P(^XTMP("XQOO",XQSET,0),U)
"RTN","XQOO1",59,0)
 S XQGL=$S(XQFIL=19:"^DIC(",1:"^ORD(")
"RTN","XQOO1",60,0)
 S %=@(XQGL_XQFIL_","_XQN_",0)"),^XTMP("XQOO",XQSET,XQFIL,XQN)=$P(%,U)_"^"_$P(%,U,2)
"RTN","XQOO1",61,0)
 S %="^DIC("_XQFIL_","_XQN_",0)",$P(%,U,3)=XQMESS
"RTN","XQOO1",62,0)
 ;
"RTN","XQOO1",63,0)
OUT ;Exit point
"RTN","XQOO1",64,0)
 K %,XQFIL,XQGL,XQMESS,XQN
"RTN","XQOO1",65,0)
 Q
"RTN","XQOO1",66,0)
 ;
"RTN","XQOO1",67,0)
OFFOP ;Option entry for turning off options
"RTN","XQOO1",68,0)
 W !
"RTN","XQOO1",69,0)
 S XQSET=""
"RTN","XQOO1",70,0)
 D GETSET(.XQSET)
"RTN","XQOO1",71,0)
 I XQSET]"" D
"RTN","XQOO1",72,0)
 .S DIR(0)="Y",DIR("B")="N"
"RTN","XQOO1",73,0)
 .S DIR("A")="Mark the options in "_XQSET_" Out-Of Order now"
"RTN","XQOO1",74,0)
 .S DIR("?")="If you answer ""Yes"" you will mark all the options in the set "_XQSET_" Out Of Order."
"RTN","XQOO1",75,0)
 .D ^DIR
"RTN","XQOO1",76,0)
 .I Y D OFF(XQSET)
"RTN","XQOO1",77,0)
 .K DIR,X,Y
"RTN","XQOO1",78,0)
 .Q
"RTN","XQOO1",79,0)
 Q
"RTN","XQOO1",80,0)
 ;
"RTN","XQOO1",81,0)
 ;
"RTN","XQOO1",82,0)
ONOP ;Option entry for turning on options
"RTN","XQOO1",83,0)
 S XQSET=""
"RTN","XQOO1",84,0)
 D GETSET(.XQSET)
"RTN","XQOO1",85,0)
 I XQSET]"" D
"RTN","XQOO1",86,0)
 .S DIR(0)="Y",DIR("B")="Y"
"RTN","XQOO1",87,0)
 .S DIR("A")="Return options in "_XQSET_" to general use"
"RTN","XQOO1",88,0)
 .S DIR("?")="If you answer ""Yes"" you will remove the Out-Of-Order message from the options in the set "_XQSET
"RTN","XQOO1",89,0)
 .D ^DIR
"RTN","XQOO1",90,0)
 .I Y D ON(XQSET)
"RTN","XQOO1",91,0)
 .K DIR,X,Y
"RTN","XQOO1",92,0)
 .Q
"RTN","XQOO1",93,0)
 D KICK^XQ7
"RTN","XQOO1",94,0)
 Q
"RTN","XQOO1",95,0)
 ;
"RTN","XQOO1",96,0)
GETSET(XQSET) ;Get the name of the option set in question 
"RTN","XQOO1",97,0)
 I '$D(^XTMP("XQOO")) W !!,"There are currently no option sets definded in ^XTMP." Q
"RTN","XQOO1",98,0)
 S XQI=0
"RTN","XQOO1",99,0)
 D SETS^XQOO2(.XQI)
"RTN","XQOO1",100,0)
 I XQI=1 S XQSET=0,XQSET=$O(^XTMP("XQOO",XQSET)) Q
"RTN","XQOO1",101,0)
 I XQI>1 D
"RTN","XQOO1",102,0)
 .S DIR(0)="NO^1:"_XQI,DIR("B")=XQI
"RTN","XQOO1",103,0)
 .S DIR("A")=" Please enter the number of the option set you want"
"RTN","XQOO1",104,0)
 .S DIR("?")=" Which option set do you want to work with? 1, "_XQI_" etc."
"RTN","XQOO1",105,0)
 .W !
"RTN","XQOO1",106,0)
 .D ^DIR
"RTN","XQOO1",107,0)
 .S XQSET=0 F XQI=1:1:+Y S XQSET=$O(^XTMP("XQOO",XQSET))
"RTN","XQOO1",108,0)
 .Q
"RTN","XQOO1",109,0)
 K XQI
"RTN","XQOO1",110,0)
 Q
"RTN","XQOO1",111,0)
 ;
"RTN","XQOO1",112,0)
 ;
"RTN","XQOO1",113,0)
REBLD ;Rebuild a "lost" set of options and protocols
"RTN","XQOO1",114,0)
 N XQ,XQMESS,XQOP,XQPROT,XQSET
"RTN","XQOO1",115,0)
 S (XQOP,XQPROT)=0
"RTN","XQOO1",116,0)
 ;
"RTN","XQOO1",117,0)
 S DIR(0)="F^3:30"
"RTN","XQOO1",118,0)
 S DIR("A")=" Please enter the exact Out-Of-Order message"
"RTN","XQOO1",119,0)
 S DIR("?")=" All options/protocols with this message are reclaimed into a set in ^XTMP"
"RTN","XQOO1",120,0)
 D ^DIR G:$D(DIRUT) OUTRE
"RTN","XQOO1",121,0)
 S XQMESS=X K DIR
"RTN","XQOO1",122,0)
 ;
"RTN","XQOO1",123,0)
RE1 S DIR(0)="F^1:20"
"RTN","XQOO1",124,0)
 S DIR("A")=" What do you want to name the recovered set? "
"RTN","XQOO1",125,0)
 S DIR("?")=" Enter any name of up to 20 characters"
"RTN","XQOO1",126,0)
 D ^DIR G:$D(DIRUT) OUTRE
"RTN","XQOO1",127,0)
 S XQSET=X K DIR
"RTN","XQOO1",128,0)
 I $D(^XTMP("XQOO",XQSET,0)) D  G RE1
"RTN","XQOO1",129,0)
 .W !,"Sorry, that set already exists.  Use the Create/Modify option to"
"RTN","XQOO1",130,0)
 .W !?3,"modify it, or choose another name."
"RTN","XQOO1",131,0)
 .Q
"RTN","XQOO1",132,0)
 ;
"RTN","XQOO1",133,0)
REFIND ;Find options and protocols with the message XQMESS
"RTN","XQOO1",134,0)
 S XQ=0 F  S XQ=$O(^DIC(19,XQ)) Q:XQ'=+XQ!(XQ="")  D
"RTN","XQOO1",135,0)
 .Q:$P(^DIC(19,XQ,0),U,3)'=XQMESS
"RTN","XQOO1",136,0)
 .S ^XTMP("XQOO",XQSET,19,XQ)=$P(^DIC(19,XQ,0),U)_U_$P(^(0),U,2)
"RTN","XQOO1",137,0)
 .S XQOP=XQOP+1
"RTN","XQOO1",138,0)
 .Q
"RTN","XQOO1",139,0)
 ;
"RTN","XQOO1",140,0)
 S XQ=0 F  S XQ=$O(^ORD(101,XQ)) Q:XQ'=+XQ!(XQ="")  D
"RTN","XQOO1",141,0)
 .Q:$P(^ORD(101,XQ,0),U,3)'=XQMESS
"RTN","XQOO1",142,0)
 .S ^XTMP("XQOO",XQSET,101,XQ)=$P(^ORD(101,XQ,0),U)_U_$P(^(0),U,2)
"RTN","XQOO1",143,0)
 .S XQPROT=XQPROT+1
"RTN","XQOO1",144,0)
 .Q
"RTN","XQOO1",145,0)
 ;
"RTN","XQOO1",146,0)
 I XQOP>0!(XQPROT>0) D  G OUTRE
"RTN","XQOO1",147,0)
 .D ^XQDATE
"RTN","XQOO1",148,0)
 .S %=$P(^VA(200,DUZ,0),U),%=$P(%,",")
"RTN","XQOO1",149,0)
 .S ^XTMP("XQOO",XQSET,0)=XQMESS_U_%Y_U_%
"RTN","XQOO1",150,0)
 .S ^XTMP("XQOO",0)=DT+7
"RTN","XQOO1",151,0)
 .W !!,"Set named ",XQSET," recovered with ",XQOP," options and ",XQPROT," protocols."
"RTN","XQOO1",152,0)
 .Q
"RTN","XQOO1",153,0)
 E  W !!,"No options or protocols with the message ",XQMESS," were found." G OUTRE
"RTN","XQOO1",154,0)
 Q
"RTN","XQOO1",155,0)
 ;
"RTN","XQOO1",156,0)
OUTRE ;Exit point for REBLD
"RTN","XQOO1",157,0)
 K %,%Y,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,XQ,XQMESS,XQOP,XQPROT,XQSET,Y
"RTN","XQOO1",158,0)
 Q
"RTN","XQOO1",159,0)
 ;
"RTN","XQOO1",160,0)
TOG ;Toggle options and protocols on and off. (XQOOTOG option)
"RTN","XQOO1",161,0)
 N XQ
"RTN","XQOO1",162,0)
 D T1,OUTT,T2,KICK^XQ7
"RTN","XQOO1",163,0)
 ;
"RTN","XQOO1",164,0)
OUTT ;Exit for XQOOTOG
"RTN","XQOO1",165,0)
 K DIC,DTOUT,DUOUT,X,Y
"RTN","XQOO1",166,0)
 Q
"RTN","XQOO1",167,0)
 ;
"RTN","XQOO1",168,0)
T1 ;Toggle options
"RTN","XQOO1",169,0)
 S DIC=19,DIC(0)="AEMQZ",DIC("A")="Enter the name or menu text of an option: "
"RTN","XQOO1",170,0)
 F  W ! D ^DIC Q:$D(DTOUT)!$D(DUOUT)!(Y<0)  D
"RTN","XQOO1",171,0)
 .S XQ=+Y,XQ0=Y(0)
"RTN","XQOO1",172,0)
 .I $P(XQ0,U,3)]"" D
"RTN","XQOO1",173,0)
 ..S XQMESS=$P(XQ0,U,3)
"RTN","XQOO1",174,0)
 ..W !!,"Option ",$P(Y(0),U)," is out with the message '",XQMESS,"'",!
"RTN","XQOO1",175,0)
 ..S DIR(0)="Y",DIR("A")="Put it in service",DIR("B")="YES"
"RTN","XQOO1",176,0)
 ..S DIR("?")="If you answer 'YES' the out-of-order message will be killed, putting the option back in service."
"RTN","XQOO1",177,0)
 ..D ^DIR
"RTN","XQOO1",178,0)
 ..I Y S $P(^DIC(19,XQ,0),U,3)="",DA=XQ D REDO^XQ7
"RTN","XQOO1",179,0)
 ..K DIR,X,Y
"RTN","XQOO1",180,0)
 ..Q
"RTN","XQOO1",181,0)
 .E  W ! D
"RTN","XQOO1",182,0)
 ..S DIR(0)="FA^3:50",DIR("A")="Enter a message to put this option out of order: "
"RTN","XQOO1",183,0)
 ..S DIR("?")="This option is in service.  Enter a string to remove it from use."
"RTN","XQOO1",184,0)
 ..K DIRUT D ^DIR
"RTN","XQOO1",185,0)
 ..I '$D(DIRUT) S $P(^DIC(19,XQ,0),U,3)=Y,DA=XQ D REDO^XQ7
"RTN","XQOO1",186,0)
 ..K DIR,DIRUT,X,Y
"RTN","XQOO1",187,0)
 ..Q
"RTN","XQOO1",188,0)
 .Q
"RTN","XQOO1",189,0)
 Q
"RTN","XQOO1",190,0)
 ;
"RTN","XQOO1",191,0)
T2 ;Toggle protocols
"RTN","XQOO1",192,0)
 S DIC=101,DIC(0)="AEMQZ",DIC("A")="Enter the name or menu text of a protocol: "
"RTN","XQOO1",193,0)
 F  W ! D ^DIC Q:$D(DTOUT)!$D(DUOUT)!(Y<0)  D
"RTN","XQOO1",194,0)
 .S XQ=+Y,XQ0=Y(0)
"RTN","XQOO1",195,0)
 .I $P(XQ0,U,3)]"" D
"RTN","XQOO1",196,0)
 ..S XQMESS=$P(XQ0,U,3)
"RTN","XQOO1",197,0)
 ..W !!,"Protocol ",$P(Y(0),U)," is out with the message '",XQMESS,"'",!
"RTN","XQOO1",198,0)
 ..S DIR(0)="Y",DIR("A")="Put it in service",DIR("B")="YES"
"RTN","XQOO1",199,0)
 ..S DIR("?")="If you answer 'YES' the out-of-order message will be killed, putting the option back in service."
"RTN","XQOO1",200,0)
 ..D ^DIR
"RTN","XQOO1",201,0)
 ..I Y S $P(^ORD(101,XQ,0),U,3)=""
"RTN","XQOO1",202,0)
 ..K DA,DIR,X,Y
"RTN","XQOO1",203,0)
 ..Q
"RTN","XQOO1",204,0)
 .E  W ! D
"RTN","XQOO1",205,0)
 ..S DIR(0)="FA^3:50",DIR("A")="Enter a message to put this protocol out of order: "
"RTN","XQOO1",206,0)
 ..S DIR("?")="This protocol is in service.  Enter a string to remove it from use."
"RTN","XQOO1",207,0)
 ..K DIRUT D ^DIR
"RTN","XQOO1",208,0)
 ..I '$D(DIRUT) S $P(^ORD(101,XQ,0),U,3)=Y
"RTN","XQOO1",209,0)
 ..K DIR,DIRUT,X,Y
"RTN","XQOO1",210,0)
 ..Q
"RTN","XQOO1",211,0)
 .Q
"RTN","XQOO1",212,0)
 Q
"VER")
8.0T20^21.0
**END**
**END**
