EMERGENCY Released IVM*2*92 SEQ #75
Extracted from mail message
**KIDS**:IVM*2.0*92^

**INSTALL NAME**
IVM*2.0*92
"BLD",5080,0)
IVM*2.0*92^INCOME VERIFICATION MATCH^0^3030924^y
"BLD",5080,4,0)
^9.64PA^^
"BLD",5080,"KRN",0)
^9.67PA^8989.52^19
"BLD",5080,"KRN",.4,0)
.4
"BLD",5080,"KRN",.401,0)
.401
"BLD",5080,"KRN",.402,0)
.402
"BLD",5080,"KRN",.403,0)
.403
"BLD",5080,"KRN",.5,0)
.5
"BLD",5080,"KRN",.84,0)
.84
"BLD",5080,"KRN",3.6,0)
3.6
"BLD",5080,"KRN",3.8,0)
3.8
"BLD",5080,"KRN",9.2,0)
9.2
"BLD",5080,"KRN",9.8,0)
9.8
"BLD",5080,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5080,"KRN",9.8,"NM",1,0)
IVMPTRN3^^0^B9077658
"BLD",5080,"KRN",9.8,"NM","B","IVMPTRN3",1)

"BLD",5080,"KRN",19,0)
19
"BLD",5080,"KRN",19.1,0)
19.1
"BLD",5080,"KRN",101,0)
101
"BLD",5080,"KRN",409.61,0)
409.61
"BLD",5080,"KRN",771,0)
771
"BLD",5080,"KRN",870,0)
870
"BLD",5080,"KRN",8989.51,0)
8989.51
"BLD",5080,"KRN",8989.52,0)
8989.52
"BLD",5080,"KRN",8994,0)
8994
"BLD",5080,"KRN","B",.4,.4)

"BLD",5080,"KRN","B",.401,.401)

"BLD",5080,"KRN","B",.402,.402)

"BLD",5080,"KRN","B",.403,.403)

"BLD",5080,"KRN","B",.5,.5)

"BLD",5080,"KRN","B",.84,.84)

"BLD",5080,"KRN","B",3.6,3.6)

"BLD",5080,"KRN","B",3.8,3.8)

"BLD",5080,"KRN","B",9.2,9.2)

"BLD",5080,"KRN","B",9.8,9.8)

"BLD",5080,"KRN","B",19,19)

"BLD",5080,"KRN","B",19.1,19.1)

"BLD",5080,"KRN","B",101,101)

"BLD",5080,"KRN","B",409.61,409.61)

"BLD",5080,"KRN","B",771,771)

"BLD",5080,"KRN","B",870,870)

"BLD",5080,"KRN","B",8989.51,8989.51)

"BLD",5080,"KRN","B",8989.52,8989.52)

"BLD",5080,"KRN","B",8994,8994)

"BLD",5080,"QUES",0)
^9.62^^
"BLD",5080,"REQB",0)
^9.611^1^1
"BLD",5080,"REQB",1,0)
IVM*2.0*34^2
"BLD",5080,"REQB","B","IVM*2.0*34",1)

"MBREQ")
0
"PKG",220,-1)
1^1
"PKG",220,0)
INCOME VERIFICATION MATCH^IVM^IVM Software for interface with the IVM Center
"PKG",220,20,0)
^9.402P^^
"PKG",220,22,0)
^9.49I^1^1
"PKG",220,22,1,0)
2.0^2941021
"PKG",220,22,1,"PAH",1,0)
92^3030924
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IVMPTRN3")
0^1^B9077658
"RTN","IVMPTRN3",1,0)
IVMPTRN3 ;ALB/KCL - SEND INITIAL TRANSMISSION TO IVM CENTER ; 9/24/03
"RTN","IVMPTRN3",2,0)
 ;;2.0;INCOME VERIFICATION MATCH;**1,9,34,92**; 21-OCT-94
"RTN","IVMPTRN3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IVMPTRN3",4,0)
 ;
"RTN","IVMPTRN3",5,0)
FILE ; - call HL7 to send batch of segments
"RTN","IVMPTRN3",6,0)
 ;
"RTN","IVMPTRN3",7,0)
 I IVMCT'>0 Q
"RTN","IVMPTRN3",8,0)
 ;
"RTN","IVMPTRN3",9,0)
 N HLRESLT
"RTN","IVMPTRN3",10,0)
 ;
"RTN","IVMPTRN3",11,0)
 ; - send batch of HL7 messages
"RTN","IVMPTRN3",12,0)
 D GENERATE^HLMA(HLEID,"GB",1,.HLRESLT,MTIEN)
"RTN","IVMPTRN3",13,0)
 ;
"RTN","IVMPTRN3",14,0)
 K ^TMP("HLS",$J)
"RTN","IVMPTRN3",15,0)
 S IVMGTOT=$G(IVMGTOT)+HLEVN
"RTN","IVMPTRN3",16,0)
 S (HLEVN,IVMCT)=0
"RTN","IVMPTRN3",17,0)
 Q
"RTN","IVMPTRN3",18,0)
 ;
"RTN","IVMPTRN3",19,0)
FILE1 ; - call HL7 to send batch of segments
"RTN","IVMPTRN3",20,0)
 ; (V1.6 - call this if non-ack batch but still has an MSA segment.)
"RTN","IVMPTRN3",21,0)
 ; Called by ^IVMPTRN and ^IVMPTRN7 with ^TMP("HLS",$J) global set.
"RTN","IVMPTRN3",22,0)
 ; Must convert ^TMP("HLS" into ^TMP("HLA" for GENACK^HLMA1 to work.
"RTN","IVMPTRN3",23,0)
 ;
"RTN","IVMPTRN3",24,0)
 I IVMCT'>0 Q
"RTN","IVMPTRN3",25,0)
 ;
"RTN","IVMPTRN3",26,0)
 N HLP,HLRESLTA
"RTN","IVMPTRN3",27,0)
 S HLEIDS=$O(^ORD(101,HLEID,775,"B",0))
"RTN","IVMPTRN3",28,0)
 ;
"RTN","IVMPTRN3",29,0)
 ; - send batch of HL7 messages
"RTN","IVMPTRN3",30,0)
 K ^TMP("HLA",$J)
"RTN","IVMPTRN3",31,0)
 M ^TMP("HLA",$J)=^TMP("HLS",$J)
"RTN","IVMPTRN3",32,0)
 D GENACK^HLMA1(HLEID,MTIEN,HLEIDS,"GB",1,.HLRESLTA,.HLP)
"RTN","IVMPTRN3",33,0)
 ;
"RTN","IVMPTRN3",34,0)
 K ^TMP("HLS",$J)
"RTN","IVMPTRN3",35,0)
 K ^TMP("HLA",$J)
"RTN","IVMPTRN3",36,0)
 S IVMGTOT=$G(IVMGTOT)+HLEVN
"RTN","IVMPTRN3",37,0)
 S (HLEVN,IVMCT)=0
"RTN","IVMPTRN3",38,0)
 Q
"RTN","IVMPTRN3",39,0)
 ;
"RTN","IVMPTRN3",40,0)
FILEPT(DFN,IVMYR,WHEN,MSGID,EVENTS,MTSTAT,INSSTAT) ;
"RTN","IVMPTRN3",41,0)
 ;Description: File patient in IVM PATIENT (#301.5) file and file
"RTN","IVMPTRN3",42,0)
 ;TRANSMISSION LOG entry.
"RTN","IVMPTRN3",43,0)
 ;
"RTN","IVMPTRN3",44,0)
 ;Input:
"RTN","IVMPTRN3",45,0)
 ;  DFN - ien of record in the PATIENT file.
"RTN","IVMPTRN3",46,0)
 ;  IVMYR - income year of the ORU~Z07 message.
"RTN","IVMPTRN3",47,0)
 ;  WHEN -  date/time message sent, in FM format.
"RTN","IVMPTRN3",48,0)
 ;  MSGID - message id used for message, in format used by MESSAGE CONTROL ID field.
"RTN","IVMPTRN3",49,0)
 ;  EVENTS () - an array of reasons for transmission, pass by reference.
"RTN","IVMPTRN3",50,0)
 ;  EVENTS("IVM") = 1 if transmission due to IVM criteria, 0 otherwise
"RTN","IVMPTRN3",51,0)
 ;  EVENTS(" "DCD")=1 if transmission due to DCD criteria, 0 otherwise
"RTN","IVMPTRN3",52,0)
 ;  EVENTS("ENROLL")=1 if transmission due to enrollment criteria, 0 otherwise
"RTN","IVMPTRN3",53,0)
 ;  MTSTAT - pointer to the MEANS TEST STATUS file.  Is the status of the patient's means test at the time of the transmission for the income year of the transmission.
"RTN","IVMPTRN3",54,0)
 ;  INSSTAT - 1 if the patient had active insurance at the time of the transmission, 0 otherwise.
"RTN","IVMPTRN3",55,0)
 ;
"RTN","IVMPTRN3",56,0)
 N IVMPTR,DGSENFLG
"RTN","IVMPTRN3",57,0)
 ;
"RTN","IVMPTRN3",58,0)
 ; - ignore security checks in MAS (DGSEC)
"RTN","IVMPTRN3",59,0)
 S DGSENFLG=1
"RTN","IVMPTRN3",60,0)
 ;
"RTN","IVMPTRN3",61,0)
 ;find or create entry in IVM PATIENT file
"RTN","IVMPTRN3",62,0)
 S IVMPTR=$$FIND^IVMPLOG(DFN,IVMYR)
"RTN","IVMPTRN3",63,0)
 S:'IVMPTR IVMPTR=$$LOG^IVMPLOG(DFN,IVMYR,.EVENTS)
"RTN","IVMPTRN3",64,0)
 Q:'IVMPTR
"RTN","IVMPTRN3",65,0)
 ;
"RTN","IVMPTRN3",66,0)
 ; Check the 301.5 record for Transmission Status
"RTN","IVMPTRN3",67,0)
 N TRSTAT S TRSTAT=+$P(^IVM(301.5,IVMPTR,0),U,3)
"RTN","IVMPTRN3",68,0)
 ;
"RTN","IVMPTRN3",69,0)
 ; If this record is not updated, update it only
"RTN","IVMPTRN3",70,0)
 I 'TRSTAT D UPDTLOG(IVMPTR,WHEN,MSGID,.EVENTS,MTSTAT,INSSTAT)
"RTN","IVMPTRN3",71,0)
 ;
"RTN","IVMPTRN3",72,0)
 ; If this record is already updated, check all other records
"RTN","IVMPTRN3",73,0)
 ; for this patient that should be updated.
"RTN","IVMPTRN3",74,0)
 I TRSTAT D
"RTN","IVMPTRN3",75,0)
 .N NXTPTR,NXTYR S NXTPTR=0
"RTN","IVMPTRN3",76,0)
 .F  S NXTPTR=$O(^IVM(301.5,"B",DFN,NXTPTR)) Q:'NXTPTR  D
"RTN","IVMPTRN3",77,0)
 ..Q:NXTPTR=IVMPTR
"RTN","IVMPTRN3",78,0)
 ..S TRSTAT=+$P(^IVM(301.5,NXTPTR,0),U,3)
"RTN","IVMPTRN3",79,0)
 ..Q:TRSTAT
"RTN","IVMPTRN3",80,0)
 ..S NXTYR=$P(^IVM(301.5,NXTPTR,0),U,2)
"RTN","IVMPTRN3",81,0)
 ..I $$LOG^IVMPLOG(DFN,NXTYR,.EVENTS)
"RTN","IVMPTRN3",82,0)
 ..D UPDTLOG(NXTPTR,WHEN,MSGID,.EVENTS,MTSTAT,INSSTAT)
"RTN","IVMPTRN3",83,0)
 ;
"RTN","IVMPTRN3",84,0)
 Q
"RTN","IVMPTRN3",85,0)
 ;
"RTN","IVMPTRN3",86,0)
UPDTLOG(IVMPTR,WHEN,MSGID,EVENTS,MTSTAT,INSSTAT) ;
"RTN","IVMPTRN3",87,0)
 ; Update record to TRANSMITTED, and remove duplicates
"RTN","IVMPTRN3",88,0)
 ;
"RTN","IVMPTRN3",89,0)
 ; Update the IVM PATIENT (#301.5) record to a TRANSMITTED status.
"RTN","IVMPTRN3",90,0)
 I $$CLEAR^IVMPLOG(IVMPTR,WHEN)
"RTN","IVMPTRN3",91,0)
 ;
"RTN","IVMPTRN3",92,0)
 ; Add an entry in the IVM TRANSMISSION LOG (#301.6) File.
"RTN","IVMPTRN3",93,0)
 I $$LOG^IVMTLOG(IVMPTR,WHEN,MSGID,.EVENTS,MTSTAT,INSSTAT)
"RTN","IVMPTRN3",94,0)
 ;
"RTN","IVMPTRN3",95,0)
 D DUP(DFN,IVMYR,IVMPTR) ; remove duplicates
"RTN","IVMPTRN3",96,0)
 ;
"RTN","IVMPTRN3",97,0)
 Q
"RTN","IVMPTRN3",98,0)
 ;
"RTN","IVMPTRN3",99,0)
DUP(DFN,IVMYR,IVMPTR) ; remove duplicate entries in file 301.5
"RTN","IVMPTRN3",100,0)
 ;
"RTN","IVMPTRN3",101,0)
 ; Input - IVMPTR - IEN of original entry in file 301.5
"RTN","IVMPTRN3",102,0)
 ;         DFN - IEN of PATIENT file
"RTN","IVMPTRN3",103,0)
 ;         IVMYR - income year
"RTN","IVMPTRN3",104,0)
 ;
"RTN","IVMPTRN3",105,0)
 N DA,DIE,DIK,DR,IVMIEN,X,Y
"RTN","IVMPTRN3",106,0)
 ;
"RTN","IVMPTRN3",107,0)
 S IVMIEN=IVMPTR
"RTN","IVMPTRN3",108,0)
 F  S IVMIEN=$O(^IVM(301.5,"APT",DFN,IVMYR,IVMIEN)) Q:'IVMIEN  D
"RTN","IVMPTRN3",109,0)
 .;remove 301.5 entry
"RTN","IVMPTRN3",110,0)
 .I $$DELETE^IVMPLOG2(IVMIEN) F DA=0:0 S DA=$O(^IVM(301.6,"B",IVMIEN,DA)) Q:'DA  D  ; reset ptrs
"RTN","IVMPTRN3",111,0)
 ..S DIE="^IVM(301.6,",DR=".01///^S X=IVMPTR" D ^DIE
"RTN","IVMPTRN3",112,0)
 Q
"VER")
8.0^22
**END**
**END**
