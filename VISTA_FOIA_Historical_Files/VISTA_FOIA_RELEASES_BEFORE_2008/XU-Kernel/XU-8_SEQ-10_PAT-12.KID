Released XU*8*12 SEQ #10
Extracted from mail message
**KIDS**:XU*8.0*12^

**INSTALL NAME**
XU*8.0*12
"BLD",27,0)
XU*8.0*12^KERNEL^0^^n
"BLD",27,1,0)
^^4^4^2951120^
"BLD",27,1,1,0)
    This patch allows keys to be assigned to a user that does not have a
"BLD",27,1,2,0)
verify code.  On lines XQ6A+7 and U0^XQ6A a FileMan screen was removed
"BLD",27,1,3,0)
that restricted the pool of users in ^VA(200) to those with verify codes,
"BLD",27,1,4,0)
and on line XQ6A+9 an IF statement was removed that had the same effect.
"BLD",27,4,0)
^9.64PA^^
"BLD",27,"ABPKG")
n
"BLD",27,"KRN",0)
^9.67PA^.84^13
"BLD",27,"KRN",.4,0)
.4
"BLD",27,"KRN",.401,0)
.401
"BLD",27,"KRN",.402,0)
.402
"BLD",27,"KRN",.403,0)
.403
"BLD",27,"KRN",.5,0)
.5
"BLD",27,"KRN",.84,0)
.84
"BLD",27,"KRN",3.6,0)
3.6
"BLD",27,"KRN",9.2,0)
9.2
"BLD",27,"KRN",9.8,0)
9.8
"BLD",27,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",27,"KRN",9.8,"NM",1,0)
XQ6A^^0^B22362170
"BLD",27,"KRN",9.8,"NM","B","XQ6A",1)

"BLD",27,"KRN",19,0)
19
"BLD",27,"KRN",19.1,0)
19.1
"BLD",27,"KRN",101,0)
101
"BLD",27,"KRN",8995,0)
8995
"BLD",27,"KRN","B",.4,.4)

"BLD",27,"KRN","B",.401,.401)

"BLD",27,"KRN","B",.402,.402)

"BLD",27,"KRN","B",.403,.403)

"BLD",27,"KRN","B",.5,.5)

"BLD",27,"KRN","B",.84,.84)

"BLD",27,"KRN","B",3.6,3.6)

"BLD",27,"KRN","B",9.2,9.2)

"BLD",27,"KRN","B",9.8,9.8)

"BLD",27,"KRN","B",19,19)

"BLD",27,"KRN","B",19.1,19.1)

"BLD",27,"KRN","B",101,101)

"BLD",27,"KRN","B",8995,8995)

"BLD",27,"QUES",0)
^9.62^^
"PKG",131,-1)
1^1
"PKG",131,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",131,22,0)
^9.49I^1^1
"PKG",131,22,1,0)
8.0^2950729
"PKG",131,22,1,"PAH",1,0)
12
"PKG",131,22,1,"PAH",1,1,0)
^^4^4^2951120
"PKG",131,22,1,"PAH",1,1,1,0)
    This patch allows keys to be assigned to a user that does not have a
"PKG",131,22,1,"PAH",1,1,2,0)
verify code.  On lines XQ6A+7 and U0^XQ6A a FileMan screen was removed
"PKG",131,22,1,"PAH",1,1,3,0)
that restricted the pool of users in ^VA(200) to those with verify codes,
"PKG",131,22,1,"PAH",1,1,4,0)
and on line XQ6A+9 an IF statement was removed that had the same effect.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options and Options
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XQ6A")
0^1^B22362170
"RTN","XQ6A",1,0)
XQ6A ;SEA/AMF,SLC/CJS- BULK KEY DISTRIBUTION ;11/20/95  12:02
"RTN","XQ6A",2,0)
 ;;8.0;KERNEL;**12**;Jul 10, 1995
"RTN","XQ6A",3,0)
HOLDER ;
"RTN","XQ6A",4,0)
 W !!,$S($O(XQHOLD(0))>0:"Another holder: ",1:"Holder of key: ") R X:DTIME S:'$T X=U G:X[U OUT
"RTN","XQ6A",5,0)
 I '$L(X) G:($O(XQHOLD(0))>0) OK W " ??",*7,!,"You have not yet selected any holders." G HOLDER
"RTN","XQ6A",6,0)
 I X["?" S XQH="XQKEYALLOCATE-HOLDER" D:X="?" EN^XQH D:X="??" LSTHOL D:X="???" USERFIL G HOLDER
"RTN","XQ6A",7,0)
 S XQM=0 S:"'-"[$E(X,1) X=$E(X,2,999),XQM=1
"RTN","XQ6A",8,0)
 ;I $E(X,1,2)'="G." S DIC=200,DIC(0)="EZM",DIC("S")="I $L($P(^(0),U,3))" D ^DIC K DIC W:(Y<0) " ??",*7 G:Y<0 HOLDER S XQI=+Y D EACH G HOLDER
"RTN","XQ6A",9,0)
 I $E(X,1,2)'="G." S DIC=200,DIC(0)="EZM" D ^DIC K DIC W:(Y<0) " ??",*7 G:Y<0 HOLDER S XQI=+Y D EACH G HOLDER
"RTN","XQ6A",10,0)
 S X=$E(X,3,999),XMDUZ=DUZ,DIC("S")="D:$P(^(0),U,2)=""PR"" CHK^XMA21",DIC="^XMB(3.8,",DIC(0)="EMZ" D ^DIC K DIC I Y<0 W " ??",*7 G HOLDER
"RTN","XQ6A",11,0)
 ;S XQJ=0 F XQI=1:1 S XQJ=$O(^XMB(3.8,+Y,1,XQJ)) Q:XQJ'>0!(XQJ'=+XQJ)  S XQI=+^(XQJ,0) I $L($P(^VA(200,XQI,0),U,3)) W !,$P(^(0),U,1) D EACH
"RTN","XQ6A",12,0)
 S XQJ=0 F XQI=1:1 S XQJ=$O(^XMB(3.8,+Y,1,XQJ)) Q:XQJ'>0!(XQJ'=+XQJ)  S XQI=+^(XQJ,0) W !,$P(^VA(200,XQI,0),U,1) D EACH
"RTN","XQ6A",13,0)
 G HOLDER
"RTN","XQ6A",14,0)
 ;
"RTN","XQ6A",15,0)
EACH ;Check out each potential user
"RTN","XQ6A",16,0)
 I 'XQBOSS,(XQI=DUZ) W !!,*7,"==> Sorry, you can't give yourself keys.  See your IRM staff." Q
"RTN","XQ6A",17,0)
 I XQM W $S($D(XQHOLD(XQI)):"  Deleted from current list",1:$C(7)_" ??  Holder not on list") K XQHOLD(XQI) Q
"RTN","XQ6A",18,0)
 S XQHOLD(XQI)=""
"RTN","XQ6A",19,0)
 Q
"RTN","XQ6A",20,0)
OK ;
"RTN","XQ6A",21,0)
 D LSTKEY,LSTHOL
"RTN","XQ6A",22,0)
 W !!,"You are ",$S(XQAL&XQDA:"delegating",XQAL:"allocating",XQDA:"removing delegated",1:"deallocating")," keys."
"RTN","XQ6A",23,0)
OK1 R "  Do you wish to proceed? YES// ",X:DTIME S:'$T X=U G:X[U OUT S:(X="") X="Y" I "YyNn"'[$E(X,1) W *7," ??",!,"Please enter 'Y' or 'N'" G OK1
"RTN","XQ6A",24,0)
 I $E(X,1)="N"!($E(X,1)="n") R !!,"Do you wish to start again? NO// ",X:DTIME S:'$T X=U G:X[U OUT S:(X="") X="N" G:X["Y"!(X["y") KEY^XQ6 G:"YyNn"'[$E(X,1) OK1 G OUT
"RTN","XQ6A",25,0)
 ;
"RTN","XQ6A",26,0)
ACT ;Run through list of keys
"RTN","XQ6A",27,0)
 F XQK=0:0 S XQK=$O(XQKEY(XQK)) Q:XQK'>0  W !!,$P(^DIC(19.1,XQK,0),U,1)," being ",$S(XQAL&XQDA:"delegated to",XQAL:"assigned to:",1:"taken away from:") D ACT1
"RTN","XQ6A",28,0)
 ;
"RTN","XQ6A",29,0)
OUT ;Exit point
"RTN","XQ6A",30,0)
 K %,DA,DIC,DIE,DR,XMDUZ,XQBOSS,XQKEY,XQAL,XQHOLD,XQI,XQJ,XQK,XQDA,XQSBNFDT,XQH,XQM,XQNM,X,Y
"RTN","XQ6A",31,0)
 Q
"RTN","XQ6A",32,0)
ACT1 ;Run through list of people
"RTN","XQ6A",33,0)
 F XQM=0:0 S XQM=$O(XQHOLD(XQM)) Q:XQM'>0  D ACT2
"RTN","XQ6A",34,0)
 Q
"RTN","XQ6A",35,0)
ACT2 ;Add keys or DO ACT3 if we're removing them
"RTN","XQ6A",36,0)
 S XQNM=$P(^VA(200,XQM,0),U,1) W !?5,XQNM I 'XQAL D ACT3 Q
"RTN","XQ6A",37,0)
 I $D(^VA(200,XQM,$S(XQDA:52,1:51),XQK)) W ?30,"Person already holds key - no action taken" Q
"RTN","XQ6A",38,0)
 S DIC(0)="NMQ",DIC("P")=$S(XQDA:"200.052PA",1:"200.051PA"),DIC="^VA(200,XQM,"_$S(XQDA:52,1:51)_",",DA(1)=XQM,X=XQK,DINUM=X D FILE^DICN Q
"RTN","XQ6A",39,0)
ACT3 I '$D(^VA(200,XQM,$S(XQDA:52,1:51),XQK)) W ?30,"Person doesn't hold key - no action taken" Q
"RTN","XQ6A",40,0)
 S DIK="^VA(200,XQM,"_$S(XQDA:52,1:51)_",",DA(1)=XQM,DA=XQK D ^DIK Q
"RTN","XQ6A",41,0)
 Q
"RTN","XQ6A",42,0)
LSTKEY ;
"RTN","XQ6A",43,0)
 I $O(XQKEY(0))'>0 W !!,"You have not yet selected any keys." Q
"RTN","XQ6A",44,0)
 W !!,"You've selected the following keys: ",! S XQJ=0,XQI=5 F XQK=0:1 S XQJ=$O(XQKEY(XQJ)) Q:XQJ'>0  W:'(XQK#XQI) ! W ?(XQK#XQI*15),$P(^DIC(19.1,XQJ,0),U,1)
"RTN","XQ6A",45,0)
 Q
"RTN","XQ6A",46,0)
LSTHOL ;
"RTN","XQ6A",47,0)
 I $O(XQHOLD(0))'>0 W !!,"You have not yet selected any holders." Q
"RTN","XQ6A",48,0)
 W !!,"You've selected the following holders: ",! S XQJ=0,XQI=3 F XQK=0:1 S XQJ=$O(XQHOLD(XQJ)) Q:XQJ'>0  W:'(XQK#XQI) ! W ?(XQK#XQI*26),$P(^VA(200,XQJ,0),U,1)
"RTN","XQ6A",49,0)
 Q
"RTN","XQ6A",50,0)
KEYFIL ;
"RTN","XQ6A",51,0)
 I '$D(XQBOSS) S XQBOSS=0 S:(DUZ(0)="@"!($D(^XUSEC("XUMGR",DUZ)))) XQBOSS=1
"RTN","XQ6A",52,0)
 S:'XQBOSS DIC("S")="I $D(^VA(200,DUZ,52,+Y,0))"
"RTN","XQ6A",53,0)
 R !,"Do you want to see the KEY file? NO// ",X:DTIME S:'$T X="N" Q:X'["Y"&(X'["y")  S X="?",DIC="^DIC(19.1,",DIC(0)="Q" D ^DIC K DIC
"RTN","XQ6A",54,0)
 Q
"RTN","XQ6A",55,0)
USERFIL ;
"RTN","XQ6A",56,0)
 R !,"Do you want to see the current holders of a key? NO//",X:DTIME S:'$T X="N" G:X'["Y"&(X'["y") U0
"RTN","XQ6A",57,0)
US0 S DIC=19.1,DIC(0)="AEQMZ" D ^DIC K DIC G:Y<0 U0 W !,"Holders are:" S XQII=0
"RTN","XQ6A",58,0)
US1 S XQII=$O(^VA(200,"AB",+Y,XQII)) G:+XQII'>0 US0 W !?5,$S('$D(^VA(200,XQII,0)):XQII,1:$P(^VA(200,XQII,0),U)) G US1
"RTN","XQ6A",59,0)
U0 R !,"Do you want to see the NEW PERSON file? NO// ",X:DTIME G:X'["Y"&(X'["y") U1 S X="?",DIC="^VA(200,",DIC(0)="Q" ;,DIC("S")="I $L($P(^(0),U,3))"
"RTN","XQ6A",60,0)
 D ^DIC K DIC
"RTN","XQ6A",61,0)
U1 R !,"Do you want to see the members of a Mail Group? NO// ",X:DTIME S:'$T X="N" Q:'(X["Y"!(X["y"))
"RTN","XQ6A",62,0)
U2 S XMDUZ=DUZ,DIC("S")="D:$P(^(0),U,2)=""PR"" CHK^XMA21",DIC="^XMB(3.8,",DIC(0)="AEQMZ" D ^DIC K DIC Q:Y<0  W !,"Members are:" S XQII=0
"RTN","XQ6A",63,0)
U3 S XQII=$O(^XMB(3.8,+Y,1,XQII)) G:+XQII'>0 U2 W !,?5 S X=^(XQII,0) W $S('X:X,'$D(^VA(200,X,0)):X,1:$P(^VA(200,X,0),U,1)) G U3
"RTN","XQ6A",64,0)
 Q
"VER")
8.0T20^21.0
**END**
**END**
