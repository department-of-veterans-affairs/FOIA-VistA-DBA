KIDS Distribution saved on Aug 26, 2003@10:54:50
TRANSITIONAL PHARMACY BENEFIT PROJECT
**KIDS**:PSO TPB ELIGIBILITY 1.0^SD*5.3*300^PSO*7.0*145^

**INSTALL NAME**
PSO TPB ELIGIBILITY 1.0
"BLD",942,0)
PSO TPB ELIGIBILITY 1.0^^1^3030826^y
"BLD",942,1,0)
^^28^28^3030825^
"BLD",942,1,1,0)
This is the Phase I patch of the Transitional Pharmacy Benefit Project
"BLD",942,1,2,0)
(TPB). It provides functionality for the "Medication Prescribed by Non-VA
"BLD",942,1,3,0)
Physicians" directive set by VHA Directive 2003-047. It mandates that for
"BLD",942,1,4,0)
eligible veterans that meet certain criteria, VHA will fill prescriptions
"BLD",942,1,5,0)
written by non-VHA physicians and dentists. To determine eligibility, a
"BLD",942,1,6,0)
patient must meet the following criteria:
"BLD",942,1,7,0)
 
"BLD",942,1,8,0)
1) The patient must be a veteran, and
"BLD",942,1,9,0)
 
"BLD",942,1,10,0)
2) The veteran must be enrolled for VA health Care before July 25, 2003, 
"BLD",942,1,11,0)
   and
"BLD",942,1,12,0)
 
"BLD",942,1,13,0)
3) Before July 25,2003, the veteran must have requested their first 
"BLD",942,1,14,0)
   primary care appointment with the VA, and
"BLD",942,1,15,0)
 
"BLD",942,1,16,0)
4) The veteran must have no active prescriptions dispensed by the local 
"BLD",942,1,17,0)
   VHA pharmacy, excluding Supply and Investigational items, for the past 
"BLD",942,1,18,0)
   485 days from October 22, 2003, and
"BLD",942,1,19,0)
 
"BLD",942,1,20,0)
5) The veteran must be waiting more than 30 days for their first 
"BLD",942,1,21,0)
   appointment with a Primary Care Physician on or after October 22, 
"BLD",942,1,22,0)
   2003, or the veteran is deemed eligible via an Electronic Wait
"BLD",942,1,23,0)
   List/Scheduling extract run at each local site.
"BLD",942,1,24,0)
 
"BLD",942,1,25,0)
 
"BLD",942,1,26,0)
This is a combined build, containing the following 2 patches:
"BLD",942,1,27,0)
SD*5.3*300
"BLD",942,1,28,0)
PSO*7*145
"BLD",942,10,0)
^9.63^2^2
"BLD",942,10,1,0)
SD*5.3*300^1
"BLD",942,10,2,0)
PSO*7.0*145^1
"BLD",942,10,"B","PSO*7.0*145",2)

"BLD",942,10,"B","SD*5.3*300",1)

"BLD",942,"INI")

"BLD",942,"INID")
n^n^
"BLD",942,"INIT")
PSOTPPOS
"BLD",942,"KRN",0)
^9.67PA^8989.52^19
"BLD",942,"KRN",.4,0)
.4
"BLD",942,"KRN",.401,0)
.401
"BLD",942,"KRN",.402,0)
.402
"BLD",942,"KRN",.403,0)
.403
"BLD",942,"KRN",.5,0)
.5
"BLD",942,"KRN",.84,0)
.84
"BLD",942,"KRN",3.6,0)
3.6
"BLD",942,"KRN",3.8,0)
3.8
"BLD",942,"KRN",9.2,0)
9.2
"BLD",942,"KRN",9.8,0)
9.8
"BLD",942,"KRN",19,0)
19
"BLD",942,"KRN",19.1,0)
19.1
"BLD",942,"KRN",101,0)
101
"BLD",942,"KRN",409.61,0)
409.61
"BLD",942,"KRN",771,0)
771
"BLD",942,"KRN",870,0)
870
"BLD",942,"KRN",8989.51,0)
8989.51
"BLD",942,"KRN",8989.52,0)
8989.52
"BLD",942,"KRN",8994,0)
8994
"BLD",942,"KRN","B",.4,.4)

"BLD",942,"KRN","B",.401,.401)

"BLD",942,"KRN","B",.402,.402)

"BLD",942,"KRN","B",.403,.403)

"BLD",942,"KRN","B",.5,.5)

"BLD",942,"KRN","B",.84,.84)

"BLD",942,"KRN","B",3.6,3.6)

"BLD",942,"KRN","B",3.8,3.8)

"BLD",942,"KRN","B",9.2,9.2)

"BLD",942,"KRN","B",9.8,9.8)

"BLD",942,"KRN","B",19,19)

"BLD",942,"KRN","B",19.1,19.1)

"BLD",942,"KRN","B",101,101)

"BLD",942,"KRN","B",409.61,409.61)

"BLD",942,"KRN","B",771,771)

"BLD",942,"KRN","B",870,870)

"BLD",942,"KRN","B",8989.51,8989.51)

"BLD",942,"KRN","B",8989.52,8989.52)

"BLD",942,"KRN","B",8994,8994)

"BLD",942,"PRE")
PSOEN145
"INIT")
PSOTPPOS
"MBREQ")
0
"PRE")
PSOEN145
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSOEN145")
0^^B7868890
"RTN","PSOEN145",1,0)
PSOEN145 ;BIR/RTR-Patch 145 Environment check routine ;08/15/03
"RTN","PSOEN145",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145**;DEC 1997
"RTN","PSOEN145",3,0)
 Q:'XPDENV
"RTN","PSOEN145",4,0)
 N X1,X2,Y
"RTN","PSOEN145",5,0)
 L +^XTMP("SDPSO145"):0 I '$T W !!,"Cannot load this build, someone else is either installing it now,",!,"or the Post-Init for this build is currently running from another install.",! S XPDABORT=2 Q
"RTN","PSOEN145",6,0)
 I $G(^XTMP("SDPSO145","PSOTINIT")) W !!,"Cannot load this build, the Post-Init has already been",!,"queued by another process.",! S XPDABORT=2 L -^XTMP("SDPSO145") Q
"RTN","PSOEN145",7,0)
 W !,"This build contains a post-install that will populate the TPB ELIGIBILITY",!,"(#52.91) File, and the TPB INSTITUTION LETTERS (#52.92) File.",!
"RTN","PSOEN145",8,0)
 K %DT D NOW^%DTC S %DT="RAEX",%DT(0)=%,%DT("A")="Queue the Post-Install to run at what Date@Time: "
"RTN","PSOEN145",9,0)
 D ^%DT K %DT I $D(DTOUT)!(Y<0) W !!,"Cannot install patch without queuing the post-install, install aborted!",! S XPDABORT=2 L -^XTMP("SDPSO145") Q
"RTN","PSOEN145",10,0)
 S ^XTMP("SDPSO145","PSOTINIT")=Y
"RTN","PSOEN145",11,0)
 S X1=DT,X2=+60 D C^%DTC S ^XTMP("SDPSO145",0)=$G(X)_"^"_DT
"RTN","PSOEN145",12,0)
 L -^XTMP("SDPSO145")
"RTN","PSOEN145",13,0)
 Q
"RTN","PSOEN145",14,0)
TEST ;
"RTN","PSOEN145",15,0)
 Q:'$G(XPDENV)
"RTN","PSOEN145",16,0)
 W !,"This build contains a post-install that will populate the TPB ELIGIBILITY",!,"(#52.91) File, and the TPB INSTITUTION LETTERS (#52.92) File.",!
"RTN","PSOEN145",17,0)
 K %DT D NOW^%DTC S %DT="RAEX",%DT(0)=%,%DT("A")="Queue the Post-Install to run at what Date@Time: "
"RTN","PSOEN145",18,0)
 D ^%DT K %DT I $D(DTOUT)!(Y<0) W !!,"Cannot install patch without queuing the post-install, install aborted!",! S XPDABORT=2 Q
"RTN","PSOEN145",19,0)
 S @XPDGREF@("PSOPINIT")=Y
"RTN","PSOEN145",20,0)
 Q
"RTN","PSOTPPOS")
0^^B85484251
"RTN","PSOTPPOS",1,0)
PSOTPPOS ;BIR/RTR-Patch 145 Post Install routine ;07/27/03
"RTN","PSOTPPOS",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145**;DEC 1997
"RTN","PSOTPPOS",3,0)
 ;Reference to SDPHARM supported by DBIA 4193
"RTN","PSOTPPOS",4,0)
 ;Reference to SDPBE supported by DBIA 4194
"RTN","PSOTPPOS",5,0)
 ;Reference to DIC(19 supported by DBIA 2246
"RTN","PSOTPPOS",6,0)
 ;Reference to DIC(4 supported by DBIA 2251
"RTN","PSOTPPOS",7,0)
 ;
"RTN","PSOTPPOS",8,0)
 G FILE
"RTN","PSOTPPOS",9,0)
 N PSOTPLLZ,PSOTPFLG
"RTN","PSOTPPOS",10,0)
 S PSOTPFLG=0
"RTN","PSOTPPOS",11,0)
 S PSOTPLLZ="" F  S PSOTPLLZ=$O(^PS(53,"B","NON-VA",PSOTPLLZ)) Q:PSOTPLLZ=""  D
"RTN","PSOTPPOS",12,0)
 .I $P($G(^PS(53,PSOTPLLZ,0)),"^")="NON-VA" S $P(^(0),"^",6)=5,PSOTPFLG=PSOTPFLG+1
"RTN","PSOTPPOS",13,0)
 I '$G(PSOTPFLG) D BMES^XPDUTL("Could not find a NON-VA entry in the RX PATIENT STATUS file.") D MES^XPDUTL("Please contact National Vista Support!")
"RTN","PSOTPPOS",14,0)
 I $G(PSOTPFLG)>1 D BMES^XPDUTL("Found multiple entries of NON-VA in the RX PATIENT STATUS file.") D MES^XPDUTL("Please contact National Vista Support!")
"RTN","PSOTPPOS",15,0)
 ;
"RTN","PSOTPPOS",16,0)
FILE ;Populate TPB file
"RTN","PSOTPPOS",17,0)
 ;N VARIABLE
"RTN","PSOTPPOS",18,0)
 ;S ZTDTH=""
"RTN","PSOTPPOS",19,0)
 ;I $D(ZTQUEUED) S ZTDTH=$H
"RTN","PSOTPPOS",20,0)
 L +^XTMP("SDPSO145"):0 I '$T D  Q
"RTN","PSOTPPOS",21,0)
 .D BMES^XPDUTL("Post-Init for patch PSO*7*145 is already running.  Halting..")
"RTN","PSOTPPOS",22,0)
 ;I ZTDTH="" D
"RTN","PSOTPPOS",23,0)
 ;.D BMES^XPDUTL("Auto-Populate TPB ELIGIBILITY (#52.91) File.")
"RTN","PSOTPPOS",24,0)
 ;.D BMES^XPDUTL("If no start date/time is entered when prompted, the background job will ")
"RTN","PSOTPPOS",25,0)
 ;.D MES^XPDUTL("be queued to run NOW.")
"RTN","PSOTPPOS",26,0)
 ;.D GETDATE
"RTN","PSOTPPOS",27,0)
 ;.D BMES^XPDUTL("Queuing background job to populate TPB ELIGIBILITY (#52.91) File.")
"RTN","PSOTPPOS",28,0)
 ;S ZTDTH=@XPDGREF@("PSOPINIT")
"RTN","PSOTPPOS",29,0)
 I '$G(^XTMP("SDPSO145","PSOTINIT")) D BMES^XPDUTL("Install aborted, cannot determine post-install task time..") Q
"RTN","PSOTPPOS",30,0)
 S ZTDTH=$G(^XTMP("SDPSO145","PSOTINIT")) L -^XTMP("SDPSO145")
"RTN","PSOTPPOS",31,0)
 S ZTRTN="START^PSOTPPOS",ZTIO="",ZTDESC="Populate TPB ELIGIBILITY FILE" D ^%ZTLOAD K ZTDTH,ZTRTN,ZTIO,ZTDESC
"RTN","PSOTPPOS",32,0)
 I $D(ZTSK)&('$D(ZTQUEUED)) D BMES^XPDUTL("Task Queued!")
"RTN","PSOTPPOS",33,0)
 Q
"RTN","PSOTPPOS",34,0)
START ;Build TPC Eligibility file
"RTN","PSOTPPOS",35,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOTPPOS",36,0)
 S U="^"
"RTN","PSOTPPOS",37,0)
 N PSOACTRX,PSOENRLD,PSOLPQT,PSONODAD,PSOTG1,PSOTG2,PSOTG3,PSOETOT,PSOITOT,PSOTLOCK,PSOTPSNM,PSOSTATI
"RTN","PSOTPPOS",38,0)
 S (PSOETOT,PSOITOT)=0
"RTN","PSOTPPOS",39,0)
 S PSOTLOCK=0
"RTN","PSOTPPOS",40,0)
 L +^XTMP("SDPSO145"):0 I '$T S PSOTLOCK=1 D MAIL S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOTPPOS",41,0)
 K ^XTMP("SDPSO145")
"RTN","PSOTPPOS",42,0)
 S X1=DT,X2=+60 D C^%DTC S ^XTMP("SDPSO145",0)=$G(X)_"^"_DT K X1,X2
"RTN","PSOTPPOS",43,0)
 D NOW^%DTC S Y=% D DD^%DT S ^XTMP("SDPSO145","START")=$G(Y)
"RTN","PSOTPPOS",44,0)
 D ^SDPHARM
"RTN","PSOTPPOS",45,0)
 D ^SDPBE
"RTN","PSOTPPOS",46,0)
 I '$D(^XTMP("SDPSO145","PAT")) G PASS
"RTN","PSOTPPOS",47,0)
 S PSOTG1="" F  S PSOTG1=$O(^XTMP("SDPSO145","PAT","E",PSOTG1)) Q:PSOTG1=""  D
"RTN","PSOTPPOS",48,0)
 .I $D(^PS(52.91,PSOTG1,0)) Q  ;Multiple Installs check
"RTN","PSOTPPOS",49,0)
 .S PSOLPQT=0
"RTN","PSOTPPOS",50,0)
 .S PSOTG2="" F  S PSOTG2=$O(^XTMP("SDPSO145","PAT","E",PSOTG1,PSOTG2)) Q:PSOTG2=""!(PSOLPQT)  S PSOTG3="" F  S PSOTG3=$O(^XTMP("SDPSO145","PAT","E",PSOTG1,PSOTG2,PSOTG3)) Q:PSOTG3=""!(PSOLPQT)  D
"RTN","PSOTPPOS",51,0)
 ..S PSONODAD=$G(^XTMP("SDPSO145","PAT","E",PSOTG1,PSOTG2,PSOTG3))
"RTN","PSOTPPOS",52,0)
 ..I $P($G(^PS(52.91,PSOTG1,0)),"^",5),'PSONODAD D  Q  ;Entry exists, if this date is sooner, replace, if you get a Station Number
"RTN","PSOTPPOS",53,0)
 ...I PSOTG3'<$P($G(^PS(52.91,PSOTG1,0)),"^",5) Q
"RTN","PSOTPPOS",54,0)
 ...I PSOTG2=$P($G(^PS(52.91,PSOTG1,0)),"^",8) K DIE,DA,DR S DIE="^PS(52.91,",DA=PSOTG1,DR="4////"_PSOTG3 D ^DIE K DIE,DA,DR Q
"RTN","PSOTPPOS",55,0)
 ...K PSOTPSNM,PSOSTATI,DIC,DIQ,DD,DR S DIC=4,DR="99",DA=+PSOTG2,DIQ(0)="I",DIQ="PSOSTATI" D EN^DIQ1 S PSOTPSNM=$G(PSOSTATI(4,+PSOTG2,99,"I")) K DIC,DIQ,DR,DA,PSOSTATI
"RTN","PSOTPPOS",56,0)
 ...I $G(PSOTPSNM)="" K PSOTPSNM Q
"RTN","PSOTPPOS",57,0)
 ...K DA,DIE,DR S DIE="^PS(52.91,",DA=PSOTG1,DR="4////"_PSOTG3_";6////"_PSOTPSNM_";7////"_PSOTG2 D ^DIE K DA,DIE,DR
"RTN","PSOTPPOS",58,0)
 ...K PSOTPSNM
"RTN","PSOTPPOS",59,0)
 ..I $D(^PS(52.91,PSOTG1,0)),'PSONODAD D  Q
"RTN","PSOTPPOS",60,0)
 ...I PSOTG2=$P($G(^PS(52.91,PSOTG1,0)),"^",8) K DIE,DA,DR S DIE="^PS(52.91,",DA=PSOTG1,DR="4////"_PSOTG3 D ^DIE K DIE,DA,DR Q
"RTN","PSOTPPOS",61,0)
 ...K PSOTPSNM,PSOSTATI,DIC,DIQ,DD,DR S DIC=4,DR="99",DA=+PSOTG2,DIQ(0)="I",DIQ="PSOSTATI" D EN^DIQ1 S PSOTPSNM=$G(PSOSTATI(4,+PSOTG2,99,"I")) K DIC,DIQ,DR,DA,PSOSTATI
"RTN","PSOTPPOS",62,0)
 ...I $G(PSOTPSNM)="" K PSOTPSNM Q
"RTN","PSOTPPOS",63,0)
 ...K DA,DIE,DR S DIE="^PS(52.91,",DA=PSOTG1,DR="4////"_PSOTG3_";6////"_PSOTPSNM_";7////"_PSOTG2 D ^DIE K DA,DIE,DR
"RTN","PSOTPPOS",64,0)
 ...K PSOTPSNM
"RTN","PSOTPPOS",65,0)
 ..I $D(^PS(52.91,PSOTG1,0)) Q
"RTN","PSOTPPOS",66,0)
 ..K PSOENRLD S PSOENRLD=$$ENR^PSOTPCRX(PSOTG1,3030725) I '$G(PSOENRLD) S ^XTMP("SDPSO145","NOTEN",PSOTG1)="",PSOLPQT=1 Q
"RTN","PSOTPPOS",67,0)
 ..K PSOACTRX S PSOACTRX=$$RX^PSOTPCRX(PSOTG1) I $G(PSOACTRX) D EWL^PSOTPCRX S PSOLPQT=1 Q
"RTN","PSOTPPOS",68,0)
 ..K PSOTPSNM
"RTN","PSOTPPOS",69,0)
 ..K PSOSTATI,DIC,DIQ,DD,DR S DIC=4,DR="99",DA=+PSOTG2,DIQ(0)="I",DIQ="PSOSTATI" D EN^DIQ1 S PSOTPSNM=$G(PSOSTATI(4,+PSOTG2,99,"I")) K DIC,DIQ,DR,DA,PSOSTATI
"RTN","PSOTPPOS",70,0)
 ..I $G(PSOTPSNM)="" S ^XTMP("SDPSO145","PROB1",PSOTG1)="" K PSOTPSNM Q
"RTN","PSOTPPOS",71,0)
 ..I '$D(^PS(52.91,PSOTG1,0)) K DIC S DIC="^PS(52.91,",DIC(0)="L",(X,DINUM)=PSOTG1,DIC("DR")="1////"_DT_";5////"_"E"_";6////"_PSOTPSNM_";7////"_PSOTG2 S:'$G(PSONODAD) DIC("DR")=DIC("DR")_";4////"_PSOTG3 D
"RTN","PSOTPPOS",72,0)
 ...K DD,DO D FILE^DICN K DD,DO,DIE,X,DINUM
"RTN","PSOTPPOS",73,0)
 ...I Y'>0 S ^XTMP("SDPSO145","PROB",PSOTG1)="" Q
"RTN","PSOTPPOS",74,0)
 ...S PSOETOT=PSOETOT+1
"RTN","PSOTPPOS",75,0)
 ...K ^XTMP("SDPSO145","PROB",PSOTG1)
"RTN","PSOTPPOS",76,0)
 ...K ^XTMP("SDPSO145","PROB1",PSOTG1)
"RTN","PSOTPPOS",77,0)
 ;LOOP THROUGH SCHEDULING XTMP HERE
"RTN","PSOTPPOS",78,0)
 D SCH^PSOTPCRX
"RTN","PSOTPPOS",79,0)
PASS ;
"RTN","PSOTPPOS",80,0)
 S ^XTMP("SDPSO145","ELIG")=+$G(PSOETOT)
"RTN","PSOTPPOS",81,0)
 S ^XTMP("SDPSO145","INEL")=+$G(PSOITOT)
"RTN","PSOTPPOS",82,0)
 D EN^PSO145PS
"RTN","PSOTPPOS",83,0)
 D NOW^%DTC S Y=% D DD^%DT S ^XTMP("SDPSO145","STOP")=$G(Y) K Y
"RTN","PSOTPPOS",84,0)
 ;***need HL7 routine name  (moved to phase 2)
"RTN","PSOTPPOS",85,0)
 ;I '$$PATCH^XPDUTL("PSO*7.0*145") S ZTRTN="NAME^EXTRACT",ZTIO="",ZTDESC="TPB EIGIBILITY FILE EXTRACT",ZTDTH=$H D ^%ZTLOAD K ZTRTN,ZTIO,ZTDESC,ZTDTH
"RTN","PSOTPPOS",86,0)
 D MAIL
"RTN","PSOTPPOS",87,0)
 L -^XTMP("SDPSO145")
"RTN","PSOTPPOS",88,0)
 K DA,DIE,DR S DA=$O(^DIC(19,"B","PSO TPB PATIENT ENTER/EDIT",0)) I DA S DIE="^DIC(19,",DR="2////"_"@" D ^DIE K DIE,DA,DR
"RTN","PSOTPPOS",89,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOTPPOS",90,0)
 Q
"RTN","PSOTPPOS",91,0)
MAIL ;
"RTN","PSOTPPOS",92,0)
 N PSOTUCI,PSOTUCI1,XMTEXT,XMSUB,XMDUZ,XMY,PSOMLIN,PSOMLINN,PSOTDEL,PSOMNAME,PSOMLLP,PSOMLCT,PSOSTEXT,PSOQTIME,X,Y,%
"RTN","PSOTPPOS",93,0)
 S PSOMLINN="" S PSOMLIN=$P($G(^XMB(1,1,"XUS")),"^",17) I PSOMLIN'>0 S PSOMLIN=$G(DUZ(2))
"RTN","PSOTPPOS",94,0)
 I PSOMLIN S PSOMLINN=$P($G(^DIC(4,PSOMLIN,0)),"^")
"RTN","PSOTPPOS",95,0)
 S XMSUB=$S($G(PSOMLINN)="":"Unknown Institution",1:$G(PSOMLINN)_" ("_$G(PSOMLIN)_")")_" TPB FILE BUILD"
"RTN","PSOTPPOS",96,0)
 S XMDUZ="Patch PSO*7*145 Post Install" I $G(DUZ) S XMY(DUZ)=""
"RTN","PSOTPPOS",97,0)
 X ^%ZOSF("UCI") S PSOTUCI=$P($G(Y),",") S PSOTUCI1=$P($G(^%ZOSF("PROD")),",") I PSOTUCI=PSOTUCI1 D
"RTN","PSOTPPOS",98,0)
 .S XMY("TEMPLETON,SHANNON@FORUM.VA.GOV")=""
"RTN","PSOTPPOS",99,0)
 .S XMY("BROCKERT,JUDITH@FORUM.VA.GOV")=""
"RTN","PSOTPPOS",100,0)
 .S XMY("CHOW,ANGELA@FORUM.VA.GOV")=""
"RTN","PSOTPPOS",101,0)
 .S XMY("RUZBACKI,RON@FORUM.VA.GOV")=""
"RTN","PSOTPPOS",102,0)
 .S XMY("BARRON,LUANNE@FORUM.VA.GOV")=""
"RTN","PSOTPPOS",103,0)
 .S XMY("WASHINGTON,JANET P@FORUM.VA.GOV")=""
"RTN","PSOTPPOS",104,0)
 I $G(PSOTLOCK) D  G MAILX
"RTN","PSOTPPOS",105,0)
 .D NOW^%DTC S Y=% X ^DD("DD") S PSOQTIME=Y
"RTN","PSOTPPOS",106,0)
 .K PSOSTEXT S PSOSTEXT(1)="The TPB ELIGIBILITY file building, and other post-install functions of",PSOSTEXT(2)="patch PSO*7*145, queued to run at "_$G(PSOQTIME)_",",PSOSTEXT(3)="was NOT run, because the XTMP patient global was locked."
"RTN","PSOTPPOS",107,0)
 .S PSOSTEXT(4)="This Post-Install may have been queued by another user. Please contact",PSOSTEXT(5)="Customer Support."
"RTN","PSOTPPOS",108,0)
 S PSOSTEXT(1)="The Post-Init from Patch PSO*7.0*145 is complete. The TPB ELIGIBILITY",PSOSTEXT(2)="File (#52.91) has been populated.",PSOSTEXT(3)=" "
"RTN","PSOTPPOS",109,0)
 S PSOSTEXT(4)="The job started at "_$G(^XTMP("SDPSO145","START")),PSOSTEXT(5)="The job ended at "_$G(^XTMP("SDPSO145","STOP")),PSOSTEXT(6)=" "
"RTN","PSOTPPOS",110,0)
 S PSOSTEXT(7)="Total number of eligible patients added to file = "_$G(^XTMP("SDPSO145","ELIG")),PSOSTEXT(8)="Total number of ineligible patients added to file = "_$G(^XTMP("SDPSO145","INEL")),PSOSTEXT(9)=" "
"RTN","PSOTPPOS",111,0)
 S PSOMLCT=10
"RTN","PSOTPPOS",112,0)
 S PSOTDEL="" F  S PSOTDEL=$O(^XTMP("SDPSO145","PROB",PSOTDEL)) Q:PSOTDEL=""  I $D(^PS(52.91,PSOTDEL,0)) K ^XTMP("SDPSO145","PROB",PSOTDEL)
"RTN","PSOTPPOS",113,0)
 S PSOTDEL="" F  S PSOTDEL=$O(^XTMP("SDPDO145","PROB1",PSOTDEL)) Q:PSOTDEL=""  I $D(^PS(52.91,PSOTDEL,0)) K ^XTMP("SDPSO145","PROB1",PSOTDEL)
"RTN","PSOTPPOS",114,0)
 I $O(^XTMP("SDPSO145","PROB",0)) D
"RTN","PSOTPPOS",115,0)
 .S PSOSTEXT(PSOMLCT)="The following patients qualify for the Transitional Pharmacy",PSOMLCT=PSOMLCT+1,PSOSTEXT(PSOMLCT)="Benefit, but were unable to be added to the file for unknown reasons:",PSOMLCT=PSOMLCT+1
"RTN","PSOTPPOS",116,0)
 .S PSOMLLP="" F  S PSOMLLP=$O(^XTMP("SDPSO145","PROB",PSOMLLP)) Q:PSOMLLP=""  D
"RTN","PSOTPPOS",117,0)
 ..D PNM
"RTN","PSOTPPOS",118,0)
 ..S PSOSTEXT(PSOMLCT)=$G(PSOMNAME)_$G(^XTMP("SDPSO145","PROB",PSOMLLP)),PSOMLCT=PSOMLCT+1
"RTN","PSOTPPOS",119,0)
 I PSOMLCT>10 S PSOSTEXT(PSOMLCT)=" ",PSOMLCT=PSOMLCT+1
"RTN","PSOTPPOS",120,0)
 I $O(^XTMP("SDPSO145","PROB1",0)) D
"RTN","PSOTPPOS",121,0)
 .S PSOSTEXT(PSOMLCT)="The following patients qualify for the Transitional Pharmacy",PSOMLCT=PSOMLCT+1,PSOSTEXT(PSOMLCT)="Benefit, but were unable to be added to the file because a Station Number",PSOMLCT=PSOMLCT+1
"RTN","PSOTPPOS",122,0)
 .S PSOSTEXT(PSOMLCT)="could not be found for the Institution associated with the patient:",PSOMLCT=PSOMLCT+1
"RTN","PSOTPPOS",123,0)
 .S PSOMLLP="" F  S PSOMLLP=$O(^XTMP("SDPSO145","PROB1",PSOMLLP)) Q:PSOMLLP=""  D
"RTN","PSOTPPOS",124,0)
 ..D PNM
"RTN","PSOTPPOS",125,0)
 ..S PSOSTEXT(PSOMLCT)=$G(PSOMNAME)_$G(^XTMP("SDPSO145","PROB1",PSOMLLP)),PSOMLCT=PSOMLCT+1
"RTN","PSOTPPOS",126,0)
MAILX ;
"RTN","PSOTPPOS",127,0)
 I $O(XMY(""))'="" S XMTEXT="PSOSTEXT(" N DIFROM D ^XMD
"RTN","PSOTPPOS",128,0)
 K PSOSTEXT,XMTEXT,XMSUB,XMDUZ,XMY
"RTN","PSOTPPOS",129,0)
 Q
"RTN","PSOTPPOS",130,0)
GETDATE ;
"RTN","PSOTPPOS",131,0)
 N PSONOW,PSOTODAY,X,Y,PSOSAVEY,PSOSAVEX,PSOXXX
"RTN","PSOTPPOS",132,0)
 S ZTDTH="",PSONOW=0
"RTN","PSOTPPOS",133,0)
 D NOW^%DTC S (Y,PSOTODAY)=% D DD^%DT
"RTN","PSOTPPOS",134,0)
 D BMES^XPDUTL("At the following prompt, enter a starting date@time")
"RTN","PSOTPPOS",135,0)
 D MES^XPDUTL("or enter NOW to queue the job immediately.")
"RTN","PSOTPPOS",136,0)
 D BMES^XPDUTL("If this prompting is during patch installation, you may not see what you type.")
"RTN","PSOTPPOS",137,0)
 W ! K %DT D NOW^%DTC S %DT="RAEX",%DT(0)=%,%DT("A")="Queue TPB Eligibility File building job for what Date@Time: "
"RTN","PSOTPPOS",138,0)
 D ^%DT K %DT I $D(DTOUT)!(Y<0) W "Task will be queued to run NOW" S ZTDTH=$H,PSONOW=1
"RTN","PSOTPPOS",139,0)
 S PSOSAVEY=Y
"RTN","PSOTPPOS",140,0)
 I 'PSONOW,PSOSAVEY>0 D
"RTN","PSOTPPOS",141,0)
 .S Y=PSOSAVEY D DD^%DT
"RTN","PSOTPPOS",142,0)
 .S PSOSAVEX=Y
"RTN","PSOTPPOS",143,0)
 I 'PSONOW,$G(PSOSAVEY)<0 K PSOXXX,PSOSAVEX,PSOSAVEY,X,Y,PSONOW,PSOTODAY G GETDATE
"RTN","PSOTPPOS",144,0)
ASK ;
"RTN","PSOTPPOS",145,0)
 D BMES^XPDUTL("Task will be queued to run "_$S(PSONOW:"NOW",1:PSOSAVEX)_". Is that correct? ")
"RTN","PSOTPPOS",146,0)
 R PSOXXX:300 S:'$T!($G(PSOXXX)="") PSOXXX="Y" S PSOXXX=$$UP^XLFSTR(PSOXXX) I PSOXXX'="Y",PSOXXX'="YES",PSOXXX'="N",PSOXXX'="NO" W "Enter Y or N" G ASK
"RTN","PSOTPPOS",147,0)
 I PSOXXX'="Y",PSOXXX'="YES" K PSOXXX,PSOSAVEX,PSOSAVEY,X,Y,PSONOW,PSOTODAY G GETDATE
"RTN","PSOTPPOS",148,0)
 I PSOSAVEY>0,ZTDTH="" S ZTDTH=PSOSAVEY
"RTN","PSOTPPOS",149,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","PSOTPPOS",150,0)
 Q
"RTN","PSOTPPOS",151,0)
PNM ;
"RTN","PSOTPPOS",152,0)
 N DFN,VADM,VA,VAERR
"RTN","PSOTPPOS",153,0)
 K PSOMNANE,VADM
"RTN","PSOTPPOS",154,0)
 S DFN=+$G(PSOMLLP) I 'DFN Q
"RTN","PSOTPPOS",155,0)
 D DEM^VADPT I $G(VADM(1))="" K VADM Q
"RTN","PSOTPPOS",156,0)
 S PSOMNAME=$G(VADM(1))
"RTN","PSOTPPOS",157,0)
 K VADM
"RTN","PSOTPPOS",158,0)
 K VA,VAERR S DFN=+$G(PSOMLLP) D PID^VADPT6
"RTN","PSOTPPOS",159,0)
 S PSOMNAME=PSOMNAME_" "_"("_$G(VA("BID"))_")"
"RTN","PSOTPPOS",160,0)
 K VA,VAERR
"RTN","PSOTPPOS",161,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
SD*5.3*300
"BLD",938,0)
SD*5.3*300^SCHEDULING^0^3030826^y
"BLD",938,1,0)
^^39^39^3030825^
"BLD",938,1,1,0)
This is the Phase I patch of the Transitional Pharmacy Benefit Project
"BLD",938,1,2,0)
(TPB). This project provides functionality for the "Medication Prescribed 
"BLD",938,1,3,0)
by Non-VA Physicians" to accommodate the Veterans Health Administration 
"BLD",938,1,4,0)
(VHA) Directive 2003-047 that allows Department of Veterans Affairs (VA) 
"BLD",938,1,5,0)
to furnish medications from non-VA physicians.  It mandates that for
"BLD",938,1,6,0)
eligible veterans that meet certain criteria, VHA will fill prescriptions
"BLD",938,1,7,0)
written by non-VA physicians and dentists. To determine eligibility, a
"BLD",938,1,8,0)
patient must meet the following criteria:
"BLD",938,1,9,0)
 
"BLD",938,1,10,0)
1) The patient must be a veteran.
"BLD",938,1,11,0)
 
"BLD",938,1,12,0)
2) The veteran must be enrolled for VA health care system before July 25, 
"BLD",938,1,13,0)
2003.
"BLD",938,1,14,0)
 
"BLD",938,1,15,0)
3) Before July 25,2003, the veteran must have requested their first 
"BLD",938,1,16,0)
   primary care appointment with the VA.
"BLD",938,1,17,0)
 
"BLD",938,1,18,0)
4) The veteran must have no active prescriptions dispensed by the local 
"BLD",938,1,19,0)
   VHA pharmacy, excluding Supply and Investigational items, for the past 
"BLD",938,1,20,0)
   485 days from October 22, 2003.
"BLD",938,1,21,0)
 
"BLD",938,1,22,0)
5) The veteran must be waiting more than 30 days for their first 
"BLD",938,1,23,0)
   appointment with a Primary Care Physician on or after October 22, 
"BLD",938,1,24,0)
   2003, or the veteran is deemed eligible via an Electronic Wait
"BLD",938,1,25,0)
   List/Scheduling extract run at each local site.
"BLD",938,1,26,0)
 
"BLD",938,1,27,0)
 
"BLD",938,1,28,0)
When the post-init of the combined build is run, the routines exported in
"BLD",938,1,29,0)
patch SD*5.3*300 will scan the PATIENT file (#2) and the SD WAIT LIST
"BLD",938,1,30,0)
file (#409.3), and will build a temporary storage global of patients who
"BLD",938,1,31,0)
may be eligible for this benefit.
"BLD",938,1,32,0)
 
"BLD",938,1,33,0)
 
"BLD",938,1,34,0)
This patch is being sent out as a combined build, along with patch 
"BLD",938,1,35,0)
PSO*7*145.
"BLD",938,1,36,0)
 
"BLD",938,1,37,0)
 
"BLD",938,1,38,0)
For KIDS Build and documentation retrieval information, please refer to 
"BLD",938,1,39,0)
patch PSO*7*145.
"BLD",938,4,0)
^9.64PA^^
"BLD",938,"INID")
^
"BLD",938,"INIT")

"BLD",938,"KRN",0)
^9.67PA^8989.52^19
"BLD",938,"KRN",.4,0)
.4
"BLD",938,"KRN",.401,0)
.401
"BLD",938,"KRN",.402,0)
.402
"BLD",938,"KRN",.403,0)
.403
"BLD",938,"KRN",.5,0)
.5
"BLD",938,"KRN",.84,0)
.84
"BLD",938,"KRN",3.6,0)
3.6
"BLD",938,"KRN",3.8,0)
3.8
"BLD",938,"KRN",9.2,0)
9.2
"BLD",938,"KRN",9.8,0)
9.8
"BLD",938,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",938,"KRN",9.8,"NM",1,0)
SDPBE^^0^B33913469
"BLD",938,"KRN",9.8,"NM",2,0)
SDPHARM^^0^B15323423
"BLD",938,"KRN",9.8,"NM",3,0)
SDPHARM1^^0^B8776016
"BLD",938,"KRN",9.8,"NM","B","SDPBE",1)

"BLD",938,"KRN",9.8,"NM","B","SDPHARM",2)

"BLD",938,"KRN",9.8,"NM","B","SDPHARM1",3)

"BLD",938,"KRN",19,0)
19
"BLD",938,"KRN",19.1,0)
19.1
"BLD",938,"KRN",101,0)
101
"BLD",938,"KRN",409.61,0)
409.61
"BLD",938,"KRN",771,0)
771
"BLD",938,"KRN",870,0)
870
"BLD",938,"KRN",8989.51,0)
8989.51
"BLD",938,"KRN",8989.52,0)
8989.52
"BLD",938,"KRN",8994,0)
8994
"BLD",938,"KRN","B",.4,.4)

"BLD",938,"KRN","B",.401,.401)

"BLD",938,"KRN","B",.402,.402)

"BLD",938,"KRN","B",.403,.403)

"BLD",938,"KRN","B",.5,.5)

"BLD",938,"KRN","B",.84,.84)

"BLD",938,"KRN","B",3.6,3.6)

"BLD",938,"KRN","B",3.8,3.8)

"BLD",938,"KRN","B",9.2,9.2)

"BLD",938,"KRN","B",9.8,9.8)

"BLD",938,"KRN","B",19,19)

"BLD",938,"KRN","B",19.1,19.1)

"BLD",938,"KRN","B",101,101)

"BLD",938,"KRN","B",409.61,409.61)

"BLD",938,"KRN","B",771,771)

"BLD",938,"KRN","B",870,870)

"BLD",938,"KRN","B",8989.51,8989.51)

"BLD",938,"KRN","B",8989.52,8989.52)

"BLD",938,"KRN","B",8994,8994)

"BLD",938,"QUES",0)
^9.62^^
"BLD",938,"REQB",0)
^9.611^2^2
"BLD",938,"REQB",1,0)
DG*5.3*389^2
"BLD",938,"REQB",2,0)
SD*5.3*263^2
"BLD",938,"REQB","B","DG*5.3*389",1)

"BLD",938,"REQB","B","SD*5.3*263",2)

"MBREQ")
1
"PKG",14,-1)
1^1
"PKG",14,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",14,22,0)
^9.49I^1^1
"PKG",14,22,1,0)
5.3^2930813^2940115
"PKG",14,22,1,"PAH",1,0)
300^3030826
"PKG",14,22,1,"PAH",1,1,0)
^^39^39^3030826
"PKG",14,22,1,"PAH",1,1,1,0)
This is the Phase I patch of the Transitional Pharmacy Benefit Project
"PKG",14,22,1,"PAH",1,1,2,0)
(TPB). This project provides functionality for the "Medication Prescribed 
"PKG",14,22,1,"PAH",1,1,3,0)
by Non-VA Physicians" to accommodate the Veterans Health Administration 
"PKG",14,22,1,"PAH",1,1,4,0)
(VHA) Directive 2003-047 that allows Department of Veterans Affairs (VA) 
"PKG",14,22,1,"PAH",1,1,5,0)
to furnish medications from non-VA physicians.  It mandates that for
"PKG",14,22,1,"PAH",1,1,6,0)
eligible veterans that meet certain criteria, VHA will fill prescriptions
"PKG",14,22,1,"PAH",1,1,7,0)
written by non-VA physicians and dentists. To determine eligibility, a
"PKG",14,22,1,"PAH",1,1,8,0)
patient must meet the following criteria:
"PKG",14,22,1,"PAH",1,1,9,0)
 
"PKG",14,22,1,"PAH",1,1,10,0)
1) The patient must be a veteran.
"PKG",14,22,1,"PAH",1,1,11,0)
 
"PKG",14,22,1,"PAH",1,1,12,0)
2) The veteran must be enrolled for VA health care system before July 25, 
"PKG",14,22,1,"PAH",1,1,13,0)
2003.
"PKG",14,22,1,"PAH",1,1,14,0)
 
"PKG",14,22,1,"PAH",1,1,15,0)
3) Before July 25,2003, the veteran must have requested their first 
"PKG",14,22,1,"PAH",1,1,16,0)
   primary care appointment with the VA.
"PKG",14,22,1,"PAH",1,1,17,0)
 
"PKG",14,22,1,"PAH",1,1,18,0)
4) The veteran must have no active prescriptions dispensed by the local 
"PKG",14,22,1,"PAH",1,1,19,0)
   VHA pharmacy, excluding Supply and Investigational items, for the past 
"PKG",14,22,1,"PAH",1,1,20,0)
   485 days from October 22, 2003.
"PKG",14,22,1,"PAH",1,1,21,0)
 
"PKG",14,22,1,"PAH",1,1,22,0)
5) The veteran must be waiting more than 30 days for their first 
"PKG",14,22,1,"PAH",1,1,23,0)
   appointment with a Primary Care Physician on or after October 22, 
"PKG",14,22,1,"PAH",1,1,24,0)
   2003, or the veteran is deemed eligible via an Electronic Wait
"PKG",14,22,1,"PAH",1,1,25,0)
   List/Scheduling extract run at each local site.
"PKG",14,22,1,"PAH",1,1,26,0)
 
"PKG",14,22,1,"PAH",1,1,27,0)
 
"PKG",14,22,1,"PAH",1,1,28,0)
When the post-init of the combined build is run, the routines exported in
"PKG",14,22,1,"PAH",1,1,29,0)
patch SD*5.3*300 will scan the PATIENT file (#2) and the SD WAIT LIST
"PKG",14,22,1,"PAH",1,1,30,0)
file (#409.3), and will build a temporary storage global of patients who
"PKG",14,22,1,"PAH",1,1,31,0)
may be eligible for this benefit.
"PKG",14,22,1,"PAH",1,1,32,0)
 
"PKG",14,22,1,"PAH",1,1,33,0)
 
"PKG",14,22,1,"PAH",1,1,34,0)
This patch is being sent out as a combined build, along with patch 
"PKG",14,22,1,"PAH",1,1,35,0)
PSO*7*145.
"PKG",14,22,1,"PAH",1,1,36,0)
 
"PKG",14,22,1,"PAH",1,1,37,0)
 
"PKG",14,22,1,"PAH",1,1,38,0)
For KIDS Build and documentation retrieval information, please refer to 
"PKG",14,22,1,"PAH",1,1,39,0)
patch PSO*7*145.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","SDPBE")
0^1^B33913469
"RTN","SDPBE",1,0)
SDPBE ;BP-IOFO/OWAIN ; Pharmacy Benefits National Reporting.  ; 7/23/03
"RTN","SDPBE",2,0)
 ;;5.3;Scheduling;**300**;AUG 13, 1993
"RTN","SDPBE",3,0)
 N SDSS,DFN
"RTN","SDPBE",4,0)
 D INIT(.SDSS)
"RTN","SDPBE",5,0)
 S DFN=0
"RTN","SDPBE",6,0)
 F  S DFN=$O(^SDWL(409.3,"B",DFN)) Q:+DFN'=DFN  D
"RTN","SDPBE",7,0)
 .N SDENCFLG,SDSEQ,SDINST,ELIGIBLE,SDDAPT
"RTN","SDPBE",8,0)
 .I $D(^PS(52.91,DFN,0)) Q
"RTN","SDPBE",9,0)
 .Q:'$$PAT(DFN)
"RTN","SDPBE",10,0)
 .S SDENCFLG=0 D ENC I SDENCFLG Q
"RTN","SDPBE",11,0)
 .K SDENCFLG
"RTN","SDPBE",12,0)
 .S SDSEQ=0
"RTN","SDPBE",13,0)
 .F  S SDSEQ=$O(^SDWL(409.3,"B",DFN,SDSEQ)) Q:+SDSEQ'=SDSEQ  D
"RTN","SDPBE",14,0)
 ..N SDPSOLES,SDPSOWT,SDWL0,SDODT,SDWLCL,SDCL,SDCP,SDDISDT,SDAPPDT,SDREQBY,SDMEDD
"RTN","SDPBE",15,0)
 ..S SDWL0=$G(^SDWL(409.3,SDSEQ,0))
"RTN","SDPBE",16,0)
 ..S SDPSOWT=$P(SDWL0,"^",5)
"RTN","SDPBE",17,0)
 ..;Quit-no Wait Type, check current 4 only, in case other codes are added
"RTN","SDPBE",18,0)
 ..I SDPSOWT'=1,SDPSOWT'=2,SDPSOWT'=3,SDPSOWT'=4 Q
"RTN","SDPBE",19,0)
 ..D GETCL
"RTN","SDPBE",20,0)
 ..;SDCL Returned for types 1,2,4   Clinic^Institution^Station
"RTN","SDPBE",21,0)
 ..;SDCL Returned for type 3    "VALID"^Institution^station
"RTN","SDPBE",22,0)
 ..I $G(SDCL)="" Q
"RTN","SDPBE",23,0)
 ..S SDODT=$P(SDWL0,"^",2) I 'SDODT Q
"RTN","SDPBE",24,0)
 ..Q:$E(SDODT,1,7)>3030724
"RTN","SDPBE",25,0)
 ..;I SDPSOWT=1!(SDPSOWT=2) I '$P(SDWL0,"^",2) Q
"RTN","SDPBE",26,0)
 ..I SDPSOWT=3!(SDPSOWT=4) I '$P(SDWL0,"^",2),'$P(SDWL0,"^",16) Q
"RTN","SDPBE",27,0)
 ..I SDPSOWT=1!(SDPSOWT=2) I $$FMDIFF^XLFDT(DT,$P(SDWL0,"^",2),1)'>29 Q
"RTN","SDPBE",28,0)
 ..I SDPSOWT=3!(SDPSOWT=4) S SDPSOLES=0 D  I 'SDPSOLES Q
"RTN","SDPBE",29,0)
 ...I $P(SDWL0,"^",2),$$FMDIFF^XLFDT(DT,$P(SDWL0,"^",2),1)>29 S SDPSOLES=1 Q
"RTN","SDPBE",30,0)
 ...I $P(SDWL0,"^",16),$$FMDIFF^XLFDT(DT,$P(SDWL0,"^",16),1)>29 S SDPSOLES=1
"RTN","SDPBE",31,0)
 ..S SDDISDT=$P($G(^SDWL(409.3,SDSEQ,"DIS")),U)
"RTN","SDPBE",32,0)
 ..S SDINST=$P(SDCL,"^",2) Q:'SDINST
"RTN","SDPBE",33,0)
 ..I $D(ELIGIBLE(SDINST)) Q:$P(ELIGIBLE(SDINST),U,2)<SDODT
"RTN","SDPBE",34,0)
 ..; If disposition date is not before 9/22/2003 (or there is no disposition date) - ELIGIBLE, otherwise INELIGIBLE.
"RTN","SDPBE",35,0)
 ..I SDDISDT<3030922&(SDDISDT'="") Q
"RTN","SDPBE",36,0)
 ..S ELIGIBLE(SDINST)=1_U_SDODT_U_$P(SDWL0,U,16) ; 1^Originating date^Desired date.
"RTN","SDPBE",37,0)
 ..Q
"RTN","SDPBE",38,0)
 .S SDINST=""
"RTN","SDPBE",39,0)
 .F  S SDINST=$O(ELIGIBLE(SDINST)) Q:SDINST=""  I ELIGIBLE(SDINST) D
"RTN","SDPBE",40,0)
 ..I $P(ELIGIBLE(SDINST),"^",3) S ^XTMP("SDPSO145","PAT","E",DFN,SDINST,$P(ELIGIBLE(SDINST),"^",3))="" Q
"RTN","SDPBE",41,0)
 ..; If desired date null, use DT, set to 1 to indicate no desire date
"RTN","SDPBE",42,0)
 ..S ^XTMP("SDPSO145","PAT","E",DFN,SDINST,DT)=1
"RTN","SDPBE",43,0)
 .Q
"RTN","SDPBE",44,0)
 Q
"RTN","SDPBE",45,0)
 ;
"RTN","SDPBE",46,0)
INIT(SDSS) ;
"RTN","SDPBE",47,0)
 N SDI,SDII
"RTN","SDPBE",48,0)
 ;
"RTN","SDPBE",49,0)
 ; Primary care stop code 404: GYNECOLOGY was added after the specification. (The 404 code has been removed)
"RTN","SDPBE",50,0)
 F SDI=322,323,350 F SDII="000",185,186,187 S SDSS(SDI_SDII)=""
"RTN","SDPBE",51,0)
 Q
"RTN","SDPBE",52,0)
 ;
"RTN","SDPBE",53,0)
PAT(DFN) ;Evaluate a patient
"RTN","SDPBE",54,0)
 ;INPUT:  DFN=patient ien
"RTN","SDPBE",55,0)
 ;OUTPUT: (fail) 0^_<reason for failure>
"RTN","SDPBE",56,0)
 ;        (success) 1^Patient appears to be eligible
"RTN","SDPBE",57,0)
 ;
"RTN","SDPBE",58,0)
 ;N ENR
"RTN","SDPBE",59,0)
 Q:'$D(^DPT(DFN,0)) "0^Patient record not found"
"RTN","SDPBE",60,0)
 Q:+$G(^DPT(DFN,.35)) "0^Patient is deceased"
"RTN","SDPBE",61,0)
 Q:$P($G(^DPT(DFN,"VET")),U)'="Y" "0^Patient is not a veteran"
"RTN","SDPBE",62,0)
 Q:+$P($G(^DPT(DFN,.15)),U,2) "0^Patient is ineligible"
"RTN","SDPBE",63,0)
 Q:'$L($P($G(^DPT(DFN,0)),U)) "0^Invalid name value"
"RTN","SDPBE",64,0)
 Q:$D(^DPT(DFN,-9)) "0^Merged patient record"
"RTN","SDPBE",65,0)
 Q:$P(^DPT(DFN,0),U)["MERGING INTO" "0^Merging patient record"
"RTN","SDPBE",66,0)
 Q:$$TESTPAT^VADPT(DFN) "0^Test patient"
"RTN","SDPBE",67,0)
 ;S ENR=$$GET1^DIQ(2,DFN_",",27.01,"I") Q:ENR=""!($$GET1^DIQ(27.11,ENR_",",.01,"I")>3030829) "0^Not enrolled by date required"
"RTN","SDPBE",68,0)
 Q "1^Patient appears to be eligible"
"RTN","SDPBE",69,0)
 ;
"RTN","SDPBE",70,0)
CPAIR(SDCL0)   ; Get credit pair
"RTN","SDPBE",71,0)
 ; Input: SDCL0=hospital location zeroeth node
"RTN","SDPBE",72,0)
 N SDX
"RTN","SDPBE",73,0)
 S SDX=$P($G(^DIC(40.7,+$P(SDCL0,U,7),0)),U,2)
"RTN","SDPBE",74,0)
 S SDX=SDX_$P($G(^DIC(40.7,+$P(SDCL0,U,18),0)),U,2)
"RTN","SDPBE",75,0)
 S SDX=$E(SDX_"000000",1,6)
"RTN","SDPBE",76,0)
 Q SDX
"RTN","SDPBE",77,0)
 ;
"RTN","SDPBE",78,0)
GETCL ;Get clinic info
"RTN","SDPBE",79,0)
 ;Need to set SDCL = Clinic IEN
"RTN","SDPBE",80,0)
 N SDPSONOX,SDCL0,SDWTXXX,SDPSOWLQ,SDPSOWSP,SDPSOWLA,SDPSOWL
"RTN","SDPBE",81,0)
 S SDCL=""
"RTN","SDPBE",82,0)
 I $G(SDPSOWT)=1 S SDPSONOX=0 D  S:$G(SDPSONOX)&($G(SDCL)="") ^XTMP("SDPSO145","PROB1",DFN)="" Q
"RTN","SDPBE",83,0)
 .S SDPSOWSP=$P(SDWL0,"^",6) I 'SDPSOWSP!('$D(^SCTM(404.51,+$G(SDPSOWSP),0))) Q
"RTN","SDPBE",84,0)
 .S SDPSOWL="" F  S SDPSOWL=$O(^SCTM(404.57,"C",SDPSOWSP,SDPSOWL)) Q:SDPSOWL=""  I $P($G(^SCTM(404.57,SDPSOWL,0)),"^",9) S SDPSOWLA(+$P($G(^SCTM(404.57,SDPSOWL,0)),"^",9))=""
"RTN","SDPBE",85,0)
 .S SDPSOWLQ=0,SDPSOWL="" F  S SDPSOWL=$O(SDPSOWLA(SDPSOWL)) Q:SDPSOWL=""!(SDPSOWLQ)  D
"RTN","SDPBE",86,0)
 ..;Fine first clinic with valid Institution and Station Number
"RTN","SDPBE",87,0)
 ..D INSTA
"RTN","SDPBE",88,0)
 I $G(SDPSOWT)=2 D  Q
"RTN","SDPBE",89,0)
 .N SDPSOPOS
"RTN","SDPBE",90,0)
 .S SDPSOPOS=$P(SDWL0,"^",7) I 'SDPSOPOS Q
"RTN","SDPBE",91,0)
 .S SDPSOWL=$P($G(^SCTM(404.57,SDPSOPOS,0)),"^",9) I 'SDPSOWL Q
"RTN","SDPBE",92,0)
 .D INSTA
"RTN","SDPBE",93,0)
 I $G(SDPSOWT)=3 D  Q
"RTN","SDPBE",94,0)
 .N SDPSOWSC,SDPSOAMI,SDPSOAMX
"RTN","SDPBE",95,0)
 .S SDWTX=$P(SDWL0,"^",3) I 'SDWTX!('$D(^DIC(4,+$G(SDWTX),0))) Q
"RTN","SDPBE",96,0)
 .;D STNM I $G(SDWTXXX)="" Q
"RTN","SDPBE",97,0)
 .S SDPSOWSC=$P(SDWL0,"^",8) I 'SDPSOWSC Q
"RTN","SDPBE",98,0)
 .S SDPSOAMI=$P($G(^SDWL(409.31,SDPSOWSC,0)),"^") I 'SDPSOAMI Q
"RTN","SDPBE",99,0)
 .S SDPSOAMX=$P($G(^DIC(40.7,SDPSOAMI,0)),"^",2)
"RTN","SDPBE",100,0)
 .S SDPSOAMX=$E(SDPSOAMX_"000000",1,6)
"RTN","SDPBE",101,0)
 .I $D(SDSS(SDPSOAMX)) S SDCL="VALID"_"^"_SDWTX
"RTN","SDPBE",102,0)
 I $G(SDPSOWT)=4 D  Q
"RTN","SDPBE",103,0)
 .N SDPSO9
"RTN","SDPBE",104,0)
 .S SDPSO9=$P(SDWL0,"^",9) I 'SDPSO9 Q
"RTN","SDPBE",105,0)
 .S SDPSOWL=$P($G(^SDWL(409.32,SDPSO9,0)),"^") I 'SDPSOWL Q
"RTN","SDPBE",106,0)
 .D INSTA
"RTN","SDPBE",107,0)
 Q
"RTN","SDPBE",108,0)
INSTA ;
"RTN","SDPBE",109,0)
 I $G(SDPSOWL)'>0 Q
"RTN","SDPBE",110,0)
 N SDWTX,SDMEDDX
"RTN","SDPBE",111,0)
 S SDWTX=$P($G(^SC(SDPSOWL,0)),"^",4) I SDWTX>0,$D(^DIC(4,SDWTX,0)) G STNMP
"RTN","SDPBE",112,0)
 S SDWTX="" S SDMEDDX=$P($G(^SC(SDPSOWL,0)),"^",15) I SDMEDDX>0 S SDWTX=$P($$SITE^VASITE(,SDMEDDX),"^")
"RTN","SDPBE",113,0)
 I $G(SDWTX)'>0 Q
"RTN","SDPBE",114,0)
 I '$D(^DIC(4,SDWTX,0)) Q
"RTN","SDPBE",115,0)
STNMP ;
"RTN","SDPBE",116,0)
 ;I $G(SDWTXXX)'="" D
"RTN","SDPBE",117,0)
 I $G(SDPSOWT)=1 S SDCL0=$G(^SC(SDPSOWL,0)) S SDCP=$$CPAIR(SDCL0) D STNM D  K SDWTXXX Q
"RTN","SDPBE",118,0)
 .I $D(SDSS(SDCP)) D
"RTN","SDPBE",119,0)
 ..I $G(SDWTXXX)="" S SDPSONOX=1 Q
"RTN","SDPBE",120,0)
 ..S SDCL=SDPSOWL_"^"_SDWTX,SDPSOWLQ=1
"RTN","SDPBE",121,0)
 S SDCL0=$G(^SC(SDPSOWL,0)) S SDCP=$$CPAIR(SDCL0) I $D(SDSS(SDCP)) S SDCL=SDPSOWL_"^"_SDWTX
"RTN","SDPBE",122,0)
 Q
"RTN","SDPBE",123,0)
 ;I $G(SDCL) Q
"RTN","SDPBE",124,0)
 ;S SDMEDDX=$P($G(^SC(SDPSOWL,0)),"^",15) I SDMEDDX>0 S SDWTX=$P($$SITE^VASITE(,SDMEDDX),"^") I $G(SDWTX),$D(^DIC(4,+$G(SDWTX),0)) D STNM D  Q
"RTN","SDPBE",125,0)
 ;.I $G(SDWTXXX)'="" D
"RTN","SDPBE",126,0)
 ;..I $G(SDPSOWT)=1 S SDCL0=$G(^SC(SDPSOWL,0)) S SDCP=$$CPAIR(SDCL0) D  Q
"RTN","SDPBE",127,0)
 ;...I $D(SDSS(SDCP)) S SDCL=SDPSOWL_"^"_SDWTX_"^"_SDWTXXX,SDPSOWLQ=1
"RTN","SDPBE",128,0)
 ;..S SDCL0=$G(^SC(SDPSOWL,0)) S SDCP=$$CPAIR(SDCL0) I $D(SDSS(SDCP)) S SDCL=SDPSOWL_"^"_SDWTX_"^"_SDWTXXX
"RTN","SDPBE",129,0)
 Q
"RTN","SDPBE",130,0)
STNM N SDWTXX
"RTN","SDPBE",131,0)
 K SDWTXX,SDWTXXX,DIC,DIQ,DD,DR S DIC=4,DR="99",DA=+SDWTX,DIQ(0)="I",DIQ="SDWTXX" D EN^DIQ1 S SDWTXXX=$G(SDWTXX(4,+SDWTX,99,"I")) K DIC,DIQ,DR,DA,SDWTXX
"RTN","SDPBE",132,0)
 Q
"RTN","SDPBE",133,0)
ENC ;Encounter check
"RTN","SDPBE",134,0)
 N SDENC,SDENC1,SDENC2,SDENC3,SDENC4
"RTN","SDPBE",135,0)
 S SDENC=3011021.2359
"RTN","SDPBE",136,0)
 F  S SDENC=$O(^SCE("ADFN",DFN,SDENC)) Q:'SDENC!(SDENCFLG)  D
"RTN","SDPBE",137,0)
 .S SDENC1=0 F  S SDENC1=$O(^SCE("ADFN",DFN,SDENC,SDENC1)) Q:'SDENC1!(SDENCFLG)  D
"RTN","SDPBE",138,0)
 ..S SDENC2=$G(^SCE(SDENC1,0)) Q:'$L(SDENC2)
"RTN","SDPBE",139,0)
 ..Q:$P(SDENC2,"^",6)
"RTN","SDPBE",140,0)
 ..Q:'$P(SDENC2,"^",4)
"RTN","SDPBE",141,0)
 ..S SDENC3=$G(^SC(+$P(SDENC2,"^",4),0)) Q:'$L(SDENC3)
"RTN","SDPBE",142,0)
 ..S SDENC4=$$CPAIR(SDENC3)
"RTN","SDPBE",143,0)
 ..Q:'$D(SDSS(SDENC4))
"RTN","SDPBE",144,0)
 ..K ^XTMP("SDPSO145","PAT","E",DFN)
"RTN","SDPBE",145,0)
 ..K ^XTMP("SDPSO145","PAT","S",DFN) S SDENCFLG=1
"RTN","SDPBE",146,0)
 Q
"RTN","SDPHARM")
0^2^B15323423
"RTN","SDPHARM",1,0)
SDPHARM ;ALBANY OIFO/KEITH - Determine patients for Rx benefit ; 6/30/03
"RTN","SDPHARM",2,0)
 ;;5.3;Scheduling;**300**;AUG 13,1993
"RTN","SDPHARM",3,0)
LOOK ;Search PATIENT file for eligible patients
"RTN","SDPHARM",4,0)
 ;
"RTN","SDPHARM",5,0)
 N DFN,SDPT,SDSS,SDATE,SDATE2
"RTN","SDPHARM",6,0)
 D INIT
"RTN","SDPHARM",7,0)
 ;
"RTN","SDPHARM",8,0)
 ;Roll through patient file
"RTN","SDPHARM",9,0)
 S DFN=0 F  S DFN=$O(^DPT(DFN)) Q:'DFN  S SDPT=$$PAT(DFN)
"RTN","SDPHARM",10,0)
 Q
"RTN","SDPHARM",11,0)
 ;
"RTN","SDPHARM",12,0)
INIT ; Initialize variables
"RTN","SDPHARM",13,0)
 ;INPUT: SDL=lag for future date (optional) (Now date is hard set)
"RTN","SDPHARM",14,0)
 ;
"RTN","SDPHARM",15,0)
 N SDI,SDII
"RTN","SDPHARM",16,0)
 S SDATE=3031021.2359
"RTN","SDPHARM",17,0)
 S SDATE2=3011021.2359
"RTN","SDPHARM",18,0)
 ;Create primary care DSS credit pair array
"RTN","SDPHARM",19,0)
 F SDI=322,323,350 F SDII="000",185,186,187 S SDSS(SDI_SDII)=""
"RTN","SDPHARM",20,0)
 Q
"RTN","SDPHARM",21,0)
 ;
"RTN","SDPHARM",22,0)
PAT(DFN) ;Evaluate a patient
"RTN","SDPHARM",23,0)
 ;INPUT:  DFN=patient ien
"RTN","SDPHARM",24,0)
 ;OUTPUT: (fail) 0^_<reason for failure>
"RTN","SDPHARM",25,0)
 ;        (success) 1^Patient appears to be eligible
"RTN","SDPHARM",26,0)
 ;
"RTN","SDPHARM",27,0)
 N SDAP0,SDCL0,SDCP,SDEN,SDEN0,SDIV,SDOUT,SDT
"RTN","SDPHARM",28,0)
 ;
"RTN","SDPHARM",29,0)
 Q:$D(^PS(52.91,DFN,0)) "0^Patient is already in TPB ELIGIBILITY File"
"RTN","SDPHARM",30,0)
 Q:'$D(^DPT(DFN,0)) "0^Patient recird not found"
"RTN","SDPHARM",31,0)
 Q:'$O(^DPT(DFN,"S",SDATE)) "0^No appointment later than 10/21/03"
"RTN","SDPHARM",32,0)
 Q:+$G(^DPT(DFN,.35)) "0^Patient is deceased"
"RTN","SDPHARM",33,0)
 Q:$P($G(^DPT(DFN,"VET")),U)'="Y" "0^Patient is not a veteran"
"RTN","SDPHARM",34,0)
 ;Should we not quit in next line if date is in future
"RTN","SDPHARM",35,0)
 Q:+$P($G(^DPT(DFN,.15)),U,2) "0^Patient is ineligible"
"RTN","SDPHARM",36,0)
 Q:'$L($P($G(^DPT(DFN,0)),U)) "0^Invalid name value"
"RTN","SDPHARM",37,0)
 Q:$D(^DPT(DFN,-9)) "0^Merged patient record"
"RTN","SDPHARM",38,0)
 Q:$P(^DPT(DFN,0),U)["MERGING INTO" "0^Merging patient record"
"RTN","SDPHARM",39,0)
 Q:$E($P(^DPT(DFN,0),U,9),1,5)="00000" "0^Test patient"
"RTN","SDPHARM",40,0)
 ;Next 2 checks have been moved to the Pharmacy routine
"RTN","SDPHARM",41,0)
 ;Q:'$$DATE^ENROLD(DFN) "0^Not enrolled by date required"
"RTN","SDPHARM",42,0)
 ;Q:$$RX^PSOGAPBL(DFN) "0^Active prescriptions exist"
"RTN","SDPHARM",43,0)
 S SDT=SDATE,SDOUT=0
"RTN","SDPHARM",44,0)
 F  S SDT=$O(^DPT(DFN,"S",SDT)) Q:'SDT  D
"RTN","SDPHARM",45,0)
 .S SDAP0=$G(^DPT(DFN,"S",SDT,0)) Q:'+SDAP0  ;Get appt 0 node
"RTN","SDPHARM",46,0)
 .Q:$P(SDAP0,U,2)["C"  ;Skip cancelled appointments
"RTN","SDPHARM",47,0)
 .Q:'$P(SDAP0,U,19)  ;Need 'date entered'
"RTN","SDPHARM",48,0)
 .Q:$P(SDAP0,U,19)>3030724
"RTN","SDPHARM",49,0)
 .S SDCL0=$G(^SC(+SDAP0,0)) Q:'$L(SDCL0)  ;Get clinic 0 node
"RTN","SDPHARM",50,0)
 .S SDCP=$$CPAIR(SDCL0)  ;Get DSS credit pair
"RTN","SDPHARM",51,0)
 .Q:'$D(SDSS(SDCP))  ;Not a primary care appointment
"RTN","SDPHARM",52,0)
 .S SDIV=$$DIV(SDCL0)  ;Get clinic division
"RTN","SDPHARM",53,0)
 .Q:$G(SDIV)'>0  ;No Institution
"RTN","SDPHARM",54,0)
 .I $$FMDIFF^XLFDT(SDT,$P(SDAP0,"^",19),1)<31 S ^XTMP("SDPSO145","PAT","S",DFN,SDIV,SDT)="1^0^"_$P($G(^DPT(DFN,"S",SDT,1)),"^") Q
"RTN","SDPHARM",55,0)
 .S ^XTMP("SDPSO145","PAT","S",DFN,SDIV,SDT)="0^0^"_$P($G(^DPT(DFN,"S",SDT,1)),"^")
"RTN","SDPHARM",56,0)
 .Q
"RTN","SDPHARM",57,0)
 Q:'$D(^XTMP("SDPSO145","PAT","S",DFN)) "0^No future primary care appointment"
"RTN","SDPHARM",58,0)
 ;Examine past encounters
"RTN","SDPHARM",59,0)
 S SDT=SDATE2 F  S SDT=$O(^SCE("ADFN",DFN,SDT)) Q:'SDT!SDOUT  D
"RTN","SDPHARM",60,0)
 .S SDEN=0 F  S SDEN=$O(^SCE("ADFN",DFN,SDT,SDEN)) Q:'SDEN!SDOUT  D
"RTN","SDPHARM",61,0)
 ..S SDEN0=$G(^SCE(SDEN,0)) Q:'$L(SDEN0)  ;Get encounter 0 node
"RTN","SDPHARM",62,0)
 ..Q:$P(SDEN0,U,6)  ;Child encounter
"RTN","SDPHARM",63,0)
 ..Q:'$P(SDEN0,"^",4)
"RTN","SDPHARM",64,0)
 ..S SDCL0=$G(^SC(+$P(SDEN0,U,4),0)) Q:'$L(SDCL0)  ;Get clinic 0 node
"RTN","SDPHARM",65,0)
 ..S SDCP=$$CPAIR(SDCL0)  ;Get DSS credit pair 
"RTN","SDPHARM",66,0)
 ..Q:'$D(SDSS(SDCP))  ;Not a primary care encounter 
"RTN","SDPHARM",67,0)
 ..;S SDIV=$$DIV(SDCL0)  ;Get clinic division 
"RTN","SDPHARM",68,0)
 ..K ^XTMP("SDPSO145","PAT","S",DFN) S SDOUT=1  ;Kill all entries for that patient
"RTN","SDPHARM",69,0)
 ..;S:'$D(^XTMP("SDPSO145","PAT","S",DFN)) SDOUT=1  ;Quit if no future pc appts left
"RTN","SDPHARM",70,0)
 ..Q
"RTN","SDPHARM",71,0)
 .Q
"RTN","SDPHARM",72,0)
 Q:SDOUT "0^Patient has a Primary Care encounter within past 2 years"
"RTN","SDPHARM",73,0)
 Q "1^Patient appears to be eligible"
"RTN","SDPHARM",74,0)
 ;
"RTN","SDPHARM",75,0)
CPAIR(SDCL0) ;Get credit pair
"RTN","SDPHARM",76,0)
 ;Input: SDCL0=hospital location zeroeth node
"RTN","SDPHARM",77,0)
 N SDX
"RTN","SDPHARM",78,0)
 S SDX=$P($G(^DIC(40.7,+$P(SDCL0,U,7),0)),U,2)
"RTN","SDPHARM",79,0)
 S SDX=SDX_$P($G(^DIC(40.7,+$P(SDCL0,U,18),0)),U,2)
"RTN","SDPHARM",80,0)
 ;S:'$L(SDX) SDX="000000"
"RTN","SDPHARM",81,0)
 S SDX=$E(SDX_"000000",1,6)
"RTN","SDPHARM",82,0)
 Q SDX
"RTN","SDPHARM",83,0)
 ;
"RTN","SDPHARM",84,0)
DIV(SDCL0) ;Get facility division name and number
"RTN","SDPHARM",85,0)
 ;Input: SDCL0=hospital location zeroeth node
"RTN","SDPHARM",86,0)
 N SDIVV,SDHOLD S SDIVV=$P(SDCL0,U,15)
"RTN","SDPHARM",87,0)
 S SDHOLD=0
"RTN","SDPHARM",88,0)
 I SDIVV>0 S SDHOLD=$P($$SITE^VASITE(,SDIVV),"^")
"RTN","SDPHARM",89,0)
 I SDHOLD>0 Q SDHOLD
"RTN","SDPHARM",90,0)
 S SDHOLD=$P(SDCL0,"^",4)
"RTN","SDPHARM",91,0)
 I 'SDHOLD Q 0
"RTN","SDPHARM",92,0)
 I SDHOLD,'$D(^DIC(4,SDHOLD,0)) S SDHOLD=0
"RTN","SDPHARM",93,0)
 Q SDHOLD
"RTN","SDPHARM1")
0^3^B8776016
"RTN","SDPHARM1",1,0)
SDPHARM1 ;BIRMINGHAM OIFO/RON - Determine default Institution/Station no. ; 8/9/03
"RTN","SDPHARM1",2,0)
 ;;5.3;Scheduling;**300**;AUG 13, 1993
"RTN","SDPHARM1",3,0)
 ;
"RTN","SDPHARM1",4,0)
DEF(SDPSODFN) ;Pass in Patient
"RTN","SDPHARM1",5,0)
 I '$G(SDPSODFN)!('$D(^DPT(SDPSODFN,0))) Q 0
"RTN","SDPHARM1",6,0)
 N DA,DR,DIC,DIE,X,Y,SDPSOPRM,SDPSODFA,SDPSODF1,SDPSODF2,SDPSODF3,SDPSOPDF
"RTN","SDPHARM1",7,0)
 D INIT
"RTN","SDPHARM1",8,0)
 D PAT
"RTN","SDPHARM1",9,0)
 I '$D(SDPSODFA) Q 0
"RTN","SDPHARM1",10,0)
 S (SDPSOPRM,SDPSOPDF)=0
"RTN","SDPHARM1",11,0)
 S SDPSODF1="" F  S SDPSODF1=$O(SDPSODFA(SDPSODF1)) Q:SDPSODF1=""!(SDPSOPRM)  S SDPSODF2="" F  S SDPSODF2=$O(SDPSODFA(SDPSODF1,SDPSODF2)) Q:SDPSODF2=""!(SDPSOPRM)  D
"RTN","SDPHARM1",12,0)
 .S SDPSODF3="" F  S SDPSODF3=$O(SDPSODFA(SDPSODF1,SDPSODF2,SDPSODF3)) Q:SDPSODF3=""!(SDPSOPRM)  D
"RTN","SDPHARM1",13,0)
 ..I SDPSODFA(SDPSODF1,SDPSODF2,SDPSODF3) S SDPSOPDF=SDPSODF2_"^"_SDPSODF3,SDPSOPRM=1 Q
"RTN","SDPHARM1",14,0)
 ..S SDPSOPDF=SDPSODF2_"^"_SDPSODF3
"RTN","SDPHARM1",15,0)
 Q $S(SDPSOPDF:SDPSOPDF,1:0)
"RTN","SDPHARM1",16,0)
INIT ;Initialize variables
"RTN","SDPHARM1",17,0)
 ;Create primary care DSS credit pair array
"RTN","SDPHARM1",18,0)
 N SDPSODI,SDPSODII,SDPSODSS
"RTN","SDPHARM1",19,0)
 F SDPSODI=322,323,350 F SDPSODII="000",185,186,187 S SDPSODSS(SDPSODI_SDPSODII)=""
"RTN","SDPHARM1",20,0)
 Q
"RTN","SDPHARM1",21,0)
 ;
"RTN","SDPHARM1",22,0)
PAT ;
"RTN","SDPHARM1",23,0)
 N SDPSOSTA,SDPSOATZ,SDPSODIV,SDPSODCP,SDPSOCL0,SDPSOAP0,SDPSOSDT,SDPSOOUT,X,Y,X1,X2
"RTN","SDPHARM1",24,0)
 S SDPSOOUT=0
"RTN","SDPHARM1",25,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","SDPHARM1",26,0)
 S X1=DT,X2=-1 D C^%DTC S SDPSOSDT=X_".999"
"RTN","SDPHARM1",27,0)
 F  S SDPSOSDT=$O(^DPT(SDPSODFN,"S",SDPSOSDT)) Q:'SDPSOSDT  D
"RTN","SDPHARM1",28,0)
 .S SDPSOAP0=$G(^DPT(SDPSODFN,"S",SDPSOSDT,0)) Q:'+SDPSOAP0  ;Get appt 0 node
"RTN","SDPHARM1",29,0)
 .Q:$P(SDPSOAP0,U,2)["C"  ;Skip cancelled appointments
"RTN","SDPHARM1",30,0)
 .S SDPSOCL0=$G(^SC(+SDPSOAP0,0)) Q:'$L(SDPSOCL0)  ;Get clinic 0 node
"RTN","SDPHARM1",31,0)
 .S SDPSODCP=$$CPAIR(SDPSOCL0)  ;Get DSS credit pair
"RTN","SDPHARM1",32,0)
 .S SDPSODIV=$$DIV(SDPSOCL0)  ;Get clinic division
"RTN","SDPHARM1",33,0)
 .K SDPSOSTA I $G(SDPSODIV) K SDPSOATZ,DIC,DIQ,DD,DR S DIC=4,DR="99",DA=+SDPSODIV,DIQ(0)="I",DIQ="SDPSOATZ" D EN^DIQ1 S SDPSOSTA=$G(SDPSOATZ(4,+SDPSODIV,99,"I")) K DIC,DIQ,DR,DA,SDPSOATZ
"RTN","SDPHARM1",34,0)
 .I SDPSODIV>0,$G(SDPSOSTA)'="" D
"RTN","SDPHARM1",35,0)
 ..S SDPSODFA(SDPSOSDT,SDPSODIV,SDPSOSTA)=$S($D(SDPSODSS(SDPSODCP)):1,1:0)
"RTN","SDPHARM1",36,0)
 Q
"RTN","SDPHARM1",37,0)
 ;
"RTN","SDPHARM1",38,0)
CPAIR(SDPSOCL0) ;Get credit pair
"RTN","SDPHARM1",39,0)
 N SDPSOSDX
"RTN","SDPHARM1",40,0)
 S SDPSOSDX=$P($G(^DIC(40.7,+$P(SDPSOCL0,U,7),0)),U,2)
"RTN","SDPHARM1",41,0)
 S SDPSOSDX=SDPSOSDX_$P($G(^DIC(40.7,+$P(SDPSOCL0,U,18),0)),U,2)
"RTN","SDPHARM1",42,0)
 S SDPSOSDX=$E(SDPSOSDX_"000000",1,6)
"RTN","SDPHARM1",43,0)
 Q SDPSOSDX
"RTN","SDPHARM1",44,0)
 ;
"RTN","SDPHARM1",45,0)
DIV(SDPSOCL0) ;Get facility division name and number
"RTN","SDPHARM1",46,0)
 N SDPSODVX,SDPSOHLD S SDPSODVX=$P(SDPSOCL0,U,15)
"RTN","SDPHARM1",47,0)
 S SDPSOHLD=0
"RTN","SDPHARM1",48,0)
 I SDPSODVX>0 S SDPSOHLD=$P($$SITE^VASITE(,SDPSODVX),U)
"RTN","SDPHARM1",49,0)
 I SDPSOHLD>0 Q SDPSOHLD
"RTN","SDPHARM1",50,0)
 S SDPSOHLD=$P(SDPSOCL0,"^",4)
"RTN","SDPHARM1",51,0)
 I 'SDPSOHLD Q 0
"RTN","SDPHARM1",52,0)
 I SDPSOHLD,'$D(^DIC(4,SDPSOHLD,0)) S SDPSOHLD=0
"RTN","SDPHARM1",53,0)
 Q SDPDOHLD
"VER")
8.0^22.0
**INSTALL NAME**
PSO*7.0*145
"BLD",932,0)
PSO*7.0*145^OUTPATIENT PHARMACY^0^3030826^y
"BLD",932,1,0)
^^102^102^3030825^
"BLD",932,1,1,0)
This is the Phase I patch of the Transitional Pharmacy Benefit Project
"BLD",932,1,2,0)
(TPB). This project provides functionality for the "Medication Prescribed 
"BLD",932,1,3,0)
by Non-VA Physicians" to accommodate the Veterans Health Administration 
"BLD",932,1,4,0)
(VHA) Directive 2003-047 that allows Department of Veterans Affairs (VA) 
"BLD",932,1,5,0)
to furnish medications from non-VA physicians. It mandates that for
"BLD",932,1,6,0)
eligible veterans that meet certain criteria, VHA will fill prescriptions
"BLD",932,1,7,0)
written by non-VA physicians and dentists. To determine eligibility, a
"BLD",932,1,8,0)
patient must meet the following criteria:
"BLD",932,1,9,0)
 
"BLD",932,1,10,0)
1) The patient must be a veteran.
"BLD",932,1,11,0)
 
"BLD",932,1,12,0)
2) The veteran must be enrolled for VA health care system before
"BLD",932,1,13,0)
   July 25, 2003.
"BLD",932,1,14,0)
 
"BLD",932,1,15,0)
3) Before July 25,2003, the veteran must have requested their first 
"BLD",932,1,16,0)
   primary care appointment with the VA.
"BLD",932,1,17,0)
 
"BLD",932,1,18,0)
4) The veteran must have no active prescriptions dispensed by the local 
"BLD",932,1,19,0)
   VHA pharmacy, excluding Supply and Investigational items, for the past 
"BLD",932,1,20,0)
   485 days from October 22, 2003.
"BLD",932,1,21,0)
 
"BLD",932,1,22,0)
5) The veteran must be waiting more than 30 days for their first 
"BLD",932,1,23,0)
   appointment with a Primary Care Physician on or after October 22, 
"BLD",932,1,24,0)
   2003, or the veteran is deemed eligible via an Electronic Wait
"BLD",932,1,25,0)
   List/Scheduling extract run at each local site.
"BLD",932,1,26,0)
 
"BLD",932,1,27,0)
 
"BLD",932,1,28,0)
 
"BLD",932,1,29,0)
This patch is being sent out as a combined build, along with patch 
"BLD",932,1,30,0)
SD*5.3*300.
"BLD",932,1,31,0)
            
"BLD",932,1,32,0)
 
"BLD",932,1,33,0)
Outpatient Pharmacy will provide the following functionality in this 
"BLD",932,1,34,0)
patch:
"BLD",932,1,35,0)
 
"BLD",932,1,36,0)
1. A Post-Install routine will scan through the PATIENT file (#2)
"BLD",932,1,37,0)
and the SD WAIT LIST file (#409.3), and will populate the new Outpatient
"BLD",932,1,38,0)
Pharmacy TPB ELIGIBILITY file (#52.91) with patients eligible for the
"BLD",932,1,39,0)
Transitional Pharmacy Benefit. Patients will either be entered into the
"BLD",932,1,40,0)
file as eligible, or ineligible. If they are entered into the file as
"BLD",932,1,41,0)
ineligible, an exclusion reason will also be entered into the file. Please
"BLD",932,1,42,0)
refer to the documentation for more details.
"BLD",932,1,43,0)
  
"BLD",932,1,44,0)
The average run time of the Post-Install at the test sites was 1 hour.
"BLD",932,1,45,0)
 
"BLD",932,1,46,0)
 
"BLD",932,1,47,0)
2. The following new options are provided in this patch:
"BLD",932,1,48,0)
   a. A new report option, TPB Patient Report [PSO TPB PATIENT REPORT], 
"BLD",932,1,49,0)
      will be provided to display the patients in the TPB ELIGIBILITY file
"BLD",932,1,50,0)
      (#52.91). Various sort criteria are provided.
"BLD",932,1,51,0)
   b. The Transitional Pharmacy Benefit Patient Enter/Edit [PSO TPB  
"BLD",932,1,52,0)
      PATIENT ENTER/EDIT] option will allow sites to add new patients, and
"BLD",932,1,53,0)
      edit existing patients. Note: This option will be set initially to
"BLD",932,1,54,0)
      "Out of Order", until the post-install runs to completion.
"BLD",932,1,55,0)
   c. The TPB Institution Letter Enter/Edit [PSO TPB INSTITUTION LETTERS]
"BLD",932,1,56,0)
      option allows the user to edit each TPB institution's information
"BLD",932,1,57,0)
      elements that are to be printed on the letters to be sent to the
"BLD",932,1,58,0)
      patients.
"BLD",932,1,59,0)
   d. The Report TPB Patients Letters Printed/NOT Printed [PSO TPB LETTERS
"BLD",932,1,60,0)
      PRINTED REPORT] option provides the user the ability to generate a
"BLD",932,1,61,0)
      report of patients' letters printed or not printed.
"BLD",932,1,62,0)
   e. The Print TPB Patient Letter(s) [PSO TPB PRINT LETTERS] option
"BLD",932,1,63,0)
      provides the ability to print TPB letters to be sent to patients.
"BLD",932,1,64,0)
                        
"BLD",932,1,65,0)
 
"BLD",932,1,66,0)
KIDS Build and Documentation Retrieval:
"BLD",932,1,67,0)
======================================================
"BLD",932,1,68,0)
 
"BLD",932,1,69,0)
The KIDS Build and VISTA documentation are available on the 
"BLD",932,1,70,0)
ANONYMOUS.SOFTWARE directory at one of the following Office of Information
"BLD",932,1,71,0)
(OI) Field Offices.
"BLD",932,1,72,0)
 
"BLD",932,1,73,0)
 
"BLD",932,1,74,0)
Sites may retrieve documentation in one of the following ways:
"BLD",932,1,75,0)
 
"BLD",932,1,76,0)
(1) The preferred method is to FTP the files from
"BLD",932,1,77,0)
    download.vista.med.va.gov, which will transmit the files from the 
"BLD",932,1,78,0)
    first available FTP server.
"BLD",932,1,79,0)
  
"BLD",932,1,80,0)
(2) Sites may also elect to retrieve documentation directly from a
"BLD",932,1,81,0)
    specific server as follows:
"BLD",932,1,82,0)
 
"BLD",932,1,83,0)
    Albany          ftp.fo-albany.med.va.gov
"BLD",932,1,84,0)
    Hines           ftp.fo-hines.med.va.gov
"BLD",932,1,85,0)
    Salt Lake City  ftp.fo-slc.med.va.gov
"BLD",932,1,86,0)
 
"BLD",932,1,87,0)
 
"BLD",932,1,88,0)
The software distribution includes: 
"BLD",932,1,89,0)
 
"BLD",932,1,90,0)
    FILE NAMES                    DESCRIPTION
"BLD",932,1,91,0)
 
"BLD",932,1,92,0)
    PSO_TPB_ELIGIBILITY_1_0.KID   KIDS Build         
"BLD",932,1,93,0)
    PSO_7_P145_IG.PDF             Installation Guide
"BLD",932,1,94,0)
    PSO_7_UM_R0803.PDF            User Manual
"BLD",932,1,95,0)
    PSO_7_P145_UM_CP.PDF          User Manual Change Page Document
"BLD",932,1,96,0)
    PSO_7_TM_R0803.PDF            Technical Manual
"BLD",932,1,97,0)
    PSO_7_P145_TM_CP.PDF          Technical Manual Change Page Document
"BLD",932,1,98,0)
    PSO_7_P145_RN.PDF             Release Notes
"BLD",932,1,99,0)
 
"BLD",932,1,100,0)
(3) Documentation can also be retrieved from VISTA Documentation Library
"BLD",932,1,101,0)
(VDL) on the Internet at the following address,
"BLD",932,1,102,0)
http://www.va.gov/vdl.
"BLD",932,4,0)
^9.64PA^52.92^2
"BLD",932,4,52.91,0)
52.91
"BLD",932,4,52.91,222)
y^y^f^^^^n
"BLD",932,4,52.92,0)
52.92
"BLD",932,4,52.92,222)
y^y^f^^^^n
"BLD",932,4,"B",52.91,52.91)

"BLD",932,4,"B",52.92,52.92)

"BLD",932,"INI")

"BLD",932,"INID")
^^
"BLD",932,"INIT")

"BLD",932,"KRN",0)
^9.67PA^8989.52^19
"BLD",932,"KRN",.4,0)
.4
"BLD",932,"KRN",.401,0)
.401
"BLD",932,"KRN",.402,0)
.402
"BLD",932,"KRN",.403,0)
.403
"BLD",932,"KRN",.403,"NM",0)
^9.68A^1^1
"BLD",932,"KRN",.403,"NM",1,0)
INSTITUTION EDIT    FILE #52.92^52.92^0
"BLD",932,"KRN",.403,"NM","B","INSTITUTION EDIT    FILE #52.92",1)

"BLD",932,"KRN",.5,0)
.5
"BLD",932,"KRN",.84,0)
.84
"BLD",932,"KRN",3.6,0)
3.6
"BLD",932,"KRN",3.8,0)
3.8
"BLD",932,"KRN",9.2,0)
9.2
"BLD",932,"KRN",9.8,0)
9.8
"BLD",932,"KRN",9.8,"NM",0)
^9.68A^11^9
"BLD",932,"KRN",9.8,"NM",1,0)
PSOTPCEE^^0^B7617884
"BLD",932,"KRN",9.8,"NM",2,0)
PSOTPCRP^^0^B52118182
"BLD",932,"KRN",9.8,"NM",3,0)
PSOTPCRX^^0^B51178957
"BLD",932,"KRN",9.8,"NM",5,0)
PSOTPCL^^0^B20966442
"BLD",932,"KRN",9.8,"NM",7,0)
PSOTPCLW^^0^B54624141
"BLD",932,"KRN",9.8,"NM",8,0)
PSO145PS^^0^B1614089
"BLD",932,"KRN",9.8,"NM",9,0)
PSOTPCLR^^0^B10542060
"BLD",932,"KRN",9.8,"NM",10,0)
PSOTPCLP^^0^B61856325
"BLD",932,"KRN",9.8,"NM",11,0)
PSOTPCUL^^0^B109419
"BLD",932,"KRN",9.8,"NM","B","PSO145PS",8)

"BLD",932,"KRN",9.8,"NM","B","PSOTPCEE",1)

"BLD",932,"KRN",9.8,"NM","B","PSOTPCL",5)

"BLD",932,"KRN",9.8,"NM","B","PSOTPCLP",10)

"BLD",932,"KRN",9.8,"NM","B","PSOTPCLR",9)

"BLD",932,"KRN",9.8,"NM","B","PSOTPCLW",7)

"BLD",932,"KRN",9.8,"NM","B","PSOTPCRP",2)

"BLD",932,"KRN",9.8,"NM","B","PSOTPCRX",3)

"BLD",932,"KRN",9.8,"NM","B","PSOTPCUL",11)

"BLD",932,"KRN",19,0)
19
"BLD",932,"KRN",19,"NM",0)
^9.68A^6^5
"BLD",932,"KRN",19,"NM",2,0)
PSO TPB PATIENT REPORT^^0
"BLD",932,"KRN",19,"NM",3,0)
PSO TPB PATIENT ENTER/EDIT^^0
"BLD",932,"KRN",19,"NM",4,0)
PSO TPB INSTITUTION LETTERS^^0
"BLD",932,"KRN",19,"NM",5,0)
PSO TPB LETTERS PRINTED REPORT^^0
"BLD",932,"KRN",19,"NM",6,0)
PSO TPB PRINT LETTERS^^0
"BLD",932,"KRN",19,"NM","B","PSO TPB INSTITUTION LETTERS",4)

"BLD",932,"KRN",19,"NM","B","PSO TPB LETTERS PRINTED REPORT",5)

"BLD",932,"KRN",19,"NM","B","PSO TPB PATIENT ENTER/EDIT",3)

"BLD",932,"KRN",19,"NM","B","PSO TPB PATIENT REPORT",2)

"BLD",932,"KRN",19,"NM","B","PSO TPB PRINT LETTERS",6)

"BLD",932,"KRN",19.1,0)
19.1
"BLD",932,"KRN",101,0)
101
"BLD",932,"KRN",409.61,0)
409.61
"BLD",932,"KRN",771,0)
771
"BLD",932,"KRN",870,0)
870
"BLD",932,"KRN",8989.51,0)
8989.51
"BLD",932,"KRN",8989.52,0)
8989.52
"BLD",932,"KRN",8994,0)
8994
"BLD",932,"KRN","B",.4,.4)

"BLD",932,"KRN","B",.401,.401)

"BLD",932,"KRN","B",.402,.402)

"BLD",932,"KRN","B",.403,.403)

"BLD",932,"KRN","B",.5,.5)

"BLD",932,"KRN","B",.84,.84)

"BLD",932,"KRN","B",3.6,3.6)

"BLD",932,"KRN","B",3.8,3.8)

"BLD",932,"KRN","B",9.2,9.2)

"BLD",932,"KRN","B",9.8,9.8)

"BLD",932,"KRN","B",19,19)

"BLD",932,"KRN","B",19.1,19.1)

"BLD",932,"KRN","B",101,101)

"BLD",932,"KRN","B",409.61,409.61)

"BLD",932,"KRN","B",771,771)

"BLD",932,"KRN","B",870,870)

"BLD",932,"KRN","B",8989.51,8989.51)

"BLD",932,"KRN","B",8989.52,8989.52)

"BLD",932,"KRN","B",8994,8994)

"BLD",932,"PRE")

"BLD",932,"QUES",0)
^9.62^^
"BLD",932,"REQB",0)
^9.611^^0
"FIA",52.91)
TPB ELIGIBILITY
"FIA",52.91,0)
^PS(52.91,
"FIA",52.91,0,0)
52.91P
"FIA",52.91,0,1)
y^y^f^^^^n
"FIA",52.91,0,10)

"FIA",52.91,0,11)

"FIA",52.91,0,"RLRO")

"FIA",52.91,0,"VR")
7.0^PSO
"FIA",52.91,52.91)
0
"FIA",52.92)
TPB INSTITUTION LETTERS
"FIA",52.92,0)
^PS(52.92,
"FIA",52.92,0,0)
52.92P
"FIA",52.92,0,1)
y^y^f^^^^n
"FIA",52.92,0,10)

"FIA",52.92,0,11)

"FIA",52.92,0,"RLRO")

"FIA",52.92,0,"VR")
7.0^PSO
"FIA",52.92,52.92)
0
"IX",52.91,52.91,"AC",0)
52.91^AC^Sets the "AC" x-ref.^MU^^F^IR^I^52.91^^^^^A
"IX",52.91,52.91,"AC",1)
S ^PS(52.91,"AC",$E(X,1,30),DA)="" S:$$PATCH^XPDUTL("PSO*7.0*146") ^PS(52.91,"AX",DT,DA)="" Q
"IX",52.91,52.91,"AC",1.4)

"IX",52.91,52.91,"AC",2)
K ^PS(52.91,"AC",$E(X,1,30),DA) S:$$PATCH^XPDUTL("PSO*7.0*146") ^PS(52.91,"AX",DT,DA)="" Q
"IX",52.91,52.91,"AC",2.4)

"IX",52.91,52.91,"AC",11.1,0)
^.114IA^1^1
"IX",52.91,52.91,"AC",11.1,1,0)
1^F^52.91^7^^1^F
"IX",52.91,52.91,"AX",0)
52.91^AX^Triggers the "AX" x-ref only during manual edit.^MU^^R^IR^I^52.91^^^^^A
"IX",52.91,52.91,"AX",1)
S:$$PATCH^XPDUTL("PSO*7.0*146") ^PS(52.91,"AX",DT,DA)="" Q
"IX",52.91,52.91,"AX",1.4)
N I S (X,I)=0 F  S I=$O(X1(I)) Q:'I  I X1(I)'=X2(I) S X=1 Q
"IX",52.91,52.91,"AX",2)
S:$$PATCH^XPDUTL("PSO*7.0*146") ^PS(52.91,"AX",DT,DA)="" Q
"IX",52.91,52.91,"AX",2.4)
N I S (X,I)=0 F  S I=$O(X1(I)) Q:'I  I X1(I)'=X2(I) S X=1 Q
"IX",52.91,52.91,"AX",11.1,0)
^.114IA^8^8
"IX",52.91,52.91,"AX",11.1,1,0)
1^F^52.91^1^^1^F
"IX",52.91,52.91,"AX",11.1,2,0)
2^F^52.91^2^^^F
"IX",52.91,52.91,"AX",11.1,3,0)
3^F^52.91^3^^^F
"IX",52.91,52.91,"AX",11.1,4,0)
4^F^52.91^4^^^F
"IX",52.91,52.91,"AX",11.1,5,0)
5^F^52.91^5^^^F
"IX",52.91,52.91,"AX",11.1,6,0)
6^F^52.91^6^^^F
"IX",52.91,52.91,"AX",11.1,7,0)
7^F^52.91^8^^^F
"IX",52.91,52.91,"AX",11.1,8,0)
8^F^52.91^9^^^F
"KRN",.403,29,-1)
0^1
"KRN",.403,29,0)
INSTITUTION EDIT^@^@^^3030725.1538^^^52.92^0^0^1
"KRN",.403,29,21)
2
"KRN",.403,29,40,0)
^.4031I^2^2
"KRN",.403,29,40,1,0)
1^^1,1
"KRN",.403,29,40,1,1)
Page 1
"KRN",.403,29,40,1,40,0)
^.4032IP^158^1
"KRN",.403,29,40,1,40,158,0)
EDIT INSTITUTION^1^1,1^e
"KRN",.403,29,40,2,0)
2^^1,1^^^1^9,68
"KRN",.403,29,40,2,1)
Page 2
"KRN",.403,29,40,2,40,0)
^.4032IP^159^1
"KRN",.403,29,40,2,40,159,0)
SELECT INSTITUTION^1^3,5^e
"KRN",.404,158,0)
EDIT INSTITUTION^52.92
"KRN",.404,158,15,0)
^^1^1^3030725^
"KRN",.404,158,15,1,0)
This form is used to edit the TRANSITIONAL RX INSTITUTION LETTERS file.
"KRN",.404,158,40,0)
^.4044I^28^27
"KRN",.404,158,40,1,0)
2^INSTITUTION^3
"KRN",.404,158,40,1,1)
.01
"KRN",.404,158,40,1,2)
2,19^30^2,1
"KRN",.404,158,40,2,0)
5^PARENT^3
"KRN",.404,158,40,2,1)
.02
"KRN",.404,158,40,2,2)
3,19^30^3,1
"KRN",.404,158,40,2,14)
N ZZ S ZZ=0 S:(X=DA) ZZ=1 S:(+$P(^(0),U,2)) ZZ=1 I ZZ S DDSERROR=1 D HLP^DDSUTL(">>>  Must Pick A Different Parent Institution    <<<")
"KRN",.404,158,40,3,0)
9^Line 1^3
"KRN",.404,158,40,3,1)
.05
"KRN",.404,158,40,3,2)
6,12^30^6,2
"KRN",.404,158,40,4,0)
10^Line 2^3
"KRN",.404,158,40,4,1)
.06
"KRN",.404,158,40,4,2)
7,12^30^7,2
"KRN",.404,158,40,6,0)
31^TPB CONTACT PHONE NUMBER(S)^1
"KRN",.404,158,40,6,2)
^^12,2
"KRN",.404,158,40,7,0)
19^#1^3
"KRN",.404,158,40,7,1)
.03
"KRN",.404,158,40,7,2)
12,37^25^12,33
"KRN",.404,158,40,8,0)
20^#2^3
"KRN",.404,158,40,8,1)
.04
"KRN",.404,158,40,8,2)
13,37^25^13,33
"KRN",.404,158,40,9,0)
21^DIRECTORS^1
"KRN",.404,158,40,9,2)
^^15,2
"KRN",.404,158,40,10,0)
22^Line 1^3
"KRN",.404,158,40,10,1)
2.01
"KRN",.404,158,40,10,2)
15,21^40^15,13
"KRN",.404,158,40,11,0)
24^Line 2^3
"KRN",.404,158,40,11,1)
2.02
"KRN",.404,158,40,11,2)
16,21^40^16,13
"KRN",.404,158,40,12,0)
26^Line 3^3
"KRN",.404,158,40,12,1)
2.03
"KRN",.404,158,40,12,2)
17,21^40^17,13
"KRN",.404,158,40,13,0)
11^CITY^3
"KRN",.404,158,40,13,1)
.07
"KRN",.404,158,40,13,2)
8,12^30^8,2
"KRN",.404,158,40,14,0)
12^State^3
"KRN",.404,158,40,14,1)
.09
"KRN",.404,158,40,14,2)
9,12^30^9,2
"KRN",.404,158,40,15,0)
13^Zip Code^3
"KRN",.404,158,40,15,1)
.08
"KRN",.404,158,40,15,2)
10,12^14^10,2
"KRN",.404,158,40,16,0)
1^TPB Institution Letter Edit^1
"KRN",.404,158,40,16,2)
^^1,19
"KRN",.404,158,40,17,0)
4^^4
"KRN",.404,158,40,17,2)
2,64^6
"KRN",.404,158,40,17,30)
S Y={.01:99}
"KRN",.404,158,40,18,0)
23^SIGNATURE^1
"KRN",.404,158,40,18,2)
^^16,2
"KRN",.404,158,40,19,0)
25^BLOCK^1
"KRN",.404,158,40,19,2)
^^17,2
"KRN",.404,158,40,20,0)
6^ADDRESS:^1
"KRN",.404,158,40,20,2)
^^5,2
"KRN",.404,158,40,21,0)
7^PHYSICAL - Letter Heading^1
"KRN",.404,158,40,21,2)
^^5,12
"KRN",.404,158,40,22,0)
8^MAILING - TPB Forms Return Address^1
"KRN",.404,158,40,22,2)
^^5,44
"KRN",.404,158,40,23,0)
14^^3
"KRN",.404,158,40,23,1)
1.01
"KRN",.404,158,40,23,2)
6,44^30
"KRN",.404,158,40,24,0)
15^^3
"KRN",.404,158,40,24,1)
1.02
"KRN",.404,158,40,24,2)
7,44^30
"KRN",.404,158,40,25,0)
16^^3
"KRN",.404,158,40,25,1)
1.03
"KRN",.404,158,40,25,2)
8,44^30
"KRN",.404,158,40,26,0)
18^^3
"KRN",.404,158,40,26,1)
1.05
"KRN",.404,158,40,26,2)
10,44^15
"KRN",.404,158,40,27,0)
3^Station #^1
"KRN",.404,158,40,27,2)
^^2,54
"KRN",.404,158,40,28,0)
17^^3
"KRN",.404,158,40,28,1)
1.04
"KRN",.404,158,40,28,2)
9,44^30
"KRN",.404,159,0)
SELECT INSTITUTION^52.92
"KRN",.404,159,40,0)
^.4044I^2^2
"KRN",.404,159,40,1,0)
1^Institution^2
"KRN",.404,159,40,1,.1)

"KRN",.404,159,40,1,2)
4,18^37^4,5
"KRN",.404,159,40,1,20)
P^^52.92
"KRN",.404,159,40,2,0)
2^TPB INSTITUTION LETTER^1
"KRN",.404,159,40,2,2)
^^1,12
"KRN",19,2181,-1)
0^3
"KRN",19,2181,0)
PSO TPB PATIENT ENTER/EDIT^Transitional Pharmacy Benefit Patient Enter/Edit^TEMPORARILY OUT OF ORDER - PLEASE CONTACT YOUR IRM^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,2181,1,0)
^19.06^3^3^3030806^^
"KRN",19,2181,1,1,0)
This option allows Clinical Pharmacist to enter/edit patient eligible for 
"KRN",19,2181,1,2,0)
the service set by the directive that allows Transitional Pharmacy Care
"KRN",19,2181,1,3,0)
from Non-VA physicians and dentists.
"KRN",19,2181,25)
PSOTPCEE
"KRN",19,2181,"U")
TRANSITIONAL PHARMACY BENEFIT 
"KRN",19,2182,-1)
0^2
"KRN",19,2182,0)
PSO TPB PATIENT REPORT^TPB Patient Report^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,2182,1,0)
^19.06^2^2^3030805^^^^
"KRN",19,2182,1,1,0)
This option prints various reports of patients that are in the
"KRN",19,2182,1,2,0)
TPB ELIGIBILITY file (#52.91).
"KRN",19,2182,25)
PSOTPCRP
"KRN",19,2182,"U")
TPB PATIENT REPORT
"KRN",19,2183,-1)
0^4
"KRN",19,2183,0)
PSO TPB INSTITUTION LETTERS^TPB Institution Letter Enter/Edit^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,2183,1,0)
^19.06^2^2^3030808^^^
"KRN",19,2183,1,1,0)
This allows the user to edit each TPB institution's information elements 
"KRN",19,2183,1,2,0)
that are to be printed in the letters to be sent to the patients.
"KRN",19,2183,25)
EDIT^PSOTPCL
"KRN",19,2183,"U")
TPB INSTITUTION LETTER ENTER/E
"KRN",19,2184,-1)
0^6
"KRN",19,2184,0)
PSO TPB PRINT LETTERS^Print TPB Patient Letter(s)^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,2184,1,0)
^^25^25^3030806^
"KRN",19,2184,1,1,0)
This option provides the ability to print TPB letters to be sent to 
"KRN",19,2184,1,2,0)
patients. A minimum data check on the institution letters' information to
"KRN",19,2184,1,3,0)
be printed will be performed prior to allowing the printing of the 
"KRN",19,2184,1,4,0)
patient leters.
"KRN",19,2184,1,5,0)
 
"KRN",19,2184,1,6,0)
Patients that do not have sufficient address information for mailing will 
"KRN",19,2184,1,7,0)
not be printed and will be contained in a mailman message to the user 
"KRN",19,2184,1,8,0)
identifying patients who were skipped over.
"KRN",19,2184,1,9,0)
 
"KRN",19,2184,1,10,0)
The user is presented several choices:
"KRN",19,2184,1,11,0)
 
"KRN",19,2184,1,12,0)
1) Print by Institution:
"KRN",19,2184,1,13,0)
 
"KRN",19,2184,1,14,0)
        a. All, or Select one or several institutions.       
"KRN",19,2184,1,15,0)
        b. Select letters "Printed", "Not Printed", or "Both".
"KRN",19,2184,1,16,0)
 
"KRN",19,2184,1,17,0)
        The letters wil print by institution and within institution
"KRN",19,2184,1,18,0)
        alphabetically by patient.
"KRN",19,2184,1,19,0)
 
"KRN",19,2184,1,20,0)
2) Select Patients
"KRN",19,2184,1,21,0)
        a. All, or select one or several patients.
"KRN",19,2184,1,22,0)
        b. Select letters "Printed", "Not Printed", or "Both".
"KRN",19,2184,1,23,0)
 
"KRN",19,2184,1,24,0)
        The letters wil print by institution and within institution
"KRN",19,2184,1,25,0)
        alphabetically by patient.
"KRN",19,2184,25)
PRINT^PSOTPCLP
"KRN",19,2184,"U")
PRINT TPB PATIENT LETTER(S)
"KRN",19,2185,-1)
0^5
"KRN",19,2185,0)
PSO TPB LETTERS PRINTED REPORT^Report TPB Patients Letters Printed/NOT Printed^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,2185,1,0)
^19.06^2^2^3030811^^
"KRN",19,2185,1,1,0)
This provides the user the ability to generate a report of patients 
"KRN",19,2185,1,2,0)
letters sent/NOT sent.
"KRN",19,2185,25)
EN^PSOTPCLR
"KRN",19,2185,"U")
REPORT TPB PATIENTS LETTERS PR
"MBREQ")
1
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
7.0^2971216^2980805^5
"PKG",16,22,1,"PAH",1,0)
145^3030826
"PKG",16,22,1,"PAH",1,1,0)
^^102^102^3030826
"PKG",16,22,1,"PAH",1,1,1,0)
This is the Phase I patch of the Transitional Pharmacy Benefit Project
"PKG",16,22,1,"PAH",1,1,2,0)
(TPB). This project provides functionality for the "Medication Prescribed 
"PKG",16,22,1,"PAH",1,1,3,0)
by Non-VA Physicians" to accommodate the Veterans Health Administration 
"PKG",16,22,1,"PAH",1,1,4,0)
(VHA) Directive 2003-047 that allows Department of Veterans Affairs (VA) 
"PKG",16,22,1,"PAH",1,1,5,0)
to furnish medications from non-VA physicians. It mandates that for
"PKG",16,22,1,"PAH",1,1,6,0)
eligible veterans that meet certain criteria, VHA will fill prescriptions
"PKG",16,22,1,"PAH",1,1,7,0)
written by non-VA physicians and dentists. To determine eligibility, a
"PKG",16,22,1,"PAH",1,1,8,0)
patient must meet the following criteria:
"PKG",16,22,1,"PAH",1,1,9,0)
 
"PKG",16,22,1,"PAH",1,1,10,0)
1) The patient must be a veteran.
"PKG",16,22,1,"PAH",1,1,11,0)
 
"PKG",16,22,1,"PAH",1,1,12,0)
2) The veteran must be enrolled for VA health care system before
"PKG",16,22,1,"PAH",1,1,13,0)
   July 25, 2003.
"PKG",16,22,1,"PAH",1,1,14,0)
 
"PKG",16,22,1,"PAH",1,1,15,0)
3) Before July 25,2003, the veteran must have requested their first 
"PKG",16,22,1,"PAH",1,1,16,0)
   primary care appointment with the VA.
"PKG",16,22,1,"PAH",1,1,17,0)
 
"PKG",16,22,1,"PAH",1,1,18,0)
4) The veteran must have no active prescriptions dispensed by the local 
"PKG",16,22,1,"PAH",1,1,19,0)
   VHA pharmacy, excluding Supply and Investigational items, for the past 
"PKG",16,22,1,"PAH",1,1,20,0)
   485 days from October 22, 2003.
"PKG",16,22,1,"PAH",1,1,21,0)
 
"PKG",16,22,1,"PAH",1,1,22,0)
5) The veteran must be waiting more than 30 days for their first 
"PKG",16,22,1,"PAH",1,1,23,0)
   appointment with a Primary Care Physician on or after October 22, 
"PKG",16,22,1,"PAH",1,1,24,0)
   2003, or the veteran is deemed eligible via an Electronic Wait
"PKG",16,22,1,"PAH",1,1,25,0)
   List/Scheduling extract run at each local site.
"PKG",16,22,1,"PAH",1,1,26,0)
 
"PKG",16,22,1,"PAH",1,1,27,0)
 
"PKG",16,22,1,"PAH",1,1,28,0)
 
"PKG",16,22,1,"PAH",1,1,29,0)
This patch is being sent out as a combined build, along with patch 
"PKG",16,22,1,"PAH",1,1,30,0)
SD*5.3*300.
"PKG",16,22,1,"PAH",1,1,31,0)
            
"PKG",16,22,1,"PAH",1,1,32,0)
 
"PKG",16,22,1,"PAH",1,1,33,0)
Outpatient Pharmacy will provide the following functionality in this 
"PKG",16,22,1,"PAH",1,1,34,0)
patch:
"PKG",16,22,1,"PAH",1,1,35,0)
 
"PKG",16,22,1,"PAH",1,1,36,0)
1. A Post-Install routine will scan through the PATIENT file (#2)
"PKG",16,22,1,"PAH",1,1,37,0)
and the SD WAIT LIST file (#409.3), and will populate the new Outpatient
"PKG",16,22,1,"PAH",1,1,38,0)
Pharmacy TPB ELIGIBILITY file (#52.91) with patients eligible for the
"PKG",16,22,1,"PAH",1,1,39,0)
Transitional Pharmacy Benefit. Patients will either be entered into the
"PKG",16,22,1,"PAH",1,1,40,0)
file as eligible, or ineligible. If they are entered into the file as
"PKG",16,22,1,"PAH",1,1,41,0)
ineligible, an exclusion reason will also be entered into the file. Please
"PKG",16,22,1,"PAH",1,1,42,0)
refer to the documentation for more details.
"PKG",16,22,1,"PAH",1,1,43,0)
  
"PKG",16,22,1,"PAH",1,1,44,0)
The average run time of the Post-Install at the test sites was 1 hour.
"PKG",16,22,1,"PAH",1,1,45,0)
 
"PKG",16,22,1,"PAH",1,1,46,0)
 
"PKG",16,22,1,"PAH",1,1,47,0)
2. The following new options are provided in this patch:
"PKG",16,22,1,"PAH",1,1,48,0)
   a. A new report option, TPB Patient Report [PSO TPB PATIENT REPORT], 
"PKG",16,22,1,"PAH",1,1,49,0)
      will be provided to display the patients in the TPB ELIGIBILITY file
"PKG",16,22,1,"PAH",1,1,50,0)
      (#52.91). Various sort criteria are provided.
"PKG",16,22,1,"PAH",1,1,51,0)
   b. The Transitional Pharmacy Benefit Patient Enter/Edit [PSO TPB  
"PKG",16,22,1,"PAH",1,1,52,0)
      PATIENT ENTER/EDIT] option will allow sites to add new patients, and
"PKG",16,22,1,"PAH",1,1,53,0)
      edit existing patients. Note: This option will be set initially to
"PKG",16,22,1,"PAH",1,1,54,0)
      "Out of Order", until the post-install runs to completion.
"PKG",16,22,1,"PAH",1,1,55,0)
   c. The TPB Institution Letter Enter/Edit [PSO TPB INSTITUTION LETTERS]
"PKG",16,22,1,"PAH",1,1,56,0)
      option allows the user to edit each TPB institution's information
"PKG",16,22,1,"PAH",1,1,57,0)
      elements that are to be printed on the letters to be sent to the
"PKG",16,22,1,"PAH",1,1,58,0)
      patients.
"PKG",16,22,1,"PAH",1,1,59,0)
   d. The Report TPB Patients Letters Printed/NOT Printed [PSO TPB LETTERS
"PKG",16,22,1,"PAH",1,1,60,0)
      PRINTED REPORT] option provides the user the ability to generate a
"PKG",16,22,1,"PAH",1,1,61,0)
      report of patients' letters printed or not printed.
"PKG",16,22,1,"PAH",1,1,62,0)
   e. The Print TPB Patient Letter(s) [PSO TPB PRINT LETTERS] option
"PKG",16,22,1,"PAH",1,1,63,0)
      provides the ability to print TPB letters to be sent to patients.
"PKG",16,22,1,"PAH",1,1,64,0)
                        
"PKG",16,22,1,"PAH",1,1,65,0)
 
"PKG",16,22,1,"PAH",1,1,66,0)
KIDS Build and Documentation Retrieval:
"PKG",16,22,1,"PAH",1,1,67,0)
======================================================
"PKG",16,22,1,"PAH",1,1,68,0)
 
"PKG",16,22,1,"PAH",1,1,69,0)
The KIDS Build and VISTA documentation are available on the 
"PKG",16,22,1,"PAH",1,1,70,0)
ANONYMOUS.SOFTWARE directory at one of the following Office of Information
"PKG",16,22,1,"PAH",1,1,71,0)
(OI) Field Offices.
"PKG",16,22,1,"PAH",1,1,72,0)
 
"PKG",16,22,1,"PAH",1,1,73,0)
 
"PKG",16,22,1,"PAH",1,1,74,0)
Sites may retrieve documentation in one of the following ways:
"PKG",16,22,1,"PAH",1,1,75,0)
 
"PKG",16,22,1,"PAH",1,1,76,0)
(1) The preferred method is to FTP the files from
"PKG",16,22,1,"PAH",1,1,77,0)
    download.vista.med.va.gov, which will transmit the files from the 
"PKG",16,22,1,"PAH",1,1,78,0)
    first available FTP server.
"PKG",16,22,1,"PAH",1,1,79,0)
  
"PKG",16,22,1,"PAH",1,1,80,0)
(2) Sites may also elect to retrieve documentation directly from a
"PKG",16,22,1,"PAH",1,1,81,0)
    specific server as follows:
"PKG",16,22,1,"PAH",1,1,82,0)
 
"PKG",16,22,1,"PAH",1,1,83,0)
    Albany          ftp.fo-albany.med.va.gov
"PKG",16,22,1,"PAH",1,1,84,0)
    Hines           ftp.fo-hines.med.va.gov
"PKG",16,22,1,"PAH",1,1,85,0)
    Salt Lake City  ftp.fo-slc.med.va.gov
"PKG",16,22,1,"PAH",1,1,86,0)
 
"PKG",16,22,1,"PAH",1,1,87,0)
 
"PKG",16,22,1,"PAH",1,1,88,0)
The software distribution includes: 
"PKG",16,22,1,"PAH",1,1,89,0)
 
"PKG",16,22,1,"PAH",1,1,90,0)
    FILE NAMES                    DESCRIPTION
"PKG",16,22,1,"PAH",1,1,91,0)
 
"PKG",16,22,1,"PAH",1,1,92,0)
    PSO_TPB_ELIGIBILITY_1_0.KID   KIDS Build         
"PKG",16,22,1,"PAH",1,1,93,0)
    PSO_7_P145_IG.PDF             Installation Guide
"PKG",16,22,1,"PAH",1,1,94,0)
    PSO_7_UM_R0803.PDF            User Manual
"PKG",16,22,1,"PAH",1,1,95,0)
    PSO_7_P145_UM_CP.PDF          User Manual Change Page Document
"PKG",16,22,1,"PAH",1,1,96,0)
    PSO_7_TM_R0803.PDF            Technical Manual
"PKG",16,22,1,"PAH",1,1,97,0)
    PSO_7_P145_TM_CP.PDF          Technical Manual Change Page Document
"PKG",16,22,1,"PAH",1,1,98,0)
    PSO_7_P145_RN.PDF             Release Notes
"PKG",16,22,1,"PAH",1,1,99,0)
 
"PKG",16,22,1,"PAH",1,1,100,0)
(3) Documentation can also be retrieved from VISTA Documentation Library
"PKG",16,22,1,"PAH",1,1,101,0)
(VDL) on the Internet at the following address,
"PKG",16,22,1,"PAH",1,1,102,0)
http://www.va.gov/vdl.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","PSO145PS")
0^8^B1614089
"RTN","PSO145PS",1,0)
PSO145PS ;BIRM/PDW-POST INIT TO POPULATE TPB INSTITUTION LETTERS 52.92 ;AUG 5, 2003
"RTN","PSO145PS",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145**;DEC 1997
"RTN","PSO145PS",3,0)
 Q
"RTN","PSO145PS",4,0)
EN ;Take institution entries from 52.91 & stuff into 52.92
"RTN","PSO145PS",5,0)
 S LOCDA=0 F  S LOCDA=$O(^PS(52.91,"AC",LOCDA)) Q:LOCDA'>0  D LOCDA
"RTN","PSO145PS",6,0)
 Q
"RTN","PSO145PS",7,0)
LOCDA ;Get physical and mailing address
"RTN","PSO145PS",8,0)
 I $D(^PS(52.92,LOCDA,0)) Q  ;Do not duplicate a site
"RTN","PSO145PS",9,0)
 N FAC,FDA
"RTN","PSO145PS",10,0)
 ; set FAC(FLD#)=(INTvalue of FLD#); ex:  FAC(.01)=500 :"Birmingham VAMC"
"RTN","PSO145PS",11,0)
 ;
"RTN","PSO145PS",12,0)
 F XX=.01,.02,1.01,1.02,1.03,1.04 S FAC(XX)=$$GET1^DIQ(4,LOCDA,XX,"I")
"RTN","PSO145PS",13,0)
 F XX=4.01,4.02,4.03,4.04,4.05 S FAC(XX)=$$GET1^DIQ(4,LOCDA,XX,"I")
"RTN","PSO145PS",14,0)
 ;
"RTN","PSO145PS",15,0)
 ; build/map fields from iNSTITUTION file to TPB INSTITUTION LETTER
"RTN","PSO145PS",16,0)
 ; file into FDA for FM update
"RTN","PSO145PS",17,0)
 ;
"RTN","PSO145PS",18,0)
 ; "XFDL^YFLD" stuff file #52.92(XFLD) FDA with file #4(YFLD)
"RTN","PSO145PS",19,0)
 ;
"RTN","PSO145PS",20,0)
 F XX=".01^.01",".05^1.01",".06^1.02",".07^1.03",".08^1.04",".09^.02","1.01^4.01","1.02^4.02","1.03^4.03","1.04^4.04","1.05^4.05" D
"RTN","PSO145PS",21,0)
 . S XFLD=+XX,YFLD=$P(XX,U,2)
"RTN","PSO145PS",22,0)
 . S FDA(52.92,"+1,",XFLD)=FAC(YFLD)
"RTN","PSO145PS",23,0)
 S FDA(52.92,"+1,",.01)=LOCDA,LOCDA(1)=LOCDA
"RTN","PSO145PS",24,0)
 D UPDATE^DIE("","FDA","LOCDA","MSG")
"RTN","PSO145PS",25,0)
 Q
"RTN","PSOTPCEE")
0^1^B7617884
"RTN","PSOTPCEE",1,0)
PSOTPCEE ;BIR/MHA-transitional pharmacy benefit enter/edit ;07/01/03
"RTN","PSOTPCEE",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145**;DEC 1997
"RTN","PSOTPCEE",3,0)
 ;;External reference to SDPHARM1 supported by DBIA 4196
"RTN","PSOTPCEE",4,0)
 ;;External reference ^DIC(4 supported by DBIA 2251
"RTN","PSOTPCEE",5,0)
ST N PSODFN,FLG,PSODF,FI,INST,SNO,CDT,UL S FI=52.91,$P(UL,"=",79)="="
"RTN","PSOTPCEE",6,0)
PT K DIC,DIE,PSODFN,FLG,PSODF,REC,INST,SNO,CDT
"RTN","PSOTPCEE",7,0)
 W ! S (DIC,DIE)=52.91,DIC(0)="QEALM",DLAYGO=FI
"RTN","PSOTPCEE",8,0)
 ;S DIC("W")="W ?15,$$GET1^DIQ(2,+Y,.01)"
"RTN","PSOTPCEE",9,0)
 D ^DIC G:+Y'>0 PTX S FLG=$P(Y,"^",3)
"RTN","PSOTPCEE",10,0)
 S (PSODFN,DA)=+Y,DR=.351,DIC=2,DIQ="PSODF" D EN^DIQ1 K DIC,DR,DIQ
"RTN","PSOTPCEE",11,0)
 I $G(PSODF(2,DA,.351))]"",FLG D  G PT
"RTN","PSOTPCEE",12,0)
 .W !!?10,$C(7),"Patient died on "_PSODF(2,PSODFN,.351)_" - Cannot be added to file!!",!
"RTN","PSOTPCEE",13,0)
 .S DIK="^PS(52.91," D ^DIK K DIK
"RTN","PSOTPCEE",14,0)
 L +^PS(FI,DA):0 I '$T W $C(7),!!,"Patient Data is Being Edited by Another User!",! G PT
"RTN","PSOTPCEE",15,0)
 S (INST,SNO)="" D:FLG
"RTN","PSOTPCEE",16,0)
 .S X=$$DEF^SDPHARM1(DA) S:X INST=$P(X,"^"),SNO=$P(X,"^",2)
"RTN","PSOTPCEE",17,0)
 .S DR="1////"_DT_";5////M;6////"_SNO_";7////"_INST D ^DIE
"RTN","PSOTPCEE",18,0)
INS S REC=$G(^PS(FI,DA,0))
"RTN","PSOTPCEE",19,0)
 S DR="7" D ^DIE I $D(Y)!($D(DTOUT)) D:FLG RM L -^PS(FI,DA) G PT
"RTN","PSOTPCEE",20,0)
 I X,X'=$P(REC,"^",8) S $P(REC,"^",7)=$P($G(^DIC(4,X,99)),"^"),DR="6////"_$P($G(^DIC(4,X,99)),"^") D ^DIE
"RTN","PSOTPCEE",21,0)
 S DR="6" D ^DIE I $D(Y)!($D(DTOUT)) D:FLG RM L -^PS(52.91,DA) G PT
"RTN","PSOTPCEE",22,0)
 I X,X'=$P(REC,"^",7),$$IEN^XUAF4(X) S DR="7////"_$$IEN^XUAF4(X) D ^DIE G INS
"RTN","PSOTPCEE",23,0)
 S CDT=$P(REC,"^",3)
"RTN","PSOTPCEE",24,0)
 S DR="2" D ^DIE I $D(Y)!($D(DTOUT)) L -^PS(FI,DA) G PT
"RTN","PSOTPCEE",25,0)
 I CDT,X="" S DR="3////@" D ^DIE W !,"INACTIVATION REASON CODE: " G CONT
"RTN","PSOTPCEE",26,0)
 I X S DR="3R",DIE("NO^")="" D ^DIE I $D(DTOUT) S DR="3////3" D ^DIE L -^PS(FI,DA) G PT
"RTN","PSOTPCEE",27,0)
CONT L -^PS(FI,DA)
"RTN","PSOTPCEE",28,0)
 S Y=$S(FLG:DT,1:$P(REC,"^",2)) X ^DD("DD")
"RTN","PSOTPCEE",29,0)
 W !!,UL,!,"DATE PHARMACY BENEFIT BEGAN: "_Y
"RTN","PSOTPCEE",30,0)
 S Y=$P(REC,"^",6),Y=$S(Y="E":"EWL",Y="S":"SCHEDULED APPOINTMENT",Y="X":"EWL & SCHEDULED APPOINTMENT",Y="M":"MANUAL",1:"")
"RTN","PSOTPCEE",31,0)
 W ?42,"WAIT TYPE: "_Y
"RTN","PSOTPCEE",32,0)
 S Y=$P(REC,"^",5) I Y X ^DD("DD")
"RTN","PSOTPCEE",33,0)
 W !,"DESIRED APPOINTMENT DATE: "_Y
"RTN","PSOTPCEE",34,0)
 W !,"EXCLUSION REASON: " S Y=$P(REC,"^",9)
"RTN","PSOTPCEE",35,0)
 W:Y=1 "ACTIVE RX"
"RTN","PSOTPCEE",36,0)
 W:Y=2 "ACTUAL APPT. < 30 DAYS FROM DATE APPT. MADE"
"RTN","PSOTPCEE",37,0)
 W:Y=3 "ACTIVE RX & ACTUAL APPT. < 30 DAYS FROM DATE APPT. MADE"
"RTN","PSOTPCEE",38,0)
 S Y=$P(REC,"^",10) I Y X ^DD("DD")
"RTN","PSOTPCEE",39,0)
 W !,"PRIMARY CARE SCHEDULE APT DATE: "_Y_"   "_"RX #: "_$P(REC,"^",11)
"RTN","PSOTPCEE",40,0)
 S Y=$P(REC,"^",12) I Y X ^DD("DD")
"RTN","PSOTPCEE",41,0)
 W !,"DATE LETTER PRINTED: "_Y,!,UL
"RTN","PSOTPCEE",42,0)
 G PT
"RTN","PSOTPCEE",43,0)
PTX K DIC,DIE,%DT,DR,DA Q
"RTN","PSOTPCEE",44,0)
RM ;
"RTN","PSOTPCEE",45,0)
 ;W !?10,$C(7),"Required Data - Setting patient as Inactive"
"RTN","PSOTPCEE",46,0)
 ;S DR="2////"_DT_";3////3" D ^DIE
"RTN","PSOTPCEE",47,0)
 W !!,$C(7),"Required Data - deleting patient entry from TPB ELIGIBILITY (#52.91) File."
"RTN","PSOTPCEE",48,0)
 K DIK S DIK="^PS(52.91,",DA=PSODFN D ^DIK K DIK
"RTN","PSOTPCEE",49,0)
 Q
"RTN","PSOTPCL")
0^5^B20966442
"RTN","PSOTPCL",1,0)
PSOTPCL ;BIRM/PDW-EDIT TPC INSTITUTION LETTERS
"RTN","PSOTPCL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145**;DEC 1997
"RTN","PSOTPCL",3,0)
 Q
"RTN","PSOTPCL",4,0)
EDIT ; Manual edit of institution letter information in 52.92
"RTN","PSOTPCL",5,0)
 W @IOF
"RTN","PSOTPCL",6,0)
 W !,"                             Transitional Pharmacy Care"
"RTN","PSOTPCL",7,0)
 W !,"                       Edit Institution  Letter  Information"
"RTN","PSOTPCL",8,0)
EDIT2 W !!,"(You may add a NEW Institution at this point.)",!
"RTN","PSOTPCL",9,0)
 D PSTINT
"RTN","PSOTPCL",10,0)
 K DIC,DA
"RTN","PSOTPCL",11,0)
 S DIC=52.92,DIC(0)="AEQML",DIC("W")="W ?40,$$GET1^DIQ(52.92,+Y,.02) W:$$CHKINST^PSOTPCL(+Y) ?69,"" Incomp""",DIC("A")="Select/Add TPB INSTITUTION: ",DLAYGO=52.92
"RTN","PSOTPCL",12,0)
 D ^DIC K DLAYGO
"RTN","PSOTPCL",13,0)
 G:Y'>0 EXIT
"RTN","PSOTPCL",14,0)
 S DA=+Y,DR="[INSTITUTION EDIT]",DDSFILE=52.92
"RTN","PSOTPCL",15,0)
 D ^DDS
"RTN","PSOTPCL",16,0)
 G EDIT2
"RTN","PSOTPCL",17,0)
 ;
"RTN","PSOTPCL",18,0)
EXIT K DIC,DIE,DR,DDSFILE
"RTN","PSOTPCL",19,0)
 W @IOF
"RTN","PSOTPCL",20,0)
 Q
"RTN","PSOTPCL",21,0)
PSTINT ;Take institution entries from 52.91 & stuff into 52.92
"RTN","PSOTPCL",22,0)
 S LOCDA=0 F  S LOCDA=$O(^PS(52.91,"AC",LOCDA)) Q:LOCDA'>0  D LOCDA
"RTN","PSOTPCL",23,0)
 Q
"RTN","PSOTPCL",24,0)
LOCDA ;Get physical and mailing address
"RTN","PSOTPCL",25,0)
 I $D(^PS(52.92,LOCDA,0)) Q
"RTN","PSOTPCL",26,0)
 N FAC,FDA
"RTN","PSOTPCL",27,0)
 ; set FAC(FLD#)=(INTvalue of FLD#); ex:  FAC(.01)=500 :"Birmingham VAMC"
"RTN","PSOTPCL",28,0)
 ;
"RTN","PSOTPCL",29,0)
 F XX=.01,.02,1.01,1.02,1.03,1.04 S FAC(XX)=$$GET1^DIQ(4,LOCDA,XX,"I")
"RTN","PSOTPCL",30,0)
 F XX=4.01,4.02,4.03,4.04,4.05 S FAC(XX)=$$GET1^DIQ(4,LOCDA,XX,"I")
"RTN","PSOTPCL",31,0)
 ;
"RTN","PSOTPCL",32,0)
 ; build/map fields from iNSTITUTION file to TPB INSTITUTION LETTER
"RTN","PSOTPCL",33,0)
 ; file into FDA
"RTN","PSOTPCL",34,0)
 ; "XFDL^YFLD," stuff XFLD of file 52.92 with YFLD of file 4
"RTN","PSOTPCL",35,0)
 ;
"RTN","PSOTPCL",36,0)
 F XX=".01^.01",".05^1.01",".06^1.02",".07^1.03",".08^1.04",".09^.02","1.01^4.01","1.02^4.02","1.03^4.03","1.04^4.04","1.05^4.05" D
"RTN","PSOTPCL",37,0)
 . S XFLD=+XX,YFLD=$P(XX,U,2)
"RTN","PSOTPCL",38,0)
 . S FDA(52.92,"+1,",XFLD)=FAC(YFLD)
"RTN","PSOTPCL",39,0)
 S FDA(52.92,"+1,",.01)=LOCDA,LOCDA(1)=LOCDA
"RTN","PSOTPCL",40,0)
 D UPDATE^DIE("","FDA","LOCDA","MSG")
"RTN","PSOTPCL",41,0)
 Q
"RTN","PSOTPCL",42,0)
SEL ;Select divisions
"RTN","PSOTPCL",43,0)
 ; returns arrays
"RTN","PSOTPCL",44,0)
 ; for testing
"RTN","PSOTPCL",45,0)
 W !!,"SELECTION OF INSTITUTION(S)",!
"RTN","PSOTPCL",46,0)
 K DIVNM,DIVDA,DIVX
"RTN","PSOTPCL",47,0)
 S DIVDA=0 F I=1:1 S DIVDA=$O(^PS(52.92,"B",DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCL",48,0)
 . Q:$$CHKINST(DIVDA)  ; only completed institutions
"RTN","PSOTPCL",49,0)
 . S DIV=$$GET1^DIQ(52.92,DIVDA,.01)  S INST(DIVDA)=DIV
"RTN","PSOTPCL",50,0)
 K DIR S DIR(0)="S^A:ALL INSTITUTIONS;S:SELECT INSTITUTIONS"
"RTN","PSOTPCL",51,0)
 D ^DIR K DIR
"RTN","PSOTPCL",52,0)
 G:Y="A" ALL
"RTN","PSOTPCL",53,0)
 G:Y="S" SELECT
"RTN","PSOTPCL",54,0)
 K INST
"RTN","PSOTPCL",55,0)
 Q
"RTN","PSOTPCL",56,0)
SELECT ; select range of divisioins
"RTN","PSOTPCL",57,0)
 K INST,DIC
"RTN","PSOTPCL",58,0)
 S DIC="^PS(52.92,",DIC(0)="AEQM"
"RTN","PSOTPCL",59,0)
 F  S DIC("W")="W ?40,$E($$GET1^DIQ(52.92,+Y,.02),1,18) I $$CHKINST^PSOTPCL(+Y) W ?60,""Incomplete""" D ^DIC Q:Y'>0  D
"RTN","PSOTPCL",60,0)
 . I $$CHKINST(+Y) W !,"Sorry, data for that institution is incomplete",! Q
"RTN","PSOTPCL",61,0)
 . S INST(+Y)=$$GET1^DIQ(52.92,+Y,.01)
"RTN","PSOTPCL",62,0)
ALL K PSOSTOP
"RTN","PSOTPCL",63,0)
 I '$D(INST) S INST="" W !,"None Selected - Quitting",! H 3 Q
"RTN","PSOTPCL",64,0)
 W !!,"You have selected:",! S DIV=0 F II=1:1 D:'(II#18) PG Q:$G(PSOSTOP)  S DIV=$O(INST(DIV)) Q:'DIV  W !,?5,INST(DIV)
"RTN","PSOTPCL",65,0)
 S DIR(0)="Y",DIR("A")="Is this correct ",DIR("B")="YES" D ^DIR
"RTN","PSOTPCL",66,0)
 K DIR
"RTN","PSOTPCL",67,0)
 Q:Y
"RTN","PSOTPCL",68,0)
 G SEL
"RTN","PSOTPCL",69,0)
 ;
"RTN","PSOTPCL",70,0)
PG K DIR S DIR(0)="E",DIR("A")="CR - CONTINUE  ^ - Quit" D ^DIR
"RTN","PSOTPCL",71,0)
 S:X["^" PSOSTOP=1
"RTN","PSOTPCL",72,0)
 Q
"RTN","PSOTPCL",73,0)
INSTCHK() ; check required fields of INST in the array INST(INSTDA)
"RTN","PSOTPCL",74,0)
 N FAC S FAC=0
"RTN","PSOTPCL",75,0)
 S INSTDA=0 F  S INSTDA=$O(INST(INSTDA)) Q:INSTDA'>0  S XX=$$CHKINST(INSTDA) I $L(XX) W !,"Sorry, required field(s) are missing from ",INST(INSTDA) S FAC=1
"RTN","PSOTPCL",76,0)
 I $G(FAC) D
"RTN","PSOTPCL",77,0)
 . W !,"= = = = ="
"RTN","PSOTPCL",78,0)
 . W !!,"The above institution(s) will need to have their letter information edited",!,"before the letters for that facility can be printed",!
"RTN","PSOTPCL",79,0)
 . K DIR S DIR(0)="EO" D ^DIR K DIR
"RTN","PSOTPCL",80,0)
 . I X["^" S PSOSTOP=1
"RTN","PSOTPCL",81,0)
 Q FAC
"RTN","PSOTPCL",82,0)
 ;
"RTN","PSOTPCL",83,0)
CHKINST(INSTDA) ; check institution in 52.92 for required edited fields
"RTN","PSOTPCL",84,0)
 N XX,FAC,PAR S FAC=""
"RTN","PSOTPCL",85,0)
 ; see if parent, parent checks OK
"RTN","PSOTPCL",86,0)
 S PAR=$$GET1^DIQ(52.92,INSTDA,.02,"I") I PAR S XX=$$CHKINST(PAR) Q XX
"RTN","PSOTPCL",87,0)
 F YY=.05,.07,.08,2.01 S XX=$$GET1^DIQ(52.92,INSTDA,YY) I $L(XX)=0 S FAC=FAC_YY_","
"RTN","PSOTPCL",88,0)
 Q FAC
"RTN","PSOTPCL",89,0)
PTCHK() ; Check file 52.91 for INST fields and 52.92 for INSTUTITONs present
"RTN","PSOTPCL",90,0)
 N INST,CHK,INSTDA S INSTDA=0,CHK=0
"RTN","PSOTPCL",91,0)
 F  S INSTDA=$O(^PS(52.91,"AC",INSTDA)) Q:INSTDA'>0  D
"RTN","PSOTPCL",92,0)
 . I $D(^PS(52.92,INSTDA)) Q
"RTN","PSOTPCL",93,0)
 . S CHK=1
"RTN","PSOTPCL",94,0)
 . W !!,$$GET1^DIQ(4,INSTDA,.01),!," is missing from the TRANSITIONAL RX INSTITUTION LETTERS file #52.92",!,"and is being added."
"RTN","PSOTPCL",95,0)
 . S LOCDA=INSTDA N INST,FAC D LOCDA ; add INSTDA to # 52.92
"RTN","PSOTPCL",96,0)
 I CHK D
"RTN","PSOTPCL",97,0)
 . W !,"= = = = ="
"RTN","PSOTPCL",98,0)
 . W !!,"The above institution(s) will need to have their letter information edited",!,"before the letters for that facility can be printed",!
"RTN","PSOTPCL",99,0)
 . K DIR S DIR(0)="EO",DIR("A")="<cr> - Continue" D ^DIR K DIR
"RTN","PSOTPCL",100,0)
 Q CHK
"RTN","PSOTPCLP")
0^10^B61856325
"RTN","PSOTPCLP",1,0)
PSOTPCLP ;BIRM/PDW-PRINT PATIENT LETTERS ;AUG 5,2003
"RTN","PSOTPCLP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145**;DEC 1997
"RTN","PSOTPCLP",3,0)
 Q
"RTN","PSOTPCLP",4,0)
PRINT ; select options
"RTN","PSOTPCLP",5,0)
 K ^TMP($J,"TPBLET"),TMP($J,"TPCLW")
"RTN","PSOTPCLP",6,0)
 D EXIT ;INITIALIZE
"RTN","PSOTPCLP",7,0)
 ;build INST to show incompleted Institutions
"RTN","PSOTPCLP",8,0)
 K INST S DIVDA=0 F  S DIVDA=$O(^PS(52.92,DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLP",9,0)
 . S INST(DIVDA)=$$GET1^DIQ(52.92,DIVDA,.01)
"RTN","PSOTPCLP",10,0)
 S XX=$$INSTCHK^PSOTPCL I $G(PSOSTOP) Q
"RTN","PSOTPCLP",11,0)
 K INST S DIVDA=0 F  S DIVDA=$O(^PS(52.92,DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLP",12,0)
 . Q:$$CHKINST^PSOTPCL(DIVDA)
"RTN","PSOTPCLP",13,0)
 . S INST(DIVDA)=$$GET1^DIQ(52.92,DIVDA,.01)
"RTN","PSOTPCLP",14,0)
 K PARAM,PATLST
"RTN","PSOTPCLP",15,0)
 K DIR S DIR(0)="SO^A:Print all letters that have not printed;P:Print letter by a patient or multiple patients;I:Print by institution (all, one, or a selection)" D ^DIR
"RTN","PSOTPCLP",16,0)
 I Y="A" S PARAM("SORT")="I",PATLST="",PARAM("LP")="N" G DEVICE
"RTN","PSOTPCLP",17,0)
 I Y="P" G PATIENT
"RTN","PSOTPCLP",18,0)
 I Y="I" G DIVISION
"RTN","PSOTPCLP",19,0)
 W !,"None Selected - Quitting",! H 3
"RTN","PSOTPCLP",20,0)
 G EXIT
"RTN","PSOTPCLP",21,0)
PATIENT ; print by patients
"RTN","PSOTPCLP",22,0)
 S PARAM("SORT")="P",PARAM("LP")="B"
"RTN","PSOTPCLP",23,0)
 D PATSEL ; build PATLST("patient name")=DFN
"RTN","PSOTPCLP",24,0)
 G:($D(PATLST)<10) EXIT
"RTN","PSOTPCLP",25,0)
 G DEVICE
"RTN","PSOTPCLP",26,0)
DIVISION ;print by division
"RTN","PSOTPCLP",27,0)
 K DIR S DIR(0)="SO^N:Letters NOT Printed;P:Letters Printed;B:Both"
"RTN","PSOTPCLP",28,0)
 D ^DIR Q:"NPB"'[Y
"RTN","PSOTPCLP",29,0)
 S PARAM("LP")=Y
"RTN","PSOTPCLP",30,0)
 S PARAM("SORT")="I"
"RTN","PSOTPCLP",31,0)
 K INST D SEL^PSOTPCL
"RTN","PSOTPCLP",32,0)
 I ($D(INST)<10) W !,"No Selection Made - Quitting",! H 3 G EXIT
"RTN","PSOTPCLP",33,0)
 G DEVICE
"RTN","PSOTPCLP",34,0)
PATSEL ; Select one or more patients
"RTN","PSOTPCLP",35,0)
 K PATLST
"RTN","PSOTPCLP",36,0)
 S DIC="^PS(52.91,",DIC(0)="AEQM",DIC("W")="D DSPPAT^PSOTPCLP(+Y)"
"RTN","PSOTPCLP",37,0)
 F  S DIC("W")="D DSPPAT^PSOTPCLP(+Y)" D ^DIC Q:Y'>0  S DFN=+Y,PTNM=$$GET1^DIQ(52.91,DFN,.01),PATLST(PTNM,DFN)="" D
"RTN","PSOTPCLP",38,0)
 . ;test death date
"RTN","PSOTPCLP",39,0)
 . S XX=$$GET1^DIQ(2,DFN,.351) I XX'="" D  Q
"RTN","PSOTPCLP",40,0)
 .. W !!,"Sorry, ",PTNM," died ",XX,!
"RTN","PSOTPCLP",41,0)
 .. K PATLST(PTNM,DFN) H 3
"RTN","PSOTPCLP",42,0)
 . ;test expired date
"RTN","PSOTPCLP",43,0)
 . S EXPDTI=$$GET1^DIQ(52.91,DFN,2,"I")
"RTN","PSOTPCLP",44,0)
 . I EXPDTI,DT>EXPDTI D
"RTN","PSOTPCLP",45,0)
 .. S EXPDT=$$GET1^DIQ(52.91,+DFN,2)
"RTN","PSOTPCLP",46,0)
 .. W !,"Sorry, ",PTNM,"'s eligibility expired ",EXPDT,! K PATLST(PTNM,DFN)
"RTN","PSOTPCLP",47,0)
 . ;check divisions required data
"RTN","PSOTPCLP",48,0)
 . S DIVDA=$$GET1^DIQ(52.91,DFN,7,"I")
"RTN","PSOTPCLP",49,0)
 . S XX=$$CHKINST^PSOTPCL(DIVDA) I XX D
"RTN","PSOTPCLP",50,0)
 .. W !!,"Sorry, ",$$GET1^DIQ(52.91,DFN,7)," is missing required fields.",!!
"RTN","PSOTPCLP",51,0)
 .. K PATLST(PTNM,DFN)
"RTN","PSOTPCLP",52,0)
 ;
"RTN","PSOTPCLP",53,0)
LST I ($D(PATLST)<10) W !,"No Patients Selected - Quitting",! H 3 S PATLST="" Q
"RTN","PSOTPCLP",54,0)
 W !!,"You have selected:",!
"RTN","PSOTPCLP",55,0)
 S PATNM="" F I=1:1 S PATNM=$O(PATLST(PATNM)) Q:'$L(PATNM)  S DFN=0 F  S DFN=$O(PATLST(PATNM,DFN)) Q:DFN'>0  W !,PATNM D DSPPAT(DFN) I '(I#20) D  D ^DIR I X["^" Q
"RTN","PSOTPCLP",56,0)
 .K DIR S DIR(0)="E",DIR("A")="<cr> - Continue ""^"" - Stop Display"
"RTN","PSOTPCLP",57,0)
 ;
"RTN","PSOTPCLP",58,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Is the above correct ",DIR("B")="YES" D ^DIR
"RTN","PSOTPCLP",59,0)
 I 'Y G PATSEL
"RTN","PSOTPCLP",60,0)
 Q
"RTN","PSOTPCLP",61,0)
DSPPAT(DFN) ; Display Division and expire date
"RTN","PSOTPCLP",62,0)
 N DIVNM,EXPDT,PRTDT
"RTN","PSOTPCLP",63,0)
 S DIVNM=$$GET1^DIQ(52.91,DFN,7) W ?32,$E(DIVNM,1,15)
"RTN","PSOTPCLP",64,0)
 S EXPDT=$$GET1^DIQ(52.91,DFN,2,"I")
"RTN","PSOTPCLP",65,0)
 I EXPDT S EXPDT=$$FMTE^XLFDT(EXPDT,"2D") W ?50,"Inact ",EXPDT
"RTN","PSOTPCLP",66,0)
 S PRTDT=$$GET1^DIQ(52.91,DFN,11,"I")
"RTN","PSOTPCLP",67,0)
 I PRTDT S PRTDT=$$FMTE^XLFDT(PRTDT,"2D") W ?66,"Prt ",PRTDT
"RTN","PSOTPCLP",68,0)
 Q
"RTN","PSOTPCLP",69,0)
DEVICE ;
"RTN","PSOTPCLP",70,0)
 W !,"Queueing is recommended",!
"RTN","PSOTPCLP",71,0)
 S %ZIS="Q" D ^%ZIS
"RTN","PSOTPCLP",72,0)
 Q:POP
"RTN","PSOTPCLP",73,0)
 I $D(IO("Q")) D  K ZTSK G EXIT
"RTN","PSOTPCLP",74,0)
 . S (PATLST,INST,PARAM)=""
"RTN","PSOTPCLP",75,0)
 . S ZTRTN="DEQUE^PSOTPCLP",ZTDESC="TPB PRINT PATIENT LETTERS"
"RTN","PSOTPCLP",76,0)
 . F XX="PATLST*","INST*","PARAM*" S ZTSAVE(XX)=""
"RTN","PSOTPCLP",77,0)
 . ;W ! ZW ZTRTN,ZTDESC,PATLST,INST,PARAM,ZTSAVE
"RTN","PSOTPCLP",78,0)
 . D ^%ZTLOAD
"RTN","PSOTPCLP",79,0)
 . I $G(ZTSK) W !!,"Tasked with "_ZTSK
"RTN","PSOTPCLP",80,0)
 ;  (code falls through if not queued)
"RTN","PSOTPCLP",81,0)
DEQUE ; DEQUE/PRINT LETTERS
"RTN","PSOTPCLP",82,0)
 K ^TMP($J,"TPBLET")
"RTN","PSOTPCLP",83,0)
 I PARAM("SORT")="P" G SORTPAT
"RTN","PSOTPCLP",84,0)
 S DIVDA=0 F  S DIVDA=$O(INST(DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLP",85,0)
 . S DFN=0 F  S DFN=$O(^PS(52.91,"AC",DIVDA,DFN)) Q:DFN'>0  D
"RTN","PSOTPCLP",86,0)
 .. S PTNM=$$GET1^DIQ(52.91,DFN,.01)
"RTN","PSOTPCLP",87,0)
 .. S EXPDTI=$P(^PS(52.91,DFN,0),"^",3),LTPDTI=$P(^(0),"^",12)
"RTN","PSOTPCLP",88,0)
 .. Q:EXPDTI
"RTN","PSOTPCLP",89,0)
 .. Q:$L($$GET1^DIQ(2,DFN,.351))
"RTN","PSOTPCLP",90,0)
 .. I PARAM("LP")="N",LTPDTI Q
"RTN","PSOTPCLP",91,0)
 .. I PARAM("LP")="P",'LTPDTI Q
"RTN","PSOTPCLP",92,0)
 .. S ^TMP($J,"TPBLET",DIVDA,PTNM,DFN)=""
"RTN","PSOTPCLP",93,0)
 G PRTLET
"RTN","PSOTPCLP",94,0)
SORTPAT ; sort by patient
"RTN","PSOTPCLP",95,0)
 K ^TMP($J,"TPBLET")
"RTN","PSOTPCLP",96,0)
 S PTNM="" F  S PTNM=$O(PATLST(PTNM)) Q:PTNM=""  D
"RTN","PSOTPCLP",97,0)
 . S DFN=0 F  S DFN=$O(PATLST(PTNM,DFN)) Q:DFN'>0  D
"RTN","PSOTPCLP",98,0)
 .. S DA0=^PS(52.91,DFN,0),EXPDTI=$P(DA0,"^",3),LTPDTI=$P(DA0,"^",12),DIVDA=$P(DA0,"^",8)
"RTN","PSOTPCLP",99,0)
 .. Q:EXPDTI
"RTN","PSOTPCLP",100,0)
 .. I PARAM("LP")="N",LTPDTI Q
"RTN","PSOTPCLP",101,0)
 .. I PARAM("LP")="P",'LTPDTI Q
"RTN","PSOTPCLP",102,0)
 .. S ^TMP($J,"TPBLET",DIVDA,PTNM,DFN)=""
"RTN","PSOTPCLP",103,0)
 G PRTLET
"RTN","PSOTPCLP",104,0)
 Q
"RTN","PSOTPCLP",105,0)
PRTLET ; pull DIVDAs and DFNs from ^TMP($J,"TPBLET",
"RTN","PSOTPCLP",106,0)
 D LOADTMP^PSOTPCLW ; load letter body into TMP
"RTN","PSOTPCLP",107,0)
 K DIVCNT
"RTN","PSOTPCLP",108,0)
 S DIVDA=0 F  S DIVDA=$O(^TMP($J,"TPBLET",DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLP",109,0)
 . S XX=$$CHKINST^PSOTPCL(DIVDA) I XX S DIVCNT(DIVDA)=0 Q
"RTN","PSOTPCLP",110,0)
 . D DIV ;GETDIV(DIVDA) ;load institution/parent data for print
"RTN","PSOTPCLP",111,0)
 . S PTNM="" F  S PTNM=$O(^TMP($J,"TPBLET",DIVDA,PTNM)) Q:PTNM=""  D
"RTN","PSOTPCLP",112,0)
 .. S DFN=0
"RTN","PSOTPCLP",113,0)
 .. F  S DFN=$O(^TMP($J,"TPBLET",DIVDA,PTNM,DFN)) Q:DFN'>0  D
"RTN","PSOTPCLP",114,0)
 ... S DIVCNT(DIVDA)=$G(DIVCNT(DIVDA))+1
"RTN","PSOTPCLP",115,0)
 ... D LETTER(DFN)
"RTN","PSOTPCLP",116,0)
 ... S $P(^PS(52.91,DFN,0),U,12)=DT ;set print date
"RTN","PSOTPCLP",117,0)
 ; summary of printing
"RTN","PSOTPCLP",118,0)
 S Y=DT D D^DIQ S SRDT=Y
"RTN","PSOTPCLP",119,0)
 W @IOF,!!,?10,"SUMMARY of TPB LETTER PRINTING   ",SRDT
"RTN","PSOTPCLP",120,0)
 W !!
"RTN","PSOTPCLP",121,0)
 I '$D(DIVCNT) W !!,"NO DATA TO PRINT",!! G EXIT
"RTN","PSOTPCLP",122,0)
 S DIVDA=0 F  S DIVDA=$O(DIVCNT(DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLP",123,0)
 . W !,?5,$$GET1^DIQ(52.92,DIVDA,.01),?40,DIVCNT(DIVDA)
"RTN","PSOTPCLP",124,0)
 W !
"RTN","PSOTPCLP",125,0)
 G EXIT
"RTN","PSOTPCLP",126,0)
 ;
"RTN","PSOTPCLP",127,0)
LETTER(DFN) ; print letter , division variables information must be present
"RTN","PSOTPCLP",128,0)
 U IO
"RTN","PSOTPCLP",129,0)
 D GETPAT(DFN)
"RTN","PSOTPCLP",130,0)
 I EXPDT,EXPDT'>DT Q  ; patient inactive on printing date
"RTN","PSOTPCLP",131,0)
 D HEADER
"RTN","PSOTPCLP",132,0)
 F LN=1:1 Q:'$D(^TMP($J,"TPCLW","P1",LN))  W !,^(LN)
"RTN","PSOTPCLP",133,0)
 W ?30,"PHARMACY SERVICE",!,?30,DIVNM
"RTN","PSOTPCLP",134,0)
 I $L(MADD1) D  I 1
"RTN","PSOTPCLP",135,0)
 . W !,?30,MADD1
"RTN","PSOTPCLP",136,0)
 . W:$L(MADD2) !,?30,MADD2
"RTN","PSOTPCLP",137,0)
 . W !,?30,MCITY,", ",MSTATE,"  ",MZIP
"RTN","PSOTPCLP",138,0)
 E  W !,?30,ADD1 D
"RTN","PSOTPCLP",139,0)
 . W:$L(ADD2) !,?30,ADD2
"RTN","PSOTPCLP",140,0)
 . W !,?30,CITY,", ",STATE,"  ",ZIP
"RTN","PSOTPCLP",141,0)
 F LN=1:1 Q:'$D(^TMP($J,"TPCLW","P2",LN))  W !,^(LN)
"RTN","PSOTPCLP",142,0)
 W " ",PHN1 W:$L(PHN2) ", or ",PHN2 W ".",!
"RTN","PSOTPCLP",143,0)
 F LN=1:1 Q:'$D(^TMP($J,"TPCLW","P3",LN))  W:LN>1 ! W ^(LN)
"RTN","PSOTPCLP",144,0)
 W !!!!,?4,SIG1 W:$L(SIG2) !,?4,SIG2 W:$L(SIG3) !,?4,SIG3
"RTN","PSOTPCLP",145,0)
 W !
"RTN","PSOTPCLP",146,0)
 Q
"RTN","PSOTPCLP",147,0)
GETPAT(DFN) ;GET PATIENT DATA
"RTN","PSOTPCLP",148,0)
 K PTNM,EXPDT,SRANAME,TITLE,SRNM,PTSTATE,VADM,VAPA
"RTN","PSOTPCLP",149,0)
 S PTNM=$$GET1^DIQ(52.91,DFN,.01),EXPDT=$$GET1^DIQ(52.91,DFN,2,"I")
"RTN","PSOTPCLP",150,0)
 ;I EXPDT,DT'>EXPDT Q
"RTN","PSOTPCLP",151,0)
 D DEM^VADPT,ADD^VADPT
"RTN","PSOTPCLP",152,0)
 S PTLNM=$P(PTNM,","),PTXNM=$P(PTNM,",")
"RTN","PSOTPCLP",153,0)
 S SRANAME=$P(VADM(1),"^"),X=$P(SRANAME,","),Y=$E(X)_$TR($E(X,2,$L(X)),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","PSOTPCLP",154,0)
 S TITLE=$S($P(VADM(5),"^")="F":"Ms. ",1:"Mr. "),SRANAME=TITLE_Y
"RTN","PSOTPCLP",155,0)
 S Y=DT D D^DIQ S SRDT=Y
"RTN","PSOTPCLP",156,0)
 S SEX=$P(VADM(5),"^")
"RTN","PSOTPCLP",157,0)
 S SRNM=$P(VADM(1),",",2)_" "_$P(VADM(1),",")
"RTN","PSOTPCLP",158,0)
 S PADD1=$G(VAPA(1)),PADD2=$G(VAPA(2)),PADD3=$G(VAPA(3))
"RTN","PSOTPCLP",159,0)
 S PCITY=$G(VAPA(4)),PTSTATE=$P($G(VAPA(5)),U,2),PZIP=$G(VAPA(6))
"RTN","PSOTPCLP",160,0)
CCADD ; Get Confidential Correspondence Address if one is active
"RTN","PSOTPCLP",161,0)
 ; and has the category "all other".
"RTN","PSOTPCLP",162,0)
 ;
"RTN","PSOTPCLP",163,0)
 ; See if CC address exists
"RTN","PSOTPCLP",164,0)
 I '$G(VAPA(12)) Q
"RTN","PSOTPCLP",165,0)
 ; code to check the CC category in the variable array VAPA(22)
"RTN","PSOTPCLP",166,0)
 ; check catagories
"RTN","PSOTPCLP",167,0)
 S XX=0 F CC=1,2,5 I $P($G(VAPA(22,CC)),U,3)="Y" S XX=1
"RTN","PSOTPCLP",168,0)
 Q:'XX
"RTN","PSOTPCLP",169,0)
 S SRCCADD=1
"RTN","PSOTPCLP",170,0)
 S:$G(VAPA(17)) PTSTATE=$P(^DIC(5,$P(VAPA(17),"^"),0),"^",2)
"RTN","PSOTPCLP",171,0)
 S PADD1=$G(VAPA(13)),PADD2=$G(VAPA(14)),PADD3=$G(VAPA(15))
"RTN","PSOTPCLP",172,0)
 S PCITY=$G(VAPA(16)),PTSTAT=$P(VAPA(17),U,2),PZIP=$P(VAPA(18),U,2)
"RTN","PSOTPCLP",173,0)
 Q
"RTN","PSOTPCLP",174,0)
HEADER ; print letter header
"RTN","PSOTPCLP",175,0)
 U IO
"RTN","PSOTPCLP",176,0)
 W @IOF
"RTN","PSOTPCLP",177,0)
 W !!,?(80-$L(DIVNM))\2,DIVNM
"RTN","PSOTPCLP",178,0)
 W !,?(80-$L(ADD1))\2,ADD1
"RTN","PSOTPCLP",179,0)
 W:$L(ADD2) !,?(80-$L(ADD2))\2,ADD2
"RTN","PSOTPCLP",180,0)
 S XX=CITY_", "_STATE_" "_ZIP
"RTN","PSOTPCLP",181,0)
 W !,?(80-$L(XX))\2,XX
"RTN","PSOTPCLP",182,0)
 F Y=$Y:1:10 W !
"RTN","PSOTPCLP",183,0)
 W !,?4,SRNM,?65,SRDT,!,?4,PADD1 I PADD2'="" W !,?4,PADD2 I PADD3'="" W !,?4,VAPA(3)
"RTN","PSOTPCLP",184,0)
 W:PCITY'="" !,?4,PCITY_", "_PTSTATE_" "_PZIP W !!!
"RTN","PSOTPCLP",185,0)
 Q
"RTN","PSOTPCLP",186,0)
DIV D GETDIV(DIVDA)
"RTN","PSOTPCLP",187,0)
 I $L(PARDIV) S DIVDA2=$$GET1^DIQ(52.92,DIVDA,.02,"I") D GETDIV(DIVDA2)
"RTN","PSOTPCLP",188,0)
 Q
"RTN","PSOTPCLP",189,0)
GETDIV(DIVDA) ; GET DIVISIONAL DATA
"RTN","PSOTPCLP",190,0)
 K DIVNM,PARDIV,PHN1,PHN2,ADD1,ADD2,CITY,ZIP,STATE,MADD1,MADD2,MCITY,MZIP,SIG1,SIG2,SIG3
"RTN","PSOTPCLP",191,0)
 ;
"RTN","PSOTPCLP",192,0)
 F FLDX="DIVNM^.01","PARDIV^.02","PHN1^.03","PHN2^.04","ADD1^.05","ADD2^.06","CITY^.07","ZIP^.08","STATE^.09" D GET1(52.92,DIVDA,FLDX)
"RTN","PSOTPCLP",193,0)
 ;
"RTN","PSOTPCLP",194,0)
 F FLDX="MADD1^1.01","MADD2^1.02","MCITY^1.03","MSTATE^1.04","MZIP^1.05","SIG1^2.01","SIG2^2.02","SIG3^2.03" D GET1(52.92,DIVDA,FLDX)
"RTN","PSOTPCLP",195,0)
 ;
"RTN","PSOTPCLP",196,0)
 Q
"RTN","PSOTPCLP",197,0)
GET1(FILE,FLIEN,FLDX) ; "Variable^FLD" load variable = FILE,FLD
"RTN","PSOTPCLP",198,0)
 N VAR S VAR=$P(FLDX,"^"),FLD=$P(FLDX,"^",2),@VAR=$$GET1^DIQ(FILE,FLIEN,FLD)
"RTN","PSOTPCLP",199,0)
 Q
"RTN","PSOTPCLP",200,0)
EXIT ;
"RTN","PSOTPCLP",201,0)
 D ^%ZISC
"RTN","PSOTPCLP",202,0)
 I $G(ZTSK) D KILL^%ZTLOAD
"RTN","PSOTPCLP",203,0)
 K ADD1,ADD2,CHK,CITY,DIV,DIVCNT,DIVDA,DIVDA2,DIVNM,DIVX
"RTN","PSOTPCLP",204,0)
 K EXPDT,EXPDTI,FAC,FDA,FLD,FLDX,FILE,FLD,FLDX,FLIEN
"RTN","PSOTPCLP",205,0)
 K I,INST,LN,LOCDA,LTPDTI,MADD1,MADD2,MCITY,MZIP,PAR,PARAM
"RTN","PSOTPCLP",206,0)
 K PARDIV,PATLST,PATNM,PHN1,PHN2,POP,PRTDT,PSOSTOP,PTLNM,PTNM
"RTN","PSOTPCLP",207,0)
 K PTSTATE,PTXNM,SEX,SIG1,SIG2,SIG3,SRNAME,SRDT,STATE,TITLE
"RTN","PSOTPCLP",208,0)
 K VADM,VAPA,VAR,XFLD,XX,YFLD,YY,ZIP,ZTDESC
"RTN","PSOTPCLP",209,0)
 K ^TMP($J,"TPBLET"),^TMP($J,"TPCLW")
"RTN","PSOTPCLP",210,0)
 Q
"RTN","PSOTPCLP",211,0)
LOAD K PATLST S DFN=0 F  S DFN=$O(^PS(52.91,DFN)) Q:DFN'>0  S PATLST($$GET1^DIQ(52.91,DFN,.01))=DFN
"RTN","PSOTPCLP",212,0)
 Q
"RTN","PSOTPCLR")
0^9^B10542060
"RTN","PSOTPCLR",1,0)
PSOTPCLR ;BIRM/PDW-LETTER PRINT REPORTS ;AUG 8, 2003
"RTN","PSOTPCLR",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145**
"RTN","PSOTPCLR",3,0)
 Q
"RTN","PSOTPCLR",4,0)
EN K DIR S DIR(0)="SO^N:Patients/Letters NOT Printed;P:Patients/Letters Printed" D ^DIR
"RTN","PSOTPCLR",5,0)
 I Y="N" S PARAM=Y G DEVICE
"RTN","PSOTPCLR",6,0)
 I Y="P" S PARAM=Y G DEVICE
"RTN","PSOTPCLR",7,0)
 Q
"RTN","PSOTPCLR",8,0)
DEVICE ;
"RTN","PSOTPCLR",9,0)
 W !,"Queuing is recommended",!
"RTN","PSOTPCLR",10,0)
 K %ZIS S %ZIS="Q" D ^%ZIS
"RTN","PSOTPCLR",11,0)
 Q:POP
"RTN","PSOTPCLR",12,0)
 I $D(IO("Q")) D  K ZTSK G EXIT2
"RTN","PSOTPCLR",13,0)
 . S ZTRTN="DEQUE^PSOTPCLR",ZTDESC="TPB PRINT LETTER REPORT"
"RTN","PSOTPCLR",14,0)
 . S ZTSAVE("PARAM")=""
"RTN","PSOTPCLR",15,0)
 . D ^%ZTLOAD D ^%ZISC
"RTN","PSOTPCLR",16,0)
 . I $G(ZTSK) W !!,"Tasked with "_ZTSK
"RTN","PSOTPCLR",17,0)
 ;
"RTN","PSOTPCLR",18,0)
DEQUE ; DEQUE/PRINT LETTERS
"RTN","PSOTPCLR",19,0)
 K ^TMP($J,"PSOTPBLR"),DIVCNT
"RTN","PSOTPCLR",20,0)
 S DIVDA=0 F  S DIVDA=$O(^PS(52.91,"AC",DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLR",21,0)
 . S DFN=0 F  S DFN=$O(^PS(52.91,"AC",DIVDA,DFN)) Q:DFN'>0  D
"RTN","PSOTPCLR",22,0)
 .. S PRTDTI=$$GET1^DIQ(52.91,DFN,11,"I") I PARAM="P",'PRTDTI Q
"RTN","PSOTPCLR",23,0)
 .. S PRTDTI=$$GET1^DIQ(52.91,DFN,11,"I") I PARAM="N",PRTDTI Q
"RTN","PSOTPCLR",24,0)
 .. S PTNM=$$GET1^DIQ(52.91,DFN,.01),PRTDT=$$FMTE^XLFDT(PRTDTI,"2D")
"RTN","PSOTPCLR",25,0)
 .. S ^TMP($J,"PSOTPBLR",DIVDA,PTNM,DFN)=PRTDT
"RTN","PSOTPCLR",26,0)
 .. S DIVCNT(DIVDA)=$G(DIVCNT(DIVDA))+1
"RTN","PSOTPCLR",27,0)
PRINT ; print report
"RTN","PSOTPCLR",28,0)
 U IO K DIVCNT,PSOSTOP
"RTN","PSOTPCLR",29,0)
 S PG=0,LINE="",$P(LINE,"=",79)=""
"RTN","PSOTPCLR",30,0)
 S DIVDA=0  F  Q:$G(PSOSTOP)  S DIVDA=$O(^TMP($J,"PSOTPBLR",DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLR",31,0)
 . D HEADER
"RTN","PSOTPCLR",32,0)
 . S PTNM="" F  Q:$G(PSOSTOP)  S PTNM=$O(^TMP($J,"PSOTPBLR",DIVDA,PTNM)) Q:PTNM=""  D
"RTN","PSOTPCLR",33,0)
 .. S DFN=0 F  Q:$G(PSOSTOP)  S DFN=$O(^TMP($J,"PSOTPBLR",DIVDA,PTNM,DFN)) Q:DFN'>0  D
"RTN","PSOTPCLR",34,0)
 ... S DIVCNT(DIVDA)=$G(DIVCNT(DIVDA))+1
"RTN","PSOTPCLR",35,0)
 ... D PG
"RTN","PSOTPCLR",36,0)
 ... W !,$$GET1^DIQ(52.91,DFN,.01)
"RTN","PSOTPCLR",37,0)
 ... I PARAM="P" W ?35,^TMP($J,"PSOTPBLR",DIVDA,PTNM,DFN) Q
"RTN","PSOTPCLR",38,0)
 ... S INACTDT=$$GET1^DIQ(52.91,DFN,2,"I"),EXCODE=$$GET1^DIQ(52.91,DFN,3),EXREA=$$GET1^DIQ(52.91,DFN,8)
"RTN","PSOTPCLR",39,0)
 ... W:INACTDT ?35,$$FMTE^XLFDT(INACTDT,"2D") W:$L(EXCODE) ?45,EXCODE
"RTN","PSOTPCLR",40,0)
 ... W:$L(EXREA) !,?10,"Exclusion Reason: ",EXREA
"RTN","PSOTPCLR",41,0)
SUMMARY ;
"RTN","PSOTPCLR",42,0)
 W:'$D(DIVCNT) !!,"No Data Found"
"RTN","PSOTPCLR",43,0)
 Q:$G(PSOSTOP)
"RTN","PSOTPCLR",44,0)
 I PG,$E(IOST)="C" K DIR S DIR(0)="E"  D ^DIR I 'Y S PSOSTOP=1 Q
"RTN","PSOTPCLR",45,0)
 W !,@IOF,!!,?10,"SUMMARY of TPB LETTER PRINTING   "
"RTN","PSOTPCLR",46,0)
 I PARAM="P" W "'PRINTED'" I 1
"RTN","PSOTPCLR",47,0)
 E  W "'NOT PRINTED'"
"RTN","PSOTPCLR",48,0)
 W !!
"RTN","PSOTPCLR",49,0)
 S DIVDA=0 F  S DIVDA=$O(DIVCNT(DIVDA)) Q:DIVDA'>0  D
"RTN","PSOTPCLR",50,0)
 . W !,?5,$$GET1^DIQ(52.92,DIVDA,.01),?40,DIVCNT(DIVDA)
"RTN","PSOTPCLR",51,0)
 W:'$D(DIVCNT) !!,"No Data Found"
"RTN","PSOTPCLR",52,0)
 W !
"RTN","PSOTPCLR",53,0)
 G EXIT
"RTN","PSOTPCLR",54,0)
 ;
"RTN","PSOTPCLR",55,0)
PG I $Y>(IOSL-4) D HEADER
"RTN","PSOTPCLR",56,0)
 Q
"RTN","PSOTPCLR",57,0)
HEADER ;
"RTN","PSOTPCLR",58,0)
 W !
"RTN","PSOTPCLR",59,0)
 I PG,$E(IOST)="C" K DIR S DIR(0)="E"  D ^DIR I 'Y S PSOSTOP=1 Q
"RTN","PSOTPCLR",60,0)
 W @IOF
"RTN","PSOTPCLR",61,0)
 S PG=PG+1
"RTN","PSOTPCLR",62,0)
 W ?20,$$GET1^DIQ(52.92,DIVDA,.01)
"RTN","PSOTPCLR",63,0)
 I PARAM="P" W " TPB PATIENTS LETTERS PRINTED REPORT",! I 1
"RTN","PSOTPCLR",64,0)
 E  W " TPB PATIENTS LETTERS NOT PRINTED REPORT",!
"RTN","PSOTPCLR",65,0)
 W ?28,$$FMTE^XLFDT(DT,"1D"),?60,"Page: ",PG,!,LINE
"RTN","PSOTPCLR",66,0)
 I PARAM="N" W !,?35,"Inactivation",!,"Patient",?35,"Date",?45,"Reason",!
"RTN","PSOTPCLR",67,0)
 Q
"RTN","PSOTPCLR",68,0)
EXIT ;
"RTN","PSOTPCLR",69,0)
 I $E(IOST)="C" W !!,"End of Report",! K DIR S DIR(0)="EO",DIR("A")="<cr> - Continue" D ^DIR
"RTN","PSOTPCLR",70,0)
 K ^TMP($J,"PSOTPBLR") I $G(ZTSK) D KILL^%ZTLOAD
"RTN","PSOTPCLR",71,0)
EXIT2 D ^%ZISC
"RTN","PSOTPCLR",72,0)
 K DIR,DIVCNT,DIVDA,LINE,PARAM,PG,PRTDT,PRTDTI,PTNM,SRDT
"RTN","PSOTPCLR",73,0)
 Q
"RTN","PSOTPCLW")
0^7^B54624141
"RTN","PSOTPCLW",1,0)
PSOTPCLW ;BIRM/PDW-ROUTINE FOR STORE & PRINT LETTERS
"RTN","PSOTPCLW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145**;DEC 1997
"RTN","PSOTPCLW",3,0)
 Q
"RTN","PSOTPCLW",4,0)
LOADTMP ;Load letter text into ^TMP($J,"TPCLW","Px")
"RTN","PSOTPCLW",5,0)
 ;This builds the patient letter for TIME NEW ROMAN 12 POINT (NOT 12 PITCH)
"RTN","PSOTPCLW",6,0)
 K ^TMP($J,"TPCLW"),INDENT
"RTN","PSOTPCLW",7,0)
 S $P(INDENT," ",5)=""
"RTN","PSOTPCLW",8,0)
 F LN=1:1 S XX=$T(MMLETTER+LN) Q:XX["*****"  S XX=$P(XX,";;",2),^TMP($J,"TPCLW","P1",LN)=INDENT_XX
"RTN","PSOTPCLW",9,0)
 S LN1=LN
"RTN","PSOTPCLW",10,0)
 F LN=1:1 S YY=LN1+LN,XX=$T(MMLETTER+YY) Q:XX["*****"  S XX=$P(XX,";;",2),^TMP($J,"TPCLW","P2",LN)=INDENT_XX
"RTN","PSOTPCLW",11,0)
 S LN1=LN+LN1
"RTN","PSOTPCLW",12,0)
 F LN=1:1 S YY=LN1+LN,XX=$T(MMLETTER+YY) Q:XX["*****"  S XX=$P(XX,";;",2),^TMP($J,"TPCLW","P3",LN)=INDENT_XX
"RTN","PSOTPCLW",13,0)
 S LN1=LN+LN1
"RTN","PSOTPCLW",14,0)
 Q
"RTN","PSOTPCLW",15,0)
TMP ; show TMP contents
"RTN","PSOTPCLW",16,0)
 S X=132 X ^%ZOSF("RM")
"RTN","PSOTPCLW",17,0)
 F XX="P1","P2","P3" W !!,XX,! S LN=0 F  S LN=$O(^TMP($J,"TPCLW",XX,LN)) Q:LN'>0  S X=^(LN) W !,X
"RTN","PSOTPCLW",18,0)
 S X=80 X ^%ZOSF("RM")
"RTN","PSOTPCLW",19,0)
 Q
"RTN","PSOTPCLW",20,0)
SETUP ;pull text lines from mailman message and store into routine
"RTN","PSOTPCLW",21,0)
SETUPB D SELBSK Q:Y'>0
"RTN","PSOTPCLW",22,0)
 D SELMSG G:Y'>0 SETUPB
"RTN","PSOTPCLW",23,0)
 D MMLOAD
"RTN","PSOTPCLW",24,0)
 Q
"RTN","PSOTPCLW",25,0)
SELBSK ;SELECT BASKET,DA
"RTN","PSOTPCLW",26,0)
 K DIC,DA S BSKDA=0
"RTN","PSOTPCLW",27,0)
 S DA(1)=DUZ,DIC="^XMB(3.7,DA(1),2,",DIC(0)="AEQM"
"RTN","PSOTPCLW",28,0)
 D ^DIC
"RTN","PSOTPCLW",29,0)
 S:+Y>0 BSKDA=+Y
"RTN","PSOTPCLW",30,0)
 Q
"RTN","PSOTPCLW",31,0)
SELMSG ;SELECT MESSAGE
"RTN","PSOTPCLW",32,0)
 K DIC,DA S MSGDA=0,IENS=BSKDA_","_DUZ
"RTN","PSOTPCLW",33,0)
 W !!,"Basket: ",$$GET1^DIQ(3.701,IENS,.01)
"RTN","PSOTPCLW",34,0)
 S DA(2)=DUZ,DA(1)=BSKDA,DIC="^XMB(3.7,DUZ,2,BSKDA,1,",DIC(0)="AEQM"
"RTN","PSOTPCLW",35,0)
 S DIC("W")="W $$GET1^DIQ(3.9,+Y,.01)"
"RTN","PSOTPCLW",36,0)
 D ^DIC K DIC,DR,DA
"RTN","PSOTPCLW",37,0)
 S:+Y>0 MSGDA=+Y
"RTN","PSOTPCLW",38,0)
 Q
"RTN","PSOTPCLW",39,0)
MMLOAD ; Load text into routine from a mail message.
"RTN","PSOTPCLW",40,0)
 S MMDA=$G(MSGDA) Q:+MMDA'>0
"RTN","PSOTPCLW",41,0)
 S X1="S XX=""MMLETTER ;;"" ZI XX"
"RTN","PSOTPCLW",42,0)
 S X2="S LN=0 F  S LN=$O(^XMB(3.9,MMDA,2,LN)) Q:LN'>0  S XX="" ;;""_^XMB(3.9,MMDA,2,LN,0) ZI XX"
"RTN","PSOTPCLW",43,0)
 X X1,X2,"ZS"
"RTN","PSOTPCLW",44,0)
 Q
"RTN","PSOTPCLW",45,0)
MMLETTER ;;
"RTN","PSOTPCLW",46,0)
 ;;Dear Veteran:
"RTN","PSOTPCLW",47,0)
 ;; 
"RTN","PSOTPCLW",48,0)
 ;;I am pleased to tell you that you may be eligible for a new, temporary 
"RTN","PSOTPCLW",49,0)
 ;;prescription benefit, called the VA Transitional Pharmacy Benefit.  The 
"RTN","PSOTPCLW",50,0)
 ;;goal is to reduce the costs of your medication while you are waiting to 
"RTN","PSOTPCLW",51,0)
 ;;see a VA primary care doctor.
"RTN","PSOTPCLW",52,0)
 ;; 
"RTN","PSOTPCLW",53,0)
 ;;1.  AM I ELIGIBLE FOR THIS NEW BENEFIT?
"RTN","PSOTPCLW",54,0)
 ;; 
"RTN","PSOTPCLW",55,0)
 ;;You are eligible for this benefit if you meet all of the following 
"RTN","PSOTPCLW",56,0)
 ;;requirements.
"RTN","PSOTPCLW",57,0)
 ;; 
"RTN","PSOTPCLW",58,0)
 ;;        a.  You are enrolled in the VA health care system prior to July 
"RTN","PSOTPCLW",59,0)
 ;;25, 2003; and
"RTN","PSOTPCLW",60,0)
 ;;        b.  You have requested your first primary care appointment with 
"RTN","PSOTPCLW",61,0)
 ;;VA prior to July 25, 2003; and
"RTN","PSOTPCLW",62,0)
 ;;        c.  You have been waiting more than 30 days for the initial 
"RTN","PSOTPCLW",63,0)
 ;;primary care appointment as of September 22, 2003.
"RTN","PSOTPCLW",64,0)
 ;; 
"RTN","PSOTPCLW",65,0)
 ;;2.  WHAT IS THE NEW BENEFIT?
"RTN","PSOTPCLW",66,0)
 ;; 
"RTN","PSOTPCLW",67,0)
 ;;        The new benefit allows VA to fill your prescriptions written by a 
"RTN","PSOTPCLW",68,0)
 ;;non-VA doctor, until you have your first primary care appointment with 
"RTN","PSOTPCLW",69,0)
 ;;VA.  VA will only provide your medications by mail.  VA may also bill 
"RTN","PSOTPCLW",70,0)
 ;;your health insurance, and you may have to pay a co-payment based on your 
"RTN","PSOTPCLW",71,0)
 ;;eligibility and financial status.
"RTN","PSOTPCLW",72,0)
 ;; 
"RTN","PSOTPCLW",73,0)
 ;;        The medications provided by this benefit include many of the drugs 
"RTN","PSOTPCLW",74,0)
 ;;listed on the VA National Formulary List.  We have enclosed a shortened 
"RTN","PSOTPCLW",75,0)
 ;;version of that list for your doctor's use.  Under this program, VA will 
"RTN","PSOTPCLW",76,0)
 ;;not provide controlled substances (such as narcotics), intravenous
"RTN","PSOTPCLW",77,0)
 ;;medications, over-the-counter medications (except insulin and 
"RTN","PSOTPCLW",78,0)
 ;;syringes), medical supplies, and one-time medications for acute illnesses 
"RTN","PSOTPCLW",79,0)
 ;;(such as antibiotics).  Additionally, VA will not provide medications 
"RTN","PSOTPCLW",80,0)
 ;;required to be administered only by a medical professional.
"RTN","PSOTPCLW",81,0)
 ;; 
"RTN","PSOTPCLW",82,0)
 ;;3.  HOW DO I START?
"RTN","PSOTPCLW",83,0)
 ;; 
"RTN","PSOTPCLW",84,0)
 ;;        To obtain your medications, please do the following:
"RTN","PSOTPCLW",85,0)
 ;; 
"RTN","PSOTPCLW",86,0)
 ;;        a.  Fill out the top portion of the attached VA Form 10-0411, 
"RTN","PSOTPCLW",87,0)
 ;;VA Transitional Pharmacy Benefit (the Patient Information part).
"RTN","PSOTPCLW",88,0)
 ;;        b.  Take the attached letter ("Dear Doctor"), the enclosed 
"RTN","PSOTPCLW",89,0)
 ;;Transitional Pharmacy Benefit Drug Formulary Summary brochure, and VA 
"RTN","PSOTPCLW",90,0)
 ;;Form 10-0411, VA Transitional Pharmacy Benefit, to your private doctor. 
"RTN","PSOTPCLW",91,0)
 ;;        c.  Ask your doctor to:
"RTN","PSOTPCLW",92,0)
 ;; 
"RTN","PSOTPCLW",93,0)
 ;;        (1)  Complete the Doctor Information section of VA Form 10-0411.
"RTN","PSOTPCLW",94,0)
 ;;        (2)  Attach a prescription for each medication and include your 
"RTN","PSOTPCLW",95,0)
 ;;name and social security number; and
"RTN","PSOTPCLW",96,0)
 ;;        (3)  Mail these documents to the following address using the
"RTN","PSOTPCLW",97,0)
 ;;enclosed envelope.
"RTN","PSOTPCLW",98,0)
 ;; 
"RTN","PSOTPCLW",99,0)
 ;;*****
"RTN","PSOTPCLW",100,0)
 ;; 
"RTN","PSOTPCLW",101,0)
 ;;4.  HOW WILL I GET MY MEDICATIONS?
"RTN","PSOTPCLW",102,0)
 ;; 
"RTN","PSOTPCLW",103,0)
 ;;        Prescriptions from your non-VA doctor must be mailed in the 
"RTN","PSOTPCLW",104,0)
 ;;enclosed envelope to the address shown above.  Our goal is to mail your 
"RTN","PSOTPCLW",105,0)
 ;;medications to you within 7 to 10 days after receiving your 
"RTN","PSOTPCLW",106,0)
 ;;prescription.  If you have questions or concerns about your mailed 
"RTN","PSOTPCLW",107,0)
 ;;medications, you may contact 
"RTN","PSOTPCLW",108,0)
 ;;***** 
"RTN","PSOTPCLW",109,0)
 ;;VA will provide sufficient medication to meet your needs until your first 
"RTN","PSOTPCLW",110,0)
 ;;primary care appointment.  Please make sure your doctor mails the 
"RTN","PSOTPCLW",111,0)
 ;;enclosed form and prescriptions.  VA is not able to process these 
"RTN","PSOTPCLW",112,0)
 ;;prescriptions by fax, phone, or email.  If your doctor does not provide 
"RTN","PSOTPCLW",113,0)
 ;;all the requested information, VA cannot send your medication.
"RTN","PSOTPCLW",114,0)
 ;; 
"RTN","PSOTPCLW",115,0)
 ;;5.  WHERE CAN I GET MORE INFORMATION?
"RTN","PSOTPCLW",116,0)
 ;; 
"RTN","PSOTPCLW",117,0)
 ;;        More information about this benefit can be found on the VA's 
"RTN","PSOTPCLW",118,0)
 ;;Internet Web site, at http://www.va.gov/elig/tpb.htm.  If you still have
"RTN","PSOTPCLW",119,0)
 ;;questions, please call 1-877-222-8387.
"RTN","PSOTPCLW",120,0)
 ;; 
"RTN","PSOTPCLW",121,0)
 ;;6.  PLEASE KEEP YOUR FIRST PRIMARY CARE APPOINTMENT!
"RTN","PSOTPCLW",122,0)
 ;; 
"RTN","PSOTPCLW",123,0)
 ;;        Once VA has scheduled your first primary care appointment, please 
"RTN","PSOTPCLW",124,0)
 ;;remember that it is very important to keep that appointment.  If you must 
"RTN","PSOTPCLW",125,0)
 ;;cancel your appointment, please advise the appointment clerk that you are 
"RTN","PSOTPCLW",126,0)
 ;;a VA Transitional Pharmacy Benefits patient and explain why you are 
"RTN","PSOTPCLW",127,0)
 ;;canceling.  VA understands that there are occasions when you must cancel 
"RTN","PSOTPCLW",128,0)
 ;;your appointment.  However, if you cancel your appointment simply for 
"RTN","PSOTPCLW",129,0)
 ;;your own convenience, or if you fail to show up for your scheduled 
"RTN","PSOTPCLW",130,0)
 ;;appointment without an acceptable reason, you may no longer be eligible 
"RTN","PSOTPCLW",131,0)
 ;;for this benefit.
"RTN","PSOTPCLW",132,0)
 ;; 
"RTN","PSOTPCLW",133,0)
 ;;        During your first primary care appointment, your VA doctor will 
"RTN","PSOTPCLW",134,0)
 ;;review all treatments, including all your medications, and make changes 
"RTN","PSOTPCLW",135,0)
 ;;as appropriate and give you refills.
"RTN","PSOTPCLW",136,0)
 ;; 
"RTN","PSOTPCLW",137,0)
 ;;        VA is committed to serving you by providing this benefit to 
"RTN","PSOTPCLW",138,0)
 ;;reduce your medication costs while you wait for your first primary care 
"RTN","PSOTPCLW",139,0)
 ;;appointment.  Thank you for your patience.  We hope to see you soon.
"RTN","PSOTPCLW",140,0)
 ;;***** 
"RTN","PSOTPCRP")
0^2^B52118182
"RTN","PSOTPCRP",1,0)
PSOTPCRP ;BIR/RTR-Non VA phycisian eligible patient report ;07/07/03
"RTN","PSOTPCRP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145**;DEC 1997
"RTN","PSOTPCRP",3,0)
EN ;
"RTN","PSOTPCRP",4,0)
 W !!,"This report prints entries from the TPB ELIGIBILITY file (#52.91)."
"RTN","PSOTPCRP",5,0)
 W !,"If multiple Institutions are selected, and some Institutions have data and",!,"some don't, only those Institutions that have data will print on the report.",!
"RTN","PSOTPCRP",6,0)
 N PSOGPINS,PSOGPAR,PSOGOK,PSOGSORT
"RTN","PSOTPCRP",7,0)
 S PSOGPINS=0
"RTN","PSOTPCRP",8,0)
INST ;Ask for Institutions
"RTN","PSOTPCRP",9,0)
 K DIR S DIR(0)="S^S:SELECT;A:ALL",DIR("B")="SELECT",DIR("A")="Print Report for Selected Institutions, or All Institutions" D  D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) W !!,"Nothing queued to print.",! Q
"RTN","PSOTPCRP",10,0)
 .S DIR("?")=" ",DIR("?",1)="Enter 'S' to select one or more Institutions to print the report for,",DIR("?",2)="Enter 'A' to print the report for all Institutions."
"RTN","PSOTPCRP",11,0)
 I Y="A" S PSOGPINS=1 G PASS
"RTN","PSOTPCRP",12,0)
 S PSOGOK=0
"RTN","PSOTPCRP",13,0)
INSTX ;Ask for individual Institutions
"RTN","PSOTPCRP",14,0)
 K DIC S DIC(0)="QEAMZ",DIC=4 D  W ! D ^DIC K DIC I 'PSOGOK,(Y<1!($D(DUOUT))!($D(DTOUT))) W !!,"Nothing queued to print.",! Q
"RTN","PSOTPCRP",15,0)
 .I 'PSOGOK,$G(DUZ(2)) S DIC("B")=DUZ(2)
"RTN","PSOTPCRP",16,0)
 .I PSOGOK S DIC("A")="Select another INSTITUTION NAME:"
"RTN","PSOTPCRP",17,0)
 I Y>0 S PSOGPAR(+Y)="",PSOGOK=1 G INSTX
"RTN","PSOTPCRP",18,0)
 I '$O(PSOGPAR(0)) W !,"No Institutions selected, nothing queued to print.",! Q
"RTN","PSOTPCRP",19,0)
PASS ;
"RTN","PSOTPCRP",20,0)
ACT ;Ask for type of report
"RTN","PSOTPCRP",21,0)
 W ! K DIR S DIR(0)="S^A:ALL PATIENTS;E:ELIGIBLE PATIENTS;I:INELIGIBLE PATIENTS",DIR("B")="ALL PATIENTS",DIR("A")="Select patients for report" D  D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) W !!,"Nothing queued to print.",! Q
"RTN","PSOTPCRP",22,0)
 .S DIR("?")=" ",DIR("?",1)="To see only those patients currently eligible for the Transitional Pharmacy",DIR("?",2)="Benefit program, enter 'E'. To see all patients currently in the TPB"
"RTN","PSOTPCRP",23,0)
 .S DIR("?",3)="ELIGIBILITY file (#52.91), but not currently eligible for the benefit,",DIR("?",4)="enter 'I'. To see all patients in the TPB ELIGIBILITY file (#52.91),"
"RTN","PSOTPCRP",24,0)
 .S DIR("?",5)="both eligible and ineligible, enter 'A'."
"RTN","PSOTPCRP",25,0)
 S PSOGSORT=Y
"RTN","PSOTPCRP",26,0)
 W ! K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I $G(POP) W !!,"Nothing queued to print.",! Q
"RTN","PSOTPCRP",27,0)
 I $D(IO("Q")) S ZTRTN="START^PSOTPCRP",ZTDESC="TPB ELIGIBILITY Report",ZTSAVE("PSOGPINS")="",ZTSAVE("PSOGSORT")="",ZTSAVE("PSOGPAR(")="" D ^%ZTLOAD K %ZIS W !,"Report queued to print.",! K ZTRTN,ZTDESC,ZTSAVE Q
"RTN","PSOTPCRP",28,0)
START ;
"RTN","PSOTPCRP",29,0)
 K ^TMP("PSOGP",$J)
"RTN","PSOTPCRP",30,0)
 U IO
"RTN","PSOTPCRP",31,0)
 N DIC,DIQ,DA,DR,PSOGPOUT,PSOGDV,PSOGPAGE,PSOGTOP,PSOGPLIN,PSOGLOP,PSOGNODE,PSOGNAME,PSOINAME,PSOTAR,PSOG1,PSOG2,PSOG3,PSOG4,DFN,VADM,PSOGSSN,PSOGSSNX,PSOXND,PSOXRS,VA,VAERR,PSOTINS,PSOTARX,PSOVADIS,PSOVADIX
"RTN","PSOTPCRP",32,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOTPCRP",33,0)
 S PSOGPOUT=0,PSOGDV=$S($E(IOST,1,2)'="C-":0,1:1),PSOGPAGE=1
"RTN","PSOTPCRP",34,0)
 S $P(PSOGPLIN,"-",79)=""
"RTN","PSOTPCRP",35,0)
 ;Set TMP global, store grand total count in PSOGTOP, Subtotals in PSOTAR array
"RTN","PSOTPCRP",36,0)
 S PSOGTOP=0
"RTN","PSOTPCRP",37,0)
 F PSOGLOP=0:0 S PSOGLOP=$O(^PS(52.91,PSOGLOP)) Q:'PSOGLOP  D
"RTN","PSOTPCRP",38,0)
 .S PSOGNODE=$G(^PS(52.91,PSOGLOP,0)) I 'PSOGNODE Q
"RTN","PSOTPCRP",39,0)
 .;If selecting institutions, and patient if file with no Institution won't show on the report??
"RTN","PSOTPCRP",40,0)
 .I 'PSOGPINS,'$D(PSOGPAR(+$P(PSOGNODE,"^",8))),$P(PSOGNODE,"^",8) Q
"RTN","PSOTPCRP",41,0)
 .I PSOGSORT="E",$P(PSOGNODE,"^",3),$P(PSOGNODE,"^",3)'>DT Q
"RTN","PSOTPCRP",42,0)
 .I PSOGSORT="I" I '$P(PSOGNODE,"^",3)!($P(PSOGNODE,"^",3)>DT) Q
"RTN","PSOTPCRP",43,0)
 .K VADM S DFN=+$P(PSOGNODE,"^") I 'DFN Q
"RTN","PSOTPCRP",44,0)
 .D DEM^VADPT I $G(VADM(1))="" K VADM Q
"RTN","PSOTPCRP",45,0)
 .S PSOGNAME=$G(VADM(1))
"RTN","PSOTPCRP",46,0)
 .K VADM
"RTN","PSOTPCRP",47,0)
 .K VA,VAERR S DFN=+$P(PSOGNODE,"^") D PID^VADPT6
"RTN","PSOTPCRP",48,0)
 .S PSOGNAME=PSOGNAME_"("_$G(VA("BID"))_")"
"RTN","PSOTPCRP",49,0)
 .K VA,VAERR
"RTN","PSOTPCRP",50,0)
 .S ^TMP("PSOGP",$J,$S($P(PSOGNODE,"^",8):$P(PSOGNODE,"^",8),1:"NONE"),PSOGNAME,$P(PSOGNODE,"^"),PSOGLOP)="",PSOGTOP=PSOGTOP+1
"RTN","PSOTPCRP",51,0)
 .I $P(PSOGNODE,"^",8) S PSOTAR($P(PSOGNODE,"^",8))=$G(PSOTAR($P(PSOGNODE,"^",8)))+1 Q
"RTN","PSOTPCRP",52,0)
 .S PSOTAR("NONE")=$G(PSOTAR("NONE"))+1
"RTN","PSOTPCRP",53,0)
 ;D HD
"RTN","PSOTPCRP",54,0)
 I 'PSOGTOP D HD W !!,"No patients found that meet report criteria.",! G END
"RTN","PSOTPCRP",55,0)
 S PSOG1="" F  S PSOG1=$O(^TMP("PSOGP",$J,PSOG1)) Q:PSOG1=""!(PSOGPOUT)  D
"RTN","PSOTPCRP",56,0)
 .I $G(PSOG1)="NONE" S PSOINAME="NONE"
"RTN","PSOTPCRP",57,0)
 .I $G(PSOG1)'="NONE" K PSOTINS,DIC,DIQ,DA,DR S DIC=4,DR=".01",DA=+PSOG1,DIQ(0)="E",DIQ="PSOTINS" D EN^DIQ1 S PSOINAME=$G(PSOTINS(4,+PSOG1,.01,"E")) K DIC,DIQ,DR,DA,PSOTINS
"RTN","PSOTPCRP",58,0)
 .D HD I PSOGPOUT Q
"RTN","PSOTPCRP",59,0)
 .S PSOTARX=0
"RTN","PSOTPCRP",60,0)
 .S PSOG2="" F  S PSOG2=$O(^TMP("PSOGP",$J,PSOG1,PSOG2)) Q:PSOG2=""!(PSOGPOUT)  F PSOG3=0:0 S PSOG3=$O(^TMP("PSOGP",$J,PSOG1,PSOG2,PSOG3)) Q:'PSOG3!(PSOGPOUT)  D
"RTN","PSOTPCRP",61,0)
 ..F PSOG4=0:0 S PSOG4=$O(^TMP("PSOGP",$J,PSOG1,PSOG2,PSOG3,PSOG4)) Q:'PSOG4!(PSOGPOUT)  D
"RTN","PSOTPCRP",62,0)
 ...S PSOXND=$G(^PS(52.91,PSOG4,0))
"RTN","PSOTPCRP",63,0)
 ...D ADDR
"RTN","PSOTPCRP",64,0)
 ...S PSOTARX=PSOTARX+1
"RTN","PSOTPCRP",65,0)
 ...W !!,PSOG2
"RTN","PSOTPCRP",66,0)
 ...W ?38,$S($P(PSOXND,"^",2):$E($P(PSOXND,"^",2),4,5)_"/"_$E($P(PSOXND,"^",2),6,7)_"/"_$E($P(PSOXND,"^",2),2,3),1:"")
"RTN","PSOTPCRP",67,0)
 ...W ?47,$S($P(PSOXND,"^",3):$E($P(PSOXND,"^",3),4,5)_"/"_$E($P(PSOXND,"^",3),6,7)_"/"_$E($P(PSOXND,"^",3),2,3),1:"")
"RTN","PSOTPCRP",68,0)
 ...W ?56,$S($P(PSOXND,"^",12):$E($P(PSOXND,"^",12),4,5)_"/"_$E($P(PSOXND,"^",12),6,7)_"/"_$E($P(PSOXND,"^",12),2,3),1:"")
"RTN","PSOTPCRP",69,0)
 ...S PSOXRS=$P(PSOXND,"^",4)
"RTN","PSOTPCRP",70,0)
 ...W ?65,$S(PSOXRS=1:"VA Provider",PSOXRS=2:"No/Show/Cancel",PSOXRS=3:"Patient Ended",PSOXRS=4:"N/F Rx",PSOXRS=5:"Patient Expired",PSOXRS=6:"Rx's Inactive",PSOXRS=7:"Exclusion",PSOXRS=8:"Refused Appt.",1:"")
"RTN","PSOTPCRP",71,0)
 ...I $P(PSOXND,"^",9) D
"RTN","PSOTPCRP",72,0)
 ....I $P(PSOXND,"^",9)=1 W !?1,"Exclusion: ACTIVE RX "_$P(PSOXND,"^",11) Q
"RTN","PSOTPCRP",73,0)
 ....I $P(PSOXND,"^",9)=2 W !?1,"Exclusion: ACTUAL APPT. <30 DAYS FROM DATE APPT. MADE" Q
"RTN","PSOTPCRP",74,0)
 ....I $P(PSOXND,"^",9)=3 W !?1,"Exclusion: ACTIVE RX "_$P(PSOXND,"^",11)_" & ACTUAL APPT. <30 DAYS FROM DATE APPT. MADE"
"RTN","PSOTPCRP",75,0)
 ...I ($Y+6)>IOSL,$G(PSOVADIS)'="" D HD I PSOGPOUT K PSOVADIS,PSOVADIX Q
"RTN","PSOTPCRP",76,0)
 ...I $G(PSOVADIS)'="" W !,$G(PSOVADIS)
"RTN","PSOTPCRP",77,0)
 ...I ($Y+6)>IOSL,$G(PSOVADIX)'="" D HD I PSOGPOUT K PSOVADIS,PSOVADIX Q
"RTN","PSOTPCRP",78,0)
 ...I $G(PSOVADIX)'="" W !,$G(PSOVADIX)
"RTN","PSOTPCRP",79,0)
 ...K PSOVADIS,PSOVADIX
"RTN","PSOTPCRP",80,0)
 ...I ($Y+6)>IOSL,PSOTARX'=$G(PSOTAR(PSOG1)) D HD
"RTN","PSOTPCRP",81,0)
 G END
"RTN","PSOTPCRP",82,0)
HD ;HEADER
"RTN","PSOTPCRP",83,0)
 I PSOGDV,PSOGPAGE'=1 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSOGPOUT=1 Q
"RTN","PSOTPCRP",84,0)
 I PSOGPAGE=1,'PSOGDV W ! I 1
"RTN","PSOTPCRP",85,0)
 E  W @IOF
"RTN","PSOTPCRP",86,0)
 W !,$S(PSOGSORT="E":"Eligible Patients",PSOGSORT="I":"Ineligible Patients",1:"All Patients")_$S($G(PSOINAME)="":"",1:" (")_$G(PSOINAME)_$S($G(PSOINAME)="":"",1:")")_"  Total: "_$S($G(PSOG1)'="":$G(PSOTAR(PSOG1)),1:""),?68,"PAGE: "_PSOGPAGE
"RTN","PSOTPCRP",87,0)
 S PSOGPAGE=PSOGPAGE+1
"RTN","PSOTPCRP",88,0)
 ;I $G(PSOINAME)'="" W !,"("_PSOINAME_")"_"  Total: ",$G(PSOTAR(PSOG1))
"RTN","PSOTPCRP",89,0)
 W !,"Grand Total: "_PSOGTOP,?38,"Start",?47,"Stop",?56,"Letter",?65,"Inactivation",!,"Patient",?38,"Date",?47,"Date",?56,"Date",?65,"Reason",!,PSOGPLIN
"RTN","PSOTPCRP",90,0)
 Q
"RTN","PSOTPCRP",91,0)
END ;End report
"RTN","PSOTPCRP",92,0)
 K ^TMP("PSOGP",$J),PSOGPAR,PSOGSORT,PSOGPINS
"RTN","PSOTPCRP",93,0)
 I '$G(PSOGPOUT),PSOGDV W !!,"End of Report." K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOTPCRP",94,0)
 I 'PSOGDV W !!,"End of Report."
"RTN","PSOTPCRP",95,0)
 I PSOGDV W !
"RTN","PSOTPCRP",96,0)
 E  W @IOF
"RTN","PSOTPCRP",97,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOTPCRP",98,0)
 Q
"RTN","PSOTPCRP",99,0)
ADDR ;Check for difference in State
"RTN","PSOTPCRP",100,0)
 N PSOVA1,PSOVA2,VAPA
"RTN","PSOTPCRP",101,0)
 S (PSOVADIX,PSOVADIS)=""
"RTN","PSOTPCRP",102,0)
 S DFN=$P($G(^PS(52.91,PSOG4,0)),"^")
"RTN","PSOTPCRP",103,0)
 I '$G(DFN) Q
"RTN","PSOTPCRP",104,0)
 D ADD^VADPT
"RTN","PSOTPCRP",105,0)
 I '$G(VAPA(12)) K VAPA G ADDRX
"RTN","PSOTPCRP",106,0)
 I $P($G(VAPA(22,1)),"^",3)'="Y",$P($G(VAPA(22,2)),"^",3)'="Y",$P($G(VAPA(22,5)),"^",3)'="Y" K VAPA G ADDRX
"RTN","PSOTPCRP",107,0)
 S PSOVADIS="Confidential State = "_$P($G(VAPA(17)),"^",2)
"RTN","PSOTPCRP",108,0)
 I $G(VAPA(5))'=$G(VAPA(17)) S PSOVADIX=$S($G(VAPA(9)):"Temporary State = ",1:"Permanent State = ")_$P($G(VAPA(5)),"^",2)
"RTN","PSOTPCRP",109,0)
 K VAPA
"RTN","PSOTPCRP",110,0)
 Q
"RTN","PSOTPCRP",111,0)
ADDRX ;
"RTN","PSOTPCRP",112,0)
 K VAPA D ADD^VADPT I '$G(VAPA(9)) S PSOVADIS="Permanent State = "_$P($G(VAPA(5)),"^",2) K VAPA Q
"RTN","PSOTPCRP",113,0)
 S PSOVADIS="Temporary State = "_$P($G(VAPA(5)),"^",2)
"RTN","PSOTPCRP",114,0)
 S PSOVA1=$G(VAPA(5))
"RTN","PSOTPCRP",115,0)
 K VAPA S VAPA("P")="" D ADD^VADPT
"RTN","PSOTPCRP",116,0)
 S PSOVA2=$G(VAPA(5))
"RTN","PSOTPCRP",117,0)
 I PSOVA1=PSOVA2 K VAPA Q
"RTN","PSOTPCRP",118,0)
 S PSOVADIX="Permanent State = "_$P($G(PSOVA2),"^",2)
"RTN","PSOTPCRP",119,0)
 K VAPA
"RTN","PSOTPCRP",120,0)
 Q
"RTN","PSOTPCRX")
0^3^B51178957
"RTN","PSOTPCRX",1,0)
PSOTPCRX ;BIR/RTR-Enrollment and Active Rx check ;08/01/03
"RTN","PSOTPCRX",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145**;DEC 1997
"RTN","PSOTPCRX",3,0)
 ;External reference to PS(55 supported by DBIA 2228
"RTN","PSOTPCRX",4,0)
 ;External reference to PSDRUG( supported by DBIA 221
"RTN","PSOTPCRX",5,0)
 ;External reference to XTMP("SDPSO145" supported by DBIA's 4193,4194
"RTN","PSOTPCRX",6,0)
 ;External references to DGENA supported by DBIA 3812
"RTN","PSOTPCRX",7,0)
 ;External reference to DGENA4 supported by DBIA 4192
"RTN","PSOTPCRX",8,0)
 ;
"RTN","PSOTPCRX",9,0)
 ;Enrollment check for TPC Eligibility
"RTN","PSOTPCRX",10,0)
ENR(PSOENPAT,PSOENRDT) ;;If not enrolled, Patient does not go in file
"RTN","PSOTPCRX",11,0)
 I '$G(PSOENPAT) Q 0
"RTN","PSOTPCRX",12,0)
 S:'$G(PSOENRDT) PSOENRDT=$$DT^XLFDT
"RTN","PSOTPCRX",13,0)
 N PSODGENR,PSODDONE,PSODRIEN,PSODGRDT
"RTN","PSOTPCRX",14,0)
 S PSODRIEN=$$FINDCUR^DGENA(PSOENPAT),PSODDONE=0
"RTN","PSOTPCRX",15,0)
 Q:'PSODRIEN 0
"RTN","PSOTPCRX",16,0)
 F  Q:PSODDONE  D
"RTN","PSOTPCRX",17,0)
 .I '$$GET^DGENA(PSODRIEN,.PSODGENR) S PSODDONE=-1 Q
"RTN","PSOTPCRX",18,0)
 .S PSODGRDT=$G(PSODGENR("APP")) S:PSODGRDT="" PSODGRDT=$G(PSODGENR("DATE"))
"RTN","PSOTPCRX",19,0)
 .I PSODGRDT,PSODGRDT<PSOENRDT S PSODDONE=1 S:$$CATEGORY^DGENA4(PSOENPAT,$G(PSODGENR("STATUS")))="N" PSODDONE=-1 Q
"RTN","PSOTPCRX",20,0)
 .S PSODRIEN=$$FINDPRI^DGENA(PSODRIEN)
"RTN","PSOTPCRX",21,0)
 .I 'PSODRIEN S PSODDONE=-1 Q
"RTN","PSOTPCRX",22,0)
 .K PSODGENR
"RTN","PSOTPCRX",23,0)
 Q $S(PSODDONE<1:0,1:1)
"RTN","PSOTPCRX",24,0)
 Q
"RTN","PSOTPCRX",25,0)
 ;Active Rx check for eligibility
"RTN","PSOTPCRX",26,0)
RX(PSOTRXPT) ;
"RTN","PSOTPCRX",27,0)
 I '$G(PSOTRXPT) Q 0
"RTN","PSOTPCRX",28,0)
 N PSOTRXDT,PSOTRXDG,PSOTRX,PSOTRX1,PSOTRX2,X,X1,X2
"RTN","PSOTPCRX",29,0)
 S PSOTRX=0
"RTN","PSOTPCRX",30,0)
 ;Using Oct 22 minus 485 days
"RTN","PSOTPCRX",31,0)
 S X1=3031022,X2=-486 D C^%DTC S PSOTRXDT=X K X,X1,X2
"RTN","PSOTPCRX",32,0)
 F PSOTRX1=PSOTRXDT:0 S PSOTRX1=$O(^PS(55,PSOTRXPT,"P","A",PSOTRX1)) Q:'PSOTRX1!(PSOTRX)  S PSOTRX2="" F  S PSOTRX2=$O(^PS(55,PSOTRXPT,"P","A",PSOTRX1,PSOTRX2)) Q:PSOTRX2=""!(PSOTRX)  D
"RTN","PSOTPCRX",33,0)
 .I $P($G(^PSRX(PSOTRX2,0)),"^",2)=PSOTRXPT,$P($G(^(0)),"^")'="",$P($G(^("STA")),"^")'="",$P($G(^("STA")),"^")'=13 D
"RTN","PSOTPCRX",34,0)
 ..I $P($G(^PSRX(PSOTRX2,0)),"^",13),$P($G(^(0)),"^",13)<PSOTRXDT Q
"RTN","PSOTPCRX",35,0)
 ..S PSOTRXDG=$P($G(^PSRX(PSOTRX2,0)),"^",6)
"RTN","PSOTPCRX",36,0)
 ..I PSOTRXDG,$P($G(^PSDRUG(PSOTRXDG,0)),"^",3)'["S",$P($G(^(0)),"^",3)'["I" S PSOTRX=1 S ^XTMP("SDPSO145","ACRX",PSOTRXPT)=$P($G(^PSRX(PSOTRX2,0)),"^")
"RTN","PSOTPCRX",37,0)
 Q PSOTRX
"RTN","PSOTPCRX",38,0)
SCH ;
"RTN","PSOTPCRX",39,0)
 I '$D(^XTMP("SDPSO145","PAT","S")) Q
"RTN","PSOTPCRX",40,0)
 ;Scheduling
"RTN","PSOTPCRX",41,0)
 N PSOWAITT,PSOTPDRD,PSOACIRX,PSOXLP1,PSOXLP2,PSOXLP3,PSOXLESS,PSOTX1,PSOTX2,PSOTX3,PSOLXQT,PSOXNRLD,PSOXTCRX
"RTN","PSOTPCRX",42,0)
 S PSOTX1="" F  S PSOTX1=$O(^XTMP("SDPSO145","PAT","S",PSOTX1)) Q:PSOTX1=""  D
"RTN","PSOTPCRX",43,0)
 .S PSOXLESS=0 S PSOXLP1="" F  S PSOXLP1=$O(^XTMP("SDPSO145","PAT","S",PSOTX1,PSOXLP1)) Q:PSOXLP1=""!(PSOXLESS)  S PSOXLP2="" F  S PSOXLP2=$O(^XTMP("SDPSO145","PAT","S",PSOTX1,PSOXLP1,PSOXLP2)) Q:PSOXLP2=""!(PSOXLESS)  D
"RTN","PSOTPCRX",44,0)
 ..I $G(^XTMP("SDPSO145","PAT","S",PSOTX1,PSOXLP1,PSOXLP2)) S PSOXLESS=1
"RTN","PSOTPCRX",45,0)
 .S PSOLXQT=0
"RTN","PSOTPCRX",46,0)
 .S PSOTX2="" F  S PSOTX2=$O(^XTMP("SDPSO145","PAT","S",PSOTX1,PSOTX2)) Q:PSOTX2=""!(PSOLXQT)  S PSOTX3="" F  S PSOTX3=$O(^XTMP("SDPSO145","PAT","S",PSOTX1,PSOTX2,PSOTX3)) Q:PSOTX3=""!(PSOLXQT)  D
"RTN","PSOTPCRX",47,0)
 ..S PSOTPDRD=$P($G(^XTMP("SDPSO145","PAT","S",PSOTX1,PSOTX2,PSOTX3)),"^",3)
"RTN","PSOTPCRX",48,0)
 ..S PSOXNRLD=1 S:'$D(^XTMP("SDPSO145","NOTEN",PSOTX1)) PSOXNRLD=$$ENR(PSOTX1,3030725) I $D(^XTMP("SDPSO145","NOTEN",PSOTX1))!('$G(PSOXNRLD)) D  Q
"RTN","PSOTPCRX",49,0)
 ...S ^XTMP("SDPSO145","NOTEN",PSOTX1)="",PSOLXQT=1
"RTN","PSOTPCRX",50,0)
 ..S PSOXTCRX=0 S:'$D(^XTMP("SDPSO145","ACRX",PSOTX1)) PSOXTCRX=$$RX(PSOTX1) I PSOXTCRX!($D(^XTMP("SDPSO145","ACRX",PSOTX1))) D  Q
"RTN","PSOTPCRX",51,0)
 ...S PSOACIRX=$G(^XTMP("SDPSO145","ACRX",PSOTX1))
"RTN","PSOTPCRX",52,0)
 ...;S PSOLXQT=1
"RTN","PSOTPCRX",53,0)
 ...I $D(^PS(52.91,PSOTX1,0)) D  K PSOACIRX Q
"RTN","PSOTPCRX",54,0)
 ....D:$D(^XTMP("SDPSO145","PAT","E",PSOTX1))!($D(^XTMP("SDPSO145","PAT","S",PSOTX1))) DATE
"RTN","PSOTPCRX",55,0)
 ....I $D(^XTMP("SDPSO145","PAT","E",PSOTX1)) K DA,DR,DIE S DIE="^PS(52.91,",DA=PSOTX1,DR="5////"_"X" D ^DIE K DA,DR,DIE
"RTN","PSOTPCRX",56,0)
 ...D SNM
"RTN","PSOTPCRX",57,0)
 ...I $G(PSOTPSNM)="" S ^XTMP("SDPSO145","PROB1",PSOTX1)=" (With Exclusion)" K PSOTPSNM K PSOACIRX Q
"RTN","PSOTPCRX",58,0)
 ...S PSOWAITT=$S($D(^XTMP("SDPSO145","PAT","E",PSOTX1)):"X",1:"S")
"RTN","PSOTPCRX",59,0)
 ...K DIC S DIC="^PS(52.91,",DIC(0)="L",(X,DINUM)=PSOTX1,DIC("DR")="1////"_DT_";2////"_DT_";3////"_7_";4////"_PSOTPDRD_";6////"_PSOTPSNM_";7////"_PSOTX2_";9////"_PSOTX3_";8////"_$S($G(PSOXLESS):3,1:1)_";10////"_$G(PSOACIRX) D
"RTN","PSOTPCRX",60,0)
 ....S DIC("DR")=DIC("DR")_";5////"_PSOWAITT K DD,DO D FILE^DICN
"RTN","PSOTPCRX",61,0)
 ....K PSOWAITT,PSOTPSNM,PSOACIRX,DO,DD,DIC,DIE,X,DINUM
"RTN","PSOTPCRX",62,0)
 ....I Y'>0 S ^XTMP("SDPSO145","PROB",PSOTX1)=" (With Exlusion)" Q
"RTN","PSOTPCRX",63,0)
 ....S PSOITOT=$G(PSOITOT)+1
"RTN","PSOTPCRX",64,0)
 ..I PSOXLESS D  Q
"RTN","PSOTPCRX",65,0)
 ...;S PSOLXQT=1
"RTN","PSOTPCRX",66,0)
 ...I $D(^PS(52.91,PSOTX1,0)) D  Q
"RTN","PSOTPCRX",67,0)
 ....D:$D(^XTMP("SDPSO145","PAT","E",PSOTX1))!($D(^XTMP("SDPSO145","PAT","S",PSOTX1))) DATE
"RTN","PSOTPCRX",68,0)
 ....I $D(^XTMP("SDPSO145","PAT","E",PSOTX1)) K DIE,DA,DR S DIE="^PS(52.91,",DA=PSOTX1,DR="2////"_DT_";5////"_"X"_";3////"_7_";8////"_$S($P($G(^PS(52.91,PSOTX1,0)),"^",9)=1:"3",$P($G(^(0)),"^",9)=3:"3",1:"2")
"RTN","PSOTPCRX",69,0)
 ....D ^DIE K DA,DR,DIE
"RTN","PSOTPCRX",70,0)
 ...D SNM
"RTN","PSOTPCRX",71,0)
 ...I $G(PSOTPSNM)="" S ^XTMP("SDPSO145","PROB1",PSOTX1)=" (With Exclusion)" K PSOTPSNM Q
"RTN","PSOTPCRX",72,0)
 ...K DIC S DIC="^PS(52.91,",DIC(0)="L",(X,DINUM)=PSOTX1,DIC("DR")="1////"_DT_";2////"_DT_";3////"_7_";4////"_PSOTPDRD_";5////"_"S"_";6////"_PSOTPSNM_";7////"_PSOTX2_";9////"_PSOTX3_";8////"_2 K DD,DO D FILE^DICN K DD,DO,DIE,X,DINUM D
"RTN","PSOTPCRX",73,0)
 ....K PSOTPSNM
"RTN","PSOTPCRX",74,0)
 ....I Y'>0 S ^XTMP("SDPSO145","PROB",PSOTX1)=" (With Exclusion)" Q
"RTN","PSOTPCRX",75,0)
 ....S PSOITOT=$G(PSOITOT)+1
"RTN","PSOTPCRX",76,0)
 ..I $D(^PS(52.91,PSOTX1,0)) D  Q
"RTN","PSOTPCRX",77,0)
 ...I $D(^XTMP("SDPSO145","PAT","E",PSOTX1)) K DIE,DA,DR S DIE="^PS(52.91,",DA=PSOTX1,DR="5////"_"X" D ^DIE K DA,DIR,DR
"RTN","PSOTPCRX",78,0)
 ...D:$D(^XTMP("SDPSO145","PAT","E",PSOTX1))!($D(^XTMP("SDPSO145","PAT","S",PSOTX1))) DATE
"RTN","PSOTPCRX",79,0)
 ...;I $P($G(^PS(52.91,PSOTX1,0)),"^",10) S PSOLXQT=1 Q
"RTN","PSOTPCRX",80,0)
 ...;I PSOTX2=$P($G(^PS(52.91,PSOTX1,0)),"^",8) K DIE,DA,DR S DA=PSOTX1,DIE="^PS(52.91,",DR="9////"_PSOTX3 D ^DIE K DIE,DA,DR S PSOLXQT=1 Q
"RTN","PSOTPCRX",81,0)
 ...;D SNM I $G(PSOTPSNM)="" Q
"RTN","PSOTPCRX",82,0)
 ...;K DA,DIE,DR S DIE="^PS(52.91,",DA=PSOTX1,DR="4////"_"@"_";6////"_PSOTPSNM_";7////"_PSOTX2_";9////"_PSOTX3 D ^DIE K DA,DR,DIE
"RTN","PSOTPCRX",83,0)
 ...;K PSOTPSNM S PSOLXQT=1 Q
"RTN","PSOTPCRX",84,0)
 ..D SNM
"RTN","PSOTPCRX",85,0)
 ..I $G(PSOTPSNM)="" S ^XTMP("SDPSO145","PROB1",PSOTX1)="" K PSOTPSNM Q
"RTN","PSOTPCRX",86,0)
 ..K DIC S DIC="^PS(52.91,",DIC(0)="L",(X,DINUM)=PSOTX1,DIC("DR")="1////"_DT_";4////"_PSOTPDRD_";5////"_"S"_";6////"_PSOTPSNM_";7////"_PSOTX2_";9////"_PSOTX3 K DD,DO D FILE^DICN K DD,DO,DIE,X,DINUM D
"RTN","PSOTPCRX",87,0)
 ...K PSOTPSNM
"RTN","PSOTPCRX",88,0)
 ...I Y'>0 S ^XTMP("SDPSO145","PROB",PSOTX1)="" Q
"RTN","PSOTPCRX",89,0)
 ...S PSOETOT=$G(PSOETOT)+1
"RTN","PSOTPCRX",90,0)
 Q
"RTN","PSOTPCRX",91,0)
SNM ;
"RTN","PSOTPCRX",92,0)
 K PSOTPSNM,PSOSTATI,DIC,DIQ,DD,DR S DIC=4,DR="99",DA=+PSOTX2,DIQ(0)="I",DIQ="PSOSTATI" D EN^DIQ1 S PSOTPSNM=$G(PSOSTATI(4,+PSOTX2,99,"I")) K DIC,DIQ,DR,DA,PSOSTATI
"RTN","PSOTPCRX",93,0)
 Q
"RTN","PSOTPCRX",94,0)
DATE ;
"RTN","PSOTPCRX",95,0)
 I $P($G(^PS(52.91,PSOTX1,0)),"^",10),PSOTX3'<$P(^(0),"^",10) Q
"RTN","PSOTPCRX",96,0)
 I PSOTX2=$P($G(^PS(52.91,PSOTX1,0)),"^",8) K DA,DIE,DR S DIE="^PS(52.91,",DA=PSOTX1,DR="9////"_PSOTX3_";4////"_"@" D ^DIE K DA,DR,DIE D  Q
"RTN","PSOTPCRX",97,0)
 .S DIE="^PS(52.91,",DA=PSOTX1,DR="4////"_PSOTPDRD D ^DIE K DA,DR,DIE
"RTN","PSOTPCRX",98,0)
 D SNM
"RTN","PSOTPCRX",99,0)
 I $G(PSOTPSNM)="" K PSOTPSNM Q
"RTN","PSOTPCRX",100,0)
 K DA,DR,DIE S DIE="^PS(52.91,",DA=PSOTX1,DR="4////"_"@"_";6////"_PSOTPSNM_";7////"_PSOTX2_";9////"_PSOTX3 D ^DIE K DA,DR,DIE
"RTN","PSOTPCRX",101,0)
 K DA,DR,DIE S DIE="^PS(52.91,",DA=PSOTX1,DR="4////"_PSOTPDRD D ^DIE K DA,DR,DIE
"RTN","PSOTPCRX",102,0)
 K PSOTPSNM
"RTN","PSOTPCRX",103,0)
 Q
"RTN","PSOTPCRX",104,0)
EWL ;
"RTN","PSOTPCRX",105,0)
 N PSOTPRXX
"RTN","PSOTPCRX",106,0)
 K PSOTPSNM,PSOSTATI,DIC,DIQ,DD,DR S DIC=4,DR="99",DA=+PSOTG2,DIQ(0)="I",DIQ="PSOSTATI" D EN^DIQ1 S PSOTPSNM=$G(PSOSTATI(4,+PSOTG2,99,"I")) K DIC,DIQ,DR,DA,PSOSTATI
"RTN","PSOTPCRX",107,0)
 I $G(PSOTPSNM)="" S ^XTMP("SDPSO145","PROB1",PSOTG1)="" K PSOTPSNM Q
"RTN","PSOTPCRX",108,0)
 S PSOTPRXX=$G(^XTMP("SDPSO145","ACRX",PSOTG1))
"RTN","PSOTPCRX",109,0)
 K DIE,DA,DR,DIC
"RTN","PSOTPCRX",110,0)
 S DIC="^PS(52.91,",DIC(0)="L",(X,DINUM)=PSOTG1,DIC("DR")="1////"_DT_";2////"_DT_";3////"_7_";5////"_"E"_";6////"_PSOTPSNM_";7////"_PSOTG2_";8////"_1_";10////"_PSOTPRXX S:'$G(PSONODAD) DIC("DR")=DIC("DR")_";4////"_PSOTG3
"RTN","PSOTPCRX",111,0)
 K DD,DO D FILE^DICN K DD,DO,DIE,X,DINUM,PSOTPSNM
"RTN","PSOTPCRX",112,0)
 I Y'>0 S ^XTMP("SDPSO145","PROB",PSOTG1)="" Q
"RTN","PSOTPCRX",113,0)
 S PSOITOT=$G(PSOITOT)+1
"RTN","PSOTPCRX",114,0)
 K ^XTMP("SDPSO145","PROB",PSOTG1)
"RTN","PSOTPCRX",115,0)
 K ^XTMP("SDPSO145","PROB1",PSOTG1)
"RTN","PSOTPCRX",116,0)
 Q
"RTN","PSOTPCUL")
0^11^B109419
"RTN","PSOTPCUL",1,0)
PSOTPCUL ;BIR/RTR-Utility Routine for TBP Project ;08/09/03
"RTN","PSOTPCUL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**145**;DEC 1997
"RTN","PSOTPCUL",3,0)
 ;
"RTN","PSOTPCUL",4,0)
EN(PSOTRXN) ;CPRS call to determine if an RX is a TPB Rx
"RTN","PSOTPCUL",5,0)
 ;PSOTRXN = internal Rx number
"RTN","PSOTPCUL",6,0)
 ;OUTPUT = 1 for TBP Rx, 0 for non-TPB Rx
"RTN","PSOTPCUL",7,0)
 Q:'$G(PSOTRXN) 0
"RTN","PSOTPCUL",8,0)
 Q $S($P($G(^PSRX(PSOTRXN,"TPB")),"^"):1,1:0)
"SEC","^DIC",52.91,52.91,0,"AUDIT")

"SEC","^DIC",52.91,52.91,0,"DD")
@
"SEC","^DIC",52.91,52.91,0,"DEL")

"SEC","^DIC",52.91,52.91,0,"LAYGO")

"SEC","^DIC",52.91,52.91,0,"RD")

"SEC","^DIC",52.91,52.91,0,"WR")

"SEC","^DIC",52.92,52.92,0,"AUDIT")

"SEC","^DIC",52.92,52.92,0,"DD")
@
"SEC","^DIC",52.92,52.92,0,"DEL")

"SEC","^DIC",52.92,52.92,0,"LAYGO")

"SEC","^DIC",52.92,52.92,0,"RD")

"SEC","^DIC",52.92,52.92,0,"WR")

"VER")
8.0^22.0
"^DD",52.91,52.91,0)
FIELD^^.01^12
"^DD",52.91,52.91,0,"DDA")
N
"^DD",52.91,52.91,0,"DT")
3030821
"^DD",52.91,52.91,0,"IX","B",52.91,.01)

"^DD",52.91,52.91,0,"NM","TPB ELIGIBILITY")

"^DD",52.91,52.91,.01,0)
PATIENT^RP2'X^DPT(^0;1^S DINUM=X
"^DD",52.91,52.91,.01,1,0)
^.1
"^DD",52.91,52.91,.01,1,1,0)
52.91^B
"^DD",52.91,52.91,.01,1,1,1)
S ^PS(52.91,"B",$E(X,1,30),DA)=""
"^DD",52.91,52.91,.01,1,1,2)
K ^PS(52.91,"B",$E(X,1,30),DA)
"^DD",52.91,52.91,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",52.91,52.91,.01,21,0)
^.001^1^1^3030813^^
"^DD",52.91,52.91,.01,21,1,0)
This is the patient IEN who is eligible for this new service.
"^DD",52.91,52.91,.01,"DEL",1,0)
I 1 D EN^DDIOL("Patient entries CANNOT be deleted.")
"^DD",52.91,52.91,.01,"DT")
3030807
"^DD",52.91,52.91,1,0)
DATE PHARMACY BENEFIT BEGAN^RD^^0;2^S %DT="EX" D ^%DT S X=Y K:X<1 X
"^DD",52.91,52.91,1,3)
(No range limit on date)
"^DD",52.91,52.91,1,21,0)
^^4^4^3030731^
"^DD",52.91,52.91,1,21,1,0)
This is the date the entry was made into the file during extraction either
"^DD",52.91,52.91,1,21,2,0)
from the EWL or from the Schedule Appointment set by the post-install 
"^DD",52.91,52.91,1,21,3,0)
routine. Manual entry to this file is also allowed for eligible patient, 
"^DD",52.91,52.91,1,21,4,0)
and it will be set to the current date.
"^DD",52.91,52.91,1,23,0)
^^1^1^3030731^
"^DD",52.91,52.91,1,23,1,0)
Not editable.
"^DD",52.91,52.91,1,"DT")
3030806
"^DD",52.91,52.91,2,0)
INACTIVATION OF BENEFIT DATE^DX^^0;3^S %DT="EX" D ^%DT S X=Y K:Y<1 X I $D(X),$D(^PS(52.91,DA,0)),X<$P(^(0),U,2) D EN^DDIOL("INACTIVATION DATE CANNOT BE BEFORE DATE PHARMACY BENEFIT BEGAN","","$C(7),!?5") K X
"^DD",52.91,52.91,2,1,0)
^.1^^0
"^DD",52.91,52.91,2,3)
(No range limit on date)
"^DD",52.91,52.91,2,21,0)
^^4^4^3030808^
"^DD",52.91,52.91,2,21,1,0)
This date can be set manually when the patient is no longer eligible for
"^DD",52.91,52.91,2,21,2,0)
this benefit; or when the Non-VA prescriptions are either Discontinued
"^DD",52.91,52.91,2,21,3,0)
or Expired; or set automatically due to a Date of Death entered in the
"^DD",52.91,52.91,2,21,4,0)
Patient file (#2). 
"^DD",52.91,52.91,2,"DT")
3030826
"^DD",52.91,52.91,3,0)
INACTIVATION REASON CODE^*S^1:SEEN BY VA PROVIDER;2:NO/SHOW/CANCELLATION;3:PATIENT ENDED;4:NON-FORMULARY RX NOT ACCEPTED;5:PATIENT EXPIRED;6:ALL RX'S INACTIVE;7:EXCLUSION;8:PATIENT REFUSED APPT;^0;4^Q
"^DD",52.91,52.91,3,12)
Only these codes are allowed for manual entry.
"^DD",52.91,52.91,3,12.1)
S DIC("S")="I Y'=7"
"^DD",52.91,52.91,3,21,0)
^^4^4^3030821^
"^DD",52.91,52.91,3,21,1,0)
This field contains a code representing the reason for inactivating a
"^DD",52.91,52.91,3,21,2,0)
patient for this benefit. EXCLUSION code 7, is hidden and not user 
"^DD",52.91,52.91,3,21,3,0)
selectable. It is used by the post-install routine during initial
"^DD",52.91,52.91,3,21,4,0)
extraction.
"^DD",52.91,52.91,3,"DT")
3030821
"^DD",52.91,52.91,4,0)
DESIRED APPOINTMENT DATE^DX^^0;5^S %DT="EX" D ^%DT S X=Y K:X<1 X I $D(X),$D(^PS(52.91,DA,0)),X<$P(^(0),U,2) D EN^DDIOL("DESIRED APPOINTMENT DATE CANNOT BE BEFORE DATE PHARMACY BENEFIT BEGAN","","$C(7),!?5") K X
"^DD",52.91,52.91,4,3)
Enter the desired date for the appointment.
"^DD",52.91,52.91,4,21,0)
^^1^1^3030731^
"^DD",52.91,52.91,4,21,1,0)
Set by the EWL/Scheduling extract and is obtained from Scheduling file.
"^DD",52.91,52.91,4,23,0)
^^8^8^3030731^
"^DD",52.91,52.91,4,23,1,0)
Set by the EWL, DESIRED DATE OF APPOINTMENT field (#22) of the SD WAIT
"^DD",52.91,52.91,4,23,2,0)
LIST file (#409.3), piece 16 of the 0 node; or from Scheduling, the
"^DD",52.91,52.91,4,23,3,0)
DESIRED APPOINTMENT DATE field (#27) of the APPOINTMENT subfile (#1900)
"^DD",52.91,52.91,4,23,4,0)
of the PATIENT file (#2), piece 1 of the 1 node. If there is more than one
"^DD",52.91,52.91,4,23,5,0)
desired appointment in Scheduling then the one that is closest to the date
"^DD",52.91,52.91,4,23,6,0)
the extract was run is used.
"^DD",52.91,52.91,4,23,7,0)
 
"^DD",52.91,52.91,4,23,8,0)
Not editable.
"^DD",52.91,52.91,4,"DT")
3030806
"^DD",52.91,52.91,5,0)
WAIT TYPE^S^E:EWL;M:MANUAL;S:SCHEDULED APPOINTMENT;X:SCHEDULED APPOINTMENT & EWL;^0;6^Q
"^DD",52.91,52.91,5,3)
Select one Wait List Type.
"^DD",52.91,52.91,5,21,0)
^.001^1^1^3030817^^^^
"^DD",52.91,52.91,5,21,1,0)
The type of wait the patient is assigned.
"^DD",52.91,52.91,5,23,0)
^.001^1^1^3030817^^^
"^DD",52.91,52.91,5,23,1,0)
"M" is set for manual entry. Not editable.
"^DD",52.91,52.91,5,"DT")
3030817
"^DD",52.91,52.91,6,0)
STATION NUMBER^RF^^0;7^K:$L(X)>7!($L(X)<3)!'(X?3N.AN) X
"^DD",52.91,52.91,6,3)
Answer must be 3-7 characters in length
"^DD",52.91,52.91,6,21,0)
^^1^1^3030731^
"^DD",52.91,52.91,6,21,1,0)
7 digit STATION NUMBER. First 3 digit station number plus any modifiers.
"^DD",52.91,52.91,6,23,0)
^^3^3^3030731^
"^DD",52.91,52.91,6,23,1,0)
An attempt to obtain the clinic from the Patient file (#2) will be
"^DD",52.91,52.91,6,23,2,0)
performed in order to auto-populate the Station Number.
"^DD",52.91,52.91,6,23,3,0)
Can be entered manually. It's a required field.
"^DD",52.91,52.91,6,"DT")
3030806
"^DD",52.91,52.91,7,0)
INSTITUTION^RP4'^DIC(4,^0;8^Q
"^DD",52.91,52.91,7,1,0)
^.1^^0
"^DD",52.91,52.91,7,21,0)
^^2^2^3030807^
"^DD",52.91,52.91,7,21,1,0)
Is set by the EWL/Scheduling extract and is obtained from the Institution
"^DD",52.91,52.91,7,21,2,0)
File (#4, field .01)
"^DD",52.91,52.91,7,23,0)
^^3^3^3030807^
"^DD",52.91,52.91,7,23,1,0)
During manual entry, if this field is found null (due to timeout), then 
"^DD",52.91,52.91,7,23,2,0)
the record will be marked as inactive and the INACTIVATION REASON
"^DD",52.91,52.91,7,23,3,0)
CODE will be set 3 (Patient Ended).
"^DD",52.91,52.91,7,"DT")
3030807
"^DD",52.91,52.91,8,0)
EXCLUSION REASON^S^1:ACTIVE RX;2:ACTUAL APPT. < 30 DAYS FROM DATE APPT. MADE;3:BOTH;^0;9^Q
"^DD",52.91,52.91,8,21,0)
^.001^1^1^3030817^^
"^DD",52.91,52.91,8,21,1,0)
Exclusion reason codes.
"^DD",52.91,52.91,8,"DT")
3030817
"^DD",52.91,52.91,9,0)
PRIMARY CARE SCHEDULE APT DATE^D^^0;10^S %DT="ETX" D ^%DT S X=Y K:X<1 X
"^DD",52.91,52.91,9,3)
(No range limit on date)
"^DD",52.91,52.91,9,21,0)
^^3^3^3030821^
"^DD",52.91,52.91,9,21,1,0)
This is the date that a primary care appointment was scheduled. This 
"^DD",52.91,52.91,9,21,2,0)
field is populated only by the post-install routine during initial 
"^DD",52.91,52.91,9,21,3,0)
extraction.
"^DD",52.91,52.91,9,"DT")
3030821
"^DD",52.91,52.91,10,0)
RX #^F^^0;11^K:$L(X)>15!($L(X)<1) X
"^DD",52.91,52.91,10,3)
Answer must be 1-15 characters in length
"^DD",52.91,52.91,10,21,0)
^^2^2^3030807^
"^DD",52.91,52.91,10,21,1,0)
Rx# if found during the extraction that made the patient flagged as
"^DD",52.91,52.91,10,21,2,0)
excluded for this service.
"^DD",52.91,52.91,10,"DT")
3030807
"^DD",52.91,52.91,11,0)
DATE LETTER PRINTED^D^^0;12^S %DT="EX" D ^%DT S X=Y K:X<1 X
"^DD",52.91,52.91,11,3)
(No range limit on date)
"^DD",52.91,52.91,11,21,0)
^^1^1^3030807^
"^DD",52.91,52.91,11,21,1,0)
Date the letter was printed.
"^DD",52.91,52.91,11,"DT")
3030807
"^DD",52.92,52.92,0)
FIELD^^.09^17
"^DD",52.92,52.92,0,"DDA")
N
"^DD",52.92,52.92,0,"DT")
3030818
"^DD",52.92,52.92,0,"IX","B",52.92,.01)

"^DD",52.92,52.92,0,"NM","TPB INSTITUTION LETTERS")

"^DD",52.92,52.92,0,"PT",52.92,.02)

"^DD",52.92,52.92,.01,0)
INSTITUTION^RP4'X^DIC(4,^0;1^S DINUM=X
"^DD",52.92,52.92,.01,1,0)
^.1
"^DD",52.92,52.92,.01,1,1,0)
52.92^B
"^DD",52.92,52.92,.01,1,1,1)
S ^PS(52.92,"B",$E(X,1,30),DA)=""
"^DD",52.92,52.92,.01,1,1,2)
K ^PS(52.92,"B",$E(X,1,30),DA)
"^DD",52.92,52.92,.01,3)

"^DD",52.92,52.92,.01,21,0)
^^1^1^3030725^
"^DD",52.92,52.92,.01,21,1,0)
Pointer to Instituion file #4, to be used for printing TPB letters.
"^DD",52.92,52.92,.01,"DT")
3030728
"^DD",52.92,52.92,.02,0)
PARENT INSTITUTION^P52.92'^PS(52.92,^0;2^Q
"^DD",52.92,52.92,.02,21,0)
^^5^5^3030818^
"^DD",52.92,52.92,.02,21,1,0)
This field is to be used to re-map Instituions, like CBOCs, to a 
"^DD",52.92,52.92,.02,21,2,0)
parent Institution for the purpose of providing a proper:
"^DD",52.92,52.92,.02,21,3,0)
           Letter Heading          
"^DD",52.92,52.92,.02,21,4,0)
           Local Pharmacy Phone Number(s)
"^DD",52.92,52.92,.02,21,5,0)
           Directors Signature Block
"^DD",52.92,52.92,.02,"DT")
3030818
"^DD",52.92,52.92,.03,0)
TPB CONTACT PHONE 1^F^^0;3^K:$L(X)>25!($L(X)<7) X
"^DD",52.92,52.92,.03,3)
Answer must be 7-25 characters in length.
"^DD",52.92,52.92,.03,21,0)
^^2^2^3030807^
"^DD",52.92,52.92,.03,21,1,0)
This is the first phone number veterans are to call for more 
"^DD",52.92,52.92,.03,21,2,0)
information regarding TPB.
"^DD",52.92,52.92,.03,"DT")
3030807
"^DD",52.92,52.92,.04,0)
TPB CONTACT PHONE 2^F^^0;4^K:$L(X)>25!($L(X)<7) X
"^DD",52.92,52.92,.04,3)
Answer must be 7-25 characters in length.
"^DD",52.92,52.92,.04,21,0)
^^2^2^3030807^
"^DD",52.92,52.92,.04,21,1,0)
This is the second phone number veterans are to call for more
"^DD",52.92,52.92,.04,21,2,0)
information regarding TPB.
"^DD",52.92,52.92,.04,"DT")
3030807
"^DD",52.92,52.92,.05,0)
ADDRESS LINE 1^F^^0;5^K:$L(X)>40!($L(X)<1) X
"^DD",52.92,52.92,.05,3)
Answer must be 1-40 characters in length
"^DD",52.92,52.92,.05,21,0)
^^1^1^3030728^
"^DD",52.92,52.92,.05,21,1,0)
ADDRESS LINE 1
"^DD",52.92,52.92,.05,"DT")
3030728
"^DD",52.92,52.92,.06,0)
ADDRESS LINE 2^F^^0;6^K:$L(X)>40!($L(X)<1) X
"^DD",52.92,52.92,.06,3)
Answer must be 1-40 characters in length
"^DD",52.92,52.92,.06,21,0)
^^1^1^3030728^
"^DD",52.92,52.92,.06,21,1,0)
ADDRESS LINE 2
"^DD",52.92,52.92,.06,"DT")
3030728
"^DD",52.92,52.92,.07,0)
CITY^F^^0;7^K:$L(X)>30!($L(X)<1) X
"^DD",52.92,52.92,.07,3)
Answer must be 1-30 characters in length
"^DD",52.92,52.92,.07,21,0)
^^1^1^3030728^
"^DD",52.92,52.92,.07,21,1,0)
CITY
"^DD",52.92,52.92,.07,"DT")
3030728
"^DD",52.92,52.92,.08,0)
ZIP CODE^F^^0;8^K:$L(X)>10!($L(X)<5) X
"^DD",52.92,52.92,.08,3)
Answer must be 5-10 characters in length
"^DD",52.92,52.92,.08,21,0)
^^1^1^3030821^
"^DD",52.92,52.92,.08,21,1,0)
ZIP CODE
"^DD",52.92,52.92,.08,"DT")
3030821
"^DD",52.92,52.92,.09,0)
STATE^P5'^DIC(5,^0;9^Q
"^DD",52.92,52.92,.09,21,0)
^^1^1^3030821^
"^DD",52.92,52.92,.09,21,1,0)
The state portion of the institution physical address.
"^DD",52.92,52.92,.09,"DT")
3030821
"^DD",52.92,52.92,1.01,0)
ADDRESS LINE 1 (MAILING)^F^^1;1^K:$L(X)>40!($L(X)<1) X
"^DD",52.92,52.92,1.01,3)
Answer must be 1-40 characters in length
"^DD",52.92,52.92,1.01,21,0)
^^1^1^3030807^
"^DD",52.92,52.92,1.01,21,1,0)
TPB Mailing Address line 1
"^DD",52.92,52.92,1.01,"DT")
3030807
"^DD",52.92,52.92,1.02,0)
ADDRESS LINE 2 (MAILING)^F^^1;2^K:$L(X)>40!($L(X)<1) X
"^DD",52.92,52.92,1.02,3)
Answer must be 1-40 characters in length
"^DD",52.92,52.92,1.02,21,0)
^^1^1^3030807^
"^DD",52.92,52.92,1.02,21,1,0)
TPB Mailing Address line 2
"^DD",52.92,52.92,1.02,"DT")
3030807
"^DD",52.92,52.92,1.03,0)
CITY (MAILING)^F^^1;3^K:$L(X)>40!($L(X)<1) X
"^DD",52.92,52.92,1.03,3)
Answer must be 1-40 characters in length
"^DD",52.92,52.92,1.03,21,0)
^^1^1^3030728^
"^DD",52.92,52.92,1.03,21,1,0)
CITY (MAILING)
"^DD",52.92,52.92,1.03,"DT")
3030728
"^DD",52.92,52.92,1.04,0)
STATE (MAILING)^P5'^DIC(5,^1;4^Q
"^DD",52.92,52.92,1.04,21,0)
^^2^2^3030807^
"^DD",52.92,52.92,1.04,21,1,0)
STATE
"^DD",52.92,52.92,1.04,21,2,0)
For both Physical Address & TPB Mailing Address
"^DD",52.92,52.92,1.04,"DT")
3030821
"^DD",52.92,52.92,1.05,0)
ZIP CODE (MAILING)^F^^1;5^K:$L(X)>10!($L(X)<5) X
"^DD",52.92,52.92,1.05,3)
Answer must be 5-10 characters in length
"^DD",52.92,52.92,1.05,21,0)
^^1^1^3030807^
"^DD",52.92,52.92,1.05,21,1,0)
TPB ZIP CODE for mailing.
"^DD",52.92,52.92,1.05,"DT")
3030807
"^DD",52.92,52.92,2.01,0)
DIRECTORS SIG LINE 1^F^^2;1^K:$L(X)>40!($L(X)<1) X
"^DD",52.92,52.92,2.01,3)
Answer must be 1-40 characters in length
"^DD",52.92,52.92,2.01,21,0)
^^1^1^3030807^
"^DD",52.92,52.92,2.01,21,1,0)
Director Sig Line 1, it is typically the director's name.
"^DD",52.92,52.92,2.01,"DT")
3030807
"^DD",52.92,52.92,2.02,0)
DIRECTORS SIG LINE 2^F^^2;2^K:$L(X)>40!($L(X)<1) X
"^DD",52.92,52.92,2.02,3)
Answer must be 1-40 characters in length
"^DD",52.92,52.92,2.02,21,0)
^^1^1^3030728^
"^DD",52.92,52.92,2.02,21,1,0)
DIRECTORS SIG LINE 2
"^DD",52.92,52.92,2.02,"DT")
3030728
"^DD",52.92,52.92,2.03,0)
DIRECTORS SIG LINE 3^F^^2;3^K:$L(X)>40!($L(X)<1) X
"^DD",52.92,52.92,2.03,3)
Answer must be 1-40 characters in length
"^DD",52.92,52.92,2.03,21,0)
^^1^1^3030728^
"^DD",52.92,52.92,2.03,21,1,0)
DIRECTORS SIG LINE 3
"^DD",52.92,52.92,2.03,"DT")
3030728
"^DIC",52.91,52.91,0)
TPB ELIGIBILITY^52.91
"^DIC",52.91,52.91,0,"GL")
^PS(52.91,
"^DIC",52.91,52.91,"%",0)
^1.005^1^1
"^DIC",52.91,52.91,"%",1,0)
PS
"^DIC",52.91,52.91,"%","B","PS",1)

"^DIC",52.91,52.91,"%D",0)
^1.001^6^6^3030811^^
"^DIC",52.91,52.91,"%D",1,0)
Transitional Pharmacy Benefit Project (TPB), Phase I (patch PSO*7*145) 
"^DIC",52.91,52.91,"%D",2,0)
introduces a new file called TPB ELIGIBILITY file (#52.91), to store 
"^DIC",52.91,52.91,"%D",3,0)
patient data for those who are enrolled in VHA's health care system and 
"^DIC",52.91,52.91,"%D",4,0)
eligible for the pharmacy benefit as required by the Directive, Code of 
"^DIC",52.91,52.91,"%D",5,0)
Federal Regulations (CFR) 38 CFR Part 17 RIN 2900-AL68, "Medication 
"^DIC",52.91,52.91,"%D",6,0)
Prescribed by Non-VA Physicians".
"^DIC",52.91,"B","TPB ELIGIBILITY",52.91)

"^DIC",52.92,52.92,0)
TPB INSTITUTION LETTERS^52.92
"^DIC",52.92,52.92,0,"GL")
^PS(52.92,
"^DIC",52.92,52.92,"%",0)
^1.005^^
"^DIC",52.92,52.92,"%D",0)
^1.001^2^2^3030818^^
"^DIC",52.92,52.92,"%D",1,0)
This file holds the local facility information elements that are to be 
"^DIC",52.92,52.92,"%D",2,0)
used in printing TPB letters to patients.
"^DIC",52.92,"B","TPB INSTITUTION LETTERS",52.92)

**END**
**END**
