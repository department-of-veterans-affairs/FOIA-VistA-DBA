KIDS Distribution saved on Mar 24, 2006@16:56:56
PHASE 3 HIPAA NCPDP V26
**KIDS**:ECME HIPAA NCPDP P3 1.0^BPS*1.0*1^PSO*7.0*148^IB*2.0*276^

**INSTALL NAME**
ECME HIPAA NCPDP P3 1.0
"BLD",6150,0)
ECME HIPAA NCPDP P3 1.0^^1^3060324^y
"BLD",6150,10,0)
^9.63^3^3
"BLD",6150,10,1,0)
BPS*1.0*1^1
"BLD",6150,10,2,0)
PSO*7.0*148^1
"BLD",6150,10,3,0)
IB*2.0*276^1
"BLD",6150,10,"B","BPS*1.0*1",1)

"BLD",6150,10,"B","IB*2.0*276",3)

"BLD",6150,10,"B","PSO*7.0*148",2)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
BPS*1.0*1
"BLD",5906,0)
BPS*1.0*1^E CLAIMS MGMT ENGINE^0^3060324^y
"BLD",5906,1,0)
^^35^35^3060124^
"BLD",5906,1,1,0)
PATCH OVERVIEW
"BLD",5906,1,2,0)
 
"BLD",5906,1,3,0)
The Healthcare Insurance Portability and Accountability Act National
"BLD",5906,1,4,0)
Council for Prescription Drug Programs (HIPAA NCPDP) initiative, whose
"BLD",5906,1,5,0)
ultimate goal is to provide functionality allowing electronic transmission
"BLD",5906,1,6,0)
of Outpatient Pharmacy (OP) prescription claims to payers and the receipt
"BLD",5906,1,7,0)
of claim responses (including drug utilization review responses and
"BLD",5906,1,8,0)
warnings) on a real-time basis, is being developed and introduced in a
"BLD",5906,1,9,0)
phased implementation strategy. This deployment strategy was utilized due
"BLD",5906,1,10,0)
to the complexity of the functionality and the number of product line
"BLD",5906,1,11,0)
dependencies.
"BLD",5906,1,12,0)
 
"BLD",5906,1,13,0)
This is the second part of the Electronic Claims Management Engine (ECME)
"BLD",5906,1,14,0)
package (in the BPS namespace), also known as the active build. It
"BLD",5906,1,15,0)
comprises of these patches: BPS*1*1, PSO*7*148, PSS*1*90, PSX*2*48 and
"BLD",5906,1,16,0)
IB*2*276.
"BLD",5906,1,17,0)
 
"BLD",5906,1,18,0)
This build will introduce functionality supporting Point of Service
"BLD",5906,1,19,0)
Outpatient Pharmacy claim and billing processing by collecting billing and
"BLD",5906,1,20,0)
clinical information within the prescription fill workflow process.  This
"BLD",5906,1,21,0)
build will create real-time electronic claims and send claim data to
"BLD",5906,1,22,0)
adjudicating payers from the new VistA Electronic Claims Management Engine
"BLD",5906,1,23,0)
(ECME) via the VistA HL7 module (using the PSO NCPDP link) to the Vitria
"BLD",5906,1,24,0)
server at the FSC in Austin, TX in a HIPAA compliant (NCPDP V. 5.1)
"BLD",5906,1,25,0)
format. Vitria will then store and forward these transactions to WebMD for
"BLD",5906,1,26,0)
final submission to the payer on a real-time basis. Payer responses will
"BLD",5906,1,27,0)
be received and returned to VistA in the appropriate manner (i.e. - claim
"BLD",5906,1,28,0)
transactions sent to Integrated Billing (IB), Drug Utilization responses
"BLD",5906,1,29,0)
and warnings sent to the Outpatient Pharmacy V. 7.0 package and rejections
"BLD",5906,1,30,0)
made available to the appropriate personnel for review and analysis).
"BLD",5906,1,31,0)
 
"BLD",5906,1,32,0)
Within VistA, throughout this process, constant bi-directional
"BLD",5906,1,33,0)
communication via API's between Outpatient Pharmacy, Integrated Billing,
"BLD",5906,1,34,0)
and ECME will process and generate these claim and billing transactions at
"BLD",5906,1,35,0)
the appropriate trigger points within the standard VA process workflow.
"BLD",5906,4,0)
^9.64PA^9002313.55^54
"BLD",5906,4,9002313.02,0)
9002313.02
"BLD",5906,4,9002313.02,222)
y^y^f^^^^n
"BLD",5906,4,9002313.03,0)
9002313.03
"BLD",5906,4,9002313.03,222)
y^y^f^^^^n
"BLD",5906,4,9002313.1,0)
9002313.1
"BLD",5906,4,9002313.1,222)
y^y^f^^^^n
"BLD",5906,4,9002313.21,0)
9002313.21
"BLD",5906,4,9002313.21,222)
y^y^f^^n^^y^o^n
"BLD",5906,4,9002313.22,0)
9002313.22
"BLD",5906,4,9002313.22,222)
y^y^f^^n^^y^o^n
"BLD",5906,4,9002313.23,0)
9002313.23
"BLD",5906,4,9002313.23,222)
y^y^f^^n^^y^o^n
"BLD",5906,4,9002313.24,0)
9002313.24
"BLD",5906,4,9002313.24,222)
y^y^f^^n^^y^o^n
"BLD",5906,4,9002313.31,0)
9002313.31
"BLD",5906,4,9002313.31,222)
y^y^f^^^^n
"BLD",5906,4,9002313.4,0)
9002313.4
"BLD",5906,4,9002313.4,222)
y^y^f^^^^n
"BLD",5906,4,9002313.51,0)
9002313.51
"BLD",5906,4,9002313.51,222)
y^y^f^^^^n
"BLD",5906,4,9002313.511,0)
9002313.511
"BLD",5906,4,9002313.511,222)
y^y^f^^^^n
"BLD",5906,4,9002313.515,0)
9002313.515
"BLD",5906,4,9002313.515,222)
y^y^f^^^^n
"BLD",5906,4,9002313.516,0)
9002313.516
"BLD",5906,4,9002313.516,222)
y^y^f^^n^^y^o^n
"BLD",5906,4,9002313.53,0)
9002313.53
"BLD",5906,4,9002313.53,222)
y^y^f^^^^n
"BLD",5906,4,9002313.55,0)
9002313.55
"BLD",5906,4,9002313.55,222)
y^y^f^^^^n
"BLD",5906,4,9002313.56,0)
9002313.56
"BLD",5906,4,9002313.56,222)
y^y^f^^^^n
"BLD",5906,4,9002313.57,0)
9002313.57
"BLD",5906,4,9002313.57,222)
y^y^f^^^^n
"BLD",5906,4,9002313.58,0)
9002313.58
"BLD",5906,4,9002313.58,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.58,224)

"BLD",5906,4,9002313.59,0)
9002313.59
"BLD",5906,4,9002313.59,222)
y^y^f^^^^n
"BLD",5906,4,9002313.61,0)
9002313.61
"BLD",5906,4,9002313.61,222)
y^y^f^^^^n
"BLD",5906,4,9002313.81,0)
9002313.81
"BLD",5906,4,9002313.81,222)
y^y^f^^n^^y^o^n
"BLD",5906,4,9002313.82103,0)
9002313.82103
"BLD",5906,4,9002313.82103,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82103,224)

"BLD",5906,4,9002313.82305,0)
9002313.82305
"BLD",5906,4,9002313.82305,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82305,224)

"BLD",5906,4,9002313.82306,0)
9002313.82306
"BLD",5906,4,9002313.82306,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82306,224)

"BLD",5906,4,9002313.82307,0)
9002313.82307
"BLD",5906,4,9002313.82307,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82307,224)

"BLD",5906,4,9002313.82308,0)
9002313.82308
"BLD",5906,4,9002313.82308,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82308,224)

"BLD",5906,4,9002313.82309,0)
9002313.82309
"BLD",5906,4,9002313.82309,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82309,224)

"BLD",5906,4,9002313.82406,0)
9002313.82406
"BLD",5906,4,9002313.82406,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82406,224)

"BLD",5906,4,9002313.82408,0)
9002313.82408
"BLD",5906,4,9002313.82408,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82408,224)

"BLD",5906,4,9002313.82416,0)
9002313.82416
"BLD",5906,4,9002313.82416,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82416,224)

"BLD",5906,4,9002313.82419,0)
9002313.82419
"BLD",5906,4,9002313.82419,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82419,224)

"BLD",5906,4,9002313.8242,0)
9002313.8242
"BLD",5906,4,9002313.8242,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.8242,224)

"BLD",5906,4,9002313.82423,0)
9002313.82423
"BLD",5906,4,9002313.82423,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82423,224)

"BLD",5906,4,9002313.82425,0)
9002313.82425
"BLD",5906,4,9002313.82425,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82425,224)

"BLD",5906,4,9002313.82429,0)
9002313.82429
"BLD",5906,4,9002313.82429,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82429,224)

"BLD",5906,4,9002313.82432,0)
9002313.82432
"BLD",5906,4,9002313.82432,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82432,224)

"BLD",5906,4,9002313.82436,0)
9002313.82436
"BLD",5906,4,9002313.82436,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82436,224)

"BLD",5906,4,9002313.82439,0)
9002313.82439
"BLD",5906,4,9002313.82439,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82439,224)

"BLD",5906,4,9002313.8244,0)
9002313.8244
"BLD",5906,4,9002313.8244,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.8244,224)

"BLD",5906,4,9002313.82441,0)
9002313.82441
"BLD",5906,4,9002313.82441,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82441,224)

"BLD",5906,4,9002313.82501,0)
9002313.82501
"BLD",5906,4,9002313.82501,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82501,224)

"BLD",5906,4,9002313.82522,0)
9002313.82522
"BLD",5906,4,9002313.82522,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82522,224)

"BLD",5906,4,9002313.82528,0)
9002313.82528
"BLD",5906,4,9002313.82528,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82528,224)

"BLD",5906,4,9002313.82529,0)
9002313.82529
"BLD",5906,4,9002313.82529,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82529,224)

"BLD",5906,4,9002313.82532,0)
9002313.82532
"BLD",5906,4,9002313.82532,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82532,224)

"BLD",5906,4,9002313.82533,0)
9002313.82533
"BLD",5906,4,9002313.82533,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82533,224)

"BLD",5906,4,9002313.82535,0)
9002313.82535
"BLD",5906,4,9002313.82535,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.82535,224)

"BLD",5906,4,9002313.83,0)
9002313.83
"BLD",5906,4,9002313.83,222)
y^y^f^^n^^y^o^n
"BLD",5906,4,9002313.89,0)
9002313.89
"BLD",5906,4,9002313.89,222)
y^y^f^^n^^y^o^n
"BLD",5906,4,9002313.91,0)
9002313.91
"BLD",5906,4,9002313.91,222)
y^y^f^^n^^y^o^n
"BLD",5906,4,9002313.91,224)

"BLD",5906,4,9002313.92,0)
9002313.92
"BLD",5906,4,9002313.92,222)
y^y^f^^^^n^^
"BLD",5906,4,9002313.92,224)

"BLD",5906,4,9002313.93,0)
9002313.93
"BLD",5906,4,9002313.93,222)
y^y^f^^n^^y^o^n
"BLD",5906,4,9002313.93,224)

"BLD",5906,4,9002313.94,0)
9002313.94
"BLD",5906,4,9002313.94,222)
y^y^f^^^^n
"BLD",5906,4,9002313.99,0)
9002313.99
"BLD",5906,4,9002313.99,222)
y^n^f^^^^n^^
"BLD",5906,4,9002313.99,224)

"BLD",5906,4,"B",9002313.02,9002313.02)

"BLD",5906,4,"B",9002313.03,9002313.03)

"BLD",5906,4,"B",9002313.1,9002313.1)

"BLD",5906,4,"B",9002313.21,9002313.21)

"BLD",5906,4,"B",9002313.22,9002313.22)

"BLD",5906,4,"B",9002313.23,9002313.23)

"BLD",5906,4,"B",9002313.24,9002313.24)

"BLD",5906,4,"B",9002313.31,9002313.31)

"BLD",5906,4,"B",9002313.4,9002313.4)

"BLD",5906,4,"B",9002313.51,9002313.51)

"BLD",5906,4,"B",9002313.511,9002313.511)

"BLD",5906,4,"B",9002313.515,9002313.515)

"BLD",5906,4,"B",9002313.516,9002313.516)

"BLD",5906,4,"B",9002313.53,9002313.53)

"BLD",5906,4,"B",9002313.55,9002313.55)

"BLD",5906,4,"B",9002313.56,9002313.56)

"BLD",5906,4,"B",9002313.57,9002313.57)

"BLD",5906,4,"B",9002313.58,9002313.58)

"BLD",5906,4,"B",9002313.59,9002313.59)

"BLD",5906,4,"B",9002313.61,9002313.61)

"BLD",5906,4,"B",9002313.81,9002313.81)

"BLD",5906,4,"B",9002313.82103,9002313.82103)

"BLD",5906,4,"B",9002313.82305,9002313.82305)

"BLD",5906,4,"B",9002313.82306,9002313.82306)

"BLD",5906,4,"B",9002313.82307,9002313.82307)

"BLD",5906,4,"B",9002313.82308,9002313.82308)

"BLD",5906,4,"B",9002313.82309,9002313.82309)

"BLD",5906,4,"B",9002313.82406,9002313.82406)

"BLD",5906,4,"B",9002313.82408,9002313.82408)

"BLD",5906,4,"B",9002313.82416,9002313.82416)

"BLD",5906,4,"B",9002313.82419,9002313.82419)

"BLD",5906,4,"B",9002313.8242,9002313.8242)

"BLD",5906,4,"B",9002313.82423,9002313.82423)

"BLD",5906,4,"B",9002313.82425,9002313.82425)

"BLD",5906,4,"B",9002313.82429,9002313.82429)

"BLD",5906,4,"B",9002313.82432,9002313.82432)

"BLD",5906,4,"B",9002313.82436,9002313.82436)

"BLD",5906,4,"B",9002313.82439,9002313.82439)

"BLD",5906,4,"B",9002313.8244,9002313.8244)

"BLD",5906,4,"B",9002313.82441,9002313.82441)

"BLD",5906,4,"B",9002313.82501,9002313.82501)

"BLD",5906,4,"B",9002313.82522,9002313.82522)

"BLD",5906,4,"B",9002313.82528,9002313.82528)

"BLD",5906,4,"B",9002313.82529,9002313.82529)

"BLD",5906,4,"B",9002313.82532,9002313.82532)

"BLD",5906,4,"B",9002313.82533,9002313.82533)

"BLD",5906,4,"B",9002313.82535,9002313.82535)

"BLD",5906,4,"B",9002313.83,9002313.83)

"BLD",5906,4,"B",9002313.89,9002313.89)

"BLD",5906,4,"B",9002313.91,9002313.91)

"BLD",5906,4,"B",9002313.92,9002313.92)

"BLD",5906,4,"B",9002313.93,9002313.93)

"BLD",5906,4,"B",9002313.94,9002313.94)

"BLD",5906,4,"B",9002313.99,9002313.99)

"BLD",5906,10,0)
^9.63^1^1
"BLD",5906,10,1,0)
BPS*1.0*1
"BLD",5906,10,"B","BPS*1.0*1",1)

"BLD",5906,"ABNS",0)
^9.66A^^
"BLD",5906,"ABPKG")
n^n
"BLD",5906,"INI")
EN^BPS01P1
"BLD",5906,"INID")
^n^n
"BLD",5906,"INIT")
EN^BPS03P1
"BLD",5906,"KRN",0)
^9.67PA^8989.52^19
"BLD",5906,"KRN",.4,0)
.4
"BLD",5906,"KRN",.4,"NM",0)
^9.68A^31^31
"BLD",5906,"KRN",.4,"NM",1,0)
BPS CAPTURED DETAIL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",2,0)
BPS CLOSED CLAIMS    FILE #9002313.02^9002313.02^1^
"BLD",5906,"KRN",.4,"NM",3,0)
BPS CLOSED CLAIMS DETAIL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",4,0)
BPS DUPLICATE DETAIL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",5,0)
BPS FORMATS    FILE #9002313.92^9002313.92^1^
"BLD",5906,"KRN",.4,"NM",6,0)
BPS GRACE    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.4,"NM",7,0)
BPS INSURANCE RULES AVAIL    FILE #9002313.94^9002313.94^0
"BLD",5906,"KRN",.4,"NM",8,0)
BPS INSURANCE RULES IN-USE    FILE #9002313.99^9002313.99^0
"BLD",5906,"KRN",.4,"NM",9,0)
BPS INSURERS    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.4,"NM",10,0)
BPS MISSED PRESCRIPTIONS    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",11,0)
BPS NCPDP    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.4,"NM",12,0)
BPS NCPDP FIELDS    FILE #9002313.91^9002313.91^1^
"BLD",5906,"KRN",.4,"NM",13,0)
BPS PAPER DETAIL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",14,0)
BPS PAYABLE DETAIL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",15,0)
BPS PREBILL    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.4,"NM",16,0)
BPS PRICING TABLES    FILE #9002313.53^9002313.53^0
"BLD",5906,"KRN",.4,"NM",17,0)
BPS RECENT TRANSACTIONS    FILE #9002313.57^9002313.57^1^
"BLD",5906,"KRN",.4,"NM",18,0)
BPS REJECTION DETAIL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",19,0)
BPS RPT MISSED HEADER    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",20,0)
BPS RPT NEED REVERSAL DETAIL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",21,0)
BPS RPT NEED REVERSAL HEADER    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",22,0)
BPS RPT TOTALS DETAIL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",23,0)
BPS RPT TOTALS HEADER    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",24,0)
BPS STRANDED CLAIMS    FILE #9002313.59^9002313.59^1^
"BLD",5906,"KRN",.4,"NM",25,0)
BPS TECH - FILES    FILE #1^1^0
"BLD",5906,"KRN",.4,"NM",26,0)
BPS TECH - OPTIONS    FILE #19^19^0
"BLD",5906,"KRN",.4,"NM",27,0)
BPS UN/BILLABLE    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.4,"NM",28,0)
BPS UNINSURED DETAIL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM",29,0)
BPS USER PREFERENCES    FILE #9002313.515^9002313.515^0
"BLD",5906,"KRN",.4,"NM",30,0)
BPS WORKERS COMP    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.4,"NM",31,0)
BPS NOTREL DETAIL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.4,"NM","B","BPS CAPTURED DETAIL    FILE #9002313.61",1)

"BLD",5906,"KRN",.4,"NM","B","BPS CLOSED CLAIMS    FILE #9002313.02",2)

"BLD",5906,"KRN",.4,"NM","B","BPS CLOSED CLAIMS DETAIL    FILE #9002313.61",3)

"BLD",5906,"KRN",.4,"NM","B","BPS DUPLICATE DETAIL    FILE #9002313.61",4)

"BLD",5906,"KRN",.4,"NM","B","BPS FORMATS    FILE #9002313.92",5)

"BLD",5906,"KRN",.4,"NM","B","BPS GRACE    FILE #9002313.4",6)

"BLD",5906,"KRN",.4,"NM","B","BPS INSURANCE RULES AVAIL    FILE #9002313.94",7)

"BLD",5906,"KRN",.4,"NM","B","BPS INSURANCE RULES IN-USE    FILE #9002313.99",8)

"BLD",5906,"KRN",.4,"NM","B","BPS INSURERS    FILE #9002313.4",9)

"BLD",5906,"KRN",.4,"NM","B","BPS MISSED PRESCRIPTIONS    FILE #9002313.61",10)

"BLD",5906,"KRN",.4,"NM","B","BPS NCPDP    FILE #9002313.4",11)

"BLD",5906,"KRN",.4,"NM","B","BPS NCPDP FIELDS    FILE #9002313.91",12)

"BLD",5906,"KRN",.4,"NM","B","BPS NOTREL DETAIL    FILE #9002313.61",31)

"BLD",5906,"KRN",.4,"NM","B","BPS PAPER DETAIL    FILE #9002313.61",13)

"BLD",5906,"KRN",.4,"NM","B","BPS PAYABLE DETAIL    FILE #9002313.61",14)

"BLD",5906,"KRN",.4,"NM","B","BPS PREBILL    FILE #9002313.4",15)

"BLD",5906,"KRN",.4,"NM","B","BPS PRICING TABLES    FILE #9002313.53",16)

"BLD",5906,"KRN",.4,"NM","B","BPS RECENT TRANSACTIONS    FILE #9002313.57",17)

"BLD",5906,"KRN",.4,"NM","B","BPS REJECTION DETAIL    FILE #9002313.61",18)

"BLD",5906,"KRN",.4,"NM","B","BPS RPT MISSED HEADER    FILE #9002313.61",19)

"BLD",5906,"KRN",.4,"NM","B","BPS RPT NEED REVERSAL DETAIL    FILE #9002313.61",20)

"BLD",5906,"KRN",.4,"NM","B","BPS RPT NEED REVERSAL HEADER    FILE #9002313.61",21)

"BLD",5906,"KRN",.4,"NM","B","BPS RPT TOTALS DETAIL    FILE #9002313.61",22)

"BLD",5906,"KRN",.4,"NM","B","BPS RPT TOTALS HEADER    FILE #9002313.61",23)

"BLD",5906,"KRN",.4,"NM","B","BPS STRANDED CLAIMS    FILE #9002313.59",24)

"BLD",5906,"KRN",.4,"NM","B","BPS TECH - FILES    FILE #1",25)

"BLD",5906,"KRN",.4,"NM","B","BPS TECH - OPTIONS    FILE #19",26)

"BLD",5906,"KRN",.4,"NM","B","BPS UN/BILLABLE    FILE #9002313.4",27)

"BLD",5906,"KRN",.4,"NM","B","BPS UNINSURED DETAIL    FILE #9002313.61",28)

"BLD",5906,"KRN",.4,"NM","B","BPS USER PREFERENCES    FILE #9002313.515",29)

"BLD",5906,"KRN",.4,"NM","B","BPS WORKERS COMP    FILE #9002313.4",30)

"BLD",5906,"KRN",.401,0)
.401
"BLD",5906,"KRN",.401,"NM",0)
^9.68A^43^43
"BLD",5906,"KRN",.401,"NM",1,0)
BPS TECH - FILES    FILE #1^1^0
"BLD",5906,"KRN",.401,"NM",2,0)
BPS CAPTURED    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",3,0)
BPS DUPLICATE    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",4,0)
BPS FORMATS    FILE #9002313.92^9002313.92^1^
"BLD",5906,"KRN",.401,"NM",5,0)
BPS GRACE    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.401,"NM",6,0)
BPS INSURANCE RULES AVAIL    FILE #9002313.94^9002313.94^0
"BLD",5906,"KRN",.401,"NM",7,0)
BPS INSURANCE RULES IN-USE    FILE #9002313.99^9002313.99^0
"BLD",5906,"KRN",.401,"NM",8,0)
BPS INSURERS    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.401,"NM",9,0)
BPS MISSED PRESCRIPTIONS    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",10,0)
BPS NCPDP    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.401,"NM",11,0)
BPS NCPDP FIELDS    FILE #9002313.91^9002313.91^1^
"BLD",5906,"KRN",.401,"NM",12,0)
BPS NEED REVERSAL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",13,0)
BPS NOT REL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",14,0)
BPS PAPER    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",15,0)
BPS PAY FILL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",16,0)
BPS PAY ISSUE    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",17,0)
BPS PAY LABEL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",18,0)
BPS PAY REL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",19,0)
BPS PAY TRAN    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",20,0)
BPS PAYABLE    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",21,0)
BPS PREBILL    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.401,"NM",22,0)
BPS PRICING TABLES    FILE #9002313.53^9002313.53^0
"BLD",5906,"KRN",.401,"NM",23,0)
BPS RECENT TRANSACTIONS    FILE #9002313.57^9002313.57^1^
"BLD",5906,"KRN",.401,"NM",24,0)
BPS REJ FILL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",25,0)
BPS REJ ISSUE    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",26,0)
BPS REJ LABEL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",27,0)
BPS REJ REL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",28,0)
BPS REJ TRANS    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",29,0)
BPS REJECTION    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",30,0)
BPS REV FILL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",31,0)
BPS REV ISSUE    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",32,0)
BPS REV LABEL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",33,0)
BPS REV REL    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",34,0)
BPS REV TRAN    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",35,0)
BPS SETUP PHARMACIES    FILE #9002313.56^9002313.56^0
"BLD",5906,"KRN",.401,"NM",36,0)
BPS STRANDED CLAIMS    FILE #9002313.59^9002313.59^1^
"BLD",5906,"KRN",.401,"NM",37,0)
BPS TECH - OPTIONS    FILE #19^19^0
"BLD",5906,"KRN",.401,"NM",38,0)
BPS TOTALS BY DAY    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",39,0)
BPS TOTALS BY INSURER    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",40,0)
BPS UN/BILLABLE    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.401,"NM",41,0)
BPS UNINSURED    FILE #9002313.61^9002313.61^1^
"BLD",5906,"KRN",.401,"NM",42,0)
BPS USER PREFERENCES    FILE #9002313.515^9002313.515^0
"BLD",5906,"KRN",.401,"NM",43,0)
BPS WORKERS COMP    FILE #9002313.4^9002313.4^0
"BLD",5906,"KRN",.401,"NM","B","BPS CAPTURED    FILE #9002313.61",2)

"BLD",5906,"KRN",.401,"NM","B","BPS DUPLICATE    FILE #9002313.61",3)

"BLD",5906,"KRN",.401,"NM","B","BPS FORMATS    FILE #9002313.92",4)

"BLD",5906,"KRN",.401,"NM","B","BPS GRACE    FILE #9002313.4",5)

"BLD",5906,"KRN",.401,"NM","B","BPS INSURANCE RULES AVAIL    FILE #9002313.94",6)

"BLD",5906,"KRN",.401,"NM","B","BPS INSURANCE RULES IN-USE    FILE #9002313.99",7)

"BLD",5906,"KRN",.401,"NM","B","BPS INSURERS    FILE #9002313.4",8)

"BLD",5906,"KRN",.401,"NM","B","BPS MISSED PRESCRIPTIONS    FILE #9002313.61",9)

"BLD",5906,"KRN",.401,"NM","B","BPS NCPDP    FILE #9002313.4",10)

"BLD",5906,"KRN",.401,"NM","B","BPS NCPDP FIELDS    FILE #9002313.91",11)

"BLD",5906,"KRN",.401,"NM","B","BPS NEED REVERSAL    FILE #9002313.61",12)

"BLD",5906,"KRN",.401,"NM","B","BPS NOT REL    FILE #9002313.61",13)

"BLD",5906,"KRN",.401,"NM","B","BPS PAPER    FILE #9002313.61",14)

"BLD",5906,"KRN",.401,"NM","B","BPS PAY FILL    FILE #9002313.61",15)

"BLD",5906,"KRN",.401,"NM","B","BPS PAY ISSUE    FILE #9002313.61",16)

"BLD",5906,"KRN",.401,"NM","B","BPS PAY LABEL    FILE #9002313.61",17)

"BLD",5906,"KRN",.401,"NM","B","BPS PAY REL    FILE #9002313.61",18)

"BLD",5906,"KRN",.401,"NM","B","BPS PAY TRAN    FILE #9002313.61",19)

"BLD",5906,"KRN",.401,"NM","B","BPS PAYABLE    FILE #9002313.61",20)

"BLD",5906,"KRN",.401,"NM","B","BPS PREBILL    FILE #9002313.4",21)

"BLD",5906,"KRN",.401,"NM","B","BPS PRICING TABLES    FILE #9002313.53",22)

"BLD",5906,"KRN",.401,"NM","B","BPS RECENT TRANSACTIONS    FILE #9002313.57",23)

"BLD",5906,"KRN",.401,"NM","B","BPS REJ FILL    FILE #9002313.61",24)

"BLD",5906,"KRN",.401,"NM","B","BPS REJ ISSUE    FILE #9002313.61",25)

"BLD",5906,"KRN",.401,"NM","B","BPS REJ LABEL    FILE #9002313.61",26)

"BLD",5906,"KRN",.401,"NM","B","BPS REJ REL    FILE #9002313.61",27)

"BLD",5906,"KRN",.401,"NM","B","BPS REJ TRANS    FILE #9002313.61",28)

"BLD",5906,"KRN",.401,"NM","B","BPS REJECTION    FILE #9002313.61",29)

"BLD",5906,"KRN",.401,"NM","B","BPS REV FILL    FILE #9002313.61",30)

"BLD",5906,"KRN",.401,"NM","B","BPS REV ISSUE    FILE #9002313.61",31)

"BLD",5906,"KRN",.401,"NM","B","BPS REV LABEL    FILE #9002313.61",32)

"BLD",5906,"KRN",.401,"NM","B","BPS REV REL    FILE #9002313.61",33)

"BLD",5906,"KRN",.401,"NM","B","BPS REV TRAN    FILE #9002313.61",34)

"BLD",5906,"KRN",.401,"NM","B","BPS SETUP PHARMACIES    FILE #9002313.56",35)

"BLD",5906,"KRN",.401,"NM","B","BPS STRANDED CLAIMS    FILE #9002313.59",36)

"BLD",5906,"KRN",.401,"NM","B","BPS TECH - FILES    FILE #1",1)

"BLD",5906,"KRN",.401,"NM","B","BPS TECH - OPTIONS    FILE #19",37)

"BLD",5906,"KRN",.401,"NM","B","BPS TOTALS BY DAY    FILE #9002313.61",38)

"BLD",5906,"KRN",.401,"NM","B","BPS TOTALS BY INSURER    FILE #9002313.61",39)

"BLD",5906,"KRN",.401,"NM","B","BPS UN/BILLABLE    FILE #9002313.4",40)

"BLD",5906,"KRN",.401,"NM","B","BPS UNINSURED    FILE #9002313.61",41)

"BLD",5906,"KRN",.401,"NM","B","BPS USER PREFERENCES    FILE #9002313.515",42)

"BLD",5906,"KRN",.401,"NM","B","BPS WORKERS COMP    FILE #9002313.4",43)

"BLD",5906,"KRN",.402,0)
.402
"BLD",5906,"KRN",.402,"NM",0)
^9.68A^18^17
"BLD",5906,"KRN",.402,"NM",1,0)
BPS SETUP ILC AR    FILE #9002313.99^9002313.99^1^
"BLD",5906,"KRN",.402,"NM",2,0)
BPS NCPDP FORMATS    FILE #9002313.92^9002313.92^1^
"BLD",5906,"KRN",.402,"NM",3,0)
BPS NCPDP FORMATS EDIT    FILE #9002313.92^9002313.92^1^
"BLD",5906,"KRN",.402,"NM",4,0)
BPS PROVIDER #S    FILE #200^200^1^
"BLD",5906,"KRN",.402,"NM",5,0)
BPS SETUP INSURER    FILE #9002313.4^9002313.4^1^
"BLD",5906,"KRN",.402,"NM",6,0)
BPS SETUP INSURER QUICK    FILE #9002313.4^9002313.4^1^
"BLD",5906,"KRN",.402,"NM",7,0)
BPS SETUP OKLA. MEDICAID    FILE #9002313.99^9002313.99^1^
"BLD",5906,"KRN",.402,"NM",8,0)
BPS SETUP PART 1    FILE #9002313.99^9002313.99^1^
"BLD",5906,"KRN",.402,"NM",10,0)
BPS SETUP PRICING    FILE #9002313.53^9002313.53^1^
"BLD",5906,"KRN",.402,"NM",11,0)
BPS SETUP USERS    FILE #9002313.515^9002313.515^1^
"BLD",5906,"KRN",.402,"NM",12,0)
BPSJ ALT CONTACT ENTER/EDIT    FILE #9002313.99^9002313.99^0
"BLD",5906,"KRN",.402,"NM",13,0)
BPSJ CONTACT ENTER/EDIT    FILE #9002313.99^9002313.99^0
"BLD",5906,"KRN",.402,"NM",14,0)
BPSJ PHARM ALT CONT ENTER/EDIT    FILE #9002313.56^9002313.56^0
"BLD",5906,"KRN",.402,"NM",15,0)
BPSJ PHARM CONTACT ENTER/EDIT    FILE #9002313.56^9002313.56^0
"BLD",5906,"KRN",.402,"NM",16,0)
BPSJ PHARMACIST ENTER/EDIT    FILE #9002313.56^9002313.56^0
"BLD",5906,"KRN",.402,"NM",17,0)
BPSJ PHARMACY SITE ENTER/EDIT    FILE #9002313.56^9002313.56^0
"BLD",5906,"KRN",.402,"NM",18,0)
BPS SETUP PHARMACY    FILE #9002313.56^9002313.56^1^
"BLD",5906,"KRN",.402,"NM","B","BPS NCPDP FORMATS    FILE #9002313.92",2)

"BLD",5906,"KRN",.402,"NM","B","BPS NCPDP FORMATS EDIT    FILE #9002313.92",3)

"BLD",5906,"KRN",.402,"NM","B","BPS PROVIDER #S    FILE #200",4)

"BLD",5906,"KRN",.402,"NM","B","BPS SETUP ILC AR    FILE #9002313.99",1)

"BLD",5906,"KRN",.402,"NM","B","BPS SETUP INSURER    FILE #9002313.4",5)

"BLD",5906,"KRN",.402,"NM","B","BPS SETUP INSURER QUICK    FILE #9002313.4",6)

"BLD",5906,"KRN",.402,"NM","B","BPS SETUP OKLA. MEDICAID    FILE #9002313.99",7)

"BLD",5906,"KRN",.402,"NM","B","BPS SETUP PART 1    FILE #9002313.99",8)

"BLD",5906,"KRN",.402,"NM","B","BPS SETUP PHARMACY    FILE #9002313.56",18)

"BLD",5906,"KRN",.402,"NM","B","BPS SETUP PRICING    FILE #9002313.53",10)

"BLD",5906,"KRN",.402,"NM","B","BPS SETUP USERS    FILE #9002313.515",11)

"BLD",5906,"KRN",.402,"NM","B","BPSJ ALT CONTACT ENTER/EDIT    FILE #9002313.99",12)

"BLD",5906,"KRN",.402,"NM","B","BPSJ CONTACT ENTER/EDIT    FILE #9002313.99",13)

"BLD",5906,"KRN",.402,"NM","B","BPSJ PHARM ALT CONT ENTER/EDIT    FILE #9002313.56",14)

"BLD",5906,"KRN",.402,"NM","B","BPSJ PHARM CONTACT ENTER/EDIT    FILE #9002313.56",15)

"BLD",5906,"KRN",.402,"NM","B","BPSJ PHARMACIST ENTER/EDIT    FILE #9002313.56",16)

"BLD",5906,"KRN",.402,"NM","B","BPSJ PHARMACY SITE ENTER/EDIT    FILE #9002313.56",17)

"BLD",5906,"KRN",.403,0)
.403
"BLD",5906,"KRN",.403,"NM",0)
^9.68A^3^3
"BLD",5906,"KRN",.403,"NM",1,0)
BPS BPSOSPW    FILE #9002313.99^9002313.99^0
"BLD",5906,"KRN",.403,"NM",2,0)
BPS EOB TO BATCH    FILE #9002313.99^9002313.99^0
"BLD",5906,"KRN",.403,"NM",3,0)
BPS INPUT 1    FILE #9002313.51^9002313.51^0
"BLD",5906,"KRN",.403,"NM","B","BPS BPSOSPW    FILE #9002313.99",1)

"BLD",5906,"KRN",.403,"NM","B","BPS EOB TO BATCH    FILE #9002313.99",2)

"BLD",5906,"KRN",.403,"NM","B","BPS INPUT 1    FILE #9002313.51",3)

"BLD",5906,"KRN",.5,0)
.5
"BLD",5906,"KRN",.5,"NM",0)
^9.68A^^
"BLD",5906,"KRN",.84,0)
.84
"BLD",5906,"KRN",.84,"NM",0)
^9.68A^^
"BLD",5906,"KRN",3.6,0)
3.6
"BLD",5906,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",5906,"KRN",3.8,0)
3.8
"BLD",5906,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",5906,"KRN",3.8,"NM",1,0)
BPS OPECC^^0
"BLD",5906,"KRN",3.8,"NM","B","BPS OPECC",1)

"BLD",5906,"KRN",9.2,0)
9.2
"BLD",5906,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",5906,"KRN",9.8,0)
9.8
"BLD",5906,"KRN",9.8,"NM",0)
^9.68A^366^277
"BLD",5906,"KRN",9.8,"NM",1,0)
BPSECA1^^0^B29804568
"BLD",5906,"KRN",9.8,"NM",2,0)
BPSECA2^^0^B2797712
"BLD",5906,"KRN",9.8,"NM",3,0)
BPSECA4^^0^B43655666
"BLD",5906,"KRN",9.8,"NM",4,0)
BPSECA5^^0^B15883904
"BLD",5906,"KRN",9.8,"NM",5,0)
BPSECA7^^0^B1668171
"BLD",5906,"KRN",9.8,"NM",6,0)
BPSECA8^^0^B12130364
"BLD",5906,"KRN",9.8,"NM",7,0)
BPSECA9^^1^
"BLD",5906,"KRN",9.8,"NM",8,0)
BPSECFM^^0^B10623995
"BLD",5906,"KRN",9.8,"NM",9,0)
BPSECMC2^^0^B13730407
"BLD",5906,"KRN",9.8,"NM",10,0)
BPSECMP2^^0^B63501643
"BLD",5906,"KRN",9.8,"NM",11,0)
BPSECMPS^^0^B68357125
"BLD",5906,"KRN",9.8,"NM",12,0)
BPSECP0^^1^
"BLD",5906,"KRN",9.8,"NM",13,0)
BPSECP1^^0^B44213854
"BLD",5906,"KRN",9.8,"NM",14,0)
BPSECP2^^0^B12368584
"BLD",5906,"KRN",9.8,"NM",15,0)
BPSECP3^^1^
"BLD",5906,"KRN",9.8,"NM",16,0)
BPSECR0^^1^
"BLD",5906,"KRN",9.8,"NM",17,0)
BPSECR1^^1^
"BLD",5906,"KRN",9.8,"NM",18,0)
BPSECR2^^1^
"BLD",5906,"KRN",9.8,"NM",19,0)
BPSECX0^^0^B3953562
"BLD",5906,"KRN",9.8,"NM",20,0)
BPSECX1^^0^B16923293
"BLD",5906,"KRN",9.8,"NM",21,0)
BPSECX4^^0^B1898595
"BLD",5906,"KRN",9.8,"NM",23,0)
BPSECZ3^^1^
"BLD",5906,"KRN",9.8,"NM",24,0)
BPSECZA^^1^
"BLD",5906,"KRN",9.8,"NM",26,0)
BPSER1A^^1^
"BLD",5906,"KRN",9.8,"NM",28,0)
BPSER2A^^1^
"BLD",5906,"KRN",9.8,"NM",30,0)
BPSER3A^^1^
"BLD",5906,"KRN",9.8,"NM",32,0)
BPSER4A^^1^
"BLD",5906,"KRN",9.8,"NM",33,0)
BPSES00^^1^
"BLD",5906,"KRN",9.8,"NM",58,0)
BPSNCPD1^^0^B29379701
"BLD",5906,"KRN",9.8,"NM",59,0)
BPSNCPD2^^0^B26007614
"BLD",5906,"KRN",9.8,"NM",60,0)
BPSNCPD3^^0^B55349508
"BLD",5906,"KRN",9.8,"NM",61,0)
BPSNCPDP^^0^B69936802
"BLD",5906,"KRN",9.8,"NM",62,0)
BPSOS^^0^B4457405
"BLD",5906,"KRN",9.8,"NM",63,0)
BPSOS02^^1^
"BLD",5906,"KRN",9.8,"NM",64,0)
BPSOS03^^0^B11124821
"BLD",5906,"KRN",9.8,"NM",65,0)
BPSOS2^^0^B24595196
"BLD",5906,"KRN",9.8,"NM",66,0)
BPSOS25^^0^B36446376
"BLD",5906,"KRN",9.8,"NM",69,0)
BPSOS29^^0^B7729677
"BLD",5906,"KRN",9.8,"NM",70,0)
BPSOS2A^^0^B12848144
"BLD",5906,"KRN",9.8,"NM",71,0)
BPSOS2B^^0^B50884943
"BLD",5906,"KRN",9.8,"NM",72,0)
BPSOS2C^^0^B18253372
"BLD",5906,"KRN",9.8,"NM",73,0)
BPSOS2D^^0^B2361443
"BLD",5906,"KRN",9.8,"NM",74,0)
BPSOS2E^^1^
"BLD",5906,"KRN",9.8,"NM",75,0)
BPSOS2F^^1^
"BLD",5906,"KRN",9.8,"NM",81,0)
BPSOS57^^0^B44320306
"BLD",5906,"KRN",9.8,"NM",83,0)
BPSOS6B^^0^B34650501
"BLD",5906,"KRN",9.8,"NM",84,0)
BPSOS6C^^0^B11172604
"BLD",5906,"KRN",9.8,"NM",85,0)
BPSOS6D^^0^B78255184
"BLD",5906,"KRN",9.8,"NM",86,0)
BPSOS6E^^0^B4297708
"BLD",5906,"KRN",9.8,"NM",87,0)
BPSOS6F^^0^B1605129
"BLD",5906,"KRN",9.8,"NM",88,0)
BPSOS6G^^0^B913136
"BLD",5906,"KRN",9.8,"NM",89,0)
BPSOS6H^^0^B11933721
"BLD",5906,"KRN",9.8,"NM",90,0)
BPSOS6I^^0^B73218359
"BLD",5906,"KRN",9.8,"NM",91,0)
BPSOS6J^^0^B13752580
"BLD",5906,"KRN",9.8,"NM",92,0)
BPSOS6K^^1^
"BLD",5906,"KRN",9.8,"NM",93,0)
BPSOS6L^^0^B1995877
"BLD",5906,"KRN",9.8,"NM",94,0)
BPSOS6M^^0^B6160803
"BLD",5906,"KRN",9.8,"NM",95,0)
BPSOS6N^^0^B47692706
"BLD",5906,"KRN",9.8,"NM",96,0)
BPSOS9^^0^B10059470
"BLD",5906,"KRN",9.8,"NM",97,0)
BPSOS96^^1^
"BLD",5906,"KRN",9.8,"NM",98,0)
BPSOS97^^1^
"BLD",5906,"KRN",9.8,"NM",99,0)
BPSOSA^^0^B6567859
"BLD",5906,"KRN",9.8,"NM",100,0)
BPSOSAA^^0^B7048280
"BLD",5906,"KRN",9.8,"NM",101,0)
BPSOSAB^^0^B33709386
"BLD",5906,"KRN",9.8,"NM",102,0)
BPSOSAD^^0^B492601
"BLD",5906,"KRN",9.8,"NM",103,0)
BPSOSAM^^0^B58130560
"BLD",5906,"KRN",9.8,"NM",104,0)
BPSOSAN^^0^B4058873
"BLD",5906,"KRN",9.8,"NM",105,0)
BPSOSAO^^0^B4139675
"BLD",5906,"KRN",9.8,"NM",106,0)
BPSOSAP^^0^B5202759
"BLD",5906,"KRN",9.8,"NM",107,0)
BPSOSAQ^^0^B1132981
"BLD",5906,"KRN",9.8,"NM",108,0)
BPSOSAR^^0^B19152233
"BLD",5906,"KRN",9.8,"NM",109,0)
BPSOSAS^^0^B3457641
"BLD",5906,"KRN",9.8,"NM",110,0)
BPSOSAW^^0^B17835501
"BLD",5906,"KRN",9.8,"NM",111,0)
BPSOSAY^^0^B4322862
"BLD",5906,"KRN",9.8,"NM",112,0)
BPSOSAZ^^1^
"BLD",5906,"KRN",9.8,"NM",113,0)
BPSOSB^^0^B2654205
"BLD",5906,"KRN",9.8,"NM",114,0)
BPSOSB0^^1^
"BLD",5906,"KRN",9.8,"NM",115,0)
BPSOSB1^^1^
"BLD",5906,"KRN",9.8,"NM",116,0)
BPSOSB2^^1^
"BLD",5906,"KRN",9.8,"NM",117,0)
BPSOSB3^^0^B4082767
"BLD",5906,"KRN",9.8,"NM",118,0)
BPSOSB4^^1^
"BLD",5906,"KRN",9.8,"NM",119,0)
BPSOSB5^^1^
"BLD",5906,"KRN",9.8,"NM",121,0)
BPSOSBA^^1^
"BLD",5906,"KRN",9.8,"NM",122,0)
BPSOSBB^^0^B30726422
"BLD",5906,"KRN",9.8,"NM",123,0)
BPSOSBC^^0^B1046204
"BLD",5906,"KRN",9.8,"NM",124,0)
BPSOSBD^^0^B7112323
"BLD",5906,"KRN",9.8,"NM",125,0)
BPSOSBE^^1^
"BLD",5906,"KRN",9.8,"NM",126,0)
BPSOSBF^^0^B27674938
"BLD",5906,"KRN",9.8,"NM",127,0)
BPSOSBI^^1^
"BLD",5906,"KRN",9.8,"NM",128,0)
BPSOSBL^^1^
"BLD",5906,"KRN",9.8,"NM",129,0)
BPSOSBM^^0^B49524905
"BLD",5906,"KRN",9.8,"NM",130,0)
BPSOSBP^^0^B803815
"BLD",5906,"KRN",9.8,"NM",131,0)
BPSOSBQ^^0^B805565
"BLD",5906,"KRN",9.8,"NM",132,0)
BPSOSBT^^0^B822400
"BLD",5906,"KRN",9.8,"NM",133,0)
BPSOSBU^^1^
"BLD",5906,"KRN",9.8,"NM",134,0)
BPSOSBV^^0^B10892119
"BLD",5906,"KRN",9.8,"NM",135,0)
BPSOSBW^^0^B19251447
"BLD",5906,"KRN",9.8,"NM",136,0)
BPSOSBX^^0^B29743000
"BLD",5906,"KRN",9.8,"NM",137,0)
BPSOSC1^^1^
"BLD",5906,"KRN",9.8,"NM",138,0)
BPSOSC2^^0^B42069797
"BLD",5906,"KRN",9.8,"NM",139,0)
BPSOSC3^^0^B4946111
"BLD",5906,"KRN",9.8,"NM",141,0)
BPSOSCA^^0^B11247616
"BLD",5906,"KRN",9.8,"NM",142,0)
BPSOSCB^^0^B10019843
"BLD",5906,"KRN",9.8,"NM",143,0)
BPSOSCC^^0^B47709345
"BLD",5906,"KRN",9.8,"NM",144,0)
BPSOSCD^^0^B46650072
"BLD",5906,"KRN",9.8,"NM",145,0)
BPSOSCE^^0^B25894685
"BLD",5906,"KRN",9.8,"NM",146,0)
BPSOSCF^^0^B29670734
"BLD",5906,"KRN",9.8,"NM",147,0)
BPSOSD1^^1^
"BLD",5906,"KRN",9.8,"NM",148,0)
BPSOSEC^^1^
"BLD",5906,"KRN",9.8,"NM",153,0)
BPSOSFD^^1^
"BLD",5906,"KRN",9.8,"NM",157,0)
BPSOSH4^^0^B37840739
"BLD",5906,"KRN",9.8,"NM",158,0)
BPSOSH5^^0^B18545753
"BLD",5906,"KRN",9.8,"NM",159,0)
BPSOSH6^^0^B27185561
"BLD",5906,"KRN",9.8,"NM",160,0)
BPSOSH7^^0^B45796867
"BLD",5906,"KRN",9.8,"NM",161,0)
BPSOSHF^^0^B11283360
"BLD",5906,"KRN",9.8,"NM",162,0)
BPSOSHR^^0^B19974681
"BLD",5906,"KRN",9.8,"NM",163,0)
BPSOSHU^^0^B800785
"BLD",5906,"KRN",9.8,"NM",164,0)
BPSOSI^^0^B31817055
"BLD",5906,"KRN",9.8,"NM",165,0)
BPSOSI1^^0^B41148853
"BLD",5906,"KRN",9.8,"NM",167,0)
BPSOSI7^^0^B6551772
"BLD",5906,"KRN",9.8,"NM",168,0)
BPSOSI8^^0^B38198538
"BLD",5906,"KRN",9.8,"NM",169,0)
BPSOSIB^^1^
"BLD",5906,"KRN",9.8,"NM",171,0)
BPSOSIF^^0^B32968333
"BLD",5906,"KRN",9.8,"NM",172,0)
BPSOSIO^^1^
"BLD",5906,"KRN",9.8,"NM",173,0)
BPSOSIP^^1^
"BLD",5906,"KRN",9.8,"NM",174,0)
BPSOSIV^^0^B71435352
"BLD",5906,"KRN",9.8,"NM",175,0)
BPSOSIW^^0^B14787815
"BLD",5906,"KRN",9.8,"NM",176,0)
BPSOSIY^^0^B63037974
"BLD",5906,"KRN",9.8,"NM",177,0)
BPSOSIZ^^0^B56423199
"BLD",5906,"KRN",9.8,"NM",178,0)
BPSOSJ1^^1^
"BLD",5906,"KRN",9.8,"NM",179,0)
BPSOSK^^0^B22965328
"BLD",5906,"KRN",9.8,"NM",180,0)
BPSOSK1^^0^B53524934
"BLD",5906,"KRN",9.8,"NM",181,0)
BPSOSK2^^0^B2180670
"BLD",5906,"KRN",9.8,"NM",182,0)
BPSOSL^^0^B48391116
"BLD",5906,"KRN",9.8,"NM",183,0)
BPSOSL1^^0^B8189020
"BLD",5906,"KRN",9.8,"NM",184,0)
BPSOSM^^0^B5785595
"BLD",5906,"KRN",9.8,"NM",185,0)
BPSOSM1^^0^B39971507
"BLD",5906,"KRN",9.8,"NM",186,0)
BPSOSM2^^0^B18267050
"BLD",5906,"KRN",9.8,"NM",187,0)
BPSOSMA^^1^
"BLD",5906,"KRN",9.8,"NM",188,0)
BPSOSMB^^1^
"BLD",5906,"KRN",9.8,"NM",189,0)
BPSOSMC^^1^
"BLD",5906,"KRN",9.8,"NM",191,0)
BPSOSMZ^^1^
"BLD",5906,"KRN",9.8,"NM",192,0)
BPSOSN0^^1^
"BLD",5906,"KRN",9.8,"NM",196,0)
BPSOSN4^^1^
"BLD",5906,"KRN",9.8,"NM",199,0)
BPSOSN7^^1^
"BLD",5906,"KRN",9.8,"NM",201,0)
BPSOSNC^^0^B4332616
"BLD",5906,"KRN",9.8,"NM",202,0)
BPSOSO^^0^B3566865
"BLD",5906,"KRN",9.8,"NM",203,0)
BPSOSO1^^0^B2720464
"BLD",5906,"KRN",9.8,"NM",204,0)
BPSOSO2^^0^B32131284
"BLD",5906,"KRN",9.8,"NM",205,0)
BPSOSO3^^1^
"BLD",5906,"KRN",9.8,"NM",206,0)
BPSOSO4^^1^
"BLD",5906,"KRN",9.8,"NM",207,0)
BPSOSO5^^1^
"BLD",5906,"KRN",9.8,"NM",208,0)
BPSOSP^^0^B7824708
"BLD",5906,"KRN",9.8,"NM",213,0)
BPSOSQ^^0^B7816816
"BLD",5906,"KRN",9.8,"NM",214,0)
BPSOSQ1^^0^B7424006
"BLD",5906,"KRN",9.8,"NM",215,0)
BPSOSQ2^^0^B31638994
"BLD",5906,"KRN",9.8,"NM",216,0)
BPSOSQ3^^0^B54487638
"BLD",5906,"KRN",9.8,"NM",217,0)
BPSOSQ4^^0^B49295427
"BLD",5906,"KRN",9.8,"NM",218,0)
BPSOSQA^^0^B59170198
"BLD",5906,"KRN",9.8,"NM",219,0)
BPSOSQB^^0^B46182613
"BLD",5906,"KRN",9.8,"NM",220,0)
BPSOSQC^^0^B5188299
"BLD",5906,"KRN",9.8,"NM",221,0)
BPSOSQD^^0^B80660
"BLD",5906,"KRN",9.8,"NM",222,0)
BPSOSQF^^0^B8424579
"BLD",5906,"KRN",9.8,"NM",223,0)
BPSOSQG^^0^B12910897
"BLD",5906,"KRN",9.8,"NM",224,0)
BPSOSQH^^0^B2352174
"BLD",5906,"KRN",9.8,"NM",225,0)
BPSOSQJ^^0^B23398489
"BLD",5906,"KRN",9.8,"NM",226,0)
BPSOSQL^^0^B63930968
"BLD",5906,"KRN",9.8,"NM",227,0)
BPSOSQP^^0^B45335446
"BLD",5906,"KRN",9.8,"NM",228,0)
BPSOSQQ^^0^B40600319
"BLD",5906,"KRN",9.8,"NM",229,0)
BPSOSQS^^0^B34719184
"BLD",5906,"KRN",9.8,"NM",230,0)
BPSOSR1^^1^
"BLD",5906,"KRN",9.8,"NM",231,0)
BPSOSR2^^0^B965768
"BLD",5906,"KRN",9.8,"NM",233,0)
BPSOSR4^^1^
"BLD",5906,"KRN",9.8,"NM",234,0)
BPSOSRB^^0^B30162283
"BLD",5906,"KRN",9.8,"NM",235,0)
BPSOSRX^^0^B38664696
"BLD",5906,"KRN",9.8,"NM",238,0)
BPSOSS2^^0^B5046028
"BLD",5906,"KRN",9.8,"NM",239,0)
BPSOSS3^^0^B846798
"BLD",5906,"KRN",9.8,"NM",242,0)
BPSOSS6^^0^B267529
"BLD",5906,"KRN",9.8,"NM",243,0)
BPSOSS7^^1^
"BLD",5906,"KRN",9.8,"NM",244,0)
BPSOSS8^^0^B20417515
"BLD",5906,"KRN",9.8,"NM",245,0)
BPSOSS9^^0^B1037255
"BLD",5906,"KRN",9.8,"NM",247,0)
BPSOSSG^^0^B54258180
"BLD",5906,"KRN",9.8,"NM",248,0)
BPSOSU^^0^B67702663
"BLD",5906,"KRN",9.8,"NM",249,0)
BPSOSU1^^0^B17021786
"BLD",5906,"KRN",9.8,"NM",250,0)
BPSOSU2^^0^B3426741
"BLD",5906,"KRN",9.8,"NM",251,0)
BPSOSU3^^0^B2603527
"BLD",5906,"KRN",9.8,"NM",252,0)
BPSOSU4^^0^B24645469
"BLD",5906,"KRN",9.8,"NM",253,0)
BPSOSU5^^0^B1961538
"BLD",5906,"KRN",9.8,"NM",254,0)
BPSOSU6^^0^B2399773
"BLD",5906,"KRN",9.8,"NM",255,0)
BPSOSU7^^0^B5338609
"BLD",5906,"KRN",9.8,"NM",256,0)
BPSOSU8^^0^B18280146
"BLD",5906,"KRN",9.8,"NM",257,0)
BPSOSU9^^0^B5894878
"BLD",5906,"KRN",9.8,"NM",258,0)
BPSOSUA^^0^B34557161
"BLD",5906,"KRN",9.8,"NM",259,0)
BPSOSUB^^1^
"BLD",5906,"KRN",9.8,"NM",260,0)
BPSOSUC^^0^B6853754
"BLD",5906,"KRN",9.8,"NM",261,0)
BPSOSUD^^0^B28991557
"BLD",5906,"KRN",9.8,"NM",262,0)
BPSOSUE^^0^B23210252
"BLD",5906,"KRN",9.8,"NM",264,0)
BPSOSX^^1^
"BLD",5906,"KRN",9.8,"NM",265,0)
BPSOSXA^^1^
"BLD",5906,"KRN",9.8,"NM",266,0)
BPSOSXE^^1^
"BLD",5906,"KRN",9.8,"NM",268,0)
BPSRDT^^1^
"BLD",5906,"KRN",9.8,"NM",271,0)
BPSUTIL^^0^B1870851
"BLD",5906,"KRN",9.8,"NM",290,0)
BPSRDT1^^0^B17984819
"BLD",5906,"KRN",9.8,"NM",292,0)
BPSOSH2^^0^B29302388
"BLD",5906,"KRN",9.8,"NM",293,0)
BPSP11P^^0^B5532843
"BLD",5906,"KRN",9.8,"NM",294,0)
BPSBUTL^^0^B31009303
"BLD",5906,"KRN",9.8,"NM",295,0)
BPSOS6A^^0^B3472076
"BLD",5906,"KRN",9.8,"NM",296,0)
BPSMHDR^^0^B8404043
"BLD",5906,"KRN",9.8,"NM",297,0)
BPSJPAY^^0^B3474496
"BLD",5906,"KRN",9.8,"NM",298,0)
BPSCEAR^^0^B80980545
"BLD",5906,"KRN",9.8,"NM",299,0)
BPSBCKJ^^0^B45801024
"BLD",5906,"KRN",9.8,"NM",300,0)
BPSRPT0^^0^B20529533
"BLD",5906,"KRN",9.8,"NM",301,0)
BPSRPT1^^0^B49847270
"BLD",5906,"KRN",9.8,"NM",302,0)
BPSRPT2^^0^B34444824
"BLD",5906,"KRN",9.8,"NM",303,0)
BPSRPT3^^0^B37369482
"BLD",5906,"KRN",9.8,"NM",304,0)
BPSRREV^^0^B11230489
"BLD",5906,"KRN",9.8,"NM",305,0)
BPS02P1^^0^B3057123
"BLD",5906,"KRN",9.8,"NM",306,0)
BPSUSCR^^0^B1083418
"BLD",5906,"KRN",9.8,"NM",307,0)
BPSUSCR1^^0^B18903469
"BLD",5906,"KRN",9.8,"NM",308,0)
BPSUSCR4^^0^B10796851
"BLD",5906,"KRN",9.8,"NM",309,0)
BPSRPT4^^0^B64877725
"BLD",5906,"KRN",9.8,"NM",310,0)
BPSRPT5^^0^B76227568
"BLD",5906,"KRN",9.8,"NM",311,0)
BPSRPT6^^0^B67527873
"BLD",5906,"KRN",9.8,"NM",312,0)
BPSRPT7^^0^B69601787
"BLD",5906,"KRN",9.8,"NM",313,0)
BPSCMT^^0^B18604091
"BLD",5906,"KRN",9.8,"NM",314,0)
BPSCMT01^^0^B18647385
"BLD",5906,"KRN",9.8,"NM",315,0)
BPSCT^^0^B1407002
"BLD",5906,"KRN",9.8,"NM",316,0)
BPSRSELG^^0^B1199942
"BLD",5906,"KRN",9.8,"NM",317,0)
BPSRSEV^^0^B2494977
"BLD",5906,"KRN",9.8,"NM",318,0)
BPSRSHLD^^0^B1363179
"BLD",5906,"KRN",9.8,"NM",319,0)
BPSRSINS^^0^B1150190
"BLD",5906,"KRN",9.8,"NM",320,0)
BPSRSM^^0^B1081116
"BLD",5906,"KRN",9.8,"NM",321,0)
BPSRSPRS^^0^B1243038
"BLD",5906,"KRN",9.8,"NM",322,0)
BPSRSRLC^^0^B2312265
"BLD",5906,"KRN",9.8,"NM",323,0)
BPSRSTPJ^^0^B1149393
"BLD",5906,"KRN",9.8,"NM",324,0)
BPSSCR^^0^B2756010
"BLD",5906,"KRN",9.8,"NM",325,0)
BPSSCR01^^0^B17293362
"BLD",5906,"KRN",9.8,"NM",326,0)
BPSSCR02^^0^B43889561
"BLD",5906,"KRN",9.8,"NM",327,0)
BPSSCR03^^0^B41992643
"BLD",5906,"KRN",9.8,"NM",328,0)
BPSSCR04^^0^B53493925
"BLD",5906,"KRN",9.8,"NM",329,0)
BPSSCRCL^^0^B75438118
"BLD",5906,"KRN",9.8,"NM",331,0)
BPSSCRCU^^0^B3842949
"BLD",5906,"KRN",9.8,"NM",332,0)
BPSSCRCV^^0^B47521976
"BLD",5906,"KRN",9.8,"NM",333,0)
BPSSCRDS^^0^B11595705
"BLD",5906,"KRN",9.8,"NM",334,0)
BPSSCRDV^^0^B986663
"BLD",5906,"KRN",9.8,"NM",335,0)
BPSSCRLG^^0^B92478736
"BLD",5906,"KRN",9.8,"NM",336,0)
BPSSCRPR^^0^B504281
"BLD",5906,"KRN",9.8,"NM",337,0)
BPSSCRRS^^0^B19576084
"BLD",5906,"KRN",9.8,"NM",338,0)
BPSSCRRV^^0^B14413135
"BLD",5906,"KRN",9.8,"NM",339,0)
BPSSCRSL^^0^B13407810
"BLD",5906,"KRN",9.8,"NM",340,0)
BPSSCRU1^^0^B2399860
"BLD",5906,"KRN",9.8,"NM",341,0)
BPSSCRU2^^0^B62609575
"BLD",5906,"KRN",9.8,"NM",342,0)
BPSSCRU3^^0^B34228996
"BLD",5906,"KRN",9.8,"NM",343,0)
BPSSCRU4^^0^B58150912
"BLD",5906,"KRN",9.8,"NM",344,0)
BPSSCRU5^^0^B63071819
"BLD",5906,"KRN",9.8,"NM",345,0)
BPSSCRUD^^0^B1170745
"BLD",5906,"KRN",9.8,"NM",346,0)
BPSRPAY^^0^B35284657
"BLD",5906,"KRN",9.8,"NM",347,0)
BPSPHAR^^0^B990047
"BLD",5906,"KRN",9.8,"NM",348,0)
BPSJACK^^0^B29751574
"BLD",5906,"KRN",9.8,"NM",349,0)
BPSJAREG^^0^B10520831
"BLD",5906,"KRN",9.8,"NM",350,0)
BPSJHLI^^0^B2158650
"BLD",5906,"KRN",9.8,"NM",351,0)
BPSJHLT^^0^B65705397
"BLD",5906,"KRN",9.8,"NM",352,0)
BPSJINI1^^0^B20176164
"BLD",5906,"KRN",9.8,"NM",353,0)
BPSJINIT^^0^B34990565
"BLD",5906,"KRN",9.8,"NM",354,0)
BPSJPHNM^^0^B32200511
"BLD",5906,"KRN",9.8,"NM",355,0)
BPSJPREG^^0^B10988509
"BLD",5906,"KRN",9.8,"NM",356,0)
BPSJUTL^^0^B9376447
"BLD",5906,"KRN",9.8,"NM",357,0)
BPSJUTL1^^0^B6119361
"BLD",5906,"KRN",9.8,"NM",358,0)
BPSJVAL^^0^B7718705
"BLD",5906,"KRN",9.8,"NM",359,0)
BPSJVAL1^^0^B15967858
"BLD",5906,"KRN",9.8,"NM",360,0)
BPSJVAL2^^0^B30079900
"BLD",5906,"KRN",9.8,"NM",361,0)
BPSJXI1^^0^B1826477
"BLD",5906,"KRN",9.8,"NM",362,0)
BPSJZPR^^0^B62093577
"BLD",5906,"KRN",9.8,"NM",363,0)
BPSJZQR^^0^B2252225
"BLD",5906,"KRN",9.8,"NM",364,0)
BPSJZRP^^0^B23404723
"BLD",5906,"KRN",9.8,"NM",365,0)
BPSRPT8^^0^B54566522
"BLD",5906,"KRN",9.8,"NM",366,0)
BPS03P1^^0^B224664
"BLD",5906,"KRN",9.8,"NM","B","BPS02P1",305)

"BLD",5906,"KRN",9.8,"NM","B","BPS03P1",366)

"BLD",5906,"KRN",9.8,"NM","B","BPSBCKJ",299)

"BLD",5906,"KRN",9.8,"NM","B","BPSBUTL",294)

"BLD",5906,"KRN",9.8,"NM","B","BPSCEAR",298)

"BLD",5906,"KRN",9.8,"NM","B","BPSCMT",313)

"BLD",5906,"KRN",9.8,"NM","B","BPSCMT01",314)

"BLD",5906,"KRN",9.8,"NM","B","BPSCT",315)

"BLD",5906,"KRN",9.8,"NM","B","BPSECA1",1)

"BLD",5906,"KRN",9.8,"NM","B","BPSECA2",2)

"BLD",5906,"KRN",9.8,"NM","B","BPSECA4",3)

"BLD",5906,"KRN",9.8,"NM","B","BPSECA5",4)

"BLD",5906,"KRN",9.8,"NM","B","BPSECA7",5)

"BLD",5906,"KRN",9.8,"NM","B","BPSECA8",6)

"BLD",5906,"KRN",9.8,"NM","B","BPSECA9",7)

"BLD",5906,"KRN",9.8,"NM","B","BPSECFM",8)

"BLD",5906,"KRN",9.8,"NM","B","BPSECMC2",9)

"BLD",5906,"KRN",9.8,"NM","B","BPSECMP2",10)

"BLD",5906,"KRN",9.8,"NM","B","BPSECMPS",11)

"BLD",5906,"KRN",9.8,"NM","B","BPSECP0",12)

"BLD",5906,"KRN",9.8,"NM","B","BPSECP1",13)

"BLD",5906,"KRN",9.8,"NM","B","BPSECP2",14)

"BLD",5906,"KRN",9.8,"NM","B","BPSECP3",15)

"BLD",5906,"KRN",9.8,"NM","B","BPSECR0",16)

"BLD",5906,"KRN",9.8,"NM","B","BPSECR1",17)

"BLD",5906,"KRN",9.8,"NM","B","BPSECR2",18)

"BLD",5906,"KRN",9.8,"NM","B","BPSECX0",19)

"BLD",5906,"KRN",9.8,"NM","B","BPSECX1",20)

"BLD",5906,"KRN",9.8,"NM","B","BPSECX4",21)

"BLD",5906,"KRN",9.8,"NM","B","BPSECZ3",23)

"BLD",5906,"KRN",9.8,"NM","B","BPSECZA",24)

"BLD",5906,"KRN",9.8,"NM","B","BPSER1A",26)

"BLD",5906,"KRN",9.8,"NM","B","BPSER2A",28)

"BLD",5906,"KRN",9.8,"NM","B","BPSER3A",30)

"BLD",5906,"KRN",9.8,"NM","B","BPSER4A",32)

"BLD",5906,"KRN",9.8,"NM","B","BPSES00",33)

"BLD",5906,"KRN",9.8,"NM","B","BPSJACK",348)

"BLD",5906,"KRN",9.8,"NM","B","BPSJAREG",349)

"BLD",5906,"KRN",9.8,"NM","B","BPSJHLI",350)

"BLD",5906,"KRN",9.8,"NM","B","BPSJHLT",351)

"BLD",5906,"KRN",9.8,"NM","B","BPSJINI1",352)

"BLD",5906,"KRN",9.8,"NM","B","BPSJINIT",353)

"BLD",5906,"KRN",9.8,"NM","B","BPSJPAY",297)

"BLD",5906,"KRN",9.8,"NM","B","BPSJPHNM",354)

"BLD",5906,"KRN",9.8,"NM","B","BPSJPREG",355)

"BLD",5906,"KRN",9.8,"NM","B","BPSJUTL",356)

"BLD",5906,"KRN",9.8,"NM","B","BPSJUTL1",357)

"BLD",5906,"KRN",9.8,"NM","B","BPSJVAL",358)

"BLD",5906,"KRN",9.8,"NM","B","BPSJVAL1",359)

"BLD",5906,"KRN",9.8,"NM","B","BPSJVAL2",360)

"BLD",5906,"KRN",9.8,"NM","B","BPSJXI1",361)

"BLD",5906,"KRN",9.8,"NM","B","BPSJZPR",362)

"BLD",5906,"KRN",9.8,"NM","B","BPSJZQR",363)

"BLD",5906,"KRN",9.8,"NM","B","BPSJZRP",364)

"BLD",5906,"KRN",9.8,"NM","B","BPSMHDR",296)

"BLD",5906,"KRN",9.8,"NM","B","BPSNCPD1",58)

"BLD",5906,"KRN",9.8,"NM","B","BPSNCPD2",59)

"BLD",5906,"KRN",9.8,"NM","B","BPSNCPD3",60)

"BLD",5906,"KRN",9.8,"NM","B","BPSNCPDP",61)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS",62)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS02",63)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS03",64)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS2",65)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS25",66)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS29",69)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS2A",70)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS2B",71)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS2C",72)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS2D",73)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS2E",74)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS2F",75)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS57",81)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6A",295)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6B",83)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6C",84)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6D",85)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6E",86)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6F",87)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6G",88)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6H",89)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6I",90)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6J",91)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6K",92)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6L",93)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6M",94)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS6N",95)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS9",96)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS96",97)

"BLD",5906,"KRN",9.8,"NM","B","BPSOS97",98)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSA",99)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAA",100)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAB",101)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAD",102)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAM",103)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAN",104)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAO",105)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAP",106)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAQ",107)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAR",108)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAS",109)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAW",110)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAY",111)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSAZ",112)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSB",113)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSB0",114)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSB1",115)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSB2",116)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSB3",117)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSB4",118)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSB5",119)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBA",121)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBB",122)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBC",123)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBD",124)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBE",125)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBF",126)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBI",127)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBL",128)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBM",129)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBP",130)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBQ",131)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBT",132)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBU",133)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBV",134)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBW",135)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSBX",136)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSC1",137)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSC2",138)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSC3",139)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSCA",141)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSCB",142)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSCC",143)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSCD",144)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSCE",145)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSCF",146)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSD1",147)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSEC",148)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSFD",153)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSH2",292)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSH4",157)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSH5",158)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSH6",159)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSH7",160)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSHF",161)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSHR",162)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSHU",163)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSI",164)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSI1",165)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSI7",167)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSI8",168)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSIB",169)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSIF",171)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSIO",172)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSIP",173)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSIV",174)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSIW",175)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSIY",176)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSIZ",177)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSJ1",178)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSK",179)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSK1",180)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSK2",181)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSL",182)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSL1",183)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSM",184)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSM1",185)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSM2",186)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSMA",187)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSMB",188)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSMC",189)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSMZ",191)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSN0",192)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSN4",196)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSN7",199)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSNC",201)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSO",202)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSO1",203)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSO2",204)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSO3",205)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSO4",206)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSO5",207)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSP",208)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQ",213)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQ1",214)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQ2",215)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQ3",216)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQ4",217)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQA",218)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQB",219)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQC",220)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQD",221)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQF",222)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQG",223)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQH",224)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQJ",225)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQL",226)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQP",227)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQQ",228)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSQS",229)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSR1",230)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSR2",231)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSR4",233)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSRB",234)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSRX",235)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSS2",238)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSS3",239)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSS6",242)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSS7",243)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSS8",244)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSS9",245)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSSG",247)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSU",248)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSU1",249)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSU2",250)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSU3",251)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSU4",252)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSU5",253)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSU6",254)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSU7",255)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSU8",256)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSU9",257)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSUA",258)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSUB",259)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSUC",260)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSUD",261)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSUE",262)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSX",264)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSXA",265)

"BLD",5906,"KRN",9.8,"NM","B","BPSOSXE",266)

"BLD",5906,"KRN",9.8,"NM","B","BPSP11P",293)

"BLD",5906,"KRN",9.8,"NM","B","BPSPHAR",347)

"BLD",5906,"KRN",9.8,"NM","B","BPSRDT",268)

"BLD",5906,"KRN",9.8,"NM","B","BPSRDT1",290)

"BLD",5906,"KRN",9.8,"NM","B","BPSRPAY",346)

"BLD",5906,"KRN",9.8,"NM","B","BPSRPT0",300)

"BLD",5906,"KRN",9.8,"NM","B","BPSRPT1",301)

"BLD",5906,"KRN",9.8,"NM","B","BPSRPT2",302)

"BLD",5906,"KRN",9.8,"NM","B","BPSRPT3",303)

"BLD",5906,"KRN",9.8,"NM","B","BPSRPT4",309)

"BLD",5906,"KRN",9.8,"NM","B","BPSRPT5",310)

"BLD",5906,"KRN",9.8,"NM","B","BPSRPT6",311)

"BLD",5906,"KRN",9.8,"NM","B","BPSRPT7",312)

"BLD",5906,"KRN",9.8,"NM","B","BPSRPT8",365)

"BLD",5906,"KRN",9.8,"NM","B","BPSRREV",304)

"BLD",5906,"KRN",9.8,"NM","B","BPSRSELG",316)

"BLD",5906,"KRN",9.8,"NM","B","BPSRSEV",317)

"BLD",5906,"KRN",9.8,"NM","B","BPSRSHLD",318)

"BLD",5906,"KRN",9.8,"NM","B","BPSRSINS",319)

"BLD",5906,"KRN",9.8,"NM","B","BPSRSM",320)

"BLD",5906,"KRN",9.8,"NM","B","BPSRSPRS",321)

"BLD",5906,"KRN",9.8,"NM","B","BPSRSRLC",322)

"BLD",5906,"KRN",9.8,"NM","B","BPSRSTPJ",323)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCR",324)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCR01",325)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCR02",326)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCR03",327)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCR04",328)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRCL",329)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRCU",331)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRCV",332)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRDS",333)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRDV",334)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRLG",335)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRPR",336)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRRS",337)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRRV",338)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRSL",339)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRU1",340)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRU2",341)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRU3",342)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRU4",343)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRU5",344)

"BLD",5906,"KRN",9.8,"NM","B","BPSSCRUD",345)

"BLD",5906,"KRN",9.8,"NM","B","BPSUSCR",306)

"BLD",5906,"KRN",9.8,"NM","B","BPSUSCR1",307)

"BLD",5906,"KRN",9.8,"NM","B","BPSUSCR4",308)

"BLD",5906,"KRN",9.8,"NM","B","BPSUTIL",271)

"BLD",5906,"KRN",19,0)
19
"BLD",5906,"KRN",19,"NM",0)
^9.68A^128^123
"BLD",5906,"KRN",19,"NM",1,0)
BPS APP REG TASKMAN^^0
"BLD",5906,"KRN",19,"NM",2,0)
BPS AUTO-WRITEOFF BAT^^1^
"BLD",5906,"KRN",19,"NM",3,0)
BPS AUTO-WRITEOFF LIST^^1^
"BLD",5906,"KRN",19,"NM",4,0)
BPS BACKGROUND SCAN LOG^^1^
"BLD",5906,"KRN",19,"NM",5,0)
BPS BACKGROUND SCAN START^^1^
"BLD",5906,"KRN",19,"NM",6,0)
BPS BACKGROUND SCAN STATUS^^1^
"BLD",5906,"KRN",19,"NM",7,0)
BPS BACKGROUND SCAN STOP^^1^
"BLD",5906,"KRN",19,"NM",8,0)
BPS BEN/ELIG SURVEY^^1^
"BLD",5906,"KRN",19,"NM",11,0)
BPS COMMS LOG VIEW^^1^
"BLD",5906,"KRN",19,"NM",12,0)
BPS DISPLAY CLAIMS 1^^1^
"BLD",5906,"KRN",19,"NM",13,0)
BPS DISPLAY RESPONSES 1^^1^
"BLD",5906,"KRN",19,"NM",14,0)
BPS DIVISIONS SURVEY^^1^
"BLD",5906,"KRN",19,"NM",15,0)
BPS EOB TO BATCH^^1^
"BLD",5906,"KRN",19,"NM",16,0)
BPS FORMATS EDIT^^1^
"BLD",5906,"KRN",19,"NM",17,0)
BPS FORMATS INPUT^^1^
"BLD",5906,"KRN",19,"NM",18,0)
BPS FORMATS LIST^^1^
"BLD",5906,"KRN",19,"NM",19,0)
BPS INS RULES AVAIL^^1^
"BLD",5906,"KRN",19,"NM",20,0)
BPS INS RULES IN-USE^^1^
"BLD",5906,"KRN",19,"NM",21,0)
BPS INSURANCE EDIT^^1^
"BLD",5906,"KRN",19,"NM",22,0)
BPS INSURER SURVEY^^1^
"BLD",5906,"KRN",19,"NM",24,0)
BPS MANAGER SCREEN^^1^
"BLD",5906,"KRN",19,"NM",25,0)
BPS MENU BACKGROUND SCAN^^1^
"BLD",5906,"KRN",19,"NM",26,0)
BPS MENU DEVEL^^1^
"BLD",5906,"KRN",19,"NM",27,0)
BPS MENU NCPDP FORMS^^1^
"BLD",5906,"KRN",19,"NM",28,0)
BPS MENU RPT CLAIM STATUS^^0
"BLD",5906,"KRN",19,"NM",29,0)
BPS MENU RPT MAIN^^0
"BLD",5906,"KRN",19,"NM",30,0)
BPS MENU RPT OTHER^^0
"BLD",5906,"KRN",19,"NM",31,0)
BPS MENU RPT SETUP^^1^
"BLD",5906,"KRN",19,"NM",32,0)
BPS MENU RPT SURVEY^^1^
"BLD",5906,"KRN",19,"NM",33,0)
BPS NCPDP FIELDS LIST^^1^
"BLD",5906,"KRN",19,"NM",34,0)
BPS NCPDP FORMS ALIGN^^1^
"BLD",5906,"KRN",19,"NM",35,0)
BPS NCPDP FORMS PRINT^^1^
"BLD",5906,"KRN",19,"NM",36,0)
BPS NCPDP FORMS REPRINT^^1^
"BLD",5906,"KRN",19,"NM",37,0)
BPS PAYABLE REPORT^^1^
"BLD",5906,"KRN",19,"NM",38,0)
BPS PROVIDER #S EDIT^^1^
"BLD",5906,"KRN",19,"NM",39,0)
BPS PROVIDER #S SURVEY^^1^
"BLD",5906,"KRN",19,"NM",40,0)
BPS RECENT TRANSACTIONS^^1^
"BLD",5906,"KRN",19,"NM",41,0)
BPS REJECTION REPORT^^1^
"BLD",5906,"KRN",19,"NM",42,0)
BPS REVERSAL REPORT^^1^
"BLD",5906,"KRN",19,"NM",43,0)
BPS RPMS RX BILLING STATUS^^1^
"BLD",5906,"KRN",19,"NM",44,0)
BPS RPT CAPTURED^^1^
"BLD",5906,"KRN",19,"NM",45,0)
BPS RPT CLOSED CLAIMS^^0
"BLD",5906,"KRN",19,"NM",46,0)
BPS RPT DUPLICATE^^1^
"BLD",5906,"KRN",19,"NM",47,0)
BPS RPT MISSED PRESCRIPTIONS^^1^
"BLD",5906,"KRN",19,"NM",48,0)
BPS RPT NEED REVERSAL^^1^
"BLD",5906,"KRN",19,"NM",49,0)
BPS RPT NOT RELEASED^^0
"BLD",5906,"KRN",19,"NM",50,0)
BPS RPT PAPER^^1^
"BLD",5906,"KRN",19,"NM",51,0)
BPS RPT PAYABLE^^0
"BLD",5906,"KRN",19,"NM",52,0)
BPS RPT REJECTION^^0
"BLD",5906,"KRN",19,"NM",53,0)
BPS RPT REVERSAL^^0
"BLD",5906,"KRN",19,"NM",54,0)
BPS RPT TOTALS BY DAY^^0
"BLD",5906,"KRN",19,"NM",55,0)
BPS RPT TOTALS BY INSURER^^1^
"BLD",5906,"KRN",19,"NM",56,0)
BPS RPT UNINSURED^^1^
"BLD",5906,"KRN",19,"NM",57,0)
BPS RPT UNRELEASED^^1^
"BLD",5906,"KRN",19,"NM",58,0)
BPS SETUP DETAIL^^1^
"BLD",5906,"KRN",19,"NM",59,0)
BPS SETUP DIAL OUT ADV.^^1^
"BLD",5906,"KRN",19,"NM",60,0)
BPS SETUP DIAL OUT BASIC^^1^
"BLD",5906,"KRN",19,"NM",61,0)
BPS SETUP DIAL OUT DEF.^^1^
"BLD",5906,"KRN",19,"NM",62,0)
BPS SETUP DIAL OUT MENU^^1^
"BLD",5906,"KRN",19,"NM",63,0)
BPS SETUP ILC AR^^1^
"BLD",5906,"KRN",19,"NM",64,0)
BPS SETUP INSURANCE MENU^^1^
"BLD",5906,"KRN",19,"NM",65,0)
BPS SETUP INSURANCE SEL^^1^
"BLD",5906,"KRN",19,"NM",66,0)
BPS SETUP INSURER^^1^
"BLD",5906,"KRN",19,"NM",67,0)
BPS SETUP INSURER QUICK^^1^
"BLD",5906,"KRN",19,"NM",68,0)
BPS SETUP MENU^^0
"BLD",5906,"KRN",19,"NM",69,0)
BPS SETUP MISC.^^1^
"BLD",5906,"KRN",19,"NM",70,0)
BPS SETUP OKLA. MEDICAID^^1^
"BLD",5906,"KRN",19,"NM",71,0)
BPS SETUP PART 1^^1^
"BLD",5906,"KRN",19,"NM",72,0)
BPS SETUP PHARMACIES^^1^
"BLD",5906,"KRN",19,"NM",73,0)
BPS SETUP PHARMACY^^0
"BLD",5906,"KRN",19,"NM",74,0)
BPS SETUP PRICING^^1^
"BLD",5906,"KRN",19,"NM",75,0)
BPS SETUP REGISTER PHARMACY^^0
"BLD",5906,"KRN",19,"NM",76,0)
BPS SETUP SUMMARY^^1^
"BLD",5906,"KRN",19,"NM",77,0)
BPS SETUP USERS^^1^
"BLD",5906,"KRN",19,"NM",78,0)
BPS STATISTICS^^1^
"BLD",5906,"KRN",19,"NM",79,0)
BPS STRANDED CLAIMS^^1^
"BLD",5906,"KRN",19,"NM",80,0)
BPS SUP CHECK DATE RANGE^^1^
"BLD",5906,"KRN",19,"NM",81,0)
BPS SUP CHECK DEFAULT^^1^
"BLD",5906,"KRN",19,"NM",82,0)
BPS SUP CHECK MENU^^1^
"BLD",5906,"KRN",19,"NM",83,0)
BPS SUP CHECK PAST WEEK^^1^
"BLD",5906,"KRN",19,"NM",84,0)
BPS SUP CHECK TODAY^^1^
"BLD",5906,"KRN",19,"NM",85,0)
BPS SUP CHECK YESTERDAY^^1^
"BLD",5906,"KRN",19,"NM",86,0)
BPS SUP ERROR LOG^^1^
"BLD",5906,"KRN",19,"NM",87,0)
BPS SUP MENU^^1^
"BLD",5906,"KRN",19,"NM",88,0)
BPS SUP QUEUES^^1^
"BLD",5906,"KRN",19,"NM",89,0)
BPS SUP SPECIAL LOG FILES^^1^
"BLD",5906,"KRN",19,"NM",90,0)
BPS SUP UNSTRAND CLAIMS^^1^
"BLD",5906,"KRN",19,"NM",91,0)
BPS TECH - FILES^^1^
"BLD",5906,"KRN",19,"NM",92,0)
BPS TECH - OPTIONS^^1^
"BLD",5906,"KRN",19,"NM",93,0)
BPS TEST MESSAGE^^1^
"BLD",5906,"KRN",19,"NM",94,0)
BPS TRANS STATUS BY CLAIM^^1^
"BLD",5906,"KRN",19,"NM",95,0)
BPS TURNAROUND STATS^^1^
"BLD",5906,"KRN",19,"NM",96,0)
BPS UNBILLABLE DRUG^^1^
"BLD",5906,"KRN",19,"NM",97,0)
BPS UNBILLABLE MENU^^1^
"BLD",5906,"KRN",19,"NM",98,0)
BPS UNBILLABLE NDC^^1^
"BLD",5906,"KRN",19,"NM",99,0)
BPS UNBILLABLE OTC^^1^
"BLD",5906,"KRN",19,"NM",100,0)
BPS UPDATE REPORT MASTER FILE^^1^
"BLD",5906,"KRN",19,"NM",102,0)
BPS USER PREFERENCES^^1^
"BLD",5906,"KRN",19,"NM",103,0)
BPS USER SCREEN^^0^
"BLD",5906,"KRN",19,"NM",104,0)
BPS VOLUME SURVEY^^1^
"BLD",5906,"KRN",19,"NM",106,0)
BPSMENU^^0
"BLD",5906,"KRN",19,"NM",107,0)
BPS RPT CMOP/ECME ACTIVITY^^0
"BLD",5906,"KRN",19,"NM",108,0)
BPS NIGHTLY BACKGROUND JOB^^0
"BLD",5906,"KRN",19,"NM",109,0)
BPS OLD RPT REVERSAL^^1^
"BLD",5906,"KRN",19,"NM",110,0)
BPS OLD RPT REJECTION^^1^
"BLD",5906,"KRN",19,"NM",111,0)
BPS OLD RPT PAYABLE^^1^
"BLD",5906,"KRN",19,"NM",112,0)
BPS OLD RPT NOTRELEAS^^1^
"BLD",5906,"KRN",19,"NM",113,0)
BPS MENU OLD CLAIM STATUS RPT^^1^
"BLD",5906,"KRN",19,"NM",114,0)
BPS MENU MAINTENANCE^^0
"BLD",5906,"KRN",19,"NM",115,0)
BPS MANAGER MENU^^0
"BLD",5906,"KRN",19,"NM",116,0)
BPS RPT ERRONEOUS REV^^0
"BLD",5906,"KRN",19,"NM",117,0)
BPS UNSTRAND SCREEN^^0
"BLD",5906,"KRN",19,"NM",118,0)
BPS RPT PAYER SHEET DETAIL^^0
"BLD",5906,"KRN",19,"NM",119,0)
BPS BILLING MENU^^1^
"BLD",5906,"KRN",19,"NM",120,0)
BPS BILLING MENU FOR ILC A/R^^1^
"BLD",5906,"KRN",19,"NM",121,0)
BPS USER MENU^^1^
"BLD",5906,"KRN",19,"NM",122,0)
BPS WRITEOFF SELECTION^^1^
"BLD",5906,"KRN",19,"NM",123,0)
BPS STATS SCREEN^^1^
"BLD",5906,"KRN",19,"NM",124,0)
BPS STATISTICS SCREEN^^0
"BLD",5906,"KRN",19,"NM",125,0)
BPS RPT SETUP PHARMACIES^^0
"BLD",5906,"KRN",19,"NM",126,0)
BPS RPT TURNAROUND STATS^^0
"BLD",5906,"KRN",19,"NM",127,0)
BPS RPT RECENT TRANSACTIONS^^0
"BLD",5906,"KRN",19,"NM",128,0)
BPS SETUP BASIC PARAMS^^0
"BLD",5906,"KRN",19,"NM","B","BPS APP REG TASKMAN",1)

"BLD",5906,"KRN",19,"NM","B","BPS AUTO-WRITEOFF BAT",2)

"BLD",5906,"KRN",19,"NM","B","BPS AUTO-WRITEOFF LIST",3)

"BLD",5906,"KRN",19,"NM","B","BPS BACKGROUND SCAN LOG",4)

"BLD",5906,"KRN",19,"NM","B","BPS BACKGROUND SCAN START",5)

"BLD",5906,"KRN",19,"NM","B","BPS BACKGROUND SCAN STATUS",6)

"BLD",5906,"KRN",19,"NM","B","BPS BACKGROUND SCAN STOP",7)

"BLD",5906,"KRN",19,"NM","B","BPS BEN/ELIG SURVEY",8)

"BLD",5906,"KRN",19,"NM","B","BPS BILLING MENU",119)

"BLD",5906,"KRN",19,"NM","B","BPS BILLING MENU FOR ILC A/R",120)

"BLD",5906,"KRN",19,"NM","B","BPS COMMS LOG VIEW",11)

"BLD",5906,"KRN",19,"NM","B","BPS DISPLAY CLAIMS 1",12)

"BLD",5906,"KRN",19,"NM","B","BPS DISPLAY RESPONSES 1",13)

"BLD",5906,"KRN",19,"NM","B","BPS DIVISIONS SURVEY",14)

"BLD",5906,"KRN",19,"NM","B","BPS EOB TO BATCH",15)

"BLD",5906,"KRN",19,"NM","B","BPS FORMATS EDIT",16)

"BLD",5906,"KRN",19,"NM","B","BPS FORMATS INPUT",17)

"BLD",5906,"KRN",19,"NM","B","BPS FORMATS LIST",18)

"BLD",5906,"KRN",19,"NM","B","BPS INS RULES AVAIL",19)

"BLD",5906,"KRN",19,"NM","B","BPS INS RULES IN-USE",20)

"BLD",5906,"KRN",19,"NM","B","BPS INSURANCE EDIT",21)

"BLD",5906,"KRN",19,"NM","B","BPS INSURER SURVEY",22)

"BLD",5906,"KRN",19,"NM","B","BPS MANAGER MENU",115)

"BLD",5906,"KRN",19,"NM","B","BPS MANAGER SCREEN",24)

"BLD",5906,"KRN",19,"NM","B","BPS MENU BACKGROUND SCAN",25)

"BLD",5906,"KRN",19,"NM","B","BPS MENU DEVEL",26)

"BLD",5906,"KRN",19,"NM","B","BPS MENU MAINTENANCE",114)

"BLD",5906,"KRN",19,"NM","B","BPS MENU NCPDP FORMS",27)

"BLD",5906,"KRN",19,"NM","B","BPS MENU OLD CLAIM STATUS RPT",113)

"BLD",5906,"KRN",19,"NM","B","BPS MENU RPT CLAIM STATUS",28)

"BLD",5906,"KRN",19,"NM","B","BPS MENU RPT MAIN",29)

"BLD",5906,"KRN",19,"NM","B","BPS MENU RPT OTHER",30)

"BLD",5906,"KRN",19,"NM","B","BPS MENU RPT SETUP",31)

"BLD",5906,"KRN",19,"NM","B","BPS MENU RPT SURVEY",32)

"BLD",5906,"KRN",19,"NM","B","BPS NCPDP FIELDS LIST",33)

"BLD",5906,"KRN",19,"NM","B","BPS NCPDP FORMS ALIGN",34)

"BLD",5906,"KRN",19,"NM","B","BPS NCPDP FORMS PRINT",35)

"BLD",5906,"KRN",19,"NM","B","BPS NCPDP FORMS REPRINT",36)

"BLD",5906,"KRN",19,"NM","B","BPS NIGHTLY BACKGROUND JOB",108)

"BLD",5906,"KRN",19,"NM","B","BPS OLD RPT NOTRELEAS",112)

"BLD",5906,"KRN",19,"NM","B","BPS OLD RPT PAYABLE",111)

"BLD",5906,"KRN",19,"NM","B","BPS OLD RPT REJECTION",110)

"BLD",5906,"KRN",19,"NM","B","BPS OLD RPT REVERSAL",109)

"BLD",5906,"KRN",19,"NM","B","BPS PAYABLE REPORT",37)

"BLD",5906,"KRN",19,"NM","B","BPS PROVIDER #S EDIT",38)

"BLD",5906,"KRN",19,"NM","B","BPS PROVIDER #S SURVEY",39)

"BLD",5906,"KRN",19,"NM","B","BPS RECENT TRANSACTIONS",40)

"BLD",5906,"KRN",19,"NM","B","BPS REJECTION REPORT",41)

"BLD",5906,"KRN",19,"NM","B","BPS REVERSAL REPORT",42)

"BLD",5906,"KRN",19,"NM","B","BPS RPMS RX BILLING STATUS",43)

"BLD",5906,"KRN",19,"NM","B","BPS RPT CAPTURED",44)

"BLD",5906,"KRN",19,"NM","B","BPS RPT CLOSED CLAIMS",45)

"BLD",5906,"KRN",19,"NM","B","BPS RPT CMOP/ECME ACTIVITY",107)

"BLD",5906,"KRN",19,"NM","B","BPS RPT DUPLICATE",46)

"BLD",5906,"KRN",19,"NM","B","BPS RPT ERRONEOUS REV",116)

"BLD",5906,"KRN",19,"NM","B","BPS RPT MISSED PRESCRIPTIONS",47)

"BLD",5906,"KRN",19,"NM","B","BPS RPT NEED REVERSAL",48)

"BLD",5906,"KRN",19,"NM","B","BPS RPT NOT RELEASED",49)

"BLD",5906,"KRN",19,"NM","B","BPS RPT PAPER",50)

"BLD",5906,"KRN",19,"NM","B","BPS RPT PAYABLE",51)

"BLD",5906,"KRN",19,"NM","B","BPS RPT PAYER SHEET DETAIL",118)

"BLD",5906,"KRN",19,"NM","B","BPS RPT RECENT TRANSACTIONS",127)

"BLD",5906,"KRN",19,"NM","B","BPS RPT REJECTION",52)

"BLD",5906,"KRN",19,"NM","B","BPS RPT REVERSAL",53)

"BLD",5906,"KRN",19,"NM","B","BPS RPT SETUP PHARMACIES",125)

"BLD",5906,"KRN",19,"NM","B","BPS RPT TOTALS BY DAY",54)

"BLD",5906,"KRN",19,"NM","B","BPS RPT TOTALS BY INSURER",55)

"BLD",5906,"KRN",19,"NM","B","BPS RPT TURNAROUND STATS",126)

"BLD",5906,"KRN",19,"NM","B","BPS RPT UNINSURED",56)

"BLD",5906,"KRN",19,"NM","B","BPS RPT UNRELEASED",57)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP BASIC PARAMS",128)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP DETAIL",58)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP DIAL OUT ADV.",59)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP DIAL OUT BASIC",60)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP DIAL OUT DEF.",61)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP DIAL OUT MENU",62)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP ILC AR",63)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP INSURANCE MENU",64)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP INSURANCE SEL",65)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP INSURER",66)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP INSURER QUICK",67)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP MENU",68)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP MISC.",69)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP OKLA. MEDICAID",70)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP PART 1",71)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP PHARMACIES",72)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP PHARMACY",73)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP PRICING",74)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP REGISTER PHARMACY",75)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP SUMMARY",76)

"BLD",5906,"KRN",19,"NM","B","BPS SETUP USERS",77)

"BLD",5906,"KRN",19,"NM","B","BPS STATISTICS",78)

"BLD",5906,"KRN",19,"NM","B","BPS STATISTICS SCREEN",124)

"BLD",5906,"KRN",19,"NM","B","BPS STATS SCREEN",123)

"BLD",5906,"KRN",19,"NM","B","BPS STRANDED CLAIMS",79)

"BLD",5906,"KRN",19,"NM","B","BPS SUP CHECK DATE RANGE",80)

"BLD",5906,"KRN",19,"NM","B","BPS SUP CHECK DEFAULT",81)

"BLD",5906,"KRN",19,"NM","B","BPS SUP CHECK MENU",82)

"BLD",5906,"KRN",19,"NM","B","BPS SUP CHECK PAST WEEK",83)

"BLD",5906,"KRN",19,"NM","B","BPS SUP CHECK TODAY",84)

"BLD",5906,"KRN",19,"NM","B","BPS SUP CHECK YESTERDAY",85)

"BLD",5906,"KRN",19,"NM","B","BPS SUP ERROR LOG",86)

"BLD",5906,"KRN",19,"NM","B","BPS SUP MENU",87)

"BLD",5906,"KRN",19,"NM","B","BPS SUP QUEUES",88)

"BLD",5906,"KRN",19,"NM","B","BPS SUP SPECIAL LOG FILES",89)

"BLD",5906,"KRN",19,"NM","B","BPS SUP UNSTRAND CLAIMS",90)

"BLD",5906,"KRN",19,"NM","B","BPS TECH - FILES",91)

"BLD",5906,"KRN",19,"NM","B","BPS TECH - OPTIONS",92)

"BLD",5906,"KRN",19,"NM","B","BPS TEST MESSAGE",93)

"BLD",5906,"KRN",19,"NM","B","BPS TRANS STATUS BY CLAIM",94)

"BLD",5906,"KRN",19,"NM","B","BPS TURNAROUND STATS",95)

"BLD",5906,"KRN",19,"NM","B","BPS UNBILLABLE DRUG",96)

"BLD",5906,"KRN",19,"NM","B","BPS UNBILLABLE MENU",97)

"BLD",5906,"KRN",19,"NM","B","BPS UNBILLABLE NDC",98)

"BLD",5906,"KRN",19,"NM","B","BPS UNBILLABLE OTC",99)

"BLD",5906,"KRN",19,"NM","B","BPS UNSTRAND SCREEN",117)

"BLD",5906,"KRN",19,"NM","B","BPS UPDATE REPORT MASTER FILE",100)

"BLD",5906,"KRN",19,"NM","B","BPS USER MENU",121)

"BLD",5906,"KRN",19,"NM","B","BPS USER PREFERENCES",102)

"BLD",5906,"KRN",19,"NM","B","BPS USER SCREEN",103)

"BLD",5906,"KRN",19,"NM","B","BPS VOLUME SURVEY",104)

"BLD",5906,"KRN",19,"NM","B","BPS WRITEOFF SELECTION",122)

"BLD",5906,"KRN",19,"NM","B","BPSMENU",106)

"BLD",5906,"KRN",19.1,0)
19.1
"BLD",5906,"KRN",19.1,"NM",0)
^9.68A^11^11
"BLD",5906,"KRN",19.1,"NM",1,0)
BPS BILLER^^1^
"BLD",5906,"KRN",19.1,"NM",2,0)
BPS MANAGER^^0
"BLD",5906,"KRN",19.1,"NM",3,0)
BPS REPORTS^^0
"BLD",5906,"KRN",19.1,"NM",4,0)
BPS USER^^0
"BLD",5906,"KRN",19.1,"NM",5,0)
BPSMENU^^0
"BLD",5906,"KRN",19.1,"NM",6,0)
BPS MASTER^^0
"BLD",5906,"KRN",19.1,"NM",7,0)
BPSZ BILLER^^1^
"BLD",5906,"KRN",19.1,"NM",8,0)
BPSZ MANAGER^^1^
"BLD",5906,"KRN",19.1,"NM",9,0)
BPSZ REPORTS^^1^
"BLD",5906,"KRN",19.1,"NM",10,0)
BPSZ USER^^1^
"BLD",5906,"KRN",19.1,"NM",11,0)
BPSZMENU^^1^
"BLD",5906,"KRN",19.1,"NM","B","BPS BILLER",1)

"BLD",5906,"KRN",19.1,"NM","B","BPS MANAGER",2)

"BLD",5906,"KRN",19.1,"NM","B","BPS MASTER",6)

"BLD",5906,"KRN",19.1,"NM","B","BPS REPORTS",3)

"BLD",5906,"KRN",19.1,"NM","B","BPS USER",4)

"BLD",5906,"KRN",19.1,"NM","B","BPSMENU",5)

"BLD",5906,"KRN",19.1,"NM","B","BPSZ BILLER",7)

"BLD",5906,"KRN",19.1,"NM","B","BPSZ MANAGER",8)

"BLD",5906,"KRN",19.1,"NM","B","BPSZ REPORTS",9)

"BLD",5906,"KRN",19.1,"NM","B","BPSZ USER",10)

"BLD",5906,"KRN",19.1,"NM","B","BPSZMENU",11)

"BLD",5906,"KRN",101,0)
101
"BLD",5906,"KRN",101,"NM",0)
^9.68A^82^80
"BLD",5906,"KRN",101,"NM",1,0)
BPS HIDDEN ACTIONS^^0
"BLD",5906,"KRN",101,"NM",2,0)
BPS P1 CANCEL CLAIM^^1^
"BLD",5906,"KRN",101,"NM",3,0)
BPS P1 CLAIM LOG^^1^
"BLD",5906,"KRN",101,"NM",4,0)
BPS P1 CLOSE^^1^
"BLD",5906,"KRN",101,"NM",5,0)
BPS P1 CONTINUOUS^^0
"BLD",5906,"KRN",101,"NM",6,0)
BPS P1 DISMISS^^1^
"BLD",5906,"KRN",101,"NM",7,0)
BPS P1 EXIT^^0^
"BLD",5906,"KRN",101,"NM",8,0)
BPS P1 HEADER^^1^
"BLD",5906,"KRN",101,"NM",9,0)
BPS P1 NEW CLAIMS^^0
"BLD",5906,"KRN",101,"NM",10,0)
BPS P1 PRINT ALL^^1^
"BLD",5906,"KRN",101,"NM",11,0)
BPS P1 PRINT PATIENT^^0
"BLD",5906,"KRN",101,"NM",12,0)
BPS P1 QUIT^^0
"BLD",5906,"KRN",101,"NM",13,0)
BPS P1 RECEIPT^^0
"BLD",5906,"KRN",101,"NM",14,0)
BPS P1 RESUBMIT^^1^
"BLD",5906,"KRN",101,"NM",15,0)
BPS P1 REVERSE CLAIM^^1^
"BLD",5906,"KRN",101,"NM",16,0)
BPS P1 UPDATE^^1^
"BLD",5906,"KRN",101,"NM",17,0)
BPS P2 CONTINUOUS^^0^
"BLD",5906,"KRN",101,"NM",18,0)
BPS P2 POKE^^0
"BLD",5906,"KRN",101,"NM",19,0)
BPS P2 TMIT JOBS^^0
"BLD",5906,"KRN",101,"NM",20,0)
BPS P2 TRANSMITTER^^0
"BLD",5906,"KRN",101,"NM",21,0)
BPS P2 UPDATE^^0
"BLD",5906,"KRN",101,"NM",22,0)
BPS P2 ZERO^^0
"BLD",5906,"KRN",101,"NM",23,0)
BPS PROTOCOL 1^^1^
"BLD",5906,"KRN",101,"NM",24,0)
BPS PROTOCOL 2^^0
"BLD",5906,"KRN",101,"NM",25,0)
BPSJ MFN REGISTER1^^0
"BLD",5906,"KRN",101,"NM",26,0)
BPSJ PAYER INPUT^^0
"BLD",5906,"KRN",101,"NM",27,0)
BPSJ PAYER RESPONSE^^0
"BLD",5906,"KRN",101,"NM",28,0)
BPSJ REGISTER^^0
"BLD",5906,"KRN",101,"NM",31,0)
BPS PRTCL UNSTRAND^^0
"BLD",5906,"KRN",101,"NM",32,0)
BPS PRTCL UNSTRAND ALL^^0
"BLD",5906,"KRN",101,"NM",33,0)
BPS PRTCL UNSTRAND SELECT^^0
"BLD",5906,"KRN",101,"NM",34,0)
BPS PRTCL UNSTRAND PRINT^^0
"BLD",5906,"KRN",101,"NM",35,0)
BPS PRTCL UNSTRAND EXIT^^0
"BLD",5906,"KRN",101,"NM",36,0)
BPS PRTCL CMT ADD^^0
"BLD",5906,"KRN",101,"NM",37,0)
BPS PRTCL CMT EXIT^^0
"BLD",5906,"KRN",101,"NM",38,0)
BPS PRTCL CMT MENU^^0
"BLD",5906,"KRN",101,"NM",39,0)
BPS PRTCL ECME USRSCR^^0
"BLD",5906,"KRN",101,"NM",40,0)
BPS PRTCL LOG MENU^^0
"BLD",5906,"KRN",101,"NM",41,0)
BPS PRTCL RSCH CLAIM TRACKING^^0
"BLD",5906,"KRN",101,"NM",42,0)
BPS PRTCL RSCH EXIT^^0
"BLD",5906,"KRN",101,"NM",43,0)
BPS PRTCL RSCH IB EVENT REPORT^^0
"BLD",5906,"KRN",101,"NM",44,0)
BPS PRTCL RSCH MENU^^0
"BLD",5906,"KRN",101,"NM",45,0)
BPS PRTCL RSCH ON HOLD COPAY^^0
"BLD",5906,"KRN",101,"NM",46,0)
BPS PRTCL RSCH RELEASE COPAY^^0
"BLD",5906,"KRN",101,"NM",47,0)
BPS PRTCL RSCH TPJI^^0
"BLD",5906,"KRN",101,"NM",48,0)
BPS PRTCL RSCH VIEW ELIG MENU^^0
"BLD",5906,"KRN",101,"NM",49,0)
BPS PRTCL RSCH VIEW ELIGIBILITY^^0
"BLD",5906,"KRN",101,"NM",50,0)
BPS PRTCL RSCH VIEW INSURANCE^^0
"BLD",5906,"KRN",101,"NM",51,0)
BPS PRTCL RSCH VIEW PRESCRIPTION^^0
"BLD",5906,"KRN",101,"NM",52,0)
BPS PRTCL USRSCR CHANGE VIEW^^0
"BLD",5906,"KRN",101,"NM",53,0)
BPS PRTCL USRSCR CLAIM LOG^^0
"BLD",5906,"KRN",101,"NM",54,0)
BPS PRTCL USRSCR CLOSE^^0
"BLD",5906,"KRN",101,"NM",55,0)
BPS PRTCL USRSCR COMMENT^^0
"BLD",5906,"KRN",101,"NM",56,0)
BPS PRTCL USRSCR CONTINUOUS^^0
"BLD",5906,"KRN",101,"NM",57,0)
BPS PRTCL USRSCR DEVELOPER LOG^^0
"BLD",5906,"KRN",101,"NM",58,0)
BPS PRTCL USRSCR EXIT^^0
"BLD",5906,"KRN",101,"NM",59,0)
BPS PRTCL USRSCR HIDDEN ACTIONS^^0
"BLD",5906,"KRN",101,"NM",60,0)
BPS PRTCL USRSCR PRINT^^0
"BLD",5906,"KRN",101,"NM",61,0)
BPS PRTCL USRSCR RESEARCH MENU^^0
"BLD",5906,"KRN",101,"NM",62,0)
BPS PRTCL USRSCR RESUBMIT^^0
"BLD",5906,"KRN",101,"NM",63,0)
BPS PRTCL USRSCR REVERSE^^0
"BLD",5906,"KRN",101,"NM",64,0)
BPS PRTCL USRSCR SORTLIST^^0
"BLD",5906,"KRN",101,"NM",65,0)
BPS PRTCL USRSCR UPDATE^^0
"BLD",5906,"KRN",101,"NM",66,0)
BPS VALM DOWN A LINE^^0
"BLD",5906,"KRN",101,"NM",67,0)
BPS VALM UP ONE LINE^^0
"BLD",5906,"KRN",101,"NM",68,0)
BPS VALM FIRST SCREEN^^0
"BLD",5906,"KRN",101,"NM",69,0)
BPS VALM GOTO PAGE^^0
"BLD",5906,"KRN",101,"NM",70,0)
BPS VALM LAST SCREEN^^0
"BLD",5906,"KRN",101,"NM",71,0)
BPS VALM NEXT SCREEN^^0
"BLD",5906,"KRN",101,"NM",72,0)
BPS VALM PREVIOUS SCREEN^^0
"BLD",5906,"KRN",101,"NM",73,0)
BPS VALM PRINT SCREEN^^0
"BLD",5906,"KRN",101,"NM",74,0)
BPS ECMECL1 NTE^^0
"BLD",5906,"KRN",101,"NM",75,0)
BPS ECMESV1 NTE^^0
"BLD",5906,"KRN",101,"NM",76,0)
VALM LEFT^^4^
"BLD",5906,"KRN",101,"NM",77,0)
VALM PRINT LIST^^4^
"BLD",5906,"KRN",101,"NM",78,0)
VALM QUIT^^4^
"BLD",5906,"KRN",101,"NM",79,0)
VALM REFRESH^^4^
"BLD",5906,"KRN",101,"NM",80,0)
VALM RIGHT^^4^
"BLD",5906,"KRN",101,"NM",81,0)
VALM SEARCH LIST^^4^
"BLD",5906,"KRN",101,"NM",82,0)
VALM TURN ON/OFF MENUS^^4^
"BLD",5906,"KRN",101,"NM","B","BPS ECMECL1 NTE",74)

"BLD",5906,"KRN",101,"NM","B","BPS ECMESV1 NTE",75)

"BLD",5906,"KRN",101,"NM","B","BPS HIDDEN ACTIONS",1)

"BLD",5906,"KRN",101,"NM","B","BPS P1 CANCEL CLAIM",2)

"BLD",5906,"KRN",101,"NM","B","BPS P1 CLAIM LOG",3)

"BLD",5906,"KRN",101,"NM","B","BPS P1 CLOSE",4)

"BLD",5906,"KRN",101,"NM","B","BPS P1 CONTINUOUS",5)

"BLD",5906,"KRN",101,"NM","B","BPS P1 DISMISS",6)

"BLD",5906,"KRN",101,"NM","B","BPS P1 EXIT",7)

"BLD",5906,"KRN",101,"NM","B","BPS P1 HEADER",8)

"BLD",5906,"KRN",101,"NM","B","BPS P1 NEW CLAIMS",9)

"BLD",5906,"KRN",101,"NM","B","BPS P1 PRINT ALL",10)

"BLD",5906,"KRN",101,"NM","B","BPS P1 PRINT PATIENT",11)

"BLD",5906,"KRN",101,"NM","B","BPS P1 QUIT",12)

"BLD",5906,"KRN",101,"NM","B","BPS P1 RECEIPT",13)

"BLD",5906,"KRN",101,"NM","B","BPS P1 RESUBMIT",14)

"BLD",5906,"KRN",101,"NM","B","BPS P1 REVERSE CLAIM",15)

"BLD",5906,"KRN",101,"NM","B","BPS P1 UPDATE",16)

"BLD",5906,"KRN",101,"NM","B","BPS P2 CONTINUOUS",17)

"BLD",5906,"KRN",101,"NM","B","BPS P2 POKE",18)

"BLD",5906,"KRN",101,"NM","B","BPS P2 TMIT JOBS",19)

"BLD",5906,"KRN",101,"NM","B","BPS P2 TRANSMITTER",20)

"BLD",5906,"KRN",101,"NM","B","BPS P2 UPDATE",21)

"BLD",5906,"KRN",101,"NM","B","BPS P2 ZERO",22)

"BLD",5906,"KRN",101,"NM","B","BPS PROTOCOL 1",23)

"BLD",5906,"KRN",101,"NM","B","BPS PROTOCOL 2",24)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL CMT ADD",36)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL CMT EXIT",37)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL CMT MENU",38)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL ECME USRSCR",39)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL LOG MENU",40)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL RSCH CLAIM TRACKING",41)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL RSCH EXIT",42)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL RSCH IB EVENT REPORT",43)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL RSCH MENU",44)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL RSCH ON HOLD COPAY",45)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL RSCH RELEASE COPAY",46)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL RSCH TPJI",47)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL RSCH VIEW ELIG MENU",48)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL RSCH VIEW ELIGIBILITY",49)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL RSCH VIEW INSURANCE",50)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL RSCH VIEW PRESCRIPTION",51)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL UNSTRAND",31)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL UNSTRAND ALL",32)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL UNSTRAND EXIT",35)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL UNSTRAND PRINT",34)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL UNSTRAND SELECT",33)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR CHANGE VIEW",52)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR CLAIM LOG",53)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR CLOSE",54)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR COMMENT",55)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR CONTINUOUS",56)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR DEVELOPER LOG",57)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR EXIT",58)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR HIDDEN ACTIONS",59)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR PRINT",60)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR RESEARCH MENU",61)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR RESUBMIT",62)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR REVERSE",63)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR SORTLIST",64)

"BLD",5906,"KRN",101,"NM","B","BPS PRTCL USRSCR UPDATE",65)

"BLD",5906,"KRN",101,"NM","B","BPS VALM DOWN A LINE",66)

"BLD",5906,"KRN",101,"NM","B","BPS VALM FIRST SCREEN",68)

"BLD",5906,"KRN",101,"NM","B","BPS VALM GOTO PAGE",69)

"BLD",5906,"KRN",101,"NM","B","BPS VALM LAST SCREEN",70)

"BLD",5906,"KRN",101,"NM","B","BPS VALM NEXT SCREEN",71)

"BLD",5906,"KRN",101,"NM","B","BPS VALM PREVIOUS SCREEN",72)

"BLD",5906,"KRN",101,"NM","B","BPS VALM PRINT SCREEN",73)

"BLD",5906,"KRN",101,"NM","B","BPS VALM UP ONE LINE",67)

"BLD",5906,"KRN",101,"NM","B","BPSJ MFN REGISTER1",25)

"BLD",5906,"KRN",101,"NM","B","BPSJ PAYER INPUT",26)

"BLD",5906,"KRN",101,"NM","B","BPSJ PAYER RESPONSE",27)

"BLD",5906,"KRN",101,"NM","B","BPSJ REGISTER",28)

"BLD",5906,"KRN",101,"NM","B","VALM LEFT",76)

"BLD",5906,"KRN",101,"NM","B","VALM PRINT LIST",77)

"BLD",5906,"KRN",101,"NM","B","VALM QUIT",78)

"BLD",5906,"KRN",101,"NM","B","VALM REFRESH",79)

"BLD",5906,"KRN",101,"NM","B","VALM RIGHT",80)

"BLD",5906,"KRN",101,"NM","B","VALM SEARCH LIST",81)

"BLD",5906,"KRN",101,"NM","B","VALM TURN ON/OFF MENUS",82)

"BLD",5906,"KRN",409.61,0)
409.61
"BLD",5906,"KRN",409.61,"NM",0)
^9.68A^8^8
"BLD",5906,"KRN",409.61,"NM",1,0)
BPS STATISTICS AND MANAGEMENT^^0
"BLD",5906,"KRN",409.61,"NM",2,0)
BPS USER SCREEN^^1^
"BLD",5906,"KRN",409.61,"NM",3,0)
BPS LSTMN ECME UNSTRAND^^0
"BLD",5906,"KRN",409.61,"NM",4,0)
BPS LSTMN COMMENTS^^0
"BLD",5906,"KRN",409.61,"NM",5,0)
BPS LSTMN DEVLOG^^0
"BLD",5906,"KRN",409.61,"NM",6,0)
BPS LSTMN ECME USRSCR^^0
"BLD",5906,"KRN",409.61,"NM",7,0)
BPS LSTMN LOG^^0
"BLD",5906,"KRN",409.61,"NM",8,0)
BPS LSTMN RSCH MENU^^0
"BLD",5906,"KRN",409.61,"NM","B","BPS LSTMN COMMENTS",4)

"BLD",5906,"KRN",409.61,"NM","B","BPS LSTMN DEVLOG",5)

"BLD",5906,"KRN",409.61,"NM","B","BPS LSTMN ECME UNSTRAND",3)

"BLD",5906,"KRN",409.61,"NM","B","BPS LSTMN ECME USRSCR",6)

"BLD",5906,"KRN",409.61,"NM","B","BPS LSTMN LOG",7)

"BLD",5906,"KRN",409.61,"NM","B","BPS LSTMN RSCH MENU",8)

"BLD",5906,"KRN",409.61,"NM","B","BPS STATISTICS AND MANAGEMENT",1)

"BLD",5906,"KRN",409.61,"NM","B","BPS USER SCREEN",2)

"BLD",5906,"KRN",771,0)
771
"BLD",5906,"KRN",771,"NM",0)
^9.68A^2^2
"BLD",5906,"KRN",771,"NM",1,0)
VITRIA NC^^0
"BLD",5906,"KRN",771,"NM",2,0)
ECME VISTA^^0
"BLD",5906,"KRN",771,"NM","B","ECME VISTA",2)

"BLD",5906,"KRN",771,"NM","B","VITRIA NC",1)

"BLD",5906,"KRN",870,0)
870
"BLD",5906,"KRN",870,"NM",0)
^9.68A^1^1
"BLD",5906,"KRN",870,"NM",1,0)
BPS NCPDP^^0
"BLD",5906,"KRN",870,"NM","B","BPS NCPDP",1)

"BLD",5906,"KRN",8989.51,0)
8989.51
"BLD",5906,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",5906,"KRN",8989.51,"NM",1,0)
BPS USRSCR^^0
"BLD",5906,"KRN",8989.51,"NM","B","BPS USRSCR",1)

"BLD",5906,"KRN",8989.52,0)
8989.52
"BLD",5906,"KRN",8994,0)
8994
"BLD",5906,"KRN","B",.4,.4)

"BLD",5906,"KRN","B",.401,.401)

"BLD",5906,"KRN","B",.402,.402)

"BLD",5906,"KRN","B",.403,.403)

"BLD",5906,"KRN","B",.5,.5)

"BLD",5906,"KRN","B",.84,.84)

"BLD",5906,"KRN","B",3.6,3.6)

"BLD",5906,"KRN","B",3.8,3.8)

"BLD",5906,"KRN","B",9.2,9.2)

"BLD",5906,"KRN","B",9.8,9.8)

"BLD",5906,"KRN","B",19,19)

"BLD",5906,"KRN","B",19.1,19.1)

"BLD",5906,"KRN","B",101,101)

"BLD",5906,"KRN","B",409.61,409.61)

"BLD",5906,"KRN","B",771,771)

"BLD",5906,"KRN","B",870,870)

"BLD",5906,"KRN","B",8989.51,8989.51)

"BLD",5906,"KRN","B",8989.52,8989.52)

"BLD",5906,"KRN","B",8994,8994)

"BLD",5906,"QUES",0)
^9.62^^0
"BLD",5906,"REQB",0)
^9.611^1^1
"BLD",5906,"REQB",1,0)
BPS 1.0^2
"BLD",5906,"REQB","B","BPS 1.0",1)

"DATA",9002313.21,1,0)
00^NO INTERVENTION
"DATA",9002313.21,2,0)
AS^PATIENT ASSESSMENT
"DATA",9002313.21,3,0)
FE^FORMULARY ENFORCEMENT
"DATA",9002313.21,4,0)
CC^COORDINATION OF CARE
"DATA",9002313.21,5,0)
GP^GENERIC PRODUCT SELECTION
"DATA",9002313.21,6,0)
DE^DOSING EVALUATION/DETERMINATION
"DATA",9002313.21,7,0)
PH^PATIENT MEDICATION HISTORY
"DATA",9002313.21,8,0)
M0^PRESCRIBER CONSULTED
"DATA",9002313.21,9,0)
SW^LITERATURE SEARCH/REVIEW
"DATA",9002313.21,10,0)
MA^MEDICATION ADMINISTRATION
"DATA",9002313.21,11,0)
TC^PAYER/PROCESSOR CONSULTED
"DATA",9002313.21,12,0)
MR^MEDICATION REVIEW
"DATA",9002313.21,13,0)
TH^THERAPEUTIC PRODUCT INTERCHANGE
"DATA",9002313.21,14,0)
P0^PATIENT CONSULTED
"DATA",9002313.21,15,0)
PE^PATIENT EDUCATION/INSTRUCTION
"DATA",9002313.21,16,0)
PF^PATIENT REFERRAL
"DATA",9002313.21,17,0)
PM^PATIENT MONITORING
"DATA",9002313.21,18,0)
R0^PHARMACIST CONSULTED OTHER SOURCE
"DATA",9002313.21,19,0)
RT^RECOMMENDED LABORATORY TEST
"DATA",9002313.21,20,0)
SC^SELF-CARE CONSULTATION
"DATA",9002313.22,1,0)
00^NOT SPECIFIED
"DATA",9002313.22,2,0)
2A^PRESCRIPTION NOT FILLED
"DATA",9002313.22,3,0)
3A^RECOMMENDATION ACCEPTED
"DATA",9002313.22,4,0)
1A^FILLED AS IS, FALSE POSITIVE
"DATA",9002313.22,5,0)
2B^NOT FILLED, DIRECTIONS CLARIFIED
"DATA",9002313.22,6,0)
3B^RECOMMENDATION NOT ACCEPTED
"DATA",9002313.22,7,0)
1B^FILLED PRESCRIPTION AS IS
"DATA",9002313.22,8,0)
3C^DISCONTINUED DRUG
"DATA",9002313.22,9,0)
1C^FILLED, WITH DIFFERENT DOSE
"DATA",9002313.22,10,0)
3D^REGIMEN CHANGED
"DATA",9002313.22,11,0)
1D^FILLED, WITH DIFFERENT DIRECTIONS
"DATA",9002313.22,12,0)
3E^THERAPY CHANGED
"DATA",9002313.22,13,0)
1E^FILLED, WITH DIFFERENT DRUG
"DATA",9002313.22,14,0)
3F^THERAPY CHANGED - COST INCREASE ACKNOWLEDGED
"DATA",9002313.22,15,0)
1F^FILLED, WITH DIFFERENT QUANTITY
"DATA",9002313.22,16,0)
3G^DRUG THERAPY UNCHANGED
"DATA",9002313.22,17,0)
1G^FILLED, WITH PRESCRIBER APPROVAL
"DATA",9002313.22,18,0)
3H^FOLLOW-UP REPORT
"DATA",9002313.22,19,0)
1H^BRAND-TO-GENERIC CHANGE
"DATA",9002313.22,20,0)
3J^PATIENT REFERRAL
"DATA",9002313.22,21,0)
1J^RX-TO-OTC CHANGE
"DATA",9002313.22,22,0)
3M^COMPLIANCE AID PROVIDED
"DATA",9002313.22,23,0)
1K^FILLED, WITH DIFFERENT DOSAGE FORM
"DATA",9002313.23,1,0)
AN^PRESCRIPTION AUTHENTICATION
"DATA",9002313.23,2,0)
ER^OVERUSE PRECAUTION
"DATA",9002313.23,3,0)
DF^DRUG-FOOD INTERACTION
"DATA",9002313.23,4,0)
CH^CALL HELP DESK
"DATA",9002313.23,5,0)
DA^DRUG-ALLERGY ALERT
"DATA",9002313.23,6,0)
DL^DRUG-LAB CONFLICT
"DATA",9002313.23,7,0)
MS^MISSING INFORMATION/CLARIFICATION
"DATA",9002313.23,8,0)
MX^EXCESSIVE DURATION ALERT
"DATA",9002313.23,9,0)
DC^DRUG DISEASE INFERRED PRECAUTION
"DATA",9002313.23,10,0)
CS^PATIENT COMPLAINT/SYMPTOM
"DATA",9002313.23,11,0)
DS^TOBACCO USE PRECAUTION
"DATA",9002313.23,12,0)
NA^DRUG NOT AVAILABLE
"DATA",9002313.23,13,0)
HD^HIGH DOSE ALERT
"DATA",9002313.23,14,0)
DD^DRUG-DRUG INTERACTION
"DATA",9002313.23,15,0)
DM^APPARENT DRUG MISUSE
"DATA",9002313.23,16,0)
OH^ALCOHOL PRECAUTION
"DATA",9002313.23,17,0)
NC^NON-COVERED DRUG PURCHASE
"DATA",9002313.23,18,0)
LD^LOW DOSE ALERT
"DATA",9002313.23,19,0)
DI^DRUG INCOMPATIBILITY
"DATA",9002313.23,20,0)
ED^PATIENT EDUCATION/INSTRUCTION
"DATA",9002313.23,21,0)
NF^NON-FORMULARY DRUG
"DATA",9002313.23,22,0)
LR^UNDERUSE PRECAUTION
"DATA",9002313.23,23,0)
IC^IATROGENIC CONDITION ALERT
"DATA",9002313.23,24,0)
ND^NEW DISEASE/DIAGNOSIS
"DATA",9002313.23,25,0)
SE^SIDE EFFECT ALERT
"DATA",9002313.23,26,0)
NP^NEW PATIENT PROCESSING
"DATA",9002313.23,27,0)
MN^INSUFFICIENT DURATION ALERT
"DATA",9002313.23,28,0)
ID^INGREDIENT DUPLICATION
"DATA",9002313.23,29,0)
NN^UNNECESSARY DRUG
"DATA",9002313.23,30,0)
PS^PRODUCT SELECTION OPPORTUNITY
"DATA",9002313.23,31,0)
NS^INSUFFICIENT QUANTITY
"DATA",9002313.23,32,0)
MC^DRUG DISEASE (ACTUAL) PRECAUTION
"DATA",9002313.23,33,0)
PC^PATIENT QUESTION/CONCERN
"DATA",9002313.23,34,0)
PP^PLAN PROTOCOL
"DATA",9002313.23,35,0)
SF^SUBOPTIMAL DOSAGE FORM
"DATA",9002313.23,36,0)
NR^LACTATION/NURSING INTERACTION
"DATA",9002313.23,37,0)
PN^PRESCRIBER CONSULTATION
"DATA",9002313.23,38,0)
TP^PAYER/PROCESSOR QUESTION
"DATA",9002313.23,39,0)
SR^SUBOPTIMAL REGIMEN
"DATA",9002313.23,40,0)
PA^DRUG-AGE PRECAUTION
"DATA",9002313.23,41,0)
RF^HEALTH PROVIDER REFERRAL
"DATA",9002313.23,42,0)
PG^DRUG-PREGNANCY ALERT
"DATA",9002313.23,43,0)
SD^SUBOPTIMAL DRUG/INDICATION
"DATA",9002313.23,44,0)
PR^PRIOR ADVERSE DRUG REACTION
"DATA",9002313.23,45,0)
TN^LABORATORY TEST NEEDED
"DATA",9002313.23,46,0)
SX^DRUG-GENDER ALERT
"DATA",9002313.23,47,0)
TD^THERAPEUTIC DUPLICATION
"DATA",9002313.23,48,0)
LK^LOCK IN RECIPIENT
"DATA",9002313.23,49,0)
CD^CHRONIC DISEASE MANAGEMENT
"DATA",9002313.23,50,0)
RE^SUSPECTED ENVIRONMENTAL RISK
"DATA",9002313.23,51,0)
PH^PREVENTIVE HEALTH CARE
"DATA",9002313.23,52,0)
SC^SUBOPTIMAL COMPLIANCE
"DATA",9002313.23,53,0)
AT^ADDITIVE TOXICITY
"DATA",9002313.23,54,0)
AD^ADDITIONAL DRUG NEEDED
"DATA",9002313.23,55,0)
AR^ADVERSE DRUG REACTION
"DATA",9002313.23,56,0)
EX^EXCESSIVE QUANTITY
"DATA",9002313.24,1,0)
0^NO PRODUCT SELECTION INDICATED
"DATA",9002313.24,2,0)
1^SUBSTITUTION NOT ALLOWED BY PRESCRIBER
"DATA",9002313.24,3,0)
2^SUBSTITUTION ALLOWED-PATIENT REQUESTED PRODUCT DISPENSED
"DATA",9002313.24,4,0)
3^SUBSTITUTION ALLOWED-PHARMACIST SELECTED PRODUCT DISPENSED
"DATA",9002313.24,5,0)
4^SUBSTITUTION ALLOWED-GENERIC DRUG NOT IN STOCK
"DATA",9002313.24,6,0)
5^SUBSTITUTION ALLOWED-BRAND DRUG DISPENSED AS A GENERIC
"DATA",9002313.24,7,0)
6^OVERRIDE
"DATA",9002313.24,8,0)
7^SUBSTITUTION NOT ALLOWED-BRAND DRUG MANDATED BY LAW
"DATA",9002313.24,9,0)
8^SUBSTITUTION ALLOWED-GENERIC DRUG NOT AVAILABLE IN MARKETPLACE
"DATA",9002313.24,10,0)
9^OTHER
"DATA",9002313.516,1,0)
RPMS PHARM DIRECT CALL TO POS
"DATA",9002313.516,1,1,0)
^9002313.5161^7^7^3040819^^^^
"DATA",9002313.516,1,1,1,0)
RPMS Pharmacy package calls CLAIM^BPSOSRX(RXI,RXR,.MOREDATA)
"DATA",9002313.516,1,1,2,0)
with MOREDATA("ORIGIN") undefined (or =1)
"DATA",9002313.516,1,1,3,0)
^BPSOSRB handles this in the background.
"DATA",9002313.516,1,1,4,0)
^BPSOSRB calls FILING^BPSOSIV, passing parameter ORIGIN = 1,
"DATA",9002313.516,1,1,5,0)
FILING^BPSOSIV fakes old-style input, creates a 9002313.51 record
"DATA",9002313.516,1,1,6,0)
with the ORIGIN field = 1.  BPSOSIV then calls FILE^BPSOSIZ,
"DATA",9002313.516,1,1,7,0)
which puts the ORIGIN into 9002313.59.
"DATA",9002313.516,2,0)
USER INPUT VIA SCREENMAN
"DATA",9002313.516,2,1,0)
^^4^4^3001117^
"DATA",9002313.516,2,1,1,0)
Data entry done via Screenman, called from routine ^BPSOSI,
"DATA",9002313.516,2,1,2,0)
which creates a 9002313.51 record.  The ORIGIN field is set to 2.
"DATA",9002313.516,2,1,3,0)
Then FILE^BPSOSIZ creates a 9002313.59 record with ORIGIN field
"DATA",9002313.516,2,1,4,0)
copied from the 9002313.51 ORIGIN field.
"DATA",9002313.516,3,0)
USER INPUT, OLD STYLE
"DATA",9002313.516,3,1,0)
^^6^6^3001117^
"DATA",9002313.516,3,1,1,0)
Data entry done by old style input, just prescription #s and 
"DATA",9002313.516,3,1,2,0)
NDC #s.  Probably only ANMC and SEARHC. 
"DATA",9002313.516,3,1,3,0)
FILING^BPSOSIV called with the ORIGIN parameter = 3.
"DATA",9002313.516,3,1,4,0)
It creates a 9002313.51 record with ORIGIN field,
"DATA",9002313.516,3,1,5,0)
then it calls FILE^BPSOSIZ, which copies the 9002313.51 ORIGIN field
"DATA",9002313.516,3,1,6,0)
into a 9002313.59 record's ORIGIN field.
"DATA",9002313.516,4,0)
RESERVED (IEN 4)
"DATA",9002313.516,5,0)
RESERVED (IEN 5)
"DATA",9002313.516,6,0)
BACKGROUND MONITOR OF PSRX
"DATA",9002313.516,6,1,0)
^^1^1^3001117^
"DATA",9002313.516,6,1,1,0)
(to be implemented)
"DATA",9002313.516,7,0)
BPSOSR1 TESTING ROUTINE
"DATA",9002313.516,7,1,0)
^^1^1^3001117^
"DATA",9002313.516,7,1,1,0)
TEST^BPSOSR1 used in testing to submit lots of prescriptions at once.
"DATA",9002313.81,1,0)
SELF^1
"DATA",9002313.81,2,0)
HUSBAND^2
"DATA",9002313.81,3,0)
WIFE^2
"DATA",9002313.81,4,0)
SPOUSE^2
"DATA",9002313.81,5,0)
SON^3
"DATA",9002313.81,6,0)
DAUGHTER^3
"DATA",9002313.81,7,0)
NATURAL CHILD^3
"DATA",9002313.83,1,0)
PAPER^PAPER
"DATA",9002313.83,2,0)
E PAYABLE^PAY^PAYABLE
"DATA",9002313.83,3,0)
E CAPTURED^CAP^CAPTURED
"DATA",9002313.83,4,0)
E DUPLICATE^DUP^DUPLICATE
"DATA",9002313.83,5,0)
E REJECTED^REJ^REJECTED
"DATA",9002313.83,6,0)
E OTHER^ERROR^OTHER
"DATA",9002313.83,7,0)
PAPER REVERSAL^REV^REVERSED (PAPER)
"DATA",9002313.83,8,0)
E REVERSAL ACCEPTED^REV^REVERSED (ELEC)
"DATA",9002313.83,9,0)
E REVERSAL REJECTED^ERROR
"DATA",9002313.83,10,0)
E REVERSAL OTHER^ERROR
"DATA",9002313.83,11,0)
CORRUPT^ERROR
"DATA",9002313.83,12,0)
CANCELLED^CAN
"DATA",9002313.83,13,0)
E STRANDED^STR^STRANDED
"DATA",9002313.89,20001,0)
20001^NDC Logon Error:  Undefined Function Parameter [BPSECT1]
"DATA",9002313.89,20002,0)
20002^NDC Logon Error:  Undefined Record in File 9002313.99
"DATA",9002313.89,20003,0)
20003^NDC Logon Error:  Non-Supported MUMPS System
"DATA",9002313.89,20004,0)
20004^NDC Logon Error:  Undefined Variable 'DialPar' [BPSECT1]
"DATA",9002313.89,20005,0)
20005^NDC Logon Error:  Undefined Variable 'IO' [BPSECT1]
"DATA",9002313.89,20006,0)
20006^NDC Logon Error:  Undefined Variable 'DMode' [BPSECT1]
"DATA",9002313.89,20007,0)
20007^NDC Logon Error:  Undefined Variable(s) 'Direct1, Sprint1' [BPSECT1]
"DATA",9002313.89,20008,0)
20008^NDC Logon Error:  Modem not Responding to ATZ Command
"DATA",9002313.89,20009,0)
20009^NDC Logon Error:  Modem not Responding to Initialization Commands
"DATA",9002313.89,20010,0)
20010^NDC Logon Error:  Direct Mode, not Receiving CONNECT 2400 Message
"DATA",9002313.89,20011,0)
20011^NDC Logon Error:  Sprint Mode, not Receiving CONNECT 2400 Message
"DATA",9002313.89,20012,0)
20012^NDC Logon Error:  Sprint Mode, not Receiving = Prompt
"DATA",9002313.89,20013,0)
20013^NDC Logon Error:  Sprint Mode, not Receiving @ Prompt
"DATA",9002313.89,20014,0)
20014^NDC Logon Error:  Sprint Mode, not Receiving CONNECTED Message
"DATA",9002313.89,20100,0)
20100^NDC Submitter Error:  Undefined Variable 'IO' [BPSECT2]
"DATA",9002313.89,20101,0)
20101^NDC Submitter Error:  Received EOT before 1st ENQ from host
"DATA",9002313.89,20102,0)
20102^NDC Submitter Error:  Did not receive 1st ENQ from host
"DATA",9002313.89,20103,0)
20103^NDC Submitter Error:  No records ready to be sent
"DATA",9002313.89,20104,0)
20104^NDC Submitter Error:  Claim record is NULL
"DATA",9002313.89,20105,0)
20105^NDC Submitter Error:  Host failed to respond to sent message
"DATA",9002313.89,20106,0)
20106^NDC Submitter Error:  Timeout occurred before host reponse
"DATA",9002313.89,20107,0)
20107^NDC Submitter Error:  Unable to process host NAK
"DATA",9002313.89,20108,0)
20108^NDC Submitter Error:  Unable to gather response message from host
"DATA",9002313.89,20109,0)
20109^NDC Submitter Error:  Timeout before ETX was received from host
"DATA",9002313.89,20110,0)
20110^NDC Submitter Error:  Host failed to send STX to begin re-transmission
"DATA",9002313.89,20111,0)
20111^NDC Submitter Error:  EOT received while waiting for ENQ or STX
"DATA",9002313.89,20112,0)
20112^NDC Submitter Error:  Timeout occurred while waiting for ENQ or STX
"DATA",9002313.89,20113,0)
20113^NDC Submitter Error:  EOT/timeout occurred while gathering host msg
"DATA",9002313.89,20114,0)
20114^NDC Submitter Error:  Null occurred while gathering host message
"DATA",9002313.91,1,0)
101^A1^BIN NUMBER^N^6
"DATA",9002313.91,1,5)
A1^6
"DATA",9002313.91,1,10,0)
^9002313.9101^1^1^3040130^^^^
"DATA",9002313.91,1,10,1,0)
S BPS("X")=$S(BPS("Site","Switch Type")="NDC":BPS("NCPDP","BIN  Number"),BPS("Site","Switch Type")="ENVOY":BPS("NCPDP","Envoy Plan  Number"),BPS("Site","Switch Type")="VA":BPS("NCPDP","BIN Number"))
"DATA",9002313.91,1,20,0)
^9002313.9102^1^1^3040130^^^^
"DATA",9002313.91,1,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,1,25,0)
^9002313.9104^1^1^3040130^^^^
"DATA",9002313.91,1,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,1,30,0)
^9002313.9103^1^1^3040130^^^^
"DATA",9002313.91,1,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,1)=BPS("X")
"DATA",9002313.91,2,0)
102^A2^VERSION/RELEASE NUMBER^A/N^2
"DATA",9002313.91,2,5)
A2^2
"DATA",9002313.91,2,10,0)
^9002313.9101^1^1^3040114^^^^
"DATA",9002313.91,2,10,1,0)
S BPS("X")=$G(BPS("NCPDP","Version"))
"DATA",9002313.91,2,20,0)
^9002313.9102^1^1^3040114^^^^
"DATA",9002313.91,2,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,2,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,2,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,2,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,2,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,2)=BPS("X")
"DATA",9002313.91,3,0)
103^A3^TRANSACTION CODE^N^2
"DATA",9002313.91,3,5)
A3^2
"DATA",9002313.91,3,10,0)
^9002313.9101^1^1^3040130^^^^
"DATA",9002313.91,3,10,1,0)
S BPS("X")=$G(BPS("Transaction Code"))
"DATA",9002313.91,3,20,0)
^9002313.9102^1^1^3040130^^^^
"DATA",9002313.91,3,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,3,25,0)
^9002313.9104^1^1^3040130^^^^
"DATA",9002313.91,3,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,3,30,0)
^9002313.9103^1^1^3040130^^^^
"DATA",9002313.91,3,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,3)=BPS("X")
"DATA",9002313.91,4,0)
104^A4^PROCESSOR CONTROL NUMBER^A/N^10
"DATA",9002313.91,4,5)
A4^10
"DATA",9002313.91,4,10,0)
^9002313.9101^5^5^3040820^^^^
"DATA",9002313.91,4,10,1,0)
S BPS("X")=$TR($J(BPS("Envoy Terminal ID"),10)," ","0")
"DATA",9002313.91,4,10,2,0)
; $RJZF'd for Envoy.  See special exception in BPSECC4 that makes
"DATA",9002313.91,4,10,3,0)
; this work.  Peciuliar to Field 104, where NDC sites all need the
"DATA",9002313.91,4,10,4,0)
; special XECUTE method, but Envoy just needs the terminal ID.
"DATA",9002313.91,4,10,5,0)
I $G(VARX) S BPS("X")=BPS("NCPDP","PCN")
"DATA",9002313.91,4,20,0)
^9002313.9102^1^1^3040820^^^^
"DATA",9002313.91,4,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,4,25,0)
^9002313.9104^1^1^3040820^^^^
"DATA",9002313.91,4,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,4,30,0)
^9002313.9103^1^1^3040820^^^^
"DATA",9002313.91,4,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,4)=BPS("X")
"DATA",9002313.91,5,0)
201^B1^SERVICE PROVIDER ID^A/N^12
"DATA",9002313.91,5,5)
B1^12
"DATA",9002313.91,5,10,0)
^9002313.9101^1^1^3040827^^^^
"DATA",9002313.91,5,10,1,0)
S BPS("X")=$G(BPS("Site","Pharmacy #"))
"DATA",9002313.91,5,20,0)
^9002313.9102^1^1^3040827^^^^
"DATA",9002313.91,5,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),12)
"DATA",9002313.91,5,25,0)
^9002313.9104^1^1^3040827^^^^
"DATA",9002313.91,5,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,5,30,0)
^9002313.9103^1^1^3040827^^^^
"DATA",9002313.91,5,30,1,0)
S $P(^BPSC(BPS(9002313.02),200),U,1)=BPS("X")
"DATA",9002313.91,6,0)
301^C1^GROUP NUMBER^A/N^15
"DATA",9002313.91,6,5)
C1^15
"DATA",9002313.91,6,10,0)
^9002313.9101^1^1^3041021^^
"DATA",9002313.91,6,10,1,0)
S BPS("X")=$G(BPS("Insurer","Group #"))
"DATA",9002313.91,6,20,0)
^9002313.9102^1^1^3041021^^^^
"DATA",9002313.91,6,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,6,25,0)
^9002313.9104^1^1^3041021^^^^
"DATA",9002313.91,6,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,6,30,0)
^9002313.9103^1^1^3041021^^^^
"DATA",9002313.91,6,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,1)=BPS("X")
"DATA",9002313.91,7,0)
302^^CARDHOLDER ID NUMBER^A/N^18
"DATA",9002313.91,7,5)
C2^20
"DATA",9002313.91,7,10,0)
^9002313.9101^1^1^3041021^^^^
"DATA",9002313.91,7,10,1,0)
S BPS("X")=$G(BPS("Insurer","Policy #"))
"DATA",9002313.91,7,20,0)
^9002313.9102^1^1^3041021^^^^
"DATA",9002313.91,7,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),18)
"DATA",9002313.91,7,25,0)
^^1^1^3051117^
"DATA",9002313.91,7,25,1,0)
S BPS("X")="C2"_$$ANFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,7,30,0)
^9002313.9103^1^1^3041021^^
"DATA",9002313.91,7,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,2)=$TR(BPS("X")," ","")
"DATA",9002313.91,8,0)
303^C3^PERSON CODE^A/N^3
"DATA",9002313.91,8,5)
C3^3
"DATA",9002313.91,8,10,0)
^9002313.9101^1^1^3040114^^^^
"DATA",9002313.91,8,10,1,0)
S BPS("X")=$G(BPS("Insurer","Person Code"))
"DATA",9002313.91,8,20,0)
^9002313.9102^1^1^3040114^^^^
"DATA",9002313.91,8,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,8,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,8,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,8,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,8,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,3)=BPS("X")
"DATA",9002313.91,9,0)
304^C4^DATE OF BIRTH^N^8
"DATA",9002313.91,9,5)
C4^8
"DATA",9002313.91,9,10,0)
^9002313.9101^1^1^3040820^^^^
"DATA",9002313.91,9,10,1,0)
S BPS("X")=$G(BPS("Patient","DOB"))
"DATA",9002313.91,9,20,0)
^9002313.9102^1^1^3040820^^^^
"DATA",9002313.91,9,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,9,25,0)
^9002313.9104^1^1^3040820^^^^
"DATA",9002313.91,9,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,9,30,0)
^9002313.9103^1^1^3040820^^^^
"DATA",9002313.91,9,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,4)=BPS("X")
"DATA",9002313.91,10,0)
305^C5^SEX CODE^N^1
"DATA",9002313.91,10,5)
C5^1
"DATA",9002313.91,10,10,0)
^9002313.9101^3^3^3040114^^^^
"DATA",9002313.91,10,10,1,0)
S BPS("X")=$G(BPS("Patient","Sex"))
"DATA",9002313.91,10,10,2,0)
S BPS("X")=$E(BPS("X"),1,1)
"DATA",9002313.91,10,10,3,0)
S BPS("X")=$S(BPS("X")="M":"1",BPS("X")="F":"2",1:"0")
"DATA",9002313.91,10,20,0)
^9002313.9102^1^1^3040114^^^^
"DATA",9002313.91,10,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,10,25,0)
^9002313.9104^1^1^3040114^^
"DATA",9002313.91,10,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,10,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,10,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,5)=BPS("X")
"DATA",9002313.91,11,0)
306^^RELATIONSHIP CODE^N^1
"DATA",9002313.91,11,5)
C6^1
"DATA",9002313.91,11,10,0)
^9002313.9101^1^1^3040114^^^^
"DATA",9002313.91,11,10,1,0)
S BPS("X")=$G(BPS("Insurer","Relationship"))
"DATA",9002313.91,11,20,0)
^9002313.9102^1^1^3040114^^^^
"DATA",9002313.91,11,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,11,25,0)
^9002313.9104^1^1^3040114^^^
"DATA",9002313.91,11,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,11,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,11,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,6)=BPS("X")
"DATA",9002313.91,12,0)
308^C8^OTHER COVERAGE CODE^N^1
"DATA",9002313.91,12,5)
C8^2
"DATA",9002313.91,12,10,0)
^9002313.9101^1^1^3040114^^^
"DATA",9002313.91,12,10,1,0)
S BPS("X")=$G(BPS("Patient","Other Coverage Code")) S:'BPS("X") BPS("X")=0
"DATA",9002313.91,12,20,0)
^9002313.9102^1^1^3040114^^^^
"DATA",9002313.91,12,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,12,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,12,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,12,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,12,30,1,0)
D FLD308^BPSOSSG
"DATA",9002313.91,13,0)
401^D1^DATE FILLED^N^8
"DATA",9002313.91,13,5)
D1^8
"DATA",9002313.91,13,10,0)
^9002313.9101^1^1^3040113^^
"DATA",9002313.91,13,10,1,0)
S BPS("X")=$G(BPS("RX",BPS("RX","0"),"Date Filled"))
"DATA",9002313.91,13,20,0)
^9002313.9102^1^1^3040113^^^^
"DATA",9002313.91,13,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,13,25,0)
^9002313.9104^1^1^3040113^^^^
"DATA",9002313.91,13,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,13,30,0)
^9002313.9103^2^2^3040113^^^^
"DATA",9002313.91,13,30,1,0)
S $P(^BPSC(BPS(9002313.02),401),U,1)=BPS("X")
"DATA",9002313.91,13,30,2,0)
S $P(^BPSC(BPS(9002313.02),400,BPS("RX","0"),400),U,1)=BPS("X")
"DATA",9002313.91,14,0)
307^C7^CUSTOMER LOCATION^A/N^2
"DATA",9002313.91,14,5)
C7^2
"DATA",9002313.91,14,10,0)
^9002313.9101^1^1^3040820^^^^
"DATA",9002313.91,14,10,1,0)
S BPS("X")=$G(BPS("Customer Location")) S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,14,20,0)
^9002313.9102^1^1^3040820^^^^
"DATA",9002313.91,14,20,1,0)
S BPS("X")="C7"_$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,14,25,0)
^9002313.9104^1^1^3040820^^
"DATA",9002313.91,14,25,1,0)
S BPS("X")="C7"_$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,14,30,0)
^9002313.9103^1^1^3040820^^^^
"DATA",9002313.91,14,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,7)=BPS("X")
"DATA",9002313.91,15,0)
309^C9^ELIGIBILITY CLARIFICATION CODE^N^1
"DATA",9002313.91,15,5)
C9^1
"DATA",9002313.91,15,10,0)
^9002313.9101^2^2^3040114^^
"DATA",9002313.91,15,10,1,0)
S BPS("X")=$G(BPS("Eligibility Clarification Code")) S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,15,10,2,0)
I $G(VARX) S BPS("X")=0  ;VA default is zero
"DATA",9002313.91,15,20,0)
^9002313.9102^1^1^3040114^^^^
"DATA",9002313.91,15,20,1,0)
S BPS("X")="C9"_$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,15,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,15,25,1,0)
S BPS("X")="C9"_$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,15,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,15,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,9)=BPS("X")
"DATA",9002313.91,16,0)
310^CA^PATIENT FIRST NAME^A/N^12
"DATA",9002313.91,16,5)
CA^12
"DATA",9002313.91,16,10,0)
^^2^2^3050727^
"DATA",9002313.91,16,10,1,0)
S BPS("X")=$G(BPS("Patient","First Name"))
"DATA",9002313.91,16,10,2,0)
I BPS("X")="" N X S X=$G(BPS("Patient","Name")) D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("GIVEN")) K X
"DATA",9002313.91,16,20,0)
^9002313.9102^1^1^3040820^^^^
"DATA",9002313.91,16,20,1,0)
S BPS("X")="CA"_$$ANFF^BPSECFM($G(BPS("X")),12)
"DATA",9002313.91,16,25,0)
^9002313.9104^1^1^3040820^^^^
"DATA",9002313.91,16,25,1,0)
S BPS("X")="CA"_$$ANFF^BPSECFM($G(BPS("X")),12)
"DATA",9002313.91,16,30,0)
^9002313.9103^1^1^3040820^^^^
"DATA",9002313.91,16,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,10)=BPS("X")
"DATA",9002313.91,17,0)
311^CB^PATIENT LAST NAME^A/N^15
"DATA",9002313.91,17,5)
CB^15
"DATA",9002313.91,17,10,0)
^^2^2^3050727^
"DATA",9002313.91,17,10,1,0)
S BPS("X")=$G(BPS("Patient","Last Name"))
"DATA",9002313.91,17,10,2,0)
I BPS("X")="" N X S X=$G(BPS("Patient","Name")) D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("FAMILY")) K X
"DATA",9002313.91,17,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,17,20,1,0)
S BPS("X")="CB"_$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,17,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,17,25,1,0)
S BPS("X")="CB"_$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,17,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,17,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,11)=BPS("X")
"DATA",9002313.91,18,0)
402^D2^PRESCRIPTION NUMBER^N^6
"DATA",9002313.91,18,5)
D2^7
"DATA",9002313.91,18,10,0)
^9002313.9101^1^1^3040109^^^
"DATA",9002313.91,18,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"RX IEN"))
"DATA",9002313.91,18,20,0)
^9002313.9102^2^2^3040109^^^^
"DATA",9002313.91,18,20,1,0)
I $L(BPS("X"))>6 S BPS("X")=$E(BPS("X"),$L(BPS("X"))-6,$L(BPS("X")))
"DATA",9002313.91,18,20,2,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),7)
"DATA",9002313.91,18,25,0)
^^2^2^3051102^
"DATA",9002313.91,18,25,1,0)
I $L(BPS("X"))>7 S BPS("X")=$E(BPS("X"),$L(BPS("X"))-6,$L(BPS("X")))
"DATA",9002313.91,18,25,2,0)
S BPS("X")="D2"_$$NFF^BPSECFM($G(BPS("X")),7)
"DATA",9002313.91,18,30,0)
^9002313.9103^1^1^3040109^^^^
"DATA",9002313.91,18,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,2)=BPS("X")
"DATA",9002313.91,19,0)
403^^NEW/REFILL CODE^N^2
"DATA",9002313.91,19,5)
D3^2
"DATA",9002313.91,19,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,19,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Refill #"))
"DATA",9002313.91,19,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,19,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,19,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,19,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,19,30,0)
1^9002313.9103^1^1^3030718^^^
"DATA",9002313.91,19,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,3)=BPS("X")
"DATA",9002313.91,20,0)
404^D4^METRIC QUANTITY^N^5
"DATA",9002313.91,20,5)
D4^5
"DATA",9002313.91,20,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,20,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Quantity"))+.5\1
"DATA",9002313.91,20,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,20,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),5)
"DATA",9002313.91,20,25,0)
^^1^1^3030718^
"DATA",9002313.91,20,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),5)
"DATA",9002313.91,20,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,20,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,4)=BPS("X")
"DATA",9002313.91,21,0)
405^D5^DAYS SUPPLY^N^3
"DATA",9002313.91,21,5)
D5^3
"DATA",9002313.91,21,10,0)
^9002313.9101^1^1^3040109^^^^
"DATA",9002313.91,21,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Days Supply"))
"DATA",9002313.91,21,20,0)
^9002313.9102^1^1^3030827^^^^
"DATA",9002313.91,21,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,21,25,0)
^9002313.9104^1^1^3030827^^^^
"DATA",9002313.91,21,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,21,30,0)
^9002313.9103^1^1^3030827^^^^
"DATA",9002313.91,21,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,5)=BPS("X")
"DATA",9002313.91,22,0)
406^D6^COMPOUND CODE^N^1
"DATA",9002313.91,22,5)
D6^407
"DATA",9002313.91,22,10,0)
^9002313.9101^2^2^3040114^^^^
"DATA",9002313.91,22,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Compound Code"))
"DATA",9002313.91,22,10,2,0)
S:BPS("X")="" BPS("X")=1
"DATA",9002313.91,22,20,0)
^9002313.9102^1^1^3040114^^^^
"DATA",9002313.91,22,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,22,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,22,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,22,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,22,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,6)=BPS("X")
"DATA",9002313.91,23,0)
407^D7^PRODUCT/SERVICE ID^A/N^11
"DATA",9002313.91,23,5)
D7^19
"DATA",9002313.91,23,10,0)
^9002313.9101^2^2^3030825^
"DATA",9002313.91,23,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"NDC"))
"DATA",9002313.91,23,10,2,0)
S BPS("X")=$$NDCF^BPSECFM(BPS("X"))
"DATA",9002313.91,23,20,0)
^9002313.9102^1^1^3030825^^^^
"DATA",9002313.91,23,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),11)
"DATA",9002313.91,23,25,0)
^9002313.9104^1^1^3030825^^^
"DATA",9002313.91,23,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),19)
"DATA",9002313.91,23,30,0)
^9002313.9103^1^1^3030825^^^^
"DATA",9002313.91,23,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,7)=BPS("X")
"DATA",9002313.91,24,0)
408^D8^OTHER COVERAGE CODE^N^1
"DATA",9002313.91,24,5)
D8^1
"DATA",9002313.91,24,10,0)
^9002313.9101^2^2^3030722^^^^
"DATA",9002313.91,24,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"DAW"))
"DATA",9002313.91,24,10,2,0)
S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,24,20,0)
^9002313.9102^1^1^3030722^^^^
"DATA",9002313.91,24,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,24,25,0)
^9002313.9104^1^1^3030722^^
"DATA",9002313.91,24,25,1,0)
S BPS("X")="D8"_$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,24,30,0)
^^1^1^3030722^
"DATA",9002313.91,24,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,8)=BPS("X")
"DATA",9002313.91,25,0)
409^^INGREDIENT COST^D^6
"DATA",9002313.91,25,5)
D9^8
"DATA",9002313.91,25,10,0)
^^1^1^3040907^
"DATA",9002313.91,25,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Gross Amount Due"))
"DATA",9002313.91,25,20,0)
^9002313.9102^1^1^3040907^^^^
"DATA",9002313.91,25,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,25,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,25,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,25,30,0)
^9002313.9103^1^1^3040907^^^^
"DATA",9002313.91,25,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,9)=BPS("X")
"DATA",9002313.91,26,0)
411^DB^PRESCRIBER ID^A/N^10
"DATA",9002313.91,26,5)
DB^15
"DATA",9002313.91,26,10,0)
^9002313.9101^8^8^3030823^^^^
"DATA",9002313.91,26,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Prescriber ID"))
"DATA",9002313.91,26,10,2,0)
; BPSOSCD set this Prescriber ID to the appropriate value: DEA or CAID #
"DATA",9002313.91,26,10,3,0)
; and it applied the Site default if needed, DEA or CAID #
"DATA",9002313.91,26,10,4,0)
; If this doesn't suffice, the format's special code for this field
"DATA",9002313.91,26,10,5,0)
; has BPS("RX",n,xxx) available for these fields xxx:
"DATA",9002313.91,26,10,6,0)
; Prescriber DEA #  and Prescriber CAID #
"DATA",9002313.91,26,10,7,0)
; and also  Prescriber Billing Location (ANMC only?)
"DATA",9002313.91,26,10,8,0)
; and also the BPS("Site","Default DEA #") and BPS("Site","Default CAID #")
"DATA",9002313.91,26,20,0)
^9002313.9102^1^1^3030823^^^^
"DATA",9002313.91,26,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,26,25,0)
^9002313.9104^1^1^3030823^^^
"DATA",9002313.91,26,25,1,0)
S BPS("X")="DB"_$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,26,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,26,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,11)=BPS("X")
"DATA",9002313.91,27,0)
414^DE^DATE PRESCRIPTION WRITTEN^N^8
"DATA",9002313.91,27,5)
DE^8
"DATA",9002313.91,27,10,0)
^9002313.9101^1^1^3040913^^^^
"DATA",9002313.91,27,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Date Written"))
"DATA",9002313.91,27,20,0)
^9002313.9102^1^1^3040913^^
"DATA",9002313.91,27,20,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")))
"DATA",9002313.91,27,25,0)
^9002313.9104^1^1^3040913^^^^
"DATA",9002313.91,27,25,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")))
"DATA",9002313.91,27,30,0)
^9002313.9103^1^1^3040913^^^^
"DATA",9002313.91,27,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,14)=BPS("X")
"DATA",9002313.91,28,0)
415^DF^NUMBER REFILLS AUTHORIZED^N^2
"DATA",9002313.91,28,5)
DF^2
"DATA",9002313.91,28,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,28,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"# Refills"))
"DATA",9002313.91,28,20,0)
^9002313.9102^1^1^3030718^^^
"DATA",9002313.91,28,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,28,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,28,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,28,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,28,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,15)=BPS("X")
"DATA",9002313.91,29,0)
419^^PRESCRIPTION ORIGIN CODE^N^1
"DATA",9002313.91,29,5)
DJ^1
"DATA",9002313.91,29,10,0)
^9002313.9101^2^2^3030721^^^^
"DATA",9002313.91,29,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Origin Code"))
"DATA",9002313.91,29,10,2,0)
S:BPS("X")="" BPS("X")="0"
"DATA",9002313.91,29,20,0)
^9002313.9102^1^1^3030721^^^^
"DATA",9002313.91,29,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,29,25,0)
^9002313.9104^1^1^3030721^^^^
"DATA",9002313.91,29,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,29,30,0)
^9002313.9103^1^1^3030721^^^^
"DATA",9002313.91,29,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,19)=BPS("X")
"DATA",9002313.91,30,0)
420^DK^PRESCRIPTION CLARIFICATION^N^2
"DATA",9002313.91,30,5)
DK^2
"DATA",9002313.91,30,10,0)
^9002313.9101^2^2^3030721^^^^
"DATA",9002313.91,30,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Clarification"))
"DATA",9002313.91,30,10,2,0)
S:BPS("X")="" BPS("X")="00"
"DATA",9002313.91,30,20,0)
^9002313.9102^1^1^3030721^^^^
"DATA",9002313.91,30,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,30,25,0)
^9002313.9104^1^1^3030721^^^^
"DATA",9002313.91,30,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,30,30,0)
^9002313.9103^1^1^3030721^^^^
"DATA",9002313.91,30,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,20)=BPS("X")
"DATA",9002313.91,31,0)
453^EJ^ORIG PRESCR PROD/SERV ID QUAL^N^2
"DATA",9002313.91,31,5)
EJ^2
"DATA",9002313.91,31,10,0)
^^1^1^3040907^
"DATA",9002313.91,31,10,1,0)
S BPS("X")=""
"DATA",9002313.91,31,20,0)
^9002313.9102^1^1^3040907^^^^
"DATA",9002313.91,31,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,31,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,31,25,1,0)
S BPS("X")=$$NFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,31,30,0)
^9002313.9103^1^1^3040907^^^
"DATA",9002313.91,31,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,3)=""
"DATA",9002313.91,32,0)
422^DM^CLINIC ID NUMBER^N^5
"DATA",9002313.91,32,5)
DM^5
"DATA",9002313.91,32,10,0)
^9002313.9101^1^1^3030718^^^
"DATA",9002313.91,32,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Clinic ID"))
"DATA",9002313.91,32,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,32,20,1,0)
S BPS("X")="DM"_$$NFF^BPSECFM($G(BPS("X")),5)
"DATA",9002313.91,32,25,0)
^^1^1^3030718^
"DATA",9002313.91,32,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),5)
"DATA",9002313.91,32,30,0)
^9002313.9103^1^1^3030718^^^
"DATA",9002313.91,32,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,22)=BPS("X")
"DATA",9002313.91,33,0)
423^DN^BASIS OF COST DETERMINATION^A/N^2
"DATA",9002313.91,33,5)
DN^2
"DATA",9002313.91,33,10,0)
^9002313.9101^1^1^3030916^^^^
"DATA",9002313.91,33,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Basis of Cost Determination"))
"DATA",9002313.91,33,20,0)
^9002313.9102^1^1^3030916^^^^
"DATA",9002313.91,33,20,1,0)
S BPS("X")="DN"_$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,33,25,0)
^9002313.9104^1^1^3030916^^^^
"DATA",9002313.91,33,25,1,0)
S BPS("X")="DN"_$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,33,30,0)
^9002313.9103^1^1^3030916^^^^
"DATA",9002313.91,33,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,23)=BPS("X")
"DATA",9002313.91,34,0)
424^DO^DIAGNOSIS CODE^A/N^6
"DATA",9002313.91,34,5)
DO^15
"DATA",9002313.91,34,10,0)
^9002313.9101^1^1^3030718^^
"DATA",9002313.91,34,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Diagnosis Code"))
"DATA",9002313.91,34,20,0)
^9002313.9102^1^1^3030718^^^
"DATA",9002313.91,34,20,1,0)
S BPS("X")="DO"_$$ANFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,34,25,0)
^^1^1^3030718^
"DATA",9002313.91,34,25,1,0)
S BPS("X")="DO"_$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,34,30,0)
^9002313.9103^1^1^3030718^^
"DATA",9002313.91,34,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,24)=BPS("X")
"DATA",9002313.91,35,0)
430^DU^GROSS AMOUNT DUE^D^6
"DATA",9002313.91,35,5)
DU^8
"DATA",9002313.91,35,10,0)
^9002313.9101^1^1^3030722^^^^
"DATA",9002313.91,35,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Gross Amount Due"))
"DATA",9002313.91,35,20,0)
^9002313.9102^1^1^3030722^^^^
"DATA",9002313.91,35,20,1,0)
S BPS("X")="DU"_$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,35,25,0)
^9002313.9104^1^1^3030722^^^
"DATA",9002313.91,35,25,1,0)
S BPS("X")="DU"_$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,35,30,0)
^9002313.9103^1^1^3030722^^^^
"DATA",9002313.91,35,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,30)=BPS("X")
"DATA",9002313.91,36,0)
433^DX^PATIENT PAID AMOUNT^D^6
"DATA",9002313.91,36,5)
DX^8
"DATA",9002313.91,36,10,0)
^9002313.9101^2^2^3030916^
"DATA",9002313.91,36,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Patient Paid Amount"))
"DATA",9002313.91,36,10,2,0)
I $G(VARX) S BPS("X")="0.00"
"DATA",9002313.91,36,20,0)
^9002313.9102^1^1^3030916^^^^
"DATA",9002313.91,36,20,1,0)
S BPS("X")="DX"_$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,36,25,0)
^9002313.9104^1^1^3030916^^^
"DATA",9002313.91,36,25,1,0)
S BPS("X")="DX"_$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,36,30,0)
^9002313.9103^1^1^3030916^^
"DATA",9002313.91,36,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),430),U,3)=BPS("X")
"DATA",9002313.91,37,0)
439^E4^DUR CONFLICT CODE^A/N^2
"DATA",9002313.91,37,5)
E4^2
"DATA",9002313.91,37,10,0)
^9002313.9101^1^1^3031230^
"DATA",9002313.91,37,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"DUR","DUR Conflict Code",439))
"DATA",9002313.91,37,20,0)
^9002313.9102^1^1^3031230^^^^
"DATA",9002313.91,37,20,1,0)
S BPS("X")="E4"_$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,37,25,0)
^9002313.9104^1^1^3031230^^
"DATA",9002313.91,37,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,37,30,0)
^9002313.9103^1^1^3031230^^^^
"DATA",9002313.91,37,30,1,0)
D FLD439^BPSOSSG
"DATA",9002313.91,38,0)
440^E5^DUR INTERVENTION CODE^A/N^2
"DATA",9002313.91,38,5)
E5^2
"DATA",9002313.91,38,10,0)
^9002313.9101^1^1^3031230^
"DATA",9002313.91,38,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"DUR","DUR Intervention Code",440))
"DATA",9002313.91,38,20,0)
^9002313.9102^1^1^3031230^^^^
"DATA",9002313.91,38,20,1,0)
S BPS("X")="E5"_$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,38,25,0)
^9002313.9104^1^1^3031230^^^^
"DATA",9002313.91,38,25,1,0)
S BPS("X")="E5"_$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,38,30,0)
^9002313.9103^2^2^3031230^^^^
"DATA",9002313.91,38,30,1,0)
D FLD440^BPSOSSG
"DATA",9002313.91,38,30,2,0)
;S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,40)=BPS("X")
"DATA",9002313.91,39,0)
441^E6^DUR OUTCOME CODE^A/N^2
"DATA",9002313.91,39,5)
E6^2
"DATA",9002313.91,39,10,0)
^9002313.9101^2^2^3031230^
"DATA",9002313.91,39,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"DUR","DUR Outcome Code",441))
"DATA",9002313.91,39,10,2,0)
S:BPS("X")="" BPS("X")="00"
"DATA",9002313.91,39,20,0)
^9002313.9102^1^1^3031230^^^^
"DATA",9002313.91,39,20,1,0)
S BPS("X")="E6"_$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,39,25,0)
^9002313.9104^1^1^3031230^^^^
"DATA",9002313.91,39,25,1,0)
S BPS("X")="E6"_$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,39,30,0)
^9002313.9103^2^2^3031230^^^^
"DATA",9002313.91,39,30,1,0)
D FLD441^BPSOSSG
"DATA",9002313.91,39,30,2,0)
;S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,41)=BPS("X")
"DATA",9002313.91,40,0)
442^E7^QUANTITY DISPENSED^N^8
"DATA",9002313.91,40,5)
E7^10
"DATA",9002313.91,40,10,0)
^9002313.9101^3^3^3040109^^
"DATA",9002313.91,40,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Quantity"))*1000
"DATA",9002313.91,40,10,2,0)
S:$D(BPS("RX",BPS(9002313.0201),"Metric Decimal Quantity")) BPS("X")=BPS("RX",BPS(9002313.0201),"Metric Decimal Quantity")*1000 ; can happen in certification testing
"DATA",9002313.91,40,10,3,0)
;I $G(VARX) S BPS("X")=$TR((BPS("RX",BPS(9002313.0201),"Quantity")*1000),".")
"DATA",9002313.91,40,20,0)
^9002313.9102^1^1^3040109^^^^
"DATA",9002313.91,40,20,1,0)
S BPS("X")="E7"_$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,40,25,0)
^9002313.9104^1^1^3040109^^^^
"DATA",9002313.91,40,25,1,0)
S BPS("X")="E7"_$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,40,30,0)
^9002313.9103^1^1^3040109^^^^
"DATA",9002313.91,40,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440),U,2)=BPS("X")
"DATA",9002313.91,41,0)
410^DA^SALES TAX^D^6
"DATA",9002313.91,41,5)
DA^8
"DATA",9002313.91,41,10,0)
^9002313.9101^1^1^3030718^^^
"DATA",9002313.91,41,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Sales Tax"))
"DATA",9002313.91,41,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,41,20,1,0)
S BPS("X")="DA"_$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,41,25,0)
^^1^1^3030718^
"DATA",9002313.91,41,25,1,0)
S BPS("X")="DA"_$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,41,30,0)
^9002313.9103^1^1^3030718^^^
"DATA",9002313.91,41,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,10)=BPS("X")
"DATA",9002313.91,42,0)
412^DC^DISPENSING FEE SUBMITTED^D^6
"DATA",9002313.91,42,5)
DC^8
"DATA",9002313.91,42,10,0)
^^1^1^3040907^
"DATA",9002313.91,42,10,1,0)
S BPS("X")=""
"DATA",9002313.91,42,20,0)
^9002313.9102^1^1^3040907^^^^
"DATA",9002313.91,42,20,1,0)
S BPS("X")="DC"_$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,42,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,42,25,1,0)
S BPS("X")="DC"_$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,42,30,0)
^9002313.9103^1^1^3040907^^^^
"DATA",9002313.91,42,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,12)=BPS("X")
"DATA",9002313.91,43,0)
416^DG^PA/MC CODE & NUMBER^N^12
"DATA",9002313.91,43,5)
DG^12
"DATA",9002313.91,43,10,0)
^^1^1^3030718^
"DATA",9002313.91,43,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Preauth #"))
"DATA",9002313.91,43,20,0)
^9002313.9102^5^5^3030718^^^^
"DATA",9002313.91,43,20,1,0)
S BPS("X")="DG"_$S(BPS("X"):"1",1:"0")_"0"_$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,43,20,2,0)
; the leading "10":  1 means "Preauthorization number", 0 is unspecified
"DATA",9002313.91,43,20,3,0)
; there are other possible values for the leading digit; see NCPDP Data
"DATA",9002313.91,43,20,4,0)
; Dictionary and perhaps individual formats (Oklahoma Medicaid and
"DATA",9002313.91,43,20,5,0)
; PCS, for example.)
"DATA",9002313.91,43,25,0)
^^1^1^3030718^
"DATA",9002313.91,43,25,1,0)
S BPS("X")="DG"_$S(BPS("X"):"1",1:"0")_"0"_$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,43,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,43,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,16)=BPS("X")
"DATA",9002313.91,44,0)
418^DI^LEVEL OF SERVICE^N^2
"DATA",9002313.91,44,5)
DI^2
"DATA",9002313.91,44,10,0)
^9002313.9101^2^2^3030718^
"DATA",9002313.91,44,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Level of Service"))
"DATA",9002313.91,44,10,2,0)
S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,44,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,44,20,1,0)
S BPS("X")="DI"_$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,44,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,44,25,1,0)
S BPS("X")="DI"_$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,44,30,0)
^9002313.9103^1^1^3030718^^^
"DATA",9002313.91,44,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,18)=BPS("X")
"DATA",9002313.91,45,0)
421^DL^PRIMARY PRESCRIBER^A/N^10
"DATA",9002313.91,45,5)
DL^15
"DATA",9002313.91,45,10,0)
^9002313.9101^4^4^3041015^^^^
"DATA",9002313.91,45,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Primary Prescriber"))
"DATA",9002313.91,45,10,2,0)
; probably need to do lookup like with Prescriber ID?
"DATA",9002313.91,45,10,3,0)
; this here is just for certification testing, mostly
"DATA",9002313.91,45,10,4,0)
I $G(VARX) S BPS("X")=BPS("RX",MEDN,"Prescriber DEA #")
"DATA",9002313.91,45,20,0)
^9002313.9102^1^1^3041015^^^^
"DATA",9002313.91,45,20,1,0)
S BPS("X")="DL"_$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,45,25,0)
^9002313.9104^1^1^3041015^^^^
"DATA",9002313.91,45,25,1,0)
S BPS("X")="DL"_$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,45,30,0)
^^1^1^3041015^
"DATA",9002313.91,45,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,21)=""
"DATA",9002313.91,46,0)
426^^USUAL & CUSTOMARY CHARGE^D^6
"DATA",9002313.91,46,5)
DQ^8
"DATA",9002313.91,46,10,0)
^9002313.9101^1^1^3031219^
"DATA",9002313.91,46,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Usual & Customary"))
"DATA",9002313.91,46,20,0)
^9002313.9102^1^1^3031219^^^^
"DATA",9002313.91,46,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,46,25,0)
^9002313.9104^1^1^3031219^^^^
"DATA",9002313.91,46,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,46,30,0)
^9002313.9103^1^1^3031219^^^^
"DATA",9002313.91,46,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,26)=BPS("X")
"DATA",9002313.91,47,0)
429^DT^UNIT DOSE INDICATOR^N^1
"DATA",9002313.91,47,5)
DT^1
"DATA",9002313.91,47,10,0)
^9002313.9101^2^2^3030823^^^
"DATA",9002313.91,47,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Unit Dose Indicator"))
"DATA",9002313.91,47,10,2,0)
S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,47,20,0)
^9002313.9102^1^1^3030823^^^
"DATA",9002313.91,47,20,1,0)
S BPS("X")="DT"_$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,47,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,47,25,1,0)
S BPS("X")="DT"_$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,47,30,0)
^9002313.9103^1^1^3030823^^^
"DATA",9002313.91,47,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,29)=BPS("X")
"DATA",9002313.91,48,0)
431^DV^OTHER PAYOR AMOUNT^D^6
"DATA",9002313.91,48,5)
DV^8
"DATA",9002313.91,48,10,0)
^9002313.9101^1^1^3000930^
"DATA",9002313.91,48,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Other Payor Amount"))
"DATA",9002313.91,48,20,0)
^^1^1^2960410^^^
"DATA",9002313.91,48,20,1,0)
S BPS("X")="DV"_$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,48,25,0)
^^1^1^3031212^
"DATA",9002313.91,48,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,48,30,0)
^^1^1^2960410^^^
"DATA",9002313.91,48,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,31)=BPS("X")
"DATA",9002313.91,49,0)
438^E3^INCENTIVE AMOUNT SUBMITTED^D^6
"DATA",9002313.91,49,5)
E3^8
"DATA",9002313.91,49,10,0)
^^1^1^3040907^
"DATA",9002313.91,49,10,1,0)
S BPS("X")=0
"DATA",9002313.91,49,20,0)
^9002313.9102^1^1^3040907^^^^
"DATA",9002313.91,49,20,1,0)
S BPS("X")="E3"_$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,49,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,49,25,1,0)
S BPS("X")="E3"_$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,49,30,0)
^^1^1^3040907^
"DATA",9002313.91,49,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),430),U,8)=""
"DATA",9002313.91,51,0)
443^E8^Other Payer Date^N^8
"DATA",9002313.91,51,5)
E8^8
"DATA",9002313.91,51,10,0)
^9002313.9101^1^1^3040224^^^^
"DATA",9002313.91,51,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Primary Payor Denial Date"))
"DATA",9002313.91,51,20,0)
^^1^1^3040224^
"DATA",9002313.91,51,20,1,0)
S BPS("X")="E8"_$$DTF1^BPSECFM($G(BPS("X")))
"DATA",9002313.91,51,25,0)
^^1^1^3040224^
"DATA",9002313.91,51,25,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")))
"DATA",9002313.91,51,30,0)
^9002313.9103^1^1^3040224^^^^
"DATA",9002313.91,51,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,43)=BPS("X")
"DATA",9002313.91,52,0)
313^CD^CARDHOLDER LAST NAME^A/N^15
"DATA",9002313.91,52,5)
CD^15
"DATA",9002313.91,52,10,0)
^9002313.9101^3^3^3050802^^
"DATA",9002313.91,52,10,1,0)
S BPS("X")=$G(BPS("Cardholder","Last Name"))
"DATA",9002313.91,52,10,2,0)
I BPS("X")="" S BPS("X")=$G(BPS("Cardholder","Name"))
"DATA",9002313.91,52,10,3,0)
N X S X=BPS("X") D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("FAMILY")) K X
"DATA",9002313.91,52,20,0)
^9002313.9102^1^1^3030823^^^^
"DATA",9002313.91,52,20,1,0)
S BPS("X")="CD"_$$ANFF^BPSECFM(BPS("X"),15)
"DATA",9002313.91,52,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,52,25,1,0)
S BPS("X")="CD"_$$ANFF^BPSECFM(BPS("X"),15)
"DATA",9002313.91,52,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,52,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,13)=BPS("X")
"DATA",9002313.91,53,0)
312^CC^CARDHOLDER FIRST NAME^A/N^12
"DATA",9002313.91,53,5)
CC^12
"DATA",9002313.91,53,10,0)
^9002313.9101^3^3^3050802^^
"DATA",9002313.91,53,10,1,0)
S BPS("X")=","_$G(BPS("Cardholder","First Name"))
"DATA",9002313.91,53,10,2,0)
I BPS("X")="," S BPS("X")=$G(BPS("Cardholder","Name"))
"DATA",9002313.91,53,10,3,0)
N X S X=BPS("X") D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("GIVEN")) K X
"DATA",9002313.91,53,20,0)
^9002313.9102^1^1^3030823^^^^
"DATA",9002313.91,53,20,1,0)
S BPS("X")="CC"_$$ANFF^BPSECFM(BPS("X"),12)
"DATA",9002313.91,53,25,0)
^9002313.9104^1^1^3030823^^^^
"DATA",9002313.91,53,25,1,0)
S BPS("X")="CC"_$$ANFF^BPSECFM(BPS("X"),12)
"DATA",9002313.91,53,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,53,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,12)=BPS("X")
"DATA",9002313.91,54,0)
322^CM^PATIENT STREET ADDRESS^A/N^30
"DATA",9002313.91,54,5)
CM^30
"DATA",9002313.91,54,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,54,10,1,0)
S BPS("X")=$G(BPS("Patient","Street Address"))
"DATA",9002313.91,54,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,54,20,1,0)
S BPS("X")="CM"_$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,54,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,54,25,1,0)
S BPS("X")="CM"_$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,54,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,54,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),U,2)=BPS("X")
"DATA",9002313.91,55,0)
323^CN^PATIENT CITY^A/N^20
"DATA",9002313.91,55,5)
CN^20
"DATA",9002313.91,55,10,0)
^9002313.9101^1^1^3030703^^^^
"DATA",9002313.91,55,10,1,0)
S BPS("X")=$G(BPS("Patient","City"))
"DATA",9002313.91,55,20,0)
^9002313.9102^1^1^3030703^^^^
"DATA",9002313.91,55,20,1,0)
S BPS("X")="CN"_$$ANFF^BPSECFM(BPS("X"),20)
"DATA",9002313.91,55,25,0)
^^1^1^3030703^
"DATA",9002313.91,55,25,1,0)
S BPS("X")="CN"_$$ANFF^BPSECFM(BPS("X"),20)
"DATA",9002313.91,55,30,0)
^9002313.9103^1^1^3030703^^^^
"DATA",9002313.91,55,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),U,3)=BPS("X")
"DATA",9002313.91,56,0)
324^CO^PATIENT STATE^A/N^2
"DATA",9002313.91,56,5)
CO^2
"DATA",9002313.91,56,10,0)
^9002313.9101^1^1^3030717^^^^
"DATA",9002313.91,56,10,1,0)
S BPS("X")=$G(BPS("Patient","State"))
"DATA",9002313.91,56,20,0)
^9002313.9102^1^1^3030717^^^^
"DATA",9002313.91,56,20,1,0)
S BPS("X")="CO"_$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,56,25,0)
^9002313.9104^1^1^3030717^^
"DATA",9002313.91,56,25,1,0)
S BPS("X")="CO"_$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,56,30,0)
^9002313.9103^1^1^3030717^^^^
"DATA",9002313.91,56,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),U,4)=BPS("X")
"DATA",9002313.91,57,0)
325^CP^PATIENT ZIP^A/N^9
"DATA",9002313.91,57,5)
CP^15
"DATA",9002313.91,57,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,57,10,1,0)
S BPS("X")=$G(BPS("Patient","Zip"))
"DATA",9002313.91,57,20,0)
^9002313.9102^2^2^3030718^^^^
"DATA",9002313.91,57,20,1,0)
S BPS("X")=$TR(BPS("X"),"-/._","")
"DATA",9002313.91,57,20,2,0)
S BPS("X")="CP"_$$ANFF^BPSECFM(BPS("X"),9)
"DATA",9002313.91,57,25,0)
^9002313.9104^2^2^3030718^^^^
"DATA",9002313.91,57,25,1,0)
S BPS("X")=$TR(BPS("X"),"-/._","")
"DATA",9002313.91,57,25,2,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),9)
"DATA",9002313.91,57,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,57,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),U,5)=BPS("X")
"DATA",9002313.91,58,0)
314^CE^HOME PLAN^A/N^3
"DATA",9002313.91,58,5)
CE^3
"DATA",9002313.91,58,10,0)
^9002313.9101^1^1^3030823^^
"DATA",9002313.91,58,10,1,0)
S BPS("X")=$G(BPS("Home Plan"))
"DATA",9002313.91,58,20,0)
^9002313.9102^1^1^3030823^^^^
"DATA",9002313.91,58,20,1,0)
S BPS("X")="CE"_$$ANFF^BPSECFM(BPS("X"),1)
"DATA",9002313.91,58,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,58,25,1,0)
S BPS("X")="CE"_$$ANFF^BPSECFM(BPS("X"),3)
"DATA",9002313.91,58,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,58,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,14)=BPS("X")
"DATA",9002313.91,59,0)
315^CF^EMPLOYER NAME^A/N^30
"DATA",9002313.91,59,5)
CF^30
"DATA",9002313.91,59,10,0)
^9002313.9101^2^2^3030718^
"DATA",9002313.91,59,10,1,0)
I $G(VARX) D EMPL^BPSOSSG
"DATA",9002313.91,59,10,2,0)
S BPS("X")=$G(BPS("Employer","Name"))
"DATA",9002313.91,59,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,59,20,1,0)
S BPS("X")="CF"_$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,59,25,0)
^9002313.9104^1^1^3030718^^^
"DATA",9002313.91,59,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,59,30,0)
^9002313.9103^1^1^3030718^^^
"DATA",9002313.91,59,30,1,0)
D FLD315^BPSOSSG
"DATA",9002313.91,60,0)
316^CG^EMPLOYER STREET ADDRESS^A/N^30
"DATA",9002313.91,60,5)
CG^30
"DATA",9002313.91,60,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,60,10,1,0)
S BPS("X")=$G(BPS("Employer","Address"))
"DATA",9002313.91,60,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,60,20,1,0)
S BPS("X")="CG"_$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,60,25,0)
^9002313.9104^1^1^3030718^^^
"DATA",9002313.91,60,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,60,30,0)
^9002313.9103^1^1^3030718^^
"DATA",9002313.91,60,30,1,0)
D FLD316^BPSOSSG
"DATA",9002313.91,61,0)
317^CH^EMPLOYER CITY ADDRESS^A/N^20
"DATA",9002313.91,61,5)
CH^20
"DATA",9002313.91,61,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,61,10,1,0)
S BPS("X")=$G(BPS("Employer","City"))
"DATA",9002313.91,61,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,61,20,1,0)
S BPS("X")="CH"_$$ANFF^BPSECFM(BPS("X"),20)
"DATA",9002313.91,61,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,61,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),20)
"DATA",9002313.91,61,30,0)
^9002313.9103^1^1^3030718^^
"DATA",9002313.91,61,30,1,0)
D FLD317^BPSOSSG
"DATA",9002313.91,62,0)
318^CI^EMPLOYER STATE^A/N^2
"DATA",9002313.91,62,5)
CI^2
"DATA",9002313.91,62,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,62,10,1,0)
S BPS("X")=$G(BPS("Employer","State"))
"DATA",9002313.91,62,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,62,20,1,0)
S BPS("X")="CI"_$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,62,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,62,25,1,0)
S BPS("X")="CI"_$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,62,30,0)
^9002313.9103^1^1^3030718^^
"DATA",9002313.91,62,30,1,0)
D FLD318^BPSOSSG
"DATA",9002313.91,63,0)
319^CJ^EMPLOYER ZIP CODE^A/N^9
"DATA",9002313.91,63,5)
CJ^15
"DATA",9002313.91,63,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,63,10,1,0)
S BPS("X")=$G(BPS("Employer","Zip Code"))
"DATA",9002313.91,63,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,63,20,1,0)
S BPS("X")="CJ"_$$ANFF^BPSECFM(BPS("X"),9)
"DATA",9002313.91,63,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,63,25,1,0)
S BPS("X")="CJ"_$$ANFF^BPSECFM(BPS("X"),15)
"DATA",9002313.91,63,30,0)
^9002313.9103^1^1^3030718^^
"DATA",9002313.91,63,30,1,0)
D FLD319^BPSOSSG
"DATA",9002313.91,64,0)
327^CR^CARRIER ID #^A/N^10
"DATA",9002313.91,64,5)
CR^12
"DATA",9002313.91,64,10,0)
^9002313.9101^1^1^3040224^^^^
"DATA",9002313.91,64,10,1,0)
S BPS("X")=$G(BPS("Carrier ID #"))
"DATA",9002313.91,64,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,64,20,1,0)
S BPS("X")="CR"_$$ANFF^BPSECFM(BPS("X"),10)
"DATA",9002313.91,64,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,64,25,1,0)
S BPS("X")="CR"_$$ANFF^BPSECFM(BPS("X"),12)
"DATA",9002313.91,64,30,0)
^9002313.9103^1^1^3040224^^^^
"DATA",9002313.91,64,30,1,0)
D FLD327^BPSOSSG
"DATA",9002313.91,65,0)
329^CT^PATIENT SSN^N^9
"DATA",9002313.91,65,5)
CT^9
"DATA",9002313.91,65,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,65,10,1,0)
S BPS("X")=$G(BPS("Patient","SSN"))
"DATA",9002313.91,65,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,65,20,1,0)
S BPS("X")="CT"_$$NFF^BPSECFM(BPS("X"),9)
"DATA",9002313.91,65,25,0)
^^1^1^3030718^
"DATA",9002313.91,65,25,1,0)
S BPS("X")="CT"_$$NFF^BPSECFM(BPS("X"),9)
"DATA",9002313.91,65,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,65,30,1,0)
S $P(^BPSC(BPS(9002313.02),320),U,29)=BPS("X")
"DATA",9002313.91,66,0)
425^DP^DRUG TYPE^N^1
"DATA",9002313.91,66,5)
DP^1
"DATA",9002313.91,66,10,0)
^^2^2^3030718^
"DATA",9002313.91,66,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Drug Type"))
"DATA",9002313.91,66,10,2,0)
S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,66,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,66,20,1,0)
S BPS("X")="DP"_$$NFF^BPSECFM(BPS("X"),1)
"DATA",9002313.91,66,25,0)
^^1^1^3030718^
"DATA",9002313.91,66,25,1,0)
S BPS("X")="DP"_$$NFF^BPSECFM(BPS("X"),1)
"DATA",9002313.91,66,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,66,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),420),U,25)=BPS("X")
"DATA",9002313.91,67,0)
427^DR^PRESCRIBER LAST NAME^A/N^15
"DATA",9002313.91,67,5)
DR^15
"DATA",9002313.91,67,10,0)
^9002313.9101^2^2^3050802^^
"DATA",9002313.91,67,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Prescriber Name"))
"DATA",9002313.91,67,10,2,0)
N X S X=BPS("X") D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("FAMILY")) K X
"DATA",9002313.91,67,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,67,20,1,0)
S BPS("X")="DR"_$$ANFF^BPSECFM(BPS("X"),15)
"DATA",9002313.91,67,25,0)
^9002313.9104^1^1^3030718^^^^
"DATA",9002313.91,67,25,1,0)
S BPS("X")="DR"_$$ANFF^BPSECFM(BPS("X"),15)
"DATA",9002313.91,67,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,67,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),420),U,27)=BPS("X")
"DATA",9002313.91,68,0)
428^DS^POSTAGE AMOUNT CLAIMED^D^4
"DATA",9002313.91,68,5)
^4
"DATA",9002313.91,68,10,0)
^9002313.9101^1^1^3030707^^
"DATA",9002313.91,68,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Postage Amount"))
"DATA",9002313.91,68,20,0)
^^1^1^3030707^
"DATA",9002313.91,68,20,1,0)
S BPS("X")="DS"_$$DFF^BPSECFM(BPS("X"),4)
"DATA",9002313.91,68,25,0)
^9002313.9104^1^1^3031216^^^
"DATA",9002313.91,68,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),4)
"DATA",9002313.91,68,30,0)
^9002313.9103^1^1^3030707^^
"DATA",9002313.91,68,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),420),U,28)=BPS("X")
"DATA",9002313.91,69,0)
434^DY^DATE OF INJURY^N^8
"DATA",9002313.91,69,5)
DY^8
"DATA",9002313.91,69,10,0)
^9002313.9101^2^2^3010125^^
"DATA",9002313.91,69,10,1,0)
S BPS("X")=$G(BPS("Date of Injury"))
"DATA",9002313.91,69,10,2,0)
S BPS("X")=$$DTF1^BPSECFM(BPS("X"))
"DATA",9002313.91,69,20,0)
^^1^1^3010125^^^
"DATA",9002313.91,69,20,1,0)
S BPS("X")="DY"_$$NFF^BPSECFM(BPS("X"),8)
"DATA",9002313.91,69,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,69,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,69,30,0)
^^1^1^3010125^^
"DATA",9002313.91,69,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,34)=BPS("X")
"DATA",9002313.91,70,0)
435^DZ^CLAIM/REF ID NUMBER^A/N^14
"DATA",9002313.91,70,5)
DZ^30
"DATA",9002313.91,70,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,70,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Claim/Ref ID #"))
"DATA",9002313.91,70,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,70,20,1,0)
S BPS("X")="DZ"_$$ANFF^BPSECFM(BPS("X"),14)
"DATA",9002313.91,70,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,70,25,1,0)
S BPS("X")="DZ"_$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,70,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,70,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,35)=BPS("X")
"DATA",9002313.91,71,0)
436^E1^PRODUCT/SERV ID QUAL^A/N^2
"DATA",9002313.91,71,5)
E1^2
"DATA",9002313.91,71,10,0)
^9002313.9101^1^1^3040107^^^^
"DATA",9002313.91,71,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Alt. Product Type"))
"DATA",9002313.91,71,20,0)
^9002313.9102^1^1^3040107^^^^
"DATA",9002313.91,71,20,1,0)
S BPS("X")="E1"_$$ANFF^BPSECFM(BPS("X"),1)
"DATA",9002313.91,71,25,0)
^9002313.9104^1^1^3040107^^^^
"DATA",9002313.91,71,25,1,0)
S BPS("X")="E1"_$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,71,30,0)
^9002313.9103^1^1^3040107^^^^
"DATA",9002313.91,71,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),430),U,6)=BPS("X")
"DATA",9002313.91,72,0)
437^E2^ALT. PRODUCT CODE^A/N^13
"DATA",9002313.91,72,10,0)
^^2^2^3030718^
"DATA",9002313.91,72,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Alt. Product Code"))
"DATA",9002313.91,72,10,2,0)
;Note:  this field is not supported in 5.1
"DATA",9002313.91,72,20,0)
^9002313.9102^1^1^3030718^^^^
"DATA",9002313.91,72,20,1,0)
S BPS("X")="E2"_$$ANFF^BPSECFM(BPS("X"),13)
"DATA",9002313.91,72,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,72,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),430),U,7)=BPS("X")
"DATA",9002313.91,73,0)
432^DW^BASIS OF DAYS SUPPLY DET.^N^1
"DATA",9002313.91,73,5)
DW^1
"DATA",9002313.91,73,10,0)
^^1^1^3010125^
"DATA",9002313.91,73,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Basis of Days Supply Det."))
"DATA",9002313.91,73,20,0)
^^1^1^3010125^
"DATA",9002313.91,73,20,1,0)
S BPS("X")="DW"_$$NFF^BPSECFM(BPS("X"),1)
"DATA",9002313.91,73,25,0)
^^1^1^3031205^
"DATA",9002313.91,73,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,73,30,0)
^^1^1^3010125^
"DATA",9002313.91,73,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),420),U,32)=BPS("X")
"DATA",9002313.91,74,0)
498.51^PR^PRIOR AUTH PROCESSED DATE^A/N^8
"DATA",9002313.91,74,5)
PR^8
"DATA",9002313.91,74,10,0)
^^1^1^3040223^
"DATA",9002313.91,74,10,1,0)
S BPS("X")=""
"DATA",9002313.91,75,0)
202^B2^SERV PROVIDER ID QUALIFIER^A/N^2
"DATA",9002313.91,75,5)
B2^2
"DATA",9002313.91,75,10,0)
^9002313.9101^1^1^3040114^^^^
"DATA",9002313.91,75,10,1,0)
I $G(VARX) S BPS("X")="07"  ;Always 07 for VA automated claim.
"DATA",9002313.91,75,20,0)
^9002313.9102^1^1^3040114^^^^
"DATA",9002313.91,75,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,75,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,75,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2) ;VA
"DATA",9002313.91,75,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,75,30,1,0)
S $P(^BPSC(BPS(9002313.02),200),U,2)=BPS("X") ;VA
"DATA",9002313.91,76,0)
110^AK^SOFTWARE VENDOR/CERT ID^A/N^10
"DATA",9002313.91,76,5)
AK^10
"DATA",9002313.91,76,10,0)
^^1^1^3040202^
"DATA",9002313.91,76,10,1,0)
I $G(VARX) S BPS("X")=BPS("NCPDP","Software Vendor/Cert ID") ;for VA
"DATA",9002313.91,76,20,0)
^9002313.9102^1^1^3040202^^^^
"DATA",9002313.91,76,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,76,25,0)
^9002313.9104^1^1^3040202^^^^
"DATA",9002313.91,76,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10) ;VA
"DATA",9002313.91,76,30,0)
^9002313.9103^2^2^3040202^^^^
"DATA",9002313.91,76,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,10)=BPS("X") ;VA
"DATA",9002313.91,76,30,2,0)
S $P(^BPSC(BPS(9002313.02),1),U,4)=$G(BPS("Insurer","VA PLAN IEN"))
"DATA",9002313.91,77,0)
331^CX^PATIENT ID QUALIFIER^A/N^2
"DATA",9002313.91,77,5)
CX^2
"DATA",9002313.91,77,10,0)
^9002313.9101^1^1^3030718^^^^
"DATA",9002313.91,77,10,1,0)
I $G(VARX) S BPS("X")="01" ;VA
"DATA",9002313.91,77,20,0)
^^1^1^3031212^
"DATA",9002313.91,77,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,77,25,0)
^9002313.9104^1^1^3030718^^
"DATA",9002313.91,77,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,77,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,77,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,1)=BPS("X") ;VA
"DATA",9002313.91,78,0)
332^CY^PATIENT ID^A/N^20
"DATA",9002313.91,78,5)
CY^20
"DATA",9002313.91,78,10,0)
^9002313.9101^1^1^3040820^^^^
"DATA",9002313.91,78,10,1,0)
I $G(VARX) S BPS("X")=BPS("Patient","SSN") ;VA
"DATA",9002313.91,78,20,0)
^9002313.9102^1^1^3040820^^
"DATA",9002313.91,78,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,78,25,0)
^9002313.9104^1^1^3040820^^
"DATA",9002313.91,78,25,1,0)
S BPS("X")="CY"_$$ANFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,78,30,0)
^9002313.9103^1^1^3040820^^^^
"DATA",9002313.91,78,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,2)=BPS("X") ;VA
"DATA",9002313.91,79,0)
326^CQ^PATIENT PHONE NUMBER^N^10
"DATA",9002313.91,79,5)
CQ^10
"DATA",9002313.91,79,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,79,10,1,0)
S BPS("X")=$TR($G(BPS("Patient","Phone #")),"#() -_*.@") ;VA
"DATA",9002313.91,79,25,0)
^9002313.9104^1^1^3030718^^^^
"DATA",9002313.91,79,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10) ;VA
"DATA",9002313.91,79,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,79,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),U,6)=BPS("X") ;VA
"DATA",9002313.91,80,0)
455^EM^RX/SERVICE REF NUMBER QUAL^A/N^1
"DATA",9002313.91,80,5)
EM^1
"DATA",9002313.91,80,10,0)
^9002313.9101^1^1^3030823^^^^
"DATA",9002313.91,80,10,1,0)
S BPS("X")=1  ;VA 
"DATA",9002313.91,80,20,0)
^9002313.9102^1^1^3030823^^^^
"DATA",9002313.91,80,20,1,0)
S BPS("X")="EM"_$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,80,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,80,25,1,0)
S BPS("X")="EM"_$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,80,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,80,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,5)=BPS("X")
"DATA",9002313.91,81,0)
460^ET^QUANTITY PRESCRIBED^N^10
"DATA",9002313.91,81,5)
ET^10
"DATA",9002313.91,81,10,0)
^9002313.9101^1^1^3030827^^
"DATA",9002313.91,81,10,1,0)
S BPS("X")=BPS("RX",MEDN,"Quantity")*1000
"DATA",9002313.91,81,20,0)
^9002313.9102^1^1^3031217^^
"DATA",9002313.91,81,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,81,25,0)
^9002313.9104^1^1^3030827^^^^
"DATA",9002313.91,81,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,81,30,0)
^9002313.9103^1^1^3030827^^^^
"DATA",9002313.91,81,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,10)=BPS("X") ;VA
"DATA",9002313.91,82,0)
465^EY^PROVIDER ID QUALIFIER^A/N^2
"DATA",9002313.91,82,5)
EY^2
"DATA",9002313.91,82,10,0)
^9002313.9101^1^1^3041015^^^^
"DATA",9002313.91,82,10,1,0)
S BPS("X")="01"  ;VA
"DATA",9002313.91,82,20,0)
^9002313.9102^1^1^3041015^^^^
"DATA",9002313.91,82,20,1,0)
S BPS("X")="EY"_$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,82,25,0)
^9002313.9104^1^1^3041015^^^^
"DATA",9002313.91,82,25,1,0)
S BPS("X")="EY"_$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,82,30,0)
^^1^1^3041015^
"DATA",9002313.91,82,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,5)=""
"DATA",9002313.91,83,0)
444^E9^PROVIDER ID^A/N^15
"DATA",9002313.91,83,5)
E9^15
"DATA",9002313.91,83,10,0)
^9002313.9101^1^1^3041015^^
"DATA",9002313.91,83,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Prescriber DEA #"))
"DATA",9002313.91,83,20,0)
^9002313.9102^1^1^3041015^^^^
"DATA",9002313.91,83,20,1,0)
S BPS("X")="E9"_$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,83,25,0)
^9002313.9104^1^1^3041015^^^^
"DATA",9002313.91,83,25,1,0)
S BPS("X")="E9"_$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,83,30,0)
^^1^1^3041015^
"DATA",9002313.91,83,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440),U,4)=""
"DATA",9002313.91,84,0)
466^EZ^PRESCRIBER ID QUALIFIER^A/N^2
"DATA",9002313.91,84,5)
EZ^2
"DATA",9002313.91,84,10,0)
^9002313.9101^1^1^3030823^^^^
"DATA",9002313.91,84,10,1,0)
S BPS("X")=12  ;VA ALWAYS USES DEA#
"DATA",9002313.91,84,20,0)
^9002313.9102^1^1^3030823^^^^
"DATA",9002313.91,84,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,84,25,0)
^9002313.9104^1^1^3030823^^^^
"DATA",9002313.91,84,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,84,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,84,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,6)=BPS("X")
"DATA",9002313.91,85,0)
467^1E^PRESCRIBER LOCATION CODE^A/N^3
"DATA",9002313.91,85,5)
1E^3
"DATA",9002313.91,85,10,0)
^9002313.9101^1^1^3030721^^
"DATA",9002313.91,85,10,1,0)
S BPS("X")=$G(BPS("RX",1,"Prescriber Billing Location"))
"DATA",9002313.91,85,20,0)
^9002313.9102^1^1^3030721^^^^
"DATA",9002313.91,85,20,1,0)
S BPS("X")="1E"_$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,85,25,0)
^9002313.9104^1^1^3030721^^^^
"DATA",9002313.91,85,25,1,0)
S BPS("X")="1E"_$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,85,30,0)
^9002313.9103^1^1^3030721^^^^
"DATA",9002313.91,85,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,7)=BPS("X")
"DATA",9002313.91,86,0)
498^PM^PRESCRIBER TELEPHONE NUMBER^N^10
"DATA",9002313.91,86,5)
PM^10
"DATA",9002313.91,86,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,86,10,1,0)
S BPS("X")=$TR($G(BPS("RX",MEDN,"Prescriber Phone #")),"#() -_*.@")
"DATA",9002313.91,86,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,86,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,86,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,86,25,1,0)
S BPS("X")="PM"_$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,86,30,0)
^9002313.9103^1^1^3040224^^^^
"DATA",9002313.91,86,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),498),U,12)=BPS("X")
"DATA",9002313.91,87,0)
468^2E^PRIMARY CARE PROV ID QUAL^A/N^2
"DATA",9002313.91,87,5)
2E^2
"DATA",9002313.91,87,10,0)
^9002313.9101^1^1^3041015^^^^
"DATA",9002313.91,87,10,1,0)
I $G(VARX) S BPS("X")=12  ;default for VA
"DATA",9002313.91,87,20,0)
^9002313.9102^1^1^3041015^^^
"DATA",9002313.91,87,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,87,25,0)
^9002313.9104^1^1^3041015^^^^
"DATA",9002313.91,87,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,87,30,0)
^^1^1^3041015^
"DATA",9002313.91,87,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,8)=""
"DATA",9002313.91,88,0)
469^H5^PRIM CARE PROV LOCATION CODE^N^3
"DATA",9002313.91,88,5)
H5^3
"DATA",9002313.91,88,10,0)
^9002313.9101^1^1^3040114^^^
"DATA",9002313.91,88,10,1,0)
S BPS("X")=$G(BPS("Patient","Primary Care Prov Location Code"))
"DATA",9002313.91,88,20,0)
^9002313.9102^1^1^3040114^^
"DATA",9002313.91,88,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,88,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,88,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,88,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,88,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,9)=BPS("X")
"DATA",9002313.91,89,0)
470^4E^PRIM CARE PROVIDER LAST NAME^A/N^15
"DATA",9002313.91,89,5)
4E^15
"DATA",9002313.91,89,10,0)
^9002313.9101^2^2^3050802^^
"DATA",9002313.91,89,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Prescriber Name"))
"DATA",9002313.91,89,10,2,0)
N X S X=BPS("X") D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("FAMILY")) K X
"DATA",9002313.91,89,25,0)
^9002313.9104^1^1^3030825^^^^
"DATA",9002313.91,89,25,1,0)
S BPS("X")="4E"_$$ANFF^BPSECFM(BPS("X"),15)
"DATA",9002313.91,89,30,0)
^9002313.9103^1^1^3030825^^^^
"DATA",9002313.91,89,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,10)=BPS("X")
"DATA",9002313.91,91,0)
480^H9^OTHER AMT CLAIM SUBMITTED^D^8
"DATA",9002313.91,91,5)
H9^8
"DATA",9002313.91,91,10,0)
^9002313.9101^1^1^3040907^^^^
"DATA",9002313.91,91,10,1,0)
S BPS("X")="" I $G(BPS("Insurer","Administrative Fee"))'="" S BPS("X")=BPS("Insurer","Administrative Fee")
"DATA",9002313.91,91,20,0)
^9002313.9102^1^1^3040907^^^^
"DATA",9002313.91,91,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,91,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,91,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,91,30,0)
^9002313.9103^1^1^3040907^^^
"DATA",9002313.91,91,30,1,0)
D FLD480^BPSOSSG
"DATA",9002313.91,92,0)
109^A9^TRANSACTION COUNT^A/N^1
"DATA",9002313.91,92,5)
A9^1
"DATA",9002313.91,92,10,0)
^9002313.9101^1^1^3040114^^^^
"DATA",9002313.91,92,10,1,0)
S BPS("X")=BPS("Transaction Count")
"DATA",9002313.91,92,20,0)
^9002313.9102^1^1^3040114^^^^
"DATA",9002313.91,92,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,92,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,92,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,92,30,0)
^9002313.9103^1^1^3040114^^^
"DATA",9002313.91,92,30,1,0)
S $P(^BPSC(BPS(9002313.02),100),U,9)=BPS("X")
"DATA",9002313.91,93,0)
111^AM^SEGMENT IDENTIFICATION^A/N^2
"DATA",9002313.91,93,5)
AM^2
"DATA",9002313.91,93,10,0)
^9002313.9101^1^1^3040114^^
"DATA",9002313.91,93,10,1,0)
S BPS("X")=""
"DATA",9002313.91,95,0)
112^XX^TRANSACTION RESPONSE STATUS^A/N^1
"DATA",9002313.91,95,5)
AN^2
"DATA",9002313.91,95,10,0)
^9002313.9101^1^1^3040114^^
"DATA",9002313.91,95,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),110)),U,2)
"DATA",9002313.91,95,20,0)
^9002313.9102^1^1^3040114^^
"DATA",9002313.91,95,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,95,25,0)
^9002313.9104^1^1^3040114^^
"DATA",9002313.91,95,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,95,30,0)
^9002313.9103^1^1^3040114^^
"DATA",9002313.91,95,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),110),U,2)=BPS("X")
"DATA",9002313.91,96,0)
320^CK^EMPLOYER PHONE NUMBER^N^10
"DATA",9002313.91,96,5)
CK^10
"DATA",9002313.91,96,10,0)
^9002313.9101^1^1^3050802^^^
"DATA",9002313.91,96,10,1,0)
S BPS("X")=$TR($G(BPS("Employer","Phone")),"#() -_*.@")
"DATA",9002313.91,96,20,0)
^9002313.9102^1^1^3031210^^
"DATA",9002313.91,96,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,96,25,0)
^9002313.9104^1^1^3030718^^^^
"DATA",9002313.91,96,25,1,0)
S BPS("X")="CK"_$$ANFF^BPSECFM(BPS("X"),10)
"DATA",9002313.91,96,30,0)
^9002313.9103^1^1^3030718^^^^
"DATA",9002313.91,96,30,1,0)
D FLD320^BPSOSSG
"DATA",9002313.91,97,0)
321^CL^EMPLOYER CONTACT NAME^A/N^30
"DATA",9002313.91,97,5)
CL^30
"DATA",9002313.91,97,10,0)
^9002313.9101^1^1^3040224^^^
"DATA",9002313.91,97,10,1,0)
S BPS("X")=""
"DATA",9002313.91,97,20,0)
^9002313.9102^1^1^3040224^^^
"DATA",9002313.91,97,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,97,25,0)
^9002313.9104^1^1^3040224^^^
"DATA",9002313.91,97,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),30)
"DATA",9002313.91,97,30,0)
^^1^1^3040224^
"DATA",9002313.91,97,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),320),U,1)=BPS("X")
"DATA",9002313.91,98,0)
330^CW^ALTERNANT ID^A/N^20
"DATA",9002313.91,98,5)
CW^20
"DATA",9002313.91,98,10,0)
^9002313.9101^1^1^3040224^^^^
"DATA",9002313.91,98,10,1,0)
S BPS("X")=""
"DATA",9002313.91,98,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,98,20,1,0)
S BPS("X")=$$NFF^BPSECFM(BPS("X"),11)
"DATA",9002313.91,98,25,0)
^9002313.9104^1^1^3040224^^^
"DATA",9002313.91,98,25,1,0)
S BPS("X")=$$NFF^BPSECFM(BPS("X"),20)
"DATA",9002313.91,98,30,0)
^9002313.9103^1^1^3040224^^
"DATA",9002313.91,98,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),320),U,10)=BPS("X")
"DATA",9002313.91,99,0)
333^CZ^EMPLOYER ID^A/N^15
"DATA",9002313.91,99,5)
CZ^15
"DATA",9002313.91,99,10,0)
^9002313.9101^1^1^3030823^^
"DATA",9002313.91,99,10,1,0)
S BPS("X")=""
"DATA",9002313.91,99,20,0)
^9002313.9102^1^1^3031210^^
"DATA",9002313.91,99,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,99,25,0)
^^1^1^3030823^
"DATA",9002313.91,99,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,99,30,0)
^9002313.9103^1^1^3030823^^^^
"DATA",9002313.91,99,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,3)=BPS("X")
"DATA",9002313.91,100,0)
334^1C^SMOKER/NONSMOKER^N^1
"DATA",9002313.91,100,5)
1C^1
"DATA",9002313.91,100,10,0)
^9002313.9101^1^1^3040114^^^^
"DATA",9002313.91,100,10,1,0)
S BPS("X")=""
"DATA",9002313.91,100,25,0)
^9002313.9104^1^1^3040114^^^^
"DATA",9002313.91,100,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),1)
"DATA",9002313.91,100,30,0)
^9002313.9103^1^1^3040114^^^^
"DATA",9002313.91,100,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,4)=BPS("X")
"DATA",9002313.91,101,0)
335^2C^PREGNANCY INDICATOR^N^1
"DATA",9002313.91,101,5)
2C^1
"DATA",9002313.91,101,10,0)
^9002313.9101^1^1^3030823^^^
"DATA",9002313.91,101,10,1,0)
S BPS("X")=""
"DATA",9002313.91,101,20,0)
^^1^1^3031216^
"DATA",9002313.91,101,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,101,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,101,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),1)
"DATA",9002313.91,101,30,0)
^9002313.9103^1^1^3030823^^
"DATA",9002313.91,101,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,5)=BPS("X")
"DATA",9002313.91,102,0)
336^8C^FACILITY ID^A/N^10
"DATA",9002313.91,102,5)
8C^10
"DATA",9002313.91,102,10,0)
^9002313.9101^1^1^3030823^^^^
"DATA",9002313.91,102,10,1,0)
S BPS("X")=$$GET1^DIQ(52,DFN_",",5)
"DATA",9002313.91,102,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,102,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),10)
"DATA",9002313.91,102,30,0)
^^1^1^3030823^
"DATA",9002313.91,102,30,1,0)
S $P(^BPSC(BPS(9002313.02),330),U,6)=BPS("X")
"DATA",9002313.91,103,0)
337^4C^COB/OTHER PAYMENTS COUNTER^N^1
"DATA",9002313.91,103,5)
4C^1
"DATA",9002313.91,103,10,0)
^9002313.9101^1^1^3040223^^^
"DATA",9002313.91,103,10,1,0)
S BPS("X")=""
"DATA",9002313.91,103,20,0)
^9002313.9102^1^1^3040223^^^
"DATA",9002313.91,103,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,103,25,0)
^9002313.9104^1^1^3040223^^^
"DATA",9002313.91,103,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,103,30,0)
^9002313.9103^1^1^3040223^^
"DATA",9002313.91,103,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337,0),U,1)=BPS("X")
"DATA",9002313.91,104,0)
338^5C^OTHER PAYER COVERAGE TYPE^N^2
"DATA",9002313.91,104,5)
5C^2
"DATA",9002313.91,104,10,0)
^9002313.9101^1^1^3040223^^^^
"DATA",9002313.91,104,10,1,0)
S BPS("X")=$G(BPS("Insurer","Other Payer Coverage Type"))
"DATA",9002313.91,104,20,0)
^9002313.9102^1^1^3040223^^^^
"DATA",9002313.91,104,20,1,0)

"DATA",9002313.91,104,25,0)
^9002313.9104^1^1^3040223^^^^
"DATA",9002313.91,104,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,104,30,0)
^^1^1^3040223^
"DATA",9002313.91,104,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337,0),U,2)=BPS("X")
"DATA",9002313.91,105,0)
339^6C^OTHER PAYER ID QUALIFIER^N^2
"DATA",9002313.91,105,5)
6C^2
"DATA",9002313.91,105,10,0)
^9002313.9101^1^1^3040223^^^
"DATA",9002313.91,105,10,1,0)
S BPS("X")=""
"DATA",9002313.91,105,20,0)
^9002313.9102^1^1^3040223^^^
"DATA",9002313.91,105,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,105,25,0)
^9002313.9104^1^1^3040223^^^
"DATA",9002313.91,105,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,105,30,0)
^^1^1^3040223^
"DATA",9002313.91,105,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337),U,10)=BPS("X")
"DATA",9002313.91,106,0)
340^7C^OTHER PAYER ID^A/N^10
"DATA",9002313.91,106,5)
7C^10
"DATA",9002313.91,106,10,0)
^9002313.9101^1^1^3040223^^
"DATA",9002313.91,106,10,1,0)
S BPS("X")=""
"DATA",9002313.91,106,20,0)
^9002313.9102^1^1^3040223^^
"DATA",9002313.91,106,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,106,25,0)
^9002313.9104^1^1^3040223^^
"DATA",9002313.91,106,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,106,30,0)
^^1^1^3040223^
"DATA",9002313.91,106,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337,0),U,3)=BPS("X")
"DATA",9002313.91,107,0)
341^HB^OTHER PAYER AMOUNT PAID COUNT^N^1
"DATA",9002313.91,107,5)
HB^1
"DATA",9002313.91,107,10,0)
^^1^1^3040224^
"DATA",9002313.91,107,10,1,0)
S BPS("X")=""
"DATA",9002313.91,107,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,107,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,107,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,107,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,107,30,0)
^9002313.9103^1^1^3040224^^
"DATA",9002313.91,107,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337,0),U,6)=BPS("X")
"DATA",9002313.91,108,0)
342^HC^OTH PYR AMOUNT PAID QUAL.^A/N^2
"DATA",9002313.91,108,5)
HC^2
"DATA",9002313.91,108,10,0)
^9002313.9101^1^1^3040428^^
"DATA",9002313.91,108,10,1,0)
S BPS("X")=""
"DATA",9002313.91,108,25,0)
^^1^1^3040428^
"DATA",9002313.91,108,25,1,0)
S BPS("X")=""
"DATA",9002313.91,108,30,0)
^9002313.9103^1^1^3040428^^^^
"DATA",9002313.91,108,30,1,0)
S FDA(54.3,"IENS(1),",342)=BPS("X")
"DATA",9002313.91,109,0)
343^HD^DISPENSING STATUS^A/N^1
"DATA",9002313.91,109,5)
HD^1
"DATA",9002313.91,109,10,0)
^9002313.9101^1^1^3040913^^^^
"DATA",9002313.91,109,10,1,0)
S BPS("X")=""
"DATA",9002313.91,109,20,0)
^9002313.9102^1^1^3040913^^^^
"DATA",9002313.91,109,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,109,25,0)
^9002313.9104^1^1^3040913^^^^
"DATA",9002313.91,109,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,109,30,0)
^^1^1^3040913^
"DATA",9002313.91,109,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),340,0),U,3)=""
"DATA",9002313.91,110,0)
344^HF^QTY INTENDED TO BE DISPENSED^D^10
"DATA",9002313.91,110,5)
HF^10
"DATA",9002313.91,110,10,0)
^9002313.9101^2^2^3040223^^
"DATA",9002313.91,110,10,1,0)
S BPS("X")=""
"DATA",9002313.91,110,10,2,0)
I $G(VARX) S BPS("X")=BPS("RX",BPS(9002313.0201),"Quantity")*1000
"DATA",9002313.91,110,25,0)
^9002313.9104^1^1^3040223^^^^
"DATA",9002313.91,110,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,110,30,0)
^9002313.9103^1^1^3040223^^^
"DATA",9002313.91,110,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),340,0),U,4)=BPS("X")
"DATA",9002313.91,111,0)
345^HG^DAYS SUPPLY INTEND TO BE DISP^N^3
"DATA",9002313.91,111,5)
HG^3
"DATA",9002313.91,111,10,0)
^9002313.9101^1^1^3030827^
"DATA",9002313.91,111,10,1,0)
S BPS("X")=$G(BPS("RX",BPS(9002313.0201),"Days Supply"))*1000
"DATA",9002313.91,111,25,0)
^9002313.9104^1^1^3030827^^^
"DATA",9002313.91,111,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,111,30,0)
^9002313.9103^1^1^3030827^^^^
"DATA",9002313.91,111,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),340,0),U,5)=BPS("X")
"DATA",9002313.91,112,0)
346^HH^BASIS OF CALC - DISP. FEE^A/N^8
"DATA",9002313.91,112,5)
HH^8
"DATA",9002313.91,112,10,0)
^9002313.9101^1^1^3031205^
"DATA",9002313.91,112,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340)),U,6)
"DATA",9002313.91,112,20,0)
^^1^1^3031205^
"DATA",9002313.91,112,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,112,25,0)
^^1^1^3031205^
"DATA",9002313.91,112,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,112,30,0)
^^1^1^3031205^
"DATA",9002313.91,112,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340),U,6)=BPS("X")
"DATA",9002313.91,113,0)
347^HJ^BASIS OF CALC - COPAY^A/N^8
"DATA",9002313.91,113,5)
HJ^8
"DATA",9002313.91,113,10,0)
^9002313.9101^1^1^3040114^^^
"DATA",9002313.91,113,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340)),U,7)
"DATA",9002313.91,113,20,0)
^9002313.9102^1^1^3040114^^^
"DATA",9002313.91,113,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,113,25,0)
^9002313.9104^1^1^3040114^^^
"DATA",9002313.91,113,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,113,30,0)
^9002313.9103^1^1^3040114^^^
"DATA",9002313.91,113,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340),U,7)=BPS("X")
"DATA",9002313.91,114,0)
348^HK^BASIS OF CALC - FLAT SALES TAX^A/N^8
"DATA",9002313.91,114,5)
HK^8
"DATA",9002313.91,114,10,0)
^9002313.9101^1^1^3031205^
"DATA",9002313.91,114,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340)),U,8)
"DATA",9002313.91,114,20,0)
^^1^1^3031205^
"DATA",9002313.91,114,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,114,25,0)
^^1^1^3031205^
"DATA",9002313.91,114,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,114,30,0)
^^1^1^3031205^
"DATA",9002313.91,114,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340),U,8)=BPS("X")
"DATA",9002313.91,115,0)
349^HM^BASIS OF CALC - %SALES TAX^A/N^8
"DATA",9002313.91,115,5)
HM^8
"DATA",9002313.91,115,10,0)
^9002313.9101^1^1^3031205^
"DATA",9002313.91,115,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340)),U,9)
"DATA",9002313.91,115,20,0)
^^1^1^3031205^
"DATA",9002313.91,115,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,115,25,0)
^^1^1^3031205^
"DATA",9002313.91,115,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,115,30,0)
^^1^1^3031205^
"DATA",9002313.91,115,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340),U,9)=BPS("X")
"DATA",9002313.91,116,0)
350^HN^PATIENT E-MAIL ADDRESS^A/N^80
"DATA",9002313.91,116,5)
HN^80
"DATA",9002313.91,116,10,0)
^^1^1^3030512^
"DATA",9002313.91,116,10,1,0)
S BPS("X")=""
"DATA",9002313.91,117,0)
351^NP^OTHER PAYER-PAT RESP AMT QUAL^A/N^1
"DATA",9002313.91,117,5)
NP^1
"DATA",9002313.91,117,10,0)
^^1^1^3031212^
"DATA",9002313.91,117,10,1,0)
S BPS("X")=""
"DATA",9002313.91,118,0)
352^NQ^OTHER PAYER-PAT RESP AMOUNT^D^10
"DATA",9002313.91,118,5)
NQ^10
"DATA",9002313.91,118,10,0)
^^1^1^3031212^
"DATA",9002313.91,118,10,1,0)
S BPS("X")=""
"DATA",9002313.91,118,20,0)
^^1^1^3031212^
"DATA",9002313.91,118,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,118,25,0)
^^1^1^3031212^
"DATA",9002313.91,118,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,119,0)
353^NR^OTHER PAYER-PAT RESP AMT CNT^N^1
"DATA",9002313.91,119,5)
NR^1
"DATA",9002313.91,119,10,0)
^^1^1^3031212^
"DATA",9002313.91,119,10,1,0)
S BPS("X")=""
"DATA",9002313.91,120,0)
445^EA^ORIG PRESCRIBED PROD/SERV CODE^A/N^19
"DATA",9002313.91,120,5)
EA^19
"DATA",9002313.91,120,10,0)
^9002313.9101^1^1^3040107^^
"DATA",9002313.91,120,10,1,0)
S BPX("X")=""
"DATA",9002313.91,120,20,0)
^9002313.9102^1^1^3040107^^
"DATA",9002313.91,120,20,1,0)
S BPS("X")=""
"DATA",9002313.91,120,25,0)
^9002313.9104^1^1^3040107^^
"DATA",9002313.91,120,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),19)
"DATA",9002313.91,120,30,0)
^9002313.9103^1^1^3040107^^
"DATA",9002313.91,120,30,1,0)
S BPS("X")=""
"DATA",9002313.91,121,0)
446^EB^ORIGINALLY PRESCRIBED QTY^D^10
"DATA",9002313.91,121,5)
EB^10
"DATA",9002313.91,121,10,0)
^9002313.9101^1^1^3030828^
"DATA",9002313.91,121,10,1,0)
S BPS("X")=BPS("RX",BPS(9002313.0201),"Quantity")*1000
"DATA",9002313.91,121,20,0)
^^1^1^3031212^
"DATA",9002313.91,121,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,121,25,0)
^9002313.9104^1^1^3030828^^^^
"DATA",9002313.91,121,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,121,30,0)
^9002313.9103^1^1^3030828^^^^
"DATA",9002313.91,121,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440),U,6)=BPS("X") ;VA
"DATA",9002313.91,122,0)
454^EK^SCHEDULED PRESCRIPTION ID NUM^N^12
"DATA",9002313.91,122,5)
EK^12
"DATA",9002313.91,122,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,122,10,1,0)
S BPS("X")=""
"DATA",9002313.91,122,20,0)
^9002313.9102^1^1^3040224^^
"DATA",9002313.91,122,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),12)
"DATA",9002313.91,122,25,0)
^9002313.9104^1^1^3040224^^
"DATA",9002313.91,122,25,1,0)
S BPS("X")=$$NFF^BPSECFM(BPS("X"),12)
"DATA",9002313.91,122,30,0)
^9002313.9103^1^1^3040224^^
"DATA",9002313.91,122,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,4)=BPS("X")
"DATA",9002313.91,123,0)
456^EN^ASSOC RX/SERVICE REF NUMBER^A/N^7
"DATA",9002313.91,123,5)
EN^7
"DATA",9002313.91,123,10,0)
^9002313.9101^1^1^3030823^^^^
"DATA",9002313.91,123,10,1,0)
S BPS("X")=""
"DATA",9002313.91,123,20,0)
^^1^1^3031205^
"DATA",9002313.91,123,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),7)
"DATA",9002313.91,123,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,123,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),7)
"DATA",9002313.91,123,30,0)
^^1^1^3030823^
"DATA",9002313.91,123,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,6)=BPS("X")
"DATA",9002313.91,124,0)
457^EP^ASSOC RX/SERVICE DATE^A/N^8
"DATA",9002313.91,124,5)
EP^8
"DATA",9002313.91,124,10,0)
^9002313.9101^1^1^3030825^^^^
"DATA",9002313.91,124,10,1,0)
S BPS("X")=""
"DATA",9002313.91,124,20,0)
^^1^1^3031205^
"DATA",9002313.91,124,20,1,0)
S BPS("X")=$$DTF1^BPSECFM(BPS("X"))
"DATA",9002313.91,124,25,0)
^9002313.9104^1^1^3030825^^
"DATA",9002313.91,124,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),8)
"DATA",9002313.91,124,30,0)
^9002313.9103^1^1^3030825^^^^
"DATA",9002313.91,124,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,7)=BPS("X")
"DATA",9002313.91,125,0)
458^SE^PROCEDURE MODIFIER CODE COUNT^N^1
"DATA",9002313.91,125,5)
SE^1
"DATA",9002313.91,125,10,0)
^9002313.9101^1^1^3040819^^^^
"DATA",9002313.91,125,10,1,0)
S BPS("X")=""
"DATA",9002313.91,125,20,0)
^9002313.9102^1^1^3040819^^^^
"DATA",9002313.91,125,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,125,25,0)
^9002313.9104^1^1^3040819^^^^
"DATA",9002313.91,125,25,1,0)
S BPS("X")=$$NFF^BPSECFM(BPS("X"),1)
"DATA",9002313.91,125,30,0)
^^1^1^3040819^
"DATA",9002313.91,125,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,8)=""
"DATA",9002313.91,126,0)
459^ER^PROCEDURE MODIFIER CODE^A/N^2
"DATA",9002313.91,126,5)
ER^2
"DATA",9002313.91,126,10,0)
^9002313.9101^1^1^3040819^^^^
"DATA",9002313.91,126,10,1,0)
S BPS("X")=""
"DATA",9002313.91,126,20,0)
^9002313.9102^1^1^3040819^^^^
"DATA",9002313.91,126,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,126,25,0)
^9002313.9104^1^1^3040819^^^^
"DATA",9002313.91,126,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,126,30,0)
^^1^1^3040819^
"DATA",9002313.91,126,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),450),U,10)=""
"DATA",9002313.91,127,0)
461^EU^PRIOR AUTHORIZATION TYPE CODE^N^2
"DATA",9002313.91,127,5)
EU^2
"DATA",9002313.91,127,10,0)
^9002313.9101^2^2^3031222^
"DATA",9002313.91,127,10,1,0)
S BPS("X")=$G(BPS("Claim",MEDN,"Prior Auth Type"))
"DATA",9002313.91,127,10,2,0)
S:BPS("X")="" BPS("X")=0
"DATA",9002313.91,127,20,0)
^9002313.9102^1^1^3031222^^^^
"DATA",9002313.91,127,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,127,25,0)
^9002313.9104^1^1^3031222^^^^
"DATA",9002313.91,127,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,127,30,0)
^9002313.9103^1^1^3031222^^^^
"DATA",9002313.91,127,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,1)=BPS("X")
"DATA",9002313.91,128,0)
462^EV^PRIOR AUTHORIZATION NUM SUB^A/N^11
"DATA",9002313.91,128,5)
EV^11
"DATA",9002313.91,128,10,0)
^9002313.9101^1^1^3031222^
"DATA",9002313.91,128,10,1,0)
S BPS("X")=$G(BPS("Claim",MEDN,"Prior Auth Num Sub"))
"DATA",9002313.91,128,20,0)
^9002313.9102^1^1^3031222^^^^
"DATA",9002313.91,128,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),11)
"DATA",9002313.91,128,25,0)
^9002313.9104^1^1^3031222^^^^
"DATA",9002313.91,128,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),11)
"DATA",9002313.91,128,30,0)
^9002313.9103^1^1^3031222^^^^
"DATA",9002313.91,128,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,2)=BPS("X")
"DATA",9002313.91,129,0)
464^EX^INTERMEDIARY AUTHORIZATION ID^A/N^11
"DATA",9002313.91,129,5)
EX^11
"DATA",9002313.91,129,10,0)
^9002313.9101^1^1^3030823^^^^
"DATA",9002313.91,129,10,1,0)
S BPS("X")=""
"DATA",9002313.91,129,20,0)
^^1^1^3031211^
"DATA",9002313.91,129,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),11)
"DATA",9002313.91,129,25,0)
^^1^1^3030823^
"DATA",9002313.91,129,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),11)
"DATA",9002313.91,129,30,0)
^9002313.9103^1^1^3030823^^^
"DATA",9002313.91,129,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,4)=BPS("X")
"DATA",9002313.91,130,0)
471^5E^OTHER PAYER REJECT COUNT^N^2
"DATA",9002313.91,130,5)
5E^2
"DATA",9002313.91,130,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,130,10,1,0)
S BPS("X")=""
"DATA",9002313.91,130,20,0)
^9002313.9102^1^1^3040224^^
"DATA",9002313.91,130,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,130,25,0)
^9002313.9104^1^1^3040224^^
"DATA",9002313.91,130,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,130,30,0)
^^1^1^3040224^
"DATA",9002313.91,130,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),337,0),U,4)=BPS("X")
"DATA",9002313.91,131,0)
472^6E^OTHER PAYER REJECT CODE^A/N^3
"DATA",9002313.91,131,5)
6E^3
"DATA",9002313.91,131,10,0)
^9002313.9101^1^1^3040224^^^
"DATA",9002313.91,131,10,1,0)
S BPS("X")=""
"DATA",9002313.91,131,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,131,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,131,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,131,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,132,0)
473^7E^DUR/PPS CODE COUNTER^N^1
"DATA",9002313.91,132,5)
7E^1
"DATA",9002313.91,132,10,0)
^9002313.9101^1^1^3031230^^^^
"DATA",9002313.91,132,10,1,0)
S BPS("X")=1
"DATA",9002313.91,132,20,0)
^9002313.9102^1^1^3031230^^^^
"DATA",9002313.91,132,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,132,25,0)
^9002313.9104^1^1^3031230^^^^
"DATA",9002313.91,132,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,132,30,0)
^9002313.9103^1^1^3031230^^^^
"DATA",9002313.91,132,30,1,0)
D FLD473^BPSOSSG
"DATA",9002313.91,133,0)
474^8E^DUR/PPS LEVEL OF EFFORT^N^2
"DATA",9002313.91,133,5)
8E^2
"DATA",9002313.91,133,10,0)
^9002313.9101^1^1^3030718^^
"DATA",9002313.91,133,10,1,0)
S BPS("X")=12
"DATA",9002313.91,133,20,0)
^9002313.9102^1^1^3031210^^
"DATA",9002313.91,133,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,133,25,0)
^^1^1^3030718^
"DATA",9002313.91,133,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,133,30,0)
^^1^1^3030718^
"DATA",9002313.91,133,30,1,0)
D FLD474^BPSOSSG
"DATA",9002313.91,134,0)
475^J9^DUR CO-AGENT ID QUALIFIER^A/N^2
"DATA",9002313.91,134,5)
J9^2
"DATA",9002313.91,134,10,0)
^9002313.9101^1^1^3030718^^
"DATA",9002313.91,134,10,1,0)
S BPS("X")=""
"DATA",9002313.91,134,20,0)
^9002313.9102^1^1^3031210^^^
"DATA",9002313.91,134,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,134,25,0)
^^1^1^3030718^
"DATA",9002313.91,134,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,134,30,0)
^^1^1^3030718^
"DATA",9002313.91,134,30,1,0)
D FLD475^BPSOSSG
"DATA",9002313.91,135,0)
476^H6^DUR CO-AGENT ID^A/N^19
"DATA",9002313.91,135,5)
H6^19
"DATA",9002313.91,135,10,0)
^9002313.9101^1^1^3040107^^^^
"DATA",9002313.91,135,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0)),U,7)
"DATA",9002313.91,135,20,0)
^9002313.9102^1^1^3040107^^^^
"DATA",9002313.91,135,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),19)
"DATA",9002313.91,135,25,0)
^9002313.9104^1^1^3040107^^^
"DATA",9002313.91,135,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),19)
"DATA",9002313.91,135,30,0)
^9002313.9103^1^1^3040107^^^
"DATA",9002313.91,135,30,1,0)
D FLD476^BPSOSSG
"DATA",9002313.91,136,0)
477^BE^PROFESSIONAL SERV FEE SUBMIT^D^8
"DATA",9002313.91,136,5)
BE^8
"DATA",9002313.91,136,10,0)
^9002313.9101^1^1^3030823^
"DATA",9002313.91,136,10,1,0)
S BPS("X")=0
"DATA",9002313.91,136,20,0)
^^1^1^3031217^
"DATA",9002313.91,136,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,136,25,0)
^9002313.9104^1^1^3030823^^
"DATA",9002313.91,136,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,136,30,0)
^9002313.9103^1^1^3030823^^
"DATA",9002313.91,136,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),470),U,7)=BPS("X")
"DATA",9002313.91,139,0)
481^HA^FLAT SALES TAX AMOUNT SUBMIT^D^8
"DATA",9002313.91,139,5)
HA^8
"DATA",9002313.91,139,10,0)
^9002313.9101^1^1^3040907^^^
"DATA",9002313.91,139,10,1,0)
S BPS("X")=""
"DATA",9002313.91,139,20,0)
^9002313.9102^1^1^3040907^^
"DATA",9002313.91,139,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,139,25,0)
^9002313.9104^1^1^3040907^^
"DATA",9002313.91,139,25,1,0)
S BPS("X")=$$DFF^BPSECFM(BPS("X"),8)
"DATA",9002313.91,139,30,0)
^9002313.9103^1^1^3040907^^
"DATA",9002313.91,139,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,1)=BPS("X")
"DATA",9002313.91,140,0)
482^GE^PERCENTAGE SALES TAX AMT SUB^D^8
"DATA",9002313.91,140,5)
GE^8
"DATA",9002313.91,140,10,0)
^^1^1^3050802^
"DATA",9002313.91,140,10,1,0)
S BPS("X")=0
"DATA",9002313.91,140,20,0)
^9002313.9102^1^1^3040907^^^^
"DATA",9002313.91,140,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,140,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,140,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,140,30,0)
^9002313.9103^1^1^3040907^^^^
"DATA",9002313.91,140,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,2)=BPS("X")
"DATA",9002313.91,141,0)
483^HE^PERCENT SALES TAX RATE SUB^D^7
"DATA",9002313.91,141,5)
HE^7
"DATA",9002313.91,141,10,0)
^^1^1^3050802^
"DATA",9002313.91,141,10,1,0)
S BPS("X")=BPS("Insurer","Percent Sales Tax Rate Sub")
"DATA",9002313.91,141,20,0)
^9002313.9102^1^1^3040907^^^^
"DATA",9002313.91,141,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),7)
"DATA",9002313.91,141,25,0)
^9002313.9104^1^1^3040907^^^^
"DATA",9002313.91,141,25,1,0)
S BPS("X")=$$DFF^BPSECFM(BPS("X"),7)
"DATA",9002313.91,141,30,0)
^9002313.9103^1^1^3040907^^^^
"DATA",9002313.91,141,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,3)=BPS("X")
"DATA",9002313.91,142,0)
484^JE^PERCENT SALES TAX BASIS SUB^A/N^2
"DATA",9002313.91,142,5)
JE^2
"DATA",9002313.91,142,10,0)
^9002313.9101^1^1^3050802^^^^
"DATA",9002313.91,142,10,1,0)
S BPS("X")=""
"DATA",9002313.91,142,20,0)
^^1^1^3031212^
"DATA",9002313.91,142,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,142,25,0)
^^1^1^3030824^
"DATA",9002313.91,142,25,1,0)
S BPS("X")=$$ANFF^BPSECFM(BPS("X"),2)
"DATA",9002313.91,142,30,0)
^9002313.9103^1^1^3030824^^^
"DATA",9002313.91,142,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,4)=BPS("X")
"DATA",9002313.91,143,0)
485^KE^COUPON TYPE^A/N^2
"DATA",9002313.91,143,5)
KE^2
"DATA",9002313.91,143,10,0)
^9002313.9101^1^1^3040107^^
"DATA",9002313.91,143,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480)),U,5)
"DATA",9002313.91,143,20,0)
^9002313.9102^1^1^3040107^^
"DATA",9002313.91,143,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,143,25,0)
^9002313.9104^1^1^3040107^^
"DATA",9002313.91,143,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,143,30,0)
^9002313.9103^1^1^3040107^^
"DATA",9002313.91,143,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,5)=BPS("X")
"DATA",9002313.91,144,0)
486^ME^COUPON NUMBER^A/N^15
"DATA",9002313.91,144,5)
ME^15
"DATA",9002313.91,144,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,144,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480)),U,6)
"DATA",9002313.91,144,20,0)
^9002313.9102^1^1^3031210^^
"DATA",9002313.91,144,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,144,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,144,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,144,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,144,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,6)=BPS("X")
"DATA",9002313.91,145,0)
487^NE^COUPON VALUE AMOUNT^D^8
"DATA",9002313.91,145,5)
NE^8
"DATA",9002313.91,145,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,145,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480)),U,7)
"DATA",9002313.91,145,20,0)
^9002313.9102^1^1^3031210^^
"DATA",9002313.91,145,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,145,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,145,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,145,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,145,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),480),U,7)=BPS("X")
"DATA",9002313.91,146,0)
491^VE^DIAGNOSIS CODE COUNT^N^1
"DATA",9002313.91,146,5)
VE^1
"DATA",9002313.91,146,10,0)
^9002313.9101^1^1^3040107^^^^
"DATA",9002313.91,146,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),490)),U,1)
"DATA",9002313.91,146,20,0)
^9002313.9102^1^1^3040107^^^^
"DATA",9002313.91,146,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,146,25,0)
^9002313.9104^1^1^3040107^^^^
"DATA",9002313.91,146,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,147,0)
492^WE^DIAGNOSIS CODE QUALIFIER^A/N^2
"DATA",9002313.91,147,5)
WE^2
"DATA",9002313.91,147,10,0)
^^1^1^3040224^
"DATA",9002313.91,147,10,1,0)
S BPS("X")=""
"DATA",9002313.91,147,20,0)
^9002313.9102^1^1^3040224^^^
"DATA",9002313.91,147,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,147,25,0)
^9002313.9104^1^1^3040224^^^
"DATA",9002313.91,147,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,148,0)
493^XE^CLINICAL INFORMATION COUNTER^N^1
"DATA",9002313.91,148,5)
XE^1
"DATA",9002313.91,148,10,0)
^^1^1^3040224^
"DATA",9002313.91,148,10,1,0)
S BPS("X")=""
"DATA",9002313.91,148,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,148,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,148,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,148,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,149,0)
498.01^PA^REQUEST TYPE^N^1
"DATA",9002313.91,149,5)
PA^1
"DATA",9002313.91,149,10,0)
^9002313.9101^1^1^3040428^^
"DATA",9002313.91,149,10,1,0)
S BPS("X")=""
"DATA",9002313.91,149,25,0)
^^1^1^3040428^
"DATA",9002313.91,149,25,1,0)
S BPS("X")=""
"DATA",9002313.91,150,0)
498.02^PB^REQUEST PERIOD DATE-BEGIN^A/N^8
"DATA",9002313.91,150,5)
PB^8
"DATA",9002313.91,150,10,0)
^^1^1^3040223^
"DATA",9002313.91,150,10,1,0)
S BPS("X")=""
"DATA",9002313.91,151,0)
498.03^PC^REQUEST PERIOD DATE-END^A/N^8
"DATA",9002313.91,151,5)
PC^8
"DATA",9002313.91,151,10,0)
^^1^1^3040223^
"DATA",9002313.91,151,10,1,0)
S BPS("X")=""
"DATA",9002313.91,152,0)
498.04^PD^BASIS OF REQUEST^A/N^2
"DATA",9002313.91,152,5)
PD^2
"DATA",9002313.91,152,10,0)
^^1^1^3040223^
"DATA",9002313.91,152,10,1,0)
S BPS("X")=""
"DATA",9002313.91,153,0)
498.05^PE^AUTH REP FIRST NAME^A/N^12
"DATA",9002313.91,153,5)
PE^12
"DATA",9002313.91,153,10,0)
^9002313.9101^1^1^3040223^^^
"DATA",9002313.91,153,10,1,0)
S BPS("X")=""
"DATA",9002313.91,154,0)
498.06^PF^AUTHORIZED REP LAST NAME^A/N^15
"DATA",9002313.91,154,5)
PF^15
"DATA",9002313.91,154,10,0)
^^1^1^3040223^
"DATA",9002313.91,154,10,1,0)
S BPS("X")=""
"DATA",9002313.91,155,0)
498.07^PG^AUTH REP STREET ADDRESS^A/N^30
"DATA",9002313.91,155,5)
PG^30
"DATA",9002313.91,155,10,0)
^^1^1^3040223^
"DATA",9002313.91,155,10,1,0)
S BPS("X")=""
"DATA",9002313.91,156,0)
498.08^PH^AUTH REP CITY ADDRESS^A/N^20
"DATA",9002313.91,156,5)
PH^20
"DATA",9002313.91,156,10,0)
^^1^1^3040223^
"DATA",9002313.91,156,10,1,0)
S BPS("X")=""
"DATA",9002313.91,157,0)
498.09^PJ^AUTH REP STATE/PROV ADDRESS^A/N^2
"DATA",9002313.91,157,5)
PJ^2
"DATA",9002313.91,157,10,0)
^^1^1^3040223^
"DATA",9002313.91,157,10,1,0)
S BPS("X")=""
"DATA",9002313.91,158,0)
498.11^PK^AUTH REP ZIP/POSTAL CODE^A/N^15
"DATA",9002313.91,158,5)
PK^15
"DATA",9002313.91,158,10,0)
^^1^1^3040223^
"DATA",9002313.91,158,10,1,0)
S BPS("X")=""
"DATA",9002313.91,159,0)
498.12^PM^PRESCRIBER PHONE NUMBER^N^10
"DATA",9002313.91,159,5)
PM^10
"DATA",9002313.91,159,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,159,10,1,0)
S BPS("X")=$TR($G(BPS("RX",MEDN,"Prescriber Phone #")),"#() -_*.@")
"DATA",9002313.91,159,25,0)
^9002313.9104^1^1^3030722^^
"DATA",9002313.91,159,25,1,0)
S BPS("X")=$$NFF^BPSECFM(BPS("X"),10)
"DATA",9002313.91,159,30,0)
^9002313.9103^1^1^3030722^^
"DATA",9002313.91,159,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),498),U,12)=BPS("X")
"DATA",9002313.91,160,0)
498.13^PP^PRIOR AUTH SUPPORTING DOC^A/N^200
"DATA",9002313.91,160,5)
PP^200
"DATA",9002313.91,160,10,0)
^^1^1^3040223^
"DATA",9002313.91,160,10,1,0)
S BPS("X")=""
"DATA",9002313.91,161,0)
498.14^PY^PRIOR AUTH NUMBER ASSIGN^N^8
"DATA",9002313.91,161,5)
PY^8
"DATA",9002313.91,161,10,0)
^^1^1^3040223^
"DATA",9002313.91,161,10,1,0)
S BPS("X")=""
"DATA",9002313.91,162,0)
498.52^PS^PRIOR AUTHO EFFECT. DATE^A/N^8
"DATA",9002313.91,162,5)
PS^8
"DATA",9002313.91,162,10,0)
^^1^1^3040223^
"DATA",9002313.91,162,10,1,0)
S BPS("X")=""
"DATA",9002313.91,163,0)
498.53^PT^PRIOR AUTHO EXP. DATE^A/N^8
"DATA",9002313.91,163,5)
PT^8
"DATA",9002313.91,163,10,0)
^^1^1^3040223^
"DATA",9002313.91,163,10,1,0)
S BPS("X")=""
"DATA",9002313.91,164,0)
498.54^PW^PRIOR AUTH. NUM REFILLS^N^8
"DATA",9002313.91,164,5)
PW^8
"DATA",9002313.91,164,10,0)
^^1^1^3040223^
"DATA",9002313.91,164,10,1,0)
S BPS("X")=""
"DATA",9002313.91,165,0)
498.55^PX^PRIOR AUTH QTY ACCUM^N^8
"DATA",9002313.91,165,5)
PX^8
"DATA",9002313.91,165,10,0)
^^1^1^3040223^
"DATA",9002313.91,165,10,1,0)
S BPS("X")=""
"DATA",9002313.91,166,0)
498.57^RA^PRIOR AUTH QTY^A/N^3
"DATA",9002313.91,166,5)
RA^3
"DATA",9002313.91,166,10,0)
^^1^1^3040223^
"DATA",9002313.91,166,10,1,0)
S BPS("X")=""
"DATA",9002313.91,167,0)
498.58^RB^PRIOR AUTH DOLLARS AUTH^N^8
"DATA",9002313.91,167,5)
RB^8
"DATA",9002313.91,167,10,0)
^^1^1^3040223^
"DATA",9002313.91,167,10,1,0)
S BPS("X")=""
"DATA",9002313.91,168,0)
498.59^PH^AUTH REP CITY ADDRESS^A/N^20
"DATA",9002313.91,168,5)
PH^20
"DATA",9002313.91,168,10,0)
^^1^1^3030512^
"DATA",9002313.91,168,10,1,0)
S BPS("X")=""
"DATA",9002313.91,169,0)
501^AN^HEADER RESPONSE STATUS^A/N^1
"DATA",9002313.91,169,5)
AN^1
"DATA",9002313.91,169,10,0)
^9002313.9101^1^1^3040202^^^
"DATA",9002313.91,169,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),500)),U,1)
"DATA",9002313.91,169,20,0)
^9002313.9102^1^1^3040202^^^
"DATA",9002313.91,169,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,169,25,0)
^9002313.9104^1^1^3040202^^^
"DATA",9002313.91,169,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,169,30,0)
^9002313.9103^1^1^3040202^^^
"DATA",9002313.91,169,30,1,0)
S $P(^BPSR(BPS(9002313.02),500),U,1)=BPS("X")
"DATA",9002313.91,170,0)
503^F3^AUTHORIZTION NUMBER^A/N^20
"DATA",9002313.91,170,5)
F3^20
"DATA",9002313.91,170,10,0)
^9002313.9101^1^1^3030718^^
"DATA",9002313.91,170,10,1,0)
S BPS("X")=""
"DATA",9002313.91,170,20,0)
^^1^1^3031205^
"DATA",9002313.91,170,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,170,30,0)
^^1^1^3031205^
"DATA",9002313.91,170,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,3)=BPS("X")
"DATA",9002313.91,171,0)
504^F4^MESSAGE^A/N^200
"DATA",9002313.91,171,5)
F4^200
"DATA",9002313.91,171,10,0)
^^1^1^3031211^
"DATA",9002313.91,171,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),504)),U,1)
"DATA",9002313.91,171,20,0)
^^1^1^3031211^
"DATA",9002313.91,171,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),200)
"DATA",9002313.91,171,25,0)
^^1^1^3031211^
"DATA",9002313.91,171,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),200)
"DATA",9002313.91,171,30,0)
^^1^1^3031211^
"DATA",9002313.91,171,30,1,0)
S $P(^BPSR(BPS(9002313.02),504),U,1)=BPS("X")
"DATA",9002313.91,172,0)
505^F5^PATIENT PAY AMOUNT^A/N^8
"DATA",9002313.91,172,5)
F5^8
"DATA",9002313.91,172,10,0)
^9002313.9101^1^1^3031212^^
"DATA",9002313.91,172,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,5)
"DATA",9002313.91,172,20,0)
^9002313.9102^1^1^3031212^^
"DATA",9002313.91,172,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,172,25,0)
^9002313.9104^1^1^3031212^^
"DATA",9002313.91,172,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,172,30,0)
^9002313.9103^1^1^3031212^^
"DATA",9002313.91,172,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,5)=S BPS("X")
"DATA",9002313.91,173,0)
506^F6^INGREDIENT COST PAID^A/N^8
"DATA",9002313.91,173,5)
F6^8
"DATA",9002313.91,173,10,0)
^9002313.9101^1^1^3031211^^
"DATA",9002313.91,173,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,6)
"DATA",9002313.91,173,20,0)
^9002313.9102^1^1^3031211^^
"DATA",9002313.91,173,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,173,25,0)
^9002313.9104^1^1^3031211^^
"DATA",9002313.91,173,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,173,30,0)
^9002313.9103^1^1^3031211^^
"DATA",9002313.91,173,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,6)=BPS("X")
"DATA",9002313.91,174,0)
507^F7^DISPENSING FEE PAID^A/N^8
"DATA",9002313.91,174,5)
F7^8
"DATA",9002313.91,174,10,0)
^9002313.9101^1^1^3031210^^^
"DATA",9002313.91,174,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,7)
"DATA",9002313.91,174,20,0)
^9002313.9102^1^1^3031210^^^
"DATA",9002313.91,174,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),
"DATA",9002313.91,174,25,0)
^9002313.9104^1^1^3031210^^^
"DATA",9002313.91,174,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,174,30,0)
^9002313.9103^1^1^3031210^^^
"DATA",9002313.91,174,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,7)=BPS("X")
"DATA",9002313.91,175,0)
509^F9^TOTAL AMOUNT PAID^A/N^8
"DATA",9002313.91,175,5)
F9^8
"DATA",9002313.91,175,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,175,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,9)
"DATA",9002313.91,175,20,0)
^9002313.9102^1^1^3031217^^
"DATA",9002313.91,175,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,175,25,0)
^9002313.9104^1^1^3031217^^
"DATA",9002313.91,175,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,175,30,0)
^9002313.9103^1^1^3031217^^
"DATA",9002313.91,175,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,9)
"DATA",9002313.91,176,0)
510^FA^REJECT COUNT^N^2
"DATA",9002313.91,176,5)
FA^2
"DATA",9002313.91,176,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,176,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,10)
"DATA",9002313.91,176,20,0)
^^1^1^3031217^
"DATA",9002313.91,176,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,176,25,0)
^^1^1^3031217^
"DATA",9002313.91,176,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,176,30,0)
^^1^1^3031217^
"DATA",9002313.91,176,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,10)=BPS("X")
"DATA",9002313.91,177,0)
511^FB^REJECT CODE^A/N^3
"DATA",9002313.91,177,5)
FB^3
"DATA",9002313.91,177,10,0)
^9002313.9101^1^1^3031217^^^
"DATA",9002313.91,177,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),511,DUR,0)),U,1)
"DATA",9002313.91,177,20,0)
^9002313.9102^1^1^3031217^^
"DATA",9002313.91,177,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,177,25,0)
^9002313.9104^1^1^3031217^^
"DATA",9002313.91,177,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,177,30,0)
^9002313.9103^1^1^3031217^^
"DATA",9002313.91,177,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),511,DUR,0),U,1)
"DATA",9002313.91,178,0)
512^FC^ACCUM DEDUC AMT^A/N^8
"DATA",9002313.91,178,5)
FC^8
"DATA",9002313.91,178,10,0)
^9002313.9101^1^1^3031210^^^^
"DATA",9002313.91,178,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),"^",10)
"DATA",9002313.91,178,20,0)
^9002313.9102^1^1^3031210^^^^
"DATA",9002313.91,178,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,178,25,0)
^9002313.9104^1^1^3031210^^^^
"DATA",9002313.91,178,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,178,30,0)
^9002313.9103^1^1^3031210^^^^
"DATA",9002313.91,178,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),"^",10)=BPS("X")
"DATA",9002313.91,179,0)
513^FD^REMAIN, DEDUC. AMT^A/N^8
"DATA",9002313.91,179,5)
FD^8
"DATA",9002313.91,179,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,179,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,13)
"DATA",9002313.91,179,20,0)
^9002313.9102^1^1^3031217^^
"DATA",9002313.91,179,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,179,25,0)
^9002313.9104^1^1^3031217^^
"DATA",9002313.91,179,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,179,30,0)
^9002313.9103^1^1^3031217^^
"DATA",9002313.91,179,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,13)=BPS("X")
"DATA",9002313.91,180,0)
514^FE^REMAIN. BENEFIT AMT^A/N^8
"DATA",9002313.91,180,5)
FE^8
"DATA",9002313.91,180,10,0)
^9002313.9101^1^1^3031217^^^
"DATA",9002313.91,180,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,14)
"DATA",9002313.91,180,20,0)
^9002313.9102^1^1^3031217^^^
"DATA",9002313.91,180,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,180,25,0)
^9002313.9104^1^1^3031217^^^
"DATA",9002313.91,180,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,180,30,0)
^9002313.9103^1^1^3031217^^^
"DATA",9002313.91,180,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,14)
"DATA",9002313.91,181,0)
516^FG^DRUG DESCRIPTION^A/N^30
"DATA",9002313.91,181,5)
FG^30
"DATA",9002313.91,181,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,181,10,1,0)
S BPS("X")=BPS("RX",1,"Drug Name")
"DATA",9002313.91,181,20,0)
^9002313.9102^1^1^3031210^^
"DATA",9002313.91,181,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,181,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,181,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,182,0)
517^FH^AMT APPLIED TO PER. DEDUCT.^D^8
"DATA",9002313.91,182,5)
FH^8
"DATA",9002313.91,182,10,0)
^9002313.9101^1^1^3031205^^^
"DATA",9002313.91,182,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),"^",17)
"DATA",9002313.91,182,20,0)
^9002313.9102^1^1^3031205^^^^
"DATA",9002313.91,182,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,182,25,0)
^9002313.9104^1^1^3031205^^^
"DATA",9002313.91,182,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,182,30,0)
^9002313.9103^1^1^3031205^^
"DATA",9002313.91,182,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),"^",17)=BPS("X")
"DATA",9002313.91,183,0)
518^FI^AMT OF COPAY/CO-INS^D^8
"DATA",9002313.91,183,5)
FI^8
"DATA",9002313.91,183,10,0)
^^1^1^3030512^
"DATA",9002313.91,183,10,1,0)
S BPS("X")=""
"DATA",9002313.91,183,20,0)
^^1^1^3031205^
"DATA",9002313.91,183,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,183,25,0)
^^1^1^3031205^
"DATA",9002313.91,183,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,183,30,0)
^^1^1^3031205^
"DATA",9002313.91,183,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),"^",18)=BPS("X")
"DATA",9002313.91,184,0)
519^FJ^AMT. ATTRIB TO PRODUCT SEL.^D^8
"DATA",9002313.91,184,5)
FJ^8
"DATA",9002313.91,184,10,0)
^^1^1^3030512^
"DATA",9002313.91,184,10,1,0)
S BPS("X")=""
"DATA",9002313.91,184,20,0)
^^1^1^3031205^
"DATA",9002313.91,184,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,184,25,0)
^^1^1^3031205^
"DATA",9002313.91,184,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,184,30,0)
^^1^1^3031205^
"DATA",9002313.91,184,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,19)=BPS("X")
"DATA",9002313.91,185,0)
520^FK^AMT. EXCEEDING PER. MAX^D^8
"DATA",9002313.91,185,5)
FK^8
"DATA",9002313.91,185,10,0)
^9002313.9101^1^1^3030512^
"DATA",9002313.91,185,10,1,0)
S BPS("X")=""
"DATA",9002313.91,185,20,0)
^^1^1^3031205^
"DATA",9002313.91,185,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,185,25,0)
^^1^1^3031205^
"DATA",9002313.91,185,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,185,30,0)
^^1^1^3031205^
"DATA",9002313.91,185,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,20)=BPS("X")
"DATA",9002313.91,186,0)
521^FL^INCENTIVE AMOUNT PAID^A/N^8
"DATA",9002313.91,186,5)
FL^8
"DATA",9002313.91,186,10,0)
^9002313.9101^1^1^3031210^
"DATA",9002313.91,186,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,21)
"DATA",9002313.91,186,20,0)
^^1^1^3031210^
"DATA",9002313.91,186,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,186,25,0)
^^1^1^3031210^
"DATA",9002313.91,186,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,186,30,0)
^^1^1^3031210^
"DATA",9002313.91,186,30,1,0)
$P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,21)=BPS("X")
"DATA",9002313.91,187,0)
522^FM^BASIS OF REIM. DETERM.^N^2
"DATA",9002313.91,187,5)
FM^2
"DATA",9002313.91,187,10,0)
^9002313.9101^1^1^3031205^
"DATA",9002313.91,187,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),"^",22)
"DATA",9002313.91,187,20,0)
^^1^1^3031205^
"DATA",9002313.91,187,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,187,25,0)
^^1^1^3031205^
"DATA",9002313.91,187,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,187,30,0)
^^1^1^3031205^
"DATA",9002313.91,187,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,22)=BPS("X")
"DATA",9002313.91,188,0)
523^FN^AMT ATTRIV TO SALES TAX^D^8
"DATA",9002313.91,188,5)
FN^8
"DATA",9002313.91,188,10,0)
^^1^1^3030512^
"DATA",9002313.91,188,10,1,0)
S BPS("X")=""
"DATA",9002313.91,188,20,0)
^^1^1^3031205^
"DATA",9002313.91,188,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,188,25,0)
^^1^1^3031205^
"DATA",9002313.91,188,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,188,30,0)
^^1^1^3031205^
"DATA",9002313.91,188,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),"^",23)=BPS("X")
"DATA",9002313.91,189,0)
524^FO^PLAN ID^A/N^8
"DATA",9002313.91,189,5)
FO^8
"DATA",9002313.91,189,10,0)
^9002313.9101^1^1^3030825^^^^
"DATA",9002313.91,189,10,1,0)
S BPS("X")=$$GET1^DIQ(2.312,"1,"_DFN_",",.18)
"DATA",9002313.91,189,20,0)
^^1^1^3031216^
"DATA",9002313.91,189,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,189,25,0)
^^1^1^3030825^
"DATA",9002313.91,189,25,1,0)
S BPS("X")="FO"_$$ANFF^BPSECFM(BPS("X"),8)
"DATA",9002313.91,189,30,0)
^9002313.9103^1^1^3030825^^^^
"DATA",9002313.91,189,30,1,0)
S $P(^BPSC(BPS(9002313.02),520),U,4)=BPS("X")
"DATA",9002313.91,190,0)
525^FP^DUR RESPONSE DATA^A/N
"DATA",9002313.91,190,5)
FP
"DATA",9002313.91,190,10,0)
^^1^1^3040223^
"DATA",9002313.91,190,10,1,0)
S BPS("X")=""
"DATA",9002313.91,191,0)
526^FQ^ADDITIONAL MESSAGE INFO^A/N^200
"DATA",9002313.91,191,5)
FQ^200
"DATA",9002313.91,191,10,0)
^9002313.9101^1^1^3031210^^^^
"DATA",9002313.91,191,10,1,0)
S BPS("X")=$G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),526))
"DATA",9002313.91,191,20,0)
^9002313.9102^1^1^3031210^^^^
"DATA",9002313.91,191,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),200)
"DATA",9002313.91,191,25,0)
^9002313.9104^1^1^3031210^^^^
"DATA",9002313.91,191,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),200)
"DATA",9002313.91,191,30,0)
^9002313.9103^1^1^3031210^^^^
"DATA",9002313.91,191,30,1,0)
S ^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),526)=BPS("X")
"DATA",9002313.91,192,0)
528^FS^CLINICAL SIGNIFICANCE CODE^A/N^1
"DATA",9002313.91,192,5)
FS^1
"DATA",9002313.91,192,10,0)
^9002313.9101^1^1^3031210^^^^
"DATA",9002313.91,192,10,1,0)
S BPS("X")=$G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),525))
"DATA",9002313.91,192,20,0)
^9002313.9102^1^1^3031210^^^^
"DATA",9002313.91,192,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,192,25,0)
^9002313.9104^1^1^3031210^^^^
"DATA",9002313.91,192,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,192,30,0)
^9002313.9103^1^1^3031210^^^^
"DATA",9002313.91,192,30,1,0)
S ^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),525)=$G(BPS("X"))
"DATA",9002313.91,193,0)
529^FT^OTHER PHARMACY INDICATOR^A/N^1
"DATA",9002313.91,193,5)
FT^1
"DATA",9002313.91,193,10,0)
^^1^1^3031212^
"DATA",9002313.91,193,10,1,0)
S BPS("X")=""
"DATA",9002313.91,194,0)
530^FU^PREVIOUS DATE OF FILL^A/N^8
"DATA",9002313.91,194,5)
FU^8
"DATA",9002313.91,194,10,0)
^9002313.9101^1^1^3031216^^^
"DATA",9002313.91,194,10,1,0)
S BPS("X")=$$GET^DDSVAL(52,BPS("RX",DUR,"RX IEN"),101)
"DATA",9002313.91,194,20,0)
^9002313.9102^1^1^3031216^^
"DATA",9002313.91,194,20,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X"))
"DATA",9002313.91,194,25,0)
^^1^1^3031216^
"DATA",9002313.91,194,25,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X"))
"DATA",9002313.91,194,30,0)
^^1^1^3031216^
"DATA",9002313.91,194,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0),U,5)=BPS("X")
"DATA",9002313.91,195,0)
531^FV^QUANTITY OF PREVIOUS FILL^N^8
"DATA",9002313.91,195,5)
FV^8
"DATA",9002313.91,195,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,195,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0)),U,6)
"DATA",9002313.91,195,20,0)
^9002313.9102^1^1^3031217^^
"DATA",9002313.91,195,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,195,25,0)
^9002313.9104^1^1^3031217^^
"DATA",9002313.91,195,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,195,30,0)
^9002313.9103^1^1^3031217^^
"DATA",9002313.91,195,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0),U,6)=BPS("X")
"DATA",9002313.91,196,0)
532^FW^DATABASE INDICATOR^A/N^1
"DATA",9002313.91,196,5)
FW^1
"DATA",9002313.91,196,10,0)
^9002313.9101^1^1^3031210^^^
"DATA",9002313.91,196,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,BPS(9002313.020101),0)),U,7)
"DATA",9002313.91,196,20,0)
^9002313.9102^1^1^3031210^^^
"DATA",9002313.91,196,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,196,25,0)
^9002313.9104^1^1^3031210^^^
"DATA",9002313.91,196,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,196,30,0)
^9002313.9103^1^1^3031210^^^
"DATA",9002313.91,196,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,BPS(9002313.020101),0),U,7)=BPS("X")
"DATA",9002313.91,197,0)
533^FX^OTHER PRESCRIBER INDICATOR^A/N^1
"DATA",9002313.91,197,5)
FX^1
"DATA",9002313.91,197,10,0)
^^1^1^3031212^
"DATA",9002313.91,197,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0)),U,8)
"DATA",9002313.91,197,20,0)
^^1^1^3031212^
"DATA",9002313.91,197,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,197,25,0)
^^1^1^3031212^
"DATA",9002313.91,197,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,197,30,0)
^^1^1^3031212^
"DATA",9002313.91,197,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0),U,8)=BPS("X")
"DATA",9002313.91,198,0)
535^FZ^DUR OVERFLOW^A/N
"DATA",9002313.91,198,5)
FZ
"DATA",9002313.91,198,10,0)
^^1^1^3040223^
"DATA",9002313.91,198,10,1,0)
S BPS("X")=""
"DATA",9002313.91,199,0)
544^FY^DUR FREE TEXT MESSAGE^A/N^30
"DATA",9002313.91,199,5)
FY^30
"DATA",9002313.91,199,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,199,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0)),U,9)
"DATA",9002313.91,199,20,0)
^9002313.9102^1^1^3031210^^
"DATA",9002313.91,199,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,199,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,199,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,199,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,199,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0),U,9)=BPS("X")
"DATA",9002313.91,200,0)
545^2F^NETWORK REIMBURSEMENT ID^A/N^10
"DATA",9002313.91,200,5)
2F^10
"DATA",9002313.91,200,10,0)
^^1^1^3040223^
"DATA",9002313.91,200,10,1,0)
S BPS("X")=""
"DATA",9002313.91,201,0)
546^4F^REJ FIELD OCCUR. INDICATOR^A/N^2
"DATA",9002313.91,201,5)
4F^2
"DATA",9002313.91,201,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,201,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),511,DUR,0)),U,2)
"DATA",9002313.91,201,20,0)
^9002313.9102^1^1^3031217^^
"DATA",9002313.91,201,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,201,25,0)
^9002313.9104^1^1^3031217^^
"DATA",9002313.91,201,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,201,30,0)
^9002313.9103^1^1^3031217^^
"DATA",9002313.91,201,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),511,DUR,0),U,2)=BPS("X")
"DATA",9002313.91,202,0)
547^5F^APPROVED MESSAGE CODE COUNT^A/N^1
"DATA",9002313.91,202,5)
5F^1
"DATA",9002313.91,202,10,0)
^^1^1^3030512^
"DATA",9002313.91,202,10,1,0)
S BPS("X")=""
"DATA",9002313.91,202,20,0)
^^1^1^3031205^
"DATA",9002313.91,202,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,202,25,0)
^^1^1^3031205^
"DATA",9002313.91,202,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,202,30,0)
^^1^1^3031205^
"DATA",9002313.91,202,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),540),U,7)=BPS("X")
"DATA",9002313.91,203,0)
548^6F^APPROVED MESSAGE CODE^A/N^3
"DATA",9002313.91,203,5)
6F^3
"DATA",9002313.91,203,10,0)
^^1^1^3030512^
"DATA",9002313.91,203,10,1,0)
S BPS("X")=""
"DATA",9002313.91,203,20,0)
^9002313.9102^1^1^3031210^^^
"DATA",9002313.91,203,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,203,25,0)
^9002313.9104^1^1^3031210^^^
"DATA",9002313.91,203,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),3)
"DATA",9002313.91,203,30,0)
^9002313.9103^1^1^3031210^^^
"DATA",9002313.91,203,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),548,0),B,4)=BPS("X")
"DATA",9002313.91,204,0)
549^7F^HELP DESK PHONE NUMBER QUAL^A/N^2
"DATA",9002313.91,204,5)
7F^2
"DATA",9002313.91,204,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,204,10,1,0)
S BPS("X")=$TR($P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),540)),U,9),"#() -_*.@")
"DATA",9002313.91,204,20,0)
^^1^1^3031210^
"DATA",9002313.91,204,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,204,25,0)
^^1^1^3031210^
"DATA",9002313.91,204,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,204,30,0)
^^1^1^3031210^
"DATA",9002313.91,204,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),540),U,9)=BPS("X")
"DATA",9002313.91,205,0)
550^8F^HELP DESK PHONE NUMBER^A/N^18
"DATA",9002313.91,205,5)
8F^18
"DATA",9002313.91,205,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,205,10,1,0)
S BPS("X")=$TR($P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),540)),U,10),"#() -_*.@")
"DATA",9002313.91,205,20,0)
^9002313.9102^1^1^3031210^^
"DATA",9002313.91,205,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),18)
"DATA",9002313.91,205,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,205,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),18)
"DATA",9002313.91,205,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,205,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),540),U,10)=BPS("X")
"DATA",9002313.91,206,0)
551^9F^PREFERRED PRODUCT COUNT^A/N^1
"DATA",9002313.91,206,5)
9F^1
"DATA",9002313.91,206,10,0)
^9002313.9101^1^1^3031216^
"DATA",9002313.91,206,10,1,0)
S BPS("X")=""
"DATA",9002313.91,207,0)
552^AP^PREFERRED PRODUCT ID QUALIFIER^A/N^2
"DATA",9002313.91,207,5)
AP^2
"DATA",9002313.91,207,10,0)
^^1^1^3031216^
"DATA",9002313.91,207,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1)),U,1)
"DATA",9002313.91,207,20,0)
^^1^1^3031216^
"DATA",9002313.91,207,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,207,25,0)
^^1^1^3031216^
"DATA",9002313.91,207,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,207,30,0)
^^1^1^3031216^
"DATA",9002313.91,207,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1),U,1)=BPS("X")
"DATA",9002313.91,208,0)
553^AR^PREFERRED PRODUCT ID^A/N^19
"DATA",9002313.91,208,5)
AR^19
"DATA",9002313.91,208,10,0)
^^1^1^3031216^
"DATA",9002313.91,208,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1)),U,2)
"DATA",9002313.91,208,20,0)
^^1^1^3031216^
"DATA",9002313.91,208,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),19)
"DATA",9002313.91,208,25,0)
^^1^1^3031216^
"DATA",9002313.91,208,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),19)
"DATA",9002313.91,208,30,0)
^^1^1^3031216^
"DATA",9002313.91,208,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1),U,2)=BPS("X")
"DATA",9002313.91,209,0)
554^AS^PREFERRED PRODUCT INCENTIVE^A/N^8
"DATA",9002313.91,209,5)
AS^8
"DATA",9002313.91,209,10,0)
^9002313.9101^1^1^3031216^^
"DATA",9002313.91,209,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1)),U,3)
"DATA",9002313.91,209,20,0)
^9002313.9102^1^1^3031216^^
"DATA",9002313.91,209,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,209,25,0)
^^1^1^3031216^
"DATA",9002313.91,209,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,209,30,0)
^^1^1^3031216^
"DATA",9002313.91,209,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1),U,3)=BPS("X")
"DATA",9002313.91,210,0)
555^AT^PREF. PRODUCT COPAY INCENTIVE^A/N^8
"DATA",9002313.91,210,5)
AT^8
"DATA",9002313.91,210,10,0)
^9002313.9101^1^1^3031216^^
"DATA",9002313.91,210,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1)),U,4)
"DATA",9002313.91,210,20,0)
^9002313.9102^1^1^3031216^^
"DATA",9002313.91,210,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,210,25,0)
^9002313.9104^1^1^3031216^^
"DATA",9002313.91,210,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,210,30,0)
^9002313.9103^1^1^3031216^^
"DATA",9002313.91,210,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1),U,4)=BPS("X")
"DATA",9002313.91,211,0)
556^AU^PREFERRED PRODUCT DESCRIPTION^A/N^40
"DATA",9002313.91,211,5)
AU^40
"DATA",9002313.91,211,10,0)
^^1^1^3031216^
"DATA",9002313.91,211,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1)),U,5)
"DATA",9002313.91,211,20,0)
^^1^1^3031216^
"DATA",9002313.91,211,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),40)
"DATA",9002313.91,211,25,0)
^^1^1^3031216^
"DATA",9002313.91,211,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),40)
"DATA",9002313.91,211,30,0)
^^1^1^3031216^
"DATA",9002313.91,211,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),551.01,DUR,1),U,5)=BPS("X")
"DATA",9002313.91,212,0)
557^AV^TAX EXEMPT INDICATOR^A/N^1
"DATA",9002313.91,212,5)
AV^1
"DATA",9002313.91,212,10,0)
^^1^1^3031217^
"DATA",9002313.91,212,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550)),U,7)
"DATA",9002313.91,212,20,0)
^^1^1^3031217^
"DATA",9002313.91,212,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,212,25,0)
^^1^1^3031217^
"DATA",9002313.91,212,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,212,30,0)
^^1^1^3031217^
"DATA",9002313.91,212,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550),U,7)
"DATA",9002313.91,213,0)
558^AW^FLAT SALES TAX AMOUNT PAID^A/N^8
"DATA",9002313.91,213,5)
AW^8
"DATA",9002313.91,213,10,0)
^9002313.9101^1^1^3031210^^^
"DATA",9002313.91,213,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550)),U,8)
"DATA",9002313.91,213,20,0)
^9002313.9102^1^1^3031210^^
"DATA",9002313.91,213,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,213,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,213,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,213,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,213,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550),U,8)=BPS("X")
"DATA",9002313.91,214,0)
559^AX^PERCENTAGE SALES TAX AMT^A/N^8
"DATA",9002313.91,214,5)
AX^8
"DATA",9002313.91,214,10,0)
^9002313.9101^1^1^3031212^^^
"DATA",9002313.91,214,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550)),U,9)
"DATA",9002313.91,214,20,0)
^9002313.9102^1^1^3031212^^^
"DATA",9002313.91,214,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,214,25,0)
^9002313.9104^1^1^3031212^^
"DATA",9002313.91,214,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,214,30,0)
^9002313.9103^1^1^3031212^^^
"DATA",9002313.91,214,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550),U,9)=BPS("X")
"DATA",9002313.91,215,0)
560^AY^PERCENTAGE SALES TAX RATE^A/N^8
"DATA",9002313.91,215,5)
AY^8
"DATA",9002313.91,215,10,0)
^^1^1^3040223^
"DATA",9002313.91,215,10,1,0)
S BPS("X")=""
"DATA",9002313.91,216,0)
561^AZ^PERCENTAGE SALES TAX BASIS^A/N^8
"DATA",9002313.91,216,5)
AZ^8
"DATA",9002313.91,216,10,0)
^^1^1^3031212^
"DATA",9002313.91,216,10,1,0)
S BPS("X")=""
"DATA",9002313.91,217,0)
562^J1^PROFESSIONAL SERVICE FEE PAID^A/N^8
"DATA",9002313.91,217,5)
J1^8
"DATA",9002313.91,217,10,0)
^^1^1^3031217^
"DATA",9002313.91,217,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),560)),U,2)
"DATA",9002313.91,217,20,0)
^^1^1^3031217^
"DATA",9002313.91,217,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,217,25,0)
^^1^1^3031217^
"DATA",9002313.91,217,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,217,30,0)
^^1^1^3031217^
"DATA",9002313.91,217,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),560),U,2)=BPS("X")
"DATA",9002313.91,218,0)
563^J2^OTHER AMOUNT PAID COUNT^N^1
"DATA",9002313.91,218,5)
J2^1
"DATA",9002313.91,218,10,0)
^^1^1^3031212^
"DATA",9002313.91,218,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,0)),U,1)
"DATA",9002313.91,218,20,0)
^^1^1^3031212^
"DATA",9002313.91,218,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,218,25,0)
^^1^1^3031212^
"DATA",9002313.91,218,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,218,30,0)
^^1^1^3031212^
"DATA",9002313.91,218,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,0)),U,1)
"DATA",9002313.91,219,0)
564^J3^OTHER AMOUNT PAID QUALIFIER^A/N^2
"DATA",9002313.91,219,5)
J3^2
"DATA",9002313.91,219,10,0)
^^1^1^3031212^
"DATA",9002313.91,219,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,1)),U,1)
"DATA",9002313.91,219,20,0)
^^1^1^3031212^
"DATA",9002313.91,219,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,219,25,0)
^^1^1^3031212^
"DATA",9002313.91,219,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,219,30,0)
^^1^1^3031212^
"DATA",9002313.91,219,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,1),U,1)=BPS("X")
"DATA",9002313.91,220,0)
565^J4^OTHER AMOUNT PAID^A/N^8
"DATA",9002313.91,220,5)
J4^8
"DATA",9002313.91,220,10,0)
^9002313.9101^1^1^3031212^^
"DATA",9002313.91,220,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,1)),U,2)
"DATA",9002313.91,220,20,0)
^9002313.9102^1^1^3031212^^
"DATA",9002313.91,220,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,220,25,0)
^9002313.9104^1^1^3031212^^
"DATA",9002313.91,220,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,220,30,0)
^9002313.9103^1^1^3031212^^
"DATA",9002313.91,220,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),563.01,DUR,1),U,2)=BPS("X")
"DATA",9002313.91,221,0)
566^J5^OTHER PAYER AMOUNT RECOGNIZED^A/N^8
"DATA",9002313.91,221,5)
J5^8
"DATA",9002313.91,221,10,0)
^9002313.9101^1^1^3031212^^
"DATA",9002313.91,221,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),560)),U,6)
"DATA",9002313.91,221,20,0)
^9002313.9102^1^1^3031212^^
"DATA",9002313.91,221,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,221,25,0)
^9002313.9104^1^1^3031212^^
"DATA",9002313.91,221,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,221,30,0)
^9002313.9103^1^1^3031212^^
"DATA",9002313.91,221,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),560),U,6)=BPS("X")
"DATA",9002313.91,222,0)
567^J6^DUR/PPS RESPONSE CODE COUNTER^N^1
"DATA",9002313.91,222,5)
J6^1
"DATA",9002313.91,222,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,222,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0)),U,1)
"DATA",9002313.91,222,20,0)
^9002313.9102^1^1^3031210^^
"DATA",9002313.91,222,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,222,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,222,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,222,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,222,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),567.01,DUR,0),U,1)=BPS("X")
"DATA",9002313.91,223,0)
568^J7^PAYER ID QUALIFIER^A/N^2
"DATA",9002313.91,223,5)
J7^2
"DATA",9002313.91,223,10,0)
^^1^1^3031212^
"DATA",9002313.91,223,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),560)),U,8)
"DATA",9002313.91,223,20,0)
^^1^1^3031212^
"DATA",9002313.91,223,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,223,25,0)
^^1^1^3031212^
"DATA",9002313.91,223,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,223,30,0)
^^1^1^3031212^
"DATA",9002313.91,223,30,1,0)
S $P(^BPSR(BPS(9002313.02),560),U,8)
"DATA",9002313.91,224,0)
569^J8^PAYER ID^A/N^10
"DATA",9002313.91,224,5)
J8^10
"DATA",9002313.91,224,10,0)
^9002313.9101^1^1^3031212^^
"DATA",9002313.91,224,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),560)),U,9)
"DATA",9002313.91,224,20,0)
^9002313.9102^1^1^3031212^^
"DATA",9002313.91,224,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,224,25,0)
^9002313.9104^1^1^3031212^^
"DATA",9002313.91,224,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,224,30,0)
^9002313.9103^1^1^3031212^^
"DATA",9002313.91,224,30,1,0)
S $P(^BPSR(BPS(9002313.02),560),U,9)=BPS("X")
"DATA",9002313.91,225,0)
600^28^Unit of Measure^A/N^2
"DATA",9002313.91,225,5)
28^2
"DATA",9002313.91,225,10,0)
^9002313.9101^1^1^3040113^^^^
"DATA",9002313.91,225,10,1,0)
S BPS("X")=""
"DATA",9002313.91,225,20,0)
^9002313.9102^1^1^3040113^^^^
"DATA",9002313.91,225,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),17)
"DATA",9002313.91,225,25,0)
^9002313.9104^1^1^3040113^^^^
"DATA",9002313.91,225,25,1,0)
S BPS("X")=""
"DATA",9002313.91,225,30,0)
^9002313.9103^1^1^3040113^^^^
"DATA",9002313.91,225,30,1,0)
S BPS("X")=""
"DATA",9002313.91,226,0)
711^^ACTION CODE^A/N^1
"DATA",9002313.91,226,5)
^1
"DATA",9002313.91,226,10,0)
^^1^1^3031205^
"DATA",9002313.91,226,10,1,0)
S BPS("X")="U"
"DATA",9002313.91,226,20,0)
^9002313.9102^1^1^3031205^^^
"DATA",9002313.91,226,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,226,25,0)
^9002313.9104^1^1^3031205^^^
"DATA",9002313.91,226,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,227,0)
723^^ALTERNATE ID CODE^A/N^1
"DATA",9002313.91,227,5)
^1
"DATA",9002313.91,227,10,0)
^^1^1^3030512^
"DATA",9002313.91,227,10,1,0)
S BPS("X")=""
"DATA",9002313.91,227,20,0)
^9002313.9102^1^1^3031205^^^^
"DATA",9002313.91,227,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,227,25,0)
^9002313.9104^1^1^3031205^^^^
"DATA",9002313.91,227,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,228,0)
724^^ALTERNATE ID NUMBER^N^20
"DATA",9002313.91,228,5)
^20
"DATA",9002313.91,228,10,0)
^^1^1^3030512^
"DATA",9002313.91,228,10,1,0)
S BPS("X")=""
"DATA",9002313.91,228,20,0)
^9002313.9102^1^1^3031205^^
"DATA",9002313.91,228,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,228,25,0)
^9002313.9104^1^1^3031205^^
"DATA",9002313.91,228,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,229,0)
725^^ALTERNATE PERSON CODE^A/N^3
"DATA",9002313.91,229,5)
^3
"DATA",9002313.91,229,10,0)
^^1^1^3030512^
"DATA",9002313.91,229,10,1,0)
S BPS("X")=""
"DATA",9002313.91,229,20,0)
^9002313.9102^1^1^3031205^^
"DATA",9002313.91,229,20,1,0)
S BPS("X")=$$ANFFBSECFM($G(BPS("X")),3)
"DATA",9002313.91,229,25,0)
^9002313.9104^1^1^3031205^^
"DATA",9002313.91,229,25,1,0)
S BPS("X")=$$ANFFBSECFM($G(BPS("X")),3)
"DATA",9002313.91,230,0)
726^^ADDRESS LINE 1^A/N^30
"DATA",9002313.91,230,5)
^30
"DATA",9002313.91,230,10,0)
^^1^1^3030512^
"DATA",9002313.91,230,10,1,0)
S BPS("X")=VAPA(1)
"DATA",9002313.91,230,20,0)
^9002313.9102^1^1^3031210^^^^
"DATA",9002313.91,230,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,230,25,0)
^9002313.9104^1^1^3031210^^^^
"DATA",9002313.91,230,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,230,30,0)
^9002313.9103^1^1^3031210^^^^
"DATA",9002313.91,230,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),"^",2)=BPS("X")
"DATA",9002313.91,231,0)
727^^ADDRESS LINE 2^A/N^30
"DATA",9002313.91,231,5)
^30
"DATA",9002313.91,231,10,0)
^9002313.9101^1^1^3031210^^^
"DATA",9002313.91,231,10,1,0)
S BPS("X")=VAPA(2)
"DATA",9002313.91,231,20,0)
^9002313.9102^1^1^3031210^^^^
"DATA",9002313.91,231,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,231,25,0)
^9002313.9104^1^1^3031210^^^^
"DATA",9002313.91,231,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,232,0)
753^^ALTERNATE BENEFIT ID^A/N^15
"DATA",9002313.91,232,5)
^15
"DATA",9002313.91,232,10,0)
^^1^1^3030512^
"DATA",9002313.91,232,10,1,0)
S BPS("X")=""
"DATA",9002313.91,232,20,0)
^9002313.9102^1^1^3031205^^^^
"DATA",9002313.91,232,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,232,25,0)
^9002313.9104^1^1^3031205^^^
"DATA",9002313.91,232,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,233,0)
754^^ALT ENROLLMENT VERIF CODE^A/N^2
"DATA",9002313.91,233,5)
^2
"DATA",9002313.91,233,10,0)
^^1^1^3030512^
"DATA",9002313.91,233,10,1,0)
S BPS("X")=""
"DATA",9002313.91,233,20,0)
^9002313.9102^1^1^3031205^^^
"DATA",9002313.91,233,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,233,25,0)
^9002313.9104^1^1^3031205^^^
"DATA",9002313.91,233,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,234,0)
755^^ALT FINANCIAL VERIF CODE^A/N^2
"DATA",9002313.91,234,5)
^2
"DATA",9002313.91,234,10,0)
^^1^1^3030512^
"DATA",9002313.91,234,10,1,0)
S BPS("X")=""
"DATA",9002313.91,234,20,0)
^9002313.9102^1^1^3031205^^^
"DATA",9002313.91,234,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,234,25,0)
^9002313.9104^1^1^3031205^^^
"DATA",9002313.91,234,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,235,0)
756^^ALTERNATE GROUP NUMBER^A/N^15
"DATA",9002313.91,235,5)
^15
"DATA",9002313.91,235,10,0)
^^1^1^3030512^
"DATA",9002313.91,235,10,1,0)
S BPS("X")=""
"DATA",9002313.91,235,20,0)
^9002313.9102^1^1^3031205^^
"DATA",9002313.91,235,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,235,25,0)
^9002313.9104^1^1^3031205^^
"DATA",9002313.91,235,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,236,0)
804^5B^AMOUNT BILLED^D^8
"DATA",9002313.91,236,5)
5B^8
"DATA",9002313.91,236,10,0)
^^1^1^3030512^
"DATA",9002313.91,236,10,1,0)
S BPS("X")=""
"DATA",9002313.91,237,0)
805^1C^AMOUNT REJECTED^D^3
"DATA",9002313.91,237,5)
1C^3
"DATA",9002313.91,237,10,0)
^54.52^1^1^3030512^^^
"DATA",9002313.91,237,10,1,0)
S BPS("X")=""
"DATA",9002313.91,238,0)
872^3Z^AMOUNT ADJUSTED^D^8
"DATA",9002313.91,238,5)
3Z^8
"DATA",9002313.91,238,10,0)
^^1^1^3030512^
"DATA",9002313.91,238,10,1,0)
S BPS("X")=""
"DATA",9002313.91,238,20,0)
^^1^1^3031205^
"DATA",9002313.91,238,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),,8)
"DATA",9002313.91,238,25,0)
^^1^1^3031205^
"DATA",9002313.91,238,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,239,0)
876^FB^AMOUNT PAID^D^8
"DATA",9002313.91,239,5)
FB^8
"DATA",9002313.91,239,10,0)
^^1^1^3030512^
"DATA",9002313.91,239,10,1,0)
S BPS("X")=""
"DATA",9002313.91,239,20,0)
^^1^1^3031205^
"DATA",9002313.91,239,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,239,25,0)
^^1^1^3031205^
"DATA",9002313.91,239,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,239,30,0)
^^1^1^3031205^
"DATA",9002313.91,239,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,9)=BPS("X")
"DATA",9002313.91,240,0)
478^H7^OTHER AMT CLAIMED SUB COUNT^N^1
"DATA",9002313.91,240,5)
H7^1
"DATA",9002313.91,240,10,0)
^9002313.9101^1^1^3040107^^^
"DATA",9002313.91,240,10,1,0)
S BPS("X")=""
"DATA",9002313.91,241,0)
479^H8^Other Amt Claimed Sub Qual^A/N^2
"DATA",9002313.91,241,5)
H8^2
"DATA",9002313.91,241,10,0)
^9002313.9101^1^1^3040107^^
"DATA",9002313.91,241,10,1,0)
S BPS("X")=""
"DATA",9002313.91,242,0)
463^EW^INTERMED AUTH TYPE ID^N^2
"DATA",9002313.91,242,5)
EW^2
"DATA",9002313.91,242,10,0)
^9002313.9101^1^1^3030823^^^^
"DATA",9002313.91,242,10,1,0)
S BPS("X")=0
"DATA",9002313.91,242,20,0)
^9002313.9102^1^1^3030823^^^^
"DATA",9002313.91,242,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),11)
"DATA",9002313.91,242,25,0)
^9002313.9104^1^1^3030823^^^^
"DATA",9002313.91,242,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,242,30,0)
^9002313.9103^1^1^3030823^^
"DATA",9002313.91,242,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),460),U,3)=BPS("X")
"DATA",9002313.91,244,0)
801^5A^Adjustment/Reject Code-1^A/N^2
"DATA",9002313.91,244,5)
5A^2
"DATA",9002313.91,244,10,0)
^^1^1^3040223^
"DATA",9002313.91,244,10,1,0)
S BPS("X")=""
"DATA",9002313.91,245,0)
802^1A^Adjustment/Reject Code-2^A/N^2
"DATA",9002313.91,245,5)
1A^2
"DATA",9002313.91,245,10,0)
^^1^1^3040223^
"DATA",9002313.91,245,10,1,0)
S BPS("X")=""
"DATA",9002313.91,246,0)
803^1B^Adjustment/Reject Code-3^A/N^2
"DATA",9002313.91,246,5)
1B^2
"DATA",9002313.91,246,10,0)
^^1^1^3040223^
"DATA",9002313.91,246,10,1,0)
S BPS("X")=""
"DATA",9002313.91,247,0)
880^KC^Balance Forward^D^10
"DATA",9002313.91,247,5)
KC^10
"DATA",9002313.91,247,10,0)
^^1^1^3031205^
"DATA",9002313.91,247,10,1,0)
S BPS("X")=""
"DATA",9002313.91,248,0)
806^5C^Batch Number^N^7
"DATA",9002313.91,248,5)
5C^7
"DATA",9002313.91,248,10,0)
^^1^1^3031205^
"DATA",9002313.91,248,10,1,0)
S BPS("X")=""
"DATA",9002313.91,248,20,0)
^^1^1^3031205^
"DATA",9002313.91,248,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),7)
"DATA",9002313.91,248,25,0)
^^1^1^3031205^
"DATA",9002313.91,248,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),7)
"DATA",9002313.91,249,0)
761^^Benefit Effective Date^A/N^8
"DATA",9002313.91,249,5)
^8
"DATA",9002313.91,249,10,0)
^^1^1^3031205^
"DATA",9002313.91,249,10,1,0)
S BPS("X")=""
"DATA",9002313.91,250,0)
758^^Benefit Qualifier^A/N^2
"DATA",9002313.91,250,5)
^2
"DATA",9002313.91,250,10,0)
^^1^1^3031205^
"DATA",9002313.91,250,10,1,0)
S BPS("X")=""
"DATA",9002313.91,251,0)
762^^Card Production Indicator^A/N^1
"DATA",9002313.91,251,5)
^1
"DATA",9002313.91,251,10,0)
^9002313.9101^1^1^3031205^^
"DATA",9002313.91,251,10,1,0)
S BPS("X")=""
"DATA",9002313.91,251,20,0)
^9002313.9102^1^1^3031205^^
"DATA",9002313.91,251,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,251,25,0)
^^1^1^3031205^
"DATA",9002313.91,251,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,252,0)
741^^Cardholder Coverage Indicator^A/N^1
"DATA",9002313.91,252,5)
^1
"DATA",9002313.91,252,10,0)
^^1^1^3031205^
"DATA",9002313.91,252,10,1,0)
S BPS("X")=""
"DATA",9002313.91,252,20,0)
^^1^1^3031205^
"DATA",9002313.91,252,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,252,25,0)
^^1^1^3031205^
"DATA",9002313.91,252,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,253,0)
807^1D^Carrier Address^A/N^25
"DATA",9002313.91,253,5)
1D^25
"DATA",9002313.91,253,10,0)
^^1^1^3031210^
"DATA",9002313.91,253,10,1,0)
S BPS("X")=""
"DATA",9002313.91,254,0)
808^1E^Carrier Correct Notice Fld^A/N^30
"DATA",9002313.91,254,5)
1E^30
"DATA",9002313.91,254,10,0)
^^1^1^3031210^
"DATA",9002313.91,254,10,1,0)
S BPS("X")=""
"DATA",9002313.91,255,0)
809^1F^Carrier Location City^A/N^18
"DATA",9002313.91,255,5)
^18
"DATA",9002313.91,255,10,0)
^^1^1^3031210^
"DATA",9002313.91,255,10,1,0)
S BPS("X")=""
"DATA",9002313.91,256,0)
810^1G^Carrier Location State^A/N^2
"DATA",9002313.91,256,5)
^2
"DATA",9002313.91,256,10,0)
^9002313.9101^1^1^3031210^^^
"DATA",9002313.91,256,10,1,0)
S BPS("X")=""
"DATA",9002313.91,257,0)
763^^Case Manager^A/N^30
"DATA",9002313.91,257,5)
^30
"DATA",9002313.91,257,10,0)
^9002313.9101^1^1^3031209^^
"DATA",9002313.91,257,10,1,0)
S BPS("X")=""
"DATA",9002313.91,258,0)
728^^City^A/N^20
"DATA",9002313.91,258,5)
^20
"DATA",9002313.91,258,10,0)
^9002313.9101^1^1^3031210^^^
"DATA",9002313.91,258,10,1,0)
S BPS("X")=""
"DATA",9002313.91,259,0)
601^68^Claim Number^A/N^15
"DATA",9002313.91,259,5)
68^15
"DATA",9002313.91,259,10,0)
1^9002313.9101^1^1^3031209^
"DATA",9002313.91,259,10,1,0)
S BPS("X")=BPS("RX",1,"RX IEN")
"DATA",9002313.91,259,20,0)
^^1^1^3031209^
"DATA",9002313.91,259,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,259,25,0)
^^1^1^3031209^
"DATA",9002313.91,259,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,260,0)
811^1H^Carrier Name^A/N^25
"DATA",9002313.91,260,5)
1H^25
"DATA",9002313.91,260,10,0)
^9002313.9101^1^1^3031210^^^
"DATA",9002313.91,260,10,1,0)
S BPS("X")=""
"DATA",9002313.91,261,0)
812^1L^Carrier Telephone Number^N^10
"DATA",9002313.91,261,5)
1L^10
"DATA",9002313.91,261,10,0)
^9002313.9101^1^1^3050802^^^
"DATA",9002313.91,261,10,1,0)
S BPS("X")=""
"DATA",9002313.91,262,0)
813^1J^Carrier Zip Code^A/N^15
"DATA",9002313.91,262,5)
1J^15
"DATA",9002313.91,262,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,262,10,1,0)
S BPS("X")=""
"DATA",9002313.91,263,0)
815^1K^Comments-1^A/N^52
"DATA",9002313.91,263,5)
1K^52
"DATA",9002313.91,263,10,0)
^9002313.9101^1^1^3031210^^^^
"DATA",9002313.91,263,10,1,0)
S BPS("X")=""
"DATA",9002313.91,264,0)
816^1L^Comments-2^A/N^298
"DATA",9002313.91,264,5)
1L^298
"DATA",9002313.91,264,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,264,10,1,0)
S BPS("X")=""
"DATA",9002313.91,265,0)
451^EG^Compound Dispense Unt Form Ind^N^1
"DATA",9002313.91,265,5)
EG^1
"DATA",9002313.91,265,10,0)
^^1^1^3040224^
"DATA",9002313.91,265,10,1,0)
S BPS("X")=""
"DATA",9002313.91,265,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,265,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,265,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,265,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,266,0)
450^EF^Compound Dose Form Desc Code^A/N^2
"DATA",9002313.91,266,5)
EF^2
"DATA",9002313.91,266,10,0)
^9002313.9101^1^1^3040107^^^^
"DATA",9002313.91,266,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440)),U,10)
"DATA",9002313.91,266,20,0)
^9002313.9102^1^1^3040107^^^^
"DATA",9002313.91,266,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,266,25,0)
^9002313.9104^1^1^3040107^^^^
"DATA",9002313.91,266,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,266,30,0)
^9002313.9103^1^1^3040107^^^^
"DATA",9002313.91,266,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440),U,10)=BPS("X")
"DATA",9002313.91,267,0)
490^UE^Comp Ingred Basis Cost Determ^A/N^2
"DATA",9002313.91,267,5)
UE^2
"DATA",9002313.91,267,10,0)
^^1^1^3040224^
"DATA",9002313.91,267,10,1,0)
S BPS("X")=""
"DATA",9002313.91,267,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,267,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,267,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,267,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,268,0)
447^EC^Compound Ingred Comp Count^N^2
"DATA",9002313.91,268,5)
EC^2
"DATA",9002313.91,268,10,0)
^9002313.9101^1^1^3040107^^^^
"DATA",9002313.91,268,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440)),U,7)
"DATA",9002313.91,268,20,0)
^9002313.9102^1^1^3040107^^^^
"DATA",9002313.91,268,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,268,25,0)
^9002313.9104^1^1^3040107^^^^
"DATA",9002313.91,268,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,268,30,0)
^9002313.9103^1^1^3040107^^^^
"DATA",9002313.91,268,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440),U,7)=BPS("X")
"DATA",9002313.91,269,0)
449^EE^Compound Ingredient Drug Cost^N^8
"DATA",9002313.91,269,5)
EE^8
"DATA",9002313.91,269,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,269,10,1,0)
S BPS("X")=""
"DATA",9002313.91,269,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,269,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,269,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,269,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,270,0)
814^50^Claim Count^N^8
"DATA",9002313.91,270,5)
50^8
"DATA",9002313.91,270,10,0)
^9002313.9101^1^1^3031210^^^^
"DATA",9002313.91,270,10,1,0)
S BPS("X")=""
"DATA",9002313.91,271,0)
489^TE^Compound Product ID^A/N^19
"DATA",9002313.91,271,5)
TE^19
"DATA",9002313.91,271,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,271,10,1,0)
S BPS("X")=""
"DATA",9002313.91,271,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,271,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),19)
"DATA",9002313.91,271,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,271,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),19)
"DATA",9002313.91,272,0)
488^RE^Compound Product ID Qualifier^A/N^2
"DATA",9002313.91,272,5)
RE^2
"DATA",9002313.91,272,10,0)
^^1^1^3040224^
"DATA",9002313.91,272,10,1,0)
S BPS("X")=""
"DATA",9002313.91,272,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,272,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,272,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,272,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,273,0)
452^EH^Compound Route of Admin^N^2
"DATA",9002313.91,273,5)
EH^2
"DATA",9002313.91,273,10,0)
^^1^1^3040224^
"DATA",9002313.91,273,10,1,0)
S BPS("X")=""
"DATA",9002313.91,273,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,273,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,273,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,273,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,274,0)
817^5E^Co-Pay Amount^D^6
"DATA",9002313.91,274,5)
5E^6
"DATA",9002313.91,274,10,0)
^9002313.9101^1^1^3031210^^^^
"DATA",9002313.91,274,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500)),U,18)
"DATA",9002313.91,274,20,0)
^9002313.9102^1^1^3031210^^
"DATA",9002313.91,274,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,274,25,0)
^9002313.9104^1^1^3031210^^
"DATA",9002313.91,274,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),6)
"DATA",9002313.91,274,30,0)
^9002313.9103^1^1^3031210^^
"DATA",9002313.91,274,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),500),U,18)=BPS("X")
"DATA",9002313.91,275,0)
764^^Copay Calculation Code^A/N^2
"DATA",9002313.91,275,5)
^2
"DATA",9002313.91,275,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,275,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340)),U,7)
"DATA",9002313.91,275,20,0)
^^1^1^3031210^
"DATA",9002313.91,275,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,275,25,0)
^^1^1^3031210^
"DATA",9002313.91,275,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,275,30,0)
^^1^1^3031210^
"DATA",9002313.91,275,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),340),U,7)=BPS("X")
"DATA",9002313.91,276,0)
765^^Copay Dollar Amount^N^8
"DATA",9002313.91,276,5)
^8
"DATA",9002313.91,276,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,276,10,1,0)
S BPS("X")=""
"DATA",9002313.91,277,0)
766^^Copay Effective Date^N^8
"DATA",9002313.91,277,5)
^8
"DATA",9002313.91,277,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,277,10,1,0)
S BPS("X")=""
"DATA",9002313.91,278,0)
767^^Copay Percentage Amount^N^4
"DATA",9002313.91,278,5)
^4
"DATA",9002313.91,278,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,278,10,1,0)
S BPS("X")=""
"DATA",9002313.91,279,0)
768^^Copay Qualifier^A/N^2
"DATA",9002313.91,279,5)
^2
"DATA",9002313.91,279,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,279,10,1,0)
S BPS("X")=""
"DATA",9002313.91,280,0)
769^^Copay Termination Date^N^8
"DATA",9002313.91,280,5)
^8
"DATA",9002313.91,280,10,0)
^^1^1^3031209^
"DATA",9002313.91,280,10,1,0)
S BPS("X")=""
"DATA",9002313.91,281,0)
731^^Country Code^A/N^4
"DATA",9002313.91,281,5)
^4
"DATA",9002313.91,281,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,281,10,1,0)
S BPS("X")=""
"DATA",9002313.91,282,0)
770^^Covered Through Qualifier^A/N^2
"DATA",9002313.91,282,5)
^2
"DATA",9002313.91,282,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,282,10,1,0)
S BPS("X")=""
"DATA",9002313.91,283,0)
703^^Data Category^A/N^1
"DATA",9002313.91,283,5)
^1
"DATA",9002313.91,283,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,283,10,1,0)
S BPS("X")=""
"DATA",9002313.91,284,0)
877^A1^Daytime Telephone Number^N^10
"DATA",9002313.91,284,5)
A1^10
"DATA",9002313.91,284,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,284,10,1,0)
S BPS("X")=$TR($G(VAPA(8)),"#() -_*.@")
"DATA",9002313.91,284,20,0)
^9002313.9102^1^1^3031210^^^^
"DATA",9002313.91,284,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,284,25,0)
^9002313.9104^1^1^3031210^^^^
"DATA",9002313.91,284,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,284,30,0)
^^1^1^3031210^
"DATA",9002313.91,284,30,1,0)
S $P(^BPSC(BPS(9002313.02),321),U,6)=BPS("X")
"DATA",9002313.91,285,0)
749^^Dependent Adult Coverage Ind^A/N^1
"DATA",9002313.91,285,5)
^1
"DATA",9002313.91,285,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,285,10,1,0)
S BPS("X")=""
"DATA",9002313.91,286,0)
750^^Dependent Adult Cover Thru Age^N^3
"DATA",9002313.91,286,5)
^3
"DATA",9002313.91,286,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,286,10,1,0)
S BPS("X")=""
"DATA",9002313.91,287,0)
743^^Dependent Coverage Indicator^A/N^1
"DATA",9002313.91,287,5)
^1
"DATA",9002313.91,287,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,287,10,1,0)
S BPS("X")=""
"DATA",9002313.91,288,0)
744^^Dependent Covered Through Age^N^3
"DATA",9002313.91,288,5)
^3
"DATA",9002313.91,288,10,0)
^^1^1^3031209^
"DATA",9002313.91,288,10,1,0)
S BPS("X")=""
"DATA",9002313.91,289,0)
885^^Dependent Covered Through Date^N^8
"DATA",9002313.91,289,5)
^8
"DATA",9002313.91,289,10,0)
^^1^1^3031209^
"DATA",9002313.91,289,10,1,0)
S BPS("X")=""
"DATA",9002313.91,290,0)
818^5F^Destination Name^A/N^15
"DATA",9002313.91,290,5)
5F^15
"DATA",9002313.91,290,10,0)
^9002313.9101^1^1^3031210^^^
"DATA",9002313.91,290,10,1,0)
S BPS("X")=""
"DATA",9002313.91,291,0)
819^5G^Destination Number^N^10
"DATA",9002313.91,291,5)
5G^10
"DATA",9002313.91,291,10,0)
^9002313.9101^1^1^3031209^^
"DATA",9002313.91,291,10,1,0)
S BPS("X")=""
"DATA",9002313.91,292,0)
747^^Disabled Dependent Cover Ind^A/N^1
"DATA",9002313.91,292,5)
^1
"DATA",9002313.91,292,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,292,10,1,0)
S BPS("X")=""
"DATA",9002313.91,293,0)
748^^Disabled Depend Cover Thru Age^N^3
"DATA",9002313.91,293,5)
^3
"DATA",9002313.91,293,10,0)
^^1^1^3031209^
"DATA",9002313.91,293,10,1,0)
S BPS("X")=""
"DATA",9002313.91,294,0)
820^9A^Diskette Record ID^N^1
"DATA",9002313.91,294,5)
^1
"DATA",9002313.91,294,10,0)
^^1^1^3031209^
"DATA",9002313.91,294,10,1,0)
S BPS("X")=""
"DATA",9002313.91,295,0)
821^1M^Dollars Adjusted^D^10
"DATA",9002313.91,295,5)
1M^10
"DATA",9002313.91,295,10,0)
^^1^1^3031209^
"DATA",9002313.91,295,10,1,0)
S BPS("X")=""
"DATA",9002313.91,296,0)
822^5H^Dollars Billed^D^10
"DATA",9002313.91,296,5)
^10
"DATA",9002313.91,296,10,0)
^^1^1^3031209^
"DATA",9002313.91,296,10,1,0)
S BPS("X")=""
"DATA",9002313.91,297,0)
873^4A^Dollars Paid^D^10
"DATA",9002313.91,297,5)
4A^10
"DATA",9002313.91,297,10,0)
^^1^1^3031209^
"DATA",9002313.91,297,10,1,0)
S BPS("X")=""
"DATA",9002313.91,298,0)
771^^DUR Type Indicator^A/N^1
"DATA",9002313.91,298,5)
^1
"DATA",9002313.91,298,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,298,10,1,0)
S BPS("X")=""
"DATA",9002313.91,299,0)
772^^Early Refill Percentage^N^4
"DATA",9002313.91,299,5)
^4
"DATA",9002313.91,299,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,299,10,1,0)
S BPS("X")=""
"DATA",9002313.91,300,0)
712^^Effective Date^N^8
"DATA",9002313.91,300,5)
^8
"DATA",9002313.91,300,10,0)
^9002313.9101^1^1^3031209^^
"DATA",9002313.91,300,10,1,0)
S BPS("X")=""
"DATA",9002313.91,301,0)
733^^Eligibility Type^A/N^2
"DATA",9002313.91,301,5)
^2
"DATA",9002313.91,301,10,0)
^^1^1^3031209^
"DATA",9002313.91,301,10,1,0)
S BPS("X")=""
"DATA",9002313.91,302,0)
715^^Enrollment Relationship Code^A/N^1
"DATA",9002313.91,302,5)
^1
"DATA",9002313.91,302,10,0)
^9002313.9101^1^1^3031210^^^^
"DATA",9002313.91,302,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),300)),U,6)
"DATA",9002313.91,302,20,0)
^^1^1^3031210^
"DATA",9002313.91,302,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,302,25,0)
^^1^1^3031210^
"DATA",9002313.91,302,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,302,30,0)
^^1^1^3031210^
"DATA",9002313.91,302,30,1,0)
S $P(^BPSC(BPS(9002313.02),300),U,6)=BPS("X")
"DATA",9002313.91,303,0)
774^^Enrollment Tax Exempt Ind^A/N^1
"DATA",9002313.91,303,5)
^1
"DATA",9002313.91,303,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,303,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550)),U,7)
"DATA",9002313.91,303,20,0)
^^1^1^3031210^
"DATA",9002313.91,303,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,303,25,0)
^^1^1^3031210^
"DATA",9002313.91,303,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,303,30,0)
^^1^1^3031210^
"DATA",9002313.91,303,30,1,0)
S $P(^BPSR(BPS(9002313.02),1000,BPS(9002313.0201),550),U,7)=BPS("X")
"DATA",9002313.91,304,0)
775^^Enrollment Vers/Rel Number^N^2
"DATA",9002313.91,304,5)
^2
"DATA",9002313.91,304,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,304,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),100)),U,2)
"DATA",9002313.91,304,20,0)
^^1^1^3031210^
"DATA",9002313.91,304,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,304,25,0)
^^1^1^3031210^
"DATA",9002313.91,304,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,304,30,0)
^^1^1^3031210^
"DATA",9002313.91,304,30,1,0)
S $P(^BPSR(BPS(9002313.02),100),U,2)=BPS("X")
"DATA",9002313.91,305,0)
776^^Entity Address Line 1^A/N^30
"DATA",9002313.91,305,5)
^30
"DATA",9002313.91,305,10,0)
^9002313.9101^1^1^3031210^^
"DATA",9002313.91,305,10,1,0)
S BPS("X")=""
"DATA",9002313.91,306,0)
777^^Entity Address Line 2^A/N^30
"DATA",9002313.91,306,5)
^30
"DATA",9002313.91,306,10,0)
^^1^1^3031209^
"DATA",9002313.91,306,10,1,0)
S BPS("X")=""
"DATA",9002313.91,307,0)
778^^Entity City^A/N^20
"DATA",9002313.91,307,5)
^20
"DATA",9002313.91,307,10,0)
^^1^1^3031209^
"DATA",9002313.91,307,10,1,0)
S BPS("X")=""
"DATA",9002313.91,308,0)
448^ED^Compound Ingredient Quantity^N^10
"DATA",9002313.91,308,5)
ED^10
"DATA",9002313.91,308,10,0)
^^1^1^3040224^
"DATA",9002313.91,308,10,1,0)
S BPS("X")=""
"DATA",9002313.91,308,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,308,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,308,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,308,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,309,0)
773^^Eligibility Type^A/N^2
"DATA",9002313.91,309,5)
^2
"DATA",9002313.91,309,10,0)
^^1^1^3031210^
"DATA",9002313.91,309,10,1,0)
S BPS("X")=""
"DATA",9002313.91,310,0)
702^^File Type^A/N^1
"DATA",9002313.91,310,5)
^1
"DATA",9002313.91,310,10,0)
^^1^1^3031210^
"DATA",9002313.91,310,10,1,0)
S BPS("X")=""
"DATA",9002313.91,311,0)
717^^Member First Name^A/N^15
"DATA",9002313.91,311,5)
^15
"DATA",9002313.91,311,10,0)
^^1^1^3031210^
"DATA",9002313.91,311,10,1,0)
S BPS("X")=""
"DATA",9002313.91,312,0)
721^^Member Gender Code^A/N^1
"DATA",9002313.91,312,5)
^1
"DATA",9002313.91,312,10,0)
^^1^1^3031210^
"DATA",9002313.91,312,10,1,0)
S BPS("X")=""
"DATA",9002313.91,313,0)
786^^Group Name^A/N^30
"DATA",9002313.91,313,5)
^30
"DATA",9002313.91,313,10,0)
^^1^1^3031210^
"DATA",9002313.91,313,10,1,0)
S BPS("X")=BPS("Insurer","Group #")
"DATA",9002313.91,313,20,0)
^^1^1^3031210^
"DATA",9002313.91,313,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,313,25,0)
^^1^1^3031210^
"DATA",9002313.91,313,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),30)
"DATA",9002313.91,313,30,0)
^^1^1^3031210^
"DATA",9002313.91,313,30,1,0)
S $P(^BPSR(BPS(9002313.02),300),U,1)=BPS("X")
"DATA",9002313.91,314,0)
787^^Group Sequence Number^N^5
"DATA",9002313.91,314,5)
^5
"DATA",9002313.91,314,10,0)
^^1^1^3031210^
"DATA",9002313.91,314,10,1,0)
S BPS("X")=""
"DATA",9002313.91,315,0)
788^^Hierarchy Level Name^A/N^18
"DATA",9002313.91,315,5)
^18
"DATA",9002313.91,315,10,0)
^^1^1^3031210^
"DATA",9002313.91,315,10,1,0)
S BPS("X")=""
"DATA",9002313.91,316,0)
789^^Hierarchy Level Number^N^2
"DATA",9002313.91,316,5)
^2
"DATA",9002313.91,316,10,0)
^^1^1^3031210^
"DATA",9002313.91,316,10,1,0)
S BPS("X")="00"
"DATA",9002313.91,317,0)
826^^Host Plan^A/N^3
"DATA",9002313.91,317,5)
^3
"DATA",9002313.91,317,10,0)
^^1^1^3031210^
"DATA",9002313.91,317,10,1,0)
S BPS("X")=""
"DATA",9002313.91,318,0)
790^^ID Card Reason Code^A/N^1
"DATA",9002313.91,318,5)
^1
"DATA",9002313.91,318,10,0)
^^1^1^3031210^
"DATA",9002313.91,318,10,1,0)
S BPS("X")=""
"DATA",9002313.91,319,0)
791^^Industry Classification Code^A/N^6
"DATA",9002313.91,319,5)
^6
"DATA",9002313.91,319,10,0)
^^1^1^3031210^
"DATA",9002313.91,319,10,1,0)
S BPS("X")=""
"DATA",9002313.91,320,0)
827^10^Ingredient Cost Billed^D^8
"DATA",9002313.91,320,5)
^8
"DATA",9002313.91,320,10,0)
^9002313.9101^1^1^3031211^^^
"DATA",9002313.91,320,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400)),U,9)
"DATA",9002313.91,320,20,0)
^9002313.9102^1^1^3031211^^^
"DATA",9002313.91,320,20,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,320,25,0)
^9002313.9104^1^1^3031211^^^
"DATA",9002313.91,320,25,1,0)
S BPS("X")=$$DFF^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,320,30,0)
^9002313.9103^1^1^3031211^^^
"DATA",9002313.91,320,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,9)=BPS("X")
"DATA",9002313.91,321,0)
716^^Member Last Name^A/N^25
"DATA",9002313.91,321,5)
^25
"DATA",9002313.91,321,10,0)
^9002313.9101^2^2^3050802^^
"DATA",9002313.91,321,10,1,0)
S BPS("X")=$G(VADM(1))
"DATA",9002313.91,321,10,2,0)
N X S X=BPS("X") D NAMECOMP^XLFNAME(.X) S BPS("X")=$G(X("FAMILY")) K X
"DATA",9002313.91,321,20,0)
^^1^1^3031211^
"DATA",9002313.91,321,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),25)
"DATA",9002313.91,321,25,0)
^^1^1^3031211^
"DATA",9002313.91,321,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),25)
"DATA",9002313.91,321,30,0)
^^2^2^3031211^
"DATA",9002313.91,321,30,1,0)
N AA S AA=$P($G(^BPSC(BPS(9002313.02),1)),U,1),$P(AA,",",1)=BPS("X")
"DATA",9002313.91,321,30,2,0)
S $P(^BPSC(BPS(9002313.02),1),U,1)=AA
"DATA",9002313.91,322,0)
828^^Master Sequence Number^A/N^2
"DATA",9002313.91,322,5)
^2
"DATA",9002313.91,322,10,0)
^^1^1^3031211^
"DATA",9002313.91,322,10,1,0)
S BPS("X")=""
"DATA",9002313.91,323,0)
792^^Maximum Copay Amount^D^8
"DATA",9002313.91,323,5)
^8
"DATA",9002313.91,323,10,0)
^^1^1^3031211^
"DATA",9002313.91,323,10,1,0)
S BPS("X")="0.00"
"DATA",9002313.91,324,0)
494^ZE^Measurement Date^A/N^8
"DATA",9002313.91,324,5)
ZE^8
"DATA",9002313.91,324,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,324,10,1,0)
S BPS("X")=""
"DATA",9002313.91,324,20,0)
^^1^1^3040224^
"DATA",9002313.91,324,20,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")))
"DATA",9002313.91,324,25,0)
^^1^1^3040224^
"DATA",9002313.91,324,25,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")))
"DATA",9002313.91,325,0)
496^H2^Measurement Dimension^A/N^2
"DATA",9002313.91,325,5)
H2^2
"DATA",9002313.91,325,10,0)
^^1^1^3040224^
"DATA",9002313.91,325,10,1,0)
S BPS("X")=""
"DATA",9002313.91,325,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,325,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,325,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,325,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,326,0)
495^H1^Measurement Time^N^4
"DATA",9002313.91,326,5)
H1^4
"DATA",9002313.91,326,10,0)
^^1^1^3040224^
"DATA",9002313.91,326,10,1,0)
S BPS("X")=""
"DATA",9002313.91,326,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,326,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),4)
"DATA",9002313.91,326,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,326,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),4)
"DATA",9002313.91,327,0)
497^H3^Measurement Unit^A/N^2
"DATA",9002313.91,327,5)
H3^2
"DATA",9002313.91,327,10,0)
^9002313.9101^1^1^3040224^^
"DATA",9002313.91,327,10,1,0)
S BPS("X")=""
"DATA",9002313.91,327,20,0)
^9002313.9102^1^1^3040224^^^^
"DATA",9002313.91,327,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,327,25,0)
^9002313.9104^1^1^3040224^^^^
"DATA",9002313.91,327,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,328,0)
499^H4^Measurement Value^A/N^15
"DATA",9002313.91,328,5)
H4^15
"DATA",9002313.91,328,10,0)
^^1^1^3040224^
"DATA",9002313.91,328,10,1,0)
S BPS("X")=""
"DATA",9002313.91,328,20,0)
^9002313.9102^1^1^3040224^^^
"DATA",9002313.91,328,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,328,25,0)
^9002313.9104^1^1^3040224^^^
"DATA",9002313.91,328,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,329,0)
710^^Member Sequence Number^N^2
"DATA",9002313.91,329,5)
^2
"DATA",9002313.91,329,10,0)
^^1^1^3031211^
"DATA",9002313.91,329,10,1,0)
S BPS("X")=""
"DATA",9002313.91,330,0)
718^^Middle Initial^A/N^1
"DATA",9002313.91,330,5)
^1
"DATA",9002313.91,330,10,0)
^^1^1^3031211^
"DATA",9002313.91,330,10,1,0)
S BPS("X")=""
"DATA",9002313.91,331,0)
793^^Minimum Copay Amount^D^8
"DATA",9002313.91,331,5)
^8
"DATA",9002313.91,331,10,0)
^^1^1^3031211^
"DATA",9002313.91,331,10,1,0)
S BPS("X")=""
"DATA",9002313.91,332,0)
720^^Multiple Birth Code^N^1
"DATA",9002313.91,332,5)
^1
"DATA",9002313.91,332,10,0)
^^1^1^3031211^
"DATA",9002313.91,332,10,1,0)
S BPS("X")=""
"DATA",9002313.91,333,0)
794^^Number of ID Cards^N^1
"DATA",9002313.91,333,5)
^1
"DATA",9002313.91,333,10,0)
^^1^1^3031212^
"DATA",9002313.91,333,10,1,0)
S BPS("X")=""
"DATA",9002313.91,334,0)
714^^Original Effective Date^N^8
"DATA",9002313.91,334,5)
^8
"DATA",9002313.91,334,10,0)
^^1^1^3031212^
"DATA",9002313.91,334,10,1,0)
S BPS("X")=""
"DATA",9002313.91,335,0)
706^^Originator Name^A/N^30
"DATA",9002313.91,335,5)
^30
"DATA",9002313.91,335,10,0)
^^1^1^3031212^
"DATA",9002313.91,335,10,1,0)
S BPS("X")=""
"DATA",9002313.91,336,0)
735^^Other Coverage Effective Date^N^8
"DATA",9002313.91,336,5)
^8
"DATA",9002313.91,336,10,0)
^^1^1^3031212^
"DATA",9002313.91,336,10,1,0)
S BPS("X")=""
"DATA",9002313.91,337,0)
875^6E^P.A./M.C./S.C. Number^A/N^7
"DATA",9002313.91,337,5)
6E^7
"DATA",9002313.91,337,10,0)
^9002313.9101^1^1^3031212^^
"DATA",9002313.91,337,10,1,0)
S BPS("X")=$P($G(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400)),U,16)
"DATA",9002313.91,337,20,0)
^9002313.9102^1^1^3031212^^
"DATA",9002313.91,337,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),7)
"DATA",9002313.91,337,25,0)
^^1^1^3031212^
"DATA",9002313.91,337,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),7)
"DATA",9002313.91,337,30,0)
^9002313.9103^1^1^3031212^^
"DATA",9002313.91,337,30,1,0)
S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),400),U,16)=S BPS("X")
"DATA",9002313.91,338,0)
829^5L^Pharmacy Address^A/N^20
"DATA",9002313.91,338,5)
5L^20
"DATA",9002313.91,338,10,0)
^9002313.9101^1^1^3031216^^^^
"DATA",9002313.91,338,10,1,0)
S BPS(X")=$$GET^DDSVAL(59,BPS("Site","IEN"),.02)
"DATA",9002313.91,338,20,0)
^9002313.9102^1^1^3031216^^
"DATA",9002313.91,338,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,338,25,0)
^9002313.9104^1^1^3031216^^
"DATA",9002313.91,338,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,339,0)
830^5M^Pharmacy Count^N^4
"DATA",9002313.91,339,5)
5M^4
"DATA",9002313.91,339,10,0)
^9002313.9101^1^1^3031216^^^
"DATA",9002313.91,339,10,1,0)
S BPS("X")=""
"DATA",9002313.91,340,0)
831^5N^Pharmacy Location City^A/N^18
"DATA",9002313.91,340,5)
5N^18
"DATA",9002313.91,340,10,0)
^9002313.9101^1^1^3031216^^^
"DATA",9002313.91,340,10,1,0)
S BPS(X")=$$GET^DDSVAL(59,BPS("Site","IEN"),.07)
"DATA",9002313.91,340,20,0)
^9002313.9102^1^1^3031216^^^
"DATA",9002313.91,340,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),18)
"DATA",9002313.91,340,25,0)
^9002313.9104^1^1^3031216^^^
"DATA",9002313.91,340,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),18)
"DATA",9002313.91,341,0)
832^6F^Pharmacy Location State^A/N^2
"DATA",9002313.91,341,5)
6F^2
"DATA",9002313.91,341,10,0)
^^1^1^3031216^
"DATA",9002313.91,341,10,1,0)
S BPS(X")=$$GET^DDSVAL(59,BPS("Site","IEN"),.08)
"DATA",9002313.91,341,20,0)
^^1^1^3031216^
"DATA",9002313.91,341,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,341,25,0)
^^1^1^3031216^
"DATA",9002313.91,341,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,342,0)
835^5R^Pharmacy Zip Code^N^9
"DATA",9002313.91,342,5)
5R^9
"DATA",9002313.91,342,10,0)
^^1^1^3031216^
"DATA",9002313.91,342,10,1,0)
S BPS(X")=$$GET^DDSVAL(59,BPS("Site","IEN"),.05)
"DATA",9002313.91,342,20,0)
^^1^1^3031216^
"DATA",9002313.91,342,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),9)
"DATA",9002313.91,342,25,0)
^^1^1^3031216^
"DATA",9002313.91,342,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),9)
"DATA",9002313.91,343,0)
833^5P^Pharmacy Name^A/N^20
"DATA",9002313.91,343,5)
5P^20
"DATA",9002313.91,343,10,0)
^^1^1^3031216^
"DATA",9002313.91,343,10,1,0)
S BPS(X")=$$GET^DDSVAL(59,BPS("Site","IEN"),.01)
"DATA",9002313.91,343,20,0)
^^1^1^3031216^
"DATA",9002313.91,343,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,343,25,0)
^^1^1^3031216^
"DATA",9002313.91,343,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),20)
"DATA",9002313.91,344,0)
834^5Q^Pharmacy Telephone Number^N^10
"DATA",9002313.91,344,5)
5Q^10
"DATA",9002313.91,344,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,344,10,1,0)
S BPS(X")=$TR($G($$GET^DDSVAL(59,BPS("Site","IEN"),.04)),"#() -_*.@")
"DATA",9002313.91,344,20,0)
^9002313.9102^1^1^3031216^^
"DATA",9002313.91,344,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,344,25,0)
^9002313.9104^1^1^3031216^^
"DATA",9002313.91,344,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,345,0)
734^^Plan ID Effective Date^N^8
"DATA",9002313.91,345,5)
^8
"DATA",9002313.91,345,10,0)
^^1^1^3031216^
"DATA",9002313.91,345,10,1,0)
S BPS("X")=""
"DATA",9002313.91,345,20,0)
^^1^1^3031216^
"DATA",9002313.91,345,20,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,345,25,0)
^^1^1^3031216^
"DATA",9002313.91,345,25,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")),8)
"DATA",9002313.91,346,0)
737^^Primary Care Provider Eff Date^N^8
"DATA",9002313.91,346,5)
^8
"DATA",9002313.91,346,10,0)
^^1^1^3031216^
"DATA",9002313.91,346,10,1,0)
S BPS("X")=""
"DATA",9002313.91,347,0)
795^^Primary Care Prov Term Date^N^8
"DATA",9002313.91,347,5)
^8
"DATA",9002313.91,347,10,0)
^9002313.9101^1^1^3031216^^
"DATA",9002313.91,347,10,1,0)
S BPS("X")=""
"DATA",9002313.91,348,0)
739^^Primary Pharmacy Eff Date^N^8
"DATA",9002313.91,348,5)
^8
"DATA",9002313.91,348,10,0)
^^1^1^3031216^
"DATA",9002313.91,348,10,1,0)
S BPS("X")=""
"DATA",9002313.91,349,0)
738^^Primary Pharmacy ID^N^12
"DATA",9002313.91,349,5)
^12
"DATA",9002313.91,349,10,0)
^^1^1^3031216^
"DATA",9002313.91,349,10,1,0)
S BPS("X")=BPS("Site","Pharmacy #")
"DATA",9002313.91,349,20,0)
^^1^1^3031216^
"DATA",9002313.91,349,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),12)
"DATA",9002313.91,349,25,0)
^^1^1^3031216^
"DATA",9002313.91,349,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),12)
"DATA",9002313.91,350,0)
797^^Prior Approval Amount^D^8
"DATA",9002313.91,350,5)
^8
"DATA",9002313.91,350,10,0)
^^1^1^3031216^
"DATA",9002313.91,350,10,1,0)
S BPS("X")=""
"DATA",9002313.91,351,0)
708^^Process Begin Date^N^8
"DATA",9002313.91,351,5)
^8
"DATA",9002313.91,351,10,0)
^9002313.9101^1^1^3031216^^
"DATA",9002313.91,351,10,1,0)
S BPS("X")=""
"DATA",9002313.91,352,0)
704^^Process Date^N^8
"DATA",9002313.91,352,5)
^8
"DATA",9002313.91,352,10,0)
^^1^1^3031216^
"DATA",9002313.91,352,10,1,0)
S BPS("X")=""
"DATA",9002313.91,353,0)
709^^Process End Date^N^8
"DATA",9002313.91,353,5)
^8
"DATA",9002313.91,353,10,0)
^^1^1^3031216^
"DATA",9002313.91,353,10,1,0)
S BPS("X")=""
"DATA",9002313.91,354,0)
705^^Process Time^N^6
"DATA",9002313.91,354,5)
^6
"DATA",9002313.91,354,10,0)
^^1^1^3031216^
"DATA",9002313.91,354,10,1,0)
S BPS("X")=""
"DATA",9002313.91,355,0)
752^^Processor Defined Data^A/N^176
"DATA",9002313.91,355,5)
^176
"DATA",9002313.91,355,10,0)
^^1^1^3031216^
"DATA",9002313.91,355,10,1,0)
S BPS("X")=""
"DATA",9002313.91,356,0)
707^^Processor Indicator^A/N^1
"DATA",9002313.91,356,5)
^1
"DATA",9002313.91,356,10,0)
^^1^1^3031216^
"DATA",9002313.91,356,10,1,0)
S BPS("X")=""
"DATA",9002313.91,357,0)
837^5T^Processor Location City^A/N^18
"DATA",9002313.91,357,5)
5T^18
"DATA",9002313.91,357,10,0)
^^1^1^3031216^
"DATA",9002313.91,357,10,1,0)
S BPS("X")=""
"DATA",9002313.91,358,0)
838^5U^Processor Location State^A/N^2
"DATA",9002313.91,358,5)
5U^2
"DATA",9002313.91,358,10,0)
^9002313.9101^1^1^3031216^^
"DATA",9002313.91,358,10,1,0)
S BPS("X")=""
"DATA",9002313.91,359,0)
839^5V^Processor Name^A/N^20
"DATA",9002313.91,359,5)
5V^20
"DATA",9002313.91,359,10,0)
^^1^1^3031217^
"DATA",9002313.91,359,10,1,0)
S BPS("X")=""
"DATA",9002313.91,360,0)
840^5W^Processor Number^A/N^10
"DATA",9002313.91,360,5)
5W^10
"DATA",9002313.91,360,10,0)
^^1^1^3031217^
"DATA",9002313.91,360,10,1,0)
S BPS("X")=""
"DATA",9002313.91,361,0)
841^5X^Processor Telephone Number^N^10
"DATA",9002313.91,361,5)
5X^10
"DATA",9002313.91,361,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,361,10,1,0)
S BPS("X")=""
"DATA",9002313.91,362,0)
842^5Y^Processor Zip Code^A/N^9
"DATA",9002313.91,362,5)
5Y^9
"DATA",9002313.91,362,10,0)
^^1^1^3031217^
"DATA",9002313.91,362,10,1,0)
S BPS("X")=""
"DATA",9002313.91,363,0)
751^^Record Count^N^10
"DATA",9002313.91,363,5)
^10
"DATA",9002313.91,363,10,0)
^^1^1^3031217^
"DATA",9002313.91,363,10,1,0)
S BPS("X")=""
"DATA",9002313.91,364,0)
843^5Z^Record Identifier^N^1
"DATA",9002313.91,364,5)
5Z^1
"DATA",9002313.91,364,10,0)
^9002313.9101^1^1^3031217^^^^
"DATA",9002313.91,364,10,1,0)
S BPS("X")=2
"DATA",9002313.91,364,20,0)
^9002313.9102^1^1^3031217^^
"DATA",9002313.91,364,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,364,25,0)
^^1^1^3031217^
"DATA",9002313.91,364,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),1)
"DATA",9002313.91,365,0)
740^^Relationship Coverage Eff Date^N^8
"DATA",9002313.91,365,5)
^8
"DATA",9002313.91,365,10,0)
^^1^1^3031217^
"DATA",9002313.91,365,10,1,0)
S BPS("X")=""
"DATA",9002313.91,366,0)
798^^Report Level Indicator^A/N^1
"DATA",9002313.91,366,5)
^1
"DATA",9002313.91,366,10,0)
^^1^1^3031217^
"DATA",9002313.91,366,10,1,0)
S BPS("X")=""
"DATA",9002313.91,367,0)
844^6A^Resubmission Cycle Count^N^2
"DATA",9002313.91,367,5)
6A^2
"DATA",9002313.91,367,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,367,10,1,0)
S BPS("X")=""
"DATA",9002313.91,368,0)
845^6B^Run Date^N^8
"DATA",9002313.91,368,5)
6B^8
"DATA",9002313.91,368,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,368,10,1,0)
S BPS("X")=$P($G(^BPSR(BPS(9002313.02),0)),U,2)
"DATA",9002313.91,368,20,0)
^^1^1^3031217^
"DATA",9002313.91,368,20,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")))
"DATA",9002313.91,368,25,0)
^^1^1^3031217^
"DATA",9002313.91,368,25,1,0)
S BPS("X")=$$DTF1^BPSECFM($G(BPS("X")))
"DATA",9002313.91,368,30,0)
^^1^1^3031217^
"DATA",9002313.91,368,30,1,0)
S $P(^BPSR(BPS(9002313.02),0),U,2)=BPS("X")
"DATA",9002313.91,369,0)
701^^Segment Identifier^A/N^2
"DATA",9002313.91,369,5)
^2
"DATA",9002313.91,369,10,0)
^^1^1^3031217^
"DATA",9002313.91,369,10,1,0)
S BPS("X")=""
"DATA",9002313.91,370,0)
799^^Significant Other Coverage Ind^A/N^1
"DATA",9002313.91,370,5)
^1
"DATA",9002313.91,370,10,0)
^^1^1^3031217^
"DATA",9002313.91,370,10,1,0)
S BPS("X")=""
"DATA",9002313.91,371,0)
722^^Social Security Number^N^9
"DATA",9002313.91,371,5)
^9
"DATA",9002313.91,371,10,0)
^^1^1^3031217^
"DATA",9002313.91,371,10,1,0)
S BPS("X")=BPS("Patient","SSN")
"DATA",9002313.91,371,20,0)
^^1^1^3031217^
"DATA",9002313.91,371,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),9)
"DATA",9002313.91,371,25,0)
^^1^1^3031217^
"DATA",9002313.91,371,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),9)
"DATA",9002313.91,372,0)
742^^Spouse Coverage Indicator^A/N^1
"DATA",9002313.91,372,5)
^1
"DATA",9002313.91,372,10,0)
^^1^1^3031217^
"DATA",9002313.91,372,10,1,0)
S BPS("X")=""
"DATA",9002313.91,373,0)
729^^State^A/N^2
"DATA",9002313.91,373,5)
^2
"DATA",9002313.91,373,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,373,10,1,0)
S BPS("X")=BPS("Patient","State")
"DATA",9002313.91,373,20,0)
^^1^1^3031217^
"DATA",9002313.91,373,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,373,25,0)
^^1^1^3031217^
"DATA",9002313.91,373,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),2)
"DATA",9002313.91,374,0)
745^^Student Coverage Indicator^A/N^1
"DATA",9002313.91,374,5)
^1
"DATA",9002313.91,374,10,0)
^^1^1^3031217^
"DATA",9002313.91,374,10,1,0)
S BPS("X")=""
"DATA",9002313.91,375,0)
746^^Student Covered Through Age^N^3
"DATA",9002313.91,375,5)
^3
"DATA",9002313.91,375,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,375,10,1,0)
S BPS("X")=""
"DATA",9002313.91,376,0)
884^^Student Covered Through Date^N^8
"DATA",9002313.91,376,5)
^8
"DATA",9002313.91,376,10,0)
^^1^1^3031217^
"DATA",9002313.91,376,10,1,0)
S BPS("X")=""
"DATA",9002313.91,377,0)
732^^Telephone Number^N^10
"DATA",9002313.91,377,5)
^10
"DATA",9002313.91,377,10,0)
^9002313.9101^1^1^3050802^^
"DATA",9002313.91,377,10,1,0)
S BPS("X")=$TR($G(BPS("Patient","Phone #")),"#() -_*.@")
"DATA",9002313.91,377,20,0)
^^1^1^3031217^
"DATA",9002313.91,377,20,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,377,25,0)
^^1^1^3031217^
"DATA",9002313.91,377,25,1,0)
S BPS("X")=$$NFF^BPSECFM($G(BPS("X")),10)
"DATA",9002313.91,378,0)
713^^Termination Date^N^8
"DATA",9002313.91,378,5)
^8
"DATA",9002313.91,378,10,0)
^^1^1^3031217^
"DATA",9002313.91,378,10,1,0)
S BPS("X")=""
"DATA",9002313.91,379,0)
846^^Third Party Type^A/N^1
"DATA",9002313.91,379,5)
^1
"DATA",9002313.91,379,10,0)
^^1^1^3031217^
"DATA",9002313.91,379,10,1,0)
S BPS("X")=""
"DATA",9002313.91,380,0)
881^^Workers Compensation Eff Date^N^8
"DATA",9002313.91,380,5)
^8
"DATA",9002313.91,380,10,0)
^^1^1^3031217^
"DATA",9002313.91,380,10,1,0)
S BPS("X")=""
"DATA",9002313.91,381,0)
882^^Workers Comp Original Eff Date^N^8
"DATA",9002313.91,381,5)
^8
"DATA",9002313.91,381,10,0)
^^1^1^3031217^
"DATA",9002313.91,381,10,1,0)
S BPS("X")=""
"DATA",9002313.91,382,0)
883^^Workers Compensation Term Date^N^8
"DATA",9002313.91,382,5)
^8
"DATA",9002313.91,382,10,0)
^^1^1^3031217^
"DATA",9002313.91,382,10,1,0)
S BPS("X")=""
"DATA",9002313.91,383,0)
730^^Zip/Postal Code^A/N^15
"DATA",9002313.91,383,5)
^15
"DATA",9002313.91,383,10,0)
^9002313.9101^1^1^3031217^^
"DATA",9002313.91,383,10,1,0)
S BPS("X")=BPS("Patient","Zip")
"DATA",9002313.91,383,20,0)
^9002313.9102^1^1^3031217^^
"DATA",9002313.91,383,20,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.91,383,25,0)
^^1^1^3031217^
"DATA",9002313.91,383,25,1,0)
S BPS("X")=$$ANFF^BPSECFM($G(BPS("X")),15)
"DATA",9002313.93,1,0)
01^M/I Bin
"DATA",9002313.93,2,0)
02^M/I Version Number
"DATA",9002313.93,3,0)
03^M/I Transaction Code
"DATA",9002313.93,4,0)
04^M/I Processor Control Number
"DATA",9002313.93,5,0)
05^M/I Pharmacy Number
"DATA",9002313.93,6,0)
06^M/I Group Number
"DATA",9002313.93,7,0)
07^M/I Cardholder ID Number
"DATA",9002313.93,8,0)
08^M/I Person Code
"DATA",9002313.93,9,0)
09^M/I Birth Date
"DATA",9002313.93,10,0)
10^M/I Patient Gender Code
"DATA",9002313.93,11,0)
11^M/I Patient Relationship Code
"DATA",9002313.93,12,0)
12^M/I Patient Location
"DATA",9002313.93,13,0)
13^M/I Other Coverage Code
"DATA",9002313.93,14,0)
14^M/I Eligibility Clarification Code
"DATA",9002313.93,15,0)
15^M/I Date of Service
"DATA",9002313.93,16,0)
16^M/I Prescription/Service Reference Number
"DATA",9002313.93,17,0)
17^M/I Fill Number
"DATA",9002313.93,18,0)
18^M/I METRIC QUANTITY
"DATA",9002313.93,19,0)
19^M/I Days Supply
"DATA",9002313.93,20,0)
20^M/I Compound Code
"DATA",9002313.93,21,0)
21^M/I Product/Service ID
"DATA",9002313.93,22,0)
22^M/I Dispense As Written(DAW)/Product Selection Code
"DATA",9002313.93,23,0)
23^M/I Ingredient Cost Submitted
"DATA",9002313.93,24,0)
24^M/I SALES TAX
"DATA",9002313.93,25,0)
25^M/I Prescriber ID
"DATA",9002313.93,26,0)
26^M/I Unit of Measure
"DATA",9002313.93,27,0)
27^(FUTURE USE)
"DATA",9002313.93,28,0)
28^M/I Date Prescription Written
"DATA",9002313.93,29,0)
29^M/I Number Refills Authorized
"DATA",9002313.93,30,0)
30^M/I P.A./M.C. CODE AND NUMBER
"DATA",9002313.93,31,0)
31^(FUTURE USE)
"DATA",9002313.93,32,0)
32^M/I Level of Service
"DATA",9002313.93,33,0)
33^M/I Prescription Origin Code
"DATA",9002313.93,34,0)
34^M/I Submission Clarification Code
"DATA",9002313.93,35,0)
35^M/I Primary Care Provider ID
"DATA",9002313.93,36,0)
36^M/I CLINIC ID
"DATA",9002313.93,37,0)
37^(FUTURE USE)
"DATA",9002313.93,38,0)
38^M/I Basis of Cost
"DATA",9002313.93,39,0)
39^M/I Diagnosis Code
"DATA",9002313.93,40,0)
40^Pharmacy Not Contracted With Plan on Date of Service
"DATA",9002313.93,41,0)
41^Submit Bill To Other Processor Or Primary Payer
"DATA",9002313.93,42,0)
42^(FUTURE USE)
"DATA",9002313.93,43,0)
43^(FUTURE USE)
"DATA",9002313.93,44,0)
44^(FUTURE USE)
"DATA",9002313.93,45,0)
45^(FUTURE USE)
"DATA",9002313.93,46,0)
46^(FUTURE USE)
"DATA",9002313.93,47,0)
47^(FUTURE USE)
"DATA",9002313.93,48,0)
48^(FUTURE USE)
"DATA",9002313.93,49,0)
49^(FUTURE USE)
"DATA",9002313.93,50,0)
50^Non-Matched Pharmacy Number
"DATA",9002313.93,51,0)
51^Non-Matched Group ID
"DATA",9002313.93,52,0)
52^Non-Matched Cardholder ID
"DATA",9002313.93,53,0)
53^Non-Matched Person Code
"DATA",9002313.93,54,0)
54^Non-Matched Product/Service ID Number
"DATA",9002313.93,55,0)
55^Non-Matched Product Package Size
"DATA",9002313.93,56,0)
56^Non-Matched Prescriber ID
"DATA",9002313.93,57,0)
57^NON-MATCHED P.A./M.C. NUMBER
"DATA",9002313.93,58,0)
58^Non-Matched Primary Prescriber
"DATA",9002313.93,59,0)
59^NON-MATCHED CLINIC ID
"DATA",9002313.93,60,0)
60^Product/Service Not Covered For Patient Age
"DATA",9002313.93,61,0)
61^Product/Service Not Covered For Patient Gender
"DATA",9002313.93,62,0)
62^Patient/Card Holder ID Name Mismatch
"DATA",9002313.93,63,0)
63^Institutionalized Patient Product/Service ID Not Covered
"DATA",9002313.93,64,0)
64^Claim Submitted Does Not Match Prior Authorization
"DATA",9002313.93,65,0)
65^Patient Is Not Covered
"DATA",9002313.93,66,0)
66^Patient Age Exceeds Maximum Age
"DATA",9002313.93,67,0)
67^Filled Before Coverage Effective
"DATA",9002313.93,68,0)
68^Filled After Coverage Expired
"DATA",9002313.93,69,0)
69^Filled After Coverage Terminated
"DATA",9002313.93,70,0)
70^Product/Service Not Covered
"DATA",9002313.93,71,0)
71^Prescriber Is Not Covered
"DATA",9002313.93,72,0)
72^Primary Prescriber Is Not Covered
"DATA",9002313.93,73,0)
73^Refills Are Not Covered
"DATA",9002313.93,74,0)
74^Other Carrier Payment Meets Or Exceeds Payable
"DATA",9002313.93,75,0)
75^Prior Authorization Required
"DATA",9002313.93,76,0)
76^Plan Limitations Exceeded
"DATA",9002313.93,77,0)
77^Discontinued Product/Service ID Number
"DATA",9002313.93,78,0)
78^Cost Exceeds Maximum
"DATA",9002313.93,79,0)
79^Refill Too Soon
"DATA",9002313.93,80,0)
80^Drug-Diagnosis Mismatch
"DATA",9002313.93,81,0)
81^Claim Too Old
"DATA",9002313.93,82,0)
82^Claim Is Post-Dated
"DATA",9002313.93,83,0)
83^Duplicate Paid/Captured Claim
"DATA",9002313.93,84,0)
84^Claim Has Not Been Paid/Captured
"DATA",9002313.93,85,0)
85^Claim Not Processed
"DATA",9002313.93,86,0)
86^Submit Manual Reversal
"DATA",9002313.93,87,0)
87^Reversal Not Processed
"DATA",9002313.93,88,0)
88^DUR Reject Error
"DATA",9002313.93,89,0)
89^Rejected Claim Fees Paid
"DATA",9002313.93,90,0)
90^Host Hung Up
"DATA",9002313.93,91,0)
91^Host Response Error
"DATA",9002313.93,92,0)
92^System Unavailable/Host Unavailable
"DATA",9002313.93,93,0)
93^PLANNED UNAVAILABLE
"DATA",9002313.93,94,0)
94^INVALID MESSAGE
"DATA",9002313.93,95,0)
95^Time Out
"DATA",9002313.93,96,0)
96^Scheduled Downtime
"DATA",9002313.93,97,0)
97^Payor Unavailable
"DATA",9002313.93,98,0)
98^Connection To Payer Is Down
"DATA",9002313.93,99,0)
99^Host Processing Error
"DATA",9002313.93,100,0)
CA^M/I Patient First Name
"DATA",9002313.93,101,0)
CB^M/I Patient Last Name
"DATA",9002313.93,102,0)
CC^M/I Cardholder First Name
"DATA",9002313.93,103,0)
CD^M/I Cardholder Last Name
"DATA",9002313.93,104,0)
CE^M/I Home Plan
"DATA",9002313.93,105,0)
CF^M/I Employer Name
"DATA",9002313.93,106,0)
CG^M/I Employer Street Address
"DATA",9002313.93,107,0)
CH^M/I Employer City Address
"DATA",9002313.93,108,0)
CI^M/I Employer State/Province Address
"DATA",9002313.93,109,0)
CJ^M/I Employer Zip Postal Zone
"DATA",9002313.93,110,0)
CK^M/I Employer Phone Number
"DATA",9002313.93,111,0)
CL^M/I Employer Contact Name
"DATA",9002313.93,112,0)
CM^M/I Patient Street Address
"DATA",9002313.93,113,0)
CN^M/I Patient City Address
"DATA",9002313.93,114,0)
CO^M/I Patient State/Province Address
"DATA",9002313.93,115,0)
CP^M/I Patient Zip/Postal Zone
"DATA",9002313.93,116,0)
CQ^M/I Patient Phone Number
"DATA",9002313.93,117,0)
CR^M/I Carrier ID
"DATA",9002313.93,118,0)
CT^PATIENT SOCIAL SECURITY NUMBER
"DATA",9002313.93,119,0)
DP^M/I DRUG TYPE OVERRIDE
"DATA",9002313.93,120,0)
DR^M/I Prescriber Last Name
"DATA",9002313.93,121,0)
DQ^M/I Usual and Customary Charge
"DATA",9002313.93,122,0)
DS^M/I POSTAGE AMOUNT CLAIMED
"DATA",9002313.93,123,0)
DT^M/I Unit Dost Indicator
"DATA",9002313.93,124,0)
DU^M/I Gross Amount Due
"DATA",9002313.93,125,0)
DV^M/I Other Payer Amount Paid
"DATA",9002313.93,126,0)
DW^M/I BASIS OF DAYS SUPPLY DETERMINATION
"DATA",9002313.93,127,0)
DX^M/I Patient Paid Amount Submitted
"DATA",9002313.93,128,0)
DY^M/I Date of Injury
"DATA",9002313.93,129,0)
DZ^M/I Claim/Reference ID
"DATA",9002313.93,130,0)
E1^M/I Product/Service ID Qualifier
"DATA",9002313.93,131,0)
E2^ALTERNATE PRODUCT CODE
"DATA",9002313.93,132,0)
E3^M/I Incentive Amount Submitted
"DATA",9002313.93,133,0)
E4^M/I Reason For Service Code
"DATA",9002313.93,134,0)
E5^M/I Professional Service Code
"DATA",9002313.93,135,0)
E6^M/I Result of Service Code
"DATA",9002313.93,136,0)
E7^M/I Quantity Dispensed
"DATA",9002313.93,137,0)
E8^M/I Other Payer Date
"DATA",9002313.93,138,0)
M1^Patient Not Covered In This Aid Category
"DATA",9002313.93,139,0)
M2^Recipient Locked In
"DATA",9002313.93,140,0)
M3^Host PA/MC Error
"DATA",9002313.93,141,0)
M4^Prescription/Service Reference Number/Time Limit Exceeded
"DATA",9002313.93,142,0)
M5^Requires Manual Claim
"DATA",9002313.93,143,0)
M6^Host Eligibility Error
"DATA",9002313.93,144,0)
M7^Host Drug File Error
"DATA",9002313.93,145,0)
M8^Host Provider File Error
"DATA",9002313.93,146,0)
MZ^Error Overflow
"DATA",9002313.93,147,0)
1C^M/I Smoker/Non-Smoker Code
"DATA",9002313.93,148,0)
1E^M/I Prescriber Location Code
"DATA",9002313.93,149,0)
2C^M/I Pregnancy Indicator
"DATA",9002313.93,150,0)
2E^M/I Primary Care Provider ID Qualifier
"DATA",9002313.93,151,0)
3A^M/I Request Type
"DATA",9002313.93,152,0)
3B^M/I Request Period Date-Begin
"DATA",9002313.93,153,0)
3C^M/I Request Period Date-End
"DATA",9002313.93,154,0)
3D^M/I Basis of Request
"DATA",9002313.93,155,0)
3E^M/I Authorized Representative First Name
"DATA",9002313.93,156,0)
3F^M/I Authorized Representative Last Name
"DATA",9002313.93,157,0)
3G^M/I Authorized Representative Street Address
"DATA",9002313.93,158,0)
3H^M/I Authorized Representative City Address
"DATA",9002313.93,159,0)
3J^M/I Authorized Representative State/Province Address
"DATA",9002313.93,160,0)
3K^M/I Authorized Representative Zip/Postal Zone
"DATA",9002313.93,161,0)
3M^M/I Prescriber Phone Number
"DATA",9002313.93,162,0)
3N^M/I Prior Authorized Number Assigned
"DATA",9002313.93,163,0)
3P^M/I Authorization Number
"DATA",9002313.93,164,0)
3R^Prior Authorization Not Required
"DATA",9002313.93,165,0)
3S^M/I Prior Authorization Supporting Documentation
"DATA",9002313.93,166,0)
3T^Active Prior Auth Exists Resubmit At Expiration of Prior Auth
"DATA",9002313.93,167,0)
3W^Prior Authorization in Process
"DATA",9002313.93,168,0)
3X^Authorization Number Not Found
"DATA",9002313.93,169,0)
3Y^Prior Authorization Denied
"DATA",9002313.93,170,0)
4C^M/I Coordination of Benefits/Other Payments Count
"DATA",9002313.93,171,0)
4E^M/I Primary Care Provider Last Name
"DATA",9002313.93,172,0)
5C^M/I Other Payer Coverage Type
"DATA",9002313.93,173,0)
5E^M/I Other Payer Reject Count
"DATA",9002313.93,174,0)
6C^M/I Other Payer ID Qualifier
"DATA",9002313.93,175,0)
6E^M/I Other Payer Reject Code
"DATA",9002313.93,176,0)
7C^M/I Other Payer ID
"DATA",9002313.93,177,0)
7E^M/I DUR/PPS Code Counter
"DATA",9002313.93,178,0)
8C^M/I Facility ID
"DATA",9002313.93,179,0)
8E^M/I DUR/PPS Level of Effort
"DATA",9002313.93,180,0)
AA^Patient Spenddown Not Met
"DATA",9002313.93,181,0)
AB^Date Written Is After Date Filled
"DATA",9002313.93,182,0)
AC^Product Not Covered Non-Participating Manufacturer
"DATA",9002313.93,183,0)
AD^Billing Provider Not Eligible To Bill This Claim Type
"DATA",9002313.93,184,0)
AE^QMB (Qualified Medicare Beneficiary)-Bill Medicare
"DATA",9002313.93,185,0)
AF^Patient Enrolled Under Managed Care
"DATA",9002313.93,186,0)
AG^Days Supply Limitation For Product/Service
"DATA",9002313.93,187,0)
AH^Unit Dose Packaging Only Payable For Nursing Home Recipients
"DATA",9002313.93,188,0)
AJ^Generic Drug Required
"DATA",9002313.93,189,0)
AK^M/I Software Vendor/Certification ID
"DATA",9002313.93,190,0)
AM^M/I Segment Identification
"DATA",9002313.93,191,0)
A9^M/I Transaction Count
"DATA",9002313.93,192,0)
BE^M/I Professional Service Fee Submitted
"DATA",9002313.93,193,0)
B2^M/I Service Provider ID Qualifier
"DATA",9002313.93,194,0)
CW^M/I Alternate ID
"DATA",9002313.93,195,0)
CX^M/I Patient ID Qualifier
"DATA",9002313.93,196,0)
CY^M/I Patient ID
"DATA",9002313.93,197,0)
CZ^M/I Employer ID
"DATA",9002313.93,198,0)
DC^M/I Dispensing Fee Submitted
"DATA",9002313.93,199,0)
DN^M/I Basis of Cost Determination
"DATA",9002313.93,200,0)
EA^M/I Orginally Prescribed Product/Service Code
"DATA",9002313.93,201,0)
EB^M/I Orginally Prescribed Quantity
"DATA",9002313.93,202,0)
EC^M/I Compound Ingredient Component Count
"DATA",9002313.93,203,0)
ED^M/I Compound Ingredient Quantity
"DATA",9002313.93,204,0)
EE^M/I Compound Ingredient Drug Cost
"DATA",9002313.93,205,0)
EF^M/I Compound Dosage Form Description Code
"DATA",9002313.93,206,0)
EG^M/I Compound Dispensing Unit Form Indicator
"DATA",9002313.93,207,0)
EH^M/I Compound Route of Administration
"DATA",9002313.93,208,0)
EJ^M/I Orginally Prescribed Product/Service ID Qualifier
"DATA",9002313.93,209,0)
EK^M/I Scheduled Prescription ID Number
"DATA",9002313.93,210,0)
EM^M/I Prescription/Service Reference Number Qualifier
"DATA",9002313.93,211,0)
EN^M/I Associated Prescription/Service REference Number
"DATA",9002313.93,212,0)
Ep^M/I Associated Prescription/Service Date
"DATA",9002313.93,213,0)
ER^M/I Procedure Modifier Code
"DATA",9002313.93,214,0)
ET^M/I Quantity Prescribed
"DATA",9002313.93,215,0)
EU^M/I Prior Authorization Type Code
"DATA",9002313.93,216,0)
EV^M/I Prior Authorization Number Submitted
"DATA",9002313.93,217,0)
EW^M/I Intermediary Authorzation Type ID
"DATA",9002313.93,218,0)
EX^M/I Intermediary Authorization ID
"DATA",9002313.93,219,0)
EY^M/I Provider ID Qualifier
"DATA",9002313.93,220,0)
EZ^M/I Prescriber ID Qualifier
"DATA",9002313.93,221,0)
E9^M/I Provider ID
"DATA",9002313.93,222,0)
FO^M/I Plan ID
"DATA",9002313.93,223,0)
GE^M/I Percentage Sales Tax Amount Submitted
"DATA",9002313.93,224,0)
HA^M/I Flat Sales Tax Amount Submitted
"DATA",9002313.93,225,0)
HB^M/I Other Payer Amount Paid Count
"DATA",9002313.93,226,0)
HC^M/I Other Payer Amount Paid Qualifier
"DATA",9002313.93,227,0)
HD^M/I Dispensing Status
"DATA",9002313.93,228,0)
HE^M/I Percentage Sales Tax Rate Submitted
"DATA",9002313.93,229,0)
HF^M/I Quantity Intended To Be Dispensed
"DATA",9002313.93,230,0)
HG^M/I Days Supply Intended To Be Dispensed
"DATA",9002313.93,231,0)
H1^M/I Measurement Time
"DATA",9002313.93,232,0)
H2^M/I Measurement Dimension
"DATA",9002313.93,233,0)
H3^M/I Measurement Unit
"DATA",9002313.93,234,0)
H4^M/I Measurement Value
"DATA",9002313.93,235,0)
H5^M/I Primary Care Provider Location Code
"DATA",9002313.93,236,0)
H6^M/I DUR Co-Agent Id
"DATA",9002313.93,237,0)
H7^M/I Other Amount Claimed Submitted Count
"DATA",9002313.93,238,0)
H8^M/I Other Amount Claimed Submtited Qualifier
"DATA",9002313.93,239,0)
H9^M/I Other Amount Claimed Submitted
"DATA",9002313.93,240,0)
JE^M/I Percentage Sales TAx Basis Submitted
"DATA",9002313.93,241,0)
J9^M/I DUR Co-Agent ID Qualifier
"DATA",9002313.93,242,0)
KE^M/I Coupon Type
"DATA",9002313.93,243,0)
ME^M/I Coupon Number
"DATA",9002313.93,244,0)
NE^M/I Coupon Value Amount
"DATA",9002313.93,245,0)
NN^Transaction Rejected At Switch Or Intermediary
"DATA",9002313.93,246,0)
PA^PA Exhausted/Not Renewable
"DATA",9002313.93,247,0)
PB^Invalid Transaction Count For This Transaction Code
"DATA",9002313.93,248,0)
PC^M/I Claim Segment
"DATA",9002313.93,249,0)
PD^M/I Clinical Segment
"DATA",9002313.93,250,0)
PE^M/I COB/Other Payments Segment
"DATA",9002313.93,251,0)
PF^M/I Compound Segment
"DATA",9002313.93,252,0)
PG^M/I Coupon Segment
"DATA",9002313.93,253,0)
PH^M/I DUR/PPS Segment
"DATA",9002313.93,254,0)
PJ^M/I Insurance Segment
"DATA",9002313.93,255,0)
PK^M/I Patient Segment
"DATA",9002313.93,256,0)
PM^M/I Pharmacy Provider Segment
"DATA",9002313.93,257,0)
PN^M/I Prescriber Segment
"DATA",9002313.93,258,0)
PP^M/I Pricing Segment
"DATA",9002313.93,259,0)
PR^M/I Prior Authorization Segment
"DATA",9002313.93,260,0)
PS^M/I Transaction Header Segment
"DATA",9002313.93,261,0)
PT^M/I Workers' Compensation Segment
"DATA",9002313.93,262,0)
PV^Non-Matched Associated Prescription/Service Date
"DATA",9002313.93,263,0)
PW^Non-Matched Employer ID
"DATA",9002313.93,264,0)
PX^Non-Matched Other Payer ID
"DATA",9002313.93,265,0)
PY^Non-Matched Unit Form/Route of Administration
"DATA",9002313.93,266,0)
PZ^Non-Matched Unit Of Measure To Product/Service ID
"DATA",9002313.93,267,0)
P1^Associated Prescription/Service Reference Number Not Found
"DATA",9002313.93,268,0)
P2^Clinical Information Counter Out Of Sequence
"DATA",9002313.93,269,0)
P3^Compound Ingred Component Count Does Not Match Number of Repetitions
"DATA",9002313.93,270,0)
P4^COB/Other Payments Count Does Not Match Number of Repetitions
"DATA",9002313.93,271,0)
P5^Coupon Expired
"DATA",9002313.93,272,0)
P6^Date of Service Prior To Date Of Birth
"DATA",9002313.93,273,0)
P7^Diagnosis Code Count Does Not Match Number Of Repetitions
"DATA",9002313.93,274,0)
P8^DUR/PPS Code Counter Out of Sequence
"DATA",9002313.93,275,0)
P9^Field Is Non-Repeatable
"DATA",9002313.93,276,0)
RA^PA Reversal Out Of Order
"DATA",9002313.93,277,0)
RB^Multiple Partials Not Allowed
"DATA",9002313.93,278,0)
RC^Different Drug Entity Between Partial & Completion
"DATA",9002313.93,279,0)
RD^Mismatched Cardholder/Group ID-Partial To Completion
"DATA",9002313.93,280,0)
RE^M/I Compound Product ID Qualifier
"DATA",9002313.93,281,0)
RF^Improper Order of 'Dispensing Status' Code on Partial Fill Transaction
"DATA",9002313.93,282,0)
RG^M/I Associated Prescription/Service Ref Num on Completion Transaction
"DATA",9002313.93,283,0)
RH^M/I Associated Prescription/Service Date on Completion Transaction
"DATA",9002313.93,284,0)
RJ^Associated Partial Fill Transaction Not on File
"DATA",9002313.93,285,0)
RK^Partial Fill Transaction Not Supported
"DATA",9002313.93,286,0)
RM^Completion Trans Not Permitted W/ Same 'Date of Service' Partl Trans
"DATA",9002313.93,287,0)
RN^Plan Limits Exceeded On Intended Partial Fill Values
"DATA",9002313.93,288,0)
RP^Out Of Sequence 'P' Reversal on Partial Fill Transaction
"DATA",9002313.93,289,0)
RS^M/I Associated Prescription/Service Date on Partial Transaction
"DATA",9002313.93,290,0)
RT^M/I Associated Prescription/Service Ref Number on Partial Trans
"DATA",9002313.93,291,0)
RU^Mandatory Elements Must Occur Befr Optional Data Elements In Segment
"DATA",9002313.93,292,0)
R1^Other Amount Claimed Submitted Count Does Not Match # of Repetitions
"DATA",9002313.93,293,0)
R2^Other Payer Reject Count Does Not Match Number Of Repetitions
"DATA",9002313.93,294,0)
R3^Procedure Modifier Code Count Does Match Number Of Repetitions
"DATA",9002313.93,295,0)
R4^Procedure Modifier Code Invalid For Product/Service ID
"DATA",9002313.93,296,0)
R5^Product/Service ID Must Be Zero When Product/Service ID Qual Equals 06
"DATA",9002313.93,297,0)
R6^Product/Service Not Appropriate For This Location
"DATA",9002313.93,298,0)
R7^Repeating Segment Not Allowed In Same Transaction
"DATA",9002313.93,299,0)
R8^Syntax Error
"DATA",9002313.93,300,0)
R9^Value In Gross Amount Due Does Not Follow Pricing Formulae
"DATA",9002313.93,301,0)
SE^M/I Procedure Modifier Code Count
"DATA",9002313.93,302,0)
TE^M/I Compound Product ID
"DATA",9002313.93,303,0)
UE^M/I Compound Ingredient Basis Of Cost Determination
"DATA",9002313.93,304,0)
VE^M/I Diagnosis Code Count
"DATA",9002313.93,305,0)
WE^M/I Diagnosis Code Qualifier
"DATA",9002313.93,306,0)
XE^M/I Clinical Information Counter
"DATA",9002313.93,307,0)
ZE^M/I Measurement Date
"DATA",9002313.93,309,0)
*96^Scheduled Downtime
"DATA",9002313.93,311,0)
*98^Connection To Payer Is Down
"DATA",9002313.93,312,0)
*95^The Clearinghouse Did Not Respond In Time.
"DATA",9002313.93,313,0)
*97^Payer Unavailable
"FIA",9002313.02)
BPS CLAIMS
"FIA",9002313.02,0)
^BPSC(
"FIA",9002313.02,0,0)
9002313.02
"FIA",9002313.02,0,1)
y^y^f^^^^n
"FIA",9002313.02,0,10)

"FIA",9002313.02,0,11)

"FIA",9002313.02,0,"RLRO")

"FIA",9002313.02,0,"VR")
1.0^BPS
"FIA",9002313.02,9002313.02)
0
"FIA",9002313.02,9002313.0201)
0
"FIA",9002313.02,9002313.0401)
0
"FIA",9002313.02,9002313.0501)
0
"FIA",9002313.02,9002313.0601)
0
"FIA",9002313.02,9002313.0701)
0
"FIA",9002313.02,9002313.0801)
0
"FIA",9002313.02,9002313.0901)
0
"FIA",9002313.02,9002313.1001)
0
"FIA",9002313.02,9002313.201459)
0
"FIA",9002313.02,9002313.29999)
0
"FIA",9002313.02,9002313.401342)
0
"FIA",9002313.02,9002313.401472)
0
"FIA",9002313.03)
BPS RESPONSES
"FIA",9002313.03,0)
^BPSR(
"FIA",9002313.03,0,0)
9002313.03P
"FIA",9002313.03,0,1)
y^y^f^^^^n
"FIA",9002313.03,0,10)

"FIA",9002313.03,0,11)

"FIA",9002313.03,0,"RLRO")

"FIA",9002313.03,0,"VR")
1.0^BPS
"FIA",9002313.03,9002313.03)
0
"FIA",9002313.03,9002313.0301)
0
"FIA",9002313.03,9002313.03511)
0
"FIA",9002313.03,9002313.1101)
0
"FIA",9002313.03,9002313.1301)
0
"FIA",9002313.03,9002313.1401)
0
"FIA",9002313.03,9002313.301548)
0
"FIA",9002313.03,9002313.39999)
0
"FIA",9002313.1)
BPS COMBINED INSURANCE
"FIA",9002313.1,0)
^BPSCOMB(
"FIA",9002313.1,0,0)
9002313.1P
"FIA",9002313.1,0,1)
y^y^f^^^^n
"FIA",9002313.1,0,10)

"FIA",9002313.1,0,11)

"FIA",9002313.1,0,"RLRO")

"FIA",9002313.1,0,"VR")
1.0^BPS
"FIA",9002313.1,9002313.1)
0
"FIA",9002313.1,9002313.11)
0
"FIA",9002313.21)
BPS NCPDP PROFESSIONAL SERVICE CODE
"FIA",9002313.21,0)
^BPS(9002313.21,
"FIA",9002313.21,0,0)
9002313.21I
"FIA",9002313.21,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.21,0,10)

"FIA",9002313.21,0,11)

"FIA",9002313.21,0,"RLRO")

"FIA",9002313.21,0,"VR")
1.0^BPS
"FIA",9002313.21,9002313.21)
0
"FIA",9002313.22)
BPS NCPDP RESULT OF SERVICE CODE
"FIA",9002313.22,0)
^BPS(9002313.22,
"FIA",9002313.22,0,0)
9002313.22I
"FIA",9002313.22,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.22,0,10)

"FIA",9002313.22,0,11)

"FIA",9002313.22,0,"RLRO")

"FIA",9002313.22,0,"VR")
1.0^BPS
"FIA",9002313.22,9002313.22)
0
"FIA",9002313.23)
BPS NCPDP REASON FOR SERVICE CODE
"FIA",9002313.23,0)
^BPS(9002313.23,
"FIA",9002313.23,0,0)
9002313.23I
"FIA",9002313.23,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.23,0,10)

"FIA",9002313.23,0,11)

"FIA",9002313.23,0,"RLRO")

"FIA",9002313.23,0,"VR")
1.0^BPS
"FIA",9002313.23,9002313.23)
0
"FIA",9002313.24)
BPS NCPDP DAW CODE
"FIA",9002313.24,0)
^BPS(9002313.24,
"FIA",9002313.24,0,0)
9002313.24I
"FIA",9002313.24,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.24,0,10)

"FIA",9002313.24,0,11)

"FIA",9002313.24,0,"RLRO")

"FIA",9002313.24,0,"VR")
1.0^BPS
"FIA",9002313.24,9002313.24)
0
"FIA",9002313.31)
BPS CERTIFICATION
"FIA",9002313.31,0)
^BPS(9002313.31,
"FIA",9002313.31,0,0)
9002313.31
"FIA",9002313.31,0,1)
y^y^f^^^^n
"FIA",9002313.31,0,10)

"FIA",9002313.31,0,11)

"FIA",9002313.31,0,"RLRO")

"FIA",9002313.31,0,"VR")
1.0^BPS
"FIA",9002313.31,9002313.31)
0
"FIA",9002313.31,9002313.311)
0
"FIA",9002313.31,9002313.312)
0
"FIA",9002313.31,9002313.3121)
0
"FIA",9002313.31,9002313.31902)
0
"FIA",9002313.4)
BPS INSURER
"FIA",9002313.4,0)
^BPSEI(
"FIA",9002313.4,0,0)
9002313.4P
"FIA",9002313.4,0,1)
y^y^f^^^^n
"FIA",9002313.4,0,10)

"FIA",9002313.4,0,11)

"FIA",9002313.4,0,"RLRO")

"FIA",9002313.4,0,"VR")
1.0^BPS
"FIA",9002313.4,9002313.4)
0
"FIA",9002313.4,9002313.41)
0
"FIA",9002313.4,9002313.43)
0
"FIA",9002313.4,9002313.44)
0
"FIA",9002313.4,9002313.45)
0
"FIA",9002313.51)
BPS DATA INPUT
"FIA",9002313.51,0)
^BPS(9002313.51,
"FIA",9002313.51,0,0)
9002313.51D
"FIA",9002313.51,0,1)
y^y^f^^^^n
"FIA",9002313.51,0,10)

"FIA",9002313.51,0,11)

"FIA",9002313.51,0,"RLRO")

"FIA",9002313.51,0,"VR")
1.0^BPS
"FIA",9002313.51,9002313.51)
0
"FIA",9002313.51,9002313.512)
0
"FIA",9002313.51,9002313.514)
0
"FIA",9002313.51,9002313.522)
0
"FIA",9002313.511)
BPS NCPDP OVERRIDE
"FIA",9002313.511,0)
^BPS(9002313.511,
"FIA",9002313.511,0,0)
9002313.511AO
"FIA",9002313.511,0,1)
y^y^f^^^^n
"FIA",9002313.511,0,10)

"FIA",9002313.511,0,11)

"FIA",9002313.511,0,"RLRO")

"FIA",9002313.511,0,"VR")
1.0^BPS
"FIA",9002313.511,9002313.511)
0
"FIA",9002313.511,9002313.5111)
0
"FIA",9002313.515)
BPS INPUT USER PREF
"FIA",9002313.515,0)
^BPS(9002313.515,
"FIA",9002313.515,0,0)
9002313.515P
"FIA",9002313.515,0,1)
y^y^f^^^^n
"FIA",9002313.515,0,10)

"FIA",9002313.515,0,11)

"FIA",9002313.515,0,"RLRO")

"FIA",9002313.515,0,"VR")
1.0^BPS
"FIA",9002313.515,9002313.515)
0
"FIA",9002313.516)
BPS ORIGIN OF INPUT
"FIA",9002313.516,0)
^BPS(9002313.516,
"FIA",9002313.516,0,0)
9002313.516
"FIA",9002313.516,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.516,0,10)

"FIA",9002313.516,0,11)

"FIA",9002313.516,0,"RLRO")

"FIA",9002313.516,0,"VR")
1.0^BPS
"FIA",9002313.516,9002313.516)
0
"FIA",9002313.516,9002313.5161)
0
"FIA",9002313.53)
BPS PRICING TABLES
"FIA",9002313.53,0)
^BPS(9002313.53,
"FIA",9002313.53,0,0)
9002313.53
"FIA",9002313.53,0,1)
y^y^f^^^^n
"FIA",9002313.53,0,10)

"FIA",9002313.53,0,11)

"FIA",9002313.53,0,"RLRO")

"FIA",9002313.53,0,"VR")
1.0^BPS
"FIA",9002313.53,9002313.53)
0
"FIA",9002313.53,9002313.531)
0
"FIA",9002313.55)
BPS DIALOUT
"FIA",9002313.55,0)
^BPS(9002313.55,
"FIA",9002313.55,0,0)
9002313.55
"FIA",9002313.55,0,1)
y^y^f^^^^n
"FIA",9002313.55,0,10)

"FIA",9002313.55,0,11)

"FIA",9002313.55,0,"RLRO")

"FIA",9002313.55,0,"VR")
1.0^BPS
"FIA",9002313.55,9002313.55)
0
"FIA",9002313.56)
BPS PHARMACIES
"FIA",9002313.56,0)
^BPS(9002313.56,
"FIA",9002313.56,0,0)
9002313.56
"FIA",9002313.56,0,1)
y^y^f^^^^n
"FIA",9002313.56,0,10)

"FIA",9002313.56,0,11)

"FIA",9002313.56,0,"RLRO")

"FIA",9002313.56,0,"VR")
1.0^BPS
"FIA",9002313.56,9002313.56)
0
"FIA",9002313.56,9002313.5601)
0
"FIA",9002313.56,9002313.56011)
0
"FIA",9002313.56,9002313.6)
0
"FIA",9002313.57)
BPS LOG OF TRANSACTIONS
"FIA",9002313.57,0)
^BPSTL(
"FIA",9002313.57,0,0)
9002313.57
"FIA",9002313.57,0,1)
y^y^f^^^^n
"FIA",9002313.57,0,10)

"FIA",9002313.57,0,11)

"FIA",9002313.57,0,"RLRO")

"FIA",9002313.57,0,"VR")
1.0^BPS
"FIA",9002313.57,9002313.57)
0
"FIA",9002313.57,9002313.57111)
0
"FIA",9002313.57,9002313.5713)
0
"FIA",9002313.57,9002313.57902)
0
"FIA",9002313.58)
BPS STATISTICS
"FIA",9002313.58,0)
^BPSECX("S",
"FIA",9002313.58,0,0)
9002313.58
"FIA",9002313.58,0,1)
y^y^f^^^^n^^
"FIA",9002313.58,0,10)

"FIA",9002313.58,0,11)

"FIA",9002313.58,0,"RLRO")

"FIA",9002313.58,0,"VR")
1.0^BPS
"FIA",9002313.58,9002313.58)
0
"FIA",9002313.59)
BPS TRANSACTION
"FIA",9002313.59,0)
^BPST(
"FIA",9002313.59,0,0)
9002313.59O
"FIA",9002313.59,0,1)
y^y^f^^^^n
"FIA",9002313.59,0,10)

"FIA",9002313.59,0,11)

"FIA",9002313.59,0,"RLRO")

"FIA",9002313.59,0,"VR")
1.0^BPS
"FIA",9002313.59,9002313.59)
0
"FIA",9002313.59,9002313.59111)
0
"FIA",9002313.59,9002313.5913)
0
"FIA",9002313.59,9002313.59902)
0
"FIA",9002313.61)
BPS REPORT MASTER
"FIA",9002313.61,0)
^BPSECX("RPT",
"FIA",9002313.61,0,0)
9002313.61
"FIA",9002313.61,0,1)
y^y^f^^^^n
"FIA",9002313.61,0,10)

"FIA",9002313.61,0,11)

"FIA",9002313.61,0,"RLRO")

"FIA",9002313.61,0,"VR")
1.0^BPS
"FIA",9002313.61,9002313.61)
0
"FIA",9002313.61,9002313.611)
0
"FIA",9002313.61,9002313.6118)
0
"FIA",9002313.61,9002313.6213)
0
"FIA",9002313.81)
BPS TRANSLATE 9999999.36
"FIA",9002313.81,0)
^BPSF(9002313.81,
"FIA",9002313.81,0,0)
9002313.81
"FIA",9002313.81,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.81,0,10)

"FIA",9002313.81,0,11)

"FIA",9002313.81,0,"RLRO")

"FIA",9002313.81,0,"VR")
1.0^BPS
"FIA",9002313.81,9002313.81)
0
"FIA",9002313.82103)
BPS NCPDP FIELD 103
"FIA",9002313.82103,0)
^BPSF(9002313.82103,
"FIA",9002313.82103,0,0)
9002313.82103
"FIA",9002313.82103,0,1)
y^y^f^^^^n^^
"FIA",9002313.82103,0,10)

"FIA",9002313.82103,0,11)

"FIA",9002313.82103,0,"RLRO")

"FIA",9002313.82103,0,"VR")
1.0^BPS
"FIA",9002313.82103,9002313.82103)
0
"FIA",9002313.82305)
BPS NCPDP FIELD 305
"FIA",9002313.82305,0)
^BPSF(9002313.82305,
"FIA",9002313.82305,0,0)
9002313.82305
"FIA",9002313.82305,0,1)
y^y^f^^^^n^^
"FIA",9002313.82305,0,10)

"FIA",9002313.82305,0,11)

"FIA",9002313.82305,0,"RLRO")

"FIA",9002313.82305,0,"VR")
1.0^BPS
"FIA",9002313.82305,9002313.82305)
0
"FIA",9002313.82306)
BPS NCPDP FIELD 306
"FIA",9002313.82306,0)
^BPSF(9002313.82306,
"FIA",9002313.82306,0,0)
9002313.82306
"FIA",9002313.82306,0,1)
y^y^f^^^^n^^
"FIA",9002313.82306,0,10)

"FIA",9002313.82306,0,11)

"FIA",9002313.82306,0,"RLRO")

"FIA",9002313.82306,0,"VR")
1.0^BPS
"FIA",9002313.82306,9002313.82306)
0
"FIA",9002313.82307)
BPS NCPDP FIELD 307
"FIA",9002313.82307,0)
^BPSF(9002313.82307,
"FIA",9002313.82307,0,0)
9002313.82307
"FIA",9002313.82307,0,1)
y^y^f^^^^n^^
"FIA",9002313.82307,0,10)

"FIA",9002313.82307,0,11)

"FIA",9002313.82307,0,"RLRO")

"FIA",9002313.82307,0,"VR")
1.0^BPS
"FIA",9002313.82307,9002313.82307)
0
"FIA",9002313.82308)
BPS NCPDP FIELD 308
"FIA",9002313.82308,0)
^BPSF(9002313.82308,
"FIA",9002313.82308,0,0)
9002313.82308
"FIA",9002313.82308,0,1)
y^y^f^^^^n^^
"FIA",9002313.82308,0,10)

"FIA",9002313.82308,0,11)

"FIA",9002313.82308,0,"RLRO")

"FIA",9002313.82308,0,"VR")
1.0^BPS
"FIA",9002313.82308,9002313.82308)
0
"FIA",9002313.82309)
BPS NCPDP FIELD 309
"FIA",9002313.82309,0)
^BPSF(9002313.82309,
"FIA",9002313.82309,0,0)
9002313.82309
"FIA",9002313.82309,0,1)
y^y^f^^^^n^^
"FIA",9002313.82309,0,10)

"FIA",9002313.82309,0,11)

"FIA",9002313.82309,0,"RLRO")

"FIA",9002313.82309,0,"VR")
1.0^BPS
"FIA",9002313.82309,9002313.82309)
0
"FIA",9002313.82406)
BPS NCPDP FIELD 406
"FIA",9002313.82406,0)
^BPSF(9002313.82406,
"FIA",9002313.82406,0,0)
9002313.82406
"FIA",9002313.82406,0,1)
y^y^f^^^^n^^
"FIA",9002313.82406,0,10)

"FIA",9002313.82406,0,11)

"FIA",9002313.82406,0,"RLRO")

"FIA",9002313.82406,0,"VR")
1.0^BPS
"FIA",9002313.82406,9002313.82406)
0
"FIA",9002313.82408)
BPS NCPDP FIELD 408
"FIA",9002313.82408,0)
^BPSF(9002313.82408,
"FIA",9002313.82408,0,0)
9002313.82408
"FIA",9002313.82408,0,1)
y^y^f^^^^n^^
"FIA",9002313.82408,0,10)

"FIA",9002313.82408,0,11)

"FIA",9002313.82408,0,"RLRO")

"FIA",9002313.82408,0,"VR")
1.0^BPS
"FIA",9002313.82408,9002313.82408)
0
"FIA",9002313.82416)
BPS NCPDP FIELD 416
"FIA",9002313.82416,0)
^BPSF(9002313.82416,
"FIA",9002313.82416,0,0)
9002313.82416
"FIA",9002313.82416,0,1)
y^y^f^^^^n^^
"FIA",9002313.82416,0,10)

"FIA",9002313.82416,0,11)

"FIA",9002313.82416,0,"RLRO")

"FIA",9002313.82416,0,"VR")
1.0^BPS
"FIA",9002313.82416,9002313.82416)
0
"FIA",9002313.82419)
BPS NCPDP FIELD 419
"FIA",9002313.82419,0)
^BPSF(9002313.82419,
"FIA",9002313.82419,0,0)
9002313.82419
"FIA",9002313.82419,0,1)
y^y^f^^^^n^^
"FIA",9002313.82419,0,10)

"FIA",9002313.82419,0,11)

"FIA",9002313.82419,0,"RLRO")

"FIA",9002313.82419,0,"VR")
1.0^BPS
"FIA",9002313.82419,9002313.82419)
0
"FIA",9002313.8242)
BPS NCPDP FIELD 420
"FIA",9002313.8242,0)
^BPSF(9002313.8242,
"FIA",9002313.8242,0,0)
9002313.8242
"FIA",9002313.8242,0,1)
y^y^f^^^^n^^
"FIA",9002313.8242,0,10)

"FIA",9002313.8242,0,11)

"FIA",9002313.8242,0,"RLRO")

"FIA",9002313.8242,0,"VR")
1.0^BPS
"FIA",9002313.8242,9002313.8242)
0
"FIA",9002313.82423)
BPS NCPDP FIELD 423
"FIA",9002313.82423,0)
^BPSF(9002313.82423,
"FIA",9002313.82423,0,0)
9002313.82423
"FIA",9002313.82423,0,1)
y^y^f^^^^n^^
"FIA",9002313.82423,0,10)

"FIA",9002313.82423,0,11)

"FIA",9002313.82423,0,"RLRO")

"FIA",9002313.82423,0,"VR")
1.0^BPS
"FIA",9002313.82423,9002313.82423)
0
"FIA",9002313.82425)
BPS NCPDP FIELD 425
"FIA",9002313.82425,0)
^BPSF(9002313.82425,
"FIA",9002313.82425,0,0)
9002313.82425
"FIA",9002313.82425,0,1)
y^y^f^^^^n^^
"FIA",9002313.82425,0,10)

"FIA",9002313.82425,0,11)

"FIA",9002313.82425,0,"RLRO")

"FIA",9002313.82425,0,"VR")
1.0^BPS
"FIA",9002313.82425,9002313.82425)
0
"FIA",9002313.82429)
BPS NCPDP FIELD 429
"FIA",9002313.82429,0)
^BPSF(9002313.82429,
"FIA",9002313.82429,0,0)
9002313.82429
"FIA",9002313.82429,0,1)
y^y^f^^^^n^^
"FIA",9002313.82429,0,10)

"FIA",9002313.82429,0,11)

"FIA",9002313.82429,0,"RLRO")

"FIA",9002313.82429,0,"VR")
1.0^BPS
"FIA",9002313.82429,9002313.82429)
0
"FIA",9002313.82432)
BPS NCPDP FIELD 432
"FIA",9002313.82432,0)
^BPSF(9002313.82432,
"FIA",9002313.82432,0,0)
9002313.82432
"FIA",9002313.82432,0,1)
y^y^f^^^^n^^
"FIA",9002313.82432,0,10)

"FIA",9002313.82432,0,11)

"FIA",9002313.82432,0,"RLRO")

"FIA",9002313.82432,0,"VR")
1.0^BPS
"FIA",9002313.82432,9002313.82432)
0
"FIA",9002313.82436)
BPS NCPDP FIELD 436
"FIA",9002313.82436,0)
^BPSF(9002313.82436,
"FIA",9002313.82436,0,0)
9002313.82436
"FIA",9002313.82436,0,1)
y^y^f^^^^n^^
"FIA",9002313.82436,0,10)

"FIA",9002313.82436,0,11)

"FIA",9002313.82436,0,"RLRO")

"FIA",9002313.82436,0,"VR")
1.0^BPS
"FIA",9002313.82436,9002313.82436)
0
"FIA",9002313.82439)
BPS NCPDP FIELD 439
"FIA",9002313.82439,0)
^BPSF(9002313.82439,
"FIA",9002313.82439,0,0)
9002313.82439
"FIA",9002313.82439,0,1)
y^y^f^^^^n^^
"FIA",9002313.82439,0,10)

"FIA",9002313.82439,0,11)

"FIA",9002313.82439,0,"RLRO")

"FIA",9002313.82439,0,"VR")
1.0^BPS
"FIA",9002313.82439,9002313.82439)
0
"FIA",9002313.8244)
BPS NCPDP FIELD 440
"FIA",9002313.8244,0)
^BPSF(9002313.8244,
"FIA",9002313.8244,0,0)
9002313.8244
"FIA",9002313.8244,0,1)
y^y^f^^^^n^^
"FIA",9002313.8244,0,10)

"FIA",9002313.8244,0,11)

"FIA",9002313.8244,0,"RLRO")

"FIA",9002313.8244,0,"VR")
1.0^BPS
"FIA",9002313.8244,9002313.8244)
0
"FIA",9002313.82441)
BPS NCPDP FIELD 441
"FIA",9002313.82441,0)
^BPSF(9002313.82441,
"FIA",9002313.82441,0,0)
9002313.82441
"FIA",9002313.82441,0,1)
y^y^f^^^^n^^
"FIA",9002313.82441,0,10)

"FIA",9002313.82441,0,11)

"FIA",9002313.82441,0,"RLRO")

"FIA",9002313.82441,0,"VR")
1.0^BPS
"FIA",9002313.82441,9002313.82441)
0
"FIA",9002313.82501)
BPS NCPDP FIELD 501
"FIA",9002313.82501,0)
^BPSF(9002313.82501,
"FIA",9002313.82501,0,0)
9002313.82501
"FIA",9002313.82501,0,1)
y^y^f^^^^n^^
"FIA",9002313.82501,0,10)

"FIA",9002313.82501,0,11)

"FIA",9002313.82501,0,"RLRO")

"FIA",9002313.82501,0,"VR")
1.0^BPS
"FIA",9002313.82501,9002313.82501)
0
"FIA",9002313.82522)
BPS NCPDP FIELD 522
"FIA",9002313.82522,0)
^BPSF(9002313.82522,
"FIA",9002313.82522,0,0)
9002313.82522
"FIA",9002313.82522,0,1)
y^y^f^^^^n^^
"FIA",9002313.82522,0,10)

"FIA",9002313.82522,0,11)

"FIA",9002313.82522,0,"RLRO")

"FIA",9002313.82522,0,"VR")
1.0^BPS
"FIA",9002313.82522,9002313.82522)
0
"FIA",9002313.82528)
BPS NCPDP FIELD 528
"FIA",9002313.82528,0)
^BPSF(9002313.82528,
"FIA",9002313.82528,0,0)
9002313.82528
"FIA",9002313.82528,0,1)
y^y^f^^^^n^^
"FIA",9002313.82528,0,10)

"FIA",9002313.82528,0,11)

"FIA",9002313.82528,0,"RLRO")

"FIA",9002313.82528,0,"VR")
1.0^BPS
"FIA",9002313.82528,9002313.82528)
0
"FIA",9002313.82529)
BPS NCPDP FIELD 529
"FIA",9002313.82529,0)
^BPSF(9002313.82529,
"FIA",9002313.82529,0,0)
9002313.82529
"FIA",9002313.82529,0,1)
y^y^f^^^^n^^
"FIA",9002313.82529,0,10)

"FIA",9002313.82529,0,11)

"FIA",9002313.82529,0,"RLRO")

"FIA",9002313.82529,0,"VR")
1.0^BPS
"FIA",9002313.82529,9002313.82529)
0
"FIA",9002313.82532)
BPS NCPDP FIELD 532
"FIA",9002313.82532,0)
^BPSF(9002313.82532,
"FIA",9002313.82532,0,0)
9002313.82532
"FIA",9002313.82532,0,1)
y^y^f^^^^n^^
"FIA",9002313.82532,0,10)

"FIA",9002313.82532,0,11)

"FIA",9002313.82532,0,"RLRO")

"FIA",9002313.82532,0,"VR")
1.0^BPS
"FIA",9002313.82532,9002313.82532)
0
"FIA",9002313.82533)
BPS NCPDP FIELD 533
"FIA",9002313.82533,0)
^BPSF(9002313.82533,
"FIA",9002313.82533,0,0)
9002313.82533
"FIA",9002313.82533,0,1)
y^y^f^^^^n^^
"FIA",9002313.82533,0,10)

"FIA",9002313.82533,0,11)

"FIA",9002313.82533,0,"RLRO")

"FIA",9002313.82533,0,"VR")
1.0^BPS
"FIA",9002313.82533,9002313.82533)
0
"FIA",9002313.82535)
BPS NCPDP FIELD 535
"FIA",9002313.82535,0)
^BPSF(9002313.82535,
"FIA",9002313.82535,0,0)
9002313.82535
"FIA",9002313.82535,0,1)
y^y^f^^^^n^^
"FIA",9002313.82535,0,10)

"FIA",9002313.82535,0,11)

"FIA",9002313.82535,0,"RLRO")

"FIA",9002313.82535,0,"VR")
1.0^BPS
"FIA",9002313.82535,9002313.82535)
0
"FIA",9002313.83)
BPS RESULT CATEGORY
"FIA",9002313.83,0)
^BPSF(9002313.83,
"FIA",9002313.83,0,0)
9002313.83
"FIA",9002313.83,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.83,0,10)

"FIA",9002313.83,0,11)

"FIA",9002313.83,0,"RLRO")

"FIA",9002313.83,0,"VR")
1.0^BPS
"FIA",9002313.83,9002313.83)
0
"FIA",9002313.89)
BPS ERROR CODES
"FIA",9002313.89,0)
^BPSF(9002313.89,
"FIA",9002313.89,0,0)
9002313.89
"FIA",9002313.89,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.89,0,10)

"FIA",9002313.89,0,11)

"FIA",9002313.89,0,"RLRO")

"FIA",9002313.89,0,"VR")
1.0^BPS
"FIA",9002313.89,9002313.89)
0
"FIA",9002313.91)
BPS NCPDP FIELD DEFS
"FIA",9002313.91,0)
^BPSF(9002313.91,
"FIA",9002313.91,0,0)
9002313.91I
"FIA",9002313.91,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.91,0,10)

"FIA",9002313.91,0,11)

"FIA",9002313.91,0,"RLRO")

"FIA",9002313.91,0,"VR")
1.0^BPS
"FIA",9002313.91,9002313.91)
0
"FIA",9002313.91,9002313.9101)
0
"FIA",9002313.91,9002313.9102)
0
"FIA",9002313.91,9002313.9103)
0
"FIA",9002313.91,9002313.9104)
0
"FIA",9002313.92)
BPS NCPDP FORMATS
"FIA",9002313.92,0)
^BPSF(9002313.92,
"FIA",9002313.92,0,0)
9002313.92
"FIA",9002313.92,0,1)
y^y^f^^^^n^^
"FIA",9002313.92,0,10)

"FIA",9002313.92,0,11)

"FIA",9002313.92,0,"RLRO")

"FIA",9002313.92,0,"VR")
1.0^BPS
"FIA",9002313.92,9002313.92)
0
"FIA",9002313.92,9002313.9201)
0
"FIA",9002313.92,9002313.92011)
0
"FIA",9002313.92,9002313.92012)
0
"FIA",9002313.92,9002313.9202)
0
"FIA",9002313.92,9002313.92021)
0
"FIA",9002313.92,9002313.92022)
0
"FIA",9002313.92,9002313.9203)
0
"FIA",9002313.92,9002313.92031)
0
"FIA",9002313.92,9002313.92032)
0
"FIA",9002313.92,9002313.9204)
0
"FIA",9002313.92,9002313.92041)
0
"FIA",9002313.92,9002313.92042)
0
"FIA",9002313.92,9002313.9205)
0
"FIA",9002313.92,9002313.92051)
0
"FIA",9002313.92,9002313.92052)
0
"FIA",9002313.92,9002313.9206)
0
"FIA",9002313.92,9002313.92061)
0
"FIA",9002313.92,9002313.92062)
0
"FIA",9002313.92,9002313.9207)
0
"FIA",9002313.92,9002313.92071)
0
"FIA",9002313.92,9002313.92072)
0
"FIA",9002313.92,9002313.9208)
0
"FIA",9002313.92,9002313.92081)
0
"FIA",9002313.92,9002313.92082)
0
"FIA",9002313.92,9002313.9209)
0
"FIA",9002313.92,9002313.92091)
0
"FIA",9002313.92,9002313.92092)
0
"FIA",9002313.92,9002313.921)
0
"FIA",9002313.92,9002313.9211)
0
"FIA",9002313.92,9002313.9212)
0
"FIA",9002313.92,9002313.9213)
0
"FIA",9002313.92,9002313.92131)
0
"FIA",9002313.92,9002313.92132)
0
"FIA",9002313.92,9002313.9214)
0
"FIA",9002313.92,9002313.92141)
0
"FIA",9002313.92,9002313.92142)
0
"FIA",9002313.92,9002313.9215)
0
"FIA",9002313.92,9002313.92151)
0
"FIA",9002313.92,9002313.92152)
0
"FIA",9002313.92,9002313.9216)
0
"FIA",9002313.92,9002313.92161)
0
"FIA",9002313.92,9002313.92162)
0
"FIA",9002313.92,9002313.9217)
0
"FIA",9002313.92,9002313.92171)
0
"FIA",9002313.92,9002313.92172)
0
"FIA",9002313.92,9002313.9218)
0
"FIA",9002313.92,9002313.92181)
0
"FIA",9002313.92,9002313.92182)
0
"FIA",9002313.92,9002313.9219)
0
"FIA",9002313.92,9002313.921901)
0
"FIA",9002313.92,9002313.92191)
0
"FIA",9002313.92,9002313.92192)
0
"FIA",9002313.92,9002313.922)
0
"FIA",9002313.92,9002313.9221)
0
"FIA",9002313.92,9002313.9222)
0
"FIA",9002313.93)
BPS NCPDP REJECT CODES
"FIA",9002313.93,0)
^BPSF(9002313.93,
"FIA",9002313.93,0,0)
9002313.93I
"FIA",9002313.93,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.93,0,10)

"FIA",9002313.93,0,11)

"FIA",9002313.93,0,"RLRO")

"FIA",9002313.93,0,"VR")
1.0^BPS
"FIA",9002313.93,9002313.93)
0
"FIA",9002313.94)
BPS INSURANCE RULES
"FIA",9002313.94,0)
^BPSF(9002313.94,
"FIA",9002313.94,0,0)
9002313.94
"FIA",9002313.94,0,1)
y^y^f^^^^n
"FIA",9002313.94,0,10)

"FIA",9002313.94,0,11)

"FIA",9002313.94,0,"RLRO")

"FIA",9002313.94,0,"VR")
1.0^BPS
"FIA",9002313.94,9002313.94)
0
"FIA",9002313.94,9002313.941)
0
"FIA",9002313.99)
BPS SETUP
"FIA",9002313.99,0)
^BPS(9002313.99,
"FIA",9002313.99,0,0)
9002313.99
"FIA",9002313.99,0,1)
y^n^f^^^^n^^
"FIA",9002313.99,0,10)

"FIA",9002313.99,0,11)

"FIA",9002313.99,0,"RLRO")

"FIA",9002313.99,0,"VR")
1.0^BPS
"FIA",9002313.99,9002313.99)
0
"FIA",9002313.99,9002313.9901)
0
"FIA",9002313.99,9002313.9902)
0
"FIA",9002313.99,9002313.9903)
0
"FIA",9002313.99,9002313.9904)
0
"FIA",9002313.99,9002313.9905)
0
"FIA",9002313.99,9002313.992271)
0
"FIA",9002313.99,9002313.992273)
0
"FIA",9002313.99,9002313.992274)
0
"FIA",9002313.99,9002313.992279)
0
"FIA",9002313.99,9002313.992388)
0
"FIA",9002313.99,9002313.992389)
0
"INI")
EN^BPS01P1
"INIT")
EN^BPS03P1
"KRN",.4,12355,-1)
0^6
"KRN",.4,12355,0)
BPS GRACE^3000728.0418^^9002313.4^^@^3000814
"KRN",.4,12355,"F",2)
0~.01~100.08~
"KRN",.4,12355,"H")
Insurers with specific grace periods
"KRN",.4,12356,-1)
0^15
"KRN",.4,12356,0)
BPS PREBILL^3000728.042^^9002313.4^^@^3000728
"KRN",.4,12356,"F",2)
0~.01~105.01~105.02~
"KRN",.4,12356,"H")
Insurers with specific prebilling rules
"KRN",.4,12357,-1)
0^11
"KRN",.4,12357,0)
BPS NCPDP^3000728.0422^^9002313.4^^@^3050413
"KRN",.4,12357,"F",2)
0;L5~.01;L30~100.09;"PRINT DRUG NAME"~100.11;"PRINT DIAGNOSIS"~100.12;"PHARM # TO USE"~100.13;"PRINT TAX ID #"~
"KRN",.4,12357,"H")
Insurers with specific NCPDP form settings
"KRN",.4,12358,-1)
0^16
"KRN",.4,12358,0)
BPS PRICING TABLES^3001026.0659^^9002313.53^^@^3050330
"KRN",.4,12358,"F",1)
.01;L20~0;L5~
"KRN",.4,12358,"F",2)
S DIP(1)=$S($D(^BPS(9002313.53,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2),X=X W X K DIP;"UNIT PRICE SOURCE";L12;Z;"INTERNAL(UNIT PRICE SOURCE)"~.03;L10~
"KRN",.4,12358,"F",3)
.04;"MULT BY";R8D5~.05;"DISP FEE";R5D2~.99;"IN USE";L5~
"KRN",.4,12358,"H")
PRICING TABLES LIST
"KRN",.4,12359,-1)
0^29
"KRN",.4,12359,0)
BPS USER PREFERENCES^3000830.1023^^9002313.515^^@^3050708
"KRN",.4,12359,"F",1)
.01;L20;"NAME"~.02;L20;"first, Copy of"~1.01;L3;"Ask INS"~1.02;L3;"Ask PREAUTH"~1.03;L3;"Ask PRICING"~1.04;L3;"Ask FILL DATE"~100.01;L3;"DEF. NDC"~
"KRN",.4,12359,"F",2)
.03;L3;"Old- style Input"~
"KRN",.4,12359,"H")
RX ECME USER PREFERENCES
"KRN",.4,12360,-1)
0^9
"KRN",.4,12360,0)
BPS INSURERS^3001026.0707^^9002313.4^^@^3050329
"KRN",.4,12360,"F",2)
.01;"Insurer"~100.06;L20;"Pricing Formula"~100.02;R8D2;"Disp Fee Override"~100.08;"Grace Per Override"~104.01;"Ins. Sel. Pts.";R4~
"KRN",.4,12360,"H")
PHARMACY ELECTRONIC CLAIMS INSURERS
"KRN",.4,12361,-1)
0^27
"KRN",.4,12361,0)
BPS UN/BILLABLE^3001016.0915^@^9002313.4^^@^3001020
"KRN",.4,12361,"F",2)
2128.13~2128.11,.01~228.11,.01~2128.12,.01~228.12,.01~
"KRN",.4,12361,"H")
INSURER-SPECIFIC SETTINGS FOR UN/BILLABLE ITEMS
"KRN",.4,12362,-1)
0^30
"KRN",.4,12362,0)
BPS WORKERS COMP^3001016.0928^@^9002313.4^^@^3001016
"KRN",.4,12362,"F",2)
0~.01~
"KRN",.4,12362,"H")
INSURERS WITH WORKERS COMP SETTINGS
"KRN",.4,12364,-1)
0^8
"KRN",.4,12364,0)
BPS INSURANCE RULES IN-USE^3001020.0755^@^9002313.99^^@^3030717
"KRN",.4,12364,"DXS",1,9.2)
S I(100)="^BPSF(9002313.94,",J(100)=9002313.94 F D=0:0 S (D,D1)=$O(^BPSF(9002313.94,D0,1,D)) Q:D'>0  I $D(^(D,0))#2 S X=^(0) X DICMX Q:'$D(D)  S D=D1
"KRN",.4,12364,"DXS",1,9.3)
S I(1,0)=$S($D(D1):D1,1:""),I(0,0)=$S($D(D0):D0,1:""),DIP(1)=$S($D(^BPS(9002313.99,D0,"INS RULES",D1,0)):^(0),1:"")
"KRN",.4,12364,"F",1)
970.01,.01;"ORDER"~970.01,.02;"NAME"~
"KRN",.4,12364,"F",2)
970.01,X DXS(1,9.3) S D0=$P(DIP(1),U,2) S:'$D(^BPSF(9002313.94,+D0,0)) D0=-1 X DXS(1,9.2):D0>0 S X="" S D0=I(0,0) S D1=I(1,0) W X K DIP;"DESCRIPTION";Z;"INS RULE NAME:DESCRIPTION";m;w~
"KRN",.4,12364,"H")
INSURANCE SELECTION RULES IN USE NOW
"KRN",.4,12365,-1)
0^7
"KRN",.4,12365,0)
BPS INSURANCE RULES AVAIL^3001020.0759^@^9002313.94^^@^3030717
"KRN",.4,12365,"F",2)
.01~1,.01~
"KRN",.4,12365,"H")
All of the available INSURANCE SELECTION RULES
"KRN",.4,12378,-1)
0^25
"KRN",.4,12378,0)
BPS TECH - FILES^3010409.1144^@^1^^@^3050413
"KRN",.4,12378,"F",2)
0;L13~1;L27~.01;L32~4,.01;C5~
"KRN",.4,12378,"H")
BPS FILES
"KRN",.4,12379,-1)
0^26
"KRN",.4,12379,0)
BPS TECH - OPTIONS^3010205.0736^@^19^^@^3050413
"KRN",.4,12379,"F",2)
.01;L30~1;L40~3.5,.01;C1~"";S~
"KRN",.4,12379,"H")
BPS OPTIONS
"KRN",.4,13058,-1)
1^1
"KRN",.4,13058,0)
BPS CAPTURED DETAIL    FILE #9002313.61
"KRN",.4,13059,-1)
1^2
"KRN",.4,13059,0)
BPS CLOSED CLAIMS    FILE #9002313.02
"KRN",.4,13060,-1)
1^3
"KRN",.4,13060,0)
BPS CLOSED CLAIMS DETAIL    FILE #9002313.61
"KRN",.4,13061,-1)
1^4
"KRN",.4,13061,0)
BPS DUPLICATE DETAIL    FILE #9002313.61
"KRN",.4,13062,-1)
1^5
"KRN",.4,13062,0)
BPS FORMATS    FILE #9002313.92
"KRN",.4,13063,-1)
1^10
"KRN",.4,13063,0)
BPS MISSED PRESCRIPTIONS    FILE #9002313.61
"KRN",.4,13064,-1)
1^12
"KRN",.4,13064,0)
BPS NCPDP FIELDS    FILE #9002313.91
"KRN",.4,13065,-1)
1^13
"KRN",.4,13065,0)
BPS PAPER DETAIL    FILE #9002313.61
"KRN",.4,13066,-1)
1^14
"KRN",.4,13066,0)
BPS PAYABLE DETAIL    FILE #9002313.61
"KRN",.4,13067,-1)
1^17
"KRN",.4,13067,0)
BPS RECENT TRANSACTIONS    FILE #9002313.57
"KRN",.4,13068,-1)
1^18
"KRN",.4,13068,0)
BPS REJECTION DETAIL    FILE #9002313.61
"KRN",.4,13069,-1)
1^19
"KRN",.4,13069,0)
BPS RPT MISSED HEADER    FILE #9002313.61
"KRN",.4,13070,-1)
1^20
"KRN",.4,13070,0)
BPS RPT NEED REVERSAL DETAIL    FILE #9002313.61
"KRN",.4,13071,-1)
1^21
"KRN",.4,13071,0)
BPS RPT NEED REVERSAL HEADER    FILE #9002313.61
"KRN",.4,13072,-1)
1^22
"KRN",.4,13072,0)
BPS RPT TOTALS DETAIL    FILE #9002313.61
"KRN",.4,13073,-1)
1^23
"KRN",.4,13073,0)
BPS RPT TOTALS HEADER    FILE #9002313.61
"KRN",.4,13074,-1)
1^24
"KRN",.4,13074,0)
BPS STRANDED CLAIMS    FILE #9002313.59
"KRN",.4,13075,-1)
1^28
"KRN",.4,13075,0)
BPS UNINSURED DETAIL    FILE #9002313.61
"KRN",.4,13076,-1)
1^31
"KRN",.4,13076,0)
BPS NOTREL DETAIL    FILE #9002313.61
"KRN",.401,13534,-1)
0^5
"KRN",.401,13534,0)
BPS GRACE^3000727.0624^@^9002313.4^^@^3000814
"KRN",.401,13534,2,0)
^.4014^2^2
"KRN",.401,13534,2,1,0)
9002313.4^^NAME^".01^^^^^^4
"KRN",.401,13534,2,1,"CM")
S Y(1)=$S($D(^BPSEI(D0,0)):^(0),1:"") S X=$S('$D(^AUTNINS(+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(1)=X
"KRN",.401,13534,2,1,"GET")
S Y(1)=$S($D(^BPSEI(D0,0)):^(0),1:"") S X=$S('$D(^AUTNINS(+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(1)=X
"KRN",.401,13534,2,1,"IX")
^BPSEI("B",^BPSEI(^2
"KRN",.401,13534,2,1,"PTRIX")
^AUTNINS("B",
"KRN",.401,13534,2,1,"QCON")
I DISX(1)'=""
"KRN",.401,13534,2,1,"SER")
0.4286^0.4286
"KRN",.401,13534,2,1,"TXT")
NAME not null
"KRN",.401,13534,2,2,0)
9002313.4^100.08^GRACE PERIOD^^^^^^^2
"KRN",.401,13534,2,2,"GET")
S DISX(2)=$P($G(^BPSEI(D0,100)),U,8) S:DISX(2)]"" DISX(2)=+DISX(2)
"KRN",.401,13534,2,2,"QCON")
I DISX(2)'=""
"KRN",.401,13534,2,2,"SER")
1.0000^1.0000
"KRN",.401,13534,2,2,"TXT")
GRACE PERIOD not null
"KRN",.401,13534,2,"B",9002313.4,1)

"KRN",.401,13534,2,"B",9002313.4,2)

"KRN",.401,13534,"%D",0)
^^1^1^3000727^
"KRN",.401,13534,"%D",1,0)
For use in the BPSOSS1 report - insurers with non-default grace periods.
"KRN",.401,13535,-1)
0^21
"KRN",.401,13535,0)
BPS PREBILL^3000727.1443^^9002313.4^^@^3000728
"KRN",.401,13535,2,0)
^.4014^1^1
"KRN",.401,13535,2,1,0)
9002313.4^105.99^PREBILL - ANY SET^@^^^^^^4
"KRN",.401,13535,2,1,"F")
.99999^1
"KRN",.401,13535,2,1,"GET")
S X=$G(^BPSEI(D0,100))'?."^" S DISX(1)=X
"KRN",.401,13535,2,1,"QCON")
I DISX(1)=1
"KRN",.401,13535,2,1,"T")
1^1
"KRN",.401,13535,2,1,"TXT")
PREBILL - ANY SET equals 1
"KRN",.401,13535,2,"B",9002313.4,1)

"KRN",.401,13536,-1)
0^10
"KRN",.401,13536,0)
BPS NCPDP^3000727.1323^^9002313.4^^@^3050413
"KRN",.401,13536,2,0)
^.4014^1^1
"KRN",.401,13536,2,1,0)
9002313.4^100.99^NCPDP FORM - ANY SET^@^^^^^^4
"KRN",.401,13536,2,1,"F")
.99999^1
"KRN",.401,13536,2,1,"GET")
S X=($P($G(^BPSEI(D0,100)),U,9,13)'?."^") S DISX(1)=X
"KRN",.401,13536,2,1,"QCON")
I DISX(1)=1
"KRN",.401,13536,2,1,"T")
1^1
"KRN",.401,13536,2,1,"TXT")
NCPDP FORM - ANY SET equals 1
"KRN",.401,13536,2,"B",9002313.4,1)

"KRN",.401,13537,-1)
0^22
"KRN",.401,13537,0)
BPS PRICING TABLES^3001025.0354^@^9002313.53^^@^3050407
"KRN",.401,13537,2,0)
^.4014^2^2
"KRN",.401,13537,2,1,0)
9002313.53^.99^IN USE BY ANY INSURERS^@-^^^^^^4
"KRN",.401,13537,2,1,"GET")
S X=$D(^BPSEI("APricing",D0))>0 S DISX(1)=X
"KRN",.401,13537,2,1,"QCON")
I DISX(1)'=""
"KRN",.401,13537,2,1,"TXT")
IN USE BY ANY INSURERS not null
"KRN",.401,13537,2,2,0)
9002313.53^.01^NAME^@^^^^^^4
"KRN",.401,13537,2,2,"GET")
S DISX(2)=$P($G(^BPS(9002313.53,D0,0)),U)
"KRN",.401,13537,2,2,"IX")
^BPS(9002313.53,"B",^BPS(9002313.53,^2
"KRN",.401,13537,2,2,"QCON")
I DISX(2)'=""
"KRN",.401,13537,2,2,"TXT")
NAME not null
"KRN",.401,13537,2,"B",9002313.53,1)

"KRN",.401,13537,2,"B",9002313.53,2)

"KRN",.401,13538,-1)
0^42
"KRN",.401,13538,0)
BPS USER PREFERENCES^3000728.0937^@^9002313.515^^@^3050708
"KRN",.401,13538,2,0)
^.4014^1^1
"KRN",.401,13538,2,1,0)
9002313.515^^USER^".01^;"for "^^^^^4
"KRN",.401,13538,2,1,"CM")
S Y(1)=$S($D(^BPS(9002313.515,D0,0)):^(0),1:"") S X=$S('$D(^VA(200,+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(1)=X
"KRN",.401,13538,2,1,"GET")
S Y(1)=$S($D(^BPS(9002313.515,D0,0)):^(0),1:"") S X=$S('$D(^VA(200,+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(1)=X
"KRN",.401,13538,2,1,"IX")
^BPS(9002313.515,"B",^BPS(9002313.515,^2
"KRN",.401,13538,2,1,"PTRIX")
^VA(200,"B",
"KRN",.401,13538,2,1,"QCON")
I DISX(1)'=""
"KRN",.401,13538,2,1,"SER")
0.0000^0.0000
"KRN",.401,13538,2,1,"TXT")
USER not null
"KRN",.401,13538,2,"B",9002313.515,1)

"KRN",.401,13539,-1)
0^8
"KRN",.401,13539,0)
BPS INSURERS^3001026.0705^^9002313.4^^@^3050330
"KRN",.401,13539,2,0)
^.4014^2^2
"KRN",.401,13539,2,1,0)
9002313.4^100.97^RX - DIAL OUT TO, RESOLVED^^;"=====   DIAL OUT to: "^^^^^4
"KRN",.401,13539,2,1,"GET")
S X=$P($G(^BPSEI(D0,100)),U,7) S:X="" X=$P($G(^BPS(9002313.99,1,"DIAL-OUT DEFAULT")),U) S:X X=$P($G(^BPS(9002313.55,X,0)),U) S DISX(1)=X
"KRN",.401,13539,2,1,"QCON")
I DISX(1)'=""
"KRN",.401,13539,2,1,"TXT")
RX - DIAL OUT TO, RESOLVED not null
"KRN",.401,13539,2,2,0)
9002313.4^^RX - NCPDP Record Format^"100.01^;"----- Using electronic FORMAT: "^^^^^4
"KRN",.401,13539,2,2,"CM")
S Y(1)=$S($D(^BPSEI(D0,100)):^(100),1:"") S X=$S('$D(^BPSF(9002313.92,+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(2)=X
"KRN",.401,13539,2,2,"GET")
S Y(1)=$S($D(^BPSEI(D0,100)):^(100),1:"") S X=$S('$D(^BPSF(9002313.92,+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(2)=X
"KRN",.401,13539,2,2,"IX")
^BPSEI("AFormat",^BPSEI(^2
"KRN",.401,13539,2,2,"PTRIX")
^BPSF(9002313.92,"B",
"KRN",.401,13539,2,2,"QCON")
I DISX(2)'=""
"KRN",.401,13539,2,2,"TXT")
RX - NCPDP Record Format not null
"KRN",.401,13539,2,"B",9002313.4,1)

"KRN",.401,13539,2,"B",9002313.4,2)

"KRN",.401,13539,"%D",0)
^^1^1^3001026^^^
"KRN",.401,13539,"%D",1,0)
List of currently in-use insurers for pharm electronic claims.
"KRN",.401,13540,-1)
0^40
"KRN",.401,13540,0)
BPS UN/BILLABLE^3001016.0914^@^9002313.4^^@^3001020
"KRN",.401,13540,2,0)
^.4014^2^2
"KRN",.401,13540,2,1,0)
9002313.4^2128.99^ANY UN/BILLABLES SET^@^^^^^^2
"KRN",.401,13540,2,1,"F")
.99999^1
"KRN",.401,13540,2,1,"GET")
S X=$$ANYSET^BPSOSQQ(D0) S DISX(1)=X S:DISX(1)]"" DISX(1)=+DISX(1)
"KRN",.401,13540,2,1,"QCON")
I DISX(1)=1
"KRN",.401,13540,2,1,"SER")
0.9286^0.9286
"KRN",.401,13540,2,1,"T")
1^1
"KRN",.401,13540,2,1,"TXT")
ANY UN/BILLABLES SET equals 1
"KRN",.401,13540,2,2,0)
9002313.4^^NAME^".01^^^^^^4
"KRN",.401,13540,2,2,"CM")
S Y(1)=$S($D(^BPSEI(D0,0)):^(0),1:"") S X=$S('$D(^AUTNINS(+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(2)=X
"KRN",.401,13540,2,2,"GET")
S Y(1)=$S($D(^BPSEI(D0,0)):^(0),1:"") S X=$S('$D(^AUTNINS(+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(2)=X
"KRN",.401,13540,2,2,"IX")
^BPSEI("B",^BPSEI(^2
"KRN",.401,13540,2,2,"PTRIX")
^AUTNINS("B",
"KRN",.401,13540,2,2,"QCON")
I DISX(2)'=""
"KRN",.401,13540,2,2,"SER")
0.4286^0.4286
"KRN",.401,13540,2,2,"TXT")
NAME not null
"KRN",.401,13540,2,"B",9002313.4,1)

"KRN",.401,13540,2,"B",9002313.4,2)

"KRN",.401,13540,"%D",0)
^^1^1^3001016^
"KRN",.401,13540,"%D",1,0)
Insurer-specific settings for un/billable items.
"KRN",.401,13541,-1)
0^43
"KRN",.401,13541,0)
BPS WORKERS COMP^3001016.0928^@^9002313.4^^@^3001016
"KRN",.401,13541,2,0)
^.4014^2^2
"KRN",.401,13541,2,1,0)
9002313.4^107.01^WORKERS COMP INSURANCE^^^^^^^3
"KRN",.401,13541,2,1,"GET")
S DISX(1)=$P($G(^BPSEI(D0,107)),U)
"KRN",.401,13541,2,1,"QCON")
I DISX(1)'=""
"KRN",.401,13541,2,1,"SER")
1.0000^1.0000
"KRN",.401,13541,2,1,"TXT")
WORKERS COMP INSURANCE not null
"KRN",.401,13541,2,2,0)
9002313.4^^NAME^".01^^^^^^4
"KRN",.401,13541,2,2,"CM")
S Y(1)=$S($D(^BPSEI(D0,0)):^(0),1:"") S X=$S('$D(^AUTNINS(+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(2)=X
"KRN",.401,13541,2,2,"GET")
S Y(1)=$S($D(^BPSEI(D0,0)):^(0),1:"") S X=$S('$D(^AUTNINS(+$P(Y(1),U,1),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(2)=X
"KRN",.401,13541,2,2,"IX")
^BPSEI("B",^BPSEI(^2
"KRN",.401,13541,2,2,"PTRIX")
^AUTNINS("B",
"KRN",.401,13541,2,2,"QCON")
I DISX(2)'=""
"KRN",.401,13541,2,2,"SER")
0.4286^0.4286
"KRN",.401,13541,2,2,"TXT")
NAME not null
"KRN",.401,13541,2,"B",9002313.4,1)

"KRN",.401,13541,2,"B",9002313.4,2)

"KRN",.401,13543,-1)
0^7
"KRN",.401,13543,0)
BPS INSURANCE RULES IN-USE^3001020.0752^@^9002313.99^^@^3030717
"KRN",.401,13543,2,0)
^.4014^1^1
"KRN",.401,13543,2,1,0)
9002313.99^.01^NAME^@^^^^^^4
"KRN",.401,13543,2,1,"GET")
S DISX(1)=$P($G(^BPS(9002313.99,D0,0)),U)
"KRN",.401,13543,2,1,"IX")
^BPS(9002313.99,"B",^BPS(9002313.99,^2
"KRN",.401,13543,2,1,"QCON")
I DISX(1)'=""
"KRN",.401,13543,2,1,"TXT")
NAME not null
"KRN",.401,13543,2,"B",9002313.99,1)

"KRN",.401,13544,-1)
0^6
"KRN",.401,13544,0)
BPS INSURANCE RULES AVAIL^3001020.0757^@^9002313.94^^@^3030717
"KRN",.401,13544,2,0)
^.4014^1^1
"KRN",.401,13544,2,1,0)
9002313.94^.01^NAME^@^^^^^^4
"KRN",.401,13544,2,1,"GET")
S DISX(1)=$P($G(^BPSF(9002313.94,D0,0)),U)
"KRN",.401,13544,2,1,"IX")
^BPSF(9002313.94,"B",^BPSF(9002313.94,^2
"KRN",.401,13544,2,1,"QCON")
I DISX(1)'=""
"KRN",.401,13544,2,1,"TXT")
NAME not null
"KRN",.401,13544,2,"B",9002313.94,1)

"KRN",.401,13544,"%D",0)
^^1^1^3001020^
"KRN",.401,13544,"%D",1,0)
Print all the available rules.
"KRN",.401,13548,-1)
0^35
"KRN",.401,13548,0)
BPS SETUP PHARMACIES^3010102.0843^@^9002313.56^^@^3060306
"KRN",.401,13548,2,0)
^.4014^1^1
"KRN",.401,13548,2,1,0)
9002313.56^0^NUMBER^^^^^^^2
"KRN",.401,13548,2,1,"IX")
^BPS(9002313.56,^BPS(9002313.56,^1
"KRN",.401,13548,2,1,"QCON")
I D0'=""
"KRN",.401,13548,2,1,"TXT")
NUMBER not null
"KRN",.401,13548,2,"B",9002313.56,1)

"KRN",.401,13559,-1)
0^1
"KRN",.401,13559,0)
BPS TECH - FILES^3010409.1142^@^1^^@^3050413
"KRN",.401,13559,2,0)
^.4014^1^1
"KRN",.401,13559,2,1,0)
1^0^NUMBER^^^^^^^2
"KRN",.401,13559,2,1,"F")
9002312.99999^9002313
"KRN",.401,13559,2,1,"IX")
^DIC(^DIC(^1
"KRN",.401,13559,2,1,"QCON")
I (D0]]9002312.99999)&(D0']]9002313.999999)
"KRN",.401,13559,2,1,"T")
9002313.999999^9002313.999999
"KRN",.401,13559,2,1,"TXT")
NUMBER from 9002313 to 9002313.999999
"KRN",.401,13559,2,"B",1,1)

"KRN",.401,13559,"%D",0)
^^1^1^3010409^^^
"KRN",.401,13559,"%D",1,0)
Technical Manual - Files section
"KRN",.401,13560,-1)
0^37
"KRN",.401,13560,0)
BPS TECH - OPTIONS^3010205.0832^@^19^^@^3050413
"KRN",.401,13560,2,0)
^.4014^2^2
"KRN",.401,13560,2,1,0)
19^.01^NAME^^^^^^^4
"KRN",.401,13560,2,1,"F")
ABSOz^BPS
"KRN",.401,13560,2,1,"GET")
S DISX(1)=$P($G(^DIC(19,D0,0)),U)
"KRN",.401,13560,2,1,"IX")
^DIC(19,"B",^DIC(19,^2
"KRN",.401,13560,2,1,"QCON")
I (DISX(1)]]"ABSOz")&(DISX(1)']]"BPSZZZZZZZZZZZZZ")
"KRN",.401,13560,2,1,"SER")
49.5000^0.9802
"KRN",.401,13560,2,1,"T")
BPSZZZZZZZZZZZZZ^BPSZZZZZZZZZZZZZ
"KRN",.401,13560,2,1,"TXT")
NAME from BPS to BPSZZZZZZZZZZZZZ
"KRN",.401,13560,2,2,0)
19^^PACKAGE^@"12^^^^^^4
"KRN",.401,13560,2,2,"CM")
S Y(1)=$S($D(^DIC(19,D0,0)):^(0),1:"") S X=$S('$D(^DIC(9.4,+$P(Y(1),U,12),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(2)=X
"KRN",.401,13560,2,2,"F")
?z^@
"KRN",.401,13560,2,2,"GET")
S Y(1)=$S($D(^DIC(19,D0,0)):^(0),1:"") S X=$S('$D(^DIC(9.4,+$P(Y(1),U,12),0)):"",1:$P(^(0),U,1)) I D0>0 S DISX(2)=X
"KRN",.401,13560,2,2,"QCON")
I 1
"KRN",.401,13560,2,2,"T")
z^
"KRN",.401,13560,2,2,"TXT")
All PACKAGE (includes nulls)
"KRN",.401,13560,2,"B",19,1)

"KRN",.401,13560,2,"B",19,2)

"KRN",.401,13560,"%D",0)
^^1^1^3010205^^^^
"KRN",.401,13560,"%D",1,0)
List options and descriptions - for Technical Manual.
"KRN",.401,14574,-1)
1^2
"KRN",.401,14574,0)
BPS CAPTURED    FILE #9002313.61
"KRN",.401,14575,-1)
1^3
"KRN",.401,14575,0)
BPS DUPLICATE    FILE #9002313.61
"KRN",.401,14576,-1)
1^4
"KRN",.401,14576,0)
BPS FORMATS    FILE #9002313.92
"KRN",.401,14577,-1)
1^9
"KRN",.401,14577,0)
BPS MISSED PRESCRIPTIONS    FILE #9002313.61
"KRN",.401,14578,-1)
1^11
"KRN",.401,14578,0)
BPS NCPDP FIELDS    FILE #9002313.91
"KRN",.401,14579,-1)
1^12
"KRN",.401,14579,0)
BPS NEED REVERSAL    FILE #9002313.61
"KRN",.401,14580,-1)
1^13
"KRN",.401,14580,0)
BPS NOT REL    FILE #9002313.61
"KRN",.401,14581,-1)
1^14
"KRN",.401,14581,0)
BPS PAPER    FILE #9002313.61
"KRN",.401,14582,-1)
1^15
"KRN",.401,14582,0)
BPS PAY FILL    FILE #9002313.61
"KRN",.401,14583,-1)
1^16
"KRN",.401,14583,0)
BPS PAY ISSUE    FILE #9002313.61
"KRN",.401,14584,-1)
1^17
"KRN",.401,14584,0)
BPS PAY LABEL    FILE #9002313.61
"KRN",.401,14585,-1)
1^18
"KRN",.401,14585,0)
BPS PAY REL    FILE #9002313.61
"KRN",.401,14586,-1)
1^19
"KRN",.401,14586,0)
BPS PAY TRAN    FILE #9002313.61
"KRN",.401,14587,-1)
1^20
"KRN",.401,14587,0)
BPS PAYABLE    FILE #9002313.61
"KRN",.401,14588,-1)
1^23
"KRN",.401,14588,0)
BPS RECENT TRANSACTIONS    FILE #9002313.57
"KRN",.401,14589,-1)
1^24
"KRN",.401,14589,0)
BPS REJ FILL    FILE #9002313.61
"KRN",.401,14590,-1)
1^25
"KRN",.401,14590,0)
BPS REJ ISSUE    FILE #9002313.61
"KRN",.401,14591,-1)
1^26
"KRN",.401,14591,0)
BPS REJ LABEL    FILE #9002313.61
"KRN",.401,14592,-1)
1^27
"KRN",.401,14592,0)
BPS REJ REL    FILE #9002313.61
"KRN",.401,14593,-1)
1^28
"KRN",.401,14593,0)
BPS REJ TRANS    FILE #9002313.61
"KRN",.401,14594,-1)
1^29
"KRN",.401,14594,0)
BPS REJECTION    FILE #9002313.61
"KRN",.401,14595,-1)
1^30
"KRN",.401,14595,0)
BPS REV FILL    FILE #9002313.61
"KRN",.401,14596,-1)
1^31
"KRN",.401,14596,0)
BPS REV ISSUE    FILE #9002313.61
"KRN",.401,14597,-1)
1^32
"KRN",.401,14597,0)
BPS REV LABEL    FILE #9002313.61
"KRN",.401,14598,-1)
1^33
"KRN",.401,14598,0)
BPS REV REL    FILE #9002313.61
"KRN",.401,14599,-1)
1^34
"KRN",.401,14599,0)
BPS REV TRAN    FILE #9002313.61
"KRN",.401,14600,-1)
1^36
"KRN",.401,14600,0)
BPS STRANDED CLAIMS    FILE #9002313.59
"KRN",.401,14601,-1)
1^38
"KRN",.401,14601,0)
BPS TOTALS BY DAY    FILE #9002313.61
"KRN",.401,14602,-1)
1^39
"KRN",.401,14602,0)
BPS TOTALS BY INSURER    FILE #9002313.61
"KRN",.401,14603,-1)
1^41
"KRN",.401,14603,0)
BPS UNINSURED    FILE #9002313.61
"KRN",.402,4071,-1)
0^13
"KRN",.402,4071,0)
BPSJ CONTACT ENTER/EDIT^3031215.1702^^9002313.99^^^3060228.141135
"KRN",.402,4071,"DIAB",2,0,9002313.99,0)
6000:
"KRN",.402,4071,"DR",1,9002313.99)
6000;^200^VA(200,^^S I(0,0)=D0 S Y(1)=$S($D(^BPS(9002313.99,D0,"VITRIA")):^("VITRIA"),1:"") S X=$P(Y(1),U,1),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,4071,"DR",2,200)
.132;.151;
"KRN",.402,4072,-1)
0^12
"KRN",.402,4072,0)
BPSJ ALT CONTACT ENTER/EDIT^3031216.1448^@^9002313.99^^@^3060228.141135
"KRN",.402,4072,"DIAB",2,0,9002313.99,0)
6001:
"KRN",.402,4072,"DR",1,9002313.99)
6001;^200^VA(200,^^S I(0,0)=D0 S Y(1)=$S($D(^BPS(9002313.99,D0,"VITRIA")):^("VITRIA"),1:"") S X=$P(Y(1),U,2),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,4072,"DR",2,200)
.132;.151;
"KRN",.402,4073,-1)
0^17
"KRN",.402,4073,0)
BPSJ PHARMACY SITE ENTER/EDIT^3040524.1745^@^9002313.56^^@^3060130
"KRN",.402,4073,"DR",1,9002313.56)
.01;.02;.03;120.03;120.01;120.02;102.03;120.04;120.05;130.01;130.02;130.03;130.6;130.07;130.08;
"KRN",.402,4074,-1)
0^15
"KRN",.402,4074,0)
BPSJ PHARM CONTACT ENTER/EDIT^3040323.1605^@^9002313.56^^@^3060130
"KRN",.402,4074,"DIAB",2,0,9002313.56,0)
1900.01:
"KRN",.402,4074,"DR",1,9002313.56)
1900.01;^200^VA(200,^^S I(0,0)=D0 S Y(1)=$S($D(^BPS(9002313.56,D0,"REP")):^("REP"),1:"") S X=$P(Y(1),U,3),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,4074,"DR",2,200)
8;.132;.151;
"KRN",.402,4075,-1)
0^14
"KRN",.402,4075,0)
BPSJ PHARM ALT CONT ENTER/EDIT^3040420.1437^@^9002313.56^^@^3060130
"KRN",.402,4075,"DIAB",2,0,9002313.56,0)
1900.02:
"KRN",.402,4075,"DR",1,9002313.56)
1900.02;^200^VA(200,^^S I(0,0)=D0 S Y(1)=$S($D(^BPS(9002313.56,D0,"REP")):^("REP"),1:"") S X=$P(Y(1),U,4),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,4075,"DR",2,200)
8;.132;.151;
"KRN",.402,4095,-1)
0^16
"KRN",.402,4095,0)
BPSJ PHARMACIST ENTER/EDIT^3040608.1404^@^9002313.56^^@^3060130
"KRN",.402,4095,"DIAB",2,0,9002313.56,0)
1900.03:
"KRN",.402,4095,"DR",1,9002313.56)
1900.03;^200^VA(200,^^S I(0,0)=D0 S Y(1)=$S($D(^BPS(9002313.56,D0,"REP")):^("REP"),1:"") S X=$P(Y(1),U,5),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,4095,"DR",2,200)
8;
"KRN",.402,4128,-1)
1^1
"KRN",.402,4128,0)
BPS SETUP ILC AR    FILE #9002313.99
"KRN",.402,4129,-1)
1^2
"KRN",.402,4129,0)
BPS NCPDP FORMATS    FILE #9002313.92
"KRN",.402,4130,-1)
1^3
"KRN",.402,4130,0)
BPS NCPDP FORMATS EDIT    FILE #9002313.92
"KRN",.402,4131,-1)
1^4
"KRN",.402,4131,0)
BPS PROVIDER #S    FILE #200
"KRN",.402,4132,-1)
1^5
"KRN",.402,4132,0)
BPS SETUP INSURER    FILE #9002313.4
"KRN",.402,4133,-1)
1^6
"KRN",.402,4133,0)
BPS SETUP INSURER QUICK    FILE #9002313.4
"KRN",.402,4134,-1)
1^7
"KRN",.402,4134,0)
BPS SETUP OKLA. MEDICAID    FILE #9002313.99
"KRN",.402,4135,-1)
1^8
"KRN",.402,4135,0)
BPS SETUP PART 1    FILE #9002313.99
"KRN",.402,4136,-1)
1^10
"KRN",.402,4136,0)
BPS SETUP PRICING    FILE #9002313.53
"KRN",.402,4137,-1)
1^11
"KRN",.402,4137,0)
BPS SETUP USERS    FILE #9002313.515
"KRN",.402,4138,-1)
1^18
"KRN",.402,4138,0)
BPS SETUP PHARMACY    FILE #9002313.56
"KRN",.403,243,-1)
0^2
"KRN",.403,243,0)
BPS EOB TO BATCH^@^@^^3000504.1306^^^9002313.99^0^0^1
"KRN",.403,243,40,0)
^.4031I^1^1
"KRN",.403,243,40,1,0)
1^^1,1
"KRN",.403,243,40,1,1)
Page 1
"KRN",.403,243,40,1,40,0)
^.4032IP^764^1
"KRN",.403,243,40,1,40,764,0)
BPS EOB TO BATCH 1^1^1,1^e
"KRN",.403,244,-1)
0^1
"KRN",.403,244,0)
BPS BPSOSPW^@^@^^3000509.1135^^^9002313.99^0^0^1
"KRN",.403,244,40,0)
^.4031I^1^1
"KRN",.403,244,40,1,0)
1^^1,1
"KRN",.403,244,40,1,1)
Page 1
"KRN",.403,244,40,1,40,0)
^.4032IP^769^5
"KRN",.403,244,40,1,40,765,0)
BPSOSPW 1^1^1,1^e
"KRN",.403,244,40,1,40,766,0)
BPSOSPW INS LIST^3^3,5^e
"KRN",.403,244,40,1,40,766,2)
3^!IEN^n
"KRN",.403,244,40,1,40,766,12)
S DDSBR="ARTYPE^ABSB BPSOSPW 1"
"KRN",.403,244,40,1,40,767,0)
BPSOSPW ARTYPE LIST^4^7,5^e
"KRN",.403,244,40,1,40,767,2)
3^!IEN^n
"KRN",.403,244,40,1,40,767,12)
S DDSBR="CLINIC^BPSOSPW 1"
"KRN",.403,244,40,1,40,768,0)
BPSOSPW CLINIC LIST^5^11,5^e
"KRN",.403,244,40,1,40,768,2)
3^!IEN^n
"KRN",.403,244,40,1,40,768,12)
S DDSBR="DIAG^BPSOSPW 1"
"KRN",.403,244,40,1,40,769,0)
BPSOSPW DIAG LIST^6^15,5^e
"KRN",.403,244,40,1,40,769,2)
3^!IEN^n
"KRN",.403,244,40,1,40,769,12)
S DDSBR="BAL AMT^BPSOSPW 1"
"KRN",.403,245,-1)
0^3
"KRN",.403,245,0)
BPS INPUT 1^@^@^^3000529.0544^^^9002313.51^0^0^1
"KRN",.403,245,40,0)
^.4031I^5^5
"KRN",.403,245,40,1,0)
1^^1,1
"KRN",.403,245,40,1,1)
Page 1
"KRN",.403,245,40,1,40,0)
^.4032IP^772^3
"KRN",.403,245,40,1,40,770,0)
BPS INPUT P1 TOP^1^1,1^e
"KRN",.403,245,40,1,40,771,0)
BPS INPUT P1 BOTTOM HEADER^2^7,1^d
"KRN",.403,245,40,1,40,772,0)
BPS INPUT P1 BOTTOM DATA^3^8,1^e
"KRN",.403,245,40,1,40,772,2)
9^!IEN^f^1^1
"KRN",.403,245,40,1,40,772,11)
D ENABASK^BPSOSI1 ; now enable "Ask Insurance?", etc.
"KRN",.403,245,40,2,0)
11^^13,49^^^1^17,74
"KRN",.403,245,40,2,1)
POSTAGE
"KRN",.403,245,40,2,11)
D UNED^DDSUTL(1,1,11,0) ; to counteract side effect from disabling page 7 pricing?
"KRN",.403,245,40,2,15,0)
^^2^2^3000529^
"KRN",.403,245,40,2,15,1,0)
When POSTAGE is entered as the NDC/CPT/HCPCS,
"KRN",.403,245,40,2,15,2,0)
this pop-up page asks for the $ amount.
"KRN",.403,245,40,2,40,0)
^.4032IP^773^1
"KRN",.403,245,40,2,40,773,0)
BPS INPUT POSTAGE^1^3,3^e
"KRN",.403,245,40,3,0)
7^^6,4^^^1^17,79
"KRN",.403,245,40,3,1)
THE ASKS
"KRN",.403,245,40,3,11)
D ENAB^BPSOSI7 ; which fields to enable?
"KRN",.403,245,40,3,12)

"KRN",.403,245,40,3,15,0)
^^3^3^3000529^
"KRN",.403,245,40,3,15,1,0)
This is the page for all those extra questions
"KRN",.403,245,40,3,15,2,0)
controlled by the "Ask Insurance?", etc. at the top,
"KRN",.403,245,40,3,15,3,0)
hence the page name, "THE ASKS".
"KRN",.403,245,40,3,40,0)
^.4032IP^782^5
"KRN",.403,245,40,3,40,774,0)
BPS INPUT INS LEAD-IN^1^5,4^e
"KRN",.403,245,40,3,40,775,0)
BPS INPUT PREAUTHORIZATION^2^9,4^e
"KRN",.403,245,40,3,40,776,0)
BPS INPUT PRICING^3^3,43^e
"KRN",.403,245,40,3,40,777,0)
BPS INPUT THE ASKS HEADER^4^2,4^d
"KRN",.403,245,40,3,40,782,0)
BPS INPUT PAGE7 EXIT^99^11,43^e
"KRN",.403,245,40,4,0)
8^^3,4^^^1^17,79
"KRN",.403,245,40,4,1)
INS SEL
"KRN",.403,245,40,4,15,0)
^^2^2^3000531^
"KRN",.403,245,40,4,15,1,0)
Insurance selection page.  Pop-up page, reached by ENTER at
"KRN",.403,245,40,4,15,2,0)
the field on page 7.
"KRN",.403,245,40,4,40,0)
^.4032IP^779^3
"KRN",.403,245,40,4,40,777,0)
BPS INPUT THE ASKS HEADER^2^3,3^d
"KRN",.403,245,40,4,40,778,0)
BPS INPUT INS SELECTION^11^7,3^e
"KRN",.403,245,40,4,40,778,2)
8^!IEN^f^1
"KRN",.403,245,40,4,40,778,11)
; LOAD is done from page 1 NDC field post action or maybe branch
"KRN",.403,245,40,4,40,778,12)
; maybe not this either - store into PINS, INSURER  STORE^BPSOSI8
"KRN",.403,245,40,4,40,779,0)
BPS INPUT INS SELECTION HDR^12^6,3^d
"KRN",.403,245,40,5,0)
15^^6,3^^^1^17,77
"KRN",.403,245,40,5,1)
NCPDP OVERRIDES
"KRN",.403,245,40,5,11)

"KRN",.403,245,40,5,40,0)
^.4032IP^781^2
"KRN",.403,245,40,5,40,780,0)
BPS INPUT OVERRIDE INSTR^1^2,4^d
"KRN",.403,245,40,5,40,781,0)
BPS INPUT OVERRIDE DATA^2^7,4^e
"KRN",.403,245,40,5,40,781,1)
LINE ITEMS:NCPDP OVERRIDE
"KRN",.403,245,40,5,40,781,2)
4^^n
"KRN",.404,764,0)
BPS EOB TO BATCH 1^9002313.99
"KRN",.404,764,40,0)
^.4044I^7^7
"KRN",.404,764,40,1,0)
1^AUTOMATICALLY CREATE A PAYMENT BATCH FOR PHARMACY ECME EOB^1
"KRN",.404,764,40,1,2)
^^2,12
"KRN",.404,764,40,2,0)
2^INSURER who sent the EOB^3
"KRN",.404,764,40,2,1)
577.01
"KRN",.404,764,40,2,2)
5,1^30^4,1
"KRN",.404,764,40,2,4)
1
"KRN",.404,764,40,3,0)
3^STARTING Date/Time^3
"KRN",.404,764,40,3,1)
577.02
"KRN",.404,764,40,3,2)
8,24^30^8,4
"KRN",.404,764,40,3,4)
1
"KRN",.404,764,40,4,0)
1.1^Include which ECME transactions from this insurer?^1
"KRN",.404,764,40,4,2)
^^7,1
"KRN",.404,764,40,5,0)
4^ENDING Date/Time^3
"KRN",.404,764,40,5,1)
577.03
"KRN",.404,764,40,5,2)
9,24^30^9,6
"KRN",.404,764,40,5,4)
1
"KRN",.404,764,40,6,0)
2.1^DEPOSIT Date^3
"KRN",.404,764,40,6,1)
577.04
"KRN",.404,764,40,6,2)
5,34^20^4,34
"KRN",.404,764,40,6,4)
0
"KRN",.404,764,40,7,0)
2.2^$ AMOUNT of EOB^3
"KRN",.404,764,40,7,1)
577.05
"KRN",.404,764,40,7,2)
5,59^9^4,56
"KRN",.404,764,40,7,4)
0^^1
"KRN",.404,765,0)
BPSOSPW 1^9002313.99
"KRN",.404,765,40,0)
^.4044I^16^16
"KRN",.404,765,40,1,0)
99.1^* * *   DESCRIBE THE KINDS OF ACCOUNTS YOU WISH TO WRITE-OFF   * * * ^1
"KRN",.404,765,40,1,2)
^^1,8
"KRN",.404,765,40,2,0)
1^Which INSURERs?^3^^INS
"KRN",.404,765,40,2,1)
2270.01
"KRN",.404,765,40,2,2)
2,19^17^2,2^1
"KRN",.404,765,40,2,3)
ALL (Ignore list)
"KRN",.404,765,40,2,4)
1
"KRN",.404,765,40,2,10)
S DDSBR=$S(X=1:"ARTYPE",1:"^ABSB BPSOSPW INS LIST")
"KRN",.404,765,40,3,0)
2^Which A/R TYPEs?^3^^ARTYPE
"KRN",.404,765,40,3,1)
2270.02
"KRN",.404,765,40,3,2)
6,20^17^6,2^1
"KRN",.404,765,40,3,3)
ALL (Ignore list)
"KRN",.404,765,40,3,4)
1
"KRN",.404,765,40,3,10)
S DDSBR=$S(X=1:"CLINIC",1:"^ABSB BPSOSPW ARTYPE LIST")
"KRN",.404,765,40,4,0)
3^Which CLINICs?^3^^CLINIC
"KRN",.404,765,40,4,1)
2270.06
"KRN",.404,765,40,4,2)
10,18^17^10,2^1
"KRN",.404,765,40,4,3)
ALL (Ignore list)
"KRN",.404,765,40,4,4)
1
"KRN",.404,765,40,4,10)
S DDSBR=$S(X=1:"DIAG",1:"^ABSB BPSOSPW CLINIC LIST")
"KRN",.404,765,40,5,0)
4^Primary DIAGNOSIS?^3^^DIAG
"KRN",.404,765,40,5,1)
2270.7
"KRN",.404,765,40,5,2)
14,22^17^14,2^1
"KRN",.404,765,40,5,3)
ALL (Ignore list)
"KRN",.404,765,40,5,4)
1
"KRN",.404,765,40,5,10)
S DDSBR=$S(X=1:"BALANCE AMT",1:"^ABSB BPSOSPW DIAG LIST")
"KRN",.404,765,40,6,0)
11^ACCOUNT BALANCE Selection^1^^BAL AMT
"KRN",.404,765,40,6,2)
^^2,45
"KRN",.404,765,40,7,0)
12^From $^3^^BAL AMT LOW
"KRN",.404,765,40,7,1)
2270.03
"KRN",.404,765,40,7,2)
3,50^6^3,44^1
"KRN",.404,765,40,7,3)
0
"KRN",.404,765,40,7,4)
1
"KRN",.404,765,40,7,12)
I X!$$GET^DDSVAL(DIE,.DA,"WO BAL MAX") D PUT^DDSVAL(DIE,.DA,"WO BAL AS PCT",100)
"KRN",.404,765,40,8,0)
13^thru $^3^^BAL AMT HIGH
"KRN",.404,765,40,8,1)
2270.04
"KRN",.404,765,40,8,2)
3,65^6^3,59^1
"KRN",.404,765,40,8,3)
0
"KRN",.404,765,40,8,12)
I X D PUT^DDSVAL(DIE,.DA,"WO BAL AS PCT",100)
"KRN",.404,765,40,9,0)
14^At most^3^^BAL PCT
"KRN",.404,765,40,9,1)
2270.9
"KRN",.404,765,40,9,2)
4,52^5^4,44^1
"KRN",.404,765,40,9,3)
100
"KRN",.404,765,40,9,4)
1
"KRN",.404,765,40,10,0)
14.1^% of original balance^1
"KRN",.404,765,40,10,2)
^^4,57
"KRN",.404,765,40,11,0)
20^AGE of account at least^3^^AGE
"KRN",.404,765,40,11,1)
2270.05
"KRN",.404,765,40,11,2)
6,69^4^6,44^1
"KRN",.404,765,40,11,3)
180
"KRN",.404,765,40,11,4)
1
"KRN",.404,765,40,12,0)
20.1^days^1
"KRN",.404,765,40,12,2)
^^6,75
"KRN",.404,765,40,13,0)
30^DATE OF SERVICE thru^3^^DOS
"KRN",.404,765,40,13,1)
2270.8
"KRN",.404,765,40,13,2)
8,66^11^8,44^1
"KRN",.404,765,40,13,3)
T-30
"KRN",.404,765,40,13,4)
1
"KRN",.404,765,40,14,0)
99^ADJUSTMENT REASON to put in A/R^3^^REASON
"KRN",.404,765,40,14,1)
2270.12
"KRN",.404,765,40,14,2)
17,47^30^16,44
"KRN",.404,765,40,14,4)
1
"KRN",.404,765,40,14,10)
S DDSBR="COM"
"KRN",.404,765,40,15,0)
80^Only writeoff if some PAYMENT^1
"KRN",.404,765,40,15,2)
^^13,44
"KRN",.404,765,40,16,0)
81^has been made?^3^^PMT BY INS
"KRN",.404,765,40,16,1)
2270.11
"KRN",.404,765,40,16,2)
14,60^14^14,44^1
"KRN",.404,765,40,16,3)
DON'T CONSIDER
"KRN",.404,766,0)
BPSOSPW INS LIST^9002313.992279^2
"KRN",.404,766,40,0)
^.4044I^1^1
"KRN",.404,766,40,1,0)
1^^3^^INS LIST
"KRN",.404,766,40,1,1)
.01
"KRN",.404,766,40,1,2)
1,1^30
"KRN",.404,766,40,1,4)
0
"KRN",.404,767,0)
BPSOSPW ARTYPE LIST^9002313.992271^2
"KRN",.404,767,40,0)
^.4044I^1^1
"KRN",.404,767,40,1,0)
1^^3^^ARTYPE LIST
"KRN",.404,767,40,1,1)
.01
"KRN",.404,767,40,1,2)
1,1^4
"KRN",.404,768,0)
BPSOSPW CLINIC LIST^9002313.992273^2
"KRN",.404,768,40,0)
^.4044I^1^1
"KRN",.404,768,40,1,0)
1^^3
"KRN",.404,768,40,1,1)
.01
"KRN",.404,768,40,1,2)
1,1^30
"KRN",.404,769,0)
BPSOSPW DIAG LIST^9002313.992274^2
"KRN",.404,769,40,0)
^.4044I^1^1
"KRN",.404,769,40,1,0)
1^^3
"KRN",.404,769,40,1,1)
.01
"KRN",.404,769,40,1,2)
1,2^7
"KRN",.404,770,0)
BPS INPUT P1 TOP^9002313.51
"KRN",.404,770,40,0)
^.4044I^18^16
"KRN",.404,770,40,3,0)
12^Ask Insurance?^3^^ASK INS
"KRN",.404,770,40,3,1)
1.01
"KRN",.404,770,40,3,2)
1,16^3^1,1^1
"KRN",.404,770,40,3,4)
1^^^1
"KRN",.404,770,40,4,0)
14^Ask Preauth #?^3^^ASK PRE
"KRN",.404,770,40,4,1)
1.02
"KRN",.404,770,40,4,2)
2,16^3^2,1^1
"KRN",.404,770,40,4,4)
1^^^1
"KRN",.404,770,40,5,0)
16^Ask Qty/Price?^3^^ASK PRI
"KRN",.404,770,40,5,1)
1.03
"KRN",.404,770,40,5,2)
3,16^3^3,1^1
"KRN",.404,770,40,5,4)
1^^^1
"KRN",.404,770,40,6,0)
18^Ask Fill Date?^3^^ASK DATE
"KRN",.404,770,40,6,1)
1.04
"KRN",.404,770,40,6,2)
4,16^3^4,1^1
"KRN",.404,770,40,6,4)
1^^^1
"KRN",.404,770,40,7,0)
91^<PF1> E  when done, to file claims^1
"KRN",.404,770,40,7,2)
^^1,42
"KRN",.404,770,40,8,0)
92^<PF1> Q to quit without filing claims^1
"KRN",.404,770,40,8,2)
^^2,42
"KRN",.404,770,40,9,0)
93^<PF4> to go back one field^1
"KRN",.404,770,40,9,2)
^^4,42
"KRN",.404,770,40,10,0)
94^Arrow keys may be used, too^1
"KRN",.404,770,40,10,2)
^^5,42
"KRN",.404,770,40,11,0)
1^|   PHARMACY   |^1
"KRN",.404,770,40,11,2)
^^2,23
"KRN",.404,770,40,12,0)
95^<PF3> insert/overstrike modes^1
"KRN",.404,770,40,12,2)
^^3,42
"KRN",.404,770,40,13,0)
20^Ask Overrides?^3
"KRN",.404,770,40,13,1)
1.05
"KRN",.404,770,40,13,2)
5,16^3^5,1^1
"KRN",.404,770,40,13,3)
NO
"KRN",.404,770,40,13,4)
1^^^1
"KRN",.404,770,40,14,0)
2^|   POINT OF   |^1
"KRN",.404,770,40,14,2)
^^3,23
"KRN",.404,770,40,15,0)
3^|     SALE     |^1
"KRN",.404,770,40,15,2)
^^4,23
"KRN",.404,770,40,16,0)
4^|  DATA ENTRY  |^1
"KRN",.404,770,40,16,2)
^^5,23
"KRN",.404,770,40,17,0)
99.1^+--------------+^1
"KRN",.404,770,40,17,2)
^^6,23
"KRN",.404,770,40,18,0)
99.3^+--------------+^1
"KRN",.404,770,40,18,2)
^^1,23
"KRN",.404,771,0)
BPS INPUT P1 BOTTOM HEADER^9002313.51^
"KRN",.404,771,40,0)
^.4044I^5^5
"KRN",.404,771,40,1,0)
2^Prescription^1
"KRN",.404,771,40,1,2)
^^1,4
"KRN",.404,771,40,2,0)
3^NDC/CPT/HCPCS^1
"KRN",.404,771,40,2,2)
^^1,17
"KRN",.404,771,40,3,0)
4^- Patient - - - -^1
"KRN",.404,771,40,3,2)
^^1,31
"KRN",.404,771,40,4,0)
5^Drug - - - - - - - -^1
"KRN",.404,771,40,4,2)
^^1,49
"KRN",.404,771,40,5,0)
6^Fill Date^1
"KRN",.404,771,40,5,2)
^^1,71
"KRN",.404,772,0)
BPS INPUT P1 BOTTOM DATA^9002313.512
"KRN",.404,772,40,0)
^.4044I^6^6
"KRN",.404,772,40,1,0)
1^^3^^LINE NUMBER
"KRN",.404,772,40,1,1)
.01
"KRN",.404,772,40,1,2)
1,1^2
"KRN",.404,772,40,1,4)
1^^^1
"KRN",.404,772,40,2,0)
2^^3^^RX DISP
"KRN",.404,772,40,2,1)
.02
"KRN",.404,772,40,2,2)
1,4^12
"KRN",.404,772,40,2,10)
D FILLDATE^BPSOSIB ; may set DDSBR=6, fill date
"KRN",.404,772,40,2,13)
D EFFECTS^BPSOSI1
"KRN",.404,772,40,2,14)
D VALID^BPSOSI1
"KRN",.404,772,40,3,0)
3^^3^^NDC DISP
"KRN",.404,772,40,3,1)
.03
"KRN",.404,772,40,3,2)
1,17^13
"KRN",.404,772,40,3,10)
D PAGE1^BPSOSIB ; may set DDSSTACK
"KRN",.404,772,40,3,12)
D PUT^DDSVAL(DIE,.DA,.03,X) ;D PUT^DDSVAL(DIE,.DA,.03,^TMP($J,"BPSOSI2","VALIDATED"))
"KRN",.404,772,40,3,13)
D EFFECTS^BPSOSI2
"KRN",.404,772,40,3,14)
D VALID^BPSOSI2 ; may reset X,DDSEXT
"KRN",.404,772,40,4,0)
4^^3^^PAT DISP
"KRN",.404,772,40,4,1)
.04
"KRN",.404,772,40,4,2)
1,31^17
"KRN",.404,772,40,4,4)
^^^1
"KRN",.404,772,40,5,0)
5^^3^^DRUG DISP
"KRN",.404,772,40,5,1)
.05
"KRN",.404,772,40,5,2)
1,49^24
"KRN",.404,772,40,5,4)
^^^1
"KRN",.404,772,40,6,0)
6^^3^^DATE DISP
"KRN",.404,772,40,6,1)
.06
"KRN",.404,772,40,6,2)
1,74^6
"KRN",.404,772,40,6,4)
^^^1
"KRN",.404,772,40,6,10)
S DDSBR=3 ; then go back to the NDC #
"KRN",.404,772,40,6,13)
D PUT^DDSVAL(DIE,.DA,.06,DDSEXT) ; because of what VALID^BPSOSID may have done
"KRN",.404,772,40,6,14)
D VALID^BPSOSID ; may reset X,DDSEXT and stuff new values in fields 1.02,1.06
"KRN",.404,773,0)
BPS INPUT POSTAGE^9002313.512
"KRN",.404,773,40,0)
^.4044I^1^1
"KRN",.404,773,40,1,0)
1^Postage amount: $^3^^POSTAGE AMOUNT
"KRN",.404,773,40,1,1)
5.02
"KRN",.404,773,40,1,2)
1,18^5^1,1^1
"KRN",.404,773,40,1,4)
1
"KRN",.404,773,40,1,10)
D POSTAGE^BPSOSIB ; may set DDSSTACK
"KRN",.404,773,40,1,13)
D PUT^DDSVAL(DIE,.DA,5.01,1),PUT^DDSVAL(DIE,.DA,5.03,X),PUT^DDSVAL(DIE,.DA,5.05,X),PUT^DDSVAL(DIE,.DA,5.04,0)
"KRN",.404,773,40,1,14)
I X'?1N.N,X'?1N.N1"."2N S DDSERROR=1101
"KRN",.404,774,0)
BPS INPUT INS LEAD-IN^9002313.512
"KRN",.404,774,11)
; IF NO INSURANCE DEFINED, SET UP THE DEFAULTS HERE
"KRN",.404,774,15,0)
^^4^4^3000529^
"KRN",.404,774,15,1,0)
This is the insurance "lead-in" block.
"KRN",.404,774,15,2,0)
It shows the current insurance selection
"KRN",.404,774,15,3,0)
and invites pressing ENTER to go to another page to 
"KRN",.404,774,15,4,0)
do a detailed insurance selection.
"KRN",.404,774,40,0)
^.4044I^4^4
"KRN",.404,774,40,1,0)
1^Primary insurance^3^^INS1
"KRN",.404,774,40,1,1)
7.01
"KRN",.404,774,40,1,2)
2,5^30^1,2
"KRN",.404,774,40,1,4)
^^^1
"KRN",.404,774,40,2,0)
2^Do you want to view/edit^1
"KRN",.404,774,40,2,2)
^^3,2
"KRN",.404,774,40,3,0)
3^the ORDER of INSURANCE?^1
"KRN",.404,774,40,3,2)
^^4,4
"KRN",.404,774,40,4,0)
4^^2
"KRN",.404,774,40,4,2)
4,28^3
"KRN",.404,774,40,4,3)
NO
"KRN",.404,774,40,4,4)
^^^0
"KRN",.404,774,40,4,10)
I X=1 D INIT^BPSOSI8 S DDSSTACK="INS SEL"
"KRN",.404,774,40,4,20)
Y
"KRN",.404,775,0)
BPS INPUT PREAUTHORIZATION^9002313.512
"KRN",.404,775,15,0)
^^5^5^3020829^
"KRN",.404,775,15,1,0)
Pre-authorization number.  that's all.
"KRN",.404,775,15,2,0)
With the addition of NCPDP 5.1, we had to add a new field 461-EU Prior
"KRN",.404,775,15,3,0)
Authorization Type Code. We will allow the system to always prompt for 
"KRN",.404,775,15,4,0)
this field, but we will only populate the claim with this information
"KRN",.404,775,15,5,0)
if the insurer is using a 5.1 format.
"KRN",.404,775,40,0)
^.4044I^2^2
"KRN",.404,775,40,1,0)
2^Prior Auth #^3
"KRN",.404,775,40,1,1)
2.01
"KRN",.404,775,40,1,2)
3,16^11^3,2
"KRN",.404,775,40,1,4)
^^^1
"KRN",.404,775,40,2,0)
1^Prior Auth Type^3
"KRN",.404,775,40,2,1)
2.02
"KRN",.404,775,40,2,2)
2,19^22^2,2
"KRN",.404,775,40,2,4)
^^^1
"KRN",.404,776,0)
BPS INPUT PRICING^9002313.512
"KRN",.404,776,11)
; lookup the price and present defaults
"KRN",.404,776,15,0)
^^1^1^3000529^
"KRN",.404,776,15,1,0)
Pricing
"KRN",.404,776,40,0)
^.4044I^7^7
"KRN",.404,776,40,1,0)
1^- - - - - PRICING - - - - -^1
"KRN",.404,776,40,1,2)
^^1,1
"KRN",.404,776,40,2,0)
11^Quantity^3^^QTY
"KRN",.404,776,40,2,1)
5.01
"KRN",.404,776,40,2,2)
2,18^10^2,7
"KRN",.404,776,40,2,4)
^^^1
"KRN",.404,776,40,2,13)
D RECALC1^BPSOSI7
"KRN",.404,776,40,3,0)
12^Price per unit: $^3^^UNIT PRICE
"KRN",.404,776,40,3,1)
5.02
"KRN",.404,776,40,3,2)
3,18^13^3,1^1
"KRN",.404,776,40,3,4)
^^^1
"KRN",.404,776,40,3,13)
S:$L($P(X,".",2))<2 X=$J(X,0,2) D RECALC1^BPSOSI7
"KRN",.404,776,40,4,0)
13^Qty x Price = $^3^^INGR COST
"KRN",.404,776,40,4,1)
5.03
"KRN",.404,776,40,4,2)
5,18^11^5,3^1
"KRN",.404,776,40,4,4)
^^^1
"KRN",.404,776,40,5,0)
14^Dispensing Fee: $^3
"KRN",.404,776,40,5,1)
5.04
"KRN",.404,776,40,5,2)
6,18^10^6,1^1
"KRN",.404,776,40,5,4)
^^^1
"KRN",.404,776,40,5,13)
S (DDSEXT,X)=$J(X,0,2) D PUT^DDSVAL(DIE,.DA,5.04,X),RECALC2^BPSOSI7
"KRN",.404,776,40,6,0)
15^Total Price: $^3^^TOTAL
"KRN",.404,776,40,6,1)
5.05
"KRN",.404,776,40,6,2)
7,18^10^7,4^1
"KRN",.404,776,40,6,4)
^^^1
"KRN",.404,776,40,7,0)
16^from^3
"KRN",.404,776,40,7,1)
5.06
"KRN",.404,776,40,7,2)
4,7^19^4,1^1
"KRN",.404,776,40,7,4)
^^^1
"KRN",.404,777,0)
BPS INPUT THE ASKS HEADER^9002313.512^
"KRN",.404,777,40,0)
^.4044I^4^4
"KRN",.404,777,40,1,0)
1^^3^
"KRN",.404,777,40,1,1)
.04
"KRN",.404,777,40,1,2)
1,5^28
"KRN",.404,777,40,1,4)
^^^1
"KRN",.404,777,40,2,0)
2^^3
"KRN",.404,777,40,2,1)
.05
"KRN",.404,777,40,2,2)
2,2^31
"KRN",.404,777,40,2,4)
^^^1
"KRN",.404,777,40,3,0)
3^<PF1> C to close this pop-up page^1
"KRN",.404,777,40,3,2)
^^1,36
"KRN",.404,777,40,4,0)
4^^3
"KRN",.404,777,40,4,1)
.01
"KRN",.404,777,40,4,2)
1,2^2
"KRN",.404,777,40,4,4)
^^^1
"KRN",.404,778,0)
BPS INPUT INS SELECTION^9002313.522
"KRN",.404,778,40,0)
^.4044I^5^3
"KRN",.404,778,40,3,0)
11^^3^^ORDER
"KRN",.404,778,40,3,1)
.02
"KRN",.404,778,40,3,2)
1,2^3
"KRN",.404,778,40,3,13)
D POST02^BPSOSI8
"KRN",.404,778,40,3,14)
I '$$GET^DDSVAL(DIE,.DA,.03) S DDSERROR=1 ;don't allow input on a blank line
"KRN",.404,778,40,4,0)
12^^3^^INSURER
"KRN",.404,778,40,4,1)
.03
"KRN",.404,778,40,4,2)
1,8^25
"KRN",.404,778,40,4,4)
^^^1
"KRN",.404,778,40,5,0)
13^^3^^DESCRIPTION
"KRN",.404,778,40,5,1)
1.01
"KRN",.404,778,40,5,2)
1,34^40
"KRN",.404,778,40,5,4)
^^1^1
"KRN",.404,779,0)
BPS INPUT INS SELECTION HDR^9002313.51^
"KRN",.404,779,40,0)
^.4044I^5^2
"KRN",.404,779,40,1,0)
1^Order^1
"KRN",.404,779,40,1,2)
^^1,1
"KRN",.404,779,40,5,0)
5^(Enter 1,2,3 next to the Primary, Secondary, Tertiary insurances)^1
"KRN",.404,779,40,5,2)
^^1,8
"KRN",.404,780,0)
BPS INPUT OVERRIDE INSTR^9002313.512^
"KRN",.404,780,11)
; may need to create an entry in 9002313.511 here?  DO NEW^BPSOSIO
"KRN",.404,780,12)
; may want something here, too
"KRN",.404,780,40,0)
^.4044I^12^8
"KRN",.404,780,40,4,0)
4^Use <PF1> C to close this page.^1
"KRN",.404,780,40,4,2)
^^3,1
"KRN",.404,780,40,5,0)
91^NCPDP FIELD (@ to delete)^1
"KRN",.404,780,40,5,2)
^^5,1
"KRN",.404,780,40,6,0)
92^VALUE^1
"KRN",.404,780,40,6,2)
^^5,42
"KRN",.404,780,40,8,0)
1^^3
"KRN",.404,780,40,8,1)
.04
"KRN",.404,780,40,8,2)
1,42^28
"KRN",.404,780,40,8,4)
^^^1
"KRN",.404,780,40,9,0)
2^^3
"KRN",.404,780,40,9,1)
.05
"KRN",.404,780,40,9,2)
2,39^31
"KRN",.404,780,40,9,4)
^^^1
"KRN",.404,780,40,10,0)
11^Enter the NCPDP Fields and Values^1
"KRN",.404,780,40,10,2)
^^1,1
"KRN",.404,780,40,11,0)
32^to override for this claim.^1
"KRN",.404,780,40,11,2)
^^2,1
"KRN",.404,780,40,12,0)
3^^3
"KRN",.404,780,40,12,1)
.01
"KRN",.404,780,40,12,2)
1,39^2
"KRN",.404,780,40,12,4)
^^^1
"KRN",.404,781,0)
BPS INPUT OVERRIDE DATA^9002313.5111
"KRN",.404,781,40,0)
^.4044I^3^3
"KRN",.404,781,40,1,0)
1^^3
"KRN",.404,781,40,1,1)
.01
"KRN",.404,781,40,1,2)
1,1^5
"KRN",.404,781,40,1,4)
1
"KRN",.404,781,40,2,0)
3^^3^^VALUE
"KRN",.404,781,40,2,1)
.02
"KRN",.404,781,40,2,2)
1,42^30
"KRN",.404,781,40,2,4)
1
"KRN",.404,781,40,3,0)
2^^4
"KRN",.404,781,40,3,2)
1,7^30
"KRN",.404,781,40,3,30)
={NCPDP FIELD:Name}
"KRN",.404,782,0)
BPS INPUT PAGE7 EXIT^9002313.51
"KRN",.404,782,40,0)
^.4044I^1^1
"KRN",.404,782,40,1,0)
1^Done with this page?^2
"KRN",.404,782,40,1,2)
1,30^3^1,8^1
"KRN",.404,782,40,1,3)
YES
"KRN",.404,782,40,1,4)
1
"KRN",.404,782,40,1,10)
S:DDSEXT="NO" DDSBR="^1" D:DDSEXT="YES" THEASKS^BPSOSIB ; may set DDSSTACK
"KRN",.404,782,40,1,20)
Y
"KRN",3.8,6970,-1)
0^1
"KRN",3.8,6970,0)
BPS OPECC^PU^^^^^
"KRN",3.8,6970,3)

"KRN",19,2927130,-1)
0^29
"KRN",19,2927130,0)
BPS MENU RPT MAIN^Pharmacy Electronic Claims Reports^^M^^BPS REPORTS^^^^^^^^^^^1
"KRN",19,2927130,1,0)
^19.06^1^1^3051025^^^^
"KRN",19,2927130,1,1,0)
Menu
"KRN",19,2927130,10,0)
^19.01IP^3^2
"KRN",19,2927130,10,1,0)
2927909^CLA^10
"KRN",19,2927130,10,1,"^")
BPS MENU RPT CLAIM STATUS
"KRN",19,2927130,10,3,0)
2927189^OTH
"KRN",19,2927130,10,3,"^")
BPS MENU RPT OTHER
"KRN",19,2927130,20)

"KRN",19,2927130,26)
D HDR^BPSMHDR
"KRN",19,2927130,99)
60305,51274
"KRN",19,2927130,99.1)
60345,62055
"KRN",19,2927130,"U")
PHARMACY ELECTRONIC CLAIMS REP
"KRN",19,2927143,-1)
0^73
"KRN",19,2927143,0)
BPS SETUP PHARMACY^Edit ECME Pharmacy Data^^R^^BPS MASTER^^^^^^^^^
"KRN",19,2927143,1,0)
^19.06^1^1^3050802^^
"KRN",19,2927143,1,1,0)
edit file 9002313.56
"KRN",19,2927143,15)

"KRN",19,2927143,25)
EN^BPSPHAR
"KRN",19,2927143,30)

"KRN",19,2927143,31)

"KRN",19,2927143,50)

"KRN",19,2927143,51)

"KRN",19,2927143,"U")
EDIT ECME PHARMACY DATA
"KRN",19,2927145,-1)
0^68
"KRN",19,2927145,0)
BPS SETUP MENU^Pharmacy ECME Setup Menu^^M^^BPS MASTER^^^^^^^^^^^1
"KRN",19,2927145,1,0)
^19.06^2^2^3051101^^^^
"KRN",19,2927145,1,1,0)
Menu
"KRN",19,2927145,1,2,0)
All the setup goodies.  See installation manual.
"KRN",19,2927145,10,0)
^19.01IP^15^15
"KRN",19,2927145,10,12,0)
2927222^REG^3
"KRN",19,2927145,10,12,"^")
BPS SETUP REGISTER PHARMACY
"KRN",19,2927145,10,14,0)
2927143^PHAR^2
"KRN",19,2927145,10,14,"^")
BPS SETUP PHARMACY
"KRN",19,2927145,10,15,0)
2927945^BAS^1
"KRN",19,2927145,10,15,"^")
BPS SETUP BASIC PARAMS
"KRN",19,2927145,26)
D HDR^BPSMHDR
"KRN",19,2927145,99)
60305,51274
"KRN",19,2927145,99.1)
60345,62055
"KRN",19,2927145,"U")
PHARMACY ECME SETUP MENU
"KRN",19,2927153,-1)
0^115
"KRN",19,2927153,0)
BPS MANAGER MENU^Pharmacy ECME Manager Menu^^M^^BPS MANAGER^^^^^^^^1^^^1
"KRN",19,2927153,1,0)
^19.06^1^1^3051101^^^^
"KRN",19,2927153,1,1,0)
Pharmacy ECME main menu for Manager functions
"KRN",19,2927153,10,0)
^19.01IP^10^10
"KRN",19,2927153,10,8,0)
2927145^SET^20
"KRN",19,2927153,10,8,"^")
BPS SETUP MENU
"KRN",19,2927153,10,9,0)
2927854^MNT^10
"KRN",19,2927153,10,9,"^")
BPS MENU MAINTENANCE
"KRN",19,2927153,10,10,0)
2927941^STAT^30
"KRN",19,2927153,10,10,"^")
BPS STATISTICS SCREEN
"KRN",19,2927153,20)
K BPSQUIT D INIT^BPSMHDR I $G(BPSQUIT) K BPSQUIT S XQUIT=1
"KRN",19,2927153,26)
D HDR^BPSMHDR
"KRN",19,2927153,99)
60305,51274
"KRN",19,2927153,99.1)
60345,62055
"KRN",19,2927153,"U")
PHARMACY ECME MANAGER MENU
"KRN",19,2927155,-1)
0^106
"KRN",19,2927155,0)
BPSMENU^ECME^^M^^BPSMENU^^^^^^E CLAIMS MGMT ENGINE^^1^^^
"KRN",19,2927155,1,0)
^19.06^1^1^3050708^^^^
"KRN",19,2927155,1,1,0)
The main menu
"KRN",19,2927155,10,0)
^19.01IP^4^4
"KRN",19,2927155,10,2,0)
2927153^MGR^2
"KRN",19,2927155,10,2,"^")
BPS MANAGER MENU
"KRN",19,2927155,10,3,0)
2927936^U^1
"KRN",19,2927155,10,3,"^")
BPS USER SCREEN
"KRN",19,2927155,10,4,0)
2927130^RPT^4
"KRN",19,2927155,10,4,"^")
BPS MENU RPT MAIN
"KRN",19,2927155,20)
K BPSQUIT D INIT^BPSMHDR,HDR^BPSMHDR I $G(BPSQUIT) K BPSQUIT S XQUIT=1
"KRN",19,2927155,26)

"KRN",19,2927155,99)
60305,51274
"KRN",19,2927155,99.1)
60345,62055
"KRN",19,2927155,"U")
ECME
"KRN",19,2927189,-1)
0^30
"KRN",19,2927189,0)
BPS MENU RPT OTHER^Other Reports^^M^^BPS REPORTS^^^^^^^^^^^1
"KRN",19,2927189,1,0)
^19.06^1^1^3051101^^^^
"KRN",19,2927189,1,1,0)
Menu
"KRN",19,2927189,10,0)
^19.01IP^6^6
"KRN",19,2927189,10,4,0)
2927906^PAY^2
"KRN",19,2927189,10,4,"^")
BPS RPT PAYER SHEET DETAIL
"KRN",19,2927189,10,5,0)
2927942^PHAR^5
"KRN",19,2927189,10,5,"^")
BPS RPT SETUP PHARMACIES
"KRN",19,2927189,10,6,0)
2927943^TAT^91
"KRN",19,2927189,10,6,"^")
BPS RPT TURNAROUND STATS
"KRN",19,2927189,26)
D HDR^BPSMHDR
"KRN",19,2927189,99)
60305,51274
"KRN",19,2927189,"U")
OTHER REPORTS
"KRN",19,2927203,-1)
0^52
"KRN",19,2927203,0)
BPS RPT REJECTION^Rejected Claims Report^^R^^BPS REPORTS^^^^^^^^^
"KRN",19,2927203,1,0)
^19.06^2^2^3050301^^^^
"KRN",19,2927203,1,1,0)
Report of rejected claims (electronic), amounts, and information that's
"KRN",19,2927203,1,2,0)
useful in calling a Help Desk, starting with the Help Desk telephone number.
"KRN",19,2927203,15)

"KRN",19,2927203,20)

"KRN",19,2927203,25)
EN^BPSRPT0(2)
"KRN",19,2927203,60)

"KRN",19,2927203,62)
0
"KRN",19,2927203,63)

"KRN",19,2927203,64)

"KRN",19,2927203,65)

"KRN",19,2927203,66)

"KRN",19,2927203,67)

"KRN",19,2927203,"U")
REJECTED CLAIMS REPORT
"KRN",19,2927204,-1)
0^51
"KRN",19,2927204,0)
BPS RPT PAYABLE^Payable Claims Report^^R^^BPS REPORTS^^^^^^^^^
"KRN",19,2927204,1,0)
^19.06^2^2^3050301^^^^
"KRN",19,2927204,1,1,0)
Report of payable claims (electronic), and comparison to amount billed
"KRN",19,2927204,1,2,0)
vs. amount paid.
"KRN",19,2927204,15)

"KRN",19,2927204,20)

"KRN",19,2927204,25)
EN^BPSRPT0(1)
"KRN",19,2927204,60)

"KRN",19,2927204,62)
0
"KRN",19,2927204,63)

"KRN",19,2927204,64)

"KRN",19,2927204,67)

"KRN",19,2927204,"U")
PAYABLE CLAIMS REPORT
"KRN",19,2927211,-1)
0^54
"KRN",19,2927211,0)
BPS RPT TOTALS BY DAY^Totals by Date^^R^^BPS REPORTS^^^^^^^^^
"KRN",19,2927211,1,0)
^19.06^2^2^3050615^^^
"KRN",19,2927211,1,1,0)
Report $$$ totals of ECME activity day by day.
"KRN",19,2927211,1,2,0)
Input a date range.
"KRN",19,2927211,15)

"KRN",19,2927211,20)

"KRN",19,2927211,25)
EN^BPSRPT0(6)
"KRN",19,2927211,60)

"KRN",19,2927211,62)
0
"KRN",19,2927211,63)

"KRN",19,2927211,64)

"KRN",19,2927211,65)

"KRN",19,2927211,66)

"KRN",19,2927211,67)

"KRN",19,2927211,"U")
TOTALS BY DATE
"KRN",19,2927221,-1)
0^49
"KRN",19,2927221,0)
BPS RPT NOT RELEASED^Claims Submitted, Not Yet Released^^R^^BPS REPORTS^^^^^^^^^
"KRN",19,2927221,1,0)
^19.06^1^1^3050301^^^^
"KRN",19,2927221,1,1,0)
List of transactions with no release date.
"KRN",19,2927221,15)

"KRN",19,2927221,20)

"KRN",19,2927221,25)
EN^BPSRPT0(3)
"KRN",19,2927221,60)

"KRN",19,2927221,62)
0
"KRN",19,2927221,63)

"KRN",19,2927221,64)

"KRN",19,2927221,67)

"KRN",19,2927221,"U")
CLAIMS SUBMITTED, NOT YET RELE
"KRN",19,2927222,-1)
0^75
"KRN",19,2927222,0)
BPS SETUP REGISTER PHARMACY^Register Pharmacy with Austin Automation Center^^R^^BPS MASTER^^^^^y^
"KRN",19,2927222,25)
INIT^BPSJAREG
"KRN",19,2927222,99.1)
59647,50769
"KRN",19,2927222,"U")
REGISTER PHARMACY WITH AUSTIN 
"KRN",19,2927305,-1)
0^53
"KRN",19,2927305,0)
BPS RPT REVERSAL^Reversal Claims Report^^R^^BPS REPORTS^^^^^^^^^
"KRN",19,2927305,1,0)
^^3^3^3050713^
"KRN",19,2927305,1,1,0)
Report of the claims that have gone through the electronic reversal
"KRN",19,2927305,1,2,0)
process. In essence claims that have been canceled in some fashion and
"KRN",19,2927305,1,3,0)
reversed in the electronic queue.
"KRN",19,2927305,15)

"KRN",19,2927305,20)

"KRN",19,2927305,25)
EN^BPSRPT0(4)
"KRN",19,2927305,30)

"KRN",19,2927305,60)

"KRN",19,2927305,63)

"KRN",19,2927305,67)

"KRN",19,2927305,668000,0)
^19.0668^^0
"KRN",19,2927305,"U")
REVERSAL CLAIMS REPORT
"KRN",19,2927434,-1)
0^45
"KRN",19,2927434,0)
BPS RPT CLOSED CLAIMS^Closed Claims Report^^R^^BPS REPORTS^^^^^^^^^
"KRN",19,2927434,1,0)
^19.06^1^1^3050615^^^^
"KRN",19,2927434,1,1,0)
Report of Closed Claims (electronic).
"KRN",19,2927434,10.1)
Closed Claims Report
"KRN",19,2927434,15)

"KRN",19,2927434,20)

"KRN",19,2927434,25)
EN^BPSRPT0(7)
"KRN",19,2927434,60)

"KRN",19,2927434,"U")
CLOSED CLAIMS REPORT
"KRN",19,2927437,-1)
0^1
"KRN",19,2927437,0)
BPS APP REG TASKMAN^EPHARMACY APPLICATION REGISTRATION - TASKMAN^^R^^^^^^^^
"KRN",19,2927437,1,0)
^19.06^3^3^3040423^^
"KRN",19,2927437,1,1,0)
EPHARMACY APPLICATION REGISTRATION - Initiates e-Pharmacy Application 
"KRN",19,2927437,1,2,0)
Registration and Pharmacy Site Registrations - For use with TASKMAN 
"KRN",19,2927437,1,3,0)
scheduling.
"KRN",19,2927437,25)
TASKMAN^BPSJAREG
"KRN",19,2927437,99.1)
59878,62177
"KRN",19,2927437,"U")
EPHARMACY APPLICATION REGISTRA
"KRN",19,2927715,-1)
0^107
"KRN",19,2927715,0)
BPS RPT CMOP/ECME ACTIVITY^CMOP/ECME Activity Report^^R^^BPS REPORTS^^^^^^
"KRN",19,2927715,25)
BPSCEAR
"KRN",19,2927715,62)
0
"KRN",19,2927715,"U")
CMOP/ECME ACTIVITY REPORT
"KRN",19,2927854,-1)
0^114
"KRN",19,2927854,0)
BPS MENU MAINTENANCE^ECME transaction maintenance options^^M^^BPS MANAGER^^^^^^
"KRN",19,2927854,10,0)
^19.01IP^1^1
"KRN",19,2927854,10,1,0)
2927905^UNS^1
"KRN",19,2927854,10,1,"^")
BPS UNSTRAND SCREEN
"KRN",19,2927854,99)
60305,51274
"KRN",19,2927854,"U")
ECME TRANSACTION MAINTENANCE O
"KRN",19,2927860,-1)
0^108
"KRN",19,2927860,0)
BPS NIGHTLY BACKGROUND JOB^BPS NIGHTLY BACKGROUND JOB^^R^^^^^^^^
"KRN",19,2927860,1,0)
^^6^6^3050301^
"KRN",19,2927860,1,1,0)
This option is not to be placed on any menu nor run by any user.  This
"KRN",19,2927860,1,2,0)
option is specifically designed to be scheduled in TaskMan to be execute
"KRN",19,2927860,1,3,0)
once a day during off-peak hours (at night). Running this more than once a
"KRN",19,2927860,1,4,0)
day ma cause unexpected results.  This option is the BPS nightly task that
"KRN",19,2927860,1,5,0)
performs ECME-related nightly procedures.
"KRN",19,2927860,1,6,0)
It is recommended to schedule this option at night after midnight.
"KRN",19,2927860,25)
EN^BPSBCKJ
"KRN",19,2927860,"U")
BPS NIGHTLY BACKGROUND JOB
"KRN",19,2927901,-1)
0^116
"KRN",19,2927901,0)
BPS RPT ERRONEOUS REV^List Possible Erroneous Reversals^^R^^^^^^^^
"KRN",19,2927901,1,0)
^^1^1^3050408^
"KRN",19,2927901,1,1,0)
This report will display possible erroneous reversals
"KRN",19,2927901,25)
BPSRREV
"KRN",19,2927901,"U")
LIST POSSIBLE ERRONEOUS REVERS
"KRN",19,2927905,-1)
0^117
"KRN",19,2927905,0)
BPS UNSTRAND SCREEN^View/Unstrand Claims Not Completed^^R^^BPS MANAGER^^^^^^^^^1
"KRN",19,2927905,1,0)
^19.06^2^2^3050615^^
"KRN",19,2927905,1,1,0)
List Manager screen - to list any 'stuck' claims and release them for 
"KRN",19,2927905,1,2,0)
further processing.
"KRN",19,2927905,15)
D KILL^XUSCLEAN
"KRN",19,2927905,25)
EN^BPSUSCR
"KRN",19,2927905,99.1)
58154,30494
"KRN",19,2927905,"U")
VIEW/UNSTRAND CLAIMS NOT COMPL
"KRN",19,2927906,-1)
0^118
"KRN",19,2927906,0)
BPS RPT PAYER SHEET DETAIL^Payer Sheet Detail Report^^R^^BPS REPORTS^^^^^^
"KRN",19,2927906,1,0)
^^2^2^3050621^
"KRN",19,2927906,1,1,0)
The report displays the segments and fields (along with any special code) 
"KRN",19,2927906,1,2,0)
of a selected payer sheet.
"KRN",19,2927906,25)
EN^BPSRPAY
"KRN",19,2927906,"U")
PAYER SHEET DETAIL REPORT
"KRN",19,2927909,-1)
0^28
"KRN",19,2927909,0)
BPS MENU RPT CLAIM STATUS^Claim Results and Status^^M^^BPS REPORTS^^^^^^^^^^^1
"KRN",19,2927909,1,0)
^19.06^1^1^3051101^^
"KRN",19,2927909,1,1,0)
This is a menu with all of the claims reports
"KRN",19,2927909,10,0)
^19.01IP^31^31
"KRN",19,2927909,10,18,0)
2927204^PAY^1
"KRN",19,2927909,10,18,"^")
BPS RPT PAYABLE
"KRN",19,2927909,10,19,0)
2927203^REJ^2
"KRN",19,2927909,10,19,"^")
BPS RPT REJECTION
"KRN",19,2927909,10,25,0)
2927211^DAY^91
"KRN",19,2927909,10,25,"^")
BPS RPT TOTALS BY DAY
"KRN",19,2927909,10,27,0)
2927221^NYR^13
"KRN",19,2927909,10,27,"^")
BPS RPT NOT RELEASED
"KRN",19,2927909,10,28,0)
2927305^REV^7
"KRN",19,2927909,10,28,"^")
BPS RPT REVERSAL
"KRN",19,2927909,10,29,0)
2927434^CLO^92
"KRN",19,2927909,10,29,"^")
BPS RPT CLOSED CLAIMS
"KRN",19,2927909,10,30,0)
2927715^ECMP^3
"KRN",19,2927909,10,30,"^")
BPS RPT CMOP/ECME ACTIVITY
"KRN",19,2927909,10,31,0)
2927944^REC^50
"KRN",19,2927909,10,31,"^")
BPS RPT RECENT TRANSACTIONS
"KRN",19,2927909,25)

"KRN",19,2927909,26)
D HDR^BPSMHDR
"KRN",19,2927909,99)
60305,51274
"KRN",19,2927909,"U")
CLAIM RESULTS AND STATUS
"KRN",19,2927936,-1)
0^103
"KRN",19,2927936,0)
BPS USER SCREEN^ECME User Screen^^R^^BPS USER^^^^^^^^^1
"KRN",19,2927936,1,0)
^19.06^3^3^3050601^^^^
"KRN",19,2927936,1,1,0)
List Manager screen - the big one - displays status of claims,
"KRN",19,2927936,1,2,0)
has protocols for data entry, resubmitting, reversing, etc., etc., 
"KRN",19,2927936,1,3,0)
etc., etc.
"KRN",19,2927936,15)
D KILL^XUSCLEAN
"KRN",19,2927936,20)

"KRN",19,2927936,25)
EN^BPSSCR
"KRN",19,2927936,99.1)
58154,30494
"KRN",19,2927936,"U")
ECME USER SCREEN
"KRN",19,2927941,-1)
0^124
"KRN",19,2927941,0)
BPS STATISTICS SCREEN^Statistics Screen^^R^^BPS MANAGER^^^^^^^^1^1
"KRN",19,2927941,1,0)
^^1^1^3051101^
"KRN",19,2927941,1,1,0)
List Manager display of stats and some protocols to accomplish various manager functions.
"KRN",19,2927941,15)
D KILL^XUSCLEAN
"KRN",19,2927941,20)
K BPSQUIT D INIT^BPSMHDR I $G(BPSQUIT) K BPSQUIT S XQUIT=1
"KRN",19,2927941,25)
BPSOS2
"KRN",19,2927941,"U")
STATISTICS SCREEN
"KRN",19,2927942,-1)
0^125
"KRN",19,2927942,0)
BPS RPT SETUP PHARMACIES^ECME Setup - Pharmacies Report^^P^^BPS REPORTS^^^^^^^^^1
"KRN",19,2927942,1,0)
^19.06^1^1^3051101^^
"KRN",19,2927942,1,1,0)
print file 9002313.56
"KRN",19,2927942,15)
D PRESSANY^BPSOSU5(),KILL^XUSCLEAN
"KRN",19,2927942,30)

"KRN",19,2927942,60)
BPS(9002313.56,
"KRN",19,2927942,62)
0
"KRN",19,2927942,63)
[CAPTIONED]
"KRN",19,2927942,64)
[BPS SETUP PHARMACIES]
"KRN",19,2927942,"U")
ECME SETUP - PHARMACIES REPORT
"KRN",19,2927943,-1)
0^126
"KRN",19,2927943,0)
BPS RPT TURNAROUND STATS^Turn-around time statistics^^R^^BPS REPORTS^^^^^^^^^1
"KRN",19,2927943,15)
D PRESSANY^BPSOSU5(),KILL^XUSCLEAN
"KRN",19,2927943,25)
BPSRDT1
"KRN",19,2927943,"U")
TURN-AROUND TIME STATISTICS
"KRN",19,2927944,-1)
0^127
"KRN",19,2927944,0)
BPS RPT RECENT TRANSACTIONS^Recent Transactions^^R^^BPS REPORTS^^^^^^
"KRN",19,2927944,1,0)
^^1^1^3051101^
"KRN",19,2927944,1,1,0)
This report summarizes recently completed transactions for the selected date range.
"KRN",19,2927944,25)
EN^BPSRPT0(5)
"KRN",19,2927944,62)
0
"KRN",19,2927944,"U")
RECENT TRANSACTIONS
"KRN",19,2927945,-1)
0^128
"KRN",19,2927945,0)
BPS SETUP BASIC PARAMS^Edit Basic ECME Parameters^^R^^BPS MASTER^^^^^^^^^1
"KRN",19,2927945,1,0)
^^1^1^3051101^
"KRN",19,2927945,1,1,0)
Several parameters - done early in initial installation and maybe later if the need arises.
"KRN",19,2927945,15)
D KILL^XUSCLEAN
"KRN",19,2927945,25)
PART1^BPSOSS8
"KRN",19,2927945,"U")
EDIT BASIC ECME PARAMETERS
"KRN",19,2927949,-1)
1^2
"KRN",19,2927949,0)
BPS AUTO-WRITEOFF BAT
"KRN",19,2927950,-1)
1^3
"KRN",19,2927950,0)
BPS AUTO-WRITEOFF LIST
"KRN",19,2927951,-1)
1^4
"KRN",19,2927951,0)
BPS BACKGROUND SCAN LOG
"KRN",19,2927952,-1)
1^5
"KRN",19,2927952,0)
BPS BACKGROUND SCAN START
"KRN",19,2927953,-1)
1^6
"KRN",19,2927953,0)
BPS BACKGROUND SCAN STATUS
"KRN",19,2927954,-1)
1^7
"KRN",19,2927954,0)
BPS BACKGROUND SCAN STOP
"KRN",19,2927955,-1)
1^8
"KRN",19,2927955,0)
BPS BEN/ELIG SURVEY
"KRN",19,2927956,-1)
1^11
"KRN",19,2927956,0)
BPS COMMS LOG VIEW
"KRN",19,2927957,-1)
1^12
"KRN",19,2927957,0)
BPS DISPLAY CLAIMS 1
"KRN",19,2927958,-1)
1^13
"KRN",19,2927958,0)
BPS DISPLAY RESPONSES 1
"KRN",19,2927959,-1)
1^14
"KRN",19,2927959,0)
BPS DIVISIONS SURVEY
"KRN",19,2927960,-1)
1^15
"KRN",19,2927960,0)
BPS EOB TO BATCH
"KRN",19,2927961,-1)
1^16
"KRN",19,2927961,0)
BPS FORMATS EDIT
"KRN",19,2927962,-1)
1^17
"KRN",19,2927962,0)
BPS FORMATS INPUT
"KRN",19,2927963,-1)
1^18
"KRN",19,2927963,0)
BPS FORMATS LIST
"KRN",19,2927964,-1)
1^19
"KRN",19,2927964,0)
BPS INS RULES AVAIL
"KRN",19,2927965,-1)
1^20
"KRN",19,2927965,0)
BPS INS RULES IN-USE
"KRN",19,2927966,-1)
1^21
"KRN",19,2927966,0)
BPS INSURANCE EDIT
"KRN",19,2927967,-1)
1^22
"KRN",19,2927967,0)
BPS INSURER SURVEY
"KRN",19,2927968,-1)
1^24
"KRN",19,2927968,0)
BPS MANAGER SCREEN
"KRN",19,2927969,-1)
1^25
"KRN",19,2927969,0)
BPS MENU BACKGROUND SCAN
"KRN",19,2927970,-1)
1^26
"KRN",19,2927970,0)
BPS MENU DEVEL
"KRN",19,2927971,-1)
1^27
"KRN",19,2927971,0)
BPS MENU NCPDP FORMS
"KRN",19,2927972,-1)
1^31
"KRN",19,2927972,0)
BPS MENU RPT SETUP
"KRN",19,2927973,-1)
1^32
"KRN",19,2927973,0)
BPS MENU RPT SURVEY
"KRN",19,2927974,-1)
1^33
"KRN",19,2927974,0)
BPS NCPDP FIELDS LIST
"KRN",19,2927975,-1)
1^34
"KRN",19,2927975,0)
BPS NCPDP FORMS ALIGN
"KRN",19,2927976,-1)
1^35
"KRN",19,2927976,0)
BPS NCPDP FORMS PRINT
"KRN",19,2927977,-1)
1^36
"KRN",19,2927977,0)
BPS NCPDP FORMS REPRINT
"KRN",19,2927978,-1)
1^37
"KRN",19,2927978,0)
BPS PAYABLE REPORT
"KRN",19,2927979,-1)
1^38
"KRN",19,2927979,0)
BPS PROVIDER #S EDIT
"KRN",19,2927980,-1)
1^39
"KRN",19,2927980,0)
BPS PROVIDER #S SURVEY
"KRN",19,2927981,-1)
1^40
"KRN",19,2927981,0)
BPS RECENT TRANSACTIONS
"KRN",19,2927982,-1)
1^41
"KRN",19,2927982,0)
BPS REJECTION REPORT
"KRN",19,2927983,-1)
1^42
"KRN",19,2927983,0)
BPS REVERSAL REPORT
"KRN",19,2927984,-1)
1^43
"KRN",19,2927984,0)
BPS RPMS RX BILLING STATUS
"KRN",19,2927985,-1)
1^44
"KRN",19,2927985,0)
BPS RPT CAPTURED
"KRN",19,2927986,-1)
1^46
"KRN",19,2927986,0)
BPS RPT DUPLICATE
"KRN",19,2927987,-1)
1^47
"KRN",19,2927987,0)
BPS RPT MISSED PRESCRIPTIONS
"KRN",19,2927988,-1)
1^48
"KRN",19,2927988,0)
BPS RPT NEED REVERSAL
"KRN",19,2927989,-1)
1^50
"KRN",19,2927989,0)
BPS RPT PAPER
"KRN",19,2927990,-1)
1^55
"KRN",19,2927990,0)
BPS RPT TOTALS BY INSURER
"KRN",19,2927991,-1)
1^56
"KRN",19,2927991,0)
BPS RPT UNINSURED
"KRN",19,2927992,-1)
1^57
"KRN",19,2927992,0)
BPS RPT UNRELEASED
"KRN",19,2927993,-1)
1^58
"KRN",19,2927993,0)
BPS SETUP DETAIL
"KRN",19,2927994,-1)
1^59
"KRN",19,2927994,0)
BPS SETUP DIAL OUT ADV.
"KRN",19,2927995,-1)
1^60
"KRN",19,2927995,0)
BPS SETUP DIAL OUT BASIC
"KRN",19,2927996,-1)
1^61
"KRN",19,2927996,0)
BPS SETUP DIAL OUT DEF.
"KRN",19,2927997,-1)
1^62
"KRN",19,2927997,0)
BPS SETUP DIAL OUT MENU
"KRN",19,2927998,-1)
1^63
"KRN",19,2927998,0)
BPS SETUP ILC AR
"KRN",19,2927999,-1)
1^64
"KRN",19,2927999,0)
BPS SETUP INSURANCE MENU
"KRN",19,2928000,-1)
1^65
"KRN",19,2928000,0)
BPS SETUP INSURANCE SEL
"KRN",19,2928001,-1)
1^66
"KRN",19,2928001,0)
BPS SETUP INSURER
"KRN",19,2928002,-1)
1^67
"KRN",19,2928002,0)
BPS SETUP INSURER QUICK
"KRN",19,2928003,-1)
1^69
"KRN",19,2928003,0)
BPS SETUP MISC.
"KRN",19,2928004,-1)
1^70
"KRN",19,2928004,0)
BPS SETUP OKLA. MEDICAID
"KRN",19,2928005,-1)
1^71
"KRN",19,2928005,0)
BPS SETUP PART 1
"KRN",19,2928006,-1)
1^72
"KRN",19,2928006,0)
BPS SETUP PHARMACIES
"KRN",19,2928007,-1)
1^74
"KRN",19,2928007,0)
BPS SETUP PRICING
"KRN",19,2928008,-1)
1^76
"KRN",19,2928008,0)
BPS SETUP SUMMARY
"KRN",19,2928009,-1)
1^77
"KRN",19,2928009,0)
BPS SETUP USERS
"KRN",19,2928010,-1)
1^78
"KRN",19,2928010,0)
BPS STATISTICS
"KRN",19,2928011,-1)
1^79
"KRN",19,2928011,0)
BPS STRANDED CLAIMS
"KRN",19,2928012,-1)
1^80
"KRN",19,2928012,0)
BPS SUP CHECK DATE RANGE
"KRN",19,2928013,-1)
1^81
"KRN",19,2928013,0)
BPS SUP CHECK DEFAULT
"KRN",19,2928014,-1)
1^82
"KRN",19,2928014,0)
BPS SUP CHECK MENU
"KRN",19,2928015,-1)
1^83
"KRN",19,2928015,0)
BPS SUP CHECK PAST WEEK
"KRN",19,2928016,-1)
1^84
"KRN",19,2928016,0)
BPS SUP CHECK TODAY
"KRN",19,2928017,-1)
1^85
"KRN",19,2928017,0)
BPS SUP CHECK YESTERDAY
"KRN",19,2928018,-1)
1^86
"KRN",19,2928018,0)
BPS SUP ERROR LOG
"KRN",19,2928019,-1)
1^87
"KRN",19,2928019,0)
BPS SUP MENU
"KRN",19,2928020,-1)
1^88
"KRN",19,2928020,0)
BPS SUP QUEUES
"KRN",19,2928021,-1)
1^89
"KRN",19,2928021,0)
BPS SUP SPECIAL LOG FILES
"KRN",19,2928022,-1)
1^90
"KRN",19,2928022,0)
BPS SUP UNSTRAND CLAIMS
"KRN",19,2928023,-1)
1^91
"KRN",19,2928023,0)
BPS TECH - FILES
"KRN",19,2928024,-1)
1^92
"KRN",19,2928024,0)
BPS TECH - OPTIONS
"KRN",19,2928025,-1)
1^93
"KRN",19,2928025,0)
BPS TEST MESSAGE
"KRN",19,2928026,-1)
1^94
"KRN",19,2928026,0)
BPS TRANS STATUS BY CLAIM
"KRN",19,2928027,-1)
1^95
"KRN",19,2928027,0)
BPS TURNAROUND STATS
"KRN",19,2928028,-1)
1^96
"KRN",19,2928028,0)
BPS UNBILLABLE DRUG
"KRN",19,2928029,-1)
1^97
"KRN",19,2928029,0)
BPS UNBILLABLE MENU
"KRN",19,2928030,-1)
1^98
"KRN",19,2928030,0)
BPS UNBILLABLE NDC
"KRN",19,2928031,-1)
1^99
"KRN",19,2928031,0)
BPS UNBILLABLE OTC
"KRN",19,2928032,-1)
1^100
"KRN",19,2928032,0)
BPS UPDATE REPORT MASTER FILE
"KRN",19,2928033,-1)
1^102
"KRN",19,2928033,0)
BPS USER PREFERENCES
"KRN",19,2928034,-1)
1^104
"KRN",19,2928034,0)
BPS VOLUME SURVEY
"KRN",19,2928035,-1)
1^109
"KRN",19,2928035,0)
BPS OLD RPT REVERSAL
"KRN",19,2928036,-1)
1^110
"KRN",19,2928036,0)
BPS OLD RPT REJECTION
"KRN",19,2928037,-1)
1^111
"KRN",19,2928037,0)
BPS OLD RPT PAYABLE
"KRN",19,2928038,-1)
1^112
"KRN",19,2928038,0)
BPS OLD RPT NOTRELEAS
"KRN",19,2928039,-1)
1^113
"KRN",19,2928039,0)
BPS MENU OLD CLAIM STATUS RPT
"KRN",19,2928040,-1)
1^119
"KRN",19,2928040,0)
BPS BILLING MENU
"KRN",19,2928041,-1)
1^120
"KRN",19,2928041,0)
BPS BILLING MENU FOR ILC A/R
"KRN",19,2928042,-1)
1^121
"KRN",19,2928042,0)
BPS USER MENU
"KRN",19,2928043,-1)
1^122
"KRN",19,2928043,0)
BPS WRITEOFF SELECTION
"KRN",19,2928044,-1)
1^123
"KRN",19,2928044,0)
BPS STATS SCREEN
"KRN",19.1,925,-1)
0^2
"KRN",19.1,925,0)
BPS MANAGER^Pharmacy ECME manager
"KRN",19.1,925,1,0)
^^1^1^3040805^
"KRN",19.1,925,1,1,0)
Access to the manager menu.
"KRN",19.1,926,-1)
0^3
"KRN",19.1,926,0)
BPS REPORTS^Pharmacy ECME reports
"KRN",19.1,926,1,0)
^^1^1^3040805^
"KRN",19.1,926,1,1,0)
Access to the reports menu.
"KRN",19.1,927,-1)
0^4
"KRN",19.1,927,0)
BPS USER^Phamacy ECME user
"KRN",19.1,927,1,0)
^^1^1^3040805^
"KRN",19.1,927,1,1,0)
Access to the user menu.
"KRN",19.1,928,-1)
0^5
"KRN",19.1,928,0)
BPSMENU^Pharmacy ECME main menu
"KRN",19.1,928,1,0)
^^1^1^3040805^
"KRN",19.1,928,1,1,0)
Access to the ECME main menu.
"KRN",19.1,928,5,0)
^19.15P^^0
"KRN",19.1,939,-1)
0^6
"KRN",19.1,939,0)
BPS MASTER^Master ECME key
"KRN",19.1,942,-1)
1^1
"KRN",19.1,942,0)
BPS BILLER
"KRN",19.1,943,-1)
1^7
"KRN",19.1,943,0)
BPSZ BILLER
"KRN",19.1,944,-1)
1^8
"KRN",19.1,944,0)
BPSZ MANAGER
"KRN",19.1,945,-1)
1^9
"KRN",19.1,945,0)
BPSZ REPORTS
"KRN",19.1,946,-1)
1^10
"KRN",19.1,946,0)
BPSZ USER
"KRN",19.1,947,-1)
1^11
"KRN",19.1,947,0)
BPSZMENU
"KRN",101,186,-1)
4^79
"KRN",101,186,0)
VALM REFRESH
"KRN",101,192,-1)
4^78
"KRN",101,192,0)
VALM QUIT
"KRN",101,194,-1)
4^77
"KRN",101,194,0)
VALM PRINT LIST
"KRN",101,196,-1)
4^82
"KRN",101,196,0)
VALM TURN ON/OFF MENUS
"KRN",101,198,-1)
4^81
"KRN",101,198,0)
VALM SEARCH LIST
"KRN",101,205,-1)
4^80
"KRN",101,205,0)
VALM RIGHT
"KRN",101,206,-1)
4^76
"KRN",101,206,0)
VALM LEFT
"KRN",101,7150,-1)
0^5
"KRN",101,7150,0)
BPS P1 CONTINUOUS^Continuous update^^A^^^^^^^^
"KRN",101,7150,4)
26^5
"KRN",101,7150,20)
D CONTUPD^BPSOS6A
"KRN",101,7150,99)
60305,51273
"KRN",101,7151,-1)
0^9
"KRN",101,7151,0)
BPS P1 NEW CLAIMS^Send new claims^^A^^^^^^^^
"KRN",101,7151,4)
26^5
"KRN",101,7151,20)
DO NEW^BPSOS6C
"KRN",101,7151,99)
60305,51273
"KRN",101,7155,-1)
0^11
"KRN",101,7155,0)
BPS P1 PRINT PATIENT^Print single patient^^A^^^^^^^^
"KRN",101,7155,4)
26^5^^PP
"KRN",101,7155,20)
DO PRINT^BPSOS6D
"KRN",101,7155,99)
60305,51273
"KRN",101,7157,-1)
0^21
"KRN",101,7157,0)
BPS P2 UPDATE^Display update^^A^^^^^^^^
"KRN",101,7157,4)
26^5
"KRN",101,7157,20)
D UPD^BPSOS2
"KRN",101,7157,99)
60305,51273
"KRN",101,7159,-1)
0^24
"KRN",101,7159,0)
BPS PROTOCOL 2^Point-of-Sale Management^^M^^BPS MANAGER^^^^^^
"KRN",101,7159,2,0)
^101.02A^1^1
"KRN",101,7159,2,1,0)
POK
"KRN",101,7159,2,"B","POK",1)

"KRN",101,7159,4)
26^5
"KRN",101,7159,10,0)
^101.01PA^7^7
"KRN",101,7159,10,4,0)
7439^UC^21^
"KRN",101,7159,10,4,"^")
BPS P2 CONTINUOUS
"KRN",101,7159,10,5,0)
7157^U1^22^
"KRN",101,7159,10,5,"^")
BPS P2 UPDATE
"KRN",101,7159,10,6,0)
7160^Z^31^
"KRN",101,7159,10,6,"^")
BPS P2 ZERO
"KRN",101,7159,10,7,0)
7440^EX^41^^^Exit
"KRN",101,7159,10,7,"^")
BPS P1 EXIT
"KRN",101,7159,26)
DO SHOW^VALM
"KRN",101,7159,28)
Select Action:
"KRN",101,7159,99)
60305,51273
"KRN",101,7160,-1)
0^22
"KRN",101,7160,0)
BPS P2 ZERO^Zero (clear) stats^^A^^^^^^^^
"KRN",101,7160,4)
26^5
"KRN",101,7160,20)
DO ZERO^BPSOS2A
"KRN",101,7160,99)
60305,51273
"KRN",101,7163,-1)
0^20
"KRN",101,7163,0)
BPS P2 TRANSMITTER^Transmitter status^^A^^^^^^^^
"KRN",101,7163,4)
26^5
"KRN",101,7163,20)
DO TMR^BPSOS2A
"KRN",101,7163,99)
60305,51273
"KRN",101,7164,-1)
0^19
"KRN",101,7164,0)
BPS P2 TMIT JOBS^Number of transmitters^^A^^^^^^^^
"KRN",101,7164,4)
26^5
"KRN",101,7164,20)
DO JOBS^BPSOS2A
"KRN",101,7164,99)
60305,51273
"KRN",101,7165,-1)
0^18
"KRN",101,7165,0)
BPS P2 POKE^Poke the queues^^A^^^^^^^^
"KRN",101,7165,4)
26^5
"KRN",101,7165,20)
D POK^BPSOS2A
"KRN",101,7165,99)
60305,51273
"KRN",101,7167,-1)
0^13
"KRN",101,7167,0)
BPS P1 RECEIPT^Print receipt/DUR info^^A^^^^^^^^
"KRN",101,7167,2,0)
^101.02A^1^1
"KRN",101,7167,2,1,0)
DUR
"KRN",101,7167,2,"B","DUR",1)

"KRN",101,7167,4)
^^^
"KRN",101,7167,20)
DO RECEIPT^BPSOS6D
"KRN",101,7167,99)
60305,51273
"KRN",101,7169,-1)
0^1
"KRN",101,7169,0)
BPS HIDDEN ACTIONS^ECME Hidden Actions^^M^^^^^^^^
"KRN",101,7169,4)
26
"KRN",101,7169,10,0)
^101.01PA^3^1
"KRN",101,7169,10,3,0)
7170^Q^^
"KRN",101,7169,10,3,"^")
BPS P1 QUIT
"KRN",101,7169,99)
60305,51273
"KRN",101,7170,-1)
0^12
"KRN",101,7170,0)
BPS P1 QUIT^Quit^^A^^^^^^^^
"KRN",101,7170,2,0)
^101.02A^1^1
"KRN",101,7170,2,1,0)
Q
"KRN",101,7170,2,"B","Q",1)

"KRN",101,7170,15)
S ECMEQUIT=1
"KRN",101,7170,20)
S ECMEQUIT=1
"KRN",101,7170,99)
60305,51273
"KRN",101,7171,-1)
0^25
"KRN",101,7171,0)
BPSJ MFN REGISTER1^EPharm Site Register^^S^^^^^^^^
"KRN",101,7171,1,0)
^101.06^1^1^3031124^^^
"KRN",101,7171,1,1,0)
This message is generated when a VISTA site installs.
"KRN",101,7171,99)
60305,51273
"KRN",101,7171,770)
^E-PHARM VITRIA^^M01^^^EPHARM OUT^^^^ACK
"KRN",101,7171,773)
1^1
"KRN",101,7172,-1)
0^28
"KRN",101,7172,0)
BPSJ REGISTER^EPharm Registration Event^^E^^^^^^^^
"KRN",101,7172,1,0)
^101.06^1^1^3031124^^^^
"KRN",101,7172,1,1,0)
The epharmacy event driver.
"KRN",101,7172,99)
60305,51273
"KRN",101,7172,770)
E-PHARM VISTA^^MFN^M01^^^^AL^AL^2.4^
"KRN",101,7172,772)
D ^BPSJHLI
"KRN",101,7172,775,0)
^101.0775PA^1^1
"KRN",101,7172,775,1,0)
7171
"KRN",101,7172,775,1,"^")
BPSJ MFN REGISTER1
"KRN",101,7180,-1)
0^75
"KRN",101,7180,0)
BPS ECMESV1 NTE^NCPDP SERVER^^E^^^^^^^^
"KRN",101,7180,99)
60305,51273
"KRN",101,7180,770)
ECME VISTA^VITRIA NC^ORU^R01^^^BPS NCPDP^NE^AL^2.4^ACK
"KRN",101,7180,771)

"KRN",101,7180,772)
D STORESP^BPSECMC2
"KRN",101,7180,773)
1^1^0
"KRN",101,7180,775,0)
^101.0775PA^1^1
"KRN",101,7180,775,1,0)
7181
"KRN",101,7180,775,1,"^")
BPS ECMECL1 NTE
"KRN",101,7181,-1)
0^74
"KRN",101,7181,0)
BPS ECMECL1 NTE^^^S^^^^^^^^
"KRN",101,7181,1,0)
^^1^1^3050915^
"KRN",101,7181,1,1,0)
NCPDP CLIENT
"KRN",101,7181,770)
VITRIA NC^VITRIA NC^RPI^R02^^^BPS NCPDP^AL^NE^2.4^ORF
"KRN",101,7181,771)

"KRN",101,7181,772)
D STORESP^BPSECMC2
"KRN",101,7181,773)
1^1^0
"KRN",101,7181,774)

"KRN",101,7181,775,0)
^101.0775PA^1^1
"KRN",101,7181,775,1,0)
4888
"KRN",101,7181,775,"B",4888,1)

"KRN",101,7187,-1)
0^26
"KRN",101,7187,0)
BPSJ PAYER INPUT^EPharm Payer Sheets Input^^E^^^^^^^^
"KRN",101,7187,1,0)
^^1^1^3031216^^^^
"KRN",101,7187,1,1,0)
The epharmacy payer sheet event driver.
"KRN",101,7187,4)
^^^
"KRN",101,7187,99)
60305,51273
"KRN",101,7187,770)
E-PHARM VITRIA^^MFN^M01^^^^AL^AL^2.4^
"KRN",101,7187,772)
D ^BPSJHLI
"KRN",101,7187,775,0)
^101.0775PA^1^1
"KRN",101,7187,775,1,0)
7188
"KRN",101,7187,775,1,"^")
BPSJ PAYER RESPONSE
"KRN",101,7188,-1)
0^27
"KRN",101,7188,0)
BPSJ PAYER RESPONSE^EPharm Payer Sheets Response^^S^^^^^^^^
"KRN",101,7188,1,0)
^^1^1^3031219^^^^
"KRN",101,7188,1,1,0)
RESPONSE PROTOCOL FOR PAYER SHEET INPUT.
"KRN",101,7188,4)
^^^
"KRN",101,7188,99)
60305,51273
"KRN",101,7188,770)
^E-PHARM VISTA^^M01^^^EPHARM OUT^^^^MFK
"KRN",101,7188,771)
D ^BPSJHLI
"KRN",101,7188,773)
0^1
"KRN",101,7349,-1)
0^39
"KRN",101,7349,0)
BPS PRTCL ECME USRSCR^ECME User Options^^M^^^^^^^^
"KRN",101,7349,4)
26^4
"KRN",101,7349,10,0)
^101.01PA^13^13
"KRN",101,7349,10,2,0)
7350^REV^5^
"KRN",101,7349,10,2,"^")
BPS PRTCL USRSCR REVERSE
"KRN",101,7349,10,3,0)
7351^CU^1^
"KRN",101,7349,10,3,"^")
BPS PRTCL USRSCR CONTINUOUS
"KRN",101,7349,10,4,0)
7352^RES^6^
"KRN",101,7349,10,4,"^")
BPS PRTCL USRSCR RESUBMIT
"KRN",101,7349,10,5,0)
7353^UD^2^
"KRN",101,7349,10,5,"^")
BPS PRTCL USRSCR UPDATE
"KRN",101,7349,10,6,0)
7354^SO^4^
"KRN",101,7349,10,6,"^")
BPS PRTCL USRSCR SORTLIST
"KRN",101,7349,10,7,0)
7355^CMT^8^
"KRN",101,7349,10,7,"^")
BPS PRTCL USRSCR COMMENT
"KRN",101,7349,10,8,0)
7356^FR^9^
"KRN",101,7349,10,8,"^")
BPS PRTCL USRSCR RESEARCH MENU
"KRN",101,7349,10,9,0)
7357^PD^10^
"KRN",101,7349,10,9,"^")
BPS PRTCL USRSCR PRINT
"KRN",101,7349,10,10,0)
7358^LOG^11^
"KRN",101,7349,10,10,"^")
BPS PRTCL USRSCR CLAIM LOG
"KRN",101,7349,10,11,0)
7359^CLO^7^
"KRN",101,7349,10,11,"^")
BPS PRTCL USRSCR CLOSE
"KRN",101,7349,10,12,0)
7369^CV^3^
"KRN",101,7349,10,12,"^")
BPS PRTCL USRSCR CHANGE VIEW
"KRN",101,7349,10,13,0)
7371^EX^12^
"KRN",101,7349,10,13,"^")
BPS PRTCL USRSCR EXIT
"KRN",101,7349,26)
DO SHOW^VALM
"KRN",101,7349,28)
Select Action: 
"KRN",101,7349,99)
60305,51273
"KRN",101,7350,-1)
0^63
"KRN",101,7350,0)
BPS PRTCL USRSCR REVERSE^Reverse Payable Claim^^A^^^^^^^^
"KRN",101,7350,20)
D REV^BPSSCRRV
"KRN",101,7350,99)
60305,51273
"KRN",101,7351,-1)
0^56
"KRN",101,7351,0)
BPS PRTCL USRSCR CONTINUOUS^Continuous Update^^A^^^^^^^^
"KRN",101,7351,20)
D CU^BPSSCRCU
"KRN",101,7351,99)
60305,51273
"KRN",101,7352,-1)
0^62
"KRN",101,7352,0)
BPS PRTCL USRSCR RESUBMIT^Resubmit Claim^^A^^^^^^^^
"KRN",101,7352,20)
D RES^BPSSCRRS
"KRN",101,7352,99)
60305,51273
"KRN",101,7353,-1)
0^65
"KRN",101,7353,0)
BPS PRTCL USRSCR UPDATE^Display Update^^A^^^^^^^^
"KRN",101,7353,20)
D UD^BPSSCRUD
"KRN",101,7353,99)
60305,51273
"KRN",101,7354,-1)
0^64
"KRN",101,7354,0)
BPS PRTCL USRSCR SORTLIST^Sort List^^A^^^^^^^^
"KRN",101,7354,20)
D SL^BPSSCRSL
"KRN",101,7354,99)
60305,51273
"KRN",101,7355,-1)
0^55
"KRN",101,7355,0)
BPS PRTCL USRSCR COMMENT^Add/View Comments^^A^^^^^^^^
"KRN",101,7355,20)
D CMT^BPSCMT
"KRN",101,7355,99)
60305,51273
"KRN",101,7356,-1)
0^61
"KRN",101,7356,0)
BPS PRTCL USRSCR RESEARCH MENU^Further Research^^A^^^^^^^^
"KRN",101,7356,20)
D RM^BPSRSM
"KRN",101,7356,99)
60305,51273
"KRN",101,7357,-1)
0^60
"KRN",101,7357,0)
BPS PRTCL USRSCR PRINT^Print Data^^A^^^^^^^^
"KRN",101,7357,20)
D PR^BPSSCRPR
"KRN",101,7357,99)
60305,51273
"KRN",101,7358,-1)
0^53
"KRN",101,7358,0)
BPS PRTCL USRSCR CLAIM LOG^Print Claim Log^^A^^^^^^^^
"KRN",101,7358,20)
D LOG^BPSSCRLG
"KRN",101,7358,99)
60305,51273
"KRN",101,7359,-1)
0^54
"KRN",101,7359,0)
BPS PRTCL USRSCR CLOSE^Close Rejected Claim^^A^^^^^^^^
"KRN",101,7359,20)
D CLO^BPSSCRCL
"KRN",101,7359,99)
60305,51273
"KRN",101,7360,-1)
0^44
"KRN",101,7360,0)
BPS PRTCL RSCH MENU^Research Menu^^M^^^^^^^^
"KRN",101,7360,4)
26^5
"KRN",101,7360,10,0)
^101.01PA^10^10
"KRN",101,7360,10,1,0)
7361^INS^2^
"KRN",101,7360,10,1,"^")
BPS PRTCL RSCH VIEW INSURANCE
"KRN",101,7360,10,2,0)
7362^VE^5^
"KRN",101,7360,10,2,"^")
BPS PRTCL RSCH VIEW ELIGIBILITY
"KRN",101,7360,10,3,0)
7363^VP^8^
"KRN",101,7360,10,3,"^")
BPS PRTCL RSCH VIEW PRESCRIPTION
"KRN",101,7360,10,4,0)
7364^CT^12^
"KRN",101,7360,10,4,"^")
BPS PRTCL RSCH CLAIM TRACKING
"KRN",101,7360,10,5,0)
7365^TPJI^22^
"KRN",101,7360,10,5,"^")
BPS PRTCL RSCH TPJI
"KRN",101,7360,10,6,0)
7366^EVNT^38^
"KRN",101,7360,10,6,"^")
BPS PRTCL RSCH IB EVENT REPORT
"KRN",101,7360,10,7,0)
7367^OH^30^
"KRN",101,7360,10,7,"^")
BPS PRTCL RSCH ON HOLD COPAY
"KRN",101,7360,10,8,0)
7368^RH^34^
"KRN",101,7360,10,8,"^")
BPS PRTCL RSCH RELEASE COPAY
"KRN",101,7360,10,9,0)
7370^EX^48^
"KRN",101,7360,10,9,"^")
BPS PRTCL RSCH EXIT
"KRN",101,7360,10,10,0)
7355^CMT^10^
"KRN",101,7360,10,10,"^")
BPS PRTCL USRSCR COMMENT
"KRN",101,7360,26)
DO SHOW^VALM
"KRN",101,7360,28)
Select action:
"KRN",101,7360,99)
60305,51273
"KRN",101,7361,-1)
0^50
"KRN",101,7361,0)
BPS PRTCL RSCH VIEW INSURANCE^Insurance details^^A^^^^^^^^
"KRN",101,7361,20)
D VI^BPSRSINS
"KRN",101,7361,99)
60305,51273
"KRN",101,7362,-1)
0^49
"KRN",101,7362,0)
BPS PRTCL RSCH VIEW ELIGIBILITY^View Eligibility^^A^^^^^^^^
"KRN",101,7362,20)
D VE^BPSRSELG
"KRN",101,7362,99)
60305,51273
"KRN",101,7363,-1)
0^51
"KRN",101,7363,0)
BPS PRTCL RSCH VIEW PRESCRIPTION^View Prescription^^A^^^^^^^^
"KRN",101,7363,20)
D VP^BPSRSPRS
"KRN",101,7363,99)
60305,51273
"KRN",101,7364,-1)
0^41
"KRN",101,7364,0)
BPS PRTCL RSCH CLAIM TRACKING^Claims Tracking^^A^^^^^^^^
"KRN",101,7364,20)
D CT^BPSCT
"KRN",101,7364,99)
60305,51273
"KRN",101,7365,-1)
0^47
"KRN",101,7365,0)
BPS PRTCL RSCH TPJI^Third Party Inquiry^^A^^^^^^^^
"KRN",101,7365,20)
D TPJI^BPSRSTPJ
"KRN",101,7365,99)
60305,51273
"KRN",101,7366,-1)
0^43
"KRN",101,7366,0)
BPS PRTCL RSCH IB EVENT REPORT^IB Events Report^^A^^^^^^^^
"KRN",101,7366,4)
^^^EVNT
"KRN",101,7366,20)
D EVNT^BPSRSEV
"KRN",101,7366,99)
60305,51273
"KRN",101,7367,-1)
0^45
"KRN",101,7367,0)
BPS PRTCL RSCH ON HOLD COPAY^On Hold Copay Listing^^A^^^^^^^^
"KRN",101,7367,20)
D OH^BPSRSHLD
"KRN",101,7367,99)
60305,51273
"KRN",101,7368,-1)
0^46
"KRN",101,7368,0)
BPS PRTCL RSCH RELEASE COPAY^Release Copay^^A^^^^^^^^
"KRN",101,7368,20)
D RH^BPSRSRLC
"KRN",101,7368,99)
60305,51273
"KRN",101,7369,-1)
0^52
"KRN",101,7369,0)
BPS PRTCL USRSCR CHANGE VIEW^Change View^^A^^^^^^^^
"KRN",101,7369,20)
D CV^BPSSCRCV
"KRN",101,7369,99)
60305,51273
"KRN",101,7370,-1)
0^42
"KRN",101,7370,0)
BPS PRTCL RSCH EXIT^Exit^^A^^^^^^^^
"KRN",101,7370,15)

"KRN",101,7370,20)

"KRN",101,7370,99)
60305,51273
"KRN",101,7371,-1)
0^58
"KRN",101,7371,0)
BPS PRTCL USRSCR EXIT^Exit^^A^^^^^^^^
"KRN",101,7371,20)

"KRN",101,7371,99)
60305,51273
"KRN",101,7378,-1)
0^38
"KRN",101,7378,0)
BPS PRTCL CMT MENU^menu protocol for comments^^M^^^^^^^^
"KRN",101,7378,4)
26^4
"KRN",101,7378,10,0)
^101.01PA^2^2
"KRN",101,7378,10,1,0)
7379^A^1^
"KRN",101,7378,10,1,"^")
BPS PRTCL CMT ADD
"KRN",101,7378,10,2,0)
7380^EX^2^
"KRN",101,7378,10,2,"^")
BPS PRTCL CMT EXIT
"KRN",101,7378,26)
DO SHOW^VALM
"KRN",101,7378,28)
Select action: 
"KRN",101,7378,99)
60305,51273
"KRN",101,7379,-1)
0^36
"KRN",101,7379,0)
BPS PRTCL CMT ADD^Add Comment^^A^^^^^^^^
"KRN",101,7379,20)
D ADD^BPSCMT01
"KRN",101,7379,99)
60305,51273
"KRN",101,7380,-1)
0^37
"KRN",101,7380,0)
BPS PRTCL CMT EXIT^Exit^^A^^^^^^^^
"KRN",101,7380,99)
60305,51273
"KRN",101,7381,-1)
0^59
"KRN",101,7381,0)
BPS PRTCL USRSCR HIDDEN ACTIONS^ECME User Screen Hidden Actions^^M^^^^^^^^
"KRN",101,7381,10,0)
^101.01PA^27^27
"KRN",101,7381,10,2,0)
7408^-^12^
"KRN",101,7381,10,2,"^")
BPS VALM PREVIOUS SCREEN
"KRN",101,7381,10,10,0)
7410^PS^25^
"KRN",101,7381,10,10,"^")
BPS VALM PRINT SCREEN
"KRN",101,7381,10,11,0)
7413^LS^22^
"KRN",101,7381,10,11,"^")
BPS VALM LAST SCREEN
"KRN",101,7381,10,12,0)
7412^FS^20^
"KRN",101,7381,10,12,"^")
BPS VALM FIRST SCREEN
"KRN",101,7381,10,16,0)
7382^DV^40^
"KRN",101,7381,10,16,"^")
BPS PRTCL USRSCR DEVELOPER LOG
"KRN",101,7381,10,17,0)
7409^+^11^
"KRN",101,7381,10,17,"^")
BPS VALM NEXT SCREEN
"KRN",101,7381,10,18,0)
7406^DN^14^
"KRN",101,7381,10,18,"^")
BPS VALM DOWN A LINE
"KRN",101,7381,10,19,0)
7407^UP^13^
"KRN",101,7381,10,19,"^")
BPS VALM UP ONE LINE
"KRN",101,7381,10,20,0)
7411^GO^23^
"KRN",101,7381,10,20,"^")
BPS VALM GOTO PAGE
"KRN",101,7381,10,21,0)
205^>^15^
"KRN",101,7381,10,21,"^")
VALM RIGHT
"KRN",101,7381,10,22,0)
206^<^16^
"KRN",101,7381,10,22,"^")
VALM LEFT
"KRN",101,7381,10,23,0)
186^RD^24^
"KRN",101,7381,10,23,"^")
VALM REFRESH
"KRN",101,7381,10,24,0)
194^PL^26^
"KRN",101,7381,10,24,"^")
VALM PRINT LIST
"KRN",101,7381,10,25,0)
198^SL^31^
"KRN",101,7381,10,25,"^")
VALM SEARCH LIST
"KRN",101,7381,10,26,0)
196^ADPL^32^
"KRN",101,7381,10,26,"^")
VALM TURN ON/OFF MENUS
"KRN",101,7381,10,27,0)
192^Q^33^
"KRN",101,7381,10,27,"^")
VALM QUIT
"KRN",101,7381,99)
60305,51273
"KRN",101,7382,-1)
0^57
"KRN",101,7382,0)
BPS PRTCL USRSCR DEVELOPER LOG^Print Developer Claim Log^^A^^^^^^^^
"KRN",101,7382,20)
D DV^BPSSCRDV
"KRN",101,7382,99)
60305,51273
"KRN",101,7383,-1)
0^40
"KRN",101,7383,0)
BPS PRTCL LOG MENU^Menu protocol for LOG^^M^^^^^^^^
"KRN",101,7383,4)
26^4
"KRN",101,7383,10,0)
^101.01PA^2^2
"KRN",101,7383,10,1,0)
7357^PR^1^
"KRN",101,7383,10,1,"^")
BPS PRTCL USRSCR PRINT
"KRN",101,7383,10,2,0)
7371^EX^3^
"KRN",101,7383,10,2,"^")
BPS PRTCL USRSCR EXIT
"KRN",101,7383,26)
DO SHOW^VALM
"KRN",101,7383,28)
Select action:
"KRN",101,7383,99)
60305,51273
"KRN",101,7384,-1)
0^48
"KRN",101,7384,0)
BPS PRTCL RSCH VIEW ELIG MENU^Menu protocol for View Eligibility Menu^^M^^^^^^^^
"KRN",101,7384,10,0)
^101.01PA^1^1
"KRN",101,7384,10,1,0)
7370^EX^1^
"KRN",101,7384,10,1,"^")
BPS PRTCL RSCH EXIT
"KRN",101,7384,99)
60305,51273
"KRN",101,7400,-1)
0^31
"KRN",101,7400,0)
BPS PRTCL UNSTRAND^ECME Unstrand Options^^M^^^^^^^^
"KRN",101,7400,4)
27^4
"KRN",101,7400,10,0)
^101.01PA^4^4
"KRN",101,7400,10,1,0)
7401^ALL^1^
"KRN",101,7400,10,1,"^")
BPS PRTCL UNSTRAND ALL
"KRN",101,7400,10,2,0)
7402^SEL^2^
"KRN",101,7400,10,2,"^")
BPS PRTCL UNSTRAND SELECT
"KRN",101,7400,10,3,0)
7403^PRT^3^
"KRN",101,7400,10,3,"^")
BPS PRTCL UNSTRAND PRINT
"KRN",101,7400,10,4,0)
7404^EX^4^
"KRN",101,7400,10,4,"^")
BPS PRTCL UNSTRAND EXIT
"KRN",101,7400,15)

"KRN",101,7400,26)
DO SHOW^VALM
"KRN",101,7400,28)
Select action: 
"KRN",101,7400,99)
60305,51273
"KRN",101,7401,-1)
0^32
"KRN",101,7401,0)
BPS PRTCL UNSTRAND ALL^Unstrand Current Claims^^A^^^^^^^^
"KRN",101,7401,2,0)
^101.02A^1^1
"KRN",101,7401,2,1,0)
ALL
"KRN",101,7401,2,"B","ALL",1)

"KRN",101,7401,15)
S VALMBCK="R"
"KRN",101,7401,20)
D ALL^BPSUSCR1
"KRN",101,7401,99)
60305,51273
"KRN",101,7402,-1)
0^33
"KRN",101,7402,0)
BPS PRTCL UNSTRAND SELECT^Select Claims to Unstrand^^A^^^^^^^^
"KRN",101,7402,2,0)
^101.02A^1^1
"KRN",101,7402,2,1,0)
SEL
"KRN",101,7402,2,"B","SEL",1)

"KRN",101,7402,10,0)
^101.01PA^^0
"KRN",101,7402,15)
S VALMBCK="R"
"KRN",101,7402,20)
D SELECT^BPSUSCR1
"KRN",101,7402,99)
60305,51273
"KRN",101,7403,-1)
0^34
"KRN",101,7403,0)
BPS PRTCL UNSTRAND PRINT^Print Current Claims^^A^^^^^^^^
"KRN",101,7403,15)
S VALMBCK="R"
"KRN",101,7403,20)
D PRINT^BPSUSCR1
"KRN",101,7403,99)
60305,51273
"KRN",101,7404,-1)
0^35
"KRN",101,7404,0)
BPS PRTCL UNSTRAND EXIT^Exit^^A^^^^^^^^
"KRN",101,7404,2,0)
^101.02A^1^1
"KRN",101,7404,2,1,0)
EXT
"KRN",101,7404,2,"B","EXT",1)

"KRN",101,7404,15)
D EXIT^BPSUSCR
"KRN",101,7404,99)
60305,51273
"KRN",101,7406,-1)
0^66
"KRN",101,7406,0)
BPS VALM DOWN A LINE^Down a Line^^A^^^^^^^^
"KRN",101,7406,20)
D DOWN^VALM40
"KRN",101,7406,99)
60305,51273
"KRN",101,7407,-1)
0^67
"KRN",101,7407,0)
BPS VALM UP ONE LINE^Up a Line^^A^^^^^^^^
"KRN",101,7407,20)
D UP^VALM40
"KRN",101,7407,99)
60305,51273
"KRN",101,7408,-1)
0^72
"KRN",101,7408,0)
BPS VALM PREVIOUS SCREEN^Previous Screen^^A^^^^^^^^
"KRN",101,7408,1,0)
^^1^1^3050803^
"KRN",101,7408,1,1,0)
This action will allow the user to view the previous screen of entries, if any exist.
"KRN",101,7408,2,0)
^101.02A^1^1
"KRN",101,7408,2,1,0)
PR
"KRN",101,7408,2,"B","PR",1)

"KRN",101,7408,20)
D PREV^VALM4
"KRN",101,7408,99)
60305,51273
"KRN",101,7409,-1)
0^71
"KRN",101,7409,0)
BPS VALM NEXT SCREEN^Next Screen^^A^^^^^^^^
"KRN",101,7409,20)
D NEXT^VALM4
"KRN",101,7409,99)
60305,51273
"KRN",101,7410,-1)
0^73
"KRN",101,7410,0)
BPS VALM PRINT SCREEN^Print Screen^^A^^^^^^^^
"KRN",101,7410,20)
D PRT^VALM1
"KRN",101,7410,99)
60305,51273
"KRN",101,7411,-1)
0^69
"KRN",101,7411,0)
BPS VALM GOTO PAGE^Go to Page^^A^^^^^^^^
"KRN",101,7411,20)
D GOTO^VALM40
"KRN",101,7411,99)
60305,51273
"KRN",101,7412,-1)
0^68
"KRN",101,7412,0)
BPS VALM FIRST SCREEN^First Screen^^A^^^^^^^^
"KRN",101,7412,20)
D FIRST^VALM4
"KRN",101,7412,99)
60305,51273
"KRN",101,7413,-1)
0^70
"KRN",101,7413,0)
BPS VALM LAST SCREEN^Last Screen^^A^^^^^^^^
"KRN",101,7413,20)
D LAST^VALM4
"KRN",101,7413,99)
60305,51273
"KRN",101,7439,-1)
0^17
"KRN",101,7439,0)
BPS P2 CONTINUOUS^Update continuously^^A^^^^^^^^
"KRN",101,7439,4)
26^5
"KRN",101,7439,20)
D CONTUPD^BPSOS2
"KRN",101,7439,99)
60305,51273
"KRN",101,7440,-1)
0^7
"KRN",101,7440,0)
BPS P1 EXIT^Exit^^A^^^^^^^^
"KRN",101,7440,.1)
Exit
"KRN",101,7440,2,0)
^101.02A^1^1
"KRN",101,7440,2,1,0)
EX
"KRN",101,7440,2,"B","E",1)

"KRN",101,7440,2,"B","EX",1)

"KRN",101,7440,10,0)
^101.01PA
"KRN",101,7440,15)
S ECMEQUIT=1
"KRN",101,7440,20)
S ECMEQUIT=1
"KRN",101,7440,99)
60305,51273
"KRN",101,7454,-1)
1^2
"KRN",101,7454,0)
BPS P1 CANCEL CLAIM
"KRN",101,7455,-1)
1^3
"KRN",101,7455,0)
BPS P1 CLAIM LOG
"KRN",101,7456,-1)
1^4
"KRN",101,7456,0)
BPS P1 CLOSE
"KRN",101,7457,-1)
1^6
"KRN",101,7457,0)
BPS P1 DISMISS
"KRN",101,7458,-1)
1^8
"KRN",101,7458,0)
BPS P1 HEADER
"KRN",101,7459,-1)
1^10
"KRN",101,7459,0)
BPS P1 PRINT ALL
"KRN",101,7460,-1)
1^14
"KRN",101,7460,0)
BPS P1 RESUBMIT
"KRN",101,7461,-1)
1^15
"KRN",101,7461,0)
BPS P1 REVERSE CLAIM
"KRN",101,7462,-1)
1^16
"KRN",101,7462,0)
BPS P1 UPDATE
"KRN",101,7463,-1)
1^23
"KRN",101,7463,0)
BPS PROTOCOL 1
"KRN",409.61,551,-1)
0^1
"KRN",409.61,551,0)
BPS STATISTICS AND MANAGEMENT^1^^80^3^18^0^1^^BPS PROTOCOL 2^ECME MANAGEMENT^1^^1
"KRN",409.61,551,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,551,"ARRAY")
 ^TMP("BPSOS2",$J)
"KRN",409.61,551,"FNL")
D EXIT^BPSOS2
"KRN",409.61,551,"HDR")
D HDR^BPSOS2
"KRN",409.61,551,"HLP")
D HELP^BPSOS2
"KRN",409.61,551,"INIT")
D INIT^BPSOS2
"KRN",409.61,590,-1)
0^6
"KRN",409.61,590,0)
BPS LSTMN ECME USRSCR^1^^80^6^18^0^1^LM template for User Screen^BPS PRTCL ECME USRSCR^PHARMACY ECME^1^^1
"KRN",409.61,590,1)
^BPS PRTCL USRSCR HIDDEN ACTIONS
"KRN",409.61,590,"ARRAY")
 ^TMP("BPSSCR",$J,"VALM")
"KRN",409.61,590,"COL",0)
^409.621^2^2
"KRN",409.61,590,"COL",1,0)
CAPTION^5^76^PATIENT/DRUG/COMMENTS       INSURANCE/NDC/RX#/ECME#            LOC/TYP RXINF^^0
"KRN",409.61,590,"COL",2,0)
LINENO^1^5^##
"KRN",409.61,590,"COL","AIDENT",0,1)

"KRN",409.61,590,"COL","B","CAPTION",1)

"KRN",409.61,590,"COL","B","LINENO",2)

"KRN",409.61,590,"FNL")
D EXIT^BPSSCR
"KRN",409.61,590,"HDR")
D HDR^BPSSCR
"KRN",409.61,590,"HLP")
D HELP^BPSSCR
"KRN",409.61,590,"INIT")
D INIT^BPSSCR
"KRN",409.61,591,-1)
0^8
"KRN",409.61,591,0)
BPS LSTMN RSCH MENU^1^^80^6^18^0^1^LM template for research menu^BPS PRTCL RSCH MENU^FURTHER RESEARCH SCREEN^1^^1
"KRN",409.61,591,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,591,"ARRAY")
 ^TMP("BPSSCR",$J,"VALM")
"KRN",409.61,591,"COL",0)
^409.621^2^2
"KRN",409.61,591,"COL",1,0)
LINENO^1^5^##
"KRN",409.61,591,"COL",2,0)
CAPTION^5^76^PATIENT/DRUG/COMMENTS       INSURANCE/NDC/RX#/ECME#       STATUS/LOC/RX INFO
"KRN",409.61,591,"COL","B","CAPTION",2)

"KRN",409.61,591,"COL","B","LINENO",1)

"KRN",409.61,591,"FNL")
D EXIT^BPSRSM
"KRN",409.61,591,"HDR")
D HDR^BPSRSM
"KRN",409.61,591,"HLP")
D HELP^BPSRSM
"KRN",409.61,591,"INIT")
D INIT^BPSRSM
"KRN",409.61,593,-1)
0^4
"KRN",409.61,593,0)
BPS LSTMN COMMENTS^1^^80^6^18^0^1^^BPS PRTCL CMT MENU^ADD/VIEW COMMENTS^1^^1
"KRN",409.61,593,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,593,"ARRAY")
 ^TMP("BPSCMT",$J,"VALM")
"KRN",409.61,593,"COL",0)
^409.621^2^2
"KRN",409.61,593,"COL",1,0)
LINENO^1^5^##
"KRN",409.61,593,"COL",2,0)
CAPTION^5^76^PATIENT/DRUG/COMMENTS       INSURANCE/NDC/RX#/ECME#       STATUS/LOC/RX INFO
"KRN",409.61,593,"COL","B","CAPTION",2)

"KRN",409.61,593,"COL","B","LINENO",1)

"KRN",409.61,593,"FNL")
D EXIT^BPSCMT
"KRN",409.61,593,"HDR")
D HDR^BPSCMT
"KRN",409.61,593,"HLP")
D HELP^BPSCMT
"KRN",409.61,593,"INIT")
D INIT^BPSCMT
"KRN",409.61,594,-1)
0^7
"KRN",409.61,594,0)
BPS LSTMN LOG^1^^80^4^21^0^1^^BPS PRTCL LOG MENU^PHARMACY ECME^1^^1
"KRN",409.61,594,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,594,"ARRAY")
 ^TMP("BPSLOG",$J,"VALM")
"KRN",409.61,594,"FNL")
D EXIT^BPSSCRLG
"KRN",409.61,594,"HDR")
D HDR^BPSSCRLG
"KRN",409.61,594,"HLP")
D HELP^BPSSCRLG
"KRN",409.61,594,"INIT")
D INIT^BPSSCRLG
"KRN",409.61,602,-1)
0^5
"KRN",409.61,602,0)
BPS LSTMN DEVLOG^1^^80^4^21^1^1^Developer Log^BPS PRTCL LOG MENU^DEVELOPER LOG^1^^1
"KRN",409.61,602,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,602,"ARRAY")
 ^TMP("BPSDV",$J,"VALM")
"KRN",409.61,602,"FNL")
D EXIT^BPSSCRDV
"KRN",409.61,602,"HDR")
D HDR^BPSSCRDV
"KRN",409.61,602,"HLP")
D HELP^BPSSCRDV
"KRN",409.61,602,"INIT")
D INIT^BPSSCRDV
"KRN",409.61,603,-1)
0^3
"KRN",409.61,603,0)
BPS LSTMN ECME UNSTRAND^1^^150^6^18^0^1^LM Unstrand Screen Template^BPS PRTCL UNSTRAND^PHARMACY ECME UNSTRAND CLAIMS^1^^1
"KRN",409.61,603,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,603,"ARRAY")
 ^TMP("BPSUSCR",$J)
"KRN",409.61,603,"COL",0)
^409.621^8^8
"KRN",409.61,603,"COL",1,0)
LINENO^1^3^ ##^^0
"KRN",409.61,603,"COL",2,0)
TRANDT^5^10^Trans DT^^0
"KRN",409.61,603,"COL",3,0)
PATNAME^16^20^Patient Name^^0
"KRN",409.61,603,"COL",4,0)
PT ID^37^6^ID^^0
"KRN",409.61,603,"COL",5,0)
RX#^42^12^Extern RX #
"KRN",409.61,603,"COL",6,0)
REFILL^55^2^RF^^0
"KRN",409.61,603,"COL",7,0)
RFDATE^58^8^Fill DT^^0
"KRN",409.61,603,"COL",8,0)
INSCO^69^20^Ins Co^^0
"KRN",409.61,603,"COL","AIDENT",0,1)

"KRN",409.61,603,"COL","AIDENT",0,2)

"KRN",409.61,603,"COL","AIDENT",0,3)

"KRN",409.61,603,"COL","AIDENT",0,4)

"KRN",409.61,603,"COL","AIDENT",0,6)

"KRN",409.61,603,"COL","AIDENT",0,7)

"KRN",409.61,603,"COL","AIDENT",0,8)

"KRN",409.61,603,"COL","B","INSCO",8)

"KRN",409.61,603,"COL","B","LINENO",1)

"KRN",409.61,603,"COL","B","PATNAME",3)

"KRN",409.61,603,"COL","B","PT ID",4)

"KRN",409.61,603,"COL","B","REFILL",6)

"KRN",409.61,603,"COL","B","RFDATE",7)

"KRN",409.61,603,"COL","B","RX#",5)

"KRN",409.61,603,"COL","B","TRANDT",2)

"KRN",409.61,603,"FNL")
D EXIT^BPSUSCR
"KRN",409.61,603,"HDR")
D HDR^BPSUSCR
"KRN",409.61,603,"HLP")
D HELP^BPSUSCR
"KRN",409.61,603,"INIT")
D INIT^BPSUSCR Q:$D(DUOUT)
"KRN",409.61,608,-1)
1^2
"KRN",409.61,608,0)
BPS USER SCREEN
"KRN",771,160,-1)
0^2
"KRN",771,160,0)
ECME VISTA^a^^^^^US
"KRN",771,160,"EC")
~^\&
"KRN",771,160,"FS")
|
"KRN",771,161,-1)
0^1
"KRN",771,161,0)
VITRIA NC^a^^^^^US
"KRN",771,161,"EC")
~^\&
"KRN",771,161,"FS")
|
"KRN",870,232,-1)
0^1
"KRN",870,232,0)
BPS NCPDP^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,232,200)
^3^^270^270^^^^^
"KRN",870,232,400)
10.224.187.131^1396^C^N^50^^N
"KRN",8989.51,374,-1)
0^1
"KRN",8989.51,374,0)
BPS USRSCR^Display claims for ONE or ALL users^1
"KRN",8989.51,374,1)
F^^
"KRN",8989.51,374,4,0)
^8989.514^1^1
"KRN",8989.51,374,4,1,0)
ECME
"KRN",8989.51,374,4,"B","ECME",1)

"KRN",8989.51,374,6)
F^^
"KRN",8989.51,374,30,0)
^8989.513I^1^1
"KRN",8989.51,374,30,1,0)
1^200
"MBREQ")
1
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",676,-1)
1^1
"PKG",676,0)
E CLAIMS MGMT ENGINE^BPS^ELECTRONIC CLAIMS MGT
"PKG",676,20,0)
^9.402P^^
"PKG",676,22,0)
^9.49I^1^1
"PKG",676,22,1,0)
1.0^3041011^3041103^327
"PKG",676,22,1,"PAH",1,0)
1^3060324^73329
"PKG",676,22,1,"PAH",1,1,0)
^^35^35^3060324
"PKG",676,22,1,"PAH",1,1,1,0)
PATCH OVERVIEW
"PKG",676,22,1,"PAH",1,1,2,0)
 
"PKG",676,22,1,"PAH",1,1,3,0)
The Healthcare Insurance Portability and Accountability Act National
"PKG",676,22,1,"PAH",1,1,4,0)
Council for Prescription Drug Programs (HIPAA NCPDP) initiative, whose
"PKG",676,22,1,"PAH",1,1,5,0)
ultimate goal is to provide functionality allowing electronic transmission
"PKG",676,22,1,"PAH",1,1,6,0)
of Outpatient Pharmacy (OP) prescription claims to payers and the receipt
"PKG",676,22,1,"PAH",1,1,7,0)
of claim responses (including drug utilization review responses and
"PKG",676,22,1,"PAH",1,1,8,0)
warnings) on a real-time basis, is being developed and introduced in a
"PKG",676,22,1,"PAH",1,1,9,0)
phased implementation strategy. This deployment strategy was utilized due
"PKG",676,22,1,"PAH",1,1,10,0)
to the complexity of the functionality and the number of product line
"PKG",676,22,1,"PAH",1,1,11,0)
dependencies.
"PKG",676,22,1,"PAH",1,1,12,0)
 
"PKG",676,22,1,"PAH",1,1,13,0)
This is the second part of the Electronic Claims Management Engine (ECME)
"PKG",676,22,1,"PAH",1,1,14,0)
package (in the BPS namespace), also known as the active build. It
"PKG",676,22,1,"PAH",1,1,15,0)
comprises of these patches: BPS*1*1, PSO*7*148, PSS*1*90, PSX*2*48 and
"PKG",676,22,1,"PAH",1,1,16,0)
IB*2*276.
"PKG",676,22,1,"PAH",1,1,17,0)
 
"PKG",676,22,1,"PAH",1,1,18,0)
This build will introduce functionality supporting Point of Service
"PKG",676,22,1,"PAH",1,1,19,0)
Outpatient Pharmacy claim and billing processing by collecting billing and
"PKG",676,22,1,"PAH",1,1,20,0)
clinical information within the prescription fill workflow process.  This
"PKG",676,22,1,"PAH",1,1,21,0)
build will create real-time electronic claims and send claim data to
"PKG",676,22,1,"PAH",1,1,22,0)
adjudicating payers from the new VistA Electronic Claims Management Engine
"PKG",676,22,1,"PAH",1,1,23,0)
(ECME) via the VistA HL7 module (using the PSO NCPDP link) to the Vitria
"PKG",676,22,1,"PAH",1,1,24,0)
server at the FSC in Austin, TX in a HIPAA compliant (NCPDP V. 5.1)
"PKG",676,22,1,"PAH",1,1,25,0)
format. Vitria will then store and forward these transactions to WebMD for
"PKG",676,22,1,"PAH",1,1,26,0)
final submission to the payer on a real-time basis. Payer responses will
"PKG",676,22,1,"PAH",1,1,27,0)
be received and returned to VistA in the appropriate manner (i.e. - claim
"PKG",676,22,1,"PAH",1,1,28,0)
transactions sent to Integrated Billing (IB), Drug Utilization responses
"PKG",676,22,1,"PAH",1,1,29,0)
and warnings sent to the Outpatient Pharmacy V. 7.0 package and rejections
"PKG",676,22,1,"PAH",1,1,30,0)
made available to the appropriate personnel for review and analysis).
"PKG",676,22,1,"PAH",1,1,31,0)
 
"PKG",676,22,1,"PAH",1,1,32,0)
Within VistA, throughout this process, constant bi-directional
"PKG",676,22,1,"PAH",1,1,33,0)
communication via API's between Outpatient Pharmacy, Integrated Billing,
"PKG",676,22,1,"PAH",1,1,34,0)
and ECME will process and generate these claim and billing transactions at
"PKG",676,22,1,"PAH",1,1,35,0)
the appropriate trigger points within the standard VA process workflow.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
278
"RTN","BPS01P1")
0^^B7654436
"RTN","BPS01P1",1,0)
BPS01P1 ;BHAM ISC/FCS/DRS - Initialize BPS setup file. ;06/01/2004
"RTN","BPS01P1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPS01P1",3,0)
 Q
"RTN","BPS01P1",4,0)
EN ;
"RTN","BPS01P1",5,0)
 N BPSFN
"RTN","BPS01P1",6,0)
 S BPSFN=9002313.99
"RTN","BPS01P1",7,0)
 S:$P($G(^BPS(BPSFN,1,0)),U,2)="" $P(^BPS(BPSFN,1,0),U,2)=10
"RTN","BPS01P1",8,0)
 S:'$D(^BPS(BPSFN,1,2)) ^BPS(BPSFN,1,2)="PCN"
"RTN","BPS01P1",9,0)
 S:'$D(^BPS(BPSFN,1,3)) ^BPS(BPSFN,1,3)=0
"RTN","BPS01P1",10,0)
 S:'$D(^BPS(BPSFN,1,"A/R INTERFACE")) ^BPS(BPSFN,1,"A/R INTERFACE")=1
"RTN","BPS01P1",11,0)
 S:'$D(^BPS(BPSFN,1,"BILLING - NEW")) ^BPS(BPSFN,1,"BILLING - NEW")=""
"RTN","BPS01P1",12,0)
 S:'$D(^BPS(BPSFN,1,"BPSOS6*")) ^BPS(BPSFN,1,"BPSOS6*")="1^1"
"RTN","BPS01P1",13,0)
 S:'$D(^BPS(BPSFN,1,"BPSOSM1")) ^BPS(BPSFN,1,"BPSOSM1")="^^^^"
"RTN","BPS01P1",14,0)
 S:'$D(^BPS(BPSFN,1,"CERTIFIER")) ^BPS(BPSFN,1,"CERTIFIER")=""
"RTN","BPS01P1",15,0)
 S:'$D(^BPS(BPSFN,1,"CREATING A/R")) ^BPS(BPSFN,1,"CREATING A/R")="2^0^0"
"RTN","BPS01P1",16,0)
 S:'$D(^BPS(BPSFN,1,"FORMS - NCPDP")) ^BPS(BPSFN,1,"FORMS - NCPDP")="1^1^0^1"
"RTN","BPS01P1",17,0)
 S:'$D(^BPS(BPSFN,1,"INPUT")) ^BPS(BPSFN,1,"INPUT")="1^1^1"
"RTN","BPS01P1",18,0)
 S:'$D(^BPS(BPSFN,1,"INS")) ^BPS(BPSFN,1,"INS")="15^1"
"RTN","BPS01P1",19,0)
 S:'$D(^BPS(BPSFN,1,"INS BASE SCORES")) ^BPS(BPSFN,1,"INS BASE SCORES")="900^0^0^0^0"
"RTN","BPS01P1",20,0)
 S:'$D(^BPS(BPSFN,1,"SITE TYPE")) ^BPS(BPSFN,1,"SITE TYPE")=0
"RTN","BPS01P1",21,0)
 S:'$D(^BPS(BPSFN,1,"STARTUP")) ^BPS(BPSFN,1,"STARTUP")=3030616
"RTN","BPS01P1",22,0)
 S:'$D(^BPS(BPSFN,1,"UNBILLABLE OTC")) ^BPS(BPSFN,1,"UNBILLABLE OTC")=1
"RTN","BPS01P1",23,0)
 S:'$D(^BPS(BPSFN,1,"WRITEOFF-SCREEN")) ^BPS(BPSFN,1,"WRITEOFF-SCREEN")=1
"RTN","BPS01P1",24,0)
 S:'$D(^BPS(BPSFN,1,"WINNOW")) ^BPS(BPSFN,1,"WINNOW")="400^100^100^100^31^366^31^366^100^100^366^0"
"RTN","BPS01P1",25,0)
 S:'$D(^BPS(BPSFN,1,"WINNOW LOGS")) ^BPS(BPSFN,1,"WINNOW LOGS")="^"
"RTN","BPS01P1",26,0)
 D REMOVE,CHGNAM
"RTN","BPS01P1",27,0)
 Q
"RTN","BPS01P1",28,0)
 ;
"RTN","BPS01P1",29,0)
REMOVE ; The following are unused nodes in ECME
"RTN","BPS01P1",30,0)
 N DID0,DID1,FILE,DA,DIK,DR,DIE,DIK,D0,DIC,X
"RTN","BPS01P1",31,0)
 S DA=0,DR=".03///@",DIE="^BPSC("
"RTN","BPS01P1",32,0)
 F  S DA=$O(^BPSC(DA)) Q:'DA  D ^DIE
"RTN","BPS01P1",33,0)
 S DR="1.08///@",DR(1)=2,DR(1,9002313.51)=2,DR(2,9002313.512,1)=1.08,DIE(1)="^BPS(9002313.51,"
"RTN","BPS01P1",34,0)
 S DID0=0
"RTN","BPS01P1",35,0)
 F  S DID0=$O(^BPS(9002313.51,DID0)) Q:'DID0  D
"RTN","BPS01P1",36,0)
 .  S DA(1)=DID0
"RTN","BPS01P1",37,0)
 .  S DID1=0
"RTN","BPS01P1",38,0)
 .  F  S DID1=$O(^BPS(9002313.51,DID0,2,DID1)) Q:'DID1  D
"RTN","BPS01P1",39,0)
 .  .  S DA=DID1,DIE="^BPS(9002313.51,"_DID0_",2," D ^DIE
"RTN","BPS01P1",40,0)
 S DA=0,DR="2///@",DIE="^BPSTL("
"RTN","BPS01P1",41,0)
 F  S DA=$O(^BPSTL(DA)) Q:'DA  D ^DIE
"RTN","BPS01P1",42,0)
 S DA=0
"RTN","BPS01P1",43,0)
 F  S DA=$O(^BPST(DA)) Q:'DA  S $P(^BPST(DA,0),"^",3)=""
"RTN","BPS01P1",44,0)
 K DIE
"RTN","BPS01P1",45,0)
 S DA=.03,DIK="^DD(9002313.02,",DA(1)="9002313.02" D ^DIK K DIK
"RTN","BPS01P1",46,0)
 S DA=1.08,DIK="^DD(9002313.512,",DA(1)="9002313.512" D ^DIK K DIK
"RTN","BPS01P1",47,0)
 F FILE=.57,.59 F DA=2,2.0099 S DIK="^DD(9002313"_FILE_",",DA(1)="9002313"_FILE D ^DIK K DIK
"RTN","BPS01P1",48,0)
 ;  9002313.02,.03
"RTN","BPS01P1",49,0)
 ;  9002313.512,1.08
"RTN","BPS01P1",50,0)
 ;  9002313.57,2
"RTN","BPS01P1",51,0)
 ;  9002313.57,2.0099
"RTN","BPS01P1",52,0)
 ;  9002313.59,2
"RTN","BPS01P1",53,0)
 ;  9002313.59,2.0099
"RTN","BPS01P1",54,0)
 Q
"RTN","BPS01P1",55,0)
CHGNAM ; Change the name in the package file for E CLAIMS MGMT ENGINE
"RTN","BPS01P1",56,0)
 N DA,DIE,DR
"RTN","BPS01P1",57,0)
 S DIE="^DIC(9.4,"
"RTN","BPS01P1",58,0)
 S DR=".01///E CLAIMS MGMT ENGINE"
"RTN","BPS01P1",59,0)
 S DA=$O(^DIC(9.4,"B","IHS PHARMACY POINT OF SALE",""))
"RTN","BPS01P1",60,0)
 Q:DA=""
"RTN","BPS01P1",61,0)
 D ^DIE
"RTN","BPS01P1",62,0)
 Q
"RTN","BPS02P1")
0^305^B3057123
"RTN","BPS02P1",1,0)
BPS02P1 ;BHAM ISC/DMB - Remove Corrupted Transaction Data ;2004-03-01
"RTN","BPS02P1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPS02P1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPS02P1",4,0)
 ;
"RTN","BPS02P1",5,0)
 ; For issue 427 - Remove Erroneous transaction where only the RESPONSE (#4)
"RTN","BPS02P1",6,0)
 ;    and LAST_UPDATE (#7) fields exist.  These were created by bad claims 
"RTN","BPS02P1",7,0)
 ;    data created by Fill Number error, which was reported in issue 423.
"RTN","BPS02P1",8,0)
 ;    If only these fields exist, then deleted the record.
"RTN","BPS02P1",9,0)
 ;
"RTN","BPS02P1",10,0)
 ; Note that I also found old records on BAT where only the Response [0;8] 
"RTN","BPS02P1",11,0)
 ;    field existed.
"RTN","BPS02P1",12,0)
 ;
"RTN","BPS02P1",13,0)
 ; Must call at entry point
"RTN","BPS02P1",14,0)
 Q
"RTN","BPS02P1",15,0)
I427 N IEN,BPSFL,I
"RTN","BPS02P1",16,0)
 K ^TMP("BPS02P1",$J)
"RTN","BPS02P1",17,0)
 S IEN=0 F  S IEN=$O(^BPST(IEN)) Q:IEN=""!(IEN]"A")  D
"RTN","BPS02P1",18,0)
 . S BPSFL=0
"RTN","BPS02P1",19,0)
 . ; Check is 0-node exists. If this node does not exist, we have other
"RTN","BPS02P1",20,0)
 . ;    problems but not the one we want
"RTN","BPS02P1",21,0)
 . I '$D(^BPST(IEN,0)) Q
"RTN","BPS02P1",22,0)
 . ; Check if pieces other than Response and Last Update exist on the zero node
"RTN","BPS02P1",23,0)
 . ; RESPONSE is [0;5] and LAST_UPDATE is [0;8]
"RTN","BPS02P1",24,0)
 . F I=1:1:4,6:1:7,9:1:20 I $P($G(^BPST(IEN,0)),U,I)]"" S BPSFL=1 Q
"RTN","BPS02P1",25,0)
 . I BPSFL=1 Q
"RTN","BPS02P1",26,0)
 . ; Check other nodes exist
"RTN","BPS02P1",27,0)
 . F I=1:1:10 I $D(^BPST(IEN,I)) S BPSFL=1 Q
"RTN","BPS02P1",28,0)
 . I BPSFL=1 Q
"RTN","BPS02P1",29,0)
 . S ^TMP("BPS02P1",$J,IEN)=""
"RTN","BPS02P1",30,0)
 I '$D(^TMP("BPS02P1",$J)) G END
"RTN","BPS02P1",31,0)
 ; Delete Entries
"RTN","BPS02P1",32,0)
 D BMES^XPDUTL("Corrupted BPS TRANSACTION data found")
"RTN","BPS02P1",33,0)
 N DIK,DA
"RTN","BPS02P1",34,0)
 S DIK="^BPST("
"RTN","BPS02P1",35,0)
 S DA="" F  S DA=$O(^TMP("BPS02P1",$J,DA)) Q:DA=""  D
"RTN","BPS02P1",36,0)
 . D MES^XPDUTL("Deleting "_DA_"...")
"RTN","BPS02P1",37,0)
 . D ^DIK
"RTN","BPS02P1",38,0)
END K IEN,BPSFL,I,DIK,DA
"RTN","BPS02P1",39,0)
 K ^TMP("BPS02P1",$J)
"RTN","BPS02P1",40,0)
 Q
"RTN","BPS03P1")
0^366^B224664
"RTN","BPS03P1",1,0)
BPS03P1 ;BHAM ISC/FCS/DRS - Initialize BPS setup file. ;06/01/2004
"RTN","BPS03P1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPS03P1",3,0)
 Q
"RTN","BPS03P1",4,0)
EN D DIALOUT
"RTN","BPS03P1",5,0)
 Q
"RTN","BPS03P1",6,0)
 ;
"RTN","BPS03P1",7,0)
DIALOUT ; Set dialout fields
"RTN","BPS03P1",8,0)
 N FN,X,IEN,FDA,MSG
"RTN","BPS03P1",9,0)
 K ^BPS(9002313.55)
"RTN","BPS03P1",10,0)
 S FN=9002313.55,X="+1,",(IEN(1),FDA(FN,X,.01))="1VA"
"RTN","BPS03P1",11,0)
 D UPDATE^DIE("","FDA","IEN","MSG")
"RTN","BPS03P1",12,0)
 Q
"RTN","BPSBCKJ")
0^299^B45801024
"RTN","BPSBCKJ",1,0)
BPSBCKJ ;BHAM ISC/AAT - BPS NIGHTLY BACKGROUND JOB ;02/27/2005
"RTN","BPSBCKJ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSBCKJ",3,0)
 ;
"RTN","BPSBCKJ",4,0)
 Q
"RTN","BPSBCKJ",5,0)
 ;
"RTN","BPSBCKJ",6,0)
EN ; The ECME NIGHTLY PROCESS
"RTN","BPSBCKJ",7,0)
 ;
"RTN","BPSBCKJ",8,0)
 ;The list of nightly actions
"RTN","BPSBCKJ",9,0)
 ;
"RTN","BPSBCKJ",10,0)
 D AUTOREV
"RTN","BPSBCKJ",11,0)
 ;TODO: Add more actions here
"RTN","BPSBCKJ",12,0)
 Q
"RTN","BPSBCKJ",13,0)
 ;
"RTN","BPSBCKJ",14,0)
AUTOREV ; The Auto-Reverse Procedure
"RTN","BPSBCKJ",15,0)
 N BDT,BTRAN,BPHARM,BTRAN0,BTRAN1,BTRAN4,BDAYS,BRX,BFIL,BDATE,BNOW,BCLAIM,BRES,BREV,BTEST,REF,BCNT,BTX,X,X1,X2
"RTN","BPSBCKJ",16,0)
 ;
"RTN","BPSBCKJ",17,0)
 S BTEST=0 ; Debugging flag 1 - TEST, 0 - LIVE
"RTN","BPSBCKJ",18,0)
 S BCNT=0 ; Count reversals
"RTN","BPSBCKJ",19,0)
 ;
"RTN","BPSBCKJ",20,0)
 S REF=$NA(^TMP($J,"BPSBCKJ")) K @REF
"RTN","BPSBCKJ",21,0)
 ;
"RTN","BPSBCKJ",22,0)
 S (X1,BNOW)=$$DT^XLFDT()
"RTN","BPSBCKJ",23,0)
 ;
"RTN","BPSBCKJ",24,0)
 ;Define number of days to look back - Auto Reverse days can be from 0-31
"RTN","BPSBCKJ",25,0)
 ;To make sure every claim is caught, moving back 45 days
"RTN","BPSBCKJ",26,0)
 S X2=-45 D C^%DTC S BDT=X
"RTN","BPSBCKJ",27,0)
 ;
"RTN","BPSBCKJ",28,0)
 ;Loop through 'LAST UPDATE' 'AH' index
"RTN","BPSBCKJ",29,0)
 F  S BDT=$O(^BPST("AH",BDT)) Q:'BDT  S BTRAN=0 F  S BTRAN=$O(^BPST("AH",BDT,BTRAN)) Q:'BTRAN  D
"RTN","BPSBCKJ",30,0)
 . W:BTEST !,"TRAN=",BTRAN," ",?20
"RTN","BPSBCKJ",31,0)
 . S BTRAN0=$G(^BPST(BTRAN,0)),BTRAN1=$G(^(1)),BTRAN4=$G(^(4))
"RTN","BPSBCKJ",32,0)
 . I BTRAN0=""!(BTRAN1="") W:BTEST "ZERO OR ONE NODE MISSING" Q
"RTN","BPSBCKJ",33,0)
 . I '$$PAID^BPSOSQ4(BTRAN) W:BTEST "NOT PAID" Q  ; Not paid
"RTN","BPSBCKJ",34,0)
 . I $P(BTRAN0,U,13)'=1 W:BTEST "NOT AN RX" Q  ; Not a prescription transmission
"RTN","BPSBCKJ",35,0)
 . S BPHARM=$P(BTRAN1,U,7) I 'BPHARM W:BTEST "NO BPS PHARM" Q  ; BPS PHARMACY
"RTN","BPSBCKJ",36,0)
 . W:BTEST "BPHARM=",$P($G(^BPS(9002313.56,BPHARM,0)),U,1),"  "
"RTN","BPSBCKJ",37,0)
 . ;
"RTN","BPSBCKJ",38,0)
 . ;Handle 'Inpatient' Auto-Reversals
"RTN","BPSBCKJ",39,0)
 . S BREV=$$REVINP(BNOW,BTRAN,BTRAN0,BTRAN1,BPHARM) Q:BREV
"RTN","BPSBCKJ",40,0)
 . ;
"RTN","BPSBCKJ",41,0)
 . ;Handle Regular Auto-Reversals
"RTN","BPSBCKJ",42,0)
 . S BDAYS=+$P($G(^BPS(9002313.56,BPHARM,0)),U,9)
"RTN","BPSBCKJ",43,0)
 . I 'BDAYS W:BTEST "AUTO-REV DISABLED" Q  ;disabled
"RTN","BPSBCKJ",44,0)
 . I $P(BTRAN4,U,1) Q  ;Reversal claim exist
"RTN","BPSBCKJ",45,0)
 . S BCLAIM=$P(BTRAN0,U,4) I 'BCLAIM W:BTEST "NO BCLAIM" Q
"RTN","BPSBCKJ",46,0)
 . I $P($G(^BPSC(BCLAIM,0)),U,7) W:BTEST "AUTO-REVERSE FLAG" Q 
"RTN","BPSBCKJ",47,0)
 . S BDATE=$P($G(^BPSC(BCLAIM,0)),U,5)
"RTN","BPSBCKJ",48,0)
 . I 'BDATE S BDATE=$P($G(^BPSC(BCLAIM,0)),U,6)
"RTN","BPSBCKJ",49,0)
 . S BDATE=$P(BDATE,".")
"RTN","BPSBCKJ",50,0)
 . I 'BDATE="" W:BTEST "NO DATE" Q
"RTN","BPSBCKJ",51,0)
 . W:BTEST "DATE=",BDATE,"  "
"RTN","BPSBCKJ",52,0)
 . I $$FMDIFF^XLFDT(BNOW,BDATE,1)'>BDAYS W:BTEST "TOO EARLY" Q
"RTN","BPSBCKJ",53,0)
 . S BRX=$P(BTRAN1,U,11) I 'BRX W:BTEST "NO RX" Q
"RTN","BPSBCKJ",54,0)
 . S BFIL=$P(BTRAN1,U,1)
"RTN","BPSBCKJ",55,0)
 . I $$RELDATE(BRX,BFIL) W:BTEST " RELEASED" Q  ;released
"RTN","BPSBCKJ",56,0)
 . S BRES=$$REVERSE(BRX,BFIL,BCLAIM,1)
"RTN","BPSBCKJ",57,0)
 . W:BTEST " *REV CLM=",BCLAIM," STAT=",BRES
"RTN","BPSBCKJ",58,0)
 . I BRES=0!(BRES=4) D
"RTN","BPSBCKJ",59,0)
 .. S (BCNT,@REF@(BRES))=$G(@REF@(BRES))+1
"RTN","BPSBCKJ",60,0)
 .. S @REF@(BRES,BCNT)=BTRAN_U_BCLAIM_U_BRX_U_BFIL_U_BPHARM
"RTN","BPSBCKJ",61,0)
 . ; Any notifications to IB?
"RTN","BPSBCKJ",62,0)
 D BULL(REF) ; Send the bulletin
"RTN","BPSBCKJ",63,0)
 K @REF
"RTN","BPSBCKJ",64,0)
 Q
"RTN","BPSBCKJ",65,0)
 ;
"RTN","BPSBCKJ",66,0)
 ;Auto-Reverse Claims for Current Inpatients
"RTN","BPSBCKJ",67,0)
 ;
"RTN","BPSBCKJ",68,0)
 ;20050810;BEE;Phase III - CR11
"RTN","BPSBCKJ",69,0)
 ;
"RTN","BPSBCKJ",70,0)
REVINP(BNOW,BTRAN,BTRAN0,BTRAN1,BPHARM) N BRX,BFIL,BCLAIM,BDATE,BRES,DFN,VAIP
"RTN","BPSBCKJ",71,0)
 ;
"RTN","BPSBCKJ",72,0)
 ;Only process Window fills
"RTN","BPSBCKJ",73,0)
 S BRX=+$P(BTRAN1,U,11) I BRX=0 Q 0
"RTN","BPSBCKJ",74,0)
 S BFIL=+$P(BTRAN1,U)
"RTN","BPSBCKJ",75,0)
 I $$MWC^BPSRPT6(BRX,BFIL)'=3 Q 0
"RTN","BPSBCKJ",76,0)
 ;
"RTN","BPSBCKJ",77,0)
 ;Check for Fill date - Must be equal to T-5
"RTN","BPSBCKJ",78,0)
 S BCLAIM=$P(BTRAN0,U,4) I 'BCLAIM Q 0
"RTN","BPSBCKJ",79,0)
 S BDATE=$$FILDATE(BRX,BFIL)
"RTN","BPSBCKJ",80,0)
 S BDATE=$P(BDATE,".")
"RTN","BPSBCKJ",81,0)
 I 'BDATE="" Q 0
"RTN","BPSBCKJ",82,0)
 I $$FMDIFF^XLFDT(BNOW,BDATE,1)'=5 Q 0
"RTN","BPSBCKJ",83,0)
 ;
"RTN","BPSBCKJ",84,0)
 ;Check for current Inpatient
"RTN","BPSBCKJ",85,0)
 S DFN=+$P(BTRAN0,U,6) I DFN=0 Q 0
"RTN","BPSBCKJ",86,0)
 D IN5^VADPT
"RTN","BPSBCKJ",87,0)
 I $G(VAIP(3))="" Q 0
"RTN","BPSBCKJ",88,0)
 ;
"RTN","BPSBCKJ",89,0)
 ;Auto-Reverse Claim
"RTN","BPSBCKJ",90,0)
 S BRES=$$REVERSE(BRX,BFIL,BCLAIM,2)
"RTN","BPSBCKJ",91,0)
 W:BTEST " *REV CLM=",BCLAIM," STAT=",BRES
"RTN","BPSBCKJ",92,0)
 I BRES=0!(BRES=4) D
"RTN","BPSBCKJ",93,0)
 . S (BCNT,@REF@(BRES))=$G(@REF@(BRES))+1
"RTN","BPSBCKJ",94,0)
 . S @REF@(BRES,BCNT)=BTRAN_U_BCLAIM_U_BRX_U_BFIL_U_BPHARM
"RTN","BPSBCKJ",95,0)
 Q 1
"RTN","BPSBCKJ",96,0)
 ;
"RTN","BPSBCKJ",97,0)
RELDATE(BRX,BFIL) ;Get the Released Date 
"RTN","BPSBCKJ",98,0)
 I BFIL Q $P($G(^PSRX(BRX,1,+BFIL,0)),U,18)
"RTN","BPSBCKJ",99,0)
 Q $P($G(^PSRX(BRX,2)),U,13)
"RTN","BPSBCKJ",100,0)
 ;
"RTN","BPSBCKJ",101,0)
FILDATE(BRX,BFIL) ;Get the Fill Date 
"RTN","BPSBCKJ",102,0)
 I BFIL Q $P($G(^PSRX(BRX,1,+BFIL,0)),U,1)
"RTN","BPSBCKJ",103,0)
 Q $P($G(^PSRX(BRX,2)),U,2)
"RTN","BPSBCKJ",104,0)
 ;
"RTN","BPSBCKJ",105,0)
REVERSE(BRX,BFIL,BCLAIM,BTYPE) ;Auto-Reverse the claim
"RTN","BPSBCKJ",106,0)
 ;PUBLIC BTEST
"RTN","BPSBCKJ",107,0)
 N BDOS,BRES,BDAT,BMES,BRSN
"RTN","BPSBCKJ",108,0)
 I $G(BTEST) Q 0  ; Test mode
"RTN","BPSBCKJ",109,0)
 ;
"RTN","BPSBCKJ",110,0)
 ; Get Date of Service and set reversal reason
"RTN","BPSBCKJ",111,0)
 S BDOS=$$DOSDATE^BPSSCRRS(BRX,BFIL)
"RTN","BPSBCKJ",112,0)
 S BRSN=$S(BTYPE=2:"CURRENT INPATIENT",1:"PRESCRIPTION NOT RELEASED")
"RTN","BPSBCKJ",113,0)
 ;
"RTN","BPSBCKJ",114,0)
 ; Call ECME to process reversal
"RTN","BPSBCKJ",115,0)
 S BRES=$$EN^BPSNCPDP(BRX,BFIL,BDOS,"AREV","",BRSN,"")
"RTN","BPSBCKJ",116,0)
 ;
"RTN","BPSBCKJ",117,0)
 ; If successful, log message to the Prescription Activity Log
"RTN","BPSBCKJ",118,0)
 ;  and set the auto-reversal flag
"RTN","BPSBCKJ",119,0)
 S BRES=+BRES,BMES="Submitted to ECME: AUTO REVERSAL JOB"
"RTN","BPSBCKJ",120,0)
 I BRES=0 D
"RTN","BPSBCKJ",121,0)
 . D ECMEACT^PSOBPSU1(BRX,BFIL,BMES,.5)
"RTN","BPSBCKJ",122,0)
 . S BDAT(9002313.02,BCLAIM_",",.07)=BTYPE D FILE^DIE("","BDAT")
"RTN","BPSBCKJ",123,0)
 Q BRES
"RTN","BPSBCKJ",124,0)
 ;
"RTN","BPSBCKJ",125,0)
 ;
"RTN","BPSBCKJ",126,0)
BULL(REF) ;Bulletin to the OPECC
"RTN","BPSBCKJ",127,0)
 ;PUBLIC BTEST,DUZ,DT
"RTN","BPSBCKJ",128,0)
 N XMSUB,XMY,XMTEXT,XMDUZ,BLNUM
"RTN","BPSBCKJ",129,0)
 ;
"RTN","BPSBCKJ",130,0)
 S BLNUM=0,BCNT=+$G(@REF@(0))
"RTN","BPSBCKJ",131,0)
 S XMSUB="ECME AUTO-REVERSAL PROCESS"
"RTN","BPSBCKJ",132,0)
 I $G(BTEST) D T("*** P L E A S E   D I S R E G A R D    T H I S    E M A I L ***"),T(),T("NOT ACTUALLY REVERSED - THIS IS A TEST TEST TEST TEST"),T()
"RTN","BPSBCKJ",133,0)
 D T("The ECME Nightly Process completed auto-reversals for the following e-Pharmacy")
"RTN","BPSBCKJ",134,0)
 D T("prescriptions.")
"RTN","BPSBCKJ",135,0)
 D T()
"RTN","BPSBCKJ",136,0)
 D T("TOTAL AUTO-REVERSED CLAIMS: "_BCNT)
"RTN","BPSBCKJ",137,0)
 D T()
"RTN","BPSBCKJ",138,0)
 I BCNT D T("Claims Auto-Reversed on "_$$DAT(DT)_":") D ARLIST(0,REF)
"RTN","BPSBCKJ",139,0)
 D T()
"RTN","BPSBCKJ",140,0)
 S BCNT=+$G(@REF@(4))
"RTN","BPSBCKJ",141,0)
 I BCNT'=0 D
"RTN","BPSBCKJ",142,0)
 . D T()
"RTN","BPSBCKJ",143,0)
 . D T("The ECME Nightly Process attempted to auto-reversal the following claims but")
"RTN","BPSBCKJ",144,0)
 . D T("could not because the previous request was IN PROGRESS.  Please verify that")
"RTN","BPSBCKJ",145,0)
 . D T("the previous request is not stranded.")
"RTN","BPSBCKJ",146,0)
 . D T()
"RTN","BPSBCKJ",147,0)
 . D T("Total number of claims that could not be auto-reversed: "_BCNT)
"RTN","BPSBCKJ",148,0)
 . D T()
"RTN","BPSBCKJ",149,0)
 . D T("Claims not auto-reversed on "_$$DAT(DT)_":")
"RTN","BPSBCKJ",150,0)
 . D ARLIST(4,REF)
"RTN","BPSBCKJ",151,0)
 . D T()
"RTN","BPSBCKJ",152,0)
 ;
"RTN","BPSBCKJ",153,0)
 S XMDUZ="BPS PACKAGE",XMTEXT="BTX("
"RTN","BPSBCKJ",154,0)
 S XMY("G.BPS OPECC")=""
"RTN","BPSBCKJ",155,0)
 I $G(DUZ)'<1 S XMY(DUZ)=""
"RTN","BPSBCKJ",156,0)
 D ^XMD
"RTN","BPSBCKJ",157,0)
 Q
"RTN","BPSBCKJ",158,0)
 ;
"RTN","BPSBCKJ",159,0)
T(BTXT) ; Add text to the message
"RTN","BPSBCKJ",160,0)
 ;PUBLIC BLNUM,BTEST
"RTN","BPSBCKJ",161,0)
 S BLNUM=BLNUM+1,BTX(BLNUM)=$G(BTXT," ")
"RTN","BPSBCKJ",162,0)
 I $G(BTEST) W !,$G(BTXT)
"RTN","BPSBCKJ",163,0)
 Q
"RTN","BPSBCKJ",164,0)
 ;
"RTN","BPSBCKJ",165,0)
ARLIST(BRES,REF) ;Auto-Rev List
"RTN","BPSBCKJ",166,0)
 N I,TXT,BCLAIM,BTRAN,Y,BRX,BFIL,BFDATE,BPHARM,BRXN,BPHARMN,BPAT,BPSTAT
"RTN","BPSBCKJ",167,0)
 D T()
"RTN","BPSBCKJ",168,0)
 D T(" #    RX     FILL  STATUS FILL DATE PATIENT                      BPS PHARMACY")
"RTN","BPSBCKJ",169,0)
 D T("------------------------------------------------------------------------------")
"RTN","BPSBCKJ",170,0)
 S I=0 F  S I=$O(@REF@(BRES,I)) Q:'I   D
"RTN","BPSBCKJ",171,0)
 . S Y=@REF@(BRES,I)
"RTN","BPSBCKJ",172,0)
 . S BTRAN=$P(Y,U)
"RTN","BPSBCKJ",173,0)
 . S BCLAIM=$P(Y,U,2)
"RTN","BPSBCKJ",174,0)
 . S BRX=$P(Y,U,3),BRXN=$P($G(^PSRX(BRX,0)),U)
"RTN","BPSBCKJ",175,0)
 . S BPAT=$P($G(^DPT($P($G(^PSRX(BRX,0)),U,2),0)),U)
"RTN","BPSBCKJ",176,0)
 . S BFIL=$P(Y,U,4)
"RTN","BPSBCKJ",177,0)
 . S BPHARM=$P(Y,U,5),BPHARMN=$P($G(^BPS(9002313.56,BPHARM,0)),U)
"RTN","BPSBCKJ",178,0)
 . S BFDATE=$$FILDATE(BRX,BFIL)
"RTN","BPSBCKJ",179,0)
 . S BPSTAT=$$MWCNAM^BPSRPT1($$MWC^BPSRPT6(BRX,BFIL))_"/"_$S($$RELDATE(BRX,BFIL)]"":"RL",1:"NR")
"RTN","BPSBCKJ",180,0)
 . S TXT=$J(I,3)_" "_$$J(BRXN,10)_" "_$$J(BFIL,2)_"  "_$J(BPSTAT,4)_"  "_$$J($$DAT(BFDATE),11)_$$J(BPAT,25)_" "_$J($E(BPHARMN,1,15),15)
"RTN","BPSBCKJ",181,0)
 . D T(TXT)
"RTN","BPSBCKJ",182,0)
 D T("------------------------------------------------------------------------------")
"RTN","BPSBCKJ",183,0)
 Q
"RTN","BPSBCKJ",184,0)
 ;
"RTN","BPSBCKJ",185,0)
J(TXT,LEN) ;Left justify
"RTN","BPSBCKJ",186,0)
 Q TXT_$J("",LEN-$L(TXT))
"RTN","BPSBCKJ",187,0)
 ;
"RTN","BPSBCKJ",188,0)
DAT(X,Y) ; Convert FM date to displayable (mm/dd/yy) format.
"RTN","BPSBCKJ",189,0)
 ; -- optional output of time, if $g(y) 
"RTN","BPSBCKJ",190,0)
 N DATE,T
"RTN","BPSBCKJ",191,0)
 S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")
"RTN","BPSBCKJ",192,0)
 I $G(Y) S T="."_$E($P(X,".",2)_"000000",1,7) I T>0 S DATE=DATE_" "_$S($E(T,2,3)>12:$E(T,2,3)-12,$E(T,2,3)="00":"00",1:+$E(T,2,3))_":"_$E(T,4,5)_$S($E(T,2,5)>1200:" pm",1:" am")
"RTN","BPSBCKJ",193,0)
 Q DATE
"RTN","BPSBUTL")
0^294^B31009303
"RTN","BPSBUTL",1,0)
BPSBUTL ;BHAM ISC/MFR/VA/DLF - IB Communication Utilities ;06/01/2004
"RTN","BPSBUTL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSBUTL",3,0)
 ;Reference to ^PSRX supported by DBIA 1977
"RTN","BPSBUTL",4,0)
 ;Reference to STORESP^IBNCPDP supported by DBIA 4299
"RTN","BPSBUTL",5,0)
 ;Reference to ^DG(40.8,"AD" supported by DBIA 2817
"RTN","BPSBUTL",6,0)
 ;----------------------------------------------------------------------
"RTN","BPSBUTL",7,0)
CLOSE(CLAIM,TRNDX,REASON,PAPER,RELCOP,COMMENT,ERROR) ; Send IB an update on the CLAIM status for a Closed Claim
"RTN","BPSBUTL",8,0)
 N DFN,IBARY,BILLNUM,CLAIMNFO,RXINFO,RFINFO,TRANINFO
"RTN","BPSBUTL",9,0)
 ;
"RTN","BPSBUTL",10,0)
 ; - Data gathering
"RTN","BPSBUTL",11,0)
 D GETS^DIQ("9002313.59",TRNDX,"1.11;9","I","TRANINFO")
"RTN","BPSBUTL",12,0)
 S RXIEN=TRANINFO(9002313.59,TRNDX_",",1.11,"I")
"RTN","BPSBUTL",13,0)
 I '$D(^PSRX(RXIEN,0)) S ERROR="Prescription not found." Q
"RTN","BPSBUTL",14,0)
 S IBARY("FILL NUMBER")=TRANINFO(9002313.59,TRNDX_",",9,"I")
"RTN","BPSBUTL",15,0)
 D GETS^DIQ("9002313.02",CLAIM,"400*;401;402;403;426","","CLAIMNFO")
"RTN","BPSBUTL",16,0)
 S IBARY("FILL DATE")=$$EXT2FM^BPSOSU1(CLAIMNFO("9002313.0201","1,"_CLAIM_",","401"))
"RTN","BPSBUTL",17,0)
 D GETS^DIQ("52",RXIEN,".01;4;6;8;7;16;27","IE","RXINFO")
"RTN","BPSBUTL",18,0)
 S FILLNUM=+IBARY("FILL NUMBER") I FILLNUM>0 D GETS^DIQ("52.1",FILLNUM_","_RXIEN,".01;1;1.1;11","","RFINFO")
"RTN","BPSBUTL",19,0)
 S DFN=$P(^PSRX(RXIEN,0),"^",2)
"RTN","BPSBUTL",20,0)
 S IBARY("FILLED BY")=RXINFO(52,RXIEN_",",16,"I"),IBARY("PRESCRIPTION")=RXIEN
"RTN","BPSBUTL",21,0)
 S IBARY("BILLED")=$$DFF2EXT^BPSECFM($P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","426"),"DQ",2))
"RTN","BPSBUTL",22,0)
 S IBARY("CLAIMID")=$P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","402"),"D2",2)
"RTN","BPSBUTL",23,0)
 S IBARY("PLAN")=$P(^BPST(TRNDX,10,1,0),"^"),IBARY("STATUS")="CLOSED",IBARY("PAID")=0
"RTN","BPSBUTL",24,0)
 S IBARY("RELEASE DATE")=$S(FILLNUM=0:$P(^PSRX(RXIEN,2),"^",13),1:$P($G(^PSRX(RXIEN,1,FILLNUM,0)),"^",18))
"RTN","BPSBUTL",25,0)
 S IBARY("DIVISION")=$$MCDIV(RXIEN,FILLNUM),IBARY("USER")=DUZ
"RTN","BPSBUTL",26,0)
 I REASON'="" D
"RTN","BPSBUTL",27,0)
 . S IBARY("CLOSE REASON")=$O(^IBE(356.8,"B",REASON,0))
"RTN","BPSBUTL",28,0)
 . S IBARY("DROP TO PAPER")=+$G(PAPER)
"RTN","BPSBUTL",29,0)
 . S IBARY("RELEASE COPAY")=+$G(RELCOP)
"RTN","BPSBUTL",30,0)
 I $G(COMMENT)]"" S IBARY("CLOSE COMMENT")=COMMENT
"RTN","BPSBUTL",31,0)
 ;
"RTN","BPSBUTL",32,0)
 S BILLNUM=$$STORESP^IBNCPDP(DFN,.IBARY)
"RTN","BPSBUTL",33,0)
 Q
"RTN","BPSBUTL",34,0)
 ; Send IB an update on the CLAIM status for a restocked or deleted prescription
"RTN","BPSBUTL",35,0)
CLOSE2(RXIEN,BFILL,BWHERE) ;
"RTN","BPSBUTL",36,0)
 N IEN59,IBARY,DFN,BILLNUM,FILL,REASON
"RTN","BPSBUTL",37,0)
 N CLAIMNFO,RXINFO,RFINFO
"RTN","BPSBUTL",38,0)
 N DIE,DA,DR
"RTN","BPSBUTL",39,0)
 ;
"RTN","BPSBUTL",40,0)
 ; Check parameters
"RTN","BPSBUTL",41,0)
 I '$G(RXIEN) S ERROR="No prescription parameter" Q
"RTN","BPSBUTL",42,0)
 I '$D(^PSRX(RXIEN,0)) S ERROR="Prescription not found." Q
"RTN","BPSBUTL",43,0)
 I ",DDED,DE,RS,"'[(","_BWHERE_",") S ERROR="Invalid BWHERE parameter" Q
"RTN","BPSBUTL",44,0)
 ;
"RTN","BPSBUTL",45,0)
 ; Calculate the transaction IEN and see that it exists
"RTN","BPSBUTL",46,0)
 S FILL=".0000"_+BFILL
"RTN","BPSBUTL",47,0)
 S IEN59=RXIEN_"."_$E(FILL,$L(FILL)-3,$L(FILL))_"1"
"RTN","BPSBUTL",48,0)
 I '$D(^BPST(IEN59,0)) Q
"RTN","BPSBUTL",49,0)
 ;
"RTN","BPSBUTL",50,0)
 ; Get claim data
"RTN","BPSBUTL",51,0)
 S CLAIM=$P(^BPST(IEN59,0),"^",4)
"RTN","BPSBUTL",52,0)
 D GETS^DIQ("9002313.02",CLAIM,"400*;401;402;426","","CLAIMNFO")
"RTN","BPSBUTL",53,0)
 S IBARY("FILL NUMBER")=+BFILL
"RTN","BPSBUTL",54,0)
 S IBARY("FILL DATE")=$$EXT2FM^BPSOSU1(CLAIMNFO("9002313.0201","1,"_CLAIM_",","401"))
"RTN","BPSBUTL",55,0)
 ;
"RTN","BPSBUTL",56,0)
 ; Get prescription data
"RTN","BPSBUTL",57,0)
 D GETS^DIQ("52",RXIEN,".01;4;6;8;7;16;27","IE","RXINFO")
"RTN","BPSBUTL",58,0)
 S FILLNUM=IBARY("FILL NUMBER")
"RTN","BPSBUTL",59,0)
 I FILLNUM>0 D GETS^DIQ("52.1",FILLNUM_","_RXIEN,".01;1;1.1;11","","RFINFO")
"RTN","BPSBUTL",60,0)
 S DFN=$P(^PSRX(RXIEN,0),"^",2)
"RTN","BPSBUTL",61,0)
 S IBARY("FILLED BY")=RXINFO(52,RXIEN_",",16,"I"),IBARY("PRESCRIPTION")=RXIEN
"RTN","BPSBUTL",62,0)
 S IBARY("BILLED")=$$DFF2EXT^BPSECFM($P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","426"),"DQ",2))
"RTN","BPSBUTL",63,0)
 S IBARY("CLAIMID")=$P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","402"),"D2",2)
"RTN","BPSBUTL",64,0)
 S IBARY("PLAN")=$P(^BPST(IEN59,10,1,0),"^"),IBARY("STATUS")="CLOSED",IBARY("PAID")=0
"RTN","BPSBUTL",65,0)
 S IBARY("RELEASE DATE")=$S(FILLNUM=0:$P(^PSRX(RXIEN,2),"^",13),1:$P($G(^PSRX(RXIEN,1,FILLNUM,0)),"^",18))
"RTN","BPSBUTL",66,0)
 ;
"RTN","BPSBUTL",67,0)
 ; Determine the reversal reason based on the BWHERE value
"RTN","BPSBUTL",68,0)
 I BWHERE="RS" S REASON="PRESCRIPTION NOT RELEASED"
"RTN","BPSBUTL",69,0)
 I BWHERE="DE"!(BWHERE="DDED") S REASON="PRESCRIPTION DELETED"
"RTN","BPSBUTL",70,0)
 I REASON]"" S IBARY("CLOSE REASON")=$O(^IBE(356.8,"B",REASON,0))
"RTN","BPSBUTL",71,0)
 ;
"RTN","BPSBUTL",72,0)
 ;if a refill was deleted while RX is still active (not deleted) then send DELETION OF REFILL comment for CT record
"RTN","BPSBUTL",73,0)
 I BWHERE="DE",$$RXSTATUS^BPSSCRU2(RXIEN,0)'=13 S IBARY("CLOSE COMMENT")="DELETION OF REFILL ONLY - ORIGINAL RX MAY REMAIN ACTIVE"
"RTN","BPSBUTL",74,0)
 ;
"RTN","BPSBUTL",75,0)
 ; Miscellaneous values
"RTN","BPSBUTL",76,0)
 S IBARY("DIVISION")=$$MCDIV(RXIEN,FILLNUM),IBARY("USER")=.5
"RTN","BPSBUTL",77,0)
 ;
"RTN","BPSBUTL",78,0)
 ; Update IB
"RTN","BPSBUTL",79,0)
 S BILLNUM=$$STORESP^IBNCPDP(DFN,.IBARY)
"RTN","BPSBUTL",80,0)
 ;
"RTN","BPSBUTL",81,0)
 ; Update the claim file that the claim is closed and the reason why.
"RTN","BPSBUTL",82,0)
 S DIE="^BPSC(",DA=CLAIM
"RTN","BPSBUTL",83,0)
 S DR="901///1;902///"_$$NOW^XLFDT()_";903///.5;904///"_IBARY("CLOSE REASON")
"RTN","BPSBUTL",84,0)
 D ^DIE
"RTN","BPSBUTL",85,0)
 Q
"RTN","BPSBUTL",86,0)
 ;
"RTN","BPSBUTL",87,0)
 ; Function to return Transaction, claim, and response IENs
"RTN","BPSBUTL",88,0)
 ; Parameters:
"RTN","BPSBUTL",89,0)
 ;    RXI: Prescription IEN
"RTN","BPSBUTL",90,0)
 ;    RXR: Fill Number
"RTN","BPSBUTL",91,0)
 ; Returns:
"RTN","BPSBUTL",92,0)
 ;    IEN59^Claim IEN^Response IEN^Reversal Claim IEN^Reversal Response IEN
"RTN","BPSBUTL",93,0)
CLAIM(RXI,RXR) ;
"RTN","BPSBUTL",94,0)
 N IEN59,CLAIMIEN,RESPIEN,REVCLAIM,REVRESP
"RTN","BPSBUTL",95,0)
 I '$G(RXI) Q
"RTN","BPSBUTL",96,0)
 S IEN59=$$IEN59^BPSOSRX(RXI,RXR)
"RTN","BPSBUTL",97,0)
 I '$D(^BPST(IEN59,0)) Q ""
"RTN","BPSBUTL",98,0)
 S CLAIMIEN=$P(^BPST(IEN59,0),"^",4),RESPIEN=$P(^BPST(IEN59,0),"^",5)
"RTN","BPSBUTL",99,0)
 S REVCLAIM=$P($G(^BPST(IEN59,4)),"^",1),REVRESP=$P($G(^BPST(IEN59,4)),"^",2)
"RTN","BPSBUTL",100,0)
 Q IEN59_U_CLAIMIEN_U_RESPIEN_U_REVCLAIM_U_REVRESP
"RTN","BPSBUTL",101,0)
 ;
"RTN","BPSBUTL",102,0)
NABP(RXP,BFILL) ;
"RTN","BPSBUTL",103,0)
 N BPSTIEN,BPSCIEN,DFILL,NABP
"RTN","BPSBUTL",104,0)
 S DFILL=$E($TR($J("",4-$L(BFILL))," ","0")_BFILL,1,4)
"RTN","BPSBUTL",105,0)
 S BPSTIEN=RXP_"."_DFILL_"1"
"RTN","BPSBUTL",106,0)
 I 'BPSTIEN Q 0
"RTN","BPSBUTL",107,0)
 S BPSCIEN=$P($G(^BPST(BPSTIEN,0)),U,4)
"RTN","BPSBUTL",108,0)
 I 'BPSCIEN Q 0
"RTN","BPSBUTL",109,0)
 S NABP=$P($G(^BPSC(BPSCIEN,200)),U)
"RTN","BPSBUTL",110,0)
 Q NABP
"RTN","BPSBUTL",111,0)
 ;
"RTN","BPSBUTL",112,0)
 ;MC Division for the IB
"RTN","BPSBUTL",113,0)
MCDIV(RXIEN,FILLNUM) ; Get MC DIVISION from the Rx/Fill
"RTN","BPSBUTL",114,0)
 N BPSDIV,BINST,BMCDIV
"RTN","BPSBUTL",115,0)
 ; outpatient division
"RTN","BPSBUTL",116,0)
 I 'FILLNUM S BPSDIV=+$P($G(^PSRX(RXIEN,2)),U,9)
"RTN","BPSBUTL",117,0)
 E  S BPSDIV=+$P($G(^PSRX(RXIEN,1,FILLNUM,0)),U,9)
"RTN","BPSBUTL",118,0)
 I 'BPSDIV Q ""
"RTN","BPSBUTL",119,0)
 ; related institution
"RTN","BPSBUTL",120,0)
 S BINST=+$P($G(^PS(59,BPSDIV,"INI")),U) Q:'BINST ""
"RTN","BPSBUTL",121,0)
 S BMCDIV=$O(^DG(40.8,"AD",BINST,0)) ; medical center division
"RTN","BPSBUTL",122,0)
 Q BMCDIV
"RTN","BPSBUTL",123,0)
 ;
"RTN","BPSBUTL",124,0)
 ; DIVNABP - Get NABP/NCPDP number for a specific outpatient site
"RTN","BPSBUTL",125,0)
 ; Input
"RTN","BPSBUTL",126,0)
 ;   ABSBPDIV - Outpatient Site
"RTN","BPSBUTL",127,0)
 ; Output
"RTN","BPSBUTL",128,0)
 ;   "" - No BPS Pharmacies or no NABP/NCPDP number found
"RTN","BPSBUTL",129,0)
 ;   NABP/NCPCP number 
"RTN","BPSBUTL",130,0)
DIVNCPDP(ABSBPDIV) ;
"RTN","BPSBUTL",131,0)
 N BPSHARM,NABP,ABSBSDIV
"RTN","BPSBUTL",132,0)
 I '$G(ABSBPDIV) Q ""
"RTN","BPSBUTL",133,0)
 S NABP="",ABSBSDIV=1
"RTN","BPSBUTL",134,0)
 ; GETPHARM expects ABSBPDIV and ABSBSDIV to be set
"RTN","BPSBUTL",135,0)
 ; Returns BPSHARM (BPS Pharmacy IEN)
"RTN","BPSBUTL",136,0)
 D GETPHARM^BPSOSQC
"RTN","BPSBUTL",137,0)
 I BPSHARM'=0 S NABP=$$GET1^DIQ(9002313.56,BPSHARM_",",.02)
"RTN","BPSBUTL",138,0)
 Q NABP
"RTN","BPSBUTL",139,0)
 ;
"RTN","BPSBUTL",140,0)
 ;ADDCOMM - Add a comment to a ECME claim
"RTN","BPSBUTL",141,0)
 ;Input:
"RTN","BPSBUTL",142,0)
 ; BPRX - ien in file #52 or external RX# (see BPMODE)
"RTN","BPSBUTL",143,0)
 ; BPREF - refill number (0,1,2,...)
"RTN","BPSBUTL",144,0)
 ; BPRCMNT - comment text 
"RTN","BPSBUTL",145,0)
 ; BPMODE - 1 if external RX#, 0 if ien of #52
"RTN","BPSBUTL",146,0)
 ;Output:
"RTN","BPSBUTL",147,0)
 ;  1 - okay
"RTN","BPSBUTL",148,0)
 ; -1 - failed
"RTN","BPSBUTL",149,0)
ADDCOMM(BPRX,BPREF,BPRCMNT,BPMODE) ;*/
"RTN","BPSBUTL",150,0)
 N BP59,BPNOW,BPLCK,BPREC,BPDA,BPERR
"RTN","BPSBUTL",151,0)
 N %,%H,%I,X
"RTN","BPSBUTL",152,0)
 I $L(BPRX)<1 Q -1
"RTN","BPSBUTL",153,0)
 I $G(BPMODE) S BPRX=+$O(^PSRX("B",BPRX,0)) I +BPRX=0 Q -1
"RTN","BPSBUTL",154,0)
 I $G(BPRCMNT)="" Q -1
"RTN","BPSBUTL",155,0)
 S BP59=BPRX_$S($L(+BPREF)=1:".000",1:".00")_+BPREF_"1" ;borrowed from CLOSE2 above
"RTN","BPSBUTL",156,0)
 D NOW^%DTC
"RTN","BPSBUTL",157,0)
 S BPNOW=%
"RTN","BPSBUTL",158,0)
 L +^BPST(9002313.59111,+BP59):10
"RTN","BPSBUTL",159,0)
 S BPLCK=$T
"RTN","BPSBUTL",160,0)
 I 'BPLCK Q -1  ;quit
"RTN","BPSBUTL",161,0)
 D INSITEM^BPSCMT01(9002313.59111,+BP59,BPNOW)
"RTN","BPSBUTL",162,0)
 S BPREC=$O(^BPST(BP59,11,"B",BPNOW,0))
"RTN","BPSBUTL",163,0)
 I BPREC>0 D
"RTN","BPSBUTL",164,0)
 . S BPDA(9002313.59111,BPREC_","_BP59_",",.02)=+$G(DUZ)
"RTN","BPSBUTL",165,0)
 . S BPDA(9002313.59111,BPREC_","_BP59_",",.03)=$G(BPRCMNT)
"RTN","BPSBUTL",166,0)
 . D FILE^DIE("","BPDA","BPERR")
"RTN","BPSBUTL",167,0)
 I BPLCK L -^BPST(9002313.59111,+BP59)
"RTN","BPSBUTL",168,0)
 I BPREC>0,'$D(BPERR) Q 1
"RTN","BPSBUTL",169,0)
 Q -1
"RTN","BPSCEAR")
0^298^B80980545
"RTN","BPSCEAR",1,0)
BPSCEAR ;BHAM ISC/MHA - CMOP/ECME ACTIVITY REPORT ;03/01/2005
"RTN","BPSCEAR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSCEAR",3,0)
 ; External reference to ^PSRX( supported by DBIA #1221
"RTN","BPSCEAR",4,0)
 ; External reference to ^PS(59 supported by DBIA #1976
"RTN","BPSCEAR",5,0)
 ; External reference to ^PSX(550.2 supported by DBIA #2231
"RTN","BPSCEAR",6,0)
 ;
"RTN","BPSCEAR",7,0)
 N %,%ZIS,BPEXCEL,BPSB,BPSCR,BPSE,DIVDA,DIVNM,DTOUT,I,LINE,POP,VA,VAERR
"RTN","BPSCEAR",8,0)
 N X,Y,ZTDESC,ZTIO,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK
"RTN","BPSCEAR",9,0)
 ;
"RTN","BPSCEAR",10,0)
 ;Prompt to select Date Range
"RTN","BPSCEAR",11,0)
 ;
"RTN","BPSCEAR",12,0)
 ; Returns (Start Date^End Date)
"RTN","BPSCEAR",13,0)
 ;
"RTN","BPSCEAR",14,0)
BDT S BPSB=$$SELDATE() D  I BPSB="^" S POP=1 G EXIT
"RTN","BPSCEAR",15,0)
 .I BPSB="^" Q
"RTN","BPSCEAR",16,0)
 .S BPSE=$P(BPSB,U,2)
"RTN","BPSCEAR",17,0)
 .S BPSB=$P(BPSB,U)
"RTN","BPSCEAR",18,0)
 ;
"RTN","BPSCEAR",19,0)
 ;Get Division(s)
"RTN","BPSCEAR",20,0)
 ;
"RTN","BPSCEAR",21,0)
 ; Returns DIVDA and DIVNM arrays
"RTN","BPSCEAR",22,0)
 ; 
"RTN","BPSCEAR",23,0)
DIV D SELDIV I '$D(DIVNM) S POP=1 G EXIT
"RTN","BPSCEAR",24,0)
 ;
"RTN","BPSCEAR",25,0)
 ;Prompt for Excel Capture
"RTN","BPSCEAR",26,0)
 ;
"RTN","BPSCEAR",27,0)
EX S BPEXCEL=$$SELEXCEL^BPSRPT4() I BPEXCEL="^" S POP=1 G EXIT
"RTN","BPSCEAR",28,0)
 ;
"RTN","BPSCEAR",29,0)
 ;Prompt for Device
"RTN","BPSCEAR",30,0)
 ;
"RTN","BPSCEAR",31,0)
DV W !! S %ZIS="MQ",%ZIS("A")="Select Printer: ",%ZIS("B")=""
"RTN","BPSCEAR",32,0)
 D ^%ZIS I POP S POP=1 G EXIT
"RTN","BPSCEAR",33,0)
 S BPSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSCEAR",34,0)
 I '$D(IO("Q")) G START
"RTN","BPSCEAR",35,0)
 ;
"RTN","BPSCEAR",36,0)
 ;Process queue device
"RTN","BPSCEAR",37,0)
 ;
"RTN","BPSCEAR",38,0)
QUE S ZTSAVE("*")=""
"RTN","BPSCEAR",39,0)
 S ZTRTN="START^BPSCEAR"
"RTN","BPSCEAR",40,0)
 S ZTDESC="CMOP/ECME Activity Report"
"RTN","BPSCEAR",41,0)
 D ^%ZTLOAD
"RTN","BPSCEAR",42,0)
 W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","BPSCEAR",43,0)
 D HOME^%ZIS
"RTN","BPSCEAR",44,0)
 S BPSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSCEAR",45,0)
 G EXIT
"RTN","BPSCEAR",46,0)
 ;
"RTN","BPSCEAR",47,0)
 ;Report Processing Tag
"RTN","BPSCEAR",48,0)
 ;
"RTN","BPSCEAR",49,0)
START N BPFND,BPSBE,BPSEE,BPSNOW,LINE,POP,Y
"RTN","BPSCEAR",50,0)
 S BPFND=0,LINE="W ! F I=1:1:80 W ""="""
"RTN","BPSCEAR",51,0)
 U IO
"RTN","BPSCEAR",52,0)
 ;
"RTN","BPSCEAR",53,0)
 ;Excel Display - Print Header Record
"RTN","BPSCEAR",54,0)
 I BPEXCEL D PLINEX
"RTN","BPSCEAR",55,0)
 ;
"RTN","BPSCEAR",56,0)
 S Y=BPSB X ^DD("DD") S BPSBE=Y
"RTN","BPSCEAR",57,0)
 S Y=BPSE X ^DD("DD") S BPSEE=Y
"RTN","BPSCEAR",58,0)
 D NOW^%DTC S Y=% X ^DD("DD") S BPSNOW=Y
"RTN","BPSCEAR",59,0)
 ;
"RTN","BPSCEAR",60,0)
 ;Loop through divisions and display
"RTN","BPSCEAR",61,0)
 S DIVDA=0 F  S DIVDA=$O(DIVDA(DIVDA)) Q:DIVDA'>0  D ONEDIV(.BPFND,BPSBE,BPSEE,BPSNOW) Q:$G(POP)
"RTN","BPSCEAR",62,0)
 ;
"RTN","BPSCEAR",63,0)
 ;Make sure a record was printed
"RTN","BPSCEAR",64,0)
 I '$G(POP),BPFND=0 D
"RTN","BPSCEAR",65,0)
 .I 'BPEXCEL D TITLE
"RTN","BPSCEAR",66,0)
 .W !,"NO DATA FOUND FOR CHOSEN PARAMETERS"
"RTN","BPSCEAR",67,0)
 .I BPSCR,'BPEXCEL D PAUSE2
"RTN","BPSCEAR",68,0)
 ;
"RTN","BPSCEAR",69,0)
 I '$G(POP),'BPEXCEL S POP=2
"RTN","BPSCEAR",70,0)
 G EXIT
"RTN","BPSCEAR",71,0)
 ;
"RTN","BPSCEAR",72,0)
 ;Display information for one division
"RTN","BPSCEAR",73,0)
ONEDIV(BPFND,BPSBE,BPSEE,BPSNOW) N %,BPSD,BPSE1,P5,P6,PS,TY,Y
"RTN","BPSCEAR",74,0)
 S BPSE1=BPSE+.99999,BPSD=BPSB-.00001
"RTN","BPSCEAR",75,0)
 S TY=550.2 F  S BPSD=$O(^PSX(TY,"D",BPSD)) Q:(+BPSD'>0)!(+BPSD>BPSE1)  D  Q:$G(POP)
"RTN","BPSCEAR",76,0)
 .S (PS,P5)=0 F  S P5=$O(^PSX(TY,"D",BPSD,P5)) Q:'P5  D  Q:$G(POP)
"RTN","BPSCEAR",77,0)
 ..N TRAN
"RTN","BPSCEAR",78,0)
 ..D GETS^DIQ(TY,P5,".01;1;2;3;5;6;7;8;9;10;13;14","","TRAN")
"RTN","BPSCEAR",79,0)
 ..S P6=P5_","
"RTN","BPSCEAR",80,0)
 ..Q:TRAN(TY,P6,.01)']""
"RTN","BPSCEAR",81,0)
 ..I '$D(DIVNM(TRAN(TY,P6,2))) Q
"RTN","BPSCEAR",82,0)
 ..I TRAN(TY,P6,2)'=DIVDA(DIVDA) Q
"RTN","BPSCEAR",83,0)
 ..;
"RTN","BPSCEAR",84,0)
 ..;Set flag that at least one record was found
"RTN","BPSCEAR",85,0)
 ..S BPFND=1
"RTN","BPSCEAR",86,0)
 ..;
"RTN","BPSCEAR",87,0)
 ..;Display Transmission Information - Normal Display Only
"RTN","BPSCEAR",88,0)
 ..I 'BPEXCEL D
"RTN","BPSCEAR",89,0)
 ...D TITLE
"RTN","BPSCEAR",90,0)
 ...W !!,?7,"TRANSMISSION:",?35,TRAN(TY,P6,.01)
"RTN","BPSCEAR",91,0)
 ...W !,?7,"STATUS:",?35,TRAN(TY,P6,1)
"RTN","BPSCEAR",92,0)
 ...W !,?7,"DIVISION:",?35,TRAN(TY,P6,2)
"RTN","BPSCEAR",93,0)
 ...W !,?7,"CMOP SYSTEM:",?35,TRAN(TY,P6,3)
"RTN","BPSCEAR",94,0)
 ...W !,?7,"TRANSMISSION DATE/TIME:",?35,TRAN(TY,P6,5)
"RTN","BPSCEAR",95,0)
 ...I TRAN(TY,P6,6) W !,?7,"CREATED DATE/TIME:",?35,TRAN(TY,P6,6)
"RTN","BPSCEAR",96,0)
 ...I TRAN(TY,P6,7) W !,?7,"RECEIVED DATE/TIME:",?35,TRAN(TY,P6,7)
"RTN","BPSCEAR",97,0)
 ...I TRAN(TY,P6,8) W !,?7,"RETRANSMISSION #:",?35,TRAN(TY,P6,8)
"RTN","BPSCEAR",98,0)
 ...I TRAN(TY,P6,9) W !,?7,"ORIGINAL TRANS.:",?35,TRAN(TY,P6,9)
"RTN","BPSCEAR",99,0)
 ...I TRAN(TY,P6,10) W !,?7,"CLOSED DATE/TIME:",?35,TRAN(TY,P6,10)
"RTN","BPSCEAR",100,0)
 ...W !,?7,"TOTAL PATIENTS:",?35,TRAN(TY,P6,13)
"RTN","BPSCEAR",101,0)
 ...W !,?7,"TOTAL RXS:",?35,TRAN(TY,P6,14)
"RTN","BPSCEAR",102,0)
 ..;
"RTN","BPSCEAR",103,0)
 ..;Display Records in Normal Format
"RTN","BPSCEAR",104,0)
 ..I 'BPEXCEL D  Q
"RTN","BPSCEAR",105,0)
 ...S PS=$$PDET(TY,P5) Q:$G(POP)
"RTN","BPSCEAR",106,0)
 ...I 'PS D CHKP(3) Q:$G(POP)  D NDAT
"RTN","BPSCEAR",107,0)
 ...I BPSCR D PAUSE Q:$G(POP)
"RTN","BPSCEAR",108,0)
 ..;
"RTN","BPSCEAR",109,0)
 ..;Display Records in Excel Format
"RTN","BPSCEAR",110,0)
 ..D PDETEX(TY,P5)
"RTN","BPSCEAR",111,0)
 Q
"RTN","BPSCEAR",112,0)
 ;
"RTN","BPSCEAR",113,0)
 ;Display Record(s) - Normal Format
"RTN","BPSCEAR",114,0)
PDET(TY,P5) N BIEN,DFN,FL,M,N,NDCR,NDCS,P7,PS,RDT,RXI,VA
"RTN","BPSCEAR",115,0)
 D PLINE
"RTN","BPSCEAR",116,0)
 S (PS,P7)=0 F  S P7=$O(^PSX(TY,P5,15,P7)) Q:'P7  D  Q:$G(POP)
"RTN","BPSCEAR",117,0)
 .S RXI=+$$GET1^DIQ(550.215,P7_","_P5_",",".01","I")
"RTN","BPSCEAR",118,0)
 .S FL=+$$GET1^DIQ(550.215,P7_","_P5_",",".02","I")
"RTN","BPSCEAR",119,0)
 .S DFN=+$$GET1^DIQ(550.215,P7_","_P5_",",".03","I")
"RTN","BPSCEAR",120,0)
 .Q:$$STATUS^BPSOSRX(RXI,FL)=""
"RTN","BPSCEAR",121,0)
 .D CHKP(2) Q:$G(POP)
"RTN","BPSCEAR",122,0)
 .S PS=1 D PID^VADPT
"RTN","BPSCEAR",123,0)
 .S BIEN=RXI_"."_$E($TR($J("",4-$L(FL))," ","0")_FL,1,4)_1
"RTN","BPSCEAR",124,0)
 .S RDT=$S(FL=0:$$GET1^DIQ(52,RXI,31,"I"),1:$$GET1^DIQ(52.1,FL_","_RXI_",",17,"I"))
"RTN","BPSCEAR",125,0)
 .W !,$E($$GET1^DIQ(2,DFN,.01),1,14)_" ("_$G(VA("BID"))_")"
"RTN","BPSCEAR",126,0)
 .W ?22,RXI_"/"_$$GET1^DIQ(52,RXI,.01)_$S($G(^PSRX(RXI,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXI)_"/"_FL
"RTN","BPSCEAR",127,0)
 .S (NDCS,NDCR)="",(M,N)=0
"RTN","BPSCEAR",128,0)
 .F  S M=$O(^PSRX(RXI,4,M)) Q:'M  S N=^(M,0) I $P(N,"^",3)=FL S NDCR=$P(N,"^",8),NDCS=$P(N,"^",9)
"RTN","BPSCEAR",129,0)
 .W ?45,$E(NDCS,1,13),?59,$E(NDCR,1,13),?73,$S(RDT:"DISPENS",1:"TRANSMI")
"RTN","BPSCEAR",130,0)
 .W !,?3,$E($$GET1^DIQ(52,RXI,6),1,18),?22,$P($G(^BPST(BIEN,10,1,0)),"^",7)
"RTN","BPSCEAR",131,0)
 .W ?38,$E($$STATUS^BPSOSRX(RXI,FL),1,7),?48,$P($$BILLINFO^IBNCPDPI(RXI,FL),"^",1),?58,$S(RDT:$E(RDT,4,5)_"/"_$E(RDT,6,7)_"/"_$E(RDT,2,3),1:"")
"RTN","BPSCEAR",132,0)
 Q PS
"RTN","BPSCEAR",133,0)
 ;
"RTN","BPSCEAR",134,0)
 ;Display Record(s) - Excel Format
"RTN","BPSCEAR",135,0)
PDETEX(TY,P5) N BIEN,DFN,FL,M,N,NDCR,NDCS,P7,PS,RDT,RXI,VA
"RTN","BPSCEAR",136,0)
 S P7=0 F  S P7=$O(^PSX(TY,P5,15,P7)) Q:'P7  D
"RTN","BPSCEAR",137,0)
 .S RXI=+$$GET1^DIQ(550.215,P7_","_P5_",",".01","I")
"RTN","BPSCEAR",138,0)
 .S FL=+$$GET1^DIQ(550.215,P7_","_P5_",",".02","I")
"RTN","BPSCEAR",139,0)
 .S DFN=+$$GET1^DIQ(550.215,P7_","_P5_",",".03","I")
"RTN","BPSCEAR",140,0)
 .Q:$$STATUS^BPSOSRX(RXI,FL)=""
"RTN","BPSCEAR",141,0)
 .S PS=1 D PID^VADPT
"RTN","BPSCEAR",142,0)
 .S BIEN=RXI_"."_$E($TR($J("",4-$L(FL))," ","0")_FL,1,4)_1
"RTN","BPSCEAR",143,0)
 .S RDT=$S(FL=0:$$GET1^DIQ(52,RXI,31,"I"),1:$$GET1^DIQ(52.1,FL_","_RXI_",",17,"I"))
"RTN","BPSCEAR",144,0)
 .W !,TRAN(TY,P6,.01),U  ;Transmission
"RTN","BPSCEAR",145,0)
 .W TRAN(TY,P6,1),U  ;Status
"RTN","BPSCEAR",146,0)
 .W TRAN(TY,P6,2),U  ;Division
"RTN","BPSCEAR",147,0)
 .W TRAN(TY,P6,3),U  ;CMOP System
"RTN","BPSCEAR",148,0)
 .W TRAN(TY,P6,5),U  ;Transmission Date/Time
"RTN","BPSCEAR",149,0)
 .W $E($$GET1^DIQ(2,DFN,.01),1,14),U  ;Name
"RTN","BPSCEAR",150,0)
 .W "("_$G(VA("BID"))_")",U  ;Pt.ID
"RTN","BPSCEAR",151,0)
 .W RXI,U                             ;ECME#
"RTN","BPSCEAR",152,0)
 .W $$GET1^DIQ(52,RXI,.01)_$S($G(^PSRX(RXI,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXI),U  ;RX#
"RTN","BPSCEAR",153,0)
 .W FL,U                     ;FL#
"RTN","BPSCEAR",154,0)
 .N NDCS,NDCR,M,N S (NDCS,NDCR)="",(M,N)=0
"RTN","BPSCEAR",155,0)
 .F  S M=$O(^PSRX(RXI,4,M)) Q:'M  S N=^(M,0) I $P(N,"^",3)=FL S NDCR=$P(N,"^",8),NDCS=$P(N,"^",9)
"RTN","BPSCEAR",156,0)
 .W $E(NDCS,1,13),U          ;NDC SENT
"RTN","BPSCEAR",157,0)
 .W $E(NDCR,1,13),U          ;NDC RECVD
"RTN","BPSCEAR",158,0)
 .W $S(RDT:"DISPENS",1:"TRANSMI"),U  ;CMOP-STAT
"RTN","BPSCEAR",159,0)
 .W $E($$GET1^DIQ(52,RXI,6),1,18),U  ;DRUG
"RTN","BPSCEAR",160,0)
 .W $P($G(^BPST(BIEN,10,1,0)),"^",7),U  ;INSURANCE
"RTN","BPSCEAR",161,0)
 .W $E($$STATUS^BPSOSRX(RXI,FL),1,7),U  ;PAY-STAT
"RTN","BPSCEAR",162,0)
 .W $P($$BILLINFO^IBNCPDPI(RXI,FL),"^",1),U  ;BILL#
"RTN","BPSCEAR",163,0)
 .W $S(RDT:$E(RDT,4,5)_"/"_$E(RDT,6,7)_"/"_$E(RDT,2,3),1:"")  ;REL-DATE
"RTN","BPSCEAR",164,0)
 Q
"RTN","BPSCEAR",165,0)
 ;
"RTN","BPSCEAR",166,0)
 ;Display Header - Normal
"RTN","BPSCEAR",167,0)
 ;
"RTN","BPSCEAR",168,0)
PLINE W !,"NAME",?22,"ECME#/RX#/FL#",?45,"NDC SENT",?59,"NDC RECVD",?71,"CMOP-STAT"
"RTN","BPSCEAR",169,0)
 W !,"   DRUG",?22,"INSURANCE",?38,"PAY-STAT",?48,"BILL#",?58,"REL-DATE"
"RTN","BPSCEAR",170,0)
 X LINE
"RTN","BPSCEAR",171,0)
 Q
"RTN","BPSCEAR",172,0)
 ;
"RTN","BPSCEAR",173,0)
 ;Display Header - Excel
"RTN","BPSCEAR",174,0)
 ;
"RTN","BPSCEAR",175,0)
PLINEX W !,"TRANSMISSION",U,"STATUS",U,"DIVISION",U,"CMOP SYSTEM",U,"TRANSMISSION DATE/TIME",U
"RTN","BPSCEAR",176,0)
 W "NAME",U,"Pt.ID",U,"ECME#",U,"RX#",U,"FL#",U,"NDC SENT",U,"NDC RECVD",U,"CMOP-STAT",U
"RTN","BPSCEAR",177,0)
 W "DRUG",U,"INSURANCE",U,"PAY-STAT",U,"BILL#",U,"REL-DATE"
"RTN","BPSCEAR",178,0)
 Q
"RTN","BPSCEAR",179,0)
 ;
"RTN","BPSCEAR",180,0)
EXIT I '$G(POP) D PAUSE2
"RTN","BPSCEAR",181,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","BPSCEAR",182,0)
 I $G(POP)'=1 D ^%ZISC
"RTN","BPSCEAR",183,0)
 Q
"RTN","BPSCEAR",184,0)
 ;
"RTN","BPSCEAR",185,0)
 ;Print message if no billable prescriptions
"RTN","BPSCEAR",186,0)
 ;
"RTN","BPSCEAR",187,0)
NDAT W !!,"********* BATCH HAS NO ECME BILLABLE PRESCRIPTIONS *******",!
"RTN","BPSCEAR",188,0)
 Q
"RTN","BPSCEAR",189,0)
 ;
"RTN","BPSCEAR",190,0)
TITLE W @IOF
"RTN","BPSCEAR",191,0)
 W !,?25,"CMOP/ECME ACTIVITY REPORT "_$S($G(BPFND)=1:"for "_$E(DIVDA(DIVDA),1,24),1:"")
"RTN","BPSCEAR",192,0)
 W !,"For ",BPSBE,"  thru  ",$P(BPSEE,"@"),?40,"Printed: ",BPSNOW
"RTN","BPSCEAR",193,0)
 X LINE
"RTN","BPSCEAR",194,0)
 Q
"RTN","BPSCEAR",195,0)
 ;
"RTN","BPSCEAR",196,0)
CHKP(BPLINES) Q:$G(BPEXCEL)
"RTN","BPSCEAR",197,0)
 S BPLINES=BPLINES+1
"RTN","BPSCEAR",198,0)
 I $G(BPSCR) S BPLINES=BPLINES+2
"RTN","BPSCEAR",199,0)
 I $Y>(IOSL-BPLINES) D:$G(BPSCR) PAUSE Q:$G(POP)  D TITLE,PLINE Q
"RTN","BPSCEAR",200,0)
 Q
"RTN","BPSCEAR",201,0)
 ;
"RTN","BPSCEAR",202,0)
 ; Enter Date Range
"RTN","BPSCEAR",203,0)
 ;
"RTN","BPSCEAR",204,0)
 ; Return Value -> P1^P2
"RTN","BPSCEAR",205,0)
 ; 
"RTN","BPSCEAR",206,0)
 ;           where P1 = From Date
"RTN","BPSCEAR",207,0)
 ;                    = ^ Exit
"RTN","BPSCEAR",208,0)
 ;                 P2 = To Date
"RTN","BPSCEAR",209,0)
 ;                    = blank for Exit
"RTN","BPSCEAR",210,0)
 ;                 
"RTN","BPSCEAR",211,0)
SELDATE() N DIR,DIRUT,DTOUT,DUOUT,VAL,X,Y
"RTN","BPSCEAR",212,0)
 S VAL=""
"RTN","BPSCEAR",213,0)
 S DIR(0)="DA",DIR("A")="ENTER BEGINNING TRANSMISSION DATE: "
"RTN","BPSCEAR",214,0)
 D ^DIR
"RTN","BPSCEAR",215,0)
 ;
"RTN","BPSCEAR",216,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSCEAR",217,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^"
"RTN","BPSCEAR",218,0)
 ;
"RTN","BPSCEAR",219,0)
 I VAL="" D
"RTN","BPSCEAR",220,0)
 .S $P(VAL,U)=Y
"RTN","BPSCEAR",221,0)
 .S DIR(0)="DA^"_VAL,DIR("A")="ENTER ENDING TRANSMISSION DATE: "
"RTN","BPSCEAR",222,0)
 .D ^DIR
"RTN","BPSCEAR",223,0)
 .;
"RTN","BPSCEAR",224,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSCEAR",225,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^" Q
"RTN","BPSCEAR",226,0)
 .;
"RTN","BPSCEAR",227,0)
 .;Define Entry
"RTN","BPSCEAR",228,0)
 .S $P(VAL,U,2)=Y
"RTN","BPSCEAR",229,0)
 ;
"RTN","BPSCEAR",230,0)
 Q VAL
"RTN","BPSCEAR",231,0)
 ;
"RTN","BPSCEAR",232,0)
 ;Select Divisions
"RTN","BPSCEAR",233,0)
 ;
"RTN","BPSCEAR",234,0)
 ; Returns Arrays -> DIVNM("names of divisions") = selection number
"RTN","BPSCEAR",235,0)
 ;                   DIVDA("iens of divisions") = name of division
"RTN","BPSCEAR",236,0)
 ;                   
"RTN","BPSCEAR",237,0)
SELDIV N DIR,DIV,DIVX,DIRUT,DUOUT,DTOUT,I,X,Y
"RTN","BPSCEAR",238,0)
 W !!,"SELECTION OF DIVISION(S)",!
"RTN","BPSCEAR",239,0)
 S DIV="" F I=1:1 S DIV=$O(^PS(59,"B",DIV)) Q:DIV=""  S DIVNM(I)=DIV,DIVNM(DIV)=I,DIVDA=$O(^PS(59,"B",DIV,0)),DIVNM(I,"I")=DIVDA
"RTN","BPSCEAR",240,0)
 S I=I-1
"RTN","BPSCEAR",241,0)
 K DIR S DIR(0)="S^A:ALL DIVISIONS;S:SELECT DIVISIONS"
"RTN","BPSCEAR",242,0)
 ;
"RTN","BPSCEAR",243,0)
 D ^DIR
"RTN","BPSCEAR",244,0)
 ;
"RTN","BPSCEAR",245,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSCEAR",246,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="^") K DIVNM Q
"RTN","BPSCEAR",247,0)
 ;
"RTN","BPSCEAR",248,0)
 ;All Divisions
"RTN","BPSCEAR",249,0)
 I Y="A" D ALL Q
"RTN","BPSCEAR",250,0)
 ;
"RTN","BPSCEAR",251,0)
 ;Select Divisions
"RTN","BPSCEAR",252,0)
 I Y="S" D SELECT(I),ALL
"RTN","BPSCEAR",253,0)
 Q
"RTN","BPSCEAR",254,0)
 ;
"RTN","BPSCEAR",255,0)
 ;Select which divisions to display
"RTN","BPSCEAR",256,0)
 ;
"RTN","BPSCEAR",257,0)
SELECT(I) N C,DIR,DIVX,DIRUT,DUOUT,DTOUT,X,Y
"RTN","BPSCEAR",258,0)
 F C=1:1:I S DIR("A",C)=C_"    "_DIVNM(C)
"RTN","BPSCEAR",259,0)
 S DIR(0)="LO^1:"_I,DIR("A")="Select Division(s) "
"RTN","BPSCEAR",260,0)
 D ^DIR
"RTN","BPSCEAR",261,0)
 ;
"RTN","BPSCEAR",262,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSCEAR",263,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="^")!('+Y) K DIVNM Q
"RTN","BPSCEAR",264,0)
 ;
"RTN","BPSCEAR",265,0)
 M DIVX=DIVNM K DIVNM
"RTN","BPSCEAR",266,0)
 F I=1:1 S X=$P(Y,",",I) Q:'X  M DIVNM(X)=DIVX(X) S DIVNM=DIVX(X),DIVNM(DIVNM)=X
"RTN","BPSCEAR",267,0)
 Q
"RTN","BPSCEAR",268,0)
 ;
"RTN","BPSCEAR",269,0)
 ;Display selected divisions
"RTN","BPSCEAR",270,0)
 ;
"RTN","BPSCEAR",271,0)
ALL N DA,DIR,DIV,DIRUT,DUOUT,DTOUT,X,Y
"RTN","BPSCEAR",272,0)
 Q:'$D(DIVNM)
"RTN","BPSCEAR",273,0)
 W !!,"You have selected:",! S DIV=0 F  S DIV=$O(DIVNM(DIV)) Q:'DIV  W !,DIV,?5,DIVNM(DIV)
"RTN","BPSCEAR",274,0)
 S DIR(0)="Y",DIR("A")="Is this correct",DIR("B")="YES" D ^DIR
"RTN","BPSCEAR",275,0)
 K DIR
"RTN","BPSCEAR",276,0)
 I Y=1 S DIV=0 F  S DIV=$O(DIVNM(DIV)) Q:'DIV  S DA=DIVNM(DIV,"I"),DIVDA(DA)=DIVNM(DIV) K DIVNM(DIV)
"RTN","BPSCEAR",277,0)
 ;
"RTN","BPSCEAR",278,0)
 ;Check for "^", timeout, or non-yes entry
"RTN","BPSCEAR",279,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)'=1) K DIVNM
"RTN","BPSCEAR",280,0)
 Q
"RTN","BPSCEAR",281,0)
 ;
"RTN","BPSCEAR",282,0)
 ;Screen Pause 2
"RTN","BPSCEAR",283,0)
 ;
"RTN","BPSCEAR",284,0)
PAUSE2 Q:'$G(BPSCR)
"RTN","BPSCEAR",285,0)
 N X
"RTN","BPSCEAR",286,0)
 U IO(0) W !!,"Press RETURN to continue:"
"RTN","BPSCEAR",287,0)
 R X:$G(DTIME)
"RTN","BPSCEAR",288,0)
 U IO
"RTN","BPSCEAR",289,0)
 Q
"RTN","BPSCEAR",290,0)
 ;
"RTN","BPSCEAR",291,0)
 ;Screen Pause 1
"RTN","BPSCEAR",292,0)
 ;
"RTN","BPSCEAR",293,0)
 ; Return variable - BPQ = 0 Continue
"RTN","BPSCEAR",294,0)
 ;                         2 Quit
"RTN","BPSCEAR",295,0)
PAUSE N X
"RTN","BPSCEAR",296,0)
 U IO(0) W !!,"Press RETURN to continue, '^' to exit:"
"RTN","BPSCEAR",297,0)
 R X:$G(DTIME) S:'$T X="^" S:X["^" POP=2
"RTN","BPSCEAR",298,0)
 U IO
"RTN","BPSCEAR",299,0)
 Q
"RTN","BPSCMT")
0^313^B18604091
"RTN","BPSCMT",1,0)
BPSCMT ;BHAM ISC/SS - ECME SCREEN ADD/VIEW COMMENTS ;28-MAR-2005
"RTN","BPSCMT",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSCMT",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSCMT",4,0)
 ;USER SCREEN
"RTN","BPSCMT",5,0)
 Q
"RTN","BPSCMT",6,0)
 ;
"RTN","BPSCMT",7,0)
CMT ;to invoke Add/View comments LM screen from main LM User Screen
"RTN","BPSCMT",8,0)
 N BPRET,BPSEL
"RTN","BPSCMT",9,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSCMT",10,0)
 D FULL^VALM1
"RTN","BPSCMT",11,0)
 W !,"Enter the line number for which you wish to Add/View comments."
"RTN","BPSCMT",12,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","PC","Please select a SINGLE Patient Line item or a SINGLE Rx Line item when accessing Comments")
"RTN","BPSCMT",13,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSCMT",14,0)
 ;save some User Screen's configuration information VALVAR
"RTN","BPSCMT",15,0)
 D SAVESEL(BPSEL,VALMAR)
"RTN","BPSCMT",16,0)
 ;invoke Add/View comments LM screen
"RTN","BPSCMT",17,0)
 D EN
"RTN","BPSCMT",18,0)
 ;update the content of the main User Screen and redraw it
"RTN","BPSCMT",19,0)
 I $G(^TMP("BPSSCR",$J,"VALM","UPDATE"))=1 D
"RTN","BPSCMT",20,0)
 . D REDRAW^BPSSCRUD("Updating user screen for new comment(s)...")
"RTN","BPSCMT",21,0)
 . K ^TMP("BPSSCR",$J,"VALM","UPDATE")
"RTN","BPSCMT",22,0)
 ;return to main User Screen
"RTN","BPSCMT",23,0)
 S VALMBCK="R"
"RTN","BPSCMT",24,0)
 Q
"RTN","BPSCMT",25,0)
 ;
"RTN","BPSCMT",26,0)
EN ; -- main entry point for BPS LSTMN COMMENTS
"RTN","BPSCMT",27,0)
 D EN^VALM("BPS LSTMN COMMENTS")
"RTN","BPSCMT",28,0)
 Q
"RTN","BPSCMT",29,0)
 ;
"RTN","BPSCMT",30,0)
HDR ; -- header code
"RTN","BPSCMT",31,0)
 N BPARR,BPX
"RTN","BPSCMT",32,0)
 Q:'$D(@VALMAR@("VIEWPARAMS"))
"RTN","BPSCMT",33,0)
 D RESTVIEW^BPSSCR01(.BPARR) ;Note: restore settings from current 
"RTN","BPSCMT",34,0)
 ;("BPSCMT") TMP (because we have already put main screen setting in this TMP, see SAVESEL)
"RTN","BPSCMT",35,0)
 S VALMHDR(1)="PHARMACY ECME"
"RTN","BPSCMT",36,0)
 S VALMHDR(2)="SELECTED DIVISION(S): "_$$GETVDIVS^BPSSCR01(.BPARR,58)
"RTN","BPSCMT",37,0)
 S VALMHDR(3)=$$GETVDETS^BPSSCR01(.BPARR)
"RTN","BPSCMT",38,0)
 Q
"RTN","BPSCMT",39,0)
 ;
"RTN","BPSCMT",40,0)
INIT ; -- init variables and list array
"RTN","BPSCMT",41,0)
 ;
"RTN","BPSCMT",42,0)
 N BP59,BP59ARR,BPJSTPAT,BPINSDAT
"RTN","BPSCMT",43,0)
 N BPX,BPPATIND,BPCLMIND,BPDFN,BPSSTR,BPPRNTGL,BPSINSUR,BP1LN
"RTN","BPSCMT",44,0)
 I '$D(@VALMAR@("SELLN")) D SET^VALM10(1,"Needs to be called from BPS LSTMN ECME USRSCR template") Q
"RTN","BPSCMT",45,0)
 S BPX=@VALMAR@("SELLN")
"RTN","BPSCMT",46,0)
 S BPDFN=+$P(BPX,U,2)
"RTN","BPSCMT",47,0)
 S BPSINSUR=+$P(BPX,U,3)
"RTN","BPSCMT",48,0)
 S BP1LN=+$P(BPX,U,5)
"RTN","BPSCMT",49,0)
 S BPPRNTGL=@VALMAR@("PARENT")
"RTN","BPSCMT",50,0)
 S BPPATIND=+$P(BPX,U,6)
"RTN","BPSCMT",51,0)
 S BPCLMIND=+$P(BPX,U,7)
"RTN","BPSCMT",52,0)
 S BPJSTPAT=0
"RTN","BPSCMT",53,0)
 I BPCLMIND=0 S BPJSTPAT=1
"RTN","BPSCMT",54,0)
 I BPJSTPAT D
"RTN","BPSCMT",55,0)
 . D MKPATARR(BPPRNTGL,BPPATIND,.BP59ARR)
"RTN","BPSCMT",56,0)
 . S BPCLMIND=0
"RTN","BPSCMT",57,0)
 . S BPPATIND=$S(BPPATIND<1:0,1:BPPATIND-1) ;since the MKARRELM will increase it by 1
"RTN","BPSCMT",58,0)
 E  D
"RTN","BPSCMT",59,0)
 . S BP59ARR(+$P(BPX,U,4))="" ;
"RTN","BPSCMT",60,0)
 . S BPCLMIND=$S(BPCLMIND<1:0,1:BPCLMIND-1) ;since the MKARRELM will increase it by 1
"RTN","BPSCMT",61,0)
 ;make LM array element(s)
"RTN","BPSCMT",62,0)
 S BPPREV=0 ;to store data from previous patient/insurance group
"RTN","BPSCMT",63,0)
 S BPLINE=1
"RTN","BPSCMT",64,0)
 S BPINSDAT=$$GETINSUR^BPSSCRU2(+$O(BP59ARR(0)))
"RTN","BPSCMT",65,0)
 S BPSINSUR=+BPINSDAT ;patient's insurance IEN
"RTN","BPSCMT",66,0)
 I BPJSTPAT D MKPATELM^BPSCMT01(.BPLINE,VALMAR,BPDFN,BPINSDAT,.BPPATIND,.BPCLMIND,.BPPREV)
"RTN","BPSCMT",67,0)
 S BP59=0
"RTN","BPSCMT",68,0)
 F  S BP59=$O(BP59ARR(BP59)) Q:+BP59=0  D
"RTN","BPSCMT",69,0)
 . D MKCLMELM^BPSCMT01(.BPLINE,VALMAR,BP59,BPDFN,BPSINSUR,.BPPATIND,.BPCLMIND,.BPPREV)
"RTN","BPSCMT",70,0)
 . ;S BPLINE=BPLINE+1
"RTN","BPSCMT",71,0)
 I BPJSTPAT D UPDPREV^BPSCMT01(VALMAR,.BPPATIND,.BPPREV)
"RTN","BPSCMT",72,0)
 S VALMCNT=$S(BPLINE>1:BPLINE-1,1:BPLINE)
"RTN","BPSCMT",73,0)
 Q
"RTN","BPSCMT",74,0)
 ;/**
"RTN","BPSCMT",75,0)
 ;make array of all claims (ptrs to #9002313.59)
"RTN","BPSCMT",76,0)
 ;for the patient/insurance pair
"RTN","BPSCMT",77,0)
 ;input
"RTN","BPSCMT",78,0)
 ;BPPRNTGL - tmp global in parent LM
"RTN","BPSCMT",79,0)
 ;BPPATIND - patient summary index
"RTN","BPSCMT",80,0)
 ;BP59ARR - array to return results
"RTN","BPSCMT",81,0)
MKPATARR(BPPRNTGL,BPPATIND,BP59ARR) ;
"RTN","BPSCMT",82,0)
 N BPCLM,BPDFN,BPINS,BP59
"RTN","BPSCMT",83,0)
 S BPCLM=0 F  S BPCLM=$O(@BPPRNTGL@("LMIND",BPPATIND,BPCLM)) Q:+BPCLM=0  D
"RTN","BPSCMT",84,0)
 . S BPDFN=0 F  S BPDFN=$O(@BPPRNTGL@("LMIND",BPPATIND,BPCLM,BPDFN)) Q:+BPDFN=0  D
"RTN","BPSCMT",85,0)
 . . S BPINS="" F  S BPINS=$O(@BPPRNTGL@("LMIND",BPPATIND,BPCLM,BPDFN,BPINS)) Q:BPINS=""  D
"RTN","BPSCMT",86,0)
 . . . S BP59=0 F  S BP59=$O(@BPPRNTGL@("LMIND",BPPATIND,BPCLM,BPDFN,BPINS,BP59)) Q:+BP59=0  D
"RTN","BPSCMT",87,0)
 . . . . S BP59ARR(BP59)=""
"RTN","BPSCMT",88,0)
 Q
"RTN","BPSCMT",89,0)
 ;
"RTN","BPSCMT",90,0)
 ;/**
"RTN","BPSCMT",91,0)
HELP ; -- help code
"RTN","BPSCMT",92,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSCMT",93,0)
 Q
"RTN","BPSCMT",94,0)
 ;
"RTN","BPSCMT",95,0)
EXIT ; -- exit code
"RTN","BPSCMT",96,0)
 K @VALMAR
"RTN","BPSCMT",97,0)
 Q
"RTN","BPSCMT",98,0)
 ;
"RTN","BPSCMT",99,0)
EXPND ; -- expand code
"RTN","BPSCMT",100,0)
 Q
"RTN","BPSCMT",101,0)
 ;
"RTN","BPSCMT",102,0)
 ;/**
"RTN","BPSCMT",103,0)
 ;save selection in order to use inside enclosed ListManager copy
"RTN","BPSCMT",104,0)
 ;input:
"RTN","BPSCMT",105,0)
 ;BPSEL - selected line
"RTN","BPSCMT",106,0)
 ;BPVALMR - parent VALMAR 
"RTN","BPSCMT",107,0)
SAVESEL(BPSEL,BPVALMR) ;
"RTN","BPSCMT",108,0)
 D CLEANIT
"RTN","BPSCMT",109,0)
 S ^TMP("BPSCMT",$J,"VALM","SELLN")=BPSEL
"RTN","BPSCMT",110,0)
 S ^TMP("BPSCMT",$J,"VALM","PARENT")=BPVALMR
"RTN","BPSCMT",111,0)
 M ^TMP("BPSCMT",$J,"VALM","VIEWPARAMS")=@BPVALMR@("VIEWPARAMS")
"RTN","BPSCMT",112,0)
 Q
"RTN","BPSCMT",113,0)
 ;
"RTN","BPSCMT",114,0)
CLEANIT ;
"RTN","BPSCMT",115,0)
 K ^TMP("BPSCMT",$J,"VALM")
"RTN","BPSCMT",116,0)
 Q
"RTN","BPSCMT",117,0)
 ;
"RTN","BPSCMT",118,0)
 ;redraw the screen for Add/View comments option
"RTN","BPSCMT",119,0)
REDRWCMT ;
"RTN","BPSCMT",120,0)
 N BPARR,BPVALMR,BPSEL
"RTN","BPSCMT",121,0)
 S BPSEL=$G(@VALMAR@("SELLN"))
"RTN","BPSCMT",122,0)
 S BPVALMR=$G(@VALMAR@("PARENT"))
"RTN","BPSCMT",123,0)
 D CLEAN^VALM10
"RTN","BPSCMT",124,0)
 K @VALMAR
"RTN","BPSCMT",125,0)
 S @VALMAR@("SELLN")=BPSEL
"RTN","BPSCMT",126,0)
 S @VALMAR@("PARENT")=BPVALMR
"RTN","BPSCMT",127,0)
 M @VALMAR@("VIEWPARAMS")=@BPVALMR@("VIEWPARAMS")
"RTN","BPSCMT",128,0)
 D INIT^BPSCMT
"RTN","BPSCMT",129,0)
 D HDR^BPSCMT
"RTN","BPSCMT",130,0)
 S VALMBCK="R"
"RTN","BPSCMT",131,0)
 Q
"RTN","BPSCMT",132,0)
 ;
"RTN","BPSCMT",133,0)
 ;
"RTN","BPSCMT",134,0)
 ;
"RTN","BPSCMT01")
0^314^B18647385
"RTN","BPSCMT01",1,0)
BPSCMT01 ;BHAM ISC/SS - ECME ADD/VIEW COMMENTS ;05-APR-05
"RTN","BPSCMT01",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSCMT01",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSCMT01",4,0)
 ;USER SCREEN
"RTN","BPSCMT01",5,0)
 Q
"RTN","BPSCMT01",6,0)
 ;
"RTN","BPSCMT01",7,0)
ADD ;entry point for Add option in Add/View screen
"RTN","BPSCMT01",8,0)
 ;full screen mode
"RTN","BPSCMT01",9,0)
 D FULL^VALM1
"RTN","BPSCMT01",10,0)
 D ADDCMT
"RTN","BPSCMT01",11,0)
 S VALMBCK="R"
"RTN","BPSCMT01",12,0)
 Q
"RTN","BPSCMT01",13,0)
 ;make element for the patient
"RTN","BPSCMT01",14,0)
 ;BPLINE - line number in LM ARRAY (by ref)
"RTN","BPSCMT01",15,0)
 ;BPTMP - VALMAR (TMP global for LM)
"RTN","BPSCMT01",16,0)
 ;BPDFN - patient's DFN
"RTN","BPSCMT01",17,0)
 ;BPSINSUR - ;patient's insurance ien^name^phone
"RTN","BPSCMT01",18,0)
 ;BPLMIND - passed by ref - current patient(/insurance) index ( to make 1, 2,etc)
"RTN","BPSCMT01",19,0)
 ;BPDRIND - passed by ref - current claim level index ( to make .1, .2, .10,... .20,... )
"RTN","BPSCMT01",20,0)
 ;BPPREV - to store previous data to update patient summary line
"RTN","BPSCMT01",21,0)
 ;TMP structure gives on the screen:
"RTN","BPSCMT01",22,0)
 ;^TMP("BPSCMT",$J,"VALM","LMIND",1,0,DFN,0,0)=
"RTN","BPSCMT01",23,0)
 ;^TMP("BPSCMT",$J,"VALM",1,0)=1   BUMSTEAD,CHARLE (5444)/100-234-2345 *done* FINISHED
"RTN","BPSCMT01",24,0)
 ;on the screen:
"RTN","BPSCMT01",25,0)
 ;1   BUMSTEAD,CHARLE      (5444)   /100-234-2345 *done* FINISHED
"RTN","BPSCMT01",26,0)
MKPATELM(BPLINE,BPTMP,BPDFN,BPSINSUR,BPLMIND,BPDRIND,BPPREV) ;*/
"RTN","BPSCMT01",27,0)
 N BPSSTR,BPLNS,BPSTAT
"RTN","BPSCMT01",28,0)
 ;PATIENT SUMMARY level
"RTN","BPSCMT01",29,0)
 ;-------- first process previous patient & insurance group
"RTN","BPSCMT01",30,0)
 ;determine patient summary statuses for the previous "patient" group
"RTN","BPSCMT01",31,0)
 ;update the record for previous patient summary after we went thru all his claims
"RTN","BPSCMT01",32,0)
 I BPLMIND>0,+BPPREV=BPLMIND D UPDPREV(BPTMP,BPLMIND,BPPREV)
"RTN","BPSCMT01",33,0)
 ;process new "patient & insurance" group ------------------
"RTN","BPSCMT01",34,0)
 S BPDRIND=0
"RTN","BPSCMT01",35,0)
 S BPLMIND=(BPLMIND\1)+1
"RTN","BPSCMT01",36,0)
 ;save the all necessary data for the patient & insurance to use as previous for STAT4PAT later on
"RTN","BPSCMT01",37,0)
 S BPPREV=BPLMIND_U_BPLINE_U_BPDFN_U_$$PATINF^BPSSCR02(BPDFN,BPSINSUR)_U_(+BPSINSUR)
"RTN","BPSCMT01",38,0)
 S BPSSTR=$$LJ^BPSSCR02(BPLMIND,4)_$P(BPPREV,U,4)
"RTN","BPSCMT01",39,0)
 D SAVEARR^BPSSCR02(BPTMP,BPLMIND,BPDRIND,BPDFN,0,BPLINE,BPSSTR,+BPSINSUR)
"RTN","BPSCMT01",40,0)
 S BPLINE=BPLINE+1
"RTN","BPSCMT01",41,0)
 Q
"RTN","BPSCMT01",42,0)
 ;
"RTN","BPSCMT01",43,0)
 ;/**
"RTN","BPSCMT01",44,0)
 ;update patient summary info in LM array
"RTN","BPSCMT01",45,0)
UPDPREV(BPTMP,BPLMIND,BPPREV) ;
"RTN","BPSCMT01",46,0)
 N BPSSTR
"RTN","BPSCMT01",47,0)
 ;update the record for previous patient summary after we went thru all his claims
"RTN","BPSCMT01",48,0)
 S BPSSTR=$$LJ^BPSSCR02(BPLMIND,4)_$P(BPPREV,U,4)_" "_$$STAT4PAT^BPSSCR02(BPLMIND)
"RTN","BPSCMT01",49,0)
 D SAVEARR^BPSSCR02(BPTMP,BPLMIND,0,+$P(BPPREV,U,3),0,+$P(BPPREV,U,2),BPSSTR,+$P(BPPREV,U,5))
"RTN","BPSCMT01",50,0)
 Q
"RTN","BPSCMT01",51,0)
 ;/**
"RTN","BPSCMT01",52,0)
 ;make array element for a claim
"RTN","BPSCMT01",53,0)
 ;BPLINE - line number in LM ARRAY (by ref)
"RTN","BPSCMT01",54,0)
 ;BPTMP - VALMAR (TMP global for LM)
"RTN","BPSCMT01",55,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSCMT01",56,0)
 ;BPDFN - patient's DFN
"RTN","BPSCMT01",57,0)
 ;BPSINSUR - ;patient's insurance ien
"RTN","BPSCMT01",58,0)
 ;BPLMIND - passed by ref - current patient(/insurance) index ( to make 1, 2,etc)
"RTN","BPSCMT01",59,0)
 ;BPDRIND - passed by ref - current claim level index ( to make .1, .2, .10,... .20,... )
"RTN","BPSCMT01",60,0)
 ;BPPREV - to store previous data to update patient summary line
"RTN","BPSCMT01",61,0)
MKCLMELM(BPLINE,BPTMP,BP59,BPDFN,BPSINSUR,BPLMIND,BPDRIND,BPPREV) ;*/
"RTN","BPSCMT01",62,0)
 N BPSSTR,BPLNS,BPSTAT
"RTN","BPSCMT01",63,0)
 ;CLAIMS level
"RTN","BPSCMT01",64,0)
 I +$O(@BPTMP@("LMIND",BPLMIND,BPDRIND,BPDFN,0))'=BP59 D
"RTN","BPSCMT01",65,0)
 . S BPDRIND=BPDRIND+1
"RTN","BPSCMT01",66,0)
 . S BPSSTR="  "_$$LJ^BPSSCR02(+$P(BPLMIND,".")_"."_BPDRIND,5)_" "_$$CLAIMINF^BPSSCR02(BP59)
"RTN","BPSCMT01",67,0)
 . D SAVEARR^BPSSCR02(BPTMP,BPLMIND,BPDRIND,BPDFN,BP59,BPLINE,BPSSTR,BPSINSUR)
"RTN","BPSCMT01",68,0)
 . S BPLINE=BPLINE+1
"RTN","BPSCMT01",69,0)
 . N BPARR,X
"RTN","BPSCMT01",70,0)
 . S BPLNS=$$ADDINF^BPSSCR03(BP59,.BPARR,74,"C")
"RTN","BPSCMT01",71,0)
 . F X=1:1:BPLNS D
"RTN","BPSCMT01",72,0)
 . . I $G(BPARR(X))="" Q
"RTN","BPSCMT01",73,0)
 . . D SAVEARR^BPSSCR02(BPTMP,BPLMIND,BPDRIND,BPDFN,BP59,BPLINE,"      "_BPARR(X),BPSINSUR)
"RTN","BPSCMT01",74,0)
 . . S BPLINE=BPLINE+1
"RTN","BPSCMT01",75,0)
 Q
"RTN","BPSCMT01",76,0)
 ;/**
"RTN","BPSCMT01",77,0)
 ;input:
"RTN","BPSCMT01",78,0)
 ; BPDFLT1 - default selection (optional)
"RTN","BPSCMT01",79,0)
 ;add comment
"RTN","BPSCMT01",80,0)
 ;the user can select
"RTN","BPSCMT01",81,0)
 ; a patient - comment will be added to all claims
"RTN","BPSCMT01",82,0)
 ; a claim - comment will be added only to this claim
"RTN","BPSCMT01",83,0)
ADDCMT ;*/
"RTN","BPSCMT01",84,0)
 N BPRET,BPSEL,BP59ARR,BPRCMNT,BP59,BPNOW,BPLCK,BPREC,BPDFLT1
"RTN","BPSCMT01",85,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSCMT01",86,0)
 D FULL^VALM1
"RTN","BPSCMT01",87,0)
 ;select an item
"RTN","BPSCMT01",88,0)
 W !,"Enter the line number for which you wish to Add comments."
"RTN","BPSCMT01",89,0)
 S BPDFLT1=$G(^TMP("BPSCMT",$J,"VALM","SELLN"))
"RTN","BPSCMT01",90,0)
 S BPDFLT1=$P(BPDFLT1,U,6)_"."_$P(BPDFLT1,U,7)
"RTN","BPSCMT01",91,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","PC","Please select Patient Line to add a comment to all RXs or a SINGLE RXs",$G(BPDFLT1))
"RTN","BPSCMT01",92,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSCMT01",93,0)
 ;if single claim
"RTN","BPSCMT01",94,0)
 I $P(BPSEL,U,7)>0 S BP59ARR(+$P(BPSEL,U,4))=""
"RTN","BPSCMT01",95,0)
 E  D MKPATARR^BPSCMT(VALMAR,+$P(BPSEL,U,6),.BP59ARR)
"RTN","BPSCMT01",96,0)
 S BPRCMNT=$$COMMENT^BPSSCRCL("Enter Comment",60)
"RTN","BPSCMT01",97,0)
 I (BPRCMNT="^")!($L(BPRCMNT)=0)!(BPRCMNT?1" "." ") Q
"RTN","BPSCMT01",98,0)
 S BP59=0
"RTN","BPSCMT01",99,0)
 F  S BP59=$O(BP59ARR(BP59)) Q:+BP59=0  D
"RTN","BPSCMT01",100,0)
 . N BPDA,BPERR,%
"RTN","BPSCMT01",101,0)
 . D NOW^%DTC
"RTN","BPSCMT01",102,0)
 . S BPNOW=%
"RTN","BPSCMT01",103,0)
 . L +^BPST(9002313.59111,+BP59):10
"RTN","BPSCMT01",104,0)
 . S BPLCK=$T
"RTN","BPSCMT01",105,0)
 . I 'BPLCK Q  ;quit
"RTN","BPSCMT01",106,0)
 . D INSITEM(9002313.59111,+BP59,BPNOW)
"RTN","BPSCMT01",107,0)
 . S BPREC=$O(^BPST(BP59,11,"B",BPNOW,0))
"RTN","BPSCMT01",108,0)
 . I BPREC>0 D
"RTN","BPSCMT01",109,0)
 . . S BPDA(9002313.59111,BPREC_","_BP59_",",.02)=+$G(DUZ)
"RTN","BPSCMT01",110,0)
 . . S BPDA(9002313.59111,BPREC_","_BP59_",",.03)=$G(BPRCMNT)
"RTN","BPSCMT01",111,0)
 . . D FILE^DIE("","BPDA","BPERR")
"RTN","BPSCMT01",112,0)
 . I BPLCK L -^BPST(9002313.59111,+BP59)
"RTN","BPSCMT01",113,0)
 D REDRWCMT^BPSCMT ;update the content of the screen and display it
"RTN","BPSCMT01",114,0)
 S ^TMP("BPSSCR",$J,"VALM","UPDATE")=1
"RTN","BPSCMT01",115,0)
 Q
"RTN","BPSCMT01",116,0)
 ;
"RTN","BPSCMT01",117,0)
 ;/**
"RTN","BPSCMT01",118,0)
 ;BPSFILE - subfile# (9002313.59111) for comment
"RTN","BPSCMT01",119,0)
 ;BPIEN - ien for file in which the new subfile entry will be inserted
"RTN","BPSCMT01",120,0)
 ;BPVAL01 - .01 value for the new entry
"RTN","BPSCMT01",121,0)
INSITEM(BPSFILE,BPIEN,BPVAL01) ;*/
"RTN","BPSCMT01",122,0)
 N BPSSI,BPIENS,BPFDA,BPER
"RTN","BPSCMT01",123,0)
 S BPIENS="+1,"_BPIEN_","
"RTN","BPSCMT01",124,0)
 S BPFDA(BPSFILE,BPIENS,.01)=BPVAL01
"RTN","BPSCMT01",125,0)
 D UPDATE^DIE("","BPFDA","BPSSI","BPER")
"RTN","BPSCMT01",126,0)
 I $D(BPER) D BMES^XPDUTL(BPER("DIERR",1,"TEXT",1))
"RTN","BPSCMT01",127,0)
 Q
"RTN","BPSCMT01",128,0)
 ;
"RTN","BPSCT")
0^315^B1407002
"RTN","BPSCT",1,0)
BPSCT ;BHAM ISC/SS - ECME CT EDIT SCREEN ;05-APR-05
"RTN","BPSCT",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSCT",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSCT",4,0)
 ;USER SCREEN
"RTN","BPSCT",5,0)
 Q
"RTN","BPSCT",6,0)
CT ;to run from research menu
"RTN","BPSCT",7,0)
 N BPRET,BPSEL,BP59,BPREFIL
"RTN","BPSCT",8,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSCT",9,0)
 D FULL^VALM1
"RTN","BPSCT",10,0)
 W !,"Please select a SINGLE Rx Line item when accessing Claims Tracking."
"RTN","BPSCT",11,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","C","Please select SINGLE RX line.")
"RTN","BPSCT",12,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSCT",13,0)
 N DFN,BPECMEN,IEN356
"RTN","BPSCT",14,0)
 S DFN=+$P(BPSEL,U,2)
"RTN","BPSCT",15,0)
 S BP59=+$P(BPSEL,U,4)
"RTN","BPSCT",16,0)
 S BPREFIL=$P($$RXREF^BPSSCRU2(BP59),U,2)
"RTN","BPSCT",17,0)
 S BPECMEN=$$ECMENUM^BPSSCRU2(BP59) ;ECME number
"RTN","BPSCT",18,0)
 D CT^IBNCPDPC(DFN,BPECMEN,BPREFIL)
"RTN","BPSCT",19,0)
 S VALMBCK="R"
"RTN","BPSCT",20,0)
 Q
"RTN","BPSCT",21,0)
 ;
"RTN","BPSECA1")
0^1^B29804568
"RTN","BPSECA1",1,0)
BPSECA1 ;BHAM ISC/FCS/DRS/VA/DLF - Assemble formatted claim ;05/14/2004
"RTN","BPSECA1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECA1",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA1",4,0)
 ;Assemble ASCII formatted claim submission record
"RTN","BPSECA1",5,0)
 ;
"RTN","BPSECA1",6,0)
 ;Input Variables:   CLAIMIEN - pointer into 9002313.02
"RTN","BPSECA1",7,0)
 ;     The claim must be complete and well-constructed;
"RTN","BPSECA1",8,0)
 ;     we do some paranoiac checks below.
"RTN","BPSECA1",9,0)
 ;
"RTN","BPSECA1",10,0)
 ;     $$ Returns:   - Formatted NCPDP ASCII record
"RTN","BPSECA1",11,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA1",12,0)
 ;
"RTN","BPSECA1",13,0)
 ;IHS/SD/lwj 8/1/02  NCPDP 5.1 changes
"RTN","BPSECA1",14,0)
 ; These is major differences in 3.2 vs 5.1 in the actual creation
"RTN","BPSECA1",15,0)
 ; of the claim.  Of significance:
"RTN","BPSECA1",16,0)
 ;     3.2 had 4 claim segments (hdr req, hdr opt, det req, det opt)
"RTN","BPSECA1",17,0)
 ;     5.1 has 14 claim segments (header, patient, insurance, claim
"RTN","BPSECA1",18,0)
 ;                                pharmacy provider, prescriber,
"RTN","BPSECA1",19,0)
 ;                                COB, workers comp, DUR, Pricing,
"RTN","BPSECA1",20,0)
 ;                                coupon, compound, prior auth,
"RTN","BPSECA1",21,0)
 ;                                clinical)
"RTN","BPSECA1",22,0)
 ;
"RTN","BPSECA1",23,0)
 ;    3.2 required only field identifiers and separators on optional
"RTN","BPSECA1",24,0)
 ;        fields
"RTN","BPSECA1",25,0)
 ;    5.1 requires field identifiers and separators on all fields
"RTN","BPSECA1",26,0)
 ;        other than the header
"RTN","BPSECA1",27,0)
 ;
"RTN","BPSECA1",28,0)
 ;    3.2 there were no segment separators 
"RTN","BPSECA1",29,0)
 ;    5.1 segment separators are required prior to each segment 
"RTN","BPSECA1",30,0)
 ;        following the header
"RTN","BPSECA1",31,0)
 ;
"RTN","BPSECA1",32,0)
 ;    3.2/5.1  Group separators appear at the end of each
"RTN","BPSECA1",33,0)
 ;        transaction (prescription)
"RTN","BPSECA1",34,0)
 ;
"RTN","BPSECA1",35,0)
 ;  The first thing added to this routine is the retrieval of the
"RTN","BPSECA1",36,0)
 ;  version from the claim file.  If the version is 3.2, we will 
"RTN","BPSECA1",37,0)
 ;  process just like we used to.  If it is 5.1, we will alter the
"RTN","BPSECA1",38,0)
 ;  creation of the claim to include the above differences.
"RTN","BPSECA1",39,0)
 ;
"RTN","BPSECA1",40,0)
 ;  Adjustments were also made to the reversal logic as well.
"RTN","BPSECA1",41,0)
 ;
"RTN","BPSECA1",42,0)
 ;
"RTN","BPSECA1",43,0)
 ;
"RTN","BPSECA1",44,0)
ASCII(CLAIMIEN) ;EP - from BPSOSQH from BPSOSQG from BPSOSQ2
"RTN","BPSECA1",45,0)
 N IEN,MBPS,RECORD,BPS,REVERSAL,UERETVAL,CLMV,DET51,RTRNCD
"RTN","BPSECA1",46,0)
 I '$D(^BPSC(CLAIMIEN,0)) D  G QERR  ; check for good parameter
"RTN","BPSECA1",47,0)
 . S UERETVAL=$$IMPOSS^BPSOSUE("DB,P","T",CLAIMIEN,,1,$T(+0))
"RTN","BPSECA1",48,0)
 ;
"RTN","BPSECA1",49,0)
 ;Setup IEN variables (used when executing format code)
"RTN","BPSECA1",50,0)
 S IEN(9002313.02)=CLAIMIEN
"RTN","BPSECA1",51,0)
 ; Point to BPS INSURER
"RTN","BPSECA1",52,0)
 S IEN(9002313.4)=$P($G(^BPSC(IEN(9002313.02),0)),U,2)
"RTN","BPSECA1",53,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ D
"RTN","BPSECA1",54,0)
 .  S IEN(9002313.4)=$S($G(ENTRY):$G(^BPS(9002313.31,ENTRY,4)),1:64)
"RTN","BPSECA1",55,0)
 I 'IEN(9002313.4) D  G QERR ; claim must have an insurer
"RTN","BPSECA1",56,0)
 . S UERETVAL=$$IMPOSS^BPSOSUE("DB,P","T",CLAIMIEN,,2,$T(+0))
"RTN","BPSECA1",57,0)
 ; Point to format
"RTN","BPSECA1",58,0)
 I '$G(VARX) S IEN(9002313.92)=$P($G(^BPSEI(IEN(9002313.4),100)),U,1)  ;VA;7/9/03
"RTN","BPSECA1",59,0)
 E  S IEN(9002313.92)=IEN(9002313.4)  ;VA;7/9/03
"RTN","BPSECA1",60,0)
 I IEN(9002313.02)["^" S (BPS(9002313.02),IEN(9002313.02))=$P(IEN(9002313.02),"^",1)  ;VA
"RTN","BPSECA1",61,0)
 I '$G(VARX) I 'IEN(9002313.92) D  G QERR ; insurer must have an e-format
"RTN","BPSECA1",62,0)
 . S UERETVAL=$$IMPOSS^BPSOSUE("DB","T",CLAIMIEN,,3,$T(+0))
"RTN","BPSECA1",63,0)
 ;
"RTN","BPSECA1",64,0)
 ;
"RTN","BPSECA1",65,0)
 ; But if it's a reversal claim, get the format for the reversal
"RTN","BPSECA1",66,0)
 ; IHS/SD/lwj 08/15/02 NCPDP 5.1 needed to adjust reversal a little
"RTN","BPSECA1",67,0)
 ; RTRNCD added - original IF stmt remarked out - new one added
"RTN","BPSECA1",68,0)
 ; 5.1 transaction code for reversal is now B2 not 11
"RTN","BPSECA1",69,0)
 ;
"RTN","BPSECA1",70,0)
 S RTRNCD=$P(^BPSC(IEN(9002313.02),100),U,3)
"RTN","BPSECA1",71,0)
 I (RTRNCD=11)!(RTRNCD="B2") D
"RTN","BPSECA1",72,0)
 . S REVERSAL=1
"RTN","BPSECA1",73,0)
 . I $G(VARX) S IEN(9002313.92)=$$GET1^DIQ(9002313.59902,"1,"_IEN59_",","902.19","I")  ;VA;10/22/94;get IB sent Reversal sheet.
"RTN","BPSECA1",74,0)
 . E  S IEN(9002313.92)=$P($G(^BPSF(9002313.92,+IEN(9002313.92),"REVERSAL")),U)
"RTN","BPSECA1",75,0)
 . I 'IEN(9002313.92) D
"RTN","BPSECA1",76,0)
 . . S UERETVAL=$$IMPOSS^BPSOSUE("DB","T",CLAIMIEN,,4,$T(+0))
"RTN","BPSECA1",77,0)
 E  S REVERSAL=0
"RTN","BPSECA1",78,0)
 I ((RTRNCD=11)!(RTRNCD="B2")),'IEN(9002313.92) G QERR
"RTN","BPSECA1",79,0)
 ;
"RTN","BPSECA1",80,0)
 I '$D(^BPSF(9002313.92,+IEN(9002313.92),0)) D  G QERR
"RTN","BPSECA1",81,0)
 . S UERETVAL=$$IMPOSS^BPSOSUE("P","T",CLAIMIEN,,5,$T(+0))
"RTN","BPSECA1",82,0)
 ;
"RTN","BPSECA1",83,0)
 ;IHS/SD/lwj 8/1/02
"RTN","BPSECA1",84,0)
 ; retrieve the version number from the claim file so we know which
"RTN","BPSECA1",85,0)
 ; way we have to process
"RTN","BPSECA1",86,0)
 S CLMV=$P($G(^BPSC(IEN(9002313.02),100)),U,2)
"RTN","BPSECA1",87,0)
 ;
"RTN","BPSECA1",88,0)
 ;Retrieve claim submission record (used when executing format code)
"RTN","BPSECA1",89,0)
 D GETBPS2^BPSECX0(IEN(9002313.02),.BPS)
"RTN","BPSECA1",90,0)
 ;
"RTN","BPSECA1",91,0)
 ;Assembler claim header required and optional format sections
"RTN","BPSECA1",92,0)
 S RECORD=""
"RTN","BPSECA1",93,0)
 K VARECORD S VARECORD=""
"RTN","BPSECA1",94,0)
 ;
"RTN","BPSECA1",95,0)
 D:CLMV[3 XLOOP^BPSECA2("10^20",.IEN,.BPS,.RECORD)   ;3.2 clms
"RTN","BPSECA1",96,0)
 D:CLMV[5 XLOOP^BPSOSH2("100^110^120",.IEN,.BPS,.RECORD)   ;5.1 clms
"RTN","BPSECA1",97,0)
 ;VA; had to do this because of HL7 control char constraints
"RTN","BPSECA1",98,0)
 ;
"RTN","BPSECA1",99,0)
 ;IHS/SD/lwj 8/1/02  NCPDP 5.1 create chain of segments
"RTN","BPSECA1",100,0)
 S DET51="130^140^150^160^170^180^190^200^210^220^230"
"RTN","BPSECA1",101,0)
 ;
"RTN","BPSECA1",102,0)
 ;Loop through prescription multiple
"RTN","BPSECA1",103,0)
 S IEN(9002313.01)=0
"RTN","BPSECA1",104,0)
 F  D  Q:'IEN(9002313.01)
"RTN","BPSECA1",105,0)
 .S IEN(9002313.01)=$O(^BPSC(IEN(9002313.02),400,IEN(9002313.01)))
"RTN","BPSECA1",106,0)
 .Q:'IEN(9002313.01)
"RTN","BPSECA1",107,0)
 .;
"RTN","BPSECA1",108,0)
 .;Retrieve prescription information (used when executing format code)
"RTN","BPSECA1",109,0)
 .K BPS(9002313.0201)
"RTN","BPSECA1",110,0)
 .D GETBPS3^BPSECX0(IEN(9002313.02),IEN(9002313.01),.BPS)
"RTN","BPSECA1",111,0)
 .;
"RTN","BPSECA1",112,0)
 .;IHS/SD/lwj 8/22/02 NCPDP 5.1 handle at least the DUR repeating flds
"RTN","BPSECA1",113,0)
 .D DURVALUE
"RTN","BPSECA1",114,0)
 .;
"RTN","BPSECA1",115,0)
 .;
"RTN","BPSECA1",116,0)
 .;Append group separator character (but not in a reversal format)
"RTN","BPSECA1",117,0)
 . I 'REVERSAL S RECORD=RECORD_$C(29)
"RTN","BPSECA1",118,0)
 .;IHS/SD/lwj 08/15/02 NCPDP 5.1 - requires GS on reversal
"RTN","BPSECA1",119,0)
 . I (REVERSAL)&(CLMV[5) S RECORD=RECORD_$C(29)
"RTN","BPSECA1",120,0)
 .;
"RTN","BPSECA1",121,0)
 .;Assemble claim information required and optional sections
"RTN","BPSECA1",122,0)
 .;IHS/SD/lwj 8/1/02 nxt ln rmkd out - following 2 lines added
"RTN","BPSECA1",123,0)
 .D:CLMV[3 XLOOP^BPSECA2("30^40",.IEN,.BPS,.RECORD)
"RTN","BPSECA1",124,0)
 .D:CLMV[5 XLOOP^BPSOSH2(DET51,.IEN,.BPS,.RECORD)
"RTN","BPSECA1",125,0)
 ;
"RTN","BPSECA1",126,0)
 I VARX D VASTORE
"RTN","BPSECA1",127,0)
 Q RECORD
"RTN","BPSECA1",128,0)
 ;
"RTN","BPSECA1",129,0)
VASTORE ;; Need to store by segment for VA due to HL7 constraints.  Had to changed field, group, and segment separators to control
"RTN","BPSECA1",130,0)
 ;               ;  characters for Vitria/AAC processing as well as shortening the length of the xmit.
"RTN","BPSECA1",131,0)
 N NNODES,INDEX,ONE,TWO,OREC
"RTN","BPSECA1",132,0)
 S NNODES=0,INDEX=1 F  S NNODES=$O(RECORD(NNODES)) Q:NNODES=""  D
"RTN","BPSECA1",133,0)
 . I RECORD(NNODES)[$C(29)
"RTN","BPSECA1",134,0)
 . I RECORD(NNODES)[$C(30) S (ONE,TWO)="",ONE=$P(RECORD(NNODES),($C(30)_$C(28)),1),TWO=$P(RECORD(NNODES),($C(30)_$C(28)),2) D
"RTN","BPSECA1",135,0)
 . . S RECORD(OREC)=RECORD(OREC)_ONE_$C(30)_$C(28),RECORD(NNODES)=TWO
"RTN","BPSECA1",136,0)
 . S OREC=NNODES
"RTN","BPSECA1",137,0)
 ; 
"RTN","BPSECA1",138,0)
 S NNODES=""
"RTN","BPSECA1",139,0)
 S INDEX=1 F  S NNODES=$O(RECORD(NNODES)) Q:NNODES=""  D
"RTN","BPSECA1",140,0)
 . S ^BPSECX($J,"C",CLAIMIEN,INDEX)=RECORD(NNODES)
"RTN","BPSECA1",141,0)
 . S WP(INDEX/100+1,0)=RECORD(NNODES)
"RTN","BPSECA1",142,0)
 . S INDEX=INDEX+1
"RTN","BPSECA1",143,0)
 D WP^DIE(9002313.02,CLAIMIEN_",",9999,"","WP")
"RTN","BPSECA1",144,0)
 S ^BPSECX($J,"C",CLAIMIEN,0)=INDEX-1
"RTN","BPSECA1",145,0)
 S RECORD=1
"RTN","BPSECA1",146,0)
 Q
"RTN","BPSECA1",147,0)
 ;
"RTN","BPSECA1",148,0)
QERR Q
"RTN","BPSECA1",149,0)
 ;
"RTN","BPSECA1",150,0)
DURVALUE ;NCPDP 5.1 - this subroutine will loop through the DUR/PPS repeating
"RTN","BPSECA1",151,0)
 ; fields and load their values into the BPS array for the claim
"RTN","BPSECA1",152,0)
 ; generation process
"RTN","BPSECA1",153,0)
 ;
"RTN","BPSECA1",154,0)
 N DURCNT,DUR
"RTN","BPSECA1",155,0)
 ;
"RTN","BPSECA1",156,0)
 K BPS(9002313.1001)
"RTN","BPSECA1",157,0)
 ;
"RTN","BPSECA1",158,0)
 ;we depend on the "count" since we set it when we created the clm entry
"RTN","BPSECA1",159,0)
 S DURCNT=$P($G(^BPSC(IEN(9002313.02),400,IEN(9002313.01),473.01,0)),U,4)
"RTN","BPSECA1",160,0)
 F DUR=1:1:DURCNT  D
"RTN","BPSECA1",161,0)
 . D GETBPS4^BPSECX0(IEN(9002313.02),IEN(9002313.01),DUR,.BPS)
"RTN","BPSECA1",162,0)
 ;
"RTN","BPSECA1",163,0)
 Q
"RTN","BPSECA2")
0^2^B2797712
"RTN","BPSECA2",1,0)
BPSECA2 ;BHAM ISC/FCS/DRS/VA/DLF - Assemble formatted claim ;05/14/2004
"RTN","BPSECA2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECA2",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA2",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA2",5,0)
 ;Put together ascii formatted record via NCPDP Record definition
"RTN","BPSECA2",6,0)
 ;
"RTN","BPSECA2",7,0)
 ;Input Variables:  NODES     - (10^20 or 30^40)
"RTN","BPSECA2",8,0)
 ;                  .IEN      - Internal Entry Number array
"RTN","BPSECA2",9,0)
 ;                  .BPS     - Formatted Data Array with claim and
"RTN","BPSECA2",10,0)
 ;                              prescription data
"RTN","BPSECA2",11,0)
 ;                  .REC      - Formatted Ascii record (result)
"RTN","BPSECA2",12,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA2",13,0)
XLOOP(NODES,IEN,BPS,REC) ;EP - from BPSECA1
"RTN","BPSECA2",14,0)
 ;Manage local variables
"RTN","BPSECA2",15,0)
 N ORDER,RECMIEN,MDATA,FLDIEN,PMODE,FLAG,NODE,FDATA,FLDNUM,FLDDATA
"RTN","BPSECA2",16,0)
 N INDEX,FLDID
"RTN","BPSECA2",17,0)
 ;
"RTN","BPSECA2",18,0)
 ;Loop through the NODES defined in NODES variable parsed by U
"RTN","BPSECA2",19,0)
 F INDEX=1:1:$L(NODES,U) D
"RTN","BPSECA2",20,0)
 .S NODE=$P(NODES,U,INDEX)
"RTN","BPSECA2",21,0)
 .Q:NODE=""
"RTN","BPSECA2",22,0)
 .Q:'$D(^BPSF(9002313.92,+IEN(9002313.92),NODE,0))
"RTN","BPSECA2",23,0)
 .;
"RTN","BPSECA2",24,0)
 .S ORDER=""
"RTN","BPSECA2",25,0)
 .F  D  Q:'ORDER
"RTN","BPSECA2",26,0)
 ..S ORDER=$O(^BPSF(9002313.92,+IEN(9002313.92),NODE,"B",ORDER))
"RTN","BPSECA2",27,0)
 ..Q:'ORDER
"RTN","BPSECA2",28,0)
 ..S RECMIEN=""
"RTN","BPSECA2",29,0)
 ..S RECMIEN=$O(^BPSF(9002313.92,+IEN(9002313.92),NODE,"B",ORDER,RECMIEN))
"RTN","BPSECA2",30,0)
 ..Q:RECMIEN=""
"RTN","BPSECA2",31,0)
 ..S MDATA=$G(^BPSF(9002313.92,+IEN(9002313.92),NODE,RECMIEN,0))
"RTN","BPSECA2",32,0)
 ..Q:MDATA=""
"RTN","BPSECA2",33,0)
 ..S FLDIEN=$P(MDATA,U,2)
"RTN","BPSECA2",34,0)
 ..Q:FLDIEN=""
"RTN","BPSECA2",35,0)
 ..S FDATA=$G(^BPSF(9002313.91,FLDIEN,0))
"RTN","BPSECA2",36,0)
 ..Q:FDATA=""
"RTN","BPSECA2",37,0)
 ..S FLDNUM=$P(FDATA,U,1)
"RTN","BPSECA2",38,0)
 ..S FLDID=$P(FDATA,U,2)
"RTN","BPSECA2",39,0)
 ..Q:FLDNUM=""
"RTN","BPSECA2",40,0)
 ..S:NODE=10!(NODE=20) FLDDATA=$G(BPS(9002313.02,IEN(9002313.02),FLDNUM,"I"))
"RTN","BPSECA2",41,0)
 ..S:NODE=30!(NODE=40) FLDDATA=$G(BPS(9002313.0201,IEN(9002313.01),FLDNUM,"I"))
"RTN","BPSECA2",42,0)
 ..S REC=REC_$S(FLDID="":"",1:$C(28))_FLDDATA
"RTN","BPSECA2",43,0)
 Q
"RTN","BPSECA4")
0^3^B43655666
"RTN","BPSECA4",1,0)
BPSECA4 ;BHAM ISC/FCS/DRS/VA/DLF - Parse Claim Response ;05/14/2004
"RTN","BPSECA4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECA4",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA4",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA4",5,0)
 ;Parse ASCII Response Claim Record and Sup FDATA() Array
"RTN","BPSECA4",6,0)
 ;
"RTN","BPSECA4",7,0)
 ;Parameters:  RREC     - Ascii Response Record
"RTN","BPSECA4",8,0)
 ;             RESPIEN  - Claim Response IEN (90023130.03)
"RTN","BPSECA4",9,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA4",10,0)
 ; Calls BPSECA5
"RTN","BPSECA4",11,0)
 ;
"RTN","BPSECA4",12,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA4",13,0)
 ; IHS/SD/lwj  8/6/02  NCPDP 5.1 changes
"RTN","BPSECA4",14,0)
 ;  NCPDP 5.1 response segments are completely different than the
"RTN","BPSECA4",15,0)
 ;  3.2 response.  Of significant importance are:
"RTN","BPSECA4",16,0)
 ;   In 3.2, there were 4 basic response segments (header required,
"RTN","BPSECA4",17,0)
 ;     header option, information required, information optional.) 
"RTN","BPSECA4",18,0)
 ;   In 5.1, there are 8 possible segments (header, message, insurance,
"RTN","BPSECA4",19,0)
 ;     status, claim, pricing, DUR/PPS, and prior authorization)
"RTN","BPSECA4",20,0)
 ;
"RTN","BPSECA4",21,0)
 ;   In 5.1, for all segments following the header, a segment separator
"RTN","BPSECA4",22,0)
 ;     is used.
"RTN","BPSECA4",23,0)
 ;
"RTN","BPSECA4",24,0)
 ;   In 5.1, field separators, and field identifiers are used for all
"RTN","BPSECA4",25,0)
 ;     fields not appearing on the header segment.
"RTN","BPSECA4",26,0)
 ;
"RTN","BPSECA4",27,0)
 ; To adjust to these changes, this routine has been modified.  The
"RTN","BPSECA4",28,0)
 ; first thing we will try to establish is which version of response
"RTN","BPSECA4",29,0)
 ; we are working with.  A new subroutine was created to hold the
"RTN","BPSECA4",30,0)
 ; 3.2 basic parsing of claim information, and a new routine 
"RTN","BPSECA4",31,0)
 ; (BPSOSH4) was created to perform the parsing of a 5.1 claim.
"RTN","BPSECA4",32,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA4",33,0)
PARSE(RREC,RESPIEN) ;EP - from BPSOSQL from BPSOSQ4
"RTN","BPSECA4",34,0)
 N GS,FS,RHEADER,RHEADERR,RHEADERO,MEDN,RDATA,RDATAR,RDATAO
"RTN","BPSECA4",35,0)
 N INDEX,FDATA,ID,XDATA,RINFO
"RTN","BPSECA4",36,0)
 ;
"RTN","BPSECA4",37,0)
 ;Make sure input variables are defined
"RTN","BPSECA4",38,0)
 Q:$G(RREC)=""
"RTN","BPSECA4",39,0)
 Q:$G(RESPIEN)=""
"RTN","BPSECA4",40,0)
 Q:'$D(^BPSR(RESPIEN,0))
"RTN","BPSECA4",41,0)
 ;
"RTN","BPSECA4",42,0)
 ;group and field separator characters
"RTN","BPSECA4",43,0)
 S GS=$C(29),FS=$C(28)
"RTN","BPSECA4",44,0)
 ;
"RTN","BPSECA4",45,0)
 ; Special handling for what appears to be a corrupt response
"RTN","BPSECA4",46,0)
 ; from First Health for Alaska Medicaid.  It's missing a GS.
"RTN","BPSECA4",47,0)
 I RREC'[GS D AKMEDFIX
"RTN","BPSECA4",48,0)
 ;
"RTN","BPSECA4",49,0)
 ;Parse response header section from ascii record
"RTN","BPSECA4",50,0)
 S RHEADER=$P(RREC,GS,1)
"RTN","BPSECA4",51,0)
 S RHEADERR=$P(RHEADER,FS,1)
"RTN","BPSECA4",52,0)
 ;
"RTN","BPSECA4",53,0)
 ;IHS/SD/lwj 8/6/02  NCPDP 5.1 changes  - begin changes
"RTN","BPSECA4",54,0)
 ; Need to split out the parsing of 3.2 and 5.1 claims - we will
"RTN","BPSECA4",55,0)
 ; check the version, and if it is 3.2, we will call the PARSE32
"RTN","BPSECA4",56,0)
 ; subroutine - if it's 5.1, we will call the BPSOSH4 routine.
"RTN","BPSECA4",57,0)
 ;
"RTN","BPSECA4",58,0)
 S FDATA(102)=$E(RHEADERR,1,2)
"RTN","BPSECA4",59,0)
 I FDATA(102)[3 D PARSE32
"RTN","BPSECA4",60,0)
 I FDATA(102)[5 D PARSE51^BPSOSH4(RREC,RESPIEN)
"RTN","BPSECA4",61,0)
 ;
"RTN","BPSECA4",62,0)
 ;IHS/SD/lwj 8/6/02 NCPDP 5.1 end changes other than subroutine
"RTN","BPSECA4",63,0)
 ; PARSE32 tag
"RTN","BPSECA4",64,0)
 ;
"RTN","BPSECA4",65,0)
 Q
"RTN","BPSECA4",66,0)
 ;
"RTN","BPSECA4",67,0)
 ;
"RTN","BPSECA4",68,0)
PARSE32 ;IHS/SD/lwj 8/6/02  NCPDP 5.1 forced the splitting of the parsing - 
"RTN","BPSECA4",69,0)
 ; this subroutine is the original code that will parse 3.2 still
"RTN","BPSECA4",70,0)
 ;
"RTN","BPSECA4",71,0)
 S RHEADERO=$P(RHEADER,FS,2)
"RTN","BPSECA4",72,0)
 ;
"RTN","BPSECA4",73,0)
 ;Parse required response header fields
"RTN","BPSECA4",74,0)
 S FDATA(102)=$E(RHEADERR,1,2)
"RTN","BPSECA4",75,0)
 S FDATA(103)=$E(RHEADERR,3,4)
"RTN","BPSECA4",76,0)
 S FDATA(501)=$E(RHEADERR,5,5)
"RTN","BPSECA4",77,0)
 ;
"RTN","BPSECA4",78,0)
 ; Reversal response: doesn't have the GS, though it does have
"RTN","BPSECA4",79,0)
 ; some prescription-multiple-type fields.  Fake it out.
"RTN","BPSECA4",80,0)
 ; Right now, this works only for PCS REVERSAL format.
"RTN","BPSECA4",81,0)
 ; May learn more as other reversals come along.
"RTN","BPSECA4",82,0)
 I FDATA(103)=11 D PCSREV G AROUND
"RTN","BPSECA4",83,0)
 ;
"RTN","BPSECA4",84,0)
 ;Parse optional response header fields
"RTN","BPSECA4",85,0)
 S FDATA(524)=RHEADERO
"RTN","BPSECA4",86,0)
 ;
"RTN","BPSECA4",87,0)
 ;Parse response information section from ascii record
"RTN","BPSECA4",88,0)
 S RINFO=$P(RREC,GS,2,999)
"RTN","BPSECA4",89,0)
 ;
"RTN","BPSECA4",90,0)
 ;Parse response information sections for each medication
"RTN","BPSECA4",91,0)
 F MEDN=1:1:$L(RINFO,GS) D
"RTN","BPSECA4",92,0)
 .S RDATA=$P(RINFO,GS,MEDN)
"RTN","BPSECA4",93,0)
 .S RDATAR=$P(RDATA,FS,1)
"RTN","BPSECA4",94,0)
 .S RDATAO=$P(RDATA,FS,2,999)
"RTN","BPSECA4",95,0)
 .;
"RTN","BPSECA4",96,0)
 .;Parse required response information section
"RTN","BPSECA4",97,0)
 .S FDATA("M",MEDN,501)=$E(RDATAR,1,1)
"RTN","BPSECA4",98,0)
 .;
"RTN","BPSECA4",99,0)
 .;Duplicate claim response information fields
"RTN","BPSECA4",100,0)
 .I FDATA("M",MEDN,501)="D" D
"RTN","BPSECA4",101,0)
 ..S FDATA("M",MEDN,1000)=$E(RDATAR,2,85)
"RTN","BPSECA4",102,0)
 ..; Was it a duplicate Paid or Captured claim?
"RTN","BPSECA4",103,0)
 ..N X S X=$S($$PAID^BPSECA7($E(RDATAR,2,85)):"P",1:"C")
"RTN","BPSECA4",104,0)
 ..S FDATA("M",MEDN,501)="D"_X
"RTN","BPSECA4",105,0)
 .;
"RTN","BPSECA4",106,0)
 .;Payable claim response information fields
"RTN","BPSECA4",107,0)
 .I FDATA("M",MEDN,501)="P"!(FDATA("M",MEDN,501)="DP") D
"RTN","BPSECA4",108,0)
 ..S FDATA("M",MEDN,505)=$E(RDATAR,2,7)
"RTN","BPSECA4",109,0)
 ..S FDATA("M",MEDN,506)=$E(RDATAR,8,13)
"RTN","BPSECA4",110,0)
 ..S FDATA("M",MEDN,507)=$E(RDATAR,14,19)
"RTN","BPSECA4",111,0)
 ..S FDATA("M",MEDN,508)=$E(RDATAR,20,25)
"RTN","BPSECA4",112,0)
 ..S FDATA("M",MEDN,509)=$E(RDATAR,26,31)
"RTN","BPSECA4",113,0)
 ..S FDATA("M",MEDN,503)=$E(RDATAR,32,45)
"RTN","BPSECA4",114,0)
 ..S FDATA("M",MEDN,504)=$E(RDATAR,46,85)
"RTN","BPSECA4",115,0)
 .;
"RTN","BPSECA4",116,0)
 .;Captured claim response information fields
"RTN","BPSECA4",117,0)
 .I FDATA("M",MEDN,501)="C"!(FDATA("M",MEDN,501)="DC") D
"RTN","BPSECA4",118,0)
 ..S FDATA("M",MEDN,503)=$E(RDATAR,2,15)
"RTN","BPSECA4",119,0)
 ..S FDATA("M",MEDN,504)=$E(RDATAR,16,85)
"RTN","BPSECA4",120,0)
 .;
"RTN","BPSECA4",121,0)
 .;Rejected claim response information fields
"RTN","BPSECA4",122,0)
 .I FDATA("M",MEDN,501)="R" D
"RTN","BPSECA4",123,0)
 ..S FDATA("M",MEDN,510)=$E(RDATAR,2,3)
"RTN","BPSECA4",124,0)
 ..S FDATA("M",MEDN,511,1)=$E(RDATAR,4,5)
"RTN","BPSECA4",125,0)
 ..S FDATA("M",MEDN,511,2)=$E(RDATAR,6,7)
"RTN","BPSECA4",126,0)
 ..S FDATA("M",MEDN,511,3)=$E(RDATAR,8,9)
"RTN","BPSECA4",127,0)
 ..S FDATA("M",MEDN,511,4)=$E(RDATAR,10,11)
"RTN","BPSECA4",128,0)
 ..S FDATA("M",MEDN,511,5)=$E(RDATAR,12,13)
"RTN","BPSECA4",129,0)
 ..S FDATA("M",MEDN,511,6)=$E(RDATAR,14,15)
"RTN","BPSECA4",130,0)
 ..S FDATA("M",MEDN,511,7)=$E(RDATAR,16,17)
"RTN","BPSECA4",131,0)
 ..S FDATA("M",MEDN,511,8)=$E(RDATAR,18,19)
"RTN","BPSECA4",132,0)
 ..S FDATA("M",MEDN,511,9)=$E(RDATAR,20,21)
"RTN","BPSECA4",133,0)
 ..S FDATA("M",MEDN,511,10)=$E(RDATAR,22,23)
"RTN","BPSECA4",134,0)
 ..S FDATA("M",MEDN,511,11)=$E(RDATAR,24,25)
"RTN","BPSECA4",135,0)
 ..S FDATA("M",MEDN,511,12)=$E(RDATAR,26,27)
"RTN","BPSECA4",136,0)
 ..S FDATA("M",MEDN,511,13)=$E(RDATAR,28,29)
"RTN","BPSECA4",137,0)
 ..S FDATA("M",MEDN,511,14)=$E(RDATAR,30,31)
"RTN","BPSECA4",138,0)
 ..S FDATA("M",MEDN,511,15)=$E(RDATAR,32,33)
"RTN","BPSECA4",139,0)
 ..S FDATA("M",MEDN,511,16)=$E(RDATAR,34,35)
"RTN","BPSECA4",140,0)
 ..S FDATA("M",MEDN,511,17)=$E(RDATAR,36,37)
"RTN","BPSECA4",141,0)
 ..S FDATA("M",MEDN,511,18)=$E(RDATAR,38,39)
"RTN","BPSECA4",142,0)
 ..S FDATA("M",MEDN,511,19)=$E(RDATAR,40,41)
"RTN","BPSECA4",143,0)
 ..S FDATA("M",MEDN,511,20)=$E(RDATAR,42,43)
"RTN","BPSECA4",144,0)
 ..S FDATA("M",MEDN,504)=$E(RDATAR,44,85)
"RTN","BPSECA4",145,0)
 .;
"RTN","BPSECA4",146,0)
 .;Parse optional response information section
"RTN","BPSECA4",147,0)
 .D OPTR(MEDN,RDATAO)
"RTN","BPSECA4",148,0)
 ;
"RTN","BPSECA4",149,0)
AROUND ;
"RTN","BPSECA4",150,0)
 ;File FDATA() in Claim Response File (9002313.03)
"RTN","BPSECA4",151,0)
 D FILE^BPSECA5(RESPIEN)
"RTN","BPSECA4",152,0)
 Q
"RTN","BPSECA4",153,0)
PCSREV ; split off of PCS REVERSAL processing - RHEADER has everything
"RTN","BPSECA4",154,0)
 ; Make it look like a prescription multiple
"RTN","BPSECA4",155,0)
 ; It has no GS or FS stuff, so everything is in RHEADERR
"RTN","BPSECA4",156,0)
 N X S X=RHEADERR
"RTN","BPSECA4",157,0)
 I FDATA(501)="A" D  ; accepted reversal
"RTN","BPSECA4",158,0)
 .S FDATA("M",1,503)=$E(X,6,19)
"RTN","BPSECA4",159,0)
 .S FDATA("M",1,504)=$E(X,20,$L(X))
"RTN","BPSECA4",160,0)
 E  I FDATA(501)="R" D  ; rejected reversal
"RTN","BPSECA4",161,0)
 .S FDATA("M",1,510)=$E(X,6,7)
"RTN","BPSECA4",162,0)
 .N I F I=8:2:26 D
"RTN","BPSECA4",163,0)
 ..S FDATA("M",1,511,I-8/2+1)=$E(X,I,I+1)
"RTN","BPSECA4",164,0)
 .S FDATA("M",1,504)=$E(X,28,100)
"RTN","BPSECA4",165,0)
 E  D  ; corrupt
"RTN","BPSECA4",166,0)
 .S FDATA("M",1,504)=X
"RTN","BPSECA4",167,0)
 S MEDN=1
"RTN","BPSECA4",168,0)
 Q
"RTN","BPSECA4",169,0)
 ;---------------------------------------------------------------------
"RTN","BPSECA4",170,0)
 ;Process Optional Response Information Section
"RTN","BPSECA4",171,0)
 ;
"RTN","BPSECA4",172,0)
 ;Parameters:  MEDN    - Current medication sequence #
"RTN","BPSECA4",173,0)
 ;             RDATAO  - Optional response information section
"RTN","BPSECA4",174,0)
 ;---------------------------------------------------------------------
"RTN","BPSECA4",175,0)
OPTR(MEDN,RDATAO) ;
"RTN","BPSECA4",176,0)
 ;Manage local variables
"RTN","BPSECA4",177,0)
 N INDEX,ID,XDATA
"RTN","BPSECA4",178,0)
 ;
"RTN","BPSECA4",179,0)
 ;Make sure input variables are defined
"RTN","BPSECA4",180,0)
 Q:$G(MEDN)=""
"RTN","BPSECA4",181,0)
 Q:$G(RDATAO)=""
"RTN","BPSECA4",182,0)
 ;
"RTN","BPSECA4",183,0)
 F INDEX=1:1:$L(RDATAO,FS) D
"RTN","BPSECA4",184,0)
 .S FDATA=$P(RDATAO,FS,INDEX)
"RTN","BPSECA4",185,0)
 .Q:FDATA=""
"RTN","BPSECA4",186,0)
 .;
"RTN","BPSECA4",187,0)
 .S ID=$E(FDATA,1,2)
"RTN","BPSECA4",188,0)
 .S XDATA=$E(FDATA,3,$L(FDATA))
"RTN","BPSECA4",189,0)
 .I ID="F9" S FDATA("M",MEDN,509)=XDATA Q  ; PCS 1997 Packet Emulator Test #2 sends Patient Pay Amount here - mistakenly?  Let's record it anyhow.
"RTN","BPSECA4",190,0)
 .I ID="FC" S FDATA("M",MEDN,512)=XDATA Q
"RTN","BPSECA4",191,0)
 .I ID="FD" S FDATA("M",MEDN,513)=XDATA Q
"RTN","BPSECA4",192,0)
 .I ID="FE" S FDATA("M",MEDN,514)=XDATA Q
"RTN","BPSECA4",193,0)
 .I ID="FH" S FDATA("M",MEDN,517)=XDATA Q
"RTN","BPSECA4",194,0)
 .I ID="FI" S FDATA("M",MEDN,518)=XDATA Q
"RTN","BPSECA4",195,0)
 .I ID="FJ" S FDATA("M",MEDN,519)=XDATA Q
"RTN","BPSECA4",196,0)
 .I ID="FK" S FDATA("M",MEDN,520)=XDATA Q
"RTN","BPSECA4",197,0)
 .I ID="FL" S FDATA("M",MEDN,521)=XDATA Q
"RTN","BPSECA4",198,0)
 .I ID="FM" S FDATA("M",MEDN,522)=XDATA Q
"RTN","BPSECA4",199,0)
 .I ID="FN" S FDATA("M",MEDN,523)=XDATA Q
"RTN","BPSECA4",200,0)
 .I ID="FP" D  Q
"RTN","BPSECA4",201,0)
 . . I XDATA?159" "1N Q  ; no DUR data, just the overflow flag
"RTN","BPSECA4",202,0)
 . . S FDATA("M",MEDN,525)=XDATA
"RTN","BPSECA4",203,0)
 .I ID="FQ" S FDATA("M",MEDN,526)=XDATA Q
"RTN","BPSECA4",204,0)
 Q
"RTN","BPSECA4",205,0)
AKMEDFIX ; as noted, above ; Alaska Medicaid while sleeping - you get
"RTN","BPSECA4",206,0)
 ; this corrupt message.  May be true of other insurers, too. 
"RTN","BPSECA4",207,0)
 ; This looks like it might be an NDC message.
"RTN","BPSECA4",208,0)
 ; We'll find out as time goes on.
"RTN","BPSECA4",209,0)
 ; Here - we make sure that it's one of those packets,
"RTN","BPSECA4",210,0)
 ; and we insert GS characters so that it parses correctly.
"RTN","BPSECA4",211,0)
 I $E(RREC,7,21)'="FO        R0199" Q
"RTN","BPSECA4",212,0)
 I $E(RREC,1,5)'?1"3C0"1N1"A" Q
"RTN","BPSECA4",213,0)
 I $E(RREC,6)'=FS Q
"RTN","BPSECA4",214,0)
 I $E(RREC,22,59)'?." " Q
"RTN","BPSECA4",215,0)
 I $E(RREC,60,99)'="PRT010   CARRIER DISABLED      -B1ON99CR" Q
"RTN","BPSECA4",216,0)
 N NPIECES S NPIECES=$L(RREC,"R0199") ; = header + 1 for each claim
"RTN","BPSECA4",217,0)
 I NPIECES-1'=$E(RREC,4) Q
"RTN","BPSECA4",218,0)
 ; Length requirement:  don't be so strict if it's only one piece
"RTN","BPSECA4",219,0)
 ; We have seen this packet be 439 bytes on day, but 421 the next
"RTN","BPSECA4",220,0)
 ; (See ANMC devel. system 9002313.03, `249; 11/04/2000 - 421 bytes.
"RTN","BPSECA4",221,0)
 ; Compare  with `247 from 11/03/2000 - 439 bytes)
"RTN","BPSECA4",222,0)
 I NPIECES>1,NPIECES-1*423+16'=$L(RREC) Q
"RTN","BPSECA4",223,0)
 ; Okay, we're pretty sure this is it!  Insert the GS characters.
"RTN","BPSECA4",224,0)
 N X S X=$E(RREC,1,16)
"RTN","BPSECA4",225,0)
 N I F I=17:423:$L(RREC) S X=X_GS_$E(RREC,I,I+423-1)
"RTN","BPSECA4",226,0)
 S RREC=X
"RTN","BPSECA4",227,0)
 Q
"RTN","BPSECA5")
0^4^B15883904
"RTN","BPSECA5",1,0)
BPSECA5 ;BHAM ISC/FCS/DRS/VA/DLF - Parse Claim Response ;05/14/2004
"RTN","BPSECA5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECA5",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA5",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA5",5,0)
 ;File FDATA() Array Data in Claim Response File (9002313.03)
"RTN","BPSECA5",6,0)
 ;
"RTN","BPSECA5",7,0)
 ;Parameters:  RESPIEN  - Claim Response Record IEN (9002313.03)
"RTN","BPSECA5",8,0)
 ;---------------------------------------------------------------------
"RTN","BPSECA5",9,0)
 ; Called from BPSECA4 from BPSOSQL from BPSOSQ4
"RTN","BPSECA5",10,0)
 ;
"RTN","BPSECA5",11,0)
 ; IHS/DSD/lwj  9/26/01 added one more quit condition to response
"RTN","BPSECA5",12,0)
 ; section.  For some odd reason BC/BS if Alabama sent across
"RTN","BPSECA5",13,0)
 ; response code with nulls in them - this caused error at the 
"RTN","BPSECA5",14,0)
 ; Poarch Creek site.  No other sites reported the problem, but
"RTN","BPSECA5",15,0)
 ; the change was made and included in Patch 1 as a safe guard.
"RTN","BPSECA5",16,0)
 ;
"RTN","BPSECA5",17,0)
 ;
"RTN","BPSECA5",18,0)
FILE(RESPIEN) ;EP - from BPSECA4
"RTN","BPSECA5",19,0)
 I 'RESPIEN Q:$$IMPOSS^BPSOSUE("P",,,,,$T(+0))
"RTN","BPSECA5",20,0)
 N MEDN,COUNT,INDEX,RJTN,RJTCOUNT,RJTCODE,NEXT,CLAIMIEN
"RTN","BPSECA5",21,0)
 ;
"RTN","BPSECA5",22,0)
 ;Clean up FDATA() array
"RTN","BPSECA5",23,0)
 S NEXT=0
"RTN","BPSECA5",24,0)
 F  D  Q:'NEXT
"RTN","BPSECA5",25,0)
 .S NEXT=$O(FDATA(NEXT)) Q:'NEXT
"RTN","BPSECA5",26,0)
 .S FDATA(NEXT)=$$CLIP^BPSOSU9($G(FDATA(NEXT)))
"RTN","BPSECA5",27,0)
 S MEDN=""
"RTN","BPSECA5",28,0)
 F  D  Q:MEDN=""
"RTN","BPSECA5",29,0)
 .S MEDN=$O(FDATA("M",MEDN))
"RTN","BPSECA5",30,0)
 .Q:MEDN=""
"RTN","BPSECA5",31,0)
 .S NEXT=0
"RTN","BPSECA5",32,0)
 .F  D  Q:'+NEXT
"RTN","BPSECA5",33,0)
 ..S NEXT=$O(FDATA("M",MEDN,NEXT))
"RTN","BPSECA5",34,0)
 ..Q:'+NEXT
"RTN","BPSECA5",35,0)
 ..S FDATA("M",MEDN,NEXT)=$$CLIP^BPSOSU9($G(FDATA("M",MEDN,NEXT)))
"RTN","BPSECA5",36,0)
 ;
"RTN","BPSECA5",37,0)
 S ^BPSR(RESPIEN,100)=U_$G(FDATA(102))_U_$G(FDATA(103))
"RTN","BPSECA5",38,0)
 S $P(^BPSR(RESPIEN,500),U,1)=$G(FDATA(501))
"RTN","BPSECA5",39,0)
 S $P(^BPSR(RESPIEN,500),U,24)=$G(FDATA(524))
"RTN","BPSECA5",40,0)
 ;
"RTN","BPSECA5",41,0)
 S CLAIMIEN=$P($G(^BPSR(RESPIEN,0)),U,1)
"RTN","BPSECA5",42,0)
 S INDEX=$S(CLAIMIEN="":0,1:$O(^BPSC(CLAIMIEN,400,0))-1)
"RTN","BPSECA5",43,0)
 S:INDEX<0 INDEX=0
"RTN","BPSECA5",44,0)
 S COUNT=0
"RTN","BPSECA5",45,0)
 S MEDN=""
"RTN","BPSECA5",46,0)
 F  D  Q:MEDN=""
"RTN","BPSECA5",47,0)
 .S MEDN=$O(FDATA("M",MEDN))
"RTN","BPSECA5",48,0)
 .Q:MEDN=""
"RTN","BPSECA5",49,0)
 .;
"RTN","BPSECA5",50,0)
 .S COUNT=COUNT+1
"RTN","BPSECA5",51,0)
 .S INDEX=INDEX+1
"RTN","BPSECA5",52,0)
 .;
"RTN","BPSECA5",53,0)
 .S ^BPSR(RESPIEN,1000,INDEX,0)=INDEX
"RTN","BPSECA5",54,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,1)=$G(FDATA("M",MEDN,501))
"RTN","BPSECA5",55,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,3)=$G(FDATA("M",MEDN,503))
"RTN","BPSECA5",56,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,5)=$G(FDATA("M",MEDN,505))
"RTN","BPSECA5",57,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,6)=$G(FDATA("M",MEDN,506))
"RTN","BPSECA5",58,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,7)=$G(FDATA("M",MEDN,507))
"RTN","BPSECA5",59,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,8)=$G(FDATA("M",MEDN,508))
"RTN","BPSECA5",60,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,9)=$G(FDATA("M",MEDN,509))
"RTN","BPSECA5",61,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,10)=$G(FDATA("M",MEDN,510))
"RTN","BPSECA5",62,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,12)=$G(FDATA("M",MEDN,512))
"RTN","BPSECA5",63,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,13)=$G(FDATA("M",MEDN,513))
"RTN","BPSECA5",64,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,14)=$G(FDATA("M",MEDN,514))
"RTN","BPSECA5",65,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,17)=$G(FDATA("M",MEDN,517))
"RTN","BPSECA5",66,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,18)=$G(FDATA("M",MEDN,518))
"RTN","BPSECA5",67,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,19)=$G(FDATA("M",MEDN,519))
"RTN","BPSECA5",68,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,20)=$G(FDATA("M",MEDN,520))
"RTN","BPSECA5",69,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,21)=$G(FDATA("M",MEDN,521))
"RTN","BPSECA5",70,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,22)=$G(FDATA("M",MEDN,522))
"RTN","BPSECA5",71,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,500),U,23)=$G(FDATA("M",MEDN,523))
"RTN","BPSECA5",72,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,504),U,1)=$G(FDATA("M",MEDN,504))
"RTN","BPSECA5",73,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,525),U,1)=$G(FDATA("M",MEDN,525))
"RTN","BPSECA5",74,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,526),U,1)=$G(FDATA("M",MEDN,526))
"RTN","BPSECA5",75,0)
 .S $P(^BPSR(RESPIEN,1000,INDEX,1000),U,1)=$G(FDATA("M",MEDN,1000))
"RTN","BPSECA5",76,0)
 .;
"RTN","BPSECA5",77,0)
 .;S "AC" cross-reference
"RTN","BPSECA5",78,0)
 .D:'($G(FDATA("M",MEDN,501))="")
"RTN","BPSECA5",79,0)
 ..S ^BPSR("AC",$G(FDATA("M",MEDN,501)),RESPIEN,INDEX)=""
"RTN","BPSECA5",80,0)
 .;File Reject CODEs
"RTN","BPSECA5",81,0)
 .S RJTN="",RJTCOUNT=0
"RTN","BPSECA5",82,0)
 .F  D  Q:RJTN=""
"RTN","BPSECA5",83,0)
 ..S RJTN=$O(FDATA("M",MEDN,511,RJTN))
"RTN","BPSECA5",84,0)
 ..Q:RJTN=""
"RTN","BPSECA5",85,0)
 ..;
"RTN","BPSECA5",86,0)
 ..S RJTCODE=$G(FDATA("M",MEDN,511,RJTN))
"RTN","BPSECA5",87,0)
 ..Q:RJTCODE="  "
"RTN","BPSECA5",88,0)
 ..Q:RJTCODE="00"
"RTN","BPSECA5",89,0)
 ..Q:RJTCODE=""   ;IHS/DSD/lwj 9/26/01 no nulls allowed
"RTN","BPSECA5",90,0)
 ..S RJTCOUNT=RJTCOUNT+1
"RTN","BPSECA5",91,0)
 ..;
"RTN","BPSECA5",92,0)
 ..S ^BPSR(RESPIEN,1000,INDEX,511,RJTCOUNT,0)=RJTCODE
"RTN","BPSECA5",93,0)
 ..S ^BPSR(RESPIEN,1000,INDEX,511,"B",RJTCODE,RJTCOUNT)=""
"RTN","BPSECA5",94,0)
 .S ^BPSR(RESPIEN,1000,INDEX,511,0)="^9002313.03511A^"_RJTCOUNT_"^"_RJTCOUNT
"RTN","BPSECA5",95,0)
 .;
"RTN","BPSECA5",96,0)
 .S ^BPSR(RESPIEN,1000,"B",INDEX,INDEX)=""
"RTN","BPSECA5",97,0)
 ;
"RTN","BPSECA5",98,0)
 S ^BPSR(RESPIEN,1000,0)="^9002313.0301A^"_INDEX_"^"_COUNT
"RTN","BPSECA5",99,0)
 Q
"RTN","BPSECA7")
0^5^B1668171
"RTN","BPSECA7",1,0)
BPSECA7 ;BHAM ISC/FCS/DRS/VA/DLF - Parse Claim Response ;05/14/2004
"RTN","BPSECA7",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECA7",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA7",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA7",5,0)
 ;Determine if the duplicate record has been paid or captured
"RTN","BPSECA7",6,0)
 ;Returns:  0 if Captured
"RTN","BPSECA7",7,0)
 ;          1 if PAID
"RTN","BPSECA7",8,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA7",9,0)
PAID(TEXT) ;EP - from BPSCA4
"RTN","BPSECA7",10,0)
 N X,CHARS
"RTN","BPSECA7",11,0)
 S CHARS="ABCDEFGHIJKLMNOPQR{}"
"RTN","BPSECA7",12,0)
 S X=$E(TEXT,1,30)
"RTN","BPSECA7",13,0)
 Q:'($E(X,1,5)?5N) 0
"RTN","BPSECA7",14,0)
 Q:'($E(X,7,11)?5N) 0
"RTN","BPSECA7",15,0)
 Q:'($E(X,13,17)?5N) 0
"RTN","BPSECA7",16,0)
 Q:'($E(X,19,23)?5N) 0
"RTN","BPSECA7",17,0)
 Q:'($E(X,25,29)?5N) 0
"RTN","BPSECA7",18,0)
 Q:'(CHARS[$E(X,6)) 0
"RTN","BPSECA7",19,0)
 Q:'(CHARS[$E(X,12)) 0
"RTN","BPSECA7",20,0)
 Q:'(CHARS[$E(X,18)) 0
"RTN","BPSECA7",21,0)
 Q:'(CHARS[$E(X,24)) 0
"RTN","BPSECA7",22,0)
 Q:'(CHARS[$E(X,30)) 0
"RTN","BPSECA7",23,0)
 Q 1
"RTN","BPSECA7",24,0)
 ;----------------------------------------------------------------------
"RTN","BPSECA7",25,0)
 ; This is not called from anywhere, as far as I can tell
"RTN","BPSECA7",26,0)
PARSETXT(DA,DA1,TEXT) ;
"RTN","BPSECA7",27,0)
 S $P(^BPSR(DA,1000,DA1,500),U,1)="P"
"RTN","BPSECA7",28,0)
 S $P(^BPSR(DA,1000,DA1,500),U,5)=$E(TEXT,1,6)
"RTN","BPSECA7",29,0)
 S $P(^BPSR(DA,1000,DA1,500),U,6)=$E(TEXT,7,12)
"RTN","BPSECA7",30,0)
 S $P(^BPSR(DA,1000,DA1,500),U,7)=$E(TEXT,13,18)
"RTN","BPSECA7",31,0)
 S $P(^BPSR(DA,1000,DA1,500),U,8)=$E(TEXT,19,24)
"RTN","BPSECA7",32,0)
 S $P(^BPSR(DA,1000,DA1,500),U,9)=$E(TEXT,25,30)
"RTN","BPSECA7",33,0)
 S $P(^BPSR(DA,1000,DA1,500),U,3)=$E(TEXT,31,44)
"RTN","BPSECA7",34,0)
 S $P(^BPSR(DA,1000,DA1,500),U,4)=$E(TEXT,45,$L(TEXT))
"RTN","BPSECA7",35,0)
 Q
"RTN","BPSECA8")
0^6^B12130364
"RTN","BPSECA8",1,0)
BPSECA8 ;BHAM ISC/FCS/DRS/VA/DLF - construct a claim reversal ;05/17/04
"RTN","BPSECA8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECA8",3,0)
 Q
"RTN","BPSECA8",4,0)
 ; The way we build the claim reversal is to take the source data
"RTN","BPSECA8",5,0)
 ; from the original claim (IEN) and position therein (RX).
"RTN","BPSECA8",6,0)
 ; $$ returns pointer to 9002313.02 of the new entry.
"RTN","BPSECA8",7,0)
 ;
"RTN","BPSECA8",8,0)
 ; Future:  want to use new database server calls to create the
"RTN","BPSECA8",9,0)
 ; 9002313.02 entry.  It would be soooo much cleaner.
"RTN","BPSECA8",10,0)
 ;
"RTN","BPSECA8",11,0)
 ; Remember, you have two 401 fields - one in header, one in prescript.
"RTN","BPSECA8",12,0)
 ;
"RTN","BPSECA8",13,0)
 ;IHS/SD/lwj 08/15/02 NCPDP 5.1 changes
"RTN","BPSECA8",14,0)
 ; There are new fields to consider in the 5.1 reversal process, in
"RTN","BPSECA8",15,0)
 ; addition to a new value for the transaction code (noe B2 as opposed
"RTN","BPSECA8",16,0)
 ; to 11 in 3.2).
"RTN","BPSECA8",17,0)
 ; Changes made as needed.
"RTN","BPSECA8",18,0)
 ;
"RTN","BPSECA8",19,0)
 ;IHS/SD/lwj 10/23/02 NCPDP 5.1 changes
"RTN","BPSECA8",20,0)
 ; New code added to account for a mixed reversal.  A mixed reversal is
"RTN","BPSECA8",21,0)
 ; a claim that was created in 3.x format & needs to be reversed in 5.1
"RTN","BPSECA8",22,0)
 ; format.  This requires field reformatting.
"RTN","BPSECA8",23,0)
 ;
"RTN","BPSECA8",24,0)
REVERSE(IEN,RX) ;EP - from BPSOS6D, BPSOSC2
"RTN","BPSECA8",25,0)
 ; IEN=original claim, RX = prescription # subscript therein
"RTN","BPSECA8",26,0)
 ; returns IEN of the reversal claim created
"RTN","BPSECA8",27,0)
 ;
"RTN","BPSECA8",28,0)
 ; extract needed data
"RTN","BPSECA8",29,0)
 N VARX S VARX=0
"RTN","BPSECA8",30,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1  ;VA;08/02/03
"RTN","BPSECA8",31,0)
 N CLAIM,RXMULT S CLAIM=9002313.02,RXMULT=9002313.0201 ; file #s
"RTN","BPSECA8",32,0)
 N DIC,DR,DA,DIQ,TMP,I,X
"RTN","BPSECA8",33,0)
 ; This field list is repeated below.
"RTN","BPSECA8",34,0)
 S DIC=CLAIM
"RTN","BPSECA8",35,0)
 ;
"RTN","BPSECA8",36,0)
 ;IHS/SD/lwj 8/15/02 NCPDP 5.1 new fields need to be used
"RTN","BPSECA8",37,0)
 S DR="**"
"RTN","BPSECA8",38,0)
 S DA=IEN
"RTN","BPSECA8",39,0)
 S DIQ="TMP",DIQ(0)="I"
"RTN","BPSECA8",40,0)
 D GETS^DIQ(CLAIM,IEN,DR,DIQ(0),DIQ)
"RTN","BPSECA8",41,0)
 S IEN=IEN_","   ;tack on the comma
"RTN","BPSECA8",42,0)
 ;
"RTN","BPSECA8",43,0)
 ;IHS/SD/lwj 10/23/02 NCPDP 5.1 changes
"RTN","BPSECA8",44,0)
 ; check for a mixed claim (3.x claim - 5.1 reversal)-reformat if needed
"RTN","BPSECA8",45,0)
 ;
"RTN","BPSECA8",46,0)
 D:$G(TMP(CLAIM,IEN,102,"I"))[3!($G(VARX)) CKVERS  ;VA;8/2/03
"RTN","BPSECA8",47,0)
 ;
"RTN","BPSECA8",48,0)
 ;IHS/SD/lwj 10/23/02 end mixed claim check
"RTN","BPSECA8",49,0)
 ;
"RTN","BPSECA8",50,0)
 ; Create a new 9002313.02 record
"RTN","BPSECA8",51,0)
 ; 7/29/2005-Use function to get unique ID.  Note that we are passing the IEN for the billing
"RTN","BPSECA8",52,0)
 ;   payer sheet, but it should not matter as the BIN will be the same for the billing and
"RTN","BPSECA8",53,0)
 ;   reversal
"RTN","BPSECA8",54,0)
 N DIC,X,DLAYGO,REVIEN,Y,UERETVAL
"RTN","BPSECA8",55,0)
R2 S DIC=9002313.02,DIC(0)="LX"
"RTN","BPSECA8",56,0)
 S X=$$CLAIMID^BPSECX1($G(TMP(CLAIM,IEN,.02,"I")),"P"),DLAYGO=CLAIM
"RTN","BPSECA8",57,0)
 D ^DIC S REVIEN=+Y I REVIEN<1 D  G:UERETVAL R2
"RTN","BPSECA8",58,0)
 . S UERETVAL=$$IMPOSS^BPSOSUE("FM,P",,"call to ^DIC",,,$T(+0))
"RTN","BPSECA8",59,0)
R4 ; create a new prescription multiple therein
"RTN","BPSECA8",60,0)
 S DIC="^BPSC("_REVIEN_",400,",DIC(0)="LX"
"RTN","BPSECA8",61,0)
 S DIC("P")=$P(^DD(CLAIM,400,0),U,2)
"RTN","BPSECA8",62,0)
 S DA(1)=REVIEN,DLAYGO=RXMULT
"RTN","BPSECA8",63,0)
 S X=1 D ^DIC I +Y'=1 D  G:UERETVAL R4
"RTN","BPSECA8",64,0)
 . S UERETVAL=$$IMPOSS^BPSOSUE("FM,P",,"call to ^DIC","for multiple",,$T(+0))
"RTN","BPSECA8",65,0)
 ; set data values
"RTN","BPSECA8",66,0)
 N DIE
"RTN","BPSECA8",67,0)
 S DIE=CLAIM,DA=REVIEN
"RTN","BPSECA8",68,0)
 S TMP(CLAIM,IEN,103,"I")=11 ; change transaction code to REVERSAL
"RTN","BPSECA8",69,0)
 ;
"RTN","BPSECA8",70,0)
 ;IHS/SD/lwj 8/15/02 NCPDP 5.1 changes
"RTN","BPSECA8",71,0)
 ; if the version is 5.1, the transaction code needs to be B2 not 11
"RTN","BPSECA8",72,0)
 ; following line added
"RTN","BPSECA8",73,0)
 S:$G(TMP(CLAIM,IEN,102,"I"))[5 TMP(CLAIM,IEN,103,"I")="B2"
"RTN","BPSECA8",74,0)
 ; Must agree with field list above.
"RTN","BPSECA8",75,0)
 ;IHS/SD/lwj 8/15/02 NCPDP 5.1 new fields need to be used
"RTN","BPSECA8",76,0)
 S DR="" N I
"RTN","BPSECA8",77,0)
 F I=.02,.03,1.01,1.02,1.03,101,102,103,104,109,110,201,202,302,304,305,310,311,331,332,401 D
"RTN","BPSECA8",78,0)
 .S DR=DR_I_"////"_$G(TMP(CLAIM,IEN,I,"I"))_";"
"RTN","BPSECA8",79,0)
 ; Transmit flag - it's 2 for POS and Created On fields
"RTN","BPSECA8",80,0)
 S DR=DR_".04////2;.06////"_$$NOWFM^BPSOSU1()
"RTN","BPSECA8",81,0)
 D ^DIE
"RTN","BPSECA8",82,0)
 S DIE="^BPSC("_REVIEN_",400,"
"RTN","BPSECA8",83,0)
 S DA(1)=REVIEN,DA=1,DR=""
"RTN","BPSECA8",84,0)
 ; Must agree with field list above
"RTN","BPSECA8",85,0)
 ;IHS/SD/lwj 8/15/02 NCPDP 5.1 new fields need to be used
"RTN","BPSECA8",86,0)
 F I=.05,308,401,402,403,407,418,420,436,438,439,440,441,455 D
"RTN","BPSECA8",87,0)
 .S DR=DR_I_"////"_$G(TMP(RXMULT,RX_","_IEN,I,"I"))_";"
"RTN","BPSECA8",88,0)
 S DR=$E(DR,1,$L(DR)-1) ; get rid of extra trailing ";"
"RTN","BPSECA8",89,0)
 D ^DIE
"RTN","BPSECA8",90,0)
 ;
"RTN","BPSECA8",91,0)
 Q REVIEN
"RTN","BPSECA8",92,0)
 ;
"RTN","BPSECA8",93,0)
CKVERS ;check the version of the current format - if it's 5.1 then we've hit a
"RTN","BPSECA8",94,0)
 ; "mixed claim."  (Originally created in 3.2 - reverse in 5.1)
"RTN","BPSECA8",95,0)
 ;
"RTN","BPSECA8",96,0)
 N BPSINS,BPSFORM,BPSVER,BPSCFRM
"RTN","BPSECA8",97,0)
 S (BPSINS,BPSFORM,BPSVER,BPSCFRM)=""
"RTN","BPSECA8",98,0)
 ;
"RTN","BPSECA8",99,0)
 S BPSINS=$G(TMP(9002313.02,IEN,.02,"I"))
"RTN","BPSECA8",100,0)
 Q:BPSINS=""
"RTN","BPSECA8",101,0)
 ;
"RTN","BPSECA8",102,0)
 I '$G(VARX) S BPSCFRM=$P($G(^BPSEI(BPSINS,100)),U)  ;claim format
"RTN","BPSECA8",103,0)
 E  S BPSCFRM=$G(TMP(CLAIM,IEN,.02,"I"))  ;VA;8/2/03
"RTN","BPSECA8",104,0)
 Q:BPSCFRM=""
"RTN","BPSECA8",105,0)
 ;
"RTN","BPSECA8",106,0)
 I '$G(VARX) S BPSFORM=$P($G(^BPSF(9002313.92,BPSCFRM,"REVERSAL")),U)
"RTN","BPSECA8",107,0)
 S BPSFORM=$$GET1^DIQ(9002313.59902,"1,"_IEN59_",","902.19","I")  ;VA;10/22/04
"RTN","BPSECA8",108,0)
 Q:BPSFORM=""
"RTN","BPSECA8",109,0)
 ;
"RTN","BPSECA8",110,0)
 S BPSVER=$P($G(^BPSF(9002313.92,BPSFORM,1)),U,2)
"RTN","BPSECA8",111,0)
 I BPSVER[5 D
"RTN","BPSECA8",112,0)
 . S TMP(9002313.02,IEN,102,"I")=51
"RTN","BPSECA8",113,0)
 . D REFORM^BPSOSHR(BPSFORM)
"RTN","BPSECA8",114,0)
 ;
"RTN","BPSECA8",115,0)
 Q
"RTN","BPSECA9")
1^7
"RTN","BPSECFM")
0^8^B10623995
"RTN","BPSECFM",1,0)
BPSECFM ;BHAM ISC/FCS/DRS/VA/DLF - NCPDP Field Format Functions ;05/17/2004
"RTN","BPSECFM",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECFM",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",5,0)
 ;NCPDP Field Format Functions
"RTN","BPSECFM",6,0)
 ; These are all $$ functions called from lots of places.
"RTN","BPSECFM",7,0)
 ;--------------------------------------------------------
"RTN","BPSECFM",8,0)
 ; IHS/SD/lwj 8/28/02 NCPDP 5.1 changes
"RTN","BPSECFM",9,0)
 ;  Added a new subroutine to translate the rejection code
"RTN","BPSECFM",10,0)
 ;  Added a new subroutine to translate the reason for service code
"RTN","BPSECFM",11,0)
 ;  Used for AdvancePCS certification process
"RTN","BPSECFM",12,0)
 ;--------------------------------------------------------
"RTN","BPSECFM",13,0)
 ;Numeric Format Function
"RTN","BPSECFM",14,0)
NFF(X,L) ;EP -
"RTN","BPSECFM",15,0)
 Q $E($TR($J("",L-$L(X))," ","0")_X,1,L)
"RTN","BPSECFM",16,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",17,0)
 ;Signed Numeric Field Format
"RTN","BPSECFM",18,0)
DFF(X,L) ;
"RTN","BPSECFM",19,0)
 N FNUMBER,DOLLAR,CENTS,SVALUE
"RTN","BPSECFM",20,0)
 Q:X="" $TR($J("",L)," ","0")
"RTN","BPSECFM",21,0)
 S DOLLAR=+$TR($P(X,".",1),"-","")
"RTN","BPSECFM",22,0)
 S CENTS=$E($P(X,".",2),1,2)
"RTN","BPSECFM",23,0)
 S:$L(CENTS)=0 CENTS="00"
"RTN","BPSECFM",24,0)
 S:$L(CENTS)=1 CENTS=CENTS_"0"
"RTN","BPSECFM",25,0)
 S SVALUE=$S(X<0:"}JKLMNOPQR",1:"{ABCDEFGHI")
"RTN","BPSECFM",26,0)
 S $E(CENTS,2)=$E(SVALUE,$E(CENTS,2)+1)
"RTN","BPSECFM",27,0)
 Q $E($TR($J("",L-$L(DOLLAR_CENTS))," ","0")_DOLLAR_CENTS,1,L)
"RTN","BPSECFM",28,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",29,0)
 ;Converts Signed Numeric Field to Decimal Value
"RTN","BPSECFM",30,0)
DFF2EXT(X) ;EP -
"RTN","BPSECFM",31,0)
 N LCHAR
"RTN","BPSECFM",32,0)
 S LCHAR=$E(X,$L(X))
"RTN","BPSECFM",33,0)
 S X=$TR(X,"{ABCDEFGHI","0123456789")
"RTN","BPSECFM",34,0)
 S X=$TR(X,"}JKLMNOPQR","0123456789")
"RTN","BPSECFM",35,0)
 S X=X*.01
"RTN","BPSECFM",36,0)
 I "}JKLMNOPQR"[LCHAR S X=X*-1
"RTN","BPSECFM",37,0)
 Q $J(+X,$L(+X),2)
"RTN","BPSECFM",38,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",39,0)
 ;Alpha-Numeric Field Format
"RTN","BPSECFM",40,0)
ANFF(X,L) ;EP
"RTN","BPSECFM",41,0)
 Q $E(X_$J("",L-$L(X)),1,L)
"RTN","BPSECFM",42,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",43,0)
 ;Numerics Field Format
"RTN","BPSECFM",44,0)
 ; DUPLICATE TAGS!   commented out this one
"RTN","BPSECFM",45,0)
 ; The other one appears to zero fill.
"RTN","BPSECFM",46,0)
 ; NFF(X,L) 
"RTN","BPSECFM",47,0)
 ; Q $E(X_$J("",L-$L(X)),1,L)
"RTN","BPSECFM",48,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",49,0)
 ;Convert FileManager date into CCYYMMDD format
"RTN","BPSECFM",50,0)
DTF1(X) ;EP -
"RTN","BPSECFM",51,0)
 N Y,%DT
"RTN","BPSECFM",52,0)
 ;Q:X'["." X
"RTN","BPSECFM",53,0)
 S X=$P(X,".",1)
"RTN","BPSECFM",54,0)
 Q:X="" "00000000"
"RTN","BPSECFM",55,0)
 S Y=X D DD^%DT
"RTN","BPSECFM",56,0)
 S X=Y,%DT="X" D ^%DT
"RTN","BPSECFM",57,0)
 Q:Y=-1 "00000000"
"RTN","BPSECFM",58,0)
 S X=Y+17000000
"RTN","BPSECFM",59,0)
 Q X
"RTN","BPSECFM",60,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",61,0)
 ;Reformats NDC number
"RTN","BPSECFM",62,0)
NDCF(X) ;EP -
"RTN","BPSECFM",63,0)
 S X=$TR(X,"-","")
"RTN","BPSECFM",64,0)
 I X?11N Q X                                 ; no reformatting needed
"RTN","BPSECFM",65,0)
 I $L(X)<11 F I=1:1:(11-$L(X)) S X="0"_X
"RTN","BPSECFM",66,0)
 I $L(X)>11 S X=$E(X,2,12)
"RTN","BPSECFM",67,0)
 S X=$E(X,1,5)_"-"_$E(X,6,9)_"-"_$E(X,10,11)
"RTN","BPSECFM",68,0)
 N Y,I
"RTN","BPSECFM",69,0)
 F I=1:1:3 S Y(I)=$P(X,"-",I)
"RTN","BPSECFM",70,0)
 S X=$$RJZF(Y(1),5)_$$RJZF(Y(2),4)_$$RJZF(Y(3),2)
"RTN","BPSECFM",71,0)
 Q X
"RTN","BPSECFM",72,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",73,0)
 ;Right justify and zero fill X in a string of length L
"RTN","BPSECFM",74,0)
RJZF(X,L) ;
"RTN","BPSECFM",75,0)
 I $L(X)<L Q $E($TR($J("",L-$L(X))," ","0")_X,1,L)
"RTN","BPSECFM",76,0)
 Q $E(X,$L(X)-L+1,$L(X))
"RTN","BPSECFM",77,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",78,0)
 ;Right justify and blank fill X in a string of length L
"RTN","BPSECFM",79,0)
RJBF(X,L) ;EP -
"RTN","BPSECFM",80,0)
 Q $E($J("",L-$L(X))_X,1,L)
"RTN","BPSECFM",81,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",82,0)
 ;STRIP TEXT of all non-numerics
"RTN","BPSECFM",83,0)
STRIPN(TEXT) ;
"RTN","BPSECFM",84,0)
 N NUM,I,CH
"RTN","BPSECFM",85,0)
 S NUM=""
"RTN","BPSECFM",86,0)
 F I=1:1:$L(TEXT) D
"RTN","BPSECFM",87,0)
 .S CH=$E(TEXT,I,I)
"RTN","BPSECFM",88,0)
 .S:CH?1N NUM=NUM_CH
"RTN","BPSECFM",89,0)
 Q NUM
"RTN","BPSECFM",90,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",91,0)
 ;IHS/SD/lwj 8/28/02  NCPDP 5.1 changes
"RTN","BPSECFM",92,0)
 ; For the certification process with AdvancePCS, they require that the
"RTN","BPSECFM",93,0)
 ; reject explanation appear with the rejection code.  The following
"RTN","BPSECFM",94,0)
 ; Additionally, they require that within the DUR segment, the 
"RTN","BPSECFM",95,0)
 ; description for the reason for service code also appear (fld 439).
"RTN","BPSECFM",96,0)
 ; To accomodate this requirement, the following subroutines were
"RTN","BPSECFM",97,0)
 ; created to act as an output transform for the reject codes and the
"RTN","BPSECFM",98,0)
 ; reason for service code.  These routine will not currently be used
"RTN","BPSECFM",99,0)
 ; any where else, but will be kept in the software in case they are
"RTN","BPSECFM",100,0)
 ; needed.
"RTN","BPSECFM",101,0)
 ;
"RTN","BPSECFM",102,0)
TRANREJ(REJCD) ;EP - REJCD will be the incoming rejection code
"RTN","BPSECFM",103,0)
 ;
"RTN","BPSECFM",104,0)
 I $G(REJCD)="" Q ""
"RTN","BPSECFM",105,0)
 N REJECT,REJIEN
"RTN","BPSECFM",106,0)
 ;
"RTN","BPSECFM",107,0)
 S REJIEN=0
"RTN","BPSECFM",108,0)
 S REJIEN=$O(^BPSF(9002313.93,"B",REJCD,REJIEN))  ;find record
"RTN","BPSECFM",109,0)
 I REJIEN S REJECT=$P($G(^BPSF(9002313.93,REJIEN,0)),U,2)
"RTN","BPSECFM",110,0)
 E  S REJECT="Description not found for rejection code"
"RTN","BPSECFM",111,0)
 S REJECT=REJCD_" ("_REJECT_")"
"RTN","BPSECFM",112,0)
 S REJECT=$$ANFF(REJECT,50)
"RTN","BPSECFM",113,0)
 ;
"RTN","BPSECFM",114,0)
 Q REJECT
"RTN","BPSECFM",115,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",116,0)
TRANSCD(SRVCD) ;EP - SRCCD will be the incoming reason for service code
"RTN","BPSECFM",117,0)
 ;
"RTN","BPSECFM",118,0)
 N SCDIEN,SCDESC
"RTN","BPSECFM",119,0)
 ;
"RTN","BPSECFM",120,0)
 S SCDIEN=0
"RTN","BPSECFM",121,0)
 S SRVCD=$E(SRVCD,1,2)
"RTN","BPSECFM",122,0)
 S:$G(SRVCD)'="" SCDIEN=$O(^BPSF(9002313.82439,"B",SRVCD,SCDIEN))  ;find record
"RTN","BPSECFM",123,0)
 S:$G(SCDIEN) SCDESC=$P($G(^BPSF(9002313.82439,SCDIEN,0)),U,2)
"RTN","BPSECFM",124,0)
 S:$G(SCDESC)="" SCDESC="Description not found for service code"
"RTN","BPSECFM",125,0)
 S SCDESC=SRVCD_" ("_SCDESC_" )"
"RTN","BPSECFM",126,0)
 S SCDESC=$$ANFF(SCDESC,50)
"RTN","BPSECFM",127,0)
 ;
"RTN","BPSECFM",128,0)
 Q SCDESC
"RTN","BPSECFM",129,0)
 ;----------------------------------------------------------------------
"RTN","BPSECMC2")
0^9^B13730407
"RTN","BPSECMC2",1,0)
BPSECMC2 ;BHAM ISC/SAB - ENTER/EDIT OUTPATIENT SITE PARAMETERS ;09/18/92 9:11
"RTN","BPSECMC2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECMC2",3,0)
 ;
"RTN","BPSECMC2",4,0)
CHOP(HLA,CLAIMIEN,IEN59) ;
"RTN","BPSECMC2",5,0)
 ;
"RTN","BPSECMC2",6,0)
 ;
"RTN","BPSECMC2",7,0)
 N TCNT,CNT,RNLNGTH,TRANID,V2DTG
"RTN","BPSECMC2",8,0)
 S CNT=0
"RTN","BPSECMC2",9,0)
 ;
"RTN","BPSECMC2",10,0)
 ; Crash proofing - Need to put better error handling in
"RTN","BPSECMC2",11,0)
 I '$D(HLA)!'$L($G(CLAIMIEN)) W !,"Error: Invalid Claim Data"
"RTN","BPSECMC2",12,0)
 ;
"RTN","BPSECMC2",13,0)
 ; Initialize HL7 environment
"RTN","BPSECMC2",14,0)
 ;
"RTN","BPSECMC2",15,0)
 D INIT^HLFNC2("BPS ECMECL1 NTE",.HL)
"RTN","BPSECMC2",16,0)
 I $G(HL)  D
"RTN","BPSECMC2",17,0)
 . ; put error handler here for init failure
"RTN","BPSECMC2",18,0)
 . W !,"Error: "_$P(HL,2)
"RTN","BPSECMC2",19,0)
 ;
"RTN","BPSECMC2",20,0)
 ; Determine run length of the transmission & pad with zeroes
"RTN","BPSECMC2",21,0)
 ;
"RTN","BPSECMC2",22,0)
 S RNLNGTH=0
"RTN","BPSECMC2",23,0)
 F TCNT=1:1 Q:$G(HLA("HLS",TCNT))=""  D
"RTN","BPSECMC2",24,0)
 .S RNLNGTH=RNLNGTH+$L(HLA("HLS",TCNT))
"RTN","BPSECMC2",25,0)
 S RNLNGTH=$RE($E($RE("0000"_(RNLNGTH+29)),1,4))
"RTN","BPSECMC2",26,0)
 S CNT=TCNT-1
"RTN","BPSECMC2",27,0)
 ;
"RTN","BPSECMC2",28,0)
 S TRANID=$P($P($G(^BPSC(CLAIMIEN,0)),"^"),"R")
"RTN","BPSECMC2",29,0)
 S HLA("HLS",1)="\X02\"_RNLNGTH_TRANID_$G(HLA("HLS",1))
"RTN","BPSECMC2",30,0)
 ;
"RTN","BPSECMC2",31,0)
 ; Translate non-printable to printable & Set OBX segs
"RTN","BPSECMC2",32,0)
 F TCNT=1:1:CNT Q:$G(HLA("HLS",TCNT))=""  D
"RTN","BPSECMC2",33,0)
 .F  D  Q:$P(HLA("HLS",TCNT),$C(29))=HLA("HLS",TCNT)
"RTN","BPSECMC2",34,0)
 ..S:HLA("HLS",TCNT)[$C(29) HLA("HLS",TCNT)=$P(HLA("HLS",TCNT),$C(29))_"\X1D\"_$P(HLA("HLS",TCNT),$C(29),2,999)
"RTN","BPSECMC2",35,0)
 .F  D  Q:$P(HLA("HLS",TCNT),$C(30))=HLA("HLS",TCNT)
"RTN","BPSECMC2",36,0)
 ..S:HLA("HLS",TCNT)[$C(30) HLA("HLS",TCNT)=$P(HLA("HLS",TCNT),$C(30))_"\X1E\"_$P(HLA("HLS",TCNT),$C(30),2,999)
"RTN","BPSECMC2",37,0)
 .F  D  Q:$P(HLA("HLS",TCNT),$C(28))=HLA("HLS",TCNT)
"RTN","BPSECMC2",38,0)
 ..S:HLA("HLS",TCNT)[$C(28) HLA("HLS",TCNT)=$P(HLA("HLS",TCNT),$C(28))_"\X1C\"_$P(HLA("HLS",TCNT),$C(28),2,999)
"RTN","BPSECMC2",39,0)
 .I TCNT=CNT S HLA("HLS",CNT)=$P(HLA("HLS",CNT),$C(3))_"\X03\"
"RTN","BPSECMC2",40,0)
 .S HLA("HLS",TCNT)="OBX||FT|NCPDP|"_TCNT_"|"_HLA("HLS",TCNT)_"||||||F"
"RTN","BPSECMC2",41,0)
 ;
"RTN","BPSECMC2",42,0)
 ; Set OBR seg
"RTN","BPSECMC2",43,0)
 ; Get fileman date/time, ensuring seconds are included: 3031029.135636
"RTN","BPSECMC2",44,0)
 S V2DTG=$E($$HTFM^XLFDT($H)_"000000",1,14)
"RTN","BPSECMC2",45,0)
 ; Set HL7 Date/Time format: 20031029135636-0400
"RTN","BPSECMC2",46,0)
 S HLA("HLS",.5)="OBR||||NCPDP|||"_$$FMTHL7^XLFDT(V2DTG)_"|||||||||||"_$E(TRANID,1,29)
"RTN","BPSECMC2",47,0)
 ;
"RTN","BPSECMC2",48,0)
 K HLA("HLS",0)
"RTN","BPSECMC2",49,0)
 ;
"RTN","BPSECMC2",50,0)
 ;CALL HL7 TO TRANSMIT SINGLE MESSAGE
"RTN","BPSECMC2",51,0)
 ;
"RTN","BPSECMC2",52,0)
 S IEN59=$O(^BPST("AE",CLAIMIEN,""))
"RTN","BPSECMC2",53,0)
 I IEN59="" S IEN59=$O(^BPST("AER",CLAIMIEN,""))
"RTN","BPSECMC2",54,0)
 D SETSLOT^BPSOSL(IEN59)
"RTN","BPSECMC2",55,0)
 D LOG^BPSOSL($T(+0)_" - CLAIM - BEGIN - #"_CLAIMIEN_" ("_$P($G(^BPSC(CLAIMIEN,0)),U)_")")
"RTN","BPSECMC2",56,0)
 D SETCSTAT^BPSOSU(CLAIMIEN,60)
"RTN","BPSECMC2",57,0)
 ;
"RTN","BPSECMC2",58,0)
 D GENERATE^HLMA("BPS ECMESV1 NTE","LM",1,.MYRESULT,"",.MYOPTNS)
"RTN","BPSECMC2",59,0)
 ;
"RTN","BPSECMC2",60,0)
 D LOG^BPSOSL($T(+0)_" - CLAIM - SENT - #"_CLAIMIEN_" ("_$P($G(^BPSC(CLAIMIEN,0)),U)_")")
"RTN","BPSECMC2",61,0)
 Q
"RTN","BPSECMC2",62,0)
STORESP ;
"RTN","BPSECMC2",63,0)
 ; 
"RTN","BPSECMC2",64,0)
 ; THE HL7 MODULE CALLS THIS ROUTINE FROM THE RESPONSE PROCESSING ROUTINE.  THIS MODULE READS THE
"RTN","BPSECMC2",65,0)
 ; INFORMATION ABOUT THE RESPONSE FROM FILE 772 AND CALLS PSOECMPS4 TO STORE THE RESPONSE INTO 
"RTN","BPSECMC2",66,0)
 ; THE BPS RESPONSE FILE, 9002313.03
"RTN","BPSECMC2",67,0)
 ;
"RTN","BPSECMC2",68,0)
 N RI,TMSG,RMSG,RESPIEN,TRANTYPE,VANUM,CLAIMIEN,IEN59,ABSBRXI
"RTN","BPSECMC2",69,0)
 S TMSG=""
"RTN","BPSECMC2",70,0)
 F RI=1:1 X HLNEXT Q:HLNODE=""  I $E(HLNODE,1,3)="OBX"  D
"RTN","BPSECMC2",71,0)
 .S TMSG=HLNODE,RMSG=""
"RTN","BPSECMC2",72,0)
 .F  S RMSG=$O(HLNODE(RMSG)) Q:RMSG=""  S TMSG=TMSG_HLNODE(RMSG)
"RTN","BPSECMC2",73,0)
 ;
"RTN","BPSECMC2",74,0)
 ;STRIP OFF HL7, STX, ETX, NTE AND BYTE COUNT
"RTN","BPSECMC2",75,0)
 S TMSG=$P(TMSG,$E(TMSG,4),6),TMSG=$E(TMSG,10,$L(TMSG)-5)
"RTN","BPSECMC2",76,0)
 S TRANTYPE=$E(TMSG,32,33),VANUM=$E(TMSG,1,29)
"RTN","BPSECMC2",77,0)
 S CLAIMIEN=$O(^BPSC("B",VANUM,""))
"RTN","BPSECMC2",78,0)
 ; If CLAIMIEN is null, next line will crash ungracefully
"RTN","BPSECMC2",79,0)
 S IEN59=$O(^BPST("AE",CLAIMIEN,""))
"RTN","BPSECMC2",80,0)
 I IEN59="" S IEN59=$O(^BPST("AER",CLAIMIEN,""))
"RTN","BPSECMC2",81,0)
 ;
"RTN","BPSECMC2",82,0)
 D SETSLOT^BPSOSL(IEN59)
"RTN","BPSECMC2",83,0)
 D SETCSTAT^BPSOSU(CLAIMIEN,70)
"RTN","BPSECMC2",84,0)
 ;STORE THE RESPONSE MESSAGE IN THE RESPONSE FILE
"RTN","BPSECMC2",85,0)
 ;
"RTN","BPSECMC2",86,0)
 D LOG^BPSOSL($T(+0)_" - CLAIM - RESPONSE RECEIVED - #"_CLAIMIEN_" ("_$P($G(^BPSC(CLAIMIEN,0)),U)_")")
"RTN","BPSECMC2",87,0)
 D SETCSTAT^BPSOSU(CLAIMIEN,80)
"RTN","BPSECMC2",88,0)
 D PARSE^BPSECMPS(TMSG,CLAIMIEN,.RESPIEN)
"RTN","BPSECMC2",89,0)
 D LOG^BPSOSL($T(+0)_" - CLAIM - RESPONSE STORED - #"_CLAIMIEN_" ("_$P($G(^BPSC(CLAIMIEN,0)),U)_")")
"RTN","BPSECMC2",90,0)
 D LOG^BPSOSL("CLAIM - END - #"_CLAIMIEN_" ("_$P($G(^BPSC(CLAIMIEN,0)),U)_")")
"RTN","BPSECMC2",91,0)
 S ABSBRXI=IEN59
"RTN","BPSECMC2",92,0)
 D ONE^BPSOSQL(CLAIMIEN,$G(RESPIEN))
"RTN","BPSECMC2",93,0)
 Q
"RTN","BPSECMP2")
0^10^B63501643
"RTN","BPSECMP2",1,0)
BPSECMP2 ;BHAM ISC/FCS/DRS - Parse Claim Response ;06/15/2004
"RTN","BPSECMP2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECMP2",3,0)
 ;Reference to ^PSRX supported by DBIA 1977
"RTN","BPSECMP2",4,0)
 ;Reference to STORESP^IBNCPDP supported by DBIA 4299
"RTN","BPSECMP2",5,0)
 Q
"RTN","BPSECMP2",6,0)
 ; Parameters:
"RTN","BPSECMP2",7,0)
 ;    CLAIMIEN: IEN from BPS Claims
"RTN","BPSECMP2",8,0)
 ;    RESPIEN:  IEN from BPS Response
"RTN","BPSECMP2",9,0)
 ;    EVENT:    This is used by PSO to create specific events (BILL).
"RTN","BPSECMP2",10,0)
 ;    USER:     User who is creating the event.  This is required when EVENT is sent.
"RTN","BPSECMP2",11,0)
IBSEND(CLAIMIEN,RESPIEN,EVENT,USER) ;
"RTN","BPSECMP2",12,0)
 N IBARY,RXIEN,FILLNUM,IND,TRNDX,RELDATE,X,Y,%DT
"RTN","BPSECMP2",13,0)
 N CLAIMNFO,RESPNFO,RXINFO,RFINFO,TRANINFO
"RTN","BPSECMP2",14,0)
 N RESPONSE,RXACT,CLREAS,BILLNUM,DFN,REQCLAIM
"RTN","BPSECMP2",15,0)
 N DIE,DA,DR
"RTN","BPSECMP2",16,0)
 ;
"RTN","BPSECMP2",17,0)
 ; Quit if there is not a Response or Claim IEN
"RTN","BPSECMP2",18,0)
 I '$G(RESPIEN) Q
"RTN","BPSECMP2",19,0)
 I '$G(CLAIMIEN) Q
"RTN","BPSECMP2",20,0)
 ;
"RTN","BPSECMP2",21,0)
 ; Get Claims and Response Data
"RTN","BPSECMP2",22,0)
 D GETS^DIQ("9002313.02",CLAIMIEN,"103;400*;401;402;403;426","","CLAIMNFO")
"RTN","BPSECMP2",23,0)
 D GETS^DIQ("9002313.0301","1,"_RESPIEN,"112;503;509","I","RESPNFO")
"RTN","BPSECMP2",24,0)
 ;
"RTN","BPSECMP2",25,0)
 ; Get the Transaction IEN and Data
"RTN","BPSECMP2",26,0)
 S IND=$S(CLAIMNFO("9002313.02",CLAIMIEN_",","103")="B2":"AER",1:"AE")
"RTN","BPSECMP2",27,0)
 S TRNDX=$O(^BPST(IND,CLAIMIEN,""))
"RTN","BPSECMP2",28,0)
 I TRNDX="" Q
"RTN","BPSECMP2",29,0)
 D GETS^DIQ("9002313.59",TRNDX,"3;13;404;1201","I","TRANINFO")
"RTN","BPSECMP2",30,0)
 ;
"RTN","BPSECMP2",31,0)
 ; Determine Prescription IEN
"RTN","BPSECMP2",32,0)
 S RXIEN=$P(^BPSC(CLAIMIEN,400,1,0),"^",5)
"RTN","BPSECMP2",33,0)
 ;
"RTN","BPSECMP2",34,0)
 ; If Certify Mode is On, don't send to IB
"RTN","BPSECMP2",35,0)
 I $$GET1^DIQ(9002313.59902,"1,"_TRNDX_",","902.22")["MODE ON" Q
"RTN","BPSECMP2",36,0)
 ;
"RTN","BPSECMP2",37,0)
 ; Testing for Certification Only - DLF
"RTN","BPSECMP2",38,0)
 I '$D(^PSRX(RXIEN)) Q
"RTN","BPSECMP2",39,0)
 ;
"RTN","BPSECMP2",40,0)
 ; Store RXACT into a local variable as it is will be used a lot
"RTN","BPSECMP2",41,0)
 S RXACT=TRANINFO("9002313.59",TRNDX_",",1201,"I")
"RTN","BPSECMP2",42,0)
 ;
"RTN","BPSECMP2",43,0)
 ; Setup User data
"RTN","BPSECMP2",44,0)
 ; If event is passed in, the user should be passed in as well
"RTN","BPSECMP2",45,0)
 ; If no Event, but action is Auto-Reversal (AREV) or CMOP (CR*/PC/RL),
"RTN","BPSECMP2",46,0)
 ;     user postmaster (.5)
"RTN","BPSECMP2",47,0)
 ; Else use the user from BPS Transaction
"RTN","BPSECMP2",48,0)
 I EVENT]"" S IBARY("USER")=USER
"RTN","BPSECMP2",49,0)
 E  I ",AREV,CRLB,CRLX,CRLR,PC,RL,"[(","_RXACT_",") S IBARY("USER")=.5
"RTN","BPSECMP2",50,0)
 E  S IBARY("USER")=TRANINFO("9002313.59",TRNDX_",",13,"I")
"RTN","BPSECMP2",51,0)
 ;
"RTN","BPSECMP2",52,0)
 ; Determine Payer Response
"RTN","BPSECMP2",53,0)
 ; Treat Duplicate of Accepted Reversal ("S") as accepted
"RTN","BPSECMP2",54,0)
 S RESPONSE=RESPNFO(9002313.0301,"1,"_RESPIEN_",",112,"I")
"RTN","BPSECMP2",55,0)
 S RESPONSE=$S(RESPONSE="A":"ACCEPTED",RESPONSE="C":"CAPTURED",RESPONSE="D":"DUPLICATE",RESPONSE="P":"PAYABLE",RESPONSE="R":"REJECTED",RESPONSE="S":"ACCEPTED",1:"OTHER")
"RTN","BPSECMP2",56,0)
 ;
"RTN","BPSECMP2",57,0)
 ; Get Prescription Information
"RTN","BPSECMP2",58,0)
 D GETS^DIQ("52",RXIEN,".01;4;6;8;7;16;27","IE","RXINFO")
"RTN","BPSECMP2",59,0)
 ;
"RTN","BPSECMP2",60,0)
 ; Get Refill Info if this is a refill
"RTN","BPSECMP2",61,0)
 S FILLNUM=+$E($P(TRNDX,".",2),1,4)
"RTN","BPSECMP2",62,0)
 I FILLNUM>0 D GETS^DIQ("52.1",FILLNUM_","_RXIEN,".01;1;1.1;11","","RFINFO")
"RTN","BPSECMP2",63,0)
 ;
"RTN","BPSECMP2",64,0)
 ; Fill Date
"RTN","BPSECMP2",65,0)
 S IBARY("FILL DATE")=CLAIMNFO("9002313.0201","1,"_CLAIMIEN_",","401")
"RTN","BPSECMP2",66,0)
 S %DT="X",X=IBARY("FILL DATE") D ^%DT S:Y'=-1 IBARY("FILL DATE")=Y
"RTN","BPSECMP2",67,0)
 ;
"RTN","BPSECMP2",68,0)
 ; Information needed for PAID/BILLING event
"RTN","BPSECMP2",69,0)
 S IBARY("PAID")=0
"RTN","BPSECMP2",70,0)
 I RESPONSE="PAYABLE" D
"RTN","BPSECMP2",71,0)
 . S IBARY("PAID")=$$DFF2EXT^BPSECFM(RESPNFO(9002313.0301,"1,"_RESPIEN_",",509,"I"))
"RTN","BPSECMP2",72,0)
 . S IBARY("AUTH #")=RESPNFO(9002313.0301,"1,"_RESPIEN_",",503,"I")
"RTN","BPSECMP2",73,0)
 . S IBARY("RX NO")=RXINFO(52,RXIEN_",",.01,"E")
"RTN","BPSECMP2",74,0)
 . S IBARY("DRUG")=$P($G(^PSRX(RXIEN,0)),"^",6)
"RTN","BPSECMP2",75,0)
 . I FILLNUM<1  D
"RTN","BPSECMP2",76,0)
 .. S IBARY("DAYS SUPPLY")=RXINFO(52,RXIEN_",",8,"E")
"RTN","BPSECMP2",77,0)
 .. S IBARY("QTY")=RXINFO(52,RXIEN_",",7,"E")
"RTN","BPSECMP2",78,0)
 . E  D
"RTN","BPSECMP2",79,0)
 .. S IBARY("DAYS SUPPLY")=$G(RFINFO(52.1,FILLNUM_","_RXIEN_",",1.1))
"RTN","BPSECMP2",80,0)
 .. S IBARY("QTY")=$G(RFINFO(52.1,FILLNUM_","_RXIEN_",",1))
"RTN","BPSECMP2",81,0)
 ;
"RTN","BPSECMP2",82,0)
 ; Get Plan info
"RTN","BPSECMP2",83,0)
 I $D(^BPST(TRNDX,10,1,0)) S IBARY("PLAN")=$P(^BPST(TRNDX,10,1,0),"^")
"RTN","BPSECMP2",84,0)
 ;
"RTN","BPSECMP2",85,0)
 ; Setup miscellaneous values
"RTN","BPSECMP2",86,0)
 S DFN=$P($G(^PSRX(RXIEN,0)),"^",2)
"RTN","BPSECMP2",87,0)
 S IBARY("NDC")=$$GETNDC^PSONDCUT(RXIEN,FILLNUM)
"RTN","BPSECMP2",88,0)
 S IBARY("FILL NUMBER")=FILLNUM
"RTN","BPSECMP2",89,0)
 S IBARY("FILLED BY")=RXINFO(52,RXIEN_",",16,"I")
"RTN","BPSECMP2",90,0)
 S IBARY("PRESCRIPTION")=RXIEN
"RTN","BPSECMP2",91,0)
 S IBARY("BILLED")=$P(CLAIMNFO("9002313.0201","1,"_CLAIMIEN_",","426"),"DQ",2)
"RTN","BPSECMP2",92,0)
 S IBARY("BILLED")=$$DFF2EXT^BPSECFM(IBARY("BILLED"))
"RTN","BPSECMP2",93,0)
 S IBARY("CLAIMID")=$P(CLAIMNFO("9002313.0201","1,"_CLAIMIEN_",","402"),"D2",2)
"RTN","BPSECMP2",94,0)
 S RELDATE=$S(FILLNUM=0:$P($G(^PSRX(RXIEN,2)),"^",13),1:$P($G(^PSRX(RXIEN,1,FILLNUM,0)),"^",18))
"RTN","BPSECMP2",95,0)
 S IBARY("RELEASE DATE")=$P(RELDATE,".")
"RTN","BPSECMP2",96,0)
 S IBARY("RESPONSE")=RESPONSE
"RTN","BPSECMP2",97,0)
 S IBARY("DIVISION")=$$MCDIV^BPSBUTL(RXIEN,FILLNUM)
"RTN","BPSECMP2",98,0)
 ;
"RTN","BPSECMP2",99,0)
 ; For reversals, get reversal reason and check for closed reason
"RTN","BPSECMP2",100,0)
 ; Call IB with Reversal Event
"RTN","BPSECMP2",101,0)
 ; If there is a close reason, call IB with CLOSE event
"RTN","BPSECMP2",102,0)
 ;    and update BPS Claim with close information
"RTN","BPSECMP2",103,0)
 I EVENT="",$$ISREVERS^BPSOSU(CLAIMIEN) D  Q
"RTN","BPSECMP2",104,0)
 . S REQCLAIM=TRANINFO("9002313.59",TRNDX_",",3,"I")
"RTN","BPSECMP2",105,0)
 . S IBARY("REVERSAL REASON")=TRANINFO("9002313.59",TRNDX_",",404,"I")
"RTN","BPSECMP2",106,0)
 . S IBARY("RTS-DEL")=0
"RTN","BPSECMP2",107,0)
 . ; Get RX action, which determine close event
"RTN","BPSECMP2",108,0)
 . I RXACT="RS" S CLREAS="PRESCRIPTION NOT RELEASED",IBARY("RTS-DEL")=1
"RTN","BPSECMP2",109,0)
 . I RXACT="DE" D
"RTN","BPSECMP2",110,0)
 . . S CLREAS="PRESCRIPTION DELETED",IBARY("RTS-DEL")=1
"RTN","BPSECMP2",111,0)
 . . ; check whether RX was in fact deleted in Pharmacy
"RTN","BPSECMP2",112,0)
 . . ; if not then the refill was deleted
"RTN","BPSECMP2",113,0)
 . . I $$RXSTATUS^BPSSCRU2(RXIEN,0)'=13 S IBARY("CLOSE COMMENT")="DELETION OF REFILL ONLY - ORIGINAL RX MAY REMAIN ACTIVE"
"RTN","BPSECMP2",114,0)
 . ; If accepted inpatient autoreversal, then close the claim
"RTN","BPSECMP2",115,0)
 . I RXACT="AREV",RESPONSE="ACCEPTED",REQCLAIM,$P($G(^BPSC(REQCLAIM,0)),U,7)=2 D
"RTN","BPSECMP2",116,0)
 .. S CLREAS="OTHER",IBARY("CLOSE COMMENT")="INPATIENT PRESCRIPTION"
"RTN","BPSECMP2",117,0)
 . I $D(CLREAS) S IBARY("CLOSE REASON")=$O(^IBE(356.8,"B",CLREAS,0))
"RTN","BPSECMP2",118,0)
 . ;
"RTN","BPSECMP2",119,0)
 . ; Call IB for Reversal Event
"RTN","BPSECMP2",120,0)
 . S IBARY("STATUS")="REVERSED",BILLNUM=$$STORESP^IBNCPDP(DFN,.IBARY)
"RTN","BPSECMP2",121,0)
 . ; If there is no close reason, quit
"RTN","BPSECMP2",122,0)
 . I '$D(IBARY("CLOSE REASON")) Q
"RTN","BPSECMP2",123,0)
 . ; Call IB for CLOSE event
"RTN","BPSECMP2",124,0)
 . ;  Note for close, user is always postmaster (.5)
"RTN","BPSECMP2",125,0)
 . S IBARY("STATUS")="CLOSED",IBARY("USER")=.5
"RTN","BPSECMP2",126,0)
 . S BILLNUM=$$STORESP^IBNCPDP(DFN,.IBARY)
"RTN","BPSECMP2",127,0)
 . ;
"RTN","BPSECMP2",128,0)
 . ; Populate the original claim request with the close reason
"RTN","BPSECMP2",129,0)
 . I REQCLAIM D
"RTN","BPSECMP2",130,0)
 .. S DIE="^BPSC(",DA=REQCLAIM
"RTN","BPSECMP2",131,0)
 .. S DR="901///1;902///"_$$NOW^XLFDT()_";903///.5;904///"_IBARY("CLOSE REASON")
"RTN","BPSECMP2",132,0)
 .. D ^DIE
"RTN","BPSECMP2",133,0)
 ; 
"RTN","BPSECMP2",134,0)
 ; If we got here, then it is not a reversal
"RTN","BPSECMP2",135,0)
 ; If EVENT is set, send Submit event
"RTN","BPSECMP2",136,0)
 I EVENT="" S IBARY("STATUS")="SUBMITTED",BILLNUM=$$STORESP^IBNCPDP(DFN,.IBARY)
"RTN","BPSECMP2",137,0)
 ;
"RTN","BPSECMP2",138,0)
 ; Sent Paid (Billable) event is the claim was paid and released or EVENT is BILL
"RTN","BPSECMP2",139,0)
 ;   Note: User is always postmaster except for BackBilling (BB)
"RTN","BPSECMP2",140,0)
 I EVENT="BILL"!(RESPONSE="PAYABLE"&(IBARY("RELEASE DATE")]"")) D
"RTN","BPSECMP2",141,0)
 . I RXACT'="BB" S IBARY("USER")=.5
"RTN","BPSECMP2",142,0)
 . S IBARY("STATUS")="PAID",BILLNUM=$$STORESP^IBNCPDP(DFN,.IBARY)
"RTN","BPSECMP2",143,0)
 Q
"RTN","BPSECMP2",144,0)
 ;
"RTN","BPSECMP2",145,0)
 ; Synch DURs between ECME and PSO
"RTN","BPSECMP2",146,0)
 ; Parameters:
"RTN","BPSECMP2",147,0)
 ;   IEN59 is the BPS Transaction IEN
"RTN","BPSECMP2",148,0)
DURSYNC(IEN59) ;
"RTN","BPSECMP2",149,0)
 N RXIEN,RXFILL
"RTN","BPSECMP2",150,0)
 ;
"RTN","BPSECMP2",151,0)
 ; Check Parameter
"RTN","BPSECMP2",152,0)
 I IEN59="" Q
"RTN","BPSECMP2",153,0)
 ;
"RTN","BPSECMP2",154,0)
 ; Get Prescription and Fill number
"RTN","BPSECMP2",155,0)
 S RXIEN=$$GET1^DIQ(9002313.59,IEN59_",",1.11,"I")
"RTN","BPSECMP2",156,0)
 S RXFILL=$$GET1^DIQ(9002313.59902,"1,"_IEN59_",",902.17,"E")
"RTN","BPSECMP2",157,0)
 I RXIEN=""!(RXFILL="") Q
"RTN","BPSECMP2",158,0)
 ;
"RTN","BPSECMP2",159,0)
 ; Call PSO to sync reject codes
"RTN","BPSECMP2",160,0)
 D SYNC^PSOREJUT(RXIEN,RXFILL,"")
"RTN","BPSECMP2",161,0)
 Q
"RTN","BPSECMP2",162,0)
 ;
"RTN","BPSECMP2",163,0)
PROCOTH ;
"RTN","BPSECMP2",164,0)
 Q:$G(FDATA(TRANSACT,563.01,1))=""
"RTN","BPSECMP2",165,0)
 N NNDX,FILE,ROOT,FDATA3,FLDNUM
"RTN","BPSECMP2",166,0)
 S FILE="9002313.1401"
"RTN","BPSECMP2",167,0)
 S ROOT="FDATA3(9002313.1401)"
"RTN","BPSECMP2",168,0)
 S NNDX=""
"RTN","BPSECMP2",169,0)
 F  S NNDX=$O(FDATA(FDAIEN(TRANSACT),563.01,NNDX)) Q:NNDX=""  D
"RTN","BPSECMP2",170,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,563.01,NNDX),ROOT)
"RTN","BPSECMP2",171,0)
 D UPDATE^DIE("S","FDATA3(9002313.1401)")
"RTN","BPSECMP2",172,0)
 Q
"RTN","BPSECMP2",173,0)
PROCDUR ;
"RTN","BPSECMP2",174,0)
 Q:$G(FDATA(TRANSACT,567,1))=""
"RTN","BPSECMP2",175,0)
 N NNDX,FILE,ROOT,FDAT1101,FLDNUM
"RTN","BPSECMP2",176,0)
 S FILE="9002313.1101"
"RTN","BPSECMP2",177,0)
 S ROOT="FDAT1101(9002313.1101)"
"RTN","BPSECMP2",178,0)
 S NNDX=""
"RTN","BPSECMP2",179,0)
 F  S NNDX=$O(FDATA(TRANSACT,567,NNDX)) Q:NNDX=""  D
"RTN","BPSECMP2",180,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,567,NNDX),ROOT)
"RTN","BPSECMP2",181,0)
 .I $D(FDATA(TRANSACT,439,NNDX))  D
"RTN","BPSECMP2",182,0)
 ..S FLDNUM="439"
"RTN","BPSECMP2",183,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,439,NNDX),ROOT)
"RTN","BPSECMP2",184,0)
 .I $D(FDATA(TRANSACT,528,NNDX))  D
"RTN","BPSECMP2",185,0)
 ..S FLDNUM="528"
"RTN","BPSECMP2",186,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,528,NNDX),ROOT)
"RTN","BPSECMP2",187,0)
 .I $D(FDATA(TRANSACT,529,NNDX))  D
"RTN","BPSECMP2",188,0)
 ..S FLDNUM="529"
"RTN","BPSECMP2",189,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,529,NNDX),ROOT)
"RTN","BPSECMP2",190,0)
 .I $D(FDATA(TRANSACT,530,NNDX))  D
"RTN","BPSECMP2",191,0)
 ..S FLDNUM="530"
"RTN","BPSECMP2",192,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,530,NNDX),ROOT)
"RTN","BPSECMP2",193,0)
 .I $D(FDATA(TRANSACT,531,NNDX))  D
"RTN","BPSECMP2",194,0)
 ..S FLDNUM="531"
"RTN","BPSECMP2",195,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,531,NNDX),ROOT)
"RTN","BPSECMP2",196,0)
 .I $D(FDATA(TRANSACT,532,NNDX))  D
"RTN","BPSECMP2",197,0)
 ..S FLDNUM="532"
"RTN","BPSECMP2",198,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,532,NNDX),ROOT)
"RTN","BPSECMP2",199,0)
 .I $D(FDATA(TRANSACT,533,NNDX))  D
"RTN","BPSECMP2",200,0)
 ..S FLDNUM="533"
"RTN","BPSECMP2",201,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,533,NNDX),ROOT)
"RTN","BPSECMP2",202,0)
 .I $D(FDATA(TRANSACT,544,NNDX)) D
"RTN","BPSECMP2",203,0)
 ..S FLDNUM="544"
"RTN","BPSECMP2",204,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,544,NNDX),ROOT)
"RTN","BPSECMP2",205,0)
 D UPDATE^DIE("S","FDAT1101(9002313.1101)")
"RTN","BPSECMP2",206,0)
 Q
"RTN","BPSECMPS")
0^11^B68357125
"RTN","BPSECMPS",1,0)
BPSECMPS ;BHAM ISC/FCS/DRS - Parse Claim Response ;06/15/2004
"RTN","BPSECMPS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECMPS",3,0)
 ;Reference to ^PSDRUG supported by DBIA 221
"RTN","BPSECMPS",4,0)
 ;
"RTN","BPSECMPS",5,0)
PARSE(RREC,CLAIMIEN,RESPIEN) ;
"RTN","BPSECMPS",6,0)
 N GS,FS,SS,FILE,ROOT,TRANSACT,TRANSCNT
"RTN","BPSECMPS",7,0)
 N FDATA,FDAIEN,FDAIEN03
"RTN","BPSECMPS",8,0)
 ;
"RTN","BPSECMPS",9,0)
 ;Make sure input variables are defined
"RTN","BPSECMPS",10,0)
 Q:$G(RREC)=""
"RTN","BPSECMPS",11,0)
 Q:$G(CLAIMIEN)=""
"RTN","BPSECMPS",12,0)
 ;
"RTN","BPSECMPS",13,0)
 ;group and field separator characters
"RTN","BPSECMPS",14,0)
 S GS="\X1D\",FS="\X1C\",SS="\X1E\"
"RTN","BPSECMPS",15,0)
 S FILE="9002313.03"
"RTN","BPSECMPS",16,0)
 S ROOT="FDATA(9002313.03)"
"RTN","BPSECMPS",17,0)
 D TRANSMSN            ;process the transmission level data
"RTN","BPSECMPS",18,0)
 D TRANSACT            ;process the transaction level data
"RTN","BPSECMPS",19,0)
 ;
"RTN","BPSECMPS",20,0)
 ; If the test payer routine exists, call the override routine
"RTN","BPSECMPS",21,0)
 ; IEN59 and TRANTYPE are set in BPSECMC2
"RTN","BPSECMPS",22,0)
 ; Commented for production.  MUST be commented out for any release.
"RTN","BPSECMPS",23,0)
 ;I $L($T(CHECK^ZZGIZOV1))>0,$$CHECK^ZZGIZOV1 D SETOVER^ZZGIZOV1(IEN59,TRANTYPE,.FDATA)
"RTN","BPSECMPS",24,0)
 D UPDATE^DIE("S","FDATA(9002313.03)","FDAIEN")
"RTN","BPSECMPS",25,0)
 F TRANSACT=1:1:TRANSCNT  D
"RTN","BPSECMPS",26,0)
 .D PROCRESP
"RTN","BPSECMPS",27,0)
 .D PROCREJ
"RTN","BPSECMPS",28,0)
 .D PROCAPP
"RTN","BPSECMPS",29,0)
 .D PROCPPR
"RTN","BPSECMPS",30,0)
 .D PROCOTH^BPSECMP2
"RTN","BPSECMPS",31,0)
 .D PROCDUR^BPSECMP2
"RTN","BPSECMPS",32,0)
 .S RESPIEN=FDAIEN(TRANSACT)
"RTN","BPSECMPS",33,0)
 .D IBSEND^BPSECMP2(CLAIMIEN,RESPIEN,"","")
"RTN","BPSECMPS",34,0)
 Q
"RTN","BPSECMPS",35,0)
 ;
"RTN","BPSECMPS",36,0)
TRANSMSN ;This subroutine will work through the transmission level information
"RTN","BPSECMPS",37,0)
 ;
"RTN","BPSECMPS",38,0)
 N RTRANM,RHEADER,SEG,SEGMENT,SEGID
"RTN","BPSECMPS",39,0)
 ;
"RTN","BPSECMPS",40,0)
 ;Parse response transmission level from ascii record
"RTN","BPSECMPS",41,0)
 S RTRANM=$P(RREC,GS,1)
"RTN","BPSECMPS",42,0)
 ;
"RTN","BPSECMPS",43,0)
 ; get just the header segment 
"RTN","BPSECMPS",44,0)
 S RHEADER=$P(RTRANM,SS,1)    ;header- required/fixed length
"RTN","BPSECMPS",45,0)
 D PARSEH
"RTN","BPSECMPS",46,0)
 ;
"RTN","BPSECMPS",47,0)
 ; There are 2 optional segments on the transmission level - message
"RTN","BPSECMPS",48,0)
 ; and insurance.  We'll check for both and parse what we find.
"RTN","BPSECMPS",49,0)
 F SEG=2:1:3 D
"RTN","BPSECMPS",50,0)
 . S SEGMENT=$P(RTRANM,SS,SEG)
"RTN","BPSECMPS",51,0)
 . Q:SEGMENT=""
"RTN","BPSECMPS",52,0)
 . S SEGID=$P(SEGMENT,FS,2)
"RTN","BPSECMPS",53,0)
 . I $E(SEGID,1,2)="AM" D                ;segment identification
"RTN","BPSECMPS",54,0)
 .. S SEGFID=$E(SEGID,3,4)
"RTN","BPSECMPS",55,0)
 .. D:(SEGFID=20)!(SEGFID=25) PARSETM
"RTN","BPSECMPS",56,0)
 ;
"RTN","BPSECMPS",57,0)
 Q
"RTN","BPSECMPS",58,0)
 ;
"RTN","BPSECMPS",59,0)
TRANSACT ;This subroutine will work through the transaction level information
"RTN","BPSECMPS",60,0)
 ;
"RTN","BPSECMPS",61,0)
 N RTRAN,SEG,SEGMENT,MEDN,GRP
"RTN","BPSECMPS",62,0)
 S MEDN=0
"RTN","BPSECMPS",63,0)
 ;
"RTN","BPSECMPS",64,0)
 F GRP=2:1 D  Q:RTRAN=""
"RTN","BPSECMPS",65,0)
 . S RTRAN=$P(RREC,GS,GRP)     ;get the next transaction (could be 4)
"RTN","BPSECMPS",66,0)
 . Q:RTRAN=""                  ;we're done if it's empty
"RTN","BPSECMPS",67,0)
 . S MEDN=MEDN+1               ;transaction counter
"RTN","BPSECMPS",68,0)
 . ;
"RTN","BPSECMPS",69,0)
 . F SEG=2:1 D  Q:SEGMENT=""   ;break the record down by segments
"RTN","BPSECMPS",70,0)
 .. S SEGMENT=$P(RTRAN,SS,SEG) ;get the segment
"RTN","BPSECMPS",71,0)
 .. Q:SEGMENT=""
"RTN","BPSECMPS",72,0)
 .. D PARSETN                  ;get the fields
"RTN","BPSECMPS",73,0)
 Q
"RTN","BPSECMPS",74,0)
 ;
"RTN","BPSECMPS",75,0)
PARSEH ; The header record is required on all responses, and is fixed 
"RTN","BPSECMPS",76,0)
 ; length.  It is the only record that is fixed length.
"RTN","BPSECMPS",77,0)
 ;
"RTN","BPSECMPS",78,0)
 N FIELD,%,%H,%I
"RTN","BPSECMPS",79,0)
 S FIELD=".01" D FDA^DILF(FILE,"+1",FIELD,"",CLAIMIEN,ROOT)
"RTN","BPSECMPS",80,0)
 D NOW^%DTC
"RTN","BPSECMPS",81,0)
 S FIELD=".02" D FDA^DILF(FILE,"+1",FIELD,"",%,ROOT)
"RTN","BPSECMPS",82,0)
 S FIELD=".03" D FDA^DILF(FILE,"+1",FIELD,"",$H,ROOT)
"RTN","BPSECMPS",83,0)
 S FIELD=102 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,30,31),ROOT)    ;version/release number
"RTN","BPSECMPS",84,0)
 S FIELD=103 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,32,33),ROOT)    ;transaction code
"RTN","BPSECMPS",85,0)
 S FIELD=109 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,34,34),ROOT)        ;transaction count
"RTN","BPSECMPS",86,0)
 S TRANSCNT=$E(RHEADER,34,34)
"RTN","BPSECMPS",87,0)
 S FIELD=501 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,35,35),ROOT)        ;response status header
"RTN","BPSECMPS",88,0)
 S FIELD=202 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,36,37),ROOT)                ;service provider id qualifier
"RTN","BPSECMPS",89,0)
 S FIELD=201 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,38,52),ROOT)        ;service provider id
"RTN","BPSECMPS",90,0)
 S FIELD=401 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,53,60),ROOT)        ;date of service
"RTN","BPSECMPS",91,0)
 Q
"RTN","BPSECMPS",92,0)
 ;
"RTN","BPSECMPS",93,0)
PARSETM ; This subroutine will parse the variable portions of the transmission 
"RTN","BPSECMPS",94,0)
 ;
"RTN","BPSECMPS",95,0)
 N FIELD,PC,FLDNUM
"RTN","BPSECMPS",96,0)
 ;
"RTN","BPSECMPS",97,0)
 F PC=3:1 D  Q:FIELD=""        ;skip the seg id -already know its value 
"RTN","BPSECMPS",98,0)
 . S FIELD=$P(SEGMENT,FS,PC)   ;piece through the record
"RTN","BPSECMPS",99,0)
 . Q:FIELD=""                  ;stop - we hit the end
"RTN","BPSECMPS",100,0)
 . S FLDNUM=$$GETNUM(FIELD)    ;get the field number used for storage
"RTN","BPSECMPS",101,0)
 . Q:FLDNUM=""                 ;shouldn't happen - but lets skip
"RTN","BPSECMPS",102,0)
 . S FIELD=$E(FIELD,3,999)
"RTN","BPSECMPS",103,0)
 . D FDA^DILF(FILE,"+1",FLDNUM,"",FIELD,ROOT)
"RTN","BPSECMPS",104,0)
 Q
"RTN","BPSECMPS",105,0)
 ; 
"RTN","BPSECMPS",106,0)
PARSETN ; This subroutine will parse the transaction level segments. For 
"RTN","BPSECMPS",107,0)
 ;
"RTN","BPSECMPS",108,0)
 ; Possible values of the SEGFID field:
"RTN","BPSECMPS",109,0)
 ;  21 = Response Status Segment
"RTN","BPSECMPS",110,0)
 ;  22 = Response Claim Segment
"RTN","BPSECMPS",111,0)
 ;  23 = Response Pricing Segment
"RTN","BPSECMPS",112,0)
 ;  24 = Response DUR/PPS Segment
"RTN","BPSECMPS",113,0)
 ;  26 = Response Prior Authorization Segment
"RTN","BPSECMPS",114,0)
 ;
"RTN","BPSECMPS",115,0)
 N FIELD,PC,FLDNUM,RPTFLD,RCNT,REPEAT
"RTN","BPSECMPS",116,0)
 N SEGID,SEGFID,CKRPT
"RTN","BPSECMPS",117,0)
 ;
"RTN","BPSECMPS",118,0)
 S RPTFLD=""
"RTN","BPSECMPS",119,0)
 S SEGID=$P(SEGMENT,FS,2)           ;this should be the segment id
"RTN","BPSECMPS",120,0)
 Q:SEGID=""                         ;don't process without a Seg id
"RTN","BPSECMPS",121,0)
 Q:$E(SEGID,1,2)'="AM"              ;don't know what we have - skip
"RTN","BPSECMPS",122,0)
 ;
"RTN","BPSECMPS",123,0)
 S SEGFID=$E(SEGID,3,4)             ;this should be the field ID
"RTN","BPSECMPS",124,0)
 ;
"RTN","BPSECMPS",125,0)
 ; setup the repeating flds based on the segment
"RTN","BPSECMPS",126,0)
 I SEGFID=21 D               ;status segment
"RTN","BPSECMPS",127,0)
 . S RPTFLD=",548,511,546,"
"RTN","BPSECMPS",128,0)
 . S (RCNT(548),RCNT(511),RCNT(546))=0
"RTN","BPSECMPS",129,0)
 ;
"RTN","BPSECMPS",130,0)
 I SEGFID=22 D                 ;claim segment
"RTN","BPSECMPS",131,0)
 . S RPTFLD=",552,553,554,555,556,"
"RTN","BPSECMPS",132,0)
 . S (RCNT(552),RCNT(553),RCNT(554),RCNT(555),RCNT(556))=0
"RTN","BPSECMPS",133,0)
 ;
"RTN","BPSECMPS",134,0)
 I SEGFID=23 D                ;pricing segment
"RTN","BPSECMPS",135,0)
 . S RPTFLD=",564,565,"
"RTN","BPSECMPS",136,0)
 . S (RCNT(564),RCNT(565))=0
"RTN","BPSECMPS",137,0)
 ;
"RTN","BPSECMPS",138,0)
 I SEGFID=24 D                ;DUR/PPS segment
"RTN","BPSECMPS",139,0)
 . S RPTFLD=",439,528,529,530,531,532,533,9002313,544,567,"
"RTN","BPSECMPS",140,0)
 . S (RCNT(439),RCNT(528),RCNT(529),RCNT(530),RCNT(531))=0
"RTN","BPSECMPS",141,0)
 . S (RCNT(532),RCNT(533),RCNT(9002313),RCNT(567))=0,RCNT(544)=0
"RTN","BPSECMPS",142,0)
 ;
"RTN","BPSECMPS",143,0)
 ; now lets parse out the fields
"RTN","BPSECMPS",144,0)
 ;
"RTN","BPSECMPS",145,0)
 F PC=3:1 D  Q:FIELD=""        ;skip the seg id -jump to the other flds
"RTN","BPSECMPS",146,0)
 . S FIELD=$P(SEGMENT,FS,PC)   ;piece through the record
"RTN","BPSECMPS",147,0)
 . Q:FIELD=""                  ;stop - we hit the end
"RTN","BPSECMPS",148,0)
 . S FLDNUM=$$GETNUM(FIELD)    ;get the field number used for storage
"RTN","BPSECMPS",149,0)
 . ;
"RTN","BPSECMPS",150,0)
 . S REPEAT=0                  ;for this segment, lets figure
"RTN","BPSECMPS",151,0)
 . S CKRPT=","_FLDNUM_","      ;out if the field is a repeating
"RTN","BPSECMPS",152,0)
 . S:RPTFLD[CKRPT REPEAT=1     ;field
"RTN","BPSECMPS",153,0)
 . ;
"RTN","BPSECMPS",154,0)
 . I REPEAT D                  ;if rptg, store with a counter
"RTN","BPSECMPS",155,0)
 .. S RCNT(FLDNUM)=$G(RCNT(FLDNUM))+1
"RTN","BPSECMPS",156,0)
 .. S FDATA(MEDN,FLDNUM,RCNT(FLDNUM))=$E(FIELD,3,$L(FIELD))
"RTN","BPSECMPS",157,0)
 . ;
"RTN","BPSECMPS",158,0)
 . I 'REPEAT D                 ;not rptg, store without counter
"RTN","BPSECMPS",159,0)
 .. S FDATA(MEDN,FLDNUM)=$E(FIELD,3,$L(FIELD))
"RTN","BPSECMPS",160,0)
 Q
"RTN","BPSECMPS",161,0)
 ;
"RTN","BPSECMPS",162,0)
GETNUM(FIELD) ; This routine will translate the field ID into a field number.    
"RTN","BPSECMPS",163,0)
 ; We will use the NCPDP field Defs files, cross ref "D" to
"RTN","BPSECMPS",164,0)
 ; perform this translation.  (The field number is needed to store
"RTN","BPSECMPS",165,0)
 ; the data in the correct field within the response file.)
"RTN","BPSECMPS",166,0)
 ;
"RTN","BPSECMPS",167,0)
 N FLDID,FLDIEN,FLDNUM
"RTN","BPSECMPS",168,0)
 S (FLDID,FLDNUM)=""
"RTN","BPSECMPS",169,0)
 S FLDIEN=0
"RTN","BPSECMPS",170,0)
 ;
"RTN","BPSECMPS",171,0)
 S FLDID=$E(FIELD,1,2)       ;field identifier
"RTN","BPSECMPS",172,0)
 Q:FLDID=""
"RTN","BPSECMPS",173,0)
 ;
"RTN","BPSECMPS",174,0)
 I FLDID'="" D
"RTN","BPSECMPS",175,0)
 . S FLDIEN=$O(^BPSF(9002313.91,"D",FLDID,FLDIEN))  ;internal fld #
"RTN","BPSECMPS",176,0)
 . S:FLDIEN FLDNUM=$P($G(^BPSF(9002313.91,FLDIEN,0)),U) ;fld number
"RTN","BPSECMPS",177,0)
 Q FLDNUM
"RTN","BPSECMPS",178,0)
 ;
"RTN","BPSECMPS",179,0)
PROCRESP ;
"RTN","BPSECMPS",180,0)
 N FILE,ROOT,FDATA03,FLDNUM,FIELD
"RTN","BPSECMPS",181,0)
 S FILE="9002313.0301"
"RTN","BPSECMPS",182,0)
 S ROOT="FDATA03(9002313.0301)"
"RTN","BPSECMPS",183,0)
 K FDATA03
"RTN","BPSECMPS",184,0)
 I '$D(FDATA(TRANSACT,501)) S FDATA(TRANSACT,501)=FDATA(TRANSACT,112)
"RTN","BPSECMPS",185,0)
 I '$D(FDATA(TRANSACT,112)) S FDATA(TRANSACT,112)=FDATA(TRANSACT,501)
"RTN","BPSECMPS",186,0)
 S FLDNUM=".01" D FDA^DILF(FILE,"+1,"_FDAIEN(TRANSACT),FLDNUM,"",TRANSACT,ROOT)
"RTN","BPSECMPS",187,0)
 S FIELD=""
"RTN","BPSECMPS",188,0)
 F  S FIELD=$O(FDATA(TRANSACT,FIELD)) Q:FIELD=""  D   ;set all the non-repeating fields for 9002313.0301
"RTN","BPSECMPS",189,0)
 .I $G(FDATA(TRANSACT,FIELD))'=""  D
"RTN","BPSECMPS",190,0)
 ..I FIELD=402 S FDATA(TRANSACT,FIELD)=$TR(FDATA(TRANSACT,FIELD),"\","") ;REMOVE EXTRANEOUS "\"
"RTN","BPSECMPS",191,0)
 ..D FDA^DILF(FILE,"+"_TRANSACT_","_FDAIEN(TRANSACT),FIELD,"",FDATA(TRANSACT,FIELD),ROOT)
"RTN","BPSECMPS",192,0)
 .E  D
"RTN","BPSECMPS",193,0)
 ..;
"RTN","BPSECMPS",194,0)
 D UPDATE^DIE("S","FDATA03(9002313.0301)","FDAIEN03")
"RTN","BPSECMPS",195,0)
 Q
"RTN","BPSECMPS",196,0)
 ;
"RTN","BPSECMPS",197,0)
PROCREJ ;
"RTN","BPSECMPS",198,0)
 Q:$G(FDATA(TRANSACT,510))=""
"RTN","BPSECMPS",199,0)
 N FILE,ROOT,FLDNUM,FDAT3511,NUMREJS,NNDX
"RTN","BPSECMPS",200,0)
 S FILE="9002313.03511"
"RTN","BPSECMPS",201,0)
 S ROOT="FDAT3511(9002313.03511)"
"RTN","BPSECMPS",202,0)
 S NUMREJS=FDATA(TRANSACT,510)
"RTN","BPSECMPS",203,0)
 S NNDX=""
"RTN","BPSECMPS",204,0)
 F  S NNDX=$O(FDATA(TRANSACT,511,NNDX)) Q:NNDX=""  D   ;set all the non-repeating fields for 9002313.3511 rejections
"RTN","BPSECMPS",205,0)
 .S FDATA(TRANSACT,511,NNDX)=$TR(FDATA(TRANSACT,511,NNDX),"\","")
"RTN","BPSECMPS",206,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,511,NNDX),ROOT)
"RTN","BPSECMPS",207,0)
 D UPDATE^DIE("S","FDAT3511(9002313.03511)")
"RTN","BPSECMPS",208,0)
 Q
"RTN","BPSECMPS",209,0)
 ;
"RTN","BPSECMPS",210,0)
PROCAPP ;
"RTN","BPSECMPS",211,0)
 Q:$G(FDATA(TRANSACT,548,1))=""
"RTN","BPSECMPS",212,0)
 N FILE,ROOT,FLDNUM,FDAT1548,NNDX
"RTN","BPSECMPS",213,0)
 S FILE="9002313.301548"
"RTN","BPSECMPS",214,0)
 S ROOT="FDAT1548(9002313.0301548)"
"RTN","BPSECMPS",215,0)
 S NNDX=""
"RTN","BPSECMPS",216,0)
 F  S NNDX=$O(FDATA(FDAIEN(TRANSACT),548,NNDX)) Q:NNDX=""  D
"RTN","BPSECMPS",217,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,548,NNDX),ROOT)
"RTN","BPSECMPS",218,0)
 D UPDATE^DIE("S","FDAT1548(9002313.301548)")
"RTN","BPSECMPS",219,0)
 Q
"RTN","BPSECMPS",220,0)
 ;
"RTN","BPSECMPS",221,0)
PROCPPR ;
"RTN","BPSECMPS",222,0)
 Q:$G(FDATA(TRANSACT,551.01,1))=""
"RTN","BPSECMPS",223,0)
 N FILE,ROOT,FLDNUM,FDAT1301,NNDX
"RTN","BPSECMPS",224,0)
 S FILE="9002313.1301"
"RTN","BPSECMPS",225,0)
 S ROOT="FDAT1301(9002313.1301)"
"RTN","BPSECMPS",226,0)
 S NNDX=""
"RTN","BPSECMPS",227,0)
 F  S NNDX=$O(FDATA(FDAIEN(TRANSACT),551.01,NNDX)) Q:NNDX=""  D
"RTN","BPSECMPS",228,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,551.01,NNDX),ROOT)
"RTN","BPSECMPS",229,0)
 D UPDATE^DIE("S","FDAT1301(9002313.1301)")
"RTN","BPSECMPS",230,0)
 Q
"RTN","BPSECP0")
1^12
"RTN","BPSECP1")
0^13^B44213854
"RTN","BPSECP1",1,0)
BPSECP1 ;BHAM ISC/FCS/DRS/VA/DLF - printing for PCS ;05/17/2004
"RTN","BPSECP1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECP1",3,0)
 ;
"RTN","BPSECP1",4,0)
 ;---------------------------------
"RTN","BPSECP1",5,0)
 ;IHS/SD/lwj 10/08/02  NCPDP 5.1 changes
"RTN","BPSECP1",6,0)
 ; With 5.1 the segments, fields, and field identifiers changed.
"RTN","BPSECP1",7,0)
 ; This routine had to be adjusted to account for the differences
"RTN","BPSECP1",8,0)
 ; between a 5.1 and 3.2 claims.  Changes made where needed.
"RTN","BPSECP1",9,0)
 ;---------------------------------
"RTN","BPSECP1",10,0)
 ;
"RTN","BPSECP1",11,0)
 Q
"RTN","BPSECP1",12,0)
TEST ;
"RTN","BPSECP1",13,0)
 K TMP D FILEMAN("TMP",255)
"RTN","BPSECP1",14,0)
 Q
"RTN","BPSECP1",15,0)
FILEMAN(DEST,IEN,FIELDS,RX,RXFIELDS)     ;EP - from BPSECP0 and BPSOS6E
"RTN","BPSECP1",16,0)
 ; generalized FileMan fetch for pharm e-claims and responses
"RTN","BPSECP1",17,0)
 ; DEST = destination (closed ref, used in @DEST@(subs) format)
"RTN","BPSECP1",18,0)
 ;   if global, it must be ^TMP or ^UTILITY
"RTN","BPSECP1",19,0)
 ; FILE = file number (9002313.02 or 9002313.03)
"RTN","BPSECP1",20,0)
 ; IEN as usual;  FIELDS = the DR string of field numbers
"RTN","BPSECP1",21,0)
 ; RX = prescription sub-entry; RXFIELDS = the DR string for it
"RTN","BPSECP1",22,0)
 ; FIELDS, RX, RXFIELDS optional; they default to all RXs,all fields
"RTN","BPSECP1",23,0)
 ; Returns @DEST@("C",field)=value    for fields in the claim
"RTN","BPSECP1",24,0)
 ;         @DEST@("C",field,"RX",rx,field)=value
"RTN","BPSECP1",25,0)
 ;         @DEST@("R" similarly
"RTN","BPSECP1",26,0)
 ;    where "field" is field name (not field number)
"RTN","BPSECP1",27,0)
 K ^UTILITY("DIQ1",$J)
"RTN","BPSECP1",28,0)
 N FILE S FILE=9002313.02 D FM1
"RTN","BPSECP1",29,0)
 S FILE=9002313.03,IEN=$O(^BPSR("B",IEN,""),-1) ; last resp
"RTN","BPSECP1",30,0)
 I IEN D
"RTN","BPSECP1",31,0)
 .D FM1
"RTN","BPSECP1",32,0)
 D FORMAT
"RTN","BPSECP1",33,0)
 K ^UTILITY("DIQ1",$J)
"RTN","BPSECP1",34,0)
 Q
"RTN","BPSECP1",35,0)
FORMAT ; ^UTILITY("DIQ1",$J,file,DA,field,*)->@TMP@(...)
"RTN","BPSECP1",36,0)
 ;------------------------
"RTN","BPSECP1",37,0)
 ;IHS/SD/lwj 10/08/02  NCPDP 5.1 changes
"RTN","BPSECP1",38,0)
 ; added the NCPDP field to decipher the version - this will help
"RTN","BPSECP1",39,0)
 ; in the data translation
"RTN","BPSECP1",40,0)
 ;-------------------------
"RTN","BPSECP1",41,0)
 N SRC S SRC="^UTILITY(""DIQ1"",$J)"
"RTN","BPSECP1",42,0)
 N EFORMAT,INSURER,FILE,DA,FIELD
"RTN","BPSECP1",43,0)
 N NCPDP51               ;IHS/SD/lwj 10/08/02  NCPDP 5.1 change
"RTN","BPSECP1",44,0)
 S NCPDP51=0             ;IHS/SD/lwj 10/08/02  NCPDP 5.1 change
"RTN","BPSECP1",45,0)
 S DA=$O(@SRC@(9002313.02,0))
"RTN","BPSECP1",46,0)
 S INSURER=$G(@SRC@(9002313.02,DA,.02,"I"))
"RTN","BPSECP1",47,0)
 ;CHECK SITE TYPE 0 IS VA, 1 IS IHS, SET INSURER ACCORDINGLY  DLF 7/29/2003
"RTN","BPSECP1",48,0)
 ;
"RTN","BPSECP1",49,0)
 I ^BPS(9002313.99,1,"SITE TYPE")=0,INSURER S EFORMAT=INSURER
"RTN","BPSECP1",50,0)
 I ^BPS(9002313.99,1,"SITE TYPE")=1,INSURER S EFORMAT=$P($G(^BPSEI(INSURER,100)),U)
"RTN","BPSECP1",51,0)
 E  S EFORMAT=0
"RTN","BPSECP1",52,0)
 I 'EFORMAT W "Internal error - no FORMAT for INSURER=",INSURER,! Q
"RTN","BPSECP1",53,0)
 ;
"RTN","BPSECP1",54,0)
 S:$G(@SRC@(9002313.02,DA,102,"I"))=51 NCPDP51=1
"RTN","BPSECP1",55,0)
 ;
"RTN","BPSECP1",56,0)
 S FILE="" F  S FILE=$O(@SRC@(FILE)) Q:'FILE  D
"RTN","BPSECP1",57,0)
 .S DA=""  F  S DA=$O(@SRC@(FILE,DA)) Q:'DA  D
"RTN","BPSECP1",58,0)
 ..N FIELD S FIELD="" F  S FIELD=$O(@SRC@(FILE,DA,FIELD)) Q:'FIELD  D
"RTN","BPSECP1",59,0)
 ...I EFORMAT,'$$INCLUDE(EFORMAT,FILE,FIELD) D  Q
"RTN","BPSECP1",60,0)
 ...D FMTFIELD
"RTN","BPSECP1",61,0)
 Q
"RTN","BPSECP1",62,0)
INCLUDE(EFORMAT,FILE,FIELD)  ; is the field part of this protocol?
"RTN","BPSECP1",63,0)
 ; returns 1 or 10 or 20 or 30 or 40 maybe with ^ID appended
"RTN","BPSECP1",64,0)
 ;--------------------------------
"RTN","BPSECP1",65,0)
 ;IHS/SD/lwj 10/08/02   NCPDP 5.1 changes - need to include all
"RTN","BPSECP1",66,0)
 ; the new segments
"RTN","BPSECP1",67,0)
 ;
"RTN","BPSECP1",68,0)
 ;--------------------------------
"RTN","BPSECP1",69,0)
 ;
"RTN","BPSECP1",70,0)
 N START,END
"RTN","BPSECP1",71,0)
 S START=10,END=40
"RTN","BPSECP1",72,0)
 I NCPDP51 S START=100,END=230
"RTN","BPSECP1",73,0)
 ;
"RTN","BPSECP1",74,0)
 I FILE=9002313.03 Q 1 ; always yes for response fields
"RTN","BPSECP1",75,0)
 I FILE=9002313.0301 Q 1 ; always yes for response fields
"RTN","BPSECP1",76,0)
 I FIELD<101!(FIELD>600) Q 1 ; yes for fields outside protocol range
"RTN","BPSECP1",77,0)
 N FIELDIEN S FIELDIEN=$O(^BPSF(9002313.91,"B",FIELD,0))
"RTN","BPSECP1",78,0)
 I FIELDIEN="" Q 0 ; should never happen?
"RTN","BPSECP1",79,0)
 ;
"RTN","BPSECP1",80,0)
 N I,FIND S FIND=0 F I=START:10:END D  Q:$G(FIND)
"RTN","BPSECP1",81,0)
 .N J S J=0
"RTN","BPSECP1",82,0)
 .F  S J=$O(^BPSF(9002313.92,EFORMAT,I,J)) Q:'J  D  Q:$G(FIND)
"RTN","BPSECP1",83,0)
 ..I $P(^BPSF(9002313.92,EFORMAT,I,J,0),U,2)=FIELDIEN D
"RTN","BPSECP1",84,0)
 ...S FIND=I
"RTN","BPSECP1",85,0)
 ...S FIND=FIND_U_$$FIELDID(FIELD)
"RTN","BPSECP1",86,0)
 Q FIND
"RTN","BPSECP1",87,0)
FIELDID(FIELD)     ; the two character field ID, given the external field #
"RTN","BPSECP1",88,0)
 ;--------------------------------------
"RTN","BPSECP1",89,0)
 ;IHS/SD/lwj 10/08/02  NCPDP 5.1 changes
"RTN","BPSECP1",90,0)
 ; With 5.1 all the fields will have a field identifier, except for the
"RTN","BPSECP1",91,0)
 ; header segment.  Must adjust this routine to account for that.
"RTN","BPSECP1",92,0)
 ; (NCPDP51 is defined in the FORMAT subroutine and is based on fld 102)
"RTN","BPSECP1",93,0)
 ;
"RTN","BPSECP1",94,0)
 ;--------------------------------------
"RTN","BPSECP1",95,0)
 N ID
"RTN","BPSECP1",96,0)
 N FIELDIEN S FIELDIEN=$O(^BPSF(9002313.91,"B",FIELD,0))
"RTN","BPSECP1",97,0)
 I FIELDIEN="" Q ""
"RTN","BPSECP1",98,0)
 ;
"RTN","BPSECP1",99,0)
 S:'NCPDP51 ID=$P(^BPSF(9002313.91,FIELDIEN,0),U,2)
"RTN","BPSECP1",100,0)
 S:NCPDP51 ID=$P($G(^BPSF(9002313.91,FIELDIEN,5)),U)
"RTN","BPSECP1",101,0)
 ;
"RTN","BPSECP1",102,0)
 Q ID
"RTN","BPSECP1",103,0)
 ;
"RTN","BPSECP1",104,0)
ISVARFLD(EFORMAT,FILE,FIELD) ; is it a variable length field?
"RTN","BPSECP1",105,0)
 ;---------------------------------
"RTN","BPSECP1",106,0)
 ;IHS/SD/lwj 10/08/02  NCPDP 5.1 changes
"RTN","BPSECP1",107,0)
 ; if we are working with a 5.1 format, and it's any segment other
"RTN","BPSECP1",108,0)
 ; than 100, return the field id.
"RTN","BPSECP1",109,0)
 ;---------------------------------
"RTN","BPSECP1",110,0)
 ; returns 2-char field ID if it is
"RTN","BPSECP1",111,0)
 N X S X=$$INCLUDE(EFORMAT,FILE,FIELD)
"RTN","BPSECP1",112,0)
 Q:(NCPDP51)&(X>100) $P(X,U,2)    ;IHS/SD/lwj 10/08/02 NCPDP 5.1
"RTN","BPSECP1",113,0)
 I +X=20!(+X=40) Q $P(X,U,2)
"RTN","BPSECP1",114,0)
 E  Q ""
"RTN","BPSECP1",115,0)
FMTFIELD ; given FILE,DA,FIELD,@SRC@(FILE,DA,FIELD,"E" and "I"), set @TMP
"RTN","BPSECP1",116,0)
 ; given INSURER and EFORMAT, too
"RTN","BPSECP1",117,0)
 ; Fetch the INT and EXT values
"RTN","BPSECP1",118,0)
 ;-----------------------------------------
"RTN","BPSECP1",119,0)
 ;IHS/SD/lwj 10/08/02 NCPDP 5.1 changes
"RTN","BPSECP1",120,0)
 ; needed to format a couple of the newer field a little different
"RTN","BPSECP1",121,0)
 ;-----------------------------------------
"RTN","BPSECP1",122,0)
 ;
"RTN","BPSECP1",123,0)
 N INT S INT=$G(@SRC@(FILE,DA,FIELD,"I"))
"RTN","BPSECP1",124,0)
 N EXT S EXT=$G(@SRC@(FILE,DA,FIELD,"E"))
"RTN","BPSECP1",125,0)
 ; If it's a variable field, remove the field ID
"RTN","BPSECP1",126,0)
 N VARFIELD
"RTN","BPSECP1",127,0)
 ;
"RTN","BPSECP1",128,0)
 ;IHS/SD/lwj 10/08/02 NCPDP 5.1 fields need more formatting
"RTN","BPSECP1",129,0)
 N CKFLD,FLDLST
"RTN","BPSECP1",130,0)
 S FLDLST=",409,448,449,477,480,481,482,483,487,558,562,566,"
"RTN","BPSECP1",131,0)
 ;
"RTN","BPSECP1",132,0)
 I FIELD=524 S VARFIELD="FO"  ; have to hardcode response cases
"RTN","BPSECP1",133,0)
 E  S VARFIELD=$$ISVARFLD(EFORMAT,FILE,FIELD)
"RTN","BPSECP1",134,0)
 I VARFIELD]"" D
"RTN","BPSECP1",135,0)
 .I $E(INT,1,2)=VARFIELD S INT=$E(INT,3,$L(INT))
"RTN","BPSECP1",136,0)
 .I $E(EXT,1,2)=VARFIELD S EXT=$E(EXT,3,$L(EXT))
"RTN","BPSECP1",137,0)
 ; Trailing spaces, leading zeroes
"RTN","BPSECP1",138,0)
 F  Q:$E(EXT,$L(EXT))'=" "  S EXT=$E(EXT,1,$L(EXT)-1)
"RTN","BPSECP1",139,0)
 I FIELD'=407,FIELD'=302 D
"RTN","BPSECP1",140,0)
 .F  Q:$E(EXT)'=0  Q:$L(EXT)=1  S EXT=$E(EXT,2,$L(EXT))
"RTN","BPSECP1",141,0)
 I FIELD=426!(FIELD=430) D  ; for some reason they're missed
"RTN","BPSECP1",142,0)
 .S EXT="$"_$J($$DFF2EXT^BPSECFM(EXT),7,2)
"RTN","BPSECP1",143,0)
 ;
"RTN","BPSECP1",144,0)
 ;IHS/SD/lWJ 10/08/02 NCPDP 5.1 some more signed fields
"RTN","BPSECP1",145,0)
 S CKFLD=","_FIELD_","
"RTN","BPSECP1",146,0)
 S:FLDLST[CKFLD EXT="$"_$J($$DFF2EXT^BPSECFM(EXT),7,2)
"RTN","BPSECP1",147,0)
 ;
"RTN","BPSECP1",148,0)
 I FIELD=103 S EXT=$$TCODE^BPSECP2(EXT)
"RTN","BPSECP1",149,0)
 ; Get the field name
"RTN","BPSECP1",150,0)
 N FLDNAME S FLDNAME=$P(^DD(FILE,FIELD,0),U)
"RTN","BPSECP1",151,0)
 ; If it's a date field that didn't get formatted, format it
"RTN","BPSECP1",152,0)
 I FLDNAME["Date",EXT?8N D
"RTN","BPSECP1",153,0)
 .N Y S Y=EXT-17000000 X ^DD("DD") S EXT=Y
"RTN","BPSECP1",154,0)
 ; Other enumerated fields
"RTN","BPSECP1",155,0)
 ;IHS/SD/lwj 10/08/02 NCPDP 5.1 field now include "Patient"
"RTN","BPSECP1",156,0)
 I FLDNAME="Patient Relationship Code" D
"RTN","BPSECP1",157,0)
 .S EXT=$S(EXT=1:"Cardholder",EXT=2:"Spouse",EXT=3:"Child",EXT=4:"Other Dependent",1:EXT)
"RTN","BPSECP1",158,0)
 I FLDNAME="Compound Code" D
"RTN","BPSECP1",159,0)
 .S EXT=$S(EXT=1:"Not a compound",EXT=2:"Compound",1:EXT)
"RTN","BPSECP1",160,0)
 I FLDNAME="Dispense As Written" S EXT=$$DAW^BPSECP2(EXT)
"RTN","BPSECP1",161,0)
 I FLDNAME="Basis of Reimb Determination" S EXT=$$REIMB^BPSECP2(EXT)
"RTN","BPSECP1",162,0)
 ; Store it
"RTN","BPSECP1",163,0)
 I EXT="",'$$INCLUDE(EFORMAT,FILE,FIELD) Q
"RTN","BPSECP1",164,0)
 I FILE=9002313.02 D
"RTN","BPSECP1",165,0)
 .S @DEST@("C",FLDNAME)=EXT
"RTN","BPSECP1",166,0)
 E  I FILE=9002313.0201 D
"RTN","BPSECP1",167,0)
 .S @DEST@("C",FLDNAME,"RX",DA)=EXT
"RTN","BPSECP1",168,0)
 E  I FILE=9002313.03 D
"RTN","BPSECP1",169,0)
 .S @DEST@("R",FLDNAME)=EXT
"RTN","BPSECP1",170,0)
 E  I FILE=9002313.0301 D
"RTN","BPSECP1",171,0)
 .I FLDNAME="Additional Message Information" S FLDNAME="Message (more)"
"RTN","BPSECP1",172,0)
 .S @DEST@("R",FLDNAME,"RX",DA)=EXT
"RTN","BPSECP1",173,0)
 E  D IMPOSS^BPSOSUE("P","TI",,,"FMTFIELD",$T(+0))
"RTN","BPSECP1",174,0)
 Q
"RTN","BPSECP1",175,0)
FM1 N DIC,DR,DA,DIQ,SUBFILE
"RTN","BPSECP1",176,0)
 I '$D(FIELDS) S FIELDS=".01:99999999"
"RTN","BPSECP1",177,0)
 I '$D(RX)
"RTN","BPSECP1",178,0)
 I '$D(RXFIELDS) S RXFIELDS=".01:99999999"
"RTN","BPSECP1",179,0)
 ; Safety - make sure if DEST is global, it's probably a scratch global
"RTN","BPSECP1",180,0)
 I DEST?1"^".E I DEST'?1"^TMP("1E.E,DEST'?1"^UTILITY("1E.E D IMPOSS^BPSOSUE("P","TI","Bad DEST",DEST,"FM1",$T(+0))
"RTN","BPSECP1",181,0)
 D FETCH ; gives ^UTILITY("DIQ1",$J,file,DA,field,"E") and ^("I")
"RTN","BPSECP1",182,0)
 Q
"RTN","BPSECP1",183,0)
FETCH ;
"RTN","BPSECP1",184,0)
 I '$D(RX) N RX S RX=0 D  Q
"RTN","BPSECP1",185,0)
 .; RX not yet determined:  recurse
"RTN","BPSECP1",186,0)
 .N GLO S GLO="^BPS"_$S(FILE=9002313.02:"C",FILE=9002313.03:"R")
"RTN","BPSECP1",187,0)
 .N SUB S SUB=$S(FILE=9002313.02:400,FILE=9002313.03:1000)
"RTN","BPSECP1",188,0)
 .F  S RX=$O(@GLO@(FILE,IEN,SUB,RX)) Q:'RX  D
"RTN","BPSECP1",189,0)
 ..D 2
"RTN","BPSECP1",190,0)
2 ; with RX determined
"RTN","BPSECP1",191,0)
 I FILE=9002313.03 D  ; Reject Code(s) done manually
"RTN","BPSECP1",192,0)
 .N X S X=0 F  S X=$O(^BPSR(IEN,1000,RX,511,X)) Q:'X  D
"RTN","BPSECP1",193,0)
 ..N Y S Y=^BPSR(IEN,1000,RX,511,X,0),Y=$P(Y,U)
"RTN","BPSECP1",194,0)
 ..N Z S Z=$O(^BPSF(9002313.93,"B",Y,0))
"RTN","BPSECP1",195,0)
 ..I Z,$D(^BPSF(9002313.93,Z,0)) S Z=$P(^(0),U,2)
"RTN","BPSECP1",196,0)
 ..S @DEST@("R","Reject Code","RX",RX,$S(Y?1"0"1N:+Y,1:Y))=Y_" "_Z
"RTN","BPSECP1",197,0)
 S DIC=FILE,DA=IEN,DR=FIELDS,DIQ(0)="IEN"
"RTN","BPSECP1",198,0)
 S SUBFILE=FILE+.0001 ; as it happens to work out
"RTN","BPSECP1",199,0)
 S DA(SUBFILE)=RX
"RTN","BPSECP1",200,0)
 S DR(SUBFILE)=RXFIELDS
"RTN","BPSECP1",201,0)
 D EN^DIQ1
"RTN","BPSECP1",202,0)
 Q
"RTN","BPSECP2")
0^14^B12368584
"RTN","BPSECP2",1,0)
BPSECP2 ;BHAM ISC/FCS/DRS - Dictionary Code Translator ;05/17/2004
"RTN","BPSECP2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECP2",3,0)
 ;
"RTN","BPSECP2",4,0)
 ;---------------------------------
"RTN","BPSECP2",5,0)
 ;IHS/SD/lwj 10/09/02 NCPDP 5.1 changes
"RTN","BPSECP2",6,0)
 ; Needed to adjust the translation of the transaction code
"RTN","BPSECP2",7,0)
 ; to account for 5.1 values.
"RTN","BPSECP2",8,0)
 ;
"RTN","BPSECP2",9,0)
 ;---------------------------------
"RTN","BPSECP2",10,0)
 ;
"RTN","BPSECP2",11,0)
 Q
"RTN","BPSECP2",12,0)
 ; Lots of $$functions called from other BPSECP*
"RTN","BPSECP2",13,0)
 ; BPSOS6G calls $$DUR
"RTN","BPSECP2",14,0)
 ;
"RTN","BPSECP2",15,0)
DUR(X) ;EP - DUR code
"RTN","BPSECP2",16,0)
 I X="DA" Q "Drug-Allergy Alert"
"RTN","BPSECP2",17,0)
 I X="DC" Q "Drug-Disease Conflicts"
"RTN","BPSECP2",18,0)
 I X="DD" Q "Drug-Drug Interactions"
"RTN","BPSECP2",19,0)
 I X="ER" Q "Excessive Utilization"
"RTN","BPSECP2",20,0)
 I X="HD" Q "Excessive Drug Doses (Over Utilization)"
"RTN","BPSECP2",21,0)
 I X="ID" Q "Therapeutic Duplication (Same Ingredients)"
"RTN","BPSECP2",22,0)
 I X="LD" Q "Insufficient Drug Doses (Under Utilization)"
"RTN","BPSECP2",23,0)
 I X="LR" Q "Underuse Precaution (Non-compliance)"
"RTN","BPSECP2",24,0)
 I X="MC" Q "Drug Disease Alert (Drug/diagnosis matching)"
"RTN","BPSECP2",25,0)
 I X="MX" Q "Excessive Duration Alert"
"RTN","BPSECP2",26,0)
 I X="PA" Q "Drug-Age Conflicts"
"RTN","BPSECP2",27,0)
 I X="PG" Q "Drug-Pregnancy Conflicts"
"RTN","BPSECP2",28,0)
 I X="SX" Q "Drug-Gender Alert"
"RTN","BPSECP2",29,0)
 I X="TD" Q "Therapeutic Duplications (Same Drug Class)"
"RTN","BPSECP2",30,0)
DUR8 I X[" " S X=$P(X," ")_"<sp>"_$P(X," ",2,$L(X)) G DUR8
"RTN","BPSECP2",31,0)
 Q "DUR code "_X_" ? "
"RTN","BPSECP2",32,0)
OTHPHARM(X) ;EP - Other Pharmacy Indicator (within DUR data)
"RTN","BPSECP2",33,0)
 I X=1 Q "Same Pharmacy"
"RTN","BPSECP2",34,0)
 I X=2 Q "Different Pharmacy Same Chain"
"RTN","BPSECP2",35,0)
 I X=3 Q "Different Pharmacy Different Chain"
"RTN","BPSECP2",36,0)
 Q X
"RTN","BPSECP2",37,0)
OTHPRESC(X) ;EP - Other Prescriber (within DUR data)
"RTN","BPSECP2",38,0)
 I X=1 Q "Same Physician"
"RTN","BPSECP2",39,0)
 I X=2 Q "Different Physician"
"RTN","BPSECP2",40,0)
 Q X
"RTN","BPSECP2",41,0)
TCODE(X) ;EP - Transaction code
"RTN","BPSECP2",42,0)
 ;-----------------------------------------
"RTN","BPSECP2",43,0)
 ;IHS/SD/lwj 10/08/02 NCPDP 5.1 changes
"RTN","BPSECP2",44,0)
 ; For 5.1 the transaction code will be either B1 or B2
"RTN","BPSECP2",45,0)
 ;-----------------------------------------
"RTN","BPSECP2",46,0)
 I X'<1,X'>4 Q X_" prescription claim"_$S(X>1:"s",1:"")
"RTN","BPSECP2",47,0)
 I (X=11)!(X="B2") Q "Claim Reversal"  ;IHS/SD/lwj 10/09/02
"RTN","BPSECP2",48,0)
 I X="B1" Q X_" prescription claim"   ;IHS/SD/lwj 10/09/02
"RTN","BPSECP2",49,0)
 Q "Unknown transaction code "_X
"RTN","BPSECP2",50,0)
REIMB(X) ;EP - Basis of reimbursement
"RTN","BPSECP2",51,0)
 I +X=0 Q "Not specified"
"RTN","BPSECP2",52,0)
 I +X=1 Q "Ingredient cost paid as submitted"
"RTN","BPSECP2",53,0)
 I +X=2 Q "Ingredient cost reduced to AWP pricing"
"RTN","BPSECP2",54,0)
 I +X=3 Q "Ingredient cost reduced to AWP less %"
"RTN","BPSECP2",55,0)
 I +X=4 Q "Usual and Customary paid as submitted"
"RTN","BPSECP2",56,0)
 I +X=5 Q "Paid lower of ingredient cost plus fees versus usual and customary"
"RTN","BPSECP2",57,0)
 I +X=6 Q "MAC Pricing - Ingredient cost paid at MAC price"
"RTN","BPSECP2",58,0)
 I +X=7 Q "MAC Pricing - Ingredient cost reduced to MAC pricing"
"RTN","BPSECP2",59,0)
 I +X=8 Q "Contract Pricing"
"RTN","BPSECP2",60,0)
 Q X
"RTN","BPSECP2",61,0)
DAW(X) ;EP -
"RTN","BPSECP2",62,0)
 I X=0 Q "No product selection indicated."
"RTN","BPSECP2",63,0)
 I X=1 Q "Substitution not allowed by prescriber."
"RTN","BPSECP2",64,0)
 I X=2 Q "Substitution allowed - patient requested product dispensed."
"RTN","BPSECP2",65,0)
 I X=3 Q "Substitution allowed - pharmacist selected product dispensed."
"RTN","BPSECP2",66,0)
 I X=4 Q "Substitution allowed - generic not in stock."
"RTN","BPSECP2",67,0)
 I X=5 Q "Substitution allowed - brand dispensed as generic."
"RTN","BPSECP2",68,0)
 I X=6 Q "Override"
"RTN","BPSECP2",69,0)
 I X=7 Q "Substitution not allowed - brand drug mandated by law."
"RTN","BPSECP2",70,0)
 I X=8 Q "Substitution allowed - generic drug not available in marketplace."
"RTN","BPSECP2",71,0)
 I X=9 Q "Unspecified"
"RTN","BPSECP2",72,0)
 Q X
"RTN","BPSECP3")
1^15
"RTN","BPSECR0")
1^16
"RTN","BPSECR1")
1^17
"RTN","BPSECR2")
1^18
"RTN","BPSECX0")
0^19^B3953562
"RTN","BPSECX0",1,0)
BPSECX0 ;BHAM ISC/FCS/DRS/VA/DLF - Retrieve Claim submission record ;05/17/2004
"RTN","BPSECX0",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECX0",3,0)
 Q
"RTN","BPSECX0",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",5,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",6,0)
 ;Retrieve Claim submission record
"RTN","BPSECX0",7,0)
 ;
"RTN","BPSECX0",8,0)
 ;Input Variables:   CLAIMIEN -  Claim Submission IEN (9002313.02)
"RTN","BPSECX0",9,0)
 ;                   .BPS    -  Pass by reference, output only
"RTN","BPSECX0",10,0)
 ;
"RTN","BPSECX0",11,0)
 ;Output Variables:  BPS(9002313.02,CLAIMIEN,<field #>,"I")  = Value
"RTN","BPSECX0",12,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",13,0)
 ; IHS/SD/lwj  08/13/02  NCPDP 5.1 changes
"RTN","BPSECX0",14,0)
 ; Many fields that were once a part of the "header" of the claim
"RTN","BPSECX0",15,0)
 ; were shifted to appear on the "rx" or "detail" segments of the
"RTN","BPSECX0",16,0)
 ; claim in 5.1. Additionally, MANY new fields were added beyond 499. 
"RTN","BPSECX0",17,0)
 ; For these reasons, we had to change the GETBPS3
"RTN","BPSECX0",18,0)
 ; subroutine to pull fields 308 through 600 rather than just 
"RTN","BPSECX0",19,0)
 ; 402 - 499. The really cool thing is that because we are at the
"RTN","BPSECX0",20,0)
 ; subfile level, the duplicated fields (between header and rx)
"RTN","BPSECX0",21,0)
 ; will only pull at the appropriate level.  3.2 claims should
"RTN","BPSECX0",22,0)
 ; be unaffected by this change, as the adjusted and new fields
"RTN","BPSECX0",23,0)
 ; were not populated for 3.2
"RTN","BPSECX0",24,0)
 ;
"RTN","BPSECX0",25,0)
 ; New subroutine added GETBPS4 to pull out the repeating fields for
"RTN","BPSECX0",26,0)
 ; the DUR/PPS records
"RTN","BPSECX0",27,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",28,0)
 ; 
"RTN","BPSECX0",29,0)
GETBPS2(CLAIMIEN,BPS) ;EP - from BPSECA1 from BPSOSQH from BPSOSQG from BPSOSQ2
"RTN","BPSECX0",30,0)
 ;Manage local variables
"RTN","BPSECX0",31,0)
 N DIC,DR,DA,DIQ,D0,DIQ2
"RTN","BPSECX0",32,0)
 ;
"RTN","BPSECX0",33,0)
 ;Make sure input variables are defined
"RTN","BPSECX0",34,0)
 Q:$G(CLAIMIEN)=""
"RTN","BPSECX0",35,0)
 ;
"RTN","BPSECX0",36,0)
 ;Set input variables for FileMan data retrieval routine
"RTN","BPSECX0",37,0)
 ;IHS/SD/lwj 9/9/02  need to expand the field range to include
"RTN","BPSECX0",38,0)
 ; the "500" range fields now used in the header segments
"RTN","BPSECX0",39,0)
 ; for NCPDP 5.1
"RTN","BPSECX0",40,0)
 ;
"RTN","BPSECX0",41,0)
 S DIC=9002313.02
"RTN","BPSECX0",42,0)
 ; IHS/SD/lwj 9/9/02 NCPDP 5.1 changes
"RTN","BPSECX0",43,0)
 S DR="101:600"
"RTN","BPSECX0",44,0)
 S DA=CLAIMIEN
"RTN","BPSECX0",45,0)
 S DIQ="BPS",DIQ(0)="I"
"RTN","BPSECX0",46,0)
 ;
"RTN","BPSECX0",47,0)
 ;Execute data retrieval routine
"RTN","BPSECX0",48,0)
 D EN^DIQ1
"RTN","BPSECX0",49,0)
 Q
"RTN","BPSECX0",50,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",51,0)
 ;Retrieve Claim Submission, Prescription(s) multiple record
"RTN","BPSECX0",52,0)
 ;
"RTN","BPSECX0",53,0)
 ;Input Variables:   CLAIMIEN - Claim Submission IEN (9002313.02)
"RTN","BPSECX0",54,0)
 ;                   CRXIEN   - Prescription Multiple IEN (9002313.0201)
"RTN","BPSECX0",55,0)
 ;
"RTN","BPSECX0",56,0)
 ;Output Variables:  BPS(9002313.0201,CRXIEN,<field #>,"I") = Value
"RTN","BPSECX0",57,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",58,0)
GETBPS3(CLAIMIEN,CRXIEN,BPS) ;EP - from BPSECA1
"RTN","BPSECX0",59,0)
 ;Manage local variables
"RTN","BPSECX0",60,0)
 N DIC,DR,DA,DIQ,D0,DIQ2
"RTN","BPSECX0",61,0)
 ;
"RTN","BPSECX0",62,0)
 ;Make sure input variables are defined
"RTN","BPSECX0",63,0)
 Q:$G(CLAIMIEN)=""
"RTN","BPSECX0",64,0)
 Q:$G(CRXIEN)=""
"RTN","BPSECX0",65,0)
 ;
"RTN","BPSECX0",66,0)
 ;S input variables for FileMan data retrieval routine
"RTN","BPSECX0",67,0)
 S DIC=9002313.02
"RTN","BPSECX0",68,0)
 ;
"RTN","BPSECX0",69,0)
 S DR="400",DR(9002313.0201)="308:600"  ;need new RX fields
"RTN","BPSECX0",70,0)
 ;IHS/SD/lwj 8/13/02 end changes         
"RTN","BPSECX0",71,0)
 S DA=CLAIMIEN,DA(9002313.0201)=CRXIEN
"RTN","BPSECX0",72,0)
 S DIQ="BPS",DIQ(0)="I"
"RTN","BPSECX0",73,0)
 ;
"RTN","BPSECX0",74,0)
 ;Execute data retrieval routine
"RTN","BPSECX0",75,0)
 D EN^DIQ1
"RTN","BPSECX0",76,0)
 Q
"RTN","BPSECX0",77,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",78,0)
 ;Retrieve Claim Submission, Prescription(s) multiple, DUR/PPS multiple 
"RTN","BPSECX0",79,0)
 ; record
"RTN","BPSECX0",80,0)
 ;
"RTN","BPSECX0",81,0)
 ;Input Variables:   CLAIMIEN - Claim Submission IEN (9002313.02)
"RTN","BPSECX0",82,0)
 ;                   CRXIEN   - Prescription Multiple IEN (9002313.0201)
"RTN","BPSECX0",83,0)
 ;                   CDURIEN  - DUR/PPS Multiple IEN (9002313.1001)
"RTN","BPSECX0",84,0)
 ;
"RTN","BPSECX0",85,0)
 ;Output Variables:  BPS(9002313.1001,CDURIEN,<field #>,"I") = Value
"RTN","BPSECX0",86,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX0",87,0)
GETBPS4(CLAIMIEN,CRXIEN,CDURIEN,BPS) ;EP - from BPSECA1
"RTN","BPSECX0",88,0)
 ;
"RTN","BPSECX0",89,0)
 ;Manage local variables
"RTN","BPSECX0",90,0)
 N DIC,DR,DA,DIQ,D0,DIQ2
"RTN","BPSECX0",91,0)
 ;
"RTN","BPSECX0",92,0)
 ;Make sure input variables are defined
"RTN","BPSECX0",93,0)
 Q:$G(CLAIMIEN)=""
"RTN","BPSECX0",94,0)
 Q:$G(CRXIEN)=""
"RTN","BPSECX0",95,0)
 Q:$G(CDURIEN)=""
"RTN","BPSECX0",96,0)
 ;
"RTN","BPSECX0",97,0)
 ;S input variables for FileMan data retrieval routine
"RTN","BPSECX0",98,0)
 S DIC=9002313.02
"RTN","BPSECX0",99,0)
 ;
"RTN","BPSECX0",100,0)
 S DR="400",DR(9002313.0201)=473.01  ;fields
"RTN","BPSECX0",101,0)
 S DR(9002313.1001)=".01;439;440;441;474;475;476"  ;fields
"RTN","BPSECX0",102,0)
 S DA=CLAIMIEN,DA(9002313.0201)=CRXIEN,DA(9002313.1001)=CDURIEN
"RTN","BPSECX0",103,0)
 S DIQ="BPS",DIQ(0)="I"
"RTN","BPSECX0",104,0)
 ;
"RTN","BPSECX0",105,0)
 ;Execute data retrieval routine
"RTN","BPSECX0",106,0)
 D EN^DIQ1
"RTN","BPSECX0",107,0)
 ;
"RTN","BPSECX0",108,0)
 Q
"RTN","BPSECX1")
0^20^B16923293
"RTN","BPSECX1",1,0)
BPSECX1 ;BHAM ISC/FCS/DRS/VA/DLF - Create new Claim ID for Claim Submission file ;05/17/2004
"RTN","BPSECX1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECX1",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX1",4,0)
 ;Create new Claim ID for Claim Submission file (9002313.02)
"RTN","BPSECX1",5,0)
 ;
"RTN","BPSECX1",6,0)
 ;Input Variables:   NRDEFIEN  - NCPDP Record Definitions IEN
"RTN","BPSECX1",7,0)
 ;                               (9002313.92)
"RTN","BPSECX1",8,0)
 ;
"RTN","BPSECX1",9,0)
 ;Function Returns:  String:  C<YY>-<BBBBBB>-<NNNNN>
"RTN","BPSECX1",10,0)
 ;                         C can also be P or other ORIGIN code.
"RTN","BPSECX1",11,0)
 ;                         See remarks a few lines below about ORIGIN
"RTN","BPSECX1",12,0)
 ;                   Where:   <YY> is the year
"RTN","BPSECX1",13,0)
 ;                            <BBBBBB> is the BIN number of the payor
"RTN","BPSECX1",14,0)
 ;                            <NNNNN> is a 5-digit sequence number
"RTN","BPSECX1",15,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX1",16,0)
 ; Also called from old Alaska Medicaid batch method,
"RTN","BPSECX1",17,0)
 ; regrettably still in use at one site, but we're going to
"RTN","BPSECX1",18,0)
 ; phase it out someday.
"RTN","BPSECX1",19,0)
 ;
"RTN","BPSECX1",20,0)
 ;  ORIGIN argument added 08/23/2000
"RTN","BPSECX1",21,0)
 ;     Can specify the leading character of the claim ID.
"RTN","BPSECX1",22,0)
 ;     Defaults to "C".
"RTN","BPSECX1",23,0)
 ;     ECME sends in "P"
"RTN","BPSECX1",24,0)
 ;   09/20/2000 - can override by setting BPSECX1("PREFIX")=letter
"RTN","BPSECX1",25,0)
 ;     (Do this if you change the batch file to submit via POS)
"RTN","BPSECX1",26,0)
 ;
"RTN","BPSECX1",27,0)
 ;  Also changed 08/23/2000:  Sequence number is now 6 digits
"RTN","BPSECX1",28,0)
 ;  and the first number assigned is 100000.  As of yesterday, ANMC
"RTN","BPSECX1",29,0)
 ;  is already up to almost 40000.
"RTN","BPSECX1",30,0)
 ;  Can't change length in the middle of the year or the $O(,-1) is
"RTN","BPSECX1",31,0)
 ;  messed up.   So the code will adapt - if it finds 5-digit format
"RTN","BPSECX1",32,0)
 ;  already there, it will assign new numbers with 5 digits.
"RTN","BPSECX1",33,0)
 ;
"RTN","BPSECX1",34,0)
CLAIMID(NRDEFIEN,ORIGIN) ;EP - Called from BPSOSCE from BPSOSCA from BPSOSQG from BPSOSQ2
"RTN","BPSECX1",35,0)
 N PHARMACY,NABP,THIRD,DEL,PLAN,I,BIN,SEQNUM,ROOT,LAST ;LJE
"RTN","BPSECX1",36,0)
 ;
"RTN","BPSECX1",37,0)
 I '$D(ORIGIN) S ORIGIN="C"
"RTN","BPSECX1",38,0)
 I $G(BPSECX1("PREFIX"))?1U S ORIGIN=BPSECX1("PREFIX")
"RTN","BPSECX1",39,0)
 ;
"RTN","BPSECX1",40,0)
 ; LJE;7/24/03; The following lines generate the VA transmission ID and quits
"RTN","BPSECX1",41,0)
 I VARX D  Q ROOT
"RTN","BPSECX1",42,0)
 . ;
"RTN","BPSECX1",43,0)
 . ; Default the Origin (first piece of transmission ID
"RTN","BPSECX1",44,0)
 . S ORIGIN="VA"
"RTN","BPSECX1",45,0)
 . ;
"RTN","BPSECX1",46,0)
 . ; Get and format NABP number (second piece of the transmission ID)
"RTN","BPSECX1",47,0)
 . I '$D(CERTIFY) S CERTIFY=($G(^BPS(9002313.99,1,"CERTIFIER"))=DUZ)
"RTN","BPSECX1",48,0)
 . I 'CERTIFY S PHARMACY=+$P($G(^BPST(IEN59,1)),U,7),NABP=$P($G(^BPS(9002313.56,PHARMACY,0)),"^",2)
"RTN","BPSECX1",49,0)
 . I CERTIFY,'$G(PHARMACY) S PHARMACY=10,NABP=$P($G(^BPS(9002313.56,PHARMACY,0)),"^",2)
"RTN","BPSECX1",50,0)
 . S NABP=$TR($J("",7-$L(NABP))," ","0")_NABP
"RTN","BPSECX1",51,0)
 . ;
"RTN","BPSECX1",52,0)
 . ; Get the third piece of the transmission ID
"RTN","BPSECX1",53,0)
 . ;  If the National Plan ID is available, use it with '=' delimiter (new format)
"RTN","BPSECX1",54,0)
 . ;  If not, it will need to be the BIN with the '-' delimiter (old format)
"RTN","BPSECX1",55,0)
 . S THIRD="",PLAN=$$GET1^DIQ(9002313.59902,"1,"_IEN59_",","902.27")
"RTN","BPSECX1",56,0)
 . I PLAN]"" D
"RTN","BPSECX1",57,0)
 .. F I=1:1:$L(PLAN) I $E(PLAN,I)?1N Q
"RTN","BPSECX1",58,0)
 .. S PLAN=$E(PLAN,I,$L(PLAN))
"RTN","BPSECX1",59,0)
 .. S THIRD=PLAN,DEL="="
"RTN","BPSECX1",60,0)
 . ;
"RTN","BPSECX1",61,0)
 . ; If no plan, get BIN and use '-' delimiter (old format)
"RTN","BPSECX1",62,0)
 . I THIRD="" S DEL="-",THIRD=$S(CERTIFY:$P($G(^BPSF(9002313.92,NRDEFIEN,1)),U,1),1:$$GET1^DIQ(9002313.59902,"1,"_IEN59_",","902.03"))
"RTN","BPSECX1",63,0)
 . ;
"RTN","BPSECX1",64,0)
 . ; Pad third piece with zeros
"RTN","BPSECX1",65,0)
 . S THIRD=$TR($J("",6-$L(THIRD))," ","0")_THIRD
"RTN","BPSECX1",66,0)
 . ;
"RTN","BPSECX1",67,0)
 . ; Get and format the sequence number (fourth piece)
"RTN","BPSECX1",68,0)
 . L +^BPS(9002313.99,1,3):15 I '$T D IMPOSS^BPSOSUE("DB,P","TI","",,"Can't lock BPS(9002313.99,1,3)",$T(+0))
"RTN","BPSECX1",69,0)
 . S SEQNUM=+$G(^BPS(9002313.99,1,3)),^BPS(9002313.99,1,3)=SEQNUM+1
"RTN","BPSECX1",70,0)
 . I $L(SEQNUM<7) S SEQNUM=$E($TR($J("",7-$L(SEQNUM))," ","0")_SEQNUM,1,7)
"RTN","BPSECX1",71,0)
 . L -^BPS(9002313.99,1,3)
"RTN","BPSECX1",72,0)
 . ;
"RTN","BPSECX1",73,0)
 . ; Create the Transmission ID
"RTN","BPSECX1",74,0)
 . S ROOT=ORIGIN_($E(DT,1,3)+1700)_DEL_NABP_DEL_THIRD_DEL_SEQNUM
"RTN","BPSECX1",75,0)
 ;
"RTN","BPSECX1",76,0)
 ;Get and format BIN number for the electronic payer
"RTN","BPSECX1",77,0)
 S BIN=$P($G(^BPSF(9002313.92,NRDEFIEN,1)),U,1)
"RTN","BPSECX1",78,0)
 S BIN=$$NFF^BPSECFM(BIN,6)
"RTN","BPSECX1",79,0)
 ;
"RTN","BPSECX1",80,0)
 ;Establish the root for the claim id number
"RTN","BPSECX1",81,0)
 S ROOT=ORIGIN_$E(DT,2,3)_"-"_BIN_"-" ; 11 characters long
"RTN","BPSECX1",82,0)
 ;
"RTN","BPSECX1",83,0)
 ;Get last claim id number with the same root
"RTN","BPSECX1",84,0)
 S LAST=$O(^BPSC("B",ROOT_"Z"),-1)
"RTN","BPSECX1",85,0)
 ; Reversal claim ID?  Get rid of the suffix R#
"RTN","BPSECX1",86,0)
 ; BPS*1.0T7*6    could be #>9, in which case the old logic fails!
"RTN","BPSECX1",87,0)
 ; BPS*1.0T7*6    replaced the line that strips off the R#
"RTN","BPSECX1",88,0)
 I $L(LAST)>6,LAST?.E1"R"1.N S $P(LAST,"-",3)=+$P(LAST,"-",3) ;BPS*1.0T7*6
"RTN","BPSECX1",89,0)
 ;
"RTN","BPSECX1",90,0)
 ;Set and format sequence number
"RTN","BPSECX1",91,0)
 S SEQNUM=$S($E(LAST,1,11)=ROOT:(+$P(LAST,"-",3))+1,1:0)
"RTN","BPSECX1",92,0)
 N SEQLEN
"RTN","BPSECX1",93,0)
 ;  5 or 6 digit numbers?  Depends on what's there already? 
"RTN","BPSECX1",94,0)
 ;  Six digits is what we really want, but upgrades will be trickier.
"RTN","BPSECX1",95,0)
 ; New installs and ANMC 2001 will have 6 digits.
"RTN","BPSECX1",96,0)
 ;
"RTN","BPSECX1",97,0)
 I SEQNUM=0 S SEQLEN=6,SEQNUM=100000
"RTN","BPSECX1",98,0)
 E  S SEQLEN=$L($P(LAST,"-",3))
"RTN","BPSECX1",99,0)
 I SEQLEN<5 D IMPOSS^BPSOSUE("DB,P","TI",LAST,,"SEQLEN<5",$T(+0)) ; internal error
"RTN","BPSECX1",100,0)
 I SEQLEN>6 D IMPOSS^BPSOSUE("DB,P","TI",LAST,,"SEQLEN>6",$T(+0)) ; internal error
"RTN","BPSECX1",101,0)
 I $L(SEQNUM)=SEQLEN,SEQNUM?."9" D
"RTN","BPSECX1",102,0)
 . D IMPOSS^BPSOSUE("DB,P","T",LAST,,"OVERFLOWED!",$T(+0))
"RTN","BPSECX1",103,0)
 I SEQLEN=5 S SEQNUM=$TR($J(SEQNUM,SEQLEN)," ","0") ; pad w/leading 0s
"RTN","BPSECX1",104,0)
 I $L(SEQNUM)'=SEQLEN D  ; internal error
"RTN","BPSECX1",105,0)
 . D IMPOSS^BPSOSUE("DB,P","TI",LAST,SEQLEN,"length",$T(+0))
"RTN","BPSECX1",106,0)
 ;
"RTN","BPSECX1",107,0)
 Q ROOT_SEQNUM
"RTN","BPSECX4")
0^21^B1898595
"RTN","BPSECX4",1,0)
BPSECX4 ;BHAM ISC/FCS/DRS/VA/DLF - Function which gets a claim or response record from the ^BPSECX global ;05/17/2004
"RTN","BPSECX4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSECX4",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX4",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX4",5,0)
 ;Function which gets a claim or response record from the ^BPSECX
"RTN","BPSECX4",6,0)
 ;transmission scratch global.
"RTN","BPSECX4",7,0)
 ;
"RTN","BPSECX4",8,0)
 ;Input Variables:    IEN  - Internal Entry Number of Claim Record
"RTN","BPSECX4",9,0)
 ;                    MODE - "C" for Claim or "R" for Response
"RTN","BPSECX4",10,0)
 ;
"RTN","BPSECX4",11,0)
 ;Function Returns:   AREC - ASCII formatted record
"RTN","BPSECX4",12,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX4",13,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX4",14,0)
 ;Routine which creates and breaks apart an ASCII claim or response
"RTN","BPSECX4",15,0)
 ;record and stores it in the ^BPSECX transmission scratch global.
"RTN","BPSECX4",16,0)
 ;
"RTN","BPSECX4",17,0)
 ;Input Variables:    AREC - ASCII formatted record
"RTN","BPSECX4",18,0)
 ;                    IEN  - Internal Entry Number of Claim Record
"RTN","BPSECX4",19,0)
 ;                    MODE - "C" for Claim or "R" for Response
"RTN","BPSECX4",20,0)
 ;
"RTN","BPSECX4",21,0)
 ;Function Returns:   AREC - ASCII formatted record
"RTN","BPSECX4",22,0)
 ;----------------------------------------------------------------------
"RTN","BPSECX4",23,0)
SVEAREC(AREC,IEN,MODE) ;EP - from BPSOSQH
"RTN","BPSECX4",24,0)
 ;Manage local variables
"RTN","BPSECX4",25,0)
 N NCHARS,NNODES,INDEX,START,END
"RTN","BPSECX4",26,0)
 ;
"RTN","BPSECX4",27,0)
 ;Make sure input variables are defined
"RTN","BPSECX4",28,0)
 Q:$G(AREC)=""
"RTN","BPSECX4",29,0)
 Q:$G(MODE)=""
"RTN","BPSECX4",30,0)
 Q:$G(IEN)=""
"RTN","BPSECX4",31,0)
 ;
"RTN","BPSECX4",32,0)
 ;Determine number of nodes need to store AREC
"RTN","BPSECX4",33,0)
 I $G(VARX) G VASTORE
"RTN","BPSECX4",34,0)
 S NCHARS=$L(AREC)
"RTN","BPSECX4",35,0)
 S NNODES=((NCHARS-1)\245)+1
"RTN","BPSECX4",36,0)
 ;
"RTN","BPSECX4",37,0)
 K ^BPSECX($J,MODE,IEN)
"RTN","BPSECX4",38,0)
 S ^BPSECX($J,MODE,IEN,0)=NNODES
"RTN","BPSECX4",39,0)
 ;
"RTN","BPSECX4",40,0)
 ;Break AREC into 245 character sections
"RTN","BPSECX4",41,0)
 F INDEX=1:1:NNODES D
"RTN","BPSECX4",42,0)
 .S START=((INDEX-1)*245)+1
"RTN","BPSECX4",43,0)
 .S END=START+245-1
"RTN","BPSECX4",44,0)
 .S:END>NCHARS END=NCHARS
"RTN","BPSECX4",45,0)
 .S ^BPSECX($J,MODE,IEN,INDEX)=$E(AREC,START,END)
"RTN","BPSECX4",46,0)
 Q
"RTN","BPSECX4",47,0)
 ;
"RTN","BPSECX4",48,0)
VASTORE ;LJE; Need to store by segment for VA due to HL7 constraints.  Had to changed field, group, and segment separators to control
"RTN","BPSECX4",49,0)
 ;               ;  characters for Vitria/AAC processing as well as shortening the length of the xmit.
"RTN","BPSECX4",50,0)
 S INDEX=1 F  S NNODES=$O(AREC(NNODES)) Q:NNODES=""  D
"RTN","BPSECX4",51,0)
 . S ^BPSECX($J,MODE,IEN,INDEX)=AREC(NNODES),INDEX=INDEX+1
"RTN","BPSECX4",52,0)
 S ^BPSECX($J,MODE,IEN,0)=INDEX-1
"RTN","BPSECX4",53,0)
 Q
"RTN","BPSECZ3")
1^23
"RTN","BPSECZA")
1^24
"RTN","BPSER1A")
1^26
"RTN","BPSER2A")
1^28
"RTN","BPSER3A")
1^30
"RTN","BPSER4A")
1^32
"RTN","BPSES00")
1^33
"RTN","BPSJACK")
0^348^B29751574
"RTN","BPSJACK",1,0)
BPSJACK ;BHAM ISC/LJF - HL7 Acknowledgement Messages ;21-NOV-2003
"RTN","BPSJACK",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJACK",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJACK",4,0)
 ;
"RTN","BPSJACK",5,0)
 ; This routine examines an Acknowledgement Message. If the message is
"RTN","BPSJACK",6,0)
 ; the E-PHARM Application Acknowledgement Message, and it is "AA",
"RTN","BPSJACK",7,0)
 ; it kicks off the Pharmacy Registration Messages.
"RTN","BPSJACK",8,0)
 ; If the message flags an error, then error notification is processed.
"RTN","BPSJACK",9,0)
 ;
"RTN","BPSJACK",10,0)
EN(HL) N ACK,AREG,BPSJSEG,ERR,HCT,SEG
"RTN","BPSJACK",11,0)
 N MFI,MFIIX,MSGCTLID,MSGID,MSGIX,MSH
"RTN","BPSJACK",12,0)
 ;
"RTN","BPSJACK",13,0)
 I '$D(HL) Q
"RTN","BPSJACK",14,0)
 ;
"RTN","BPSJACK",15,0)
 S (AREG,HCT,MFIIX,MSGCTLID,MSGID,MSGIX)=0,(ACK,MFI,MSH)=""
"RTN","BPSJACK",16,0)
 S ERR("MSA")=""
"RTN","BPSJACK",17,0)
 ;  Loop through the message and find each segment for processing
"RTN","BPSJACK",18,0)
 F  S HCT=$O(^TMP($J,"BPSJHLI",HCT)) Q:HCT=""  D
"RTN","BPSJACK",19,0)
 . K BPSJSEG D SPAR^BPSJUTL(.HL,.BPSJSEG,HCT) S SEG=$G(BPSJSEG(1))
"RTN","BPSJACK",20,0)
 . ;
"RTN","BPSJACK",21,0)
 . I SEG="MSH" D  Q
"RTN","BPSJACK",22,0)
 . . S MSGCTLID=$G(BPSJSEG(10))    ; get the message control id
"RTN","BPSJACK",23,0)
 . ;
"RTN","BPSJACK",24,0)
 . I SEG="MSA" D  Q  ; MSA seg looks like this -> MSA|AA|509133482
"RTN","BPSJACK",25,0)
 . . S ACK=$G(BPSJSEG(2)),MSGID=$G(BPSJSEG(3)) K ERR("MSA")
"RTN","BPSJACK",26,0)
 . ;
"RTN","BPSJACK",27,0)
 . I SEG="MFI",ACK="AA",$P($G(BPSJSEG(2)),$E($G(HL("ECH"))))="Facility Table" S AREG=1
"RTN","BPSJACK",28,0)
 . ;
"RTN","BPSJACK",29,0)
 . I SEG="MFA",ACK="AE" S ERR("MFA",U_$G(BPSJSEG(5)))="" Q
"RTN","BPSJACK",30,0)
 ;
"RTN","BPSJACK",31,0)
 ; Application Registered, do pharmacy registrations
"RTN","BPSJACK",32,0)
 I AREG S AREG=0 D
"RTN","BPSJACK",33,0)
 . F  S AREG=$O(^BPS(9002313.56,AREG)) Q:'AREG  D REG^BPSJPREG(AREG)
"RTN","BPSJACK",34,0)
 ;
"RTN","BPSJACK",35,0)
 I $D(ERR) D ERRORM D MSG^BPSJUTL(.ERR,"BPSJACK")
"RTN","BPSJACK",36,0)
 Q
"RTN","BPSJACK",37,0)
 ;
"RTN","BPSJACK",38,0)
ERRORM ; Error message setup
"RTN","BPSJACK",39,0)
 N ERRT
"RTN","BPSJACK",40,0)
 ;
"RTN","BPSJACK",41,0)
 S ERR(1)="Error(s) indicated for HL7 Application Acknowledge Message ID: "_$G(MSGCTLID)
"RTN","BPSJACK",42,0)
 I $D(ERR("MSA")) S ERR(2)="Error:NO MSA - No MSA segment found."
"RTN","BPSJACK",43,0)
 I $D(ERR("MFA")) S ERRT="" F  S ERRT=$O(ERR("MFA",ERRT)) Q:ERRT=""  D
"RTN","BPSJACK",44,0)
 . I ERRT["NC100" S ERR(100)="Error:NC100 - Invalid OP Interface version." Q
"RTN","BPSJACK",45,0)
 . I ERRT["NC200" S ERR(200)="Error:NC200 - Not e-IIV registered." Q
"RTN","BPSJACK",46,0)
 . I ERRT["NC201" S ERR(201)="Error:NC201 - Invalid IIV Interface version." Q
"RTN","BPSJACK",47,0)
 . I ERRT["NC202" S ERR(202)="Error:NC202 - Invalid e-IIV registration state." Q
"RTN","BPSJACK",48,0)
 . I ERRT["NC300" S ERR(300)="Error:NC300 - OP pharmacy not registered.  Failed to update Pharmacy information." Q
"RTN","BPSJACK",49,0)
 . I ERRT["NC301" S ERR(301)="Error:NC301 - Unable to update Pharmacy information due to outpatient pharmacy registration has invalid OP interface version." Q
"RTN","BPSJACK",50,0)
 . I ERRT["NC302" S ERR(302)="Error:NC302 - Unable to update Pharmacy information due to invalid e-IIV registration state." Q
"RTN","BPSJACK",51,0)
 . S ERR(399)="Error:"_ERRT_" - Unknown error."
"RTN","BPSJACK",52,0)
 K ERR("MFA"),ERR("MSA")
"RTN","BPSJACK",53,0)
 ;
"RTN","BPSJACK",54,0)
 Q
"RTN","BPSJACK",55,0)
 ;
"RTN","BPSJACK",56,0)
APPACK(HL,APPACK,PSIEN) ; Application Acknowledgement for Payer Sheets
"RTN","BPSJACK",57,0)
 N MGRP,MSG,MCT,GENRSLT
"RTN","BPSJACK",58,0)
 N TLN,FS,FS2,FS3,CS
"RTN","BPSJACK",59,0)
 ;
"RTN","BPSJACK",60,0)
 K ^TMP("HLA",$J)
"RTN","BPSJACK",61,0)
 ;
"RTN","BPSJACK",62,0)
 ;-Set up HL7
"RTN","BPSJACK",63,0)
 D INIT^HLFNC2("BPSJ REGISTER",.HL)
"RTN","BPSJACK",64,0)
 ;
"RTN","BPSJACK",65,0)
 D DGAPPACK  ; Dollar G the APPACK variable (bullet proofing)
"RTN","BPSJACK",66,0)
 ;
"RTN","BPSJACK",67,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"      ; field separator
"RTN","BPSJACK",68,0)
 S CS=$E($G(HL("ECH"))) I CS="" S CS="^"  ; component separator
"RTN","BPSJACK",69,0)
 ;
"RTN","BPSJACK",70,0)
 S MCT=0,FS2=FS_FS,FS3=FS_FS_FS
"RTN","BPSJACK",71,0)
 ;
"RTN","BPSJACK",72,0)
 ;-MSA SEG
"RTN","BPSJACK",73,0)
 I APPACK("MFA",4,1)="S" S ^TMP("HLA",$J,1)="MSA"_FS_"AA"_FS_APPACK("MSA",2)
"RTN","BPSJACK",74,0)
 E  S ^TMP("HLA",$J,1)="MSA"_FS_"AE"_FS_APPACK("MSA",2)
"RTN","BPSJACK",75,0)
 ;
"RTN","BPSJACK",76,0)
 ;-MFI SEG
"RTN","BPSJACK",77,0)
 S TLN="MFI"_FS_APPACK("MFI",1,1)_CS_APPACK("MFI",1,2)_FS2
"RTN","BPSJACK",78,0)
 S ^TMP("HLA",$J,2)=TLN_APPACK("MFI",3)_FS3_APPACK("MFI",6)
"RTN","BPSJACK",79,0)
 ;
"RTN","BPSJACK",80,0)
 ;-MFA SEG(S)
"RTN","BPSJACK",81,0)
 I APPACK("MFA",4,1)="S" D  S ^TMP("HLA",$J,3)=TLN
"RTN","BPSJACK",82,0)
 . S TLN="MFA"_FS_APPACK("MFA",1)_FS_APPACK("MFA",2)_FS2
"RTN","BPSJACK",83,0)
 . S TLN=TLN_APPACK("MFA",4,1)_CS_APPACK("MFA",4,2)_FS
"RTN","BPSJACK",84,0)
 . S TLN=TLN_APPACK("MFA",5)_FS_APPACK("MFA",6)
"RTN","BPSJACK",85,0)
 E  D MFASEGS
"RTN","BPSJACK",86,0)
 ;
"RTN","BPSJACK",87,0)
 D GENACK^HLMA1($G(HL("EID")),$G(HL("HLMTIENS")),$G(HL("EIDS")),"GM",1,.GENRSLT)
"RTN","BPSJACK",88,0)
 ;
"RTN","BPSJACK",89,0)
 K ^TMP("HLA",$J)
"RTN","BPSJACK",90,0)
 Q
"RTN","BPSJACK",91,0)
 ;
"RTN","BPSJACK",92,0)
MFASEGS ; Set up the MFA segs for Reject message
"RTN","BPSJACK",93,0)
 N MFAP1,MFAP2,MFACNTR,FIELD,RECORD,ZPRERR
"RTN","BPSJACK",94,0)
 ;
"RTN","BPSJACK",95,0)
 S MFAP1="MFA"_FS_APPACK("MFA",1)_FS_APPACK("MFA",2)
"RTN","BPSJACK",96,0)
 S MFAP1=MFAP1_FS2_APPACK("MFA",4,1)_CS
"RTN","BPSJACK",97,0)
 S MFAP2=FS_APPACK("MFA",5)_FS_APPACK("MFA",6)
"RTN","BPSJACK",98,0)
 S MFACNTR=2
"RTN","BPSJACK",99,0)
 ;
"RTN","BPSJACK",100,0)
 I $D(^TMP($J,"BPSJ-ERROR","MFI")) S FIELD="" D
"RTN","BPSJACK",101,0)
 . F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","MFI",FIELD)) Q:'FIELD  D
"RTN","BPSJACK",102,0)
 .. S MFACNTR=MFACNTR+1
"RTN","BPSJACK",103,0)
 .. S ^TMP("HLA",$J,MFACNTR)=MFAP1_"V60"_FIELD_MFAP2
"RTN","BPSJACK",104,0)
 ;
"RTN","BPSJACK",105,0)
 I $D(^TMP($J,"BPSJ-ERROR","MFE")) S FIELD="" D
"RTN","BPSJACK",106,0)
 . F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","MFE",FIELD)) Q:'FIELD  D
"RTN","BPSJACK",107,0)
 .. S MFACNTR=MFACNTR+1
"RTN","BPSJACK",108,0)
 .. S ^TMP("HLA",$J,MFACNTR)=MFAP1_"V61"_FIELD_MFAP2
"RTN","BPSJACK",109,0)
 ;
"RTN","BPSJACK",110,0)
 I $D(^TMP($J,"BPSJ-ERROR","ZPS")) S FIELD="" D
"RTN","BPSJACK",111,0)
 . F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","ZPS",FIELD)) Q:'FIELD  D
"RTN","BPSJACK",112,0)
 .. S MFACNTR=MFACNTR+1
"RTN","BPSJACK",113,0)
 .. S ^TMP("HLA",$J,MFACNTR)=MFAP1_"V62"_FIELD_MFAP2
"RTN","BPSJACK",114,0)
 ;
"RTN","BPSJACK",115,0)
 I $D(^TMP($J,"BPSJ-ERROR","ZPR")) S RECORD="" D
"RTN","BPSJACK",116,0)
 . F  S RECORD=$O(^TMP($J,"BPSJ-ERROR","ZPR",RECORD)),FIELD="" Q:'RECORD  D
"RTN","BPSJACK",117,0)
 .. F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","ZPR",RECORD,FIELD)) Q:'FIELD  D
"RTN","BPSJACK",118,0)
 ... S ZPRERR=$G(^TMP($J,"BPSJ-ERROR","ZPR",RECORD,FIELD))
"RTN","BPSJACK",119,0)
 ... S MFACNTR=MFACNTR+1,^TMP("HLA",$J,MFACNTR)=MFAP1_ZPRERR_MFAP2
"RTN","BPSJACK",120,0)
 ;
"RTN","BPSJACK",121,0)
 Q
"RTN","BPSJACK",122,0)
DGAPPACK ; $G the APPACK var
"RTN","BPSJACK",123,0)
 S APPACK("MFA",1)=$G(APPACK("MFA",1))
"RTN","BPSJACK",124,0)
 S APPACK("MFA",2)=$G(APPACK("MFA",2))
"RTN","BPSJACK",125,0)
 S APPACK("MFA",3)=$G(APPACK("MFA",3))
"RTN","BPSJACK",126,0)
 S APPACK("MFA",4,1)=$G(APPACK("MFA",4,1))
"RTN","BPSJACK",127,0)
 S APPACK("MFA",4,2)=$G(APPACK("MFA",4,2))
"RTN","BPSJACK",128,0)
 S APPACK("MFA",5)=$G(APPACK("MFA",5))
"RTN","BPSJACK",129,0)
 S APPACK("MFA",6)=$G(APPACK("MFA",6))
"RTN","BPSJACK",130,0)
 S APPACK("MFI",1,1)=$G(APPACK("MFI",1,1))
"RTN","BPSJACK",131,0)
 S APPACK("MFI",1,2)=$G(APPACK("MFI",1,2))
"RTN","BPSJACK",132,0)
 S APPACK("MFI",3)=$G(APPACK("MFI",3))
"RTN","BPSJACK",133,0)
 S APPACK("MFI",6)=$G(APPACK("MFI",6))
"RTN","BPSJACK",134,0)
 S APPACK("MSA",1)=$G(APPACK("MSA",1))
"RTN","BPSJACK",135,0)
 S APPACK("MSA",2)=$G(APPACK("MSA",2))
"RTN","BPSJACK",136,0)
 Q
"RTN","BPSJAREG")
0^349^B10520831
"RTN","BPSJAREG",1,0)
BPSJAREG ;BHAM ISC/LJF - HL7 Application Registration MFN Message ;21-NOV-2003
"RTN","BPSJAREG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJAREG",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJAREG",4,0)
 ;
"RTN","BPSJAREG",5,0)
 ;  This program will process the outgoing registration MFN message
"RTN","BPSJAREG",6,0)
 ;
"RTN","BPSJAREG",7,0)
 ;  Variables
"RTN","BPSJAREG",8,0)
 ; HL      = HL7 parameters
"RTN","BPSJAREG",9,0)
 ; HL7DTG  = Date time in HL7 format
"RTN","BPSJAREG",10,0)
 ; HLECH   = HL7 Encoding Characters
"RTN","BPSJAREG",11,0)
 ; HLEID   = HL7 Link id
"RTN","BPSJAREG",12,0)
 ; HLFS    = HL7 Field separator
"RTN","BPSJAREG",13,0)
 ; HLLNK   = HL7 E-Pharm Link
"RTN","BPSJAREG",14,0)
 ; HLRESET = HL7 generate results
"RTN","BPSJAREG",15,0)
 ; IPP     = IP Port
"RTN","BPSJAREG",16,0)
 ; IPA     = IP Address
"RTN","BPSJAREG",17,0)
 ; MCT     = Message Count
"RTN","BPSJAREG",18,0)
 ; MGRP    = E-Mail message group
"RTN","BPSJAREG",19,0)
 ; MSG     = Message
"RTN","BPSJAREG",20,0)
 ;
"RTN","BPSJAREG",21,0)
INI ;
"RTN","BPSJAREG",22,0)
INIT ; Unconditional jump....
"RTN","BPSJAREG",23,0)
 G ^BPSJINIT
"RTN","BPSJAREG",24,0)
 Q
"RTN","BPSJAREG",25,0)
 ;
"RTN","BPSJAREG",26,0)
BPSJVAL(BPSJVAL) ; Validation entry point - HL7 message processing prevented
"RTN","BPSJAREG",27,0)
 ;
"RTN","BPSJAREG",28,0)
TASKMAN ; Entry point for taskman to run this routine
"RTN","BPSJAREG",29,0)
 ;
"RTN","BPSJAREG",30,0)
 N HL,HL7DTG,HLECH,HLEID,HLFS,HLLNK,HLRESET,HLPRO
"RTN","BPSJAREG",31,0)
 N IPA,IPP
"RTN","BPSJAREG",32,0)
 N MGRP,MSG,MCT,BPSJARES
"RTN","BPSJAREG",33,0)
 ;
"RTN","BPSJAREG",34,0)
 S MCT=0,BPSJVAL=+$G(BPSJVAL)
"RTN","BPSJAREG",35,0)
 K ^TMP("HLS",$J)
"RTN","BPSJAREG",36,0)
 ;
"RTN","BPSJAREG",37,0)
 ;  Get Link data from HL7 table
"RTN","BPSJAREG",38,0)
 S HLPRO="BPSJ REGISTER",(IPA,IPP)=""
"RTN","BPSJAREG",39,0)
 S HLLNK=$$FIND1^DIC(870,"",,"EPHARM OUT","B")
"RTN","BPSJAREG",40,0)
 I HLLNK S IPA=$$GET1^DIQ(870,HLLNK_",",400.01),IPP=$$GET1^DIQ(870,HLLNK_",",400.02)
"RTN","BPSJAREG",41,0)
 ;
"RTN","BPSJAREG",42,0)
 ;  Error if any missing data
"RTN","BPSJAREG",43,0)
 I IPA=""!(IPP="") S MCT=MCT+1,MSG(MCT)="IP Address or Port is not defined.  "
"RTN","BPSJAREG",44,0)
 ;
"RTN","BPSJAREG",45,0)
 I MCT,'BPSJVAL D MSG^BPSJUTL(.MSG,"BPSJAREG") Q
"RTN","BPSJAREG",46,0)
 ;
"RTN","BPSJAREG",47,0)
 ;  Initialize the HL7
"RTN","BPSJAREG",48,0)
 D INIT^HLFNC2(HLPRO,.HL)
"RTN","BPSJAREG",49,0)
 S HLFS=$G(HL("FS")) I HLFS="" S HLFS="|"
"RTN","BPSJAREG",50,0)
 S HLECH=$E($G(HL("ECH")),1) I HLECH="" S HLECH="^"
"RTN","BPSJAREG",51,0)
 S HL("SITE")=$$SITE^VASITE,HL("SAF")=$P(HL("SITE"),U,2,3)
"RTN","BPSJAREG",52,0)
 S HL("EPPORT")=IPP,HLEID=$$HLP^BPSJUTL(HLPRO)
"RTN","BPSJAREG",53,0)
 ;
"RTN","BPSJAREG",54,0)
 ;Get fileman date/time, ensuring seconds are included: 3031029.135636
"RTN","BPSJAREG",55,0)
 S HL7DTG=$E($$HTFM^XLFDT($H)_"000000",1,14)
"RTN","BPSJAREG",56,0)
 ;Set HL7 Date/Time format: 20031029135636-0400
"RTN","BPSJAREG",57,0)
 S HL7DTG=$$FMTHL7^XLFDT(HL7DTG)
"RTN","BPSJAREG",58,0)
 ;
"RTN","BPSJAREG",59,0)
 ;   Set the MFI segment
"RTN","BPSJAREG",60,0)
 S ^TMP("HLS",$J,1)="MFI"_HLFS_"Facility Table"_HLFS_HLFS_"UPD"_HLFS
"RTN","BPSJAREG",61,0)
 S ^TMP("HLS",$J,1)=^TMP("HLS",$J,1)_HL7DTG_HLFS_HL7DTG_HLFS_"NE"
"RTN","BPSJAREG",62,0)
 ;
"RTN","BPSJAREG",63,0)
 ;  Set the MFE segment
"RTN","BPSJAREG",64,0)
 S ^TMP("HLS",$J,2)="MFE"_HLFS_"MUP"_HLFS_HLFS_HL7DTG_HLFS
"RTN","BPSJAREG",65,0)
 S ^TMP("HLS",$J,2)=^TMP("HLS",$J,2)_+HL("SITE")_HLFS_"ST"
"RTN","BPSJAREG",66,0)
 ;
"RTN","BPSJAREG",67,0)
 ; Set the ZQR segment
"RTN","BPSJAREG",68,0)
 S ^TMP("HLS",$J,3)=$$EN^BPSJZQR(.HL)
"RTN","BPSJAREG",69,0)
 ;
"RTN","BPSJAREG",70,0)
 S BPSJARES=$$VAL1^BPSJVAL(BPSJVAL)  ; 0 = ok,
"RTN","BPSJAREG",71,0)
 I BPSJVAL=3 G FINI   ; Just checking to see if data valid.
"RTN","BPSJAREG",72,0)
 ;
"RTN","BPSJAREG",73,0)
 ;-Check if msg valid.
"RTN","BPSJAREG",74,0)
 I 'BPSJARES D  G FINI
"RTN","BPSJAREG",75,0)
 . K HLRESLT
"RTN","BPSJAREG",76,0)
 . D GENERATE^HLMA(HLEID,"GM",1,.HLRESLT,"")
"RTN","BPSJAREG",77,0)
 . I $P($G(HLRESLT),U,2)]"" D  Q
"RTN","BPSJAREG",78,0)
 .. I BPSJVAL D  Q   ; Interactive: show no success
"RTN","BPSJAREG",79,0)
 ... W !!,"HL7 E-Pharm Application Registration Message not created: "_HLRESLT
"RTN","BPSJAREG",80,0)
 .. S MCT=MCT+1,MSG(MCT)="HL7 E-Pharm Application Registration Message not created."
"RTN","BPSJAREG",81,0)
 .. S MCT=MCT+1,MSG(MCT)=HLRESLT
"RTN","BPSJAREG",82,0)
 .. D MSG^BPSJUTL(.MSG,"BPSJAREG")
"RTN","BPSJAREG",83,0)
 . I BPSJVAL D    ;Interactive: show success
"RTN","BPSJAREG",84,0)
 .. W !!,"HL7 E-Pharm Application Registration Message successfully created."
"RTN","BPSJAREG",85,0)
 ;
"RTN","BPSJAREG",86,0)
FINI ; Clean up
"RTN","BPSJAREG",87,0)
 K ^TMP("HLS",$J)
"RTN","BPSJAREG",88,0)
 Q
"RTN","BPSJHLI")
0^350^B2158650
"RTN","BPSJHLI",1,0)
BPSJHLI ;BHAM ISC/LJF - Incoming HL7 E-PHARM messages ;21-NOV-2003
"RTN","BPSJHLI",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJHLI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJHLI",4,0)
 ;
"RTN","BPSJHLI",5,0)
 ;**Program Description**
"RTN","BPSJHLI",6,0)
 ;  This program processes incoming HL7 message.
"RTN","BPSJHLI",7,0)
 ;
"RTN","BPSJHLI",8,0)
EN ;  Starting point - put message into a TMP global
"RTN","BPSJHLI",9,0)
 N SEGCNT,CNT,SEGMT,EVENT,MSG,MCT,FSHLI
"RTN","BPSJHLI",10,0)
 ;
"RTN","BPSJHLI",11,0)
 K ^TMP($J,"BPSJHLI") S MCT=0
"RTN","BPSJHLI",12,0)
 F SEGCNT=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","BPSJHLI",13,0)
 . S CNT=0,^TMP($J,"BPSJHLI",SEGCNT,CNT)=HLNODE
"RTN","BPSJHLI",14,0)
 . F  S CNT=$O(HLNODE(CNT)) Q:'CNT  D
"RTN","BPSJHLI",15,0)
 .. S ^TMP($J,"BPSJHLI",SEGCNT,CNT)=HLNODE(CNT)
"RTN","BPSJHLI",16,0)
 ;
"RTN","BPSJHLI",17,0)
 ; Check MSH seg
"RTN","BPSJHLI",18,0)
 S SEGMT=$G(^TMP($J,"BPSJHLI",1,0))
"RTN","BPSJHLI",19,0)
 S FSHLI=$G(HL("FS")) I FSHLI="" S (FS,FSHLI)=$E(SEGMT,4)
"RTN","BPSJHLI",20,0)
 ;
"RTN","BPSJHLI",21,0)
 I $E(SEGMT,1,3)'="MSH" D  D MSG^BPSJUTL(.MSG,"BPSJHLI") G EXIT
"RTN","BPSJHLI",22,0)
 . S MCT=MCT+1,MSG(MCT)="MSH Segment is not the first segment found"
"RTN","BPSJHLI",23,0)
 ;
"RTN","BPSJHLI",24,0)
 S EVENT=$P(SEGMT,FSHLI,9)
"RTN","BPSJHLI",25,0)
 ;
"RTN","BPSJHLI",26,0)
 ;  Acknowledgement Processing
"RTN","BPSJHLI",27,0)
 I EVENT="MFK^M01" D EN^BPSJACK(.HL) G EXIT
"RTN","BPSJHLI",28,0)
 ;
"RTN","BPSJHLI",29,0)
 ;  Table Update Processing for Payer Sheets
"RTN","BPSJHLI",30,0)
 I EVENT="MFN^M01" D
"RTN","BPSJHLI",31,0)
 . S HL("HLMTIENS")=$G(HLMTIENS)
"RTN","BPSJHLI",32,0)
 . D EN^BPSJHLT(.HL)
"RTN","BPSJHLI",33,0)
 ;
"RTN","BPSJHLI",34,0)
EXIT ;
"RTN","BPSJHLI",35,0)
 K ^TMP($J,"BPSJHLI"),SEGCNT,CNT,HL,HLREC,HLNEXT,HLNODE
"RTN","BPSJHLI",36,0)
 Q
"RTN","BPSJHLT")
0^351^B65705397
"RTN","BPSJHLT",1,0)
BPSJHLT ;BHAM ISC/LJF - HL7 Process Incoming MFN Messages ;05-NOV-2003
"RTN","BPSJHLT",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJHLT",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJHLT",4,0)
 ;
"RTN","BPSJHLT",5,0)
 ;**Program Description**
"RTN","BPSJHLT",6,0)
 ;  This program will process incoming MFN messages and
"RTN","BPSJHLT",7,0)
 ;  update the appropriate tables
"RTN","BPSJHLT",8,0)
 ;
"RTN","BPSJHLT",9,0)
 ; Direct entry not allowed
"RTN","BPSJHLT",10,0)
 Q
"RTN","BPSJHLT",11,0)
 ;
"RTN","BPSJHLT",12,0)
PKY(PKYNM,PKYROOT,ADD) ;Lookup ien or add using PKYNM
"RTN","BPSJHLT",13,0)
 N DA,DO,DIC,DIE,DINUM,DLAYGO,DTOUT,DUOUT,Y,X
"RTN","BPSJHLT",14,0)
 I $G(PKYNM)]"",$G(PKYROOT)]"" S ADD=+$G(ADD)
"RTN","BPSJHLT",15,0)
 E  Q 0
"RTN","BPSJHLT",16,0)
 S X=PKYNM,DIC=PKYROOT
"RTN","BPSJHLT",17,0)
 I 'ADD S DIC(0)="X" D ^DIC
"RTN","BPSJHLT",18,0)
 I ADD S DIC(0)="L",DLAYGO=PKYROOT D FILE^DICN
"RTN","BPSJHLT",19,0)
 Q +Y
"RTN","BPSJHLT",20,0)
 ;
"RTN","BPSJHLT",21,0)
EN(HL) ;  Entry Point
"RTN","BPSJHLT",22,0)
 ;
"RTN","BPSJHLT",23,0)
 N BPSJACT,BPSJPKY,BPSJADT,BPSZPRER,BPSJROOT,PSIEN,APPACK
"RTN","BPSJHLT",24,0)
 N ZPRS,BPSJSEG,HCT,ERRFLAG,NAFLG,NPFLG,SEG,MSG,MCT,FLN,FILE
"RTN","BPSJHLT",25,0)
 N RBSTART,RBEND,RBCNT,ZPSNNAME,ZPRCNT,BPSETID,RCODE,MAXRX
"RTN","BPSJHLT",26,0)
 N FS,CS,PSHTVER,NCPDPVER,NCPDPCK,BPSFILE,BPSJCNT,BPSJDEVN
"RTN","BPSJHLT",27,0)
 N BPSJPROD,BPSJNAME,DIK,TCH
"RTN","BPSJHLT",28,0)
 ;
"RTN","BPSJHLT",29,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"      ; field separator
"RTN","BPSJHLT",30,0)
 S CS=$E($G(HL("ECH"))) I CS="" S CS="^"  ; component separator
"RTN","BPSJHLT",31,0)
 ;
"RTN","BPSJHLT",32,0)
 K ^TMP($J,"BPSJ-RBACK"),^TMP($J,"BPSJ-ERROR")
"RTN","BPSJHLT",33,0)
 ;
"RTN","BPSJHLT",34,0)
 D INITZPRS^BPSJZPR(.ZPRS)
"RTN","BPSJHLT",35,0)
 S BPSFILE=9002313.92,BPSJROOT=$$ROOT^DILFD(BPSFILE)
"RTN","BPSJHLT",36,0)
 S RBSTART=100,RBEND=230,NCPDPCK="51"
"RTN","BPSJHLT",37,0)
 S (ZPSNNAME,BPSJPROD,NCPDPVER,BPSJACT,BPSJADT,BPSJPKY)=""
"RTN","BPSJHLT",38,0)
 ;
"RTN","BPSJHLT",39,0)
 ; Initialize some Application Acknowledgement data
"RTN","BPSJHLT",40,0)
 D DGAPPACK^BPSJACK
"RTN","BPSJHLT",41,0)
 S APPACK("MSA",1)="AE"  ; Assume error
"RTN","BPSJHLT",42,0)
 S APPACK("MSA",2)=$G(HL("MID"))  ; Message ID
"RTN","BPSJHLT",43,0)
 S APPACK("MFA",4,1)="U" ; Set flag type of "unsuccessful event"
"RTN","BPSJHLT",44,0)
 S APPACK("MFA",6)="ST"
"RTN","BPSJHLT",45,0)
 S APPACK("MFI",6)="NE"
"RTN","BPSJHLT",46,0)
 ;
"RTN","BPSJHLT",47,0)
 ; Init encoding char array
"RTN","BPSJHLT",48,0)
 S TCH("\F\")="|",TCH("\R\")="~"
"RTN","BPSJHLT",49,0)
 S TCH("\E\")="\",TCH("\T\")="&"
"RTN","BPSJHLT",50,0)
 ;
"RTN","BPSJHLT",51,0)
 S HCT=1,(MCT,NAFLG,NPFLG,ERRFLAG,ZPRCNT,MAXRX)=0
"RTN","BPSJHLT",52,0)
 F  D  Q:'HCT  I ERRFLAG Q
"RTN","BPSJHLT",53,0)
 . K BPSJSEG S HCT=$O(^TMP($J,"BPSJHLI",HCT))
"RTN","BPSJHLT",54,0)
 . D SPAR^BPSJUTL(.HL,.BPSJSEG,HCT) S SEG=$G(BPSJSEG(1))
"RTN","BPSJHLT",55,0)
 . ;
"RTN","BPSJHLT",56,0)
 . ;                    ; payer sheet detail (multiple)
"RTN","BPSJHLT",57,0)
 . I SEG="ZPR" D  Q     ; Record #5+  (MSH is record #1)
"RTN","BPSJHLT",58,0)
 .. ;
"RTN","BPSJHLT",59,0)
 .. I ERRFLAG Q  ; Fatal Error
"RTN","BPSJHLT",60,0)
 .. S ZPRCNT=ZPRCNT+1,BPSETID=$G(BPSJSEG(2))
"RTN","BPSJHLT",61,0)
 .. ;-If not numeric equivalent the warp engines are offline, Captain
"RTN","BPSJHLT",62,0)
 .. I BPSETID'=ZPRCNT D FAKEREC(ZPRCNT)
"RTN","BPSJHLT",63,0)
 .. D EN^BPSJZPR(PSIEN,.BPSJSEG,BPSJROOT,BPSFILE)
"RTN","BPSJHLT",64,0)
 . ;
"RTN","BPSJHLT",65,0)
 . I SEG="MFI" D  Q    ; Record #2
"RTN","BPSJHLT",66,0)
 .. ;
"RTN","BPSJHLT",67,0)
 .. ;-Required Field checks
"RTN","BPSJHLT",68,0)
 .. D ERRMSG(0,"MFI","1,2,3",.BPSJSEG)
"RTN","BPSJHLT",69,0)
 .. ;
"RTN","BPSJHLT",70,0)
 .. S APPACK("MFI",1,1)=$P($G(BPSJSEG(2)),CS)
"RTN","BPSJHLT",71,0)
 .. S APPACK("MFI",1,2)=$P($G(BPSJSEG(2)),CS,2)
"RTN","BPSJHLT",72,0)
 .. I APPACK("MFI",1,1)]"",APPACK("MFI",1,2)]""
"RTN","BPSJHLT",73,0)
 .. E  D
"RTN","BPSJHLT",74,0)
 ... ; hard code these for Version 1.0 of s/w
"RTN","BPSJHLT",75,0)
 ... D FILE^DID(BPSFILE,,"NAME","BPSJNAME")
"RTN","BPSJHLT",76,0)
 ... I APPACK("MFI",1,1)="" S APPACK("MFI",1,1)=BPSFILE
"RTN","BPSJHLT",77,0)
 ... I APPACK("MFI",1,2)="" S APPACK("MFI",1,2)=$G(BPSJNAME("NAME"))
"RTN","BPSJHLT",78,0)
 ... K BPSJNAME
"RTN","BPSJHLT",79,0)
 ... ;
"RTN","BPSJHLT",80,0)
 .. S APPACK("MFI",3)=$G(BPSJSEG(4))
"RTN","BPSJHLT",81,0)
 . ;
"RTN","BPSJHLT",82,0)
 . I SEG="MFE" D  Q   ; Record #3
"RTN","BPSJHLT",83,0)
 .. ;
"RTN","BPSJHLT",84,0)
 .. ;-Required Field checks
"RTN","BPSJHLT",85,0)
 .. D ERRMSG(0,"MFE","1,2,4,5",.BPSJSEG)
"RTN","BPSJHLT",86,0)
 .. ;
"RTN","BPSJHLT",87,0)
 .. S BPSJADT=$$NOW^XLFDT()
"RTN","BPSJHLT",88,0)
 .. S (BPSJACT,APPACK("MFA",1))=$G(BPSJSEG(2))  ; Action type
"RTN","BPSJHLT",89,0)
 .. I $L(BPSJACT)=3,"^MAD^MUP^MDC^"[(U_BPSJACT_U)
"RTN","BPSJHLT",90,0)
 .. E  D ERRMSG(1,"MFE","1^INVALID EVENT CODE")
"RTN","BPSJHLT",91,0)
 .. ;
"RTN","BPSJHLT",92,0)
 .. S APPACK("MFA",2)=$G(BPSJSEG(3))       ; MFN Control ID
"RTN","BPSJHLT",93,0)
 .. ;
"RTN","BPSJHLT",94,0)
 .. ; Old/Current Sheet name
"RTN","BPSJHLT",95,0)
 .. S (BPSJPKY,APPACK("MFA",5))=$G(BPSJSEG(5))
"RTN","BPSJHLT",96,0)
 .. S APPACK("MFA",4,2)="Payer Sheet "_BPSJPKY
"RTN","BPSJHLT",97,0)
 .. S BPSJPKY=$$DECODE^BPSJZPR(BPSJPKY,.TCH)
"RTN","BPSJHLT",98,0)
 .. ;
"RTN","BPSJHLT",99,0)
 .. ;-Get ien using sheet name, if one exists
"RTN","BPSJHLT",100,0)
 .. S PSIEN=$$PKY(BPSJPKY,BPSJROOT)
"RTN","BPSJHLT",101,0)
 .. ;
"RTN","BPSJHLT",102,0)
 .. I PSIEN=0 D ERRMSG(91,"Fileman error") Q
"RTN","BPSJHLT",103,0)
 .. ;
"RTN","BPSJHLT",104,0)
 .. I PSIEN>0 D   ; Exists: save current data for rollback
"RTN","BPSJHLT",105,0)
 ... S APPACK("MFA",4,1)="P" ;Set flag type to "P"rior version
"RTN","BPSJHLT",106,0)
 ... M ^TMP($J,"BPSJ-RBACK",PSIEN)=^BPSF(9002313.92,PSIEN)
"RTN","BPSJHLT",107,0)
 ... ;-Kill appropriate existing Payer Sheet fields
"RTN","BPSJHLT",108,0)
 ... F RBCNT=RBSTART:10:RBEND K ^BPSF(9002313.92,PSIEN,RBCNT)
"RTN","BPSJHLT",109,0)
 .. ;
"RTN","BPSJHLT",110,0)
 .. ;-Create development sheet
"RTN","BPSJHLT",111,0)
 .. I PSIEN<0 S BPSJCNT=0 F  S BPSJCNT=1+BPSJCNT D  Q:PSIEN>0
"RTN","BPSJHLT",112,0)
 ... S BPSJDEVN="BPSJ-DEV-"_$J_"-"_BPSJCNT
"RTN","BPSJHLT",113,0)
 ... S PSIEN=$$PKY(BPSJDEVN,BPSJROOT)    ; see if dev sheet exists
"RTN","BPSJHLT",114,0)
 ... I PSIEN>-1 S PSIEN=0 Q
"RTN","BPSJHLT",115,0)
 ... S PSIEN=$$PKY(BPSJDEVN,BPSJROOT,1)  ; add new one
"RTN","BPSJHLT",116,0)
 .. ;
"RTN","BPSJHLT",117,0)
 .. I PSIEN=0 D ERRMSG(92,"Fileman error") Q
"RTN","BPSJHLT",118,0)
 .. ;
"RTN","BPSJHLT",119,0)
 .. ;-Flag the sheet as being in development by this process
"RTN","BPSJHLT",120,0)
 .. K DA,DIE,DR S DA=PSIEN,DIE=BPSJROOT
"RTN","BPSJHLT",121,0)
 .. S DR="1.06////1."_$J ;FOR DEVELOPMENT
"RTN","BPSJHLT",122,0)
 .. D ^DIE
"RTN","BPSJHLT",123,0)
 . ;
"RTN","BPSJHLT",124,0)
 . ;payer sheet header
"RTN","BPSJHLT",125,0)
 . I SEG="ZPS" D  Q    ; Record #4
"RTN","BPSJHLT",126,0)
 .. ;
"RTN","BPSJHLT",127,0)
 .. ;-Required Field checks
"RTN","BPSJHLT",128,0)
 .. D ERRMSG(0,"ZPS","1,2,3,4,5,6,7",.BPSJSEG)
"RTN","BPSJHLT",129,0)
 .. ;
"RTN","BPSJHLT",130,0)
 .. ;-New sheet name, production status and Payer Sheet and NCPDP versions
"RTN","BPSJHLT",131,0)
 .. S ZPSNNAME=$$DECODE^BPSJZPR($G(BPSJSEG(4)),.TCH) K TCH
"RTN","BPSJHLT",132,0)
 .. I ZPSNNAME="" S ZPSNNAME=$G(BPSJPKY)
"RTN","BPSJHLT",133,0)
 .. S BPSJPROD=$G(BPSJSEG(8)) I BPSJPROD'="P" S BPSJPROD="T"
"RTN","BPSJHLT",134,0)
 .. S PSHTVER=$G(BPSJSEG(5)) I PSHTVER'=(PSHTVER\1) S ^TMP($J,"BPSJ-ERROR","ZPS",4)=""
"RTN","BPSJHLT",135,0)
 .. S NCPDPVER=$G(BPSJSEG(6)) I NCPDPVER'=NCPDPCK S ^TMP($J,"BPSJ-ERROR","ZPS",5)=""
"RTN","BPSJHLT",136,0)
 ;
"RTN","BPSJHLT",137,0)
 I '$D(^TMP($J,"BPSJ-ERROR")) D
"RTN","BPSJHLT",138,0)
 . S APPACK("MFA",4,1)="S"  ; flag success
"RTN","BPSJHLT",139,0)
 . S DR=".01////"_ZPSNNAME  ; set the name
"RTN","BPSJHLT",140,0)
 . S DA=PSIEN,DIE=BPSJROOT D ^DIE
"RTN","BPSJHLT",141,0)
 . ;
"RTN","BPSJHLT",142,0)
 . I BPSJACT="MDC" S BPSJACT=0  ;Disabled
"RTN","BPSJHLT",143,0)
 . E  D  I 'BPSJACT S BPSJACT=0
"RTN","BPSJHLT",144,0)
 .. I BPSJPROD="P" S BPSJACT=3  ;Production
"RTN","BPSJHLT",145,0)
 .. I BPSJPROD="T" S BPSJACT=2  ;Testing
"RTN","BPSJHLT",146,0)
 . S DR="1.06////"_BPSJACT,DA=PSIEN,DIE=BPSJROOT D ^DIE
"RTN","BPSJHLT",147,0)
 . ; NCPDP Version
"RTN","BPSJHLT",148,0)
 . S DR="1.02////"_NCPDPVER,DA=PSIEN,DIE=BPSJROOT D ^DIE
"RTN","BPSJHLT",149,0)
 . ; Payer Sheet Version
"RTN","BPSJHLT",150,0)
 . S DR="1.14////"_PSHTVER,DA=PSIEN,DIE=BPSJROOT D ^DIE
"RTN","BPSJHLT",151,0)
 . ;
"RTN","BPSJHLT",152,0)
 . I BPSJACT=2 D SETTEST(ZPSNNAME,PSIEN)
"RTN","BPSJHLT",153,0)
 . ;
"RTN","BPSJHLT",154,0)
 E  I $G(PSIEN) D   ;-Roll back
"RTN","BPSJHLT",155,0)
 . ;-Remove if no prior existence
"RTN","BPSJHLT",156,0)
 . I $G(^TMP($J,"BPSJ-RBACK",PSIEN,0))="" D  Q
"RTN","BPSJHLT",157,0)
 .. S DIK=BPSJROOT,DA=PSIEN D ^DIK
"RTN","BPSJHLT",158,0)
 . ;
"RTN","BPSJHLT",159,0)
 . ; Restore old data
"RTN","BPSJHLT",160,0)
 . S ^BPSF(9002313.92,PSIEN,0)=$G(^TMP($J,"BPSJ-RBACK",PSIEN,0))
"RTN","BPSJHLT",161,0)
 . S ^BPSF(9002313.92,PSIEN,1)=$G(^TMP($J,"BPSJ-RBACK",PSIEN,1))
"RTN","BPSJHLT",162,0)
 . F RBCNT=RBSTART:10:RBEND D
"RTN","BPSJHLT",163,0)
 .. K ^BPSF(9002313.92,PSIEN,RBCNT)
"RTN","BPSJHLT",164,0)
 .. M ^BPSF(9002313.92,PSIEN,RBCNT)=^TMP($J,"BPSJ-RBACK",PSIEN,RBCNT)
"RTN","BPSJHLT",165,0)
 ;
"RTN","BPSJHLT",166,0)
 D APPACK^BPSJACK(.HL,.APPACK,PSIEN)
"RTN","BPSJHLT",167,0)
 ;
"RTN","BPSJHLT",168,0)
 K ^TMP($J,"BPSJ-RBACK"),^TMP($J,"BPSJ-ERROR")
"RTN","BPSJHLT",169,0)
 ;
"RTN","BPSJHLT",170,0)
 Q
"RTN","BPSJHLT",171,0)
 ;
"RTN","BPSJHLT",172,0)
FAKEREC(REF) ; Setup a fake Record ID (Set ID)
"RTN","BPSJHLT",173,0)
 N IX
"RTN","BPSJHLT",174,0)
 ;
"RTN","BPSJHLT",175,0)
 S REF=+$G(REF)
"RTN","BPSJHLT",176,0)
 S IX=$G(BPSJSEG(2)),BPSJSEG(2)=REF
"RTN","BPSJHLT",177,0)
 I IX="" D  Q   ; Missing
"RTN","BPSJHLT",178,0)
 . S ^TMP($J,"BPSJ-ERROR","ZPR",REF,1)="V631-1,"_REF
"RTN","BPSJHLT",179,0)
 ;
"RTN","BPSJHLT",180,0)
 I IX=+IX,IX'=0
"RTN","BPSJHLT",181,0)
 E  D  Q          ; Invalid
"RTN","BPSJHLT",182,0)
 . S ^TMP($J,"BPSJ-ERROR","ZPR",REF,1)="V631-2,"_REF
"RTN","BPSJHLT",183,0)
 ;
"RTN","BPSJHLT",184,0)
 ; We have a valid numeric to work with, but:
"RTN","BPSJHLT",185,0)
 ;
"RTN","BPSJHLT",186,0)
 ; Duplicate
"RTN","BPSJHLT",187,0)
 I $G(^TMP($J,"BPSJ-ERROR","ZPR",IX))=IX D  Q
"RTN","BPSJHLT",188,0)
 . S ^TMP($J,"BPSJ-ERROR","ZPR",REF,1)="V631-4,"_REF
"RTN","BPSJHLT",189,0)
 ;
"RTN","BPSJHLT",190,0)
 ; Out Of Sequence
"RTN","BPSJHLT",191,0)
 S ^TMP($J,"BPSJ-ERROR","ZPR",REF,1)="V631-3,"_REF
"RTN","BPSJHLT",192,0)
 S ^TMP($J,"BPSJ-ERROR","ZPR",REF)=IX
"RTN","BPSJHLT",193,0)
 ;
"RTN","BPSJHLT",194,0)
 Q
"RTN","BPSJHLT",195,0)
 ;
"RTN","BPSJHLT",196,0)
ERRMSG(SPECIAL,SEG,REQFLDS,BPSJSEG) ;
"RTN","BPSJHLT",197,0)
 N FCNT,FNO,FIELD,C
"RTN","BPSJHLT",198,0)
 S C=",",SPECIAL=+$G(SPECIAL),SEG=$G(SEG),REQFLDS=$G(REQFLDS)
"RTN","BPSJHLT",199,0)
 I 'SPECIAL D  Q
"RTN","BPSJHLT",200,0)
 . ;-Evaluate required fields for non ZPR segs
"RTN","BPSJHLT",201,0)
 . S FNO=$J(REQFLDS,C)
"RTN","BPSJHLT",202,0)
 . F FCNT=1:1:FNO S FIELD=$P(REQFLDS,C,FCNT) I FIELD D
"RTN","BPSJHLT",203,0)
 .. ;-Set flag for empty required field
"RTN","BPSJHLT",204,0)
 .. I $G(BPSJSEG(FIELD+1))="" S ^TMP($J,"BPSJ-ERROR",SEG,FIELD)=""
"RTN","BPSJHLT",205,0)
 ;
"RTN","BPSJHLT",206,0)
 ;-"Special" handler
"RTN","BPSJHLT",207,0)
 I SPECIAL=1 D  Q
"RTN","BPSJHLT",208,0)
 . ;-Set flag that field contains invalid value
"RTN","BPSJHLT",209,0)
 . S ^TMP($J,"BPSJ-ERROR",SEG,+REQFLDS)=REQFLDS
"RTN","BPSJHLT",210,0)
 ;
"RTN","BPSJHLT",211,0)
 I SPECIAL>90 S ERRFLAG=1
"RTN","BPSJHLT",212,0)
 Q
"RTN","BPSJHLT",213,0)
 ;
"RTN","BPSJHLT",214,0)
SETTEST(TESTNAME,TESTIX) ; Test payer sheet handler
"RTN","BPSJHLT",215,0)
 ; Massage to look like production version
"RTN","BPSJHLT",216,0)
 ;
"RTN","BPSJHLT",217,0)
 N PRODNM,PCNT,PRODIX,PRODDATA,TESTDATA,REVERSE
"RTN","BPSJHLT",218,0)
 ;
"RTN","BPSJHLT",219,0)
 I '$G(TESTIX) Q
"RTN","BPSJHLT",220,0)
 ; Derive production version name
"RTN","BPSJHLT",221,0)
 ;  if test version name = ABCDE-001 then Prod version name = ABCDE
"RTN","BPSJHLT",222,0)
 S PCNT=$L($G(TESTNAME),"-")-1 I PCNT<1 Q
"RTN","BPSJHLT",223,0)
 S PRODNM=$P(TESTNAME,"-",1,PCNT)
"RTN","BPSJHLT",224,0)
 ; Find Production version & get data if exists
"RTN","BPSJHLT",225,0)
 S PRODIX=$O(^BPSF(9002313.92,"B",PRODNM,"")) I 'PRODIX Q
"RTN","BPSJHLT",226,0)
 S PRODDATA=$G(^BPSF(9002313.92,PRODIX,1)) I PRODDATA="" Q
"RTN","BPSJHLT",227,0)
 ; Get this test version's data
"RTN","BPSJHLT",228,0)
 S TESTDATA=$G(^BPSF(9002313.92,TESTIX,1))
"RTN","BPSJHLT",229,0)
 ; load test fields from production
"RTN","BPSJHLT",230,0)
 S $P(TESTDATA,U,3)=$P(PRODDATA,U,3)    ;Maximum RX's Per Claim
"RTN","BPSJHLT",231,0)
 S $P(TESTDATA,U,7)=$P(PRODDATA,U,7)    ;Is A Reversal Format
"RTN","BPSJHLT",232,0)
 S $P(TESTDATA,U,13)=$P(PRODDATA,U,13)  ;SOFTWARE VENDOR/CERT ID
"RTN","BPSJHLT",233,0)
 S ^BPSF(9002313.92,TESTIX,1)=TESTDATA
"RTN","BPSJHLT",234,0)
 ; Get Reversal Format pointer
"RTN","BPSJHLT",235,0)
 S REVERSE=$G(^BPSF(9002313.92,PRODIX,"REVERSAL"))
"RTN","BPSJHLT",236,0)
 ; Set test sheet to itself if production sheet points to itself.
"RTN","BPSJHLT",237,0)
 I REVERSE=PRODIX S REVERSE=TESTIX
"RTN","BPSJHLT",238,0)
 S ^BPSF(9002313.92,TESTIX,"REVERSAL")=REVERSE
"RTN","BPSJHLT",239,0)
 ;
"RTN","BPSJHLT",240,0)
 Q
"RTN","BPSJINI1")
0^352^B20176164
"RTN","BPSJINI1",1,0)
BPSJINI1 ;BHAM ISC/LJF - HL7 Application Registration ;21-NOV-2003
"RTN","BPSJINI1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJINI1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJINI1",4,0)
 ;
"RTN","BPSJINI1",5,0)
 Q  ; No direct entry allowed
"RTN","BPSJINI1",6,0)
 ;
"RTN","BPSJINI1",7,0)
 ; Operating Hours
"RTN","BPSJINI1",8,0)
 ;
"RTN","BPSJINI1",9,0)
EN(PHRMIX) ;
"RTN","BPSJINI1",10,0)
 N HOURS,HROPEN,HRCLOSE,TAB,BPSJWAIT,BPSJANS,BPSJOH,DTOUT
"RTN","BPSJINI1",11,0)
 ;
"RTN","BPSJINI1",12,0)
 S HROPEN=$G(^BPS(9002313.56,PHRMIX,"TOPEN"))
"RTN","BPSJINI1",13,0)
 S HRCLOSE=$G(^BPS(9002313.56,PHRMIX,"TCLOSE"))
"RTN","BPSJINI1",14,0)
 ; initialize to standard hours or ensure hours are valid
"RTN","BPSJINI1",15,0)
 I HROPEN="" D
"RTN","BPSJINI1",16,0)
 . S HROPEN="^0800^0800^0800^0800^0800^0800"
"RTN","BPSJINI1",17,0)
 . S HRCLOSE="^1600^1600^1600^1600^1600^1600"
"RTN","BPSJINI1",18,0)
 E  F BPSJOH=1:1:7 D
"RTN","BPSJINI1",19,0)
 . I $P(HROPEN,U,BPSJOH)="" S $P(HRCLOSE,U,BPSJOH)="" Q
"RTN","BPSJINI1",20,0)
 . I $P(HROPEN,U,BPSJOH)<$P(HRCLOSE,U,BPSJOH) Q
"RTN","BPSJINI1",21,0)
 . S $P(HROPEN,U,BPSJOH)="",$P(HRCLOSE,U,BPSJOH)=""
"RTN","BPSJINI1",22,0)
 ;
"RTN","BPSJINI1",23,0)
 S BPSJWAIT=300    ; time out for questions
"RTN","BPSJINI1",24,0)
 ;
"RTN","BPSJINI1",25,0)
 F  D  Q:BPSJANS=""
"RTN","BPSJINI1",26,0)
 . W !!,"DAILY HOURS OF OPERATION",!
"RTN","BPSJINI1",27,0)
 . W "DAY",?16,"1-SUN",?24,"2-MON",?32,"3-TUE",?40,"4-WED",?48,"5-THU",?56,"6-FRI",?64,"7-SAT",!
"RTN","BPSJINI1",28,0)
 . S BPSJANS=0
"RTN","BPSJINI1",29,0)
 . W !,"OPEN TIME" F BPSJOH=1:1:7 S TAB="?"_(BPSJOH*8+8) W @TAB,$P(HROPEN,U,BPSJOH)
"RTN","BPSJINI1",30,0)
 . W !,"CLOSE TIME" F BPSJOH=1:1:7 S TAB="?"_(BPSJOH*8+8) W @TAB,$P(HRCLOSE,U,BPSJOH)
"RTN","BPSJINI1",31,0)
 . S BPSJANS=$$EDITDAY(.HROPEN,.HRCLOSE) I BPSJANS="^" S BPSJANS=""
"RTN","BPSJINI1",32,0)
 ;
"RTN","BPSJINI1",33,0)
 S ^BPS(9002313.56,PHRMIX,"TOPEN")=HROPEN
"RTN","BPSJINI1",34,0)
 S ^BPS(9002313.56,PHRMIX,"TCLOSE")=HRCLOSE
"RTN","BPSJINI1",35,0)
 W !
"RTN","BPSJINI1",36,0)
 ;
"RTN","BPSJINI1",37,0)
 Q
"RTN","BPSJINI1",38,0)
 ;
"RTN","BPSJINI1",39,0)
EDITDAY(HROPEN,HRCLOSE) ;
"RTN","BPSJINI1",40,0)
 ;
"RTN","BPSJINI1",41,0)
 N BPSJDAY,BPSJT,BPSJO,BPSJC,DIR,X
"RTN","BPSJINI1",42,0)
 ;
"RTN","BPSJINI1",43,0)
 W !
"RTN","BPSJINI1",44,0)
 S DIR("A")="Enter Day to Edit"
"RTN","BPSJINI1",45,0)
 S DIR("?")="^D DOC^BPSJINI1(0)"
"RTN","BPSJINI1",46,0)
 S DIR(0)="NO^1:7"
"RTN","BPSJINI1",47,0)
 D ^DIR S BPSJDAY=X  ; ^,1-7,null
"RTN","BPSJINI1",48,0)
 I '$G(DTOUT),BPSJDAY
"RTN","BPSJINI1",49,0)
 E  Q BPSJDAY  ; Non-Numeric or Zero or Timed out
"RTN","BPSJINI1",50,0)
 ;
"RTN","BPSJINI1",51,0)
 ;OPEN TIME
"RTN","BPSJINI1",52,0)
 F  S BPSJO=$$OPENTIME  Q:BPSJO=0
"RTN","BPSJINI1",53,0)
 ;
"RTN","BPSJINI1",54,0)
 Q 0
"RTN","BPSJINI1",55,0)
 ;
"RTN","BPSJINI1",56,0)
OPENTIME() ;
"RTN","BPSJINI1",57,0)
 N HH,MM,OPEN,DIR,X
"RTN","BPSJINI1",58,0)
 ;
"RTN","BPSJINI1",59,0)
 S DIR("?")="^D DOC^BPSJINI1(1)"
"RTN","BPSJINI1",60,0)
 S DIR("A")="Enter Open Time (4 digit military time, C=Closed,24 for open 24 hours)"
"RTN","BPSJINI1",61,0)
 S DIR(0)="FOU^0:4"
"RTN","BPSJINI1",62,0)
 D ^DIR S OPEN=X
"RTN","BPSJINI1",63,0)
 I '$G(DTOUT),$L(OPEN),$E(OPEN)'="^"
"RTN","BPSJINI1",64,0)
 E  Q 0
"RTN","BPSJINI1",65,0)
 ;
"RTN","BPSJINI1",66,0)
 I $TR($E(OPEN),"c","C")="C" S $P(HROPEN,U,BPSJDAY)="",$P(HRCLOSE,U,BPSJDAY)="" Q 0
"RTN","BPSJINI1",67,0)
 I OPEN=24 S $P(HROPEN,U,BPSJDAY)="0000",$P(HRCLOSE,U,BPSJDAY)="2359" Q 0
"RTN","BPSJINI1",68,0)
 I OPEN?4N
"RTN","BPSJINI1",69,0)
 E  W !!,"INVALID TIME ENTERED" D DOC(1) Q 1
"RTN","BPSJINI1",70,0)
 S HH=$E(OPEN,1,2),MM=$E(OPEN,3,4)
"RTN","BPSJINI1",71,0)
 I OPEN>-1,OPEN<2359
"RTN","BPSJINI1",72,0)
 E  W !!,"INVALID TIME: OPEN TIME MUST BE FROM 0000 TO 2358." Q 1
"RTN","BPSJINI1",73,0)
 I MM>59 W !!,"INVALID TIME: MINUTES MUST FROM 00 TO 59." Q 1
"RTN","BPSJINI1",74,0)
 I HH>23 W !!,"INVALID TIME: HOURS MUST BE FROM 00 AND 23." Q 1
"RTN","BPSJINI1",75,0)
 ;
"RTN","BPSJINI1",76,0)
 ;Close Time
"RTN","BPSJINI1",77,0)
 F  S BPSJC=$$ENDTIME Q:$L(BPSJC)
"RTN","BPSJINI1",78,0)
 I BPSJC S $P(HROPEN,U,BPSJDAY)=OPEN,$P(HRCLOSE,U,BPSJDAY)=BPSJC
"RTN","BPSJINI1",79,0)
 Q 0
"RTN","BPSJINI1",80,0)
 ;
"RTN","BPSJINI1",81,0)
ENDTIME() ;
"RTN","BPSJINI1",82,0)
 N CLOSE,DIR,X
"RTN","BPSJINI1",83,0)
 S DIR("?")="^D DOC^BPSJINI1(2)"
"RTN","BPSJINI1",84,0)
 S DIR("A")="Enter Close Time (4 digit military time)"
"RTN","BPSJINI1",85,0)
 S DIR(0)="FOU^4:4"
"RTN","BPSJINI1",86,0)
 D ^DIR S CLOSE=X
"RTN","BPSJINI1",87,0)
 I '$G(DTOUT),$L(CLOSE),$E(CLOSE)'="^"
"RTN","BPSJINI1",88,0)
 E  Q 0
"RTN","BPSJINI1",89,0)
 S HH=$E(CLOSE,1,2),MM=$E(CLOSE,3,4)
"RTN","BPSJINI1",90,0)
 I MM>59 W !!,"INVALID TIME: MINUTES MUST FROM 00 TO 59." Q ""
"RTN","BPSJINI1",91,0)
 I HH>23 W !!,"INVALID TIME: HOURS MUST BE FROM 00 AND 23." Q ""
"RTN","BPSJINI1",92,0)
 I CLOSE>0,CLOSE<2400
"RTN","BPSJINI1",93,0)
 E  W !!,"INVALID TIME: CLOSE TIME MUST BE FROM 0001 TO 2359." Q ""
"RTN","BPSJINI1",94,0)
 I CLOSE<(OPEN+1) W !!,"INVALID TIME: CLOSE TIME MUST BE LATER THAN OPEN TIME." Q ""
"RTN","BPSJINI1",95,0)
 Q CLOSE
"RTN","BPSJINI1",96,0)
 ;
"RTN","BPSJINI1",97,0)
DOC(DOCIX) ;
"RTN","BPSJINI1",98,0)
 I $G(DOCIX)="" Q
"RTN","BPSJINI1",99,0)
 I DOCIX=0 D  Q
"RTN","BPSJINI1",100,0)
 .W !,"ENTER 1 TO INDICATE SUNDAY, 2 FOR MONDAY ... 7 FOR SATURDAY",!
"RTN","BPSJINI1",101,0)
 .W !,"ENTER <CR> OR '^' TO EXIT."
"RTN","BPSJINI1",102,0)
 ;
"RTN","BPSJINI1",103,0)
 I DOCIX=1 D  Q
"RTN","BPSJINI1",104,0)
 .W !,"ENTER C TO INDICATE THE PHARMACY IS CLOSED ON THIS DAY."
"RTN","BPSJINI1",105,0)
 .W !," (NO CLOSING TIME WILL BE REQUESTED)",!
"RTN","BPSJINI1",106,0)
 .W !,"ENTER 24 TO INDIACTE THE PHARMACY IS OPEN FOR THE ENTIRE 24 HOURS OF THIS DAY."
"RTN","BPSJINI1",107,0)
 .W !," (NO CLOSING TIME WILL BE REQUESTED)",!
"RTN","BPSJINI1",108,0)
 .W !,"ENTER A MILITARY TIME FROM 0000 TO 2358."
"RTN","BPSJINI1",109,0)
 .W !," (THIS WILL ALLOW THE PHARMACY TO BE OPEN FOR AT LEAST 1 MINUTE IF DESIRED)"
"RTN","BPSJINI1",110,0)
 .W !," A CLOSING TIME WILL BE REQUESTED AND THE ALLOWED TIME WILL BE FROM 1 MINUTE"
"RTN","BPSJINI1",111,0)
 .W !,"  AFTER OPENING TIME TO 2359.",!!!
"RTN","BPSJINI1",112,0)
 ;
"RTN","BPSJINI1",113,0)
 I DOCIX=2 D  Q
"RTN","BPSJINI1",114,0)
 .W !,"ENTER A MILITARY TIME FROM 0001 TO 2359."
"RTN","BPSJINI1",115,0)
 .W !," THE CLOSING TIME MUST BE AT LEAST 1 MINUTE AFTER THE OPENING TIME, UP TO 2359.",!!!
"RTN","BPSJINI1",116,0)
 ;
"RTN","BPSJINI1",117,0)
 Q
"RTN","BPSJINIT")
0^353^B34990565
"RTN","BPSJINIT",1,0)
BPSJINIT ;BHAM ISC/LJF - HL7 Application Registration ;21-NOV-2003
"RTN","BPSJINIT",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJINIT",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJINIT",4,0)
 ;
"RTN","BPSJINIT",5,0)
 N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",6,0)
 N BPVALFN,BPSJAPPR,BPSJVALR,PHIX,DT,DUZ
"RTN","BPSJINIT",7,0)
 ;
"RTN","BPSJINIT",8,0)
 ;  This program will allow user to enter site data.
"RTN","BPSJINIT",9,0)
 ;
"RTN","BPSJINIT",10,0)
 ; Programmer Note: D BPSJVAL^BPSJAREG(X) will validate with following.
"RTN","BPSJINIT",11,0)
 ;   where X is: 0 = HL7 trigger, no validation display
"RTN","BPSJINIT",12,0)
 ;               1 = HL7 trigger, display validation
"RTN","BPSJINIT",13,0)
 ;               2 = no HL7 trigger, display validation
"RTN","BPSJINIT",14,0)
 ;               3 = no validation display, no HL7 trigger
"RTN","BPSJINIT",15,0)
 ;
"RTN","BPSJINIT",16,0)
 D DT^DICRW S DUZ(0)="@",DT=$$NOW^XLFDT
"RTN","BPSJINIT",17,0)
 D HOME^%ZIS,CLEAR^VALM1
"RTN","BPSJINIT",18,0)
 W !!!,"ENTER/VERIFY SITE REGISTRATION DATA.",!!
"RTN","BPSJINIT",19,0)
 ;
"RTN","BPSJINIT",20,0)
 S BPVALFN=9002313.99
"RTN","BPSJINIT",21,0)
 ; Set Version number to 2 if not set or not an integer > 1
"RTN","BPSJINIT",22,0)
 S DA=$O(^BPS(BPVALFN,0)),DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",23,0)
 I 'DA S DA=1 D
"RTN","BPSJINIT",24,0)
 . S DR=".01////BPS SETUP #1" D ^DIE
"RTN","BPSJINIT",25,0)
 . S DR="6003////2" D ^DIE
"RTN","BPSJINIT",26,0)
 ;
"RTN","BPSJINIT",27,0)
 K DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",28,0)
 S DR=$P($G(^BPS(BPVALFN,DA,"VITRIA")),U,3)
"RTN","BPSJINIT",29,0)
 I DR>1,DR=+DR
"RTN","BPSJINIT",30,0)
 E  S DIE=$$ROOT^DILFD(BPVALFN),DR="6003////2" D ^DIE
"RTN","BPSJINIT",31,0)
 ;
"RTN","BPSJINIT",32,0)
 W !!,"PRIMARY SITE CONTACT DATA."
"RTN","BPSJINIT",33,0)
 K DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",34,0)
 S DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",35,0)
 S DR="[BPSJ CONTACT ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",36,0)
 ;
"RTN","BPSJINIT",37,0)
 W !!,"ALTERNATE SITE CONTACT DATA."
"RTN","BPSJINIT",38,0)
 K DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",39,0)
 S DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",40,0)
 S DR="[BPSJ ALT CONTACT ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",41,0)
 ;
"RTN","BPSJINIT",42,0)
 D HOME^%ZIS,CLEAR^VALM1
"RTN","BPSJINIT",43,0)
 W !!!,"-- APPLICATION REGISTRATION VALIDATION RESULTS. --",!!
"RTN","BPSJINIT",44,0)
 S BPSJVALR=-1
"RTN","BPSJINIT",45,0)
 D BPSJVAL^BPSJAREG(2)
"RTN","BPSJINIT",46,0)
 S BPSJAPPR=BPSJVALR
"RTN","BPSJINIT",47,0)
 ;
"RTN","BPSJINIT",48,0)
 I 'BPSJAPPR W !!,"-- APPLICATION REGISTRATION DATA VALID. --",!
"RTN","BPSJINIT",49,0)
 E  D
"RTN","BPSJINIT",50,0)
 . W !!,"** APPLICATION REGISTRATION DATA INVALID!!!  **"
"RTN","BPSJINIT",51,0)
 . W !,"**  APPLICATION REGISTRATION AND PHARMACY    **"
"RTN","BPSJINIT",52,0)
 . W !,"**    REGISTRATIONS WILL NOT BE SENT!        **",!
"RTN","BPSJINIT",53,0)
 ;
"RTN","BPSJINIT",54,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",55,0)
 S DIR(0)="EO" D ^DIR I X=U Q
"RTN","BPSJINIT",56,0)
 ;
"RTN","BPSJINIT",57,0)
 D PHARM
"RTN","BPSJINIT",58,0)
 I BPSJAPPR D  Q
"RTN","BPSJINIT",59,0)
 . W !!,"REGISTRATION ABORTED DUE TO INVALID SITE REGISTRATION DATA.",!!
"RTN","BPSJINIT",60,0)
 ;
"RTN","BPSJINIT",61,0)
 D HOME^%ZIS,CLEAR^VALM1
"RTN","BPSJINIT",62,0)
 W !!!,"APPLICATION REGISTRATION DATA IS VALID."
"RTN","BPSJINIT",63,0)
 W !!,"PHARMACY REGISTRATION DATA IS:"
"RTN","BPSJINIT",64,0)
 S PHIX=$O(^BPS(9002313.56,0))
"RTN","BPSJINIT",65,0)
 F  Q:'PHIX  D  S PHIX=$O(^BPS(9002313.56,PHIX))
"RTN","BPSJINIT",66,0)
 . S BPSJVALR=-1 D REG^BPSJPREG(PHIX,3)
"RTN","BPSJINIT",67,0)
 . I BPSJVALR>0 S DIR=" *INVALID",DIE=" and will NOT be transmitted."
"RTN","BPSJINIT",68,0)
 . E  S DIR="    VALID",DIE=" and will be transmitted."
"RTN","BPSJINIT",69,0)
 . W !,DIR_" for "_$P($G(^BPS(9002313.56,PHIX,0)),U)_DIE
"RTN","BPSJINIT",70,0)
 W !
"RTN","BPSJINIT",71,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",72,0)
 S DIR(0)="YEO",DIR("A")="SEND APPLICATION REGISTRATION: Y/N " D ^DIR
"RTN","BPSJINIT",73,0)
 I $TR($E(X),"y","Y")'="Y" Q
"RTN","BPSJINIT",74,0)
 ;
"RTN","BPSJINIT",75,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",76,0)
 D BPSJVAL^BPSJAREG(0)
"RTN","BPSJINIT",77,0)
 W !!,"APPLICATION REGISTRATION SUBMITTED."
"RTN","BPSJINIT",78,0)
 Q
"RTN","BPSJINIT",79,0)
 ;
"RTN","BPSJINIT",80,0)
PHARM ;CYCLE THROUGH PHARMACIES
"RTN","BPSJINIT",81,0)
 ;
"RTN","BPSJINIT",82,0)
 N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",83,0)
 N BPVALFN,BPSJVALR,DT,DUZ,BPSJPHPR
"RTN","BPSJINIT",84,0)
 ;
"RTN","BPSJINIT",85,0)
 D DT^DICRW S DUZ(0)="@",DT=$$NOW^XLFDT
"RTN","BPSJINIT",86,0)
 ;
"RTN","BPSJINIT",87,0)
 S BPVALFN=9002313.56,PHIX=0
"RTN","BPSJINIT",88,0)
 ;
"RTN","BPSJINIT",89,0)
 F  D  Q:PHIX=""
"RTN","BPSJINIT",90,0)
 . D HOME^%ZIS,CLEAR^VALM1
"RTN","BPSJINIT",91,0)
 . W !!!,"ENTER/VERIFY PHARMACY REGISTRATION DATA."
"RTN","BPSJINIT",92,0)
 . W !!,"PHARMACY SPECIFIC DATA."
"RTN","BPSJINIT",93,0)
 . K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",94,0)
 . S DIC(0)="QAELM",DIC=BPVALFN,DLAYGO=DIC D ^DIC
"RTN","BPSJINIT",95,0)
 . ;
"RTN","BPSJINIT",96,0)
 . I X'=U,0<+Y S PHIX=+Y
"RTN","BPSJINIT",97,0)
 . E  S PHIX="" Q
"RTN","BPSJINIT",98,0)
 . D MOD I 'PHIX Q
"RTN","BPSJINIT",99,0)
 . D HOME^%ZIS,CLEAR^VALM1
"RTN","BPSJINIT",100,0)
 . W !!!,"-- PHARMACY REGISTRATION VALIDATION RESULTS. --",!
"RTN","BPSJINIT",101,0)
 . ;
"RTN","BPSJINIT",102,0)
 . S BPSJVALR=-1
"RTN","BPSJINIT",103,0)
 . D REG^BPSJPREG(PHIX,2)
"RTN","BPSJINIT",104,0)
 . S BPSJPHPR=BPSJVALR
"RTN","BPSJINIT",105,0)
 . ;
"RTN","BPSJINIT",106,0)
 . I 'BPSJPHPR W !!,"-- PHARMACY REGISTRATION DATA VALID. --",!
"RTN","BPSJINIT",107,0)
 . E  D
"RTN","BPSJINIT",108,0)
 .. W !!,"**     PHARMACY REGISTRATION DATA INVALID!!!      **"
"RTN","BPSJINIT",109,0)
 .. W !,"** THIS PHARMACY'S REGISTRATION WILL NOT BE SENT! **",!
"RTN","BPSJINIT",110,0)
 . ;
"RTN","BPSJINIT",111,0)
 . K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",112,0)
 . S DIR(0)="EO",DIR("A")="Enter RETURN to continue" D ^DIR
"RTN","BPSJINIT",113,0)
 ;
"RTN","BPSJINIT",114,0)
 Q
"RTN","BPSJINIT",115,0)
 ;
"RTN","BPSJINIT",116,0)
MOD ;
"RTN","BPSJINIT",117,0)
 N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",118,0)
 ;
"RTN","BPSJINIT",119,0)
 ; Set hours to default if not set.
"RTN","BPSJINIT",120,0)
 S DA=$$OPHOURS^BPSJZRP(PHIX),DR=$G(^BPS(9002313.56,PHIX,"HOURS"))
"RTN","BPSJINIT",121,0)
 I $P(DR,U,2,5)'=DA S ^BPS(9002313.56,PHIX,"HOURS")="24"_U_DA
"RTN","BPSJINIT",122,0)
 ;
"RTN","BPSJINIT",123,0)
 W !!,"SITE DATA."
"RTN","BPSJINIT",124,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",125,0)
 S DA=PHIX,DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",126,0)
 S DR="[BPSJ PHARMACY SITE ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",127,0)
 ;
"RTN","BPSJINIT",128,0)
 I '$G(DA) S PHIX=0 Q   ; Pharmacy killed by user
"RTN","BPSJINIT",129,0)
 ;
"RTN","BPSJINIT",130,0)
 ; Pharmacy open hours
"RTN","BPSJINIT",131,0)
 I '$D(Y) D EN^BPSJINI1(PHIX)
"RTN","BPSJINIT",132,0)
 ;
"RTN","BPSJINIT",133,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",134,0)
 S DIR(0)="EO" D ^DIR
"RTN","BPSJINIT",135,0)
 ;
"RTN","BPSJINIT",136,0)
 I X=U Q
"RTN","BPSJINIT",137,0)
 ;
"RTN","BPSJINIT",138,0)
 W !!,"PRIMARY CONTACT DATA."
"RTN","BPSJINIT",139,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",140,0)
 S DA=PHIX,DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",141,0)
 S DR="[BPSJ PHARM CONTACT ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",142,0)
 ;
"RTN","BPSJINIT",143,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",144,0)
 S DIR(0)="EO" D ^DIR
"RTN","BPSJINIT",145,0)
 ;
"RTN","BPSJINIT",146,0)
 I X=U Q
"RTN","BPSJINIT",147,0)
 ;
"RTN","BPSJINIT",148,0)
 W !!,"ALTERNATE CONTACT DATA."
"RTN","BPSJINIT",149,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",150,0)
 S DA=PHIX,DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",151,0)
 S DR="[BPSJ PHARM ALT CONT ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",152,0)
 ;
"RTN","BPSJINIT",153,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",154,0)
 S DIR(0)="EO" D ^DIR
"RTN","BPSJINIT",155,0)
 ;
"RTN","BPSJINIT",156,0)
 I X=U Q
"RTN","BPSJINIT",157,0)
 ;
"RTN","BPSJINIT",158,0)
 W !!,"PHARMACIST DATA."  ; VA LEAD PHARMACIST
"RTN","BPSJINIT",159,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",160,0)
 S DA=PHIX,DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",161,0)
 S DR="[BPSJ PHARMACIST ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",162,0)
 ;
"RTN","BPSJINIT",163,0)
 I $D(Y) Q
"RTN","BPSJINIT",164,0)
 ;
"RTN","BPSJINIT",165,0)
 ; VA LEAD PHARMACIST LICENSE
"RTN","BPSJINIT",166,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",167,0)
 S DA=PHIX,DIE=$$ROOT^DILFD(BPVALFN)
"RTN","BPSJINIT",168,0)
 S DR="1900.04//" D ^DIE
"RTN","BPSJINIT",169,0)
 ;
"RTN","BPSJINIT",170,0)
 Q
"RTN","BPSJINIT",171,0)
 ;
"RTN","BPSJINIT",172,0)
VALIDATE ;  this will only validate the Application Registration and
"RTN","BPSJINIT",173,0)
 ;          the Pharmacy registrations
"RTN","BPSJINIT",174,0)
 Q
"RTN","BPSJINIT",175,0)
 N AREG
"RTN","BPSJINIT",176,0)
 ;
"RTN","BPSJINIT",177,0)
 D BPSJVAL^BPSJAREG(2)
"RTN","BPSJINIT",178,0)
 ;
"RTN","BPSJINIT",179,0)
 S DIR(0)="EO"
"RTN","BPSJINIT",180,0)
 D ^DIR
"RTN","BPSJINIT",181,0)
 I X=U Q
"RTN","BPSJINIT",182,0)
 ;
"RTN","BPSJINIT",183,0)
 S AREG="" F  S AREG=$O(^BPS(9002313.56,AREG)) Q:'AREG  D  I X=U Q
"RTN","BPSJINIT",184,0)
 . D REG^BPSJPREG(AREG,2)
"RTN","BPSJINIT",185,0)
 . S DIR(0)="EO"
"RTN","BPSJINIT",186,0)
 . D ^DIR
"RTN","BPSJINIT",187,0)
 ;
"RTN","BPSJINIT",188,0)
 Q
"RTN","BPSJPAY")
0^297^B3474496
"RTN","BPSJPAY",1,0)
BPSJPAY ;BHAM ISC/DMB - e-Pharmacy Payer Sheet Code ;28-SEP-2004
"RTN","BPSJPAY",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJPAY",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJPAY",4,0)
 ; Fileman access to VA(200) supported by DBIA 10060
"RTN","BPSJPAY",5,0)
 ;
"RTN","BPSJPAY",6,0)
 ; Must enter at tag STLIC
"RTN","BPSJPAY",7,0)
 Q
"RTN","BPSJPAY",8,0)
 ;
"RTN","BPSJPAY",9,0)
 ; Subroutine to get State DEA and State Credentialing License Numbers
"RTN","BPSJPAY",10,0)
STLIC(MEDN,PIEN,DOS) ;
"RTN","BPSJPAY",11,0)
 ; Input variable:
"RTN","BPSJPAY",12,0)
 ;    MEDN - Index number indicating what medication is being processed (parameter)
"RTN","BPSJPAY",13,0)
 ;    PIEN - Provider IEN for provider being processed (parameter)
"RTN","BPSJPAY",14,0)
 ;    DOS  - Service Date (parameter)
"RTN","BPSJPAY",15,0)
 ;    U    - Delimiter (System variable)
"RTN","BPSJPAY",16,0)
 ; Output variables
"RTN","BPSJPAY",17,0)
 ;    State DEA License - 
"RTN","BPSJPAY",18,0)
 ;        BPS("RX",RX number,"Prescriber State DEA #",State Abbrev)=ID
"RTN","BPSJPAY",19,0)
 ;    State Credentialling ID -
"RTN","BPSJPAY",20,0)
 ;        BPS("RX",RX number,"Prescriber State License #",State Abbrev)=ID
"RTN","BPSJPAY",21,0)
 ;
"RTN","BPSJPAY",22,0)
 ; Check that first two parameters are not null
"RTN","BPSJPAY",23,0)
 I MEDN=""!(PIEN="") G STLIC2
"RTN","BPSJPAY",24,0)
 N IEN,X,STATE,ID,EXPDT,BPSVA,DISYS
"RTN","BPSJPAY",25,0)
 ;
"RTN","BPSJPAY",26,0)
 ; Get IDs from New Person File
"RTN","BPSJPAY",27,0)
 D GETS^DIQ(200,PIEN_",","54.1*;54.2*","I","BPSVA")
"RTN","BPSJPAY",28,0)
 ;
"RTN","BPSJPAY",29,0)
 ; State Issued DEA number
"RTN","BPSJPAY",30,0)
 S IEN="" F  S IEN=$O(BPSVA(200.55,IEN)) Q:IEN=""  D
"RTN","BPSJPAY",31,0)
 . S STATE=$G(BPSVA(200.55,IEN,.01,"I"))
"RTN","BPSJPAY",32,0)
 . S ID=$G(BPSVA(200.55,IEN,1,"I"))
"RTN","BPSJPAY",33,0)
 . I STATE=""!(ID="") Q
"RTN","BPSJPAY",34,0)
 . S STATE=$P($G(^DIC(5,STATE,0)),"^",2)
"RTN","BPSJPAY",35,0)
 . I STATE="" Q
"RTN","BPSJPAY",36,0)
 . S BPS("RX",MEDN,"Prescriber State DEA #",STATE)=ID
"RTN","BPSJPAY",37,0)
 ;
"RTN","BPSJPAY",38,0)
 ; Get State Credentialing License Number
"RTN","BPSJPAY",39,0)
 I DOS="" G STLIC2
"RTN","BPSJPAY",40,0)
 S IEN="" F  S IEN=$O(BPSVA(200.541,IEN)) Q:IEN=""  D
"RTN","BPSJPAY",41,0)
 . S STATE=$G(BPSVA(200.541,IEN,.01,"I"))
"RTN","BPSJPAY",42,0)
 . S ID=$G(BPSVA(200.541,IEN,1,"I"))
"RTN","BPSJPAY",43,0)
 . S EXPDT=$G(BPSVA(200.541,IEN,2,"I"))
"RTN","BPSJPAY",44,0)
 . I STATE=""!(ID="") Q
"RTN","BPSJPAY",45,0)
 . ; If there is a expiration date, check to see if the license is valid
"RTN","BPSJPAY",46,0)
 . ;   as of the service date
"RTN","BPSJPAY",47,0)
 . I EXPDT,EXPDT+17000000<DOS Q
"RTN","BPSJPAY",48,0)
 . S STATE=$P($G(^DIC(5,STATE,0)),"^",2)
"RTN","BPSJPAY",49,0)
 . I STATE="" Q
"RTN","BPSJPAY",50,0)
 . S BPS("RX",MEDN,"Prescriber State License #",STATE)=ID
"RTN","BPSJPAY",51,0)
STLIC2 Q
"RTN","BPSJPHNM")
0^354^B32200511
"RTN","BPSJPHNM",1,0)
BPSJPHNM ;BHAM ISC/LJF - HL7 E-Pharm Phone Number Parser ;21-NOV-2003
"RTN","BPSJPHNM",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJPHNM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJPHNM",4,0)
 ;
"RTN","BPSJPHNM",5,0)
 Q
"RTN","BPSJPHNM",6,0)
 ;
"RTN","BPSJPHNM",7,0)
EN(IX1,C,R) ;
"RTN","BPSJPHNM",8,0)
 ; Called with Person Index from VA(200
"RTN","BPSJPHNM",9,0)
 N N13,RETVAL,RETP,IX,IX2,UC,LC,PHT,SP,C3,PHD,PHDH,FLAG,PHI
"RTN","BPSJPHNM",10,0)
 ;
"RTN","BPSJPHNM",11,0)
 I '$G(IX1) Q ""
"RTN","BPSJPHNM",12,0)
 I $G(IX1) S N13=$G(^VA(200,+IX1,.13))
"RTN","BPSJPHNM",13,0)
 I $G(N13)="" Q ""
"RTN","BPSJPHNM",14,0)
 I $G(C)="" S C="^"
"RTN","BPSJPHNM",15,0)
 I $G(R)="" S R="~"
"RTN","BPSJPHNM",16,0)
 ;
"RTN","BPSJPHNM",17,0)
 ; Set up lowercase to UPPERCASE translation
"RTN","BPSJPHNM",18,0)
 S LC="abcdefghijklmnopqrstuvwxyz"
"RTN","BPSJPHNM",19,0)
 S UC="ABCDEFGHIJKLMNOPQRSTUVWXYZ"
"RTN","BPSJPHNM",20,0)
 S SP=" ",C3=C_C_C
"RTN","BPSJPHNM",21,0)
 ;
"RTN","BPSJPHNM",22,0)
 S PHT(1)=C_"PRN"_C_"PH"_C3 ; home phone
"RTN","BPSJPHNM",23,0)
 S PHT(2)=C_"WPN"_C_"PH"_C3 ; work phone
"RTN","BPSJPHNM",24,0)
 S PHT(3)=C_"WPN"_C_"PH"_C3 ; 3rd phone
"RTN","BPSJPHNM",25,0)
 S PHT(4)=C_"WPN"_C_"PH"_C3 ; 4th phone
"RTN","BPSJPHNM",26,0)
 S PHT(5)=C_"WPN"_C_"PH"_C3 ; Commercial phone
"RTN","BPSJPHNM",27,0)
 S PHT(6)=C_"WPN"_C_"FX"_C3 ; Fax Number
"RTN","BPSJPHNM",28,0)
 S PHT(7)=C_"BPN"_C_"BP"_C3 ; Voice Pager Number
"RTN","BPSJPHNM",29,0)
 S PHT(8)=C_"BPN"_C_"BP"_C3 ; Digital Pager Number
"RTN","BPSJPHNM",30,0)
 S (PHI(9),PHI(9,1),PHI(9,2),PHI(9,3),PHI(9,4),PHI(9,5))=""
"RTN","BPSJPHNM",31,0)
 ;
"RTN","BPSJPHNM",32,0)
 K PHD M PHD=PHI S PHD=$G(^VA(200,IX1,.13)) I $TR(PHD,"^ ")="" Q ""
"RTN","BPSJPHNM",33,0)
 S PHD(10)=PHD
"RTN","BPSJPHNM",34,0)
 ; Trim leading and trailing spaces from each piece
"RTN","BPSJPHNM",35,0)
 F IX2=1:1:8 D
"RTN","BPSJPHNM",36,0)
 . I $TR($P(PHD,U,IX2),SP)="" S $P(PHD,U,IX2)="" Q
"RTN","BPSJPHNM",37,0)
 . S PHDH=$P(PHD,U,IX2)
"RTN","BPSJPHNM",38,0)
 . S $P(PHDH,$E($TR(PHDH,SP)))=""  ; remove leading spaces
"RTN","BPSJPHNM",39,0)
 . S PHDH=$RE(PHDH),$P(PHDH,$E($TR(PHDH,SP)))="",PHDH=$RE(PHDH) ; remove trailing spaces
"RTN","BPSJPHNM",40,0)
 . ; remove duplicate work numbers
"RTN","BPSJPHNM",41,0)
 . I IX2>1,IX2<6 D  Q
"RTN","BPSJPHNM",42,0)
 . . I $G(PHD(11,PHDH)) S $P(PHD,U,IX2)=""
"RTN","BPSJPHNM",43,0)
 . . E  S PHD(11,PHDH)=IX2 S $P(PHD,U,IX2)=PHDH
"RTN","BPSJPHNM",44,0)
 . S $P(PHD,U,IX2)=PHDH
"RTN","BPSJPHNM",45,0)
 S PHD(10)=PHD
"RTN","BPSJPHNM",46,0)
 ;
"RTN","BPSJPHNM",47,0)
 ; Massage pagers into pieces 7&8
"RTN","BPSJPHNM",48,0)
 F IX2=1:1:6 S PHDH=$P(PHD,U,IX2),FLAG="" I PHDH]"" D
"RTN","BPSJPHNM",49,0)
 . I PHDH["BEEPER" D
"RTN","BPSJPHNM",50,0)
 . . S FLAG="1"_$P(PHDH,"BEEPER",2,99),PHDH=$P(PHDH,"BEEPER")
"RTN","BPSJPHNM",51,0)
 . I PHDH["BEEP" D
"RTN","BPSJPHNM",52,0)
 . . S FLAG="1"_$P(PHDH,"BEEP",2,99),PHDH=$P(PHDH,"BEEP")
"RTN","BPSJPHNM",53,0)
 . I PHDH["BP#" D
"RTN","BPSJPHNM",54,0)
 . . S FLAG="1"_$P(PHDH,"BP#",2,99),PHDH=$P(PHDH,"BP#")
"RTN","BPSJPHNM",55,0)
 . I PHDH["BP #" D
"RTN","BPSJPHNM",56,0)
 . . S FLAG="1"_$P(PHDH,"BP #",2,99),PHDH=$P(PHDH,"BP #")
"RTN","BPSJPHNM",57,0)
 . I PHDH["BP " D
"RTN","BPSJPHNM",58,0)
 . . S FLAG="1"_$P(PHDH,"BP ",2,99),PHDH=$P(PHDH,"BP ")
"RTN","BPSJPHNM",59,0)
 . I PHDH["BP" D
"RTN","BPSJPHNM",60,0)
 . . S FLAG="1"_$P(PHDH,"BP",2,99),PHDH=$P(PHDH,"BP")
"RTN","BPSJPHNM",61,0)
 . I FLAG D
"RTN","BPSJPHNM",62,0)
 . . S $P(PHD,U,IX2)=PHDH,$E(FLAG)=""
"RTN","BPSJPHNM",63,0)
 . . I $P(PHD,U,8)="" S $P(PHD,U,8)=FLAG Q
"RTN","BPSJPHNM",64,0)
 . . I $P(PHD,U,7)="" S $P(PHD,U,7)=FLAG Q
"RTN","BPSJPHNM",65,0)
 . . S $P(PHD,U,8)=$P(PHD,U,8)_" BP#"_FLAG
"RTN","BPSJPHNM",66,0)
 ;
"RTN","BPSJPHNM",67,0)
 F IX2=1:1:8 S PHD(IX2)=$P(PHD,U,IX2),PHD(IX2,1)="" I PHD(IX2)]"" D
"RTN","BPSJPHNM",68,0)
 . S PHD(IX2,1)=$$RESOLVEP(PHD(IX2))
"RTN","BPSJPHNM",69,0)
 . ;Init flag fields then load flags
"RTN","BPSJPHNM",70,0)
 . M PHD(IX2,9)=PHD(9)
"RTN","BPSJPHNM",71,0)
 ;
"RTN","BPSJPHNM",72,0)
 S RETVAL="",RETP=0
"RTN","BPSJPHNM",73,0)
 F IX2=1:1:8 D
"RTN","BPSJPHNM",74,0)
 . I '$L(PHD(IX2)) Q
"RTN","BPSJPHNM",75,0)
 . I '$L(PHD(IX2,1)) S $P(PHD(IX2,1),U,4)=PHD(IX2)
"RTN","BPSJPHNM",76,0)
 . S PHD(IX2,1)=PHT(IX2)_PHD(IX2,1)
"RTN","BPSJPHNM",77,0)
 . S RETP=RETP+1,$P(RETVAL,R,RETP)=PHD(IX2,1)
"RTN","BPSJPHNM",78,0)
 . Q
"RTN","BPSJPHNM",79,0)
 Q RETVAL
"RTN","BPSJPHNM",80,0)
 ;
"RTN","BPSJPHNM",81,0)
RESOLVEP(PH) ;
"RTN","BPSJPHNM",82,0)
 ;
"RTN","BPSJPHNM",83,0)
 N WPA,WPN,WPNH,STDN,WPT,IX,STDN,PREFIX
"RTN","BPSJPHNM",84,0)
 ;
"RTN","BPSJPHNM",85,0)
 S WPT=$TR(PH,LC,UC),PREFIX=0
"RTN","BPSJPHNM",86,0)
 S $P(WPN,SP,$L(WPT))=SP,WPA=WPN
"RTN","BPSJPHNM",87,0)
 ;
"RTN","BPSJPHNM",88,0)
 ; Separate numerics from text
"RTN","BPSJPHNM",89,0)
 F IX=1:1:$L(WPT) D
"RTN","BPSJPHNM",90,0)
 . I '$E(WPT,IX),$E(WPT,IX)'=0 S $E(WPA,IX)=$E(WPT,IX)
"RTN","BPSJPHNM",91,0)
 . E  S $E(WPN,IX)=$E(PH,IX)
"RTN","BPSJPHNM",92,0)
 ; Quit if no numerics
"RTN","BPSJPHNM",93,0)
 I '$L($TR(WPN,SP)) Q ""
"RTN","BPSJPHNM",94,0)
 ;
"RTN","BPSJPHNM",95,0)
 S WPNH=WPN   ; save a copy of the numeric data
"RTN","BPSJPHNM",96,0)
 ;
"RTN","BPSJPHNM",97,0)
 S $P(WPN,$E($TR(WPN,SP)))=""  ; remove leading spaces
"RTN","BPSJPHNM",98,0)
 S WPN=$RE(WPN),$P(WPN,$E($TR(WPN,SP)))="",WPN=$RE(WPN) ; remove trailing spaces
"RTN","BPSJPHNM",99,0)
 ; Reduce multiple spaces to single spaces
"RTN","BPSJPHNM",100,0)
 F IX=$L(WPN):-1:1 I ($E(WPN,IX,IX+1)=(SP_SP)) S $E(WPN,IX)=""
"RTN","BPSJPHNM",101,0)
 ;
"RTN","BPSJPHNM",102,0)
 ; WPN contains only NUMBERS and SPACES at this point
"RTN","BPSJPHNM",103,0)
 ; check if it is preceded by a 1 as in "1 800 345 9933"
"RTN","BPSJPHNM",104,0)
 I $E(WPN,1,2)="1 " S $E(WPN,1,2)="",PREFIX=2
"RTN","BPSJPHNM",105,0)
 I 'PREFIX,$E(WPN)=1 S $E(WPN)="",PREFIX=1
"RTN","BPSJPHNM",106,0)
 ; check if it's a standard 10 digit number
"RTN","BPSJPHNM",107,0)
 S STDN=0
"RTN","BPSJPHNM",108,0)
 I $L($TR(WPN,SP))=10 S STDN=1 D
"RTN","BPSJPHNM",109,0)
 . I $L(WPN)=10 D  I STDN=1 Q   ; format: 1234567890
"RTN","BPSJPHNM",110,0)
 . . S WPN(1)=$E(WPN,1,3),WPN(2)=$E(WPN,4,6),WPN(3)=$E(WPN,7,10)
"RTN","BPSJPHNM",111,0)
 . . I PH[WPN(1),PH[WPN(2),PH[WPN(3)
"RTN","BPSJPHNM",112,0)
 . . E  S STDN=0
"RTN","BPSJPHNM",113,0)
 . S STDN=1
"RTN","BPSJPHNM",114,0)
 . I $L(WPN,SP)=3 D  I STDN Q   ; format: 123 456 7890
"RTN","BPSJPHNM",115,0)
 . . S WPN(1)=$P(WPN,SP,1),WPN(2)=$P(WPN,SP,2),WPN(3)=$P(WPN,SP,3)
"RTN","BPSJPHNM",116,0)
 . . I $L(WPN(1))=3,PH[WPN(1),$L(WPN(2))=3,PH[WPN(2),$L(WPN(3))=4,PH[WPN(3)
"RTN","BPSJPHNM",117,0)
 . . E  S STDN=0
"RTN","BPSJPHNM",118,0)
 . S STDN=1
"RTN","BPSJPHNM",119,0)
 . I $L(WPN,SP)=2 D  I STDN=1 Q  ; Still may be salvageable
"RTN","BPSJPHNM",120,0)
 . . S WPN(1)=$P(WPN,SP,1),WPN(2)=$P(WPN,SP,2)
"RTN","BPSJPHNM",121,0)
 . . ; is format "123 4567890"?   area code & city/phone
"RTN","BPSJPHNM",122,0)
 . . I $L(WPN(1))=3 S WPN(3)=$E(WPN(2),4,7),$E(WPN(2),4,7)="" Q
"RTN","BPSJPHNM",123,0)
 . . ; is format "123456 7890"?   area/city code & phone
"RTN","BPSJPHNM",124,0)
 . . I $L(WPN(1))=6 S WPN(3)=WPN(2),WPN(2)=$E(WPN(1),4,6),$E(WPN(1),4,6)="" Q
"RTN","BPSJPHNM",125,0)
 . . S STDN=0 ;unsalvageable as standard number
"RTN","BPSJPHNM",126,0)
 . S STDN=0 ;unsalvageable as standard number
"RTN","BPSJPHNM",127,0)
 ;
"RTN","BPSJPHNM",128,0)
 ; Quit if standard format
"RTN","BPSJPHNM",129,0)
 I STDN Q WPN(1)_WPN(2)_C_WPN(3)
"RTN","BPSJPHNM",130,0)
 ;
"RTN","BPSJPHNM",131,0)
 ;Not standard, need to do some work
"RTN","BPSJPHNM",132,0)
 ;
"RTN","BPSJPHNM",133,0)
 F IX=1:1:$L(WPN,SP) S WPN(IX)=$P(WPN,SP,IX)
"RTN","BPSJPHNM",134,0)
 S IX=$L(WPN,SP),WPN(0)=""
"RTN","BPSJPHNM",135,0)
 ;
"RTN","BPSJPHNM",136,0)
 ; add prefix back in if applicable
"RTN","BPSJPHNM",137,0)
 I PREFIX=1,$L(WPN(1))'=10 S WPN(1)="1"_WPN(1)
"RTN","BPSJPHNM",138,0)
 ;
"RTN","BPSJPHNM",139,0)
 ; 1 string of digits
"RTN","BPSJPHNM",140,0)
 I IX=1 D  Q:$L(WPN(0)) WPN(0)
"RTN","BPSJPHNM",141,0)
 . I $L(WPN(1))<7 S WPN(0)=C_C_WPN(1) Q     ;assume it's an extension
"RTN","BPSJPHNM",142,0)
 . I $L(WPN(1))=7 S WPN(0)=$E(WPN(1),1,3)_C_$E(WPN(1),4,7) Q  ;city code & local number
"RTN","BPSJPHNM",143,0)
 ;
"RTN","BPSJPHNM",144,0)
 ; 2 strings of digits
"RTN","BPSJPHNM",145,0)
 I IX=2 D  Q:$L(WPN(0)) WPN(0)
"RTN","BPSJPHNM",146,0)
 . ; could be city code & local number
"RTN","BPSJPHNM",147,0)
 . I $L(WPN(1))=3,$L(WPN(2))=4 S WPN(0)=WPN(1)_C_WPN(2) Q
"RTN","BPSJPHNM",148,0)
 . ; could be full number plus extension
"RTN","BPSJPHNM",149,0)
 . I $L(WPN(1))=10 S WPN(0)=$E(WPN(1),1,6)_C_$E(WPN(1),7,10)_C_WPN(2)
"RTN","BPSJPHNM",150,0)
 ;
"RTN","BPSJPHNM",151,0)
 ; 3 strings could include extension
"RTN","BPSJPHNM",152,0)
 I IX=3 D  Q:$L(WPN(0)) WPN(0)
"RTN","BPSJPHNM",153,0)
 . ; "301 7933124 123"
"RTN","BPSJPHNM",154,0)
 . I $L(WPN(1))=3,$L(WPN(2))=7 S WPN(0)=WPN(1)_$E(WPN(2),1,3)_C_$E(WPN(2),4,7)_C_WPN(3) Q
"RTN","BPSJPHNM",155,0)
 . ; "793 3124 123"
"RTN","BPSJPHNM",156,0)
 . I $L(WPN(1))=3,$L(WPN(2))=4 S WPN(0)=WPN(1)_C_WPN(2)_C_WPN(3)
"RTN","BPSJPHNM",157,0)
 ;
"RTN","BPSJPHNM",158,0)
 ; 4 strings could include extension  "301 344 2111 3424
"RTN","BPSJPHNM",159,0)
 I IX=4 D  Q:$L(WPN(0)) WPN(0)
"RTN","BPSJPHNM",160,0)
 . I $L(WPN(1))=3,$L(WPN(2))=3,$L(WPN(3))=4 S WPN(0)=WPN(1)_WPN(2)_C_WPN(3)_C_WPN(4)
"RTN","BPSJPHNM",161,0)
 ;
"RTN","BPSJPHNM",162,0)
 Q ""
"RTN","BPSJPREG")
0^355^B10988509
"RTN","BPSJPREG",1,0)
BPSJPREG ;BHAM ISC/LJF - HL7 Registration MFN Message ;21-NOV-2003
"RTN","BPSJPREG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJPREG",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJPREG",4,0)
 ;
"RTN","BPSJPREG",5,0)
 ;**Program Description**
"RTN","BPSJPREG",6,0)
 ;  This program will process the outgoing registration MFN message
"RTN","BPSJPREG",7,0)
 ;
"RTN","BPSJPREG",8,0)
 ;  Variable
"RTN","BPSJPREG",9,0)
 ; HL      = HL7 parameters
"RTN","BPSJPREG",10,0)
 ; HL7DTG  = Date time in HL7 format
"RTN","BPSJPREG",11,0)
 ; HLECH   = HL7 Encoding Characters
"RTN","BPSJPREG",12,0)
 ; HLEID   = HL7 Link id
"RTN","BPSJPREG",13,0)
 ; HLFS    = HL7 Field separator
"RTN","BPSJPREG",14,0)
 ; HLLNK   = HL7 E-Pharm Link
"RTN","BPSJPREG",15,0)
 ; HLRESET = HL7 generate results
"RTN","BPSJPREG",16,0)
 ; IPP     = IP Port
"RTN","BPSJPREG",17,0)
 ; IPA     = IP Address
"RTN","BPSJPREG",18,0)
 ; MCT     = Message Count
"RTN","BPSJPREG",19,0)
 ; MGRP    = E-Mail message group
"RTN","BPSJPREG",20,0)
 ; MSG     = Message
"RTN","BPSJPREG",21,0)
 ;
"RTN","BPSJPREG",22,0)
 ; Don't allow direct execution
"RTN","BPSJPREG",23,0)
 ;
"RTN","BPSJPREG",24,0)
 W !!!,"DIRECT ENTRY NOT ALLOWED",!!!
"RTN","BPSJPREG",25,0)
 Q
"RTN","BPSJPREG",26,0)
 ;
"RTN","BPSJPREG",27,0)
REG(PHARMIX,BPSJVAL) ;  Registration message for when a site installs
"RTN","BPSJPREG",28,0)
 ;
"RTN","BPSJPREG",29,0)
 N HL,HL7DTG,HLECH,HLEID,HLFS,HLLNK,HLPRO,HLRESLT,IPA,IPP
"RTN","BPSJPREG",30,0)
 N MGRP,MCT,MSG,TAXID,ZRPSEG,BPSJVAL2,BPSJPRES
"RTN","BPSJPREG",31,0)
 ;
"RTN","BPSJPREG",32,0)
 S (MCT,TAXID)=0,BPSJVAL=$G(BPSJVAL)
"RTN","BPSJPREG",33,0)
 ;
"RTN","BPSJPREG",34,0)
 I '$G(PHARMIX) Q
"RTN","BPSJPREG",35,0)
 K ^TMP("HLS",$J)
"RTN","BPSJPREG",36,0)
 ;
"RTN","BPSJPREG",37,0)
 ;  Get Link data from HL7 table
"RTN","BPSJPREG",38,0)
 S HLPRO="BPSJ REGISTER",(IPA,IPP)=""
"RTN","BPSJPREG",39,0)
 S HLLNK=$$FIND1^DIC(870,"",,"EPHARM OUT","B")
"RTN","BPSJPREG",40,0)
 I HLLNK S IPA=$$GET1^DIQ(870,HLLNK_",",400.01),IPP=$$GET1^DIQ(870,HLLNK_",",400.02)
"RTN","BPSJPREG",41,0)
 ;
"RTN","BPSJPREG",42,0)
 ;  Error if any missing data
"RTN","BPSJPREG",43,0)
 I IPA=""!(IPP="") S MCT=MCT+1,MSG(MCT)="IP Address or Port is not defined.  "
"RTN","BPSJPREG",44,0)
 ;
"RTN","BPSJPREG",45,0)
 ;  Initialize the HL7
"RTN","BPSJPREG",46,0)
 D INIT^HLFNC2(HLPRO,.HL)
"RTN","BPSJPREG",47,0)
 S HLFS=$G(HL("FS")) I HLFS="" S HLFS="|"
"RTN","BPSJPREG",48,0)
 S HLECH=$E($G(HL("ECH"),1)) I HLECH="" S HLECH="^"
"RTN","BPSJPREG",49,0)
 S HL("SITE")=$$SITE^VASITE,HL("SAF")=$P(HL("SITE"),U,2,3)
"RTN","BPSJPREG",50,0)
 S HL("EPPORT")=IPP,HLEID=$$HLP^BPSJUTL(HLPRO)
"RTN","BPSJPREG",51,0)
 ;
"RTN","BPSJPREG",52,0)
 ;Get fileman date/time, ensuring seconds are included: 3031029.135636
"RTN","BPSJPREG",53,0)
 S HL7DTG=$E($$HTFM^XLFDT($H)_"000000",1,14)
"RTN","BPSJPREG",54,0)
 ;Set HL7 Date/Time format: 20031029135636-0400
"RTN","BPSJPREG",55,0)
 S HL7DTG=$$FMTHL7^XLFDT(HL7DTG)
"RTN","BPSJPREG",56,0)
 ;
"RTN","BPSJPREG",57,0)
 ;  Set the ZRP Segment
"RTN","BPSJPREG",58,0)
 D EN^BPSJZRP(.HL,PHARMIX,.TAXID,.ZRPSEG)
"RTN","BPSJPREG",59,0)
 M ^TMP("HLS",$J,3)=ZRPSEG K ZRPSEG
"RTN","BPSJPREG",60,0)
 ;
"RTN","BPSJPREG",61,0)
 ;  Set the MFE segment
"RTN","BPSJPREG",62,0)
 S ^TMP("HLS",$J,2)="MFE"_HLFS_"MUP"_HLFS_HLFS_HL7DTG
"RTN","BPSJPREG",63,0)
 S ^TMP("HLS",$J,2)=^TMP("HLS",$J,2)_HLFS_TAXID_HLFS_"ST"
"RTN","BPSJPREG",64,0)
 ;
"RTN","BPSJPREG",65,0)
 ;   Set the MFI segment
"RTN","BPSJPREG",66,0)
 S ^TMP("HLS",$J,1)="MFI"_HLFS_"Pharmacy Table"_HLFS_HLFS_"UPD"_HLFS
"RTN","BPSJPREG",67,0)
 S ^TMP("HLS",$J,1)=^TMP("HLS",$J,1)_HL7DTG_HLFS_HL7DTG_HLFS_"NE"
"RTN","BPSJPREG",68,0)
 ;
"RTN","BPSJPREG",69,0)
 S BPSJPRES=$$VAL2^BPSJVAL(BPSJVAL)  ; 0 = ok
"RTN","BPSJPREG",70,0)
 I BPSJVAL=3 G FINI   ; Just checking to see if data valid.
"RTN","BPSJPREG",71,0)
 ;
"RTN","BPSJPREG",72,0)
 ;-Check if msg valid.
"RTN","BPSJPREG",73,0)
 I 'BPSJPRES D  G FINI
"RTN","BPSJPREG",74,0)
 . K HLRESLT
"RTN","BPSJPREG",75,0)
 . D GENERATE^HLMA(HLEID,"GM",1,.HLRESLT,"")
"RTN","BPSJPREG",76,0)
 . I $P($G(HLRESLT),U,2)]"" D  Q
"RTN","BPSJPREG",77,0)
 .. I BPSJVAL D  Q   ; Interactive: show no success
"RTN","BPSJPREG",78,0)
 ... W !!,"HL7 E-Pharm Pharmacy Registration Message not created: "_HLRESLT
"RTN","BPSJPREG",79,0)
 ... W !," PHARMIX: "_PHARMIX_""
"RTN","BPSJPREG",80,0)
 .. S MCT=MCT+1,MSG(MCT)="HL7 E-Pharm Pharmacy Registration Message not created. (PHARMIX: "_PHARMIX_")"
"RTN","BPSJPREG",81,0)
 .. S MCT=MCT+1,MSG(MCT)=HLRESLT
"RTN","BPSJPREG",82,0)
 .. D MSG^BPSJUTL(.MSG,"BPSJAREG")
"RTN","BPSJPREG",83,0)
 . I BPSJVAL D    ;Interactive: show success
"RTN","BPSJPREG",84,0)
 .. W !!,"HL7 E-Pharm Pharmacy Registration Message successfully created."
"RTN","BPSJPREG",85,0)
 ;
"RTN","BPSJPREG",86,0)
 ;
"RTN","BPSJPREG",87,0)
FINI ; Clean up
"RTN","BPSJPREG",88,0)
 K ^TMP("HLS",$J)
"RTN","BPSJPREG",89,0)
 Q
"RTN","BPSJUTL")
0^356^B9376447
"RTN","BPSJUTL",1,0)
BPSJUTL ;BHAM ISC/LJF - e-Pharmacy Utils ;16-OCT-2003
"RTN","BPSJUTL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJUTL",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJUTL",4,0)
 ;
"RTN","BPSJUTL",5,0)
 Q
"RTN","BPSJUTL",6,0)
 ;
"RTN","BPSJUTL",7,0)
HLP(PROTOCOL) ;  Find the Protocol IEN
"RTN","BPSJUTL",8,0)
 Q +$O(^ORD(101,"B",PROTOCOL,0))
"RTN","BPSJUTL",9,0)
 ;
"RTN","BPSJUTL",10,0)
VAHL7ECH(HL) ; Hl7 Encoding Characters
"RTN","BPSJUTL",11,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"
"RTN","BPSJUTL",12,0)
 S ECH=$G(HL("ECH")) I ECH="" S ECH="^~\&"
"RTN","BPSJUTL",13,0)
 S CPS=$E(ECH),REP=$E(ECH,2)
"RTN","BPSJUTL",14,0)
 ;
"RTN","BPSJUTL",15,0)
 Q
"RTN","BPSJUTL",16,0)
 ;
"RTN","BPSJUTL",17,0)
MSG(BPSJMM,BPSJRTN) ; Message Handler
"RTN","BPSJUTL",18,0)
 ;
"RTN","BPSJUTL",19,0)
 N XMDUZ,XMSUB,XMY,XMTEXT,BPMSJMG
"RTN","BPSJUTL",20,0)
 ;
"RTN","BPSJUTL",21,0)
 I $G(U)="" S U="^"
"RTN","BPSJUTL",22,0)
 I $G(BPSJRTN)]"" S BPSJMM(.0001)="Source Program: "_BPSJRTN
"RTN","BPSJUTL",23,0)
 S BPMSJMG=$O(^BPS(9002313.99,0)) Q:'BPMSJMG
"RTN","BPSJUTL",24,0)
 S BPMSJMG=+$G(^BPS(9002313.99,BPMSJMG,"VITRIA")) Q:'BPMSJMG
"RTN","BPSJUTL",25,0)
 S BPMSJMG=$G(^VA(200,BPMSJMG,.15)) Q:BPMSJMG=""
"RTN","BPSJUTL",26,0)
 S XMY(BPMSJMG)="",XMTEXT="BPSJMM(",XMSUB="E-PHARM MESSAGE"
"RTN","BPSJUTL",27,0)
 D ^XMD
"RTN","BPSJUTL",28,0)
 ;
"RTN","BPSJUTL",29,0)
 Q
"RTN","BPSJUTL",30,0)
 ;
"RTN","BPSJUTL",31,0)
VA200NM(VAIX,VATITLE,HL) ;
"RTN","BPSJUTL",32,0)
 ;
"RTN","BPSJUTL",33,0)
 N RETDATA,NMDATA
"RTN","BPSJUTL",34,0)
 N FS,CPS,REP
"RTN","BPSJUTL",35,0)
 ;
"RTN","BPSJUTL",36,0)
 I '$G(VAIX) Q ""
"RTN","BPSJUTL",37,0)
 S NMDATA=$P($G(^VA(200,VAIX,0)),U,1) I NMDATA="" Q ""
"RTN","BPSJUTL",38,0)
 ;
"RTN","BPSJUTL",39,0)
 D VAHL7ECH(.HL)
"RTN","BPSJUTL",40,0)
 D STDNAME^XLFNAME(.NMDATA,"C")
"RTN","BPSJUTL",41,0)
 ;
"RTN","BPSJUTL",42,0)
 S RETDATA=$G(NMDATA("FAMILY"))              ;1
"RTN","BPSJUTL",43,0)
 S RETDATA=RETDATA_CPS_$G(NMDATA("GIVEN"))   ;2
"RTN","BPSJUTL",44,0)
 S RETDATA=RETDATA_CPS_$G(NMDATA("MIDDLE"))  ;3
"RTN","BPSJUTL",45,0)
 S RETDATA=RETDATA_CPS_$G(NMDATA("SUFFIX"))  ;4
"RTN","BPSJUTL",46,0)
 S RETDATA=RETDATA_CPS_$G(NMDATA("PREFIX"))  ;5
"RTN","BPSJUTL",47,0)
 S RETDATA=RETDATA_CPS_$G(NMDATA("DEGREE"))  ;6
"RTN","BPSJUTL",48,0)
 ;
"RTN","BPSJUTL",49,0)
 S VATITLE=$P($G(^VA(200,VAIX,0)),U,9)
"RTN","BPSJUTL",50,0)
 I VATITLE S VATITLE=$G(^DIC(3.1,VATITLE,0))
"RTN","BPSJUTL",51,0)
 ;
"RTN","BPSJUTL",52,0)
 Q RETDATA
"RTN","BPSJUTL",53,0)
 ;
"RTN","BPSJUTL",54,0)
VA20013(VAIX,HL) ; Build the HL7 Contact Means data field
"RTN","BPSJUTL",55,0)
 ;
"RTN","BPSJUTL",56,0)
 N FDATA,RETDATA
"RTN","BPSJUTL",57,0)
 N FS,CPS,REP
"RTN","BPSJUTL",58,0)
 ;
"RTN","BPSJUTL",59,0)
 I '$G(VAIX) Q ""
"RTN","BPSJUTL",60,0)
 ; VAIX is the index to ^VA(200,n
"RTN","BPSJUTL",61,0)
 D VAHL7ECH(.HL)
"RTN","BPSJUTL",62,0)
 S RETDATA=$P($G(^VA(200,VAIX,.15)),U,1)   ; LJF@DAOU.COM
"RTN","BPSJUTL",63,0)
 I RETDATA]"",RETDATA["@" S RETDATA=CPS_"NET"_CPS_"INTERNET"_CPS_RETDATA
"RTN","BPSJUTL",64,0)
 S FDATA=$$EN^BPSJPHNM(VAIX,CPS,REP)
"RTN","BPSJUTL",65,0)
 I $L(FDATA) D
"RTN","BPSJUTL",66,0)
 . I $L(RETDATA) S RETDATA=RETDATA_REP
"RTN","BPSJUTL",67,0)
 . S RETDATA=RETDATA_FDATA
"RTN","BPSJUTL",68,0)
 Q RETDATA
"RTN","BPSJUTL",69,0)
 ;
"RTN","BPSJUTL",70,0)
ENCODE(INSTR,TCH) ;  Encode data - Primarily HL7
"RTN","BPSJUTL",71,0)
 N X,WCHR,OSTR
"RTN","BPSJUTL",72,0)
 S OSTR=""
"RTN","BPSJUTL",73,0)
 I $G(INSTR)]"" F X=1:1:$L(INSTR) D  S OSTR=OSTR_WCHR
"RTN","BPSJUTL",74,0)
 . S WCHR=$E(INSTR,X) I $D(TCH(WCHR)) S WCHR=TCH(WCHR)
"RTN","BPSJUTL",75,0)
 Q OSTR
"RTN","BPSJUTL",76,0)
 ;
"RTN","BPSJUTL",77,0)
SPAR(HL,BPSJSEG,HCTS) ;  Segment Parsing
"RTN","BPSJUTL",78,0)
 N II,IJ,IK,ISDATA
"RTN","BPSJUTL",79,0)
 N FS,CPS,REP,ECH
"RTN","BPSJUTL",80,0)
 ;
"RTN","BPSJUTL",81,0)
 I '$G(HCTS) Q
"RTN","BPSJUTL",82,0)
 ;
"RTN","BPSJUTL",83,0)
 D VAHL7ECH(.HL)
"RTN","BPSJUTL",84,0)
 M ISDATA=^TMP($J,"BPSJHLI",HCTS)
"RTN","BPSJUTL",85,0)
 S IK=0,IJ=1,II=""
"RTN","BPSJUTL",86,0)
 F  S II=$O(ISDATA(II)) Q:II=""  D
"RTN","BPSJUTL",87,0)
 . S ISDATA=$G(ISDATA(II)) Q:ISDATA=""
"RTN","BPSJUTL",88,0)
 . F  D  Q:ISDATA=""
"RTN","BPSJUTL",89,0)
 . . S IK=IK+1,BPSJSEG(IJ,IK)=$P(ISDATA,FS)
"RTN","BPSJUTL",90,0)
 . . S $P(ISDATA,FS)=""
"RTN","BPSJUTL",91,0)
 . . I $E(ISDATA)=FS S IJ=IJ+1,$E(ISDATA)=""
"RTN","BPSJUTL",92,0)
 ;
"RTN","BPSJUTL",93,0)
 ; Promote data in 1st subnode and kill subnode
"RTN","BPSJUTL",94,0)
 S II=""
"RTN","BPSJUTL",95,0)
 F  S II=$O(BPSJSEG(II)) Q:II=""  D
"RTN","BPSJUTL",96,0)
 . S IJ=$O(BPSJSEG(II,"")) Q:'IJ
"RTN","BPSJUTL",97,0)
 . S BPSJSEG(II)=BPSJSEG(II,IJ) K BPSJSEG(II,IJ)
"RTN","BPSJUTL",98,0)
 Q
"RTN","BPSJUTL1")
0^357^B6119361
"RTN","BPSJUTL1",1,0)
BPSJUTL1 ;BHAM ISC/DB - e-Pharmacy Utils ;18-JAN-2004
"RTN","BPSJUTL1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJUTL1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJUTL1",4,0)
 ; Special Code for WebMD Test
"RTN","BPSJUTL1",5,0)
 ; WBTESTB1 - Billing
"RTN","BPSJUTL1",6,0)
 ; WBTESTB2 - Reversal
"RTN","BPSJUTL1",7,0)
 ; Tags are 'FLD'_<Field_Number>_<'B' (billing) or 'R' (reversal)>
"RTN","BPSJUTL1",8,0)
FLD402B ;
"RTN","BPSJUTL1",9,0)
 S BPS("X")=$G(BPS("X")) I $G(BPS(9002313.0201))="" Q
"RTN","BPSJUTL1",10,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401944 S BPS("X")=7
"RTN","BPSJUTL1",11,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401959 S BPS("X")=1
"RTN","BPSJUTL1",12,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401974 S BPS("X")=2
"RTN","BPSJUTL1",13,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401976 S BPS("X")=3
"RTN","BPSJUTL1",14,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401958 S BPS("X")=4
"RTN","BPSJUTL1",15,0)
 ;???
"RTN","BPSJUTL1",16,0)
 I BPS("X")="" S BPS("X")=BPS("RX",BPS(9002313.0201),"RX IEN")
"RTN","BPSJUTL1",17,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")'=401944 S BPS("X")=BPS("RX",BPS(9002313.0201),"RX IEN")
"RTN","BPSJUTL1",18,0)
 Q
"RTN","BPSJUTL1",19,0)
 ;
"RTN","BPSJUTL1",20,0)
FLD408B ;
"RTN","BPSJUTL1",21,0)
 S BPS("X")=0 I $G(BPS(9002313.0201))="" Q
"RTN","BPSJUTL1",22,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401944 S BPS("X")="1"
"RTN","BPSJUTL1",23,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401959 S BPS("X")="1"
"RTN","BPSJUTL1",24,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401974 S BPS("X")="1"
"RTN","BPSJUTL1",25,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401976 S BPS("X")="0"
"RTN","BPSJUTL1",26,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401958 S BPS("X")="1"
"RTN","BPSJUTL1",27,0)
 Q
"RTN","BPSJUTL1",28,0)
 ;
"RTN","BPSJUTL1",29,0)
FLD419B ;
"RTN","BPSJUTL1",30,0)
 S BPS("X")=0 I $G(BPS(9002313.0201))="" Q
"RTN","BPSJUTL1",31,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401944 S BPS("X")="1"
"RTN","BPSJUTL1",32,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401959 S BPS("X")="1"
"RTN","BPSJUTL1",33,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401974 S BPS("X")="2"
"RTN","BPSJUTL1",34,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401976 S BPS("X")="1"
"RTN","BPSJUTL1",35,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401958 S BPS("X")="1"
"RTN","BPSJUTL1",36,0)
 Q
"RTN","BPSJUTL1",37,0)
 ;
"RTN","BPSJUTL1",38,0)
FLD420B ;
"RTN","BPSJUTL1",39,0)
 S BPS("X")="00" I $G(BPS(9002313.0201))="" Q
"RTN","BPSJUTL1",40,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401944 S BPS("X")="03"
"RTN","BPSJUTL1",41,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401959 S BPS("X")="00"
"RTN","BPSJUTL1",42,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401974 S BPS("X")="04"
"RTN","BPSJUTL1",43,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401976 S BPS("X")="03"
"RTN","BPSJUTL1",44,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401958 S BPS("X")="00"
"RTN","BPSJUTL1",45,0)
 Q
"RTN","BPSJUTL1",46,0)
 ;
"RTN","BPSJUTL1",47,0)
FLD433B ;
"RTN","BPSJUTL1",48,0)
 S BPS("X")=10.0 I $G(BPS(9002313.0201))="" Q
"RTN","BPSJUTL1",49,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401974 S BPS("X")=5.0
"RTN","BPSJUTL1",50,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401976 S BPS("X")=5.0
"RTN","BPSJUTL1",51,0)
 I BPS("RX",BPS(9002313.0201),"RX IEN")=401958 S BPS("X")=5.0
"RTN","BPSJUTL1",52,0)
 Q
"RTN","BPSJVAL")
0^358^B7718705
"RTN","BPSJVAL",1,0)
BPSJVAL ;BHAM ISC/LJF - Pharmacy data entry ;2004-03-01
"RTN","BPSJVAL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJVAL",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJVAL",4,0)
 ;
"RTN","BPSJVAL",5,0)
 D ^BPSJVAL1
"RTN","BPSJVAL",6,0)
 K DIR,X S DIR(0)="EO" D ^DIR
"RTN","BPSJVAL",7,0)
 I X=U Q
"RTN","BPSJVAL",8,0)
 D ^BPSJVAL2
"RTN","BPSJVAL",9,0)
 Q
"RTN","BPSJVAL",10,0)
 ;
"RTN","BPSJVAL",11,0)
VAL1(VALCK) ;   Application
"RTN","BPSJVAL",12,0)
 N RETCODE,VERBOSE,IX2
"RTN","BPSJVAL",13,0)
 ;
"RTN","BPSJVAL",14,0)
 ; VALCK=0 = validation, HL7 trigger, no display
"RTN","BPSJVAL",15,0)
 I '$G(VALCK) N RETCODE D  Q RETCODE  ; 0 means ok, '0 means invalid
"RTN","BPSJVAL",16,0)
 . ;-validate and quit if ok
"RTN","BPSJVAL",17,0)
 . S RETCODE=0 D VALIDATE^BPSJVAL1 I $G(BPSJVALR)=-1 S BPSJVALR=RETCODE
"RTN","BPSJVAL",18,0)
 . I 'RETCODE Q
"RTN","BPSJVAL",19,0)
 . ;-invalid data, send an email
"RTN","BPSJVAL",20,0)
 . S MCT=1+$G(MCT),MSG(MCT)="HL7 E-Pharm Application Registration Message not created."
"RTN","BPSJVAL",21,0)
 . F IX2=1:1:RETCODE I $G(RETCODE(IX2))]"" D
"RTN","BPSJVAL",22,0)
 .. S MCT=1+MCT,MSG(MCT)=$G(RETCODE(IX2))
"RTN","BPSJVAL",23,0)
 . D MSG^BPSJUTL(.MSG,"BPSJAREG")
"RTN","BPSJVAL",24,0)
 ;
"RTN","BPSJVAL",25,0)
 ; VALCK=1 = validation, HL7 trigger, display
"RTN","BPSJVAL",26,0)
 I $G(VALCK)=1 N RETCODE D  Q RETCODE  ; 0 means ok, '0 means invalid
"RTN","BPSJVAL",27,0)
 . S RETCODE=0,VERBOSE=1 D VALIDATE^BPSJVAL1
"RTN","BPSJVAL",28,0)
 . I $G(BPSJVALR)=-1 S BPSJVALR=RETCODE
"RTN","BPSJVAL",29,0)
 ;
"RTN","BPSJVAL",30,0)
 ; VALCK=2 = validation, no HL7 trigger, display
"RTN","BPSJVAL",31,0)
 I $G(VALCK)=2 N RETCODE D  Q 1
"RTN","BPSJVAL",32,0)
 . S RETCODE=0,VERBOSE=1 D VALIDATE^BPSJVAL1
"RTN","BPSJVAL",33,0)
 . I $G(BPSJVALR)=-1 S BPSJVALR=RETCODE
"RTN","BPSJVAL",34,0)
 ;
"RTN","BPSJVAL",35,0)
 ; VALCK=3 = validation, no HL7 trigger, no display
"RTN","BPSJVAL",36,0)
 I $G(VALCK)=3 N RETCODE D  Q 1
"RTN","BPSJVAL",37,0)
 . S RETCODE=0 D VALIDATE^BPSJVAL1
"RTN","BPSJVAL",38,0)
 . I $G(BPSJVALR)=-1 S BPSJVALR=RETCODE
"RTN","BPSJVAL",39,0)
 ;
"RTN","BPSJVAL",40,0)
 Q
"RTN","BPSJVAL",41,0)
 ;
"RTN","BPSJVAL",42,0)
VAL2(VALCK) ;  Pharmacies
"RTN","BPSJVAL",43,0)
 N RETCODE,VERBOSE,IX2
"RTN","BPSJVAL",44,0)
 ;
"RTN","BPSJVAL",45,0)
 ; VALCK=0 = validation, HL7 trigger, no display
"RTN","BPSJVAL",46,0)
 I '$G(VALCK) N RETCODE D  Q RETCODE  ; 0 means ok, '0 means invalid
"RTN","BPSJVAL",47,0)
 . ;-validate and quit if ok
"RTN","BPSJVAL",48,0)
 . S RETCODE=0 D VALIDATE^BPSJVAL2 I $G(BPSJVALR)=-1 S BPSJVALR=RETCODE
"RTN","BPSJVAL",49,0)
 . I 'RETCODE Q
"RTN","BPSJVAL",50,0)
 . ;-invalid data, send an email
"RTN","BPSJVAL",51,0)
 . S MCT=1+$G(MCT),MSG(MCT)="HL7 E-Pharm Pharmacy Registration Message not created."
"RTN","BPSJVAL",52,0)
 . F IX2=1:1:RETCODE I $G(RETCODE(IX2))]"" D
"RTN","BPSJVAL",53,0)
 .. S MCT=1+MCT,MSG(MCT)=$G(RETCODE(IX2))
"RTN","BPSJVAL",54,0)
 . D MSG^BPSJUTL(.MSG,"BPSJAREG")
"RTN","BPSJVAL",55,0)
 ;
"RTN","BPSJVAL",56,0)
 ; VALCK=1 = validation, HL7 trigger, display
"RTN","BPSJVAL",57,0)
 I $G(VALCK)=1 N RETCODE D  Q RETCODE  ; 0 means ok, '0 means invalid
"RTN","BPSJVAL",58,0)
 . S RETCODE=0,VERBOSE=1 D VALIDATE^BPSJVAL2
"RTN","BPSJVAL",59,0)
 . I $G(BPSJVALR)=-1 S BPSJVALR=RETCODE
"RTN","BPSJVAL",60,0)
 ;
"RTN","BPSJVAL",61,0)
 ; VALCK=2 = validation, no HL7 trigger, display
"RTN","BPSJVAL",62,0)
 I $G(VALCK)=2 N RETCODE D  Q 1
"RTN","BPSJVAL",63,0)
 . S RETCODE=0,VERBOSE=1 D VALIDATE^BPSJVAL2
"RTN","BPSJVAL",64,0)
 . I $G(BPSJVALR)=-1 S BPSJVALR=RETCODE
"RTN","BPSJVAL",65,0)
 ;
"RTN","BPSJVAL",66,0)
 ; VALCK=3 = validation, no display, no HL7 trigger
"RTN","BPSJVAL",67,0)
 I $G(VALCK)=3 N RETCODE D  Q 1
"RTN","BPSJVAL",68,0)
 . S RETCODE=0 D VALIDATE^BPSJVAL2
"RTN","BPSJVAL",69,0)
 . I $G(BPSJVALR)=-1 S BPSJVALR=RETCODE
"RTN","BPSJVAL",70,0)
 ;
"RTN","BPSJVAL",71,0)
 Q
"RTN","BPSJVAL1")
0^359^B15967858
"RTN","BPSJVAL1",1,0)
BPSJVAL1 ;BHAM ISC/LJF - Pharmacy Application Validation ;2004-03-01
"RTN","BPSJVAL1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJVAL1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJVAL1",4,0)
 ;
"RTN","BPSJVAL1",5,0)
 N BPSJVAL1,VERBOSE
"RTN","BPSJVAL1",6,0)
 D DT^DICRW D HOME^%ZIS,CLEAR^VALM1
"RTN","BPSJVAL1",7,0)
 W !!!,"SITE REGISTRATION VALIDATION.",!
"RTN","BPSJVAL1",8,0)
 D BPSJVAL^BPSJAREG(2)
"RTN","BPSJVAL1",9,0)
 W !!!!
"RTN","BPSJVAL1",10,0)
 ;
"RTN","BPSJVAL1",11,0)
 Q
"RTN","BPSJVAL1",12,0)
 ;
"RTN","BPSJVAL1",13,0)
VALIDATE ; Validate ZQR Data
"RTN","BPSJVAL1",14,0)
 ;
"RTN","BPSJVAL1",15,0)
 N SEG,SEGIX,ZQR,RIX,PIX,PIXL,SEGDAT,ZNOTE,ZMAX
"RTN","BPSJVAL1",16,0)
 N HL7EOIEN,HL7EOIP
"RTN","BPSJVAL1",17,0)
 N HL7VOIEN,HL7VOIP
"RTN","BPSJVAL1",18,0)
 N HL7EDOM,HL7PDOM,HL7OPORT,HL7PORT,CMA
"RTN","BPSJVAL1",19,0)
 ;
"RTN","BPSJVAL1",20,0)
 ; Constants
"RTN","BPSJVAL1",21,0)
 S HL7PORT=5105,ZMAX=8,CMA=","
"RTN","BPSJVAL1",22,0)
 S HL7PDOM="EPHARMACY.VITRIA-EDI.AAC.VA.GOV"
"RTN","BPSJVAL1",23,0)
 ;
"RTN","BPSJVAL1",24,0)
 S RETCODE=+$G(RETCODE)
"RTN","BPSJVAL1",25,0)
 S ZQR="",RIX=0
"RTN","BPSJVAL1",26,0)
 ;
"RTN","BPSJVAL1",27,0)
 S HL7EOIEN=$$FIND1^DIC(870,"",,"EPHARM OUT","B")_CMA   ;EPHARM OUT
"RTN","BPSJVAL1",28,0)
 S HL7VOIEN=$$FIND1^DIC(870,"",,"IIV EC","B")_CMA       ;IIV EC
"RTN","BPSJVAL1",29,0)
 ;
"RTN","BPSJVAL1",30,0)
 ; Vitria Domain name
"RTN","BPSJVAL1",31,0)
 S HL7EDOM=$$GET1^DIQ(870,HL7EOIEN,.03)   ;EPHARM OUT
"RTN","BPSJVAL1",32,0)
 I HL7EDOM=HL7PDOM S ZNOTE="   DOMAIN NAME - Required - VALID: "_HL7PDOM
"RTN","BPSJVAL1",33,0)
 E  D
"RTN","BPSJVAL1",34,0)
 . I HL7EDOM="" S ZNOTE="** DOMAIN NAME - Required - INVALID" S RETCODE=.3 Q
"RTN","BPSJVAL1",35,0)
 . S ZNOTE=" * WARNING: EXPECTED DOMAIN NAME: "_HL7PDOM_"                            CURRENT DOMAIN NAME: "_HL7EDOM
"RTN","BPSJVAL1",36,0)
 S RETCODE(.3)=ZNOTE
"RTN","BPSJVAL1",37,0)
 I +$G(VERBOSE) W !,RETCODE(.3)
"RTN","BPSJVAL1",38,0)
 ;
"RTN","BPSJVAL1",39,0)
 ; Get IP addresses
"RTN","BPSJVAL1",40,0)
 S HL7EOIP=$$GET1^DIQ(870,HL7EOIEN,400.01)   ;EPHARM OUT
"RTN","BPSJVAL1",41,0)
 S HL7VOIP=$$GET1^DIQ(870,HL7VOIEN,400.01)   ;IIV EC
"RTN","BPSJVAL1",42,0)
 ;
"RTN","BPSJVAL1",43,0)
 I HL7EOIP,HL7EOIP=HL7VOIP S ZNOTE="   TCP/IP ADDRESS FOR ""EPHARM OUT"" - Required - VALID: "_HL7EOIP
"RTN","BPSJVAL1",44,0)
 E  D
"RTN","BPSJVAL1",45,0)
 . I 'HL7EOIP S ZNOTE="** TCP/IP ADDRESS FOR ""EPHARM OUT"" - Required - INVALID",RETCODE=.7 Q
"RTN","BPSJVAL1",46,0)
 . I HL7VOIP,HL7EOIP'=HL7VOIP S ZNOTE=" * WARNING: ""EPHARM OUT"" TCP/IP ADDRESS DIFFERENT THAN ""IIV EC"" TCP/IP ADDRESS.        EPHARM OUT: "_HL7EOIP_"   IIV EC: "_HL7VOIP
"RTN","BPSJVAL1",47,0)
 S RETCODE(.7)=ZNOTE
"RTN","BPSJVAL1",48,0)
 I +$G(VERBOSE) W !,RETCODE(.7)
"RTN","BPSJVAL1",49,0)
 ;
"RTN","BPSJVAL1",50,0)
 ; Get Outgoing Port and IP Address
"RTN","BPSJVAL1",51,0)
 S HL7OPORT=$$GET1^DIQ(870,HL7EOIEN,400.02)   ;EPHARM OUT
"RTN","BPSJVAL1",52,0)
 I HL7OPORT,HL7OPORT=HL7PORT S ZNOTE="   ""EPHARM OUT"" PORT NUMBER - Required - VALID: "_HL7OPORT
"RTN","BPSJVAL1",53,0)
 E  D
"RTN","BPSJVAL1",54,0)
 . S ZNOTE=" * WARNING: EXPECTED ""EPHARM OUT"" PORT NUMBER: "_HL7PORT
"RTN","BPSJVAL1",55,0)
 . S ZNOTE=ZNOTE_"                                         CURRENT "
"RTN","BPSJVAL1",56,0)
 . S ZNOTE=ZNOTE_"""EPHARM OUT"" PORT NUMBER: "_HL7OPORT
"RTN","BPSJVAL1",57,0)
 . I 'HL7OPORT S ZNOTE="** ""EPHARM OUT"" PORT NUMBER - Required - INVALID",RETCODE=.9 Q
"RTN","BPSJVAL1",58,0)
 S RETCODE(.9)=ZNOTE
"RTN","BPSJVAL1",59,0)
 I +$G(VERBOSE) W !,RETCODE(.9)
"RTN","BPSJVAL1",60,0)
 ;
"RTN","BPSJVAL1",61,0)
 F SEGIX=3:1 S SEG=$G(^TMP("HLS",$J,SEGIX)),PIX=0 Q:SEG=""  D
"RTN","BPSJVAL1",62,0)
 . I $E(SEG,1,3)="ZQR" S ZQR=$E(SEG,4) S $E(SEG,1,4)=""
"RTN","BPSJVAL1",63,0)
 . I ZQR="" Q
"RTN","BPSJVAL1",64,0)
 . S PIXL=$L(SEG,ZQR)
"RTN","BPSJVAL1",65,0)
 . F  S RIX=RIX+1,PIX=PIX+1 Q:RIX>ZMAX  D
"RTN","BPSJVAL1",66,0)
 .. S RETCODE(RIX)=$P(SEG,ZQR,PIX) D @RIX
"RTN","BPSJVAL1",67,0)
 .. ; RIX 4 - EPHARM IN Port - no longer required nor validated
"RTN","BPSJVAL1",68,0)
 .. I +$G(VERBOSE),$L($G(RETCODE(RIX))),RIX'=4 W !,RETCODE(RIX) Q
"RTN","BPSJVAL1",69,0)
 ;
"RTN","BPSJVAL1",70,0)
 Q
"RTN","BPSJVAL1",71,0)
 ; NS=Not Supported, R=Required, RE=Required or empty, C=Conditional
"RTN","BPSJVAL1",72,0)
 ; CE=Conditional or empty, O=Optional,
"RTN","BPSJVAL1",73,0)
 ;
"RTN","BPSJVAL1",74,0)
1 ; Set ID - NS
"RTN","BPSJVAL1",75,0)
 Q
"RTN","BPSJVAL1",76,0)
2 ; Site Number - R
"RTN","BPSJVAL1",77,0)
 S ZNOTE="   SITE NUMBER - Required - VALID: "_RETCODE(RIX)
"RTN","BPSJVAL1",78,0)
 I RETCODE(RIX)="" S ZNOTE="** SITE NUMBER - Required - INVALID",RETCODE=2
"RTN","BPSJVAL1",79,0)
 S RETCODE(RIX)=ZNOTE
"RTN","BPSJVAL1",80,0)
 Q
"RTN","BPSJVAL1",81,0)
3 ; Interface Version - R
"RTN","BPSJVAL1",82,0)
 ;     Must equal 2 or greater for this validation version
"RTN","BPSJVAL1",83,0)
 S ZNOTE="   INTERFACE VERSION - Required - VALID: "
"RTN","BPSJVAL1",84,0)
 I RETCODE(RIX)<2 S ZNOTE="** INTERFACE VERSION - Required - INVALID: ",RETCODE=3
"RTN","BPSJVAL1",85,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL1",86,0)
 Q
"RTN","BPSJVAL1",87,0)
4 ; EPHARM IN port - NS
"RTN","BPSJVAL1",88,0)
 Q
"RTN","BPSJVAL1",89,0)
5 ; Contact Name
"RTN","BPSJVAL1",90,0)
 S RETCODE(RIX)="   CONTACT NAME - VALID: "_RETCODE(RIX)
"RTN","BPSJVAL1",91,0)
 Q
"RTN","BPSJVAL1",92,0)
6 ; Contact Means
"RTN","BPSJVAL1",93,0)
 S RETCODE(RIX)="   CONTACT MEANS - VALID: "_RETCODE(RIX)
"RTN","BPSJVAL1",94,0)
 Q
"RTN","BPSJVAL1",95,0)
7 ; Alternate Contact NAME
"RTN","BPSJVAL1",96,0)
 S RETCODE(RIX)="   ALTERNATE CONTACT NAME - VALID: "_RETCODE(RIX)
"RTN","BPSJVAL1",97,0)
 Q
"RTN","BPSJVAL1",98,0)
8 ; Alternate Contact Means
"RTN","BPSJVAL1",99,0)
 S RETCODE(RIX)="   ALTERNATE CONTACT MEANS - VALID: "_RETCODE(RIX)
"RTN","BPSJVAL1",100,0)
 Q
"RTN","BPSJVAL2")
0^360^B30079900
"RTN","BPSJVAL2",1,0)
BPSJVAL2 ;BHAM ISC/LJF - Validate Pharmacy data ;2004-03-01
"RTN","BPSJVAL2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJVAL2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJVAL2",4,0)
 ;
"RTN","BPSJVAL2",5,0)
 N PHARMIX,RET,DIR,X
"RTN","BPSJVAL2",6,0)
 ;
"RTN","BPSJVAL2",7,0)
 S PHARMIX=0,X=""
"RTN","BPSJVAL2",8,0)
 F  S PHARMIX=$O(^BPS(9002313.56,PHARMIX)) Q:'PHARMIX  D  Q:X=U
"RTN","BPSJVAL2",9,0)
 . D DT^DICRW,HOME^%ZIS,CLEAR^VALM1
"RTN","BPSJVAL2",10,0)
 . W !!,"VERIFY PHARMACY REGISTRATIONS DATA.",!
"RTN","BPSJVAL2",11,0)
 . D REG^BPSJPREG(PHARMIX,2)
"RTN","BPSJVAL2",12,0)
 . W !
"RTN","BPSJVAL2",13,0)
 . S DIR(0)="EO" D ^DIR
"RTN","BPSJVAL2",14,0)
 ;
"RTN","BPSJVAL2",15,0)
 Q
"RTN","BPSJVAL2",16,0)
 ;
"RTN","BPSJVAL2",17,0)
VALIDATE ;
"RTN","BPSJVAL2",18,0)
 N SEG,SEGIX,ZRP,RAY,RIX,PIX,PIXL,SEGDAT,ZNOTE,ZMAX,CPS,FS,REP
"RTN","BPSJVAL2",19,0)
 N VALDATA
"RTN","BPSJVAL2",20,0)
 S ZMAX=16
"RTN","BPSJVAL2",21,0)
 ;
"RTN","BPSJVAL2",22,0)
 S RETCODE=$G(RETCODE)
"RTN","BPSJVAL2",23,0)
 S ZRP="",RIX=0
"RTN","BPSJVAL2",24,0)
 ;
"RTN","BPSJVAL2",25,0)
 ; Set HL7 Delimiters - use standard defaults if none provided
"RTN","BPSJVAL2",26,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"
"RTN","BPSJVAL2",27,0)
 S CPS=$E($G(HL("ECH"))) I CPS="" S CPS="^"
"RTN","BPSJVAL2",28,0)
 S REP=$E($G(HL("ECH")),2) I REP="" S REP="~"
"RTN","BPSJVAL2",29,0)
 ;
"RTN","BPSJVAL2",30,0)
 F SEGIX=3:1 S SEG=$G(^TMP("HLS",$J,SEGIX)),PIX=0 Q:SEG=""  D  I ZRP]"" Q
"RTN","BPSJVAL2",31,0)
 . I $E(SEG,1,3)="ZRP" S ZRP=$E(SEG,4) S $E(SEG,1,4)=""
"RTN","BPSJVAL2",32,0)
 I ZRP="" Q
"RTN","BPSJVAL2",33,0)
 F  S RIX=$O(^TMP("HLS",$J,SEGIX,RIX)) Q:'RIX  I RIX<(ZMAX+1) D
"RTN","BPSJVAL2",34,0)
 . S RETCODE(RIX)=$P($G(^TMP("HLS",$J,SEGIX,RIX)),ZRP) D @RIX
"RTN","BPSJVAL2",35,0)
 . I +$G(VERBOSE),$L($G(RETCODE(RIX))) W !,RETCODE(RIX) Q
"RTN","BPSJVAL2",36,0)
 ;
"RTN","BPSJVAL2",37,0)
 Q
"RTN","BPSJVAL2",38,0)
 ;
"RTN","BPSJVAL2",39,0)
 ; NS=Not Supported, R=Required, RE=Required or empty, C=Conditional
"RTN","BPSJVAL2",40,0)
 ; CE=Conditional or empty, O=Optional,
"RTN","BPSJVAL2",41,0)
 ;
"RTN","BPSJVAL2",42,0)
1 ; Set ID - NS
"RTN","BPSJVAL2",43,0)
 Q
"RTN","BPSJVAL2",44,0)
2 ; NABP Number - R
"RTN","BPSJVAL2",45,0)
 S ZNOTE="   NABP NUMBER - Required - VALID"
"RTN","BPSJVAL2",46,0)
 I RETCODE(RIX)="" S ZNOTE="** NABP NUMBER - Required - INVALID",RETCODE=2
"RTN","BPSJVAL2",47,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",48,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",49,0)
 Q
"RTN","BPSJVAL2",50,0)
3 ; PHARMACY NAME - R
"RTN","BPSJVAL2",51,0)
 S ZNOTE="   PHARMACY NAME - Required - VALID"
"RTN","BPSJVAL2",52,0)
 I RETCODE(RIX)="" S ZNOTE="** PHARMACY NAME - Required - INVALID",RETCODE=3
"RTN","BPSJVAL2",53,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",54,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",55,0)
 Q
"RTN","BPSJVAL2",56,0)
4 ; DEA Number - R
"RTN","BPSJVAL2",57,0)
 S ZNOTE="   DEA NUMBER - Required - VALID"
"RTN","BPSJVAL2",58,0)
 I RETCODE(RIX)="" S ZNOTE="** DEA NUMBER - Required - INVALID",RETCODE=4
"RTN","BPSJVAL2",59,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",60,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",61,0)
 Q
"RTN","BPSJVAL2",62,0)
5 ; Hour of Operation
"RTN","BPSJVAL2",63,0)
 S ZNOTE="   HOURS OF OPERATION - VALID"
"RTN","BPSJVAL2",64,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",65,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",66,0)
 Q
"RTN","BPSJVAL2",67,0)
6 ; Mailing Address - R
"RTN","BPSJVAL2",68,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",69,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)          ; Street address
"RTN","BPSJVAL2",70,0)
 S VALDATA=($L($P(ZNOTE,CPS,3))<1)+VALDATA  ; City
"RTN","BPSJVAL2",71,0)
 S VALDATA=($L($P(ZNOTE,CPS,4))<1)+VALDATA  ; State
"RTN","BPSJVAL2",72,0)
 S VALDATA=($L($P(ZNOTE,CPS,5))<1)+VALDATA  ; Zip
"RTN","BPSJVAL2",73,0)
 S ZNOTE="   MAILING ADDRESS - Required - VALID"
"RTN","BPSJVAL2",74,0)
 I VALDATA S ZNOTE="** MAILING ADDRESS - Required - INVALID",RETCODE=6
"RTN","BPSJVAL2",75,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",76,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",77,0)
 Q
"RTN","BPSJVAL2",78,0)
7 ; Remittance Address - R
"RTN","BPSJVAL2",79,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",80,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)          ; Street Address
"RTN","BPSJVAL2",81,0)
 S VALDATA=($L($P(ZNOTE,CPS,3))<1)+VALDATA  ; City
"RTN","BPSJVAL2",82,0)
 S VALDATA=($L($P(ZNOTE,CPS,4))<1)+VALDATA  ; State
"RTN","BPSJVAL2",83,0)
 S VALDATA=($L($P(ZNOTE,CPS,5))<1)+VALDATA  ; Zip
"RTN","BPSJVAL2",84,0)
 S ZNOTE="   REMITTANCE ADDRESS - Required - VALID"
"RTN","BPSJVAL2",85,0)
 I VALDATA S ZNOTE="** REMITTANCE ADDRESS - Required - INVALID",RETCODE=7
"RTN","BPSJVAL2",86,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",87,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",88,0)
 Q
"RTN","BPSJVAL2",89,0)
8 ; Contact Name
"RTN","BPSJVAL2",90,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",91,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)  ; Surname
"RTN","BPSJVAL2",92,0)
 S ZNOTE="   CONTACT NAME - Required - VALID"
"RTN","BPSJVAL2",93,0)
 I VALDATA S ZNOTE="** CONTACT NAME - Required - INVALID",RETCODE=8
"RTN","BPSJVAL2",94,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",95,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",96,0)
 Q
"RTN","BPSJVAL2",97,0)
9 ; Contact Title
"RTN","BPSJVAL2",98,0)
 S ZNOTE="   CONTACT TITLE - VALID"
"RTN","BPSJVAL2",99,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",100,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",101,0)
 Q
"RTN","BPSJVAL2",102,0)
10 ; Contact means
"RTN","BPSJVAL2",103,0)
 S ZNOTE="   CONTACT MEANS - VALID"
"RTN","BPSJVAL2",104,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",105,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",106,0)
 Q
"RTN","BPSJVAL2",107,0)
11 ; Alternate Contact Name
"RTN","BPSJVAL2",108,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",109,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)  ; Surname
"RTN","BPSJVAL2",110,0)
 S ZNOTE="   ALTERNATE CONTACT NAME - Required - VALID"
"RTN","BPSJVAL2",111,0)
 I VALDATA S ZNOTE="** ALTERNATE CONTACT NAME - Required - INVALID",RETCODE=11
"RTN","BPSJVAL2",112,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",113,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",114,0)
 Q
"RTN","BPSJVAL2",115,0)
12 ; Alternate Contact Title
"RTN","BPSJVAL2",116,0)
 S ZNOTE="   ALTERNATE CONTACT TITLE - VALID"
"RTN","BPSJVAL2",117,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",118,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",119,0)
 Q
"RTN","BPSJVAL2",120,0)
13 ; Alternate Contact means
"RTN","BPSJVAL2",121,0)
 S ZNOTE="   ALTERNATE CONTACT MEANS - VALID"
"RTN","BPSJVAL2",122,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",123,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",124,0)
 Q
"RTN","BPSJVAL2",125,0)
14 ; Lead Pharmacist Name - R
"RTN","BPSJVAL2",126,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",127,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)  ; Surname
"RTN","BPSJVAL2",128,0)
 S ZNOTE="   LEAD PHARMACIST NAME - Required - VALID"
"RTN","BPSJVAL2",129,0)
 I VALDATA S ZNOTE="** LEAD PHARMACIST NAME - Required - INVALID",RETCODE=14
"RTN","BPSJVAL2",130,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",131,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",132,0)
 Q
"RTN","BPSJVAL2",133,0)
15 ; Lead Pharmacist Title
"RTN","BPSJVAL2",134,0)
 S ZNOTE="   LEAD PHARMACIST TITLE - VALID"
"RTN","BPSJVAL2",135,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",136,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",137,0)
 Q
"RTN","BPSJVAL2",138,0)
16 ; Lead Pharmacist License Number
"RTN","BPSJVAL2",139,0)
 S ZNOTE="   LEAD PHARMACIST LICENSE NUMBER - VALID"
"RTN","BPSJVAL2",140,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_RETCODE(RIX)
"RTN","BPSJVAL2",141,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",142,0)
 Q
"RTN","BPSJVAL2",143,0)
 ;
"RTN","BPSJVAL2",144,0)
TRIMTAIL(INSTR) ;
"RTN","BPSJVAL2",145,0)
 N OUTSTR,CHR
"RTN","BPSJVAL2",146,0)
 ;
"RTN","BPSJVAL2",147,0)
 I $G(INSTR)="" Q ""   ; quit if nothing there
"RTN","BPSJVAL2",148,0)
 ;
"RTN","BPSJVAL2",149,0)
 S INSTR=$RE(INSTR)
"RTN","BPSJVAL2",150,0)
 S CHR=$E($TR(INSTR,CPS_REP))
"RTN","BPSJVAL2",151,0)
 I CHR]"" Q $RE($P(INSTR,CHR,2,200))_CHR
"RTN","BPSJVAL2",152,0)
 Q ""
"RTN","BPSJXI1")
0^361^B1826477
"RTN","BPSJXI1",1,0)
BPSJXI1 ;BHAM ISC/DMK - BPS 1.0 Post-Installation Routine # 1 ;10-MAY-2004
"RTN","BPSJXI1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJXI1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJXI1",4,0)
 ;
"RTN","BPSJXI1",5,0)
 ; BPS 1.0 post installation routine
"RTN","BPSJXI1",6,0)
 ; BPS 1.0 is an e-Pharmacy (ECME 1.0) component patch
"RTN","BPSJXI1",7,0)
 ;
"RTN","BPSJXI1",8,0)
EPHARMIN ; Update HL LOGICAL LINK File for EPHARM IN & EPHARM OUT records
"RTN","BPSJXI1",9,0)
 ;
"RTN","BPSJXI1",10,0)
 N IEN870,DA,DIE,DR
"RTN","BPSJXI1",11,0)
 ;
"RTN","BPSJXI1",12,0)
 S IEN870("ROOT")=$$ROOT^DILFD(870),IEN870("PORT")=5105
"RTN","BPSJXI1",13,0)
 S IEN870("EPHARM OUT")=$$FIND1^DIC(870,"",,"EPHARM OUT","B")
"RTN","BPSJXI1",14,0)
 S IEN870("IIV EC")=$$FIND1^DIC(870,"",,"IIV EC","B")
"RTN","BPSJXI1",15,0)
 S DIE="EPHARMACY.VITRIA-EDI.AAC.VA.GOV"
"RTN","BPSJXI1",16,0)
 D DNS^XMXADDRD(0,DIE,.DA,.DR)
"RTN","BPSJXI1",17,0)
 I $G(DA),$G(DIE)=$G(DR) S IEN870("DOMAIN")=$G(DA)
"RTN","BPSJXI1",18,0)
 ;
"RTN","BPSJXI1",19,0)
 ;
"RTN","BPSJXI1",20,0)
 ; set the IP, Port and Domain to EPHARM OUT
"RTN","BPSJXI1",21,0)
 I IEN870("IIV EC") D
"RTN","BPSJXI1",22,0)
 . S IEN870("IIV EC IP")=$$GET1^DIQ(870,IEN870("IIV EC")_",",400.01)
"RTN","BPSJXI1",23,0)
 . ;
"RTN","BPSJXI1",24,0)
 . K DA,DR,DIE,DR
"RTN","BPSJXI1",25,0)
 . S DA=IEN870("EPHARM OUT"),DIE=IEN870("ROOT")
"RTN","BPSJXI1",26,0)
 . S DR="400.01////"_IEN870("IIV EC IP")_";400.02////"_IEN870("PORT")
"RTN","BPSJXI1",27,0)
 . I $G(IEN870("DOMAIN")) S DR=DR_";.03////"_IEN870("DOMAIN")
"RTN","BPSJXI1",28,0)
 . D ^DIE
"RTN","BPSJXI1",29,0)
 Q
"RTN","BPSJZPR")
0^362^B62093577
"RTN","BPSJZPR",1,0)
BPSJZPR ;BHAM ISC/CMW/LJF - Process Incoming HL7 ZPR Message ;01-DEC-2003
"RTN","BPSJZPR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJZPR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJZPR",4,0)
 ;
"RTN","BPSJZPR",5,0)
 ; Description:
"RTN","BPSJZPR",6,0)
 ; Process incoming HL7 ZPR Messages
"RTN","BPSJZPR",7,0)
 ; Update Payer Sheet File (9002313.92)
"RTN","BPSJZPR",8,0)
 ;
"RTN","BPSJZPR",9,0)
 Q
"RTN","BPSJZPR",10,0)
 ;
"RTN","BPSJZPR",11,0)
 ; Entry point
"RTN","BPSJZPR",12,0)
EN(BPSJEN,BPSJSEG,BPSJROOT,BPSFILE) ;
"RTN","BPSJZPR",13,0)
 ;
"RTN","BPSJZPR",14,0)
 N BPRCODE,BPSF,BPSFDIC,BPSEGID,BPORDER,BPMODE,BPNOTES,BPSETID
"RTN","BPSJZPR",15,0)
 N FLN,FLNSC,FLNPN,FLNSPEC
"RTN","BPSJZPR",16,0)
 N DIE,DIC,DLAYGO,DR,DA,DINUM
"RTN","BPSJZPR",17,0)
 N C,X,Y,NCNT,BPND
"RTN","BPSJZPR",18,0)
 ;
"RTN","BPSJZPR",19,0)
 I $G(BPSJEN),$G(BPSJROOT)]"",$G(BPSFILE)]"",$D(BPSJSEG)
"RTN","BPSJZPR",20,0)
 E  Q   ; invalid info
"RTN","BPSJZPR",21,0)
 ;
"RTN","BPSJZPR",22,0)
 S BPRCODE=$$ZPR(),DIE=$G(BPSJROOT),C=","
"RTN","BPSJZPR",23,0)
 ;
"RTN","BPSJZPR",24,0)
 I BPRCODE,BPSEGID,BPORDER
"RTN","BPSJZPR",25,0)
 E  Q
"RTN","BPSJZPR",26,0)
 ;
"RTN","BPSJZPR",27,0)
 S BPSF=DIE_BPSJEN_C_BPSEGID_",0)"
"RTN","BPSJZPR",28,0)
 I '$D(@BPSF) D
"RTN","BPSJZPR",29,0)
 . S FLNSPEC=$$GET1^DID(BPSFILE,BPSEGID,"","SPECIFIER")
"RTN","BPSJZPR",30,0)
 . S @BPSF=U_FLNSPEC_U_U
"RTN","BPSJZPR",31,0)
 ;
"RTN","BPSJZPR",32,0)
 S (X,DINUM)=BPORDER
"RTN","BPSJZPR",33,0)
 S DA(1)=BPSJEN,DIC=DIE_BPSJEN_C_BPSEGID_C
"RTN","BPSJZPR",34,0)
 S DIC(0)="L",(DIC("P"),DLAYGO)=FLN
"RTN","BPSJZPR",35,0)
 D ^DIC
"RTN","BPSJZPR",36,0)
 ;
"RTN","BPSJZPR",37,0)
 S DA=+Y
"RTN","BPSJZPR",38,0)
 S DIE=DIC
"RTN","BPSJZPR",39,0)
 S DR=".02////"_BPRCODE_";.03////"_BPMODE
"RTN","BPSJZPR",40,0)
 D ^DIE
"RTN","BPSJZPR",41,0)
 ;
"RTN","BPSJZPR",42,0)
 S BPSFDIC=DIC ; save dictionary ID
"RTN","BPSJZPR",43,0)
 ; NOTES
"RTN","BPSJZPR",44,0)
 I $D(BPSJSEG(8)) D
"RTN","BPSJZPR",45,0)
 . S DIC=BPSFDIC,DIE=BPSFDIC_BPORDER_",2,",BPSF=DIE_"0)"
"RTN","BPSJZPR",46,0)
 . I '$D(@BPSF) S @BPSF=U_FLNPN_U_U
"RTN","BPSJZPR",47,0)
 . S BPND="BPSJSEG(7,99)",NCNT=0
"RTN","BPSJZPR",48,0)
 . F  S BPND=$Q(@BPND) Q:BPND=""  I $G(@BPND)]"" D
"RTN","BPSJZPR",49,0)
 .. S DIC=BPSFDIC,DIE=BPSFDIC_BPORDER_",2,",BPSF=DIE_"0)"
"RTN","BPSJZPR",50,0)
 .. K DA S DA(4)=BPSJEN,DA(3)=BPSEGID,DA(2)=BPORDER,DA(1)=2,(NCNT,DA)=NCNT+1
"RTN","BPSJZPR",51,0)
 .. K DR S DR=".01////"_@BPND
"RTN","BPSJZPR",52,0)
 .. D ^DIE
"RTN","BPSJZPR",53,0)
 K BPSJSEG(8) ; kill 8 so $Q of 7 won't find it
"RTN","BPSJZPR",54,0)
 ;
"RTN","BPSJZPR",55,0)
 ; Special Code
"RTN","BPSJZPR",56,0)
 I $D(BPSJSEG(7)) D
"RTN","BPSJZPR",57,0)
 . S DIC=BPSFDIC,DIE=BPSFDIC_BPORDER_",1,",BPSF=DIE_"0)"
"RTN","BPSJZPR",58,0)
 . I '$D(@BPSF) S @BPSF=U_FLNSC_U_U
"RTN","BPSJZPR",59,0)
 . S BPND="BPSJSEG(6,99)",NCNT=0
"RTN","BPSJZPR",60,0)
 . F  S BPND=$Q(@BPND) Q:BPND=""  I $G(@BPND)]"" D
"RTN","BPSJZPR",61,0)
 .. S DIC=BPSFDIC,DIE=BPSFDIC_BPORDER_",1,",BPSF=DIE_"0)"
"RTN","BPSJZPR",62,0)
 .. K DA S DA(4)=BPSJEN,DA(3)=BPSEGID,DA(2)=BPORDER,DA(1)=1,(NCNT,DA)=NCNT+1
"RTN","BPSJZPR",63,0)
 .. K DR S DR=".01////"_@BPND
"RTN","BPSJZPR",64,0)
 .. D ^DIE
"RTN","BPSJZPR",65,0)
 Q
"RTN","BPSJZPR",66,0)
 ;
"RTN","BPSJZPR",67,0)
ZPR() ; Validate Fields and Initialize ZPR variables
"RTN","BPSJZPR",68,0)
 N RCODE,WDATA
"RTN","BPSJZPR",69,0)
 ;
"RTN","BPSJZPR",70,0)
 ; Reject reasons: 1=Missing ,2=Invalid
"RTN","BPSJZPR",71,0)
 ;
"RTN","BPSJZPR",72,0)
 S BPSETID=$G(BPSJSEG(2))
"RTN","BPSJZPR",73,0)
 ;
"RTN","BPSJZPR",74,0)
 S BPSEGID=$G(BPSJSEG(3))
"RTN","BPSJZPR",75,0)
 I BPSEGID="" S BPSEGID=0 D
"RTN","BPSJZPR",76,0)
 . S ^TMP($J,"BPSJ-ERROR","ZPR",BPSETID,2)="V632-1,"_BPSETID
"RTN","BPSJZPR",77,0)
 E  S BPSEGID=$G(ZPRS(BPSEGID)) D
"RTN","BPSJZPR",78,0)
 . I 'BPSEGID S BPSEGID=0 D  Q
"RTN","BPSJZPR",79,0)
 .. S ^TMP($J,"BPSJ-ERROR","ZPR",BPSETID,2)="V632-2,"_BPSETID
"RTN","BPSJZPR",80,0)
 . ;
"RTN","BPSJZPR",81,0)
 . S FLN=$P(BPSEGID,U,2)
"RTN","BPSJZPR",82,0)
 . S FLNSC=$P(BPSEGID,U,3)
"RTN","BPSJZPR",83,0)
 . S FLNPN=$P(BPSEGID,U,4)
"RTN","BPSJZPR",84,0)
 . S BPSEGID=+BPSEGID
"RTN","BPSJZPR",85,0)
 ;
"RTN","BPSJZPR",86,0)
 S RCODE=$$GETPTR($G(BPSJSEG(4)))
"RTN","BPSJZPR",87,0)
 I 'RCODE S ^TMP($J,"BPSJ-ERROR","ZPR",BPSETID,3)="V633-2,"_BPSETID
"RTN","BPSJZPR",88,0)
 I $G(BPSJSEG(4))="" S ^TMP($J,"BPSJ-ERROR","ZPR",BPSETID,3)="V633-1,"_BPSETID
"RTN","BPSJZPR",89,0)
 ;
"RTN","BPSJZPR",90,0)
 S BPORDER=$G(BPSJSEG(5))
"RTN","BPSJZPR",91,0)
 I BPORDER="" S ^TMP($J,"BPSJ-ERROR","ZPR",BPSETID,4)="V634,"_BPSETID
"RTN","BPSJZPR",92,0)
 ;
"RTN","BPSJZPR",93,0)
 S BPMODE=$G(BPSJSEG(6))
"RTN","BPSJZPR",94,0)
 ;
"RTN","BPSJZPR",95,0)
 I BPMODE'="X",BPMODE'="S" D
"RTN","BPSJZPR",96,0)
 . S ^TMP($J,"BPSJ-ERROR","ZPR",BPSETID,5)="V635,"_BPSETID
"RTN","BPSJZPR",97,0)
 ;
"RTN","BPSJZPR",98,0)
 I '$L($G(BPSJSEG(7))),$D(BPSJSEG(7))'>1 K BPSJSEG(7)
"RTN","BPSJZPR",99,0)
 E  D     ;NOTES(.BPSJSEG(7))
"RTN","BPSJZPR",100,0)
 . K WDATA M WDATA(7)=BPSJSEG(7) D NOTES(.WDATA)
"RTN","BPSJZPR",101,0)
 . K BPSJSEG(7) M BPSJSEG(7)=WDATA K WDATA
"RTN","BPSJZPR",102,0)
 ;
"RTN","BPSJZPR",103,0)
 ; flag error if processing mode="X" and no special code
"RTN","BPSJZPR",104,0)
 I BPMODE="X",'$D(BPSJSEG(7)) S ^TMP($J,"BPSJ-ERROR","ZPR",BPSETID,6)="V636,"_BPSETID
"RTN","BPSJZPR",105,0)
 ;
"RTN","BPSJZPR",106,0)
 I '$L($G(BPSJSEG(8))),$D(BPSJSEG(8))'>1 K BPSJSEG(8)
"RTN","BPSJZPR",107,0)
 E  D   ;NOTES(.BPSJSEG(8))
"RTN","BPSJZPR",108,0)
 . K WDATA M WDATA(8)=BPSJSEG(8) D NOTES(.WDATA)
"RTN","BPSJZPR",109,0)
 . K BPSJSEG(8) M BPSJSEG(8)=WDATA K WDATA
"RTN","BPSJZPR",110,0)
 ;
"RTN","BPSJZPR",111,0)
 Q RCODE
"RTN","BPSJZPR",112,0)
 ;
"RTN","BPSJZPR",113,0)
NOTES(ARRAYIN,TRCH) ; fProgrammer Notes - Special Code handler
"RTN","BPSJZPR",114,0)
 ;
"RTN","BPSJZPR",115,0)
 N II,ODAT,NODENM
"RTN","BPSJZPR",116,0)
 N ISDATA,ISDATA1,ISDATA2,ISDATA3
"RTN","BPSJZPR",117,0)
 ;
"RTN","BPSJZPR",118,0)
 I '$D(TRCH) D   ; apply standard Vista/Vitria "Free Text" de-encoding
"RTN","BPSJZPR",119,0)
 . S TRCH("\F\")="|",TRCH("\R\")="~",TRCH("\E\")="\"
"RTN","BPSJZPR",120,0)
 . S TRCH("\T\")="&",TRCH("\S\")="^"
"RTN","BPSJZPR",121,0)
 . S TRCH("\.b")=1,TRCH("\.br\")=1
"RTN","BPSJZPR",122,0)
 ;
"RTN","BPSJZPR",123,0)
 S NODENM="ARRAYIN"
"RTN","BPSJZPR",124,0)
 ;
"RTN","BPSJZPR",125,0)
 S (ODAT,ISDATA1)=""
"RTN","BPSJZPR",126,0)
 F  S NODENM=$Q(@NODENM) Q:NODENM=""  S ISDATA=@NODENM D
"RTN","BPSJZPR",127,0)
 . ; clean up partial string if any
"RTN","BPSJZPR",128,0)
 . I $L(ISDATA1) D  I '$L(ISDATA) Q
"RTN","BPSJZPR",129,0)
 .. S ISDATA1=ISDATA1_$E(ISDATA,1,10)
"RTN","BPSJZPR",130,0)
 .. S ISDATA3=$$DECODE(ISDATA1,.TRCH,.ODAT,.ISDATA2)
"RTN","BPSJZPR",131,0)
 .. S $E(ISDATA,1,10)=ISDATA2
"RTN","BPSJZPR",132,0)
 . ;
"RTN","BPSJZPR",133,0)
 . S ISDATA2=$$DECODE(ISDATA,.TRCH,.ODAT,.ISDATA1)
"RTN","BPSJZPR",134,0)
 ;
"RTN","BPSJZPR",135,0)
 S ODAT=ODAT_ISDATA1 D NWNODE(.ODAT) K ARRAYIN M ARRAYIN=ODAT
"RTN","BPSJZPR",136,0)
 Q
"RTN","BPSJZPR",137,0)
 ;
"RTN","BPSJZPR",138,0)
NWNODE(FREERAY) ; build free text array
"RTN","BPSJZPR",139,0)
 N CNT
"RTN","BPSJZPR",140,0)
 S CNT=1+$O(FREERAY(""),-1),FREERAY(CNT)=FREERAY,FREERAY=""
"RTN","BPSJZPR",141,0)
 Q
"RTN","BPSJZPR",142,0)
 ;
"RTN","BPSJZPR",143,0)
DECODE(INSTR,TCH,WDAT,INSTR1) ;
"RTN","BPSJZPR",144,0)
 ; INSTR - Input string
"RTN","BPSJZPR",145,0)
 ; TCH   - translation array
"RTN","BPSJZPR",146,0)
 ; WDAT  - Output in a Vista compliant "Free Text" array
"RTN","BPSJZPR",147,0)
 ; INSTR1 - Remainder of text when last or
"RTN","BPSJZPR",148,0)
 ;          second to last INSTR char = "\"
"RTN","BPSJZPR",149,0)
 ;Development Note:
"RTN","BPSJZPR",150,0)
 ;\.br\ - removed and new node created
"RTN","BPSJZPR",151,0)
 ;\E\.br\E\ = \.br\ - (no further translation)
"RTN","BPSJZPR",152,0)
 ;non-printable character translation not supported
"RTN","BPSJZPR",153,0)
 ;Output Array nodes will contain no more than 200 characters each
"RTN","BPSJZPR",154,0)
 ;
"RTN","BPSJZPR",155,0)
 N II,CH
"RTN","BPSJZPR",156,0)
 S INSTR1="",WDAT=$G(WDAT)
"RTN","BPSJZPR",157,0)
 F II=1:1:$L(INSTR) S CH=$E(INSTR,II) D:CH="\"  S WDAT=WDAT_CH I $L(WDAT)>199 D NWNODE(.WDAT)
"RTN","BPSJZPR",158,0)
 . ;
"RTN","BPSJZPR",159,0)
 . ;  Partial TCH string, if \.br\ (CR-LF) translation allowed
"RTN","BPSJZPR",160,0)
 . I $L($E(INSTR,II,II+2))<3,$G(TCH("\.br\")) D  Q
"RTN","BPSJZPR",161,0)
 .. S INSTR1=$E(INSTR,II,II+2),II=$L(INSTR),CH=""
"RTN","BPSJZPR",162,0)
 . ;
"RTN","BPSJZPR",163,0)
 . I '$D(TCH($E(INSTR,II,II+2))) Q     ; not one we're interested in
"RTN","BPSJZPR",164,0)
 . I +$G(TCH($E(INSTR,II,II+2))) D  Q  ; \.br\ to <CR-LF> conversion
"RTN","BPSJZPR",165,0)
 .. I (II+4)>$L(INSTR) S INSTR1=$E(INSTR,II,$L(INSTR)),II=$L(INSTR),CH="" Q
"RTN","BPSJZPR",166,0)
 .. I +$G(TCH($E(INSTR,II,II+4))) S II=II+4,CH="" D NWNODE(.WDAT)
"RTN","BPSJZPR",167,0)
 . ;
"RTN","BPSJZPR",168,0)
 . S CH=TCH($E(INSTR,II,II+2)),II=II+2  ; std conversion
"RTN","BPSJZPR",169,0)
 Q WDAT   ; Return top node of WDAT - for strings less than 200 characters
"RTN","BPSJZPR",170,0)
 ;
"RTN","BPSJZPR",171,0)
GETPTR(BPDAT) ; Get pointer into BPS NCPDP FIELD DEFS
"RTN","BPSJZPR",172,0)
 N BPSFNM,BPSFNO,BPSIX,BPSIXALT,BPSFX,BPNAMIX,BPNUMIX,BPSFNOCK
"RTN","BPSJZPR",173,0)
 ;
"RTN","BPSJZPR",174,0)
 S BPSFNM=$P($G(BPDAT),"-",2),BPSFNO=+$G(BPDAT)
"RTN","BPSJZPR",175,0)
 I BPSFNM]"",BPSFNO S (BPSIX,BPSIXALT)=0,BPSFX=BPSFNO_U_BPSFNM
"RTN","BPSJZPR",176,0)
 E  Q 0
"RTN","BPSJZPR",177,0)
 S BPNAMIX=$O(^BPSF(9002313.91,"D",BPSFNM,""))
"RTN","BPSJZPR",178,0)
 S BPNUMIX=$O(^BPSF(9002313.91,"B",BPSFNO,""))
"RTN","BPSJZPR",179,0)
 ;
"RTN","BPSJZPR",180,0)
 ;-if NAME and NUMBER point to the same IEN (but not 0)
"RTN","BPSJZPR",181,0)
 I BPNAMIX,BPNUMIX=BPNAMIX Q BPNAMIX
"RTN","BPSJZPR",182,0)
 ;
"RTN","BPSJZPR",183,0)
 ;-else might be in another node of the "D" x-ref
"RTN","BPSJZPR",184,0)
 I BPNAMIX,BPNUMIX F  D  Q:BPSIX  Q:'BPNAMIX
"RTN","BPSJZPR",185,0)
 . S BPNAMIX=$O(^BPSF(9002313.91,"D",BPSFNM,BPNAMIX))
"RTN","BPSJZPR",186,0)
 . I BPNUMIX=BPNAMIX S BPSIX=BPNAMIX
"RTN","BPSJZPR",187,0)
 ;
"RTN","BPSJZPR",188,0)
 ;-If not found, try "B" x-ref value
"RTN","BPSJZPR",189,0)
 I 'BPSIX,BPNUMIX D
"RTN","BPSJZPR",190,0)
 . I $P($G(^BPSF(9002313.91,BPNUMIX,5)),U)=BPSFNM S BPSIX=BPNUMIX Q
"RTN","BPSJZPR",191,0)
 . I 'BPSIXALT,$P($G(^BPSF(9002313.91,BPNUMIX,0)),U,1,2)=BPSFX S BPSIXALT=BPNUMIX Q
"RTN","BPSJZPR",192,0)
 . ;
"RTN","BPSJZPR",193,0)
 . ;-try additional "B" x-ref's for this NUMBER
"RTN","BPSJZPR",194,0)
 . F  D  Q:BPSIX  Q:'BPNUMIX
"RTN","BPSJZPR",195,0)
 .. S BPNUMIX=$O(^BPSF(9002313.91,"B",BPSFNO,BPNUMIX))
"RTN","BPSJZPR",196,0)
 .. I BPNUMIX D
"RTN","BPSJZPR",197,0)
 ... I $P($G(^BPSF(9002313.91,BPNUMIX,5)),U)=BPSFNM S BPSIX=BPNUMIX
"RTN","BPSJZPR",198,0)
 ... I 'BPSIXALT,$P($G(^BPSF(9002313.91,BPNUMIX,0)),U,1,2)=BPSFX S BPSIXALT=BPNUMIX
"RTN","BPSJZPR",199,0)
 ;
"RTN","BPSJZPR",200,0)
 ;-Last resort - go through all iens'
"RTN","BPSJZPR",201,0)
 I 'BPSIX S BPNUMIX=0 F  D  Q:BPSIX  Q:'BPNUMIX
"RTN","BPSJZPR",202,0)
 . S BPNUMIX=$O(^BPSF(9002313.91,BPNUMIX))
"RTN","BPSJZPR",203,0)
 . I BPNUMIX,+$G(^BPSF(9002313.91,BPNUMIX,0))[BPSFNO D
"RTN","BPSJZPR",204,0)
 .. S BPSFNOCK=+$G(^BPSF(9002313.91,BPNUMIX,0))
"RTN","BPSJZPR",205,0)
 .. ; Note: Special coding included for BPSFNO of 498 (498.nn)
"RTN","BPSJZPR",206,0)
 .. I BPSFNOCK'=BPSFNO,$P(BPSFNOCK,".")'=498 Q
"RTN","BPSJZPR",207,0)
 .. I $P($G(^BPSF(9002313.91,BPNUMIX,5)),U)=BPSFNM S BPSIX=BPNUMIX
"RTN","BPSJZPR",208,0)
 .. I 'BPSIXALT,$P($G(^BPSF(9002313.91,BPNUMIX,0)),U,1,2)=BPSFX S BPSIXALT=BPNUMIX
"RTN","BPSJZPR",209,0)
 ;
"RTN","BPSJZPR",210,0)
 Q BPSIX
"RTN","BPSJZPR",211,0)
 ;
"RTN","BPSJZPR",212,0)
INITZPRS(ZPRS) ;BPSEGID^FLN^FLNSC^FLNPN
"RTN","BPSJZPR",213,0)
 S ZPRS(0)="100^9002313.9205^9002313.92051^9002313.92052"
"RTN","BPSJZPR",214,0)
 S ZPRS(1)="110^9002313.9206^9002313.92061^9002313.92062"
"RTN","BPSJZPR",215,0)
 S ZPRS(2)="140^9002313.9209^9002313.92091^9002313.92092"
"RTN","BPSJZPR",216,0)
 S ZPRS(3)="150^9002313.921^9002313.9211^9002313.9212"
"RTN","BPSJZPR",217,0)
 S ZPRS(4)="120^9002313.9207^9002313.92071^9002313.92072"
"RTN","BPSJZPR",218,0)
 S ZPRS(5)="160^9002313.9213^9002313.92131^9002313.92132"
"RTN","BPSJZPR",219,0)
 S ZPRS(6)="170^9002313.9214^9002313.92141^9002313.92142"
"RTN","BPSJZPR",220,0)
 S ZPRS(7)="130^9002313.9208^9002313.92081^9002313.92082"
"RTN","BPSJZPR",221,0)
 S ZPRS(8)="180^9002313.9215^9002313.92151^9002313.92152"
"RTN","BPSJZPR",222,0)
 S ZPRS(9)="200^9002313.9217^9002313.92171^9002313.92172"
"RTN","BPSJZPR",223,0)
 S ZPRS(10)="210^9002313.9218^9002313.92181^9002313.92182"
"RTN","BPSJZPR",224,0)
 S ZPRS(11)="190^9002313.9216^9002313.92161^9002313.92162"
"RTN","BPSJZPR",225,0)
 S ZPRS(12)="220^9002313.9219^9002313.92191^9002313.92192"
"RTN","BPSJZPR",226,0)
 S ZPRS(13)="230^9002313.922^9002313.9221^9002313.9222"
"RTN","BPSJZPR",227,0)
 Q
"RTN","BPSJZQR")
0^363^B2252225
"RTN","BPSJZQR",1,0)
BPSJZQR ;BHAM ISC/LJF - HL7 Registration ZQR Message ;21-NOV-2003
"RTN","BPSJZQR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJZQR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJZQR",4,0)
 ;
"RTN","BPSJZQR",5,0)
 ; ZQR is pharmacy site registration info
"RTN","BPSJZQR",6,0)
 ;
"RTN","BPSJZQR",7,0)
EN(HL) N ZQR,FS,CPS,REP,BPSFILE,BPSIEN,VAIX1,VAIX2,CNF
"RTN","BPSJZQR",8,0)
 ;
"RTN","BPSJZQR",9,0)
 ; Normally: HL("FS")="|"  HL("ECH")="^~\&"
"RTN","BPSJZQR",10,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"
"RTN","BPSJZQR",11,0)
 S CPS=$E($G(HL("ECH"))) I CPS="" S CPS="^"
"RTN","BPSJZQR",12,0)
 S REP=$E($G(HL("ECH")),2) I REP="" S REP="~"
"RTN","BPSJZQR",13,0)
 ;
"RTN","BPSJZQR",14,0)
 S ZQR=FS_(+$G(HL("SITE")))
"RTN","BPSJZQR",15,0)
 ;
"RTN","BPSJZQR",16,0)
 ; Get Contact Info
"RTN","BPSJZQR",17,0)
 S BPSFILE=9002313.99,BPSIEN=$O(^BPS(BPSFILE,0))
"RTN","BPSJZQR",18,0)
 S VAIX1=$G(^BPS(BPSFILE,BPSIEN,"VITRIA")),VAIX2=$P(VAIX1,U,2)
"RTN","BPSJZQR",19,0)
 ;
"RTN","BPSJZQR",20,0)
 ; Get Version number
"RTN","BPSJZQR",21,0)
 S ZQR=ZQR_FS_$P(VAIX1,U,3)
"RTN","BPSJZQR",22,0)
 ;
"RTN","BPSJZQR",23,0)
 ; Port
"RTN","BPSJZQR",24,0)
 S ZQR=ZQR_FS_$G(HL("EPPORT"))
"RTN","BPSJZQR",25,0)
 ;
"RTN","BPSJZQR",26,0)
 ; Load the Name and Means Fields
"RTN","BPSJZQR",27,0)
 ; Contact
"RTN","BPSJZQR",28,0)
 I VAIX1 D
"RTN","BPSJZQR",29,0)
 . S CNF=$$VA200NM^BPSJUTL(+VAIX1,"",.HL) I CNF]"" S $P(ZQR,FS,5)=CNF
"RTN","BPSJZQR",30,0)
 . S CNF=$$VA20013^BPSJUTL(+VAIX1,.HL) I CNF]"" S $P(ZQR,FS,6)=CNF
"RTN","BPSJZQR",31,0)
 ;
"RTN","BPSJZQR",32,0)
 ; Alternate Contact
"RTN","BPSJZQR",33,0)
 I VAIX2 D
"RTN","BPSJZQR",34,0)
 . S CNF=$$VA200NM^BPSJUTL(VAIX2,"",.HL) I CNF]"" S $P(ZQR,FS,7)=CNF
"RTN","BPSJZQR",35,0)
 . S CNF=$$VA20013^BPSJUTL(VAIX2,.HL) I CNF]"" S $P(ZQR,FS,8)=CNF
"RTN","BPSJZQR",36,0)
 ;
"RTN","BPSJZQR",37,0)
 Q "ZQR|"_ZQR
"RTN","BPSJZRP")
0^364^B23404723
"RTN","BPSJZRP",1,0)
BPSJZRP ;BHAM ISC/LJF - HL7 Registration ZRP Message ;21-NOV-2003
"RTN","BPSJZRP",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSJZRP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSJZRP",4,0)
 ;
"RTN","BPSJZRP",5,0)
 Q
"RTN","BPSJZRP",6,0)
 ;
"RTN","BPSJZRP",7,0)
EN(HL,PHIX,TAXID,ZRP) ;
"RTN","BPSJZRP",8,0)
 ; ZRP array contains pharmacy registration info
"RTN","BPSJZRP",9,0)
 N ZRPS,FS,CPS,REP,NDZRO,NDHRS,NDREM,NDREP,NDREP1,NDADD,STATE
"RTN","BPSJZRP",10,0)
 N VAIX1,VAIX2,VAIXLP,VATLE,CNF,MSGCNT,TCH
"RTN","BPSJZRP",11,0)
 ;
"RTN","BPSJZRP",12,0)
 ; Quit if no Pharmacy index provided
"RTN","BPSJZRP",13,0)
 I '$G(PHIX) Q
"RTN","BPSJZRP",14,0)
 ;
"RTN","BPSJZRP",15,0)
 K ZRP S ZRPS=""
"RTN","BPSJZRP",16,0)
 ;
"RTN","BPSJZRP",17,0)
 ; Set HL7 Delimiters - use standard defaults if none provided
"RTN","BPSJZRP",18,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"
"RTN","BPSJZRP",19,0)
 S CPS=$E($G(HL("ECH"))) I CPS="" S CPS="^"
"RTN","BPSJZRP",20,0)
 S REP=$E($G(HL("ECH")),2) I REP="" S REP="~"
"RTN","BPSJZRP",21,0)
 ;
"RTN","BPSJZRP",22,0)
 S NDZRO=$G(^BPS(9002313.56,PHIX,0))
"RTN","BPSJZRP",23,0)
 S NDREM=$G(^BPS(9002313.56,PHIX,"REMIT"))
"RTN","BPSJZRP",24,0)
 S NDREP=$G(^BPS(9002313.56,PHIX,"REP"))
"RTN","BPSJZRP",25,0)
 S NDREP1=$G(^BPS(9002313.56,PHIX,"REP1"))
"RTN","BPSJZRP",26,0)
 S NDADD=$G(^BPS(9002313.56,PHIX,"ADDR"))
"RTN","BPSJZRP",27,0)
 ;
"RTN","BPSJZRP",28,0)
 F ZRP=1:1:16 S ZRP(ZRP)="" ;Initialize
"RTN","BPSJZRP",29,0)
 S TAXID=$P(NDZRO,U,5)      ;TAX ID
"RTN","BPSJZRP",30,0)
 S ZRP(2)=$P(NDZRO,U,2)     ;NCPDP #
"RTN","BPSJZRP",31,0)
 S ZRP(3)=$P(NDZRO,U)       ;NAME
"RTN","BPSJZRP",32,0)
 S ZRP(4)=$P(NDZRO,U,3)     ;DEFAULT DEA #
"RTN","BPSJZRP",33,0)
 ;
"RTN","BPSJZRP",34,0)
 S ZRP(5)=$$OPHOURS(PHIX)
"RTN","BPSJZRP",35,0)
 ;
"RTN","BPSJZRP",36,0)
 I $L($P(NDADD,U,8)) S $P(ZRPS,CPS,1)=$P(NDADD,U,8)  ;SITE ADDRESS NAME
"RTN","BPSJZRP",37,0)
 I $L($P(NDADD,U,1)) S $P(ZRPS,CPS,1)=$P(ZRPS,CPS,1)_" "_$P(NDADD,U,1)  ;SITE ADDRESS 1
"RTN","BPSJZRP",38,0)
 I $L($P(NDADD,U,2)) S $P(ZRPS,CPS,2)=$P(NDADD,U,2)  ;SITE ADDRESS 2
"RTN","BPSJZRP",39,0)
 I $L($P(NDADD,U,3)) S $P(ZRPS,CPS,3)=$P(NDADD,U,3)  ;CITY
"RTN","BPSJZRP",40,0)
 I $L($P(NDADD,U,4)) S STATE=$P(NDADD,U,4) I STATE D  ; State
"RTN","BPSJZRP",41,0)
 . S STATE=$P($G(^DIC(5,STATE,0)),U,2)
"RTN","BPSJZRP",42,0)
 . I STATE]"" S $P(ZRPS,CPS,4)=STATE
"RTN","BPSJZRP",43,0)
 I $L($P(NDADD,U,5)) S $P(ZRPS,CPS,5)=$P(NDADD,U,5)  ;ZIP
"RTN","BPSJZRP",44,0)
 I ZRPS]"" S ZRP(6)=ZRPS,ZRPS=""
"RTN","BPSJZRP",45,0)
 ;
"RTN","BPSJZRP",46,0)
 I $L($P(NDREM,U,1)) S $P(ZRPS,CPS,1)=$P(NDREM,U,1)   ;REMITTANCE ADDRESS NAME
"RTN","BPSJZRP",47,0)
 I $L($P(NDREM,U,2)) S $P(ZRPS,CPS,1)=$P(ZRPS,CPS,1)_" "_$P(NDREM,U,2)  ;REMIT ADDRESS LINE 1
"RTN","BPSJZRP",48,0)
 I $L($P(NDREM,U,3)) S $P(ZRPS,CPS,2)=$P(NDREM,U,3)   ;REMIT ADDRESS LINE 2
"RTN","BPSJZRP",49,0)
 I $L($P(NDREM,U,6)) S $P(ZRPS,CPS,3)=$P(NDREM,U,6)   ;CITY
"RTN","BPSJZRP",50,0)
 I $L($P(NDREM,U,7)) S STATE=$P(NDREM,U,7) I STATE D  ;State
"RTN","BPSJZRP",51,0)
 . S STATE=$P($G(^DIC(5,STATE,0)),U,2)
"RTN","BPSJZRP",52,0)
 . I STATE]"" S $P(ZRPS,CPS,4)=STATE
"RTN","BPSJZRP",53,0)
 I $L($P(NDREM,U,8)) S $P(ZRPS,CPS,5)=$P(NDREM,U,8)  ;ZIP
"RTN","BPSJZRP",54,0)
 I ZRPS]"" S ZRP(7)=ZRPS,ZRPS=""
"RTN","BPSJZRP",55,0)
 ;
"RTN","BPSJZRP",56,0)
 ; Load the Name and Means Fields
"RTN","BPSJZRP",57,0)
 S VAIX1=$P(NDREP,U,3)
"RTN","BPSJZRP",58,0)
 S VAIX2=$P(NDREP,U,4)
"RTN","BPSJZRP",59,0)
 S VAIXLP=$P(NDREP,U,5)
"RTN","BPSJZRP",60,0)
 ;
"RTN","BPSJZRP",61,0)
 ; Contact
"RTN","BPSJZRP",62,0)
 I $G(VAIX1) S VATLE="" D
"RTN","BPSJZRP",63,0)
 . S CNF=$$VA200NM^BPSJUTL(VAIX1,.VATLE,.HL) I CNF]"" S ZRP(8)=CNF
"RTN","BPSJZRP",64,0)
 . I VATLE]"" S ZRP(9)=VATLE
"RTN","BPSJZRP",65,0)
 . S CNF=$$VA20013^BPSJUTL(VAIX1,.HL) I CNF]"" S ZRP(10)=CNF
"RTN","BPSJZRP",66,0)
 ;
"RTN","BPSJZRP",67,0)
 ; Alternate Contact
"RTN","BPSJZRP",68,0)
 I $G(VAIX2) S VATLE="" D
"RTN","BPSJZRP",69,0)
 . S CNF=$$VA200NM^BPSJUTL(VAIX2,.VATLE,.HL) I CNF]"" S ZRP(11)=CNF
"RTN","BPSJZRP",70,0)
 . I VATLE]"" S ZRP(12)=VATLE
"RTN","BPSJZRP",71,0)
 . S CNF=$$VA20013^BPSJUTL(VAIX2,.HL) I CNF]"" S ZRP(13)=CNF
"RTN","BPSJZRP",72,0)
 ;
"RTN","BPSJZRP",73,0)
 ; Lead Pharmacist
"RTN","BPSJZRP",74,0)
 I $G(VAIXLP) S VATLE="" D
"RTN","BPSJZRP",75,0)
 . S CNF=$$VA200NM^BPSJUTL(VAIXLP,.VATLE,.HL) I CNF]"" S ZRP(14)=CNF
"RTN","BPSJZRP",76,0)
 . I VATLE]"" S ZRP(15)=VATLE
"RTN","BPSJZRP",77,0)
 ;
"RTN","BPSJZRP",78,0)
 ; Pharmacist's License
"RTN","BPSJZRP",79,0)
 I $L($P(NDREP1,U)) S ZRP(16)=$P(NDREP1,U)
"RTN","BPSJZRP",80,0)
 ;
"RTN","BPSJZRP",81,0)
 ; Encode special chars. Add Field separators.
"RTN","BPSJZRP",82,0)
 S TCH("\")="\E\",TCH("&")="\T\",TCH("|")="\F\"
"RTN","BPSJZRP",83,0)
 S (ZRPS(5),ZRPS(10),ZRPS(13))=1  ;Fields with HL7 repetion chars
"RTN","BPSJZRP",84,0)
 F ZRP=16:-1:1 D  S ZRP(ZRP)=$$ENCODE^BPSJUTL(ZRP(ZRP),.TCH)_FS
"RTN","BPSJZRP",85,0)
 . I $G(ZRPS(ZRP)) K TCH("~")  ; don't convert repetion chars
"RTN","BPSJZRP",86,0)
 . E  S TCH("~")="\R\"         ; ok to convert repetion chars
"RTN","BPSJZRP",87,0)
 S ZRP="ZRP|"
"RTN","BPSJZRP",88,0)
 ;
"RTN","BPSJZRP",89,0)
 Q
"RTN","BPSJZRP",90,0)
 ;
"RTN","BPSJZRP",91,0)
OPHOURS(PHINDEX) ; Operational Hours
"RTN","BPSJZRP",92,0)
 N DAY,DIX,OPH,RETURN,WEEK,OPDAY,OPHOUR
"RTN","BPSJZRP",93,0)
 N CLH
"RTN","BPSJZRP",94,0)
 ;
"RTN","BPSJZRP",95,0)
 S PHINDEX=+$G(PHINDEX),RETURN=""
"RTN","BPSJZRP",96,0)
 S WEEK="SUN^MON^TUE^WED^THU^FRI^SAT^"
"RTN","BPSJZRP",97,0)
 S OPH=$G(^BPS(9002313.56,PHINDEX,"TOPEN"))
"RTN","BPSJZRP",98,0)
 S CLH=$G(^BPS(9002313.56,PHINDEX,"TCLOSE"))
"RTN","BPSJZRP",99,0)
 I $G(CPS)="" S CPS=$E($G(HL("ECH"))) I CPS="" S CPS="^"
"RTN","BPSJZRP",100,0)
 I $G(REP)="" S REP=$E($G(HL("ECH")),2) I REP="" S REP="~"
"RTN","BPSJZRP",101,0)
 I OPH]"" F DAY=1:1:7 I $P(OPH,U,DAY)]"" D
"RTN","BPSJZRP",102,0)
 . I RETURN]"" S RETURN=RETURN_REP
"RTN","BPSJZRP",103,0)
 . S RETURN=RETURN_$P(WEEK,U,DAY)_CPS_$P(WEEK,U,DAY)_CPS
"RTN","BPSJZRP",104,0)
 . S OPHOUR=$$HOURS($P(OPH,U,DAY)) I OPHOUR<0 S OPHOUR="0000"
"RTN","BPSJZRP",105,0)
 . S RETURN=RETURN_OPHOUR_CPS
"RTN","BPSJZRP",106,0)
 . S OPHOUR=$$HOURS($P(CLH,U,DAY)) I OPHOUR<0 S OPHOUR="2359"
"RTN","BPSJZRP",107,0)
 . S RETURN=RETURN_OPHOUR
"RTN","BPSJZRP",108,0)
 I RETURN]"" Q RETURN
"RTN","BPSJZRP",109,0)
 ;
"RTN","BPSJZRP",110,0)
 S WEEK=U_WEEK
"RTN","BPSJZRP",111,0)
 S OPH=$G(^BPS(9002313.56,PHINDEX,"HOURS"))
"RTN","BPSJZRP",112,0)
 S OPDAY=$E($P(OPH,U,2),1,3)
"RTN","BPSJZRP",113,0)
 ;-if start day unrecognizable force to SUN
"RTN","BPSJZRP",114,0)
 I WEEK[(U_OPDAY_U) S RETURN=OPDAY_CPS
"RTN","BPSJZRP",115,0)
 E  S RETURN="SUN"_CPS
"RTN","BPSJZRP",116,0)
 S OPDAY=$E($P(OPH,U,3),1,3)
"RTN","BPSJZRP",117,0)
 ;-if end day unrecognizable force to SAT
"RTN","BPSJZRP",118,0)
 I WEEK[(U_OPDAY_U) S RETURN=RETURN_OPDAY_CPS
"RTN","BPSJZRP",119,0)
 E  S RETURN=RETURN_"SAT"_CPS
"RTN","BPSJZRP",120,0)
 ;-if start time unrecognizable force to 0000
"RTN","BPSJZRP",121,0)
 S OPHOUR=$$HOURS($E($P(OPH,U,4),1,4)) I OPHOUR<0 S OPHOUR="0000"
"RTN","BPSJZRP",122,0)
 ;-if end time unrecognizable force to 2359
"RTN","BPSJZRP",123,0)
 S OPDAY=$$HOURS($E($P(OPH,U,5),1,4)) I OPDAY<0 S OPDAY="2359"
"RTN","BPSJZRP",124,0)
 ;-if end time is less than start time force 0000 to 2359
"RTN","BPSJZRP",125,0)
 I OPDAY>OPHOUR S RETURN=RETURN_OPHOUR_CPS_OPDAY
"RTN","BPSJZRP",126,0)
 E  S RETURN=RETURN_"0000"_CPS_"2359"
"RTN","BPSJZRP",127,0)
 Q RETURN
"RTN","BPSJZRP",128,0)
 ;
"RTN","BPSJZRP",129,0)
HOURS(MIN) ; Validate time 0000 - 2359
"RTN","BPSJZRP",130,0)
 N HRS
"RTN","BPSJZRP",131,0)
 S HRS=$E(MIN,1,2),$E(MIN,1,2)=""
"RTN","BPSJZRP",132,0)
 I $L(HRS)=2,HRS>-1,HRS<24,$L(MIN)=2,MIN>-1,MIN<60 Q HRS_MIN
"RTN","BPSJZRP",133,0)
 Q -1
"RTN","BPSMHDR")
0^296^B8404043
"RTN","BPSMHDR",1,0)
BPSMHDR ;BHAM ISC/FCS/DRS - MENUS HEADERS ;06/01/2004 
"RTN","BPSMHDR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSMHDR",3,0)
 ;
"RTN","BPSMHDR",4,0)
 ;****** Send this routine with each new patch with **n** in piece
"RTN","BPSMHDR",5,0)
 ;****** 3 so the patch level can be displayed as part of the
"RTN","BPSMHDR",6,0)
 ;****** menu header.
"RTN","BPSMHDR",7,0)
 ;
"RTN","BPSMHDR",8,0)
 ; BPSQUIT,BPSRVON,BPSRVOF,BPSTOP,BPSVER,BPSPNM, and BPSSITE returned to calling routine
"RTN","BPSMHDR",9,0)
INIT ;EP -
"RTN","BPSMHDR",10,0)
 N BPSY,X
"RTN","BPSMHDR",11,0)
 I $G(XQY0)'="",$G(BPSTOP)="" S BPSTOP=XQY0
"RTN","BPSMHDR",12,0)
 S BPSY="",BPSY=$O(^DIC(9.4,"C","BPS",BPSY))
"RTN","BPSMHDR",13,0)
 S BPSVER=^DIC(9.4,BPSY,"VERSION"),BPSVER="V"_BPSVER K BPSY
"RTN","BPSMHDR",14,0)
 S X=$T(+2),X=$P(X,";;",2),X=$P(X,";",3),X=$P(X,"**",2),X=$P(X,",",$L(X,","))
"RTN","BPSMHDR",15,0)
 S:X]"" BPSVER=BPSVER
"RTN","BPSMHDR",16,0)
 S BPSPNM="Electronic Claims Management Engine (ECME)"
"RTN","BPSMHDR",17,0)
 I '$D(DUZ(2)) W !!,"Your SITE NAME is not set for the KERNEL.",!,"Please contact your System Support person.",!! S BPSQUIT=1 Q
"RTN","BPSMHDR",18,0)
 I '$D(DUZ(0)) W !!,"You do not have the DUZ(0) variable.",!,"Please contact your System Support person.",!! S BPSQUIT=1 Q
"RTN","BPSMHDR",19,0)
 I '$D(^XUSEC("BPSMENU",DUZ)) W !!,"You do not have the appropriate keys.",!,"Please contact your System Support person.",!! S BPSQUIT=1 Q
"RTN","BPSMHDR",20,0)
 S BPSSITE=$P(^DIC(4,DUZ(2),0),"^")
"RTN","BPSMHDR",21,0)
 I '$D(IORVON) S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","BPSMHDR",22,0)
 I $G(IO) S Y=$O(^%ZIS(1,"C",IO,0)) I Y S Y=$P($G(^%ZIS(1,Y,"SUBTYPE")),U) I Y S X=$G(^%ZIS(2,Y,5)),BPSRVON=$P(X,U,4),BPSRVOF=$P(X,U,5)
"RTN","BPSMHDR",23,0)
 I $G(BPSRVON)="" S BPSRVON="""""",BPSRVOF=""""""
"RTN","BPSMHDR",24,0)
 Q
"RTN","BPSMHDR",25,0)
 ;
"RTN","BPSMHDR",26,0)
HDR ;EP - Screen header.
"RTN","BPSMHDR",27,0)
 I $D(XQSAV),XQY0'=XQSAV Q
"RTN","BPSMHDR",28,0)
 Q:$G(XQY0)=""
"RTN","BPSMHDR",29,0)
 I $G(BPSTOP)="" D INIT Q:$G(BPSQUIT)
"RTN","BPSMHDR",30,0)
 I '$D(IORVON) S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","BPSMHDR",31,0)
 S X=$P(XQY0,U,2),BPSMT=$S($P(XQY0,U)="BPSMENU":"Main Menu",1:X)
"RTN","BPSMHDR",32,0)
 S BPSPNV=BPSPNM_" "_BPSVER
"RTN","BPSMHDR",33,0)
 NEW A,D,F,I,L,N,R,V
"RTN","BPSMHDR",34,0)
 S F=0
"RTN","BPSMHDR",35,0)
 W !
"RTN","BPSMHDR",36,0)
 S A=$X W IORVON,IORVOFF S D=$X S:D>A F=D-A ;compute length of revvideo
"RTN","BPSMHDR",37,0)
 S L=(80-$L(BPSPNV))\2-1,R=L+$L(BPSPNV)+1
"RTN","BPSMHDR",38,0)
 S D=$L(BPSPNV)+2,N=$L(BPSPNV)-1
"RTN","BPSMHDR",39,0)
 W @IOF,!,$$CTR($$REPEAT^XLFSTR("*",D)),!
"RTN","BPSMHDR",40,0)
 W ?L,"*",$$CTR(BPSPNV,N),?R,"*",!
"RTN","BPSMHDR",41,0)
 W ?L,"*",$$CTR($$LOC(),N),?R,"*",!
"RTN","BPSMHDR",42,0)
 W ?L,"*",?(L+(((R-L)-$L(BPSMT))\2)),IORVON,BPSMT,IORVOFF,?R+F,"*",!
"RTN","BPSMHDR",43,0)
 W $$CTR($$REPEAT^XLFSTR("*",D)),!
"RTN","BPSMHDR",44,0)
 K BPSMT,BPSPNV,BPSTOP,BPSPNM,BPSVER
"RTN","BPSMHDR",45,0)
 Q
"RTN","BPSMHDR",46,0)
 ;
"RTN","BPSMHDR",47,0)
 ;----------
"RTN","BPSMHDR",48,0)
CTR(X,Y) ;EP - Center X in a field Y wide.
"RTN","BPSMHDR",49,0)
 Q $J("",$S($D(Y):Y,1:IOM)-$L(X)\2)_X
"RTN","BPSMHDR",50,0)
 ;----------
"RTN","BPSMHDR",51,0)
LJRF(X,Y,Z) ;EP - left justify X in a field Y wide, right filling with Z.
"RTN","BPSMHDR",52,0)
 NEW L,M
"RTN","BPSMHDR",53,0)
 I $L(X)'<Y Q $E(X,1,Y-1)_Z
"RTN","BPSMHDR",54,0)
 S L=Y-$L(X)
"RTN","BPSMHDR",55,0)
 S $P(M,Z,L)=Z
"RTN","BPSMHDR",56,0)
 Q X_M
"RTN","BPSMHDR",57,0)
 ;----------
"RTN","BPSMHDR",58,0)
USR() ;EP - Return name of current user from ^VA(200.
"RTN","BPSMHDR",59,0)
 N RTN
"RTN","BPSMHDR",60,0)
 S RTN=$$GET1^DIQ(200,DUZ,.01)
"RTN","BPSMHDR",61,0)
 I RTN="" S RTN="DUZ UNDEFINED OR 0"
"RTN","BPSMHDR",62,0)
 Q RTN
"RTN","BPSMHDR",63,0)
 ;----------
"RTN","BPSMHDR",64,0)
LOC() ;EP - Return location name from file 4 based on DUZ(2).
"RTN","BPSMHDR",65,0)
 Q $S($G(DUZ(2)):$S($D(^DIC(4,DUZ(2),0)):$P(^(0),U),1:"UNKNOWN"),1:"DUZ(2) UNDEFINED OR 0")
"RTN","BPSNCPD1")
0^58^B29379701
"RTN","BPSNCPD1",1,0)
BPSNCPD1 ;BHAM ISC/LJE - Pharmacy API part 2 ;06/16/2004
"RTN","BPSNCPD1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSNCPD1",3,0)
 ;External reference to file #50.68 supported by DBIA 3735
"RTN","BPSNCPD1",4,0)
 ;
"RTN","BPSNCPD1",5,0)
 ; STARRAY - Retrieve information for API call to IB and store in ARRAY
"RTN","BPSNCPD1",6,0)
 ; Incoming Parameters
"RTN","BPSNCPD1",7,0)
 ;    BRXIEN - Prescription IEN
"RTN","BPSNCPD1",8,0)
 ;    BFILL  - Fill Number
"RTN","BPSNCPD1",9,0)
 ;    BWHERE - RX action
"RTN","BPSNCPD1",10,0)
 ;    ARRAY  - Array that is built (passed by reference)
"RTN","BPSNCPD1",11,0)
STARRAY(BRXIEN,BFILL,BWHERE,ARRAY) ;
"RTN","BPSNCPD1",12,0)
 N RXINFO,DRUGIEN,DRUGINFO,CMOP,EIS
"RTN","BPSNCPD1",13,0)
 S ARRAY("DFN")=DFN
"RTN","BPSNCPD1",14,0)
 S ARRAY("DRUG")=$G(PSODRUG("NAME"))
"RTN","BPSNCPD1",15,0)
 I ARRAY("DRUG")="" S ARRAY("DRUG")=$P(^PSRX(BRXIEN,0),"^",6)
"RTN","BPSNCPD1",16,0)
 S ARRAY("DAYS SUPPLY")=$G(PSOX("DAYS SUPPLY"))
"RTN","BPSNCPD1",17,0)
 I ARRAY("DAYS SUPPLY")="" S ARRAY("DAYS SUPPLY")=$P(^PSRX(BRXIEN,0),"^",8)
"RTN","BPSNCPD1",18,0)
 S ARRAY("IEN")=BRXIEN
"RTN","BPSNCPD1",19,0)
 S ARRAY("FILL NUMBER")=BFILL
"RTN","BPSNCPD1",20,0)
 S ARRAY("NDC")=BILLNDC
"RTN","BPSNCPD1",21,0)
 S RXINFO=^PSRX(BRXIEN,0)
"RTN","BPSNCPD1",22,0)
 S DRUGIEN=$P(RXINFO,"^",6),DRUGINFO=^PSDRUG(DRUGIEN,0)
"RTN","BPSNCPD1",23,0)
 S CMOP=0 S CMOP=$P($G(^PSDRUG(DRUGIEN,3)),"^") S:CMOP="" CMOP=0
"RTN","BPSNCPD1",24,0)
 S ARRAY("DEA")=$P(DRUGINFO,U,3)
"RTN","BPSNCPD1",25,0)
 S ARRAY("COST")=$P($G(^PSDRUG(DRUGIEN,660)),U,6)
"RTN","BPSNCPD1",26,0)
 S ARRAY("QTY")=$P(RXINFO,U,7)
"RTN","BPSNCPD1",27,0)
 S ARRAY("FILL DATE")=BFILLDAT
"RTN","BPSNCPD1",28,0)
 S ARRAY("DIVISION")=$$MCDIV^BPSBUTL(BRXIEN,BFILL)
"RTN","BPSNCPD1",29,0)
 S ARRAY("RELEASE DATE")=$P($S(BFILL=0:$P(^PSRX(BRXIEN,2),"^",13),1:$P(^PSRX(BRXIEN,1,BFILL,0),"^",18)),".")
"RTN","BPSNCPD1",30,0)
 S ARRAY("AO")="",ARRAY("EC")="",ARRAY("HNC")="",ARRAY("IR")="",ARRAY("MST")="",ARRAY("SC")="",ARRAY("CV")=""
"RTN","BPSNCPD1",31,0)
 ;
"RTN","BPSNCPD1",32,0)
 ; New way of getting SC/EI (CIDC)
"RTN","BPSNCPD1",33,0)
 S EIS=$G(^PSRX(BRXIEN,"ICD",1,0))
"RTN","BPSNCPD1",34,0)
 I $G(EIS)]"" D
"RTN","BPSNCPD1",35,0)
 . S ARRAY("AO")=$P(EIS,U,2)
"RTN","BPSNCPD1",36,0)
 . S ARRAY("EC")=$P(EIS,U,5)
"RTN","BPSNCPD1",37,0)
 . S ARRAY("HNC")=$P(EIS,U,7)
"RTN","BPSNCPD1",38,0)
 . S ARRAY("CV")=$P(EIS,U,8)
"RTN","BPSNCPD1",39,0)
 . S ARRAY("IR")=$P(EIS,U,3)
"RTN","BPSNCPD1",40,0)
 . S ARRAY("SC")=$P(EIS,U,4)
"RTN","BPSNCPD1",41,0)
 . S ARRAY("MST")=$P(EIS,U,6)
"RTN","BPSNCPD1",42,0)
 ; If not available, pull from IBQ node (old way)
"RTN","BPSNCPD1",43,0)
 E  S EIS=$G(^PSRX(BRXIEN,"IBQ")) I EIS'="" D
"RTN","BPSNCPD1",44,0)
 . S ARRAY("AO")=$P(EIS,U,3)
"RTN","BPSNCPD1",45,0)
 . S ARRAY("EC")=$P(EIS,U,5)
"RTN","BPSNCPD1",46,0)
 . S ARRAY("HNC")=$P(EIS,U,6)
"RTN","BPSNCPD1",47,0)
 . S ARRAY("CV")=$P(EIS,U,7)
"RTN","BPSNCPD1",48,0)
 . S ARRAY("IR")=$P(EIS,U,4)
"RTN","BPSNCPD1",49,0)
 . S ARRAY("SC")=$P(EIS,U,1)
"RTN","BPSNCPD1",50,0)
 . S ARRAY("MST")=$P(EIS,U,2)
"RTN","BPSNCPD1",51,0)
 ;
"RTN","BPSNCPD1",52,0)
 ; Add user so that it is stored correctly in the IB Event Log
"RTN","BPSNCPD1",53,0)
 ;  Note: Auto-Reversals (AREV) and CMOP/OPAI (CR*/PC/RL) use postmaster (.5)
"RTN","BPSNCPD1",54,0)
 I ",AREV,CRLB,CRLX,CRLR,PC,RL,"[(","_BWHERE_",") S ARRAY("USER")=.5
"RTN","BPSNCPD1",55,0)
 E  S ARRAY("USER")=DUZ
"RTN","BPSNCPD1",56,0)
 Q
"RTN","BPSNCPD1",57,0)
 ;
"RTN","BPSNCPD1",58,0)
 ; Called by BPSNCPDP to display progress of claim
"RTN","BPSNCPD1",59,0)
STATUS(BRXIEN,BFILL,REBILL,REVONLY,BPSTART,BWHERE) ;
"RTN","BPSNCPD1",60,0)
 ; Initialization
"RTN","BPSNCPD1",61,0)
 N TRANSIEN,CERTUSER,BPSTO,END,IBSEQ,BPQ
"RTN","BPSNCPD1",62,0)
 N CLMSTAT,OCLMSTAT,RESUB,RESFL
"RTN","BPSNCPD1",63,0)
 S (CLMSTAT,OCLMSTAT)=0
"RTN","BPSNCPD1",64,0)
 ;
"RTN","BPSNCPD1",65,0)
 ; Set CERTUSER to true if this user is the certifier
"RTN","BPSNCPD1",66,0)
 S CERTUSER=^BPS(9002313.99,1,"CERTIFIER")=DUZ
"RTN","BPSNCPD1",67,0)
 ;
"RTN","BPSNCPD1",68,0)
 ; Build Transaction IEN
"RTN","BPSNCPD1",69,0)
 S TRANSIEN=BRXIEN_"."_$E($TR($J("",4-$L(BFILL))," ","0")_BFILL,1,4)_1
"RTN","BPSNCPD1",70,0)
 ;
"RTN","BPSNCPD1",71,0)
 ; Write Rebill and Status Messages
"RTN","BPSNCPD1",72,0)
 W !!,"Claim Status: "
"RTN","BPSNCPD1",73,0)
 I REBILL W !,"Reversing and Rebilling a previously submitted claim...",!,"Reversing..."
"RTN","BPSNCPD1",74,0)
 ;
"RTN","BPSNCPD1",75,0)
 ; Get the ECME Timeout and set the display timeout
"RTN","BPSNCPD1",76,0)
 S BPSTO=$$GET1^DIQ(9002313.99,"1,",3.01),END=$S(CERTUSER:50,$G(BPSTO)]"":BPSTO,1:5)
"RTN","BPSNCPD1",77,0)
 ;
"RTN","BPSNCPD1",78,0)
 ; For remaining time, loop through and display status
"RTN","BPSNCPD1",79,0)
 S (BPQ,RESFL)=0
"RTN","BPSNCPD1",80,0)
 F IBSEQ=1:1:END D  Q:BPQ=1
"RTN","BPSNCPD1",81,0)
 . H 1
"RTN","BPSNCPD1",82,0)
 . ;
"RTN","BPSNCPD1",83,0)
 . ; Get status of resubmit, last update, and claim status
"RTN","BPSNCPD1",84,0)
 . S CLMSTAT=$$STATUS^BPSOSRX(BRXIEN,BFILL,1)
"RTN","BPSNCPD1",85,0)
 . S RESUB=$$GET1^DIQ(9002313.59,TRANSIEN_",",1.12,"I")
"RTN","BPSNCPD1",86,0)
 . ;
"RTN","BPSNCPD1",87,0)
 . ; Format status message
"RTN","BPSNCPD1",88,0)
 . S CLMSTAT=$P(CLMSTAT,"^",1)_$S($P(CLMSTAT,"^",1)["IN PROGRESS":"-"_$P(CLMSTAT,"^",3),1:"")
"RTN","BPSNCPD1",89,0)
 . ;
"RTN","BPSNCPD1",90,0)
 . ; If we are starting the resubmit, display message
"RTN","BPSNCPD1",91,0)
 . I REBILL,RESFL=0,RESUB=1,CLMSTAT["Resubmitting" W !,"Resubmitting..." S RESFL=1 Q
"RTN","BPSNCPD1",92,0)
 . I REBILL,RESFL=0,RESUB=2,CLMSTAT["IN PROGRESS" W !,"Resubmitting..." S RESFL=1
"RTN","BPSNCPD1",93,0)
 . ;
"RTN","BPSNCPD1",94,0)
 . ; If the status has changed, display the new message
"RTN","BPSNCPD1",95,0)
 . I OCLMSTAT'=CLMSTAT W !,CLMSTAT S OCLMSTAT=CLMSTAT
"RTN","BPSNCPD1",96,0)
 . ;
"RTN","BPSNCPD1",97,0)
 . ; If the status is not IN PROGRESS, then we are done
"RTN","BPSNCPD1",98,0)
 . I CLMSTAT'["IN PROGRESS" S BPQ=1
"RTN","BPSNCPD1",99,0)
 W !
"RTN","BPSNCPD1",100,0)
 ;
"RTN","BPSNCPD1",101,0)
 ; Log messages to developer log
"RTN","BPSNCPD1",102,0)
 D LOG^BPSNCPDP($T(+0)_" - After Status Loop")
"RTN","BPSNCPD1",103,0)
 Q
"RTN","BPSNCPD1",104,0)
 ;
"RTN","BPSNCPD1",105,0)
 ; Bulletin to the OPECC
"RTN","BPSNCPD1",106,0)
BULL(RXI,RXR,SITE,DFN,PATNAME) ;
"RTN","BPSNCPD1",107,0)
 N BTXT,XMSUB,XMY,XMTEXT,XMDUZ
"RTN","BPSNCPD1",108,0)
 N SSN,X,SITENM
"RTN","BPSNCPD1",109,0)
 I $G(SITE) S SITENM=$P($G(^PS(59,SITE,0)),U)
"RTN","BPSNCPD1",110,0)
 I $G(DFN) D
"RTN","BPSNCPD1",111,0)
 . S X=$P($G(^DPT(DFN,0)),U,9)
"RTN","BPSNCPD1",112,0)
 . S SSN=$E(X,$L(X)-3,$L(X))
"RTN","BPSNCPD1",113,0)
 ;
"RTN","BPSNCPD1",114,0)
 ; Need to do in the background
"RTN","BPSNCPD1",115,0)
 ;   Mailman calls CMOP which calls EN^BPSNCPDP.
"RTN","BPSNCPD1",116,0)
 ;   If BPSNCPDP* (same process) then calls mailman, it gets confused.
"RTN","BPSNCPD1",117,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC
"RTN","BPSNCPD1",118,0)
 N %,%H,%I,X
"RTN","BPSNCPD1",119,0)
 D NOW^%DTC
"RTN","BPSNCPD1",120,0)
 S ZTIO="",ZTDTH=%,ZTDESC="IN PROGRESS BULLETIN"
"RTN","BPSNCPD1",121,0)
 S ZTSAVE("RXR")="",ZTSAVE("RXI")=""
"RTN","BPSNCPD1",122,0)
 S ZTSAVE("SITENM")="",ZTSAVE("PATNAME")=""
"RTN","BPSNCPD1",123,0)
 S ZTSAVE("SSN")=""
"RTN","BPSNCPD1",124,0)
 S ZTRTN="BULL1^BPSNCPD1"
"RTN","BPSNCPD1",125,0)
 D ^%ZTLOAD
"RTN","BPSNCPD1",126,0)
 Q
"RTN","BPSNCPD1",127,0)
 ;
"RTN","BPSNCPD1",128,0)
BULL1 ;
"RTN","BPSNCPD1",129,0)
 S XMSUB="RX not processed for site "_$G(SITENM)
"RTN","BPSNCPD1",130,0)
 S BTXT(1)="Prescription "_$P(^PSRX(RXI,0),"^",1)_" and fill number "_+RXR_" could "
"RTN","BPSNCPD1",131,0)
 S BTXT(1)=BTXT(1)_"not be processed because the "
"RTN","BPSNCPD1",132,0)
 S BTXT(2)="previous request was in progress.  There may have been a delay in processing "
"RTN","BPSNCPD1",133,0)
 S BTXT(3)="of the previous claim or the previous claim may be stranded."
"RTN","BPSNCPD1",134,0)
 S BTXT(4)=""
"RTN","BPSNCPD1",135,0)
 S BTXT(5)="For more information on this prescription's activity, please view the "
"RTN","BPSNCPD1",136,0)
 S BTXT(6)="ECME log within the View Prescription (VP) option on the Further Research (FR) "
"RTN","BPSNCPD1",137,0)
 S BTXT(7)="menu of the ECME user screen."
"RTN","BPSNCPD1",138,0)
 S BTXT(8)=""
"RTN","BPSNCPD1",139,0)
 S BTXT(9)="Patient Name: "_$G(PATNAME)
"RTN","BPSNCPD1",140,0)
 S BTXT(10)="Last four digits of SSN: "_$G(SSN)
"RTN","BPSNCPD1",141,0)
 S BTXT(11)=""
"RTN","BPSNCPD1",142,0)
 ;
"RTN","BPSNCPD1",143,0)
 S XMDUZ="BPS PACKAGE",XMTEXT="BTXT("
"RTN","BPSNCPD1",144,0)
 S XMY("G.BPS OPECC")=""
"RTN","BPSNCPD1",145,0)
 I $G(DUZ)'<1 S XMY(DUZ)=""
"RTN","BPSNCPD1",146,0)
 D ^XMD
"RTN","BPSNCPD1",147,0)
 Q
"RTN","BPSNCPD2")
0^59^B26007614
"RTN","BPSNCPD2",1,0)
BPSNCPD2 ;BHAM ISC/LJE - Continuation of BPSNCPDP CLAIMS SUBMISSION ANALYSIS ;08/01/03
"RTN","BPSNCPD2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSNCPD2",3,0)
 ;External reference $$RX^IBNCPDP supported by DBIA 4299
"RTN","BPSNCPD2",4,0)
 ;
"RTN","BPSNCPD2",5,0)
 ; EN - Call IB Billing Determination.  If good to go, update MOREDATA array
"RTN","BPSNCPD2",6,0)
 ; Notes about variables
"RTN","BPSNCPD2",7,0)
 ;   ARRAY    - Created by STARRAY^BPSNCPD1 and used for IB Determination 
"RTN","BPSNCPD2",8,0)
 ;   MOREDATA - Initialized by BPSNCPDP and more data is added here
"RTN","BPSNCPD2",9,0)
 ;   IB       - Returned to BPSNCPDP
"RTN","BPSNCPD2",10,0)
 ;   All three of these variables are newed in BPSNCPDP
"RTN","BPSNCPD2",11,0)
EN ;
"RTN","BPSNCPD2",12,0)
 I ^BPS(9002313.99,1,"CERTIFIER")'=DUZ D  I IB=2 Q
"RTN","BPSNCPD2",13,0)
 . ;For NCPDP IB call to see if we need to 3rd Party Bill and if so, get insurance/payer sheet info
"RTN","BPSNCPD2",14,0)
 . S MOREDATA("BILL")=$$RX^IBNCPDP(DFN,.ARRAY)  ;IB CALL
"RTN","BPSNCPD2",15,0)
 . Q:'$D(MOREDATA("BILL"))
"RTN","BPSNCPD2",16,0)
 . ; If calling program is the ECME user screen and we can't bill because of NEEDS SC DETERMINATION,
"RTN","BPSNCPD2",17,0)
 . ;   then prompt the user to see if they want to bill 
"RTN","BPSNCPD2",18,0)
 . I BWHERE="ERES",$P(MOREDATA("BILL"),"^",1)=0,$P(MOREDATA("BILL"),"^",2)="NEEDS SC DETERMINATION" D
"RTN","BPSNCPD2",19,0)
 .. N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,I
"RTN","BPSNCPD2",20,0)
 .. W !!,"The prescription is potentially SC-related and needs SC determination."
"RTN","BPSNCPD2",21,0)
 .. W !,"Prescriptions related to SC cannot be billed to Third Party Insurance.",!
"RTN","BPSNCPD2",22,0)
 .. S DIR(0)="Y",DIR("A")="Are you sure you want to bill this prescription"
"RTN","BPSNCPD2",23,0)
 .. S DIR("B")="NO"
"RTN","BPSNCPD2",24,0)
 .. S DIR("?")="If you want to bill this prescription, enter 'Yes' - otherwise, enter 'No'"
"RTN","BPSNCPD2",25,0)
 .. W ! D ^DIR K DIR
"RTN","BPSNCPD2",26,0)
 .. I '+Y Q
"RTN","BPSNCPD2",27,0)
 .. F I="AO","SC","MST","EC","IR","HNC","CV" I $D(ARRAY(I))=1 S ARRAY(I)=+$G(ARRAY(I))
"RTN","BPSNCPD2",28,0)
 .. S MOREDATA("BILL")=$$RX^IBNCPDP(DFN,.ARRAY)  ;Call IB again
"RTN","BPSNCPD2",29,0)
 . Q:'$D(MOREDATA("BILL"))
"RTN","BPSNCPD2",30,0)
 . I $P(MOREDATA("BILL"),"^",1)=0 S IB=2 Q  ;ib says not to bill
"RTN","BPSNCPD2",31,0)
 . S IB=1
"RTN","BPSNCPD2",32,0)
 . M MOREDATA("IBDATA")=ARRAY("INS")
"RTN","BPSNCPD2",33,0)
 . N IBSEQ
"RTN","BPSNCPD2",34,0)
 . S IBSEQ=""
"RTN","BPSNCPD2",35,0)
 . F  S IBSEQ=$O(MOREDATA("IBDATA",IBSEQ)) Q:IBSEQ=""  D
"RTN","BPSNCPD2",36,0)
 . . S $P(MOREDATA("IBDATA",IBSEQ,2),"^",7)=ARRAY("QTY")
"RTN","BPSNCPD2",37,0)
 . . S $P(MOREDATA("IBDATA",IBSEQ,2),"^",8)=ARRAY("COST")
"RTN","BPSNCPD2",38,0)
 . . S $P(MOREDATA("IBDATA",IBSEQ,2),"^",9)=ARRAY("NDC")
"RTN","BPSNCPD2",39,0)
 . . S $P(MOREDATA("IBDATA",IBSEQ,2),"^",10)=BFILL
"RTN","BPSNCPD2",40,0)
 ;
"RTN","BPSNCPD2",41,0)
 ; -- The following is for certification testing only
"RTN","BPSNCPD2",42,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ,'IB D
"RTN","BPSNCPD2",43,0)
 . N NODE,FLD,NFLD
"RTN","BPSNCPD2",44,0)
 . S MOREDATA("BILL")=1
"RTN","BPSNCPD2",45,0)
 . S MOREDATA("IBDATA",1,1)="",MOREDATA("IBDATA",1,2)=""
"RTN","BPSNCPD2",46,0)
 . S $P(MOREDATA("IBDATA",1,1),"^",1)=1  ;PLAN IEN
"RTN","BPSNCPD2",47,0)
 . S $P(MOREDATA("IBDATA",1,1),"^",4)=PAYERSH  ;PAYER SHEET
"RTN","BPSNCPD2",48,0)
 . S $P(MOREDATA("IBDATA",1,1),"^",10)="01"  ;HOME STATE PLAN
"RTN","BPSNCPD2",49,0)
 . S $P(MOREDATA("IBDATA",1,2),"^",5)=0  ;ADMIN FEE
"RTN","BPSNCPD2",50,0)
 . S $P(MOREDATA("IBDATA",1,1),"^",14)=CERTIFY
"RTN","BPSNCPD2",51,0)
 . S $P(MOREDATA("IBDATA",1,1),"^",15)=CERTIEN
"RTN","BPSNCPD2",52,0)
 . K CERTARY D GETS^DIQ(9002313.31,CERTIEN_",","1*","","CERTARY")
"RTN","BPSNCPD2",53,0)
 . S (NODE,FLD)="" F  S NODE=$O(CERTARY(9002313.311,NODE)) Q:NODE=""  F  S FLD=$O(CERTARY(9002313.311,NODE,FLD)) Q:FLD=""  D
"RTN","BPSNCPD2",54,0)
 . . I FLD=.01 S NFLD="",NFLD=CERTARY(9002313.311,NODE,FLD) D
"RTN","BPSNCPD2",55,0)
 . . . I NFLD=101 S $P(MOREDATA("IBDATA",1,1),"^",2)=CERTARY(9002313.311,NODE,.02) ;BIN
"RTN","BPSNCPD2",56,0)
 . . . I NFLD=104 S $P(MOREDATA("IBDATA",1,1),"^",3)=CERTARY(9002313.311,NODE,.02)  ;PCN
"RTN","BPSNCPD2",57,0)
 . . . I NFLD=110 S $P(MOREDATA("IBDATA",1,2),"^",6)=CERTARY(9002313.311,NODE,.02)  ;CERT ID
"RTN","BPSNCPD2",58,0)
 . K CERTARY D GETS^DIQ(9002313.31,CERTIEN_",","2*","","CERTARY")
"RTN","BPSNCPD2",59,0)
 . S (NODE,FLD)="" F  S NODE=$O(CERTARY(9002313.3121,NODE)) Q:NODE=""  F  S FLD=$O(CERTARY(9002313.3121,NODE,FLD)) Q:FLD=""  D
"RTN","BPSNCPD2",60,0)
 . . I FLD=.01 S NFLD="",NFLD=CERTARY(9002313.3121,NODE,FLD) D
"RTN","BPSNCPD2",61,0)
 . . . I NFLD=301 S $P(MOREDATA("IBDATA",1,1),"^",5)=CERTARY(9002313.3121,NODE,.02)  ;GROUP ID
"RTN","BPSNCPD2",62,0)
 . . . I NFLD=301 S $P(MOREDATA("IBDATA",1,1),"^",6)=CERTARY(9002313.3121,NODE,.02)  ;CARD ID
"RTN","BPSNCPD2",63,0)
 . . . I NFLD=306 S $P(MOREDATA("IBDATA",1,1),"^",7)=CERTARY(9002313.3121,NODE,.02)  ;PATIENT RELATIONSHIP CODE
"RTN","BPSNCPD2",64,0)
 . . . I NFLD=310 S $P(MOREDATA("IBDATA",1,1),"^",8)=CERTARY(9002313.3121,NODE,.02)  ;CARDHOLDER 1ST NAME
"RTN","BPSNCPD2",65,0)
 . . . I NFLD=311 S $P(MOREDATA("IBDATA",1,1),"^",9)=CERTARY(9002313.3121,NODE,.02)  ;CARDHOLDER LAST NAME
"RTN","BPSNCPD2",66,0)
 . . . I NFLD=412 S $P(MOREDATA("IBDATA",1,2),"^",1)=CERTARY(9002313.3121,NODE,.02)  ;DISPENSING FEE
"RTN","BPSNCPD2",67,0)
 . . . I NFLD=423 S $P(MOREDATA("IBDATA",1,2),"^",2)=CERTARY(9002313.3121,NODE,.02)  ;BASIS OF COST DETERMINATION
"RTN","BPSNCPD2",68,0)
 . . . I NFLD=426 S $P(MOREDATA("IBDATA",1,2),"^",3)=CERTARY(9002313.3121,NODE,.02)  ;USUAL & CUSTOMARY - BASE PRICE
"RTN","BPSNCPD2",69,0)
 . . . I NFLD=430 S $P(MOREDATA("IBDATA",1,2),"^",4)=CERTARY(9002313.3121,NODE,.02)  ;GROSS AMT DUE
"RTN","BPSNCPD2",70,0)
 . . . I NFLD=442 S $P(MOREDATA("IBDATA",1,2),"^",7)=CERTARY(9002313.3121,NODE,.02)  ;QTY
"RTN","BPSNCPD2",71,0)
 . . . I NFLD=409 S $P(MOREDATA("IBDATA",1,2),"^",8)=CERTARY(9002313.3121,NODE,.02)  ;UNIT COST
"RTN","BPSNCPD2",72,0)
 . . . I NFLD=407 S $P(MOREDATA("IBDATA",1,2),"^",9)=CERTARY(9002313.3121,NODE,.02)  ;NDC
"RTN","BPSNCPD2",73,0)
 . . . I NFLD=403 S $P(MOREDATA("IBDATA",1,2),"^",10)=CERTARY(9002313.3121,NODE,.02)  ;FILL#
"RTN","BPSNCPD2",74,0)
 . I $P(MOREDATA("IBDATA",1,2),"^",4)="" S $P(MOREDATA("IBDATA",1,2),"^",4)=$P(MOREDATA("IBDATA",1,2),"^",3)
"RTN","BPSNCPD2",75,0)
 . K CERTARY
"RTN","BPSNCPD2",76,0)
 . Q:CERTIFY
"RTN","BPSNCPD2",77,0)
 . ;
"RTN","BPSNCPD2",78,0)
 ;
"RTN","BPSNCPD2",79,0)
 I '$D(MOREDATA("IBDATA",1)) D
"RTN","BPSNCPD2",80,0)
 . N WW
"RTN","BPSNCPD2",81,0)
 . S WW=$O(MOREDATA("IBDATA",""))
"RTN","BPSNCPD2",82,0)
 . I WW'="" M MOREDATA("IBDATA",1)=MOREDATA("IBDATA",WW) K MOREDATA("IBDATA",WW)
"RTN","BPSNCPD2",83,0)
 ;
"RTN","BPSNCPD2",84,0)
 S MOREDATA("IBDATA",1,1)=$TR(MOREDATA("IBDATA",1,1),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSNCPD2",85,0)
 S MOREDATA("IBDATA",1,2)=$TR(MOREDATA("IBDATA",1,2),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSNCPD2",86,0)
 ;
"RTN","BPSNCPD2",87,0)
 Q
"RTN","BPSNCPD3")
0^60^B55349508
"RTN","BPSNCPD3",1,0)
BPSNCPD3 ;BHAM ISC/LJE - Continuation of BPSNCPDP - DUR HANDLING ;06/16/2004
"RTN","BPSNCPD3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSNCPD3",3,0)
 ;Reference to ^PSRX supported by DBIA 1977
"RTN","BPSNCPD3",4,0)
 ;
"RTN","BPSNCPD3",5,0)
 ; Phase IV comments
"RTN","BPSNCPD3",6,0)
 ;   DUR handled by PSO, not in here.
"RTN","BPSNCPD3",7,0)
 ;   DDUR, DDUR2, DUR, and REJ should probably be removed in Phase IV
"RTN","BPSNCPD3",8,0)
 ;   DUR1 is called by PSO to get the reject info so that should NOT be removed
"RTN","BPSNCPD3",9,0)
 ;
"RTN","BPSNCPD3",10,0)
 ; DDUR - Display DUR information
"RTN","BPSNCPD3",11,0)
 ; There were two calls to this from BPSNCPDP but they are commented out
"RTN","BPSNCPD3",12,0)
 ; There are no other references to this in BPS so I do not think it is used
"RTN","BPSNCPD3",13,0)
 ; Variables RESPONSE, CLMSTAT, and DURCALL are expected by BPSNCPDP, if the
"RTN","BPSNCPD3",14,0)
 ;   calls were not commented out and they are newed by BPSNCPD
"RTN","BPSNCPD3",15,0)
DDUR ; 
"RTN","BPSNCPD3",16,0)
 N PNAME,DFILL,DURIEN,DURINFO,ERROR,COUNT,I,J,PREVFILL,CONT,DURRESP
"RTN","BPSNCPD3",17,0)
 S PNAME=""
"RTN","BPSNCPD3",18,0)
 I $G(DFN) S PNAME=$P(^DPT(DFN,0),"^",1)
"RTN","BPSNCPD3",19,0)
 W !!,"For "_PNAME_", prescription # "_$P(^PSRX(BRXIEN,0),"^",1)_" and fill # "_BFILL_":"
"RTN","BPSNCPD3",20,0)
 W !!,"The 3rd Party Insurance Payer has reported a Drug Interaction or other problem,",!,"and the Drug Use Review (DUR) information is: ",!
"RTN","BPSNCPD3",21,0)
 S DFILL="",DFILL=$E($TR($J("",4-$L(BFILL))," ","0")_BFILL,1,4)_1
"RTN","BPSNCPD3",22,0)
 S DURIEN="",DURIEN=$P(^BPST(BRXIEN_"."_DFILL,0),"^",5)
"RTN","BPSNCPD3",23,0)
 D GETS^DIQ(9002313.0301,"1,"_DURIEN_",","567.01*","E","DURINFO","ERROR")
"RTN","BPSNCPD3",24,0)
 I $D(ERROR("DIERR")) W !!,"An error has occurred while retrieving the response information.  Probably DUR occurred.  See ECME."
"RTN","BPSNCPD3",25,0)
 S COUNT=1,(I,J)="" F  S I=$O(DURINFO(9002313.1101,I)) Q:I=""  D
"RTN","BPSNCPD3",26,0)
 . W:COUNT'=1 !!,"# "_COUNT_" DUR Response:"
"RTN","BPSNCPD3",27,0)
 . F  S J=$O(DURINFO(9002313.1101,I,J)) Q:J=""  D
"RTN","BPSNCPD3",28,0)
 . . I J=439,$D(DURINFO(9002313.1101,I,J,"E")) W:DURINFO(9002313.1101,I,J,"E")'="" !,"Reason for Service Code: ",DURINFO(9002313.1101,I,J,"E") Q
"RTN","BPSNCPD3",29,0)
 . . I J=528,$D(DURINFO(9002313.1101,I,J,"E")) W:DURINFO(9002313.1101,I,J,"E")'="" !,"Clinical Significance: ",DURINFO(9002313.1101,I,J,"E") Q
"RTN","BPSNCPD3",30,0)
 . . I J=529,$D(DURINFO(9002313.1101,I,J,"E")) W:DURINFO(9002313.1101,I,J,"E")'="" !,"Other Pharmacy Indicator: ",DURINFO(9002313.1101,I,J,"E") Q
"RTN","BPSNCPD3",31,0)
 . . I J=530,$D(DURINFO(9002313.1101,I,J,"E")) D  Q
"RTN","BPSNCPD3",32,0)
 . . . S PREVFILL="",PREVFILL=$E(DURINFO(9002313.1101,I,J,"E"),5,6)_"/"_$E(DURINFO(9002313.1101,I,J,"E"),7,8)_"/"_$E(DURINFO(9002313.1101,I,J,"E"),1,4)
"RTN","BPSNCPD3",33,0)
 . . . W:DURINFO(9002313.1101,I,J,"E")'="" !,"Previous Date of Fill: ",PREVFILL
"RTN","BPSNCPD3",34,0)
 . . I J=531,$D(DURINFO(9002313.1101,I,J,"E")) W:DURINFO(9002313.1101,I,J,"E")'="" !,"Quantity of Previous Fill: ",DURINFO(9002313.1101,I,J,"E") Q
"RTN","BPSNCPD3",35,0)
 . . I J=532,$D(DURINFO(9002313.1101,I,J,"E")) W:DURINFO(9002313.1101,I,J,"E")'="" !,"Database Indicator: ",DURINFO(9002313.1101,I,J,"E") Q
"RTN","BPSNCPD3",36,0)
 . . I J=533,$D(DURINFO(9002313.1101,I,J,"E")) W:DURINFO(9002313.1101,I,J,"E")'="" !,"Other Prescriber Indicator: ",DURINFO(9002313.1101,I,J,"E") Q
"RTN","BPSNCPD3",37,0)
 . . I J=544,$D(DURINFO(9002313.1101,I,J,"E")) W:DURINFO(9002313.1101,I,J,"E")'="" !,"DUR Free Text Information: ",DURINFO(9002313.1101,I,J,"E") Q
"RTN","BPSNCPD3",38,0)
 . S COUNT=COUNT+1,CONT="" R !,"Enter to continue . . . ",CONT:180
"RTN","BPSNCPD3",39,0)
 . D REJ
"RTN","BPSNCPD3",40,0)
 ;
"RTN","BPSNCPD3",41,0)
DDUR2 ;
"RTN","BPSNCPD3",42,0)
 S CONT="" R !,"Do you wish to fill the prescription anyway?  ",CONT:120
"RTN","BPSNCPD3",43,0)
 I CONT'="Y"&(CONT'="N") W !,"You must enter Y for Yes or N for No." G DDUR2
"RTN","BPSNCPD3",44,0)
 ;here is where an xref or something needs to be set until the DUR is resolved, then send user back to enter/edit RX.
"RTN","BPSNCPD3",45,0)
 I CONT="N" S RESPONSE=4,CLMSTAT=CLMSTAT_"  Pharmacist elected to not fill Prescription based on DUR." Q
"RTN","BPSNCPD3",46,0)
 E  D  S DURCALL=0
"RTN","BPSNCPD3",47,0)
 . S DURRESP="",DURRESP=$$DURBRIEF^BPSOS6G(BRXIEN_"."_DFILL)
"RTN","BPSNCPD3",48,0)
 .S RESPONSE=5,DURCALL=1,CLMSTAT=CLMSTAT_" Pharmacist "_DUZ_" chose to override the DUR from payer and fill prescription. (DUR: "_DURRESP_")"
"RTN","BPSNCPD3",49,0)
 Q
"RTN","BPSNCPD3",50,0)
 ;
"RTN","BPSNCPD3",51,0)
 ; DUR - Here is where an xref or something needs to be set until the DUR is resolved, then send user back to enter/edit RX.
"RTN","BPSNCPD3",52,0)
 ;   This is done by PSO. 
"RTN","BPSNCPD3",53,0)
DUR ; 
"RTN","BPSNCPD3",54,0)
 ;
"RTN","BPSNCPD3",55,0)
 Q
"RTN","BPSNCPD3",56,0)
 ;
"RTN","BPSNCPD3",57,0)
 ; REJ - Display Reject information
"RTN","BPSNCPD3",58,0)
 ; Input:
"RTN","BPSNCPD3",59,0)
 ;   DURIEN - It is assumed that this will be defined.  It is set in BPSNCPDP.
"RTN","BPSNCPD3",60,0)
 ; Output:
"RTN","BPSNCPD3",61,0)
 ;   Data will be displayed to the user screen
"RTN","BPSNCPD3",62,0)
 ;   
"RTN","BPSNCPD3",63,0)
REJ ;
"RTN","BPSNCPD3",64,0)
 N REJARY,ERR,ADDINFO,MADDINFO,CONT
"RTN","BPSNCPD3",65,0)
 D GETS^DIQ(9002313.03511,"1,1,"_DURIEN_",","*","","REJARY","ERR")
"RTN","BPSNCPD3",66,0)
 S ADDINFO="",ADDINFO=$$GET1^DIQ(9002313.0301,"1,"_DURIEN_",","526")
"RTN","BPSNCPD3",67,0)
 S MADDINFO=$$GET1^DIQ(9002313.03,DURIEN_",","504")
"RTN","BPSNCPD3",68,0)
 I $D(REJARY) W !!,"Claim Rejected by the Payer for the following reason(s):",! D
"RTN","BPSNCPD3",69,0)
 .W !,"Reject code: ",REJARY(9002313.03511,"1,1,"_DURIEN_",",.01)
"RTN","BPSNCPD3",70,0)
 .W !,"Reject Fld Occurrence Indicator: ",REJARY(9002313.03511,"1,1,"_DURIEN_",",546)
"RTN","BPSNCPD3",71,0)
 .W !,"Additional Information:"
"RTN","BPSNCPD3",72,0)
 E  W !!,"Payer additional information: ",!
"RTN","BPSNCPD3",73,0)
 W !,MADDINFO
"RTN","BPSNCPD3",74,0)
 W:$E(ADDINFO,1,77)'="" !?3,$E(ADDINFO,1,77) W:$E(ADDINFO,78,157)'="" !?3,$E(ADDINFO,78,157),!
"RTN","BPSNCPD3",75,0)
 W:$E(ADDINFO,158,237)'="" !?3,$E(ADDINFO,158,237) W:$E(ADDINFO,238,256)'="" !?3,$E(ADDINFO,238,256),!!
"RTN","BPSNCPD3",76,0)
 R !!,"Enter to continue . . . ",CONT:180
"RTN","BPSNCPD3",77,0)
 Q
"RTN","BPSNCPD3",78,0)
 ;
"RTN","BPSNCPD3",79,0)
 ; Function call for DUR INFORMATION 
"RTN","BPSNCPD3",80,0)
 ; Parameters: BRXIEN = Prescription IEN
"RTN","BPSNCPD3",81,0)
 ;             BFILL = fill number
"RTN","BPSNCPD3",82,0)
 ;             DUR = DUR info passed back
"RTN","BPSNCPD3",83,0)
 ;             ERROR = error passed back
"RTN","BPSNCPD3",84,0)
 ; Note:
"RTN","BPSNCPD3",85,0)
 ;    DUR("BILLED")=0 if ecme off for pharmacy or no transaction in ECME
"RTN","BPSNCPD3",86,0)
 ;    DUR(<Insurance counter>,"BILLED")=1 if billed through ecme
"RTN","BPSNCPD3",87,0)
DUR1(BRXIEN,BFILL,DUR,ERROR) ;
"RTN","BPSNCPD3",88,0)
 N SITE,DFILL,TRANIEN,JJ,DUR1,DURIEN,I
"RTN","BPSNCPD3",89,0)
 ;
"RTN","BPSNCPD3",90,0)
 ; Get Site info and check is ECME is turned on
"RTN","BPSNCPD3",91,0)
 ; If not, set DUR("BILLED")=0 and quit
"RTN","BPSNCPD3",92,0)
 I '$G(BFILL) S SITE=$$GET1^DIQ(52,BRXIEN,20,"I")
"RTN","BPSNCPD3",93,0)
 I $G(BFILL) S SITE=$$GET1^DIQ(52.1,BFILL_","_BRXIEN,8,"I")
"RTN","BPSNCPD3",94,0)
 I '$$ECMEON^BPSUTIL(SITE) S DUR("BILLED")=0 Q
"RTN","BPSNCPD3",95,0)
 ;
"RTN","BPSNCPD3",96,0)
 ; Set up the Transaction IEN
"RTN","BPSNCPD3",97,0)
 S DFILL="",DFILL=$E($TR($J("",4-$L(BFILL))," ","0")_BFILL,1,4)_1
"RTN","BPSNCPD3",98,0)
 S TRANIEN=BRXIEN_"."_DFILL
"RTN","BPSNCPD3",99,0)
 ;
"RTN","BPSNCPD3",100,0)
 ; If the transaction record does not exist, set DUR("BILLED")=0 and quit
"RTN","BPSNCPD3",101,0)
 I '$D(^BPST(TRANIEN)) S DUR("BILLED")=0 Q
"RTN","BPSNCPD3",102,0)
 ;
"RTN","BPSNCPD3",103,0)
 ; Loop through the insurance multiple and set DUR array
"RTN","BPSNCPD3",104,0)
 S JJ=0
"RTN","BPSNCPD3",105,0)
 F  S JJ=$O(^BPST(TRANIEN,10,JJ)) Q:JJ=""!(JJ'?1N.N)  D
"RTN","BPSNCPD3",106,0)
 . ;
"RTN","BPSNCPD3",107,0)
 . ; We are good so set Billed
"RTN","BPSNCPD3",108,0)
 . S DUR(JJ,"BILLED")=1
"RTN","BPSNCPD3",109,0)
 . ;
"RTN","BPSNCPD3",110,0)
 . ; Get Insurance Info and set into DUR array
"RTN","BPSNCPD3",111,0)
 . D GETS^DIQ(9002313.59902,JJ_","_TRANIEN_",","902.05;902.06;902.24;902.25;902.26","E","DUR1","ERROR")
"RTN","BPSNCPD3",112,0)
 . S DUR(JJ,"INSURANCE NAME")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.24,"E"))  ; Insurance Company Name
"RTN","BPSNCPD3",113,0)
 . S DUR(JJ,"GROUP NUMBER")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.05,"E"))    ; Insurance Group Number
"RTN","BPSNCPD3",114,0)
 . S DUR(JJ,"GROUP NAME")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.25,"E"))      ; Insurance Group Name
"RTN","BPSNCPD3",115,0)
 . S DUR(JJ,"PLAN CONTACT")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.26,"E"))    ; Insurance Contact Number
"RTN","BPSNCPD3",116,0)
 . S DUR(JJ,"CARDHOLDER ID")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.06,"E"))   ; Cardholder ID
"RTN","BPSNCPD3",117,0)
 . ;
"RTN","BPSNCPD3",118,0)
 . ; Get Response IEN and Data
"RTN","BPSNCPD3",119,0)
 . S DURIEN="",DURIEN=$P(^BPST(TRANIEN,0),"^",5)                             ;Note: in future will need to store/get DURIEN for each insurance
"RTN","BPSNCPD3",120,0)
 . S DUR(JJ,"RESPONSE IEN")=DURIEN
"RTN","BPSNCPD3",121,0)
 . D GETS^DIQ(9002313.0301,"1,"_DURIEN_",","501;567.01*;526","E","DUR1","ERROR")
"RTN","BPSNCPD3",122,0)
 . S DUR(JJ,"PAYER MESSAGE")=$G(DUR1(9002313.0301,"1,"_DURIEN_",",526,"E"))           ;Additional free text message info from payer
"RTN","BPSNCPD3",123,0)
 . S DUR(JJ,"STATUS")=$G(DUR1(9002313.0301,"1,"_DURIEN_",",501,"E"))                  ;Status of Response
"RTN","BPSNCPD3",124,0)
 . S DUR(JJ,"REASON")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",439,"E"))                ;Reason of Service Code
"RTN","BPSNCPD3",125,0)
 . S DUR(JJ,"CLIN SIGNIFICANCE")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",528,"E"))     ;Clinical Significance Code
"RTN","BPSNCPD3",126,0)
 . S DUR(JJ,"OTH PHARM IND")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",529,"E"))         ;Other Pharmacy Indicator Code
"RTN","BPSNCPD3",127,0)
 . S DUR(JJ,"PREV FILL DATE")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",530,"E"))        ;Previous Date of Fill
"RTN","BPSNCPD3",128,0)
 . S DUR(JJ,"QTY OF PREV FILL")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",531,"E"))      ;Quantity of Previous Fill
"RTN","BPSNCPD3",129,0)
 . S DUR(JJ,"DATABASE IND")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",532,"E"))          ;Database Indicator
"RTN","BPSNCPD3",130,0)
 . S DUR(JJ,"OTH PRESCRIBER IND")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",533,"E"))    ;Other Prescriber Indicator
"RTN","BPSNCPD3",131,0)
 . S DUR(JJ,"DUR FREE TEXT DESC")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",544,"E"))    ;DUR Free Text Message from Payer
"RTN","BPSNCPD3",132,0)
 . ;
"RTN","BPSNCPD3",133,0)
 . ; Get DUR reject codes and description and store in DUR 
"RTN","BPSNCPD3",134,0)
 . D GETS^DIQ(9002313.0301,"1,"_DURIEN_",","511*","I","DUR1","ERROR")                 ;get DUR codes and descriptions
"RTN","BPSNCPD3",135,0)
 . S DUR(JJ,"REJ CODE LST")=""
"RTN","BPSNCPD3",136,0)
 . F I=1:1 Q:'$D(DUR1(9002313.03511,I_",1,"_DURIEN_","))  D
"RTN","BPSNCPD3",137,0)
 .. S DUR(JJ,"REJ CODES",I,DUR1(9002313.03511,I_",1,"_DURIEN_",",.01,"I"))=$$GET1^DIQ(9002313.93,DUR1(9002313.03511,I_",1,"_DURIEN_",",.01,"I"),".02")
"RTN","BPSNCPD3",138,0)
 .. S DUR(JJ,"REJ CODE LST")=DUR(JJ,"REJ CODE LST")_","_DUR1(9002313.03511,I_",1,"_DURIEN_",",.01,"I")
"RTN","BPSNCPD3",139,0)
 . S DUR(JJ,"REJ CODE LST")=$E(DUR(JJ,"REJ CODE LST"),2,9999)
"RTN","BPSNCPD3",140,0)
 Q
"RTN","BPSNCPDP")
0^61^B69936802
"RTN","BPSNCPDP",1,0)
BPSNCPDP ;BHAM ISC/LJE - API to submit a claim to ECME ;8/01/03
"RTN","BPSNCPDP",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSNCPDP",3,0)
 ; Reference to ^PSRX supported by DBIA 1977
"RTN","BPSNCPDP",4,0)
 ;Input
"RTN","BPSNCPDP",5,0)
 ; BRXIEN = Prescription IEN
"RTN","BPSNCPDP",6,0)
 ; BFILL = Fill Number
"RTN","BPSNCPDP",7,0)
 ; BFILLDAT = Fill Date of current prescription and fill number
"RTN","BPSNCPDP",8,0)
 ; BWHERE (RX Action)
"RTN","BPSNCPDP",9,0)
 ;    ARES = Resubmit for an auto-reversed claim was released while waiting
"RTN","BPSNCPDP",10,0)
 ;           for the payer response
"RTN","BPSNCPDP",11,0)
 ;    AREV = Auto-Reversal
"RTN","BPSNCPDP",12,0)
 ;    BB   = Back Billing
"RTN","BPSNCPDP",13,0)
 ;    CRLB = CMOP Release & Rebill
"RTN","BPSNCPDP",14,0)
 ;    CRLR = CMOP Release & Reverse (successful release)
"RTN","BPSNCPDP",15,0)
 ;    CRLX = CMOP unsuccessful release & reverse
"RTN","BPSNCPDP",16,0)
 ;    DC   = Discontinue - only reverse un-released PAYABLE DC's, release date check
"RTN","BPSNCPDP",17,0)
 ;           should be in calling routine.
"RTN","BPSNCPDP",18,0)
 ;    DDED = Delete in edit
"RTN","BPSNCPDP",19,0)
 ;    DE   = Delete
"RTN","BPSNCPDP",20,0)
 ;    ED   = Edit
"RTN","BPSNCPDP",21,0)
 ;    ERES = Resubmit from ECME user screen
"RTN","BPSNCPDP",22,0)
 ;    EREV = Reversal from ECME user screen
"RTN","BPSNCPDP",23,0)
 ;    HLD  = Put prescription on Hold
"RTN","BPSNCPDP",24,0)
 ;    OF   = Original Fill
"RTN","BPSNCPDP",25,0)
 ;    PC   = Pull CMOPs
"RTN","BPSNCPDP",26,0)
 ;    PE   = Pull early from suspense
"RTN","BPSNCPDP",27,0)
 ;    PL   = Pull local from suspense
"RTN","BPSNCPDP",28,0)
 ;    PP   = PP from Patient Prescription Processing option
"RTN","BPSNCPDP",29,0)
 ;    RF   = Refill
"RTN","BPSNCPDP",30,0)
 ;    RL   = Release Rx NDC check - Rebill if billed NDC doesn't match release NDC
"RTN","BPSNCPDP",31,0)
 ;    RN   = Renew
"RTN","BPSNCPDP",32,0)
 ;    RRL  = Original claim rejected, submit another claim, no reversal
"RTN","BPSNCPDP",33,0)
 ;    RS   = Return-to-Stock
"RTN","BPSNCPDP",34,0)
 ; BILLNDC = Valid NDC# with format 5-4-2
"RTN","BPSNCPDP",35,0)
 ; REVREAS = Reversal Reason
"RTN","BPSNCPDP",36,0)
 ; DURREC  = String of DUR info - Three "^" pieces
"RTN","BPSNCPDP",37,0)
 ;                Professional Service Code
"RTN","BPSNCPDP",38,0)
 ;                Reason for Service Code
"RTN","BPSNCPDP",39,0)
 ;                Result of Service Code
"RTN","BPSNCPDP",40,0)
 ;Output (RESPONSE^MESSAGE)
"RTN","BPSNCPDP",41,0)
 ; RESPONSE
"RTN","BPSNCPDP",42,0)
 ;    0  Submitted through ECME
"RTN","BPSNCPDP",43,0)
 ;    1  No submission through ECME
"RTN","BPSNCPDP",44,0)
 ;    2  IB not billable
"RTN","BPSNCPDP",45,0)
 ;    3  Claim was closed, not submitted (RTS/Deletes)
"RTN","BPSNCPDP",46,0)
 ;    4  Unable to queue claim
"RTN","BPSNCPDP",47,0)
 ;    5  Incorrect information supplied to ECME
"RTN","BPSNCPDP",48,0)
 ; MESSAGE = Message associated with the response (error/submitted)
"RTN","BPSNCPDP",49,0)
 ;    
"RTN","BPSNCPDP",50,0)
EN(BRXIEN,BFILL,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC) ;
"RTN","BPSNCPDP",51,0)
EN1 N DFN,PNAME,BRX,ARRAY,MOREDATA,SITE,WFLG,OLDRESP
"RTN","BPSNCPDP",52,0)
 N %,%I,%H,X,TODAY
"RTN","BPSNCPDP",53,0)
 N QUIT,CERTIFY,CERTIEN,PAYERSH
"RTN","BPSNCPDP",54,0)
 N REBILL,REVONLY,CLMSTAT,RESPONSE,BPSTART,IB,RESP
"RTN","BPSNCPDP",55,0)
 ;
"RTN","BPSNCPDP",56,0)
 ; Default variables
"RTN","BPSNCPDP",57,0)
 S RESPONSE="",CLMSTAT=""
"RTN","BPSNCPDP",58,0)
 ;
"RTN","BPSNCPDP",59,0)
 ; Check for missing parameters
"RTN","BPSNCPDP",60,0)
 I '$G(BRXIEN) S CLMSTAT="Prescription IEN parameter missing",RESPONSE=5 G END
"RTN","BPSNCPDP",61,0)
 I $G(BWHERE)="" S CLMSTAT="RX Action parameter missing",RESPONSE=5 G END
"RTN","BPSNCPDP",62,0)
 I '$G(BFILL) S BFILL=0
"RTN","BPSNCPDP",63,0)
 ;
"RTN","BPSNCPDP",64,0)
 ; Check that the prescription exists
"RTN","BPSNCPDP",65,0)
 I '$D(^PSRX(BRXIEN,0)) S CLMSTAT="Prescription does not exist",RESPONSE=5 G END
"RTN","BPSNCPDP",66,0)
 ;
"RTN","BPSNCPDP",67,0)
 ; Get the NDC if it was not passed in
"RTN","BPSNCPDP",68,0)
 I $G(BILLNDC)="" S BILLNDC=$$GETNDC^PSONDCUT(BRXIEN,BFILL)
"RTN","BPSNCPDP",69,0)
 ;
"RTN","BPSNCPDP",70,0)
 ; Patient Info
"RTN","BPSNCPDP",71,0)
 S DFN=$$GET1^DIQ(52,BRXIEN_",",2,"I"),PNAME=$$GET1^DIQ(2,DFN,.01)
"RTN","BPSNCPDP",72,0)
 ;
"RTN","BPSNCPDP",73,0)
 ; Get prescription number
"RTN","BPSNCPDP",74,0)
 S BRX=$P(^PSRX(BRXIEN,0),"^",1)
"RTN","BPSNCPDP",75,0)
 ;
"RTN","BPSNCPDP",76,0)
 ; Set write flag
"RTN","BPSNCPDP",77,0)
 S WFLG=1
"RTN","BPSNCPDP",78,0)
 I ",ARES,AREV,CRLB,CRLR,CRLX,DDED,DE,EREV,HLD,PC,PE,PL,RS,"[(","_BWHERE_",") S WFLG=0
"RTN","BPSNCPDP",79,0)
 ;
"RTN","BPSNCPDP",80,0)
 ; Get status of previously submitted claim and set rebill/revonly flags
"RTN","BPSNCPDP",81,0)
 S (REBILL,REVONLY)=0
"RTN","BPSNCPDP",82,0)
 S OLDRESP=$P($$STATUS^BPSOSRX(BRXIEN,BFILL,1),U,1)
"RTN","BPSNCPDP",83,0)
 I ",AREV,CRLR,CRLX,DC,DDED,DE,EREV,HLD,RS,"[(","_BWHERE_",") S REVONLY=1
"RTN","BPSNCPDP",84,0)
 E  I OLDRESP="E PAYABLE"!(OLDRESP="E DUPLICATE") S REBILL=1
"RTN","BPSNCPDP",85,0)
 ;
"RTN","BPSNCPDP",86,0)
 ; Get Site info and check if the site has ECME turned on
"RTN","BPSNCPDP",87,0)
 ;   Do not check for reversals/rebill as these need to be processed for the old site
"RTN","BPSNCPDP",88,0)
 I 'BFILL S SITE=$$GET1^DIQ(52,BRXIEN,20,"I")
"RTN","BPSNCPDP",89,0)
 I BFILL S SITE=$$GET1^DIQ(52.1,BFILL_","_BRXIEN,8,"I")
"RTN","BPSNCPDP",90,0)
 I 'REVONLY,'REBILL D  I RESPONSE=1 G END
"RTN","BPSNCPDP",91,0)
 . I '$G(SITE) S CLMSTAT="No Site Information",RESPONSE=1 Q
"RTN","BPSNCPDP",92,0)
 . I '$$ECMEON^BPSUTIL(SITE) S CLMSTAT="ECME switch is not on for the site",RESPONSE=1
"RTN","BPSNCPDP",93,0)
 ;
"RTN","BPSNCPDP",94,0)
 ; In Progress/Stranded claims check
"RTN","BPSNCPDP",95,0)
 I OLDRESP["IN PROGRESS" D  G END
"RTN","BPSNCPDP",96,0)
 . S CLMSTAT="Previous request is IN PROGRESS.  It may need to be unstranded.",RESPONSE=4
"RTN","BPSNCPDP",97,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",98,0)
 . ; If not OP, then send an email to the OPECC
"RTN","BPSNCPDP",99,0)
 . I ",AREV,BB,ERES,EREV,"'[(","_BWHERE_",") D BULL^BPSNCPD1(BRXIEN,BFILL,$G(SITE),$G(DFN),$G(PNAME))
"RTN","BPSNCPDP",100,0)
 ;
"RTN","BPSNCPDP",101,0)
 ; Backbilling check
"RTN","BPSNCPDP",102,0)
 I BWHERE="BB",OLDRESP'="" D  G END
"RTN","BPSNCPDP",103,0)
 . S CLMSTAT="Previously billed through ECME: "_OLDRESP,RESPONSE=1
"RTN","BPSNCPDP",104,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",105,0)
 ;
"RTN","BPSNCPDP",106,0)
 ; Do not reverse if the prescription was not previously billed through ECME
"RTN","BPSNCPDP",107,0)
 I OLDRESP="",(",AREV,CRLR,CRLX,DC,DDED,DE,EREV,HLD,RS,"[(","_BWHERE_",")) D  G END
"RTN","BPSNCPDP",108,0)
 . S CLMSTAT="Prescription not previously billed through ECME.  Cannot Reverse claim.",RESPONSE=1
"RTN","BPSNCPDP",109,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",110,0)
 ;
"RTN","BPSNCPDP",111,0)
 ; If returning to stock or deleting and the previous claim was not paid, then no reversal is needed
"RTN","BPSNCPDP",112,0)
 ;   so close the prescription and quit
"RTN","BPSNCPDP",113,0)
 I OLDRESP'["E PAYABLE",OLDRESP'["E REVERSAL REJECTED",(",RS,DE,"[(","_BWHERE_",")) D  G END
"RTN","BPSNCPDP",114,0)
 . D CLOSE2^BPSBUTL(BRXIEN,BFILL,BWHERE)
"RTN","BPSNCPDP",115,0)
 . S CLMSTAT="Claim was not payable so it has been closed.  No ECME claim created.",RESPONSE=3
"RTN","BPSNCPDP",116,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",117,0)
 ;
"RTN","BPSNCPDP",118,0)
 ; Do not reverse if the claim is not E PAYABLE
"RTN","BPSNCPDP",119,0)
 I OLDRESP'["E PAYABLE",OLDRESP'["E DUPLICATE",(",AREV,CRLR,CRLX,DC,DDED,HLD,"[(","_BWHERE_",")) D  G END
"RTN","BPSNCPDP",120,0)
 . S CLMSTAT="Claim has status "_OLDRESP_".  Not reversed.",RESPONSE=1
"RTN","BPSNCPDP",121,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",122,0)
 ;
"RTN","BPSNCPDP",123,0)
 ; EREV can be re-reversed if the previous submission is Payable or Rejected Revesal
"RTN","BPSNCPDP",124,0)
 I BWHERE="EREV",",E PAYABLE,E DUPLICATE,E REVERSAL REJECTED,E REVERSAL STRANDED,"'[(","_OLDRESP_",") D  G END
"RTN","BPSNCPDP",125,0)
 . S CLMSTAT="Claim has status "_OLDRESP_".  Not reversed.",RESPONSE=1
"RTN","BPSNCPDP",126,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",127,0)
 ;
"RTN","BPSNCPDP",128,0)
 ; Make sure fill date is not in the future or empty
"RTN","BPSNCPDP",129,0)
 D NOW^%DTC
"RTN","BPSNCPDP",130,0)
 S TODAY=$P(%,".",1)
"RTN","BPSNCPDP",131,0)
 I '$G(BFILLDAT)!($G(BFILLDAT)>TODAY) S BFILLDAT=TODAY
"RTN","BPSNCPDP",132,0)
 ;
"RTN","BPSNCPDP",133,0)
 ; Store needed parameters into MOREDATA
"RTN","BPSNCPDP",134,0)
 S MOREDATA("USER")=DUZ
"RTN","BPSNCPDP",135,0)
 S MOREDATA("RX ACTION")=$G(BWHERE)
"RTN","BPSNCPDP",136,0)
 S MOREDATA("DATE OF SERVICE")=$P($G(BFILLDAT),".",1)
"RTN","BPSNCPDP",137,0)
 S MOREDATA("REVERSAL REASON")=$S($G(REVREAS)="":"UNKNOWN",1:$E($G(REVREAS),1,40))
"RTN","BPSNCPDP",138,0)
 I $G(DURREC)]"" S MOREDATA("DUR",1,0)=DURREC
"RTN","BPSNCPDP",139,0)
 ;
"RTN","BPSNCPDP",140,0)
 ; Do a reversal for the appropriate actions
"RTN","BPSNCPDP",141,0)
 I ",AREV,CRLR,CRLX,DC,DDED,DE,EREV,HLD,RS,"[(","_BWHERE_",") D  G STATUS:RESPONSE=0,END:RESPONSE=4
"RTN","BPSNCPDP",142,0)
 . ; If override flag is set, prompt for override values - MUST be commented out for any release.
"RTN","BPSNCPDP",143,0)
 . ;I $L($T(CHECK^ZZGIZOV1))>0,$$CHECK^ZZGIZOV1 D GETOVER^ZZGIZOV1(BRXIEN,BFILL,OLDRESP,BWHERE,"R")
"RTN","BPSNCPDP",144,0)
 . D LOG(DT_" Before Submit of Reversal")
"RTN","BPSNCPDP",145,0)
 . S BPSTART=$$STTM()
"RTN","BPSNCPDP",146,0)
 . S RESP=$$UNCLAIM^BPSOSRX(BRXIEN,BFILL,.MOREDATA)
"RTN","BPSNCPDP",147,0)
 . D LOG("After Submit of Reversal. Return Value: "_RESP)
"RTN","BPSNCPDP",148,0)
 . I RESP=1 D
"RTN","BPSNCPDP",149,0)
 .. S RESPONSE=0,CLMSTAT="Reversing prescription "_BRX_"."
"RTN","BPSNCPDP",150,0)
 .. I WFLG W !,CLMSTAT H 2
"RTN","BPSNCPDP",151,0)
 . I RESP=0 D
"RTN","BPSNCPDP",152,0)
 .. S RESPONSE=4,CLMSTAT="No claim submission made.  Unable to queue reversal."
"RTN","BPSNCPDP",153,0)
 .. D LOG(CLMSTAT)
"RTN","BPSNCPDP",154,0)
 .. I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",155,0)
 .. L -^BPST
"RTN","BPSNCPDP",156,0)
 ;
"RTN","BPSNCPDP",157,0)
 ; Can not resubmit reversed claims unless they are accepted
"RTN","BPSNCPDP",158,0)
 I OLDRESP]"",OLDRESP["E REVERSAL",OLDRESP'="E REVERSAL ACCEPTED" D  G END
"RTN","BPSNCPDP",159,0)
 . S CLMSTAT="Can not resubmit a rejected or stranded reversal",RESPONSE=1
"RTN","BPSNCPDP",160,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",161,0)
 ;
"RTN","BPSNCPDP",162,0)
 ; Some actions require a paid claim (they will not do a reversal/resubmit)
"RTN","BPSNCPDP",163,0)
 I OLDRESP]"",OLDRESP'="E REVERSAL ACCEPTED",OLDRESP'="E REJECTED",(",CRLB,ED,ERES,RL,RRL,"'[(","_BWHERE_",")) D  G END
"RTN","BPSNCPDP",164,0)
 . S CLMSTAT="Previously billed through ECME: "_OLDRESP,RESPONSE=1
"RTN","BPSNCPDP",165,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",166,0)
 ;
"RTN","BPSNCPDP",167,0)
 ; Certification Testing
"RTN","BPSNCPDP",168,0)
 S (QUIT,CERTIFY)=0
"RTN","BPSNCPDP",169,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ D  I QUIT S CLMSTAT="User exited from certification questions",RESPONSE=1 G END
"RTN","BPSNCPDP",170,0)
 . S CERTIFY=1
"RTN","BPSNCPDP",171,0)
C1 . R !,"ENTER NDC: ",BILLNDC:120 S:BILLNDC="^" QUIT=1 Q:QUIT  I BILLNDC="" G C1
"RTN","BPSNCPDP",172,0)
C2 . R !,"PAYER SHEET: ",PAYERSH:120 I '$D(^BPSF(9002313.92,"B",PAYERSH)) S:PAYERSH="^" QUIT=1 Q:QUIT  W !,"INVALID SHEET" G C2
"RTN","BPSNCPDP",173,0)
C3 . R !,"CERTIFICATION ENTRY: ",CERTIEN:120 I '$D(^BPS(9002313.31,CERTIEN)) S:CERTIEN="^" QUIT=1 Q:QUIT  W !,"INVALID IEN" G C3
"RTN","BPSNCPDP",174,0)
 I WFLG W !!
"RTN","BPSNCPDP",175,0)
 ;
"RTN","BPSNCPDP",176,0)
 ; Build array with prescription data
"RTN","BPSNCPDP",177,0)
 D STARRAY^BPSNCPD1(BRXIEN,BFILL,BWHERE,.ARRAY)
"RTN","BPSNCPDP",178,0)
 ;
"RTN","BPSNCPDP",179,0)
 ; Do IB billing determination and check response
"RTN","BPSNCPDP",180,0)
 ; If IB=2, then not billable, so write messages
"RTN","BPSNCPDP",181,0)
 S IB=0
"RTN","BPSNCPDP",182,0)
 D EN^BPSNCPD2
"RTN","BPSNCPDP",183,0)
 I IB=2 D  G END
"RTN","BPSNCPDP",184,0)
 . S RESPONSE=2
"RTN","BPSNCPDP",185,0)
 . S CLMSTAT=$P(MOREDATA("BILL"),"^",2)
"RTN","BPSNCPDP",186,0)
 . I OLDRESP]"" D LOG(CLMSTAT)
"RTN","BPSNCPDP",187,0)
 ;
"RTN","BPSNCPDP",188,0)
 ; Check for missing data (Will IB billing determination catch this?)
"RTN","BPSNCPDP",189,0)
 I $D(MOREDATA("IBDATA",1,1)),$P(MOREDATA("IBDATA",1,1),"^",1)="" D  G END
"RTN","BPSNCPDP",190,0)
 . S RESPONSE=2,CLMSTAT="Information missing from IB data."
"RTN","BPSNCPDP",191,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",192,0)
 ;
"RTN","BPSNCPDP",193,0)
 ; Check for missing/invalid payer sheets (I think IB billing determination will catch this)
"RTN","BPSNCPDP",194,0)
 I $P($G(MOREDATA("IBDATA",1,1)),"^",4)="" D  G END
"RTN","BPSNCPDP",195,0)
 . S RESPONSE=2,CLMSTAT="Invalid/missing payer sheet from IB data."
"RTN","BPSNCPDP",196,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",197,0)
 ;
"RTN","BPSNCPDP",198,0)
 ; Check if IB says to bill
"RTN","BPSNCPDP",199,0)
 I '$G(MOREDATA("BILL")) D  G END
"RTN","BPSNCPDP",200,0)
 . S RESPONSE=2
"RTN","BPSNCPDP",201,0)
 . S CLMSTAT="Flagged by IB to not 3rd Party Insurance bill through ECME."
"RTN","BPSNCPDP",202,0)
 . I WFLG W !,CLMSTAT,! H 2
"RTN","BPSNCPDP",203,0)
 ;
"RTN","BPSNCPDP",204,0)
 ; Log message to ECME log
"RTN","BPSNCPDP",205,0)
 D LOG(DT_" Before submit of claim")
"RTN","BPSNCPDP",206,0)
 ;
"RTN","BPSNCPDP",207,0)
 ; If override flag is set, prompt for override values - MUST be commented out for any release.
"RTN","BPSNCPDP",208,0)
 ;I $L($T(CHECK^ZZGIZOV1))>0,$$CHECK^ZZGIZOV1 D GETOVER^ZZGIZOV1(BRXIEN,BFILL,OLDRESP,BWHERE,"S")
"RTN","BPSNCPDP",209,0)
 ;
"RTN","BPSNCPDP",210,0)
 ; Get require data
"RTN","BPSNCPDP",211,0)
 S BPSTART=$$STTM()
"RTN","BPSNCPDP",212,0)
 ;
"RTN","BPSNCPDP",213,0)
 ; Submit claim and check result
"RTN","BPSNCPDP",214,0)
 S RESP=$$CLAIM^BPSOSRX(BRXIEN,BFILL,.MOREDATA)
"RTN","BPSNCPDP",215,0)
 D LOG("After Submit of Claim.  Return Value: "_RESP)
"RTN","BPSNCPDP",216,0)
 I RESP=1 D
"RTN","BPSNCPDP",217,0)
 . S RESPONSE=0
"RTN","BPSNCPDP",218,0)
 . S CLMSTAT="Prescription "_BRX_" successfully submitted to ECME for claim generation."
"RTN","BPSNCPDP",219,0)
 . I WFLG W !!,CLMSTAT
"RTN","BPSNCPDP",220,0)
 I RESP=0 D  G END
"RTN","BPSNCPDP",221,0)
 . S RESPONSE=4
"RTN","BPSNCPDP",222,0)
 . S CLMSTAT="No claim submission made.  Unable to queue claim submission."
"RTN","BPSNCPDP",223,0)
 . I WFLG W !!,CLMSTAT,!
"RTN","BPSNCPDP",224,0)
 . D LOG(CLMSTAT)
"RTN","BPSNCPDP",225,0)
 ;
"RTN","BPSNCPDP",226,0)
 ; Display status
"RTN","BPSNCPDP",227,0)
STATUS I 'WFLG H 1
"RTN","BPSNCPDP",228,0)
 E  D STATUS^BPSNCPD1(BRXIEN,BFILL,REBILL,REVONLY,BPSTART,BWHERE)
"RTN","BPSNCPDP",229,0)
 ;
"RTN","BPSNCPDP",230,0)
 ; Clean up and quit
"RTN","BPSNCPDP",231,0)
END K BRXIEN,BFILL,BFILLDAT,BWHERE,MOREDATA
"RTN","BPSNCPDP",232,0)
 S:'$D(RESPONSE) RESPONSE=1
"RTN","BPSNCPDP",233,0)
 Q RESPONSE_"^"_$G(CLMSTAT)
"RTN","BPSNCPDP",234,0)
 ;
"RTN","BPSNCPDP",235,0)
LOG(LOGMSG) ;
"RTN","BPSNCPDP",236,0)
 D LOG59^BPSOSL($T(+0)_" - "_LOGMSG,BRXIEN_"."_$E($TR($J("",4-$L(BFILL))," ","0")_BFILL,1,4)_1)
"RTN","BPSNCPDP",237,0)
 Q
"RTN","BPSNCPDP",238,0)
STTM() ;
"RTN","BPSNCPDP",239,0)
 N %,%H,%I
"RTN","BPSNCPDP",240,0)
 D NOW^%DTC
"RTN","BPSNCPDP",241,0)
 Q %
"RTN","BPSOS")
0^62^B4457405
"RTN","BPSOS",1,0)
BPSOS ;BHAM ISC/FCS/DRS - Table of Contents, etc ;06/01/2004        
"RTN","BPSOS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS",3,0)
 D EN^BPSOS6A() Q  ; convenient shortcut for programmer mode
"RTN","BPSOS",4,0)
VERSION() ;EP
"RTN","BPSOS",5,0)
 Q $P($T(+2),";",3)
"RTN","BPSOS",6,0)
VARIANT() ;EP
"RTN","BPSOS",7,0)
 Q "Base level 1"
"RTN","BPSOS",8,0)
TOC N I,X F I=0:1 S X=$P($T(TOC1+I),";",2,9) Q:X="*"  D
"RTN","BPSOS",9,0)
 . W X,!
"RTN","BPSOS",10,0)
 Q
"RTN","BPSOS",11,0)
TOC1 ; Directory of BPSOS*
"RTN","BPSOS",12,0)
 ; BPSECA* - Build/Parse formatted claim/response packets
"RTN","BPSOS",13,0)
 ; BPSECFM - Formatting (signed numeric overpunch, RJZF, LJBF, etc.)
"RTN","BPSOS",14,0)
 ; BPSECP* - Receipts
"RTN","BPSOS",15,0)
 ; BPSECR* - Development - print NCPDP formats - 9002313.91,9002313.92
"RTN","BPSOS",16,0)
 ; BPSECX* - Low-level 9002313.02 routines, descendant from BPSOSQ2
"RTN","BPSOS",17,0)
 ; BPSECZ* - ILC A/R claims inquiry routines
"RTN","BPSOS",18,0)
 ;            (want to decouple from billing system)
"RTN","BPSOS",19,0)
 ; BPSER*  - Obsolete Reports - to be phased out
"RTN","BPSOS",20,0)
 ; BPSES*  - ILC A/R selection utilities
"RTN","BPSOS",21,0)
 ; BPSMHDR - Menu header
"RTN","BPSOS",22,0)
 ; BPSOS0* - Some fetch utilities for 9002313.02, 9002313.03
"RTN","BPSOS",23,0)
 ; BPSOS1* - none
"RTN","BPSOS",24,0)
 ; BPSOS2# - Insurance auto-selection
"RTN","BPSOS",25,0)
 ; BPSOS2,2x - Manager's Stats & misc. options ScreenMan
"RTN","BPSOS",26,0)
 ; BPSOS3* - The survey routines - probes of VISTA insurance data, etc.
"RTN","BPSOS",27,0)
 ; BPSOS4* - none
"RTN","BPSOS",28,0)
 ; BPSOS5* - none
"RTN","BPSOS",29,0)
 ; BPSOS6* - User's data entry ScreenMan
"RTN","BPSOS",30,0)
 ; BPSOS7* - none
"RTN","BPSOS",31,0)
 ; BPSOS8* - none 
"RTN","BPSOS",32,0)
 ; BPSOS9  - NDC number utilities
"RTN","BPSOS",33,0)
 ; BPSOS9* - none
"RTN","BPSOS",34,0)
 ; BPSOSA* - Modem handling, low-level communications routines
"RTN","BPSOS",35,0)
 ; BPSOSB* - A/R interfaces - post charges to A/R
"RTN","BPSOS",36,0)
 ; BPSOSC# - Certification utilities (sporadic development use only)
"RTN","BPSOS",37,0)
 ; BPSOSCx - Building 9002313.02 claim (BPSOSQ2->QG->CA->C*)
"RTN","BPSOS",38,0)
 ; BPSOSD* - none
"RTN","BPSOS",39,0)
 ; BPSOSE* - none
"RTN","BPSOS",40,0)
 ; BPSOSF* - new NCPDP forms (in development for future release)
"RTN","BPSOS",41,0)
 ; BPSOSG* - none
"RTN","BPSOS",42,0)
 ; BPSOSH* - none
"RTN","BPSOS",43,0)
 ; BPSOSI* - Data Entry / ScreenMan interface
"RTN","BPSOS",44,0)
 ; BPSOSJ* - none
"RTN","BPSOS",45,0)
 ; BPSOSK* - Winnowing old data
"RTN","BPSOS",46,0)
 ; BPSOSL* - Log file utilities
"RTN","BPSOS",47,0)
 ; BPSOSM* - Report Master file 9002313.61 / Inquire/Report 9002313.57
"RTN","BPSOS",48,0)
 ;            (note: BPSOSMA-BPSOSMZ are in development for future)
"RTN","BPSOS",49,0)
 ; BPSOSN* - ILC A/R Billing Interface - NCPDP Paper forms print
"RTN","BPSOS",50,0)
 ; BPSOSO* - Data Entry - Override NCPDP Data Dictionary values
"RTN","BPSOS",51,0)
 ; BPSOSP* - ILC A/R Billing Interface - EOB to Payment batches
"RTN","BPSOS",52,0)
 ; BPSOSQ* - Claim processing through the queues
"RTN","BPSOS",53,0)
 ; BPSOSR* - Callable entry points from VISTA Pharm; and
"RTN","BPSOS",54,0)
 ;            Background Silent Claim Submitter (monitors ^PSRX indexes)
"RTN","BPSOS",55,0)
 ; BPSOSS* - Setup POS
"RTN","BPSOS",56,0)
 ; BPSOST* - None (some name conflicts in ILC A/R V1 and V2)
"RTN","BPSOS",57,0)
 ; BPSOSU* - Utilities; some from ABSUD0xx series in ILC A/R V1
"RTN","BPSOS",58,0)
 ; BPSOSV* - None
"RTN","BPSOS",59,0)
 ; BPSOSW* - None
"RTN","BPSOS",60,0)
 ; BPSOSX* - Utilties for support usage
"RTN","BPSOS",61,0)
 ; BPSOSY* - None
"RTN","BPSOS",62,0)
 ; BPSOSZ* - Special for upgrades, installations
"RTN","BPSOS",63,0)
 ;   Generally, only BPSOSZ is distributed.
"RTN","BPSOS",64,0)
 ;   BPSOSZ_ are not distributed, and are marked DELETE AT SITE.
"RTN","BPSOS",65,0)
 ;*
"RTN","BPSOS",66,0)
RXDEL(RXI,RXR) ; EP - $$ is RX deleted?
"RTN","BPSOS",67,0)
 ; For refills:  if the refill multiple is gone, it's been "deleted"
"RTN","BPSOS",68,0)
 I $G(RXR) Q '$D(^PSRX(RXI,1,RXR,0))
"RTN","BPSOS",69,0)
 ; For first fill: look at the STATUS flag
"RTN","BPSOS",70,0)
 I '$D(^PSRX(RXI,0)) Q 1 ; shouldn't be missing, but it is
"RTN","BPSOS",71,0)
 N X S X=$P(^PSRX(RXI,0),U,15)
"RTN","BPSOS",72,0)
 Q X=13 ; if status is DELETED
"RTN","BPSOS",73,0)
ZWRITE(%,VARA,VARB,VARC,VARD,VARE)          ;EP - from many, many places
"RTN","BPSOS",74,0)
 I %="%"!(%?1"VAR"1U) D  Q
"RTN","BPSOS",75,0)
 . D IMPOSS^BPSOSUE("P","TI","Conflict in var names",%,"ZWRITE",$T(+0))
"RTN","BPSOS",76,0)
 I '$D(@%) W %," is undefined",! Q
"RTN","BPSOS",77,0)
 I $D(@%)#10 W %,"=",@%,!
"RTN","BPSOS",78,0)
 F  S %=$Q(@%) Q:%=""  W %,"=",@%,!
"RTN","BPSOS",79,0)
 I $D(VARA) D ZWRITE(VARA)
"RTN","BPSOS",80,0)
 I $D(VARB) D ZWRITE(VARB)
"RTN","BPSOS",81,0)
 I $D(VARC) D ZWRITE(VARC)
"RTN","BPSOS",82,0)
 I $D(VARD) D ZWRITE(VARD)
"RTN","BPSOS",83,0)
 I $D(VARE) D ZWRITE(VARE)
"RTN","BPSOS",84,0)
 Q
"RTN","BPSOS",85,0)
ZE() ;EP - return value of $ZERROR
"RTN","BPSOS",86,0)
 D ^ZTER
"RTN","BPSOS",87,0)
 Q $ECODE
"RTN","BPSOS",88,0)
NOW() ;EP -
"RTN","BPSOS",89,0)
 N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOS",90,0)
NOWEXT() ;EP -
"RTN","BPSOS",91,0)
 N %H,%,Y,X S %H=$H D YX^%DTC Q Y
"RTN","BPSOS02")
1^63
"RTN","BPSOS03")
0^64^B11124821
"RTN","BPSOS03",1,0)
BPSOS03 ;BHAM ISC/FCS/DRS - 9002313.03 utilities ;06/01/2004
"RTN","BPSOS03",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS03",3,0)
 ;-----------------------------------------------------------
"RTN","BPSOS03",4,0)
 ;IHS/SD/lwj  9/11/02  When running this report, the sites 
"RTN","BPSOS03",5,0)
 ; were encountering an undefined error.  The error was caused
"RTN","BPSOS03",6,0)
 ; by insurers being used on claims, and then removed from the 
"RTN","BPSOS03",7,0)
 ; BPS INSURER file.  This can only be done by either someone
"RTN","BPSOS03",8,0)
 ; at the programmer level, or site manager level, and should
"RTN","BPSOS03",9,0)
 ; not be done.  The fix was to simply $g the retrieval code.
"RTN","BPSOS03",10,0)
 ;-----------------------------------------------------------
"RTN","BPSOS03",11,0)
 Q
"RTN","BPSOS03",12,0)
 ; General utilities for retrieval from 9002313.03, Claim Response
"RTN","BPSOS03",13,0)
 ; $$INSPAID is used by BPSOSQL
"RTN","BPSOS03",14,0)
INSPAID(N)         ;EP - from BPSOSQL -  total amount paid by insurer
"RTN","BPSOS03",15,0)
 N RX,TOT,X S (TOT,RX)=0
"RTN","BPSOS03",16,0)
 F  S RX=$O(^BPSR(N,1000,RX)) Q:'RX  D
"RTN","BPSOS03",17,0)
 . ; Try Gross Amount Due, and if that's zero, Usual and Customary
"RTN","BPSOS03",18,0)
 . S X=$$INSPAID1(N,RX)
"RTN","BPSOS03",19,0)
 . S TOT=TOT+X
"RTN","BPSOS03",20,0)
 Q
"RTN","BPSOS03",21,0)
INSPAID1(N,RX) ;EP -
"RTN","BPSOS03",22,0)
 N X S X=$$509(N,RX) Q X
"RTN","BPSOS03",23,0)
NETPAID1(N,RX) ; EP - computed field in 9002313.57
"RTN","BPSOS03",24,0)
 N X S X=$$509(N,RX) ; X = (#509) Total Amount Paid
"RTN","BPSOS03",25,0)
 N SUB S SUB=1 ; Do we need to subtract (#505) Patient Pay Amount?
"RTN","BPSOS03",26,0)
 N IEN02,INS,FMT S IEN02=$P(^BPSR(RESP,0),U)
"RTN","BPSOS03",27,0)
 I IEN02 D
"RTN","BPSOS03",28,0)
 . S INS=$P($G(^BPSC(IEN02,0)),U,2) Q:'INS    ;IHS/SD/lwj 9/11/02
"RTN","BPSOS03",29,0)
 . I ^BPS(9002313.99,1,"SITE TYPE")=0 S FMT=INS  ;VA/SDD/DLF 7/29/03 CHECK FOR VA OR IHS SITE TYPE
"RTN","BPSOS03",30,0)
 . I ^BPS(9002313.99,1,"SITE TYPE")=1 S FMT=$P($G(^BPSEI(INS,100)),U) Q:'FMT     ;IHS/SD/lwj 9/11/02
"RTN","BPSOS03",31,0)
 . N X S X=$P(^BPSF(9002313.92,FMT,1),U,10)
"RTN","BPSOS03",32,0)
 . I X S SUB=0 ; Total paid means total paid by insurance
"RTN","BPSOS03",33,0)
 I SUB S X=X-$$505(N,RX)
"RTN","BPSOS03",34,0)
 I X<0,SUB D  ; apparently this format is supposed to be excl.
"RTN","BPSOS03",35,0)
 . Q:'$G(FMT)
"RTN","BPSOS03",36,0)
 . S $P(^BPSF(9002313.92,FMT,1),U,10)=1
"RTN","BPSOS03",37,0)
 . S X=X+$$505(N,RX) ;*1.26*1*
"RTN","BPSOS03",38,0)
 Q X
"RTN","BPSOS03",39,0)
REJTEXT(RESP,POS,ARR) ; EP - fills array (passed by ref)
"RTN","BPSOS03",40,0)
 K ARR
"RTN","BPSOS03",41,0)
 N A,I,X,R S (A,I)=0
"RTN","BPSOS03",42,0)
 F  S A=$O(^BPSR(RESP,1000,POS,511,A)) Q:'A  D
"RTN","BPSOS03",43,0)
 . S R=$P(^BPSR(RESP,1000,POS,511,A,0),U)
"RTN","BPSOS03",44,0)
 . Q:R=""
"RTN","BPSOS03",45,0)
 . N S S S=$O(^BPSF(9002313.93,"B",R,0))
"RTN","BPSOS03",46,0)
 . I S S X=$TR($G(^BPSF(9002313.93,S,0)),U,":")
"RTN","BPSOS03",47,0)
 . E  S X=R_" unrecognized reject code"
"RTN","BPSOS03",48,0)
 . S I=I+1,ARR(I)=X
"RTN","BPSOS03",49,0)
 Q
"RTN","BPSOS03",50,0)
MESSAGE(RESP,POS,N) ; EP - get additional message from response
"RTN","BPSOS03",51,0)
 I $G(N)=1 Q $P($G(^BPSR(RESP,1000,POS,504)),U)
"RTN","BPSOS03",52,0)
 I $G(N)=2 Q $P($G(^BPSR(RESP,1000,POS,526)),U)
"RTN","BPSOS03",53,0)
 Q $$MESSAGE(RESP,POS,1)_$$MESSAGE(RESP,POS,2)
"RTN","BPSOS03",54,0)
DFF2EXT(X)         Q $$DFF2EXT^BPSECFM(X)
"RTN","BPSOS03",55,0)
505(M,N) Q $$500(M,N,5) ; Patient Pay Amount
"RTN","BPSOS03",56,0)
506(M,N) Q $$500(M,N,6) ; Ingredient Cost Paid
"RTN","BPSOS03",57,0)
507(M,N) Q $$500(M,N,7) ; Contract Fee Paid
"RTN","BPSOS03",58,0)
508(M,N) Q $$500(M,N,8) ; Sales Tax Paid
"RTN","BPSOS03",59,0)
509(M,N) Q $$500(M,N,9) ; Total Amount Paid
"RTN","BPSOS03",60,0)
512(M,N) Q $$500(M,N,12) ; Accumulated Deductible Amount
"RTN","BPSOS03",61,0)
513(M,N) Q $$500(M,N,13) ; Remaining Deductible Amount
"RTN","BPSOS03",62,0)
514(M,N) Q $$500(M,N,14) ; Remaining Benefit Amount
"RTN","BPSOS03",63,0)
517(M,N) Q $$500(M,N,17) ; Amt Applied to Periodic Deduct
"RTN","BPSOS03",64,0)
518(M,N) Q $$500(M,N,18) ; Amount of Copay/CoInsurance
"RTN","BPSOS03",65,0)
519(M,N) Q $$500(M,N,19) ; Amt Attrib to Prod Selection
"RTN","BPSOS03",66,0)
520(M,N) Q $$500(M,N,20) ; Amt Exceed Per Benefit Max
"RTN","BPSOS03",67,0)
521(M,N) Q $$500(M,N,21) ; Incentive Fee Paid
"RTN","BPSOS03",68,0)
523(M,N) Q $$500(M,N,23) ; Amount Attributed to Sales Tax
"RTN","BPSOS03",69,0)
500(M,N,J)         ; field #500+J signed numeric
"RTN","BPSOS03",70,0)
 Q:'M!'N ""
"RTN","BPSOS03",71,0)
 N X S X=$P($G(^BPSR(M,1000,N,500)),U,J)
"RTN","BPSOS03",72,0)
 I $E(X,1,2)?2U S X=$E(X,3,$L(X))
"RTN","BPSOS03",73,0)
 S X=$$DFF2EXT(X)
"RTN","BPSOS03",74,0)
 Q X
"RTN","BPSOS2")
0^65^B24595196
"RTN","BPSOS2",1,0)
BPSOS2 ;BHAM ISC/FCS/DRS - ECME manager's ScreenMan ;06/01/2004    
"RTN","BPSOS2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS2",3,0)
 ;
"RTN","BPSOS2",4,0)
 ; SEE code at tag HELP - is this an entry point we can use?
"RTN","BPSOS2",5,0)
 ;
"RTN","BPSOS2",6,0)
 ; ALL writes of screen lines should be done as follows:
"RTN","BPSOS2",7,0)
 ;  IF $$VISIBLE(line) DO WRITE^VALM10(line)
"RTN","BPSOS2",8,0)
 ;  Then NODISPLY can be set so that $$VISIBLE always returns FALSE
"RTN","BPSOS2",9,0)
 ;
"RTN","BPSOS2",10,0)
 ; option BPS MANAGER SCREEN
"RTN","BPSOS2",11,0)
 D EN^BPSOS2() Q
"RTN","BPSOS2",12,0)
 ;; ;
"RTN","BPSOS2",13,0)
ERROR D FULL^VALM1 Q  ; what's a ^%ZOSF way to ZQUIT ?
"RTN","BPSOS2",14,0)
EN() ;EP - main entry point for list template BPS STATISTICS AND MANAGEMENT
"RTN","BPSOS2",15,0)
 N BASE,CURR,DISP,AVG,CHG
"RTN","BPSOS2",16,0)
 ; BASE(*) = base values, from when zeroed things out
"RTN","BPSOS2",17,0)
 ; CURR(*) = current values, from most recent read
"RTN","BPSOS2",18,0)
 ; CHG(*) = changed value to print, if any
"RTN","BPSOS2",19,0)
 N LOCK S LOCK=1 ; should we lock stats when we fetch?
"RTN","BPSOS2",20,0)
 D MYPARAMS
"RTN","BPSOS2",21,0)
 D FETCHES(0) ; fetch stats into CURR() array - possibly reset BASE array
"RTN","BPSOS2",22,0)
 M CHG=CURR
"RTN","BPSOS2",23,0)
 D DIFF
"RTN","BPSOS2",24,0)
 S ^TMP("BPSOS2",$J,"FREQ")=30 ;
"RTN","BPSOS2",25,0)
 I $P($G(^BPSECX("S",1,0)),U,2)="" D
"RTN","BPSOS2",26,0)
 .N %,%H,%I,X D NOW^%DTC S $P(^BPSECX("S",1,0),U,2)=%
"RTN","BPSOS2",27,0)
 D EN^VALM("BPS STATISTICS AND MANAGEMENT")
"RTN","BPSOS2",28,0)
 Q
"RTN","BPSOS2",29,0)
INIT ; -- init variables and list array
"RTN","BPSOS2",30,0)
 N NODISPLY S NODISPLY=1
"RTN","BPSOS2",31,0)
 D MYPARAMS
"RTN","BPSOS2",32,0)
 D CLEAN^VALM10
"RTN","BPSOS2",33,0)
 S VALMCNT=0 ; 0 lines so far
"RTN","BPSOS2",34,0)
 D LABELS^BPSOS2C
"RTN","BPSOS2",35,0)
 D HDR
"RTN","BPSOS2",36,0)
 D FETCHES(1) ; set up CURR 
"RTN","BPSOS2",37,0)
 M CHG=CURR
"RTN","BPSOS2",38,0)
 D DIFF ; compute DIFF = differences and changed ones go into CHG
"RTN","BPSOS2",39,0)
 D VALUES^BPSOS2B ; displays whatever's in CHG() and kills it off
"RTN","BPSOS2",40,0)
 Q
"RTN","BPSOS2",41,0)
 ;
"RTN","BPSOS2",42,0)
 ; Define Current (CURR) array and reset BASE
"RTN","BPSOS2",43,0)
 ; 
"RTN","BPSOS2",44,0)
 ; Input variable -> B = 0 Reset (kill) BASE values and retrieve
"RTN","BPSOS2",45,0)
 ;                         values
"RTN","BPSOS2",46,0)
 ;                       1 Just retrieve current values
"RTN","BPSOS2",47,0)
FETCHES(B)         N DST
"RTN","BPSOS2",48,0)
 ; 
"RTN","BPSOS2",49,0)
 S DST="CURR"
"RTN","BPSOS2",50,0)
 S ^TMP("BPSOS2",$J,"$H",DST)=$H
"RTN","BPSOS2",51,0)
 D FETCH58(DST_"(""COMM"")")
"RTN","BPSOS2",52,0)
 D FETSTAT(DST_"(""STAT"")")
"RTN","BPSOS2",53,0)
 D FETPKTQ(DST_"(""PKTQ"")")
"RTN","BPSOS2",54,0)
 ;
"RTN","BPSOS2",55,0)
 ;If entering option or resetting permanent values clear base
"RTN","BPSOS2",56,0)
 I B=0 K BASE S ^TMP("BPSOS2",$J,"$H","BASE")=$H
"RTN","BPSOS2",57,0)
 Q
"RTN","BPSOS2",58,0)
DIFF ;EP - from BPSOS2A
"RTN","BPSOS2",59,0)
 N A,B S A=""
"RTN","BPSOS2",60,0)
 F  S A=$O(CURR(A)) Q:A=""  S B="" F  S B=$O(CURR(A,B)) Q:B=""  D
"RTN","BPSOS2",61,0)
 .I A="STAT" S CHG(A,B)=CURR(A,B)
"RTN","BPSOS2",62,0)
 .I A="COMM" S CHG(A,B)=CURR(A,B)-$G(BASE(A,B))
"RTN","BPSOS2",63,0)
 ;
"RTN","BPSOS2",64,0)
 Q
"RTN","BPSOS2",65,0)
UPD1 ; one update cycle
"RTN","BPSOS2",66,0)
 N A,B,T
"RTN","BPSOS2",67,0)
 D FETCHES(1) ; fetch into CURR array
"RTN","BPSOS2",68,0)
 D DIFF ; compute differences
"RTN","BPSOS2",69,0)
 D VALUES^BPSOS2B ; compute values and display if changed
"RTN","BPSOS2",70,0)
 Q
"RTN","BPSOS2",71,0)
HDT(X) ; first convert fileman date-time to $H format, then $$H it
"RTN","BPSOS2",72,0)
 N %H,%T,%Y D H^%DTC S X=$P(X,".",2)
"RTN","BPSOS2",73,0)
 Q $$H(%H_","_($E(X,1,2)*3600+($E(X,3,4)*60)+$E(X,5,6)))
"RTN","BPSOS2",74,0)
H(H) S:'$D(H) H=$H Q $P(H,",")-58000*86400+$P(H,",",2) ; $$H seconds
"RTN","BPSOS2",75,0)
FETCH58(DST)         ; send DST = closed root of the destination
"RTN","BPSOS2",76,0)
 K @DST
"RTN","BPSOS2",77,0)
 N FN,DIC,DR,DA,DIQ,TMP ; note that DA=1 is hardcoded
"RTN","BPSOS2",78,0)
 S @DST@("$$H")=$$H
"RTN","BPSOS2",79,0)
 S (FN,DIC)=9002313.58,DR="1:10000",DIQ="TMP(",DA=1
"RTN","BPSOS2",80,0)
 I LOCK L +^BPS(FN):300
"RTN","BPSOS2",81,0)
 D EN^DIQ1
"RTN","BPSOS2",82,0)
 I LOCK L -^BPS(FN)
"RTN","BPSOS2",83,0)
 M @DST=TMP(FN,1)
"RTN","BPSOS2",84,0)
 I $P($G(^BPSECX("S",1,0)),U,2)'="" D
"RTN","BPSOS2",85,0)
 .  S @DST@(2)=$P(^BPSECX("S",1,0),U,2) ; overwrite w/internal form
"RTN","BPSOS2",86,0)
 .  S @DST@(2)=$$HDT(@DST@(2))
"RTN","BPSOS2",87,0)
 Q
"RTN","BPSOS2",88,0)
FETSTAT(DEST)       ;EP - from BPSOSIW
"RTN","BPSOS2",89,0)
 ; send DEST = closed root of the destination
"RTN","BPSOS2",90,0)
 K @DEST
"RTN","BPSOS2",91,0)
 S @DEST@("$$H")=$$H
"RTN","BPSOS2",92,0)
 I LOCK LOCK +^BPST
"RTN","BPSOS2",93,0)
 N Q,N,A F Q=0:10:90,19,31,51 D
"RTN","BPSOS2",94,0)
 .S A="" F N=0:1 S A=$O(^BPST("AD",Q,A)) Q:A=""
"RTN","BPSOS2",95,0)
 . I Q#10 S @DEST@(Q\10*10)=@DEST@(Q\10*10)+N
"RTN","BPSOS2",96,0)
 . E  S @DEST@(Q)=N ; relies on multiples of 10 coming first!
"RTN","BPSOS2",97,0)
 I LOCK LOCK -^BPST
"RTN","BPSOS2",98,0)
 Q
"RTN","BPSOS2",99,0)
FETPKTQ(DEST)      ;EP - from BPSOSIW,BPSOSRB
"RTN","BPSOS2",100,0)
 ; send DEST = closed root of the destination
"RTN","BPSOS2",101,0)
 ; send LOCK = true if you want to lock all the queues (for exact count)
"RTN","BPSOS2",102,0)
 ; ^BPSECX("POS",psetien,"C",n) and "R"
"RTN","BPSOS2",103,0)
 ; @DEST@("C",PSetIEN) = packets waiting to send
"RTN","BPSOS2",104,0)
 ; @DEST@("C")=total of all the "C" counts
"RTN","BPSOS2",105,0)
 ; @DEST@("R",PSetIEN) = packets received awaiting receive processing
"RTN","BPSOS2",106,0)
 ; @DEST@("R")=total
"RTN","BPSOS2",107,0)
 K @DEST
"RTN","BPSOS2",108,0)
 S @DEST@("$$H")=$$H,(@DEST@("C"),@DEST@("R"))=0
"RTN","BPSOS2",109,0)
 ; Would need to do similarly for each PSetIEN value too INCOMPLETE
"RTN","BPSOS2",110,0)
 I LOCK LOCK +^BPSECX("POS")
"RTN","BPSOS2",111,0)
 N A,B,C,N,P,X
"RTN","BPSOS2",112,0)
 S A="" F  S A=$O(^BPSECX("POS",A)) Q:A=""  D
"RTN","BPSOS2",113,0)
 .F B="C","R" D
"RTN","BPSOS2",114,0)
 ..S C="" F N=0:1 S C=$O(^BPSECX("POS",A,B,C)) Q:C=""
"RTN","BPSOS2",115,0)
 ..S @DEST@(B,A)=N
"RTN","BPSOS2",116,0)
 ..S @DEST@(B)=$G(@DEST@(B))+N
"RTN","BPSOS2",117,0)
 I LOCK LOCK -^BPSECX("POS")
"RTN","BPSOS2",118,0)
 Q
"RTN","BPSOS2",119,0)
MYPARAMS ;
"RTN","BPSOS2",120,0)
 Q
"RTN","BPSOS2",121,0)
UPDFREQ() ;
"RTN","BPSOS2",122,0)
 Q 15 ; every fifteen seconds is the usual case
"RTN","BPSOS2",123,0)
 ;
"RTN","BPSOS2",124,0)
CLEARAT()          ;
"RTN","BPSOS2",125,0)
 S Y=$P(^BPSECX("S",1,0),U,2) X ^DD("DD") Q Y
"RTN","BPSOS2",126,0)
HDR ; -- header code
"RTN","BPSOS2",127,0)
 S VALMHDR(1)="Communications statistics last cleared on "_$$CLEARAT
"RTN","BPSOS2",128,0)
 S XQORM("B")="CU" ; the default is Update Continuously
"RTN","BPSOS2",129,0)
 S XQORM("B")="U1" ; but we'd like to do U1 continuously from top lvl
"RTN","BPSOS2",130,0)
 Q
"RTN","BPSOS2",131,0)
 ;
"RTN","BPSOS2",132,0)
UPD ;EP - From BPSOS2A ; Protocol BPS P2 UPDATE
"RTN","BPSOS2",133,0)
 D UPDATE(1) S VALMBCK="",XQORM("B")="U1" Q  ; ABSB RXE ECME P2 UPDATE
"RTN","BPSOS2",134,0)
CONTUPD ; Protocol BPS P2 CONTINUOUS
"RTN","BPSOS2",135,0)
 W !!!!! D UPDATE(-1) S VALMBCK="" Q  ; ABSB RXE ECME P2 CONTINUOUS
"RTN","BPSOS2",136,0)
UPDATE(COUNTER)       ; with COUNTER = a count down
"RTN","BPSOS2",137,0)
 N STOP F  D  Q:$G(STOP)
"RTN","BPSOS2",138,0)
 .D UPD1
"RTN","BPSOS2",139,0)
 .S COUNTER=COUNTER-1 I 'COUNTER S STOP=1 Q
"RTN","BPSOS2",140,0)
 .I '$G(NODISPLY) D
"RTN","BPSOS2",141,0)
 ..D MSG^VALM10("In continuous update mode: press Q to Quit")
"RTN","BPSOS2",142,0)
 ..N X S X=$$READ^XGKB(1,$$UPDFREQ) D MSG^VALM10(" ")
"RTN","BPSOS2",143,0)
 ..I '$G(DTOUT),X]"","Qq^^"[X S STOP=1
"RTN","BPSOS2",144,0)
 ..N Y F  R Y:0 Q:'$T  ; clean out typeahead (like mistaken arrow keys)
"RTN","BPSOS2",145,0)
 ..; But if timed out, keep looping and updating
"RTN","BPSOS2",146,0)
 Q
"RTN","BPSOS2",147,0)
HELP ; -- help code
"RTN","BPSOS2",148,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSOS2",149,0)
 Q
"RTN","BPSOS2",150,0)
 ;
"RTN","BPSOS2",151,0)
EXIT ; -- exit code
"RTN","BPSOS2",152,0)
 D FULL^VALM1
"RTN","BPSOS2",153,0)
 Q
"RTN","BPSOS2",154,0)
 ;
"RTN","BPSOS2",155,0)
EXPND ; -- expand code
"RTN","BPSOS2",156,0)
 Q
"RTN","BPSOS25")
0^66^B36446376
"RTN","BPSOS25",1,0)
BPSOS25 ;BHAM ISC/FCS/DRS - insurance auto-selection ;06/01/2004
"RTN","BPSOS25",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS25",3,0)
 ; Changed: ECME always used ^BPSCOMB, regardless of ILC presence
"RTN","BPSOS25",4,0)
 Q
"RTN","BPSOS25",5,0)
 ; Called from:
"RTN","BPSOS25",6,0)
 ;   BPSOSQB as called from BPSOSQ1
"RTN","BPSOS25",7,0)
 ;   BPSOSI8 - Screenman input
"RTN","BPSOS25",8,0)
 ;   BPSOSD1 - find unbilled prescriptions
"RTN","BPSOS25",9,0)
 ;   BPSOS28 - development, research
"RTN","BPSOS25",10,0)
 ;   BPSOS32 - survey insurers
"RTN","BPSOS25",11,0)
 ;
"RTN","BPSOS25",12,0)
 ;----------------------------------------------------------
"RTN","BPSOS25",13,0)
 ;IHS/SD/lwj 8/28/02 Reversed the order of TMP used within the 
"RTN","BPSOS25",14,0)
 ;INSURER subroutine.  This reversed order is done to simplify 
"RTN","BPSOS25",15,0)
 ;processing of the array and to comply with Cache systems.
"RTN","BPSOS25",16,0)
 ;
"RTN","BPSOS25",17,0)
 ;----------------------------------------------------------
"RTN","BPSOS25",18,0)
 ;
"RTN","BPSOS25",19,0)
INSURER(ARRAY,FRESH,MAXARRAY,FORRX)    ;EP
"RTN","BPSOS25",20,0)
 ; pass ARRAY by reference (.ARRAY)
"RTN","BPSOS25",21,0)
 ; given ABSBVISI, ABSBPATI, ABSBRXI, ABSBRXR
"RTN","BPSOS25",22,0)
 ; $G(FRESH) true if you want to see all insurances, not just
"RTN","BPSOS25",23,0)
 ;   what's in the default order of billing for this visit
"RTN","BPSOS25",24,0)
 ;   (to be implemented - relevant to ILC new A/R package only)
"RTN","BPSOS25",25,0)
 ;   Default is FRESH = 1 = true
"RTN","BPSOS25",26,0)
 ; $G(MAXARRAY) if you want no more than this many to be returned
"RTN","BPSOS25",27,0)
 ;   Default is 0 = no limit
"RTN","BPSOS25",28,0)
 ;   Working copy of array may be larger than what you specify.
"RTN","BPSOS25",29,0)
 ; ABSBRXI, ABSBRXR needed only for precision in date filled;
"RTN","BPSOS25",30,0)
 ;  you can send them as both false and ABSBVISI date will be used.
"RTN","BPSOS25",31,0)
 ; FORRX = true if this is being called for pharmacy (default = TRUE)
"RTN","BPSOS25",32,0)
 ;
"RTN","BPSOS25",33,0)
 ; Fill ARRAY(n) with InsurerIEN^PINS piece^BPSCOMB n^score^rules
"RTN","BPSOS25",34,0)
 ;      InsurerIEN points to ^AUTNINS(*)
"RTN","BPSOS25",35,0)
 ;      PINS piece is   type,D0,D1
"RTN","BPSOS25",36,0)
 ;          D1 = pointer to subindex of AUPNPRVT; 0 for caid, care
"RTN","BPSOS25",37,0)
 ;      BPSCOMB n pointer to ^BPSCOMB(ABSBPATI,1,*)v
"RTN","BPSOS25",38,0)
 ;      score = how many points scored in ranking the insurances
"RTN","BPSOS25",39,0)
 ;      RULES = ";"-delimited list of rules which affected this choice
"RTN","BPSOS25",40,0)
 ;
"RTN","BPSOS25",41,0)
 ; and set ARRAY(0)=count^count of prvt^count of care^count of caid
"RTN","BPSOS25",42,0)
 ; Set ARRAY("ORDER")=$$ returned value from BPSOS26
"RTN","BPSOS25",43,0)
A ;
"RTN","BPSOS25",44,0)
 N ONDATE
"RTN","BPSOS25",45,0)
 I '$D(FRESH) S FRESH=1
"RTN","BPSOS25",46,0)
 I '$G(MAXARRAY) S MAXARRAY=3 ; send MAXARRAY=0 same as "no limit"
"RTN","BPSOS25",47,0)
 I '$D(FORRX) S FORRX=1
"RTN","BPSOS25",48,0)
 K ARRAY S ARRAY(0)=0
"RTN","BPSOS25",49,0)
 I '$D(DEBUG) N DEBUG S DEBUG=0
"RTN","BPSOS25",50,0)
 E  I DEBUG D
"RTN","BPSOS25",51,0)
 . W $T(+0)," for ABSBVISI=",$G(ABSBVISI),", ABSBPATI=",ABSBPATI
"RTN","BPSOS25",52,0)
 . W ", ABSBRXI=",ABSBRXI,", ABSBRXR=",ABSBRXR
"RTN","BPSOS25",53,0)
 . W !
"RTN","BPSOS25",54,0)
 ;
"RTN","BPSOS25",55,0)
 ; BPSOS29 is different from VTLCOMB in that BPSOS29 takes the
"RTN","BPSOS25",56,0)
 ;   Medicaid FI field into account - BPSOS29 translates the IEN 3
"RTN","BPSOS25",57,0)
 ;   into a specific state's IEN. (But site-specific switchable)
"RTN","BPSOS25",58,0)
B ;
"RTN","BPSOS25",59,0)
 D  ; everybody does the ECME version:
"RTN","BPSOS25",60,0)
 . D EN^BPSOS29(ABSBPATI) ; copied from VTLCOMB but in BPSOS namespace
"RTN","BPSOS25",61,0)
 ;
"RTN","BPSOS25",62,0)
 ; We are interested in eligibility on the date filled
"RTN","BPSOS25",63,0)
 ; (Or visit date, if date filled is missing or not supplied)
"RTN","BPSOS25",64,0)
 ; (Or just take DT, if you don't even have a visit pointer)
"RTN","BPSOS25",65,0)
 ;
"RTN","BPSOS25",66,0)
 I ABSBRXR S ONDATE=$P(^PSRX(ABSBRXI,1,ABSBRXR,0),U)
"RTN","BPSOS25",67,0)
 E  I ABSBRXI S ONDATE=$P(^PSRX(ABSBRXI,2),U,2)
"RTN","BPSOS25",68,0)
 E  S ONDATE=0
"RTN","BPSOS25",69,0)
 I 'ONDATE S ONDATE=DT
"RTN","BPSOS25",70,0)
 D GATHER ; PRVT, CAID, and CARE types into ARRAY()
"RTN","BPSOS25",71,0)
 D SELF ; tack on a SELF PAY at the end
"RTN","BPSOS25",72,0)
F ;
"RTN","BPSOS25",73,0)
 ; Now all of the insurances are in the array with initial scores.
"RTN","BPSOS25",74,0)
 ; Adjust the scores based on the rules in effect for this site.
"RTN","BPSOS25",75,0)
 ;
"RTN","BPSOS25",76,0)
 N ORDER,IEN,RULE,ROUTINE,PTSPLUS,PTSMINUS,STOP S (ORDER,STOP)=""
"RTN","BPSOS25",77,0)
 F  D  Q:ORDER=""
"RTN","BPSOS25",78,0)
 . S ORDER=$O(^BPS(9002313.99,1,"INS RULES","B",ORDER))
"RTN","BPSOS25",79,0)
 . Q:ORDER=""  S IEN=""
"RTN","BPSOS25",80,0)
 . F  D  Q:IEN=""
"RTN","BPSOS25",81,0)
 . . S IEN=$O(^BPS(9002313.99,1,"INS RULES","B",ORDER,IEN))
"RTN","BPSOS25",82,0)
 . . I IEN="" Q
"RTN","BPSOS25",83,0)
 . . N X S X=^BPS(9002313.99,1,"INS RULES",IEN,0)
"RTN","BPSOS25",84,0)
 . . S RULE=$P(X,U,2),PTSPLUS=$P(X,U,3),PTSMINUS=$P(X,U,4)
"RTN","BPSOS25",85,0)
 . . S ROUTINE=$TR($P(^BPSF(9002313.94,RULE,0),U,2),"~","^")
"RTN","BPSOS25",86,0)
 . . ; these rules are all in BPSOS26, at least to start with
"RTN","BPSOS25",87,0)
 . . X "DO "_ROUTINE_"(.ARRAY,ABSBPATI,ABSBVISI,PTSPLUS,PTSMINUS)"
"RTN","BPSOS25",88,0)
 ;
"RTN","BPSOS25",89,0)
 ; Finally, put the insurances in order of their scores
"RTN","BPSOS25",90,0)
 ; IHS/SD/lwj 8/28/02 reversed order of TMP for easier reading
"RTN","BPSOS25",91,0)
 ; add to comply with Cache systems
"RTN","BPSOS25",92,0)
 N TMP,I,II,PTS F I=1:1:ARRAY(0) D
"RTN","BPSOS25",93,0)
 . S PTS=$P(ARRAY(I),U,4)
"RTN","BPSOS25",94,0)
 . I PTS<0 D  Q  ; negative points and you don't get considered
"RTN","BPSOS25",95,0)
 . . I $G(DEBUG) W "Not counting ARRAY(",I,")=",ARRAY(I),!
"RTN","BPSOS25",96,0)
 . S TMP(0-PTS,I)=ARRAY(I)  ;reverse for Cache 
"RTN","BPSOS25",97,0)
 K ARRAY
"RTN","BPSOS25",98,0)
 ;IHS/SD/lwj 8/28/02 Cache cannot handle a reverse $O on arrays
"RTN","BPSOS25",99,0)
 ; so we reversed the order of the TMP array and can now simply
"RTN","BPSOS25",100,0)
 S PTS="",II=0 F  S PTS=$O(TMP(PTS)) Q:PTS=""  D   ;in high to low now
"RTN","BPSOS25",101,0)
 . S I=0 F  S I=$O(TMP(PTS,I)) Q:'I  D
"RTN","BPSOS25",102,0)
 . . S X=TMP(PTS,I) Q:$P(X,U,4)<0
"RTN","BPSOS25",103,0)
 . . S II=II+1,ARRAY(II)=TMP(PTS,I)
"RTN","BPSOS25",104,0)
 S ARRAY(0)=II
"RTN","BPSOS25",105,0)
 ; Since we did a NEW() earlier, junk like II, TMP, etc. is deleted.
"RTN","BPSOS25",106,0)
 Q ARRAY(0)
"RTN","BPSOS25",107,0)
 ;
"RTN","BPSOS25",108,0)
GRACE(INSIEN)     ; 
"RTN","BPSOS25",109,0)
 N RET S RET=$P($G(^BPSEI(INSIEN,100)),U,8)
"RTN","BPSOS25",110,0)
 I RET="" S RET=$P($G(^BPS(9002313.99,"INS")),U)
"RTN","BPSOS25",111,0)
 I RET="" S RET=30 ; the default default
"RTN","BPSOS25",112,0)
 Q RET
"RTN","BPSOS25",113,0)
SELF ; add SELF PAY to the list
"RTN","BPSOS25",114,0)
 N INSIEN
"RTN","BPSOS25",115,0)
 S INSIEN=$P($G(^BPS(9002313.99,1,0)),U,5)
"RTN","BPSOS25",116,0)
 I 'INSIEN Q
"RTN","BPSOS25",117,0)
 D ADD(INSIEN,"SELF PAY","",$$TYPEPTS("SELF"))
"RTN","BPSOS25",118,0)
 Q
"RTN","BPSOS25",119,0)
ILCAR() Q $P(^BPS(9002313.99,1,"A/R INTERFACE"),U)=0 ; is ILC A/R pkg here?
"RTN","BPSOS25",120,0)
GATHER ; return the count of how many of these we put in the array
"RTN","BPSOS25",121,0)
 N COUNT,DFN,X S (COUNT,DFN)=0
"RTN","BPSOS25",122,0)
 F  S DFN=$O(^BPSCOMB(ABSBPATI,1,DFN)) Q:'DFN  D
"RTN","BPSOS25",123,0)
 . S X=^BPSCOMB(ABSBPATI,1,DFN,0)
"RTN","BPSOS25",124,0)
 . N INSIEN,TYPE S INSIEN=$P(X,U),TYPE=$P(X,U,2)
"RTN","BPSOS25",125,0)
 . N POINTS S POINTS=$$TYPEPTS(TYPE) ; based on type, how many pts 
"RTN","BPSOS25",126,0)
 . S POINTS=DFN/10000+POINTS ;higher DFN is most recent, give it an edge
"RTN","BPSOS25",127,0)
 . S POINTS=POINTS+$P($G(^BPSEI(INSIEN,104)),U) ; insurer's delta value
"RTN","BPSOS25",128,0)
 . ; Check RX BILLING STATUS for this insurer - may be "U" = unbillable
"RTN","BPSOS25",129,0)
 . ; There's also a field in the ^AUPNPRVT record about RX billing
"RTN","BPSOS25",130,0)
 . ; if it's unbillable for RX, give it a score of -1000
"RTN","BPSOS25",131,0)
 . ; Keep it in the array because some rules may need to refer to it.
"RTN","BPSOS25",132,0)
 . ; (Example:  SEARHC0^BPSOS26)
"RTN","BPSOS25",133,0)
 . I FORRX,'$$DRUGCOVG(ABSBPATI,$P(X,U,10)) S POINTS=-1000
"RTN","BPSOS25",134,0)
 . I '$$ELGDATE($P(X,U,5,6),INSIEN) D:DEBUG>99  Q  ; it's expired
"RTN","BPSOS25",135,0)
 . D ADD(INSIEN,$P(X,U,2)_","_$P(X,U,9)_","_$P(X,U,10),DFN,POINTS)
"RTN","BPSOS25",136,0)
 . S COUNT=COUNT+1
"RTN","BPSOS25",137,0)
 Q ARRAY(0)
"RTN","BPSOS25",138,0)
TYPEPTS(TYPE)      ;
"RTN","BPSOS25",139,0)
 N X S X=$G(^BPS(9002313.99,1,"INS BASE SCORES"))
"RTN","BPSOS25",140,0)
 I TYPE="PRVT" Q +$P(X,U)
"RTN","BPSOS25",141,0)
 I TYPE="CARE" Q +$P(X,U,2)
"RTN","BPSOS25",142,0)
 I TYPE="CAID" Q +$P(X,U,3)
"RTN","BPSOS25",143,0)
 I TYPE="RR" Q +$P(X,U,4)
"RTN","BPSOS25",144,0)
 I TYPE="SELF" Q +$P(X,U,5)
"RTN","BPSOS25",145,0)
 D IMPOSS^BPSOSUE("DB","TI","type of insurance",,"TYPEPTS",$T(+0))
"RTN","BPSOS25",146,0)
 Q 0 ; if you ignore
"RTN","BPSOS25",147,0)
ELGDATE(FROMTO,INSIEN)          ; does ONDATE fall in the FROM^TO range?
"RTN","BPSOS25",148,0)
 ; need INSIEN, too!  for $$ADDGRACE
"RTN","BPSOS25",149,0)
 I DEBUG>99 D
"RTN","BPSOS25",150,0)
 . N DEBUG S DEBUG=0
"RTN","BPSOS25",151,0)
 . W "$$ELGDATE(",FROMTO,") testing for ONDATE=",ONDATE,"..."
"RTN","BPSOS25",152,0)
 . W $$ELGDATE(FROMTO),!
"RTN","BPSOS25",153,0)
 N FROM,TO S FROM=$P(FROMTO,U),TO=$P(FROMTO,U,2)
"RTN","BPSOS25",154,0)
 I FROM,ONDATE<FROM Q 0
"RTN","BPSOS25",155,0)
 I 'TO Q 1
"RTN","BPSOS25",156,0)
 I ONDATE'>TO Q 1
"RTN","BPSOS25",157,0)
 I $G(INSIEN),ONDATE'>$$ADDGRACE(TO,INSIEN) Q 1
"RTN","BPSOS25",158,0)
 Q 0
"RTN","BPSOS25",159,0)
ADDGRACE(X1,INSIEN)     ; add grace period to the given date ; have INSIEN set, too
"RTN","BPSOS25",160,0)
 N X2,X,%H S X2=$$GRACE(INSIEN) D C^%DTC
"RTN","BPSOS25",161,0)
 Q X
"RTN","BPSOS25",162,0)
 ;
"RTN","BPSOS25",163,0)
DRUGCOVG(D0,D1)    ;
"RTN","BPSOS25",164,0)
 I 'D1 Q 1 ; not private?  or no private pointer?
"RTN","BPSOS25",165,0)
 Q 1 ; didn't explictly say it doesn't cover drugs
"RTN","BPSOS25",166,0)
ADD(INSIEN,PINS,BPSCOMB,POINTS)   ;
"RTN","BPSOS25",167,0)
 I $P(PINS,",",3)="" S $P(PINS,",",3)=0
"RTN","BPSOS25",168,0)
 S ARRAY(0)=ARRAY(0)+1
"RTN","BPSOS25",169,0)
 S ARRAY(ARRAY(0))=INSIEN_U_PINS_U_BPSCOMB_U_POINTS
"RTN","BPSOS25",170,0)
 Q
"RTN","BPSOS29")
0^69^B7729677
"RTN","BPSOS29",1,0)
BPSOS29 ;BHAM ISC/FCS/DRS/DLF - BUILD COMBINED INSURANCE ;06/01/2004
"RTN","BPSOS29",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS29",3,0)
 ; 
"RTN","BPSOS29",4,0)
 ; Copied from VTLCOMB on 08/18/2000
"RTN","BPSOS29",5,0)
 ; Removed $ZT="DX^KCRZT"
"RTN","BPSOS29",6,0)
 ; Verified no other instances of "KCR" or "VTL"
"RTN","BPSOS29",7,0)
 ;
"RTN","BPSOS29",8,0)
 ; DRS 10/16/2000   Follow the FI pointer 
"RTN","BPSOS29",9,0)
 ;   in ^AUTNINS(insurer,13,state,0),U,2) right now.
"RTN","BPSOS29",10,0)
 ;   Site-selectable switch for this, though it perhaps isn't
"RTN","BPSOS29",11,0)
 ;   in the setup routines.  See $$USEFI, below.
"RTN","BPSOS29",12,0)
 ;   This was done because Pawhuska has ^AUTNINS(3,), MEDICAID,
"RTN","BPSOS29",13,0)
 ;   set to not billable for RX.  But if you follow the pointer
"RTN","BPSOS29",14,0)
 ;   to Oklahoma Medicaid, that one is billable.
"RTN","BPSOS29",15,0)
 ; This sets the right medicaid insurer from the very beginning.
"RTN","BPSOS29",16,0)
 ;
"RTN","BPSOS29",17,0)
 ;** vtl 6/26/00 - get elig dates from Pvt Ins. file
"RTN","BPSOS29",18,0)
 ;
"RTN","BPSOS29",19,0)
 ;** this program will search the three files containing insurance
"RTN","BPSOS29",20,0)
 ;   information. 1: Private Insurance Eligible
"RTN","BPSOS29",21,0)
 ;                2: Medicare Eligible
"RTN","BPSOS29",22,0)
 ;                3: Medicaid Eligible
"RTN","BPSOS29",23,0)
 ;** It will update ^BPSCOMB with the data found
"RTN","BPSOS29",24,0)
 ;------------------------------------------------------------------
"RTN","BPSOS29",25,0)
EN(PATDFN)         ;EP - from BPSOS25
"RTN","BPSOS29",26,0)
 ;
"RTN","BPSOS29",27,0)
 N ARRAY,BEGDAT,CAIDDFN,CAIDNAM,CAREDFN,CARENAM,CNT,D1,DA,DIK,DIQUIET
"RTN","BPSOS29",28,0)
 N ENDDAT,FILE,FILECNT,NUMBER,P1,P2,P3
"RTN","BPSOS29",29,0)
 N POLCOV,POLIEN,POLNAM,POLNUM,POLREL,POLSEX,PRVDFN,REC,SUFFIX
"RTN","BPSOS29",30,0)
 Q:'$G(PATDFN)
"RTN","BPSOS29",31,0)
 N DIQUIET,NUMBER
"RTN","BPSOS29",32,0)
 S DIQUIET=1 D DT^DICRW
"RTN","BPSOS29",33,0)
 S NUMBER=0
"RTN","BPSOS29",34,0)
 D PRIVATE
"RTN","BPSOS29",35,0)
 D MEDICAID
"RTN","BPSOS29",36,0)
 D MEDICARE
"RTN","BPSOS29",37,0)
 D UPDATE
"RTN","BPSOS29",38,0)
 Q
"RTN","BPSOS29",39,0)
TRANSFI(INSDFN,STATE)    ; translate based on the Medicaid FI field
"RTN","BPSOS29",40,0)
 I '$$USEFI Q INSDFN ; flag is set to NOT do the translation
"RTN","BPSOS29",41,0)
 Q $S(X:X,1:INSDFN)
"RTN","BPSOS29",42,0)
USEFI() Q '$P($G(^BPS(9002313.99,1,"INS")),U,3)
"RTN","BPSOS29",43,0)
 ;---------------------------------------------------------------
"RTN","BPSOS29",44,0)
PRIVATE ;
"RTN","BPSOS29",45,0)
 ;** scan the Private Insurance Eligible file
"RTN","BPSOS29",46,0)
 Q:'PRVDFN
"RTN","BPSOS29",47,0)
 S FILE="",D1=0
"RTN","BPSOS29",48,0)
 Q
"RTN","BPSOS29",49,0)
 ;---------------------------------------------------------------
"RTN","BPSOS29",50,0)
MEDICAID ;
"RTN","BPSOS29",51,0)
 S FILE=""
"RTN","BPSOS29",52,0)
 S CAIDDFN=0
"RTN","BPSOS29",53,0)
 Q
"RTN","BPSOS29",54,0)
 ;---------------------------------------------------------------
"RTN","BPSOS29",55,0)
MEDICARE ;
"RTN","BPSOS29",56,0)
 S FILE=""
"RTN","BPSOS29",57,0)
 Q:'CAREDFN
"RTN","BPSOS29",58,0)
 S NUMBER=NUMBER+1
"RTN","BPSOS29",59,0)
 S INSDFN=$P(REC,U,2)
"RTN","BPSOS29",60,0)
 S POLNUM=$P(REC,U,3)
"RTN","BPSOS29",61,0)
 S SUFFIX=$P(REC,U,4)
"RTN","BPSOS29",62,0)
 S POLNAM=""
"RTN","BPSOS29",63,0)
 S POLIEN=""
"RTN","BPSOS29",64,0)
 S (BEGDAT,ENDDAT)=""
"RTN","BPSOS29",65,0)
 S ARRAY(NUMBER)=INSDFN_U_"CARE"_U_CARENAM_U_POLNUM_U_BEGDAT_U_ENDDAT_U_POLIEN_U_FILE_U_CAREDFN_U_U_POLREL
"RTN","BPSOS29",66,0)
 Q
"RTN","BPSOS29",67,0)
 ;---------------------------------------------------------------
"RTN","BPSOS29",68,0)
UPDATE ;
"RTN","BPSOS29",69,0)
 Q:'$D(ARRAY)
"RTN","BPSOS29",70,0)
 F  L +^BPSCOMB(0):10 Q:$T
"RTN","BPSOS29",71,0)
 S FILECNT=$P(^BPSCOMB(0),U,4)
"RTN","BPSOS29",72,0)
 I '$D(^BPSCOMB(PATDFN)) S FILECNT=FILECNT+1
"RTN","BPSOS29",73,0)
 S $P(^BPSCOMB(0),U,4)=FILECNT
"RTN","BPSOS29",74,0)
 S $P(^BPSCOMB(0),U,3)=PATDFN
"RTN","BPSOS29",75,0)
 L -^BPSCOMB(0)
"RTN","BPSOS29",76,0)
 K ^BPSCOMB(PATDFN,1)
"RTN","BPSOS29",77,0)
 S ^BPSCOMB(PATDFN,0)=PATDFN
"RTN","BPSOS29",78,0)
 S ^BPSCOMB("B",PATDFN,PATDFN)=""
"RTN","BPSOS29",79,0)
 S D1=0,CNT=0
"RTN","BPSOS29",80,0)
 F  S D1=$O(ARRAY(D1)) Q:'D1  DO
"RTN","BPSOS29",81,0)
 . S CNT=CNT+1
"RTN","BPSOS29",82,0)
 . S ^BPSCOMB(PATDFN,1,D1,0)=ARRAY(D1)
"RTN","BPSOS29",83,0)
 . S ^BPSCOMB(PATDFN,1,"B",$P(ARRAY(D1),U,1),D1)=""
"RTN","BPSOS29",84,0)
 . S P1=$P(ARRAY(D1),U,2),P2=$P(ARRAY(D1),U,9),P3=+$P(ARRAY(D1),U,10)
"RTN","BPSOS29",85,0)
 . S ^BPSCOMB(PATDFN,1,"AZ",P1,P2,P3,D1)=""
"RTN","BPSOS29",86,0)
 S ^BPSCOMB(PATDFN,1,0)="^9002313.11P^"_CNT_"^"_CNT
"RTN","BPSOS29",87,0)
 S DIK="^BPSCOMB(",DA=PATDFN D IX1^DIK
"RTN","BPSOS29",88,0)
 Q
"RTN","BPSOS2A")
0^70^B12848144
"RTN","BPSOS2A",1,0)
BPSOS2A ;BHAM ISC/FCS/DRS/DLF - continuation of BPSOS2 ;06/01/2004   
"RTN","BPSOS2A",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS2A",3,0)
 Q
"RTN","BPSOS2A",4,0)
JOBS ; protocol BPS P2 TMIT JOBS
"RTN","BPSOS2A",5,0)
 N WHAT S WHAT="Maximum number of transmitter-receiver jobs: "
"RTN","BPSOS2A",6,0)
 N PMT S PMT=WHAT
"RTN","BPSOS2A",7,0)
 S DEF=$$MAXJOBS^BPSOSQ3
"RTN","BPSOS2A",8,0)
 N OPT,MIN,MAX,DEC S OPT=1,MIN=1,MAX=10,DEC=0
"RTN","BPSOS2A",9,0)
 N ANS S ANS=$$NUMERIC^BPSOSU2(PMT,DEF,OPT,MIN,MAX,DEC)
"RTN","BPSOS2A",10,0)
 I ANS?1N.N D MAXJOBS^BPSOSQ3(ANS)
"RTN","BPSOS2A",11,0)
 S ANS=$$MAXJOBS^BPSOSQ3
"RTN","BPSOS2A",12,0)
 W !,WHAT," = ",ANS,!
"RTN","BPSOS2A",13,0)
 D ANY
"RTN","BPSOS2A",14,0)
 S VALMBCK=""
"RTN","BPSOS2A",15,0)
 Q
"RTN","BPSOS2A",16,0)
WOW ; protocol BPS P2 WINNOW ; Winnow or Erase data or Big erase data
"RTN","BPSOS2A",17,0)
 ; This is going to be put on the manager menu proper, instead.
"RTN","BPSOS2A",18,0)
 ; Re-development is underway in BPSOSK*
"RTN","BPSOS2A",19,0)
 W !,"This option is temporarily disabled.",! D ANY S VALMBCK="R" Q
"RTN","BPSOS2A",20,0)
 ;
"RTN","BPSOS2A",21,0)
 ;Statistics & Misc Options Screen - Zero Stats
"RTN","BPSOS2A",22,0)
 ;
"RTN","BPSOS2A",23,0)
 ;Protocol - BPS P2 ZERO - clearing stats
"RTN","BPSOS2A",24,0)
ZERO N ZTYP,X
"RTN","BPSOS2A",25,0)
 S ZTYP=$$SELZTYP() I ZTYP="^" W !!!,"Nothing changed.",! D ANY
"RTN","BPSOS2A",26,0)
 I ZTYP'="^" D
"RTN","BPSOS2A",27,0)
 .I $$SURE'=1 W !!!,"Nothing changed.",! D ANY Q
"RTN","BPSOS2A",28,0)
 .;
"RTN","BPSOS2A",29,0)
 .;Clear Local Stats
"RTN","BPSOS2A",30,0)
 .I ZTYP=0 D ZLOCAL
"RTN","BPSOS2A",31,0)
 .;
"RTN","BPSOS2A",32,0)
 .;Clear Permanent Stats
"RTN","BPSOS2A",33,0)
 .I ZTYP=1 D ZPERM,FETCHES^BPSOS2(0) ; fetch all these zeroes into BASE(*)
"RTN","BPSOS2A",34,0)
 D UPD^BPSOS2
"RTN","BPSOS2A",35,0)
 S VALMBCK=""
"RTN","BPSOS2A",36,0)
 Q
"RTN","BPSOS2A",37,0)
 ;
"RTN","BPSOS2A",38,0)
 ;Zero Local Statistics
"RTN","BPSOS2A",39,0)
 ;
"RTN","BPSOS2A",40,0)
 ;Reset Base Numbers to Current Numbers
"RTN","BPSOS2A",41,0)
ZLOCAL K BASE M BASE=CURR
"RTN","BPSOS2A",42,0)
 Q
"RTN","BPSOS2A",43,0)
 ;
"RTN","BPSOS2A",44,0)
 ;Zero Permanent Statistics
"RTN","BPSOS2A",45,0)
 ;
"RTN","BPSOS2A",46,0)
ZPERM N FILE S FILE=9002313.58
"RTN","BPSOS2A",47,0)
 L +^BPSECX("S"):300 I '$T W "LOCK failed",! Q
"RTN","BPSOS2A",48,0)
 D
"RTN","BPSOS2A",49,0)
 .N I F I=3,4 D
"RTN","BPSOS2A",50,0)
 . . N N S N=$P(^BPSECX("S",0),U,I)+1
"RTN","BPSOS2A",51,0)
 . . S $P(^BPSECX("S",0),U,I)=N
"RTN","BPSOS2A",52,0)
 . N N S N=$P(^BPSECX("S",0),U,3)
"RTN","BPSOS2A",53,0)
 .M ^BPSECX("S",N)=^BPSECX("S",1)
"RTN","BPSOS2A",54,0)
 .S $P(^BPSECX("S",N,0),U)=N ; fix up the .01 field
"RTN","BPSOS2A",55,0)
 .N DIK,DA S DIK="^BPSECX(""S"",",DA=N D IX^DIK ; trivial indexing
"RTN","BPSOS2A",56,0)
 N FIELD S FIELD=.01
"RTN","BPSOS2A",57,0)
 F  S FIELD=$O(^DD(FILE,FIELD)) Q:'FIELD  D
"RTN","BPSOS2A",58,0)
 .N VALUE
"RTN","BPSOS2A",59,0)
 .I FIELD=2 D  ; date/time last cleared
"RTN","BPSOS2A",60,0)
 ..N %,%H,%I,X D NOW^%DTC S VALUE=%
"RTN","BPSOS2A",61,0)
 .E  S VALUE=0
"RTN","BPSOS2A",62,0)
 .N DIE,DA,DR S DIE=FILE,DA=1,DR=FIELD_"////"_VALUE D ^DIE
"RTN","BPSOS2A",63,0)
 L -^BPSECX("S")
"RTN","BPSOS2A",64,0)
 Q
"RTN","BPSOS2A",65,0)
TMR ; Protocol BPS P2 TRANSMITTER ; Transmitter on/off
"RTN","BPSOS2A",66,0)
 N CURR S CURR=$$SHUTDOWN^BPSOSQ3 ; currently, the shutdown flag is:
"RTN","BPSOS2A",67,0)
 D TMNOW
"RTN","BPSOS2A",68,0)
 N PMT,DEF,OPT,ANS S PMT="Do you wish to "_$S(CURR:"en",1:"dis")
"RTN","BPSOS2A",69,0)
 S PMT=PMT_"able the transmitter-receiver"
"RTN","BPSOS2A",70,0)
 S DEF="N"
"RTN","BPSOS2A",71,0)
 S OPT=1
"RTN","BPSOS2A",72,0)
 S ANS=$$YESNO^BPSOSU3(PMT,DEF,OPT)
"RTN","BPSOS2A",73,0)
 I ANS=1 I $$SHUTDOWN^BPSOSQ3('CURR)
"RTN","BPSOS2A",74,0)
 S CURR=$$SHUTDOWN^BPSOSQ3
"RTN","BPSOS2A",75,0)
 D TMNOW,ANY
"RTN","BPSOS2A",76,0)
 S VALMBCK=""
"RTN","BPSOS2A",77,0)
 Q
"RTN","BPSOS2A",78,0)
TMNOW W !,"The transmitter-receiver is currently "
"RTN","BPSOS2A",79,0)
 W $S(CURR:"dis",1:"en"),"abled.",! Q
"RTN","BPSOS2A",80,0)
POK ; protocol BPS P2 POKE ; Poke the queues
"RTN","BPSOS2A",81,0)
 W !,"Poke the queues? " I $$SURE=1 D POKE^BPSOS2D
"RTN","BPSOS2A",82,0)
 S VALMBCK=""
"RTN","BPSOS2A",83,0)
 Q
"RTN","BPSOS2A",84,0)
 ;
"RTN","BPSOS2A",85,0)
 ;Prompt whether to delete (refresh) local or permanent copy
"RTN","BPSOS2A",86,0)
 ;
"RTN","BPSOS2A",87,0)
 ; Returns -> 0 = Local Copy
"RTN","BPSOS2A",88,0)
 ;            1 = Permanent Copy
"RTN","BPSOS2A",89,0)
 ;            ^ Quit
"RTN","BPSOS2A",90,0)
 ;            
"RTN","BPSOS2A",91,0)
SELZTYP() N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSOS2A",92,0)
 S DFLT="Local Copy"
"RTN","BPSOS2A",93,0)
 S DIR(0)="S^L:Local Copy;P:Permanent Copy",DIR("A")="Delete (L)ocal Copy or (P)ermanent Copy of the statistics",DIR("B")=DFLT
"RTN","BPSOS2A",94,0)
 D ^DIR
"RTN","BPSOS2A",95,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSOS2A",96,0)
 S Y=$S(Y="P":1,Y="L":0,1:Y)
"RTN","BPSOS2A",97,0)
 Q Y
"RTN","BPSOS2A",98,0)
 ;
"RTN","BPSOS2A",99,0)
SURE(DEF) N SURE,PMT,OPT,ANS
"RTN","BPSOS2A",100,0)
 S PMT="Are you sure"
"RTN","BPSOS2A",101,0)
 I '$D(DEF) S DEF="N"
"RTN","BPSOS2A",102,0)
 S OPT=1 ; answer is optional
"RTN","BPSOS2A",103,0)
 S ANS=$$YESNO^BPSOSU3(PMT,DEF,OPT)
"RTN","BPSOS2A",104,0)
 Q ANS ; 1 or 0 or -1 or ^ or ^^ or null
"RTN","BPSOS2A",105,0)
ANY ;EP - from BPSOS6D,BPSOS6K
"RTN","BPSOS2A",106,0)
 W:$X ! D PRESSANY^BPSOSU5() Q  ; Press any key
"RTN","BPSOS2B")
0^71^B50884943
"RTN","BPSOS2B",1,0)
BPSOS2B ;BHAM ISC/FCS/DRS/DLF - BPSOS2 continuation ;06/01/2004 
"RTN","BPSOS2B",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS2B",3,0)
 Q
"RTN","BPSOS2B",4,0)
COM70 N X2,X3 S X3=7,X2=0 G COM
"RTN","BPSOS2B",5,0)
COM60 N X2,X3 S X3=6,X2=0 ; and fall through to COM
"RTN","BPSOS2B",6,0)
COM ; input X, output formatted X, copied from COMMA^%DTC with NEWs added
"RTN","BPSOS2B",7,0)
 ; X2=# decimal digits opt. followed by "$", X3=len of desired output
"RTN","BPSOS2B",8,0)
 ; and falls through into L1
"RTN","BPSOS2B",9,0)
 N %,%D,%L
"RTN","BPSOS2B",10,0)
 I $D(X3) S X3=X3+1 ; make room for the trailing space we'll get rid of
"RTN","BPSOS2B",11,0)
 S %D=X<0 S:%D X=-X S %=$S($D(X2):+X2,1:2),X=$J(X,1,%),%=$L(X)-3-$E(23456789,%),%L=$S($D(X3):X3,1:12)
"RTN","BPSOS2B",12,0)
 F %=%:-3 Q:$E(X,%)=""  S X=$E(X,1,%)_","_$E(X,%+1,99)
"RTN","BPSOS2B",13,0)
 S:$D(X2) X=$E("$",X2["$")_X S X=$J($E("(",%D)_X_$E(" )",%D+1),%L)
"RTN","BPSOS2B",14,0)
 I $E(X,$L(X))=" " S X=$E(X,1,$L(X)-1)
"RTN","BPSOS2B",15,0)
L1 ; given R=row,C=col,X=string
"RTN","BPSOS2B",16,0)
 ; Duplicate of L1^BPSOS2C
"RTN","BPSOS2B",17,0)
 D SET^VALM10(R,$$SETSTR^VALM1(X,$G(@VALMAR@(R,0)),C,$L(X)))
"RTN","BPSOS2B",18,0)
 I $$VISIBLE(R) D WRITE^VALM10(R)
"RTN","BPSOS2B",19,0)
 Q
"RTN","BPSOS2B",20,0)
VISIBLE(R) ;EP -
"RTN","BPSOS2B",21,0)
 I $G(NODISPLY) Q 0
"RTN","BPSOS2B",22,0)
 I '$G(VALMBG) Q 0
"RTN","BPSOS2B",23,0)
 I R<VALMBG Q 0
"RTN","BPSOS2B",24,0)
 I R>(VALMBG+(18-3)) Q 0
"RTN","BPSOS2B",25,0)
 Q 1
"RTN","BPSOS2B",26,0)
VALUES ;EP - from BPSOS2 
"RTN","BPSOS2B",27,0)
 ; note!  This must correspond with the LABELS code in BPSOS2C
"RTN","BPSOS2B",28,0)
 N R,R1,R2,C,X,X2,X3
"RTN","BPSOS2B",29,0)
 N TIME S TIME=CURR("COMM","$$H")-CURR("COMM",2) I 'TIME S TIME=1
"RTN","BPSOS2B",30,0)
 S R1=1,CDIV=3
"RTN","BPSOS2B",31,0)
 G VA101
"RTN","BPSOS2B",32,0)
VA001 S R=R1 ;
"RTN","BPSOS2B",33,0)
 S R=R+1 ;
"RTN","BPSOS2B",34,0)
 S R=R+1 ;
"RTN","BPSOS2B",35,0)
 I $D(CHG("COMM",402)) D
"RTN","BPSOS2B",36,0)
 .S C=9,X=CHG("COMM",402),X2=0,X3=7 D COM
"RTN","BPSOS2B",37,0)
 I $D(CHG("COMM","$$H"))&$D(CHG("COMM",402)) D
"RTN","BPSOS2B",38,0)
 .S C=18,X=CURR("COMM",402)/TIME*60,X2=1,X3=6 D COM
"RTN","BPSOS2B",39,0)
 I $D(CHG("COMM",403)) D
"RTN","BPSOS2B",40,0)
 .S C=27,X=CHG("COMM",403),X2=0,X3=11 D COM
"RTN","BPSOS2B",41,0)
 I $D(CHG("COMM","$$H"))&$D(CHG("COMM",403)) D
"RTN","BPSOS2B",42,0)
 .S C=41,X=CURR("COMM",403)/TIME*60,X2=0,X3=7 D COM
"RTN","BPSOS2B",43,0)
VA005 S R=R+1 ;
"RTN","BPSOS2B",44,0)
 I $D(CHG("COMM",404)) D
"RTN","BPSOS2B",45,0)
 .S C=9,X=$G(CHG("COMM",404)),X2=0,X3=7 D COM
"RTN","BPSOS2B",46,0)
 I $D(CHG("COMM",404))&$G(CHG("COMM","$$H")) D
"RTN","BPSOS2B",47,0)
 .S C=18,X=CURR("COMM",404)/TIME*60,X2=1,X3=6 D COM
"RTN","BPSOS2B",48,0)
 I $D(CHG("COMM",405)) D
"RTN","BPSOS2B",49,0)
 .S C=27,X=CHG("COMM",405),X2=0,X3=11 D COM
"RTN","BPSOS2B",50,0)
 I $D(CHG("COMM",405))&$D(CHG("COMM","$$H")) D
"RTN","BPSOS2B",51,0)
 .S C=41,X=CURR("COMM",405)/TIME*60,X2=0,X3=7 D COM
"RTN","BPSOS2B",52,0)
 S R=R+1 ;,C=3,X="Total claims" D L1 S C=26,X="Average per min" D L1
"RTN","BPSOS2B",53,0)
 I $D(CHG("COMM",200)) D
"RTN","BPSOS2B",54,0)
 .S C=16,X=CHG("COMM",200),X2=0,X3=7 D COM
"RTN","BPSOS2B",55,0)
 I $D(CHG("COMM",200))&$D(CHG("COMM","$$H")) D
"RTN","BPSOS2B",56,0)
 .S C=41,X=CURR("COMM",200)/TIME*60,X2=1,X3=6 D COM
"RTN","BPSOS2B",57,0)
 S R=R+1 ;,C=3,X="Average claims per packet" D L1
"RTN","BPSOS2B",58,0)
 I $D(CHG("COMM",200))&$D(CHG("COMM",402)) D
"RTN","BPSOS2B",59,0)
 .S C=34
"RTN","BPSOS2B",60,0)
 .I CURR("COMM",402) S X=CURR("COMM",200)/CURR("COMM",402)
"RTN","BPSOS2B",61,0)
 .E  S X=0
"RTN","BPSOS2B",62,0)
 .S X2=2,X3=5 D COM
"RTN","BPSOS2B",63,0)
 S R=R+1 ;,C=3,X="Average seconds per transaction" D L1
"RTN","BPSOS2B",64,0)
 I $D(CHG("COMM",501))!$D(CHG("COMM",404)) D
"RTN","BPSOS2B",65,0)
 .; Just let Receive packets = transaction count
"RTN","BPSOS2B",66,0)
 .S C=34
"RTN","BPSOS2B",67,0)
 .I CURR("COMM",404) S X=CURR("COMM",501)/CURR("COMM",404)
"RTN","BPSOS2B",68,0)
 .E  S X=0
"RTN","BPSOS2B",69,0)
 .S X2=2,X3=5 D COM
"RTN","BPSOS2B",70,0)
 S R=R+1 ;
"RTN","BPSOS2B",71,0)
VA010 S R=R+1 ;
"RTN","BPSOS2B",72,0)
 I $D(CHG("PKTQ","C")) D
"RTN","BPSOS2B",73,0)
 .S C=31,X=CHG("PKTQ","C"),X2=0,X3=4 D COM
"RTN","BPSOS2B",74,0)
 .; the average would be xxx.x in column C=38,C2=1,X3=5
"RTN","BPSOS2B",75,0)
 S R=R+1 ;
"RTN","BPSOS2B",76,0)
 I $D(CHG("PKTQ","R")) D
"RTN","BPSOS2B",77,0)
 .S C=31,X=CHG("PKTQ","R"),X2=0,X3=4 D COM
"RTN","BPSOS2B",78,0)
 .; the average would be xxx.x in column C=38,C2=1,X3=5
"RTN","BPSOS2B",79,0)
 S R=R+1 ;
"RTN","BPSOS2B",80,0)
 S R=R+1 ;
"RTN","BPSOS2B",81,0)
 I $D(CHG("COMM",411)) D
"RTN","BPSOS2B",82,0)
 .S C=4,X=CHG("COMM",411),X2=0,X3=7 D COM
"RTN","BPSOS2B",83,0)
 I $D(CHG("COMM",414)) D
"RTN","BPSOS2B",84,0)
 .S C=19,X=CHG("COMM",414),X2=0,X3=7 D COM
"RTN","BPSOS2B",85,0)
 I $O(CHG("COMM",599))<700 D  ; dialing errors
"RTN","BPSOS2B",86,0)
 .N % S X=0,%=602 ; sum dial errors: fields 603-699
"RTN","BPSOS2B",87,0)
 .F  S %=$O(CURR("COMM",%)) Q:%>699!(%="")  S X=X+CURR("COMM",%)
"RTN","BPSOS2B",88,0)
 .S C=43,X2=0,X3=5 D COM
"RTN","BPSOS2B",89,0)
 S R=R+1 ;
"RTN","BPSOS2B",90,0)
 I $D(CHG("COMM",412)) D
"RTN","BPSOS2B",91,0)
 .S C=4,X=CHG("COMM",412),X2=0,X3=7 D COM
"RTN","BPSOS2B",92,0)
 I $D(CHG("COMM",415)) D
"RTN","BPSOS2B",93,0)
 .S C=19,X=CHG("COMM",415),X2=0,X3=7 D COM
"RTN","BPSOS2B",94,0)
 I $O(CHG("COMM",700))<800 D  ; problems around sending time 700-799
"RTN","BPSOS2B",95,0)
 .N % S X=0,%=700
"RTN","BPSOS2B",96,0)
 .F  S %=$O(CURR("COMM",%)) Q:%>799!(%="")  I %'=702 S X=X+CURR("COMM",%)
"RTN","BPSOS2B",97,0)
 .S C=43,X=0,X3=5 D COM
"RTN","BPSOS2B",98,0)
VA015 S R=R+1 ;
"RTN","BPSOS2B",99,0)
 I $D(CHG("COMM",413)) S C=4,X=CHG("COMM",413),X2=0,X3=7 D COM
"RTN","BPSOS2B",100,0)
 I $D(CHG("COMM",419)) S C=19,X=CHG("COMM",419),X2=0,X3=7 D COM
"RTN","BPSOS2B",101,0)
 I $G(CHG("COMM",799))<900 D
"RTN","BPSOS2B",102,0)
 .N % S X=0,%=799 ; sum receive errors: fields 801-899
"RTN","BPSOS2B",103,0)
 .F  S %=$O(CURR("COMM",%)) Q:%>899!(%="")  S X=X+CURR("COMM",%)
"RTN","BPSOS2B",104,0)
 .S C=43,X2=0,X3=5 D COM
"RTN","BPSOS2B",105,0)
 S R=R+1 ; we sent nak
"RTN","BPSOS2B",106,0)
 I $D(CHG("COMM",408)) D  ; details of responses to nak in #901-999
"RTN","BPSOS2B",107,0)
 .S C=43,X=CHG("COMM",408),X2=0,X3=5 D COM
"RTN","BPSOS2B",108,0)
 S R=R+1 ;,C=7,X="11",C=11,X="Other" D L1
"RTN","BPSOS2B",109,0)
 S R2=R ;,C=CDIV,X="|" F R=R1:1:R2 D L1
"RTN","BPSOS2B",110,0)
VA101 S R=R1 ;
"RTN","BPSOS2B",111,0)
 S R=R+1 ;
"RTN","BPSOS2B",112,0)
 I $D(CHG("STAT",0)) D
"RTN","BPSOS2B",113,0)
 .S C=CDIV+20,X=CHG("STAT",0),X2=0,X3=3 D COM
"RTN","BPSOS2B",114,0)
 S R=R+1 ;
"RTN","BPSOS2B",115,0)
 I $D(CHG("STAT",10)) D
"RTN","BPSOS2B",116,0)
 .S C=CDIV+20,X=CHG("STAT",10),X2=0,X3=3 D COM
"RTN","BPSOS2B",117,0)
VA105 S R=R+1 ;
"RTN","BPSOS2B",118,0)
 I $D(CHG("STAT",30)) D
"RTN","BPSOS2B",119,0)
 .S C=CDIV+20,X=CHG("STAT",30),X2=0,X3=3 D COM
"RTN","BPSOS2B",120,0)
 S R=R+1 ;
"RTN","BPSOS2B",121,0)
 I $D(CHG("STAT",40)) D
"RTN","BPSOS2B",122,0)
 .S C=CDIV+20,X=CHG("STAT",40),X2=0,X3=3 D COM
"RTN","BPSOS2B",123,0)
 S R=R+1 ;
"RTN","BPSOS2B",124,0)
 I $D(CHG("STAT",50)) D
"RTN","BPSOS2B",125,0)
 .S C=CDIV+20,X=CHG("STAT",50),X2=0,X3=3 D COM
"RTN","BPSOS2B",126,0)
 S R=R+1 ;
"RTN","BPSOS2B",127,0)
 I $D(CHG("STAT",60)) D
"RTN","BPSOS2B",128,0)
 .S C=CDIV+20,X=CHG("STAT",60),X2=0,X3=3 D COM
"RTN","BPSOS2B",129,0)
 S R=R+1 ;
"RTN","BPSOS2B",130,0)
 I $D(CHG("STAT",70)) D
"RTN","BPSOS2B",131,0)
 .S C=CDIV+20,X=CHG("STAT",70),X2=0,X3=3 D COM
"RTN","BPSOS2B",132,0)
VA110 S R=R+1 ;
"RTN","BPSOS2B",133,0)
 I $D(CHG("STAT",80)) D
"RTN","BPSOS2B",134,0)
 .S C=CDIV+20,X=CHG("STAT",80),X2=0,X3=3 D COM
"RTN","BPSOS2B",135,0)
 S R=R+1 ;
"RTN","BPSOS2B",136,0)
 I $D(CHG("STAT",90)) D
"RTN","BPSOS2B",137,0)
 .S C=CDIV+20,X=CHG("STAT",90),X2=0,X3=3 D COM
"RTN","BPSOS2B",138,0)
 S R=R+1 ;
"RTN","BPSOS2B",139,0)
 S R=2,CDIV=65 ;
"RTN","BPSOS2B",140,0)
 I $D(CHG("COMM",203)) D
"RTN","BPSOS2B",141,0)
 .S C=CDIV+1,X=CHG("COMM",203),X2=0,X3=7 D COM
"RTN","BPSOS2B",142,0)
 S R=R+1 ;
"RTN","BPSOS2B",143,0)
 I $D(CHG("COMM",202)) D
"RTN","BPSOS2B",144,0)
 .S C=CDIV+1,X=CHG("COMM",202),X2=0,X3=7 D COM
"RTN","BPSOS2B",145,0)
 S R=R+1 ;
"RTN","BPSOS2B",146,0)
 I $D(CHG("COMM",201)) D
"RTN","BPSOS2B",147,0)
 .S C=CDIV+1,X=CHG("COMM",201),X2=0,X3=7 D COM
"RTN","BPSOS2B",148,0)
VA115 S R=R+1 ;
"RTN","BPSOS2B",149,0)
 I $D(CHG("COMM",204)) D
"RTN","BPSOS2B",150,0)
 .S C=CDIV+1,X=CHG("COMM",204),X2=0,X3=7 D COM
"RTN","BPSOS2B",151,0)
VA116 S R=R+1 ;
"RTN","BPSOS2B",152,0)
 I $D(CHG("COMM",205)) D
"RTN","BPSOS2B",153,0)
 .S C=CDIV+1,X=CHG("COMM",205),X2=0,X3=7 D COM
"RTN","BPSOS2B",154,0)
VA200 ; Then line 18 begins "Next screen"
"RTN","BPSOS2B",155,0)
 S (R,R1)=17
"RTN","BPSOS2B",156,0)
 N C1 S C1=1+$L("Other errors during dialing")+2,X2=0,X3=4
"RTN","BPSOS2B",157,0)
VA210 S R=R+1 ;
"RTN","BPSOS2B",158,0)
 S R=R+1 ;
"RTN","BPSOS2B",159,0)
 I $D(CHG("COMM",601)) D
"RTN","BPSOS2B",160,0)
 .N X2,X3 S C=C1,X=CHG("COMM",601) D COM60
"RTN","BPSOS2B",161,0)
 S R=R+1 ;
"RTN","BPSOS2B",162,0)
 I $D(CHG("COMM",604)) S C=C1,X=CHG("COMM",604) D COM60
"RTN","BPSOS2B",163,0)
 S R=R+1 ;
"RTN","BPSOS2B",164,0)
 I $D(CHG("COMM",603)) S C=C1,X=CHG("COMM",603) D COM60
"RTN","BPSOS2B",165,0)
 S R=R+1
"RTN","BPSOS2B",166,0)
VA220 S R=R+1 ;
"RTN","BPSOS2B",167,0)
 S R=R+1 ;
"RTN","BPSOS2B",168,0)
 I $D(CHG("COMM",719)) S C=C1,X=CHG("COMM",719) D COM60
"RTN","BPSOS2B",169,0)
 S R=R+1 ;
"RTN","BPSOS2B",170,0)
 I $D(CHG("COMM",701)) S C=C1,X=CHG("COMM",701) D COM60
"RTN","BPSOS2B",171,0)
 S R=R+1 ;
"RTN","BPSOS2B",172,0)
 I $D(CHG("COMM",702)) S C=C1,X=CHG("COMM",702) D COM60
"RTN","BPSOS2B",173,0)
 S R=R+1 ;
"RTN","BPSOS2B",174,0)
 I $D(CHG("COMM",703)) S C=C1,X=CHG("COMM",703) D COM60
"RTN","BPSOS2B",175,0)
 S R=R+1 ;
"RTN","BPSOS2B",176,0)
 I $D(CHG("COMM",704)) S C=C1,X=CHG("COMM",704) D COM60
"RTN","BPSOS2B",177,0)
 S R=R+1 ;
"RTN","BPSOS2B",178,0)
 I $D(CHG("COMM",705)) S C=C1,X=CHG("COMM",705) D COM60
"RTN","BPSOS2B",179,0)
 S R=R+1 ;
"RTN","BPSOS2B",180,0)
 I $D(CHG("COMM",709)) S C=C1,X=CHG("COMM",709) D COM60
"RTN","BPSOS2B",181,0)
 S R2=R,CDIV=40,C=CDIV ;
"RTN","BPSOS2B",182,0)
 S R=R1,C1=CDIV+4+$L("Received null during")+1
"RTN","BPSOS2B",183,0)
VA260 S R=R+1 ;
"RTN","BPSOS2B",184,0)
 S R=R+1 ;
"RTN","BPSOS2B",185,0)
 I $D(CHG("COMM",801)) S X=CHG("COMM",801),C=C1 D COM60
"RTN","BPSOS2B",186,0)
 S R=R+1 ;
"RTN","BPSOS2B",187,0)
 I $D(CHG("COMM",802)) S X=CHG("COMM",802),C=C1 D COM60
"RTN","BPSOS2B",188,0)
 S R=R+1 ;
"RTN","BPSOS2B",189,0)
 I $D(CHG("COMM",803)) S X=CHG("COMM",803),C=C1 D COM60
"RTN","BPSOS2B",190,0)
 S R=R+1 ;
"RTN","BPSOS2B",191,0)
 I $D(CHG("COMM",804)) S X=CHG("COMM",804),C=C1 D COM60
"RTN","BPSOS2B",192,0)
 S R=R+1 ;
"RTN","BPSOS2B",193,0)
 I $D(CHG("COMM",809)) S X=CHG("COMM",809),C=C1 D COM60
"RTN","BPSOS2B",194,0)
 S R=R+1
"RTN","BPSOS2B",195,0)
VA270 S R=R+1 ;
"RTN","BPSOS2B",196,0)
 S R=R+1 ;
"RTN","BPSOS2B",197,0)
 I $D(CHG("COMM",408)) S X=CHG("COMM",408),C=C1 D COM60
"RTN","BPSOS2B",198,0)
 S R=R+1 ;
"RTN","BPSOS2B",199,0)
 I $D(CHG("COMM",902)) S X=CHG("COMM",902),C=C1 D COM60
"RTN","BPSOS2B",200,0)
 S R=R+1 ;
"RTN","BPSOS2B",201,0)
 I $D(CHG("COMM",903)) S X=CHG("COMM",903),C=C1 D COM60
"RTN","BPSOS2B",202,0)
 S R=R+1 ;
"RTN","BPSOS2B",203,0)
 I $D(CHG("COMM",904)) S X=CHG("COMM",904),C=C1 D COM60
"RTN","BPSOS2B",204,0)
 S R=R+1 ;
"RTN","BPSOS2B",205,0)
 I $D(CHG("COMM",909)) S X=CHG("COMM",909),C=C1 D COM60
"RTN","BPSOS2B",206,0)
VA300 S (R,R1)=33 ; begin page 3
"RTN","BPSOS2B",207,0)
 S C=5
"RTN","BPSOS2B",208,0)
 S R=R+1 ;
"RTN","BPSOS2B",209,0)
 S R=R+1 ;
"RTN","BPSOS2B",210,0)
 S X=$G(CHG("COMM",101)) I X]"" D COM70
"RTN","BPSOS2B",211,0)
 S R=R+1 ;
"RTN","BPSOS2B",212,0)
 S X=$G(CHG("COMM",102)) I X]"" D COM70
"RTN","BPSOS2B",213,0)
 S R=R+1 ;
"RTN","BPSOS2B",214,0)
 S X=$G(CHG("COMM",103)) I X]"" D COM70
"RTN","BPSOS2B",215,0)
 S R=R+1
"RTN","BPSOS2B",216,0)
 S R=R+1 ;
"RTN","BPSOS2B",217,0)
 S R=R+1 ;
"RTN","BPSOS2B",218,0)
 S X=$G(CHG("COMM",1101)) I X]"" D COM70
"RTN","BPSOS2B",219,0)
 S R=R+1 ;
"RTN","BPSOS2B",220,0)
 S X=$G(CHG("COMM",1102)) I X]"" D COM70
"RTN","BPSOS2B",221,0)
 S R=R+1 ;
"RTN","BPSOS2B",222,0)
 S X=$G(CHG("COMM",1103)) I X]"" D COM70
"RTN","BPSOS2B",223,0)
 K CHG
"RTN","BPSOS2B",224,0)
 Q
"RTN","BPSOS2C")
0^72^B18253372
"RTN","BPSOS2C",1,0)
BPSOS2C ;BHAM ISC/FCS/DRS/DLF - BPSOS2 continuation ;06/01/2004 
"RTN","BPSOS2C",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS2C",3,0)
 Q
"RTN","BPSOS2C",4,0)
LABELS ;EP - from BPSOS2 ; set up the labels display
"RTN","BPSOS2C",5,0)
 N R,R1,R2,C,CDIV,X
"RTN","BPSOS2C",6,0)
 S R1=1 ; start in row 1
"RTN","BPSOS2C",7,0)
 S CDIV=1
"RTN","BPSOS2C",8,0)
 S R2=0
"RTN","BPSOS2C",9,0)
 G LA101 ; RMOVE NON VA STUFF FROM THE SCREEN DLF
"RTN","BPSOS2C",10,0)
 S CDIV=50 ; column divider line goes in column 50
"RTN","BPSOS2C",11,0)
LA001 S R=R1,C=3,X="* * * * * COMMUNICATIONS STATISTICS * * * * *" D L1
"RTN","BPSOS2C",12,0)
 S R=R+1,C=9,X="Packets  Per min      Bytes     Per Min" D L1
"RTN","BPSOS2C",13,0)
 S R=R+1,C=3,X="Sent" D L1
"RTN","BPSOS2C",14,0)
LA005 S R=R+1,C=3,X="Recd" D L1
"RTN","BPSOS2C",15,0)
 S R=R+1,C=3,X="Total claims" D L1 S C=26,X="Average per min" D L1
"RTN","BPSOS2C",16,0)
 S R=R+1,C=3,X="Average claims per packet" D L1
"RTN","BPSOS2C",17,0)
 S R=R+1,C=3,X="Average seconds per transaction" D L1
"RTN","BPSOS2C",18,0)
 S R=R+1,C=32,X="Now   Average" D L1
"RTN","BPSOS2C",19,0)
LA010 S R=R+1,C=3,X="Packets waiting to be sent" D L1
"RTN","BPSOS2C",20,0)
 S R=R+1,C=3,X="Responses waiting for proc" D L1
"RTN","BPSOS2C",21,0)
 S R=R+1,C=1,X=" * * Transaction Codes * * * Comms Problems * *" D L1
"RTN","BPSOS2C",22,0)
 S R=R+1
"RTN","BPSOS2C",23,0)
 S C=1,X="01:" D L1 S C=16,X="04:" D L1 S C=27,X="|  Dialing out" D L1
"RTN","BPSOS2C",24,0)
 S R=R+1
"RTN","BPSOS2C",25,0)
 S C=1,X="02:" D L1 S C=16,X="11:" D L1 S C=27,X="|  Sending data" D L1
"RTN","BPSOS2C",26,0)
LA015 S R=R+1
"RTN","BPSOS2C",27,0)
 S C=1,X="03:" D L1 S C=15,X="Oth:" D L1 S C=27,X="|  Rec'v'g data" D L1
"RTN","BPSOS2C",28,0)
 S R=R+1,C=27,X="|  We sent NAK" D L1
"RTN","BPSOS2C",29,0)
 S R=R+1 ; nothing on the left side on this line         
"RTN","BPSOS2C",30,0)
LA099 ;
"RTN","BPSOS2C",31,0)
 S R2=R,C=CDIV-1,X="|" F R=R1:1:R2 D L1
"RTN","BPSOS2C",32,0)
 S R2=R,C=CDIV,X="|" F R=R1:1:R2 D L1
"RTN","BPSOS2C",33,0)
LA101 S R=R1,C=CDIV+2,X="* CLAIM STATUS *" D L1
"RTN","BPSOS2C",34,0)
 S R=R+1,C=CDIV+2,X="Waiting to start" D L1
"RTN","BPSOS2C",35,0)
 S R=R+1,X="Gathering info" D L1
"RTN","BPSOS2C",36,0)
LA105 S R=R+1,X="Wait packet build" D L1
"RTN","BPSOS2C",37,0)
 S R=R+1,X="Building packet" D L1
"RTN","BPSOS2C",38,0)
 S R=R+1,X="Wait for transmit" D L1
"RTN","BPSOS2C",39,0)
 S R=R+1,X="Transmitting" D L1
"RTN","BPSOS2C",40,0)
 S R=R+1,X="Receiv'g response" D L1
"RTN","BPSOS2C",41,0)
LA110 S R=R+1,X="Wait resp process" D L1
"RTN","BPSOS2C",42,0)
 S R=R+1,X="Proces'g response" D L1
"RTN","BPSOS2C",43,0)
 S R=0,R=R+1,CDIV=40,C=CDIV,X="   * CLAIM RESULTS *"  D L1
"RTN","BPSOS2C",44,0)
 S C=CDIV+9
"RTN","BPSOS2C",45,0)
 S R=R+1,C=CDIV,X="Paid claims" D L1
"RTN","BPSOS2C",46,0)
 S R=R+1,X="Rejected claims" D L1
"RTN","BPSOS2C",47,0)
 S R=R+1,X="Paper or Unbillable" D L1
"RTN","BPSOS2C",48,0)
LA115 S R=R+1,X="Duplicate claims" D L1
"RTN","BPSOS2C",49,0)
LA116 S R=R+1,X="Captured claims" D L1
"RTN","BPSOS2C",50,0)
 S VALMCNT=$S(R>R2:R,1:R2)
"RTN","BPSOS2C",51,0)
 Q
"RTN","BPSOS2C",52,0)
LA200 ; Then line 18 begins "Next screen"
"RTN","BPSOS2C",53,0)
 S (R,R1)=17
"RTN","BPSOS2C",54,0)
 S X="***** Communications Problems *****",C=$L(X)/2*-1+40 D L1
"RTN","BPSOS2C",55,0)
 S C=1
"RTN","BPSOS2C",56,0)
LA210 S R=R+1,X="*** Dialing and Connecting ***" D L1
"RTN","BPSOS2C",57,0)
 S R=R+1,X="How many times we dialed" D L1
"RTN","BPSOS2C",58,0)
 S R=R+1,X="Did not receive CONNECT" D L1
"RTN","BPSOS2C",59,0)
 S R=R+1,X="Other errors during dialing" D L1
"RTN","BPSOS2C",60,0)
 S R=R+1
"RTN","BPSOS2C",61,0)
LA220 S R=R+1,X="*** Before & After Sending ***" D L1
"RTN","BPSOS2C",62,0)
 S R=R+1,X="Didn't get init ENQ" D L1
"RTN","BPSOS2C",63,0)
 S R=R+1,X="Didn't get STX back" D L1
"RTN","BPSOS2C",64,0)
 S R=R+1,X="Got ENQ instead" D L1
"RTN","BPSOS2C",65,0)
 S R=R+1,X="Got NAK instead" D L1
"RTN","BPSOS2C",66,0)
 S R=R+1,X="Got +++ instead" D L1
"RTN","BPSOS2C",67,0)
 S R=R+1,X="Got null instead" D L1
"RTN","BPSOS2C",68,0)
 S R=R+1,X="Got something else" D L1
"RTN","BPSOS2C",69,0)
 S R2=R,CDIV=40,C=CDIV,X="|" F R=R1+1:1:R2 D L1
"RTN","BPSOS2C",70,0)
 S R=R1,C=CDIV+4
"RTN","BPSOS2C",71,0)
LA260 S R=R+1,X="*** While receiving responses ***" D L1
"RTN","BPSOS2C",72,0)
 S R=R+1,X="Did not receive ETX" D L1
"RTN","BPSOS2C",73,0)
 S R=R+1,X="Received EOT during" D L1
"RTN","BPSOS2C",74,0)
 S R=R+1,X="Received null during" D L1
"RTN","BPSOS2C",75,0)
 S R=R+1,X="Received +++ during" D L1
"RTN","BPSOS2C",76,0)
 S R=R+1,X="Miscellaneous" D L1
"RTN","BPSOS2C",77,0)
 S R=R+1
"RTN","BPSOS2C",78,0)
LA270 S R=R+1,X="*** We sent NAK (LRC disagrees) ***" D L1
"RTN","BPSOS2C",79,0)
 S R=R+1,X="How many times" D L1
"RTN","BPSOS2C",80,0)
 S R=R+1,X="Got STX back (good)" D L1
"RTN","BPSOS2C",81,0)
 S R=R+1,X="Got null back" D L1
"RTN","BPSOS2C",82,0)
 S R=R+1,X="Got +++ back" D L1
"RTN","BPSOS2C",83,0)
 S R=R+1,X="Got something else" D L1
"RTN","BPSOS2C",84,0)
LA300 I R<33 F  Q:R=33  D
"RTN","BPSOS2C",85,0)
 .S R=R+1 S X=" " D L1
"RTN","BPSOS2C",86,0)
 S R1=R ; begin page 3 ; 
"RTN","BPSOS2C",87,0)
 S C=15
"RTN","BPSOS2C",88,0)
 S R=R+1,X="***  Front-end inputs  ***" D L1
"RTN","BPSOS2C",89,0)
 S R=R+1,X="Total claims submitted" D L1
"RTN","BPSOS2C",90,0)
 S R=R+1,X="Unique, first-time ones" D L1
"RTN","BPSOS2C",91,0)
 S R=R+1,X="Repeat submissions" D L1
"RTN","BPSOS2C",92,0)
 S R=R+1
"RTN","BPSOS2C",93,0)
 S R=R+1,X="***  Finding PCC Visits  ***" D L1
"RTN","BPSOS2C",94,0)
 S R=R+1,X="Found via PCC link in prescription file" D L1
"RTN","BPSOS2C",95,0)
 S R=R+1,X="Found by patient,date@time ""AA"" index" D L1
"RTN","BPSOS2C",96,0)
 S R=R+1,X="Could not find; created new visit" D L1
"RTN","BPSOS2C",97,0)
 S VALMCNT=R
"RTN","BPSOS2C",98,0)
 Q
"RTN","BPSOS2C",99,0)
L1 ; given R=row,C=col,X=string
"RTN","BPSOS2C",100,0)
 ; Duplicate of L1^BPSOS2B
"RTN","BPSOS2C",101,0)
 D SET^VALM10(R,$$SETSTR^VALM1(X,$G(@VALMAR@(R,0)),C,$L(X)))
"RTN","BPSOS2C",102,0)
 I $$VISIBLE(R) D WRITE^VALM10(R)
"RTN","BPSOS2C",103,0)
 Q
"RTN","BPSOS2C",104,0)
VISIBLE(R)         Q $$VISIBLE^BPSOS2B(R)
"RTN","BPSOS2D")
0^73^B2361443
"RTN","BPSOS2D",1,0)
BPSOS2D ;BHAM ISC/FCS/DRS/FLS - Poke the queues ;06/01/2004
"RTN","BPSOS2D",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS2D",3,0)
 Q
"RTN","BPSOS2D",4,0)
POKE ;EP - from BPSOS2A ; protocol BPSOS P2 POKE
"RTN","BPSOS2D",5,0)
 ; If things seem to be stalled, here's a kludgey way to start up
"RTN","BPSOS2D",6,0)
 ; more background jobs to give 'em a poke.
"RTN","BPSOS2D",7,0)
 W !,"Poking the pharmacy ECME processing queues:",!
"RTN","BPSOS2D",8,0)
 I '$$LOCKPOS^BPSOSUD Q
"RTN","BPSOS2D",9,0)
 W "."
"RTN","BPSOS2D",10,0)
 N A,B,ABSBRXI F A=40,50 D
"RTN","BPSOS2D",11,0)
 .S B="" F  S B=$O(^BPST("AD",A,B)) Q:'B  D
"RTN","BPSOS2D",12,0)
 ..W "."
"RTN","BPSOS2D",13,0)
 ..S ABSBRXI=B D SETSTAT^BPSOSU(0) ; restart all of these
"RTN","BPSOS2D",14,0)
 ..D LOG59^BPSOSL("POKE set this claim back to restart processing",B)
"RTN","BPSOS2D",15,0)
 D  ; kill all outbound claims, lest we send claims twice
"RTN","BPSOS2D",16,0)
 . N DIALOUT S DIALOUT=0
"RTN","BPSOS2D",17,0)
 . F  S DIALOUT=$O(^BPSECX("POS",DIALOUT)) Q:'DIALOUT  D
"RTN","BPSOS2D",18,0)
 . . N LOCKED S LOCKED=$$LLIST^BPSOSAP
"RTN","BPSOS2D",19,0)
 . . K ^BPSECX("POS",DIALOUT,"C") ; kill outbound claims, locked or not
"RTN","BPSOS2D",20,0)
 . . I LOCKED D ULLIST^BPSOSAP
"RTN","BPSOS2D",21,0)
 D ULKECME^BPSOSUD
"RTN","BPSOS2D",22,0)
 D TASK^BPSOSIZ W "." H 1
"RTN","BPSOS2D",23,0)
 D TASK^BPSOSQ1 W "." H 1
"RTN","BPSOS2D",24,0)
 N DIALOUT
"RTN","BPSOS2D",25,0)
 S DIALOUT=$$ANY2SEND^BPSOSQJ
"RTN","BPSOS2D",26,0)
 I DIALOUT D TASK^BPSOSQ2 W "." H 1
"RTN","BPSOS2D",27,0)
 S DIALOUT=$$ANYRESPS^BPSOSQ4
"RTN","BPSOS2D",28,0)
 I DIALOUT D TASK^BPSOSQ3() W "." H 1
"RTN","BPSOS2D",29,0)
 W "OK, they've been POKEd.",!
"RTN","BPSOS2D",30,0)
PZ Q
"RTN","BPSOS2E")
1^74
"RTN","BPSOS2F")
1^75
"RTN","BPSOS57")
0^81^B44320306
"RTN","BPSOS57",1,0)
BPSOS57 ;BHAM ISC/FCS/DRS/FLS - 9002313.57 utils ;06/01/2004
"RTN","BPSOS57",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS57",3,0)
 ;External reference private DBIA 4303
"RTN","BPSOS57",4,0)
 Q
"RTN","BPSOS57",5,0)
 ; Numerous little $$'s are here ; each assumes IEN57 is defined
"RTN","BPSOS57",6,0)
 ; Originally copied from BPSOSQ where it was for IEN57
"RTN","BPSOS57",7,0)
 ;
"RTN","BPSOS57",8,0)
 ;IHS/DSD/lwj 10/02  Two changes included in this routine, both
"RTN","BPSOS57",9,0)
 ; sent in by David Slauenwhite.  Changes were made and tested 
"RTN","BPSOS57",10,0)
 ; during the ILC interface work done at Siletz in October, 2001.
"RTN","BPSOS57",11,0)
 ;
"RTN","BPSOS57",12,0)
PREVIOUS(N57) ;EP -
"RTN","BPSOS57",13,0)
 I '$D(N57) S N57=IEN57
"RTN","BPSOS57",14,0)
 N RXI,RXR S RXI=$P(^BPSTL(N57,1),U,11)
"RTN","BPSOS57",15,0)
 S RXR=$P(^BPSTL(N57,1),U)
"RTN","BPSOS57",16,0)
 I RXI=""!(RXR="") Q ""
"RTN","BPSOS57",17,0)
 Q $O(^BPSTL("NON-FILEMAN","RXIRXR",RXI,RXR,N57),-1)
"RTN","BPSOS57",18,0)
LAST57(RXI,RXR) ;EP -
"RTN","BPSOS57",19,0)
 Q $O(^BPSTL("NON-FILEMAN","RXIRXR",RXI,RXR,""),-1)
"RTN","BPSOS57",20,0)
 ;
"RTN","BPSOS57",21,0)
DRGDFN() ;EP -
"RTN","BPSOS57",22,0)
 Q $P(^PSRX($$RXI,0),U,6) ; Given IEN57, return DRGDFN
"RTN","BPSOS57",23,0)
DRGNAME() ; EP -
"RTN","BPSOS57",24,0)
 Q $P(^PSDRUG($$DRGDFN,0),U) ; Given IEN57, return DRGNAME
"RTN","BPSOS57",25,0)
RELDATE() ;EP -
"RTN","BPSOS57",26,0)
 N RXI,RXR S RXI=$$RXI,RXR=$$RXR Q:'RXI ""
"RTN","BPSOS57",27,0)
 I RXR Q $P($G(^PSRX(RXI,1,RXR,0)),U,18)
"RTN","BPSOS57",28,0)
 Q $P($G(^PSRX(RXI,2)),U,13)
"RTN","BPSOS57",29,0)
RXI() ;EP -
"RTN","BPSOS57",30,0)
 Q $P(^BPSTL(IEN57,1),U,11) ; Given IEN57, return RXI
"RTN","BPSOS57",31,0)
RXR() ;EP -
"RTN","BPSOS57",32,0)
 Q $P(^BPSTL(IEN57,1),U,1) ; Given IEN57, return RXR
"RTN","BPSOS57",33,0)
NDC() ;EP -
"RTN","BPSOS57",34,0)
 I $$TYPE=1 Q $P(^BPSTL(IEN57,1),U,2)
"RTN","BPSOS57",35,0)
 I $$TYPE=2 Q "" ; not implemented
"RTN","BPSOS57",36,0)
 I $$TYPE=3 Q "" ; not implemented
"RTN","BPSOS57",37,0)
 D TYPEBAD("NDC")
"RTN","BPSOS57",38,0)
 Q ""
"RTN","BPSOS57",39,0)
QTY() ;EP -
"RTN","BPSOS57",40,0)
 Q $P(^BPSTL(IEN57,5),U) ; Given IEN57, return quantity
"RTN","BPSOS57",41,0)
AMT() Q $P(^BPSTL(IEN57,5),U,5) ; return total $amount
"RTN","BPSOS57",42,0)
CHG() ;EP -
"RTN","BPSOS57",43,0)
 Q $P(^BPSTL(IEN57,5),U,5) ; Given IEN57, ret total charge
"RTN","BPSOS57",44,0)
CPTIEN() ;EP -
"RTN","BPSOS57",45,0)
 I $$TYPE=1 Q 0
"RTN","BPSOS57",46,0)
 ; CPT code for postage could vary by insurer and amount?
"RTN","BPSOS57",47,0)
 ; A complication not yet programmed
"RTN","BPSOS57",48,0)
 I $$TYPE=2 Q $P($G(^BPS(9002313.99,1,"POSTAGE")),U)
"RTN","BPSOS57",49,0)
 I $$TYPE=3 Q $$EXTRCPT3 ; extract CPT from  visitien.cptien3
"RTN","BPSOS57",50,0)
 D TYPEBAD("CPTIEN")
"RTN","BPSOS57",51,0)
 Q ""
"RTN","BPSOS57",52,0)
INSIEN() ; EP -
"RTN","BPSOS57",53,0)
 Q $P(^BPSTL(IEN57,1),U,6)
"RTN","BPSOS57",54,0)
EXTRCPT3() N X S X=IEN57,X=$P(X,".",2),X=$E(X,1,$L(X)-1) Q +X
"RTN","BPSOS57",55,0)
PATIENT() ;EP -
"RTN","BPSOS57",56,0)
 Q $P(^BPSTL(IEN57,0),U,6)
"RTN","BPSOS57",57,0)
HRN() ; EP - health record number and facility abbreviation
"RTN","BPSOS57",58,0)
 N PAT,DIV,FAC,X
"RTN","BPSOS57",59,0)
 S PAT=$P($G(^BPSTL(IEN57,0)),U,6) Q:'PAT ""
"RTN","BPSOS57",60,0)
 S DIV=$P($G(^BPSTL(IEN57,1)),U,4)
"RTN","BPSOS57",61,0)
 I DIV S FAC=$P($G(^PS(59,DIV,"INI")),U)
"RTN","BPSOS57",62,0)
 E  S FAC=0
"RTN","BPSOS57",63,0)
 S:'FAC FAC=$G(DUZ(2))
"RTN","BPSOS57",64,0)
 Q:'FAC ""
"RTN","BPSOS57",65,0)
 S X=$G(^DIC(4,FAC,0))
"RTN","BPSOS57",66,0)
 I $P(X,U,5)]"" S X=$P(X,U,5)
"RTN","BPSOS57",67,0)
 E  S X=$E($P(X,U),1,4)
"RTN","BPSOS57",68,0)
 Q 0
"RTN","BPSOS57",69,0)
VISITIEN() ; EP -
"RTN","BPSOS57",70,0)
 Q $P(^BPSTL(IEN57,0),U,7)
"RTN","BPSOS57",71,0)
USER() ;EP -
"RTN","BPSOS57",72,0)
 N X S X=$P(^BPSTL(IEN57,0),U,10) S:'X X=$G(DUZ) Q X
"RTN","BPSOS57",73,0)
TYPE() ;EP -
"RTN","BPSOS57",74,0)
 N X S X=$P(^BPSTL(IEN57,0),U) ; 03/26/2001
"RTN","BPSOS57",75,0)
 S X=$E(X,$L(X)) ; 1=prescription, 2=postage for presc, 3=other ;
"RTN","BPSOS57",76,0)
 I X'=1,X'=2,X'=3 D
"RTN","BPSOS57",77,0)
 . D IMPOSS^BPSOSUE("DB","TI","Bad TYPE in transaction","IEN57="_IEN57,"TYPE",$T(+0))
"RTN","BPSOS57",78,0)
 Q X
"RTN","BPSOS57",79,0)
TYPEBAD(ATLABEL) ;
"RTN","BPSOS57",80,0)
 D IMPOSS^BPSOSUE("DB","TI","Invalid $$TYPE^BPSOS57",$$TYPE,ATLABEL,$T(+0)) Q
"RTN","BPSOS57",81,0)
NOW() ; EP -
"RTN","BPSOS57",82,0)
 N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOS57",83,0)
FILLDATE() ; EP -
"RTN","BPSOS57",84,0)
 N RXI,RXR S RXI=$$RXI,RXR=$$RXR
"RTN","BPSOS57",85,0)
 Q:RXR $P(^PSRX(RXI,1,RXR,0),U)  Q:RXI $P(^PSRX(RXI,2),U,2)
"RTN","BPSOS57",86,0)
 Q $$VISDATE
"RTN","BPSOS57",87,0)
VISDATE() Q 0    ;$P($P(^AUPNVSIT($$VISITIEN,0),U),".")
"RTN","BPSOS57",88,0)
VMED() ; EP -
"RTN","BPSOS57",89,0)
 N RXI,RXR S RXI=$$RXI,RXR=$$RXR
"RTN","BPSOS57",90,0)
 Q:RXR $P(^PSRX(RXI,1,RXR,999999911),U) Q $P(^PSRX(RXI,999999911),U)
"RTN","BPSOS57",91,0)
PROVIDER() ;EP -
"RTN","BPSOS57",92,0)
 Q $P(^PSRX($$RXI,0),U,4)
"RTN","BPSOS57",93,0)
VCN() ;EP -
"RTN","BPSOS57",94,0)
 N V S V=$$VISITIEN Q:'V "" Q 0
"RTN","BPSOS57",95,0)
 ;
"RTN","BPSOS57",96,0)
ISREVERS(N) ;EP - BPSOSIY,BPSOSM1 
"RTN","BPSOS57",97,0)
 ; Returns reversal claim #, else false
"RTN","BPSOS57",98,0)
 ; Returns 0.5 if it's reversal of a paper claim
"RTN","BPSOS57",99,0)
 N X S X=$G(^BPSTL(N,4)) Q:X="" 0
"RTN","BPSOS57",100,0)
 I X Q $P(X,U) ; reversal of electronic claim
"RTN","BPSOS57",101,0)
 I $P(X,U,3) Q 0.5 ; reversal of paper claim
"RTN","BPSOS57",102,0)
 Q 0
"RTN","BPSOS57",103,0)
REVACC(N) ;EP - BPSOSIY,BPSOSM1
"RTN","BPSOS57",104,0)
 ; was this an accepted reversal? return true or false
"RTN","BPSOS57",105,0)
 I $P(^BPSTL(N,4),U,3) Q 1 ; paper reversal always success
"RTN","BPSOS57",106,0)
 ; Treat Duplicate of Accepted Reversal ("S") as accepted
"RTN","BPSOS57",107,0)
 N X
"RTN","BPSOS57",108,0)
 S X=$$REVRESP(N)
"RTN","BPSOS57",109,0)
 Q X="A"!(X="S")
"RTN","BPSOS57",110,0)
REVRESP(N)         ;
"RTN","BPSOS57",111,0)
 N RESP S RESP=$P(^BPSTL(N,4),U,2)
"RTN","BPSOS57",112,0)
 I 'RESP Q "?"
"RTN","BPSOS57",113,0)
 N X S X=$$RESP500^BPSOSQ4(RESP,"I")
"RTN","BPSOS57",114,0)
 Q X ; Should be "A" or "R" - can be "S" (Duplicate of Accepted Reversal)
"RTN","BPSOS57",115,0)
ARSYSTEM()         Q $P(^BPS(9002313.99,1,"A/R INTERFACE"),U)
"RTN","BPSOS57",116,0)
MAKEVCN()          ; true/false  should we assign a VCN # to the visit?
"RTN","BPSOS57",117,0)
 N AR S AR=$$ARSYSTEM
"RTN","BPSOS57",118,0)
 I AR=0 Q 1 ; yes, for ILC A/R
"RTN","BPSOS57",119,0)
 I AR=2 Q 1 ; yes, for ANMC A/R
"RTN","BPSOS57",120,0)
 Q 0 ; no, for everybody else
"RTN","BPSOS57",121,0)
LOG2LIST(MSG)      D LOG2LIST^BPSOSL(MSG) Q
"RTN","BPSOS57",122,0)
LOG2CLM(MSG,IEN02)       D LOG2CLM^BPSOSL(MSG,IEN02) Q
"RTN","BPSOS57",123,0)
LOG59(MSG) ;EP - 
"RTN","BPSOS57",124,0)
 D LOG59^BPSOSL(MSG,$P(^BPSTL(IEN57,0),U)) Q
"RTN","BPSOS57",125,0)
COMP59 ; devel util ; compare to .57 DD, should be same fields
"RTN","BPSOS57",126,0)
 W !,$T(COMP59),!
"RTN","BPSOS57",127,0)
 N F57,F59,OK S F57=9002313.57,F59=9002313.59,OK=1
"RTN","BPSOS57",128,0)
 D COMP1(F57,F59) ; everything in .57 also in .59?
"RTN","BPSOS57",129,0)
 W !
"RTN","BPSOS57",130,0)
 D COMP1(F59,F57) ; and the other direction, too
"RTN","BPSOS57",131,0)
 W !?5 I OK W "OK!  All fields in common"
"RTN","BPSOS57",132,0)
 E  W "NOT OK!  Some differences in fields"
"RTN","BPSOS57",133,0)
 W " between ",F57," and ",F59,!
"RTN","BPSOS57",134,0)
 Q
"RTN","BPSOS57",135,0)
COMP1(F1,F2) N A S A=0
"RTN","BPSOS57",136,0)
 F  S A=$O(^DD(F1,A)) Q:'A  D
"RTN","BPSOS57",137,0)
 . Q:$D(^DD(F2,A))  ; Okay
"RTN","BPSOS57",138,0)
 . I A>10000,A<11000,F1=9002313.57 Q  ; computed fields spec. for 57
"RTN","BPSOS57",139,0)
 . S OK=0 W "Field ",A," is in ",F1," but not in ",F2,!
"RTN","BPSOS57",140,0)
 Q
"RTN","BPSOS57",141,0)
POSITION() ; return pointer to position within claim (D1)
"RTN","BPSOS57",142,0)
 Q $P($G(^BPSTL(IEN57,0)),U,9)
"RTN","BPSOS57",143,0)
IEN02() ; return pointer to claim 
"RTN","BPSOS57",144,0)
 Q $P($G(^BPSTL(IEN57,0)),U,4)
"RTN","BPSOS57",145,0)
IEN03() ; return pointer to response
"RTN","BPSOS57",146,0)
 Q $P($G(^BPSTL(IEN57,0)),U,5)
"RTN","BPSOS57",147,0)
REVIEN02() ; return pointer to reversal claim
"RTN","BPSOS57",148,0)
 Q $P($G(^BPSTL(IEN57,4)),U)
"RTN","BPSOS57",149,0)
REVIEN03() ; return pointer to reversal response
"RTN","BPSOS57",150,0)
 Q $P($G(^BPSTL(IEN57,4)),U,2)
"RTN","BPSOS57",151,0)
FIELD(F,REV) ; EP - retrieve field F from claim or response ; given D0
"RTN","BPSOS57",152,0)
 ; returns value
"RTN","BPSOS57",153,0)
 ; Special for reject codes:  F=511 gets ","-delimited string of codes
"RTN","BPSOS57",154,0)
 ;  F=511.01 gets first code, F=511.02 gets second one, etc.
"RTN","BPSOS57",155,0)
 N X,IEN02,IEN03,POS,IEN57 S IEN57=D0
"RTN","BPSOS57",156,0)
 S POS=$$POSITION,IEN02=$$IEN02,IEN03=$$IEN03
"RTN","BPSOS57",157,0)
 I $G(REV) S IEN02=$$REVIEN02,IEN03=$$REVIEN03
"RTN","BPSOS57",158,0)
 I 'IEN02,F<400 D  Q X
"RTN","BPSOS57",159,0)
 . S X=""
"RTN","BPSOS57",160,0)
 . ; could define some of them based on pricing data
"RTN","BPSOS57",161,0)
 I 'IEN03,F>400 D  Q X
"RTN","BPSOS57",162,0)
 . S X=""
"RTN","BPSOS57",163,0)
 I F<400 S X=$$GET1^DIQ(9002313.02,IEN02_",",F,"I")
"RTN","BPSOS57",164,0)
 E  I F>400,F<500 S X=$$GET1^DIQ(9002313.0201,POS_","_IEN02_",",F,"I")
"RTN","BPSOS57",165,0)
 E  I F=501!(F=524) S X=$$GET1^DIQ(9002313.03,IEN03_",",F,"I")
"RTN","BPSOS57",166,0)
 E  I F\1=511 D REJCODES S:F#1 X=$G(X(F#1*100))
"RTN","BPSOS57",167,0)
 E  S X=$$GET1^DIQ(9002313.0301,POS_","_IEN03_",",F,"I")
"RTN","BPSOS57",168,0)
 ; strip trailing spaces
"RTN","BPSOS57",169,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,$L(X)-1)
"RTN","BPSOS57",170,0)
 D STRIPID ; strip field ID, if any
"RTN","BPSOS57",171,0)
 D MONEY ; money fields, where appropriate
"RTN","BPSOS57",172,0)
 D OTHER ; other special conversions
"RTN","BPSOS57",173,0)
 Q X
"RTN","BPSOS57",174,0)
REJCODES ; rejection codes for IEN03
"RTN","BPSOS57",175,0)
 ; X = ","-delimited string of two-char codes
"RTN","BPSOS57",176,0)
 ; X(j)=code_" "_description
"RTN","BPSOS57",177,0)
 K X S X=""
"RTN","BPSOS57",178,0)
 N I,J S (I,J)=0
"RTN","BPSOS57",179,0)
 F  S I=$O(^BPSR(IEN03,1000,POS,511,I)) Q:'I  D
"RTN","BPSOS57",180,0)
 . N A S A=$P(^BPSR(IEN03,1000,POS,511,I,0),U) Q:'A
"RTN","BPSOS57",181,0)
 . S A=$O(^BPSF(9002313.93,"B",A,0)) Q:'A
"RTN","BPSOS57",182,0)
 . S A=^BPSF(9002313.93,A,0)
"RTN","BPSOS57",183,0)
 . S:X]"" X=X_"," S X=X_$P(A,U)
"RTN","BPSOS57",184,0)
 . S J=J+1,X(J)=$P(A,U)_" "_$P(A,U,2)
"RTN","BPSOS57",185,0)
 Q
"RTN","BPSOS57",186,0)
STRIPID ; some fields have two-character field ID
"RTN","BPSOS57",187,0)
 ; and first eliminate all those that don't:
"RTN","BPSOS57",188,0)
 Q:F<307  Q:F=308
"RTN","BPSOS57",189,0)
 I F>400,F<500 Q:F<410  Q:F=411  Q:F=414  Q:F=415  Q:F=419  Q:F=420  Q:F=426
"RTN","BPSOS57",190,0)
 ;IHS/DSD/lwj 10/02 nxt line changed on behalf of David Slauenwhite
"RTN","BPSOS57",191,0)
 I F>500 Q:F<512  Q:F=525  Q:F=526  ;DS 10/11/01
"RTN","BPSOS57",192,0)
 S X=$E(X,3,$L(X))
"RTN","BPSOS57",193,0)
 Q
"RTN","BPSOS57",194,0)
MONEY ; some fields are money fields in signed overpunch format
"RTN","BPSOS57",195,0)
 Q:F<400
"RTN","BPSOS57",196,0)
 ;IHS/DSD/lwj 10/02 nxt line changed on behalf of David Slauenwhite
"RTN","BPSOS57",197,0)
 I F>400,F<500 I F'=409,F'=410,F'=426,F'=430,F'=431,F'=433,F'=438,F'=428,F'=412 Q    ;DS 10/11/01 F'=412 test added during ILC A/R interface work
"RTN","BPSOS57",198,0)
 I F>500 Q:F<505  Q:F=510  Q:F\1=511  Q:F=522  Q:F>523
"RTN","BPSOS57",199,0)
 S X=+$$DFF2EXT^BPSECFM(X)
"RTN","BPSOS57",200,0)
 I X=0 S X="" ; so [CAPTIONED] doesn't print it
"RTN","BPSOS57",201,0)
 Q
"RTN","BPSOS57",202,0)
OTHER ; other special conversions
"RTN","BPSOS57",203,0)
 I F=442 S X=X/1000 Q  ; metric decimal quantity
"RTN","BPSOS57",204,0)
 Q
"RTN","BPSOS6A")
0^295^B3472076
"RTN","BPSOS6A",1,0)
BPSOS6A ;BHAM ISC/FCS/DRS/FLS - Data Entry & Status Disp ;06/01/2004
"RTN","BPSOS6A",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6A",3,0)
 ;
"RTN","BPSOS6A",4,0)
 ; ALL writes of screen lines should be done as follows:
"RTN","BPSOS6A",5,0)
 ;  IF $$VISIBLE(line) DO WRITE^VALM10(line)
"RTN","BPSOS6A",6,0)
 ; When appropriate, set NODISPLY=true and $$VISIBLE will return false
"RTN","BPSOS6A",7,0)
 Q
"RTN","BPSOS6A",8,0)
ERROR D FULL^VALM1 Q  ; how to do ZQUIT acceptably? ; ZQUIT
"RTN","BPSOS6A",9,0)
DISPHIST(MSG,HANG) ; DEBUGGING - to record history and pause
"RTN","BPSOS6A",10,0)
 Q:'$P($G(^BPS(9002313.99,1,"BPSOS6*")),U)
"RTN","BPSOS6A",11,0)
 D DISPHIST^BPSOS6H(MSG,HANG)
"RTN","BPSOS6A",12,0)
 Q
"RTN","BPSOS6A",13,0)
EN(USER,TIME) ;EP - from BPSOS in prog mode ; option BPS USER SCREEN
"RTN","BPSOS6A",14,0)
 N DISMISS,DISP,DISPHIST,DISPLINE,DISPIDX,CHGCOUNT,NODISPLY,INFO,ONEPAT
"RTN","BPSOS6A",15,0)
 D MYPARAMS^BPSOS6C
"RTN","BPSOS6A",16,0)
 K @DISP,@DISPLINE,@DISPIDX,@DISPHIST,@DISMISS S (@DISPLINE,@DISPHIST)=0
"RTN","BPSOS6A",17,0)
 D EN^VALM("BPS USER SCREEN")
"RTN","BPSOS6A",18,0)
 Q
"RTN","BPSOS6A",19,0)
HDR G HDR^BPSOS6C ; -- header code
"RTN","BPSOS6A",20,0)
INIT ; -- init variables and list array
"RTN","BPSOS6A",21,0)
 N DISMISS,DISP,DISPHIST,DISPLINE,DISPIDX,CHGCOUNT,NODISPLY
"RTN","BPSOS6A",22,0)
 D MYPARAMS^BPSOS6C
"RTN","BPSOS6A",23,0)
 D CLEAN^VALM10
"RTN","BPSOS6A",24,0)
 ;INIT1    ; to bypass setting of MYPARAMS
"RTN","BPSOS6A",25,0)
 S VALMCNT=0 ; 0 lines so far
"RTN","BPSOS6A",26,0)
 D HDR
"RTN","BPSOS6A",27,0)
 D UPD
"RTN","BPSOS6A",28,0)
 Q
"RTN","BPSOS6A",29,0)
UPD ;EP - protocol BPS P1 UPDATE ; update the screen, once
"RTN","BPSOS6A",30,0)
 ; called from BPSOS6C,BPSOS6D,BPSOS6J,BPSOSI
"RTN","BPSOS6A",31,0)
 D UPDATE^BPSOS6I(1)
"RTN","BPSOS6A",32,0)
 S VALMBCK="",XQORM("B")="UD" Q
"RTN","BPSOS6A",33,0)
CONTUPD ; protocol BPS P1 CONTINUOUS ; continuous update of the display
"RTN","BPSOS6A",34,0)
 W !!!!! D UPDATE^BPSOS6I(-1) S VALMBCK=""
"RTN","BPSOS6A",35,0)
 ; returned from Continuous Update - what's next?
"RTN","BPSOS6A",36,0)
 I $P($G(^BPS(9002313.99,1,"INPUT")),U,3) D
"RTN","BPSOS6A",37,0)
 . ; input method is via RX calling ECME or by background monitor
"RTN","BPSOS6A",38,0)
 . S XQORM("B")="CU" ; default is to go back into continuous update
"RTN","BPSOS6A",39,0)
 E  D  ; input method is manual input
"RTN","BPSOS6A",40,0)
 . S XQORM("B")="NEW" ; default is to do more data entry
"RTN","BPSOS6A",41,0)
 Q
"RTN","BPSOS6A",42,0)
HELP ; -- help code
"RTN","BPSOS6A",43,0)
 N X S X="?" D DISP^XQORM1 W !!
"RTN","BPSOS6A",44,0)
 Q
"RTN","BPSOS6A",45,0)
 ;
"RTN","BPSOS6A",46,0)
EXIT ; -- exit code
"RTN","BPSOS6A",47,0)
 D FULL^VALM1
"RTN","BPSOS6A",48,0)
 Q
"RTN","BPSOS6A",49,0)
 ;
"RTN","BPSOS6A",50,0)
EXPND ; -- expand code
"RTN","BPSOS6A",51,0)
 Q
"RTN","BPSOS6A",52,0)
 ;
"RTN","BPSOS6B")
0^83^B34650501
"RTN","BPSOS6B",1,0)
BPSOS6B ;BHAM ISC/FCS/DRS/FLS - user display screen, cont ;06/01/2004
"RTN","BPSOS6B",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6B",3,0)
 Q
"RTN","BPSOS6B",4,0)
INFO(PAT,RXI)         ;EP - from BPSOS6H
"RTN","BPSOS6B",5,0)
 ; IF '$G(RXI), then this is a patient summary line:
"RTN","BPSOS6B",6,0)
 ;   INFO("%")=% completion
"RTN","BPSOS6B",7,0)
 ;   INFO("COUNT")=how many for this patient
"RTN","BPSOS6B",8,0)
 ;   INFO("PATIEN")=ien into patient file
"RTN","BPSOS6B",9,0)
 ;   INFO("STAT",status)=count
"RTN","BPSOS6B",10,0)
 ;   INFO("RES")="- - - 3 prescriptions - - -", for example, if inc.
"RTN","BPSOS6B",11,0)
 ;   but if complete,
"RTN","BPSOS6B",12,0)
 ;   INFO("RES")="* FINISHED * 1 rejected * 2 payable", for example
"RTN","BPSOS6B",13,0)
 ;
"RTN","BPSOS6B",14,0)
 ; If we are going to do prescription detail, then the RESULTS
"RTN","BPSOS6B",15,0)
 ; area for this patient will simply say how many prescriptions
"RTN","BPSOS6B",16,0)
 ; and each individual prescription has its own result detail
"RTN","BPSOS6B",17,0)
 ; But if this is a patient summary with no prescription detail,
"RTN","BPSOS6B",18,0)
 ; then pull all the results together into:
"RTN","BPSOS6B",19,0)
 ; INFO("RES",result code^text)=count
"RTN","BPSOS6B",20,0)
 ;
"RTN","BPSOS6B",21,0)
 ; IF $G(RXI), then this is a prescription detail line
"RTN","BPSOS6B",22,0)
 ;  INFO("DRUG")=drug name
"RTN","BPSOS6B",23,0)
 ;  INFO("RES")=final result or processing status, and presc. #
"RTN","BPSOS6B",24,0)
 ;           (depending on whether status is 100% or not)
"RTN","BPSOS6B",25,0)
 ;  INFO("PATIEN") as abov
"RTN","BPSOS6B",26,0)
 ;  INFO("STAT")=processing status (text)
"RTN","BPSOS6B",27,0)
 ;  INFO("DUR")=Brief DUR response info (just conflict and message)
"RTN","BPSOS6B",28,0)
 ;
"RTN","BPSOS6B",29,0)
INFO1 IF $G(RXI) D  Q
"RTN","BPSOS6B",30,0)
 .N REVERSAL S REVERSAL=$G(^BPST(RXI,4)) ; is it a rev'l?
"RTN","BPSOS6B",31,0)
 .I 'REVERSAL S REVERSAL=$P(REVERSAL,U,3) ; if not elect, maybe paper
"RTN","BPSOS6B",32,0)
 .N INSURER S INSURER=$P(^BPST(RXI,1),U,6)
"RTN","BPSOS6B",33,0)
 .S INSURER=""
"RTN","BPSOS6B",34,0)
 .; eligibility etc. for SELF PAY reworded during final result
"RTN","BPSOS6B",35,0)
 .; in BPSOSQ1 and then again for real in billing
"RTN","BPSOS6B",36,0)
 .N IEN52 S IEN52=$P(^BPST(RXI,1),U,11)
"RTN","BPSOS6B",37,0)
 .N X
"RTN","BPSOS6B",38,0)
 .I IEN52 D
"RTN","BPSOS6B",39,0)
 . . N RX0 S RX0=$G(^PSRX(IEN52,0)),X=$P(RX0,U,6)
"RTN","BPSOS6B",40,0)
 . . I X]"" S X=$P($G(^PSDRUG(X,0)),U)
"RTN","BPSOS6B",41,0)
 . . I X="" S X="(can't find in DRUG file?)"
"RTN","BPSOS6B",42,0)
 . . I RXI[".",$E(RXI,$L(RXI))=2 S X="Postage-"_X
"RTN","BPSOS6B",43,0)
 .E  D
"RTN","BPSOS6B",44,0)
 . . N CPT S CPT=$P(RXI,".",2),CPT=+$E(CPT,1,$L(CPT)-1)
"RTN","BPSOS6B",45,0)
 . . ; $GET because of timing problem?
"RTN","BPSOS6B",46,0)
 . . S X=$P($G(^ABSCPT(9002300,CPT,0)),U,2) ; short desc
"RTN","BPSOS6B",47,0)
 .S INFO("DRUG")=X,INFO("STAT")=""
"RTN","BPSOS6B",48,0)
 .S INFO("RES")=INFO("STAT")
"RTN","BPSOS6B",49,0)
 .N STAT S STAT=$P(@DISP@(PAT,RXI),U,2)
"RTN","BPSOS6B",50,0)
 .I STAT=100 D
"RTN","BPSOS6B",51,0)
 . . S INFO("DUR")=$$DURBRIEF^BPSOS6G(RXI)
"RTN","BPSOS6B",52,0)
 . . I INFO("DUR")]"" S INFO("RES")=INFO("RES")_"DUR! "
"RTN","BPSOS6B",53,0)
 .E  D
"RTN","BPSOS6B",54,0)
 . . S INFO("DUR")=""
"RTN","BPSOS6B",55,0)
 . . S INFO("STAT")=INFO("STAT")_$$STATI^BPSOSU(STAT)
"RTN","BPSOS6B",56,0)
 .I STAT=31!(STAT=51) D  ; retry due to comms problem or ins. asleep
"RTN","BPSOS6B",57,0)
 . . N X S X=$G(^BPST(RXI,8)) Q:X=""
"RTN","BPSOS6B",58,0)
 . . N Y S Y=$P(X,U) X ^DD("DD") S Y=$P(Y,"@",2),X=$P(X,U,2)
"RTN","BPSOS6B",59,0)
 . . S INFO("STAT")=INFO("STAT")_" after "_Y
"RTN","BPSOS6B",60,0)
 . . Q:'X  S X=$P(^BPS(9002313.55,X,0),U)
"RTN","BPSOS6B",61,0)
 . . I STAT=51 S INFO("STAT")=INFO("STAT")_" to dial out to "_X
"RTN","BPSOS6B",62,0)
 .I INSURER]"" D
"RTN","BPSOS6B",63,0)
 . . N X S X=INFO("STAT")_" "
"RTN","BPSOS6B",64,0)
 . . S X=X_$S(STAT>99:"by",STAT>69:"from",STAT>49:"to",1:"for")
"RTN","BPSOS6B",65,0)
 . . S INFO("STAT")=X_" "_INSURER
"RTN","BPSOS6B",66,0)
 .I STAT=100 D  ;LJE; I $D(RXI)
"RTN","BPSOS6B",67,0)
 . . N X S X=$$RESULT(RXI)
"RTN","BPSOS6B",68,0)
 . . S INFO("RES")=$S(X]"":X,1:"(Missing result?)")
"RTN","BPSOS6B",69,0)
 . E  S INFO("RES")=INFO("STAT")
"RTN","BPSOS6B",70,0)
 .S INFO("RES")=INFO("RES")_" ("_$S(RXI[".":RXI,1:"Prescription `"_RXI)_")"
"RTN","BPSOS6B",71,0)
 .S INFO("PATIEN")=$P(^BPST(RXI,0),U,6)
"RTN","BPSOS6B",72,0)
 .I 'INFO("PATIEN") S INFO("PATIEN")=$P($G(^PSRX(IEN52,0)),U,2)
"RTN","BPSOS6B",73,0)
 .I INFO("DUR")]"" S INFO("RES")=INFO("RES")_" DUR:"_INFO("DUR")
"RTN","BPSOS6B",74,0)
 .I REVERSAL S INFO("RES")="*REVERSAL* "_INFO("RES")
"RTN","BPSOS6B",75,0)
 .I ONEPAT S INFO("RES")=$$ONEPAT^BPSOS6C_" "_INFO("RES")
"RTN","BPSOS6B",76,0)
 .I STAT<99,$G(^BPST(RXI,3)) D
"RTN","BPSOS6B",77,0)
 ..S INFO("RES")="*CANCELLATION REQUESTED* "_INFO("RES")
"RTN","BPSOS6B",78,0)
 ;
"RTN","BPSOS6B",79,0)
 ; Else we're doing a patient record:
"RTN","BPSOS6B",80,0)
 ;
"RTN","BPSOS6B",81,0)
INFO6 N X S X=@DISP@(PAT)
"RTN","BPSOS6B",82,0)
 N N,K S (N,INFO("COUNT"))=$P(X,U,4)
"RTN","BPSOS6B",83,0)
 S INFO("%")=$P(X,U,2)/$P(X,U,4)+.5\1
"RTN","BPSOS6B",84,0)
 I INFO("%")=100 D
"RTN","BPSOS6B",85,0)
 .S INFO("RES")="** FINISHED ** "
"RTN","BPSOS6B",86,0)
 .I $P(X,U,5)+$P(X,U,6)+$P(X,U,7)+$P(X,U,8)+$P(X,U,9)'=N D INFO8 ;reCALC
"RTN","BPSOS6B",87,0)
 .S K=$P(X,U,5) I K D  S INFO("RES")=INFO("RES")_K_" rejected  *"
"RTN","BPSOS6B",88,0)
 ..S K=$S(N=1:"",K=N:$S(K=2:"BOTH",1:"ALL"),1:K)
"RTN","BPSOS6B",89,0)
 .S K=$P(X,U,6) I K D  S INFO("RES")=INFO("RES")_K_" not electronic  *"
"RTN","BPSOS6B",90,0)
 ..S K=$S(N=1:"",K=N:$S(K=2:"BOTH",1:"ALL"),1:K)
"RTN","BPSOS6B",91,0)
 .S K=$P(X,U,7) I K D  S INFO("RES")=INFO("RES")_K_" payable  *"
"RTN","BPSOS6B",92,0)
 ..S K=$S(N=1:"",K=N:$S(K=2:"BOTH",1:"ALL"),1:K)
"RTN","BPSOS6B",93,0)
 .S K=$P(X,U,8) I K D  S INFO("RES")=INFO("RES")_K_" rejected reversal *"
"RTN","BPSOS6B",94,0)
 ..S K=$S(N=1:"",K=N:$S(K=2:"BOTH",1:"ALL"),1:K)
"RTN","BPSOS6B",95,0)
 .S K=$P(X,U,9) I K D  S INFO("RES")=INFO("RES")_K_" accepted reversal *"
"RTN","BPSOS6B",96,0)
 ..S K=$S(N=1:"",K=N:$S(K=2:"BOTH",1:"ALL"),1:K)
"RTN","BPSOS6B",97,0)
 .S INFO("RES")=INFO("RES")_"*"
"RTN","BPSOS6B",98,0)
 E  D
"RTN","BPSOS6B",99,0)
 .N N,S ;,C
"RTN","BPSOS6B",100,0)
 .S N=$P(X,U,4),S=$S(N=1:"",1:"s") ;,C=$P(X,U,5)+$P(X,U,6)+$P(X,U,7)
"RTN","BPSOS6B",101,0)
 .S INFO("RES")="     - - - "_N_" prescription"_S_" - - -"
"RTN","BPSOS6B",102,0)
 ; Set DODETAIL=1 if we are doing prescription detail, 0 if not
"RTN","BPSOS6B",103,0)
 N DODETAIL S DODETAIL=1  ;(INFO("COUNT")'<^TMP("BPSOS",$J,"DETAIL"))
"RTN","BPSOS6B",104,0)
 N RXI,I S RXI="" F I=1:1:INFO("COUNT") D
"RTN","BPSOS6B",105,0)
 .S RXI=$O(@DISP@(PAT,RXI))
"RTN","BPSOS6B",106,0)
 .N IEN52 S IEN52=$P(^BPST(RXI,1),U,11)
"RTN","BPSOS6B",107,0)
 .I I=1 D
"RTN","BPSOS6B",108,0)
 . . S INFO("PATIEN")=$P(^BPST(RXI,0),U,6)
"RTN","BPSOS6B",109,0)
 .I 'DODETAIL D  ; if not doing line item detail, summarize it
"RTN","BPSOS6B",110,0)
 ..S X=$$RESULT(RXI)
"RTN","BPSOS6B",111,0)
 ..I X]"" S INFO("RES",X)=$G(INFO("RES",X))+1
"RTN","BPSOS6B",112,0)
 ..N STAT S STAT=$P(@DISP@(PAT,RXI),U,2),INFO("STAT",STAT)=$G(INFO("STAT",STAT))+1
"RTN","BPSOS6B",113,0)
 Q
"RTN","BPSOS6B",114,0)
INFO8 ; retally the counts of rejected, not electronic, payable
"RTN","BPSOS6B",115,0)
 ; This could be necessary if a prescription was rejected, then
"RTN","BPSOS6B",116,0)
 ; resubmitted with corrections, and then paid - it would have been
"RTN","BPSOS6B",117,0)
 ; counted in two different buckets.
"RTN","BPSOS6B",118,0)
 ; Given X = the current value of @DISP@(PAT)
"RTN","BPSOS6B",119,0)
 ; Fix X and also store the fixed-up version in @DISP@(PAT,RXI)
"RTN","BPSOS6B",120,0)
 S $P(X,U,5,9)="0^0^0^0^0" ; reset the counts
"RTN","BPSOS6B",121,0)
 N RXI S RXI="" F  S RXI=$O(@DISP@(PAT,RXI)) Q:RXI=""  D INFO9
"RTN","BPSOS6B",122,0)
 S @DISP@(PAT)=X
"RTN","BPSOS6B",123,0)
 Q
"RTN","BPSOS6B",124,0)
INFO9 ; Given X, PAT, RXI, @DISP@(PAT,RXI)
"RTN","BPSOS6B",125,0)
 N B S B=$$BUCKET(RXI)
"RTN","BPSOS6B",126,0)
 S $P(X,U,B)=$P(X,U,B)+1
"RTN","BPSOS6B",127,0)
 Q
"RTN","BPSOS6B",128,0)
BUCKET(RXI)        ;EP - from BPSOS6I
"RTN","BPSOS6B",129,0)
 ; for ^TMP("BPSOS",$J,"DISP") pieces
"RTN","BPSOS6B",130,0)
 N R S R=$E($$RSPTYP(RXI))
"RTN","BPSOS6B",131,0)
 N V S V=$G(^BPST(RXI,4))
"RTN","BPSOS6B",132,0)
 I R="P" Q 7
"RTN","BPSOS6B",133,0)
 I R="" Q 6
"RTN","BPSOS6B",134,0)
 I R="R" Q $S(V:8,1:5)
"RTN","BPSOS6B",135,0)
 I R="A" Q 9
"RTN","BPSOS6B",136,0)
 Q 6  ; NEED A VALID BUCKET, EVEN IF THIS IS THE WRONG ONE
"RTN","BPSOS6B",137,0)
 ; 5 if rejected claim
"RTN","BPSOS6B",138,0)
 ; 6 if other failure
"RTN","BPSOS6B",139,0)
 ; 7 if paid
"RTN","BPSOS6B",140,0)
 ; 8 if rejected reversal
"RTN","BPSOS6B",141,0)
 ; 9 if accepted reversal
"RTN","BPSOS6B",142,0)
RESULT(RXI)        ;EP - from BPSOSIV
"RTN","BPSOS6B",143,0)
 N REC,RES,M S M=240 S REC(2)=$G(^BPST(RXI,2))
"RTN","BPSOS6B",144,0)
 I REC(2)="" Q ""
"RTN","BPSOS6B",145,0)
 N RES S RES=$P(REC(2),U),REC(2)=$P(REC(2),U,2,$L(REC(2),U))
"RTN","BPSOS6B",146,0)
 I RES=1 Q REC(2)
"RTN","BPSOS6B",147,0)
 I RES'=0 Q REC(2)_" (code "_RES_")"
"RTN","BPSOS6B",148,0)
 ; RES=0, good, we can go to the claim response and see what it says
"RTN","BPSOS6B",149,0)
 N RSP D RESPINFO^BPSOSQ4(RXI,.RSP)
"RTN","BPSOS6B",150,0)
 Q:'$D(RSP) ""   ;LJE
"RTN","BPSOS6B",151,0)
 ; Rework this - 10/28/2000 - because Oklahoma Medicaid seems to 
"RTN","BPSOS6B",152,0)
 ; make Packet Header Rejected, even though the Header is acceptable.
"RTN","BPSOS6B",153,0)
 ; But apparently if all the prescriptions are rejected, they give
"RTN","BPSOS6B",154,0)
 ; you a rejected packet header.  Or maybe if it's a patient-level
"RTN","BPSOS6B",155,0)
 ; problem, they do that.  Anyhow, the change made today is to always
"RTN","BPSOS6B",156,0)
 ; print individual prescription rejection reasons and to push the 
"RTN","BPSOS6B",157,0)
 ; "PACKET HEADER REJECTED" message to the end.
"RTN","BPSOS6B",158,0)
 D  ; 
"RTN","BPSOS6B",159,0)
 .S RES=RSP("RSP") ; prescription response status
"RTN","BPSOS6B",160,0)
 .I RES="Rejected" D
"RTN","BPSOS6B",161,0)
 ..S RES=RES_"("
"RTN","BPSOS6B",162,0)
 ..N I F I=1:1:RSP("REJ",0) D
"RTN","BPSOS6B",163,0)
 ...I I'=1 S RES=RES_","
"RTN","BPSOS6B",164,0)
 ...S RES=RES_RSP("REJ",I)
"RTN","BPSOS6B",165,0)
 ...I $L(RES)>M S RES=$E(RES,1,M)
"RTN","BPSOS6B",166,0)
 ..S RES=RES_")"
"RTN","BPSOS6B",167,0)
 I RSP("MSG")]"" S RES=RES_"; "_RSP("MSG") ; and any extra message
"RTN","BPSOS6B",168,0)
 I RSP("HDR")'="Accepted" D  ;packet header not accepted
"RTN","BPSOS6B",169,0)
 .I RSP("HDR")="" S RSP("HDR")="?status null?"
"RTN","BPSOS6B",170,0)
 .S RES=RES_";PACKET HEADER "_RSP("HDR")
"RTN","BPSOS6B",171,0)
 Q $E(RES,1,M)
"RTN","BPSOS6B",172,0)
RSPTYP(RXI)        ; quicker version of RESULT
"RTN","BPSOS6B",173,0)
 ; returns P payable, R rejected, or C or D, or "" if no resp packet
"RTN","BPSOS6B",174,0)
 N RSP D RESPINFO^BPSOSQ4(RXI,.RSP)
"RTN","BPSOS6B",175,0)
 Q $G(RSP("RSP"))
"RTN","BPSOS6C")
0^84^B11172604
"RTN","BPSOS6C",1,0)
BPSOS6C ;BHAM ISC/FCS/DRS/FLS - continuation of BPSOS6* ;06/01/2004
"RTN","BPSOS6C",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6C",3,0)
 Q
"RTN","BPSOS6C",4,0)
DEFTIME() Q .0015 ; fifteen minutes is the default default
"RTN","BPSOS6C",5,0)
UPDFREQ() Q 15 ; every fifteen seconds is the usual case
"RTN","BPSOS6C",6,0)
NEW ; Data entry screen - protocol BPS P1 NEW CLAIMS
"RTN","BPSOS6C",7,0)
 D FULL^VALM1 W:$D(IOF) @IOF
"RTN","BPSOS6C",8,0)
 D ^BPSOSI
"RTN","BPSOS6C",9,0)
 S VALMBCK="R" ; is this in here twice for a reason?
"RTN","BPSOS6C",10,0)
 N NODISPLY S NODISPLY=1 D UPD^BPSOS6A ; update, but don't display!
"RTN","BPSOS6C",11,0)
 ;   when you QUIT with VALMBCK="R", the repainting will take care of it
"RTN","BPSOS6C",12,0)
 S VALMBCK="R"
"RTN","BPSOS6C",13,0)
 Q
"RTN","BPSOS6C",14,0)
MYPARAMS ;EP - from BPSOS6A
"RTN","BPSOS6C",15,0)
 S ^TMP("BPSOS",$J,"USER")=$S($D(USER):USER,$G(DUZ):DUZ,1:0)
"RTN","BPSOS6C",16,0)
 S ^TMP("BPSOS",$J,"TIME")=$S($D(TIME):TIME,1:$$DEFTIME) ; time window
"RTN","BPSOS6C",17,0)
 S ^TMP("BPSOS",$J,"FREQ")=$$UPDFREQ ; frequency of continuous updates
"RTN","BPSOS6C",18,0)
 S ^TMP("BPSOS",$J,"LAST UPDATE")=""
"RTN","BPSOS6C",19,0)
 S ^TMP("BPSOS",$J,"PATIENT")=0 ; all patients
"RTN","BPSOS6C",20,0)
 S ^TMP("BPSOS",$J,"PATIENT TIME")=30 ; # of days
"RTN","BPSOS6C",21,0)
 S ^TMP("BPSOS",$J,"MAX LINES")=1000 ; max lines on display
"RTN","BPSOS6C",22,0)
 S DISP="^TMP(""BPSOS"",$J,""DISP"")"
"RTN","BPSOS6C",23,0)
 S DISPLINE="^TMP(""BPSOS"",$J,""DISPLINE"")"
"RTN","BPSOS6C",24,0)
 S DISPIDX="^TMP(""BPSOS"",$J,""VALM"",""IDX"")"
"RTN","BPSOS6C",25,0)
 S DISPHIST="^TMP(""BPSOS"",$J,""HIST"")"
"RTN","BPSOS6C",26,0)
 ;
"RTN","BPSOS6C",27,0)
 ; Right now:  always display prescription detail.
"RTN","BPSOS6C",28,0)
 ; Detail: If = 0, default is to not display any prescription detail.
"RTN","BPSOS6C",29,0)
 ;    If >0, default is:
"RTN","BPSOS6C",30,0)
 ;  display prescrip detail if pat has at least this many prescriptions
"RTN","BPSOS6C",31,0)
 ;     so if it's =1, we always show prescription line item detail
"RTN","BPSOS6C",32,0)
 ;  don't display detail if pat has < this many prescripts
"RTN","BPSOS6C",33,0)
 ;
"RTN","BPSOS6C",34,0)
 S ^TMP("BPSOS",$J,"DETAIL")=1 ; do we do prescription detail?
"RTN","BPSOS6C",35,0)
 ;
"RTN","BPSOS6C",36,0)
 ; ^TMP("BPSOS",$J,"DISP",...
"RTN","BPSOS6C",37,0)
 ;  ,PATNAME)    =line #^sum statuses^datetime last chg^count prescs
"RTN","BPSOS6C",38,0)
 ;    ^#rejected^#otherFails^#paid
"RTN","BPSOS6C",39,0)
 ;  ,PATNAME,RXI)=line #^status      ^datetime last chg
"RTN","BPSOS6C",40,0)
 ;    Note:  status 99 is stored here as 100, as in 100% done
"RTN","BPSOS6C",41,0)
 ;
"RTN","BPSOS6C",42,0)
 ; ^TMP("BPSOS",$J,"DISPLINE")=how many lines of items
"RTN","BPSOS6C",43,0)
 ; ^TMP("BPSOS",$J,"DISPLINE",n)=patname or patname^rxi on this line
"RTN","BPSOS6C",44,0)
 ;
"RTN","BPSOS6C",45,0)
 ; ^TMP("BPSOS",$J,"DISMISS",patname)=time
"RTN","BPSOS6C",46,0)
 ; ^TMP("BPSOS",$J,"DISMISS",patname,rxi)=time
"RTN","BPSOS6C",47,0)
 ;
"RTN","BPSOS6C",48,0)
 ;  Dismiss any mention of this patient until the given time.
"RTN","BPSOS6C",49,0)
 ;  If a patient is dismissed, so are all of his prescriptions.
"RTN","BPSOS6C",50,0)
 ;  But if a prescription has activity, the patient and that
"RTN","BPSOS6C",51,0)
 ;  active prescription will appear again.
"RTN","BPSOS6C",52,0)
 ;
"RTN","BPSOS6C",53,0)
 S DISMISS="^TMP(""BPSOS"",$J,""DISMISS"")"
"RTN","BPSOS6C",54,0)
 ;
"RTN","BPSOS6C",55,0)
 ;^TMP("BPSOS",$J,"VALM",...) is the array we tell listman to use.
"RTN","BPSOS6C",56,0)
 ;^TMP("BPSOS",$J,"VALM","IDX",LINE,PATIEN) for a patient line
"RTN","BPSOS6C",57,0)
 Q
"RTN","BPSOS6C",58,0)
HDR ;EP - from BPSOS6A ; -- header code
"RTN","BPSOS6C",59,0)
 N USER,ONEPAT,%
"RTN","BPSOS6C",60,0)
 S USER=^TMP("BPSOS",$J,"USER")
"RTN","BPSOS6C",61,0)
 S ONEPAT=^TMP("BPSOS",$J,"PATIENT")
"RTN","BPSOS6C",62,0)
 I USER S %="Transmitted by "_$$GET1^DIQ(200,USER,.01)
"RTN","BPSOS6C",63,0)
 E  D
"RTN","BPSOS6C",64,0)
 . S %="All prescriptions"
"RTN","BPSOS6C",65,0)
 . I ONEPAT S %=%_" for patient "_$P(^DPT(ONEPAT,0),U)
"RTN","BPSOS6C",66,0)
 S VALMHDR(1)=%
"RTN","BPSOS6C",67,0)
 S VALMHDR(2)="With activity in the past"
"RTN","BPSOS6C",68,0)
 S XQORM("B")="UC" ; the default is Update Continuously
"RTN","BPSOS6C",69,0)
 S XQORM("B")="UD" ; but we'd like to do U1 continuously from top lvl
"RTN","BPSOS6C",70,0)
 N T,X S X=""
"RTN","BPSOS6C",71,0)
 I ONEPAT S T=^TMP("BPSOS",$J,"PATIENT TIME")
"RTN","BPSOS6C",72,0)
 E  S T=$G(^TMP("BPSOS",$J,"TIME"))
"RTN","BPSOS6C",73,0)
 I 'T S T=$$DEFTIME
"RTN","BPSOS6C",74,0)
 I $P(T,".") S X=" "_$P(T,".")_" day(s)"
"RTN","BPSOS6C",75,0)
 S T=$P(T,".",2)_"000000"
"RTN","BPSOS6C",76,0)
 I $E(T,1,2) S X=X_" "_+$E(T,1,2)_" hr"
"RTN","BPSOS6C",77,0)
 I $E(T,3,4) S X=X_" "_+$E(T,3,4)_" min"
"RTN","BPSOS6C",78,0)
 I $E(T,5,6) S X=X_" "_+$E(T,5,6)_" sec"
"RTN","BPSOS6C",79,0)
 S VALMHDR(2)=VALMHDR(2)_X
"RTN","BPSOS6C",80,0)
 Q
"RTN","BPSOS6C",81,0)
ONEPAT() ;EP - from BPSOS6B 
"RTN","BPSOS6C",82,0)
 ; overflow from BPSOS - extra date & time info printed in onepat mode
"RTN","BPSOS6C",83,0)
 ; ECME time and FILL time
"RTN","BPSOS6C",84,0)
 ;start with kludgey var name machinations (sigh)
"RTN","BPSOS6C",85,0)
 N IEN59 S IEN59=RXI N RXI S RXI=$P(^BPST(IEN59,1),U,11)
"RTN","BPSOS6C",86,0)
 N POS S POS=$P(^BPST(IEN59,0),U,8)
"RTN","BPSOS6C",87,0)
 N RXR S RXR=$P(^BPST(IEN59,1),U)
"RTN","BPSOS6C",88,0)
 N FILL I RXR S FILL=$P($G(^PSRX(RXI,1,RXR,0)),U)
"RTN","BPSOS6C",89,0)
 E  S FILL=$P($G(^PSRX(RXI,2)),U,2)
"RTN","BPSOS6C",90,0)
 N Y S Y=POS D DATEHH S POS=Y
"RTN","BPSOS6C",91,0)
 S Y=FILL D DATEHH S FILL=Y
"RTN","BPSOS6C",92,0)
 I $P(POS,"@")=$P(FILL,"@") D
"RTN","BPSOS6C",93,0)
 . S $P(FILL,"@",1)="" ; don't duplic date
"RTN","BPSOS6C",94,0)
 . I $P(FILL,"@",2)="" S FILL=""
"RTN","BPSOS6C",95,0)
 I FILL="" Q POS
"RTN","BPSOS6C",96,0)
 Q POS_", FILL "_FILL
"RTN","BPSOS6C",97,0)
DATEHH ; given Y, format it and reset it  
"RTN","BPSOS6C",98,0)
 I 'Y S Y="?" Q
"RTN","BPSOS6C",99,0)
 X ^DD("DD") S Y=$P(Y,":",1,2)
"RTN","BPSOS6C",100,0)
 I $P($P(Y,"@"),",",2)-1700-$E(DT,1,3)=0 S Y=$P(Y,",")_"@"_$P(Y,"@",2)
"RTN","BPSOS6C",101,0)
 Q
"RTN","BPSOS6D")
0^85^B78255184
"RTN","BPSOS6D",1,0)
BPSOS6D ;BHAM ISC/FCS/DRS/FLS - user screen subrous ;06/01/2004
"RTN","BPSOS6D",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6D",3,0)
 Q
"RTN","BPSOS6D",4,0)
PRINTALL ; print all pat. results
"RTN","BPSOS6D",5,0)
 I '$D(@(VALMAR)) D NA G PRINT99
"RTN","BPSOS6D",6,0)
 N IO I '$$DEVICE G PRINT99
"RTN","BPSOS6D",7,0)
 U $P D:IO=$P FULL^VALM1 U IO
"RTN","BPSOS6D",8,0)
 D PRINTHDR
"RTN","BPSOS6D",9,0)
 N A S A="" F  S A=$O(@VALMAR@(A)) Q:'A  D PRINTA(A)
"RTN","BPSOS6D",10,0)
 G PRINT9
"RTN","BPSOS6D",11,0)
PRINTHDR ;
"RTN","BPSOS6D",12,0)
 W VALM("TITLE")," "
"RTN","BPSOS6D",13,0)
 N %,%H,%I,X,Y D NOW^%DTC S Y=% X ^DD("DD") W Y,!!
"RTN","BPSOS6D",14,0)
 N A S A="" F  S A=$O(VALMHDR(A)) Q:A=""  W VALMHDR(A),!
"RTN","BPSOS6D",15,0)
 W !
"RTN","BPSOS6D",16,0)
 Q
"RTN","BPSOS6D",17,0)
PRINTA(A) ; print line A
"RTN","BPSOS6D",18,0)
 ; How can you tell whether this is a patient line or prescription line?
"RTN","BPSOS6D",19,0)
 ; Look at @DISPLINE(n)=patname or patname^rxi
"RTN","BPSOS6D",20,0)
 ; Look at @VALMIDX@(n,patien), @VALMIDX@(n,patien,rxien)
"RTN","BPSOS6D",21,0)
 I '$D(IOM) N IOM S IOM=80
"RTN","BPSOS6D",22,0)
 N X D
"RTN","BPSOS6D",23,0)
 .I $D(@VALMAR@(A,0)) S X=@VALMAR@(A,0)
"RTN","BPSOS6D",24,0)
 .E  S X="(? Line "_A_" is missing?)"
"RTN","BPSOS6D",25,0)
 .F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,$L(X)-1)
"RTN","BPSOS6D",26,0)
 .N M,N S M=32,N=IOM-M
"RTN","BPSOS6D",27,0)
 .W $E(X,1,IOM),! S X=$E(X,IOM+1,$L(X))
"RTN","BPSOS6D",28,0)
 .F  Q:X=""  W ?M-3,"...",$E(X,1,N),! S X=$E(X,N+1,$L(X))
"RTN","BPSOS6D",29,0)
 Q
"RTN","BPSOS6D",30,0)
PRINT ; Print selected lines
"RTN","BPSOS6D",31,0)
 I '$D(@(VALMAR)) D NA G PRINT99
"RTN","BPSOS6D",32,0)
 W !,"Enter the line numbers you wish to print.  For example,",!
"RTN","BPSOS6D",33,0)
 W "enter    3-7     to print lines 3 through 7.",!
"RTN","BPSOS6D",34,0)
 N IEN D SELECPAT(.IEN)
"RTN","BPSOS6D",35,0)
 I $D(IEN)<10 G PRINT99
"RTN","BPSOS6D",36,0)
 N IO I '$$DEVICE G PRINT99
"RTN","BPSOS6D",37,0)
 U $P D:IO=$P FULL^VALM1 U IO
"RTN","BPSOS6D",38,0)
 D PRINTHDR
"RTN","BPSOS6D",39,0)
 N A S A="" F  S A=$O(IEN(A)) Q:A=""  D PRINTA(A)
"RTN","BPSOS6D",40,0)
PRINT9 ; joined here from PRINTALL,CLAIMLOG
"RTN","BPSOS6D",41,0)
 D BYE^BPSOSU5 ; this does DO ^%ZISC to close IO for you
"RTN","BPSOS6D",42,0)
PRINT99 ; joined here from PRINTALL,CLAIMLOG
"RTN","BPSOS6D",43,0)
 D:'$G(STOP) ANY^BPSOS2A
"RTN","BPSOS6D",44,0)
PRINT999 S VALMBCK="R"
"RTN","BPSOS6D",45,0)
 Q
"RTN","BPSOS6D",46,0)
MAKERXI ; IEN(*)=line numbers  we want to convert to prescription numbers
"RTN","BPSOS6D",47,0)
 ; builds RXI(*)="" or maybe data, ignore whatever you get on right side
"RTN","BPSOS6D",48,0)
 S IEN="" F  S IEN=$O(IEN(IEN)) Q:IEN=""  D MRXI
"RTN","BPSOS6D",49,0)
 Q
"RTN","BPSOS6D",50,0)
MRXI S RXI=$P(@DISPLINE@(IEN),U,2)
"RTN","BPSOS6D",51,0)
 I RXI S RXI(RXI)="" Q  ; a prescription detail line; take just the one
"RTN","BPSOS6D",52,0)
 ; else it's a patient line - take all of this patient's prescrip's
"RTN","BPSOS6D",53,0)
 N PAT S PAT=$P(@DISPLINE@(IEN),U)
"RTN","BPSOS6D",54,0)
 M RXI=@DISP@(PAT) ; merge in all of the patient's prescriptions
"RTN","BPSOS6D",55,0)
 Q  ; with RXI(*) array set up
"RTN","BPSOS6D",56,0)
CLAIMLOG ; protocol BPS P1 CLAIM LOG
"RTN","BPSOS6D",57,0)
 I '$D(@(VALMAR)) D NA G PRINT99
"RTN","BPSOS6D",58,0)
 W !,"Enter the line numbers for which you wish to print claim logs.",!
"RTN","BPSOS6D",59,0)
 N IEN D SELECPAT(.IEN) ; select prescription(s) or patients
"RTN","BPSOS6D",60,0)
 I $D(IEN)<10 G PRINT99
"RTN","BPSOS6D",61,0)
 N IO I '$$DEVICE G PRINT99
"RTN","BPSOS6D",62,0)
 U $P D:IO=$P FULL^VALM1 U IO
"RTN","BPSOS6D",63,0)
 N STOP,RXI D MAKERXI ; IEN(*) -> converted to RXI(*)
"RTN","BPSOS6D",64,0)
 ; now RXI(*) is the array of RXI's we want to print logs for
"RTN","BPSOS6D",65,0)
 S RXI="" F  S RXI=$O(RXI(RXI)) Q:RXI=""  S STOP=0 D CLAIMLOG^BPSOS6M(RXI,IO)
"RTN","BPSOS6D",66,0)
 G PRINT9
"RTN","BPSOS6D",67,0)
RECEIPT ; protocol BPS P1 RECEIPT ; print receipts
"RTN","BPSOS6D",68,0)
 I '$D(@(VALMAR)) D NA G PRINT99
"RTN","BPSOS6D",69,0)
 W !,"Enter the line numbers for which you wish to print ",$$NAME^BPSOS6E(3),".",!
"RTN","BPSOS6D",70,0)
 N IEN D SELECPAT(.IEN) ; select prescription(s) or patients
"RTN","BPSOS6D",71,0)
 I $D(IEN)<10 G PRINT99
"RTN","BPSOS6D",72,0)
 N IO I '$$DEVICE G PRINT99
"RTN","BPSOS6D",73,0)
 U $P D:IO=$P FULL^VALM1
"RTN","BPSOS6D",74,0)
 N RXI D MAKERXI ; IEN(*) -> converted to RXI(*)
"RTN","BPSOS6D",75,0)
 D RECEIPTS^BPSOS6E(.RXI,IO)
"RTN","BPSOS6D",76,0)
 D BYE^BPSOSU5
"RTN","BPSOS6D",77,0)
 G PRINT9
"RTN","BPSOS6D",78,0)
REVERSE ; protocol BPS P1 REVERSE CLAIM ; reverse selected claims
"RTN","BPSOS6D",79,0)
 I '$D(@(VALMAR)) D NA G PRINT99
"RTN","BPSOS6D",80,0)
 W "Select the line(s) with the paid claim(s) you wish to REVERSE.",!
"RTN","BPSOS6D",81,0)
 S WHERE="1REVERSE"
"RTN","BPSOS6D",82,0)
 N IEN D SELECPAT(.IEN,WHERE) ; select which ones to reverse
"RTN","BPSOS6D",83,0)
 N RXI D MAKERXI ; IEN(*) -> converted to RXI(*)
"RTN","BPSOS6D",84,0)
 D FULL^VALM1
"RTN","BPSOS6D",85,0)
 N REVTOTAL,REVELECT,ERRCOUNT S (REVTOTAL,REVELECT,ERRCOUNT)=0
"RTN","BPSOS6D",86,0)
 S RXI="" F  S RXI=$O(RXI(RXI)) Q:RXI=""  D
"RTN","BPSOS6D",87,0)
 . N X S X=$$REVERS59(RXI,0)
"RTN","BPSOS6D",88,0)
 . I X D
"RTN","BPSOS6D",89,0)
 . . S REVTOTAL=REVTOTAL+1
"RTN","BPSOS6D",90,0)
 . . I X>.5 S REVELECT=REVELECT+1
"RTN","BPSOS6D",91,0)
 . E  D
"RTN","BPSOS6D",92,0)
 . . W "Cannot reverse ",RXI,! S ERRCOUNT=ERRCOUNT+1
"RTN","BPSOS6D",93,0)
 W REVTOTAL," claim reversal",$S(REVTOTAL'=1:"s",1:"")," in progress.",!
"RTN","BPSOS6D",94,0)
 I ERRCOUNT D
"RTN","BPSOS6D",95,0)
 . W "Some claim(s) could not be reversed because only paper claims",!
"RTN","BPSOS6D",96,0)
 . W "and Payable electronic claims can be reversed.",!
"RTN","BPSOS6D",97,0)
 I REVELECT D TASK^BPSOSQ1 ; task up a packetizer
"RTN","BPSOS6D",98,0)
 H 2
"RTN","BPSOS6D",99,0)
 N NODISPLY S NODISPLY=1 D UPD^BPSOS6A
"RTN","BPSOS6D",100,0)
 S VALMBCK="R"
"RTN","BPSOS6D",101,0)
 Q
"RTN","BPSOS6D",102,0)
REVERS59(IEN59,WANTQ2)    ;EP - called from BPSOSRB too
"RTN","BPSOS6D",103,0)
 ; Input:
"RTN","BPSOS6D",104,0)
 ;   IEN59 as usual
"RTN","BPSOS6D",105,0)
 ;   $G(WANT2Q)=TRUE if you want packetizer started
"RTN","BPSOS6D",106,0)
 ; Returns:
"RTN","BPSOS6D",107,0)
 ;   0 if reversal was not created
"RTN","BPSOS6D",108,0)
 ;   IEN of reversal claim if ECME reversal was submitted
"RTN","BPSOS6D",109,0)
 ; Note: MOREDATA array newed/set by BPSNCPDP
"RTN","BPSOS6D",110,0)
 N OLDSLOT S OLDSLOT=$$GETSLOT^BPSOSL
"RTN","BPSOS6D",111,0)
 D SETSLOT^BPSOSL(IEN59)
"RTN","BPSOS6D",112,0)
 D LOG^BPSOSL($T(+0)_" - Reversal - begin")
"RTN","BPSOS6D",113,0)
 ;
"RTN","BPSOS6D",114,0)
 ; Update Start Time (15), Last Update (7), Reversal Reason (404), User (13),
"RTN","BPSOS6D",115,0)
 ;   and Status (1) in BPS Transactions
"RTN","BPSOS6D",116,0)
 N DIE,DR,DA
"RTN","BPSOS6D",117,0)
 S DIE=9002313.59,DA=IEN59
"RTN","BPSOS6D",118,0)
 S DR="13///"_$G(MOREDATA("USER"))_";15///NOW;7///NOW;1201///"_$G(MOREDATA("RX ACTION"))
"RTN","BPSOS6D",119,0)
 S DR=DR_";1///0;404///"_$G(MOREDATA("REVERSAL REASON"))
"RTN","BPSOS6D",120,0)
 ; Set REVERSE AFTER SUBMIT field if needed
"RTN","BPSOS6D",121,0)
 I $G(MOREDATA("REVERSE THEN RESUBMIT")) S DR=DR_";1.12///1"
"RTN","BPSOS6D",122,0)
 D ^DIE
"RTN","BPSOS6D",123,0)
 D LOG59A^BPSOSQB ; Log contents of 9002313.59
"RTN","BPSOS6D",124,0)
 D PREVISLY^BPSOSIZ(IEN59) ; bracket result text with [Previously: ]
"RTN","BPSOS6D",125,0)
 N CLAIMIEN S CLAIMIEN=$P(^BPST(IEN59,0),U,4) ; the claim
"RTN","BPSOS6D",126,0)
 N POS S POS=$P(^BPST(IEN59,0),U,9) ; and position therein
"RTN","BPSOS6D",127,0)
 N REV S REV=$$REVERSE^BPSECA8(CLAIMIEN,POS) ; construct reversal
"RTN","BPSOS6D",128,0)
 S DIE=9002313.59,DA=IEN59,DR="401////"_REV D ^DIE
"RTN","BPSOS6D",129,0)
 D LOG^BPSOSL($T(+0)_" - Reversal claim `"_REV_" "_$P(^BPSC(REV,0),U))
"RTN","BPSOS6D",130,0)
 N ABSBRXI S ABSBRXI=IEN59 D SETSTAT^BPSOSU(30) ; waiting to packetize
"RTN","BPSOS6D",131,0)
 I $G(WANTQ2) D TASK^BPSOSQ1
"RTN","BPSOS6D",132,0)
 D RELSLOT^BPSOSL,SETSLOT^BPSOSL(OLDSLOT)
"RTN","BPSOS6D",133,0)
 Q REV
"RTN","BPSOS6D",134,0)
REVERSP(IEN59) ;
"RTN","BPSOS6D",135,0)
 N ABSBRXI,OLDSLOT,X,MSG S MSG="Reversed paper claim"
"RTN","BPSOS6D",136,0)
 S $P(^BPST(IEN59,4),U,3)=1
"RTN","BPSOS6D",137,0)
 S ABSBRXI=IEN59
"RTN","BPSOS6D",138,0)
 D SETRESU^BPSOSU(1,MSG)
"RTN","BPSOS6D",139,0)
 D LOG59^BPSOSL(MSG,IEN59)
"RTN","BPSOS6D",140,0)
 D SETSTAT^BPSOSU(99)
"RTN","BPSOS6D",141,0)
 Q
"RTN","BPSOS6D",142,0)
RESUBMIT ;
"RTN","BPSOS6D",143,0)
 I '$D(@(VALMAR)) D NA G PRINT99
"RTN","BPSOS6D",144,0)
 S WHERE="1RESUBMIT"
"RTN","BPSOS6D",145,0)
 W "Select the line(s) with the claim(s) you wish to RESUBMIT.",!
"RTN","BPSOS6D",146,0)
 N IEN D SELECPAT(.IEN,WHERE) ; gives IEN(*)
"RTN","BPSOS6D",147,0)
 N RXI D MAKERXI ; IEN(*) -> converted to RXI(*)
"RTN","BPSOS6D",148,0)
 D FULL^VALM1
"RTN","BPSOS6D",149,0)
 N REVCOUNT S REVCOUNT=0
"RTN","BPSOS6D",150,0)
 N IEN59 S IEN59="" F  S IEN59=$O(RXI(IEN59)) Q:IEN59=""  D
"RTN","BPSOS6D",151,0)
 . I $D(^PSRX($P(IEN59,".",1),"D")) W "Cannot Reverse or Resubmit "_IEN59_" because it has been deleted in Pharmacy.",! H 2 Q
"RTN","BPSOS6D",152,0)
 .N X S X=$$RESULT59^BPSOSRX(IEN59)
"RTN","BPSOS6D",153,0)
 .S RXI=$P(IEN59,".")
"RTN","BPSOS6D",154,0)
 .S RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOS6D",155,0)
 . I $$STATUS^BPSOSRX(RXI,RXR)["E PAYABLE" W "Cannot Resubmit "_IEN59_" because it is PAYABLE - please reverse it first.",! H 2 Q
"RTN","BPSOS6D",156,0)
 .S FILLDATE=$$RXFLDT^PSOBPSUT(RXI,RXR)
"RTN","BPSOS6D",157,0)
 .S NDC=$$GETNDC^PSONDCUT(RXI,RXR)
"RTN","BPSOS6D",158,0)
 .S BILLNUM=$$EN^BPSNCPDP(RXI,RXR,FILLDATE,"ERES","")
"RTN","BPSOS6D",159,0)
 N NODISPLY S NODISPLY=1 D UPD^BPSOS6A
"RTN","BPSOS6D",160,0)
 S VALMBCK="R"
"RTN","BPSOS6D",161,0)
 Q
"RTN","BPSOS6D",162,0)
RESUB1(IEN59,MIN) ;
"RTN","BPSOS6D",163,0)
 ; Also called here from BPSOSU, for reverse-and-resubmit action
"RTN","BPSOS6D",164,0)
 ; Kill pointers of previous submissions and reversals
"RTN","BPSOS6D",165,0)
 N DIE,DR,DA,FN,ENTRY,FDA,MSG
"RTN","BPSOS6D",166,0)
 S DIE=9002313.59,DA=IEN59
"RTN","BPSOS6D",167,0)
 S DR="" N I F I=3,4,401:1:404,301:1:302,801:1:803 D
"RTN","BPSOS6D",168,0)
 . S:DR]"" DR=DR_";" S DR=DR_I_"///@"
"RTN","BPSOS6D",169,0)
 . S DR=DR_";15///NOW;7///NOW" ; stamp new starting time, too
"RTN","BPSOS6D",170,0)
 I '$G(MIN) D  ; BPS*1.0T7*11 this whole block
"RTN","BPSOS6D",171,0)
 . F I=10,11,1.05:.01:1.08,1.13,601:1:603,701:1:703 S DR=DR_";"_I_"///@"
"RTN","BPSOS6D",172,0)
 D ^DIE
"RTN","BPSOS6D",173,0)
 ;
"RTN","BPSOS6D",174,0)
 ; Delete DUR multiple
"RTN","BPSOS6D",175,0)
 K FDA,MSG
"RTN","BPSOS6D",176,0)
 S FN=9002313.5913,ENTRY=0
"RTN","BPSOS6D",177,0)
 F  S ENTRY=$O(^BPST(IEN59,13,ENTRY)) Q:+ENTRY=0  S FDA(FN,ENTRY_","_IEN59_",",.01)=""
"RTN","BPSOS6D",178,0)
 D FILE^DIE("","FDA","MSG")
"RTN","BPSOS6D",179,0)
 ;
"RTN","BPSOS6D",180,0)
 ; Bracket result text with "[Previously: ]"
"RTN","BPSOS6D",181,0)
 D PREVISLY^BPSOSIZ(IEN59)
"RTN","BPSOS6D",182,0)
RESUB2 ;LJE;had to shorten routine to less that 10000 bytes, so moved this subroutine to BPSOS6N
"RTN","BPSOS6D",183,0)
 D RESUB^BPSOS6N
"RTN","BPSOS6D",184,0)
 Q
"RTN","BPSOS6D",185,0)
DEVICE() ; device selection for POS
"RTN","BPSOS6D",186,0)
 ; want to provide a convenient default
"RTN","BPSOS6D",187,0)
 N DEFAULT S DEFAULT="HOME"
"RTN","BPSOS6D",188,0)
 N DEVICE S DEVICE=$$DEVICE^BPSOSU8(DEFAULT)
"RTN","BPSOS6D",189,0)
 I 'DEVICE Q ""
"RTN","BPSOS6D",190,0)
 Q DEVICE
"RTN","BPSOS6D",191,0)
CANCEL ; protocol BPS P1 CANCEL CLAIM
"RTN","BPSOS6D",192,0)
 I '$D(@(VALMAR)) D NA G PRINT99
"RTN","BPSOS6D",193,0)
 N LINE
"RTN","BPSOS6D",194,0)
 W !,"Select prescription to cancel by line number.  Hurry!"
"RTN","BPSOS6D",195,0)
 D SELECPAT(.LINE)
"RTN","BPSOS6D",196,0)
 I $O(LINE(""))="" W !,"None selected for cancellation",! G CAN99
"RTN","BPSOS6D",197,0)
 S LINE="" F  S LINE=$O(LINE(LINE)) Q:LINE=""  D
"RTN","BPSOS6D",198,0)
 .N PAT,RXI S PAT=$P(@DISPLINE@(LINE),U),RXI=$P(@DISPLINE@(LINE),U,2)
"RTN","BPSOS6D",199,0)
 .I RXI D CANC5^BPSOS6L Q
"RTN","BPSOS6D",200,0)
 .; else patient was selected; cancel all of this patient's claims
"RTN","BPSOS6D",201,0)
 .S RXI="" F  S RXI=$O(@DISP@(PAT,RXI)) Q:RXI=""  D CANC5^BPSOS6L
"RTN","BPSOS6D",202,0)
 W !,"Cancellation requests made." H 1
"RTN","BPSOS6D",203,0)
CAN99 D ANY^BPSOS2A ;D PRESSANY^BPSOSU5()
"RTN","BPSOS6D",204,0)
 N NODISPLY DO UPD^BPSOS6A S VALMBCK="R"
"RTN","BPSOS6D",205,0)
 Q
"RTN","BPSOS6D",206,0)
DISMISS ; protocol BPS P1 DISMISS ; dismiss a patient from my screen
"RTN","BPSOS6D",207,0)
DIS0 I '$D(@(VALMAR)) D NA G PRINT99
"RTN","BPSOS6D",208,0)
 N IEN,TIME,X,%,%I,%H D NOW^%DTC
"RTN","BPSOS6D",209,0)
 S TIME=$$TADD^BPSOSUD(%,^TMP("BPSOS",$J,"TIME"))
"RTN","BPSOS6D",210,0)
 D SELECPAT(.IEN)
"RTN","BPSOS6D",211,0)
 S IEN="" F  S IEN=$O(IEN(IEN)) Q:IEN=""  D
"RTN","BPSOS6D",212,0)
 .N PAT,RXI S PAT=@DISPLINE@(IEN),RXI=$P(PAT,U,2),PAT=$P(PAT,U)
"RTN","BPSOS6D",213,0)
 .S @DISMISS@(PAT)=TIME
"RTN","BPSOS6D",214,0)
 .I $D(@DISP@(PAT)) S $P(@DISP@(PAT),U,3)=0
"RTN","BPSOS6D",215,0)
 .W PAT," will be dismissed.",! H 1
"RTN","BPSOS6D",216,0)
 .I RXI D
"RTN","BPSOS6D",217,0)
 ..S @DISMISS@(PAT,RXI)=TIME
"RTN","BPSOS6D",218,0)
 ..I $D(@DISP@(PAT,RXI)) S $P(@DISP@(PAT,RXI),U,3)=0
"RTN","BPSOS6D",219,0)
DIS9 ; some other functions branch to here to go back to main screen
"RTN","BPSOS6D",220,0)
 N NODISPLY DO UPD^BPSOS6A S VALMBCK="R"
"RTN","BPSOS6D",221,0)
 Q
"RTN","BPSOS6D",222,0)
SELECPAT(RET,WHERE) ; Select a patient.  Returns patient IEN(s) in array
"RTN","BPSOS6D",223,0)
 N VALMA,VAMP,VALMI,VALMAT,VALMY
"RTN","BPSOS6D",224,0)
 S VALMLST="" S VALMLST=$O(^TMP("BPSOS",$J,"VALM","IDX"),-1)  ;8/30/04;get last entry
"RTN","BPSOS6D",225,0)
 D EN^VALM2(XQORNOD(0),"O") S VALMI=0 ; allow "O"ptionally answer
"RTN","BPSOS6D",226,0)
 W !
"RTN","BPSOS6D",227,0)
SELEC2 ;
"RTN","BPSOS6D",228,0)
 G SELEC3:'$G(WHERE)
"RTN","BPSOS6D",229,0)
 G SELEC3:'$D(VALMY)
"RTN","BPSOS6D",230,0)
 N WHICH S WHICH="",WHICH=$O(VALMY(WHICH))
"RTN","BPSOS6D",231,0)
 W !,"You've chosen to "_$S(WHERE["REVERSE":"REVERSE",WHERE["RESUB":"RESUBMIT",1:"?? ")_" the following prescription for "_$P(^TMP("BPSOS",$J,"DISPLINE",WHICH),"^",1)_":"
"RTN","BPSOS6D",232,0)
 W !,^TMP("BPSOS",$J,"VALM",WHICH,0)
"RTN","BPSOS6D",233,0)
 N OK R !,"Are you sure? <Y> ",OK:120 S OK=$TR(OK,"ynq","YNQ") S:OK="" OK="Y" I OK["^"!(OK="Q") Q
"RTN","BPSOS6D",234,0)
 I OK'="Y"&(OK'="N") W !!,"You must enter Y for Yes, N for No, or ^ to exit.",! G SELEC2
"RTN","BPSOS6D",235,0)
 Q:OK="^"!(OK="N")
"RTN","BPSOS6D",236,0)
 W !
"RTN","BPSOS6D",237,0)
SELEC3 ;
"RTN","BPSOS6D",238,0)
 M RET=VALMY
"RTN","BPSOS6D",239,0)
 Q
"RTN","BPSOS6D",240,0)
NA ;
"RTN","BPSOS6D",241,0)
 W !!,"There are no 'items' to select."
"RTN","BPSOS6D",242,0)
 Q
"RTN","BPSOS6E")
0^86^B4297708
"RTN","BPSOS6E",1,0)
BPSOS6E ;BHAM ISC/FCS/DRS/FLS - more overflow from ^BPSOS1 ;06/01/2004
"RTN","BPSOS6E",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6E",3,0)
 Q
"RTN","BPSOS6E",4,0)
NAME(X) ;EP - from BPSOS6D
"RTN","BPSOS6E",5,0)
 N % S %="DUR info" ; ="receipt"
"RTN","BPSOS6E",6,0)
 I '$G(X) Q %
"RTN","BPSOS6E",7,0)
 I X=3 ; S %=%_"s" ; plural
"RTN","BPSOS6E",8,0)
 I X=1 ; capitalize first letter
"RTN","BPSOS6E",9,0)
 I X=2 ; capitalize all
"RTN","BPSOS6E",10,0)
 Q %
"RTN","BPSOS6E",11,0)
RECEIPTS(RXIIEN,IO)   ;EP - from BPSOS6D
"RTN","BPSOS6E",12,0)
 ; Given RXIIEN(*) array of RXIs for which to print receipts
"RTN","BPSOS6E",13,0)
 ; and IO = IO device, caller does open & close
"RTN","BPSOS6E",14,0)
 ; $P is current device when this finishes, but IO still open
"RTN","BPSOS6E",15,0)
 N PAT
"RTN","BPSOS6E",16,0)
 U $P W "Printing ",$$NAME(3),"...",!
"RTN","BPSOS6E",17,0)
 ; Group by patient ; RXI(pat,rxi)=""
"RTN","BPSOS6E",18,0)
 N RXI S RXI="" F  S RXI=$O(RXIIEN(RXI)) Q:RXI=""  D
"RTN","BPSOS6E",19,0)
 . S PAT=$P(^BPST(RXI,0),U,6)
"RTN","BPSOS6E",20,0)
 . S RXI(PAT,RXI)=""
"RTN","BPSOS6E",21,0)
 ; Now print them
"RTN","BPSOS6E",22,0)
 S PAT="" F  S PAT=$O(RXI(PAT)) Q:PAT=""  D
"RTN","BPSOS6E",23,0)
 . U $P W "... for ",$P(^DPT(PAT,0),U),"...",!
"RTN","BPSOS6E",24,0)
 . S RXI="" F  S RXI=$O(RXI(PAT,RXI)) Q:RXI=""  D
"RTN","BPSOS6E",25,0)
 . . N REVERSAL S REVERSAL=$$REVERSAL(RXI)
"RTN","BPSOS6E",26,0)
 . . I REVERSAL U IO D RECEIPT(REVERSAL,1) U $P
"RTN","BPSOS6E",27,0)
 . . N CLAIM S CLAIM=$$CLAIM(RXI)
"RTN","BPSOS6E",28,0)
 . . I 'CLAIM W ?5,"Nothing to print for prescription `",RXI,! H 1 Q
"RTN","BPSOS6E",29,0)
 . . N POSITION S POSITION=$P(^BPST(RXI,0),"^",9)
"RTN","BPSOS6E",30,0)
 . . I 'POSITION W ?5,"This might not be the right ",$$NAME,".",! H 1
"RTN","BPSOS6E",31,0)
 . . U IO D RECEIPT(CLAIM,POSITION) U $P
"RTN","BPSOS6E",32,0)
 U IO I $Y'=0 W #
"RTN","BPSOS6E",33,0)
 U $P W "Done",! H 1
"RTN","BPSOS6E",34,0)
 Q
"RTN","BPSOS6E",35,0)
CLAIM(RXI)         ; $$ return claim #
"RTN","BPSOS6E",36,0)
 N CLAIM
"RTN","BPSOS6E",37,0)
 I 0 ;
"RTN","BPSOS6E",38,0)
 E  S CLAIM=$P(^BPST(RXI,0),U,4) ; else plain old claim
"RTN","BPSOS6E",39,0)
 Q CLAIM
"RTN","BPSOS6E",40,0)
REVERSAL(RXI)      Q $P($G(^BPST(RXI,4)),U)
"RTN","BPSOS6E",41,0)
RECEIPT(CLAIM,POSITION)    ; print a receipt for the given claim packet & pos
"RTN","BPSOS6E",42,0)
 N TMP D FILEMAN^BPSECP1("TMP",CLAIM,,POSITION) ; sets TMP(*)
"RTN","BPSOS6E",43,0)
 N TAG S TAG=$P($G(^BPS(9002313.99,1,"RECEIPT")),U) ; "ANMC" at ANMC
"RTN","BPSOS6E",44,0)
 I TAG="" S TAG="RECEIPT"
"RTN","BPSOS6E",45,0)
 D @(TAG_U_"BPSECP3")
"RTN","BPSOS6E",46,0)
 Q
"RTN","BPSOS6F")
0^87^B1605129
"RTN","BPSOS6F",1,0)
BPSOS6F ;BHAM ISC/FCS/DRS/FLS - debugging for BPSOS ;06/01/2004
"RTN","BPSOS6F",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6F",3,0)
 Q
"RTN","BPSOS6F",4,0)
 ; Problem:  errors occurring in BPSOS, but NEW commands
"RTN","BPSOS6F",5,0)
 ; and use of temp storage indexed by $J mean there's no wreckage
"RTN","BPSOS6F",6,0)
 ; to inspect.  Well, here, we copy some wreckage for analysis.
"RTN","BPSOS6F",7,0)
 ; It's a supplement to the main error log.
"RTN","BPSOS6F",8,0)
 ; Also, some extra $ZT set in BPSOS itself, to hopefully save
"RTN","BPSOS6F",9,0)
 ; what data is otherwise lost as NEW stuff is unwound.
"RTN","BPSOS6F",10,0)
LOGERR(WHERE)      ;EP - from BPSOS6I
"RTN","BPSOS6F",11,0)
 N ERRSPOT
"RTN","BPSOS6F",12,0)
 S ERRSPOT=$P($H,",",2)\600*600 ; leave ERRSPOT for error trap to report
"RTN","BPSOS6F",13,0)
 ; spread it out so only one every 10 minutes at most,
"RTN","BPSOS6F",14,0)
 ; just in case there's a flood of them (don't fill up disk)
"RTN","BPSOS6F",15,0)
 N ROU S ROU=$T(+0)
"RTN","BPSOS6F",16,0)
 K ^TMP("BPSOS6F",$J,ERRSPOT)
"RTN","BPSOS6F",17,0)
 S ^TMP("BPSOS6F",$J,ERRSPOT,"WHERE")=WHERE_" at "_$H
"RTN","BPSOS6F",18,0)
 M ^TMP("BPSOS6F",$J,ERRSPOT,"BPSOS")=^TMP("BPSOS",$J)
"RTN","BPSOS6F",19,0)
 M ^TMP("BPSOS6F",$J,ERRSPOT,"BPSOSUA")=^TMP("BPSOSUA",$J)
"RTN","BPSOS6F",20,0)
 I $D(VALMAR) M ^TMP("BPSOS6F",$J,ERRSPOT,"VALMAR")=@VALMAR
"RTN","BPSOS6F",21,0)
 S ^TMP("BPSOS6F",$J,ERRSPOT,"VALMCNT")=$G(VALMCNT)
"RTN","BPSOS6F",22,0)
 S ^TMP("BPSOS6F",$J,ERRSPOT,"VALMBG")=$G(VALMBG)
"RTN","BPSOS6F",23,0)
 S ^TMP("BPSOS6F",$J,ERRSPOT,"VALMAR")=$G(VALMAR)
"RTN","BPSOS6F",24,0)
 Q
"RTN","BPSOS6G")
0^88^B913136
"RTN","BPSOS6G",1,0)
BPSOS6G ;BHAM ISC/FCS/DRS - Return DUR responses ;06/01/2004
"RTN","BPSOS6G",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6G",3,0)
 Q
"RTN","BPSOS6G",4,0)
DURBRIEF(RXI)      ;EP - from BPSOS6B ;
"RTN","BPSOS6G",5,0)
 ; $$ brief version - for the list manager line
"RTN","BPSOS6G",6,0)
 N RESP S RESP=$P($G(^BPST(RXI,0)),"^",5)
"RTN","BPSOS6G",7,0)
 I 'RESP Q ""  ; no response message
"RTN","BPSOS6G",8,0)
 N ECME S POS=$P($G(^BPST(RXI,0)),"^",9)
"RTN","BPSOS6G",9,0)
 N DUR S DUR=$P($G(^BPSR(RESP,1000,POS,525)),"^")
"RTN","BPSOS6G",10,0)
 I DUR="" Q ""
"RTN","BPSOS6G",11,0)
 N I,RET S RET="" F I=1,54,107 D
"RTN","BPSOS6G",12,0)
 . N Y S Y=$E(DUR,I,I+53-1)
"RTN","BPSOS6G",13,0)
 . N X S X=$E(Y,1,2)
"RTN","BPSOS6G",14,0)
 . I "  0  00"[X Q
"RTN","BPSOS6G",15,0)
 . S:RET]"" RET=RET_" " S RET=RET_$$DUR^BPSECP2(X)
"RTN","BPSOS6G",16,0)
 . N MSG S MSG=$E(Y,20,49) F  Q:$E(MSG,$L(MSG))'=" "  D
"RTN","BPSOS6G",17,0)
 . . S MSG=$E(MSG,1,$L(MSG)-1)
"RTN","BPSOS6G",18,0)
 . I MSG]"" S RET=RET_"("_MSG_")"
"RTN","BPSOS6G",19,0)
 Q RET
"RTN","BPSOS6H")
0^89^B11933721
"RTN","BPSOS6H",1,0)
BPSOS6H ;BHAM ISC/FCS/DRS/FLS - Data Entry & Status Disp ;06/01/2004
"RTN","BPSOS6H",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6H",3,0)
 ; continuation of BPSOS6A:
"RTN","BPSOS6H",4,0)
 ;   SETLINE, INFOCT, COMMENTS
"RTN","BPSOS6H",5,0)
 Q
"RTN","BPSOS6H",6,0)
SETLINE(LINE,PAT,RXI) ;EP - from BPSOS6I
"RTN","BPSOS6H",7,0)
 ; set up given line# in array for given PAT name; R root
"RTN","BPSOS6H",8,0)
 ; LINE # in array to set
"RTN","BPSOS6H",9,0)
 ; PAT = which patient
"RTN","BPSOS6H",10,0)
 ; RXI: if present, set this up as a prescription line
"RTN","BPSOS6H",11,0)
 ;      if missing, set this up as a patient line
"RTN","BPSOS6H",12,0)
 N %,X,INFO D INFO^BPSOS6B(PAT,$G(RXI)) ; Set INFO(*) array
"RTN","BPSOS6H",13,0)
 ;
"RTN","BPSOS6H",14,0)
 ; Setting up - common to both patient and prescription lines:
"RTN","BPSOS6H",15,0)
 ;    X is started; whatever branch you go to will build on X
"RTN","BPSOS6H",16,0)
 ;
"RTN","BPSOS6H",17,0)
SETL1 K ^TMP("BPSOS",$J,"VALM","IDX",LINE) ; indexing for ^VALM2 call
"RTN","BPSOS6H",18,0)
 S X=$$SETFLD^VALM1($J(LINE,2),"","LINE NUMBER")
"RTN","BPSOS6H",19,0)
 ;
"RTN","BPSOS6H",20,0)
 ; Setting up for a prescription line:
"RTN","BPSOS6H",21,0)
 ;
"RTN","BPSOS6H",22,0)
SETL2 I $G(RXI) D
"RTN","BPSOS6H",23,0)
 .I LINE="" D
"RTN","BPSOS6H",24,0)
 . . D IMPOSS^BPSOSUE("P","TI","LINE null",,"SETL2",$T(+0))
"RTN","BPSOS6H",25,0)
 .I INFO("PATIEN")="" D
"RTN","BPSOS6H",26,0)
 . . D IMPOSS^BPSOSUE("P","TI","INFO(""PATIEN"") null",,"SETL2",$T(+0))
"RTN","BPSOS6H",27,0)
 .I RXI="" D
"RTN","BPSOS6H",28,0)
 . . D IMPOSS^BPSOSUE("P","TI","RXI null",,"SETL2",$T(+0))
"RTN","BPSOS6H",29,0)
 .S ^TMP("BPSOS",$J,"VALM","IDX",LINE,INFO("PATIEN"),RXI)=""
"RTN","BPSOS6H",30,0)
 .S X=$$SETFLD^VALM1($E($$GET1^DIQ(52,$P(RXI,"."),100,"E"),1,3),X,"PERCENT DONE") ; rx stat 
"RTN","BPSOS6H",31,0)
 .S X=$$SETFLD^VALM1(INFO("DRUG"),X,"PATIENT") ; drug name
"RTN","BPSOS6H",32,0)
 .N RF,RX,RL S RF=$P($G(^BPST(RXI,1)),U),RX=$P($G(^BPST(RXI,1)),U,11)
"RTN","BPSOS6H",33,0)
 .S RL=$S(RF=0:$P($G(^PSRX(RX,2)),"^",13),1:$P($G(^PSRX(RX,1,RF,0)),"^",18)),RL=$S(RL:"RL",1:"NR")
"RTN","BPSOS6H",34,0)
 .N C S C=RL_" "_INFO("RES") K RF,RX,RL ; this will be either status or result
"RTN","BPSOS6H",35,0)
 .;     DO INFO also tacked on the prescription number
"RTN","BPSOS6H",36,0)
 .S X=$$SETFLD^VALM1(C,X,"COMMENTS")
"RTN","BPSOS6H",37,0)
 .I $L(C)>80 S X=$$SETFLD^VALM1($E(C,81,160),X,"COMMENTS 2")
"RTN","BPSOS6H",38,0)
 .I $L(C)>160 S X=$$SETFLD^VALM1($E(C,161,$L(C)),X,"COMMENTS 3")
"RTN","BPSOS6H",39,0)
 ;
"RTN","BPSOS6H",40,0)
 ; Setting up for a patient line:
"RTN","BPSOS6H",41,0)
 ;
"RTN","BPSOS6H",42,0)
SETL3 E  D
"RTN","BPSOS6H",43,0)
 .Q:$G(INFO("PATIEN"))=""
"RTN","BPSOS6H",44,0)
 .S ^TMP("BPSOS",$J,"VALM","IDX",LINE,INFO("PATIEN"))=""
"RTN","BPSOS6H",45,0)
 .I INFO("%")=100 S INFO("%")="done"
"RTN","BPSOS6H",46,0)
 .E  S INFO("%")=" "_$J(INFO("%"),2)_"%"
"RTN","BPSOS6H",47,0)
 .S X=$$SETFLD^VALM1(INFO("%"),X,"PERCENT DONE")
"RTN","BPSOS6H",48,0)
 .S X=$$SETFLD^VALM1(PAT,X,"PATIENT")
"RTN","BPSOS6H",49,0)
 .N C S C=INFO("RES") ;$S(INFO("%")="done":$$COMMENTS,1:INFO("RES"))
"RTN","BPSOS6H",50,0)
 .S X=$$SETFLD^VALM1($E(C,1,80),X,"COMMENTS")
"RTN","BPSOS6H",51,0)
 .I $L(C)>80 S X=$$SETFLD^VALM1($E(C,81,160),X,"COMMENTS 2")
"RTN","BPSOS6H",52,0)
 .I $L(C)>160 S X=$$SETFLD^VALM1($E(C,161,210),X,"COMMENTS 3")
"RTN","BPSOS6H",53,0)
SETL9 D SET^VALM10(LINE,X,LINE)
"RTN","BPSOS6H",54,0)
 I $$VISIBLE^BPSOS6I(LINE) D WRITE^VALM10(LINE)
"RTN","BPSOS6H",55,0)
 Q
"RTN","BPSOS6H",56,0)
INFOCT(N)          ; how many of these things?
"RTN","BPSOS6H",57,0)
 I INFO("COUNT")=1 Q "" ; only one, so we display no count
"RTN","BPSOS6H",58,0)
 I N=INFO("COUNT") Q "ALL " ; more than one and they're all this way
"RTN","BPSOS6H",59,0)
 Q N_" "
"RTN","BPSOS6H",60,0)
COMMENTS()         ; construct the comments based on what's in the INFO array
"RTN","BPSOS6H",61,0)
 N %,A,M,X,Y S %="",M=255 ; M = max length 
"RTN","BPSOS6H",62,0)
 ; start with results
"RTN","BPSOS6H",63,0)
 I $O(INFO("RES",""))]"" D  ;
"RTN","BPSOS6H",64,0)
 .S A="" F  S A=$O(INFO("RES",A)) Q:A=""  D
"RTN","BPSOS6H",65,0)
 ..S %=%_$$INFOCT(INFO("RES",A)) ; how many of them
"RTN","BPSOS6H",66,0)
 ..S %=%_A
"RTN","BPSOS6H",67,0)
 ..S %=%_"; "
"RTN","BPSOS6H",68,0)
 ..I $L(%)>M S %=$E(%,1,$L(M))
"RTN","BPSOS6H",69,0)
 ; tack on statuses
"RTN","BPSOS6H",70,0)
 I INFO("%")'="done" D
"RTN","BPSOS6H",71,0)
 .S %=%_"STATUS: "
"RTN","BPSOS6H",72,0)
 .S A="" F  S A=$O(INFO("STAT",A)) Q:A=""  D
"RTN","BPSOS6H",73,0)
 ..S %=%_$$INFOCT(INFO("STAT",A))_$$STATI^BPSOSU(A)_"; " ; count,text
"RTN","BPSOS6H",74,0)
 ..I $L(%)>M S %=$E(%,1,$L(M))
"RTN","BPSOS6H",75,0)
 I %?.E1"; " S %=$E(%,1,253)
"RTN","BPSOS6H",76,0)
 Q %
"RTN","BPSOS6H",77,0)
DISPHIST(MSG,HANG) ;EP - DEBUGGING - to record history and pause
"RTN","BPSOS6H",78,0)
 Q:'$P($G(^BPS(9002313.99,1,"BPSOS6*")),U)
"RTN","BPSOS6H",79,0)
 S @DISPHIST=@DISPHIST+1
"RTN","BPSOS6H",80,0)
 S @DISPHIST@(@DISPHIST)=MSG
"RTN","BPSOS6H",81,0)
 Q:'$G(HANG)!$G(NODISPLY)
"RTN","BPSOS6H",82,0)
 HANG HANG
"RTN","BPSOS6H",83,0)
 Q
"RTN","BPSOS6I")
0^90^B73218359
"RTN","BPSOS6I",1,0)
BPSOS6I ;BHAM ISC/FCS/DRS/FLS - Data Entry & Status Disp ;06/01/2004
"RTN","BPSOS6I",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6I",3,0)
 ;
"RTN","BPSOS6I",4,0)
 ; ALL writes of screen lines as follows:
"RTN","BPSOS6I",5,0)
 ;  IF $$VISIBLE(line) DO WRITE^VALM10(line)
"RTN","BPSOS6I",6,0)
 ; When approp., set NODISPLY=true and $$VISIBLE returns false
"RTN","BPSOS6I",7,0)
 Q
"RTN","BPSOS6I",8,0)
 ; DISPDBG:  are we debugging the display?
"RTN","BPSOS6I",9,0)
DISPDBG() Q $P($G(^BPS(9002313.99,1,"BPSOS6*")),U)
"RTN","BPSOS6I",10,0)
DISPHIST(MSG,HANG) ; DEBUGGING - to record history and pause
"RTN","BPSOS6I",11,0)
 Q:'$$DISPDBG
"RTN","BPSOS6I",12,0)
 I '$D(HANG) S HANG=1
"RTN","BPSOS6I",13,0)
 D DISPHIST^BPSOS6H(MSG,HANG)
"RTN","BPSOS6I",14,0)
 Q
"RTN","BPSOS6I",15,0)
UPDATE(COUNTER)       ;EP - from BPSOS6A 
"RTN","BPSOS6I",16,0)
 ; with COUNTER = a count down, -1 for indefinite repeat
"RTN","BPSOS6I",17,0)
 N CHGCOUNT S CHGCOUNT=0
"RTN","BPSOS6I",18,0)
 N STOP F  D  Q:$G(STOP)
"RTN","BPSOS6I",19,0)
 .D UPD1
"RTN","BPSOS6I",20,0)
 .S COUNTER=COUNTER-1 I 'COUNTER S STOP=1 Q
"RTN","BPSOS6I",21,0)
 .I '$G(NODISPLY) D
"RTN","BPSOS6I",22,0)
 ..D MSG^VALM10("In continuous update mode: press Q to Quit")
"RTN","BPSOS6I",23,0)
 ..N X ;
"RTN","BPSOS6I",24,0)
 ..;Try doing this single-character read with ^XGKB
"RTN","BPSOS6I",25,0)
 ..S X=$$READ^XGKB(1,^TMP("BPSOS",$J,"FREQ"))
"RTN","BPSOS6I",26,0)
 ..I '$G(DTOUT),X]"","Qq^^"[X S STOP=1
"RTN","BPSOS6I",27,0)
 ..N Y F  R Y:0 Q:'$T  ; clean out typeahead (like mistaken arrow keys)
"RTN","BPSOS6I",28,0)
 Q
"RTN","BPSOS6I",29,0)
UPD1 ; one update cycle
"RTN","BPSOS6I",30,0)
 N NOW,PAT,RXI,T,CHG,LAST,OLDEST,ONEPAT D
"RTN","BPSOS6I",31,0)
 .N %,%H,%I,X D NOW^%DTC S NOW=%
"RTN","BPSOS6I",32,0)
 S ONEPAT=^TMP("BPSOS",$J,"PATIENT")
"RTN","BPSOS6I",33,0)
 I ONEPAT D
"RTN","BPSOS6I",34,0)
 .S T=^TMP("BPSOS",$J,"PATIENT TIME")
"RTN","BPSOS6I",35,0)
 .S CHG=$$SORT^BPSOSUA(0,ONEPAT,T,1)
"RTN","BPSOS6I",36,0)
 E  D
"RTN","BPSOS6I",37,0)
 .S T=^TMP("BPSOS",$J,"LAST UPDATE") ; absolute time on 2nd & subseq
"RTN","BPSOS6I",38,0)
 .I T="" S T=^TMP("BPSOS",$J,"TIME") ; delta time on 1st call
"RTN","BPSOS6I",39,0)
 .S ^TMP("BPSOS",$J,"LAST UPDATE")=NOW ; remember the time you did this
"RTN","BPSOS6I",40,0)
 .S CHG=$$SORT^BPSOSUA(^TMP("BPSOS",$J,"USER"),,T) ; get changes
"RTN","BPSOS6I",41,0)
 S OLDEST=$$TADD^BPSOSUD(NOW,-^TMP("BPSOS",$J,"TIME"))
"RTN","BPSOS6I",42,0)
 ;
"RTN","BPSOS6I",43,0)
 ; Deal with dismissals
"RTN","BPSOS6I",44,0)
 ;
"RTN","BPSOS6I",45,0)
 S PAT="" F  S PAT=$O(@DISMISS@(PAT)) Q:PAT=""  D
"RTN","BPSOS6I",46,0)
 .I PAT'?1"*".E,'ONEPAT Q
"RTN","BPSOS6I",47,0)
 .I @DISMISS@(PAT)<OLDEST K @DISMISS@(PAT) Q  ; dismissal order expired
"RTN","BPSOS6I",48,0)
 .I '$D(@CHG@(PAT)) Q  ; no changes for this patient
"RTN","BPSOS6I",49,0)
 .S RXI="" F  S RXI=$O(@DISMISS@(PAT,RXI)) Q:RXI=""  D
"RTN","BPSOS6I",50,0)
 ..I @DISMISS@(PAT,RXI)<OLDEST K @DISMISS@(PAT,RXI) Q  ; order expired
"RTN","BPSOS6I",51,0)
 ..I $D(@CHG@(PAT,RXI)) D  ; a change has occurred in a dismissed RX
"RTN","BPSOS6I",52,0)
 ...K @CHG@(PAT,RXI) ; so ignore the change
"RTN","BPSOS6I",53,0)
 ...I $O(@CHG@(PAT,""))="" K @CHG@(PAT) ; and maybe patient is empty
"RTN","BPSOS6I",54,0)
 S CHGCOUNT=$G(CHGCOUNT)+1
"RTN","BPSOS6I",55,0)
 I $$DISPDBG D
"RTN","BPSOS6I",56,0)
 . K ^TMP("BPSOS",$J,"CHG",CHGCOUNT)
"RTN","BPSOS6I",57,0)
 . M ^TMP("BPSOS",$J,"CHG",CHGCOUNT)=@CHG
"RTN","BPSOS6I",58,0)
 ; And you have DISP,DISPLINE,DISPIDX already set up from caller
"RTN","BPSOS6I",59,0)
 ;
"RTN","BPSOS6I",60,0)
 ; Now deal with any surviving changes
"RTN","BPSOS6I",61,0)
 ;
"RTN","BPSOS6I",62,0)
 S PAT="" F  S PAT=$O(@CHG@(PAT)) Q:PAT=""  D UPDPAT
"RTN","BPSOS6I",63,0)
 ;
"RTN","BPSOS6I",64,0)
 ; And finally, weed out any which haven't seen any changes
"RTN","BPSOS6I",65,0)
 ; in the last ^TMP("BPSOS",$J,"TIME") time
"RTN","BPSOS6I",66,0)
 ;
"RTN","BPSOS6I",67,0)
 I 'ONEPAT S PAT="" F  S PAT=$O(@DISP@(PAT)) Q:PAT=""  D
"RTN","BPSOS6I",68,0)
 .S X=@DISP@(PAT),LAST=$P(X,U,3) ; last update for this patient
"RTN","BPSOS6I",69,0)
 .I LAST<OLDEST,$P(X,U,4)*100=$P(X,U,2) D  ; old & complete
"RTN","BPSOS6I",70,0)
 ..D DISPHIST("Deleting "_PAT_" "_LAST_"<"_OLDEST)
"RTN","BPSOS6I",71,0)
 ..N NLINES S NLINES=$P(X,U,4)+1 ; how many line this one occupies
"RTN","BPSOS6I",72,0)
 ..D SHIFTUP($P(X,U)+NLINES,$P(X,U)) ; 
"RTN","BPSOS6I",73,0)
 ..K @DISP@(PAT)
"RTN","BPSOS6I",74,0)
 Q
"RTN","BPSOS6I",75,0)
UPDPAT ; Update for a given @CHG@(PAT)
"RTN","BPSOS6I",76,0)
 N NEWPAT,RXI,I
"RTN","BPSOS6I",77,0)
 N PATCHG S PATCHG=0 ; "patient changed", set to 1 if so
"RTN","BPSOS6I",78,0)
 D DISPHIST("UPDPAT for PAT="_PAT,0)
"RTN","BPSOS6I",79,0)
 ;
"RTN","BPSOS6I",80,0)
 I $D(@DISP@(PAT)) S NEWPAT=0 G UPD2 ; nope, we already have them
"RTN","BPSOS6I",81,0)
 ;
"RTN","BPSOS6I",82,0)
 D DISPHIST("New patient not yet on our list",0)
"RTN","BPSOS6I",83,0)
 S (NEWPAT,PATCHG)=1 ; set "new patient" flag
"RTN","BPSOS6I",84,0)
 N NPRESC S NPRESC=@CHG@(PAT) ; how many prescriptions
"RTN","BPSOS6I",85,0)
 N NLINES S NLINES=NPRESC+1 ; plus one more line for the patient
"RTN","BPSOS6I",86,0)
 I VALMCNT+NLINES>^TMP("BPSOS",$J,"MAX LINES") Q  ; overflow
"RTN","BPSOS6I",87,0)
 N PATNEXT S PATNEXT=$O(@DISP@(PAT))
"RTN","BPSOS6I",88,0)
 I PATNEXT="" D  ; the new patient and prescriptions go at end
"RTN","BPSOS6I",89,0)
 .S LINE=@DISPLINE+1 ; this is the new line number
"RTN","BPSOS6I",90,0)
 .S (VALMCNT,@DISPLINE)=@DISPLINE+NLINES ; update count of total lines
"RTN","BPSOS6I",91,0)
 .D DISPHIST("Goes at end, on line #"_LINE,0)
"RTN","BPSOS6I",92,0)
 E  D  ; the new patient pushes the next one downward
"RTN","BPSOS6I",93,0)
 .D DISPHIST("Pushes existing ones at line "_LINE_" down "_NLINES,1)
"RTN","BPSOS6I",94,0)
 .S LINE=$P(@DISP@(PATNEXT),U)
"RTN","BPSOS6I",95,0)
 .D SHIFTDN(LINE,NLINES)
"RTN","BPSOS6I",96,0)
 ;
"RTN","BPSOS6I",97,0)
 ; common handling for new patient, whether at end or not
"RTN","BPSOS6I",98,0)
 ;
"RTN","BPSOS6I",99,0)
 S @DISP@(PAT)=LINE_U_U_U_NPRESC
"RTN","BPSOS6I",100,0)
 S @DISPLINE@(LINE)=PAT_U ; remember who's stored here
"RTN","BPSOS6I",101,0)
 ;
"RTN","BPSOS6I",102,0)
 ; Init for each prescription that came with this new patient
"RTN","BPSOS6I",103,0)
 ;
"RTN","BPSOS6I",104,0)
 S RXI="" ; should always get @CHG@(PAT) iterations, right?
"RTN","BPSOS6I",105,0)
 F I=1:1:@CHG@(PAT) S RXI=$O(@CHG@(PAT,"RXI",RXI)) Q:RXI=""  D
"RTN","BPSOS6I",106,0)
 .S @DISP@(PAT,RXI)=(LINE+I)_U_U
"RTN","BPSOS6I",107,0)
 .S @DISPLINE@(LINE+I)=PAT_U_RXI
"RTN","BPSOS6I",108,0)
 ;
"RTN","BPSOS6I",109,0)
 ; and fall through to treat the rest of it same as existing patient
"RTN","BPSOS6I",110,0)
 G UPD3
"RTN","BPSOS6I",111,0)
UPD2 ;
"RTN","BPSOS6I",112,0)
 ; Patient was already in our list, but maybe there are
"RTN","BPSOS6I",113,0)
 ; new prescriptions for which we must make room
"RTN","BPSOS6I",114,0)
 ;
"RTN","BPSOS6I",115,0)
 S RXI="" F I=1:1:@CHG@(PAT) S RXI=$O(@CHG@(PAT,"RXI",RXI)) D
"RTN","BPSOS6I",116,0)
 .Q:$D(@DISP@(PAT,RXI))  ; prescription already has a spot
"RTN","BPSOS6I",117,0)
 .I VALMCNT+1>^TMP("BPSOS",$J,"MAX LINES") Q  ; overflow
"RTN","BPSOS6I",118,0)
 .N I ; protect index
"RTN","BPSOS6I",119,0)
 .D DISPHIST("New prescription "_RXI_" for "_PAT,0)
"RTN","BPSOS6I",120,0)
 .;
"RTN","BPSOS6I",121,0)
 .; a new prescription for the already-existent patient
"RTN","BPSOS6I",122,0)
 .; assign a line for it and shift everything else down
"RTN","BPSOS6I",123,0)
 .;
"RTN","BPSOS6I",124,0)
 .S PATCHG=1 ; flag: "patient info has changed"
"RTN","BPSOS6I",125,0)
 .N ADDATEND
"RTN","BPSOS6I",126,0)
 .N RXINEXT S RXINEXT=$O(@DISP@(PAT,RXI))
"RTN","BPSOS6I",127,0)
 .I RXINEXT S LINE=$P(@DISP@(PAT,RXINEXT),U),ADDATEND=0
"RTN","BPSOS6I",128,0)
 .E  D  ; prescription comes at end of this patient's stuff
"RTN","BPSOS6I",129,0)
 ..N PATNEXT S PATNEXT=$O(@DISP@(PAT))
"RTN","BPSOS6I",130,0)
 ..I PATNEXT="" S ADDATEND=1
"RTN","BPSOS6I",131,0)
 ..E  S LINE=$P(@DISP@(PATNEXT),U),ADDATEND=0
"RTN","BPSOS6I",132,0)
 .I ADDATEND D  ; adding at end, nothing needs to be shifted down
"RTN","BPSOS6I",133,0)
 ..S LINE=@DISPLINE+1,(VALMCNT,@DISPLINE)=@DISPLINE+1
"RTN","BPSOS6I",134,0)
 .E  D  ; adding in the middle or beginning; need to shift down
"RTN","BPSOS6I",135,0)
 ..D SHIFTDN(LINE,1)
"RTN","BPSOS6I",136,0)
 .;
"RTN","BPSOS6I",137,0)
 .; no matter where we added the new prescription, do the following:
"RTN","BPSOS6I",138,0)
 .;
"RTN","BPSOS6I",139,0)
 .S @DISP@(PAT,RXI)=LINE_U_U
"RTN","BPSOS6I",140,0)
 .S @DISPLINE@(LINE)=PAT_U_RXI ; 02/02/2000
"RTN","BPSOS6I",141,0)
 .S $P(@DISP@(PAT),U,4)=$P(@DISP@(PAT),U,4)+1
"RTN","BPSOS6I",142,0)
 ;
"RTN","BPSOS6I",143,0)
UPD3 ; this patient is already in our list (maybe having just been added)
"RTN","BPSOS6I",144,0)
 ; The patient and all of his prescriptions have display space
"RTN","BPSOS6I",145,0)
 ; Now we can deal with the actual changes (date-time of change,status)
"RTN","BPSOS6I",146,0)
 S RXI="" F I=1:1:@CHG@(PAT) D
"RTN","BPSOS6I",147,0)
 .S RXI=$O(@CHG@(PAT,"RXI",RXI)) ; next changed prescription
"RTN","BPSOS6I",148,0)
 .N X S X=@CHG@(PAT,"RXI",RXI) ; status^dateTimeof last change
"RTN","BPSOS6I",149,0)
 .I '$D(@DISP@(PAT,RXI)) D LOGERR^BPSOS6F("UPD3^BPSOS") ; 01/27/2000
"RTN","BPSOS6I",150,0)
 .I X=$P(@DISP@(PAT,RXI),U,2,3) D  Q  ; we saw this last time around
"RTN","BPSOS6I",151,0)
 ..D DISPHIST("UPD3: already processed this one, so quit early")
"RTN","BPSOS6I",152,0)
UPD4 .N S,D S S=$P(X,U),D=$P(X,U,2)
"RTN","BPSOS6I",153,0)
 .N L S L=$P(@DISP@(PAT,RXI),U) ; line #
"RTN","BPSOS6I",154,0)
UPD5 .I S=100,$P(@DISP@(PAT,RXI),U,2)'=100 D  ; marking as complete
"RTN","BPSOS6I",155,0)
 ..N B S B=$$BUCKET^BPSOS6B(RXI)
"RTN","BPSOS6I",156,0)
 ..S $P(@DISP@(PAT),U,B)=$P(@DISP@(PAT),U,B)+1
"RTN","BPSOS6I",157,0)
 .S @DISP@(PAT,RXI)=L_U_S_U_D ; line^status^dateTime of change
"RTN","BPSOS6I",158,0)
UPD6 .I D>$P(@DISP@(PAT),U,3) S $P(@DISP@(PAT),U,3)=D,PATCHG=1
"RTN","BPSOS6I",159,0)
 .D SETLINE^BPSOS6H(L,PAT,RXI) ; update list manager data and disp. if visible
"RTN","BPSOS6I",160,0)
 ;
"RTN","BPSOS6I",161,0)
UPD7 ; Sum the total of the statuses - used for computing %done
"RTN","BPSOS6I",162,0)
 N TOTSTAT S TOTSTAT=0
"RTN","BPSOS6I",163,0)
 S RXI="" F I=1:1:$P(@DISP@(PAT),U,4) D
"RTN","BPSOS6I",164,0)
 .S RXI=$O(@DISP@(PAT,RXI))
"RTN","BPSOS6I",165,0)
 .S TOTSTAT=TOTSTAT+$P(@DISP@(PAT,RXI),U,2)
"RTN","BPSOS6I",166,0)
 I TOTSTAT'=$P(@DISP@(PAT),U,2) S PATCHG=1 ; total of statuses changed
"RTN","BPSOS6I",167,0)
 S $P(@DISP@(PAT),U,2)=TOTSTAT
"RTN","BPSOS6I",168,0)
 D DISPHIST("After summing:"_@DISP@(PAT))
"RTN","BPSOS6I",169,0)
 ;
"RTN","BPSOS6I",170,0)
 ; If the patient data changed, update the list manager data and
"RTN","BPSOS6I",171,0)
 ; if the line is visible, update the display, too
"RTN","BPSOS6I",172,0)
 ;
"RTN","BPSOS6I",173,0)
 D SETLINE^BPSOS6H($P(@DISP@(PAT),U),PAT)
"RTN","BPSOS6I",174,0)
 Q
"RTN","BPSOS6I",175,0)
VISIBLE(LINE)      ;EP - from BPSOS6H -  is LINE number visible?
"RTN","BPSOS6I",176,0)
 ; HARDCODED!!!  list region is from line 6 to line 18
"RTN","BPSOS6I",177,0)
 ; ASSUMPTION!!  VALMBG is the first line number displayed
"RTN","BPSOS6I",178,0)
 ; so lines VALMBG through VALMBG+(18-6) are visitble
"RTN","BPSOS6I",179,0)
 I $G(NODISPLY) Q 0
"RTN","BPSOS6I",180,0)
 I '$G(VALMBG) Q 0
"RTN","BPSOS6I",181,0)
 I LINE<VALMBG Q 0
"RTN","BPSOS6I",182,0)
 I LINE>(VALMBG+(18-6)) Q 0
"RTN","BPSOS6I",183,0)
 Q 1
"RTN","BPSOS6I",184,0)
SHIFTDN(LINE,NLINES)         ; as in when something is inserted
"RTN","BPSOS6I",185,0)
 D DISPHIST("SHIFTDN(LINE,NLINES) for "_LINE_","_NLINES)
"RTN","BPSOS6I",186,0)
 F I=VALMCNT:-1:LINE D
"RTN","BPSOS6I",187,0)
 .D MOVELINE(I,I+NLINES)
"RTN","BPSOS6I",188,0)
 S (@DISPLINE,VALMCNT)=VALMCNT+NLINES
"RTN","BPSOS6I",189,0)
 Q
"RTN","BPSOS6I",190,0)
MOVELINE(FROM,TO,CLR)  ;
"RTN","BPSOS6I",191,0)
 D DISPHIST("Move line "_FROM_" to "_TO_";visible="_$$VISIBLE(TO)_","_$$VISIBLE(FROM))
"RTN","BPSOS6I",192,0)
 D DISPHIST("VALMAR="_VALMAR)
"RTN","BPSOS6I",193,0)
 M @DISPHIST@(@DISPHIST,"VALMAR")=@VALMAR
"RTN","BPSOS6I",194,0)
 I '$D(@DISPLINE@(FROM)) D LOGERR^BPSOS6F("MOVELINE^BPSOS") ;01/27/2000
"RTN","BPSOS6I",195,0)
 N PAT,RXI,X S X=@DISPLINE@(FROM),PAT=$P(X,U),RXI=$P(X,U,2)
"RTN","BPSOS6I",196,0)
 I $G(RXI) S $P(@DISP@(PAT,RXI),U)=TO
"RTN","BPSOS6I",197,0)
 E  S $P(@DISP@(PAT),U)=TO
"RTN","BPSOS6I",198,0)
 S @DISPLINE@(TO)=@DISPLINE@(FROM)
"RTN","BPSOS6I",199,0)
 D SET^VALM10(TO,@VALMAR@(FROM,0),TO) ; set destination = new contents
"RTN","BPSOS6I",200,0)
 D FLDTEXT^VALM10(TO,"LINE NUMBER",$J(TO,2)) ; fix line number in dest
"RTN","BPSOS6I",201,0)
 I $$VISIBLE(TO) D WRITE^VALM10(TO) ; if any visible, write them 
"RTN","BPSOS6I",202,0)
 I $G(CLR) D CLRLINE(FROM)
"RTN","BPSOS6I",203,0)
 D DISPHIST("Move line "_FROM_" to "_TO_" complete")
"RTN","BPSOS6I",204,0)
 Q
"RTN","BPSOS6I",205,0)
CLRLINE(N) ; clear out line N
"RTN","BPSOS6I",206,0)
 D DISPHIST("Clearing line "_N_", $$VISIBLE(N)="_$$VISIBLE(N))
"RTN","BPSOS6I",207,0)
 D SET^VALM10(N," ") ; clear contents of source line
"RTN","BPSOS6I",208,0)
 I $$VISIBLE(N) D WRITE^VALM10(N)
"RTN","BPSOS6I",209,0)
 S @DISPLINE@(N)="DELETED "_@DISPLINE@(N)
"RTN","BPSOS6I",210,0)
 K @VALMAR@("IDX",N)
"RTN","BPSOS6I",211,0)
 Q
"RTN","BPSOS6I",212,0)
SHIFTUP(FROM,TO)   ; move upward from SRC to DST, all the way to end
"RTN","BPSOS6I",213,0)
 D DISPHIST("SHIFTUP(FROM,TO) for "_FROM_","_TO)
"RTN","BPSOS6I",214,0)
 I FROM'>TO D  Q
"RTN","BPSOS6I",215,0)
 . D IMPOSS^BPSOSUE("P","TI","bad params FROM="_FROM_",TO="_TO,,"SHIFTUP",$T(+0))
"RTN","BPSOS6I",216,0)
 N NLINES S NLINES=FROM-TO
"RTN","BPSOS6I",217,0)
 F  Q:FROM>VALMCNT  D
"RTN","BPSOS6I",218,0)
 .D MOVELINE(FROM,TO,0)
"RTN","BPSOS6I",219,0)
 .S FROM=FROM+1,TO=TO+1
"RTN","BPSOS6I",220,0)
 F  D CLRLINE(TO) Q:TO=VALMCNT  S TO=TO+1
"RTN","BPSOS6I",221,0)
 S (VALMCNT,@DISPLINE)=VALMCNT-NLINES
"RTN","BPSOS6I",222,0)
 Q
"RTN","BPSOS6J")
0^91^B13752580
"RTN","BPSOS6J",1,0)
BPSOS6J ;BHAM ISC/FCS/DRS/FLS - user screen subrous ;06/01/2004
"RTN","BPSOS6J",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6J",3,0)
 Q
"RTN","BPSOS6J",4,0)
HEADER ; protocol BPS P1 HEADER ; edit header  (CV  "Change view screen")
"RTN","BPSOS6J",5,0)
 ; first, ask "All users or just one user or one patient?"
"RTN","BPSOS6J",6,0)
 D FULL^VALM1
"RTN","BPSOS6J",7,0)
 K ^TMP("BPSOS",$J) D MYPARAMS^BPSOS6C S ^TMP("BPSOS",$J,"HIST")=0,^TMP("BPSOS",$J,"DISPLINE")=0
"RTN","BPSOS6J",8,0)
 N WHO,TIMEWIN,PAT,PATTIME,UPDFREQ,DIC,DA,Y,X,DTOUT,DUOUT
"RTN","BPSOS6J",9,0)
 W !
"RTN","BPSOS6J",10,0)
HDR1 S X=$$SET^BPSOSU3("Display for  1:One user  or  2:All users  or  3:One patient? ","1",0,"H","1:One user;2:All users;3:One patient")
"RTN","BPSOS6J",11,0)
 W !
"RTN","BPSOS6J",12,0)
 I X<1 G HDR8A
"RTN","BPSOS6J",13,0)
 ; Note: one user / one patient combination is not implemented 
"RTN","BPSOS6J",14,0)
 ;  If you choose one patient, you get them all, regardless of user,
"RTN","BPSOS6J",15,0)
 ;  and the time window for weeding out old ones does not apply.
"RTN","BPSOS6J",16,0)
 I X=2 S WHO=0 S VALMHDR(1)="All Prescriptions for all Users" G HDR3  ;LJE
"RTN","BPSOS6J",17,0)
 I X=3 S WHO=0 G HDRA ; and later come back to HDR88 or HDR8A
"RTN","BPSOS6J",18,0)
HDR2 ; just one user - which one?
"RTN","BPSOS6J",19,0)
 S DIC=200,DIC(0)="AEMNQZ",DIC("A")="Select ECME user: "
"RTN","BPSOS6J",20,0)
 S DIC("B")=$$GET1^DIQ(200,DUZ,.01)
"RTN","BPSOS6J",21,0)
 D ^DIC W ! G HDR8A:$G(DUOUT)!$G(DTOUT),HDR1:Y<1 S WHO=+Y,VALMHDR(1)="Transmitted by "_$$GET1^DIQ(200,+Y,.01)  ;LJE
"RTN","BPSOS6J",22,0)
HDR3 ; time frame to keep patient on screen
"RTN","BPSOS6J",23,0)
 W !,"Enter the number of DAYS, the length of time that",!
"RTN","BPSOS6J",24,0)
 W "completed transactions will be retained on the screen.",!
"RTN","BPSOS6J",25,0)
 S X=^TMP("BPSOS",$J,"PATIENT TIME")
"RTN","BPSOS6J",26,0)
 S X=$$NUMERIC^BPSOSU2("Number of days:  ",X,1,1,365) W !
"RTN","BPSOS6J",27,0)
 S ^TMP("BPSOS",$J,"PATIENT TIME")=X
"RTN","BPSOS6J",28,0)
 I X<1 G HDR8A
"RTN","BPSOS6J",29,0)
 I X'?1N.N!(X>365) W " ??" G HDR3
"RTN","BPSOS6J",30,0)
 S TIMEWIN=X_".0015"
"RTN","BPSOS6J",31,0)
HDR4 ; Frequency of updates in continuous update mode
"RTN","BPSOS6J",32,0)
 ; HDRA rejoins here
"RTN","BPSOS6J",33,0)
 S X=5 ; minimum allowed value for frequency
"RTN","BPSOS6J",34,0)
 W !,"Enter the number of SECONDS between updates when the display",!
"RTN","BPSOS6J",35,0)
 W "is in CONTINUOUS UPDATE MODE.",!
"RTN","BPSOS6J",36,0)
 S X=$$NUMERIC^BPSOSU2("Seconds between updates: ",^TMP("BPSOS",$J,"FREQ"),0,X,9999,0) W !
"RTN","BPSOS6J",37,0)
 I X'?1N.N G HDR8A
"RTN","BPSOS6J",38,0)
 S UPDFREQ=X
"RTN","BPSOS6J",39,0)
HDR8 S ^TMP("BPSOS",$J,"USER")=WHO
"RTN","BPSOS6J",40,0)
 I TIMEWIN'=^TMP("BPSOS",$J,"TIME") S ^TMP("BPSOS",$J,"TIME")=TIMEWIN,^TMP("BPSOS",$J,"LAST UPDATE")=""
"RTN","BPSOS6J",41,0)
 S TIME=^TMP("BPSOS",$J,"TIME")
"RTN","BPSOS6J",42,0)
 S ^TMP("BPSOS",$J,"FREQ")=UPDFREQ
"RTN","BPSOS6J",43,0)
 S ^TMP("BPSOS",$J,"PATIENT")=0
"RTN","BPSOS6J",44,0)
HDR88 W !,"Settings have been changed.",!
"RTN","BPSOS6J",45,0)
 ; at this point, shouldn't we wipe everything off and rebuild?
"RTN","BPSOS6J",46,0)
 N NODISPLY S NODISPLY=1 D HDR^BPSOS6C D UPD^BPSOS6A  ;LJE
"RTN","BPSOS6J",47,0)
 S VALMPGE=1
"RTN","BPSOS6J",48,0)
 G HDR9
"RTN","BPSOS6J",49,0)
HDR8A W !,"No settings have been changed.",!
"RTN","BPSOS6J",50,0)
HDR9 W "Done",! H 2
"RTN","BPSOS6J",51,0)
 S VALMBCK="R"
"RTN","BPSOS6J",52,0)
 Q
"RTN","BPSOS6J",53,0)
HDRA ; display for which one patient?
"RTN","BPSOS6J",54,0)
 ; *BPS*1.0T7*7* :
"RTN","BPSOS6J",55,0)
 ;    Want to do the lookup with DUZ(2)=0 so as to be able to
"RTN","BPSOS6J",56,0)
 ;    access all ECME patients regardless of division.
"RTN","BPSOS6J",57,0)
 ;    SAC 2.3.1.4.1 says this is okay so long as we reset DUZ(2)
"RTN","BPSOS6J",58,0)
 ;    to its original value.
"RTN","BPSOS6J",59,0)
 N BPSDUZ2 S BPSDUZ2=+$G(DUZ(2)),DUZ(2)=0 ; BPS*1.0T7*7
"RTN","BPSOS6J",60,0)
 S DIC=2,DIC(0)="AEMQZ",DIC("A")="Prescriptions for which patient? "
"RTN","BPSOS6J",61,0)
 S DIC("S")="I $D(^BPST(""AC"",Y))"
"RTN","BPSOS6J",62,0)
 D ^DIC W !
"RTN","BPSOS6J",63,0)
 S DUZ(2)=BPSDUZ2 ; Restore original DUZ(2) ; BPS*1.0T7*7
"RTN","BPSOS6J",64,0)
 G HDR9:$G(DUOUT)!$G(DTOUT),HDRA:(Y<1)  S PAT=+Y
"RTN","BPSOS6J",65,0)
 W !,"Enter the number of DAYS to go back to find"
"RTN","BPSOS6J",66,0)
 W !,"ECME activity for ",$P(Y(0),U),"."
"RTN","BPSOS6J",67,0)
 S ^TMP("BPSOS",$J,"PATIENT TIME")=30
"RTN","BPSOS6J",68,0)
 S ^TMP("BPSOS",$J,"TIME")=.0015
"RTN","BPSOS6J",69,0)
 S ^TMP("BPSOS",$J,"HIST")=1
"RTN","BPSOS6J",70,0)
 S ^TMP("BPSOS",$J,"MAX LINES")=1000
"RTN","BPSOS6J",71,0)
 S ^TMP("BPSOS",$J,"USER")=DUZ
"RTN","BPSOS6J",72,0)
 S ^TMP("BPSOS",$J,"DISPLINE")=0
"RTN","BPSOS6J",73,0)
 S VALMCNT=0
"RTN","BPSOS6J",74,0)
 S VALM("LINES")=13
"RTN","BPSOS6J",75,0)
 S VALMCC=1
"RTN","BPSOS6J",76,0)
 S VALMPGE=1
"RTN","BPSOS6J",77,0)
 S VALMBG=1
"RTN","BPSOS6J",78,0)
 S PAGE=1
"RTN","BPSOS6J",79,0)
 W ! S X=^TMP("BPSOS",$J,"PATIENT TIME")
"RTN","BPSOS6J",80,0)
 S X=$$NUMERIC^BPSOSU2("Number of days:  ",X,1,1,365) W !
"RTN","BPSOS6J",81,0)
 I X<1 G HDRA
"RTN","BPSOS6J",82,0)
 S PATTIME=X
"RTN","BPSOS6J",83,0)
 S ^TMP("BPSOS",$J,"PATIENT")=PAT,^("PATIENT TIME")=PATTIME
"RTN","BPSOS6J",84,0)
 S ^TMP("BPSOS",$J,"USER")=0
"RTN","BPSOS6J",85,0)
 S VALMHDR(1)="All Prescriptions for patient "_$P(^DPT(PAT,0),U) ;LJE
"RTN","BPSOS6J",86,0)
 S VALMHDR(2)="With activity in the past "_^TMP("BPSOS",$J,"TIME")_" minutes." ;LJE
"RTN","BPSOS6J",87,0)
 G HDR88
"RTN","BPSOS6K")
1^92
"RTN","BPSOS6L")
0^93^B1995877
"RTN","BPSOS6L",1,0)
BPSOS6L ;BHAM ISC/FCS/DRS - Cancel a claim ;06/01/2004
"RTN","BPSOS6L",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6L",3,0)
 Q
"RTN","BPSOS6L",4,0)
CANCEL(RXI) ; option  to cancel claim would come here
"RTN","BPSOS6L",5,0)
 ; now done from a protocol on the data entry screen
"RTN","BPSOS6L",6,0)
 ;
"RTN","BPSOS6L",7,0)
 ; We merely flag the claim for cancellation.
"RTN","BPSOS6L",8,0)
 ; Let the transmit program handle the details.
"RTN","BPSOS6L",9,0)
 ; And if we got here too late, the results reporting takes care of it.
"RTN","BPSOS6L",10,0)
 ; If we really get fancy, we can have the result processing initiate
"RTN","BPSOS6L",11,0)
 ; a claim reversal.
"RTN","BPSOS6L",12,0)
 ;
"RTN","BPSOS6L",13,0)
 I $D(RXI) G CANC5
"RTN","BPSOS6L",14,0)
 W !,"Enter the prescription number whose claim you wish to cancel.",!
"RTN","BPSOS6L",15,0)
 N RXI,ABSBRXI S (ABSBRXI,RXI)=$$GETRX^BPSOSIV Q:RXI<1
"RTN","BPSOS6L",16,0)
CANC5 ;EP - from BPSOS6D ; Given RXI=pointer to 9002313.59
"RTN","BPSOS6L",17,0)
 Q:'$$LOCKPOS^BPSOSUD
"RTN","BPSOS6L",18,0)
 N DIE,DA,DR S DIE=9002313.59,DA=RXI
"RTN","BPSOS6L",19,0)
 S DR="301////"_DUZ_";302///@;7///NOW" D ^DIE
"RTN","BPSOS6L",20,0)
 D ULKECME^BPSOSUD
"RTN","BPSOS6L",21,0)
 ; NO SLEEP PROBER INFO EXISITS UNLESS IT IS IHS 7/29/2003 DLF
"RTN","BPSOS6L",22,0)
 ; 
"RTN","BPSOS6L",23,0)
 I ^BPS(9002313.99,1,"SITE TYPE")=1  D
"RTN","BPSOS6L",24,0)
 .N INS
"RTN","BPSOS6L",25,0)
 .S INS=$P(^BPST(RXI,1),U,6)
"RTN","BPSOS6L",26,0)
 .I $G(^BPSEI(INS,101)) D
"RTN","BPSOS6L",27,0)
 .. N X S X=^BPSEI(INS,101)
"RTN","BPSOS6L",28,0)
 .. I $P(X,U,6)=RXI S $P(^BPSEI(INS,101),U,6)="" ; release Sleep Prober ownership
"RTN","BPSOS6L",29,0)
 .. I $D(^BPST("AD",31)) D TASK^BPSOSQ1 ; poke other 31s 
"RTN","BPSOS6L",30,0)
 .. D TASK^BPSOSQ1 ; another 31, if any, will take over
"RTN","BPSOS6L",31,0)
 Q
"RTN","BPSOS6M")
0^94^B6160803
"RTN","BPSOS6M",1,0)
BPSOS6M ;BHAM ISC/FCS/DRS - Print log of claim ;06/01/2004
"RTN","BPSOS6M",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6M",3,0)
 Q
"RTN","BPSOS6M",4,0)
CLAIMLOG(RXI,DEST)         ;EP - from BPSOS6D
"RTN","BPSOS6M",5,0)
 ;
"RTN","BPSOS6M",6,0)
 ;  optional parameters:  prescription #
"RTN","BPSOS6M",7,0)
 ;  and destination device (already opened)
"RTN","BPSOS6M",8,0)
 ;  Prompts for any missing parameters.
"RTN","BPSOS6M",9,0)
 ; 
"RTN","BPSOS6M",10,0)
 ; Note that it will give you only the most recent transmit/receive
"RTN","BPSOS6M",11,0)
 ;  If there have been retransmissions, DO ^%GSE for claim number,
"RTN","BPSOS6M",12,0)
 ;  and print the entire log file.  The purpose of this part is to
"RTN","BPSOS6M",13,0)
 ;  show when the successful I/O or last failed I/O occurred.
"RTN","BPSOS6M",14,0)
 ;
"RTN","BPSOS6M",15,0)
 I '$D(RXI) S RXI=$$GETRX^BPSOSIV Q:RXI<1
"RTN","BPSOS6M",16,0)
 I $D(DEST) S IO=DEST
"RTN","BPSOS6M",17,0)
 E  D ^%ZIS I $G(POP) Q
"RTN","BPSOS6M",18,0)
 N BPSCR S BPSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSOS6M",19,0)
 I BPSCR W @IOF
"RTN","BPSOS6M",20,0)
 U IO W "Pharmacy ECME Log of activity for one prescription",!
"RTN","BPSOS6M",21,0)
 N REC,X,X1,X2 M REC=^BPST(RXI)
"RTN","BPSOS6M",22,0)
 N I F I=0:1:2 I '$D(REC(I)) S REC(I)=""
"RTN","BPSOS6M",23,0)
 W "Internal Prescription #",$P(^BPST(RXI,1),U,11)
"RTN","BPSOS6M",24,0)
 S X=$P(REC(1),U) I X W " Refill #",X
"RTN","BPSOS6M",25,0)
 W "   (RXI=",RXI,")"
"RTN","BPSOS6M",26,0)
 W !,"VA Prescription #",$$GET1^DIQ(52,$P(^BPST(RXI,1),U,11),.01)
"RTN","BPSOS6M",27,0)
 W !,"Patient: "
"RTN","BPSOS6M",28,0)
 S X=$P(REC(0),U,6) I X]"" S X=$P($G(^DPT(X,0)),U) W X
"RTN","BPSOS6M",29,0)
 W !
"RTN","BPSOS6M",30,0)
 W "Status: "
"RTN","BPSOS6M",31,0)
 S X=$P(REC(0),U,2) W:X'=99 "Q" W X,":",$$STATI^BPSOSU(X),!
"RTN","BPSOS6M",32,0)
 I X=99 D  W !
"RTN","BPSOS6M",33,0)
 .D DISPRESP^BPSOSUA
"RTN","BPSOS6M",34,0)
 W "Submitted on " S X1=$P(REC(0),U,11) I X1]"" W $$DATETIME^BPSOSUD(X1),!
"RTN","BPSOS6M",35,0)
 W "  Last activity @" S X2=$P(REC(0),U,8) I X2]"" D
"RTN","BPSOS6M",36,0)
 .W $P($$DATETIME^BPSOSUD(X2),"@",2)
"RTN","BPSOS6M",37,0)
 I X1]"",X2]"" W "  Elapsed time: " W $$TIMEDIF^BPSOSUD(X1,X2)
"RTN","BPSOS6M",38,0)
 W !
"RTN","BPSOS6M",39,0)
 S X=$P(REC(0),U,4)
"RTN","BPSOS6M",40,0)
 I X="" W "No entry "
"RTN","BPSOS6M",41,0)
 E  W "See also entry `",X
"RTN","BPSOS6M",42,0)
 S X1=9002313.02 W " in file #",X1,", ",$P(^DIC(X1,0),U),!
"RTN","BPSOS6M",43,0)
 I X]"" D
"RTN","BPSOS6M",44,0)
 .S X=$P(REC(0),U,5)
"RTN","BPSOS6M",45,0)
 .I X="" W "but there is no entry "
"RTN","BPSOS6M",46,0)
 .E  W "     and entry `",X
"RTN","BPSOS6M",47,0)
 S X1=9002313.03 W " in file #",X1,", ",$P(^DIC(X1,0),U),!
"RTN","BPSOS6M",48,0)
 N STOP S STOP=0
"RTN","BPSOS6M",49,0)
 N EXISTS S EXISTS=$$EXISTS^BPSOSL(RXI)
"RTN","BPSOS6M",50,0)
 I EXISTS D  Q:$G(STOP)
"RTN","BPSOS6M",51,0)
 . W !,"Log of this claim's activity: ",!
"RTN","BPSOS6M",52,0)
 . I BPSCR S X="" D PAUSE^VALM1 I X="^" S STOP=1 Q
"RTN","BPSOS6M",53,0)
 . D PRINTLOG^BPSOSL(RXI)
"RTN","BPSOS6M",54,0)
 . I $G(STOP) Q
"RTN","BPSOS6M",55,0)
 . I BPSCR D PRESSANY^BPSOSU5()
"RTN","BPSOS6M",56,0)
 I 'EXISTS D
"RTN","BPSOS6M",57,0)
 . W !,"There is no log for this claim's activity.",!
"RTN","BPSOS6M",58,0)
 . I BPSCR D PRESSANY^BPSOSU5()
"RTN","BPSOS6M",59,0)
 ; DMB - 10/6/2005
"RTN","BPSOS6M",60,0)
 ;    The following code does not work correctly.
"RTN","BPSOS6M",61,0)
 ;    It is unclear what it is trying to do as the log is complete
"RTN","BPSOS6M",62,0)
 ;    Perhaps in phase IV, we can figure out what it is intending
"RTN","BPSOS6M",63,0)
 ;    and fix it.
"RTN","BPSOS6M",64,0)
 ; S X=$P(REC(0),U,12),X1=$P(REC(0),U,4) ; X=where,X1=claim #
"RTN","BPSOS6M",65,0)
 ; I X,X1 D
"RTN","BPSOS6M",66,0)
 ; .D PRESSANY^BPSOSU5() ; now that you've seen end of claim log
"RTN","BPSOS6M",67,0)
 ; .W !,"Log of transmission, "
"RTN","BPSOS6M",68,0)
 ; .W "in log file #",$P(X,",")," at line #",$P(X,",",2),":",!
"RTN","BPSOS6M",69,0)
 ; .D PRCLLOG^BPSOSL(X,X1) ; 
"RTN","BPSOS6M",70,0)
 I '$D(DEST) D ^%ZISC ; we opened the device so we close it
"RTN","BPSOS6M",71,0)
CZ Q
"RTN","BPSOS6N")
0^95^B47692706
"RTN","BPSOS6N",1,0)
BPSOS6N ;BHAM ISC/FLS - Claim resubmission routine ;06/01/2004
"RTN","BPSOS6N",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS6N",3,0)
 ;;Reference to ^IBE(356.8 covered under DBIA4710
"RTN","BPSOS6N",4,0)
 ;
"RTN","BPSOS6N",5,0)
 ; RESUB - Continuation of RESUB1^BPSOS6D
"RTN","BPSOS6N",6,0)
 ; Input:
"RTN","BPSOS6N",7,0)
 ;   IEN59 is expected to be defined
"RTN","BPSOS6N",8,0)
RESUB ;
"RTN","BPSOS6N",9,0)
 N BPSTAT,RXI,RXR,NDC,MOREDATA,EMSG
"RTN","BPSOS6N",10,0)
 N SUBF,IENS,VASEQ,FDA,VAXXX
"RTN","BPSOS6N",11,0)
 S RXI=$P(IEN59,".")
"RTN","BPSOS6N",12,0)
 S RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOS6N",13,0)
 S NDC=$$GETNDC^PSONDCUT(RXI,RXR)
"RTN","BPSOS6N",14,0)
 S $P(^BPST(IEN59,1),"^",2)=NDC
"RTN","BPSOS6N",15,0)
 I $D(^XTMP("BPSOSRB","MOREDATA",IEN59,"RESUB")) K MOREDATA,EMSG M MOREDATA=^XTMP("BPSOSRB","MOREDATA",IEN59,"RESUB") I $D(MOREDATA("IBDATA")) D
"RTN","BPSOS6N",16,0)
 . S SUBF=9002313.59,IENS=IEN59_","
"RTN","BPSOS6N",17,0)
 . S VASEQ="",VASEQ=$O(MOREDATA("IBDATA",VASEQ))
"RTN","BPSOS6N",18,0)
 . S FDA(SUBF,IENS,.01)=IEN59
"RTN","BPSOS6N",19,0)
 . S FDA(SUBF,IENS,501)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",7)     ;DRUG QUANTITY
"RTN","BPSOS6N",20,0)
 . S FDA(SUBF,IENS,502)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",8)     ;INGREDIENT COST
"RTN","BPSOS6N",21,0)
 . S FDA(SUBF,IENS,10)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",9)  ;NDC
"RTN","BPSOS6N",22,0)
 . S FDA(SUBF,IENS,10)=$$NDCF^BPSECFM(FDA(SUBF,IENS,10))            ;CONVERT ndc
"RTN","BPSOS6N",23,0)
 . I $L(FDA(SUBF,IENS,10))=10 S FDA(SUBF,IENS,9.08)=$E(FDA(SUBF,IENS,10),2,12)             ;strip of the extra zero for va
"RTN","BPSOS6N",24,0)
 . S FDA(SUBF,IENS,504)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",1)     ;DISPENSE FEE
"RTN","BPSOS6N",25,0)
 . S FDA(SUBF,IENS,505)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",3)     ;USUAL & CUSTOMARY CHARGE
"RTN","BPSOS6N",26,0)
 . S FDA(SUBF,IENS,507)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",5)     ;ADMINISTRATIVE FEE
"RTN","BPSOS6N",27,0)
 . D UPDATE^DIE("E","FDA","VAIEN","EMSG")
"RTN","BPSOS6N",28,0)
 . I $D(EMSG) D  S VAXXX="",VAXXX=$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"FDA",$T(+0)) Q:VAXXX'=""
"RTN","BPSOS6N",29,0)
 . . W !,"Unexpected error in FILEARAY^"_$T(+0),!
"RTN","BPSOS6N",30,0)
 . . D ZWRITE^BPSOS("ABSBRXI","IEN59","IENS","EMSG")
"RTN","BPSOS6N",31,0)
 . ;
"RTN","BPSOS6N",32,0)
 . S SUBF=9002313.59902,IENS="1,"_IENS
"RTN","BPSOS6N",33,0)
 . S FDA(SUBF,IENS,.01)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",1)     ;PLAN IEN
"RTN","BPSOS6N",34,0)
 . S FDA(SUBF,IENS,902.03)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",2)     ;BIN
"RTN","BPSOS6N",35,0)
 . S FDA(SUBF,IENS,902.04)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",3)     ;PCN
"RTN","BPSOS6N",36,0)
 . S FDA(SUBF,IENS,902.18)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",13)    ;SOFTWARE VENDOR CERT ID
"RTN","BPSOS6N",37,0)
 . S FDA(SUBF,IENS,902.19)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",11)    ;B2 PAYER SHEET REVERSAL
"RTN","BPSOS6N",38,0)
 . S FDA(SUBF,IENS,902.21)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",12)    ;B3 PAYER SHEET REVERSAL
"RTN","BPSOS6N",39,0)
 . S FDA(SUBF,IENS,902.12)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",14)    ;CERTIFY MODE
"RTN","BPSOS6N",40,0)
 . S FDA(SUBF,IENS,902.02)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",4)     ;B1 PAYER SHEET
"RTN","BPSOS6N",41,0)
 . S FDA(SUBF,IENS,902.05)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",5)     ;GROUP ID
"RTN","BPSOS6N",42,0)
 . S FDA(SUBF,IENS,902.06)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",6)     ;CARDHOLDER ID
"RTN","BPSOS6N",43,0)
 . S FDA(SUBF,IENS,902.07)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",7)     ;PATIENT RELATIONSHIP CODE
"RTN","BPSOS6N",44,0)
 . I FDA(SUBF,IENS,902.07)="" S FDA(SUBF,IENS,902.07)=0
"RTN","BPSOS6N",45,0)
 . I $L(FDA(SUBF,IENS,902.07))>1 S FDA(SUBF,IENS,902.07)=$E(FDA(SUBF,IENS,902.07),$L(FDA(SUBF,IENS,902.07)),$L(FDA(SUBF,IENS,902.07)))
"RTN","BPSOS6N",46,0)
 . S FDA(SUBF,IENS,902.08)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",8)     ;CARDHOLDER FIRST NAME
"RTN","BPSOS6N",47,0)
 . I $L(FDA(SUBF,IENS,902.08))=10 S FDA(SUBF,IENS,902.08)=$E(FDA(SUBF,IENS,902.08),2,12)             ;strip of the extra zero for va
"RTN","BPSOS6N",48,0)
 . S FDA(SUBF,IENS,902.09)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",9)     ;CARDHOLDER LAST NAME
"RTN","BPSOS6N",49,0)
 . S FDA(SUBF,IENS,902.11)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",10)    ;HOME PLAN STATE
"RTN","BPSOS6N",50,0)
 . S FDA(SUBF,IENS,902.12)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",1)     ;DISPENSE FEE
"RTN","BPSOS6N",51,0)
 . S FDA(SUBF,IENS,902.13)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",2)     ;BASIS OF COST DETERMINATION
"RTN","BPSOS6N",52,0)
 . S FDA(SUBF,IENS,902.14)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",3)     ;USUAL & CUSTOMARY CHARGE
"RTN","BPSOS6N",53,0)
 . S FDA(SUBF,IENS,902.15)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",4)     ;GROSS AMOUNT DUE
"RTN","BPSOS6N",54,0)
 . S FDA(SUBF,IENS,902.16)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",5)     ;ADMINISTRATIVE FEE
"RTN","BPSOS6N",55,0)
 . S FDA(SUBF,IENS,902.18)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",6)     ;Software Vendor/Cert ID
"RTN","BPSOS6N",56,0)
 . S FDA(SUBF,IENS,902.12)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",1)     ;DISPENSE FEE
"RTN","BPSOS6N",57,0)
 . S FDA(SUBF,IENS,902.14)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",3)     ;USUAL & CUSTOMARY CHARGE
"RTN","BPSOS6N",58,0)
 . S FDA(SUBF,IENS,902.16)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",5)     ;ADMINISTRATIVE FEE
"RTN","BPSOS6N",59,0)
 . S FDA(SUBF,IENS,902.17)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",10)
"RTN","BPSOS6N",60,0)
 . D UPDATE^DIE("E","FDA","EMSG")
"RTN","BPSOS6N",61,0)
 I $D(EMSG) D  S VAXXX="",VAXXX=$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"FILEARAY",$T(+0)) I VAXXX K VAXXX Q
"RTN","BPSOS6N",62,0)
 . W !,"Unexpected error in FILEARAY^"_$T(+0),!
"RTN","BPSOS6N",63,0)
ENDIT ;
"RTN","BPSOS6N",64,0)
 K ^XTMP("BPSOSRB","MOREDATA",IEN59)
"RTN","BPSOS6N",65,0)
 N ABSBRXI S ABSBRXI=IEN59 D SETSTAT^BPSOSU(0)
"RTN","BPSOS6N",66,0)
 Q
"RTN","BPSOS6N",67,0)
 ;
"RTN","BPSOS6N",68,0)
CLOSE ; Protocol BPS P1 CLOSE CLAIM ; Close selected claims
"RTN","BPSOS6N",69,0)
 N WHICH,VALMI,OK,DIC,Y,X,CLOSE,BPSTRA,BPSCLA,NODISPLY,SUB,RSP,DIRUT,COMMENT,REASON,PAPER,DIR,DUOUT,DTOUT,COPAY,RELCOP
"RTN","BPSOS6N",70,0)
 S (WHICH,VALMI)=0 D FULL^VALM1
"RTN","BPSOS6N",71,0)
SEL W ! D EN^VALM2(XQORNOD(0),"O") S VALMBCK="R" Q:'$O(VALMY(0))
"RTN","BPSOS6N",72,0)
 K CLOSE W !!,"You've chosen to CLOSE the CLAIM(S) for the following prescription(s): ",!
"RTN","BPSOS6N",73,0)
 S COPAY=0
"RTN","BPSOS6N",74,0)
 S WHICH=0 F  S WHICH=$O(VALMY(WHICH)) Q:'WHICH  D
"RTN","BPSOS6N",75,0)
 . S BPSTRA=+$P(@DISPLINE@(WHICH),U,2),BPSCLA=$$GET1^DIQ(9002313.59,BPSTRA,3,"I")
"RTN","BPSOS6N",76,0)
 . I 'BPSTRA W !,$J(WHICH,2),"       *** INVALID ENTRY - CANNOT BE CLOSED ***" K VALMY(WHICH) Q
"RTN","BPSOS6N",77,0)
 . I 'BPSCLA W !,$J(WHICH,2),"       *** INVALID CLAIM - CANNOT BE CLOSED ***" K VALMY(WHICH) Q
"RTN","BPSOS6N",78,0)
 . D RESPINFO^BPSOSQ4(BPSTRA,.RSP)
"RTN","BPSOS6N",79,0)
 . I $G(RSP("RSP"))'="Rejected" W !,$J(WHICH,2),"       *** NOT REJECTED - CANNOT BE CLOSED ***" K VALMY(WHICH) Q
"RTN","BPSOS6N",80,0)
 . L +^BPSC(BPSCLA):0 E  W !,$J(WHICH,2),"       *** CLAIM ",$$GET1^DIQ(9002313.02,BPSCLA,.01)," IN USE ***" K VALMY(WHICH) Q
"RTN","BPSOS6N",81,0)
 . W !,$E($G(^TMP("BPSOS",$J,"VALM",WHICH,0)),1,80) S CLOSE(BPSCLA)=BPSTRA
"RTN","BPSOS6N",82,0)
 . W !?9,"Claim ID: ",$$GET1^DIQ(9002313.02,BPSCLA,.01)
"RTN","BPSOS6N",83,0)
 . I $$COPAY(BPSTRA) S COPAY=COPAY+1
"RTN","BPSOS6N",84,0)
 G SEL:'$D(CLOSE)
"RTN","BPSOS6N",85,0)
 ;
"RTN","BPSOS6N",86,0)
 ; - Asks for REASON for Closing
"RTN","BPSOS6N",87,0)
 W ! D CLOSEPMT(.REASON,.PAPER) I REASON="" G UNLK
"RTN","BPSOS6N",88,0)
 ;Warning! The REASON is .01, not IEN!
"RTN","BPSOS6N",89,0)
 S RELCOP=0
"RTN","BPSOS6N",90,0)
 ; - Asks for RELEASE COPAY (Y/N)
"RTN","BPSOS6N",91,0)
 I 'PAPER,COPAY W ! D RELCOPAY(.RELCOP,COPAY) I RELCOP="" G UNLK
"RTN","BPSOS6N",92,0)
 I PAPER,COPAY W !,"Dropping to paper: cannot release Copay off hold"
"RTN","BPSOS6N",93,0)
 ;
"RTN","BPSOS6N",94,0)
 ;
"RTN","BPSOS6N",95,0)
 S DIR(0)="FO^0:40"
"RTN","BPSOS6N",96,0)
 S DIR("A")="Comment"
"RTN","BPSOS6N",97,0)
 W ! D ^DIR G:$D(DUOUT)!($D(DTOUT)) UNLK
"RTN","BPSOS6N",98,0)
 S COMMENT=Y
"RTN","BPSOS6N",99,0)
 ;
"RTN","BPSOS6N",100,0)
 W ! S DIR(0)="Y",DIR("B")="YES",DIR("A")="Are you sure" D ^DIR I '$G(Y)!$D(DIRUT) G UNLK
"RTN","BPSOS6N",101,0)
 N DIE,DA,DR,ERROR S BPSCLA="" W !
"RTN","BPSOS6N",102,0)
 F  S BPSCLA=$O(CLOSE(BPSCLA)) Q:BPSCLA=""  D
"RTN","BPSOS6N",103,0)
 . W !,"Closing Claim ",$$GET1^DIQ(9002313.02,BPSCLA,.01),"..."
"RTN","BPSOS6N",104,0)
 . D CLOSE^BPSBUTL(BPSCLA,CLOSE(BPSCLA),REASON,PAPER,RELCOP,COMMENT,.ERROR) I $D(ERROR) W "NOT OK" D DSPERR(ERROR) Q
"RTN","BPSOS6N",105,0)
 . S DIE="^BPSC(",DA=BPSCLA,DR="901///1;902///"_$$NOW^XLFDT()_";903///"_DUZ_";904///"_REASON D ^DIE
"RTN","BPSOS6N",106,0)
 . W "OK"
"RTN","BPSOS6N",107,0)
 ;
"RTN","BPSOS6N",108,0)
 F SUB="CHG","DISP","DISPLINE","VALM" K ^TMP("BPSOS",$J,SUB)
"RTN","BPSOS6N",109,0)
 S ^TMP("BPSOS",$J,"LAST UPDATE")=""
"RTN","BPSOS6N",110,0)
 S ^TMP("BPSOS",$J,"HIST")=0,^TMP("BPSOS",$J,"DISPLINE")=0
"RTN","BPSOS6N",111,0)
 S NODISPLY=1,VALMCNT=0 D HDR^BPSOS6C D UPD^BPSOS6A
"RTN","BPSOS6N",112,0)
 S VALMBCK="R" W ! H 2 ;,VALMPGE=1
"RTN","BPSOS6N",113,0)
 ;
"RTN","BPSOS6N",114,0)
UNLK ; Unlocks the Claim file entries
"RTN","BPSOS6N",115,0)
 S BPSCLA="" F  S BPSCLA=$O(CLOSE(BPSCLA)) Q:'BPSCLA  L -^BPSC(BPSCLA)
"RTN","BPSOS6N",116,0)
 Q
"RTN","BPSOS6N",117,0)
DSPERR(MSG) ; Display the ERROR message
"RTN","BPSOS6N",118,0)
 W !,"Error: *** ",MSG," ***"
"RTN","BPSOS6N",119,0)
 Q
"RTN","BPSOS6N",120,0)
 ;
"RTN","BPSOS6N",121,0)
COPAY(IEN59) ; Is there a copay? returns IEN #350
"RTN","BPSOS6N",122,0)
 N RXI
"RTN","BPSOS6N",123,0)
 S RXI=$P(IEN59,".")
"RTN","BPSOS6N",124,0)
 S RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOS6N",125,0)
 Q $S(RXR:$P($G(^PSRX(RXI,1,RXR,"IB")),U),1:$P($G(^PSRX(RXI,"IB")),U,2))
"RTN","BPSOS6N",126,0)
 ;
"RTN","BPSOS6N",127,0)
CLOSEPMT(REASON,PAPER) ;Prompt 'Close Reason' and 'Drop to Paper'
"RTN","BPSOS6N",128,0)
 N DIC,DIR,Y,DUOUT
"RTN","BPSOS6N",129,0)
 S REASON="",PAPER=0
"RTN","BPSOS6N",130,0)
 S DIC("S")="I $P(^(0),U,2)"
"RTN","BPSOS6N",131,0)
 S DIC("A")="Select CLOSE CLAIM REASON: "
"RTN","BPSOS6N",132,0)
 S DIC="^IBE(356.8,",DIC(0)="AEQMN" D ^DIC Q:$D(DUOUT)  Q:Y<1
"RTN","BPSOS6N",133,0)
 S REASON=$P($G(^IBE(356.8,+Y,0)),U)
"RTN","BPSOS6N",134,0)
 I '$P($G(^IBE(356.8,+Y,0)),U,3) Q
"RTN","BPSOS6N",135,0)
 S DIR(0)="SB^N:NON-BILLABLE EPISODE;D:DROP CLAIM TO PAPER"
"RTN","BPSOS6N",136,0)
 S DIR("A")="Treat as (N)on-Billable or (D)rop to Paper"
"RTN","BPSOS6N",137,0)
 W ! D ^DIR K DIR I $D(DIRUT) S REASON="",PAPER=0 Q
"RTN","BPSOS6N",138,0)
 S PAPER=($E(Y)="D")
"RTN","BPSOS6N",139,0)
 Q
"RTN","BPSOS6N",140,0)
 ;
"RTN","BPSOS6N",141,0)
RELCOPAY(RELCOP,COPAY) ;Prompt 'Release Copay?'
"RTN","BPSOS6N",142,0)
 N DIR,Y,DA
"RTN","BPSOS6N",143,0)
 S DIR(0)="Y",DIR("A")="Release "_$S(COPAY>1:"all copays",1:"copay")_" off hold"
"RTN","BPSOS6N",144,0)
 S DIR("B")="NO"
"RTN","BPSOS6N",145,0)
 S DIR("?")="If you want to release copay(s), enter 'Yes' - otherwise, enter 'No'"
"RTN","BPSOS6N",146,0)
 D ^DIR K DIR S:Y="^" Y=""
"RTN","BPSOS6N",147,0)
 S RELCOP=Y
"RTN","BPSOS6N",148,0)
 Q
"RTN","BPSOS9")
0^96^B10059470
"RTN","BPSOS9",1,0)
BPSOS9 ;BHAM ISC/FCS/DRS/FLS - NDC # lookup, formatting ;06/01/2004
"RTN","BPSOS9",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOS9",3,0)
 ; Relies on the ^APSAMDF  AWP-MED TRANSACTION file
"RTN","BPSOS9",4,0)
 ; Several $$ routines called from lots of places.
"RTN","BPSOS9",5,0)
 ;
"RTN","BPSOS9",6,0)
 Q
"RTN","BPSOS9",7,0)
NDC11(N) ;EP - given N?11N
"RTN","BPSOS9",8,0)
 I '$$FINDNDC(N) Q ""
"RTN","BPSOS9",9,0)
 Q $$FMTNDC(N,5,4,2) ; must be 5-4-2?
"RTN","BPSOS9",10,0)
NDC10(N) ;EP - given N?10N, find format and format it
"RTN","BPSOS9",11,0)
 N M,X,Y,Z
"RTN","BPSOS9",12,0)
 S M=0_N,X=$$FINDNDC(M,1) ; is it valid in 4-4-2 format?
"RTN","BPSOS9",13,0)
 I X Q $$FMTNDC(N,4,4,2)
"RTN","BPSOS9",14,0)
 S M=$E(N,1,5)_0_$E(N,6,10) ; is it valid in 5-3-2 format?
"RTN","BPSOS9",15,0)
 S X=$$FINDNDC(M,2)
"RTN","BPSOS9",16,0)
 I X Q $$FMTNDC(N,5,3,2)
"RTN","BPSOS9",17,0)
 S M=$E(N,1,9)_0_$E(N,10) ; is it valid in 5-4-1 format?
"RTN","BPSOS9",18,0)
 S X=$$FINDNDC(M,3)
"RTN","BPSOS9",19,0)
 I X Q $$FMTNDC(N,5,4,1)
"RTN","BPSOS9",20,0)
 ; No, didn't find it anywhere
"RTN","BPSOS9",21,0)
 Q ""
"RTN","BPSOS9",22,0)
FMTNDC(N,A,B,C)    ; given N?1n.n and A-B-C format
"RTN","BPSOS9",23,0)
 I $D(A) Q $E(N,1,A)_"-"_$E(N,A+1,A+B)_"-"_$E(N,A+B+1,A+B+C)
"RTN","BPSOS9",24,0)
MAKE11N(X) ;EP - given NDC code with "-", convert to ?11N
"RTN","BPSOS9",25,0)
 ; it may involve putting an extra 0 in the right place
"RTN","BPSOS9",26,0)
 I X?5N1"-"4N1"-"2N ; it's okay as-is
"RTN","BPSOS9",27,0)
 E  I X?3N1"-"4N1"-"2N S $P(X,"-",1)="00"_$P(X,"-",1) Q  ;LJE;VA 9 Digits 
"RTN","BPSOS9",28,0)
 E  I X?4N1"-"4N1"-"2N S $P(X,"-",1)="0"_$P(X,"-",1)
"RTN","BPSOS9",29,0)
 E  I X?5N1"-"3N1"-"2N S $P(X,"-",2)="0"_$P(X,"-",2)
"RTN","BPSOS9",30,0)
 E  I X?5N1"-"4N1"-"1N S $P(X,"-",3)="0"_$P(X,"-",3)
"RTN","BPSOS9",31,0)
 Q $TR(X,"-")
"RTN","BPSOS9",32,0)
NAME(X) ;EP - return drug name as stored in ^APSAMDF
"RTN","BPSOS9",33,0)
 N Y I X["-" S Y=$$MAKE11N(X)
"RTN","BPSOS9",34,0)
 E  S Y=X
"RTN","BPSOS9",35,0)
 I Y'?11N Q "(can't figure out 11N format?)"
"RTN","BPSOS9",36,0)
 ; not in AWP-MED TRANSACTION; try the DRUG file
"RTN","BPSOS9",37,0)
 S Z=$O(^PSDRUG("ZNDC",$TR(X,"-",""),0))
"RTN","BPSOS9",38,0)
 I Z Q $P(^PSDRUG(Z,0),U)_" (from DRUG file)"
"RTN","BPSOS9",39,0)
 Q "("_X_" in neither AWP-MED TRANSACTION nor DRUG file)"
"RTN","BPSOS9",40,0)
FINDNDC(N,F)         ; return pointer into AWP MED-TRANSACTION
"RTN","BPSOS9",41,0)
 ; F is optional - if F present, then it must match for this format
"RTN","BPSOS9",42,0)
 ; returns null if not found
"RTN","BPSOS9",43,0)
 Q 0  ; matches number and format, both
"RTN","BPSOS9",44,0)
FORMTNDC(N) ;EP - given N?11N, lookup format and put "-" in right places
"RTN","BPSOS9",45,0)
 I N'?11N S N=$TR($J(N,11)," ","0") I N'?11N Q N
"RTN","BPSOS9",46,0)
 N X,F S X=$$FINDNDC(N) I 'X Q N
"RTN","BPSOS9",47,0)
 Q N ; FOR VA
"RTN","BPSOS9",48,0)
 ; 4-4-2 format
"RTN","BPSOS9",49,0)
 I F=1,X?1"0"4N4N2N Q $$FMTNDC(N,4,4,2)
"RTN","BPSOS9",50,0)
 ; 5-3-2 format
"RTN","BPSOS9",51,0)
 I F=2,X?5N1"0"3N2N Q:$$FMTNDC(N,5,3,2)
"RTN","BPSOS9",52,0)
 ; 5-4-1 format
"RTN","BPSOS9",53,0)
 I F=3,X?5N4N1"0"1N Q $$FMTNDC(N,5,4,1)
"RTN","BPSOS9",54,0)
 ; else 5-4-2 format?
"RTN","BPSOS9",55,0)
 Q $$FMTNDC(N,5,4,2)
"RTN","BPSOS9",56,0)
 Q
"RTN","BPSOS9",57,0)
NDCTEST ;
"RTN","BPSOS9",58,0)
 W "Comprehensive test of valid NDC #s",!
"RTN","BPSOS9",59,0)
 Q
"RTN","BPSOS9",60,0)
NDCTEST0 ;
"RTN","BPSOS9",61,0)
 N X S X=$$FINDNDC(NDC) I 'X D  Q
"RTN","BPSOS9",62,0)
 . D IMPOSS^BPSOSUE("P","T",,,"NDCTEST0",$T(+0))
"RTN","BPSOS9",63,0)
 D NDCTEST1(NDC)
"RTN","BPSOS9",64,0)
 I $E(NDC,1)=0 W:OUTPUT "4-4-2 test..." D NDCTEST1($E(NDC,2,11))
"RTN","BPSOS9",65,0)
 I $E(NDC,6)=0 W:OUTPUT "5-3-2 test..." D NDCTEST1($E(NDC,1,5)_$E(NDC,7,11))
"RTN","BPSOS9",66,0)
 I $E(NDC,10)=0 W:OUTPUT "5-4-1 test..." D NDCTEST1($E(NDC,1,9)_$E(NDC,11))
"RTN","BPSOS9",67,0)
 Q
"RTN","BPSOS9",68,0)
NDCTEST1(NDC) ; given NDC
"RTN","BPSOS9",69,0)
 N X,F
"RTN","BPSOS9",70,0)
 I $L(NDC)=11 D  Q
"RTN","BPSOS9",71,0)
 .S X=$$FINDNDC(NDC)
"RTN","BPSOS9",72,0)
 .I X D
"RTN","BPSOS9",73,0)
 ..N F
"RTN","BPSOS9",74,0)
 ..W:OUTPUT $$FMTNDC(NDC,5,4,2)," Format=",F,!
"RTN","BPSOS9",75,0)
 .E  W NDC," Not found",!
"RTN","BPSOS9",76,0)
 W:OUTPUT "Test ",NDC,"..."
"RTN","BPSOS9",77,0)
 I $L(NDC)'=10 D  Q
"RTN","BPSOS9",78,0)
 . D IMPOSS^BPSOSUE("P","T","$L(NDC)'=10",NDC,"NDCTEST1",$T(+0))
"RTN","BPSOS9",79,0)
 N Y,Z
"RTN","BPSOS9",80,0)
 S X=$$FINDNDC(0_NDC,1) ; is it 4-4-2
"RTN","BPSOS9",81,0)
 S Y=$$FINDNDC($E(NDC,1,5)_0_$E(NDC,6,10),2) ; is it 5-3-2?
"RTN","BPSOS9",82,0)
 S Z=$$FINDNDC($E(NDC,1,9)_0_$E(NDC,10),3) ; is it 5-4-1?
"RTN","BPSOS9",83,0)
 I X&Y!(X&Z)!(Y&Z) W NDC," Ambiguity!",!
"RTN","BPSOS9",84,0)
 I 'X,'Y,'Z W NDC," Not found!",!
"RTN","BPSOS9",85,0)
 I X W:OUTPUT $$FMTNDC(NDC,4,4,2),!
"RTN","BPSOS9",86,0)
 I Y W:OUTPUT $$FMTNDC(NDC,5,3,2),!
"RTN","BPSOS9",87,0)
 I Z W:OUTPUT $$FMTNDC(NDC,5,4,1),!
"RTN","BPSOS9",88,0)
 Q
"RTN","BPSOS96")
1^97
"RTN","BPSOS97")
1^98
"RTN","BPSOSA")
0^99^B6567859
"RTN","BPSOSA",1,0)
BPSOSA ;BHAM ISC/FCS/DRS/FLS - Communication Utilities ;06/01/2004
"RTN","BPSOSA",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSA",3,0)
 ;
"RTN","BPSOSA",4,0)
 ;  BPSOSA contains a lot of one-liner utility routines
"RTN","BPSOSA",5,0)
 ;  available for general use in the BPSOSA* family.
"RTN","BPSOSA",6,0)
 ;  And maybe other routines, too.
"RTN","BPSOSA",7,0)
 Q
"RTN","BPSOSA",8,0)
 ;
"RTN","BPSOSA",9,0)
 ;  The Dial Out file, 9002313.55
"RTN","BPSOSA",10,0)
 ; Don't directly refer to 9002313.55 in here - use $$GET55FLD instead.
"RTN","BPSOSA",11,0)
 ; This resolves defaults.
"RTN","BPSOSA",12,0)
 ;
"RTN","BPSOSA",13,0)
 ;IHS/SD/lwj  06/10/02  new logic added to allow the package to work
"RTN","BPSOSA",14,0)
 ; in a Cache environment.  Changes added to the IO subroutine - 
"RTN","BPSOSA",15,0)
 ; will now check the system type, and if it is Cache, it will
"RTN","BPSOSA",16,0)
 ; retrieve the value in the 420.03 field of the BPS dial Out file
"RTN","BPSOSA",17,0)
 ; rather than the 420.01 field that is used for standard MSM systems.
"RTN","BPSOSA",18,0)
 ;
"RTN","BPSOSA",19,0)
 ;
"RTN","BPSOSA",20,0)
THEDEF55()         Q $O(^BPS(9002313.55,"B","DEFAULT",0))
"RTN","BPSOSA",21,0)
ISDEF55(DIALOUT)   Q $P(^BPS(9002313.55,DIALOUT,0),U)="DEFAULT"
"RTN","BPSOSA",22,0)
DEF5599() ;EP - what's the default dial-out as pointed to by 9002313.99?
"RTN","BPSOSA",23,0)
 Q $P($G(^BPS(9002313.99,1,"DIAL-OUT DEFAULT")),U)
"RTN","BPSOSA",24,0)
DEF55(DIALOUT)  ; return pointer to the dial out used to supply defaults
"RTN","BPSOSA",25,0)
 ; for this given dial-out.  For the DEFAULT dial out, lookup the
"RTN","BPSOSA",26,0)
 ; pointer in 9002313.99.  For others, they point to the default.
"RTN","BPSOSA",27,0)
 I $$ISDEF55(DIALOUT) Q $$DEF5599
"RTN","BPSOSA",28,0)
 Q $$THEDEF55
"RTN","BPSOSA",29,0)
 ;
"RTN","BPSOSA",30,0)
GET55FLD(DIALOUT,FIELD) ;EP - get dialout field value; resort to default if necessary
"RTN","BPSOSA",31,0)
 N X
"RTN","BPSOSA",32,0)
 S X=$$GET55F1(DIALOUT,FIELD) ; try the dial-out itself first
"RTN","BPSOSA",33,0)
 I X="" S X=$$GET55F1($$DEF55(DIALOUT),FIELD) ; else go to the default
"RTN","BPSOSA",34,0)
 Q X
"RTN","BPSOSA",35,0)
GET55F1(DIALOUT,FIELD)         ;
"RTN","BPSOSA",36,0)
 Q $$GET1^DIQ(9002313.55,DIALOUT_",",FIELD,"I")
"RTN","BPSOSA",37,0)
 ;
"RTN","BPSOSA",38,0)
 ; How to terminate modem commands?
"RTN","BPSOSA",39,0)
 ;   CR LF has been troublesome in some cases
"RTN","BPSOSA",40,0)
 ;   Plain old CR seems to work fine.
"RTN","BPSOSA",41,0)
 ;
"RTN","BPSOSA",42,0)
TERMATOR(DIALOUT)  ; terminate modem command with what?  CR? LF? CR LF?
"RTN","BPSOSA",43,0)
 Q $C(13) ; seems to work at ANMC, too.
"RTN","BPSOSA",44,0)
 ;
"RTN","BPSOSA",45,0)
 ;  COMMAND issues a command to the modem.
"RTN","BPSOSA",46,0)
 ;  If it doesn't begin with AT, then this routine supplies it.
"RTN","BPSOSA",47,0)
 ;
"RTN","BPSOSA",48,0)
COMMAND(DIALOUT,COMMAND) ;EP - from BPSOSAB
"RTN","BPSOSA",49,0)
 I $E(COMMAND,1,2)'="AT" S COMMAND="AT"_COMMAND
"RTN","BPSOSA",50,0)
 U $$IO(DIALOUT) W COMMAND,$$TERMATOR(DIALOUT) Q
"RTN","BPSOSA",51,0)
 ;
"RTN","BPSOSA",52,0)
 ;  STATUS  returns status of the dial out device.
"RTN","BPSOSA",53,0)
 ;   You hope to get the result 0.
"RTN","BPSOSA",54,0)
 ;
"RTN","BPSOSA",55,0)
STATUS(DIALOUT)    ;
"RTN","BPSOSA",56,0)
 Q 0
"RTN","BPSOSA",57,0)
 ;
"RTN","BPSOSA",58,0)
 ;  MSYSTEM()  used to return the value of the type of M system
"RTN","BPSOSA",59,0)
 ;    field in 9002313.99.  It's obsolete.  Not used any more.
"RTN","BPSOSA",60,0)
 ; If you need this functionality, use ^%ZOSF(something)
"RTN","BPSOSA",61,0)
 ;
"RTN","BPSOSA",62,0)
 ; SERVER(), PORT(), IO(), TCPSERV(), MODEMTYP() 
"RTN","BPSOSA",63,0)
 ;    all return information about the current dial out.
"RTN","BPSOSA",64,0)
 ; It uses $$GET55FLD so as to get the value from the default dial
"RTN","BPSOSA",65,0)
 ; out, or if not, from the dial out named DEFAULT.
"RTN","BPSOSA",66,0)
 ;
"RTN","BPSOSA",67,0)
SERVER(DIALOUT) ;EP -
"RTN","BPSOSA",68,0)
 Q $$GET55FLD(DIALOUT,2021.01)
"RTN","BPSOSA",69,0)
PORT(DIALOUT) ;EP -
"RTN","BPSOSA",70,0)
 Q $$GET55FLD(DIALOUT,2021.02)
"RTN","BPSOSA",71,0)
IO(DIALOUT) ;EP -
"RTN","BPSOSA",72,0)
 ;IHS/SD/ljw 06/10/02     routine altered to incorporate changes
"RTN","BPSOSA",73,0)
 ; needed for Cache.  If the system is Cache, we will retrieve
"RTN","BPSOSA",74,0)
 ; the device from the 420.03 field - if it's MSM we will use
"RTN","BPSOSA",75,0)
 ; the 420.01 field - both fields in BPS Dial Out
"RTN","BPSOSA",76,0)
 ;
"RTN","BPSOSA",77,0)
 ; IHS/SD/lwj 06/10/02  begin changes
"RTN","BPSOSA",78,0)
 ;
"RTN","BPSOSA",79,0)
 N BPSOFLD
"RTN","BPSOSA",80,0)
 ;
"RTN","BPSOSA",81,0)
 S BPSOFLD=420.01   ;standard MSM systems device
"RTN","BPSOSA",82,0)
 I ^%ZOSF("OS")["OpenM" S BPSOFLD=420.03   ;Cache device
"RTN","BPSOSA",83,0)
 ;
"RTN","BPSOSA",84,0)
 Q $$GET55FLD(DIALOUT,BPSOFLD) ;new quit for either device
"RTN","BPSOSA",85,0)
 ;
"RTN","BPSOSA",86,0)
 ;IHS/SD/lwj  06/10/02  end Cache changes
"RTN","BPSOSA",87,0)
 ;
"RTN","BPSOSA",88,0)
TCP(DIALOUT) ;EP - 
"RTN","BPSOSA",89,0)
 N X S X=$$GET55FLD(DIALOUT,420.02) Q X=2!(X=3)
"RTN","BPSOSA",90,0)
TCPSERV(DIALOUT)   Q $$GET55FLD(DIALOUT,420.02)=2
"RTN","BPSOSA",91,0)
T1DIRECT(DIALOUT) ;EP -
"RTN","BPSOSA",92,0)
 Q $$GET55FLD(DIALOUT,420.02)=3
"RTN","BPSOSA",93,0)
MODEMTYP(DIALOUT) ;EP - 
"RTN","BPSOSA",94,0)
 Q $$GET55FLD(DIALOUT,.02)
"RTN","BPSOSAA")
0^100^B7048280
"RTN","BPSOSAA",1,0)
BPSOSAA ;BHAM ISC/FCS/DRS/FLS - Connection utility ;06/01/2004
"RTN","BPSOSAA",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAA",3,0)
 Q
"RTN","BPSOSAA",4,0)
 ;  $$CONNECT(DIALOUT)  - initialize modem and dial 
"RTN","BPSOSAA",5,0)
 ;  Called from BPSOSAQ from BPSOSAM
"RTN","BPSOSAA",6,0)
 ;  Various errors can be returned
"RTN","BPSOSAA",7,0)
 ;  Future:  put a field in the 9002313.55 record to put these
"RTN","BPSOSAA",8,0)
 ;   stages as you progress through establishing the connection.
"RTN","BPSOSAA",9,0)
 ;  Future:  tap into that field when constructing display message
"RTN","BPSOSAA",10,0)
 ;   for the data entry / status display screen.
"RTN","BPSOSAA",11,0)
 ;   That is, show more than just "Waiting to transmit" - show
"RTN","BPSOSAA",12,0)
 ;   it going through stages like "Initializing modem",
"RTN","BPSOSAA",13,0)
 ;   "Dialing", "Waiting for remote connect", etc.
"RTN","BPSOSAA",14,0)
 ;   And tack on "Failed while " in front, when something goes wrong.
"RTN","BPSOSAA",15,0)
 ;
"RTN","BPSOSAA",16,0)
CONNECT(DIALOUT) ;EP - 
"RTN","BPSOSAA",17,0)
 ; Open the device 
"RTN","BPSOSAA",18,0)
 N RET
"RTN","BPSOSAA",19,0)
 S RET=$$OPEN^BPSOSAB(DIALOUT)
"RTN","BPSOSAA",20,0)
 I RET Q 20999_",OPEN^BPSOSAB(),"_RET
"RTN","BPSOSAA",21,0)
 S RET=$$STATUS(DIALOUT) I RET Q "20998,STATUS^"_$T(+0)_","_RET_",0"
"RTN","BPSOSAA",22,0)
 ;
"RTN","BPSOSAA",23,0)
 ;Flush input buffer
"RTN","BPSOSAA",24,0)
 S RET=$$FLUSH^BPSOSAB(DIALOUT)
"RTN","BPSOSAA",25,0)
 I RET Q 20997_",FLUSH^BPSOSAB(),"_RET_",1"
"RTN","BPSOSAA",26,0)
 S RET=$$STATUS(DIALOUT) I RET Q "20998,STATUS^"_$T(+0)_","_RET_",1"
"RTN","BPSOSAA",27,0)
 ;
"RTN","BPSOSAA",28,0)
 ; if it's a direct T1 line connection, we are done - return success
"RTN","BPSOSAA",29,0)
 ;
"RTN","BPSOSAA",30,0)
 I $$T1DIRECT^BPSOSA(DIALOUT) Q 0
"RTN","BPSOSAA",31,0)
 ;
"RTN","BPSOSAA",32,0)
 ; First, ATZ command to reset the modem
"RTN","BPSOSAA",33,0)
 ; And flush the buffer, too.
"RTN","BPSOSAA",34,0)
 S RET=$$ATZ^BPSOSAB(DIALOUT)
"RTN","BPSOSAA",35,0)
 I RET Q 20008_",ATZ^BPSOSAB(),"_RET
"RTN","BPSOSAA",36,0)
 S RET=$$STATUS(DIALOUT) I RET Q "20998,STATUS^"_$T(+0)_","_RET_",2"
"RTN","BPSOSAA",37,0)
 S RET=$$FLUSH^BPSOSAB(DIALOUT)
"RTN","BPSOSAA",38,0)
 I RET Q 20997_",FLUSH^BPSOSAB(),"_RET_",2"
"RTN","BPSOSAA",39,0)
 S RET=$$STATUS(DIALOUT) I RET Q "20998,STATUS^"_$T(+0)_","_RET_",3"
"RTN","BPSOSAA",40,0)
 ;
"RTN","BPSOSAA",41,0)
 ; Then send the initialization string, and flush
"RTN","BPSOSAA",42,0)
 ;
"RTN","BPSOSAA",43,0)
 S RET=$$INIMODEM^BPSOSAB(DIALOUT)
"RTN","BPSOSAA",44,0)
 I RET Q 20009_",INIMODEM^BPSOSAB(),"_RET
"RTN","BPSOSAA",45,0)
 S RET=$$STATUS(DIALOUT) I RET Q "20998,STATUS^"_$T(+0)_","_RET_",4"
"RTN","BPSOSAA",46,0)
 S RET=$$FLUSH^BPSOSAB(DIALOUT)
"RTN","BPSOSAA",47,0)
 I RET Q 20997_",FLUSH^BPSOSAB(),"_RET_",3"
"RTN","BPSOSAA",48,0)
 S RET=$$STATUS(DIALOUT) I RET Q "20998,STATUS^"_$T(+0)_","_RET_",5"
"RTN","BPSOSAA",49,0)
 ;
"RTN","BPSOSAA",50,0)
 ; Diagnostics: query the modem for its status
"RTN","BPSOSAA",51,0)
 ;
"RTN","BPSOSAA",52,0)
 S RET=$$MODEMSTS^BPSOSAB(DIALOUT)
"RTN","BPSOSAA",53,0)
 I RET Q 20997_",MODEMSTS^BPSOSAB(),"_RET_",31"
"RTN","BPSOSAA",54,0)
 S RET=$$STATUS(DIALOUT) I RET Q "20998,STATUS^"_$T(+0)_","_RET_",32"
"RTN","BPSOSAA",55,0)
 S RET=$$FLUSH^BPSOSAB(DIALOUT)
"RTN","BPSOSAA",56,0)
 I RET Q 20997_",FLUSH^BPSOSAB(),"_RET_",31"
"RTN","BPSOSAA",57,0)
 S RET=$$STATUS(DIALOUT) I RET Q "20998,STATUS^"_$T(+0)_","_RET_",33"
"RTN","BPSOSAA",58,0)
 ;
"RTN","BPSOSAA",59,0)
 ; Now we can dial the phone, and flush
"RTN","BPSOSAA",60,0)
 ;
"RTN","BPSOSAA",61,0)
 S RET=$$DIAL^BPSOSAB(DIALOUT)
"RTN","BPSOSAA",62,0)
 I RET Q 20010_",DIAL^BPSOSAB(),"_RET
"RTN","BPSOSAA",63,0)
 S RET=$$STATUS(DIALOUT) I RET Q "20998,STATUS^"_$T(+0)_","_RET_",6"
"RTN","BPSOSAA",64,0)
 S RET=$$FLUSH^BPSOSAB(DIALOUT)
"RTN","BPSOSAA",65,0)
 I RET Q 20997_",FLUSH^BPSOSAB(),"_RET_",4"
"RTN","BPSOSAA",66,0)
 S RET=$$STATUS(DIALOUT) I RET Q "20998,STATUS^"_$T(+0)_","_RET_",7"
"RTN","BPSOSAA",67,0)
 Q 0
"RTN","BPSOSAA",68,0)
 ;
"RTN","BPSOSAA",69,0)
STATUS(DIALOUT) ;check status of IO
"RTN","BPSOSAA",70,0)
 ;  Always returns 0 (OK) for direct-connect Modem.
"RTN","BPSOSAA",71,0)
 ; Returns $ZB value for terminal server.
"RTN","BPSOSAA",72,0)
 ; Development:  $$STATRPT^BPSOSAZ, $$GETSTAT^BPSOSAZ may be useful
"RTN","BPSOSAA",73,0)
 ;
"RTN","BPSOSAA",74,0)
 Q 0 ;always quit 0 for VA we dont use modems
"RTN","BPSOSAB")
0^101^B33709386
"RTN","BPSOSAB",1,0)
BPSOSAB ;BHAM ISC/FCS/DRS/FLS - various modem commands ;06/01/2004
"RTN","BPSOSAB",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAB",3,0)
 Q
"RTN","BPSOSAB",4,0)
 ; Low-level IO routines which:
"RTN","BPSOSAB",5,0)
 ; *   take DIALOUT as an argument
"RTN","BPSOSAB",6,0)
 ; *   optionally ECHO as a second argument, passed along to LOG^POSU
"RTN","BPSOSAB",7,0)
 ; *  can be called as either DO ^ or as a $$ function
"RTN","BPSOSAB",8,0)
 ; *  preserve your current $IO
"RTN","BPSOSAB",9,0)
 ;
"RTN","BPSOSAB",10,0)
 ; T1 line should reach these for OPEN and FLUSH, only.
"RTN","BPSOSAB",11,0)
 ;
"RTN","BPSOSAB",12,0)
 ;
"RTN","BPSOSAB",13,0)
 ;IHS/SD/lwj  06/10/02  Changes made to make the open and
"RTN","BPSOSAB",14,0)
 ; use commands Cache compliant.  Open command for Cache must
"RTN","BPSOSAB",15,0)
 ; be in the format of:
"RTN","BPSOSAB",16,0)
 ;  O "|TCP|6802":(199.244.222.6:6802:"M"):3
"RTN","BPSOSAB",17,0)
 ; (the "M" is very important in extending the buffer for the
"RTN","BPSOSAB",18,0)
 ; large claims.)
"RTN","BPSOSAB",19,0)
 ; Changes tested on the Parker Cache test data base and will
"RTN","BPSOSAB",20,0)
 ; be incorporated in Patch 2 of ECME V1.0.  Changes made
"RTN","BPSOSAB",21,0)
 ; to the BPS Dial Out file (^BPS(9002313.55) to include a
"RTN","BPSOSAB",22,0)
 ; Cache Device - this device will be used for the T1 connection
"RTN","BPSOSAB",23,0)
 ; (New field is 420.03 on the DEVICE node)
"RTN","BPSOSAB",24,0)
 ;
"RTN","BPSOSAB",25,0)
 ;
"RTN","BPSOSAB",26,0)
OPEN(DIALOUT) ;EP - return 0 if okay, nonzero if error  
"RTN","BPSOSAB",27,0)
 ; Error can be:  79 - $ZB=79, reproducible by telnet <server> <port>
"RTN","BPSOSAB",28,0)
 ;   or perhaps just due to a few seconds while port resets from prev
"RTN","BPSOSAB",29,0)
 ;   use.
"RTN","BPSOSAB",30,0)
 Q:'$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1)  ;LJE;QUIT IF VA
"RTN","BPSOSAB",31,0)
 N IO,SERVER,PORT,BAUD,RETVAL ;,MSYSTEM
"RTN","BPSOSAB",32,0)
 N X S X=$T(+0)_" - MODEM - OPEN - device "_IO
"RTN","BPSOSAB",33,0)
 I $$TCP^BPSOSA(DIALOUT) D  ; server type device; get server & port names
"RTN","BPSOSAB",34,0)
 . S SERVER=$$SERVER^BPSOSA(DIALOUT),PORT=$$PORT^BPSOSA(DIALOUT)
"RTN","BPSOSAB",35,0)
 . S X=X_" - "_SERVER_", port "_PORT
"RTN","BPSOSAB",36,0)
 E  D
"RTN","BPSOSAB",37,0)
 . S BAUD=$$GET55FLD^BPSOSA(DIALOUT,208)
"RTN","BPSOSAB",38,0)
 . S:'BAUD BAUD=2400
"RTN","BPSOSAB",39,0)
 D LOG^BPSOSL(X,$G(ECHO))
"RTN","BPSOSAB",40,0)
 I $$TCP^BPSOSA(DIALOUT) D
"RTN","BPSOSAB",41,0)
 . ; IHS/SD/lwj 06/10/02 begin changes for Cache
"RTN","BPSOSAB",42,0)
 . I ^%ZOSF("OS")["OpenM" D  Q     ;Cache system
"RTN","BPSOSAB",43,0)
 .. S RETVAL=0
"RTN","BPSOSAB",44,0)
 .. I '$T S RETVAL=1,X=$T(+0)_" - |TCP|:("_SERVER_":"_PORT_")" ;failed
"RTN","BPSOSAB",45,0)
 .. Q
"RTN","BPSOSAB",46,0)
 E  D  ; a plain old traditional modem
"RTN","BPSOSAB",47,0)
 . N PARAM S PARAM(1)=0 ; no echo
"RTN","BPSOSAB",48,0)
 . S PARAM(5)=8388608 ; don't interpret control characters
"RTN","BPSOSAB",49,0)
 . S PARAM(5)=PARAM(5)+2097152 ; CTRL/O is data, not usual CTRL/O
"RTN","BPSOSAB",50,0)
 . S PARAM(5)=PARAM(5)+4096 ; TAB not expanded
"RTN","BPSOSAB",51,0)
 . S PARAM(5)=PARAM(5)+1 ;no echo
"RTN","BPSOSAB",52,0)
 . S PARAM(8)=9*4096
"RTN","BPSOSAB",53,0)
 . S PARAM(8)=PARAM(8)+(0*256)
"RTN","BPSOSAB",54,0)
 . S PARAM(8)=PARAM(8)+(5*16)
"RTN","BPSOSAB",55,0)
 . S PARAM(8)=PARAM(8)+$S(BAUD=2400:11,BAUD=1200:9)
"RTN","BPSOSAB",56,0)
 . I '$T D
"RTN","BPSOSAB",57,0)
 . . S X=$T(+0)_" - MODEM - OPEN command timed out - could not get device "_IO
"RTN","BPSOSAB",58,0)
 . . S RETVAL=-1
"RTN","BPSOSAB",59,0)
 . E  S RETVAL=0
"RTN","BPSOSAB",60,0)
 I RETVAL D LOG^BPSOSL(X,$G(ECHO))
"RTN","BPSOSAB",61,0)
 Q RETVAL
"RTN","BPSOSAB",62,0)
CLOSE(DIALOUT) ;EP - return 0 if okay, nonzero if error
"RTN","BPSOSAB",63,0)
 D FLUSH(DIALOUT,2) ; give it 2 secs to flush?
"RTN","BPSOSAB",64,0)
 D LOG^BPSOSL($T(+0)_" - MODEM - CLOSE - device "_IO,$G(ECHO))
"RTN","BPSOSAB",65,0)
FLUSH(DIALOUT,TO) ;EP - return 0 if okay, nonzero if error
"RTN","BPSOSAB",66,0)
 I '$D(TO) S TO=0
"RTN","BPSOSAB",67,0)
 I I D
"RTN","BPSOSAB",68,0)
 . N N F N=I:-1:1 I $E(FLUSHSTR,N)?1C D
"RTN","BPSOSAB",69,0)
 . . S FLUSHSTR=$E(FLUSHSTR,1,N-1)_"\"_$TR($J($A(FLUSHSTR,N),3)," ","0")_$E(FLUSHSTR,N+1,$L(FLUSHSTR))
"RTN","BPSOSAB",70,0)
 . D LOG^BPSOSL($T(+0)_" - MODEM - FLUSH - "_I_" byte(s) - "_FLUSHSTR,$G(ECHO))
"RTN","BPSOSAB",71,0)
 I I>MAXI D  Q -1 ; runaway - error
"RTN","BPSOSAB",72,0)
 . D LOG^BPSOSL($T(+0)_" - MODEM - FLUSH - runaway after "_MAXI_" bytes",$G(ECHO))
"RTN","BPSOSAB",73,0)
 Q 0
"RTN","BPSOSAB",74,0)
 ; Error trap for FLUSH, still need this for <DSCON>
"RTN","BPSOSAB",75,0)
FZE D LOGZE("FLUSH") Q -1
"RTN","BPSOSAB",76,0)
LOGZE(WHERE) D LOG^BPSOSL($T(+0)_" - MODEM - "_WHERE_" - $ZE="_$$ZE^BPSOS) Q
"RTN","BPSOSAB",77,0)
 ;
"RTN","BPSOSAB",78,0)
 ;  ECHOOFF  Issue the echo off command to the modem.
"RTN","BPSOSAB",79,0)
 ;   It is assumed that every modem type has the command E0.
"RTN","BPSOSAB",80,0)
 ;   If that changes, you need to build a field into 9002313.54.
"RTN","BPSOSAB",81,0)
 ;
"RTN","BPSOSAB",82,0)
ECHOOFF(DIALOUT)   ;
"RTN","BPSOSAB",83,0)
 N RETVAL
"RTN","BPSOSAB",84,0)
 D LOG^BPSOSL($T(+0)_" - MODEM - E0 to turn echo off",$G(ECHO))
"RTN","BPSOSAB",85,0)
 D COMMAND^BPSOSA(DIALOUT,"E0") ; hopefully same for all modem types?
"RTN","BPSOSAB",86,0)
 S RETVAL=$$WAITSTR^BPSOSAW(DIALOUT,"OK",10) D FLUSH(DIALOUT,1)
"RTN","BPSOSAB",87,0)
 Q RETVAL
"RTN","BPSOSAB",88,0)
 ;
"RTN","BPSOSAB",89,0)
 ;  ATZ   Issue the ATZ (Reset) command to the modem.
"RTN","BPSOSAB",90,0)
 ;   It is assumed that every modem type has the command Z.
"RTN","BPSOSAB",91,0)
 ;   If that changes, you need to build a field into 9002313.54.
"RTN","BPSOSAB",92,0)
 ;
"RTN","BPSOSAB",93,0)
ATZ(DIALOUT) ;EP - return 0 if okay, nonzero if error
"RTN","BPSOSAB",94,0)
 ; added FLUSH calls to give a little cushion around the ATZ command
"RTN","BPSOSAB",95,0)
 N RETVAL
"RTN","BPSOSAB",96,0)
 D ECHOOFF(DIALOUT)
"RTN","BPSOSAB",97,0)
 D LOG^BPSOSL($T(+0)_" - MODEM - INIT - ATZ command",$G(ECHO))
"RTN","BPSOSAB",98,0)
 D COMMAND^BPSOSA(DIALOUT,"ATZ") ; hopefully same for all modem types?
"RTN","BPSOSAB",99,0)
 S RETVAL=$$WAITSTR^BPSOSAW(DIALOUT,"OK",20) D FLUSH(DIALOUT,1)
"RTN","BPSOSAB",100,0)
 D ECHOOFF(DIALOUT) ; in case software reset turned it on again
"RTN","BPSOSAB",101,0)
 Q RETVAL
"RTN","BPSOSAB",102,0)
 ;
"RTN","BPSOSAB",103,0)
 ;  INIMODEM   Send the modem initialization command.
"RTN","BPSOSAB",104,0)
 ;    This varies a lot by modem type.
"RTN","BPSOSAB",105,0)
 ;
"RTN","BPSOSAB",106,0)
INIMODEM(DIALOUT) ;EP - return 0 if okay, nonzero if error
"RTN","BPSOSAB",107,0)
 N RETVAL
"RTN","BPSOSAB",108,0)
 N INI S INI=$P(^BPS(9002313.54,$$MODEMTYP^BPSOSA(DIALOUT),"INIT"),U)
"RTN","BPSOSAB",109,0)
 D COMMAND^BPSOSA(DIALOUT,INI)
"RTN","BPSOSAB",110,0)
 D LOG^BPSOSL($T(+0)_" - MODEM - INIT - command "_INI,$G(ECHO))
"RTN","BPSOSAB",111,0)
 S RETVAL=$$WAITSTR^BPSOSAW(DIALOUT,"OK",20) D FLUSH(DIALOUT,1)
"RTN","BPSOSAB",112,0)
 Q RETVAL
"RTN","BPSOSAB",113,0)
 ;
"RTN","BPSOSAB",114,0)
 ;    MODEMSTS - Issue the modem's query command and log the output.
"RTN","BPSOSAB",115,0)
 ;       The command comes from 9002313.54, since the query
"RTN","BPSOSAB",116,0)
 ;       command varies a lot from one modem to another.
"RTN","BPSOSAB",117,0)
 ;
"RTN","BPSOSAB",118,0)
MODEMSTS(DIALOUT) ;EP - return 0; or you can just DO it. 
"RTN","BPSOSAB",119,0)
 N MODEMTYP S MODEMTYP=$$MODEMTYP^BPSOSA(DIALOUT)
"RTN","BPSOSAB",120,0)
 S %=$G(^BPS(9002313.54,MODEMTYP,"QUERY FOR STATUS"))
"RTN","BPSOSAB",121,0)
 S CMD=$P(%,U),TIMEOUT=$P(%,U,2),LOOK4OK=$P(%,U,3)
"RTN","BPSOSAB",122,0)
 I CMD="" Q 0  ; no Inquiry command for this modem type??
"RTN","BPSOSAB",123,0)
 I 'TIMEOUT S TIMEOUT=1
"RTN","BPSOSAB",124,0)
 D LOG^BPSOSL($T(+0)_" - MODEM - QUERY - command "_CMD,$G(ECHO))
"RTN","BPSOSAB",125,0)
 D COMMAND^BPSOSA(DIALOUT,CMD)
"RTN","BPSOSAB",126,0)
 F I=1:1 R X(I):TIMEOUT Q:'$T  Q:LOOK4OK&($TR(X(I),$C(13,10),"")="OK")
"RTN","BPSOSAB",127,0)
 D LOG^BPSOSL($T(+0)_" - MODEM - QUERY - reply:",$G(ECHO))
"RTN","BPSOSAB",128,0)
 F I=1:1 Q:'$D(X(I))  D
"RTN","BPSOSAB",129,0)
 .D LOG^BPSOSL($TR(X(I),$C(13,10),""),$G(ECHO))
"RTN","BPSOSAB",130,0)
 Q 0
"RTN","BPSOSAB",131,0)
 ;
"RTN","BPSOSAB",132,0)
 ;  DIAL  -  Issue the command to dial the phone
"RTN","BPSOSAB",133,0)
 ;           and wait for the successful CONNECT 2400 response.
"RTN","BPSOSAB",134,0)
 ;
"RTN","BPSOSAB",135,0)
DIAL(DIALOUT) ;EP - return 0 if okay, nonzero if error
"RTN","BPSOSAB",136,0)
 N DIAL,MODEMTYP,CONNMSG
"RTN","BPSOSAB",137,0)
 S DIAL="ATDT"_$$PHONENUM(DIALOUT)
"RTN","BPSOSAB",138,0)
 S MODEMTYP=$$MODEMTYP^BPSOSA(DIALOUT)
"RTN","BPSOSAB",139,0)
 S CONNMSG=$P($G(^BPS(9002313.54,MODEMTYP,"CONNECT MESSAGE")),U)
"RTN","BPSOSAB",140,0)
 D LOG^BPSOSL($T(+0)_" - MODEM - DIAL - command "_DIAL,$G(ECHO))
"RTN","BPSOSAB",141,0)
 D COMMAND^BPSOSA(DIALOUT,DIAL)
"RTN","BPSOSAB",142,0)
 N X S X=$T(+0)_" - MODEM - DIAL - "
"RTN","BPSOSAB",143,0)
 I CONNMSG="" D  S RETVAL=0
"RTN","BPSOSAB",144,0)
 .D LOG^BPSOSL(X_" but no CONNECT MESSAGE in 9002313.54",$G(ECHO))
"RTN","BPSOSAB",145,0)
 E  I '$$WAITSTR^BPSOSAW(DIALOUT,CONNMSG,40) D  S RETVAL=0
"RTN","BPSOSAB",146,0)
 .D LOG^BPSOSL(X_"successful",$G(ECHO))
"RTN","BPSOSAB",147,0)
 E  D  S RETVAL=1
"RTN","BPSOSAB",148,0)
 .D LOG^BPSOSL(X_"did not receive expected "_CONNMSG,$G(ECHO))
"RTN","BPSOSAB",149,0)
 Q RETVAL
"RTN","BPSOSAB",150,0)
 ;
"RTN","BPSOSAB",151,0)
 ;   $$PHONENUM   Look up the phone number for this dial out.
"RTN","BPSOSAB",152,0)
 ;
"RTN","BPSOSAB",153,0)
PHONENUM(N)        ;
"RTN","BPSOSAB",154,0)
 N X,Y
"RTN","BPSOSAB",155,0)
 S X=$P($G(^BPS(9002313.99,1,"OUTSIDE LINE")),U)
"RTN","BPSOSAB",156,0)
 ; If you do need to dial a number to get an outside line,
"RTN","BPSOSAB",157,0)
 ; tack on a comma if needed - modem will pause to wait for
"RTN","BPSOSAB",158,0)
 ; second dial tone.  (No parameter needed yet since apparently
"RTN","BPSOSAB",159,0)
 ; all modems have this feature.)
"RTN","BPSOSAB",160,0)
 I X]"",$E(X,$L(X))'="," S X=X_","
"RTN","BPSOSAB",161,0)
 S Y=$$GET55FLD^BPSOSA(N,450.01)
"RTN","BPSOSAB",162,0)
 S X=$P(X,U,$S($E(Y)=1:1,1:2)) ; local or long distance?
"RTN","BPSOSAB",163,0)
 Q $S(Y]"":X_Y,1:"")
"RTN","BPSOSAB",164,0)
 ;
"RTN","BPSOSAB",165,0)
 ;   HANGUP  -  Issue the hang up command.
"RTN","BPSOSAB",166,0)
 ;
"RTN","BPSOSAB",167,0)
HANGUP(DIALOUT) ;EP -   this does nothing.
"RTN","BPSOSAB",168,0)
 ; The "W +" and timeout stuff wasn't effective.
"RTN","BPSOSAB",169,0)
 ; Just the CLOSE seems to take care of things okay at ANMC.
"RTN","BPSOSAB",170,0)
 ; This is probably the case at other sites, too.
"RTN","BPSOSAB",171,0)
 G HANGUP99
"RTN","BPSOSAB",172,0)
 N TRY,I,ANS
"RTN","BPSOSAB",173,0)
 ;
"RTN","BPSOSAB",174,0)
 ;Make sure input variables are defined
"RTN","BPSOSAB",175,0)
 Q:$G(IO)=""
"RTN","BPSOSAB",176,0)
 ;
"RTN","BPSOSAB",177,0)
 ;Get modem into command mode, then hangup, try up to 3 times
"RTN","BPSOSAB",178,0)
 F TRY=1:1:3 D  Q:ANS=1
"RTN","BPSOSAB",179,0)
 .H 1
"RTN","BPSOSAB",180,0)
 .H 2
"RTN","BPSOSAB",181,0)
 .H 1
"RTN","BPSOSAB",182,0)
 . D IMPOSS^BPSOSUE("P","T","Code not reachable","Obsolete subroutine/not used","HANGUP",$T(+0))
"RTN","BPSOSAB",183,0)
 ;
"RTN","BPSOSAB",184,0)
 ;Close input/output device
"RTN","BPSOSAB",185,0)
HANGUP99 ;
"RTN","BPSOSAB",186,0)
 Q
"RTN","BPSOSAD")
0^102^B492601
"RTN","BPSOSAD",1,0)
BPSOSAD ;BHAM ISC/FCS/DRS/FLS - Longitudinal Redundancy Checker routines ;06/01/2004
"RTN","BPSOSAD",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAD",3,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSAD",4,0)
 Q
"RTN","BPSOSAD",5,0)
 ;
"RTN","BPSOSAD",6,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSAD",7,0)
 ;Longitudinal Redundancy Checker routines
"RTN","BPSOSAD",8,0)
 ;
"RTN","BPSOSAD",9,0)
 ;
"RTN","BPSOSAD",10,0)
 ;Parameters:  STRING - STRING of characters (eg: message to be sent
"RTN","BPSOSAD",11,0)
 ;                      to or received from host)
"RTN","BPSOSAD",12,0)
 ;
"RTN","BPSOSAD",13,0)
 ;Returns:     LRC    - Character representing the cumulative XOR of
"RTN","BPSOSAD",14,0)
 ;                      each character in the STRING
"RTN","BPSOSAD",15,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSAD",16,0)
LRC(STRING) ;EP -
"RTN","BPSOSAD",17,0)
 N LRC,CHAR,INDEX,LEN
"RTN","BPSOSAD",18,0)
 ;
"RTN","BPSOSAD",19,0)
 ;Loop through STRING and calculate LRC by doing a cumulative XOR
"RTN","BPSOSAD",20,0)
 S LRC=$C(0),LEN=$L(STRING)
"RTN","BPSOSAD",21,0)
 F INDEX=1:1:LEN D
"RTN","BPSOSAD",22,0)
 .S CHAR=$E(STRING,INDEX)
"RTN","BPSOSAD",23,0)
 Q LRC   ;- for MSM System /GTI
"RTN","BPSOSAD",24,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSAD",25,0)
 ;Test if LRC character received from host for a message is correct
"RTN","BPSOSAD",26,0)
 ;
"RTN","BPSOSAD",27,0)
 ;Parameters:  GETMSG   - Message received from host
"RTN","BPSOSAD",28,0)
 ;             LRC      - LRC character received from host
"RTN","BPSOSAD",29,0)
 ;
"RTN","BPSOSAD",30,0)
 ;Returns:     1        - LRC is correct
"RTN","BPSOSAD",31,0)
 ;             0        - LRC is not correct
"RTN","BPSOSAD",32,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSAD",33,0)
TESTLRC(GETMSG,LRC) ;EP - from BPSOSAM
"RTN","BPSOSAD",34,0)
 N XLRC
"RTN","BPSOSAD",35,0)
 S XLRC=$$LRC(GETMSG)
"RTN","BPSOSAD",36,0)
 Q $S(LRC=XLRC:1,1:0)
"RTN","BPSOSAM")
0^103^B58130560
"RTN","BPSOSAM",1,0)
BPSOSAM ;BHAM ISC/FCS/DRS/FLS - main program for send/receive communications with the Envoy or NDC switches ;06/01/2004
"RTN","BPSOSAM",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAM",3,0)
 ;
"RTN","BPSOSAM",4,0)
 ;  BPSOSAM is the main program for send/receive communications
"RTN","BPSOSAM",5,0)
 ;  with the Envoy or NDC switches.  Or certain insurance company
"RTN","BPSOSAM",6,0)
 ;  systems, such as the PCS test system.
"RTN","BPSOSAM",7,0)
 ;
"RTN","BPSOSAM",8,0)
 ;  Sets up these variables:
"RTN","BPSOSAM",9,0)
 ;     BPSECT2 = count of successful xmit/recv transactions
"RTN","BPSOSAM",10,0)
 ;            (without regard to rejected claims, merely that the
"RTN","BPSOSAM",11,0)
 ;             xmit/recv sequence completed with apparent success)
"RTN","BPSOSAM",12,0)
 ;
"RTN","BPSOSAM",13,0)
 ;  Subroutines are in BPSOSAN, BPSOSAO, BPSOSAP, BPSOSAQ
"RTN","BPSOSAM",14,0)
 ;
"RTN","BPSOSAM",15,0)
 ;
"RTN","BPSOSAM",16,0)
 ;
"RTN","BPSOSAM",17,0)
 Q
"RTN","BPSOSAM",18,0)
SEND(DIALOUT) ;EP - from BPSOSQ3
"RTN","BPSOSAM",19,0)
 S BPSECT2=0
"RTN","BPSOSAM",20,0)
 ;
"RTN","BPSOSAM",21,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1
"RTN","BPSOSAM",22,0)
 N CLAIMNXT,I,RESPLRC,RESPMSG
"RTN","BPSOSAM",23,0)
 N HMSG,LRCOK,SENDMSG,SENDMSGP,GETMSG,CLAIMIEN,LRC,RET
"RTN","BPSOSAM",24,0)
 N TRANSBEG,TRANSEND,TRANSTIM ; transaction begin,end,time
"RTN","BPSOSAM",25,0)
 N SEG S SEG=245 ; length of string segments storing long string in gbl
"RTN","BPSOSAM",26,0)
 ;
"RTN","BPSOSAM",27,0)
 N ACK,ENQ,EOT,ETX,NAK,STX,ETB
"RTN","BPSOSAM",28,0)
 S ACK=$C(6),ENQ=$C(5),EOT=$C(4),ETX=$C(3)
"RTN","BPSOSAM",29,0)
 S NAK=$C(21),STX=$C(2),ETB=$C(23)
"RTN","BPSOSAM",30,0)
 ;
"RTN","BPSOSAM",31,0)
S12 ; 
"RTN","BPSOSAM",32,0)
 ;
"RTN","BPSOSAM",33,0)
 S VARX=0 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1 G VA1 ;LJE;7/14/03
"RTN","BPSOSAM",34,0)
 N IO S IO=$$IO^BPSOSA(DIALOUT) I IO="" G S12:$$IMPOSS^BPSOSUE("DB","TRI","IO field missing in DIALOUT="_DIALOUT,,"S12",$T(+0))
"RTN","BPSOSAM",35,0)
 ; IHS/SD/lwj 06/10/02 - end of Cache changes
"RTN","BPSOSAM",36,0)
 ;
"RTN","BPSOSAM",37,0)
 N T1LINE S T1LINE=$$T1DIRECT^BPSOSA(DIALOUT)
"RTN","BPSOSAM",38,0)
 ;
"RTN","BPSOSAM",39,0)
VA1 I $$SHUTDOWN Q 0
"RTN","BPSOSAM",40,0)
 I '$$GETNEXT^BPSOSAP Q 0
"RTN","BPSOSAM",41,0)
 I VARX G START  ;LJE;7/16/03
"RTN","BPSOSAM",42,0)
 ; Dial the phone and connect to Envoy
"RTN","BPSOSAM",43,0)
 S RET=$$CONNECT^BPSOSAQ(DIALOUT)
"RTN","BPSOSAM",44,0)
 I RET D PUTBACK^BPSOSAP Q RET ; error? put back claim before quitting
"RTN","BPSOSAM",45,0)
 ;
"RTN","BPSOSAM",46,0)
START ;Main message loop ; we have SENDMSG and SENDMSGP and CLAIMIEN
"RTN","BPSOSAM",47,0)
 ; If anything goes wrong, be sure to DO PUTBACK before quitting!
"RTN","BPSOSAM",48,0)
 ;
"RTN","BPSOSAM",49,0)
 D CLAIMBEG ; write to our own log file - beginning for this claim
"RTN","BPSOSAM",50,0)
 D SETCOMMS^BPSOSU(CLAIMIEN,$$GETPLACE^BPSOSL) ; mark start in .59
"RTN","BPSOSAM",51,0)
 ;
"RTN","BPSOSAM",52,0)
LOOP0 ; Wait for host to send ENQ
"RTN","BPSOSAM",53,0)
 ;
"RTN","BPSOSAM",54,0)
 I 'VARX I 'T1LINE D  I RET Q RET  ;LJE;7/16/03
"RTN","BPSOSAM",55,0)
 . S RET=$$INITIATE^BPSOSAO I RET D  ; wait for host to send ENQ
"RTN","BPSOSAM",56,0)
 . . D PUTBACK^BPSOSAP,CLAIMEND ; and if you didn't get it...
"RTN","BPSOSAM",57,0)
 ;
"RTN","BPSOSAM",58,0)
 ;Send message to host:   STX, message, ETX, LRC
"RTN","BPSOSAM",59,0)
 ;
"RTN","BPSOSAM",60,0)
 D SETCSTAT^BPSOSU(CLAIMIEN,60) ; set prescrs' status = "Transmitting"
"RTN","BPSOSAM",61,0)
LOOP1A D LOG("2 - Sending message #"_CLAIMIEN)
"RTN","BPSOSAM",62,0)
 N RETVAL
"RTN","BPSOSAM",63,0)
 ; NDC and test mode, "HN." instead of "HN*" ?  Ancient code.
"RTN","BPSOSAM",64,0)
 ; I don't know if it makes a shred of difference
"RTN","BPSOSAM",65,0)
 I $E(SENDMSG,1,3)="HN." D
"RTN","BPSOSAM",66,0)
 . D LOG("2 - Sending message in TEST mode")
"RTN","BPSOSAM",67,0)
 S TRANSBEG=$P($H,",",2) ; beginning time (for timing transaction)
"RTN","BPSOSAM",68,0)
 I VARX D  G AGAIN  ;LJE;7/14/03
"RTN","BPSOSAM",69,0)
 . K VAMSG
"RTN","BPSOSAM",70,0)
 . M VAMSG("HLS")=SENDMSGP
"RTN","BPSOSAM",71,0)
 . N IEN59 S IEN59="",IEN59=$O(^BPST("AE",CLAIMIEN,IEN59))
"RTN","BPSOSAM",72,0)
 . S:IEN59="" IEN59=$O(^BPST("AER",CLAIMIEN,IEN59))
"RTN","BPSOSAM",73,0)
 . D CHOP^BPSECMC2(.VAMSG,CLAIMIEN,IEN59) ;NOT CALLING YET
"RTN","BPSOSAM",74,0)
 . S BPSECT2=BPSECT2+1
"RTN","BPSOSAM",75,0)
 . K VAMSG
"RTN","BPSOSAM",76,0)
 E  S RETVAL=$$SENDREQ^BPSOSAS(DIALOUT,.SENDMSG)
"RTN","BPSOSAM",77,0)
 D  ; stats - figure out which piece the transaction code increments
"RTN","BPSOSAM",78,0)
 .N % S %=$P($G(^BPSC(CLAIMIEN,100)),U,3)
"RTN","BPSOSAM",79,0)
 .S %=$S(%>0&(%<5):%,%=11:5,1:19)
"RTN","BPSOSAM",80,0)
 .D ADDSTAT^BPSOSUD("C",2,1,"C",3,$L(SENDMSG)+3,"C",%,1)
"RTN","BPSOSAM",81,0)
 ;
"RTN","BPSOSAM",82,0)
 ;
"RTN","BPSOSAM",83,0)
LOOP1B ;
"RTN","BPSOSAM",84,0)
 I T1LINE S HMSG="ACK" G LOOP1C
"RTN","BPSOSAM",85,0)
 D LOG("2 - Waiting for ACK or NAK")
"RTN","BPSOSAM",86,0)
 S HMSG=$$WAITCHAR(ACK_NAK_STX_ENQ,60)
"RTN","BPSOSAM",87,0)
 I HMSG="ACK" D
"RTN","BPSOSAM",88,0)
 . ; we got what we expected; do nothing else here
"RTN","BPSOSAM",89,0)
 E  I HMSG="STX" D
"RTN","BPSOSAM",90,0)
 . D LOG("2 - Missing ACK but got STX; must be start of response?")
"RTN","BPSOSAM",91,0)
 E  I HMSG="NAK" D  G LOOP1A
"RTN","BPSOSAM",92,0)
 . D LOG("2 - Host sent NAK - we will resend")
"RTN","BPSOSAM",93,0)
 E  I HMSG="ENQ" D  G LOOP1A ; Envoy 4.1, p. 12
"RTN","BPSOSAM",94,0)
 . D LOG("2 - Host sent another ENQ - we will resend")
"RTN","BPSOSAM",95,0)
 E  D  Q RET
"RTN","BPSOSAM",96,0)
 . D LOG("2 - But received "_HMSG_" instead.")
"RTN","BPSOSAM",97,0)
 . D PUTBACK^BPSOSAP,CLAIMEND ; put message back for later transmission
"RTN","BPSOSAM",98,0)
 . I HMSG'="+++" D HANGUP
"RTN","BPSOSAM",99,0)
 . S RET=$S(HMSG="+++":31101,HMSG="":31102,1:31103)
"RTN","BPSOSAM",100,0)
 ;
"RTN","BPSOSAM",101,0)
 ; The response message is preceded by STX
"RTN","BPSOSAM",102,0)
 ; If we just got an ACK, then wait for the STX
"RTN","BPSOSAM",103,0)
 ;
"RTN","BPSOSAM",104,0)
LOOP1C I HMSG="ACK" D
"RTN","BPSOSAM",105,0)
 . I T1LINE S HMSG="STX" Q
"RTN","BPSOSAM",106,0)
 . S HMSG=$$WAITCHAR(STX,60)
"RTN","BPSOSAM",107,0)
 . D LOG("2 - "_HMSG_" received from host")
"RTN","BPSOSAM",108,0)
 E  I HMSG="STX" D
"RTN","BPSOSAM",109,0)
 . ; do nothing; fall through with STX still here
"RTN","BPSOSAM",110,0)
 E  D  Q 30239
"RTN","BPSOSAM",111,0)
 . D LOG("Internal error at LOOP1C")
"RTN","BPSOSAM",112,0)
 ;
"RTN","BPSOSAM",113,0)
 I HMSG="STX" D
"RTN","BPSOSAM",114,0)
 . ; nothing, got what we expected
"RTN","BPSOSAM",115,0)
 E  D  Q RET
"RTN","BPSOSAM",116,0)
 . D LOG("2 - Expected STX but got "_HMSG_" instead")
"RTN","BPSOSAM",117,0)
 . D PUTBACK^BPSOSAP,CLAIMEND
"RTN","BPSOSAM",118,0)
 . S RET=$S(HMSG="+++":30251,HMSG="":30252,1:30253)
"RTN","BPSOSAM",119,0)
 ;
"RTN","BPSOSAM",120,0)
 ;   The host sends us the response message
"RTN","BPSOSAM",121,0)
 ;
"RTN","BPSOSAM",122,0)
LOOP3 S (GETMSG,LRC)=""
"RTN","BPSOSAM",123,0)
 D SETCSTAT^BPSOSU(CLAIMIEN,70) ; status = "Receiving response"
"RTN","BPSOSAM",124,0)
 D LOG("3 - Gathering response from host")
"RTN","BPSOSAM",125,0)
 S HMSG=$$GETMSG^BPSOSAR(DIALOUT,.RESPMSG,.RESPLRC,60)
"RTN","BPSOSAM",126,0)
 ;
"RTN","BPSOSAM",127,0)
 ;         HMSG="ETX" or "EOT" or "" (if timed out)
"RTN","BPSOSAM",128,0)
 ;
"RTN","BPSOSAM",129,0)
 I HMSG="ETX" D
"RTN","BPSOSAM",130,0)
 . D LOG("3 - Received "_$L(RESPMSG)_" bytes; LRC "_$A(RESPLRC))
"RTN","BPSOSAM",131,0)
 . D ADDSTAT^BPSOSUD("C",4,1,"C",5,$L(RESPMSG)+3)
"RTN","BPSOSAM",132,0)
 E  D  Q RET
"RTN","BPSOSAM",133,0)
 . D INCSTAT^BPSOSUD("CR2",1,"CR2",$S(HMSG="EOT":2,HMSG="":3,HMSG="+++":4,1:9))
"RTN","BPSOSAM",134,0)
 . D LOG("3 - Error while gathering response: HMSG="_HMSG)
"RTN","BPSOSAM",135,0)
 . D PUTBACK^BPSOSAP
"RTN","BPSOSAM",136,0)
 . D CLAIMEND
"RTN","BPSOSAM",137,0)
 . I HMSG'="+++" D HANGUP
"RTN","BPSOSAM",138,0)
 . S RET=$S(HMSG="+++":30261,HMSG="":30262,1:30263)
"RTN","BPSOSAM",139,0)
 I T1LINE!(VARX) S LRCOK=1 ;
"RTN","BPSOSAM",140,0)
 E  I $L(RESPMSG)<9 S LRCOK=0 ; we have seen 1-byte response msg!
"RTN","BPSOSAM",141,0)
 E  S LRCOK=$$TESTLRC^BPSOSAD(RESPMSG,RESPLRC)
"RTN","BPSOSAM",142,0)
 ;
"RTN","BPSOSAM",143,0)
 S CLAIMNXT=0 ; assume no claims to send after this one
"RTN","BPSOSAM",144,0)
 I LRCOK D
"RTN","BPSOSAM",145,0)
 . N CLAIMIEN ; protect CLAIMIEN - $$GETNEXT will reset it
"RTN","BPSOSAM",146,0)
 . I '$$SHUTDOWN S CLAIMNXT=$$GETNEXT^BPSOSAP ; remember next CLAIMIEN
"RTN","BPSOSAM",147,0)
 . I CLAIMNXT,$P($G(^BPS(9002313.55,DIALOUT,"PROTOCOL")),U) D
"RTN","BPSOSAM",148,0)
 . . Q:T1LINE
"RTN","BPSOSAM",149,0)
 . . D LOG("6 - Send ETB to host")
"RTN","BPSOSAM",150,0)
 . . D SENDETB^BPSOSAS(DIALOUT)
"RTN","BPSOSAM",151,0)
 . E  D
"RTN","BPSOSAM",152,0)
 . . Q:T1LINE
"RTN","BPSOSAM",153,0)
 . . D LOG("6 - Send ACK to host")
"RTN","BPSOSAM",154,0)
 . . D SENDACK^BPSOSAS(DIALOUT)
"RTN","BPSOSAM",155,0)
 . S BPSECT2=BPSECT2+1 ; count our successes (and blessings)
"RTN","BPSOSAM",156,0)
 . I BPSECT2>10,BPSECT2#5=0 D TASK^BPSOSQ3()
"RTN","BPSOSAM",157,0)
 E  D
"RTN","BPSOSAM",158,0)
 . D LOG("6 - Send NAK to host because of LRC disagreement")
"RTN","BPSOSAM",159,0)
 . D SENDNAK^BPSOSAS(DIALOUT)
"RTN","BPSOSAM",160,0)
 ;
"RTN","BPSOSAM",161,0)
PASTLRC ;
"RTN","BPSOSAM",162,0)
 S TRANSEND=$P($H,",",2) ; timing - when transaction completed
"RTN","BPSOSAM",163,0)
 S TRANSTIM=TRANSEND-TRANSBEG S:TRANSTIM<0 TRANSTIM=TRANSTIM+86400
"RTN","BPSOSAM",164,0)
 ; Statistics:  Comms - Transaction Time Comms
"RTN","BPSOSAM",165,0)
 ;              Comms - Send ACK      Comms - Send NAK
"RTN","BPSOSAM",166,0)
 D ADDSTAT^BPSOSUD("CT",1,TRANSTIM,"C",7+'LRCOK,1)
"RTN","BPSOSAM",167,0)
 ;
"RTN","BPSOSAM",168,0)
 I 'LRCOK D  G LOOP1C
"RTN","BPSOSAM",169,0)
 . S HMSG="ACK" ; fake it out so it drops into the WAITCHAR(STX) code
"RTN","BPSOSAM",170,0)
 ;
"RTN","BPSOSAM",171,0)
 D CLAIMEND
"RTN","BPSOSAM",172,0)
 ;
"RTN","BPSOSAM",173,0)
LR L +^BPSECX("POS",DIALOUT,"R",CLAIMIEN):300 ; lock the response
"RTN","BPSOSAM",174,0)
 I '$T G LR:$$IMPOSS^BPSOSUE("L","RIT","LOCK response",,"LR",$T(+0))
"RTN","BPSOSAM",175,0)
 K ^BPSECX("POS",DIALOUT,"R",CLAIMIEN) ; kill anything that's there
"RTN","BPSOSAM",176,0)
 F I=1:SEG:$L(RESPMSG) D
"RTN","BPSOSAM",177,0)
 .S ^BPSECX("POS",DIALOUT,"R",CLAIMIEN,I\SEG+1)=$E(RESPMSG,I,I+SEG-1)
"RTN","BPSOSAM",178,0)
 .S ^BPSECX("POS",DIALOUT,"R",CLAIMIEN,0)=I\SEG+1
"RTN","BPSOSAM",179,0)
 L -^BPSECX("POS",DIALOUT,"R",CLAIMIEN) ; unlock the response
"RTN","BPSOSAM",180,0)
 D SETCSTAT^BPSOSU(CLAIMIEN,80) ; Waiting to process response.
"RTN","BPSOSAM",181,0)
 ;
"RTN","BPSOSAM",182,0)
 ; Now we're ready to go again.
"RTN","BPSOSAM",183,0)
AGAIN ;LJE;7/14/03
"RTN","BPSOSAM",184,0)
 S:'$G(CLAIMNXT) CLAIMNXT=0
"RTN","BPSOSAM",185,0)
 I CLAIMNXT S CLAIMIEN=CLAIMNXT G START
"RTN","BPSOSAM",186,0)
 ;
"RTN","BPSOSAM",187,0)
 ; No more to send.
"RTN","BPSOSAM",188,0)
 ; We expect EOT from Envoy.  NDC might send ENQ here?
"RTN","BPSOSAM",189,0)
 I VARX Q 0  ;LJE;7/21/03
"RTN","BPSOSAM",190,0)
 I T1LINE Q 0
"RTN","BPSOSAM",191,0)
 S HMSG=$$WAITCHAR(EOT_ENQ,3)
"RTN","BPSOSAM",192,0)
 I HMSG'="+++",HMSG'="ENQ" D
"RTN","BPSOSAM",193,0)
 . D LOG("9 - No more to send; expect EOT, got "_HMSG)
"RTN","BPSOSAM",194,0)
 I HMSG'="+++" D HANGUP
"RTN","BPSOSAM",195,0)
 Q 0
"RTN","BPSOSAM",196,0)
 ; ----- end of main part of routine -----
"RTN","BPSOSAM",197,0)
 ;
"RTN","BPSOSAM",198,0)
LOG(X) D LOG^BPSOSL($T(+0)_" - "_X) Q
"RTN","BPSOSAM",199,0)
 ;
"RTN","BPSOSAM",200,0)
 ;
"RTN","BPSOSAM",201,0)
WAITCHAR(CHARS,TIMEOUT) ;EP -
"RTN","BPSOSAM",202,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) Q 1 ;LJE;7/16/03
"RTN","BPSOSAM",203,0)
 N RET S RET=$$WAITCHAR^BPSOSAW(DIALOUT,CHARS,TIMEOUT)
"RTN","BPSOSAM",204,0)
 I RET="+++" D LOG("WAITCHAR tells us that modem is disconnected.")
"RTN","BPSOSAM",205,0)
 Q RET
"RTN","BPSOSAM",206,0)
 ;
"RTN","BPSOSAM",207,0)
SHUTDOWN()         N RET S RET=$$SHUTDOWN^BPSOSQ3
"RTN","BPSOSAM",208,0)
 I RET D LOG("The transmit/receive shutdown flag is set.")
"RTN","BPSOSAM",209,0)
 Q RET
"RTN","BPSOSAM",210,0)
HANGUP D HANGUP^BPSOSAB(DIALOUT) Q
"RTN","BPSOSAM",211,0)
 ;  NOTE!!!  Print of log for one claim depends on finding
"RTN","BPSOSAM",212,0)
 ;  the exact texts shown below!
"RTN","BPSOSAM",213,0)
CLAIMBEG D LOG("CLAIM - BEGIN - #"_CLAIMIEN_$$CLAIM01) Q
"RTN","BPSOSAM",214,0)
CLAIMEND D LOG("CLAIM - END - #"_CLAIMIEN_$$CLAIM01) Q
"RTN","BPSOSAM",215,0)
CLAIM01() Q " ("_$P(^BPSC(CLAIMIEN,0),U)_")"
"RTN","BPSOSAN")
0^104^B4058873
"RTN","BPSOSAN",1,0)
BPSOSAN ;BHAM ISC/FCS/DRS/FLS - Check for cancellation ;06/01/2004
"RTN","BPSOSAN",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAN",3,0)
 Q
"RTN","BPSOSAN",4,0)
 ;
"RTN","BPSOSAN",5,0)
 ; CANCEL:  See any of CLAIMIEN's claims have been marked for
"RTN","BPSOSAN",6,0)
 ;   cancellation.  If so, we don't want to send the claim.
"RTN","BPSOSAN",7,0)
 ;  Called from GETNEXT^BPSOSAP.
"RTN","BPSOSAN",8,0)
 ;
"RTN","BPSOSAN",9,0)
CANCEL() ;EP - Deal with Cancellations in CLAIMIEN
"RTN","BPSOSAN",10,0)
 N RXI,CXL,KEEP S RXI="",(CXL,KEEP)=0
"RTN","BPSOSAN",11,0)
 N OLDSLOT S OLDSLOT=$$GETSLOT^BPSOSL
"RTN","BPSOSAN",12,0)
 F  S RXI=$O(^BPST("AE",CLAIMIEN,RXI)) Q:RXI=""  D
"RTN","BPSOSAN",13,0)
 .I $G(^BPST(RXI,3)) S CXL=CXL+1 Q
"RTN","BPSOSAN",14,0)
 I 'CXL Q 0  ; none being canceled
"RTN","BPSOSAN",15,0)
 ; At least one being canceled
"RTN","BPSOSAN",16,0)
 ; The canceled one gets stamped as finished
"RTN","BPSOSAN",17,0)
 ; The others get sent back to status 30, Waiting for packet build
"RTN","BPSOSAN",18,0)
 S RXI="" F  S RXI=$O(^BPST("AE",CLAIMIEN,RXI)) Q:RXI=""  D
"RTN","BPSOSAN",19,0)
 .N ABSBRXI S ABSBRXI=RXI ; as some called subroutines expect it
"RTN","BPSOSAN",20,0)
 .D SETSLOT^BPSOSL(ABSBRXI)
"RTN","BPSOSAN",21,0)
 .I $G(^BPST(RXI,3)) D
"RTN","BPSOSAN",22,0)
 ..D DOCANCEL(RXI) ; cancel this claim
"RTN","BPSOSAN",23,0)
 .E  D  ; send this claim back to status 30
"RTN","BPSOSAN",24,0)
 ..S KEEP=KEEP+1
"RTN","BPSOSAN",25,0)
 ..D SETSTAT^BPSOSU(30)
"RTN","BPSOSAN",26,0)
 ..D LOG(CXL_" claim"_$S(CXL>1:"s",1:"")_" in the transmit packet were canceled; this claim was requeued.")
"RTN","BPSOSAN",27,0)
 ; Finally, rev up a packeter to make sure that any surviving claims
"RTN","BPSOSAN",28,0)
 ; get another chance
"RTN","BPSOSAN",29,0)
 I KEEP D PACKETER^BPSOSQ1 ; ensure surviving claims get repacketed
"RTN","BPSOSAN",30,0)
 D SETSLOT^BPSOSL(OLDSLOT)
"RTN","BPSOSAN",31,0)
 Q CXL
"RTN","BPSOSAN",32,0)
 ;
"RTN","BPSOSAN",33,0)
 ;
"RTN","BPSOSAN",34,0)
DOCANCEL(IEN59) ; actually do the cancellation
"RTN","BPSOSAN",35,0)
 ; This may be called from other places.
"RTN","BPSOSAN",36,0)
 N BYDUZ S BYDUZ=$P(^BPST(IEN59,3),U)
"RTN","BPSOSAN",37,0)
 N MSG S MSG=RXI_" CANCELED by "_DUZ_" "_$$GET1^DIQ(200,BYDUZ,.01)
"RTN","BPSOSAN",38,0)
 N OLDSLOT S OLDSLOT=$$GETSLOT^BPSOSL
"RTN","BPSOSAN",39,0)
 D SETSLOT^BPSOSL(IEN59)
"RTN","BPSOSAN",40,0)
 D LOG(MSG)
"RTN","BPSOSAN",41,0)
 D RELSLOT^BPSOSL
"RTN","BPSOSAN",42,0)
 I OLDSLOT D SETSLOT^BPSOSL(OLDSLOT)
"RTN","BPSOSAN",43,0)
 ; In field 302, put the status of the claim at the time it was canceled
"RTN","BPSOSAN",44,0)
 ; Test:  I field 302 ]"", then the claim was successfully canceled.
"RTN","BPSOSAN",45,0)
 S $P(^BPST(IEN59,3),U,2)=$P(^BPST(IEN59,0),U,2)
"RTN","BPSOSAN",46,0)
 D SETSTAT^BPSOSU(99)
"RTN","BPSOSAN",47,0)
 D SETRESU^BPSOSU(-1,MSG)
"RTN","BPSOSAN",48,0)
 Q
"RTN","BPSOSAN",49,0)
LOG(X) D LOG^BPSOSL($T(+0)_" - "_X) Q
"RTN","BPSOSAO")
0^105^B4139675
"RTN","BPSOSAO",1,0)
BPSOSAO ;BHAM ISC/FCS/DRS/FLS - wait for the host to initiate communications ;06/01/2004
"RTN","BPSOSAO",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAO",3,0)
 Q
"RTN","BPSOSAO",4,0)
 ;
"RTN","BPSOSAO",5,0)
 ; Future: extra parameter to WAITCHAR to tell it "no big deal if
"RTN","BPSOSAO",6,0)
 ; the character doesn't come in" - it looks like an error message
"RTN","BPSOSAO",7,0)
 ; when you don't get the ACK after the ENQ but then again, it's
"RTN","BPSOSAO",8,0)
 ; rare.
"RTN","BPSOSAO",9,0)
 ;
"RTN","BPSOSAO",10,0)
 ; 
"RTN","BPSOSAO",11,0)
INITIATE() ;EP - wait for the host to initiate communications
"RTN","BPSOSAO",12,0)
 ; usually, this is an ENQ
"RTN","BPSOSAO",13,0)
 ; sometimes, it may be ACK/ENQ or ENQ/ACK (Envoy 4.1 page 6)
"RTN","BPSOSAO",14,0)
 ; Returns 0 if success, error code if failure
"RTN","BPSOSAO",15,0)
 ; Error code 30101 - disconnected
"RTN","BPSOSAO",16,0)
 ;    This probably means that the host system only gives us one
"RTN","BPSOSAO",17,0)
 ;    transaction per phone call, and we were hoping for an ENQ to
"RTN","BPSOSAO",18,0)
 ;    let us send a second transaction, but the host sent EOT instead.
"RTN","BPSOSAO",19,0)
 ; Error code 30102 - nothing received and we hung up
"RTN","BPSOSAO",20,0)
 ;
"RTN","BPSOSAO",21,0)
 D LOG("1 - Waiting for host to initiate with ENQ")
"RTN","BPSOSAO",22,0)
 N CH S CH=$$WAITCHAR^BPSOSAM(ENQ_ACK,30)
"RTN","BPSOSAO",23,0)
 N RET,OK ; variable OK can probably be gotten rid of
"RTN","BPSOSAO",24,0)
 I CH="ENQ" D
"RTN","BPSOSAO",25,0)
 . ; the usual case is ENQ, not ENQ ACK, right?  so only give 1 sec.
"RTN","BPSOSAO",26,0)
 . S CH=$$WAITCHAR^BPSOSAM(ACK,1)
"RTN","BPSOSAO",27,0)
 . I CH="ACK" D  S OK=1
"RTN","BPSOSAO",28,0)
 . . D LOG("1 - Host sent ENQ ACK to initiate")
"RTN","BPSOSAO",29,0)
 . . S RET=0
"RTN","BPSOSAO",30,0)
 . E  I CH="" D  S OK=1
"RTN","BPSOSAO",31,0)
 . . D LOG("1 - Host sent ENQ to initiate")
"RTN","BPSOSAO",32,0)
 . . S RET=0
"RTN","BPSOSAO",33,0)
 E  I CH="ACK" D
"RTN","BPSOSAO",34,0)
 . S CH=$$WAITCHAR^BPSOSAM(ENQ,30)
"RTN","BPSOSAO",35,0)
 . I CH="ENQ" D  S OK=1
"RTN","BPSOSAO",36,0)
 . . D LOG("1 - Host sent ACK ENQ to initiate")
"RTN","BPSOSAO",37,0)
 . . S RET=0
"RTN","BPSOSAO",38,0)
 . E  D  ; leave RET undef and CH = retval from WAITCHAR
"RTN","BPSOSAO",39,0)
 . . D LOG("1 - Received ACK but not expected ENQ")
"RTN","BPSOSAO",40,0)
 I '$D(RET) D  ; if RET not set, then something went wrong
"RTN","BPSOSAO",41,0)
 . D LOG("1 - Last WAITCHAR returned "_CH)
"RTN","BPSOSAO",42,0)
 . I CH="+++" S RET=30101 ; modem disconnected
"RTN","BPSOSAO",43,0)
 . E  S RET=30102 D HANGUP ; nothing received
"RTN","BPSOSAO",44,0)
 I RET D LOG("1 - Unsuccessful attempt to initiate - "_RET)
"RTN","BPSOSAO",45,0)
 Q RET
"RTN","BPSOSAO",46,0)
LOG(X) D LOG^BPSOSL($T(+0)_" - "_X) Q
"RTN","BPSOSAO",47,0)
HANGUP D HANGUP^BPSOSAB(DIALOUT) Q
"RTN","BPSOSAP")
0^106^B5202759
"RTN","BPSOSAP",1,0)
BPSOSAP ;BHAM ISC/FCS/DRS/FLS/DLF - GETNEXT, PUTBACK ;06/01/2004
"RTN","BPSOSAP",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAP",3,0)
 Q
"RTN","BPSOSAP",4,0)
 ;
"RTN","BPSOSAP",5,0)
 ;  GETNEXT, PUTBACK - manage the list of packets to be sent
"RTN","BPSOSAP",6,0)
 ;    for this DIALOUT.
"RTN","BPSOSAP",7,0)
LLIST() ; EP - from BPSOSC4
"RTN","BPSOSAP",8,0)
 L +^BPSECX("POS",DIALOUT,"C"):300 Q:$T 1
"RTN","BPSOSAP",9,0)
 D LOG("Unable to get exclusive access to the list of claims for DIALOUT="_DIALOUT)
"RTN","BPSOSAP",10,0)
 D TASK^BPSOSQ2
"RTN","BPSOSAP",11,0)
 Q 0
"RTN","BPSOSAP",12,0)
ULLIST ; EP - from BPSOSC4
"RTN","BPSOSAP",13,0)
 L -^BPSECX("POS",DIALOUT,"C") Q
"RTN","BPSOSAP",14,0)
 ;
"RTN","BPSOSAP",15,0)
 ; Routines to get and unget messages
"RTN","BPSOSAP",16,0)
 ; Given DIALOUT
"RTN","BPSOSAP",17,0)
 ; optional parameter N says "first message after #N"
"RTN","BPSOSAP",18,0)
 ; Sets SENDMSG = the big string and kills message out of the global
"RTN","BPSOSAP",19,0)
 ;      SENDMSGP(n)=the message in segments as copied from global
"RTN","BPSOSAP",20,0)
 ;      CLAIMIEN=the message number
"RTN","BPSOSAP",21,0)
 ;           (this is for convenient restoring in case of comms error)
"RTN","BPSOSAP",22,0)
 ; Returns message number
"RTN","BPSOSAP",23,0)
 ; If no message ready to send, returns FALSE and $D(SENDMSG)=0
"RTN","BPSOSAP",24,0)
 ;   and $D(CLAIMIEN)=0
"RTN","BPSOSAP",25,0)
 ;
"RTN","BPSOSAP",26,0)
GETNEXT(N) ;EP -
"RTN","BPSOSAP",27,0)
 ; (any NEW commands go here)
"RTN","BPSOSAP",28,0)
GETNEXT1 ;
"RTN","BPSOSAP",29,0)
 I '$$LLIST S CLAIMIEN="" Q  ; lock the list for this DIALOUT
"RTN","BPSOSAP",30,0)
 I '$G(N) S N=0
"RTN","BPSOSAP",31,0)
 K SENDMSG,SENDMSGP,CLAIMIEN
"RTN","BPSOSAP",32,0)
 S N=$O(^BPSECX("POS",DIALOUT,"C",0))
"RTN","BPSOSAP",33,0)
 I N D
"RTN","BPSOSAP",34,0)
 . M SENDMSGP=^BPSECX("POS",DIALOUT,"C",N) ; SENDMSG(*) = message
"RTN","BPSOSAP",35,0)
 . ; Note: BPSOSC4 also does a KILL of the claim packet
"RTN","BPSOSAP",36,0)
 . K ^BPSECX("POS",DIALOUT,"C",N)
"RTN","BPSOSAP",37,0)
 . S SENDMSG=""
"RTN","BPSOSAP",38,0)
 . I 'VARX N I F I=1:1:SENDMSGP(0) S SENDMSG=SENDMSG_SENDMSGP(I)
"RTN","BPSOSAP",39,0)
 . S CLAIMIEN=N
"RTN","BPSOSAP",40,0)
 E  S CLAIMIEN=""
"RTN","BPSOSAP",41,0)
 D ULLIST ; unlock the list
"RTN","BPSOSAP",42,0)
 ;
"RTN","BPSOSAP",43,0)
 ;  If we got a claim packet to be sent, check to see if any of the
"RTN","BPSOSAP",44,0)
 ;  claims therein are marked for cancellation.  If so, then handle
"RTN","BPSOSAP",45,0)
 ;  the cancellation, which involves NOT sending this packet.
"RTN","BPSOSAP",46,0)
 ;  Then loop back and see if you can get another one, instead.
"RTN","BPSOSAP",47,0)
 I N,$$CANCEL^BPSOSAN G GETNEXT1
"RTN","BPSOSAP",48,0)
 Q N
"RTN","BPSOSAP",49,0)
PUTBACK ;EP - puts message back, with given CLAIMIEN
"RTN","BPSOSAP",50,0)
 F  Q:$$LLIST  Q:'$$IMPOSS^BPSOSUE("L,P","RIT","Lock list to put back message","DIALOUT="_DIALOUT,"PUTBACK",$T(+0))
"RTN","BPSOSAP",51,0)
 I $D(^BPSECX("POS",DIALOUT,"C",CLAIMIEN)) D  G PB9 ; should never happen
"RTN","BPSOSAP",52,0)
 . N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("P,DB","TRI","Old slot is now occupied again?!",,"PUTBACK",$T(+0))
"RTN","BPSOSAP",53,0)
 M ^BPSECX("POS",DIALOUT,"C",CLAIMIEN)=SENDMSGP
"RTN","BPSOSAP",54,0)
PB9 D ULLIST ; unlock the list
"RTN","BPSOSAP",55,0)
 Q
"RTN","BPSOSAP",56,0)
LOG(X) D LOG^BPSOSL($T(+0)_" - "_X) Q
"RTN","BPSOSAQ")
0^107^B1132981
"RTN","BPSOSAQ",1,0)
BPSOSAQ ;BHAM ISC/FCS/DRS/FLS - CONNECT ;06/01/2004
"RTN","BPSOSAQ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAQ",3,0)
 Q
"RTN","BPSOSAQ",4,0)
 ;
"RTN","BPSOSAQ",5,0)
 ;  CONNECT - subroutine of BPSOSAM
"RTN","BPSOSAQ",6,0)
 ;
"RTN","BPSOSAQ",7,0)
CONNECT(DIALOUT) ;EP - connect to DIALOUT = pointer to 9002313.55
"RTN","BPSOSAQ",8,0)
 ; Returns 0 if success, nonzero error code if failure
"RTN","BPSOSAQ",9,0)
 ; Future:  we want this to be able to try multiple devices
"RTN","BPSOSAQ",10,0)
 ; Today, it's one device per destination
"RTN","BPSOSAQ",11,0)
 ; Future: (Intermediate term) a utility to switch the device
"RTN","BPSOSAQ",12,0)
 N ECODE S ECODE=$$CONNECT^BPSOSAA(DIALOUT) I 'ECODE Q 0
"RTN","BPSOSAQ",13,0)
 N X S X=$T(+0)_" - Error "_ECODE_" returned from $$CONNECT^BPSOSAA"
"RTN","BPSOSAQ",14,0)
 D LOG^BPSOSL(X)
"RTN","BPSOSAQ",15,0)
 I +ECODE'=20999 D  ; if OPEN succeeded, hangup phone and close device
"RTN","BPSOSAQ",16,0)
 . D HANGUP^BPSOSAB(DIALOUT)
"RTN","BPSOSAQ",17,0)
 . N RETVAL S RETVAL=$$CLOSE^BPSOSAB(DIALOUT)
"RTN","BPSOSAQ",18,0)
 S ^BPS(9002313.55,DIALOUT,"ERROR")=$$NOW_U_ECODE
"RTN","BPSOSAQ",19,0)
 Q ECODE
"RTN","BPSOSAQ",20,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSAR")
0^108^B19152233
"RTN","BPSOSAR",1,0)
BPSOSAR ;BHAM ISC/FCS/DRS/FLS - low-level Receive response ;06/01/2004
"RTN","BPSOSAR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAR",3,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSAR",4,0)
 ;Gather message from host until ETX, EOT control characters have been
"RTN","BPSOSAR",5,0)
 ;received or timeout has occurred
"RTN","BPSOSAR",6,0)
 ;
"RTN","BPSOSAR",7,0)
 ;Parameters:  DIALOUT
"RTN","BPSOSAR",8,0)
 ;             .RESPMSG - Message text gathered from modem
"RTN","BPSOSAR",9,0)
 ;             .RESPLRC - Longitudinal redundancy checker character
"RTN","BPSOSAR",10,0)
 ;             TIMEOUT  - Number of seconds before process terminates
"RTN","BPSOSAR",11,0)
 ;
"RTN","BPSOSAR",12,0)
 ;Returns:     "EOT"      - an EOT was received from the host
"RTN","BPSOSAR",13,0)
 ;             ""         - process timed out 
"RTN","BPSOSAR",14,0)
 ;             "ETX"      - ETX received; we have a message & LRC
"RTN","BPSOSAR",15,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSAR",16,0)
 Q
"RTN","BPSOSAR",17,0)
GETMSG(DIALOUT,RESPMSG,RESPLRC,TIMEOUT) ;EP - from BPSOSAM
"RTN","BPSOSAR",18,0)
 ;
"RTN","BPSOSAR",19,0)
 ;     Since we cannot USE:(parameters) to set the READ terminator,
"RTN","BPSOSAR",20,0)
 ;     we must read one character at a time and check for STX,ETX,EOT
"RTN","BPSOSAR",21,0)
 ; 
"RTN","BPSOSAR",22,0)
 ;FIXED128 = how many times we had to clear unwanted high bit
"RTN","BPSOSAR",23,0)
 ;ZB mimics a terminal device's $ZB, the READ terminator
"RTN","BPSOSAR",24,0)
 N IO S IO=$$IO^BPSOSA(DIALOUT) U IO
"RTN","BPSOSAR",25,0)
 D LOG^BPSOSL($T(+0)_" - RESP - Begin gathering host system's response",$G(ECHO))
"RTN","BPSOSAR",26,0)
1 N FIXED128,MAXMSG,ZA,ZB,I,X,T1LENGTH,T1LINE
"RTN","BPSOSAR",27,0)
 S FIXED128=0,MAXMSG=2048
"RTN","BPSOSAR",28,0)
 S T1LINE=$$T1DIRECT^BPSOSA(DIALOUT) ; true if this is a T1 connection
"RTN","BPSOSAR",29,0)
 ;
"RTN","BPSOSAR",30,0)
START S (RESPMSG,RESPLRC,RET)="",(T1LENGTH,ZB)=0
"RTN","BPSOSAR",31,0)
 S X="GETZE^"_$T(+0),@^%ZOSF("TRAP")
"RTN","BPSOSAR",32,0)
 F I=1:1:MAXMSG D  Q:ZB  ; loop to read characters
"RTN","BPSOSAR",33,0)
4 . ;
"RTN","BPSOSAR",34,0)
 . I '$T S ZB=-1 D  ; timed out; retry for up to TIMEOUT secs more
"RTN","BPSOSAR",35,0)
 . . ;
"RTN","BPSOSAR",36,0)
 . I ZB D  S RET="+++" Q  ; Timed out, retried, still couldn't get more
"RTN","BPSOSAR",37,0)
 . . D LOG^BPSOSL($T(+0)_" - RESP - Timed out after "_$L(RESPMSG)_" characters",$G(ECHO))
"RTN","BPSOSAR",38,0)
 . I X<1 Q  ; Something's wrong: got a character but it's 0 or negative
"RTN","BPSOSAR",39,0)
5 . I X>127 S X=X-128,FIXED128=FIXED128+1 ; clear unwanted high bit
"RTN","BPSOSAR",40,0)
 . ;
"RTN","BPSOSAR",41,0)
 . ; Did not time out; process the character
"RTN","BPSOSAR",42,0)
 . ;
"RTN","BPSOSAR",43,0)
 . S X=$C(X)
"RTN","BPSOSAR",44,0)
 . ;
"RTN","BPSOSAR",45,0)
 . ; If it's a T1 connection, first four bytes are the length
"RTN","BPSOSAR",46,0)
 . ; But if a length contains a nonnumeric byte, you have an error.
"RTN","BPSOSAR",47,0)
 . ;
"RTN","BPSOSAR",48,0)
 . I T1LINE,I<5 D  Q:X?1N
"RTN","BPSOSAR",49,0)
 . . I X'?1N D  S X=EOT
"RTN","BPSOSAR",50,0)
 . . . D LOG^BPSOSL($T(+0)_" - RESP - Character #"_I_" of length prefix was nonnumeric $C("_$A(X)_")")
"RTN","BPSOSAR",51,0)
 . . S T1LENGTH=T1LENGTH*10+$A(X)-$A("0")
"RTN","BPSOSAR",52,0)
 . ; 
"RTN","BPSOSAR",53,0)
 . ; Handle special control characters for modem connections:
"RTN","BPSOSAR",54,0)
 . ;
"RTN","BPSOSAR",55,0)
 . I 'T1LINE,X=STX!(X=ETX)!(X=EOT) D  Q  ; a terminator was received
"RTN","BPSOSAR",56,0)
 . . S ZB=$A(X) ; remember what terminated the READ
"RTN","BPSOSAR",57,0)
 . . I X=ETX D  ; (and this terminator is our favorite one)
"RTN","BPSOSAR",58,0)
7 . . . S RESPMSG=RESPMSG_X
"RTN","BPSOSAR",59,0)
 . . . S RESPLRC=$$GETCH(5) ; got the RESPMSG,now get the LRC
"RTN","BPSOSAR",60,0)
 . . . I RESPLRC="" D  S ZB=-1 ; reset ZB to indicate timeout in GETLRC()
"RTN","BPSOSAR",61,0)
 . . . . D LOG^BPSOSL($T(+0)_" - RESP - Timed out - got "_$L(RESPMSG)_" characters but not LRC character",$G(ECHO))
"RTN","BPSOSAR",62,0)
8 . S RESPMSG=RESPMSG_X
"RTN","BPSOSAR",63,0)
 . ;
"RTN","BPSOSAR",64,0)
 . ; If T1 line and you've got the entire message gathered,
"RTN","BPSOSAR",65,0)
 . ; then fake out an ETX.  This will cause the outer loop to stop.
"RTN","BPSOSAR",66,0)
 . ; 
"RTN","BPSOSAR",67,0)
 . I T1LINE,I=(T1LENGTH+4) S ZB=$A(ETX),RESPLRC=0
"RTN","BPSOSAR",68,0)
 ;
"RTN","BPSOSAR",69,0)
 ; The READ loop is done - now act on the results
"RTN","BPSOSAR",70,0)
 ;
"RTN","BPSOSAR",71,0)
 I FIXED128 D LOG^BPSOSL($T(+0)_" - RESP - Had to clear high bit "_FIXED128_" times",$G(ECHO))
"RTN","BPSOSAR",72,0)
 I ZB=$A(EOT) D  Q "EOT" ; EOT received from host
"RTN","BPSOSAR",73,0)
 .D LOG^BPSOSL($T(+0)_" - RESP - received EOT",$G(ECHO))
"RTN","BPSOSAR",74,0)
 I ZB=$A(STX) D  G START ; 03/08/2000
"RTN","BPSOSAR",75,0)
 . D LOG^BPSOSL($T(+0)_" - RESP - received STX, read again",$G(ECHO))
"RTN","BPSOSAR",76,0)
 I ZB=-1 D  Q "" ; timed out
"RTN","BPSOSAR",77,0)
 .D LOG^BPSOSL($T(+0)_" - RESP - timed out",$G(ECHO))
"RTN","BPSOSAR",78,0)
 I ZB=0 D  Q "" ; must have gotten to MAXMSG !?
"RTN","BPSOSAR",79,0)
 .D LOG^BPSOSL($T(+0)_" - RESP - got to MAXMSG characters",$G(ECHO))
"RTN","BPSOSAR",80,0)
 I ZB'=$A(ETX) D  Q ""  ;ZT  ; must be ETX, then, right?
"RTN","BPSOSAR",81,0)
 .D LOG^BPSOSL($T(+0)_" - RESP - unexpected ZB = "_ZB_" (should have gotten ETX)",$G(ECHO))
"RTN","BPSOSAR",82,0)
 . D IMPOSS^BPSOSUE("P","TRI","ZB="_ZB,,"GETMSG",$T(+0))
"RTN","BPSOSAR",83,0)
 D LOG^BPSOSL($T(+0)_" - RESP - Received "_$L(RESPMSG)_" characters",$G(ECHO))
"RTN","BPSOSAR",84,0)
9999999 Q "ETX"
"RTN","BPSOSAR",85,0)
 ;
"RTN","BPSOSAR",86,0)
 ; GETCH(timeout)  - read one character
"RTN","BPSOSAR",87,0)
 ;    Returns the character obtained, if any.
"RTN","BPSOSAR",88,0)
 ;    Returns "" if it timed out.
"RTN","BPSOSAR",89,0)
GETCH(TO)         ; read one character, timeout TO ; returns "" if timed out
"RTN","BPSOSAR",90,0)
 ;
"RTN","BPSOSAR",91,0)
 ;   If a character is ready immediately, grab it and get out.
"RTN","BPSOSAR",92,0)
 ;
"RTN","BPSOSAR",93,0)
 ;
"RTN","BPSOSAR",94,0)
 ;
"RTN","BPSOSAR",95,0)
 ;   Otherwise, loop and keep trying; maybe timeout.
"RTN","BPSOSAR",96,0)
 ;
"RTN","BPSOSAR",97,0)
 ;
"RTN","BPSOSAR",98,0)
 Q RET
"RTN","BPSOSAR",99,0)
 ;
"RTN","BPSOSAR",100,0)
GETZE D LOGZE("GETMSG") Q ""
"RTN","BPSOSAR",101,0)
LOGZE(WHERE) D LOG^BPSOSL($T(+0)_" - MODEM - "_WHERE_" - $ZE="_$$ZE^BPSOS) Q
"RTN","BPSOSAS")
0^109^B3457641
"RTN","BPSOSAS",1,0)
BPSOSAS ;BHAM ISC/FCS/DRS/FLS - Low-level SEND claim ;06/01/2004
"RTN","BPSOSAS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAS",3,0)
 Q
"RTN","BPSOSAS",4,0)
 ;
"RTN","BPSOSAS",5,0)
 ;  Modem - low-level message send
"RTN","BPSOSAS",6,0)
 ;  SENDREQ is main
"RTN","BPSOSAS",7,0)
 ;
"RTN","BPSOSAS",8,0)
 ;IHS/SD/lwj  6/7/02  need to add a line feed when the system is 
"RTN","BPSOSAS",9,0)
 ; Cache.
"RTN","BPSOSAS",10,0)
 ;
"RTN","BPSOSAS",11,0)
 ;IHS/SD/lwj  8/19/02 we were getting "invalid version" and 
"RTN","BPSOSAS",12,0)
 ;"corrupted" response messages after the switch to Cache and
"RTN","BPSOSAS",13,0)
 ; only at the Cache sites.  From the research, it appeared that
"RTN","BPSOSAS",14,0)
 ; the buffer was not being cleared all the way.  David Slauenwhite,
"RTN","BPSOSAS",15,0)
 ; Hoarce Whitt, and Intersystems, determined that rather than a
"RTN","BPSOSAS",16,0)
 ; "!" (cr/lf) we needed to W *-3 after each send.  The code
"RTN","BPSOSAS",17,0)
 ; has been changed, and it appears has solved the problems.
"RTN","BPSOSAS",18,0)
 ;
"RTN","BPSOSAS",19,0)
 ;
"RTN","BPSOSAS",20,0)
SENDREQ(DIALOUT,MSG) ;EP -
"RTN","BPSOSAS",21,0)
 ; (Don't modify MSG; caller may have called with .MSG)
"RTN","BPSOSAS",22,0)
 N IO S IO=$$IO^BPSOSA(DIALOUT) U IO
"RTN","BPSOSAS",23,0)
 I $$T1DIRECT^BPSOSA(DIALOUT) D
"RTN","BPSOSAS",24,0)
 . D LOG^BPSOSL($T(+0)_" - T1 LINE - SEND - "_$L(MSG)_"+4 characters")
"RTN","BPSOSAS",25,0)
 . W $TR($J($L(MSG),4)," ","0"),MSG ; write message length, then msg
"RTN","BPSOSAS",26,0)
 . I ^%ZOSF("OS")["OpenM" W *-3  ;IHS/SD/lwj  8/19/02 for Cache
"RTN","BPSOSAS",27,0)
 . D LOG^BPSOSL($T(+0)_" - T1 LINE - SEND - "_$L(MSG)_"+4 characters")
"RTN","BPSOSAS",28,0)
 E  D
"RTN","BPSOSAS",29,0)
 . N STX,ETX S STX=$C(2),ETX=$C(3)
"RTN","BPSOSAS",30,0)
 . N X S X="SENDZE^"_$T(+0),@^%ZOSF("TRAP")
"RTN","BPSOSAS",31,0)
 . W STX,MSG,ETX,$$LRC^BPSOSAD(MSG_ETX)
"RTN","BPSOSAS",32,0)
 . D LOG^BPSOSL($T(+0)_" - MODEM - SEND - "_$L(MSG)_"+3 characters")
"RTN","BPSOSAS",33,0)
 ; SAVECOPY - uncomment for development debugging
"RTN","BPSOSAS",34,0)
 Q 0
"RTN","BPSOSAS",35,0)
SENDZE D LOGZE("SENDREQ") Q
"RTN","BPSOSAS",36,0)
SENDCHAR(DIALOUT,CHAR)  N IO S IO=$$IO^BPSOSA(DIALOUT) U IO W CHAR Q
"RTN","BPSOSAS",37,0)
SENDACK(DIALOUT) ;EP -
"RTN","BPSOSAS",38,0)
 D SENDCHAR(DIALOUT,$C(6)) Q
"RTN","BPSOSAS",39,0)
SENDNAK(DIALOUT) ;EP -
"RTN","BPSOSAS",40,0)
 D SENDCHAR(DIALOUT,$C(21)) Q
"RTN","BPSOSAS",41,0)
SENDEOT(DIALOUT)   D SENDCHAR(DIALOUT,$C(4)) Q
"RTN","BPSOSAS",42,0)
SENDETB(DIALOUT) ;EP -
"RTN","BPSOSAS",43,0)
 D SENDCHAR(DIALOUT,$C(23)) Q
"RTN","BPSOSAS",44,0)
LOGZE(WHERE) D LOG^BPSOSL($T(+0)_" - MODEM - "_WHERE_" - $ZE="_$$ZE^BPSOS) Q
"RTN","BPSOSAW")
0^110^B17835501
"RTN","BPSOSAW",1,0)
BPSOSAW ;BHAM ISC/FCS/DRS/FLS - Modem - wait for char,str ;06/01/2004
"RTN","BPSOSAW",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAW",3,0)
 Q
"RTN","BPSOSAW",4,0)
 ;
"RTN","BPSOSAW",5,0)
 ; Utilities for waiting for certain characters or strings
"RTN","BPSOSAW",6,0)
 ;  Beware, WAITOK, WAITSTR have different return values!
"RTN","BPSOSAW",7,0)
 ;  WAITOK(DIALOUT,TIMEOUT)
"RTN","BPSOSAW",8,0)
 ;  WAITSTR(DIALOUT,STRING,TIMEOUT)
"RTN","BPSOSAW",9,0)
 ;  WAITCHAR(DIALOUT,CHAR,TIMEOUT)
"RTN","BPSOSAW",10,0)
 ;  WAIT1(STRING,TIMEOUT) ; on current device
"RTN","BPSOSAW",11,0)
 ;  WAIT2(CHARSTRING,TIMEOUT) ; on current device
"RTN","BPSOSAW",12,0)
 ;  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
"RTN","BPSOSAW",13,0)
 ;
"RTN","BPSOSAW",14,0)
 ;
"RTN","BPSOSAW",15,0)
 ; WAITOK(DIALOUT,TIMEOUT)
"RTN","BPSOSAW",16,0)
 ;     Wait for the "OK" response to a modem command
"RTN","BPSOSAW",17,0)
 ;     Returns true if received, false if timed out.
"RTN","BPSOSAW",18,0)
 ;
"RTN","BPSOSAW",19,0)
WAITOK(DIALOUT,TIMEOUT)       ;  returns 1 if you got "OK", 0 if you didn't,
"RTN","BPSOSAW",20,0)
 N IO S IO=$$IO^BPSOSA(DIALOUT)
"RTN","BPSOSAW",21,0)
 N RETVAL
"RTN","BPSOSAW",22,0)
 I $$WAITSTR(DIALOUT,"OK",$S($G(TIMEOUT):TIMEOUT,1:20)) D  S RETVAL=1
"RTN","BPSOSAW",23,0)
 .D LOG^BPSOSL($T(+0)_" - MODEM - WAITOK - Success",$G(ECHO))
"RTN","BPSOSAW",24,0)
 E  D  S RETVAL=0
"RTN","BPSOSAW",25,0)
 .D LOG^BPSOSL($T(+0)_" - MODEM - WAITOK - Failure",$G(ECHO))
"RTN","BPSOSAW",26,0)
 Q RETVAL
"RTN","BPSOSAW",27,0)
 ;
"RTN","BPSOSAW",28,0)
 ;
"RTN","BPSOSAW",29,0)
 ; WAITSTR(DIALOUT,STRING,TIMEOUT)
"RTN","BPSOSAW",30,0)
 ;      Wait for some expected string.
"RTN","BPSOSAW",31,0)
 ;      TIMEOUT defaults to 60 seconds.
"RTN","BPSOSAW",32,0)
 ;      Returns 0 if string was received, success
"RTN","BPSOSAW",33,0)
 ;      Returns -1 if NOT received, failure.
"RTN","BPSOSAW",34,0)
 ;
"RTN","BPSOSAW",35,0)
WAITSTR(DIALOUT,STR,TIMEOUT) ;EP - wait for a given string
"RTN","BPSOSAW",36,0)
 ; returns 0 if okay, nonzero if not received
"RTN","BPSOSAW",37,0)
 N IO,RETVAL S IO=$$IO^BPSOSA(DIALOUT) U IO
"RTN","BPSOSAW",38,0)
 D LOG^BPSOSL($T(+0)_" - MODEM - Waiting for string "_STR,$G(ECHO))
"RTN","BPSOSAW",39,0)
 N RET S RET=$$WAIT1(STR,$S($G(TIMEOUT):TIMEOUT,1:60))
"RTN","BPSOSAW",40,0)
 N X S X=$T(+0)_" - MODEM - WAITSTR - "
"RTN","BPSOSAW",41,0)
 I RET D  S RETVAL=0
"RTN","BPSOSAW",42,0)
 . S X=X_"Received expected "_STR
"RTN","BPSOSAW",43,0)
 . D LOG^BPSOSL(X,$G(ECHO))
"RTN","BPSOSAW",44,0)
 E  D  S RETVAL=-1
"RTN","BPSOSAW",45,0)
 . S X=X_"Did NOT receive expected "_STR
"RTN","BPSOSAW",46,0)
 . N RECD S RECD=$P(RET,U,2,$L(RET,U))
"RTN","BPSOSAW",47,0)
 . I RECD="" S X=X_" - Received nothing"
"RTN","BPSOSAW",48,0)
 . D LOG^BPSOSL(X,$G(ECHO))
"RTN","BPSOSAW",49,0)
 . I RECD]"" D
"RTN","BPSOSAW",50,0)
 . . N I F I=$L(RECD):-1:1 Q:$L(RECD)>250  D
"RTN","BPSOSAW",51,0)
 . . . I $E(RECD,I)?1C D
"RTN","BPSOSAW",52,0)
 . . . . S RECD=$E(RECD,1,I-1)_"\"_$A(RECD,I)_"\"_$E(RECD,I+1,$L(RECD))
"RTN","BPSOSAW",53,0)
 . . S X=$T(+0)_" - MODEM - WAITSTR - Received instead: "_RECD
"RTN","BPSOSAW",54,0)
 . . D LOG^BPSOSL(X,$G(ECHO))
"RTN","BPSOSAW",55,0)
 Q RETVAL
"RTN","BPSOSAW",56,0)
 ;
"RTN","BPSOSAW",57,0)
 ;  WAIT1(STRING,TIMEOUT,MAXCHAR)
"RTN","BPSOSAW",58,0)
 ;     Wait for the given string.
"RTN","BPSOSAW",59,0)
 ;     Returns true for success, false for failure.
"RTN","BPSOSAW",60,0)
 ;     Returns 0^$ZE if error happened (most likely disconnect).
"RTN","BPSOSAW",61,0)
 ;     (Note!  Different return value types than WAITSTR has!)
"RTN","BPSOSAW",62,0)
 ;
"RTN","BPSOSAW",63,0)
 ;  To protect against terminal server overflowing with $C(0),
"RTN","BPSOSAW",64,0)
 ;  we impose MAXCHAR, default 3000 characters
"RTN","BPSOSAW",65,0)
 ;
"RTN","BPSOSAW",66,0)
WAIT1(WAITTXT,TIMEOUT,MAXCHAR) ;
"RTN","BPSOSAW",67,0)
 ;returns 1 for success 0 for failure (diff. from WAITSTR)
"RTN","BPSOSAW",68,0)
 ; Appended to the return value:  "^" and the message it received
"RTN","BPSOSAW",69,0)
 N START,END,FLAG,CHAR,MSG,TIMEOUTA,X,NCHAR
"RTN","BPSOSAW",70,0)
 I '$D(MAXCHAR) S MAXCHAR=3000
"RTN","BPSOSAW",71,0)
 S TIMEOUTA=0 ; counts up to TIMEOUT and then you've got a real timeout
"RTN","BPSOSAW",72,0)
 ;Read input buffer until WAITTXT has been received or timeout
"RTN","BPSOSAW",73,0)
 S (FLAG,MSG)=""
"RTN","BPSOSAW",74,0)
 S X="W1ZE^"_$T(+0),@^%ZOSF("TRAP")
"RTN","BPSOSAW",75,0)
 F NCHAR=1:1:MAXCHAR D  Q:TIMEOUTA'<TIMEOUT!(FLAG'="")
"RTN","BPSOSAW",76,0)
 .S CHAR=""
"RTN","BPSOSAW",77,0)
 .;
"RTN","BPSOSAW",78,0)
 .S:CHAR>127 CHAR=CHAR-128 ; 7-Bit communications
"RTN","BPSOSAW",79,0)
 .S:$L(MSG)=255 MSG=$E(MSG,1,254)
"RTN","BPSOSAW",80,0)
 .S MSG=MSG_$C(CHAR)
"RTN","BPSOSAW",81,0)
 .S FLAG=$S(MSG[WAITTXT:1,1:"")
"RTN","BPSOSAW",82,0)
 Q $S(MSG[WAITTXT:1,1:0)_U_MSG
"RTN","BPSOSAW",83,0)
W1ZE D LOGZE("WAIT1") Q 0_U_$$ZE^BPSOS
"RTN","BPSOSAW",84,0)
 ; 
"RTN","BPSOSAW",85,0)
 ; Waiting for a particular control character
"RTN","BPSOSAW",86,0)
WAITCHAR(DIALOUT,CHARS,TIMEOUT) ;EP -
"RTN","BPSOSAW",87,0)
 ; returns 0 if okay, nonzero if not received
"RTN","BPSOSAW",88,0)
 I '$G(TIMEOUT) S TIMEOUT=60
"RTN","BPSOSAW",89,0)
 N IO,RETVAL S IO=$$IO^BPSOSA(DIALOUT) U IO
"RTN","BPSOSAW",90,0)
 N X S X=$T(+0)_" - MODEM - Waiting for"
"RTN","BPSOSAW",91,0)
 I $L(CHARS)>1 S X=X_" any of"
"RTN","BPSOSAW",92,0)
 S X=X_":"
"RTN","BPSOSAW",93,0)
 N I F I=1:1:$L(CHARS) S X=X_" $C("_$A(CHARS,I)_")"
"RTN","BPSOSAW",94,0)
 S X=X_" timeout "_$G(TIMEOUT)
"RTN","BPSOSAW",95,0)
 D LOG^BPSOSL(X,$G(ECHO))
"RTN","BPSOSAW",96,0)
 S RETVAL=$$WAIT2(CHARS,TIMEOUT)
"RTN","BPSOSAW",97,0)
 N X S X=$T(+0)_" - MODEM - WAITCHAR - "
"RTN","BPSOSAW",98,0)
 I RETVAL]"" D
"RTN","BPSOSAW",99,0)
 . S X=X_"Received "_RETVAL
"RTN","BPSOSAW",100,0)
 . D LOG^BPSOSL(X,$G(ECHO))
"RTN","BPSOSAW",101,0)
 . I RETVAL="EOT" D  D HANGUP^BPSOSAB(DIALOUT) S RETVAL="+++"
"RTN","BPSOSAW",102,0)
 . . D LOG^BPSOSL($T(+0)_" - MODEM - Received EOT from host")
"RTN","BPSOSAW",103,0)
 E  D
"RTN","BPSOSAW",104,0)
 . S X=X_"Did NOT receive what was expected."
"RTN","BPSOSAW",105,0)
 . D LOG^BPSOSL(X,$G(ECHO))
"RTN","BPSOSAW",106,0)
 Q RETVAL
"RTN","BPSOSAW",107,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSAW",108,0)
 ;Monitors a port and waits for particular control characters within a
"RTN","BPSOSAW",109,0)
 ;specified time frame
"RTN","BPSOSAW",110,0)
 ;             WCHARS   - String of control characters
"RTN","BPSOSAW",111,0)
 ;             TIMEOUT  - Time frame (in seconds) - at least 1
"RTN","BPSOSAW",112,0)
 ; Returns "STX" or "ETX" or "EOT" or "ENQ" or "ACK" or "NAK" or ""
"RTN","BPSOSAW",113,0)
 ; or it may return "RUNAWAY"
"RTN","BPSOSAW",114,0)
 ;--------------------------------------------------------------------
"RTN","BPSOSAW",115,0)
WAIT2(WCHARS,TIMEOUT) ;
"RTN","BPSOSAW",116,0)
 N I,MAXI,START,END,FLAG,ACH,CCH,EOT,TIMEOUTA,X
"RTN","BPSOSAW",117,0)
 S EOT=$C(4),TIMEOUTA=0
"RTN","BPSOSAW",118,0)
 I WCHARS'[EOT S WCHARS=WCHARS_EOT ; always be on the lookout for EOT
"RTN","BPSOSAW",119,0)
 S FLAG="",MAXI=3000
"RTN","BPSOSAW",120,0)
 S X="W2ZE^"_$T(+0),@^%ZOSF("TRAP")
"RTN","BPSOSAW",121,0)
 F I=1:1:MAXI D  Q:TIMEOUTA'<TIMEOUT!(FLAG'="")
"RTN","BPSOSAW",122,0)
 . S (ACH,CCH)=""
"RTN","BPSOSAW",123,0)
 . S:ACH>127 ACH=ACH-128 Q:'ACH
"RTN","BPSOSAW",124,0)
 . S CCH=$C(ACH)
"RTN","BPSOSAW",125,0)
 . S:WCHARS[CCH FLAG=ACH
"RTN","BPSOSAW",126,0)
 I I=MAXI Q "RUNAWAY" ; runaway byte stream?!
"RTN","BPSOSAW",127,0)
 Q $P(",STX,ETX,EOT,ENQ,ACK,,,,,,,,,,,,,,,NAK",",",FLAG)
"RTN","BPSOSAW",128,0)
W2ZE D LOGZE("WAIT2") Q ""
"RTN","BPSOSAW",129,0)
LOGZE(WHERE) D LOG^BPSOSL($T(+0)_" - MODEM - "_WHERE_" - $ZE="_$$ZE^BPSOS) Q
"RTN","BPSOSAY")
0^111^B4322862
"RTN","BPSOSAY",1,0)
BPSOSAY ;BHAM ISC/FCS/DRS/FLS - Packet print utils ;06/01/2004
"RTN","BPSOSAY",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSAY",3,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSAY",4,0)
 Q
"RTN","BPSOSAY",5,0)
 ;
"RTN","BPSOSAY",6,0)
 ; D DUMPLAST ; look at most recent response and associated claim.
"RTN","BPSOSAY",7,0)
 ;
"RTN","BPSOSAY",8,0)
 ; D DUMPN(pointer to 9002313.02) prints claim and response both
"RTN","BPSOSAY",9,0)
 ;
"RTN","BPSOSAY",10,0)
 ; Development and low-level support utilities
"RTN","BPSOSAY",11,0)
 ; Most useful callable entry points are:
"RTN","BPSOSAY",12,0)
 ;    PRINT02(pointer to 9002313.02)
"RTN","BPSOSAY",13,0)
 ;    PRINT03(pointer to 9002313.03)
"RTN","BPSOSAY",14,0)
 ;    DIAGPRT(string)  to print diagram in pretty formatted form
"RTN","BPSOSAY",15,0)
 ;
"RTN","BPSOSAY",16,0)
 ; 
"RTN","BPSOSAY",17,0)
DUMPLAST ;  Print the most recently-received claim-response pair
"RTN","BPSOSAY",18,0)
 N IEN03 S IEN03=$P(^BPSR(0),U,3)
"RTN","BPSOSAY",19,0)
 N IEN02 S IEN02=$P(^BPSR(IEN03,0),U)
"RTN","BPSOSAY",20,0)
 D PRINT02(IEN02),PRINT03(IEN03)
"RTN","BPSOSAY",21,0)
 Q
"RTN","BPSOSAY",22,0)
 ;
"RTN","BPSOSAY",23,0)
 ;
"RTN","BPSOSAY",24,0)
DUMP(REQ) ; given REQ = ien or ID of request packet, do the whole thing
"RTN","BPSOSAY",25,0)
 I REQ'?1N.N D  Q:REQ=""
"RTN","BPSOSAY",26,0)
 . S REQ=$O(^BPSC("B",REQ,0))
"RTN","BPSOSAY",27,0)
 D PRINT02(REQ)
"RTN","BPSOSAY",28,0)
 N IEN03 S IEN03=$O(^BPSR("B",REQ,""),-1) ; most recent response!
"RTN","BPSOSAY",29,0)
 I IEN03 D PRINT03(IEN03)
"RTN","BPSOSAY",30,0)
 Q
"RTN","BPSOSAY",31,0)
 ;
"RTN","BPSOSAY",32,0)
 ; Useful entry points now that we retain raw packet in 9002313.02,.03
"RTN","BPSOSAY",33,0)
 ; (earlier versions just saved the one single most recent packet)
"RTN","BPSOSAY",34,0)
 ;
"RTN","BPSOSAY",35,0)
PRINT02(N) ;EP - dump of a claim packet
"RTN","BPSOSAY",36,0)
 D PRINT0X(9002313.02,N) Q
"RTN","BPSOSAY",37,0)
PRINT03(N) ;EP - dump of a response packet
"RTN","BPSOSAY",38,0)
 D PRINT0X(9002313.03,N) Q
"RTN","BPSOSAY",39,0)
PRINT0X(FILE,N)         ; dump of a claim or response, given file number and IEN
"RTN","BPSOSAY",40,0)
 I FILE=9002313.02 D
"RTN","BPSOSAY",41,0)
 . W "Claim `",N,"  ",$P(^BPSC(N,0),U)
"RTN","BPSOSAY",42,0)
 . N X S X=$P(^BPSC(N,0),U,5)
"RTN","BPSOSAY",43,0)
 . I X W " transmitted ",X
"RTN","BPSOSAY",44,0)
 . S X=$P(^BPSC(N,0),U,6)
"RTN","BPSOSAY",45,0)
 . I X W " created ",X
"RTN","BPSOSAY",46,0)
 E  W "Response `",N," received ",$P(^BPSR(N,0),U,2)
"RTN","BPSOSAY",47,0)
 N PKT S PKT=$$GETPKT(FILE,N)
"RTN","BPSOSAY",48,0)
 D DIAGPRT(PKT)
"RTN","BPSOSAY",49,0)
 Q
"RTN","BPSOSAY",50,0)
GETPKT(FILE,N)     ; reassemble
"RTN","BPSOSAY",51,0)
 N X,ROOT
"RTN","BPSOSAY",52,0)
 S X="",ROOT="^BPS"_$S(FILE=9002313.02:"C",FILE=9002313.03:"R")
"RTN","BPSOSAY",53,0)
 F I=1:1:$P(@ROOT@(N,"M",0),U,3) D
"RTN","BPSOSAY",54,0)
 . S X=X_@ROOT@(N,"M",I,0)
"RTN","BPSOSAY",55,0)
 Q X
"RTN","BPSOSAY",56,0)
 ;
"RTN","BPSOSAY",57,0)
 ; DIAGPRT(string) to print the given string in a pretty formatted way
"RTN","BPSOSAY",58,0)
 ;
"RTN","BPSOSAY",59,0)
DIAGPRT(A) ;
"RTN","BPSOSAY",60,0)
 N I,J,K,X
"RTN","BPSOSAY",61,0)
 I $E(A)=$C(2) S A=$E(A,2,$L(A))
"RTN","BPSOSAY",62,0)
 I $E(A,1,3)="HN."!($E(A,1,3)="HN*") S A=$E(A,4,$L(A))
"RTN","BPSOSAY",63,0)
 F I=1:15:$L(A) D
"RTN","BPSOSAY",64,0)
 .W !,$J(I,4),"/ "
"RTN","BPSOSAY",65,0)
 .F J=0:1:14 S K=I+J Q:K>$L(A)  S X=$E(A,K) D
"RTN","BPSOSAY",66,0)
 ..I X=" " W " ","sp"," "
"RTN","BPSOSAY",67,0)
 ..E  I X?1ANP W " ","'",X,"'"
"RTN","BPSOSAY",68,0)
 ..E  W $J($A(X),4)
"RTN","BPSOSAY",69,0)
 W ! Q
"RTN","BPSOSAZ")
1^112
"RTN","BPSOSB")
0^113^B2654205
"RTN","BPSOSB",1,0)
BPSOSB ;BHAM ISC/FCS/DRS/FLS - utilities used by BPSOSB* ;06/01/2004
"RTN","BPSOSB",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSB",3,0)
 ;
"RTN","BPSOSB",4,0)
 ;  A/R Interfaces - in routines BPSOSB*
"RTN","BPSOSB",5,0)
 ;
"RTN","BPSOSB",6,0)
 ;  BPSOSBC,BPSOSBD - the billing background job
"RTN","BPSOSB",7,0)
 ;  BPSOSBB - calls to various interfaces
"RTN","BPSOSB",8,0)
 ;  BPSOSBB - Third Party Billing
"RTN","BPSOSB",9,0)
 ;  BPSOSBQ - reserved for Other interfaces (stub)
"RTN","BPSOSB",10,0)
 ;  BPSOSBT - reserved for ANMC
"RTN","BPSOSB",11,0)
 ;  BPSOSBP - reserved for PAC (BBM*)
"RTN","BPSOSB",12,0)
 ;  BPSOSBV,BPSOSBW - ILC A/R, main program
"RTN","BPSOSB",13,0)
 ;  BPSOSB* all others - mostly ILC A/R, many obsolete
"RTN","BPSOSB",14,0)
 ; 
"RTN","BPSOSB",15,0)
 ;  ILC old A/R's NCPDP forms printing in BPSOSN*
"RTN","BPSOSB",16,0)
 ;  New NCPDP forms printing in BPSOSF* - usable by all, not just ILC
"RTN","BPSOSB",17,0)
 ;
"RTN","BPSOSB",18,0)
 ;  The following ILC A/R routines are invoked by ECME:
"RTN","BPSOSB",19,0)
 ;  (this list written on November 12, 2000)
"RTN","BPSOSB",20,0)
 ;  EN^ABSB1592 - called by BPSOSN1 - main routine to print bills
"RTN","BPSOSB",21,0)
 ;  ^ABSBMAKE - called by BPSOSBM - create an A/R account
"RTN","BPSOSB",22,0)
 ;  OFFNCPDP^ABSBPBRX - called by BPSOSBM -
"RTN","BPSOSB",23,0)
 ;  ^ABSBVCN - called by BPSOSQD - to assign a VCN
"RTN","BPSOSB",24,0)
 Q
"RTN","BPSOSB",25,0)
AGE57(N) ;EP - BPSOSB5 ; how old is ^BPSTL(N,... ?   
"RTN","BPSOSB",26,0)
 ; $$AGE57(N)=number of days, with decimal
"RTN","BPSOSB",27,0)
 N %,%H,%I,X D NOW^%DTC ; % = now
"RTN","BPSOSB",28,0)
 N LAST S LAST=$P(^BPSTL(N,0),U,8)
"RTN","BPSOSB",29,0)
 I 'LAST S LAST=$P(^BPSTL(N,0),U,11)
"RTN","BPSOSB",30,0)
 N RET S RET=$$TIMEDIFI^BPSOSUD(LAST,%)
"RTN","BPSOSB",31,0)
 Q RET/86400
"RTN","BPSOSB",32,0)
ARSYSTEM()  ;EP - what A/R system do we interface to?
"RTN","BPSOSB",33,0)
 ; 0 (or null?) is the ILC system.
"RTN","BPSOSB",34,0)
 ; Other true-valued ones are IHS 3PBilling, etc.
"RTN","BPSOSB",35,0)
 ; The value "NONE" is non-zero, too
"RTN","BPSOSB",36,0)
 Q $P($G(^BPS(9002313.99,1,"A/R INTERFACE")),U)
"RTN","BPSOSB",37,0)
DOINGAR() ;EP - from many places - Do we do a Billing Interface in BPSOSB*?
"RTN","BPSOSB",38,0)
 Q $S($$ISABMAR:1,$$ISILCAR:1,1:0)
"RTN","BPSOSB",39,0)
ISILCAR() ;EP - various places
"RTN","BPSOSB",40,0)
 Q $$ARSYSTEM=0 ; returns TRUE if it's ILC's billing system
"RTN","BPSOSB",41,0)
ISABMAR() ; EP - various places
"RTN","BPSOSB",42,0)
 Q $$ARSYSTEM=3 ; returns TRUE if it's IHS 3rd Party Billing
"RTN","BPSOSB",43,0)
MUSTILC() ; EP - from many places
"RTN","BPSOSB",44,0)
 I $$ISILCAR Q 1
"RTN","BPSOSB",45,0)
 W "Requires the ILC Accounts Receivable system",!
"RTN","BPSOSB",46,0)
 D PRESSANY^BPSOSU5()
"RTN","BPSOSB",47,0)
 Q
"RTN","BPSOSB",48,0)
 ; ZWRITE command
"RTN","BPSOSB",49,0)
ZW(%) ;EP - BPSOSB* ; should instead ZWRITE^BPSOS
"RTN","BPSOSB",50,0)
 I $D(%)=0 W %," undefined",! Q
"RTN","BPSOSB",51,0)
 I $D(%)#10=1 W %,"=",@%,!
"RTN","BPSOSB",52,0)
 N Q S Q=% F  S Q=$Q(@Q) Q:Q=""  W Q,"=",@Q,!
"RTN","BPSOSB",53,0)
 Q
"RTN","BPSOSB0")
1^114
"RTN","BPSOSB1")
1^115
"RTN","BPSOSB2")
1^116
"RTN","BPSOSB3")
0^117^B4082767
"RTN","BPSOSB3",1,0)
BPSOSB3 ;BHAM ISC/FCS/DRS/FLS -  A/R interface ;06/01/2004
"RTN","BPSOSB3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSB3",3,0)
 ;Reference to ^DG(40.7 supported by DBIA 557
"RTN","BPSOSB3",4,0)
 Q
"RTN","BPSOSB3",5,0)
V681 ;EP - given VSTDFN
"RTN","BPSOSB3",6,0)
 ; - add a V68.1 diagnosis if it doesn't already have one
"RTN","BPSOSB3",7,0)
 N IEN
"RTN","BPSOSB3",8,0)
V681A ;
"RTN","BPSOSB3",9,0)
 Q:'$$V681IEN  ; V68.1 not on this system?! ; 03/26/2001
"RTN","BPSOSB3",10,0)
 Q:$$HASV681
"RTN","BPSOSB3",11,0)
 S IEN=$$ADDV681
"RTN","BPSOSB3",12,0)
 I IEN<0 G V681A:$$IMPOSS^BPSOSUE("FM","TRI","Failed to add diagnosis",,"V681",$T(+0))
"RTN","BPSOSB3",13,0)
 Q
"RTN","BPSOSB3",14,0)
HASV681() ; does VSTDFN already have a V68.1 among its diagnoses? ret true/false
"RTN","BPSOSB3",15,0)
 N RET S RET=0
"RTN","BPSOSB3",16,0)
 N A S A=0
"RTN","BPSOSB3",17,0)
 Q RET
"RTN","BPSOSB3",18,0)
ISV681(VPOVDFN)    ; is this a V68.1?
"RTN","BPSOSB3",19,0)
 N X S X=$$V681IEN
"RTN","BPSOSB3",20,0)
 Q 0
"RTN","BPSOSB3",21,0)
V681IEN()          Q $O(^ICD9("BA","V68.1 ",0))
"RTN","BPSOSB3",22,0)
ADDV681() ; given VSTDFN ; add a V68.1 diagnosis to the visit 
"RTN","BPSOSB3",23,0)
 ; if you $$, it gives you back the IEN
"RTN","BPSOSB3",24,0)
A681A ;
"RTN","BPSOSB3",25,0)
 N DO,DD,DIC,DA,X,DINUM,Y,DTOUT,DUOUT,DLAYGO
"RTN","BPSOSB3",26,0)
 ; DO killed so that Fileman doesn't assume leftover stuff
"RTN","BPSOSB3",27,0)
 S X=$$V681IEN
"RTN","BPSOSB3",28,0)
 N DATA S DATAT(.02)="",DATA(.03)=VSTDFN
"RTN","BPSOSB3",29,0)
 N I S DIC("DR")="" F I=.02,.03 D
"RTN","BPSOSB3",30,0)
 . S DIC("DR")=DIC("DR")_I_"////"_DATA(I)_";"
"RTN","BPSOSB3",31,0)
 S DIC("DR")=$E(DIC("DR"),1,$L(DIC("DR"))-1)
"RTN","BPSOSB3",32,0)
 K DO,DD D FILE^DICN
"RTN","BPSOSB3",33,0)
 Q +Y
"RTN","BPSOSB3",34,0)
CLINIC ;EP - given VSTDFN - if it doesn't have one, give it one: pharmacy
"RTN","BPSOSB3",35,0)
 I $$HASCLIN Q
"RTN","BPSOSB3",36,0)
 N DIDEL,DTOUT,DIE,DA,DR
"RTN","BPSOSB3",37,0)
 Q
"RTN","BPSOSB3",38,0)
HASCLIN() ; does VSTDFN already have a clinic?  return true or false 
"RTN","BPSOSB3",39,0)
 Q 0
"RTN","BPSOSB3",40,0)
PHARMCLI()         ; return IEN of PHARMACY clinic
"RTN","BPSOSB3",41,0)
 Q $O(^DIC(40.7,"B","PHARMACY",""))
"RTN","BPSOSB3",42,0)
PROVIDER() ;EP - given VSTDFN - and ^TMP($J,"VCPT",*)
"RTN","BPSOSB3",43,0)
 ; if it doesn't have a provider, give it one
"RTN","BPSOSB3",44,0)
 ; and make this the primary provider - he is the prescribing physician
"RTN","BPSOSB3",45,0)
 ; on the first prescription
"RTN","BPSOSB3",46,0)
P1 ;
"RTN","BPSOSB3",47,0)
 N VCPT S VCPT=$O(^TMP($J,"VCPT",0)) ; take first VCPT
"RTN","BPSOSB3",48,0)
 N PROV200 S PROV200=$P(^PSRX(RXI,0),U,4) Q:'PROV200  ; impossible?
"RTN","BPSOSB3",49,0)
 N PROV16 S PROV16=$$GET1^DIQ(200,PROV200,16,"I") Q:'PROV16  ; imposs?
"RTN","BPSOSB3",50,0)
 Q 0
"RTN","BPSOSB3",51,0)
 N DO,DD,DIC,DA,X,DINUM,Y,DTOUT,DUOUT,DATA
"RTN","BPSOSB3",52,0)
 ; leave DO undef
"RTN","BPSOSB3",53,0)
 S X=PROV6
"RTN","BPSOSB3",54,0)
 S DATA(.03)=VSTDFN
"RTN","BPSOSB3",55,0)
 S DATA(.04)="P"
"RTN","BPSOSB3",56,0)
 N I S DIC("DR")="" F I=.02,.03,.04 D
"RTN","BPSOSB3",57,0)
 . S DIC("DR")=DIC("DR")_I_"////"_DATA(I)
"RTN","BPSOSB3",58,0)
 . I I'=.04 S DIC("DR")=DIC("DR")_";"
"RTN","BPSOSB3",59,0)
 K DO,DD D FILE^DICN
"RTN","BPSOSB3",60,0)
 Q +Y
"RTN","BPSOSB4")
1^118
"RTN","BPSOSB5")
1^119
"RTN","BPSOSBA")
1^121
"RTN","BPSOSBB")
0^122^B30726422
"RTN","BPSOSBB",1,0)
BPSOSBB ;BHAM ISC/FCS/DRS/FLS - ECME billing - new ;06/01/2004
"RTN","BPSOSBB",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSBB",3,0)
 ;
"RTN","BPSOSBB",4,0)
 ; New ECME billing - called by the transaction completion code
"RTN","BPSOSBB",5,0)
 ; When a transaction completes, POSTING^BPSOSBB is called
"RTN","BPSOSBB",6,0)
 ; (the transaction completion happens in ^BPSOSU)
"RTN","BPSOSBB",7,0)
 ;  [Indirectly - via background job (BPSOSBD).
"RTN","BPSOSBB",8,0)
 ;   Transaction completion merely sets flag (BPSOSBC)]
"RTN","BPSOSBB",9,0)
 ;
"RTN","BPSOSBB",10,0)
 ; You get BPS57, pointer into ^BPSTL(BPS57,
"RTN","BPSOSBB",11,0)
 ; from whence comes all the transaction details.
"RTN","BPSOSBB",12,0)
 ;
"RTN","BPSOSBB",13,0)
 ; Your posting routine is called by $$.
"RTN","BPSOSBB",14,0)
 ; The result is stuffed into Field .15, POSTED TO A/R.
"RTN","BPSOSBB",15,0)
 ; It's a free text field.  Use it in any way your interface desires.
"RTN","BPSOSBB",16,0)
 ;
"RTN","BPSOSBB",17,0)
 ; BPS*1.0T7*6 :
"RTN","BPSOSBB",18,0)
 ; IHS/ASDS/LSL - 05/11/01 - Modified routine to remove calls to A/R
"RTN","BPSOSBB",19,0)
 ;     that are not published entry points. I will also remove the hard
"RTN","BPSOSBB",20,0)
 ;     sets into the A/R Bill file.  The use of API's will replace this
"RTN","BPSOSBB",21,0)
 ;     code.  One to place a bill in the RPMS 3PB package that will 
"RTN","BPSOSBB",22,0)
 ;     automatically pass to RPMS A/R.  And one to allow posting to an
"RTN","BPSOSBB",23,0)
 ;     existing bill in the RPMS A/R package.
"RTN","BPSOSBB",24,0)
 ; 
"RTN","BPSOSBB",25,0)
 Q
"RTN","BPSOSBB",26,0)
POSTING ; EP - for _all_ billing interfaces - with BPS57
"RTN","BPSOSBB",27,0)
 ;
"RTN","BPSOSBB",28,0)
 ; Based on the billing interface, call the right routine.
"RTN","BPSOSBB",29,0)
 ;
"RTN","BPSOSBB",30,0)
 N X S X=$$ARSYSTEM^BPSOSB
"RTN","BPSOSBB",31,0)
 N RESULT
"RTN","BPSOSBB",32,0)
 I X=0 D
"RTN","BPSOSBB",33,0)
 . S RESULT=$$POST^BPSOSBW ; FSI/ILC A/R Versions 1 and 2
"RTN","BPSOSBB",34,0)
 E  I X=1 D
"RTN","BPSOSBB",35,0)
 . S RESULT="" ; none
"RTN","BPSOSBB",36,0)
 E  I X=2 D
"RTN","BPSOSBB",37,0)
 . S RESULT=$$POST^BPSOSBT ; ANMC nightly checker
"RTN","BPSOSBB",38,0)
 E  I X=3 D
"RTN","BPSOSBB",39,0)
 . S RESULT=$$THIRD ; IHS Third Party Billing
"RTN","BPSOSBB",40,0)
 E  I X=4 D
"RTN","BPSOSBB",41,0)
 . S RESULT=$$POST^BPSOSBP ; PAC Patient Accounts Component (BBM*)
"RTN","BPSOSBB",42,0)
 E  I X=99 D
"RTN","BPSOSBB",43,0)
 . S RESULT=$$POST^BPSOSBQ ; other A/R (needs to fill in BPSOSBQ)
"RTN","BPSOSBB",44,0)
 E  D
"RTN","BPSOSBB",45,0)
 . S RESULT=""
"RTN","BPSOSBB",46,0)
 . ; not a supported billing system interface
"RTN","BPSOSBB",47,0)
 ;
"RTN","BPSOSBB",48,0)
 ; Flag the 9002313.57 entry as having been processed by billing.
"RTN","BPSOSBB",49,0)
 ;
"RTN","BPSOSBB",50,0)
 I RESULT]"" D
"RTN","BPSOSBB",51,0)
 . N FDA,IEN,MSG
"RTN","BPSOSBB",52,0)
 . S FDA(9002313.57,BPS57_",",.15)=RESULT
"RTN","BPSOSBB",53,0)
 . D FILE^DIE(,"FDA","MSG")
"RTN","BPSOSBB",54,0)
 Q
"RTN","BPSOSBB",55,0)
 ;
"RTN","BPSOSBB",56,0)
 ; *********************************************************************
"RTN","BPSOSBB",57,0)
THIRD() ; IHS Third Party Billing ; BPS*1.0T7*6  entire paragraph is new
"RTN","BPSOSBB",58,0)
 N TX
"RTN","BPSOSBB",59,0)
 S TX=BPS57
"RTN","BPSOSBB",60,0)
 N INSDFN,AMT,PATDFN,RXI,PRV,VDATE,CLINIC,LOC,ACCT,DISP,UNIT,QTY
"RTN","BPSOSBB",61,0)
 N DRUG,NDC,RXR,CAT,INSNAM,VSTDFN,DA
"RTN","BPSOSBB",62,0)
 S VSTDFN=$P($G(^BPSTL(TX,0)),U,7)         ; IEN to Visit file
"RTN","BPSOSBB",63,0)
 Q:'VSTDFN ""                             ; No visit on this transaction
"RTN","BPSOSBB",64,0)
 S RXR=$$GET1^DIQ(9002313.57,TX,9,"I")      ; IEN refill Mult of RX file
"RTN","BPSOSBB",65,0)
 S RXI=$$GET1^DIQ(9002313.57,TX,1.11,"I")   ; IEN Prescription (RX) file
"RTN","BPSOSBB",66,0)
 S INSDFN=$$GET1^DIQ(9002313.57,TX,1.06,"I")  ; IEN to Insurer file
"RTN","BPSOSBB",67,0)
 I 'INSDFN QUIT ""                          ; No ins on this transaction
"RTN","BPSOSBB",68,0)
 ; CAT Should get value of E PAYABLE, E CAPTURED, E REJECTED
"RTN","BPSOSBB",69,0)
 ; Non-electronic ones will usually return as PAPER
"RTN","BPSOSBB",70,0)
 S CAT=$$CATEG^BPSOSUC(TX,1)               ; Transaction category
"RTN","BPSOSBB",71,0)
 ; Posting of paper claims, next couple of lines
"RTN","BPSOSBB",72,0)
 ; Special only for assistance in setting up Training curriculum
"RTN","BPSOSBB",73,0)
 ; though it could be turned on for any site which so wishes.
"RTN","BPSOSBB",74,0)
 ;
"RTN","BPSOSBB",75,0)
 ; I paper claims and posting of paper claims allowed, G POSTIT,
"RTN","BPSOSBB",76,0)
 ; else quit
"RTN","BPSOSBB",77,0)
 I VARX=1,CAT="PAPER" G POSTIT:$$GET1^DIQ(9002313.99,"1,",235.04,"I")
"RTN","BPSOSBB",78,0)
 I VARX=1 Q ""
"RTN","BPSOSBB",79,0)
 ; I paper claims and posting of paper claims allowed, D REVERSIT
"RTN","BPSOSBB",80,0)
 I CAT="PAPER REVERSAL" D  Q DA
"RTN","BPSOSBB",81,0)
 . S DA=""
"RTN","BPSOSBB",82,0)
 . I $$GET1^DIQ(9002313.99,"1,",235.04,"I") D REVERSIT
"RTN","BPSOSBB",83,0)
 I CAT'?1"E ".E Q ""                        ; Not electronic claims
"RTN","BPSOSBB",84,0)
 I CAT["REJECTED" Q ""                      ; Rejected claim 
"RTN","BPSOSBB",85,0)
 I CAT["DUPLICATE" Q ""                     ; Duplicate claim
"RTN","BPSOSBB",86,0)
 I CAT["REVERSAL ACCEPTED" D REVERSIT Q DA  ; Post reversal to A/R
"RTN","BPSOSBB",87,0)
 G POSTIT                                   ; Create 3PB Bill
"RTN","BPSOSBB",88,0)
 ;
"RTN","BPSOSBB",89,0)
 ; *********************************************************************
"RTN","BPSOSBB",90,0)
REVERSIT ; sets DA on its way out ; BPS*1.0T7*6 ; entire paragraph is new
"RTN","BPSOSBB",91,0)
 N PRVTX,DIE,DR
"RTN","BPSOSBB",92,0)
 S PRVTX=$$PREVIOUS(TX)                     ; Prev trans for RX & refill
"RTN","BPSOSBB",93,0)
 I 'PRVTX S DA="" Q                         ; No previous transaction
"RTN","BPSOSBB",94,0)
 S DA=$P($G(^BPSTL(PRVTX,0)),U,15)         ; A/R bill  [DUZ(2),IEN]
"RTN","BPSOSBB",95,0)
 Q:'DA                                      ; A/R bill not specified
"RTN","BPSOSBB",96,0)
 S RXI=$P(^BPSTL(PRVTX,1),U,11)            ; IEN to Prescription file
"RTN","BPSOSBB",97,0)
 S BPSRX=$$GET1^DIQ(52,RXI,.01)            ; RX #
"RTN","BPSOSBB",98,0)
 Q:'BPSRX                                  ; No RX
"RTN","BPSOSBB",99,0)
 ; if posted BPSWOFF will be DUZ(2),IEN  (DA) of A/R bill; else null
"RTN","BPSOSBB",100,0)
 S BPS("CREDIT")=$$GET1^DIQ(9002313.57,PRVTX,505)  ; $$ to reverse
"RTN","BPSOSBB",101,0)
 S BPS("ARLOC")=DA                         ; A/R Bill location
"RTN","BPSOSBB",102,0)
 S BPS("TRAN TYPE")=43                     ; Adjustment
"RTN","BPSOSBB",103,0)
 S BPS("ADJ CAT")=3                        ; Write off
"RTN","BPSOSBB",104,0)
 S BPS("ADJ TYPE")=135                     ; Billed in error
"RTN","BPSOSBB",105,0)
 S BPS("USER")=$$GET1^DIQ(9002313.57,PRVTX,13)  ; User who entered tran
"RTN","BPSOSBB",106,0)
 Q
"RTN","BPSOSBB",107,0)
 ;
"RTN","BPSOSBB",108,0)
 ; *********************************************************************
"RTN","BPSOSBB",109,0)
POSTIT ; BPS*1.0T7*6 ; entire paragraph is new
"RTN","BPSOSBB",110,0)
 S BPS(.21)=$$GET1^DIQ(9002313.57,TX,505)       ; Total price
"RTN","BPSOSBB",111,0)
 S BPS(.23)=BPS(.21)
"RTN","BPSOSBB",112,0)
 S BPS(.05)=$$GET1^DIQ(9002313.57,TX,5,"I")     ; IEN to Patient file
"RTN","BPSOSBB",113,0)
 S BPS(.1)=$$GET1^DIQ(9000010,VSTDFN,.08,"I")   ; IEN to Clinic Stop
"RTN","BPSOSBB",114,0)
 S BPS(.03)=$$GET1^DIQ(9000010,VSTDFN,.06,"I")  ; Location of Encounter
"RTN","BPSOSBB",115,0)
 S BPS(.08)=INSDFN
"RTN","BPSOSBB",116,0)
 S BPS(.58)=$$GET1^DIQ(9002313.57,TX,1.09)     ; Prior Authorization
"RTN","BPSOSBB",117,0)
 S BPS(.14)=$$GET1^DIQ(9002313.57,TX,13,"I")   ; User
"RTN","BPSOSBB",118,0)
 S BPS(41,.01)=$S(RXI:$$GET1^DIQ(52,RXI,4,"I"),1:"") ; Provider
"RTN","BPSOSBB",119,0)
 S BPS(23,.01)=$$GET1^DIQ(9002313.57,TX,"1.11:DRUG","I") ; IEN to Drug File
"RTN","BPSOSBB",120,0)
 S BPS(23,.03)=$$GET1^DIQ(9002313.57,TX,501)   ; Quantity
"RTN","BPSOSBB",121,0)
 S BPS(23,.04)=$$GET1^DIQ(9002313.57,TX,502)   ; Unit Price
"RTN","BPSOSBB",122,0)
 S BPS(23,.05)=$$GET1^DIQ(9002313.57,TX,504)   ; Dispensing Fee
"RTN","BPSOSBB",123,0)
 S BPS(23,19)=$$GET1^DIQ(9002313.57,TX,10403)  ; New/Refill code
"RTN","BPSOSBB",124,0)
 S RXI=$$GET1^DIQ(9002313.57,TX,1.11,"I")
"RTN","BPSOSBB",125,0)
 S BPS(23,.06)=$$GET1^DIQ(52,RXI,.01)          ; Prescription
"RTN","BPSOSBB",126,0)
 S BPS(23,14)=$$GET1^DIQ(9002313.57,TX,10401)  ; Date filled
"RTN","BPSOSBB",127,0)
 S BPS(23,20)=$$GET1^DIQ(9002313.57,TX,10405)  ; Days supply
"RTN","BPSOSBB",128,0)
 S BPS("OTHIDENT")="0"_RXI
"RTN","BPSOSBB",129,0)
UPDT ;
"RTN","BPSOSBB",130,0)
 Q DA
"RTN","BPSOSBB",131,0)
 ;
"RTN","BPSOSBB",132,0)
 ; *********************************************************************
"RTN","BPSOSBB",133,0)
ZW(%) D ZW^BPSOSB(%)
"RTN","BPSOSBB",134,0)
 Q
"RTN","BPSOSBB",135,0)
 ;
"RTN","BPSOSBB",136,0)
 ; *********************************************************************
"RTN","BPSOSBB",137,0)
PREVIOUS(N57) ;EP -
"RTN","BPSOSBB",138,0)
 ; Get Previous transaction for this RX and Refill
"RTN","BPSOSBB",139,0)
 ; N57 = TX = IEN to Log of Transactions file (A/R Posting)
"RTN","BPSOSBB",140,0)
 N RXI,RXR
"RTN","BPSOSBB",141,0)
 S RXI=$P(^BPSTL(N57,1),U,11)          ; IEN to Prescription file
"RTN","BPSOSBB",142,0)
 S RXR=$P(^BPSTL(N57,1),U)             ; IEN Refill mult of RX file
"RTN","BPSOSBB",143,0)
 I RXI=""!(RXR="") Q ""                 ; if either value is blank Q
"RTN","BPSOSBB",144,0)
 Q $O(^BPSTL("NON-FILEMAN","RXIRXR",RXI,RXR,N57),-1)
"RTN","BPSOSBB",145,0)
 ;
"RTN","BPSOSBB",146,0)
 ; *********************************************************************
"RTN","BPSOSBB",147,0)
LAST57(RXI,RXR) ;EP -
"RTN","BPSOSBB",148,0)
 Q $O(^BPSTL("NON-FILEMAN","RXIRXR",RXI,RXR,""),-1)
"RTN","BPSOSBC")
0^123^B1046204
"RTN","BPSOSBC",1,0)
BPSOSBC ;BHAM ISC/FCS/DRS/FLS - ECME billing - new ;06/01/2004
"RTN","BPSOSBC",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSBC",3,0)
 ;
"RTN","BPSOSBC",4,0)
 Q
"RTN","BPSOSBC",5,0)
 ;
"RTN","BPSOSBC",6,0)
 ;  TRANSACT - transaction complete - called from STATUS99^BPSOSU,
"RTN","BPSOSBC",7,0)
 ;    to request that this transaction be posted.
"RTN","BPSOSBC",8,0)
 ;
"RTN","BPSOSBC",9,0)
TRANSACT(IEN57) ; EP -
"RTN","BPSOSBC",10,0)
 D SETFLAG(IEN57,1) ; set the flag
"RTN","BPSOSBC",11,0)
 D SCHEDULE^BPSOSBD() ; schedule the background job, if needed
"RTN","BPSOSBC",12,0)
 Q
"RTN","BPSOSBC",13,0)
 ;
"RTN","BPSOSBC",14,0)
 ; SETFLAG - set the billing flag for this transaction
"RTN","BPSOSBC",15,0)
 ;   VALUE = 1 for needs billing
"RTN","BPSOSBC",16,0)
 ;   VALUE = 0 for billing done
"RTN","BPSOSBC",17,0)
 ;
"RTN","BPSOSBC",18,0)
SETFLAG(IEN57,VALUE) ;EP -
"RTN","BPSOSBC",19,0)
 D
"RTN","BPSOSBC",20,0)
 . N FDA,MSG ; clear the "needs billing" flag
"RTN","BPSOSBC",21,0)
 . S FDA(9002313.57,IEN57_",",.16)=VALUE
"RTN","BPSOSBC",22,0)
SF1 . D FILE^DIE(,"FDA","MSG")
"RTN","BPSOSBC",23,0)
 . I $D(MSG) D  G SF1:$$IMPOSS^BPSOSUE("FM","TRI",.FDA,.MSG,"SETFLAG",$T(+0))
"RTN","BPSOSBC",24,0)
 . . D ZWRITE^BPSOS("FDA","MSG")
"RTN","BPSOSBC",25,0)
 Q
"RTN","BPSOSBD")
0^124^B7112323
"RTN","BPSOSBD",1,0)
BPSOSBD ;BHAM ISC/FCS/DRS/FLS - ECME billing - background ;06/01/2004
"RTN","BPSOSBD",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSBD",3,0)
 ;
"RTN","BPSOSBD",4,0)
 Q
"RTN","BPSOSBD",5,0)
SCHEDULE(DELTA) ; EP - schedule it to run again, if needed
"RTN","BPSOSBD",6,0)
 ; DELTA = how many minutes
"RTN","BPSOSBD",7,0)
 L +^TMP($J,"BPSOSBD","SCHEDULE"):0 Q:'$T
"RTN","BPSOSBD",8,0)
 I '$D(DELTA) S DELTA=$$DELTA
"RTN","BPSOSBD",9,0)
 S DELTA=DELTA*60\1 ; how many seconds
"RTN","BPSOSBD",10,0)
 I DELTA<60 S DELTA=60 ; but not immediately
"RTN","BPSOSBD",11,0)
 N ATTIME S ATTIME=$$TADDNOWS^BPSOSUD(DELTA)
"RTN","BPSOSBD",12,0)
 N NEXTTIME S NEXTTIME=$$NEXTTIME
"RTN","BPSOSBD",13,0)
 I 'NEXTTIME!(ATTIME<NEXTTIME) D
"RTN","BPSOSBD",14,0)
 . D TASKAT(ATTIME)
"RTN","BPSOSBD",15,0)
 L -^TMP($J,"BPSOSBD","SCHEDULE")
"RTN","BPSOSBD",16,0)
 Q
"RTN","BPSOSBD",17,0)
NEXTTIME() ; when is it scheduled to run again?
"RTN","BPSOSBD",18,0)
 N NEXTTIME S NEXTTIME=$P($G(^BPS(9002313.99,1,"BILLING - NEW")),U)
"RTN","BPSOSBD",19,0)
 I NEXTTIME'>$$NOW^BPSOS Q 0 ; this time is already past
"RTN","BPSOSBD",20,0)
 Q NEXTTIME ; future
"RTN","BPSOSBD",21,0)
DELTA() ; delta time until background job runs - in minutes
"RTN","BPSOSBD",22,0)
 N DELTA S DELTA=$P($G(^BPS(9002313.99,1,"BILLING - NEW")),U,2)
"RTN","BPSOSBD",23,0)
 I 'DELTA S DELTA=15
"RTN","BPSOSBD",24,0)
 I $$DISABLED,DELTA<60 S DELTA=60 ; min 1 hour if it's disabled
"RTN","BPSOSBD",25,0)
 Q DELTA
"RTN","BPSOSBD",26,0)
DISABLED() Q $P($G(^BPS(9002313.99,1,"BILLING - NEW")),U,3)=1
"RTN","BPSOSBD",27,0)
DISABLE ; EP -
"RTN","BPSOSBD",28,0)
 S $P(^BPS(9002313.99,1,"BILLING - NEW"),U,3)=1 Q
"RTN","BPSOSBD",29,0)
ENABLE ; EP -
"RTN","BPSOSBD",30,0)
 S $P(^BPS(9002313.99,1,"BILLING - NEW"),U,3)=0
"RTN","BPSOSBD",31,0)
 D TASKAT()
"RTN","BPSOSBD",32,0)
 Q
"RTN","BPSOSBD",33,0)
TASKAT(ZTDTH)    ; 
"RTN","BPSOSBD",34,0)
 I '$D(ZTDTH) S ZTDTH=$$NOW^BPSOS
"RTN","BPSOSBD",35,0)
 I '$$NEXTTIME!(ZTDTH<$$NEXTTIME) D
"RTN","BPSOSBD",36,0)
 . S $P(^BPS(9002313.99,1,"BILLING - NEW"),U)=ZTDTH
"RTN","BPSOSBD",37,0)
 N ZTRTN,ZTIO
"RTN","BPSOSBD",38,0)
 S ZTRTN="BACKGR^"_$T(+0),ZTIO=""
"RTN","BPSOSBD",39,0)
 ;ZW ZTDTH,ZTRTN
"RTN","BPSOSBD",40,0)
 D ^%ZTLOAD
"RTN","BPSOSBD",41,0)
 Q
"RTN","BPSOSBD",42,0)
ANY() Q $O(^BPSTL("AS",1,0)) ; any need billing?
"RTN","BPSOSBD",43,0)
 ;
"RTN","BPSOSBD",44,0)
 ; LOCK, UNLOCK also used by BPSOSBX
"RTN","BPSOSBD",45,0)
LOCK() ;EP -
"RTN","BPSOSBD",46,0)
 L +^TMP($J,"BPSOSBD","BACKGR"):15 Q $T
"RTN","BPSOSBD",47,0)
 ;
"RTN","BPSOSBD",48,0)
UNLOCK ;EP -
"RTN","BPSOSBD",49,0)
 L -^TMP($J,"BPSOSBD","BACKGR") Q
"RTN","BPSOSBD",50,0)
BACKGR ;
"RTN","BPSOSBD",51,0)
 I '$$ANY Q  ; none need billing
"RTN","BPSOSBD",52,0)
 I '$$LOCK Q
"RTN","BPSOSBD",53,0)
 D INIT^BPSOSL(DT+.2,1)
"RTN","BPSOSBD",54,0)
 D LOG("Billing job begins")
"RTN","BPSOSBD",55,0)
 I $$DISABLED D  G BACKGR99
"RTN","BPSOSBD",56,0)
 . D LOG("Disabled; will reschedule.")
"RTN","BPSOSBD",57,0)
 ;
"RTN","BPSOSBD",58,0)
 ;  Loop: Process the 9002313.57 entries which need billing.
"RTN","BPSOSBD",59,0)
 ;  They are listed in ^BPSTL("AS",1,*)
"RTN","BPSOSBD",60,0)
 ;  BPS57 is the variable name expected by POSTING^BPSOSBB
"RTN","BPSOSBD",61,0)
 ;
"RTN","BPSOSBD",62,0)
 N BPS57 S BPS57=0
"RTN","BPSOSBD",63,0)
 F  S BPS57=$O(^BPSTL("AS",1,BPS57)) Q:'BPS57  D
"RTN","BPSOSBD",64,0)
 . D LOG^BPSOSL("Posting transaction "_BPS57_".")
"RTN","BPSOSBD",65,0)
 . D POSTING^BPSOSBB ; post the transaction
"RTN","BPSOSBD",66,0)
 . D SETFLAG^BPSOSBC(BPS57,0) ; clear the "needs billing" flag
"RTN","BPSOSBD",67,0)
 ;
"RTN","BPSOSBD",68,0)
 D DONE^BPSOSL
"RTN","BPSOSBD",69,0)
 ;
"RTN","BPSOSBD",70,0)
BACKGR99 ;
"RTN","BPSOSBD",71,0)
 D UNLOCK
"RTN","BPSOSBD",72,0)
 I $$ANY D SCHEDULE($S($$DISABLED:60,1:1)) ; in case any slipped in while we were leaving
"RTN","BPSOSBD",73,0)
 Q
"RTN","BPSOSBD",74,0)
ILCAR ;
"RTN","BPSOSBD",75,0)
 Q
"RTN","BPSOSBD",76,0)
LOG(X) D LOG^BPSOSL(X) Q
"RTN","BPSOSBD",77,0)
PRINTLOG D PRINTLOG^BPSOSL(DT+.2) Q
"RTN","BPSOSBE")
1^125
"RTN","BPSOSBF")
0^126^B27674938
"RTN","BPSOSBF",1,0)
BPSOSBF ;BHAM ISC/FCS/DRS/FLS - ILC/AR comments in 9002302 ;06/01/2004
"RTN","BPSOSBF",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSBF",3,0)
 Q
"RTN","BPSOSBF",4,0)
COMMENT(PCNDFN,COMMENT,DATE) ;EP - add a brief comment
"RTN","BPSOSBF",5,0)
 ; If you call it with $$, it returns pointer to the comment
"RTN","BPSOSBF",6,0)
 ; If it fails, the $$ returns false
"RTN","BPSOSBF",7,0)
 ; in ^ABSBITMS(9002302,PCNDFN,"MSG",*)
"RTN","BPSOSBF",8,0)
 N FDA,IEN,MSG,FN S FN=9002302.082
"RTN","BPSOSBF",9,0)
 N X S X="+1,"_PCNDFN_","
"RTN","BPSOSBF",10,0)
 S FDA(FN,X,.01)="NOW"
"RTN","BPSOSBF",11,0)
 N MAX S MAX=45 ; from ^DD(9002302.082,.03)
"RTN","BPSOSBF",12,0)
 I $L(COMMENT)>MAX S COMMENT=$E(COMMENT,1,MAX-3)_"..."
"RTN","BPSOSBF",13,0)
 S FDA(FN,X,.03)=COMMENT
"RTN","BPSOSBF",14,0)
 I $D(DATE) S FDA(FN,X,.04)=DATE
"RTN","BPSOSBF",15,0)
 D UPDATE^DIE("E","FDA","IEN","MSG")
"RTN","BPSOSBF",16,0)
 I $D(MSG) D
"RTN","BPSOSBF",17,0)
 . D LOG^BPSOSL("COMMENT^"_$T(+0)_" failed for PCNDFN="_PCNDFN)
"RTN","BPSOSBF",18,0)
 . D LOGARRAY^BPSOSL("MSG")
"RTN","BPSOSBF",19,0)
 Q $G(IEN(1))
"RTN","BPSOSBF",20,0)
COMMWP(PCNDFN,COMMIEN,ROOT)        ;
"RTN","BPSOSBF",21,0)
 N FDA,IEN,MSG,FN S FN=9002302.082
"RTN","BPSOSBF",22,0)
 D WP^DIE(FN,COMMIEN_","_PCNDFN_",",1,"K",ROOT,"MSG")
"RTN","BPSOSBF",23,0)
 I $D(MSG) D
"RTN","BPSOSBF",24,0)
 . D LOG^BPSOSL("COMMWP^"_$T(+0)_" failed for PCNDFN="_PCNDFN_",COMMIEN="_COMMIEN)
"RTN","BPSOSBF",25,0)
 Q '$D(MSG) ; so it returns true if success, false if failure
"RTN","BPSOSBF",26,0)
REJECTS(PCNDFN,COMMENT,ARRAY57)        ;EP
"RTN","BPSOSBF",27,0)
 ; Add a comment and then make extended remarks based on claims
"RTN","BPSOSBF",28,0)
 ; in ARRAY57(*).  Returns true/false (did it work?)
"RTN","BPSOSBF",29,0)
 N COMM ; COMM = Pointer: ^ABSBITMS(9002302,PCNDFN,"MSG",COMM)
"RTN","BPSOSBF",30,0)
 S COMM=$$COMMENT(PCNDFN,COMMENT) ; add the general comment, first
"RTN","BPSOSBF",31,0)
 I 'COMM Q 0
"RTN","BPSOSBF",32,0)
 ; and now deal with the details of the rejection
"RTN","BPSOSBF",33,0)
 K ^TMP($J,$T(+0)) N LINE S LINE=0
"RTN","BPSOSBF",34,0)
 N N57,FIRST S N57=0,FIRST=1
"RTN","BPSOSBF",35,0)
 F  S N57=$O(ARRAY57(N57)) Q:'N57  D REJ1 S FIRST=0
"RTN","BPSOSBF",36,0)
 ; Store the word processing field
"RTN","BPSOSBF",37,0)
 N OK S OK=$$COMMWP(PCNDFN,COMM,"^TMP("_$J_","""_$T(+0)_""")")
"RTN","BPSOSBF",38,0)
 Q OK
"RTN","BPSOSBF",39,0)
REJ1 N R0,R1 S R0=^BPSTL(N57,0),R1=^(1)
"RTN","BPSOSBF",40,0)
 N INSDFN S INSDFN=$P(R1,U,6)
"RTN","BPSOSBF",41,0)
 N INSNAME
"RTN","BPSOSBF",42,0)
 N RXI S RXI=$P(R0,U)
"RTN","BPSOSBF",43,0)
 N DRGDFN S DRGDFN=$P(^PSRX(RXI,0),U,6)
"RTN","BPSOSBF",44,0)
 N DRGNAME S DRGNAME=$P(^PSDRUG(DRGDFN,0),U)
"RTN","BPSOSBF",45,0)
 N NDC S NDC=$P(R1,U,2),NDC=$$FORMTNDC^BPSOS9(NDC)
"RTN","BPSOSBF",46,0)
 N CLAIM S CLAIM=$P(R0,U,4)
"RTN","BPSOSBF",47,0)
 N CLAIMID S CLAIMID=$P(^BPSC(CLAIM,0),U)
"RTN","BPSOSBF",48,0)
 N RESP S RESP=$P(R0,U,5)
"RTN","BPSOSBF",49,0)
 N ECME S POS=$P(R0,U,9)
"RTN","BPSOSBF",50,0)
 N TIME,Y S Y=$P(^BPSR(RESP,0),U,2) X ^DD("DD") S TIME=Y
"RTN","BPSOSBF",51,0)
 D REJX(CLAIMID_"#"_POS_" for "_NDC_" "_DRGNAME)
"RTN","BPSOSBF",52,0)
 D REJX("Rejected by "_INSNAME_" on "_TIME)
"RTN","BPSOSBF",53,0)
 N MSG1 S MSG1=$P($G(^BPSR(RESP,1000,POS,504)),U)
"RTN","BPSOSBF",54,0)
 I MSG1]"" D REJX(MSG1)
"RTN","BPSOSBF",55,0)
 N MSG2 S MSG2=$P($G(^BPSR(RESP,1000,POS,526)),U)
"RTN","BPSOSBF",56,0)
 I MSG2]"" D REJX(MSG2)
"RTN","BPSOSBF",57,0)
 N REJ S REJ=""
"RTN","BPSOSBF",58,0)
 F  S REJ=$O(^BPSR(RESP,1000,POS,511,"B",REJ)) Q:REJ=""  D
"RTN","BPSOSBF",59,0)
 . N MSG S MSG="/"_REJ_" "_$P($G(^BPSF(9002313.93,REJ,0)),U,2)
"RTN","BPSOSBF",60,0)
 . D REJX(MSG)
"RTN","BPSOSBF",61,0)
 Q
"RTN","BPSOSBF",62,0)
REJX(X) S LINE=LINE+1,^TMP($J,$T(+0),LINE)=X Q  ; used by other subrous, below
"RTN","BPSOSBF",63,0)
 ; Observe:  what we just did lists every rejected claim with
"RTN","BPSOSBF",64,0)
 ; every rejection reason.  It would be nice to cleverly group
"RTN","BPSOSBF",65,0)
 ; things, e.g., to say ALL rejected because of M/I CARDHOLDER NUMBER
"RTN","BPSOSBF",66,0)
 ;
"RTN","BPSOSBF",67,0)
 ; Design for making intelligent comments about rejected claims:
"RTN","BPSOSBF",68,0)
 ;
"RTN","BPSOSBF",69,0)
 ; Build 
"RTN","BPSOSBF",70,0)
 ;  @TMP=count^$ amt of original claims
"RTN","BPSOSBF",71,0)
 ;  @TMP@(N)=drug name
"RTN","BPSOSBF",72,0)
 ;  @TMP@(N,0)=the message from the response packet
"RTN","BPSOSBF",73,0)
 ;  @TMP@(N,reason code)=""
"RTN","BPSOSBF",74,0)
 ;
"RTN","BPSOSBF",75,0)
 ;  @TMP1@(reason code)=count of rejects with this reason ^ reason text
"RTN","BPSOSBF",76,0)
 ;  @TMP1@(reason code,N)="" point back to @TMP@(N)
"RTN","BPSOSBF",77,0)
 ;
"RTN","BPSOSBF",78,0)
 ;  @TMP2@(message)=count
"RTN","BPSOSBF",79,0)
 ;  @TMP2@(message,N)=""   point back to @TMP@(N)
"RTN","BPSOSBF",80,0)
 ;
"RTN","BPSOSBF",81,0)
 ;  @TMP3@($P(ClaimID,"-",1,2),$P(ClaimID,"-",3))=""
"RTN","BPSOSBF",82,0)
 ;      well no, that's already done by the COMMENT we had coming in
"RTN","BPSOSBF",83,0)
 ;
"RTN","BPSOSBF",84,0)
 ;  Then the general form is   <X> REJECTED by <insurer> <Y>
"RTN","BPSOSBF",85,0)
 ; where <X> is either the Drug name or a count of how many
"RTN","BPSOSBF",86,0)
 ;  or the word ALL or BOTH
"RTN","BPSOSBF",87,0)
 ;
"RTN","BPSOSBF",88,0)
 ;  and <Y> is either   : <reasons>
"RTN","BPSOSBF",89,0)
 ;     or :see Claim ID xxxxx
"RTN","BPSOSBF",90,0)
 ;
"RTN","BPSOSBF",91,0)
LIST57(PCNDFN,COMMENT,ARR57) ;EP -
"RTN","BPSOSBF",92,0)
 ; Comment is a list of file 9002313.57 transaction
"RTN","BPSOSBF",93,0)
 ; numbers.  This paragraph is a copy of what's at REJECTS
"RTN","BPSOSBF",94,0)
 N COMM ; COMM = Pointer: ^ABSBITMS(9002302,PCNDFN,"MSG",COMM)
"RTN","BPSOSBF",95,0)
 S COMM=$$COMMENT(PCNDFN,COMMENT) ; add the general comment, first
"RTN","BPSOSBF",96,0)
 I 'COMM Q 0
"RTN","BPSOSBF",97,0)
 ; and now deal with the details of the rejection
"RTN","BPSOSBF",98,0)
 K ^TMP($J,$T(+0)) N LINE S LINE=0
"RTN","BPSOSBF",99,0)
 N N57,FIRST S N57=0,FIRST=1
"RTN","BPSOSBF",100,0)
 F  S N57=$O(ARR57(N57)) Q:'N57  D LIST571 S FIRST=0
"RTN","BPSOSBF",101,0)
 ; Store the word processing field
"RTN","BPSOSBF",102,0)
 N OK S OK=$$COMMWP(PCNDFN,COMM,"^TMP("_$J_","""_$T(+0)_""")")
"RTN","BPSOSBF",103,0)
 Q OK
"RTN","BPSOSBF",104,0)
LIST571 ;
"RTN","BPSOSBF",105,0)
 N R0,R1 S R0=^BPSTL(N57,0),R1=^BPSTL(N57,1)
"RTN","BPSOSBF",106,0)
 ; List the transaction #, the claim ID, the position in the claim
"RTN","BPSOSBF",107,0)
 N LAST S LAST=($O(ARR57(N57))="")
"RTN","BPSOSBF",108,0)
 N CLAIM S CLAIM=$P(R0,U,4)
"RTN","BPSOSBF",109,0)
 N CLAIMID,POS
"RTN","BPSOSBF",110,0)
 I CLAIM D
"RTN","BPSOSBF",111,0)
 . S CLAIMID=$P($G(^BPSC(CLAIM,0)),U),POS=$P(R0,U,9)
"RTN","BPSOSBF",112,0)
 E  S CLAIMID="",POS=""
"RTN","BPSOSBF",113,0)
 N X S X="File 9002313.57 transaction number "_N57
"RTN","BPSOSBF",114,0)
 I CLAIMID]"" S X=X_", Claim ID "_CLAIMID_", position "_POS
"RTN","BPSOSBF",115,0)
 I ARR57(N57)]"" D
"RTN","BPSOSBF",116,0)
 . S X=X_" superseded transaction number "_ARR57(N57)
"RTN","BPSOSBF",117,0)
 I 'LAST S X=X_" / "
"RTN","BPSOSBF",118,0)
 D REJX(X)
"RTN","BPSOSBF",119,0)
 Q
"RTN","BPSOSBF",120,0)
PAYABLE(PCNDFN,COMMENT,ARR57) ;EP - comment on what was paid and how much $$
"RTN","BPSOSBF",121,0)
 ; this paragraph is a copy of what's a REJECTS
"RTN","BPSOSBF",122,0)
 ; with a little bit extra for $ amounts
"RTN","BPSOSBF",123,0)
 ; Also, order of things is switched a little
"RTN","BPSOSBF",124,0)
 K ^TMP($J,$T(+0)) N LINE S LINE=0
"RTN","BPSOSBF",125,0)
 N N57,FIRST S N57=0,FIRST=1
"RTN","BPSOSBF",126,0)
 N PAY ; PAY(*) accumulators
"RTN","BPSOSBF",127,0)
 F  S N57=$O(ARR57(N57)) Q:'N57  D PAY1 S FIRST=0  ; fill the PAY array
"RTN","BPSOSBF",128,0)
 I '$D(PAY) D  Q 0
"RTN","BPSOSBF",129,0)
 . D LOG^BPSOSL("ERROR - no PAY(*) data? on PCNDFN="_PCNDFN)
"RTN","BPSOSBF",130,0)
 N COMM ; COMM = Pointer: ^ABSBITMS(9002302,PCNDFN,"MSG",COMM)
"RTN","BPSOSBF",131,0)
 S COMM=$$COMMENT(PCNDFN,COMMENT) ; add the general comment, first
"RTN","BPSOSBF",132,0)
 I 'COMM Q 0
"RTN","BPSOSBF",133,0)
 I $G(PAY("00.09 ECME Paid"))=$G(PAY("00 ECME Billed")) D
"RTN","BPSOSBF",134,0)
 . K PAY("00 ECME Billed") ; since it's the same amount
"RTN","BPSOSBF",135,0)
 N X,FIRST S FIRST=1 S X="" F  S X=$O(PAY(X)) Q:X=""  D
"RTN","BPSOSBF",136,0)
 . Q:'PAY(X)  ; don't report zero amounts
"RTN","BPSOSBF",137,0)
 . N % S %=$P(X," ",2,$L(X," "))
"RTN","BPSOSBF",138,0)
 . S %=%_":$"_$J(PAY(X),0,2)
"RTN","BPSOSBF",139,0)
 . I FIRST S FIRST=0
"RTN","BPSOSBF",140,0)
 . E  S %="; "_%
"RTN","BPSOSBF",141,0)
 . D REJX(%)
"RTN","BPSOSBF",142,0)
 ; Store the word processing field
"RTN","BPSOSBF",143,0)
 N OK S OK=$$COMMWP(PCNDFN,COMM,"^TMP("_$J_","""_$T(+0)_""")")
"RTN","BPSOSBF",144,0)
 Q OK
"RTN","BPSOSBF",145,0)
PAY1 ; payment details for transaction N57
"RTN","BPSOSBF",146,0)
 N R0,R1,R5 S R0=^BPSTL(N57,0),R1=^(1),R5=^(5)
"RTN","BPSOSBF",147,0)
 D ADDPAY("00 ECME Billed",$P(R5,U,5))
"RTN","BPSOSBF",148,0)
 N RESP S RESP=$P(R0,U,5)
"RTN","BPSOSBF",149,0)
 N ECME S POS=$P(R0,U,9)
"RTN","BPSOSBF",150,0)
 N AMTS S AMTS=^BPSR(RESP,1000,POS,500)
"RTN","BPSOSBF",151,0)
 N RETVAL S RETVAL=$$PAY2("00.09 ECME Paid",9) ; first " " piece controls order
"RTN","BPSOSBF",152,0)
 S RETVAL=$$PAY2("05 Patient Pay",5)
"RTN","BPSOSBF",153,0)
 S RETVAL=$$PAY2("18 Copay",18)
"RTN","BPSOSBF",154,0)
 Q
"RTN","BPSOSBF",155,0)
PAY2(CATEG,AMTSPCE)          ;
"RTN","BPSOSBF",156,0)
 N AMT S AMT=$P(AMTS,U,AMTSPCE) Q:AMT=""
"RTN","BPSOSBF",157,0)
 S AMT=$$DFF2EXT^BPSECFM(AMT)
"RTN","BPSOSBF",158,0)
 D ADDPAY(CATEG,AMT)
"RTN","BPSOSBF",159,0)
 Q AMT
"RTN","BPSOSBF",160,0)
ADDPAY(CATEG,AMOUNT) S PAY(CATEG)=$G(PAY(CATEG))+AMOUNT Q
"RTN","BPSOSBI")
1^127
"RTN","BPSOSBL")
1^128
"RTN","BPSOSBM")
0^129^B49524905
"RTN","BPSOSBM",1,0)
BPSOSBM ;BHAM ISC/FCS/DRS/FLS - ECME billing, part 3 ;06/01/2004
"RTN","BPSOSBM",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSBM",3,0)
 ; *****
"RTN","BPSOSBM",4,0)
 ; *****  Interface to ABSB, the ILC A/R package
"RTN","BPSOSBM",5,0)
 ; *****  This code is reached _ONLY_ by sites using ILC A/R,
"RTN","BPSOSBM",6,0)
 ; *****  and who choose to interface to it.
"RTN","BPSOSBM",7,0)
 ; *****
"RTN","BPSOSBM",8,0)
 Q
"RTN","BPSOSBM",9,0)
CHGLIST() ; EP - from BPSOSBX
"RTN","BPSOSBM",10,0)
 ; Post all the charges in CHGLIST(IEN57)="" ; returns PCNDFN
"RTN","BPSOSBM",11,0)
 K ^TMP("BPSOSBM",$J),^TMP($J,"VCPT")
"RTN","BPSOSBM",12,0)
 N VSTDFN,VCN
"RTN","BPSOSBM",13,0)
 N IEN57 S IEN57=$O(CHGLIST(0))
"RTN","BPSOSBM",14,0)
 S VSTDFN=$$VISITIEN^BPSOS57
"RTN","BPSOSBM",15,0)
 I 'VSTDFN D IMPOSS^BPSOSUE("DB","TI","Missing visit pointer","IEN57="_IEN57,"CHGLIST",$T(+0))
"RTN","BPSOSBM",16,0)
 I VCN="" D IMPOSS^BPSOSUE("DB","TI","Missing VCN","VSTDFN="_VSTDFN,"CHGLIST",$T(+0))
"RTN","BPSOSBM",17,0)
 S IEN57=0 F  S IEN57=$O(CHGLIST(IEN57)) Q:'IEN57  D
"RTN","BPSOSBM",18,0)
 . N VCPT
"RTN","BPSOSBM",19,0)
 . S VCPT=$$VCPT^BPSOSBV
"RTN","BPSOSBM",20,0)
 . S ^TMP("BPSOSBM",$J,VCN,VCPT)=""
"RTN","BPSOSBM",21,0)
 . S ^TMP($J,"VCPT",VCPT)=IEN57_U_$$RXI^BPSOS57_U_$$RXR^BPSOS57
"RTN","BPSOSBM",22,0)
 D LOG^BPSOSL($T(+0)_" - Posting for VCN="_VCN_", VSTDFN="_VSTDFN)
"RTN","BPSOSBM",23,0)
 ;
"RTN","BPSOSBM",24,0)
 ; Make sure the visit has a V68.1 diagnosis code
"RTN","BPSOSBM",25,0)
 ;  (special for Sitka; available to others)
"RTN","BPSOSBM",26,0)
 ; 
"RTN","BPSOSBM",27,0)
 I '$P($G(^BPS(9002313.99,1,"CREATING A/R")),U,1) D
"RTN","BPSOSBM",28,0)
 . D V681^BPSOSB3
"RTN","BPSOSBM",29,0)
 ;
"RTN","BPSOSBM",30,0)
 ; Make sure the visit has a primary provider, setting him to
"RTN","BPSOSBM",31,0)
 ; be the prescriber if none is already defined.
"RTN","BPSOSBM",32,0)
 ;  (Special for Sitka; available to others)
"RTN","BPSOSBM",33,0)
 ;
"RTN","BPSOSBM",34,0)
 I '$P($G(^BPS(9002313.99,1,"CREATING A/R")),U,2) D
"RTN","BPSOSBM",35,0)
 . D PROVIDER^BPSOSB3()
"RTN","BPSOSBM",36,0)
 ;
"RTN","BPSOSBM",37,0)
 ; Make sure the visit has a clinic.  If not, give it the PHARMACY..
"RTN","BPSOSBM",38,0)
 ;
"RTN","BPSOSBM",39,0)
 I '$P($G(^BPS(9002313.99,1,"CREATING A/R")),U,3) D
"RTN","BPSOSBM",40,0)
 . D CLINIC^BPSOSB3
"RTN","BPSOSBM",41,0)
 ;
"RTN","BPSOSBM",42,0)
 ; Finally, create the actual bill
"RTN","BPSOSBM",43,0)
 ;
"RTN","BPSOSBM",44,0)
 N PCNDFN
"RTN","BPSOSBM",45,0)
 S PCNDFN=$$ABSBMAKE
"RTN","BPSOSBM",46,0)
 I '$G(PCNDFN) D
"RTN","BPSOSBM",47,0)
 . D LOG^BPSOSL($T(+0)_" - ABSBMAKE failed to post charges!!")
"RTN","BPSOSBM",48,0)
 ;
"RTN","BPSOSBM",49,0)
 D DTBILLED ; And update the DATE BILLED multiple
"RTN","BPSOSBM",50,0)
 D COMMENTS ; about how much was paid and about reasons for rejects
"RTN","BPSOSBM",51,0)
 Q PCNDFN
"RTN","BPSOSBM",52,0)
COMMENTS ; remark about how much will be paid and give reasons for rejects
"RTN","BPSOSBM",53,0)
 N ARRPAID,ARRREJ ; 
"RTN","BPSOSBM",54,0)
 S IEN57=0 F  S IEN57=$O(CHGLIST(IEN57)) Q:'IEN57  D
"RTN","BPSOSBM",55,0)
 . N R S R=$$GET1^DIQ(9002313.57,IEN57_",","RESULT WITH REVERSAL")
"RTN","BPSOSBM",56,0)
 . I R="E PAYABLE" S ARRPAID(IEN57)=""
"RTN","BPSOSBM",57,0)
 . E  I R="E REJECTED" S ARRREJ(IEN57)=""
"RTN","BPSOSBM",58,0)
 I $D(ARRPAID) D PAYABLE^BPSOSBF(PCNDFN,"Insurer will pay",.ARRPAID)
"RTN","BPSOSBM",59,0)
 I $D(ARRREJ) D REJECTS^BPSOSBF(PCNDFN,"Rejected claims",.ARRREJ)
"RTN","BPSOSBM",60,0)
 Q
"RTN","BPSOSBM",61,0)
DTBILLED ; Update the DATE BILLED multiple
"RTN","BPSOSBM",62,0)
 N FDA,MSG,IEN57 S IEN57=$O(CHGLIST(0))
"RTN","BPSOSBM",63,0)
 N FN,IENS S FN=9002302.04,IENS="+1,"_PCNDFN_","
"RTN","BPSOSBM",64,0)
 S FDA(FN,IENS,.01)=DT ; DATE BILLED
"RTN","BPSOSBM",65,0)
 N IDLIST,AMT,IEN57 S IEN57=0
"RTN","BPSOSBM",66,0)
 F  S IEN57=$O(CHGLIST(IEN57)) Q:IEN57=""  D
"RTN","BPSOSBM",67,0)
 . ; if it has a claim ID, it was billed electronically
"RTN","BPSOSBM",68,0)
 . N X S X=$P(^BPSTL(IEN57,0),U,4) Q:'X
"RTN","BPSOSBM",69,0)
 . S IDLIST($P(^BPSC(X,0),U))=""
"RTN","BPSOSBM",70,0)
 . S AMT=AMT+$P(^BPSTL(IEN57,5),U,5)
"RTN","BPSOSBM",71,0)
 . S FDA(FN,IENS,.02)=$$FMTIDS ; DESCRIPTION
"RTN","BPSOSBM",72,0)
 I $G(FDA(FN,IENS,.02))="" Q  ; none of them sent electronically
"RTN","BPSOSBM",73,0)
 S FDA(FN,IENS,.03)=AMT ; AMOUNT BILLED
"RTN","BPSOSBM",74,0)
 S FDA(FN,IENS,.04)=$$INSIEN^BPSOS57
"RTN","BPSOSBM",75,0)
DTB8 D UPDATE^DIE(,"FDA",,"MSG")
"RTN","BPSOSBM",76,0)
 I $D(MSG) D  G DTB8:$$IMPOSS^BPSOSUE("FM","TRI",$T(DTBILLED),,"DTB8",$T(+0))
"RTN","BPSOSBM",77,0)
 . D LOG^BPSOSL("Failed to update DATE BILLED")
"RTN","BPSOSBM",78,0)
 . D LOGARRAY^BPSOSL("FDA")
"RTN","BPSOSBM",79,0)
 . D LOGARRAY^BPSOSL("MSG")
"RTN","BPSOSBM",80,0)
 Q
"RTN","BPSOSBM",81,0)
FMTIDS() ; format IDLIST(claim ID's) into a concise string
"RTN","BPSOSBM",82,0)
 ; LEN agrees with ^DD(9002302.04,1) maximum length
"RTN","BPSOSBM",83,0)
 N X,RET,LEN,FIRST S (FIRST,RET,X)=$O(IDLIST("")),LEN=50
"RTN","BPSOSBM",84,0)
 F  S X=$O(IDLIST(X)) Q:X=""  D
"RTN","BPSOSBM",85,0)
 . I $P(X,"-",1,2)=$P(FIRST,"-",1,2) S RET=RET_","_$P(X,"-",3)
"RTN","BPSOSBM",86,0)
 . E  S RET=RET_";"_X,FIRST=X
"RTN","BPSOSBM",87,0)
 I $L(RET)>LEN S RET=$E(RET,1,LEN-3)_"..."
"RTN","BPSOSBM",88,0)
 E  I $L(RET)+4'>LEN S RET="ECME "_RET
"RTN","BPSOSBM",89,0)
 Q RET
"RTN","BPSOSBM",90,0)
ABSBMAKE() ;
"RTN","BPSOSBM",91,0)
 ; We have ^TMP as above; also VCN,VSTDFN and lots of other stuff
"RTN","BPSOSBM",92,0)
 ; Return PCNDFN
"RTN","BPSOSBM",93,0)
 N ARTYPNUM D ARTYPNUM ; set the right ARTYPNUM for these charges
"RTN","BPSOSBM",94,0)
 E  K ^TMP($J,"SAVE PINS")
"RTN","BPSOSBM",95,0)
 E  K ^TMP($J,"SAVE PCN")
"RTN","BPSOSBM",96,0)
 N PINS D PINS
"RTN","BPSOSBM",97,0)
 D  ; fix old style CAID,2352 -> CAID,2352,0
"RTN","BPSOSBM",98,0)
 . ; affects only those created under old and being posted under new
"RTN","BPSOSBM",99,0)
 . N I F I=1:1:$L(PINS,U) D
"RTN","BPSOSBM",100,0)
 . . N X S X=$P(PINS,U,I)
"RTN","BPSOSBM",101,0)
 . . I $L(X,",")=2 S $P(X,",",3)=0,$P(PINS,U,I)=X
"RTN","BPSOSBM",102,0)
 N PCN,BAL,PCNDFN
"RTN","BPSOSBM",103,0)
 D
"RTN","BPSOSBM",104,0)
 . N BLLTYP S BLLTYP="OP"
"RTN","BPSOSBM",105,0)
 . N FIXINDEX S FIXINDEX=0
"RTN","BPSOSBM",106,0)
AM6 . I '$$NULLOPEN D  G AM6:$$IMPOSS^BPSOSUE("DEV","IRT","$$NULLOPEN",,"AM6",$T(+0))
"RTN","BPSOSBM",107,0)
 . D COMBINS ; - - - - - - - UPDATE COMBINED INSURANCE - - - - - - -
"RTN","BPSOSBM",108,0)
 . D NULLCLOS
"RTN","BPSOSBM",109,0)
 I '$G(PCNDFN) D  Q ""
"RTN","BPSOSBM",110,0)
 . D LOG^BPSOSL("* * * * * ERROR:  did not create A/R for VN="_VCN_",VSTDFN="_VSTDFN)
"RTN","BPSOSBM",111,0)
 . D LOG^BPSOSL("This is the ^TMP(BPSOSBM,$J) contents:")
"RTN","BPSOSBM",112,0)
 . N TMP M TMP=^TMP("BPSOSBM",$J)
"RTN","BPSOSBM",113,0)
 . D LOGARRAY^BPSOSL("TMP")
"RTN","BPSOSBM",114,0)
 . D LOG^BPSOSL("This is the ^TMP($J,""VCPT"") contents:")
"RTN","BPSOSBM",115,0)
 . K TMP M TMP=^TMP($J,"VCPT")
"RTN","BPSOSBM",116,0)
 . D LOGARRAY^BPSOSL("TMP")
"RTN","BPSOSBM",117,0)
 N PAT D
"RTN","BPSOSBM",118,0)
 . N N D FIRSTN
"RTN","BPSOSBM",119,0)
 . S PAT=$P(^BPSTL(N,0),U,6)
"RTN","BPSOSBM",120,0)
 . S PAT=$P(^DPT(PAT,0),U)
"RTN","BPSOSBM",121,0)
 N X S X=PAT_"  VCN "_VCN_"  PCN "_PCN
"RTN","BPSOSBM",122,0)
 S X=X_"  $"_$J(BAL,0,2)
"RTN","BPSOSBM",123,0)
 S X=X_" posted"
"RTN","BPSOSBM",124,0)
 D LOG^BPSOSL(X) ;,$G(ECHO)) 
"RTN","BPSOSBM",125,0)
 N VCPT S VCPT=0 F  S VCPT=$O(^TMP("BPSOSBM",$J,VCN,VCPT)) Q:'VCPT  D
"RTN","BPSOSBM",126,0)
 . N N,RXI,RXR
"RTN","BPSOSBM",127,0)
 . S N=^TMP($J,"VCPT",VCPT),RXI=$P(N,U,2),RXR=$P(N,U,3),N=$P(N,U)
"RTN","BPSOSBM",128,0)
 . N N57 S N57=N ; maybe, in case fileman blows away N
"RTN","BPSOSBM",129,0)
 . D LINEITEM ; log file detail of the charge
"RTN","BPSOSBM",130,0)
 . D MARKVCPT ; note RXI, RXR on the VCPT
"RTN","BPSOSBM",131,0)
 . D UPDATE57 ; record in .57 file that this entry has been billed
"RTN","BPSOSBM",132,0)
 . D UPDATE02 ; 9002313.02 claim points to PCN
"RTN","BPSOSBM",133,0)
 . I $$GET1^DIQ(9002313.57,N57_",","RESULT WITH REVERSAL")?1"E ".E D
"RTN","BPSOSBM",134,0)
 . .; D OFFNCPDP^ABSBPBRX(PCNDFN) ; electronic claim? do not print form.
"RTN","BPSOSBM",135,0)
 Q PCNDFN
"RTN","BPSOSBM",136,0)
COMBINS ; have to update the combined insurance file?  Yes. 
"RTN","BPSOSBM",137,0)
 ; because DO ^ABSBMAKE refers back to combined insurance.
"RTN","BPSOSBM",138,0)
 ; (This is new.  Sitka didn't need it because back then,
"RTN","BPSOSBM",139,0)
 ;  ILC and ECME used the same ^ABSBCOMB.)
"RTN","BPSOSBM",140,0)
 Q
"RTN","BPSOSBM",141,0)
LINEITEM         ;
"RTN","BPSOSBM",142,0)
 N DRGDFN,NDC,DRGNAME,CHARGE,X,QTY
"RTN","BPSOSBM",143,0)
 S DRGDFN=$P(^PSRX(RXI,0),U,6)
"RTN","BPSOSBM",144,0)
 S NDC=$P(^BPSTL(N57,1),U,2) ; fixed 03/26/2001
"RTN","BPSOSBM",145,0)
 S DRGNAME=$P($G(^PSDRUG(DRGDFN,0)),U)
"RTN","BPSOSBM",146,0)
 S QTY=$P(^BPSTL(N57,5),U)
"RTN","BPSOSBM",147,0)
 I QTY#1 S QTY=$J(QTY,8,3)
"RTN","BPSOSBM",148,0)
 E  S QTY=$J(QTY,4)
"RTN","BPSOSBM",149,0)
 S X=QTY_" "_$$ANFF^BPSECFM(DRGNAME,25)_"  "
"RTN","BPSOSBM",150,0)
 S X=X_$$ANFF^BPSECFM($$FORMTNDC^BPSOS9(NDC),13)
"RTN","BPSOSBM",151,0)
 S X=X_" "_$J(CHARGE,8,2)
"RTN","BPSOSBM",152,0)
 S X=X_"  ("_VCPT_")"
"RTN","BPSOSBM",153,0)
 D LOG^BPSOSL(X)
"RTN","BPSOSBM",154,0)
 Q
"RTN","BPSOSBM",155,0)
MARKVCPT         ; 
"RTN","BPSOSBM",156,0)
 N DIE,DA,DR,DIDEL,DTOUT
"RTN","BPSOSBM",157,0)
 S DIE=9002301,DA=VCPT,DR="56////"_RXI_";56.3////"_RXR_";56.4////"_N57
"RTN","BPSOSBM",158,0)
 D ^DIE
"RTN","BPSOSBM",159,0)
 Q
"RTN","BPSOSBM",160,0)
UPDATE57     ; record in ECME data that this VCPT has been billed
"RTN","BPSOSBM",161,0)
 N DIE,DA,DR,DIDEL,DTOUT
"RTN","BPSOSBM",162,0)
 S DIE=9002313.57,DA=N57,DR="2////"_PCNDFN D ^DIE
"RTN","BPSOSBM",163,0)
 Q
"RTN","BPSOSBM",164,0)
 Q
"RTN","BPSOSBM",165,0)
UPDATE02 ;
"RTN","BPSOSBM",166,0)
 N DIE,DA,DR,DIDEL,DTOUT
"RTN","BPSOSBM",167,0)
 S DIE=9002313.02,DA=$P(^BPSTL(N57,0),U,4)
"RTN","BPSOSBM",168,0)
 Q:'DA
"RTN","BPSOSBM",169,0)
 S DR=".03////"_PCNDFN_";1.02///"_PCN_";1.03///"_VCN
"RTN","BPSOSBM",170,0)
 D ^DIE
"RTN","BPSOSBM",171,0)
 Q
"RTN","BPSOSBM",172,0)
ARTYPNUM ; determine the AR TYPE number for the current VCN
"RTN","BPSOSBM",173,0)
 N OK,PHARM
"RTN","BPSOSBM",174,0)
ART2 S OK=1
"RTN","BPSOSBM",175,0)
 D FIRSTN
"RTN","BPSOSBM",176,0)
 S PHARM=$P(^BPSTL(N,1),U,7) ; point to .56
"RTN","BPSOSBM",177,0)
 S ARTYPNUM=$P(^BPS(9002313.56,PHARM,0),U,4)
"RTN","BPSOSBM",178,0)
 I 'ARTYPNUM S ARTYPNUM=$P(^BPS(9002313.99,1,"RX A/R TYPE"),U)
"RTN","BPSOSBM",179,0)
 I 'ARTYPNUM S OK=0
"RTN","BPSOSBM",180,0)
 I 'OK G ART2:$$IMPOSS^BPSOSUE("DB","RTI","A/R TYPE missing from setup file",,"ARTYPNUM",$T(+0))
"RTN","BPSOSBM",181,0)
 Q
"RTN","BPSOSBM",182,0)
PINS ; set PINS = the right PINS node for this VCN
"RTN","BPSOSBM",183,0)
 D FIRSTN
"RTN","BPSOSBM",184,0)
 S PINS=^BPSTL(N,6)
"RTN","BPSOSBM",185,0)
 Q
"RTN","BPSOSBM",186,0)
FIRSTN ; S N=first 9002313.57 for the first VCPT for this VCN
"RTN","BPSOSBM",187,0)
 ; used by ARTYPNUM and PINS
"RTN","BPSOSBM",188,0)
 N VCPT S VCPT=$O(^TMP("BPSOSBM",$J,VCN,0))
"RTN","BPSOSBM",189,0)
 I 'VCPT D  Q  ; get first VCPT
"RTN","BPSOSBM",190,0)
 . D IMPOSS^BPSOSUE("P","TI","Incomplete ^TMP(BPSOSBM) array",,"FIRSTN",$T(+0))
"RTN","BPSOSBM",191,0)
 S N=$P(^TMP($J,"VCPT",VCPT),U) ; point to the 9002313.57 record
"RTN","BPSOSBM",192,0)
 Q
"RTN","BPSOSBM",193,0)
NULLOPEN() ; open null file, because ^ABSBMAKE echoes to screen
"RTN","BPSOSBM",194,0)
 S X=$$GET1^DIQ(9002313.99,"1,",1490)
"RTN","BPSOSBM",195,0)
 N DIR,FILE,SLASH,SLASHCH
"RTN","BPSOSBM",196,0)
 S SLASH=$S(X["/":"/",X["\":"\",1:"")
"RTN","BPSOSBM",197,0)
 I SLASH]"" D
"RTN","BPSOSBM",198,0)
 . N N S N=$L(X,SLASH)
"RTN","BPSOSBM",199,0)
 . S DIR=$P(X,SLASH,1,N-1)_SLASH
"RTN","BPSOSBM",200,0)
 . S FILE=$P(X,SLASH,N)
"RTN","BPSOSBM",201,0)
 E  D
"RTN","BPSOSBM",202,0)
 . I X="" S DIR="",FILE=$T(+0)_".tmp"
"RTN","BPSOSBM",203,0)
 . E  S DIR="",FILE=X
"RTN","BPSOSBM",204,0)
 Q '$G(POP) ; 1 success, 0 failure
"RTN","BPSOSBM",205,0)
NULLCLOS D CLOSE^%ZISH($$NULLHNDL) Q
"RTN","BPSOSBM",206,0)
NULLHNDL() Q 54
"RTN","BPSOSBP")
0^130^B803815
"RTN","BPSOSBP",1,0)
BPSOSBP ;BHAM ISC/FCS/DRS/FLS - Billing - PAC ;06/01/2004
"RTN","BPSOSBP",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSBP",3,0)
 Q
"RTN","BPSOSBP",4,0)
 ; Billing interface for PAC, Patient Accounts Component
"RTN","BPSOSBP",5,0)
 ;
"RTN","BPSOSBP",6,0)
 ; Called at tag POST from BPSOSBB
"RTN","BPSOSBP",7,0)
 ; with the variable BPS57 pointing to 9002313.57, the transaction
"RTN","BPSOSBP",8,0)
 ; You must return a value - that value is stuffed into field .15
"RTN","BPSOSBP",9,0)
 ; of the transaction record
"RTN","BPSOSBP",10,0)
 ; and indexed by ^BPSTL("AR",value,IEN57)
"RTN","BPSOSBP",11,0)
 ; 
"RTN","BPSOSBP",12,0)
 ; Many useful utilities are available in BPSOS57
"RTN","BPSOSBP",13,0)
 ; DO LOG^BPSOSL(text) puts text into the billing log file
"RTN","BPSOSBP",14,0)
 ; DO LOG57^BPSOS57(text) puts text into the claim's log file
"RTN","BPSOSBP",15,0)
 ;
"RTN","BPSOSBP",16,0)
POST ; EP - from BPSOSBB
"RTN","BPSOSBP",17,0)
 N IEN57 S IEN57=BPS57 ; now you can $$label^BPSOS57
"RTN","BPSOSBP",18,0)
 N PREV57 S PREV57=$$PREVIOUS^BPSOS57 ; if this prescrip prev posted
"RTN","BPSOSBP",19,0)
 N RESULT,RETVAL S RETVAL=""
"RTN","BPSOSBP",20,0)
 S RESULT=$$GET1^DIQ(9002313.57,BPS57_",","RESULT WITH REVERSAL")
"RTN","BPSOSBP",21,0)
 ;
"RTN","BPSOSBP",22,0)
 ; RESULT can by E PAYABLE, E REJECTED, E CAPTURED, PAPER
"RTN","BPSOSBP",23,0)
 ; or E REVERSAL ACCEPTED or PAPER REVERSAL
"RTN","BPSOSBP",24,0)
 ; or E REVERSAL REJECTED
"RTN","BPSOSBP",25,0)
 ;
"RTN","BPSOSBP",26,0)
 S RETVAL=0
"RTN","BPSOSBP",27,0)
 Q RETVAL
"RTN","BPSOSBQ")
0^131^B805565
"RTN","BPSOSBQ",1,0)
BPSOSBQ ;BHAM ISC/FCS/DRS/FLS - Billing - Other A/R ;06/01/2004
"RTN","BPSOSBQ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSBQ",3,0)
 Q
"RTN","BPSOSBQ",4,0)
 ; Billing interface for other Accounts Receivable,
"RTN","BPSOSBQ",5,0)
 ;
"RTN","BPSOSBQ",6,0)
 ; Called at tag POST from BPSOSBB
"RTN","BPSOSBQ",7,0)
 ; with the variable BPS57 pointing to 9002313.57, the transaction
"RTN","BPSOSBQ",8,0)
 ; You must return a value - that value is stuffed into field .15
"RTN","BPSOSBQ",9,0)
 ; of the transaction record
"RTN","BPSOSBQ",10,0)
 ; and indexed by ^BPSTL("AR",value,IEN57)
"RTN","BPSOSBQ",11,0)
 ; 
"RTN","BPSOSBQ",12,0)
 ; Many useful utilities are available in BPSOS57
"RTN","BPSOSBQ",13,0)
 ; DO LOG^BPSOSL(text) puts text into the billing log file
"RTN","BPSOSBQ",14,0)
 ; DO LOG57^BPSOS57(text) puts text into the claim's log file
"RTN","BPSOSBQ",15,0)
 ;
"RTN","BPSOSBQ",16,0)
POST() ; EP - from BPSOSBB
"RTN","BPSOSBQ",17,0)
 N IEN57 S IEN57=BPS57 ; now you can $$label^BPSOS57
"RTN","BPSOSBQ",18,0)
 N PREV57 S PREV57=$$PREVIOUS^BPSOS57 ; if this prescrip prev posted
"RTN","BPSOSBQ",19,0)
 N RESULT,RETVAL S RETVAL=""
"RTN","BPSOSBQ",20,0)
 S RESULT=$$GET1^DIQ(9002313.57,BPS57_",","RESULT WITH REVERSAL")
"RTN","BPSOSBQ",21,0)
 ;
"RTN","BPSOSBQ",22,0)
 ; RESULT can by E PAYABLE, E REJECTED, E CAPTURED, PAPER
"RTN","BPSOSBQ",23,0)
 ; or E REVERSAL ACCEPTED or PAPER REVERSAL
"RTN","BPSOSBQ",24,0)
 ; or E REVERSAL REJECTED
"RTN","BPSOSBQ",25,0)
 ;
"RTN","BPSOSBQ",26,0)
 S RETVAL=0
"RTN","BPSOSBQ",27,0)
 Q RETVAL
"RTN","BPSOSBT")
0^132^B822400
"RTN","BPSOSBT",1,0)
BPSOSBT ;BHAM ISC/FCS/DRS/FLS - Billing - ANMC ;06/01/2004
"RTN","BPSOSBT",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSBT",3,0)
 Q
"RTN","BPSOSBT",4,0)
 ; Billing interface for ANMC
"RTN","BPSOSBT",5,0)
 ;
"RTN","BPSOSBT",6,0)
 ; Called at tag POST from BPSOSBB
"RTN","BPSOSBT",7,0)
 ; with the variable BPS57 pointing to 9002313.57, the transaction
"RTN","BPSOSBT",8,0)
 ; You must return a value - that value is stuffed into field .15
"RTN","BPSOSBT",9,0)
 ; of the transaction record
"RTN","BPSOSBT",10,0)
 ; and indexed by ^BPSTL("AR",value,IEN57)
"RTN","BPSOSBT",11,0)
 ; 
"RTN","BPSOSBT",12,0)
 ; Many useful utilities are available in BPSOS57
"RTN","BPSOSBT",13,0)
 ; DO LOG^BPSOSL(text) puts text into the billing log file
"RTN","BPSOSBT",14,0)
 ; DO LOG57^BPSOS57(text) puts text into the claim's log file
"RTN","BPSOSBT",15,0)
 ;
"RTN","BPSOSBT",16,0)
 ;
"RTN","BPSOSBT",17,0)
POST() ; EP - from BPSOSBB
"RTN","BPSOSBT",18,0)
 N IEN57 S IEN57=BPS57 ; now you can $$label^BPSOS57
"RTN","BPSOSBT",19,0)
 N PREV57 S PREV57=$$PREVIOUS^BPSOS57 ; if this prescrip prev posted
"RTN","BPSOSBT",20,0)
 N RESULT,RETVAL S RETVAL=""
"RTN","BPSOSBT",21,0)
 S RESULT=$$GET1^DIQ(9002313.57,BPS57_",","RESULT WITH REVERSAL")
"RTN","BPSOSBT",22,0)
 ;
"RTN","BPSOSBT",23,0)
 ; RESULT can by E PAYABLE, E REJECTED, E CAPTURED, PAPER
"RTN","BPSOSBT",24,0)
 ; or E REVERSAL ACCEPTED or PAPER REVERSAL
"RTN","BPSOSBT",25,0)
 ; or E REVERSAL REJECTED
"RTN","BPSOSBT",26,0)
 ;
"RTN","BPSOSBT",27,0)
 S RETVAL=0
"RTN","BPSOSBT",28,0)
 Q RETVAL
"RTN","BPSOSBU")
1^133
"RTN","BPSOSBV")
0^134^B10892119
"RTN","BPSOSBV",1,0)
BPSOSBV ;BHAM ISC/FCS/DRS/FLS - ILC A/R billing interface ;06/01/2004
"RTN","BPSOSBV",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSBV",3,0)
 Q
"RTN","BPSOSBV",4,0)
 ;
"RTN","BPSOSBV",5,0)
VCPT() ;EP - from BPSOSQB
"RTN","BPSOSBV",6,0)
 ; create new VCPT entry based on ^BPSTL(IEN57,...)
"RTN","BPSOSBV",7,0)
 ; First, lookup in charge file, possibly having to create a new entry
"RTN","BPSOSBV",8,0)
 N CPTIEN S CPTIEN=$$CPTIEN^BPSOS57
"RTN","BPSOSBV",9,0)
 I 'CPTIEN S CPTIEN=$$NEWCPT I 'CPTIEN Q ""
"RTN","BPSOSBV",10,0)
 ; Now that it exists in the charge file, you can create VCPT
"RTN","BPSOSBV",11,0)
 N VCPTIEN,FDA,IEN,MSG,FN,PLUS1 S FN=9002301,PLUS1="+1,"
"RTN","BPSOSBV",12,0)
 ; The .01 field points to the charge file
"RTN","BPSOSBV",13,0)
 S FDA(FN,PLUS1,.01)=CPTIEN
"RTN","BPSOSBV",14,0)
 ;
"RTN","BPSOSBV",15,0)
 ; FDA setup specific to the type of charge:
"RTN","BPSOSBV",16,0)
 ;
"RTN","BPSOSBV",17,0)
 I $$TYPE=1!($$TYPE=2) D  ; prescription or postage, either one
"RTN","BPSOSBV",18,0)
 . S FDA(FN,PLUS1,1.5)=$$FILLDATE^BPSOS57
"RTN","BPSOSBV",19,0)
 . ; VCPT, (#58) DATE OF SERVICE - take fill date, not the visit date.
"RTN","BPSOSBV",20,0)
 . ; ex. Mt. Edgecumbe, presc. `341641 has PCC link to a 1990 visit
"RTN","BPSOSBV",21,0)
 . ;  but a May, 2000 fill date
"RTN","BPSOSBV",22,0)
 . S FDA(FN,PLUS1,58)=FDA(FN,PLUS1,1.5) ; DATE OF SERVICE, same
"RTN","BPSOSBV",23,0)
 . I $D(^DD(FN,74)) D  ; Sitka didn't have this field on 06/21/2000
"RTN","BPSOSBV",24,0)
 . . S FDA(FN,PLUS1,74)=$$PROVIDER^BPSOS57
"RTN","BPSOSBV",25,0)
 . S FDA(FN,PLUS1,56)=$$RXI^BPSOS57
"RTN","BPSOSBV",26,0)
 . S FDA(FN,PLUS1,56.2)=$$VMED^BPSOS57
"RTN","BPSOSBV",27,0)
 . S FDA(FN,PLUS1,56.3)=$$RXR^BPSOS57
"RTN","BPSOSBV",28,0)
 E  I $$TYPE=3 D
"RTN","BPSOSBV",29,0)
 . S FDA(FN,PLUS1,58)=$$FILLDATE^BPSOS57
"RTN","BPSOSBV",30,0)
 ;
"RTN","BPSOSBV",31,0)
 ; FDA setup regardless of type of charge
"RTN","BPSOSBV",32,0)
 ;
"RTN","BPSOSBV",33,0)
 S FDA(FN,PLUS1,.02)=$$PATIENT^BPSOS57
"RTN","BPSOSBV",34,0)
 S FDA(FN,PLUS1,.03)=$$VISITIEN^BPSOS57
"RTN","BPSOSBV",35,0)
 S FDA(FN,PLUS1,2)=$$CHG^BPSOS57
"RTN","BPSOSBV",36,0)
 S FDA(FN,PLUS1,4)=$$USER^BPSOS57
"RTN","BPSOSBV",37,0)
 S FDA(FN,PLUS1,4.5)=$$NOW^BPSOS57
"RTN","BPSOSBV",38,0)
 S FDA(FN,PLUS1,52)=$$VCN^BPSOS57
"RTN","BPSOSBV",39,0)
 S FDA(FN,PLUS1,53)=$$QTY^BPSOS57
"RTN","BPSOSBV",40,0)
 ;
"RTN","BPSOSBV",41,0)
 D UPDATE^DIE("S","FDA","IEN","MSG")
"RTN","BPSOSBV",42,0)
 I $D(MSG) D
"RTN","BPSOSBV",43,0)
 . D LOG^BPSOSL("Failed to create VCPT entry!")
"RTN","BPSOSBV",44,0)
 . D LOGARRAY("FDA"),LOGARRAY("IEN"),LOGARRAY("MSG")
"RTN","BPSOSBV",45,0)
 Q $G(IEN(1))
"RTN","BPSOSBV",46,0)
LOGARRAY(X) D LOGARRAY^BPSOSL(X) Q
"RTN","BPSOSBV",47,0)
NEWCPT() ; create new CPT entry based on ^BPSTL(IEN57,...)
"RTN","BPSOSBV",48,0)
 N FDA,MSG,FN,PLUS1 S FN=9002300,PLUS1="+1,"
"RTN","BPSOSBV",49,0)
 D LOG^BPSOSL("Creating new CPT code for IEN57="_IEN57)
"RTN","BPSOSBV",50,0)
 I $$TYPE=1 D
"RTN","BPSOSBV",51,0)
 . S FDA(FN,PLUS1,.01)=$$NDC^BPSOS57 ; CODE
"RTN","BPSOSBV",52,0)
 . S FDA(FN,PLUS1,1)=$$DRGNAME^BPSOS57 ; SHORT DESCRIPTION
"RTN","BPSOSBV",53,0)
 . S FDA(FN,PLUS1,2)=$$DRGNAME^BPSOS57 ; LONG DESCRIPTION
"RTN","BPSOSBV",54,0)
 . S FDA(FN,PLUS1,4)=$P($G(^BPSTL(IEN57,5)),U,2) ; RATE
"RTN","BPSOSBV",55,0)
 . S FDA(FN,PLUS1,101)=$$DRGDFN^BPSOS57 ; DRUG FILE POINTER
"RTN","BPSOSBV",56,0)
 . S FDA(FN,PLUS1,102)=$$NDC^BPSOS57 ; NDC #
"RTN","BPSOSBV",57,0)
 E  I $$TYPE=2 D
"RTN","BPSOSBV",58,0)
 . D IMPOSS^BPSOSUE("P","TI","New charge file entry for postage items not yet implemented",,"NEWCPT",$T(+0))
"RTN","BPSOSBV",59,0)
 E  I $$TYPE=3 D
"RTN","BPSOSBV",60,0)
 . D IMPOSS^BPSOSUE("P","TI","New charge file entry for supply items not yet implemented",,"NEWCPT",$T(+0))
"RTN","BPSOSBV",61,0)
 E  D IMPOSS^BPSOSUE("P","TI","Unaccounted-for $$TYPE="_$$TYPE,,"NEWCPT",$T(+0))
"RTN","BPSOSBV",62,0)
NEW8 D UPDATE^DIE("S","FDA","IEN","MSG")
"RTN","BPSOSBV",63,0)
 I $D(MSG) D  G NEW8:$$IMPOSS^BPSOSUE("FM","TRI","UPDATE^DIE failed",.MSG,"NEWCPT",$T(+0))
"RTN","BPSOSBV",64,0)
 . D LOG^BPSOSL("Failed to create a new CPT code!")
"RTN","BPSOSBV",65,0)
 . D LOGARRAY("FDA"),LOGARRAY("IEN"),LOGARRAY("MSG")
"RTN","BPSOSBV",66,0)
 Q $G(IEN(1))
"RTN","BPSOSBV",67,0)
TYPE() Q $$TYPE^BPSOS57 ; and it traps out-of-range values
"RTN","BPSOSBW")
0^135^B19251447
"RTN","BPSOSBW",1,0)
BPSOSBW ;BHAM ISC/FCS/DRS/FLS - Billing - FSI/ILC A/R v1,2 ;06/01/2004
"RTN","BPSOSBW",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSBW",3,0)
 Q
"RTN","BPSOSBW",4,0)
 ; Billing interface for FSI/ILC Accounts Receivable,
"RTN","BPSOSBW",5,0)
 ; Versions 1 and 2
"RTN","BPSOSBW",6,0)
 ;
"RTN","BPSOSBW",7,0)
 ; Called at tag POST from BPSOSBB
"RTN","BPSOSBW",8,0)
 ; with the variable BPS57 pointing to 9002313.57, the transaction
"RTN","BPSOSBW",9,0)
 ; You must return a value - that value is stuffed into field .15
"RTN","BPSOSBW",10,0)
 ; of the transaction record
"RTN","BPSOSBW",11,0)
 ; and indexed by ^BPSTL("AR",value,IEN57)
"RTN","BPSOSBW",12,0)
 ;
"RTN","BPSOSBW",13,0)
 ; Many useful utilities are available in BPSOS57
"RTN","BPSOSBW",14,0)
 ; need to write
"RTN","BPSOSBW",15,0)
 ;     DO LOG57^BPSOS57(text) puts text into the claim's log file
"RTN","BPSOSBW",16,0)
 ; 
"RTN","BPSOSBW",17,0)
 ; Note about this billing interface and interlocks:
"RTN","BPSOSBW",18,0)
 ;    We have another background job to actually post charges.
"RTN","BPSOSBW",19,0)
 ;    A job is scheduled for each visit - to run BPSOSBX.
"RTN","BPSOSBW",20,0)
 ;    That posting job uses the same interlock as the main
"RTN","BPSOSBW",21,0)
 ;    background billing.  So you can freely use the "AR" index
"RTN","BPSOSBW",22,0)
 ;    and everything else.
"RTN","BPSOSBW",23,0)
 ;
"RTN","BPSOSBW",24,0)
POST() ; EP - from BPSOSBB
"RTN","BPSOSBW",25,0)
 N IEN57 S IEN57=BPS57 ; now you can $$label^BPSOS57
"RTN","BPSOSBW",26,0)
 N PREV57 D
"RTN","BPSOSBW",27,0)
 . S X=$P(^BPSTL(IEN57,0),U) ; 1234567.000rt
"RTN","BPSOSBW",28,0)
 . S PREV57=$O(^BPSTL("B",X,IEN57),-1)
"RTN","BPSOSBW",29,0)
 N RESULT,RETVAL S RETVAL=""
"RTN","BPSOSBW",30,0)
 S RESULT=$$GET1^DIQ(9002313.57,BPS57_",","RESULT WITH REVERSAL")
"RTN","BPSOSBW",31,0)
 ;
"RTN","BPSOSBW",32,0)
 ; RESULT can by E PAYABLE, E REJECTED, E CAPTURED, PAPER
"RTN","BPSOSBW",33,0)
 ; or E REVERSAL ACCEPTED or PAPER REVERSAL
"RTN","BPSOSBW",34,0)
 ; or E REVERSAL REJECTED
"RTN","BPSOSBW",35,0)
 ;
"RTN","BPSOSBW",36,0)
 N VISITIEN S VISITIEN=$$VISITIEN^BPSOS57
"RTN","BPSOSBW",37,0)
 ;
"RTN","BPSOSBW",38,0)
 ; We want to group all the claims for a single visit and
"RTN","BPSOSBW",39,0)
 ; then post them together on a single bill (well, more bills if
"RTN","BPSOSBW",40,0)
 ; some of the claims have different insurers.  One per insurer.)
"RTN","BPSOSBW",41,0)
 ;
"RTN","BPSOSBW",42,0)
 ; So for this phase, we simply schedule a billing job for the visit
"RTN","BPSOSBW",43,0)
 ; for some time from now (30 minutes?).  At that time, we check to
"RTN","BPSOSBW",44,0)
 ; see if all the collected charges for the visit are at least
"RTN","BPSOSBW",45,0)
 ; (15 minutes?) old.  If so, we post.  If not, we reschedule for later.
"RTN","BPSOSBW",46,0)
 ;
"RTN","BPSOSBW",47,0)
 ; But reversals, we handle those right now:
"RTN","BPSOSBW",48,0)
 ; The original charge might not yet be posted!  It could still be
"RTN","BPSOSBW",49,0)
 ;    in ^BPSOS("AR",KEY15, waiting.
"RTN","BPSOSBW",50,0)
 ;
"RTN","BPSOSBW",51,0)
 I RESULT["REVERSAL" D
"RTN","BPSOSBW",52,0)
 . D REVERSAL ; IEN57 is a reversal
"RTN","BPSOSBW",53,0)
 E  D  ; it's a charge to be posted
"RTN","BPSOSBW",54,0)
 . S RETVAL=$$KEY15 ; make sure posting job is scheduled
"RTN","BPSOSBW",55,0)
 Q RETVAL  ; caller stuffs this into 9002313.57 field #.15 for us
"RTN","BPSOSBW",56,0)
 ;
"RTN","BPSOSBW",57,0)
 ;
"RTN","BPSOSBW",58,0)
 ;
"RTN","BPSOSBW",59,0)
 ; ^BPSTL("AR",key,ien57)
"RTN","BPSOSBW",60,0)
 ; What to use for the key?
"RTN","BPSOSBW",61,0)
 ; For claims awaiting posting,
"RTN","BPSOSBW",62,0)
 ;   visitien/insien/time scheduled to post
"RTN","BPSOSBW",63,0)
 ; For claims already posted:
"RTN","BPSOSBW",64,0)
 ;   "" (so it disappears from the index)
"RTN","BPSOSBW",65,0)
 ;   or ?1N.N (another pointer to where it was posted
"RTN","BPSOSBW",66,0)
 ;
"RTN","BPSOSBW",67,0)
 ; So to get the vis/ins/time ones, 
"RTN","BPSOSBW",68,0)
 ;   $O(^BPSTL("AR"," "))
"RTN","BPSOSBW",69,0)
 ;
"RTN","BPSOSBW",70,0)
KEY15() N X,Y S X=$$VISITIEN^BPSOS57_"/"_$$INSIEN^BPSOS57_"/"
"RTN","BPSOSBW",71,0)
 S Y=$O(^BPSTL("AR",X))
"RTN","BPSOSBW",72,0)
 I $P(Y,"/",1,2)=$P(X,"/",1,2) D  ; posting already scheduled
"RTN","BPSOSBW",73,0)
 . S $P(X,"/",3)=$P(Y,"/",3) ; so take the same posting time
"RTN","BPSOSBW",74,0)
 E  D  ; posting not yet scheduled for this visit+insurer
"RTN","BPSOSBW",75,0)
 . S $P(X,"/",3)=$$TADDNOWS^BPSOSUD($$DELAY1)
"RTN","BPSOSBW",76,0)
 . D SCHED(X)
"RTN","BPSOSBW",77,0)
 Q X
"RTN","BPSOSBW",78,0)
SCHED(KEY15) ; schedule posting job for transaction as directed by X
"RTN","BPSOSBW",79,0)
 ; X = format of $$KEY15, above
"RTN","BPSOSBW",80,0)
 S KEY15=$P(KEY15,"/",1,3)
"RTN","BPSOSBW",81,0)
 N ZTDTH,ZTSAVE,ZTIO
"RTN","BPSOSBW",82,0)
 S ZTDTH=$P(KEY15,"/",3)
"RTN","BPSOSBW",83,0)
 S ZTRTN="EN^BPSOSBX",ZTIO="",ZTSAVE("KEY15")=""
"RTN","BPSOSBW",84,0)
 D ^%ZTLOAD
"RTN","BPSOSBW",85,0)
 Q
"RTN","BPSOSBW",86,0)
REVERSAL ; IEN57 is a reversal - handle it and set RETVAL
"RTN","BPSOSBW",87,0)
 S RETVAL="" ; until we say otherwise
"RTN","BPSOSBW",88,0)
 D LOG("Transaction "_IEN57_" is a reversal; previous transaction was "_PREV57_".")
"RTN","BPSOSBW",89,0)
 I 'PREV57 D  Q
"RTN","BPSOSBW",90,0)
 . D LOG("  ??No record of any previous charge.  Nothing done.")
"RTN","BPSOSBW",91,0)
 ;
"RTN","BPSOSBW",92,0)
 ; Find where the previous charge was posted.
"RTN","BPSOSBW",93,0)
 ;
"RTN","BPSOSBW",94,0)
 N PCNDFN S PCNDFN=$P(^BPSTL(PREV57,0),U,3)
"RTN","BPSOSBW",95,0)
 ;
"RTN","BPSOSBW",96,0)
 ; Perhaps it wasn't posted yet.  This would be typical if the 
"RTN","BPSOSBW",97,0)
 ; reversal is made immediately after the original charge is posted.
"RTN","BPSOSBW",98,0)
 ; The original charge is probably in Taskman now waiting for other
"RTN","BPSOSBW",99,0)
 ; charges that might come along for the same visit.  At that time,
"RTN","BPSOSBW",100,0)
 ; the reversal will be detected and posting of charge will be skipped.
"RTN","BPSOSBW",101,0)
 ;
"RTN","BPSOSBW",102,0)
 I 'PCNDFN D  Q  ; it wasn't posted the first time around
"RTN","BPSOSBW",103,0)
 . D LOG^BPSOSL("Original charge not posted; no adjustment needed.")
"RTN","BPSOSBW",104,0)
 ;
"RTN","BPSOSBW",105,0)
 ; The original charge was posted, to PCNDFN.
"RTN","BPSOSBW",106,0)
 ; Put an adjustment and make a comment on the account.
"RTN","BPSOSBW",107,0)
 ;
"RTN","BPSOSBW",108,0)
 N WHEN S WHEN=$$GET1^DIQ(9002313.57,IEN57_",",7,"I")_"0000"
"RTN","BPSOSBW",109,0)
 S WHEN=$E(WHEN,4,5)_"/"_$E(WHEN,6,7)_"/"_$E(WHEN,2,3)
"RTN","BPSOSBW",110,0)
 S WHEN=WHEN_"@"_$E(WHEN,9,10)_":"_$E(WHEN,11,12)
"RTN","BPSOSBW",111,0)
 ;
"RTN","BPSOSBW",112,0)
 ; if failed reversal, make a comment
"RTN","BPSOSBW",113,0)
 ;
"RTN","BPSOSBW",114,0)
 I RESULT'="E REVERSAL ACCEPTED",RESULT'="PAPER REVERSAL" D  Q
"RTN","BPSOSBW",115,0)
 . N RETVAL S RETVAL=$$COMMENT^BPSOSBF(PCNDFN,"CLAIM REVERSED on "_WHEN)
"RTN","BPSOSBW",116,0)
 . D LOG^BPSOSL("Comment made on `"_PCNDFN_" for "_RESULT)
"RTN","BPSOSBW",117,0)
 ;
"RTN","BPSOSBW",118,0)
 ; if successful reversal, write off the old charge
"RTN","BPSOSBW",119,0)
 ;
"RTN","BPSOSBW",120,0)
 N AMTOLD S AMTOLD=$P(^BPSTL(PREV57,5),U,5) ; original charge amount
"RTN","BPSOSBW",121,0)
 N REASON S REASON=RESULT_" on "_WHEN
"RTN","BPSOSBW",122,0)
 D ADJUST^BPSOSBX(PCNDFN,AMTOLD,REASON)
"RTN","BPSOSBW",123,0)
 N FDA,MSG ; mark transaction as having been posted to A/R.
"RTN","BPSOSBW",124,0)
 S FDA(9002313.57,IEN57_",",2)=PCNDFN
"RTN","BPSOSBW",125,0)
 S FDA(9002313.57,IEN57_",",.15)=PCNDFN
"RTN","BPSOSBW",126,0)
R88 D FILE^DIE(,"FDA","MSG")
"RTN","BPSOSBW",127,0)
 I $D(MSG) D  G R88:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",.MSG,"REVERSAL",$T(+0))
"RTN","BPSOSBW",128,0)
 . D LOGARRAY^BPSOSL("FDA")
"RTN","BPSOSBW",129,0)
 . D LOGARRAY^BPSOSL("MSG")
"RTN","BPSOSBW",130,0)
 Q
"RTN","BPSOSBW",131,0)
 ;
"RTN","BPSOSBW",132,0)
 ;
"RTN","BPSOSBW",133,0)
DELAY1() Q 30*60 ; how many seconds to wait before posting
"RTN","BPSOSBW",134,0)
DELAY2() ;EP -
"RTN","BPSOSBW",135,0)
 Q $$DELAY1/2 ; how many seconds quiet time before it's safe to post
"RTN","BPSOSBW",136,0)
 ;  (that is, if any additional charges in the past xxx time,
"RTN","BPSOSBW",137,0)
 ;   reschedule the posting for later)
"RTN","BPSOSBW",138,0)
LOG(X) D LOG^BPSOSL(X) Q
"RTN","BPSOSBX")
0^136^B29743000
"RTN","BPSOSBX",1,0)
BPSOSBX ;BHAM ISC/FCS/DRS/FLS - Billing - FSI/ILC A/R v1,2 ;06/01/2004
"RTN","BPSOSBX",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSBX",3,0)
 Q
"RTN","BPSOSBX",4,0)
ENABLED() Q 1
"RTN","BPSOSBX",5,0)
EN ; Taskman routine begins here
"RTN","BPSOSBX",6,0)
 ; with KEY15=visit/insurer/time sched for
"RTN","BPSOSBX",7,0)
 ; Does posting for just this one visit and insurer
"RTN","BPSOSBX",8,0)
 ;
"RTN","BPSOSBX",9,0)
 ; ^BPSTL("AR",KEY15,IEN57)="" is defined for one or more IEN57's
"RTN","BPSOSBX",10,0)
 ;  These are all charges.
"RTN","BPSOSBX",11,0)
 ;  None are reversals - the reversals were dealt with in BPSOSBW.
"RTN","BPSOSBX",12,0)
 ;  But some of these charges may already have reversals outstanding!
"RTN","BPSOSBX",13,0)
 ;
"RTN","BPSOSBX",14,0)
 N PCNDFN
"RTN","BPSOSBX",15,0)
 ;
"RTN","BPSOSBX",16,0)
 ; Same interlock as other billing
"RTN","BPSOSBX",17,0)
 ; Unlock happens implicitly when Taskman job stops
"RTN","BPSOSBX",18,0)
 ;
"RTN","BPSOSBX",19,0)
 I '$$LOCK^BPSOSBD D RESCHED(5*60) Q  ; 5 minutes later
"RTN","BPSOSBX",20,0)
 D INIT^BPSOSL(DT+.2,1) ; same log file
"RTN","BPSOSBX",21,0)
 ;
"RTN","BPSOSBX",22,0)
 ; If posting is turned off, then reschedule this to run much later.
"RTN","BPSOSBX",23,0)
 ;
"RTN","BPSOSBX",24,0)
 I '$$ENABLED D RESCHED(3*60*60) Q  ; 3 hours later
"RTN","BPSOSBX",25,0)
 ;
"RTN","BPSOSBX",26,0)
 ; Gather all the IEN57's with the same visit/insurer as KEY15 has
"RTN","BPSOSBX",27,0)
 ; Put them into CHGLIST(IEN57)=""
"RTN","BPSOSBX",28,0)
 ; But for those which were reversed, put them into REVLIST(IEN57) 
"RTN","BPSOSBX",29,0)
 ;
"RTN","BPSOSBX",30,0)
 N CHGLIST,REVLIST D
"RTN","BPSOSBX",31,0)
 . N X S X=$P(KEY15,"/",1,2)
"RTN","BPSOSBX",32,0)
 . F  S X=$O(^BPSTL("AR",X)) Q:$P(X,"/",1,2)'=$P(KEY15,"/",1,2)  D
"RTN","BPSOSBX",33,0)
 . . N IEN57 S IEN57=0
"RTN","BPSOSBX",34,0)
 . . F  S IEN57=$O(^BPSTL("AR",X,IEN57)) Q:'IEN57  D
"RTN","BPSOSBX",35,0)
 . . . S @$$LIST57@(IEN57)=""
"RTN","BPSOSBX",36,0)
 ;
"RTN","BPSOSBX",37,0)
 ; If charges for the visit/insurer are still coming in,
"RTN","BPSOSBX",38,0)
 ;  then reschedule this to run later.
"RTN","BPSOSBX",39,0)
 ; (DT test is to facilitate testing on the date shown)
"RTN","BPSOSBX",40,0)
 ;
"RTN","BPSOSBX",41,0)
 I DT>3010327,'$$SETTLED D  Q
"RTN","BPSOSBX",42,0)
 . D RESCHED($$DELAY2^BPSOSBW)
"RTN","BPSOSBX",43,0)
 . D LOG(KEY15_" still busy; billing rescheduled for later")
"RTN","BPSOSBX",44,0)
 ;
"RTN","BPSOSBX",45,0)
 ; Post everything in CHGLIST(IEN57)=""
"RTN","BPSOSBX",46,0)
 ; except those which have been reversed
"RTN","BPSOSBX",47,0)
 ;
"RTN","BPSOSBX",48,0)
 I $D(CHGLIST) D
"RTN","BPSOSBX",49,0)
 . S PCNDFN=$$CHGLIST^BPSOSBM ; 03/26/2001
"RTN","BPSOSBX",50,0)
 ;
"RTN","BPSOSBX",51,0)
 ; If any of these charges had been posted before,
"RTN","BPSOSBX",52,0)
 ; adjust off the old charges.  (Should not happen any more, since
"RTN","BPSOSBX",53,0)
 ; we enforce a reverse-first-then-resubmit policy, even for paper.)
"RTN","BPSOSBX",54,0)
 ;
"RTN","BPSOSBX",55,0)
 D REBILLED
"RTN","BPSOSBX",56,0)
 ;
"RTN","BPSOSBX",57,0)
 ; Clear the KEY15 values (thus removing these charges
"RTN","BPSOSBX",58,0)
 ;  from the ^BPSTL("AR",key15,ien57) index)
"RTN","BPSOSBX",59,0)
 ; and Mark each of these as having been posted to ILC A/R.
"RTN","BPSOSBX",60,0)
 ;
"RTN","BPSOSBX",61,0)
 D
"RTN","BPSOSBX",62,0)
 . I '$G(PCNDFN) N PCNDFN S PCNDFN="not posted"
"RTN","BPSOSBX",63,0)
 . N FDA,MSG
"RTN","BPSOSBX",64,0)
 . S IEN57=0 F  S IEN57=$O(CHGLIST(IEN57)) Q:'IEN57  D
"RTN","BPSOSBX",65,0)
 . . S FDA(9002313.57,IEN57_",",2)=PCNDFN
"RTN","BPSOSBX",66,0)
 . . S FDA(9002313.57,IEN57_",",.15)=PCNDFN
"RTN","BPSOSBX",67,0)
 . S IEN57=0 F  S IEN57=$O(REVLIST(IEN57)) Q:'IEN57  D
"RTN","BPSOSBX",68,0)
 . . S FDA(9002313.57,IEN57_",",.15)=PCNDFN
"RTN","BPSOSBX",69,0)
 . . D LOG^BPSOSL("Transaction "_IEN57_" was already reversed; we did not post it.")
"RTN","BPSOSBX",70,0)
F . I $D(FDA) D FILE^DIE("","FDA","MSG")
"RTN","BPSOSBX",71,0)
 . I $D(MSG) D  G F:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",.MSG,,$T(+0))
"RTN","BPSOSBX",72,0)
 . . D LOG^BPSOSL("Failed - trying to store in fields .15 and 2")
"RTN","BPSOSBX",73,0)
 . . D LOGARRAY^BPSOSL("FDA")
"RTN","BPSOSBX",74,0)
 . . D LOGARRAY^BPSOSL("MSG")
"RTN","BPSOSBX",75,0)
 ;
"RTN","BPSOSBX",76,0)
 ;
"RTN","BPSOSBX",77,0)
 D DONE^BPSOSL ; done with log file
"RTN","BPSOSBX",78,0)
 D UNLOCK^BPSOSBD ; release billing interlock
"RTN","BPSOSBX",79,0)
 Q
"RTN","BPSOSBX",80,0)
LIST57() ; given IEN57 ; return "CHGLIST" or "REVLIST"
"RTN","BPSOSBX",81,0)
 ; "CHGLIST" - this is a charge which should be posted to a/r
"RTN","BPSOSBX",82,0)
 ; "REVLIST" - this charge was subsequently reversed; do not post it
"RTN","BPSOSBX",83,0)
 N X S X=$P(^BPSTL(IEN57,0),U) ; RXIRXR
"RTN","BPSOSBX",84,0)
 I '$O(^BPSTL("B",X,IEN57)) Q "CHGLIST" ; no subsequent transactions
"RTN","BPSOSBX",85,0)
 N NXT57 S NXT57=$O(^BPSTL("B",X,IEN57))
"RTN","BPSOSBX",86,0)
 S X=$$GET1^DIQ(9002313.57,NXT57_",","RESULT WITH REVERSAL")
"RTN","BPSOSBX",87,0)
 I X="E REVERSAL ACCEPTED" Q "REVLIST"
"RTN","BPSOSBX",88,0)
 E  I X="PAPER REVERSAL" Q "REVLIST"
"RTN","BPSOSBX",89,0)
 E  Q "CHGLIST"
"RTN","BPSOSBX",90,0)
REBILLED ; if anything in CHGLIST() was previously posted to A/R,
"RTN","BPSOSBX",91,0)
 ; write off the old charges and make comments on both old and new bills
"RTN","BPSOSBX",92,0)
 S IEN57=0 F  S IEN57=$O(CHGLIST(IEN57)) Q:'IEN57  D
"RTN","BPSOSBX",93,0)
 . N OLD57,OLDPCNI,OLDPCNE,OLDAMT ; internal, external id's of the old bill
"RTN","BPSOSBX",94,0)
 . S OLD57=$$PREVIOUS^BPSOS57(IEN57) Q:'OLD57
"RTN","BPSOSBX",95,0)
 . S OLDPCNI=$P(^BPSTL(OLD57,0),U,3) Q:'OLDPCNI
"RTN","BPSOSBX",96,0)
 . S OLDAMT=$P(^BPSTL(OLD57,5),U,5)
"RTN","BPSOSBX",97,0)
 . ; comment on old bill to say "rebilled"
"RTN","BPSOSBX",98,0)
 . N NEWPCNI,NEWPCNE
"RTN","BPSOSBX",99,0)
 . N DRUG S DRUG=$$DRGNAME^BPSOS57
"RTN","BPSOSBX",100,0)
 . D ADJUST(OLDPCNI,OLDAMT,"Rebilled "_DRUG_" on "_NEWPCNE)
"RTN","BPSOSBX",101,0)
 . N RETVAL S RETVAL=$$COMMENT^BPSOSBF(NEWPCNI,"Rebilling of "_DRUG_" from "_OLDPCNE)
"RTN","BPSOSBX",102,0)
 Q
"RTN","BPSOSBX",103,0)
ADJUST(PCNDFN,AMTOLD,REASON) ; EP - used by reversals handling in BPSOSBW
"RTN","BPSOSBX",104,0)
 N BATCH S BATCH=$$ADJBATCH
"RTN","BPSOSBX",105,0)
 ; Do we need to release this batch?
"RTN","BPSOSBX",106,0)
 I $$NEEDREL D:BATCH'=0  ; batch old enough to need to be released
"RTN","BPSOSBX",107,0)
 . ;No, don't actually release the batch here.
"RTN","BPSOSBX",108,0)
 . ;Let someone do it from the A/R Menu.
"RTN","BPSOSBX",109,0)
 . S BATCH=0 ; force a new one to be created
"RTN","BPSOSBX",110,0)
 ; Do we need a new batch?
"RTN","BPSOSBX",111,0)
AB I 'BATCH D
"RTN","BPSOSBX",112,0)
 . S BATCH=$$NEWBATCH^BPSOSP(0)
"RTN","BPSOSBX",113,0)
 . D LOG^BPSOSL("Opened new adjustments batch "_BATCH)
"RTN","BPSOSBX",114,0)
 . D SET235(5,BATCH)
"RTN","BPSOSBX",115,0)
 I 'BATCH G AB:$$IMPOSS^BPSOSUE("P,DB,FM,L","TRI","Failed to obtain a new batch",,"ADJUST",$T(+0))
"RTN","BPSOSBX",116,0)
 D ADJUST^BPSOSP(PCNDFN,BATCH,AMTOLD,REASON)
"RTN","BPSOSBX",117,0)
 D LOG^BPSOSL("Adjustment recorded in payments batch "_BATCH)
"RTN","BPSOSBX",118,0)
 D SET235(6,DT) ; record the date we last used this batch
"RTN","BPSOSBX",119,0)
 Q
"RTN","BPSOSBX",120,0)
NEEDREL() Q:'BATCH 0 ; no batch on record
"RTN","BPSOSBX",121,0)
 N X1,X2,X,%Y S X1=DT,X2=$$BLASTDT D ^%DTC
"RTN","BPSOSBX",122,0)
 Q X>$$BLIFE ; 1 if it's older than that, 0 if not older
"RTN","BPSOSBX",123,0)
ADJBATCH() N B S B=$P($$GET235,U,5) Q:'B B ; batch # of last adjustments batch
"RTN","BPSOSBX",124,0)
 Q 0
"RTN","BPSOSBX",125,0)
BLASTDT() Q $P($$GET235,U,6) ; date we last made an entry in it
"RTN","BPSOSBX",126,0)
BLIFE() Q $P($$GET235,U,7) ; how many days a batch is good for
"RTN","BPSOSBX",127,0)
GET235() Q $G(^BPS(9002313.99,1,"BILLING - NEW"))
"RTN","BPSOSBX",128,0)
SET235(PIECE,VALUE) S $P(^BPS(9002313.99,1,"BILLING - NEW"),U,PIECE)=VALUE Q
"RTN","BPSOSBX",129,0)
SETTLED() ; has the flow of new charges for this KEY15 settled?
"RTN","BPSOSBX",130,0)
 ; yes, if all of them are at least $$DELAY2^BPSOSBW seconds old
"RTN","BPSOSBX",131,0)
 N RET S RET=1 ; assume yes
"RTN","BPSOSBX",132,0)
 N IEN57 S IEN57=0
"RTN","BPSOSBX",133,0)
 F  S IEN57=$O(^BPSTL("AR",KEY15,IEN57)) Q:'IEN57  D  Q:'RET
"RTN","BPSOSBX",134,0)
 . N T1 S T1=$P(^BPSTL(IEN57,0),U,8) ; LAST UPDATE
"RTN","BPSOSBX",135,0)
 . N DIF S DIF=$$TIMEDIFI^BPSOSUD(T1,$$NOW^BPSOS) ; how old?
"RTN","BPSOSBX",136,0)
 . I DIF<$$DELAY2^BPSOSBW S RET=0
"RTN","BPSOSBX",137,0)
 Q RET
"RTN","BPSOSBX",138,0)
RESCHED(DELTA) ;
"RTN","BPSOSBX",139,0)
 N ZTDTH,ZTIO,ZTSAVE,ZTRTN
"RTN","BPSOSBX",140,0)
 S ZTDTH=$$TADDNOWS^BPSOSUD(DELTA)
"RTN","BPSOSBX",141,0)
 S ZTIO="",ZTSAVE("KEY15")=""
"RTN","BPSOSBX",142,0)
 S ZTRTN="EN^BPSOSBX"
"RTN","BPSOSBX",143,0)
 D ^%ZTLOAD
"RTN","BPSOSBX",144,0)
 Q
"RTN","BPSOSBX",145,0)
LOG(X) D LOG^BPSOSL(X) Q
"RTN","BPSOSBX",146,0)
LOGCLAIM(X) D LOG59^BPSOS57(X) Q
"RTN","BPSOSC1")
1^137
"RTN","BPSOSC2")
0^138^B42069797
"RTN","BPSOSC2",1,0)
BPSOSC2 ;BHAM ISC/FCS/DRS - certification testing ;06/01/2004
"RTN","BPSOSC2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSC2",3,0)
 ; see remarks in BPSOSC1 too
"RTN","BPSOSC2",4,0)
 Q
"RTN","BPSOSC2",5,0)
 ; ^BPS(9002313.31, has data for test claims
"RTN","BPSOSC2",6,0)
 ; Now construct packets
"RTN","BPSOSC2",7,0)
ALL ; Construct packets for all entries in 9002313.31
"RTN","BPSOSC2",8,0)
 D IMPOSS^BPSOSUE("P","TI","Development utility - incomplete",,"ALL",$T(+0))
"RTN","BPSOSC2",9,0)
 Q
"RTN","BPSOSC2",10,0)
 ;
"RTN","BPSOSC2",11,0)
TEST(ENTRY)       ;
"RTN","BPSOSC2",12,0)
 K BPS
"RTN","BPSOSC2",13,0)
 S:'$D(ZREVERSE) ZREVERSE=0
"RTN","BPSOSC2",14,0)
 S BPS51=1
"RTN","BPSOSC2",15,0)
 S VARX=0 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1
"RTN","BPSOSC2",16,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S CERTIFY=1
"RTN","BPSOSC2",17,0)
 W "Testing in ",$T(+0),!
"RTN","BPSOSC2",18,0)
 I 'VARX I '$P(^BPS(9002313.31,ENTRY,0),U,4) D  Q
"RTN","BPSOSC2",19,0)
 . W "Field .04 in 9002313.31 needs to have pointer to insurer.",!
"RTN","BPSOSC2",20,0)
 N DIALOUT S DIALOUT=$$DIALOUT
"RTN","BPSOSC2",21,0)
 N X S X=$$PACKET(ENTRY,DIALOUT,2) ; ^TMP($J gets copy of BPS() data
"RTN","BPSOSC2",22,0)
 W "Input: 9002313.31 entry `",ENTRY,!
"RTN","BPSOSC2",23,0)
 W "Output: 9002313.02 entry `",X,!
"RTN","BPSOSC2",24,0)
 W !,"To send this claim, DO SEND^BPSOSC2(",ENTRY,")",!
"RTN","BPSOSC2",25,0)
 Q
"RTN","BPSOSC2",26,0)
REVERSAL(ENTRY,N)    ; construct the reversal packet for this 9002313.31 entry
"RTN","BPSOSC2",27,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S CERTIFY=1
"RTN","BPSOSC2",28,0)
 K BPS
"RTN","BPSOSC2",29,0)
 S ZREVERSE=1
"RTN","BPSOSC2",30,0)
 D LOG^BPSOSL("Reversal claim `"_ENTRY_" "_$P(^BPSC(ENTRY,0),U))
"RTN","BPSOSC2",31,0)
 ; for the N'th prescription therein - N defaults to 1
"RTN","BPSOSC2",32,0)
 ; First construct the original version.
"RTN","BPSOSC2",33,0)
 D TEST(ENTRY)
"RTN","BPSOSC2",34,0)
 N ORIG K WP S ORIG=$P(^BPS(9002313.31,ENTRY,0),U,3)
"RTN","BPSOSC2",35,0)
 I 'ORIG D  Q
"RTN","BPSOSC2",36,0)
 . D IMPOSS^BPSOSUE("DB,P","TRI","Error constructing original claim",,"REVERSAL - 1",$T(+0))
"RTN","BPSOSC2",37,0)
 N REVERSAL S REVERSAL=$$REVERSE^BPSECA8(ORIG,$S($G(N):N,1:1))
"RTN","BPSOSC2",38,0)
 W "Reversal: 9002313.02 entry `",REVERSAL,!
"RTN","BPSOSC2",39,0)
 I 'REVERSAL D  Q  ; error during construction of reversal
"RTN","BPSOSC2",40,0)
 . D IMPOSS^BPSOSUE("DB,P","TRI","Error constructing reversal claim",,"REVERSAL - 2",$T(+0))
"RTN","BPSOSC2",41,0)
 ; Now construct the data packet
"RTN","BPSOSC2",42,0)
 N COUNT,DIALOUT,CLAIMIEN S COUNT=0
"RTN","BPSOSC2",43,0)
 S DIALOUT=$$DIALOUT,CLAIMIEN=REVERSAL D PASCII1^BPSOSQH
"RTN","BPSOSC2",44,0)
 ; ORIG is obsolete, orphaned
"RTN","BPSOSC2",45,0)
 ; Overwrite the pointer to 9002313.02 with the Reversal packet
"RTN","BPSOSC2",46,0)
 N DIE S DIE=9002313.31,DA=ENTRY,DR=".03////"_REVERSAL D ^DIE
"RTN","BPSOSC2",47,0)
 ; Now SEND^BPSOSC2(ENTRY) will send the reversal
"RTN","BPSOSC2",48,0)
 Q
"RTN","BPSOSC2",49,0)
DIALOUT()          ;
"RTN","BPSOSC2",50,0)
 I VARX Q "1VA"  ;LJE
"RTN","BPSOSC2",51,0)
 Q $O(^BPS(9002313.55,"B","RESERVED - DO NOT USE",0))
"RTN","BPSOSC2",52,0)
SEND(ENTRY)        ; 
"RTN","BPSOSC2",53,0)
 N IEN02 S IEN02=$P(^BPS(9002313.31,ENTRY,0),U,3)
"RTN","BPSOSC2",54,0)
 D RUNTEST^BPSOSC3($$DIALOUT,IEN02)
"RTN","BPSOSC2",55,0)
 W "The log file can be viewed by DO LOG^",$T(+0),!
"RTN","BPSOSC2",56,0)
 Q
"RTN","BPSOSC2",57,0)
LOG ;EP -
"RTN","BPSOSC2",58,0)
 W !,"At the prompt, just type RES to get the RESERVED - DO NOT USE",!
"RTN","BPSOSC2",59,0)
 D COMMSLOG^BPSOSU6
"RTN","BPSOSC2",60,0)
 Q
"RTN","BPSOSC2",61,0)
PRINT(IEN31,FLAG) ;
"RTN","BPSOSC2",62,0)
 W "IEN31=",IEN31,!
"RTN","BPSOSC2",63,0)
 N CLAIM S CLAIM=$P(^BPS(9002313.31,IEN31,0),U,3)
"RTN","BPSOSC2",64,0)
 I 'CLAIM W "No claim for IEN31=",IEN31,! Q
"RTN","BPSOSC2",65,0)
 I $G(FLAG)=0 G P12
"RTN","BPSOSC2",66,0)
 D PRINT02^BPSOSAY(CLAIM)
"RTN","BPSOSC2",67,0)
P12 N RESP S RESP=$O(^BPSR("B",CLAIM,""),-1)  ; get the most recent resp.
"RTN","BPSOSC2",68,0)
 I 'RESP W "No response for CLAIM=",CLAIM,! Q
"RTN","BPSOSC2",69,0)
 D PRINT03^BPSOSAY(RESP)
"RTN","BPSOSC2",70,0)
 Q
"RTN","BPSOSC2",71,0)
PRINTR(IEN31) ;
"RTN","BPSOSC2",72,0)
 D PRINT(IEN31,0)
"RTN","BPSOSC2",73,0)
 Q
"RTN","BPSOSC2",74,0)
SAVEBPS K ^TMP($J,$T(+0))
"RTN","BPSOSC2",75,0)
 N % S %="BPS"
"RTN","BPSOSC2",76,0)
 F  S %=$Q(@%) Q:%=""  S ^TMP($J,$T(+0),%)=@%
"RTN","BPSOSC2",77,0)
 Q
"RTN","BPSOSC2",78,0)
PACKET(ENTRY,DIALOUT,DUMPBPS)      ; EP - from BPSOSC4
"RTN","BPSOSC2",79,0)
 N BPS
"RTN","BPSOSC2",80,0)
 D SETBPS(ENTRY) ; construct the BPS(*) array
"RTN","BPSOSC2",81,0)
 I $G(DUMPBPS)[1 D ZWRITE^BPSOS("BPS") ;ZW BPS
"RTN","BPSOSC2",82,0)
 I $G(DUMPBPS)[2 D SAVEBPS
"RTN","BPSOSC2",83,0)
 N N S N=$P(^BPS(9002313.31,ENTRY,2,0),U,3)
"RTN","BPSOSC2",84,0)
 D NEWCLAIM^BPSOSCE(1,N,N) ; builds a 9002313.02 record
"RTN","BPSOSC2",85,0)
 N CLAIMIEN S CLAIMIEN=$P(^BPSC(0),U,3)
"RTN","BPSOSC2",86,0)
 N COUNT S COUNT=0 ; this variable is used by PASCII1^BPSOSQH
"RTN","BPSOSC2",87,0)
 D PASCII1^BPSOSQH ; construct the data packet
"RTN","BPSOSC2",88,0)
 N DA,DIE,DR S DIE=9002313.31,DA=ENTRY,DR=".03////"_CLAIMIEN D ^DIE
"RTN","BPSOSC2",89,0)
 Q CLAIMIEN
"RTN","BPSOSC2",90,0)
SETBPS(ENTRY) ; Construct packet for just one entry in 9002313.31
"RTN","BPSOSC2",91,0)
 W "Create 9002313.02 claim for "
"RTN","BPSOSC2",92,0)
 W $P(^BPS(9002313.31,ENTRY,0),U),!
"RTN","BPSOSC2",93,0)
 S BPS("Insurer","IEN")=$P(^BPS(9002313.31,ENTRY,0),U,4)
"RTN","BPSOSC2",94,0)
 S BPS("Site","Switch Type")=$P(^BPS(9002313.31,ENTRY,0),U,5)
"RTN","BPSOSC2",95,0)
 I BPS("Site","Switch Type")=""  S BPS("Site","Switch Type")="ENVOY"
"RTN","BPSOSC2",96,0)
 I VARX S BPS("Site","Switch Type")="VA"
"RTN","BPSOSC2",97,0)
 I 'VARX S BPS("NCPDP","IEN")=$P(^BPSEI(BPS("Insurer","IEN"),100),U)
"RTN","BPSOSC2",98,0)
 E  S BPS("NCPDP","IEN")=$P(^BPS(9002313.31,ENTRY,4),"^",1)
"RTN","BPSOSC2",99,0)
 S BPS("NCPDP","BIN Number")=$P(^BPSF(9002313.92,BPS("NCPDP","IEN"),1),U)
"RTN","BPSOSC2",100,0)
 S BPS("NCPDP","Envoy Plan Number")=$P(^BPSF(9002313.92,BPS("NCPDP","IEN"),1),U,4)
"RTN","BPSOSC2",101,0)
 S BPS("NCPDP","Version")=$P(^BPSF(9002313.92,BPS("NCPDP","IEN"),1),U,2)
"RTN","BPSOSC2",102,0)
 S BPS("Envoy Terminal ID")=$P(^BPS(9002313.56,1,0),U,6)
"RTN","BPSOSC2",103,0)
 S BPS("Patient","SSN")=""
"RTN","BPSOSC2",104,0)
 ;
"RTN","BPSOSC2",105,0)
 I $G(ZREVERSE) D
"RTN","BPSOSC2",106,0)
 .S BPS("RX",1,"RX IEN")=1
"RTN","BPSOSC2",107,0)
 .S BPS("RX",1,"IEN59")="999991.00001",BPS("RX","0")=1,BPS("RX",BPS("RX","0"),"Date Filled")=20011206,IEN59="999991.00001"
"RTN","BPSOSC2",108,0)
 ;
"RTN","BPSOSC2",109,0)
 I '$G(BPS("RX",1,"RX IEN")) S BPS("RX",1,"RX IEN")=1,(IEN59,BPS("RX",1,"IEN59"))="999"_ENTRY_".00001"
"RTN","BPSOSC2",110,0)
 ;
"RTN","BPSOSC2",111,0)
 ;for advancepcs - second bin number and hardcoded rx number.
"RTN","BPSOSC2",112,0)
 S BPS("RX",1,"CERT RX IEN")=BPS("RX",1,"RX IEN")
"RTN","BPSOSC2",113,0)
 I ",20,21,22,23,15,16,"[(","_ENTRY_",") S BPS("RX",1,"CERT RX IEN")=$P(^BPS(9002313.31,ENTRY,2,1,1,8,0),"^",2)
"RTN","BPSOSC2",114,0)
 ;
"RTN","BPSOSC2",115,0)
 S BPS("Site","Pharmacy #")=10
"RTN","BPSOSC2",116,0)
 S DFN=$P(^BPS(9002313.31,ENTRY,4),"^",2)
"RTN","BPSOSC2",117,0)
 N A,N S A=0 ; Loop through claim header fields
"RTN","BPSOSC2",118,0)
 F  S A=$O(^BPS(9002313.31,ENTRY,1,A)) Q:'A  D
"RTN","BPSOSC2",119,0)
 . ; Set the Claim Header fields
"RTN","BPSOSC2",120,0)
 . N X S X=^BPS(9002313.31,ENTRY,1,A,0)
"RTN","BPSOSC2",121,0)
 . N FIELD S FIELD=$P(^BPSF(9002313.91,$P(X,U),0),U)
"RTN","BPSOSC2",122,0)
 . W !,FIELD,?30,$P(X,U,2)
"RTN","BPSOSC2",123,0)
 . D SETBPS1(FIELD,$P(X,U,2))
"RTN","BPSOSC2",124,0)
 S N=0 ; Loop through prescription fields
"RTN","BPSOSC2",125,0)
 F  S N=$O(^BPS(9002313.31,ENTRY,2,N)) Q:'N  D
"RTN","BPSOSC2",126,0)
 . N A S A=0
"RTN","BPSOSC2",127,0)
 . F  S A=$O(^BPS(9002313.31,ENTRY,2,N,1,A)) Q:'A  D
"RTN","BPSOSC2",128,0)
 . . S X=^BPS(9002313.31,ENTRY,2,N,1,A,0)
"RTN","BPSOSC2",129,0)
 . . N FIELD S FIELD=$P(^BPSF(9002313.91,$P(X,U),0),U)
"RTN","BPSOSC2",130,0)
 . . W !,FIELD,?30,$P(X,U,2),?50,N
"RTN","BPSOSC2",131,0)
 . . D SETBPS1(FIELD,$P(X,U,2),N)
"RTN","BPSOSC2",132,0)
 . ; Construct a few other fields that weren't already set
"RTN","BPSOSC2",133,0)
 . ; Need this IEN59 for logging some stuff.
"RTN","BPSOSC2",134,0)
 . ; call it 9999991.00001, 9999992.00001, etc.
"RTN","BPSOSC2",135,0)
 . I '$D(^PSRX(BPS("RX",1,"RX IEN"))) S BPS("RX",N,"IEN59")=$$MYIEN59(ENTRY)  ;LJE N TO ENTRY
"RTN","BPSOSC2",136,0)
 . I '$D(^PSRX(BPS("RX",1,"RX IEN"))) D INIT^BPSOSL(BPS("RX",N,"IEN59"))
"RTN","BPSOSC2",137,0)
 ; Construct a few other fields that weren't already set.
"RTN","BPSOSC2",138,0)
 S BPS("Patient","Name")=$G(BPS("Patient","Last Name"))_","_$G(BPS("Patient","First Name"))
"RTN","BPSOSC2",139,0)
 I '$D(BPS("RX",1,"Quantity")) S BPS("RX",1,"Quantity")=$G(BPS("RX",1,"Metric Decimal Quantity"))
"RTN","BPSOSC2",140,0)
 ;
"RTN","BPSOSC2",141,0)
 S BPS("RX",1,"Date Filled")=BPS("RX","Date Filled")
"RTN","BPSOSC2",142,0)
 I ENTRY=9 S BPS("RX",ENTRY,"Date Filled")=20040107,BPS("RX","Date Filled")=20040107
"RTN","BPSOSC2",143,0)
 S BPS("RX","0")=1
"RTN","BPSOSC2",144,0)
 I ENTRY=53 S BPS("RX",ENTRY,"Prescriber ID Qualifier")=12
"RTN","BPSOSC2",145,0)
 Q
"RTN","BPSOSC2",146,0)
PRINTLOG(N) ; print the log file for test claim number N
"RTN","BPSOSC2",147,0)
 D PRINTLOG^BPSOSL($$MYIEN59(N)) Q
"RTN","BPSOSC2",148,0)
MYIEN59(N) ; a fake number
"RTN","BPSOSC2",149,0)
 Q "999999"_N_".00001"
"RTN","BPSOSC2",150,0)
SETBPS1(FIELD,VALUE,N)         ; store values in Claim Header's BPS(*)
"RTN","BPSOSC2",151,0)
 N OK S OK=0
"RTN","BPSOSC2",152,0)
 N I F I=1:1 Q:$T(TABLE+I)=" ;*"  D  Q:OK
"RTN","BPSOSC2",153,0)
 . N X S X=$T(TABLE+I)
"RTN","BPSOSC2",154,0)
 . I $P(X,";",2)'=FIELD Q
"RTN","BPSOSC2",155,0)
 . S @("BPS("_$P(X,";",3)_")=VALUE")
"RTN","BPSOSC2",156,0)
 . S OK=1
"RTN","BPSOSC2",157,0)
 I 'OK W !,"Failed to find field ",FIELD," in TABLE^",$T(+0),!
"RTN","BPSOSC2",158,0)
 Q
"RTN","BPSOSC2",159,0)
TABLE ;
"RTN","BPSOSC2",160,0)
 ;101;"NCPDP","Envoy Plan Number"
"RTN","BPSOSC2",161,0)
 ;102;"NCPDP","Version"
"RTN","BPSOSC2",162,0)
 ;103;"Transaction Code"
"RTN","BPSOSC2",163,0)
 ;104;"NCPDP","PCN"
"RTN","BPSOSC2",164,0)
 ;109;"Transaction Count"
"RTN","BPSOSC2",165,0)
 ;110;"NCPDP","Software Vendor/Cert ID"
"RTN","BPSOSC2",166,0)
 ;111;"NCPDP","Segment Identification"
"RTN","BPSOSC2",167,0)
 ;201;"Site","Pharmacy #"
"RTN","BPSOSC2",168,0)
 ;202;"Service Provider ID Qual"
"RTN","BPSOSC2",169,0)
 ;301;"Insurer","Group #"
"RTN","BPSOSC2",170,0)
 ;302;"Insurer","Policy #"
"RTN","BPSOSC2",171,0)
 ;303;"Insurer","Person Code"
"RTN","BPSOSC2",172,0)
 ;304;"Patient","DOB"
"RTN","BPSOSC2",173,0)
 ;305;"Patient","Sex"
"RTN","BPSOSC2",174,0)
 ;306;"Insurer","Relationship"
"RTN","BPSOSC2",175,0)
 ;308;"Patient","Other Coverage Code"
"RTN","BPSOSC2",176,0)
 ;307;"Customer Location"
"RTN","BPSOSC2",177,0)
 ;309;"Eligibility Clarification Code"
"RTN","BPSOSC2",178,0)
 ;310;"Patient","First Name"
"RTN","BPSOSC2",179,0)
 ;311;"Patient","Last Name"
"RTN","BPSOSC2",180,0)
 ;312;"Cardholder","First Name"
"RTN","BPSOSC2",181,0)
 ;313;"Cardholder","Last Name"
"RTN","BPSOSC2",182,0)
 ;322;"Patient","Street Address"
"RTN","BPSOSC2",183,0)
 ;323;"Patient","City"
"RTN","BPSOSC2",184,0)
 ;324;"Patient","State"
"RTN","BPSOSC2",185,0)
 ;325;"Patient","Zip"
"RTN","BPSOSC2",186,0)
 ;331;"Patient","Patient ID Qualifier"
"RTN","BPSOSC2",187,0)
 ;332;"Patient","SSN"
"RTN","BPSOSC2",188,0)
 ;326;"Patient","Phone #"
"RTN","BPSOSC2",189,0)
 ;401;"RX","Date Filled"
"RTN","BPSOSC2",190,0)
 ;402;"RX",N,"RX Number"
"RTN","BPSOSC2",191,0)
 ;403;"RX",N,"Refill #"
"RTN","BPSOSC2",192,0)
 ;404;"RX",N,"Quantity"
"RTN","BPSOSC2",193,0)
 ;405;"RX",N,"Days Supply"
"RTN","BPSOSC2",194,0)
 ;406;"RX",N,"Compound Code"
"RTN","BPSOSC2",195,0)
 ;407;"RX",N,"NDC"
"RTN","BPSOSC2",196,0)
 ;408;"RX",N,"DAW"
"RTN","BPSOSC2",197,0)
 ;409;"RX",N,"Ingredient Cost"
"RTN","BPSOSC2",198,0)
 ;410;"RX",N,"Sales Tax"
"RTN","BPSOSC2",199,0)
 ;411;"RX",N,"Prescriber ID"
"RTN","BPSOSC2",200,0)
 ;412;"RX",N,"Dispensing Fee"
"RTN","BPSOSC2",201,0)
 ;414;"RX",N,"Date Written"
"RTN","BPSOSC2",202,0)
 ;415;"RX",N,"# Refills"
"RTN","BPSOSC2",203,0)
 ;416;"RX",N,"Preauth #"
"RTN","BPSOSC2",204,0)
 ;418;"RX",N,"Level of Service"
"RTN","BPSOSC2",205,0)
 ;419;"RX",N,"Origin Code"
"RTN","BPSOSC2",206,0)
 ;420;"RX",N,"Clarification"
"RTN","BPSOSC2",207,0)
 ;421;"RX",N,"Primary Prescriber"
"RTN","BPSOSC2",208,0)
 ;422;"RX",N,"Clinic ID"
"RTN","BPSOSC2",209,0)
 ;423;"RX",N,"Basis of Cost Determination"
"RTN","BPSOSC2",210,0)
 ;424;"RX",N,"Diagnosis Code"
"RTN","BPSOSC2",211,0)
 ;426;"RX",N,"Usual & Customary"
"RTN","BPSOSC2",212,0)
 ;427;"RX",N,"Prescriber Last Name"
"RTN","BPSOSC2",213,0)
 ;429;"RX",N,"Unit Dose Indicator"
"RTN","BPSOSC2",214,0)
 ;430;"RX",N,"Gross Amount Due"
"RTN","BPSOSC2",215,0)
 ;431;"RX",N,"Other Payor Amount"
"RTN","BPSOSC2",216,0)
 ;433;"RX",N,"Patient Paid Amount"
"RTN","BPSOSC2",217,0)
 ;436;"RX",N,"Alt. Product Type"
"RTN","BPSOSC2",218,0)
 ;438;"RX",N,"Incentive Amount"
"RTN","BPSOSC2",219,0)
 ;439;"RX",N,"DUR","DUR Conflict Code",439
"RTN","BPSOSC2",220,0)
 ;440;"RX",N,"DUR","DUR Intervention Code",440
"RTN","BPSOSC2",221,0)
 ;441;"RX",N,"DUR","DUR Outcome Code",441
"RTN","BPSOSC2",222,0)
 ;442;"RX",N,"Metric Decimal Quantity"
"RTN","BPSOSC2",223,0)
 ;443;"RX",N,"Primary Payor Denial Date"
"RTN","BPSOSC2",224,0)
 ;444;"RX",N,"Provider ID"
"RTN","BPSOSC2",225,0)
 ;455;"RX",N,"Rx/Service Ref Num Qual"
"RTN","BPSOSC2",226,0)
 ;460;"RX",N,"Quantity"
"RTN","BPSOSC2",227,0)
 ;461;"Claim",N,"Prior Auth Type"
"RTN","BPSOSC2",228,0)
 ;462;"Claim",N,"Prior Auth Num Sub"
"RTN","BPSOSC2",229,0)
 ;465;"RX",N,"Provider ID"
"RTN","BPSOSC2",230,0)
 ;466;"RX",N,"Prescriber ID Qualifier"
"RTN","BPSOSC2",231,0)
 ;467;"RX",N,"Prescriber Location Code"
"RTN","BPSOSC2",232,0)
 ;468;"RX",N,"Primary Care Prov ID Qual"
"RTN","BPSOSC2",233,0)
 ;469;"RX",N,"Primary Care Prov ID"
"RTN","BPSOSC2",234,0)
 ;470;"RX",N,"Primary Care Prov Last Name"
"RTN","BPSOSC2",235,0)
 ;473;"RX",N,"DUR","DUR/PPS CODE COUNTER",473
"RTN","BPSOSC2",236,0)
 ;478;"Insurer","Other Amt Claim Sub Cnt"
"RTN","BPSOSC2",237,0)
 ;479;"Insurer","Other Amt Claim Sub Qual"
"RTN","BPSOSC2",238,0)
 ;480;"Insurer","Other Amt Claim Submitted"
"RTN","BPSOSC2",239,0)
 ;481;"Insurer","Flat Sales Tax Amt Sub"
"RTN","BPSOSC2",240,0)
 ;482;"Insurer","Percentage Sales Tax Amt Sub"
"RTN","BPSOSC2",241,0)
 ;483;"Insurer","Percent Sales Tax Rate Sub"
"RTN","BPSOSC2",242,0)
 ;484;"Insurer","Percent Sales Tax Basis Sub"
"RTN","BPSOSC2",243,0)
 ;498;"RX",N,"Prescriber Phone #"
"RTN","BPSOSC2",244,0)
 ;*
"RTN","BPSOSC3")
0^139^B4946111
"RTN","BPSOSC3",1,0)
BPSOSC3 ;BHAM ISC/FCS/DRS/DLF - development - certification testing ;06/01/2004  
"RTN","BPSOSC3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSC3",3,0)
 Q
"RTN","BPSOSC3",4,0)
RUNTEST(DIALOUT,FROM,THRU)    ;EP - from BPSOSC2,BPSOSC4
"RTN","BPSOSC3",5,0)
 I '$D(THRU) S THRU=FROM
"RTN","BPSOSC3",6,0)
 K ^BPSECX("POS",DIALOUT)
"RTN","BPSOSC3",7,0)
 N I F I=FROM:1:THRU D
"RTN","BPSOSC3",8,0)
 . N J S J=$P(^BPSC(I,"M",0),U,3)
"RTN","BPSOSC3",9,0)
 . S ^BPSECX("POS",DIALOUT,"C",I,0)=J
"RTN","BPSOSC3",10,0)
 . N K F K=1:1:J D
"RTN","BPSOSC3",11,0)
 . . S ^BPSECX("POS",DIALOUT,"C",I,K)=^BPSC(I,"M",K,0)
"RTN","BPSOSC3",12,0)
 D TASK^BPSOSQ2 ; which should start up COMMS^BPSOSQ3
"RTN","BPSOSC3",13,0)
 Q
"RTN","BPSOSC3",14,0)
LASTCOMM ; print the last comms log - look backwards for the last .1 suffix
"RTN","BPSOSC3",15,0)
 S X=9999999999
"RTN","BPSOSC3",16,0)
 F  S X=$O(^BPSECP("LOG",X),-1) Q:'X  Q:X#1=.1
"RTN","BPSOSC3",17,0)
 W "Comms log ",X,! H 1
"RTN","BPSOSC3",18,0)
 D PRINTLOG^BPSOSL(X)
"RTN","BPSOSC3",19,0)
 Q
"RTN","BPSOSC3",20,0)
RESTOR02 ; by sending ASCII file A:\BPSEC02.GSA
"RTN","BPSOSC3",21,0)
 N I,X,Y
"RTN","BPSOSC3",22,0)
 K ^TMP($J) N DONE
"RTN","BPSOSC3",23,0)
 W "SEND file A:\BPSEC02.GSA in ASCII mode, you have 20 seconds:",!
"RTN","BPSOSC3",24,0)
 F I=1:1 R ^TMP($J,I):20 Q:'$T
"RTN","BPSOSC3",25,0)
 D CLR0203("YES")
"RTN","BPSOSC3",26,0)
 ;K ^BPSC(*)
"RTN","BPSOSC3",27,0)
 W !,"Now setting the data values...",!
"RTN","BPSOSC3",28,0)
 F I=3:2 D  Q:$G(DONE)
"RTN","BPSOSC3",29,0)
 . S X=^TMP($J,I),Y=^TMP($J,I+1)
"RTN","BPSOSC3",30,0)
 . I X="*",Y="*" S DONE=1 Q
"RTN","BPSOSC3",31,0)
 . S @X=Y
"RTN","BPSOSC3",32,0)
 W "We processed up through line number ",I-1,!
"RTN","BPSOSC3",33,0)
 Q
"RTN","BPSOSC3",34,0)
CLR0203(X) ; erase all entries in 9002313.02 and .03 claims & responses
"RTN","BPSOSC3",35,0)
 I X'="YES" D  Q  ; must pass this parameter to say you're really sure
"RTN","BPSOSC3",36,0)
 . N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("P","TI","parameter X="_X,,"CLR0203",$T(+0))
"RTN","BPSOSC3",37,0)
 N IEN,DA,DR,DIE,FILE
"RTN","BPSOSC3",38,0)
 F FILE=9002313.02,9002313.03 DO CLR0203A(FILE)
"RTN","BPSOSC3",39,0)
 Q
"RTN","BPSOSC3",40,0)
CLR0203A(FILE) I X'="YES" D  Q
"RTN","BPSOSC3",41,0)
 . N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("P","TI","parameter X="_X,,"CLR0203A",$T(+0))
"RTN","BPSOSC3",42,0)
 N X,IEN,DIE,DA,DR
"RTN","BPSOSC3",43,0)
 W "Erasing all entries in file ",FILE,"..."
"RTN","BPSOSC3",44,0)
 S IEN=0 F  S IEN=$O(^BPS(FILE,IEN)) Q:'IEN  D
"RTN","BPSOSC3",45,0)
 . S DIE=FILE
"RTN","BPSOSC3",46,0)
 . I DIE'=9002313.02,DIE'=9002313.03 D  Q  ; safety!
"RTN","BPSOSC3",47,0)
 . . N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("P","TI","DIE="_DIE,,"CLR0203A",$T(+0))
"RTN","BPSOSC3",48,0)
 . S DA=IEN,DR=".01///@"
"RTN","BPSOSC3",49,0)
 . D ^DIE
"RTN","BPSOSC3",50,0)
 . W:$X>70 !?5 W "."
"RTN","BPSOSC3",51,0)
 W !
"RTN","BPSOSC3",52,0)
 D ZWRITE^BPSOS("IEN")
"RTN","BPSOSC3",53,0)
 Q
"RTN","BPSOSCA")
0^141^B11247616
"RTN","BPSOSCA",1,0)
BPSOSCA ;BHAM ISC/FCS/DRS - Create 9002313.02 entries ;06/01/2004
"RTN","BPSOSCA",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSCA",3,0)
 ;
"RTN","BPSOSCA",4,0)
 ; Create 9002313.02 entries for RXILIST(*) claims.
"RTN","BPSOSCA",5,0)
 ; Called from PACKET^BPSOSQG
"RTN","BPSOSCA",6,0)
 ;
"RTN","BPSOSCA",7,0)
 ; Input:
"RTN","BPSOSCA",8,0)
 ;      RXILIST(IEN59)  array of pointers to 9002313.59
"RTN","BPSOSCA",9,0)
 ;         A list of prescriptions for the same visit/patient/etc.
"RTN","BPSOSCA",10,0)
 ;         to be bundled into one or more 9002313.02 claims
"RTN","BPSOSCA",11,0)
 ;
"RTN","BPSOSCA",12,0)
 ; Outputs:
"RTN","BPSOSCA",13,0)
 ;      CLAIMIEN(CLAIMIEN)="", pointers to the ^BPSC(CLAIMIEN,
"RTN","BPSOSCA",14,0)
 ;                             claim records created.
"RTN","BPSOSCA",15,0)
 ;      ERROR
"RTN","BPSOSCA",16,0)
 ;
"RTN","BPSOSCA",17,0)
 ; BPSOSCA calls:
"RTN","BPSOSCA",18,0)
 ;   BPSOSCB to build BPS(*) array
"RTN","BPSOSCA",19,0)
 ;      (and BPSOSCB calls BPSOSCC)
"RTN","BPSOSCA",20,0)
 ;   BPSOSCD to build the ^BPSC( entry
"RTN","BPSOSCA",21,0)
 ;
"RTN","BPSOSCA",22,0)
EN(DIALOUT)        ;EP - from BPSOSQG
"RTN","BPSOSCA",23,0)
 I $D(RXILIST)<10  D
"RTN","BPSOSCA",24,0)
 .N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("P","TI","bad RXILIST",,,$T(+0))
"RTN","BPSOSCA",25,0)
 ;Manage local variables
"RTN","BPSOSCA",26,0)
 N BPS,START,END,TOTAL,NCLAIMS,CLAIMN
"RTN","BPSOSCA",27,0)
 S ERROR=$$BPS^BPSOSCB(DIALOUT,.BPS)
"RTN","BPSOSCA",28,0)
 I ERROR D LOG2LIST^BPSOSQ($T(+0)_" - $$BPS^BPSOSCB("_DIALOUT_",.BPS) returned "_ERROR)
"RTN","BPSOSCA",29,0)
 I $G(BPS("RX",0))="" S:'ERROR ERROR=301 Q
"RTN","BPSOSCA",30,0)
 I $G(BPS("NCPDP","# Meds/Claim"))="" S ERROR=302 Q
"RTN","BPSOSCA",31,0)
 ;
"RTN","BPSOSCA",32,0)
 ; Override any BPS() nodes that you need to override.
"RTN","BPSOSCA",33,0)
 ;
"RTN","BPSOSCA",34,0)
 D  ; NDC #s - Translate POSTAGE (may be insurer-dependent someday)
"RTN","BPSOSCA",35,0)
 .N N F N=1:1:BPS("RX",0) D
"RTN","BPSOSCA",36,0)
 ..N X,Y S X=$TR(BPS("RX",N,"NDC"),"-",""),Y=BPS("RX",N,"IEN59")
"RTN","BPSOSCA",37,0)
 ..N Z S Z=$P(^BPST(Y,1),U,2)
"RTN","BPSOSCA",38,0)
 ..I Z="POSTAGE" S Z=99999999981 ; 06/21/2000
"RTN","BPSOSCA",39,0)
 ..; This next part should never happen; it should already be correct
"RTN","BPSOSCA",40,0)
 ..;    BPSOSQ1 already put the correct NDC # into the ^PSRX
"RTN","BPSOSCA",41,0)
 ..;    and BPSOSCE will pick it out from there.
"RTN","BPSOSCA",42,0)
 ..I X'=Z,Z'="POSTAGE",Z'="" D  ; $TR inserted above, 03/07/2000
"RTN","BPSOSCA",43,0)
 ...S BPS("RX",N,"NDC")=Z
"RTN","BPSOSCA",44,0)
 ...D LOG59^BPSOSQ("CLAIM - NDC # on `"_Y_" sent as "_Z_", not "_X,Y)
"RTN","BPSOSCA",45,0)
 ;
"RTN","BPSOSCA",46,0)
 ;Calculate number of claim records to be generated for Billing Item
"RTN","BPSOSCA",47,0)
 S NCLAIMS=((BPS("RX",0)-1)\BPS("NCPDP","# Meds/Claim"))+1
"RTN","BPSOSCA",48,0)
 I NCLAIMS=0 S ERROR=303 Q
"RTN","BPSOSCA",49,0)
 ;
"RTN","BPSOSCA",50,0)
 ;Generate claim submission records
"RTN","BPSOSCA",51,0)
 F CLAIMN=1:1:NCLAIMS D  Q:$G(ERROR)
"RTN","BPSOSCA",52,0)
 .S START=((CLAIMN-1)*BPS("NCPDP","# Meds/Claim"))+1
"RTN","BPSOSCA",53,0)
 .S END=START+BPS("NCPDP","# Meds/Claim")-1
"RTN","BPSOSCA",54,0)
 .S:END>BPS("RX",0) END=BPS("RX",0)
"RTN","BPSOSCA",55,0)
 .S TOTAL=END-START+1
"RTN","BPSOSCA",56,0)
 .D NEWCLAIM^BPSOSCE(START,END,TOTAL)
"RTN","BPSOSCA",57,0)
 .S CLAIMIEN=BPS(9002313.02)
"RTN","BPSOSCA",58,0)
 .S CLAIMIEN(CLAIMIEN)=""
"RTN","BPSOSCA",59,0)
 .; Mark each of the .59s with the claim number and position within
"RTN","BPSOSCA",60,0)
 .F I=START:1:END D
"RTN","BPSOSCA",61,0)
 ..;IEN59 handling 06/23/2000. The ELSE should never happen again.
"RTN","BPSOSCA",62,0)
 ..; and the $G() can probably be gotten rid of, safely.
"RTN","BPSOSCA",63,0)
 ..N IEN59 S IEN59=$G(BPS("RX",I,"IEN59"))
"RTN","BPSOSCA",64,0)
 ..I IEN59 D
"RTN","BPSOSCA",65,0)
 ...N DIE,DA,DR S DIE=9002313.59
"RTN","BPSOSCA",66,0)
 ...; Field (#3) CLAIM (#14) POSITION
"RTN","BPSOSCA",67,0)
 ...S DA=IEN59,DR=3_"////"_CLAIMIEN_";14////"_I N I D ^DIE
"RTN","BPSOSCA",68,0)
 ..E  D
"RTN","BPSOSCA",69,0)
 ...S $P(^BPST(BPS("RX",I,"RX IEN"),0),"^",4)=CLAIMIEN
"RTN","BPSOSCA",70,0)
 ...S ^BPST("AE",CLAIMIEN,BPS("RX",I,"RX IEN"))=""
"RTN","BPSOSCA",71,0)
 ...S $P(^BPST(BPS("RX",I,"RX IEN"),0),"^",9)=I
"RTN","BPSOSCA",72,0)
 ..; POSITION:  Not the relative position within the packet,
"RTN","BPSOSCA",73,0)
 ..; but the index in BPS("RX",n,....  This is the position in which
"RTN","BPSOSCA",74,0)
 ..; it will be stored in ^BPSC(ien,400,POSITION
"RTN","BPSOSCA",75,0)
 ..; and likewise for 9002313.03 when the response comes in.
"RTN","BPSOSCA",76,0)
 Q
"RTN","BPSOSCB")
0^142^B10019843
"RTN","BPSOSCB",1,0)
BPSOSCB ;BHAM ISC/FCS/DRS/DLF - VMEDS(*) prep for BPS(*) ;06/01/2004
"RTN","BPSOSCB",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSCB",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCB",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCB",5,0)
 ; Called from BPSOSCA from BPSOSQG from BPSOSQ2
"RTN","BPSOSCB",6,0)
 ;Setup BPS() array which contains all pertinent data to create
"RTN","BPSOSCB",7,0)
 ;Claim Submission Records for the current Billing Item Record:
"RTN","BPSOSCB",8,0)
 ;
"RTN","BPSOSCB",9,0)
 ;Parameters:  DIALOUT   - Dial-out (9002313.55)
"RTN","BPSOSCB",10,0)
 ;            .BPS      - Formatted array containing data required
"RTN","BPSOSCB",11,0)
 ;                         to create claim submission records
"RTN","BPSOSCB",12,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCB",13,0)
 ;
"RTN","BPSOSCB",14,0)
 Q
"RTN","BPSOSCB",15,0)
BPS(DIALOUT,BPS) ;EP
"RTN","BPSOSCB",16,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1  ;LJE
"RTN","BPSOSCB",17,0)
 I $D(RXILIST)<10 D IMPOSS^BPSOSUE("P","TI","bad RXILIST",,,$T(+0))
"RTN","BPSOSCB",18,0)
 N PATIEN,VMEDS,NMEDS,INSURER,INSPINS,VSTIEN,INDEX
"RTN","BPSOSCB",19,0)
 D  ; set up some vars and make very sure some basic data exists
"RTN","BPSOSCB",20,0)
 . N RXI,R0,R1 S RXI=$O(RXILIST(""))
"RTN","BPSOSCB",21,0)
 . S R0=^BPST(RXI,0),R1=^(1)
"RTN","BPSOSCB",22,0)
 . S PATIEN=$P(R0,U,6)
"RTN","BPSOSCB",23,0)
 . S VSTIEN=$P(R0,U,7)
"RTN","BPSOSCB",24,0)
 . S INSURER=$P(R1,U,6)
"RTN","BPSOSCB",25,0)
 . I $P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S INSPINS=$P(R1,U,8),INSPINS=$P(^BPST(RXI,6),U,INSPINS) ;LJE;6/30/03
"RTN","BPSOSCB",26,0)
 . E  D
"RTN","BPSOSCB",27,0)
 . . S INSPINS="VA3PTY"_","_RXI_","_^BPST(RXI,9),INSURER=^BPST(RXI,10,$P(INSPINS,",",3),0)  ;LJE;6/30/03
"RTN","BPSOSCB",28,0)
 . . K VAINFO D GETS^DIQ(9002313.59,RXI_",","902*","I","VAINFO") ;LJE;6/30/03; get all IB passed data
"RTN","BPSOSCB",29,0)
 . . S CERTIFY=VAINFO(9002313.59902,"1,"_RXI_",",902.22,"I")
"RTN","BPSOSCB",30,0)
 . I 'PATIEN D IMPOSS^BPSOSUE("DB","TI","PATIEN",,,$T(+0))
"RTN","BPSOSCB",31,0)
 . I '$D(^DPT(PATIEN,0)) D IMPOSS^BPSOSUE("DB","TI","^DPT(PATIEN)",,,$T(+0))
"RTN","BPSOSCB",32,0)
 . I $P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) D      ;LJE;06/30/03
"RTN","BPSOSCB",33,0)
 . . I 'VSTIEN D IMPOSS^BPSOSUE("DB","TI","VSTIEN",,,$T(+0))
"RTN","BPSOSCB",34,0)
 ;
"RTN","BPSOSCB",35,0)
E ;Set up VMEDS(*)=a bunch of pointers to important stuff
"RTN","BPSOSCB",36,0)
 ; Somewhat vestigial but for now, it survives.
"RTN","BPSOSCB",37,0)
 D GETVMED(.VMEDS)
"RTN","BPSOSCB",38,0)
 I '$D(VMEDS) Q 551
"RTN","BPSOSCB",39,0)
 I 'VMEDS(0) Q 553
"RTN","BPSOSCB",40,0)
 ;
"RTN","BPSOSCB",41,0)
 ;Get general info and set up BPS array for Patient, Insurer, Site and
"RTN","BPSOSCB",42,0)
 ;NCPDP record format data 
"RTN","BPSOSCB",43,0)
 D GETINFO^BPSOSCC(DIALOUT,PATIEN,VSTIEN,INSPINS,INSURER,.VAINFO)
"RTN","BPSOSCB",44,0)
 ;
"RTN","BPSOSCB",45,0)
 ;Determine number of mediations returned from GetInfo procedure
"RTN","BPSOSCB",46,0)
 S NMEDS=+$G(VMEDS(0))
"RTN","BPSOSCB",47,0)
 S BPS("RX",0)=NMEDS
"RTN","BPSOSCB",48,0)
 Q:NMEDS=0 552
"RTN","BPSOSCB",49,0)
L ;Get medication and prescription data for each medication
"RTN","BPSOSCB",50,0)
 F INDEX=1:1:NMEDS D MEDINFO^BPSOSCD(VMEDS(INDEX),INDEX,INSPINS)
"RTN","BPSOSCB",51,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S ENTRY=VAINFO(9002313.59902,"1,"_IEN59_",",902.23,"I") I ENTRY,($D(^BPS(9002313.31,ENTRY))) D SETBPS^BPSOSC2(ENTRY)
"RTN","BPSOSCB",52,0)
 K VAINSDA,VAINSDA1,VAINFO ;LJE
"RTN","BPSOSCB",53,0)
 Q 0
"RTN","BPSOSCB",54,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCB",55,0)
 ;Setup VMEDS() array, which contains medication and prescription data
"RTN","BPSOSCB",56,0)
 ;for each medication in the billing items record:
"RTN","BPSOSCB",57,0)
 ;
"RTN","BPSOSCB",58,0)
 ;            .VMEDS     - Array of V Medication IEN #s (9000010.14)
"RTN","BPSOSCB",59,0)
 ;                         VMEDS(0) = <Total Number>
"RTN","BPSOSCB",60,0)
 ;                         VMEDS(N) = $P=1 --> <V Medication IEN>
"RTN","BPSOSCB",61,0)
 ;                                    $P=2 --> <RXIEN>
"RTN","BPSOSCB",62,0)
 ;                                    $P=3 --> <RXRFIEN>
"RTN","BPSOSCB",63,0)
 ;                                    $P=4 --> <VCPTIEN>
"RTN","BPSOSCB",64,0)
 ;                                    $P=5 --> pointer to 9002313.59
"RTN","BPSOSCB",65,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCB",66,0)
GETVMED(VMEDS) ;
"RTN","BPSOSCB",67,0)
 ;Manage local variables
"RTN","BPSOSCB",68,0)
 N NEXT,COUNT,RXIEN,RXRFIEN,VMEDIEN,VCPTIEN,ABSBRXI
"RTN","BPSOSCB",69,0)
 ;
"RTN","BPSOSCB",70,0)
 ;Loop:  RXILIST(*) -> VMED(*)
"RTN","BPSOSCB",71,0)
 ;
"RTN","BPSOSCB",72,0)
 S (NEXT,COUNT)=0
"RTN","BPSOSCB",73,0)
 F  D  Q:'NEXT
"RTN","BPSOSCB",74,0)
 .S NEXT=$O(RXILIST(NEXT)) Q:'NEXT
"RTN","BPSOSCB",75,0)
 .S ABSBRXI=NEXT
"RTN","BPSOSCB",76,0)
 .N R0,R1 S R0=^BPST(ABSBRXI,0),R1=^(1)
"RTN","BPSOSCB",77,0)
 .S VMEDIEN="" ; don't know, don't care
"RTN","BPSOSCB",78,0)
 .S RXIEN=$P(R1,U,11) I 'RXIEN D IMPOSS^BPSOSUE("DB","TI","RXIEN",,"GETVMED",$T(+0))
"RTN","BPSOSCB",79,0)
 .S RXRFIEN=$P(R1,U,1) I RXRFIEN="" D IMPOSS^BPSOSUE("DB","TI","RXRFIEN",,"GETVMED",$T(+0))
"RTN","BPSOSCB",80,0)
 .S VCPTIEN=$P(R1,U,3)
"RTN","BPSOSCB",81,0)
 .S COUNT=COUNT+1
"RTN","BPSOSCB",82,0)
 .S VMEDS(COUNT)=VMEDIEN_U_RXIEN_U_RXRFIEN_U_VCPTIEN_U_ABSBRXI
"RTN","BPSOSCB",83,0)
 ;
"RTN","BPSOSCB",84,0)
 S VMEDS(0)=COUNT
"RTN","BPSOSCB",85,0)
 Q
"RTN","BPSOSCC")
0^143^B47709345
"RTN","BPSOSCC",1,0)
BPSOSCC ;BHAM ISC/FCS/DRS/DLF - Set up BPS() ;06/01/2004
"RTN","BPSOSCC",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSCC",3,0)
 Q
"RTN","BPSOSCC",4,0)
GETINFO(DIALOUT,PATIEN,VSTIEN,PINS,INSIEN,VAINFO) ;EP;LJE;6/30/03 ADD VAINFO
"RTN","BPSOSCC",5,0)
 N XDATA,NRECIEN
"RTN","BPSOSCC",6,0)
 N PINSDA,PINSDA1,PINSTYPE S PINSDA=$P(PINS,",",2),PINSTYPE=$P(PINS,",")
"RTN","BPSOSCC",7,0)
 I PINSTYPE="PRVT"!(PINSTYPE="VA3PTY") S PINSDA1=$P(PINS,",",3) ; else PINSDA1 undef
"RTN","BPSOSCC",8,0)
 S BPS("VisitIEN")=VSTIEN
"RTN","BPSOSCC",9,0)
 S (VAINSDA,VAINSDA1)="" S VAINSDA=PINSDA,VAINSDA1=PINSDA1
"RTN","BPSOSCC",10,0)
 S BPS("Site","IEN")=DIALOUT
"RTN","BPSOSCC",11,0)
 S BPS("Site","Switch Type")=$$SWTYPE(DIALOUT)
"RTN","BPSOSCC",12,0)
 N PHARMACY
"RTN","BPSOSCC",13,0)
 D
"RTN","BPSOSCC",14,0)
 . N ABSBRXI S ABSBRXI=$O(RXILIST(""))
"RTN","BPSOSCC",15,0)
 . S PHARMACY=$P(^BPST(ABSBRXI,1),U,7)
"RTN","BPSOSCC",16,0)
 . S XDATA=^BPS(9002313.56,PHARMACY,0)
"RTN","BPSOSCC",17,0)
 . S BPS("Site","NABP #")=$P(XDATA,U,2)
"RTN","BPSOSCC",18,0)
 . S BPS("Site","Default DEA #")=$P(XDATA,U,3)
"RTN","BPSOSCC",19,0)
 . S BPS("Envoy Terminal ID")=$P(XDATA,U,6)
"RTN","BPSOSCC",20,0)
 . S XDATA=$G(^BPS(9002313.56,PHARMACY,"CAID"))
"RTN","BPSOSCC",21,0)
 . S BPS("Site","Medicaid Pharmacy #")=$P(XDATA,U)
"RTN","BPSOSCC",22,0)
 . S BPS("Site","Default CAID #")=$P(XDATA,U,2)
"RTN","BPSOSCC",23,0)
 . S XDATA=$G(^BPS(9002313.56,PHARMACY,"NDC"))
"RTN","BPSOSCC",24,0)
 . S BPS("Site","NDC ID")=$P(XDATA,U)
"RTN","BPSOSCC",25,0)
 ;
"RTN","BPSOSCC",26,0)
 I $P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) D
"RTN","BPSOSCC",27,0)
 . S XDATA=^DPT(PATIEN,0)
"RTN","BPSOSCC",28,0)
 . S BPS("Patient","IEN")=PATIEN
"RTN","BPSOSCC",29,0)
 . D  ; Patient,Name
"RTN","BPSOSCC",30,0)
 .. N % I PINSTYPE="CAID" D
"RTN","BPSOSCC",31,0)
 .. . S %=$$CAIDNAME
"RTN","BPSOSCC",32,0)
 .. E  I PINSTYPE="CARE" D
"RTN","BPSOSCC",33,0)
 .. . S %=$$CARENAME
"RTN","BPSOSCC",34,0)
 .. E  S %=""
"RTN","BPSOSCC",35,0)
 .. I %="" S %=$P(XDATA,U)
"RTN","BPSOSCC",36,0)
 .. S BPS("Patient","Name")=%
"RTN","BPSOSCC",37,0)
 . S BPS("Patient","Sex")=$P(XDATA,U,2)
"RTN","BPSOSCC",38,0)
 . S BPS("Patient","DOB")=$P(XDATA,U,3)
"RTN","BPSOSCC",39,0)
 . S BPS("Patient","SSN")=$P(XDATA,U,9)
"RTN","BPSOSCC",40,0)
 E  S DFN=PATIEN D DEM^VADPT,ADD^VADPT D  ;LJE;06/30/03;VA doesn't BILL medicare/medicaid
"RTN","BPSOSCC",41,0)
 . S BPS("Patient","IEN")=PATIEN
"RTN","BPSOSCC",42,0)
 . S BPS("Patient","Name")=$G(VADM(1))
"RTN","BPSOSCC",43,0)
 . S BPS("Patient","Sex")=$P($G(VADM(5)),"^",1)
"RTN","BPSOSCC",44,0)
 . S BPS("Patient","DOB")=$P($G(VADM(3)),"^",1)
"RTN","BPSOSCC",45,0)
 . S BPS("Patient","DOB")=($E(BPS("Patient","DOB"),1,3)+1700)_$E(BPS("Patient","DOB"),4,7)
"RTN","BPSOSCC",46,0)
 . S BPS("Patient","SSN")=$P($G(VADM(2)),"^",1)
"RTN","BPSOSCC",47,0)
 . S BPS("Patient","State")=$P($G(VAPA(5)),"^",1)
"RTN","BPSOSCC",48,0)
 . I BPS("Patient","State")'="" S BPS("Patient","State")=$P($G(^DIC(5,BPS("Patient","State"),0)),"^",2)
"RTN","BPSOSCC",49,0)
 . S BPS("Patient","Street Address")=$G(VAPA(1))
"RTN","BPSOSCC",50,0)
 . S BPS("Patient","City")=$G(VAPA(4))
"RTN","BPSOSCC",51,0)
 . S BPS("Patient","Zip")=$G(VAPA(6))
"RTN","BPSOSCC",52,0)
 . S BPS("Patient","Phone #")=$P($G(VAPA(8)),"^",1)
"RTN","BPSOSCC",53,0)
 . S BPS("Patient","Phone #")=$TR(BPS("Patient","Phone #"),"()-/*# ")
"RTN","BPSOSCC",54,0)
 . 
"RTN","BPSOSCC",55,0)
 S (INSIEN,BPS("Insurer","IEN"))=INSIEN   ;$$INSIEN
"RTN","BPSOSCC",56,0)
 S VARX=0
"RTN","BPSOSCC",57,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) D  G VASKIP  ;LJE;7/3/03
"RTN","BPSOSCC",58,0)
 . S VARX=1
"RTN","BPSOSCC",59,0)
 . S BPS("Insurer","Relationship")=$G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.07,"I"))
"RTN","BPSOSCC",60,0)
 . S BPS("Insurer","Administrative Fee")=$G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.16,"I"))
"RTN","BPSOSCC",61,0)
 . I BPS("Insurer","Administrative Fee")'=""&(BPS("Insurer","Administrative Fee")'=0) S BPS("Insurer","Other Amt Claim Sub Qual")="04"
"RTN","BPSOSCC",62,0)
 . E  S BPS("Insurer","Other Amt Claim Sub Qual")=""
"RTN","BPSOSCC",63,0)
 . I BPS("Insurer","Relationship")="" S BPS("Insurer","Relationship")=0 ;if not there, mark it as unspecified.
"RTN","BPSOSCC",64,0)
 . S BPS("Patient","Primary Care Prov Location Code")=$G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.11,"I"))  ;LJE;7/7/03
"RTN","BPSOSCC",65,0)
 . S BPS("Insurer","Person Code")=$S(BPS("Insurer","Relationship")=1:"01",BPS("Insurer","Relationship")=2:"02",BPS("Insurer","Relationship")=3:03,1:"")
"RTN","BPSOSCC",66,0)
 . S BPS("Insurer","Group #")=$G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.05,"I"))
"RTN","BPSOSCC",67,0)
 . S BPS("Insurer","Policy #")=$G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.06,"I"))  ;CARDHOLDER ID
"RTN","BPSOSCC",68,0)
 . S BPS("Insurer","Full Policy #")=BPS("Insurer","Policy #")
"RTN","BPSOSCC",69,0)
 . S BPS("Insurer","VA PLAN IEN")=$G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",.01,"I"))
"RTN","BPSOSCC",70,0)
 . S:'$D(BPS("Insurer","Percent Sales Tax Rate Sub")) BPS("Insurer","Percent Sales Tax Rate Sub")=""
"RTN","BPSOSCC",71,0)
 . S:'$D(BPS("Insurer","Percent Sales Tax Basis Sub")) BPS("Insurer","Percent Sales Tax Basis Sub")=""
"RTN","BPSOSCC",72,0)
 . S BPS("Cardholder","First Name")=$G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.08,"I"))
"RTN","BPSOSCC",73,0)
 . S BPS("Cardholder","Last Name")=$G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.09,"I"))
"RTN","BPSOSCC",74,0)
 . S BPS("Home Plan")=$G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.11,"I"))
"RTN","BPSOSCC",75,0)
 . S BPS("Site","Pharmacy #")=BPS("Site","NABP #")
"RTN","BPSOSCC",76,0)
 . I $D(^BPS(9002313.56,PHARMACY,"INSURER-ASSIGNED #","B",INSIEN)) D
"RTN","BPSOSCC",77,0)
 . . N X S X=$O(^BPS(9002313.56,PHARMACY,"INSURER-ASSIGNED #","B",INSIEN,0))
"RTN","BPSOSCC",78,0)
 . . S BPS("Site","Pharmacy #")=$P(^BPS(9002313.56,PHARMACY,"INSURER-ASSIGNED #",X,0),U,2)
"RTN","BPSOSCC",79,0)
 . S BPS("NCPDP","BIN Number")=$G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.03,"I"))
"RTN","BPSOSCC",80,0)
 . S XDATA=""
"RTN","BPSOSCC",81,0)
 . I $G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.02,"I")) S XDATA=$G(^BPSF(9002313.92,VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.02,"I"),1))
"RTN","BPSOSCC",82,0)
 . I XDATA="" D IMPOSS^BPSOSUE("DB","TI","VA - Payer sheet info missing.",,"BPS NCPDP FORMATS",$T(+0))
"RTN","BPSOSCC",83,0)
 . S BPS("NCPDP","Version")=$P(XDATA,U,2)
"RTN","BPSOSCC",84,0)
 . S BPS("NCPDP","# Meds/Claim")=$P(XDATA,U,3)
"RTN","BPSOSCC",85,0)
 . S BPS("NCPDP","PCN")=$G(VAINFO(9002313.59902,PINSDA1_","_PINSDA_",",902.04,"I"))
"RTN","BPSOSCC",86,0)
 . I $P(XDATA,U,8)="" S $P(XDATA,U,8)=1
"RTN","BPSOSCC",87,0)
 . S (INSIEN,BPS("Insurer","IEN"))=$P(INSIEN,"^",2)
"RTN","BPSOSCC",88,0)
 . S NRECIEN=INSIEN ;LJE;7/2/03;PAYER SHEET IEN
"RTN","BPSOSCC",89,0)
 ;
"RTN","BPSOSCC",90,0)
 S BPS("Insurer","Relationship")=$$INSREL
"RTN","BPSOSCC",91,0)
 S BPS("Insurer","Person Code")=$$PERSON
"RTN","BPSOSCC",92,0)
 S BPS("Insurer","Group #")=$$INSGRP
"RTN","BPSOSCC",93,0)
 S BPS("Insurer","Policy #")=$TR($$INSPOL,"- /.","") ; BPS*1.0T7*3
"RTN","BPSOSCC",94,0)
 ;
"RTN","BPSOSCC",95,0)
 ; IHS/SD/lwj 03/12/02  some insurers require the entire, untranslated
"RTN","BPSOSCC",96,0)
 ; value as the cardholder ID - added new array bucket to hold
"RTN","BPSOSCC",97,0)
 S BPS("Insurer","Full Policy #")=$$INSPOL ;IHS/SD/lwj 03/12/02
"RTN","BPSOSCC",98,0)
 ;
"RTN","BPSOSCC",99,0)
 ; Pharmacy number:  usually NABP #, but sometimes the insurer demands
"RTN","BPSOSCC",100,0)
 ; their own insurer-assigned pharmacy number.  Especially with Medicaid
"RTN","BPSOSCC",101,0)
 S BPS("Site","Pharmacy #")=BPS("Site","NABP #")
"RTN","BPSOSCC",102,0)
 I $D(^BPS(9002313.56,PHARMACY,"INSURER-ASSIGNED #","B",INSIEN)) D
"RTN","BPSOSCC",103,0)
 . N X S X=$O(^BPS(9002313.56,PHARMACY,"INSURER-ASSIGNED #","B",INSIEN,0))
"RTN","BPSOSCC",104,0)
 . S BPS("Site","Pharmacy #")=$P(^BPS(9002313.56,PHARMACY,"INSURER-ASSIGNED #",X,0),U,2)
"RTN","BPSOSCC",105,0)
 ; Anachronism:  Medicaid Pharmacy # is a special field,
"RTN","BPSOSCC",106,0)
 ; properly, it belongs in the INSURER-ASSIGNED #
"RTN","BPSOSCC",107,0)
 ; But that Medicaid Pharmacy # will overwrite the in INS.-ASSIGNED #
"RTN","BPSOSCC",108,0)
 I PINSTYPE="CAID",BPS("Site","Medicaid Pharmacy #")]"" D
"RTN","BPSOSCC",109,0)
 . S BPS("Site","Pharmacy #")=BPS("Site","Medicaid Pharmacy #")
"RTN","BPSOSCC",110,0)
 ;"NCPDP" nodes
"RTN","BPSOSCC",111,0)
 S NRECIEN=$P($G(^BPSEI(INSIEN,100)),U,1)
"RTN","BPSOSCC",112,0)
VASKIP ;LJE;7/2/03
"RTN","BPSOSCC",113,0)
 S BPS("Insurer","Percentage Sales Tax Amt Sub")=0
"RTN","BPSOSCC",114,0)
 S BPS("Insurer","Flat Sales Tax Amount Sub")=0
"RTN","BPSOSCC",115,0)
 D:NRECIEN'=""
"RTN","BPSOSCC",116,0)
 .S BPS("NCPDP","IEN")=NRECIEN
"RTN","BPSOSCC",117,0)
 .S XDATA=$G(^BPSF(9002313.92,NRECIEN,1))
"RTN","BPSOSCC",118,0)
 .S:BPS("NCPDP","BIN Number")="" BPS("NCPDP","BIN Number")=$P(XDATA,U,1)
"RTN","BPSOSCC",119,0)
 .S BPS("NCPDP","Version")=$P(XDATA,U,2)
"RTN","BPSOSCC",120,0)
 .S BPS("NCPDP","# Meds/Claim")=$P(XDATA,U,3)
"RTN","BPSOSCC",121,0)
 .S BPS("NCPDP","Envoy Plan Number")=$P(XDATA,U,4)
"RTN","BPSOSCC",122,0)
 .S BPS("NCPDP","Software Vendor/Cert ID")=$P(XDATA,U,13)
"RTN","BPSOSCC",123,0)
 .I $P(XDATA,U,8)="" S $P(XDATA,U,8)=1  ;LJE;7/15/03
"RTN","BPSOSCC",124,0)
 .I '$G(VARX) S BPS("NCPDP","Add Disp. Fee to Ingr. Cost")=$P(XDATA,U,8) ;LJE;7/15/03
"RTN","BPSOSCC",125,0)
 Q
"RTN","BPSOSCC",126,0)
 ; $$INSxxx functions - given PINSTYPE, PINSDA, PINSDA1
"RTN","BPSOSCC",127,0)
INSIEN() ; get pointer to ^AUTNINS
"RTN","BPSOSCC",128,0)
 ; (But shouldn't we directly get this from the IEN59?)
"RTN","BPSOSCC",129,0)
 Q 0
"RTN","BPSOSCC",130,0)
INSREL() ; a single digit, 1, 2, 3, 4 = self,spouse,child,other
"RTN","BPSOSCC",131,0)
 Q 0
"RTN","BPSOSCC",132,0)
AUTTRLSH()         ; relationship - pointer to ^AUTTRLSH
"RTN","BPSOSCC",133,0)
 Q 0
"RTN","BPSOSCC",134,0)
ELGCLAR()          ; Eligibility clarification code
"RTN","BPSOSCC",135,0)
 Q ""
"RTN","BPSOSCC",136,0)
PERSON() ; Person Code
"RTN","BPSOSCC",137,0)
 N X
"RTN","BPSOSCC",138,0)
 I X="" S X="0"_$$INSREL
"RTN","BPSOSCC",139,0)
 Q X
"RTN","BPSOSCC",140,0)
INSGRP() I PINSTYPE'="PRVT" Q ""
"RTN","BPSOSCC",141,0)
 N X S X=$$INS3PPH Q:'X ""
"RTN","BPSOSCC",142,0)
 Q 0
"RTN","BPSOSCC",143,0)
INS3PPH()           Q 0
"RTN","BPSOSCC",144,0)
INSPOL() ;
"RTN","BPSOSCC",145,0)
 Q 0
"RTN","BPSOSCC",146,0)
CAIDNAME()         Q 0
"RTN","BPSOSCC",147,0)
CARENAME()         Q 0
"RTN","BPSOSCC",148,0)
SWTYPE(D)          ;EP - from BPSOSC4 - given pointer to dial-out
"RTN","BPSOSCC",149,0)
 ; Is it NDC or ENVOY?
"RTN","BPSOSCC",150,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) Q "VA"  ;LJE;6/30/03
"RTN","BPSOSCC",151,0)
 N X S X=^BPS(9002313.55,D,0)
"RTN","BPSOSCC",152,0)
 I $P(X,U,3)]"" Q $P(X,U,3)
"RTN","BPSOSCC",153,0)
 I $P(X,U)["NDC" Q "NDC"
"RTN","BPSOSCC",154,0)
 I $P(X,U)["ENVOY" Q "ENVOY"
"RTN","BPSOSCC",155,0)
 D IMPOSS^BPSOSUE("P","TI","Bad switch type for dialout "_D,,"SWTYPE",$T(+0))
"RTN","BPSOSCC",156,0)
 Q "" ; should never happen
"RTN","BPSOSCD")
0^144^B46650072
"RTN","BPSOSCD",1,0)
BPSOSCD ;BHAM ISC/FCS/DRS/DLF - Set BPS() "RX" nodes for current medication ;06/01/2004
"RTN","BPSOSCD",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSCD",3,0)
 Q
"RTN","BPSOSCD",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCD",5,0)
 ;Set BPS() "RX" nodes for current medication:
"RTN","BPSOSCD",6,0)
 ;
"RTN","BPSOSCD",7,0)
 ;Parameters:   VMEDINFO  - Contains VMEDIEN,RXIEN,RXRFIEN,VCPTIEN
"RTN","BPSOSCD",8,0)
 ;              MEDN      - Index number indicating what medication is
"RTN","BPSOSCD",9,0)
 ;                          being processed
"RTN","BPSOSCD",10,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCD",11,0)
 ; Called from BPSOSCA from BPSOSQG from BPSOSQ2,
"RTN","BPSOSCD",12,0)
 ; once for each item in its VMEDS() array.
"RTN","BPSOSCD",13,0)
MEDINFO(VMEDINFO,MEDN,INSPINS) ;EP
"RTN","BPSOSCD",14,0)
 ;Manage local variables
"RTN","BPSOSCD",15,0)
 N VMEDIEN,RXIEN,RXRFIEN,DRUGIEN,PROVIEN,VCPTIEN,RXI,IEN59,PINSTYPE
"RTN","BPSOSCD",16,0)
 N FILLDT
"RTN","BPSOSCD",17,0)
 ;
"RTN","BPSOSCD",18,0)
 ;Parse variables from VMEDINFO variable
"RTN","BPSOSCD",19,0)
 S VMEDIEN=$P(VMEDINFO,U,1)
"RTN","BPSOSCD",20,0)
 S RXIEN=$P(VMEDINFO,U,2)
"RTN","BPSOSCD",21,0)
 S RXRFIEN=$P(VMEDINFO,U,3)
"RTN","BPSOSCD",22,0)
 S VCPTIEN=$P(VMEDINFO,U,4)
"RTN","BPSOSCD",23,0)
 S IEN59=$P(VMEDINFO,U,5) ; 06/23/2000
"RTN","BPSOSCD",24,0)
 D OVERRIDE(IEN59,MEDN) ; overrides stored in 9002313.511
"RTN","BPSOSCD",25,0)
 ;
"RTN","BPSOSCD",26,0)
 ;IHS/SD/lwj 8/20/02  NCPDP 5.1 changes - if a 5.1 claims and
"RTN","BPSOSCD",27,0)
 ; there are DUR values - retrieve them
"RTN","BPSOSCD",28,0)
 I BPS("NCPDP","Version")[5 D DURVALUE(IEN59,MEDN)
"RTN","BPSOSCD",29,0)
 ;
"RTN","BPSOSCD",30,0)
 ;
"RTN","BPSOSCD",31,0)
 S PINSTYPE=$P(INSPINS,",") ; "CAID" will make a difference
"RTN","BPSOSCD",32,0)
 ;
"RTN","BPSOSCD",33,0)
 S DRUGIEN=$P($G(^PSRX(RXIEN,0)),U,6)
"RTN","BPSOSCD",34,0)
 S PROVIEN=$P($G(^PSRX(RXIEN,0)),U,4)
"RTN","BPSOSCD",35,0)
 ;
"RTN","BPSOSCD",36,0)
 S BPS("RX",MEDN,"VCPT IEN")=VCPTIEN
"RTN","BPSOSCD",37,0)
 S BPS("RX",MEDN,"IEN59")=IEN59 ; 06/23/2000
"RTN","BPSOSCD",38,0)
 S (RXI,BPS("RX",MEDN,"RX IEN"))=RXIEN
"RTN","BPSOSCD",39,0)
 S BPS("RX",MEDN,"Date Written")=$P($G(^PSRX(RXIEN,0)),U,13)
"RTN","BPSOSCD",40,0)
 S BPS("RX",MEDN,"RX Number")=RXIEN
"RTN","BPSOSCD",41,0)
 S BPS("RX",MEDN,"New/Refill")=$S(RXRFIEN="":"N",1:"R")
"RTN","BPSOSCD",42,0)
 ;
"RTN","BPSOSCD",43,0)
 ;IHS/SD/lwj 8/30/02  NCPDP 5.1 changes 
"RTN","BPSOSCD",44,0)
 ; Version 3.2 uses field 416 for the prior auth code and number
"RTN","BPSOSCD",45,0)
 ; Version 5.1 will use fields 461 and 462
"RTN","BPSOSCD",46,0)
 ; Below line remarked out, next three lines added
"RTN","BPSOSCD",47,0)
 ;
"RTN","BPSOSCD",48,0)
 S BPS("RX",MEDN,"Preauth #")=$P(^BPST(IEN59,1),U,15)_$P(^BPST(IEN59,1),U,9)
"RTN","BPSOSCD",49,0)
 ;
"RTN","BPSOSCD",50,0)
 ; Get Service Date
"RTN","BPSOSCD",51,0)
 ; It should be in BPS Transaction.  If not, use the established algorithm, which
"RTN","BPSOSCD",52,0)
 ;    is $$DOSDATE^BPSSCRRS
"RTN","BPSOSCD",53,0)
 S FILLDT=$P($G(^BPST(IEN59,12)),U,2)
"RTN","BPSOSCD",54,0)
 I FILLDT="" S FILLDT=$$DOSDATE^BPSSCRRS(RXIEN,RXRFIEN)
"RTN","BPSOSCD",55,0)
 S BPS("RX",MEDN,"Date Filled")=$$FMTHL7^XLFDT(FILLDT)
"RTN","BPSOSCD",56,0)
 S BPS("Claim",MEDN,"Prior Auth Type")=$P(^BPST(IEN59,1),U,15)
"RTN","BPSOSCD",57,0)
 S BPS("Claim",MEDN,"Prior Auth Num Sub")=$P(^BPST(IEN59,1),U,9)
"RTN","BPSOSCD",58,0)
 ;
"RTN","BPSOSCD",59,0)
 I 'RXRFIEN D  ; first fill
"RTN","BPSOSCD",60,0)
 .S BPS("RX",MEDN,"Quantity")=$P($G(^PSRX(RXIEN,0)),U,7)
"RTN","BPSOSCD",61,0)
 .S BPS("RX",MEDN,"Days Supply")=$P($G(^PSRX(RXIEN,0)),U,8)
"RTN","BPSOSCD",62,0)
 .S BPS("RX",MEDN,"DAW")=$P($G(^PSRX(RXIEN,"EPH")),U,1)
"RTN","BPSOSCD",63,0)
 . D NOW^%DTC S TODAY=$P(%,".",1)
"RTN","BPSOSCD",64,0)
 E  D  ; refill
"RTN","BPSOSCD",65,0)
 .S BPS("RX",MEDN,"Quantity")=$P($G(^PSRX(RXIEN,1,RXRFIEN,0)),U,4)
"RTN","BPSOSCD",66,0)
 .S BPS("RX",MEDN,"Days Supply")=$P($G(^PSRX(RXIEN,1,RXRFIEN,0)),U,10)
"RTN","BPSOSCD",67,0)
 .S BPS("RX",MEDN,"DAW")=$P($G(^PSRX(RXIEN,1,RXRFIEN,"EPH")),U,1)
"RTN","BPSOSCD",68,0)
 S BPS("RX",MEDN,"NDC")=$$GETNDC^PSONDCUT(RXIEN,RXRFIEN)
"RTN","BPSOSCD",69,0)
 S BPS("RX",MEDN,"# Refills")=$P($G(^PSRX(RXIEN,0)),U,9)
"RTN","BPSOSCD",70,0)
 S BPS("RX",MEDN,"Refill #")=$$RXRFN(RXIEN,RXRFIEN)
"RTN","BPSOSCD",71,0)
 S BPS("RX",MEDN,"Prescriber IEN")=+PROVIEN
"RTN","BPSOSCD",72,0)
 D STLIC^BPSJPAY(MEDN,PROVIEN,BPS("RX",MEDN,"Date Filled"))
"RTN","BPSOSCD",73,0)
 I PROVIEN'="" D  ;had to do this for certification
"RTN","BPSOSCD",74,0)
 .S BPS("RX",MEDN,"Prescriber Name")=$$GET1^DIQ(200,+PROVIEN,.01) ;LJE;7/7/03
"RTN","BPSOSCD",75,0)
 .S BPS("RX",MEDN,"Prescriber Phone #")=$$GET1^DIQ(200,+PROVIEN,.131) ;LJE;7/7/03
"RTN","BPSOSCD",76,0)
 .I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S BPS("RX",MEDN,"Prescriber DEA #")=$G(BPS("RX",1,"Provider ID"))
"RTN","BPSOSCD",77,0)
 .S BPS("RX",MEDN,"Prescriber DEA #")=$$GET1^DIQ(200,+PROVIEN,53.2)
"RTN","BPSOSCD",78,0)
 .S BPS("RX",MEDN,"Prescriber CAID #")=""
"RTN","BPSOSCD",79,0)
 .S BPS("RX",MEDN,"Prescriber UPIN #")=""
"RTN","BPSOSCD",80,0)
 .S BPS("RX",MEDN,"Prescriber Billing Location")="" ; ANMC only?  not in Sitka's data dic.
"RTN","BPSOSCD",81,0)
 S BPS("RX",MEDN,"Alt. Product Type")="03" ;lje;7/15/03
"RTN","BPSOSCD",82,0)
 S BPS("RX",MEDN,"Gross Amount Due")=$G(VAINFO(9002313.59902,VAINSDA1_","_VAINSDA_",",902.15,"I")) ;LJE
"RTN","BPSOSCD",83,0)
 S BPS("RX",MEDN,"Usual & Customary")=$G(VAINFO(9002313.59902,VAINSDA1_","_VAINSDA_",",902.14,"I")) ;LJE
"RTN","BPSOSCD",84,0)
 S BPS("RX",MEDN,"Basis of Cost Determination")=$G(VAINFO(9002313.59902,VAINSDA1_","_VAINSDA_",",902.13,"I")) ;LJE
"RTN","BPSOSCD",85,0)
 S (VANATURE,VAOIEN)="",VAOIEN=$P($G(^PSRX(RXIEN,"OR1")),"^",2),VANATURE=$$GET1^DIQ(100.008,"1,"_VAOIEN_",","12")
"RTN","BPSOSCD",86,0)
 S BPS("RX",MEDN,"Origin Code")=$S(VANATURE="AUTO":2,VANATURE["ELECTRONIC":3,VANATURE="DUPLICATE":0,VANATURE["TELEPHONE":2,1:1)
"RTN","BPSOSCD",87,0)
 K VANATURE,VAOIEN ;LJE;7/16/03
"RTN","BPSOSCD",88,0)
 D
"RTN","BPSOSCD",89,0)
 . N %
"RTN","BPSOSCD",90,0)
 . I PINSTYPE="CAID" D
"RTN","BPSOSCD",91,0)
 . . S %=BPS("RX",MEDN,"Prescriber CAID #")
"RTN","BPSOSCD",92,0)
 . . I %="" D  ; special for ANMC
"RTN","BPSOSCD",93,0)
 . . . N X1 S X1=BPS("RX",MEDN,"Prescriber Billing Location")
"RTN","BPSOSCD",94,0)
 . . . S %=$S(X1=1665:"MDG275",X1=1946:"MDG867",1:"")
"RTN","BPSOSCD",95,0)
 . . I %="" S %=BPS("Site","Default CAID #")
"RTN","BPSOSCD",96,0)
 . E  D
"RTN","BPSOSCD",97,0)
 . . S %=BPS("RX",MEDN,"Prescriber DEA #")
"RTN","BPSOSCD",98,0)
 . . I %="" S %=BPS("Site","Default DEA #")
"RTN","BPSOSCD",99,0)
 . S BPS("RX",MEDN,"Prescriber ID")=%
"RTN","BPSOSCD",100,0)
 ;
"RTN","BPSOSCD",101,0)
 D:DRUGIEN'=""
"RTN","BPSOSCD",102,0)
 .S BPS("RX",MEDN,"Drug IEN")=DRUGIEN
"RTN","BPSOSCD",103,0)
 .S BPS("RX",MEDN,"Drug Name")=$P($G(^PSDRUG(DRUGIEN,0)),U,1)
"RTN","BPSOSCD",104,0)
 N PRICING S PRICING=^BPST(IEN59,5)
"RTN","BPSOSCD",105,0)
 S BPS("RX",MEDN,"Quantity")=$P(PRICING,U) ; 01/31/2001
"RTN","BPSOSCD",106,0)
 S BPS("RX",MEDN,"Unit Price")=$P(PRICING,U,2)
"RTN","BPSOSCD",107,0)
 S BPS("RX",MEDN,"Ingredient Cost")=$J($P(PRICING,U,2),0,2)
"RTN","BPSOSCD",108,0)
 S BPS("RX",MEDN,"Dispensing Fee")=$J($P(PRICING,U,4),0,2)
"RTN","BPSOSCD",109,0)
 S BPS("Site","Dispensing Fee")=BPS("RX",MEDN,"Dispensing Fee")
"RTN","BPSOSCD",110,0)
 I '$G(VARX) S BPS("RX",MEDN,"Gross Amount Due")=$J($P(PRICING,U,5),0,2) ;LJE;7/21/03
"RTN","BPSOSCD",111,0)
 S BPS("RX",MEDN,"Usual & Customary")=$J($P(PRICING,U,5),0,2)
"RTN","BPSOSCD",112,0)
 I $G(BPS("NCPDP","Add Disp. Fee to Ingr. Cost")) D  ;LJE;ADDED $G
"RTN","BPSOSCD",113,0)
 . N X S X=BPS("RX",MEDN,"Ingredient Cost")
"RTN","BPSOSCD",114,0)
 . S X=X+BPS("RX",MEDN,"Dispensing Fee")
"RTN","BPSOSCD",115,0)
 . S BPS("RX",MEDN,"Ingredient Cost")=X
"RTN","BPSOSCD",116,0)
 ;
"RTN","BPSOSCD",117,0)
 ; Visit-related data
"RTN","BPSOSCD",118,0)
 ;
"RTN","BPSOSCD",119,0)
 I IEN59 D
"RTN","BPSOSCD",120,0)
 . N VSITIEN S VSITIEN=$P(^BPST(IEN59,0),U,7)
"RTN","BPSOSCD",121,0)
 . Q:'VSITIEN
"RTN","BPSOSCD",122,0)
 Q
"RTN","BPSOSCD",123,0)
 ;
"RTN","BPSOSCD",124,0)
 ; $$RXRFN()
"RTN","BPSOSCD",125,0)
 ;Determine RX Refill Number based on prescription record
"RTN","BPSOSCD",126,0)
 ;  It's overly cautious about making sure that the refills are
"RTN","BPSOSCD",127,0)
 ;  counted in date filled order.
"RTN","BPSOSCD",128,0)
 ;
"RTN","BPSOSCD",129,0)
 ;Input Variables:    RXIEN    -  Prescription record IEN (52)
"RTN","BPSOSCD",130,0)
 ;                    RXRFIEN  -  Refill multiple IEN
"RTN","BPSOSCD",131,0)
 ;
"RTN","BPSOSCD",132,0)
 ;Function Returns:   Null  - Could not process request
"RTN","BPSOSCD",133,0)
 ;                    0     - Not a refill
"RTN","BPSOSCD",134,0)
 ;                    N     - Refill number
"RTN","BPSOSCD",135,0)
 ; Copied into here from BPSECD4 so we can remove BPSECD4 from kit.
"RTN","BPSOSCD",136,0)
 ; Also called from BPSOSN3
"RTN","BPSOSCD",137,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCD",138,0)
RXRFN(RXIEN,RXRFIEN) ;EP
"RTN","BPSOSCD",139,0)
 ;Manage local variables
"RTN","BPSOSCD",140,0)
 N COUNT,DATE,XIEN,STOP
"RTN","BPSOSCD",141,0)
 ;
"RTN","BPSOSCD",142,0)
 ;Make sure input variables are defined
"RTN","BPSOSCD",143,0)
 Q:$G(RXIEN)="" ""
"RTN","BPSOSCD",144,0)
 Q:$G(RXRFIEN)="" ""
"RTN","BPSOSCD",145,0)
 ;
"RTN","BPSOSCD",146,0)
 ;Initialize local variables
"RTN","BPSOSCD",147,0)
 S (COUNT,STOP)=0
"RTN","BPSOSCD",148,0)
 ;
"RTN","BPSOSCD",149,0)
 ;Loop through refill multiple by date
"RTN","BPSOSCD",150,0)
 S DATE=""
"RTN","BPSOSCD",151,0)
 F  D  Q:'+DATE!(STOP)
"RTN","BPSOSCD",152,0)
 .S DATE=$O(^PSRX(RXIEN,1,"B",DATE))
"RTN","BPSOSCD",153,0)
 .Q:'+DATE
"RTN","BPSOSCD",154,0)
 .;
"RTN","BPSOSCD",155,0)
 .;For each sub-record increment refill count
"RTN","BPSOSCD",156,0)
 .S XIEN=""
"RTN","BPSOSCD",157,0)
 .F  D  Q:'+XIEN!(STOP)
"RTN","BPSOSCD",158,0)
 ..S XIEN=$O(^PSRX(RXIEN,1,"B",DATE,XIEN))
"RTN","BPSOSCD",159,0)
 ..Q:'+XIEN
"RTN","BPSOSCD",160,0)
 ..S COUNT=COUNT+1
"RTN","BPSOSCD",161,0)
 ..;
"RTN","BPSOSCD",162,0)
 ..;STOP when you reach the refill record
"RTN","BPSOSCD",163,0)
 ..S:XIEN=RXRFIEN STOP=1
"RTN","BPSOSCD",164,0)
 Q $S(STOP=1:COUNT,1:0)
"RTN","BPSOSCD",165,0)
 ;
"RTN","BPSOSCD",166,0)
 ; Retrieve OVERRIDE nodes and put into BPS array
"RTN","BPSOSCD",167,0)
 ; They will be fetched from BPS("OVERRIDE"
"RTN","BPSOSCD",168,0)
 ; during low-level construction of the actual encoded claim packet.
"RTN","BPSOSCD",169,0)
 ;
"RTN","BPSOSCD",170,0)
OVERRIDE(IEN59,MEDN)    ; set any BPS("OVERRIDE" nodes from 9002313.511 data
"RTN","BPSOSCD",171,0)
 ; BPS("OVERRIDE",field)=value  for fields 101-401
"RTN","BPSOSCD",172,0)
 ; BPS("OVERRIDE","RX",MEDN,field) for med #N, fields 402+
"RTN","BPSOSCD",173,0)
 ; Note that if you have multiple prescriptions bundled, the
"RTN","BPSOSCD",174,0)
 ; union of overrides from 101-401 apply to all; and if there's a 
"RTN","BPSOSCD",175,0)
 ; conflict, the last one overwrites the previous ones.
"RTN","BPSOSCD",176,0)
 N IEN511 S IEN511=$P(^BPST(IEN59,1),U,13) Q:'IEN511
"RTN","BPSOSCD",177,0)
 N RETVAL S RETVAL=$$GET511^BPSOSO2(IEN511,"BPS(""OVERRIDE"")","BPS(""OVERRIDE"",""RX"","_MEDN_")")
"RTN","BPSOSCD",178,0)
CC Q
"RTN","BPSOSCD",179,0)
 ;
"RTN","BPSOSCD",180,0)
DURVALUE(IEN59,MEDN)         ;IHS/SD/lwj 8/20/02 NCPDP 5.1 changes
"RTN","BPSOSCD",181,0)
 ; This subroutine will read in the DUR data from the DUR multiple
"RTN","BPSOSCD",182,0)
 ; in BPS Transactions and store the values into BPS("RX",MEDN,DUR,....)
"RTN","BPSOSCD",183,0)
 ;
"RTN","BPSOSCD",184,0)
 ; (NOTE - unlike most values, these fields are stored by their
"RTN","BPSOSCD",185,0)
 ; field number.  Since they are repeating, it will ease the 
"RTN","BPSOSCD",186,0)
 ; retrieval of them, when we populate the claim.)
"RTN","BPSOSCD",187,0)
 ;
"RTN","BPSOSCD",188,0)
 N DUR,DCNT,DURREC
"RTN","BPSOSCD",189,0)
 ;
"RTN","BPSOSCD",190,0)
 S (DUR,DCNT)=0
"RTN","BPSOSCD",191,0)
 F  S DCNT=$O(^BPST(IEN59,13,DCNT)) Q:'+DCNT  D
"RTN","BPSOSCD",192,0)
 . S DURREC=$G(^BPST(IEN59,13,DCNT,0))
"RTN","BPSOSCD",193,0)
 . I DURREC="" Q
"RTN","BPSOSCD",194,0)
 . S DUR=DUR+1
"RTN","BPSOSCD",195,0)
 . S BPS("RX",MEDN,"DUR",DUR,473)=DUR  ;dur/pps cntr
"RTN","BPSOSCD",196,0)
 . S BPS("RX",MEDN,"DUR",DUR,439)=$P(DURREC,U,2) ;Reason Srv Cd
"RTN","BPSOSCD",197,0)
 . S BPS("RX",MEDN,"DUR",DUR,440)=$P(DURREC,U,3) ;Prof Srv Cd
"RTN","BPSOSCD",198,0)
 . S BPS("RX",MEDN,"DUR",DUR,441)=$P(DURREC,U,4) ;Result Src Cd
"RTN","BPSOSCD",199,0)
 . S BPS("RX",MEDN,"DUR",DUR,474)=""             ;Level of Effort
"RTN","BPSOSCD",200,0)
 . S BPS("RX",MEDN,"DUR",DUR,475)=""             ;Co-agent Qual
"RTN","BPSOSCD",201,0)
 . S BPS("RX",MEDN,"DUR",DUR,476)=""             ;Co-agent ID
"RTN","BPSOSCD",202,0)
 ;
"RTN","BPSOSCD",203,0)
 Q
"RTN","BPSOSCE")
0^145^B25894685
"RTN","BPSOSCE",1,0)
BPSOSCE ;BHAM ISC/FCS/DRS/DLF - New entry in 9002313.02 ;06/01/2004
"RTN","BPSOSCE",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSCE",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCE",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCE",5,0)
 ;Creates an Electronic Claim Submission record
"RTN","BPSOSCE",6,0)
 ;
"RTN","BPSOSCE",7,0)
 ;Parameters:  START     - START Medication Number
"RTN","BPSOSCE",8,0)
 ;             END       - END Medication Number
"RTN","BPSOSCE",9,0)
 ;             TOTAL     - TOTAL Medications in Claim
"RTN","BPSOSCE",10,0)
 ;   the BPS(*) array pointed to by START, END
"RTN","BPSOSCE",11,0)
 ;
"RTN","BPSOSCE",12,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCE",13,0)
 ; NEWCLAIM^BPSOSCE called from BPSOSCA from BPSOSQG from BPSOSQ2
"RTN","BPSOSCE",14,0)
 ;
"RTN","BPSOSCE",15,0)
 ;IHS/SD/lwj  08/01/02  NCPDP 5.1 changes
"RTN","BPSOSCE",16,0)
 ; This routine is responsible for creating a new entry in the 
"RTN","BPSOSCE",17,0)
 ; claims file, and for calling the routines that then populate
"RTN","BPSOSCE",18,0)
 ; that new entry.
"RTN","BPSOSCE",19,0)
 ; 
"RTN","BPSOSCE",20,0)
 ; For 5.1 we needed to adjust this routine just a little.  In 3.2
"RTN","BPSOSCE",21,0)
 ; there were only 4 segments to a claim, in 5.1 there are 14, so
"RTN","BPSOSCE",22,0)
 ; as we loop through the calling of BPSOSCF to populate the claim
"RTN","BPSOSCE",23,0)
 ; file we will verify which version of claim we are working with
"RTN","BPSOSCE",24,0)
 ; and adjust the calling appropriately.  Worthy of noting is that
"RTN","BPSOSCE",25,0)
 ; the "header" portion of the claim in 5.1 is comprised of 3 
"RTN","BPSOSCE",26,0)
 ; segments - 100 (Header), 110 (Insurance) and 120 (Patient).  The
"RTN","BPSOSCE",27,0)
 ; "detail" or "rx" portion of the claim will hold the remaining
"RTN","BPSOSCE",28,0)
 ; 11 segments.
"RTN","BPSOSCE",29,0)
 ;
"RTN","BPSOSCE",30,0)
 ; I also had to create a new BPS field (i.e. "Transaction Count")
"RTN","BPSOSCE",31,0)
 ; to track the number of transactions per claim.
"RTN","BPSOSCE",32,0)
 ;
"RTN","BPSOSCE",33,0)
 Q
"RTN","BPSOSCE",34,0)
 ;
"RTN","BPSOSCE",35,0)
NEWCLAIM(START,END,TOTAL) ;EP
"RTN","BPSOSCE",36,0)
 ;Manage local variables
"RTN","BPSOSCE",37,0)
 N CLAIMID,DIC,DLAYGO,X,Y,COUNT,INDEX,DIK,DA,NODE0,ROU S ROU=$T(+0)
"RTN","BPSOSCE",38,0)
 ;
"RTN","BPSOSCE",39,0)
 S VARX=0 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1
"RTN","BPSOSCE",40,0)
 ;Create new record in Claim Submission File (9002313.02)
"RTN","BPSOSCE",41,0)
L L +^TMP($J,"BPSOSCE"):300 I '$T G L:$$IMPOSS^BPSOSUE("L","RTI","Single-threaded routine",,,$T(+0))
"RTN","BPSOSCE",42,0)
 S CLAIMID=$$CLAIMID^BPSECX1(BPS("NCPDP","IEN"),"P")
"RTN","BPSOSCE",43,0)
 S DLAYGO=9002313.02,DIC="^BPSC(",DIC(0)="LXZ",X=CLAIMID
"RTN","BPSOSCE",44,0)
 D ^DIC S Y=+Y
"RTN","BPSOSCE",45,0)
 L -^TMP($J,"BPSOSCE")
"RTN","BPSOSCE",46,0)
 I Y<1 D  S ERROR=8002 Q
"RTN","BPSOSCE",47,0)
 .D LOG(ROU_" - Failed to create an entry in file 9002313.02")
"RTN","BPSOSCE",48,0)
 ;
"RTN","BPSOSCE",49,0)
 S BPS(9002313.02)=Y
"RTN","BPSOSCE",50,0)
 D LOG(ROU_" - Created claim ID "_CLAIMID_" (IEN "_BPS(9002313.02)_")")
"RTN","BPSOSCE",51,0)
 S NODE0=$G(^BPSC(BPS(9002313.02),0))
"RTN","BPSOSCE",52,0)
 S $P(NODE0,U,2)=BPS("Insurer","IEN")
"RTN","BPSOSCE",53,0)
 S $P(NODE0,U,4)=2 ; TRANSMIT FLAG - use 2 instead of 1 because
"RTN","BPSOSCE",54,0)
 ;  ANMC is running ECME and Traditional batch file together and we
"RTN","BPSOSCE",55,0)
 ;  want to be entirely sure of no conflicts
"RTN","BPSOSCE",56,0)
 S $P(NODE0,U,6)=$$NOWFM^BPSOSU1()
"RTN","BPSOSCE",57,0)
 S ^BPSC(BPS(9002313.02),0)=NODE0
"RTN","BPSOSCE",58,0)
 S $P(^BPSC(BPS(9002313.02),1),U)=BPS("Patient","Name")
"RTN","BPSOSCE",59,0)
 ;
"RTN","BPSOSCE",60,0)
 S:BPS("NCPDP","Version")[3 BPS("Transaction Code")=TOTAL
"RTN","BPSOSCE",61,0)
 ;       
"RTN","BPSOSCE",62,0)
 I TOTAL'<1,TOTAL'>4 S BPS("Transaction Code")="B1"  ;LJE;7/21/03
"RTN","BPSOSCE",63,0)
 I (TOTAL=11)!(TOTAL="B2") S BPS("Transaction Code")="B2"  ;LJE;7/21/03
"RTN","BPSOSCE",64,0)
 ;
"RTN","BPSOSCE",65,0)
 ; IHS/SD/lwj 8/5/02 NCPDP 5.1 - the value of field 103 changed
"RTN","BPSOSCE",66,0)
 ;  from being either the number of transactions for billing, or
"RTN","BPSOSCE",67,0)
 ;  an 11 for reversal, to a B1 for billing or a B2 for reversal
"RTN","BPSOSCE",68,0)
 ;  5.1 also requires that we send the number of transactions in
"RTN","BPSOSCE",69,0)
 ;  the claim.  So...for reversals we will set this to 1, and for
"RTN","BPSOSCE",70,0)
 ;  all others, we can still use TOTAL
"RTN","BPSOSCE",71,0)
 ;
"RTN","BPSOSCE",72,0)
 S BPS("Transaction Count")=TOTAL
"RTN","BPSOSCE",73,0)
 I TOTAL=11 S BPS("Transaction Count")=1   ;only 1 rev at a time
"RTN","BPSOSCE",74,0)
 ;
"RTN","BPSOSCE",75,0)
 ; IHS/SD/lwj 8/1/02  begin the 5.1 changes for the "header" section
"RTN","BPSOSCE",76,0)
 ; If the claim type is 3.2 we will call BPSOSCF with nodes 10
"RTN","BPSOSCE",77,0)
 ; and 20 - if it is 5.1, we will call with 100,110 and 120.
"RTN","BPSOSCE",78,0)
 ;
"RTN","BPSOSCE",79,0)
 D
"RTN","BPSOSCE",80,0)
 . N SEG,SEGBEG,SEGEND
"RTN","BPSOSCE",81,0)
 . I BPS("NCPDP","Version")[3 S SEGBEG=10,SEGEND=20
"RTN","BPSOSCE",82,0)
 . I BPS("NCPDP","Version")[5 S SEGBEG=100,SEGEND=120
"RTN","BPSOSCE",83,0)
 . F SEG=SEGBEG:10:SEGEND D
"RTN","BPSOSCE",84,0)
 .. D XLOOP^BPSOSCF(BPS("NCPDP","IEN"),SEG)
"RTN","BPSOSCE",85,0)
 ;
"RTN","BPSOSCE",86,0)
 ;Create multiple zero node
"RTN","BPSOSCE",87,0)
 S ^BPSC(BPS(9002313.02),400,0)="^9002313.0201PA^^"
"RTN","BPSOSCE",88,0)
 ;
"RTN","BPSOSCE",89,0)
 S COUNT=0
"RTN","BPSOSCE",90,0)
 F INDEX=START:1:END D
"RTN","BPSOSCE",91,0)
 .;Create prescription record
"RTN","BPSOSCE",92,0)
 .S COUNT=COUNT+1
"RTN","BPSOSCE",93,0)
 .S NODE0=""
"RTN","BPSOSCE",94,0)
 .S $P(NODE0,U,1)=INDEX
"RTN","BPSOSCE",95,0)
 .S $P(NODE0,U,2)=$G(BPS("RX",INDEX,"VCPT IEN"))
"RTN","BPSOSCE",96,0)
 .S $P(NODE0,U,3)=INDEX
"RTN","BPSOSCE",97,0)
 .S $P(NODE0,U,4)=$G(BPS("RX",INDEX,"Drug Name"))
"RTN","BPSOSCE",98,0)
 .I ^BPS(9002313.99,1,"CERTIFIER")'=DUZ S $P(NODEO,U,5)=BPS("RX",INDEX,"RX IEN") ;LJE;7/27/03  FOR SOME REASON IT GETS OVERLAYED ELSEWHERE
"RTN","BPSOSCE",99,0)
 .S ^BPSC(BPS(9002313.02),400,INDEX,0)=NODE0
"RTN","BPSOSCE",100,0)
 . I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S INDEX=1 ;LJE
"RTN","BPSOSCE",101,0)
 . I 'VARX S $P(^BPSC(BPS(9002313.02),400,INDEX,400),U,1)=$$DTF1^BPSECFM($G(BPS("RX",INDEX,"Date Filled")))
"RTN","BPSOSCE",102,0)
 . E  D
"RTN","BPSOSCE",103,0)
 . . S $P(^BPSC(BPS(9002313.02),400,INDEX,400),U,1)=BPS("RX",INDEX,"Date Filled")
"RTN","BPSOSCE",104,0)
 .S BPS(9002313.0201)=INDEX ;07/28/96.
"RTN","BPSOSCE",105,0)
 .;
"RTN","BPSOSCE",106,0)
 .; IHS/SD/lwj 8/1/02 begin changes for NCPDP 5.1 - subroutine called 
"RTN","BPSOSCE",107,0)
 .; to lessen the looping here
"RTN","BPSOSCE",108,0)
 .; First we will remark out the old code
"RTN","BPSOSCE",109,0)
 .;       Execute claim information (required) code
"RTN","BPSOSCE",110,0)
 .;       D XLOOP^BPSOSCF(BPS("NCPDP","IEN"),30,INDEX)
"RTN","BPSOSCE",111,0)
 .;
"RTN","BPSOSCE",112,0)
 .;       Execute claim information (optional) code
"RTN","BPSOSCE",113,0)
 .;       D XLOOP^BPSOSCF(BPS("NCPDP","IEN"),40,INDEX)
"RTN","BPSOSCE",114,0)
 .;
"RTN","BPSOSCE",115,0)
 .; Now let's call the subroutine to process
"RTN","BPSOSCE",116,0)
 . D PROCRX
"RTN","BPSOSCE",117,0)
 .;
"RTN","BPSOSCE",118,0)
 .; IHS/SD/lwj end changes for 5.1 rx detail
"RTN","BPSOSCE",119,0)
 .;
"RTN","BPSOSCE",120,0)
 .S ^BPSC(BPS(9002313.02),400,"B",INDEX,INDEX)=""
"RTN","BPSOSCE",121,0)
 .S ^BPSC(BPS(9002313.02),400,"AC",INDEX,INDEX)=""
"RTN","BPSOSCE",122,0)
 .S NODE0=$G(^BPSC(BPS(9002313.02),400,0))
"RTN","BPSOSCE",123,0)
 .S $P(NODE0,U,4)=COUNT
"RTN","BPSOSCE",124,0)
 .S $P(NODE0,U,3)=$O(^BPSC(BPS(9002313.02),400,"A"),-1)
"RTN","BPSOSCE",125,0)
 .S ^BPSC(BPS(9002313.02),400,0)=NODE0
"RTN","BPSOSCE",126,0)
 .S $P(^BPSC(BPS(9002313.02),400,INDEX,0),"^",4)=$G(BPS("RX",INDEX,"Drug Name"))
"RTN","BPSOSCE",127,0)
 .S $P(^BPSC(BPS(9002313.02),400,INDEX,0),"^",5)=$G(BPS("RX",INDEX,"RX IEN")) ;LJE
"RTN","BPSOSCE",128,0)
 ;
"RTN","BPSOSCE",129,0)
 ;Cross-Reference Claim Submission Record
"RTN","BPSOSCE",130,0)
 S DIK="^BPSC("
"RTN","BPSOSCE",131,0)
 S DA=BPS(9002313.02)
"RTN","BPSOSCE",132,0)
 D IX1^DIK
"RTN","BPSOSCE",133,0)
 Q
"RTN","BPSOSCE",134,0)
LOG(X) ; write the message to all of the log files for the IEN59's
"RTN","BPSOSCE",135,0)
 ; being bundled into this 9002313.02 claim (usually, up to 4 presc's)
"RTN","BPSOSCE",136,0)
 N IEN59,I
"RTN","BPSOSCE",137,0)
 F I=START:1:END D
"RTN","BPSOSCE",138,0)
 . S IEN59=BPS("RX",I,"IEN59")
"RTN","BPSOSCE",139,0)
 . D LOG59^BPSOSQ(X,IEN59)
"RTN","BPSOSCE",140,0)
 Q
"RTN","BPSOSCE",141,0)
 ;
"RTN","BPSOSCE",142,0)
PROCRX ;IHS/SD/lwj  8/1/02  This routine contains the calls to 
"RTN","BPSOSCE",143,0)
 ; BPSOSCF needed to actually get the values, and store them
"RTN","BPSOSCE",144,0)
 ; in the claim file.  It was created as a result of the major
"RTN","BPSOSCE",145,0)
 ; segment changes that took place in NCPDP 5.1.  For 3.2 claims
"RTN","BPSOSCE",146,0)
 ; we will still only call BPSOSCF with nodes 30 and 40, but for
"RTN","BPSOSCE",147,0)
 ; 5.1 claims, we will call the routine with nodes 130, 140, 150,
"RTN","BPSOSCE",148,0)
 ; 160, 170, 180, 190, 200, 210, 220, 230.  These nodes are defined
"RTN","BPSOSCE",149,0)
 ; in the BPSF(9002313.92 file.
"RTN","BPSOSCE",150,0)
 ;
"RTN","BPSOSCE",151,0)
 N SEG,SEGBEG,SEGEND
"RTN","BPSOSCE",152,0)
 I BPS("NCPDP","Version")[3 S SEGBEG=30,SEGEND=40
"RTN","BPSOSCE",153,0)
 I BPS("NCPDP","Version")[5 S SEGBEG=130,SEGEND=230
"RTN","BPSOSCE",154,0)
 F SEG=SEGBEG:10:SEGEND D
"RTN","BPSOSCE",155,0)
 . D XLOOP^BPSOSCF(BPS("NCPDP","IEN"),SEG,INDEX)
"RTN","BPSOSCE",156,0)
 ;
"RTN","BPSOSCE",157,0)
 Q
"RTN","BPSOSCF")
0^146^B29670734
"RTN","BPSOSCF",1,0)
BPSOSCF ;BHAM ISC/FCS/DRS/DLF - Low-level format of .02 ;06/01/2004
"RTN","BPSOSCF",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSCF",3,0)
 ;
"RTN","BPSOSCF",4,0)
 ; FORMAT is a pointer to 9002313.92
"RTN","BPSOSCF",5,0)
 ; NODE = 100  (5.1 Transaction Header Segment)
"RTN","BPSOSCF",6,0)
 ;        110  (5.1 Patient Segment)
"RTN","BPSOSCF",7,0)
 ;        120  (5.1 Insurance Segment)
"RTN","BPSOSCF",8,0)
 ;        130  (5.1 Claim Segment)
"RTN","BPSOSCF",9,0)
 ;        140  (5.1 Pharmacy Provider Segment)
"RTN","BPSOSCF",10,0)
 ;        150  (5.1 Prescriber Segment)
"RTN","BPSOSCF",11,0)
 ;        160  (5.1 COB/Other Payments Segment)
"RTN","BPSOSCF",12,0)
 ;        170  (5.1 Worker's Compensation Segment)
"RTN","BPSOSCF",13,0)
 ;        180  (5.1 DUR/PPS Segment)
"RTN","BPSOSCF",14,0)
 ;        190  (5.1 Pricing Segment)
"RTN","BPSOSCF",15,0)
 ;        200  (5.1 Coupon Segment)
"RTN","BPSOSCF",16,0)
 ;        210  (5.1 Compound Segment)
"RTN","BPSOSCF",17,0)
 ;        220  (5.1 Prior Authorization Segment)
"RTN","BPSOSCF",18,0)
 ;        230  (5.1 Clinical Segment)
"RTN","BPSOSCF",19,0)
 ; MEDN set to reflect the prescription for nodes 130 - 230
"RTN","BPSOSCF",20,0)
 ;
"RTN","BPSOSCF",21,0)
 ; For 5.1 there is only one significant change to this routine - 
"RTN","BPSOSCF",22,0)
 ; the values used in the NODE field in the XFLDCODE subroutine
"RTN","BPSOSCF",23,0)
 ; will be now based on the version of claim we are processing.
"RTN","BPSOSCF",24,0)
 ; For 3.2 claims, we will process the 10, 20, and 30 nodes from
"RTN","BPSOSCF",25,0)
 ; from the NCPDP Field defs dictionary.  
"RTN","BPSOSCF",26,0)
 ; For 5.1, we will process 10, 25 and 30.
"RTN","BPSOSCF",27,0)
 ;
"RTN","BPSOSCF",28,0)
XLOOP(FORMAT,NODE,MEDN) ;EP
"RTN","BPSOSCF",29,0)
 N ORDER,RECMIEN,MDATA,FLDIEN,PMODE,FLAG
"RTN","BPSOSCF",30,0)
 ;
"RTN","BPSOSCF",31,0)
 ;IHS/SD/lwj 8/1/02 for 5.1, segments won't always be defined-just quit
"RTN","BPSOSCF",32,0)
 Q:(BPS("NCPDP","Version")[5)&('$D(^BPSF(9002313.92,FORMAT,NODE,0)))
"RTN","BPSOSCF",33,0)
 ;
"RTN","BPSOSCF",34,0)
 ;IHS/SD/lwj 8/20/01 for 5.1 segment 180 is the DUR/PPS segment
"RTN","BPSOSCF",35,0)
 ; this is a repeating field segment, and must be handled differently
"RTN","BPSOSCF",36,0)
 ; than the regular sections
"RTN","BPSOSCF",37,0)
 S HEADER=",1,2,3,4,92,75,5,13,76,"  ;header seg fields don't get qualifiers
"RTN","BPSOSCF",38,0)
 I ",230,220,210,200,170,160,"[NODE Q  ;210=Compound,200=coupon,170=workers comp,160=cob/other payments ;ITERATION 3 WON'T DO THESE. ;LJE
"RTN","BPSOSCF",39,0)
 I NODE=180 D DURPPS^BPSOSHF(FORMAT,NODE,MEDN) Q
"RTN","BPSOSCF",40,0)
 ;
"RTN","BPSOSCF",41,0)
 I '$D(^BPSF(9002313.92,FORMAT,NODE,0)) D IMPOSS^BPSOSUE("DB,P","TI","FORMAT="_FORMAT,"NODE="_NODE,1,$T(+0))
"RTN","BPSOSCF",42,0)
 ;
"RTN","BPSOSCF",43,0)
 S ORDER=0
"RTN","BPSOSCF",44,0)
 F  D  Q:'ORDER
"RTN","BPSOSCF",45,0)
 .S ORDER=$O(^BPSF(9002313.92,FORMAT,NODE,"B",ORDER)) Q:'ORDER
"RTN","BPSOSCF",46,0)
 .S RECMIEN=$O(^BPSF(9002313.92,FORMAT,NODE,"B",ORDER,0))
"RTN","BPSOSCF",47,0)
 .I 'RECMIEN D IMPOSS^BPSOSUE("DB","TI","NODE="_NODE,"ORDER="_ORDER,2,$T(+0))
"RTN","BPSOSCF",48,0)
 .S MDATA=^BPSF(9002313.92,FORMAT,NODE,RECMIEN,0)
"RTN","BPSOSCF",49,0)
 .S FLDIEN=$P(MDATA,U,2)
"RTN","BPSOSCF",50,0)
 .I VARX Q:FLDIEN=241!(FLDIEN=240)!(FLDIEN=93)  ;LJE;7/21/03
"RTN","BPSOSCF",51,0)
 .I 'FLDIEN D IMPOSS^BPSOSUE("DB","TI","NODE="_NODE,"RECMIEN="_RECMIEN,3,$T(+0)) ; corrupt or erroneous format file
"RTN","BPSOSCF",52,0)
 .S PMODE=$P(MDATA,U,3)
"RTN","BPSOSCF",53,0)
 .I PMODE="" S PMODE="S" ;default it
"RTN","BPSOSCF",54,0)
 .I PMODE="X",$P(^BPSF(9002313.91,FLDIEN,0),U)=104 D
"RTN","BPSOSCF",55,0)
 . . ; Processor control number is different for Envoy
"RTN","BPSOSCF",56,0)
 . . ; It's always the Envoy Terminal ID, regardless of payor
"RTN","BPSOSCF",57,0)
 . . ; The XECUTE special code is only for non-Envoy
"RTN","BPSOSCF",58,0)
 . . ; Change it to "standard" mode for Envoy
"RTN","BPSOSCF",59,0)
 . . I BPS("Site","Switch Type")="ENVOY" S PMODE="S"
"RTN","BPSOSCF",60,0)
 . S FLAG=$S(PMODE="S":"GFS",1:"FS")
"RTN","BPSOSCF",61,0)
 . ; Apply any override values, as needed.
"RTN","BPSOSCF",62,0)
 . N OVERRIDE ; the override value, if any
"RTN","BPSOSCF",63,0)
 . I $D(MEDN) D  ; for a prescription detail
"RTN","BPSOSCF",64,0)
 . . I $D(BPS("OVERRIDE","RX",MEDN,FLDIEN)) D
"RTN","BPSOSCF",65,0)
 . . . S OVERRIDE=BPS("OVERRIDE","RX",MEDN,FLDIEN)
"RTN","BPSOSCF",66,0)
 . E  D  ; for patient/header info
"RTN","BPSOSCF",67,0)
 . . I $D(BPS("OVERRIDE",FLDIEN)) D
"RTN","BPSOSCF",68,0)
 . . . S OVERRIDE=BPS("OVERRIDE",FLDIEN)
"RTN","BPSOSCF",69,0)
 . ; BPS("X") is the field value as it's being computed
"RTN","BPSOSCF",70,0)
 . S BPS("X")=""
"RTN","BPSOSCF",71,0)
 . I PMODE="X" D  ; special Xecute code, in lieu of the field's Get code
"RTN","BPSOSCF",72,0)
 . . I $D(OVERRIDE) S BPS("X")=OVERRIDE
"RTN","BPSOSCF",73,0)
 . . E  D XSPCCODE(FORMAT,NODE,RECMIEN)
"RTN","BPSOSCF",74,0)
 . I $D(OVERRIDE) D
"RTN","BPSOSCF",75,0)
 . . D XFLDCODE(FLDIEN,FLAG,OVERRIDE)
"RTN","BPSOSCF",76,0)
 . E  D
"RTN","BPSOSCF",77,0)
 . . D XFLDCODE(FLDIEN,FLAG)
"RTN","BPSOSCF",78,0)
 Q
"RTN","BPSOSCF",79,0)
 ;Execute Get, Format and/or Set MUMPS code for a NCPDP Field
"RTN","BPSOSCF",80,0)
 ;
"RTN","BPSOSCF",81,0)
 ;Parameters:   FLDIEN  -  NCPDP Field Definitions IEN
"RTN","BPSOSCF",82,0)
 ;              FLAG    -  If variable contains:
"RTN","BPSOSCF",83,0)
 ;                         "G" - Execute Get Code
"RTN","BPSOSCF",84,0)
 ;                         "F" - Execute Format Code
"RTN","BPSOSCF",85,0)
 ;                         "S" - Execute S Code
"RTN","BPSOSCF",86,0)
 ;              OVERRIDE - if defined, it's used instead of Get Code
"RTN","BPSOSCF",87,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSCF",88,0)
XFLDCODE(FLDIEN,FLAG,OVERRIDE) ;EP 
"RTN","BPSOSCF",89,0)
 ;Manage local variables
"RTN","BPSOSCF",90,0)
 ;IHS/SD/lwj  8/1/02  added logic to work with the 5.1 format
"RTN","BPSOSCF",91,0)
 ; code instead of the 3.2 format code.  If the claim is for 
"RTN","BPSOSCF",92,0)
 ; 5.1, we will loop with 10, 25, 30 and if it is 3.2 we will 
"RTN","BPSOSCF",93,0)
 ; loop with 10, 20, 30.
"RTN","BPSOSCF",94,0)
 ;
"RTN","BPSOSCF",95,0)
 ; This subroutine was flagged as an entry point with the NCPDP 
"RTN","BPSOSCF",96,0)
 ; 5.1 changes.  The only call to this subroutine from outside 
"RTN","BPSOSCF",97,0)
 ; of this program is done in BPSOSHF.
"RTN","BPSOSCF",98,0)
 ;
"RTN","BPSOSCF",99,0)
 N NODE,INDEX,MCODE
"RTN","BPSOSCF",100,0)
 N FNODE                    ;IHS/SD/lwj 8/1/02 format node
"RTN","BPSOSCF",101,0)
 S FNODE=25                 ;IHS/SD/lwj 8/1/02 default to 5.1 node
"RTN","BPSOSCF",102,0)
 ;Check if record exist and FLAG variable is set correctly
"RTN","BPSOSCF",103,0)
 ; (Changed from Q: to give fatal error  10/18/2000)
"RTN","BPSOSCF",104,0)
 I 'FLDIEN D IMPOSS^BPSOSUE("DB,P","TI","FLDIEN="_FLDIEN,,"XFLDCODE",$T(+0))
"RTN","BPSOSCF",105,0)
 I '$D(^BPSF(9002313.91,FLDIEN,0)) D IMPOSS^BPSOSUE("DB,P","TI","FLDIEN="_FLDIEN,,"XFLDCODE",$T(+0))
"RTN","BPSOSCF",106,0)
 I FLAG="" D IMPOSS^BPSOSUE("DB,P","TI","FLAG null",,"XFLDCODE",$T(+0))
"RTN","BPSOSCF",107,0)
 ;
"RTN","BPSOSCF",108,0)
 ; IHS/SD/lwj 8/1/02  added next line of code
"RTN","BPSOSCF",109,0)
 I BPS("NCPDP","Version")[3 S FNODE=20
"RTN","BPSOSCF",110,0)
 ;
"RTN","BPSOSCF",111,0)
 ;Loop through Get, Format and Set Code fields and execute code
"RTN","BPSOSCF",112,0)
 ;
"RTN","BPSOSCF",113,0)
 ; IHS/SD/lwj 8/1/02  nxt line remarked out - new line added
"RTN","BPSOSCF",114,0)
 F NODE=10,FNODE,30 D
"RTN","BPSOSCF",115,0)
 .;
"RTN","BPSOSCF",116,0)
 .; IHS/SD/lwj 8/21/02 nxt line remarked out- new line added
"RTN","BPSOSCF",117,0)
 .Q:FLAG'[$S(NODE=10:"G",NODE=20:"F",NODE=25:"F",NODE=30:"S",1:"")
"RTN","BPSOSCF",118,0)
 .I VARX Q:FLDIEN=241!(FLDIEN=240)!(FLDIEN=93)  ;LJE;7/21/03
"RTN","BPSOSCF",119,0)
 .I '$D(^BPSF(9002313.91,FLDIEN,NODE,0)) D IMPOSS^BPSOSUE("DB","TI","FLDIEN="_FLDIEN,"NODE="_NODE,"XFLDCODE",$T(+0))
"RTN","BPSOSCF",120,0)
 . ;If value is being overridden, just take the override value & get out
"RTN","BPSOSCF",121,0)
 .I NODE=10,$D(OVERRIDE) S BPS("X")=OVERRIDE Q
"RTN","BPSOSCF",122,0)
 .S INDEX=0
"RTN","BPSOSCF",123,0)
 .F  D  Q:'+INDEX
"RTN","BPSOSCF",124,0)
 ..S INDEX=$O(^BPSF(9002313.91,FLDIEN,NODE,INDEX))
"RTN","BPSOSCF",125,0)
 .. Q:'+INDEX
"RTN","BPSOSCF",126,0)
 ..S QUAL="" I $G(VARX)&(NODE=30) S QUAL=$P(^BPSF(9002313.91,FLDIEN,5),"^",1) ;LJE
"RTN","BPSOSCF",127,0)
 ..I NODE=30&($G(VARX)) I $E(BPS("X"),1,2)'=QUAL&(HEADER'[(","_FLDIEN_",")) S BPS("X")=QUAL_BPS("X") ;LJE;7/16/03
"RTN","BPSOSCF",128,0)
 ..S MCODE=$G(^BPSF(9002313.91,FLDIEN,NODE,INDEX,0))
"RTN","BPSOSCF",129,0)
 ..Q:MCODE=""
"RTN","BPSOSCF",130,0)
 ..Q:$E(MCODE,1)=";"
"RTN","BPSOSCF",131,0)
 ..X MCODE
"RTN","BPSOSCF",132,0)
 Q
"RTN","BPSOSCF",133,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCF",134,0)
 ;Execute Special Code (for a NCPDP Field within a NCPDP Record)
"RTN","BPSOSCF",135,0)
 ;
"RTN","BPSOSCF",136,0)
 ;Parameters:    FORMAT  - NCPDP Record Format IEN (9002313.92)
"RTN","BPSOSCF",137,0)
 ;               NODE     - Global node value (10,20,30,40)
"RTN","BPSOSCF",138,0)
 ;               RECMIEN  - Field Multiple IEN
"RTN","BPSOSCF",139,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSCF",140,0)
XSPCCODE(FORMAT,NODE,RECMIEN) ;EP
"RTN","BPSOSCF",141,0)
 ;Manage local variables
"RTN","BPSOSCF",142,0)
 ;
"RTN","BPSOSCF",143,0)
 ; This subroutine was flagged as an entry point with the NCPDP 
"RTN","BPSOSCF",144,0)
 ; 5.1 changes.  The only call to this subroutine from outside 
"RTN","BPSOSCF",145,0)
 ; of this program is done in BPSOSHR.
"RTN","BPSOSCF",146,0)
 ;
"RTN","BPSOSCF",147,0)
 N INDEX,MCODE
"RTN","BPSOSCF",148,0)
 I '$D(^BPSF(9002313.92,FORMAT,NODE,RECMIEN,0)) D IMPOSS^BPSOSUE("DB,P","TI","no special code there to XECUTE","FORMAT="_FORMAT,"XSPCCODE",$T(+0))
"RTN","BPSOSCF",149,0)
 ;
"RTN","BPSOSCF",150,0)
 S INDEX=0
"RTN","BPSOSCF",151,0)
 F  D  Q:'+INDEX
"RTN","BPSOSCF",152,0)
 .S INDEX=$O(^BPSF(9002313.92,FORMAT,NODE,RECMIEN,1,INDEX))
"RTN","BPSOSCF",153,0)
 . Q:'+INDEX   ;I '+INDEX S BPX("X")=""  ;LJE  ;Q:'+INDEX
"RTN","BPSOSCF",154,0)
 .S MCODE=$G(^BPSF(9002313.92,FORMAT,NODE,RECMIEN,1,INDEX,0))
"RTN","BPSOSCF",155,0)
 .Q:MCODE=""
"RTN","BPSOSCF",156,0)
 .Q:$E(MCODE,1)=";"
"RTN","BPSOSCF",157,0)
 .X MCODE
"RTN","BPSOSCF",158,0)
 Q
"RTN","BPSOSCF",159,0)
 ;
"RTN","BPSOSD1")
1^147
"RTN","BPSOSEC")
1^148
"RTN","BPSOSFD")
1^153
"RTN","BPSOSH2")
0^292^B29302388
"RTN","BPSOSH2",1,0)
BPSOSH2 ;BHAM ISC/SD/lwj/DLF - Assemble formatted claim for 5.1 ;06/01/2004
"RTN","BPSOSH2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSH2",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH2",4,0)
 ; This routine is a clone of BPSECA2.  While BPSECA2 will put
"RTN","BPSOSH2",5,0)
 ; together the ascii formatted record for 3.2 claims, this routine
"RTN","BPSOSH2",6,0)
 ; will put together the ascii formatted record for 5.1 claims.
"RTN","BPSOSH2",7,0)
 ; 
"RTN","BPSOSH2",8,0)
 ; Within 5.1 there were some major changes in the creation of the
"RTN","BPSOSH2",9,0)
 ; claim.  Of significant importance are these:
"RTN","BPSOSH2",10,0)
 ;    3.2 had 4 claim segments (hdr req, hdr opt, det req, det opt) 
"RTN","BPSOSH2",11,0)
 ;    5.1 has 14 claim segments (header, patient, insurance, claim
"RTN","BPSOSH2",12,0)
 ;                                pharmacy provider, prescriber,
"RTN","BPSOSH2",13,0)
 ;                                COB, workers comp, DUR, Pricing,
"RTN","BPSOSH2",14,0)
 ;                                coupon, compound, prior auth,
"RTN","BPSOSH2",15,0)
 ;                                clinical)    
"RTN","BPSOSH2",16,0)
 ;
"RTN","BPSOSH2",17,0)
 ;    3.2 required only field identifiers and separators on optional
"RTN","BPSOSH2",18,0)
 ;        fields        
"RTN","BPSOSH2",19,0)
 ;    5.1 requires field identifiers and separators on all fields
"RTN","BPSOSH2",20,0)
 ;        other than the header
"RTN","BPSOSH2",21,0)
 ;
"RTN","BPSOSH2",22,0)
 ;    3.2 there were no segment separators
"RTN","BPSOSH2",23,0)
 ;    5.1 segment separators are required prior to each segment
"RTN","BPSOSH2",24,0)
 ;        following the header
"RTN","BPSOSH2",25,0)
 ;
"RTN","BPSOSH2",26,0)
 ;    3.2/5.1  Group separators appear at the end of each
"RTN","BPSOSH2",27,0)
 ;        transaction (prescription)
"RTN","BPSOSH2",28,0)
 ;                                           
"RTN","BPSOSH2",29,0)
 ;    5.1 we only want to send segments that have data - a new 
"RTN","BPSOSH2",30,0)
 ;        segment record will hold the data until we are sure 
"RTN","BPSOSH2",31,0)
 ;        we have something to send
"RTN","BPSOSH2",32,0)
 ;
"RTN","BPSOSH2",33,0)
 ;
"RTN","BPSOSH2",34,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH2",35,0)
 ;Put together ascii formatted record via NCPDP Record definition
"RTN","BPSOSH2",36,0)
 ;
"RTN","BPSOSH2",37,0)
 ;Input Variables:  NODES     - (100^110^120 or 
"RTN","BPSOSH2",38,0)
 ;                               130^140^150^160^170^180^190^
"RTN","BPSOSH2",39,0)
 ;                               200^210^220^230)
"RTN","BPSOSH2",40,0)
 ;                  .IEN      - Internal Entry Number array
"RTN","BPSOSH2",41,0)
 ;                  .BPS     - Formatted Data Array with claim and
"RTN","BPSOSH2",42,0)
 ;                              prescription data
"RTN","BPSOSH2",43,0)
 ;                  .REC      - Formatted Ascii record (result)
"RTN","BPSOSH2",44,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH2",45,0)
XLOOP(NODES,IEN,BPS,REC) ;EP - from BPSECA1
"RTN","BPSOSH2",46,0)
 ;Manage local variables
"RTN","BPSOSH2",47,0)
 N ORDER,RECMIEN,MDATA,FLDIEN,PMODE,FLAG,NODE,FDATA,FLDNUM,FLDDATA
"RTN","BPSOSH2",48,0)
 N INDEX,FLDID
"RTN","BPSOSH2",49,0)
 N SEGREC,DATAFND,FDATA5
"RTN","BPSOSH2",50,0)
 ;
"RTN","BPSOSH2",51,0)
 ;
"RTN","BPSOSH2",52,0)
 ;Loop through the NODES defined in NODES variable parsed by U
"RTN","BPSOSH2",53,0)
 F INDEX=1:1:$L(NODES,U) D
"RTN","BPSOSH2",54,0)
 .S NODE=$P(NODES,U,INDEX)
"RTN","BPSOSH2",55,0)
 .Q:NODE=""
"RTN","BPSOSH2",56,0)
 .Q:",230,220,210,200,170,160,"[NODE
"RTN","BPSOSH2",57,0)
 .Q:'$D(^BPSF(9002313.92,+IEN(9002313.92),NODE,0))
"RTN","BPSOSH2",58,0)
 .; Per NCPDP standard, reversals do not support segments listed below - DMB 5/2/2005
"RTN","BPSOSH2",59,0)
 .I $G(BPS(9002313.02,+$G(IEN(9002313.02)),103,"I"))="B2",",230,220,210,200,170,160,150,140,"[NODE Q
"RTN","BPSOSH2",60,0)
 .;
"RTN","BPSOSH2",61,0)
 .S DATAFND=0  ;indicates if data is on the segment for us to send
"RTN","BPSOSH2",62,0)
 .S SEGREC=""  ;holds the segment's information
"RTN","BPSOSH2",63,0)
 .;
"RTN","BPSOSH2",64,0)
 . D:NODE=180 PROCDUR
"RTN","BPSOSH2",65,0)
 .;
"RTN","BPSOSH2",66,0)
 .S ORDER=""
"RTN","BPSOSH2",67,0)
 .F  D  Q:'ORDER
"RTN","BPSOSH2",68,0)
 ..;
"RTN","BPSOSH2",69,0)
 ..Q:NODE=180    ;already had to process the DUR/PPS section (repeating)
"RTN","BPSOSH2",70,0)
 ..S ORDER=$O(^BPSF(9002313.92,+IEN(9002313.92),NODE,"B",ORDER))
"RTN","BPSOSH2",71,0)
 ..Q:'ORDER
"RTN","BPSOSH2",72,0)
 ..S RECMIEN=""
"RTN","BPSOSH2",73,0)
 ..S RECMIEN=$O(^BPSF(9002313.92,+IEN(9002313.92),NODE,"B",ORDER,RECMIEN))
"RTN","BPSOSH2",74,0)
 ..Q:RECMIEN=""
"RTN","BPSOSH2",75,0)
 ..;
"RTN","BPSOSH2",76,0)
 ..S MDATA=$G(^BPSF(9002313.92,+IEN(9002313.92),NODE,RECMIEN,0))
"RTN","BPSOSH2",77,0)
 ..Q:MDATA=""
"RTN","BPSOSH2",78,0)
 ..;
"RTN","BPSOSH2",79,0)
 ..S FLDIEN=$P(MDATA,U,2)
"RTN","BPSOSH2",80,0)
 ..Q:FLDIEN=""
"RTN","BPSOSH2",81,0)
 ..;
"RTN","BPSOSH2",82,0)
 ..S FDATA=$G(^BPSF(9002313.91,FLDIEN,0))
"RTN","BPSOSH2",83,0)
 ..Q:FDATA=""
"RTN","BPSOSH2",84,0)
 ..S FLDNUM=$P(FDATA,U,1)
"RTN","BPSOSH2",85,0)
 ..Q:FLDNUM=""
"RTN","BPSOSH2",86,0)
 ..;
"RTN","BPSOSH2",87,0)
 ..S FDATA5=$G(^BPSF(9002313.91,FLDIEN,5))   ;5.1 id and length
"RTN","BPSOSH2",88,0)
 ..S FLDID=$P(FDATA5,U,1)         ;5.1 ID
"RTN","BPSOSH2",89,0)
 ..;
"RTN","BPSOSH2",90,0)
 ..;header data
"RTN","BPSOSH2",91,0)
 ..S:NODE<130 FLDDATA=$G(BPS(9002313.02,IEN(9002313.02),FLDNUM,"I"))
"RTN","BPSOSH2",92,0)
 ..; 
"RTN","BPSOSH2",93,0)
 ..;transaction data
"RTN","BPSOSH2",94,0)
 ..S:NODE>120 FLDDATA=$G(BPS(9002313.0201,IEN(9002313.01),FLDNUM,"I"))
"RTN","BPSOSH2",95,0)
 ..;
"RTN","BPSOSH2",96,0)
 ..I FLDID'=$TR(FLDDATA,"0 {}") S DATAFND=1 ;fld chk-is the field empty?
"RTN","BPSOSH2",97,0)
 ..;
"RTN","BPSOSH2",98,0)
 ..;check if this is the seg id - call this after fld chk since 
"RTN","BPSOSH2",99,0)
 ..;we don't want to send the segment if this is all there is
"RTN","BPSOSH2",100,0)
 ..I (NODE>100)&(FLDNUM=111) S FLDDATA=$$SEGID(NODE)
"RTN","BPSOSH2",101,0)
 ..;
"RTN","BPSOSH2",102,0)
 ..I VARX Q:FLDDATA=""   ;lje;7/23/03; don't want extra field separators when field is blank for testing for WebMD.
"RTN","BPSOSH2",103,0)
 ..;
"RTN","BPSOSH2",104,0)
 ..S:NODE=100 SEGREC=SEGREC_FLDDATA  ;no FS on the header rec
"RTN","BPSOSH2",105,0)
 ..S:NODE>100 SEGREC=SEGREC_$C(28)_FLDDATA  ;FS always proceeds fld
"RTN","BPSOSH2",106,0)
 ..;
"RTN","BPSOSH2",107,0)
 .;
"RTN","BPSOSH2",108,0)
 . I 'VARX D  ;LJE;8/18/03; VMS CAN'T HANDLE MORE THAT 255 CHARACTERS
"RTN","BPSOSH2",109,0)
 . . I (DATAFND)&(NODE=100) S REC=SEGREC   ;no SS when it's the header
"RTN","BPSOSH2",110,0)
 . . I (DATAFND)&(NODE>100) S REC=REC_$C(30)_SEGREC  ;SS before the seg
"RTN","BPSOSH2",111,0)
 . E  D
"RTN","BPSOSH2",112,0)
 . . I (DATAFND)&(NODE=100) S REC(NODE)=SEGREC   ;no SS when it's the header
"RTN","BPSOSH2",113,0)
 . . I (DATAFND)&(NODE>100) D 
"RTN","BPSOSH2",114,0)
 . . . I '$D(REC(NODE)) S REC(NODE)=REC I REC[$C(29) S REC=""
"RTN","BPSOSH2",115,0)
 . . . S REC(NODE)=REC(NODE)_$C(30)_SEGREC  ;SS before the seg
"RTN","BPSOSH2",116,0)
 ;
"RTN","BPSOSH2",117,0)
 Q
"RTN","BPSOSH2",118,0)
 ;
"RTN","BPSOSH2",119,0)
SEGID(ND) ; Field 111 is the Segment Identifier - for each segment, other than
"RTN","BPSOSH2",120,0)
 ; the header, a pre-defined, unique value must be sent in this field
"RTN","BPSOSH2",121,0)
 ; to identify which segment is being sent.  This value is not stored
"RTN","BPSOSH2",122,0)
 ; in the claim - as it changes with each of the 13 segments. The
"RTN","BPSOSH2",123,0)
 ; field does appear as part of the NCPCP Format, put is simply not
"RTN","BPSOSH2",124,0)
 ; stored.
"RTN","BPSOSH2",125,0)
 ;    01 = Patient   02 = Pharmacy Provider    03 = Prescriber
"RTN","BPSOSH2",126,0)
 ;    04 = Insurance 05 = COB/Other Payment    06 = Workers Comp
"RTN","BPSOSH2",127,0)
 ;    07 = Claim     08 = DUR/PPS              09 = Coupon
"RTN","BPSOSH2",128,0)
 ;    10 = Compound  11 = Pricing              12 = Prior Auth
"RTN","BPSOSH2",129,0)
 ;    13 = Clinical
"RTN","BPSOSH2",130,0)
 ;
"RTN","BPSOSH2",131,0)
 N FLD
"RTN","BPSOSH2",132,0)
 ;
"RTN","BPSOSH2",133,0)
 S FLD=$S(ND=110:"01",ND=120:"04",ND=130:"07",ND=140:"02",ND=150:"03",ND=160:"05",ND=170:"06",ND=180:"08",ND=190:11,ND=200:"09",ND=210:10,ND=220:12,ND=230:13,1:"00")
"RTN","BPSOSH2",134,0)
 S FLD="AM"_$$NFF^BPSECFM(FLD,2)
"RTN","BPSOSH2",135,0)
 ;
"RTN","BPSOSH2",136,0)
 Q FLD
"RTN","BPSOSH2",137,0)
 ;
"RTN","BPSOSH2",138,0)
PROCDUR ;NCPDP 5.1 - The DUR/PPS segment can repeat itself for any given
"RTN","BPSOSH2",139,0)
 ; transaction within a claim.  This means we have to have special
"RTN","BPSOSH2",140,0)
 ; programming to handle the repeating fields.  
"RTN","BPSOSH2",141,0)
 ;
"RTN","BPSOSH2",142,0)
 N FIELD,DUR,FLD
"RTN","BPSOSH2",143,0)
 ;
"RTN","BPSOSH2",144,0)
 ; if there isn't any data in this segment, then lets quit
"RTN","BPSOSH2",145,0)
 Q:'$D(BPS(9002313.1001))
"RTN","BPSOSH2",146,0)
 ;
"RTN","BPSOSH2",147,0)
 ; second thing - create the 111 field entry as it is not repeating
"RTN","BPSOSH2",148,0)
 S FLDDATA=$$SEGID(NODE)
"RTN","BPSOSH2",149,0)
 S SEGREC=SEGREC_$C(28)_FLDDATA  ;FS always proceeds fld
"RTN","BPSOSH2",150,0)
 ;
"RTN","BPSOSH2",151,0)
 ; next- let's look to the format to see which DUR/PPS fields are 
"RTN","BPSOSH2",152,0)
 ; needed (remember - ALL fields on the DUR/PPS segment are optional)
"RTN","BPSOSH2",153,0)
 D GETFLDS^BPSOSHF(+IEN(9002313.92),NODE,.FIELD)
"RTN","BPSOSH2",154,0)
 ;
"RTN","BPSOSH2",155,0)
 ;finally -loop through and process the fields for as many times
"RTN","BPSOSH2",156,0)
 ; as they appear
"RTN","BPSOSH2",157,0)
 S DUR=0
"RTN","BPSOSH2",158,0)
 F  S DUR=$O(BPS(9002313.1001,DUR)) Q:DUR=""  D
"RTN","BPSOSH2",159,0)
 . S ORD=0
"RTN","BPSOSH2",160,0)
 . F  S ORD=$O(FIELD(ORD)) Q:ORD=""  D
"RTN","BPSOSH2",161,0)
 .. S FLDIEN=$P(FIELD(ORD),U)
"RTN","BPSOSH2",162,0)
 .. S FLD=$P(FIELD(ORD),U,2)
"RTN","BPSOSH2",163,0)
 .. S:FLD=473 FLD=.01   ;473 value stored in the .01 field
"RTN","BPSOSH2",164,0)
 .. S FDATA5=$G(^BPSF(9002313.91,FLDIEN,5))   ;5.1 id and length
"RTN","BPSOSH2",165,0)
 .. S FLDID=$P(FDATA5,U,1)         ;5.1 ID
"RTN","BPSOSH2",166,0)
 .. ;
"RTN","BPSOSH2",167,0)
 .. ;transaction data
"RTN","BPSOSH2",168,0)
 .. S FLDDATA=$G(BPS(9002313.1001,DUR,FLD,"I"))
"RTN","BPSOSH2",169,0)
 .. ;
"RTN","BPSOSH2",170,0)
 .. I FLDID'=$TR(FLDDATA,"0 {}") S DATAFND=1 ;fld chk-is the fld empty?
"RTN","BPSOSH2",171,0)
 .. ;
"RTN","BPSOSH2",172,0)
 .. S SEGREC=SEGREC_$C(28)_FLDDATA  ;FS always proceeds fld
"RTN","BPSOSH2",173,0)
 ;
"RTN","BPSOSH2",174,0)
 ;
"RTN","BPSOSH2",175,0)
 Q
"RTN","BPSOSH4")
0^157^B37840739
"RTN","BPSOSH4",1,0)
BPSOSH4 ;BHAM ISC/FCS/DRS/DLF - Parse Claim 5.1Response ;06/01/2004
"RTN","BPSOSH4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSH4",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH4",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH4",5,0)
 ;Parse ASCII Response Claim Record and Sup FDATA() Array
"RTN","BPSOSH4",6,0)
 ;
"RTN","BPSOSH4",7,0)
 ;Parameters:  RREC     - Ascii Response Record
"RTN","BPSOSH4",8,0)
 ;             RESPIEN  - Claim Response IEN (90023130.3)
"RTN","BPSOSH4",9,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH4",10,0)
 ; Calls BPSOSH5
"RTN","BPSOSH4",11,0)
 ;
"RTN","BPSOSH4",12,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH4",13,0)
 ; IHS/SD/lwj  8/6/02  NCPDP 5.1 changes
"RTN","BPSOSH4",14,0)
 ;  NCPDP 5.1 response segments are completely different than the
"RTN","BPSOSH4",15,0)
 ;  3.2 response.  Of significant importance are:
"RTN","BPSOSH4",16,0)
 ;   In 3.2, there were 4 basic response segments (header required,
"RTN","BPSOSH4",17,0)
 ;     header option, information required, information optional.) 
"RTN","BPSOSH4",18,0)
 ;   In 5.1, there are 8 possible segments (header, message, insurance,
"RTN","BPSOSH4",19,0)
 ;     status, claim, pricing, DUR/PPS, and prior authorization)
"RTN","BPSOSH4",20,0)
 ;
"RTN","BPSOSH4",21,0)
 ;   In 5.1, for all segments following the header, a segment separator
"RTN","BPSOSH4",22,0)
 ;     is used.
"RTN","BPSOSH4",23,0)
 ;
"RTN","BPSOSH4",24,0)
 ;   In 5.1, field separators, and field identifiers are used for all
"RTN","BPSOSH4",25,0)
 ;     fields not appearing on the header segment.
"RTN","BPSOSH4",26,0)
 ;
"RTN","BPSOSH4",27,0)
 ; This routine will be solely responsible for parsing the data
"RTN","BPSOSH4",28,0)
 ; for 5.1 claims.  It is called by BPSECA4.
"RTN","BPSOSH4",29,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH4",30,0)
PARSE51(RREC,RESPIEN) ;EP - from BPSECA4
"RTN","BPSOSH4",31,0)
 N GS,FS,SS
"RTN","BPSOSH4",32,0)
 ;
"RTN","BPSOSH4",33,0)
 ;Make sure input variables are defined
"RTN","BPSOSH4",34,0)
 Q:$G(RREC)=""
"RTN","BPSOSH4",35,0)
 Q:$G(RESPIEN)=""
"RTN","BPSOSH4",36,0)
 Q:'$D(^BPSR(RESPIEN,0))
"RTN","BPSOSH4",37,0)
 ;
"RTN","BPSOSH4",38,0)
 ;group and field separator characters
"RTN","BPSOSH4",39,0)
 S GS=$C(29),FS=$C(28),SS=$C(30)
"RTN","BPSOSH4",40,0)
 ;
"RTN","BPSOSH4",41,0)
 D TRANSMSN            ;process the transmission level data
"RTN","BPSOSH4",42,0)
 D TRANSACT            ;process the transaction level data
"RTN","BPSOSH4",43,0)
 D FILE^BPSOSH5(RESPIEN)   ;add information to the response file
"RTN","BPSOSH4",44,0)
 ;
"RTN","BPSOSH4",45,0)
 Q
"RTN","BPSOSH4",46,0)
 ;
"RTN","BPSOSH4",47,0)
 ;
"RTN","BPSOSH4",48,0)
TRANSMSN ;This subroutine will work through the transmission level information
"RTN","BPSOSH4",49,0)
 ;
"RTN","BPSOSH4",50,0)
 N RTRANM,RHEADER,SEG,SEGMENT,SEGID
"RTN","BPSOSH4",51,0)
 ;
"RTN","BPSOSH4",52,0)
 ;Parse response transmission level from ascii record
"RTN","BPSOSH4",53,0)
 S RTRANM=$P(RREC,GS,1)
"RTN","BPSOSH4",54,0)
 ;
"RTN","BPSOSH4",55,0)
 ; get just the header segment 
"RTN","BPSOSH4",56,0)
 S RHEADER=$P(RTRANM,SS,1)    ;header- required/fixed length
"RTN","BPSOSH4",57,0)
 D PARSEH
"RTN","BPSOSH4",58,0)
 ;
"RTN","BPSOSH4",59,0)
 ; There are 2 optional segments on the transmission level - message
"RTN","BPSOSH4",60,0)
 ; and insurance.  We'll check for both and parse what we find.
"RTN","BPSOSH4",61,0)
 ;
"RTN","BPSOSH4",62,0)
 F SEG=2:1:3 D
"RTN","BPSOSH4",63,0)
 . S SEGMENT=$P(RTRANM,SS,SEG)
"RTN","BPSOSH4",64,0)
 . Q:SEGMENT=""
"RTN","BPSOSH4",65,0)
 . S SEGID=$P(SEGMENT,FS,2)
"RTN","BPSOSH4",66,0)
 . I $E(SEGID,1,2)="AM" D                ;segment identification
"RTN","BPSOSH4",67,0)
 . D:($E(SEGID,3,4)=20)!($E(SEGID,3,4)=25) PARSETM
"RTN","BPSOSH4",68,0)
 ;
"RTN","BPSOSH4",69,0)
 Q
"RTN","BPSOSH4",70,0)
 ;
"RTN","BPSOSH4",71,0)
TRANSACT ;This subroutine will work through the transaction level information
"RTN","BPSOSH4",72,0)
 ;
"RTN","BPSOSH4",73,0)
 N RTRAN,SEG,SEGMENT,MEDN
"RTN","BPSOSH4",74,0)
 S MEDN=0
"RTN","BPSOSH4",75,0)
 ;
"RTN","BPSOSH4",76,0)
 F GRP=2:1 D  Q:RTRAN=""
"RTN","BPSOSH4",77,0)
 . S RTRAN=$P(RREC,GS,GRP)     ;get the next transaction (could be 4)
"RTN","BPSOSH4",78,0)
 . Q:RTRAN=""                  ;we're done if it's empty
"RTN","BPSOSH4",79,0)
 . S MEDN=MEDN+1               ;transaction counter
"RTN","BPSOSH4",80,0)
 . ;
"RTN","BPSOSH4",81,0)
 . F SEG=2:1 D  Q:SEGMENT=""   ;break the record down by segments
"RTN","BPSOSH4",82,0)
 .. S SEGMENT=$P(RTRAN,SS,SEG) ;get the segment
"RTN","BPSOSH4",83,0)
 .. Q:SEGMENT=""
"RTN","BPSOSH4",84,0)
 .. D PARSETN                  ;get the fields
"RTN","BPSOSH4",85,0)
 ;
"RTN","BPSOSH4",86,0)
 ;
"RTN","BPSOSH4",87,0)
 Q
"RTN","BPSOSH4",88,0)
 ;
"RTN","BPSOSH4",89,0)
 ;
"RTN","BPSOSH4",90,0)
PARSEH ; The header record is required on all responses, and is fixed 
"RTN","BPSOSH4",91,0)
 ; length.  It is the only record that is fixed length.
"RTN","BPSOSH4",92,0)
 ;
"RTN","BPSOSH4",93,0)
 S FDATA(102)=$E(RHEADER,1,2)    ;version/release number
"RTN","BPSOSH4",94,0)
 S FDATA(103)=$E(RHEADER,3,4)    ;transaction code
"RTN","BPSOSH4",95,0)
 S FDATA(109)=$E(RHEADER,5,5)    ;transaction count
"RTN","BPSOSH4",96,0)
 S FDATA(501)=$E(RHEADER,6,6)    ;header response status
"RTN","BPSOSH4",97,0)
 S FDATA(202)=$E(RHEADER,7,8)    ;service provider id qualifier
"RTN","BPSOSH4",98,0)
 S FDATA(201)=$E(RHEADER,9,23)   ;service provider id
"RTN","BPSOSH4",99,0)
 S FDATA(401)=$E(RHEADER,24,31)  ;date of service
"RTN","BPSOSH4",100,0)
 ;
"RTN","BPSOSH4",101,0)
 Q
"RTN","BPSOSH4",102,0)
 ;
"RTN","BPSOSH4",103,0)
PARSETM ; This subroutine will parse the variable portions of the transmission 
"RTN","BPSOSH4",104,0)
 ; level message.  Keep in mind that most fields are optional
"RTN","BPSOSH4",105,0)
 ; so we have no idea what is coming back.  We will parse based 
"RTN","BPSOSH4",106,0)
 ; on the field separators, and field identification.
"RTN","BPSOSH4",107,0)
 ; (transmission level variable records are the message (ID=20) 
"RTN","BPSOSH4",108,0)
 ;  and insurance (ID=25) segments)
"RTN","BPSOSH4",109,0)
 ;
"RTN","BPSOSH4",110,0)
 N FIELD,PC,FLDNUM
"RTN","BPSOSH4",111,0)
 ;
"RTN","BPSOSH4",112,0)
 F PC=3:1 D  Q:FIELD=""        ;skip the seg id -already know its value 
"RTN","BPSOSH4",113,0)
 . S FIELD=$P(SEGMENT,FS,PC)   ;piece through the record
"RTN","BPSOSH4",114,0)
 . Q:FIELD=""                  ;stop - we hit the end
"RTN","BPSOSH4",115,0)
 . S FLDNUM=$$GETNUM(FIELD)    ;get the field number used for storage
"RTN","BPSOSH4",116,0)
 . Q:FLDNUM=""                 ;shouldn't happen - but lets skip
"RTN","BPSOSH4",117,0)
 . S FDATA(FLDNUM)=$E(FIELD,3,$L(FIELD))  ;hold the value
"RTN","BPSOSH4",118,0)
 ;
"RTN","BPSOSH4",119,0)
 Q
"RTN","BPSOSH4",120,0)
 ; 
"RTN","BPSOSH4",121,0)
PARSETN ; This subroutine will parse the transaction level segments. For 
"RTN","BPSOSH4",122,0)
 ; most transactions, the only segment required in this area of 
"RTN","BPSOSH4",123,0)
 ; the response is the status segment.  However, since we aren't
"RTN","BPSOSH4",124,0)
 ; sure what we will be getting back, we will process whatever
"RTN","BPSOSH4",125,0)
 ; is sent our way.
"RTN","BPSOSH4",126,0)
 ;
"RTN","BPSOSH4",127,0)
 ; Please note that most fields are optional, so we will parse the
"RTN","BPSOSH4",128,0)
 ; record based on field separators and the value of the field
"RTN","BPSOSH4",129,0)
 ; identification.  
"RTN","BPSOSH4",130,0)
 ; Also please note that several of the segments have repeating
"RTN","BPSOSH4",131,0)
 ; fields - we will determine which fields are repeating, based
"RTN","BPSOSH4",132,0)
 ; on the segment identification.
"RTN","BPSOSH4",133,0)
 ;
"RTN","BPSOSH4",134,0)
 ; Possible values of the SEGFID field:
"RTN","BPSOSH4",135,0)
 ;  21 = Response Status Segment
"RTN","BPSOSH4",136,0)
 ;  22 = Response Claim Segment
"RTN","BPSOSH4",137,0)
 ;  23 = Response Pricing Segment
"RTN","BPSOSH4",138,0)
 ;  24 = Response DUR/PPS Segment
"RTN","BPSOSH4",139,0)
 ;  26 = Response Prior Authorization Segment
"RTN","BPSOSH4",140,0)
 ;
"RTN","BPSOSH4",141,0)
 N FIELD,PC,FLDNUM,RPTFLD,RCNT,REPEAT
"RTN","BPSOSH4",142,0)
 ;
"RTN","BPSOSH4",143,0)
 S RPTFLD=""
"RTN","BPSOSH4",144,0)
 S SEGID=$P(SEGMENT,FS,2)           ;this should be the segment id
"RTN","BPSOSH4",145,0)
 Q:SEGID=""                         ;don't process without a Seg id
"RTN","BPSOSH4",146,0)
 Q:$E(SEGID,1,2)'="AM"              ;don't know what we have - skip
"RTN","BPSOSH4",147,0)
 ;
"RTN","BPSOSH4",148,0)
 S SEGFID=$E(SEGID,3,4)             ;this should be the field ID
"RTN","BPSOSH4",149,0)
 ;
"RTN","BPSOSH4",150,0)
 ; setup the repeating flds based on the segment
"RTN","BPSOSH4",151,0)
 I SEGFID=21 D               ;status segment
"RTN","BPSOSH4",152,0)
 . S RPTFLD=",548,511,546,"
"RTN","BPSOSH4",153,0)
 . S (RCNT(548),RCNT(511),RCNT(546))=0
"RTN","BPSOSH4",154,0)
 ;
"RTN","BPSOSH4",155,0)
 I SEGFID=22 D                 ;claim segment
"RTN","BPSOSH4",156,0)
 . S RPTFLD=",552,553,554,555,556,"
"RTN","BPSOSH4",157,0)
 . S (RCNT(552),RCNT(553),RCNT(554),RCNT(555),RCNT(556))=0
"RTN","BPSOSH4",158,0)
 ;
"RTN","BPSOSH4",159,0)
 I SEGFID=23 D                ;pricing segment
"RTN","BPSOSH4",160,0)
 . S RPTFLD=",564,565,"
"RTN","BPSOSH4",161,0)
 . S (RCNT(564),RCNT(565))=0
"RTN","BPSOSH4",162,0)
 ;
"RTN","BPSOSH4",163,0)
 I SEGFID=24 D                ;DUR/PPS segment
"RTN","BPSOSH4",164,0)
 . S RPTFLD=",439,528,529,530,531,532,533,544,567,"
"RTN","BPSOSH4",165,0)
 . S (RCNT(439),RCNT(528),RCNT(529),RCNT(530),RCNT(531))=0
"RTN","BPSOSH4",166,0)
 . S (RCNT(532),RCNT(533),RCNT(544),RCNT(567))=0
"RTN","BPSOSH4",167,0)
 ;
"RTN","BPSOSH4",168,0)
 ; now lets parse out the fields
"RTN","BPSOSH4",169,0)
 ;
"RTN","BPSOSH4",170,0)
 F PC=3:1 D  Q:FIELD=""        ;skip the seg id -jump to the other flds
"RTN","BPSOSH4",171,0)
 . S FIELD=$P(SEGMENT,FS,PC)   ;piece through the record
"RTN","BPSOSH4",172,0)
 . Q:FIELD=""                  ;stop - we hit the end
"RTN","BPSOSH4",173,0)
 . S FLDNUM=$$GETNUM(FIELD)    ;get the field number used for storage
"RTN","BPSOSH4",174,0)
 . ;
"RTN","BPSOSH4",175,0)
 . S REPEAT=0                  ;for this segment, lets figure
"RTN","BPSOSH4",176,0)
 . S CKRPT=","_FLDNUM_","      ;out if the field is a repeating
"RTN","BPSOSH4",177,0)
 . S:RPTFLD[CKRPT REPEAT=1     ;field
"RTN","BPSOSH4",178,0)
 . ;
"RTN","BPSOSH4",179,0)
 . I REPEAT D                  ;if rptg, store with a counter
"RTN","BPSOSH4",180,0)
 .. S RCNT(FLDNUM)=$G(RCNT(FLDNUM))+1
"RTN","BPSOSH4",181,0)
 .. S FDATA("M",MEDN,FLDNUM,RCNT(FLDNUM))=$E(FIELD,3,$L(FIELD))
"RTN","BPSOSH4",182,0)
 . ;
"RTN","BPSOSH4",183,0)
 . I 'REPEAT D                 ;not rptg, store without counter
"RTN","BPSOSH4",184,0)
 .. S FDATA("M",MEDN,FLDNUM)=$E(FIELD,3,$L(FIELD))
"RTN","BPSOSH4",185,0)
 ;
"RTN","BPSOSH4",186,0)
 ;
"RTN","BPSOSH4",187,0)
 Q
"RTN","BPSOSH4",188,0)
 ;
"RTN","BPSOSH4",189,0)
GETNUM(FIELD) ; This routine will translate the field ID into a field number.  
"RTN","BPSOSH4",190,0)
 ; We will use the BPS NCPDP field Defs files, corss ref "D" to
"RTN","BPSOSH4",191,0)
 ; perform this translation.  (The field number is needed to store
"RTN","BPSOSH4",192,0)
 ; the data in the correct field within the response file.)
"RTN","BPSOSH4",193,0)
 ;
"RTN","BPSOSH4",194,0)
 N FLDID,FLDIEN,FLDNUM
"RTN","BPSOSH4",195,0)
 S (FLDID,FLDNUM)=""
"RTN","BPSOSH4",196,0)
 S FLDIEN=0
"RTN","BPSOSH4",197,0)
 ;
"RTN","BPSOSH4",198,0)
 S FLDID=$E(FIELD,1,2)       ;field identifier
"RTN","BPSOSH4",199,0)
 Q:FLDID=""
"RTN","BPSOSH4",200,0)
 ;
"RTN","BPSOSH4",201,0)
 I FLDID'="" D
"RTN","BPSOSH4",202,0)
 . S FLDIEN=$O(^BPSF(9002313.91,"D",FLDID,FLDIEN))  ;internal fld #
"RTN","BPSOSH4",203,0)
 . S:FLDIEN FLDNUM=$P($G(^BPSF(9002313.91,FLDIEN,0)),U) ;fld number
"RTN","BPSOSH4",204,0)
 ;
"RTN","BPSOSH4",205,0)
 ;
"RTN","BPSOSH4",206,0)
 Q FLDNUM
"RTN","BPSOSH4",207,0)
 ;
"RTN","BPSOSH5")
0^158^B18545753
"RTN","BPSOSH5",1,0)
BPSOSH5 ;BHAM ISC/SD/lwj/DLF - Post 5.1 Claim Response ;06/01/2004
"RTN","BPSOSH5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSH5",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH5",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSH5",5,0)
 ;File FDATA() Array Data in Claim Response File (9002313.03)
"RTN","BPSOSH5",6,0)
 ;
"RTN","BPSOSH5",7,0)
 ;Parameters:  RESPIEN  - Claim Response Record IEN (9002313.03)
"RTN","BPSOSH5",8,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSH5",9,0)
 ; Called from BPSOSH4 from BPSECA4 from BPSOSQL from BPSOSQ4
"RTN","BPSOSH5",10,0)
 ;
"RTN","BPSOSH5",11,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSH5",12,0)
 ; IHS/SD/lwj 8/7/02  NCPDP 5.1 changes
"RTN","BPSOSH5",13,0)
 ; NCPDP 5.1 response segments are completely different from 3.2
"RTN","BPSOSH5",14,0)
 ; response segments, and as such many new fields had to be added
"RTN","BPSOSH5",15,0)
 ; to BPSR to store the information coming back. (52 new flds added) 
"RTN","BPSOSH5",16,0)
 ; (There were several significant differences in the parsing of 
"RTN","BPSOSH5",17,0)
 ;  data from a 3.2 response and a 5.1 response - please refer to
"RTN","BPSOSH5",18,0)
 ;  BPSOSH4 for details regarding the parsing.)
"RTN","BPSOSH5",19,0)
 ; The purpose of this routine is to load the information from a 5.1
"RTN","BPSOSH5",20,0)
 ; response into the ^BPSR global after the parsing is complete.
"RTN","BPSOSH5",21,0)
 ;(please see BPSECA5 for the storing of information from a 3.2
"RTN","BPSOSH5",22,0)
 ; claim into ^BPSR)
"RTN","BPSOSH5",23,0)
 ;
"RTN","BPSOSH5",24,0)
 ; Of interest - in 3.2, if the response was for a duplicate, the
"RTN","BPSOSH5",25,0)
 ; information for the response was duplicated in the Response subfile,
"RTN","BPSOSH5",26,0)
 ; on node 1000, in addition to be stored in node 500 and 504.
"RTN","BPSOSH5",27,0)
 ; With 5.1 being so much different, the node 1000 on the subfile
"RTN","BPSOSH5",28,0)
 ; will not be populated since the information is stored at all the
"RTN","BPSOSH5",29,0)
 ; other nodes.
"RTN","BPSOSH5",30,0)
 ;
"RTN","BPSOSH5",31,0)
 ; Special Note - The values are hard set into the BPS response 
"RTN","BPSOSH5",32,0)
 ; file within this routine and cross references are rebuilt 
"RTN","BPSOSH5",33,0)
 ; manually.  While this is not considered the optimum way of 
"RTN","BPSOSH5",34,0)
 ; approaching this, it does two things.  It works as documentation
"RTN","BPSOSH5",35,0)
 ; for what is being set where, and it stays consistent with the
"RTN","BPSOSH5",36,0)
 ; original coding of ECME (please see the BPSECA5 routine for 
"RTN","BPSOSH5",37,0)
 ; loading of values for 3.2 claims).
"RTN","BPSOSH5",38,0)
 ;
"RTN","BPSOSH5",39,0)
 ; For ALL the repeating fields, we will make a general assumption
"RTN","BPSOSH5",40,0)
 ; that the counter field that goes with the repeating field section
"RTN","BPSOSH5",41,0)
 ; really does tell us how many occurrences of the repeating fields 
"RTN","BPSOSH5",42,0)
 ; there will be.  This counter will be used to loop through the
"RTN","BPSOSH5",43,0)
 ; repeating fields.
"RTN","BPSOSH5",44,0)
 ;
"RTN","BPSOSH5",45,0)
 ;
"RTN","BPSOSH5",46,0)
 ;--------------------------------------------------------------------
"RTN","BPSOSH5",47,0)
 ;
"RTN","BPSOSH5",48,0)
FILE(RESPIEN) ;EP - from BPSOSH4
"RTN","BPSOSH5",49,0)
 ;
"RTN","BPSOSH5",50,0)
 I 'RESPIEN Q:$$IMPOSS^BPSOSUE("P",,,,,$T(+0))
"RTN","BPSOSH5",51,0)
 ;
"RTN","BPSOSH5",52,0)
 N MEDN,COUNT,INDEX,RJTN,RJTCOUNT,RJTCODE,NEXT,CLAIMIEN
"RTN","BPSOSH5",53,0)
 ;
"RTN","BPSOSH5",54,0)
 D CLNDATA^BPSOSHU        ;clean out spaces and zeros
"RTN","BPSOSH5",55,0)
 D WRTTMSN                 ;write the transmission level data
"RTN","BPSOSH5",56,0)
 D WRTTRAN                 ;write the transaction level data
"RTN","BPSOSH5",57,0)
 ;
"RTN","BPSOSH5",58,0)
 ;
"RTN","BPSOSH5",59,0)
 Q
"RTN","BPSOSH5",60,0)
WRTTMSN ; The purpose of this subroutine is to read through the 
"RTN","BPSOSH5",61,0)
 ; FDATA transmission level fields, and write out the data
"RTN","BPSOSH5",62,0)
 ; to the ^BPSR (BPS Responses) file.
"RTN","BPSOSH5",63,0)
 ;
"RTN","BPSOSH5",64,0)
 ; first lets work on what we got from the header segment
"RTN","BPSOSH5",65,0)
 S $P(^BPSR(RESPIEN,100),U,2)=$G(FDATA(102))   ;version/release #
"RTN","BPSOSH5",66,0)
 S $P(^BPSR(RESPIEN,100),U,3)=$G(FDATA(103))   ;transaction code
"RTN","BPSOSH5",67,0)
 S $P(^BPSR(RESPIEN,100),U,9)=$G(FDATA(109))   ;transaction count
"RTN","BPSOSH5",68,0)
 S $P(^BPSR(RESPIEN,500),U,1)=$G(FDATA(501))   ;header response status
"RTN","BPSOSH5",69,0)
 S $P(^BPSR(RESPIEN,200),U,1)=$G(FDATA(201))   ;service provider id
"RTN","BPSOSH5",70,0)
 S $P(^BPSR(RESPIEN,200),U,2)=$G(FDATA(202))   ;service prov id qual
"RTN","BPSOSH5",71,0)
 S $P(^BPSR(RESPIEN,400),U,1)=$G(FDATA(401))   ;date of service
"RTN","BPSOSH5",72,0)
 ;
"RTN","BPSOSH5",73,0)
 ; now lets look for a message, if there was one
"RTN","BPSOSH5",74,0)
 S $P(^BPSR(RESPIEN,504),U,1)=$G(FDATA(504))   ;message
"RTN","BPSOSH5",75,0)
 ;
"RTN","BPSOSH5",76,0)
 ; if there was any insurance information passed back - let's record it
"RTN","BPSOSH5",77,0)
 S $P(^BPSR(RESPIEN,300),U,1)=$G(FDATA(301))    ;group ID
"RTN","BPSOSH5",78,0)
 S $P(^BPSR(RESPIEN,500),U,24)=$G(FDATA(524))   ;plan ID
"RTN","BPSOSH5",79,0)
 S $P(^BPSR(RESPIEN,540),U,5)=$G(FDATA(545))    ;network reimbrsmnt id
"RTN","BPSOSH5",80,0)
 S $P(^BPSR(RESPIEN,560),U,8)=$G(FDATA(568))    ;payer ID qualifier
"RTN","BPSOSH5",81,0)
 S $P(^BPSR(RESPIEN,560),U,9)=$G(FDATA(569))    ;payer ID
"RTN","BPSOSH5",82,0)
 ;
"RTN","BPSOSH5",83,0)
 Q
"RTN","BPSOSH5",84,0)
 ;
"RTN","BPSOSH5",85,0)
WRTTRAN ;The purpose of this routine is to write the transaction level 
"RTN","BPSOSH5",86,0)
 ; information out to the ^BPSR (BPS Responses) file.
"RTN","BPSOSH5",87,0)
 ; **Special Note - the cross references and header for the subfiles
"RTN","BPSOSH5",88,0)
 ; are hard set within this subroutine - this is done to stay 
"RTN","BPSOSH5",89,0)
 ; consistent with the original ECME software (please see BPSECA5)
"RTN","BPSOSH5",90,0)
 ;
"RTN","BPSOSH5",91,0)
 ; the logic for setting of COUNT and INDEX was borrowed from 
"RTN","BPSOSH5",92,0)
 ; BPSECA5 - INDEX will stay in line with the subfile ien on the
"RTN","BPSOSH5",93,0)
 ; claim 400 subfile, COUNT is used to update the subfile header in
"RTN","BPSOSH5",94,0)
 ; the response file
"RTN","BPSOSH5",95,0)
 ;
"RTN","BPSOSH5",96,0)
 N COUNT,INDEX,CLAIMIEN,MEDN
"RTN","BPSOSH5",97,0)
 ;
"RTN","BPSOSH5",98,0)
 ; claimien was set in BPSOSQL
"RTN","BPSOSH5",99,0)
 S CLAIMIEN=$P($G(^BPSR(RESPIEN,0)),U,1)   ;claim pointer
"RTN","BPSOSH5",100,0)
 S INDEX=$S(CLAIMIEN="":0,1:$O(^BPSC(CLAIMIEN,400,0))-1)
"RTN","BPSOSH5",101,0)
 S:INDEX<0 INDEX=0
"RTN","BPSOSH5",102,0)
 S COUNT=0
"RTN","BPSOSH5",103,0)
 ;
"RTN","BPSOSH5",104,0)
 ; now find where we need to start with the transaction data
"RTN","BPSOSH5",105,0)
 ; and loop through each one to write out to the response file
"RTN","BPSOSH5",106,0)
 S MEDN=""
"RTN","BPSOSH5",107,0)
 F  D  Q:MEDN=""
"RTN","BPSOSH5",108,0)
 . S MEDN=$O(FDATA("M",MEDN))
"RTN","BPSOSH5",109,0)
 . Q:MEDN=""
"RTN","BPSOSH5",110,0)
 . ;
"RTN","BPSOSH5",111,0)
 . S COUNT=COUNT+1       ;sub file record count
"RTN","BPSOSH5",112,0)
 . S INDEX=INDEX+1       ;sub file index
"RTN","BPSOSH5",113,0)
 . ;
"RTN","BPSOSH5",114,0)
 . S ^BPSR(RESPIEN,1000,INDEX,0)=INDEX     ;.01 fld Medication order
"RTN","BPSOSH5",115,0)
 . ;
"RTN","BPSOSH5",116,0)
 . ; let's take it a segment at a time - remember most everything 
"RTN","BPSOSH5",117,0)
 . ; is optional
"RTN","BPSOSH5",118,0)
 . ; (all the below subroutines were originally in BPSOSH5, but
"RTN","BPSOSH5",119,0)
 . ; because of SAC routine size limitations, they were relocated.)
"RTN","BPSOSH5",120,0)
 . D RESPSTS^BPSOSH6                      ;status segment
"RTN","BPSOSH5",121,0)
 . D RESPCLM^BPSOSH6                      ;claim segment   
"RTN","BPSOSH5",122,0)
 . D RESPPRC^BPSOSH7                      ;pricing segment
"RTN","BPSOSH5",123,0)
 . D RESPDUR^BPSOSH7                      ;DUR segment
"RTN","BPSOSH5",124,0)
 . D RESPPA^BPSOSH7                       ;prior authorization segment
"RTN","BPSOSH5",125,0)
 . ;
"RTN","BPSOSH5",126,0)
 . ; now - lets update the "b" cross reference
"RTN","BPSOSH5",127,0)
 . S ^BPSR(RESPIEN,1000,"B",INDEX,INDEX)=""
"RTN","BPSOSH5",128,0)
 ;
"RTN","BPSOSH5",129,0)
 ; last step - let's update the 0 node with the last rec and rec cnt
"RTN","BPSOSH5",130,0)
 S ^BPSR(RESPIEN,1000,0)="^9002313.0301A^"_INDEX_"^"_COUNT
"RTN","BPSOSH5",131,0)
 ;
"RTN","BPSOSH5",132,0)
 Q
"RTN","BPSOSH6")
0^159^B27185561
"RTN","BPSOSH6",1,0)
BPSOSH6 ;BHAM ISC/SD/lwj/DLF - NCPDP 5.1 Post 5.1 response ;06/01/2004
"RTN","BPSOSH6",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSH6",3,0)
 ;-------------------------------------------------------------
"RTN","BPSOSH6",4,0)
 ; Originally, the entire response was processed in the 
"RTN","BPSOSH6",5,0)
 ; BPSOSH5 routine - but it exceed SAC limitations on 
"RTN","BPSOSH6",6,0)
 ; routine size - so the processing of some of the transaction 
"RTN","BPSOSH6",7,0)
 ; level information was moved to this routine. Other portions
"RTN","BPSOSH6",8,0)
 ; were moved to the BPSOSH7 routine.
"RTN","BPSOSH6",9,0)
 ; 
"RTN","BPSOSH6",10,0)
 ; This routine is called solely from BPSOSH5.
"RTN","BPSOSH6",11,0)
 ;
"RTN","BPSOSH6",12,0)
 ;
"RTN","BPSOSH6",13,0)
 Q
"RTN","BPSOSH6",14,0)
 ;
"RTN","BPSOSH6",15,0)
RESPSTS ;EP  - NCPDP 5.1 response processing (moved from BPSOSH5)  
"RTN","BPSOSH6",16,0)
 ; called from WRTTRAN^BPSOSH5
"RTN","BPSOSH6",17,0)
 ; MEDN is set in BPSOSH5 in the WRTTRAN subroutine
"RTN","BPSOSH6",18,0)
 ; process the response status segment - here's the fields we MIGHT 
"RTN","BPSOSH6",19,0)
 ; encounter:
"RTN","BPSOSH6",20,0)
 ; 112 - transaction response status (mandatory)
"RTN","BPSOSH6",21,0)
 ; 503 - authorization number
"RTN","BPSOSH6",22,0)
 ; 510 - reject count 
"RTN","BPSOSH6",23,0)
 ; 511 - reject code (repeating field)
"RTN","BPSOSH6",24,0)
 ; 546 - reject field occurrence indicator (repeating field)
"RTN","BPSOSH6",25,0)
 ; 547 - approved message code count 
"RTN","BPSOSH6",26,0)
 ; 548 - approved message code (repeating field)
"RTN","BPSOSH6",27,0)
 ; 526 - additional message information
"RTN","BPSOSH6",28,0)
 ; 549 - help desk phone number qualifier
"RTN","BPSOSH6",29,0)
 ; 550 - help desk phone number
"RTN","BPSOSH6",30,0)
 ;
"RTN","BPSOSH6",31,0)
 ; *special note - in 3.2 the transaction response is stored in field
"RTN","BPSOSH6",32,0)
 ; 501 at the prescription level.  In 5.1 that was moved to field 112.
"RTN","BPSOSH6",33,0)
 ; All the reports are based on the 501 field, so to keep things
"RTN","BPSOSH6",34,0)
 ; simple, we will simply update both the 112 and 501 fields with 
"RTN","BPSOSH6",35,0)
 ; the transaction level response status.
"RTN","BPSOSH6",36,0)
 ;
"RTN","BPSOSH6",37,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,110),U,2)=$G(FDATA("M",MEDN,112))
"RTN","BPSOSH6",38,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U)=$G(FDATA("M",MEDN,112))  ;501
"RTN","BPSOSH6",39,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,3)=$G(FDATA("M",MEDN,503))
"RTN","BPSOSH6",40,0)
 ;
"RTN","BPSOSH6",41,0)
 ; process reject information if there
"RTN","BPSOSH6",42,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,10)=$G(FDATA("M",MEDN,510))
"RTN","BPSOSH6",43,0)
 I $D(FDATA("M",MEDN,510)) D REPREJ      ;process the rejection codes
"RTN","BPSOSH6",44,0)
 ;
"RTN","BPSOSH6",45,0)
 ; process approved information if there
"RTN","BPSOSH6",46,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,540),U,7)=$G(FDATA("M",MEDN,547))
"RTN","BPSOSH6",47,0)
 I $D(FDATA("M",MEDN,547)) D REPAPP      ;process the repeating fld
"RTN","BPSOSH6",48,0)
 ;
"RTN","BPSOSH6",49,0)
 ; finish up with the additional message, and help desk information
"RTN","BPSOSH6",50,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,526),U)=$G(FDATA("M",MEDN,526))
"RTN","BPSOSH6",51,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,540),U,9)=$G(FDATA("M",MEDN,549))
"RTN","BPSOSH6",52,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,540),U,10)=$G(FDATA("M",MEDN,550))
"RTN","BPSOSH6",53,0)
 ;
"RTN","BPSOSH6",54,0)
 ;
"RTN","BPSOSH6",55,0)
 Q
"RTN","BPSOSH6",56,0)
 ;
"RTN","BPSOSH6",57,0)
REPREJ ; This subroutine will process the reject repeating fields 
"RTN","BPSOSH6",58,0)
 ; that are a part of the status segment.
"RTN","BPSOSH6",59,0)
 ; Two fields here - 511 - Reject Code and
"RTN","BPSOSH6",60,0)
 ;                   546 - Reject field occurrence indicator
"RTN","BPSOSH6",61,0)
 ;
"RTN","BPSOSH6",62,0)
 N CNTR,COUNT,RJCD,RJOC,RLCNT
"RTN","BPSOSH6",63,0)
 ;
"RTN","BPSOSH6",64,0)
 S RLCNT=0
"RTN","BPSOSH6",65,0)
 S COUNT=$G(FDATA("M",MEDN,510))    ;reject count
"RTN","BPSOSH6",66,0)
 Q:COUNT'>0
"RTN","BPSOSH6",67,0)
 ;
"RTN","BPSOSH6",68,0)
 F CNTR=1:1:COUNT  D
"RTN","BPSOSH6",69,0)
 . S (RJCD,RJOC)=""
"RTN","BPSOSH6",70,0)
 . S RJCD=$G(FDATA("M",MEDN,511,CNTR))   ;rejection code
"RTN","BPSOSH6",71,0)
 . S RJOC=$G(FDATA("M",MEDN,546,CNTR))   ;reject fld occurrence ind
"RTN","BPSOSH6",72,0)
 . I $D(RJCD) D
"RTN","BPSOSH6",73,0)
 .. S $P(^BPSR(RESPIEN,1000,INDEX,511,CNTR,0),U)=RJCD
"RTN","BPSOSH6",74,0)
 .. S ^BPSR(RESPIEN,1000,INDEX,511,"B",RJCD,CNTR)=""
"RTN","BPSOSH6",75,0)
 . S:$D(RJOC) $P(^BPSR(RESPIEN,1000,INDEX,511,CNTR,0),U,2)=RJOC
"RTN","BPSOSH6",76,0)
 . S:(($D(RJOC))!($D(RJCD))) RLCNT=RLCNT+1
"RTN","BPSOSH6",77,0)
 ;
"RTN","BPSOSH6",78,0)
 I RLCNT>0 D
"RTN","BPSOSH6",79,0)
 . S ^BPSR(RESPIEN,1000,INDEX,511,0)="^9002313.03511A^"_RLCNT_"^"_RLCNT
"RTN","BPSOSH6",80,0)
 ;
"RTN","BPSOSH6",81,0)
 Q
"RTN","BPSOSH6",82,0)
 ;
"RTN","BPSOSH6",83,0)
 ;
"RTN","BPSOSH6",84,0)
REPAPP ; This subroutine will process the approved repeating field 
"RTN","BPSOSH6",85,0)
 ; that is a part of the status segment.
"RTN","BPSOSH6",86,0)
 ; Field 548 - Approved Message Code
"RTN","BPSOSH6",87,0)
 ;
"RTN","BPSOSH6",88,0)
 N CNTR,COUNT,RLCNT,APP
"RTN","BPSOSH6",89,0)
 ;
"RTN","BPSOSH6",90,0)
 S RLCNT=0
"RTN","BPSOSH6",91,0)
 S COUNT=$G(FDATA("M",MEDN,547))    ;approved message code count
"RTN","BPSOSH6",92,0)
 Q:COUNT'>0
"RTN","BPSOSH6",93,0)
 ;
"RTN","BPSOSH6",94,0)
 F CNTR=1:1:COUNT  D
"RTN","BPSOSH6",95,0)
 . S (APP)=""
"RTN","BPSOSH6",96,0)
 . S APP=$G(FDATA("M",MEDN,548,CNTR))   ;approved message code
"RTN","BPSOSH6",97,0)
 . I $D(APP) D
"RTN","BPSOSH6",98,0)
 .. S $P(^BPSR(RESPIEN,1000,INDEX,548,CNTR,0),U)=APP
"RTN","BPSOSH6",99,0)
 .. S ^BPSR(RESPIEN,1000,INDEX,548,"B",APP,CNTR)=""
"RTN","BPSOSH6",100,0)
 .. S RLCNT=RLCNT+1
"RTN","BPSOSH6",101,0)
 ;
"RTN","BPSOSH6",102,0)
 I RLCNT>0 D
"RTN","BPSOSH6",103,0)
 . S ^BPSR(RESPIEN,1000,INDEX,548,0)="^9002313.301548A^"_RLCNT_"^"_RLCNT
"RTN","BPSOSH6",104,0)
 ;
"RTN","BPSOSH6",105,0)
 Q
"RTN","BPSOSH6",106,0)
 ;
"RTN","BPSOSH6",107,0)
RESPCLM ;EP  - NCPDP 5.1 response processing (moved from BPSOSH5)  
"RTN","BPSOSH6",108,0)
 ; called from WRTTRAN^BPSOSH5
"RTN","BPSOSH6",109,0)
 ; MEDN is set in BPSOSH5 in the WRTTRAN subroutine
"RTN","BPSOSH6",110,0)
 ; process the response claim segment - here's the fields we MIGHT
"RTN","BPSOSH6",111,0)
 ; encounter:
"RTN","BPSOSH6",112,0)
 ; 455 - prescription/service reference number qualifier
"RTN","BPSOSH6",113,0)
 ; 402 - prescription/service reference number
"RTN","BPSOSH6",114,0)
 ; 551 - preferred product count
"RTN","BPSOSH6",115,0)
 ; 552 - preferred product id qualifier (repeating)
"RTN","BPSOSH6",116,0)
 ; 553 - preferred product id (repeating)
"RTN","BPSOSH6",117,0)
 ; 554 - preferred product incentive (repeating)
"RTN","BPSOSH6",118,0)
 ; 555 - preferred product copay incentive (repeating)
"RTN","BPSOSH6",119,0)
 ; 556 - preferred product description (repeating)
"RTN","BPSOSH6",120,0)
 ;
"RTN","BPSOSH6",121,0)
 ; start with what are suppose to be mandatory fields
"RTN","BPSOSH6",122,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,450),U,5)=$G(FDATA("M",MEDN,455))
"RTN","BPSOSH6",123,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,400),U,2)=$G(FDATA("M",MEDN,402))
"RTN","BPSOSH6",124,0)
 ;
"RTN","BPSOSH6",125,0)
 ; now lets try to process the preferred product repeating fields
"RTN","BPSOSH6",126,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,550),U)=$G(FDATA("M",MEDN,551))
"RTN","BPSOSH6",127,0)
 I $D(FDATA("M",MEDN,551)) D REPPPD      ;process the repeating fld
"RTN","BPSOSH6",128,0)
 ;
"RTN","BPSOSH6",129,0)
 Q
"RTN","BPSOSH6",130,0)
 ;
"RTN","BPSOSH6",131,0)
REPPPD ; This subroutine will process the preferred product repeating fields 
"RTN","BPSOSH6",132,0)
 ; that are a part of the claim segment.
"RTN","BPSOSH6",133,0)
 ; five fields here- 552 - Preferred product id qualifier 
"RTN","BPSOSH6",134,0)
 ;                   553 - Preferred product id 
"RTN","BPSOSH6",135,0)
 ;                   554 - Preferred product incentive
"RTN","BPSOSH6",136,0)
 ;                   555 - preferred product copay incentive
"RTN","BPSOSH6",137,0)
 ;                   556 - preferred product description
"RTN","BPSOSH6",138,0)
 ;
"RTN","BPSOSH6",139,0)
 N CNTR,COUNT,PPIDQ,PPID,PPINC,PPCOP,PPDESC,CKREC
"RTN","BPSOSH6",140,0)
 ;
"RTN","BPSOSH6",141,0)
 S RLCNT=0
"RTN","BPSOSH6",142,0)
 S COUNT=$G(FDATA("M",MEDN,551))    ;preferred product count
"RTN","BPSOSH6",143,0)
 Q:COUNT'>0
"RTN","BPSOSH6",144,0)
 ;
"RTN","BPSOSH6",145,0)
 F CNTR=1:1:COUNT  D
"RTN","BPSOSH6",146,0)
 . S (PPIDQ,PPID,PPINC,PPCOP,PPDESC)=""
"RTN","BPSOSH6",147,0)
 . S PPIDQ=$G(FDATA("M",MEDN,552,CNTR))  ;preferred product id qual
"RTN","BPSOSH6",148,0)
 . S PPID=$G(FDATA("M",MEDN,553,CNTR))   ;preferred product id
"RTN","BPSOSH6",149,0)
 . S PPINC=$G(FDATA("M",MEDN,554,CNTR))  ;preferred product incentive
"RTN","BPSOSH6",150,0)
 . S PPCOP=$G(FDATA("M",MEDN,555,CNTR))  ;preferred product copay inc
"RTN","BPSOSH6",151,0)
 . S PPDESC=$G(FDATA("M",MEDN,556,CNTR)) ;preferred product desc
"RTN","BPSOSH6",152,0)
 . S CKREC=PPIDQ_PPID_PPINC_PPCOP_PPDESC ;quick chk for values
"RTN","BPSOSH6",153,0)
 . I $D(CKREC) D
"RTN","BPSOSH6",154,0)
 .. S $P(^BPSR(RESPIEN,1000,INDEX,551.01,CNTR,0),U)=CNTR
"RTN","BPSOSH6",155,0)
 .. S ^BPSR(RESPIEN,1000,INDEX,551.01,"B",CNTR,CNTR)=""
"RTN","BPSOSH6",156,0)
 .. S RLCNT=RLCNT+1
"RTN","BPSOSH6",157,0)
 . S:$D(PPIDQ) $P(^BPSR(RESPIEN,1000,INDEX,551.01,CNTR,1),U,1)=PPIDQ
"RTN","BPSOSH6",158,0)
 . S:$D(PPID) $P(^BPSR(RESPIEN,1000,INDEX,551.01,CNTR,1),U,2)=PPID
"RTN","BPSOSH6",159,0)
 . S:$D(PPINC) $P(^BPSR(RESPIEN,1000,INDEX,551.01,CNTR,1),U,3)=PPINC
"RTN","BPSOSH6",160,0)
 . S:$D(PPCOP) $P(^BPSR(RESPIEN,1000,INDEX,551.01,CNTR,1),U,4)=PPCOP
"RTN","BPSOSH6",161,0)
 . S:$D(PPDESC) $P(^BPSR(RESPIEN,1000,INDEX,551.01,CNTR,1),U,5)=PPDESC
"RTN","BPSOSH6",162,0)
 ;
"RTN","BPSOSH6",163,0)
 I RLCNT>0 D
"RTN","BPSOSH6",164,0)
 . S ^BPSR(RESPIEN,1000,INDEX,551.01,0)="^9002313.1301A^"_RLCNT_"^"_RLCNT
"RTN","BPSOSH6",165,0)
 ;
"RTN","BPSOSH6",166,0)
 Q
"RTN","BPSOSH6",167,0)
 ;
"RTN","BPSOSH7")
0^160^B45796867
"RTN","BPSOSH7",1,0)
BPSOSH7 ;BHAM ISC/SD/lwj/DLF - NCPDP 5.1 Post 5.1 response ;06/01/2004
"RTN","BPSOSH7",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSH7",3,0)
 ;-------------------------------------------------------------
"RTN","BPSOSH7",4,0)
 ; Originally, the entire response was processed in the 
"RTN","BPSOSH7",5,0)
 ; BPSOSH5 routine - but it exceed SAC limitations on 
"RTN","BPSOSH7",6,0)
 ; routine size - so the processing of some of the transaction 
"RTN","BPSOSH7",7,0)
 ; level information was moved to this routine. Other portions
"RTN","BPSOSH7",8,0)
 ; were moved to the BPSOSH6 routine.
"RTN","BPSOSH7",9,0)
 ; 
"RTN","BPSOSH7",10,0)
 ; This routine is called solely from BPSOSH5.
"RTN","BPSOSH7",11,0)
 ;
"RTN","BPSOSH7",12,0)
 ;
"RTN","BPSOSH7",13,0)
 Q
"RTN","BPSOSH7",14,0)
RESPPRC ;EP  - NCPDP 5.1 response processing (moved from BPSOSH5)  
"RTN","BPSOSH7",15,0)
 ; called from WRTTRAN^BPSOSH5
"RTN","BPSOSH7",16,0)
 ; MEDN is set in BPSOSH5 in the WRTTRAN subroutine
"RTN","BPSOSH7",17,0)
 ; process the response pricing segment - here's the fields we MIGHT 
"RTN","BPSOSH7",18,0)
 ; encounter:
"RTN","BPSOSH7",19,0)
 ; 505 - patient pay amount
"RTN","BPSOSH7",20,0)
 ; 506 - ingredient code paid
"RTN","BPSOSH7",21,0)
 ; 507 - dispensing fee paid
"RTN","BPSOSH7",22,0)
 ; 557 - tax exempt indicator
"RTN","BPSOSH7",23,0)
 ; 558 - flat sales tax amount paid
"RTN","BPSOSH7",24,0)
 ; 559 - percentage sales tax amount paid
"RTN","BPSOSH7",25,0)
 ; 560 - percentage sales tax rate paid
"RTN","BPSOSH7",26,0)
 ; 561 - percentage sales tax basis paid
"RTN","BPSOSH7",27,0)
 ; 521 - incentive amount paid
"RTN","BPSOSH7",28,0)
 ; 562 - professional service fee paid
"RTN","BPSOSH7",29,0)
 ; 563 - other amount paid count
"RTN","BPSOSH7",30,0)
 ; 564 - other amount paid qualifier (repeating)
"RTN","BPSOSH7",31,0)
 ; 565 - other amount paid (repeating)
"RTN","BPSOSH7",32,0)
 ; 566 - other payer amount recognized
"RTN","BPSOSH7",33,0)
 ; 509 - total amount paid
"RTN","BPSOSH7",34,0)
 ; 522 - basis of reimbursement determination
"RTN","BPSOSH7",35,0)
 ; 523 - amount attributed to sales tax
"RTN","BPSOSH7",36,0)
 ; 512 - accumulated deductible amount
"RTN","BPSOSH7",37,0)
 ; 513 - remaining deductible amount
"RTN","BPSOSH7",38,0)
 ; 514 - remaining benefit amount
"RTN","BPSOSH7",39,0)
 ; 517 - amount applied to periodic deductible
"RTN","BPSOSH7",40,0)
 ; 518 - amount of copay/co-insurance
"RTN","BPSOSH7",41,0)
 ; 519 - amount attributed to product selection
"RTN","BPSOSH7",42,0)
 ; 520 - amount exceeding periodic benefit maximum
"RTN","BPSOSH7",43,0)
 ; 346 - basis of calculation - dispensing fee
"RTN","BPSOSH7",44,0)
 ; 347 - basis of calculation - copay
"RTN","BPSOSH7",45,0)
 ; 348 - basis of calculation - flat sales tax
"RTN","BPSOSH7",46,0)
 ; 349 - basis of calculation - percentage sales tax
"RTN","BPSOSH7",47,0)
 ;
"RTN","BPSOSH7",48,0)
 ; process everything up to the repeating fields
"RTN","BPSOSH7",49,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,5)=$G(FDATA("M",MEDN,505))
"RTN","BPSOSH7",50,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,6)=$G(FDATA("M",MEDN,506))
"RTN","BPSOSH7",51,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,7)=$G(FDATA("M",MEDN,507))
"RTN","BPSOSH7",52,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,550),U,7)=$G(FDATA("M",MEDN,557))
"RTN","BPSOSH7",53,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,550),U,8)=$G(FDATA("M",MEDN,558))
"RTN","BPSOSH7",54,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,550),U,9)=$G(FDATA("M",MEDN,559))
"RTN","BPSOSH7",55,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,550),U,10)=$G(FDATA("M",MEDN,560))
"RTN","BPSOSH7",56,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,560),U)=$G(FDATA("M",MEDN,561))
"RTN","BPSOSH7",57,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,21)=$G(FDATA("M",MEDN,521))
"RTN","BPSOSH7",58,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,560),U,2)=$G(FDATA("M",MEDN,562))
"RTN","BPSOSH7",59,0)
 ;
"RTN","BPSOSH7",60,0)
 ; figure out if we have any of the other paid amount repeating flds
"RTN","BPSOSH7",61,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,560),U,3)=$G(FDATA("M",MEDN,563))
"RTN","BPSOSH7",62,0)
 I $D(FDATA("M",MEDN,563)) D REPOPA      ;process the repeating flds
"RTN","BPSOSH7",63,0)
 ;
"RTN","BPSOSH7",64,0)
 ; now back to the regular fields
"RTN","BPSOSH7",65,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,560),U,6)=$G(FDATA("M",MEDN,566))
"RTN","BPSOSH7",66,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,9)=$G(FDATA("M",MEDN,509))
"RTN","BPSOSH7",67,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,22)=$G(FDATA("M",MEDN,522))
"RTN","BPSOSH7",68,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,23)=$G(FDATA("M",MEDN,523))
"RTN","BPSOSH7",69,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,12)=$G(FDATA("M",MEDN,512))
"RTN","BPSOSH7",70,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,13)=$G(FDATA("M",MEDN,513))
"RTN","BPSOSH7",71,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,14)=$G(FDATA("M",MEDN,514))
"RTN","BPSOSH7",72,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,17)=$G(FDATA("M",MEDN,517))
"RTN","BPSOSH7",73,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,18)=$G(FDATA("M",MEDN,518))
"RTN","BPSOSH7",74,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,19)=$G(FDATA("M",MEDN,519))
"RTN","BPSOSH7",75,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,500),U,20)=$G(FDATA("M",MEDN,520))
"RTN","BPSOSH7",76,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,340),U,6)=$G(FDATA("M",MEDN,346))
"RTN","BPSOSH7",77,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,340),U,7)=$G(FDATA("M",MEDN,347))
"RTN","BPSOSH7",78,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,340),U,8)=$G(FDATA("M",MEDN,348))
"RTN","BPSOSH7",79,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,340),U,9)=$G(FDATA("M",MEDN,349))
"RTN","BPSOSH7",80,0)
 ;
"RTN","BPSOSH7",81,0)
 ;
"RTN","BPSOSH7",82,0)
 Q
"RTN","BPSOSH7",83,0)
 ;
"RTN","BPSOSH7",84,0)
 ;
"RTN","BPSOSH7",85,0)
REPOPA ; This subroutine will process the other amount paid repeating fields 
"RTN","BPSOSH7",86,0)
 ; that are a part of the pricing segment.
"RTN","BPSOSH7",87,0)
 ; Two fields here - 564 - other amount paid qualifier 
"RTN","BPSOSH7",88,0)
 ;                   565 - other amount paid
"RTN","BPSOSH7",89,0)
 ;
"RTN","BPSOSH7",90,0)
 N CNTR,COUNT,AMTPDQ,AMTPD,CKREC
"RTN","BPSOSH7",91,0)
 ;
"RTN","BPSOSH7",92,0)
 S RLCNT=0
"RTN","BPSOSH7",93,0)
 S COUNT=$G(FDATA("M",MEDN,563))    ;other amount paid count
"RTN","BPSOSH7",94,0)
 Q:COUNT'>0
"RTN","BPSOSH7",95,0)
 ;
"RTN","BPSOSH7",96,0)
 F CNTR=1:1:COUNT  D
"RTN","BPSOSH7",97,0)
 . S (AMTPDQ,AMTPD)=""
"RTN","BPSOSH7",98,0)
 . S AMTPDQ=$G(FDATA("M",MEDN,564,CNTR))  ;other amount paid qual
"RTN","BPSOSH7",99,0)
 . S AMTPD=$G(FDATA("M",MEDN,565,CNTR))   ;other amount paid
"RTN","BPSOSH7",100,0)
 . S CKREC=AMTPDQ_AMTPD                   ;quick chk for values
"RTN","BPSOSH7",101,0)
 . I $D(CKREC) D
"RTN","BPSOSH7",102,0)
 .. S $P(^BPSR(RESPIEN,1000,INDEX,563.01,CNTR,0),U)=CNTR
"RTN","BPSOSH7",103,0)
 .. S ^BPSR(RESPIEN,1000,INDEX,563.01,"B",CNTR,CNTR)=""
"RTN","BPSOSH7",104,0)
 .. S RLCNT=RLCNT+1
"RTN","BPSOSH7",105,0)
 . S:$D(AMTPDQ) $P(^BPSR(RESPIEN,1000,INDEX,563.01,CNTR,1),U,1)=AMTPDQ
"RTN","BPSOSH7",106,0)
 . S:$D(AMTPD) $P(^BPSR(RESPIEN,1000,INDEX,563.01,CNTR,1),U,2)=AMTPD
"RTN","BPSOSH7",107,0)
 ;
"RTN","BPSOSH7",108,0)
 I RLCNT>0 D
"RTN","BPSOSH7",109,0)
 . S ^BPSR(RESPIEN,1000,INDEX,563.01,0)="^9002313.1401A^"_RLCNT_"^"_RLCNT
"RTN","BPSOSH7",110,0)
 ;
"RTN","BPSOSH7",111,0)
 Q
"RTN","BPSOSH7",112,0)
 ;
"RTN","BPSOSH7",113,0)
RESPDUR ;EP  - NCPDP 5.1 response processing (moved from BPSOSH5)  
"RTN","BPSOSH7",114,0)
 ; called from WRTTRAN^BPSOSH5
"RTN","BPSOSH7",115,0)
 ; MEDN is set in BPSOSH5 in the WRTTRAN subroutine
"RTN","BPSOSH7",116,0)
 ; process the response DUR segment - here's the fields we MIGHT 
"RTN","BPSOSH7",117,0)
 ; encounter:
"RTN","BPSOSH7",118,0)
 ; 567 - DUR/PPS Response Code counter (repeating)
"RTN","BPSOSH7",119,0)
 ; 439 - reason for service (repeating)
"RTN","BPSOSH7",120,0)
 ; 528 - clinical significance code (repeating)
"RTN","BPSOSH7",121,0)
 ; 529 - other pharmacy indicator (repeating)
"RTN","BPSOSH7",122,0)
 ; 530 - previous date of fill (repeating)
"RTN","BPSOSH7",123,0)
 ; 531 - quantity of previous fill (repeating)
"RTN","BPSOSH7",124,0)
 ; 532 - database indicator (repeating)
"RTN","BPSOSH7",125,0)
 ; 533 - other prescriber indicator (repeating)
"RTN","BPSOSH7",126,0)
 ; 544 - DUR free text message (repeating)
"RTN","BPSOSH7",127,0)
 ;
"RTN","BPSOSH7",128,0)
 ; All fields on this segment are not only optional, but also
"RTN","BPSOSH7",129,0)
 ; repeating.  Please note that field 567 is NOT a count, but
"RTN","BPSOSH7",130,0)
 ; a counter, which changes how we process this repeating
"RTN","BPSOSH7",131,0)
 ; segment.  Since this entire record is repeating, and the
"RTN","BPSOSH7",132,0)
 ; logic is different, we will keep it here, rather than have
"RTN","BPSOSH7",133,0)
 ; it call a separate repeating subroutine.
"RTN","BPSOSH7",134,0)
 ;
"RTN","BPSOSH7",135,0)
 ;
"RTN","BPSOSH7",136,0)
 N CNTR,RLCNT,RSNCD,CLINCD,OTHPHM,PREVDT,PRVQTY,DBID,OTHPRS,FREETX
"RTN","BPSOSH7",137,0)
 ;
"RTN","BPSOSH7",138,0)
 Q:'$D(FDATA("M",MEDN,567))  ;just quit if there isn't anything
"RTN","BPSOSH7",139,0)
 ;
"RTN","BPSOSH7",140,0)
 S (CNTR,RLCNT)=0
"RTN","BPSOSH7",141,0)
 ;
"RTN","BPSOSH7",142,0)
 F  S CNTR=$O(FDATA("M",MEDN,567,CNTR)) Q:CNTR=""  D
"RTN","BPSOSH7",143,0)
 . ;first lets retrieve the values for this record
"RTN","BPSOSH7",144,0)
 . S RLCNT=RLCNT+1
"RTN","BPSOSH7",145,0)
 . S (RSNCD,CLINCD,OTHPHM,PREVDT,PRVQTY,DBID,OTHPRS,FREETX)=""
"RTN","BPSOSH7",146,0)
 . S RSNCD=$G(FDATA("M",MEDN,439,CNTR))  ;reason for service code 
"RTN","BPSOSH7",147,0)
 . S CLINCD=$G(FDATA("M",MEDN,528,CNTR)) ;clinical significance code
"RTN","BPSOSH7",148,0)
 . S OTHPHM=$G(FDATA("M",MEDN,529,CNTR)) ;other pharmacy indicator
"RTN","BPSOSH7",149,0)
 . S PREVDT=$G(FDATA("M",MEDN,530,CNTR)) ;previous date of fill
"RTN","BPSOSH7",150,0)
 . S PRVQTY=$G(FDATA("M",MEDN,531,CNTR)) ;quantity of previous fill
"RTN","BPSOSH7",151,0)
 . S DBID=$G(FDATA("M",MEDN,532,CNTR))   ;database indicator
"RTN","BPSOSH7",152,0)
 . S OTHPRS=$G(FDATA("M",MEDN,533,CNTR)) ;other prescriber indicator
"RTN","BPSOSH7",153,0)
 . S FREETX=$G(FDATA("M",MEDN,544,CNTR)) ;DUR free text message 
"RTN","BPSOSH7",154,0)
 . ;
"RTN","BPSOSH7",155,0)
 . ; now lets set the response file with the values we just got
"RTN","BPSOSH7",156,0)
 . ; don't forget that we have to hard set the "b" xref too
"RTN","BPSOSH7",157,0)
 . S $P(^BPSR(RESPIEN,1000,INDEX,567.01,CNTR,0),U)=CNTR
"RTN","BPSOSH7",158,0)
 . S ^BPSR(RESPIEN,1000,INDEX,567.01,"B",CNTR,CNTR)=""
"RTN","BPSOSH7",159,0)
 . S:$D(RSNCD) $P(^BPSR(RESPIEN,1000,INDEX,567.01,CNTR,0),U,2)=RSNCD
"RTN","BPSOSH7",160,0)
 . S:$D(CLINCD) $P(^BPSR(RESPIEN,1000,INDEX,567.01,CNTR,0),U,3)=CLINCD
"RTN","BPSOSH7",161,0)
 . S:$D(OTHPHM) $P(^BPSR(RESPIEN,1000,INDEX,567.01,CNTR,0),U,4)=OTHPHM
"RTN","BPSOSH7",162,0)
 . S:$D(PREVDT) $P(^BPSR(RESPIEN,1000,INDEX,567.01,CNTR,0),U,5)=PREVDT
"RTN","BPSOSH7",163,0)
 . S:$D(PRVQTY) $P(^BPSR(RESPIEN,1000,INDEX,567.01,CNTR,0),U,6)=PRVQTY
"RTN","BPSOSH7",164,0)
 . S:$D(DBID) $P(^BPSR(RESPIEN,1000,INDEX,567.01,CNTR,0),U,7)=DBID
"RTN","BPSOSH7",165,0)
 . S:$D(OTHPRS) $P(^BPSR(RESPIEN,1000,INDEX,567.01,CNTR,0),U,8)=OTHPRS
"RTN","BPSOSH7",166,0)
 . S:$D(FREETX) $P(^BPSR(RESPIEN,1000,INDEX,567.01,CNTR,0),U,9)=FREETX
"RTN","BPSOSH7",167,0)
 ;
"RTN","BPSOSH7",168,0)
 I RLCNT>0 D
"RTN","BPSOSH7",169,0)
 . S ^BPSR(RESPIEN,1000,INDEX,567.01,0)="^9002313.1101A^"_RLCNT_"^"_RLCNT
"RTN","BPSOSH7",170,0)
 ;
"RTN","BPSOSH7",171,0)
 Q
"RTN","BPSOSH7",172,0)
 ;
"RTN","BPSOSH7",173,0)
 ;
"RTN","BPSOSH7",174,0)
RESPPA ;EP  - NCPDP 5.1 response processing (moved from BPSOSH5)  
"RTN","BPSOSH7",175,0)
 ; called from WRTTRAN^BPSOSH5
"RTN","BPSOSH7",176,0)
 ; MEDN is set in BPSOSH5 in the WRTTRAN subroutine
"RTN","BPSOSH7",177,0)
 ; process the response prior authorization segment - here's the  
"RTN","BPSOSH7",178,0)
 ; fields we MIGHT encounter:
"RTN","BPSOSH7",179,0)
 ; 498.51 - prior authorization processed date
"RTN","BPSOSH7",180,0)
 ; 498.52 - prior authorization effective date
"RTN","BPSOSH7",181,0)
 ; 498.53 - prior authorization expiration date
"RTN","BPSOSH7",182,0)
 ; 498.57 - prior authorization quantity
"RTN","BPSOSH7",183,0)
 ; 498.58 - prior authorization dollars authorized
"RTN","BPSOSH7",184,0)
 ; 498.54 - prior authorization number of refills authorized
"RTN","BPSOSH7",185,0)
 ; 498.55 - prior authorization quantity accumulated
"RTN","BPSOSH7",186,0)
 ; 498.14 - prior authorization number - assigned
"RTN","BPSOSH7",187,0)
 ;
"RTN","BPSOSH7",188,0)
 ; no repeating fields on this segments so we will simply process
"RTN","BPSOSH7",189,0)
 ; what we find
"RTN","BPSOSH7",190,0)
 ;
"RTN","BPSOSH7",191,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,498),U,1)=$G(FDATA("M",MEDN,498.51))
"RTN","BPSOSH7",192,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,498),U,2)=$G(FDATA("M",MEDN,498.52))
"RTN","BPSOSH7",193,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,498),U,3)=$G(FDATA("M",MEDN,498.53))
"RTN","BPSOSH7",194,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,498),U,7)=$G(FDATA("M",MEDN,498.57))
"RTN","BPSOSH7",195,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,498),U,8)=$G(FDATA("M",MEDN,498.58))
"RTN","BPSOSH7",196,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,498),U,4)=$G(FDATA("M",MEDN,498.54))
"RTN","BPSOSH7",197,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,498),U,5)=$G(FDATA("M",MEDN,498.55))
"RTN","BPSOSH7",198,0)
 S $P(^BPSR(RESPIEN,1000,INDEX,498),U,6)=$G(FDATA("M",MEDN,498.14))
"RTN","BPSOSH7",199,0)
 ;
"RTN","BPSOSH7",200,0)
 ;
"RTN","BPSOSH7",201,0)
 Q
"RTN","BPSOSH7",202,0)
 ;
"RTN","BPSOSHF")
0^161^B11283360
"RTN","BPSOSHF",1,0)
BPSOSHF ;BHAM ISC/SD/lwj/DLF - Get/Format/Set value for DUR/PPS segment ;06/01/2004
"RTN","BPSOSHF",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSHF",3,0)
 ;
"RTN","BPSOSHF",4,0)
 ; This routine is an addendum to BPSOSCF.  Its purpose is to handle
"RTN","BPSOSHF",5,0)
 ; some of the repeating fields that now exist in NCPDP 5.1.  
"RTN","BPSOSHF",6,0)
 ; The logic was put in here rather than BPSOSCF to keep the original
"RTN","BPSOSHF",7,0)
 ; routine (BPSOSCF) from growing too large and too cumbersome to
"RTN","BPSOSHF",8,0)
 ; maintain.
"RTN","BPSOSHF",9,0)
 ;
"RTN","BPSOSHF",10,0)
 ; At this point, the only repeating fields we handle in this routine
"RTN","BPSOSHF",11,0)
 ; are those contained in the DUR/PPS segment.
"RTN","BPSOSHF",12,0)
 ;
"RTN","BPSOSHF",13,0)
DURPPS(FORMAT,NODE,MEDN)     ;EP called from BPSOSCF  
"RTN","BPSOSHF",14,0)
 ;---------------------------------------------------------------
"RTN","BPSOSHF",15,0)
 ;NCPDP 5.1 changes   
"RTN","BPSOSHF",16,0)
 ; Processing of the 5.1 DUR/PPS segment is much different than the
"RTN","BPSOSHF",17,0)
 ; conventional segments of 3.2, simply because all of its fields
"RTN","BPSOSHF",18,0)
 ; are optional, and repeating.  The repeating portion of this 
"RTN","BPSOSHF",19,0)
 ; causes us to have yet another index we have to account for, and
"RTN","BPSOSHF",20,0)
 ; we must be able to tell which of the fields really needs to be
"RTN","BPSOSHF",21,0)
 ; populated.  The population of this segment is based on those
"RTN","BPSOSHF",22,0)
 ; values found for the prescription or refill in the BPS DUR/PPS
"RTN","BPSOSHF",23,0)
 ; file.  The file's values are temporarily stored in the
"RTN","BPSOSHF",24,0)
 ; BPS("RX",MEDN,DUR....) array for easy access and reference.
"RTN","BPSOSHF",25,0)
 ; (Special note - Overrides are not allowed on this multiple since
"RTN","BPSOSHF",26,0)
 ; they can simply update the DUR/PPS filed directly. For the same
"RTN","BPSOSHF",27,0)
 ; reason, "special" code is not accounted for either.
"RTN","BPSOSHF",28,0)
 ;---------------------------------------------------------------
"RTN","BPSOSHF",29,0)
 ;
"RTN","BPSOSHF",30,0)
 ; first order of business - check the BPS("RX",MEDN,"DUR") array
"RTN","BPSOSHF",31,0)
 ; for values - if there aren't any, we don't need to write this
"RTN","BPSOSHF",32,0)
 ; segment
"RTN","BPSOSHF",33,0)
 ;
"RTN","BPSOSHF",34,0)
 N FIELD,BPS51,RECCNT,DUR,FLD,OVERRIDE,FLAG,ORD,FLDIEN,FLDNUM
"RTN","BPSOSHF",35,0)
 S FLAG="FS"
"RTN","BPSOSHF",36,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S FLAG="GFS"
"RTN","BPSOSHF",37,0)
 ;
"RTN","BPSOSHF",38,0)
 Q:'$D(BPS("RX",MEDN,"DUR"))
"RTN","BPSOSHF",39,0)
 ;
"RTN","BPSOSHF",40,0)
 ;next we need to figure out which fields on this format are really
"RTN","BPSOSHF",41,0)
 ; needed, then we will loop through and populate them
"RTN","BPSOSHF",42,0)
 ;
"RTN","BPSOSHF",43,0)
 D GETFLDS(FORMAT,NODE,.FIELD)
"RTN","BPSOSHF",44,0)
 ;
"RTN","BPSOSHF",45,0)
 ; now lets get, format and set the field
"RTN","BPSOSHF",46,0)
 S BPS51=1 ;needed in the set logic for dual 3.2/5.1 fields
"RTN","BPSOSHF",47,0)
 S (ORD,RECCNT,DUR)=0
"RTN","BPSOSHF",48,0)
 S RECCNT=RECCNT+1
"RTN","BPSOSHF",49,0)
 F  S DUR=$O(BPS("RX",MEDN,"DUR",DUR)) Q:DUR=""  D
"RTN","BPSOSHF",50,0)
 . S FLDNUM="" F  S FLDNUM=$O(BPS("RX",MEDN,"DUR",DUR,FLDNUM)) Q:FLDNUM=""  D
"RTN","BPSOSHF",51,0)
 .. S ORD="",FOUND=0
"RTN","BPSOSHF",52,0)
 .. F  S ORD=$O(FIELD(ORD)) Q:ORD=""  D  Q:FOUND
"RTN","BPSOSHF",53,0)
 ... S FLDNUMB="",FLDNUMB=$P(FIELD(ORD),U,2) Q:FLDNUMB'=FLDNUM
"RTN","BPSOSHF",54,0)
 ... S FLDIEN="",FLDIEN=$P(FIELD(ORD),U)
"RTN","BPSOSHF",55,0)
 ... S BPS("X")=BPS("RX",MEDN,"DUR",DUR,FLDNUM)
"RTN","BPSOSHF",56,0)
 ... S FOUND=1
"RTN","BPSOSHF",57,0)
 ... D XFLDCODE^BPSOSCF(FLDIEN,FLAG)  ;format/set
"RTN","BPSOSHF",58,0)
 ;
"RTN","BPSOSHF",59,0)
 ; this sets the record count and last record on the subfile
"RTN","BPSOSHF",60,0)
 S ^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,0)="^9002313.1001A^"_RECCNT_"^"_RECCNT
"RTN","BPSOSHF",61,0)
 ;
"RTN","BPSOSHF",62,0)
 Q
"RTN","BPSOSHF",63,0)
GETFLDS(FORMAT,NODE,FIELD) ;EP NCPDP 5.1 
"RTN","BPSOSHF",64,0)
 ;---------------------------------------------------------------
"RTN","BPSOSHF",65,0)
 ;This routine will get the list of repeating fields that must be
"RTN","BPSOSHF",66,0)
 ; be worked with separately
"RTN","BPSOSHF",67,0)
 ; (This was originally coded for the DUR/PPS segment - I'm not
"RTN","BPSOSHF",68,0)
 ; 100% sure how and if it will work for the other repeating
"RTN","BPSOSHF",69,0)
 ; fields that exist within a segment.)
"RTN","BPSOSHF",70,0)
 ;---------------------------------------------------------------
"RTN","BPSOSHF",71,0)
 ; Coming in:
"RTN","BPSOSHF",72,0)
 ;   FORMAT = BPSF(9002313.92 's format IEN
"RTN","BPSOSHF",73,0)
 ;   NODE   = which segment we are processing (i.e. 180 - DUR/PPS)
"RTN","BPSOSHF",74,0)
 ;  .FIELD  = array to store the values in
"RTN","BPSOSHF",75,0)
 ;
"RTN","BPSOSHF",76,0)
 ; Exitting:
"RTN","BPSOSHF",77,0)
 ;  .FIELD array will look like:
"RTN","BPSOSHF",78,0)
 ;     FIELD(ord)=int^ext
"RTN","BPSOSHF",79,0)
 ;  Where:   ext = external field number from BPSF(9002313.91
"RTN","BPSOSHF",80,0)
 ;           int = internal field number from BPSF(9002313.91
"RTN","BPSOSHF",81,0)
 ;           ord = the order of the field - used in creating clm
"RTN","BPSOSHF",82,0)
 ;---------------------------------------------------------------
"RTN","BPSOSHF",83,0)
 ;
"RTN","BPSOSHF",84,0)
 N ORDER,RECMIEN,MDATA,FLDIEN,FLDNUM,DUR
"RTN","BPSOSHF",85,0)
 ;
"RTN","BPSOSHF",86,0)
 S ORDER=0
"RTN","BPSOSHF",87,0)
 ;
"RTN","BPSOSHF",88,0)
 F  D  Q:'ORDER
"RTN","BPSOSHF",89,0)
 . ;
"RTN","BPSOSHF",90,0)
 . ; let's order through the format file for this node
"RTN","BPSOSHF",91,0)
 . ;
"RTN","BPSOSHF",92,0)
 . S ORDER=$O(^BPSF(9002313.92,FORMAT,NODE,"B",ORDER)) Q:'ORDER
"RTN","BPSOSHF",93,0)
 . S RECMIEN=$O(^BPSF(9002313.92,FORMAT,NODE,"B",ORDER,0))
"RTN","BPSOSHF",94,0)
 . I 'RECMIEN D IMPOSS^BPSOSUE("DB","TI","NODE="_NODE,"ORDER="_ORDER,2,$T(+0))
"RTN","BPSOSHF",95,0)
 . S MDATA=^BPSF(9002313.92,FORMAT,NODE,RECMIEN,0)
"RTN","BPSOSHF",96,0)
 . S FLDIEN=$P(MDATA,U,2)
"RTN","BPSOSHF",97,0)
 . I 'FLDIEN D IMPOSS^BPSOSUE("DB","TI","NODE="_NODE,"RECMIEN="_RECMIEN,3,$T(+0)) ; corrupt or erroneous format file
"RTN","BPSOSHF",98,0)
 . I '$D(^BPSF(9002313.91,FLDIEN,0)) D IMPOSS^BPSOSUE("DB,P","TI","FLDIEN="_FLDIEN,,"DURPPS",$T(+0))  ;incomplete field definition
"RTN","BPSOSHF",99,0)
 . ;
"RTN","BPSOSHF",100,0)
 . ;lets create a list of fields we need
"RTN","BPSOSHF",101,0)
 . S FLDNUM=$P($G(^BPSF(9002313.91,FLDIEN,0)),U)
"RTN","BPSOSHF",102,0)
 . S:FLDNUM'=111 FIELD(ORDER)=FLDIEN_"^"_FLDNUM
"RTN","BPSOSHF",103,0)
 ;
"RTN","BPSOSHF",104,0)
 ;
"RTN","BPSOSHF",105,0)
 Q
"RTN","BPSOSHR")
0^162^B19974681
"RTN","BPSOSHR",1,0)
BPSOSHR ;BHAM ISC/SD/lwj/DLF - 3.2 to 5.1 clm reversal format ;06/01/2004
"RTN","BPSOSHR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSHR",3,0)
 ;
"RTN","BPSOSHR",4,0)
 ;-------------------------------------------------------
"RTN","BPSOSHR",5,0)
 ; IHS/SD/lwj 10/22/02 NCPDP 5.1 changes
"RTN","BPSOSHR",6,0)
 ; We ran into a big snag - some processors are doing an all or nothing
"RTN","BPSOSHR",7,0)
 ; switch to 5.1 with no grace period for 3.2 and 5.1 claims.  What this
"RTN","BPSOSHR",8,0)
 ; means is that we have to be able to reverse a previously submitted
"RTN","BPSOSHR",9,0)
 ; 3.2 claim in 5.1 reversal format since they won't accept 3.2 any
"RTN","BPSOSHR",10,0)
 ; more.  The biggest problem with this is that 3.2 and 5.1 fields
"RTN","BPSOSHR",11,0)
 ; are formatted differently, and the reversal process was used to
"RTN","BPSOSHR",12,0)
 ; simply copy the information from the original claim into the
"RTN","BPSOSHR",13,0)
 ; reversal claim.  To get around this, this routine was created
"RTN","BPSOSHR",14,0)
 ; to try and reformat those fields that require the 5.1 format to
"RTN","BPSOSHR",15,0)
 ; reverse properly.
"RTN","BPSOSHR",16,0)
 ;
"RTN","BPSOSHR",17,0)
 ; This routine should only be called from within the BPSECA8 - it
"RTN","BPSOSHR",18,0)
 ; is dependent on variables set there.
"RTN","BPSOSHR",19,0)
 ;
"RTN","BPSOSHR",20,0)
 ; Basic logic:
"RTN","BPSOSHR",21,0)
 ;  Read the format for the designated segment
"RTN","BPSOSHR",22,0)
 ;  Read through the fields on the segment (no xref - very few fields)
"RTN","BPSOSHR",23,0)
 ;  Determine if there are "special" values for the field
"RTN","BPSOSHR",24,0)
 ;  Format the field with the proper value
"RTN","BPSOSHR",25,0)
 ;  Set the TMP field to the formatted value
"RTN","BPSOSHR",26,0)
 ;
"RTN","BPSOSHR",27,0)
 Q
"RTN","BPSOSHR",28,0)
 ;
"RTN","BPSOSHR",29,0)
REFORM(BPSFORM) ;EP  main driver of problem and entry point - everything
"RTN","BPSOSHR",30,0)
 ; should call through to here
"RTN","BPSOSHR",31,0)
 ;
"RTN","BPSOSHR",32,0)
 N BPS
"RTN","BPSOSHR",33,0)
 ;
"RTN","BPSOSHR",34,0)
 D REFRMH(BPSFORM)
"RTN","BPSOSHR",35,0)
 D REFRMD(BPSFORM)
"RTN","BPSOSHR",36,0)
 ;
"RTN","BPSOSHR",37,0)
 Q
"RTN","BPSOSHR",38,0)
REFRMH(BPSFORM) ;
"RTN","BPSOSHR",39,0)
 ; This routine will only attempt to reset the "header" fields that need
"RTN","BPSOSHR",40,0)
 ; adjusting for 5.1.  There are four fields in the header segment that
"RTN","BPSOSHR",41,0)
 ; need to be reformatted - we will leave the others since they may have
"RTN","BPSOSHR",42,0)
 ; gone through extensive formatting for the original claim and are fine
"RTN","BPSOSHR",43,0)
 ; the way they are.  These four fields were either new to the reversal
"RTN","BPSOSHR",44,0)
 ; in 5.1, or changed value/length in 5.1.  The fields are:
"RTN","BPSOSHR",45,0)
 ;     109  Transaction Count   (not on 3.2 reversal)
"RTN","BPSOSHR",46,0)
 ;     110  Software Vendor/Certificationd ID  (new field to 5.1)
"RTN","BPSOSHR",47,0)
 ;     201  Service Provider ID (changed length in 5.1)
"RTN","BPSOSHR",48,0)
 ;     202  Service Provider ID Qualifier (new to 5.1)
"RTN","BPSOSHR",49,0)
 ;
"RTN","BPSOSHR",50,0)
 ; Remember - the header is stagnate - that's the only reason we look
"RTN","BPSOSHR",51,0)
 ; specifically for those two fields.
"RTN","BPSOSHR",52,0)
 ;
"RTN","BPSOSHR",53,0)
 ; IEN and TMP are set in BPSECA8
"RTN","BPSOSHR",54,0)
 ;
"RTN","BPSOSHR",55,0)
 ; The header segment is small, and there isn't a xref by field #, so we
"RTN","BPSOSHR",56,0)
 ; will read the entire segment here.
"RTN","BPSOSHR",57,0)
 ;
"RTN","BPSOSHR",58,0)
 N FLDIEN,PMODE,ORDER,RECMIEN,FIELD
"RTN","BPSOSHR",59,0)
 ;
"RTN","BPSOSHR",60,0)
 S ORDER=0
"RTN","BPSOSHR",61,0)
 F  S ORDER=$O(^BPSF(9002313.92,BPSFORM,100,"B",ORDER)) Q:'ORDER  D
"RTN","BPSOSHR",62,0)
 . S RECMIEN=$O(^BPSF(9002313.92,BPSFORM,100,"B",ORDER,0))
"RTN","BPSOSHR",63,0)
 . Q:'RECMIEN
"RTN","BPSOSHR",64,0)
 . S FLDIEN=$P($G(^BPSF(9002313.92,BPSFORM,100,RECMIEN,0)),U,2)
"RTN","BPSOSHR",65,0)
 . S FIELD=$P($G(^BPSF(9002313.91,FLDIEN,0)),U)
"RTN","BPSOSHR",66,0)
 . Q:(FIELD'=110)&(FIELD'=202)&(FIELD'=201)&(FIELD'=109)
"RTN","BPSOSHR",67,0)
 . ;
"RTN","BPSOSHR",68,0)
 . ; check to see if the format has a "special" value for this field
"RTN","BPSOSHR",69,0)
 . S PMODE=$P($G(^BPSF(9002313.92,BPSFORM,100,RECMIEN,0)),U,3)
"RTN","BPSOSHR",70,0)
 . I PMODE="X" D XSPCCODE^BPSOSCF(BPSFORM,100,RECMIEN)
"RTN","BPSOSHR",71,0)
 . I PMODE'="X" S BPS("X")=$G(TMP(9002313.02,IEN,FIELD,"I"))
"RTN","BPSOSHR",72,0)
 . ;
"RTN","BPSOSHR",73,0)
 . D FORMAT
"RTN","BPSOSHR",74,0)
 . ;
"RTN","BPSOSHR",75,0)
 . S TMP(9002313.02,IEN,FIELD,"I")=BPS("X")
"RTN","BPSOSHR",76,0)
 ;
"RTN","BPSOSHR",77,0)
 ;
"RTN","BPSOSHR",78,0)
 Q
"RTN","BPSOSHR",79,0)
 ;
"RTN","BPSOSHR",80,0)
REFRMD(BPSFORM) ;
"RTN","BPSOSHR",81,0)
 ; This routine is going to try and reformat the "detail" portion of the
"RTN","BPSOSHR",82,0)
 ; claim. For now, the only segment we are going to look at is 130
"RTN","BPSOSHR",83,0)
 ; which is the claim segment.  If other reversal formats become
"RTN","BPSOSHR",84,0)
 ; available, and they require other segments - this section will have
"RTN","BPSOSHR",85,0)
 ; to change.  Since the claim segment full of optional fields, we wil
"RTN","BPSOSHR",86,0)
 ; read through the format and take it a field at a time.
"RTN","BPSOSHR",87,0)
 ;
"RTN","BPSOSHR",88,0)
 ; IEN, RX, and TMP were set in BPSECA8
"RTN","BPSOSHR",89,0)
 ;
"RTN","BPSOSHR",90,0)
 ;
"RTN","BPSOSHR",91,0)
 N FLDIEN,PMODE,ORDER,RECMIEN,NODE,IDIEN,DOFORM,FIELD
"RTN","BPSOSHR",92,0)
 S NODE=130
"RTN","BPSOSHR",93,0)
 ;
"RTN","BPSOSHR",94,0)
 S ORDER=0
"RTN","BPSOSHR",95,0)
 F  S ORDER=$O(^BPSF(9002313.92,BPSFORM,NODE,"B",ORDER)) Q:'ORDER  D
"RTN","BPSOSHR",96,0)
 . S RECMIEN=$O(^BPSF(9002313.92,BPSFORM,NODE,"B",ORDER,0))
"RTN","BPSOSHR",97,0)
 . Q:'RECMIEN
"RTN","BPSOSHR",98,0)
 . S FLDIEN=$P($G(^BPSF(9002313.92,BPSFORM,NODE,RECMIEN,0)),U,2)
"RTN","BPSOSHR",99,0)
 . S FIELD=$P($G(^BPSF(9002313.91,FLDIEN,0)),U)
"RTN","BPSOSHR",100,0)
 . Q:FIELD=111    ;(SEGMENT IDENTIFIER - SKIP)
"RTN","BPSOSHR",101,0)
 . ;
"RTN","BPSOSHR",102,0)
 . ; check to see if the format has a "special" value for this field
"RTN","BPSOSHR",103,0)
 . S PMODE=$P($G(^BPSF(9002313.92,BPSFORM,NODE,RECMIEN,0)),U,3)
"RTN","BPSOSHR",104,0)
 . I $G(VARX) S BPS("X")=$G(TMP(9002313.0201,RX_","_IEN,FIELD,"I")) ;LJE;8/2/03
"RTN","BPSOSHR",105,0)
 . I PMODE="X" D XSPCCODE^BPSOSCF(BPSFORM,NODE,RECMIEN)
"RTN","BPSOSHR",106,0)
 . ;
"RTN","BPSOSHR",107,0)
 . ; if this isn't a special value field in 5.1, we need to make sure
"RTN","BPSOSHR",108,0)
 . ; it wasn't an optional field in 3.2. If it was, the field ID is
"RTN","BPSOSHR",109,0)
 . ; already a part of the field, and we don't need to reformat it
"RTN","BPSOSHR",110,0)
 . ;
"RTN","BPSOSHR",111,0)
 . S DOFORM=1
"RTN","BPSOSHR",112,0)
 . I PMODE'="X" D
"RTN","BPSOSHR",113,0)
 .. ; DMB 4/29/2005
"RTN","BPSOSHR",114,0)
 .. I '$G(VARX) S:$P($G(^BPSF(9002313.91,FLDIEN,0)),U,2)'="" DOFORM=0
"RTN","BPSOSHR",115,0)
 .. E  I $P($G(^BPSF(9002313.91,FLDIEN,5)),U,1)'="" S DOFORM=0
"RTN","BPSOSHR",116,0)
 .. S:DOFORM BPS("X")=$G(TMP(9002313.0201,RX_",",IEN,FIELD,"I"))
"RTN","BPSOSHR",117,0)
 . ;
"RTN","BPSOSHR",118,0)
 . ; format it only if it needs it
"RTN","BPSOSHR",119,0)
 . ;
"RTN","BPSOSHR",120,0)
 . I DOFORM D
"RTN","BPSOSHR",121,0)
 .. D FORMAT
"RTN","BPSOSHR",122,0)
 .. S TMP(9002313.0201,RX_","_IEN,FIELD,"I")=BPS("X")
"RTN","BPSOSHR",123,0)
 ;
"RTN","BPSOSHR",124,0)
 ;
"RTN","BPSOSHR",125,0)
 Q
"RTN","BPSOSHR",126,0)
 ;
"RTN","BPSOSHR",127,0)
FORMAT ; This routine will format the field to 5.1 standards - remember it
"RTN","BPSOSHR",128,0)
 ; will set BPS("X") based on what is in the BPS NCPDP Field Defs file
"RTN","BPSOSHR",129,0)
 ;
"RTN","BPSOSHR",130,0)
 N INDEX,MCODE,NODE,QUAL,QUALFLG  ;LJE;8/2/03
"RTN","BPSOSHR",131,0)
 S NODE=25            ;we only want the 5.1 format code
"RTN","BPSOSHR",132,0)
 ;
"RTN","BPSOSHR",133,0)
 S QUALFLG=0,QUAL="",QUAL=$P(^BPSF(9002313.91,FLDIEN,5),"^",1) ;LJE;8/2/03
"RTN","BPSOSHR",134,0)
 I $E(BPS("X"),1,2)=QUAL S QUALFLG=1,BPS("X")=$P(BPS("X"),QUAL,2) ;LJE;8/2/03
"RTN","BPSOSHR",135,0)
 S INDEX=0
"RTN","BPSOSHR",136,0)
  F  D  Q:'+INDEX
"RTN","BPSOSHR",137,0)
 . S INDEX=$O(^BPSF(9002313.91,FLDIEN,NODE,INDEX))
"RTN","BPSOSHR",138,0)
 . Q:'+INDEX
"RTN","BPSOSHR",139,0)
 . S MCODE=$G(^BPSF(9002313.91,FLDIEN,NODE,INDEX,0))
"RTN","BPSOSHR",140,0)
 . Q:MCODE=""
"RTN","BPSOSHR",141,0)
 . Q:$E(MCODE,1)=";"
"RTN","BPSOSHR",142,0)
 . X MCODE
"RTN","BPSOSHR",143,0)
 I QUALFLG&($E(BPS("X"),1,2)'=QUAL) S BPS("X")=QUAL_BPS("X")
"RTN","BPSOSHR",144,0)
 ;
"RTN","BPSOSHR",145,0)
 ;
"RTN","BPSOSHR",146,0)
 Q
"RTN","BPSOSHU")
0^163^B800785
"RTN","BPSOSHU",1,0)
BPSOSHU ;BHAM ISC/SD/lwj/DLF - various miscellaneous 5.1 utilities ;06/01/2004
"RTN","BPSOSHU",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSHU",3,0)
 ;
"RTN","BPSOSHU",4,0)
 ;--------------------------------------------------------------
"RTN","BPSOSHU",5,0)
 ; Because of SAC routine size limitations, many utilities 
"RTN","BPSOSHU",6,0)
 ; had to be split off into their own individual routines to
"RTN","BPSOSHU",7,0)
 ; avoid the limitation.
"RTN","BPSOSHU",8,0)
 ;
"RTN","BPSOSHU",9,0)
 ;
"RTN","BPSOSHU",10,0)
CLNDATA ;EP   NCPDP 5.1   Called from BPSOSH5
"RTN","BPSOSHU",11,0)
 ; Remove the leading and trailing blanks in each of the fields
"RTN","BPSOSHU",12,0)
 ; that is to be written to the ^BPSR global.
"RTN","BPSOSHU",13,0)
 ;
"RTN","BPSOSHU",14,0)
 N NEXT,MEDN
"RTN","BPSOSHU",15,0)
 ; 
"RTN","BPSOSHU",16,0)
 S NEXT=0
"RTN","BPSOSHU",17,0)
 F  D  Q:'NEXT
"RTN","BPSOSHU",18,0)
 .S NEXT=$O(FDATA(NEXT)) Q:'NEXT
"RTN","BPSOSHU",19,0)
 .S FDATA(NEXT)=$$CLIP^BPSOSU9($G(FDATA(NEXT)))
"RTN","BPSOSHU",20,0)
 S MEDN=""
"RTN","BPSOSHU",21,0)
 F  D  Q:MEDN=""
"RTN","BPSOSHU",22,0)
 .S MEDN=$O(FDATA("M",MEDN))
"RTN","BPSOSHU",23,0)
 .Q:MEDN=""
"RTN","BPSOSHU",24,0)
 .S NEXT=0
"RTN","BPSOSHU",25,0)
 .F  D  Q:'+NEXT
"RTN","BPSOSHU",26,0)
 ..S NEXT=$O(FDATA("M",MEDN,NEXT))
"RTN","BPSOSHU",27,0)
 ..Q:'+NEXT
"RTN","BPSOSHU",28,0)
 ..S FDATA("M",MEDN,NEXT)=$$CLIP^BPSOSU9($G(FDATA("M",MEDN,NEXT)))
"RTN","BPSOSHU",29,0)
 ;
"RTN","BPSOSHU",30,0)
 Q
"RTN","BPSOSI")
0^164^B31817055
"RTN","BPSOSI",1,0)
BPSOSI ;BHAM ISC/FCS/DRS/DLF - Data entry w/ScreenMan ;06/01/2004
"RTN","BPSOSI",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSI",3,0)
 ; This calls ScreenMan for an entry in file 9002313.51
"RTN","BPSOSI",4,0)
ALL ; This entry point does data entry and submits the claims, both.
"RTN","BPSOSI",5,0)
 ; This is what we'll call from the ListManager menu.
"RTN","BPSOSI",6,0)
 W !,"The NEW option will be available in a future patch."  H 2 Q  ;LJE
"RTN","BPSOSI",7,0)
 DO FULL^VALM1 ; List manager had set scroll regions
"RTN","BPSOSI",8,0)
 I $$OLDSTYLE G ^BPSOSIV
"RTN","BPSOSI",9,0)
ALL1 ;EP - BPSOSIV branches back here if user decides he wants Screenman
"RTN","BPSOSI",10,0)
 N INPUTIEN S INPUTIEN=$$NEW
"RTN","BPSOSI",11,0)
 I INPUTIEN D
"RTN","BPSOSI",12,0)
 . D FULL^VALM1 ; full screen - we might do I/O
"RTN","BPSOSI",13,0)
 . D FILE^BPSOSIZ(INPUTIEN) ; send them to ECME or to paper
"RTN","BPSOSI",14,0)
 . N NODISPLY S NODISPLY=1 D UPD^BPSOS6A ; so your new claims show up
"RTN","BPSOSI",15,0)
 . N % W ! R %:1
"RTN","BPSOSI",16,0)
 E  D
"RTN","BPSOSI",17,0)
 . W "Because of <PF1> Q,",!
"RTN","BPSOSI",18,0)
 . W "These charges and claims are NOT filed and processed.",!
"RTN","BPSOSI",19,0)
 . W ! R %:3
"RTN","BPSOSI",20,0)
 W !
"RTN","BPSOSI",21,0)
 S VALMBCK="R" ; tell List Manager to Refresh
"RTN","BPSOSI",22,0)
 Q
"RTN","BPSOSI",23,0)
 ;
"RTN","BPSOSI",24,0)
 ; Usually, for a new input session, $$NEW^BPSOSI 
"RTN","BPSOSI",25,0)
 ;   It returns the IEN of the session
"RTN","BPSOSI",26,0)
 ;
"RTN","BPSOSI",27,0)
 ; D ^BPSOSI -> TEST^BPSOSI  for testing and development
"RTN","BPSOSI",28,0)
 ;
"RTN","BPSOSI",29,0)
 ; If you need to edit an existing session, $$MYSCREEN^BPSOSI(IEN)
"RTN","BPSOSI",30,0)
 ; That's probably not going to be used, but it's here if you need it.
"RTN","BPSOSI",31,0)
 ;
"RTN","BPSOSI",32,0)
 Q
"RTN","BPSOSI",33,0)
NEW() ;EP - from BPSOSI
"RTN","BPSOSI",34,0)
 Q $$MYSCREEN(-1)
"RTN","BPSOSI",35,0)
 Q
"RTN","BPSOSI",36,0)
MYSCREEN(DA)       ; returns IEN of input if <PF1>E (or the equivalent) was used
"RTN","BPSOSI",37,0)
 ; if the user quits out (<PF1>Q or the equivalent), returns 0^IEN
"RTN","BPSOSI",38,0)
 N DDSFILE,DR,DDSPAGE,DDSPARM
"RTN","BPSOSI",39,0)
 N DDSCHANG,DDSSAVE,DIMSG,DTOUT,RETVAL
"RTN","BPSOSI",40,0)
 S DDSFILE=9002313.51 ; PEC/MIS INPUT file
"RTN","BPSOSI",41,0)
 S DR="[BPS INPUT 1]"
"RTN","BPSOSI",42,0)
 I DA'>0 D
"RTN","BPSOSI",43,0)
 . S DA=$$NEWREC(,,2)
"RTN","BPSOSI",44,0)
 . S RETVAL=$$INIT(DA)
"RTN","BPSOSI",45,0)
 S DDSPARM="CS"
"RTN","BPSOSI",46,0)
 D ^DDS
"RTN","BPSOSI",47,0)
 I $G(DDSSAVE) Q DA
"RTN","BPSOSI",48,0)
 E  Q 0_U_DA
"RTN","BPSOSI",49,0)
TEST ;
"RTN","BPSOSI",50,0)
 W "NEW^BPSOSI returns ",$$NEW^BPSOSI
"RTN","BPSOSI",51,0)
 W "Outputs:",!
"RTN","BPSOSI",52,0)
 D ZWRITE^BPSOS("DDSCHANG","DDSSAVE","DIMSG","DTOUT")
"RTN","BPSOSI",53,0)
 D GL
"RTN","BPSOSI",54,0)
 Q DA
"RTN","BPSOSI",55,0)
ISEMPTY(DA)        ; true if PRESCRIPTIONS multiple count >0, false if not
"RTN","BPSOSI",56,0)
 Q $P($G(^BPS(9002313.51,DA,2,0)),U,4)>0
"RTN","BPSOSI",57,0)
FN() Q 9002313.51
"RTN","BPSOSI",58,0)
FNPRESC()          Q 9002313.512
"RTN","BPSOSI",59,0)
FNINS() Q 9002313.522
"RTN","BPSOSI",60,0)
NEWREC(NMULT,NINS,ORIGIN) ;EP - from BPSOSIV - a new PEC/MIS INPUT record
"RTN","BPSOSI",61,0)
 ; NMULT = how many multiples to initialize (opt, defaults to 9)
"RTN","BPSOSI",62,0)
 ; NINS = how many insurance lines to init for each one (opt, def to 5)
"RTN","BPSOSI",63,0)
 ; ORIGIN = pointer to 9002313.516
"RTN","BPSOSI",64,0)
 N FDA,IEN,MSG,FN,NEW S FN=$$FN,NEW="+999999,"
"RTN","BPSOSI",65,0)
 N FNPRESC,FNINS S FNPRESC=$$FNPRESC,FNINS=$$FNINS
"RTN","BPSOSI",66,0)
 S FDA(FN,NEW,.01)="NOW"
"RTN","BPSOSI",67,0)
 S FDA(FN,NEW,.03)=$P(^BPS(9002313.516,ORIGIN,0),U)
"RTN","BPSOSI",68,0)
 N I F I=1000:1000:1000*$S($D(NMULT):NMULT,1:9) D
"RTN","BPSOSI",69,0)
 . N X S X="+"_I_","_NEW
"RTN","BPSOSI",70,0)
 . S FDA(FNPRESC,X,.01)=I/1000
"RTN","BPSOSI",71,0)
 . N J F J=1:1:$S($D(NINS):NINS,1:5) D
"RTN","BPSOSI",72,0)
 . . S FDA(FNINS,"+"_(I+J)_","_X,.01)=J
"RTN","BPSOSI",73,0)
 . . ; ex:          +3002,+3000,+999999, for 2nd ins in 3rd presc
"RTN","BPSOSI",74,0)
 N STOP F  D  Q:STOP
"RTN","BPSOSI",75,0)
 . D UPDATE^DIE("E","FDA","IEN","MSG")
"RTN","BPSOSI",76,0)
 . I '$D(MSG),$G(IEN(999999)) S STOP=1 Q
"RTN","BPSOSI",77,0)
 . D ZWRITE^BPSOS("MSG","IEN")
"RTN","BPSOSI",78,0)
 . S STOP='$$IMPOSS^BPSOSUE("FM","TRI","UPDATE^DIE failed",,"NEWREC",$T(+0))
"RTN","BPSOSI",79,0)
 Q IEN(999999)
"RTN","BPSOSI",80,0)
INIT(IEN) ;EP - from BPSOSIV - initialize record IEN
"RTN","BPSOSI",81,0)
 N FDA,MSG,FN S FN=$$FN,IEN=IEN_","
"RTN","BPSOSI",82,0)
 S FDA(FN,IEN,.02)=$G(MOREDATA("USER"))              ; User
"RTN","BPSOSI",83,0)
 S FDA(FN,IEN,3.01)=$G(MOREDATA("RX ACTION"))        ; RX Action (value passed into BPSNCPDP)
"RTN","BPSOSI",84,0)
 S FDA(FN,IEN,3.02)=$G(MOREDATA("DATE OF SERVICE"))  ; DOS (Fill Date passed into BPSNCPDP)
"RTN","BPSOSI",85,0)
 D
"RTN","BPSOSI",86,0)
 . N ARR,I,Y
"RTN","BPSOSI",87,0)
 . D GET515($G(MOREDATA("USER")),.ARR) ; get this user's settings, apply defaults
"RTN","BPSOSI",88,0)
 . S Y=$G(ARR(1)) ; we're interested in the ASK ones in the 1 subscript
"RTN","BPSOSI",89,0)
 . F I=1:1:4 I $P(Y,U,I)="" S $P(Y,U,I)=0 ; defaults for default
"RTN","BPSOSI",90,0)
 . F I=1:1:4 S FDA(FN,IEN,I/100+1)=$P(Y,U,I) ; ASK INS, etc.
"RTN","BPSOSI",91,0)
 . S Y=$G(ARR(100)) ; and in the 100 subscript,
"RTN","BPSOSI",92,0)
 . ; piece 1 - should we default the NDC # - the default default is YES
"RTN","BPSOSI",93,0)
 . ; defaults for the default
"RTN","BPSOSI",94,0)
 . F I=1:1:1 I $P(Y,U,I)="" S $P(Y,U,I)=$S(I=1:1,1:0)
"RTN","BPSOSI",95,0)
 . F I=1:1:1 S FDA(FN,IEN,I/100+100)=$P(Y,U,I)
"RTN","BPSOSI",96,0)
 N STOP F  D  Q:STOP
"RTN","BPSOSI",97,0)
 . D FILE^DIE("","FDA","MSG")
"RTN","BPSOSI",98,0)
 . I '$D(MSG) S STOP=1 Q
"RTN","BPSOSI",99,0)
 . D ZWRITE^BPSOS("MSG")
"RTN","BPSOSI",100,0)
 . S STOP='$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"INIT",$T(+0))
"RTN","BPSOSI",101,0)
 Q '$D(MSG)  ;='0=1 if success, ='nonzero=0 if failure
"RTN","BPSOSI",102,0)
DELALL ; delete all records ; good for testing
"RTN","BPSOSI",103,0)
 N FN S FN=$$FN I FN'=9002313.51 D  Q  ; must be that file
"RTN","BPSOSI",104,0)
 . D IMPOSS^BPSOSUE("P","TI",,,"DELALL",$T(+0))
"RTN","BPSOSI",105,0)
 W !,"Deleting all records from file ",FN
"RTN","BPSOSI",106,0)
 N IEN F  S IEN=$O(^BPS(FN,0)) Q:'IEN  Q:'$$DELETE(IEN)  W "."
"RTN","BPSOSI",107,0)
 W ! D GL
"RTN","BPSOSI",108,0)
 Q
"RTN","BPSOSI",109,0)
GL ; quickie global list good for testing
"RTN","BPSOSI",110,0)
 N FN S FN=$$FN
"RTN","BPSOSI",111,0)
 N X M X=^BPS(FN)
"RTN","BPSOSI",112,0)
 D ZWRITE^BPSOS("X")
"RTN","BPSOSI",113,0)
 Q
"RTN","BPSOSI",114,0)
DELETE(IEN)        ; delete record IEN
"RTN","BPSOSI",115,0)
 N FDA,MSG,FN S FN=$$FN,IEN=IEN_","
"RTN","BPSOSI",116,0)
 S FDA(FN,IEN,.01)="@"
"RTN","BPSOSI",117,0)
 D FILE^DIE("E","FDA","MSG")
"RTN","BPSOSI",118,0)
 I $D(MSG) D ZWRITE^BPSOS("MSG")
"RTN","BPSOSI",119,0)
 I $D(MSG) Q 0
"RTN","BPSOSI",120,0)
 Q 1
"RTN","BPSOSI",121,0)
GENINSTR ; general instructions, in the FORM-level pre-action for Block 2C
"RTN","BPSOSI",122,0)
 N AR
"RTN","BPSOSI",123,0)
 S AR(1)="Use   <PF1> E   to SUBMIT the claims"
"RTN","BPSOSI",124,0)
 S AR(1)=AR(1)_",    <PF1> Q to QUIT and cancel"
"RTN","BPSOSI",125,0)
 D HLP^DDSUTL(.AR)
"RTN","BPSOSI",126,0)
 Q
"RTN","BPSOSI",127,0)
OLDSTYLE()         ; return true if DUZ wants old style input
"RTN","BPSOSI",128,0)
 ; if this user has a specific setting, go with it
"RTN","BPSOSI",129,0)
 N X D GET515(DUZ,.X)
"RTN","BPSOSI",130,0)
 Q $P($G(X(0)),U,3)
"RTN","BPSOSI",131,0)
GET515(USER,DEST) ;EP - from BPSOSIV ; call as GET515(USER,.DESTINATION)
"RTN","BPSOSI",132,0)
 ; where .DESTINATION is undefined coming in.
"RTN","BPSOSI",133,0)
 ; set DEST(*) = copy of the .515 in effect,
"RTN","BPSOSI",134,0)
 ; with defaults overlaid as needed
"RTN","BPSOSI",135,0)
 I $G(USER)="" Q
"RTN","BPSOSI",136,0)
 I $D(DEST) D  Q
"RTN","BPSOSI",137,0)
 . D IMPOSS^BPSOSUE("P","TI",,,"GET515",$T(+0))
"RTN","BPSOSI",138,0)
 D GET515A(USER,.DEST)
"RTN","BPSOSI",139,0)
 I $P($G(DEST(0)),U,2) D  ; if this user inherits from another, 
"RTN","BPSOSI",140,0)
 . N ARR
"RTN","BPSOSI",141,0)
 . D GET515A(USER,.ARR) ; then get that user's settings
"RTN","BPSOSI",142,0)
 . D GET515B(.DEST,.ARR) ; fill in any that need defaults
"RTN","BPSOSI",143,0)
 D
"RTN","BPSOSI",144,0)
 . N ARR
"RTN","BPSOSI",145,0)
 . D GET515A(1,.ARR) ; likewise, inherit from user #1
"RTN","BPSOSI",146,0)
 . D GET515B(.DEST,.ARR)
"RTN","BPSOSI",147,0)
 Q
"RTN","BPSOSI",148,0)
GET515A(USER,DEST) ; grab copy of the record for this user
"RTN","BPSOSI",149,0)
 N IEN S IEN=$O(^BPS(9002313.515,"B",USER,0)) Q:'IEN
"RTN","BPSOSI",150,0)
 M DEST=^BPS(9002313.515,IEN) ; DEST(0), DEST(1), etc. are set now
"RTN","BPSOSI",151,0)
 Q
"RTN","BPSOSI",152,0)
GET515B(A,B)       ; fill in defaults in A as needed, from B
"RTN","BPSOSI",153,0)
 N X,Y,I,S S S=""
"RTN","BPSOSI",154,0)
 F  S S=$O(B(S)) Q:S=""  D
"RTN","BPSOSI",155,0)
 . S X=B(S) F I=1:1:$L(X,U) S Y=$P(X,U,I) I Y]"" D
"RTN","BPSOSI",156,0)
 . . I $P($G(A(S)),U,I)="" S $P(A(S),U,I)=Y ; not def, so fill default
"RTN","BPSOSI",157,0)
 Q
"RTN","BPSOSI1")
0^165^B41148853
"RTN","BPSOSI1",1,0)
BPSOSI1 ;BHAM ISC/FCS/DRS/DLF - support for the prescrip. field on the form ;06/01/2004
"RTN","BPSOSI1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSI1",3,0)
 ;;Reference to ^PSRX( supported by DBIA4302
"RTN","BPSOSI1",4,0)
 Q
"RTN","BPSOSI1",5,0)
ENABASK D THEASKS(0) Q  ; enable the "Ask preauth?" etc. questions  
"RTN","BPSOSI1",6,0)
DISABASK D THEASKS(1) Q  ; disable those questions
"RTN","BPSOSI1",7,0)
THEASKS(N)         ; don't use this directly, the 0/1 meanings are backwards 
"RTN","BPSOSI1",8,0)
 ; from what you would think they mean (0 enables, 1 disables)
"RTN","BPSOSI1",9,0)
 N PAGE,BLOCK S PAGE=1,BLOCK=1
"RTN","BPSOSI1",10,0)
 N F F F=12,14,16,18,20 D
"RTN","BPSOSI1",11,0)
 . D UNED^DDSUTL(F,BLOCK,PAGE,N)
"RTN","BPSOSI1",12,0)
 Q
"RTN","BPSOSI1",13,0)
VALID ; VALID is the Data Validation action for the field.
"RTN","BPSOSI1",14,0)
 ; It may invoke prescription or visit lookup.
"RTN","BPSOSI1",15,0)
 ; It might reset X and DDSEXT. 
"RTN","BPSOSI1",16,0)
 N Z S Z=$$VALIDATE(X)
"RTN","BPSOSI1",17,0)
 S (X,DDSEXT)=Z
"RTN","BPSOSI1",18,0)
 Q
"RTN","BPSOSI1",19,0)
VALIDATE(X)         ;  validate input and return transformed value 
"RTN","BPSOSI1",20,0)
 ; Returns -1 if error and sets DDSERROR
"RTN","BPSOSI1",21,0)
 K DDSERROR
"RTN","BPSOSI1",22,0)
 N TYPE ; = "RX" or "VISIT"
"RTN","BPSOSI1",23,0)
 ;
"RTN","BPSOSI1",24,0)
VAL1 I 0 ; ELSE each possibility:
"RTN","BPSOSI1",25,0)
 E  I X?1N.N1"-"1N.N D  ; ANMC bar code labels
"RTN","BPSOSI1",26,0)
 . S TYPE="RX"
"RTN","BPSOSI1",27,0)
 . S X="`"_$P(X,"-",2)
"RTN","BPSOSI1",28,0)
 . S X=$$RXLOOKUP(X,"NOX")
"RTN","BPSOSI1",29,0)
 . I X<0 S DDSERROR=1
"RTN","BPSOSI1",30,0)
 E  I X?1N.N,$P($G(^BPS(9002313.99,1,"INPUT")),U)=0 D  ; Sitka
"RTN","BPSOSI1",31,0)
 . S TYPE="RX"
"RTN","BPSOSI1",32,0)
 . S X="`"_+X
"RTN","BPSOSI1",33,0)
 . S X=$$RXLOOKUP(X,"NOX")
"RTN","BPSOSI1",34,0)
 . I X<0 S DDSERROR=2
"RTN","BPSOSI1",35,0)
 E  I X?1"`"1N.N D  ; internal RX number input ; 10/26/2000
"RTN","BPSOSI1",36,0)
 . S TYPE="RX",X=$$RXLOOKUP(X,"NOX") I X<0 S DDSERROR=6
"RTN","BPSOSI1",37,0)
VAL2 ;
"RTN","BPSOSI1",38,0)
 E  I X?1N.N0.1A!($$UPPER(X)?1"RX".P1N.N0.1A) D  ;external RX # input
"RTN","BPSOSI1",39,0)
 . S TYPE="RX"
"RTN","BPSOSI1",40,0)
 . I $$UPPER(X)?1"RX".E D
"RTN","BPSOSI1",41,0)
 . . S X=$P(X,"RX",2) F  Q:$E(X)?1N  S X=$E(X,2,$L(X))
"RTN","BPSOSI1",42,0)
 . S X=$$RXLOOKUP(X,"OX")
"RTN","BPSOSI1",43,0)
 . I X<0 S DDSERROR=5
"RTN","BPSOSI1",44,0)
 E  I X="" D  ; null (includes "@")
"RTN","BPSOSI1",45,0)
 . S X="DELETE"
"RTN","BPSOSI1",46,0)
 E  I $$UPPER(X)=$E("FIND",1,$L(X)) D
"RTN","BPSOSI1",47,0)
 . S TYPE="RX" ; might change to VISIT, below
"RTN","BPSOSI1",48,0)
 . ; RESET^DDS is the wrong thing to do here
"RTN","BPSOSI1",49,0)
 . ; try it without this, too  D FULLSCRE
"RTN","BPSOSI1",50,0)
 . W @IOF
"RTN","BPSOSI1",51,0)
 . S X=$$RXFIND^BPSOSIF ; = RXI^RXR if presc,  = VISITIEN if visit
"RTN","BPSOSI1",52,0)
 . D REFRESH^DDSUTL
"RTN","BPSOSI1",53,0)
 . I X<0 S DDSERROR=3 Q
"RTN","BPSOSI1",54,0)
 . I $L(X,U)=1 S TYPE="VISIT"
"RTN","BPSOSI1",55,0)
 E  I X?0.1U1N.N1"."1N.N1U D  ; VCN number
"RTN","BPSOSI1",56,0)
 . S TYPE="VISIT" ; it might change to RX, below
"RTN","BPSOSI1",57,0)
 . W @IOF
"RTN","BPSOSI1",58,0)
 . S X=$$RXFIND^BPSOSIF(,,X) ; 
"RTN","BPSOSI1",59,0)
 . D REFRESH^DDSUTL
"RTN","BPSOSI1",60,0)
 . I 'X S DDSERROR=4,X=-1
"RTN","BPSOSI1",61,0)
 . I $L(X,U)=2 S TYPE="RX"
"RTN","BPSOSI1",62,0)
 E  I $L(X)'<3,$$UPPER(X)=$E("DELETE",1,$L(X)) D
"RTN","BPSOSI1",63,0)
 . S X="DELETE" ; and let EFFECTS do the dirty work later
"RTN","BPSOSI1",64,0)
 E  D  ; if it didn't hit any of the recognized cases:
"RTN","BPSOSI1",65,0)
 . S X=-1,DDSERROR=999
"RTN","BPSOSI1",66,0)
 ; And now deal with the results
"RTN","BPSOSI1",67,0)
 I X>0 D
"RTN","BPSOSI1",68,0)
 . I TYPE="RX" D  ; X=RXI or RXI^RXR
"RTN","BPSOSI1",69,0)
 . . S X="`"_X ; RXR part will be dealt with in EFFECTS
"RTN","BPSOSI1",70,0)
 . E  I TYPE="VISIT" D
"RTN","BPSOSI1",71,0)
 . . S X="V`"_X ; may be changed to VCN in EFFECTS
"RTN","BPSOSI1",72,0)
 E  I X?1"`"1N.N ; nothing needs to be done ; it's `RXI
"RTN","BPSOSI1",73,0)
 E  I X="DELETE" ; okay, nothing to do here ; EFFECTS takes care of it
"RTN","BPSOSI1",74,0)
 E  I X="@" ; okay, EFFECTS takes care of it
"RTN","BPSOSI1",75,0)
 E  I X=-1 D  ; DDSERROR should already be set.
"RTN","BPSOSI1",76,0)
 . D HELP^BPSOSI1
"RTN","BPSOSI1",77,0)
 E  D IMPOSS^BPSOSUE("P","TI","Unexpected case: X="_X,,"VAL2",$T(+0))
"RTN","BPSOSI1",78,0)
 Q X
"RTN","BPSOSI1",79,0)
FULLSCRE ; adapted from FULL^VALM1
"RTN","BPSOSI1",80,0)
 S IOTM=1,IOBM=IOSL W IOSC W @IOSTBM W IORC Q
"RTN","BPSOSI1",81,0)
RXLOOKUP(X,DIC0)         ; lookup by `IEN or prescrip # or patient name or whatever
"RTN","BPSOSI1",82,0)
 N DIC,Y,DUOUT,DTOUT S DIC="^PSRX(",DIC(0)=DIC0
"RTN","BPSOSI1",83,0)
 D ^DIC
"RTN","BPSOSI1",84,0)
 N RET S RET=$S(Y>0:"`"_+Y,1:-1)
"RTN","BPSOSI1",85,0)
 I DIC0["A" D REFRESH^DDSUTL ; put screen back together
"RTN","BPSOSI1",86,0)
 Q RET
"RTN","BPSOSI1",87,0)
HELP ;EP -
"RTN","BPSOSI1",88,0)
 N AR,N S N=0
"RTN","BPSOSI1",89,0)
 D HELP1("Scan the prescription label.")
"RTN","BPSOSI1",90,0)
 D HELP1("Or, you can enter ` followed by the internal number.")
"RTN","BPSOSI1",91,0)
 D HELP1("Or, type F or FIND to lookup by patient name.")
"RTN","BPSOSI1",92,0)
 D HELP1("Or, type the VCN number (non-prescription charges only).")
"RTN","BPSOSI1",93,0)
 I $$GET^DDSVAL(DIE,.DA,.02)]"" D HELP1("Answer with   @    to delete this line.")
"RTN","BPSOSI1",94,0)
 D HLP^DDSUTL(.AR)
"RTN","BPSOSI1",95,0)
 Q
"RTN","BPSOSI1",96,0)
HELP1(X) S N=N+1,AR(N)=X Q
"RTN","BPSOSI1",97,0)
MSGWAIT(X) ;EP - from BPSOSI2,BPSOSI8
"RTN","BPSOSI1",98,0)
 N AR S AR(1)=X
"RTN","BPSOSI1",99,0)
 D HLP^DDSUTL(.AR)
"RTN","BPSOSI1",100,0)
 D HLP^DDSUTL("$$EOP")
"RTN","BPSOSI1",101,0)
 Q
"RTN","BPSOSI1",102,0)
EFFECTS N ERR ; side effects of putting a value in the prescription field
"RTN","BPSOSI1",103,0)
 N RX,NDC,PATNAME,DRUGNAME,FILLDATE
"RTN","BPSOSI1",104,0)
 N RXI,RXR,DRUG,PAT,AWPMED,VISIT,IEN59
"RTN","BPSOSI1",105,0)
 ; NDCDEF - not a field on the form, so this cheap fetch is okay
"RTN","BPSOSI1",106,0)
 N NDCDEF S NDCDEF=$P($G(^BPS(9002313.51,DA(1),100)),U)
"RTN","BPSOSI1",107,0)
 I X?1"`"1N.N!(X?1"`"1N.N1"^"1N.N) D  ; It's a prescription:
"RTN","BPSOSI1",108,0)
 . ; Refill may or may not have been specified (FIND leads to 2nd piece)
"RTN","BPSOSI1",109,0)
 . I $L(X,U)>1 S RXR=$P(X,U,2),X=$P(X,U)
"RTN","BPSOSI1",110,0)
 . E  S RXR=$O(^PSRX($P(X,"`",2),1," "),-1)
"RTN","BPSOSI1",111,0)
 . S RX=X,RXI=$P(X,"`",2) ; display the `internal form
"RTN","BPSOSI1",112,0)
 . N R0 S R0=$G(^PSRX(RXI,0)) I R0="" D IMPOSS^BPSOSUE("DB,P","TI","VALIDATE should have caught this",,"EFFECTS",$T(+0))
"RTN","BPSOSI1",113,0)
 . S PAT=$P(R0,U,2)
"RTN","BPSOSI1",114,0)
 . S PATNAME=$P(^DPT(PAT,0),U)
"RTN","BPSOSI1",115,0)
 . S DRUG=$P(R0,U,6) ; get pointer to drug file ; BPS*1.0T7*11 ; removed "N DRUG", the NEW happened at the calling level and DRUG is needed below
"RTN","BPSOSI1",116,0)
 . I DRUG S DRUGNAME=$P($G(^PSDRUG(DRUG,0)),U) ; get drug name
"RTN","BPSOSI1",117,0)
 . E  S DRUGNAME="?missing from ^PSRX?"
"RTN","BPSOSI1",118,0)
 . S NDC=$$GETNDC^PSONDCUT(RXI,RXR)
"RTN","BPSOSI1",119,0)
 . S FILLDATE=$$RXFLDT^PSOBPSUT(RXI,RXR)
"RTN","BPSOSI1",120,0)
 . S FILLDATE=$$MMMDD(FILLDATE)
"RTN","BPSOSI1",121,0)
 E  I X?1"V`"1N.N D  ; a visit
"RTN","BPSOSI1",122,0)
 . S VISIT=$P(X,"`",2)
"RTN","BPSOSI1",123,0)
 . I RX="" S RX=X ; display the V`VSTDFN form if no VCN defined yet
"RTN","BPSOSI1",124,0)
 . S NDC="" ; no default for charge code
"RTN","BPSOSI1",125,0)
 . S PAT=$P(V0,U,5)
"RTN","BPSOSI1",126,0)
 . S PATNAME=$P(^DPT(PAT,0),U)
"RTN","BPSOSI1",127,0)
 . S DRUGNAME="" ; no charge item yet
"RTN","BPSOSI1",128,0)
 . S (RXI,RXR,AWPMED)="" ; no prescription
"RTN","BPSOSI1",129,0)
 . S FILLDATE=$$MMMDD($P($P(V0,U),"@"))
"RTN","BPSOSI1",130,0)
 E  I X="DELETE" D
"RTN","BPSOSI1",131,0)
 . S (RX,NDC,PATNAME,DRUGNAME,FILLDATE)=""
"RTN","BPSOSI1",132,0)
 D PUT^DDSVAL(DIE,.DA,.02,RX)
"RTN","BPSOSI1",133,0)
 ; if you have a default NDC number, don't store unless field is empty.
"RTN","BPSOSI1",134,0)
 I $$GET^DDSVAL(DIE,.DA,.03)=""!1 D PUT^DDSVAL(DIE,.DA,.03,NDC)
"RTN","BPSOSI1",135,0)
 D PUT^DDSVAL(DIE,.DA,.04,PATNAME)
"RTN","BPSOSI1",136,0)
 D PUT^DDSVAL(DIE,.DA,.05,DRUGNAME)
"RTN","BPSOSI1",137,0)
 D PUT^DDSVAL(DIE,.DA,.06,FILLDATE)
"RTN","BPSOSI1",138,0)
 I X="DELETE" D  Q
"RTN","BPSOSI1",139,0)
 . ; delete all the other fields, too:
"RTN","BPSOSI1",140,0)
 . N F
"RTN","BPSOSI1",141,0)
 . F F=1.01:.01:1.07,2.01,5.01:.01:5.06,6.01:.01:6.03,7.01:.01:7.03 D
"RTN","BPSOSI1",142,0)
 . . D PUT^DDSVAL(DIE,.DA,F,"",,"I")
"RTN","BPSOSI1",143,0)
 . D ERASEALL^BPSOSI8 ; the "I" multiple and page 8 details
"RTN","BPSOSI1",144,0)
 . S DDSBR="RX DISP" ; and go back to the RX field
"RTN","BPSOSI1",145,0)
 ; For others (not the DELETE case):
"RTN","BPSOSI1",146,0)
 D PUT^DDSVAL(DIE,.DA,1.01,$G(RXI),,"I")
"RTN","BPSOSI1",147,0)
 D PUT^DDSVAL(DIE,.DA,1.02,$G(RXR),,"I")
"RTN","BPSOSI1",148,0)
 D PUT^DDSVAL(DIE,.DA,1.03,$G(DRUG),,"I")
"RTN","BPSOSI1",149,0)
 D PUT^DDSVAL(DIE,.DA,1.04,$G(PAT),,"I")
"RTN","BPSOSI1",150,0)
 D PUT^DDSVAL(DIE,.DA,1.05,$G(AWPMED),,"I")
"RTN","BPSOSI1",151,0)
 D PUT^DDSVAL(DIE,.DA,1.06,$G(VISIT),,"I")
"RTN","BPSOSI1",152,0)
 D PUT^DDSVAL(DIE,.DA,1.07,$G(IEN59),,"I")
"RTN","BPSOSI1",153,0)
 Q
"RTN","BPSOSI1",154,0)
MMMDD(Y) ;EP
"RTN","BPSOSI1",155,0)
 X ^DD("DD") Q $P(Y,",")
"RTN","BPSOSI1",156,0)
UPPER(X) Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSOSI7")
0^167^B6551772
"RTN","BPSOSI7",1,0)
BPSOSI7 ;BHAM ISC/FCS/DRS/DLF - utilities to go with Page 7 ;06/01/2004
"RTN","BPSOSI7",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSI7",3,0)
 ;----------------------------------------------------------
"RTN","BPSOSI7",4,0)
 ;IHS/SD/lwj 8/29/02  NCPDP 5.1 changes
"RTN","BPSOSI7",5,0)
 ; new field added to the insurance/prior authorization screen
"RTN","BPSOSI7",6,0)
 ; to capture the Prior Authorization Type Code.  Changed
"RTN","BPSOSI7",7,0)
 ; ENAB subroutine to enable and disable this field.  The 
"RTN","BPSOSI7",8,0)
 ; field will be enabled when the preauthorization code is 
"RTN","BPSOSI7",9,0)
 ; enabled, and disabled when the preauth is disable.
"RTN","BPSOSI7",10,0)
 ; The only time the value of this field will be recorded in 
"RTN","BPSOSI7",11,0)
 ; the claim is when the format for the claims is 5.1.
"RTN","BPSOSI7",12,0)
 ;----------------------------------------------------------
"RTN","BPSOSI7",13,0)
 Q
"RTN","BPSOSI7",14,0)
DOPAGE() ;EP - should we do page 7? Only if one or more of the ques. are enabled
"RTN","BPSOSI7",15,0)
 ; this is used by the BRANCH logic of the NDC/CPT/HCPCS field
"RTN","BPSOSI7",16,0)
 ; to figure whether to set DDSSTACK="THE ASKS"
"RTN","BPSOSI7",17,0)
 ; Actual enabling is done by ENAB
"RTN","BPSOSI7",18,0)
 N DOIT
"RTN","BPSOSI7",19,0)
 I $$DOFIELD(1.01) S DOIT=1 ; insurance
"RTN","BPSOSI7",20,0)
 E  I $$DOFIELD(1.02) S DOIT=1 ; preauth
"RTN","BPSOSI7",21,0)
 E  I $$DOFIELD(1.03) S DOIT=1 ; pricing
"RTN","BPSOSI7",22,0)
 E  S DOIT=0
"RTN","BPSOSI7",23,0)
 Q DOIT
"RTN","BPSOSI7",24,0)
ISCPT() ; non-prescription, CPT code - detected by absence of RXI
"RTN","BPSOSI7",25,0)
 Q $$GET^DDSVAL(DIE,.DA,1.01)=""
"RTN","BPSOSI7",26,0)
DOFIELD(N) ;EP - context: form, page 1, block BPS PAGE 1 BOTTOM 
"RTN","BPSOSI7",27,0)
 ; DIE = "^BPS(9002313.51,DA(1),2,DA,"
"RTN","BPSOSI7",28,0)
 ; DA(1), DA point to the line item.
"RTN","BPSOSI7",29,0)
 ; But we're looking at the yes/no's at ^BPS(9002313.51,DA(1),*)
"RTN","BPSOSI7",30,0)
 N RET S RET=$$GET^DDSVAL(9002313.51,DA(1),N)
"RTN","BPSOSI7",31,0)
 ; For insurance, you have to have had lines set up for insurance, too
"RTN","BPSOSI7",32,0)
 I N=1.01,RET S RET=RET&$D(^BPS(9002313.51,DA(1),2,DA,"I",1))
"RTN","BPSOSI7",33,0)
 ; for pricing, this can't be POSTAGE (it's done on Page 11, not 7)
"RTN","BPSOSI7",34,0)
 I N=1.03 D
"RTN","BPSOSI7",35,0)
 . ; Do not ask pricing for POSTAGE; it has its own pricing page
"RTN","BPSOSI7",36,0)
 . I $$GET^DDSVAL(DIE,.DA,.03)="POSTAGE" S RET=0 Q
"RTN","BPSOSI7",37,0)
 . ; Do ask pricing for CPT codes (detected by absence of RXI)
"RTN","BPSOSI7",38,0)
 . I $$ISCPT S RET=1 Q
"RTN","BPSOSI7",39,0)
 Q RET
"RTN","BPSOSI7",40,0)
ENAB ; enable/disable blocks,fields based on settings in fields 1.01 ff
"RTN","BPSOSI7",41,0)
 ; done on entry to page 7
"RTN","BPSOSI7",42,0)
 D ENAB1(1.01,4,1) ; insurance
"RTN","BPSOSI7",43,0)
 ;
"RTN","BPSOSI7",44,0)
 ;IHS/SD/lwj 8/30/02 NCPDP 5.1 changes
"RTN","BPSOSI7",45,0)
 ; A new field for the prior auth type code was needed- to have
"RTN","BPSOSI7",46,0)
 ; the screen flow, the new field, and the existing preauthorization
"RTN","BPSOSI7",47,0)
 ; field were reversed - field 1 is now the type, and field 2 is the
"RTN","BPSOSI7",48,0)
 ; prior auth number (formally preauthorization)
"RTN","BPSOSI7",49,0)
 D ENAB1(1.02,1,2)  ;IHS/SD/lwj 8/30/02 now the prior auth type
"RTN","BPSOSI7",50,0)
 ;
"RTN","BPSOSI7",51,0)
 D ENAB1(1.02,2,2)  ;IHS/SD/lwj 8/30/02 this is the prior auth number 
"RTN","BPSOSI7",52,0)
 ;
"RTN","BPSOSI7",53,0)
 N F F F=11,12,14 D ENAB1(1.03,F,3) ; qty, unit price, dispense fee
"RTN","BPSOSI7",54,0)
 ; set up some pricing defaults if nothing is set up yet
"RTN","BPSOSI7",55,0)
 I $$DOFIELD(1.03),$$GET^DDSVAL(DIE,.DA,5.02)="" D PAGE7^BPSOSQP
"RTN","BPSOSI7",56,0)
 ; set up some insurance defaults if nothing is set up yet
"RTN","BPSOSI7",57,0)
 I $$DOFIELD(1.01),$$GET^DDSVAL(DIE,.DA,7.01)="" D INIT^BPSOSI8
"RTN","BPSOSI7",58,0)
 Q
"RTN","BPSOSI7",59,0)
ENAB1(ORIG,FIELD,BLOCK,PAGE)         ;EP
"RTN","BPSOSI7",60,0)
 I '$G(PAGE) S PAGE=7
"RTN","BPSOSI7",61,0)
 D UNED^DDSUTL(FIELD,BLOCK,PAGE,'$$DOFIELD(ORIG))
"RTN","BPSOSI7",62,0)
 Q
"RTN","BPSOSI7",63,0)
RECALC1 ;EP - from BPSOSI2,BPSOSQP 
"RTN","BPSOSI7",64,0)
 ; when you change quantity or unit price
"RTN","BPSOSI7",65,0)
 N X S X=$$GET^DDSVAL(DIE,.DA,5.01)
"RTN","BPSOSI7",66,0)
 N Y S Y=$$GET^DDSVAL(DIE,.DA,5.02)
"RTN","BPSOSI7",67,0)
 N Z S Z=X*Y
"RTN","BPSOSI7",68,0)
 S Z=$$ROUND(Z)
"RTN","BPSOSI7",69,0)
 D PUT^DDSVAL(DIE,.DA,5.03,$J(Z,0,2))
"RTN","BPSOSI7",70,0)
 D RECALC2 ; and then that affects the total price
"RTN","BPSOSI7",71,0)
 Q
"RTN","BPSOSI7",72,0)
RECALC2 ; when you change dispense fee
"RTN","BPSOSI7",73,0)
 N X S X=$$GET^DDSVAL(DIE,.DA,5.03)
"RTN","BPSOSI7",74,0)
 N Y S Y=$$GET^DDSVAL(DIE,.DA,5.04)
"RTN","BPSOSI7",75,0)
 N Z S Z=X+Y
"RTN","BPSOSI7",76,0)
 S Z=$$ROUND(Z)
"RTN","BPSOSI7",77,0)
 D PUT^DDSVAL(DIE,.DA,5.05,$J(Z,0,2))
"RTN","BPSOSI7",78,0)
 Q
"RTN","BPSOSI7",79,0)
ROUND(X) Q X*100+.5\1/100
"RTN","BPSOSI8")
0^168^B38198538
"RTN","BPSOSI8",1,0)
BPSOSI8 ;BHAM ISC/FCS/DRS/DLF - insurance selection - page 8 ;06/14/2004
"RTN","BPSOSI8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSI8",3,0)
 Q
"RTN","BPSOSI8",4,0)
FN() Q 9002313.522
"RTN","BPSOSI8",5,0)
INIT ;EP - from BPSOSI7
"RTN","BPSOSI8",6,0)
 ;This initializes the page 8 data.
"RTN","BPSOSI8",7,0)
 ; It's called as the entry action for page 8.
"RTN","BPSOSI8",8,0)
 ;
"RTN","BPSOSI8",9,0)
 ; We have DIE, DA(1) and DA, which point us into
"RTN","BPSOSI8",10,0)
 ;    ^BPS(9002313.51,DA(1),2,DA,*)
"RTN","BPSOSI8",11,0)
 ; We want to initialize the insurance data in
"RTN","BPSOSI8",12,0)
 ;    ^BPS(9002313.51,DA(1),2,DA,"I",*)
"RTN","BPSOSI8",13,0)
 ;
"RTN","BPSOSI8",14,0)
 ; All the line items are already created, before we entered the form,
"RTN","BPSOSI8",15,0)
 ; and there's a fixed number of them.  Unpleasant, but true. 
"RTN","BPSOSI8",16,0)
 ; We tried various kludgey ways to call UPDATE^DIE and create a
"RTN","BPSOSI8",17,0)
 ; variable-length list at the time the page was loaded, but it
"RTN","BPSOSI8",18,0)
 ; had various problems and we gave up.  Hopefully, there are enough
"RTN","BPSOSI8",19,0)
 ; line items to hold everything that's needed.   If there aren't,
"RTN","BPSOSI8",20,0)
 ; let's try to always make SELF PAY the last one, always leaving
"RTN","BPSOSI8",21,0)
 ; room for SELF PAY.
"RTN","BPSOSI8",22,0)
 ;
"RTN","BPSOSI8",23,0)
 ; We always refresh with newest stuff from a call to BPSOS25.
"RTN","BPSOSI8",24,0)
 ; But if we had an existing order, we will impose that order on
"RTN","BPSOSI8",25,0)
 ; the BPSOS25 results.
"RTN","BPSOSI8",26,0)
 ;
"RTN","BPSOSI8",27,0)
 ;
"RTN","BPSOSI8",28,0)
 ; How many entries are there?  We can look at the global because
"RTN","BPSOSI8",29,0)
 ; the size is, regrettably, fixed.
"RTN","BPSOSI8",30,0)
 N NINS S NINS=$P(^BPS(9002313.51,DA(1),2,DA,"I",0),U,4)
"RTN","BPSOSI8",31,0)
 ;
"RTN","BPSOSI8",32,0)
 ; What is the current order? (For efficient assignment later).
"RTN","BPSOSI8",33,0)
 N ORDER D
"RTN","BPSOSI8",34,0)
 . N I F I=1,2,3 D
"RTN","BPSOSI8",35,0)
 . . N X S X=$$GET^DDSVAL(DIE,.DA,"6.0"_I)
"RTN","BPSOSI8",36,0)
 . . I X]"" S ORDER(X)=I
"RTN","BPSOSI8",37,0)
 ; First, call BPSOS25, giving ARRAY
"RTN","BPSOSI8",38,0)
1 N ARRAY D AVAIL() ; what insurance choices are available, per A/R?
"RTN","BPSOSI8",39,0)
 ; Fill in defaults for any 6.01,7.01,...,6.03,7.03 that are empty
"RTN","BPSOSI8",40,0)
 D  ; fill in any missing orders
"RTN","BPSOSI8",41,0)
 . N I S I=0 ; source pointer
"RTN","BPSOSI8",42,0)
 . N J,K S K=0 F J=1:1:3 I $$GET^DDSVAL(DIE,.DA,J/100+6)=""  S K=J Q
"RTN","BPSOSI8",43,0)
 . I 'K Q  ; all three slots already in use
"RTN","BPSOSI8",44,0)
 . ; J = first slot available
"RTN","BPSOSI8",45,0)
 . N STOP S STOP=0
"RTN","BPSOSI8",46,0)
 . F  D  Q:STOP
"RTN","BPSOSI8",47,0)
 . . S I=I+1 I I>ARRAY(0) S STOP=1 Q  ; exhausted the ARRAY()
"RTN","BPSOSI8",48,0)
 . . N PINS S PINS=$P(ARRAY(I),U,2) ; is this entry already in top 3?
"RTN","BPSOSI8",49,0)
 . . I $D(ORDER(PINS)) Q  ; yes, already in top 3
"RTN","BPSOSI8",50,0)
 . . D PUT^DDSVAL(DIE,.DA,J/100+6,PINS) ; not in top 3 yet, assign it
"RTN","BPSOSI8",51,0)
 . . D PUT^DDSVAL(DIE,.DA,J/100+7,$P(ARRAY(I),U),,"I") ; store corr. INSIEN
"RTN","BPSOSI8",52,0)
 . . S ORDER(PINS)=J
"RTN","BPSOSI8",53,0)
 . . I J=3 S STOP=1 Q
"RTN","BPSOSI8",54,0)
 . . S J=J+1 ; advance to next 
"RTN","BPSOSI8",55,0)
2 ; Do not delete old entries - we're not allowed to delete existing
"RTN","BPSOSI8",56,0)
 ; entries with PUT^DDSVAL, and we surely shouldn't KILL them off.
"RTN","BPSOSI8",57,0)
 I 0 D
"RTN","BPSOSI8",58,0)
 . N X S X="" N S S S="" F  S S=$O(ORDER(S)) Q:S=""  D
"RTN","BPSOSI8",59,0)
 . . S X=X_"ORDER("_S_")="_ORDER(S)_"; "
"RTN","BPSOSI8",60,0)
 . D MSGWAIT^BPSOSI1(X)
"RTN","BPSOSI8",61,0)
3 D STOREARR() ; set up the database
"RTN","BPSOSI8",62,0)
 Q
"RTN","BPSOSI8",63,0)
MSGWAIT(X)         D MSGWAIT^BPSOSI1(X) Q
"RTN","BPSOSI8",64,0)
AVAIL() ;Use BPSOS25 to get the very latest insurance information.
"RTN","BPSOSI8",65,0)
 ; 
"RTN","BPSOSI8",66,0)
 K ARRAY ; fills ARRAY(*)
"RTN","BPSOSI8",67,0)
 D  ; set up parameters and make the call to BPSOS25
"RTN","BPSOSI8",68,0)
 . N FRESH S FRESH=1 ; without regard to previous visits
"RTN","BPSOSI8",69,0)
 . N ABSBRXI S ABSBRXI=$$GET^DDSVAL(DIE,.DA,1.01)
"RTN","BPSOSI8",70,0)
 . N ABSBRXR S ABSBRXR=$$GET^DDSVAL(DIE,.DA,1.02)
"RTN","BPSOSI8",71,0)
 . N ABSBPATI S ABSBPATI=$$GET^DDSVAL(DIE,.DA,1.04)
"RTN","BPSOSI8",72,0)
 . N ABSBVISI S ABSBVISI=$$GET^DDSVAL(DIE,.DA,1.06)
"RTN","BPSOSI8",73,0)
 . N RETVAL S RETVAL=$$INSURER^BPSOS25(.ARRAY,FRESH,NINS)
"RTN","BPSOSI8",74,0)
 ; ARRAY(0)=count and then some other stuff
"RTN","BPSOSI8",75,0)
 ; ARRAY(n)=insurer IEN ^ PINS
"RTN","BPSOSI8",76,0)
 QUIT
"RTN","BPSOSI8",77,0)
STOREARR() ; setup entries in database and on form, based on ARRAY(*)
"RTN","BPSOSI8",78,0)
 N ENTRY F ENTRY=1:1:$P(ARRAY(0),U) D SETUP1
"RTN","BPSOSI8",79,0)
 Q
"RTN","BPSOSI8",80,0)
SETUP1 ; for ARRAY(ENTRY)
"RTN","BPSOSI8",81,0)
 N RETVAL
"RTN","BPSOSI8",82,0)
 N INSIEN,PINS S INSIEN=$P(ARRAY(ENTRY),U),PINS=$P(ARRAY(ENTRY),U,2)
"RTN","BPSOSI8",83,0)
 N RECNUM S RECNUM=$$FIND(PINS) ; find the PINS record
"RTN","BPSOSI8",84,0)
 I 'RECNUM D
"RTN","BPSOSI8",85,0)
 . S RECNUM=$$NEW ; if not found, assign a new one and set it up
"RTN","BPSOSI8",86,0)
 E  S RETVAL=$$STORE(RECNUM,PINS,INSIEN)
"RTN","BPSOSI8",87,0)
 Q
"RTN","BPSOSI8",88,0)
FIND(PINS) ; given DA(1),DA - does it exist?
"RTN","BPSOSI8",89,0)
 ; return record number, or false if not found
"RTN","BPSOSI8",90,0)
 N RET,STOP,FN S (RET,STOP)=0,FN=$$FN
"RTN","BPSOSI8",91,0)
 S DA(2)=DA(1),DA(1)=DA
"RTN","BPSOSI8",92,0)
 N RECNUM F RECNUM=1:1:NINS D  Q:STOP
"RTN","BPSOSI8",93,0)
 . N ERR
"RTN","BPSOSI8",94,0)
 . S DA=RECNUM
"RTN","BPSOSI8",95,0)
 . I $$GET^DDSVAL(FN,.DA,.04)=PINS S (RET,STOP)=DA ; found
"RTN","BPSOSI8",96,0)
 S DA=DA(1),DA(1)=DA(2) K DA(2) ; restore state of DA
"RTN","BPSOSI8",97,0)
 Q RET
"RTN","BPSOSI8",98,0)
NEW() ; given DA(1),DA,PINS,INSIEN - init a new record
"RTN","BPSOSI8",99,0)
 N RECNUM S RECNUM=$$FIND("") ; first one with a null PINS
"RTN","BPSOSI8",100,0)
 N RETVAL
"RTN","BPSOSI8",101,0)
 I RECNUM="" Q 0 ; none available
"RTN","BPSOSI8",102,0)
 S RETVAL=$$STORE(RECNUM,PINS,INSIEN)
"RTN","BPSOSI8",103,0)
 Q RECNUM
"RTN","BPSOSI8",104,0)
STORE(RECNUM,PINS,INSURER)   ;
"RTN","BPSOSI8",105,0)
 S DA(2)=DA(1),DA(1)=DA,DA=RECNUM ; set up DA for this level
"RTN","BPSOSI8",106,0)
 N FN S FN=$$FN
"RTN","BPSOSI8",107,0)
 D PUT^DDSVAL(FN,.DA,.02,$G(ORDER(PINS))) ;
"RTN","BPSOSI8",108,0)
 D PUT^DDSVAL(FN,.DA,.03,INSURER,,"I")
"RTN","BPSOSI8",109,0)
 D PUT^DDSVAL(FN,.DA,.04,PINS)
"RTN","BPSOSI8",110,0)
 S DA=DA(1),DA(1)=DA(2) K DA(2) ; restore state of DA
"RTN","BPSOSI8",111,0)
 Q RECNUM
"RTN","BPSOSI8",112,0)
ERASEALL ;EP - from BPSOSI1
"RTN","BPSOSI8",113,0)
 ;erase all data in the "I" multiple
"RTN","BPSOSI8",114,0)
 ; given DA(1)=entry number in 9002313.51
"RTN","BPSOSI8",115,0)
 ;       DA = line number in LINE ITEMS multiple
"RTN","BPSOSI8",116,0)
 ; Refer to the global only for figuring how many of these there are
"RTN","BPSOSI8",117,0)
 ; This is needed because if someone DELETEs a prescription line,
"RTN","BPSOSI8",118,0)
 ; we have to erase all the data associated with that line.  This is
"RTN","BPSOSI8",119,0)
 ; called from BPSOSI1, where the DELETE is handled.
"RTN","BPSOSI8",120,0)
 I $O(DA(1)) D IMPOSS^BPSOSUE("P","TI","At wrong data level in form",,"ERASEALL",$T(+0)) Q  ; make sure you're really at this level DA(1) not DA(2)
"RTN","BPSOSI8",121,0)
 S DA(2)=DA(1),DA(1)=DA,DA=0
"RTN","BPSOSI8",122,0)
 N FN S FN=$$FN
"RTN","BPSOSI8",123,0)
 F  S DA=$O(^BPS(9002313.51,DA(2),2,DA(1),"I",DA)) Q:'DA  D
"RTN","BPSOSI8",124,0)
 . Q:'$$GET^DDSVAL(FN,.DA,.03)  ; no insurer on this line
"RTN","BPSOSI8",125,0)
 . N F F F=.02,.03,.04,1.01 D
"RTN","BPSOSI8",126,0)
 . . D PUT^DDSVAL(FN,.DA,F,"",,"I")
"RTN","BPSOSI8",127,0)
 S DA=DA(1),DA(1)=DA(2) K DA(2) ; restore the DA array
"RTN","BPSOSI8",128,0)
 Q
"RTN","BPSOSI8",129,0)
POST02 ; POST ACTION ON CHANGE for ORDER, field .02
"RTN","BPSOSI8",130,0)
 ; DA=which insurer line  DA(1)=which prescription line  DA(2)=IEN
"RTN","BPSOSI8",131,0)
 ; X=new internal value, DDSOLD = previous internal value
"RTN","BPSOSI8",132,0)
 ; This has side effects:
"RTN","BPSOSI8",133,0)
 ;     Example:  assign order #2 to some item
"RTN","BPSOSI8",134,0)
 N THISDA S THISDA=DA
"RTN","BPSOSI8",135,0)
 F DA=1:1 Q:'$D(^BPS(9002313.51,DA(2),2,DA(1),"I",DA))  D
"RTN","BPSOSI8",136,0)
 . Q:DA=THISDA  ; but skip the one you're changing right now
"RTN","BPSOSI8",137,0)
 . ; For each field, get its current order
"RTN","BPSOSI8",138,0)
 . N THISORD S THISORD=$$GET^DDSVAL(DIE,.DA,.02,,"I")
"RTN","BPSOSI8",139,0)
 . ;
"RTN","BPSOSI8",140,0)
 . ; DDSOLD=""   example:  pick one unassigned and make it #2
"RTN","BPSOSI8",141,0)
 . ; then #3 disappears and old #2 becomes #3
"RTN","BPSOSI8",142,0)
 . I DDSOLD="" D
"RTN","BPSOSI8",143,0)
 . . I THISORD="" ;do nothing, it remains blank
"RTN","BPSOSI8",144,0)
 . . E  I THISORD=3 D
"RTN","BPSOSI8",145,0)
 . . . D PUT^DDSVAL(DIE,.DA,.02,"",,"I")
"RTN","BPSOSI8",146,0)
 . . E  I THISORD'<X D
"RTN","BPSOSI8",147,0)
 . . . D PUT^DDSVAL(DIE,.DA,.02,THISORD+1,,"I")
"RTN","BPSOSI8",148,0)
 . . . D SET70X(THISORD+1) ; BPS*1.0T7*8
"RTN","BPSOSI8",149,0)
 . ;
"RTN","BPSOSI8",150,0)
 . ; X>DDSOLD  example:  change 2nd to be 3rd ; X=3,DDSOLD=2
"RTN","BPSOSI8",151,0)
 . E  I X>DDSOLD D  ; so 3rd moves up to 2nd (1st unaffected)
"RTN","BPSOSI8",152,0)
 . . I THISORD="" Q  ; unassigned ones unaffected
"RTN","BPSOSI8",153,0)
 . . I THISORD>DDSOLD,THISORD'>X D
"RTN","BPSOSI8",154,0)
 . . . D PUT^DDSVAL(DIE,.DA,.02,THISORD-1,,"I")
"RTN","BPSOSI8",155,0)
 . . . D SET70X(THISORD-1) ; BPS*1.0T7*8
"RTN","BPSOSI8",156,0)
 . ;
"RTN","BPSOSI8",157,0)
 . ; X<DDSOLD  example:  change 2nd to be 1st ; X=1,DDSOLD=2
"RTN","BPSOSI8",158,0)
 . E  I X<DDSOLD D  ; so 1st drops to 2nd and 3rd is unaffected
"RTN","BPSOSI8",159,0)
 . . I THISORD="" Q  ; unassigned ones unaffected
"RTN","BPSOSI8",160,0)
 . . I THISORD<DDSOLD,THISORD'<X D
"RTN","BPSOSI8",161,0)
 . . . D PUT^DDSVAL(DIE,.DA,.02,THISORD+1,,"I")
"RTN","BPSOSI8",162,0)
 . . . D SET70X(THISORD+1) ; BPS*1.0T7*8
"RTN","BPSOSI8",163,0)
 S DA=THISDA ; restore original value!
"RTN","BPSOSI8",164,0)
 Q
"RTN","BPSOSI8",165,0)
SET70X(ORDER) ; update 9002313.512 fields 7.01, 7.02, 7.03 ; BPS*1.0T7*8
"RTN","BPSOSI8",166,0)
 ; ORDER = 1, 2, 3
"RTN","BPSOSI8",167,0)
 N INS,SAVEDA,FN
"RTN","BPSOSI8",168,0)
 S INS=$$GET^DDSVAL(DIE,.DA,.03,"I") ; insurer IEN
"RTN","BPSOSI8",169,0)
 S FN=9002313.512 ; the LINE ITEMS multiple
"RTN","BPSOSI8",170,0)
 M SAVEDA=DA K DA S DA=SAVEDA(1),DA(1)=SAVEDA(2)
"RTN","BPSOSI8",171,0)
 D PUT^DDSVAL(FN,.DA,"7.0"_ORDER,INS,,"I")
"RTN","BPSOSI8",172,0)
 K DA M DA=SAVEDA ; restore original DA
"RTN","BPSOSI8",173,0)
 Q
"RTN","BPSOSIB")
1^169
"RTN","BPSOSIF")
0^171^B32968333
"RTN","BPSOSIF",1,0)
BPSOSIF ;BHAM ISC/FCS/DRS/DLF - handle FIND command ;06/01/2004
"RTN","BPSOSIF",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSIF",3,0)
 ; "FIND" - when typed at Prescription field, here's what happens
"RTN","BPSOSIF",4,0)
 Q
"RTN","BPSOSIF",5,0)
TEST N RETVAL S RETVAL=$$RXFIND()
"RTN","BPSOSIF",6,0)
 W ! D ZWRITE^BPSOS("RETVAL")
"RTN","BPSOSIF",7,0)
 Q
"RTN","BPSOSIF",8,0)
RXFIND(PAT,TYPE,VISITIN) ;EP - from BPSOSI1
"RTN","BPSOSIF",9,0)
 ;lookup prescription - return RXI^RXR
"RTN","BPSOSIF",10,0)
 ; If you don't send the patient or the visitIEN, a lookup is done. 
"RTN","BPSOSIF",11,0)
 ; TYPE = 1 looking for a prescription - return RXI^RXR
"RTN","BPSOSIF",12,0)
 ; TYPE = 2 looking for a visit - return VISITIEN
"RTN","BPSOSIF",13,0)
 ; TYPE = 3 (default)  don't know which; ask.
"RTN","BPSOSIF",14,0)
 ;     Which one is returned?  $L(returned value,U)=1 or 2 tells you
"RTN","BPSOSIF",15,0)
 ; Returns False if no selection made.
"RTN","BPSOSIF",16,0)
 ;
"RTN","BPSOSIF",17,0)
 ; We lookup the patient first, then the visit, and
"RTN","BPSOSIF",18,0)
 ; then the prescription based on the visit
"RTN","BPSOSIF",19,0)
 ;
"RTN","BPSOSIF",20,0)
 N PATNAME,SEL,VISITIEN,TTYPE
"RTN","BPSOSIF",21,0)
 N DDS ; they have ScreenMan hooks in ^DIR - they are poison to this
"RTN","BPSOSIF",22,0)
 ;       BPSOSIF program!  NEW safely disables them for now.
"RTN","BPSOSIF",23,0)
 ; all NEWs above this line ^^^   because there are GOTOs below
"RTN","BPSOSIF",24,0)
RXFINDA I $D(VISITIN) S VISITIEN=VISITIN
"RTN","BPSOSIF",25,0)
 E  S VISITIEN=0
"RTN","BPSOSIF",26,0)
 I '$G(PAT) S PAT=$$PATFIND I 'PAT G RXFINDX
"RTN","BPSOSIF",27,0)
 I '$D(TYPE) S TYPE=3
"RTN","BPSOSIF",28,0)
 S PATNAME=$P(^DPT(PAT,0),U)
"RTN","BPSOSIF",29,0)
 ;
"RTN","BPSOSIF",30,0)
 I 'VISITIEN D
"RTN","BPSOSIF",31,0)
 . W !,"...Searching for visits and prescriptions for "_PATNAME_" ...",!
"RTN","BPSOSIF",32,0)
RXFINDC S SEL=$$VISIFIND(PAT,TYPE,VISITIEN) I 'SEL K PAT G RXFINDA
"RTN","BPSOSIF",33,0)
 ; Side effect - we still have ^TMP($J,"LIST",SEL,"X")=count of prescs
"RTN","BPSOSIF",34,0)
 S VISITIEN=^TMP($J,"LIST",SEL,"I")
"RTN","BPSOSIF",35,0)
 ;
"RTN","BPSOSIF",36,0)
 ; Are you looking for a visit or for a prescription?
"RTN","BPSOSIF",37,0)
 I TYPE=1 G RXFINDK
"RTN","BPSOSIF",38,0)
 I TYPE=2 Q VISITIEN ; looking for a visit - you've got it - done
"RTN","BPSOSIF",39,0)
 ; But if there are no prescriptions with this visit, and they saw
"RTN","BPSOSIF",40,0)
 ; the list, then just take the visit and don't ask.
"RTN","BPSOSIF",41,0)
 I '$G(VISITIN),'^TMP($J,"LIST",SEL,"X") Q VISITIEN
"RTN","BPSOSIF",42,0)
 S TTYPE=$$TTYPE
"RTN","BPSOSIF",43,0)
 I 'TTYPE K PAT G RXFINDA
"RTN","BPSOSIF",44,0)
 I TTYPE=1 G RXFINDK
"RTN","BPSOSIF",45,0)
 I TTYPE=2 Q VISITIEN
"RTN","BPSOSIF",46,0)
 D IMPOSS^BPSOSUE("P","TI","Bad TTYPE="_TTYPE,,"RXFINDC",$T(+0))
"RTN","BPSOSIF",47,0)
 ;
"RTN","BPSOSIF",48,0)
RXFINDK ; If there was only one prescription with the visit, that's the one
"RTN","BPSOSIF",49,0)
 ; we take - the drug name and date was shown, we know that's the one
"RTN","BPSOSIF",50,0)
 ;
"RTN","BPSOSIF",51,0)
 I ^TMP($J,"LIST",SEL,"X")=1 D  Q X
"RTN","BPSOSIF",52,0)
 . N RXI S RXI=$O(^TMP($J,"LIST",SEL,"X",""))
"RTN","BPSOSIF",53,0)
 . N RXR S RXR=$O(^TMP($J,"LIST",SEL,"X",RXI,""))
"RTN","BPSOSIF",54,0)
 . S X=RXI_U_RXR
"RTN","BPSOSIF",55,0)
 ;
"RTN","BPSOSIF",56,0)
 I ^TMP($J,"LIST",SEL,"X")=0 D  G RXFINDC
"RTN","BPSOSIF",57,0)
 . W !,"This visit has no prescriptions!   Try again..." H 2 W !
"RTN","BPSOSIF",58,0)
 ;
"RTN","BPSOSIF",59,0)
 S SEL=$$WHICHRX(SEL) I 'SEL G RXFINDC
"RTN","BPSOSIF",60,0)
 Q ^TMP($J,"LIST",SEL,"I") ; RXI^RXR
"RTN","BPSOSIF",61,0)
RXFINDX ; removed call ; BPS*1.0T7*8 ; D REFRESH^DDSUTL
"RTN","BPSOSIF",62,0)
 Q -1
"RTN","BPSOSIF",63,0)
TTYPE() ; so what are you looking for?
"RTN","BPSOSIF",64,0)
 N PROMPT,DEFAULT,OPT,DISPLAY,CHOICES,TIMEOUT,ANS
"RTN","BPSOSIF",65,0)
 S PROMPT="What kind of charge is this for? "
"RTN","BPSOSIF",66,0)
 S DEFAULT="P",OPT=1,DISPLAY="V"
"RTN","BPSOSIF",67,0)
 S CHOICES="P:Prescription;N:Non-prescription item"
"RTN","BPSOSIF",68,0)
 S TIMEOUT=$S($G(DTOUT):DTOUT,1:300)
"RTN","BPSOSIF",69,0)
 S ANS=$$SET^BPSOSU3(PROMPT,DEFAULT,OPT,DISPLAY,CHOICES,TIMEOUT)
"RTN","BPSOSIF",70,0)
 Q $S(ANS="P":1,ANS="N":2,1:"")
"RTN","BPSOSIF",71,0)
WHICHRX(SEL)          ; given ^TMP($J,"LIST" and  SEL from visit selection,
"RTN","BPSOSIF",72,0)
 ; present another list to select which prescription
"RTN","BPSOSIF",73,0)
 N TMP M TMP=^TMP($J,"LIST",SEL,"X") ; TMP=count, TMP(RXI,RXR)=""
"RTN","BPSOSIF",74,0)
 N VISIDESC S VISIDESC=^TMP($J,"LIST",SEL,"E")
"RTN","BPSOSIF",75,0)
 K ^TMP($J,"LIST") S ^TMP($J,"LIST",0)=0
"RTN","BPSOSIF",76,0)
 N TYPE S TYPE="S"
"RTN","BPSOSIF",77,0)
 N LISTROOT S LISTROOT="^TMP("_$J_",""LIST"","
"RTN","BPSOSIF",78,0)
 N X S X="1|Prescrip.:10,Drug:30,Fill Date:11,Quantity:10"
"RTN","BPSOSIF",79,0)
 S ^TMP($J,"LIST","Column Headers")=X
"RTN","BPSOSIF",80,0)
 N TITLE S TITLE="Select a prescription for "_PATNAME_" from this visit"
"RTN","BPSOSIF",81,0)
 N PROMPT S PROMPT(1)=VISIDESC
"RTN","BPSOSIF",82,0)
 N OPT S OPT=1
"RTN","BPSOSIF",83,0)
 N ANSROOT S ANSROOT="^TMP($J,""ANS""," K ^TMP($J,"ANS")
"RTN","BPSOSIF",84,0)
 N RXI,RXR S RXI=0 F  S RXI=$O(TMP(RXI)) Q:'RXI  D
"RTN","BPSOSIF",85,0)
 . S RXR="" F  S RXR=$O(TMP(RXI,RXR)) Q:RXR=""  D
"RTN","BPSOSIF",86,0)
 . . N N S (N,^TMP($J,"LIST",0))=^TMP($J,"LIST",0)+1
"RTN","BPSOSIF",87,0)
 . . N Z S Z=$G(^PSRX(RXI,0))
"RTN","BPSOSIF",88,0)
 . . N DRUGIEN S DRUGIEN=$P(Z,U,6)
"RTN","BPSOSIF",89,0)
 . . N DRUGNAME I DRUGIEN S DRUGNAME=$P($G(^PSDRUG(DRUGIEN,0)),U)
"RTN","BPSOSIF",90,0)
 . . E  S DRUGIEN="?"
"RTN","BPSOSIF",91,0)
 . . N DATE,QTY
"RTN","BPSOSIF",92,0)
 . . I RXR D
"RTN","BPSOSIF",93,0)
 . . . N Z S Z=$G(^PSRX(RXI,1,RXR,0))
"RTN","BPSOSIF",94,0)
 . . . S DATE=$P(Z,U)
"RTN","BPSOSIF",95,0)
 . . . S QTY=$P(Z,U,4)
"RTN","BPSOSIF",96,0)
 . . E  D
"RTN","BPSOSIF",97,0)
 . . . S DATE=$P($G(^PSRX(RXI,2)),U,2)
"RTN","BPSOSIF",98,0)
 . . . S QTY=$P(Z,U,7)
"RTN","BPSOSIF",99,0)
 . . N Y S Y=DATE X ^DD("DD") S DATE=Y
"RTN","BPSOSIF",100,0)
 . . S QTY=$$FMTQTY(QTY)
"RTN","BPSOSIF",101,0)
 . . N X S X=$$LJBF("`"_RXI,10)_" "_$$LJBF(DRUGNAME,30)
"RTN","BPSOSIF",102,0)
 . . S X=X_" "_$$LJBF(DATE,11)_" "_$$LJBF($$FMTQTY(QTY),10)
"RTN","BPSOSIF",103,0)
 . . S ^TMP($J,"LIST",N,"E")=X
"RTN","BPSOSIF",104,0)
 . . S ^TMP($J,"LIST",N,"I")=RXI_U_RXR
"RTN","BPSOSIF",105,0)
 S X=$$LIST^BPSOSU4(TYPE,LISTROOT,ANSROOT,TITLE,.PROMPT,OPT)
"RTN","BPSOSIF",106,0)
 I "^^"[X Q ""
"RTN","BPSOSIF",107,0)
 I X<0 Q ""
"RTN","BPSOSIF",108,0)
 Q X
"RTN","BPSOSIF",109,0)
FMTQTY(QTY)        ; decimal, 3 places, but no excess trailing zeroes
"RTN","BPSOSIF",110,0)
 I QTY#1=0 Q QTY_"    "
"RTN","BPSOSIF",111,0)
 S QTY=$J(QTY,0,3)
"RTN","BPSOSIF",112,0)
 I QTY?.E1"."1N1"00" S $E(QTY,$L(QTY)-1,$L(QTY))="  "
"RTN","BPSOSIF",113,0)
 E  I QTY?.E1"."2N1"0" S $E(QTY,$L(QTY))=" "
"RTN","BPSOSIF",114,0)
 Q QTY
"RTN","BPSOSIF",115,0)
VISIFIND(PAT,RXTYPE,VISITIEN)      ; given patient IEN, present a list of visits
"RTN","BPSOSIF",116,0)
 ; if RXTYPE=1, then pick only visits which have prescriptions
"RTN","BPSOSIF",117,0)
 ; returns index of one selected, and ^TMP($J,"LIST",***) left over
"RTN","BPSOSIF",118,0)
 ; returns false if none selected
"RTN","BPSOSIF",119,0)
 ; VISITIEN'=0 means "this is the visit I want, fake it out as if it
"RTN","BPSOSIF",120,0)
 ;   had been selected from the list."
"RTN","BPSOSIF",121,0)
 I $G(PAT) S PATNAME=$P(^DPT(PAT,0),U)
"RTN","BPSOSIF",122,0)
 N TYPE S TYPE="S" ; single item selection
"RTN","BPSOSIF",123,0)
 N LISTROOT S LISTROOT="^TMP("_$J_",""LIST""," K ^TMP($J,"LIST")
"RTN","BPSOSIF",124,0)
 N X S X="1|Visit:12,Date:14,Clinic:15,Prescriptions:25"
"RTN","BPSOSIF",125,0)
 S ^TMP($J,"LIST","Column Headers")=X
"RTN","BPSOSIF",126,0)
 N ANSROOT S ANSROOT="^TMP("_$J_",""ANS""," K ^TMP($J,"ANS")
"RTN","BPSOSIF",127,0)
 N RTVAL S RTVAL=$$VISLIST(VISITIEN)
"RTN","BPSOSIF",128,0)
 N TITLE S TITLE="Select a visit"
"RTN","BPSOSIF",129,0)
 I $G(PAT) S TITLE=TITLE_" for "_PATNAME
"RTN","BPSOSIF",130,0)
 N PROMPT S PROMPT="Item number (^ to exit)"
"RTN","BPSOSIF",131,0)
 N OPT S OPT=1
"RTN","BPSOSIF",132,0)
 N X
"RTN","BPSOSIF",133,0)
 I VISITIEN S X=1 ; we specified it, we pretend we selected it
"RTN","BPSOSIF",134,0)
 E  I '^TMP($J,"LIST",0) D  S X=""
"RTN","BPSOSIF",135,0)
 . W PATNAME," has no visits on file.",!
"RTN","BPSOSIF",136,0)
 E  S X=$$LIST^BPSOSU4(TYPE,LISTROOT,ANSROOT,TITLE,PROMPT,OPT)
"RTN","BPSOSIF",137,0)
 I "^^"[X Q ""
"RTN","BPSOSIF",138,0)
 I X<0 Q ""
"RTN","BPSOSIF",139,0)
 Q X
"RTN","BPSOSIF",140,0)
VISLIST(VISITIEN) ; set up LISTROOT ; given PAT ; if $$, it returns the count
"RTN","BPSOSIF",141,0)
 ; variations?  haven't thought it through - for now, must have PAT
"RTN","BPSOSIF",142,0)
 N ROOT S ROOT=$E(LISTROOT,1,$L(LISTROOT)-1)_")"
"RTN","BPSOSIF",143,0)
 S @ROOT@(0)=0
"RTN","BPSOSIF",144,0)
 N TIME9 S TIME9=""
"RTN","BPSOSIF",145,0)
 Q 0
"RTN","BPSOSIF",146,0)
VISRX(VISIT,ROOT)  ; build @ROOT=count of prescriptions for this visit
"RTN","BPSOSIF",147,0)
 ; @ROOT@(RXI,RXR)="" for each prescription
"RTN","BPSOSIF",148,0)
 ; Jump there via V MEDICATION
"RTN","BPSOSIF",149,0)
 I '$D(@ROOT) S @ROOT=0
"RTN","BPSOSIF",150,0)
 N VMED S VMED=0
"RTN","BPSOSIF",151,0)
 Q
"RTN","BPSOSIF",152,0)
VMEDRX(VMEDIEN,ROOT)         ; called from VISRX
"RTN","BPSOSIF",153,0)
 N RXI,RXR
"RTN","BPSOSIF",154,0)
 Q
"RTN","BPSOSIF",155,0)
PATFIND()          ; return patient IEN, or false if none selected
"RTN","BPSOSIF",156,0)
 N DIC,Y,DUOUT,DTOUT,X,DLAYGO,DINUM,RETVAL
"RTN","BPSOSIF",157,0)
 S DIC=2,DIC(0)="AEMNQZ"
"RTN","BPSOSIF",158,0)
 ;
"RTN","BPSOSIF",159,0)
 ; Removed this screen.  If memory serves, this "C" index is not
"RTN","BPSOSIF",160,0)
 ; reliable.  Besides, we need flexibility to find patients and visits
"RTN","BPSOSIF",161,0)
 ; which don't have prescription file entries, since we'll be entering
"RTN","BPSOSIF",162,0)
 ; non-prescription items, too.
"RTN","BPSOSIF",163,0)
 ;
"RTN","BPSOSIF",164,0)
 D ^DIC ; lookup patient
"RTN","BPSOSIF",165,0)
 Q $S(Y<0:"",1:+Y)
"RTN","BPSOSIF",166,0)
LJBF(X,N)          Q $E(X_$J("",N-$L(X)),1,N)
"RTN","BPSOSIO")
1^172
"RTN","BPSOSIP")
1^173
"RTN","BPSOSIV")
0^174^B71435352
"RTN","BPSOSIV",1,0)
BPSOSIV ;BHAM ISC/FCS/DRS/DLF - Old-style input ;06/01/2004
"RTN","BPSOSIV",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSIV",3,0)
 ;;Reference to ^PSRX( supported by DBIA4302
"RTN","BPSOSIV",4,0)
 N ABSBRXI,ABSBRXR,ABSBNDC
"RTN","BPSOSIV",5,0)
 N DEFNDCNO D  ; true/false, should we default NDC #?
"RTN","BPSOSIV",6,0)
 . N X D GET515^BPSOSI(DUZ,.X) S DEFNDCNO=$P($G(X(100)),U)
"RTN","BPSOSIV",7,0)
 N X S X=$$READER^BPSOSIW(99)
"RTN","BPSOSIV",8,0)
 I X<0 W !,"Because of ""^"", no claims are filed.",! H 3 Q  ; 03/22/2001
"RTN","BPSOSIV",9,0)
 I X="SCREENMAN" G ALL1^BPSOSI
"RTN","BPSOSIV",10,0)
 N ECHO,ORIGIN S ECHO=1,ORIGIN=3 ; 3 = from old style input
"RTN","BPSOSIV",11,0)
 I $O(ABSBRXI("")) D FILING(ECHO,ORIGIN)
"RTN","BPSOSIV",12,0)
 Q
"RTN","BPSOSIV",13,0)
FILING(ECHO,ORIGIN,MOREDATA)       ;EP - from BPSOSRB; ;6/23/03 ADDED MOREDATA
"RTN","BPSOSIV",14,0)
 ; with ABSBRXI(*),ABSBRXR(*) set up
"RTN","BPSOSIV",15,0)
 I '$D(ECHO) S ECHO=1
"RTN","BPSOSIV",16,0)
 I ECHO W "..."
"RTN","BPSOSIV",17,0)
F5 N IEN51 S IEN51=$$NEWREC^BPSOSI($O(ABSBRXI(" "),-1),0,ORIGIN)
"RTN","BPSOSIV",18,0)
 I ECHO W "..."
"RTN","BPSOSIV",19,0)
 I '$$INIT^BPSOSI(IEN51) G F5:$$IMPOSS^BPSOSUE("FM,P","TRI","INIT^BPSOSI failed",,"FILING",$T(+0)) ; it can't fail
"RTN","BPSOSIV",20,0)
 I ECHO W "..."
"RTN","BPSOSIV",21,0)
 D FILEARAY ; store local arrays into 9002313.51
"RTN","BPSOSIV",22,0)
 I ECHO W "..."
"RTN","BPSOSIV",23,0)
 D FILE^BPSOSIZ(IEN51,ECHO) ;same FILE^BPSOSIZ as what Screenman input uses to do filing
"RTN","BPSOSIV",24,0)
 I ECHO W !
"RTN","BPSOSIV",25,0)
 Q
"RTN","BPSOSIV",26,0)
FILEARAY ;
"RTN","BPSOSIV",27,0)
 I 0 W "At FILEARAY with ",! D
"RTN","BPSOSIV",28,0)
 . N A S A="" F  S A=$O(ABSBRXI(A)) Q:'A  D
"RTN","BPSOSIV",29,0)
 . . W A,?5,ABSBRXI(A),?20,ABSBRXR(A),?25,ABSBNDC(A),!
"RTN","BPSOSIV",30,0)
 N I,FDA,MSG,SUBF,IENS,VASEQ
"RTN","BPSOSIV",31,0)
 S SUBF=9002313.512
"RTN","BPSOSIV",32,0)
 F I=1:1 Q:'$D(ABSBRXI(I))  D
"RTN","BPSOSIV",33,0)
 . N PAT S PAT=$P(^PSRX(ABSBRXI(I),0),U,2)
"RTN","BPSOSIV",34,0)
 . S IENS=I_","_IEN51_","
"RTN","BPSOSIV",35,0)
 . S FDA(SUBF,IENS,.01)=I
"RTN","BPSOSIV",36,0)
 . S FDA(SUBF,IENS,1.01)=ABSBRXI(I)
"RTN","BPSOSIV",37,0)
 . S FDA(SUBF,IENS,1.02)=ABSBRXR(I)
"RTN","BPSOSIV",38,0)
 . S FDA(SUBF,IENS,1.04)=PAT
"RTN","BPSOSIV",39,0)
 . I $D(MOREDATA("IBDATA")) D    ;6/23/03 Store VA IB passed data
"RTN","BPSOSIV",40,0)
 . . ;note:  the FDA array is for fields in 9002313.59 and the MOREDATA array is in order of the 9002313.51 file for 8 and 9 nodes
"RTN","BPSOSIV",41,0)
 . . S VASEQ="",VASEQ=$O(MOREDATA("IBDATA",VASEQ))
"RTN","BPSOSIV",42,0)
 . . S FDA(SUBF,IENS,.03)=$S($G(MOREDATA("IBDATA")):$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",9),1:ABSBNDC(I))
"RTN","BPSOSIV",43,0)
 . . S FDA(SUBF,IENS,8.01)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",1)     ;INSURANCE PLAN IEN
"RTN","BPSOSIV",44,0)
 . . S FDA(SUBF,IENS,8.02)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",2)     ;BIN
"RTN","BPSOSIV",45,0)
 . . S FDA(SUBF,IENS,8.03)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",3)     ;PCN
"RTN","BPSOSIV",46,0)
 . . S FDA(SUBF,IENS,8.04)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",4)     ;PAYER SHEET
"RTN","BPSOSIV",47,0)
 . . S FDA(SUBF,IENS,8.05)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",5)     ;GROUP ID
"RTN","BPSOSIV",48,0)
 . . S FDA(SUBF,IENS,8.06)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",6)     ;CARDHOLDER ID
"RTN","BPSOSIV",49,0)
 . . S FDA(SUBF,IENS,8.07)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",7)     ;PATIENT RELATIONSHIP CODE
"RTN","BPSOSIV",50,0)
 . . I FDA(SUBF,IENS,8.07)="" S FDA(SUBF,IENS,8.07)=0
"RTN","BPSOSIV",51,0)
 . . I $L(FDA(SUBF,IENS,8.07))>1 S FDA(SUBF,IENS,8.07)=$E(FDA(SUBF,IENS,8.07),$L(FDA(SUBF,IENS,8.07)),$L(FDA(SUBF,IENS,8.07)))
"RTN","BPSOSIV",52,0)
 . . S FDA(SUBF,IENS,8.08)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",8)     ;CARDHOLDER FIRST NAME
"RTN","BPSOSIV",53,0)
 . . S FDA(SUBF,IENS,8.09)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",9)     ;CARDHOLDER LAST NAME
"RTN","BPSOSIV",54,0)
 . . S FDA(SUBF,IENS,8.11)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",10)    ;HOME PLAN STATE
"RTN","BPSOSIV",55,0)
 . . S FDA(SUBF,IENS,8.12)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",11)    ;B2 PAYER SHEET (REVERSAL)
"RTN","BPSOSIV",56,0)
 . . S FDA(SUBF,IENS,8.13)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",12)    ;B3 PAYER SHEET (REBILL)
"RTN","BPSOSIV",57,0)
 . . S FDA(SUBF,IENS,8.14)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",15)    ;INSURANCE PLAN NAME
"RTN","BPSOSIV",58,0)
 . . S FDA(SUBF,IENS,8.15)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",14)    ;CERTIFY MODE ON/OFF TOGGLE
"RTN","BPSOSIV",59,0)
 . . S FDA(SUBF,IENS,8.16)=$P($G(MOREDATA("IBDATA",VASEQ,1)),"^",13)    ;CERTIFICATION IEN TO USE FROM 9002313.31
"RTN","BPSOSIV",60,0)
 . . S FDA(SUBF,IENS,9.01)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",1)     ;DISPENSE FEE
"RTN","BPSOSIV",61,0)
 . . S FDA(SUBF,IENS,9.02)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",2)     ;BASIS OF COST DETERMINATION
"RTN","BPSOSIV",62,0)
 . . S FDA(SUBF,IENS,9.03)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",3)     ;USUAL & CUSTOMARY CHARGE
"RTN","BPSOSIV",63,0)
 . . S FDA(SUBF,IENS,9.04)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",4)     ;GROSS AMOUNT DUE
"RTN","BPSOSIV",64,0)
 . . S FDA(SUBF,IENS,9.05)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",5)     ;ADMINISTRATIVE FEE
"RTN","BPSOSIV",65,0)
 . . S FDA(SUBF,IENS,9.1)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",6)     ;Software Vendor/Cert ID
"RTN","BPSOSIV",66,0)
 . . S FDA(SUBF,IENS,9.06)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",7)     ;DRUG QUANTITY
"RTN","BPSOSIV",67,0)
 . . S FDA(SUBF,IENS,9.07)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",8)     ;INGREDIENT COST
"RTN","BPSOSIV",68,0)
 . . S FDA(SUBF,IENS,9.08)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",9)     ;NDC
"RTN","BPSOSIV",69,0)
 . . I $L(FDA(SUBF,IENS,9.08))=10 S FDA(SUBF,IENS,9.08)=$E(FDA(SUBF,IENS,9.08),2,12)             ;strip of the extra zero for va
"RTN","BPSOSIV",70,0)
 . . S FDA(SUBF,IENS,9.09)=$P($G(MOREDATA("IBDATA",VASEQ,2)),"^",10)     ;FILL NUMBER
"RTN","BPSOSIV",71,0)
 . . S FDA(SUBF,IENS,10.01)=$P($G(MOREDATA("IBDATA",VASEQ,3)),"^",1)     ; GROUP NAME
"RTN","BPSOSIV",72,0)
 . . S FDA(SUBF,IENS,10.02)=$P($G(MOREDATA("IBDATA",VASEQ,3)),"^",2)     ; INSURANCE COMPANY PHONE #
"RTN","BPSOSIV",73,0)
 . . S FDA(SUBF,IENS,10.03)=$P($G(MOREDATA("IBDATA",VASEQ,3)),"^",3)     ; PHARMACY PLAN IEN
"RTN","BPSOSIV",74,0)
 ; S VADIAL="",VADIAL=$S($D(MOREDATA("DIALOUT")):MOREDATA("DIALOUT"),1:"1VA")
"RTN","BPSOSIV",75,0)
FA5 D FILE^DIE("","FDA","MSG")
"RTN","BPSOSIV",76,0)
 I $D(MSG) D  G F5:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"FILEARAY",$T(+0))
"RTN","BPSOSIV",77,0)
 . W !,"Unexpected error in FILEARAY^"_$T(+0),!
"RTN","BPSOSIV",78,0)
 . D ZWRITE^BPSOS("ABSBRXI","ABSBRXR","ABSBNDC","MSG")
"RTN","BPSOSIV",79,0)
 ;
"RTN","BPSOSIV",80,0)
 ; File DUR info if present
"RTN","BPSOSIV",81,0)
 I $D(MOREDATA("DUR")) D
"RTN","BPSOSIV",82,0)
 . N DUR
"RTN","BPSOSIV",83,0)
 . K FDA
"RTN","BPSOSIV",84,0)
 . S SUBF=9002313.514,DUR=0
"RTN","BPSOSIV",85,0)
 . F  S DUR=$O(MOREDATA("DUR",DUR)) Q:DUR=""  D
"RTN","BPSOSIV",86,0)
 .. S IENS="+1,"_IEN51_",",IENS(1)=DUR
"RTN","BPSOSIV",87,0)
 .. S FDA(SUBF,IENS,.01)=DUR                               ; DUR Counter
"RTN","BPSOSIV",88,0)
 .. S FDA(SUBF,IENS,1)=$P($G(MOREDATA("DUR",DUR,0)),U,1)   ; DUR Professional Service Code
"RTN","BPSOSIV",89,0)
 .. S FDA(SUBF,IENS,2)=$P($G(MOREDATA("DUR",DUR,0)),U,2)   ; DUR Reason for Service Code
"RTN","BPSOSIV",90,0)
 .. S FDA(SUBF,IENS,3)=$P($G(MOREDATA("DUR",DUR,0)),U,3)   ; DUR Result of Service Code
"RTN","BPSOSIV",91,0)
 . D UPDATE^DIE("","FDA","IENS","MSG")
"RTN","BPSOSIV",92,0)
 . I $D(MSG) D  G F5:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"FILEARAY",$T(+0))
"RTN","BPSOSIV",93,0)
 .. W !,"Unexpected error in FILEARAY^"_$T(+0),!
"RTN","BPSOSIV",94,0)
 Q
"RTN","BPSOSIV",95,0)
SETRXR() Q +$O(^PSRX(ABSBRXI,1,"A"),-1) ;most recent refill ^PSRX(ien,
"RTN","BPSOSIV",96,0)
 ;
"RTN","BPSOSIV",97,0)
 ; $$DEFNDC used by $$READER10/$$GETNDC and maybe others.
"RTN","BPSOSIV",98,0)
DEFNDC() ;EP - from BPSOSIW, BPSOSRB
"RTN","BPSOSIV",99,0)
 I ABSBRXR Q $P($G(^PSRX(ABSBRXI,1,ABSBRXR,0)),U,13)
"RTN","BPSOSIV",100,0)
 E  Q $P($G(^PSRX(ABSBRXI,2)),U,7)
"RTN","BPSOSIV",101,0)
 ;
"RTN","BPSOSIV",102,0)
 ; Compute time difference
"RTN","BPSOSIV",103,0)
TDIF(H0,H1)        Q $P(H1,",")-$P(H0,",")*86400+$P(H1,",",2)-$P(H0,",",2)
"RTN","BPSOSIV",104,0)
 ;
"RTN","BPSOSIV",105,0)
GETRX() ;EP - from BPSOS6L,BPSOS6M
"RTN","BPSOSIV",106,0)
 N X,Y,PT,DG,DIC
"RTN","BPSOSIV",107,0)
GETRX1 ;
"RTN","BPSOSIV",108,0)
 S X=$$FREETEXT^BPSOSU2("Prescription: ",,1,1,31,$G(DTIME))
"RTN","BPSOSIV",109,0)
 I "^^"[X Q X    ;Q:X="^" "^"  Q:X="" X
"RTN","BPSOSIV",110,0)
 ;
"RTN","BPSOSIV",111,0)
 S X=$TR(X,"abcdefghijklmnopqrstuvwyxz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSOSIV",112,0)
 I $E("SCREENMAN",1,$L(X))=X Q "SCREENMAN"
"RTN","BPSOSIV",113,0)
 I X["-" S X=$P(X,"-",2),X="`"_X
"RTN","BPSOSIV",114,0)
 I X?1N.N D
"RTN","BPSOSIV",115,0)
 . I $P($G(^BPS(9002313.99,1,"INPUT")),U)=0 S X="`"_+X
"RTN","BPSOSIV",116,0)
 . ; else it's an external number; leave it alone
"RTN","BPSOSIV",117,0)
 ;
"RTN","BPSOSIV",118,0)
 ; Maybe typed RX followed by an RX external number
"RTN","BPSOSIV",119,0)
 ;
"RTN","BPSOSIV",120,0)
 I $P(X," ")="RX" S X=+$P(X," ",2)
"RTN","BPSOSIV",121,0)
 ;
"RTN","BPSOSIV",122,0)
 S DIC="^PSRX(",DIC(0)="N" D ^DIC
"RTN","BPSOSIV",123,0)
 I Y<1 D  G GETRX1
"RTN","BPSOSIV",124,0)
 .W !,"INPUT - Prescription "_X_" not found.",!
"RTN","BPSOSIV",125,0)
 S Y=+Y
"RTN","BPSOSIV",126,0)
 S X=$G(^PSRX(Y,0))
"RTN","BPSOSIV",127,0)
 S PT=$P(X,U,2),DG=$P(X,U,6)
"RTN","BPSOSIV",128,0)
 I PT]"" W "  ",$P($G(^DPT(PT,0)),U)
"RTN","BPSOSIV",129,0)
 I DG]"" W "  ",$P($G(^PSDRUG(DG,0)),U)
"RTN","BPSOSIV",130,0)
 S ABSBRXI=Y,ABSBRXR=$$SETRXR
"RTN","BPSOSIV",131,0)
 N IEN59 S IEN59=$$IEN59(ABSBRXI,ABSBRXR,1)
"RTN","BPSOSIV",132,0)
 I $$ISRESUB(IEN59) W !?5 D  G:Y<1 GETRX1
"RTN","BPSOSIV",133,0)
 .I 1 N % D  S Y=$S(%=1:Y,%=0:"",%=-1:Y_"R") Q
"RTN","BPSOSIV",134,0)
 . . S %=$$RESUBMIT(IEN59)
"RTN","BPSOSIV",135,0)
 S Y=+Y
"RTN","BPSOSIV",136,0)
 Q Y
"RTN","BPSOSIV",137,0)
IEN59(A,B,C)       Q A_"."_$TR($J(B,4)," ","0")_C
"RTN","BPSOSIV",138,0)
ISRESUB(IEN59)       ; 
"RTN","BPSOSIV",139,0)
 Q $D(^BPST(IEN59))
"RTN","BPSOSIV",140,0)
RESUBMIT(RXI)          ; 
"RTN","BPSOSIV",141,0)
 N RETVAL,X
"RTN","BPSOSIV",142,0)
 W !?5,"This prescription has already been processed thru ECME.",!
"RTN","BPSOSIV",143,0)
 N STATUS S STATUS=$P(^BPST(RXI,0),U,2)
"RTN","BPSOSIV",144,0)
 N TIME S TIME=$P(^BPST(RXI,0),U,8) ; last update
"RTN","BPSOSIV",145,0)
 N REVERSAL S REVERSAL=$G(^BPST(RXI,4))
"RTN","BPSOSIV",146,0)
 N NOW,%,%H,%I,X D NOW^%DTC S NOW=%
"RTN","BPSOSIV",147,0)
 N TIMEDIF S TIMEDIF=$$TIMEDIF^BPSOSUD(TIME,NOW)
"RTN","BPSOSIV",148,0)
 N TIMEDIFI S TIMEDIFI=$$TIMEDIFI^BPSOSUD(TIME,NOW)
"RTN","BPSOSIV",149,0)
 N COMPLETE S COMPLETE=STATUS'<99
"RTN","BPSOSIV",150,0)
 I COMPLETE D
"RTN","BPSOSIV",151,0)
 . W "Processing completed ",TIMEDIF," ago.",!
"RTN","BPSOSIV",152,0)
 . W "The result was ",$$RESULT^BPSOS6B(RXI),!
"RTN","BPSOSIV",153,0)
 . I $$RXPAID^BPSOSNC(RXI) D
"RTN","BPSOSIV",154,0)
 . . W "Last time, the insurer accepted this claim for payment.",!
"RTN","BPSOSIV",155,0)
 . . W "If you wish to resubmit the claim with different data,",!
"RTN","BPSOSIV",156,0)
 . . W "the paid claim must first be reversed (use the REV option",!
"RTN","BPSOSIV",157,0)
 . . W "to reverse paid claims.)",!
"RTN","BPSOSIV",158,0)
 . . S RETVAL=0 Q
"RTN","BPSOSIV",159,0)
 . . S X=$$YESNO^BPSOSU3("Do you want to request a REVERSAL? ","NO",0)
"RTN","BPSOSIV",160,0)
 . . S RETVAL=$S(X=1:-1,1:0)
"RTN","BPSOSIV",161,0)
 . . I RETVAL=0 W !?5,"You should NOT resubmit this claim.",!
"RTN","BPSOSIV",162,0)
 . E  D
"RTN","BPSOSIV",163,0)
 . . S X=$$YESNO^BPSOSU3("Do you want to resubmit the claim? ","YES",0)
"RTN","BPSOSIV",164,0)
 . . S RETVAL=$S(X=1:1,1:0)
"RTN","BPSOSIV",165,0)
 . . W " The claim will",$S(RETVAL:"",1:" NOT")," be resubmitted.",!
"RTN","BPSOSIV",166,0)
 E  D
"RTN","BPSOSIV",167,0)
 . W "This claim did not complete processing!",!
"RTN","BPSOSIV",168,0)
 . W "The last activity was ",TIMEDIF," ago.",!
"RTN","BPSOSIV",169,0)
 . N BACKLOG S BACKLOG=$$BACKLOG^BPSOSIW ; things waiting to process
"RTN","BPSOSIV",170,0)
 . I TIMEDIFI<1800,BACKLOG>30 D
"RTN","BPSOSIV",171,0)
 . . N % S %=BACKLOG+30\60
"RTN","BPSOSIV",172,0)
 . . W "There is an estimated backlog in the ECME system",!
"RTN","BPSOSIV",173,0)
 . . W "of ",%," minute" W:%>1 "s" W " of processing.",!
"RTN","BPSOSIV",174,0)
 . I BACKLOG*1.5+600>TIMEDIFI D  S RETVAL=0 Q
"RTN","BPSOSIV",175,0)
 . . W "Please wait at least ten minutes before trying ",!
"RTN","BPSOSIV",176,0)
 . . W "to resubmit the claim.  It may be waiting its turn for ",!
"RTN","BPSOSIV",177,0)
 . . W "processing.  Or there may be a larger problem that requires",!
"RTN","BPSOSIV",178,0)
 . . W "technical support attention.",!
"RTN","BPSOSIV",179,0)
 . . S %=$G(^BPST(RXI,4))
"RTN","BPSOSIV",180,0)
 . . I $P(%,U),'$P(%,U,2) D  ; reversal submitted but no response
"RTN","BPSOSIV",181,0)
 . . . W !!?10,"REVERSALS: If you just recently submitted a REVERSAL,",!
"RTN","BPSOSIV",182,0)
 . . . W ?10,"you may resubmit the claim as soon as the reversal",!
"RTN","BPSOSIV",183,0)
 . . . W ?10,"has been completed.",!
"RTN","BPSOSIV",184,0)
 . S X=$$YESNO^BPSOSU3("Are you sure you want to resubmit this claim now? ","NO",0)
"RTN","BPSOSIV",185,0)
 . S RETVAL=$S(X=1:1,1:0)
"RTN","BPSOSIV",186,0)
 Q RETVAL
"RTN","BPSOSIW")
0^175^B14787815
"RTN","BPSOSIW",1,0)
BPSOSIW ;BHAM ISC/FCS/DRS/DLF - Old-style input ;06/01/2004
"RTN","BPSOSIW",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSIW",3,0)
 ; overflow from BPSOSIV
"RTN","BPSOSIW",4,0)
BACKLOG() ;EP - from BPSOSIV
"RTN","BPSOSIW",5,0)
 ; a rough guess on how many seconds of backlog there are
"RTN","BPSOSIW",6,0)
 N STATS,LOCK,TALLY S LOCK=1,TALLY=0
"RTN","BPSOSIW",7,0)
 D FETSTAT^BPSOS2("STATS(1)")
"RTN","BPSOSIW",8,0)
 N A S A="" F  S A=$O(STATS(1,A)) Q:'A  D
"RTN","BPSOSIW",9,0)
 . S TALLY=STATS(1,A)*7 ; 7 seconds of packet preparation & overhead
"RTN","BPSOSIW",10,0)
 D FETPKTQ^BPSOS2("STATS(2)")
"RTN","BPSOSIW",11,0)
 N CLAIMS S CLAIMS=$G(STATS(2,"C")) ; figure about 12 secs each
"RTN","BPSOSIW",12,0)
 N RESPS S RESPS=$G(STATS(2,"R")) ; figure about 3 secs each
"RTN","BPSOSIW",13,0)
 S TALLY=CLAIMS*12+(RESPS*3)+TALLY ; 
"RTN","BPSOSIW",14,0)
 S TALLY=CLAIMS*20+TALLY ; and 20 secs dialing for each one (EOT prob)
"RTN","BPSOSIW",15,0)
 I 0,+$H=58107,$P($H,",",2)<(7*3600) D  Q 300
"RTN","BPSOSIW",16,0)
 . W "Computed value from $$BACKLOG=",TALLY," but change it for testing.",!
"RTN","BPSOSIW",17,0)
 Q TALLY
"RTN","BPSOSIW",18,0)
GETNDC() ;EP - from BPSOSIV
"RTN","BPSOSIW",19,0)
 ;Prompt - get NDC #
"RTN","BPSOSIW",20,0)
 ; Returns the NDC # with the "-"
"RTN","BPSOSIW",21,0)
 ; Even if pure numeric input, figure it out and put in the "-"
"RTN","BPSOSIW",22,0)
 ; "^" OR "^^" or "" if the user inputs one of those
"RTN","BPSOSIW",23,0)
 ; 0 if automatic answer input was a bad number
"RTN","BPSOSIW",24,0)
 ;
"RTN","BPSOSIW",25,0)
 ; Don't default it - they want the real, true number to always be
"RTN","BPSOSIW",26,0)
 ; scanned in from the bottle, every time.
"RTN","BPSOSIW",27,0)
 ;
"RTN","BPSOSIW",28,0)
 N X,NDCDEF
"RTN","BPSOSIW",29,0)
NDC0 I DEFNDCNO S NDCDEF=$$DEFNDC^BPSOSIV ; relies on ABSBRXI, ABSBRXR
"RTN","BPSOSIW",30,0)
 E  S NDCDEF=""
"RTN","BPSOSIW",31,0)
 S X=$$FREETEXT^BPSOSU2("NDC#: ",NDCDEF,1,1,15,$G(DTIME))
"RTN","BPSOSIW",32,0)
 ;
"RTN","BPSOSIW",33,0)
 ; "the Abbot Labs bar codes are really funky"
"RTN","BPSOSIW",34,0)
 I X?1"++3"10.11N2E D
"RTN","BPSOSIW",35,0)
 . S X=$E(X,4,$L(X)-2) ; strip off the surrounding junk
"RTN","BPSOSIW",36,0)
 . ; fine if it's 11N
"RTN","BPSOSIW",37,0)
 . ; if it's 10N, what?  leave it to the mercy of the $$NDC10^BPSOS9?
"RTN","BPSOSIW",38,0)
 I "^^"[X Q X    ;
"RTN","BPSOSIW",39,0)
 ; If it's entirely numeric input, figure out where the "-" go.
"RTN","BPSOSIW",40,0)
 I X?9N D
"RTN","BPSOSIW",41,0)
 . S X=$E(X,1,3)_"-"_$E(X,4,7)_"-"_$E(X,8,9) ;LJE;VA 9 Digit ndc's
"RTN","BPSOSIW",42,0)
 I X?10N D
"RTN","BPSOSIW",43,0)
 .N Y S Y=$$NDC10^BPSOS9(X)
"RTN","BPSOSIW",44,0)
 .I Y="" W !,"We couldn't figure out ",X,!
"RTN","BPSOSIW",45,0)
 .E  W "  ",Y S X=Y
"RTN","BPSOSIW",46,0)
 I X?11N D
"RTN","BPSOSIW",47,0)
 .S X=$E(X,1,5)_"-"_$E(X,6,9)_"-"_$E(X,10,11)
"RTN","BPSOSIW",48,0)
 I X?12N D  ; got to ask Carlene about this
"RTN","BPSOSIW",49,0)
 .W !,"12 digit NDC number?  We will proceed anyhow, but it's going",!
"RTN","BPSOSIW",50,0)
 .W "to be truncated"
"RTN","BPSOSIW",51,0)
 .S X=$E(X,1,6)_"-"_$E(X,7,10)_"-"_$E(X,11,12) ; put in 6-4-2 format
"RTN","BPSOSIW",52,0)
 .W !
"RTN","BPSOSIW",53,0)
 I X?3N1"-"4N1"-"2N G NDC1  ;LJE;VA
"RTN","BPSOSIW",54,0)
 I X?4N1"-"4N1"-"2N G NDC1
"RTN","BPSOSIW",55,0)
 I X?5N1"-"3N1"-"2N G NDC1
"RTN","BPSOSIW",56,0)
 I X?5N1"-"4N1"-"1N G NDC1
"RTN","BPSOSIW",57,0)
 I X?5N1"-"4N1"-"2N G NDC1
"RTN","BPSOSIW",58,0)
 I X?6N1"-"4N1"-"2N G NDC1
"RTN","BPSOSIW",59,0)
 W:'$G(SILENT) !,"Bad NDC #",! G NDC0
"RTN","BPSOSIW",60,0)
NDC1 ;
"RTN","BPSOSIW",61,0)
 ; Don't store it yet - just get input now - let background job store it
"RTN","BPSOSIW",62,0)
 W "    ",$$NAME^BPSOS9(X)
"RTN","BPSOSIW",63,0)
 Q X    ; JUST RETURN WHAT WAS INPUT!!!
"RTN","BPSOSIW",64,0)
 ;
"RTN","BPSOSIW",65,0)
TEST ; testing READER
"RTN","BPSOSIW",66,0)
 S X=$$READER
"RTN","BPSOSIW",67,0)
 W "Returned value from READER was ",X,!
"RTN","BPSOSIW",68,0)
 Q
"RTN","BPSOSIW",69,0)
 ;
"RTN","BPSOSIW",70,0)
READER(MAXINPUT) ; EP - from BPSOSIV.
"RTN","BPSOSIW",71,0)
 ; Get input for Pharmacy POS.
"RTN","BPSOSIW",72,0)
 W !!,"Scan the prescription and NDC numbers.",!
"RTN","BPSOSIW",73,0)
 W "Press ENTER when done and the claims will be processed.",!
"RTN","BPSOSIW",74,0)
 W "Type ^ to stop without sending claims.",!
"RTN","BPSOSIW",75,0)
 W !
"RTN","BPSOSIW",76,0)
 N INDEX S INDEX=0
"RTN","BPSOSIW",77,0)
 N RETVAL
"RTN","BPSOSIW",78,0)
 I '$D(MAXINPUT) S MAXINPUT=10
"RTN","BPSOSIW",79,0)
 F INDEX=1:1:MAXINPUT S RETVAL=$$READER10 Q:RETVAL<1  I RETVAL>1 D
"RTN","BPSOSIW",80,0)
 .S ABSBRXI(INDEX)=ABSBRXI
"RTN","BPSOSIW",81,0)
 .S ABSBRXR(INDEX)=ABSBRXR
"RTN","BPSOSIW",82,0)
 .S ABSBNDC(INDEX)=ABSBNDC
"RTN","BPSOSIW",83,0)
 W ! ; when you pressed ENTER, it didn't echo.
"RTN","BPSOSIW",84,0)
 I RETVAL<0 Q RETVAL
"RTN","BPSOSIW",85,0)
 I ABSBRXI="SCREENMAN" Q ABSBRXI
"RTN","BPSOSIW",86,0)
 ;
"RTN","BPSOSIW",87,0)
READER10() ; Get the inputs
"RTN","BPSOSIW",88,0)
READER11 ; branch back if "SCREENMAN" entered too late
"RTN","BPSOSIW",89,0)
 S ABSBRXI=$$GETRX^BPSOSIV() ; sets ABSBRXR, too
"RTN","BPSOSIW",90,0)
 I ABSBRXI="SCREENMAN" Q:INDEX=1 ABSBRXI D  G READER11
"RTN","BPSOSIW",91,0)
 . W !,"Typing SCREENMAN has to be done at the very beginning.",!
"RTN","BPSOSIW",92,0)
 . W "For now, you're stuck in this old-style input.",!
"RTN","BPSOSIW",93,0)
 . W "Answer with   ^    to get out without doing anything.",!
"RTN","BPSOSIW",94,0)
 ;
"RTN","BPSOSIW",95,0)
 W !
"RTN","BPSOSIW",96,0)
 I ABSBRXI<1 Q $S(ABSBRXI["^":-1,ABSBRXI="":0,1:0.01)
"RTN","BPSOSIW",97,0)
 ;
"RTN","BPSOSIW",98,0)
 S ABSBNDC=$$GETNDC()
"RTN","BPSOSIW",99,0)
 W !
"RTN","BPSOSIW",100,0)
 I 'ABSBNDC W !,"Try again.",! H 2 G READER11 ; 03/22/2001 ;Q 0.04
"RTN","BPSOSIW",101,0)
 ;
"RTN","BPSOSIW",102,0)
READER19 Q ABSBRXI ; return big #, since all is well for storage 
"RTN","BPSOSIW",103,0)
 ; with ABSBRXR, ABSBNDC
"RTN","BPSOSIW",104,0)
 ;
"RTN","BPSOSIW",105,0)
READER99 Q 0
"RTN","BPSOSIY")
0^176^B63037974
"RTN","BPSOSIY",1,0)
BPSOSIY ;BHAM ISC/FCS/DRS/DLF - Filing with .51,.59 ;06/01/2004
"RTN","BPSOSIY",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSIY",3,0)
 Q
"RTN","BPSOSIY",4,0)
IEN59() ;EP - given INPUT(), what should we use for an IEN in file 9002313.59?
"RTN","BPSOSIY",5,0)
 N RXI,RET
"RTN","BPSOSIY",6,0)
 S RXI=$P(INPUT(1),U)
"RTN","BPSOSIY",7,0)
 I RXI D
"RTN","BPSOSIY",8,0)
 . S RXR=$P(INPUT(1),U,2)
"RTN","BPSOSIY",9,0)
 . I RXR>9000 D
"RTN","BPSOSIY",10,0)
 . . D IMPOSS^BPSOSUE("DB","TI","Refill number near overflow point","RXI="_RXI,"IEN59",$T(+0))
"RTN","BPSOSIY",11,0)
 . ; you can raise the limit and be thinking of how to get around it
"RTN","BPSOSIY",12,0)
 . S RET=RXI_"."_$TR($J(RXR,4)," ","0")
"RTN","BPSOSIY",13,0)
 . S RET=RET_$S($P(INPUT(0),U,3)?1"POSTAGE".E:2,1:1)
"RTN","BPSOSIY",14,0)
 E  D
"RTN","BPSOSIY",15,0)
 . N VIS,CPT S VIS=$P(INPUT(1),U,6),CPT=$P(INPUT(1),U,8)
"RTN","BPSOSIY",16,0)
 . I 'VIS D  ; visit IEN, must not be zero
"RTN","BPSOSIY",17,0)
 . . D IMPOSS^BPSOSUE("P","TI","Visit IEN missing; should have been detected by now",,"IEN59",$T(+0))
"RTN","BPSOSIY",18,0)
 . . S VIS="MISSING"
"RTN","BPSOSIY",19,0)
 . I 'CPT D  ; CPT IEN, must not be zero
"RTN","BPSOSIY",20,0)
 . . D IMPOSS^BPSOSUE("P","TI","CPT IEN missing; should have been detected by now",,"IEN59",$T(+0))
"RTN","BPSOSIY",21,0)
 . . S CPT="MISSING"
"RTN","BPSOSIY",22,0)
 . S RET=VIS_"."_$TR($J(CPT,6)," ","0")_3
"RTN","BPSOSIY",23,0)
 Q RET
"RTN","BPSOSIY",24,0)
SETUP59(IEN51,IEN59,ORIGIN) ;EP - from BPSOSIZ
"RTN","BPSOSIY",25,0)
 ; You don't have to set null fields, so long as you have called
"RTN","BPSOSIY",26,0)
 ; CLEAR, or if this is a NEW entry.
"RTN","BPSOSIY",27,0)
 ; INPUT is defined in FILE1^BPSOSIZ
"RTN","BPSOSIY",28,0)
 N FLAGS,FDA,MSG,FN,REC,X,I,VARX,TYPE
"RTN","BPSOSIY",29,0)
 S VARX=0
"RTN","BPSOSIY",30,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1
"RTN","BPSOSIY",31,0)
 S FN=9002313.59,REC=IEN59_","
"RTN","BPSOSIY",32,0)
 ; TYPE = 1 for prescription, = 2 for mailing prescription,
"RTN","BPSOSIY",33,0)
 ;      = 3 for non-prescription items
"RTN","BPSOSIY",34,0)
 S TYPE=$E(IEN59,$L(IEN59))
"RTN","BPSOSIY",35,0)
 S FDA(FN,REC,.13)=TYPE
"RTN","BPSOSIY",36,0)
 S FDA(FN,REC,.14)=ORIGIN
"RTN","BPSOSIY",37,0)
 S FDA(FN,REC,1)=0 ; STATUS - waiting to start
"RTN","BPSOSIY",38,0)
 ; Field 1.06 - copied from field 701, below
"RTN","BPSOSIY",39,0)
 S FDA(FN,REC,1.08)=1 ; PINS piece
"RTN","BPSOSIY",40,0)
 I TYPE=1!(TYPE=2) S FDA(FN,REC,1.11)=$P(INPUT(1),U) ; RXI
"RTN","BPSOSIY",41,0)
 I $P($G(^BPST(IEN59,1)),U,12)=1 S FDA(FN,REC,1.12)=2  ; Resubmit after reversal
"RTN","BPSOSIY",42,0)
 S X=$G(^BPS(9002313.51,IEN51,3))
"RTN","BPSOSIY",43,0)
 S FDA(FN,REC,1201)=$P(X,"^",1)                             ; RX Action
"RTN","BPSOSIY",44,0)
 S FDA(FN,REC,1202)=$P(X,"^",2)                             ; Date of Service
"RTN","BPSOSIY",45,0)
 S FDA(FN,REC,13)=$P($G(^BPS(9002313.51,IEN51,0)),"^",2)    ; User
"RTN","BPSOSIY",46,0)
 ;
"RTN","BPSOSIY",47,0)
 ;IHS/SD/lwj 8/30/02 NCPDP 5.1 changes
"RTN","BPSOSIY",48,0)
 ; the prior authorization code is now two fields - type and number
"RTN","BPSOSIY",49,0)
 ; begin changes to capture both values
"RTN","BPSOSIY",50,0)
 ;
"RTN","BPSOSIY",51,0)
 I $D(INPUT(2)),$P(INPUT(2),U,2)]"" D
"RTN","BPSOSIY",52,0)
 . S FDA(FN,REC,1.09)=$P(INPUT(2),U)    ; prior authorization number 
"RTN","BPSOSIY",53,0)
 . S FDA(FN,REC,1.15)=$P(INPUT(2),U,2)  ; prior auth type code 
"RTN","BPSOSIY",54,0)
 ;
"RTN","BPSOSIY",55,0)
 ;IHS/SD/lwj 8/30/02 end NCPDP 5.1 prior authorization changes
"RTN","BPSOSIY",56,0)
 ;
"RTN","BPSOSIY",57,0)
 S FDA(FN,REC,5)=$P(INPUT(1),U,4) ; Patient
"RTN","BPSOSIY",58,0)
 S FDA(FN,REC,7)=$$NOW ; LAST UPDATE
"RTN","BPSOSIY",59,0)
 S FDA(FN,REC,9)=$P(INPUT(1),U,2) ; RXR - refill index
"RTN","BPSOSIY",60,0)
 I TYPE=1 S FDA(FN,REC,10)=$P(INPUT(0),U,3) ; NDC
"RTN","BPSOSIY",61,0)
 I TYPE=1&(VARX) S FDA(FN,REC,10)=$P($G(INPUT(9)),"^",8)  ;LJE
"RTN","BPSOSIY",62,0)
 I TYPE=1!(TYPE=2) S FDA(FN,REC,12)=$P(INPUT(1),U,6) ; Visit
"RTN","BPSOSIY",63,0)
 S FDA(FN,REC,15)=FDA(FN,REC,7) ; START TIME
"RTN","BPSOSIY",64,0)
 F I=1:1:6 S X=$P($G(INPUT(5)),U,I) I X]"" S FDA(FN,REC,500+I)=X
"RTN","BPSOSIY",65,0)
 I $G(INPUT(6))]""!($G(INPUT(7))]"") D
"RTN","BPSOSIY",66,0)
 . F I=1:1:3 D
"RTN","BPSOSIY",67,0)
 . . I $P(INPUT(6),U,I)]"" S FDA(FN,REC,600+I)=$P($G(INPUT(6)),U,I)
"RTN","BPSOSIY",68,0)
 . . I $P(INPUT(7),U,I)]"" S FDA(FN,REC,700+I)=$P($G(INPUT(7)),U,I)
"RTN","BPSOSIY",69,0)
 I $D(FDA(FN,REC,701)) D
"RTN","BPSOSIY",70,0)
 . S FDA(FN,REC,1.06)=FDA(FN,REC,701) ; INSURER
"RTN","BPSOSIY",71,0)
 ; 500's, 600's, 700's done above
"RTN","BPSOSIY",72,0)
 ; 
"RTN","BPSOSIY",73,0)
 ;LJE;6/26/03; Set initial insurance to work with
"RTN","BPSOSIY",74,0)
 I $D(INPUT(8)) D
"RTN","BPSOSIY",75,0)
 . S FDA(FN,REC,901)=1  ;first insurance ien
"RTN","BPSOSIY",76,0)
 . S FDA(FN,REC,504)=$P($G(INPUT(9)),"^",1)  ;DISPENSE FEE
"RTN","BPSOSIY",77,0)
 . S FDA(FN,REC,505)=$P($G(INPUT(9)),"^",3)  ;GROSS AMOUNT DUE/USUAL & CUSTOMARY
"RTN","BPSOSIY",78,0)
 . S FDA(FN,REC,507)=$P($G(INPUT(9)),"^",5)  ;ADMINISTRATIVE FEE
"RTN","BPSOSIY",79,0)
 . S FDA(FN,REC,501)=$P($G(INPUT(9)),"^",6)  ;Drug QUANTITY
"RTN","BPSOSIY",80,0)
 . S FDA(FN,REC,502)=$P($G(INPUT(9)),"^",7)  ;INGREDIENT COST
"RTN","BPSOSIY",81,0)
 . S FDA(FN,REC,10)=$P($G(INPUT(9)),"^",8)   ;NDC - last NDC billed for this drug
"RTN","BPSOSIY",82,0)
 I FDA(FN,REC,10)'["-" S FDA(FN,REC,10)=$E(FDA(FN,REC,10),1,5)_"-"_$E(FDA(FN,REC,10),6,9)_"-"_$E(FDA(FN,REC,10),10,11)
"RTN","BPSOSIY",83,0)
 ;
"RTN","BPSOSIY",84,0)
 D FILE^DIE("","FDA","MSG") ; NO "E" FLAG - DATA IS IN INTERNAL FORMAT!
"RTN","BPSOSIY",85,0)
 ;
"RTN","BPSOSIY",86,0)
 ;LJE;6/24/03;Added VA sets to .59 file; continuing sets throughout process in order to
"RTN","BPSOSIY",87,0)
 ;                       ; not lose any data should an error occur.
"RTN","BPSOSIY",88,0)
 ;
"RTN","BPSOSIY",89,0)
 S VA59IEN="+1,"
"RTN","BPSOSIY",90,0)
 S ISTHERE="",ISTHERE=$$GET1^DIQ(9002313.59902,"1,"_REC_",",".01","","","MSG")
"RTN","BPSOSIY",91,0)
 I ISTHERE'=""&('$D(MSG)) S VA59IEN="1,"
"RTN","BPSOSIY",92,0)
 K MSG
"RTN","BPSOSIY",93,0)
 S FN=9002313.59902
"RTN","BPSOSIY",94,0)
 ; Note: The INPUT array is from 8 and 9 node of 9002313.51 and the FDA array is for the 10 node of 9002313.59
"RTN","BPSOSIY",95,0)
 ; Create/edit the multiple  The Plan ID is in internal format.
"RTN","BPSOSIY",96,0)
 I $D(INPUT(8)) D
"RTN","BPSOSIY",97,0)
 . S FDA(FN,VA59IEN_REC,.01)=$P($G(INPUT(8)),"^",1)               ;PLAN ID
"RTN","BPSOSIY",98,0)
 . I VA59IEN'["+" D FILE^DIE("","FDA","MSG")
"RTN","BPSOSIY",99,0)
 . I VA59IEN["+"  D UPDATE^DIE("","FDA","VAIEN","MSG")
"RTN","BPSOSIY",100,0)
 . ; 
"RTN","BPSOSIY",101,0)
 . ; Include the rest of the fields, which are in external format
"RTN","BPSOSIY",102,0)
 . S VA59IEN="1,"
"RTN","BPSOSIY",103,0)
 . S FDA(FN,VA59IEN_REC,902.03)=$P($G(INPUT(8)),"^",2)            ;BIN
"RTN","BPSOSIY",104,0)
 . S FDA(FN,VA59IEN_REC,902.04)=$P($G(INPUT(8)),"^",3)            ;PCN
"RTN","BPSOSIY",105,0)
 . S FDA(FN,VA59IEN_REC,902.02)=$P($G(INPUT(8)),"^",4)            ;PAYER SHEET IEN 
"RTN","BPSOSIY",106,0)
 . S FDA(FN,VA59IEN_REC,902.05)=$P($G(INPUT(8)),"^",5)            ;GROUP ID
"RTN","BPSOSIY",107,0)
 . S FDA(FN,VA59IEN_REC,902.06)=$P($G(INPUT(8)),"^",6)            ;CARDHOLDER ID
"RTN","BPSOSIY",108,0)
 . S FDA(FN,VA59IEN_REC,902.07)=$P($G(INPUT(8)),"^",7)            ;PATIENT RELATIONSHIP CODE
"RTN","BPSOSIY",109,0)
 . S FDA(FN,VA59IEN_REC,902.08)=$P($P($G(INPUT(8)),"^",8)," ")    ;CARDHOLDER FIRST NAME
"RTN","BPSOSIY",110,0)
 . S FDA(FN,VA59IEN_REC,902.09)=$P($G(INPUT(8)),"^",9)            ;CARDHOLDER LAST NAME
"RTN","BPSOSIY",111,0)
 . S FDA(FN,VA59IEN_REC,902.11)=$P($G(INPUT(8)),"^",10)           ;HOME PLAN STATE
"RTN","BPSOSIY",112,0)
 . S FDA(FN,VA59IEN_REC,902.18)=$P($G(INPUT(8)),"^",13)           ;Software/Vendor Cert ID
"RTN","BPSOSIY",113,0)
 . S FDA(FN,VA59IEN_REC,902.19)=$P($G(INPUT(8)),"^",11)           ;B2 PAYER SHEET REVERSAL
"RTN","BPSOSIY",114,0)
 . S FDA(FN,VA59IEN_REC,902.21)=$P($G(INPUT(8)),"^",12)           ;B3 PAYER SHEET REBILL
"RTN","BPSOSIY",115,0)
 . S FDA(FN,VA59IEN_REC,902.22)=$P($G(INPUT(8)),"^",16)           ;CERTIFY MODE
"RTN","BPSOSIY",116,0)
 . S FDA(FN,VA59IEN_REC,902.23)=$P($G(INPUT(8)),"^",15)           ;CERTIFICATION IEN TO USE FROM 9002313.31
"RTN","BPSOSIY",117,0)
 . S FDA(FN,VA59IEN_REC,902.24)=$P($G(INPUT(8)),"^",14)           ;PLAN NAME
"RTN","BPSOSIY",118,0)
 . S FDA(FN,VA59IEN_REC,902.12)=$P($G(INPUT(9)),"^",1)            ;DISPENSE FEE
"RTN","BPSOSIY",119,0)
 . S FDA(FN,VA59IEN_REC,902.13)=$P($G(INPUT(9)),"^",2)            ;BASIS OF COST DETERMINATION
"RTN","BPSOSIY",120,0)
 . S FDA(FN,VA59IEN_REC,902.14)=$P($G(INPUT(9)),"^",3)            ;USUAL & CUSTOMARY CHARGE
"RTN","BPSOSIY",121,0)
 . S FDA(FN,VA59IEN_REC,902.15)=$P($G(INPUT(9)),"^",4)            ;GROSS AMOUNT DUE
"RTN","BPSOSIY",122,0)
 . S FDA(FN,VA59IEN_REC,902.16)=$P($G(INPUT(9)),"^",5)            ;ADMINISTRATIVE FEE
"RTN","BPSOSIY",123,0)
 . S FDA(FN,VA59IEN_REC,902.17)=$P($G(INPUT(9)),"^",9)            ;FILL NUMBER
"RTN","BPSOSIY",124,0)
 . S FDA(FN,VA59IEN_REC,902.25)=$P($G(INPUT(10)),"^",1)           ;GROUP NAME
"RTN","BPSOSIY",125,0)
 . S FDA(FN,VA59IEN_REC,902.26)=$P($G(INPUT(10)),"^",2)           ;INSURANCE CO PHONE #
"RTN","BPSOSIY",126,0)
 . S FDA(FN,VA59IEN_REC,902.27)=$P($G(INPUT(10)),"^",3)           ;PHARMACY PLAN IEN
"RTN","BPSOSIY",127,0)
 . ; File the data
"RTN","BPSOSIY",128,0)
 . D FILE^DIE("E","FDA","MSG")
"RTN","BPSOSIY",129,0)
 ;
"RTN","BPSOSIY",130,0)
 ; Store DUR multiple if it exists
"RTN","BPSOSIY",131,0)
 I +$P($G(^BPS(9002313.51,IEN51,4,0)),U,4) D
"RTN","BPSOSIY",132,0)
 . K FDA
"RTN","BPSOSIY",133,0)
 . N DUR,DURREC,IENS
"RTN","BPSOSIY",134,0)
 . S FN=9002313.5913,DUR=0
"RTN","BPSOSIY",135,0)
 . F  S DUR=$O(^BPS(9002313.51,IEN51,4,DUR)) Q:+DUR=0  D
"RTN","BPSOSIY",136,0)
 .. S DURREC=$G(^BPS(9002313.51,IEN51,4,DUR,0))
"RTN","BPSOSIY",137,0)
 .. S IENS="+1,"_REC,IENS(1)=DUR
"RTN","BPSOSIY",138,0)
 .. S FDA(FN,IENS,.01)=$P(DURREC,U,1)  ; DUR Counter
"RTN","BPSOSIY",139,0)
 .. S FDA(FN,IENS,1)=$P(DURREC,U,2)    ; DUR Professional Service Code
"RTN","BPSOSIY",140,0)
 .. S FDA(FN,IENS,2)=$P(DURREC,U,3)    ; DUR Reason for Service Code
"RTN","BPSOSIY",141,0)
 .. S FDA(FN,IENS,3)=$P(DURREC,U,4)    ; DUR Result of Service Code
"RTN","BPSOSIY",142,0)
 . I $D(FDA) D UPDATE^DIE("","FDA","IENS","MSG")
"RTN","BPSOSIY",143,0)
 ;
"RTN","BPSOSIY",144,0)
 S FN=9002313.59 ; SET IT BACK TO ORIGINAL, JUST IN CASE
"RTN","BPSOSIY",145,0)
 K ISTHERE,VA59IEN
"RTN","BPSOSIY",146,0)
 Q $S($D(MSG):0,1:1)
"RTN","BPSOSIY",147,0)
ACTIVEWT(IEN59,IEN51,IEN512) ;EP - from BPSOSIZ
"RTN","BPSOSIY",148,0)
 ; Return 0 = forget about it, don't wait, just skip this one
"RTN","BPSOSIY",149,0)
 ;        1 = yes, wait and check again in several seconds from now
"RTN","BPSOSIY",150,0)
 ;        
"RTN","BPSOSIY",151,0)
 N PROMPT,Y
"RTN","BPSOSIY",152,0)
 ; An opportunity to wait for the active prescription to finish
"RTN","BPSOSIY",153,0)
 ; processing.  Return 1 if you do want to wait; 0 if you do not. 
"RTN","BPSOSIY",154,0)
 I '$G(ECHO) Q 1  ; not interactive, you can't ask - assume YES, wait
"RTN","BPSOSIY",155,0)
 W ?5,"There is currently an active transaction for this item"
"RTN","BPSOSIY",156,0)
 W ".",!
"RTN","BPSOSIY",157,0)
 W ?5,"So this item will be skipped.",! H 1 ; 03/22/2001
"RTN","BPSOSIY",158,0)
 Q 0 ; 03/22/2001
"RTN","BPSOSIY",159,0)
ACWTA S PROMPT="Do you want to wait for the active transaction to finish"
"RTN","BPSOSIY",160,0)
 S Y=$$YESNO^BPSOSU3(PROMPT,"YES",1) W !
"RTN","BPSOSIY",161,0)
 I Y=1 Q 1
"RTN","BPSOSIY",162,0)
 S PROMPT="Do you want to forget about this one"
"RTN","BPSOSIY",163,0)
 S Y=$$YESNO^BPSOSU3(PROMPT,"NO",1) W !
"RTN","BPSOSIY",164,0)
 I Y=1 Q 0
"RTN","BPSOSIY",165,0)
 G ACWTA
"RTN","BPSOSIY",166,0)
RXPREV(IEN,ENTRY)  ; has this item previously been through ECME?
"RTN","BPSOSIY",167,0)
 ; return false if not
"RTN","BPSOSIY",168,0)
 ; return pointer to 9002313.57 if true
"RTN","BPSOSIY",169,0)
 N RXI,RXR,VIS,CPT,INDEX,A,B
"RTN","BPSOSIY",170,0)
 S RXI=$$RXI(IEN,ENTRY)
"RTN","BPSOSIY",171,0)
 I RXI D
"RTN","BPSOSIY",172,0)
 . S RXR=$$RXR(IEN,ENTRY)
"RTN","BPSOSIY",173,0)
 . S INDEX=$S($$NDC(IEN,ENTRY)?1"POSTAGE".E:"POSTAGE",1:"RXIRXR")
"RTN","BPSOSIY",174,0)
 . S A=RXI,B=RXR
"RTN","BPSOSIY",175,0)
 E  D
"RTN","BPSOSIY",176,0)
 . S VIS=$$VIS(IEN,ENTRY)
"RTN","BPSOSIY",177,0)
 . S CPT=$$CPTIEN(IEN,ENTRY)
"RTN","BPSOSIY",178,0)
 . S A=VIS,B=CPT,INDEX="OTHERS"
"RTN","BPSOSIY",179,0)
 Q $O(^BPSTL("NON-FILEMAN",INDEX,A,B,""),-1)
"RTN","BPSOSIY",180,0)
RXPAID(IEN,ENTRY)  ;EP - from BPSOSIZ 
"RTN","BPSOSIY",181,0)
 ; return true if the prescription and fill has a "paid"
"RTN","BPSOSIY",182,0)
 ; status as far as ECME is concerned
"RTN","BPSOSIY",183,0)
 ; A paper claim counts as a ECME "paid" for this purpose
"RTN","BPSOSIY",184,0)
 ; Return 1 = POS, paid
"RTN","BPSOSIY",185,0)
 ; Return 2 = paper
"RTN","BPSOSIY",186,0)
 N N57 S N57=$$RXPREV(IEN,ENTRY)
"RTN","BPSOSIY",187,0)
 I 'N57 Q ""  ; no ECME record of this
"RTN","BPSOSIY",188,0)
 ; If it's a reversal, then our result depends on the reversal:
"RTN","BPSOSIY",189,0)
 ;    Was the reversal accepted?   If so, then No, not paid.
"RTN","BPSOSIY",190,0)
 ;    Was the reversal rejected?   Assume Paid, since we try to
"RTN","BPSOSIY",191,0)
 ;         allow reversals only in the case of a paid original.
"RTN","BPSOSIY",192,0)
 I $$ISREVERS^BPSOS57(N57) Q $S($$REVACC^BPSOS57(N57):0,1:1)
"RTN","BPSOSIY",193,0)
 ; Not a reversal:
"RTN","BPSOSIY",194,0)
 N X S X=$$CATEG^BPSOSUC(N57)
"RTN","BPSOSIY",195,0)
 Q $S(X="E PAYABLE":1,X="PAPER":2,X="E DUPLICATE":3,1:0)
"RTN","BPSOSIY",196,0)
RXI(IEN,ENTRY)     Q $P(^BPS(9002313.51,IEN,2,ENTRY,1),U)
"RTN","BPSOSIY",197,0)
RXR(IEN,ENTRY)     Q $P(^BPS(9002313.51,IEN,2,ENTRY,1),U,2)
"RTN","BPSOSIY",198,0)
VIS(IEN,ENTRY)     Q $P(^BPS(9002313.51,IEN,2,ENTRY,1),U,6)
"RTN","BPSOSIY",199,0)
NDC(IEN,ENTRY)     Q $P(^BPS(9002313.51,IEN,2,ENTRY,0),U,3)
"RTN","BPSOSIY",200,0)
CPTIEN(IEN,ENTRY)  Q $P(^BPS(9002313.51,IEN,2,ENTRY,1),U,8)
"RTN","BPSOSIY",201,0)
WANTREV()         ;EP - from BPSOSIZ 
"RTN","BPSOSIY",202,0)
 Q 0 ; TO BE IMPLEMENTED
"RTN","BPSOSIY",203,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSIZ")
0^177^B56423199
"RTN","BPSOSIZ",1,0)
BPSOSIZ ;BHAM ISC/FCS/DRS/DLF - Filing with .51,.59 ;06/01/2004
"RTN","BPSOSIZ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSIZ",3,0)
 Q
"RTN","BPSOSIZ",4,0)
LOCK() L +^TMP($J,"BPSOSIZ"):300 Q $T
"RTN","BPSOSIZ",5,0)
UNLOCK L -^TMP($J,"BPSOSIZ") Q
"RTN","BPSOSIZ",6,0)
LOCK59() L +^BPST:300 Q $T
"RTN","BPSOSIZ",7,0)
UNLOCK59 L -^BPST Q
"RTN","BPSOSIZ",8,0)
FILE(IEN,ECHO) ;EP - from BPSOSI, BPSOSIV
"RTN","BPSOSIZ",9,0)
 ; <PF1> E was hit - so we make these claims official
"RTN","BPSOSIZ",10,0)
 ; ^BPS(9002313.51,IEN,...) -> 9002313.59 or wherever
"RTN","BPSOSIZ",11,0)
 I '$D(ECHO) S ECHO=1
"RTN","BPSOSIZ",12,0)
 N ENTRY S ENTRY=0
"RTN","BPSOSIZ",13,0)
 N BPSOSQ1 S BPSOSQ1=0 ; set to nonzero if you need background job
"RTN","BPSOSIZ",14,0)
 D DELEMPTY ; delete empty entries from the multiple
"RTN","BPSOSIZ",15,0)
 I '$P($G(^BPS(9002313.51,IEN,2,0)),U,4) D  G FZ
"RTN","BPSOSIZ",16,0)
 . I ECHO W "Nothing entered..."
"RTN","BPSOSIZ",17,0)
 I ECHO W "Submitting claims...",!
"RTN","BPSOSIZ",18,0)
 ; Because of the way that BPS DATA INPUT is setup, there will only 
"RTN","BPSOSIZ",19,0)
 ;   be one entry in the LINE ITEMS multiple.  If there was ever more than one,
"RTN","BPSOSIZ",20,0)
 ;   the entire filing code will need to be rewritten to properly doing locking,
"RTN","BPSOSIZ",21,0)
 ;   resetting, and initializing of the BPS Transactions.
"RTN","BPSOSIZ",22,0)
 ;
"RTN","BPSOSIZ",23,0)
 ; Accordingly, the only way to get DUR to work with the current structure without
"RTN","BPSOSIZ",24,0)
 ;   re-writing this now is to set the DUR multiple into BPS Transaction for each
"RTN","BPSOSIZ",25,0)
 ;   insurance record.
"RTN","BPSOSIZ",26,0)
 ;
"RTN","BPSOSIZ",27,0)
  F  S ENTRY=$O(^BPS(9002313.51,IEN,2,ENTRY)) Q:'ENTRY  D
"RTN","BPSOSIZ",28,0)
 . I ECHO D QUICK51(IEN,ENTRY)
"RTN","BPSOSIZ",29,0)
 . F  Q:$$LOCK  Q:'$$IMPOSS^BPSOSUE("L","RTI","Single-thread filing through BPSOSIZ",,"FILE",$T(+0))
"RTN","BPSOSIZ",30,0)
 . D INSUR(IEN,ENTRY,ECHO)
"RTN","BPSOSIZ",31,0)
 . D FILE1(IEN,ENTRY,ECHO)
"RTN","BPSOSIZ",32,0)
 . D UNLOCK
"RTN","BPSOSIZ",33,0)
 ; start background job if necessary
"RTN","BPSOSIZ",34,0)
 I BPSOSQ1 D TASK
"RTN","BPSOSIZ",35,0)
FZ I ECHO W "...done.",! H 2
"RTN","BPSOSIZ",36,0)
 Q
"RTN","BPSOSIZ",37,0)
TASK ;EP - from BPSOS2D,BPSOS6D,BPSOSQ1,BPSOSQ4,BPSOSU
"RTN","BPSOSIZ",38,0)
 N BPSQQQT
"RTN","BPSOSIZ",39,0)
 S BPSQQQT=0
"RTN","BPSOSIZ",40,0)
 D
"RTN","BPSOSIZ",41,0)
 . N CHECK
"RTN","BPSOSIZ",42,0)
 . S CHECK=$G(^BPSECP("CHECKTIM"))  ;last submittal time
"RTN","BPSOSIZ",43,0)
 . S:$$FMDIFF^XLFDT($$NOW^XLFDT,CHECK,2)'>2 BPSQQQT=1
"RTN","BPSOSIZ",44,0)
 Q:BPSQQQT
"RTN","BPSOSIZ",45,0)
 S ^BPSECP("CHECKTIM")=$$NOW^XLFDT
"RTN","BPSOSIZ",46,0)
 ;
"RTN","BPSOSIZ",47,0)
 ;IHS/SD/lwj 11/03/02  end changes
"RTN","BPSOSIZ",48,0)
 ;
"RTN","BPSOSIZ",49,0)
 N X,Y,%DT
"RTN","BPSOSIZ",50,0)
 S X="N",%DT="ST" D ^%DT
"RTN","BPSOSIZ",51,0)
 D TASKAT(Y)
"RTN","BPSOSIZ",52,0)
 Q
"RTN","BPSOSIZ",53,0)
TASKAT(ZTDTH)         ;EP - from above and from BPSOSQS
"RTN","BPSOSIZ",54,0)
 N ZTRTN,ZTIO
"RTN","BPSOSIZ",55,0)
 S ZTRTN="LOOP^BPSOSQ1",ZTIO=""
"RTN","BPSOSIZ",56,0)
 D ^%ZTLOAD
"RTN","BPSOSIZ",57,0)
 Q
"RTN","BPSOSIZ",58,0)
DELEMPTY ; the multiple probably has some empty entries - delete them
"RTN","BPSOSIZ",59,0)
 ; IEN is inherited from caller
"RTN","BPSOSIZ",60,0)
 N FDA,MSG,FN,ENTRY S FN=9002313.512,ENTRY=0
"RTN","BPSOSIZ",61,0)
 F  S ENTRY=$O(^BPS(9002313.51,IEN,2,ENTRY)) Q:'ENTRY  D
"RTN","BPSOSIZ",62,0)
 . N X,Y S X=^BPS(9002313.51,IEN,2,ENTRY,0),Y=$G(^(1))
"RTN","BPSOSIZ",63,0)
 . I X?1N.N."^",Y?."^" D  ; see Note 1, below
"RTN","BPSOSIZ",64,0)
 . . S FDA(FN,ENTRY_","_IEN_",",.01)=""
"RTN","BPSOSIZ",65,0)
 Q:'$D(FDA)  ; nothing to delete
"RTN","BPSOSIZ",66,0)
D5 D FILE^DIE("","FDA","MSG")
"RTN","BPSOSIZ",67,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSIZ",68,0)
 D ZWRITE^BPSOS("FDA","MSG")
"RTN","BPSOSIZ",69,0)
 G D5:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"DELEMPTY",$T(+0))
"RTN","BPSOSIZ",70,0)
 Q
"RTN","BPSOSIZ",71,0)
 ; Note 1.  In DELEMPTY, the test for an empty node:
"RTN","BPSOSIZ",72,0)
 ;  piece 1 is the entry number, uneditable, ?1N.N
"RTN","BPSOSIZ",73,0)
 ;  pieces 2ff may be present but null - apparently, just visiting
"RTN","BPSOSIZ",74,0)
 ;   a field (e.g., pressing down arrow from NDC number)
"RTN","BPSOSIZ",75,0)
 ; And also need to test for no fields in the ^(1) node ; 09/21/2000
"RTN","BPSOSIZ",76,0)
 ;   could lead to filling in some empty values)
"RTN","BPSOSIZ",77,0)
INSUR(IEN,ENTRY,ECHO)        ; ^BPS(9002313.51,IEN,2,ENTRY,"I",*)
"RTN","BPSOSIZ",78,0)
 ; need to move it into ^BPS(9002313.51,IEN,2,ENTRY,6)=PINS data
"RTN","BPSOSIZ",79,0)
 ; and ^BPS(9002313.51,IEN,2,ENTRY,7)=insurer IENs
"RTN","BPSOSIZ",80,0)
 N N S N=0 F  S N=$O(^BPS(9002313.51,IEN,2,ENTRY,"I",N)) Q:'N  D
"RTN","BPSOSIZ",81,0)
 . N X S X=^BPS(9002313.51,IEN,2,ENTRY,"I",N,0)
"RTN","BPSOSIZ",82,0)
 . I $P(X,U,2) D  ; ORDER is given
"RTN","BPSOSIZ",83,0)
 . . N ORDER S ORDER=$P(X,U,2)
"RTN","BPSOSIZ",84,0)
 . . S $P(^BPS(9002313.51,IEN,2,ENTRY,6),U,ORDER)=$P(X,U,4) ; PINS
"RTN","BPSOSIZ",85,0)
 . . S $P(^BPS(9002313.51,IEN,2,ENTRY,7),U,ORDER)=$P(X,U,3) ;ins ien
"RTN","BPSOSIZ",86,0)
 ; Delete the entire INS SEL SCRATCH field - it's no longer needed
"RTN","BPSOSIZ",87,0)
 K ^BPS(9002313.51,IEN,2,ENTRY,"I")
"RTN","BPSOSIZ",88,0)
 Q
"RTN","BPSOSIZ",89,0)
FILE1(IEN,ENTRY,ECHO)   ; ^BPS(9002313.51,IEN,2,ENTRY,...)
"RTN","BPSOSIZ",90,0)
 N INPUT M INPUT=^BPS(9002313.51,IEN,2,ENTRY) ; convenience
"RTN","BPSOSIZ",91,0)
 N ORIGIN S ORIGIN=$P(^BPS(9002313.51,IEN,0),U,3)
"RTN","BPSOSIZ",92,0)
 N X S X=$P(INPUT(0),U,2)
"RTN","BPSOSIZ",93,0)
 D REMAP
"RTN","BPSOSIZ",94,0)
 D FILERX
"RTN","BPSOSIZ",95,0)
 Q
"RTN","BPSOSIZ",96,0)
REMAP ; do any needed adjusing of INPUT(*) to handle postage, supplies, etc.
"RTN","BPSOSIZ",97,0)
 Q
"RTN","BPSOSIZ",98,0)
ISRX() ; return pointer to ^PSRX if true, else return ""
"RTN","BPSOSIZ",99,0)
 N X S X=$P(INPUT(1),U) I 'X Q ""
"RTN","BPSOSIZ",100,0)
 I $P(INPUT(0),U,3)?1"POSTAGE".E Q ""
"RTN","BPSOSIZ",101,0)
 Q X
"RTN","BPSOSIZ",102,0)
ISPOST() ; return pointer to ^PSRX if true, else return ""
"RTN","BPSOSIZ",103,0)
 N X S X=$P(INPUT(1),U) I 'X Q ""
"RTN","BPSOSIZ",104,0)
 I $P(INPUT(0),U,3)?1"POSTAGE".E Q X
"RTN","BPSOSIZ",105,0)
 Q ""
"RTN","BPSOSIZ",106,0)
ISVISIT() ; return pointer to visit if true, else return ""
"RTN","BPSOSIZ",107,0)
 ; (this is for non-prescription items)
"RTN","BPSOSIZ",108,0)
 N X S X=$P(INPUT(1),U) I X Q "" ; has ^PSRX pointer, so ret false
"RTN","BPSOSIZ",109,0)
 Q $P(INPUT(1),U,6)
"RTN","BPSOSIZ",110,0)
FILERX ; EVERYTHING is filed here: postage, supplies, as well as RX's
"RTN","BPSOSIZ",111,0)
 ;
"RTN","BPSOSIZ",112,0)
 ;  If it's being actively processed now, do not allow it to be
"RTN","BPSOSIZ",113,0)
 ;  submitted again here.
"RTN","BPSOSIZ",114,0)
 ;
"RTN","BPSOSIZ",115,0)
 N DEBUG S DEBUG=0
"RTN","BPSOSIZ",116,0)
 N IEN59 S IEN59=$$IEN59^BPSOSIY
"RTN","BPSOSIZ",117,0)
RXA I $$ACTIVE59(IEN59) Q:'$$ACTIVEWT^BPSOSIY(IEN59,IEN,ENTRY)  D  G RXA
"RTN","BPSOSIZ",118,0)
 . D UNLOCK H 30
"RTN","BPSOSIZ",119,0)
 . F  Q:$$LOCK  Q:'$$IMPOSS^BPSOSUE("L","RTI","LOCK transaction record for IEN59="_IEN59,,"RXA",$T(+0))
"RTN","BPSOSIZ",120,0)
 N X
"RTN","BPSOSIZ",121,0)
 ;
"RTN","BPSOSIZ",122,0)
 ;  If it's been submitted in the past, 
"RTN","BPSOSIZ",123,0)
 ;    mention that fact and look at what happened to it.
"RTN","BPSOSIZ",124,0)
 ;  case 1:   Payable    or   Duplicate of a paid claim   or  Paper
"RTN","BPSOSIZ",125,0)
 ;     Invite a reversal
"RTN","BPSOSIZ",126,0)
 ;
"RTN","BPSOSIZ",127,0)
 ;   NOTE  for the indefinite interim:
"RTN","BPSOSIZ",128,0)
 ;       We don't yet have it set up to invite an easy reversal here.
"RTN","BPSOSIZ",129,0)
 ;       We are letting paper claims go through and be resubmitted.
"RTN","BPSOSIZ",130,0)
 ;
"RTN","BPSOSIZ",131,0)
 ;  case 2:   Not paid
"RTN","BPSOSIZ",132,0)
 ;     Allow it to be submitted again here.
"RTN","BPSOSIZ",133,0)
 ;
"RTN","BPSOSIZ",134,0)
 S X=$$RXPAID^BPSOSIY(IEN,ENTRY) I X D  I X=1!(X=3) Q
"RTN","BPSOSIZ",135,0)
 . I X=1!(X=3) D
"RTN","BPSOSIZ",136,0)
 .. D LOG59^BPSOSL($T(+0)_" - Skipping: RXPAID^BPSOSIY returned "_X,IEN59)
"RTN","BPSOSIZ",137,0)
 .. N A,B
"RTN","BPSOSIZ",138,0)
 .. S A=$$RXI^BPSOSIY(IEN,ENTRY)
"RTN","BPSOSIZ",139,0)
 .. I A S B=$$RXR^BPSOSIY(IEN,ENTRY) I B]"" K ^XTMP("BPSOSRX",A,B)
"RTN","BPSOSIZ",140,0)
 . I '$G(ECHO) Q  ; not interactive, so just skip it
"RTN","BPSOSIZ",141,0)
 . W ?5,"This claim has already been submitted.",!
"RTN","BPSOSIZ",142,0)
 . I X=1!(X=3) D
"RTN","BPSOSIZ",143,0)
 . . W ?5,"It was an electronic claim and it was "
"RTN","BPSOSIZ",144,0)
 . . W $S(X=1:"paid",X=3:"captured."),!
"RTN","BPSOSIZ",145,0)
 . I X=2 D
"RTN","BPSOSIZ",146,0)
 . . W ?5,"It was flagged to be sent on a paper claim.",!
"RTN","BPSOSIZ",147,0)
 . . W ?5,"It will be processed again, as if it had been reversed.",!
"RTN","BPSOSIZ",148,0)
 . I X=1 D
"RTN","BPSOSIZ",149,0)
 . . W ?5,"You must first reverse the original claim,",!
"RTN","BPSOSIZ",150,0)
 . . W ?5,"and then resubmit it.  RES will do it all for you.",!
"RTN","BPSOSIZ",151,0)
 . D PRESSANY^BPSOSU5() ; $$WANTREV^BPSOSIY not yet implemented
"RTN","BPSOSIZ",152,0)
 ;
"RTN","BPSOSIZ",153,0)
 ; Not active, not submitted in the past - SUBMIT IT NOW
"RTN","BPSOSIZ",154,0)
 ; Create a .59 entry, fill in the pieces
"RTN","BPSOSIZ",155,0)
 ;
"RTN","BPSOSIZ",156,0)
L59A I '$$LOCK59 G L59A:$$IMPOSS^BPSOSUE("L","RTI","LOCK transaction for IEN59="_IEN59,,"L59A",$T(+0))
"RTN","BPSOSIZ",157,0)
 I $$EXIST59(IEN59) D
"RTN","BPSOSIZ",158,0)
 . D CLEAR59(IEN59)
"RTN","BPSOSIZ",159,0)
 E  D
"RTN","BPSOSIZ",160,0)
L59N . I $$NEW59(IEN59)'=IEN59 G L59N:$$IMPOSS^BPSOSUE("FM,DB,P","RTI","init new transaction record for IEN59="_IEN59,,"L59N",$T(+0))
"RTN","BPSOSIZ",161,0)
 I $$SETUP59^BPSOSIY(IEN,IEN59,ORIGIN) S BPSOSQ1=BPSOSQ1+1
"RTN","BPSOSIZ",162,0)
 D UNLOCK59
"RTN","BPSOSIZ",163,0)
 Q
"RTN","BPSOSIZ",164,0)
EXIST59(N)         ;
"RTN","BPSOSIZ",165,0)
 N X
"RTN","BPSOSIZ",166,0)
 S X=$$FIND1^DIC(9002313.59,,"QX","`"_N)
"RTN","BPSOSIZ",167,0)
 Q $S(X>0:X,X=0:0)
"RTN","BPSOSIZ",168,0)
NEW59(N) ; send N = desired IEN in file 9002313.59
"RTN","BPSOSIZ",169,0)
 N FLAGS,FDA,IEN,MSG,X,FN
"RTN","BPSOSIZ",170,0)
 S FLAGS="" ; internal values
"RTN","BPSOSIZ",171,0)
 N X S X="+1,"
"RTN","BPSOSIZ",172,0)
 S FN=9002313.59
"RTN","BPSOSIZ",173,0)
 S (IEN(1),FDA(FN,X,.01))=N
"RTN","BPSOSIZ",174,0)
 D UPDATE^DIE(FLAGS,"FDA","IEN","MSG")
"RTN","BPSOSIZ",175,0)
 I $D(MSG) Q 0
"RTN","BPSOSIZ",176,0)
 Q IEN(1)
"RTN","BPSOSIZ",177,0)
CLEAR59(N)         ;
"RTN","BPSOSIZ",178,0)
 ; Deletes all values except for fields:
"RTN","BPSOSIZ",179,0)
 ;   Entry # (.01)
"RTN","BPSOSIZ",180,0)
 ;   Resubmit after reversal (1.12)
"RTN","BPSOSIZ",181,0)
 ;   Result Text (202)
"RTN","BPSOSIZ",182,0)
 ;   Comments (111 multiple)
"RTN","BPSOSIZ",183,0)
 ; If reverse/resubmit), then also do not clear fields:
"RTN","BPSOSIZ",184,0)
 ;   Status (1)
"RTN","BPSOSIZ",185,0)
 ;   Last Update (7)
"RTN","BPSOSIZ",186,0)
 ;   Start Date (15)
"RTN","BPSOSIZ",187,0)
 N FN,X,FLAGS,FDA,MSG,FIELD,SKIP
"RTN","BPSOSIZ",188,0)
 S FN=9002313.59,X=N_",",FLAGS=""
"RTN","BPSOSIZ",189,0)
 S SKIP(1.12)="",SKIP(202)=""
"RTN","BPSOSIZ",190,0)
 I $G(MOREDATA("REVERSE THEN RESUBMIT"))=1 S SKIP(1)="",SKIP(7)="",SKIP(15)=""
"RTN","BPSOSIZ",191,0)
 S FIELD=.01 ; $O will skip past this field
"RTN","BPSOSIZ",192,0)
 F  S FIELD=$O(^DD(FN,FIELD)) Q:'FIELD  I '$D(SKIP(FIELD)) S FDA(FN,X,FIELD)=""
"RTN","BPSOSIZ",193,0)
 ; Delete Insurance multiple
"RTN","BPSOSIZ",194,0)
 S FN=9002313.59902,ENTRY=0
"RTN","BPSOSIZ",195,0)
 F  S ENTRY=$O(^BPST(N,10,ENTRY)) Q:ENTRY="B"!(ENTRY="")  D
"RTN","BPSOSIZ",196,0)
 . S FDA(FN,ENTRY_","_N_",",.01)=""
"RTN","BPSOSIZ",197,0)
 ; Delete DUR multiple
"RTN","BPSOSIZ",198,0)
 S FN=9002313.5913,ENTRY=0
"RTN","BPSOSIZ",199,0)
 F  S ENTRY=$O(^BPST(N,13,ENTRY)) Q:+ENTRY=0  D
"RTN","BPSOSIZ",200,0)
 . S FDA(FN,ENTRY_","_N_",",.01)=""
"RTN","BPSOSIZ",201,0)
 D FILE^DIE(FLAGS,"FDA","MSG")
"RTN","BPSOSIZ",202,0)
 D PREVISLY(N) ; for result text field 202
"RTN","BPSOSIZ",203,0)
 Q
"RTN","BPSOSIZ",204,0)
PREVISLY(IEN59)    ;EP ; Bracket result text with [Previously: ], if not null
"RTN","BPSOSIZ",205,0)
 ; Called by REVERSE^BPSOS6D, too
"RTN","BPSOSIZ",206,0)
 N X S X=$$GET1^DIQ(9002313.59,IEN59,202)
"RTN","BPSOSIZ",207,0)
 Q:X=""
"RTN","BPSOSIZ",208,0)
 S X=$E("[Previously: "_X_"]",1,200)
"RTN","BPSOSIZ",209,0)
 N FN,FDA,MSG S FDA(9002313.59,IEN59_",",202)=X
"RTN","BPSOSIZ",210,0)
PR5 D FILE^DIE("","FDA","MSG") Q:'$D(MSG)
"RTN","BPSOSIZ",211,0)
 D ZWRITE^BPSOS("FDA","MSG","IEN59","X")
"RTN","BPSOSIZ",212,0)
 G PR5:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"PREVISLY",$T(+0))
"RTN","BPSOSIZ",213,0)
 Q
"RTN","BPSOSIZ",214,0)
ACTIVE59(N)        ; is ^BPST(N) active now?
"RTN","BPSOSIZ",215,0)
 F  Q:$$LOCK59  Q:'$$IMPOSS^BPSOSUE("L","RTI","LOCK of transaction for IEN59="_IEN59,,"ACTIVE59",$T(+0))
"RTN","BPSOSIZ",216,0)
 N Z S Z=$G(^BPST(N,0))
"RTN","BPSOSIZ",217,0)
 D UNLOCK59
"RTN","BPSOSIZ",218,0)
 I Z="" Q 0 ; easy - there's no such record
"RTN","BPSOSIZ",219,0)
 I $P(Z,U,2)=99 Q 0 ; status = complete
"RTN","BPSOSIZ",220,0)
 I $$TIMEDIFI^BPSOSUD($P(Z,U,8),$$NOW)>604800 Q 0  ; Must have been stranded over a week?  Let it through.
"RTN","BPSOSIZ",221,0)
 Q 1 ; status not complete
"RTN","BPSOSIZ",222,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSIZ",223,0)
QUICK51(IEN,ENTRY)          ; ^BPS(9002313.51,IEN,2,ENTRY,...)
"RTN","BPSOSIZ",224,0)
 N X
"RTN","BPSOSIZ",225,0)
 S X=^BPS(9002313.51,IEN,2,ENTRY,0)
"RTN","BPSOSIZ",226,0)
 W $P(X,U,4)," ",$P(X,U,2)," ",$P(X,U,5)," ",$P(X,U,7),!
"RTN","BPSOSIZ",227,0)
 W !
"RTN","BPSOSIZ",228,0)
 Q
"RTN","BPSOSJ1")
1^178
"RTN","BPSOSK")
0^179^B22965328
"RTN","BPSOSK",1,0)
BPSOSK ;BHAM ISC/FCS/DRS/DLF - winnow ECME data ;06/01/2004
"RTN","BPSOSK",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSK",3,0)
 Q
"RTN","BPSOSK",4,0)
SILENT(LOGSONLY) ;EP - do it silently, as in taskmanned task
"RTN","BPSOSK",5,0)
 ; $G(LOGSONLY)=1 if you are winnowing log files only.
"RTN","BPSOSK",6,0)
 ; Invoked sporadically at random from transaction completion in BPSOSU
"RTN","BPSOSK",7,0)
 N SILENT S SILENT=1
"RTN","BPSOSK",8,0)
MAIN ;EP - show progress
"RTN","BPSOSK",9,0)
 L +^TMP($J,$T(+0)):0 Q:'$T  ; only one winnower at a time
"RTN","BPSOSK",10,0)
 ; (this protects against the case where two or more of these happen
"RTN","BPSOSK",11,0)
 ;  to be scheduled at random throughout the day)
"RTN","BPSOSK",12,0)
 D  ; log files
"RTN","BPSOSK",13,0)
 . N X S X=$G(^BPS(9002313.99,1,"WINNOW LOGS"))
"RTN","BPSOSK",14,0)
 . D INIT^BPSOSL(DT+.5,1)
"RTN","BPSOSK",15,0)
 . S X=DT+.5_U_$P(X,U,1,9) ; shift old down one spot and put new in
"RTN","BPSOSK",16,0)
 . S ^BPS(9002313.99,1,"WINNOW LOGS")=X
"RTN","BPSOSK",17,0)
 ; NEW the vars commonly used
"RTN","BPSOSK",18,0)
 N IEN,AGE,BILLSYS,TESTING,ISILCAR,NENTRIES,OLDPCT,COUNT
"RTN","BPSOSK",19,0)
 S ISILCAR=$$ISILCAR^BPSOSB ; some algorithms vary if you have ILC A/R
"RTN","BPSOSK",20,0)
 D AGES ; set AGE(field name)=value
"RTN","BPSOSK",21,0)
 D BILLSYS ; set BILLSYS=which billing system interface (internal)
"RTN","BPSOSK",22,0)
 S TESTING=$P($G(^BPS(9002313.99,1,"WINNOW TESTING")),U)
"RTN","BPSOSK",23,0)
 I TESTING D LOG("Just testing; nothing will actually be deleted.")
"RTN","BPSOSK",24,0)
 E  D LOG("This is for real; we may really delete some data.")
"RTN","BPSOSK",25,0)
 ; The order of these files is important!  Certain things won't be
"RTN","BPSOSK",26,0)
 ; deleted if the things pointed to them are still around.
"RTN","BPSOSK",27,0)
 I $G(LOGSONLY) G LOGS
"RTN","BPSOSK",28,0)
 D LOGHDG(9002313.57),INIFOR(9002313.57)
"RTN","BPSOSK",29,0)
 D 57 ; 9002313.57 Billing
"RTN","BPSOSK",30,0)
 D LOGHDG(9002313.59),INIFOR(9002313.59)
"RTN","BPSOSK",31,0)
 D 59 ; 9002313.59 Working
"RTN","BPSOSK",32,0)
 D LOGHDG(9002313.03),INIFOR(9002313.03)
"RTN","BPSOSK",33,0)
 D 03 ; 9002313.03 Responses
"RTN","BPSOSK",34,0)
 D LOGHDG(9002313.02),INIFOR(9002313.02)
"RTN","BPSOSK",35,0)
 D 02 ; 9002313.02 Claims
"RTN","BPSOSK",36,0)
 D LOGHDG(9002313.51),INIFOR(9002313.51)
"RTN","BPSOSK",37,0)
 D 51 ; 9002313.51 Input
"RTN","BPSOSK",38,0)
 D LOGHDG(9002313.511),INIFOR(9002313.511)
"RTN","BPSOSK",39,0)
 D 511 ; 9002313.511 Override
"RTN","BPSOSK",40,0)
 D LOGHDG("COMBINS"),INIFOR(9002313.1)
"RTN","BPSOSK",41,0)
 D COMBINS ; combined insurance
"RTN","BPSOSK",42,0)
LOGS D LOGHDG("LOG FILES"),INIFOR("LOG FILES")
"RTN","BPSOSK",43,0)
 D LOGFILES ; Log files in ^BPSECP("LOG",
"RTN","BPSOSK",44,0)
 D RELSLOT^BPSOSL
"RTN","BPSOSK",45,0)
 L -^TMP($J,$T(+0))
"RTN","BPSOSK",46,0)
 Q
"RTN","BPSOSK",47,0)
INIFOR(F)          ;
"RTN","BPSOSK",48,0)
 S COUNT=0,OLDPCT=""
"RTN","BPSOSK",49,0)
 I +F=F D
"RTN","BPSOSK",50,0)
 . I F=9002313.02 S NENTRIES=$P(^BPSC(0),U,4)
"RTN","BPSOSK",51,0)
 . E  I F=9002313.03 S NENTRIES=$P(^BPSR(0),U,4)
"RTN","BPSOSK",52,0)
 . E  I F=9002313.1 S NENTRIES=$P(^BPSCOMB(0),U,4)
"RTN","BPSOSK",53,0)
 . E  S NENTRIES=$P(^BPS(F,0),U,4)
"RTN","BPSOSK",54,0)
 E  D
"RTN","BPSOSK",55,0)
 . ; note: percentages will be off for the log files
"RTN","BPSOSK",56,0)
 . I F="LOG FILES" S NENTRIES=$P(^BPSECP("LOG","LAST SLOT"),U)
"RTN","BPSOSK",57,0)
 Q
"RTN","BPSOSK",58,0)
LOGHDG(FILE)       ;
"RTN","BPSOSK",59,0)
 N X ;
"RTN","BPSOSK",60,0)
 D LOGLINES
"RTN","BPSOSK",61,0)
 I FILE="COMBINS" S FILE=9002313.1 ; renumbered since original rou
"RTN","BPSOSK",62,0)
 I +FILE=FILE D
"RTN","BPSOSK",63,0)
 . S X="Winnowing file "_FILE_": "_$P(^DIC(FILE,0),U)
"RTN","BPSOSK",64,0)
 E  D
"RTN","BPSOSK",65,0)
 . I FILE="LOG FILES" S X="Winnowing "_FILE
"RTN","BPSOSK",66,0)
 D LOG(X)
"RTN","BPSOSK",67,0)
 D LOGLINES
"RTN","BPSOSK",68,0)
 Q
"RTN","BPSOSK",69,0)
 ; Instead of going by indexes, just scan the entire file.
"RTN","BPSOSK",70,0)
 ; There may be some without the date field set, for example.
"RTN","BPSOSK",71,0)
 ; We don't want those hanging around forever.
"RTN","BPSOSK",72,0)
 ;
"RTN","BPSOSK",73,0)
03 ; 9002313.03 Responses
"RTN","BPSOSK",74,0)
 S IEN=0 F  S IEN=$O(^BPSR(IEN)) Q:'IEN  D 03^BPSOSK1,PCT
"RTN","BPSOSK",75,0)
 D LOGDONE
"RTN","BPSOSK",76,0)
 Q
"RTN","BPSOSK",77,0)
02 ; 9002313.02 Claims
"RTN","BPSOSK",78,0)
 S IEN=0 F  S IEN=$O(^BPSC(IEN)) Q:'IEN  D 02^BPSOSK1,PCT
"RTN","BPSOSK",79,0)
 D LOGDONE
"RTN","BPSOSK",80,0)
 Q
"RTN","BPSOSK",81,0)
51 ; 9002313.51 Input
"RTN","BPSOSK",82,0)
 S IEN=0 F  S IEN=$O(^BPS(9002313.51,IEN)) Q:'IEN  D 51^BPSOSK1,PCT
"RTN","BPSOSK",83,0)
 D LOGDONE
"RTN","BPSOSK",84,0)
 Q
"RTN","BPSOSK",85,0)
511 ; 9002313.511 Override
"RTN","BPSOSK",86,0)
 S IEN=0
"RTN","BPSOSK",87,0)
 F  S IEN=$O(^BPS(9002313.511,IEN)) Q:'IEN  D 511^BPSOSK1,PCT
"RTN","BPSOSK",88,0)
 D LOGDONE
"RTN","BPSOSK",89,0)
 Q
"RTN","BPSOSK",90,0)
57 ; 9002313.57 Billing
"RTN","BPSOSK",91,0)
 S IEN=0 F  S IEN=$O(^BPSTL(IEN)) Q:'IEN  D 57^BPSOSK1,PCT
"RTN","BPSOSK",92,0)
 D LOG("Fixing 9002313.57 indexes...") D FIX57IDX^BPSOSK2
"RTN","BPSOSK",93,0)
 D LOGDONE
"RTN","BPSOSK",94,0)
 Q
"RTN","BPSOSK",95,0)
59 ; 9002313.59 Working
"RTN","BPSOSK",96,0)
 S IEN=0 F  S IEN=$O(^BPST(IEN)) Q:'IEN  D 59^BPSOSK1,PCT
"RTN","BPSOSK",97,0)
 D LOGDONE
"RTN","BPSOSK",98,0)
 Q
"RTN","BPSOSK",99,0)
LOGFILES ; ^BPSECP("LOG",
"RTN","BPSOSK",100,0)
 S IEN=0
"RTN","BPSOSK",101,0)
 F  S IEN=$O(^BPSECP("LOG",IEN)) Q:'IEN  D LOGFILES^BPSOSK1,PCT
"RTN","BPSOSK",102,0)
 D LOGDONE
"RTN","BPSOSK",103,0)
 Q
"RTN","BPSOSK",104,0)
COMBINS ; ^BPSCOMB(
"RTN","BPSOSK",105,0)
 ; Our ECME combined insurance can be winnowed because
"RTN","BPSOSK",106,0)
 ; we don't keep any pointers to combined insurance.
"RTN","BPSOSK",107,0)
 ; This is different in A/R, I think.
"RTN","BPSOSK",108,0)
 S IEN=0
"RTN","BPSOSK",109,0)
 F  S IEN=$O(^BPSCOMB(IEN)) Q:'IEN  D COMBINS^BPSOSK1,PCT
"RTN","BPSOSK",110,0)
 D LOGDONE
"RTN","BPSOSK",111,0)
 Q
"RTN","BPSOSK",112,0)
PCT Q:'NENTRIES  Q:$G(SILENT)  S COUNT=COUNT+1
"RTN","BPSOSK",113,0)
 N X S X=COUNT/NENTRIES*100+.5\1 S:X=101 X=100
"RTN","BPSOSK",114,0)
 I X'=OLDPCT W @IOBS,@IOBS,@IOBS,@IOBS,@IOBS,$J(X,3),"% " S OLDPCT=X
"RTN","BPSOSK",115,0)
 Q
"RTN","BPSOSK",116,0)
LOGDONE D LOG("Done with this part.") Q
"RTN","BPSOSK",117,0)
LOG(X) D LOG^BPSOSL(X)
"RTN","BPSOSK",118,0)
 I '$G(SILENT) U $P W X,!
"RTN","BPSOSK",119,0)
 Q
"RTN","BPSOSK",120,0)
LOGLINES N X S X=$J("",60),X=$TR(X," ","=") D LOG(X) Q
"RTN","BPSOSK",121,0)
GET99(FIELD)       ; ^BPS(9002313.99,1,"WINNOWING")
"RTN","BPSOSK",122,0)
 ; field numbers #2341.nn
"RTN","BPSOSK",123,0)
AGES ; set AGE(field name) = value for field numbers 2341.nn
"RTN","BPSOSK",124,0)
 I $G(^BPS(9002313.99,1,"WINNOW"))?."^" D
"RTN","BPSOSK",125,0)
 . ; Set some defaults if nothing has been explicitly set.
"RTN","BPSOSK",126,0)
 . N X S X="400^100^100^100^31^366^31^366^100^100^366^0"
"RTN","BPSOSK",127,0)
 . S ^BPS(9002313.99,1,"WINNOW")=X
"RTN","BPSOSK",128,0)
 N FIELD S FIELD=2341
"RTN","BPSOSK",129,0)
 F  S FIELD=$O(^DD(9002313.99,FIELD)) Q:FIELD'<2342  Q:'FIELD  D
"RTN","BPSOSK",130,0)
 . N NAME,DEST D FIELD^DID(9002313.99,FIELD,,"LABEL","DEST")
"RTN","BPSOSK",131,0)
 . S NAME=$G(DEST("LABEL"))
"RTN","BPSOSK",132,0)
 . I NAME="" D
"RTN","BPSOSK",133,0)
 . . D ZWRITE^BPSOS("FIELD","DEST")
"RTN","BPSOSK",134,0)
 . . D IMPOSS^BPSOSUE("FM","TI","FIELD^DID(9002313.99 failed on field "_FIELD,,"AGES",$T(+0))
"RTN","BPSOSK",135,0)
 . N VALUE S VALUE=$$GET1^DIQ(9002313.99,"1,",FIELD)
"RTN","BPSOSK",136,0)
 . I VALUE="" S VALUE=365+365+366 ; 3 years
"RTN","BPSOSK",137,0)
 . S AGE(NAME)=VALUE
"RTN","BPSOSK",138,0)
 . D LOG("AGE("_NAME_")="_VALUE)
"RTN","BPSOSK",139,0)
 Q
"RTN","BPSOSK",140,0)
BILLSYS ; set BILLSYS= which billing system you're interfacing to
"RTN","BPSOSK",141,0)
 S BILLSYS=$$GET1^DIQ(9002313.99,"1,",170.01)
"RTN","BPSOSK",142,0)
 D LOG("BILLSYS="_BILLSYS)
"RTN","BPSOSK",143,0)
 Q
"RTN","BPSOSK1")
0^180^B53524934
"RTN","BPSOSK1",1,0)
BPSOSK1 ;BHAM ISC/FCS/DRS/DLF - winnow ECME data ;06/01/2004
"RTN","BPSOSK1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSK1",3,0)
 Q
"RTN","BPSOSK1",4,0)
03 ;EP -  9002313.03 Responses
"RTN","BPSOSK1",5,0)
 N X,CLAIM,RECD S X=^BPSR(IEN,0),CLAIM=$P(X,U),RECD=$P(X,U,2)
"RTN","BPSOSK1",6,0)
 I 'AGE("WINNOW .03 RAW DATA") S AGE("WINNOW .03 RAW DATA")=30
"RTN","BPSOSK1",7,0)
 I 'AGE("WINNOW .03 CONTENTS") S AGE("WINNOW .03 CONTENTS")=366
"RTN","BPSOSK1",8,0)
 ; The raw copy of the packet doesn't have to be kept around very 
"RTN","BPSOSK1",9,0)
 ; long - it's only there for diagnostic purposes; rarely used.
"RTN","BPSOSK1",10,0)
 I $$AGE(RECD)>AGE("WINNOW .03 RAW DATA") D
"RTN","BPSOSK1",11,0)
 . I $D(^BPSR(IEN,"M")) D DELFIELD(9002313.03,IEN,9999)
"RTN","BPSOSK1",12,0)
 ; The contents should stick around awhile longer.
"RTN","BPSOSK1",13,0)
 ; In addition, if we're using the A/R interface, also require
"RTN","BPSOSK1",14,0)
 ; that the charge have been posted and that the bill have
"RTN","BPSOSK1",15,0)
 ; a zero balance.
"RTN","BPSOSK1",16,0)
 I ISILCAR,'$$CLOSED02(CLAIM) Q
"RTN","BPSOSK1",17,0)
 I $$PT5759(3) Q  ; no delete if pointed to by transaction
"RTN","BPSOSK1",18,0)
 I $$AGE02(CLAIM)>AGE("WINNOW .03 CONTENTS") D DELETE(9002313.03,IEN)
"RTN","BPSOSK1",19,0)
 Q
"RTN","BPSOSK1",20,0)
02 ;EP -  9002313.02 Claims
"RTN","BPSOSK1",21,0)
 ; Use the transmit date if it's there; otherwise the create date.
"RTN","BPSOSK1",22,0)
 I 'AGE("WINNOW .02 RAW DATA") S AGE("WINNOW .02 RAW DATA")=30
"RTN","BPSOSK1",23,0)
 I 'AGE("WINNOW .02 CONTENTS") S AGE("WINNOW .02 CONTENTS")=366
"RTN","BPSOSK1",24,0)
 ; Raw copy of the packet can be short-lived
"RTN","BPSOSK1",25,0)
 I $$AGE02(IEN)>AGE("WINNOW .02 RAW DATA") D
"RTN","BPSOSK1",26,0)
 . I $D(^BPSC(IEN,"M")) D DELFIELD(9002313.02,IEN,9999)
"RTN","BPSOSK1",27,0)
 ; If using ILC A/R interface, also require that the charges have 
"RTN","BPSOSK1",28,0)
 ; been posted and that the bill have a zero balance.
"RTN","BPSOSK1",29,0)
 I ISILCAR,'$$CLOSED02(IEN) Q
"RTN","BPSOSK1",30,0)
 I $$PT5759(2) Q  ; no delete if pointed to by transaction
"RTN","BPSOSK1",31,0)
 I $O(^BPSR("B",IEN,0)) Q  ; no delete if pointed to by .03
"RTN","BPSOSK1",32,0)
 I $$AGE02(IEN)>AGE("WINNOW .02 CONTENTS") D DELETE(9002313.02,IEN)
"RTN","BPSOSK1",33,0)
 Q
"RTN","BPSOSK1",34,0)
PT5759(F) ; does any 9002313.57 or 9002313.59 point to this claim or resp. IEN
"RTN","BPSOSK1",35,0)
 ; IEN points to the 9002313.02 or 9002313.03, too
"RTN","BPSOSK1",36,0)
 ; F = 2 for claims, F=3 for responses
"RTN","BPSOSK1",37,0)
 N RET,INDEX,FF S RET=0
"RTN","BPSOSK1",38,0)
 I F=2 D
"RTN","BPSOSK1",39,0)
 . F INDEX="AE","AER" F FF=9002313.57,9002313.59 D
"RTN","BPSOSK1",40,0)
 . . I FF=9002313.57,$O(^BPSTL(INDEX,IEN,0)) S RET=1
"RTN","BPSOSK1",41,0)
 . . I FF=9002313.59,$O(^BPST(INDEX,IEN,0)) S RET=1
"RTN","BPSOSK1",42,0)
 E  I F=3 D
"RTN","BPSOSK1",43,0)
 . F INDEX="AF","AFR" F FF=9002313.57,9002313.59 D
"RTN","BPSOSK1",44,0)
 . . I FF=9002313.57,$O(^BPSTL(INDEX,IEN,0)) S RET=1
"RTN","BPSOSK1",45,0)
 . . I FF=9002313.59,$O(^BPST(INDEX,IEN,0)) S RET=1
"RTN","BPSOSK1",46,0)
 E  D IMPOSS^BPSOSUE("P","TI","Bad arg F="_F,,"PT5759",$T(+0))
"RTN","BPSOSK1",47,0)
 Q RET
"RTN","BPSOSK1",48,0)
AGE02(N) ; how old is the 9002313.02 entry?
"RTN","BPSOSK1",49,0)
 ; if dates are totally missing, it inserts a date
"RTN","BPSOSK1",50,0)
 ; Use transmit date if it's there; otherwise created date
"RTN","BPSOSK1",51,0)
 N X,Y S X=^BPSC(N,0)
"RTN","BPSOSK1",52,0)
 S Y=$P(X,U,5) I 'Y S Y=$P(X,U,6) I 'Y D  Q:Y 0 Q $$IMPOSS^BPSOSUE("DB","TI","Unable to store dates into ^BPSC("_N,,"AGE02",$T(+0))
"RTN","BPSOSK1",53,0)
 . D LOG("Setting current date into 9002313.02 IEN="_N)
"RTN","BPSOSK1",54,0)
AG5 . N FDA,MSG S FDA(9002313.02,N_",",.06)="NOW"
"RTN","BPSOSK1",55,0)
 . D FILE^DIE("E","FDA","MSG")
"RTN","BPSOSK1",56,0)
 . I $D(MSG) G AG5:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"AGE02",$T(+0))
"RTN","BPSOSK1",57,0)
 . S Y=$$GET1^DIQ(9002313.02,N_",",.06,"I")
"RTN","BPSOSK1",58,0)
 Q $$AGE(Y)
"RTN","BPSOSK1",59,0)
CLOSED02(N) ; is ^BPSC(N,... posted to A/R and with a zero balance?
"RTN","BPSOSK1",60,0)
 ;   ILC A/R only !!!  This code is not reached for other A/R types
"RTN","BPSOSK1",61,0)
 ; (also returns true if the .02 is unposted for over a year)
"RTN","BPSOSK1",62,0)
 N PCN S PCN=$P(^BPSC(N,0),U,3)
"RTN","BPSOSK1",63,0)
 ; not posted - is it over a year old?
"RTN","BPSOSK1",64,0)
 Q 0
"RTN","BPSOSK1",65,0)
51 ;EP -  9002313.51 Input
"RTN","BPSOSK1",66,0)
 ; a month is more than enough
"RTN","BPSOSK1",67,0)
 I 'AGE("WINNOW .51") S AGE("WINNOW .51")=31
"RTN","BPSOSK1",68,0)
 I $$AGE($P(^BPS(9002313.51,IEN,0),U))>AGE("WINNOW .51") D
"RTN","BPSOSK1",69,0)
 . D DELETE(9002313.51,IEN)
"RTN","BPSOSK1",70,0)
 Q
"RTN","BPSOSK1",71,0)
511 ;EP -  9002313.511 Override
"RTN","BPSOSK1",72,0)
 I 'AGE("WINNOW .511") S AGE("WINNOW .511")=366
"RTN","BPSOSK1",73,0)
 I $$AGE($P(^BPS(9002313.51,IEN,0),U,2))>AGE("WINNOW .511") D
"RTN","BPSOSK1",74,0)
 . D DELETE(9002313.511,IEN)
"RTN","BPSOSK1",75,0)
 Q
"RTN","BPSOSK1",76,0)
ALL57 ;EP -  temporary - development use
"RTN","BPSOSK1",77,0)
 N DA F  S DA=$O(^BPSTL(0)) Q:'DA  D
"RTN","BPSOSK1",78,0)
 . S DIE=9002313.57,DR=".01///@" D ^DIE
"RTN","BPSOSK1",79,0)
 K ^BPSTL("NON-FILEMAN")
"RTN","BPSOSK1",80,0)
 Q
"RTN","BPSOSK1",81,0)
57 ;EP -  9002313.57 Billing
"RTN","BPSOSK1",82,0)
 ; AGE("WINNOW .57 AFTER POSTING") - if you have ILC A/R, then delete
"RTN","BPSOSK1",83,0)
 ;  a .57 entry this many days after posting, if account has 0 
"RTN","BPSOSK1",84,0)
 ;  balance.  Recommended 400.
"RTN","BPSOSK1",85,0)
 ; AGE("WINNOW UNPOSTED .57") - non ILC A/R or missed posting ILC A/R
"RTN","BPSOSK1",86,0)
 ;  Delete this many days after last update.
"RTN","BPSOSK1",87,0)
 ;  Recommended 100, though there shouldn't be a problem with 0, even.
"RTN","BPSOSK1",88,0)
 I 'AGE("WINNOW .57 AFTER POSTING") S AGE("WINNOW .57 AFTER POSTING")=400
"RTN","BPSOSK1",89,0)
 I 'AGE("WINNOW UNPOSTED .57") S AGE("WINNOW UNPOSTED .57")=100
"RTN","BPSOSK1",90,0)
 N BILLTHRU S BILLTHRU=$$BILLTHRU
"RTN","BPSOSK1",91,0)
 N IFACE57 S IFACE57=$$IFACE57
"RTN","BPSOSK1",92,0)
 ; BILLTHRU = which transaction # we've billed through
"RTN","BPSOSK1",93,0)
 ;  If there's no billing interface, then we say we've billed it all. 
"RTN","BPSOSK1",94,0)
 I IFACE57 S BILLTHRU=$$BILLTHRU
"RTN","BPSOSK1",95,0)
 E  S BILLTHRU=$P(^BPSTL(0),U,3)
"RTN","BPSOSK1",96,0)
 ;
"RTN","BPSOSK1",97,0)
 I IEN>BILLTHRU Q  ; still need this one for billing
"RTN","BPSOSK1",98,0)
 N LUPDATE S LUPDATE=$$GET1^DIQ(9002313.57,IEN_",",7,"I") ; LAST UPDATE
"RTN","BPSOSK1",99,0)
 N ISPOSTED S ISPOSTED=$$GET1^DIQ(9002313.57,IEN_",",2,"I")
"RTN","BPSOSK1",100,0)
 I ISILCAR D  ; use the date the bill was created, instead
"RTN","BPSOSK1",101,0)
 . N PCNDFN S PCNDFN=$$GET1^DIQ(9002313.57,IEN_",",2,"I")
"RTN","BPSOSK1",102,0)
 . Q:'PCNDFN
"RTN","BPSOSK1",103,0)
 . N % S %=$$GET1^DIQ(9002302,PCNDFN_",",2.8)
"RTN","BPSOSK1",104,0)
 . I % S LUPDATE=%
"RTN","BPSOSK1",105,0)
 I 'LUPDATE D SETTODAY(9002313.57,7) Q
"RTN","BPSOSK1",106,0)
 N DELFLAG
"RTN","BPSOSK1",107,0)
 I ISPOSTED D
"RTN","BPSOSK1",108,0)
 . S DELFLAG=$$AGE(LUPDATE)>AGE("WINNOW .57 AFTER POSTING")&ISPOSTED
"RTN","BPSOSK1",109,0)
 E  D
"RTN","BPSOSK1",110,0)
 . S DELFLAG=$$AGE(LUPDATE)>AGE("WINNOW UNPOSTED .57")
"RTN","BPSOSK1",111,0)
 I DELFLAG D DELETE(9002313.57,IEN)
"RTN","BPSOSK1",112,0)
 Q
"RTN","BPSOSK1",113,0)
BILLTHRU()         ; through what transaction # have we billed?
"RTN","BPSOSK1",114,0)
 ; meaningful only for ILC and IHS a/r interfaces
"RTN","BPSOSK1",115,0)
 Q $$GET1^DIQ(9002313.99,"1,",230.01)
"RTN","BPSOSK1",116,0)
IFACE57()          ; true if you have a billing interface w/9002313.57
"RTN","BPSOSK1",117,0)
 Q $$DOINGAR^BPSOSB
"RTN","BPSOSK1",118,0)
59 ;EP - 9002313.59 Working
"RTN","BPSOSK1",119,0)
 ; Let's keep them around for a year - someone might need to 
"RTN","BPSOSK1",120,0)
 ; set view to One Patient and call up something old
"RTN","BPSOSK1",121,0)
 I 'AGE("WINNOW .59") S AGE("WINNOW .59")=366
"RTN","BPSOSK1",122,0)
 N X S X=$P(^BPST(IEN,0),U,8)
"RTN","BPSOSK1",123,0)
 I 'X D  Q  ; stuff 
"RTN","BPSOSK1",124,0)
 . D LOG("Setting current date into 9002313.59 IEN="_N)
"RTN","BPSOSK1",125,0)
 . N FDA,MSG S FDA(9002313.59,IEN_",",7)=NOW D FILE^DIE("E","FDA","MSG")
"RTN","BPSOSK1",126,0)
 I $$AGE(X)>AGE("WINNOW .59") D DELETE(9002313.59,IEN)
"RTN","BPSOSK1",127,0)
 Q
"RTN","BPSOSK1",128,0)
LOGFILES ;EP -  ^BPSECP("LOG",IEN,
"RTN","BPSOSK1",129,0)
 ; AGE("WINNOW LOG FILES") - this many days following the most recent
"RTN","BPSOSK1",130,0)
 ; write to the file - recommended 90; could be as low as you want
"RTN","BPSOSK1",131,0)
 I 'AGE("WINNOW LOG FILES") S AGE("WINNOW LOG FILES")=90
"RTN","BPSOSK1",132,0)
 N D S D=$P($G(^BPSECP("LOG",IEN)),U,3)
"RTN","BPSOSK1",133,0)
 I 'D S D=$P($G(^BPSECP("LOG",IEN)),U)
"RTN","BPSOSK1",134,0)
 I 'D S $P(^BPSECP("LOG",IEN),U)=$H Q  ; no date - give it today's
"RTN","BPSOSK1",135,0)
 ;      and it will be deleted at some later date
"RTN","BPSOSK1",136,0)
 ; unusual case with log files - it's a $H date - must convert it
"RTN","BPSOSK1",137,0)
 ;
"RTN","BPSOSK1",138,0)
 ; IHS/SD/lwj 04/03/02 changed D to equal the date and seconds
"RTN","BPSOSK1",139,0)
 D
"RTN","BPSOSK1",140,0)
 . N %H,%,X S %H=D D YMD^%DTC S D=X+% ;IHS/SD/lwj 04/03/02 D chgd
"RTN","BPSOSK1",141,0)
 N DELFLAG S DELFLAG=0
"RTN","BPSOSK1",142,0)
 I $$AGE(D)>AGE("WINNOW LOG FILES") S DELFLAG=1
"RTN","BPSOSK1",143,0)
 I DELFLAG D
"RTN","BPSOSK1",144,0)
 . N MSG S MSG=$S(TESTING:"We would delete",1:"Deleting")_" log file "
"RTN","BPSOSK1",145,0)
 . S MSG=MSG_IEN
"RTN","BPSOSK1",146,0)
 . D LOG(MSG)
"RTN","BPSOSK1",147,0)
 . D DELLOG(IEN)
"RTN","BPSOSK1",148,0)
 Q
"RTN","BPSOSK1",149,0)
COMBINS ;EP - ^BPSCOMB(IEN,
"RTN","BPSOSK1",150,0)
 ; AGE("WINNOW COMBINED INSURANCE") - this many days following the 
"RTN","BPSOSK1",151,0)
 ;  completion of most recent 9002313.57 transaction
"RTN","BPSOSK1",152,0)
 ; Slight risk of conflict if you're deleting the record just as
"RTN","BPSOSK1",153,0)
 ; the next prescription for this patient is being processed.
"RTN","BPSOSK1",154,0)
 I 'AGE("WINNOW COMBINED INSURANCE") D
"RTN","BPSOSK1",155,0)
 . S AGE("WINNOW COMBINED INSURANCE")=100
"RTN","BPSOSK1",156,0)
 N PAT S PAT=$P(^BPSCOMB(IEN,0),U)
"RTN","BPSOSK1",157,0)
 ; when was the last completed transaction for this patient?
"RTN","BPSOSK1",158,0)
 N N57 S N57=$O(^BPSTL("AC",PAT,""),-1)
"RTN","BPSOSK1",159,0)
 N DELFLAG S DELFLAG=0
"RTN","BPSOSK1",160,0)
 I 'N57 S DELFLAG=1 ; no record of patient in completed transactions
"RTN","BPSOSK1",161,0)
 E  D  ; look at most recently-completed transaction's LAST UPDATE
"RTN","BPSOSK1",162,0)
 . N LUPDATE S LUPDATE=$P(^BPSTL(N57,0),U,8)
"RTN","BPSOSK1",163,0)
 . I $$AGE(LUPDATE)>AGE("WINNOW COMBINED INSURANCE") S DELFLAG=1
"RTN","BPSOSK1",164,0)
 I DELFLAG D DELETE(9002313.1,IEN)
"RTN","BPSOSK1",165,0)
 Q
"RTN","BPSOSK1",166,0)
LOG(X) D LOG^BPSOSL(X) Q
"RTN","BPSOSK1",167,0)
AGE(X2) ; given fileman date/time, how many days old is it?
"RTN","BPSOSK1",168,0)
 N X1,X,%Y
"RTN","BPSOSK1",169,0)
 S X2=$P(X2,"."),X1=$$TODAY
"RTN","BPSOSK1",170,0)
 D ^%DTC
"RTN","BPSOSK1",171,0)
 Q X
"RTN","BPSOSK1",172,0)
TODAY() N %,%H,%I,X D NOW^%DTC Q $P(%,".")
"RTN","BPSOSK1",173,0)
SETTODAY(FILE,IENS,FIELD)         ; the given FILE, FIELD is missing a date, unexpectedly
"RTN","BPSOSK1",174,0)
 ; set today's date in there, so that it will be winnowed at some time
"RTN","BPSOSK1",175,0)
 ; in the future
"RTN","BPSOSK1",176,0)
 N FDA
"RTN","BPSOSK1",177,0)
 S:IENS'?.E1"," IENS=IENS_","
"RTN","BPSOSK1",178,0)
 D LOG("Missing date; stuffed today into FILE="_FILE_",IENS="_IENS_",FIELD="_FIELD)
"RTN","BPSOSK1",179,0)
 S FDA(FILE,IENS,FIELD)=$$TODAY
"RTN","BPSOSK1",180,0)
ST5 D FILE^DIE(,"FDA","MSG")
"RTN","BPSOSK1",181,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSK1",182,0)
 D ZWRITE^BPSOS("MSG")
"RTN","BPSOSK1",183,0)
 G ST5:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"SETTODAY",$T(+0))
"RTN","BPSOSK1",184,0)
 Q
"RTN","BPSOSK1",185,0)
DELETE(FILE,IENS)  ; this is where it happens!!!
"RTN","BPSOSK1",186,0)
 S:IENS'?.E1"," IENS=IENS_","
"RTN","BPSOSK1",187,0)
 ;
"RTN","BPSOSK1",188,0)
 ; Never delete the highest #d entry in a file.
"RTN","BPSOSK1",189,0)
 ; Prevent the re-use of IENs.
"RTN","BPSOSK1",190,0)
 ;
"RTN","BPSOSK1",191,0)
 Q:$$HIGHEST
"RTN","BPSOSK1",192,0)
 ;
"RTN","BPSOSK1",193,0)
 ; Do the delete:
"RTN","BPSOSK1",194,0)
 N FDA
"RTN","BPSOSK1",195,0)
 N MSG S MSG=$S(TESTING:"We would delete",1:"DELETING")
"RTN","BPSOSK1",196,0)
 S MSG=MSG_" FILE="_FILE_",IENS="_IENS
"RTN","BPSOSK1",197,0)
 D LOG(MSG)
"RTN","BPSOSK1",198,0)
 K MSG
"RTN","BPSOSK1",199,0)
 S FDA(FILE,IENS,.01)=""
"RTN","BPSOSK1",200,0)
 Q:TESTING
"RTN","BPSOSK1",201,0)
DE5 D FILE^DIE(,"FDA","MSG")
"RTN","BPSOSK1",202,0)
 I $D(MSG) D ZWRITE^BPSOS("FDA","MSG") G DE5:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"DELETE",$T(+0))
"RTN","BPSOSK1",203,0)
 ; Make sure the deletion worked: fetch the .01 field
"RTN","BPSOSK1",204,0)
 I $$GET1^DIQ(FILE,IENS,.01)]"" G DE5:$$IMPOSS^BPSOSUE("FM","TRI","deletion failed",,"DELETE",$T(+0))
"RTN","BPSOSK1",205,0)
 Q
"RTN","BPSOSK1",206,0)
HIGHEST() ; is IENS the highest #d top-level entry in FILE?
"RTN","BPSOSK1",207,0)
 I $L(IENS,",")>2 Q 0
"RTN","BPSOSK1",208,0)
 N ROOT S ROOT=$$ROOT^DILFD(FILE,",",1)
"RTN","BPSOSK1",209,0)
 Q '$O(@ROOT@(+IENS))
"RTN","BPSOSK1",210,0)
DELFIELD(FILE,IENS,FIELD) ; and here too
"RTN","BPSOSK1",211,0)
 N FDA
"RTN","BPSOSK1",212,0)
 S:IENS'?.E1"," IENS=IENS_","
"RTN","BPSOSK1",213,0)
 N MSG S MSG=$S(TESTING:"We would delete",1:"DELETING")
"RTN","BPSOSK1",214,0)
 S MSG=MSG_" FILE="_FILE_",IENS="_IENS_",FIELD="_FIELD
"RTN","BPSOSK1",215,0)
 D LOG(MSG)
"RTN","BPSOSK1",216,0)
 K MSG
"RTN","BPSOSK1",217,0)
 S FDA(FILE,IENS,FIELD)=""
"RTN","BPSOSK1",218,0)
 I 'TESTING D FILE^DIE(,"FDA","MSG")
"RTN","BPSOSK1",219,0)
 Q
"RTN","BPSOSK1",220,0)
DELLOG(N)          ; special for log files
"RTN","BPSOSK1",221,0)
 N MSG S MSG=$S(TESTING:"We would delete",1:"DELETING")
"RTN","BPSOSK1",222,0)
 S MSG=MSG_" Log file "_N
"RTN","BPSOSK1",223,0)
 D LOG(MSG)
"RTN","BPSOSK1",224,0)
 K MSG
"RTN","BPSOSK1",225,0)
 I 'TESTING K ^BPSECP("LOG",N)
"RTN","BPSOSK1",226,0)
 Q
"RTN","BPSOSK2")
0^181^B2180670
"RTN","BPSOSK2",1,0)
BPSOSK2 ;BHAM ISC/FCS/DRS/DLF - winnow ECME data ;06/01/2004
"RTN","BPSOSK2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSK2",3,0)
 Q
"RTN","BPSOSK2",4,0)
FIX57IDX ; EP - from 57^BPSOSK
"RTN","BPSOSK2",5,0)
 ; Clean up the NON-FILEMAN indexes from 9002313.57
"RTN","BPSOSK2",6,0)
 ; ^BPSTL("NON-FILEMAN","RXIRXR",RXI,RXR,N57)
"RTN","BPSOSK2",7,0)
 ; ^BPSTL("NON-FILEMAN","RXIRXR",category,RXI,RXR,N57)
"RTN","BPSOSK2",8,0)
 ; ^BPSTL("NON-FILEMAN","PCNDFN",PCNDFN,N57)
"RTN","BPSOSK2",9,0)
 N ROOT S ROOT="^BPSTL(""NON-FILEMAN"",""RXIRXR"")"
"RTN","BPSOSK2",10,0)
 N RXI,RXR,N57
"RTN","BPSOSK2",11,0)
 S RXI="" F  S RXI=$O(@ROOT@(RXI)) Q:'RXI  D
"RTN","BPSOSK2",12,0)
 . S RXR="" F  S RXR=$O(@ROOT@(RXI,RXR)) Q:RXR=""  D
"RTN","BPSOSK2",13,0)
 . . S N57=0 F  S N57=$O(@ROOT@(RXI,RXR,N57)) Q:'N57  D
"RTN","BPSOSK2",14,0)
 . . . I '$D(^BPSTL(N57)) D
"RTN","BPSOSK2",15,0)
 . . . . K @ROOT@(RXI,RXR,N57)
"RTN","BPSOSK2",16,0)
 ; at this point, RXI=the first "category"
"RTN","BPSOSK2",17,0)
 N CAT S CAT=RXI
"RTN","BPSOSK2",18,0)
 F  D  S CAT=$O(@ROOT@(CAT)) Q:CAT=""
"RTN","BPSOSK2",19,0)
 . S RXI="" F  S RXI=$O(@ROOT@(CAT,RXI)) Q:'RXI  D
"RTN","BPSOSK2",20,0)
 . . S RXR="" F  S RXR=$O(@ROOT@(CAT,RXI,RXR)) Q:RXR=""  D
"RTN","BPSOSK2",21,0)
 . . . S N57="" F  S N57=$O(@ROOT@(CAT,RXI,RXR,N57)) Q:'N57  D
"RTN","BPSOSK2",22,0)
 . . . . I '$D(^BPSTL(N57)) D
"RTN","BPSOSK2",23,0)
 . . . . . K @ROOT@(CAT,RXI,RXR,N57)
"RTN","BPSOSK2",24,0)
 ; and now the PCNDFNs
"RTN","BPSOSK2",25,0)
 S ROOT="^BPSTL(""NON-FILEMAN"",""PCNDFN"")"
"RTN","BPSOSK2",26,0)
 N PCNDFN S PCNDFN=0
"RTN","BPSOSK2",27,0)
 F  S PCNDFN=$O(@ROOT@(PCNDFN)) Q:'PCNDFN  D
"RTN","BPSOSK2",28,0)
 . S CAT="" F  S CAT=$O(@ROOT@(CAT,PCNDFN)) Q:CAT=""  D
"RTN","BPSOSK2",29,0)
 . . S N57=0 F  S N57=$O(@ROOT@(CAT,PCNDFN,N57)) Q:'N57  D
"RTN","BPSOSK2",30,0)
 . . . I '$D(^BPSTL(N57)) D
"RTN","BPSOSK2",31,0)
 . . . . K @ROOT@(CAT,PCNDFN,N57)
"RTN","BPSOSK2",32,0)
 Q
"RTN","BPSOSL")
0^182^B48391116
"RTN","BPSOSL",1,0)
BPSOSL ;BHAM ISC/FCS/DRS/DLF - logging ;06/01/2004
"RTN","BPSOSL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSL",3,0)
 Q
"RTN","BPSOSL",4,0)
 ; Lots of entry points called from lots of places.
"RTN","BPSOSL",5,0)
 ; 
"RTN","BPSOSL",6,0)
 ; The job that reads the prescription does this:
"RTN","BPSOSL",7,0)
 ; DO INIT^BPSOSL(ABSBRXI,NODELETE) to init a new session
"RTN","BPSOSL",8,0)
 ;       It will also DO SETSLOT() for you and timestamp.
"RTN","BPSOSL",9,0)
 ;       NODELETE true will keep anything already there,
"RTN","BPSOSL",10,0)
 ;       otherwise, any previous data is deleted.
"RTN","BPSOSL",11,0)
 ; DO LOG^BPSOSL(text) to log an event
"RTN","BPSOSL",12,0)
 ; DO RELSLOT^BPSOSL to release the slot
"RTN","BPSOSL",13,0)
 ;
"RTN","BPSOSL",14,0)
 ; The job(s) that build the packet and handle the communications
"RTN","BPSOSL",15,0)
 ; should do the following to stuff info into a prescription's log:
"RTN","BPSOSL",16,0)
 ; DO SETSLOT^BPSOSL(prescription ien)
"RTN","BPSOSL",17,0)
 ; DO LOG^BPSOSL(text) to log an event
"RTN","BPSOSL",18,0)
 ; DO RELSLOT^BPSOSL to release the slot
"RTN","BPSOSL",19,0)
 ;
"RTN","BPSOSL",20,0)
 ; DO LOG2LIST^BPSOSL(text) to log to all IEN59 in RXILIST(IEN59)
"RTN","BPSOSL",21,0)
 ; DO LOG2CLM^BPSOSL(text,IEN02) to log all IEN59 represented
"RTN","BPSOSL",22,0)
 ;    in ^BPSC(IEN02, claim
"RTN","BPSOSL",23,0)
 ; DO LOG59(text,IEN59) to log to IEN59 (does SETSLOT/RELSLOT for you)
"RTN","BPSOSL",24,0)
 ; DO LOGARRTO(root,slot) to log an entire array to IEN59
"RTN","BPSOSL",25,0)
 ;
"RTN","BPSOSL",26,0)
 ; DO FINDPREV(type[,start]) to find most recent slot of given n.type
"RTN","BPSOSL",27,0)
 ;  (type is the decimal suffix)  start = optional start at this #
"RTN","BPSOSL",28,0)
 ;
"RTN","BPSOSL",29,0)
 ; Communications jobs - to not interfere with prescription numbers,
"RTN","BPSOSL",30,0)
 ; add an extra .1 onto the index.
"RTN","BPSOSL",31,0)
 ;  DO INIT^BPSOSL(.1)
"RTN","BPSOSL",32,0)
 ; Processing responses (BPSOSQ4) - tacks on .11
"RTN","BPSOSL",33,0)
 ; Billing jobs - add an extra .2 onto the index - (DT+.2)
"RTN","BPSOSL",34,0)
 ; Silent submitter (BPSOSR1) - add .3 - (these will be DT+.3)
"RTN","BPSOSL",35,0)
 ; Calls to ABSOPSRX - add .4 - (these will be DT+.4)
"RTN","BPSOSL",36,0)
 ; Winnowing - BPSOSK - add .5 - (these will be DT+.5)
"RTN","BPSOSL",37,0)
 ; Back billing - add .6 (these will be DT+.6)
"RTN","BPSOSL",38,0)
 ;
"RTN","BPSOSL",39,0)
 ; The job(s) that handle the response should 
"RTN","BPSOSL",40,0)
 ; DO SETSLOT^BPSOSL(prescription ien)
"RTN","BPSOSL",41,0)
 ; DO LOG^BPSOSL(text) to log an event
"RTN","BPSOSL",42,0)
 ; DO DONE^BPSOSL to close a session
"RTN","BPSOSL",43,0)
 ;       It will also do RELSLOT for you.
"RTN","BPSOSL",44,0)
 ;
"RTN","BPSOSL",45,0)
 ;
"RTN","BPSOSL",46,0)
 ; Other functions:
"RTN","BPSOSL",47,0)
 ; $$GETSLOT returns the slot # currently in use (as when you wish to
"RTN","BPSOSL",48,0)
 ;   use a different one and stack this one for later reuse)
"RTN","BPSOSL",49,0)
 ; $$GETINDEX returns the position of the logging (a subscript,
"RTN","BPSOSL",50,0)
 ;   a copy of ^BPSECP("LOG",slot #,0))
"RTN","BPSOSL",51,0)
 ; $$GETINDEX(SLOT)  gets it for some other given slot, not your own
"RTN","BPSOSL",52,0)
 ; $$GETPLACE returns $$GETSLOT_","_$$GETINDEX
"RTN","BPSOSL",53,0)
 ; $$EXISTS(SLOT)   does this slot # exist?
"RTN","BPSOSL",54,0)
 ;
"RTN","BPSOSL",55,0)
 ;
"RTN","BPSOSL",56,0)
 ; PRINTLOG(SLOT) to print the log of entire session from SLOT
"RTN","BPSOSL",57,0)
 ; PRCLLOG("slot,line",claim#) to print the transmissions log
"RTN","BPSOSL",58,0)
 ;   excerpt relevant to claim#
"RTN","BPSOSL",59,0)
 ;
"RTN","BPSOSL",60,0)
 ; ^BPSECP("LOG","LAST SLOT")=last # assigned ; obsolete
"RTN","BPSOSL",61,0)
 ; ^BPSECP("LOG","JOB",j)=# ; given $J, what's the log #
"RTN","BPSOSL",62,0)
 ; ^BPSECP("LOG",#)=time assigned^job number^time done
"RTN","BPSOSL",63,0)
 ; ^BPSECP("LOG",#,0)=last n assigned
"RTN","BPSOSL",64,0)
 ; ^BPSECP("LOG",#,n)=$H secs^event text
"RTN","BPSOSL",65,0)
 ;
"RTN","BPSOSL",66,0)
 ;
"RTN","BPSOSL",67,0)
LOG(TEXT,ECHO,SPECIAL) ;EP - log the event given by TEXT
"RTN","BPSOSL",68,0)
 ; SPECIAL="D" to prefix with printable date, T time, DT both
"RTN","BPSOSL",69,0)
 N H S H=$H
"RTN","BPSOSL",70,0)
 I $D(TEXT("IEN")) S ^BPSECP("LOG","JOB",$J)=TEXT("IEN")
"RTN","BPSOSL",71,0)
 N SLOT S SLOT=$G(^BPSECP("LOG","JOB",$J)) Q:'SLOT
"RTN","BPSOSL",72,0)
 N N S N=$G(^BPSECP("LOG",SLOT,0))+1,^(0)=N
"RTN","BPSOSL",73,0)
 I $G(SPECIAL)]"",SPECIAL["D"!(SPECIAL["T") D
"RTN","BPSOSL",74,0)
 . N %,%H,%I,X,Y D NOW^%DTC S Y=% X ^DD("DD")
"RTN","BPSOSL",75,0)
 . I SPECIAL'["D" S Y=$P(Y,"@",2)
"RTN","BPSOSL",76,0)
 . I  I SPECIAL'["T" S Y=$P(Y,"@")
"RTN","BPSOSL",77,0)
 . S TEXT=Y_" "_TEXT
"RTN","BPSOSL",78,0)
 S ^BPSECP("LOG",SLOT,N)=$P(H,",",2)_"^"_$E(TEXT,1,200)
"RTN","BPSOSL",79,0)
 N VARX
"RTN","BPSOSL",80,0)
 S VARX=0 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1
"RTN","BPSOSL",81,0)
 I 'VARX,$G(ECHO) D
"RTN","BPSOSL",82,0)
 .N IO S IO=$I
"RTN","BPSOSL",83,0)
 .U $P W:$X>0 ! W TEXT,!
"RTN","BPSOSL",84,0)
 .U IO
"RTN","BPSOSL",85,0)
 I $G(SPECIAL)=9999 S $P(^BPSECP("LOG",SLOT),"^",3)=H
"RTN","BPSOSL",86,0)
 Q
"RTN","BPSOSL",87,0)
INIT(SLOTNUM,NODELETE,TMSTAMP) ;EP - very first caller does this:
"RTN","BPSOSL",88,0)
 ; TMSTAMP undef or 1 -> you'll get a one-line time stamp
"RTN","BPSOSL",89,0)
 ; TMSTAMP = 0 -> you won't get it.
"RTN","BPSOSL",90,0)
 ; TMSTAMP = -1 -> timestamp only if brand new log file
"RTN","BPSOSL",91,0)
 I '$G(^BPSECP("LOG","LAST SLOT")) D
"RTN","BPSOSL",92,0)
 . N X S X=$O(^BPSECP("LOG",999999999999),-1) S:'X X=99
"RTN","BPSOSL",93,0)
 . S ^BPSECP("LOG","LAST SLOT")=X\1
"RTN","BPSOSL",94,0)
 F  L +^BPSECP("LOG"):300 Q:$T  Q:'$$IMPOSS^BPSOSUE("L","RTI","interlock on obtaining new log file slot",,"INIT",$T(+0))
"RTN","BPSOSL",95,0)
 N SLOT
"RTN","BPSOSL",96,0)
 I $G(SLOTNUM)'<1 D  ; if a specific slot number was specified:
"RTN","BPSOSL",97,0)
 . S SLOT=SLOTNUM
"RTN","BPSOSL",98,0)
 E  D  ; SLOTNUM<1, a differential to add
"RTN","BPSOSL",99,0)
 . I '$D(SLOTNUM) S SLOTNUM=0
"RTN","BPSOSL",100,0)
 . S SLOT=^BPSECP("LOG","LAST SLOT")+1+SLOTNUM ; add in the differential
"RTN","BPSOSL",101,0)
 . ; check:  slot doesn't exist
"RTN","BPSOSL",102,0)
 . N STOP S STOP=0
"RTN","BPSOSL",103,0)
 . F  D  Q:STOP  S SLOT=SLOT+1
"RTN","BPSOSL",104,0)
 . . ; want: nothing in this SLOT\1 range
"RTN","BPSOSL",105,0)
 . . I $D(^BPSECP("LOG",SLOT\1)) Q  ; no, ^BPSECP("LOG",xxx) defined
"RTN","BPSOSL",106,0)
 . . I $O(^BPSECP("LOG",SLOT\1))\1=(SLOT\1) Q  ; no,^BPSECP("LOG",xxx.yy) defined
"RTN","BPSOSL",107,0)
 . . S STOP=1
"RTN","BPSOSL",108,0)
 . S ^BPSECP("LOG","LAST SLOT")=SLOT\1
"RTN","BPSOSL",109,0)
 D SETSLOT(SLOT)
"RTN","BPSOSL",110,0)
 I '$G(NODELETE) K ^BPSECP("LOG",SLOT)
"RTN","BPSOSL",111,0)
 I '$G(NODELETE)!('$D(^BPSECP("LOG",SLOT,0))) S ^BPSECP("LOG",SLOT,0)=0
"RTN","BPSOSL",112,0)
 I $G(TMSTAMP)=-1 D  ; we want a time stamp only if it's brand new file
"RTN","BPSOSL",113,0)
 . S TMSTAMP='$D(^BPSECP("LOG",SLOT,1))
"RTN","BPSOSL",114,0)
 I $G(TMSTAMP)'=0 D  ; only skip if TMSTAMP is explicitly 0
"RTN","BPSOSL",115,0)
 . N %,%H,%I,X D NOW^%DTC S Y=% X ^DD("DD") D LOG("Log Time Stamp "_Y_" "_%H_" "_%_" "_SLOT)
"RTN","BPSOSL",116,0)
 L -^BPSECP("LOG")
"RTN","BPSOSL",117,0)
 Q
"RTN","BPSOSL",118,0)
SETSLOT(SLOT) ;EP -
"RTN","BPSOSL",119,0)
 S ^BPSECP("LOG","JOB",$J)=SLOT
"RTN","BPSOSL",120,0)
 I SLOT S ^BPSECP("LOG",SLOT)=$H_"^"_$J
"RTN","BPSOSL",121,0)
 Q
"RTN","BPSOSL",122,0)
RELSLOT ; EP  -
"RTN","BPSOSL",123,0)
 N SLOT S SLOT=$G(^BPSECP("LOG","JOB",$J))
"RTN","BPSOSL",124,0)
 I SLOT S $P(^BPSECP("LOG","JOB",$J),U,2)="R"
"RTN","BPSOSL",125,0)
 Q
"RTN","BPSOSL",126,0)
 ;
"RTN","BPSOSL",127,0)
GETSLOT() ;EP -
"RTN","BPSOSL",128,0)
 N X S X=$G(^BPSECP("LOG","JOB",$J)) ; = "" if you had none
"RTN","BPSOSL",129,0)
 I X?.E1"^R" S X="" ; you (or prev user) had one, but it was released
"RTN","BPSOSL",130,0)
 Q X
"RTN","BPSOSL",131,0)
 ;
"RTN","BPSOSL",132,0)
GETINDEX(SLOT)         Q $G(^BPSECP("LOG",$S($D(SLOT):SLOT,1:$$GETSLOT),0))
"RTN","BPSOSL",133,0)
 ;
"RTN","BPSOSL",134,0)
GETPLACE() ;EP -
"RTN","BPSOSL",135,0)
 Q $$GETSLOT_","_$$GETINDEX
"RTN","BPSOSL",136,0)
 ;
"RTN","BPSOSL",137,0)
DONE ;EP -
"RTN","BPSOSL",138,0)
 D LOG("DONE^BPSOSL",0,9999)
"RTN","BPSOSL",139,0)
 D RELSLOT
"RTN","BPSOSL",140,0)
 K ^BPSECP("LOG","JOB",$J)
"RTN","BPSOSL",141,0)
 Q
"RTN","BPSOSL",142,0)
PRCLLOG(WHERE,CLAIM) ;EP - print portion of comms log related to given claim
"RTN","BPSOSL",143,0)
 N SLOT,START,END,END1,X,FOUND
"RTN","BPSOSL",144,0)
 S SLOT=$P(WHERE,","),START=$P(WHERE,",",2)
"RTN","BPSOSL",145,0)
 S END=$$PRINTEND(SLOT) I 'END Q
"RTN","BPSOSL",146,0)
 ; Is the START what we expect?
"RTN","BPSOSL",147,0)
 ; this must match text at CLAIMBEG, CLAIMEND^BPSOSAM
"RTN","BPSOSL",148,0)
 S X=$G(^BPSECP("LOG",SLOT,START))
"RTN","BPSOSL",149,0)
 I $P(X,U,2)'[("CLAIM - BEGIN - #"_CLAIM) D  Q
"RTN","BPSOSL",150,0)
 .W "Found ",X,!
"RTN","BPSOSL",151,0)
 .W "  instead of expected beginning of claim ",CLAIM,".",!
"RTN","BPSOSL",152,0)
 S FOUND=0 ; whether we found the expected end or not
"RTN","BPSOSL",153,0)
 F END1=START+1:1:END D  Q:FOUND  ; with END1 pointing to the end
"RTN","BPSOSL",154,0)
 .S X=$G(^BPSECP("LOG",SLOT,END1))
"RTN","BPSOSL",155,0)
 .I $P(X,U,2)[("CLAIM - END - #"_CLAIM) S FOUND=1
"RTN","BPSOSL",156,0)
 I 'FOUND D
"RTN","BPSOSL",157,0)
 .W "Did not find the expected end of claim transmission info.",!
"RTN","BPSOSL",158,0)
 .W "We will print out some of what is there.",!
"RTN","BPSOSL",159,0)
 .S END1=START+25 S:END1>END END1=END
"RTN","BPSOSL",160,0)
 D PRINTLOG(SLOT,START,END1)
"RTN","BPSOSL",161,0)
 Q
"RTN","BPSOSL",162,0)
PRINTEND(SLOT) ;EP -find the end of the logging session 
"RTN","BPSOSL",163,0)
 N END S END=$G(^BPSECP("LOG",SLOT,0))
"RTN","BPSOSL",164,0)
 I 'END D
"RTN","BPSOSL",165,0)
 .W "Missing the 0 node that tells us where the end is?",!
"RTN","BPSOSL",166,0)
 .S END=$O(^BPSECP("LOG",SLOT,""),-1)
"RTN","BPSOSL",167,0)
 .W "Working backwards, we think the end is at ",END,!
"RTN","BPSOSL",168,0)
 Q END
"RTN","BPSOSL",169,0)
PRINTLOG(SLOT,START,END)     ;EP -
"RTN","BPSOSL",170,0)
 D PRINTLOG^BPSOSL1(SLOT,$G(START),$G(END)) Q
"RTN","BPSOSL",171,0)
HDIF(THEN,NOW)     Q $P(NOW,",")-$P(THEN,",")*86400+$P(NOW,",",2)-$P(THEN,",",2)
"RTN","BPSOSL",172,0)
EXISTS(X) ;EP -
"RTN","BPSOSL",173,0)
 Q $D(^BPSECP("LOG",X))
"RTN","BPSOSL",174,0)
FINDPREV(TYPE,START) ;
"RTN","BPSOSL",175,0)
 I '$D(START) D  Q:'START
"RTN","BPSOSL",176,0)
 . I TYPE>1 S START=TYPE-1,TYPE=TYPE#1 Q
"RTN","BPSOSL",177,0)
 . S START=+$G(^BPSECP("LOG","LAST SLOT"))+1
"RTN","BPSOSL",178,0)
 I START#1=0 S START=START+TYPE
"RTN","BPSOSL",179,0)
 I START#1'=TYPE S START=START\1-1+TYPE
"RTN","BPSOSL",180,0)
 F  Q:$D(^BPSECP("LOG",START))  S START=START-1 I START<1 S START="" Q
"RTN","BPSOSL",181,0)
 Q START
"RTN","BPSOSL",182,0)
 ; These logging utilities originally came from BPSOSQ2
"RTN","BPSOSL",183,0)
LOG2LIST(MSG) ;EP - write MSG to the log files of all in RXILIST(*)
"RTN","BPSOSL",184,0)
 N IEN59 S IEN59=0
"RTN","BPSOSL",185,0)
 F  S IEN59=$O(RXILIST(IEN59)) Q:'IEN59  D
"RTN","BPSOSL",186,0)
 . D LOG59(MSG,IEN59)
"RTN","BPSOSL",187,0)
 Q
"RTN","BPSOSL",188,0)
LOG2CLM(MSG,IEN02) ;EP - write MSG to log file for all claims in this 9002313.02
"RTN","BPSOSL",189,0)
 N IEN59 S IEN59=0
"RTN","BPSOSL",190,0)
 F  S IEN59=$O(^BPST("AE",IEN02,IEN59)) Q:'IEN59  D
"RTN","BPSOSL",191,0)
 . D LOG59(MSG,IEN59)
"RTN","BPSOSL",192,0)
 Q
"RTN","BPSOSL",193,0)
LOG59(MSG,IEN59)   ;EP -
"RTN","BPSOSL",194,0)
 D LOG2SLOT(MSG,IEN59) Q
"RTN","BPSOSL",195,0)
 ; obsolete:
"RTN","BPSOSL",196,0)
 D SETSLOT(IEN59)
"RTN","BPSOSL",197,0)
 D LOG(MSG)
"RTN","BPSOSL",198,0)
 D RELSLOT
"RTN","BPSOSL",199,0)
 Q
"RTN","BPSOSL",200,0)
LOG2SLOT(MSG,SLOT) ;EP -
"RTN","BPSOSL",201,0)
 N OLDSLOT S OLDSLOT=$$GETSLOT
"RTN","BPSOSL",202,0)
 D SETSLOT(SLOT)
"RTN","BPSOSL",203,0)
 D LOG(MSG)
"RTN","BPSOSL",204,0)
 D RELSLOT
"RTN","BPSOSL",205,0)
 D SETSLOT(OLDSLOT)
"RTN","BPSOSL",206,0)
 Q
"RTN","BPSOSL",207,0)
LOGARRAY(ROOT,SLOT,MAX) ;EP -
"RTN","BPSOSL",208,0)
 N REF S REF=ROOT
"RTN","BPSOSL",209,0)
 N COUNT S COUNT=0
"RTN","BPSOSL",210,0)
 I '$D(MAX) S MAX=100
"RTN","BPSOSL",211,0)
 I $D(@REF)#10'=1 S REF=$Q(@REF)
"RTN","BPSOSL",212,0)
 F  Q:REF=""  D  Q:'MAX
"RTN","BPSOSL",213,0)
 . I $D(SLOT) D
"RTN","BPSOSL",214,0)
 . . D LOG2SLOT(REF_"="_@REF,SLOT)
"RTN","BPSOSL",215,0)
 . E  D LOG(REF_"="_@REF)
"RTN","BPSOSL",216,0)
 . S COUNT=COUNT+1
"RTN","BPSOSL",217,0)
 . S REF=$Q(@REF)
"RTN","BPSOSL",218,0)
 . S MAX=MAX-1
"RTN","BPSOSL",219,0)
 I 'MAX,REF]"" D LOG2SLOT("More of "_ROOT_" to log, but max reached",SLOT)
"RTN","BPSOSL",220,0)
 I 'COUNT D LOG2SLOT("Nothing found in "_ORIGROOT,SLOT)
"RTN","BPSOSL",221,0)
 Q
"RTN","BPSOSL1")
0^183^B8189020
"RTN","BPSOSL1",1,0)
BPSOSL1 ;BHAM ISC/FCS/DRS/DLF - log file printing ;06/01/2004
"RTN","BPSOSL1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSL1",3,0)
 Q
"RTN","BPSOSL1",4,0)
 ; D CLAIMLOG^BPSOS6M - individual claims, as called from user screen
"RTN","BPSOSL1",5,0)
 ; D PRINTLOG^BPSOSBD - DT+.2 - background posting to A/R 
"RTN","BPSOSL1",6,0)
 ; D label^BPSOSBL   - billing log file - ILC interface - n+.2
"RTN","BPSOSL1",7,0)
 ; BPSOSC2, BPSOSC3 - testing and certification
"RTN","BPSOSL1",8,0)
 ; D LOGFILE^BPSOSR1 - DT+.3 - background scanner of ^PSRX(indexes)
"RTN","BPSOSL1",9,0)
 ; D LASTLOG^BPSOSRB - same as in BPSOSRX, below
"RTN","BPSOSL1",10,0)
 ; D LASTLOG^BPSOSRX - DT+.4 - background claims submission 
"RTN","BPSOSL1",11,0)
 ; D LOGFILE^BPSOSR4 - DT+.6 - back billing
"RTN","BPSOSL1",12,0)
 ; D COMMSLOG^BPSOSU6 - dial out's log files - offset .1
"RTN","BPSOSL1",13,0)
 ; (no entry point)  - DT+.5 - winnowing old data
"RTN","BPSOSL1",14,0)
 ; D PRINT^BPSOSUT - the programmer-mode modem tests
"RTN","BPSOSL1",15,0)
 ;
"RTN","BPSOSL1",16,0)
 ;  Two entry points:  PRINTLOG to print the log file, given the #
"RTN","BPSOSL1",17,0)
 ;  And PRINTDAT(type,start,end) prints all log files of the given
"RTN","BPSOSL1",18,0)
 ;    type in the given date range.  It prompts for missing parameters.
"RTN","BPSOSL1",19,0)
 ;    (if start is given and end is missing, it just does start)
"RTN","BPSOSL1",20,0)
 ;
"RTN","BPSOSL1",21,0)
PRINTDAT(TYPE,START,END) ;EP
"RTN","BPSOSL1",22,0)
 I '$D(TYPE) S TYPE=$$GETTYPE Q:'TYPE
"RTN","BPSOSL1",23,0)
 W !
"RTN","BPSOSL1",24,0)
 I $D(START) D
"RTN","BPSOSL1",25,0)
 . I '$D(END) S END=START
"RTN","BPSOSL1",26,0)
 E  D  Q:'START
"RTN","BPSOSL1",27,0)
 . S START=$$GETDATES,END=$P(START,U,2),START=$P(START,U)
"RTN","BPSOSL1",28,0)
 N POP D ^%ZIS Q:$G(POP)
"RTN","BPSOSL1",29,0)
 N FORDATE S FORDATE=START F  D  Q:FORDATE>END
"RTN","BPSOSL1",30,0)
 . N SLOT S SLOT=FORDATE+(TYPE/10)
"RTN","BPSOSL1",31,0)
 . I $$EXISTS^BPSOSL(SLOT) D
"RTN","BPSOSL1",32,0)
 . . D PRINTLOG(SLOT)
"RTN","BPSOSL1",33,0)
 . E  D
"RTN","BPSOSL1",34,0)
 . . W "There is no log file ",SLOT,! H 1
"RTN","BPSOSL1",35,0)
 . S FORDATE=$$TADD^BPSOSUD(FORDATE,1) ; add one day
"RTN","BPSOSL1",36,0)
 D ^%ZISC
"RTN","BPSOSL1",37,0)
 Q
"RTN","BPSOSL1",38,0)
GETDATES() ; return start^end
"RTN","BPSOSL1",39,0)
 N PROMPT1 S PROMPT1="Starting date: "
"RTN","BPSOSL1",40,0)
 N PROMPT2 S PROMPT2="  Ending date: "
"RTN","BPSOSL1",41,0)
 N DEF1,DEF2 S (DEF1,DEF2)=DT
"RTN","BPSOSL1",42,0)
 Q $$DTR^BPSOSU1(PROMPT1,PROMPT2,DEF1,DEF2,"")
"RTN","BPSOSL1",43,0)
GETTYPE() ; return 2 = billing, 3 = background scanner, etc.
"RTN","BPSOSL1",44,0)
 N PROMPT S PROMPT="Which log file? "
"RTN","BPSOSL1",45,0)
 N DEF S DEF=2
"RTN","BPSOSL1",46,0)
 N MODE S MODE="V"
"RTN","BPSOSL1",47,0)
 N MENU S MENU="2:Billing;3:Background scan;4:Claims submitter;5:Winnowing;6:Back billing"
"RTN","BPSOSL1",48,0)
 Q $$SET^BPSOSU3(PROMPT,DEF,1,MODE,MENU)
"RTN","BPSOSL1",49,0)
PRINTLOG(SLOT,START,END)     ; EP 
"RTN","BPSOSL1",50,0)
 I $Y D HDR
"RTN","BPSOSL1",51,0)
 I '$$EXISTS^BPSOSL(SLOT) W "Nothing in SLOT=",SLOT,! Q
"RTN","BPSOSL1",52,0)
 I '$G(START) N START S START=1
"RTN","BPSOSL1",53,0)
 I '$G(END) N END S END=$$PRINTEND^BPSOSL(SLOT)
"RTN","BPSOSL1",54,0)
 N PREVTIME S PREVTIME=""
"RTN","BPSOSL1",55,0)
 N MISS S MISS=0 ; count of missing lines
"RTN","BPSOSL1",56,0)
 N LEN S LEN=$S($G(IOM):IOM,1:80)-10-1
"RTN","BPSOSL1",57,0)
 I '$D(STOP) N STOP S STOP=0
"RTN","BPSOSL1",58,0)
 N LINE F LINE=START:1:END D  Q:STOP
"RTN","BPSOSL1",59,0)
 .I '$D(^BPSECP("LOG",SLOT,LINE)) D  Q
"RTN","BPSOSL1",60,0)
 ..I MISS>3 Q  ; don't bother saying any more
"RTN","BPSOSL1",61,0)
 ..S MISS=MISS+1 W "Missing line ",LINE
"RTN","BPSOSL1",62,0)
 ..I MISS=3 W "; no more missing lines will be reported."
"RTN","BPSOSL1",63,0)
 ..W !
"RTN","BPSOSL1",64,0)
 .N X S X=^BPSECP("LOG",SLOT,LINE) ; =$H seconds^text
"RTN","BPSOSL1",65,0)
 .N % S %=$P(X,U)
"RTN","BPSOSL1",66,0)
 .I %'=PREVTIME S PREVTIME=% D
"RTN","BPSOSL1",67,0)
 ..S %=PREVTIME W $J(%\3600,2),":" S %=%#3600
"RTN","BPSOSL1",68,0)
 ..W $TR($J(%\60,2)," ","0"),":" S %=$J(%#60,2) W $TR(%," ",0)
"RTN","BPSOSL1",69,0)
 .S X=$P(X,U,2,$L(X,U))
"RTN","BPSOSL1",70,0)
 .N I F I=1:LEN:$L(X) D  Q:STOP
"RTN","BPSOSL1",71,0)
 ..I I>1 W ?6,"..."
"RTN","BPSOSL1",72,0)
 ..W ?10,$E(X,I,I+LEN-1),!
"RTN","BPSOSL1",73,0)
 ..D EOP
"RTN","BPSOSL1",74,0)
 Q
"RTN","BPSOSL1",75,0)
EOP ; end of page handling
"RTN","BPSOSL1",76,0)
 ; set STOP if the user wants to get out
"RTN","BPSOSL1",77,0)
 S STOP=$$EOPQ^BPSOSU8(2,,"D HDR^"_$T(+0))
"RTN","BPSOSL1",78,0)
 Q
"RTN","BPSOSL1",79,0)
HDR W @IOF,"Log file #",SLOT,! Q
"RTN","BPSOSM")
0^184^B5785595
"RTN","BPSOSM",1,0)
BPSOSM ;BHAM ISC/FCS/DRS/DLF - Report Master (.61) ;06/01/2004
"RTN","BPSOSM",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSM",3,0)
 ;
"RTN","BPSOSM",4,0)
 ; BPSOSM1 - takes care of updating of file .61
"RTN","BPSOSM",5,0)
 ; BPSOSM2 - some report headers called from Print options
"RTN","BPSOSM",6,0)
 ; BPSOSMA-BPSOSM* for lowercase * - general inquiry/report on .57
"RTN","BPSOSM",7,0)
 ;
"RTN","BPSOSM",8,0)
 Q
"RTN","BPSOSM",9,0)
MESSAGE(IEN57,N) ;EP - message sent in e-claim response
"RTN","BPSOSM",10,0)
 I 'IEN57 Q ""
"RTN","BPSOSM",11,0)
 N RESP,POS D RESPPOS(IEN57) Q:'RESP!'POS ""
"RTN","BPSOSM",12,0)
 I '$D(N) S N=0
"RTN","BPSOSM",13,0)
 I N=1 Q $$MESSAGE^BPSOS03(RESP,POS,1)
"RTN","BPSOSM",14,0)
 I N=2 Q $$MESSAGE^BPSOS03(RESP,POS,2)
"RTN","BPSOSM",15,0)
 Q $$MESSAGE^BPSOS03(RESP,POS)
"RTN","BPSOSM",16,0)
RESPPOS(IEN57) ;EP - caller should N RESP,POS
"RTN","BPSOSM",17,0)
 I $G(^BPSTL(IEN57,4)) D  ; reversal
"RTN","BPSOSM",18,0)
 . S RESP=$P(^BPSTL(IEN57,4),U,2)
"RTN","BPSOSM",19,0)
 . S POS=1
"RTN","BPSOSM",20,0)
 E  D
"RTN","BPSOSM",21,0)
 . S RESP=$P(^BPSTL(IEN57,0),U,5)
"RTN","BPSOSM",22,0)
 . S POS=$P(^BPSTL(IEN57,0),U,9)
"RTN","BPSOSM",23,0)
 Q
"RTN","BPSOSM",24,0)
 ; Computed fields:
"RTN","BPSOSM",25,0)
INSHELP(D0) ;EP - (#10002) INSURER HELP #
"RTN","BPSOSM",26,0)
 N X S X=$P($G(^BPSECX("RPT",D0,0)),U,3) I 'X Q "" ; IEN57
"RTN","BPSOSM",27,0)
 S X=$P($G(^BPSTL(X,1)),U,6) I 'X Q "" ; INSURER
"RTN","BPSOSM",28,0)
 S X=$G(^BPSEI(X,100)) I X="" Q "" ; insurer pharm e-claims info
"RTN","BPSOSM",29,0)
 N Y S Y=$P(X,U,5) I Y]"" Q Y ; specific phone # for insurer
"RTN","BPSOSM",30,0)
 S X=$P(X,U) I 'X Q "" ; format
"RTN","BPSOSM",31,0)
 Q $P($G(^BPSF(9002313.92,X,1)),U,5) ; phone # as stored with format
"RTN","BPSOSM",32,0)
RELTIME(D0) ;EP - (#10003) RX RELEASED DATE/TIME
"RTN","BPSOSM",33,0)
 N RXI,RXR D D0RXIRXR
"RTN","BPSOSM",34,0)
 I RXI=""!(RXR="") Q "" ; should never happen
"RTN","BPSOSM",35,0)
 I RXR Q $P($G(^PSRX(RXI,1,RXR,0)),U,17)
"RTN","BPSOSM",36,0)
 E  Q $P($G(^PSRX(RXI,2)),U,13)
"RTN","BPSOSM",37,0)
RETSTOCK(D0) ;EP - (#10004) RX RETURNED TO STOCK
"RTN","BPSOSM",38,0)
 N RXI,RXR D D0RXIRXR
"RTN","BPSOSM",39,0)
 I RXI=""!(RXR="") Q "" ; should never happen
"RTN","BPSOSM",40,0)
 I RXR Q +$P($G(^PSRX(RXI,1,RXR,0)),U,16)
"RTN","BPSOSM",41,0)
 E  Q +$P($G(^PSRX(RXI,2)),U,15)
"RTN","BPSOSM",42,0)
DELETED(D0) ; EP - (#10001) RX DELETED
"RTN","BPSOSM",43,0)
 N RXI,RXR D D0RXIRXR
"RTN","BPSOSM",44,0)
 I RXI=""!(RXR="") Q "" ; should never happen
"RTN","BPSOSM",45,0)
 Q $$RXDEL^BPSOS(RXI,RXR)
"RTN","BPSOSM",46,0)
QTY(D0) ;EP -
"RTN","BPSOSM",47,0)
 N RXI,RXR D D0RXIRXR Q:RXI=""!(RXR="")
"RTN","BPSOSM",48,0)
 I RXR Q $P($G(^PSRX(RXI,1,RXR,0)),U,4)
"RTN","BPSOSM",49,0)
 E  Q $P($G(^PSRX(RXI,0)),U,7)
"RTN","BPSOSM",50,0)
D0RXIRXR ; set up RXI,RXR,R for computed fields for ien D0
"RTN","BPSOSM",51,0)
 N X S X=$G(^BPSECX("RPT",D0,0)),RXI=$P(X,U,4),RXR=$P(X,U,5)
"RTN","BPSOSM",52,0)
 Q
"RTN","BPSOSM",53,0)
RELDATE(D0) ;
"RTN","BPSOSM",54,0)
 N VAL
"RTN","BPSOSM",55,0)
 S VAL=$P($G(^BPSECX("RPT",D0,0)),"^",1)
"RTN","BPSOSM",56,0)
 I VAL?1N.N N Y S Y=VAL D DD^%DT S VAL=Y
"RTN","BPSOSM",57,0)
 Q VAL
"RTN","BPSOSM",58,0)
 ;
"RTN","BPSOSM",59,0)
GREVDT(D0) ;
"RTN","BPSOSM",60,0)
 N CIEN,VAL,VAR
"RTN","BPSOSM",61,0)
 S VAL=""
"RTN","BPSOSM",62,0)
 S CIEN=$P($G(^BPSC(D0,4)),"^")
"RTN","BPSOSM",63,0)
 I CIEN'="" S VAL=$P($G(^BPSC(CIEN,0)),"^",5)
"RTN","BPSOSM",64,0)
 Q VAL
"RTN","BPSOSM",65,0)
SORTDT(D0) ;
"RTN","BPSOSM",66,0)
 Q $P($G(^BPSECX("RPT",D0,0)),"^",$P($G(^TMP($J,"REPORT")),"^",3))
"RTN","BPSOSM1")
0^185^B39971507
"RTN","BPSOSM1",1,0)
BPSOSM1 ;BHAM ISC/FCS/DRS/DLF - build Report Master data ;06/01/2004
"RTN","BPSOSM1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSM1",3,0)
 Q
"RTN","BPSOSM1",4,0)
 ;
"RTN","BPSOSM1",5,0)
 ; File 9002313.61 - BPS REPORT MASTER
"RTN","BPSOSM1",6,0)
 ;  Purpose: make it easy to use Fileman to get data,
"RTN","BPSOSM1",7,0)
 ;  by storing pointers to various places, indexed by Release Date
"RTN","BPSOSM1",8,0)
 ;
"RTN","BPSOSM1",9,0)
MANUAL ; BPS UPDATE REPORT MASTER FILE menu option entry point
"RTN","BPSOSM1",10,0)
 N X
"RTN","BPSOSM1",11,0)
 L +^BPS(9002313.99,1,$T(+0)):+0 I '$T D  Q
"RTN","BPSOSM1",12,0)
 . W !,"The REPORT MASTER FILE is in use.",$C(7)
"RTN","BPSOSM1",13,0)
 S X='$$UPDATE61()
"RTN","BPSOSM1",14,0)
 G AUTO9
"RTN","BPSOSM1",15,0)
 ;
"RTN","BPSOSM1",16,0)
AUTO(SILENT) ; EP - entry action to the claims report menu
"RTN","BPSOSM1",17,0)
 ; automatically update for a few days prior to the last update
"RTN","BPSOSM1",18,0)
 ; up through the end of today
"RTN","BPSOSM1",19,0)
 N PRVLOG
"RTN","BPSOSM1",20,0)
 ; - No new transactions since the last update ran
"RTN","BPSOSM1",21,0)
 S PRVLOG=+$$GET1^DIQ(9002313.99,1,119.05,"I") I '$O(^BPSTL(PRVLOG)) Q
"RTN","BPSOSM1",22,0)
 I '$D(SILENT) D  S SILENT=1
"RTN","BPSOSM1",23,0)
 . W !,"...updating the Report Master file, please stand by...",!
"RTN","BPSOSM1",24,0)
 L +^BPS(9002313.99,1,$T(+0)):+0 Q:'$T  ; could be timing probs; just go on
"RTN","BPSOSM1",25,0)
 I 'PRVLOG,'SILENT W !,"The REPORT MASTER FILE is being prepared for its first use.",!
"RTN","BPSOSM1",26,0)
 I 'SILENT W !,"Updating the Report Master file..."
"RTN","BPSOSM1",27,0)
 ;
"RTN","BPSOSM1",28,0)
 I '$$UPDATE61(PRVLOG,SILENT) G AUTO9
"RTN","BPSOSM1",29,0)
 ;
"RTN","BPSOSM1",30,0)
AUTO9 L -^BPS(9002313.99,1,$T(+0))
"RTN","BPSOSM1",31,0)
 Q
"RTN","BPSOSM1",32,0)
UPDATE61(FIRSTLOG,SILENT) ; EP - update the .61 file.
"RTN","BPSOSM1",33,0)
 ; If called with $$, returns 1 success, 0 failure
"RTN","BPSOSM1",34,0)
 N LASTLOG,NLSTLOG
"RTN","BPSOSM1",35,0)
 I '$D(SILENT) S SILENT=0
"RTN","BPSOSM1",36,0)
 I '$$LOCK61 D  Q 0
"RTN","BPSOSM1",37,0)
 . I 'SILENT W !,"Someone else is already using this program.",!
"RTN","BPSOSM1",38,0)
 ;
"RTN","BPSOSM1",39,0)
 I '$D(FIRSTLOG) D  I FIRSTLOG="^" Q 0
"RTN","BPSOSM1",40,0)
 . N DIR,DTOUT,DUOUT,DIRUT,DATE,X,Y,LGBDT,LGEDT,RPDATE
"RTN","BPSOSM1",41,0)
 . S FIRSTLOG=+$$GET1^DIQ(9002313.99,1,119.05,"I")
"RTN","BPSOSM1",42,0)
 . I 'FIRSTLOG!'$D(^BPSECX("RPT","AD")) D  Q
"RTN","BPSOSM1",43,0)
 . . W !!,"The REPORT MASTER FILE will be updated for its first use.",!
"RTN","BPSOSM1",44,0)
 . . K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="CONFIRM" D ^DIR I Y=0!$D(DIRUT) S FIRSTLOG="^" Q
"RTN","BPSOSM1",45,0)
 . W !!,"Choose the start date to build the REPORT MASTER FILE",!
"RTN","BPSOSM1",46,0)
 . S LGBDT=$O(^BPSTL("AH",0))\1,LGEDT=$O(^BPSTL("AH",""),-1)\1,RPDATE=$O(^BPSECX("RPT","AD",""),-1)
"RTN","BPSOSM1",47,0)
 . S DIR("?",1)="Enter the START date to rebuild the REPORT MASTER FILE."
"RTN","BPSOSM1",48,0)
 . S DIR("?")="It must be between "_$$FMTE^DILIBF(LGBDT,"5U")_" and "_$$FMTE^DILIBF(RPDATE,"5U")
"RTN","BPSOSM1",49,0)
 . S DIR(0)="D^"_LGBDT_":"_RPDATE_":EX",DIR("A")="START TRANSACTION DATE" D ^DIR I $D(DIRUT) S FIRSTLOG="^" Q
"RTN","BPSOSM1",50,0)
 . S STDATE=Y,DATE=$O(^BPSTL("AH",STDATE),-1),FIRSTLOG=0 S:DATE FIRSTLOG=$O(^BPSTL("AH",DATE,0))-1
"RTN","BPSOSM1",51,0)
 . S DIR("?",1)="Enter the END date to rebuild the REPORT MASTER FILE."
"RTN","BPSOSM1",52,0)
 . S DIR("?")="It must be between "_$$FMTE^DILIBF(STDATE,"5U")_" and TODAY"
"RTN","BPSOSM1",53,0)
 . S DIR(0)="D^"_STDATE_":"_DT_":EX",DIR("A")="  END TRANSACTION DATE" D ^DIR I $D(DIRUT) S FIRSTLOG="^" Q
"RTN","BPSOSM1",54,0)
 . S ENDATE=Y,DATE=$O(^BPSTL("AH",ENDATE),-1) S:'DATE DATE=ENDATE S LASTLOG=$O(^BPSTL("AH",DATE,0),-1)
"RTN","BPSOSM1",55,0)
 . W !!,"The REPORT MASTER FILE will be updated for the date range: "
"RTN","BPSOSM1",56,0)
 . W !!?20,"From ",$$FMTE^DILIBF(STDATE,"5U"),"  Thru  ",$$FMTE^DILIBF(ENDATE,"5U"),!
"RTN","BPSOSM1",57,0)
 . K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="CONFIRM" D ^DIR I Y=0!$D(DIRUT) S FIRSTLOG="^" Q
"RTN","BPSOSM1",58,0)
 ;
"RTN","BPSOSM1",59,0)
 I 'SILENT W !,"Processing..."
"RTN","BPSOSM1",60,0)
 D BUILD61(FIRSTLOG,$G(LASTLOG),.NLSTLOG)
"RTN","BPSOSM1",61,0)
 S $P(^BPS(9002313.99,1,$T(+0)),U,4)=$$NOW
"RTN","BPSOSM1",62,0)
 I $G(NLSTLOG),NLSTLOG>$P($G(^BPS(9002313.99,1,$T(+0))),U,5) D
"RTN","BPSOSM1",63,0)
 . S $P(^BPS(9002313.99,1,$T(+0)),U,5)=NLSTLOG
"RTN","BPSOSM1",64,0)
 D UNLOCK61
"RTN","BPSOSM1",65,0)
 I 'SILENT W "Done!",!
"RTN","BPSOSM1",66,0)
 Q 1
"RTN","BPSOSM1",67,0)
 ;
"RTN","BPSOSM1",68,0)
BUILD61(FIRSTLOG,LASTLOG,NLSTLOG) ; Build file 9002313.61 from the BPS TRANSACTION LOG file (#9002313.57)
"RTN","BPSOSM1",69,0)
 N IEN,LOGIEN,RXI,RXR
"RTN","BPSOSM1",70,0)
 S LOGIEN=+FIRSTLOG,LASTLOG=+$G(LASTLOG)
"RTN","BPSOSM1",71,0)
 F  S LOGIEN=$O(^BPSTL(LOGIEN)) Q:'LOGIEN!(LASTLOG&(LOGIEN>LASTLOG))  D
"RTN","BPSOSM1",72,0)
 . I $D(^BPSECX("RPT","AE",LOGIEN)) D
"RTN","BPSOSM1",73,0)
 . . S IEN=$O(^BPSECX("RPT","AE",LOGIEN,0)) D DELETE(IEN)
"RTN","BPSOSM1",74,0)
 . S RXI=$$GET1^DIQ(9002313.57,LOGIEN,1.11,"I")
"RTN","BPSOSM1",75,0)
 . S RXR=$$GET1^DIQ(9002313.57,LOGIEN,9,"I")
"RTN","BPSOSM1",76,0)
 . I RXR,'$D(^PSRX(RXI,1,RXR)) Q
"RTN","BPSOSM1",77,0)
 . D ONE S NLSTLOG=LOGIEN
"RTN","BPSOSM1",78,0)
 Q
"RTN","BPSOSM1",79,0)
 ;
"RTN","BPSOSM1",80,0)
LOCK61() L +^BPSECX("RPT"):0 Q $T
"RTN","BPSOSM1",81,0)
UNLOCK61 L -^BPSECX("RPT") Q
"RTN","BPSOSM1",82,0)
DELETE(IEN) ;
"RTN","BPSOSM1",83,0)
 N FDA,MSG
"RTN","BPSOSM1",84,0)
 S FDA(9002313.61,IEN_",",.01)=""
"RTN","BPSOSM1",85,0)
D5 D FILE^DIE(,"FDA","MSG")
"RTN","BPSOSM1",86,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSM1",87,0)
 D ZWRITE^BPSOS("FDA","MSG")
"RTN","BPSOSM1",88,0)
 G D5:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"DELETE",$T(+0))
"RTN","BPSOSM1",89,0)
 Q
"RTN","BPSOSM1",90,0)
FIND() ; look for existing RXI,RXR entry in 9002313.61
"RTN","BPSOSM1",91,0)
 N IEN,FOUND S (IEN,FOUND)=0
"RTN","BPSOSM1",92,0)
 F  S IEN=$O(^BPSECX("RPT","C",RXI,IEN)) Q:'IEN  D  Q:FOUND
"RTN","BPSOSM1",93,0)
 . N X S X=^BPSECX("RPT",IEN,0)
"RTN","BPSOSM1",94,0)
 . I $P(X,U,5)=RXR S FOUND=IEN
"RTN","BPSOSM1",95,0)
 Q FOUND
"RTN","BPSOSM1",96,0)
ONE ; RXI, RXR released at time WHEN
"RTN","BPSOSM1",97,0)
 N FDA,MSG,FN,IENS,IEN57,XRXARY,RXIEN,RXRIEN,RXINFO
"RTN","BPSOSM1",98,0)
 S RXARY="RXINFO"
"RTN","BPSOSM1",99,0)
 S IENS=$$FIND
"RTN","BPSOSM1",100,0)
 I '$$FIND S IENS="+1"
"RTN","BPSOSM1",101,0)
 S IENS=IENS_","
"RTN","BPSOSM1",102,0)
 S FN=9002313.61
"RTN","BPSOSM1",103,0)
 S (IEN57,FDA(FN,IENS,.03))=$$LAST57^BPSOSBB(RXI,RXR)
"RTN","BPSOSM1",104,0)
 D GETS^DIQ("52",RXI,"1;22;31;52*","I",RXARY)
"RTN","BPSOSM1",105,0)
 S RXIEN=RXI_",",RXRIEN=RXR_","_RXIEN
"RTN","BPSOSM1",106,0)
 ; added "I IEN57" to next line
"RTN","BPSOSM1",107,0)
 I IEN57 S FDA(FN,IENS,.02)=$P($P($G(^BPSTL(IEN57,0)),U,8),".") ;BPS*1.0T7*1
"RTN","BPSOSM1",108,0)
 ;
"RTN","BPSOSM1",109,0)
 S FDA(FN,IENS,.04)=RXI
"RTN","BPSOSM1",110,0)
 S FDA(FN,IENS,.05)=RXR
"RTN","BPSOSM1",111,0)
 I RXR=0  D
"RTN","BPSOSM1",112,0)
 .I RXINFO(52,RXIEN,31,"I")\1=0  D
"RTN","BPSOSM1",113,0)
 ..S FDA(FN,IENS,.01)="NOT RELEASED"
"RTN","BPSOSM1",114,0)
 .E  D
"RTN","BPSOSM1",115,0)
 ..S FDA(FN,IENS,.01)=RXINFO(52,RXIEN,31,"I")\1
"RTN","BPSOSM1",116,0)
 .I $G(^PSRX($P(RXIEN,","),"L",1,0)) S FDA(FN,IENS,.095)=$P(^PSRX($P(RXIEN,","),"L",1,0),"^")\1
"RTN","BPSOSM1",117,0)
 .S FDA(FN,IENS,.08)=RXINFO(52,RXIEN,22,"I")
"RTN","BPSOSM1",118,0)
 .S FDA(FN,IENS,.09)=RXINFO(52,RXIEN,1,"I")
"RTN","BPSOSM1",119,0)
 E  D
"RTN","BPSOSM1",120,0)
 .I RXINFO(52.1,RXRIEN,17,"I")\1=0  D
"RTN","BPSOSM1",121,0)
 ..S FDA(FN,IENS,.01)="NOT RELEASED"
"RTN","BPSOSM1",122,0)
 .E  D
"RTN","BPSOSM1",123,0)
 ..S FDA(FN,IENS,.01)=RXINFO(52.1,RXRIEN,17,"I")\1
"RTN","BPSOSM1",124,0)
 .I $G(^PSRX($P(RXIEN,","),"L",1,0)) S FDA(FN,IENS,.095)=$P(^PSRX($P(RXIEN,","),"L",1,0),"^")\1
"RTN","BPSOSM1",125,0)
 .S FDA(FN,IENS,.08)=RXINFO(52.1,RXRIEN,.01,"I")
"RTN","BPSOSM1",126,0)
 .S FDA(FN,IENS,.09)=RXINFO(52.1,RXRIEN,10.1,"I")
"RTN","BPSOSM1",127,0)
 N RWR,X
"RTN","BPSOSM1",128,0)
 I IEN57 S RWR=$$GET1^DIQ(9002313.57,IEN57_",","RESULT WITH REVERSAL")
"RTN","BPSOSM1",129,0)
 E  S RWR=""
"RTN","BPSOSM1",130,0)
 ;
"RTN","BPSOSM1",131,0)
 ; Note!  Computed fields rely on these code values.
"RTN","BPSOSM1",132,0)
 ; Also, AMOUNT OTHER takes in all the X<0 cases
"RTN","BPSOSM1",133,0)
 ;
"RTN","BPSOSM1",134,0)
 I RWR?1"E ".E D
"RTN","BPSOSM1",135,0)
 . S X=RWR
"RTN","BPSOSM1",136,0)
 . I X="E PAYABLE" S X=4
"RTN","BPSOSM1",137,0)
 . E  I X="E CAPTURED" S X=3
"RTN","BPSOSM1",138,0)
 . E  I X="E DUPLICATE" S X=2
"RTN","BPSOSM1",139,0)
 . E  I X="E REJECTED" S X=1
"RTN","BPSOSM1",140,0)
 . E  I X="E REVERSAL ACCEPTED" S X=11
"RTN","BPSOSM1",141,0)
 . E  I X="E REVERSAL REJECTED" S X=12
"RTN","BPSOSM1",142,0)
 . E  S X=0
"RTN","BPSOSM1",143,0)
 E  I RWR="PAPER" S X=9
"RTN","BPSOSM1",144,0)
 E  I RWR="PAPER REVERSAL" S X=19
"RTN","BPSOSM1",145,0)
 E  S X=15
"RTN","BPSOSM1",146,0)
 S FDA(FN,IENS,.06)=X
"RTN","BPSOSM1",147,0)
 ;
"RTN","BPSOSM1",148,0)
 ; If the claim has any message text, store it
"RTN","BPSOSM1",149,0)
 N MSGTEXT
"RTN","BPSOSM1",150,0)
 I RWR?1"E ".E D
"RTN","BPSOSM1",151,0)
 . S X=$$MESSAGE^BPSOSM(IEN57,1)
"RTN","BPSOSM1",152,0)
 . I X]"" S MSGTEXT(1)=X
"RTN","BPSOSM1",153,0)
 . S X=$$MESSAGE^BPSOSM(IEN57,2)
"RTN","BPSOSM1",154,0)
 . I X]"" S MSGTEXT(2)=X
"RTN","BPSOSM1",155,0)
 I $D(MSGTEXT) S FDA(FN,IENS,1300)="MSGTEXT"
"RTN","BPSOSM1",156,0)
 E  S FDA(FN,IENS,1300)=""
"RTN","BPSOSM1",157,0)
 ; 
"RTN","BPSOSM1",158,0)
 ; If it's a rejected claim, build the rejection text
"RTN","BPSOSM1",159,0)
 ;
"RTN","BPSOSM1",160,0)
 N REJTEXT
"RTN","BPSOSM1",161,0)
 I RWR="E REJECTED"!(RWR="E REVERSAL REJECTED") D
"RTN","BPSOSM1",162,0)
 . N RESP,ECME D RESPPOS^BPSOSM(IEN57) ; set RESP,ECME pointers
"RTN","BPSOSM1",163,0)
 . D REJTEXT^BPSOS03(RESP,POS,.REJTEXT)
"RTN","BPSOSM1",164,0)
 . ; word processing text goes into FDA(FILE,IENS,FIELD,n)=text
"RTN","BPSOSM1",165,0)
 . S FDA(FN,IENS,1800)=$S($D(REJTEXT):"REJTEXT",1:"")
"RTN","BPSOSM1",166,0)
 E  S FDA(FN,IENS,1800)=""
"RTN","BPSOSM1",167,0)
ONE5 I IENS["+" D
"RTN","BPSOSM1",168,0)
 . D UPDATE^DIE(,"FDA",,"MSG")
"RTN","BPSOSM1",169,0)
 E  D
"RTN","BPSOSM1",170,0)
 . D FILE^DIE(,"FDA","MSG")
"RTN","BPSOSM1",171,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSM1",172,0)
 D ZWRITE^BPSOS("IENS","FDA","MSG")
"RTN","BPSOSM1",173,0)
 G ONE5:$$IMPOSS^BPSOSUE("FM","TRI",$S(IENS["+":"UPDATE",1:"FILE")_"^DIE failed",,"ONE5",$T(+0))
"RTN","BPSOSM1",174,0)
 Q
"RTN","BPSOSM1",175,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSM1",176,0)
 Q
"RTN","BPSOSM2")
0^186^B18267050
"RTN","BPSOSM2",1,0)
BPSOSM2 ;BHAM ISC/FCS/DRS/DLF - Report Master (.61) ;06/01/2004
"RTN","BPSOSM2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSM2",3,0)
 ;
"RTN","BPSOSM2",4,0)
 ; BPSOSM2 - headers called from some Fileman reports
"RTN","BPSOSM2",5,0)
 ;  D0 points to 9002313.61
"RTN","BPSOSM2",6,0)
 ;
"RTN","BPSOSM2",7,0)
 Q
"RTN","BPSOSM2",8,0)
PAYABLE ;
"RTN","BPSOSM2",9,0)
 D HDR N X S $P(X,"-",81)="" W !,X
"RTN","BPSOSM2",10,0)
 W !,"DATE",?10,"PATIENT NAME",?31,"L4SSN",?38,"PRESC/FILL",?49,"EXTERNAL Rx#",?62,"$BILLED",?72,"INS.PAID"
"RTN","BPSOSM2",11,0)
 W !,"DRUG",?44,$S(+$P(BPSSRT,"@",2)=.02:"LAST RELEASE DATE",1:"TRANSACTION DATE"),?70,"RX STAT"
"RTN","BPSOSM2",12,0)
 W !,X
"RTN","BPSOSM2",13,0)
 Q
"RTN","BPSOSM2",14,0)
NOTREL ;
"RTN","BPSOSM2",15,0)
 D HDR N X S $P(X,"-",81)="" W !,X
"RTN","BPSOSM2",16,0)
 W !,"DATE",?10,"PATIENT NAME",?31,"L4SSN",?38,"PRESC/FILL",?49,"EXTERNAL Rx#",?62,"$BILLED",?72,"INS.PAID"
"RTN","BPSOSM2",17,0)
 W !,"DRUG",?70,"RX STAT"
"RTN","BPSOSM2",18,0)
 W !,X
"RTN","BPSOSM2",19,0)
 Q
"RTN","BPSOSM2",20,0)
REJECTED ;
"RTN","BPSOSM2",21,0)
 D HDR N X S $P(X,"-",81)="" W !,X
"RTN","BPSOSM2",22,0)
 W !,"DATE",?9,"PATIENT NAME",?29,"L4SSN",?36,"Rx#/FILL",?47,"EXT. Rx#",?58,"RX STAT",?67,"NDC NUMBER"
"RTN","BPSOSM2",23,0)
 W !,"CARDHOLDER ID",?19,"GROUP ID",?37,"QTY",?42,"$BILLED",?51,"DRUG",?63,"LAST RELEASE DATE"
"RTN","BPSOSM2",24,0)
 W !,X
"RTN","BPSOSM2",25,0)
 Q
"RTN","BPSOSM2",26,0)
CAPTURED ;
"RTN","BPSOSM2",27,0)
 D HDR N X S $P(X,"-",81)="" W !,X
"RTN","BPSOSM2",28,0)
 W !,"DATE",?9,"PATIENT NAME",?28,"L4SSN",?35,"Rx#/FILL ",?48,"$BILLED",?56,"DRUG"
"RTN","BPSOSM2",29,0)
 W !,X
"RTN","BPSOSM2",30,0)
 Q
"RTN","BPSOSM2",31,0)
DUPLIC ;
"RTN","BPSOSM2",32,0)
 D HDR N X S $P(X,"-",81)="" W !,X
"RTN","BPSOSM2",33,0)
 W !,"DATE",?9,"PATIENT NAME",?30,"L4SSN",?37,"Rx#/FILL ",?47,"$BILLED",?58,"DRUG"
"RTN","BPSOSM2",34,0)
 W !,X
"RTN","BPSOSM2",35,0)
 Q
"RTN","BPSOSM2",36,0)
PAPER ;
"RTN","BPSOSM2",37,0)
 D HDR N X S $P(X,"-",81)="" W !,X
"RTN","BPSOSM2",38,0)
 W !,"DATE",?9,"PATIENT NAME",?29,"L4SSN",?36,"Rx#/FILL",?46,"$BILLED",?56,"DRUG"
"RTN","BPSOSM2",39,0)
 W !,X
"RTN","BPSOSM2",40,0)
 Q
"RTN","BPSOSM2",41,0)
MISSED ;
"RTN","BPSOSM2",42,0)
 D HDR N X S $P(X,"-",81)="" W !,X
"RTN","BPSOSM2",43,0)
 W !,"DATE",?9,"Rx#/FILL",?20,"EXTERNAL Rx#",?33,"DRUG",?60,"REVERSAL RESULT"
"RTN","BPSOSM2",44,0)
 W !,X
"RTN","BPSOSM2",45,0)
 Q
"RTN","BPSOSM2",46,0)
NEEDREV ;
"RTN","BPSOSM2",47,0)
 D HDR N X S $P(X,"-",81)="" W !,X
"RTN","BPSOSM2",48,0)
 W !,"DATE",?9,"Rx#/FILL",?20,"EXTERNAL Rx#",?33,"DRUG",?60,"REVERSAL RESULT"
"RTN","BPSOSM2",49,0)
 W !,X
"RTN","BPSOSM2",50,0)
 Q
"RTN","BPSOSM2",51,0)
DAY ;
"RTN","BPSOSM2",52,0)
 D HDR N X S $P(X,"-",81)="" W !,X
"RTN","BPSOSM2",53,0)
 W !?10,"PAYABLE",?20,"SHORTED",?32,"PAPER",?39,"CAPTURED",?50,"REJECTED",?60,"UNINSURED",?75,"OTHER"
"RTN","BPSOSM2",54,0)
 W !,X
"RTN","BPSOSM2",55,0)
 Q
"RTN","BPSOSM2",56,0)
CLOSED ;
"RTN","BPSOSM2",57,0)
 D HDR N X S $P(X,"-",81)="" W !,X
"RTN","BPSOSM2",58,0)
 W !,"DATE",?9,"PATIENT NAME",?34,"PRESCR/FILL",?47,"DRUG"
"RTN","BPSOSM2",59,0)
 W !,"CLAIM ID",?31,"CARDHOLDER ID",?51,"GROUP ID"
"RTN","BPSOSM2",60,0)
 W !,X
"RTN","BPSOSM2",61,0)
 Q
"RTN","BPSOSM2",62,0)
ELIG() ;
"RTN","BPSOSM2",63,0)
 N IEN57 S IEN57=$$IEN57 Q:'IEN57 ""
"RTN","BPSOSM2",64,0)
 N PAT S PAT=$P($G(^BPSTL(IEN57,0)),U,6)
"RTN","BPSOSM2",65,0)
 Q "ELIGIBILITY STATUS: "_$$GET1^DIQ(9000001,PAT_",",1112)
"RTN","BPSOSM2",66,0)
 ;
"RTN","BPSOSM2",67,0)
INSURER() N IEN4 S IEN4=$$IEN4 Q:'IEN4 ""
"RTN","BPSOSM2",68,0)
 N X,Y
"RTN","BPSOSM2",69,0)
 I Y]"" S X=X_"   Help Desk:"_Y
"RTN","BPSOSM2",70,0)
 Q X
"RTN","BPSOSM2",71,0)
 ;
"RTN","BPSOSM2",72,0)
FILTER(D0,TYPE) ; Filter for Payable and Reversal Claims
"RTN","BPSOSM2",73,0)
 N RTYPE,VAL
"RTN","BPSOSM2",74,0)
 S VAL=1
"RTN","BPSOSM2",75,0)
 I TYPE="PAY" D
"RTN","BPSOSM2",76,0)
 .  S RTYPE=$P($G(^BPSECX("RPT",D0,0)),"^",6)
"RTN","BPSOSM2",77,0)
 .  I RTYPE'=2 S VAL=0
"RTN","BPSOSM2",78,0)
 I TYPE="REV" D
"RTN","BPSOSM2",79,0)
 .  S RTYPE=$P($G(^BPSECX("RPT",D0,0)),"^",6)
"RTN","BPSOSM2",80,0)
 .  I RTYPE'=8&(RTYPE'=10) S VAL=0
"RTN","BPSOSM2",81,0)
 Q VAL
"RTN","BPSOSM2",82,0)
 ;
"RTN","BPSOSM2",83,0)
IEN4() N X S X=$$IEN57 Q:'X ""
"RTN","BPSOSM2",84,0)
 Q $P($G(^BPSTL(X,1)),U,6)
"RTN","BPSOSM2",85,0)
IEN56() N X S X=$$IEN57 Q:'X ""
"RTN","BPSOSM2",86,0)
 Q $P($G(^BPSTL(X,1)),U,7)
"RTN","BPSOSM2",87,0)
IEN57() Q:'D0 "" Q $P($G(^BPSECX("RPT",D0,0)),U,3) ; TRANSACTION
"RTN","BPSOSM2",88,0)
 ;
"RTN","BPSOSM2",89,0)
HDR ; Report Header
"RTN","BPSOSM2",90,0)
 I $G(BPSTYPE)="NEEDREV" W "PRESCRIPTIONS NEEDING REVERSALS IN ECME"
"RTN","BPSOSM2",91,0)
 E  I $G(BPSTYPE)="MISSED" W "PRESCRIPTIONS MISSED BY ECME"
"RTN","BPSOSM2",92,0)
 E  I $G(BPSTYPE)="NOTREL" W "CLAIM SUBMITTED - PRESCRIPTION NOT RELEASED"
"RTN","BPSOSM2",93,0)
 E  I $G(BPSTYPE)="DAY" W "TOTALS BY DATE"
"RTN","BPSOSM2",94,0)
 E  I $G(BPSTYPE)="CLOSED" W "CLOSED CLAIMS REPORT"
"RTN","BPSOSM2",95,0)
 E  W "ECME CLAIMS REPORT FOR "_$P($G(^TMP($J,"REPORT")),"^",1)
"RTN","BPSOSM2",96,0)
 ;
"RTN","BPSOSM2",97,0)
 S PAG=$G(PAG)+1 W ?71,"Page: ",$J(PAG,3)
"RTN","BPSOSM2",98,0)
 W !,$$GET1^DIQ(9002313.56,BPSPHR,.01)_" NCPDP (NABP) #"_$$GET1^DIQ(9002313.56,BPSPHR,.02)
"RTN","BPSOSM2",99,0)
 W ?49,"Run Date: "_$G(^TMP($J,"REPORT","RUNDT"))
"RTN","BPSOSM2",100,0)
 W !,$S($G(BPSMW)="M":"MAIL",$G(BPSMW)="W":"WINDOW",1:"ALL")_" PRESCRIPTIONS BY "_$P($G(^TMP($J,"REPORT")),"^",2)_" DATE: From "
"RTN","BPSOSM2",101,0)
 W $$FMTE^XLFDT($G(^TMP($J,"REPORT","FR")),2)_" thru "_$$FMTE^XLFDT($G(^TMP($J,"REPORT","TO")),2),!
"RTN","BPSOSM2",102,0)
 Q
"RTN","BPSOSM2",103,0)
SHD ;
"RTN","BPSOSM2",104,0)
 N Y,RXR,RXI
"RTN","BPSOSM2",105,0)
 S Y=$P(^BPSECX("RPT",D0,0),U,2),RXI=$P(^(0),U,4),RXR=$P(^(0),U,5)
"RTN","BPSOSM2",106,0)
 S:BPSSRT[".02" Y=$S(RXR=0:$P($G(^PSRX(RXI,2)),"^",13),1:$P($G(^PSRX(RXI,1,RXR,0)),"^",18))
"RTN","BPSOSM2",107,0)
 I Y S Y=$P(Y,".") X ^DD("DD")
"RTN","BPSOSM2",108,0)
 E  S Y="NOT RELEASED"
"RTN","BPSOSM2",109,0)
 W ?45,Y
"RTN","BPSOSM2",110,0)
 Q
"RTN","BPSOSMA")
1^187
"RTN","BPSOSMB")
1^188
"RTN","BPSOSMC")
1^189
"RTN","BPSOSMZ")
1^191
"RTN","BPSOSN0")
1^192
"RTN","BPSOSN4")
1^196
"RTN","BPSOSN7")
1^199
"RTN","BPSOSNC")
0^201^B4332616
"RTN","BPSOSNC",1,0)
BPSOSNC ;BHAM ISC/FCS/DRS/DLF - PHARmacy ECME interface query from without ;06/01/2004
"RTN","BPSOSNC",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSNC",3,0)
 ;Target audience: the ANMC Nightly Checker
"RTN","BPSOSNC",4,0)
 ; Also, charge entry (At least at Sitka)
"RTN","BPSOSNC",5,0)
 ; May also be Ud by RXE,PAY option
"RTN","BPSOSNC",6,0)
 ; and who knows what else?
"RTN","BPSOSNC",7,0)
 Q
"RTN","BPSOSNC",8,0)
 ;
"RTN","BPSOSNC",9,0)
VMEDPAID(VMEDIEN)  ; $$VMEDPAID^BPSOSNC(pointer to V MEDICATION)
"RTN","BPSOSNC",10,0)
 ; Returns   TruthValueResult^PSRX ien^remarks
"RTN","BPSOSNC",11,0)
 ; True result I claim was paid (and not reversed)
"RTN","BPSOSNC",12,0)
 ; False result I claim was no paid (or was paid and reversed)
"RTN","BPSOSNC",13,0)
 ;
"RTN","BPSOSNC",14,0)
 Q 0
"RTN","BPSOSNC",15,0)
 ;
"RTN","BPSOSNC",16,0)
RXPAID(RXI,RXR) ;EP - $$RXPAID^BPSOSNC(pointer to 9002313.59 or to 52) 
"RTN","BPSOSNC",17,0)
 ; Returns: as desribed above F VMEDPAID
"RTN","BPSOSNC",18,0)
 ; First, compute IEN59
"RTN","BPSOSNC",19,0)
 N IEN59,RETVAL
"RTN","BPSOSNC",20,0)
 I RXI["." D
"RTN","BPSOSNC",21,0)
 . S IEN59=RXI
"RTN","BPSOSNC",22,0)
 . N X S X=$P(IEN59,".",2)
"RTN","BPSOSNC",23,0)
 . I $E(X,$L(X))'=1 D  Q  ; think through postage, supplies later
"RTN","BPSOSNC",24,0)
 . . N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("P","TI","postage/supplies not supported yet",,"RXPAID",$T(+0))
"RTN","BPSOSNC",25,0)
 . S X=$E(X,1,$L(X)-1) ; remove trailing 1 - should leave RXR
"RTN","BPSOSNC",26,0)
 . S RETVAL="0^"_$P(IEN59,".")_","_X
"RTN","BPSOSNC",27,0)
 E  D
"RTN","BPSOSNC",28,0)
 . I '$D(RXR) S RXR=$$RXRDEF^BPSOSRX(RXI)
"RTN","BPSOSNC",29,0)
 . S IEN59=$$IEN59^BPSOSRX(RXI,RXR)
"RTN","BPSOSNC",30,0)
 . S RETVAL="0^"_RXI_","_RXR
"RTN","BPSOSNC",31,0)
 ; Now, find out what happened to it.
"RTN","BPSOSNC",32,0)
 I $D(^BPST(IEN59,0)) D
"RTN","BPSOSNC",33,0)
 . I $P($G(^BPST(IEN59,3)),U,2) D
"RTN","BPSOSNC",34,0)
 . . S $P(RETVAL,U,3)="Canceled"
"RTN","BPSOSNC",35,0)
 . E  I '$P(^BPST(IEN59,0),U,4) D
"RTN","BPSOSNC",36,0)
 . . S $P(RETVAL,U,3)="No ECME claim sent"
"RTN","BPSOSNC",37,0)
 . E  I '$P(^BPST(IEN59,0),U,5) D
"RTN","BPSOSNC",38,0)
 . . S $P(RETVAL,U,3)="No ECME response received"
"RTN","BPSOSNC",39,0)
 . E  D  ; yes, we did get a claim-response cycle
"RTN","BPSOSNC",40,0)
 . . N X D RESPINFO^BPSOSQ4(IEN59,.X)
"RTN","BPSOSNC",41,0)
 . . S $P(RETVAL,U,3)=X("RSP")
"RTN","BPSOSNC",42,0)
 . . I X("RSP")="Payable" S $P(RETVAL,U)=1
"RTN","BPSOSNC",43,0)
 . . I X("RSP")="Captured" S $P(RETVAL,U)=1 ; 03/13/2001
"RTN","BPSOSNC",44,0)
 . . I X("RSP")="Rejected reversal" S $P(RETVAL,U)=1
"RTN","BPSOSNC",45,0)
 E  D
"RTN","BPSOSNC",46,0)
 . S $P(RETVAL,U,3)="No ECME record of prescription"
"RTN","BPSOSNC",47,0)
 Q RETVAL
"RTN","BPSOSO")
0^202^B3566865
"RTN","BPSOSO",1,0)
BPSOSO ;BHAM ISC/FCS/DRS/DLF - "O" is for Override NCPDP field values ;06/01/2004
"RTN","BPSOSO",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSO",3,0)
 ; 
"RTN","BPSOSO",4,0)
 ; File 9002313.511 BPS NCPDP OVERRIDE
"RTN","BPSOSO",5,0)
 ; It acts like an extension of the ^PSRX entry,
"RTN","BPSOSO",6,0)
 ; though it's not tied to ^PSRX in any structural way.
"RTN","BPSOSO",7,0)
 ; ^PSRX has a pointer to this file.
"RTN","BPSOSO",8,0)
 ;
"RTN","BPSOSO",9,0)
 ; IHS/SD/lwj 8/20/02 NCPDP 5.1 changes
"RTN","BPSOSO",10,0)
 ; In 5.1 there is now some repeating fields/records.  The DUR/PPS
"RTN","BPSOSO",11,0)
 ; segment is a repeating segment (i.e. all the fields in this
"RTN","BPSOSO",12,0)
 ; segment repeat.)  Much like the values for the BPS NCPDP 
"RTN","BPSOSO",13,0)
 ; Overrides are stored in a separate file, and referenced in
"RTN","BPSOSO",14,0)
 ; the prescription file, the DUR/PPS values will be stored in
"RTN","BPSOSO",15,0)
 ; a separate file (BPS DUR/PPS) and simply referenced in the 
"RTN","BPSOSO",16,0)
 ; prescription file.  For this reason, I'm adding the retrieval
"RTN","BPSOSO",17,0)
 ; of the prescription DUR/PPS pointer in this routine to keep
"RTN","BPSOSO",18,0)
 ; things consistent. (Site must have Outpatient Pharmacy V6.0
"RTN","BPSOSO",19,0)
 ; Patch 4 loaded for the DUR/PPS field to be found.)
"RTN","BPSOSO",20,0)
 ; 
"RTN","BPSOSO",21,0)
 Q
"RTN","BPSOSO",22,0)
 ;
"RTN","BPSOSO",23,0)
OVERRIDE(IEN)  ; main entry point
"RTN","BPSOSO",24,0)
 ; IEN points to file 9002313.511
"RTN","BPSOSO",25,0)
 ; Sometimes we have IEN; sometimes we don't
"RTN","BPSOSO",26,0)
 ; called from pharmacy package
"RTN","BPSOSO",27,0)
 ; called from somewhere in POS, too
"RTN","BPSOSO",28,0)
 I $D(IEN) D
"RTN","BPSOSO",29,0)
 . I '$D(^BPS(9002313.511,IEN)) D  ; it must have been winnowed
"RTN","BPSOSO",30,0)
 . . S IEN=$$NEW^BPSOSO2
"RTN","BPSOSO",31,0)
 E  D
"RTN","BPSOSO",32,0)
 . I '$D(IEN) S IEN=$$NEW^BPSOSO2
"RTN","BPSOSO",33,0)
 I 'IEN N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("FM,P","TI","Failed to create Overrides record / or bad parameter in call",,"OVERRIDE",$T(+0)) Q ""
"RTN","BPSOSO",34,0)
 D MENU^BPSOSO1(IEN)
"RTN","BPSOSO",35,0)
 Q IEN
"RTN","BPSOSO",36,0)
OVERRIDR(RXI,RXR)  ; alternative entry point - given RXI,RXR instead of IEN
"RTN","BPSOSO",37,0)
 N IEN
"RTN","BPSOSO",38,0)
 I $G(RXR) S IEN=$$GETIEN(RXI,RXR)
"RTN","BPSOSO",39,0)
 E  S IEN=$$GETIEN(RXI)
"RTN","BPSOSO",40,0)
 S IEN=$$OVERRIDE(IEN)
"RTN","BPSOSO",41,0)
 Q IEN
"RTN","BPSOSO",42,0)
GETIEN(RXI,RXR) ;EP -  also called from claim construction
"RTN","BPSOSO",43,0)
 N IEN
"RTN","BPSOSO",44,0)
 I $G(RXR) S IEN=$P($G(^PSRX(RXI,1,RXR,9999999)),U,12)
"RTN","BPSOSO",45,0)
 E  S IEN=$P($G(^PSRX(RXI,9999999)),U,12)
"RTN","BPSOSO",46,0)
 Q IEN
"RTN","BPSOSO",47,0)
 ;
"RTN","BPSOSO",48,0)
 ;
"RTN","BPSOSO",49,0)
GETDUR(RXI,RXR) ;EP -  also called from claim construction
"RTN","BPSOSO",50,0)
 ;IHS/SD/lwj 8/20/02  NCPDP 5.1 changes - retrieve DUR/PPS pointer 
"RTN","BPSOSO",51,0)
 ; from the prescription file
"RTN","BPSOSO",52,0)
 N IEN
"RTN","BPSOSO",53,0)
 I $G(RXR) S IEN=$P($G(^PSRX(RXI,1,RXR,9999999)),U,13)
"RTN","BPSOSO",54,0)
 E  S IEN=$P($G(^PSRX(RXI,9999999)),U,13)
"RTN","BPSOSO",55,0)
 Q IEN
"RTN","BPSOSO1")
0^203^B2720464
"RTN","BPSOSO1",1,0)
BPSOSO1 ;BHAM ISC/FCS/DRS - NCPDP Override Main menu ;09/03/2002 11:14 AM
"RTN","BPSOSO1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSO1",3,0)
 ;---------------------------------------------------------------
"RTN","BPSOSO1",4,0)
 ; IHS/SD/lwj  9/3/02  NCPDP 5.1 changes
"RTN","BPSOSO1",5,0)
 ; In 3.2, prior authorization was updated and stored in field 416.
"RTN","BPSOSO1",6,0)
 ; In 5.1, 416 is obsolete, and the information could be stored
"RTN","BPSOSO1",7,0)
 ; in field 461, and 462 or in the prior authorization segment.
"RTN","BPSOSO1",8,0)
 ; For now, the insurer/processors appear to be using 461, and 
"RTN","BPSOSO1",9,0)
 ; 462 rather than the segment.  In any case, we needed to change
"RTN","BPSOSO1",10,0)
 ; the way we capture prior authorization information - AND - we
"RTN","BPSOSO1",11,0)
 ; have to keep populating 416 since we have to still process 3.2
"RTN","BPSOSO1",12,0)
 ; claims.  This routine was changed to call PRIORA in BPSOSo2
"RTN","BPSOSO1",13,0)
 ; rather than EDIT^BPSOSO2 when we are processing a prior auth.
"RTN","BPSOSO1",14,0)
 ;(Field prompts also altered to match 5.1 standards.)
"RTN","BPSOSO1",15,0)
 ;---------------------------------------------------------------
"RTN","BPSOSO1",16,0)
 Q
"RTN","BPSOSO1",17,0)
TEST D MENU("") Q
"RTN","BPSOSO1",18,0)
MENU(IEN)          ;EP -
"RTN","BPSOSO1",19,0)
 D SETLIST
"RTN","BPSOSO1",20,0)
 N PROMPT S PROMPT(1)="Select which claim data you wish to override."
"RTN","BPSOSO1",21,0)
 S PROMPT(2)="Use   ^   to exit this menu."
"RTN","BPSOSO1",22,0)
 N SEL F  D  Q:'SEL  Q:SEL=-1
"RTN","BPSOSO1",23,0)
 . S SEL=$$LIST^BPSOSU4("S",$$LISTROOT,$$ANSROOT,"Override Claim Defaults",.PROMPT,1,20,$S($G(DTOUT):DTOUT,1:300))
"RTN","BPSOSO1",24,0)
 . I SEL W ! H 1 D @$P($T(LIST+SEL),";",4) ;
"RTN","BPSOSO1",25,0)
 Q
"RTN","BPSOSO1",26,0)
LISTROOT()         Q "^TMP("""_$T(+0)_""","_$J_","
"RTN","BPSOSO1",27,0)
ANSROOT()          Q "^TMP("""_$T(+0)_""","_($J+.1)_","
"RTN","BPSOSO1",28,0)
SETLIST K ^TMP("BPSOSO1",$J),^TMP("BPSOSO1",$J+.1)
"RTN","BPSOSO1",29,0)
 N I,X F I=1:1 D  Q:X="*"
"RTN","BPSOSO1",30,0)
 . S X=$T(LIST+I),X=$P(X,";",2,$L(X)) Q:X="*"
"RTN","BPSOSO1",31,0)
 . S ^TMP("BPSOSO1",$J,I,"I")=$P(X,";")
"RTN","BPSOSO1",32,0)
 . S ^TMP("BPSOSO1",$J,I,"E")=$P(X,";",2)
"RTN","BPSOSO1",33,0)
 S ^TMP("BPSOSO1",$J,0)=I-1
"RTN","BPSOSO1",34,0)
 Q
"RTN","BPSOSO1",35,0)
 ;
"RTN","BPSOSO1",36,0)
 ; IHS/SD/lwj 9/3/02 - the following 3 lines were removed from LIST -
"RTN","BPSOSO1",37,0)
 ; new 1 - 3 lines were added to replace them
"RTN","BPSOSO1",38,0)
 ;1;Preauthorization #;EDIT^BPSOSO2(IEN,416)
"RTN","BPSOSO1",39,0)
 ;2;Person Code;EDIT^BPSOSO2(IEN,303)
"RTN","BPSOSO1",40,0)
 ;3;Relationship Code;EDIT^BPSOSO2(IEN,306)
"RTN","BPSOSO1",41,0)
 ;
"RTN","BPSOSO1",42,0)
 ; IHS/SD/lwj 9/3/02 - since still unimplemented, the following 
"RTN","BPSOSO1",43,0)
 ; lines were removed from the menu options in LIST
"RTN","BPSOSO1",44,0)
 ;I;Order of insurance;NOTIMP
"RTN","BPSOSO1",45,0)
 ;P;Pricing;NOTIMP
"RTN","BPSOSO1",46,0)
 ;
"RTN","BPSOSO1",47,0)
LIST ;
"RTN","BPSOSO1",48,0)
 ;1;Prior Authorization;PRIORA^BPSOSO2(IEN)  ;IHS/SD/lwj 9/3/02
"RTN","BPSOSO1",49,0)
 ;2;Patient Gender Code;EDIT^BPSOSO2(IEN,303)
"RTN","BPSOSO1",50,0)
 ;3;Patient Relationship Code;EDIT^BPSOSO2(IEN,306)
"RTN","BPSOSO1",51,0)
 ;4;Eligibility Clarification Code;EDIT^BPSOSO2(IEN,309)
"RTN","BPSOSO1",52,0)
 ;*;Enter/edit/override any NCPDP field;EDIT^BPSOSO2(IEN)
"RTN","BPSOSO1",53,0)
 ;*
"RTN","BPSOSO1",54,0)
NOTIMP W !,"That option isn't yet implemented.",! N % R %:3 Q
"RTN","BPSOSO2")
0^204^B32131284
"RTN","BPSOSO2",1,0)
BPSOSO2 ;BHAM ISC/FCS/DRS/DLF - NCPDP Override-Fman utils ;06/01/2004
"RTN","BPSOSO2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSO2",3,0)
 Q
"RTN","BPSOSO2",4,0)
 ; EDIT,EDITGEN are called from the menus in BPSOSO1,
"RTN","BPSOSO2",5,0)
 ;   typically reached from the pharmacy package's call
"RTN","BPSOSO2",6,0)
 ;   to OVERRIDE^BPSOSO
"RTN","BPSOSO2",7,0)
 ; GET511 is called from BPSOSCD during claim construction
"RTN","BPSOSO2",8,0)
 ;
"RTN","BPSOSO2",9,0)
 ;IHS/SD/lwj 8/01/02  NCPDP 5.1 changes to GET511 subroutine
"RTN","BPSOSO2",10,0)
 ; Routine was changed to look at an exceptions list, if the
"RTN","BPSOSO2",11,0)
 ; field being processed is in the exceptions list it will
"RTN","BPSOSO2",12,0)
 ; create a "claim header" and "claim rx" entry.  The reason
"RTN","BPSOSO2",13,0)
 ; for this is that several 300 range fields were moved to the 
"RTN","BPSOSO2",14,0)
 ; claim rx area within the 5.1 segments creating duplicate flds.
"RTN","BPSOSO2",15,0)
 ; (i.e. the <402 and >402 rule is no longer valid)
"RTN","BPSOSO2",16,0)
 ;
"RTN","BPSOSO2",17,0)
 ; New routine (PRIORA) added to handle the input of the prior
"RTN","BPSOSO2",18,0)
 ; authorization information at prescription creation time.
"RTN","BPSOSO2",19,0)
 ;
"RTN","BPSOSO2",20,0)
EDIT(IEN,FIELDNUM) ;
"RTN","BPSOSO2",21,0)
 I '$D(FIELDNUM) D EDITGEN(IEN) Q
"RTN","BPSOSO2",22,0)
 ; Editing one field
"RTN","BPSOSO2",23,0)
 N DIE,DA,DR,DIDEL,DTOUT,FIELDNAM
"RTN","BPSOSO2",24,0)
 S DA=$$HASVALUE(IEN,FIELDNUM)
"RTN","BPSOSO2",25,0)
 ; Make sure the entry exists in the subfile.
"RTN","BPSOSO2",26,0)
 ; Create an empty one if necessary.
"RTN","BPSOSO2",27,0)
 I 'DA S DA=$$SETVALUE(IEN,FIELDNUM,"")
"RTN","BPSOSO2",28,0)
 ; edit the value field in the subfile
"RTN","BPSOSO2",29,0)
 S DIE="^BPS(9002313.511,"_IEN_",1,",DA(1)=IEN
"RTN","BPSOSO2",30,0)
 S DR=.02_$TR($$FIELDNAM(FIELDNUM),""";~","")
"RTN","BPSOSO2",31,0)
 D ^DIE
"RTN","BPSOSO2",32,0)
 ; If the value is null, then delete the entire FIELDNUM entry
"RTN","BPSOSO2",33,0)
 I $$GETVALUE(IEN,FIELDNUM)="" D DELVALUE(IEN,FIELDNUM)
"RTN","BPSOSO2",34,0)
 Q
"RTN","BPSOSO2",35,0)
EDITGEN(IEN)       ; general edit
"RTN","BPSOSO2",36,0)
 ; First pass:  quick & dirty Fileman ^DIE call
"RTN","BPSOSO2",37,0)
 ; Future: Screenman interface
"RTN","BPSOSO2",38,0)
 N DIE,DA,DR,DIDEL,DTOUT
"RTN","BPSOSO2",39,0)
 S DA=IEN,DIE=$$FILENUM,DR=1 D ^DIE
"RTN","BPSOSO2",40,0)
 ; And we need to delete any entries with null values
"RTN","BPSOSO2",41,0)
 N A S A=0 F  S A=$O(^BPS(9002313.511,IEN,1,A)) Q:'A  D
"RTN","BPSOSO2",42,0)
 . N X S X=^BPS(9002313.511,IEN,1,A,0)
"RTN","BPSOSO2",43,0)
 . I $P(X,U,2)="" D
"RTN","BPSOSO2",44,0)
 . . N FIELDNUM S FIELDNUM=$P(^BPSF(9002313.91,$P(X,U),0),U)
"RTN","BPSOSO2",45,0)
 . . D DELVALUE(IEN,FIELDNUM)
"RTN","BPSOSO2",46,0)
 Q
"RTN","BPSOSO2",47,0)
GET511(IEN,ARR101,ARR402) ;EP - from BPSOSCD - load arrays with data from IEN
"RTN","BPSOSO2",48,0)
 ; IHS/SD/lwj 8/1/02 altered for NCPDP 5.1 - must store some 
"RTN","BPSOSO2",49,0)
 ; 300 range fields at the "header" and "detail" level due to 
"RTN","BPSOSO2",50,0)
 ; reconstructing of 5.1 claim segments
"RTN","BPSOSO2",51,0)
 ;
"RTN","BPSOSO2",52,0)
 N A,C S A=0,C=0
"RTN","BPSOSO2",53,0)
 N EXPTLST,TFLD                ;IHS/SD/lwj 8/1/02
"RTN","BPSOSO2",54,0)
 ;
"RTN","BPSOSO2",55,0)
 S EXPTLST=",308,315,316,317,318,319,320,327,"  ;IHS/SD/lwj 8/1/02
"RTN","BPSOSO2",56,0)
 ;
"RTN","BPSOSO2",57,0)
 F  S A=$O(^BPS(9002313.511,IEN,1,A)) Q:'A  D
"RTN","BPSOSO2",58,0)
 . N X S X=^BPS(9002313.511,IEN,1,A,0)
"RTN","BPSOSO2",59,0)
 . N F S F=$P(X,U) ; field IEN, points to 9002313.91
"RTN","BPSOSO2",60,0)
 . ; store in either claim header or claim detail, based on field #
"RTN","BPSOSO2",61,0)
 . I $$FIELDNUM(F)<402 S @ARR101@(F)=$P(X,U,2)
"RTN","BPSOSO2",62,0)
 . E  S @ARR402@(F)=$P(X,U,2)
"RTN","BPSOSO2",63,0)
 . ;
"RTN","BPSOSO2",64,0)
 . ; IHS/SD/lwj 8/1/02  nxt 2 lns added to check for exception flds
"RTN","BPSOSO2",65,0)
 . S TFLD=","_$$FIELDNUM(F)_","
"RTN","BPSOSO2",66,0)
 . I EXPTLST[TFLD S @ARR402@(F)=$P(X,U,2)
"RTN","BPSOSO2",67,0)
 . ;
"RTN","BPSOSO2",68,0)
 . S C=C+1
"RTN","BPSOSO2",69,0)
 Q C
"RTN","BPSOSO2",70,0)
 ; 
"RTN","BPSOSO2",71,0)
 ; Generalized utilities - good for everything, not just auth #
"RTN","BPSOSO2",72,0)
LOCK() L +^BPS(9002313.511,IEN):300 Q $T
"RTN","BPSOSO2",73,0)
UNLOCK L -^BPS(9002313.511,IEN) Q
"RTN","BPSOSO2",74,0)
FILENUM()          Q 9002313.511
"RTN","BPSOSO2",75,0)
SUBFNUM()          Q 9002313.5111
"RTN","BPSOSO2",76,0)
FLOCK() L +^BPS(9002313.511):300 Q $T
"RTN","BPSOSO2",77,0)
FUNLOCK L -^BPS(9002313.511) Q
"RTN","BPSOSO2",78,0)
FIELDIEN(FIELDNUM) ; ien of a 9002313.91 NCPDP Data Dictionary field
"RTN","BPSOSO2",79,0)
 Q $$FIND1^DIC(9002313.91,,,FIELDNUM)
"RTN","BPSOSO2",80,0)
FIELDNAM(FIELDNUM) ; name of a 9002313.91 NCPDP Data Dictionary field
"RTN","BPSOSO2",81,0)
 Q $$GET1^DIQ(9002313.91,$$FIELDIEN(FIELDNUM),.03)
"RTN","BPSOSO2",82,0)
 ; given pointer to NCPDP Data Dictionary fields, return external #
"RTN","BPSOSO2",83,0)
FIELDNUM(IEN91)    Q $P($G(^BPSF(9002313.91,IEN91,0)),U)
"RTN","BPSOSO2",84,0)
NEW() ;EP -  create new entry in 9002313.511
"RTN","BPSOSO2",85,0)
 F  Q:$$FLOCK  Q:'$$IMPOSS^BPSOSUE("L","RTI","interlock on new Override record creation",,"NEW",$T(+0))
"RTN","BPSOSO2",86,0)
 N FLAGS,FDA,IEN,MSG,FN,X,NEWREC S FN=$$FILENUM
"RTN","BPSOSO2",87,0)
 D NEW1
"RTN","BPSOSO2",88,0)
 D FUNLOCK
"RTN","BPSOSO2",89,0)
 Q NEWREC
"RTN","BPSOSO2",90,0)
NEW1 ;
"RTN","BPSOSO2",91,0)
 S FDA(FN,"+1,",.01)=$O(^BPS(FN,"B",999999999999),-1)+1
"RTN","BPSOSO2",92,0)
 D UPDATE^DIE(,"FDA","IEN","MSG")
"RTN","BPSOSO2",93,0)
 I $D(MSG) D  G NEW1:$$IMPOSS^BPSOSUE("FM","TRI","UPDATE^DIE failed",,"NEW1",$T(+0))
"RTN","BPSOSO2",94,0)
 . D ZWRITE^BPSOS("FDA","IEN","MSG")
"RTN","BPSOSO2",95,0)
 . K MSG
"RTN","BPSOSO2",96,0)
 S NEWREC=IEN(1)
"RTN","BPSOSO2",97,0)
NEW2 ;
"RTN","BPSOSO2",98,0)
 S FDA(FN,NEWREC_",",.02)="NOW"
"RTN","BPSOSO2",99,0)
 D FILE^DIE("E","FDA","MSG")
"RTN","BPSOSO2",100,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSO2",101,0)
 G NEW2:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"NEW2",$T(+0))
"RTN","BPSOSO2",102,0)
 Q
"RTN","BPSOSO2",103,0)
HASVALUE(IEN,FIELDNUM)       ; does the FIELDNUM have an override value?
"RTN","BPSOSO2",104,0)
 ; returns IEN into the subfile
"RTN","BPSOSO2",105,0)
 Q $$FIND1^DIC($$SUBFNUM,","_IEN_",",,FIELDNUM)
"RTN","BPSOSO2",106,0)
GETVALUE(IEN,FIELDNUM) ; return currently-set override value for given FIELDNUM
"RTN","BPSOSO2",107,0)
 N X S X=$$HASVALUE(IEN,FIELDNUM) I 'X Q ""
"RTN","BPSOSO2",108,0)
 Q $$GET1^DIQ($$SUBFNUM,X_","_IEN_",",.02)
"RTN","BPSOSO2",109,0)
SETVALUE(IEN,FIELDNUM,VALUE) ;
"RTN","BPSOSO2",110,0)
 ; can DO or $$; $$ = ien in subfile for this FIELDNUM
"RTN","BPSOSO2",111,0)
 ; Special case for the override file:  if you're trying to set the
"RTN","BPSOSO2",112,0)
 ; field's value to "@", don't just delete the field value,
"RTN","BPSOSO2",113,0)
 ; which would leave the field defined with a null value.
"RTN","BPSOSO2",114,0)
 ; Instead, delete the entire override for the field.
"RTN","BPSOSO2",115,0)
 ; This prevents accidentally overriding a genuine value with null.
"RTN","BPSOSO2",116,0)
 I "@"=VALUE D DELVALUE(IEN,FIELDNUM) Q ""
"RTN","BPSOSO2",117,0)
 ; But the usual case is just storing a value:
"RTN","BPSOSO2",118,0)
 N FDA,MSG,IENS,IENARRAY
"RTN","BPSOSO2",119,0)
 ; Note:  I tried the "+?1,ien," method but it always created a new
"RTN","BPSOSO2",120,0)
 ; entry, even when it meant creating duplicates.  So now we test to
"RTN","BPSOSO2",121,0)
 ; see if there's already an entry for the fieldnum, and if not,
"RTN","BPSOSO2",122,0)
 ; then we put in a "+1,"
"RTN","BPSOSO2",123,0)
 N ENTRY S ENTRY=$$HASVALUE(IEN,FIELDNUM) ; do we already have FIELDNUM
"RTN","BPSOSO2",124,0)
 I 'ENTRY S ENTRY="+1" ; if not, then create a new entry
"RTN","BPSOSO2",125,0)
 S IENS=ENTRY_","_IEN_","
"RTN","BPSOSO2",126,0)
 S FDA($$SUBFNUM,IENS,.01)=FIELDNUM
"RTN","BPSOSO2",127,0)
 S FDA($$SUBFNUM,IENS,.02)=VALUE
"RTN","BPSOSO2",128,0)
 D SETV1
"RTN","BPSOSO2",129,0)
 I ENTRY="+1" S ENTRY=$G(IENARRAY(1))
"RTN","BPSOSO2",130,0)
 Q ENTRY
"RTN","BPSOSO2",131,0)
SETV1 ;
"RTN","BPSOSO2",132,0)
 D UPDATE^DIE("E","FDA","IENARRAY","MSG")
"RTN","BPSOSO2",133,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSO2",134,0)
 K ^TMP("BPS",$J,"BPSOSO2",$J,"SETVALUE")
"RTN","BPSOSO2",135,0)
 S ^TMP("BPS",$J,"BPSOSO2",$J,"SETVALUE")=$$ERRHDR
"RTN","BPSOSO2",136,0)
 M ^TMP("BPS",$J,"BPSOSO2",$J,"SETVALUE","MSG")=MSG
"RTN","BPSOSO2",137,0)
 I $D(IENARRAY) M ^TMP("BPS",$J,"BPSOSO2",$J,"SETVALUE","IENARRAY")=IENARRAY
"RTN","BPSOSO2",138,0)
 D ZWRITE^BPSOS("FDA","IENARRAY","MSG")
"RTN","BPSOSO2",139,0)
 G SETV1:$$IMPOSS^BPSOSUE("FM","TRI",,,"SETVALUE",$T(+0))
"RTN","BPSOSO2",140,0)
 Q
"RTN","BPSOSO2",141,0)
DELVALUE(IEN,FIELDNUM)       ;
"RTN","BPSOSO2",142,0)
 N ENTRY S ENTRY=$$HASVALUE(IEN,FIELDNUM) Q:'ENTRY  ; wasn't defined
"RTN","BPSOSO2",143,0)
 N FDA,MSG
"RTN","BPSOSO2",144,0)
 S FDA($$SUBFNUM,ENTRY_","_IEN_",",.01)="@"
"RTN","BPSOSO2",145,0)
DE5 D FILE^DIE("E","FDA","MSG")
"RTN","BPSOSO2",146,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSO2",147,0)
 K ^TMP("BPS",$J,"BPSOSO2",$J,"DELVALUE")
"RTN","BPSOSO2",148,0)
 S ^TMP("BPS",$J,"BPSOSO2",$J,"DELVALUE")=$$ERRHDR
"RTN","BPSOSO2",149,0)
 D ZWRITE^BPSOS("IEN","FDA","MSG")
"RTN","BPSOSO2",150,0)
 G DE5:$$IMPOSS^BPSOSUE("FM","TRI",,,"DELVALUE",$T(+0))
"RTN","BPSOSO2",151,0)
 Q
"RTN","BPSOSO2",152,0)
ERRHDR() Q "ERROR AT $H="_$H_" FOR $J="_$J
"RTN","BPSOSO2",153,0)
SEE(IEN) N TMP M TMP=^BPS($$FILENUM,IEN) D ZWRITE^BPSOS("TMP") Q  ; debugging
"RTN","BPSOSO2",154,0)
 ;
"RTN","BPSOSO2",155,0)
PRIORA(IEN) ;IHS/SD/lwj 9/3/02 NCPDP 5.1 Changes - Prior Authorization 
"RTN","BPSOSO2",156,0)
 ; We are still processing 5.1 and 3.2 claims, so we have to be able
"RTN","BPSOSO2",157,0)
 ; to populate fields 461, 462 and 416.  416 will be created based
"RTN","BPSOSO2",158,0)
 ; on the input into fields 461, and 462.
"RTN","BPSOSO2",159,0)
 ;
"RTN","BPSOSO2",160,0)
 N FIELDNUM
"RTN","BPSOSO2",161,0)
 ;
"RTN","BPSOSO2",162,0)
 S FIELDNUM=461              ;Prior authorization type code
"RTN","BPSOSO2",163,0)
 D EDIT(IEN,FIELDNUM)
"RTN","BPSOSO2",164,0)
 ;
"RTN","BPSOSO2",165,0)
 S FIELDNUM=462              ;Prior authorization number submitted
"RTN","BPSOSO2",166,0)
 D EDIT(IEN,FIELDNUM)
"RTN","BPSOSO2",167,0)
 ;
"RTN","BPSOSO2",168,0)
 ;now we combine field 461 and 462 to creat field 416
"RTN","BPSOSO2",169,0)
 ;
"RTN","BPSOSO2",170,0)
 N VAL461,VAL462,VAL416,DA
"RTN","BPSOSO2",171,0)
 S (VAL461,VAL462,VAL416)=""
"RTN","BPSOSO2",172,0)
 ;
"RTN","BPSOSO2",173,0)
 S VAL461=$$GETVALUE(IEN,461)
"RTN","BPSOSO2",174,0)
 S VAL462=$$GETVALUE(IEN,462)
"RTN","BPSOSO2",175,0)
 S VAL416=VAL461_VAL462
"RTN","BPSOSO2",176,0)
 Q:VAL416=""
"RTN","BPSOSO2",177,0)
 ;
"RTN","BPSOSO2",178,0)
 S DA=$$SETVALUE(IEN,416,"")
"RTN","BPSOSO2",179,0)
 S:$G(DA)'="" DA=$$SETVALUE(IEN,416,VAL416)
"RTN","BPSOSO2",180,0)
 ;
"RTN","BPSOSO2",181,0)
 ;
"RTN","BPSOSO2",182,0)
 Q
"RTN","BPSOSO3")
1^205
"RTN","BPSOSO4")
1^206
"RTN","BPSOSO5")
1^207
"RTN","BPSOSP")
0^208^B7824708
"RTN","BPSOSP",1,0)
BPSOSP ;BHAM ISC/FCS/DRS/DLF - Pharm ECME pay/adj batches ;06/01/2004
"RTN","BPSOSP",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSP",3,0)
 ; main entry points and some callable utilities are in here
"RTN","BPSOSP",4,0)
 Q
"RTN","BPSOSP",5,0)
TEST ;
"RTN","BPSOSP",6,0)
 W "Test NEWBATCH: "
"RTN","BPSOSP",7,0)
 S BATCH=$$NEWBATCH
"RTN","BPSOSP",8,0)
 W BATCH,! Q:'BATCH
"RTN","BPSOSP",9,0)
 W "Test GETPMT: ",$$GETPMT(BATCH),!
"RTN","BPSOSP",10,0)
 W "Test ADDPMT: ",$$ADDPMT(BATCH,100),!
"RTN","BPSOSP",11,0)
 W "Test ADDPMT: ",$$ADDPMT(BATCH,25.41),! ; should be 125.41
"RTN","BPSOSP",12,0)
 W "Test GETPMT: ",$$GETPMT(BATCH),!
"RTN","BPSOSP",13,0)
 Q
"RTN","BPSOSP",14,0)
NEWBATCH(ECHO) ;EP - create a new batch
"RTN","BPSOSP",15,0)
 I '$G(ECHO) S ECHO=1
"RTN","BPSOSP",16,0)
 N FDA,IEN,MSG,FN S FN=9001625.1 ; PAYMENT BATCH file
"RTN","BPSOSP",17,0)
 N X S X="+1,"
"RTN","BPSOSP",18,0)
 S FDA(FN,X,.02)=DT ; DATE CREATED
"RTN","BPSOSP",19,0)
 S FDA(FN,X,.03)=DUZ ; CREATED BY
"RTN","BPSOSP",20,0)
 S FDA(FN,X,.04)=0 ; PAYMENT CONTROL TOTAL
"RTN","BPSOSP",21,0)
 S FDA(FN,X,.05)="A" ; active
"RTN","BPSOSP",22,0)
 S FDA(FN,X,.045)=0 ; CONTRACTUAL ALLOWANCE CONTROL
"RTN","BPSOSP",23,0)
 S FDA(FN,X,.08)=DT ; DEPOSIT DATE
"RTN","BPSOSP",24,0)
 D UPDATE^DIE("S","FDA","IEN","MSG")
"RTN","BPSOSP",25,0)
 I $D(MSG),$G(ECHO) D
"RTN","BPSOSP",26,0)
 . W "Failed to create the batch!",!
"RTN","BPSOSP",27,0)
 . D ZWRITE^BPSOS("MSG")
"RTN","BPSOSP",28,0)
 . W !
"RTN","BPSOSP",29,0)
 . D PRESSANY
"RTN","BPSOSP",30,0)
 Q $G(IEN(1))
"RTN","BPSOSP",31,0)
PAYMENT(PCNDFN,BATCH,AMOUNT,INSDFN,DEPDATE,RECEIPT,CHECKNUM) ;EP - store a pmt
"RTN","BPSOSP",32,0)
 N RETVAL S RETVAL=$$ADDPMT(BATCH,AMOUNT)
"RTN","BPSOSP",33,0)
 I '$D(RECEIPT) S RECEIPT="EOB"
"RTN","BPSOSP",34,0)
 I '$D(CHECKNUM) S CHECKNUM=""
"RTN","BPSOSP",35,0)
 Q
"RTN","BPSOSP",36,0)
ADJUST(PCNDFN,BATCH,AMOUNT,REASON) ;EP - store an adjustment
"RTN","BPSOSP",37,0)
 N RETVAL S RETVAL=$$ADDADJ(BATCH,AMOUNT) ; add to batch totals
"RTN","BPSOSP",38,0)
 Q
"RTN","BPSOSP",39,0)
GETPMT(BATCH)      Q $$GETAMT(BATCH,.04) ; get PAYMENT CONTROL TOTAL
"RTN","BPSOSP",40,0)
ADDPMT(BATCH,AMT)      ;
"RTN","BPSOSP",41,0)
 S X=$$ADDAMT(BATCH,AMT,.04)
"RTN","BPSOSP",42,0)
 Q X
"RTN","BPSOSP",43,0)
GETADJ(BATCH)      Q $$GETAMT(BATCH,.045) ; get CONTRACTUAL ALLOWANCE CONTROL
"RTN","BPSOSP",44,0)
ADDADJ(BATCH,AMT)     ; 
"RTN","BPSOSP",45,0)
 N X S X=$$ADDAMT(BATCH,AMT,.045)
"RTN","BPSOSP",46,0)
 Q X
"RTN","BPSOSP",47,0)
GETAMT(BATCH,FIELD)          ; actually, it works for any field in this file
"RTN","BPSOSP",48,0)
 N FDA,IEN,MSG,FN S FN=9001625.1
"RTN","BPSOSP",49,0)
 S X=$$GET1^DIQ(FN,BATCH,FIELD,,,"MSG")
"RTN","BPSOSP",50,0)
 I $D(MSG) D ZWRITE^BPSOS("BATCH","FIELD","MSG"),IMPOSS^BPSOSUE("FM","TI","$$GET1^DIQ failed",,"GETAMT",$T(+0))
"RTN","BPSOSP",51,0)
 Q X
"RTN","BPSOSP",52,0)
ADDAMT(BATCH,AMT,FIELD)        ; add to the adjustment total ; either $$ or not
"RTN","BPSOSP",53,0)
 N X S X=$$GETAMT(BATCH,FIELD)
"RTN","BPSOSP",54,0)
 S X=$$SETAMT(BATCH,X+AMT,FIELD)
"RTN","BPSOSP",55,0)
 Q X
"RTN","BPSOSP",56,0)
SETAMT(BATCH,AMT,FIELD) ;EP - store the adjustment total ; either $$ or not
"RTN","BPSOSP",57,0)
 N FDA,IEN,MSG,FN S FN=9001625.1
"RTN","BPSOSP",58,0)
 S FDA(FN,BATCH_",",FIELD)=AMT
"RTN","BPSOSP",59,0)
 D SETAMT1
"RTN","BPSOSP",60,0)
 Q AMT
"RTN","BPSOSP",61,0)
SETAMT1 ;
"RTN","BPSOSP",62,0)
 D FILE^DIE("K","FDA","MSG")
"RTN","BPSOSP",63,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSP",64,0)
 D ZWRITE^BPSOS("FN","BATCH","FIELD","MSG")
"RTN","BPSOSP",65,0)
 I $$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"SETAMT1",$T(+0))
"RTN","BPSOSP",66,0)
 Q
"RTN","BPSOSP",67,0)
PRESSANY D PRESSANY^BPSOSU5(0,300) Q
"RTN","BPSOSQ")
0^213^B7816816
"RTN","BPSOSQ",1,0)
BPSOSQ ;BHAM ISC/FCS/DRS/DLF - ECME background, Part 1 ;06/01/2004   
"RTN","BPSOSQ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQ",3,0)
 Q
"RTN","BPSOSQ",4,0)
 ; BPSOSQ1 - Assemble claim information
"RTN","BPSOSQ",5,0)
 ; BPSOSQ2 - Put claims into packets for transmission
"RTN","BPSOSQ",6,0)
 ; BPSOSQ3 - Send and Receive
"RTN","BPSOSQ",7,0)
 ; BPSOSQ4 - Process Responses
"RTN","BPSOSQ",8,0)
 ;
"RTN","BPSOSQ",9,0)
 ; Numerous little $$'s called by BPSOSQB, etc. are here
"RTN","BPSOSQ",10,0)
 ; .57 versions of these are in BPSOS57, using IEN57
"RTN","BPSOSQ",11,0)
 ;
"RTN","BPSOSQ",12,0)
DRGDFN() ;EP -
"RTN","BPSOSQ",13,0)
 Q $P(^PSRX($$RXI,0),U,6) ; Given IEN59, return DRGDFN
"RTN","BPSOSQ",14,0)
DRGNAME()          Q $P(^PSDRUG($$DRGDFN,0),U) ; Given IEN59, return DRGNAME
"RTN","BPSOSQ",15,0)
RXI() ;EP -
"RTN","BPSOSQ",16,0)
 Q $P(^BPST(IEN59,1),U,11) ; Given IEN59, return RXI
"RTN","BPSOSQ",17,0)
RXR() ;EP -
"RTN","BPSOSQ",18,0)
 Q $P(^BPST(IEN59,1),U,1) ; Given IEN59, return RXR
"RTN","BPSOSQ",19,0)
N57LAST() ;EP -
"RTN","BPSOSQ",20,0)
 Q $O(^BPSTL("NON-FILEMAN","RXIRXR",$$RXI,$$RXR,""),-1)
"RTN","BPSOSQ",21,0)
NDC() ;EP -
"RTN","BPSOSQ",22,0)
 I $$TYPE=1 Q $P(^BPST(IEN59,1),U,2)
"RTN","BPSOSQ",23,0)
 N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("P","TI","postage and supplies not implemented",,"NDC",$T(+0))
"RTN","BPSOSQ",24,0)
 Q
"RTN","BPSOSQ",25,0)
QTY() Q $P(^BPST(IEN59,5),U) ; Given IEN59, return quantity
"RTN","BPSOSQ",26,0)
AMT() ;EP -
"RTN","BPSOSQ",27,0)
 Q $P(^BPST(IEN59,5),U,5) ; return total $amount
"RTN","BPSOSQ",28,0)
CHG() Q $P(^BPST(IEN59,5),U,5) ; Given IEN59, ret total charge
"RTN","BPSOSQ",29,0)
CPTIEN() I $$TYPE=1 Q 0
"RTN","BPSOSQ",30,0)
 ; CPT code for postage could vary by insurer and amount?
"RTN","BPSOSQ",31,0)
 ; A complication not yet programmed
"RTN","BPSOSQ",32,0)
 I $$TYPE=2 Q $P($G(^BPS(9002313.99,1,"POSTAGE")),U)
"RTN","BPSOSQ",33,0)
 I $$TYPE=3 Q $$EXTRCPT3 ; extract CPT from  visitien.cptien3
"RTN","BPSOSQ",34,0)
 Q "" ; not reach; $$TYPE already checked for 1, 2, 3
"RTN","BPSOSQ",35,0)
EXTRCPT3()          N X S X=IEN59,X=$P(X,".",2),X=$E(X,1,$L(X)-1) Q +X
"RTN","BPSOSQ",36,0)
PATIENT()          Q $P(^BPST(IEN59,0),U,6)
"RTN","BPSOSQ",37,0)
VISITIEN() Q $P(^BPST(IEN59,0),U,7)
"RTN","BPSOSQ",38,0)
USER() N X S X=$P(^BPST(IEN59,0),U,10) S:'X X=$G(DUZ) Q X
"RTN","BPSOSQ",39,0)
TYPE() ;EP -
"RTN","BPSOSQ",40,0)
 N X S X=$E(IEN59,$L(IEN59)) ; 1=prescription, 2=postage, 3=other
"RTN","BPSOSQ",41,0)
 I X'=1,X'=2,X'=3 D  S X=""
"RTN","BPSOSQ",42,0)
 . N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("DB","TI","Bad type for IEN59="_IEN59,,"TYPE",$T(+0))
"RTN","BPSOSQ",43,0)
 Q X
"RTN","BPSOSQ",44,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSQ",45,0)
FILLDATE()         N RXI,RXR S RXI=$$RXI,RXR=$$RXR
"RTN","BPSOSQ",46,0)
 Q:RXR $P(^PSRX(RXI,1,RXR,0),U)  Q:RXI $P(^PSRX(RXI,2),U,2)
"RTN","BPSOSQ",47,0)
 Q $$VISDATE
"RTN","BPSOSQ",48,0)
VISDATE() Q 0
"RTN","BPSOSQ",49,0)
VMED() N RXI,RXR S RXI=$$RXI,RXR=$$RXR
"RTN","BPSOSQ",50,0)
 Q:RXR $P(^PSRX(RXI,1,RXR,999999911),U) Q $P(^PSRX(RXI,999999911),U)
"RTN","BPSOSQ",51,0)
PROVIDER()         Q $P(^PSRX($$RXI,0),U,4)
"RTN","BPSOSQ",52,0)
VCN() Q 0
"RTN","BPSOSQ",53,0)
 ;
"RTN","BPSOSQ",54,0)
ARSYSTEM()         Q $P(^BPS(9002313.99,1,"A/R INTERFACE"),U)
"RTN","BPSOSQ",55,0)
MAKEVCN() ;EP - true/false  should we assign a VCN # to the visit?
"RTN","BPSOSQ",56,0)
 N AR S AR=$$ARSYSTEM
"RTN","BPSOSQ",57,0)
 I AR=0 Q 1 ; yes, for ILC A/R
"RTN","BPSOSQ",58,0)
 I AR=2 Q 1 ; yes, for ANMC A/R
"RTN","BPSOSQ",59,0)
 Q 0 ; no, for everybody else
"RTN","BPSOSQ",60,0)
LOG2LIST(MSG) ;EP -
"RTN","BPSOSQ",61,0)
 D LOG2LIST^BPSOSL(MSG) Q
"RTN","BPSOSQ",62,0)
LOG2CLM(MSG,IEN02) ;EP 
"RTN","BPSOSQ",63,0)
 D LOG2CLM^BPSOSL(MSG,IEN02) Q
"RTN","BPSOSQ",64,0)
LOG59(MSG,IEN59) ;EP -
"RTN","BPSOSQ",65,0)
 D LOG59^BPSOSL(MSG,IEN59) Q
"RTN","BPSOSQ1")
0^214^B7424006
"RTN","BPSOSQ1",1,0)
BPSOSQ1 ;BHAM ISC/FCS/DRS/DLF - ECME background, Part 1 ;06/01/2004
"RTN","BPSOSQ1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQ1",3,0)
 ;
"RTN","BPSOSQ1",4,0)
 ; This is usually started by Taskman call in TASK^BPSOSIZ
"RTN","BPSOSQ1",5,0)
 ;
"RTN","BPSOSQ1",6,0)
 ; For all with status 0, LOOP loops and calls CLAIMINF()
"RTN","BPSOSQ1",7,0)
 ;     to fill in any missing information.  Pricing, for example,
"RTN","BPSOSQ1",8,0)
 ;     may or may not have already been determined.
"RTN","BPSOSQ1",9,0)
 ; Sets status = 10 while it's working on a request.
"RTN","BPSOSQ1",10,0)
 ; Sets status = 30 when it's done  - and then it's ready for BPSOSQ2
"RTN","BPSOSQ1",11,0)
 ; If there were problems with the claim, the status will be set = 99.
"RTN","BPSOSQ1",12,0)
 ;
"RTN","BPSOSQ1",13,0)
 ; Also deals with status = 19 (special for Oklahoma Medicaid)
"RTN","BPSOSQ1",14,0)
 ;
"RTN","BPSOSQ1",15,0)
 ;    BPSOSQ - contains many useful $$ calls
"RTN","BPSOSQ1",16,0)
 ; Here in BPSOSQ1:
"RTN","BPSOSQ1",17,0)
 ;    The big outer loop through ^BPST("AD",0,*)
"RTN","BPSOSQ1",18,0)
 ;    and Task manager calls to start up ^BPSOSQ2
"RTN","BPSOSQ1",19,0)
 ; Extensions of BPSOSQ1:
"RTN","BPSOSQ1",20,0)
 ;    BPSOSQA - ONE59
"RTN","BPSOSQ1",21,0)
 ;    BPSOSQB - CLAIMINF
"RTN","BPSOSQ1",22,0)
 ;    BPSOSQC - some CLAIMINF subroutines
"RTN","BPSOSQ1",23,0)
 ;    BPSOSQD - data for certain a/r interfaces
"RTN","BPSOSQ1",24,0)
 ;    BPSOSQS - special queuing for Oklahoma Medicaid 3 highest prices
"RTN","BPSOSQ1",25,0)
 ;
"RTN","BPSOSQ1",26,0)
 ;--------------------------------------------------------------
"RTN","BPSOSQ1",27,0)
 ;IHS/SD/lwj 11/04/02 on behalf of IHS/OKCAO/POC 
"RTN","BPSOSQ1",28,0)
 ; Set ZTREQ to delete the task after it completes in task man
"RTN","BPSOSQ1",29,0)
 ;
"RTN","BPSOSQ1",30,0)
 ;-------------------------------------------------------------
"RTN","BPSOSQ1",31,0)
 Q
"RTN","BPSOSQ1",32,0)
LOOP ; line item detail: your work list is ^BPST("AD",0)
"RTN","BPSOSQ1",33,0)
 N ERROR,PREVPAT,THISPAT,COUNT,PACKETER S PACKETER=0
"RTN","BPSOSQ1",34,0)
 N IEN59,ABSBRXI,ABSBRXR,ABSBNDC,MODULO
"RTN","BPSOSQ1",35,0)
 N ABSBPATI,ABSBPDIV,ABSBSDIV,ABSBVISI,BPSHARM,INSURER
"RTN","BPSOSQ1",36,0)
 N VMEDDFN,APCDVCN
"RTN","BPSOSQ1",37,0)
 ;
"RTN","BPSOSQ1",38,0)
 ;IHS/SD/lwj 11/04/02 on behalf of IHS/OKCAO/POC 11/04/02
"RTN","BPSOSQ1",39,0)
 I $D(ZTQUEUED) S ZTREQ="@"  ;delete task if complete
"RTN","BPSOSQ1",40,0)
 ;
"RTN","BPSOSQ1",41,0)
 ;IHS/SD/lwj 11/04/02 end change
"RTN","BPSOSQ1",42,0)
 ;
"RTN","BPSOSQ1",43,0)
 S MODULO=4 ; interval at which we start up a packeter program
"RTN","BPSOSQ1",44,0)
 S COUNT=0
"RTN","BPSOSQ1",45,0)
 F  S IEN59=$$NEXT59 Q:'IEN59  D
"RTN","BPSOSQ1",46,0)
 . D INIT^BPSOSL(IEN59,1) ; logging (don't delete old data)
"RTN","BPSOSQ1",47,0)
 . D ONE59^BPSOSQA ; process this claim
"RTN","BPSOSQ1",48,0)
 . D LOG^BPSOSL("BPSOSQ1")
"RTN","BPSOSQ1",49,0)
 . D RELSLOT^BPSOSL ; release logging slot
"RTN","BPSOSQ1",50,0)
 ; Deal with the status 19s (special for Oklahoma Medicaid bundling)
"RTN","BPSOSQ1",51,0)
 I $D(^BPST("AD",19)) D
"RTN","BPSOSQ1",52,0)
 . I $$STAT19^BPSOSQS D  ; if any 19s pushed to status 30, then
"RTN","BPSOSQ1",53,0)
 . . S COUNT=.1 ; force packeter to start
"RTN","BPSOSQ1",54,0)
 I COUNT#MODULO'=0 D PACKETER
"RTN","BPSOSQ1",55,0)
 Q
"RTN","BPSOSQ1",56,0)
NEXT59() ; Get the next entry with Status = 0
"RTN","BPSOSQ1",57,0)
 ; If there is one, change its status to 10
"RTN","BPSOSQ1",58,0)
 ;    (says "Gathering claim information")
"RTN","BPSOSQ1",59,0)
 ; Timed lock of queue and resulting complications is a hassle but not a mess.
"RTN","BPSOSQ1",60,0)
 ; SETSTAT^BPSOSU will lock the record when changing the status.
"RTN","BPSOSQ1",61,0)
 L +^BPST("AD",0):300
"RTN","BPSOSQ1",62,0)
 I '$T D  Q 0 ; lock failed?!
"RTN","BPSOSQ1",63,0)
 . D TASK^BPSOSIZ ; try again - requeue this job
"RTN","BPSOSQ1",64,0)
 S IEN59=$O(^BPST("AD",0,0))
"RTN","BPSOSQ1",65,0)
 I IEN59 D SETSTAT(10)
"RTN","BPSOSQ1",66,0)
 L -^BPST("AD",0)
"RTN","BPSOSQ1",67,0)
 Q IEN59
"RTN","BPSOSQ1",68,0)
SETSTAT(NEWSTAT)   ;EP - from BPSOSQA
"RTN","BPSOSQ1",69,0)
 N ABSBRXI S ABSBRXI=IEN59 ; unfortunate variable name convention
"RTN","BPSOSQ1",70,0)
 D SETSTAT^BPSOSU(NEWSTAT)
"RTN","BPSOSQ1",71,0)
 Q
"RTN","BPSOSQ1",72,0)
PACKETER ;EP - from BPSOSAN,BPSOSQA 
"RTN","BPSOSQ1",73,0)
 ; tell the packetizer it's time to get working
"RTN","BPSOSQ1",74,0)
 ; But only if there are claims in status 30
"RTN","BPSOSQ1",75,0)
 I $O(^BPST("AD",30,0)) D TASK
"RTN","BPSOSQ1",76,0)
 Q
"RTN","BPSOSQ1",77,0)
TASK ;EP - from BPSOS2D,BPSOS6D,BPSOS6L,BPSOSQ2,BPSOSQ4
"RTN","BPSOSQ1",78,0)
 N X,%DT,Y S X="N",%DT="ST" D ^%DT
"RTN","BPSOSQ1",79,0)
 D TASKAT(Y)
"RTN","BPSOSQ1",80,0)
 I $D(PACKETER) S PACKETER=PACKETER+1 ; note: "we started the packeter"
"RTN","BPSOSQ1",81,0)
 Q
"RTN","BPSOSQ1",82,0)
TASKAT(ZTDTH)      ;EP - from BPSOSQ4 (requeue if insurer is sleeping)
"RTN","BPSOSQ1",83,0)
 ; called here from BPSOSQS - 
"RTN","BPSOSQ1",84,0)
 ;N (DUZ,PACKETER,ZTDTH) N ZTRTN
"RTN","BPSOSQ1",85,0)
 N ZTRTN,ZTIO
"RTN","BPSOSQ1",86,0)
 S ZTRTN="PACKETS^BPSOSQ2",ZTIO=""
"RTN","BPSOSQ1",87,0)
 D ^%ZTLOAD
"RTN","BPSOSQ2")
0^215^B31638994
"RTN","BPSOSQ2",1,0)
BPSOSQ2 ;BHAM ISC/FCS/DRS/DLF - form transmission packets ;06/01/2004
"RTN","BPSOSQ2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQ2",3,0)
PACKETS ; construct packets for transmission to NDC
"RTN","BPSOSQ2",4,0)
 N ERROR,SILENT S SILENT=1
"RTN","BPSOSQ2",5,0)
 N RXILIST,STATUS30
"RTN","BPSOSQ2",6,0)
 D STATUS31^BPSOSQF ; deal with insurer alseep waiting
"RTN","BPSOSQ2",7,0)
 F STATUS30=30 I $D(^BPST("AD",STATUS30)) D STATUS30
"RTN","BPSOSQ2",8,0)
 ; If there are still any claims with status 30,
"RTN","BPSOSQ2",9,0)
 ; perhaps due to failed LOCK59, queue up BPSOSQ2 to run again
"RTN","BPSOSQ2",10,0)
 N NEEDQ1 S NEEDQ1=$O(^BPST("AD",30,0))
"RTN","BPSOSQ2",11,0)
 I NEEDQ1 H 60 D TASK^BPSOSQ1
"RTN","BPSOSQ2",12,0)
 Q
"RTN","BPSOSQ2",13,0)
SETSTAT(NEWSTAT) ;EP - BPSOSQF ; given IEN59
"RTN","BPSOSQ2",14,0)
 N ABSBRXI S ABSBRXI=IEN59 ; unfortunate variable naming convention
"RTN","BPSOSQ2",15,0)
 D SETSTAT^BPSOSU(NEWSTAT)
"RTN","BPSOSQ2",16,0)
 Q
"RTN","BPSOSQ2",17,0)
SETRESU(RESCODE,TEXT)   ; given IEN59
"RTN","BPSOSQ2",18,0)
 N ABSBRXI S ABSBRXI=IEN59 ; unfortunate variable naming convention
"RTN","BPSOSQ2",19,0)
 D SETRESU^BPSOSU(RESCODE,TEXT)
"RTN","BPSOSQ2",20,0)
 Q
"RTN","BPSOSQ2",21,0)
LOCK59() ;EP - BPSOSQF
"RTN","BPSOSQ2",22,0)
 L +^BPST("AD",STATUS30):60 Q $T
"RTN","BPSOSQ2",23,0)
UNLOCK59 ;EP - BPSOSQF
"RTN","BPSOSQ2",24,0)
 L -^BPST("AD",STATUS30) Q
"RTN","BPSOSQ2",25,0)
NEXT59(X) ;EP - BPSOSQF
"RTN","BPSOSQ2",26,0)
 N INS,T
"RTN","BPSOSQ2",27,0)
N59A ;
"RTN","BPSOSQ2",28,0)
 ;LJE;6/25/03; If it's a VA prescriptions go to the VAN59A subroutine
"RTN","BPSOSQ2",29,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) G VAN59A
"RTN","BPSOSQ2",30,0)
 S X=$O(^BPST("AD",STATUS30,X))
"RTN","BPSOSQ2",31,0)
 I X="" Q X  ; end of list, return ""
"RTN","BPSOSQ2",32,0)
 ; but if the insurer is asleep, don't take this one
"RTN","BPSOSQ2",33,0)
 S INS=$P(^BPST(X,1),U,6)
"RTN","BPSOSQ2",34,0)
 S T=$P($G(^BPSEI(INS,101)),U) ; insurer asleep retry time
"RTN","BPSOSQ2",35,0)
 I 'T Q X  ; insurer is not asleep
"RTN","BPSOSQ2",36,0)
 ; - below here - insurer is asleep -
"RTN","BPSOSQ2",37,0)
 ; If cancellation is requested, let it through, regardless of sleep.
"RTN","BPSOSQ2",38,0)
 ; This will speed it on its way to cancellation
"RTN","BPSOSQ2",39,0)
 I $G(^BPST(X,3)) Q X
"RTN","BPSOSQ2",40,0)
 ; If necessary, update the .59's record of when to retry
"RTN","BPSOSQ2",41,0)
 I $P($G(^BPST(X,8)),U)'=T D  ;
"RTN","BPSOSQ2",42,0)
 . S $P(^BPST(X,8),U)=T ; stamp with latest retry time
"RTN","BPSOSQ2",43,0)
 . N IEN59 S IEN59=X D SETSTAT(31) ; force screen update, too
"RTN","BPSOSQ2",44,0)
 . D LOG59^BPSOSQ("Insurer still asleep - retry at "_T,IEN59)
"RTN","BPSOSQ2",45,0)
 I T<$$NOW Q X  ; time to retry, so yes, we do this one
"RTN","BPSOSQ2",46,0)
 ;. don't clear this - a successful non-sleep response will clear it
"RTN","BPSOSQ2",47,0)
 ;. but don't clear the piece 5 current interval, as we may increment
"RTN","BPSOSQ2",48,0)
 ; Else still in waiting - if it's status 30, change it to 31
"RTN","BPSOSQ2",49,0)
 I STATUS30=30 D
"RTN","BPSOSQ2",50,0)
 . N IEN59 S IEN59=X D SETSTAT(31)
"RTN","BPSOSQ2",51,0)
 . S $P(^BPST(IEN59,8),U)=$P(^BPSEI(INS,101),U)
"RTN","BPSOSQ2",52,0)
 . S $P(^BPST(IEN59,8),U,3)=INS
"RTN","BPSOSQ2",53,0)
 G N59A ; still in wait time; don't look at this claim
"RTN","BPSOSQ2",54,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSQ2",55,0)
VAN59A ;lje;6/26/03;VA wait time/insurer asleep
"RTN","BPSOSQ2",56,0)
 N PAYSH,PAYSHNM
"RTN","BPSOSQ2",57,0)
 S X=$O(^BPST("AD",STATUS30,X))
"RTN","BPSOSQ2",58,0)
 I X="" Q X  ; end of list, return ""
"RTN","BPSOSQ2",59,0)
 ; but if the insurer is asleep, don't take this one
"RTN","BPSOSQ2",60,0)
 S INS=$P(^BPST(X,9),U,1) S:INS="" INS=1,$P(^BPST(X,9),U,1)=INS  ;LJE;8/25/03  ;current insurance
"RTN","BPSOSQ2",61,0)
 S PAYSH=$$PAYERSH^BPSOSQF(X)
"RTN","BPSOSQ2",62,0)
 S PAYSHNM=$$GET1^DIQ(9002313.92,PAYSH_",",.01,"E")
"RTN","BPSOSQ2",63,0)
 S T=$$GET1^DIQ(9002313.92,PAYSH_",",1.12,"I")    ;RETRY TIME
"RTN","BPSOSQ2",64,0)
 I 'T Q X  ; insurer is not asleep
"RTN","BPSOSQ2",65,0)
 ; - below here - insurer is asleep -
"RTN","BPSOSQ2",66,0)
 ; If cancellation is requested, let it through, regardless of sleep.
"RTN","BPSOSQ2",67,0)
 ; This will speed it on its way to cancellation
"RTN","BPSOSQ2",68,0)
 I $G(^BPST(X,3)) Q X
"RTN","BPSOSQ2",69,0)
 ; If necessary, update the .59's record of when to retry
"RTN","BPSOSQ2",70,0)
 I $P($G(^BPST(X,8)),U)'=T D  ;
"RTN","BPSOSQ2",71,0)
 . S $P(^BPST(X,8),U)=T ; stamp with latest retry time
"RTN","BPSOSQ2",72,0)
 . N IEN59 S IEN59=X D SETSTAT(31) ; force screen update, too
"RTN","BPSOSQ2",73,0)
 . D LOG59^BPSOSQ($T(+0)_" - Insurer still asleep - retry at "_T_" for "_$G(PAYSHNM),IEN59)
"RTN","BPSOSQ2",74,0)
 I T'>$$NOW Q X  ; time to retry, so yes, we do this one
"RTN","BPSOSQ2",75,0)
 I STATUS30=30 D
"RTN","BPSOSQ2",76,0)
 . N IEN59 S IEN59=X D SETSTAT(31)
"RTN","BPSOSQ2",77,0)
 . S $P(^BPST(IEN59,8),U)=$P($G(^BPSF(9002313.92,PAYSH,1)),"^",12)
"RTN","BPSOSQ2",78,0)
 . S $P(^BPST(IEN59,8),U,3)=$G(PAYSHNM)
"RTN","BPSOSQ2",79,0)
 G VAN59A ; still in wait time; don't look at this claim
"RTN","BPSOSQ2",80,0)
 ;
"RTN","BPSOSQ2",81,0)
STATUS30 ; given STATUS30=30
"RTN","BPSOSQ2",82,0)
 N IEN59 S IEN59=""
"RTN","BPSOSQ2",83,0)
 Q:'$$LOCK59
"RTN","BPSOSQ2",84,0)
 F  S IEN59=$$NEXT59(IEN59) Q:IEN59=""  D
"RTN","BPSOSQ2",85,0)
 . K RXILIST ; init list each time through this loop
"RTN","BPSOSQ2",86,0)
 . S RXILIST(IEN59)=""
"RTN","BPSOSQ2",87,0)
 . D SETSTAT(40) ; set its status to "packetizing"
"RTN","BPSOSQ2",88,0)
 .; Reversals go in a packet alone
"RTN","BPSOSQ2",89,0)
 . I $G(^BPST(IEN59,4)) G POINTX
"RTN","BPSOSQ2",90,0)
 . G:$$CHKPA2() POINTX
"RTN","BPSOSQ2",91,0)
 . I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) I $D(VADIAL) G POINTX:VADIAL="1VA"
"RTN","BPSOSQ2",92,0)
 . I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) I '$D(VADIAL) G POINTX
"RTN","BPSOSQ2",93,0)
 . N RA0,RA1 S RA0=^BPST(IEN59,0),RA1=^(1)
"RTN","BPSOSQ2",94,0)
 . N IEN59 S IEN59="" ; preserve the top-level index!
"RTN","BPSOSQ2",95,0)
 . F  S IEN59=$$NEXT59(IEN59) Q:'IEN59  D
"RTN","BPSOSQ2",96,0)
 . . N RB0,RB1 S RB0=^BPST(IEN59,0),RB1=^(1)
"RTN","BPSOSQ2",97,0)
 . . ; Only bundle when you have the same:
"RTN","BPSOSQ2",98,0)
 . . ; Patient, Visit, Division, Division Source, Insurer, Pharmacy
"RTN","BPSOSQ2",99,0)
 . . I $P(RA0,U,6,7)'=$P(RB0,U,6,7) Q
"RTN","BPSOSQ2",100,0)
 . . I $P(RA1,U,4,7)'=$P(RB1,U,4,7) Q
"RTN","BPSOSQ2",101,0)
 . . I $P(RB0,U,2)'=30 Q  ; might have been canceled, or maybe 31'd
"RTN","BPSOSQ2",102,0)
 . . I $P(RB0,U,2)'=STATUS30 D  Q
"RTN","BPSOSQ2",103,0)
 . . . D IMPOSS^BPSOSUE("P","TI","IEN59 status "_$P(RB0,U,2)_" but must be 30",,"STATUS30",$T(+0))
"RTN","BPSOSQ2",104,0)
 . . D SETSTAT(40)
"RTN","BPSOSQ2",105,0)
 . . S RXILIST(IEN59)=""
"RTN","BPSOSQ2",106,0)
POINTX . ; (reversals branch here around multi-claim packeting)
"RTN","BPSOSQ2",107,0)
 . S ERROR=$$PACKET^BPSOSQG ; 
"RTN","BPSOSQ2",108,0)
 . S IEN59="" F  S IEN59=$O(RXILIST(IEN59)) Q:IEN59=""  D
"RTN","BPSOSQ2",109,0)
 . . I ERROR D
"RTN","BPSOSQ2",110,0)
 . . . D SETSTAT(99) ; 
"RTN","BPSOSQ2",111,0)
 . . . D SETRESU($P(ERROR,U),$P(ERROR,U,2,$L(ERROR,U))) ;
"RTN","BPSOSQ2",112,0)
 . . E  D
"RTN","BPSOSQ2",113,0)
 . . . D SETSTAT(50) ; "Waiting for transmit"
"RTN","BPSOSQ2",114,0)
 D UNLOCK59
"RTN","BPSOSQ2",115,0)
 Q
"RTN","BPSOSQ2",116,0)
TASK ;EP - BPSOS2D,BPSOSAP,BPSOSC3,BPSOSQG
"RTN","BPSOSQ2",117,0)
 N X,Y,%DT
"RTN","BPSOSQ2",118,0)
 S X="N",%DT="ST" D ^%DT
"RTN","BPSOSQ2",119,0)
 D TASKAT(Y)
"RTN","BPSOSQ2",120,0)
 Q
"RTN","BPSOSQ2",121,0)
TASKAT(ZTDTH) ;EP - BPSOSQJ
"RTN","BPSOSQ2",122,0)
 N ZTRTN,ZTIO,ZTSAVE
"RTN","BPSOSQ2",123,0)
 S ZTRTN="COMMS^BPSOSQ3",ZTIO=""
"RTN","BPSOSQ2",124,0)
 S ZTSAVE("DIALOUT")="" ; which entry in 9002313.55
"RTN","BPSOSQ2",125,0)
 D ^%ZTLOAD
"RTN","BPSOSQ2",126,0)
 Q
"RTN","BPSOSQ2",127,0)
KSCRATCH ;EP - BPSOSQG ; Kill scratch globals
"RTN","BPSOSQ2",128,0)
 K ^BPSECX($J,"R")
"RTN","BPSOSQ2",129,0)
 K ^BPSECX($J,"C")
"RTN","BPSOSQ2",130,0)
 Q
"RTN","BPSOSQ2",131,0)
 ;
"RTN","BPSOSQ2",132,0)
CHKPA() ;---------------------------------------------------------------  
"RTN","BPSOSQ2",133,0)
 N OVRREC,OVRFLD,NCPDPF,NCPDPFN,PACLM
"RTN","BPSOSQ2",134,0)
 S PACLM=0
"RTN","BPSOSQ2",135,0)
 ;
"RTN","BPSOSQ2",136,0)
 S OVRREC=$P($G(^BPST(IEN59,1)),U,13)   ;grab the overrides
"RTN","BPSOSQ2",137,0)
 Q:OVRREC="" 0   ;no overrides - can't be a prior auth claim
"RTN","BPSOSQ2",138,0)
 ;
"RTN","BPSOSQ2",139,0)
 ; loop through the overrides and look for the prior auth fields
"RTN","BPSOSQ2",140,0)
 S OVRFLD=0
"RTN","BPSOSQ2",141,0)
 F  S OVRFLD=$O(^BPS(9002313.511,OVRREC,1,OVRFLD)) Q:'+OVRFLD  D
"RTN","BPSOSQ2",142,0)
 . S NCPDPF=$P($G(^BPS(9002313.511,OVRREC,1,OVRFLD,0)),U) ;int fld
"RTN","BPSOSQ2",143,0)
 . S NCPDPFN=$P($G(^BPSF(9002313.91,NCPDPF,0)),U)  ;fld number
"RTN","BPSOSQ2",144,0)
 . Q:(NCPDPFN<498.01)!(NCPDPFN>498.04)
"RTN","BPSOSQ2",145,0)
 . S PACLM=1
"RTN","BPSOSQ2",146,0)
 ;
"RTN","BPSOSQ2",147,0)
 Q PACLM
"RTN","BPSOSQ2",148,0)
 ;
"RTN","BPSOSQ2",149,0)
CHKPA2() ;---------------------------------------------------------------  
"RTN","BPSOSQ2",150,0)
 N PATYP,PANUM
"RTN","BPSOSQ2",151,0)
 S PACLM=0
"RTN","BPSOSQ2",152,0)
 ;
"RTN","BPSOSQ2",153,0)
 S PATYP=$P($G(^BPST(IEN59,1)),U,15)    ;prior auth type code
"RTN","BPSOSQ2",154,0)
 S PANUM=$P($G(^BPST(IEN59,1)),U,9)     ;prior auth number
"RTN","BPSOSQ2",155,0)
 I ($G(PATYP)'="")!($G(PANUM)'="") S PACLM=1
"RTN","BPSOSQ2",156,0)
 ;
"RTN","BPSOSQ2",157,0)
 Q PACLM
"RTN","BPSOSQ3")
0^216^B54487638
"RTN","BPSOSQ3",1,0)
BPSOSQ3 ;BHAM ISC/FCS/DRS/DLF - tasked from BPSOSQ2 ;06/01/2004
"RTN","BPSOSQ3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQ3",3,0)
 Q
"RTN","BPSOSQ3",4,0)
 ; 
"RTN","BPSOSQ3",5,0)
 ; Subroutines split away from BPSOSQ3:
"RTN","BPSOSQ3",6,0)
 ;   EWAIT55^BPSOSQJ(DIALOUT,OPERATION) - manage ERROR WAIT condition
"RTN","BPSOSQ3",7,0)
 ;   ANY2SEND^BPSOSQJ(DIALOUT) - any claims waiting to be sent?
"RTN","BPSOSQ3",8,0)
 ;
"RTN","BPSOSQ3",9,0)
COMMS ; This is the entry point - usually by taskman call from BPSOSQ2.
"RTN","BPSOSQ3",10,0)
 ; Given DIALOUT = pointer into 9002313.55
"RTN","BPSOSQ3",11,0)
 ; Transmit and receive as long as you have claims to be transmitted
"RTN","BPSOSQ3",12,0)
 ; The task manager sets up DIALOUT in the call from BPSOSQ2.
"RTN","BPSOSQ3",13,0)
 ; When it's done with one DIALOUT, it looks around for others that
"RTN","BPSOSQ3",14,0)
 ; are in need of transmit, so you could end up doing lots of
"RTN","BPSOSQ3",15,0)
 ; transmissions in this one routine.
"RTN","BPSOSQ3",16,0)
 ;
"RTN","BPSOSQ3",17,0)
 ; Tell the world that we're up and running.
"RTN","BPSOSQ3",18,0)
 ;
"RTN","BPSOSQ3",19,0)
 I '$G(VARX) S VARX=0 S:'$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) VARX=1
"RTN","BPSOSQ3",20,0)
 L +^BPSECX("BPSOSQ3","JOB",$J):0 I '$T D  Q
"RTN","BPSOSQ3",21,0)
 . D IMPOSS^BPSOSUE("P","TI","can't obtain job-specific lock for $J="_$J_" ????",,"COMMS",$T(+0))
"RTN","BPSOSQ3",22,0)
 ;
"RTN","BPSOSQ3",23,0)
 ; Remark about ^BPSECX("BPSOSQ3","JOB",$J,...
"RTN","BPSOSQ3",24,0)
 ;    $$JOBCOUNT uses LOCKs to decide if they're running.
"RTN","BPSOSQ3",25,0)
 ;    If a job bombs, the global remains but the LOCK is gone.
"RTN","BPSOSQ3",26,0)
 ;    And that way, $$JOBCOUNT knows when to kill off such entries.
"RTN","BPSOSQ3",27,0)
 S ^BPSECX("BPSOSQ3","JOB",$J)=$H
"RTN","BPSOSQ3",28,0)
 S ^BPSECX("BPSOSQ3","JOB",$J,"DIALOUT")=DIALOUT
"RTN","BPSOSQ3",29,0)
 I $$JOBCOUNT>$$MAXJOBS H 2 I $$JOBCOUNT>$$MAXJOBS G ENDJOB99
"RTN","BPSOSQ3",30,0)
 ;
"RTN","BPSOSQ3",31,0)
 ; put in long delay here for testing stuff like cancel a claim
"RTN","BPSOSQ3",32,0)
 ;
"RTN","BPSOSQ3",33,0)
 I 0 H 300
"RTN","BPSOSQ3",34,0)
 ;
"RTN","BPSOSQ3",35,0)
 N BPSECT2,ABSBPOSE
"RTN","BPSOSQ3",36,0)
 ;
"RTN","BPSOSQ3",37,0)
 ; You need a slot for logging
"RTN","BPSOSQ3",38,0)
 ; DMB-11/11/2005 - Commented out the next line.  This was added by VA programmer,
"RTN","BPSOSQ3",39,0)
 ;   but I don't know why.  There is no slot defined at this point, so it was going
"RTN","BPSOSQ3",40,0)
 ;   to random places if there was a previous slot defined for $J or nowhere.
"RTN","BPSOSQ3",41,0)
 ;D LOG^BPSOSL("Before INIT^BPSOSL in BPSOSQ3 "_$J_" begins; SLOT="_$G(SLOT))
"RTN","BPSOSQ3",42,0)
 D INIT^BPSOSL(.1)
"RTN","BPSOSQ3",43,0)
 D LOG^BPSOSL("Sender/Receiver Job "_$J_" begins; DIALOUT="_DIALOUT)
"RTN","BPSOSQ3",44,0)
 ; DMB-11/11/2005 - Added VARX check as this writes to a table (9002313.55)
"RTN","BPSOSQ3",45,0)
 ;  that is not defined at the VA.
"RTN","BPSOSQ3",46,0)
 I 'VARX D REMEMLOG(DIALOUT,$$GETSLOT^BPSOSL)
"RTN","BPSOSQ3",47,0)
 ;
"RTN","BPSOSQ3",48,0)
AGAIN ; Loop back to here ; DIALOUT may have been changed since first entry
"RTN","BPSOSQ3",49,0)
 N RETVAL
"RTN","BPSOSQ3",50,0)
 S ^BPSECX("BPSOSQ3","JOB",$J,"DIALOUT")=DIALOUT
"RTN","BPSOSQ3",51,0)
 ;
"RTN","BPSOSQ3",52,0)
 I $$ANY2SEND^BPSOSQJ(DIALOUT) D
"RTN","BPSOSQ3",53,0)
 . D TASK(60) ; start up proc. of responses right now, 
"RTN","BPSOSQ3",54,0)
 . ; so something's ready - 60 = seconds for BPSOSQ4 to wait around
"RTN","BPSOSQ3",55,0)
 . ; for response packets to arrive
"RTN","BPSOSQ3",56,0)
 . S ABSBPOSE=$$TRANSMIT(DIALOUT) ; transmit / receive
"RTN","BPSOSQ3",57,0)
 E  S (BPSECT2,ABSBPOSE)=0 ; none sent, no errors
"RTN","BPSOSQ3",58,0)
 ;
"RTN","BPSOSQ3",59,0)
 I BPSECT2 D  ;if there were any complete transactions
"RTN","BPSOSQ3",60,0)
 . ; and someone hasn't already processed the responses,
"RTN","BPSOSQ3",61,0)
 . I $O(^BPSECX("POS",DIALOUT,"R",0)) D TASK() ; start up resp. handl'g
"RTN","BPSOSQ3",62,0)
 ; 
"RTN","BPSOSQ3",63,0)
 ; I there were any errors returned by $$TRANSMIT
"RTN","BPSOSQ3",64,0)
 ;   Check for the simple one-transaction-per-call case and loop back
"RTN","BPSOSQ3",65,0)
 ;   if that's what happened.
"RTN","BPSOSQ3",66,0)
 ;
"RTN","BPSOSQ3",67,0)
 I ABSBPOSE=6999.30101,BPSECT2>0 G AGAIN
"RTN","BPSOSQ3",68,0)
 ;
"RTN","BPSOSQ3",69,0)
 ; Else:
"RTN","BPSOSQ3",70,0)
 ; 1 Mark the DIAL OUT as being in an error state.
"RTN","BPSOSQ3",71,0)
 ; 2 Mark the ECME WORKING claims as being in an error wait state (51)
"RTN","BPSOSQ3",72,0)
 ; 3 Schedule this program to run again after the wait period expires.
"RTN","BPSOSQ3",73,0)
 ;
"RTN","BPSOSQ3",74,0)
 I 'VARX I ABSBPOSE D
"RTN","BPSOSQ3",75,0)
 . ; one call to EWAIT55^BPSOSQJ does it all
"RTN","BPSOSQ3",76,0)
 . ; if BPSECT2 (i.e., any successful transactions), then reset
"RTN","BPSOSQ3",77,0)
 . ; to first increment - else bump up to next increment
"RTN","BPSOSQ3",78,0)
 . S RETVAL=$$EWAIT55^BPSOSQJ(DIALOUT,$S(BPSECT2:"RESET",1:"INCREMENT"))
"RTN","BPSOSQ3",79,0)
 . N X S X=$T(+0)_" - Increment ERROR WAIT on Dial Out `"_DIALOUT
"RTN","BPSOSQ3",80,0)
 . S X=X_" to "_$P(^BPS(9002313.55,DIALOUT,"ERROR WAIT"),U)
"RTN","BPSOSQ3",81,0)
 . D LOG^BPSOSL(X)
"RTN","BPSOSQ3",82,0)
 E  I 'VARX I $P($G(^BPS(9002313.55,DIALOUT,"ERROR WAIT")),U) D
"RTN","BPSOSQ3",83,0)
 . ; No error, but should be clear the error on the dial-out?
"RTN","BPSOSQ3",84,0)
 . ; Case 1:  Yes, clear it if we had a successful transmit-receive.
"RTN","BPSOSQ3",85,0)
 . ; Case 2:  We had nothing to send, and there's no other active
"RTN","BPSOSQ3",86,0)
 . ;   transmit-receive jobs on this same dial-out trying to work.
"RTN","BPSOSQ3",87,0)
 . I ('$$OTHJOBS)!(BPSECT2) D
"RTN","BPSOSQ3",88,0)
 . . D LOG^BPSOSL($T(+0)_" - Clear ERROR WAIT - Dial Out #"_DIALOUT)
"RTN","BPSOSQ3",89,0)
 . . S RETVAL=$$EWAIT55^BPSOSQJ(DIALOUT,"CLEAR")
"RTN","BPSOSQ3",90,0)
 ;
"RTN","BPSOSQ3",91,0)
 ; We finished with DIALOUT 
"RTN","BPSOSQ3",92,0)
 K ^BPSECX("BPSOSQ3","JOB",$J,"DIALOUT")
"RTN","BPSOSQ3",93,0)
 ; - any others to do, though?
"RTN","BPSOSQ3",94,0)
 ; Give it 10 seconds; more efficient than task managering again
"RTN","BPSOSQ3",95,0)
 H 10
"RTN","BPSOSQ3",96,0)
TOLOOP ;
"RTN","BPSOSQ3",97,0)
 ; Now that transmit is done for this DIALOUT, maybe there are others
"RTN","BPSOSQ3",98,0)
 ; we can help out with?
"RTN","BPSOSQ3",99,0)
 I '$$SHUTDOWN S DIALOUT=$$ANY2SEND^BPSOSQJ I DIALOUT D  G AGAIN
"RTN","BPSOSQ3",100,0)
 . D LOG^BPSOSL($T(+0)_" - $$ANY2SEND^BPSOSQJ(DIALOUT)="_DIALOUT_": loop back")
"RTN","BPSOSQ3",101,0)
 ;
"RTN","BPSOSQ3",102,0)
ENDJOB ;
"RTN","BPSOSQ3",103,0)
 D LOG^BPSOSL("Sender/Receiver Job "_$J_" ends")
"RTN","BPSOSQ3",104,0)
 D DONE^BPSOSL
"RTN","BPSOSQ3",105,0)
ENDJOB99 ; 
"RTN","BPSOSQ3",106,0)
 I '$D(^BPSECX("BPSOSQ3","JOB",$J)) D  ; impossible
"RTN","BPSOSQ3",107,0)
 . D IMPOSS^BPSOSUE("P","TI","my job-defined locked node disappeared!!!  $J="_$J,,"ENDJOB99",$T(+0))
"RTN","BPSOSQ3",108,0)
 K ^BPSECX("BPSOSQ3","JOB",$J)
"RTN","BPSOSQ3",109,0)
 L -^BPSECX("BPSOSQ3","JOB",$J)
"RTN","BPSOSQ3",110,0)
 ;
"RTN","BPSOSQ3",111,0)
 Q
"RTN","BPSOSQ3",112,0)
OTHJOBS() ; any other transmit-receive jobs using DIALOUT?  returns count of
"RTN","BPSOSQ3",113,0)
 N A,R S (A,R)=0
"RTN","BPSOSQ3",114,0)
 F  S A=$O(^BPSECX("BPSOSQ3","JOB",A)) Q:'A  D
"RTN","BPSOSQ3",115,0)
 . I DIALOUT=$G(^BPSECX("BPSOSQ3","JOB",A,"DIALOUT")) S R=R+1
"RTN","BPSOSQ3",116,0)
 Q R
"RTN","BPSOSQ3",117,0)
TASK(Q4WAIT) ;EP - BPSOS2D,BPSOSQ4 ; start processing of responses
"RTN","BPSOSQ3",118,0)
 N X,Y,%DT
"RTN","BPSOSQ3",119,0)
 S X="N",%DT="ST" D ^%DT
"RTN","BPSOSQ3",120,0)
 D TASKAT(Y,$G(Q4WAIT))
"RTN","BPSOSQ3",121,0)
 Q
"RTN","BPSOSQ3",122,0)
TASKAT(ZTDTH,Q4WAIT) ; EP -
"RTN","BPSOSQ3",123,0)
 ;ZTDTH = time when you want EN^BPSOSQ4 to run
"RTN","BPSOSQ3",124,0)
 ; called from TASK, above, normally
"RTN","BPSOSQ3",125,0)
 ; Q4WAIT true: it will wait that many seconds for responses to come in,
"RTN","BPSOSQ3",126,0)
 ; polling every few seconds.
"RTN","BPSOSQ3",127,0)
 ; Q4WAIT false: if there's none ready, it stops
"RTN","BPSOSQ3",128,0)
 N ZTRTN,ZTIO,ZTSAVE
"RTN","BPSOSQ3",129,0)
 S ZTRTN="EN^BPSOSQ4",ZTIO=""
"RTN","BPSOSQ3",130,0)
 S ZTSAVE("DIALOUT")="" ; which entry in 9002313.55
"RTN","BPSOSQ3",131,0)
 I $G(Q4WAIT) S ZTSAVE("Q4WAIT")=""
"RTN","BPSOSQ3",132,0)
 D ^%ZTLOAD
"RTN","BPSOSQ3",133,0)
 Q
"RTN","BPSOSQ3",134,0)
 ;
"RTN","BPSOSQ3",135,0)
TRANSMIT(DIALOUT) ; returns 0 if success, nonzero error code if failure
"RTN","BPSOSQ3",136,0)
 ; This does transmit/receive for ONLY the given DIALOUT
"RTN","BPSOSQ3",137,0)
 N ECODE,ERROR S ERROR=0
"RTN","BPSOSQ3",138,0)
 ; ERROR codes:   
"RTN","BPSOSQ3",139,0)
 ;  3xx - in (to be completed - routine names changed)
"RTN","BPSOSQ3",140,0)
 ; 69xx - in
"RTN","BPSOSQ3",141,0)
 ; 80xx - in
"RTN","BPSOSQ3",142,0)
 ;
"RTN","BPSOSQ3",143,0)
 ; Dialing and $$CONNECT moved into $$SEND
"RTN","BPSOSQ3",144,0)
 ; S ECODE=$$CONNECT(DIALOUT) ; connect to NDC (or other host)
"RTN","BPSOSQ3",145,0)
 ;
"RTN","BPSOSQ3",146,0)
TMIT1 S ECODE=$$SEND(DIALOUT) ; transmit and receive
"RTN","BPSOSQ3",147,0)
 ; in case the OPEN failed, wait about one transaction xmit time or so
"RTN","BPSOSQ3",148,0)
 I +ECODE=20999 H 10 H $R(5) G TMIT1 ; 
"RTN","BPSOSQ3",149,0)
 ; sets BPSECT2=count
"RTN","BPSOSQ3",150,0)
 I $G(VARX) Q 0  ;LJE;7/17/03
"RTN","BPSOSQ3",151,0)
 ;
"RTN","BPSOSQ3",152,0)
 N RETVAL S RETVAL=$$CLOSE^BPSOSAB(DIALOUT)
"RTN","BPSOSQ3",153,0)
 D ADDSTAT^BPSOSUD("D",1,1,"D",2,$G(BPSECT2),"D",3,ECODE'=0)
"RTN","BPSOSQ3",154,0)
 ;
"RTN","BPSOSQ3",155,0)
 I ECODE=0 D  ; success
"RTN","BPSOSQ3",156,0)
 . S RETVAL=$$EWAIT55^BPSOSQJ(DIALOUT,"CLEAR") ; clear any error indicators
"RTN","BPSOSQ3",157,0)
 E  D
"RTN","BPSOSQ3",158,0)
 . S RETVAL=$$EWAIT55^BPSOSQJ(DIALOUT,"INCREMENT") ; init or incr err indicator
"RTN","BPSOSQ3",159,0)
 . N X S X="CLAIM - ERROR - "_ECODE_" - "
"RTN","BPSOSQ3",160,0)
 . S X=X_$P($G(^BPSF(9002313.89,ECODE,0)),U,2)
"RTN","BPSOSQ3",161,0)
 . D LOG^BPSOSL(X)
"RTN","BPSOSQ3",162,0)
 ;
"RTN","BPSOSQ3",163,0)
 Q $S(ECODE:6999_"."_ECODE,1:0)
"RTN","BPSOSQ3",164,0)
 ;
"RTN","BPSOSQ3",165,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSQ3",166,0)
 ;
"RTN","BPSOSQ3",167,0)
 ;
"RTN","BPSOSQ3",168,0)
SEND(DEST)         ;
"RTN","BPSOSQ3",169,0)
 S BPSECT2=0
"RTN","BPSOSQ3",170,0)
 N RET S RET=$$SEND^BPSOSAM(DEST)
"RTN","BPSOSQ3",171,0)
 I BPSECT2 D
"RTN","BPSOSQ3",172,0)
 . N X S X=$T(+0)_" - Complete transactions: "_BPSECT2
"RTN","BPSOSQ3",173,0)
 . D LOG^BPSOSL(X)
"RTN","BPSOSQ3",174,0)
 I RET D
"RTN","BPSOSQ3",175,0)
 . I RET=20999 D  ; couldn't open device (not unusual)
"RTN","BPSOSQ3",176,0)
 . . ;
"RTN","BPSOSQ3",177,0)
 . E  D
"RTN","BPSOSQ3",178,0)
 . . N X S X=$T(+0)_" - Error code "_RET_" returned from $$SEND^BPSOSAM"
"RTN","BPSOSQ3",179,0)
 . . D LOG^BPSOSL(X)
"RTN","BPSOSQ3",180,0)
 Q RET
"RTN","BPSOSQ3",181,0)
ROOTREF(DEST)          Q "^BPSECX(""POS"","_DEST_",""C"")"
"RTN","BPSOSQ3",182,0)
SETSTAT(ABSBRXI,STAT)        D SETSTAT^BPSOSU(STAT) Q
"RTN","BPSOSQ3",183,0)
TSTAMP(DA)         N DIE,DR S DIE=9002313.59,DR="7///NOW" D ^DIE Q
"RTN","BPSOSQ3",184,0)
REMEMLOG(N,SLOT)   ; ^("LOG FILE") remembers current and past several log files
"RTN","BPSOSQ3",185,0)
 N X S X=$G(^BPS(9002313.55,N,"LOG FILE"))
"RTN","BPSOSQ3",186,0)
 S X=SLOT_U_$P(X,U,1,9)
"RTN","BPSOSQ3",187,0)
 S ^BPS(9002313.55,N,"LOG FILE")=X
"RTN","BPSOSQ3",188,0)
 Q
"RTN","BPSOSQ3",189,0)
 ;
"RTN","BPSOSQ3",190,0)
 ; = = = = = = = = = = UTILITIES = = = = = = = = = =
"RTN","BPSOSQ3",191,0)
 ; ^BPSECX("BPSOSQ3","JOB",$J) is set for each of these that's running
"RTN","BPSOSQ3",192,0)
 ;   and the node is also LOCKed.
"RTN","BPSOSQ3",193,0)
 ; ^TMP($J,"BPSOSQ3","SHUTDOWN") tells these to shut down.
"RTN","BPSOSQ3",194,0)
 ;  $$SHUTDOWN() to query, $$SHUTDOWN(N) to set it.
"RTN","BPSOSQ3",195,0)
 ;     >0 means shut down, =0 means enabled
"RTN","BPSOSQ3",196,0)
 ; ^TMP($J,"BPSOSQ3","MAX JOBS")=maximum # of these you want running
"RTN","BPSOSQ3",197,0)
 ;    May actually be greater than that, but excess ones will drop out.
"RTN","BPSOSQ3",198,0)
 ; $$MAXJOBS() to query, $$MAXJOBS(n) to set it.
"RTN","BPSOSQ3",199,0)
 ;
"RTN","BPSOSQ3",200,0)
 ; JOBCOUNT  tells you how many of these are running right now
"RTN","BPSOSQ3",201,0)
 ;
"RTN","BPSOSQ3",202,0)
JOBMON ; temporary, for use by direct mode debugging
"RTN","BPSOSQ3",203,0)
 F  W $$JOBCOUNT(1)," ",$P($H,",",2)," / " W:$X>60 ! H 1
"RTN","BPSOSQ3",204,0)
 Q
"RTN","BPSOSQ3",205,0)
JOBCOUNT(ECHO) N N,X S N=0
"RTN","BPSOSQ3",206,0)
 S X="" F  S X=$O(^BPSECX("BPSOSQ3","JOB",X)) Q:X=""  D
"RTN","BPSOSQ3",207,0)
 .L +^BPSECX("BPSOSQ3","JOB",X):0
"RTN","BPSOSQ3",208,0)
 .I '$T S N=N+1 ; yes, it's really running
"RTN","BPSOSQ3",209,0)
 .E  D
"RTN","BPSOSQ3",210,0)
 ..I X=$J S N=N+1 ; it's us, we're that job, that's why LOCK succeeded
"RTN","BPSOSQ3",211,0)
 ..E  D  ; we got the lock, and we must unlock
"RTN","BPSOSQ3",212,0)
 ...I $G(ECHO) W "We're going to kill the entry for job ",X,!
"RTN","BPSOSQ3",213,0)
 ...K ^BPSECX("BPSOSQ3","JOB",X) ; it's not running, must've bombed
"RTN","BPSOSQ3",214,0)
 ..L -^BPSECX("BPSOSQ3","JOB",X)
"RTN","BPSOSQ3",215,0)
 Q N
"RTN","BPSOSQ3",216,0)
 ;
"RTN","BPSOSQ3",217,0)
LOCK(X) L +^TMP($J,"BPSOSQ3",X):300 Q $T
"RTN","BPSOSQ3",218,0)
UNLOCK(X) L -^TMP($J,"BPSOSQ3",X) Q
"RTN","BPSOSQ3",219,0)
 ;
"RTN","BPSOSQ3",220,0)
SHUTDOWN(N) ;EP - BPSOS2A,BPSOSAM
"RTN","BPSOSQ3",221,0)
 N RET,ROU,X
"RTN","BPSOSQ3",222,0)
 S ROU=$T(+0),X="SHUTDOWN"
"RTN","BPSOSQ3",223,0)
 F  Q:$$LOCK(X)  Q:'$$IMPOSS^BPSOSUE("L","RIT","LOCK of SHUTDOWN flag",,"SHUTDOWN",$T(+0))  H 30
"RTN","BPSOSQ3",224,0)
 I $D(N) S ^TMP($J,"BPSOSQ3",$J,X)=N
"RTN","BPSOSQ3",225,0)
 S RET=+$G(^TMP($J,"BPSOSQ3",$J,X))
"RTN","BPSOSQ3",226,0)
 D UNLOCK(X)
"RTN","BPSOSQ3",227,0)
 Q RET
"RTN","BPSOSQ3",228,0)
 ;
"RTN","BPSOSQ3",229,0)
MAXJOBS(N) ;EP - BPSOS2A
"RTN","BPSOSQ3",230,0)
 N RET,ROU,X S RET=0
"RTN","BPSOSQ3",231,0)
 S ROU=$T(+0),X="MAX JOBS"
"RTN","BPSOSQ3",232,0)
 I '$$LOCK(X) ;
"RTN","BPSOSQ3",233,0)
 I $D(N) S ^TMP($J,"BPSOSQ3",X)=N
"RTN","BPSOSQ3",234,0)
 S RET=$G(^TMP($J,"BPSOSQ3",X))
"RTN","BPSOSQ3",235,0)
 I 'RET S (RET,^TMP($J,"BPSOSQ3",X))=1 ; an arbitrary default for first timers
"RTN","BPSOSQ3",236,0)
 D UNLOCK(X)
"RTN","BPSOSQ3",237,0)
 Q RET
"RTN","BPSOSQ4")
0^217^B49295427
"RTN","BPSOSQ4",1,0)
BPSOSQ4 ;BHAM ISC/FCS/DRS/DLF - Process responses ;06/01/2004
"RTN","BPSOSQ4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQ4",3,0)
 ; Called from BPSOSQ3 at RESPONSE()
"RTN","BPSOSQ4",4,0)
 ;
"RTN","BPSOSQ4",5,0)
 ; What's here:  the main LOOP and several miscellaneous subroutines,
"RTN","BPSOSQ4",6,0)
 ;  many of which are called from outside.
"RTN","BPSOSQ4",7,0)
 ;
"RTN","BPSOSQ4",8,0)
 ;  The meat of the response packet processing is in RESPONSE^BPSOSQL
"RTN","BPSOSQ4",9,0)
 ;   and its subroutines, ONE, ONE1, RESP1
"RTN","BPSOSQ4",10,0)
 ;
"RTN","BPSOSQ4",11,0)
 ;---------------------------------------------------------
"RTN","BPSOSQ4",12,0)
 ;IHS/SD/lwj 10/07/02  NCPDP 5.1 changes
"RTN","BPSOSQ4",13,0)
 ; The responses are exactly the same between 5.1 and 3.2 - we needed
"RTN","BPSOSQ4",14,0)
 ; to add new logic to RESP1000 and RESPMSG to capture the newer
"RTN","BPSOSQ4",15,0)
 ; information
"RTN","BPSOSQ4",16,0)
 ;
"RTN","BPSOSQ4",17,0)
 ;---------------------------------------------------------
"RTN","BPSOSQ4",18,0)
 Q
"RTN","BPSOSQ4",19,0)
EN ; the task from BPSOSQ3 starts here
"RTN","BPSOSQ4",20,0)
 ; for a specific DIALOUT
"RTN","BPSOSQ4",21,0)
 ; Q4WAIT might be defined, too
"RTN","BPSOSQ4",22,0)
 I '$G(Q4WAIT),'$O(^BPSECX("POS",DIALOUT,"R",0)) Q  ; not waiting; nothing ready
"RTN","BPSOSQ4",23,0)
 N A,B,BLIMIT,ODIALOUT,GOTLOCK ; "O" as in "Original"
"RTN","BPSOSQ4",24,0)
 S ODIALOUT=DIALOUT,BLIMIT=$G(Q4WAIT,10)
"RTN","BPSOSQ4",25,0)
 D INIT^BPSOSL(.11)
"RTN","BPSOSQ4",26,0)
 D LOG($T(+0)_" - Job "_$J_" processing ECME responses.")
"RTN","BPSOSQ4",27,0)
LOOP ;
"RTN","BPSOSQ4",28,0)
 ; The task may have been started before the responses were ready yet.
"RTN","BPSOSQ4",29,0)
 ; For example, it may have been started before dialing - figure up
"RTN","BPSOSQ4",30,0)
 ; to a minute before something might be available.
"RTN","BPSOSQ4",31,0)
 S B=0 F A=5:5:BLIMIT D  Q:B
"RTN","BPSOSQ4",32,0)
 . S B=$O(^BPSECX("POS",DIALOUT,"R","")) Q:B
"RTN","BPSOSQ4",33,0)
 . HANG 2+$R(6) ; averages out to 5 seconds between checking
"RTN","BPSOSQ4",34,0)
 I 'B G LOOP7  ; no responses ready for this DIALOUT
"RTN","BPSOSQ4",35,0)
LOOP1 ;
"RTN","BPSOSQ4",36,0)
 D LOG($T(+0)_" - Processing responses for DIALOUT="_DIALOUT)
"RTN","BPSOSQ4",37,0)
 L +^TMP($J,"BPSOSQ4",DIALOUT):5 ; only one job per DIALOUT (overcautious)
"RTN","BPSOSQ4",38,0)
 S GOTLOCK=$T
"RTN","BPSOSQ4",39,0)
 I GOTLOCK D
"RTN","BPSOSQ4",40,0)
 . D RESPONSE^BPSOSQL(DIALOUT) ; process all responses for this DIALOUT
"RTN","BPSOSQ4",41,0)
 . L -^TMP($J,"BPSOSQ4",DIALOUT)
"RTN","BPSOSQ4",42,0)
 . D LOG($T(+0)_" - Done for DIALOUT="_DIALOUT)
"RTN","BPSOSQ4",43,0)
 E  D  G LOOP9
"RTN","BPSOSQ4",44,0)
 . D LOG($T(+0)_" - couldn't get LOCK?  Another one already running?")
"RTN","BPSOSQ4",45,0)
 . D TASKAT^BPSOSQ3($$TADDNOW^BPSOSUD(.0002)) ; try again in 2 mins.
"RTN","BPSOSQ4",46,0)
LOOP7 S DIALOUT=$$ANYRESPS(0) ; any others for anybody else we can do now?
"RTN","BPSOSQ4",47,0)
 I DIALOUT G LOOP1
"RTN","BPSOSQ4",48,0)
 I B S DIALOUT=ODIALOUT,BLIMIT=10 G LOOP ; worth looping back to check original
"RTN","BPSOSQ4",49,0)
LOOP9 D LOG($T(+0)_" - Job "_$J_" completed.")
"RTN","BPSOSQ4",50,0)
 D RELSLOT^BPSOSL
"RTN","BPSOSQ4",51,0)
 ; If there are any Status 19's, rev up a processor to rescue them
"RTN","BPSOSQ4",52,0)
 I $D(^BPST("AD",19)) D TASK^BPSOSIZ ; BPSOSQ1
"RTN","BPSOSQ4",53,0)
 Q
"RTN","BPSOSQ4",54,0)
LOG(X) D LOG^BPSOSL(X) Q
"RTN","BPSOSQ4",55,0)
ANYRESPS(DIALOUT) ;EP - BPSOS2D ;
"RTN","BPSOSQ4",56,0)
 ; are there any responses waiting to be processed?
"RTN","BPSOSQ4",57,0)
 ; Also called from POKE^BPSOSUD
"RTN","BPSOSQ4",58,0)
 I $G(DIALOUT) Q $S($O(^BPSECX("POS",DIALOUT,"R","")):DIALOUT,1:0)
"RTN","BPSOSQ4",59,0)
 ; DIALOUT not given, so look for any DIALOUTs that need work
"RTN","BPSOSQ4",60,0)
 ; If any waiting, return DIALOUT where there are
"RTN","BPSOSQ4",61,0)
 ; Else return ""
"RTN","BPSOSQ4",62,0)
 N SET,RET S (SET,RET)=0
"RTN","BPSOSQ4",63,0)
 F  S SET=$O(^BPS(9002313.55,SET)) Q:'SET  I $$ANYRESPS(SET) S RET=SET Q
"RTN","BPSOSQ4",64,0)
 Q RET
"RTN","BPSOSQ4",65,0)
 ;
"RTN","BPSOSQ4",66,0)
 ; The following are separate little utilities called from elsewhere.
"RTN","BPSOSQ4",67,0)
 ;
"RTN","BPSOSQ4",68,0)
PAID(IEN59) ;EP - BPSOSQS ;quick query to see if it's paid
"RTN","BPSOSQ4",69,0)
 N TMP D RESPINFO(IEN59,.TMP) Q:'$D(TMP("RSP")) 0
"RTN","BPSOSQ4",70,0)
 N X S X=TMP("RSP")
"RTN","BPSOSQ4",71,0)
 I X="Payable" Q 1
"RTN","BPSOSQ4",72,0)
 Q 0
"RTN","BPSOSQ4",73,0)
RESPINFO(RXI,DST) ;EP - BPSOS6B,BPSOSNC,BPSOSUA
"RTN","BPSOSQ4",74,0)
 ; quick way to get all the response info for a given RXI
"RTN","BPSOSQ4",75,0)
 ; IMPORTANT!!  D not change spelling, case, wording, or spacing!!!
"RTN","BPSOSQ4",76,0)
 ; Callers such as BPSOSNC are depending on the exact DST("RSP")
"RTN","BPSOSQ4",77,0)
 ; If a reversal was attempted, it complicates things.
"RTN","BPSOSQ4",78,0)
 ;  fills DST array as follows:
"RTN","BPSOSQ4",79,0)
 ; DST("HDR")=Response Status (header)
"RTN","BPSOSQ4",80,0)
 ; DST("RSP")=Response Status (prescription)
"RTN","BPSOSQ4",81,0)
 ;   This could be:  "Payable"  "Rejected"  "Captured"  "Duplicate"
"RTN","BPSOSQ4",82,0)
 ;   or  "Accepted reversal"  or  "Rejected reversal"
"RTN","BPSOSQ4",83,0)
 ;   or  "null"   or "null reversal"  (no response or corrupt response
"RTN","BPSOSQ4",84,0)
 ;    or maybe someone without insurance, so no request was sent)
"RTN","BPSOSQ4",85,0)
 ; DST("REJ",0)=count of reject codes
"RTN","BPSOSQ4",86,0)
 ; DST("REJ",n)=each reject code
"RTN","BPSOSQ4",87,0)
 ; DST("MSG")=message with the response
"RTN","BPSOSQ4",88,0)
 ; All of these are defined, even if originals were '$D.
"RTN","BPSOSQ4",89,0)
 ; The external forms are returned.
"RTN","BPSOSQ4",90,0)
 N REVERSAL S REVERSAL=$G(^BPST(RXI,4))>0
"RTN","BPSOSQ4",91,0)
 N RESP
"RTN","BPSOSQ4",92,0)
 I 'REVERSAL S RESP=$P(^BPST(RXI,0),U,5)
"RTN","BPSOSQ4",93,0)
 E  S RESP=$P(^BPST(RXI,4),U,2)
"RTN","BPSOSQ4",94,0)
 Q:'RESP
"RTN","BPSOSQ4",95,0)
 N ECME S POS=$P(^BPST(RXI,0),U,9) Q:'POS
"RTN","BPSOSQ4",96,0)
 N FMT S FMT="E"
"RTN","BPSOSQ4",97,0)
 S DST("HDR")=$$RESP500(RESP,FMT)
"RTN","BPSOSQ4",98,0)
 S DST("RSP")=$$RESP1000(RESP,POS,FMT)
"RTN","BPSOSQ4",99,0)
 S DST("REJ",0)=$$REJCOUNT(RESP,POS,FMT)
"RTN","BPSOSQ4",100,0)
 I DST("REJ",0) D
"RTN","BPSOSQ4",101,0)
 .N I F I=1:1:DST("REJ",0) S DST("REJ",I)=$$REJCODE(RESP,POS,I,FMT)
"RTN","BPSOSQ4",102,0)
 S DST("MSG")=$$RESPMSG(RESP,POS,FMT)
"RTN","BPSOSQ4",103,0)
 ; Dealing with oddities of PCS (and others'?) response to reversals
"RTN","BPSOSQ4",104,0)
 I REVERSAL,DST("RSP")["null" D
"RTN","BPSOSQ4",105,0)
 .I DST("RSP")["null" S DST("RSP")=DST("HDR")_" reversal"
"RTN","BPSOSQ4",106,0)
 Q
"RTN","BPSOSQ4",107,0)
 ; In the following quickies:
"RTN","BPSOSQ4",108,0)
 ; RESP = RESPIEN, pointer to 9002313.03
"RTN","BPSOSQ4",109,0)
 ; FMT = "I" for internal, "E" for external, defaults to internal
"RTN","BPSOSQ4",110,0)
RESP500(RESP,FMT) ;EP - BPSOS57,BPSOSP2,BPSOSUC
"RTN","BPSOSQ4",111,0)
 ; returns the response header status
"RTN","BPSOSQ4",112,0)
 N X S X=$P($G(^BPSR(RESP,500)),U)
"RTN","BPSOSQ4",113,0)
 I $G(FMT)'="E" Q X
"RTN","BPSOSQ4",114,0)
 I X="" S X="null"
"RTN","BPSOSQ4",115,0)
 S X=$S(X="A":"Accepted",X="R":"Rejected",1:"?"_X)
"RTN","BPSOSQ4",116,0)
 Q X
"RTN","BPSOSQ4",117,0)
RESP1000(RESP,POS,FMT) ;EP - BPSOSP2,BPSOSUC
"RTN","BPSOSQ4",118,0)
 ; returns the prescription response status
"RTN","BPSOSQ4",119,0)
 ; Note!  Could be DP or DC for duplicates
"RTN","BPSOSQ4",120,0)
 N X S X=$P($G(^BPSR(RESP,1000,POS,500)),U)
"RTN","BPSOSQ4",121,0)
 I $G(FMT)'="E" Q X
"RTN","BPSOSQ4",122,0)
 I X="" S X="null"
"RTN","BPSOSQ4",123,0)
 ;
"RTN","BPSOSQ4",124,0)
 ;IHS/SD/lwj 10/07/02 NCPDP 5.1 changes - they will send an "A" back
"RTN","BPSOSQ4",125,0)
 ; now on the transaction level to indicate that it has been accepted
"RTN","BPSOSQ4",126,0)
 ; Next code line remarked out - following added
"RTN","BPSOSQ4",127,0)
 ;
"RTN","BPSOSQ4",128,0)
 S X=$S(X="A":"Accepted",X="P":"Payable",X="R":"Rejected",X="C":"Captured",X="D"!(X="DP")!(X="DC"):"Duplicate",1:"?"_X)
"RTN","BPSOSQ4",129,0)
 Q X
"RTN","BPSOSQ4",130,0)
REJCOUNT(RESP,POS,FMT) ; returns rejection count
"RTN","BPSOSQ4",131,0)
 Q +$P($G(^BPSR(RESP,1000,POS,511,0)),U,3)
"RTN","BPSOSQ4",132,0)
REJCODE(RESP,POS,N,FMT)          ; returns Nth rejection code
"RTN","BPSOSQ4",133,0)
 ; if FMT="E", returns code:text
"RTN","BPSOSQ4",134,0)
 N CODE S CODE=$P($G(^BPSR(RESP,1000,POS,511,N,0)),U)
"RTN","BPSOSQ4",135,0)
 I CODE="" S CODE="null"
"RTN","BPSOSQ4",136,0)
 I FMT'="E" Q CODE
"RTN","BPSOSQ4",137,0)
 N X S X=$O(^BPSF(9002313.93,"B",CODE,0))
"RTN","BPSOSQ4",138,0)
 I X]"" S CODE=CODE_":"_$P($G(^BPSF(9002313.93,X,0)),U,2)
"RTN","BPSOSQ4",139,0)
 E  S CODE="?"_CODE
"RTN","BPSOSQ4",140,0)
 Q CODE
"RTN","BPSOSQ4",141,0)
 ;
"RTN","BPSOSQ4",142,0)
 ;IHS/SD/lwj 10/07/02 NCPDP 5.1 changes - message may not come
"RTN","BPSOSQ4",143,0)
 ; back in 504 - may come back in 526 instead
"RTN","BPSOSQ4",144,0)
 ;
"RTN","BPSOSQ4",145,0)
RESPMSG(RESP,POS,FMT)  ; response message - additional text from insurer
"RTN","BPSOSQ4",146,0)
 ;
"RTN","BPSOSQ4",147,0)
 N MSG
"RTN","BPSOSQ4",148,0)
 S MSG=""
"RTN","BPSOSQ4",149,0)
 S MSG=$G(^BPSR(RESP,1000,POS,504))
"RTN","BPSOSQ4",150,0)
 S:MSG="" MSG=$G(^BPSR(RESP,1000,POS,526))
"RTN","BPSOSQ4",151,0)
 Q MSG
"RTN","BPSOSQ4",152,0)
 ;
"RTN","BPSOSQ4",153,0)
 ;IHS/SD/lwj 10/07/02 end of NCPDP 5.1 changes to RESPMSG
"RTN","BPSOSQ4",154,0)
 ;
"RTN","BPSOSQ4",155,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSQ4",156,0)
 ;
"RTN","BPSOSQ4",157,0)
 ;  The xxxSLEEP functions are called from BPSOSQL
"RTN","BPSOSQ4",158,0)
 ;
"RTN","BPSOSQ4",159,0)
CLRSLEEP(IEN59,INS,WHY) ;EP - BPSOSQL
"RTN","BPSOSQ4",160,0)
 ; clear insurer sleeping condition
"RTN","BPSOSQ4",161,0)
 ; also called from CANCEL^BPSOSUD
"RTN","BPSOSQ4",162,0)
 ; WHY = 1 - we know for sure they're awake now
"RTN","BPSOSQ4",163,0)
 ;
"RTN","BPSOSQ4",164,0)
 ; skip the sleeping check for VA, the check will be done by IB DLF 7/31/03
"RTN","BPSOSQ4",165,0)
 ;
"RTN","BPSOSQ4",166,0)
 N X,VARX
"RTN","BPSOSQ4",167,0)
 S VARX=0
"RTN","BPSOSQ4",168,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),U,1) S VARX=1
"RTN","BPSOSQ4",169,0)
 I VARX D
"RTN","BPSOSQ4",170,0)
 . I $D(^BPST(IEN59,8)) S $P(^BPST(IEN59,8),U,1)="",$P(^BPST(IEN59,8),U,3)=""
"RTN","BPSOSQ4",171,0)
 . S X=$P($G(^BPSF(9002313.92,INS,1)),U,12)
"RTN","BPSOSQ4",172,0)
 . I 'X Q
"RTN","BPSOSQ4",173,0)
 . S $P(^BPSF(9002313.92,INS,1),U,11)=""
"RTN","BPSOSQ4",174,0)
 . S $P(^BPSF(9002313.92,INS,1),U,12)=""
"RTN","BPSOSQ4",175,0)
 E  D
"RTN","BPSOSQ4",176,0)
 . S X=$G(^BPSEI(INS,101))
"RTN","BPSOSQ4",177,0)
 . I 'X Q  ; not asleep
"RTN","BPSOSQ4",178,0)
 . S $P(X,U)="",$P(X,U,5)="",$P(X,U,6)="",^BPSEI(INS,101)=X
"RTN","BPSOSQ4",179,0)
 ;
"RTN","BPSOSQ4",180,0)
 ; If this insurer was asleep and there are other 31, check if they
"RTN","BPSOSQ4",181,0)
 ;   should be done
"RTN","BPSOSQ4",182,0)
 I X,$D(^BPST("AD",31)) D TASK^BPSOSQ1
"RTN","BPSOSQ4",183,0)
 Q
"RTN","BPSOSQ4",184,0)
REJSLEEP(RESP,POS) ;EP - BPSOSQL
"RTN","BPSOSQ4",185,0)
 ; return TRUE if this claim was rejected because the
"RTN","BPSOSQ4",186,0)
 ; insurer is sleeping
"RTN","BPSOSQ4",187,0)
 ; Reject codes we look for depend on which switch.
"RTN","BPSOSQ4",188,0)
 ; Envoy's:
"RTN","BPSOSQ4",189,0)
 ; Insurer Asleep disabled for VA Phase III - DMB 1/5/2006
"RTN","BPSOSQ4",190,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),U,1) Q 0
"RTN","BPSOSQ4",191,0)
 I $G(^BPSR(RESP,1000,POS,504))?1"EV16-".E Q 1
"RTN","BPSOSQ4",192,0)
 I $G(^BPSR(RESP,1000,POS,504))?1"EV38-".E Q 1
"RTN","BPSOSQ4",193,0)
 I $G(^BPSR(RESP,1000,POS,504))?1"EV32-".E Q 1
"RTN","BPSOSQ4",194,0)
 I $G(^BPSR(RESP,1000,POS,504))?1"EV25-".E Q 1 ; BPS*1.0T7*4
"RTN","BPSOSQ4",195,0)
 ; NDC's, and theoretically, Envoy too, though they seem to do EV- msgs
"RTN","BPSOSQ4",196,0)
 I $O(^BPSR(RESP,1000,POS,511,"B",90))="" Q 0 ; cheap check
"RTN","BPSOSQ4",197,0)
 ; But for a PCS case we see, Code 99 + some code < 90 ; BPS*1.0T7*2
"RTN","BPSOSQ4",198,0)
 ; isn't "asleep" - 99 is something PCS threw in       ; BPS*1.0T7*2
"RTN","BPSOSQ4",199,0)
 ; so require 99 to be accompanied by something <99 too ; BPS*1.0T7*2
"RTN","BPSOSQ4",200,0)
 N RET S RET=0 N I F I=92,93,99 D  Q:RET
"RTN","BPSOSQ4",201,0)
 . I $D(^BPSR(RESP,1000,POS,511,"B",I)) S RET=1
"RTN","BPSOSQ4",202,0)
 . Q:I'=99  Q:'RET  ; BPS*1.0T7*2
"RTN","BPSOSQ4",203,0)
 . I I=99,$O(^BPSR(RESP,1000,POS,511,"B",0))<90 S RET=0 ; BPS*1.0T7*2
"RTN","BPSOSQ4",204,0)
 Q RET
"RTN","BPSOSQ4",205,0)
INCSLEEP(INSURER) ;EP - BPSOSQL
"RTN","BPSOSQ4",206,0)
 ; Increment sleep time for this insurer, if necessary.
"RTN","BPSOSQ4",207,0)
 ; Return the scheduled retry time
"RTN","BPSOSQ4",208,0)
 N X,VARX,TASKTM
"RTN","BPSOSQ4",209,0)
 S VARX=0
"RTN","BPSOSQ4",210,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),U,1) S VARX=1
"RTN","BPSOSQ4",211,0)
 I VARX S X="^^^^^"  ;LJE
"RTN","BPSOSQ4",212,0)
 E  S X=$G(^BPSEI(INSURER,101))
"RTN","BPSOSQ4",213,0)
 I $P(X,U)<$$NOW D  ; previous retry expired, let's retry:
"RTN","BPSOSQ4",214,0)
 . I '$P(X,U,2) S $P(X,U,2)=600 ; base time = 10 minutes
"RTN","BPSOSQ4",215,0)
 . I '$P(X,U,3) S $P(X,U,3)=3 ; multiplier
"RTN","BPSOSQ4",216,0)
 . I '$P(X,U,4) S $P(X,U,4)=2.5*60*60 ; max wait time ; 2.5 hrs
"RTN","BPSOSQ4",217,0)
 . I '$P(X,U,5) S $P(X,U,5)=$P(X,U,2) ; current wait time (either init
"RTN","BPSOSQ4",218,0)
 . E  S $P(X,U,5)=$P(X,U,5)*$P(X,U,3) ;      or multiply)
"RTN","BPSOSQ4",219,0)
 . S $P(X,U,5)=$P(X,U,5)\1
"RTN","BPSOSQ4",220,0)
 . S:$P(X,U,5)>$P(X,U,4) $P(X,U,5)=$P(X,U,4) ; apply max if needed
"RTN","BPSOSQ4",221,0)
 . S $P(X,U)=$$TADDNOWS^BPSOSUD($P(X,U,5)) ; set retry time
"RTN","BPSOSQ4",222,0)
 . I 'VARX S ^BPSEI(INSURER,101)=X  ;LJE
"RTN","BPSOSQ4",223,0)
 . E  S $P(^BPSF(9002313.92,INSURER,1),U,12)=$P(X,U)
"RTN","BPSOSQ4",224,0)
 . D TASKAT^BPSOSQ1($$TADDNOWS^BPSOSUD($P(X,U,5)+10)) ; BPSOSQ2 will run again upon expiration
"RTN","BPSOSQ4",225,0)
 . D TASK^BPSOSQ1 ; and run it again right away, too, to stamp new times on the others in status 31
"RTN","BPSOSQ4",226,0)
 Q $P(X,U)
"RTN","BPSOSQA")
0^218^B59170198
"RTN","BPSOSQA",1,0)
BPSOSQA ;BHAM ISC/FCS/DRS/DLF - ECME background, Part 1 ;06/02/2004
"RTN","BPSOSQA",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQA",3,0)
 ;External reference private DBIA 4302
"RTN","BPSOSQA",4,0)
 Q
"RTN","BPSOSQA",5,0)
ONE59 ;EP - from BPSOSQ1
"RTN","BPSOSQA",6,0)
 ; Process this one IEN59 (was status 0, now status 10)
"RTN","BPSOSQA",7,0)
 ; MODULO also comes in from BPSOSQ1
"RTN","BPSOSQA",8,0)
 ; MODULO,COUNT,ERROR were NEW'ed in BPSOSQ1
"RTN","BPSOSQA",9,0)
 ;
"RTN","BPSOSQA",10,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1
"RTN","BPSOSQA",11,0)
 S ERROR=0
"RTN","BPSOSQA",12,0)
 N X S X=^BPST(IEN59,1)
"RTN","BPSOSQA",13,0)
 N ABSBRXR,ABSBNDC,ABSBRXI
"RTN","BPSOSQA",14,0)
 S ABSBRXR=$P(X,U),ABSBNDC=$P(X,U,2),ABSBRXI=$P(X,U,11)
"RTN","BPSOSQA",15,0)
 I '$D(^PSRX(ABSBRXI,0)) S ERROR=101 G ERRJOIN
"RTN","BPSOSQA",16,0)
 I ABSBRXR,'$D(^PSRX(ABSBRXI,1,ABSBRXR,0)) S ERROR=102 G ERRJOIN
"RTN","BPSOSQA",17,0)
 D LOG^BPSOSL("Gathering information - program BPSOSQA")
"RTN","BPSOSQA",18,0)
 ;
"RTN","BPSOSQA",19,0)
 I $E(IEN59,$L(IEN59))=1 D  ; if it's a prescription claim,
"RTN","BPSOSQA",20,0)
 . I 'ABSBNDC S ABSBNDC=$$GETNDC^PSONDCUT(ABSBRXI,ABSBRXR)
"RTN","BPSOSQA",21,0)
 S ERROR=$$CLAIMINF^BPSOSQB ; set up lots of info about this claim ;lje;6/16/03
"RTN","BPSOSQA",22,0)
 I ERROR G ERRJOIN
"RTN","BPSOSQA",23,0)
 ; Check for insurance
"RTN","BPSOSQA",24,0)
 I '$D(^BPST(IEN59,10,1,0)) S ERROR=103 D BULL G ERRJOIN
"RTN","BPSOSQA",25,0)
 ;
"RTN","BPSOSQA",26,0)
 ; After setting up the extra info, update the status
"RTN","BPSOSQA",27,0)
 ; Change status to 30 to say "Ready to be put into a trasmit. packet"
"RTN","BPSOSQA",28,0)
 ;
"RTN","BPSOSQA",29,0)
 ; Check if the drug is billable
"RTN","BPSOSQA",30,0)
 ;
"RTN","BPSOSQA",31,0)
 N INSIEN,DRUGIEN,NDCNUM,BILLABLE
"RTN","BPSOSQA",32,0)
 S INSIEN=$P(^BPST(IEN59,1),U,6)
"RTN","BPSOSQA",33,0)
 S DRUGIEN=$P(^PSRX(ABSBRXI,0),U,6)
"RTN","BPSOSQA",34,0)
 S NDCNUM=$P(^BPST(IEN59,1),U,2)
"RTN","BPSOSQA",35,0)
 ;
"RTN","BPSOSQA",36,0)
ERRJOIN I ERROR D
"RTN","BPSOSQA",37,0)
 . D SETSTAT(99)
"RTN","BPSOSQA",38,0)
 . N ERRTEXT
"RTN","BPSOSQA",39,0)
 . I ERROR=12 S ERRTEXT="PCC Link problem during visit lookup"
"RTN","BPSOSQA",40,0)
 . E  I ERROR=13 S ERRTEXT="Patient missing from BPS Transaction"
"RTN","BPSOSQA",41,0)
 . E  I ERROR=14 S ERRTEXT="Unable to determine Outpatient Site"
"RTN","BPSOSQA",42,0)
 . E  I ERROR=15 S ERRTEXT="Unable to link to a BPS Pharmacy"
"RTN","BPSOSQA",43,0)
 . E  I ERROR=101 S ERRTEXT="Missing PSRX("_ABSBRXI_",0)"
"RTN","BPSOSQA",44,0)
 . E  I ERROR=102 S ERRTEXT="Missing PSRX("_ABSBRXI_",1,"_ABSBRXR_",0)"
"RTN","BPSOSQA",45,0)
 . E  I ERROR=103 S ERRTEXT="Missing Insurance in BPST("_IEN59_",10,1,0)"
"RTN","BPSOSQA",46,0)
 . E  S ERRTEXT="ERROR - see LOG"
"RTN","BPSOSQA",47,0)
 . D SETRESU2(ERROR,ERRTEXT)
"RTN","BPSOSQA",48,0)
 . D LOG^BPSOSL($T(+0)_" returned error - "_ERRTEXT)
"RTN","BPSOSQA",49,0)
 . D INCSTAT^BPSOSUD("R",1) ; count how many Unbillable
"RTN","BPSOSQA",50,0)
 E  I '$$BILLABLE D  ; the prescription/fill is marked as Manual bill
"RTN","BPSOSQA",51,0)
 . D SETSTAT(99)
"RTN","BPSOSQA",52,0)
 . D SETRESU2(1,"Prescription is marked for Manual Bill")
"RTN","BPSOSQA",53,0)
 . D INCSTAT^BPSOSUD("R",1) ; count how many Unbillable
"RTN","BPSOSQA",54,0)
 E  S BILLABLE=$$BILLABLE^BPSOSQQ(INSIEN,DRUGIEN,NDCNUM) I 'BILLABLE D
"RTN","BPSOSQA",55,0)
 . D LOG^BPSOSL($P(BILLABLE,U,2))
"RTN","BPSOSQA",56,0)
 . I $$BUMPINS(IEN59) D  ; bump to next insurer
"RTN","BPSOSQA",57,0)
 . . ; loop will pick up this claim again; don't need to task anything
"RTN","BPSOSQA",58,0)
 . E  D  ; no more insurers
"RTN","BPSOSQA",59,0)
 . . D SETRESU2(1,"Unbillable to ins.; "_$$ELGBEN_"; "_$P(BILLABLE,U,2))
"RTN","BPSOSQA",60,0)
 . D INCSTAT^BPSOSUD("R",1) ; count how many Unbillable
"RTN","BPSOSQA",61,0)
 E  I $$PAPER D
"RTN","BPSOSQA",62,0)
 . D SETSTAT(99)
"RTN","BPSOSQA",63,0)
 . N X,Y
"RTN","BPSOSQA",64,0)
 . S X=$P(^BPST(IEN59,1),U,6)
"RTN","BPSOSQA",65,0)
 . S Y=""
"RTN","BPSOSQA",66,0)
 . I Y="SELF PAY"!(Y="") D
"RTN","BPSOSQA",67,0)
 . . S X="No insurance,"_$$ELGBEN
"RTN","BPSOSQA",68,0)
 . E  S X="Paper claim "
"RTN","BPSOSQA",69,0)
 . D SETRESU2(1,X) ; or statement or writeoff, to be det.
"RTN","BPSOSQA",70,0)
 . D LOG^BPSOSL(X)
"RTN","BPSOSQA",71,0)
 . D INCSTAT^BPSOSUD("R",1) ; count how many Unbillable
"RTN","BPSOSQA",72,0)
 E  D  ; it's an electronic claim
"RTN","BPSOSQA",73,0)
 . N STAT S STAT=30 ; new status will be 30 usually, or maybe 99 or 19
"RTN","BPSOSQA",74,0)
 . I $P($G(^BPS(9002313.99,1,"SPECIAL")),U) D
"RTN","BPSOSQA",75,0)
 . . ; The special Oklahoma Medicaid rule is in effect
"RTN","BPSOSQA",76,0)
 . . ; so hold Oklahoma Medicaid prescriptions a little longer
"RTN","BPSOSQA",77,0)
 . . N INS S INS=$P(^BPST(IEN59,7),U)
"RTN","BPSOSQA",78,0)
 . . I INS=$P(^BPS(9002313.99,1,"SPECIAL"),U) S STAT=19
"RTN","BPSOSQA",79,0)
 . D SETSTAT^BPSOSQ1(STAT)
"RTN","BPSOSQA",80,0)
 ;
"RTN","BPSOSQA",81,0)
 ; Every so often, start up a packeter.
"RTN","BPSOSQA",82,0)
 ; We hope that for patients with many prescriptions,
"RTN","BPSOSQA",83,0)
 ; they'll be bundled into single packets.
"RTN","BPSOSQA",84,0)
 ;
"RTN","BPSOSQA",85,0)
 I COUNT#MODULO=0 D PACKETER^BPSOSQ1 ; start one up every Nth claim 
"RTN","BPSOSQA",86,0)
 ;
"RTN","BPSOSQA",87,0)
 Q
"RTN","BPSOSQA",88,0)
ELGBEN() ; construct ELG_","_BEN string ; given IEN59
"RTN","BPSOSQA",89,0)
 N BEN,ELG,Y,I,X
"RTN","BPSOSQA",90,0)
 S X=$P(^BPST(IEN59,0),U,6)
"RTN","BPSOSQA",91,0)
 I X="1^C"!(X="1^D") Q "Native ben."
"RTN","BPSOSQA",92,0)
 S BEN=$P(X,U),ELG=$P(X,U,2)
"RTN","BPSOSQA",93,0)
 Q ELG_","_BEN
"RTN","BPSOSQA",94,0)
BUMPINS(IEN59) ;EP - BPSOSQS
"RTN","BPSOSQA",95,0)
 ; bump up to the next insurer
"RTN","BPSOSQA",96,0)
 ; When you call this, be sure you have the logging slot set to
"RTN","BPSOSQA",97,0)
 ; the current prescription.
"RTN","BPSOSQA",98,0)
 N INSIEN,MSG,PINPIECE,OLDINS ; return value is next insurer
"RTN","BPSOSQA",99,0)
 S PINPIECE=$P(^BPST(IEN59,1),U,8)+1
"RTN","BPSOSQA",100,0)
 I PINPIECE>$L($G(^BPST(IEN59,6)),U) S INSIEN=0
"RTN","BPSOSQA",101,0)
 E  S INSIEN=$P(^BPST(IEN59,7),U,PINPIECE)
"RTN","BPSOSQA",102,0)
 S OLDINS=$P(^BPST(IEN59,1),U,6)
"RTN","BPSOSQA",103,0)
 I 'OLDINS Q 0 ; we were already at the "no insurance" case
"RTN","BPSOSQA",104,0)
 S $P(^BPST(IEN59,1),U,6)=INSIEN
"RTN","BPSOSQA",105,0)
 S $P(^BPST(IEN59,1),U,8)=PINPIECE
"RTN","BPSOSQA",106,0)
 I INSIEN D
"RTN","BPSOSQA",107,0)
 . S MSG="Bump from insurer "_$$INSNAME(OLDINS)_" to "_$$INSNAME(INSIEN)
"RTN","BPSOSQA",108,0)
 . I '$P(^BPST(IEN59,5),U,6) D  ; if price autocalc'd,
"RTN","BPSOSQA",109,0)
 . . K ^BPST(IEN59,5) ; delete old insurer's pricing
"RTN","BPSOSQA",110,0)
 . D SETSTAT^BPSOSQ1(0) ; recompute the claim
"RTN","BPSOSQA",111,0)
 E  D
"RTN","BPSOSQA",112,0)
 . D SETSTAT^BPSOSQ1(99) ; processing has gone as far as it can
"RTN","BPSOSQA",113,0)
 . S MSG="Insurer "_$$INSNAME(OLDINS)_" was the last one."
"RTN","BPSOSQA",114,0)
 D LOG^BPSOSL(MSG)
"RTN","BPSOSQA",115,0)
 Q INSIEN
"RTN","BPSOSQA",116,0)
INSNAME(N)         I 'N Q "(no more insurances)"
"RTN","BPSOSQA",117,0)
 Q 0
"RTN","BPSOSQA",118,0)
BILLABLE()         ; per field 9999999.07 ; only at Pawhuska in the beginning
"RTN","BPSOSQA",119,0)
 N RESULT
"RTN","BPSOSQA",120,0)
 I ABSBRXR S RESULT=$P($G(^PSRX(ABSBRXI,1,ABSBRXR,9999999)),U,7)
"RTN","BPSOSQA",121,0)
 E  S RESULT=$P($G(^PSRX(ABSBRXI,9999999)),U,7)
"RTN","BPSOSQA",122,0)
 I RESULT="" S RESULT=1 ; default to billable
"RTN","BPSOSQA",123,0)
 I 'RESULT D  ; Manual Bill is indicated in prescription file.
"RTN","BPSOSQA",124,0)
 . N X S X=$P(^BPST(IEN59,0),U,14) ; ORIGIN
"RTN","BPSOSQA",125,0)
 . I X=2!(X=3) S RESULT="1^Manual input, okay" Q
"RTN","BPSOSQA",126,0)
 . S RESULT="0^Manual Bill is indicated in prescription file."
"RTN","BPSOSQA",127,0)
 Q RESULT
"RTN","BPSOSQA",128,0)
FLAG23(INS,VAL) ; change field .23 of ^AUTNINS to appropriate value if needed
"RTN","BPSOSQA",129,0)
 ; A recent patch issued by (who? 3PBilling?) has a "P" value they want
"RTN","BPSOSQA",130,0)
 N CUR
"RTN","BPSOSQA",131,0)
 I VAL="P" S VAL="" ; not likely to occur in current system
"RTN","BPSOSQA",132,0)
 I CUR=VAL Q  ; already set the value we want
"RTN","BPSOSQA",133,0)
 I CUR="U" Q  ; currently set to Unbillable for drugs? Can't be.
"RTN","BPSOSQA",134,0)
 N FDA,MSG ; okay, we're going to change it
"RTN","BPSOSQA",135,0)
 S FDA(9999999.18,INS_",",.23)=VAL
"RTN","BPSOSQA",136,0)
F23A D FILE^DIE(,"FDA","MSG")
"RTN","BPSOSQA",137,0)
 Q:'$D(MSG)  ; success
"RTN","BPSOSQA",138,0)
 D ZWRITE^BPSOS("FDA","MSG")
"RTN","BPSOSQA",139,0)
 G F23A:$$IMPOSS^BPSOSUE("FM","TRI","FILE^DIE failed",,"FLAG23",$T(+0))
"RTN","BPSOSQA",140,0)
 Q
"RTN","BPSOSQA",141,0)
PAPER() ; Return TRUE if this has to be sent as a paper claim.
"RTN","BPSOSQA",142,0)
 ; Also take care of the ^AUTNINS field .23 flag "P" value
"RTN","BPSOSQA",143,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) Q 0    ;LJE;6/25/03
"RTN","BPSOSQA",144,0)
 N INSURER,FORMAT,ACTDATE,FLAG23
"RTN","BPSOSQA",145,0)
 S INSURER=+$P($G(^BPST(IEN59,1)),U,6)
"RTN","BPSOSQA",146,0)
 I INSURER D
"RTN","BPSOSQA",147,0)
 . S FORMAT=$P($G(^BPSEI(INSURER,100)),U)
"RTN","BPSOSQA",148,0)
 . S ACTDATE=$P($G(^BPSEI(INSURER,100)),U,3)
"RTN","BPSOSQA",149,0)
 E  S (FORMAT,ACTDATE,FLAG23)=""
"RTN","BPSOSQA",150,0)
 I FORMAT,ACTDATE'>DT D  ; yes, this insurer is billed electronically
"RTN","BPSOSQA",151,0)
 . D FLAG23(INSURER,"P")
"RTN","BPSOSQA",152,0)
 E  D
"RTN","BPSOSQA",153,0)
 . Q:'INSURER  ; uninsured
"RTN","BPSOSQA",154,0)
 . D FLAG23(INSURER,"")
"RTN","BPSOSQA",155,0)
 I 'FORMAT Q 1 ; not an electronic insurer
"RTN","BPSOSQA",156,0)
 I ACTDATE>DT Q 1 ; not activated until some future date
"RTN","BPSOSQA",157,0)
 ; Looks like it's electronic but 
"RTN","BPSOSQA",158,0)
 ; test some more (maybe electronic for presc. but paper for postage)
"RTN","BPSOSQA",159,0)
 G @("PAPER"_$$TYPE^BPSOSQ)
"RTN","BPSOSQA",160,0)
PAPER1 ; prescription
"RTN","BPSOSQA",161,0)
 N P S P=$P(^BPST(IEN59,5),U,5) ; price
"RTN","BPSOSQA",162,0)
 I P>0,P<10000 Q 0  ; make sure positive, and < $10000 (6 digits limit)
"RTN","BPSOSQA",163,0)
 Q 1  ; otherwise, must go via paper
"RTN","BPSOSQA",164,0)
PAPER2 ; postage - depends on insurer and amount
"RTN","BPSOSQA",165,0)
 N X S X=$G(^BPSEI(INSURER,102))
"RTN","BPSOSQA",166,0)
 I X="" Q 1  ; doesn't handle postage, must send by paper
"RTN","BPSOSQA",167,0)
 I '$$RXI^BPSOSQ,'$P(X,U,3) Q 1  ; supplies postage not allowed in POS
"RTN","BPSOSQA",168,0)
 N AMT S AMT=$$AMT^BPSOSQ
"RTN","BPSOSQA",169,0)
 I $P(X,U,2)]"",AMT>$P(X,U,2) Q 1  ; exceeds maximum postage amount
"RTN","BPSOSQA",170,0)
 Q 0  ; meets requirements for ECME billing
"RTN","BPSOSQA",171,0)
PAPER3 ;
"RTN","BPSOSQA",172,0)
 N X S X=$G(^BPSEI(INSURER,103))
"RTN","BPSOSQA",173,0)
 I X="" Q 1  ; doesn't handle supplies, must send by paper
"RTN","BPSOSQA",174,0)
 Q 0  ; does handle supplies (as of 06/21/2000, we know of none that do)
"RTN","BPSOSQA",175,0)
SETSTAT(X)         D SETSTAT^BPSOSQ1(X) Q
"RTN","BPSOSQA",176,0)
SETRESU(RESCODE)   ;
"RTN","BPSOSQA",177,0)
 N ABSBRXI S ABSBRXI=IEN59 ; unfortunate variable name convention
"RTN","BPSOSQA",178,0)
 D SETRESU^BPSOSU(RESCODE) ;
"RTN","BPSOSQA",179,0)
 Q
"RTN","BPSOSQA",180,0)
SETRESU2(RESCODE,RESTEXT)    ;
"RTN","BPSOSQA",181,0)
 N ABSBRXI S ABSBRXI=IEN59 ; unfortunate variable name convention
"RTN","BPSOSQA",182,0)
 D SETRESU^BPSOSU(RESCODE,RESTEXT)
"RTN","BPSOSQA",183,0)
 Q
"RTN","BPSOSQA",184,0)
BULL ;Bulletin to the OPECC
"RTN","BPSOSQA",185,0)
 N XMSUB,XMY,XMTEXT,XMDUZ,BLNUM,TXT,TRXI
"RTN","BPSOSQA",186,0)
 ;
"RTN","BPSOSQA",187,0)
 S BLNUM=0
"RTN","BPSOSQA",188,0)
 S TRXI=$P(ABSBRXI,".")
"RTN","BPSOSQA",189,0)
 S XMSUB="ECME INSURANCE MISSING"
"RTN","BPSOSQA",190,0)
 S TXT="The insurance information is missing for prescription: "_$P(^PSRX(TRXI,0),"^",1)
"RTN","BPSOSQA",191,0)
 D T(TXT)
"RTN","BPSOSQA",192,0)
 D T()
"RTN","BPSOSQA",193,0)
 ;
"RTN","BPSOSQA",194,0)
 S XMDUZ="BPS PACKAGE",XMTEXT="BTX("
"RTN","BPSOSQA",195,0)
 S XMY("G.BPS OPECC")=""
"RTN","BPSOSQA",196,0)
 I $G(DUZ)'<1 S XMY(DUZ)=""
"RTN","BPSOSQA",197,0)
 D ^XMD
"RTN","BPSOSQA",198,0)
 Q
"RTN","BPSOSQA",199,0)
T(BTXT) ; Add text to the message
"RTN","BPSOSQA",200,0)
 ;PUBLIC BLNUM,BTEST
"RTN","BPSOSQA",201,0)
 S BLNUM=BLNUM+1,BTX(BLNUM)=$G(BTXT," ")
"RTN","BPSOSQA",202,0)
 I $G(BTEST) W !,$G(BTXT)
"RTN","BPSOSQA",203,0)
 Q
"RTN","BPSOSQB")
0^219^B46182613
"RTN","BPSOSQB",1,0)
BPSOSQB ;BHAM ISC/FCS/DRS/DLF - ECME background, Part 1 ;06/01/2004
"RTN","BPSOSQB",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQB",3,0)
 ;External reference private DBIA 4303
"RTN","BPSOSQB",4,0)
 ;
"RTN","BPSOSQB",5,0)
 ;IHS/DSD/lwj 10/09/01 on behalf of David Slauenwhite - change
"RTN","BPSOSQB",6,0)
 ; consist of one line be altered in the "C" subroutine.
"RTN","BPSOSQB",7,0)
 ; David reported:
"RTN","BPSOSQB",8,0)
 ;   I think that what happens is that CLEAR59^BPSOSIZ always
"RTN","BPSOSQB",9,0)
 ;   cleans out the 9002313.59 transaction-in-progress entry so
"RTN","BPSOSQB",10,0)
 ;   that C+3 always gets null for both these fields.  The
"RTN","BPSOSQB",11,0)
 ;   GETDIV^BPSOSQC computes them anew, and then C+7:C+8
"RTN","BPSOSQB",12,0)
 ;   stores the computed values in the correct locations so that in
"RTN","BPSOSQB",13,0)
 ;   D+3, GETPHARM^BPSOSQC will find the correct pharmacy.
"RTN","BPSOSQB",14,0)
 ;
"RTN","BPSOSQB",15,0)
 ;IHS/SD/lwj 08/20/01  NCPDP 5.1 changes
"RTN","BPSOSQB",16,0)
 ; New field added to point to the new DUR/PPS values file.  The
"RTN","BPSOSQB",17,0)
 ; pointer will reside in the Outpatient Pharmacy V6.0 file following
"RTN","BPSOSQB",18,0)
 ; the release of Patch 4.  For now, we are just setting up the code
"RTN","BPSOSQB",19,0)
 ; in anticipation of the field.  (PCS will require the DUR/PPS
"RTN","BPSOSQB",20,0)
 ; claim segment as part of their format.)
"RTN","BPSOSQB",21,0)
 ; Since the logic is similar to the Override field -I will add this
"RTN","BPSOSQB",22,0)
 ; new field retrieval to the same place in the code.
"RTN","BPSOSQB",23,0)
 ;
"RTN","BPSOSQB",24,0)
 Q
"RTN","BPSOSQB",25,0)
CLAIMINF() ;EP - from BPSOSQA
"RTN","BPSOSQB",26,0)
 ; Send in ABSBRXI, ABSBRXR, ABSBNDC, IEN59
"RTN","BPSOSQB",27,0)
 ; Fill in as much other information as possible,
"RTN","BPSOSQB",28,0)
 ; Every 9002313.59 field must be accounted for in here!
"RTN","BPSOSQB",29,0)
 ;  Even if only to say "not filled in", or to explicitly delete field.
"RTN","BPSOSQB",30,0)
 ;
"RTN","BPSOSQB",31,0)
 N FN S FN=9002313.59
"RTN","BPSOSQB",32,0)
 N FDA,IEN,MSG
"RTN","BPSOSQB",33,0)
 N IEN59COM S IEN59COM=IEN59_","
"RTN","BPSOSQB",34,0)
 ;
"RTN","BPSOSQB",35,0)
 ; Now fill in missing information.
"RTN","BPSOSQB",36,0)
 ; Set up FDA(FN,IEN59_",",FIELD)=internal value
"RTN","BPSOSQB",37,0)
 ;
"RTN","BPSOSQB",38,0)
 ; ***
"RTN","BPSOSQB",39,0)
 ; ***  Fields in the ^(0) node
"RTN","BPSOSQB",40,0)
 ; ***
"RTN","BPSOSQB",41,0)
 ; .01 ENTRY#  already done
"RTN","BPSOSQB",42,0)
 ; .13 TYPE    already done  ; use $$TYPE^BPSOSQ to infer it from IEN59 in here
"RTN","BPSOSQB",43,0)
 ; 1   STATUS  already done
"RTN","BPSOSQB",44,0)
 ; 2   PCN     not yet
"RTN","BPSOSQB",45,0)
 ; 3   CLAIM   not yet
"RTN","BPSOSQB",46,0)
 ; 4   RESPONSE  not yet
"RTN","BPSOSQB",47,0)
 ;
"RTN","BPSOSQB",48,0)
 ; 12  VISIT        -  set up ABSBVISI
"RTN","BPSOSQB",49,0)
 ;
"RTN","BPSOSQB",50,0)
A S ABSBVISI=$P(^BPST(IEN59,0),U,7)
"RTN","BPSOSQB",51,0)
 ;
"RTN","BPSOSQB",52,0)
 ;----- LJE;6/16/03 Added next section to skip visit handling for VA and added B1 line label.
"RTN","BPSOSQB",53,0)
 I $P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1)=0 D  G B
"RTN","BPSOSQB",54,0)
 . S LINKSRC="#"_$S(ABSBRXR:ABSBRXR,1:0)
"RTN","BPSOSQB",55,0)
 ;
"RTN","BPSOSQB",56,0)
 I 'ABSBVISI D  ; need to lookup visit
"RTN","BPSOSQB",57,0)
 . I $$TYPE^BPSOSQ=3 D  ; if supply item, we found visit from ^PSRX
"RTN","BPSOSQB",58,0)
 . . D IMPOSS^BPSOSUE("DB,P","TI","Supply item must have visit by now.",IEN59,"A",$T(+0))
"RTN","BPSOSQB",59,0)
 . D VISIT^BPSOSQC
"RTN","BPSOSQB",60,0)
 . S FDA(FN,IEN59COM,12)=ABSBVISI
"RTN","BPSOSQB",61,0)
 I 'ABSBVISI Q 12 ; result code 12 - visit lookup failed
"RTN","BPSOSQB",62,0)
 ;
"RTN","BPSOSQB",63,0)
 ; Make sure there's a VCN number assigned to this visit
"RTN","BPSOSQB",64,0)
 ;
"RTN","BPSOSQB",65,0)
A1 I $$MAKEVCN^BPSOSQ D SETVCN^BPSOSQD
"RTN","BPSOSQB",66,0)
 ;
"RTN","BPSOSQB",67,0)
 ; 5   PATIENT      -  set up ABSBPATI
"RTN","BPSOSQB",68,0)
 ;
"RTN","BPSOSQB",69,0)
B S ABSBPATI=$P(^BPST(IEN59,0),U,6)
"RTN","BPSOSQB",70,0)
 I 'ABSBPATI Q 13
"RTN","BPSOSQB",71,0)
 ;
"RTN","BPSOSQB",72,0)
 ; 7   LAST UPDATE  not here
"RTN","BPSOSQB",73,0)
 ; 14  POSITION IN CLAIM  not here
"RTN","BPSOSQB",74,0)
 ; 13  USER    already done
"RTN","BPSOSQB",75,0)
 ; 15  START TIME  already done
"RTN","BPSOSQB",76,0)
 ; 16  COMMS LOG    not yet
"RTN","BPSOSQB",77,0)
 ;
"RTN","BPSOSQB",78,0)
 ; ***
"RTN","BPSOSQB",79,0)
 ; ***  Fields in the ^(1) node
"RTN","BPSOSQB",80,0)
 ; ***
"RTN","BPSOSQB",81,0)
 ; 9   ABSBRXR  already done
"RTN","BPSOSQB",82,0)
 ; 10  ABSBNDC
"RTN","BPSOSQB",83,0)
B1 ;
"RTN","BPSOSQB",84,0)
 S FDA(FN,IEN59COM,10)=ABSBNDC ; usually already there
"RTN","BPSOSQB",85,0)
 ;
"RTN","BPSOSQB",86,0)
 ; 8   VCPT  - at the very end, in a separate billing job,
"RTN","BPSOSQB",87,0)
 ;     in the billing programs, BPSOSB*
"RTN","BPSOSQB",88,0)
 ;
"RTN","BPSOSQB",89,0)
 ; 11  ABSBDIV           -  ABSBPDIV, pointer to ^PS(59,ABSBPDIV,*)
"RTN","BPSOSQB",90,0)
 ; 1.05 ABSBDIV SOURCE   -  ABSBSDIV, source = 1
"RTN","BPSOSQB",91,0)
 ;
"RTN","BPSOSQB",92,0)
C S ABSBPDIV=$P(^BPST(IEN59,1),U,4)
"RTN","BPSOSQB",93,0)
 I ABSBPDIV D
"RTN","BPSOSQB",94,0)
 . N X S X=^BPST(IEN59,1)
"RTN","BPSOSQB",95,0)
 . S ABSBPDIV=$P(X,U,4),ABSBSDIV=$P(X,U,5)   ;IHS/DSD/lwj 10/09/01
"RTN","BPSOSQB",96,0)
 ; end of 10/09/01 changes
"RTN","BPSOSQB",97,0)
 I 'ABSBPDIV D
"RTN","BPSOSQB",98,0)
 . D GETDIV^BPSOSQC ; needs ABSBRXI,ABSBRXR
"RTN","BPSOSQB",99,0)
 . I $$TYPE^BPSOSQ=1!($$TYPE^BPSOSQ=2) D  ; prescription or postage
"RTN","BPSOSQB",100,0)
 . . S FDA(FN,IEN59COM,11)=ABSBPDIV
"RTN","BPSOSQB",101,0)
 . . S FDA(FN,IEN59COM,1.05)=ABSBSDIV
"RTN","BPSOSQB",102,0)
 I 'ABSBPDIV Q 14
"RTN","BPSOSQB",103,0)
 ;
"RTN","BPSOSQB",104,0)
 ; 1.07 PHARMACY  (depends on ABSBSDIV,ABSBPDIV)
"RTN","BPSOSQB",105,0)
 ;
"RTN","BPSOSQB",106,0)
D S BPSHARM=$P(^BPST(IEN59,1),U,7)
"RTN","BPSOSQB",107,0)
 I 'BPSHARM D
"RTN","BPSOSQB",108,0)
 . D GETPHARM^BPSOSQC
"RTN","BPSOSQB",109,0)
 . S FDA(FN,IEN59COM,1.07)=BPSHARM
"RTN","BPSOSQB",110,0)
 I BPSHARM=0 Q 15
"RTN","BPSOSQB",111,0)
 ;
"RTN","BPSOSQB",112,0)
 ; 1.06 INSURER - see ^(6) and ^(7), below
"RTN","BPSOSQB",113,0)
 ; 1.08 PINS PIECE - see ^(6) and ^(7), below
"RTN","BPSOSQB",114,0)
 ;
"RTN","BPSOSQB",115,0)
 ; 1.09 PREAUTHORIZATION NUMBER
"RTN","BPSOSQB",116,0)
 ;  May someday need to do an extra lookup here.
"RTN","BPSOSQB",117,0)
 ;  Thinking of Puyallup, where an extensive preauthorization number
"RTN","BPSOSQB",118,0)
 ;  database scheme has been set up in the past.
"RTN","BPSOSQB",119,0)
 ;  (And more typically, may be handled by the NCPDP OVERRIDE
"RTN","BPSOSQB",120,0)
 ;
"RTN","BPSOSQB",121,0)
 ; 1.11 ABSBRXI  already done
"RTN","BPSOSQB",122,0)
 ;
"RTN","BPSOSQB",123,0)
 ; 1.12 RESUBMIT AFTER REVERSAL
"RTN","BPSOSQB",124,0)
 ;   How's that work again?  It was set by the caller, right?
"RTN","BPSOSQB",125,0)
 ;
"RTN","BPSOSQB",126,0)
 ; 1.13 NCPDP OVERRIDES
"RTN","BPSOSQB",127,0)
 I $$TYPE^BPSOSQ=1!($$TYPE^BPSOSQ=2) D
"RTN","BPSOSQB",128,0)
 . N X S X=$$GETIEN^BPSOSO($$RXI^BPSOSQ,$$RXR^BPSOSQ)
"RTN","BPSOSQB",129,0)
 . I X S FDA(FN,IEN59COM,1.13)=X
"RTN","BPSOSQB",130,0)
 . ;
"RTN","BPSOSQB",131,0)
 . ;IHS/SD/lwj 8/20/02 NCPDP 5.1 changes - add the retrieval of the
"RTN","BPSOSQB",132,0)
 . ; DUR/PPS pointer from the prescription file
"RTN","BPSOSQB",133,0)
 . N DUR S DUR=$$GETDUR^BPSOSO($$RXI^BPSOSQ,$$RXR^BPSOSQ)
"RTN","BPSOSQB",134,0)
 . I DUR S FDA(FN,IEN59COM,1.14)=DUR
"RTN","BPSOSQB",135,0)
 ;
"RTN","BPSOSQB",136,0)
 ; ***
"RTN","BPSOSQB",137,0)
 ; ***   Fields in the ^(2) node - RESULT CODE, RESULT TEXT - not here
"RTN","BPSOSQB",138,0)
 ; ***   In the ^(3) node - CANCELLATION REQUESTED - not here
"RTN","BPSOSQB",139,0)
 ; ***   In the ^(4) node - REVERSAL CLAIM, REVERSAL RESPONSE - not here
"RTN","BPSOSQB",140,0)
 ; ***
"RTN","BPSOSQB",141,0)
 ;
"RTN","BPSOSQB",142,0)
 ; ***
"RTN","BPSOSQB",143,0)
 ; ***   INSURANCE data
"RTN","BPSOSQB",144,0)
 ; ***   Fields 1.06 INSURER and 1.08 PINS PIECE
"RTN","BPSOSQB",145,0)
 ; ***   And the ^(6) and ^(7) nodes
"RTN","BPSOSQB",146,0)
 ; ***
"RTN","BPSOSQB",147,0)
 ;
"RTN","BPSOSQB",148,0)
 ; SET VA PATIENT INSURANCE ;lje;6/21/03
"RTN","BPSOSQB",149,0)
 ; Insurance info passed by IB and must store.
"RTN","BPSOSQB",150,0)
 ; VA currently not using IHS insurance programs; so skipping them.
"RTN","BPSOSQB",151,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) G VASKIP ;LJE;6/21/03
"RTN","BPSOSQB",152,0)
 ;
"RTN","BPSOSQB",153,0)
 S INSURER=$P(^BPST(IEN59,1),U,6)
"RTN","BPSOSQB",154,0)
 I INSURER D  ; whoever set up this entry included insurance data
"RTN","BPSOSQB",155,0)
 . ; nothing more to do right now
"RTN","BPSOSQB",156,0)
 E  D  ; insurance data not set up; establish defaults here and now
"RTN","BPSOSQB",157,0)
 . N INSARRAY
"RTN","BPSOSQB",158,0)
 . I $$TYPE^BPSOSQ=2 D  ; postage: try to take same insur. as prescrip
"RTN","BPSOSQB",159,0)
 . . N N57 S N57=$$N57LAST^BPSOSQ() Q:'N57  ; last transaction
"RTN","BPSOSQB",160,0)
 . . N TMP M TMP=^BPSTL(N57) Q:'$D(TMP(6))
"RTN","BPSOSQB",161,0)
 . . S INSARRAY(0)=$L(TMP(6),U)
"RTN","BPSOSQB",162,0)
 . . N I F I=1:1:$L(TMP(6),U) D
"RTN","BPSOSQB",163,0)
 . . . S INSARRAY(I)=$P(TMP(7),U,I)_U_$P(TMP(6),U,I)
"RTN","BPSOSQB",164,0)
 . I '$D(INSARRAY)  D
"RTN","BPSOSQB",165,0)
 . .N RETVAL S RETVAL=$$INSURER^BPSOS25(.INSARRAY)
"RTN","BPSOSQB",166,0)
 . ; INSARRAY(0)=count^other junk...
"RTN","BPSOSQB",167,0)
 . ; INSARRAY(n)=insurer^pins
"RTN","BPSOSQB",168,0)
 . N I F I=1:1:$P(INSARRAY(0),U) D
"RTN","BPSOSQB",169,0)
 . . I I>3 Q
"RTN","BPSOSQB",170,0)
 . . S FDA(FN,IEN59COM,I+700)=$P(INSARRAY(I),U)
"RTN","BPSOSQB",171,0)
 . . S FDA(FN,IEN59COM,I+600)=$P(INSARRAY(I),U,2)
"RTN","BPSOSQB",172,0)
 . . I I=1 D
"RTN","BPSOSQB",173,0)
 . . . S (INSURER,FDA(FN,IEN59COM,1.06))=$P(INSARRAY(I),U)
"RTN","BPSOSQB",174,0)
 . . . S FDA(FN,IEN59COM,1.08)=1
"RTN","BPSOSQB",175,0)
 ;
"RTN","BPSOSQB",176,0)
 ; ***
"RTN","BPSOSQB",177,0)
 ; ***   PRICING data - in the ^(5) node
"RTN","BPSOSQB",178,0)
 ; ***
"RTN","BPSOSQB",179,0)
 ;
"RTN","BPSOSQB",180,0)
P N PRICING S PRICING=$G(^BPST(IEN59,5))
"RTN","BPSOSQB",181,0)
 I $P(PRICING,U,5)]"" D
"RTN","BPSOSQB",182,0)
 . ; do nothing; pricing is already determined
"RTN","BPSOSQB",183,0)
 E  D  ; need to figure out pricing
"RTN","BPSOSQB",184,0)
 . I $$TYPE^BPSOSQ=2 D
"RTN","BPSOSQB",185,0)
 . . D IMPOSS^BPSOSUE("DB,P","TI","Pricing of postage must already be in place by now.",IEN59,"P:2",$T(+0))
"RTN","BPSOSQB",186,0)
 . E  I $$TYPE^BPSOSQ=3 D
"RTN","BPSOSQB",187,0)
 . . D IMPOSS^BPSOSUE("DB,P","TI","Pricing of supplies must already be in place by now.",IEN59,"P:3",$T(+0))
"RTN","BPSOSQB",188,0)
 . E  I $$TYPE^BPSOSQ=1 D  ; Drug pricing:
"RTN","BPSOSQB",189,0)
 . . N DRGDFN,DRGNAME,PROVDFN,PROV,PRICALC
"RTN","BPSOSQB",190,0)
 . . N ABSBRXI,ABSBRXR,ABSBNDC,ABSBDRGI
"RTN","BPSOSQB",191,0)
 . . S ABSBRXI=$$RXI^BPSOSQ,ABSBRXR=$$RXR^BPSOSQ,ABSBNDC=$$NDC^BPSOSQ
"RTN","BPSOSQB",192,0)
 . . S ABSBDRGI=$$DRGDFN^BPSOSQ ; INSURER was set above
"RTN","BPSOSQB",193,0)
 . . D EN^BPSOSQP ; and PRICING is set for you
"RTN","BPSOSQB",194,0)
 . N I F I=1:1:5 S FDA(FN,IEN59COM,I+500)=$P(PRICING,U,I)
"RTN","BPSOSQB",195,0)
 ;
"RTN","BPSOSQB",196,0)
VASKIP ;
"RTN","BPSOSQB",197,0)
 ; The 9002313.59 entry has all the data it should have at this point.
"RTN","BPSOSQB",198,0)
 ; Store whatever data were just determined in this routine.
"RTN","BPSOSQB",199,0)
 ;
"RTN","BPSOSQB",200,0)
FILE1 I $D(FDA) D
"RTN","BPSOSQB",201,0)
 . D FILE^DIE("","FDA","MSG")
"RTN","BPSOSQB",202,0)
 ;
"RTN","BPSOSQB",203,0)
 I $D(MSG) D  G FILE99
"RTN","BPSOSQB",204,0)
 . D LOG^BPSOSL("Error in D FILE^DIE at tag FILE1^"_$T(+0))
"RTN","BPSOSQB",205,0)
 . D LOGMSG ; failure - log returned diagnostics
"RTN","BPSOSQB",206,0)
 ;
"RTN","BPSOSQB",207,0)
FILE99 D LOG59 ; log a copy of what's in the IEN59 now
"RTN","BPSOSQB",208,0)
 Q $S($D(MSG):1000,1:0) ; >0 if error, =0 if no error
"RTN","BPSOSQB",209,0)
 ;
"RTN","BPSOSQB",210,0)
LOGMSG D LOG^BPSOSL("Error returned by FILE^DIE")
"RTN","BPSOSQB",211,0)
 D LOGARRAY("MSG") Q  ; log the MSG array
"RTN","BPSOSQB",212,0)
LOGARRAY(Q) ;EP - BPSOSQD
"RTN","BPSOSQB",213,0)
 I $D(@Q)#10 D LOG^BPSOSL(Q_"="_@Q)
"RTN","BPSOSQB",214,0)
 F  S Q=$Q(@Q) Q:Q=""  D LOG^BPSOSL(Q_"="_@Q)
"RTN","BPSOSQB",215,0)
 Q
"RTN","BPSOSQB",216,0)
LOG59 ; log the IEN59 entry
"RTN","BPSOSQB",217,0)
 N A M A=^BPST(IEN59)
"RTN","BPSOSQB",218,0)
 D LOG^BPSOSL("Contents of ^BPST("_IEN59_") :")
"RTN","BPSOSQB",219,0)
 D LOGARRAY("A")
"RTN","BPSOSQB",220,0)
 Q
"RTN","BPSOSQB",221,0)
LOG59A ;EP - from REVERS59^BPSOS6D
"RTN","BPSOSQB",222,0)
 N SAVESLOT S SAVESLOT=$$GETSLOT^BPSOSL
"RTN","BPSOSQB",223,0)
 D SETSLOT^BPSOSL(IEN59)
"RTN","BPSOSQB",224,0)
 D LOG59
"RTN","BPSOSQB",225,0)
 D RELSLOT^BPSOSL
"RTN","BPSOSQB",226,0)
 D SETSLOT^BPSOSL(SAVESLOT)
"RTN","BPSOSQB",227,0)
 Q
"RTN","BPSOSQC")
0^220^B5188299
"RTN","BPSOSQC",1,0)
BPSOSQC ;BHAM ISC/FCS/DRS/FLS - ECME background, Part 1 ;06/01/2004
"RTN","BPSOSQC",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQC",3,0)
 ;External reference private DBIA 4303
"RTN","BPSOSQC",4,0)
 Q
"RTN","BPSOSQC",5,0)
 ;  GETPHARM, GETDIV, VISIT subroutines
"RTN","BPSOSQC",6,0)
 ;
"RTN","BPSOSQC",7,0)
GETPHARM ;EP -  given ABSBPDIV, ABSBSDIV, ABSBRXI, ABSBRXR
"RTN","BPSOSQC",8,0)
 S BPSHARM=0 ; want to set this value
"RTN","BPSOSQC",9,0)
 N SUB S SUB=$P("OPSITE^",U,ABSBSDIV) Q:SUB=""  ; which list to check
"RTN","BPSOSQC",10,0)
 N X S X=0 F  S X=$O(^BPS(9002313.56,X)) Q:'X  D  Q:BPSHARM
"RTN","BPSOSQC",11,0)
 . Q:'$D(^BPS(9002313.56,X,SUB,"B",ABSBPDIV))
"RTN","BPSOSQC",12,0)
 . N Y S Y=$O(^BPS(9002313.56,X,SUB,"B",ABSBPDIV,0))
"RTN","BPSOSQC",13,0)
 . S BPSHARM=X
"RTN","BPSOSQC",14,0)
 Q
"RTN","BPSOSQC",15,0)
GETDIV ;EP - Var setup: Given ABSBRXI, ABSBRXR, Set ABSBPDIV, ABSBSDIV
"RTN","BPSOSQC",16,0)
 S (ABSBSDIV,ABSBPDIV)=0 N X1,X
"RTN","BPSOSQC",17,0)
 I ABSBRXR D  ; if refill, get the (PRESCRIPTION,REFILL DATE,DIVISION)
"RTN","BPSOSQC",18,0)
 . S X=$P($G(^PSRX(ABSBRXI,1,ABSBRXR,0)),U,9)
"RTN","BPSOSQC",19,0)
 E  I ABSBRXI D  ; if not refill, get the (PRESCRIPTION,DIVISION)
"RTN","BPSOSQC",20,0)
 . S X=$P($G(^PSRX(ABSBRXI,2)),U,9)
"RTN","BPSOSQC",21,0)
 E  Q  ; must be a supply item - no prescription file entry
"RTN","BPSOSQC",22,0)
 ;       for supply item, leave division as 0, it's okay
"RTN","BPSOSQC",23,0)
 S ABSBPDIV=X ;$P($G(^PS(59,ABSBPDIV,0)),U,6) points to institution
"RTN","BPSOSQC",24,0)
 S ABSBSDIV=1 ; file 59 is where this points
"RTN","BPSOSQC",25,0)
 ;   $P(^PS(59,ABSBPDIV,"INI"),U) points to related institution
"RTN","BPSOSQC",26,0)
 I 'ABSBPDIV D  Q
"RTN","BPSOSQC",27,0)
 .D LOG^BPSOSL("DIVISION - Incorrect or missing for "_ABSBRXI_","_ABSBRXR) Q
"RTN","BPSOSQC",28,0)
 ; and a lot of early ANMC complexity deleted
"RTN","BPSOSQC",29,0)
 Q
"RTN","BPSOSQC",30,0)
VISIT ;EP -  Var setup:  pointers ^AUPNVSIT(ABSBVISI and ^AUPNVMED(VMEDDFN
"RTN","BPSOSQC",31,0)
 ; We assume that the visit is already created,
"RTN","BPSOSQC",32,0)
 ; we assume that the prescription is already entered,
"RTN","BPSOSQC",33,0)
 ; we assume that the PCC link is already created.
"RTN","BPSOSQC",34,0)
 ; Isn't VMEDDFN required for us?  Or is the prescription # good enough?
"RTN","BPSOSQC",35,0)
 ;  (have to look at claim assembly code to know for sure)
"RTN","BPSOSQC",36,0)
 ; ANMC tally as of 03/10/2000 5:15PM EST:
"RTN","BPSOSQC",37,0)
 ;   4675 found via PCC link;  0 found by date@12;  2 visits created
"RTN","BPSOSQC",38,0)
 ; So we don't really need or want all that extra baggage, do we?
"RTN","BPSOSQC",39,0)
 S ABSBVISI="",VMEDDFN=""
"RTN","BPSOSQC",40,0)
 N X
"RTN","BPSOSQC",41,0)
VIS1 ;get PCC link for last refill, if any; otherwise for first fill
"RTN","BPSOSQC",42,0)
 N LINKSRC,PCCLINK,RESULT
"RTN","BPSOSQC",43,0)
 ; Start by getting the appropriate PCC link
"RTN","BPSOSQC",44,0)
 I ABSBRXR D
"RTN","BPSOSQC",45,0)
 . S PCCLINK=$P($G(^PSRX(ABSBRXI,1,ABSBRXR,999999911)),U) ;refill
"RTN","BPSOSQC",46,0)
 . S LINKSRC="#"_ABSBRXR
"RTN","BPSOSQC",47,0)
 E  D
"RTN","BPSOSQC",48,0)
 . S PCCLINK=$P($G(^PSRX(ABSBRXI,999999911)),U) ;first fill
"RTN","BPSOSQC",49,0)
 . S LINKSRC="#0"
"RTN","BPSOSQC",50,0)
 S RESULT="VISIT - PCC LINK "_LINKSRC_"->"
"RTN","BPSOSQC",51,0)
VIS2 I PCCLINK D  ; yes, a PCC link was found
"RTN","BPSOSQC",52,0)
 .S VMEDDFN=PCCLINK ; remember IEN into V MEDICATION
"RTN","BPSOSQC",53,0)
 I 'ABSBVISI S RESULT=RESULT_":FAILURE"
"RTN","BPSOSQC",54,0)
 D LOG^BPSOSL(RESULT)
"RTN","BPSOSQC",55,0)
 D INCSTAT^BPSOSUD("V",$S(ABSBVISI:1,1:2)) ; 1 success, 2 failure
"RTN","BPSOSQC",56,0)
 Q
"RTN","BPSOSQC",57,0)
 ; - - - - - - - - - - - - -
"RTN","BPSOSQD")
0^221^B80660
"RTN","BPSOSQD",1,0)
BPSOSQD ;BHAM ISC/FCS/DRS/FLS - ECME background Part 1 ;06/01/2004
"RTN","BPSOSQD",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQD",3,0)
 Q
"RTN","BPSOSQD",4,0)
 ;
"RTN","BPSOSQD",5,0)
SETVCN ;EP - from BPSOSQD ; APCDVCN = lookup / assign VCN
"RTN","BPSOSQD",6,0)
 N ASSIGNED ; was it assigned here?
"RTN","BPSOSQD",7,0)
 Q
"RTN","BPSOSQF")
0^222^B8424579
"RTN","BPSOSQF",1,0)
BPSOSQF ;BHAM ISC/FCS/DRS/FLS - Insurer asleep - status 31 ;06/01/2004
"RTN","BPSOSQF",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQF",3,0)
 Q
"RTN","BPSOSQF",4,0)
 ;
"RTN","BPSOSQF",5,0)
 ; Continuation of BPSOSQ2
"RTN","BPSOSQF",6,0)
 ;
"RTN","BPSOSQF",7,0)
STATUS31 ;EP - BPSOSQ2
"RTN","BPSOSQF",8,0)
 ; Situation:  you have 1 or 2 or maybe 200 claims in status 31,
"RTN","BPSOSQF",9,0)
 ; because we've determined that the insurer is asleep.
"RTN","BPSOSQF",10,0)
 ; change at most one claim per insurer to status 30, to let it
"RTN","BPSOSQF",11,0)
 ; go through and try again.  But if the insurer is awake for sure,
"RTN","BPSOSQF",12,0)
 ; let all of the claims for that insurer go on through.
"RTN","BPSOSQF",13,0)
 N VARX,T,PROBER
"RTN","BPSOSQF",14,0)
 S VARX=0
"RTN","BPSOSQF",15,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1
"RTN","BPSOSQF",16,0)
 N STATUS30,IEN59,INSURER S STATUS30=31,IEN59=""
"RTN","BPSOSQF",17,0)
 K ^TMP("BPSOSQF",$J) ; build ^TMP("BPSOSQF",$J,INSURER,IEN59)=""
"RTN","BPSOSQF",18,0)
 Q:'$$LOCK59^BPSOSQ2
"RTN","BPSOSQF",19,0)
 F  S IEN59=$$NEXT59^BPSOSQ2(IEN59) Q:'IEN59  D
"RTN","BPSOSQF",20,0)
 . ; if $$NEXT59() returned us an IEN59, then the waiting time
"RTN","BPSOSQF",21,0)
 . ; has expired - or better yet, the insurer has awakened
"RTN","BPSOSQF",22,0)
 . S T="",PROBER=""
"RTN","BPSOSQF",23,0)
 . I 'VARX D
"RTN","BPSOSQF",24,0)
 . . S INSURER=$P(^BPST(IEN59,1),U,6)
"RTN","BPSOSQF",25,0)
 . . N X S X=$G(^BPSEI(INSURER,101))
"RTN","BPSOSQF",26,0)
 . . S T=$P(X,U),PROBER=$P(X,U,6)
"RTN","BPSOSQF",27,0)
 . E  D
"RTN","BPSOSQF",28,0)
 . . S INSURER=$$PAYERSH(IEN59)
"RTN","BPSOSQF",29,0)
 . . I INSURER="" Q
"RTN","BPSOSQF",30,0)
 . . N X S X=$G(^BPSF(9002313.92,INSURER,1))
"RTN","BPSOSQF",31,0)
 . . S T=$P(X,U,12),PROBER=$P(X,U,11)
"RTN","BPSOSQF",32,0)
 . I INSURER="" Q
"RTN","BPSOSQF",33,0)
 . ; If still in wait, but wait expired, just allow one claim thru.
"RTN","BPSOSQF",34,0)
 . ; But if wait has been canceled - that is, we had a successful
"RTN","BPSOSQF",35,0)
 . ; transmit, meaning the insurer has awakened - then let them all
"RTN","BPSOSQF",36,0)
 . ; go through to status 30.
"RTN","BPSOSQF",37,0)
 . ; if somehow the prober became complete, without clearing 101;6
"RTN","BPSOSQF",38,0)
 . ; (maybe this happens if cancellation takes place?)
"RTN","BPSOSQF",39,0)
 . I PROBER D
"RTN","BPSOSQF",40,0)
 . . N X S X=$P($G(^BPST(PROBER,0)),U,2)
"RTN","BPSOSQF",41,0)
 . . I X=99!(X="") S PROBER=""
"RTN","BPSOSQF",42,0)
 . I T,PROBER,PROBER'=IEN59 Q  ; only prober can go thru during wait
"RTN","BPSOSQF",43,0)
 . I T,'VARX S $P(^BPSEI(INSURER,101),U,6)=IEN59,PROBER=IEN59 ; you're the prober
"RTN","BPSOSQF",44,0)
 . I T,VARX S $P(^BPSF(9002313.92,INSURER,1),U,11)=IEN59,PROBER=IEN59
"RTN","BPSOSQF",45,0)
 . S ^TMP("BPSOSQF",$J,INSURER,IEN59)=""
"RTN","BPSOSQF",46,0)
 D UNLOCK59^BPSOSQ2
"RTN","BPSOSQF",47,0)
 S INSURER="" F  S INSURER=$O(^TMP("BPSOSQF",$J,INSURER)) Q:'INSURER  D
"RTN","BPSOSQF",48,0)
 . S IEN59="" F  S IEN59=$O(^TMP("BPSOSQF",$J,INSURER,IEN59)) Q:'IEN59  D
"RTN","BPSOSQF",49,0)
 . . D SETSTAT^BPSOSQ2(30) ; reset to status 30
"RTN","BPSOSQF",50,0)
 . . D LOG59^BPSOSQ($T(+0)_" - Retrying Asleep Claim.  Prober? "_$S(PROBER=IEN59:"YES",1:"NO"),IEN59)
"RTN","BPSOSQF",51,0)
 . . I 'VARX K ^BPST(IEN59,8) ; clear Listmanager wait info
"RTN","BPSOSQF",52,0)
 Q
"RTN","BPSOSQF",53,0)
PAYERSH(IEN59) ;
"RTN","BPSOSQF",54,0)
 N POS
"RTN","BPSOSQF",55,0)
 S POS=$P($G(^BPST(IEN59,9)),U,1)
"RTN","BPSOSQF",56,0)
 I POS="" Q ""
"RTN","BPSOSQF",57,0)
 Q $$GET1^DIQ(9002313.59902,POS_","_IEN59_",",902.02,"I")
"RTN","BPSOSQG")
0^223^B12910897
"RTN","BPSOSQG",1,0)
BPSOSQG ;BHAM ISC/FCS/DRS/FLS - form transmission packets ;06/01/2004
"RTN","BPSOSQG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQG",3,0)
 Q
"RTN","BPSOSQG",4,0)
 ; PACKET(), split off from BPSOSQ2
"RTN","BPSOSQG",5,0)
 ;
"RTN","BPSOSQG",6,0)
PACKET() ;EP - BPSOSQ2
"RTN","BPSOSQG",7,0)
 ; packetize one prescription (and possibly more prescriptions
"RTN","BPSOSQG",8,0)
 ; for the same patient, if they're ready now.)
"RTN","BPSOSQG",9,0)
 ; Called from BPSOSQ2,
"RTN","BPSOSQG",10,0)
 ;  which gave us RXILIST(IEN59) array of claims to packetize.
"RTN","BPSOSQG",11,0)
 ;
"RTN","BPSOSQG",12,0)
 N X S X="PACKERR^"_$T(+0),@^%ZOSF("TRAP")
"RTN","BPSOSQG",13,0)
 N CLAIMIEN,DIALOUT,ERROR
"RTN","BPSOSQG",14,0)
 I $P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S DIALOUT=$$DIALOUT ;lje;6/27;/03 get dialout if not va
"RTN","BPSOSQG",15,0)
 E  S DIALOUT="1VA" I $D(VADIAL) S DIALOUT=VADIAL
"RTN","BPSOSQG",16,0)
 ;
"RTN","BPSOSQG",17,0)
 ; If it's a reversal, we already have an ^BPSC(  It was
"RTN","BPSOSQG",18,0)
 ; created by the call to BPSECA8, way back at the beginning.
"RTN","BPSOSQG",19,0)
 ; So, unlike claims, we need only the NCPDP formatting for it.
"RTN","BPSOSQG",20,0)
 N FIRST59 S FIRST59=$O(RXILIST(0))
"RTN","BPSOSQG",21,0)
 I $G(^BPST(FIRST59,4)) D  G POINTM
"RTN","BPSOSQG",22,0)
 . ; Mimic a few things that are set up in the code we're skipping
"RTN","BPSOSQG",23,0)
 . S CLAIMIEN=$P(^BPST(FIRST59,4),U)
"RTN","BPSOSQG",24,0)
 . S CLAIMIEN(CLAIMIEN)=""
"RTN","BPSOSQG",25,0)
 ; - - - - -  But if it's not a reversal, do all this stuff:  - - - - -
"RTN","BPSOSQG",26,0)
 I $O(RXILIST($O(RXILIST("")))) D
"RTN","BPSOSQG",27,0)
 . D LOG2LIST^BPSOSQ("Packetizing - we have more than one claim:")
"RTN","BPSOSQG",28,0)
 . N I,X,Y S (X,Y)=""
"RTN","BPSOSQG",29,0)
 . F I=1:1 S X=$O(RXILIST(X)) Q:'X  D
"RTN","BPSOSQG",30,0)
 . . S $P(Y,", ",I-1#4+1)=X
"RTN","BPSOSQG",31,0)
 . . I I#4=0 D LOG2LIST^BPSOSQ(Y) S Y=""
"RTN","BPSOSQG",32,0)
 . I Y]"" D LOG2LIST^BPSOSQ(Y)
"RTN","BPSOSQG",33,0)
 ; - - - - -  
"RTN","BPSOSQG",34,0)
 ; Retrieve some important variables from the ECME WORKING file
"RTN","BPSOSQG",35,0)
 ; The ones we retrieve are the same for all prescriptions in RXILIST(*)
"RTN","BPSOSQG",36,0)
 N PATDFN S PATDFN=$P(^BPST(FIRST59,0),U,6)
"RTN","BPSOSQG",37,0)
 N ABSBVISI S ABSBVISI=$P(^BPST(FIRST59,0),U,7)
"RTN","BPSOSQG",38,0)
 ;
"RTN","BPSOSQG",39,0)
 ;  BPSOSCA calls BPSOSCB,BPSOSCC,BPSOSCD to set up BPS(*)
"RTN","BPSOSQG",40,0)
 ;           then  BPSOSCE to create claims in 9002313.02
"RTN","BPSOSQG",41,0)
 ;
"RTN","BPSOSQG",42,0)
LOCK ;
"RTN","BPSOSQG",43,0)
 ;L +^BPSC:300 ; may be multiple copies of this running!!!
"RTN","BPSOSQG",44,0)
 ;I '$T D  G LOCK:$$IMPOSS^BPSOSUE("L","RIT","LOCK ^BPSC claims file",,,$T(+0))
"RTN","BPSOSQG",45,0)
 ;. D LOG2LIST^BPSOSQ($T(+0)_" - unable to lock file 9002313.02 - should never happen!")
"RTN","BPSOSQG",46,0)
 ; input RXILIST(*)
"RTN","BPSOSQG",47,0)
 D EN^BPSOSCA(DIALOUT) ;
"RTN","BPSOSQG",48,0)
 ; output ERROR, CLAIMIEN, CLAIMIEN(*)
"RTN","BPSOSQG",49,0)
 I ERROR D LOG2LIST^BPSOSQ($T(+0)_" - ERROR="_ERROR_" returned from BPSOSCA")
"RTN","BPSOSQG",50,0)
 ; BPSOSCA set up ERROR,CLAIMIEN,CLAIMIEN(*)
"RTN","BPSOSQG",51,0)
 ;L -^BPSC
"RTN","BPSOSQG",52,0)
 I $G(CLAIMIEN)<1 Q $S(ERROR:ERROR,1:300)
"RTN","BPSOSQG",53,0)
 ;
"RTN","BPSOSQG",54,0)
 ; CLAIMIEN=last claim created
"RTN","BPSOSQG",55,0)
 ; CLAIMIEN(CLAIMIEN)=the list of all claims created
"RTN","BPSOSQG",56,0)
 ;
"RTN","BPSOSQG",57,0)
 ; Then, BPSOSQH calls BPSECA1 to build NCPDP claim format records
"RTN","BPSOSQG",58,0)
 ;
"RTN","BPSOSQG",59,0)
POINTM ; Reversals are joining again here
"RTN","BPSOSQG",60,0)
 D KSCRATCH^BPSOSQ2 ; erase ^BPSECX($J)
"RTN","BPSOSQG",61,0)
 D PASCII^BPSOSQH(DIALOUT) ; gives you ^BPSECX($J,"C",CLAIMIEN,...
"RTN","BPSOSQG",62,0)
 ;
"RTN","BPSOSQG",63,0)
 ;  Drop the NCPDP-formatted records into the list used by
"RTN","BPSOSQG",64,0)
 ;  the sender-receiver.  Too coarse to lock the whole list - 
"RTN","BPSOSQG",65,0)
 ;  you'll be blocked by a sender-receiver who has one claim locked.
"RTN","BPSOSQG",66,0)
 ; (Even though we fixed that recently so that a sender locks the
"RTN","BPSOSQG",67,0)
 ;  claim for only the minimal amount of time.)
"RTN","BPSOSQG",68,0)
 ;
"RTN","BPSOSQG",69,0)
 ;  Drop each claim in there individually.
"RTN","BPSOSQG",70,0)
 ;  And as soon as the very first one hits, rev up a sender-receiver.
"RTN","BPSOSQG",71,0)
 ; 
"RTN","BPSOSQG",72,0)
 N FIRST S FIRST=1
"RTN","BPSOSQG",73,0)
 N X S X="" F  S X=$O(^BPSECX($J,"C",X)) Q:X=""  D
"RTN","BPSOSQG",74,0)
 . F  L +^BPSECX("POS",DIALOUT,"C",X):60 Q:$T  Q:'$$IMPOSS^BPSOSUE("L","RIT","LOCK claims list for DIALOUT="_DIALOUT,,"POINTM",$T(+0))
"RTN","BPSOSQG",75,0)
 . M ^BPSECX("POS",DIALOUT,"C",X)=^BPSECX($J,"C",X)
"RTN","BPSOSQG",76,0)
 . L -^BPSECX("POS",DIALOUT,"C",X)
"RTN","BPSOSQG",77,0)
 . N MSG S MSG="Claim ID "_$P(^BPSC(X,0),U)
"RTN","BPSOSQG",78,0)
 . I '$G(VARX) S MSG=MSG_" queued for "_$P(^BPS(9002313.55,DIALOUT,0),U) ;lje;7/9/03
"RTN","BPSOSQG",79,0)
 . E  S MSG=MSG_" queued for VA"  ;lje;7/9/03
"RTN","BPSOSQG",80,0)
 . D LOG2CLM^BPSOSQ(MSG,X)
"RTN","BPSOSQG",81,0)
 . I FIRST D TASK^BPSOSQ2 S FIRST=0
"RTN","BPSOSQG",82,0)
 D RELSLOT^BPSOSL
"RTN","BPSOSQG",83,0)
 Q 0
"RTN","BPSOSQG",84,0)
DIALOUT()          ; RXILIST(*) should be sent to NDC? or what other processor?
"RTN","BPSOSQG",85,0)
 ; Return a pointer to File 9002313.55, the DIAL OUT file.
"RTN","BPSOSQG",86,0)
 N IEN59 S IEN59=$O(RXILIST(0))
"RTN","BPSOSQG",87,0)
 N X S X=$P(^BPST(IEN59,1),U,6) ; INSURER
"RTN","BPSOSQG",88,0)
 S X=$P(^BPSEI(X,100),U,7) ; which DIAL OUT it points to
"RTN","BPSOSQG",89,0)
 ; get the default dial-out, otherwise
"RTN","BPSOSQG",90,0)
 I 'X S X=$P($G(^BPS(9002313.99,1,"DIAL-OUT DEFAULT")),U)
"RTN","BPSOSQG",91,0)
 I 'X S X=$O(^BPS(9002313.55,"B","DEFAULT",0))
"RTN","BPSOSQG",92,0)
 I 'X S X=$O(^BPS(9002313.55,0)) ; they deleted the DEFAULT one??
"RTN","BPSOSQG",93,0)
 Q X
"RTN","BPSOSQG",94,0)
PACKERR ; error trap comes here
"RTN","BPSOSQG",95,0)
 D @^%ZOSF("ERRTN") ; make error log entry, too
"RTN","BPSOSQG",96,0)
 Q "8899^INTERNAL ERROR: "_$$ZE^BPSOS ; this will go in transaction and eventually on display screen for user
"RTN","BPSOSQH")
0^224^B2352174
"RTN","BPSOSQH",1,0)
BPSOSQH ;BHAM ISC/FCS/DRS/FLS - prepare claims for transmission ;06/01/2004
"RTN","BPSOSQH",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQH",3,0)
 ;prepare claims for transmission (eg assemble into ASCII record format)
"RTN","BPSOSQH",4,0)
 ; Called from BPSOSQG, usually from BPSOSQ2
"RTN","BPSOSQH",5,0)
 ; Also used by certification, called from BPSOSC2
"RTN","BPSOSQH",6,0)
 ;
"RTN","BPSOSQH",7,0)
 ; You have CLAIMIEN(*), array of pointers to 9002313.02 claims
"RTN","BPSOSQH",8,0)
 ;
"RTN","BPSOSQH",9,0)
 ;Creates the following scratch global:
"RTN","BPSOSQH",10,0)
 ;   ^BPSECX($J,"C",0) = <number of claims>
"RTN","BPSOSQH",11,0)
 ;   ^BPSECX($J,"C",CLAIMIEN,0) = <number of nodes>
"RTN","BPSOSQH",12,0)
 ;   ^BPSECX($J,"C",CLAIMIEN,1) = <ASCII record 1-245 chars>
"RTN","BPSOSQH",13,0)
 ;   ^BPSECX($J,"C",CLAIMIEN,2) = <ASCII record 246-490 chars>
"RTN","BPSOSQH",14,0)
 ;                            N) = <..........................>
"RTN","BPSOSQH",15,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSQH",16,0)
PASCII(DIALOUT) ;EP - from BPSOSQG
"RTN","BPSOSQH",17,0)
 ;Manage local variables
"RTN","BPSOSQH",18,0)
 N AREC,COUNT
"RTN","BPSOSQH",19,0)
 S COUNT=0
"RTN","BPSOSQH",20,0)
 ;
"RTN","BPSOSQH",21,0)
 K ^BPSECX($J,"C")
"RTN","BPSOSQH",22,0)
 ;
"RTN","BPSOSQH",23,0)
 S VARX=0 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1 ;LJE;7/14/03
"RTN","BPSOSQH",24,0)
 ; Coming into this, ABS????? has 
"RTN","BPSOSQH",25,0)
 ; set up CLAIMIEN(*) = a list of CLAIMIENs that were generated from
"RTN","BPSOSQH",26,0)
 ; all the prescriptions that might have been bundled together.
"RTN","BPSOSQH",27,0)
 ; So we must loop through that list.
"RTN","BPSOSQH",28,0)
 S CLAIMIEN=""
"RTN","BPSOSQH",29,0)
 F  S CLAIMIEN=$O(CLAIMIEN(CLAIMIEN)) Q:CLAIMIEN=""  D PASCII1
"RTN","BPSOSQH",30,0)
 Q
"RTN","BPSOSQH",31,0)
 ;
"RTN","BPSOSQH",32,0)
PASCII1 ;EP - from above and also BPSOSC2 ;
"RTN","BPSOSQH",33,0)
 ; Assemble NCPDP Ascii formatted record
"RTN","BPSOSQH",34,0)
 S AREC=$$ASCII^BPSECA1(CLAIMIEN)
"RTN","BPSOSQH",35,0)
 Q:AREC=""
"RTN","BPSOSQH",36,0)
 ;
"RTN","BPSOSQH",37,0)
 ;Store NCPDP Ascii formatted record in ^BPSECX($J,"C",CLAIMIEN,..)
"RTN","BPSOSQH",38,0)
 ;transmission scratch global
"RTN","BPSOSQH",39,0)
 N PREFIX
"RTN","BPSOSQH",40,0)
 I 'VARX S PREFIX=$P($G(^BPS(9002313.55,DIALOUT,"NDC")),U,2)
"RTN","BPSOSQH",41,0)
 E  S PREFIX="VA"  ;LJE
"RTN","BPSOSQH",42,0)
 ; If test mode for NDC, then change that prefix from HN* to HN.
"RTN","BPSOSQH",43,0)
 ; (Actually, I don't understand when or where that test mode really
"RTN","BPSOSQH",44,0)
 ;  means anything.)
"RTN","BPSOSQH",45,0)
 I 'VARX D SVEAREC^BPSECX4(PREFIX_AREC,CLAIMIEN,"C") ;production mode
"RTN","BPSOSQH",46,0)
 ;
"RTN","BPSOSQH",47,0)
 ; And save a copy of the original transmitted record in
"RTN","BPSOSQH",48,0)
 ; ^BPSC(CLAIMIEN,"M")
"RTN","BPSOSQH",49,0)
 I 'VARX D  ;VA CLAIM INFO STORED IN BPSECA1;LJE
"RTN","BPSOSQH",50,0)
 . N WP,I F I=1:100:$L(AREC) S WP(I/100+1,0)=$E(AREC,I,I+99)
"RTN","BPSOSQH",51,0)
 . D WP^DIE(9002313.02,CLAIMIEN_",",9999,"","WP")
"RTN","BPSOSQH",52,0)
 ;
"RTN","BPSOSQH",53,0)
 ;Increment claim counter
"RTN","BPSOSQH",54,0)
 S COUNT=COUNT+1
"RTN","BPSOSQH",55,0)
 ;
"RTN","BPSOSQH",56,0)
 Q
"RTN","BPSOSQJ")
0^225^B23398489
"RTN","BPSOSQJ",1,0)
BPSOSQJ ;BHAM ISC/FCS/DRS/FLS - subroutines of BPSOSQ2 ;06/01/2004
"RTN","BPSOSQJ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQJ",3,0)
 Q
"RTN","BPSOSQJ",4,0)
SETSTAT(ABSBRXI,STAT)        D SETSTAT^BPSOSU(STAT) Q
"RTN","BPSOSQJ",5,0)
TSTAMP(DA)         N DIE,DR,X S DIE=9002313.59,DR="7///NOW" D ^DIE Q
"RTN","BPSOSQJ",6,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSQJ",7,0)
 ; Query whether there are formatted claim packets ready
"RTN","BPSOSQJ",8,0)
 ; to send, or formatted response packets ready to be processed.
"RTN","BPSOSQJ",9,0)
 ; Call them without DIALOUT (or with DIALOUT=0) to check all DIALOUTs
"RTN","BPSOSQJ",10,0)
 ; Call with a specific DIALOUT to check only that DIALOUT
"RTN","BPSOSQJ",11,0)
 ; 
"RTN","BPSOSQJ",12,0)
ANY2SEND(DIALOUT) ;EP - from BPSOS2D,BPSOSQ3
"RTN","BPSOSQJ",13,0)
 ; are there any claims waiting to be sent?
"RTN","BPSOSQJ",14,0)
 ; also called from POKE^BPSOSUD
"RTN","BPSOSQJ",15,0)
 ; I called with an DIALOUT, look for just that DIALOUT
"RTN","BPSOSQJ",16,0)
 ; Return TRUE (=DIALOUT) if there are, FALSE if there aren't
"RTN","BPSOSQJ",17,0)
 ; Also:  Return false if this DIALOUT is currently in an ERROR WAIT
"RTN","BPSOSQJ",18,0)
 ; state.
"RTN","BPSOSQJ",19,0)
 ;
"RTN","BPSOSQJ",20,0)
 ; If called without a DIALOUT:  scan all DIALOUTs and return the
"RTN","BPSOSQJ",21,0)
 ;   first one that has some waiting to send.  FALSE if none nowhere.
"RTN","BPSOSQJ",22,0)
 ;
"RTN","BPSOSQJ",23,0)
 N RET
"RTN","BPSOSQJ",24,0)
 I '$G(DIALOUT) G ANY2SA
"RTN","BPSOSQJ",25,0)
 I '$O(^BPSECX("POS",DIALOUT,"C","")) Q 0 ; none waiting to be sent
"RTN","BPSOSQJ",26,0)
 ; Yes, there are some to be set for this DIALOUT
"RTN","BPSOSQJ",27,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) Q DIALOUT  ;LJE;7/17/03
"RTN","BPSOSQJ",28,0)
 I '$$EWAIT55(DIALOUT,"FLAGGED") Q DIALOUT ; no error condition
"RTN","BPSOSQJ",29,0)
 I $$EWAIT55(DIALOUT,"EXPIRED") D  Q DIALOUT ; okay, it's time to retry
"RTN","BPSOSQJ",30,0)
 . D LOG^BPSOSL($T(+0)_" - ERROR WAIT expired, time to retry on dial out #"_DIALOUT)
"RTN","BPSOSQJ",31,0)
 ; Yes, some to be sent, but we're in error wait retry.
"RTN","BPSOSQJ",32,0)
 ; Make sure the individual claims are marked.  (this is to catch any
"RTN","BPSOSQJ",33,0)
 ;  newly arrived claims destined for the DIALOUT with prior comms 
"RTN","BPSOSQJ",34,0)
 ;  problems)
"RTN","BPSOSQJ",35,0)
 D MARKWAIT(DIALOUT)
"RTN","BPSOSQJ",36,0)
 Q 0
"RTN","BPSOSQJ",37,0)
 ;
"RTN","BPSOSQJ",38,0)
ANY2SA ; DIALOUT not given, so look for any DIALOUTs that need work
"RTN","BPSOSQJ",39,0)
 N SET,RET S (SET,RET)=0
"RTN","BPSOSQJ",40,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S RET=$O(^BPSECX("POS",""))
"RTN","BPSOSQJ",41,0)
 E  F  S SET=$O(^BPS(9002313.55,SET)) Q:'SET  I $$ANY2SEND(SET) S RET=SET Q
"RTN","BPSOSQJ",42,0)
 Q RET
"RTN","BPSOSQJ",43,0)
 ;
"RTN","BPSOSQJ",44,0)
 ; EWAIT55  manages ERROR WAIT condition on a DIALOUT
"RTN","BPSOSQJ",45,0)
EWAIT55(DEST,OPER) ;EP - BPSOSQ3
"RTN","BPSOSQJ",46,0)
 L +^BPS(9002313.55,DEST):300
"RTN","BPSOSQJ",47,0)
 N RET S RET=$$EWAIT55A
"RTN","BPSOSQJ",48,0)
 L -^BPS(9002313.55,DEST)
"RTN","BPSOSQJ",49,0)
 Q RET
"RTN","BPSOSQJ",50,0)
EWAIT55A() ; given DEST, OPER
"RTN","BPSOSQJ",51,0)
 N X S X=$G(^BPS(9002313.55,DEST,"ERROR WAIT"))
"RTN","BPSOSQJ",52,0)
 ;
"RTN","BPSOSQJ",53,0)
 ; $$EWAIT55(DEST,"FLAGGED")
"RTN","BPSOSQJ",54,0)
 ;       returns TRUE (=expiration time) if it's in ERROR WAIT state
"RTN","BPSOSQJ",55,0)
 ;       returns FALSE (=0) if it's not
"RTN","BPSOSQJ",56,0)
 I OPER="FLAGGED" Q $P(X,U) ; is it flagged?
"RTN","BPSOSQJ",57,0)
 ;
"RTN","BPSOSQJ",58,0)
 ; $$EWAIT55(DEST,"EXPIRED") returns TRUE if the ERROR WAIT state
"RTN","BPSOSQJ",59,0)
 ;   has expired (or if it's not even flagged)
"RTN","BPSOSQJ",60,0)
 I OPER="EXPIRED" Q $$NOW'<$P(X,U) ; has it expired?
"RTN","BPSOSQJ",61,0)
 ;
"RTN","BPSOSQJ",62,0)
 ; $$EWAIT55(DEST,"INCREMENT") bumps ERROR WAIT to next increment
"RTN","BPSOSQJ",63,0)
 ; $$EWAIT55(DEST,"RESET") resets it to its first increment
"RTN","BPSOSQJ",64,0)
 I OPER="INCREMENT"!(OPER="RESET") D  Q
"RTN","BPSOSQJ",65,0)
 . L +^BPS(9002313.55,DEST):300
"RTN","BPSOSQJ",66,0)
 . N FIRST S FIRST=('$P(X,U))!(OPER="RESET") ; the first time through?
"RTN","BPSOSQJ",67,0)
 . I 'FIRST,$$NOW<$P(X,U) Q  ;hasn't reached the time yet - do not incr.
"RTN","BPSOSQJ",68,0)
 . I '$P(X,U,2) S $P(X,U,2)=30 ; base time
"RTN","BPSOSQJ",69,0)
 . I '$P(X,U,3) S $P(X,U,3)=1.2 ; multiplier
"RTN","BPSOSQJ",70,0)
 . I '$P(X,U,4) S $P(X,U,4)=30*60 ; max wait time
"RTN","BPSOSQJ",71,0)
 . I '$P(X,U,5)!FIRST S $P(X,U,5)=$P(X,U,2) ; current wait time (either init
"RTN","BPSOSQJ",72,0)
 . E  S $P(X,U,5)=$P(X,U,5)*$P(X,U,3) ;      or multiply)
"RTN","BPSOSQJ",73,0)
 . S $P(X,U,5)=$P(X,U,5)\1
"RTN","BPSOSQJ",74,0)
 . S:$P(X,U,5)>$P(X,U,4) $P(X,U,5)=$P(X,U,4) ; apply max if needed
"RTN","BPSOSQJ",75,0)
 . S $P(X,U)=$$TADDNOWS^BPSOSUD($P(X,U,5)) ; set retry time
"RTN","BPSOSQJ",76,0)
 . S ^BPS(9002313.55,DEST,"ERROR WAIT")=X ; store updated data
"RTN","BPSOSQJ",77,0)
 . L -^BPS(9002313.55,DEST)
"RTN","BPSOSQJ",78,0)
 . I FIRST,OPER'="INCREMENT" D
"RTN","BPSOSQJ",79,0)
 . . D MARKWAIT(DEST) ; change claims' status from 50 to 51
"RTN","BPSOSQJ",80,0)
 . E  D
"RTN","BPSOSQJ",81,0)
 . . D INCRWAIT(DEST) ; stamp claims with new time of retry
"RTN","BPSOSQJ",82,0)
 . N DIALOUT S DIALOUT=DEST ; variable needed by TASKAT^BPSOSQ2
"RTN","BPSOSQJ",83,0)
 . D TASKAT^BPSOSQ2($P(^BPS(9002313.55,DIALOUT,"ERROR WAIT"),U)) ; program will run again upon expiry
"RTN","BPSOSQJ",84,0)
 ;
"RTN","BPSOSQJ",85,0)
 ; $$EWAIT55(DEST,"CLEAR") clears the error wait condition
"RTN","BPSOSQJ",86,0)
 I OPER="CLEAR" D  Q
"RTN","BPSOSQJ",87,0)
 . S $P(X,U)="",$P(X,U,5)="" ; clear retry time, current wait time
"RTN","BPSOSQJ",88,0)
 . S ^BPS(9002313.55,DEST,"ERROR WAIT")=X
"RTN","BPSOSQJ",89,0)
 . ; claims are okay in state 51; don't need to requeue them
"RTN","BPSOSQJ",90,0)
 ;
"RTN","BPSOSQJ",91,0)
 D IMPOSS^BPSOSUE("P","TI","Bad arg OPER="_OPER,,"EWAIT55A",$T(+0))
"RTN","BPSOSQJ",92,0)
 Q
"RTN","BPSOSQJ",93,0)
 ;
"RTN","BPSOSQJ",94,0)
 ; When an err condition is first established:  DO MARKWAIT
"RTN","BPSOSQJ",95,0)
 ;     It takes the affected claims from code 50 and resets to 51
"RTN","BPSOSQJ",96,0)
 ;     This is done in two places:
"RTN","BPSOSQJ",97,0)
 ;     1. When an err condition is first detected.
"RTN","BPSOSQJ",98,0)
 ;     2. When a new claim packet comes along and discovers
"RTN","BPSOSQJ",99,0)
 ;        a pre-existing error condition.
"RTN","BPSOSQJ",100,0)
 ;
"RTN","BPSOSQJ",101,0)
 ; When an err condition persists and a retry is scheduled: DO INCRWAIT
"RTN","BPSOSQJ",102,0)
 ;     This marks all the affected claims with the retry time.
"RTN","BPSOSQJ",103,0)
 ;
"RTN","BPSOSQJ",104,0)
 ;      
"RTN","BPSOSQJ",105,0)
MARKWAIT(DEST)     ; Put status 50 claims into wait state because of this DEST
"RTN","BPSOSQJ",106,0)
 ; having comms problems.
"RTN","BPSOSQJ",107,0)
 ; The packets are in @ROOT@(PACKET), PACKET is pointer to 9002313.02
"RTN","BPSOSQJ",108,0)
 ; The claims are in ^BPST("AE",PACKET,*)
"RTN","BPSOSQJ",109,0)
 ; The claims are in ^BPST("AD",50,*), too
"RTN","BPSOSQJ",110,0)
 ; You want to check ONLY the code 50's!  I you do it by going 
"RTN","BPSOSQJ",111,0)
 ; through the "AE" index, and it's a long delay, and you have
"RTN","BPSOSQJ",112,0)
 ; hundreds of claims backed up, this gets to be too expensive.
"RTN","BPSOSQJ",113,0)
 N TIME S TIME=$P(^BPS(9002313.55,DEST,"ERROR WAIT"),U)
"RTN","BPSOSQJ",114,0)
 N IEN59 S IEN59=""
"RTN","BPSOSQJ",115,0)
 F  S IEN59=$O(^BPST("AD",50,IEN59)) Q:'IEN59  D
"RTN","BPSOSQJ",116,0)
 . N PACKET S PACKET=$P(^BPST(IEN59,0),U,4)
"RTN","BPSOSQJ",117,0)
 . I $D(^BPSECX("POS",DEST,"C",PACKET)) D
"RTN","BPSOSQJ",118,0)
 . . D SETSTAT(IEN59,51) ; takes care of LOCK, last update, etc.!
"RTN","BPSOSQJ",119,0)
 . . ; and mark the claim with useful data for the Listmanager screen
"RTN","BPSOSQJ",120,0)
 . . S $P(^BPST(IEN59,8),U,1,2)=TIME_U_DEST
"RTN","BPSOSQJ",121,0)
 Q
"RTN","BPSOSQJ",122,0)
INCRWAIT(DEST)  ; Stamp all the waiting claims for this DIALOUT (DEST)
"RTN","BPSOSQJ",123,0)
 ; with the scheduled retry time.
"RTN","BPSOSQJ",124,0)
 ; This will induce the Listman display to update its display, too,
"RTN","BPSOSQJ",125,0)
 ; when the Listman job sees that the LAST UPDATE time in .59 
"RTN","BPSOSQJ",126,0)
 ; has changed.
"RTN","BPSOSQJ",127,0)
 N TIME S TIME=$P(^BPS(9002313.55,DEST,"ERROR WAIT"),U)
"RTN","BPSOSQJ",128,0)
 N PACKET S PACKET=""
"RTN","BPSOSQJ",129,0)
 F  S PACKET=$O(^BPSECX("POS",DEST,"C",PACKET)) Q:PACKET=""  D
"RTN","BPSOSQJ",130,0)
 . N IEN59 S IEN59=""
"RTN","BPSOSQJ",131,0)
 . F  S IEN59=$O(^BPST("AE",PACKET,IEN59)) Q:IEN59=""  D
"RTN","BPSOSQJ",132,0)
 . . S $P(^BPST(IEN59,8),U,1,2)=TIME_U_DEST
"RTN","BPSOSQJ",133,0)
 . . D TSTAMP(IEN59)
"RTN","BPSOSQJ",134,0)
 . F  S IEN59=$O(^BPST("AER",PACKET,IEN59)) Q:IEN59=""  D
"RTN","BPSOSQJ",135,0)
 . . S $P(^BPST(IEN59,8),U,1,2)=TIME_U_DEST
"RTN","BPSOSQJ",136,0)
 . . D TSTAMP(IEN59)
"RTN","BPSOSQJ",137,0)
 Q
"RTN","BPSOSQL")
0^226^B63930968
"RTN","BPSOSQL",1,0)
BPSOSQL ;BHAM ISC/FCS/DRS/FLS - Process responses ;06/01/2004
"RTN","BPSOSQL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQL",3,0)
 ;;Reference to ^PSRX( supported by DBIA4032
"RTN","BPSOSQL",4,0)
 ;
"RTN","BPSOSQL",5,0)
 ;-----------------------------------------------------
"RTN","BPSOSQL",6,0)
 ;IHS/SD/lwj 10/07/02 NCPDP 5.1 changes
"RTN","BPSOSQL",7,0)
 ; The reversal claim now has a transaction code of "B2" instead of 
"RTN","BPSOSQL",8,0)
 ; 11.  Needed to adjust the ISREVERS routine to account for the 
"RTN","BPSOSQL",9,0)
 ; difference.  Also adjusted the RESP1 routine to check the
"RTN","BPSOSQL",10,0)
 ; additional message field (526) since not all processors will use
"RTN","BPSOSQL",11,0)
 ; the 504 message field in 5.1.
"RTN","BPSOSQL",12,0)
 ;
"RTN","BPSOSQL",13,0)
 ;-----------------------------------------------------
"RTN","BPSOSQL",14,0)
 Q
"RTN","BPSOSQL",15,0)
 ;
"RTN","BPSOSQL",16,0)
 ; Subroutines from BPSOSQ4 - the main line of processing is in here.
"RTN","BPSOSQL",17,0)
 ; The utility subroutines remain in BPSOSQ4.
"RTN","BPSOSQL",18,0)
 ;
"RTN","BPSOSQL",19,0)
 ;  RESPONSE(DIALOUT)
"RTN","BPSOSQL",20,0)
 ;     Processes all response packets for this DIALOUT
"RTN","BPSOSQL",21,0)
 ;     Creates 9002313.03 response record
"RTN","BPSOSQL",22,0)
 ;     At this point, you are guaranteed to be the only job
"RTN","BPSOSQL",23,0)
 ;     processing responses for this DIALOUT - you have a LOCK on
"RTN","BPSOSQL",24,0)
 ;     that privilege, set up in BPSOSQ4.  But the old LOCK logic
"RTN","BPSOSQL",25,0)
 ;     is retained in here, in case that BPSOSQ4 restriction is
"RTN","BPSOSQL",26,0)
 ;     ever removed.
"RTN","BPSOSQL",27,0)
 ;  ONE(CLAIMIEN,RESPIEN)
"RTN","BPSOSQL",28,0)
 ;     Process the 9002313.03 RESPIEN for the 9002313.02 CLAIMIEN
"RTN","BPSOSQL",29,0)
 ;     Loops through all 9002313.59's represented in the CLAIMIEN
"RTN","BPSOSQL",30,0)
 ;  ONE1(IEN59)
"RTN","BPSOSQL",31,0)
 ;     Processing the 9002313.03 RESPIEN for this one IEN59
"RTN","BPSOSQL",32,0)
 ;     It's just a tiny wrapper for RESP1 to save,set,restore logging
"RTN","BPSOSQL",33,0)
 ;  RESP1
"RTN","BPSOSQL",34,0)
 ;     The real work of response handling for one IEN59 is in here
"RTN","BPSOSQL",35,0)
 ;
"RTN","BPSOSQL",36,0)
RESPONSE(DIALOUT) ;EP - BPSOSQ4
"RTN","BPSOSQL",37,0)
 ;
"RTN","BPSOSQL",38,0)
 ; Currently, the caller from BPSOSQ4 will already have the
"RTN","BPSOSQL",39,0)
 ; lock on ^TMP($J,"BPSOSQ4",DIALOUT)
"RTN","BPSOSQL",40,0)
 ; This routine tries to get L +^BPSECX("POS",DIALOUT,"R")
"RTN","BPSOSQL",41,0)
 ; and then L +^BPSECX("POS",DIALOUT,"R",CLAIMIEN)
"RTN","BPSOSQL",42,0)
 ; All of this locking could be greatly simplified, it seems.
"RTN","BPSOSQL",43,0)
 ; 
"RTN","BPSOSQL",44,0)
 N CLAIMIEN,RESPIEN,RESPREC,CLAIMID,DIC,X,Y
"RTN","BPSOSQL",45,0)
 S CLAIMIEN=""
"RTN","BPSOSQL",46,0)
 F  D  Q:CLAIMIEN=""
"RTN","BPSOSQL",47,0)
 . I '$$LLIST S CLAIMIEN="" Q  ; Lock the whole list of responses
"RTN","BPSOSQL",48,0)
 . S CLAIMIEN=$O(^BPSECX("POS",DIALOUT,"R",CLAIMIEN))
"RTN","BPSOSQL",49,0)
 . I CLAIMIEN="" D ULLIST Q
"RTN","BPSOSQL",50,0)
 . ; lock the individual response and unlock the list (useless oper?)
"RTN","BPSOSQL",51,0)
 . F  Q:$$LRESP  Q:'$$IMPOSS^BPSOSUE("L","RI","Locking response for CLAIMIEN="_CLAIMIEN,,"RESPONSE",$T(+0))
"RTN","BPSOSQL",52,0)
 . D ULLIST ; unlock the list
"RTN","BPSOSQL",53,0)
 . ;
"RTN","BPSOSQL",54,0)
 . ;Assemble RESPREC from scratch global
"RTN","BPSOSQL",55,0)
 . S RESPREC=""
"RTN","BPSOSQL",56,0)
 . N I F I=1:1:^BPSECX("POS",DIALOUT,"R",CLAIMIEN,0) D
"RTN","BPSOSQL",57,0)
 . . S RESPREC=RESPREC_^BPSECX("POS",DIALOUT,"R",CLAIMIEN,I)
"RTN","BPSOSQL",58,0)
 . S RESPREC=$P(RESPREC,$C(3))
"RTN","BPSOSQL",59,0)
 . I RESPREC="" D  Q  ; null response?  should be impossible,
"RTN","BPSOSQL",60,0)
 . . ; but we saw it once at Parker.
"RTN","BPSOSQL",61,0)
 . . D LOG^BPSOSL($T(+0)_" - ??? Null response to CLAIMIEN "_CLAIMIEN)
"RTN","BPSOSQL",62,0)
 . . D KILLRESP
"RTN","BPSOSQL",63,0)
 . ;
"RTN","BPSOSQL",64,0)
 . S CLAIMID=$P($G(^BPSC(CLAIMIEN,0)),U,1)
"RTN","BPSOSQL",65,0)
 . I CLAIMID="" D  Q  ; impossible?
"RTN","BPSOSQL",66,0)
 . . D LOG^BPSOSL($T(+0)_" - ??? CLAIMID is missing from "_CLAIMIEN)
"RTN","BPSOSQL",67,0)
 . . D KILLRESP
"RTN","BPSOSQL",68,0)
 . ;
"RTN","BPSOSQL",69,0)
 . ;Create Claim Response Record (9002313.03)
"RTN","BPSOSQL",70,0)
 . F  D  Q:RESPIEN'<1  Q:$$IMPOSS^BPSOSUE("FM","TI","^DIC failed to create new ^BPSR record for CLAIMID="_CLAIMID,,,$T(+0))
"RTN","BPSOSQL",71,0)
 . . N X,DLAYGO,DIC,Y S X=""""_CLAIMID_""""
"RTN","BPSOSQL",72,0)
 . . S DIC="^BPSR(",DIC(0)="LXZ",DLAYGO=9002313.03 D ^DIC
"RTN","BPSOSQL",73,0)
 . . S RESPIEN=+Y
"RTN","BPSOSQL",74,0)
 . ;
"RTN","BPSOSQL",75,0)
 . D LOG^BPSOSL($T(+0)_" - Claim "_CLAIMIEN_" got Response "_RESPIEN)
"RTN","BPSOSQL",76,0)
 . ;
"RTN","BPSOSQL",77,0)
 . N STAMP S STAMP=$$NOWFM^BPSOSU1()
"RTN","BPSOSQL",78,0)
 . ;
"RTN","BPSOSQL",79,0)
 . ;Set Date/Time Response Received field, set cross-reference
"RTN","BPSOSQL",80,0)
 . S $P(^BPSR(RESPIEN,0),U,2)=STAMP
"RTN","BPSOSQL",81,0)
 . S ^BPSR("AE",STAMP,RESPIEN)=""
"RTN","BPSOSQL",82,0)
 . ;
"RTN","BPSOSQL",83,0)
 . ;Set Transmitted On field, set cross-reference
"RTN","BPSOSQL",84,0)
 . S $P(^BPSC(CLAIMIEN,0),U,5)=STAMP
"RTN","BPSOSQL",85,0)
 . S ^BPSC("AE",STAMP,CLAIMIEN)=""
"RTN","BPSOSQL",86,0)
 . ;
"RTN","BPSOSQL",87,0)
 . ;Turn off transmit flag, reset cross-reference
"RTN","BPSOSQL",88,0)
 . S $P(^BPSC(CLAIMIEN,0),U,4)=0
"RTN","BPSOSQL",89,0)
 . K ^BPSC("AD",2,CLAIMIEN) ; 2 (POS) not 1 (old batch)
"RTN","BPSOSQL",90,0)
 . S ^BPSC("AD",0,CLAIMIEN)=""
"RTN","BPSOSQL",91,0)
 . ;
"RTN","BPSOSQL",92,0)
 . ;Parse and File Ascii Response record in Claim Response File
"RTN","BPSOSQL",93,0)
 . D PARSE^BPSECA4(RESPREC,RESPIEN)
"RTN","BPSOSQL",94,0)
 .    ;
"RTN","BPSOSQL",95,0)
 .    ;  and the right place to process ECME responses is here!!!!
"RTN","BPSOSQL",96,0)
 .    ;
"RTN","BPSOSQL",97,0)
 . ; (there was some problem with this slot stacking mechanism?)
"RTN","BPSOSQL",98,0)
 . D ONE(CLAIMIEN,RESPIEN)
"RTN","BPSOSQL",99,0)
 . ;
"RTN","BPSOSQL",100,0)
 . D KILLRESP ; kill the scratch response
"RTN","BPSOSQL",101,0)
 . ; Save a copy of the received packet, too
"RTN","BPSOSQL",102,0)
 . N WP,I F I=1:100:$L(RESPREC) S WP(I/100+1,0)=$E(RESPREC,I,I+99)
"RTN","BPSOSQL",103,0)
 . D WP^DIE(9002313.03,RESPIEN_",",9999,"","WP")
"RTN","BPSOSQL",104,0)
 . D ULRESP ; unlock the response
"RTN","BPSOSQL",105,0)
 . Q
"RTN","BPSOSQL",106,0)
 Q
"RTN","BPSOSQL",107,0)
 ;IHS/SD/lwj 10/07/02 NCPDP 5.1 changes - for reversals we need
"RTN","BPSOSQL",108,0)
 ; to account for a transaction code of 11 for 3.2 claims and
"RTN","BPSOSQL",109,0)
 ; B2 for 5.1 claims.  The next line was remarked out and 
"RTN","BPSOSQL",110,0)
 ; replaced with the 6 lines following it.
"RTN","BPSOSQL",111,0)
 ;ISREVERS(X)        Q $P(^BPSC(X,100),U,3)=11 ; trans.code REVERSAL
"RTN","BPSOSQL",112,0)
ISREVERS(X)        ; trans.code REVERSAL
"RTN","BPSOSQL",113,0)
 ;
"RTN","BPSOSQL",114,0)
 N REVS
"RTN","BPSOSQL",115,0)
 S REVS=0
"RTN","BPSOSQL",116,0)
 S:($P(^BPSC(X,100),U,3)=11)!($P(^BPSC(X,100),U,3)="B2") REVS=1
"RTN","BPSOSQL",117,0)
 Q REVS
"RTN","BPSOSQL",118,0)
 ;
"RTN","BPSOSQL",119,0)
 ;IHS/SD/lwj 10/07/02 end changes to ISREVERS
"RTN","BPSOSQL",120,0)
 ;
"RTN","BPSOSQL",121,0)
ONE(CLAIMIEN,RESPIEN)        ;
"RTN","BPSOSQL",122,0)
 ; Both the 9002313.02 and 9002313.03 are correct and complete
"RTN","BPSOSQL",123,0)
 ; Now update all of the prescription records affected by them.
"RTN","BPSOSQL",124,0)
 ; Loop:  for each prescription represented in the original claim:
"RTN","BPSOSQL",125,0)
 N OLDSLOT S OLDSLOT=$$GETSLOT^BPSOSL
"RTN","BPSOSQL",126,0)
 N ISREVERS S ISREVERS=$$ISREVERS(CLAIMIEN)
"RTN","BPSOSQL",127,0)
 N X S X="RESPONSE -"
"RTN","BPSOSQL",128,0)
 I ISREVERS S X=X_" REVERSAL -"
"RTN","BPSOSQL",129,0)
 S X=X_" Response #"_RESPIEN
"RTN","BPSOSQL",130,0)
 S X=X_" for Claim #"_CLAIMIEN D LOG^BPSOSL(X)
"RTN","BPSOSQL",131,0)
 N INDEX S INDEX=$S(ISREVERS:"AER",1:"AE")
"RTN","BPSOSQL",132,0)
 N IEN59 S IEN59=0
"RTN","BPSOSQL",133,0)
 F  S IEN59=$O(^BPST(INDEX,CLAIMIEN,IEN59)) Q:IEN59=""  D
"RTN","BPSOSQL",134,0)
 . D ONE1(IEN59)
"RTN","BPSOSQL",135,0)
 Q
"RTN","BPSOSQL",136,0)
ONE1(ABSBRXI) ; ABSBRXI would more properly be called IEN59
"RTN","BPSOSQL",137,0)
 D SETSLOT^BPSOSL(OLDSLOT)
"RTN","BPSOSQL",138,0)
 D LOG^BPSOSL("RESPONSE - for ^BPST("_ABSBRXI_")")
"RTN","BPSOSQL",139,0)
 D RESP1
"RTN","BPSOSQL",140,0)
 D SETSLOT^BPSOSL(OLDSLOT) ; because RESP1 changed it, probably
"RTN","BPSOSQL",141,0)
 Q
"RTN","BPSOSQL",142,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSQL",143,0)
 ;Process ASCII Claim Response Records:
"RTN","BPSOSQL",144,0)
 ;
"RTN","BPSOSQL",145,0)
 ;     1.  Loop through ^BPSECX("POS",DIALOUT,$J,"R",CLAIMIEN) 
"RTN","BPSOSQL",146,0)
 ;         transmission scratch global
"RTN","BPSOSQL",147,0)
 ;     2.  Assemble ASCII Claim Response Records
"RTN","BPSOSQL",148,0)
 ;     3.  Create new records in Claim Response File (9002313.03)
"RTN","BPSOSQL",149,0)
 ;     4.  Parse ASCII Claim Response Records then file in
"RTN","BPSOSQL",150,0)
 ;         Claim Response File (9002313.03)
"RTN","BPSOSQL",151,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSQL",152,0)
 ;
"RTN","BPSOSQL",153,0)
LLIST() L +^BPSECX("POS",DIALOUT,"R"):60 Q $T
"RTN","BPSOSQL",154,0)
ULLIST L -^BPSECX("POS",DIALOUT,"R") Q
"RTN","BPSOSQL",155,0)
LRESP() L +^BPSECX("POS",DIALOUT,"R",CLAIMIEN):60 Q $T
"RTN","BPSOSQL",156,0)
ULRESP L -^BPSECX("POS",DIALOUT,"R",CLAIMIEN) Q
"RTN","BPSOSQL",157,0)
KILLRESP K ^BPSECX("POS",DIALOUT,"R",CLAIMIEN) Q
"RTN","BPSOSQL",158,0)
 ;
"RTN","BPSOSQL",159,0)
RESP1 ; called from  ONE1
"RTN","BPSOSQL",160,0)
 ; ABSBRXI would more properly be called IEN59
"RTN","BPSOSQL",161,0)
 N ERROR
"RTN","BPSOSQL",162,0)
 D SETSLOT^BPSOSL(ABSBRXI) ;  point to slot for logging
"RTN","BPSOSQL",163,0)
 N REVERSAL S REVERSAL=$G(^BPST(ABSBRXI,4))>0
"RTN","BPSOSQL",164,0)
 D  ; store pointer to response
"RTN","BPSOSQL",165,0)
 . N DIE,DA,DR S DIE=9002313.59,DA=ABSBRXI
"RTN","BPSOSQL",166,0)
 . S DR=$S(REVERSAL:402,1:4)_"////"_RESPIEN
"RTN","BPSOSQL",167,0)
 . D ^DIE
"RTN","BPSOSQL",168,0)
 D SETSTAT^BPSOSU(90) ; "Processing response"
"RTN","BPSOSQL",169,0)
 ;D LOG^BPSOSL("RESPONSE - Status (Header) = "_$P($G(^BPSR(RESPIEN,500)),U)
"RTN","BPSOSQL",170,0)
 N POSITION S POSITION=$P(^BPST(ABSBRXI,0),U,9)
"RTN","BPSOSQL",171,0)
 I REVERSAL S POSITION=1 ; but reversals have only 1 transaction
"RTN","BPSOSQL",172,0)
 D LOG^BPSOSL("RESPONSE - #"_RESPIEN_", POSITION="_POSITION)
"RTN","BPSOSQL",173,0)
 I '$D(^BPSR(RESPIEN,1000,POSITION,500)) S ERROR=1 G RESPBAD
"RTN","BPSOSQL",174,0)
 N RESP S RESP=$P(^BPSR(RESPIEN,1000,POSITION,500),U)
"RTN","BPSOSQL",175,0)
 D INCSTAT^BPSOSUD("R",$S(RESP="R":2,RESP="P":3,RESP="D":4,RESP="C":5,1:19))
"RTN","BPSOSQL",176,0)
 D
"RTN","BPSOSQL",177,0)
 . N X S X="RESPONSE - Position "_POSITION_" = "_RESP
"RTN","BPSOSQL",178,0)
 . I RESP="P" S X=X_" $"_$$INSPAID1^BPSOS03(RESPIEN,POSITION)
"RTN","BPSOSQL",179,0)
 . D LOG^BPSOSL(X)
"RTN","BPSOSQL",180,0)
 ;
"RTN","BPSOSQL",181,0)
 ;IHS/SD/lwj 10/07/02  NCPDP 5.1 changes - look at field 526 
"RTN","BPSOSQL",182,0)
 ; (additional message) if nothing found in 504
"RTN","BPSOSQL",183,0)
 N X S X=$G(^BPSR(RESPIEN,1000,POSITION,504))
"RTN","BPSOSQL",184,0)
 I X="" S X=$G(^BPSR(RESPIEN,1000,POSITION,526))  ;IHS/SD/lwj 10/07/02
"RTN","BPSOSQL",185,0)
 I X]"" D LOG^BPSOSL("RESPONSE - MESSAGE - "_X)
"RTN","BPSOSQL",186,0)
 ;
"RTN","BPSOSQL",187,0)
 I RESP="R" D  ; rejected, give rejection reasons
"RTN","BPSOSQL",188,0)
 .N J S J=0 F  S J=$O(^BPSR(RESPIEN,1000,POSITION,511,J)) Q:'J  D
"RTN","BPSOSQL",189,0)
 ..N R S R=$P($G(^BPSR(RESPIEN,1000,POSITION,511,J,0)),U)
"RTN","BPSOSQL",190,0)
 ..N X I R]"" D
"RTN","BPSOSQL",191,0)
 ...S X=$O(^BPSF(9002313.93,"B",R,0))
"RTN","BPSOSQL",192,0)
 ...I X]"" S X=$P($G(^BPSF(9002313.93,X,0)),U,2)
"RTN","BPSOSQL",193,0)
 ..E  S X=""
"RTN","BPSOSQL",194,0)
 ..D LOG^BPSOSL("REJECT - "_R_" - "_X)
"RTN","BPSOSQL",195,0)
 .; If there are reject codes and the claim is not a reversal, synch reject codes
"RTN","BPSOSQL",196,0)
 .;   with Outpatient Pharmacy
"RTN","BPSOSQL",197,0)
 .I 'REVERSAL D DURSYNC^BPSECMP2(ABSBRXI)
"RTN","BPSOSQL",198,0)
 ;
"RTN","BPSOSQL",199,0)
 N VARX S VARX=0 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S VARX=1
"RTN","BPSOSQL",200,0)
 N INSURER,INSURNM
"RTN","BPSOSQL",201,0)
 I 'VARX S INSURER=$P(^BPST(ABSBRXI,1),U,6),INSURNM=INSURER
"RTN","BPSOSQL",202,0)
 E  S INSURER=$$PAYERSH^BPSOSQF(ABSBRXI),INSURNM=$$GET1^DIQ(9002313.92,INSURER_",",.01,"E")
"RTN","BPSOSQL",203,0)
 I $$REJSLEEP^BPSOSQ4(RESPIEN,POSITION) D  ; ins. asleep: want to retry
"RTN","BPSOSQL",204,0)
 . D SETSTAT^BPSOSU(31)
"RTN","BPSOSQL",205,0)
 . N X S X=$$INCSLEEP^BPSOSQ4(INSURER)
"RTN","BPSOSQL",206,0)
 . S $P(^BPST(IEN59,8),U,1)=X
"RTN","BPSOSQL",207,0)
 . S $P(^BPST(IEN59,8),U,3)=$G(INSURNM)
"RTN","BPSOSQL",208,0)
 . D LOG^BPSOSL($T(+0)_" - Insurer asleep; retry scheduled for "_X_" for "_$G(INSURNM))
"RTN","BPSOSQL",209,0)
 E  D  ; else: a normal kind of response, so we are done
"RTN","BPSOSQL",210,0)
 . D CLRSLEEP^BPSOSQ4(ABSBRXI,INSURER,1)
"RTN","BPSOSQL",211,0)
 . D SETSTAT^BPSOSU(99) ; "Done"
"RTN","BPSOSQL",212,0)
 . I $G(^BPST(ABSBRXI,3)) D
"RTN","BPSOSQL",213,0)
 . . D SETRESU^BPSOSU(0,"Cancellation tried too late; claim sent.")
"RTN","BPSOSQL",214,0)
 . E  D
"RTN","BPSOSQL",215,0)
 . . D SETRESU^BPSOSU(0,"Payable") ; indicates a complete response was received
"RTN","BPSOSQL",216,0)
 ;  status reports should refer to the ^BPSR entry
"RTN","BPSOSQL",217,0)
 D RELSLOT^BPSOSL
"RTN","BPSOSQL",218,0)
 Q
"RTN","BPSOSQL",219,0)
RESPBAD ; corrupted response escape from RESP1 ; reached by a GOTO
"RTN","BPSOSQL",220,0)
 N MSG S MSG="Corrupted response `"_RESPIEN
"RTN","BPSOSQL",221,0)
 D SETSTAT^BPSOSU(99) ; "Done"
"RTN","BPSOSQL",222,0)
 D SETRESU^BPSOSU(6500+$G(ERROR),MSG)
"RTN","BPSOSQL",223,0)
 D LOG^BPSOSL(MSG)
"RTN","BPSOSQL",224,0)
 D DONE^BPSOSL ; close up the logging slot
"RTN","BPSOSQL",225,0)
 Q
"RTN","BPSOSQP")
0^227^B45335446
"RTN","BPSOSQP",1,0)
BPSOSQP ;BHAM ISC/FCS/DRS/FLS - SGM 05:46 PM 20 Jan 1997 ;06/01/2004
"RTN","BPSOSQP",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQP",3,0)
 ; Entry points:
"RTN","BPSOSQP",4,0)
 ;   EN     called from BPSOSQB from BPSOSQ1
"RTN","BPSOSQP",5,0)
 ;   PAGE7  called from BPSOSI7
"RTN","BPSOSQP",6,0)
 ;
"RTN","BPSOSQP",7,0)
 Q
"RTN","BPSOSQP",8,0)
EN ;EP -   PRICING   ; called from BPSOSQB
"RTN","BPSOSQP",9,0)
 ;
"RTN","BPSOSQP",10,0)
 ; Need lots of stuff set up
"RTN","BPSOSQP",11,0)
 ; including ABSBRXI,ABSBRXR,ABSBNDC,INSURER
"RTN","BPSOSQP",12,0)
 ; Set up lots of variables:
"RTN","BPSOSQP",13,0)
 ;  DRGDFN,DRGNAME
"RTN","BPSOSQP",14,0)
 ;  PROVDFN,PROV
"RTN","BPSOSQP",15,0)
 ;  PRICING,PRICALC
"RTN","BPSOSQP",16,0)
 ;  where PRICING=qty^unit price^subtotal^disp fee^total
"RTN","BPSOSQP",17,0)
 ;     (Not necessarily rounded off until "total")
"RTN","BPSOSQP",18,0)
 ; Stores PRICING in the ^BPST(ABSBRXI,5) for you.
"RTN","BPSOSQP",19,0)
 ;
"RTN","BPSOSQP",20,0)
 N DRGDFN S DRGDFN=ABSBDRGI
"RTN","BPSOSQP",21,0)
 S DRGNAME=$P($G(^PSDRUG(DRGDFN,0)),U,1) ; (DRUG,GENERIC NAME)
"RTN","BPSOSQP",22,0)
 I DRGNAME="" S DRGNAME="Missing ^PSDRUG("_DRGDFN_")"
"RTN","BPSOSQP",23,0)
 S PROVDFN=$P($G(^PSRX(ABSBRXI,0)),U,4) ; (PRESCRIPTION,PROVIDER)
"RTN","BPSOSQP",24,0)
 S PROV=$$GET1^DIQ(200,PROVDFN,.01)
"RTN","BPSOSQP",25,0)
 I PROV="" S PROV="Missing ^VA(200,"_PROVDFN_")"
"RTN","BPSOSQP",26,0)
 N RETVAL S RETVAL=$$PRICING()
"RTN","BPSOSQP",27,0)
 Q
"RTN","BPSOSQP",28,0)
METHNUM()          ; pricing method number
"RTN","BPSOSQP",29,0)
 N METHOD S METHOD=0
"RTN","BPSOSQP",30,0)
 I INSURER S METHOD=$P($G(^BPSEI(INSURER,100)),U,6)
"RTN","BPSOSQP",31,0)
 I 'METHOD S METHOD=1
"RTN","BPSOSQP",32,0)
 Q METHOD
"RTN","BPSOSQP",33,0)
METHOD() ; what pricing method to use?
"RTN","BPSOSQP",34,0)
 ; point to an entry in 9002313.53 and return the zero node
"RTN","BPSOSQP",35,0)
 Q $G(^BPS(9002313.53,$$METHNUM,0))
"RTN","BPSOSQP",36,0)
GETAWP() ; Given ABSBNDC, get AWP-MED TRANSACTION file's avg. wholesale price
"RTN","BPSOSQP",37,0)
 I ABSBNDC="" Q "" ; should never happen, in theory, but it does
"RTN","BPSOSQP",38,0)
 N X
"RTN","BPSOSQP",39,0)
 I X Q ""
"RTN","BPSOSQP",40,0)
 E  Q ""
"RTN","BPSOSQP",41,0)
GETAWPPD()         ; Given DRGDFN
"RTN","BPSOSQP",42,0)
 Q $P($G(^PSDRUG(DRGDFN,999999931)),U,2) ; AWP PER DISP UNIT field
"RTN","BPSOSQP",43,0)
GETPPDU()          ; Given DRGDFN
"RTN","BPSOSQP",44,0)
 Q $P($G(^PSDRUG(DRGDFN,660)),U,6) ; PRICE PER DISPENSE UNIT
"RTN","BPSOSQP",45,0)
GETCPTRT()         ; Given DRGDFN, try to find it in the CHARGE file RATE field
"RTN","BPSOSQP",46,0)
 N CPTDFN
"RTN","BPSOSQP",47,0)
 I 'CPTDFN Q ""
"RTN","BPSOSQP",48,0)
 Q ""
"RTN","BPSOSQP",49,0)
GETPSRXA()         ; get unit price from ^PSRX prescription file, AWP field
"RTN","BPSOSQP",50,0)
 I '$G(ABSBRXR) Q $P($G(^PSRX(ABSBRXI,9999999)),U,6)
"RTN","BPSOSQP",51,0)
 E  Q $P($G(^PSRX(ABSBRXI,1,ABSBRXR,9999999)),U,6)
"RTN","BPSOSQP",52,0)
GETPSRXU()         ; get unit price from ^PSRX prescription file
"RTN","BPSOSQP",53,0)
 I '$G(ABSBRXR) Q $P(^PSRX(ABSBRXI,0),U,17)
"RTN","BPSOSQP",54,0)
 Q $P(^PSRX(ABSBRXI,1,ABSBRXR,0),U,11)
"RTN","BPSOSQP",55,0)
UNITPRI()          ;  unit price ; NOT ROUNDED!!!
"RTN","BPSOSQP",56,0)
 ; KEEP UNITPRI1() BASICALLY THE SAME AS UNITPRI!!
"RTN","BPSOSQP",57,0)
 ; If one method fails, others might be tried
"RTN","BPSOSQP",58,0)
 N X,Y ; METHOD already set up by caller
"RTN","BPSOSQP",59,0)
 S Y=$P(METHOD,U,2),X=""
"RTN","BPSOSQP",60,0)
 I Y="APSAMDF" S X=$$GETAWP
"RTN","BPSOSQP",61,0)
 I Y="PSDRUG-AWPPDU" S X=$$GETAWPPD
"RTN","BPSOSQP",62,0)
 I Y="PSDRUG-PPDU" S X=$$GETPPDU
"RTN","BPSOSQP",63,0)
 I Y="PSRX-AWP" S X=$$GETPSRXA
"RTN","BPSOSQP",64,0)
 I Y="PSRX-UNIT" S X=$$GETPSRXU
"RTN","BPSOSQP",65,0)
 I Y="ABSCPT" S X=$$GETCPTRT
"RTN","BPSOSQP",66,0)
 ; If primary method failed, try all the others, finally default to $1
"RTN","BPSOSQP",67,0)
 I 'X S X=$$GETAWP ; these are in order of priority, from highest...
"RTN","BPSOSQP",68,0)
 I 'X S X=$$GETAWPPD
"RTN","BPSOSQP",69,0)
 I 'X S X=$$GETPSRXA
"RTN","BPSOSQP",70,0)
 I 'X S X=$$GETPSRXU
"RTN","BPSOSQP",71,0)
 I 'X S X=$$GETPPDU
"RTN","BPSOSQP",72,0)
 I 'X S X=$$GETCPTRT ; ... to lowest
"RTN","BPSOSQP",73,0)
 I 'X S X=1.001 ; just stuff this price for now
"RTN","BPSOSQP",74,0)
 I $P(METHOD,U,3)="STEP" S X=$$STEP(X)
"RTN","BPSOSQP",75,0)
 ; E  it must be ="LINEAR"
"RTN","BPSOSQP",76,0)
 Q X
"RTN","BPSOSQP",77,0)
UNITPRI1()         ; same as UNITPRI except retval is price^method
"RTN","BPSOSQP",78,0)
 N X,Y ; caller already set up method
"RTN","BPSOSQP",79,0)
 S Y=$P(METHOD,U,2)
"RTN","BPSOSQP",80,0)
 S X=$$UNITPRI2(Y) ; try the primary method first
"RTN","BPSOSQP",81,0)
 ; and if it failed, try all the other methods, in order
"RTN","BPSOSQP",82,0)
 I X="" S X=$$UNITPRI2("APSAMDF")
"RTN","BPSOSQP",83,0)
 I X="" S X=$$UNITPRI2("PSDRUG-AWPPDU")
"RTN","BPSOSQP",84,0)
 I X="" S X=$$UNITPRI2("PSDRUG-PPDU")
"RTN","BPSOSQP",85,0)
 I X="" S X=$$UNITPRI2("PSRX-AWP")
"RTN","BPSOSQP",86,0)
 I X="" S X=$$UNITPRI2("PSRX-UNIT")
"RTN","BPSOSQP",87,0)
 I X="" S X=$$UNITPRI2("ABSCPT")
"RTN","BPSOSQP",88,0)
 I X="" S X=$$UNITPRI2("")
"RTN","BPSOSQP",89,0)
 Q X
"RTN","BPSOSQP",90,0)
UNITPRI2(Y)        ; given Y = method,
"RTN","BPSOSQP",91,0)
 ; return  unit price ^ method,
"RTN","BPSOSQP",92,0)
 ;  or return "" if price not found using that method
"RTN","BPSOSQP",93,0)
 I Y="APSAMDF" S X=$$GETAWP
"RTN","BPSOSQP",94,0)
 E  I Y="PSDRUG-AWPPDU" S X=$$GETAWPPD
"RTN","BPSOSQP",95,0)
 E  I Y="PSDRUG-PPDU" S X=$$GETPPDU
"RTN","BPSOSQP",96,0)
 E  I Y="PSRX-AWP" S X=$$GETPSRXA
"RTN","BPSOSQP",97,0)
 E  I Y="PSRX-UNIT" S X=$$GETPSRXU
"RTN","BPSOSQP",98,0)
 E  I Y="ABSCPT" S X=$$GETCPTRT
"RTN","BPSOSQP",99,0)
 E  I Y="" S Y="NOT FOUND",X=1.01 ; hardcode desperation default of $1.01 per unit
"RTN","BPSOSQP",100,0)
 E  D IMPOSS^BPSOSUE("DB,P","TI","No match on price source "_Y,,"UNITPRI2",$T(+0))
"RTN","BPSOSQP",101,0)
 Q $S(X="":"",1:X_U_Y)
"RTN","BPSOSQP",102,0)
STEP(X) ; INCOMPLETE!!!!   deal with step formula in 9002313.53
"RTN","BPSOSQP",103,0)
 D IMPOSS^BPSOSUE("DB,P","TI","STEP formulas not implemented",,"STEP",$T(+0))
"RTN","BPSOSQP",104,0)
 Q
"RTN","BPSOSQP",105,0)
PRICING()          ; compute the price - want to integrate with $$UNITPRI
"RTN","BPSOSQP",106,0)
 S PRICALC="" ; side effect - sets PRICALC
"RTN","BPSOSQP",107,0)
 N METHOD S METHOD=$$METHOD ; pricing method data
"RTN","BPSOSQP",108,0)
 ; METHOD = name^unit price source^formula^multiplier^disp fee
"RTN","BPSOSQP",109,0)
 N QTY S QTY=$$QTY I QTY'=1 S PRICALC=PRICALC_QTY
"RTN","BPSOSQP",110,0)
 N UNITPRI S UNITPRI=$$UNITPRI S PRICALC=PRICALC_"*"_UNITPRI
"RTN","BPSOSQP",111,0)
 N MULTIP S MULTIP=$P(METHOD,U,4) S:'MULTIP MULTIP=1
"RTN","BPSOSQP",112,0)
 I MULTIP'=1 S UNITPRI=UNITPRI*MULTIP,PRICALC=PRICALC_"*"_MULTIP
"RTN","BPSOSQP",113,0)
 N DISPFEE S DISPFEE=$$DISPFEE I DISPFEE S PRICALC=PRICALC_"+"_DISPFEE
"RTN","BPSOSQP",114,0)
 N X S X=$$ROUND(UNITPRI*QTY+DISPFEE) S PRICALC=PRICALC_"="_X
"RTN","BPSOSQP",115,0)
 S PRICING=QTY_U_UNITPRI_U_(QTY*UNITPRI)_U_DISPFEE_U_X
"RTN","BPSOSQP",116,0)
 S ^BPST(IEN59,5)=PRICING
"RTN","BPSOSQP",117,0)
 Q X
"RTN","BPSOSQP",118,0)
IEN59() Q ABSBRXI_"."_$TR($J(ABSBRXR,4)," ","0")_"1"
"RTN","BPSOSQP",119,0)
ROUND(X) Q X*100+.5\1/100 ; round to the nearest cent
"RTN","BPSOSQP",120,0)
QTY() ; given ABSBRXI, ABSBRXR
"RTN","BPSOSQP",121,0)
 I $G(ABSBRXR) Q $P($G(^PSRX(ABSBRXI,1,ABSBRXR,0)),U,4) ; REFILL,QTY
"RTN","BPSOSQP",122,0)
 Q $P($G(^PSRX(ABSBRXI,0)),U,7) ; QTY
"RTN","BPSOSQP",123,0)
DISPFEE()          ;
"RTN","BPSOSQP",124,0)
 N FEE
"RTN","BPSOSQP",125,0)
 ; First, see if we have a dispensing fee for this e-insurer.
"RTN","BPSOSQP",126,0)
 I INSURER D  I FEE]"" Q FEE
"RTN","BPSOSQP",127,0)
 . S FEE=$P($G(^BPSEI(INSURER,100)),U,2)
"RTN","BPSOSQP",128,0)
 ;
"RTN","BPSOSQP",129,0)
 ; Default is in PEC/MIS - Setup file
"RTN","BPSOSQP",130,0)
 ; No, I guess there's none in there.
"RTN","BPSOSQP",131,0)
 ;
"RTN","BPSOSQP",132,0)
 ; There may be one in METHOD
"RTN","BPSOSQP",133,0)
 S FEE=$P($$METHOD,U,5) I FEE]"" Q FEE
"RTN","BPSOSQP",134,0)
 ;
"RTN","BPSOSQP",135,0)
 ; Next, we look in the BILLING SETUP file.
"RTN","BPSOSQP",136,0)
 ; Now there's a multiple on RX2 that varies the fee depending on cost.
"RTN","BPSOSQP",137,0)
 ; Ignore that for now, just take the constant value.
"RTN","BPSOSQP",138,0)
 ;
"RTN","BPSOSQP",139,0)
 I FEE]"" Q FEE
"RTN","BPSOSQP",140,0)
 ; Can't come up with a fee, just say zero for now.
"RTN","BPSOSQP",141,0)
 Q 0
"RTN","BPSOSQP",142,0)
PAGE7 ;EP -  called from BPSOSI7 - pop-up page for pricing
"RTN","BPSOSQP",143,0)
 ; want to set some defaults
"RTN","BPSOSQP",144,0)
 N INSURER,ABSBRXI,ABSBRXR,DRGDFN,METHOD,ABSBNDC
"RTN","BPSOSQP",145,0)
 S INSURER=$$GET^DDSVAL(DIE,.DA,7.01)
"RTN","BPSOSQP",146,0)
 S ABSBRXI=$$GET^DDSVAL(DIE,.DA,1.01)
"RTN","BPSOSQP",147,0)
 I ABSBRXI="" D  Q  ; special case:  CPT code, not a prescription drug
"RTN","BPSOSQP",148,0)
 . N CPTIEN S CPTIEN=$$GET^DDSVAL(DIE,.DA,1.08)
"RTN","BPSOSQP",149,0)
 . I 'CPTIEN D IMPOSS^BPSOSUE("DB,P","TI","code for supply item is not yet here? should be",,"PAGE7",$T(+0))
"RTN","BPSOSQP",150,0)
 . ; must have CPTIEN by now ?!
"RTN","BPSOSQP",151,0)
 . I $$GET^DDSVAL(DIE,.DA,5.01)="" D PUT^DDSVAL(DIE,.DA,5.01,1)
"RTN","BPSOSQP",152,0)
 . I $$GET^DDSVAL(DIE,.DA,5.02)="" D
"RTN","BPSOSQP",153,0)
 . . N PRICE
"RTN","BPSOSQP",154,0)
 . . I PRICE="" D  Q
"RTN","BPSOSQP",155,0)
 . . . D PUT^DDSVAL(DIE,.DA,5.03,"")
"RTN","BPSOSQP",156,0)
 . . . D PUT^DDSVAL(DIE,.DA,5.04,"")
"RTN","BPSOSQP",157,0)
 . . . D PUT^DDSVAL(DIE,.DA,5.05,"")
"RTN","BPSOSQP",158,0)
 . . E  D
"RTN","BPSOSQP",159,0)
 . . . D PUT^DDSVAL(DIE,.DA,5.02,PRICE)
"RTN","BPSOSQP",160,0)
 . . . D PUT^DDSVAL(DIE,.DA,5.04,0)
"RTN","BPSOSQP",161,0)
 . . . D PUT^DDSVAL(DIE,.DA,5.06,"ABSCPT",,"I")
"RTN","BPSOSQP",162,0)
 . . . D RECALC1^BPSOSI7
"RTN","BPSOSQP",163,0)
 S ABSBRXR=$$GET^DDSVAL(DIE,.DA,1.02)
"RTN","BPSOSQP",164,0)
 S METHOD=$$METHOD
"RTN","BPSOSQP",165,0)
 S DRGDFN=$$GET^DDSVAL(DIE,.DA,1.03)
"RTN","BPSOSQP",166,0)
 S ABSBNDC=$$GET^DDSVAL(DIE,.DA,.03)
"RTN","BPSOSQP",167,0)
 I ABSBNDC["-" S ABSBNDC=$$MAKE11N^BPSOS9(ABSBNDC)
"RTN","BPSOSQP",168,0)
 D PUT^DDSVAL(DIE,.DA,5.01,$$QTY)
"RTN","BPSOSQP",169,0)
 N X S X=$$UNITPRI1 ; price^source
"RTN","BPSOSQP",170,0)
 D PUT^DDSVAL(DIE,.DA,5.02,$$ZEROES($P(X,U)))
"RTN","BPSOSQP",171,0)
 D PUT^DDSVAL(DIE,.DA,5.04,$J($$DISPFEE,0,2))
"RTN","BPSOSQP",172,0)
 D PUT^DDSVAL(DIE,.DA,5.06,$P(X,U,2),,"I")
"RTN","BPSOSQP",173,0)
 D RECALC1^BPSOSI7 ; do the math
"RTN","BPSOSQP",174,0)
 Q
"RTN","BPSOSQP",175,0)
ZEROES(X)          ; strip leading and trailing zeroes, and "." if not needed
"RTN","BPSOSQP",176,0)
 F  Q:$E(X)'="0"  S X=$E(X,2,$L(X))
"RTN","BPSOSQP",177,0)
 I X["." D
"RTN","BPSOSQP",178,0)
 . F  Q:$E(X,$L(X))'="0"  S X=$E(X,1,$L(X)-1)
"RTN","BPSOSQP",179,0)
 I $E(X,$L(X))="." S X=$E(X,1,$L(X))
"RTN","BPSOSQP",180,0)
 Q X
"RTN","BPSOSQP",181,0)
NEWENTRY ;EP - this is called by ENTRY ACTION of option BPS SETUP PRICING
"RTN","BPSOSQP",182,0)
 N COUNT S COUNT=$P(^BPS(9002313.53,0),U,4)
"RTN","BPSOSQP",183,0)
 W !!,"At this time, you have "
"RTN","BPSOSQP",184,0)
 I COUNT=1 D
"RTN","BPSOSQP",185,0)
 . W "only the STANDARD pricing formula.",!
"RTN","BPSOSQP",186,0)
 E  D
"RTN","BPSOSQP",187,0)
 . W COUNT," pricing formulas on file.",!
"RTN","BPSOSQP",188,0)
 . D ASK^BPSOSS3 ; "Do you want to see a list?"
"RTN","BPSOSQP",189,0)
 Q
"RTN","BPSOSQQ")
0^228^B40600319
"RTN","BPSOSQQ",1,0)
BPSOSQQ ;BHAM ISC/FCS/DRS/FLS - determine billable/unbillable drugs ;06/01/2004
"RTN","BPSOSQQ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQQ",3,0)
 Q
"RTN","BPSOSQQ",4,0)
 ; billable/unbillable drugs  ; called from BPSOSQA from BPSOSQ1
"RTN","BPSOSQQ",5,0)
 ;  $$BILLABLE() to determine if the drug is billable
"RTN","BPSOSQQ",6,0)
 ;   Parameters are all optional, so long as you provide at least one.
"RTN","BPSOSQQ",7,0)
 ;  INSIEN = pointer to insurance
"RTN","BPSOSQQ",8,0)
 ;  DRUGIEN = pointer to drug file
"RTN","BPSOSQQ",9,0)
 ;  NDC = NDC #, 11 digits
"RTN","BPSOSQQ",10,0)
 ;
"RTN","BPSOSQQ",11,0)
 ;   Name comparisons are done non-case sensitive.
"RTN","BPSOSQQ",12,0)
 ;   If the NDC number is given and the AWP-MED TRANSACTION file is
"RTN","BPSOSQQ",13,0)
 ;   present, then that name is used for testing as well as the drug
"RTN","BPSOSQQ",14,0)
 ;   name.  (Two name tests are run.)
"RTN","BPSOSQQ",15,0)
 ;
"RTN","BPSOSQQ",16,0)
 ;  Return value:  result^result text
"RTN","BPSOSQQ",17,0)
 ;     result = 1 billable or 0 not billable
"RTN","BPSOSQQ",18,0)
 ;
"RTN","BPSOSQQ",19,0)
BILLABLE(INSIEN,DRUGIEN,NDC)       ;EP - BPSOSQA
"RTN","BPSOSQQ",20,0)
 ; No insurance, SELF, SELF PAY are always billable
"RTN","BPSOSQQ",21,0)
 I '$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) S RESULT="1^VA Billable Prescription" G VASKIP  ;LJE;6/25/03
"RTN","BPSOSQQ",22,0)
 N RESULT ; *1.26*2*
"RTN","BPSOSQQ",23,0)
 I $D(INSIEN) D  I $D(RESULT) Q RESULT
"RTN","BPSOSQQ",24,0)
 . I 'INSIEN S RESULT="1^no insurance goes through as billable" Q
"RTN","BPSOSQQ",25,0)
 . N X
"RTN","BPSOSQQ",26,0)
 . I X="" S RESULT="1^INSIEN="_INSIEN_" not found in ^AUTNINS?" Q
"RTN","BPSOSQQ",27,0)
 . I X?1"SELF"0.1" PAY" S RESULT="1^SELF PAY goes through as billable"
"RTN","BPSOSQQ",28,0)
 N DRUGNAME,MEDTNAME ; *1.26*2*
"RTN","BPSOSQQ",29,0)
 S RESULT=1 ; assume that it's billable
"RTN","BPSOSQQ",30,0)
 I $G(DRUGIEN) S DRUGNAME=$P(^PSDRUG(DRUGIEN,0),U)
"RTN","BPSOSQQ",31,0)
 E  S DRUGNAME=""
"RTN","BPSOSQQ",32,0)
 I $D(NDC),NDC]"" D
"RTN","BPSOSQQ",33,0)
 . N X
"RTN","BPSOSQQ",34,0)
 . I X S MEDTNAME=""
"RTN","BPSOSQQ",35,0)
 . E  S MEDTNAME=""
"RTN","BPSOSQQ",36,0)
 E  S NDC="",MEDTNAME=""
"RTN","BPSOSQQ",37,0)
 ;
"RTN","BPSOSQQ",38,0)
 ;  First, test to see if it's marked as unbillable, system-wide.
"RTN","BPSOSQQ",39,0)
 ;
"RTN","BPSOSQQ",40,0)
 ;  Then, at PIMC, you want to do this:
"RTN","BPSOSQQ",41,0)
 ;  D TEST(9002313.99,1,'RESULT)
"RTN","BPSOSQQ",42,0)
 ;  to test for "is it billable"
"RTN","BPSOSQQ",43,0)
 ;  That should take care of it!
"RTN","BPSOSQQ",44,0)
 ;
"RTN","BPSOSQQ",45,0)
 D TEST(9002313.99,1,0)
"RTN","BPSOSQQ",46,0)
 I $G(INSIEN) D  ; see if insurer contradicts this result
"RTN","BPSOSQQ",47,0)
 . S ROOT="^BPSEI("_INSIEN_")"
"RTN","BPSOSQQ",48,0)
 . D TEST(9002313.4,INSIEN,'RESULT)
"RTN","BPSOSQQ",49,0)
 . ; that's all we need to do, right?
"RTN","BPSOSQQ",50,0)
VASKIP ;LJE;6/25/03;Skip to here if VA prescrition and return 1 for billable.
"RTN","BPSOSQQ",51,0)
 Q RESULT
"RTN","BPSOSQQ",52,0)
 ; RESULT = 1 or 0^remarks
"RTN","BPSOSQQ",53,0)
 ; Algorithm:
"RTN","BPSOSQQ",54,0)
 ;   First, system-wide settings for Unbillable items are tested.
"RTN","BPSOSQQ",55,0)
 ;       We determine RESULT = billable or unbillable, system-wide
"RTN","BPSOSQQ",56,0)
 ;   Then, insurer's specific settings are tested to see if
"RTN","BPSOSQQ",57,0)
 ;       they contradict the system-wide setting.
"RTN","BPSOSQQ",58,0)
 ;
"RTN","BPSOSQQ",59,0)
 ;   The testing is done in this order:
"RTN","BPSOSQQ",60,0)
 ;    1.  If the NDC number is listed, that's the most precise
"RTN","BPSOSQQ",61,0)
 ;        designation, and we take that result, skipping other tests.
"RTN","BPSOSQQ",62,0)
 ;    2.  If the Name test succeeds, that's our result.
"RTN","BPSOSQQ",63,0)
 ;    3.  Otherwise, we test for whether OTC's are billable.
"RTN","BPSOSQQ",64,0)
TEST(FILE,IEN,FOR)          ; given ROOT,NDC,DRUGNAME,MEDTNAME, modify RESULT
"RTN","BPSOSQQ",65,0)
 ; FOR = 0 if testing for unbillable, = 1 if testing for billable
"RTN","BPSOSQQ",66,0)
 N ROOT,SUB,SUBNDC,SUBNAME
"RTN","BPSOSQQ",67,0)
 S ROOT=^DIC(FILE,0,"GL")_IEN_")"
"RTN","BPSOSQQ",68,0)
 S SUB=$S(FOR:"",1:"UN")_"BILLABLE"
"RTN","BPSOSQQ",69,0)
 S SUBNDC=SUB_" NDC #",SUBNAME=SUB_" DRUG NAME"
"RTN","BPSOSQQ",70,0)
 ; an NDC setting is the most specific - if the NDC setting is present,
"RTN","BPSOSQQ",71,0)
 ;   it determines the result and we skip tests based on Name, OTC
"RTN","BPSOSQQ",72,0)
 I NDC]"",$D(@ROOT@(SUBNDC,"B",NDC)) D  Q
"RTN","BPSOSQQ",73,0)
 . S $P(RESULT,U)=FOR ; mark it as unbillable or billable
"RTN","BPSOSQQ",74,0)
 . N X S X=$P(RESULT,U,2) ; previous commentary
"RTN","BPSOSQQ",75,0)
 . I X]"" S X=X_"; " ; separate the pieces
"RTN","BPSOSQQ",76,0)
 . S X=X_"NDC "_NDC_" is "_$S(FOR:"",1:"un")_"billable "_$$HOW(FILE)
"RTN","BPSOSQQ",77,0)
 . S $P(RESULT,U,2)=X
"RTN","BPSOSQQ",78,0)
 ; the name setting is next - if some name test succeeds,
"RTN","BPSOSQQ",79,0)
 ; that determines the billability and we ignore the OTC setting
"RTN","BPSOSQQ",80,0)
 N NAME
"RTN","BPSOSQQ",81,0)
 F NAME=DRUGNAME,MEDTNAME I NAME]"" I $$NAMETEST D  Q
"RTN","BPSOSQQ",82,0)
 . S $P(RESULT,U)=FOR
"RTN","BPSOSQQ",83,0)
 . N X S X=$P(RESULT,U,2) S:X]"" X=X_"; "
"RTN","BPSOSQQ",84,0)
 . S X=X_"Drug "_NAME_" is "_$S(FOR:"",1:"un")_"billable "_$$HOW(FILE)
"RTN","BPSOSQQ",85,0)
 . S $P(RESULT,U,2)=X
"RTN","BPSOSQQ",86,0)
 ; Finally the OTC setting
"RTN","BPSOSQQ",87,0)
 I $G(DRUGIEN),$P(^PSDRUG(DRUGIEN,0),U,3)["9" D
"RTN","BPSOSQQ",88,0)
 . N OTC S OTC=$P($G(@ROOT@("UNBILLABLE OTC")),U)
"RTN","BPSOSQQ",89,0)
 . I OTC="" Q  ; not specified, so don't alter result
"RTN","BPSOSQQ",90,0)
 . I OTC]"" S OTC='OTC ; =1 if billable, 0 if not billable
"RTN","BPSOSQQ",91,0)
 . I OTC=FOR D
"RTN","BPSOSQQ",92,0)
 . . S $P(RESULT,U)=FOR
"RTN","BPSOSQQ",93,0)
 . . N X S X=$P(RESULT,U,2) S:X]"" X=X_"; "
"RTN","BPSOSQQ",94,0)
 . . S X="OTCs are "_$S(FOR:"",1:"un")_"billable "_$$HOW(FILE)
"RTN","BPSOSQQ",95,0)
 . . S $P(RESULT,U,2)=X
"RTN","BPSOSQQ",96,0)
 Q
"RTN","BPSOSQQ",97,0)
NAMETEST() ; Execute the tests in order; stop when you get a TRUE result
"RTN","BPSOSQQ",98,0)
 ; Given NAME - return value is 1 if any test was TRUE, 0 if all FALSE
"RTN","BPSOSQQ",99,0)
 ; and SUBNAME needed too
"RTN","BPSOSQQ",100,0)
 I '$O(@ROOT@(SUBNAME,0)) Q 0 ; quick out for when no rules are there
"RTN","BPSOSQQ",101,0)
 N ABSBPOS2,DOLLART,X S (DOLLART,ABSBPOS2)=0
"RTN","BPSOSQQ",102,0)
 ; the tests are in terms of a variable X; assumed to be uppercase
"RTN","BPSOSQQ",103,0)
 S X=$TR(NAME,"qwertyuiopasdfghjklzxcvbnm","QWERTYUIOPASDFGHJKLZXCVBNM")
"RTN","BPSOSQQ",104,0)
 F  S ABSBPOS2=$O(@ROOT@(SUBNAME,ABSBPOS2)) Q:'ABSBPOS2  D  Q:DOLLART
"RTN","BPSOSQQ",105,0)
 . X @ROOT@(SUBNAME,ABSBPOS2,0) S DOLLART=$T
"RTN","BPSOSQQ",106,0)
 Q DOLLART
"RTN","BPSOSQQ",107,0)
HOW(FILE)          I FILE=9002313.99 Q "for all companies"
"RTN","BPSOSQQ",108,0)
 I FILE=9002313.4 Q ""
"RTN","BPSOSQQ",109,0)
 Q "HOW^"_$T(+0)_"??"
"RTN","BPSOSQQ",110,0)
 ; Interactive routines
"RTN","BPSOSQQ",111,0)
 ; Entry point:  set OTC field, system-wide (9002313.99)
"RTN","BPSOSQQ",112,0)
SETOTC ;EP - option BPS UNBILLABLE OTC
"RTN","BPSOSQQ",113,0)
 W !!,"This setting determines whether OTC drugs are UNbillable.",!
"RTN","BPSOSQQ",114,0)
 W "First, the default setting which applies to all insurances:",!
"RTN","BPSOSQQ",115,0)
 N DIE,DR,DA,DUOUT,DTOUT,DIC,Y,X,DINUM,DLAYGO,DTIME
"RTN","BPSOSQQ",116,0)
 S DIE=9002313.99,DA=1,DR=2128.13 D ^DIE
"RTN","BPSOSQQ",117,0)
 ;
"RTN","BPSOSQQ",118,0)
 W !!,"Next, you may make any insurer-specific settings.  This is",!
"RTN","BPSOSQQ",119,0)
 W "for situations where an insurer has a different policy on OTCs.",!
"RTN","BPSOSQQ",120,0)
 F  S (DIC,DLAYGO)=9002313.4,DIC(0)="AE" D ^DIC Q:Y<1  D
"RTN","BPSOSQQ",121,0)
 . S DA=+Y,DR=2128.13 D ^DIE
"RTN","BPSOSQQ",122,0)
 Q
"RTN","BPSOSQQ",123,0)
SETNAME ;EP - option BPS UNBILLABLE DRUG ; the name-based rules
"RTN","BPSOSQQ",124,0)
 I DUZ(0)'["@" D  Q
"RTN","BPSOSQQ",125,0)
 . W !,"You have to have a programmer enter these rules.",!
"RTN","BPSOSQQ",126,0)
 N DIE,DR,DA,DUOUT,DTOUT,DIC,Y,X,DINUM,DLAYGO,DTIME
"RTN","BPSOSQQ",127,0)
 W !!?15,"*****  Name-based rules for billable insurances  *****",!
"RTN","BPSOSQQ",128,0)
 W "Enter Mumps IF commands to set $T true or false",!
"RTN","BPSOSQQ",129,0)
 W "(True means Unbillable if you're entering Unbillable rules;",!
"RTN","BPSOSQQ",130,0)
 W " True means Billable if you're entering Billable rules)",!
"RTN","BPSOSQQ",131,0)
 W "The variable X contains the drug name, converted to uppercase.",!
"RTN","BPSOSQQ",132,0)
 W !!?5,"**  First, the system-wide defaults:  **",!
"RTN","BPSOSQQ",133,0)
 S DIE=9002313.99,DA=1,DR=2128.12 D ^DIE
"RTN","BPSOSQQ",134,0)
 W !!?5,"**  Rules for specific insurances  **",!
"RTN","BPSOSQQ",135,0)
 D NOTE
"RTN","BPSOSQQ",136,0)
 F  S (DIC,DLAYGO)=9002313.4,DIC(0)="AE" D ^DIC Q:Y<1  D
"RTN","BPSOSQQ",137,0)
 . S DIE=9002313.4,DA=+Y,DR=2128.12 D ^DIE
"RTN","BPSOSQQ",138,0)
 . S DR=228.12 D ^DIE
"RTN","BPSOSQQ",139,0)
 . W !!
"RTN","BPSOSQQ",140,0)
 Q
"RTN","BPSOSQQ",141,0)
NOTE ;
"RTN","BPSOSQQ",142,0)
 W "(Note:  If the system-wide rule says the drug is billable,",!
"RTN","BPSOSQQ",143,0)
 W " then only the insurer's unbillable test is made,",!
"RTN","BPSOSQQ",144,0)
 W " and conversely, if the system-wide test says unbillable",!
"RTN","BPSOSQQ",145,0)
 W " then only the insurer's billable test is made.)",!
"RTN","BPSOSQQ",146,0)
 Q
"RTN","BPSOSQQ",147,0)
SETNDC ;EP - option BPS UNBILLABLE NDC ; the NDC number rules
"RTN","BPSOSQQ",148,0)
 N DIE,DR,DA,DUOUT,DTOUT,DIC,Y,X,DINUM,DLAYGO,DTIME
"RTN","BPSOSQQ",149,0)
 W !!,"*****  Specifying unbillable and billable NDC numbers",!!
"RTN","BPSOSQQ",150,0)
 W "The numbers you enter must be 11-digit numbers, without dashes.",!!
"RTN","BPSOSQQ",151,0)
 W "First, NDC numbers that are unbillable, system-wide",!
"RTN","BPSOSQQ",152,0)
 S DIE=9002313.99,DA=1,DR=2128.11 D ^DIE
"RTN","BPSOSQQ",153,0)
 W !!,"Now, NDC numbers that are unbillable/billable",!
"RTN","BPSOSQQ",154,0)
 W "for specific insurers",!
"RTN","BPSOSQQ",155,0)
 D NOTE
"RTN","BPSOSQQ",156,0)
 F  S (DIC,DLAYGO)=9002313.4,DIC(0)="AE" D ^DIC Q:Y<1  D
"RTN","BPSOSQQ",157,0)
 . S DIE=9002313.4,DA=+Y,DR="2128.11;228.11" D ^DIE
"RTN","BPSOSQQ",158,0)
 Q
"RTN","BPSOSQQ",159,0)
ANYSET(N) ;EP - are any of the billable/unbillable fields set for 
"RTN","BPSOSQQ",160,0)
 ; ^BPSEI(N ?
"RTN","BPSOSQQ",161,0)
 ;  Used by computed field 2128.99
"RTN","BPSOSQQ",162,0)
 I $P($G(^BPSEI(N,"UNBILLABLE OTC")),U)]"" Q 1
"RTN","BPSOSQQ",163,0)
 N RET,X,Y S RET=0
"RTN","BPSOSQQ",164,0)
 F X="","UN" F Y="DRUG NAME","NDC #" D
"RTN","BPSOSQQ",165,0)
 . I $O(^BPSEI(N,X_"BILLABLE "_Y,0)) S RET=1
"RTN","BPSOSQQ",166,0)
 Q RET
"RTN","BPSOSQS")
0^229^B34719184
"RTN","BPSOSQS",1,0)
BPSOSQS ;BHAM ISC/FCS/DRS/FLS - special queuing considerations ;06/01/2004
"RTN","BPSOSQS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSQS",3,0)
 ;
"RTN","BPSOSQS",4,0)
 ; IHS/DSD/lwj 4/18/02 on behalf of Patrick Cox
"RTN","BPSOSQS",5,0)
 ; IHS/OKCAO/POC 10/2/01  In Oklahoma there is a general 3 punch
"RTN","BPSOSQS",6,0)
 ; a month limitation.  However, there are no limitation for kids
"RTN","BPSOSQS",7,0)
 ; under the age of 18, or for patients in a nursing home.  This 
"RTN","BPSOSQS",8,0)
 ; change will simply address the limitation on the kids under 18.
"RTN","BPSOSQS",9,0)
 ; The maximum number of prescriptions will simply be set to 999 
"RTN","BPSOSQS",10,0)
 ; to reflect no limitation.
"RTN","BPSOSQS",11,0)
 ;
"RTN","BPSOSQS",12,0)
 ; IHS/SD/lwj 6/17/02 on behalf of Patrick Cox
"RTN","BPSOSQS",13,0)
 ; IHS/OKCAO/POC 5/22/02  In the subroutine CAIDPAID, the routine
"RTN","BPSOSQS",14,0)
 ; attempts to count how many Medicaid paid repsonses have been
"RTN","BPSOSQS",15,0)
 ; received for a given month. The script count could be incorrectly 
"RTN","BPSOSQS",16,0)
 ; inflatted if a script was flled/reflled in a prev month, but was 
"RTN","BPSOSQS",17,0)
 ; sbmtd/resbmtd in the current month. Original logic was only  
"RTN","BPSOSQS",18,0)
 ; looking at the month of the claim - not the DOS.  Logic
"RTN","BPSOSQS",19,0)
 ; changed to use the scripts fill dt/refill dt instead of clm dt.
"RTN","BPSOSQS",20,0)
 ; (effected back billing, or resubmittal of previous month scripts
"RTN","BPSOSQS",21,0)
 ; when current month limitation had been reached)
"RTN","BPSOSQS",22,0)
 ; 
"RTN","BPSOSQS",23,0)
 ; IHS/SD/lwj 8/28/02 on behalf of Patrick Cox (OKCAO/POC)
"RTN","BPSOSQS",24,0)
 ; Cache systems do not allow the reverse dollar order on arrays.  
"RTN","BPSOSQS",25,0)
 ; Patrick simply reversed the sign in the PRICEORD array, which 
"RTN","BPSOSQS",26,0)
 ; allowed the values to appear in descending order - this eliminated
"RTN","BPSOSQS",27,0)
 ; the need for the reverse $O on the PRICEORD array.
"RTN","BPSOSQS",28,0)
 ;
"RTN","BPSOSQS",29,0)
 Q
"RTN","BPSOSQS",30,0)
STAT19() ;EP - is called at the bottom of BPSOSQ1
"RTN","BPSOSQS",31,0)
 ; if there are any claims of status 19 - waiting for special 
"RTN","BPSOSQS",32,0)
 ; Oklahoma Medicaid rule to run its course
"RTN","BPSOSQS",33,0)
 N ROU S ROU=$T(+0)
"RTN","BPSOSQS",34,0)
 L +^TMP($J,"BPSOSQS"):0 Q:'$T 0 ; only one of these running
"RTN","BPSOSQS",35,0)
 N COUNT30 S COUNT30=0 ; count how many 19s got pushed to status 30
"RTN","BPSOSQS",36,0)
 D RULE19
"RTN","BPSOSQS",37,0)
 L -^TMP($J,"BPSOSQS")
"RTN","BPSOSQS",38,0)
 ; If there are still any claims with status = 19,
"RTN","BPSOSQS",39,0)
 ; then you need to schedule BPSOSQ1 to run again in a little while.
"RTN","BPSOSQS",40,0)
 I $D(^BPST("AD",19)) D
"RTN","BPSOSQS",41,0)
 . N WAIT S WAIT=$P(^BPS(9002313.99,1,"SPECIAL"),U,2)
"RTN","BPSOSQS",42,0)
 . S:'WAIT WAIT=60
"RTN","BPSOSQS",43,0)
 . S WAIT="."_$TR($J(WAIT\3600,2)_$J(WAIT#3600\60,2)_$J(WAIT#60,2)," ","0")
"RTN","BPSOSQS",44,0)
 . D TASKAT^BPSOSIZ($$TADDNOW^BPSOSUD(WAIT))
"RTN","BPSOSQS",45,0)
 Q COUNT30
"RTN","BPSOSQS",46,0)
RULE19 ;
"RTN","BPSOSQS",47,0)
 N INCYCLE,NLIMIT,SINCEDAT,PAT,IEN59,STAT,LASTUPD,I,X,Y
"RTN","BPSOSQS",48,0)
 ;
"RTN","BPSOSQS",49,0)
 ; Gather all the claims with status 19 into ^TMP($J,"BPSOSQS",$J,PAT,19,IEN59)
"RTN","BPSOSQS",50,0)
 ; Medicaid claims only - already taken care of, in that only 
"RTN","BPSOSQS",51,0)
 ;  Medicaid claims can ever be in status 19
"RTN","BPSOSQS",52,0)
 ; For any status, just set ^TMP($J,"BPSOSQS",$J,PAT,status)=latest last-update
"RTN","BPSOSQS",53,0)
 ;   to make it easy to detect if a given patient has any non-19's.
"RTN","BPSOSQS",54,0)
 ;
"RTN","BPSOSQS",55,0)
 K ^TMP($J,"BPSOSQS")
"RTN","BPSOSQS",56,0)
 S STAT="",IEN59=0
"RTN","BPSOSQS",57,0)
 F  S STAT=$O(^BPST("AD",STAT)) Q:STAT=""  Q:STAT=99  D
"RTN","BPSOSQS",58,0)
 . S IEN59=0
"RTN","BPSOSQS",59,0)
 . F  S IEN59=$O(^BPST("AD",STAT,IEN59)) Q:'IEN59  D
"RTN","BPSOSQS",60,0)
 . . ; $G() in next line guards against corrupt index
"RTN","BPSOSQS",61,0)
 . . S PAT=$P($G(^BPST(IEN59,0)),U,6) Q:'PAT
"RTN","BPSOSQS",62,0)
 . . S LASTUPD=$P(^BPST(IEN59,0),U,8)
"RTN","BPSOSQS",63,0)
 . . S X=$G(^TMP($J,"BPSOSQS",$J,PAT,STAT))
"RTN","BPSOSQS",64,0)
 . . I LASTUPD>X S ^TMP($J,"BPSOSQS",$J,PAT,STAT)=LASTUPD
"RTN","BPSOSQS",65,0)
 . . I STAT=19 S ^TMP($J,"BPSOSQS",$J,PAT,STAT,IEN59)=""
"RTN","BPSOSQS",66,0)
 ;
"RTN","BPSOSQS",67,0)
 ; Loop for each such patient:
"RTN","BPSOSQS",68,0)
 S PAT="" F  S PAT=$O(^TMP($J,"BPSOSQS",$J,PAT)) Q:'PAT  D
"RTN","BPSOSQS",69,0)
 . I '$D(^TMP($J,"BPSOSQS",$J,PAT,19)) Q  ; no 19's for this patient; nothing to do
"RTN","BPSOSQS",70,0)
 . D PAT19
"RTN","BPSOSQS",71,0)
 Q
"RTN","BPSOSQS",72,0)
PAT19 ; Then look at each patient's situation:
"RTN","BPSOSQS",73,0)
 ;
"RTN","BPSOSQS",74,0)
 ; If the patient has any claims with status 20-98 (i.e., actively
"RTN","BPSOSQS",75,0)
 ;  going through ECME right now)  then leave their 19s as 19 for now.
"RTN","BPSOSQS",76,0)
 ; What we do with these depends on how the others turn out.
"RTN","BPSOSQS",77,0)
 ;
"RTN","BPSOSQS",78,0)
 ;  Also, if the patient has any with status <19, wait for those to
"RTN","BPSOSQS",79,0)
 ;  catch up - because apparently, data entry is still going on
"RTN","BPSOSQS",80,0)
 ;  and we want to wait, so we just pick off the three highest-priced.
"RTN","BPSOSQS",81,0)
 ;
"RTN","BPSOSQS",82,0)
 I $O(^TMP($J,"BPSOSQS",$J,PAT,""))'=19 Q  ; there are some w/status < 19
"RTN","BPSOSQS",83,0)
 I $O(^TMP($J,"BPSOSQS",$J,PAT,19))'="" Q  ; there are some w/status > 19
"RTN","BPSOSQS",84,0)
 ;
"RTN","BPSOSQS",85,0)
 ; IHS/DSD/lwj 04/18/02  on behalf of IHS/OKCAO/POC 10/2/2001 
"RTN","BPSOSQS",86,0)
 ; begin changes
"RTN","BPSOSQS",87,0)
 ;
"RTN","BPSOSQS",88,0)
 N BPSINS,BPSERR,LIMIT,MAX,DFN      ;IHS/OKCAO/POC new def
"RTN","BPSOSQS",89,0)
 ;
"RTN","BPSOSQS",90,0)
 ; In the BPS setup file, there is a special node:
"RTN","BPSOSQS",91,0)
 ;   ^BPS(9002313.99,1,"SPECIAL")=OK MEDICAID INS NAME^OK MEDICAID
"RTN","BPSOSQS",92,0)
 ;                                  CYCLE^OK MEDICAID LIMIT
"RTN","BPSOSQS",93,0)
 ; This portion of the code is retrieving the INS name, and the limits
"RTN","BPSOSQS",94,0)
 ; If the insurer is Oklahoma, we will adjust the limits for kids
"RTN","BPSOSQS",95,0)
 ;
"RTN","BPSOSQS",96,0)
 S BPSINS=$$GET1^DIQ(9002313.99,"1,",1960.01,"","","BPSERR")
"RTN","BPSOSQS",97,0)
 S MAX=+$P($G(^BPS(9002313.99,1,"SPECIAL")),U,3) ;IHS/OKCAO/POC def 
"RTN","BPSOSQS",98,0)
 S:'MAX MAX=3                          ;IHS/OKCAO/POC use def when pos
"RTN","BPSOSQS",99,0)
 ;
"RTN","BPSOSQS",100,0)
 ;If this is for Oklahoma and patient is under 18 extend limits
"RTN","BPSOSQS",101,0)
 ; (insurance name is either Oklahoma Medicaid or Oklahoma)
"RTN","BPSOSQS",102,0)
 ; ONLY FOR IHS DLF I ($G(BPSINS)["OKLAHOMA")&($$AGE^AUPNPAT(PAT)<18) S MAX=999
"RTN","BPSOSQS",103,0)
 ;
"RTN","BPSOSQS",104,0)
 S LIMIT=MAX-$$CAIDPAID
"RTN","BPSOSQS",105,0)
 ;
"RTN","BPSOSQS",106,0)
 ; IHS/DSD/lwj 04/18/02 for IHS/OKCAO/POC 10/2/01 end changes
"RTN","BPSOSQS",107,0)
 ;
"RTN","BPSOSQS",108,0)
 ;
"RTN","BPSOSQS",109,0)
 ; LIMIT = how many more paid responses we're allowed for this month
"RTN","BPSOSQS",110,0)
 ;
"RTN","BPSOSQS",111,0)
 ; If LIMIT=0,  we've used up our limit of Medicaid prescriptions
"RTN","BPSOSQS",112,0)
 ;   for the month.  Each of these will have to bump to the next
"RTN","BPSOSQS",113,0)
 ;   insurer.  (For now, just reject them
"RTN","BPSOSQS",114,0)
 ;
"RTN","BPSOSQS",115,0)
 I LIMIT=0 D  Q
"RTN","BPSOSQS",116,0)
 . S IEN59=0 F  S IEN59=$O(^TMP($J,"BPSOSQS",$J,PAT,19,IEN59)) Q:'IEN59  D
"RTN","BPSOSQS",117,0)
 . . D SETSLOT^BPSOSL(IEN59)
"RTN","BPSOSQS",118,0)
 . . N MSG S MSG="Medicaid monthly limit of "_MAX_" reached."
"RTN","BPSOSQS",119,0)
 . . D LOG^BPSOSL(MSG)
"RTN","BPSOSQS",120,0)
 . . I $$BUMPINS^BPSOSQA(IEN59) D  ; bump to next insurer
"RTN","BPSOSQS",121,0)
 . . . ; Succeeded, there is more insurance ; 
"RTN","BPSOSQS",122,0)
 . . . ; And $$BUMPINS reset status to 0
"RTN","BPSOSQS",123,0)
 . . . D LOG^BPSOSL("   We will try the next insurer.")
"RTN","BPSOSQS",124,0)
 . . E  D
"RTN","BPSOSQS",125,0)
 . . . ; Failed - no more insurance - $$BUMPINS set status to 99
"RTN","BPSOSQS",126,0)
 . . . N ABSBRXI S ABSBRXI=IEN59 ; unfortunate variable naming
"RTN","BPSOSQS",127,0)
 . . . D SETRESU^BPSOSU(19,MSG)
"RTN","BPSOSQS",128,0)
 . . D RELSLOT^BPSOSL
"RTN","BPSOSQS",129,0)
 ;
"RTN","BPSOSQS",130,0)
 ; We can still submit some Medicaid prescriptions, but let's
"RTN","BPSOSQS",131,0)
 ; make sure we have all the ones that we're going to get at 
"RTN","BPSOSQS",132,0)
 ; this visit - make sure that the most recent activity on
"RTN","BPSOSQS",133,0)
 ; any of the status 19 claims is at least 2 minutes old.
"RTN","BPSOSQS",134,0)
 ; Otherwise, there may be some more coming, and we would rather
"RTN","BPSOSQS",135,0)
 ; wait and make sure we get the more expensive ones.
"RTN","BPSOSQS",136,0)
 I $$TDIFNOW^BPSOSUD(^TMP($J,"BPSOSQS",$J,PAT,19))<$P(^BPS(9002313.99,1,"SPECIAL"),U,2) Q
"RTN","BPSOSQS",137,0)
 ;
"RTN","BPSOSQS",138,0)
 ; If LIMIT>0, then take this many of the patient's status 19 claims
"RTN","BPSOSQS",139,0)
 ; and change them to status 30.  Any other 19s stay as 19s, 
"RTN","BPSOSQS",140,0)
 ; as we need to wait and see how the others turn out.  If they're
"RTN","BPSOSQS",141,0)
 ; rejected, we could still submit a few of the other 19s.
"RTN","BPSOSQS",142,0)
 ;
"RTN","BPSOSQS",143,0)
 N PRICEORD ; set PRICEORD(price,ien59)="" for each of this pat's 19s
"RTN","BPSOSQS",144,0)
 N PRICE,N
"RTN","BPSOSQS",145,0)
 S IEN59=0
"RTN","BPSOSQS",146,0)
 F  S IEN59=$O(^TMP($J,"BPSOSQS",$J,PAT,19,IEN59)) Q:'IEN59  D
"RTN","BPSOSQS",147,0)
 . N PRICE S PRICE=$P(^BPST(IEN59,5),U,5)
"RTN","BPSOSQS",148,0)
 . S PRICEORD(0-PRICE,IEN59)=""  ;IHS/OKCAO/POC 8/28/02 reverse order
"RTN","BPSOSQS",149,0)
 S PRICE="",N=0
"RTN","BPSOSQS",150,0)
 F  D  Q:PRICE=""  Q:N=LIMIT
"RTN","BPSOSQS",151,0)
 . S PRICE=$O(PRICEORD(PRICE)) Q:PRICE=""  ; from highest to lowest
"RTN","BPSOSQS",152,0)
 . S IEN59=0
"RTN","BPSOSQS",153,0)
 . F  S IEN59=$O(PRICEORD(PRICE,IEN59)) Q:IEN59=""  Q:N=LIMIT  D
"RTN","BPSOSQS",154,0)
 . . N ABSBRXI S ABSBRXI=IEN59 D SETSTAT^BPSOSU(30)
"RTN","BPSOSQS",155,0)
 . . S N=N+1 ; how many submitted for this patient
"RTN","BPSOSQS",156,0)
 . . S COUNT30=COUNT30+1 ; how many submitted in total by this routine
"RTN","BPSOSQS",157,0)
 Q
"RTN","BPSOSQS",158,0)
CAIDPAID()         ; count how many Medicaid paid responses for this patient
"RTN","BPSOSQS",159,0)
 ; this month, up to 3 maximum
"RTN","BPSOSQS",160,0)
 ; given PAT = patient IEN;   MAX=3
"RTN","BPSOSQS",161,0)
 ;
"RTN","BPSOSQS",162,0)
 ; IHS/OKCAO/ECME 5/22/02 (IHS/SD/lwj 6/17/02) changed to look
"RTN","BPSOSQS",163,0)
 ; at month script was filled/refilled for considering script in cnt
"RTN","BPSOSQS",164,0)
 ;
"RTN","BPSOSQS",165,0)
 N INS S INS=$P(^BPS(9002313.99,1,"SPECIAL"),U) ; insurer we seek
"RTN","BPSOSQS",166,0)
 N FOUND S FOUND=0 ; count how many are found
"RTN","BPSOSQS",167,0)
 N SINCE S SINCE=DT,$E(SINCE,6,7)="00" ; yyymm00
"RTN","BPSOSQS",168,0)
 N IEN59,STOP S IEN59=0,STOP=0
"RTN","BPSOSQS",169,0)
 F  S IEN59=$O(^BPST("AC",PAT,IEN59)) D  Q:STOP
"RTN","BPSOSQS",170,0)
 . I 'IEN59 S STOP=1 Q
"RTN","BPSOSQS",171,0)
 . S X=^BPST(IEN59,0)
"RTN","BPSOSQS",172,0)
 . N DATE
"RTN","BPSOSQS",173,0)
 . D
"RTN","BPSOSQS",174,0)
 . . N RXIEN,REFIEN
"RTN","BPSOSQS",175,0)
 . . S RXIEN=$P($G(^BPST(IEN59,1)),U,11),REFIEN=$P($G(^BPST(IEN59,1)),U,1)
"RTN","BPSOSQS",176,0)
 . . S DATE=$S(+REFIEN=0:$P($G(^PSRX(RXIEN,2)),U,2),1:$P($G(^PSRX(RXIEN,1,+REFIEN,0)),U,1))
"RTN","BPSOSQS",177,0)
 . I +DATE Q:DATE<SINCE
"RTN","BPSOSQS",178,0)
 . ; IHS/OKCAO/ECME 05/22/02 (IHS/SD/lwj 6/17/02) end changes
"RTN","BPSOSQS",179,0)
 . I 99'=$P(X,U,2) Q  ; not completed yet
"RTN","BPSOSQS",180,0)
 . I INS'=$P(^BPST(IEN59,1),U,6) Q  ; not this insurer
"RTN","BPSOSQS",181,0)
 . I $$PAID^BPSOSQ4(IEN59) D
"RTN","BPSOSQS",182,0)
 . . S FOUND=FOUND+1
"RTN","BPSOSQS",183,0)
 . . I FOUND=MAX S STOP=1
"RTN","BPSOSQS",184,0)
 Q FOUND
"RTN","BPSOSR1")
1^230
"RTN","BPSOSR2")
0^231^B965768
"RTN","BPSOSR2",1,0)
BPSOSR2 ;BHAM ISC/FCS/DRS/FLS - silent claim submitter ;06/01/2004
"RTN","BPSOSR2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSR2",3,0)
 ; SHOWQ subroutine - continuation of BPSOSRX
"RTN","BPSOSR2",4,0)
 Q
"RTN","BPSOSR2",5,0)
SHOWQ ;EP - BPSOSRX ;  ^BPSECP("BPSOSRX",type,RXI,RXR)
"RTN","BPSOSR2",6,0)
 N ROOT S ROOT="^BPSECP(""BPSOSRX"")"
"RTN","BPSOSR2",7,0)
 N COUNT S COUNT=0
"RTN","BPSOSR2",8,0)
 I '$O(@ROOT@(""))="" W "None",! Q
"RTN","BPSOSR2",9,0)
 N TYPE,RXI,RXR
"RTN","BPSOSR2",10,0)
 F TYPE="CLAIM","UNCLAIM" D
"RTN","BPSOSR2",11,0)
 . W TYPE
"RTN","BPSOSR2",12,0)
 . I '$D(@ROOT@(TYPE)) W " - none",! Q
"RTN","BPSOSR2",13,0)
 . W ":",!
"RTN","BPSOSR2",14,0)
 . S RXI="" F  S RXI=$O(@ROOT@(TYPE,RXI)) Q:RXI=""  D
"RTN","BPSOSR2",15,0)
 . . S RXR="" F  S RXR=$O(@ROOT@(TYPE,RXI,RXR)) Q:RXR=""  D
"RTN","BPSOSR2",16,0)
 . . . W RXI,",",RXR
"RTN","BPSOSR2",17,0)
 . . . ; details like patient, drug could go here
"RTN","BPSOSR2",18,0)
 . . . W !
"RTN","BPSOSR2",19,0)
 . . . S COUNT=COUNT+1
"RTN","BPSOSR2",20,0)
 . W "Total ",COUNT," ",TYPE W:COUNT'=1 "s"
"RTN","BPSOSR2",21,0)
 . W !
"RTN","BPSOSR2",22,0)
 Q
"RTN","BPSOSR4")
1^233
"RTN","BPSOSRB")
0^234^B30162283
"RTN","BPSOSRB",1,0)
BPSOSRB ;BHAM ISC/FCS/DRS/FLS - background from BPSOSRX ;06/01/2004
"RTN","BPSOSRB",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSRB",3,0)
 Q
"RTN","BPSOSRB",4,0)
BACKGR ;
"RTN","BPSOSRB",5,0)
 I '$$LOCKNOW^BPSOSRX("BACKGROUND") Q
"RTN","BPSOSRB",6,0)
 N BACKSLOT S BACKSLOT=DT+.4
"RTN","BPSOSRB",7,0)
 D INIT^BPSOSL(BACKSLOT,1,-1)
"RTN","BPSOSRB",8,0)
 N LIST,TYPE,RXI,RXR,IEN59  S LIST="BPSOSRX"
"RTN","BPSOSRB",9,0)
 I '$$LOCK^BPSOSRX("BACKGROUND",300) D  G FAIL
"RTN","BPSOSRB",10,0)
 . D LOG^BPSOSL("Failed to $$LOCK^BPSOSRX(""BACKGROUND"")")
"RTN","BPSOSRB",11,0)
 I $D(MOREDATA("DIALOUT")) S VADIAL=MOREDATA("DIALOUT") ;VA
"RTN","BPSOSRB",12,0)
 F TYPE="CLAIM","UNCLAIM" D
"RTN","BPSOSRB",13,0)
 . S RXI="" F  S RXI=$O(^BPSECP(LIST,TYPE,RXI)) Q:RXI=""  D
"RTN","BPSOSRB",14,0)
 . . S RXR="" F  S RXR=$O(^BPSECP(LIST,TYPE,RXI,RXR)) Q:RXR=""  D
"RTN","BPSOSRB",15,0)
 . . . N X S X=$$STATUS^BPSOSRX(RXI,RXR,0)
"RTN","BPSOSRB",16,0)
 . . . S IEN59=$$IEN59^BPSOSRX(RXI,RXR)
"RTN","BPSOSRB",17,0)
 . . . D LOG59^BPSOSL($T(+0)_" - Dequeuing.  Type is "_TYPE,IEN59)
"RTN","BPSOSRB",18,0)
 . . . I $P(X,U)="IN PROGRESS" D  Q
"RTN","BPSOSRB",19,0)
 . . . . D LOG59^BPSOSL($T(+0)_" - Status is 'IN PROGRESS'.  Will retry later.",IEN59)
"RTN","BPSOSRB",20,0)
 . . . N TIME,MOREDATA
"RTN","BPSOSRB",21,0)
 . . . S TIME=^BPSECP(LIST,TYPE,RXI,RXR) ; time requested
"RTN","BPSOSRB",22,0)
 . . . I '$$LOCK^BPSOSRX("SUBMIT",10) D  Q
"RTN","BPSOSRB",23,0)
 . . . . D LOG59^BPSOSL($T(+0)_" - Failed to $$LOCK^BPSOSRX(""SUBMIT"").  Will retry later.",IEN59)
"RTN","BPSOSRB",24,0)
 . . . I $D(^BPSECP(LIST,TYPE,RXI,RXR,"MOREDATA")) M MOREDATA=^("MOREDATA")
"RTN","BPSOSRB",25,0)
 . . . E  S MOREDATA=0
"RTN","BPSOSRB",26,0)
 . . . K ^BPSECP(LIST,TYPE,RXI,RXR)
"RTN","BPSOSRB",27,0)
 . . . D BACKGR1(TYPE,RXI,RXR,TIME,.MOREDATA)
"RTN","BPSOSRB",28,0)
 . . . D UNLOCK^BPSOSRX("SUBMIT")
"RTN","BPSOSRB",29,0)
 . . . I $P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1) D HANG  ;VA; don't hang for VA Rx's
"RTN","BPSOSRB",30,0)
FAIL D RELSLOT^BPSOSL
"RTN","BPSOSRB",31,0)
 D UNLOCK^BPSOSRX("BACKGROUND")
"RTN","BPSOSRB",32,0)
 Q
"RTN","BPSOSRB",33,0)
STARTTIM(RXI,RXR)  Q $P($G(^BPST($$IEN59(RXI,RXR),0)),U,11)
"RTN","BPSOSRB",34,0)
BACKGLOG(X) ;
"RTN","BPSOSRB",35,0)
 N MSG S MSG=RXI_","_RXR_" "_$S(TYPE="CLAIM":"",1:TYPE)_" "_X
"RTN","BPSOSRB",36,0)
 D LOG2SLOT^BPSOSL(MSG,BACKSLOT)
"RTN","BPSOSRB",37,0)
 Q
"RTN","BPSOSRB",38,0)
BACKGR1(TYPE,RXI,RXR,TIME,MOREDATA)        ;
"RTN","BPSOSRB",39,0)
 ; Resolve multiple requests
"RTN","BPSOSRB",40,0)
 N SKIP S SKIP=0 ; skip if you already got desired result
"RTN","BPSOSRB",41,0)
 N SKIPREAS
"RTN","BPSOSRB",42,0)
 N RESULT S RESULT=$$STATUS^BPSOSRX(RXI,RXR,0),RESULT=$P(RESULT,U)
"RTN","BPSOSRB",43,0)
 N STARTTIM S STARTTIM=$$STARTTIM(RXI,RXR)
"RTN","BPSOSRB",44,0)
 I TYPE="CLAIM" D
"RTN","BPSOSRB",45,0)
 . I $$RXDEL^BPSOS(RXI,RXR) D  Q
"RTN","BPSOSRB",46,0)
 . . S SKIP=1,SKIPREAS="Prescription is marked as DELETED or CANCELLED"
"RTN","BPSOSRB",47,0)
 . ; If it's never been through ECME before, good.
"RTN","BPSOSRB",48,0)
 . I RESULT="" Q
"RTN","BPSOSRB",49,0)
 . ; There's already a complete transaction for this RXI,RXR
"RTN","BPSOSRB",50,0)
 . ; (We screened out "IN PROGRESS" earlier)
"RTN","BPSOSRB",51,0)
 . ; The program to poll indexes would have set DO NOT RESUBMIT.
"RTN","BPSOSRB",52,0)
 . ; Calls from pharm pkg to ECME have '$D(MOREDATA("DO NOT RESUBMIT"))
"RTN","BPSOSRB",53,0)
 . I $D(MOREDATA("DO NOT RESUBMIT")) D
"RTN","BPSOSRB",54,0)
 . . S SKIP=1
"RTN","BPSOSRB",55,0)
 . . S SKIPREAS="MOREDATA(""DO NOT RESUBMIT"") is set"
"RTN","BPSOSRB",56,0)
 . E  I TIME<STARTTIM D  ; our request was made before trans. began
"RTN","BPSOSRB",57,0)
 . . ; submit claim but only if the prev result was successful reversal
"RTN","BPSOSRB",58,0)
 . . I RESULT="PAPER REVERSAL" Q
"RTN","BPSOSRB",59,0)
 . . I RESULT="E REVERSAL ACCEPTED" Q
"RTN","BPSOSRB",60,0)
 . . S SKIP=1
"RTN","BPSOSRB",61,0)
 . . S SKIPREAS="Prev result "_RESULT_"; claim started "_STARTTIM_">"_TIME_" submitted"
"RTN","BPSOSRB",62,0)
 . E  D  ; our request was made after it began
"RTN","BPSOSRB",63,0)
 . . ; So we will make a reversal if necessary,
"RTN","BPSOSRB",64,0)
 . . ; and then the claim will be resubmitted.
"RTN","BPSOSRB",65,0)
 . . I RESULT="E PAYABLE"!(RESULT="E DUPLICATE") D
"RTN","BPSOSRB",66,0)
 . . . S MOREDATA("REVERSE THEN RESUBMIT")=1
"RTN","BPSOSRB",67,0)
 E  I TYPE="UNCLAIM" D
"RTN","BPSOSRB",68,0)
 . ; It must have gone through ECME with a payable result
"RTN","BPSOSRB",69,0)
 . I RESULT="E PAYABLE" Q
"RTN","BPSOSRB",70,0)
 . I RESULT="E DUPLICATE" Q
"RTN","BPSOSRB",71,0)
 . N RXACTION S RXACTION=$G(MOREDATA("RX ACTION"))
"RTN","BPSOSRB",72,0)
 . I RESULT="E REVERSAL REJECTED",(",DE,EREV,RS,"[(","_RXACTION_",")) Q
"RTN","BPSOSRB",73,0)
 . I RESULT="E REVERSAL STRANDED",RXACTION="EREV" Q
"RTN","BPSOSRB",74,0)
 . S SKIP=1
"RTN","BPSOSRB",75,0)
 . S SKIPREAS="Cannot reverse - previous result was "_RESULT
"RTN","BPSOSRB",76,0)
 E  D IMPOSS^BPSOSUE("P","TI","bad arg TYPE="_TYPE,,"BACKGR1",$T(+0))
"RTN","BPSOSRB",77,0)
 I SKIP D  Q
"RTN","BPSOSRB",78,0)
 . D LOG59^BPSOSL($T(+0)_" - Skipping.  Reason: "_SKIPREAS,IEN59)
"RTN","BPSOSRB",79,0)
 I TYPE="UNCLAIM"!$G(MOREDATA("REVERSE THEN RESUBMIT")) D REVERSE
"RTN","BPSOSRB",80,0)
 E  D CLAIM(RXI,RXR,IEN59,.MOREDATA)
"RTN","BPSOSRB",81,0)
 Q
"RTN","BPSOSRB",82,0)
 ;
"RTN","BPSOSRB",83,0)
 ; Process claim request
"RTN","BPSOSRB",84,0)
 ; EP - Above and BPSOSU (for a resubmit after a reversal)
"RTN","BPSOSRB",85,0)
CLAIM(RXI,RXR,IEN59,MOREDATA) ;
"RTN","BPSOSRB",86,0)
 N ABSBRXI,ABSBRXR,ABSBNDC
"RTN","BPSOSRB",87,0)
 S (ABSBRXI,ABSBRXI(1))=RXI,(ABSBRXR,ABSBRXR(1))=RXR
"RTN","BPSOSRB",88,0)
 S ABSBNDC(1)=$$DEFNDC^BPSOSIV
"RTN","BPSOSRB",89,0)
 ;
"RTN","BPSOSRB",90,0)
 ; If MOREDATA("ORIGIN") is undefined, give it a "1" here.
"RTN","BPSOSRB",91,0)
 I '$D(MOREDATA("ORIGIN")) S MOREDATA("ORIGIN")=1
"RTN","BPSOSRB",92,0)
 D LOG59^BPSOSL($T(+0)_" - Initiating Claim",IEN59)
"RTN","BPSOSRB",93,0)
 D FILING^BPSOSIV(0,MOREDATA("ORIGIN"),.MOREDATA)  ;6/23/03 PASS MOREDATA FOR IB DATA FILING
"RTN","BPSOSRB",94,0)
 Q
"RTN","BPSOSRB",95,0)
 ; Process the reversal
"RTN","BPSOSRB",96,0)
 ; EP - Above 
"RTN","BPSOSRB",97,0)
REVERSE ;
"RTN","BPSOSRB",98,0)
 N IEN59 S IEN59=$$IEN59(RXI,RXR)
"RTN","BPSOSRB",99,0)
 N M S M=$T(+0)_" - Initiating Reversal"
"RTN","BPSOSRB",100,0)
 I $G(MOREDATA("REVERSE THEN RESUBMIT")) D
"RTN","BPSOSRB",101,0)
 . S M=M_" and after that, claim will be resubmitted"
"RTN","BPSOSRB",102,0)
 . N X,X1,X2
"RTN","BPSOSRB",103,0)
 . S X1=DT,X2=30 D C^%DTC
"RTN","BPSOSRB",104,0)
 . S ^XTMP("BPSOSRB",0)=X_U_DT_U_"PASS VARIABLES FOR RESUBMITS"
"RTN","BPSOSRB",105,0)
 . K ^XTMP("BPSOSRB","MOREDATA",IEN59)
"RTN","BPSOSRB",106,0)
 . M ^XTMP("BPSOSRB","MOREDATA",IEN59,"RESUB")=MOREDATA
"RTN","BPSOSRB",107,0)
 D LOG59^BPSOSL(M,IEN59)
"RTN","BPSOSRB",108,0)
 N RETVAL S RETVAL=$$REVERS59^BPSOS6D(IEN59,1)
"RTN","BPSOSRB",109,0)
 D LOG59^BPSOSL($T(+0)_" - Return Value from BPSOS6D: "_RETVAL,IEN59)
"RTN","BPSOSRB",110,0)
 ;
"RTN","BPSOSRB",111,0)
 ; Reset $T so the calling code does not fall through to the else
"RTN","BPSOSRB",112,0)
 I 1
"RTN","BPSOSRB",113,0)
 Q
"RTN","BPSOSRB",114,0)
LASTLOG ; tool for test - find and print most recent log file
"RTN","BPSOSRB",115,0)
 N X S X=999999999999
"RTN","BPSOSRB",116,0)
 F  S X=$O(^BPSECP("LOG",X),-1) Q:'X  Q:X#1=.4
"RTN","BPSOSRB",117,0)
 I 'X W "No log file found",! Q
"RTN","BPSOSRB",118,0)
 D PRINTLOG^BPSOSL(X)
"RTN","BPSOSRB",119,0)
 Q
"RTN","BPSOSRB",120,0)
HANG ; how long to hang before submitting the next claim?
"RTN","BPSOSRB",121,0)
 ; usually not at all (0 secs)
"RTN","BPSOSRB",122,0)
 ; but if there are an extraordinary # of claims in processing,
"RTN","BPSOSRB",123,0)
 ; then wait up a bit before letting anything else through
"RTN","BPSOSRB",124,0)
 ;
"RTN","BPSOSRB",125,0)
 ; FUTURE:  Have to make this smarter - make it aware of how many
"RTN","BPSOSRB",126,0)
 ; claims have been requested in, say, the past 1 minute as well.
"RTN","BPSOSRB",127,0)
 ; This would be to keep the backbilling from flooding taskman
"RTN","BPSOSRB",128,0)
 ; with excessive BPSOSQ1 and BPSOSQ2 jobs which have nothing to
"RTN","BPSOSRB",129,0)
 ; do.  That way, the BPSOSQ3 jobs would activate more quickly.
"RTN","BPSOSRB",130,0)
 ;
"RTN","BPSOSRB",131,0)
 ; I $H<some date H $R(10) ; put in this line if doing massive backbill
"RTN","BPSOSRB",132,0)
 I $R(50) Q  ; for efficiency - check only once every 50 claims
"RTN","BPSOSRB",133,0)
 N LOCK,MYDEST
"RTN","BPSOSRB",134,0)
HANGA ;
"RTN","BPSOSRB",135,0)
 I '$G(VARX) S VARX=0 S:$P($G(^BPS(9002313.99,1,"SITE TYPE")),"^",1)=0 VARX=1
"RTN","BPSOSRB",136,0)
 K MYDEST S LOCK=0 D FETSTAT^BPSOS2("MYDEST")
"RTN","BPSOSRB",137,0)
 N T,S S T=0 F S=0:10:90 S T=T+$G(MYDEST(S))
"RTN","BPSOSRB",138,0)
 I T<20 Q  ; not too many; that's fine
"RTN","BPSOSRB",139,0)
 I '$G(VARX) H 30 ; wait 30 secs and try again until things have settled down
"RTN","BPSOSRB",140,0)
 E  H 5
"RTN","BPSOSRB",141,0)
 G HANGA
"RTN","BPSOSRB",142,0)
IEN59(RXI,RXR)     Q $$IEN59^BPSOSRX(RXI,RXR)
"RTN","BPSOSRX")
0^235^B38664696
"RTN","BPSOSRX",1,0)
BPSOSRX ;BHAM ISC/FCS/DRS/FLS - callable from RPMS pharm ;06/01/2004
"RTN","BPSOSRX",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSRX",3,0)
 Q
"RTN","BPSOSRX",4,0)
 ;
"RTN","BPSOSRX",5,0)
 ; Also used by other BPSOSR* routines to find transactions
"RTN","BPSOSRX",6,0)
 ; that need to be submitted to ECME.
"RTN","BPSOSRX",7,0)
DOCU N I,X F I=0:1 S X=$T(DOCU1+I) Q:X["END OF DOCUMENTATION"  D
"RTN","BPSOSRX",8,0)
 . W $P(X,";",2,99),!
"RTN","BPSOSRX",9,0)
 Q
"RTN","BPSOSRX",10,0)
DOCU1 ; There are only four callable entry points!
"RTN","BPSOSRX",11,0)
 ; $$CLAIM^BPSOSRX     Submit a claim to ECME
"RTN","BPSOSRX",12,0)
 ; $$UNCLAIM^BPSOSRX   Reverse a previously submitted claim.   
"RTN","BPSOSRX",13,0)
 ; $$STATUS^BPSOSRX    Inquire about a claim's status
"RTN","BPSOSRX",14,0)
 ; SHOWQ^BPSOSRX       Display queue of claims to be processed
"RTN","BPSOSRX",15,0)
 ;
"RTN","BPSOSRX",16,0)
 ;  The RXI argument is required - a pointer to ^PSRX(*
"RTN","BPSOSRX",17,0)
 ;  The RXR argument is optional - a pointer to ^PSRX(RXI,1,*
"RTN","BPSOSRX",18,0)
 ;     If RXR is omitted, the first fill is assumed.
"RTN","BPSOSRX",19,0)
 ;  Should have MOREDATA("ORIGIN")
"RTN","BPSOSRX",20,0)
 ;     = undefined - if caller is RPMS Pharmacy package
"RTN","BPSOSRX",21,0)
 ;     = some assigned value - for all other callers
"RTN","BPSOSRX",22,0)
 ;
"RTN","BPSOSRX",23,0)
 ; = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = 
"RTN","BPSOSRX",24,0)
 ; $$CLAIM^BPSOSRX - Submit a claim to ECME
"RTN","BPSOSRX",25,0)
 ;
"RTN","BPSOSRX",26,0)
 ;    $$CLAIM^BPSOSRX(RXI,RXR,.MOREDATA)
"RTN","BPSOSRX",27,0)
 ;    Submit a claim to ECME
"RTN","BPSOSRX",28,0)
 ;    Use, for example, when a prescription is released.
"RTN","BPSOSRX",29,0)
 ;    All this does is to put it on a list and start a background job.
"RTN","BPSOSRX",30,0)
 ;    Return values:
"RTN","BPSOSRX",31,0)
 ;       1 = accepted for processing
"RTN","BPSOSRX",32,0)
 ;       0^reason = failure (should never happen)
"RTN","BPSOSRX",33,0)
 ;
"RTN","BPSOSRX",34,0)
 ;    Note:  If the claim has already been processed, and it's 
"RTN","BPSOSRX",35,0)
 ;       resubmitted, then a reversal will be done first,
"RTN","BPSOSRX",36,0)
 ;       and then the resubmit will be done.   Intervening calls
"RTN","BPSOSRX",37,0)
 ;       to $$STATUS may show progress of the reversal before
"RTN","BPSOSRX",38,0)
 ;       the resubmitted claim is processed.
"RTN","BPSOSRX",39,0)
 ; = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
"RTN","BPSOSRX",40,0)
 ; $$UNCLAIM^BPSOSRX - Reverse a previously submitted claim.   
"RTN","BPSOSRX",41,0)
 ;     Use, for example, if a prescription has been canceled.
"RTN","BPSOSRX",42,0)
 ;
"RTN","BPSOSRX",43,0)
 ;    $$UNCLAIM^BPSOSRX(RXI,RXR,.MOREDATA)
"RTN","BPSOSRX",44,0)
 ;     Return value = 1 = will submit request for reversal
"RTN","BPSOSRX",45,0)
 ;                  = 0^reason = failure (should never happen)
"RTN","BPSOSRX",46,0)
 ;
"RTN","BPSOSRX",47,0)
 ;     Note:  The reversal will actually be done ONLY if the
"RTN","BPSOSRX",48,0)
 ;     most recent processing of the claim resulted in something
"RTN","BPSOSRX",49,0)
 ;     reversible, namely E PAYABLE or E REVERSAL REJECTED
"RTN","BPSOSRX",50,0)
 ; = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =
"RTN","BPSOSRX",51,0)
 ; $$STATUS^BPSOSRX    inquire about a claim's status
"RTN","BPSOSRX",52,0)
 ;
"RTN","BPSOSRX",53,0)
 ;    $$STATUS^BPSOSRX(RXI,RXR,SDT,QUE)
"RTN","BPSOSRX",54,0)
 ;    Parameters
"RTN","BPSOSRX",55,0)
 ;       RXI and RXR describe above
"RTN","BPSOSRX",56,0)
 ;       QUE:  0/null - Do not check if a RX/fill is on the queue (opt)
"RTN","BPSOSRX",57,0)
 ;                  1 - Check if RX/fill is on the queue
"RTN","BPSOSRX",58,0)
 ;             
"RTN","BPSOSRX",59,0)
 ;    Returns     Result^Time^Description
"RTN","BPSOSRX",60,0)
 ;    Returns null  if there's no ECME record of this RXI,RXR.
"RTN","BPSOSRX",61,0)
 ;
"RTN","BPSOSRX",62,0)
 ;    Result is either:
"RTN","BPSOSRX",63,0)
 ;      1. IN PROGRESS for incomplete claims
"RTN","BPSOSRX",64,0)
 ;      2. Final status for complete claims.  See comments for 
"RTN","BPSOSRX",65,0)
 ;           BPSOSUC for complete list of possible statuses.
"RTN","BPSOSRX",66,0)
 ;
"RTN","BPSOSRX",67,0)
 ;    Time is the Fileman date and time of the last update
"RTN","BPSOSRX",68,0)
 ;      to the status of this claim.
"RTN","BPSOSRX",69,0)
 ;
"RTN","BPSOSRX",70,0)
 ;    Description:
"RTN","BPSOSRX",71,0)
 ;      For in Progress, it will be the status (i.e., Waiting to Start,
"RTN","BPSOSRX",72,0)
 ;        Transmitting)
"RTN","BPSOSRX",73,0)
 ;      For completed claims, it will be lists of current and prior
"RTN","BPSOSRX",74,0)
 ;        submission (For example, Payable[Previously: Payable].
"RTN","BPSOSRX",75,0)
 ;        Note that 'Payable' in this case really means submitted.
"RTN","BPSOSRX",76,0)
 ;        Note that E OTHER may have the reason that the ECME process
"RTN","BPSOSRX",77,0)
 ;          wa aborted
"RTN","BPSOSRX",78,0)
 ;
"RTN","BPSOSRX",79,0)
 ; = = = = = = = = END OF DOCUMENTATION = = = = = = = = =
"RTN","BPSOSRX",80,0)
 ; = = = Everything below this line is for internal use only
"RTN","BPSOSRX",81,0)
 ; = = = and subject to sudden unannounced changes!
"RTN","BPSOSRX",82,0)
 ; = = = Please don't call any of it directly, nor depend on
"RTN","BPSOSRX",83,0)
 ; = = = any of the techniques used.
"RTN","BPSOSRX",84,0)
 ; = = = = = = = = = = = = = = = = = = = = = = = = = = = =
"RTN","BPSOSRX",85,0)
CLAIM(RXI,RXR,MOREDATA)     ;
"RTN","BPSOSRX",86,0)
 N RETVAL,STAT,TYPE S TYPE="CLAIM"
"RTN","BPSOSRX",87,0)
 I '$D(RXR) S RXR=0
"RTN","BPSOSRX",88,0)
 I '$$LOCK("SUBMIT",5) Q 0
"RTN","BPSOSRX",89,0)
 K ^BPSECP($T(+0),TYPE,RXI,RXR)
"RTN","BPSOSRX",90,0)
 S ^BPSECP($T(+0),TYPE,RXI,RXR)=$$NOW
"RTN","BPSOSRX",91,0)
 I $D(MOREDATA) M ^BPSECP($T(+0),TYPE,RXI,RXR,"MOREDATA")=MOREDATA
"RTN","BPSOSRX",92,0)
 N X,X1,X2
"RTN","BPSOSRX",93,0)
 S X1=DT,X2=30 D C^%DTC
"RTN","BPSOSRX",94,0)
 S ^XTMP("BPSOSRX",0)=X_U_DT_U_"ECME SUBMIT DATE FOR A RX AND FILL"
"RTN","BPSOSRX",95,0)
 S ^XTMP("BPSOSRX",RXI,RXR)=$$NOW
"RTN","BPSOSRX",96,0)
 D UNLOCK("SUBMIT")
"RTN","BPSOSRX",97,0)
 D RUNNING()
"RTN","BPSOSRX",98,0)
 S RETVAL=1
"RTN","BPSOSRX",99,0)
 Q RETVAL
"RTN","BPSOSRX",100,0)
 ;
"RTN","BPSOSRX",101,0)
UNCLAIM(RXI,RXR,MOREDATA) ;
"RTN","BPSOSRX",102,0)
 N RETVAL,STAT,RESULT,TYPE S TYPE="UNCLAIM"
"RTN","BPSOSRX",103,0)
 I '$D(RXR) S RXR=0
"RTN","BPSOSRX",104,0)
 I '$$LOCK("SUBMIT",5) Q 0
"RTN","BPSOSRX",105,0)
 K ^BPSECP($T(+0),TYPE,RXI,RXR)
"RTN","BPSOSRX",106,0)
 S ^BPSECP($T(+0),TYPE,RXI,RXR)=$$NOW
"RTN","BPSOSRX",107,0)
 I $D(MOREDATA) M ^BPSECP($T(+0),TYPE,RXI,RXR,"MOREDATA")=MOREDATA
"RTN","BPSOSRX",108,0)
 N X,X1,X2
"RTN","BPSOSRX",109,0)
 S X1=DT,X2=30 D C^%DTC
"RTN","BPSOSRX",110,0)
 S ^XTMP("BPSOSRX",0)=X_U_DT_U_"ECME SUBMIT DATE FOR A RX AND FILL"
"RTN","BPSOSRX",111,0)
 S ^XTMP("BPSOSRX",RXI,RXR)=$$NOW
"RTN","BPSOSRX",112,0)
 D UNLOCK("SUBMIT")
"RTN","BPSOSRX",113,0)
 D RUNNING()
"RTN","BPSOSRX",114,0)
 S RETVAL=1
"RTN","BPSOSRX",115,0)
 Q RETVAL
"RTN","BPSOSRX",116,0)
 ;
"RTN","BPSOSRX",117,0)
 ; STATUS - Returns the current status of a RX/Fill
"RTN","BPSOSRX",118,0)
 ;   For more information, see the top of this routine
"RTN","BPSOSRX",119,0)
STATUS(RXI,RXR,QUE) ;
"RTN","BPSOSRX",120,0)
 ;
"RTN","BPSOSRX",121,0)
 ; Set needed variables
"RTN","BPSOSRX",122,0)
 N IEN59,SDT,A
"RTN","BPSOSRX",123,0)
 I '$G(RXI) Q ""
"RTN","BPSOSRX",124,0)
 I $G(RXR)="" Q ""
"RTN","BPSOSRX",125,0)
 I $G(QUE)="" S QUE=1
"RTN","BPSOSRX",126,0)
 S IEN59=$$IEN59(RXI,RXR)
"RTN","BPSOSRX",127,0)
 S SDT=$G(^XTMP("BPSOSRX",RXI,RXR))
"RTN","BPSOSRX",128,0)
 ;
"RTN","BPSOSRX",129,0)
 ; ECME record not created
"RTN","BPSOSRX",130,0)
 I '$D(^BPST(IEN59)) D  Q A
"RTN","BPSOSRX",131,0)
 . I QUE,SDT S A="IN PROGRESS"_U_SDT_U_$$STATI^BPSOSU(0)_U_-1 Q
"RTN","BPSOSRX",132,0)
 . I QUE,$D(^BPSECP("BPSOSRX","CLAIM",RXI,RXR)) S A="IN PROGRESS"_U_SDT_U_$$STATI^BPSOSU(0)_U_-1 Q
"RTN","BPSOSRX",133,0)
 . S A=""
"RTN","BPSOSRX",134,0)
 ;
"RTN","BPSOSRX",135,0)
 ; Loop: Get data, quit if times and status match (no change during gather)
"RTN","BPSOSRX",136,0)
 N C,T1,T2,S1,S2 F  D  I T1=T2,S1=S2 Q
"RTN","BPSOSRX",137,0)
 . S T1=$$LASTUP59(RXI,RXR)
"RTN","BPSOSRX",138,0)
 . S S1=$$STATUS59(RXI,RXR)
"RTN","BPSOSRX",139,0)
 . I S1=99 D  ; completed
"RTN","BPSOSRX",140,0)
 . . S A=$$RESULT59(RXI,RXR)
"RTN","BPSOSRX",141,0)
 . . S C=$$RESTXT59(RXI,RXR)
"RTN","BPSOSRX",142,0)
 . I S1'=99 D
"RTN","BPSOSRX",143,0)
 . . S A="IN PROGRESS"
"RTN","BPSOSRX",144,0)
 . . S C=$$STATI^BPSOSU(S1)
"RTN","BPSOSRX",145,0)
 . S T2=$$LASTUP59(RXI,RXR)
"RTN","BPSOSRX",146,0)
 . S S2=$$STATUS59(RXI,RXR)
"RTN","BPSOSRX",147,0)
 ;
"RTN","BPSOSRX",148,0)
 ; If the queue parameter is set and the submit date follows the LAST UPDATE date or the
"RTN","BPSOSRX",149,0)
 ;   RX/fill is on the queue, then change the response to IN PROGRESS^Submit Date^WAITING TO START 
"RTN","BPSOSRX",150,0)
 I $G(QUE),SDT>T1!($D(^BPSECP("BPSOSRX","CLAIM",RXI,RXR))) S A="IN PROGRESS",T1=SDT,S1=-1,C=$$STATI^BPSOSU(0)
"RTN","BPSOSRX",151,0)
 ;
"RTN","BPSOSRX",152,0)
 ; When finishing the reversal of a Reversal/Resubmit, display IN PROGRESS
"RTN","BPSOSRX",153,0)
 I $P($G(^BPST(IEN59,1)),"^",12)=1,S1=99 S A="IN PROGRESS",S1=98,C=$$STATI^BPSOSU(S1)
"RTN","BPSOSRX",154,0)
 ;
"RTN","BPSOSRX",155,0)
 ; Return results
"RTN","BPSOSRX",156,0)
 Q A_U_T1_U_$E(C,1,255-$L(A)-$L(T1)-2)_U_S1
"RTN","BPSOSRX",157,0)
SHOWQ G SHOWQ^BPSOSR2
"RTN","BPSOSRX",158,0)
 ;
"RTN","BPSOSRX",159,0)
 ;    $$EDCLAIM(RXI,RXR,MOREDATA)
"RTN","BPSOSRX",160,0)
 ;    Invoke the ECME data input screen for this
"RTN","BPSOSRX",161,0)
 ;    prescription and fill.  Use this if you want the opportunity
"RTN","BPSOSRX",162,0)
 ;    to edit the claim data - for example, pre-authorization numbers,
"RTN","BPSOSRX",163,0)
 ;    price overrides, insurance order of billing, etc. 
"RTN","BPSOSRX",164,0)
 ;    The data entry screen is invoked.  The claim can be submitted
"RTN","BPSOSRX",165,0)
 ;    or not, at the user's option, by using Screenman <PF1>E or <PF1>Q
"RTN","BPSOSRX",166,0)
 ;
"RTN","BPSOSRX",167,0)
EDCLAIM(RXI,RXR,MOREDATA)    ;
"RTN","BPSOSRX",168,0)
 I 1 D IMPOSS^BPSOSUE("P","TI","entry point not available in this release",$P($T(+2),";",3),"EDCLAIM",$T(+0)) Q
"RTN","BPSOSRX",169,0)
 ; for devel & testing, change above to I 0 and add to code below
"RTN","BPSOSRX",170,0)
 N RETVAL S RETVAL=1
"RTN","BPSOSRX",171,0)
 D LOCK
"RTN","BPSOSRX",172,0)
 D UNLOCK
"RTN","BPSOSRX",173,0)
 Q RETVAL
"RTN","BPSOSRX",174,0)
 ;    
"RTN","BPSOSRX",175,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSRX",176,0)
 ; $$RESULT59 returns result of a finished claim in .59
"RTN","BPSOSRX",177,0)
 ; Can send RXI and have RXR defaulted
"RTN","BPSOSRX",178,0)
 ;  PAPER or E PAYABLE or E REJECTED or E CAPTURED or E DUPLICATE
"RTN","BPSOSRX",179,0)
 ;  or E OTHER (should never happen)
"RTN","BPSOSRX",180,0)
 ;  or PAPER REVERSAL or E REVERSAL ACCEPTED or E REVERSAL REJECTED
"RTN","BPSOSRX",181,0)
RESULT59(RXI,RXR) ;EP - BPSOS6D ;  result as defined in CATEG^BPSOSUC
"RTN","BPSOSRX",182,0)
 N IEN59 I RXI["." S IEN59=RXI
"RTN","BPSOSRX",183,0)
 E  S:'$D(RXR) RXR=$$RXRDEF(RXI) S IEN59=$$IEN59(RXI,RXR)
"RTN","BPSOSRX",184,0)
 Q $$CATEG^BPSOSUC(IEN59)
"RTN","BPSOSRX",185,0)
RESTXT59(RXI,RXR)  ; result text
"RTN","BPSOSRX",186,0)
 N IEN59 I RXI["." S IEN59=RXI
"RTN","BPSOSRX",187,0)
 E  S:'$D(RXR) RXR=$$RXRDEF(RXI) S IEN59=$$IEN59(RXI,RXR)
"RTN","BPSOSRX",188,0)
 Q $P($G(^BPST(IEN59,2)),U,2)
"RTN","BPSOSRX",189,0)
LASTUP59(RXI,RXR) ;EP - BPSOSR1;  time of last update
"RTN","BPSOSRX",190,0)
 N IEN59 I RXI["." S IEN59=RXI
"RTN","BPSOSRX",191,0)
 E  S:'$D(RXR) RXR=$$RXRDEF(RXI) S IEN59=$$IEN59(RXI,RXR)
"RTN","BPSOSRX",192,0)
 Q $P(^BPST(IEN59,0),U,8)
"RTN","BPSOSRX",193,0)
 ;
"RTN","BPSOSRX",194,0)
RXRDEF(RXI) ;EP - BPSOSNC
"RTN","BPSOSRX",195,0)
 Q +$P($G(^PSRX(RXI,1,0)),U,3) ; highest refill #
"RTN","BPSOSRX",196,0)
 ;
"RTN","BPSOSRX",197,0)
 ;
"RTN","BPSOSRX",198,0)
 ; Utilties
"RTN","BPSOSRX",199,0)
 ;
"RTN","BPSOSRX",200,0)
 ;  LOCKING:  Just one user of this routine at a time.
"RTN","BPSOSRX",201,0)
 ;  X = "SUBMIT" to interlock the claim submission
"RTN","BPSOSRX",202,0)
 ;  X = "BACKGROUND" to interlock the background job
"RTN","BPSOSRX",203,0)
LOCK(X,TIMEOUT) ;EP - BPSOSRB
"RTN","BPSOSRX",204,0)
 I $G(TIMEOUT)="" S TIMEOUT=0
"RTN","BPSOSRX",205,0)
 L +^BPSECP($T(+0),X):TIMEOUT Q $T
"RTN","BPSOSRX",206,0)
LOCKNOW(X) ;EP - BPSOSRB
"RTN","BPSOSRX",207,0)
 L +^BPSECP($T(+0),X):0 Q $T
"RTN","BPSOSRX",208,0)
UNLOCK(X) ;EP - BPSOSRB
"RTN","BPSOSRX",209,0)
 L -^BPSECP($T(+0),X) Q
"RTN","BPSOSRX",210,0)
LOCK59() L +^BPST:300 Q $T
"RTN","BPSOSRX",211,0)
UNLOCK59 L -^BPST Q
"RTN","BPSOSRX",212,0)
 ;
"RTN","BPSOSRX",213,0)
RUNNING()          ;
"RTN","BPSOSRX",214,0)
 I '$$LOCKNOW("BACKGROUND") Q  ; it is running; don't start another
"RTN","BPSOSRX",215,0)
 D UNLOCK("BACKGROUND") ; it's not running; release our probing lock
"RTN","BPSOSRX",216,0)
 D TASK
"RTN","BPSOSRX",217,0)
 Q
"RTN","BPSOSRX",218,0)
IEN59(RXI,RXR) ;EP - from BPSOS,BPSOSNC,BPSOSRB
"RTN","BPSOSRX",219,0)
 Q RXI_"."_$TR($J(RXR,4)," ","0")_"1"
"RTN","BPSOSRX",220,0)
 ; 
"RTN","BPSOSRX",221,0)
 ; $$STATUS59 returns processing status from .59 record
"RTN","BPSOSRX",222,0)
 ; "" if there's no such claim    note: 99 means complete
"RTN","BPSOSRX",223,0)
STATUS59(RXI,RXR) ;
"RTN","BPSOSRX",224,0)
 N IEN59,STAT
"RTN","BPSOSRX",225,0)
 I RXI["." S IEN59=RXI
"RTN","BPSOSRX",226,0)
 E  S:'$D(RXR) RXR=$$RXRDEF(RXI) S IEN59=$$IEN59(RXI,RXR)
"RTN","BPSOSRX",227,0)
 S STAT=$P($G(^BPST(IEN59,0)),U,2)
"RTN","BPSOSRX",228,0)
 Q STAT
"RTN","BPSOSRX",229,0)
 ; 
"RTN","BPSOSRX",230,0)
 ; The background job
"RTN","BPSOSRX",231,0)
 ;
"RTN","BPSOSRX",232,0)
TASK N X,Y,%DT S X="N",%DT="ST" D ^%DT D TASKAT(Y) Q
"RTN","BPSOSRX",233,0)
TASKAT(ZTDTH)      ;
"RTN","BPSOSRX",234,0)
 N ZTIO S ZTIO="" ; no device
"RTN","BPSOSRX",235,0)
 N ZTRTN S ZTRTN="BACKGR^BPSOSRB" D ^%ZTLOAD Q
"RTN","BPSOSRX",236,0)
LASTLOG ; tool for test - find and print most recent log file
"RTN","BPSOSRX",237,0)
 N X S X=999999999999
"RTN","BPSOSRX",238,0)
 F  S X=$O(^BPSECP("LOG",X),-1) Q:'X  Q:X#1=.4
"RTN","BPSOSRX",239,0)
 I 'X W "No log file found",! Q
"RTN","BPSOSRX",240,0)
 D PRINTLOG^BPSOSL(X)
"RTN","BPSOSRX",241,0)
 Q
"RTN","BPSOSS2")
0^238^B5046028
"RTN","BPSOSS2",1,0)
BPSOSS2 ;BHAM ISC/FCS/DRS/FLS - ^BPSEI printout,utils ;06/01/2004
"RTN","BPSOSS2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSS2",3,0)
 Q
"RTN","BPSOSS2",4,0)
INUSE ;EP - BPSOSS1
"RTN","BPSOSS2",5,0)
 D TEMPLATE("BPS INSURERS")
"RTN","BPSOSS2",6,0)
 Q
"RTN","BPSOSS2",7,0)
ANY(TYPE) ;EP - BPSOSS1
"RTN","BPSOSS2",8,0)
 ; are there any records of relevance to be printed out?
"RTN","BPSOSS2",9,0)
 ; We want to avoid a whole page that says only "No records to print"
"RTN","BPSOSS2",10,0)
 I $D(ANY(TYPE)) Q ANY(TYPE) ; already figured this one out
"RTN","BPSOSS2",11,0)
 N FILE,FIELD,COND,IEN,IENS,RETVAL,X
"RTN","BPSOSS2",12,0)
 I TYPE="GRACE" S FILE=9002313.4,FIELD=100.08,COND="X]"""""
"RTN","BPSOSS2",13,0)
 E  I TYPE="PREBILL"!(TYPE="NCPDP")!(TYPE="UN/BILLABLE") D
"RTN","BPSOSS2",14,0)
 . S FILE=9002313.4,COND="X=1"
"RTN","BPSOSS2",15,0)
 . I TYPE="PREBILL" S FIELD=105.99
"RTN","BPSOSS2",16,0)
 . E  I TYPE="NCPDP" S FIELD=100.99
"RTN","BPSOSS2",17,0)
 . E  I TYPE="UN/BILLABLE" S FIELD=2128.99
"RTN","BPSOSS2",18,0)
 . E  N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("P","TI",9002313.4,,,$T(+0))
"RTN","BPSOSS2",19,0)
 . S COND="X=1"
"RTN","BPSOSS2",20,0)
 E  I TYPE="USERS" D
"RTN","BPSOSS2",21,0)
 . S FILE=9002313.7,FIELD=.01,COND="X]"""""
"RTN","BPSOSS2",22,0)
 E  I TYPE="WCOMP" D
"RTN","BPSOSS2",23,0)
 . S FILE=9002313.4,FIELD=107.01,COND="X]"""""
"RTN","BPSOSS2",24,0)
 E  N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("P","TI","Bad TYPE="_TYPE,,"ANY",$T(+0)) Q
"RTN","BPSOSS2",25,0)
 ; Look for any record in 9002313.4 which meets condition
"RTN","BPSOSS2",26,0)
 S (IEN,RETVAL)=0
"RTN","BPSOSS2",27,0)
 I '$D(FILE) S FILE=9002313.4
"RTN","BPSOSS2",28,0)
 F  S IEN=$$NEXT(IEN) Q:'IEN  D  Q:RETVAL
"RTN","BPSOSS2",29,0)
 . N MSG
"RTN","BPSOSS2",30,0)
 . ;S IENS=IEN_","
"RTN","BPSOSS2",31,0)
 . S X=$$GET1^DIQ(FILE,IEN,FIELD,"E",,"MSG")
"RTN","BPSOSS2",32,0)
 . I $D(MSG) D  S RETVAL=-1 Q
"RTN","BPSOSS2",33,0)
 . . D ZWRITE^BPSOS("FILE","IENS","FIELD","MSG")
"RTN","BPSOSS2",34,0)
 . . N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("FM","TI","$$GET1^DIQ failed",,"ANY",$T(+0))
"RTN","BPSOSS2",35,0)
 . S RETVAL=(X'="")
"RTN","BPSOSS2",36,0)
 Q RETVAL
"RTN","BPSOSS2",37,0)
NEXT(IEN)          ;
"RTN","BPSOSS2",38,0)
 I FILE=9002313.4 Q $O(^BPSEI(IEN))
"RTN","BPSOSS2",39,0)
 ; This FILE\1=9002313 trick won't work for every 9002313 file
"RTN","BPSOSS2",40,0)
 I FILE\1=9002313 Q $O(^BPS(FILE,IEN))
"RTN","BPSOSS2",41,0)
 N RETVAL S RETVAL=$$IMPOSS^BPSOSUE("P","TI","Bad value for FILE="_FILE,,"NEXT",$T(+0))
"RTN","BPSOSS2",42,0)
 Q ""
"RTN","BPSOSS2",43,0)
TEMPLATE(TEMPLATE,FILE,PRINTTEM) ;EP - from BPSOSS*
"RTN","BPSOSS2",44,0)
 N L,DIC,FLDS,BY,FR,TO,DIASKHD,DIPCRIT,PG,DHIT,DIOEND
"RTN","BPSOSS2",45,0)
 N DCOPIES,IOP,DQTIME,DIS,DISUPNO,DISTOP,DISPAR
"RTN","BPSOSS2",46,0)
 S L="",DIC=$S($D(FILE):FILE,1:9002313.4)
"RTN","BPSOSS2",47,0)
 I $D(TEMPLATE) D
"RTN","BPSOSS2",48,0)
 . S BY=TEMPLATE
"RTN","BPSOSS2",49,0)
 . S:'$D(PRINTTEM) PRINTTEM=TEMPLATE
"RTN","BPSOSS2",50,0)
 S BY="["_BY_"]",FLDS="["_PRINTTEM_"]"
"RTN","BPSOSS2",51,0)
 S (FR,TO)=""
"RTN","BPSOSS2",52,0)
 D EN1^DIP
"RTN","BPSOSS2",53,0)
 W !
"RTN","BPSOSS2",54,0)
 Q
"RTN","BPSOSS3")
0^239^B846798
"RTN","BPSOSS3",1,0)
BPSOSS3 ;BHAM ISC/FCS/DRS/FLS - file 9002313.53 - Pricing tables ;06/01/2004
"RTN","BPSOSS3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSS3",3,0)
 Q
"RTN","BPSOSS3",4,0)
BPSOSS1 ;EP - BPSOSS1
"RTN","BPSOSS3",5,0)
 D TEMPLATE^BPSOSS2("BPS PRICING TABLES",9002313.53)
"RTN","BPSOSS3",6,0)
 Q
"RTN","BPSOSS3",7,0)
INDEX ; which pricing tables are in use by which insurers?
"RTN","BPSOSS3",8,0)
 W "Index - Pricing tables used by which insurers",!
"RTN","BPSOSS3",9,0)
 ; incomplete
"RTN","BPSOSS3",10,0)
 ; ^BPSEI("APricing",pricing table,insurer)
"RTN","BPSOSS3",11,0)
 Q
"RTN","BPSOSS3",12,0)
ASK ;EP - BPSOSQP
"RTN","BPSOSS3",13,0)
 I $$YESNO^BPSOSS8("Do you want to see a report of the pricing formulas you have set up now") D BPSOSS1
"RTN","BPSOSS3",14,0)
 Q
"RTN","BPSOSS6")
0^242^B267529
"RTN","BPSOSS6",1,0)
BPSOSS6 ;BHAM ISC/FCS/DRS/FLS - file 9002313.515 - user settings ;06/01/2004
"RTN","BPSOSS6",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSS6",3,0)
 Q
"RTN","BPSOSS6",4,0)
BPSOSS1 ;EP - BPSOSS1
"RTN","BPSOSS6",5,0)
 D TEMPLATE^BPSOSS2("BPS USER PROF",9002313.7)
"RTN","BPSOSS6",6,0)
 Q
"RTN","BPSOSS6",7,0)
PHARMACY ;EP - BPSOSS1
"RTN","BPSOSS6",8,0)
 D TEMPLATE^BPSOSS2("BPS SETUP PHARMACIES",9002313.56,"CAPTIONED")
"RTN","BPSOSS6",9,0)
 Q
"RTN","BPSOSS7")
1^243
"RTN","BPSOSS8")
0^244^B20417515
"RTN","BPSOSS8",1,0)
BPSOSS8 ;BHAM ISC/FCS/DRS/FLS - option BPS SETUP PART 1 the basic setup ;06/01/2004
"RTN","BPSOSS8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSS8",3,0)
 Q
"RTN","BPSOSS8",4,0)
PART1 ;EP - option BPS SETUP PART 1 - the basic setup
"RTN","BPSOSS8",5,0)
 W !!,"Edit Pharmacy ECME configuration",!
"RTN","BPSOSS8",6,0)
 D NEW99
"RTN","BPSOSS8",7,0)
 N DIE,DA,DR,DIDEL,DTOUT
"RTN","BPSOSS8",8,0)
 S DIE=9002313.99,DA=1
"RTN","BPSOSS8",9,0)
 S DR="3.01R~ECME timeout? (0 to 30 seconds) //10"
"RTN","BPSOSS8",10,0)
 D ^DIE
"RTN","BPSOSS8",11,0)
 Q  ; Vista OP Pharmacy handles pricing in the IB module
"RTN","BPSOSS8",12,0)
 ;
"RTN","BPSOSS8",13,0)
 W !!,"Now set up the STANDARD Pricing Formula.  (Different pricing",!
"RTN","BPSOSS8",14,0)
 W "policies for different insurers can be established later.)",!
"RTN","BPSOSS8",15,0)
 S DIE=9002313.53,DA=1
"RTN","BPSOSS8",16,0)
 S DR=".02R~Where do we find the UNIT PRICE of a drug?"
"RTN","BPSOSS8",17,0)
 S DR=DR_";.04R~Multiply the unit price by what factor (1 = 100%, .95 = 95%, etc.) ?"
"RTN","BPSOSS8",18,0)
 S DR=DR_";.05R~What is the default DISPENSING FEE?"
"RTN","BPSOSS8",19,0)
 D ^DIE
"RTN","BPSOSS8",20,0)
 Q
"RTN","BPSOSS8",21,0)
NEW99 ; create new entry in 9002313.99
"RTN","BPSOSS8",22,0)
 Q:$P($G(^BPS(9002313.99,1,0)),U)]""  ; already has an entry
"RTN","BPSOSS8",23,0)
 N FDA,IEN,MSG
"RTN","BPSOSS8",24,0)
 S FDA(9002313.99,"+1,",.01)="ECME SETUP"
"RTN","BPSOSS8",25,0)
 S FDA(9002313.99,"+1,",951)=30 ; insurance grace period default
"RTN","BPSOSS8",26,0)
N99A D UPDATE^DIE("","FDA","IEN","MSG")
"RTN","BPSOSS8",27,0)
 I '$D(MSG),IEN(1)=1,$D(^BPS(9002313.99,1,0)) D  Q  ; success
"RTN","BPSOSS8",28,0)
 . ; Insurance base scores - default to Private primary,
"RTN","BPSOSS8",29,0)
 . ; Medicaid secondary, Medicare tertiary, No insurance last
"RTN","BPSOSS8",30,0)
 . S ^BPS(9002313.99,1,"INS BASE SCORES")="900^300^600^300^100"
"RTN","BPSOSS8",31,0)
 ; Failure:
"RTN","BPSOSS8",32,0)
 D ZWRITE^BPSOS("FDA","IEN","MSG")
"RTN","BPSOSS8",33,0)
 G N99A:$$IMPOSS^BPSOSUE("FM","TRI","UPDATE^DIE failed",,"N99A",$T(+0))
"RTN","BPSOSS8",34,0)
 Q
"RTN","BPSOSS8",35,0)
INS ;EP - option BPS INSURANCE SEL
"RTN","BPSOSS8",36,0)
 N DIE,DA,DR,DIDEL,DTOUT
"RTN","BPSOSS8",37,0)
 S DIE=9002313.99,DA=1
"RTN","BPSOSS8",38,0)
 W !!,"The insurance selection ""grace period"" means that if the",!
"RTN","BPSOSS8",39,0)
 W "registration data shows that insurance has expired, but the",!
"RTN","BPSOSS8",40,0)
 W "expiration was within N days prior to the prescription fill",!
"RTN","BPSOSS8",41,0)
 W "date, we assume that the coverage was renewed.",!
"RTN","BPSOSS8",42,0)
 W "This is a system-wide default setting; you can override it later",!
"RTN","BPSOSS8",43,0)
 W "on an insurer-by-insurer basis.",!
"RTN","BPSOSS8",44,0)
 S DR="951Grace period default"
"RTN","BPSOSS8",45,0)
 D ^DIE
"RTN","BPSOSS8",46,0)
 ;
"RTN","BPSOSS8",47,0)
 W !!,"Enter the base scores for each insurance type.",!
"RTN","BPSOSS8",48,0)
 W !,"For example, if Private insurance is usually primary,",!
"RTN","BPSOSS8",49,0)
 W ?10,"and Medicaid is secondary and Medicare is tertiary",!
"RTN","BPSOSS8",50,0)
 W "then you might give Private 900 points, Medicaid 600 points,",!
"RTN","BPSOSS8",51,0)
 W "Medicare and Railroad each 300 points and Self pay 100 points.",!
"RTN","BPSOSS8",52,0)
 W !
"RTN","BPSOSS8",53,0)
 S DR="960.01;960.03;960.02;960.04;960.05"
"RTN","BPSOSS8",54,0)
 D ^DIE
"RTN","BPSOSS8",55,0)
 ;
"RTN","BPSOSS8",56,0)
 N ALLRULES,MYRULES
"RTN","BPSOSS8",57,0)
11 S (ALLRULES,MYRULES)=0 ; have we printed them yet?
"RTN","BPSOSS8",58,0)
10 W !!,"Select any additional insurance rules that might",!
"RTN","BPSOSS8",59,0)
 W "be needed for distinguishing among private insurances.",!
"RTN","BPSOSS8",60,0)
 I 'ALLRULES,$$ALLRULES D  G 10
"RTN","BPSOSS8",61,0)
 . D TEMPLATE^BPSOSS2("BPS INSURANCE RULES AVAIL",9002313.94)
"RTN","BPSOSS8",62,0)
 . S ALLRULES=1
"RTN","BPSOSS8",63,0)
 I 'MYRULES,$$MYRULES D RPTINUSE S MYRULES=1 G 10
"RTN","BPSOSS8",64,0)
 W !,"Usually, the plus points value for a rule is about 10 or 20",!
"RTN","BPSOSS8",65,0)
 W "and the minus points value is 0."
"RTN","BPSOSS8",66,0)
 W "If you need a new rule which isn't shown in the list,",!
"RTN","BPSOSS8",67,0)
 W "the ECME programmer will have to add it.",!
"RTN","BPSOSS8",68,0)
 W "The INS RULE ORDER tells what order the rules are applied,",!
"RTN","BPSOSS8",69,0)
 W "from low to high.  10, 20, 30, etc. are good choices for ORDER.",!
"RTN","BPSOSS8",70,0)
 S DIE=9002313.99,DR=970.01,DA=1
"RTN","BPSOSS8",71,0)
 D ^DIE
"RTN","BPSOSS8",72,0)
 I $$ANYINUSE I $$MYRULES D RPTINUSE
"RTN","BPSOSS8",73,0)
 I $$MOREEDIT G 11
"RTN","BPSOSS8",74,0)
 ;
"RTN","BPSOSS8",75,0)
 W !!,"This concludes the system-wide insurance setup.",!
"RTN","BPSOSS8",76,0)
 W "Remember, there is another setup program to setup specific",!
"RTN","BPSOSS8",77,0)
 W "insurers with their electronic formats, insurance selection",!
"RTN","BPSOSS8",78,0)
 W "settings, grace period override, etc.",!
"RTN","BPSOSS8",79,0)
 N % R %:10,!
"RTN","BPSOSS8",80,0)
 Q
"RTN","BPSOSS8",81,0)
ANYINUSE() ;EP - BPSOSS1
"RTN","BPSOSS8",82,0)
 Q $O(^BPS(9002313.99,1,"INS RULES",0))
"RTN","BPSOSS8",83,0)
RPTINUSE ;EP - BPSOSS1
"RTN","BPSOSS8",84,0)
 D TEMPLATE^BPSOSS2("BPS INSURANCE RULES IN-USE",9002313.99) Q
"RTN","BPSOSS8",85,0)
ALLRULES()         Q $$YESNO("Do you want to see a list of all the AVAILABLE rules")
"RTN","BPSOSS8",86,0)
MYRULES()          Q $$YESNO("Do you want to see a list of the rules that are IN USE now")
"RTN","BPSOSS8",87,0)
MOREEDIT()         Q $$YESNO("Do you want to go back and edit the rules again")
"RTN","BPSOSS8",88,0)
YESNO(TEXT) ;EP - BPSOSS3
"RTN","BPSOSS8",89,0)
 Q $$YESNO^BPSOSU3(TEXT,"NO",1,60)=1
"RTN","BPSOSS9")
0^245^B1037255
"RTN","BPSOSS9",1,0)
BPSOSS9 ;BHAM ISC/FCS/DRS/FLS - ANY CRITICAL MISSING ITEMS ;06/01/2004
"RTN","BPSOSS9",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSS9",3,0)
 ;External reference private DBIA 4303
"RTN","BPSOSS9",4,0)
 ; Make sure that ECME has all the necessary data in place.
"RTN","BPSOSS9",5,0)
 ; * incomplete *  much more to be added
"RTN","BPSOSS9",6,0)
 Q
"RTN","BPSOSS9",7,0)
REPORT ;EP
"RTN","BPSOSS9",8,0)
 N RETVAL
"RTN","BPSOSS9",9,0)
 I '$$OPSITE(0) D
"RTN","BPSOSS9",10,0)
 . D PROBLEM
"RTN","BPSOSS9",11,0)
 . W "Not all OUTPATIENT SITEs are associated with a pharmacy.",!
"RTN","BPSOSS9",12,0)
 . S RETVAL=$$OPSITE(1)
"RTN","BPSOSS9",13,0)
 Q
"RTN","BPSOSS9",14,0)
OPSITE(ECHO) ; is every outpatient site associated with a pharmacy?
"RTN","BPSOSS9",15,0)
 N RET S RET=1
"RTN","BPSOSS9",16,0)
 N A S A=0 F  S A=$O(^PS(59,A)) Q:'A  D
"RTN","BPSOSS9",17,0)
 . I ECHO W "`",A," ",$P(^PS(59,A,0),U)," <--> "
"RTN","BPSOSS9",18,0)
 . N P S P=$O(^BPS(9002313.56,"C",A,0))
"RTN","BPSOSS9",19,0)
 . I P D
"RTN","BPSOSS9",20,0)
 . . I ECHO W $P(^BPS(9002313.56,P,0),U),!
"RTN","BPSOSS9",21,0)
 . E  D
"RTN","BPSOSS9",22,0)
 . . S RET=0
"RTN","BPSOSS9",23,0)
 . . I ECHO W "** no associated ECME pharmacy!! **",!
"RTN","BPSOSS9",24,0)
 Q RET
"RTN","BPSOSS9",25,0)
PROBLEM W !,"***  PROBLEM FOUND:",! Q
"RTN","BPSOSSG")
0^247^B54258180
"RTN","BPSOSSG",1,0)
BPSOSSG ;BHAM ISC/SD/lwj/FLS - Special gets for formats ;06/01/2004
"RTN","BPSOSSG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSSG",3,0)
 Q
"RTN","BPSOSSG",4,0)
COLSTATE()          ;EP  entry point frm clm frmt for Colorado State Lic
"RTN","BPSOSSG",5,0)
 N BPSST,BPSFND,BPSLIC,BPSPRO  ;state IEN, fnd ind, state lic 
"RTN","BPSOSSG",6,0)
 S (BPSST,BPSFND,BPSLIC,BPSPRO)=""
"RTN","BPSOSSG",7,0)
 S BPSPRO=$G(BPS("RX",BPS(9002313.0201),"Prescriber IEN")) ;for 200
"RTN","BPSOSSG",8,0)
 I BPSPRO S BPSPRO=$$GET1^DIQ(200,BPSPRO,16,"I")  ;get prov
"RTN","BPSOSSG",9,0)
 I BPSPRO'="" D
"RTN","BPSOSSG",10,0)
 . F  S BPSST=$O(^DIC(6,BPSPRO,999999921,BPSST)) Q:BPSST=""  D
"RTN","BPSOSSG",11,0)
 .. I $P($G(^DIC(5,BPSST,0)),U)["COLORADO" D
"RTN","BPSOSSG",12,0)
 ... S BPSLIC=$P($G(^DIC(6,BPSPRO,999999921,BPSST,0)),U,2)
"RTN","BPSOSSG",13,0)
 ... S BPSFND=1
"RTN","BPSOSSG",14,0)
 ... S BPSST=99999999
"RTN","BPSOSSG",15,0)
 I 'BPSFND S BPSLIC=BPS("Site","Default CAID #")
"RTN","BPSOSSG",16,0)
 Q BPSLIC
"RTN","BPSOSSG",17,0)
 ;*******************************************************************
"RTN","BPSOSSG",18,0)
STATE(STATE) ;EP IHS/SD/lwj 10/28/02 retrieve the state license number
"RTN","BPSOSSG",19,0)
 N STPOINT,DRPOINT,LIPOINT,LICENSE
"RTN","BPSOSSG",20,0)
 S (STPOINT,DRPOINT,LIPOINT,LICENSE)=""
"RTN","BPSOSSG",21,0)
 S STPOINT=$O(^DIC(5,"C",STATE,0))   ;state pointer
"RTN","BPSOSSG",22,0)
 S DRPOINT=$G(BPS("RX",BPS(9002313.02),"Prescriber IEN")) ;prsc pntr
"RTN","BPSOSSG",23,0)
 ;
"RTN","BPSOSSG",24,0)
 ; get the license number
"RTN","BPSOSSG",25,0)
 S LICENSE=$$GET1^DIQ(200.541,STPOINT_","_DRPOINT_",",1)
"RTN","BPSOSSG",26,0)
 ;
"RTN","BPSOSSG",27,0)
 S:LICENSE="" LICENSE=$G(BPS("Site","Default CAID #"))
"RTN","BPSOSSG",28,0)
 ;
"RTN","BPSOSSG",29,0)
 Q LICENSE
"RTN","BPSOSSG",30,0)
 ;
"RTN","BPSOSSG",31,0)
NEW416() ; IHS/SD/lwj 8/30/02   NCPDP 5.1
"RTN","BPSOSSG",32,0)
 N PATYPE,PANUM,PA
"RTN","BPSOSSG",33,0)
 ;
"RTN","BPSOSSG",34,0)
 S PATYPE=$E($G(BPS("X")),1,1)
"RTN","BPSOSSG",35,0)
 S PANUM=$E($G(BPS("X")),2,12)
"RTN","BPSOSSG",36,0)
 S PA="DG"_$G(PATYPE)_$$NFF^BPSECFM($G(PANUM),11)
"RTN","BPSOSSG",37,0)
 ;
"RTN","BPSOSSG",38,0)
 Q PA
"RTN","BPSOSSG",39,0)
FMT416() ;----------------------------------------------------------------
"RTN","BPSOSSG",40,0)
 N BPSPA,BPSCD,BPSPC
"RTN","BPSOSSG",41,0)
 S BPSCD=$S(BPS("X")=2:2,BPS("X")=4:4,BPS("X")=5:5,1:$S(BPS("X"):"1",1:"0"))
"RTN","BPSOSSG",42,0)
 I (BPS("X")=5)!(BPS("X")=2)!(BPS("X")=4) D   ;prs lmt/med cert/cpy
"RTN","BPSOSSG",43,0)
 . S BPSPA=$$NFF^BPSECFM("",11)
"RTN","BPSOSSG",44,0)
 I (BPS("X")'=5)&(BPS("X")'=2)&(BPS("X")'=4) D  ;prior authorization
"RTN","BPSOSSG",45,0)
 . S BPSPA=$$NFF^BPSECFM($G(BPS("X")),11)
"RTN","BPSOSSG",46,0)
 ;
"RTN","BPSOSSG",47,0)
 S BPSPC="DG"_BPSCD_BPSPA
"RTN","BPSOSSG",48,0)
 ;
"RTN","BPSOSSG",49,0)
 Q BPSPC
"RTN","BPSOSSG",50,0)
FLD308 ;Other Coverage Code 
"RTN","BPSOSSG",51,0)
 S $P(^BPSC(BPS(9002313.02),300),U,8)=BPS("X")
"RTN","BPSOSSG",52,0)
 I $D(BPS(9002313.0201)) D
"RTN","BPSOSSG",53,0)
 . S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),300),U,8)=BPS("X")
"RTN","BPSOSSG",54,0)
 ;
"RTN","BPSOSSG",55,0)
 Q
"RTN","BPSOSSG",56,0)
 ;
"RTN","BPSOSSG",57,0)
FLD315 ;Employer Name  
"RTN","BPSOSSG",58,0)
 S $P(^BPSC(BPS(9002313.02),300),U,15)=BPS("X")
"RTN","BPSOSSG",59,0)
 I $D(BPS(9002313.0201)) D
"RTN","BPSOSSG",60,0)
 . S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,5)=BPS("X")
"RTN","BPSOSSG",61,0)
 ;
"RTN","BPSOSSG",62,0)
 Q
"RTN","BPSOSSG",63,0)
 ;
"RTN","BPSOSSG",64,0)
FLD316 ;Employer Street Address
"RTN","BPSOSSG",65,0)
 ; 3.2/5.1 Set Code - called by set command in BPS NCPDP Field DEfs
"RTN","BPSOSSG",66,0)
 ;
"RTN","BPSOSSG",67,0)
 ;3.2 Set
"RTN","BPSOSSG",68,0)
 S $P(^BPSC(BPS(9002313.02),300),U,16)=BPS("X")
"RTN","BPSOSSG",69,0)
 ;
"RTN","BPSOSSG",70,0)
 ;5.1 Set
"RTN","BPSOSSG",71,0)
 I $D(BPS(9002313.0201)) D
"RTN","BPSOSSG",72,0)
 . S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,6)=BPS("X")
"RTN","BPSOSSG",73,0)
 ;
"RTN","BPSOSSG",74,0)
 Q
"RTN","BPSOSSG",75,0)
 ;
"RTN","BPSOSSG",76,0)
FLD317 ;Employer City Address  
"RTN","BPSOSSG",77,0)
 ;3.2/5.1 Set Code - called by set command in BPS NCPDP Field Defs
"RTN","BPSOSSG",78,0)
 ;
"RTN","BPSOSSG",79,0)
 ;3.2 Set
"RTN","BPSOSSG",80,0)
 S $P(^BPSC(BPS(9002313.02),300),U,17)=BPS("X")
"RTN","BPSOSSG",81,0)
 ;
"RTN","BPSOSSG",82,0)
 ;5.1 Set
"RTN","BPSOSSG",83,0)
 I $D(BPS(9002313.0201)) D
"RTN","BPSOSSG",84,0)
 . S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,7)=BPS("X")
"RTN","BPSOSSG",85,0)
 ;
"RTN","BPSOSSG",86,0)
 Q
"RTN","BPSOSSG",87,0)
 ;
"RTN","BPSOSSG",88,0)
FLD318 ;Employer State/Prov Address
"RTN","BPSOSSG",89,0)
 ;3.2/5.1 Set Code - called by set command in BPS NCPDP Field Defs
"RTN","BPSOSSG",90,0)
 ;
"RTN","BPSOSSG",91,0)
 ;3.2 Set
"RTN","BPSOSSG",92,0)
 S $P(^BPSC(BPS(9002313.02),300),U,18)=BPS("X")
"RTN","BPSOSSG",93,0)
 ;
"RTN","BPSOSSG",94,0)
 ;5.1 Set
"RTN","BPSOSSG",95,0)
 I $D(BPS(9002313.0201)) D
"RTN","BPSOSSG",96,0)
 . S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,8)=BPS("X")
"RTN","BPSOSSG",97,0)
 ;
"RTN","BPSOSSG",98,0)
 Q
"RTN","BPSOSSG",99,0)
 ;
"RTN","BPSOSSG",100,0)
FLD319 ;Employer Zip/Postal Zip
"RTN","BPSOSSG",101,0)
 ;3.2/5.1 Set Code - called by set command in BPS NCPDP Field Defs
"RTN","BPSOSSG",102,0)
 ;
"RTN","BPSOSSG",103,0)
 ;3.2 Set
"RTN","BPSOSSG",104,0)
 S $P(^BPSC(BPS(9002313.02),300),U,19)=BPS("X")
"RTN","BPSOSSG",105,0)
 ;
"RTN","BPSOSSG",106,0)
 ;5.1 Set
"RTN","BPSOSSG",107,0)
 I $D(BPS(9002313.0201)) D
"RTN","BPSOSSG",108,0)
 . S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,9)=BPS("X")
"RTN","BPSOSSG",109,0)
 ;
"RTN","BPSOSSG",110,0)
 Q
"RTN","BPSOSSG",111,0)
 ;
"RTN","BPSOSSG",112,0)
FLD320 ;Employer Phone Number
"RTN","BPSOSSG",113,0)
 ;3.2/5.1 Set Code - called by set command in BPS NCPDP Field Defs
"RTN","BPSOSSG",114,0)
 ;
"RTN","BPSOSSG",115,0)
 ;3.2 Set
"RTN","BPSOSSG",116,0)
 S $P(^BPSC(BPS(9002313.02),320),U,20)=BPS("X")
"RTN","BPSOSSG",117,0)
 ;
"RTN","BPSOSSG",118,0)
 ;5.1 Set
"RTN","BPSOSSG",119,0)
 I $D(BPS(9002313.0201)) D
"RTN","BPSOSSG",120,0)
 . S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),310),U,10)=BPS("X")
"RTN","BPSOSSG",121,0)
 ;
"RTN","BPSOSSG",122,0)
 Q
"RTN","BPSOSSG",123,0)
 ;
"RTN","BPSOSSG",124,0)
FLD327 ;Carrier ID
"RTN","BPSOSSG",125,0)
 ;3.2/5.1 Set Code - called by set command in BPS NCPDP Field Defs
"RTN","BPSOSSG",126,0)
 ;
"RTN","BPSOSSG",127,0)
 ;3.2 Set
"RTN","BPSOSSG",128,0)
 S $P(^BPSC(BPS(9002313.02),320),U,27)=BPS("X")
"RTN","BPSOSSG",129,0)
 ;
"RTN","BPSOSSG",130,0)
 ;5.1 Set
"RTN","BPSOSSG",131,0)
 I $D(BPS(9002313.0201)) D
"RTN","BPSOSSG",132,0)
 . S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),320),U,7)=BPS("X")
"RTN","BPSOSSG",133,0)
 ;
"RTN","BPSOSSG",134,0)
 Q
"RTN","BPSOSSG",135,0)
FLD439 ;Reason for service code
"RTN","BPSOSSG",136,0)
 ;
"RTN","BPSOSSG",137,0)
 ;3.2 Set
"RTN","BPSOSSG",138,0)
 I '$G(BPS51) S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),430),U,9)=BPS("X")
"RTN","BPSOSSG",139,0)
 ;
"RTN","BPSOSSG",140,0)
 ;5.1 Set
"RTN","BPSOSSG",141,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1,BPS51=1
"RTN","BPSOSSG",142,0)
 I $G(BPS51) S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,2)=BPS("X")
"RTN","BPSOSSG",143,0)
 ;
"RTN","BPSOSSG",144,0)
 Q
"RTN","BPSOSSG",145,0)
 ;
"RTN","BPSOSSG",146,0)
FLD440 ;Professional Service Code
"RTN","BPSOSSG",147,0)
 ;
"RTN","BPSOSSG",148,0)
 ;3.2 Set
"RTN","BPSOSSG",149,0)
 I '$G(BPS51) S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),430),U,10)=BPS("X")
"RTN","BPSOSSG",150,0)
 ;
"RTN","BPSOSSG",151,0)
 ;5.1 Set
"RTN","BPSOSSG",152,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1,BPS51=1
"RTN","BPSOSSG",153,0)
 I $G(BPS51) S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,3)=BPS("X")
"RTN","BPSOSSG",154,0)
 ;
"RTN","BPSOSSG",155,0)
 Q
"RTN","BPSOSSG",156,0)
 ;
"RTN","BPSOSSG",157,0)
FLD441 ;Result of Service Code
"RTN","BPSOSSG",158,0)
 ;
"RTN","BPSOSSG",159,0)
 ;3.2 Set
"RTN","BPSOSSG",160,0)
 I '$G(BPS51) S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),440),U,1)=BPS("X")
"RTN","BPSOSSG",161,0)
 ;
"RTN","BPSOSSG",162,0)
 ;5.1 Set
"RTN","BPSOSSG",163,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1,BPS51=1
"RTN","BPSOSSG",164,0)
 I $G(BPS51) S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,4)=BPS("X")
"RTN","BPSOSSG",165,0)
 ;
"RTN","BPSOSSG",166,0)
 Q
"RTN","BPSOSSG",167,0)
 ;
"RTN","BPSOSSG",168,0)
FLD473 ;DUR/PPS code counter - called from set logic in BPS NCPDP Field Defs
"RTN","BPSOSSG",169,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1,BPS51=1
"RTN","BPSOSSG",170,0)
 S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,1)=BPS("X")
"RTN","BPSOSSG",171,0)
 S ^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,"B",BPS("X"),DUR)=""
"RTN","BPSOSSG",172,0)
 ;
"RTN","BPSOSSG",173,0)
 Q
"RTN","BPSOSSG",174,0)
 ;
"RTN","BPSOSSG",175,0)
FLD480 ;lje;7/23/03;VA - Other Amount Claimed Submitted field
"RTN","BPSOSSG",176,0)
 Q:BPS("X")=""!(BPS("X")=0)!($TR(BPS("X"),"{}0.H7H8H9")="")
"RTN","BPSOSSG",177,0)
 S FDA(9002313.0601,"+1,"_BPS(9002313.0201)_","_BPS(9002313.02)_",",.01)="H7"_1
"RTN","BPSOSSG",178,0)
 S FDA(9002313.0601,"+1,"_BPS(9002313.0201)_","_BPS(9002313.02)_",",480)=BPS("X")
"RTN","BPSOSSG",179,0)
 S FDA(9002313.0601,"+1,"_BPS(9002313.0201)_","_BPS(9002313.02)_",",479)="H8"_$G(BPS("Insurer","Other Amt Claim Sub Qual"))
"RTN","BPSOSSG",180,0)
 D UPDATE^DIE("","FDA","BPS(9002313.0601)","MSG")
"RTN","BPSOSSG",181,0)
 I $D(MSG) D LOG^BPSOSL("Failed to update NCPDP field 480 and/or 479")
"RTN","BPSOSSG",182,0)
 I $D(MSG) D LOGARRAY^BPSOSL("MSG")
"RTN","BPSOSSG",183,0)
 Q
"RTN","BPSOSSG",184,0)
 ;
"RTN","BPSOSSG",185,0)
EMPL ;lje;7/18/03; get employer info for VA
"RTN","BPSOSSG",186,0)
 Q:'$G(BPS("Patient","IEN"))
"RTN","BPSOSSG",187,0)
 D GETS^DIQ(2,BPS("Patient","IEN"),".3111;.3112;.3113;.3115;.3116;.3117;.3118;.3119","","EMPL")
"RTN","BPSOSSG",188,0)
 S BPS("Employer","Name")=EMPL(2,BPS("Patient","IEN")_",",.3111)
"RTN","BPSOSSG",189,0)
 S:EMPL(2,BPS("Patient","IEN")_",",.3111)=""&(EMPL(2,BPS("Patient","IEN")_",",.3112)'="") BPS("Employer","Name")=EMPL(2,BPS("Patient","IEN")_",",.3112)
"RTN","BPSOSSG",190,0)
 S BPS("Employer","Address")=EMPL(2,BPS("Patient","IEN")_",",.3113)
"RTN","BPSOSSG",191,0)
 S BPS("Employer","City")=EMPL(2,BPS("Patient","IEN")_",",.3116)
"RTN","BPSOSSG",192,0)
 S BPS("Employer","State")=EMPL(2,BPS("Patient","IEN")_",",.3117)
"RTN","BPSOSSG",193,0)
 I BPS("Employer","State")'="" D
"RTN","BPSOSSG",194,0)
 . S STATEIEN="",STATEIEN=$O(^DIC(5,"B",BPS("Employer","State"),STATEIEN)),BPS("Employer","State")=$P($G(^DIC(5,STATEIEN,0)),"^",2)
"RTN","BPSOSSG",195,0)
 S BPS("Employer","Zip Code")=EMPL(2,BPS("Patient","IEN")_",",.3118)
"RTN","BPSOSSG",196,0)
 S BPS("Employer","Phone")=EMPL(2,BPS("Patient","IEN")_",",.3119)
"RTN","BPSOSSG",197,0)
 K EMPL,STATEIEN
"RTN","BPSOSSG",198,0)
 Q
"RTN","BPSOSSG",199,0)
FLD474 ;DUR/PPS level of effort - called from set logic in BPS NCPDP Field
"RTN","BPSOSSG",200,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1
"RTN","BPSOSSG",201,0)
 S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,5)=BPS("X")
"RTN","BPSOSSG",202,0)
 ;
"RTN","BPSOSSG",203,0)
 Q
"RTN","BPSOSSG",204,0)
 ;
"RTN","BPSOSSG",205,0)
FLD475 ;DUR Co-agent ID Qualifier - called from set logic in BPS NCPDP Field
"RTN","BPSOSSG",206,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1
"RTN","BPSOSSG",207,0)
 S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,6)=BPS("X")
"RTN","BPSOSSG",208,0)
 ;
"RTN","BPSOSSG",209,0)
 Q
"RTN","BPSOSSG",210,0)
 ;
"RTN","BPSOSSG",211,0)
FLD476 ;DUR Co-agent ID - called from set logic in BPS NCPDP Field
"RTN","BPSOSSG",212,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S DUR=1
"RTN","BPSOSSG",213,0)
 S $P(^BPSC(BPS(9002313.02),400,BPS(9002313.0201),473.01,DUR,0),U,7)=BPS("X")
"RTN","BPSOSSG",214,0)
 ;
"RTN","BPSOSSG",215,0)
 Q
"RTN","BPSOSSG",216,0)
 ;
"RTN","BPSOSSG",217,0)
FLD402 ;
"RTN","BPSOSSG",218,0)
 I '$D(TYPE) Q
"RTN","BPSOSSG",219,0)
 I $G(TMP("9002313.0201",RX,"402","I")) I TYPE="CLAIM" D
"RTN","BPSOSSG",220,0)
 .I TMP("9002313.0201",RX,"402","I")[401944 S BPS("X")=7
"RTN","BPSOSSG",221,0)
 .I TMP("9002313.0201",RX,"402","I")[401959 S BPS("X")=1
"RTN","BPSOSSG",222,0)
 .I TMP("9002313.0201",RX,"402","I")[401974 S BPS("X")=2
"RTN","BPSOSSG",223,0)
 .I TMP("9002313.0201",RX,"402","I")[401976 S BPS("X")=3
"RTN","BPSOSSG",224,0)
 .I TMP("9002313.0201",RX,"402","I")[401958 S BPS("X")=4
"RTN","BPSOSSG",225,0)
 .I BPS("X")="" S BPS("X")=TMP("9002313.0201",RX,"402","I")
"RTN","BPSOSSG",226,0)
 .I BPS("RX",BPS(9002313.0201),"RX IEN")=401944 S BPS("X")=401944
"RTN","BPSOSSG",227,0)
 I TYPE="UNCLAIM" S BPS("X")=$S(RXI=401944:7,1:RXI)
"RTN","BPSOSSG",228,0)
 Q
"RTN","BPSOSU")
0^248^B67702663
"RTN","BPSOSU",1,0)
BPSOSU ;BHAM ISC/FCS/DRS/FLS - Common utilities ;06/01/2004
"RTN","BPSOSU",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSU",3,0)
 Q
"RTN","BPSOSU",4,0)
 ; some common utilities called a lot.
"RTN","BPSOSU",5,0)
 ;
"RTN","BPSOSU",6,0)
 ; SETSTAT - set status field for ^BPST(ABSBRXI,
"RTN","BPSOSU",7,0)
 ; Input: 
"RTN","BPSOSU",8,0)
 ;   ABSBRXI - This needs to be newed and defined by the calling routine
"RTN","BPSOSU",9,0)
 ;   STATUS  - Value to set into BPS Transaction
"RTN","BPSOSU",10,0)
SETSTAT(STATUS) ;EP - from many places
"RTN","BPSOSU",11,0)
 ; set ^BPST( status for ABSBRXI
"RTN","BPSOSU",12,0)
 ;
"RTN","BPSOSU",13,0)
 ; Timing problem:  if response got processed before the SETCSTAT
"RTN","BPSOSU",14,0)
 ; was sent for "waiting to process response",  don't reset it now.
"RTN","BPSOSU",15,0)
 I STATUS=80,$P(^BPST(ABSBRXI,0),U,2)>80 Q
"RTN","BPSOSU",16,0)
 ;
"RTN","BPSOSU",17,0)
 ; Perhaps other such detection would be a good idea here.
"RTN","BPSOSU",18,0)
 ;
"RTN","BPSOSU",19,0)
 ; LOCK the file - something is very wrong if you can't get the lock
"RTN","BPSOSU",20,0)
 F  L +^BPST(ABSBRXI):300 Q:$T  Q:'$$IMPOSS^BPSOSUE("L","RTI","LOCK +^BPST",,"SETSTAT",$T(+0))
"RTN","BPSOSU",21,0)
 N DIE,DA,DR,X S DIE=9002313.59,DA=ABSBRXI,DR="1///"_STATUS_";7///NOW"
"RTN","BPSOSU",22,0)
 I STATUS=0 S DR=DR_";15///NOW" ; START TIME, too.
"RTN","BPSOSU",23,0)
 D ^DIE
"RTN","BPSOSU",24,0)
 N X S X="" F  S X=$O(^BPST("AD",X)) Q:X=""  D
"RTN","BPSOSU",25,0)
 .I X'=STATUS K ^BPST("AD",X,ABSBRXI)
"RTN","BPSOSU",26,0)
 I STATUS=99 D STATUS99
"RTN","BPSOSU",27,0)
 L -^BPST(ABSBRXI)
"RTN","BPSOSU",28,0)
 Q
"RTN","BPSOSU",29,0)
 ;
"RTN","BPSOSU",30,0)
 ; STATUS99 - Special activity when a claim reaches status 99
"RTN","BPSOSU",31,0)
 ; Input:
"RTN","BPSOSU",32,0)
 ;   ABSBRXI - This is called by SETSTAT (above) and this variable is set
"RTN","BPSOSU",33,0)
STATUS99 ;
"RTN","BPSOSU",34,0)
 ; Transaction log in .57  (but not if it's a canceled transaction!)
"RTN","BPSOSU",35,0)
 N RX,RF,CLMSTAT
"RTN","BPSOSU",36,0)
 S RX=$P(ABSBRXI,"."),RF=+$E($P(ABSBRXI,".",2),1,4)
"RTN","BPSOSU",37,0)
 ;
"RTN","BPSOSU",38,0)
 ; Get status of the claim
"RTN","BPSOSU",39,0)
 S CLMSTAT=$$CATEG^BPSOSUC(ABSBRXI)
"RTN","BPSOSU",40,0)
 ;
"RTN","BPSOSU",41,0)
 ; Canceled - shouldn't we restore old .57 into this .59?
"RTN","BPSOSU",42,0)
 I $P($G(^BPST(ABSBRXI,3)),U,2) D
"RTN","BPSOSU",43,0)
 . D LOG^BPSOSL($T(+0)_" - Cancellation succeeded.")
"RTN","BPSOSU",44,0)
 E  D
"RTN","BPSOSU",45,0)
 . N BPS57 S BPS57=$$NEW57(ABSBRXI)
"RTN","BPSOSU",46,0)
 . D TRANSACT^BPSOSBC(BPS57) ; hand it to posting
"RTN","BPSOSU",47,0)
 . D RECEIPT(BPS57) ; automatic receipt printing
"RTN","BPSOSU",48,0)
 ;
"RTN","BPSOSU",49,0)
 ; If the Reverse Then Resubmit field is set to Resubmitting (2),
"RTN","BPSOSU",50,0)
 ;   then set to 'Done' (0)
"RTN","BPSOSU",51,0)
 I $P(^BPST(ABSBRXI,1),U,12)=2 S $P(^BPST(ABSBRXI,1),U,12)=0
"RTN","BPSOSU",52,0)
 ;
"RTN","BPSOSU",53,0)
 ; If resubmit flag is set to 'Reverse, then Resubmit' (1), see about
"RTN","BPSOSU",54,0)
 ;   doing a resubmit
"RTN","BPSOSU",55,0)
 I $P(^BPST(ABSBRXI,1),U,12)=1 D
"RTN","BPSOSU",56,0)
 . ;
"RTN","BPSOSU",57,0)
 . ; Slot stuff
"RTN","BPSOSU",58,0)
 . N OLDSLOT,SLOT,SKIP,SITE
"RTN","BPSOSU",59,0)
 . S OLDSLOT=$$GETSLOT^BPSOSL
"RTN","BPSOSU",60,0)
 . S SLOT=ABSBRXI D SETSLOT^BPSOSL(SLOT)
"RTN","BPSOSU",61,0)
 . D LOG^BPSOSL($T(+0)_" "_SLOT_" Reverse then Resubmit attempt:"_$J)
"RTN","BPSOSU",62,0)
 . ;
"RTN","BPSOSU",63,0)
 . ; Initialize the skip flag
"RTN","BPSOSU",64,0)
 . S SKIP=0
"RTN","BPSOSU",65,0)
 . ;
"RTN","BPSOSU",66,0)
 . ; Get Site info and make sure it exists
"RTN","BPSOSU",67,0)
 . I 'RF S SITE=$$GET1^DIQ(52,RX,20,"I")
"RTN","BPSOSU",68,0)
 . I RF S SITE=$$GET1^DIQ(52.1,RF_","_RX,8,"I")
"RTN","BPSOSU",69,0)
 . I '$G(SITE) D
"RTN","BPSOSU",70,0)
 .. D LOG^BPSOSL($T(+0)_" Cannot - No site information")
"RTN","BPSOSU",71,0)
 .. S SKIP=1
"RTN","BPSOSU",72,0)
 . ;
"RTN","BPSOSU",73,0)
 . ; Check the ECME switch for the site
"RTN","BPSOSU",74,0)
 . I $G(SITE),'$$ECMEON^BPSUTIL(SITE) D
"RTN","BPSOSU",75,0)
 . . D LOG^BPSOSL($T(+0)_" Cannot - Site not linked to a BPS Pharmacy")
"RTN","BPSOSU",76,0)
 . . S SKIP=1
"RTN","BPSOSU",77,0)
 . ;
"RTN","BPSOSU",78,0)
 . ; If reversal was not successful, log message and quit
"RTN","BPSOSU",79,0)
 . I CLMSTAT'="E REVERSAL ACCEPTED" D
"RTN","BPSOSU",80,0)
 . . D LOG^BPSOSL($T(+0)_" Cannot - Reversal failed - "_X)
"RTN","BPSOSU",81,0)
 . . S SKIP=1
"RTN","BPSOSU",82,0)
 . ;
"RTN","BPSOSU",83,0)
 . ; Check if the MOREDATA array is defined
"RTN","BPSOSU",84,0)
 . I '$D(^XTMP("BPSOSRB","MOREDATA",ABSBRXI,"RESUB")) D
"RTN","BPSOSU",85,0)
 . . D LOG^BPSOSL($T(+0)_" Cannot - MOREDATA array undefined")
"RTN","BPSOSU",86,0)
 . . S SKIP=1
"RTN","BPSOSU",87,0)
 . ;
"RTN","BPSOSU",88,0)
 . ; If skip flag is set, clear the resubmit flag and do nothing else
"RTN","BPSOSU",89,0)
 . ; Else resubmit the claim and set resubmit flag
"RTN","BPSOSU",90,0)
 . ;  to 'Resubmitting'
"RTN","BPSOSU",91,0)
 . I SKIP S $P(^BPST(ABSBRXI,1),U,12)=0
"RTN","BPSOSU",92,0)
 . E  D
"RTN","BPSOSU",93,0)
 . . K MOREDATA
"RTN","BPSOSU",94,0)
 . . M MOREDATA=^XTMP("BPSOSRB","MOREDATA",ABSBRXI,"RESUB")
"RTN","BPSOSU",95,0)
 . . K ^XTMP("BPSOSRB","MOREDATA",ABSBRXI,"RESUB")
"RTN","BPSOSU",96,0)
 . . D LOG^BPSOSL($T(+0)_" Now resubmit "_$J)
"RTN","BPSOSU",97,0)
 . . D CLAIM^BPSOSRB(RX,RF,ABSBRXI,.MOREDATA)
"RTN","BPSOSU",98,0)
 . D RELSLOT^BPSOSL
"RTN","BPSOSU",99,0)
 . I OLDSLOT D SETSLOT^BPSOSL(OLDSLOT)
"RTN","BPSOSU",100,0)
 ;
"RTN","BPSOSU",101,0)
 ; Check Auto-Reversed claims to see if they should be resubmitted, which
"RTN","BPSOSU",102,0)
 ;  should be done if the reversal was accepted and the RX/Fill was released
"RTN","BPSOSU",103,0)
 ;  while waiting for the payer response
"RTN","BPSOSU",104,0)
 ; Need to check for 'normal' auto-reversals
"RTN","BPSOSU",105,0)
 I CLMSTAT="E REVERSAL ACCEPTED",$$RXRLDT^PSOBPSUT(RX,RF) D
"RTN","BPSOSU",106,0)
 . N CLAIMIEN,AUTOREV
"RTN","BPSOSU",107,0)
 . S CLAIMIEN=$$GET1^DIQ(9002313.59,ABSBRXI,3,"I")
"RTN","BPSOSU",108,0)
 . I '$G(CLAIMIEN) Q
"RTN","BPSOSU",109,0)
 . S AUTOREV=$$GET1^DIQ(9002313.02,CLAIMIEN,.07,"I")
"RTN","BPSOSU",110,0)
 . I $G(AUTOREV)'=1 Q
"RTN","BPSOSU",111,0)
 . N BDOS,BRES,BMES,BMSG
"RTN","BPSOSU",112,0)
 . D LOG^BPSOSL($T(+0)_" Submit released auto-reversal")
"RTN","BPSOSU",113,0)
 . S BDOS=$$DOSDATE^BPSSCRRS(RX,RF)
"RTN","BPSOSU",114,0)
 . S BRES=$$EN^BPSNCPDP(RX,RF,BDOS,"ARES")
"RTN","BPSOSU",115,0)
 . D LOG^BPSOSL($T(+0)_" Response from BPSNCPDP: "_BRES)
"RTN","BPSOSU",116,0)
 . S BMSG=$P(BRES,U,2),BRES=+BRES
"RTN","BPSOSU",117,0)
 . S BMES="Submitted to ECME: Resubmit for released autoreversal"
"RTN","BPSOSU",118,0)
 . S BMES=BMES_$S(BRES=1:"-NO SUBMISSION VIA ECME",BRES=4:"-NOT PROCESSED",BRES=5:"-SOFTWARE ERROR",1:"")
"RTN","BPSOSU",119,0)
 . D ECMEACT^PSOBPSU1(RX,RF,BMES,.5)
"RTN","BPSOSU",120,0)
 . I BRES=2 D ECMEACT^PSOBPSU1(RX,RF,"Not ECME Billable: "_BMSG,.5)
"RTN","BPSOSU",121,0)
 ;
"RTN","BPSOSU",122,0)
 ; And at random times, winnow the log files 
"RTN","BPSOSU",123,0)
 I $R(10000)=0 D
"RTN","BPSOSU",124,0)
 . N ZTRTN,ZTIO,ZTSAVE,ZTDTH
"RTN","BPSOSU",125,0)
 . S ZTRTN="SILENT^BPSOSK(1)"
"RTN","BPSOSU",126,0)
 . S ZTIO="",ZTDTH=$$TADD^BPSOSUD(DT,1)_".0222" ; tomorrow early a.m.
"RTN","BPSOSU",127,0)
 . D ^%ZTLOAD
"RTN","BPSOSU",128,0)
 Q
"RTN","BPSOSU",129,0)
 ;
"RTN","BPSOSU",130,0)
NEW57(RXI) ;EP - copy this ^BPST(RXI) into ^BPSTL(N)
"RTN","BPSOSU",131,0)
 F  L +^BPSTL:300 Q:$T  Q:'$$IMPOSS^BPSOSUE("L","RTI","LOCK ^BPSTL",,"NEW57",$T(+0))
"RTN","BPSOSU",132,0)
NEW57A N N S N=$P(^BPSTL(0),U,3)+1
"RTN","BPSOSU",133,0)
 N C S C=$P(^BPSTL(0),U,4)+1
"RTN","BPSOSU",134,0)
 S $P(^BPSTL(0),U,3,4)=N_U_C
"RTN","BPSOSU",135,0)
 I $D(^BPSTL(N)) G NEW57A ; should never happen
"RTN","BPSOSU",136,0)
 L -^BPSTL
"RTN","BPSOSU",137,0)
 M ^BPSTL(N)=^BPST(RXI)
"RTN","BPSOSU",138,0)
 ;
"RTN","BPSOSU",139,0)
 ; Indexing - First, fileman indexing
"RTN","BPSOSU",140,0)
 D
"RTN","BPSOSU",141,0)
 . N DIK,DA S DIK="^BPSTL(",DA=N N N D IX1^DIK
"RTN","BPSOSU",142,0)
 ;
"RTN","BPSOSU",143,0)
 ; The NON-FILEMAN index on RXI,RXR
"RTN","BPSOSU",144,0)
 D
"RTN","BPSOSU",145,0)
 . N INDEX,A,B,TYPE S TYPE=$E(RXI,$L(RXI))
"RTN","BPSOSU",146,0)
 . I TYPE=1!(TYPE=2) D
"RTN","BPSOSU",147,0)
 . . S A=$P(^BPSTL(N,1),U,11)
"RTN","BPSOSU",148,0)
 . . S B=$P(^BPSTL(N,1),U)
"RTN","BPSOSU",149,0)
 . . S INDEX=$S(TYPE=1:"RXIRXR",TYPE=2:"POSTAGE")
"RTN","BPSOSU",150,0)
 . E  I TYPE=3 D
"RTN","BPSOSU",151,0)
 . . S A=$P(^BPSTL(N,0),U,7)
"RTN","BPSOSU",152,0)
 . . S B=$P(^BPSTL(N,1),U,3) ; VCPT
"RTN","BPSOSU",153,0)
 . . S INDEX="OTHERS"
"RTN","BPSOSU",154,0)
 . E  D IMPOSS^BPSOSUE("DB,P","TI","Bad TYPE="_TYPE,"in RXI="_RXI,"NEW57",$T(+0))
"RTN","BPSOSU",155,0)
 . S ^BPSTL("NON-FILEMAN",INDEX,A,B,N)=""
"RTN","BPSOSU",156,0)
 Q N
"RTN","BPSOSU",157,0)
 ; $$PREV57(point to 57) returns pointer to previous transaction
"RTN","BPSOSU",158,0)
 ; for the same RXI,RXR - returns "" if no such
"RTN","BPSOSU",159,0)
PREV57(N57) ; EP -
"RTN","BPSOSU",160,0)
 N RXI,RXR S RXI=$P(^BPSTL(N57,1),U,11)
"RTN","BPSOSU",161,0)
 S RXR=$P(^BPSTL(N57,1),U)
"RTN","BPSOSU",162,0)
 I RXI=""!(RXR="") Q ""
"RTN","BPSOSU",163,0)
 Q $O(^BPSTL("NON-FILEMAN","RXIRXR",RXI,RXR,N57),-1)
"RTN","BPSOSU",164,0)
 ;
"RTN","BPSOSU",165,0)
 ; SETCSTAT - set the status for every prescription associated with
"RTN","BPSOSU",166,0)
 ; this claim
"RTN","BPSOSU",167,0)
 ;
"RTN","BPSOSU",168,0)
SETCSTAT(CLAIM,STATUS)       ;EP - BPSOSAM
"RTN","BPSOSU",169,0)
 N ABSBRXI
"RTN","BPSOSU",170,0)
 I $$ISREVERS(CLAIM) D  Q  ; different for reversals
"RTN","BPSOSU",171,0)
 .S ABSBRXI=$$RXI4REV(CLAIM) I ABSBRXI D SETSTAT(STATUS)
"RTN","BPSOSU",172,0)
 S ABSBRXI=""
"RTN","BPSOSU",173,0)
 F  S ABSBRXI=$O(^BPST("AE",CLAIM,ABSBRXI)) Q:ABSBRXI=""  D
"RTN","BPSOSU",174,0)
 .D SETSTAT(STATUS)
"RTN","BPSOSU",175,0)
 Q
"RTN","BPSOSU",176,0)
ISREVERS(CLAIM) ;EP - BPSOSP2
"RTN","BPSOSU",177,0)
 ; is this a reversal claim?  $$ returns 1 or 0
"RTN","BPSOSU",178,0)
 Q $P($G(^BPSC(CLAIM,100)),"^",3)=11!($P($G(^BPSC(CLAIM,100)),"^",3)="B2")  ;LJE;9/19/03
"RTN","BPSOSU",179,0)
RXI4REV(REVCLAIM)  ; given IEN of reversal claim $$this to get RXI
"RTN","BPSOSU",180,0)
 ; The reversal claim must be associated with exactly one RXI.
"RTN","BPSOSU",181,0)
 N RET,MBN ; MBN=Must Be Null
"RTN","BPSOSU",182,0)
 S RET=$O(^BPST("AER",REVCLAIM,0)),MBN=$O(^(RET))
"RTN","BPSOSU",183,0)
 I 'RET D IMPOSS^BPSOSUE("DB,P","TI","REVCLAIM="_REVCLAIM_" and ""AER"" index",,"RXI4REV",$T(+0)) ; may not apply to certification testing!! SEE ABOVE.
"RTN","BPSOSU",184,0)
 I MBN'="" D IMPOSS^BPSOSUE("DB,P","TI","REVCLAIM="_REVCLAIM_" points back to multiple .59 entries",,"RXI4REV",$T(+0))
"RTN","BPSOSU",185,0)
 Q RET
"RTN","BPSOSU",186,0)
 ;
"RTN","BPSOSU",187,0)
 ; SETCOMMS - for each prescription associated with this claim,
"RTN","BPSOSU",188,0)
 ; point back to the log of the comms session wherein xmit/rcv happened
"RTN","BPSOSU",189,0)
 ;
"RTN","BPSOSU",190,0)
SETCOMMS(CLAIM,POINTER) ;EP - BPSOSAM
"RTN","BPSOSU",191,0)
 N ABSBRXI S ABSBRXI=""
"RTN","BPSOSU",192,0)
 F  S ABSBRXI=$O(^BPST("AE",CLAIM,ABSBRXI)) Q:ABSBRXI=""  D
"RTN","BPSOSU",193,0)
 .S $P(^BPST(ABSBRXI,0),"^",12)=POINTER
"RTN","BPSOSU",194,0)
 Q
"RTN","BPSOSU",195,0)
 ;
"RTN","BPSOSU",196,0)
 ; SETRESU - Set Result  into ^BPST(ABSBRXI,2)
"RTN","BPSOSU",197,0)
 ;
"RTN","BPSOSU",198,0)
 ;    NOTE !!! NOTE !!! NOTE !!!  ABSBRXI must be set (not RXI) !!!
"RTN","BPSOSU",199,0)
 ;
"RTN","BPSOSU",200,0)
SETRESU(RESULT,TEXT)    ;EP - from many places
"RTN","BPSOSU",201,0)
 S $P(^BPST(ABSBRXI,2),U)=RESULT
"RTN","BPSOSU",202,0)
 I $G(TEXT)]"" D
"RTN","BPSOSU",203,0)
 . N X,Y S X=^BPST(ABSBRXI,2)
"RTN","BPSOSU",204,0)
 . S Y=$P(X,U),X=$P(X,U,2,$L(X,U))
"RTN","BPSOSU",205,0)
 . I X="" S X=$E(TEXT,1,255-$L(Y)-1)
"RTN","BPSOSU",206,0)
 . E  D
"RTN","BPSOSU",207,0)
 .. I $E(X,1,12)'="[Previously:" D
"RTN","BPSOSU",208,0)
 ... D PREVISLY^BPSOSIZ(ABSBRXI)
"RTN","BPSOSU",209,0)
 ... S X=$P(^BPST(ABSBRXI,2),U,2)
"RTN","BPSOSU",210,0)
 .. S X=$E(TEXT_X,1,255-$L(Y)-1)
"RTN","BPSOSU",211,0)
 . S ^BPST(ABSBRXI,2)=Y_U_X
"RTN","BPSOSU",212,0)
 I RESULT=0 Q  ; look at the associated RESPONSE in ^BPSR(
"RTN","BPSOSU",213,0)
 ;
"RTN","BPSOSU",214,0)
 ; For other RESULT codes, put a textual explanation in 
"RTN","BPSOSU",215,0)
 Q
"RTN","BPSOSU",216,0)
 ;
"RTN","BPSOSU",217,0)
 ; SETCRESU - set the result code for every prescription assoc'd with
"RTN","BPSOSU",218,0)
 ; this claim
"RTN","BPSOSU",219,0)
SETCRESU(CLAIM,RESULT,TEXT) ;
"RTN","BPSOSU",220,0)
 N ABSBRXI S ABSBRXI=""
"RTN","BPSOSU",221,0)
 F  S ABSBRXI=$O(^BPST("AE",CLAIM,ABSBRXI)) Q:ABSBRXI=""  D
"RTN","BPSOSU",222,0)
 .D SETRESU(RESULT,$G(TEXT))
"RTN","BPSOSU",223,0)
 Q
"RTN","BPSOSU",224,0)
 ;
"RTN","BPSOSU",225,0)
 ; STATI(X) gives a text version of what status code X means.
"RTN","BPSOSU",226,0)
 ;
"RTN","BPSOSU",227,0)
STATI(X) ;EP - from many places ; perhaps should be a Fileman file
"RTN","BPSOSU",228,0)
 I X=99 Q "Done"
"RTN","BPSOSU",229,0)
 I X=50 Q "Waiting for transmit"
"RTN","BPSOSU",230,0)
 I X=30 Q "Waiting for packet build"
"RTN","BPSOSU",231,0)
 I X=0 Q "Waiting to start"
"RTN","BPSOSU",232,0)
 I X=10 Q "Gathering claim info"
"RTN","BPSOSU",233,0)
 I X=40 Q "Packet being built"
"RTN","BPSOSU",234,0)
 I X=60 Q "Transmitting"
"RTN","BPSOSU",235,0)
 I X=61 Q "Transmitting"
"RTN","BPSOSU",236,0)
 I X=70 Q "Receiving response"
"RTN","BPSOSU",237,0)
 I X=80 Q "Waiting to process response"
"RTN","BPSOSU",238,0)
 I X=90 Q "Processing response"
"RTN","BPSOSU",239,0)
 I X=51 Q "Wait for retry (comms error)"
"RTN","BPSOSU",240,0)
 I X=31 Q "Wait for retry (insurer asleep)"
"RTN","BPSOSU",241,0)
 I X=19 Q "Special grouping"
"RTN","BPSOSU",242,0)
 I X=98 Q "Resubmitting" ;Used only by STATUS^BPSOSRX (Not stored in BPS Transactions)
"RTN","BPSOSU",243,0)
 ; When you add new X=, account for these in FETSTAT^BPSOS2
"RTN","BPSOSU",244,0)
 Q "?"_X_"?"
"RTN","BPSOSU",245,0)
 ;
"RTN","BPSOSU",246,0)
 ; RESULTI(X) gives a text version of what result code X means
"RTN","BPSOSU",247,0)
 ;
"RTN","BPSOSU",248,0)
RESULTI(X)         ;
"RTN","BPSOSU",249,0)
 I X=0 Q "See detail in BPS RESPONSES file" ; say more
"RTN","BPSOSU",250,0)
 Q "Result code "_X ; a catch-all default
"RTN","BPSOSU",251,0)
 ;
"RTN","BPSOSU",252,0)
RECEIPT(IEN57) ; This is where the receipt would go - taskman it to print in
"RTN","BPSOSU",253,0)
 ; background, somewhere, somehow
"RTN","BPSOSU",254,0)
 Q:'$$DORECEI
"RTN","BPSOSU",255,0)
 Q
"RTN","BPSOSU",256,0)
DORECEI() ; Should we print a receipt? 
"RTN","BPSOSU",257,0)
 ; Site-specific conditions needed.
"RTN","BPSOSU",258,0)
 ; example:  electronic claims only;
"RTN","BPSOSU",259,0)
 ;   only claims with co-pay;
"RTN","BPSOSU",260,0)
 ;   etc.
"RTN","BPSOSU",261,0)
 Q 0
"RTN","BPSOSU1")
0^249^B17021786
"RTN","BPSOSU1",1,0)
BPSOSU1 ;BHAM ISC/FCS/DRS/FLS/DLF - copied for ECME ;06/01/2004
"RTN","BPSOSU1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSU1",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",5,0)
 ;Standard Date Functions
"RTN","BPSOSU1",6,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",7,0)
 ;Standard Date PROMPT:
"RTN","BPSOSU1",8,0)
 ;
"RTN","BPSOSU1",9,0)
 ;Parameters:
"RTN","BPSOSU1",10,0)
 ;    PROMPT  = Text to be displayed before read
"RTN","BPSOSU1",11,0)
 ;    DFLT    = Default date (internal format)
"RTN","BPSOSU1",12,0)
 ;    OPT     = 1 - Answer optional       0 - Answer required
"RTN","BPSOSU1",13,0)
 ;    SDATE   = Minimum date (internal format or NOW and DT)
"RTN","BPSOSU1",14,0)
 ;    EDATE   = Maximum date (internal format or NOW and DT)
"RTN","BPSOSU1",15,0)
 ;    %DT     = E - Echo answer           R - Require time
"RTN","BPSOSU1",16,0)
 ;              S - Seconds returned      T - Time allowed but not req
"RTN","BPSOSU1",17,0)
 ;              X - Exact date req
"RTN","BPSOSU1",18,0)
 ;    TIMEOUT = Number of seconds
"RTN","BPSOSU1",19,0)
 ;
"RTN","BPSOSU1",20,0)
 ;Returns:
"RTN","BPSOSU1",21,0)
 ;    <null>  = No response             <^> - Up-arrow entered
"RTN","BPSOSU1",22,0)
 ;    <-1>    = Timeout occurred       <^^> - Two up-arrows entered
"RTN","BPSOSU1",23,0)
 ;    <date>  = Internal FM Date
"RTN","BPSOSU1",24,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",25,0)
 ; IHS/SD/lwj 8/5/02  NCPDP 5.1 changes
"RTN","BPSOSU1",26,0)
 ;  Subroutine FM3EXT cloned from FM2EXT - routine used to transfer 
"RTN","BPSOSU1",27,0)
 ;  the dates.  Now that NCPDP 5.1 stores the field ID with all the
"RTN","BPSOSU1",28,0)
 ;  fields, we needed currently just want to skip transforming the
"RTN","BPSOSU1",29,0)
 ;  date for 5.1 type claims
"RTN","BPSOSU1",30,0)
 ;
"RTN","BPSOSU1",31,0)
 ;
"RTN","BPSOSU1",32,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",33,0)
DATE(PROMPT,DFLT,OPT,SDATE,EDATE,%DT,TIMEOUT) ;EP -
"RTN","BPSOSU1",34,0)
 ;
"RTN","BPSOSU1",35,0)
 N XDATA,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU1",36,0)
 ;
"RTN","BPSOSU1",37,0)
 Q:$G(PROMPT)="" ""
"RTN","BPSOSU1",38,0)
 ;
"RTN","BPSOSU1",39,0)
 S $P(DIR(0),"^",1)="DA"_$S(OPT=1:"O",1:"")
"RTN","BPSOSU1",40,0)
 S $P(XDATA,":",1)=SDATE
"RTN","BPSOSU1",41,0)
 S $P(XDATA,":",2)=EDATE
"RTN","BPSOSU1",42,0)
 S $P(XDATA,":",3)=%DT
"RTN","BPSOSU1",43,0)
 S $P(DIR(0),"^",2)=XDATA
"RTN","BPSOSU1",44,0)
 S DIR("A")=PROMPT
"RTN","BPSOSU1",45,0)
 S:$G(DFLT)'="" DIR("B")=$$FM2EXT(DFLT)
"RTN","BPSOSU1",46,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU1",47,0)
 D ^DIR
"RTN","BPSOSU1",48,0)
 Q $S($G(DTOUT)=1:-1,$G(DIROUT)=1:"^^",$G(DUOUT)=1:"^",1:Y)
"RTN","BPSOSU1",49,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",50,0)
 ;Convert FileMan Date to External Date Format
"RTN","BPSOSU1",51,0)
 ;
"RTN","BPSOSU1",52,0)
 ;Parameters:    Y       - FileMan formatted date (YYYMMDD.HHMMSS)
"RTN","BPSOSU1",53,0)
 ;Returns:      Y       - External date
"RTN","BPSOSU1",54,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",55,0)
FM2EXT(Y) ;EP
"RTN","BPSOSU1",56,0)
 Q:$G(^DD("DD"))="" ""
"RTN","BPSOSU1",57,0)
 X ^DD("DD")
"RTN","BPSOSU1",58,0)
 Q $S($E(Y,1,3)?3A:Y,1:"")
"RTN","BPSOSU1",59,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",60,0)
 ;
"RTN","BPSOSU1",61,0)
FM3EXT(Y) ;EP   IHS/SD/lwj 8/5/02 clone of FM2EXT- accommodates 5.1 type clms
"RTN","BPSOSU1",62,0)
 Q:$E(Y,1,1)["C" Y
"RTN","BPSOSU1",63,0)
 S Y=Y-17000000
"RTN","BPSOSU1",64,0)
 Q:$G(^DD("DD"))="" ""
"RTN","BPSOSU1",65,0)
 X ^DD("DD")
"RTN","BPSOSU1",66,0)
 Q $S($E(Y,1,3)?3A:Y,1:"")
"RTN","BPSOSU1",67,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",68,0)
 ;
"RTN","BPSOSU1",69,0)
FM2MDY(Y) ;EP
"RTN","BPSOSU1",70,0)
 Q:Y="" ""
"RTN","BPSOSU1",71,0)
 Q $E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)
"RTN","BPSOSU1",72,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",73,0)
 ;Convert External Date to FileMan Date Format
"RTN","BPSOSU1",74,0)
 ;
"RTN","BPSOSU1",75,0)
 ;Parameters:   X       - External date
"RTN","BPSOSU1",76,0)
 ;Returns:      Y       - FileMan formatted date (YYYMMDD.HHMMSS)
"RTN","BPSOSU1",77,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",78,0)
EXT2FM(X) ;
"RTN","BPSOSU1",79,0)
 N %DT,Y
"RTN","BPSOSU1",80,0)
 Q:$G(X)="" ""
"RTN","BPSOSU1",81,0)
 D ^%DT
"RTN","BPSOSU1",82,0)
 Q Y
"RTN","BPSOSU1",83,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",84,0)
 ;Returns current Date/Time in FileMan date format
"RTN","BPSOSU1",85,0)
NOWFM() ;EP
"RTN","BPSOSU1",86,0)
 N %,%H,%I,X
"RTN","BPSOSU1",87,0)
 D NOW^%DTC
"RTN","BPSOSU1",88,0)
 Q %
"RTN","BPSOSU1",89,0)
NOWEXT() ;EP - External form of $$NOWFM
"RTN","BPSOSU1",90,0)
 N Y S Y=$$NOWFM X ^DD("DD") Q Y
"RTN","BPSOSU1",91,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",92,0)
 ;Takes a FileMan date and adds or subtracts days
"RTN","BPSOSU1",93,0)
 ;
"RTN","BPSOSU1",94,0)
 ;Parameters:   X1   - FileMan formatted date
"RTN","BPSOSU1",95,0)
 ;              X2   - Number of days (ECME = add, neg = subtract)
"RTN","BPSOSU1",96,0)
 ;Returns:      X    - Resulting FileMan formatted date
"RTN","BPSOSU1",97,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",98,0)
CDTFM(X1,X2) ;EP - BPSER*,BPSES02
"RTN","BPSOSU1",99,0)
 N X,%H
"RTN","BPSOSU1",100,0)
 Q:$G(X1)="" ""
"RTN","BPSOSU1",101,0)
 Q:$G(X2)="" ""
"RTN","BPSOSU1",102,0)
 D C^%DTC
"RTN","BPSOSU1",103,0)
 Q X
"RTN","BPSOSU1",104,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",105,0)
 ;Takes a FileMan date and returns 3-digit julian date
"RTN","BPSOSU1",106,0)
JULDATE(DT) ;
"RTN","BPSOSU1",107,0)
 N X,X1,X2,%H,%T,%Y
"RTN","BPSOSU1",108,0)
 Q:'(DT?7N) ""
"RTN","BPSOSU1",109,0)
 S X2=$E(DT,1,3)_"0101",X1=DT
"RTN","BPSOSU1",110,0)
 D ^%DTC
"RTN","BPSOSU1",111,0)
 S X=X+1
"RTN","BPSOSU1",112,0)
 Q $TR($J(X,3)," ","0")
"RTN","BPSOSU1",113,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",114,0)
 ;
"RTN","BPSOSU1",115,0)
 ;$$DTR(AA,AB,ADEF,BDEF,T) Input Beginning & Ending prompts, return
"RTN","BPSOSU1",116,0)
 ;                       "Begin date^End date" or 0 if unsuccessful.
"RTN","BPSOSU1",117,0)
 ;$$DTR() is okay - all args are optional
"RTN","BPSOSU1",118,0)
 ;$$DTP(AA,DEF) Input a prompt, return a single date "Internal^External"
"RTN","BPSOSU1",119,0)
 ;$$DTM(AA,DEF) Input a prompt, return month/year "Internal^External"
"RTN","BPSOSU1",120,0)
 ;--------------------------------------------------------------------
"RTN","BPSOSU1",121,0)
 ;
"RTN","BPSOSU1",122,0)
DTR(AA,AB,ADEF,BDEF,T) ;EP - GET THE DATE RANGE (beginning and ending dates)
"RTN","BPSOSU1",123,0)
 ; IN:
"RTN","BPSOSU1",124,0)
 ;    AA   = PROMPT for BEGINNING DATE
"RTN","BPSOSU1",125,0)
 ;    AB   = PROMPT for ENDING DATE
"RTN","BPSOSU1",126,0)
 ;    ADEF = DEFAULT date for BEGINNING DATE
"RTN","BPSOSU1",127,0)
 ;    BDEF = DEFAULT date for ENDING DATE
"RTN","BPSOSU1",128,0)
 ;    T    = whether TIME is allowed as entry, and if REQUIRED
"RTN","BPSOSU1",129,0)
 ;           (If T="T" then TIME is allowed; is REQ'd if T="R").
"RTN","BPSOSU1",130,0)
 ; OUT:
"RTN","BPSOSU1",131,0)
 ;    Beginning Date^Ending Date in 7digit FileMan format
"RTN","BPSOSU1",132,0)
 ;      If user enters "^" then out=0
"RTN","BPSOSU1",133,0)
 ;
"RTN","BPSOSU1",134,0)
 NEW %DT,X,Y,U,PROMPT,DEFAULT,BEGDT,ENDDT
"RTN","BPSOSU1",135,0)
 S U="^"
"RTN","BPSOSU1",136,0)
 ;
"RTN","BPSOSU1",137,0)
DTR1 ; -- Get beginning date
"RTN","BPSOSU1",138,0)
 S %DT="AE"_$G(T)
"RTN","BPSOSU1",139,0)
 I $D(AA) S PROMPT=AA
"RTN","BPSOSU1",140,0)
 E  S PROMPT="Enter the Beginning Date"_$S($G(T)]"":" @ Time",1:"")_": "
"RTN","BPSOSU1",141,0)
 S:$D(ADEF) DEFAULT=ADEF
"RTN","BPSOSU1",142,0)
 S BEGDT=$$DATE^BPSOSU1(PROMPT,$G(DEFAULT),1,1000101,3991231,%DT,$G(DTIME))
"RTN","BPSOSU1",143,0)
 I BEGDT<1 QUIT 0
"RTN","BPSOSU1",144,0)
 ;
"RTN","BPSOSU1",145,0)
 WRITE !
"RTN","BPSOSU1",146,0)
 S %DT="AE"_$G(T)
"RTN","BPSOSU1",147,0)
 I $D(AB) S PROMPT=AB
"RTN","BPSOSU1",148,0)
 E  S PROMPT="Enter the Ending Date"_$S($G(T)]"":" @ Time",1:"")_": "
"RTN","BPSOSU1",149,0)
 S:$D(BDEF) DEFAULT=BDEF
"RTN","BPSOSU1",150,0)
 S ENDDT=$$DATE^BPSOSU1(PROMPT,$G(DEFAULT),1,BEGDT,3991231,%DT,$G(DTIME))
"RTN","BPSOSU1",151,0)
 I ENDDT["^" Q 0  ;user wants out if "^"
"RTN","BPSOSU1",152,0)
 ; -- Ensure END date is not earlier than BEG date
"RTN","BPSOSU1",153,0)
 I ENDDT<BEGDT WRITE $C(7),!!,"Ending date must not be less than beginning date!",!! HANG 2 GOTO DTR1
"RTN","BPSOSU1",154,0)
 QUIT BEGDT_U_ENDDT
"RTN","BPSOSU1",155,0)
 ;--------------------------------------------------------------------
"RTN","BPSOSU1",156,0)
 ;
"RTN","BPSOSU1",157,0)
 ;
"RTN","BPSOSU1",158,0)
DTP(AA,DEF) ;EP - *** GET A SINGLE PAST DATE, TIME NOT ALLOWED ***
"RTN","BPSOSU1",159,0)
 ;
"RTN","BPSOSU1",160,0)
 ; IN:  AA  = PROMPT you want displayed to user
"RTN","BPSOSU1",161,0)
 ;      DEF = DEFAULT date
"RTN","BPSOSU1",162,0)
 ; OUT: FileMan Date^readable Date
"RTN","BPSOSU1",163,0)
 ;      If user enters "^" then OUT=0
"RTN","BPSOSU1",164,0)
 ;
"RTN","BPSOSU1",165,0)
 NEW %DT,Y,DATE
"RTN","BPSOSU1",166,0)
 S:'$D(U) U="^"
"RTN","BPSOSU1",167,0)
 I '$D(DT)#2 DO DT^DICRW ;get today's date
"RTN","BPSOSU1",168,0)
 S U="^"
"RTN","BPSOSU1",169,0)
 S %DT="AEPX" ;ask, echo, past dates assumed, exact date reqd
"RTN","BPSOSU1",170,0)
 S %DT("A")=$S($D(AA):AA,1:"What DATE: ")
"RTN","BPSOSU1",171,0)
 S:$D(DEF) %DT("B")=DEF
"RTN","BPSOSU1",172,0)
 DO ^%DT KILL %DT
"RTN","BPSOSU1",173,0)
 ; -- Q if no data
"RTN","BPSOSU1",174,0)
 I Y<1 QUIT 0  ;quit if date was invalid
"RTN","BPSOSU1",175,0)
 I $D(DTOUT) QUIT 0  ;quit if timeout occurred
"RTN","BPSOSU1",176,0)
 ; -- Define dates
"RTN","BPSOSU1",177,0)
 ; DATE("Y") is FM format date; DATE is MON DD,YEAR format.
"RTN","BPSOSU1",178,0)
 S DATE("Y")=Y XECUTE ^DD("DD") S DATE=Y
"RTN","BPSOSU1",179,0)
 QUIT DATE("Y")_U_DATE
"RTN","BPSOSU1",180,0)
 ;--------------------------------------------------------------------
"RTN","BPSOSU2")
0^250^B3426741
"RTN","BPSOSU2",1,0)
BPSOSU2 ;BHAM ISC/FCS/DRS/FLS - copied for ECME ;06/01/2004
"RTN","BPSOSU2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSU2",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU2",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU2",5,0)
 ;Standard FREETEXT and Numeric Functions
"RTN","BPSOSU2",6,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU2",7,0)
 ;Standard FREETEXT PROMPT:
"RTN","BPSOSU2",8,0)
 ;
"RTN","BPSOSU2",9,0)
 ;Parameters:
"RTN","BPSOSU2",10,0)
 ;    PROMPT  = Text to be displayed before read
"RTN","BPSOSU2",11,0)
 ;    DFLT    = DEFAULT text
"RTN","BPSOSU2",12,0)
 ;    OPT     = 1 - Answer optional       0 - Answer required
"RTN","BPSOSU2",13,0)
 ;    MINLEN  = Minimum length of response text
"RTN","BPSOSU2",14,0)
 ;    MAXLEN  = Maximum length of response text
"RTN","BPSOSU2",15,0)
 ;    TIMEOUT = Number of seconds
"RTN","BPSOSU2",16,0)
 ;
"RTN","BPSOSU2",17,0)
 ;Returns:
"RTN","BPSOSU2",18,0)
 ;    <null>  = No response             <^> - Up-arrow entered
"RTN","BPSOSU2",19,0)
 ;    <-1>    = Timeout occurred       <^^> - Two up-arrows entered
"RTN","BPSOSU2",20,0)
 ;    <text>  = Response text
"RTN","BPSOSU2",21,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU2",22,0)
FREETEXT(PROMPT,DFLT,OPT,MINLEN,MAXLEN,TIMEOUT) ;EP
"RTN","BPSOSU2",23,0)
 ;
"RTN","BPSOSU2",24,0)
 N XDATA,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU2",25,0)
 ;
"RTN","BPSOSU2",26,0)
 Q:$G(PROMPT)="" ""
"RTN","BPSOSU2",27,0)
 S:$G(MINLEN)="" MINLEN=0
"RTN","BPSOSU2",28,0)
 S:$G(MAXLEN)="" MAXLEN=245
"RTN","BPSOSU2",29,0)
 ;
"RTN","BPSOSU2",30,0)
 S $P(DIR(0),"^",1)="FA"_$S(OPT=1:"O",1:"")
"RTN","BPSOSU2",31,0)
 S $P(XDATA,":",1)=MINLEN
"RTN","BPSOSU2",32,0)
 S $P(XDATA,":",2)=MAXLEN
"RTN","BPSOSU2",33,0)
 S $P(DIR(0),"^",2)=XDATA
"RTN","BPSOSU2",34,0)
 S DIR("A")=PROMPT
"RTN","BPSOSU2",35,0)
 S:$G(DFLT)'="" DIR("B")=DFLT
"RTN","BPSOSU2",36,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU2",37,0)
 D ^DIR
"RTN","BPSOSU2",38,0)
 Q $S($G(DTOUT)=1:-1,$G(DIROUT)=1:"^^",$G(DUOUT)=1:"^",1:Y)
"RTN","BPSOSU2",39,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU2",40,0)
 ;Standard Numeric PROMPT:
"RTN","BPSOSU2",41,0)
 ;
"RTN","BPSOSU2",42,0)
 ;Parameters:
"RTN","BPSOSU2",43,0)
 ;    PROMPT  = Text to be displayed before read
"RTN","BPSOSU2",44,0)
 ;    DFLT    = DEFAULT Numeric
"RTN","BPSOSU2",45,0)
 ;    OPT     = 1 - Answer optional       0 - Answer required
"RTN","BPSOSU2",46,0)
 ;    MINNUM  = Minimum numeric value
"RTN","BPSOSU2",47,0)
 ;    MAXNUM  = Maximum numeric value
"RTN","BPSOSU2",48,0)
 ;    MAXDEC  = Maximum number of decimal places allowed
"RTN","BPSOSU2",49,0)
 ;    TIMEOUT = Number of seconds
"RTN","BPSOSU2",50,0)
 ;
"RTN","BPSOSU2",51,0)
 ;Returns:
"RTN","BPSOSU2",52,0)
 ;    <null>     = No response             <^> - Up-arrow entered
"RTN","BPSOSU2",53,0)
 ;    <-1>       = Timeout occurred       <^^> - Two up-arrows entered
"RTN","BPSOSU2",54,0)
 ;    <Numeric>  = Response Numeric
"RTN","BPSOSU2",55,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU2",56,0)
NUMERIC(PROMPT,DFLT,OPT,MINNUM,MAXNUM,MAXDEC,TIMEOUT) ;EP
"RTN","BPSOSU2",57,0)
 ;
"RTN","BPSOSU2",58,0)
 N XDATA,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU2",59,0)
 ;
"RTN","BPSOSU2",60,0)
 Q:$G(PROMPT)="" ""
"RTN","BPSOSU2",61,0)
 ;
"RTN","BPSOSU2",62,0)
 S $P(DIR(0),"^",1)="NA"_$S(OPT=1:"O",1:"")
"RTN","BPSOSU2",63,0)
 S $P(XDATA,":",1)=$G(MINNUM)
"RTN","BPSOSU2",64,0)
 S $P(XDATA,":",2)=$G(MAXNUM)
"RTN","BPSOSU2",65,0)
 S $P(XDATA,":",3)=$G(MAXDEC)
"RTN","BPSOSU2",66,0)
 S $P(DIR(0),"^",2)=XDATA
"RTN","BPSOSU2",67,0)
 S DIR("A")=PROMPT
"RTN","BPSOSU2",68,0)
 S:$G(DFLT)'="" DIR("B")=DFLT
"RTN","BPSOSU2",69,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU2",70,0)
 D ^DIR
"RTN","BPSOSU2",71,0)
 Q $S($G(DTOUT)=1:-1,$G(DIROUT)=1:"^^",$G(DUOUT)=1:"^",1:Y)
"RTN","BPSOSU3")
0^251^B2603527
"RTN","BPSOSU3",1,0)
BPSOSU3 ;BHAM ISC/FCS/DRS/FLS - copied for ECME ;06/01/2004
"RTN","BPSOSU3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSU3",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU3",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU3",5,0)
 ;Standard SET and YESNO Functions
"RTN","BPSOSU3",6,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU3",7,0)
 ;Standard SET PROMPT:
"RTN","BPSOSU3",8,0)
 ;
"RTN","BPSOSU3",9,0)
 ;Parameters:
"RTN","BPSOSU3",10,0)
 ;    PROMPT  = Text to be displayed before read
"RTN","BPSOSU3",11,0)
 ;    DFLT    = DEFAULT choice (external format)
"RTN","BPSOSU3",12,0)
 ;    OPT     = 1 - Answer optional       0 - Answer required
"RTN","BPSOSU3",13,0)
 ;    DISPLAY = V - Vertical display      H - Horizontal display
"RTN","BPSOSU3",14,0)
 ;              N - No display
"RTN","BPSOSU3",15,0)
 ;    CHOICES = <code>:<choice>;<code>:<choice>.....
"RTN","BPSOSU3",16,0)
 ;    TIMEOUT = Number of seconds
"RTN","BPSOSU3",17,0)
 ;
"RTN","BPSOSU3",18,0)
 ;Returns:
"RTN","BPSOSU3",19,0)
 ;    <null>     = No response             <^> - Up-arrow entered
"RTN","BPSOSU3",20,0)
 ;    <-1>       = Timeout occurred       <^^> - Two up-arrows entered
"RTN","BPSOSU3",21,0)
 ;    <Choice>   = Response choice (internal format)
"RTN","BPSOSU3",22,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU3",23,0)
SET(PROMPT,DFLT,OPT,DISPLAY,CHOICES,TIMEOUT) ;EP
"RTN","BPSOSU3",24,0)
 ;
"RTN","BPSOSU3",25,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU3",26,0)
 ;
"RTN","BPSOSU3",27,0)
 Q:$G(PROMPT)="" ""
"RTN","BPSOSU3",28,0)
 Q:$G(DISPLAY)="" ""
"RTN","BPSOSU3",29,0)
 Q:$G(CHOICES)="" ""
"RTN","BPSOSU3",30,0)
 ;
"RTN","BPSOSU3",31,0)
 S $P(DIR(0),"^",1)="S"_$S(DISPLAY="H":"B",DISPLAY="N":"A",1:"")_$S(OPT=1:"O",1:"")
"RTN","BPSOSU3",32,0)
 S $P(DIR(0),"^",2)=CHOICES
"RTN","BPSOSU3",33,0)
 S DIR("A")=PROMPT
"RTN","BPSOSU3",34,0)
 S:$G(DFLT)'="" DIR("B")=DFLT
"RTN","BPSOSU3",35,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU3",36,0)
 D ^DIR
"RTN","BPSOSU3",37,0)
 Q $S($G(DTOUT)=1:-1,$G(DIROUT)=1:"^^",$G(DUOUT)=1:"^",1:Y)
"RTN","BPSOSU3",38,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU3",39,0)
 ;Standard Yes/No PROMPT:
"RTN","BPSOSU3",40,0)
 ;
"RTN","BPSOSU3",41,0)
 ;Parameters:
"RTN","BPSOSU3",42,0)
 ;    PROMPT  = Text to be displayed before read
"RTN","BPSOSU3",43,0)
 ;    DFLT    = YES, NO or <Null>
"RTN","BPSOSU3",44,0)
 ;    OPT     = 1 - Answer optional       0 - Answer required
"RTN","BPSOSU3",45,0)
 ;    TIMEOUT = Number of seconds
"RTN","BPSOSU3",46,0)
 ;
"RTN","BPSOSU3",47,0)
 ;Returns:
"RTN","BPSOSU3",48,0)
 ;    <null>     = No response             <^> - Up-arrow entered
"RTN","BPSOSU3",49,0)
 ;    <-1>       = Timeout occurred       <^^> - Two up-arrows entered
"RTN","BPSOSU3",50,0)
 ;    <0>        = No                      <1> - Yes
"RTN","BPSOSU3",51,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU3",52,0)
YESNO(PROMPT,DFLT,OPT,TIMEOUT) ;EP
"RTN","BPSOSU3",53,0)
 ;
"RTN","BPSOSU3",54,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU3",55,0)
 ;
"RTN","BPSOSU3",56,0)
 Q:$G(PROMPT)="" ""
"RTN","BPSOSU3",57,0)
 ;
"RTN","BPSOSU3",58,0)
 S $P(DIR(0),"^",1)="Y"_$S(OPT=1:"O",1:"")
"RTN","BPSOSU3",59,0)
 S DIR("A")=PROMPT
"RTN","BPSOSU3",60,0)
 S:$G(DFLT)'="" DIR("B")=DFLT
"RTN","BPSOSU3",61,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU3",62,0)
 D ^DIR
"RTN","BPSOSU3",63,0)
 Q $S($G(DTOUT)=1:-1,$G(DIROUT)=1:"^^",$G(DUOUT)=1:"^",1:Y)
"RTN","BPSOSU4")
0^252^B24645469
"RTN","BPSOSU4",1,0)
BPSOSU4 ;BHAM ISC/FCS/DRS/FLS - copied for ECME ;06/01/2004
"RTN","BPSOSU4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSU4",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",5,0)
 ;Standard List PROMPT:
"RTN","BPSOSU4",6,0)
 ;
"RTN","BPSOSU4",7,0)
 ;Parameters:
"RTN","BPSOSU4",8,0)
 ;   TYPE     - S or M (single or multiple selection)
"RTN","BPSOSU4",9,0)
 ;   LROOT    - List global root (eg: "^LIST($J,")
"RTN","BPSOSU4",10,0)
 ;   AROOT    - Answer global root (eg: "^LISTANS($J,")
"RTN","BPSOSU4",11,0)
 ;   STITLE   - Screen Title
"RTN","BPSOSU4",12,0)
 ;   .PROMPT  - List PROMPT Array
"RTN","BPSOSU4",13,0)
 ;   OPTIONAL - 1 or 0 (optional or required)
"RTN","BPSOSU4",14,0)
 ;   PGLEN    - Page length
"RTN","BPSOSU4",15,0)
 ;   TIMEOUT  - Number of seconds
"RTN","BPSOSU4",16,0)
 ;
"RTN","BPSOSU4",17,0)
 ;Returns:
"RTN","BPSOSU4",18,0)
 ;   <null>   - Unable to process list
"RTN","BPSOSU4",19,0)
 ;   <Ans>    - For TYPE="S", item selected
"RTN","BPSOSU4",20,0)
 ;   <^>      - Up-arrow entered
"RTN","BPSOSU4",21,0)
 ;   <^^>     - Two up-arrows entered
"RTN","BPSOSU4",22,0)
 ;   <-1>     - Timeout occurred
"RTN","BPSOSU4",23,0)
 ;
"RTN","BPSOSU4",24,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",25,0)
LIST(TYPE,LROOT,AROOT,STITLE,PROMPT,OPTIONAL,PGLEN,TIMEOUT) ;EP
"RTN","BPSOSU4",26,0)
 ;
"RTN","BPSOSU4",27,0)
 ;Manage local variables
"RTN","BPSOSU4",28,0)
 N CPAGE,NPAGES,START,END,ANS,NLINES,CHEAD1,CHEAD2,I,CMD
"RTN","BPSOSU4",29,0)
 ;
"RTN","BPSOSU4",30,0)
 Q:$G(TYPE)="" ""
"RTN","BPSOSU4",31,0)
 Q:$G(LROOT)="" ""
"RTN","BPSOSU4",32,0)
 Q:$G(AROOT)="" ""
"RTN","BPSOSU4",33,0)
 ;
"RTN","BPSOSU4",34,0)
 S STITLE=$G(STITLE)
"RTN","BPSOSU4",35,0)
 S OPTIONAL=+$G(OPTIONAL)
"RTN","BPSOSU4",36,0)
 S:$G(PGLEN)="" PGLEN=10
"RTN","BPSOSU4",37,0)
 S:$G(TIMEOUT)="" TIMEOUT=$G(DTIME)
"RTN","BPSOSU4",38,0)
 ;
"RTN","BPSOSU4",39,0)
 D INIT
"RTN","BPSOSU4",40,0)
LP1 D DPAGE
"RTN","BPSOSU4",41,0)
 S ANS=$$PROMPT()
"RTN","BPSOSU4",42,0)
 I ANS="?" D DHELP G LP1
"RTN","BPSOSU4",43,0)
 Q:(TYPE="M")&('OPTIONAL)&(ANS="^")&($D(@($E(AROOT,1,$L(AROOT)-1)_")"))'=0) ANS
"RTN","BPSOSU4",44,0)
 Q:OPTIONAL&(ANS="^") ANS
"RTN","BPSOSU4",45,0)
 Q:ANS="^^" ANS
"RTN","BPSOSU4",46,0)
 Q:ANS="TIMEOUT" -1
"RTN","BPSOSU4",47,0)
 I ANS="" D NEXTPG G LP1
"RTN","BPSOSU4",48,0)
 I $E(ANS,1)="P" D JUMPPG G LP1
"RTN","BPSOSU4",49,0)
 ;
"RTN","BPSOSU4",50,0)
 I TYPE="S"&(+ANS<1!(+ANS>END)) G LP1
"RTN","BPSOSU4",51,0)
 I TYPE="S"&(+ANS>0&(+ANS'>END)) S @(AROOT_(+ANS)_")")="" Q ANS
"RTN","BPSOSU4",52,0)
 I TYPE="M" F I=1:1:$L(ANS,",") D
"RTN","BPSOSU4",53,0)
 .S CMD=$P(ANS,",",I)
"RTN","BPSOSU4",54,0)
 .I CMD?1N.N D MARK(CMD) Q
"RTN","BPSOSU4",55,0)
 .I CMD?1"-".N D UNMARK($P(CMD,"-",2)) Q
"RTN","BPSOSU4",56,0)
 .I CMD?1N.N1"-"1N.N D RMARK(CMD) Q
"RTN","BPSOSU4",57,0)
 .I CMD?1"-"1N.N1"-"1N.N D RUNMARK(CMD) Q
"RTN","BPSOSU4",58,0)
 G LP1
"RTN","BPSOSU4",59,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",60,0)
HEADER N LINE
"RTN","BPSOSU4",61,0)
 W @IOF,!
"RTN","BPSOSU4",62,0)
 D:STITLE'="" WCENTER^BPSOSU9(STITLE,IOM)
"RTN","BPSOSU4",63,0)
 D:STITLE'="" WCENTER^BPSOSU9($TR($J("",$L(STITLE))," ","-"),IOM)
"RTN","BPSOSU4",64,0)
 ;
"RTN","BPSOSU4",65,0)
 ;DISPLAY PROMPT LINEs
"RTN","BPSOSU4",66,0)
 S LINE=0
"RTN","BPSOSU4",67,0)
 F  D  Q:LINE=""
"RTN","BPSOSU4",68,0)
 .S LINE=$O(PROMPT(LINE))
"RTN","BPSOSU4",69,0)
 .Q:LINE=""
"RTN","BPSOSU4",70,0)
 .W:LINE=1 !!
"RTN","BPSOSU4",71,0)
 .W PROMPT(LINE),!
"RTN","BPSOSU4",72,0)
 ;
"RTN","BPSOSU4",73,0)
 W:$G(CHEAD1)'="" !,?9,CHEAD1,!
"RTN","BPSOSU4",74,0)
 W:$G(CHEAD2)'="" ?9,CHEAD2
"RTN","BPSOSU4",75,0)
 Q
"RTN","BPSOSU4",76,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",77,0)
INIT N CNSPACES,CNAMES,CDEF,INDEX,COLUMNS
"RTN","BPSOSU4",78,0)
 S NLINES=+$G(@(LROOT_"0)")) I 'NLINES D  Q
"RTN","BPSOSU4",79,0)
 . D IMPOSS^BPSOSUE("P","TI","0 lines indicated in "_LROOT,,"INIT",$T(+0))
"RTN","BPSOSU4",80,0)
 S NPAGES=((NLINES-1)\PGLEN)+1
"RTN","BPSOSU4",81,0)
 S CPAGE=1
"RTN","BPSOSU4",82,0)
 S COLUMNS=$G(@(LROOT_"""Column HEADERs"""_")"))
"RTN","BPSOSU4",83,0)
 D:COLUMNS'=""
"RTN","BPSOSU4",84,0)
 .S (CHEAD1,CHEAD2)=""
"RTN","BPSOSU4",85,0)
 .S CNSPACES=$P(COLUMNS,"|",1)
"RTN","BPSOSU4",86,0)
 .S CNAMES=$P(COLUMNS,"|",2)
"RTN","BPSOSU4",87,0)
 .F INDEX=1:1:$L(CNAMES,",") D
"RTN","BPSOSU4",88,0)
 ..S CDEF=$P(CNAMES,",",INDEX)
"RTN","BPSOSU4",89,0)
 ..S CHEAD1=CHEAD1_$S(INDEX=1:"",1:$J("",CNSPACES))_$$LJBF^BPSOSU9($P(CDEF,":",1),$P(CDEF,":",2))
"RTN","BPSOSU4",90,0)
 ..S CHEAD2=CHEAD2_$S(INDEX=1:"",1:$J("",CNSPACES))_$TR($J("",$P(CDEF,":",2))," ","-")
"RTN","BPSOSU4",91,0)
 Q
"RTN","BPSOSU4",92,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",93,0)
MARK(X) ;
"RTN","BPSOSU4",94,0)
 Q:X<1!(X>NLINES)
"RTN","BPSOSU4",95,0)
 S @(AROOT_X_")")=""
"RTN","BPSOSU4",96,0)
 Q
"RTN","BPSOSU4",97,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",98,0)
RMARK(X) ;
"RTN","BPSOSU4",99,0)
 N START,END,INDEX
"RTN","BPSOSU4",100,0)
 S START=$P(X,"-",1)
"RTN","BPSOSU4",101,0)
 S END=$P(X,"-",2)
"RTN","BPSOSU4",102,0)
 F INDEX=START:1:END D MARK(INDEX)
"RTN","BPSOSU4",103,0)
 Q
"RTN","BPSOSU4",104,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",105,0)
UNMARK(X) ;
"RTN","BPSOSU4",106,0)
 Q:X<1!(X>NLINES)
"RTN","BPSOSU4",107,0)
 K @(AROOT_X_")")
"RTN","BPSOSU4",108,0)
 Q
"RTN","BPSOSU4",109,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",110,0)
RUNMARK(X) ;
"RTN","BPSOSU4",111,0)
 N START,END,INDEX
"RTN","BPSOSU4",112,0)
 S START=$P(X,"-",2)
"RTN","BPSOSU4",113,0)
 S END=$P(X,"-",3)
"RTN","BPSOSU4",114,0)
 F INDEX=START:1:END D UNMARK(INDEX)
"RTN","BPSOSU4",115,0)
 Q
"RTN","BPSOSU4",116,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",117,0)
DPAGE N LNUM
"RTN","BPSOSU4",118,0)
 D HEADER
"RTN","BPSOSU4",119,0)
 W !
"RTN","BPSOSU4",120,0)
 S START=((CPAGE-1)*PGLEN)+1
"RTN","BPSOSU4",121,0)
 S END=START+PGLEN-1
"RTN","BPSOSU4",122,0)
 S:END>NLINES END=NLINES
"RTN","BPSOSU4",123,0)
 F LNUM=START:1:END D
"RTN","BPSOSU4",124,0)
 .W $S($D(@(AROOT_LNUM_")")):"*",1:" ")
"RTN","BPSOSU4",125,0)
 .W $J(LNUM,5)," - "
"RTN","BPSOSU4",126,0)
 .W $G(@(LROOT_LNUM_","_"""E"""_")")),!
"RTN","BPSOSU4",127,0)
 Q
"RTN","BPSOSU4",128,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",129,0)
PROMPT() ;
"RTN","BPSOSU4",130,0)
 W:TYPE="S" !,"[Page "_CPAGE_" of "_NPAGES_"]  Commands: #, P#, <Enter>, ^, ^^ or ?",!
"RTN","BPSOSU4",131,0)
 W:TYPE="M" !,"[Page "_CPAGE_" of "_NPAGES_"]  Commands: #, -#, #-#, -#-#, P#, <Enter>, ^, ^^ or ?",!
"RTN","BPSOSU4",132,0)
 W "Select Item #: "
"RTN","BPSOSU4",133,0)
 R ANS:TIMEOUT
"RTN","BPSOSU4",134,0)
 I '$T S ANS="TIMEOUT"
"RTN","BPSOSU4",135,0)
 Q ANS
"RTN","BPSOSU4",136,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",137,0)
NEXTPG S CPAGE=CPAGE+1
"RTN","BPSOSU4",138,0)
 S:CPAGE>NPAGES CPAGE=NPAGES
"RTN","BPSOSU4",139,0)
 Q
"RTN","BPSOSU4",140,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",141,0)
JUMPPG N NUM
"RTN","BPSOSU4",142,0)
 Q:$E(ANS,1)'="P"
"RTN","BPSOSU4",143,0)
 S NUM=+$P(ANS,"P",2)
"RTN","BPSOSU4",144,0)
 Q:NUM<1!(NUM>NPAGES)
"RTN","BPSOSU4",145,0)
 S CPAGE=NUM
"RTN","BPSOSU4",146,0)
 Q
"RTN","BPSOSU4",147,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",148,0)
DHELP ;
"RTN","BPSOSU4",149,0)
 N X
"RTN","BPSOSU4",150,0)
 W !!,"Enter one of the following commands:",!!
"RTN","BPSOSU4",151,0)
 W ?10,"#",?20,"- Selects entry number # from the list",!
"RTN","BPSOSU4",152,0)
 W:TYPE="M" ?10,"-#",?20,"- Deselects entry number # from the list",!
"RTN","BPSOSU4",153,0)
 W:TYPE="M" ?10,"#-#",?20,"- Selects the range of entries # thru #",!
"RTN","BPSOSU4",154,0)
 W:TYPE="M" ?10,"-#-#",?20,"- Deselects the range of entries # thru #",!
"RTN","BPSOSU4",155,0)
 W:TYPE="M"!(TYPE="S"&(OPTIONAL)) ?10,"^",?20,"- Exit the list",!
"RTN","BPSOSU4",156,0)
 W ?10,"P#",?20,"- Jumps to page number #",!
"RTN","BPSOSU4",157,0)
 W ?10,"<Enter>",?20,"- DISPLAYs next page",!
"RTN","BPSOSU4",158,0)
 W ?10,"^^",?20,"- Aborts and returns to menu",!
"RTN","BPSOSU4",159,0)
 W ?10,"?",?20,"- DISPLAYs this help text",!!
"RTN","BPSOSU4",160,0)
 D PRESSANY^BPSOSU5(0,TIMEOUT)
"RTN","BPSOSU4",161,0)
 Q
"RTN","BPSOSU5")
0^253^B1961538
"RTN","BPSOSU5",1,0)
BPSOSU5 ;BHAM ISC/FCS/DRS/FLS - utilities ;06/01/2004
"RTN","BPSOSU5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSU5",3,0)
 Q
"RTN","BPSOSU5",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU5",5,0)
TOSCREEN()         ;EP; True or False, is output to screen?
"RTN","BPSOSU5",6,0)
 I $E(IOST)'="C" Q 0
"RTN","BPSOSU5",7,0)
 I $D(ZTQUEUED) Q 0
"RTN","BPSOSU5",8,0)
 I IOT'="TRM",IOT'="VTRM" Q 0
"RTN","BPSOSU5",9,0)
 I $D(IO("S")) Q 0
"RTN","BPSOSU5",10,0)
 Q 1
"RTN","BPSOSU5",11,0)
PRESSANY(NLF,TIMEOUT) ;EP
"RTN","BPSOSU5",12,0)
 I '$$TOSCREEN Q
"RTN","BPSOSU5",13,0)
 N X,I
"RTN","BPSOSU5",14,0)
 S NLF=+$G(NLF)
"RTN","BPSOSU5",15,0)
 S:+$G(TIMEOUT)=0 TIMEOUT=30
"RTN","BPSOSU5",16,0)
 F I=1:1:NLF W !
"RTN","BPSOSU5",17,0)
 I $$FREETEXT^BPSOSU2("Press ENTER to continue: ",,1,1,1,300)
"RTN","BPSOSU5",18,0)
 Q
"RTN","BPSOSU5",19,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU5",20,0)
 ;'Press the return key to continue of ^ to exit:' PROMPT
"RTN","BPSOSU5",21,0)
 ; See also $$EOPQ^BPSOSU8
"RTN","BPSOSU5",22,0)
ENDPAGE(NLF,TIMEOUT) ;EP
"RTN","BPSOSU5",23,0)
 I '$$TOSCREEN Q 1
"RTN","BPSOSU5",24,0)
 N X,Y,I,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU5",25,0)
 S NLF=+$G(NLF)
"RTN","BPSOSU5",26,0)
 F I=1:1:NLF W !
"RTN","BPSOSU5",27,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU5",28,0)
 S DIR(0)="E"
"RTN","BPSOSU5",29,0)
 D ^DIR
"RTN","BPSOSU5",30,0)
 Q $S(Y="":-1,Y=0:"^",1:Y)
"RTN","BPSOSU5",31,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU5",32,0)
ENDRPT() ; EP
"RTN","BPSOSU5",33,0)
 N RETVAL
"RTN","BPSOSU5",34,0)
 S RETVAL=$$ENDRPT^BPSOSU8() Q
"RTN","BPSOSU5",35,0)
 ;=====================================================================
"RTN","BPSOSU5",36,0)
BYE ; EP
"RTN","BPSOSU5",37,0)
 ; Most routines should come here when they exit.
"RTN","BPSOSU5",38,0)
 ; Example: GOTO BYE^BPSOSU3
"RTN","BPSOSU5",39,0)
 ; IN: FLGSTOP   1=user wanted out
"RTN","BPSOSU5",40,0)
 ;
"RTN","BPSOSU5",41,0)
 I $G(FLGSTOP) W "  < exit >" HANG 1
"RTN","BPSOSU5",42,0)
 D ^%ZISC
"RTN","BPSOSU5",43,0)
 Q
"RTN","BPSOSU5",44,0)
 ;=====================================================================
"RTN","BPSOSU5",45,0)
BOTTOM(LINES) ;07/26/96
"RTN","BPSOSU5",46,0)
 ;  IN:  lines (optional) = lines from the bottom  (default=1)
"RTN","BPSOSU5",47,0)
 ;       This line-feeds down to the bottom of the screen
"RTN","BPSOSU5",48,0)
 ;
"RTN","BPSOSU5",49,0)
 Q:'$G(IOSL)
"RTN","BPSOSU5",50,0)
 N X1,X2,J S LINES=$S($D(LINES):LINES,1:1)
"RTN","BPSOSU5",51,0)
 S X1=($Y+2)
"RTN","BPSOSU5",52,0)
 I X1>(IOSL-LINES) DO
"RTN","BPSOSU5",53,0)
 . S X1=($Y+2)
"RTN","BPSOSU5",54,0)
 S X2=(IOSL-X1) F J=1:1:X2 W !
"RTN","BPSOSU5",55,0)
 Q
"RTN","BPSOSU5",56,0)
 ;=================================================================
"RTN","BPSOSU6")
0^254^B2399773
"RTN","BPSOSU6",1,0)
BPSOSU6 ;BHAM ISC/FCS/DRS/FLS - utilities, continued ;06/01/2004
"RTN","BPSOSU6",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSU6",3,0)
 Q
"RTN","BPSOSU6",4,0)
COMMSLOG ;EP - BPSOSC2 ; BPS COMMS LOG VIEW option
"RTN","BPSOSU6",5,0)
 ; choose which dial out
"RTN","BPSOSU6",6,0)
 N DIC,X,DTIME,DLAYGO,DINUM,Y,DTOUT,DUOUT
"RTN","BPSOSU6",7,0)
 N DIR,DA,DIRUT
"RTN","BPSOSU6",8,0)
 N POP,DIALOUT ; DIALOUT points to 9002313.55
"RTN","BPSOSU6",9,0)
 N LOGFILEN ; points to piece in ^BPS(9002313.55,DIALOUT,"LOG FILE")
"RTN","BPSOSU6",10,0)
 N LOGSLOT ; points to ^BPSECX("LOG",
"RTN","BPSOSU6",11,0)
 S DIC=9002313.55,DIC(0)="AEM"
"RTN","BPSOSU6",12,0)
 S DIC("A")="DISPLAY log file for which Dial Out: "
"RTN","BPSOSU6",13,0)
 D
"RTN","BPSOSU6",14,0)
 . N X S X=$$DEF5599^BPSOSA Q:'X
"RTN","BPSOSU6",15,0)
 . S DIC("B")=$P(^BPS(9002313.55,X,0),U)
"RTN","BPSOSU6",16,0)
 D ^DIC W !
"RTN","BPSOSU6",17,0)
 Q:Y<0  S DIALOUT=+Y
"RTN","BPSOSU6",18,0)
 N LOGFILES S LOGFILES=$G(^BPS(9002313.55,DIALOUT,"LOG FILE"))
"RTN","BPSOSU6",19,0)
 I LOGFILES?."^" D  Q
"RTN","BPSOSU6",20,0)
 . W !,"There are no log files available for this dial out.",!
"RTN","BPSOSU6",21,0)
 ; ask for device
"RTN","BPSOSU6",22,0)
 D ^%ZIS Q:$G(POP)
"RTN","BPSOSU6",23,0)
 S LOGFILEN=1
"RTN","BPSOSU6",24,0)
 ; display log file
"RTN","BPSOSU6",25,0)
C1 S LOGSLOT=$P(LOGFILES,U,LOGFILEN)
"RTN","BPSOSU6",26,0)
 U IO D PRINTLOG^BPSOSL(LOGSLOT)
"RTN","BPSOSU6",27,0)
 ; ask if you want to see previous file
"RTN","BPSOSU6",28,0)
 U $P
"RTN","BPSOSU6",29,0)
 I $P(LOGFILES,U,LOGFILEN+1)="" G C2 ; no more log files, you're done
"RTN","BPSOSU6",30,0)
 S DIR(0)="YO",DIR("A")="Want to see the previous log file"
"RTN","BPSOSU6",31,0)
 D ^DIR W !
"RTN","BPSOSU6",32,0)
 I Y S LOGFILEN=LOGFILEN+1 G C1
"RTN","BPSOSU6",33,0)
C2 ;
"RTN","BPSOSU6",34,0)
 D ^%ZISC
"RTN","BPSOSU6",35,0)
 Q
"RTN","BPSOSU7")
0^255^B5338609
"RTN","BPSOSU7",1,0)
BPSOSU7 ;BHAM ISC/FCS/DRS/FLS - misc. utilities ;06/01/2004
"RTN","BPSOSU7",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSU7",3,0)
 Q
"RTN","BPSOSU7",4,0)
 ; delete antique, hopeless .59s [ 09/14/2000  8:36 AM ]
"RTN","BPSOSU7",5,0)
 ; How can they possibly get stranded?
"RTN","BPSOSU7",6,0)
 ; Well, this cleans them up
"RTN","BPSOSU7",7,0)
PURGE(HRS) ;EP - purge all the ones older than HRS hours 
"RTN","BPSOSU7",8,0)
 W !
"RTN","BPSOSU7",9,0)
 I '$D(HRS) D  Q:'$G(HRS)
"RTN","BPSOSU7",10,0)
 . W "Unstrand all the claims which haven't been updated",!
"RTN","BPSOSU7",11,0)
 . N PROMPT S PROMPT="in how many hours? "
"RTN","BPSOSU7",12,0)
 . N DEF S DEF=24
"RTN","BPSOSU7",13,0)
 . N OPT S OPT=1
"RTN","BPSOSU7",14,0)
 . N MIN,MAX S MIN=.05,MAX=99999999 ; .05 hours = 3 minutes
"RTN","BPSOSU7",15,0)
 . S HRS=$$NUMERIC^BPSOSU2(PROMPT,DEF,OPT,MIN,MAX,2) ; 2 = dec. places
"RTN","BPSOSU7",16,0)
 . I HRS<MIN K HRS
"RTN","BPSOSU7",17,0)
 . W !
"RTN","BPSOSU7",18,0)
 W "Stranded claims survey and cleanup; HRS=",HRS,"   ",$$NOWEXT^BPSOSU1,!
"RTN","BPSOSU7",19,0)
 N COUNT S (COUNT,COUNT("SET TO COMPLETE"))=0
"RTN","BPSOSU7",20,0)
 N SECS S SECS=HRS*60*60 ; BPS*1.0T7*5 ; needed an extra *60
"RTN","BPSOSU7",21,0)
 N STAT S STAT=""
"RTN","BPSOSU7",22,0)
 F  S STAT=$O(^BPST("AD",STAT)) Q:STAT=""  D
"RTN","BPSOSU7",23,0)
 . Q:STAT=99  ; complete
"RTN","BPSOSU7",24,0)
 . N IEN59 S IEN59=""
"RTN","BPSOSU7",25,0)
 . F  S IEN59=$O(^BPST("AD",STAT,IEN59)) Q:IEN59=""  D
"RTN","BPSOSU7",26,0)
 . . S COUNT=COUNT+1
"RTN","BPSOSU7",27,0)
 . . S EIN=$P(IEN59,".")
"RTN","BPSOSU7",28,0)
 . . S EIN=$$GET1^DIQ(52,EIN,.01)
"RTN","BPSOSU7",29,0)
 . . W !,"VA prescription #",EIN," ,Claim prescription #",IEN59,!
"RTN","BPSOSU7",30,0)
 . . I '$D(^BPST(IEN59,0)) D  Q  ; should never happen
"RTN","BPSOSU7",31,0)
 . . .W " has no 0 node - contact IRM or support staff",!
"RTN","BPSOSU7",32,0)
 . . N LAST S LAST=$P(^BPST(IEN59,0),U,8)
"RTN","BPSOSU7",33,0)
 . . I 'LAST D  Q
"RTN","BPSOSU7",34,0)
 . . .W " has no last update - contact IRM or support staff",!
"RTN","BPSOSU7",35,0)
 . . N AGE,AGEI
"RTN","BPSOSU7",36,0)
 . . S AGEI=$$TIMEAGOI^BPSOSUD(LAST),AGE=$$TIMEAGO^BPSOSUD(LAST)
"RTN","BPSOSU7",37,0)
 . . W " last updated ",$$DATTIM^BPSRPT1(LAST)
"RTN","BPSOSU7",38,0)
 . . I AGEI>SECS D
"RTN","BPSOSU7",39,0)
 . . . W ?10,"  setting it to complete..."
"RTN","BPSOSU7",40,0)
 . . . D PURGE^BPSUSCR1(IEN59)
"RTN","BPSOSU7",41,0)
 . . . W "done.",!
"RTN","BPSOSU7",42,0)
 . . . S COUNT("SET TO COMPLETE")=COUNT("SET TO COMPLETE")+1
"RTN","BPSOSU7",43,0)
 . . E  D
"RTN","BPSOSU7",44,0)
 . . . W ?10,"nothing done to this claim.",!
"RTN","BPSOSU7",45,0)
 D ZWRITE^BPSOS("COUNT")
"RTN","BPSOSU7",46,0)
 Q
"RTN","BPSOSU7",47,0)
PURGEALL D PURGE(0) Q  ; should only be done by programmer?
"RTN","BPSOSU8")
0^256^B18280146
"RTN","BPSOSU8",1,0)
BPSOSU8 ;BHAM ISC/FCS/DRS/FLS - utilities ;06/01/2004
"RTN","BPSOSU8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSU8",3,0)
 ;*** Collection of FSI UTILITIES ***
"RTN","BPSOSU8",4,0)
 ;
"RTN","BPSOSU8",5,0)
 ;EOPQ(LINES,PARAM,Xcode) - Return 0 to continue, 1 to quit.
"RTN","BPSOSU8",6,0)
 ;PAUSE() Return 1 to continue, 0 to stop.
"RTN","BPSOSU8",7,0)
 ;ENDRPT()
"RTN","BPSOSU8",8,0)
 ;DEVICE(DEV,RTN,TITLE,MULTI) S up a device, 1 if successful, 0 not.
"RTN","BPSOSU8",9,0)
 ;HEADER(PROGRAM,TITLE1,TITLE2,RUNTIME,NOFF,UL) Procedure call
"RTN","BPSOSU8",10,0)
 ;CENTER
"RTN","BPSOSU8",11,0)
 ;UNDERLINE
"RTN","BPSOSU8",12,0)
 ;REPLICATE
"RTN","BPSOSU8",13,0)
 ;FMPAGE() Handle the screen or printer for an FM print report.
"RTN","BPSOSU8",14,0)
 ;PAGE0
"RTN","BPSOSU8",15,0)
 ;STANDBY
"RTN","BPSOSU8",16,0)
 ;======================================================================
"RTN","BPSOSU8",17,0)
EOPQ(LINESBOT,PARAM,EOPXCODE) ;EP -
"RTN","BPSOSU8",18,0)
 ; IN: LINESBOT = (optional) # of LINES from bottom (IOSL) before
"RTN","BPSOSU8",19,0)
 ;                determining what to do next.  I this is a CRT, we
"RTN","BPSOSU8",20,0)
 ;                will ask user whether to continue; for printers, just
"RTN","BPSOSU8",21,0)
 ;                continue.  DEFAULT=6
"RTN","BPSOSU8",22,0)
 ;     PARAM    = List of parameter codes (each may occur):
"RTN","BPSOSU8",23,0)
 ;                "M" - Will display "-- More --" at bottom.
"RTN","BPSOSU8",24,0)
 ;     EOPXCODE = xecutable code that will occur if this is the
"RTN","BPSOSU8",25,0)
 ;                end of the page (like, D HEADER^ROU).
"RTN","BPSOSU8",26,0)
 ;
"RTN","BPSOSU8",27,0)
 ; OUT: 0 if not end of page, OR if we're EOP but we're continuing;
"RTN","BPSOSU8",28,0)
 ;      1 if user wants to quit.
"RTN","BPSOSU8",29,0)
 ; May call this as DO in some cases (like a little trailer on report)
"RTN","BPSOSU8",30,0)
 ;
"RTN","BPSOSU8",31,0)
 N X,Y,%,DIR
"RTN","BPSOSU8",32,0)
 ;
"RTN","BPSOSU8",33,0)
 I '$G(IOSL) Q 0  ;if we don't know page length, then not at end
"RTN","BPSOSU8",34,0)
 S LINESBOT=$S($G(LINESBOT):LINESBOT,1:6)
"RTN","BPSOSU8",35,0)
 I ($Y+LINESBOT)<IOSL Q 0  ;not at end of page
"RTN","BPSOSU8",36,0)
 ; -- Okay, we're at end of page
"RTN","BPSOSU8",37,0)
 I $G(PARAM)["M" W !,?($S($G(IOM):IOM,1:80)-12),"-- More --"
"RTN","BPSOSU8",38,0)
 ;
"RTN","BPSOSU8",39,0)
 I '$$PAUSE Q 1  ;user wants out
"RTN","BPSOSU8",40,0)
 X $G(EOPXCODE)
"RTN","BPSOSU8",41,0)
 ;
"RTN","BPSOSU8",42,0)
 Q 0
"RTN","BPSOSU8",43,0)
 ;======================================================================
"RTN","BPSOSU8",44,0)
PAUSE() ;3/31/93
"RTN","BPSOSU8",45,0)
 ;END of screen... should we continue?
"RTN","BPSOSU8",46,0)
 ;I $E(IOST,1)'="C"
"RTN","BPSOSU8",47,0)
 I '$$TOSCREEN^BPSOSU5 Q 1
"RTN","BPSOSU8",48,0)
 K DIR
"RTN","BPSOSU8",49,0)
 S DIR(0)="E" D ^DIR
"RTN","BPSOSU8",50,0)
 Q Y  ;Y=1 to continue, 0 to quit.
"RTN","BPSOSU8",51,0)
 ;===================================================================
"RTN","BPSOSU8",52,0)
ENDRPT() ;EP - end of report.  Pause until user presses return (or timeout)
"RTN","BPSOSU8",53,0)
 I '$$TOSCREEN^BPSOSU5 W:$Y @IOF Q 1
"RTN","BPSOSU8",54,0)
 I $G(FLGSTOP) W !," <escape>"
"RTN","BPSOSU8",55,0)
 N DIR,X,Y
"RTN","BPSOSU8",56,0)
 S DIR(0)="E"
"RTN","BPSOSU8",57,0)
 S DIR("A")="  -- END OF REPORT --  (Press <ENTER> to return to menu)"
"RTN","BPSOSU8",58,0)
 D ^DIR
"RTN","BPSOSU8",59,0)
 Q Y
"RTN","BPSOSU8",60,0)
 ;===================================================================
"RTN","BPSOSU8",61,0)
DEVICE(DEV,RTN,TITLE,MULTI) ;EP
"RTN","BPSOSU8",62,0)
 ;Select an output device.  Return 1 if successful, 0 if not.
"RTN","BPSOSU8",63,0)
 ;No parameters are required.  DEV can be set alone, or if queuing
"RTN","BPSOSU8",64,0)
 ;set to variables needed for queuing.
"RTN","BPSOSU8",65,0)
 ;DEV   - DEFAULT device, "HOME" if undefined.
"RTN","BPSOSU8",66,0)
 ;RTN   - Routine name if queuing is selected.
"RTN","BPSOSU8",67,0)
 ;TITLE - Description for the task log if queuing is selected.
"RTN","BPSOSU8",68,0)
 ;MULTI - I set then ask NUMBER OF COPIES.  This sets the variable
"RTN","BPSOSU8",69,0)
 ;        DCOPIES that the calling routine should use.
"RTN","BPSOSU8",70,0)
 ;Examples: Q:'$$DEVICE^ABSBUU01("STANDARD")
"RTN","BPSOSU8",71,0)
 ;
"RTN","BPSOSU8",72,0)
 ;       Q:'$$DEVICE^ABSBUU01("PC;132;66","EN^WSHLC","CORRECTION LIST")
"RTN","BPSOSU8",73,0)
 ;       note: D ^%ZISC to close the device after printing is done.
"RTN","BPSOSU8",74,0)
 N I,Y
"RTN","BPSOSU8",75,0)
 W !!
"RTN","BPSOSU8",76,0)
 S ZTSAVE("PAGE")=""
"RTN","BPSOSU8",77,0)
 I $D(RTN) S %ZIS="QM" ; Ask if queuing is allowed only if RTN is set.
"RTN","BPSOSU8",78,0)
 S %ZIS("A")="Send report to device: " ;PROMPT
"RTN","BPSOSU8",79,0)
 S %ZIS("B")=$S($D(DEV):DEV,1:"HOME") ;DEFAULT device
"RTN","BPSOSU8",80,0)
 D ^%ZIS ;Input/Output variables.
"RTN","BPSOSU8",81,0)
 I POP W "   try again later" S Y=0 G DEVQ  ;Device success flag
"RTN","BPSOSU8",82,0)
 S PAGE=0
"RTN","BPSOSU8",83,0)
 I '$D(IO("Q")) U IO S Y=1 G DEVQ ;Queuing not selected
"RTN","BPSOSU8",84,0)
 S ZTRTN=RTN ;Routine entry point for queuing.
"RTN","BPSOSU8",85,0)
 S ZTIO=ION ;Output device for queuing.
"RTN","BPSOSU8",86,0)
 S ZTDESC=$G(TITLE) ;Report title if queuing is selected.
"RTN","BPSOSU8",87,0)
 S ZTSAVE("*")="" ;All variables in memory for queuing.
"RTN","BPSOSU8",88,0)
 D ^%ZTLOAD ;Entry point for queuing.
"RTN","BPSOSU8",89,0)
 W !,$S($D(ZTQUEUED):"Request queued!",1:"Request cancelled!") ;flag
"RTN","BPSOSU8",90,0)
 S Y='$D(ZTQUEUED)
"RTN","BPSOSU8",91,0)
 D HOME^%ZIS ;S IO variables back to device = screen.
"RTN","BPSOSU8",92,0)
 U IO ;Use the currently open IO device
"RTN","BPSOSU8",93,0)
DEVQ I +$G(MULTI)>0 D  USE IO
"RTN","BPSOSU8",94,0)
 . USE $P
"RTN","BPSOSU8",95,0)
 . N Y
"RTN","BPSOSU8",96,0)
 . S DCOPIES=0
"RTN","BPSOSU8",97,0)
 . K DIR
"RTN","BPSOSU8",98,0)
 . S DIR(0)="NO^0:99999",DIR("A")="NUMBER OF COPIES TO OUTPUT"
"RTN","BPSOSU8",99,0)
 . S DIR("B")=1
"RTN","BPSOSU8",100,0)
 . D ^DIR K DIR
"RTN","BPSOSU8",101,0)
 . I +Y>0 S DCOPIES=Y
"RTN","BPSOSU8",102,0)
 . I Y["^" S DCOPIES=-1
"RTN","BPSOSU8",103,0)
 I $G(DCOPIES)<0 S Y=0
"RTN","BPSOSU8",104,0)
 Q Y
"RTN","BPSOSU8",105,0)
 ;===================================================================
"RTN","BPSOSU8",106,0)
HEADER(PROGRAM,TITLE1,TITLE2,RUNTIME,NOFF,UL) ;
"RTN","BPSOSU8",107,0)
 ; This PROCEDURE accepts the routine name and titles and prints out a 
"RTN","BPSOSU8",108,0)
 ; standard header with the run date and time,page and increments
"RTN","BPSOSU8",109,0)
 ; the page counter by 1.  Page is initialized in function DEVICE.
"RTN","BPSOSU8",110,0)
 ; W @IOF if (to SCREEN) OR (to PRINTER after page 1)
"RTN","BPSOSU8",111,0)
 ;    TITLE variable has special uses.  I the calling routine
"RTN","BPSOSU8",112,0)
 ; send-in the TITLE-array (by setting TITLE(1)="LINE 1", TITLE(n)=
"RTN","BPSOSU8",113,0)
 ; "LINE n of title", and then D HEADER^WSHUTL("ROUTINE",.TITLE),"."),
"RTN","BPSOSU8",114,0)
 ; then the entire array of TITLE will be used (and TITLE2 will be
"RTN","BPSOSU8",115,0)
 ; ignored).  You must send-in TITLE2="."
"RTN","BPSOSU8",116,0)
 ;    RUNTIME has been added so that all pages of the report can
"RTN","BPSOSU8",117,0)
 ; have the same date.time.  The calling report must send it in.
"RTN","BPSOSU8",118,0)
 ;    NOFF (optional) - if it exists, then do NOT issue a FormFeed.
"RTN","BPSOSU8",119,0)
 ; This is necessary for reports that are controlled as a FileMan
"RTN","BPSOSU8",120,0)
 ; template... since FM issues its own FF, this routine should not.
"RTN","BPSOSU8",121,0)
 ;    UL (opt) - is flag to print a 1-IOSL dashes after the header.
"RTN","BPSOSU8",122,0)
 ; DEFAULT is no-underline.  S UL to 1 to print the underline.
"RTN","BPSOSU8",123,0)
 ;
"RTN","BPSOSU8",124,0)
 N X
"RTN","BPSOSU8",125,0)
 S $Y=0,PAGE=$G(PAGE)
"RTN","BPSOSU8",126,0)
 I $E(IOST,1)="C"!($E(IOST,1)="P"&(PAGE>0)) I '$D(NOFF) W @IOF
"RTN","BPSOSU8",127,0)
 S PAGE=PAGE+1
"RTN","BPSOSU8",128,0)
 I $G(RUNTIME)="" D NOW^%DTC S Y=$E(%,1,12) X ^DD("DD") S RUNTIME=Y
"RTN","BPSOSU8",129,0)
 W !,"RUN DATE: ",RUNTIME
"RTN","BPSOSU8",130,0)
 W ?(IOM-10),"PAGE: ",$J(PAGE,3,0)
"RTN","BPSOSU8",131,0)
 I $D(PROGRAM),PROGRAM'="" W !,"PGM:  ",PROGRAM
"RTN","BPSOSU8",132,0)
 I $G(TITLE2)'="." DO
"RTN","BPSOSU8",133,0)
 . I $D(TITLE1) D WCENTER^BPSOSU9(TITLE1)
"RTN","BPSOSU8",134,0)
 . I $D(TITLE2) D WCENTER^BPSOSU9(TITLE2)
"RTN","BPSOSU8",135,0)
 I $G(TITLE2)="." DO
"RTN","BPSOSU8",136,0)
 . S N=""
"RTN","BPSOSU8",137,0)
 . F  S N=$O(TITLE1(N)) Q:N=""  D WCENTER^BPSOSU9($G(TITLE1(N)))
"RTN","BPSOSU8",138,0)
 I $G(UL)=1 D  ;print dashes across the page
"RTN","BPSOSU8",139,0)
 . W !
"RTN","BPSOSU8",140,0)
 . FOR I=1:1:$S($G(IOM)>0:IOM,1:80) W "-"
"RTN","BPSOSU8",141,0)
 W !
"RTN","BPSOSU8",142,0)
 Q
"RTN","BPSOSU8",143,0)
 ;===================================================================
"RTN","BPSOSU8",144,0)
FMPAGE ;at end of page
"RTN","BPSOSU8",145,0)
 I $$TOSCREEN^BPSOSU5 D  Q
"RTN","BPSOSU8",146,0)
 . D PRESSANY^BPSOSU5()
"RTN","BPSOSU8",147,0)
 I IOST["P-" W @IOF Q
"RTN","BPSOSU8",148,0)
 ; should we fall through to PAGE0?
"RTN","BPSOSU8",149,0)
 Q
"RTN","BPSOSU8",150,0)
 ;===================================================================
"RTN","BPSOSU8",151,0)
PAGE0 ; This checks the IO device and issues a pagefeed if $Y>0
"RTN","BPSOSU8",152,0)
 Q:'$G(IO)
"RTN","BPSOSU8",153,0)
 ;OPEN IO USE IO I $Y>0 USE IO W #
"RTN","BPSOSU8",154,0)
 U IO I $Y>0 U IO W #
"RTN","BPSOSU8",155,0)
 Q
"RTN","BPSOSU8",156,0)
 ;===================================================================
"RTN","BPSOSU8",157,0)
STANDBY ;  W a message to screen to "Please Wait"
"RTN","BPSOSU8",158,0)
 USE $P D WAIT^DICD USE +$G(IO)
"RTN","BPSOSU8",159,0)
 Q
"RTN","BPSOSU8",160,0)
 ;===================================================================
"RTN","BPSOSU9")
0^257^B5894878
"RTN","BPSOSU9",1,0)
BPSOSU9 ;BHAM ISC/FCS/DRS/FLS - copied for ECME ;06/01/2004
"RTN","BPSOSU9",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSU9",3,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",5,0)
 ;Standard W and String Formatting Functions
"RTN","BPSOSU9",6,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",7,0)
WCENTER(TEXT,IOM,UL) ;EP
"RTN","BPSOSU9",8,0)
 S:$G(IOM)="" IOM=80
"RTN","BPSOSU9",9,0)
 W ?IOM-$L(TEXT)/2,TEXT,!
"RTN","BPSOSU9",10,0)
 I $G(UL) W ?IOM-$L(TEXT)/2,$TR($J("",$L(TEXT))," ","-"),!
"RTN","BPSOSU9",11,0)
 Q
"RTN","BPSOSU9",12,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",13,0)
 ;W Standard Underlined HEADER
"RTN","BPSOSU9",14,0)
WHEADER(TEXT,IOF,IOM) ;EP
"RTN","BPSOSU9",15,0)
 Q:$G(TEXT)=""
"RTN","BPSOSU9",16,0)
 S:$G(IOF)="" IOF="#"
"RTN","BPSOSU9",17,0)
 S:$G(IOM)="" IOM=80
"RTN","BPSOSU9",18,0)
 W @IOF,!
"RTN","BPSOSU9",19,0)
 D WCENTER(TEXT,IOM)
"RTN","BPSOSU9",20,0)
 D WCENTER($TR($J("",$L(TEXT))," ","-"),IOM)
"RTN","BPSOSU9",21,0)
 Q
"RTN","BPSOSU9",22,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",23,0)
 ;W Column HEADERs (with option to underline)
"RTN","BPSOSU9",24,0)
WCOLUMNS(INDENT,COLDEFS,CNAMES,ULINE) ;EP
"RTN","BPSOSU9",25,0)
 N CHEAD1,CHEAD2,INDEX,CDEF
"RTN","BPSOSU9",26,0)
 Q:$G(CNAMES)=""
"RTN","BPSOSU9",27,0)
 S:$G(INDENT)="" INDENT=0
"RTN","BPSOSU9",28,0)
 S:$G(COLDEFS)="" COLDEFS=2
"RTN","BPSOSU9",29,0)
 S:$G(ULINE)="" ULINE=1
"RTN","BPSOSU9",30,0)
 ;
"RTN","BPSOSU9",31,0)
 S COLDEFS=$J("",COLDEFS)
"RTN","BPSOSU9",32,0)
 S (CHEAD1,CHEAD2)=""
"RTN","BPSOSU9",33,0)
 F INDEX=1:1:$L(CNAMES,",") D
"RTN","BPSOSU9",34,0)
 .S CDEF=$P(CNAMES,",",INDEX)
"RTN","BPSOSU9",35,0)
 .S CHEAD1=CHEAD1_$S(INDEX=1:"",1:COLDEFS)_$$LJBF($P(CDEF,":",1),$P(CDEF,":",2))
"RTN","BPSOSU9",36,0)
 .S:ULINE CHEAD2=CHEAD2_$S(INDEX=1:"",1:COLDEFS)_$TR($J("",$P(CDEF,":",2))," ","-")
"RTN","BPSOSU9",37,0)
 W ?INDENT,CHEAD1,!
"RTN","BPSOSU9",38,0)
 W:ULINE ?INDENT,CHEAD2,!
"RTN","BPSOSU9",39,0)
 Q
"RTN","BPSOSU9",40,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",41,0)
WDATA(INDENT,COLDEFS,VNAMES) ;EP
"RTN","BPSOSU9",42,0)
 N INDEX,DEF,DLINE,VAR,LEN
"RTN","BPSOSU9",43,0)
 Q:$G(VNAMES)=""
"RTN","BPSOSU9",44,0)
 S:$G(INDENT)="" INDENT=0
"RTN","BPSOSU9",45,0)
 S:$G(COLDEFS)="" COLDEFS=2
"RTN","BPSOSU9",46,0)
 ;
"RTN","BPSOSU9",47,0)
 S COLDEFS=$J("",COLDEFS)
"RTN","BPSOSU9",48,0)
 S DLINE=""
"RTN","BPSOSU9",49,0)
 F INDEX=1:1:$L(VNAMES,",") D
"RTN","BPSOSU9",50,0)
 .S DEF=$P(VNAMES,",",INDEX)
"RTN","BPSOSU9",51,0)
 .S VAR=$P(DEF,":",1)
"RTN","BPSOSU9",52,0)
 .S LEN=$P(DEF,":",2)
"RTN","BPSOSU9",53,0)
 .S DLINE=DLINE_$S(INDEX=1:"",1:COLDEFS)_$$LJBF($S(VAR="":"",1:$G(@VAR)),LEN)
"RTN","BPSOSU9",54,0)
 W ?INDENT,DLINE,!
"RTN","BPSOSU9",55,0)
 Q
"RTN","BPSOSU9",56,0)
 ;
"RTN","BPSOSU9",57,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",58,0)
 ;Left justifies and blank fills
"RTN","BPSOSU9",59,0)
LJBF(X,L) ;EP
"RTN","BPSOSU9",60,0)
 Q $E(X_$J("",L-$L(X)),1,L)
"RTN","BPSOSU9",61,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",62,0)
 ;Right justifies and blank fills
"RTN","BPSOSU9",63,0)
RJBF(X,L) ;EP
"RTN","BPSOSU9",64,0)
 Q $E($J("",L-$L(X))_X,1,L)
"RTN","BPSOSU9",65,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",66,0)
 ;CENTER justifies and blank fills
"RTN","BPSOSU9",67,0)
CJBF(X,L) ;
"RTN","BPSOSU9",68,0)
 Q $$LJBF($E($J("",(L-$L(X))\2)_X,1,L),L)
"RTN","BPSOSU9",69,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",70,0)
 ;Convert lower case characters to upper case characters
"RTN","BPSOSU9",71,0)
UCASE(X) ;EP
"RTN","BPSOSU9",72,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSOSU9",73,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",74,0)
 ;Convert upper case characters to lower case characters
"RTN","BPSOSU9",75,0)
LCASE(X) ;
"RTN","BPSOSU9",76,0)
 Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","BPSOSU9",77,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",78,0)
 ;Delete leading and trailing blanks
"RTN","BPSOSU9",79,0)
CLIP(X) ;EP
"RTN","BPSOSU9",80,0)
 F  D  Q:$E(X,1)'=" "
"RTN","BPSOSU9",81,0)
 .S:$E(X,1)=" " X=$E(X,2,$L(X))
"RTN","BPSOSU9",82,0)
 F  D  Q:$E(X,$L(X))'=" "
"RTN","BPSOSU9",83,0)
 .S:$E(X,$L(X))=" " X=$E(X,1,$L(X)-1)
"RTN","BPSOSU9",84,0)
 Q X
"RTN","BPSOSUA")
0^258^B34557161
"RTN","BPSOSUA",1,0)
BPSOSUA ;BHAM ISC/FCS/DRS/FLS - sort and print utilities ;06/01/2004
"RTN","BPSOSUA",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSUA",3,0)
 Q
"RTN","BPSOSUA",4,0)
DEFDEST()          Q "^TMP("""_$T(+0)_""","_$J_",1)" ; default dest for sort
"RTN","BPSOSUA",5,0)
SAVEAREA()         Q "^TMP("""_$T(+0)_""","_$J_",2)" ; if you save old vers.
"RTN","BPSOSUA",6,0)
SAVEOLD K @$$SAVEAREA M @$$SAVEAREA=@$$DEFDEST Q
"RTN","BPSOSUA",7,0)
 ;
"RTN","BPSOSUA",8,0)
SORT(USER,PATDFN,TDIF,INIT,DEST,LOCK) ;EP - from BPSOS6I
"RTN","BPSOSUA",9,0)
 ; USER = DUZ or 0 for all users
"RTN","BPSOSUA",10,0)
 ; USER = DUZ # you want;  MINS = within the last N minutes
"RTN","BPSOSUA",11,0)
 ;  (Because of timing, you might catch a prescription more than once)
"RTN","BPSOSUA",12,0)
 ; PATDFN = a particular patient or 0 for all patients
"RTN","BPSOSUA",13,0)
 ; TDIF = days.hhmmss = 0.0015, for instance, for last 15 minutes
"RTN","BPSOSUA",14,0)
 ; or TSINCE, e.g. 2991105.140305, for changes since absolute time
"RTN","BPSOSUA",15,0)
 ; If TDIF is given, TSINCE is computed from NOW^%DTC and TDIF 
"RTN","BPSOSUA",16,0)
 ; TDIF can be positive and we'll take care of treating it as minus.
"RTN","BPSOSUA",17,0)
 ; TDIF can theoretically be   days.hhmmss  but in practice it's
"RTN","BPSOSUA",18,0)
 ;  either one or the other.
"RTN","BPSOSUA",19,0)
 ; INIT = 1 if you want to init list (erase what's there now)
"RTN","BPSOSUA",20,0)
 ; DEST defaults to ^TMP("BPSOSUA",$J)
"RTN","BPSOSUA",21,0)
 ;      If it's a global,it must begin with ^TMP( or ^UTILITY(
"RTN","BPSOSUA",22,0)
 ; LOCK defaults to 1, Lock file 9002313.59
"RTN","BPSOSUA",23,0)
 ;   It seems that not locking really does lead to some misleading
"RTN","BPSOSUA",24,0)
 ;   displays.
"RTN","BPSOSUA",25,0)
 ; - - - - - It builds this: - - - - -
"RTN","BPSOSUA",26,0)
 ; @DEST=how many patients
"RTN","BPSOSUA",27,0)
 ; @DEST@(patname)=how many prescriptions for this patient
"RTN","BPSOSUA",28,0)
 ; @DEST@(patname,"RXI",ABSBRXI)=status^datetime last update
"RTN","BPSOSUA",29,0)
 ; And this node, which we aren't using anymore:
"RTN","BPSOSUA",30,0)
 ; @DEST@(patname,100-status,9'sDate9'sTime,ABSBRXI)="" for each presc
"RTN","BPSOSUA",31,0)
 ;
"RTN","BPSOSUA",32,0)
 ; Returns the root reference of the DEST.
"RTN","BPSOSUA",33,0)
 ;
"RTN","BPSOSUA",34,0)
SORT0 N ROU S ROU=$T(+0)
"RTN","BPSOSUA",35,0)
 I '$D(USER) S USER=0
"RTN","BPSOSUA",36,0)
 I '$D(PATDFN) S PATDFN=0
"RTN","BPSOSUA",37,0)
 I '$D(TDIF) S TDIF=0.001500
"RTN","BPSOSUA",38,0)
 I '$D(INIT) S INIT=1
"RTN","BPSOSUA",39,0)
 I '$D(DEST) S DEST=$$DEFDEST
"RTN","BPSOSUA",40,0)
 I $E(DEST)="^",$P(DEST,"(")'="^TMP",$P(DEST,"(")'="^UTILITY" D  Q
"RTN","BPSOSUA",41,0)
 . D IMPOSS^BPSOSUE("P","TI","we cannot use "_DEST_" for scratch storage",,,$T(+0))
"RTN","BPSOSUA",42,0)
 I '$D(LOCK) S LOCK=1
"RTN","BPSOSUA",43,0)
SORT1 N NOW,%,%H,%I,X D NOW^%DTC S NOW=%
"RTN","BPSOSUA",44,0)
 N TIME,STARTTIM
"RTN","BPSOSUA",45,0)
 N ROOT S ROOT="^BPST"
"RTN","BPSOSUA",46,0)
 I TDIF>2990000 S (TIME,STARTTIM)=TDIF ; absolute time was given
"RTN","BPSOSUA",47,0)
 E  S (TIME,STARTTIM)=$$TADD(NOW,TDIF*$S(TDIF>0:-1,1:1)) ; delta
"RTN","BPSOSUA",48,0)
 I INIT K @DEST S @DEST=0
"RTN","BPSOSUA",49,0)
 I $G(LOCK) L +@ROOT:3600
"RTN","BPSOSUA",50,0)
 D SORT2
"RTN","BPSOSUA",51,0)
 I $G(LOCK) L -@ROOT
"RTN","BPSOSUA",52,0)
 Q DEST
"RTN","BPSOSUA",53,0)
 ;
"RTN","BPSOSUA",54,0)
SORT2 ; If doing one particular patient, then use the patient index
"RTN","BPSOSUA",55,0)
 I PATDFN D
"RTN","BPSOSUA",56,0)
 . S STARTTIM=STARTTIM\1
"RTN","BPSOSUA",57,0)
 . S RXI="" F  S RXI=$O(@ROOT@("AC",PATDFN,RXI)) Q:'RXI  D
"RTN","BPSOSUA",58,0)
 . . Q:$P($G(@ROOT@(RXI,0)),U,8)<STARTTIM
"RTN","BPSOSUA",59,0)
 . . D SORT3
"RTN","BPSOSUA",60,0)
 E  D  ; If doing the usual time search, use the time index
"RTN","BPSOSUA",61,0)
 . F  D  S TIME=$O(@ROOT@("AH",TIME)) Q:'TIME
"RTN","BPSOSUA",62,0)
 . . S RXI="" F  S RXI=$O(@ROOT@("AH",TIME,RXI)) Q:'RXI  D SORT3
"RTN","BPSOSUA",63,0)
 Q
"RTN","BPSOSUA",64,0)
SORT3 ;
"RTN","BPSOSUA",65,0)
 N X S X=$G(@ROOT@(RXI,0)) Q:X=""
"RTN","BPSOSUA",66,0)
 I $$CLOSED(RXI) Q
"RTN","BPSOSUA",67,0)
 I USER,$P(X,U,10)'=USER Q
"RTN","BPSOSUA",68,0)
 I PATDFN,$P(X,U,6)'=PATDFN Q
"RTN","BPSOSUA",69,0)
 ; Compute time diff with record - in case index is corrupted
"RTN","BPSOSUA",70,0)
 ; Criteria met - so include this record
"RTN","BPSOSUA",71,0)
 N STATUS S STATUS=$P(X,U,2)
"RTN","BPSOSUA",72,0)
 N STAT99 S STAT99=100-STATUS
"RTN","BPSOSUA",73,0)
 N TIME99 S TIME99=9999999.99999999-$P(X,U,8)
"RTN","BPSOSUA",74,0)
 I 'PATDFN N PATDFN S PATDFN=$P(X,U,6)
"RTN","BPSOSUA",75,0)
 N PATNAME I PATDFN S PATNAME=$P($G(^DPT(PATDFN,0)),U)
"RTN","BPSOSUA",76,0)
 S:$G(PATNAME)="" PATNAME="Patient `"_PATDFN
"RTN","BPSOSUA",77,0)
 I '$D(@DEST@(PATNAME)) S @DEST=@DEST+1,@DEST@(PATNAME)=0
"RTN","BPSOSUA",78,0)
 E  I $D(@DEST@(PATNAME,"RXI",RXI)) Q  ; timing - we got this twice
"RTN","BPSOSUA",79,0)
 S @DEST@(PATNAME)=@DEST@(PATNAME)+1
"RTN","BPSOSUA",80,0)
 S @DEST@(PATNAME,STAT99,TIME99,RXI)=""
"RTN","BPSOSUA",81,0)
 S @DEST@(PATNAME,"RXI",RXI)=$S(STATUS=99:100,1:STATUS)_U_TIME
"RTN","BPSOSUA",82,0)
 Q
"RTN","BPSOSUA",83,0)
DISP(USER) ; display @ROOT@(pat,status99,time99,rxi)
"RTN","BPSOSUA",84,0)
 N ROU S ROU=$T(+0) N X,Y,I,RXI
"RTN","BPSOSUA",85,0)
 I '$G(^TMP("BPSOSUA",$J)) D  Q
"RTN","BPSOSUA",86,0)
 .W "None" W:$G(USER) " for ",$$GET1^DIQ(200,USER,.01) W ! Q
"RTN","BPSOSUA",87,0)
 S X="" F  S X=$O(^TMP("BPSOSUA",$J,X)) Q:X=""  D
"RTN","BPSOSUA",88,0)
 .S Y="" F  S Y=$O(^TMP("BPSOSUA",$J,X,Y)) Q:Y=""  D
"RTN","BPSOSUA",89,0)
 ..S RXI="" F  S RXI=$O(^TMP("BPSOSUA",$J,X,Y,RXI)) Q:RXI=""  D
"RTN","BPSOSUA",90,0)
 ...N X,Y D DISP1
"RTN","BPSOSUA",91,0)
 Q
"RTN","BPSOSUA",92,0)
TT() Q "S:Y[""."" Y=$P(Y,""."",2) S Y=Y_""000000"" S Y=""@""_$E(Y,1,2)_"":""_$E(Y,3,4)_"":""_$E(Y,5,6)" ; TT is kind of like ^DD("DD") but just for our times
"RTN","BPSOSUA",93,0)
DISP1 ; given RXI
"RTN","BPSOSUA",94,0)
 N REC M REC=^BPST(RXI)
"RTN","BPSOSUA",95,0)
 N X,Y
"RTN","BPSOSUA",96,0)
 N TT S TT=$$TT
"RTN","BPSOSUA",97,0)
 F I=0:1:2 I '$D(REC(I)) S REC(I)=""
"RTN","BPSOSUA",98,0)
 N STAT S STAT=$P(REC(0),U,2)
"RTN","BPSOSUA",99,0)
 W "`",RXI," "
"RTN","BPSOSUA",100,0)
 N PAT S PAT=$P(REC(0),U,6)
"RTN","BPSOSUA",101,0)
 I PAT W " ",$P($G(^DPT(PAT,0)),U)," "
"RTN","BPSOSUA",102,0)
 W:STAT'=99 "in Q",STAT,":" W $E($$STATI^BPSOSU(STAT),1,30)
"RTN","BPSOSUA",103,0)
 S Y=$P($P(REC(0),U,8),".",2) X TT W " ",Y
"RTN","BPSOSUA",104,0)
 I STAT'=99 G DISP99
"RTN","BPSOSUA",105,0)
 D DISPRESP
"RTN","BPSOSUA",106,0)
DISP99 W !
"RTN","BPSOSUA",107,0)
 Q
"RTN","BPSOSUA",108,0)
DISPRESP ;EP - BPSOS6M
"RTN","BPSOSUA",109,0)
 ; Given REC(2) = result, RXI = prescription
"RTN","BPSOSUA",110,0)
 N RES S RES=$P(REC(2),U)
"RTN","BPSOSUA",111,0)
 I RES=0 D  ; good, go to the claim response and see what it says
"RTN","BPSOSUA",112,0)
 .N RSP D RESPINFO^BPSOSQ4(RXI,.RSP)
"RTN","BPSOSUA",113,0)
 .I RSP("HDR")'="Accepted" D  ; happily noninteresting if "Accepted"
"RTN","BPSOSUA",114,0)
 ..W !?10,"Response Status (Header) = ",RSP("HDR") W ! ; BPS*1.0T7*6
"RTN","BPSOSUA",115,0)
 .W " ",RSP("RSP") ; Payable, Rejected, Captured, Duplicate
"RTN","BPSOSUA",116,0)
 .I RSP("MSG")]"" W !?10,RSP("MSG")
"RTN","BPSOSUA",117,0)
 .N I F I=1:1:RSP("REJ",0) W !?10,RSP("REJ",I)
"RTN","BPSOSUA",118,0)
 E  D
"RTN","BPSOSUA",119,0)
 .W " result: ",RES
"RTN","BPSOSUA",120,0)
 .I $P(REC(2),U,2)]"" W !?5,$P(REC(2),U,2,$L(REC(2),U))
"RTN","BPSOSUA",121,0)
 Q
"RTN","BPSOSUA",122,0)
SHOULDNT W "this should never happen" Q
"RTN","BPSOSUA",123,0)
TDIF(T1,T2)        ; compute time difference T1-T2 = how many seconds
"RTN","BPSOSUA",124,0)
 ;T1,T2 both Fileman date.times
"RTN","BPSOSUA",125,0)
 S T1=$TR($J(T1,16,8)," ","0"),T2=$TR($J(T2,16,8)," ","0")
"RTN","BPSOSUA",126,0)
 N R S R=$P(T1,".")-$P(T2,".")*86400 ; days' difference
"RTN","BPSOSUA",127,0)
 S T1=$P(T1,".",2),T2=$P(T2,".",2) ; hhmmsstt
"RTN","BPSOSUA",128,0)
 S T1=$E(T1,1,2)*60+$E(T1,3,4)*60+$E(T1,5,6)
"RTN","BPSOSUA",129,0)
 S T2=$E(T2,1,2)*60+$E(T2,3,4)*60+$E(T2,5,6)
"RTN","BPSOSUA",130,0)
 I $E(T1,7,8) S T1=$E(T1,7,8)/100+T1
"RTN","BPSOSUA",131,0)
 I $E(T2,7,8) S T2=$E(T2,7,8)/100+T2
"RTN","BPSOSUA",132,0)
 S R=R+T1-T2
"RTN","BPSOSUA",133,0)
 Q R
"RTN","BPSOSUA",134,0)
TADDE D IMPOSS^BPSOSUE("DB,P","TI","Bad T1="_T1,,"TADD",$T(+0)) Q
"RTN","BPSOSUA",135,0)
TADD(T1,T2)        ; FOR THIS ROUTINE'S USE ONLY - ALL OTHERS USE TADD^BPSOSUD
"RTN","BPSOSUA",136,0)
 ; add T2 time differential to T1
"RTN","BPSOSUA",137,0)
 ; T2 = number of days.hhmmsstt (mixed, not pure va date)
"RTN","BPSOSUA",138,0)
 N X,X1,X2,%H,%T,%Y,H1,H2,SGN,%
"RTN","BPSOSUA",139,0)
 I T1<0 D TADDE ; but T2 can be negative
"RTN","BPSOSUA",140,0)
 S SGN=$S(T2<0:-1,1:1)
"RTN","BPSOSUA",141,0)
 S X2=$P(T2,".") ; days difference, maybe with sign
"RTN","BPSOSUA",142,0)
 I X2 S X1=T1 D C^%DTC S T1=X
"RTN","BPSOSUA",143,0)
 S $P(T2,".")="",T2=T2_"00000000" ; the days part is done
"RTN","BPSOSUA",144,0)
 ; T2=.hhmmsstt now, positive amount
"RTN","BPSOSUA",145,0)
 I 'T2 Q T1 ; days only, no seconds to compute
"RTN","BPSOSUA",146,0)
 S X=T1 D H^%DTC S $P(%H,",",2)=%T ; %H = T1 in $H format
"RTN","BPSOSUA",147,0)
 S %=T2,T2=$E(%,2,3)*60+$E(%,4,5)*60+$E(%,6,7)*SGN ; T2 in secs
"RTN","BPSOSUA",148,0)
 S $P(%H,",",2)=$P(%H,",",2)+T2 ; add the seconds
"RTN","BPSOSUA",149,0)
TADDLOOP I $P(%H,",",2)<0 D  G TADDLOOP ; borrow 1 day = 86400 seconds
"RTN","BPSOSUA",150,0)
 . S $P(%H,",")=$P(%H,",")-1,$P(%H,",",2)=$P(%H,",",2)+86400
"RTN","BPSOSUA",151,0)
 E  I $P(%H,",",2)>86400 D  G TADDLOOP ; carry 86400 secs = 1 day
"RTN","BPSOSUA",152,0)
 . S $P(%H,",")=$P(%H,",")+1,$P(%H,",",2)=$P(%H,",",2)-86400
"RTN","BPSOSUA",153,0)
 D YMD^%DTC
"RTN","BPSOSUA",154,0)
 Q X_%
"RTN","BPSOSUA",155,0)
CLOSED(TRA) ; Checks if the CLAIM for specific Transaction is CLOSED
"RTN","BPSOSUA",156,0)
 N CLAIM S CLAIM=$$GET1^DIQ(9002313.59,TRA,3,"I") I 'CLAIM Q 0
"RTN","BPSOSUA",157,0)
 Q $$GET1^DIQ(9002313.02,CLAIM,901,"I")
"RTN","BPSOSUB")
1^259
"RTN","BPSOSUC")
0^260^B6853754
"RTN","BPSOSUC",1,0)
BPSOSUC ;BHAM ISC/FCS/DRS/FLS - ECME utilities ;06/01/2004
"RTN","BPSOSUC",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSUC",3,0)
 Q
"RTN","BPSOSUC",4,0)
 ; CATEG is used by ILC billing in BPSOSB2
"RTN","BPSOSUC",5,0)
 ; Also called by several other routines
"RTN","BPSOSUC",6,0)
CATEG(N,WANTREV) ;EP - many
"RTN","BPSOSUC",7,0)
 ; given N, return category for the duplicate resolution process
"RTN","BPSOSUC",8,0)
 ; Can call with either N = integer IEN into 9002313.57
"RTN","BPSOSUC",9,0)
 ;   or N = decimal IEN into 9002313.59
"RTN","BPSOSUC",10,0)
 ; $G(WANTREV) = true if you care about reversals 
"RTN","BPSOSUC",11,0)
 ;         (that's the default if N is an IEN59)
"RTN","BPSOSUC",12,0)
 ; $G(WANTREV) = false if you want to ignore reversals 
"RTN","BPSOSUC",13,0)
 ;         (that's the default if IEN57)
"RTN","BPSOSUC",14,0)
 ; because billing is handled differently.
"RTN","BPSOSUC",15,0)
 ;
"RTN","BPSOSUC",16,0)
 ; Many routines rely on these exact return values; do not change them:
"RTN","BPSOSUC",17,0)
 ; Return values:
"RTN","BPSOSUC",18,0)
 ;     For both reversals and submissions:
"RTN","BPSOSUC",19,0)
 ;         CANCELLED and CORRUPT
"RTN","BPSOSUC",20,0)
 ;
"RTN","BPSOSUC",21,0)
 ;     For submissions:
"RTN","BPSOSUC",22,0)
 ;       E PAYABLE, E CAPTURED, E DUPLICATE, E REJECTED, E OTHER, and
"RTN","BPSOSUC",23,0)
 ;       E STRANDED
"RTN","BPSOSUC",24,0)
 ;
"RTN","BPSOSUC",25,0)
 ;     For Reversals:
"RTN","BPSOSUC",26,0)
 ;       E REVERSAL ACCEPTED, E REVERSAL REJECTED, E REVERSAL OTHER, and
"RTN","BPSOSUC",27,0)
 ;       E REVERSAL STRANDED
"RTN","BPSOSUC",28,0)
 ;
"RTN","BPSOSUC",29,0)
 ; Notes:
"RTN","BPSOSUC",30,0)
 ;    E DUPLICATE - being phased out - 02/06/2001
"RTN","BPSOSUC",31,0)
 ;       Remap to E PAYABLE or E CAPTURED, as appropriate
"RTN","BPSOSUC",32,0)
 ;
"RTN","BPSOSUC",33,0)
 ;    CORRUPT, E OTHER, and E REVERSAL OTHER should never happen
"RTN","BPSOSUC",34,0)
 ;
"RTN","BPSOSUC",35,0)
 I N<1 Q "" ; N=-1 can happen from print templates, e.g. MISSED PRESC
"RTN","BPSOSUC",36,0)
 N FILENUM S FILENUM=$S(N[".":9002313.59,1:9002313.57)
"RTN","BPSOSUC",37,0)
 I '$D(WANTREV) S WANTREV=$S(FILENUM=9002313.57:0,FILENUM=9002313.59:1)
"RTN","BPSOSUC",38,0)
 N RETVAL,CLAIM,RESP,X,RESP500,CODE,STAT,DISYS
"RTN","BPSOSUC",39,0)
 I '$$GET1^DIQ(FILENUM,N_",",.01) Q "CORRUPT"
"RTN","BPSOSUC",40,0)
 S CLAIM=$$GET1^DIQ(FILENUM,N_",",3,"I")
"RTN","BPSOSUC",41,0)
 S RESP=$$GET1^DIQ(FILENUM,N_",",4,"I")
"RTN","BPSOSUC",42,0)
 S CODE=$$GET1^DIQ(FILENUM,N_",",201,"I")
"RTN","BPSOSUC",43,0)
 S STAT=$$GET1^DIQ(FILENUM,N_",",202,"I")
"RTN","BPSOSUC",44,0)
 I $P(STAT,"[")="E REVERSAL STRANDED" Q "E REVERSAL STRANDED"
"RTN","BPSOSUC",45,0)
 I $P(STAT,"[")="E STRANDED" Q "E STRANDED"
"RTN","BPSOSUC",46,0)
 ; During a reversal/resubmit, you may get the next line between the reversal and 
"RTN","BPSOSUC",47,0)
 ;   and the resubmit
"RTN","BPSOSUC",48,0)
 I 'CLAIM S RETVAL="E OTHER" Q RETVAL
"RTN","BPSOSUC",49,0)
 I $$GET1^DIQ(FILENUM,N_",",302) Q "CANCELLED"
"RTN","BPSOSUC",50,0)
 I WANTREV S X=$$GET1^DIQ(FILENUM,N_",",401,"I") I X D  Q RETVAL
"RTN","BPSOSUC",51,0)
 . S RESP=$$GET1^DIQ(FILENUM,N_",",402,"I")
"RTN","BPSOSUC",52,0)
 . S RETVAL="E REVERSAL "
"RTN","BPSOSUC",53,0)
 . I 'RESP S RETVAL=RETVAL_"OTHER" Q
"RTN","BPSOSUC",54,0)
 . S RESP500=$$RESP500^BPSOSQ4(RESP,"I")
"RTN","BPSOSUC",55,0)
 . S X=$$RESP1000^BPSOSQ4(RESP,1,"I")
"RTN","BPSOSUC",56,0)
 . I RESP500="R"!(X="R") S RETVAL=RETVAL_"REJECTED" Q
"RTN","BPSOSUC",57,0)
 . ; Treat Duplicate of Accepted Reversal ("S") as Accepted
"RTN","BPSOSUC",58,0)
 . I RESP500="A",X="A"!(X="S") S RETVAL=RETVAL_"ACCEPTED" Q
"RTN","BPSOSUC",59,0)
 . S RETVAL=RETVAL_"OTHER"
"RTN","BPSOSUC",60,0)
 ; Response not received yet
"RTN","BPSOSUC",61,0)
 I 'RESP S RETVAL="E OTHER" Q RETVAL
"RTN","BPSOSUC",62,0)
 S RESP500=$$RESP500^BPSOSQ4(RESP,"I")
"RTN","BPSOSUC",63,0)
 N POS S POS=$$GET1^DIQ(FILENUM,N_",",14)
"RTN","BPSOSUC",64,0)
 S X=$$RESP1000^BPSOSQ4(RESP,POS,"I")
"RTN","BPSOSUC",65,0)
 I X="P"!(X="DP") Q "E PAYABLE"
"RTN","BPSOSUC",66,0)
 I X="D" Q "E DUPLICATE" ; SHOULD NEVER HAPPEN as of 02/06/2001
"RTN","BPSOSUC",67,0)
 I X="R" Q "E REJECTED"
"RTN","BPSOSUC",68,0)
 I X="C"!(X="DC") Q "E CAPTURED"
"RTN","BPSOSUC",69,0)
 ; 1000 indefinite, fall back to 500
"RTN","BPSOSUC",70,0)
 I RESP500="R" Q "E REJECTED"
"RTN","BPSOSUC",71,0)
 Q "E OTHER" ; corrupt?
"RTN","BPSOSUD")
0^261^B28991557
"RTN","BPSOSUD",1,0)
BPSOSUD ;BHAM ISC/FCS/DRS/FLS - utils, some options ;06/01/2004
"RTN","BPSOSUD",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSUD",3,0)
 ;
"RTN","BPSOSUD",4,0)
 ; Some utilities.
"RTN","BPSOSUD",5,0)
 ; Some options- goal is to move them out to other routines
"RTN","BPSOSUD",6,0)
 ;
"RTN","BPSOSUD",7,0)
 Q
"RTN","BPSOSUD",8,0)
 ;
"RTN","BPSOSUD",9,0)
INCSTAT(N1,P1,N2,P2,N3,P3) ;EP - BPSOSAM,BPSOSQA,BPSOSQC,BPSOSQL,others to come
"RTN","BPSOSUD",10,0)
 ; increment the given N nodes at the P pieces
"RTN","BPSOSUD",11,0)
 D ADD1STAT(N1,P1,1)
"RTN","BPSOSUD",12,0)
 Q:'$D(N2)  D ADD1STAT(N2,P2,1)
"RTN","BPSOSUD",13,0)
 Q:'$D(N3)  D ADD1STAT(N3,P3,1)
"RTN","BPSOSUD",14,0)
 Q
"RTN","BPSOSUD",15,0)
ADDSTAT(N1,P1,Q1,N2,P2,Q2,N3,P3,Q3) ;EP - BPSOSAM,BPSOSQ3,others to come
"RTN","BPSOSUD",16,0)
 ; add Quantities to given Nodes,Pieces
"RTN","BPSOSUD",17,0)
 D ADD1STAT(N1,P1,Q1)
"RTN","BPSOSUD",18,0)
 Q:'$D(N2)  D ADD1STAT(N2,P2,Q2)
"RTN","BPSOSUD",19,0)
 Q:'$D(N3)  D ADD1STAT(N3,P3,Q3)
"RTN","BPSOSUD",20,0)
 Q
"RTN","BPSOSUD",21,0)
ADD1STAT(N,P,Q) ;
"RTN","BPSOSUD",22,0)
 L +^BPSECX("S",1,N):5
"RTN","BPSOSUD",23,0)
 I '$D(^BPSECX("S",1,N)) S ^BPSECX("S",1,N)=""
"RTN","BPSOSUD",24,0)
 S $P(^BPSECX("S",1,N),U,P)=$P(^BPSECX("S",1,N),U,P)+Q
"RTN","BPSOSUD",25,0)
 L -^BPSECX("S",1,N)
"RTN","BPSOSUD",26,0)
 Q
"RTN","BPSOSUD",27,0)
 ;
"RTN","BPSOSUD",28,0)
 ; General LOCK routine to exclusive ownership of 9002313.59
"RTN","BPSOSUD",29,0)
 ; Interactive by default
"RTN","BPSOSUD",30,0)
 ;
"RTN","BPSOSUD",31,0)
LOCKPOS(OK2WAIT,SILENT) ;EP - BPSOS2D,BPSOS6L - Lock 9002313.59
"RTN","BPSOSUD",32,0)
 I '$D(OK2WAIT) S OK2WAIT=1
"RTN","BPSOSUD",33,0)
 N RESULT S RESULT=""
"RTN","BPSOSUD",34,0)
 F  D  Q:RESULT]""  Q:'OK2WAIT
"RTN","BPSOSUD",35,0)
 . L +^BPST:1 I $T S RESULT=1 Q
"RTN","BPSOSUD",36,0)
 . W "Waiting 5 minutes for interLOCK...",!
"RTN","BPSOSUD",37,0)
 . L +^BPST:299 I $T S RESULT=1 Q
"RTN","BPSOSUD",38,0)
 . D  Q
"RTN","BPSOSUD",39,0)
 . . W "Failed to obtain interLOCK",!
"RTN","BPSOSUD",40,0)
 . . S RESULT=0 Q
"RTN","BPSOSUD",41,0)
 . I 'VARX H 5  ;LJE   ; want to ask here - and set RESULT=0 if they say no, don't wait
"RTN","BPSOSUD",42,0)
 Q RESULT
"RTN","BPSOSUD",43,0)
ULKECME ;EP
"RTN","BPSOSUD",44,0)
 L -^BPST Q
"RTN","BPSOSUD",45,0)
 ;
"RTN","BPSOSUD",46,0)
DATETIME(Y) ;EP - BPSOS6M -  convert fileman date.time to printable
"RTN","BPSOSUD",47,0)
 X ^DD("DD") Q Y
"RTN","BPSOSUD",48,0)
TIMEAGO(THEN) ;EP - BPSOSU7 ; external form for TIMEAGOI
"RTN","BPSOSUD",49,0)
 N %,%H,%I,X D NOW^%DTC Q $$TIMEDIF(THEN,%)
"RTN","BPSOSUD",50,0)
TIMEAGOI(THEN) ;EP - BPSOSU7 ;
"RTN","BPSOSUD",51,0)
 ; how many seconds ago was it? returns positive value
"RTN","BPSOSUD",52,0)
 N %,%H,%I,X D NOW^%DTC ; giving %
"RTN","BPSOSUD",53,0)
 Q $$TIMEDIFI(THEN,%)
"RTN","BPSOSUD",54,0)
TIMEDIFI(X1,X2) ;EP - BPSOSB,BPSOSIV,BPSOSIZ ;
"RTN","BPSOSUD",55,0)
 ; time difference in seconds, negative if X1>X2
"RTN","BPSOSUD",56,0)
 I X1>X2 Q -$$TIMEDIFI(X2,X1)
"RTN","BPSOSUD",57,0)
 N %,X,%H,%T,%Y,D1,T1,D2,T2
"RTN","BPSOSUD",58,0)
 S X=X1 D H^%DTC S D1=%H,T1=%T
"RTN","BPSOSUD",59,0)
 S X=X2 D H^%DTC S D2=%H,T2=%T
"RTN","BPSOSUD",60,0)
 S X=D2-D1*86400+T2-T1
"RTN","BPSOSUD",61,0)
 Q X
"RTN","BPSOSUD",62,0)
TIMEDIF(X1,X2) ;EP - BPSOS6M,BPSOSIV   
"RTN","BPSOSUD",63,0)
 N X S X=$$TIMEDIFI(X1,X2)
"RTN","BPSOSUD",64,0)
 N SGN S SGN=$S(X<0:-1,1:1),X=X*SGN
"RTN","BPSOSUD",65,0)
 Q $S(SGN<0:"-",1:"")_$$SECSDHMS(X)
"RTN","BPSOSUD",66,0)
SECSDHMS(X)        ;EP - seconds ->  # da # hr # min # sec
"RTN","BPSOSUD",67,0)
 N % S %=""
"RTN","BPSOSUD",68,0)
 I X'<86400 S %=X\86400_" da",X=X#86400
"RTN","BPSOSUD",69,0)
 I X'<3600!(%]"") S:%]"" %=%_" " S %=%_(X\3600)_" hr",X=X#3600
"RTN","BPSOSUD",70,0)
 I X'<60!(%]"") S:%]"" %=%_" " S %=%_(X\60)_" min",X=X#60
"RTN","BPSOSUD",71,0)
 S:%]"" %=%_" " S %=%_X_" sec"
"RTN","BPSOSUD",72,0)
 Q %
"RTN","BPSOSUD",73,0)
PRESSANY D PRESSANY^BPSOSU5() Q
"RTN","BPSOSUD",74,0)
CONTINUE(DEF)         ;EP - BPSOS2E
"RTN","BPSOSUD",75,0)
 ; returns a single character
"RTN","BPSOSUD",76,0)
 ; or returns DEF, the default
"RTN","BPSOSUD",77,0)
CONT1 ;
"RTN","BPSOSUD",78,0)
 S X=$$FREETEXT^BPSOSU2("Type C to continue or Q to quit: ",,1,1,1,15)
"RTN","BPSOSUD",79,0)
 Q X
"RTN","BPSOSUD",80,0)
 ;
"RTN","BPSOSUD",81,0)
 ; SORT() has moved to BPSOSUA
"RTN","BPSOSUD",82,0)
 ; DEFDEST^BPSOSUA() gives default root of where its results are
"RTN","BPSOSUD",83,0)
 ; DISP and DISP1 have been superseded by ^BPSOS functionality
"RTN","BPSOSUD",84,0)
 ; the code has been deleted and all that's left is the paper copy
"RTN","BPSOSUD",85,0)
TT() Q "S:Y[""."" Y=$P(Y,""."",2) S Y=Y_""000000"" S Y=""@""_$E(Y,1,2)_"":""_$E(Y,3,4)_"":""_$E(Y,5,6)" ; TT is kind of like ^DD("DD") but just for our times
"RTN","BPSOSUD",86,0)
SHOULDNT W "this should never happen" Q
"RTN","BPSOSUD",87,0)
TDIFNOW(T) ;EP - BPSOSQS ; compute time difference between T and NOW
"RTN","BPSOSUD",88,0)
 ; returns # of seconds, positive if T precedes now (how long ago)
"RTN","BPSOSUD",89,0)
 ;   negative if T follows NOW (countdown "T minus...")
"RTN","BPSOSUD",90,0)
 N %,%H,%I,X D NOW^%DTC ; giving %
"RTN","BPSOSUD",91,0)
 Q $$TDIF(%,T)
"RTN","BPSOSUD",92,0)
TDIF(T1,T2)        ; compute time difference T1-T2 = how many seconds
"RTN","BPSOSUD",93,0)
 ;T1,T2 both Fileman date.times
"RTN","BPSOSUD",94,0)
 S T1=$TR($J(T1,16,8)," ","0"),T2=$TR($J(T2,16,8)," ","0")
"RTN","BPSOSUD",95,0)
 N R S R=$P(T1,".")-$P(T2,".")*86400 ; days' difference
"RTN","BPSOSUD",96,0)
 S T1=$P(T1,".",2),T2=$P(T2,".",2) ; hhmmsstt
"RTN","BPSOSUD",97,0)
 S T1=$E(T1,1,2)*60+$E(T1,3,4)*60+$E(T1,5,6)
"RTN","BPSOSUD",98,0)
 S T2=$E(T2,1,2)*60+$E(T2,3,4)*60+$E(T2,5,6)
"RTN","BPSOSUD",99,0)
 I $E(T1,7,8) S T1=$E(T1,7,8)/100+T1
"RTN","BPSOSUD",100,0)
 I $E(T2,7,8) S T2=$E(T2,7,8)/100+T2
"RTN","BPSOSUD",101,0)
 S R=R+T1-T2
"RTN","BPSOSUD",102,0)
 Q R
"RTN","BPSOSUD",103,0)
TADDSECS(T1,SECS) ;EP - BPSOSR1 - add SECS seconds to T1
"RTN","BPSOSUD",104,0)
 N T2 S T2=$$SECS2T2(SECS)
"RTN","BPSOSUD",105,0)
 Q $$TADD(T1,T2)
"RTN","BPSOSUD",106,0)
BADPARAM(VARNAME,ATLABEL) D IMPOSS^BPSOSUE("P,DB","TI","Bad parameter "_VARNAME_"="_$G(@VARNAME),,ATLABEL,$T(+0)) Q
"RTN","BPSOSUD",107,0)
TADDNOWS(SECS) ;EP - BPSOSQ4,BPSOSQJ - add SECS seconds to NOW
"RTN","BPSOSUD",108,0)
 I SECS'?1N.N D BADPARAM("SECS","TADDNOWS") Q ""
"RTN","BPSOSUD",109,0)
 N T2 S T2=$$SECS2T2(SECS)
"RTN","BPSOSUD",110,0)
 Q $$TADDNOW(T2)
"RTN","BPSOSUD",111,0)
SECS2T2(SECS)      ; convert integer seconds into a fileman time format
"RTN","BPSOSUD",112,0)
 N T2,NEG S NEG=(SECS<0) I NEG S SECS=-SECS
"RTN","BPSOSUD",113,0)
 I SECS>86400 S T2=SECS\86400,SECS=SECS#86400_"."
"RTN","BPSOSUD",114,0)
 E  S T2="."
"RTN","BPSOSUD",115,0)
 N % S %=SECS\3600,SECS=SECS#3600 S:$L(%)=1 %="0"_% S T2=T2_%
"RTN","BPSOSUD",116,0)
 S %=SECS\60,SECS=SECS#60 S:$L(%)=1 %="0"_% S T2=T2_%
"RTN","BPSOSUD",117,0)
 S:$L(SECS)=1 SECS="0"_SECS S T2=T2_SECS
"RTN","BPSOSUD",118,0)
 Q $S(NEG:"-",1:"")_T2
"RTN","BPSOSUD",119,0)
TADDNOW(T2) ;EP - BPSOSQS ; add T2 time differential to NOW
"RTN","BPSOSUD",120,0)
 N %,%H,%I,X D NOW^%DTC ; giving %
"RTN","BPSOSUD",121,0)
 Q $$TADD(%,T2)
"RTN","BPSOSUD",122,0)
TADD(T1,T2) ;EP - BPSOS6D,BPSOS6I ; add T2 time differential to T1
"RTN","BPSOSUD",123,0)
 I T1<0 D BADPARAM("T1","TADD") Q  ; but T2 can be negative
"RTN","BPSOSUD",124,0)
 N SGN S SGN=$S(T2<0:-1,1:1),T2=T2*SGN
"RTN","BPSOSUD",125,0)
 I SGN<0,T2>T1 D BADPARAM("T2","TADD") Q  ; can't handle this case (yet)
"RTN","BPSOSUD",126,0)
 S T1=$TR($J(T1,16,8)," ","0"),T2=$TR($J(T2,16,8)," ","0")
"RTN","BPSOSUD",127,0)
 N R ;S R=$P(T1,".",1)+($P(T2,".",1)*SGN) ; add days portion
"RTN","BPSOSUD",128,0)
 S R=$$CDTC($P(T1,"."),$P(T2,".")*SGN)
"RTN","BPSOSUD",129,0)
 S T2=$P(T2,".",2) ; note: without the sign
"RTN","BPSOSUD",130,0)
 S T1=$P(T1,".",2)
"RTN","BPSOSUD",131,0)
 S T1=$E(T1,1,2)*60+$E(T1,3,4)*60+$E(T1,5,6) ; seconds
"RTN","BPSOSUD",132,0)
 S T2=$E(T2,1,2)*60+$E(T2,3,4)*60+$E(T2,5,6) ; seconds
"RTN","BPSOSUD",133,0)
 I $E(T1,7,8) S T1=$E(T1,7,8)/100+T1 ; hundredths
"RTN","BPSOSUD",134,0)
 I $E(T2,7,8) S T2=$E(T2,7,8)/100+T2 ; hundredths
"RTN","BPSOSUD",135,0)
 S T2=T2*SGN ; restore sign to T2's hundredths
"RTN","BPSOSUD",136,0)
 N S S S=T1+T2
"RTN","BPSOSUD",137,0)
 I S>86400 S S=S-86400,R=$$CDTC(R,1) ; R+1 ; carry
"RTN","BPSOSUD",138,0)
 E  I S<0 S S=S+86400,R=$$CDTC(R,-1) ; R-1 ; borrow
"RTN","BPSOSUD",139,0)
 S T2=S\3600,S=S#3600
"RTN","BPSOSUD",140,0)
 S R=R_"."_$TR($J(T2,2)," ","0") ; hours
"RTN","BPSOSUD",141,0)
 S T2=S\60,S=S#60
"RTN","BPSOSUD",142,0)
 S R=R_$TR($J(T2,2)," ","0") ; minutes
"RTN","BPSOSUD",143,0)
 S T2=S\1,S=S#1
"RTN","BPSOSUD",144,0)
 S R=R_$TR($J(T2,2)," ","0") ; seconds
"RTN","BPSOSUD",145,0)
 S T2=S*100\1,R=R_$TR($J(T2,2)," ","0") ; hundredths of seconds
"RTN","BPSOSUD",146,0)
 S R=+R ; removes trailing zeroes 
"RTN","BPSOSUD",147,0)
 Q R
"RTN","BPSOSUD",148,0)
CDTC(X1,X2)        N X,%H D C^%DTC Q X
"RTN","BPSOSUE")
0^262^B23210252
"RTN","BPSOSUE",1,0)
BPSOSUE ;BHAM ISC/FCS/DRS/FLS - impossible errors ;06/01/2004
"RTN","BPSOSUE",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSOSUE",3,0)
 Q
"RTN","BPSOSUE",4,0)
 ;
"RTN","BPSOSUE",5,0)
 ; Deal with impossible errors (errors which should never occur,
"RTN","BPSOSUE",6,0)
 ; and which weren't already trapped by M).
"RTN","BPSOSUE",7,0)
 ;
"RTN","BPSOSUE",8,0)
IMPOSS(UETYPE,UEOPT,UEMSG,UEMSG2,UELOC,UEROU,UENOLOG) ;EP - deal with impossible errors - called from many places
"RTN","BPSOSUE",9,0)
 ; $$IMPOSS^BPSOSUE(UETYPE,UEOPT,UEMSG,UELOC,UEROU)
"RTN","BPSOSUE",10,0)
 ; UETYPE = kinds of problems which may have occured
"RTN","BPSOSUE",11,0)
 ;     ["FM" a Fileman call has returned an error
"RTN","BPSOSUE",12,0)
 ;     ["L"  a LOCK with ample time has failed
"RTN","BPSOSUE",13,0)
 ;     ["DB" a database error (some missing/incorrect field) 
"RTN","BPSOSUE",14,0)
 ;     ["P"  a programming error / some unexpected condition
"RTN","BPSOSUE",15,0)
 ;     ["DEV" some kind of device or file error
"RTN","BPSOSUE",16,0)
 ; UEOPT = options available; first one listed is the default
"RTN","BPSOSUE",17,0)
 ;     Defaults to "TRI"
"RTN","BPSOSUE",18,0)
 ;     ["R" retry - retry the operation; log err
"RTN","BPSOSUE",19,0)
 ;     ["I" ignore - continue as though operation had succeeded; log err
"RTN","BPSOSUE",20,0)
 ;     ["T" abort - log err and terminate
"RTN","BPSOSUE",21,0)
 ; UEMSG = optionally, an additional message to output
"RTN","BPSOSUE",22,0)
 ;    can be .MSG, and we'll walk the array for you.
"RTN","BPSOSUE",23,0)
 ; UEMSG2 = even more message, like UEMSG.  In a Fileman call failure,
"RTN","BPSOSUE",24,0)
 ;    you'd probably send   .FDA,.MSG
"RTN","BPSOSUE",25,0)
 ; UELOC = location, any number or name unique to the calling routine
"RTN","BPSOSUE",26,0)
 ; UEROU = the name of the calling routine
"RTN","BPSOSUE",27,0)
 ; UENOLOG = true if you do not want error log entry to be made
"RTN","BPSOSUE",28,0)
 ;
"RTN","BPSOSUE",29,0)
 ; $$ returns 1 to retry, 0 to ignore
"RTN","BPSOSUE",30,0)
 ;
"RTN","BPSOSUE",31,0)
 ; Caller may do with these values what he desires.
"RTN","BPSOSUE",32,0)
 ;
"RTN","BPSOSUE",33,0)
 ; To prevent excessive errors, we won't actually log an error if
"RTN","BPSOSUE",34,0)
 ; another one has been logged recently.
"RTN","BPSOSUE",35,0)
 ;
"RTN","BPSOSUE",36,0)
 ; This routine really isn't as important as it looks.   In fact,
"RTN","BPSOSUE",37,0)
 ; it will almost never be encountered in practice.  Its existence
"RTN","BPSOSUE",38,0)
 ; owes mostly to an outrageous ruling made in the name of,
"RTN","BPSOSUE",39,0)
 ; but contrary to, the very quality and maintainability that forced
"RTN","BPSOSUE",40,0)
 ; errors give you.  This in turn led to a significant delay 
"RTN","BPSOSUE",41,0)
 ; in the release of a product which has been proven to be dependable
"RTN","BPSOSUE",42,0)
 ; in practice. 
"RTN","BPSOSUE",43,0)
 ;
"RTN","BPSOSUE",44,0)
 ; Formerly, a zero/zero forced error was found at various places 
"RTN","BPSOSUE",45,0)
 ; in the code.  In 13 months at ANMC, 11 months at Sitka, 
"RTN","BPSOSUE",46,0)
 ; and several months at Pawhuska, Wewoka, Santa Fe, and Taos, the
"RTN","BPSOSUE",47,0)
 ; zero div by zero traps were never encountered, but over $3,000,000
"RTN","BPSOSUE",48,0)
 ; in revenues were collected.  The ironic thing is,
"RTN","BPSOSUE",49,0)
 ; without those extra checking, of things like Fileman return values,
"RTN","BPSOSUE",50,0)
 ; sanity checks on input values, etc., the product would have been
"RTN","BPSOSUE",51,0)
 ; less reliable, yet it would have sailed through the verifiction
"RTN","BPSOSUE",52,0)
 ; phase of the project plan.
"RTN","BPSOSUE",53,0)
 ;
"RTN","BPSOSUE",54,0)
 ; Forced errors already pervade all of the M language.  <UNDEF> is
"RTN","BPSOSUE",55,0)
 ; a forced error, for example.  And forced errors are an integral part
"RTN","BPSOSUE",56,0)
 ; of the design of the very hardware that runs these programs.
"RTN","BPSOSUE",57,0)
 ; Follow the anti-forced error policy to its logical end and you
"RTN","BPSOSUE",58,0)
 ; go to Intersleaze and say "stop issuing <UNDEF> and instead,
"RTN","BPSOSUE",59,0)
 ; prompt the user for the opportunity to continue" and then you go
"RTN","BPSOSUE",60,0)
 ; to Intel and say "remove the addressing exception trap from your
"RTN","BPSOSUE",61,0)
 ; microcode; our support organization wouldn't be able to cope with
"RTN","BPSOSUE",62,0)
 ; the problem report on something like that."
"RTN","BPSOSUE",63,0)
 ; 
"RTN","BPSOSUE",64,0)
 I $G(UEOPT)="" S UEOPT="TRI"
"RTN","BPSOSUE",65,0)
 I $G(ZTQUEUED) S UECHOICE=$E(UEOPT) G QD
"RTN","BPSOSUE",66,0)
 D:'$D(IOF) HOME^%ZIS ; make sure screen vars there
"RTN","BPSOSUE",67,0)
 U IO
"RTN","BPSOSUE",68,0)
 I '$D(IORVON) N IORVON,IORVOFF D
"RTN","BPSOSUE",69,0)
 . N X S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","BPSOSUE",70,0)
 W !!,IORVON
"RTN","BPSOSUE",71,0)
 W "An unexpected problem has been detected; notify programmer!"
"RTN","BPSOSUE",72,0)
 I $D(UELOC)!$D(UEROU) D
"RTN","BPSOSUE",73,0)
 . W !?5,"The problem occurred "
"RTN","BPSOSUE",74,0)
 . I $D(UELOC) W "at location ",UELOC," " W:$X>60 !
"RTN","BPSOSUE",75,0)
 . I $D(UEROU) W "in routine ",UEROU
"RTN","BPSOSUE",76,0)
 . W ".",!
"RTN","BPSOSUE",77,0)
 W !?5,"The likely source" W:UETYPE["," "s"
"RTN","BPSOSUE",78,0)
 W " of such a problem " W $S(UETYPE[",":"are",1:"is"),":",!!?5
"RTN","BPSOSUE",79,0)
 I UETYPE["FM" D
"RTN","BPSOSUE",80,0)
 . W "Fileman has reported an error to the program.",!?5
"RTN","BPSOSUE",81,0)
 I UETYPE["L" D
"RTN","BPSOSUE",82,0)
 . W "An interlock could not be obtained.",!?5
"RTN","BPSOSUE",83,0)
 I UETYPE["DB" D
"RTN","BPSOSUE",84,0)
 . W "An inconsistency in the database was detected.",!?5
"RTN","BPSOSUE",85,0)
 I UETYPE["DEV" D
"RTN","BPSOSUE",86,0)
 . W "An error condition trying to open a device or a file.",!?5
"RTN","BPSOSUE",87,0)
 I UETYPE["P" D
"RTN","BPSOSUE",88,0)
 . W "A condition the program was unprepared to handle",!?5
"RTN","BPSOSUE",89,0)
 . W "or perhaps an error in the program logic.",!?5
"RTN","BPSOSUE",90,0)
 W !,"A programmer should be notified of this unfortunate event.",!
"RTN","BPSOSUE",91,0)
 D MSG(.UEMSG),MSG(.UEMSG2)
"RTN","BPSOSUE",92,0)
 W IORVOFF,!!
"RTN","BPSOSUE",93,0)
 ;
"RTN","BPSOSUE",94,0)
 N UECHOICE S UECHOICE=$$CHOICE ; Present the options; get I, R, T
"RTN","BPSOSUE",95,0)
QD ;
"RTN","BPSOSUE",96,0)
 D LOGERR ; always log an error (unless too soon after prev. error)
"RTN","BPSOSUE",97,0)
 I UECHOICE="T" G HALT
"RTN","BPSOSUE",98,0)
 ;LJE;H $R(10)+1 ; could help various things (locks, database conditions)
"RTN","BPSOSUE",99,0)
 H 2
"RTN","BPSOSUE",100,0)
 Q:$Q $S(UECHOICE="I":0,UECHOICE="R":1) Q
"RTN","BPSOSUE",101,0)
 ;
"RTN","BPSOSUE",102,0)
MSG(X) ; display message, directly or in array
"RTN","BPSOSUE",103,0)
 I '$D(X) W "X is undefined",! Q
"RTN","BPSOSUE",104,0)
 I $D(X)#10 W X,!
"RTN","BPSOSUE",105,0)
 I $D(X)>9 D
"RTN","BPSOSUE",106,0)
 . N R S R="X" F  S R=$Q(@R) Q:R=""  W @R,!
"RTN","BPSOSUE",107,0)
 W !
"RTN","BPSOSUE",108,0)
 Q
"RTN","BPSOSUE",109,0)
 ;
"RTN","BPSOSUE",110,0)
CHOICE() ; given UEOPT[letters, UETYPE too
"RTN","BPSOSUE",111,0)
 I UEOPT="" S UEOPT="T"
"RTN","BPSOSUE",112,0)
 N DIR,X,Y
"RTN","BPSOSUE",113,0)
 I $L(UEOPT)=1 S X=UEOPT G CH5
"RTN","BPSOSUE",114,0)
 S DIR(0)="SM^",X=""
"RTN","BPSOSUE",115,0)
 I UEOPT["I" S X=X_"I:Ignore the problem and try to continue"
"RTN","BPSOSUE",116,0)
 I UEOPT["R" S:X]"" X=X_";" S X=X_"R:Retry the operation"
"RTN","BPSOSUE",117,0)
 I UEOPT["T" S:X]"" X=X_";" S X=X_"T:Terminate the program"
"RTN","BPSOSUE",118,0)
 I UETYPE'="L" S X=X_" (WE RECOMMEND ""T"")"
"RTN","BPSOSUE",119,0)
 S DIR(0)=DIR(0)_X
"RTN","BPSOSUE",120,0)
 S DIR("B")=$E(UEOPT) D ^DIR
"RTN","BPSOSUE",121,0)
CH5 Q $S(X?1U:X,1:"T")
"RTN","BPSOSUE",122,0)
 ;
"RTN","BPSOSUE",123,0)
LOGERR ; log an error
"RTN","BPSOSUE",124,0)
 ; ^TMP($J,$T(+0),$J)=DUZ^$H last time we did this
"RTN","BPSOSUE",125,0)
 N X S X=$G(^TMP($J,$T(+0),$J))
"RTN","BPSOSUE",126,0)
 I $P(X,U)'=DUZ G LOG2
"RTN","BPSOSUE",127,0)
 S X=$P(X,U,2) I +$H'=+X G LOG2
"RTN","BPSOSUE",128,0)
 S X=$P(X,",",2) I $P($H,",",2)-X>300 G LOG2
"RTN","BPSOSUE",129,0)
 I '$G(ZTQUEUED) D
"RTN","BPSOSUE",130,0)
 . W !,"No additional error log entry will be made at this time.",!
"RTN","BPSOSUE",131,0)
 Q
"RTN","BPSOSUE",132,0)
LOG2 ;
"RTN","BPSOSUE",133,0)
 Q:$G(UENOLOG)  ; requested: no error log entry
"RTN","BPSOSUE",134,0)
 I '$G(ZTQUEUED) D
"RTN","BPSOSUE",135,0)
 . W !,"Now recording some error log information to help the programmer...",!
"RTN","BPSOSUE",136,0)
 D @^%ZOSF("ERRTN") ; trap an error
"RTN","BPSOSUE",137,0)
 S ^TMP($J,$T(+0),$J)=DUZ_U_$H
"RTN","BPSOSUE",138,0)
 I '$D(ZTQUEUED) D
"RTN","BPSOSUE",139,0)
 . W ?10,"..." H 2 W "done.",!
"RTN","BPSOSUE",140,0)
 Q
"RTN","BPSOSUE",141,0)
HALT ; halt
"RTN","BPSOSUE",142,0)
 D H^XUS
"RTN","BPSOSUE",143,0)
 ; at this point, the user is logged off
"RTN","BPSOSUE",144,0)
 ; programmer shouldn't reach here, either, if HALT^ZU disinstackifies
"RTN","BPSOSUE",145,0)
 Q ""  ; <DPARM> error gets you back into programmer mode
"RTN","BPSOSUE",146,0)
TEST ;
"RTN","BPSOSUE",147,0)
 N MYEXMSG,I F I=1:1:4 S MYEXMSG(I)="my extra msg line "_I
"RTN","BPSOSUE",148,0)
 N X S X=$$IMPOSS^BPSOSUE("P","TIR","Additional Message",.MYEXMSG,"point 1","MYROU")
"RTN","BPSOSUE",149,0)
 W !,"returned value = ",X,!
"RTN","BPSOSUE",150,0)
 Q
"RTN","BPSOSX")
1^264
"RTN","BPSOSXA")
1^265
"RTN","BPSOSXE")
1^266
"RTN","BPSP11P")
0^293^B5532843
"RTN","BPSP11P",1,0)
BPSP11P ;BHAM ISC/FCS/DRS - Initialize BPS setup file. ;06/01/2004
"RTN","BPSP11P",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSP11P",3,0)
 Q
"RTN","BPSP11P",4,0)
EN ;
"RTN","BPSP11P",5,0)
 N BPSFN
"RTN","BPSP11P",6,0)
 S BPSFN=9002313.99
"RTN","BPSP11P",7,0)
 S:'$D(^BPS(BPSFN,1,2)) ^BPS(BPSFN,1,2)="PCN"
"RTN","BPSP11P",8,0)
 S:'$D(^BPS(BPSFN,1,3)) ^BPS(BPSFN,1,3)=0
"RTN","BPSP11P",9,0)
 S:'$D(^BPS(BPSFN,1,"A/R INTERFACE")) ^BPS(BPSFN,1,"A/R INTERFACE")=1
"RTN","BPSP11P",10,0)
 S:'$D(^BPS(BPSFN,1,"BILLING - NEW")) ^BPS(BPSFN,1,"BILLING - NEW")=""
"RTN","BPSP11P",11,0)
 S:'$D(^BPS(BPSFN,1,"BPSOS6*")) ^BPS(BPSFN,1,"BPSOS6*")="1^1"
"RTN","BPSP11P",12,0)
 S:'$D(^BPS(BPSFN,1,"BPSOSM1")) ^BPS(BPSFN,1,"BPSOSM1")="^^^^"
"RTN","BPSP11P",13,0)
 S:'$D(^BPS(BPSFN,1,"CERTIFIER")) ^BPS(BPSFN,1,"CERTIFIER")=""
"RTN","BPSP11P",14,0)
 S:'$D(^BPS(BPSFN,1,"CREATING A/R")) ^BPS(BPSFN,1,"CREATING A/R")="2^0^0"
"RTN","BPSP11P",15,0)
 S:'$D(^BPS(BPSFN,1,"FORMS - NCPDP")) ^BPS(BPSFN,1,"FORMS - NCPDP")="1^1^0^1"
"RTN","BPSP11P",16,0)
 S:'$D(^BPS(BPSFN,1,"INPUT")) ^BPS(BPSFN,1,"INPUT")="1^1^1"
"RTN","BPSP11P",17,0)
 S:'$D(^BPS(BPSFN,1,"INS")) ^BPS(BPSFN,1,"INS")="15^1"
"RTN","BPSP11P",18,0)
 S:'$D(^BPS(BPSFN,1,"INS BASE SCORES")) ^BPS(BPSFN,1,"INS BASE SCORES")="900^0^0^0^0"
"RTN","BPSP11P",19,0)
 S:'$D(^BPS(BPSFN,1,"SITE TYPE")) ^BPS(BPSFN,1,"SITE TYPE")=0
"RTN","BPSP11P",20,0)
 S:'$D(^BPS(BPSFN,1,"STARTUP")) ^BPS(BPSFN,1,"STARTUP")=3030616
"RTN","BPSP11P",21,0)
 S:'$D(^BPS(BPSFN,1,"UNBILLABLE OTC")) ^BPS(BPSFN,1,"UNBILLABLE OTC")=1
"RTN","BPSP11P",22,0)
 S:'$D(^BPS(BPSFN,1,"WRITEOFF-SCREEN")) ^BPS(BPSFN,1,"WRITEOFF-SCREEN")=1
"RTN","BPSP11P",23,0)
 S:'$D(^BPS(BPSFN,1,"WINNOW")) ^BPS(BPSFN,1,"WINNOW")="400^100^100^100^31^366^31^366^100^100^366^0"
"RTN","BPSP11P",24,0)
 S:'$D(^BPS(BPSFN,1,"WINNOW LOGS")) ^BPS(BPSFN,1,"WINNOW LOGS")="^"
"RTN","BPSP11P",25,0)
 D RMBSPT
"RTN","BPSP11P",26,0)
 D I403
"RTN","BPSP11P",27,0)
 D I427^BPS02P1
"RTN","BPSP11P",28,0)
 Q
"RTN","BPSP11P",29,0)
RMBSPT ;Remove erroneous entries and delete ^BSPT global due to mis-spelling error
"RTN","BPSP11P",30,0)
 N TRNDX,RESPIEN,TY,X,X1,X2
"RTN","BPSP11P",31,0)
 S TRNDX="",TY="BPST"
"RTN","BPSP11P",32,0)
 I '$D(^XTMP(TY)) S X1=DT,X2=+30 D C^%DTC S ^XTMP(TY,0)=$G(X)_"^"_DT
"RTN","BPSP11P",33,0)
 F  S TRNDX=$O(^BSPT(TRNDX)) Q:TRNDX=""  D
"RTN","BPSP11P",34,0)
 .S RESPIEN=$P(^BSPT(TRNDX,0),"^",5)
"RTN","BPSP11P",35,0)
 .S ^XTMP(TY,TRNDX,0)=^BSPT(TRNDX,0)
"RTN","BPSP11P",36,0)
 .K ^BSPT(TRNDX,0)
"RTN","BPSP11P",37,0)
 .Q:'$D(^BPST(TRNDX,0))
"RTN","BPSP11P",38,0)
 .I RESPIEN,$P(^BPST(TRNDX,0),U,5)'=RESPIEN S $P(^BPST(TRNDX,0),U,5)=RESPIEN
"RTN","BPSP11P",39,0)
 Q
"RTN","BPSP11P",40,0)
I403 ; Remove erroneous BPSECP entry
"RTN","BPSP11P",41,0)
 I $D(^BPSECP("BPSOSRX","UNCLAIM")) K ^BPSECP("BPSOSRX","UNCLAIM")
"RTN","BPSP11P",42,0)
 Q
"RTN","BPSPHAR")
0^347^B990047
"RTN","BPSPHAR",1,0)
BPSPHAR ;BHAM ISC/BEE - ECME MGR PHAR OPTION ;14-FEB-05
"RTN","BPSPHAR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSPHAR",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSPHAR",4,0)
 ;
"RTN","BPSPHAR",5,0)
 ;This routine is called by the [BPS SETUP PHARMACY] menu option. It updates
"RTN","BPSPHAR",6,0)
 ;several fields in the [BPS PHARMACIES] file.
"RTN","BPSPHAR",7,0)
 ;
"RTN","BPSPHAR",8,0)
 Q
"RTN","BPSPHAR",9,0)
 ;
"RTN","BPSPHAR",10,0)
EN N D0,DA,DI,DIC,DLAYGO,DIE,DIRUT,DQ,DR,DTOUT,DUOUT,X,Y
"RTN","BPSPHAR",11,0)
 ;
"RTN","BPSPHAR",12,0)
 ;First select the pharmacy or enter a new one
"RTN","BPSPHAR",13,0)
 W !! S DIC(0)="QEALM",(DLAYGO,DIC)=9002313.56,DIC("A")="Select BPS PHARMACIES NAME: "
"RTN","BPSPHAR",14,0)
 D ^DIC
"RTN","BPSPHAR",15,0)
 ;
"RTN","BPSPHAR",16,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSPHAR",17,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)=-1) Q
"RTN","BPSPHAR",18,0)
 ;
"RTN","BPSPHAR",19,0)
 ;Pull internal entry
"RTN","BPSPHAR",20,0)
 S DA=$P($G(Y),U) Q:'$G(Y)
"RTN","BPSPHAR",21,0)
 ;
"RTN","BPSPHAR",22,0)
 ;Now edit OUTPATIENT SITE, NCPDP #, CMOP SWITCH, AUTO-REVERSE PARAMETER, and
"RTN","BPSPHAR",23,0)
 ;the DEFAULT DEA #
"RTN","BPSPHAR",24,0)
 S DIE=9002313.56
"RTN","BPSPHAR",25,0)
 S DR="13800;.02;1;.09;.03"
"RTN","BPSPHAR",26,0)
 S DR(2,9002313.5601)=".01"
"RTN","BPSPHAR",27,0)
 D ^DIE
"RTN","BPSPHAR",28,0)
 ;
"RTN","BPSPHAR",29,0)
 Q
"RTN","BPSRDT")
1^268
"RTN","BPSRDT1")
0^290^B17984819
"RTN","BPSRDT1",1,0)
BPSRDT1 ;BHAM ISC/FCS/DRS/FLS/DLF - Turn Around Time Statistics Report ;06/01/2004
"RTN","BPSRDT1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRDT1",3,0)
 N TRANDT,FR,TO,BPSSIZ,BPSTTAT,IEN57,IEN59,BPSEQ,ENDLOOP,BPSTATIM
"RTN","BPSRDT1",4,0)
 N BPSBGN,BPSBTIM,BPSCTIM,BPSEND,BPSETIM,BPSGTIM,BPSRTIM,BPSSTIM
"RTN","BPSRDT1",5,0)
 N BPSBDT,BPSCNT,X,Y,BPSQUIT,MES,TYPE,DATA,%,ENDCNT
"RTN","BPSRDT1",6,0)
 K ^TMP("BPSRDT1",$J)
"RTN","BPSRDT1",7,0)
 D DATE I Y<0 K DTOUT Q
"RTN","BPSRDT1",8,0)
 S TRANDT=FR,BPSSIZ=0,BPSTTAT=0,BPSCNT=0
"RTN","BPSRDT1",9,0)
 I '$O(^BPSTL("AH",TRANDT)) G QUIT
"RTN","BPSRDT1",10,0)
 F  S TRANDT=$O(^BPSTL("AH",TRANDT)) Q:TRANDT=""!($P(TRANDT,".")>TO)  D
"RTN","BPSRDT1",11,0)
 . S IEN57=""
"RTN","BPSRDT1",12,0)
 . F  S IEN57=$O(^BPSTL("AH",TRANDT,IEN57)) Q:IEN57=""  D
"RTN","BPSRDT1",13,0)
 .. S IEN59=$P($G(^BPSTL(IEN57,0)),U,1)
"RTN","BPSRDT1",14,0)
 .. I IEN59 S ^TMP("BPSRDT1",$J,1,IEN59)=""
"RTN","BPSRDT1",15,0)
 S IEN59=""
"RTN","BPSRDT1",16,0)
 F  S IEN59=$O(^TMP("BPSRDT1",$J,1,IEN59)) Q:IEN59=""  D
"RTN","BPSRDT1",17,0)
 . I '$D(^BPSECP("LOG",IEN59)) Q
"RTN","BPSRDT1",18,0)
 . S BPSEQ=0,ENDLOOP=0,ENDCNT=0
"RTN","BPSRDT1",19,0)
 . S (BPSBDT,BPSBGN,BPSEND,BPSBTIM,BPSGTIM,BPSCTIM,BPSSTIM,BPSRTIM,BPSETIM,TYPE)=""
"RTN","BPSRDT1",20,0)
 . F  S BPSEQ=$O(^BPSECP("LOG",IEN59,BPSEQ)) Q:BPSEQ=""!(ENDLOOP=1)  D
"RTN","BPSRDT1",21,0)
 .. S MES=$$UP($P(^BPSECP("LOG",IEN59,BPSEQ),"^",2))
"RTN","BPSRDT1",22,0)
 .. I MES="" Q
"RTN","BPSRDT1",23,0)
 .. I MES["BEFORE SUBMIT OF " D
"RTN","BPSRDT1",24,0)
 ... S BPSBDT=$P($P(MES," - ",2)," BEFORE SUBMIT OF ",1)
"RTN","BPSRDT1",25,0)
 ... I BPSBDT<FR S BPSBDT="" Q
"RTN","BPSRDT1",26,0)
 ... I BPSBDT>TO S BPSBDT="",ENDLOOP=1 Q
"RTN","BPSRDT1",27,0)
 ... S TYPE=$P(MES," BEFORE SUBMIT OF ",2)
"RTN","BPSRDT1",28,0)
 ... S (%,BPSBGN)=$P(^BPSECP("LOG",IEN59,BPSEQ),"^") D TIME(.BPSBTIM)
"RTN","BPSRDT1",29,0)
 ... S (BPSEND,BPSGTIM,BPSCTIM,BPSSTIM,BPSRTIM,BPSETIM)=""
"RTN","BPSRDT1",30,0)
 .. I ENDLOOP=1 Q
"RTN","BPSRDT1",31,0)
 .. I BPSBDT,MES["BPSOSU NOW RESUBMIT" D
"RTN","BPSRDT1",32,0)
 ... S TYPE="Request portion of a Revesal/Resubmit"
"RTN","BPSRDT1",33,0)
 ... S (%,BPSBGN)=$P(^BPSECP("LOG",IEN59,BPSEQ),"^") D TIME(.BPSBTIM)
"RTN","BPSRDT1",34,0)
 ... S (BPSEND,BPSGTIM,BPSCTIM,BPSSTIM,BPSRTIM,BPSETIM)=""
"RTN","BPSRDT1",35,0)
 .. I BPSBGN="" Q
"RTN","BPSRDT1",36,0)
 .. I MES["INITIATING REVERSAL AND AFTER THAT, CLAIM WILL BE RESUBMITTED" S TYPE="Reversal portion of a Reversal/Resubmit"
"RTN","BPSRDT1",37,0)
 .. I MES["GATHERING" S %=$P(^BPSECP("LOG",IEN59,BPSEQ),"^") D TIME(.BPSGTIM)
"RTN","BPSRDT1",38,0)
 .. I MES["CREATED CLAIM ID" S %=$P(^BPSECP("LOG",IEN59,BPSEQ),"^") D TIME(.BPSCTIM)
"RTN","BPSRDT1",39,0)
 .. I MES["BPSECMC2 - CLAIM - SENT" S %=$P(^BPSECP("LOG",IEN59,BPSEQ),"^") D TIME(.BPSSTIM)
"RTN","BPSRDT1",40,0)
 .. I MES["BPSECMC2 - CLAIM - RESPONSE STORED" S %=$P(^BPSECP("LOG",IEN59,BPSEQ),"^") D TIME(.BPSRTIM)
"RTN","BPSRDT1",41,0)
 .. I MES["CLAIM - END" S (%,BPSEND)=$P(^BPSECP("LOG",IEN59,BPSEQ),"^") D
"RTN","BPSRDT1",42,0)
 ... I BPSBGN D TIME(.BPSETIM),LOG Q
"RTN","BPSRDT1",43,0)
 I 'BPSTTAT G QUIT
"RTN","BPSRDT1",44,0)
 S BPSCNT="",BPSQUIT=0
"RTN","BPSRDT1",45,0)
 F  S BPSCNT=$O(^TMP("BPSRDT1",$J,2,BPSCNT)) Q:BPSCNT=""  D  I BPSQUIT=1 Q
"RTN","BPSRDT1",46,0)
 . S DATA=$G(^TMP("BPSRDT1",$J,2,BPSCNT)),IEN59=$P(DATA,U,1),TYPE=$P(DATA,U,2)
"RTN","BPSRDT1",47,0)
 . S TYPE=$S(TYPE="CLAIM":"Request",TYPE="REVERSAL":"Reversal",1:TYPE)
"RTN","BPSRDT1",48,0)
 . W !,"For Prescription: ",?40,IEN59_"  (Rx#: "_$P($G(^PSRX($P(IEN59,"."),0)),"^")_")"
"RTN","BPSRDT1",49,0)
 . ;W !,"Type: ",?40,TYPE
"RTN","BPSRDT1",50,0)
 . ;W !,"Date: ",?40,$$FMTE^XLFDT($P(DATA,U,3),"5Z")
"RTN","BPSRDT1",51,0)
 . W !,"Begin ",?40,$P(DATA,U,4)
"RTN","BPSRDT1",52,0)
 . W !,"Gathering information",?40,$P(DATA,U,5)
"RTN","BPSRDT1",53,0)
 . W !,"Claim ID created",?40,$P(DATA,U,6)
"RTN","BPSRDT1",54,0)
 . W !,"Claim Sent",?40,$P(DATA,U,7)
"RTN","BPSRDT1",55,0)
 . W !,"Response stored ",?40,$P(DATA,U,8)
"RTN","BPSRDT1",56,0)
 . W !,"Completed at:",?40,$P(DATA,U,9)
"RTN","BPSRDT1",57,0)
 . W !,"Turn-around time",?40,$P(DATA,U,10),!
"RTN","BPSRDT1",58,0)
 . I BPSCNT#2=0 D
"RTN","BPSRDT1",59,0)
 .. R !!,"Press RETURN to continue, '^' to exit: ",X:DTIME
"RTN","BPSRDT1",60,0)
 .. I '$T!(X["^") S BPSQUIT=1
"RTN","BPSRDT1",61,0)
 ;
"RTN","BPSRDT1",62,0)
 ; Write Totals
"RTN","BPSRDT1",63,0)
 ;W !!!,"Total number of claims: ",?40,BPSSIZ
"RTN","BPSRDT1",64,0)
 W !!!,"Average Turn-around time: ",?40,BPSTTAT\BPSSIZ,!!
"RTN","BPSRDT1",65,0)
 ;R !!,"Press RETURN to continue: ",X:DTIME
"RTN","BPSRDT1",66,0)
 K ^TMP("BPSRDT1",$J)
"RTN","BPSRDT1",67,0)
 Q
"RTN","BPSRDT1",68,0)
 ;
"RTN","BPSRDT1",69,0)
LOG ;
"RTN","BPSRDT1",70,0)
 I BPSBGN="" Q
"RTN","BPSRDT1",71,0)
 I BPSEND="" Q
"RTN","BPSRDT1",72,0)
 S BPSTATIM=$G(BPSEND)-$G(BPSBGN)
"RTN","BPSRDT1",73,0)
 ;
"RTN","BPSRDT1",74,0)
 ; Remove negative times (span midnight) and claims more than 20 minutes as anomolies
"RTN","BPSRDT1",75,0)
 I BPSTATIM'>0 Q
"RTN","BPSRDT1",76,0)
 ;I BPSTATIM>1200 Q
"RTN","BPSRDT1",77,0)
 S BPSCNT=BPSCNT+1
"RTN","BPSRDT1",78,0)
 S ^TMP("BPSRDT1",$J,2,BPSCNT)=IEN59_U_TYPE_U_BPSBDT_U_BPSBTIM_U_BPSGTIM_U_BPSCTIM_U_BPSSTIM_U_BPSRTIM_U_BPSETIM_U_BPSTATIM
"RTN","BPSRDT1",79,0)
 S BPSTTAT=BPSTTAT+BPSTATIM
"RTN","BPSRDT1",80,0)
 S BPSSIZ=BPSSIZ+1
"RTN","BPSRDT1",81,0)
 I TYPE="Reversal/Resubmit" S BPSSIZ=BPSSIZ+1
"RTN","BPSRDT1",82,0)
 S (BPSBGN,BPSBTIM,TYPE)=""
"RTN","BPSRDT1",83,0)
 Q
"RTN","BPSRDT1",84,0)
 ;
"RTN","BPSRDT1",85,0)
TIME(CTIM) ;
"RTN","BPSRDT1",86,0)
 D S^%DTC
"RTN","BPSRDT1",87,0)
 I $L(%)=5 S %=%_"00"
"RTN","BPSRDT1",88,0)
 I $L(%)=6 S %=%_"0"
"RTN","BPSRDT1",89,0)
 S CTIM=$E(%,2,3)_":"_$E(%,4,5)_":"_$E(%,6,7)
"RTN","BPSRDT1",90,0)
 Q
"RTN","BPSRDT1",91,0)
DATE ; Release date is free text. For sorts to work we need a precise format, this sub handles that.
"RTN","BPSRDT1",92,0)
 N %DT,VAL,TYPEVAL,X
"RTN","BPSRDT1",93,0)
 S %DT="AEP",%DT(0)=-DT,%DT("A")="START WITH DATE: "
"RTN","BPSRDT1",94,0)
 S %DT("B")="T-1"
"RTN","BPSRDT1",95,0)
 D ^%DT Q:Y<0!($D(DTOUT))
"RTN","BPSRDT1",96,0)
 S (%DT(0),FR)=Y
"RTN","BPSRDT1",97,0)
 S %DT("A")="GO TO DATE: "
"RTN","BPSRDT1",98,0)
 S %DT("B")="T"
"RTN","BPSRDT1",99,0)
 D ^%DT Q:Y<0!($D(DTOUT))
"RTN","BPSRDT1",100,0)
 S TO=Y
"RTN","BPSRDT1",101,0)
 Q
"RTN","BPSRDT1",102,0)
 ;
"RTN","BPSRDT1",103,0)
UP(X) Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSRDT1",104,0)
QUIT ;
"RTN","BPSRDT1",105,0)
 W !!,"*** No valid data found ***",!!
"RTN","BPSRDT1",106,0)
 Q
"RTN","BPSRPAY")
0^346^B35284657
"RTN","BPSRPAY",1,0)
BPSRPAY ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPAY",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRPAY",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRPAY",4,0)
 ;
"RTN","BPSRPAY",5,0)
 Q
"RTN","BPSRPAY",6,0)
 ;
"RTN","BPSRPAY",7,0)
 ; Payer Sheet Display Report
"RTN","BPSRPAY",8,0)
 ; 
"RTN","BPSRPAY",9,0)
 ;User Prompts
"RTN","BPSRPAY",10,0)
EN N BPFILE,BPIEN,BPSCR,BPQ
"RTN","BPSRPAY",11,0)
 S BPFILE=9002313.92
"RTN","BPSRPAY",12,0)
 ;
"RTN","BPSRPAY",13,0)
 ;Select Payer Sheet
"RTN","BPSRPAY",14,0)
 I $D(IOF) W @IOF
"RTN","BPSRPAY",15,0)
 W !,"Payer Sheet Detail Report",!!
"RTN","BPSRPAY",16,0)
 S BPIEN=$$BPIEN(BPFILE)
"RTN","BPSRPAY",17,0)
 ;
"RTN","BPSRPAY",18,0)
 ;Check for Valid Entry
"RTN","BPSRPAY",19,0)
 I BPIEN=-1 G EXIT
"RTN","BPSRPAY",20,0)
 ;
"RTN","BPSRPAY",21,0)
 ;Select Device
"RTN","BPSRPAY",22,0)
 I $$DEVICE=-1 G EXIT
"RTN","BPSRPAY",23,0)
 ;
"RTN","BPSRPAY",24,0)
 ;Display Data
"RTN","BPSRPAY",25,0)
 D RUN(BPFILE,BPIEN)
"RTN","BPSRPAY",26,0)
 ;
"RTN","BPSRPAY",27,0)
 ;Exit
"RTN","BPSRPAY",28,0)
EXIT Q
"RTN","BPSRPAY",29,0)
 ;
"RTN","BPSRPAY",30,0)
 ;Display the Payer Sheet Info
"RTN","BPSRPAY",31,0)
 ;
"RTN","BPSRPAY",32,0)
RUN(BPFILE,BPIEN) N BPQ
"RTN","BPSRPAY",33,0)
 D PSPRNT(BPFILE,BPIEN)
"RTN","BPSRPAY",34,0)
 Q
"RTN","BPSRPAY",35,0)
 ;
"RTN","BPSRPAY",36,0)
 ; Select a payer sheet
"RTN","BPSRPAY",37,0)
BPIEN(BPFILE) N DIC,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPAY",38,0)
 S DIC=$$ROOT^DILFD(BPFILE),DIC(0)="AEMQ"
"RTN","BPSRPAY",39,0)
 S DIC("A")="Select Payer Sheet: "
"RTN","BPSRPAY",40,0)
 D ^DIC
"RTN","BPSRPAY",41,0)
 Q +Y
"RTN","BPSRPAY",42,0)
 ;
"RTN","BPSRPAY",43,0)
 ;Select the output Device
"RTN","BPSRPAY",44,0)
DEVICE() N %ZIS,IOP,ZTSK,ZTRTN,ZTIO,ZTSAVE,ZTDESC,POP,BPQ
"RTN","BPSRPAY",45,0)
 S BPQ=0
"RTN","BPSRPAY",46,0)
 S %ZIS="QM"
"RTN","BPSRPAY",47,0)
 W ! D ^%ZIS
"RTN","BPSRPAY",48,0)
 I POP Q -1
"RTN","BPSRPAY",49,0)
 S BPSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSRPAY",50,0)
 I $D(IO("Q")) D  S BPQ=-1
"RTN","BPSRPAY",51,0)
 . S ZTRTN="RUN^BPSRPAY(BPFILE,BPIEN)"
"RTN","BPSRPAY",52,0)
 . S ZTIO=ION
"RTN","BPSRPAY",53,0)
 . S ZTSAVE("*")=""
"RTN","BPSRPAY",54,0)
 . S ZTDESC="PAYER SHEET DETAIL REPORT"
"RTN","BPSRPAY",55,0)
 . D ^%ZTLOAD
"RTN","BPSRPAY",56,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","BPSRPAY",57,0)
 . D HOME^%ZIS
"RTN","BPSRPAY",58,0)
 U IO
"RTN","BPSRPAY",59,0)
 Q BPQ
"RTN","BPSRPAY",60,0)
 ;
"RTN","BPSRPAY",61,0)
 ; Payer Sheet Display
"RTN","BPSRPAY",62,0)
PSPRNT(BPFILE,EN) N BPSHDR,BPIEN,BPPAGE,BPQ,CD,L,N,N1,N2,NAME,NM,NUM,SEG,SP
"RTN","BPSRPAY",63,0)
 N SEGNM,TB,WP,X,X0,X5,ZTREQ
"RTN","BPSRPAY",64,0)
 ;
"RTN","BPSRPAY",65,0)
 ; Build List of Segment Header Names
"RTN","BPSRPAY",66,0)
 D INIT
"RTN","BPSRPAY",67,0)
 ;
"RTN","BPSRPAY",68,0)
 ; Get header information
"RTN","BPSRPAY",69,0)
 S BPIEN=EN_","
"RTN","BPSRPAY",70,0)
 D GETS^DIQ(BPFILE,EN,".01;1.02;1.03;1.06;1.07;1.13;1.14;1001","","BPSHDR")
"RTN","BPSRPAY",71,0)
 ;
"RTN","BPSRPAY",72,0)
 ; Display Header Information
"RTN","BPSRPAY",73,0)
 S BPQ=0,BPPAGE=0,SEGNM=""
"RTN","BPSRPAY",74,0)
 D HDR
"RTN","BPSRPAY",75,0)
 ;
"RTN","BPSRPAY",76,0)
 ; Field Detail Information
"RTN","BPSRPAY",77,0)
 ; Loop through Segments
"RTN","BPSRPAY",78,0)
 S SEG=99 F  S SEG=$O(^BPSF(BPFILE,EN,SEG)) Q:SEG=""!(SEG>230)!(SEG="REVERSAL")  D  I BPQ Q
"RTN","BPSRPAY",79,0)
 . ;
"RTN","BPSRPAY",80,0)
 . ;Make sure there are entries for the segment
"RTN","BPSRPAY",81,0)
 . I $P($G(^BPSF(BPFILE,EN,SEG,0)),U,4)<1 Q
"RTN","BPSRPAY",82,0)
 . ;
"RTN","BPSRPAY",83,0)
 . ; Get and display Segment Name
"RTN","BPSRPAY",84,0)
 . S SEGNM=$G(NAME(SEG))
"RTN","BPSRPAY",85,0)
 . ; Check that we can display the Segment Name and at least one additional field
"RTN","BPSRPAY",86,0)
 . D CHKP(2) I BPQ Q
"RTN","BPSRPAY",87,0)
 . I BPPAGE=1!($Y>5) W !,?((60-$L(SEGNM)+8)/2),"*** ",SEGNM," ***"
"RTN","BPSRPAY",88,0)
 . ; Loop through the Field via the Sequence Number
"RTN","BPSRPAY",89,0)
 . S N=0 F  S N=$O(^BPSF(BPFILE,EN,SEG,"B",N)) Q:N=""  D  I BPQ Q
"RTN","BPSRPAY",90,0)
 .. S N1=0 F  S N1=$O(^BPSF(BPFILE,EN,SEG,"B",N,N1)) Q:N1=""  D  I BPQ Q
"RTN","BPSRPAY",91,0)
 ... ;
"RTN","BPSRPAY",92,0)
 ... ; Get Field Data and Format the Field Number
"RTN","BPSRPAY",93,0)
 ... S X=$G(^BPSF(BPFILE,EN,SEG,N1,0))
"RTN","BPSRPAY",94,0)
 ... S NUM=$P(X,U,2),SP=$P(X,U,3)
"RTN","BPSRPAY",95,0)
 ... I NUM S X0=$G(^BPSF(9002313.91,NUM,0)),X5=$G(^BPSF(9002313.91,NUM,5))
"RTN","BPSRPAY",96,0)
 ... E  S (X0,X5)=""
"RTN","BPSRPAY",97,0)
 ... S NUM=$P(X0,U,1)_"-"_$P(X5,U,1),NM=$P(X0,U,3)
"RTN","BPSRPAY",98,0)
 ... ;
"RTN","BPSRPAY",99,0)
 ... ; Display the field information
"RTN","BPSRPAY",100,0)
 ... D CHKP(1) I BPQ Q
"RTN","BPSRPAY",101,0)
 ... W !,N,?5,NUM,?17,NM,?71,$J(SP,9)
"RTN","BPSRPAY",102,0)
 ... ;
"RTN","BPSRPAY",103,0)
 ... ; If there is special code, display it
"RTN","BPSRPAY",104,0)
 ... I SP="X" S N2=0 F  S N2=$O(^BPSF(BPFILE,EN,SEG,N1,1,N2)) Q:N2=""  D  I BPQ Q
"RTN","BPSRPAY",105,0)
 .... S CD=$G(^BPSF(BPFILE,EN,SEG,N1,1,N2,0))
"RTN","BPSRPAY",106,0)
 .... S TB=19,L=61,WP=0
"RTN","BPSRPAY",107,0)
 .... F  D CHKP(1) Q:BPQ  W ! D  Q:CD=""
"RTN","BPSRPAY",108,0)
 ..... W:N2=1 ?5,"Special Code: "
"RTN","BPSRPAY",109,0)
 ..... W:WP=1 ?12,"<cont>"
"RTN","BPSRPAY",110,0)
 ..... W ?19,$E(CD,1,L)
"RTN","BPSRPAY",111,0)
 ..... S CD=$E(CD,L+1,200) Q:CD=""
"RTN","BPSRPAY",112,0)
 ..... S WP=1
"RTN","BPSRPAY",113,0)
 . I BPQ Q
"RTN","BPSRPAY",114,0)
 .D CHKP(1) Q:BPQ  W !
"RTN","BPSRPAY",115,0)
 I 'BPSCR W !,@IOF
"RTN","BPSRPAY",116,0)
 E  I 'BPQ D PAUSE2
"RTN","BPSRPAY",117,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","BPSRPAY",118,0)
 D ^%ZISC
"RTN","BPSRPAY",119,0)
XPRT Q
"RTN","BPSRPAY",120,0)
 ;
"RTN","BPSRPAY",121,0)
 ;Display Report Header
"RTN","BPSRPAY",122,0)
 ;
"RTN","BPSRPAY",123,0)
HDR S BPPAGE=$G(BPPAGE)+1
"RTN","BPSRPAY",124,0)
 W @IOF
"RTN","BPSRPAY",125,0)
 W "Payer Sheet Detail Report"
"RTN","BPSRPAY",126,0)
 W ?48,"Print Date: "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","BPSRPAY",127,0)
 W "    Page:",$J(BPPAGE,3)
"RTN","BPSRPAY",128,0)
 W !,$J("Payer Sheet Name: ",20),$G(BPSHDR(BPFILE,BPIEN,.01))
"RTN","BPSRPAY",129,0)
 W ?40,$J("Version Number: ",20),$G(BPSHDR(BPFILE,BPIEN,1.14))
"RTN","BPSRPAY",130,0)
 I BPPAGE=1 D
"RTN","BPSRPAY",131,0)
 . W !,$J("Status: ",20),$G(BPSHDR(BPFILE,BPIEN,1.06))
"RTN","BPSRPAY",132,0)
 . W ?40,$J("NCPDP Version: ",20),$G(BPSHDR(BPFILE,BPIEN,1.02))
"RTN","BPSRPAY",133,0)
 . W !,$J("Reversal Format: ",20),$G(BPSHDR(BPFILE,BPIEN,1.07))
"RTN","BPSRPAY",134,0)
 . W ?40,$J("Reversal Sheet: ",20),$G(BPSHDR(BPFILE,BPIEN,1001))
"RTN","BPSRPAY",135,0)
 . W !,$J("Transaction Count: ",20),$G(BPSHDR(BPFILE,BPIEN,1.03))
"RTN","BPSRPAY",136,0)
 . W ?40,$J("Certification ID: ",20),$G(BPSHDR(BPFILE,BPIEN,1.13))
"RTN","BPSRPAY",137,0)
 ;
"RTN","BPSRPAY",138,0)
 ; Display subheader
"RTN","BPSRPAY",139,0)
 W !!,"Seq",?5,"Field",?17,"Field Name",?71,"Proc Mode"
"RTN","BPSRPAY",140,0)
 W !,"---",?5,"-----",?17,"----------",?71,"---------"
"RTN","BPSRPAY",141,0)
 I $G(SEGNM)]"" W !,?((60-$L(SEGNM)+8)/2),"*** ",SEGNM," ***"
"RTN","BPSRPAY",142,0)
 Q
"RTN","BPSRPAY",143,0)
 ;
"RTN","BPSRPAY",144,0)
 ;Check for End of Page
"RTN","BPSRPAY",145,0)
 ;
"RTN","BPSRPAY",146,0)
 ; Input variable -> BPLINES - Number of lines from bottom
"RTN","BPSRPAY",147,0)
 ;                      CONT - 0 = New Entry, 1 = Continue Entry
"RTN","BPSRPAY",148,0)
 ; 
"RTN","BPSRPAY",149,0)
CHKP(BPLINES) S BPLINES=BPLINES+1
"RTN","BPSRPAY",150,0)
 I $G(BPSCR) S BPLINES=BPLINES+3
"RTN","BPSRPAY",151,0)
 I $Y>(IOSL-BPLINES) D:$G(BPSCR) PAUSE Q:$G(BPQ) 0 D HDR Q 1
"RTN","BPSRPAY",152,0)
 Q 0
"RTN","BPSRPAY",153,0)
 ;
"RTN","BPSRPAY",154,0)
PAUSE ;
"RTN","BPSRPAY",155,0)
 N X
"RTN","BPSRPAY",156,0)
 U IO(0)
"RTN","BPSRPAY",157,0)
 R !!,"Press RETURN to continue, '^' to exit: ",X:DTIME
"RTN","BPSRPAY",158,0)
 I '$T S X="^"
"RTN","BPSRPAY",159,0)
 I X["^" S BPQ=1
"RTN","BPSRPAY",160,0)
 U IO
"RTN","BPSRPAY",161,0)
 Q
"RTN","BPSRPAY",162,0)
 ;
"RTN","BPSRPAY",163,0)
PAUSE2 ;
"RTN","BPSRPAY",164,0)
 N X
"RTN","BPSRPAY",165,0)
 U IO(0)
"RTN","BPSRPAY",166,0)
 R !,"Press RETURN to continue: ",X:DTIME
"RTN","BPSRPAY",167,0)
 U IO
"RTN","BPSRPAY",168,0)
 Q
"RTN","BPSRPAY",169,0)
 ;
"RTN","BPSRPAY",170,0)
INIT ; Create local array of segment header names
"RTN","BPSRPAY",171,0)
 S NAME(100)="Transaction Header Segment",NAME(110)="Patient Segment"
"RTN","BPSRPAY",172,0)
 S NAME(120)="Insurance Segment",NAME(130)="Claim Segment"
"RTN","BPSRPAY",173,0)
 S NAME(140)="Pharmacy Provider Segment",NAME(150)="Prescriber Segment"
"RTN","BPSRPAY",174,0)
 S NAME(160)="COB/Other Payments Segment",NAME(170)="Workers' Compensation Segment"
"RTN","BPSRPAY",175,0)
 S NAME(180)="DUR/PPS Segment",NAME(190)="Pricing Segment"
"RTN","BPSRPAY",176,0)
 S NAME(200)="Coupon Segment",NAME(210)="Compound Segment"
"RTN","BPSRPAY",177,0)
 S NAME(220)="Prior Authorization Segment",NAME(230)="Clinical Segment"
"RTN","BPSRPAY",178,0)
 Q
"RTN","BPSRPT0")
0^300^B20529533
"RTN","BPSRPT0",1,0)
BPSRPT0 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT0",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRPT0",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRPT0",4,0)
 ;
"RTN","BPSRPT0",5,0)
 Q
"RTN","BPSRPT0",6,0)
 ;
"RTN","BPSRPT0",7,0)
 ; Front End for ECME Reports
"RTN","BPSRPT0",8,0)
 ; 
"RTN","BPSRPT0",9,0)
 ; Input variable: BPRTYPE -> 1 = Payable Claims
"RTN","BPSRPT0",10,0)
 ;                          2 = Rejected Claims
"RTN","BPSRPT0",11,0)
 ;                          3 = Claims Submitted, Not Yet Released
"RTN","BPSRPT0",12,0)
 ;                          4 = Reversed Claims
"RTN","BPSRPT0",13,0)
 ;                          5 = Recent Transactions
"RTN","BPSRPT0",14,0)
 ;                          6 = Totals By Date
"RTN","BPSRPT0",15,0)
 ;                          7 = Closed Claims
"RTN","BPSRPT0",16,0)
 ;                          
"RTN","BPSRPT0",17,0)
 ; Passed variables - The following local variables are passed around the BPSRPT* routines
"RTN","BPSRPT0",18,0)
 ;                    and are not passed as parameters but are assumed to be defined:
"RTN","BPSRPT0",19,0)
 ;                    BPACREJ,BPAUTREV,BPBEGDT,BPBLINE,BPCCRSN,BPDRGCL,BPDRUG,BPENDDT,BPEXCEL,
"RTN","BPSRPT0",20,0)
 ;                    BPINSINF,BPGRPLN,BPMWC,BPNOW,BPPAGE,BPPHARM,BPQ,BPQSTDRG,
"RTN","BPSRPT0",21,0)
 ;                    BPRLNRL,BPRTBCK,BPSDATA,BPSUMDET,BPRTYPE
"RTN","BPSRPT0",22,0)
 ;                          
"RTN","BPSRPT0",23,0)
EN(BPRTYPE) N %,BPACREJ,BPAUTREV,BPBEGDT,BPCCRSN,BPDRGCL,BPDRUG,BPENDDT,BPEXCEL,BPNOW,BPPHARM,BPINSINF,BPMWC,BPQ,BPQSTDRG
"RTN","BPSRPT0",24,0)
 N BPREJCD,BPRLNRL,BPRPTNAM,BPRTBCK,BPSCR,BPSUMDET,CODE,POS,STAT,X,Y
"RTN","BPSRPT0",25,0)
 ;
"RTN","BPSRPT0",26,0)
 ;Verify that a valid report has been requested
"RTN","BPSRPT0",27,0)
 I ",1,2,3,4,5,6,7,"'[(","_$G(BPRTYPE)_",") W "<Invalid Menu Definition - Report Undefined>" H 3 Q
"RTN","BPSRPT0",28,0)
 S BPRPTNAM=$S(BPRTYPE=1:"PAYABLE CLAIMS",BPRTYPE=2:"REJECTED CLAIMS",BPRTYPE=3:"SUBMIT,NOT RELEASED CLAIMS",BPRTYPE=4:"REVERSED CLAIMS",BPRTYPE=5:"RECENT TRANSACTIONS",BPRTYPE=6:"TOTALS",BPRTYPE=7:"CLOSED CLAIMS",1:"")
"RTN","BPSRPT0",29,0)
 ;
"RTN","BPSRPT0",30,0)
 ;Get current Date/Time
"RTN","BPSRPT0",31,0)
 D NOW^%DTC S Y=% D DD^%DT S BPNOW=Y
"RTN","BPSRPT0",32,0)
 ;
"RTN","BPSRPT0",33,0)
 ;Prompt for ECME Pharmacy Division(s) (No Default)
"RTN","BPSRPT0",34,0)
 ;Sets up BPPHARM variable and array, BPPHARM =0 ALL or BPPHARM=1,BPPHARM(ptr) for list
"RTN","BPSRPT0",35,0)
 S X=$$SELPHARM^BPSRPT3() I X="^" G EXIT
"RTN","BPSRPT0",36,0)
 ;
"RTN","BPSRPT0",37,0)
 ;Prompt to Display Summary or Detail Format (Default to Detail)
"RTN","BPSRPT0",38,0)
 ;Returns 1 for Summary, 0 for Detail
"RTN","BPSRPT0",39,0)
 S BPSUMDET=$$SELSMDET^BPSRPT3(2) I BPSUMDET="^" G EXIT
"RTN","BPSRPT0",40,0)
 ;
"RTN","BPSRPT0",41,0)
 ;Prompt to Display Single Insurance or All (Default to ALL)
"RTN","BPSRPT0",42,0)
 ;Returns Insurance Company Name (from #36) or 0 for All
"RTN","BPSRPT0",43,0)
 S BPINSINF=$$SELINSIN^BPSRPT3(0) I BPINSINF="^" G EXIT
"RTN","BPSRPT0",44,0)
 ;
"RTN","BPSRPT0",45,0)
 ;Prompt to Display (C)MOP or (M)ail or (W)indow or (A)LL (Default to ALL)
"RTN","BPSRPT0",46,0)
 ;Returns (1-ALL,2-Mail,3-Window,4-CMOP)
"RTN","BPSRPT0",47,0)
 S BPMWC=$$SELMWC^BPSRPT3(1) I BPMWC="^" G EXIT
"RTN","BPSRPT0",48,0)
 ;
"RTN","BPSRPT0",49,0)
 ;Prompt to Display (R)ealTime Fills or (B)ackbills or (A)LL (Default to ALL)
"RTN","BPSRPT0",50,0)
 ;Returns (1-ALL,2-RealTime Fills,3-Backbills)
"RTN","BPSRPT0",51,0)
 S BPRTBCK=$$SELRTBCK^BPSRPT3(1) I BPRTBCK="^" G EXIT
"RTN","BPSRPT0",52,0)
 ;
"RTN","BPSRPT0",53,0)
 ;Prompt to Display Specific (D)rug or Drug (C)lass or (A)ll (Default to ALL)
"RTN","BPSRPT0",54,0)
 ;Returns (1-ALL,2-Drug,3-Drug Class)
"RTN","BPSRPT0",55,0)
 S BPQSTDRG=$$SELDRGAL^BPSRPT3(1) I BPQSTDRG="^" Q
"RTN","BPSRPT0",56,0)
 ;
"RTN","BPSRPT0",57,0)
 ;Prompt to Select Drug (No Default)
"RTN","BPSRPT0",58,0)
 S BPDRUG=0 I BPQSTDRG=2 S BPDRUG=$$SELDRG^BPSRPT3() I BPDRUG="^" G EXIT
"RTN","BPSRPT0",59,0)
 ;
"RTN","BPSRPT0",60,0)
 ;Prompt to Select Drug Class (No Default)
"RTN","BPSRPT0",61,0)
 S BPDRGCL=0 I BPQSTDRG=3 S BPDRGCL=$$SELDRGCL^BPSRPT3() I BPDRGCL="^" G EXIT
"RTN","BPSRPT0",62,0)
 ;
"RTN","BPSRPT0",63,0)
 ;Report Specific Prompts
"RTN","BPSRPT0",64,0)
 ;
"RTN","BPSRPT0",65,0)
 ;Prompt to select Date Range
"RTN","BPSRPT0",66,0)
 ;Returns (Start Date^End Date)
"RTN","BPSRPT0",67,0)
 I (",1,2,3,4,5,6,7,")[BPRTYPE S BPBEGDT=$$SELDATE^BPSRPT3(BPRTYPE) D  I BPBEGDT="^" G EXIT
"RTN","BPSRPT0",68,0)
 .I BPBEGDT="^" Q
"RTN","BPSRPT0",69,0)
 .S BPENDDT=$P(BPBEGDT,U,2)
"RTN","BPSRPT0",70,0)
 .S BPBEGDT=$P(BPBEGDT,U)
"RTN","BPSRPT0",71,0)
 ;
"RTN","BPSRPT0",72,0)
 ;Prompt to Include (R)ELEASED or (N)OT RELEASED or (A)LL (Default to RELEASED)
"RTN","BPSRPT0",73,0)
 ;Returns (1-ALL,2-RELEASED,3-NOT RELEASED)
"RTN","BPSRPT0",74,0)
 S BPRLNRL=$S(BPRTYPE=3:3,1:1) I (",1,2,4,6,7,")[BPRTYPE S BPRLNRL=$$SELRLNRL^BPSRPT4(2) I BPRLNRL="^" G EXIT
"RTN","BPSRPT0",75,0)
 ;
"RTN","BPSRPT0",76,0)
 ;Prompt to Include (S)pecific Reject Code or (A)LL (Default to ALL)
"RTN","BPSRPT0",77,0)
 ;Returns (0-ALL,ptr-Pointer to Selected Reject Code in #9002313.93)
"RTN","BPSRPT0",78,0)
 S BPREJCD=0 I (",2,")[BPRTYPE S BPREJCD=$$SELREJCD^BPSRPT4(0) I BPREJCD="^" G EXIT
"RTN","BPSRPT0",79,0)
 ;
"RTN","BPSRPT0",80,0)
 ;Prompt to Include Auto(R)eversed or (A)LL (Default to ALL)
"RTN","BPSRPT0",81,0)
 ;Returns (0-All,1-AutoReversed)
"RTN","BPSRPT0",82,0)
 S BPAUTREV=0 I (",4,")[BPRTYPE S BPAUTREV=$$SELAUREV^BPSRPT4(0) I BPAUTREV="^" G EXIT
"RTN","BPSRPT0",83,0)
 ;
"RTN","BPSRPT0",84,0)
 ;Prompt to Include A(C)cepted or (R)ejected or (A)LL (Default to REJECTED)
"RTN","BPSRPT0",85,0)
 ;Returns (0-All,1-Rejected,2-Accepted)
"RTN","BPSRPT0",86,0)
 S BPACREJ=0 I (",4,")[BPRTYPE S BPACREJ=$$SELACREJ^BPSRPT4(1) I BPACREJ="^" G EXIT
"RTN","BPSRPT0",87,0)
 ;
"RTN","BPSRPT0",88,0)
 ;Prompt to Include (S)pecific Close Claim Reason or (A)ll (Default to All)
"RTN","BPSRPT0",89,0)
 ;Returns (0-All,ptr-Pointer to #356.8)
"RTN","BPSRPT0",90,0)
 S BPCCRSN=0 I (",7,")[BPRTYPE S BPCCRSN=$$SELCCRSN^BPSRPT4(0) I BPCCRSN="^" G EXIT
"RTN","BPSRPT0",91,0)
 ;
"RTN","BPSRPT0",92,0)
 ;Prompt for Excel Capture (Detail Only)
"RTN","BPSRPT0",93,0)
 S BPEXCEL=0 I 'BPSUMDET S BPEXCEL=$$SELEXCEL^BPSRPT4() I BPEXCEL="^" G EXIT
"RTN","BPSRPT0",94,0)
 ;
"RTN","BPSRPT0",95,0)
 ;Prompt for the Device
"RTN","BPSRPT0",96,0)
 I 'BPEXCEL D
"RTN","BPSRPT0",97,0)
 .W !!,"WARNING - THIS REPORT REQUIRES THAT A DEVICE WITH 132 COLUMN WIDTH BE USED."
"RTN","BPSRPT0",98,0)
 .W !,"IT WILL NOT DISPLAY CORRECTLY USING 80 COLUMN WIDTH DEVICES",!
"RTN","BPSRPT0",99,0)
 S BPQ=0 D DEVICE(BPRPTNAM) Q:BPQ
"RTN","BPSRPT0",100,0)
 ;
"RTN","BPSRPT0",101,0)
 ;Compile and Run the Report
"RTN","BPSRPT0",102,0)
 D RUN(BPEXCEL,BPRPTNAM,BPSUMDET)
"RTN","BPSRPT0",103,0)
 I 'BPQ D PAUSE2^BPSRPT1
"RTN","BPSRPT0",104,0)
 ;
"RTN","BPSRPT0",105,0)
EXIT Q
"RTN","BPSRPT0",106,0)
 ;
"RTN","BPSRPT0",107,0)
 ;Compile and Run the Report
"RTN","BPSRPT0",108,0)
 ;
"RTN","BPSRPT0",109,0)
RUN(BPEXCEL,BPRPTNAM,BPSUMDET) N BPPAGE,BPTMP
"RTN","BPSRPT0",110,0)
 S BPTMP=$NA(^TMP($J,"BPSRPT"))
"RTN","BPSRPT0",111,0)
 K @BPTMP
"RTN","BPSRPT0",112,0)
 S BPPAGE=0
"RTN","BPSRPT0",113,0)
 W:BPSCR&'BPEXCEL !,"Please wait...",!
"RTN","BPSRPT0",114,0)
 ;
"RTN","BPSRPT0",115,0)
 ;Compile the report
"RTN","BPSRPT0",116,0)
 Q:$$COLLECT^BPSRPT1(BPTMP)=-1
"RTN","BPSRPT0",117,0)
 U IO
"RTN","BPSRPT0",118,0)
 ;
"RTN","BPSRPT0",119,0)
 ;Display the report
"RTN","BPSRPT0",120,0)
 D REPORT^BPSRPT5(BPTMP,BPEXCEL,BPSCR,BPRPTNAM,BPSUMDET,BPPAGE)
"RTN","BPSRPT0",121,0)
 I 'BPSCR W !,@IOF
"RTN","BPSRPT0",122,0)
 K @BPTMP
"RTN","BPSRPT0",123,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","BPSRPT0",124,0)
 D ^%ZISC
"RTN","BPSRPT0",125,0)
 Q
"RTN","BPSRPT0",126,0)
 ;
"RTN","BPSRPT0",127,0)
 ;Prompt For the Device
"RTN","BPSRPT0",128,0)
 ;
"RTN","BPSRPT0",129,0)
 ; Returns Device variables and BPSCR
"RTN","BPSRPT0",130,0)
 ;
"RTN","BPSRPT0",131,0)
DEVICE(BPRPTNAM) N %ZIS,ZTSK,ZTRTN,ZTIO,ZTDESC,ZTSAVE,POP
"RTN","BPSRPT0",132,0)
 S %ZIS="QM"
"RTN","BPSRPT0",133,0)
 D ^%ZIS
"RTN","BPSRPT0",134,0)
 I POP S BPQ=1
"RTN","BPSRPT0",135,0)
 ;
"RTN","BPSRPT0",136,0)
 ;Check for exit
"RTN","BPSRPT0",137,0)
 I $G(BPQ) G XDEV
"RTN","BPSRPT0",138,0)
 ;
"RTN","BPSRPT0",139,0)
 S BPSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSRPT0",140,0)
 I $D(IO("Q")) D  S BPQ=1
"RTN","BPSRPT0",141,0)
 . S ZTRTN="RUN^BPSRPT0(BPEXCEL,BPRPTNAM,BPSUMDET)"
"RTN","BPSRPT0",142,0)
 . S ZTIO=ION
"RTN","BPSRPT0",143,0)
 . S ZTSAVE("*")=""
"RTN","BPSRPT0",144,0)
 . S ZTDESC="BPS REPORT: "_BPRPTNAM
"RTN","BPSRPT0",145,0)
 . D ^%ZTLOAD
"RTN","BPSRPT0",146,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","BPSRPT0",147,0)
 . D HOME^%ZIS
"RTN","BPSRPT0",148,0)
 U IO
"RTN","BPSRPT0",149,0)
XDEV Q
"RTN","BPSRPT1")
0^301^B49847270
"RTN","BPSRPT1",1,0)
BPSRPT1 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRPT1",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRPT1",4,0)
 Q
"RTN","BPSRPT1",5,0)
 ;
"RTN","BPSRPT1",6,0)
 ; ECME Report Compile Routine - Looping/Filtering Routine
"RTN","BPSRPT1",7,0)
 ;
"RTN","BPSRPT1",8,0)
 ;  Input Variables:
"RTN","BPSRPT1",9,0)
 ;                 BPRTYPE - Type of Report (1-7)
"RTN","BPSRPT1",10,0)
 ;               BPGLTMP - Temporary storage global
"RTN","BPSRPT1",11,0)
 ;  BPPHARM/BPPHARM(ptr) - Set to 0 for all pharmacies, if set to 1 array
"RTN","BPSRPT1",12,0)
 ;                         of internal pointers of selected pharmacies
"RTN","BPSRPT1",13,0)
 ;              BPSUMDET - (1) Summary or (0) Detail format
"RTN","BPSRPT1",14,0)
 ;              BPINSINF - Set to 0 for all insurances or insurance co name
"RTN","BPSRPT1",15,0)
 ;                 BPMWC - 1-ALL,2-Mail,3-Window,4-CMOP Prescriptions
"RTN","BPSRPT1",16,0)
 ;               BPRTBCK - 1-ALL,2-RealTime,3-Backbill Claim Submission
"RTN","BPSRPT1",17,0)
 ;               BPRLNRL - 1-ALL,2-RELEASED,3-NOT RELEASED
"RTN","BPSRPT1",18,0)
 ;                BPDRUG - DRUG to report on (ptr to #50)
"RTN","BPSRPT1",19,0)
 ;               BPDRGCL - DRUG CLASS to report on (0 for ALL)
"RTN","BPSRPT1",20,0)
 ;               BPBEGDT - Beginning Date
"RTN","BPSRPT1",21,0)
 ;               BPENDDT - Ending Date
"RTN","BPSRPT1",22,0)
 ;               BPCCRSN - Set to 0 for all closed claim reasons or ptr to #356.8
"RTN","BPSRPT1",23,0)
 ;              BPAUTREV - 0-ALL,1-Auto Reversed
"RTN","BPSRPT1",24,0)
 ;               BPACREJ - 0-ALL,1-REJECTED,2-ACCEPTED
"RTN","BPSRPT1",25,0)
 ;              
"RTN","BPSRPT1",26,0)
COLLECT(BPGLTMP) N BP02,BP57,BP59,BPENDDT1,BPLDT02,BPLDT57,X,Y,OK,BPIX
"RTN","BPSRPT1",27,0)
 ;
"RTN","BPSRPT1",28,0)
 ;Check Variables
"RTN","BPSRPT1",29,0)
 S OK=1
"RTN","BPSRPT1",30,0)
 S:'$G(BPBEGDT) BPBEGDT=0
"RTN","BPSRPT1",31,0)
 S:'$G(BPENDDT) BPENDDT=9999999
"RTN","BPSRPT1",32,0)
 S BPENDDT=BPENDDT+0.9
"RTN","BPSRPT1",33,0)
 I $G(BPRTYPE)=""!($G(BPGLTMP)="")!($G(BPPHARM)="")!($G(BPSUMDET)="")!($G(BPINSINF)="")!($G(BPMWC)="")!($G(BPRTBCK)="") S OK=-1 G EXIT
"RTN","BPSRPT1",34,0)
 ;
"RTN","BPSRPT1",35,0)
 ;Loop through BPS CLAIMS
"RTN","BPSRPT1",36,0)
 ;
"RTN","BPSRPT1",37,0)
 ;First look for fill/refill cross reference
"RTN","BPSRPT1",38,0)
 ;Loop through Date of Service Index in BPS CLAIMS file and find link to 
"RTN","BPSRPT1",39,0)
 ;claim in BPS TRANSACTION.  Process earliest Date of Service entry found in
"RTN","BPSRPT1",40,0)
 ;BPS TRANSACTION
"RTN","BPSRPT1",41,0)
 ;
"RTN","BPSRPT1",42,0)
 ;Choose Index to Loop through (different for Closed Claims)
"RTN","BPSRPT1",43,0)
 S BPIX="AF" S:BPRTYPE=7 BPIX="AG"
"RTN","BPSRPT1",44,0)
 ;
"RTN","BPSRPT1",45,0)
 S BPLDT02=$S(BPIX="AF":$$FM2YMD(BPBEGDT-0.00001),1:BPBEGDT) S:BPLDT02="" BPLDT02=0
"RTN","BPSRPT1",46,0)
 S BPENDDT1=$S(BPIX="AF":$$FM2YMD(BPENDDT),1:BPENDDT_".9999999999") S:BPENDDT1="" BPENDDT1=99999999
"RTN","BPSRPT1",47,0)
 F  S BPLDT02=+$O(^BPSC(BPIX,BPLDT02)) Q:BPLDT02=0!(BPLDT02>BPENDDT1)  D
"RTN","BPSRPT1",48,0)
 . S BP02=0 F  S BP02=$O(^BPSC(BPIX,BPLDT02,BP02)) Q:+BP02=0  D
"RTN","BPSRPT1",49,0)
 . . S BP59=+$O(^BPST("AE",BP02,0))
"RTN","BPSRPT1",50,0)
 . . Q:BP59=0
"RTN","BPSRPT1",51,0)
 . . I $D(@BPGLTMP@("FILE59",BP59)) Q
"RTN","BPSRPT1",52,0)
 . . S @BPGLTMP@("FILE59",BP59)=BPLDT02_"^02"
"RTN","BPSRPT1",53,0)
 . . D PROCESS(BP59)
"RTN","BPSRPT1",54,0)
 ;
"RTN","BPSRPT1",55,0)
 ;#9002313.59 has only one entry per claim with, which has a date 
"RTN","BPSRPT1",56,0)
 ;  of the latest update for the claim
"RTN","BPSRPT1",57,0)
 ;#9002313.57 has more than one entries per claim and keep all 
"RTN","BPSRPT1",58,0)
 ;  changes made the claim
"RTN","BPSRPT1",59,0)
 ;so we have to go thru #9002313.57 to find the earliest date 
"RTN","BPSRPT1",60,0)
 ;related to the claim to check it against BPBEGDT
"RTN","BPSRPT1",61,0)
 S BPLDT57=BPBEGDT-0.00001
"RTN","BPSRPT1",62,0)
 F  S BPLDT57=+$O(^BPSTL("AH",BPLDT57)) Q:BPLDT57=0!(BPLDT57>BPENDDT)  D
"RTN","BPSRPT1",63,0)
 . S BP57=0 F  S BP57=$O(^BPSTL("AH",BPLDT57,BP57)) Q:+BP57=0  D
"RTN","BPSRPT1",64,0)
 . . S BP59=+$G(^BPSTL(BP57,0))
"RTN","BPSRPT1",65,0)
 . . I $D(@BPGLTMP@("FILE59",BP59)) Q
"RTN","BPSRPT1",66,0)
 . . S @BPGLTMP@("FILE59",BP59)=BPLDT57_"^57"
"RTN","BPSRPT1",67,0)
 . . D PROCESS(BP59)
"RTN","BPSRPT1",68,0)
 ;
"RTN","BPSRPT1",69,0)
 ;Remove Portion of Scratch Global
"RTN","BPSRPT1",70,0)
EXIT K @BPGLTMP@("FILE59")
"RTN","BPSRPT1",71,0)
 Q OK
"RTN","BPSRPT1",72,0)
 ;
"RTN","BPSRPT1",73,0)
 ;Convert FB date to YYYYMMDD
"RTN","BPSRPT1",74,0)
FM2YMD(BPFMDT) N Y,Y1
"RTN","BPSRPT1",75,0)
 S Y=$E(BPFMDT,2,3),Y1=$E(BPFMDT,1,1) S Y=$S(Y1=3:"20"_Y,Y1=2:"19"_Y,1:"")
"RTN","BPSRPT1",76,0)
 Q:Y Y_$E(BPFMDT,4,7)
"RTN","BPSRPT1",77,0)
 Q ""
"RTN","BPSRPT1",78,0)
 ;
"RTN","BPSRPT1",79,0)
 ;Process each Entry
"RTN","BPSRPT1",80,0)
 ;
"RTN","BPSRPT1",81,0)
PROCESS(BP59) N BPBCK,BPDFN,BPREF,BPPAYBL,BPPLAN,BPREJ,BPRLSDT,BPRX,BPRXDRG,BPSTATUS
"RTN","BPSRPT1",82,0)
 ;
"RTN","BPSRPT1",83,0)
 ;Get ABSBRXI - ptr to #52
"RTN","BPSRPT1",84,0)
 S BPRX=+$P($G(^BPST(BP59,1)),U,11)
"RTN","BPSRPT1",85,0)
 ;
"RTN","BPSRPT1",86,0)
 ;Get ABSBRXR - Prescription Number IEN
"RTN","BPSRPT1",87,0)
 S BPREF=+$P($G(^BPST(BP59,1)),U)
"RTN","BPSRPT1",88,0)
 ;
"RTN","BPSRPT1",89,0)
 ;Get PATIENT - ptr to #2
"RTN","BPSRPT1",90,0)
 S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSRPT1",91,0)
 ;
"RTN","BPSRPT1",92,0)
 ;Check for correct BPS Pharmacy (DIVISION)
"RTN","BPSRPT1",93,0)
 I $G(BPPHARM)=1,$$CHKPHRM(BP59)=0 G XPROC
"RTN","BPSRPT1",94,0)
 ;
"RTN","BPSRPT1",95,0)
 ;Check for Display 1-ALL,2-RELEASED,3-NOT RELEASED
"RTN","BPSRPT1",96,0)
 S BPRLSDT=$$RELEASED(BPRX,BPREF)
"RTN","BPSRPT1",97,0)
 I BPRLNRL'=1 I ((BPRLNRL=2)&(BPRLSDT=0))!((BPRLNRL=3)&(BPRLSDT)) G XPROC
"RTN","BPSRPT1",98,0)
 ;
"RTN","BPSRPT1",99,0)
 ;Get Status
"RTN","BPSRPT1",100,0)
 S BPSTATUS=$$STATUS^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT1",101,0)
 ;
"RTN","BPSRPT1",102,0)
 ;if REVERSAL
"RTN","BPSRPT1",103,0)
 I BPRTYPE=4,BPSTATUS'["REVERSAL" G XPROC  ; exclude non-reversed
"RTN","BPSRPT1",104,0)
 ;
"RTN","BPSRPT1",105,0)
 ;if PAYABLE
"RTN","BPSRPT1",106,0)
 S BPPAYBL=BPSTATUS["PAYABLE"
"RTN","BPSRPT1",107,0)
 I BPRTYPE=1,'BPPAYBL G XPROC  ; exclude non-payable
"RTN","BPSRPT1",108,0)
 I BPRTYPE=1,BPSTATUS["REVERSAL" G XPROC  ; reversed
"RTN","BPSRPT1",109,0)
 ;
"RTN","BPSRPT1",110,0)
 ;if REJECTED
"RTN","BPSRPT1",111,0)
 S BPREJ=BPSTATUS["REJECTED"
"RTN","BPSRPT1",112,0)
 I BPRTYPE=2,BPSTATUS["REVERSAL" G XPROC ; exclude rejected reversals
"RTN","BPSRPT1",113,0)
 I BPRTYPE=2,'BPREJ G XPROC  ; exclude non-rejected
"RTN","BPSRPT1",114,0)
 I BPRTYPE=2,$$CLSCLM(BP59) G XPROC  ;exclude closed claims
"RTN","BPSRPT1",115,0)
 ;
"RTN","BPSRPT1",116,0)
 ;if SUBMITTED NOT RELEASED exclude released ones
"RTN","BPSRPT1",117,0)
 I BPRTYPE=3,BPRLSDT'=0 G XPROC
"RTN","BPSRPT1",118,0)
 I BPRTYPE=3,'BPPAYBL G XPROC  ; exclude non-payable
"RTN","BPSRPT1",119,0)
 ;
"RTN","BPSRPT1",120,0)
 ;Auto Reverse Check
"RTN","BPSRPT1",121,0)
 I BPRTYPE=4,BPAUTREV,'$$AUTOREV(BP59) G XPROC
"RTN","BPSRPT1",122,0)
 ;
"RTN","BPSRPT1",123,0)
 ;if CLOSED
"RTN","BPSRPT1",124,0)
 I BPRTYPE=7,'$$CLSCLM(BP59) G XPROC  ;exclude open claims
"RTN","BPSRPT1",125,0)
 I BPRTYPE=7,BPSTATUS'["REJECTED" G XPROC  ;exclude non-rejected closed claims
"RTN","BPSRPT1",126,0)
 ;
"RTN","BPSRPT1",127,0)
 ;if Recent Transactions, exclude closed claims
"RTN","BPSRPT1",128,0)
 I BPRTYPE=5,$$CLSCLM(BP59) G XPROC
"RTN","BPSRPT1",129,0)
 ;
"RTN","BPSRPT1",130,0)
 ;If Totals by Date, include only rejects and payables
"RTN","BPSRPT1",131,0)
 I BPRTYPE=6,BPSTATUS'["REJECTED",BPSTATUS'["PAYABLE" G XPROC  ; Reversed
"RTN","BPSRPT1",132,0)
 ;
"RTN","BPSRPT1",133,0)
 ;Realtime/Backbill Check
"RTN","BPSRPT1",134,0)
 S BPBCK=$$RTBCK(BP59)
"RTN","BPSRPT1",135,0)
 I BPRTBCK'=1 I ((BPRTBCK=2)&(BPBCK=0))!((BPRTBCK=3)&(BPBCK)) G XPROC
"RTN","BPSRPT1",136,0)
 ;
"RTN","BPSRPT1",137,0)
 ;Check for MAIL/WINDOW/CMOP/ALL
"RTN","BPSRPT1",138,0)
 I BPMWC'=1,$$MWC^BPSRPT6(BPRX,BPREF)'=BPMWC G XPROC
"RTN","BPSRPT1",139,0)
 ;
"RTN","BPSRPT1",140,0)
 ;Check for selected insurance
"RTN","BPSRPT1",141,0)
 S BPPLAN=$P($$INSNAM^BPSRPT6(BP59),U,2)
"RTN","BPSRPT1",142,0)
 I BPINSINF'=0,BPINSINF'=BPPLAN G XPROC
"RTN","BPSRPT1",143,0)
 ;
"RTN","BPSRPT1",144,0)
 ;Check for selected drug
"RTN","BPSRPT1",145,0)
 S BPRXDRG=$$GETDRUG^BPSRPT6(BPRX)
"RTN","BPSRPT1",146,0)
 I BPRXDRG=0 G XPROC
"RTN","BPSRPT1",147,0)
 I BPDRUG,BPDRUG'=BPRXDRG G XPROC
"RTN","BPSRPT1",148,0)
 ;
"RTN","BPSRPT1",149,0)
 ;Check for selected drug classes
"RTN","BPSRPT1",150,0)
 I BPDRGCL'=0,BPDRGCL'=$$DRGCLNAM^BPSRPT6($$GETDRGCL^BPSRPT6(BPRXDRG),99) G XPROC
"RTN","BPSRPT1",151,0)
 ;
"RTN","BPSRPT1",152,0)
 ;Check for selected Close Reason
"RTN","BPSRPT1",153,0)
 I BPCCRSN,BPCCRSN'=$P($$CLRSN^BPSRPT7(BP59),U) G XPROC
"RTN","BPSRPT1",154,0)
 ;
"RTN","BPSRPT1",155,0)
 ;Check for Accepted/Rejected
"RTN","BPSRPT1",156,0)
 I BPACREJ=1,BPSTATUS'["REJECTED" G XPROC
"RTN","BPSRPT1",157,0)
 I BPACREJ=2,BPSTATUS'["ACCEPTED" G XPROC
"RTN","BPSRPT1",158,0)
 ;
"RTN","BPSRPT1",159,0)
 ;Check for Specific Reject Code
"RTN","BPSRPT1",160,0)
 I BPREJCD'=0,'$$CKREJ(BP59,BPREJCD) G XPROC
"RTN","BPSRPT1",161,0)
 ;
"RTN","BPSRPT1",162,0)
 ;Save Entry for Report
"RTN","BPSRPT1",163,0)
 D SETTMP^BPSRPT2(BPGLTMP,BPDFN,BPRX,BPREF,BP59,BPBEGDT,BPENDDT,.BPPHARM,BPSUMDET,BPPLAN,BPRLSDT,BPPAYBL,BPREJ,BPRXDRG,$P(BPSTATUS,U))
"RTN","BPSRPT1",164,0)
 ;
"RTN","BPSRPT1",165,0)
XPROC Q
"RTN","BPSRPT1",166,0)
 ;
"RTN","BPSRPT1",167,0)
 ;Check if selected BPS PHARMACY
"RTN","BPSRPT1",168,0)
 ;
"RTN","BPSRPT1",169,0)
 ; Defined Variable: BPPHARM(ptr) - List of BPS Pharmacies to Report on
"RTN","BPSRPT1",170,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",171,0)
 ; 
"RTN","BPSRPT1",172,0)
 ; Returned Value -> 0 = Entry not in list of selected pharmacies
"RTN","BPSRPT1",173,0)
 ;                   1 = Entry is in list of selected pharmacies
"RTN","BPSRPT1",174,0)
CHKPHRM(BP59) N PHARM
"RTN","BPSRPT1",175,0)
 S PHARM=+$P($G(^BPST(BP59,1)),"^",7)
"RTN","BPSRPT1",176,0)
 S PHARM=$S($D(BPPHARM(PHARM)):1,1:0)
"RTN","BPSRPT1",177,0)
 Q PHARM
"RTN","BPSRPT1",178,0)
 ;
"RTN","BPSRPT1",179,0)
 ;Determine whether claim is Released or Not Released
"RTN","BPSRPT1",180,0)
 ;
"RTN","BPSRPT1",181,0)
 ; Input Variables: BPRX - ptr to PRESCRIPTION (#52)
"RTN","BPSRPT1",182,0)
 ;                 BPREF - refill # (0-No Refills,1-1st Refill, 2-2nd, ...) 
"RTN","BPSRPT1",183,0)
 ;
"RTN","BPSRPT1",184,0)
 ; Return Value ->             0 = Not Released
"RTN","BPSRPT1",185,0)
 ;                 released date = Released
"RTN","BPSRPT1",186,0)
 ;                 
"RTN","BPSRPT1",187,0)
RELEASED(BPRX,BPREF) N RDT
"RTN","BPSRPT1",188,0)
 ;
"RTN","BPSRPT1",189,0)
 I BPREF=0 S RDT=$$RXRELDT^BPSRPT6(BPRX)\1
"RTN","BPSRPT1",190,0)
 I BPREF'=0 S RDT=$$REFRELDT^BPSRPT6(BPRX,BPREF)\1
"RTN","BPSRPT1",191,0)
 Q RDT
"RTN","BPSRPT1",192,0)
 ;
"RTN","BPSRPT1",193,0)
 ;Determine if claim was Auto Reversed
"RTN","BPSRPT1",194,0)
 ;
"RTN","BPSRPT1",195,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",196,0)
 ; Return Value -> 1 = Auto Reversed
"RTN","BPSRPT1",197,0)
 ;                 0 = Not Auto Reversed
"RTN","BPSRPT1",198,0)
 ;
"RTN","BPSRPT1",199,0)
AUTOREV(BP59) N AR,BP02
"RTN","BPSRPT1",200,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT1",201,0)
 S AR=+$P($G(^BPSC(BP02,0)),U,7)
"RTN","BPSRPT1",202,0)
 Q AR
"RTN","BPSRPT1",203,0)
 ;
"RTN","BPSRPT1",204,0)
 ;Determine if claim was closed
"RTN","BPSRPT1",205,0)
 ;
"RTN","BPSRPT1",206,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",207,0)
 ; Return Value -> 1 = Closed
"RTN","BPSRPT1",208,0)
 ;                 0 = Not Closed
"RTN","BPSRPT1",209,0)
 ;                 
"RTN","BPSRPT1",210,0)
CLSCLM(BP59) N BP02,CL
"RTN","BPSRPT1",211,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT1",212,0)
 S CL=+$G(^BPSC(BP02,900))
"RTN","BPSRPT1",213,0)
 Q CL
"RTN","BPSRPT1",214,0)
 ;
"RTN","BPSRPT1",215,0)
 ;Determine whether claim is Realtime or Backbilled
"RTN","BPSRPT1",216,0)
 ;
"RTN","BPSRPT1",217,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",218,0)
 ; Return Value -> 1 = Backbilled
"RTN","BPSRPT1",219,0)
 ;                 0 = Realtime
"RTN","BPSRPT1",220,0)
RTBCK(BP59) N BB
"RTN","BPSRPT1",221,0)
 S BB=$P($G(^BPST(BP59,12)),U)
"RTN","BPSRPT1",222,0)
 S BB=$S(BB="BB":0,1:1)
"RTN","BPSRPT1",223,0)
 Q BB
"RTN","BPSRPT1",224,0)
 ;
"RTN","BPSRPT1",225,0)
 ;Screen Pause 1
"RTN","BPSRPT1",226,0)
 ;
"RTN","BPSRPT1",227,0)
 ; Return variable - BPQ = 0 Continue
"RTN","BPSRPT1",228,0)
 ;                          2 Quit
"RTN","BPSRPT1",229,0)
PAUSE N X
"RTN","BPSRPT1",230,0)
 U IO(0) W !!,"Press RETURN to continue, '^' to exit:"
"RTN","BPSRPT1",231,0)
 R X:$G(DTIME) S:'$T X="^" S:X["^" BPQ=2
"RTN","BPSRPT1",232,0)
 U IO
"RTN","BPSRPT1",233,0)
 Q
"RTN","BPSRPT1",234,0)
 ;
"RTN","BPSRPT1",235,0)
 ;Screen Pause 2
"RTN","BPSRPT1",236,0)
 ;
"RTN","BPSRPT1",237,0)
 ; Return variable - BPQ = 0 Continue
"RTN","BPSRPT1",238,0)
 ;                         2 Quit
"RTN","BPSRPT1",239,0)
PAUSE2 N X
"RTN","BPSRPT1",240,0)
 U IO(0) W !!,"Press RETURN to continue:"
"RTN","BPSRPT1",241,0)
 R X:$G(DTIME) S:'$T X="^" S:X["^" BPQ=2
"RTN","BPSRPT1",242,0)
 U IO
"RTN","BPSRPT1",243,0)
 Q
"RTN","BPSRPT1",244,0)
 ;
"RTN","BPSRPT1",245,0)
 ;Get ECME#
"RTN","BPSRPT1",246,0)
 ;
"RTN","BPSRPT1",247,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",248,0)
 ; Returned value -> Last 7 digits of ECME#
"RTN","BPSRPT1",249,0)
 ; 
"RTN","BPSRPT1",250,0)
ECMENUM(BP59) N BPY1,BPY2
"RTN","BPSRPT1",251,0)
 S BPY1=(BP59\1),BPY2=$E(BPY1,$L(BPY1)-6,99) ;last 7 digits
"RTN","BPSRPT1",252,0)
 Q BPY2
"RTN","BPSRPT1",253,0)
 ;
"RTN","BPSRPT1",254,0)
 ;Convert FM date or date.time to displayable (mm/dd/yy HH:MM) format
"RTN","BPSRPT1",255,0)
 ;
"RTN","BPSRPT1",256,0)
DATTIM(X) N DATE,BPT,BPM,BPH,BPAP
"RTN","BPSRPT1",257,0)
 S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")
"RTN","BPSRPT1",258,0)
 S BPT=$P(X,".",2) S:$L(BPT)<4 BPT=BPT_$E("0000",1,4-$L(BPT))
"RTN","BPSRPT1",259,0)
 S BPH=$E(BPT,1,2),BPM=$E(BPT,3,4)
"RTN","BPSRPT1",260,0)
 S BPAP="AM" I BPH>12 S BPH=BPH-12,BPAP="PM" S:$L(BPH)<2 BPH="0"_BPH
"RTN","BPSRPT1",261,0)
 I BPT S:'BPH BPH=12 S DATE=DATE_" "_BPH_":"_BPM_BPAP
"RTN","BPSRPT1",262,0)
 Q $G(DATE)
"RTN","BPSRPT1",263,0)
 ;
"RTN","BPSRPT1",264,0)
 ;Display M-Mail,W-Window,C-CMOP or " "
"RTN","BPSRPT1",265,0)
 ;
"RTN","BPSRPT1",266,0)
MWCNAM(BPINDEX) Q $S(BPINDEX=2:"M",BPINDEX=3:"W",BPINDEX=4:"C",1:" ")
"RTN","BPSRPT1",267,0)
 ;
"RTN","BPSRPT1",268,0)
 ;Display RT-Realtime,BB-Backbill, or " "
"RTN","BPSRPT1",269,0)
 ;
"RTN","BPSRPT1",270,0)
RTBCKNAM(BPINDEX) Q $S(BPINDEX=1:"RT",BPINDEX=0:"BB",1:" ")
"RTN","BPSRPT1",271,0)
 ;
"RTN","BPSRPT1",272,0)
 ;See for Specific Reject Code
"RTN","BPSRPT1",273,0)
 ;
"RTN","BPSRPT1",274,0)
CKREJ(BP59,BPREJCD) N FREJ,I,REJ,X
"RTN","BPSRPT1",275,0)
 S FREJ=0
"RTN","BPSRPT1",276,0)
 S X=$$REJTEXT^BPSRPT2(BP59,.REJ)
"RTN","BPSRPT1",277,0)
 S X="" F  S X=$O(REJ(X)) Q:X=""  D  Q:FREJ=1
"RTN","BPSRPT1",278,0)
 .S REJ=$P($G(REJ(X)),":") Q:REJ=""
"RTN","BPSRPT1",279,0)
 .S I="" F  S I=$O(^BPSF(9002313.93,"B",REJ,I)) Q:I=""  I I=BPREJCD S FREJ=1
"RTN","BPSRPT1",280,0)
 Q FREJ
"RTN","BPSRPT2")
0^302^B34444824
"RTN","BPSRPT2",1,0)
BPSRPT2 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRPT2",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRPT2",4,0)
 ;
"RTN","BPSRPT2",5,0)
 Q
"RTN","BPSRPT2",6,0)
 ;
"RTN","BPSRPT2",7,0)
 ;Save One Report Entry
"RTN","BPSRPT2",8,0)
 ;
"RTN","BPSRPT2",9,0)
 ; Input variables -> See BPSRPT0 for description
"RTN","BPSRPT2",10,0)
 ; BPTMPGL,BPDFN,BPRX,BPREF,BP59,BPENDDT,BPPHARM,BPSUMDET,BPGRPLAN,BPRLDT,BPPAYBL,BPREJFL,BPRXDRG
"RTN","BPSRPT2",11,0)
 ; 
"RTN","BPSRPT2",12,0)
SETTMP(BPTMPGL,BPDFN,BPRX,BPREF,BP59,BPBEGDT,BPENDDT,BPPHARM,BPSUMDET,BPGRPLAN,BPRLDT,BPPAYBL,BPREJFL,BPRXDRG,BPSTATUS) ;
"RTN","BPSRPT2",13,0)
 N BPCLSDT,BPDATA,BPDIV,BPFILDT,BPISSDT,BPLBLDT,BPSMSG,BPSREJ,BPREST,BPSRWR,BPTDTTM,BPTRDT
"RTN","BPSRPT2",14,0)
 ;
"RTN","BPSRPT2",15,0)
 ;Check for bad data
"RTN","BPSRPT2",16,0)
 I BPREF,$$IFREFILL^BPSRPT6(BPRX,BPREF)=0 G EXIT
"RTN","BPSRPT2",17,0)
 ;
"RTN","BPSRPT2",18,0)
 ;Retrieve Close Date
"RTN","BPSRPT2",19,0)
 S BPCLSDT=$P($$CLOSEDT(BP59),".")
"RTN","BPSRPT2",20,0)
 ;
"RTN","BPSRPT2",21,0)
 ;If NO refills 
"RTN","BPSRPT2",22,0)
 I BPREF=0 D
"RTN","BPSRPT2",23,0)
 . S BPLBLDT=$$RXLBLDT^BPSRPT6(BPRX,1)
"RTN","BPSRPT2",24,0)
 . S BPFILDT=$$RXFILDT^BPSRPT6(BPRX)
"RTN","BPSRPT2",25,0)
 . S BPISSDT=$$RXISSDT^BPSRPT6(BPRX)
"RTN","BPSRPT2",26,0)
 ;
"RTN","BPSRPT2",27,0)
 ;If Refills
"RTN","BPSRPT2",28,0)
 I BPREF>0 D
"RTN","BPSRPT2",29,0)
 . S BPLBLDT=$$REFLBLDT^BPSRPT6(BPRX,1)
"RTN","BPSRPT2",30,0)
 . S BPFILDT=$$REFFILDT^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT2",31,0)
 . S BPISSDT=$$REFISSDT^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT2",32,0)
 ;
"RTN","BPSRPT2",33,0)
 ;Get Transaction Date/Transaction Date and Time
"RTN","BPSRPT2",34,0)
 S BPTRDT=$$TRANDT(BP59,0)
"RTN","BPSRPT2",35,0)
 S BPTDTTM=$$TRANDT(BP59,1)
"RTN","BPSRPT2",36,0)
 ;
"RTN","BPSRPT2",37,0)
 ;Get Result, Message, Reject Information, and BPS Pharmacy
"RTN","BPSRPT2",38,0)
 S BPREST=$$RESULT(BP59,.BPSRWR)
"RTN","BPSRPT2",39,0)
 S BPSMSG=$$MSG(BPSRWR,.BPSMSG,BP59)
"RTN","BPSRPT2",40,0)
 S BPSREJ=$S(BPREJFL=0:"",1:$$REJECT(BPREST,.BPSREJ,BP59))
"RTN","BPSRPT2",41,0)
 S BPDIV=+$P($G(^BPST(BP59,1)),"^",7)
"RTN","BPSRPT2",42,0)
 ;
"RTN","BPSRPT2",43,0)
 ;Set up data node
"RTN","BPSRPT2",44,0)
 S BPDATA=BPRLDT_U_BPTRDT_U_BP59_U_BPRX_U_BPREF_U_BPREST_U_BPSTATUS_U_BPFILDT_U_BPISSDT_U_BPLBLDT_U_U_BPPAYBL_U_BPREJFL_U_BPRXDRG_U_BPSRWR
"RTN","BPSRPT2",45,0)
 ;
"RTN","BPSRPT2",46,0)
 ;For Totals by Date - No Insurance Sort
"RTN","BPSRPT2",47,0)
 I BPRTYPE=6 S BPGRPLAN="~"
"RTN","BPSRPT2",48,0)
 ;
"RTN","BPSRPT2",49,0)
 ;Sort by transaction date
"RTN","BPSRPT2",50,0)
 I BPRTYPE'=7 D:$$CHKDT(+$G(BPTRDT),BPBEGDT,BPENDDT)
"RTN","BPSRPT2",51,0)
 . ;
"RTN","BPSRPT2",52,0)
 . ;For Recent Transactions tack on Txn date and Time to Ins
"RTN","BPSRPT2",53,0)
 . I BPRTYPE=5 S BPGRPLAN=-BPTDTTM_"^"_BPGRPLAN
"RTN","BPSRPT2",54,0)
 . S @BPTMPGL@(BPDIV,BPGRPLAN,BPDFN,BPTRDT,BPRX,BPREF)=BPDATA
"RTN","BPSRPT2",55,0)
 ;
"RTN","BPSRPT2",56,0)
 ;Sort by close date
"RTN","BPSRPT2",57,0)
 I BPRTYPE=7 D:$$CHKDT(+$G(BPCLSDT),BPBEGDT,BPENDDT)
"RTN","BPSRPT2",58,0)
 . S @BPTMPGL@(BPDIV,BPGRPLAN,BPDFN,BPCLSDT,BPRX,BPREF)=BPDATA
"RTN","BPSRPT2",59,0)
 ;
"RTN","BPSRPT2",60,0)
EXIT Q
"RTN","BPSRPT2",61,0)
 ;
"RTN","BPSRPT2",62,0)
 ;Get Transaction date and Time
"RTN","BPSRPT2",63,0)
 ;
"RTN","BPSRPT2",64,0)
 ; Input Variables -> BP59 - ptr to BPS TRANSACTION
"RTN","BPSRPT2",65,0)
 ;                    TIME - 1 - Return DT.TM, 0 - DT
"RTN","BPSRPT2",66,0)
 ; Returned Value -> Transaction or Transaction Date.Time
"RTN","BPSRPT2",67,0)
 ; 
"RTN","BPSRPT2",68,0)
TRANDT(BP59,TIME) N X
"RTN","BPSRPT2",69,0)
 S X=$P($G(^BPST(BP59,0)),U,8)
"RTN","BPSRPT2",70,0)
 Q $S(TIME=0:X\1,1:X)
"RTN","BPSRPT2",71,0)
 ;
"RTN","BPSRPT2",72,0)
 ;Determine the Claim Close Date
"RTN","BPSRPT2",73,0)
 ;
"RTN","BPSRPT2",74,0)
 ; Input Variable -> BP59 = ptr to BPS TRANSACTIONS
"RTN","BPSRPT2",75,0)
 ; Returned Value -> CL = Claim Close Date and Time
"RTN","BPSRPT2",76,0)
 ; 
"RTN","BPSRPT2",77,0)
CLOSEDT(BP59) N CL,BP02
"RTN","BPSRPT2",78,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT2",79,0)
 S CL=+$P($G(^BPSC(BP02,900)),U,2)
"RTN","BPSRPT2",80,0)
 Q CL
"RTN","BPSRPT2",81,0)
 ;
"RTN","BPSRPT2",82,0)
 ;Get Result
"RTN","BPSRPT2",83,0)
 ;
"RTN","BPSRPT2",84,0)
RESULT(BP59,RWR) N X
"RTN","BPSRPT2",85,0)
 I BP59 S RWR=$$CATEG^BPSOSUC(BP59)
"RTN","BPSRPT2",86,0)
 E  S RWR=""
"RTN","BPSRPT2",87,0)
 I RWR?1"E ".E D
"RTN","BPSRPT2",88,0)
 . S X=RWR
"RTN","BPSRPT2",89,0)
 . I X="E PAYABLE" S X=4
"RTN","BPSRPT2",90,0)
 . E  I X="E CAPTURED" S X=3
"RTN","BPSRPT2",91,0)
 . E  I X="E DUPLICATE" S X=2
"RTN","BPSRPT2",92,0)
 . E  I X="E REJECTED" S X=1
"RTN","BPSRPT2",93,0)
 . E  I X="E REVERSAL ACCEPTED" S X=11
"RTN","BPSRPT2",94,0)
 . E  I X="E REVERSAL REJECTED" S X=12
"RTN","BPSRPT2",95,0)
 . E  S X=0
"RTN","BPSRPT2",96,0)
 E  I RWR="PAPER" S X=9
"RTN","BPSRPT2",97,0)
 E  I RWR="PAPER REVERSAL" S X=19
"RTN","BPSRPT2",98,0)
 E  S X=15
"RTN","BPSRPT2",99,0)
 Q X
"RTN","BPSRPT2",100,0)
 ;
"RTN","BPSRPT2",101,0)
 ;Message
"RTN","BPSRPT2",102,0)
 ;
"RTN","BPSRPT2",103,0)
MSG(RWR,MSGTEXT,BP59) N BPRET
"RTN","BPSRPT2",104,0)
 S BPRET=0
"RTN","BPSRPT2",105,0)
 ; If the claim has any message text, store it
"RTN","BPSRPT2",106,0)
 I RWR?1"E ".E D
"RTN","BPSRPT2",107,0)
 . S X=$$MESSAG59(BP59,1)
"RTN","BPSRPT2",108,0)
 . I X]"" S MSGTEXT(1)=X
"RTN","BPSRPT2",109,0)
 . S X=$$MESSAG59(BP59,2)
"RTN","BPSRPT2",110,0)
 . I X]"" S MSGTEXT(2)=X
"RTN","BPSRPT2",111,0)
 . I $D(MSGTEXT) S MSGTEXT="MSGTEXT"
"RTN","BPSRPT2",112,0)
 . S BPRET=1
"RTN","BPSRPT2",113,0)
 Q BPRET
"RTN","BPSRPT2",114,0)
 ;
"RTN","BPSRPT2",115,0)
 ;Reject Text
"RTN","BPSRPT2",116,0)
 ;
"RTN","BPSRPT2",117,0)
 ; Output Variable -> BPSRTEXT,BPRET
"RTN","BPSRPT2",118,0)
 ; 
"RTN","BPSRPT2",119,0)
REJECT(RWR,BPSRTEXT,BP59) N BPRET,BPSRESP,BPSECME,BPSPOS
"RTN","BPSRPT2",120,0)
 S BPRET=0
"RTN","BPSRPT2",121,0)
 ; If it's a rejected claim, build the rejection text
"RTN","BPSRPT2",122,0)
 I RWR="E REJECTED"!(RWR="E REVERSAL REJECTED") D
"RTN","BPSRPT2",123,0)
 . D RESP59(BP59,.BPSRESP,.BPSECME) ; set BPSRESP,BPSECME pointers
"RTN","BPSRPT2",124,0)
 . D REJTEXT^BPSOS03(BPSRESP,BPSPOS,.BPSRTEXT)
"RTN","BPSRPT2",125,0)
 . ; word processing text goes into FDA(FILE,IENS,FIELD,n)=text
"RTN","BPSRPT2",126,0)
 . S BPSRTEXT=$S($D(BPSRTEXT):"REJTEXT",1:"")
"RTN","BPSRPT2",127,0)
 . S:$D(BPSRTEXT) BPRET=1
"RTN","BPSRPT2",128,0)
 Q BPRET
"RTN","BPSRPT2",129,0)
 ;
"RTN","BPSRPT2",130,0)
 ;Messages 
"RTN","BPSRPT2",131,0)
 ;
"RTN","BPSRPT2",132,0)
MESSAG59(BP59,N) N MSG,BPSRESP,BPSPOS
"RTN","BPSRPT2",133,0)
 I 'BP59 S MSG="" G XMSG59
"RTN","BPSRPT2",134,0)
 D RESP59(59,.BPSRESP,.BPSPOS) I 'BPSRESP!'BPSPOS S MSG="" G XMSG59
"RTN","BPSRPT2",135,0)
 I '$D(N) S N=0
"RTN","BPSRPT2",136,0)
 I N=1 S MSG=$$MESSAGE^BPSOS03(BPSRESP,BPSPOS,1) I 1
"RTN","BPSRPT2",137,0)
 I N=2 S MSG=$$MESSAGE^BPSOS03(BPSRESP,BPSPOS,2) I 1
"RTN","BPSRPT2",138,0)
 E  S MSG=$$MESSAGE^BPSOS03(BPSRESP,BPSPOS)
"RTN","BPSRPT2",139,0)
XMSG59 Q MSG
"RTN","BPSRPT2",140,0)
 ;
"RTN","BPSRPT2",141,0)
 ;Responds
"RTN","BPSRPT2",142,0)
RESP59(BP59,BPSRESP,BPSPOS) ;EP - caller should N BPSRESP,BPSPOS
"RTN","BPSRPT2",143,0)
 ;Input: BP59
"RTN","BPSRPT2",144,0)
 ;Output:
"RTN","BPSRPT2",145,0)
 ; BPSRESP,BPSPOS by reference
"RTN","BPSRPT2",146,0)
 I $G(^BPST(BP59,4)) D  ; reversal
"RTN","BPSRPT2",147,0)
 . S BPSRESP=$P($G(^BPST(BP59,4)),U,2)
"RTN","BPSRPT2",148,0)
 . S BPSPOS=1
"RTN","BPSRPT2",149,0)
 E  D
"RTN","BPSRPT2",150,0)
 . S BPSRESP=$P($G(^BPST(BP59,0)),U,5)
"RTN","BPSRPT2",151,0)
 . S BPSPOS=$P($G(^BPST(BP59,0)),U,9)
"RTN","BPSRPT2",152,0)
 Q
"RTN","BPSRPT2",153,0)
 ;
"RTN","BPSRPT2",154,0)
 ;Check and compare dates
"RTN","BPSRPT2",155,0)
CHKDT(BPTSTDT,BPBEGDT,BPENDDT) ;
"RTN","BPSRPT2",156,0)
 I BPTSTDT=0 Q 0
"RTN","BPSRPT2",157,0)
 I BPTSTDT'<BPBEGDT,BPTSTDT'>BPENDDT Q 1
"RTN","BPSRPT2",158,0)
 Q 0
"RTN","BPSRPT2",159,0)
 ;
"RTN","BPSRPT2",160,0)
 ;Populate passed in Array
"RTN","BPSRPT2",161,0)
 ;
"RTN","BPSRPT2",162,0)
REJTEXT(BP59,ARR) N BBX,BPSRESP,BPSPOS,A,I,X,R
"RTN","BPSRPT2",163,0)
 S BBX=$G(^BPST(BP59,0))
"RTN","BPSRPT2",164,0)
 S BPSRESP=$P(BBX,U,5)
"RTN","BPSRPT2",165,0)
 S BPSPOS=$P(BBX,U,9)
"RTN","BPSRPT2",166,0)
 S (A,I)=0
"RTN","BPSRPT2",167,0)
 I BPSRESP&BPSPOS D
"RTN","BPSRPT2",168,0)
 . K ARR
"RTN","BPSRPT2",169,0)
 . F  S A=$O(^BPSR(BPSRESP,1000,BPSPOS,511,A)) Q:'A  D
"RTN","BPSRPT2",170,0)
 . . S R=$P(^BPSR(BPSRESP,1000,BPSPOS,511,A,0),U)
"RTN","BPSRPT2",171,0)
 . . Q:R=""
"RTN","BPSRPT2",172,0)
 . . N S S S=$O(^BPSF(9002313.93,"B",R,0))
"RTN","BPSRPT2",173,0)
 . . I S S X=$TR($G(^BPSF(9002313.93,S,0)),U,":")
"RTN","BPSRPT2",174,0)
 . . E  S X=R_" unrecognized reject code"
"RTN","BPSRPT2",175,0)
 . . S I=I+1,ARR(I)=X
"RTN","BPSRPT2",176,0)
 . . K S
"RTN","BPSRPT2",177,0)
 Q I
"RTN","BPSRPT2",178,0)
 ;
"RTN","BPSRPT2",179,0)
 ;Get Claim ID
"RTN","BPSRPT2",180,0)
CLAIMID(BP59) N BP02
"RTN","BPSRPT2",181,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT2",182,0)
 Q $P($G(^BPSC(BP02,0)),U)
"RTN","BPSRPT2",183,0)
 ;
"RTN","BPSRPT2",184,0)
RXSTANAM(BPRXSTAT) ;
"RTN","BPSRPT2",185,0)
 Q:BPRXSTAT=0 "ACT"  ; ACTIVE; 
"RTN","BPSRPT2",186,0)
 Q:BPRXSTAT=1 "NVER"  ; NON-VERIFIED; 
"RTN","BPSRPT2",187,0)
 Q:BPRXSTAT=3 "HLD"  ; HOLD; 
"RTN","BPSRPT2",188,0)
 Q:BPRXSTAT=5 "SUS"  ; SUSPENDED; 
"RTN","BPSRPT2",189,0)
 Q:BPRXSTAT=11 "EXP"  ; EXPIRED; 
"RTN","BPSRPT2",190,0)
 Q:BPRXSTAT=12 "DIS"  ; DISCONTINUED; 
"RTN","BPSRPT2",191,0)
 Q:BPRXSTAT=13 "DEL"  ; DELETED; 
"RTN","BPSRPT2",192,0)
 Q:BPRXSTAT=14 "DIS"  ; DISCONTINUED BY PROVIDER; 
"RTN","BPSRPT2",193,0)
 Q:BPRXSTAT=15 "DIS"  ; DISCONTINUED (EDIT); 
"RTN","BPSRPT2",194,0)
 Q:BPRXSTAT=16 "HLD"  ; PROVIDER HOLD; 
"RTN","BPSRPT2",195,0)
 Q:BPRXSTAT=-1 "???"
"RTN","BPSRPT2",196,0)
 Q ""
"RTN","BPSRPT2",197,0)
 ;
"RTN","BPSRPT2",198,0)
 ;Get the Cardholder ID
"RTN","BPSRPT2",199,0)
CRDHLDID(BP59) N BP02
"RTN","BPSRPT2",200,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT2",201,0)
 Q $P($G(^BPSC(BP02,300)),U,2)
"RTN","BPSRPT2",202,0)
 ;
"RTN","BPSRPT2",203,0)
GRPID(BP59) ;sent by IB in RX^IBNCPDP
"RTN","BPSRPT2",204,0)
 N BP02
"RTN","BPSRPT2",205,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT2",206,0)
 Q $P($G(^BPSC(BP02,300)),U)
"RTN","BPSRPT3")
0^303^B37369482
"RTN","BPSRPT3",1,0)
BPSRPT3 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRPT3",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRPT3",4,0)
 ;
"RTN","BPSRPT3",5,0)
 Q
"RTN","BPSRPT3",6,0)
 ;
"RTN","BPSRPT3",7,0)
 ; Select the ECME Pharmacy or Pharmacies
"RTN","BPSRPT3",8,0)
 ; 
"RTN","BPSRPT3",9,0)
 ; Input Variable -> none
"RTN","BPSRPT3",10,0)
 ; Return Value ->   "" = Valid Entry or Entries Selected
"RTN","BPSRPT3",11,0)
 ;                                        ^ = Exit
"RTN","BPSRPT3",12,0)
 ;                                       
"RTN","BPSRPT3",13,0)
 ; Output Variable -> BPPHARM = 1 One or More Pharmacies Selected
"RTN","BPSRPT3",14,0)
 ;                          = 0 User Entered 'ALL'
"RTN","BPSRPT3",15,0)
 ;                            
"RTN","BPSRPT3",16,0)
 ; If BPPHARM = 1 then the BPPHARM array will be defined where:
"RTN","BPSRPT3",17,0)
 ;    BPPHARM(ptr) = ptr ^ BPS PHARMACY NAME and
"RTN","BPSRPT3",18,0)
 ;    ptr = Internal Pointer to BPS PHARMACIES file (#9002313.56)
"RTN","BPSRPT3",19,0)
 ;                    
"RTN","BPSRPT3",20,0)
SELPHARM() N DIC,DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",21,0)
 ;
"RTN","BPSRPT3",22,0)
 ;Reset BPPHARM array
"RTN","BPSRPT3",23,0)
 K BPPHARM
"RTN","BPSRPT3",24,0)
 ;
"RTN","BPSRPT3",25,0)
 ;First see if they want to enter individual divisions or ALL
"RTN","BPSRPT3",26,0)
 S DIR(0)="S^D:DIVISION;A:ALL"
"RTN","BPSRPT3",27,0)
 S DIR("A")="Select Certain Pharmacy (D)ivisions or (A)LL"
"RTN","BPSRPT3",28,0)
 S DIR("L",1)="Select one of the following:"
"RTN","BPSRPT3",29,0)
 S DIR("L",2)=""
"RTN","BPSRPT3",30,0)
 S DIR("L",3)="     D         DIVISION"
"RTN","BPSRPT3",31,0)
 S DIR("L",4)="     A         ALL"
"RTN","BPSRPT3",32,0)
 D ^DIR K DIR
"RTN","BPSRPT3",33,0)
 ;
"RTN","BPSRPT3",34,0)
 ;Check for "^" or timeout, otherwise define BPPHARM
"RTN","BPSRPT3",35,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",36,0)
 E  S BPPHARM=$S(Y="A":0,1:1)
"RTN","BPSRPT3",37,0)
 ;
"RTN","BPSRPT3",38,0)
 ;If division selected, ask prompt
"RTN","BPSRPT3",39,0)
 I $G(BPPHARM)=1 F  D  Q:Y="^"!(Y="") 
"RTN","BPSRPT3",40,0)
 .;
"RTN","BPSRPT3",41,0)
 .;Prompt for entry
"RTN","BPSRPT3",42,0)
 .K X S DIC(0)="QEAM",DIC=9002313.56,DIC("A")="Select ECME Pharmacy Division(s): "
"RTN","BPSRPT3",43,0)
 .W ! D ^DIC
"RTN","BPSRPT3",44,0)
 .;
"RTN","BPSRPT3",45,0)
 .;Check for "^" or timeout 
"RTN","BPSRPT3",46,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1) K BPPHARM S Y="^" Q
"RTN","BPSRPT3",47,0)
 .;
"RTN","BPSRPT3",48,0)
 .;Check for blank entry, quit if no previous selections
"RTN","BPSRPT3",49,0)
 .I $G(X)="" S Y=$S($D(BPPHARM)>9:"",1:"^") K:Y="^" BPPHARM Q
"RTN","BPSRPT3",50,0)
 .;
"RTN","BPSRPT3",51,0)
 .;Handle Deletes
"RTN","BPSRPT3",52,0)
 .I $D(BPPHARM(+Y)) D  Q:Y="^"  I 1
"RTN","BPSRPT3",53,0)
 ..N P
"RTN","BPSRPT3",54,0)
 ..S P=Y  ;Save Original Value
"RTN","BPSRPT3",55,0)
 ..S DIR(0)="S^Y:YES;N:NO",DIR("A")="Delete "_$P(P,U,2)_" from your list?"
"RTN","BPSRPT3",56,0)
 ..S DIR("B")="NO" D ^DIR
"RTN","BPSRPT3",57,0)
 ..I ($G(DUOUT)=1)!($G(DTOUT)=1) K BPPHARM S Y="^" Q
"RTN","BPSRPT3",58,0)
 ..I Y="Y" K BPPHARM(+P),BPPHARM("B",$P(P,U,2),+P)
"RTN","BPSRPT3",59,0)
 ..S Y=P  ;Restore Original Value
"RTN","BPSRPT3",60,0)
 ..K P
"RTN","BPSRPT3",61,0)
 .E  D
"RTN","BPSRPT3",62,0)
 ..;Define new entries in BPPHARM array
"RTN","BPSRPT3",63,0)
 ..S BPPHARM(+Y)=Y
"RTN","BPSRPT3",64,0)
 ..S BPPHARM("B",$P(Y,U,2),+Y)=""
"RTN","BPSRPT3",65,0)
 .;
"RTN","BPSRPT3",66,0)
 .;Display a list of selected divisions
"RTN","BPSRPT3",67,0)
 .I $D(BPPHARM)>9 D
"RTN","BPSRPT3",68,0)
 ..N X
"RTN","BPSRPT3",69,0)
 ..W !,?2,"Selected:"
"RTN","BPSRPT3",70,0)
 ..S X="" F  S X=$O(BPPHARM("B",X)) Q:X=""  W !,?10,X
"RTN","BPSRPT3",71,0)
 ..K X
"RTN","BPSRPT3",72,0)
 .Q
"RTN","BPSRPT3",73,0)
 ;
"RTN","BPSRPT3",74,0)
 K BPPHARM("B")
"RTN","BPSRPT3",75,0)
 Q Y
"RTN","BPSRPT3",76,0)
 ;
"RTN","BPSRPT3",77,0)
 ; Display (S)ummary or (D)etail Format
"RTN","BPSRPT3",78,0)
 ; 
"RTN","BPSRPT3",79,0)
 ; Input Variable -> DFLT = 1 Summary
"RTN","BPSRPT3",80,0)
 ;                          2 Detail
"RTN","BPSRPT3",81,0)
 ;                          
"RTN","BPSRPT3",82,0)
 ; Return Value ->   1 = Summary
"RTN","BPSRPT3",83,0)
 ;                   0 = Detail
"RTN","BPSRPT3",84,0)
 ;                   ^ = Exit
"RTN","BPSRPT3",85,0)
 ;
"RTN","BPSRPT3",86,0)
SELSMDET(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",87,0)
 S DFLT=$S($G(DFLT)=1:"Summary",$G(DFLT)=0:"Detail",1:"Detail")
"RTN","BPSRPT3",88,0)
 S DIR(0)="S^S:Summary;D:Detail",DIR("A")="Display (S)ummary or (D)etail Format",DIR("B")=DFLT
"RTN","BPSRPT3",89,0)
 D ^DIR
"RTN","BPSRPT3",90,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",91,0)
 S Y=$S(Y="S":1,Y="D":0,1:Y)
"RTN","BPSRPT3",92,0)
 Q Y
"RTN","BPSRPT3",93,0)
 ;
"RTN","BPSRPT3",94,0)
 ; Select to Display Single (I)nsurance Company or (A)ll
"RTN","BPSRPT3",95,0)
 ;
"RTN","BPSRPT3",96,0)
 ; Input Variable -> DFLT = 1 Single Insurance
"RTN","BPSRPT3",97,0)
 ;                          0 All Insurance
"RTN","BPSRPT3",98,0)
 ;                          
"RTN","BPSRPT3",99,0)
 ; Return Value ->   ptr to #36^Insurance Company Name
"RTN","BPSRPT3",100,0)
 ;                     0 = All Insurances
"RTN","BPSRPT3",101,0)
 ;                     ^ = Exit
"RTN","BPSRPT3",102,0)
 ;
"RTN","BPSRPT3",103,0)
SELINSIN(DFLT) N DIC,DIR,DIRUT,DUOUT,INS,X,Y
"RTN","BPSRPT3",104,0)
 ;
"RTN","BPSRPT3",105,0)
 S DFLT=$S($G(DFLT)=1:"Single Insurance",1:"ALL")
"RTN","BPSRPT3",106,0)
 S DIR(0)="S^I:Single Insurance;A:ALL"
"RTN","BPSRPT3",107,0)
 S DIR("A")="Display Single (I)nsurance Company or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT3",108,0)
 D ^DIR
"RTN","BPSRPT3",109,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",110,0)
 S INS=$S(Y="I":1,Y="A":0,1:Y)
"RTN","BPSRPT3",111,0)
 ;
"RTN","BPSRPT3",112,0)
 ;Check for "^" or timeout, otherwise define INS
"RTN","BPSRPT3",113,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S (INS,Y)="^"
"RTN","BPSRPT3",114,0)
 ;
"RTN","BPSRPT3",115,0)
 ;If single insurance selected, ask prompt
"RTN","BPSRPT3",116,0)
 I $G(INS)=1 D
"RTN","BPSRPT3",117,0)
 .;
"RTN","BPSRPT3",118,0)
 .;Prompt for entry
"RTN","BPSRPT3",119,0)
 .W ! S Y=$$SELINS^BPSRPT6()
"RTN","BPSRPT3",120,0)
 .;
"RTN","BPSRPT3",121,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",122,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S (INS,Y)="^" Q
"RTN","BPSRPT3",123,0)
 .;
"RTN","BPSRPT3",124,0)
 .;If valid entry, setup INS
"RTN","BPSRPT3",125,0)
 .I Y'="^" S INS=Y
"RTN","BPSRPT3",126,0)
 ;
"RTN","BPSRPT3",127,0)
 Q INS
"RTN","BPSRPT3",128,0)
 ;
"RTN","BPSRPT3",129,0)
 ; Display (C)MOP or (M)ail or (W)indow or (A)ll
"RTN","BPSRPT3",130,0)
 ; 
"RTN","BPSRPT3",131,0)
 ;    Input Variable -> DFLT = 4 CMOP
"RTN","BPSRPT3",132,0)
 ;                             3 Window
"RTN","BPSRPT3",133,0)
 ;                             2 Mail
"RTN","BPSRPT3",134,0)
 ;                             1 All
"RTN","BPSRPT3",135,0)
 ;                          
"RTN","BPSRPT3",136,0)
 ;    Return Value ->   4 = CMOP
"RTN","BPSRPT3",137,0)
 ;                      3 = Window
"RTN","BPSRPT3",138,0)
 ;                      2 = Mail
"RTN","BPSRPT3",139,0)
 ;                      1 = All
"RTN","BPSRPT3",140,0)
 ;                      ^ = Exit
"RTN","BPSRPT3",141,0)
 ; 
"RTN","BPSRPT3",142,0)
SELMWC(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",143,0)
 S DFLT=$S($G(DFLT)="4":"CMOP",$G(DFLT)="3":"Window",$G(DFLT)="2":"Mail",1:"ALL")
"RTN","BPSRPT3",144,0)
 S DIR(0)="S^C:CMOP;M:Mail;W:Window;A:ALL"
"RTN","BPSRPT3",145,0)
 S DIR("A")="Display (C)MOP or (M)ail or (W)indow or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT3",146,0)
 D ^DIR
"RTN","BPSRPT3",147,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",148,0)
 S Y=$S(Y="A":1,Y="M":2,Y="W":3,Y="C":4,1:Y)
"RTN","BPSRPT3",149,0)
 Q Y
"RTN","BPSRPT3",150,0)
 ;
"RTN","BPSRPT3",151,0)
 ; Display (R)ealTime Fills or (B)ackbills or (A)LL
"RTN","BPSRPT3",152,0)
 ;
"RTN","BPSRPT3",153,0)
 ;    Input Variable -> DFLT = 3 Backbill
"RTN","BPSRPT3",154,0)
 ;                             2 Real Time Fills
"RTN","BPSRPT3",155,0)
 ;                             1 ALL
"RTN","BPSRPT3",156,0)
 ;                          
"RTN","BPSRPT3",157,0)
 ;    Return Value ->   3 = Backbill (manually)
"RTN","BPSRPT3",158,0)
 ;                      2 = Real Time Fills (automatically during FINISH)
"RTN","BPSRPT3",159,0)
 ;                      1 = ALL
"RTN","BPSRPT3",160,0)
 ;                      ^ = Exit
"RTN","BPSRPT3",161,0)
 ;
"RTN","BPSRPT3",162,0)
SELRTBCK(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",163,0)
 S DFLT=$S($G(DFLT)=2:"Real Time",$G(DFLT)=3:"Backbill",1:"ALL")
"RTN","BPSRPT3",164,0)
 S DIR(0)="S^R:Real Time Fills;B:Backbill;A:ALL"
"RTN","BPSRPT3",165,0)
 S DIR("A")="Display (R)ealTime Fills or (B)ackbills or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT3",166,0)
 D ^DIR
"RTN","BPSRPT3",167,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",168,0)
 S Y=$S(Y="A":1,Y="R":2,Y="B":3,1:Y)
"RTN","BPSRPT3",169,0)
 Q Y
"RTN","BPSRPT3",170,0)
 ;
"RTN","BPSRPT3",171,0)
 ; Display Specific (D)rug or Drug (C)lass
"RTN","BPSRPT3",172,0)
 ; 
"RTN","BPSRPT3",173,0)
 ;    Input Variable -> DFLT = 3 Drug Class
"RTN","BPSRPT3",174,0)
 ;                             2 Drug
"RTN","BPSRPT3",175,0)
 ;                             1 ALL
"RTN","BPSRPT3",176,0)
 ;                          
"RTN","BPSRPT3",177,0)
 ;     Return Value ->   3 = Drug Class
"RTN","BPSRPT3",178,0)
 ;                       2 = Drug
"RTN","BPSRPT3",179,0)
 ;                       1 = ALL
"RTN","BPSRPT3",180,0)
 ;                       ^ = Exit
"RTN","BPSRPT3",181,0)
 ;                       
"RTN","BPSRPT3",182,0)
SELDRGAL(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",183,0)
 S DFLT=$S($G(DFLT)=2:"Drug",$G(DFLT)=3:"Drug Class",1:"ALL")
"RTN","BPSRPT3",184,0)
 S DIR(0)="S^D:Drug;C:Drug Class;A:ALL"
"RTN","BPSRPT3",185,0)
 S DIR("A")="Display Specific (D)rug or Drug (C)lass or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT3",186,0)
 D ^DIR
"RTN","BPSRPT3",187,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",188,0)
 S Y=$S(Y="A":1,Y="D":2,Y="C":3,1:Y)
"RTN","BPSRPT3",189,0)
 Q Y
"RTN","BPSRPT3",190,0)
 ;
"RTN","BPSRPT3",191,0)
 ; Select Drug
"RTN","BPSRPT3",192,0)
 ; 
"RTN","BPSRPT3",193,0)
 ; Input Variable -> none
"RTN","BPSRPT3",194,0)
 ; 
"RTN","BPSRPT3",195,0)
 ; Return Value -> ptr = pointer to DRUG file (#50)
"RTN","BPSRPT3",196,0)
 ;                   ^ = Exit
"RTN","BPSRPT3",197,0)
 ;                   
"RTN","BPSRPT3",198,0)
SELDRG() N DIC,DIRUT,DUOUT,X,Y
"RTN","BPSRPT3",199,0)
 ;
"RTN","BPSRPT3",200,0)
 ;Prompt for entry
"RTN","BPSRPT3",201,0)
 W ! D SELDRG^BPSRPT6
"RTN","BPSRPT3",202,0)
 ;
"RTN","BPSRPT3",203,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",204,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S Y="^"
"RTN","BPSRPT3",205,0)
 ;
"RTN","BPSRPT3",206,0)
 ;Check for Valid Entry
"RTN","BPSRPT3",207,0)
 I +Y>0 S Y=+Y
"RTN","BPSRPT3",208,0)
 ;
"RTN","BPSRPT3",209,0)
 Q Y
"RTN","BPSRPT3",210,0)
 ;
"RTN","BPSRPT3",211,0)
 ; Select Drug Class
"RTN","BPSRPT3",212,0)
 ; 
"RTN","BPSRPT3",213,0)
 ; Input Variable -> none
"RTN","BPSRPT3",214,0)
 ; 
"RTN","BPSRPT3",215,0)
 ; Return Value -> ptr = pointer to VA DRUG CLASS file (#50.605)
"RTN","BPSRPT3",216,0)
 ;                   ^ = Exit
"RTN","BPSRPT3",217,0)
 ;
"RTN","BPSRPT3",218,0)
SELDRGCL() N DIC,DIRUT,DUOUT,Y
"RTN","BPSRPT3",219,0)
 ;
"RTN","BPSRPT3",220,0)
 ;Prompt for entry
"RTN","BPSRPT3",221,0)
 W ! D SELDRGC^BPSRPT6
"RTN","BPSRPT3",222,0)
 ;
"RTN","BPSRPT3",223,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",224,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="") S Y="^"
"RTN","BPSRPT3",225,0)
 ;
"RTN","BPSRPT3",226,0)
 Q Y
"RTN","BPSRPT3",227,0)
 ;
"RTN","BPSRPT3",228,0)
 ; Enter Date Range
"RTN","BPSRPT3",229,0)
 ;
"RTN","BPSRPT3",230,0)
 ; Input Variable -> TYPE = 7 CLOSE REPORT
"RTN","BPSRPT3",231,0)
 ;                          1-6 OTHER REPORTS
"RTN","BPSRPT3",232,0)
 ;
"RTN","BPSRPT3",233,0)
 ; Return Value -> P1^P2
"RTN","BPSRPT3",234,0)
 ; 
"RTN","BPSRPT3",235,0)
 ;           where P1 = From Date
"RTN","BPSRPT3",236,0)
 ;                    = ^ Exit
"RTN","BPSRPT3",237,0)
 ;                 P2 = To Date
"RTN","BPSRPT3",238,0)
 ;                    = blank for Exit
"RTN","BPSRPT3",239,0)
 ;                 
"RTN","BPSRPT3",240,0)
SELDATE(TYPE) N BPSIBDT,DIR,DIRUT,DTOUT,DUOUT,VAL,X,Y
"RTN","BPSRPT3",241,0)
 S TYPE=$S($G(TYPE)=7:"CLOSE",1:"TRANSACTION")
"RTN","BPSRPT3",242,0)
SELDATE1 S VAL="",DIR(0)="DA^:DT:EX",DIR("A")="START WITH "_TYPE_" DATE: ",DIR("B")="T-1"
"RTN","BPSRPT3",243,0)
 W ! D ^DIR
"RTN","BPSRPT3",244,0)
 ;
"RTN","BPSRPT3",245,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",246,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^"
"RTN","BPSRPT3",247,0)
 ;
"RTN","BPSRPT3",248,0)
 I VAL="" D
"RTN","BPSRPT3",249,0)
 .S $P(VAL,U)=Y
"RTN","BPSRPT3",250,0)
 .S DIR(0)="DA^"_VAL_":DT:EX",DIR("A")="  GO TO "_TYPE_" DATE: ",DIR("B")="T"
"RTN","BPSRPT3",251,0)
 .D ^DIR
"RTN","BPSRPT3",252,0)
 .;
"RTN","BPSRPT3",253,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",254,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^" Q
"RTN","BPSRPT3",255,0)
 .;
"RTN","BPSRPT3",256,0)
 .;Define Entry
"RTN","BPSRPT3",257,0)
 .S $P(VAL,U,2)=Y
"RTN","BPSRPT3",258,0)
 ;
"RTN","BPSRPT3",259,0)
 Q VAL
"RTN","BPSRPT4")
0^309^B64877725
"RTN","BPSRPT4",1,0)
BPSRPT4 ;BHAM ISC/BEE - ECME REPORTS (CONT) ;14-FEB-05
"RTN","BPSRPT4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRPT4",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRPT4",4,0)
 ;
"RTN","BPSRPT4",5,0)
 Q
"RTN","BPSRPT4",6,0)
 ;
"RTN","BPSRPT4",7,0)
 ; Include Rxs - (R)ELEASED or (N)OT RELEASED or (A)LL
"RTN","BPSRPT4",8,0)
 ;
"RTN","BPSRPT4",9,0)
 ;    Input Variable -> DFLT = 3 NOT RELEASED
"RTN","BPSRPT4",10,0)
 ;                             2 RELEASED
"RTN","BPSRPT4",11,0)
 ;                             1 ALL
"RTN","BPSRPT4",12,0)
 ;                          
"RTN","BPSRPT4",13,0)
 ;    Return Value ->   3 = NOT RELEASED
"RTN","BPSRPT4",14,0)
 ;                      2 = RELEASED
"RTN","BPSRPT4",15,0)
 ;                      1 = ALL
"RTN","BPSRPT4",16,0)
 ;                      ^ = Exit
"RTN","BPSRPT4",17,0)
 ;
"RTN","BPSRPT4",18,0)
SELRLNRL(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT4",19,0)
 S DFLT=$S($G(DFLT)=1:"ALL",$G(DFLT)=3:"NOT RELEASED",1:"RELEASED")
"RTN","BPSRPT4",20,0)
 S DIR(0)="S^R:RELEASED;N:NOT RELEASED;A:ALL"
"RTN","BPSRPT4",21,0)
 S DIR("A")="Include Rxs - (R)ELEASED or (N)OT RELEASED or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",22,0)
 D ^DIR
"RTN","BPSRPT4",23,0)
 ;
"RTN","BPSRPT4",24,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",25,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S Y="^"
"RTN","BPSRPT4",26,0)
 ;
"RTN","BPSRPT4",27,0)
 S Y=$S(Y="A":1,Y="R":2,Y="N":3,1:Y)
"RTN","BPSRPT4",28,0)
 ;
"RTN","BPSRPT4",29,0)
 Q Y
"RTN","BPSRPT4",30,0)
 ;
"RTN","BPSRPT4",31,0)
 ; Select to Include (S)pecific Reject Code or (A)ll
"RTN","BPSRPT4",32,0)
 ;
"RTN","BPSRPT4",33,0)
 ; Input Variable -> DFLT = 1 Specific Reject Code
"RTN","BPSRPT4",34,0)
 ;                          0 All Reject Codes
"RTN","BPSRPT4",35,0)
 ;                          
"RTN","BPSRPT4",36,0)
 ; Return Value ->   ptr = pointer to BPS NCPDP REJECT CODES (#9002313.93)
"RTN","BPSRPT4",37,0)
 ;                     0 = All Reject Codes
"RTN","BPSRPT4",38,0)
 ;                     ^ = Exit
"RTN","BPSRPT4",39,0)
 ;
"RTN","BPSRPT4",40,0)
SELREJCD(DFLT) N DIC,DIR,DIRUT,DUOUT,REJ,X,Y
"RTN","BPSRPT4",41,0)
 ;
"RTN","BPSRPT4",42,0)
 S DFLT=$S($G(DFLT)=1:"Specific Reject Code",1:"ALL")
"RTN","BPSRPT4",43,0)
 S DIR(0)="S^S:Specific Reject Code;A:ALL"
"RTN","BPSRPT4",44,0)
 S DIR("A")="Include (S)pecific Reject Code or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",45,0)
 D ^DIR
"RTN","BPSRPT4",46,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT4",47,0)
 S REJ=$S(Y="S":1,Y="A":0,1:Y)
"RTN","BPSRPT4",48,0)
 ;
"RTN","BPSRPT4",49,0)
 ;Check for "^" or timeout
"RTN","BPSRPT4",50,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S (REJ,Y)="^"
"RTN","BPSRPT4",51,0)
 ;
"RTN","BPSRPT4",52,0)
 ;If Specific Reject Code selected, ask prompt
"RTN","BPSRPT4",53,0)
 I $G(REJ)=1 D
"RTN","BPSRPT4",54,0)
 .;
"RTN","BPSRPT4",55,0)
 .;Prompt for entry
"RTN","BPSRPT4",56,0)
 .K X S DIC(0)="QEAM",DIC=9002313.93,DIC("A")="Select Reject Code: "
"RTN","BPSRPT4",57,0)
 .W ! D ^DIC
"RTN","BPSRPT4",58,0)
 .;
"RTN","BPSRPT4",59,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",60,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S (REJ,Y)="^" Q
"RTN","BPSRPT4",61,0)
 .;
"RTN","BPSRPT4",62,0)
 .;If valid entry, setup REJ
"RTN","BPSRPT4",63,0)
 .I +Y>0 S REJ=+Y
"RTN","BPSRPT4",64,0)
 ;
"RTN","BPSRPT4",65,0)
 Q REJ
"RTN","BPSRPT4",66,0)
 ;
"RTN","BPSRPT4",67,0)
 ; Include Auto(R)eversed or (A)LL
"RTN","BPSRPT4",68,0)
 ; 
"RTN","BPSRPT4",69,0)
 ;    Input Variable -> DFLT = 1 AutoReversed
"RTN","BPSRPT4",70,0)
 ;                             0 ALL
"RTN","BPSRPT4",71,0)
 ;                          
"RTN","BPSRPT4",72,0)
 ;    Return Value ->   1 = AutoReversed
"RTN","BPSRPT4",73,0)
 ;                      0 = ALL
"RTN","BPSRPT4",74,0)
 ;                      ^ = Exit
"RTN","BPSRPT4",75,0)
 ;
"RTN","BPSRPT4",76,0)
SELAUREV(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT4",77,0)
 ;
"RTN","BPSRPT4",78,0)
 S DFLT=$S($G(DFLT)=1:"AutoReversed",1:"ALL")
"RTN","BPSRPT4",79,0)
 S DIR(0)="S^R:AutoReversed;A:ALL"
"RTN","BPSRPT4",80,0)
 S DIR("A")="Include Auto(R)eversed or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",81,0)
 D ^DIR
"RTN","BPSRPT4",82,0)
 ;
"RTN","BPSRPT4",83,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",84,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S Y="^"
"RTN","BPSRPT4",85,0)
 ;
"RTN","BPSRPT4",86,0)
 S Y=$S(Y="A":0,Y="R":1,1:Y)
"RTN","BPSRPT4",87,0)
 ;
"RTN","BPSRPT4",88,0)
 Q Y
"RTN","BPSRPT4",89,0)
 ;
"RTN","BPSRPT4",90,0)
 ; Include A(C)cepted or (R)ejected or (A)LL
"RTN","BPSRPT4",91,0)
 ; 
"RTN","BPSRPT4",92,0)
 ;    Input Variable -> DFLT = 2 Accepted
"RTN","BPSRPT4",93,0)
 ;                             1 Rejected
"RTN","BPSRPT4",94,0)
 ;                             0 ALL
"RTN","BPSRPT4",95,0)
 ;                          
"RTN","BPSRPT4",96,0)
 ;    Return Value ->   2 = Accepted
"RTN","BPSRPT4",97,0)
 ;                      1 = Rejected
"RTN","BPSRPT4",98,0)
 ;                      0 = ALL
"RTN","BPSRPT4",99,0)
 ;                      ^ = Exit
"RTN","BPSRPT4",100,0)
 ;
"RTN","BPSRPT4",101,0)
SELACREJ(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT4",102,0)
 ;
"RTN","BPSRPT4",103,0)
 S DFLT=$S($G(DFLT)=2:"Accepted",$G(DFLT)=1:"Rejected",1:"ALL")
"RTN","BPSRPT4",104,0)
 S DIR(0)="S^C:Accepted;R:Rejected;A:ALL"
"RTN","BPSRPT4",105,0)
 S DIR("A")="Include A(C)cepted or (R)ejected or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",106,0)
 D ^DIR
"RTN","BPSRPT4",107,0)
 ;
"RTN","BPSRPT4",108,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",109,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S Y="^"
"RTN","BPSRPT4",110,0)
 ;
"RTN","BPSRPT4",111,0)
 S Y=$S(Y="C":2,Y="R":1,Y="A":0,1:Y)
"RTN","BPSRPT4",112,0)
 ;
"RTN","BPSRPT4",113,0)
 Q Y
"RTN","BPSRPT4",114,0)
 ;
"RTN","BPSRPT4",115,0)
 ; Select to Include (S)pecific Close Claim Reason or (A)ll
"RTN","BPSRPT4",116,0)
 ;
"RTN","BPSRPT4",117,0)
 ; Input Variable -> DFLT = 1 Specific CLAIMS TRACKING NON-BILLABLE REASONS
"RTN","BPSRPT4",118,0)
 ;                          0 All Reasons
"RTN","BPSRPT4",119,0)
 ;                          
"RTN","BPSRPT4",120,0)
 ; Return Value ->   ptr = pointer to CLAIMS TRACKING NON-BILLABLE REASONS (#356.8)
"RTN","BPSRPT4",121,0)
 ;                     0 = All Reasons
"RTN","BPSRPT4",122,0)
 ;                     ^ = Exit
"RTN","BPSRPT4",123,0)
 ;
"RTN","BPSRPT4",124,0)
SELCCRSN(DFLT) N DIC,DIR,DIRUT,DUOUT,RSN,X,Y
"RTN","BPSRPT4",125,0)
 ;
"RTN","BPSRPT4",126,0)
 S DFLT=$S($G(DFLT)=1:"Specific Close Claim Reason",1:"ALL")
"RTN","BPSRPT4",127,0)
 S DIR(0)="S^S:Specific Close Claim Reason;A:ALL"
"RTN","BPSRPT4",128,0)
 S DIR("A")="Include (S)pecific Close Claim Reason or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",129,0)
 D ^DIR
"RTN","BPSRPT4",130,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT4",131,0)
 S RSN=$S(Y="S":1,Y="A":0,1:Y)
"RTN","BPSRPT4",132,0)
 ;
"RTN","BPSRPT4",133,0)
 ;Check for "^" or timeout
"RTN","BPSRPT4",134,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S (RSN,Y)="^"
"RTN","BPSRPT4",135,0)
 ;
"RTN","BPSRPT4",136,0)
 ;If Specific Reject Code selected, ask prompt
"RTN","BPSRPT4",137,0)
 I $G(RSN)=1 D
"RTN","BPSRPT4",138,0)
 .;
"RTN","BPSRPT4",139,0)
 .;Prompt for entry
"RTN","BPSRPT4",140,0)
 .K X S DIC(0)="QEAM",DIC=356.8,DIC("A")="Select Close Claim Reason: "
"RTN","BPSRPT4",141,0)
 .W ! D ^DIC
"RTN","BPSRPT4",142,0)
 .;
"RTN","BPSRPT4",143,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",144,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S (RSN,Y)="^" Q
"RTN","BPSRPT4",145,0)
 .;
"RTN","BPSRPT4",146,0)
 .;If valid entry, setup RSN
"RTN","BPSRPT4",147,0)
 .I +Y>0 S RSN=+Y
"RTN","BPSRPT4",148,0)
 ;
"RTN","BPSRPT4",149,0)
 Q RSN
"RTN","BPSRPT4",150,0)
 ;
"RTN","BPSRPT4",151,0)
 ;Pull Selected BPS Pharmacies for Display
"RTN","BPSRPT4",152,0)
 ;
"RTN","BPSRPT4",153,0)
 ;  Input Variables: 
"RTN","BPSRPT4",154,0)
 ;  BPPHARM/BPPHARM(ptr) - Set to 0 for all pharmacies, if set to 1 array of internal
"RTN","BPSRPT4",155,0)
 ;                         pointers of selected pharmacies       
"RTN","BPSRPT4",156,0)
 ;                       - BPLEN = The length of the display field
"RTN","BPSRPT4",157,0)
 ;  Returned value -> List of selected BPS Pharmacies (possibly cut short)                 
"RTN","BPSRPT4",158,0)
 ; 
"RTN","BPSRPT4",159,0)
GETDIVS(BPLEN,BPPHARM) N BPDIV,BPSTR,BPQUIT
"RTN","BPSRPT4",160,0)
 I $G(BPPHARM)=0 S BPSTR="ALL"
"RTN","BPSRPT4",161,0)
 E  D
"RTN","BPSRPT4",162,0)
 .S BPDIV="",BPQUIT=0,BPSTR=""
"RTN","BPSRPT4",163,0)
 .F  S BPDIV=$O(BPPHARM(BPDIV)) Q:+BPDIV=0  D  Q:BPQUIT=1
"RTN","BPSRPT4",164,0)
 .. I $L(BPSTR_$$DIVNAME^BPSSCRDS(BPDIV))>(BPLEN-4) D  S BPQUIT=1 Q
"RTN","BPSRPT4",165,0)
 ... S BPSTR=$$LJ^BPSSCR02(BPSTR_",...",BPLEN)
"RTN","BPSRPT4",166,0)
 .. S BPSTR=BPSTR_$S(BPSTR]"":", ",1:"")_$$DIVNAME^BPSSCRDS(BPDIV)
"RTN","BPSRPT4",167,0)
 Q BPSTR
"RTN","BPSRPT4",168,0)
 ;
"RTN","BPSRPT4",169,0)
 ;Get the Reject Code
"RTN","BPSRPT4",170,0)
 ;
"RTN","BPSRPT4",171,0)
 ; Input variable -> 0 for All Reject Codes or
"RTN","BPSRPT4",172,0)
 ;                   lookup to BPS NCPDP REJECT CODES (#9002313.93)
"RTN","BPSRPT4",173,0)
 ; Returned value -> ALL or the selected Reject Code
"RTN","BPSRPT4",174,0)
 ; 
"RTN","BPSRPT4",175,0)
GETREJ(REJ) ;
"RTN","BPSRPT4",176,0)
 I REJ="0" S REJ="ALL"
"RTN","BPSRPT4",177,0)
 E  S REJ=$P($G(^BPSF(9002313.93,+REJ,0)),U,2)
"RTN","BPSRPT4",178,0)
 Q REJ
"RTN","BPSRPT4",179,0)
 ;
"RTN","BPSRPT4",180,0)
 ;Print Header 2 Line 1
"RTN","BPSRPT4",181,0)
 ;
"RTN","BPSRPT4",182,0)
 ; Input variable: BPRTYPE -> Report Type (1-7)
"RTN","BPSRPT4",183,0)
 ;
"RTN","BPSRPT4",184,0)
HEADLN1(BPRTYPE) ;
"RTN","BPSRPT4",185,0)
 I (",1,2,3,4,5,7,")[BPRTYPE W !,"PATIENT NAME",?27,"Pt.ID",?35,"RX#",?47,"REF/ECME#"
"RTN","BPSRPT4",186,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT4",187,0)
 . W ?68,"DATE"
"RTN","BPSRPT4",188,0)
 . W ?78,$J("$BILLED",10)
"RTN","BPSRPT4",189,0)
 . W ?97,$J("$INS RESPONSE",13)
"RTN","BPSRPT4",190,0)
 . W ?122,$J("$COLLECT",10)
"RTN","BPSRPT4",191,0)
 ;
"RTN","BPSRPT4",192,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT4",193,0)
 . W ?68,"DATE"
"RTN","BPSRPT4",194,0)
 . W ?78,"RELEASED ON"
"RTN","BPSRPT4",195,0)
 . W ?91,"RX INFO"
"RTN","BPSRPT4",196,0)
 ;
"RTN","BPSRPT4",197,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT4",198,0)
 . W ?68,"DATE"
"RTN","BPSRPT4",199,0)
 . W ?100,$J("$BILLED",10)
"RTN","BPSRPT4",200,0)
 . W ?119,$J("$INS RESPONSE",13)
"RTN","BPSRPT4",201,0)
 ;
"RTN","BPSRPT4",202,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT4",203,0)
 . W ?60,"COMPLETED"
"RTN","BPSRPT4",204,0)
 . W ?78,"TRANS TYPE"
"RTN","BPSRPT4",205,0)
 . W ?95,"PAYER RESPONSE"
"RTN","BPSRPT4",206,0)
 ;
"RTN","BPSRPT4",207,0)
 I BPRTYPE=6 D  Q
"RTN","BPSRPT4",208,0)
 . W !,?33,$J("AMOUNT",17)
"RTN","BPSRPT4",209,0)
 . W ?51,$J("RETURNED",17)
"RTN","BPSRPT4",210,0)
 . W ?69,$J("RETURNED",17)
"RTN","BPSRPT4",211,0)
 . W ?87,$J("AMOUNT",17)
"RTN","BPSRPT4",212,0)
 ;
"RTN","BPSRPT4",213,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT4",214,0)
 . W ?65,"RX INFO"
"RTN","BPSRPT4",215,0)
 . W ?87,"DRUG"
"RTN","BPSRPT4",216,0)
 Q
"RTN","BPSRPT4",217,0)
 ;
"RTN","BPSRPT4",218,0)
 ;Print Header 2 Line 2
"RTN","BPSRPT4",219,0)
 ;
"RTN","BPSRPT4",220,0)
 ; Input variable: BPRTYPE -> Report Type (1-7)
"RTN","BPSRPT4",221,0)
 ; 
"RTN","BPSRPT4",222,0)
HEADLN2(BPRTYPE) ;
"RTN","BPSRPT4",223,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT4",224,0)
 . W !,?4,"DRUG"
"RTN","BPSRPT4",225,0)
 . W ?47,"RELEASED ON"
"RTN","BPSRPT4",226,0)
 . W ?68,"RX INFO"
"RTN","BPSRPT4",227,0)
 . I BPRTYPE=1 W ?122,$J("BILL#",10)
"RTN","BPSRPT4",228,0)
 ;
"RTN","BPSRPT4",229,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT4",230,0)
 . W !,?3,"CARDHOLD.ID"
"RTN","BPSRPT4",231,0)
 . W ?31,"GROUP ID"
"RTN","BPSRPT4",232,0)
 . W ?41,$J("$BILLED",10)
"RTN","BPSRPT4",233,0)
 . W ?54,"QTY"
"RTN","BPSRPT4",234,0)
 . W ?61,"NDC#"
"RTN","BPSRPT4",235,0)
 . W ?82,"DRUG"
"RTN","BPSRPT4",236,0)
 ;
"RTN","BPSRPT4",237,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT4",238,0)
 . W !,?4,"DRUG"
"RTN","BPSRPT4",239,0)
 . W ?54,"RX INFO"
"RTN","BPSRPT4",240,0)
 ;
"RTN","BPSRPT4",241,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT4",242,0)
 . W !,?4,"DRUG"
"RTN","BPSRPT4",243,0)
 . W ?38,"RX INFO"
"RTN","BPSRPT4",244,0)
 . W ?60,"INSURANCE"
"RTN","BPSRPT4",245,0)
 . W ?112,"ELAP TIME IN SECONDS"
"RTN","BPSRPT4",246,0)
 ;
"RTN","BPSRPT4",247,0)
 I BPRTYPE=6 D  Q
"RTN","BPSRPT4",248,0)
 .W !,?1,"DATE"
"RTN","BPSRPT4",249,0)
 .W ?15,$J("#CLAIMS",17)
"RTN","BPSRPT4",250,0)
 .W ?33,$J("SUBMITTED",17)
"RTN","BPSRPT4",251,0)
 .W ?51,$J("REJECTED",17)
"RTN","BPSRPT4",252,0)
 .W ?69,$J("PAYABLE",17)
"RTN","BPSRPT4",253,0)
 .W ?87,$J("TO RECEIVE",17)
"RTN","BPSRPT4",254,0)
 .W ?115,$J("DIFFERENCE",17)
"RTN","BPSRPT4",255,0)
 ;
"RTN","BPSRPT4",256,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT4",257,0)
 . W !,?3,"CARDHOLD.ID"
"RTN","BPSRPT4",258,0)
 . W ?31,"GROUP ID"
"RTN","BPSRPT4",259,0)
 . W ?41,"CLOSE DATE/TIME"
"RTN","BPSRPT4",260,0)
 . W ?59,"CLOSED BY"
"RTN","BPSRPT4",261,0)
 . W ?87,"CLOSE REASON"
"RTN","BPSRPT4",262,0)
 Q
"RTN","BPSRPT4",263,0)
 ;
"RTN","BPSRPT4",264,0)
 ;Print Header 2 Line 3
"RTN","BPSRPT4",265,0)
 ;
"RTN","BPSRPT4",266,0)
 ; Input variable: BPRTYPE -> Report Type (1-7)
"RTN","BPSRPT4",267,0)
 ; 
"RTN","BPSRPT4",268,0)
HEADLN3(BPTYP) ;
"RTN","BPSRPT4",269,0)
 D:BPTYP=4
"RTN","BPSRPT4",270,0)
 . W !,?6,"REVERSAL METHOD/RETURN STATUS/REASON"
"RTN","BPSRPT4",271,0)
 Q
"RTN","BPSRPT4",272,0)
 ;
"RTN","BPSRPT4",273,0)
SELEXCEL() ; - Returns whether to capture data for Excel report.
"RTN","BPSRPT4",274,0)
 ; Output: EXCEL = 1 - YES (capture data) / 0 - NO (DO NOT capture data)
"RTN","BPSRPT4",275,0)
 ;
"RTN","BPSRPT4",276,0)
 N EXCEL,DIR,DIRUT,DTOUT,DUOUT,DIROUT
"RTN","BPSRPT4",277,0)
 ;
"RTN","BPSRPT4",278,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("T")=DTIME W !
"RTN","BPSRPT4",279,0)
 S DIR("A")="Do you want to capture report data for an Excel document"
"RTN","BPSRPT4",280,0)
 S DIR("?")="^D HEXC^BPSRPT4"
"RTN","BPSRPT4",281,0)
 D ^DIR K DIR I $D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q "^"
"RTN","BPSRPT4",282,0)
 K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","BPSRPT4",283,0)
 S EXCEL=0 I Y S EXCEL=1
"RTN","BPSRPT4",284,0)
 ;
"RTN","BPSRPT4",285,0)
 ;Display Excel display message
"RTN","BPSRPT4",286,0)
 I EXCEL=1 D EXMSG
"RTN","BPSRPT4",287,0)
 ;
"RTN","BPSRPT4",288,0)
 Q EXCEL
"RTN","BPSRPT4",289,0)
 ;
"RTN","BPSRPT4",290,0)
HEXC ; - 'Do you want to capture data...' prompt
"RTN","BPSRPT4",291,0)
 W !!,"      Enter:  'Y'    -  To capture detail report data to transfer"
"RTN","BPSRPT4",292,0)
 W !,"                        to an Excel document"
"RTN","BPSRPT4",293,0)
 W !,"              '<CR>' -  To skip this option"
"RTN","BPSRPT4",294,0)
 W !,"              '^'    -  To quit this option"
"RTN","BPSRPT4",295,0)
 Q
"RTN","BPSRPT4",296,0)
 ;
"RTN","BPSRPT4",297,0)
 ;Display the message about capturing to an Excel file format
"RTN","BPSRPT4",298,0)
 ; 
"RTN","BPSRPT4",299,0)
EXMSG ;
"RTN","BPSRPT4",300,0)
 W !!?5,"Before continuing, please set up your terminal to capture the"
"RTN","BPSRPT4",301,0)
 W !?5,"detail report data. On some terminals, this can  be  done  by"
"RTN","BPSRPT4",302,0)
 W !?5,"clicking  on the 'Tools' menu above, then click  on  'Capture"
"RTN","BPSRPT4",303,0)
 W !?5,"Incoming  Data' to save to  Desktop. This  report  may take a"
"RTN","BPSRPT4",304,0)
 W !?5,"while to run."
"RTN","BPSRPT4",305,0)
 W !!?5,"Note: To avoid  undesired  wrapping of the data  saved to the"
"RTN","BPSRPT4",306,0)
 W !?5,"      file, please enter '0;256;999' at the 'DEVICE:' prompt.",!
"RTN","BPSRPT4",307,0)
 Q
"RTN","BPSRPT5")
0^310^B76227568
"RTN","BPSRPT5",1,0)
BPSRPT5 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRPT5",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRPT5",4,0)
 ;
"RTN","BPSRPT5",5,0)
 Q
"RTN","BPSRPT5",6,0)
 ;
"RTN","BPSRPT5",7,0)
 ;Routine to Display the Reports
"RTN","BPSRPT5",8,0)
 ;
"RTN","BPSRPT5",9,0)
 ;Print Report Line 1
"RTN","BPSRPT5",10,0)
 ;
"RTN","BPSRPT5",11,0)
 ; Input Variables -> BPRTYPE,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS
"RTN","BPSRPT5",12,0)
 ;                    BPCOLL,BPEXCEL
"RTN","BPSRPT5",13,0)
 ; 
"RTN","BPSRPT5",14,0)
WRLINE1(BPRTYPE,BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL,BPEXCEL) ;
"RTN","BPSRPT5",15,0)
 ;
"RTN","BPSRPT5",16,0)
 ;Excel Output
"RTN","BPSRPT5",17,0)
 I $G(BPEXCEL) D WRLINE1^BPSRPT8(BPRTYPE,.BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL) Q
"RTN","BPSRPT5",18,0)
 ;
"RTN","BPSRPT5",19,0)
 ;Report Output
"RTN","BPSRPT5",20,0)
 W !,$$PATNAME^BPSRPT6(BPDFN)  ;Patient Name
"RTN","BPSRPT5",21,0)
 W ?27,"("_$$SSN4^BPSRPT6(BPDFN)_")"  ;L4SSN
"RTN","BPSRPT5",22,0)
 W ?35,$$RXNUM^BPSRPT6(BPRX)_$$COPAY^BPSRPT6(BPRX)  ;RX Number
"RTN","BPSRPT5",23,0)
 W ?47,BPREF,"/",$$ECMENUM^BPSRPT1($P(BPX,U,3)) ;Refill/ECME Number
"RTN","BPSRPT5",24,0)
 ;
"RTN","BPSRPT5",25,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT5",26,0)
 . W ?68,$$DATTIM^BPSRPT1(BPSRTDT)  ;Date
"RTN","BPSRPT5",27,0)
 . W ?78,$J(BPBIL,10,2),?100,$J(BPINS,10,2),?122,$S(BPCOLL]"":$J(BPCOLL,10,2),1:"")
"RTN","BPSRPT5",28,0)
 ;
"RTN","BPSRPT5",29,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT5",30,0)
 . W ?68,$$DATTIM^BPSRPT1(BPSRTDT)  ;Date
"RTN","BPSRPT5",31,0)
 . W ?78,$$DATTIM^BPSRPT1(+BPX)
"RTN","BPSRPT5",32,0)
 . W ?91,$$MWCNAM^BPSRPT1($$MWC^BPSRPT6(BPRX,BPREF))
"RTN","BPSRPT5",33,0)
 . W ?94,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",34,0)
 . W ?98,$$RXSTANAM^BPSRPT2($$RXSTATUS^BPSRPT6(BPRX,0))
"RTN","BPSRPT5",35,0)
 . W ?101,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",36,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT5",37,0)
 . W ?68,$$DATTIM^BPSRPT1(BPSRTDT)  ;Date
"RTN","BPSRPT5",38,0)
 . W ?100,$J(BPBIL,10,2),?122,$J(BPINS,10,2)
"RTN","BPSRPT5",39,0)
 ;
"RTN","BPSRPT5",40,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT5",41,0)
 . W ?60,$$DATTIM^BPSRPT1($$TRANDT^BPSRPT2($P(BPX,U,3),1))
"RTN","BPSRPT5",42,0)
 . W ?78,$$TTYPE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))
"RTN","BPSRPT5",43,0)
 . W ?95,$$RESPONSE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))
"RTN","BPSRPT5",44,0)
 ;
"RTN","BPSRPT5",45,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT5",46,0)
 . W ?65,$$MWCNAM^BPSRPT1($$MWC^BPSRPT6(BPRX,BPREF))
"RTN","BPSRPT5",47,0)
 . W ?68,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",48,0)
 . W ?72,$$RXSTANAM^BPSRPT2($$RXSTATUS^BPSRPT6(BPRX,0))
"RTN","BPSRPT5",49,0)
 . W ?75,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",50,0)
 . W ?79,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",51,0)
 . W ?87,$$DRGNAM^BPSRPT6($P(BPX,U,14),32)
"RTN","BPSRPT5",52,0)
 Q
"RTN","BPSRPT5",53,0)
 ;
"RTN","BPSRPT5",54,0)
 ;Print Report Line 2
"RTN","BPSRPT5",55,0)
 ;
"RTN","BPSRPT5",56,0)
 ; Input Variables -> BPRTYPE,BPX,BPRX,BPREF,BPBIL,BPGRPLAN,BPEXCEL
"RTN","BPSRPT5",57,0)
 ; 
"RTN","BPSRPT5",58,0)
WRLINE2(BPRTYPE,BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN,BPEXCEL) ;
"RTN","BPSRPT5",59,0)
 ;
"RTN","BPSRPT5",60,0)
 ;Excel Output
"RTN","BPSRPT5",61,0)
 I $G(BPEXCEL) D WRLINE2^BPSRPT8(BPRTYPE,.BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN) Q
"RTN","BPSRPT5",62,0)
 ;
"RTN","BPSRPT5",63,0)
 ;Report Output
"RTN","BPSRPT5",64,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT5",65,0)
 . W !,?4,$$DRGNAM^BPSRPT6($P(BPX,U,14),32),?47,$$DATTIM^BPSRPT1(+BPX)
"RTN","BPSRPT5",66,0)
 . W ?68,$$MWCNAM^BPSRPT1($$MWC^BPSRPT6(BPRX,BPREF))
"RTN","BPSRPT5",67,0)
 . W ?71,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",68,0)
 . W ?75,$$RXSTANAM^BPSRPT2($$RXSTATUS^BPSRPT6(BPRX,0))
"RTN","BPSRPT5",69,0)
 . W ?78,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",70,0)
 . W ?82,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",71,0)
 . I BPRTYPE=1 W ?122,$J($$BILL^BPSRPT6(BPRX,BPREF),10)
"RTN","BPSRPT5",72,0)
 ;
"RTN","BPSRPT5",73,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT5",74,0)
 . W !,?3,$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)
"RTN","BPSRPT5",75,0)
 . W ?31,$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)
"RTN","BPSRPT5",76,0)
 . W ?41,$J(BPBIL,10,2)
"RTN","BPSRPT5",77,0)
 . W ?54,$$QTY^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",78,0)
 . W ?61,$$GETNDC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",79,0)
 . W ?82,$$DRGNAM^BPSRPT6($P(BPX,U,14),32)
"RTN","BPSRPT5",80,0)
 ;
"RTN","BPSRPT5",81,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT5",82,0)
 . W !,?4,$$DRGNAM^BPSRPT6($P(BPX,U,14),32)
"RTN","BPSRPT5",83,0)
 . W ?54,$$MWCNAM^BPSRPT1($$MWC^BPSRPT6(BPRX,BPREF))
"RTN","BPSRPT5",84,0)
 . W ?57,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",85,0)
 . W ?60,$$RXSTANAM^BPSRPT2($$RXSTATUS^BPSRPT6(BPRX,0))
"RTN","BPSRPT5",86,0)
 . W ?63,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",87,0)
 . W ?67,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",88,0)
 ;
"RTN","BPSRPT5",89,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT5",90,0)
 . W !,?4,$$DRGNAM^BPSRPT6($P(BPX,U,14),32)
"RTN","BPSRPT5",91,0)
 . W ?38,$$MWCNAM^BPSRPT1($$MWC^BPSRPT6(BPRX,BPREF))
"RTN","BPSRPT5",92,0)
 . W ?41,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",93,0)
 . W ?44,$$RXSTANAM^BPSRPT2($$RXSTATUS^BPSRPT6(BPRX,0))
"RTN","BPSRPT5",94,0)
 . W ?47,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",95,0)
 . W ?51,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",96,0)
 . I $P(BPGRPLAN,U,2)]"" W ?60,$E($P(BPGRPLAN,U,2),1,30)
"RTN","BPSRPT5",97,0)
 . W ?122,$J($$ELAPSE^BPSRPT6($P(BPX,U,3)),10)
"RTN","BPSRPT5",98,0)
 ;
"RTN","BPSRPT5",99,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT5",100,0)
 . W !,?3,$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)
"RTN","BPSRPT5",101,0)
 . W ?31,$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)
"RTN","BPSRPT5",102,0)
 . W ?41,$$DATTIM^BPSRPT1(+$$CLOSEDT^BPSRPT2(+$P(BPX,U,3)))
"RTN","BPSRPT5",103,0)
 . N BPCLBY S BPCLBY=$E($$CLSBY^BPSRPT6(+$P(BPX,U,3)),1,25) S:BPCLBY="" BPCLBY="BLANK"
"RTN","BPSRPT5",104,0)
 . W ?59,BPCLBY S BPCNT(BPCLBY)=$G(BPCNT(BPCLBY))+1,BPGCNT(BPCLBY)=$G(BPGCNT(BPCLBY))+1
"RTN","BPSRPT5",105,0)
 . W ?87,$E($P($$CLRSN^BPSRPT7(+$P(BPX,U,3)),U,2),1,30)
"RTN","BPSRPT5",106,0)
 Q
"RTN","BPSRPT5",107,0)
 ;
"RTN","BPSRPT5",108,0)
 ;Print Report Line 3
"RTN","BPSRPT5",109,0)
 ;
"RTN","BPSRPT5",110,0)
 ; Input Variables -> BPRTYPE,BPX,BPEXCEL
"RTN","BPSRPT5",111,0)
 ; 
"RTN","BPSRPT5",112,0)
WRLINE3(BPRTYPE,BPREC,BPX,BPEXCEL) N BP59
"RTN","BPSRPT5",113,0)
 S BP59=+$P(BPX,U,3)
"RTN","BPSRPT5",114,0)
 ;
"RTN","BPSRPT5",115,0)
 ;Excel Output
"RTN","BPSRPT5",116,0)
 I $G(BPEXCEL) D WRLINE3^BPSRPT8(BPRTYPE,.BPREC,BPX) Q
"RTN","BPSRPT5",117,0)
 ;
"RTN","BPSRPT5",118,0)
 ;Report Output
"RTN","BPSRPT5",119,0)
 I BPRTYPE=4 D
"RTN","BPSRPT5",120,0)
 . S NP=$$CHKP(1) Q:BPQ
"RTN","BPSRPT5",121,0)
 . ;Method
"RTN","BPSRPT5",122,0)
 . I $$AUTOREV^BPSRPT1(BP59) W !,?6,"AUTO/"
"RTN","BPSRPT5",123,0)
 . E  W !,?6,"REGULAR/"
"RTN","BPSRPT5",124,0)
 . ;Return Status
"RTN","BPSRPT5",125,0)
 . I $P(BPX,U,15)["ACCEPTED" W "ACCEPTED/"
"RTN","BPSRPT5",126,0)
 . E  W "REJECTED/"
"RTN","BPSRPT5",127,0)
 . ;Reason
"RTN","BPSRPT5",128,0)
 . W $$RVSRSN^BPSRPT7(+$P(BPX,U,3))
"RTN","BPSRPT5",129,0)
 ;
"RTN","BPSRPT5",130,0)
 Q
"RTN","BPSRPT5",131,0)
 ;
"RTN","BPSRPT5",132,0)
 ;Display the Report
"RTN","BPSRPT5",133,0)
 ;
"RTN","BPSRPT5",134,0)
 ; Input Variables -> REF,BPEXCEL,BPSCR,BPRPTNAM,BPSUMDET,BPPAGE
"RTN","BPSRPT5",135,0)
 ;
"RTN","BPSRPT5",136,0)
REPORT(REF,BPEXCEL,BPSCR,BPRPTNAM,BPSUMDET,BPPAGE) N BPBIL,BPBLINE,BPCOLL,BPDFN,BPDIV,BPELTM,BPGELTM,BPGBIL,BPGINS,BPGCOLL,BPGCNT,BPGRPLAN,BPINS,BPLINES,BPREC,BPREF,BPRX,BPSRTDT,BPSTATUS,BPTBIL,BPTCOLL,BPTINS,BPX,BPSGTOT,NP,BPSDATA
"RTN","BPSRPT5",137,0)
 I '$D(@REF) D HDR^BPSRPT7(BPRTYPE,BPRPTNAM,.BPPAGE) W !,"No data meets the criteria." G XREPORT
"RTN","BPSRPT5",138,0)
 S (BPGBIL,BPGINS,BPGCOLL,BPGCNT,BPGELTM)=0
"RTN","BPSRPT5",139,0)
 S BPDIV="" F  S BPDIV=$O(@REF@(BPDIV)) Q:BPDIV=""  D  Q:BPQ
"RTN","BPSRPT5",140,0)
 .S BPGRPLAN=0 D HDR^BPSRPT7(BPRTYPE,BPRPTNAM,.BPPAGE)
"RTN","BPSRPT5",141,0)
 .N BPCNT S (BPTBIL,BPTINS,BPTCOLL,BPCNT,BPELTM)=0
"RTN","BPSRPT5",142,0)
 .F  S BPGRPLAN=$O(@REF@(BPDIV,BPGRPLAN)) Q:BPGRPLAN=""  D  Q:BPQ
"RTN","BPSRPT5",143,0)
 .. I BPSUMDET=0 D WRPLAN(BPGRPLAN) Q:BPQ
"RTN","BPSRPT5",144,0)
 .. S BPBLINE=""  ;Reset Blank Line Indicator
"RTN","BPSRPT5",145,0)
 .. N BPSCLM,BPREC,BPTOT
"RTN","BPSRPT5",146,0)
 .. S BPDFN="" F  S BPDFN=$O(@REF@(BPDIV,BPGRPLAN,BPDFN)) Q:BPDFN=""  D  Q:BPQ
"RTN","BPSRPT5",147,0)
 ... S BPSRTDT="" F  S BPSRTDT=$O(@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT)) Q:BPSRTDT=""  D  Q:BPQ
"RTN","BPSRPT5",148,0)
 .... S BPRX="" F  S BPRX=$O(@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT,BPRX)) Q:BPRX=""  D  Q:BPQ
"RTN","BPSRPT5",149,0)
 ..... S BPREF="" F  S BPREF=$O(@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT,BPRX,BPREF)) Q:BPREF=""  D  Q:BPQ
"RTN","BPSRPT5",150,0)
 ...... S BPX=@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT,BPRX,BPREF)
"RTN","BPSRPT5",151,0)
 ...... S BPCNT=BPCNT+1,BPGCNT=BPGCNT+1
"RTN","BPSRPT5",152,0)
 ...... I BPRTYPE=5 D
"RTN","BPSRPT5",153,0)
 ....... S BPELTM=BPELTM+$$ELAPSE^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",154,0)
 ....... S BPGELTM=BPGELTM+$$ELAPSE^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",155,0)
 ...... S BPBIL=$$BILLED^BPSRPT7($P(BPX,U,3)),BPTBIL=BPTBIL+BPBIL,BPGBIL=BPGBIL+BPBIL
"RTN","BPSRPT5",156,0)
 ...... S BPINS=$$INSPAID^BPSRPT6($P(BPX,U,3)),BPTINS=BPTINS+BPINS,BPGINS=BPGINS+BPINS
"RTN","BPSRPT5",157,0)
 ...... S BPCOLL=$$COLLECTD^BPSRPT6(BPRX,BPREF),BPTCOLL=BPTCOLL+BPCOLL,BPGCOLL=BPGCOLL+BPCOLL
"RTN","BPSRPT5",158,0)
 ...... I BPRTYPE=6 D  Q
"RTN","BPSRPT5",159,0)
 .......S BPSTATUS=$P(BPX,U,7)
"RTN","BPSRPT5",160,0)
 .......I BPSTATUS["REJECT" S $P(BPSCLM(BPSRTDT),U,3)=$P($G(BPSCLM(BPSRTDT)),U,3)+BPBIL
"RTN","BPSRPT5",161,0)
 .......I BPSTATUS["PAYABLE" S $P(BPSCLM(BPSRTDT),U,4)=$P($G(BPSCLM(BPSRTDT)),U,4)+BPBIL
"RTN","BPSRPT5",162,0)
 .......S $P(BPSCLM(BPSRTDT),U,2)=$P($G(BPSCLM(BPSRTDT)),U,2)+BPBIL
"RTN","BPSRPT5",163,0)
 .......S $P(BPSCLM(BPSRTDT),U,5)=$P($G(BPSCLM(BPSRTDT)),U,5)+BPINS
"RTN","BPSRPT5",164,0)
 .......S $P(BPSCLM(BPSRTDT),U)=$P($G(BPSCLM(BPSRTDT)),U)+1
"RTN","BPSRPT5",165,0)
 ...... ;
"RTN","BPSRPT5",166,0)
 ...... ;Display Detail Section
"RTN","BPSRPT5",167,0)
 ...... Q:BPSUMDET=1
"RTN","BPSRPT5",168,0)
 ...... S BPREC=""  ;Reset Excel Display Variable
"RTN","BPSRPT5",169,0)
 ...... I 'BPEXCEL,BPRTYPE=1,BPBLINE=1 S NP=$$CHKP(2) Q:BPQ  I BPBLINE=1 W !  ;Print blank line
"RTN","BPSRPT5",170,0)
 ...... S NP=$$CHKP(1) Q:BPQ  D WRLINE1(BPRTYPE,.BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL,BPEXCEL)
"RTN","BPSRPT5",171,0)
 ...... S NP=$$CHKP(1) Q:BPQ  D WRLINE2(BPRTYPE,.BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN,BPEXCEL)
"RTN","BPSRPT5",172,0)
 ...... D WRLINE3(BPRTYPE,.BPREC,BPX,BPEXCEL)
"RTN","BPSRPT5",173,0)
 ...... I (",2,7,")[BPRTYPE,'BPEXCEL D  Q:BPQ
"RTN","BPSRPT5",174,0)
 ....... D COMMENT(+$P(BPX,U,3)) Q:BPQ
"RTN","BPSRPT5",175,0)
 ....... S NP=$$CHKP(1) Q:BPQ
"RTN","BPSRPT5",176,0)
 ....... W !,?10,"Claim ID: ",$$CLAIMID^BPSRPT2(+$P(BPX,U,3))
"RTN","BPSRPT5",177,0)
 ....... N BPSARR,BPRJCNT,BPZZ S BPRJCNT=$$REJTEXT^BPSRPT2(+$P(BPX,U,3),.BPSARR)
"RTN","BPSRPT5",178,0)
 ....... F BPZZ=1:1:BPRJCNT S NP=$$CHKP(1) Q:BPQ  W !,?10,BPSARR(BPZZ) Q:BPQ
"RTN","BPSRPT5",179,0)
 ...... I 'BPEXCEL,BPRTYPE=1 S BPBLINE=1  ;Set Blank Line Display Indicator
"RTN","BPSRPT5",180,0)
 .. I BPRTYPE=6 D PTBDT^BPSRPT7(BPDIV,BPSUMDET,.BPSCLM,.BPSGTOT)
"RTN","BPSRPT5",181,0)
 .I 'BPEXCEL,'BPQ,BPRTYPE'=6 S NP=$$CHKP(5) Q:BPQ  D TOTALS^BPSRPT7(BPRTYPE,BPDIV,BPTBIL,BPTINS,BPTCOLL,.BPCNT,BPELTM)
"RTN","BPSRPT5",182,0)
 .I 'BPEXCEL,'BPQ,$O(@REF@(BPDIV))]"" D:$G(BPSCR) PAUSE^BPSRPT1 Q:BPQ
"RTN","BPSRPT5",183,0)
 ;
"RTN","BPSRPT5",184,0)
 ;Print Grand Totals
"RTN","BPSRPT5",185,0)
 I 'BPEXCEL D
"RTN","BPSRPT5",186,0)
 .I 'BPQ,BPRTYPE=6 D PGTOT6^BPSRPT7($G(BPSGTOT))
"RTN","BPSRPT5",187,0)
 .I 'BPQ,BPRTYPE'=6 S NP=$$CHKP(5) Q:BPQ  D PGTOT^BPSRPT7(BPRTYPE,BPGBIL,BPGINS,BPGCOLL,.BPGCNT,BPGELTM)
"RTN","BPSRPT5",188,0)
 ;
"RTN","BPSRPT5",189,0)
XREPORT Q
"RTN","BPSRPT5",190,0)
 ;
"RTN","BPSRPT5",191,0)
 ;Display Comments
"RTN","BPSRPT5",192,0)
 ; 
"RTN","BPSRPT5",193,0)
 ;Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT5",194,0)
 ;
"RTN","BPSRPT5",195,0)
COMMENT(BP59) N CNODE,I,J,NP
"RTN","BPSRPT5",196,0)
 S I="" F  S I=$O(^BPST(BP59,11,"B",I),-1) Q:'I  D  Q:BPQ
"RTN","BPSRPT5",197,0)
 .S NP=$$CHKP(1) Q:BPQ
"RTN","BPSRPT5",198,0)
 .S J=$O(^BPST(BP59,11,"B",I,"")) Q:J=""
"RTN","BPSRPT5",199,0)
 .S CNODE=$G(^BPST(BP59,11,J,0))
"RTN","BPSRPT5",200,0)
 .W !,?10,$$DATTIM^BPSRPT1(+$P($P(CNODE,U),"."))," - ",$P(CNODE,U,3)
"RTN","BPSRPT5",201,0)
 Q
"RTN","BPSRPT5",202,0)
 ;
"RTN","BPSRPT5",203,0)
 ;Display the Insurance
"RTN","BPSRPT5",204,0)
 ;
"RTN","BPSRPT5",205,0)
 ; Input Variable -> BPSDATA -> if 0, skip page check
"RTN","BPSRPT5",206,0)
 ;                   BPEXCEL -> 1 - Print to Excel/0 Regular Display
"RTN","BPSRPT5",207,0)
 ;
"RTN","BPSRPT5",208,0)
WRPLAN(BPGRPLAN) N INS,NP
"RTN","BPSRPT5",209,0)
 ;
"RTN","BPSRPT5",210,0)
 I BPSUMDET'=0 Q
"RTN","BPSRPT5",211,0)
 I BPEXCEL Q
"RTN","BPSRPT5",212,0)
 ;
"RTN","BPSRPT5",213,0)
 ;Skip for Recent Transactions and Totals by Date Reports
"RTN","BPSRPT5",214,0)
 I BPRTYPE=5!(BPRTYPE=6) Q
"RTN","BPSRPT5",215,0)
 ;
"RTN","BPSRPT5",216,0)
 I $G(BPSDATA) S NP=$$CHKP(5) Q:BPQ!NP
"RTN","BPSRPT5",217,0)
 ;
"RTN","BPSRPT5",218,0)
 ;Get and display the Insurance Name
"RTN","BPSRPT5",219,0)
 S INS=$E(BPGRPLAN,1,90)
"RTN","BPSRPT5",220,0)
 I INS]"" D
"RTN","BPSRPT5",221,0)
 .D ULINE("-")
"RTN","BPSRPT5",222,0)
 .W !,INS
"RTN","BPSRPT5",223,0)
 .D ULINE("-")
"RTN","BPSRPT5",224,0)
 Q
"RTN","BPSRPT5",225,0)
 ;
"RTN","BPSRPT5",226,0)
 ;Check for End of Page
"RTN","BPSRPT5",227,0)
 ;
"RTN","BPSRPT5",228,0)
 ; Input variables -> BPLINES -> Number of lines from bottom
"RTN","BPSRPT5",229,0)
 ;                    BPEXCEL -> 1 - Print to Excel/0 Regular Display
"RTN","BPSRPT5",230,0)
 ; Output variable -> BPSDATA -> 0 -> New screen, no data displayed yet
"RTN","BPSRPT5",231,0)
 ;                               1 -> Data displayed on current screen
"RTN","BPSRPT5",232,0)
 ; 
"RTN","BPSRPT5",233,0)
CHKP(BPLINES) Q:$G(BPEXCEL) 0
"RTN","BPSRPT5",234,0)
 S BPLINES=BPLINES+1
"RTN","BPSRPT5",235,0)
 I $G(BPSCR) S BPLINES=BPLINES+2
"RTN","BPSRPT5",236,0)
 I $G(BPSCR),'$G(BPSDATA) S BPSDATA=1 Q 0
"RTN","BPSRPT5",237,0)
 S BPSDATA=1
"RTN","BPSRPT5",238,0)
 I $Y>(IOSL-BPLINES) D:$G(BPSCR) PAUSE^BPSRPT1 Q:$G(BPQ) 0 D HDR^BPSRPT7(BPRTYPE,BPRPTNAM,.BPPAGE) Q 1
"RTN","BPSRPT5",239,0)
 Q 0
"RTN","BPSRPT5",240,0)
 ;
"RTN","BPSRPT5",241,0)
 ;Print one line of characters
"RTN","BPSRPT5",242,0)
 ;
"RTN","BPSRPT5",243,0)
ULINE(X) N I
"RTN","BPSRPT5",244,0)
 W ! F I=1:1:132 W $G(X,"-")
"RTN","BPSRPT5",245,0)
 Q
"RTN","BPSRPT6")
0^311^B67527873
"RTN","BPSRPT6",1,0)
BPSRPT6 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT6",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRPT6",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRPT6",4,0)
 ;
"RTN","BPSRPT6",5,0)
 Q
"RTN","BPSRPT6",6,0)
 ;
"RTN","BPSRPT6",7,0)
 ;Get the Insurance Company pointer and name
"RTN","BPSRPT6",8,0)
 ;
"RTN","BPSRPT6",9,0)
 ; Returned Value -> ptr^Insurance Company Name
"RTN","BPSRPT6",10,0)
 ; 
"RTN","BPSRPT6",11,0)
INSNAM(BP59) N BPIN,BPDOS,BPDFN,BPSZZ,BP36,BPX
"RTN","BPSRPT6",12,0)
 ;
"RTN","BPSRPT6",13,0)
 ;Reset Insurance
"RTN","BPSRPT6",14,0)
 S BP36=""
"RTN","BPSRPT6",15,0)
 ;
"RTN","BPSRPT6",16,0)
 ;First Pull From BPS Transactions
"RTN","BPSRPT6",17,0)
 S BPIN=+$P($G(^BPST(BP59,9)),U)
"RTN","BPSRPT6",18,0)
 I +BPIN S BP36=$P($G(^BPST(BP59,10,BPIN,0)),U,7) S:BP36]"" BP36="1^"_BP36
"RTN","BPSRPT6",19,0)
 ;
"RTN","BPSRPT6",20,0)
 ;If Not Found, look up using API
"RTN","BPSRPT6",21,0)
 I BP36="" D
"RTN","BPSRPT6",22,0)
 .S BPDOS=+$P($G(^BPST(BP59,12)),U,2)\1
"RTN","BPSRPT6",23,0)
 .I BPDOS=0 S BPDOS=+$P($G(^BPST(BP59,0)),U,8)\1
"RTN","BPSRPT6",24,0)
 .S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSRPT6",25,0)
 .S BPX=$$INSUR^IBBAPI(BPDFN,BPDOS,,.BPSZZ,"1")
"RTN","BPSRPT6",26,0)
 .S BP36=$G(BPSZZ("IBBAPI","INSUR",1,1))
"RTN","BPSRPT6",27,0)
 ;
"RTN","BPSRPT6",28,0)
 ;If Not Found, put in MISSING INSURANCE
"RTN","BPSRPT6",29,0)
 I $TR(BP36,U)="" S BP36=" ^**MISSING INSURANCE**"
"RTN","BPSRPT6",30,0)
 ;
"RTN","BPSRPT6",31,0)
 Q BP36
"RTN","BPSRPT6",32,0)
 ;
"RTN","BPSRPT6",33,0)
 ;Select an Insurance Company file entry (Fileman Lookup)
"RTN","BPSRPT6",34,0)
 ;
"RTN","BPSRPT6",35,0)
 ; Returned value -> Insurance Company Name
"RTN","BPSRPT6",36,0)
 ; 
"RTN","BPSRPT6",37,0)
SELINS() N INS
"RTN","BPSRPT6",38,0)
 S INS=$$SELINSUR^IBNCPDPI("Select Insurance","")
"RTN","BPSRPT6",39,0)
 I $P(INS,U)=-1 S INS="^"
"RTN","BPSRPT6",40,0)
 E  S INS=$P(INS,U,2)
"RTN","BPSRPT6",41,0)
 Q INS
"RTN","BPSRPT6",42,0)
 ;
"RTN","BPSRPT6",43,0)
 ;Get the drug name for display
"RTN","BPSRPT6",44,0)
 ;
"RTN","BPSRPT6",45,0)
 ; Input variable ->  BP50 - Lookup to DRUG (#50)
"RTN","BPSRPT6",46,0)
 ;                   BPLEN - Length of the display field
"RTN","BPSRPT6",47,0)
 ; Returned value -> Name of the drug
"RTN","BPSRPT6",48,0)
 ;        
"RTN","BPSRPT6",49,0)
DRGNAM(BP50,BPLEN) Q $E($P($G(^PSDRUG(+BP50,0)),U),1,BPLEN)
"RTN","BPSRPT6",50,0)
 ;
"RTN","BPSRPT6",51,0)
 ;Select a DRUG file entry (Fileman Lookup)
"RTN","BPSRPT6",52,0)
 ;
"RTN","BPSRPT6",53,0)
 ; Returned Variable -> Y
"RTN","BPSRPT6",54,0)
 ; 
"RTN","BPSRPT6",55,0)
SELDRG N DIC S DIC(0)="QEAM",DIC=50,DIC("A")="Select Drug: "
"RTN","BPSRPT6",56,0)
 D ^DIC
"RTN","BPSRPT6",57,0)
 Q
"RTN","BPSRPT6",58,0)
 ;
"RTN","BPSRPT6",59,0)
 ;Get the drug class for display
"RTN","BPSRPT6",60,0)
 ;
"RTN","BPSRPT6",61,0)
 ; Input variable -> BP50605 - Lookup to VA DRUG CLASS (#50.605)
"RTN","BPSRPT6",62,0)
 ;                   BPLEN - Length of the display field
"RTN","BPSRPT6",63,0)
 ; Returned value -> Name of the drug class
"RTN","BPSRPT6",64,0)
 ;                   
"RTN","BPSRPT6",65,0)
DRGCLNAM(BP50605,BPLEN) N IEN,Y
"RTN","BPSRPT6",66,0)
 K ^TMP($J,"L")
"RTN","BPSRPT6",67,0)
 S Y=""
"RTN","BPSRPT6",68,0)
 I BP50605]"" D 
"RTN","BPSRPT6",69,0)
 .D C^PSN50P65(BP50605,"","L")
"RTN","BPSRPT6",70,0)
 .S IEN=$O(^TMP($J,"L",0))
"RTN","BPSRPT6",71,0)
 .I IEN]"" S Y=$E($G(^TMP($J,"L",IEN,1)),1,BPLEN)
"RTN","BPSRPT6",72,0)
 K ^TMP($J,"L")
"RTN","BPSRPT6",73,0)
 Q Y
"RTN","BPSRPT6",74,0)
 ;
"RTN","BPSRPT6",75,0)
 ;Select a VA DRUG CLASS file entry (Fileman Lookup)
"RTN","BPSRPT6",76,0)
 ;
"RTN","BPSRPT6",77,0)
SELDRGC N DIR,DIRUT,DTOUT,DUOUT,IEN,TOT,X
"RTN","BPSRPT6",78,0)
 K ^TMP($J,"L")
"RTN","BPSRPT6",79,0)
 ;
"RTN","BPSRPT6",80,0)
 F  D  Q:Y]""
"RTN","BPSRPT6",81,0)
 .S DIR(0)="FO^1:35"
"RTN","BPSRPT6",82,0)
 .S DIR("A")="Select Drug Class"
"RTN","BPSRPT6",83,0)
 .S DIR("?")="Answer with VA DRUG CLASS CODE, or CLASSIFICATION. TYPE '??' FOR A LIST"
"RTN","BPSRPT6",84,0)
 .S DIR("??")="^D DCLIST^BPSRPT6"
"RTN","BPSRPT6",85,0)
 .D ^DIR
"RTN","BPSRPT6",86,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="") S Y="^" Q
"RTN","BPSRPT6",87,0)
 .D C^PSN50P65("",Y,"L")
"RTN","BPSRPT6",88,0)
 .;
"RTN","BPSRPT6",89,0)
 .;Pull Total Entries Found
"RTN","BPSRPT6",90,0)
 .S TOT=+$G(^TMP($J,"L",0))
"RTN","BPSRPT6",91,0)
 .;
"RTN","BPSRPT6",92,0)
 .;Check for no entries found
"RTN","BPSRPT6",93,0)
 .I TOT<1 W "  ??" S Y="" Q
"RTN","BPSRPT6",94,0)
 .;
"RTN","BPSRPT6",95,0)
 .;Check for Unique Entry
"RTN","BPSRPT6",96,0)
 .I TOT=1 D  Q
"RTN","BPSRPT6",97,0)
 ..S Y="",IEN=$O(^TMP($J,"L",0))
"RTN","BPSRPT6",98,0)
 ..I IEN]"" S Y=$G(^TMP($J,"L",IEN,1)) W $C(13),"Select Drug Class: ",Y
"RTN","BPSRPT6",99,0)
 .;
"RTN","BPSRPT6",100,0)
 .;Check for multiple entries - allow user to pick
"RTN","BPSRPT6",101,0)
 .I TOT>1 S Y=$$DCSEL(TOT)
"RTN","BPSRPT6",102,0)
 .;
"RTN","BPSRPT6",103,0)
 K ^TMP($J,"L")
"RTN","BPSRPT6",104,0)
 Q
"RTN","BPSRPT6",105,0)
 ;
"RTN","BPSRPT6",106,0)
 ;List Entries in VA DRUG CLASS
"RTN","BPSRPT6",107,0)
 ;
"RTN","BPSRPT6",108,0)
DCLIST N CL,DTOUT,IEN,Y
"RTN","BPSRPT6",109,0)
 K ^TMP($J,"L")
"RTN","BPSRPT6",110,0)
 D C^PSN50P65("","??","L")
"RTN","BPSRPT6",111,0)
 ;
"RTN","BPSRPT6",112,0)
 ;First create new index - sorted by CLASSIFICATION
"RTN","BPSRPT6",113,0)
 S IEN=0 F  S IEN=$O(^TMP($J,"L",IEN)) Q:'IEN  D
"RTN","BPSRPT6",114,0)
 .S CL=$G(^TMP($J,"L",IEN,1)) Q:CL=""
"RTN","BPSRPT6",115,0)
 .S ^TMP($J,"L","B",CL,IEN)=$G(^TMP($J,"L",IEN,".01"))
"RTN","BPSRPT6",116,0)
 ;
"RTN","BPSRPT6",117,0)
 ;Now loop through and display entries
"RTN","BPSRPT6",118,0)
 S $X=0,$Y=0 W !,?3,"Choose from: ",!
"RTN","BPSRPT6",119,0)
 S (Y,CL)="" F  S CL=$O(^TMP($J,"L","B",CL)) Q:CL=""  D  Q:Y]""
"RTN","BPSRPT6",120,0)
 .S IEN="" F  S IEN=$O(^TMP($J,"L","B",CL,IEN)) Q:IEN=""  D  Q:Y]""
"RTN","BPSRPT6",121,0)
 ..W ?3,$G(^TMP($J,"L","B",CL,IEN)),!,?3,CL,!
"RTN","BPSRPT6",122,0)
 ..I $Y>19!'$Y D
"RTN","BPSRPT6",123,0)
 ...W ?3 R "'^' TO STOP: ",Y:$G(DTIME,300)
"RTN","BPSRPT6",124,0)
 ...E  S DTOUT=1
"RTN","BPSRPT6",125,0)
 ...W $C(13),$J("",17),$C(13)
"RTN","BPSRPT6",126,0)
 ...I ($G(DTOUT)=1)!($G(Y)="^") S Y="^" Q
"RTN","BPSRPT6",127,0)
 ...S $X=0,$Y=0
"RTN","BPSRPT6",128,0)
 ;
"RTN","BPSRPT6",129,0)
 K ^TMP($J,"L")
"RTN","BPSRPT6",130,0)
 Q
"RTN","BPSRPT6",131,0)
 ;
"RTN","BPSRPT6",132,0)
 ;Allow user to pick VA DRUG CLASS entry based on initial input
"RTN","BPSRPT6",133,0)
 ;
"RTN","BPSRPT6",134,0)
 ; Input variable - TOT -> Total entries placed in ^TMP($J,"L")
"RTN","BPSRPT6",135,0)
 ; Returned value - VA DRUG CLASSIFICATION
"RTN","BPSRPT6",136,0)
 ;
"RTN","BPSRPT6",137,0)
DCSEL(TOT) N CL,I,IEN,IX,Y
"RTN","BPSRPT6",138,0)
 ;
"RTN","BPSRPT6",139,0)
 ;First create new index
"RTN","BPSRPT6",140,0)
 F IX="B","N" K ^TMP($J,"L",IX)
"RTN","BPSRPT6",141,0)
 S Y="",IEN=0 F  S IEN=$O(^TMP($J,"L",IEN)) Q:'IEN  D
"RTN","BPSRPT6",142,0)
 .S CL=$G(^TMP($J,"L",IEN,1)) Q:CL=""
"RTN","BPSRPT6",143,0)
 .S ^TMP($J,"L","B",CL,IEN)=$G(^TMP($J,"L",IEN,".01"))
"RTN","BPSRPT6",144,0)
 ;
"RTN","BPSRPT6",145,0)
 ;Now loop through and allow one to be picked
"RTN","BPSRPT6",146,0)
 S (Y,CL)="" F  S CL=$O(^TMP($J,"L","B",CL)) Q:CL=""  D  Q:Y]""
"RTN","BPSRPT6",147,0)
 .S IEN="" F  S IEN=$O(^TMP($J,"L","B",CL,IEN)) Q:IEN=""  D  Q:Y]""
"RTN","BPSRPT6",148,0)
 ..S I=$G(I)+1 W !,?5,I,?9,$G(^TMP($J,"L","B",CL,IEN)),!,?3,CL
"RTN","BPSRPT6",149,0)
 ..S ^TMP($J,"L","N",I)=CL
"RTN","BPSRPT6",150,0)
 ..;
"RTN","BPSRPT6",151,0)
 ..;Stop after every 5 entries
"RTN","BPSRPT6",152,0)
 ..I I#5=0 I TOT>I D
"RTN","BPSRPT6",153,0)
 ...W !,"Press <RETURN> to see more, '^' to exit this list, OR"
"RTN","BPSRPT6",154,0)
 ...W !,"CHOOSE 1 - "_I R ": ",Y:DTIME S:'$T DTOUT=1
"RTN","BPSRPT6",155,0)
 ..;
"RTN","BPSRPT6",156,0)
 ..;Stop after last entry
"RTN","BPSRPT6",157,0)
 ..I I=TOT D
"RTN","BPSRPT6",158,0)
 ...W !,"CHOOSE 1 - "_I R ": ",Y:DTIME S:'$T DTOUT=1
"RTN","BPSRPT6",159,0)
 ..I ($G(DTOUT)=1)!($G(Y)="^") S Y="^"
"RTN","BPSRPT6",160,0)
 ..;
"RTN","BPSRPT6",161,0)
 ..;Check for valid entry
"RTN","BPSRPT6",162,0)
 ..I Y]"",'$D(^TMP($J,"L","N",Y)) W "  ??" S Y=""
"RTN","BPSRPT6",163,0)
 ..I Y]"",$D(^TMP($J,"L","N",Y)) S Y=$G(^TMP($J,"L","N",Y))
"RTN","BPSRPT6",164,0)
 ;
"RTN","BPSRPT6",165,0)
 Q Y
"RTN","BPSRPT6",166,0)
 ;
"RTN","BPSRPT6",167,0)
 ;Get DRUG file pointer
"RTN","BPSRPT6",168,0)
 ;       
"RTN","BPSRPT6",169,0)
 ; Return Value -> n = ptr to DRUG (#50)
"RTN","BPSRPT6",170,0)
 ;                 0 = Unknown
"RTN","BPSRPT6",171,0)
 ; 
"RTN","BPSRPT6",172,0)
GETDRUG(BPRX) Q +$P($G(^PSRX(BPRX,0)),U,6)
"RTN","BPSRPT6",173,0)
 ;
"RTN","BPSRPT6",174,0)
 ;Get VA DRUG CLASS pointer
"RTN","BPSRPT6",175,0)
 ;       
"RTN","BPSRPT6",176,0)
 ; Input Variables: BP50 - ptr to DRUG (#50)
"RTN","BPSRPT6",177,0)
 ;
"RTN","BPSRPT6",178,0)
 ; Return Value -> n = ptr to VA DRUG CLASS (#50.605)
"RTN","BPSRPT6",179,0)
 ;                 0 = Unknown
"RTN","BPSRPT6",180,0)
 ;
"RTN","BPSRPT6",181,0)
GETDRGCL(BP50) Q $P($G(^PSDRUG(BP50,"ND")),U,6)
"RTN","BPSRPT6",182,0)
 ;
"RTN","BPSRPT6",183,0)
 ;Determine whether claim was Mail, Window, or CMOP
"RTN","BPSRPT6",184,0)
 ;
"RTN","BPSRPT6",185,0)
 ; Input Variables: BPREF - refill # (0-No Refills,1-1st Refill, 2-2nd, ...) 
"RTN","BPSRPT6",186,0)
 ;
"RTN","BPSRPT6",187,0)
 ; Return Value -> 2 = Mail
"RTN","BPSRPT6",188,0)
 ;                 3 = Window
"RTN","BPSRPT6",189,0)
 ;                 4 = CMOP
"RTN","BPSRPT6",190,0)
 ;
"RTN","BPSRPT6",191,0)
MWC(BPRX,BPREF) N BPX,BPY
"RTN","BPSRPT6",192,0)
 S BPY=2
"RTN","BPSRPT6",193,0)
 ;
"RTN","BPSRPT6",194,0)
 ;if 1st fill check #52 (#11) MAIL/WINDOW
"RTN","BPSRPT6",195,0)
 ;if refill check refills multiple #52.1 (#2) MAIL/WINDOW
"RTN","BPSRPT6",196,0)
 I BPREF=0 S BPX=$P($G(^PSRX(BPRX,0)),U,11)
"RTN","BPSRPT6",197,0)
 E  S BPX=$P($G(^PSRX(BPRX,1,BPREF,0)),U,2)
"RTN","BPSRPT6",198,0)
 ;
"RTN","BPSRPT6",199,0)
 ; if WINDOW then 3(W)
"RTN","BPSRPT6",200,0)
 I BPX="W" Q 3
"RTN","BPSRPT6",201,0)
 ; else
"RTN","BPSRPT6",202,0)
 ;  check STATUS of RX
"RTN","BPSRPT6",203,0)
 ;  if STATUS="SUSPENSE" check 
"RTN","BPSRPT6",204,0)
 I $G(^PSRX(BPRX,"STA"))=5 D  Q BPY
"RTN","BPSRPT6",205,0)
 . ;   check #52.5
"RTN","BPSRPT6",206,0)
 . S BPX=$O(^PS(52.5,"B",BPRX,0))
"RTN","BPSRPT6",207,0)
 . ;   if CMOP INDICATOR = "P" then 2 (M)
"RTN","BPSRPT6",208,0)
 . I $P($G(^PS(52.5,BPX,0)),U,7)="P" S BPY=2 Q
"RTN","BPSRPT6",209,0)
 . ;   else (i.e. Q!X!L) 4(C)
"RTN","BPSRPT6",210,0)
 . S BPY=4
"RTN","BPSRPT6",211,0)
 ;  else 
"RTN","BPSRPT6",212,0)
 ;  check CMOP EVENTS for this 0 fill
"RTN","BPSRPT6",213,0)
 S BPY=2
"RTN","BPSRPT6",214,0)
 S BPX=0 F  S BPX=$O(^PSRX(BPRX,4,BPX)) Q:+BPX=0!(BPY=4)  D
"RTN","BPSRPT6",215,0)
 . ;  if exists for BPREF then 4("C")
"RTN","BPSRPT6",216,0)
 . I $P($G(^PSRX(BPRX,4,BPX,0)),U,3)=BPREF S BPY=4
"RTN","BPSRPT6",217,0)
 ;  else 2("M")
"RTN","BPSRPT6",218,0)
 Q BPY
"RTN","BPSRPT6",219,0)
 ;
"RTN","BPSRPT6",220,0)
 ;Get Patient Name
"RTN","BPSRPT6",221,0)
 ;
"RTN","BPSRPT6",222,0)
 ; Input variable -> BPDFN - ptr to PATIENT (#2)
"RTN","BPSRPT6",223,0)
 ; Returned value -> Patient Name (shortened)
"RTN","BPSRPT6",224,0)
 ; 
"RTN","BPSRPT6",225,0)
PATNAME(BPDFN) Q $E($P($G(^DPT(BPDFN,0)),U),1,25)
"RTN","BPSRPT6",226,0)
 ;
"RTN","BPSRPT6",227,0)
 ;Get Last 4 of SSN
"RTN","BPSRPT6",228,0)
 ;
"RTN","BPSRPT6",229,0)
 ; Input variable -> BPDFN - ptr to PATIENT (#2)
"RTN","BPSRPT6",230,0)
 ; Returned value -> Last 4 digits of patient's SSN
"RTN","BPSRPT6",231,0)
 ; 
"RTN","BPSRPT6",232,0)
SSN4(BPDFN) N X
"RTN","BPSRPT6",233,0)
 S X=$P($G(^DPT(BPDFN,0)),U,9)
"RTN","BPSRPT6",234,0)
 Q $E(X,$L(X)-3,$L(X))
"RTN","BPSRPT6",235,0)
 ;
"RTN","BPSRPT6",236,0)
 ;Get RX#
"RTN","BPSRPT6",237,0)
 ;
"RTN","BPSRPT6",238,0)
 ; Returned value -> RX#
"RTN","BPSRPT6",239,0)
 ; 
"RTN","BPSRPT6",240,0)
RXNUM(BPRX) ;
"RTN","BPSRPT6",241,0)
 Q $P($G(^PSRX(+BPRX,0)),U)
"RTN","BPSRPT6",242,0)
 ;
"RTN","BPSRPT6",243,0)
 ;Determine $Collected
"RTN","BPSRPT6",244,0)
 ;
"RTN","BPSRPT6",245,0)
 ; Returned Value -> $Collected
"RTN","BPSRPT6",246,0)
 ;
"RTN","BPSRPT6",247,0)
COLLECTD(BPRX,BPREF) N COL,RET
"RTN","BPSRPT6",248,0)
 S RET=$$BILLINFO^IBNCPDPI(BPRX,BPREF)
"RTN","BPSRPT6",249,0)
 S COL=$P(RET,U,5) I COL="0",($P(RET,U,3)=16)!($P(RET,U,3)=27) S COL=""
"RTN","BPSRPT6",250,0)
 I $P(RET,U,7)=1 S COL="N/A"
"RTN","BPSRPT6",251,0)
 Q COL
"RTN","BPSRPT6",252,0)
 ;
"RTN","BPSRPT6",253,0)
 ;Determine Bill #
"RTN","BPSRPT6",254,0)
 ;
"RTN","BPSRPT6",255,0)
 ; Returned Value -> Bill Number
"RTN","BPSRPT6",256,0)
 ;
"RTN","BPSRPT6",257,0)
BILL(BPRX,BPREF) N BILL
"RTN","BPSRPT6",258,0)
 S BILL=$P($$BILLINFO^IBNCPDPI(BPRX,BPREF),U)
"RTN","BPSRPT6",259,0)
 Q BILL
"RTN","BPSRPT6",260,0)
 ;
"RTN","BPSRPT6",261,0)
 ;Determine $Ins Paid
"RTN","BPSRPT6",262,0)
 ;
"RTN","BPSRPT6",263,0)
INSPAID(BP59) N X,RESP,POSITION
"RTN","BPSRPT6",264,0)
 S X=$G(^BPST(BP59,0))
"RTN","BPSRPT6",265,0)
 S RESP=$P(X,U,5)
"RTN","BPSRPT6",266,0)
 S POSITION=$P(X,U,9)
"RTN","BPSRPT6",267,0)
 Q $S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:0)
"RTN","BPSRPT6",268,0)
 ;
"RTN","BPSRPT6",269,0)
 ;Get the Closed Claim Reason
"RTN","BPSRPT6",270,0)
 ;
"RTN","BPSRPT6",271,0)
 ; Input variable -> 0 for All Closed Claim Reasons or
"RTN","BPSRPT6",272,0)
 ;                   lookup to CLAIMS TRACKING NON-BILLABLE REASONS (#356.8)
"RTN","BPSRPT6",273,0)
 ; Returned value -> ALL or the selected Closed Claim Reason
"RTN","BPSRPT6",274,0)
 ; 
"RTN","BPSRPT6",275,0)
GETCLR(RSN) ;
"RTN","BPSRPT6",276,0)
 I RSN="0" S RSN="ALL"
"RTN","BPSRPT6",277,0)
 E  S RSN=$P($G(^IBE(356.8,+RSN,0)),U)
"RTN","BPSRPT6",278,0)
 Q RSN
"RTN","BPSRPT6",279,0)
 ;
"RTN","BPSRPT6",280,0)
 ;Get the Closed By Person
"RTN","BPSRPT6",281,0)
 ;
"RTN","BPSRPT6",282,0)
 ; Returned Value -> Closed By Name
"RTN","BPSRPT6",283,0)
 ; 
"RTN","BPSRPT6",284,0)
CLSBY(BP59) N BP02,CBY,Y
"RTN","BPSRPT6",285,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT6",286,0)
 S CBY=+$P($G(^BPSC(BP02,900)),U,3)
"RTN","BPSRPT6",287,0)
 S Y=$$GET1^DIQ(200,CBY_",",".01")
"RTN","BPSRPT6",288,0)
 Q Y
"RTN","BPSRPT6",289,0)
 ;
"RTN","BPSRPT6",290,0)
 ;Get the Claim Status
"RTN","BPSRPT6",291,0)
 ;
"RTN","BPSRPT6",292,0)
 ; Input Variables: BPREF - refill # (0-No Refills,1-1st Refill, 2-2nd, ...) 
"RTN","BPSRPT6",293,0)
 ;
"RTN","BPSRPT6",294,0)
STATUS(BPRX,BPREF) Q $$STATUS^BPSOSRX(BPRX,BPREF,0)
"RTN","BPSRPT6",295,0)
 ;
"RTN","BPSRPT6",296,0)
 ;Elapsed Time
"RTN","BPSRPT6",297,0)
 ;
"RTN","BPSRPT6",298,0)
 ; Returned Value -> TIME - Elapsed Processing Time
"RTN","BPSRPT6",299,0)
 ; 
"RTN","BPSRPT6",300,0)
ELAPSE(BP59) Q $$TIMEDIFI^BPSOSUD($P($G(^BPST(BP59,0)),U,11),$P($G(^BPST(BP59,0)),U,8))
"RTN","BPSRPT6",301,0)
 ;
"RTN","BPSRPT6",302,0)
 ;Get RX issue date
"RTN","BPSRPT6",303,0)
 ;
"RTN","BPSRPT6",304,0)
RXISSDT(BPRX) Q +$P($G(^PSRX(BPRX,0)),U,13)
"RTN","BPSRPT6",305,0)
 ;
"RTN","BPSRPT6",306,0)
 ;
"RTN","BPSRPT6",307,0)
 ;Get RX's fill date
"RTN","BPSRPT6",308,0)
RXFILDT(BPRX) Q +$P($G(^PSRX(BPRX,2)),U,2)
"RTN","BPSRPT6",309,0)
 ;
"RTN","BPSRPT6",310,0)
 ;Get label date for RX,
"RTN","BPSRPT6",311,0)
RXLBLDT(BPRX,BPDIR) N BPRET
"RTN","BPSRPT6",312,0)
 I BPDIR=0 S BPRET=$O(^PSRX(BPRX,"L",0))
"RTN","BPSRPT6",313,0)
 I BPDIR=1 S BPRET=$O(^PSRX(BPRX,"L",9999),-1)
"RTN","BPSRPT6",314,0)
 I BPRET S BPRET=$P($G(^PSRX(BPRX,"L",+BPRET,0)),U)\1
"RTN","BPSRPT6",315,0)
 Q BPRET
"RTN","BPSRPT6",316,0)
 ;
"RTN","BPSRPT6",317,0)
 ;Get label date for refills
"RTN","BPSRPT6",318,0)
 ;
"RTN","BPSRPT6",319,0)
REFLBLDT(BPRX,BPDIR) Q $$RXLBLDT(BPRX,BPDIR)
"RTN","BPSRPT6",320,0)
 ;
"RTN","BPSRPT6",321,0)
 ;Get Refill's issue date
"RTN","BPSRPT6",322,0)
 ;
"RTN","BPSRPT6",323,0)
REFISSDT(BPRX,BPREF) Q $$REFDISDT(BPRX,BPREF)
"RTN","BPSRPT6",324,0)
 ;
"RTN","BPSRPT6",325,0)
 ;Get Refill's dispense date
"RTN","BPSRPT6",326,0)
 ;
"RTN","BPSRPT6",327,0)
REFDISDT(BPRX,BPREF) Q +$P($G(^PSRX(BPRX,1,BPREF,0)),U,19)
"RTN","BPSRPT6",328,0)
 ;
"RTN","BPSRPT6",329,0)
 ;Get Refill's refill date
"RTN","BPSRPT6",330,0)
 ;
"RTN","BPSRPT6",331,0)
REFFILDT(BPRX,BPREF) Q +$P($G(^PSRX(BPRX,1,BPREF,0)),U)
"RTN","BPSRPT6",332,0)
 ;
"RTN","BPSRPT6",333,0)
 ;Get RX's release date
"RTN","BPSRPT6",334,0)
 ;
"RTN","BPSRPT6",335,0)
RXRELDT(BPRX) Q +$P($G(^PSRX(BPRX,2)),U,13)
"RTN","BPSRPT6",336,0)
 ;
"RTN","BPSRPT6",337,0)
 ;Get Refill's release date
"RTN","BPSRPT6",338,0)
 ;
"RTN","BPSRPT6",339,0)
REFRELDT(BPRX,BPREF) Q +$P($G(^PSRX(BPRX,1,BPREF,0)),U,18)
"RTN","BPSRPT6",340,0)
 ;
"RTN","BPSRPT6",341,0)
 ;See if refill exists
"RTN","BPSRPT6",342,0)
 ;
"RTN","BPSRPT6",343,0)
IFREFILL(BPRX,BPREF) Q $D(^PSRX(BPRX,1,BPREF))>0
"RTN","BPSRPT6",344,0)
 ;
"RTN","BPSRPT6",345,0)
 ;Get RX status
"RTN","BPSRPT6",346,0)
 ;
"RTN","BPSRPT6",347,0)
 ; Input Variables -> RXNUM = ptr to #52 (MODE = 0)
"RTN","BPSRPT6",348,0)
 ;                            or RX Number (MODE = 1)
"RTN","BPSRPT6",349,0)
 ;                            
"RTN","BPSRPT6",350,0)
RXSTATUS(RXNUM,MODE) ;
"RTN","BPSRPT6",351,0)
 I $G(MODE) S RXNUM=$O(^PSRX("B",RXNUM,0)) I +RXNUM=0 Q -1
"RTN","BPSRPT6",352,0)
 I '$D(^PSRX(RXNUM,"STA")) Q -1
"RTN","BPSRPT6",353,0)
 Q $G(^PSRX(RXNUM,"STA"))
"RTN","BPSRPT6",354,0)
 ;
"RTN","BPSRPT6",355,0)
 ;Return RX Quantity
"RTN","BPSRPT6",356,0)
 ;
"RTN","BPSRPT6",357,0)
QTY(BPRX,BPREF) ;
"RTN","BPSRPT6",358,0)
 I +$G(BPREF)=0 Q +$P($G(^PSRX(BPRX,0)),U,7)
"RTN","BPSRPT6",359,0)
 Q +$P($G(^PSRX(BPRX,1,BPREF,0)),U,4)
"RTN","BPSRPT6",360,0)
 ;
"RTN","BPSRPT6",361,0)
 ;Return NDC Number
"RTN","BPSRPT6",362,0)
GETNDC(BPRX,BPREF) Q $$GETNDC^PSONDCUT(BPRX,BPREF)
"RTN","BPSRPT6",363,0)
 ;
"RTN","BPSRPT6",364,0)
 ;Return Copay Status ($)
"RTN","BPSRPT6",365,0)
COPAY(BPRX) Q $S($G(^PSRX(BPRX,"IB")):"$",1:"")
"RTN","BPSRPT7")
0^312^B69601787
"RTN","BPSRPT7",1,0)
BPSRPT7 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT7",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRPT7",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRPT7",4,0)
 ;
"RTN","BPSRPT7",5,0)
 Q
"RTN","BPSRPT7",6,0)
 ;
"RTN","BPSRPT7",7,0)
 ;Routine to Display the Reports (Continued)
"RTN","BPSRPT7",8,0)
 ;
"RTN","BPSRPT7",9,0)
 ; Input Variables -> BPCLM = Array of report data by date
"RTN","BPSRPT7",10,0)
 ;                   BPDIV,BPSUMDET,GTOT
"RTN","BPSRPT7",11,0)
 ; Returned Value -> Cumulative Grand Totals
"RTN","BPSRPT7",12,0)
 ; 
"RTN","BPSRPT7",13,0)
PTBDT(BPDIV,BPSUMDET,BPCLM,GTOT) N DIFF,I,NP,RDT,TOT,X
"RTN","BPSRPT7",14,0)
 ;
"RTN","BPSRPT7",15,0)
 ;Loop through compiled array and display
"RTN","BPSRPT7",16,0)
 S TOT=""
"RTN","BPSRPT7",17,0)
 S RDT="" F  S RDT=$O(BPCLM(RDT)) Q:RDT=""  D  Q:BPQ
"RTN","BPSRPT7",18,0)
 .S NP=$$CHKP^BPSRPT5(1) Q:BPQ
"RTN","BPSRPT7",19,0)
 .S X=$G(BPCLM(RDT))
"RTN","BPSRPT7",20,0)
 .;
"RTN","BPSRPT7",21,0)
 .;Print Details - Report
"RTN","BPSRPT7",22,0)
 .I BPSUMDET=0,'BPEXCEL D
"RTN","BPSRPT7",23,0)
 ..W !,$$DATTIM^BPSRPT1(RDT) ;Date
"RTN","BPSRPT7",24,0)
 ..W ?15,$J(+$P(X,U),17) ;#Claims
"RTN","BPSRPT7",25,0)
 ..W ?33,$J(+$P(X,U,2),17,2)  ;Amount Submitted
"RTN","BPSRPT7",26,0)
 ..W ?51,$J(+$P(X,U,3),17,2)  ;Returned Rejected
"RTN","BPSRPT7",27,0)
 ..W ?69,$J(+$P(X,U,4),17,2)  ;Returned Payable
"RTN","BPSRPT7",28,0)
 ..W ?87,$J(+$P(X,U,5),17,2)  ;Amount to Receive
"RTN","BPSRPT7",29,0)
 ..;
"RTN","BPSRPT7",30,0)
 ..;Difference
"RTN","BPSRPT7",31,0)
 ..S DIFF=+$P(X,U,4)-$P(X,U,5)
"RTN","BPSRPT7",32,0)
 ..I DIFF<0 S DIFF="<"_$TR($J(-DIFF,15,2)," ")_">" W ?117,$J(DIFF,15)
"RTN","BPSRPT7",33,0)
 ..E  W ?116,$J(DIFF,15,2)
"RTN","BPSRPT7",34,0)
 ..;
"RTN","BPSRPT7",35,0)
 ..;Print Details - Excel
"RTN","BPSRPT7",36,0)
 .I BPSUMDET=0,BPEXCEL D
"RTN","BPSRPT7",37,0)
 ..;
"RTN","BPSRPT7",38,0)
 ..;Division
"RTN","BPSRPT7",39,0)
 ..W !,$S(BPDIV=0:"BLANK",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV),U
"RTN","BPSRPT7",40,0)
 ..W $$DATTIM^BPSRPT1(RDT),U  ;Date
"RTN","BPSRPT7",41,0)
 ..W +$P(X,U),U ;#Claims
"RTN","BPSRPT7",42,0)
 ..W $TR($J(+$P(X,U,2),17,2)," "),U  ;Amount Submitted
"RTN","BPSRPT7",43,0)
 ..W $TR($J(+$P(X,U,3),17,2)," "),U  ;Returned Rejected
"RTN","BPSRPT7",44,0)
 ..W $TR($J(+$P(X,U,4),17,2)," "),U  ;Returned Payable
"RTN","BPSRPT7",45,0)
 ..W $TR($J(+$P(X,U,5),17,2)," "),U  ;Amount to Receive
"RTN","BPSRPT7",46,0)
 ..;
"RTN","BPSRPT7",47,0)
 ..;Difference
"RTN","BPSRPT7",48,0)
 ..S DIFF=+$P(X,U,4)-$P(X,U,5)
"RTN","BPSRPT7",49,0)
 ..W $TR($J(DIFF,15,2)," ")
"RTN","BPSRPT7",50,0)
 .;
"RTN","BPSRPT7",51,0)
 .;Save Totals
"RTN","BPSRPT7",52,0)
 .F I=1:1:5 S $P(TOT,U,I)=$P(TOT,U,I)+$P(X,U,I),$P(GTOT,U,I)=$P($G(GTOT),U,I)+$P(X,U,I)
"RTN","BPSRPT7",53,0)
 ;
"RTN","BPSRPT7",54,0)
 ;Print Totals
"RTN","BPSRPT7",55,0)
 Q:BPEXCEL
"RTN","BPSRPT7",56,0)
 Q:BPQ  S NP=$$CHKP^BPSRPT5(2) Q:BPQ
"RTN","BPSRPT7",57,0)
 D ULINE^BPSRPT5("-")
"RTN","BPSRPT7",58,0)
 W !,"TOTALS"
"RTN","BPSRPT7",59,0)
 W ?15,$J(+$P(TOT,U),17)
"RTN","BPSRPT7",60,0)
 W ?33,$J(+$P(TOT,U,2),17,2)
"RTN","BPSRPT7",61,0)
 W ?51,$J(+$P(TOT,U,3),17,2)
"RTN","BPSRPT7",62,0)
 W ?69,$J(+$P(TOT,U,4),17,2)
"RTN","BPSRPT7",63,0)
 W ?87,$J(+$P(TOT,U,5),17,2)
"RTN","BPSRPT7",64,0)
 S X=$S((+$P(TOT,U,4))=0:0,1:(+$P(TOT,U,5))/(+$P(TOT,U,4)))
"RTN","BPSRPT7",65,0)
 S DIFF=+$P(TOT,U,4)-$P(TOT,U,5)
"RTN","BPSRPT7",66,0)
 I DIFF<0 S DIFF="<"_$TR($J(-DIFF,15,2)," ")_">" W ?117,$J(DIFF,15)
"RTN","BPSRPT7",67,0)
 E  W ?116,$J(DIFF,15,2)
"RTN","BPSRPT7",68,0)
 Q
"RTN","BPSRPT7",69,0)
 ;
"RTN","BPSRPT7",70,0)
 ;Print Grand Totals - Report 6
"RTN","BPSRPT7",71,0)
 ;
"RTN","BPSRPT7",72,0)
PGTOT6(GTOT) N DIFF,NP,X
"RTN","BPSRPT7",73,0)
 Q:BPQ  S NP=$$CHKP^BPSRPT5(2) Q:BPQ
"RTN","BPSRPT7",74,0)
 D ULINE^BPSRPT5("-")
"RTN","BPSRPT7",75,0)
 W !,"GRAND TOTALS"
"RTN","BPSRPT7",76,0)
 W ?15,$J(+$P(GTOT,U),17)
"RTN","BPSRPT7",77,0)
 W ?33,$J(+$P(GTOT,U,2),17,2)
"RTN","BPSRPT7",78,0)
 W ?51,$J(+$P(GTOT,U,3),17,2)
"RTN","BPSRPT7",79,0)
 W ?69,$J(+$P(GTOT,U,4),17,2)
"RTN","BPSRPT7",80,0)
 W ?87,$J(+$P(GTOT,U,5),17,2)
"RTN","BPSRPT7",81,0)
 S X=$S((+$P(GTOT,U,4))=0:0,1:(+$P(GTOT,U,5))/(+$P(GTOT,U,4)))
"RTN","BPSRPT7",82,0)
 S DIFF=+$P(GTOT,U,4)-$P(GTOT,U,5)
"RTN","BPSRPT7",83,0)
 I DIFF<0 S DIFF="<"_$TR($J(-DIFF,15,2)," ")_">" W ?117,$J(DIFF,15)
"RTN","BPSRPT7",84,0)
 E  W ?116,$J(DIFF,15,2)
"RTN","BPSRPT7",85,0)
 Q
"RTN","BPSRPT7",86,0)
 ;
"RTN","BPSRPT7",87,0)
 ;Print Grand Totals - Reports 1,2,3,4,5,7
"RTN","BPSRPT7",88,0)
 ;
"RTN","BPSRPT7",89,0)
PGTOT(BPRTYPE,BPGBIL,BPGINS,BPGCOLL,BPGCNT,BPGELTM) ;
"RTN","BPSRPT7",90,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT7",91,0)
 .W !!,?78,"----------",?100,"----------",?122,"----------"
"RTN","BPSRPT7",92,0)
 .W !,"GRAND TOTALS",?78,$J(BPGBIL,10,2),?100,$J(BPGINS,10,2),?122,$J(BPGCOLL,10,2)
"RTN","BPSRPT7",93,0)
 .W !,"COUNT",?78,$J(BPGCNT,10),?100,$J(BPGCNT,10),?122,$J(BPGCNT,10)
"RTN","BPSRPT7",94,0)
 .W:BPGCNT !,"MEAN",?78,$J(BPGBIL/BPGCNT,10,2),?100,$J(BPGINS/BPGCNT,10,2),?122,$J(BPGCOLL/BPGCNT,10,2)
"RTN","BPSRPT7",95,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT7",96,0)
 .W !!,?100,"----------",?122,"----------"
"RTN","BPSRPT7",97,0)
 .W !,"GRAND TOTALS",?100,$J(BPGBIL,10,2),?122,$J(BPGINS,10,2)
"RTN","BPSRPT7",98,0)
 .W !,"COUNT",?100,$J(BPGCNT,10),?122,$J(BPGCNT,10)
"RTN","BPSRPT7",99,0)
 .W:BPGCNT !,"MEAN",?100,$J(BPGBIL/BPGCNT,10,2),?122,$J(BPGINS/BPGCNT,10,2)
"RTN","BPSRPT7",100,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT7",101,0)
 .W !!,?41,"----------"
"RTN","BPSRPT7",102,0)
 .W !,"GRAND TOTALS",?41,$J(BPGBIL,10,2)
"RTN","BPSRPT7",103,0)
 .W !,"COUNT",?41,$J(BPGCNT,10)
"RTN","BPSRPT7",104,0)
 .W:BPGCNT !,"MEAN",?41,$J(BPGBIL/BPGCNT,10,2)
"RTN","BPSRPT7",105,0)
 I (BPRTYPE=5) D  Q
"RTN","BPSRPT7",106,0)
 .W !!,"GRAND TOTALS (ALL DIVISIONS)",?65,"---------------"
"RTN","BPSRPT7",107,0)
 .W !,"TOTAL CLAIMS",?65,$J(BPGCNT,15)
"RTN","BPSRPT7",108,0)
 .W !,"AVERAGE ELAPSED TIME PER CLAIM",?65,$J($S(BPGCNT=0:"0",1:(BPGELTM\BPGCNT)),15)
"RTN","BPSRPT7",109,0)
 I (BPRTYPE=7) D  Q
"RTN","BPSRPT7",110,0)
 .W !!,"GRAND TOTALS (ALL DIVISIONS) BY BILLER"
"RTN","BPSRPT7",111,0)
 .N BPBILR,BPDIV S BPDIV="ALL DIVISIONS"
"RTN","BPSRPT7",112,0)
 .S BPBILR="" F  S BPBILR=$O(BPGCNT(BPBILR)) Q:BPBILR=""  D  Q:BPQ
"RTN","BPSRPT7",113,0)
 ..S NP=$$CHKP^BPSRPT5(1) Q:BPQ
"RTN","BPSRPT7",114,0)
 ..W !,?3,BPBILR,?65,$J($G(BPGCNT(BPBILR)),5)
"RTN","BPSRPT7",115,0)
 .Q:$G(BPQ)
"RTN","BPSRPT7",116,0)
 .W !,?65,"-----"
"RTN","BPSRPT7",117,0)
 .W !,"CLOSED CLAIMS GRAND TOTAL",?65,$J(BPGCNT,5)
"RTN","BPSRPT7",118,0)
 ;
"RTN","BPSRPT7",119,0)
 Q
"RTN","BPSRPT7",120,0)
 ;
"RTN","BPSRPT7",121,0)
 ;Get Close Reason
"RTN","BPSRPT7",122,0)
 ;
"RTN","BPSRPT7",123,0)
 ; Input Variable -> BP59 = ptr to BPS TRANSACTIONS
"RTN","BPSRPT7",124,0)
 ; Returned Value -> Claim Close Reason
"RTN","BPSRPT7",125,0)
 ;
"RTN","BPSRPT7",126,0)
CLRSN(BP59) N BP02,CIEN,CL
"RTN","BPSRPT7",127,0)
 S CL=""
"RTN","BPSRPT7",128,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT7",129,0)
 S CIEN=+$P($G(^BPSC(BP02,900)),U,4)
"RTN","BPSRPT7",130,0)
 I CIEN'=0 S CL=$$GETCLR^BPSRPT6(CIEN)
"RTN","BPSRPT7",131,0)
 Q CIEN_"^"_CL
"RTN","BPSRPT7",132,0)
 ;
"RTN","BPSRPT7",133,0)
 ;Get Reversal Reason
"RTN","BPSRPT7",134,0)
 ;
"RTN","BPSRPT7",135,0)
 ; Input Variable -> BP59 = ptr to BPS TRANSACTIONS
"RTN","BPSRPT7",136,0)
 ; Returned Value -> Claim Reversal Reason
"RTN","BPSRPT7",137,0)
 ;
"RTN","BPSRPT7",138,0)
RVSRSN(BP59) Q $P($G(^BPST(BP59,4)),U,4)
"RTN","BPSRPT7",139,0)
 ;
"RTN","BPSRPT7",140,0)
 ;Return the Billed Amount
"RTN","BPSRPT7",141,0)
 ;
"RTN","BPSRPT7",142,0)
BILLED(BP59) ;
"RTN","BPSRPT7",143,0)
 Q +$P($G(^BPST(BP59,5)),U,5)
"RTN","BPSRPT7",144,0)
 ;
"RTN","BPSRPT7",145,0)
 ;Return the Transaction Type - SUBMIT or REVERSAL
"RTN","BPSRPT7",146,0)
 ;
"RTN","BPSRPT7",147,0)
TTYPE(BPRX,BPREF) N BPSTATUS,TTYPE
"RTN","BPSRPT7",148,0)
 S TTYPE="SUBMIT"
"RTN","BPSRPT7",149,0)
 S BPSTATUS=$$STATUS^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT7",150,0)
 I BPSTATUS["REVERSAL" S TTYPE="REVERSAL"
"RTN","BPSRPT7",151,0)
 Q TTYPE
"RTN","BPSRPT7",152,0)
 ;
"RTN","BPSRPT7",153,0)
 ;Return the payer response
"RTN","BPSRPT7",154,0)
 ;
"RTN","BPSRPT7",155,0)
RESPONSE(BPRX,BPREF) Q $P($$STATUS^BPSRPT6(BPRX,BPREF),U)
"RTN","BPSRPT7",156,0)
 ;
"RTN","BPSRPT7",157,0)
 ;Print Report Subtotals
"RTN","BPSRPT7",158,0)
 ;
"RTN","BPSRPT7",159,0)
TOTALS(BPRTYPE,BPDIV,BPTBIL,BPTINS,BPTCOLL,BPCNT,BPELTM) ;
"RTN","BPSRPT7",160,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT7",161,0)
 .W !!,?78,"----------",?100,"----------",?122,"----------"
"RTN","BPSRPT7",162,0)
 .W !,"SUBTOTALS",?78,$J(BPTBIL,10,2),?100,$J(BPTINS,10,2),?122,$J(BPTCOLL,10,2)
"RTN","BPSRPT7",163,0)
 .W !,"COUNT",?78,$J(BPCNT,10),?100,$J(BPCNT,10),?122,$J(BPCNT,10)
"RTN","BPSRPT7",164,0)
 .W:BPCNT !,"MEAN",?78,$J(BPTBIL/BPCNT,10,2),?100,$J(BPTINS/BPCNT,10,2),?122,$J(BPTCOLL/BPCNT,10,2)
"RTN","BPSRPT7",165,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT7",166,0)
 .W !!,?100,"----------",?122,"----------"
"RTN","BPSRPT7",167,0)
 .W !,"SUBTOTALS",?100,$J(BPTBIL,10,2),?122,$J(BPTINS,10,2)
"RTN","BPSRPT7",168,0)
 .W !,"COUNT",?100,$J(BPCNT,10),?122,$J(BPCNT,10)
"RTN","BPSRPT7",169,0)
 .W:BPCNT !,"MEAN",?100,$J(BPTBIL/BPCNT,10,2),?122,$J(BPTINS/BPCNT,10,2)
"RTN","BPSRPT7",170,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT7",171,0)
 .W !!,?41,"----------"
"RTN","BPSRPT7",172,0)
 .W !,"SUBTOTALS",?41,$J(BPTBIL,10,2)
"RTN","BPSRPT7",173,0)
 .W !,"COUNT",?41,$J(BPCNT,10)
"RTN","BPSRPT7",174,0)
 .W:BPCNT !,"MEAN",?41,$J(BPTBIL/BPCNT,10,2)
"RTN","BPSRPT7",175,0)
 I (BPRTYPE=5) D  Q
"RTN","BPSRPT7",176,0)
 .W !!,"SUBTOTALS FOR DIVISION: ",$E($S(BPDIV=0:"BLANK",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV),1,43),?65,"---------------"
"RTN","BPSRPT7",177,0)
 .W !,"TOTAL CLAIMS",?65,$J(BPCNT,15)
"RTN","BPSRPT7",178,0)
 .W !,"AVERAGE ELAPSED TIME PER CLAIM",?65,$J($S(BPCNT=0:"0",1:(BPELTM\BPCNT)),15)
"RTN","BPSRPT7",179,0)
 I (BPRTYPE=7) D  Q
"RTN","BPSRPT7",180,0)
 .W !!,"SUBTOTALS (BY BILLER) FOR DIVISION: ",$E($S(BPDIV=0:"BLANK",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV),1,43)
"RTN","BPSRPT7",181,0)
 .N BPBILR
"RTN","BPSRPT7",182,0)
 .S BPBILR="" F  S BPBILR=$O(BPCNT(BPBILR)) Q:BPBILR=""  D  Q:BPQ
"RTN","BPSRPT7",183,0)
 ..S NP=$$CHKP^BPSRPT5(1) Q:BPQ
"RTN","BPSRPT7",184,0)
 ..W !,?3,BPBILR,?65,$J($G(BPCNT(BPBILR)),5)
"RTN","BPSRPT7",185,0)
 .Q:$G(BPQ)
"RTN","BPSRPT7",186,0)
 .W !,?65,"-----"
"RTN","BPSRPT7",187,0)
 .W !,"CLOSED CLAIMS SUBTOTAL",?65,$J(BPCNT,5)
"RTN","BPSRPT7",188,0)
 ;
"RTN","BPSRPT7",189,0)
 Q
"RTN","BPSRPT7",190,0)
 ;
"RTN","BPSRPT7",191,0)
 ;Print Report Header
"RTN","BPSRPT7",192,0)
 ; Input variables (defined in BPSRPT0) - BPPHARM,BPSUMDET,BPNOW,BPMWC,BPRTBCK,BPINSINF
"RTN","BPSRPT7",193,0)
 ;                                        BPREJCD,BPCCRSN,BPAUTREV,BPACREJ,BPQSTDRG
"RTN","BPSRPT7",194,0)
 ;                                        BPDRUG,BPDRGCL,BPRLNRL,BPSORT,BPBEGDT,BPENDDT
"RTN","BPSRPT7",195,0)
 ; Output variable - BPSDATA -> Reset to 0 to show no actual data has been printed
"RTN","BPSRPT7",196,0)
 ;                           on the screen
"RTN","BPSRPT7",197,0)
 ;                   BPPAGE -> First set in BPSRPT0
"RTN","BPSRPT7",198,0)
 ;                   BPBLINE -> Controls whether to print a blank line
"RTN","BPSRPT7",199,0)
 ;                   
"RTN","BPSRPT7",200,0)
HDR(BPRTYPE,BPRPTNAM,BPPAGE) ;
"RTN","BPSRPT7",201,0)
 ;Display Excel Header
"RTN","BPSRPT7",202,0)
 I BPEXCEL D HDR^BPSRPT8(BPRTYPE) Q
"RTN","BPSRPT7",203,0)
 ;
"RTN","BPSRPT7",204,0)
 ; Define BPPDATA - Tells whether data has been displayed for a screen
"RTN","BPSRPT7",205,0)
 S BPSDATA=0
"RTN","BPSRPT7",206,0)
 S BPBLINE=""
"RTN","BPSRPT7",207,0)
 S BPPAGE=$G(BPPAGE)+1
"RTN","BPSRPT7",208,0)
 W @IOF
"RTN","BPSRPT7",209,0)
 W "ECME "_BPRPTNAM_" "_$S(BPSUMDET=1:"SUMMARY",1:"DETAIL")_" REPORT"
"RTN","BPSRPT7",210,0)
 W ?89,"Print Date: "_$G(BPNOW)_"  Page:",$J(BPPAGE,3)
"RTN","BPSRPT7",211,0)
 W !,"DIVISION(S): ",$$GETDIVS^BPSRPT4(75,.BPPHARM)
"RTN","BPSRPT7",212,0)
 W ?93,"Fill Locations: "_$S(BPMWC=2:"M",BPMWC=3:"W",BPMWC=4:"C",1:"C,M,W")
"RTN","BPSRPT7",213,0)
 W ?116,"Fill type: "_$S(BPRTBCK=2:"RT",BPRTBCK=3:"BB",1:"RT,BB")
"RTN","BPSRPT7",214,0)
 W !,"Insurance: "_$E($S(BPINSINF=0:"ALL",1:BPINSINF),1,30)
"RTN","BPSRPT7",215,0)
 I (",2,")[BPRTYPE W ?44,"Reject Code: ",$E($$GETREJ^BPSRPT4(BPREJCD),1,28)
"RTN","BPSRPT7",216,0)
 I (",7,")[BPRTYPE W ?44,"Close Reason: ",$E($$GETCLR^BPSRPT6(BPCCRSN),1,26)
"RTN","BPSRPT7",217,0)
 I (",4,")[BPRTYPE W ?44,$J($S(BPAUTREV=0:"ALL",1:"AUTO"),4)," Reversals"
"RTN","BPSRPT7",218,0)
 I (",4,")[BPRTYPE W ?60,$J($S(BPACREJ=1:"REJECTED",BPACREJ=2:"ACCEPTED",1:"ALL"),8)," Returned Status"
"RTN","BPSRPT7",219,0)
 W ?87,"Drugs/Classes: "_$S(BPQSTDRG=2:$$DRGNAM^BPSRPT6(BPDRUG,30),BPQSTDRG=3:$E(BPDRGCL,1,30),1:"ALL")
"RTN","BPSRPT7",220,0)
 W !,$S(BPRTYPE=5:"PRESCRIPTIONS",BPRLNRL=2:"RELEASED PRESCRIPTIONS",BPRLNRL=3:"PRESCRIPTIONS (NOT RELEASED)",1:"ALL PRESCRIPTIONS")
"RTN","BPSRPT7",221,0)
 W " BY "_$S(BPRTYPE=7:"CLOSE",1:"TRANSACTION")_" DATE: "
"RTN","BPSRPT7",222,0)
 W "From "_$$DATTIM^BPSRPT1(BPBEGDT)_" through "_$$DATTIM^BPSRPT1($P(BPENDDT,"."))
"RTN","BPSRPT7",223,0)
 ;
"RTN","BPSRPT7",224,0)
 D ULINE^BPSRPT5("=") Q:$G(BPQ)
"RTN","BPSRPT7",225,0)
 D HEADLN1^BPSRPT4(BPRTYPE)
"RTN","BPSRPT7",226,0)
 D HEADLN2^BPSRPT4(BPRTYPE)
"RTN","BPSRPT7",227,0)
 D HEADLN3^BPSRPT4(BPRTYPE)
"RTN","BPSRPT7",228,0)
 D ULINE^BPSRPT5("=")
"RTN","BPSRPT7",229,0)
 ;
"RTN","BPSRPT7",230,0)
 ;Print Division
"RTN","BPSRPT7",231,0)
 I $G(BPDIV)]"" D
"RTN","BPSRPT7",232,0)
 .W !,"DIVISION: ",$S(BPDIV=0:"BLANK",BPDIV="ALL DIVISIONS":"ALL DIVISIONS",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV)
"RTN","BPSRPT7",233,0)
 .I BPRTYPE=5!(BPRTYPE=6)!(BPSUMDET=1)!(BPGRPLAN="") D ULINE^BPSRPT5("-")
"RTN","BPSRPT7",234,0)
 ;
"RTN","BPSRPT7",235,0)
 ;Print Insurance If Defined
"RTN","BPSRPT7",236,0)
 I BPSUMDET=0,$G(BPGRPLAN)]"",$G(BPGRPLAN)'=0,$G(BPGRPLAN)'="~" D WRPLAN^BPSRPT5(BPGRPLAN)
"RTN","BPSRPT7",237,0)
 Q
"RTN","BPSRPT8")
0^365^B54566522
"RTN","BPSRPT8",1,0)
BPSRPT8 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRPT8",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRPT8",4,0)
 ;
"RTN","BPSRPT8",5,0)
 Q
"RTN","BPSRPT8",6,0)
 ;
"RTN","BPSRPT8",7,0)
 ;Routine to Display the Reports in Excel
"RTN","BPSRPT8",8,0)
 ;
"RTN","BPSRPT8",9,0)
 ;Print Report Line 1
"RTN","BPSRPT8",10,0)
 ;
"RTN","BPSRPT8",11,0)
 ; Input Variable -> BPRTYPE,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT
"RTN","BPSRPT8",12,0)
 ;                   BPBIL,BPINS,BPCOLL
"RTN","BPSRPT8",13,0)
 ; 
"RTN","BPSRPT8",14,0)
WRLINE1(BPRTYPE,BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL) ;
"RTN","BPSRPT8",15,0)
 ;
"RTN","BPSRPT8",16,0)
 ;Division
"RTN","BPSRPT8",17,0)
 S BPREC=$S(BPDIV=0:"BLANK",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV)_U
"RTN","BPSRPT8",18,0)
 ;Insurance
"RTN","BPSRPT8",19,0)
 I BPRTYPE'=5,BPRTYPE'=6 S BPREC=BPREC_$E(BPGRPLAN,1,90)_U
"RTN","BPSRPT8",20,0)
 S BPREC=BPREC_$$PATNAME^BPSRPT6(BPDFN)_U  ;Patient Name
"RTN","BPSRPT8",21,0)
 S BPREC=BPREC_"("_$$SSN4^BPSRPT6(BPDFN)_")"_U ;L4SSN
"RTN","BPSRPT8",22,0)
 S BPREC=BPREC_$$RXNUM^BPSRPT6(BPRX)_$$COPAY^BPSRPT6(BPRX)_U ;RX Number
"RTN","BPSRPT8",23,0)
 S BPREC=BPREC_BPREF_"/"_$$ECMENUM^BPSRPT1($P(BPX,U,3))_U ;Refill/ECME Number
"RTN","BPSRPT8",24,0)
 ;
"RTN","BPSRPT8",25,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT8",26,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(BPSRTDT)_U  ;Date
"RTN","BPSRPT8",27,0)
 . S BPREC=BPREC_$TR($J(BPBIL,10,2)," ")_U ;$Billed
"RTN","BPSRPT8",28,0)
 . S BPREC=BPREC_$TR($J(BPINS,10,2)," ")_U ;$Ins. Paid
"RTN","BPSRPT8",29,0)
 . S BPREC=BPREC_$S(BPCOLL]"":$TR($J(BPCOLL,10,2)," "),1:"")_U ;$Collected
"RTN","BPSRPT8",30,0)
 ;
"RTN","BPSRPT8",31,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT8",32,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(BPSRTDT)_U ;Date
"RTN","BPSRPT8",33,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(+BPX)_U  ;Released On
"RTN","BPSRPT8",34,0)
 . ;RX INFO
"RTN","BPSRPT8",35,0)
 . S BPREC=BPREC_$$MWCNAM^BPSRPT1($$MWC^BPSRPT6(BPRX,BPREF))_U ;Fill Location
"RTN","BPSRPT8",36,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U  ;Fill Type
"RTN","BPSRPT8",37,0)
 . S BPREC=BPREC_$$RXSTANAM^BPSRPT2($$RXSTATUS^BPSRPT6(BPRX,0)) ;Status
"RTN","BPSRPT8",38,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",39,0)
 ;
"RTN","BPSRPT8",40,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT8",41,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(BPSRTDT)_U ;Date
"RTN","BPSRPT8",42,0)
 . S BPREC=BPREC_$TR($J(BPBIL,10,2)," ")_U ;$Billed
"RTN","BPSRPT8",43,0)
 . S BPREC=BPREC_$TR($J(BPINS,10,2)," ")_U ;Insurance Response
"RTN","BPSRPT8",44,0)
 ;
"RTN","BPSRPT8",45,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT8",46,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1($$TRANDT^BPSRPT2($P(BPX,U,3),1))_U ;Completed
"RTN","BPSRPT8",47,0)
 . S BPREC=BPREC_$$TTYPE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))_U ;Trans Type
"RTN","BPSRPT8",48,0)
 . S BPREC=BPREC_$$RESPONSE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))_U ;Payer Response
"RTN","BPSRPT8",49,0)
 ;
"RTN","BPSRPT8",50,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT8",51,0)
 . ;RX INFO
"RTN","BPSRPT8",52,0)
 . S BPREC=BPREC_$$MWCNAM^BPSRPT1($$MWC^BPSRPT6(BPRX,BPREF))_U ;Fill Location
"RTN","BPSRPT8",53,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",54,0)
 . S BPREC=BPREC_$$RXSTANAM^BPSRPT2($$RXSTATUS^BPSRPT6(BPRX,0)) ;Status
"RTN","BPSRPT8",55,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",56,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")_U
"RTN","BPSRPT8",57,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",58,0)
 Q
"RTN","BPSRPT8",59,0)
 ;
"RTN","BPSRPT8",60,0)
 ;Print Report Line 2
"RTN","BPSRPT8",61,0)
 ;
"RTN","BPSRPT8",62,0)
 ; Input Variable -> BPRTYPE,BPX,BPRX,BPREF,BPBIL,BPGRPLAN
"RTN","BPSRPT8",63,0)
 ; 
"RTN","BPSRPT8",64,0)
WRLINE2(BPRTYPE,BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN) ;
"RTN","BPSRPT8",65,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT8",66,0)
 . ;Drug, Released On
"RTN","BPSRPT8",67,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U_$$DATTIM^BPSRPT1(+BPX)_U
"RTN","BPSRPT8",68,0)
 . ;RX INFO
"RTN","BPSRPT8",69,0)
 . S BPREC=BPREC_$$MWCNAM^BPSRPT1($$MWC^BPSRPT6(BPRX,BPREF))_U ;Fill Location
"RTN","BPSRPT8",70,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",71,0)
 . S BPREC=BPREC_$$RXSTANAM^BPSRPT2($$RXSTATUS^BPSRPT6(BPRX,0)) ;Status
"RTN","BPSRPT8",72,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",73,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT8",74,0)
 . I BPRTYPE=1 S BPREC=BPREC_U_$$BILL^BPSRPT6(BPRX,BPREF) ;Bill #
"RTN","BPSRPT8",75,0)
 ;
"RTN","BPSRPT8",76,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT8",77,0)
 . S BPREC=BPREC_$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)_U ;Cardholder ID
"RTN","BPSRPT8",78,0)
 . S BPREC=BPREC_$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)_U ;Group ID
"RTN","BPSRPT8",79,0)
 . S BPREC=BPREC_$TR($J(BPBIL,10,2)," ")_U ;$Billed
"RTN","BPSRPT8",80,0)
 . S BPREC=BPREC_$$QTY^BPSRPT6(BPRX,BPREF)_U ;Qty
"RTN","BPSRPT8",81,0)
 . S BPREC=BPREC_$$GETNDC^BPSRPT6(BPRX,BPREF)_U ;NDC#
"RTN","BPSRPT8",82,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",83,0)
 ;
"RTN","BPSRPT8",84,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT8",85,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",86,0)
 . ;RX INFO
"RTN","BPSRPT8",87,0)
 . S BPREC=BPREC_$$MWCNAM^BPSRPT1($$MWC^BPSRPT6(BPRX,BPREF))_U ;Fill Location
"RTN","BPSRPT8",88,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",89,0)
 . S BPREC=BPREC_$$RXSTANAM^BPSRPT2($$RXSTATUS^BPSRPT6(BPRX,0)) ;Status
"RTN","BPSRPT8",90,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",91,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT8",92,0)
 ;
"RTN","BPSRPT8",93,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT8",94,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",95,0)
 . ;RX INFO
"RTN","BPSRPT8",96,0)
 . S BPREC=BPREC_$$MWCNAM^BPSRPT1($$MWC^BPSRPT6(BPRX,BPREF))_U ;Fill Location
"RTN","BPSRPT8",97,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",98,0)
 . S BPREC=BPREC_$$RXSTANAM^BPSRPT2($$RXSTATUS^BPSRPT6(BPRX,0))  ;Status
"RTN","BPSRPT8",99,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",100,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")_U
"RTN","BPSRPT8",101,0)
 . I $P(BPGRPLAN,U,2)]"" S BPREC=BPREC_$E($P(BPGRPLAN,U,2),1,30) ;Insurance
"RTN","BPSRPT8",102,0)
 . S BPREC=BPREC_U_$$ELAPSE^BPSRPT6($P(BPX,U,3))  ;Elapsed Time
"RTN","BPSRPT8",103,0)
 ;
"RTN","BPSRPT8",104,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT8",105,0)
 . S BPREC=BPREC_$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)_U ;Cardholder ID
"RTN","BPSRPT8",106,0)
 . S BPREC=BPREC_$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)_U  ;Group ID
"RTN","BPSRPT8",107,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(+$$CLOSEDT^BPSRPT2(+$P(BPX,U,3)))_U ;Close Dt/Time
"RTN","BPSRPT8",108,0)
 . S BPREC=BPREC_$E($$CLSBY^BPSRPT6(+$P(BPX,U,3)),1,25)_U ;Close By
"RTN","BPSRPT8",109,0)
 . S BPREC=BPREC_$E($P($$CLRSN^BPSRPT7(+$P(BPX,U,3)),U,2),1,30)_U ;Close Reason
"RTN","BPSRPT8",110,0)
 Q
"RTN","BPSRPT8",111,0)
 ;
"RTN","BPSRPT8",112,0)
 ;Print Report Line 3
"RTN","BPSRPT8",113,0)
 ;
"RTN","BPSRPT8",114,0)
 ; Input Variable -> BPRTYPE,BPX
"RTN","BPSRPT8",115,0)
 ; 
"RTN","BPSRPT8",116,0)
WRLINE3(BPRTYPE,BPREC,BPX) N BP59,BPSARR,BPRJCNT,BPZZ
"RTN","BPSRPT8",117,0)
 S BP59=+$P(BPX,U,3)
"RTN","BPSRPT8",118,0)
 ;
"RTN","BPSRPT8",119,0)
 I (",2,7,")[BPRTYPE D  Q
"RTN","BPSRPT8",120,0)
 .S BPREC=BPREC_$$CLAIMID^BPSRPT2(BP59)_U ;Claim ID
"RTN","BPSRPT8",121,0)
 .S BPRJCNT=$$REJTEXT^BPSRPT2(BP59,.BPSARR)
"RTN","BPSRPT8",122,0)
 .F BPZZ=1:1:BPRJCNT S:BPZZ'=1 BPREC=BPREC_"," S BPREC=BPREC_$P(BPSARR(BPZZ),":")
"RTN","BPSRPT8",123,0)
 .;
"RTN","BPSRPT8",124,0)
 .;Write one record per reject/close code
"RTN","BPSRPT8",125,0)
 .F BPZZ=1:1:BPRJCNT W !,$G(BPREC),U,$P(BPSARR(BPZZ),":"),U,$P(BPSARR(BPZZ),":",2)
"RTN","BPSRPT8",126,0)
 ;
"RTN","BPSRPT8",127,0)
 I BPRTYPE=4 D
"RTN","BPSRPT8",128,0)
 . ;Method
"RTN","BPSRPT8",129,0)
 . I $$AUTOREV^BPSRPT1(BP59) S BPREC=BPREC_U_"AUTO"_U
"RTN","BPSRPT8",130,0)
 . E  S BPREC=BPREC_U_"REGULAR"_U
"RTN","BPSRPT8",131,0)
 . ;Return Status
"RTN","BPSRPT8",132,0)
 . I $P(BPX,U,15)["ACCEPTED" S BPREC=BPREC_"ACCEPTED"_U
"RTN","BPSRPT8",133,0)
 . E  S BPREC=BPREC_"REJECTED"_U
"RTN","BPSRPT8",134,0)
 . ;Reason
"RTN","BPSRPT8",135,0)
 . S BPREC=BPREC_$$RVSRSN^BPSRPT7(+$P(BPX,U,3))
"RTN","BPSRPT8",136,0)
 ;
"RTN","BPSRPT8",137,0)
 ;Write the record
"RTN","BPSRPT8",138,0)
 W !,$G(BPREC)
"RTN","BPSRPT8",139,0)
 Q
"RTN","BPSRPT8",140,0)
 ;
"RTN","BPSRPT8",141,0)
 ;Print Excel Header
"RTN","BPSRPT8",142,0)
 ;
"RTN","BPSRPT8",143,0)
HDR(BPRTYPE) ;
"RTN","BPSRPT8",144,0)
 ;
"RTN","BPSRPT8",145,0)
 ;Check if header already printed
"RTN","BPSRPT8",146,0)
 I $G(BPSDATA) Q
"RTN","BPSRPT8",147,0)
 S BPSDATA=1
"RTN","BPSRPT8",148,0)
 ;
"RTN","BPSRPT8",149,0)
 ;Division
"RTN","BPSRPT8",150,0)
 W !,"DIVISION",U
"RTN","BPSRPT8",151,0)
 ;
"RTN","BPSRPT8",152,0)
 I BPRTYPE'=5,BPRTYPE'=6 W "INSURANCE",U
"RTN","BPSRPT8",153,0)
 ;
"RTN","BPSRPT8",154,0)
 I (",1,2,3,4,5,7,")[BPRTYPE W "PATIENT NAME",U,"Pt.ID",U,"RX#",U,"REF/ECME#",U
"RTN","BPSRPT8",155,0)
 ;
"RTN","BPSRPT8",156,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT8",157,0)
 . W "DATE",U
"RTN","BPSRPT8",158,0)
 . W "$BILLED",U
"RTN","BPSRPT8",159,0)
 . W "$INS RESPONSE",U
"RTN","BPSRPT8",160,0)
 . W "$COLLECT",U
"RTN","BPSRPT8",161,0)
 . W "DRUG",U
"RTN","BPSRPT8",162,0)
 . W "RELEASED ON",U
"RTN","BPSRPT8",163,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",164,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",165,0)
 . W "STATUS",U
"RTN","BPSRPT8",166,0)
 . W "REJECTED"
"RTN","BPSRPT8",167,0)
 . I BPRTYPE=1 W U,"BILL#"
"RTN","BPSRPT8",168,0)
 . I BPRTYPE=4 W U,"REVERSAL METHOD",U,"RETURN STATUS",U,"REASON"
"RTN","BPSRPT8",169,0)
 ;
"RTN","BPSRPT8",170,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT8",171,0)
 . W "DATE",U
"RTN","BPSRPT8",172,0)
 . W "RELEASED ON",U
"RTN","BPSRPT8",173,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",174,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",175,0)
 . W "STATUS",U
"RTN","BPSRPT8",176,0)
 . W "CARDHOLD.ID",U
"RTN","BPSRPT8",177,0)
 . W "GROUP ID",U
"RTN","BPSRPT8",178,0)
 . W "$BILLED",U
"RTN","BPSRPT8",179,0)
 . W "QTY",U
"RTN","BPSRPT8",180,0)
 . W "NDC#",U
"RTN","BPSRPT8",181,0)
 . W "DRUG",U
"RTN","BPSRPT8",182,0)
 . W "CLAIM ID",U
"RTN","BPSRPT8",183,0)
 . W "REJECT CODE(S)",U
"RTN","BPSRPT8",184,0)
 . W "REJECT CODE",U
"RTN","BPSRPT8",185,0)
 . W "REJECT EXPLANATION"
"RTN","BPSRPT8",186,0)
 ;
"RTN","BPSRPT8",187,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT8",188,0)
 . W "DATE",U
"RTN","BPSRPT8",189,0)
 . W "$BILLED",U
"RTN","BPSRPT8",190,0)
 . W "$INS RESPONSE",U
"RTN","BPSRPT8",191,0)
 . W "DRUG",U
"RTN","BPSRPT8",192,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",193,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",194,0)
 . W "STATUS",U
"RTN","BPSRPT8",195,0)
 . W "REJECTED"
"RTN","BPSRPT8",196,0)
 ;
"RTN","BPSRPT8",197,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT8",198,0)
 . W "COMPLETED",U
"RTN","BPSRPT8",199,0)
 . W "TRANS TYPE",U
"RTN","BPSRPT8",200,0)
 . W "PAYER RESPONSE",U
"RTN","BPSRPT8",201,0)
 . W "DRUG",U
"RTN","BPSRPT8",202,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",203,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",204,0)
 . W "STATUS",U
"RTN","BPSRPT8",205,0)
 . W "REJECTED",U
"RTN","BPSRPT8",206,0)
 . W "INSURANCE",U
"RTN","BPSRPT8",207,0)
 . W "ELAP TIME IN SECONDS"
"RTN","BPSRPT8",208,0)
 ;
"RTN","BPSRPT8",209,0)
 I BPRTYPE=6 D  Q
"RTN","BPSRPT8",210,0)
 .W "DATE",U
"RTN","BPSRPT8",211,0)
 .W "#CLAIMS",U
"RTN","BPSRPT8",212,0)
 .W "AMOUNT SUBMITTED",U
"RTN","BPSRPT8",213,0)
 .W "RETURNED REJECTED",U
"RTN","BPSRPT8",214,0)
 .W "RETURNED PAYABLE",U
"RTN","BPSRPT8",215,0)
 .W "AMOUNT TO RECEIVE",U
"RTN","BPSRPT8",216,0)
 .W "DIFFERENCE"
"RTN","BPSRPT8",217,0)
 ;
"RTN","BPSRPT8",218,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT8",219,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",220,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",221,0)
 . W "STATUS",U
"RTN","BPSRPT8",222,0)
 . W "REJECTED",U
"RTN","BPSRPT8",223,0)
 . W "DRUG",U
"RTN","BPSRPT8",224,0)
 . W "CARDHOLD.ID",U
"RTN","BPSRPT8",225,0)
 . W "GROUP ID",U
"RTN","BPSRPT8",226,0)
 . W "CLOSE DATE/TIME",U
"RTN","BPSRPT8",227,0)
 . W "CLOSED BY",U
"RTN","BPSRPT8",228,0)
 . W "CLOSE REASON",U
"RTN","BPSRPT8",229,0)
 . W "CLAIM ID",U
"RTN","BPSRPT8",230,0)
 . W "REJECT CODE(S)",U
"RTN","BPSRPT8",231,0)
 . W "REJECT CODE",U
"RTN","BPSRPT8",232,0)
 . W "REJECT EXPLANATION"
"RTN","BPSRPT8",233,0)
 Q
"RTN","BPSRREV")
0^304^B11230489
"RTN","BPSRREV",1,0)
BPSRREV ;BHAM ISC/DMB - Erroneous Reversals Report ;2004-03-01
"RTN","BPSRREV",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRREV",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRREV",4,0)
 ;
"RTN","BPSRREV",5,0)
 ; If calling from the M shell, check for kernel variables
"RTN","BPSRREV",6,0)
 I '$D(DUZ) W !,"Fileman Kernel variables need to be defined!" Q
"RTN","BPSRREV",7,0)
 ;
"RTN","BPSRREV",8,0)
 N BPQ,BPSCR
"RTN","BPSRREV",9,0)
 K ^TMP("BPSRREV",$J)
"RTN","BPSRREV",10,0)
 ;
"RTN","BPSRREV",11,0)
 ; Device Selection
"RTN","BPSRREV",12,0)
 I $D(IOF) W @IOF
"RTN","BPSRREV",13,0)
 W !,"Possible Erroneous Reversals Report",!!
"RTN","BPSRREV",14,0)
 I $$DEVICE=-1 Q
"RTN","BPSRREV",15,0)
 ;
"RTN","BPSRREV",16,0)
 ; Get Data and Display
"RTN","BPSRREV",17,0)
 D RUN
"RTN","BPSRREV",18,0)
 ;
"RTN","BPSRREV",19,0)
 Q
"RTN","BPSRREV",20,0)
 ;
"RTN","BPSRREV",21,0)
RUN ; Compile and Display Data
"RTN","BPSRREV",22,0)
 N BPQ,BPPAGE,BPSY,N,N1,X,LOGDTTM,LOGDT,FL,DFN,PAT,RX,RXNM,Y,%DT
"RTN","BPSRREV",23,0)
 ;
"RTN","BPSRREV",24,0)
 ; Compile Data
"RTN","BPSRREV",25,0)
 I BPSCR U IO(0) W !,"Compiling, please wait..." U IO
"RTN","BPSRREV",26,0)
 ;
"RTN","BPSRREV",27,0)
 ; Get Transactions 
"RTN","BPSRREV",28,0)
 S N="" F  S N=$O(^BPSECP("LOG",N)) Q:N=""  D
"RTN","BPSRREV",29,0)
 . S LOGDT=""
"RTN","BPSRREV",30,0)
 . S N1="" F  S N1=$O(^BPSECP("LOG",N,N1)) Q:N1=""  D
"RTN","BPSRREV",31,0)
 .. S X=$G(^BPSECP("LOG",N,N1))
"RTN","BPSRREV",32,0)
 .. ; Get most recent Log Date
"RTN","BPSRREV",33,0)
 .. I X["Log Time Stamp" D
"RTN","BPSRREV",34,0)
 ... I X["Log Time Stamp " S LOGDTTM=$P($P(X,"Log Time Stamp ",2)," ",1,2)
"RTN","BPSRREV",35,0)
 ... E  S LOGDTTM=$P($P(X,"Log Time Stamp",2)," ",1,2)
"RTN","BPSRREV",36,0)
 ... S X=$P(LOGDTTM,"@",1),%DT="X" D ^%DT
"RTN","BPSRREV",37,0)
 ... S LOGDT=Y
"RTN","BPSRREV",38,0)
 .. ; This is the log entry we want
"RTN","BPSRREV",39,0)
 .. I X'["BEFORE BUILD-AFTER SUBMIT-REVERSE ONLY" Q
"RTN","BPSRREV",40,0)
 .. I LOGDT<3050301 Q
"RTN","BPSRREV",41,0)
 .. S ^TMP("BPSRREV",$J,N,N1)=LOGDTTM
"RTN","BPSRREV",42,0)
 ;
"RTN","BPSRREV",43,0)
 ; Display Header
"RTN","BPSRREV",44,0)
 S BPQ=0,BPPAGE=0
"RTN","BPSRREV",45,0)
 D HDR
"RTN","BPSRREV",46,0)
 ;
"RTN","BPSRREV",47,0)
 ; Display Data
"RTN","BPSRREV",48,0)
 S N="" F  S N=$O(^TMP("BPSRREV",$J,N)) Q:N=""  D  I BPQ Q
"RTN","BPSRREV",49,0)
 . S FL=0
"RTN","BPSRREV",50,0)
 . S N1="" F  S N1=$O(^TMP("BPSRREV",$J,N,N1)) Q:N1=""  D  I BPQ Q
"RTN","BPSRREV",51,0)
 .. S LOGDT=$G(^TMP("BPSRREV",$J,N,N1))
"RTN","BPSRREV",52,0)
 .. I BPSY+3>IOSL D:BPSCR PAUSE Q:BPQ  D HDR
"RTN","BPSRREV",53,0)
 .. S BPSY=BPSY+1
"RTN","BPSRREV",54,0)
 .. I FL=0 W N S FL=1
"RTN","BPSRREV",55,0)
 .. S DFN=$P($G(^BPST(N,0)),U,6),RX=$P($G(^BPST(N,1)),U,11)
"RTN","BPSRREV",56,0)
 .. I DFN S PAT=$P($G(^DPT(DFN,0)),U,1)
"RTN","BPSRREV",57,0)
 .. E  S PAT=""
"RTN","BPSRREV",58,0)
 .. I RX S RXNM=$P($G(^PSRX(RX,0)),U,1)
"RTN","BPSRREV",59,0)
 .. E  S RXNM=""
"RTN","BPSRREV",60,0)
 .. W ?15,LOGDT,?37,RXNM,?50,$E(PAT,1,30),!
"RTN","BPSRREV",61,0)
 ; Finish display and close device
"RTN","BPSRREV",62,0)
 I 'BPSCR W !,@IOF
"RTN","BPSRREV",63,0)
 E  I 'BPQ D PAUSE2
"RTN","BPSRREV",64,0)
 D ^%ZISC
"RTN","BPSRREV",65,0)
 Q
"RTN","BPSRREV",66,0)
 ;
"RTN","BPSRREV",67,0)
DEVICE() ; Select a device and queue if needed
"RTN","BPSRREV",68,0)
 N %ZIS,ZTSK,ZTRTN,ZTIO,ZTSAVE,ZTDESC,POP,BPQ
"RTN","BPSRREV",69,0)
 S BPQ=0
"RTN","BPSRREV",70,0)
 S %ZIS="QM"
"RTN","BPSRREV",71,0)
 W ! D ^%ZIS
"RTN","BPSRREV",72,0)
 I POP Q -1
"RTN","BPSRREV",73,0)
 S BPSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSRREV",74,0)
 I $D(IO("Q")) D  S BPQ=-1
"RTN","BPSRREV",75,0)
 . S ZTRTN="RUN^BPSRREV"
"RTN","BPSRREV",76,0)
 . S ZTIO=ION
"RTN","BPSRREV",77,0)
 . S ZTSAVE("BP*")=""
"RTN","BPSRREV",78,0)
 . S ZTDESC="BPS ERRONEOUS REVERSALS RPT"
"RTN","BPSRREV",79,0)
 . D ^%ZTLOAD
"RTN","BPSRREV",80,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","BPSRREV",81,0)
 . D HOME^%ZIS
"RTN","BPSRREV",82,0)
 U IO
"RTN","BPSRREV",83,0)
 Q BPQ
"RTN","BPSRREV",84,0)
 ;
"RTN","BPSRREV",85,0)
HDR ;
"RTN","BPSRREV",86,0)
 W @IOF
"RTN","BPSRREV",87,0)
 S BPPAGE=BPPAGE+1
"RTN","BPSRREV",88,0)
 W "Possible Errorneous Reversals Report"
"RTN","BPSRREV",89,0)
 W ?45,"Print Date: "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","BPSRREV",90,0)
 W "  Page:",$J(BPPAGE,3)
"RTN","BPSRREV",91,0)
 ; Display subheaders
"RTN","BPSRREV",92,0)
 W !!,"Transaction #",?15,"Log Date",?37,"RX",?50,"Patient Name"
"RTN","BPSRREV",93,0)
 W !,"-------------",?15,"--------",?37,"--",?50,"------------",!
"RTN","BPSRREV",94,0)
 S BPSY=5,FL=0
"RTN","BPSRREV",95,0)
 Q
"RTN","BPSRREV",96,0)
 ;
"RTN","BPSRREV",97,0)
 ;
"RTN","BPSRREV",98,0)
PAUSE ;
"RTN","BPSRREV",99,0)
 N X
"RTN","BPSRREV",100,0)
 U IO(0)
"RTN","BPSRREV",101,0)
 W !!,"Press RETURN to continue, '^' to exit: "
"RTN","BPSRREV",102,0)
 R X:DTIME
"RTN","BPSRREV",103,0)
 I '$T S X="^"
"RTN","BPSRREV",104,0)
 I X["^" S BPQ=1
"RTN","BPSRREV",105,0)
 U IO
"RTN","BPSRREV",106,0)
 Q
"RTN","BPSRREV",107,0)
 ;
"RTN","BPSRREV",108,0)
PAUSE2 ;
"RTN","BPSRREV",109,0)
 N X
"RTN","BPSRREV",110,0)
 U IO(0)
"RTN","BPSRREV",111,0)
 W !!,"Press RETURN to continue: "
"RTN","BPSRREV",112,0)
 R X:DTIME
"RTN","BPSRREV",113,0)
 U IO
"RTN","BPSRREV",114,0)
 Q
"RTN","BPSRSELG")
0^316^B1199942
"RTN","BPSRSELG",1,0)
BPSRSELG ;BHAM ISC/SS - ECME RESEARCH SCREEN ELIGIBILITY VIEW ;05-APR-05
"RTN","BPSRSELG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRSELG",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRSELG",4,0)
 Q
"RTN","BPSRSELG",5,0)
 ;
"RTN","BPSRSELG",6,0)
VE ;
"RTN","BPSRSELG",7,0)
 ; -- main entry point for BPS LSTMN RSCH ELIGIBILITY
"RTN","BPSRSELG",8,0)
 ;entry point for VE View Eligibility menu option of the main User Screen
"RTN","BPSRSELG",9,0)
 N BPRET,BPSEL,BPDFN
"RTN","BPSRSELG",10,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSRSELG",11,0)
 D FULL^VALM1
"RTN","BPSRSELG",12,0)
 W !,"Please select a SINGLE Patient Line item for viewing Eligibility"
"RTN","BPSRSELG",13,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","P","Please select SINGLE patient summary line.")
"RTN","BPSRSELG",14,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSRSELG",15,0)
 S BPDFN=+$P(BPSEL,U,2)
"RTN","BPSRSELG",16,0)
 D EN1^IBNCPDPL(BPDFN)
"RTN","BPSRSELG",17,0)
 S VALMBCK="R"
"RTN","BPSRSELG",18,0)
 Q
"RTN","BPSRSELG",19,0)
 ;
"RTN","BPSRSELG",20,0)
 ;
"RTN","BPSRSEV")
0^317^B2494977
"RTN","BPSRSEV",1,0)
BPSRSEV ;BHAM ISC/SS - ECME RESEARCH SCREEN EVENT LOG ;05-APR-05
"RTN","BPSRSEV",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRSEV",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRSEV",4,0)
 Q
"RTN","BPSRSEV",5,0)
 ;
"RTN","BPSRSEV",6,0)
EVNT ;
"RTN","BPSRSEV",7,0)
 ;entry point for VE View Eligibility menu option of the main User Screen
"RTN","BPSRSEV",8,0)
 N BPRET,BPSEL,BPMODE,BPRXIEN,BPPAT
"RTN","BPSRSEV",9,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSRSEV",10,0)
 D FULL^VALM1
"RTN","BPSRSEV",11,0)
 ;
"RTN","BPSRSEV",12,0)
 W !,"Please select a SINGLE Patient Line item or a SINGLE Rx Line item when accessing the IB Events Report"
"RTN","BPSRSEV",13,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","PC","Please select SINGLE patient summary or SINGLE RX line.")
"RTN","BPSRSEV",14,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSRSEV",15,0)
 S BPPAT=+$P(BPSEL,U,2)
"RTN","BPSRSEV",16,0)
 I BPPAT=0 W !,"Invalid Patient Internal Number." D QUIT Q
"RTN","BPSRSEV",17,0)
 ;
"RTN","BPSRSEV",18,0)
 S BPMODE=$S($P(BPSEL,U,7)>0:"R",1:"P")
"RTN","BPSRSEV",19,0)
 ;
"RTN","BPSRSEV",20,0)
 I BPMODE="P" D  D QUIT Q
"RTN","BPSRSEV",21,0)
 . D USRSCREN^IBNCPDPE("P",BPPAT)
"RTN","BPSRSEV",22,0)
 ;
"RTN","BPSRSEV",23,0)
 S BPRXIEN=+$$RXREF^BPSSCRU2(+$P(BPSEL,U,4))
"RTN","BPSRSEV",24,0)
 I BPRXIEN=0 S VALMBCK="R" Q
"RTN","BPSRSEV",25,0)
 ;
"RTN","BPSRSEV",26,0)
 I BPMODE="R" D  D QUIT Q
"RTN","BPSRSEV",27,0)
 . D USRSCREN^IBNCPDPE("R",BPRXIEN)
"RTN","BPSRSEV",28,0)
 ;
"RTN","BPSRSEV",29,0)
 D QUIT
"RTN","BPSRSEV",30,0)
 Q
"RTN","BPSRSEV",31,0)
 ;
"RTN","BPSRSEV",32,0)
QUIT ;
"RTN","BPSRSEV",33,0)
 D PAUSE^VALM1
"RTN","BPSRSEV",34,0)
 S VALMBCK="R"
"RTN","BPSRSEV",35,0)
 Q
"RTN","BPSRSEV",36,0)
 ;
"RTN","BPSRSHLD")
0^318^B1363179
"RTN","BPSRSHLD",1,0)
BPSRSHLD ;BHAM ISC/SS - ECME RESEARCH SCREEN ON HOLD ;05-APR-05
"RTN","BPSRSHLD",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRSHLD",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRSHLD",4,0)
 Q
"RTN","BPSRSHLD",5,0)
 ;
"RTN","BPSRSHLD",6,0)
OH ;
"RTN","BPSRSHLD",7,0)
 ;
"RTN","BPSRSHLD",8,0)
 N BPRET,BPSEL
"RTN","BPSRSHLD",9,0)
 N IBIBRX
"RTN","BPSRSHLD",10,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSRSHLD",11,0)
 D FULL^VALM1
"RTN","BPSRSHLD",12,0)
 W !,"Please select a SINGLE Patient Line item when accessing the On Hold Copay Listing"
"RTN","BPSRSHLD",13,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","P","Please select SINGLE patient summary line.")
"RTN","BPSRSHLD",14,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSRSHLD",15,0)
 N DFN
"RTN","BPSRSHLD",16,0)
 S DFN=+$P(BPSEL,U,2)
"RTN","BPSRSHLD",17,0)
 D ONHOLD^IBNCPDPH(DFN)
"RTN","BPSRSHLD",18,0)
 D PAUSE^VALM1
"RTN","BPSRSHLD",19,0)
 S VALMBCK="R"
"RTN","BPSRSHLD",20,0)
 Q
"RTN","BPSRSHLD",21,0)
 ;
"RTN","BPSRSHLD",22,0)
 ;
"RTN","BPSRSINS")
0^319^B1150190
"RTN","BPSRSINS",1,0)
BPSRSINS ;BHAM ISC/SS - ECME RESEARCH SCREEN INSURANCE VIEW ;05-APR-05
"RTN","BPSRSINS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRSINS",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRSINS",4,0)
 Q
"RTN","BPSRSINS",5,0)
 ;
"RTN","BPSRSINS",6,0)
VI ;
"RTN","BPSRSINS",7,0)
 ;entry point for VI View Insurance menu option of the main User Screen
"RTN","BPSRSINS",8,0)
 N BPRET,BPSEL
"RTN","BPSRSINS",9,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSRSINS",10,0)
 D FULL^VALM1
"RTN","BPSRSINS",11,0)
 W !,"Please select a SINGLE Patient Line item for viewing Insurance"
"RTN","BPSRSINS",12,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","P","Please select SINGLE patient summary line.")
"RTN","BPSRSINS",13,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSRSINS",14,0)
 N DFN
"RTN","BPSRSINS",15,0)
 S DFN=+$P(BPSEL,U,2)
"RTN","BPSRSINS",16,0)
 D EN1^IBNCPDPI(DFN)
"RTN","BPSRSINS",17,0)
 S VALMBCK="R"
"RTN","BPSRSINS",18,0)
 Q
"RTN","BPSRSINS",19,0)
 ;
"RTN","BPSRSM")
0^320^B1081116
"RTN","BPSRSM",1,0)
BPSRSM ;BHAM ISC/SS - ECME REPORTS ;05-APR-05
"RTN","BPSRSM",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRSM",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRSM",4,0)
 ;
"RTN","BPSRSM",5,0)
 Q
"RTN","BPSRSM",6,0)
EN ; -- main entry point for BPS LSTMN RSCH MENU
"RTN","BPSRSM",7,0)
 D EN^VALM("BPS LSTMN RSCH MENU")
"RTN","BPSRSM",8,0)
 Q
"RTN","BPSRSM",9,0)
 ;
"RTN","BPSRSM",10,0)
HDR ; -- header code
"RTN","BPSRSM",11,0)
 S VALMHDR(1)=$$HDR^BPSSCR01(1)
"RTN","BPSRSM",12,0)
 S VALMHDR(2)=$$HDR^BPSSCR01(2)
"RTN","BPSRSM",13,0)
 S VALMHDR(3)=$$HDR^BPSSCR01(3)
"RTN","BPSRSM",14,0)
 Q
"RTN","BPSRSM",15,0)
 ;
"RTN","BPSRSM",16,0)
INIT ; -- init variables and list array
"RTN","BPSRSM",17,0)
 ;^TMP for "BPS LSTMN ECME USRSCR" is used
"RTN","BPSRSM",18,0)
 ;set the Research Screen "begin" line to the current User Screen begin line
"RTN","BPSRSM",19,0)
 I $G(BPVALMBG)>0 S VALMBG=BPVALMBG
"RTN","BPSRSM",20,0)
 Q
"RTN","BPSRSM",21,0)
 ;
"RTN","BPSRSM",22,0)
HELP ; -- help code
"RTN","BPSRSM",23,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSRSM",24,0)
 Q
"RTN","BPSRSM",25,0)
 ;
"RTN","BPSRSM",26,0)
EXIT ; -- exit code
"RTN","BPSRSM",27,0)
 I $D(BPVALMBG) S BPVALMBG=VALMBG
"RTN","BPSRSM",28,0)
 D CLEANUP
"RTN","BPSRSM",29,0)
 Q
"RTN","BPSRSM",30,0)
 ;
"RTN","BPSRSM",31,0)
EXPND ; -- expand code
"RTN","BPSRSM",32,0)
 Q
"RTN","BPSRSM",33,0)
 ;
"RTN","BPSRSM",34,0)
RM ;
"RTN","BPSRSM",35,0)
 N BPVALMBG
"RTN","BPSRSM",36,0)
 ;save the current User Screen "begin" line to use for Research Screen (to stay at the same place)
"RTN","BPSRSM",37,0)
 S BPVALMBG=VALMBG
"RTN","BPSRSM",38,0)
 D EN
"RTN","BPSRSM",39,0)
 ;save the current Research "begin" line to use for the User Screen
"RTN","BPSRSM",40,0)
 I $G(BPVALMBG)>0 S VALMBG=BPVALMBG
"RTN","BPSRSM",41,0)
 S VALMBCK="R"
"RTN","BPSRSM",42,0)
 Q
"RTN","BPSRSM",43,0)
 ;
"RTN","BPSRSM",44,0)
CLEANUP ;
"RTN","BPSRSM",45,0)
 Q
"RTN","BPSRSM",46,0)
 ;
"RTN","BPSRSPRS")
0^321^B1243038
"RTN","BPSRSPRS",1,0)
BPSRSPRS ;BHAM ISC/SS - ECME RESEARCH SCREEN PRESCRIPTION VIEW ;05-APR-05
"RTN","BPSRSPRS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRSPRS",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRSPRS",4,0)
 Q
"RTN","BPSRSPRS",5,0)
 ;
"RTN","BPSRSPRS",6,0)
VP ;
"RTN","BPSRSPRS",7,0)
 ;entry point for VP View Prescription menu option of the main User Screen
"RTN","BPSRSPRS",8,0)
 N BPRET,BPSEL,BPRXIEN,DA,PSOVDA,PS
"RTN","BPSRSPRS",9,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSRSPRS",10,0)
 D FULL^VALM1
"RTN","BPSRSPRS",11,0)
 W !,"Please select a SINGLE Rx Line item for viewing a Prescription"
"RTN","BPSRSPRS",12,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","C","Please select SINGLE RX line.")
"RTN","BPSRSPRS",13,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSRSPRS",14,0)
 S BPRXIEN=+$$RXREF^BPSSCRU2(+$P(BPSEL,U,4))
"RTN","BPSRSPRS",15,0)
 I BPRXIEN=0 S VALMBCK="R" Q
"RTN","BPSRSPRS",16,0)
 S PS=""
"RTN","BPSRSPRS",17,0)
 S (DA,PSOVDA)=BPRXIEN D DP^PSORXVW
"RTN","BPSRSPRS",18,0)
 S VALMBCK="R"
"RTN","BPSRSPRS",19,0)
 Q
"RTN","BPSRSPRS",20,0)
 ;
"RTN","BPSRSRLC")
0^322^B2312265
"RTN","BPSRSRLC",1,0)
BPSRSRLC ;BHAM ISC/SS - ECME RESEARCH SCREEN RELEASE COPAY ;05-APR-05
"RTN","BPSRSRLC",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRSRLC",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRSRLC",4,0)
 Q
"RTN","BPSRSRLC",5,0)
 ;
"RTN","BPSRSRLC",6,0)
RH ;
"RTN","BPSRSRLC",7,0)
 N BPRET,BPSEL,DFN,BPRXRF
"RTN","BPSRSRLC",8,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSRSRLC",9,0)
 D FULL^VALM1
"RTN","BPSRSRLC",10,0)
 W !,"Please select a SINGLE Patient Line item or a SINGLE Rx Line item when accessing Release Copay from Hold."
"RTN","BPSRSRLC",11,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","PC","Please select a SINGLE Patient Line item or a SINGLE Rx Line item")
"RTN","BPSRSRLC",12,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSRSRLC",13,0)
 S DFN=+$P(BPSEL,U,2)
"RTN","BPSRSRLC",14,0)
 I DFN=0 S VALMBCK="R" Q
"RTN","BPSRSRLC",15,0)
 I +$P(BPSEL,U,7)>0 D
"RTN","BPSRSRLC",16,0)
 . ;RX was selected
"RTN","BPSRSRLC",17,0)
 . S BPRXRF=$$RXREF^BPSSCRU2(+$P(BPSEL,U,4))
"RTN","BPSRSRLC",18,0)
 . I BPRXRF'>0 Q
"RTN","BPSRSRLC",19,0)
 . D RELH^IBNCPDPR(DFN,+$P(BPRXRF,U),+$P(BPRXRF,U,2),"C")
"RTN","BPSRSRLC",20,0)
 I +$P(BPSEL,U,7)=0 D
"RTN","BPSRSRLC",21,0)
 . ;patient was selected
"RTN","BPSRSRLC",22,0)
 . D RELH^IBNCPDPR(DFN,0,0,"P")
"RTN","BPSRSRLC",23,0)
 D QUIT
"RTN","BPSRSRLC",24,0)
 Q
"RTN","BPSRSRLC",25,0)
 ;
"RTN","BPSRSRLC",26,0)
QUIT ;
"RTN","BPSRSRLC",27,0)
 S VALMBCK="R"
"RTN","BPSRSRLC",28,0)
 Q
"RTN","BPSRSRLC",29,0)
 ;
"RTN","BPSRSTPJ")
0^323^B1149393
"RTN","BPSRSTPJ",1,0)
BPSRSTPJ ;BHAM ISC/SS - ECME RESEARCH SCREEN TPJI ;05-APR-05
"RTN","BPSRSTPJ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSRSTPJ",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSRSTPJ",4,0)
 Q
"RTN","BPSRSTPJ",5,0)
 ;DBIA2328
"RTN","BPSRSTPJ",6,0)
TPJI ;
"RTN","BPSRSTPJ",7,0)
 N BPRET,BPSEL
"RTN","BPSRSTPJ",8,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSRSTPJ",9,0)
 D FULL^VALM1
"RTN","BPSRSTPJ",10,0)
 W !,"Please select a SINGLE Patient Line item when accessing TPJI"
"RTN","BPSRSTPJ",11,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","P","Please select SINGLE patient summary line.")
"RTN","BPSRSTPJ",12,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSRSTPJ",13,0)
 N BPDFN
"RTN","BPSRSTPJ",14,0)
 S BPDFN=+$P(BPSEL,U,2)
"RTN","BPSRSTPJ",15,0)
 I BPDFN>0 D TPJI^IBNCPDPI(BPDFN)
"RTN","BPSRSTPJ",16,0)
 S VALMBCK="R"
"RTN","BPSRSTPJ",17,0)
 Q
"RTN","BPSRSTPJ",18,0)
 ;
"RTN","BPSSCR")
0^324^B2756010
"RTN","BPSSCR",1,0)
BPSSCR ;BHAM ISC/SS - ECME USER SCREEN MAIN ;10-MAR-2005
"RTN","BPSSCR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCR",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCR",4,0)
 ;USER SCREEN
"RTN","BPSSCR",5,0)
 Q
"RTN","BPSSCR",6,0)
EN ; -- main entry point for BPS ECME USER SCREEN
"RTN","BPSSCR",7,0)
 D EN^VALM("BPS LSTMN ECME USRSCR")
"RTN","BPSSCR",8,0)
 Q
"RTN","BPSSCR",9,0)
 ;
"RTN","BPSSCR",10,0)
HDR ; -- header code
"RTN","BPSSCR",11,0)
 S VALMHDR(1)=$$HDR^BPSSCR01(1)
"RTN","BPSSCR",12,0)
 S VALMHDR(2)=$$HDR^BPSSCR01(2)
"RTN","BPSSCR",13,0)
 S VALMHDR(3)=$$HDR^BPSSCR01(3)
"RTN","BPSSCR",14,0)
 Q
"RTN","BPSSCR",15,0)
 ;
"RTN","BPSSCR",16,0)
INIT ; -- init variables and list array
"RTN","BPSSCR",17,0)
 D KILINSGL ;clean up insurance list
"RTN","BPSSCR",18,0)
 W !,"Please wait..."
"RTN","BPSSCR",19,0)
 S VALMCNT=$$INIT^BPSSCR01()
"RTN","BPSSCR",20,0)
 Q
"RTN","BPSSCR",21,0)
 ;
"RTN","BPSSCR",22,0)
HELP ; -- help code
"RTN","BPSSCR",23,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSSCR",24,0)
 Q
"RTN","BPSSCR",25,0)
 ;
"RTN","BPSSCR",26,0)
EXIT ; -- exit code
"RTN","BPSSCR",27,0)
 D CLEANUP
"RTN","BPSSCR",28,0)
 Q
"RTN","BPSSCR",29,0)
 ;
"RTN","BPSSCR",30,0)
EXPND ; -- expand code
"RTN","BPSSCR",31,0)
 Q
"RTN","BPSSCR",32,0)
 ;
"RTN","BPSSCR",33,0)
CLEANUP ;
"RTN","BPSSCR",34,0)
 K @VALMAR
"RTN","BPSSCR",35,0)
 D KILINSGL ;clean up insurance list
"RTN","BPSSCR",36,0)
 Q
"RTN","BPSSCR",37,0)
 ; BPINSNAM - insurance name; BPPHONE - insurance phone number
"RTN","BPSSCR",38,0)
CHKINSUR(BPINSNAM,BPPHONE) ; returns a unique number for insurance (among those found in claims)
"RTN","BPSSCR",39,0)
 N BPINSID,BPMAXN
"RTN","BPSSCR",40,0)
 I $L(BPINSNAM)=0 S BPINSNAM="UNKNOWN"
"RTN","BPSSCR",41,0)
 I $L(BPPHONE)=0 S BPPHONE="N/A"
"RTN","BPSSCR",42,0)
 S BPINSID=+$G(^TMP($J,"BPSSCRINS","VAL",BPINSNAM,BPPHONE))
"RTN","BPSSCR",43,0)
 I BPINSID=0 D
"RTN","BPSSCR",44,0)
 . S BPMAXN=$G(^TMP($J,"BPSSCRINS","MAXN"))+1
"RTN","BPSSCR",45,0)
 . S ^TMP($J,"BPSSCRINS","VAL",BPINSNAM,BPPHONE)=BPMAXN
"RTN","BPSSCR",46,0)
 . S ^TMP($J,"BPSSCRINS","MAXN")=BPMAXN
"RTN","BPSSCR",47,0)
 Q +$G(^TMP($J,"BPSSCRINS","VAL",BPINSNAM,BPPHONE))
"RTN","BPSSCR",48,0)
 ;
"RTN","BPSSCR",49,0)
KILINSGL ;
"RTN","BPSSCR",50,0)
 K ^TMP($J,"BPSSCRINS")
"RTN","BPSSCR",51,0)
 Q
"RTN","BPSSCR",52,0)
 ;
"RTN","BPSSCR01")
0^325^B17293362
"RTN","BPSSCR01",1,0)
BPSSCR01 ;BHAM ISC/SS - USER SCREEN ;10-MAR-2005
"RTN","BPSSCR01",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCR01",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCR01",4,0)
 ;USER SCREEN
"RTN","BPSSCR01",5,0)
 Q
"RTN","BPSSCR01",6,0)
 ;User Screen header
"RTN","BPSSCR01",7,0)
 ;input:
"RTN","BPSSCR01",8,0)
 ; BPSLN - line of the header
"RTN","BPSSCR01",9,0)
 ;output:
"RTN","BPSSCR01",10,0)
 ; text string for the header
"RTN","BPSSCR01",11,0)
HDR(BPSLN) ; -- header code
"RTN","BPSSCR01",12,0)
 N BPARR,BPX,BPXSL
"RTN","BPSSCR01",13,0)
 Q:'$D(@VALMAR@("VIEWPARAMS"))
"RTN","BPSSCR01",14,0)
 D RESTVIEW(.BPARR)
"RTN","BPSSCR01",15,0)
 I BPSLN=1 Q "SELECTED DIVISION(S): "_$$GETVDIVS(.BPARR,58)
"RTN","BPSSCR01",16,0)
 I BPSLN=2 Q $$GETVDETS(.BPARR)
"RTN","BPSSCR01",17,0)
 I BPSLN=3 D  Q $$LINE^BPSSCRU3(80-$L(BPX)," ")_BPX
"RTN","BPSSCR01",18,0)
 . S BPXSL=$$SORTTYPE^BPSSCRSL($G(BPARR(1.12)))
"RTN","BPSSCR01",19,0)
 . I BPXSL="" S BPXSL="Transaction date by default"
"RTN","BPSSCR01",20,0)
 . S BPX="Sorted by: "_BPXSL
"RTN","BPSSCR01",21,0)
 Q ""
"RTN","BPSSCR01",22,0)
 ;/**
"RTN","BPSSCR01",23,0)
 ;get current view details
"RTN","BPSSCR01",24,0)
GETVDETS(BPARR) ;*/
"RTN","BPSSCR01",25,0)
 N BPSTR
"RTN","BPSSCR01",26,0)
 I $G(BPARR(1.01))="A" S BPSTR=$$LJ^BPSSCR02("Transmitted by ALL users",31)
"RTN","BPSSCR01",27,0)
 E  S BPSTR=$$LJ^BPSSCR02("Transmitted by "_$$GETUSRNM^BPSSCRU1($G(BPARR(1.16))),31)
"RTN","BPSSCR01",28,0)
 S BPSTR=BPSTR_$$LJ^BPSSCR02(" Activity Date Range: within the past "_$G(BPARR(1.05))_$S($G(BPARR(1.04))="H":" hour(s)",1:" day(s)"),49)
"RTN","BPSSCR01",29,0)
 Q BPSTR
"RTN","BPSSCR01",30,0)
 ;
"RTN","BPSSCR01",31,0)
 ;/**
"RTN","BPSSCR01",32,0)
 ;get divisions selected
"RTN","BPSSCR01",33,0)
GETVDIVS(BPARRAY,BPMLEN) ;*/
"RTN","BPSSCR01",34,0)
 I $G(BPARRAY(1.13))="A" Q "ALL"
"RTN","BPSSCR01",35,0)
 N BPDIV,BPCNT,BPSTR,BPQUIT
"RTN","BPSSCR01",36,0)
 S BPQUIT=0,BPSTR=""
"RTN","BPSSCR01",37,0)
 F BPCNT=1:1:20 S BPDIV=$P($G(BPARRAY("DIVS")),";",BPCNT+1) Q:+BPDIV=0  D  Q:BPQUIT=1
"RTN","BPSSCR01",38,0)
 . I $L(BPSTR_$$DIVNAME^BPSSCRDS(BPDIV))>(BPMLEN-4) D  S BPQUIT=1 Q
"RTN","BPSSCR01",39,0)
 . . S BPSTR=$$LJ^BPSSCR02(BPSTR_",...",BPMLEN)
"RTN","BPSSCR01",40,0)
 . S BPSTR=BPSTR_$S(BPCNT>1:", ",1:"")_$$DIVNAME^BPSSCRDS(BPDIV)
"RTN","BPSSCR01",41,0)
 Q BPSTR
"RTN","BPSSCR01",42,0)
 ;/**
"RTN","BPSSCR01",43,0)
 ;input:
"RTN","BPSSCR01",44,0)
 ; BPARR - local array to store user profile info
"RTN","BPSSCR01",45,0)
 ;returns:
"RTN","BPSSCR01",46,0)
 ; the last number in LM ARRAY
"RTN","BPSSCR01",47,0)
INIT() ; -- init variables and list array*/
"RTN","BPSSCR01",48,0)
 N BPLN,BPLM,BP59,BPSORT,BPTMPGL,BPRET
"RTN","BPSSCR01",49,0)
 N BPARR
"RTN","BPSSCR01",50,0)
 ;get user's ien in BPS PRFILE file
"RTN","BPSSCR01",51,0)
 ;if array is not defined then read information from file, 
"RTN","BPSSCR01",52,0)
 ;otherwise use current info from the array, because the user
"RTN","BPSSCR01",53,0)
 ;may specify criteria in array without saving it in file for
"RTN","BPSSCR01",54,0)
 ;the temporary use
"RTN","BPSSCR01",55,0)
 I '$D(@VALMAR@("VIEWPARAMS")) D
"RTN","BPSSCR01",56,0)
 . D READPROF^BPSSCRSL(.BPARR,+DUZ)
"RTN","BPSSCR01",57,0)
 . D SAVEVIEW(.BPARR)
"RTN","BPSSCR01",58,0)
 E  D RESTVIEW(.BPARR)
"RTN","BPSSCR01",59,0)
 ;get date/time range
"RTN","BPSSCR01",60,0)
 I $$GETDT^BPSSCRU1(.BPARR)=0 Q
"RTN","BPSSCR01",61,0)
 S BPTMPGL=$NA(^TMP($J,"BPSSCR"))
"RTN","BPSSCR01",62,0)
 K @BPTMPGL,@VALMAR
"RTN","BPSSCR01",63,0)
 D COLLECT^BPSSCR04(BPTMPGL,.BPARR)
"RTN","BPSSCR01",64,0)
 D SAVEVIEW(.BPARR)
"RTN","BPSSCR01",65,0)
 S BPRET=$$LMARRAY(BPTMPGL,.BPARR)
"RTN","BPSSCR01",66,0)
 K @BPTMPGL
"RTN","BPSSCR01",67,0)
 S:BPRET>1 BPRET=BPRET-1
"RTN","BPSSCR01",68,0)
 Q BPRET
"RTN","BPSSCR01",69,0)
 ;
"RTN","BPSSCR01",70,0)
 ;/**
"RTN","BPSSCR01",71,0)
 ;make elements for List Manager array
"RTN","BPSSCR01",72,0)
 ;input:
"RTN","BPSSCR01",73,0)
 ;BPTMPGL - TMP global to store selected claims
"RTN","BPSSCR01",74,0)
 ;BPARR - local array to store user profile info
"RTN","BPSSCR01",75,0)
 ;returns:
"RTN","BPSSCR01",76,0)
 ; the last number in LM ARRAY
"RTN","BPSSCR01",77,0)
 ;indexing (example):
"RTN","BPSSCR01",78,0)
 ;S ^TMP("BPSSCR",$J,"VALM",1,0)="2   BUMSTEAD,CHARLE 5444 WEBMD"
"RTN","BPSSCR01",79,0)
 ;S ^TMP("BPSSCR",$J,"VALM",2,0)="    2.1  CEFACLOR 500MG CAP"
"RTN","BPSSCR01",80,0)
 ;S ^TMP("BPSSCR",$J,"VALM",3,0)="    2.2  AMPICILLIN 250MG CAP"
"RTN","BPSSCR01",81,0)
 ;S ^TMP("BPSSCR",$J,"VALM","LMIND",2,437272,7008776.00001,0)=""
"RTN","BPSSCR01",82,0)
 ;S ^TMP("BPSSCR",$J,"VALM","LMIND",2.1,437272,7008778.00011,1)=""
"RTN","BPSSCR01",83,0)
 ;S ^TMP("BPSSCR",$J,"VALM","LMIND",2.2,437272,7009457.00001,2)=""
"RTN","BPSSCR01",84,0)
LMARRAY(BPTMPGL,BPARR) ;*/
"RTN","BPSSCR01",85,0)
 N BPSRTVAL,BP59,BPSORT,BPLN,BPLM,BPSTR1
"RTN","BPSSCR01",86,0)
 S BPLM=0 ;patient_AND_insurance level counter
"RTN","BPSSCR01",87,0)
 S BPCLM=0 ;claim level counter 
"RTN","BPSSCR01",88,0)
 S BP59=0
"RTN","BPSSCR01",89,0)
 S BPLN=1 ;line counter for List manager array to display on the screen
"RTN","BPSSCR01",90,0)
 S BPPREV=0 ;to store data from previous patient group
"RTN","BPSSCR01",91,0)
 ;sort type:
"RTN","BPSSCR01",92,0)
 ;'T' FOR TRANSACTION DATE
"RTN","BPSSCR01",93,0)
 ;'D' FOR DIVISION (ECME pharmacy)
"RTN","BPSSCR01",94,0)
 ;'I' FOR INSURANCE
"RTN","BPSSCR01",95,0)
 ;'C' FOR REJECT CODE 
"RTN","BPSSCR01",96,0)
 ;'P' FOR PATIENT NAME
"RTN","BPSSCR01",97,0)
 ;'N' FOR DRUG NAME
"RTN","BPSSCR01",98,0)
 ;'B' FOR BILL TYPE (BB/RT)
"RTN","BPSSCR01",99,0)
 ;'L' FOR FILL LOCATION (Windows/Mail/CMOP) 
"RTN","BPSSCR01",100,0)
 ;'R' FOR RELEASED/NON-RELEASED RX
"RTN","BPSSCR01",101,0)
 ;'A' FOR ACTIVE/DISCONTINUED RX
"RTN","BPSSCR01",102,0)
 S BPSORT=$G(BPARR(1.12))
"RTN","BPSSCR01",103,0)
 S:BPSORT="" BPSORT="T" ;default
"RTN","BPSSCR01",104,0)
 S BPSRTVAL="" ;a value that "makes" an order, can be a string
"RTN","BPSSCR01",105,0)
 F  S BPSRTVAL=$O(@BPTMPGL@("SORT",BPSORT,BPSRTVAL)) Q:BPSRTVAL=""  D
"RTN","BPSSCR01",106,0)
 . I BPSORT="D" D
"RTN","BPSSCR01",107,0)
 . . S BPSTR1="---- Division: "_$$DIVNAME^BPSSCRDS(+$P(BPSRTVAL,U,2))_" "
"RTN","BPSSCR01",108,0)
 . . D SET^VALM10(BPLN,BPSTR1_$$LINE^BPSSCRU3(79-$L(BPSTR1),"-"),0)
"RTN","BPSSCR01",109,0)
 . . S BPLN=BPLN+1
"RTN","BPSSCR01",110,0)
 . I BPSORT="C" D
"RTN","BPSSCR01",111,0)
 . . S BPSTR1="---- Reject code: "_$$GETRJNAM^BPSSCRU3(BPSRTVAL)_" "
"RTN","BPSSCR01",112,0)
 . . D SET^VALM10(BPLN,BPSTR1_$$LINE^BPSSCRU3(79-$L(BPSTR1),"-"),0)
"RTN","BPSSCR01",113,0)
 . . S BPLN=BPLN+1
"RTN","BPSSCR01",114,0)
 . S BP59=0
"RTN","BPSSCR01",115,0)
 . F  S BP59=+$O(@BPTMPGL@("SORT",BPSORT,BPSRTVAL,BP59)) Q:+BP59=0  D
"RTN","BPSSCR01",116,0)
 . . I BP59'=0 D MKARRELM^BPSSCR02(.BPLN,VALMAR,BP59,.BPLM,.BPCLM,.BPPREV)
"RTN","BPSSCR01",117,0)
 D UPDPREV^BPSSCR02(VALMAR,BPLM,BPPREV)
"RTN","BPSSCR01",118,0)
 Q BPLN
"RTN","BPSSCR01",119,0)
 ;
"RTN","BPSSCR01",120,0)
HELP ; -- help code
"RTN","BPSSCR01",121,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSSCR01",122,0)
 Q
"RTN","BPSSCR01",123,0)
 ;
"RTN","BPSSCR01",124,0)
EXIT ; -- exit code
"RTN","BPSSCR01",125,0)
 Q
"RTN","BPSSCR01",126,0)
 ;
"RTN","BPSSCR01",127,0)
EXPND ; -- expand code
"RTN","BPSSCR01",128,0)
 Q
"RTN","BPSSCR01",129,0)
 ;/**
"RTN","BPSSCR01",130,0)
 ;store current view params in VALMAR("VIEWPARAMS") TMP global array
"RTN","BPSSCR01",131,0)
 ;to display in the header
"RTN","BPSSCR01",132,0)
 ;input: 
"RTN","BPSSCR01",133,0)
 ; BPARR - array with user profile info to store
"RTN","BPSSCR01",134,0)
SAVEVIEW(BPARR) ;        S @VALMAR@("VIEWPARAMS",BPLMIND,BPDFN,BP59,BPLINE)=""
"RTN","BPSSCR01",135,0)
 Q:'$D(BPARR)
"RTN","BPSSCR01",136,0)
 M @VALMAR@("VIEWPARAMS")=BPARR
"RTN","BPSSCR01",137,0)
 Q
"RTN","BPSSCR01",138,0)
 ;
"RTN","BPSSCR01",139,0)
 ;/**
"RTN","BPSSCR01",140,0)
 ;restore current view params from VALMAR("VIEWPARAMS") TMP global array
"RTN","BPSSCR01",141,0)
 ;input: 
"RTN","BPSSCR01",142,0)
 ; BPARR - array with user profile info to store
"RTN","BPSSCR01",143,0)
RESTVIEW(BPARR) ;        S @VALMAR@("VIEWPARAMS",BPLMIND,BPDFN,BP59,BPLINE)=""
"RTN","BPSSCR01",144,0)
 Q:'$D(@VALMAR@("VIEWPARAMS"))
"RTN","BPSSCR01",145,0)
 M BPARR=@VALMAR@("VIEWPARAMS")
"RTN","BPSSCR01",146,0)
 Q
"RTN","BPSSCR01",147,0)
 ;
"RTN","BPSSCR02")
0^326^B43889561
"RTN","BPSSCR02",1,0)
BPSSCR02 ;BHAM ISC/SS - USER SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCR02",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCR02",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCR02",4,0)
 ;USER SCREEN
"RTN","BPSSCR02",5,0)
 Q
"RTN","BPSSCR02",6,0)
REVERSE ; 
"RTN","BPSSCR02",7,0)
 N BPSDFN,BPSRX
"RTN","BPSSCR02",8,0)
 D SELECT(.BPSDFN,.BPSRX)
"RTN","BPSSCR02",9,0)
 S VALMBCK="R"
"RTN","BPSSCR02",10,0)
 Q
"RTN","BPSSCR02",11,0)
 ;
"RTN","BPSSCR02",12,0)
SELECT(BPSDFN1,BPSRX1,BPSRF1,BPS59) ; Select a patient.  Returns patient IEN(s) in array
"RTN","BPSSCR02",13,0)
 N BPLN
"RTN","BPSSCR02",14,0)
 S BPLN=$$SELLINE("Select the line(s) with the paid claim(s) you wish to REVERSE","")
"RTN","BPSSCR02",15,0)
 Q
"RTN","BPSSCR02",16,0)
 ;
"RTN","BPSSCR02",17,0)
SELLINE(BPSPROM,BPSDFVL) ;
"RTN","BPSSCR02",18,0)
 N BPRET,DIR,X,Y,DIRUT
"RTN","BPSSCR02",19,0)
 S BPRET="^"
"RTN","BPSSCR02",20,0)
 W ! S DIR(0)="N^::2",DIR("A")=BPSPROM,DIR("B")=BPSDFVL D ^DIR I $D(DIRUT) Q "^"
"RTN","BPSSCR02",21,0)
 S $P(BPRET,U)=Y
"RTN","BPSSCR02",22,0)
 Q BPRET
"RTN","BPSSCR02",23,0)
 ;/**
"RTN","BPSSCR02",24,0)
 ;make array element
"RTN","BPSSCR02",25,0)
 ;BPLINE - line number in LM ARRAY (by ref)
"RTN","BPSSCR02",26,0)
 ;BPTMP - VALMAR (TMP global for LM)
"RTN","BPSSCR02",27,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCR02",28,0)
 ;BPLMIND - passed by ref - current patient(/insurance) index ( to make 1, 2,etc)
"RTN","BPSSCR02",29,0)
 ;BPDRIND - passed by ref - current claim level index ( to make .1, .2, .10,... .20,... )
"RTN","BPSSCR02",30,0)
 ;TMP structure gives on the screen:
"RTN","BPSSCR02",31,0)
 ;^TMP("BPSSCR",$J,"VALM","LMIND",1,0,DFN,0,0)=
"RTN","BPSSCR02",32,0)
 ;^TMP("BPSSCR",$J,"VALM",1,0)=1   BUMSTEAD,CHARLE (5444)/100-234-2345 *done* FINISHED
"RTN","BPSSCR02",33,0)
 ;BPLINE = 1
"RTN","BPSSCR02",34,0)
 ;BPLMIND=1
"RTN","BPSSCR02",35,0)
 ;on the screen:
"RTN","BPSSCR02",36,0)
 ;1   BUMSTEAD,CHARLE      (5444)   /100-234-2345 *done* FINISHED
"RTN","BPSSCR02",37,0)
 ;
"RTN","BPSSCR02",38,0)
 ;^TMP(538978189,"BPSSCR","SORT","T",1,401959.00001)=
"RTN","BPSSCR02",39,0)
 ;^TMP("BPSSCR",$J,"VALM","LMIND",1,1,DFN,401959.00001,1)=
"RTN","BPSSCR02",40,0)
 ;^TMP("BPSSCR",$J,"VALM",2,0)=  1.1   LOVASTATIN 20MG TAB
"RTN","BPSSCR02",41,0)
 ;BPLINE = 2
"RTN","BPSSCR02",42,0)
 ;BP59= 401959.00001
"RTN","BPSSCR02",43,0)
 ;on the screen:
"RTN","BPSSCR02",44,0)
 ;  1.1   LOVASTATIN 20MG TAB
"RTN","BPSSCR02",45,0)
 ;
"RTN","BPSSCR02",46,0)
 ;^TMP(538978189,"BPSSCR","SORT","T",1,501750.00011)=
"RTN","BPSSCR02",47,0)
 ;^TMP("BPSSCR",$J,"VALM","LMIND",1,2,DFN,501750.00011,2)=
"RTN","BPSSCR02",48,0)
 ;^TMP("BPSSCR",$J,"VALM",3,0)=  1.2   CIMETIDINE 300MG TAB
"RTN","BPSSCR02",49,0)
 ;BPLINE = 3
"RTN","BPSSCR02",50,0)
 ;BP59= 501750.00011
"RTN","BPSSCR02",51,0)
 ;on the screen:
"RTN","BPSSCR02",52,0)
 ;  1.2   CIMETIDINE 300MG TAB
"RTN","BPSSCR02",53,0)
 ;
"RTN","BPSSCR02",54,0)
MKARRELM(BPLINE,BPTMP,BP59,BPLMIND,BPDRIND,BPPREV) ;*/
"RTN","BPSSCR02",55,0)
 N BPSSTR,BPLNS,BPDFN,BPSTAT,BPSINSUR,BPINSDAT
"RTN","BPSSCR02",56,0)
 S BPDFN=+$P($G(^BPST(BP59,0)),U,6) ;patient's DFN
"RTN","BPSSCR02",57,0)
 S BPINSDAT=$$GETINSUR^BPSSCRU2(BP59)
"RTN","BPSSCR02",58,0)
 S BPSINSUR=+BPINSDAT ;patient's insurance IEN
"RTN","BPSSCR02",59,0)
 ;
"RTN","BPSSCR02",60,0)
 ;PATIENT SUMMARY level
"RTN","BPSSCR02",61,0)
 ; if last one was different DFN/INSURANCE combination then create a new Patient Summary level
"RTN","BPSSCR02",62,0)
 I (+$O(@BPTMP@("LMIND",BPLMIND,0,0))'=BPDFN)!(+$O(@BPTMP@("LMIND",BPLMIND,0,BPDFN,0))'=BPSINSUR) D
"RTN","BPSSCR02",63,0)
 . ;-------- first process previous patient & insurance group
"RTN","BPSSCR02",64,0)
 . ;determine patient summary statuses for the previous "patient" group
"RTN","BPSSCR02",65,0)
 . I BPLMIND>0,+BPPREV=BPLMIND D
"RTN","BPSSCR02",66,0)
 . . ;update the record for previous patient summary after we went thru all his claims
"RTN","BPSSCR02",67,0)
 . . D UPDPREV(BPTMP,BPLMIND,BPPREV)
"RTN","BPSSCR02",68,0)
 . ;process new "patient & insurance" group ------------------
"RTN","BPSSCR02",69,0)
 . S BPDRIND=0
"RTN","BPSSCR02",70,0)
 . S BPLMIND=(BPLMIND\1)+1
"RTN","BPSSCR02",71,0)
 . ;save the all necessary data for the patient & insurance to use as previous for STAT4PAT later on
"RTN","BPSSCR02",72,0)
 . S BPPREV=BPLMIND_U_BPLINE_U_BPDFN_U_$$PATINF(BPDFN,BPINSDAT)_U_BPSINSUR
"RTN","BPSSCR02",73,0)
 . S BPSSTR=$$LJ(BPLMIND,4)_$P(BPPREV,U,4)
"RTN","BPSSCR02",74,0)
 . D SAVEARR(BPTMP,BPLMIND,BPDRIND,BPDFN,0,BPLINE,BPSSTR,BPSINSUR)
"RTN","BPSSCR02",75,0)
 . S BPLINE=BPLINE+1
"RTN","BPSSCR02",76,0)
 ;
"RTN","BPSSCR02",77,0)
 ;CLAIMS level
"RTN","BPSSCR02",78,0)
 D
"RTN","BPSSCR02",79,0)
 . I +$O(@BPTMP@("LMIND",BPLMIND,BPDRIND,BPDFN,0))'=BP59 D
"RTN","BPSSCR02",80,0)
 . . S BPDRIND=BPDRIND+1
"RTN","BPSSCR02",81,0)
 . . S BPSSTR="  "_$$LJ(+$P(BPLMIND,".")_"."_BPDRIND,5)_" "_$$CLAIMINF(BP59)
"RTN","BPSSCR02",82,0)
 . . ;@debug,remove the next line after finish debugging
"RTN","BPSSCR02",83,0)
 . . ;S BPSSTR=BPSSTR_" 59:"_BP59_" DT:"_$$TRANDT^BPSSCRU2(BP59)_" DFN:"_BPDFN_" INS:"_BPSINSUR
"RTN","BPSSCR02",84,0)
 . . D SAVEARR(BPTMP,BPLMIND,BPDRIND,BPDFN,BP59,BPLINE,BPSSTR,BPSINSUR)
"RTN","BPSSCR02",85,0)
 . . S BPLINE=BPLINE+1
"RTN","BPSSCR02",86,0)
 . . N BPARR,X
"RTN","BPSSCR02",87,0)
 . . S BPLNS=$$ADDINF^BPSSCR03(BP59,.BPARR,74,"R")
"RTN","BPSSCR02",88,0)
 . . F X=1:1:BPLNS D
"RTN","BPSSCR02",89,0)
 . . . I $G(BPARR(X))="" Q
"RTN","BPSSCR02",90,0)
 . . . D SAVEARR(BPTMP,BPLMIND,BPDRIND,BPDFN,BP59,BPLINE,"      "_BPARR(X),BPSINSUR)
"RTN","BPSSCR02",91,0)
 . . . S BPLINE=BPLINE+1
"RTN","BPSSCR02",92,0)
 Q
"RTN","BPSSCR02",93,0)
 ;S BPS=BPX
"RTN","BPSSCR02",94,0)
 ;/**
"RTN","BPSSCR02",95,0)
 ;BP59
"RTN","BPSSCR02",96,0)
CLAIMINF(BP59) ;*/
"RTN","BPSSCR02",97,0)
 N BPX,BPX1
"RTN","BPSSCR02",98,0)
 S BPX1=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCR02",99,0)
 ;S BPX=BP59_$$LJ($$DRGNAME^BPSSCRU2(BP59),22)_"  "_$$LJ($$NDC^BPSSCRU2(+BPX1,+$P(BPX1,U,2)),13)_"  "
"RTN","BPSSCR02",100,0)
 S BPX=$$LJ($$DRGNAME^BPSSCRU2(BP59),22)_"  "_$$LJ($$NDC^BPSSCRU2(+BPX1,+$P(BPX1,U,2)),13)_"  "
"RTN","BPSSCR02",101,0)
 S BPX=BPX_$$LJ($$RXNUM^BPSSCRU2(+BPX1),11)_" "_+$P(BPX1,U,2)_"/"
"RTN","BPSSCR02",102,0)
 S BPX=BPX_$$LJ($$ECMENUM^BPSSCRU2(BP59),7)_" "_$$MWCNAME^BPSSCRU2($$GETMWC^BPSSCRU2(BP59))_" "
"RTN","BPSSCR02",103,0)
 S BPX=BPX_$$RTBB^BPSSCRU2(BP59)_" "_$$RXST^BPSSCRU2(BP59)_"/"_$$RL^BPSSCRU2(BP59)
"RTN","BPSSCR02",104,0)
 Q BPX
"RTN","BPSSCR02",105,0)
 ;/**
"RTN","BPSSCR02",106,0)
 ;determine "done" and "FINISHED" status for patient/insurance group by BPLMIND in TMP global
"RTN","BPSSCR02",107,0)
STAT4PAT(BPLMIND) ;*/
"RTN","BPSSCR02",108,0)
 N BPCL,BPDFN,BP59,BPX,BPINS,BPX,BPCNT
"RTN","BPSSCR02",109,0)
 N BPPB,BPRJ,BPACRV,BPRJRV,BPSR,BPFIN,BPPRCNTG
"RTN","BPSSCR02",110,0)
 S (BPCL,BPPB,BPRJ,BPACRV,BPSR,BPRJRV)=0
"RTN","BPSSCR02",111,0)
 S BPFIN=0 ; finished by default
"RTN","BPSSCR02",112,0)
 S BPPRCNTG=0
"RTN","BPSSCR02",113,0)
 S BPCNT=0
"RTN","BPSSCR02",114,0)
 F  S BPCL=+$O(@BPTMP@("LMIND",BPLMIND,BPCL)) Q:BPCL=0  D
"RTN","BPSSCR02",115,0)
 . S BPDFN=0
"RTN","BPSSCR02",116,0)
 . F  S BPDFN=+$O(@BPTMP@("LMIND",BPLMIND,BPCL,BPDFN)) Q:BPDFN=0  D
"RTN","BPSSCR02",117,0)
 . . S BPINS="" ;can be 0 in the TMP global if insurance plan
"RTN","BPSSCR02",118,0)
 . . ;is corrupted in file ##9002313.59
"RTN","BPSSCR02",119,0)
 . . F  S BPINS=$O(@BPTMP@("LMIND",BPLMIND,BPCL,BPDFN,BPINS)) Q:BPINS=""  D
"RTN","BPSSCR02",120,0)
 . . . S BP59=0,BPINS=+BPINS
"RTN","BPSSCR02",121,0)
 . . . F  S BP59=+$O(@BPTMP@("LMIND",BPLMIND,BPCL,BPDFN,BPINS,BP59)) Q:BP59=0  D
"RTN","BPSSCR02",122,0)
 . . . . S BPCNT=BPCNT+1
"RTN","BPSSCR02",123,0)
 . . . . S BPX=$P($$CLAIMST^BPSSCRU3(BP59),U)
"RTN","BPSSCR02",124,0)
 . . . . I BPX["E PAYABLE" S BPPB=BPPB+1 ;Payable
"RTN","BPSSCR02",125,0)
 . . . . I BPX["E REJECTED" S BPRJ=BPRJ+1 ;Rejected
"RTN","BPSSCR02",126,0)
 . . . . I BPX["E REVERSAL ACCEPTED" S BPACRV=BPACRV+1 ;Accepted Reversal 
"RTN","BPSSCR02",127,0)
 . . . . I BPX["E REVERSAL REJECTED" S BPRJRV=BPRJRV+1 ;Rejected Reversal
"RTN","BPSSCR02",128,0)
 . . . . ;don't count Auto-Reversal
"RTN","BPSSCR02",129,0)
 . . . . ;I BPX["^SR^" S BPSR=BPSR+1 ; stranded
"RTN","BPSSCR02",130,0)
 . . . . S BPFIN=BPFIN+$$PRCNTG^BPSSCRU3(BP59)
"RTN","BPSSCR02",131,0)
 . . . . ;I BPFIN=1 Q "**FINISHED**"
"RTN","BPSSCR02",132,0)
 ;Q BPCNT_" "_BPPB_","_BPRJ_","_BPACRV_","_BPSR
"RTN","BPSSCR02",133,0)
 I BPCNT>0 S BPPRCNTG=(BPFIN/BPCNT)\1
"RTN","BPSSCR02",134,0)
 I BPPRCNTG=99 S BPPRCNTG="Done"
"RTN","BPSSCR02",135,0)
 E  S BPPRCNTG=BPPRCNTG_"%"
"RTN","BPSSCR02",136,0)
 S BPX="*"_BPPRCNTG_"*"
"RTN","BPSSCR02",137,0)
 I BPPB=BPCNT S BPX=BPX_" ALL payable"
"RTN","BPSSCR02",138,0)
 E  S BPX=BPX_" Pb:"_BPPB_" Rj:"_BPRJ_" AcRv:"_BPACRV_" RjRv:"_BPRJRV
"RTN","BPSSCR02",139,0)
 Q BPX
"RTN","BPSSCR02",140,0)
 ;/**
"RTN","BPSSCR02",141,0)
 ;gets the patient summary information
"RTN","BPSSCR02",142,0)
 ;input:
"RTN","BPSSCR02",143,0)
 ; BPDFN - ptr to #2
"RTN","BPSSCR02",144,0)
 ; BPINS - insurance ien^insurance name^phone 
"RTN","BPSSCR02",145,0)
 ;output:
"RTN","BPSSCR02",146,0)
 ; patient summary information
"RTN","BPSSCR02",147,0)
PATINF(BPDFN,BPINS) ;*/
"RTN","BPSSCR02",148,0)
 N X,BPINSNM
"RTN","BPSSCR02",149,0)
 S BPINSNM=$P(BPINS,U,2)
"RTN","BPSSCR02",150,0)
 S X=$$LJ^BPSSCR02($$PATNAME^BPSSCRU2(BPDFN),13) ;name
"RTN","BPSSCR02",151,0)
 S X=X_" "_$$LJ($$SSN4^BPSSCRU2(BPDFN),6) ;4digits of SSN
"RTN","BPSSCR02",152,0)
 S X=X_" "_$$LJ($S(BPINSNM="":"????",1:BPINSNM),8) ;insurance
"RTN","BPSSCR02",153,0)
 S X=X_"/"_$$LJ($P(BPINS,U,3),14) ;phone
"RTN","BPSSCR02",154,0)
 Q X
"RTN","BPSSCR02",155,0)
 ;
"RTN","BPSSCR02",156,0)
 ;/**
"RTN","BPSSCR02",157,0)
 ;creates an entry in LM array and builds a non-standard index
"RTN","BPSSCR02",158,0)
 ;BPLMIND - passed by ref - current LM index - patient_AND_insurance level 
"RTN","BPSSCR02",159,0)
 ;BPDRIND - passed by ref - current LM index  - claim level 
"RTN","BPSSCR02",160,0)
 ;BPTMP - VALMAR (TMP global for LM)
"RTN","BPSSCR02",161,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCR02",162,0)
 ;BPLINE - line number in LM ARRAY (by ref)
"RTN","BPSSCR02",163,0)
 ;BPSTR - string to save in ARRAY
"RTN","BPSSCR02",164,0)
 ;BPSINSUR - INSURANCE ien
"RTN","BPSSCR02",165,0)
SAVEARR(BPTMP1,BPLMIND,BPDRIND,BPDFN,BP59,BPLINE,BPSSTR,BPSINSUR) ;
"RTN","BPSSCR02",166,0)
 S @BPTMP1@("LMIND",BPLMIND,BPDRIND,BPDFN,BPSINSUR,BP59,BPLINE)=""
"RTN","BPSSCR02",167,0)
 D SET^VALM10(BPLINE,BPSSTR,BP59)
"RTN","BPSSCR02",168,0)
 Q
"RTN","BPSSCR02",169,0)
 ;left justified, blank padded
"RTN","BPSSCR02",170,0)
 ;adds spaces on right or truncates to make return string BPLEN characters long
"RTN","BPSSCR02",171,0)
 ;BPST- original string
"RTN","BPSSCR02",172,0)
 ;BPLEN - desired length
"RTN","BPSSCR02",173,0)
LJ(BPST,BPLEN) ;
"RTN","BPSSCR02",174,0)
 N BPL
"RTN","BPSSCR02",175,0)
 S BPL=BPLEN-$L(BPST)
"RTN","BPSSCR02",176,0)
 Q $E(BPST_$J("",$S(BPL<0:0,1:BPL)),1,BPLEN)
"RTN","BPSSCR02",177,0)
 ;
"RTN","BPSSCR02",178,0)
 ;right justified, blank padded
"RTN","BPSSCR02",179,0)
 ;adds spaces on left or truncates to make return string BPLEN characters long
"RTN","BPSSCR02",180,0)
 ;BPST- original string
"RTN","BPSSCR02",181,0)
 ;BPLEN - desired length
"RTN","BPSSCR02",182,0)
RJ(BPST,BPLEN)  ;
"RTN","BPSSCR02",183,0)
 S BPL=BPLEN-$L(BPST)
"RTN","BPSSCR02",184,0)
 I BPL>0 Q $J("",$S(BPL<0:0,1:BPL))_BPST
"RTN","BPSSCR02",185,0)
 Q $E(BPST,1,BPLEN)
"RTN","BPSSCR02",186,0)
 ;
"RTN","BPSSCR02",187,0)
 ;is the claim payable?
"RTN","BPSSCR02",188,0)
PAYABLE(BP59) ;
"RTN","BPSSCR02",189,0)
 I $P($$CLAIMST^BPSSCRU3(BP59),U)["E PAYABLE" Q 1
"RTN","BPSSCR02",190,0)
 Q 0
"RTN","BPSSCR02",191,0)
 ;
"RTN","BPSSCR02",192,0)
 ;is the claim rejected?
"RTN","BPSSCR02",193,0)
REJECTED(BP59) ;
"RTN","BPSSCR02",194,0)
 I $P($$CLAIMST^BPSSCRU3(BP59),U)["E REJECTED" Q 1
"RTN","BPSSCR02",195,0)
 I $P($$CLAIMST^BPSSCRU3(BP59),U)["E REVERSAL REJECTED" Q 1
"RTN","BPSSCR02",196,0)
 Q 0
"RTN","BPSSCR02",197,0)
 ;update patient summary information for the previous patient/insurance pair
"RTN","BPSSCR02",198,0)
UPDPREV(BPTMP,BPLMIND,BPPREV) ;
"RTN","BPSSCR02",199,0)
 N BPSSTR
"RTN","BPSSCR02",200,0)
 ;update the record for previous patient summary after we went thru all his claims
"RTN","BPSSCR02",201,0)
 S BPSSTR=$$LJ^BPSSCR02(BPLMIND,4)_$P(BPPREV,U,4)_" "_$$STAT4PAT^BPSSCR02(BPLMIND)
"RTN","BPSSCR02",202,0)
 D SAVEARR^BPSSCR02(BPTMP,BPLMIND,0,+$P(BPPREV,U,3),0,+$P(BPPREV,U,2),BPSSTR,+$P(BPPREV,U,5))
"RTN","BPSSCR02",203,0)
 Q
"RTN","BPSSCR02",204,0)
 ;
"RTN","BPSSCR03")
0^327^B41992643
"RTN","BPSSCR03",1,0)
BPSSCR03 ;BHAM ISC/SS - ECME USR SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCR03",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCR03",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCR03",4,0)
 Q
"RTN","BPSSCR03",5,0)
 ;/**
"RTN","BPSSCR03",6,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCR03",7,0)
 ; BPARR to return formatted info via ref
"RTN","BPSSCR03",8,0)
 ; BPMLEM - max len for each line
"RTN","BPSSCR03",9,0)
 ; BPMODE - mode
"RTN","BPSSCR03",10,0)
 ;   R -regular for main screen, will show only latest comment
"RTN","BPSSCR03",11,0)
 ;   C - comment mode - show all comments
"RTN","BPSSCR03",12,0)
ADDINF(BP59,BPARR,BPMLEN,BPMODE) ;to return additional information about the claim*/
"RTN","BPSSCR03",13,0)
 N BPX,BPN,BPTXT1,BPTXT2,BPTXT3,BPTXT4,BPX1,BPPRCNTG,BPN2,BPSTATUS
"RTN","BPSSCR03",14,0)
 S BPN=0,(BPTXT1,BPTXT2,BPTXT3,BPTXT4,BPX1)=""
"RTN","BPSSCR03",15,0)
 I BPMODE="R" D 
"RTN","BPSSCR03",16,0)
 . S BPX=$$COMMENT^BPSSCRU3(BP59)
"RTN","BPSSCR03",17,0)
 . I $L(BPX)>0 S BPN=BPN+1,BPARR(BPN)=BPX
"RTN","BPSSCR03",18,0)
 E  D
"RTN","BPSSCR03",19,0)
 . N BPCMNT,BPX1 S BPCMNT=99999999
"RTN","BPSSCR03",20,0)
 . F  S BPCMNT=$O(^BPST(BP59,11,BPCMNT),-1) Q:+BPCMNT=0  D
"RTN","BPSSCR03",21,0)
 . . S BPX1=$G(^BPST(BP59,11,BPCMNT,0))
"RTN","BPSSCR03",22,0)
 . . I BPX1="" Q
"RTN","BPSSCR03",23,0)
 . . S BPX=$$DATTIM^BPSSCRU3($P(BPX1,U,1)\1)_" - "_$P(BPX1,U,3)
"RTN","BPSSCR03",24,0)
 . . I $L(BPX)>0 S BPN=BPN+1,BPARR(BPN)=BPX
"RTN","BPSSCR03",25,0)
 S BPX=$$CLAIMST^BPSSCRU3(BP59)
"RTN","BPSSCR03",26,0)
 S BPSTATUS=$P(BPX,U)
"RTN","BPSSCR03",27,0)
 S BPPRCNTG=$$LJ^BPSSCR02("("_$$PRCNTG^BPSSCRU3(BP59)_"%) ",6)
"RTN","BPSSCR03",28,0)
 ;I BPX["AR" S BPARR(BPN)="Auto-Reversal",BPN=BPN+1
"RTN","BPSSCR03",29,0)
 I BPSTATUS["E REVERSAL ACCEPTED" S BPTXT1=BPTXT1_"Reversal accepted "
"RTN","BPSSCR03",30,0)
 I BPSTATUS["E REVERSAL REJECTED" S BPTXT1=BPTXT1_"Reversal rejected "
"RTN","BPSSCR03",31,0)
 I BPSTATUS["E PAYABLE" S BPTXT1=BPTXT1_"Payable "
"RTN","BPSSCR03",32,0)
 I BPSTATUS["E REJECTED" S BPTXT1=BPTXT1_"Rejected "
"RTN","BPSSCR03",33,0)
 I BPSTATUS["E STRANDED" S BPTXT1=BPTXT1_"Stranded "
"RTN","BPSSCR03",34,0)
 I BPSTATUS["E REVERSAL STRANDED" S BPTXT1=BPTXT1_"Stranded reversal"
"RTN","BPSSCR03",35,0)
 I BPSTATUS["E CAPTURED" S BPTXT1=BPTXT1_"Captured "
"RTN","BPSSCR03",36,0)
 I BPSTATUS["E DUPLICATE" S BPTXT1=BPTXT1_"Duplicate "
"RTN","BPSSCR03",37,0)
 I BPSTATUS["E OTHER" S BPTXT1=BPTXT1_"Other "
"RTN","BPSSCR03",38,0)
 I BPSTATUS["IN PROGRESS" S BPTXT1=BPTXT1_"In progress "
"RTN","BPSSCR03",39,0)
 I BPSTATUS["CANCELLED" S BPTXT1=BPTXT1_"Cancelled "
"RTN","BPSSCR03",40,0)
 I BPSTATUS["CORRUPT" S BPTXT1=BPTXT1_"Corrupt "
"RTN","BPSSCR03",41,0)
 I BPTXT1="" S BPTXT1="Unknown status "
"RTN","BPSSCR03",42,0)
 ;
"RTN","BPSSCR03",43,0)
 I (BPSTATUS["E REJECTED")!(BPSTATUS["E REVERSAL REJECTED") D
"RTN","BPSSCR03",44,0)
 . I $L(BPTXT1)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT1
"RTN","BPSSCR03",45,0)
 . S BPTXT1=""
"RTN","BPSSCR03",46,0)
 . S BPN2=BPN
"RTN","BPSSCR03",47,0)
 . D GETRJCOD^BPSSCRU3(BP59,.BPARR,.BPN,74,"")
"RTN","BPSSCR03",48,0)
 . D WRAPLN2^BPSSCRU5(.BPN,.BPARR,$$GETMESS^BPSSCRU3(1000,504,BP59),74,"",0)
"RTN","BPSSCR03",49,0)
 . D WRAPLN2^BPSSCRU5(.BPN,.BPARR,$$GETMESS^BPSSCRU3(1000,526,BP59),74,"",0)
"RTN","BPSSCR03",50,0)
 . D WRAPLN2^BPSSCRU5(.BPN,.BPARR,$$GETMESS^BPSSCRU3(504,0,BP59),74,"",0)
"RTN","BPSSCR03",51,0)
 . I BPN>BPN2 Q  ;reject codes are enough
"RTN","BPSSCR03",52,0)
 . ;S BPX1=$P($P(BPX,U,3),"[") I BPTXT1=BPX1 S BPX1=""
"RTN","BPSSCR03",53,0)
 . S:BPX1="" BPX1=$$GETMESS^BPSSCRU3(504,0,BP59)
"RTN","BPSSCR03",54,0)
 . I $L(BPX1)>0 S BPTXT1=BPTXT1_"- "_$TR(BPX1,"]","")
"RTN","BPSSCR03",55,0)
 ;
"RTN","BPSSCR03",56,0)
 I (BPSTATUS["E OTHER")!(BPSTATUS["IN PROGRESS")!(BPSTATUS["E STRANDED")!(BPSTATUS["E CAPTURED")!(BPSTATUS["E REVERSAL STRANDED") D
"RTN","BPSSCR03",57,0)
 . I (BPSTATUS["E OTHER")!(BPSTATUS["IN PROGRESS") S BPX1=$P($P(BPX,U,3),"[") I BPTXT1=BPX1 S BPX1=""
"RTN","BPSSCR03",58,0)
 . S:BPX1="" BPX1=$$GETMESS^BPSSCRU3(504,0,BP59)
"RTN","BPSSCR03",59,0)
 . I $L(BPX1)>0 S BPTXT1=BPTXT1_"- "_$TR(BPX1,"]","")
"RTN","BPSSCR03",60,0)
 ;
"RTN","BPSSCR03",61,0)
 S BPTXT2=$E(BPTXT1,1,BPMLEN)
"RTN","BPSSCR03",62,0)
 S BPTXT3=$E(BPTXT1,BPMLEN+1,2*BPMLEN)
"RTN","BPSSCR03",63,0)
 S BPTXT4=$E(BPTXT1,(2*BPMLEN)+1,3*BPMLEN)
"RTN","BPSSCR03",64,0)
 I $L(BPTXT2)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT2
"RTN","BPSSCR03",65,0)
 I $L(BPTXT3)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT3
"RTN","BPSSCR03",66,0)
 I $L(BPTXT4)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT4
"RTN","BPSSCR03",67,0)
 Q BPN
"RTN","BPSSCR03",68,0)
 ;
"RTN","BPSSCR03",69,0)
CLMINF(BP59) ;ptr to #9002313.59
"RTN","BPSSCR03",70,0)
 W !,"Claim info. Press a key"
"RTN","BPSSCR03",71,0)
 D PAUSE^VALM1
"RTN","BPSSCR03",72,0)
 Q
"RTN","BPSSCR03",73,0)
 ;
"RTN","BPSSCR03",74,0)
 ;
"RTN","BPSSCR03",75,0)
COMM(BP59) ;ptr to #9002313.59
"RTN","BPSSCR03",76,0)
 W !,"the latest comment. Press a key"
"RTN","BPSSCR03",77,0)
 D PAUSE^VALM1
"RTN","BPSSCR03",78,0)
 Q
"RTN","BPSSCR03",79,0)
 ;
"RTN","BPSSCR03",80,0)
RESP(BP59) ;Payer Response Information
"RTN","BPSSCR03",81,0)
 W !,"payer Response Information. Press a key"
"RTN","BPSSCR03",82,0)
 D PAUSE^VALM1
"RTN","BPSSCR03",83,0)
 Q
"RTN","BPSSCR03",84,0)
 ;
"RTN","BPSSCR03",85,0)
 ;/**
"RTN","BPSSCR03",86,0)
 ;Checks if the CLAIM for specific Transaction is CLOSED?
"RTN","BPSSCR03",87,0)
 ;BPCLAIM - ptr to #9002313.02
"RTN","BPSSCR03",88,0)
 ;see also CLOSED^BPSSCRU1
"RTN","BPSSCR03",89,0)
CLOSED02(BPCLAIM) ;*/
"RTN","BPSSCR03",90,0)
 ; get closed status
"RTN","BPSSCR03",91,0)
 Q +$P($G(^BPSC(BPCLAIM,900)),U)=1  ;Q $$GET1^DIQ(9002313.02,CLAIM,901,"I")
"RTN","BPSSCR03",92,0)
 ;
"RTN","BPSSCR03",93,0)
 ;return:
"RTN","BPSSCR03",94,0)
 ; 1 - okay. matches criteria
"RTN","BPSSCR03",95,0)
 ; 0-  not okay, doesn't match criteria
"RTN","BPSSCR03",96,0)
FILTER(BP59,BPARR) ;
"RTN","BPSSCR03",97,0)
 N BPST0,BPST1,BPRXREF,BPRX52,BPREFNUM
"RTN","BPSSCR03",98,0)
 N BPRET
"RTN","BPSSCR03",99,0)
 S BPRET=1 ;1 - okay bt default
"RTN","BPSSCR03",100,0)
 S BPST0=$G(^BPST(BP59,0))
"RTN","BPSSCR03",101,0)
 S BPST1=$G(^BPST(BP59,1))
"RTN","BPSSCR03",102,0)
 S BPRXREF=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCR03",103,0)
 S BPRX52=+$P(BPRXREF,U) ;ptr to #52
"RTN","BPSSCR03",104,0)
 S BPREFNUM=$P(BPRXREF,U,2) ;refill #
"RTN","BPSSCR03",105,0)
 ;if closed
"RTN","BPSSCR03",106,0)
 I $$CLOSED02(+$P(BPST0,U,4)) Q 0
"RTN","BPSSCR03",107,0)
 ;user
"RTN","BPSSCR03",108,0)
 I $G(BPARR(1.01))="U",$$FLTUSR(BPST0,.BPARR)=0 Q 0
"RTN","BPSSCR03",109,0)
 ;patient
"RTN","BPSSCR03",110,0)
 I $G(BPARR(1.02))="P",$$FLTPAT(BPST0,.BPARR)=0 Q 0
"RTN","BPSSCR03",111,0)
 ;RX
"RTN","BPSSCR03",112,0)
 I $G(BPARR(1.03))="R",$$FLTRX(BPST1,.BPARR)=0 Q 0
"RTN","BPSSCR03",113,0)
 ;only rejected
"RTN","BPSSCR03",114,0)
 I $G(BPARR(1.06))="R",$$REJECTED^BPSSCR02(BP59)=0 Q 0
"RTN","BPSSCR03",115,0)
 ;only payable
"RTN","BPSSCR03",116,0)
 I $G(BPARR(1.06))="P",$$PAYABLE^BPSSCR02(BP59)=0 Q 0
"RTN","BPSSCR03",117,0)
 ;released
"RTN","BPSSCR03",118,0)
 I $G(BPARR(1.07))="R",$$RL^BPSSCRU2(BP59)'="RL" Q 0
"RTN","BPSSCR03",119,0)
 ;non released
"RTN","BPSSCR03",120,0)
 I $G(BPARR(1.07))="N",$$RL^BPSSCRU2(BP59)="RL" Q 0
"RTN","BPSSCR03",121,0)
 ;window/cmop/mail
"RTN","BPSSCR03",122,0)
 I $G(BPARR(1.08))'="A",$$ISMWC(BPRX52,BPREFNUM,$G(BPARR(1.08)))=0 Q 0
"RTN","BPSSCR03",123,0)
 ;Back billing
"RTN","BPSSCR03",124,0)
 I $G(BPARR(1.09))="B",$$RTBB^BPSSCRU2(BP59)'="BB" Q 0
"RTN","BPSSCR03",125,0)
 ;real time
"RTN","BPSSCR03",126,0)
 I $G(BPARR(1.09))="R",$$RTBB^BPSSCRU2(BP59)="BB" Q 0
"RTN","BPSSCR03",127,0)
 ;if only rejected and only specific rejected codes should be displayed
"RTN","BPSSCR03",128,0)
 I $G(BPARR(1.06))="R",$G(BPARR(1.1))="R",$$FLTREJ(BP59,.BPARR)=0 Q 0
"RTN","BPSSCR03",129,0)
 ;insurance 
"RTN","BPSSCR03",130,0)
 I $G(BPARR(1.11))="I",$G(BPARR(1.14))'="",$P($$GETINSUR^BPSSCRU2(+BP59),U,2)'=$G(BPARR(1.14)) Q 0
"RTN","BPSSCR03",131,0)
 ;divisions - ECME pharmacies
"RTN","BPSSCR03",132,0)
 I $G(BPARR(1.13))="D",BPARR("DIVS")'[(";"_$P(BPST1,U,7)_";") Q 0
"RTN","BPSSCR03",133,0)
 Q 1
"RTN","BPSSCR03",134,0)
 ;
"RTN","BPSSCR03",135,0)
 ;check user filter
"RTN","BPSSCR03",136,0)
 ;input:
"RTN","BPSSCR03",137,0)
 ;BPST0 - zero node of #9002313.59
"RTN","BPSSCR03",138,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",139,0)
 ;returns :
"RTN","BPSSCR03",140,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",141,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",142,0)
FLTUSR(BPST0,BPARR) ;
"RTN","BPSSCR03",143,0)
 I $L($G(BPARR(1.16)))=0 Q 0
"RTN","BPSSCR03",144,0)
 I $P(BPST0,U,10)'=$G(BPARR(1.16)) Q 0
"RTN","BPSSCR03",145,0)
 Q 1
"RTN","BPSSCR03",146,0)
 ;check patient filter
"RTN","BPSSCR03",147,0)
 ;input:
"RTN","BPSSCR03",148,0)
 ;BPST0 - zero node of #9002313.59
"RTN","BPSSCR03",149,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",150,0)
 ;returns :
"RTN","BPSSCR03",151,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",152,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",153,0)
FLTPAT(BPST0,BPARR) ;
"RTN","BPSSCR03",154,0)
 I $L($G(BPARR(1.17)))=0 Q 0
"RTN","BPSSCR03",155,0)
 I $P(BPST0,U,6)'=$G(BPARR(1.17)) Q 0
"RTN","BPSSCR03",156,0)
 Q 1
"RTN","BPSSCR03",157,0)
 ;check RX filter
"RTN","BPSSCR03",158,0)
 ;input:
"RTN","BPSSCR03",159,0)
 ;BPST1 - 1st node of #9002313.59
"RTN","BPSSCR03",160,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",161,0)
 ;returns :
"RTN","BPSSCR03",162,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",163,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",164,0)
FLTRX(BPST1,BPARR) ;
"RTN","BPSSCR03",165,0)
 I $L($G(BPARR(1.18)))=0 Q 0
"RTN","BPSSCR03",166,0)
 I $P(BPST1,U,11)'=$G(BPARR(1.18)) Q 0
"RTN","BPSSCR03",167,0)
 Q 1
"RTN","BPSSCR03",168,0)
 ;input:
"RTN","BPSSCR03",169,0)
 ;BP59 - zero node of #9002313.59
"RTN","BPSSCR03",170,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",171,0)
 ;returns :
"RTN","BPSSCR03",172,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",173,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",174,0)
FLTREJ(BP59,BPARR) ;
"RTN","BPSSCR03",175,0)
 N BPRCODES
"RTN","BPSSCR03",176,0)
 N BPRJCD
"RTN","BPSSCR03",177,0)
 S BPRJCD=$P($G(^BPSF(9002313.93,+$G(BPARR(1.15)),0)),U)
"RTN","BPSSCR03",178,0)
 I $L(BPRJCD)=0 Q 0
"RTN","BPSSCR03",179,0)
 D REJCODES^BPSSCRU3(BP59,.BPRCODES)
"RTN","BPSSCR03",180,0)
 I $D(BPRCODES(BPRJCD)) Q 1
"RTN","BPSSCR03",181,0)
 Q 0
"RTN","BPSSCR03",182,0)
 ;check W(indow)/C(mop)/M(ail)
"RTN","BPSSCR03",183,0)
 ;input:
"RTN","BPSSCR03",184,0)
 ;BPRX52 - ptr to #52
"RTN","BPSSCR03",185,0)
 ;BPREFNUM - refill #
"RTN","BPSSCR03",186,0)
 ;BPMWC - given value from CMOP/MAIL/WINDOW instance 1.08 of BPS USRSCR parameters
"RTN","BPSSCR03",187,0)
 ;returns :
"RTN","BPSSCR03",188,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",189,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",190,0)
ISMWC(BPRX52,BPREFNUM,BPMWC) ;
"RTN","BPSSCR03",191,0)
 I $$MWCNAME^BPSSCRU2($$MWC^BPSSCRU2(BPRX52,BPREFNUM))=BPMWC Q 1
"RTN","BPSSCR03",192,0)
 Q 0
"RTN","BPSSCR03",193,0)
 ;
"RTN","BPSSCR03",194,0)
FILTRALL(BPTMP1,BPTMP2,BPARR) ;
"RTN","BPSSCR03",195,0)
 N BP59
"RTN","BPSSCR03",196,0)
 S BP59=0
"RTN","BPSSCR03",197,0)
 F  S BP59=+$O(@BPTMP1@(BP59)) Q:+BP59=0  D
"RTN","BPSSCR03",198,0)
 . I $$FILTER(BP59,.BPARR) S @BPTMP2@(BP59)=""
"RTN","BPSSCR03",199,0)
 Q
"RTN","BPSSCR03",200,0)
 ;
"RTN","BPSSCR03",201,0)
 ;go thru all FILE59 entries and run SETTRDFN for each of them
"RTN","BPSSCR03",202,0)
 ;
"RTN","BPSSCR03",203,0)
TRDFNALL(BPTMP) ;
"RTN","BPSSCR03",204,0)
 N BP59
"RTN","BPSSCR03",205,0)
 S BP59=0
"RTN","BPSSCR03",206,0)
 F  S BP59=+$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR03",207,0)
 . D SETTRDFN(BPTMP,BP59)
"RTN","BPSSCR03",208,0)
 Q
"RTN","BPSSCR03",209,0)
 ;
"RTN","BPSSCR03",210,0)
 ;sorting for "TRANSACTION DATE" type is 
"RTN","BPSSCR03",211,0)
 ;actually sorting by patients , but patient should be sorted not in alphabetical order:
"RTN","BPSSCR03",212,0)
 ;the first patient is the one which has the most recent transaction and so on
"RTN","BPSSCR03",213,0)
 ;BPTMP - TMP global
"RTN","BPSSCR03",214,0)
 ;BP59 - ptr to #9002313.59
"RTN","BPSSCR03",215,0)
SETTRDFN(BPTMP,BP59) ;
"RTN","BPSSCR03",216,0)
 ;the following stores the latest transaction date of the claims, which 
"RTN","BPSSCR03",217,0)
 ;was found for this particular combination of patient and insurance
"RTN","BPSSCR03",218,0)
 ;@BPTMP@("DFN-TRDT",BPDFN,BPINSUR)=BPTRDT
"RTN","BPSSCR03",219,0)
 ;the following stores the latest transaction date BPTRDT,patient BPDFN and
"RTN","BPSSCR03",220,0)
 ;insurance BPINSUR to provide a proper order
"RTN","BPSSCR03",221,0)
 ;@BPTMP@("TRDTDFN",BPTRDT,BPDFN,BPINSUR)=""
"RTN","BPSSCR03",222,0)
 N BPZERO,BPTRDT,BPDFN,BPPREV,BPINSUR
"RTN","BPSSCR03",223,0)
 S BPZERO=$G(^BPST(BP59,0)) ;
"RTN","BPSSCR03",224,0)
 S BPTRDT=-$P(BPZERO,U,8) ;"transaction" date
"RTN","BPSSCR03",225,0)
 S BPDFN=+$P(BPZERO,U,6) ;patient ptr to #2
"RTN","BPSSCR03",226,0)
 S BPINSUR=+$$GETINSUR^BPSSCRU2(BP59) ;insurance ien
"RTN","BPSSCR03",227,0)
 ;in the beginning we don't have any "DFN-TRDT" and "TRDTDFN"
"RTN","BPSSCR03",228,0)
 ;so create them and quit
"RTN","BPSSCR03",229,0)
 I '$D(@BPTMP@("DFN-TRDT",BPDFN,BPINSUR)) D  Q
"RTN","BPSSCR03",230,0)
 . S @BPTMP@("DFN-TRDT",BPDFN,BPINSUR)=BPTRDT
"RTN","BPSSCR03",231,0)
 . S @BPTMP@("TRDTDFN",BPTRDT,BPDFN,BPINSUR)=""
"RTN","BPSSCR03",232,0)
 ;if we already have them then get the latest into BPPREV
"RTN","BPSSCR03",233,0)
 S BPPREV=+$G(@BPTMP@("DFN-TRDT",BPDFN,BPINSUR))
"RTN","BPSSCR03",234,0)
 ;and compare it against the BPTRDT for this BP59
"RTN","BPSSCR03",235,0)
 ;if the BPTRDT is greater then replace the values in "DFN-TRDT" 
"RTN","BPSSCR03",236,0)
 ;and "TRDTDFN"
"RTN","BPSSCR03",237,0)
 I BPTRDT<BPPREV D
"RTN","BPSSCR03",238,0)
 . S @BPTMP@("TRDTDFN",BPTRDT,BPDFN,BPINSUR)=""
"RTN","BPSSCR03",239,0)
 . S @BPTMP@("DFN-TRDT",BPDFN,BPINSUR)=BPTRDT
"RTN","BPSSCR03",240,0)
 . K @BPTMP@("TRDTDFN",BPPREV,BPDFN,BPINSUR)
"RTN","BPSSCR03",241,0)
 Q
"RTN","BPSSCR03",242,0)
 ;
"RTN","BPSSCR04")
0^328^B53493925
"RTN","BPSSCR04",1,0)
BPSSCR04 ;BHAM ISC/SS - USER SCREEN ;14-FEB-05
"RTN","BPSSCR04",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCR04",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCR04",4,0)
 ;USER SCREEN
"RTN","BPSSCR04",5,0)
 Q
"RTN","BPSSCR04",6,0)
 ;input:
"RTN","BPSSCR04",7,0)
 ;BPTMP - TMP global to store data (example : $NA(^TMP($J,"BPSSCR")))
"RTN","BPSSCR04",8,0)
 ;BPARR - array with user profile information
"RTN","BPSSCR04",9,0)
COLLECT(BPTMP,BPARR) ;
"RTN","BPSSCR04",10,0)
 N BPBDT,BPEDT,BPSORT
"RTN","BPSSCR04",11,0)
 S BPBDT=BPARR("BDT") ;start date
"RTN","BPSSCR04",12,0)
 S BPEDT=BPARR("EDT") ;end date
"RTN","BPSSCR04",13,0)
 ;sort type - see SORTIT()
"RTN","BPSSCR04",14,0)
 S BPSORT=$G(BPARR(1.12))
"RTN","BPSSCR04",15,0)
 S:BPSORT="" BPSORT="T" ;default
"RTN","BPSSCR04",16,0)
 ;kill TMP
"RTN","BPSSCR04",17,0)
 ;look for  claims in 3 files
"RTN","BPSSCR04",18,0)
 ;temporary TMP file
"RTN","BPSSCR04",19,0)
 N BPTMP1 S BPTMP1=$NA(@BPTMP@("PRE59"))
"RTN","BPSSCR04",20,0)
 N BPTMP2 S BPTMP2=$NA(@BPTMP@("FILE59"))
"RTN","BPSSCR04",21,0)
 K @BPTMP1
"RTN","BPSSCR04",22,0)
 K @BPTMP2
"RTN","BPSSCR04",23,0)
 ;
"RTN","BPSSCR04",24,0)
 D LOOK02(BPBDT,BPEDT,BPTMP1,BPSORT)
"RTN","BPSSCR04",25,0)
 D LOOK57(BPBDT,BPEDT,BPTMP1,BPSORT)
"RTN","BPSSCR04",26,0)
 D LOOK59(BPBDT,BPEDT,BPTMP1,BPSORT)
"RTN","BPSSCR04",27,0)
 ;remove all claims that don't match filter criteria
"RTN","BPSSCR04",28,0)
 D FILTRALL^BPSSCR03(BPTMP1,BPTMP2,.BPARR)
"RTN","BPSSCR04",29,0)
 ;preliminary sorting for "T" sorting type
"RTN","BPSSCR04",30,0)
 I BPSORT="T" D TRDFNALL^BPSSCR03(BPTMP)
"RTN","BPSSCR04",31,0)
 ;final sorting 
"RTN","BPSSCR04",32,0)
 D SORTIT(BPTMP,BPSORT)
"RTN","BPSSCR04",33,0)
 K @BPTMP1
"RTN","BPSSCR04",34,0)
 K @BPTMP2
"RTN","BPSSCR04",35,0)
 Q
"RTN","BPSSCR04",36,0)
 ;Input:
"RTN","BPSSCR04",37,0)
 ;BPTMP - TMP global to store data (example : $NA(^TMP($J,"BPSSCR")))
"RTN","BPSSCR04",38,0)
 ;BPSORT:
"RTN","BPSSCR04",39,0)
 ;'T' FOR TRANSACTION DATE
"RTN","BPSSCR04",40,0)
 ;'D' FOR DIVISION (ECME pharmacy)
"RTN","BPSSCR04",41,0)
 ;'I' FOR INSURANCE
"RTN","BPSSCR04",42,0)
 ;'C' FOR REJECT CODE 
"RTN","BPSSCR04",43,0)
 ;'P' FOR PATIENT NAME
"RTN","BPSSCR04",44,0)
 ;'N' FOR DRUG NAME
"RTN","BPSSCR04",45,0)
 ;'B' FOR BILL TYPE (BB/RT)
"RTN","BPSSCR04",46,0)
 ;'L' FOR FILL LOCATION (Windows/Mail/CMOP) 
"RTN","BPSSCR04",47,0)
 ;'R' FOR RELEASED/NON-RELEASED RX
"RTN","BPSSCR04",48,0)
 ;'A' FOR ACTIVE/DISCONTINUED RX
"RTN","BPSSCR04",49,0)
 ;sort it and prepare the TMP for the user screen
"RTN","BPSSCR04",50,0)
SORTIT(BPTMP,BPSORT) ;*/
"RTN","BPSSCR04",51,0)
 ;S BP59=+$G(^TMP($J,"BPSSCR","SRT",BPSRT))
"RTN","BPSSCR04",52,0)
 ;BPSORT:
"RTN","BPSSCR04",53,0)
 ;TRANSACTION DATE - the last time when the record 
"RTN","BPSSCR04",54,0)
 ;in the file #9002313.59 -- BPS TRANSACTION FILE has been updated
"RTN","BPSSCR04",55,0)
 ;F   S X=$O(@BPTMP@("SRT",BPSRT))
"RTN","BPSSCR04",56,0)
 K @BPTMP@("SORT")
"RTN","BPSSCR04",57,0)
 N BPSRTVAL,BPTRDT,BP59,BPDFN,BPIEN,BPIENNM
"RTN","BPSSCR04",58,0)
 S BP59=0
"RTN","BPSSCR04",59,0)
 ;by transaction date -- sort by the patient/insurance combinations,
"RTN","BPSSCR04",60,0)
 ;which might have more than one claims. 
"RTN","BPSSCR04",61,0)
 ;- the first on the top will be the one which has the claim(s) with the 
"RTN","BPSSCR04",62,0)
 ;  most recent date (other claims in this group can have any other date)
"RTN","BPSSCR04",63,0)
 I BPSORT="T" D
"RTN","BPSSCR04",64,0)
 . D MKPATINS(BPTMP) ;1st step
"RTN","BPSSCR04",65,0)
 . D MKTRSORT(BPTMP) ;2nd step
"RTN","BPSSCR04",66,0)
 ;by patient name (and his/her insurances)
"RTN","BPSSCR04",67,0)
 I BPSORT="P" D
"RTN","BPSSCR04",68,0)
 . D MKNAMINS(BPTMP) ;1st step
"RTN","BPSSCR04",69,0)
 . D MKPTSORT(BPTMP) ;2nd step
"RTN","BPSSCR04",70,0)
 ;by insurance
"RTN","BPSSCR04",71,0)
 ;(the name will be shortened up to 10 chars and its 
"RTN","BPSSCR04",72,0)
 ;IEN is added to make the string unique) 
"RTN","BPSSCR04",73,0)
 I BPSORT="I" D
"RTN","BPSSCR04",74,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",75,0)
 . . S BPIEN=$$GETINSUR^BPSSCRU2(+BP59)
"RTN","BPSSCR04",76,0)
 . . S BPIENNM=$S(+BPIEN>0:$E($P(BPIEN,U,2),1,10)_U_(+BPIEN),1:"0")
"RTN","BPSSCR04",77,0)
 . . D SETSORT(BPTMP,BPSORT,BPIENNM,BP59)
"RTN","BPSSCR04",78,0)
 ;by division
"RTN","BPSSCR04",79,0)
 ;(the name will be shortened up to 10 chars and its 
"RTN","BPSSCR04",80,0)
 ;IEN is added to make the string unique) 
"RTN","BPSSCR04",81,0)
 I BPSORT="D" D
"RTN","BPSSCR04",82,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",83,0)
 . . S BPIEN=+$$DIVIS^BPSSCRU2(+BP59)
"RTN","BPSSCR04",84,0)
 . . S BPIENNM=$S(BPIEN>0:$E($$DIVNAME^BPSSCRDS(BPIEN),1,10)_U_(BPIEN),1:"0")
"RTN","BPSSCR04",85,0)
 . . D SETSORT(BPTMP,BPSORT,BPIENNM,BP59)
"RTN","BPSSCR04",86,0)
 ;by reject code
"RTN","BPSSCR04",87,0)
 ;the same claim can be listed more than once (under different reject code
"RTN","BPSSCR04",88,0)
 ;sections) because each claim may have more than one reject code.
"RTN","BPSSCR04",89,0)
 I BPSORT="C" D
"RTN","BPSSCR04",90,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",91,0)
 . . N BPRJCDS,BPRJ
"RTN","BPSSCR04",92,0)
 . . D REJCODES^BPSSCRU3(+BP59,.BPRJCDS)
"RTN","BPSSCR04",93,0)
 . . S BPRJ=""
"RTN","BPSSCR04",94,0)
 . . F  S BPRJ=$O(BPRJCDS(BPRJ)) Q:BPRJ=""  D
"RTN","BPSSCR04",95,0)
 . . . D SETSORT(BPTMP,BPSORT,BPRJ,BP59)
"RTN","BPSSCR04",96,0)
 ;by drug names 
"RTN","BPSSCR04",97,0)
 ;(the name will be shortened upto 10 chars and its 
"RTN","BPSSCR04",98,0)
 ;IEN is added to make the string unique) 
"RTN","BPSSCR04",99,0)
 I BPSORT="N" D
"RTN","BPSSCR04",100,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",101,0)
 . . S BPIEN=+$$GETDRG59^BPSSCRU2(+BP59)
"RTN","BPSSCR04",102,0)
 . . S BPIENNM=$S(BPIEN>0:$E($$DRGNAM^BPSSCRU2(BPIEN),1,10)_U_(BPIEN),1:"0")
"RTN","BPSSCR04",103,0)
 . . D SETSORT(BPTMP,BPSORT,BPIENNM,BP59)
"RTN","BPSSCR04",104,0)
 ;by claim origination type (BB- backbilling, RT- realtime)
"RTN","BPSSCR04",105,0)
 I BPSORT="B" D
"RTN","BPSSCR04",106,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",107,0)
 . . D SETSORT(BPTMP,BPSORT,$$RTBB^BPSSCRU2(+BP59),BP59)
"RTN","BPSSCR04",108,0)
 ;by filling location 
"RTN","BPSSCR04",109,0)
 ;M-MAIL/W-WINDOW/C-CMOP
"RTN","BPSSCR04",110,0)
 I BPSORT="L" D
"RTN","BPSSCR04",111,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",112,0)
 . . D SETSORT(BPTMP,BPSORT,$$MWCNAME^BPSSCRU2($$GETMWC^BPSSCRU2(+BP59)),BP59)
"RTN","BPSSCR04",113,0)
 ;by released (1) /non released (0)
"RTN","BPSSCR04",114,0)
 I BPSORT="R" D
"RTN","BPSSCR04",115,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",116,0)
 . . D SETSORT(BPTMP,BPSORT,$$ISRXREL^BPSSCRU2(+BP59),BP59)
"RTN","BPSSCR04",117,0)
 ;by status of the fill ACT-active/DIS-discontinued/SUS-suspended/etc
"RTN","BPSSCR04",118,0)
 I BPSORT="A" D
"RTN","BPSSCR04",119,0)
 . F  S BP59=$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",120,0)
 . . D SETSORT(BPTMP,BPSORT,$$RXST^BPSSCRU2(+BP59),BP59)
"RTN","BPSSCR04",121,0)
 ;
"RTN","BPSSCR04",122,0)
 ;K @BPTMP@("FILE59")
"RTN","BPSSCR04",123,0)
 Q
"RTN","BPSSCR04",124,0)
 ;set SORT node
"RTN","BPSSCR04",125,0)
SETSORT(BPTMP,BPSORT,BPSRTVAL,BP59) ;*/
"RTN","BPSSCR04",126,0)
 S:$L(BPSRTVAL)>0 @BPTMP@("SORT",BPSORT,BPSRTVAL,BP59)=""
"RTN","BPSSCR04",127,0)
 Q
"RTN","BPSSCR04",128,0)
 ;first look at ^BPSC (#9002313.02) for fill/refill x-ref
"RTN","BPSSCR04",129,0)
 ; since #9002313.57 is not created at the time of refill
"RTN","BPSSCR04",130,0)
 ; and since #9002313.59 has the last update date, which can be any kind of date (released/reversal/etc)
"RTN","BPSSCR04",131,0)
 ;BPBEGDT - start date
"RTN","BPSSCR04",132,0)
 ;BPENDDT - end date
"RTN","BPSSCR04",133,0)
 ;BPTMP - tmp global for items found
"RTN","BPSSCR04",134,0)
 ;BPSORT - sort type (see COLLECT^BPSSCR04)
"RTN","BPSSCR04",135,0)
LOOK02(BPBEGDT,BPENDDT,BPTMP,BPSORT) ;
"RTN","BPSSCR04",136,0)
 N BP02,BPENDDT1,BPLDT02,BP59
"RTN","BPSSCR04",137,0)
 S BP59=0
"RTN","BPSSCR04",138,0)
 S BPLDT02=$$FM2YMD(BPBEGDT-0.00001)
"RTN","BPSSCR04",139,0)
 S BPENDDT1=$$FM2YMD(BPENDDT)
"RTN","BPSSCR04",140,0)
 I BPLDT02="" S BPLDT02=0
"RTN","BPSSCR04",141,0)
 I BPENDDT1="" S BPENDDT1=99999999
"RTN","BPSSCR04",142,0)
 F  S BPLDT02=+$O(^BPSC("AF",BPLDT02)) Q:BPLDT02=0!(BPLDT02>BPENDDT1)  D
"RTN","BPSSCR04",143,0)
 . S BP02=0 F  S BP02=$O(^BPSC("AF",BPLDT02,BP02)) Q:+BP02=0  D
"RTN","BPSSCR04",144,0)
 . . S BP59=+$O(^BPST("AE",BP02,0))
"RTN","BPSSCR04",145,0)
 . . Q:BP59=0
"RTN","BPSSCR04",146,0)
 . . I $D(@BPTMP@(BP59)) Q
"RTN","BPSSCR04",147,0)
 . . S @BPTMP@(BP59)=$$YMD2FM(BPLDT02)_"^02"
"RTN","BPSSCR04",148,0)
 Q
"RTN","BPSSCR04",149,0)
 ; finds claims in  #9002313.57 for given date frame
"RTN","BPSSCR04",150,0)
 ;#9002313.59 has only one entry per claim with, which has a date 
"RTN","BPSSCR04",151,0)
 ;  of the latest update for the claim
"RTN","BPSSCR04",152,0)
 ;#9002313.57 has more than one entries per claim and keep all 
"RTN","BPSSCR04",153,0)
 ;  changes made the claim
"RTN","BPSSCR04",154,0)
 ;so we have to go thru #9002313.57 to find the earliest date 
"RTN","BPSSCR04",155,0)
 ;related to the claim to check it against BPBEGDT
"RTN","BPSSCR04",156,0)
 ;BPBEGDT - start date
"RTN","BPSSCR04",157,0)
 ;BPENDDT - end date
"RTN","BPSSCR04",158,0)
 ;BPTMP - tmp global for items found
"RTN","BPSSCR04",159,0)
 ;BPSORT - sort type (see COLLECT^BPSSCR04)
"RTN","BPSSCR04",160,0)
LOOK57(BPBEGDT,BPENDDT,BPTMP,BPSORT) ;
"RTN","BPSSCR04",161,0)
 N BPLDT57,BP57,BP59
"RTN","BPSSCR04",162,0)
 S BPLDT57=BPBEGDT-0.00001
"RTN","BPSSCR04",163,0)
 F  S BPLDT57=+$O(^BPSTL("AH",BPLDT57)) Q:BPLDT57=0!(BPLDT57>BPENDDT)  D
"RTN","BPSSCR04",164,0)
 . S BP57=0 F  S BP57=$O(^BPSTL("AH",BPLDT57,BP57)) Q:+BP57=0  D
"RTN","BPSSCR04",165,0)
 . . S BP59=+$G(^BPSTL(BP57,0))
"RTN","BPSSCR04",166,0)
 . . I $D(@BPTMP@(BP59)) Q  ;don't create an entry if the claim is already there
"RTN","BPSSCR04",167,0)
 . . S @BPTMP@(BP59)=(BPLDT57\1)_"^57-"
"RTN","BPSSCR04",168,0)
 Q
"RTN","BPSSCR04",169,0)
 ; finds claims in  #9002313.59 for given date frame
"RTN","BPSSCR04",170,0)
 ;#9002313.59 has only one entry per claim with, which has a date 
"RTN","BPSSCR04",171,0)
 ;  of the latest update for the claim
"RTN","BPSSCR04",172,0)
 ;#9002313.57 has more than one entries per claim and keep all 
"RTN","BPSSCR04",173,0)
 ;  changes made the claim
"RTN","BPSSCR04",174,0)
 ;so we have to go thru #9002313.57 to find the earliest date 
"RTN","BPSSCR04",175,0)
 ;related to the claim to check it against BPBEGDT
"RTN","BPSSCR04",176,0)
 ;BPBEGDT - start date
"RTN","BPSSCR04",177,0)
 ;BPENDDT - end date
"RTN","BPSSCR04",178,0)
 ;BPTMP - tmp global for items found
"RTN","BPSSCR04",179,0)
 ;BPSORT - sort type (see COLLECT^BPSSCR04)
"RTN","BPSSCR04",180,0)
LOOK59(BPBEGDT,BPENDDT,BPTMP,BPSORT) ;
"RTN","BPSSCR04",181,0)
 N BPLDT59,BP59
"RTN","BPSSCR04",182,0)
 S BPLDT59=BPBEGDT-0.00001
"RTN","BPSSCR04",183,0)
 F  S BPLDT59=+$O(^BPST("AH",BPLDT59)) Q:BPLDT59=0!(BPLDT59>BPENDDT)  D
"RTN","BPSSCR04",184,0)
 . S BP59=0 F  S BP59=$O(^BPST("AH",BPLDT59,BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",185,0)
 . . I $D(@BPTMP@(BP59)) Q  ;don't create an entry if the claim is already there
"RTN","BPSSCR04",186,0)
 . . S @BPTMP@(BP59)=(BPLDT59\1)_"^59-"
"RTN","BPSSCR04",187,0)
 Q
"RTN","BPSSCR04",188,0)
 ;
"RTN","BPSSCR04",189,0)
YMD2FM(BPYMD) ;convert YYYYDDMM to FM date
"RTN","BPSSCR04",190,0)
 Q (($E(BPYMD,1,4))-1700)_$E(BPYMD,5,8)
"RTN","BPSSCR04",191,0)
 ;
"RTN","BPSSCR04",192,0)
FM2YMD(BPFMDT) ;convert FM date to YYYYMMDD
"RTN","BPSSCR04",193,0)
 N Y,Y1
"RTN","BPSSCR04",194,0)
 S Y=$E(BPFMDT,2,3),Y1=$E(BPFMDT,1,1) S Y=$S(Y1=3:"20"_Y,Y1=2:"19"_Y,1:"")
"RTN","BPSSCR04",195,0)
 Q:Y Y_$E(BPFMDT,4,7)
"RTN","BPSSCR04",196,0)
 Q ""
"RTN","BPSSCR04",197,0)
 ;make PATIENT -INSURANCE intermediate SORTING
"RTN","BPSSCR04",198,0)
 ;global for transaction and patient sortings (1st pass)
"RTN","BPSSCR04",199,0)
 ;example:
"RTN","BPSSCR04",200,0)
 ;@BPTMP@("SORT","PI",BPDFN,BPINS,BP59)=""
"RTN","BPSSCR04",201,0)
MKPATINS(BPTMP) ;
"RTN","BPSSCR04",202,0)
 N BPSRTVAL,BPTRDT,BP59,BPDFN,BPINS
"RTN","BPSSCR04",203,0)
 S BP59=0
"RTN","BPSSCR04",204,0)
 F  S BP59=+$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",205,0)
 . S BPDFN=+$$GETPATID^BPSSCRU2(BP59)
"RTN","BPSSCR04",206,0)
 . Q:BPDFN=0
"RTN","BPSSCR04",207,0)
 . S BPINS=+$$GETINSUR^BPSSCRU2(BP59)
"RTN","BPSSCR04",208,0)
 . S @BPTMP@("SORT","PI",BPDFN,BPINS,BP59)=""
"RTN","BPSSCR04",209,0)
 Q
"RTN","BPSSCR04",210,0)
 ;make PATIENT NAME -INSURANCE intermediate SORTING
"RTN","BPSSCR04",211,0)
 ;global for transaction and patient sortings (1st pass)
"RTN","BPSSCR04",212,0)
 ;example:
"RTN","BPSSCR04",213,0)
 ;@BPTMP@("SORT","PNI",BPDFN,BPINS,BP59)=""
"RTN","BPSSCR04",214,0)
MKNAMINS(BPTMP) ;
"RTN","BPSSCR04",215,0)
 N BPSRTVAL,BPTRDT,BP59,BPDFN,BPINS
"RTN","BPSSCR04",216,0)
 S BP59=0
"RTN","BPSSCR04",217,0)
 F  S BP59=+$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",218,0)
 . S BPDFN=+$$GETPATID^BPSSCRU2(BP59)
"RTN","BPSSCR04",219,0)
 . Q:BPDFN=0
"RTN","BPSSCR04",220,0)
 . S BPINS=+$$GETINSUR^BPSSCRU2(BP59)
"RTN","BPSSCR04",221,0)
 . S @BPTMP@("SORT","PNI",$E($$PATNAME^BPSSCRU2(BPDFN),1,20),BPINS,BP59)=""
"RTN","BPSSCR04",222,0)
 Q
"RTN","BPSSCR04",223,0)
 ;Transaction type sorting - the 2nd pass
"RTN","BPSSCR04",224,0)
 ;is called after MKPATINS
"RTN","BPSSCR04",225,0)
MKTRSORT(BPTMP) ;
"RTN","BPSSCR04",226,0)
 N BPSRTVAL,BPTRDT,BP59,BPDFN,BPINS
"RTN","BPSSCR04",227,0)
 S BPTRDT=-99999999,BPSRTVAL=0
"RTN","BPSSCR04",228,0)
 F  S BPTRDT=$O(@BPTMP@("TRDTDFN",BPTRDT)) Q:+BPTRDT=0  D
"RTN","BPSSCR04",229,0)
 . S BPDFN=0
"RTN","BPSSCR04",230,0)
 . F  S BPDFN=$O(@BPTMP@("TRDTDFN",BPTRDT,BPDFN)) Q:+BPDFN=0  D
"RTN","BPSSCR04",231,0)
 . . S BPINS=""
"RTN","BPSSCR04",232,0)
 . . F  S BPINS=$O(@BPTMP@("TRDTDFN",BPTRDT,BPDFN,BPINS)) Q:BPINS=""  D
"RTN","BPSSCR04",233,0)
 . . . S BPSRTVAL=BPSRTVAL+1,BPINS=+BPINS
"RTN","BPSSCR04",234,0)
 . . . S BP59=0
"RTN","BPSSCR04",235,0)
 . . . F  S BP59=$O(@BPTMP@("SORT","PI",BPDFN,BPINS,BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",236,0)
 . . . . D SETSORT(BPTMP,"T",BPSRTVAL,BP59)
"RTN","BPSSCR04",237,0)
 Q
"RTN","BPSSCR04",238,0)
 ;Patient type sorting - the 2nd pass
"RTN","BPSSCR04",239,0)
 ;is called after MKPATINS
"RTN","BPSSCR04",240,0)
MKPTSORT(BPTMP) ;
"RTN","BPSSCR04",241,0)
 N BPSRTVAL,BPTRDT,BP59,BPPATNAM,BPINS
"RTN","BPSSCR04",242,0)
 S BPPATNAM="",BPSRTVAL=0
"RTN","BPSSCR04",243,0)
 F  S BPPATNAM=$O(@BPTMP@("SORT","PNI",BPPATNAM)) Q:BPPATNAM=""  D
"RTN","BPSSCR04",244,0)
 . S BPINS="" ;"" to handle claims without insurance (corrupted data)
"RTN","BPSSCR04",245,0)
 . F  S BPINS=$O(@BPTMP@("SORT","PNI",BPPATNAM,BPINS)) Q:BPINS=""  D
"RTN","BPSSCR04",246,0)
 . . S BPSRTVAL=BPSRTVAL+1,BPINS=+BPINS
"RTN","BPSSCR04",247,0)
 . . S BP59=0
"RTN","BPSSCR04",248,0)
 . . F  S BP59=$O(@BPTMP@("SORT","PNI",BPPATNAM,BPINS,BP59)) Q:+BP59=0  D
"RTN","BPSSCR04",249,0)
 . . . D SETSORT(BPTMP,"P",BPSRTVAL,BP59)
"RTN","BPSSCR04",250,0)
 Q
"RTN","BPSSCR04",251,0)
 ;
"RTN","BPSSCRCL")
0^329^B75438118
"RTN","BPSSCRCL",1,0)
BPSSCRCL ;BHAM ISC/SS - ECME SCREEN CLOSE CLAIMS ;05-APR-05
"RTN","BPSSCRCL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRCL",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRCL",4,0)
 Q
"RTN","BPSSCRCL",5,0)
 ;
"RTN","BPSSCRCL",6,0)
CLO ;entry point to close claims
"RTN","BPSSCRCL",7,0)
 N BPRET,BPSARR59
"RTN","BPSSCRCL",8,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRCL",9,0)
 D FULL^VALM1
"RTN","BPSSCRCL",10,0)
 W !,"Enter the line numbers for the claim(s) to be closed."
"RTN","BPSSCRCL",11,0)
 S BPRET=$$ASKLINES^BPSSCRU4("Select item(s)","C",.BPSARR59,VALMAR)
"RTN","BPSSCRCL",12,0)
 I BPRET="^" S VALMBCK="R" Q
"RTN","BPSSCRCL",13,0)
 ;close claims
"RTN","BPSSCRCL",14,0)
 ;update the content of the screen
"RTN","BPSSCRCL",15,0)
 ;only if at least one claim was closed
"RTN","BPSSCRCL",16,0)
 I $$CLOSE(.BPSARR59) D REDRAW^BPSSCRUD("Updating screen for closed claims...")
"RTN","BPSSCRCL",17,0)
 E  S VALMBCK="R"
"RTN","BPSSCRCL",18,0)
 Q
"RTN","BPSSCRCL",19,0)
 ;
"RTN","BPSSCRCL",20,0)
 ;close claims
"RTN","BPSSCRCL",21,0)
 ;input:
"RTN","BPSSCRCL",22,0)
 ; BP59ARR - array with ptrs to BPS TRANSACTION FILE
"RTN","BPSSCRCL",23,0)
 ;       BP59ARR(ien59)="ien in TMP ^ number on the user screen"
"RTN","BPSSCRCL",24,0)
 ;returns:
"RTN","BPSSCRCL",25,0)
 ; BPCLTOT - number of closed claims
"RTN","BPSSCRCL",26,0)
CLOSE(BP59ARR) ;
"RTN","BPSSCRCL",27,0)
 N BPNEWARR,BPRETV,BPREJFLG,X
"RTN","BPSSCRCL",28,0)
 N BPDFN,BP59,BPIFANY,BPQ
"RTN","BPSSCRCL",29,0)
 N BPREAS,BPCOMM,BP90ANSW,BPRCOPAY,BPRXINFO,BPCOP,BPCLTOT,BPINS,BPINSNM,BP59FRST
"RTN","BPSSCRCL",30,0)
 S BPRETV=$$MKNEWARR(.BP59ARR,.BPNEWARR,.BPINS)
"RTN","BPSSCRCL",31,0)
 S BPQ="",BPIFANY=0,BPREJFLG=1
"RTN","BPSSCRCL",32,0)
 S BPDFN=""
"RTN","BPSSCRCL",33,0)
 F  S BPDFN=$O(BPNEWARR(BPDFN)) Q:BPDFN=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",34,0)
 . W !!,"You've chosen to close the following prescription(s) for",!,$E($$PATNAME^BPSSCRU2(BPDFN),1,13)_" :"
"RTN","BPSSCRCL",35,0)
 . S BP59="" F  S BP59=$O(BPNEWARR(BPDFN,BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",36,0)
 . . I $Y>20 D PAUSE^VALM1 W @IOF I X="^" S BPQ="^" Q
"RTN","BPSSCRCL",37,0)
 . . S BPIFANY=1,BPQ=""
"RTN","BPSSCRCL",38,0)
 . . ;I $P($G(BPNEWARR(BPDFN,BP59)),U,3)=1 W:BPREJFLG=0 ! S BPREJFLG=1
"RTN","BPSSCRCL",39,0)
 . . ;E  W:BPREJFLG=1 ! S BPREJFLG=0
"RTN","BPSSCRCL",40,0)
 . . S BPREJFLG=+$P($G(BPNEWARR(BPDFN,BP59)),U,3)
"RTN","BPSSCRCL",41,0)
 . . W !,@VALMAR@(+$G(BPNEWARR(BPDFN,BP59)),0)
"RTN","BPSSCRCL",42,0)
 . . W:BPREJFLG=0 !,"Claim NOT Rejected and cannot be Closed."
"RTN","BPSSCRCL",43,0)
 I +BPRETV=0 Q $$QUITCL()
"RTN","BPSSCRCL",44,0)
 I BPQ="^" Q $$QUITCL()
"RTN","BPSSCRCL",45,0)
 ;
"RTN","BPSSCRCL",46,0)
 W !!,"ALL Selected Rxs will be CLOSED using the same information gathered in the following prompts.",!
"RTN","BPSSCRCL",47,0)
 S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSSCRCL",48,0)
 I BPQ'=1 Q $$QUITCL()
"RTN","BPSSCRCL",49,0)
 ;
"RTN","BPSSCRCL",50,0)
 ; ask questions for all of them
"RTN","BPSSCRCL",51,0)
 W !!
"RTN","BPSSCRCL",52,0)
 I $$ASKQUEST(+$P(BPRETV,U,2),.BPREAS,.BPCOMM,.BP90ANSW,.BPRCOPAY)'=1 Q $$QUITCL()
"RTN","BPSSCRCL",53,0)
 ;
"RTN","BPSSCRCL",54,0)
 ; check 2nd insurance
"RTN","BPSSCRCL",55,0)
 S BPQ=""
"RTN","BPSSCRCL",56,0)
 I BP90ANSW'="D" D
"RTN","BPSSCRCL",57,0)
 . S BPDFN="" F  S BPDFN=$O(BPINS(BPDFN)) Q:BPDFN=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",58,0)
 . . S BPINSNM="" F  S BPINSNM=$O(BPINS(BPDFN,BPINSNM)) Q:BPINSNM=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",59,0)
 . . . S BP59FRST=0
"RTN","BPSSCRCL",60,0)
 . . . S BP59=""
"RTN","BPSSCRCL",61,0)
 . . . K BPRXINFO
"RTN","BPSSCRCL",62,0)
 . . . F  S BP59=$O(BPINS(BPDFN,BPINSNM,BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",63,0)
 . . . . S:BP59FRST=0 BP59FRST=BP59
"RTN","BPSSCRCL",64,0)
 . . . . S BPRXINFO(BP59)=$E($G(@VALMAR@(+$G(BP59ARR(BP59)),0)),7,99)
"RTN","BPSSCRCL",65,0)
 . . . ; call CH2NDINS^BPSSCRU5 only once for all claims for this patient and insurance
"RTN","BPSSCRCL",66,0)
 . . . ; you can use one BP59FRST for the group of claims here as a parameter since 
"RTN","BPSSCRCL",67,0)
 . . . ; they all are all identical from the "patient-insurance pair" point of view
"RTN","BPSSCRCL",68,0)
 . . . D:BP59FRST>0 CH2NDINS^BPSSCRU5(BP59FRST,$E($$PATNAME^BPSSCRU2(BPDFN),1,13),BPINSNM,.BPRXINFO)
"RTN","BPSSCRCL",69,0)
 ;
"RTN","BPSSCRCL",70,0)
 I BPQ="^" Q $$QUITCL()
"RTN","BPSSCRCL",71,0)
 ;
"RTN","BPSSCRCL",72,0)
 W @IOF
"RTN","BPSSCRCL",73,0)
 ;and finally close all
"RTN","BPSSCRCL",74,0)
 S BPCLTOT=0
"RTN","BPSSCRCL",75,0)
 S BPDFN="" F  S BPDFN=$O(BPNEWARR(BPDFN)) Q:BPDFN=""  D
"RTN","BPSSCRCL",76,0)
 . S BP59="" F  S BP59=$O(BPNEWARR(BPDFN,BP59)) Q:BP59=""  D
"RTN","BPSSCRCL",77,0)
 . . I $P($G(BPNEWARR(BPDFN,BP59)),U,3)=0 Q  ;can't be closed
"RTN","BPSSCRCL",78,0)
 . . S BPCOP=0
"RTN","BPSSCRCL",79,0)
 . . I +BPRCOPAY=1,$P($G(BPNEWARR(BPDFN,BP59)),U,4)=1 S BPCOP=1 ;release copay
"RTN","BPSSCRCL",80,0)
 . . I $$CLOSEIT(BP59,$P(BPREAS,U,2),BPCOMM,BP90ANSW,BPCOP)>0 D
"RTN","BPSSCRCL",81,0)
 . . . S BPCLTOT=BPCLTOT+1
"RTN","BPSSCRCL",82,0)
 ;
"RTN","BPSSCRCL",83,0)
 W !,BPCLTOT," claim",$S(BPCLTOT'=1:"s have",1:" has")," been closed.",!
"RTN","BPSSCRCL",84,0)
 D PAUSE^VALM1
"RTN","BPSSCRCL",85,0)
 Q BPCLTOT
"RTN","BPSSCRCL",86,0)
 ;
"RTN","BPSSCRCL",87,0)
QUITCL() ;
"RTN","BPSSCRCL",88,0)
 W !!,"0 claims have been closed."
"RTN","BPSSCRCL",89,0)
 D PAUSE^VALM1
"RTN","BPSSCRCL",90,0)
 Q 0
"RTN","BPSSCRCL",91,0)
 ;/**
"RTN","BPSSCRCL",92,0)
 ;Ask all necessary questions
"RTN","BPSSCRCL",93,0)
 ;Input
"RTN","BPSSCRCL",94,0)
 ; BPRELCOP - ask release copay question
"RTN","BPSSCRCL",95,0)
 ; .BPREAZ - ptr to #356.8 ^ CLOSE REASON NAME ^ ECME FLAG ^ ECME PAPER FLAG
"RTN","BPSSCRCL",96,0)
 ; .BPCOMZ - close comment (string)
"RTN","BPSSCRCL",97,0)
 ; .BP90ANSZ - "", "D"(drop to paper) or "N" (non-billable)
"RTN","BPSSCRCL",98,0)
 ; .BPRCOPAZ - 1(Yes) or 0(No) , answer to "release copay" question
"RTN","BPSSCRCL",99,0)
 ;Output:
"RTN","BPSSCRCL",100,0)
 ; 0 - cancell process
"RTN","BPSSCRCL",101,0)
 ; ^ - emergency quit (cancell process)
"RTN","BPSSCRCL",102,0)
 ; 1 - ok, can proceed
"RTN","BPSSCRCL",103,0)
ASKQUEST(BPRELCOP,BPREAZ,BPCOMZ,BP90ANSZ,BPRCOPAZ) ;*/
"RTN","BPSSCRCL",104,0)
 S BPCOMZ=""
"RTN","BPSSCRCL",105,0)
 S BP90ANSZ=""
"RTN","BPSSCRCL",106,0)
 S BPRCOPAZ=0
"RTN","BPSSCRCL",107,0)
 ;ask the user to choose the close reason from #356.8
"RTN","BPSSCRCL",108,0)
 ;using set of close reasons in IB file 356.8
"RTN","BPSSCRCL",109,0)
 S BPREAZ=$$REASON()
"RTN","BPSSCRCL",110,0)
 I BPREAZ="^" Q "^"
"RTN","BPSSCRCL",111,0)
 I ($P(BPREAZ,U,4)=1) D  ;if has ECME PAPER FLAG
"RTN","BPSSCRCL",112,0)
 . ;ask if the claim is still billable thru paper?
"RTN","BPSSCRCL",113,0)
 . S BP90ANSZ=$$PROMPT^BPSSCRCV("S^N:NON-BILLABLE;D:DROP TO PAPER","Treat as (N)on-Billable Episode or (D)rop Bill to Paper?","")
"RTN","BPSSCRCL",114,0)
 I BP90ANSZ=-1 Q "^"
"RTN","BPSSCRCL",115,0)
 S BPCOMZ=$$COMMENT("Comment ",40)
"RTN","BPSSCRCL",116,0)
 I (BPCOMZ="^") Q "^"
"RTN","BPSSCRCL",117,0)
 I $L(BPCOMZ)>0,BPCOMZ?1" "." " S BPCOMZ=""
"RTN","BPSSCRCL",118,0)
 ;check copay
"RTN","BPSSCRCL",119,0)
 ;ask "release copay?" in all NON-BILLABLE cases, i.e. except user answered "DROP TO PAPER"
"RTN","BPSSCRCL",120,0)
 ;(even in cases when he was not asked about it)
"RTN","BPSSCRCL",121,0)
 I BP90ANSZ'="D",BPRELCOP D
"RTN","BPSSCRCL",122,0)
 . ; Ask user if s/he wants to release a copay
"RTN","BPSSCRCL",123,0)
 . S BPRCOPAZ=$$YESNO^BPSSCRRS("Release Patient CoPay(Y/N)")
"RTN","BPSSCRCL",124,0)
 I BPRCOPAZ=-1 Q "^"
"RTN","BPSSCRCL",125,0)
 ;
"RTN","BPSSCRCL",126,0)
 S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSSCRCL",127,0)
 I BPQ=-1 Q "^" ;quit by "^"
"RTN","BPSSCRCL",128,0)
 I BPQ'=1 Q 0 ;doesn't want to proceed
"RTN","BPSSCRCL",129,0)
 Q 1 ; answers can be used
"RTN","BPSSCRCL",130,0)
 ;
"RTN","BPSSCRCL",131,0)
 ;/**
"RTN","BPSSCRCL",132,0)
 ;ask for the close reason
"RTN","BPSSCRCL",133,0)
 ;return:
"RTN","BPSSCRCL",134,0)
 ;   ptr to #356.8 ^ CLOSE REASON NAME ^ ECME FLAG ^ ECME PAPER FLAG
"RTN","BPSSCRCL",135,0)
REASON() ;
"RTN","BPSSCRCL",136,0)
 N DIC,BPREASNM,BP3568,Y
"RTN","BPSSCRCL",137,0)
 ; - Asks for REASON for Closing
"RTN","BPSSCRCL",138,0)
 S DIC="^IBE(356.8,",DIC(0)="AEQMZ"
"RTN","BPSSCRCL",139,0)
 S DIC("S")="I $P(^(0),U,2)=1"
"RTN","BPSSCRCL",140,0)
 D ^DIC
"RTN","BPSSCRCL",141,0)
 I Y=-1 Q "^"
"RTN","BPSSCRCL",142,0)
 Q +Y_U_Y(0)
"RTN","BPSSCRCL",143,0)
 ;/**
"RTN","BPSSCRCL",144,0)
 ;enter the comment
"RTN","BPSSCRCL",145,0)
 ;BPSTR  -prompt string
"RTN","BPSSCRCL",146,0)
 ;BPMLEN -maxlen
"RTN","BPSSCRCL",147,0)
COMMENT(BPSTR,BPMLEN) ;*/
"RTN","BPSSCRCL",148,0)
 N DIR,DTOUT,DUOUT,BPQ
"RTN","BPSSCRCL",149,0)
 I '$D(BPSTR) S BPSTR="Comment "
"RTN","BPSSCRCL",150,0)
 I '$D(BPMLEN) S BPMLEN=40
"RTN","BPSSCRCL",151,0)
 S DIR(0)="FO^0:250"
"RTN","BPSSCRCL",152,0)
 S DIR("A")=BPSTR
"RTN","BPSSCRCL",153,0)
 S DIR("?",1)="This response must have at least 0 characters and no more"
"RTN","BPSSCRCL",154,0)
 S DIR("?")="than "_BPMLEN_" characters and must not contain embedded uparrow"
"RTN","BPSSCRCL",155,0)
 S BPQ=0
"RTN","BPSSCRCL",156,0)
 F  D  Q:+BPQ'=0
"RTN","BPSSCRCL",157,0)
 . D ^DIR
"RTN","BPSSCRCL",158,0)
 . I $D(DUOUT)!($D(DTOUT)) S BPQ=-1 Q
"RTN","BPSSCRCL",159,0)
 . I $L(Y)'>BPMLEN S BPQ=1 Q
"RTN","BPSSCRCL",160,0)
 . W !!,"This response must have at least 0 characters and no more"
"RTN","BPSSCRCL",161,0)
 . W !,"than "_BPMLEN_" characters and must not contain embedded uparrow.",!
"RTN","BPSSCRCL",162,0)
 . S DIR("B")=$E(Y,1,BPMLEN)
"RTN","BPSSCRCL",163,0)
 Q:BPQ<0 "^"
"RTN","BPSSCRCL",164,0)
 Q Y
"RTN","BPSSCRCL",165,0)
 ;/** 
"RTN","BPSSCRCL",166,0)
 ;close the claim
"RTN","BPSSCRCL",167,0)
 ;the approach and code partially borrowed from IHS code CLOSE^BPSOS6N
"RTN","BPSSCRCL",168,0)
 ;BPSTRA - ptr to #9002313.59
"RTN","BPSSCRCL",169,0)
 ;REASON - text name of the close reason 
"RTN","BPSSCRCL",170,0)
 ;BPSCLCM - comment 
"RTN","BPSSCRCL",171,0)
 ;BPDROP:
"RTN","BPSSCRCL",172,0)
 ;  "D" - DROP BILL TO PAPER
"RTN","BPSSCRCL",173,0)
 ;  "N" - NON-BILLABLE
"RTN","BPSSCRCL",174,0)
 ;BPRELCOP - 1 (Yes) or 0 (No) release copay or not?
"RTN","BPSSCRCL",175,0)
CLOSEIT(BPSTRA,REASON,BPSCLCM,BPDROP,BPRELCOP) ;
"RTN","BPSSCRCL",176,0)
 N BPSCLA,ERROR,DA,DR,BPLCK,DIE
"RTN","BPSSCRCL",177,0)
 S BPSCLA=$$GET1^DIQ(9002313.59,BPSTRA,3,"I")
"RTN","BPSSCRCL",178,0)
 W !,"Closing Claim ",$$GET1^DIQ(9002313.02,BPSCLA,.01),"..."
"RTN","BPSSCRCL",179,0)
 S BPLCK=0
"RTN","BPSSCRCL",180,0)
 L +^BPSC(BPSCLA):0
"RTN","BPSSCRCL",181,0)
 I $T S BPLCK=1
"RTN","BPSSCRCL",182,0)
 E  W !,"       *** CLAIM ",$$GET1^DIQ(9002313.02,BPSCLA,.01)," IN USE ***" Q 0
"RTN","BPSSCRCL",183,0)
 D CLOSE^BPSBUTL(BPSCLA,BPSTRA,REASON,$S($G(BPDROP)="D":1,1:0),BPRELCOP,BPSCLCM,.ERROR)
"RTN","BPSSCRCL",184,0)
 I $D(ERROR) W "NOT OK" D DSPERR(ERROR) D  Q 0
"RTN","BPSSCRCL",185,0)
 . I BPLCK=1 L -^BPSC(BPSCLA)
"RTN","BPSSCRCL",186,0)
 S DIE="^BPSC(",DA=BPSCLA,DR="901///1;902///"_$$NOW^XLFDT()_";903///"_$G(DUZ)_";904///"_REASON_";905////"_BPDROP D ^DIE
"RTN","BPSSCRCL",187,0)
 I BPLCK=1 L -^BPSC(BPSCLA)
"RTN","BPSSCRCL",188,0)
 H 1 W "OK"
"RTN","BPSSCRCL",189,0)
 Q 1
"RTN","BPSSCRCL",190,0)
 ;
"RTN","BPSSCRCL",191,0)
DSPERR(MSG) ; Display the ERROR message
"RTN","BPSSCRCL",192,0)
 W !,"Error: *** ",MSG," ***"
"RTN","BPSSCRCL",193,0)
 Q
"RTN","BPSSCRCL",194,0)
 ;
"RTN","BPSSCRCL",195,0)
 ;/**
"RTN","BPSSCRCL",196,0)
 ;ECME has tried to submit the claim to insurance with the name BPINSNAM
"RTN","BPSSCRCL",197,0)
 ;but the claim was rejected and now we need to determine if the patient
"RTN","BPSSCRCL",198,0)
 ;has any other insurance with pharmacy coverage that can be billed for the RX
"RTN","BPSSCRCL",199,0)
 ;Input:
"RTN","BPSSCRCL",200,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRCL",201,0)
 ; BPINSNAM - insurance that have already been used by ECME
"RTN","BPSSCRCL",202,0)
 ;Output:
"RTN","BPSSCRCL",203,0)
 ; 0 - not found
"RTN","BPSSCRCL",204,0)
 ; 1 ^ Insurance Name ^ Group Number ^ Date  of service
"RTN","BPSSCRCL",205,0)
NEXTINS(BP59,BPINSNAM) ;get insurance info by the pointer of #9002313.59
"RTN","BPSSCRCL",206,0)
 N BPDOS,BPDFN,BPZZ,BP36,BPX,BPHONE,BPY,BPINSNM
"RTN","BPSSCRCL",207,0)
 N BPPHARM,BPCOORD,BPINS,BPFOUND
"RTN","BPSSCRCL",208,0)
 S BPY=0
"RTN","BPSSCRCL",209,0)
 S BPHONE=$P($G(^BPST(BP59,10,+$G(^BPST(BP59,9)),3)),U,2)
"RTN","BPSSCRCL",210,0)
 S BPDOS=+$P($G(^BPST(BP59,12)),U,2)\1
"RTN","BPSSCRCL",211,0)
 I BPDOS=0 S BPDOS=+$P($G(^BPST(BP59,0)),U,8)\1
"RTN","BPSSCRCL",212,0)
 S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRCL",213,0)
 ; call INSUR^IBBAPI to get information about:
"RTN","BPSSCRCL",214,0)
 ;1 = Insurance Company Name
"RTN","BPSSCRCL",215,0)
 ;7 = Coordination of Benefits (primary, secondary, tertiary)
"RTN","BPSSCRCL",216,0)
 ;15 = Pharmacy Coverage?
"RTN","BPSSCRCL",217,0)
 ;18 = Group Number
"RTN","BPSSCRCL",218,0)
 S BPX=$$INSUR^IBBAPI(BPDFN,BPDOS,,.BPZZ,"1,7,15,18")
"RTN","BPSSCRCL",219,0)
 S BP1="" F  S BP1=$O(BPZZ("IBBAPI","INSUR",BP1)) Q:+BP1=0  D
"RTN","BPSSCRCL",220,0)
 . ;get pharmacy coverage
"RTN","BPSSCRCL",221,0)
 . S BPPHARM=+$G(BPZZ("IBBAPI","INSUR",BP1,15))
"RTN","BPSSCRCL",222,0)
 I BPX<1 Q 0
"RTN","BPSSCRCL",223,0)
 D PROCINS(.BPZZ)
"RTN","BPSSCRCL",224,0)
 ;check pharmacy coverage
"RTN","BPSSCRCL",225,0)
 S BPFOUND=0 ;if found will be set to insurance node in the INSUR^IBBAPI array
"RTN","BPSSCRCL",226,0)
 S BPPHARM=1 ;look only at those with pharmacy coverage
"RTN","BPSSCRCL",227,0)
 S BPCOORD=0
"RTN","BPSSCRCL",228,0)
 F  S BPCOORD=+$O(BPZZ("RES",BPPHARM,BPCOORD)) Q:BPCOORD=0!(BPFOUND'=0)  D
"RTN","BPSSCRCL",229,0)
 . S BPINS=+$O(BPZZ("RES",BPPHARM,BPCOORD,0))
"RTN","BPSSCRCL",230,0)
 . I BPINS>0 I $P($G(BPZZ("IBBAPI","INSUR",BPINS,1)),U,2)'=BPINSNAM S BPFOUND=BPINS
"RTN","BPSSCRCL",231,0)
 I BPFOUND=0 Q 0
"RTN","BPSSCRCL",232,0)
 Q 1_U_$P($G(BPZZ("IBBAPI","INSUR",BPFOUND,1)),U,2)_U_$P($G(BPZZ("IBBAPI","INSUR",BPFOUND,18)),U)_U_BPDOS
"RTN","BPSSCRCL",233,0)
 ;
"RTN","BPSSCRCL",234,0)
 ;process insurances
"RTN","BPSSCRCL",235,0)
 ;input: local array returned by INSUR^IBBAPI
"RTN","BPSSCRCL",236,0)
 ;output: BPZZ("RES",pharmacy coverage,coordination,insurance element # in BPZZ array)
"RTN","BPSSCRCL",237,0)
PROCINS(BPZZ) ;
"RTN","BPSSCRCL",238,0)
 N BP1,BP2,BP0,BPPHONE,BPPHARM,BPCOORD
"RTN","BPSSCRCL",239,0)
 S BP1="" F  S BP1=$O(BPZZ("IBBAPI","INSUR",BP1)) Q:+BP1=0  D
"RTN","BPSSCRCL",240,0)
 . ;get pharmacy coverage
"RTN","BPSSCRCL",241,0)
 . S BPPHARM=+$G(BPZZ("IBBAPI","INSUR",BP1,15))
"RTN","BPSSCRCL",242,0)
 . ;get coordination of benefits
"RTN","BPSSCRCL",243,0)
 . S BPCOORD=+$G(BPZZ("IBBAPI","INSUR",BP1,7))
"RTN","BPSSCRCL",244,0)
 . ;create ^TMP to sort results by pharmacy coverage and coordination of benefits
"RTN","BPSSCRCL",245,0)
 . S BPZZ("RES",BPPHARM,BPCOORD,BP1)=""
"RTN","BPSSCRCL",246,0)
 Q
"RTN","BPSSCRCL",247,0)
 ;
"RTN","BPSSCRCL",248,0)
 ;------------
"RTN","BPSSCRCL",249,0)
MKNEWARR(BPARR,BPNEWARR,BPINSARR) ;
"RTN","BPSSCRCL",250,0)
 N BP59,BPREJ,BPREJCNT,BPRELCNT,BPREL,BPINS
"RTN","BPSSCRCL",251,0)
 S BPREJCNT=0,BPRELCNT=0
"RTN","BPSSCRCL",252,0)
 S BPINS=0
"RTN","BPSSCRCL",253,0)
 S BP59="" F  S BP59=$O(BPARR(BP59)) Q:BP59=""  D
"RTN","BPSSCRCL",254,0)
 . S BPREJ=0
"RTN","BPSSCRCL",255,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRCL",256,0)
 . S BPREJ=$S($P($$CLAIMST^BPSSCRU3(BP59),U)="E REJECTED":1,1:0)
"RTN","BPSSCRCL",257,0)
 . S:BPREJ BPREJCNT=BPREJCNT+1
"RTN","BPSSCRCL",258,0)
 . S BPREL=$S($P($G(^PSRX(+$P($$RXREF^BPSSCRU2(BP59),U),"IB")),U,2):1,1:0)
"RTN","BPSSCRCL",259,0)
 . S:BPREL BPRELCNT=BPRELCNT+1
"RTN","BPSSCRCL",260,0)
 . S BPNEWARR(BPDFN,BP59)=BPARR(BP59)_U_BPREJ_U_BPREL
"RTN","BPSSCRCL",261,0)
 . S BPINS=$P($$GETINSUR^BPSSCRU2(BP59),U,2)
"RTN","BPSSCRCL",262,0)
 . I BPREJ=1,$L(BPINS)>0 S BPINSARR(BPDFN,BPINS,BP59)=BPARR(BP59)
"RTN","BPSSCRCL",263,0)
 Q BPREJCNT_U_BPRELCNT
"RTN","BPSSCRCL",264,0)
 ;
"RTN","BPSSCRCU")
0^331^B3842949
"RTN","BPSSCRCU",1,0)
BPSSCRCU ;BHAM ISC/SS - ECME SCREEN CONTINUOUS UPDATE AND CHANGE VIEW ;05-APR-05
"RTN","BPSSCRCU",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRCU",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRCU",4,0)
 Q
"RTN","BPSSCRCU",5,0)
 ;
"RTN","BPSSCRCU",6,0)
CU ;
"RTN","BPSSCRCU",7,0)
 N BPKEY,BPTIME,X,Y
"RTN","BPSSCRCU",8,0)
 S BPTIME=15 ;update every 15 seconds
"RTN","BPSSCRCU",9,0)
 D RE^VALM4
"RTN","BPSSCRCU",10,0)
 W "Press ""Q"" to quit."
"RTN","BPSSCRCU",11,0)
 ;F  D  R *BPKEY:BPTIME Q:(BPKEY=81)!(BPKEY=113)
"RTN","BPSSCRCU",12,0)
 F  D  S BPKEY=$$READ^XGKB(1,BPTIME) Q:(BPKEY="Q")!(BPKEY="q")
"RTN","BPSSCRCU",13,0)
 . D UD^BPSSCRUD
"RTN","BPSSCRCU",14,0)
 . D RE^VALM4
"RTN","BPSSCRCU",15,0)
 . N %
"RTN","BPSSCRCU",16,0)
 . D NOW^%DTC S Y=% X ^DD("DD")
"RTN","BPSSCRCU",17,0)
 . W "The screen has been updated on "_Y_". Press ""Q"" to quit."
"RTN","BPSSCRCU",18,0)
 Q
"RTN","BPSSCRCU",19,0)
 ;
"RTN","BPSSCRCU",20,0)
 ;select insurance from the list of the insurances which was built for the current user setting
"RTN","BPSSCRCU",21,0)
 ;for the User Screen.
"RTN","BPSSCRCU",22,0)
 ;input : none
"RTN","BPSSCRCU",23,0)
 ;output : 1^name of the insurance or null
"RTN","BPSSCRCU",24,0)
 ;0^ - if "^" or was not selected
"RTN","BPSSCRCU",25,0)
SELINSUR() ;
"RTN","BPSSCRCU",26,0)
 N DIR,Y,X
"RTN","BPSSCRCU",27,0)
 N BPX,BPCNT,BPTEL
"RTN","BPSSCRCU",28,0)
 S BPX=0,BPCNT=0
"RTN","BPSSCRCU",29,0)
 K ^TMP($J,"BPSSCRINS","LOOKUP")
"RTN","BPSSCRCU",30,0)
 F  S BPX=$O(^TMP($J,"BPSSCRINS","VAL",BPX)) Q:BPX=""  D
"RTN","BPSSCRCU",31,0)
 . S BPCNT=BPCNT+1
"RTN","BPSSCRCU",32,0)
 . S BPTEL=$O(^TMP($J,"BPSSCRINS","VAL",BPX,""))
"RTN","BPSSCRCU",33,0)
 . S ^TMP($J,"BPSSCRINS","LOOKUP",BPCNT,0)=BPX_U_BPTEL
"RTN","BPSSCRCU",34,0)
 . S ^TMP($J,"BPSSCRINS","LOOKUP","B",BPX,BPCNT)=""
"RTN","BPSSCRCU",35,0)
 S ^TMP($J,"BPSSCRINS","LOOKUP",0)=U_U_BPCNT_U_BPCNT
"RTN","BPSSCRCU",36,0)
 ;set DIR variables
"RTN","BPSSCRCU",37,0)
 S DIR(0)="P^TMP($J,""BPSSCRINS"",""LOOKUP"",:AEQMZ"
"RTN","BPSSCRCU",38,0)
 S DIR("A")="Select "
"RTN","BPSSCRCU",39,0)
 S DIR("A",1)=""
"RTN","BPSSCRCU",40,0)
 S DIR("A",2)="Select one of the insurances which were used by ECME to submit claims within"
"RTN","BPSSCRCU",41,0)
 S DIR("A",3)="the date range specified by the user."
"RTN","BPSSCRCU",42,0)
 S DIR("A",4)=""
"RTN","BPSSCRCU",43,0)
 D ^DIR
"RTN","BPSSCRCU",44,0)
 K ^TMP($J,"BPSSCRINS","LOOKUP")
"RTN","BPSSCRCU",45,0)
 I X="^" Q "-1^"
"RTN","BPSSCRCU",46,0)
 I $P(Y,U,2)="" Q "0^"
"RTN","BPSSCRCU",47,0)
 Q 1_U_$P(Y,U,2)
"RTN","BPSSCRCU",48,0)
 ;
"RTN","BPSSCRCV")
0^332^B47521976
"RTN","BPSSCRCV",1,0)
BPSSCRCV ;BHAM ISC/SS - ECME SCREEN CHANGE VIEW ;05-APR-05
"RTN","BPSSCRCV",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRCV",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRCV",4,0)
 ;USER SCREEN
"RTN","BPSSCRCV",5,0)
 Q
"RTN","BPSSCRCV",6,0)
 ;****
"RTN","BPSSCRCV",7,0)
 ;This software is using PARAMETER TOOLS (see XT*7.3*26) to store user's settings:
"RTN","BPSSCRCV",8,0)
 ;PARAMETER DEFINITION NAME="BPS USRSCR" (file #8989.51, IA# 2263)
"RTN","BPSSCRCV",9,0)
 ;ENTITY is "USR" , i.e. IEN in ^VA(200  -- see definition for "BPS USRSCR"
"RTN","BPSSCRCV",10,0)
 ;INSTANCEs are as follows:
"RTN","BPSSCRCV",11,0)
 ;1.01 ONE/ALL USERS --'U' ONE USER, 'A' ALL; Display claims for ONE or ALL users 
"RTN","BPSSCRCV",12,0)
 ;1.02 ONE/ALL PATIENTS --'P' FOR ONE PATIENT; 'A' FOR ALL; Display claims for ONE/ALL PATIENTS 
"RTN","BPSSCRCV",13,0)
 ;1.03 ONE/ALL RX --'R' FOR ONE RX; 'A' FOR ALL; Display claims for ONE or ALL RX 
"RTN","BPSSCRCV",14,0)
 ;1.04 HOURS/DAYS -- 'D' FOR DAYS; 'H' FOR HOURS; Use HOURS or DAYS to specify timeframe 
"RTN","BPSSCRCV",15,0)
 ;1.05 TIMEFRAME -- NUMBER Depends on the value of the field "USR SCR HOURS/DAYS" this field will
"RTN","BPSSCRCV",16,0)
 ;store the default number of HOURS from NOW or DAYS from TODAY to select claims to display 
"RTN","BPSSCRCV",17,0)
 ;1.06 REJECTED/PAYABLE --'R' FOR REJECTS; 'P' FOR PAYABLES 'A' FOR ALL; Display Rejects or Payables or ALL claims 
"RTN","BPSSCRCV",18,0)
 ;1.07 RELEASED/NOT RELEASED --'R' FOR RELEASED; 'N' FOR NON-RELEASED; 'A' FOR ALL; Display Released Rxs or Non-Released Rxs or ALL 
"RTN","BPSSCRCV",19,0)
 ;1.08 CMOP/MAIL/WINDOW --'C' FOR CMOP; 'M' FOR MAIL;'W' FOR WINDOW;'A' FOR ALL; Display CMOP or Mail or Window or ALL Rxs 
"RTN","BPSSCRCV",20,0)
 ;1.09 REALTIME/BACKBILL --'R' FOR REALTIME; 'B' FOR BACKBILLS; 'A' FOR ALL; Display RealTime Fills or Backbills or ALL 
"RTN","BPSSCRCV",21,0)
 ;1.1 REJECT CODE/ALL --'R' FOR REJECT CODE; 'A' FOR ALL; Display Specific Reject Code or ALL Reject
"RTN","BPSSCRCV",22,0)
 ;Codes 0 means ALL Reject Codes otherwise - Reject Code value 
"RTN","BPSSCRCV",23,0)
 ;1.11 SINGLE/ALL INSURANCES --'I' FOR SINGLE INSURANCE;'A' FOR ALL; Display Single Insurance Company or All null - ALL otherwise - pointer to INSURANCE COMPANY file #36 
"RTN","BPSSCRCV",24,0)
 ;1.12 SORT LIST --'T' FOR TRANSACTION DATE;'D' FOR DIVISION; 'I' FOR INSURANCE; 'C' FOR REJECT CODE; 
"RTN","BPSSCRCV",25,0)
 ;'P' FOR PATIENT NAME -- 'N' FOR DRUG NAME; 'B' FOR BILL TYPE (BB/RT); 'L' FOR FILL LOCATION;
"RTN","BPSSCRCV",26,0)
 ;'R' FOR RELEASED/NON-RELEASED -- 'A' FOR ACTIVE/DISCONTINUED; the field used to sort claims in the list 
"RTN","BPSSCRCV",27,0)
 ;1.13 ALL ECME PHARMACY DIVISIONS --'D' FOR DIVISION; 'A' FOR ALL; 
"RTN","BPSSCRCV",28,0)
 ;1.14 SELECTED INSURANCE -- Single insurance to select claims for the User Screen, to store INSURANCE COMPANY pointer (#36) 
"RTN","BPSSCRCV",29,0)
 ;1.15 SELECTED REJECTED CODE --POINTER TO BPS NCPDP REJECT CODES FILE (#9002313.93) Reject code selected by the user to filter claims.
"RTN","BPSSCRCV",30,0)
 ;1.16 SELECTED USER -- POINTER TO NEW PERSON FILE (#200) Selected user for the user screen 
"RTN","BPSSCRCV",31,0)
 ;1.17 SELECTED PATIENT -- POINTER TO PATIENT FILE (#2) Selected patient for the User Screen 
"RTN","BPSSCRCV",32,0)
 ;1.18 SELECTED RX -- POINTER TO PRESCRIPTION FILE (#52) Selected RX 
"RTN","BPSSCRCV",33,0)
 ;2    ECME PHARMACY DIVISION -- the list of POINTERs TO BPS PHARMACIES FILE (#9002313.56) separated by "^"
"RTN","BPSSCRCV",34,0)
 ;should start and end with ";", example: ";4;5;"
"RTN","BPSSCRCV",35,0)
 ;
"RTN","BPSSCRCV",36,0)
 ;NOTE: use D ^XPAREDIT to add/edit values
"RTN","BPSSCRCV",37,0)
 ;
"RTN","BPSSCRCV",38,0)
 ;*****
"RTN","BPSSCRCV",39,0)
 ;
"RTN","BPSSCRCV",40,0)
CV ;
"RTN","BPSSCRCV",41,0)
 D FULL^VALM1
"RTN","BPSSCRCV",42,0)
 W @IOF
"RTN","BPSSCRCV",43,0)
 K BPARR
"RTN","BPSSCRCV",44,0)
 I +$G(DUZ)=0 D ERRMSG^BPSSCRCV("Unknown User") Q
"RTN","BPSSCRCV",45,0)
 N BPDUZ7
"RTN","BPSSCRCV",46,0)
 S BPDUZ7=+DUZ
"RTN","BPSSCRCV",47,0)
 ;always get current profile from the file
"RTN","BPSSCRCV",48,0)
 D READPROF^BPSSCRSL(.BPARR,BPDUZ7)
"RTN","BPSSCRCV",49,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRCV",50,0)
 ;edit current profile
"RTN","BPSSCRCV",51,0)
 D EDITPROF(.BPARR,.BPDUZ7)
"RTN","BPSSCRCV",52,0)
 ;ask user if need to save everything in USR PROFILE file 
"RTN","BPSSCRCV",53,0)
 ;(except SORT LIST field)
"RTN","BPSSCRCV",54,0)
 N BPSRT S BPSRT=BPARR(1.12)
"RTN","BPSSCRCV",55,0)
 K BPARR(1.12)
"RTN","BPSSCRCV",56,0)
 D ENDEDIT^BPSSCRSL(.BPARR,+BPDUZ7)
"RTN","BPSSCRCV",57,0)
 S BPARR(1.12)=BPSRT
"RTN","BPSSCRCV",58,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRCV",59,0)
 S VALMBG=1
"RTN","BPSSCRCV",60,0)
 D REDRAW^BPSSCRUD("Updating screen...")
"RTN","BPSSCRCV",61,0)
 Q
"RTN","BPSSCRCV",62,0)
 ;edit user profile for CHANGE VIEW
"RTN","BPSSCRCV",63,0)
EDITPROF(BPARR,BPDUZ7) ;
"RTN","BPSSCRCV",64,0)
 I +$G(DUZ)=0 D ERRMSG("Unknown User") Q
"RTN","BPSSCRCV",65,0)
 N BP1,BPTF,BPQ,BPINP
"RTN","BPSSCRCV",66,0)
 N BPRET
"RTN","BPSSCRCV",67,0)
 N DIR,DR,DIE,DA
"RTN","BPSSCRCV",68,0)
 ;get ONE/ALL USERS?
"RTN","BPSSCRCV",69,0)
 ;EDITFLD(FILENO,FLDNO,RECIEN,CODESET,PRMTMSG,DFLTCODE)  ;
"RTN","BPSSCRCV",70,0)
 S BPRET=$$DS^BPSSCRDS(.BPARR,+BPDUZ7) ;get divisions
"RTN","BPSSCRCV",71,0)
 Q:BPRET=-2  ;quit due to timeout or ^
"RTN","BPSSCRCV",72,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",73,0)
 . S BPINP=$$EDITFLD(1.01,+BPDUZ7,"S^U:ONE USER;A:ALL","Display One ECME (U)ser or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",74,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",75,0)
 . S BPINP=$$EDITFLD(1.16,+BPDUZ7,"P^VA(200,","Select User","",.BPARR)
"RTN","BPSSCRCV",76,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",77,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",78,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",79,0)
 . S BPINP=$$EDITFLD(1.02,+BPDUZ7,"S^P:ONE PATIENT;A:ALL","Display One (P)atient or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",80,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",81,0)
 . S BPINP=$$EDITFLD(1.17,+BPDUZ7,"P^DPT(","Select Patient","",.BPARR)
"RTN","BPSSCRCV",82,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",83,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",84,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",85,0)
 . S BPINP=$$EDITFLD(1.03,+BPDUZ7,"S^R:ONE RX;A:ALL","Display One (R)x or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",86,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",87,0)
 . S BPINP=$$EDITFLD(1.18,+BPDUZ7,"P^PSRX(","Select RX","",.BPARR)
"RTN","BPSSCRCV",88,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",89,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",90,0)
 S BPINP=$$EDITFLD(1.04,+BPDUZ7,"S^D:DAYS;H:HOURS","Activity Timeframe (H)ours or (D)ays","DAYS",.BPARR)
"RTN","BPSSCRCV",91,0)
 I BPINP=-1 Q  ;quit due to timeout or ^
"RTN","BPSSCRCV",92,0)
 S BPTF=$P(BPINP,U,2)
"RTN","BPSSCRCV",93,0)
 Q:$$EDITFLD(1.05,+BPDUZ7,"N^1:999:0","Activity Timeframe Value",$S(BPTF="H":24,1:7),.BPARR)=-1
"RTN","BPSSCRCV",94,0)
 Q:$$EDITFLD(1.06,+BPDUZ7,"S^R:REJECTS;P:PAYABLES;A:ALL","Display (R)ejects or (P)ayables or (A)LL","REJECTS",.BPARR)=-1
"RTN","BPSSCRCV",95,0)
 Q:$$EDITFLD(1.07,+BPDUZ7,"S^R:RELEASED;N:NON-RELEASED;A:ALL","Display (R)eleased Rxs or (N)on-Released Rxs or (A)LL","RELEASED",.BPARR)=-1
"RTN","BPSSCRCV",96,0)
 Q:$$EDITFLD(1.08,+BPDUZ7,"S^C:CMOP;M:MAIL;W:WINDOW;A:ALL","Display (C)MOP or (M)ail or (W)indow or (A)LL","ALL",.BPARR)=-1
"RTN","BPSSCRCV",97,0)
 Q:$$EDITFLD(1.09,+BPDUZ7,"S^R:REALTIME;B:BACKBILLS;A:ALL","Display (R)ealTime Fills or (B)ackbills or (A)LL","ALL",.BPARR)=-1
"RTN","BPSSCRCV",98,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",99,0)
 . S BPINP=$$EDITFLD(1.1,+BPDUZ7,"S^R:REJECT CODE;A:ALL","Display Specific (R)eject Code or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",100,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",101,0)
 . S BPINP=$$EDITFLD(1.15,+BPDUZ7,"P^BPSF(9002313.93,","Select Reject Code","",.BPARR)
"RTN","BPSSCRCV",102,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",103,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",104,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",105,0)
 . S BPINP=$$EDITFLD(1.11,+BPDUZ7,"S^I:SINGLE INSURANCE;A:ALL","Display Single (I)nsurance Company or (A)ll","ALL",.BPARR)
"RTN","BPSSCRCV",106,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",107,0)
 . S BPINP=$$INSURFLD(1.14,+BPDUZ7,"Select Insurance","",.BPARR)
"RTN","BPSSCRCV",108,0)
 . I +BPINP=0 S BPARR(1.11)="A",BPQ=1 D  Q  ;
"RTN","BPSSCRCV",109,0)
 . . W !,"Your selection will be changed to ALL insurances selected.",!
"RTN","BPSSCRCV",110,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",111,0)
 Q
"RTN","BPSSCRCV",112,0)
 ;
"RTN","BPSSCRCV",113,0)
 ;select insurance using IB API
"RTN","BPSSCRCV",114,0)
INSURFLD(FLDNO,RECIEN,PRMTMSG,DFLTVAL,BPARRAY) ;*/
"RTN","BPSSCRCV",115,0)
 N DIR,RETV
"RTN","BPSSCRCV",116,0)
 S RETV=$$GETPARAM^BPSSCRSL(FLDNO,RECIEN)
"RTN","BPSSCRCV",117,0)
 ;if data then use it, otherwise use data from parameter
"RTN","BPSSCRCV",118,0)
 I $L($G(RETV))>0 S DFLTVAL=RETV E  S DFLTVAL=$G(DFLTVAL)
"RTN","BPSSCRCV",119,0)
 ;prompt the user
"RTN","BPSSCRCV",120,0)
 S RETV=$$SELINSUR^BPSSCRCU()
"RTN","BPSSCRCV",121,0)
 Q:(+RETV)<1 +RETV
"RTN","BPSSCRCV",122,0)
 ;save it in the database
"RTN","BPSSCRCV",123,0)
 S BPARRAY(FLDNO)=$P(RETV,U,2)
"RTN","BPSSCRCV",124,0)
 Q "1^"_(+RETV)
"RTN","BPSSCRCV",125,0)
 ;
"RTN","BPSSCRCV",126,0)
ERRMSG(BPMSG) ;
"RTN","BPSSCRCV",127,0)
 W !,"***",BPMSG,"***",!
"RTN","BPSSCRCV",128,0)
 D PAUSE^VALM1
"RTN","BPSSCRCV",129,0)
 Q
"RTN","BPSSCRCV",130,0)
 ;/**
"RTN","BPSSCRCV",131,0)
 ;FLDNO - filed #
"RTN","BPSSCRCV",132,0)
 ;RECIEN - ien in file #FILENO
"RTN","BPSSCRCV",133,0)
 ;DIR0 - like DIR(0) node for ^DIR - i.e. field type, etc
"RTN","BPSSCRCV",134,0)
 ;PRMTMSG - user prompt
"RTN","BPSSCRCV",135,0)
 ;DFLTVAL - pass the default value for the case if there is no value in database
"RTN","BPSSCRCV",136,0)
 ;BPARRAY - array to store and change values in profile
"RTN","BPSSCRCV",137,0)
 ;returns:
"RTN","BPSSCRCV",138,0)
 ;as return value:
"RTN","BPSSCRCV",139,0)
 ; "1^value" - if selected
"RTN","BPSSCRCV",140,0)
 ; "-1" if timeout or uparrow
"RTN","BPSSCRCV",141,0)
 ;via BPARRAY
"RTN","BPSSCRCV",142,0)
 ; BPARRAY(filedno)=value
"RTN","BPSSCRCV",143,0)
EDITFLD(FLDNO,RECIEN,DIR0,PRMTMSG,DFLTVAL,BPARRAY) ;*/
"RTN","BPSSCRCV",144,0)
 N DIR,RETV,RETARR
"RTN","BPSSCRCV",145,0)
 N RECIENS,FDA,LCK,ERRARR
"RTN","BPSSCRCV",146,0)
 S RETV=$$GETPARAM^BPSSCRSL(FLDNO,RECIEN)
"RTN","BPSSCRCV",147,0)
 I FLDNO=1.17 S RETV=$P($G(^DPT(+RETV,0)),U)
"RTN","BPSSCRCV",148,0)
 ;if data then use it, otherwise use data from parameter
"RTN","BPSSCRCV",149,0)
 I $L($G(RETV))>0 S DFLTVAL=RETV E  S DFLTVAL=$G(DFLTVAL)
"RTN","BPSSCRCV",150,0)
 ;prompt the user
"RTN","BPSSCRCV",151,0)
 S RETV=$$PROMPT(DIR0,PRMTMSG,DFLTVAL)
"RTN","BPSSCRCV",152,0)
 Q:RETV<0 -1
"RTN","BPSSCRCV",153,0)
 ;save it in the database
"RTN","BPSSCRCV",154,0)
 S BPARRAY(FLDNO)=RETV
"RTN","BPSSCRCV",155,0)
 Q "1^"_RETV
"RTN","BPSSCRCV",156,0)
 ;
"RTN","BPSSCRCV",157,0)
 ;
"RTN","BPSSCRCV",158,0)
FILEIT(FILENO,FLDNO,RECIEN,NEWVAL) ;
"RTN","BPSSCRCV",159,0)
 N RECIENS
"RTN","BPSSCRCV",160,0)
 S RECIENS=RECIEN_","
"RTN","BPSSCRCV",161,0)
 S FDA(FILENO,RECIENS,FLDNO)=NEWVAL
"RTN","BPSSCRCV",162,0)
 L +^BPS(FILENO,RECIEN,1):10 S LCK=$T I 'LCK Q "0^"_NEWVAL_"^LOCKED"  ;quit
"RTN","BPSSCRCV",163,0)
 D FILE^DIE("","FDA","ERRARR")
"RTN","BPSSCRCV",164,0)
 I LCK L -^BPS(FILENO,RECIEN,1)
"RTN","BPSSCRCV",165,0)
 I $D(ERRARR) Q "0^"_NEWVAL_"^"_ERRARR("DIERR",1,"TEXT",1)
"RTN","BPSSCRCV",166,0)
 Q "1^"_NEWVAL
"RTN","BPSSCRCV",167,0)
 ;
"RTN","BPSSCRCV",168,0)
 ;prompts for selection
"RTN","BPSSCRCV",169,0)
 ;returns selection
"RTN","BPSSCRCV",170,0)
 ;OR -1 when timeout and uparrow
"RTN","BPSSCRCV",171,0)
PROMPT(ZERONODE,PRMTMSG,DFLTVAL) ;
"RTN","BPSSCRCV",172,0)
 N Y,DUOUT,DTOUT,BPQUIT,DIROUT
"RTN","BPSSCRCV",173,0)
 S BPQUIT=0
"RTN","BPSSCRCV",174,0)
 I $E(ZERONODE,1,1)="P" D
"RTN","BPSSCRCV",175,0)
 . N DIC
"RTN","BPSSCRCV",176,0)
 . S DIC="^"_$P(ZERONODE,U,2)
"RTN","BPSSCRCV",177,0)
 . S DIC(0)="AEMNQ"
"RTN","BPSSCRCV",178,0)
 . S:$L($G(DFLTVAL))>0 DIC("B")=DFLTVAL
"RTN","BPSSCRCV",179,0)
 . S DIC("A")=PRMTMSG_": "
"RTN","BPSSCRCV",180,0)
 . D ^DIC
"RTN","BPSSCRCV",181,0)
 . I (Y=-1)!$D(DUOUT)!$D(DTOUT) S BPQUIT=1
"RTN","BPSSCRCV",182,0)
 E  D
"RTN","BPSSCRCV",183,0)
 . N DIR
"RTN","BPSSCRCV",184,0)
 . S DIR(0)=ZERONODE
"RTN","BPSSCRCV",185,0)
 . S DIR("A")=PRMTMSG
"RTN","BPSSCRCV",186,0)
 . S:$L($G(DFLTVAL))>0 DIR("B")=DFLTVAL
"RTN","BPSSCRCV",187,0)
 . D ^DIR
"RTN","BPSSCRCV",188,0)
 . I (Y=-1)!$D(DIROUT)!$D(DUOUT)!$D(DTOUT) S BPQUIT=1
"RTN","BPSSCRCV",189,0)
 I BPQUIT=1 Q -1
"RTN","BPSSCRCV",190,0)
 Q $P(Y,U)
"RTN","BPSSCRCV",191,0)
 ;
"RTN","BPSSCRCV",192,0)
GETFLD(FILENO,FLDNO,RECIEN) ;
"RTN","BPSSCRCV",193,0)
 N RETV,RETARR
"RTN","BPSSCRCV",194,0)
 N RECIENS
"RTN","BPSSCRCV",195,0)
 S RECIENS=RECIEN_","
"RTN","BPSSCRCV",196,0)
 ; first try to get the value from file
"RTN","BPSSCRCV",197,0)
 D GETS^DIQ(FILENO,RECIENS,FLDNO,"E","RETARR")
"RTN","BPSSCRCV",198,0)
 S RETV=$G(RETARR(FILENO,RECIENS,FLDNO,"E"))
"RTN","BPSSCRCV",199,0)
 Q $G(RETV)
"RTN","BPSSCRCV",200,0)
 ;
"RTN","BPSSCRCV",201,0)
 ;save all profile array to file
"RTN","BPSSCRCV",202,0)
 ;BPARRAY - arrays with pointers to 9002313.56
"RTN","BPSSCRCV",203,0)
 ;BPDUZ7 - DUZ
"RTN","BPSSCRCV",204,0)
FILEALL(BPARRAY,BPDUZ7) ;
"RTN","BPSSCRCV",205,0)
 N BPFLD,BP2
"RTN","BPSSCRCV",206,0)
 S BPFLD=0
"RTN","BPSSCRCV",207,0)
 F  S BPFLD=+$O(BPARRAY(BPFLD)) Q:+BPFLD=0  D
"RTN","BPSSCRCV",208,0)
 . I $$SAVEPAR^BPSSCRSL(BPFLD,+BPDUZ7,$G(BPARRAY(BPFLD)))
"RTN","BPSSCRCV",209,0)
 I $$SAVEPAR^BPSSCRSL(2,BPDUZ7,$G(BPARRAY("DIVS")))
"RTN","BPSSCRCV",210,0)
 Q
"RTN","BPSSCRCV",211,0)
 ;
"RTN","BPSSCRCV",212,0)
 ;
"RTN","BPSSCRDS")
0^333^B11595705
"RTN","BPSSCRDS",1,0)
BPSSCRDS ;BHAM ISC/SS - ECME USER SCREEN DIVISION SELECT ;05-APR-05
"RTN","BPSSCRDS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRDS",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRDS",4,0)
 ;USER SCREEN
"RTN","BPSSCRDS",5,0)
 Q
"RTN","BPSSCRDS",6,0)
 ;/*----------------------
"RTN","BPSSCRDS",7,0)
 ;Division select for the user screen.
"RTN","BPSSCRDS",8,0)
 ;Input:
"RTN","BPSSCRDS",9,0)
 ;  BPARR - array to return division(s) : IEN of #9002313.56
"RTN","BPSSCRDS",10,0)
 ;  BPDUZ7 - DUZ
"RTN","BPSSCRDS",11,0)
 ;Return value:
"RTN","BPSSCRDS",12,0)
 ;  0 nothing selected/
"RTN","BPSSCRDS",13,0)
 ; -1 ALL
"RTN","BPSSCRDS",14,0)
 ; -2 timeout or uparrow
"RTN","BPSSCRDS",15,0)
 ; n  number of IENs of #9002313.56 selected by the user and stored in BPARR
"RTN","BPSSCRDS",16,0)
 ;Returned by reference:
"RTN","BPSSCRDS",17,0)
 ; BPARR - array with user profile info to store in IENs to #9002313.56
"RTN","BPSSCRDS",18,0)
DS(BPARR,BPDUZ7) ;
"RTN","BPSSCRDS",19,0)
 N DIR,DTOUT,BPINP
"RTN","BPSSCRDS",20,0)
 N DR,DIE,DA
"RTN","BPSSCRDS",21,0)
 N DIR
"RTN","BPSSCRDS",22,0)
 S BPINP=$$EDITFLD^BPSSCRCV(1.13,+BPDUZ7,"S^D:DIVISION;A:ALL","Select Certain Pharmacy (D)ivisions or (A)LL","ALL",.BPARR)
"RTN","BPSSCRDS",23,0)
 I BPINP=-1 Q -2  ;quit
"RTN","BPSSCRDS",24,0)
 I $P(BPINP,U,2)="A" Q -1  ;ALL
"RTN","BPSSCRDS",25,0)
 Q $$SELDIVS(BPDUZ7,.BPARR)
"RTN","BPSSCRDS",26,0)
 ;
"RTN","BPSSCRDS",27,0)
 ;/**
"RTN","BPSSCRDS",28,0)
 ;returns back the name of the ECME pharmacy division
"RTN","BPSSCRDS",29,0)
DIVNAME(BPDIV) ;
"RTN","BPSSCRDS",30,0)
 Q $P($G(^BPS(9002313.56,BPDIV,0)),U)
"RTN","BPSSCRDS",31,0)
 ;
"RTN","BPSSCRDS",32,0)
 ;/*----------------------
"RTN","BPSSCRDS",33,0)
 ;Reads division selection from the USER PROFILE file
"RTN","BPSSCRDS",34,0)
 ;Input:
"RTN","BPSSCRDS",35,0)
 ;  BPSDIVS by reference - array to return division(s) : BPSDIVS(IEN of #9002313.56)
"RTN","BPSSCRDS",36,0)
 ;  BPDUZ7 - DUZ
"RTN","BPSSCRDS",37,0)
 ;Return value:
"RTN","BPSSCRDS",38,0)
 ;  0 nothing selected
"RTN","BPSSCRDS",39,0)
 ; -1 ALL
"RTN","BPSSCRDS",40,0)
 ; n  number of IENs of #9002313.56 selected by the user and stored in BPSDIVS
"RTN","BPSSCRDS",41,0)
 ;Returned by reference:
"RTN","BPSSCRDS",42,0)
 ; BPSDIVS - array with IENs to #9002313.56
"RTN","BPSSCRDS",43,0)
GETDIVIS(BPDUZ7,BPSDIVS) ;*/
"RTN","BPSSCRDS",44,0)
 N BPDIV,BPCNT
"RTN","BPSSCRDS",45,0)
 S BPARRAY("DIVS")=$$GETPARAM^BPSSCRSL(2,BPDUZ7)
"RTN","BPSSCRDS",46,0)
 F BPCNT=1:1:20 S BPDIV=$P($G(BPARRAY("DIVS")),";",BPCNT+1) Q:+BPDIV=0  D
"RTN","BPSSCRDS",47,0)
 . S BPSDIVS(BPDIV)=""
"RTN","BPSSCRDS",48,0)
 Q BPCNT-1  ;number of items
"RTN","BPSSCRDS",49,0)
 ;
"RTN","BPSSCRDS",50,0)
 ;/** 
"RTN","BPSSCRDS",51,0)
 ;to select divisions (the user cannot select more then 20 divisions)
"RTN","BPSSCRDS",52,0)
 ;Input:
"RTN","BPSSCRDS",53,0)
 ;  BPARRAY - array to return division(s) in BPARRAY("DIVS")
"RTN","BPSSCRDS",54,0)
 ;  BPDUZ7 -DUZ
"RTN","BPSSCRDS",55,0)
 ;Return value:
"RTN","BPSSCRDS",56,0)
 ;  -2 timeout or up arrow
"RTN","BPSSCRDS",57,0)
 ;  n - number of divisions selected  
"RTN","BPSSCRDS",58,0)
 ;by reference - BPARRAY("DIVS") - the string with 
"RTN","BPSSCRDS",59,0)
 ;     divisions ien (#9002313.56) divided by "^"
"RTN","BPSSCRDS",60,0)
SELDIVS(BPDUZ7,BPARRAY) ;
"RTN","BPSSCRDS",61,0)
 N BPSDIVS,BPDIV1
"RTN","BPSSCRDS",62,0)
 N BP1,BPDIV,BPCNT
"RTN","BPSSCRDS",63,0)
 S BPDIV=0,BPCNT=0
"RTN","BPSSCRDS",64,0)
 ;reads from file- NOT from BPARRAY !
"RTN","BPSSCRDS",65,0)
 I $$GETDIVIS(BPDUZ7,.BPSDIVS)
"RTN","BPSSCRDS",66,0)
 W !,?2,"Selected:"
"RTN","BPSSCRDS",67,0)
 F  S BPDIV=$O(BPSDIVS(BPDIV)) Q:+BPDIV=0  S BPCNT=BPCNT+1 D
"RTN","BPSSCRDS",68,0)
 . W !,?10,$$DIVNAME(BPDIV)
"RTN","BPSSCRDS",69,0)
 F  S BPDIV=$$DIV() Q:BPDIV=-2  Q:+BPDIV=0  D
"RTN","BPSSCRDS",70,0)
 . I $D(BPSDIVS(BPDIV)) I $$DELDIV(BPDIV)="Y" K BPSDIVS(BPDIV)
"RTN","BPSSCRDS",71,0)
 . E  S BPSDIVS(BPDIV)=""
"RTN","BPSSCRDS",72,0)
 . S BPCNT=0,BPDIV1=0
"RTN","BPSSCRDS",73,0)
 . F  S BPDIV1=$O(BPSDIVS(BPDIV1)) Q:+BPDIV1=0  S BPCNT=BPCNT+1 D
"RTN","BPSSCRDS",74,0)
 . . I BPCNT>20 D  Q
"RTN","BPSSCRDS",75,0)
 . . . W !,"Number of selected divisions cannot exceed 20!"
"RTN","BPSSCRDS",76,0)
 . . . K BPSDIVS(BPDIV)
"RTN","BPSSCRDS",77,0)
 . S BPCNT=0,BPDIV1=0
"RTN","BPSSCRDS",78,0)
 . F  S BPDIV1=$O(BPSDIVS(BPDIV1)) Q:+BPDIV1=0  S BPCNT=BPCNT+1 D
"RTN","BPSSCRDS",79,0)
 . . W !,?10,$$DIVNAME(BPDIV1)
"RTN","BPSSCRDS",80,0)
 ;
"RTN","BPSSCRDS",81,0)
 I BPDIV=-2 D  Q -2  ;exit
"RTN","BPSSCRDS",82,0)
 . W !,"Exit without changes..."
"RTN","BPSSCRDS",83,0)
 . N BPSDIVS
"RTN","BPSSCRDS",84,0)
 . I $$GETDIVIS(BPDUZ7,.BPSDIVS)
"RTN","BPSSCRDS",85,0)
 . S BPCNT=0,BPDIV1=0
"RTN","BPSSCRDS",86,0)
 . F  S BPDIV1=$O(BPSDIVS(BPDIV1)) Q:+BPDIV1=0  S BPCNT=BPCNT+1 D
"RTN","BPSSCRDS",87,0)
 . . W !,?10,$$DIVNAME(BPDIV1)
"RTN","BPSSCRDS",88,0)
 ;
"RTN","BPSSCRDS",89,0)
 ;convert selection into "^div1;div2...divN;" string
"RTN","BPSSCRDS",90,0)
 S BPARRAY("DIVS")=""
"RTN","BPSSCRDS",91,0)
 F BPCNT=1:1:20 S BPDIV=$O(BPSDIVS(BPDIV)) Q:+BPDIV=0  D
"RTN","BPSSCRDS",92,0)
 . S BPARRAY("DIVS")=$G(BPARRAY("DIVS"))_";"_BPDIV
"RTN","BPSSCRDS",93,0)
 S BPARRAY("DIVS")=$G(BPARRAY("DIVS"))_";"
"RTN","BPSSCRDS",94,0)
 Q BPCNT-1
"RTN","BPSSCRDS",95,0)
 ;--------
"RTN","BPSSCRDS",96,0)
 ;
"RTN","BPSSCRDS",97,0)
DIV() ;
"RTN","BPSSCRDS",98,0)
 N DIC,DIRUT,DUOUT,DTOUT
"RTN","BPSSCRDS",99,0)
 S DIC("A")="Select ECME Pharmacy Division(s): ",DIC=9002313.56,DIC(0)="AEQM" D ^DIC
"RTN","BPSSCRDS",100,0)
 I $D(DIRUT) Q -2
"RTN","BPSSCRDS",101,0)
 I ($D(DUOUT))!($D(DTOUT)) Q -2
"RTN","BPSSCRDS",102,0)
 I Y<1 Q 0
"RTN","BPSSCRDS",103,0)
 Q +Y
"RTN","BPSSCRDS",104,0)
 ;
"RTN","BPSSCRDS",105,0)
 ;
"RTN","BPSSCRDS",106,0)
DELDIV(BPDIV) ;
"RTN","BPSSCRDS",107,0)
 N DIR
"RTN","BPSSCRDS",108,0)
 S DIR(0)="S^Y:YES;N:NO",DIR("A")="Delete "_$$DIVNAME(BPDIV)_" from your list?",DIR("B")="N" D ^DIR
"RTN","BPSSCRDS",109,0)
 Q Y
"RTN","BPSSCRDS",110,0)
 ;
"RTN","BPSSCRDV")
0^334^B986663
"RTN","BPSSCRDV",1,0)
BPSSCRDV ;BHAM ISC/SS - ECME SCREEN DEVELOPER LOG ;05-APR-05
"RTN","BPSSCRDV",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRDV",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRDV",4,0)
 Q
"RTN","BPSSCRDV",5,0)
 ;
"RTN","BPSSCRDV",6,0)
DV ;entry point for LOG menu option of the main User Screen
"RTN","BPSSCRDV",7,0)
 N BPRET,BPSEL
"RTN","BPSSCRDV",8,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRDV",9,0)
 D FULL^VALM1
"RTN","BPSSCRDV",10,0)
 W !,"Enter the line number for which you wish to print claim logs."
"RTN","BPSSCRDV",11,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","C","Please select SINGLE Rx Line.")
"RTN","BPSSCRDV",12,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSSCRDV",13,0)
 D CLAIMLOG^BPSOS6M(+$P(BPSEL,U,4))
"RTN","BPSSCRDV",14,0)
 S VALMBCK="R"
"RTN","BPSSCRDV",15,0)
 Q
"RTN","BPSSCRDV",16,0)
 ;
"RTN","BPSSCRLG")
0^335^B92478736
"RTN","BPSSCRLG",1,0)
BPSSCRLG ;BHAM ISC/SS - ECME LOGINFO ;05-APR-05
"RTN","BPSSCRLG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRLG",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRLG",4,0)
 ;USER SCREEN
"RTN","BPSSCRLG",5,0)
 Q
"RTN","BPSSCRLG",6,0)
 ;
"RTN","BPSSCRLG",7,0)
EN ; -- main entry point for BPS LSTMN LOG
"RTN","BPSSCRLG",8,0)
 D EN^VALM("BPS LSTMN LOG")
"RTN","BPSSCRLG",9,0)
 Q
"RTN","BPSSCRLG",10,0)
 ;
"RTN","BPSSCRLG",11,0)
HDR ; -- header code
"RTN","BPSSCRLG",12,0)
 S VALMHDR(1)="Claim Log information"
"RTN","BPSSCRLG",13,0)
 S VALMHDR(2)=""
"RTN","BPSSCRLG",14,0)
 Q
"RTN","BPSSCRLG",15,0)
 ;
"RTN","BPSSCRLG",16,0)
INIT ; -- init variables and list array
"RTN","BPSSCRLG",17,0)
 N BPSELCLM,LINE
"RTN","BPSSCRLG",18,0)
 S BPSELCLM=$G(@VALMAR@("SELLN"))
"RTN","BPSSCRLG",19,0)
 ;  piece 2: patient ien #2
"RTN","BPSSCRLG",20,0)
 ;  piece 3: insurance ien #36
"RTN","BPSSCRLG",21,0)
 ;  piece 4: ptr to #9002313.59
"RTN","BPSSCRLG",22,0)
 S LINE=1
"RTN","BPSSCRLG",23,0)
 S VALMCNT=$$PREPINFO(.LINE,$P(BPSELCLM,U,2),$P(BPSELCLM,U,3),$P(BPSELCLM,U,4))
"RTN","BPSSCRLG",24,0)
 S:VALMCNT>1 VALMCNT=VALMCNT-1
"RTN","BPSSCRLG",25,0)
 Q
"RTN","BPSSCRLG",26,0)
 ;
"RTN","BPSSCRLG",27,0)
HELP ; -- help code
"RTN","BPSSCRLG",28,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSSCRLG",29,0)
 Q
"RTN","BPSSCRLG",30,0)
 ;
"RTN","BPSSCRLG",31,0)
EXIT ; -- exit code
"RTN","BPSSCRLG",32,0)
 Q
"RTN","BPSSCRLG",33,0)
 ;
"RTN","BPSSCRLG",34,0)
EXPND ; -- expand code
"RTN","BPSSCRLG",35,0)
 Q
"RTN","BPSSCRLG",36,0)
 ;
"RTN","BPSSCRLG",37,0)
 ;
"RTN","BPSSCRLG",38,0)
LOG ;entry point for LOG menu option of the main User Screen
"RTN","BPSSCRLG",39,0)
 N BPRET,BPSEL
"RTN","BPSSCRLG",40,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRLG",41,0)
 D FULL^VALM1
"RTN","BPSSCRLG",42,0)
 W !,"Enter the line number for which you wish to print claim logs."
"RTN","BPSSCRLG",43,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","C","Please select SINGLE Rx Line.")
"RTN","BPSSCRLG",44,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSSCRLG",45,0)
 D SAVESEL(BPSEL,VALMAR)
"RTN","BPSSCRLG",46,0)
 D EN
"RTN","BPSSCRLG",47,0)
 S VALMBCK="R"
"RTN","BPSSCRLG",48,0)
 Q
"RTN","BPSSCRLG",49,0)
 ;
"RTN","BPSSCRLG",50,0)
 ;/**
"RTN","BPSSCRLG",51,0)
 ;save selection in order to use inside enclosed ListManager copy
"RTN","BPSSCRLG",52,0)
 ;BPSEL - selected line
"RTN","BPSSCRLG",53,0)
 ;BPVALMR - parent VALMAR 
"RTN","BPSSCRLG",54,0)
SAVESEL(BPSEL,BPVALMR) ;
"RTN","BPSSCRLG",55,0)
 D CLEANIT
"RTN","BPSSCRLG",56,0)
 S ^TMP("BPSLOG",$J,"VALM","SELLN")=BPSEL
"RTN","BPSSCRLG",57,0)
 S ^TMP("BPSLOG",$J,"VALM","PARENT")=BPVALMR
"RTN","BPSSCRLG",58,0)
 M ^TMP("BPSLOG",$J,"VALM","VIEWPARAMS")=@BPVALMR@("VIEWPARAMS")
"RTN","BPSSCRLG",59,0)
 Q
"RTN","BPSSCRLG",60,0)
 ;
"RTN","BPSSCRLG",61,0)
CLEANIT ;
"RTN","BPSSCRLG",62,0)
 K ^TMP("BPSLOG",$J,"VALM")
"RTN","BPSSCRLG",63,0)
 Q
"RTN","BPSSCRLG",64,0)
 ;input:
"RTN","BPSSCRLG",65,0)
 ; BPDFN: patient ien #2
"RTN","BPSSCRLG",66,0)
 ; BP36: insurance ien #36
"RTN","BPSSCRLG",67,0)
 ; BP59: ptr to #9002313.59
"RTN","BPSSCRLG",68,0)
 ; returns number of lines
"RTN","BPSSCRLG",69,0)
PREPINFO(BPLN,BPDFN,BP36,BP59) ;
"RTN","BPSSCRLG",70,0)
 I '$G(BP59) Q 0
"RTN","BPSSCRLG",71,0)
 I '$G(BP36) Q 0
"RTN","BPSSCRLG",72,0)
 I '$G(BPDFN) Q 0
"RTN","BPSSCRLG",73,0)
 N BPSCRLNS S BPSCRLNS=17 ;(see "BPS LSTMN LOG" LM template: Bottom=21, Top = 4, 21-4=17)
"RTN","BPSSCRLG",74,0)
 N BPX,BPRXIEN,BPREF,BP1,BPLSTCLM,BPLSTRSP,BPDAT59,BPUSR,BPSTRT,BPHIST,BPQ
"RTN","BPSSCRLG",75,0)
 N BPDT,BPLN0,BPCNT
"RTN","BPSSCRLG",76,0)
 S BP1=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRLG",77,0)
 S BPRXIEN=$P(BP1,U,1)
"RTN","BPSSCRLG",78,0)
 S BPREF=$P(BP1,U,2)
"RTN","BPSSCRLG",79,0)
 S BPDAT59(0)=$G(^BPST(BP59,0))
"RTN","BPSSCRLG",80,0)
 ;create a history
"RTN","BPSSCRLG",81,0)
 D MKHIST^BPSSCRU5(BP59,.BPHIST)
"RTN","BPSSCRLG",82,0)
 ;
"RTN","BPSSCRLG",83,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",84,0)
 D SETLINE(.BPLN,"Pharmacy ECME Log")
"RTN","BPSSCRLG",85,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",86,0)
 S BPX=$$RJ^BPSSCR02("VA Rx #: ",16)_$$LJ^BPSSCR02($$RXNUM^BPSSCRU2(+BPRXIEN),13)
"RTN","BPSSCRLG",87,0)
 S BPX=BPX_$$RJ^BPSSCR02("Fill #: ",10)_$$LJ^BPSSCR02(BPREF,4)
"RTN","BPSSCRLG",88,0)
 S BPX=BPX_$$RJ^BPSSCR02("ECME Claim Rx #: ",18)_$$LJ^BPSSCR02(BP59,20)
"RTN","BPSSCRLG",89,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",90,0)
 S BPX=$$RJ^BPSSCR02("Patient Name: ",16)
"RTN","BPSSCRLG",91,0)
 S BPX=BPX_$$LJ^BPSSCR02($$PATNAME^BPSSCRU2(BPDFN)_" "_$$SSN4^BPSSCRU2(BPDFN),30)
"RTN","BPSSCRLG",92,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",93,0)
 S BPX=$$RJ^BPSSCR02("Submitted: ",16)
"RTN","BPSSCRLG",94,0)
 S BPSTRT=$P(BPDAT59(0),U,11) ;@# need to check with analyst if this is a START DATE
"RTN","BPSSCRLG",95,0)
 I BPSTRT]"" S BPX=BPX_$$DATETIME^BPSSCRU5(BPSTRT)
"RTN","BPSSCRLG",96,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",97,0)
 S BPX=$$RJ^BPSSCR02("By: ",16)
"RTN","BPSSCRLG",98,0)
 S BPUSR=$P(BPDAT59(0),U,10)
"RTN","BPSSCRLG",99,0)
 I BPUSR]"" S BPX=BPX_$$GETUSRNM^BPSSCRU1(BPUSR)
"RTN","BPSSCRLG",100,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",101,0)
 ;
"RTN","BPSSCRLG",102,0)
 ;find the latest claim
"RTN","BPSSCRLG",103,0)
 S BP1=+$O(BPHIST("C",99999999),-1)
"RTN","BPSSCRLG",104,0)
 I BP1=0 D SETLINE(.BPLN,""),SETLINE(.BPLN,"------ No electronical claims ------") Q BPLN
"RTN","BPSSCRLG",105,0)
 S BP1=+$O(BPHIST("C",BP1,0))
"RTN","BPSSCRLG",106,0)
 S BPX=$$RJ^BPSSCR02("VA Claim #: ",16)_$P($G(^BPSC(+BP1,0)),U,1)
"RTN","BPSSCRLG",107,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",108,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",109,0)
 ;process history
"RTN","BPSSCRLG",110,0)
 N BPTYPE,BPIEN,BPIENRS
"RTN","BPSSCRLG",111,0)
 S BPDT=99999999
"RTN","BPSSCRLG",112,0)
 F  S BPDT=$O(BPHIST("C",BPDT),-1) Q:+BPDT=0  D
"RTN","BPSSCRLG",113,0)
 . S BPIEN=+$O(BPHIST("C",BPDT,0)) Q:BPIEN=""
"RTN","BPSSCRLG",114,0)
 . D DISPCLM(.BPLN,BP59,BPIEN,+BPHIST("C",BPDT,BPIEN),$P(BPHIST("C",BPDT,BPIEN),U,2),BPDT)
"RTN","BPSSCRLG",115,0)
 . S BPIENRS=0
"RTN","BPSSCRLG",116,0)
 . F  S BPIENRS=$O(BPHIST("C",BPDT,BPIEN,"R",BPIENRS)) Q:+BPIENRS=0  D
"RTN","BPSSCRLG",117,0)
 . . D DISPRSP(.BPLN,BP59,BPIENRS,+BPHIST("C",BPDT,BPIEN,"R",BPIENRS),$P(BPHIST("C",BPDT,BPIEN,"R",BPIENRS),U,2),BPDT)
"RTN","BPSSCRLG",118,0)
 Q BPLN
"RTN","BPSSCRLG",119,0)
 ;calls SET^VALM10,
"RTN","BPSSCRLG",120,0)
 ;increments BPLINE
"RTN","BPSSCRLG",121,0)
SETLINE(BPLINE,BPSTR) ;
"RTN","BPSSCRLG",122,0)
 D SET^VALM10(BPLINE,BPSTR)
"RTN","BPSSCRLG",123,0)
 S BPLINE=BPLINE+1
"RTN","BPSSCRLG",124,0)
 Q
"RTN","BPSSCRLG",125,0)
 ;display claim record
"RTN","BPSSCRLG",126,0)
DISPCLM(BPLN,BP59,BPIEN02,BP57,BPSTYPE,BPSDTALT) ;
"RTN","BPSSCRLG",127,0)
 N BPSCRLNS S BPSCRLNS=17 ;(see "BPS LSTMN LOG" LM template: Bottom=21, Top = 4, 21-4=17)
"RTN","BPSSCRLG",128,0)
 N BPX,BPLN0,BPCNT,BPSTR1,BPSTYP2
"RTN","BPSSCRLG",129,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",130,0)
 S BPSTYP2=$S(BPSTYPE="C":"CLAIM REQUEST",BPSTYPE="R":"REVERSAL",1:"")
"RTN","BPSSCRLG",131,0)
 S BPSTR1="Transmission Information ("_BPSTYP2_")(#"_BPIEN02_")"
"RTN","BPSSCRLG",132,0)
 D SETLINE(.BPLN,BPSTR1_$$LINE^BPSSCRU3(79-$L(BPSTR1),"-"))
"RTN","BPSSCRLG",133,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",134,0)
 D SETLINE(.BPLN,"Created on: "_$$CREATEDT(BPIEN02,BPSDTALT))
"RTN","BPSSCRLG",135,0)
 D SETLINE(.BPLN,"Transaction Type: "_$$TRTYPE^BPSSCRU5($$TRCODE(BPIEN02)))
"RTN","BPSSCRLG",136,0)
 D SETLINE(.BPLN,"Date of Service: "_$$DOSCLM(BPIEN02))
"RTN","BPSSCRLG",137,0)
 D SETLINE(.BPLN,"NDC: "_$$LNDC^BPSSCRU5(BPIEN02))
"RTN","BPSSCRLG",138,0)
 D SETLINE(.BPLN,"ECME Pharmacy: "_$$DIVNAME^BPSSCRDS($$LDIV(BP57)))
"RTN","BPSSCRLG",139,0)
 D SETLINE(.BPLN,"Days Supply: "_$$DAYSSUPL(BPIEN02))
"RTN","BPSSCRLG",140,0)
 S BPX="Qty: "_$$QTY(BP57)
"RTN","BPSSCRLG",141,0)
 S BPX=BPX_"     Unit Price: "_$$UNTPRICE(BP57)
"RTN","BPSSCRLG",142,0)
 S BPX=BPX_"     Total Price: "_$$TOTPRICE(BP57)
"RTN","BPSSCRLG",143,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",144,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",145,0)
 D SETLINE(.BPLN,"Insurance Name: "_$$INSUR57(BP57))
"RTN","BPSSCRLG",146,0)
 D SETLINE(.BPLN,"BIN: "_$$BIN(BPIEN02))
"RTN","BPSSCRLG",147,0)
 D SETLINE(.BPLN,"PCN: "_$$PCN(BPIEN02))
"RTN","BPSSCRLG",148,0)
 D SETLINE(.BPLN,"Group ID: "_$$GRPID(BPIEN02))
"RTN","BPSSCRLG",149,0)
 D SETLINE(.BPLN,"Cardholder ID: "_$$CRDHLDID(BPIEN02))
"RTN","BPSSCRLG",150,0)
 D SETLINE(.BPLN,"Patient Relationship Code: "_$$PATRELSH(BPIEN02,BP57))
"RTN","BPSSCRLG",151,0)
 D SETLINE(.BPLN,"Cardholder First Name: "_$$CRDHLDFN(BPIEN02,BP57))
"RTN","BPSSCRLG",152,0)
 D SETLINE(.BPLN,"Cardholder Last Name: "_$$CRDHLDLN(BPIEN02,BP57))
"RTN","BPSSCRLG",153,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",154,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",155,0)
 D SETLINE(.BPLN,"Plan ID: "_$$PLANID(BP57))
"RTN","BPSSCRLG",156,0)
 D SETLINE(.BPLN,"Payer Sheet IEN: "_$$PYRIEN^BPSSCRU5(BPIEN02))
"RTN","BPSSCRLG",157,0)
 D SETLINE(.BPLN,"B2 Payer Sheet IEN: "_$$B2PYRIEN^BPSSCRU5(BPIEN02,BP57))
"RTN","BPSSCRLG",158,0)
 D SETLINE(.BPLN,"B3 Rebill Payer Sheet: "_$$B3PYRIEN^BPSSCRU5(BPIEN02,BP59,BP57))
"RTN","BPSSCRLG",159,0)
 D SETLINE(.BPLN,"Certify Mode: "_$$CERTMOD(BP57))
"RTN","BPSSCRLG",160,0)
 D SETLINE(.BPLN,"Cert IEN: "_$$CERTIEN(BP57))
"RTN","BPSSCRLG",161,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",162,0)
 Q
"RTN","BPSSCRLG",163,0)
 ;Date os service date in BPS CLAIM file
"RTN","BPSSCRLG",164,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRLG",165,0)
DOSCLM(BPIEN02) ;
"RTN","BPSSCRLG",166,0)
 N BPDT
"RTN","BPSSCRLG",167,0)
 S BPDT=$P($G(^BPSC(BPIEN02,400,1,400)),U,1)\1
"RTN","BPSSCRLG",168,0)
 Q $E(BPDT,5,6)_"/"_$E(BPDT,7,8)_"/"_$E(BPDT,1,4)
"RTN","BPSSCRLG",169,0)
 ;record created on 
"RTN","BPSSCRLG",170,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRLG",171,0)
CREATEDT(BPIEN02,BPSDTALT) ;
"RTN","BPSSCRLG",172,0)
 N BPSDT
"RTN","BPSSCRLG",173,0)
 S BPSDT=+$P($G(^BPSC(BPIEN02,0)),U,6)
"RTN","BPSSCRLG",174,0)
 Q $$DATETIME^BPSSCRU5($S(BPSDT>0:BPSDT,1:BPSDTALT))
"RTN","BPSSCRLG",175,0)
 Q
"RTN","BPSSCRLG",176,0)
 ;Plan ID from #9002313.57
"RTN","BPSSCRLG",177,0)
PLANID(BP57) ;
"RTN","BPSSCRLG",178,0)
 Q $P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,1)
"RTN","BPSSCRLG",179,0)
 ;
"RTN","BPSSCRLG",180,0)
 ;
"RTN","BPSSCRLG",181,0)
CERTMOD(BP57) ;
"RTN","BPSSCRLG",182,0)
 Q $P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,5)
"RTN","BPSSCRLG",183,0)
 ;Software Vendor/Cert ID
"RTN","BPSSCRLG",184,0)
CERTIEN(BP57) ;
"RTN","BPSSCRLG",185,0)
 Q $P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,6)
"RTN","BPSSCRLG",186,0)
 ;group ID
"RTN","BPSSCRLG",187,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRLG",188,0)
GRPID(BPIEN02) ;
"RTN","BPSSCRLG",189,0)
 Q $E($P($G(^BPSC(BPIEN02,300)),U,1),3,99)
"RTN","BPSSCRLG",190,0)
 ;
"RTN","BPSSCRLG",191,0)
 ;Cardholder ID
"RTN","BPSSCRLG",192,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRLG",193,0)
CRDHLDID(BPIEN02) ;
"RTN","BPSSCRLG",194,0)
 Q $E($P($G(^BPSC(BPIEN02,300)),U,2),3,99)
"RTN","BPSSCRLG",195,0)
 ;Cardholder First name
"RTN","BPSSCRLG",196,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRLG",197,0)
CRDHLDFN(BPIEN02,BP57) ;
"RTN","BPSSCRLG",198,0)
 N Y
"RTN","BPSSCRLG",199,0)
 S Y=$P($G(^BPSC(BPIEN02,300)),U,12)
"RTN","BPSSCRLG",200,0)
 I $L(Y)=0 S Y=$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),1)),U,6)
"RTN","BPSSCRLG",201,0)
 Q Y
"RTN","BPSSCRLG",202,0)
 ;Cardholder Last  Name
"RTN","BPSSCRLG",203,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRLG",204,0)
CRDHLDLN(BPIEN02,BP57) ;
"RTN","BPSSCRLG",205,0)
 N Y
"RTN","BPSSCRLG",206,0)
 S Y=$P($G(^BPSC(BPIEN02,300)),U,13)
"RTN","BPSSCRLG",207,0)
 I $L(Y)=0 S Y=$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),1)),U,7)
"RTN","BPSSCRLG",208,0)
 Q Y
"RTN","BPSSCRLG",209,0)
 ;Patient Relationship Code
"RTN","BPSSCRLG",210,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRLG",211,0)
PATRELSH(BPIEN02,BP57) ;
"RTN","BPSSCRLG",212,0)
 N Y
"RTN","BPSSCRLG",213,0)
 S Y=$P($G(^BPSC(BPIEN02,300)),U,6)
"RTN","BPSSCRLG",214,0)
 I $L(Y)=0 S Y=$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),1)),U,5)
"RTN","BPSSCRLG",215,0)
 Q $S(Y=1:"CARDHOLDER",Y=2:"SPOUSE",Y=3:"CHILD",1:Y)
"RTN","BPSSCRLG",216,0)
 ;
"RTN","BPSSCRLG",217,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRLG",218,0)
PCN(BPIEN02) ;
"RTN","BPSSCRLG",219,0)
 Q $P($G(^BPSC(BPIEN02,100)),U,4)
"RTN","BPSSCRLG",220,0)
 ;
"RTN","BPSSCRLG",221,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRLG",222,0)
BIN(BPIEN02) ;
"RTN","BPSSCRLG",223,0)
 Q $P($G(^BPSC(BPIEN02,100)),U,1)
"RTN","BPSSCRLG",224,0)
 ;
"RTN","BPSSCRLG",225,0)
 ;
"RTN","BPSSCRLG",226,0)
 ;insurance name by 9002313.57 pointer
"RTN","BPSSCRLG",227,0)
INSUR57(BPIEN57) ;
"RTN","BPSSCRLG",228,0)
 N BPINSN
"RTN","BPSSCRLG",229,0)
 S BPINSN=+$G(^BPSTL(BPIEN57,9))
"RTN","BPSSCRLG",230,0)
 Q $P($G(^BPSTL(BPIEN57,10,BPINSN,0)),U,7)
"RTN","BPSSCRLG",231,0)
 ;
"RTN","BPSSCRLG",232,0)
QTY(BPIEN57) ;
"RTN","BPSSCRLG",233,0)
 Q +$P($G(^BPSTL(BPIEN57,5)),U,1)
"RTN","BPSSCRLG",234,0)
UNTPRICE(BPIEN57) ;
"RTN","BPSSCRLG",235,0)
 Q +$P($G(^BPSTL(BPIEN57,5)),U,2)
"RTN","BPSSCRLG",236,0)
TOTPRICE(BPIEN57) ;
"RTN","BPSSCRLG",237,0)
 Q +$P($G(^BPSTL(BPIEN57,5)),U,5)
"RTN","BPSSCRLG",238,0)
 ;get ECME pharmacy division ptr for LOG
"RTN","BPSSCRLG",239,0)
LDIV(BPIEN57) ;
"RTN","BPSSCRLG",240,0)
 Q +$P($G(^BPSTL(BPIEN57,1)),U,7)
"RTN","BPSSCRLG",241,0)
 ;
"RTN","BPSSCRLG",242,0)
 ;transaction code
"RTN","BPSSCRLG",243,0)
TRCODE(BPIEN02) ;
"RTN","BPSSCRLG",244,0)
 Q $P($G(^BPSC(BPIEN02,100)),U,3)
"RTN","BPSSCRLG",245,0)
 ;days supply
"RTN","BPSSCRLG",246,0)
DAYSSUPL(BPIEN02) ;
"RTN","BPSSCRLG",247,0)
 ;format D5NNN -> NNN
"RTN","BPSSCRLG",248,0)
 Q +$E($P($G(^BPSC(BPIEN02,400,1,400)),U,5),3,99)
"RTN","BPSSCRLG",249,0)
 ;
"RTN","BPSSCRLG",250,0)
 ;
"RTN","BPSSCRLG",251,0)
 ;display response record
"RTN","BPSSCRLG",252,0)
DISPRSP(BPLN,BP59,BPIEN03,BP57,BPSTYPE,BPSDTALT) ;
"RTN","BPSSCRLG",253,0)
 N BPSCRLNS S BPSCRLNS=17 ;(see "BPS LSTMN LOG" LM template: Bottom=21, Top = 4, 21-4=17)
"RTN","BPSSCRLG",254,0)
 N BPX,BPLN0,BPCNT,BPRJCDS,BPRJ,BPSTR1,BPSTYP2
"RTN","BPSSCRLG",255,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",256,0)
 S BPSTYP2=$S(BPSTYPE="C":"CLAIM REQUEST",BPSTYPE="R":"REVERSAL",1:"")
"RTN","BPSSCRLG",257,0)
 S BPSTR1="Response Information  ("_BPSTYP2_")(#"_BPIEN03_")"
"RTN","BPSSCRLG",258,0)
 D SETLINE(.BPLN,BPSTR1_$$LINE^BPSSCRU3(79-$L(BPSTR1),"-"))
"RTN","BPSSCRLG",259,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",260,0)
 D SETLINE(.BPLN,"Response Received: "_$$RESPREC(BPIEN03,BPSDTALT))
"RTN","BPSSCRLG",261,0)
 D SETLINE(.BPLN,"Date of Service: "_$$DOSRSP(BPIEN03))
"RTN","BPSSCRLG",262,0)
 D SETLINE(.BPLN,"Transaction Response Status: "_$$RESPSTAT^BPSSCRU5(BPIEN03))
"RTN","BPSSCRLG",263,0)
 D SETLINE(.BPLN,"Total Amount Paid: $"_+$$TOTAMNT(BPIEN03,BP59,BP57))
"RTN","BPSSCRLG",264,0)
 D SETLINE(.BPLN,"Reject code(s): ")
"RTN","BPSSCRLG",265,0)
 D REJCODES^BPSSCRU5(BPIEN03,.BPRJCDS)
"RTN","BPSSCRLG",266,0)
    S BPRJ=""
"RTN","BPSSCRLG",267,0)
    F  S BPRJ=$O(BPRJCDS(BPRJ)) Q:BPRJ=""  D
"RTN","BPSSCRLG",268,0)
 . D SETLINE(.BPLN," "_$$GETRJNAM^BPSSCRU3(BPRJ))
"RTN","BPSSCRLG",269,0)
 D WRAPLN^BPSSCRU5(.BPLN,$$MESSAGE(BPIEN03),76,"Message: ",5)
"RTN","BPSSCRLG",270,0)
 D WRAPLN^BPSSCRU5(.BPLN,$$ADDMESS(BPIEN03),76,"Additional Message: ",5)
"RTN","BPSSCRLG",271,0)
 ;D WRAPLN^BPSSCRU5(.BPLN,$$DUR(BPIEN03),60,"DUR Information: ",5)
"RTN","BPSSCRLG",272,0)
 D WRAPLN^BPSSCRU5(.BPLN,$$DURRESP(BPIEN03),76,"DUR Response Info: ",5)
"RTN","BPSSCRLG",273,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",274,0)
 Q
"RTN","BPSSCRLG",275,0)
 ;
"RTN","BPSSCRLG",276,0)
RESPREC(BPIEN03,BPSDTALT) ;
"RTN","BPSSCRLG",277,0)
 N BPSDT
"RTN","BPSSCRLG",278,0)
 S BPSDT=+$P($G(^BPSR(BPIEN03,0)),U,2)
"RTN","BPSSCRLG",279,0)
 Q $$DATETIME^BPSSCRU5($S(BPSDT>0:BPSDT,1:BPSDTALT))
"RTN","BPSSCRLG",280,0)
 ;
"RTN","BPSSCRLG",281,0)
DOSRSP(BPIEN03) ;
"RTN","BPSSCRLG",282,0)
 N BPDT
"RTN","BPSSCRLG",283,0)
 S BPDT=$P($G(^BPSR(BPIEN03,400)),U,1)\1
"RTN","BPSSCRLG",284,0)
 Q $E(BPDT,5,6)_"/"_$E(BPDT,7,8)_"/"_$E(BPDT,1,4)
"RTN","BPSSCRLG",285,0)
 ;
"RTN","BPSSCRLG",286,0)
TOTAMNT(BPIEN03,BP59,BP57) ;
"RTN","BPSSCRLG",287,0)
 Q $$DFF2EXT^BPSECFM($P($G(^BPSR(BPIEN03,1000,1,500)),U,9))
"RTN","BPSSCRLG",288,0)
 ;
"RTN","BPSSCRLG",289,0)
 ;
"RTN","BPSSCRLG",290,0)
MESSAGE(BPIEN03) ;
"RTN","BPSSCRLG",291,0)
 Q $P($G(^BPSR(BPIEN03,504)),U)
"RTN","BPSSCRLG",292,0)
 ;
"RTN","BPSSCRLG",293,0)
ADDMESS(BPIEN03) ;
"RTN","BPSSCRLG",294,0)
 Q $P($G(^BPSR(BPIEN03,1000,1,526)),U)
"RTN","BPSSCRLG",295,0)
 ;
"RTN","BPSSCRLG",296,0)
DUR(BPIEN03) ;
"RTN","BPSSCRLG",297,0)
 Q "???"
"RTN","BPSSCRLG",298,0)
 ;
"RTN","BPSSCRLG",299,0)
DURRESP(BPIEN03) ;
"RTN","BPSSCRLG",300,0)
 Q $P($G(^BPSR(BPIEN03,1000,1,525)),U)
"RTN","BPSSCRLG",301,0)
 ;
"RTN","BPSSCRLG",302,0)
 ;
"RTN","BPSSCRPR")
0^336^B504281
"RTN","BPSSCRPR",1,0)
BPSSCRPR ;BHAM ISC/SS - ECME SCREEN PRINT ;05-APR-05
"RTN","BPSSCRPR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRPR",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRPR",4,0)
 Q
"RTN","BPSSCRPR",5,0)
 ;
"RTN","BPSSCRPR",6,0)
PR ;
"RTN","BPSSCRPR",7,0)
 D FULL^VALM1
"RTN","BPSSCRPR",8,0)
 D PRTL^VALM1 ;standard LM API to print all entries on the device,
"RTN","BPSSCRPR",9,0)
 ;prompts for the device
"RTN","BPSSCRPR",10,0)
 S VALMBCK="R"
"RTN","BPSSCRPR",11,0)
 Q
"RTN","BPSSCRPR",12,0)
 ;
"RTN","BPSSCRRS")
0^337^B19576084
"RTN","BPSSCRRS",1,0)
BPSSCRRS ;BHAM ISC/SS - ECME SCREEN RESUBMIT ;05-APR-05
"RTN","BPSSCRRS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRRS",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRRS",4,0)
 Q
"RTN","BPSSCRRS",5,0)
 ;IA 4702
"RTN","BPSSCRRS",6,0)
 ;
"RTN","BPSSCRRS",7,0)
RES ;
"RTN","BPSSCRRS",8,0)
 N BPRET,BPSARR59
"RTN","BPSSCRRS",9,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRRS",10,0)
 D FULL^VALM1
"RTN","BPSSCRRS",11,0)
 W !,"Enter the line numbers for the claim(s) to be resubmitted."
"RTN","BPSSCRRS",12,0)
 S BPRET=$$ASKLINES^BPSSCRU4("Select item(s)","C",.BPSARR59,VALMAR)
"RTN","BPSSCRRS",13,0)
 I BPRET="^" S VALMBCK="R" Q
"RTN","BPSSCRRS",14,0)
 ;go thru all selected claims and try to resubmit them separately
"RTN","BPSSCRRS",15,0)
 ;update the content of the screen and display it
"RTN","BPSSCRRS",16,0)
 ;only if at least one claim was submitted successfully
"RTN","BPSSCRRS",17,0)
 I $$RESUBMIT(.BPSARR59) D REDRAW^BPSSCRUD("Updating screen for resubmitted claims...")
"RTN","BPSSCRRS",18,0)
 E  S VALMBCK="R"
"RTN","BPSSCRRS",19,0)
 Q
"RTN","BPSSCRRS",20,0)
 ;
"RTN","BPSSCRRS",21,0)
 ;/**
"RTN","BPSSCRRS",22,0)
 ;go thru all selected claims and try to resubmit them separately
"RTN","BPSSCRRS",23,0)
 ;input:
"RTN","BPSSCRRS",24,0)
 ; RXI - array with ptrs to BPS TRANSACTION file (see ASKLINES^BPSSCRU4)
"RTN","BPSSCRRS",25,0)
 ;returns 
"RTN","BPSSCRRS",26,0)
 ; 0 - if no claims were resubmitted 
"RTN","BPSSCRRS",27,0)
 ; 1 - if at least one claim was resubmitted 
"RTN","BPSSCRRS",28,0)
RESUBMIT(RXI) ;*/
"RTN","BPSSCRRS",29,0)
 N BPRVRSED ;was successfully reversed
"RTN","BPSSCRRS",30,0)
 N BPRVNEED ;needs reversal
"RTN","BPSSCRRS",31,0)
 N BPRVWAIT ;cycles of waiting 
"RTN","BPSSCRRS",32,0)
 N BPRVRSNT ;reversal has been sent
"RTN","BPSSCRRS",33,0)
 N WHERE,DOSDATE,BILLNUM,RXIEN,RXR,BPDFN
"RTN","BPSSCRRS",34,0)
 N BP59
"RTN","BPSSCRRS",35,0)
 N UPDATFLG,BPCLTOT
"RTN","BPSSCRRS",36,0)
 N BPQ
"RTN","BPSSCRRS",37,0)
 N BPSTATUS
"RTN","BPSSCRRS",38,0)
 N REVCOUNT S REVCOUNT=0
"RTN","BPSSCRRS",39,0)
 N BPIFANY S BPIFANY=0
"RTN","BPSSCRRS",40,0)
 S BPCLTOT=0
"RTN","BPSSCRRS",41,0)
 S UPDATFLG=0
"RTN","BPSSCRRS",42,0)
 S BP59="",BPQ=""
"RTN","BPSSCRRS",43,0)
 F  S BP59=$O(RXI(BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRRS",44,0)
 . I BPIFANY=0 W @IOF
"RTN","BPSSCRRS",45,0)
 . S BPIFANY=1,BPQ=""
"RTN","BPSSCRRS",46,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRRS",47,0)
 . W !,"You've chosen to RESUBMIT the following prescription for "_$E($$PATNAME^BPSSCRU2(BPDFN),1,13)
"RTN","BPSSCRRS",48,0)
 . W !,@VALMAR@(+$G(RXI(BP59)),0)
"RTN","BPSSCRRS",49,0)
 . S (BPRVNEED,BPRVRSED,BPRVWAIT,BPRVRSNT)=0
"RTN","BPSSCRRS",50,0)
 . S BPQ=$$YESNO("Are you sure?(Y/N)")
"RTN","BPSSCRRS",51,0)
 . I BPQ=-1 S BPQ="^" Q
"RTN","BPSSCRRS",52,0)
 . I BPQ'=1 Q
"RTN","BPSSCRRS",53,0)
 . S RXIEN=$P(BP59,".")
"RTN","BPSSCRRS",54,0)
 . S RXR=+$E($P(BP59,".",2),1,4)
"RTN","BPSSCRRS",55,0)
 . I BPRVNEED=1&(BPRVRSED'=1) Q  ;cannot be resubmitted
"RTN","BPSSCRRS",56,0)
 . I $D(^PSRX($P(BP59,".",1),"D")) W !!,">> Cannot Reverse or Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because it has been deleted in Pharmacy.",! Q
"RTN","BPSSCRRS",57,0)
 . S BPSTATUS=$P($$CLAIMST^BPSSCRU3(BP59),U)
"RTN","BPSSCRRS",58,0)
 . I BPSTATUS["E REVERSAL REJECTED" W !!,">> Cannot Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because the REVERSAL was rejected.",! Q
"RTN","BPSSCRRS",59,0)
 . I BPSTATUS["IN PROGRESS" W !!,">> Cannot Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because there is no response from the payer yet.",! Q
"RTN","BPSSCRRS",60,0)
 . I BPSTATUS["E REVERSAL STRANDED" W !!,">> Cannot Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because there is no response for reversal yet.",! Q
"RTN","BPSSCRRS",61,0)
 . S DOSDATE=$$DOSDATE(RXIEN,RXR)
"RTN","BPSSCRRS",62,0)
 . S BILLNUM=$$EN^BPSNCPDP(RXIEN,RXR,DOSDATE,"ERES","","ECME RESUBMIT")
"RTN","BPSSCRRS",63,0)
 . ;print return value message
"RTN","BPSSCRRS",64,0)
 . W !!
"RTN","BPSSCRRS",65,0)
 . W:+BILLNUM>0 "Not Processed:",!,"  "
"RTN","BPSSCRRS",66,0)
 . W $P(BILLNUM,U,2)
"RTN","BPSSCRRS",67,0)
 . ;0 Prescription/Fill successfully submitted to ECME for claims processing
"RTN","BPSSCRRS",68,0)
 . ;1 ECME did not submit prescription/fill
"RTN","BPSSCRRS",69,0)
 . ;2 IB says prescription/fill is not ECME billable or the data returned from IB is not valid
"RTN","BPSSCRRS",70,0)
 . ;3 ECME closed the claim but did not submit it to the payer
"RTN","BPSSCRRS",71,0)
 . ;4 Unable to queue the ECME claim
"RTN","BPSSCRRS",72,0)
 . ;5 Invalid input
"RTN","BPSSCRRS",73,0)
 . I +BILLNUM=0 D 
"RTN","BPSSCRRS",74,0)
 . . D ECMEACT^PSOBPSU1(+RXIEN,+RXR,"Claim resubmitted to 3rd party payer: ECME USER's SCREEN")
"RTN","BPSSCRRS",75,0)
 . . S UPDATFLG=1,BPCLTOT=BPCLTOT+1
"RTN","BPSSCRRS",76,0)
 W:BPIFANY=0 !,"No eligible items selected."
"RTN","BPSSCRRS",77,0)
 W !,BPCLTOT," claim",$S(BPCLTOT'=1:"s have",1:" has")," been resubmitted.",!
"RTN","BPSSCRRS",78,0)
 D PAUSE^VALM1
"RTN","BPSSCRRS",79,0)
 Q UPDATFLG
"RTN","BPSSCRRS",80,0)
 ;
"RTN","BPSSCRRS",81,0)
 ; Ask
"RTN","BPSSCRRS",82,0)
 ; Input:
"RTN","BPSSCRRS",83,0)
 ;  BPQSTR - question
"RTN","BPSSCRRS",84,0)
 ;  BPDFL - default answer
"RTN","BPSSCRRS",85,0)
 ; Output: 
"RTN","BPSSCRRS",86,0)
 ; 1 YES
"RTN","BPSSCRRS",87,0)
 ; 0 NO
"RTN","BPSSCRRS",88,0)
 ; -1 if cancelled
"RTN","BPSSCRRS",89,0)
YESNO(BPQSTR,BPDFL) ; Default - YES
"RTN","BPSSCRRS",90,0)
 N DIR,Y,DUOUT
"RTN","BPSSCRRS",91,0)
 S DIR(0)="Y"
"RTN","BPSSCRRS",92,0)
 S DIR("A")=BPQSTR
"RTN","BPSSCRRS",93,0)
 S:$L($G(BPDFL)) DIR("B")=BPDFL
"RTN","BPSSCRRS",94,0)
 D ^DIR
"RTN","BPSSCRRS",95,0)
 Q $S($G(DUOUT)!$G(DUOUT)!(Y="^"):-1,1:Y)
"RTN","BPSSCRRS",96,0)
 ;
"RTN","BPSSCRRS",97,0)
 ;Date of service
"RTN","BPSSCRRS",98,0)
 ;RXIEN - IEN in file #52
"RTN","BPSSCRRS",99,0)
 ;RXR - refill number
"RTN","BPSSCRRS",100,0)
 ;returns:
"RTN","BPSSCRRS",101,0)
 ; date of service
"RTN","BPSSCRRS",102,0)
DOSDATE(RXIEN,RXR) ;
"RTN","BPSSCRRS",103,0)
 N BPDOS,BPDT
"RTN","BPSSCRRS",104,0)
 ;try release date
"RTN","BPSSCRRS",105,0)
 S BPDOS=$$RXRLDT^PSOBPSUT(RXIEN,RXR)\1
"RTN","BPSSCRRS",106,0)
 Q:+BPDOS>0 BPDOS
"RTN","BPSSCRRS",107,0)
 ;try fill date
"RTN","BPSSCRRS",108,0)
 S BPDOS=$$RXFLDT^PSOBPSUT(RXIEN,RXR)\1
"RTN","BPSSCRRS",109,0)
 I '$G(DT) Q BPDOS
"RTN","BPSSCRRS",110,0)
 I BPDOS>0,BPDOS'>DT Q BPDOS
"RTN","BPSSCRRS",111,0)
 ;use current date (today)
"RTN","BPSSCRRS",112,0)
 Q DT\1
"RTN","BPSSCRRS",113,0)
 ;
"RTN","BPSSCRRV")
0^338^B14413135
"RTN","BPSSCRRV",1,0)
BPSSCRRV ;BHAM ISC/SS - ECME SCREEN REVERSE CLAIM ;05-APR-05
"RTN","BPSSCRRV",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRRV",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRRV",4,0)
 Q
"RTN","BPSSCRRV",5,0)
 ;IA 4702
"RTN","BPSSCRRV",6,0)
 ;
"RTN","BPSSCRRV",7,0)
REV ;entry point for "Reverse" menu item
"RTN","BPSSCRRV",8,0)
 N BPRET,BPSARR59
"RTN","BPSSCRRV",9,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRRV",10,0)
 D FULL^VALM1
"RTN","BPSSCRRV",11,0)
 W !,"Enter the line numbers for the Payable claim(s) to be Reversed."
"RTN","BPSSCRRV",12,0)
 S BPRET=$$ASKLINES^BPSSCRU4("Select item(s)","C",.BPSARR59,VALMAR)
"RTN","BPSSCRRV",13,0)
 I BPRET="^" S VALMBCK="R" Q
"RTN","BPSSCRRV",14,0)
 ;reverse selected lines
"RTN","BPSSCRRV",15,0)
 ;update the content of the screen and display it
"RTN","BPSSCRRV",16,0)
 ;only if at least one reversal was submitted successfully
"RTN","BPSSCRRV",17,0)
 I $$RVLINES(.BPSARR59)>0 D REDRAW^BPSSCRUD("Updating screen for reversed claims...")
"RTN","BPSSCRRV",18,0)
 E  S VALMBCK="R"
"RTN","BPSSCRRV",19,0)
 Q
"RTN","BPSSCRRV",20,0)
 ;/**
"RTN","BPSSCRRV",21,0)
 ;Reverse selected lines
"RTN","BPSSCRRV",22,0)
 ;input: 
"RTN","BPSSCRRV",23,0)
 ; BP59ARR(BP59)="line# in LM array "
"RTN","BPSSCRRV",24,0)
 ;output:
"RTN","BPSSCRRV",25,0)
 ; REVTOTAL - total number of claims for whose the reversal was submitted sucessfully  
"RTN","BPSSCRRV",26,0)
RVLINES(BP59ARR) ;*/
"RTN","BPSSCRRV",27,0)
 N BP59,REVTOTAL,BPRVREAS,BPDFN,BPQ
"RTN","BPSSCRRV",28,0)
 N BPIFANY S BPIFANY=0
"RTN","BPSSCRRV",29,0)
 N BPSTATS
"RTN","BPSSCRRV",30,0)
 S REVTOTAL=0,BPQ=""
"RTN","BPSSCRRV",31,0)
 S BP59="" F  S BP59=$O(BP59ARR(BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRRV",32,0)
 . I BPIFANY=0 W @IOF
"RTN","BPSSCRRV",33,0)
 . S BPIFANY=1,BPQ=""
"RTN","BPSSCRRV",34,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRRV",35,0)
 . S BPSTATS=$P($$CLAIMST^BPSSCRU3(BP59),U)
"RTN","BPSSCRRV",36,0)
 . I BPSTATS'["E DUPLICATE",BPSTATS'["E REVERSAL REJECTED",BPSTATS'["E REVERSAL STRANDED",BPSTATS'["E PAYABLE" D  S BPQ=$$PAUSE() Q
"RTN","BPSSCRRV",37,0)
 . . W !,"The claim: ",!,$G(@VALMAR@(+$G(BP59ARR(BP59)),0)),!,"is NOT Payable and cannot be Reversed."
"RTN","BPSSCRRV",38,0)
 . ;
"RTN","BPSSCRRV",39,0)
 . W !,"You've chosen to REVERSE the following prescription for "_$E($$PATNAME^BPSSCRU2(BPDFN),1,13)
"RTN","BPSSCRRV",40,0)
 . W !,$G(@VALMAR@(+$G(BP59ARR(BP59)),0))
"RTN","BPSSCRRV",41,0)
 . F  S BPRVREAS=$$COMMENT^BPSSCRCL("Enter REQUIRED REVERSAL REASON",60) Q:BPRVREAS="^"  Q:($L(BPRVREAS)>0)&&(BPRVREAS'="^")&&('(BPRVREAS?1" "." "))  D
"RTN","BPSSCRRV",42,0)
 . . W !,"Please provide the reason or enter ^ to abandon the reversal."
"RTN","BPSSCRRV",43,0)
 . I BPRVREAS["^" W !,"The claim: ",!,$G(@VALMAR@(+$G(BP59ARR(BP59)),0)),!,"was NOT reversed!" S BPQ=$$PAUSE() Q
"RTN","BPSSCRRV",44,0)
 . S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSSCRRV",45,0)
 . I BPQ=-1 S BPQ="^" Q
"RTN","BPSSCRRV",46,0)
 . I BPQ'=1 Q
"RTN","BPSSCRRV",47,0)
 . I $$REVERSIT(BP59,BPRVREAS)=0 S REVTOTAL=REVTOTAL+1
"RTN","BPSSCRRV",48,0)
 W:BPIFANY=0 !,"No eligible items selected."
"RTN","BPSSCRRV",49,0)
 W !,REVTOTAL," claim reversal",$S(REVTOTAL'=1:"s",1:"")," in progress.",!
"RTN","BPSSCRRV",50,0)
 D PAUSE^VALM1
"RTN","BPSSCRRV",51,0)
 Q REVTOTAL
"RTN","BPSSCRRV",52,0)
 ;
"RTN","BPSSCRRV",53,0)
 ;
"RTN","BPSSCRRV",54,0)
 ;the similar to REVERSE
"RTN","BPSSCRRV",55,0)
 ;with some information displayed for the user 
"RTN","BPSSCRRV",56,0)
 ;Input:
"RTN","BPSSCRRV",57,0)
 ; BP59 ptr in file #9002313.59
"RTN","BPSSCRRV",58,0)
 ; BPRVREAS - reversal reason (free text)
"RTN","BPSSCRRV",59,0)
 ;Output:
"RTN","BPSSCRRV",60,0)
 ;-1 Claim is not Payable
"RTN","BPSSCRRV",61,0)
 ;-2 no reversal, it's unreversable
"RTN","BPSSCRRV",62,0)
 ;-3 paper claim
"RTN","BPSSCRRV",63,0)
 ;>0 - IEN of reversal claim if electronic claim submitted for
"RTN","BPSSCRRV",64,0)
 ;   reversal.
"RTN","BPSSCRRV",65,0)
REVERSIT(BP59,BPRVREAS) ;
"RTN","BPSSCRRV",66,0)
 N BPRET
"RTN","BPSSCRRV",67,0)
 N BPRX
"RTN","BPSSCRRV",68,0)
 N BPRXRF
"RTN","BPSSCRRV",69,0)
 S BPRXRF=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRRV",70,0)
 S BPRET=+$$REVERSE(BP59,BPRVREAS,+BPRXRF,+$P(BPRXRF,U,2))
"RTN","BPSSCRRV",71,0)
 S BPRX=$$RXNUM^BPSSCRU2(+BPRXRF)
"RTN","BPSSCRRV",72,0)
 Q BPRET
"RTN","BPSSCRRV",73,0)
 ;
"RTN","BPSSCRRV",74,0)
 ;
"RTN","BPSSCRRV",75,0)
 ;/**
"RTN","BPSSCRRV",76,0)
 ;Reverse the claim 
"RTN","BPSSCRRV",77,0)
 ;Input:
"RTN","BPSSCRRV",78,0)
 ; BP59 ptr in file #9002313.59
"RTN","BPSSCRRV",79,0)
 ; BPRVREAS - reversal reason (free text)
"RTN","BPSSCRRV",80,0)
 ; BPRX - RX ien (#52)
"RTN","BPSSCRRV",81,0)
 ; BPFIL - refill number
"RTN","BPSSCRRV",82,0)
 ;Output:
"RTN","BPSSCRRV",83,0)
 ; code^message
"RTN","BPSSCRRV",84,0)
 ; where 
"RTN","BPSSCRRV",85,0)
 ; code :
"RTN","BPSSCRRV",86,0)
 ;  from $$EN^BPSNCPDP
"RTN","BPSSCRRV",87,0)
 ;  0 Prescription/Fill successfully submitted to ECME for claims processing
"RTN","BPSSCRRV",88,0)
 ;  1 ECME did not submit prescription/fill
"RTN","BPSSCRRV",89,0)
 ;  2 IB says prescription/fill is not ECME billable or the data returned from IB is not valid
"RTN","BPSSCRRV",90,0)
 ;  3 ECME closed the claim but did not submit it to the payer
"RTN","BPSSCRRV",91,0)
 ;  4 Unable to queue the ECME claim
"RTN","BPSSCRRV",92,0)
 ;  5 Invalid input
"RTN","BPSSCRRV",93,0)
 ;  and additional 
"RTN","BPSSCRRV",94,0)
 ;  12 Claim has been deleted in Pharmacy.
"RTN","BPSSCRRV",95,0)
 ; message - whatever $$EN^BPSNCPDP returns
"RTN","BPSSCRRV",96,0)
 ; for 12 - "Claim has been deleted in Pharmacy."
"RTN","BPSSCRRV",97,0)
 ; 
"RTN","BPSSCRRV",98,0)
REVERSE(BP59,BPRVREAS,BPRX,BPFIL) ;*/
"RTN","BPSSCRRV",99,0)
 N BPDOS S BPDOS=$$DOSDATE^BPSSCRRS(BPRX,BPFIL)
"RTN","BPSSCRRV",100,0)
 N BPNDC S BPNDC=$$NDC^BPSSCRU2(BPRX,BPFIL)
"RTN","BPSSCRRV",101,0)
 N BPRET
"RTN","BPSSCRRV",102,0)
 I $D(^PSRX($P(BP59,".",1),"D")) D  Q 12_U_"Claim has been deleted in Pharmacy."
"RTN","BPSSCRRV",103,0)
 . W "claim has been deleted in Pharmacy."
"RTN","BPSSCRRV",104,0)
 S BPRET=$$EN^BPSNCPDP(BPRX,BPFIL,BPDOS,"EREV",BPNDC,BPRVREAS)
"RTN","BPSSCRRV",105,0)
 ;print return value message
"RTN","BPSSCRRV",106,0)
 W !!
"RTN","BPSSCRRV",107,0)
 W:+BPRET>0 "Not Processed:",!,"  "
"RTN","BPSSCRRV",108,0)
 W $P(BPRET,U,2)
"RTN","BPSSCRRV",109,0)
 ;0 Prescription/Fill successfully submitted to ECME for claims processing
"RTN","BPSSCRRV",110,0)
 ;1 ECME did not submit prescription/fill
"RTN","BPSSCRRV",111,0)
 ;2 IB says prescription/fill is not ECME billable or the data returned from IB is not valid
"RTN","BPSSCRRV",112,0)
 ;3 ECME closed the claim but did not submit it to the payer
"RTN","BPSSCRRV",113,0)
 ;4 Unable to queue the ECME claim
"RTN","BPSSCRRV",114,0)
 ;5 Invalid input
"RTN","BPSSCRRV",115,0)
 I +BPRET=0 D ECMEACT^PSOBPSU1(+BPRX,+BPFIL,"Claim reversal sent to 3rd party payer: ECME USER's SCREEN")
"RTN","BPSSCRRV",116,0)
 Q BPRET
"RTN","BPSSCRRV",117,0)
 ;
"RTN","BPSSCRRV",118,0)
PAUSE() ;
"RTN","BPSSCRRV",119,0)
 N X
"RTN","BPSSCRRV",120,0)
 W ! S DIR(0)="E" D ^DIR K DIR W !
"RTN","BPSSCRRV",121,0)
 Q X
"RTN","BPSSCRRV",122,0)
 ;
"RTN","BPSSCRSL")
0^339^B13407810
"RTN","BPSSCRSL",1,0)
BPSSCRSL ;BHAM ISC/SS - ECME SCREEN SORT LIST ;05-APR-05
"RTN","BPSSCRSL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRSL",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRSL",4,0)
 ;USER SCREEN
"RTN","BPSSCRSL",5,0)
 Q
"RTN","BPSSCRSL",6,0)
 ;****
"RTN","BPSSCRSL",7,0)
 ;This software is using PARAMETER TOOLS (see XT*7.3*26) to store user's settings:
"RTN","BPSSCRSL",8,0)
 ;PARAMETER DEFINITION NAME="BPS USRSCR" (file #8989.51, IA# 2263)
"RTN","BPSSCRSL",9,0)
 ;ENTITY is "USR" , i.e. IEN in ^VA(200  -- see definition for "BPS USRSCR"
"RTN","BPSSCRSL",10,0)
 ;INSTANCEs are as follows:
"RTN","BPSSCRSL",11,0)
 ;1.01 ONE/ALL USERS --'U' ONE USER, 'A' ALL; Display claims for ONE or ALL users 
"RTN","BPSSCRSL",12,0)
 ;1.02 ONE/ALL PATIENTS --'P' FOR ONE PATIENT; 'A' FOR ALL; Display claims for ONE/ALL PATIENTS 
"RTN","BPSSCRSL",13,0)
 ;1.03 ONE/ALL RX --'R' FOR ONE RX; 'A' FOR ALL; Display claims for ONE or ALL RX 
"RTN","BPSSCRSL",14,0)
 ;1.04 HOURS/DAYS -- 'D' FOR DAYS; 'H' FOR HOURS; Use HOURS or DAYS to specify timeframe 
"RTN","BPSSCRSL",15,0)
 ;1.05 TIMEFRAME -- NUMBER Depends on the value of the field "USR SCR HOURS/DAYS" this field will
"RTN","BPSSCRSL",16,0)
 ;store the default number of HOURS from NOW or DAYS from TODAY to select claims to display 
"RTN","BPSSCRSL",17,0)
 ;1.06 REJECTED/PAYABLE --'R' FOR REJECTS; 'P' FOR PAYABLES 'A' FOR ALL; Display Rejects or Payables or ALL claims 
"RTN","BPSSCRSL",18,0)
 ;1.07 RELEASED/NOT RELEASED --'R' FOR RELEASED; 'N' FOR NON-RELEASED; 'A' FOR ALL; Display Released Rxs or Non-Released Rxs or ALL 
"RTN","BPSSCRSL",19,0)
 ;1.08 CMOP/MAIL/WINDOW --'C' FOR CMOP; 'M' FOR MAIL;'W' FOR WINDOW;'A' FOR ALL; Display CMOP or Mail or Window or ALL Rxs 
"RTN","BPSSCRSL",20,0)
 ;1.09 REALTIME/BACKBILL --'R' FOR REALTIME; 'B' FOR BACKBILLS; 'A' FOR ALL; Display RealTime Fills or Backbills or ALL 
"RTN","BPSSCRSL",21,0)
 ;1.1 REJECT CODE/ALL --'R' FOR REJECT CODE; 'A' FOR ALL; Display Specific Reject Code or ALL Reject
"RTN","BPSSCRSL",22,0)
 ;Codes 0 means ALL Reject Codes otherwise - Reject Code value 
"RTN","BPSSCRSL",23,0)
 ;1.11 SINGLE/ALL INSURANCES --'I' FOR SINGLE INSURANCE;'A' FOR ALL; Display Single Insurance Company or All null - ALL otherwise - pointer to INSURANCE COMPANY file #36 
"RTN","BPSSCRSL",24,0)
 ;1.12 SORT LIST --'T' FOR TRANSACTION DATE;'D' FOR DIVISION; 'I' FOR INSURANCE; 'C' FOR REJECT CODE; 
"RTN","BPSSCRSL",25,0)
 ;'P' FOR PATIENT NAME -- 'N' FOR DRUG NAME; 'B' FOR BILL TYPE (BB/RT); 'L' FOR FILL LOCATION;
"RTN","BPSSCRSL",26,0)
 ;'R' FOR RELEASED/NON-RELEASED -- 'A' FOR ACTIVE/DISCONTINUED; the field used to sort claims in the list 
"RTN","BPSSCRSL",27,0)
 ;1.13 ALL ECME PHARMACY DIVISIONS --'D' FOR DIVISION; 'A' FOR ALL; 
"RTN","BPSSCRSL",28,0)
 ;1.14 SELECTED INSURANCE -- Single insurance to select claims for the User Screen, to store INSURANCE COMPANY pointer (#36) 
"RTN","BPSSCRSL",29,0)
 ;1.15 SELECTED REJECTED CODE --POINTER TO BPS NCPDP REJECT CODES FILE (#9002313.93) Reject code selected by the user to filter claims.
"RTN","BPSSCRSL",30,0)
 ;1.16 SELECTED USER -- POINTER TO NEW PERSON FILE (#200) Selected user for the user screen 
"RTN","BPSSCRSL",31,0)
 ;1.17 SELECTED PATIENT -- POINTER TO PATIENT FILE (#2) Selected patient for the User Screen 
"RTN","BPSSCRSL",32,0)
 ;1.18 SELECTED RX -- POINTER TO PRESCRIPTION FILE (#52) Selected RX 
"RTN","BPSSCRSL",33,0)
 ;2    ECME PHARMACY DIVISION -- the list of POINTERs TO BPS PHARMACIES FILE (#9002313.56) separated by "^"
"RTN","BPSSCRSL",34,0)
 ;should start and end with ";", example: ";4;5;"
"RTN","BPSSCRSL",35,0)
 ;
"RTN","BPSSCRSL",36,0)
 ;NOTE: use D ^XPAREDIT to add/edit values
"RTN","BPSSCRSL",37,0)
 ;
"RTN","BPSSCRSL",38,0)
 ;*****
"RTN","BPSSCRSL",39,0)
SL ;
"RTN","BPSSCRSL",40,0)
 D FULL^VALM1
"RTN","BPSSCRSL",41,0)
 W @IOF
"RTN","BPSSCRSL",42,0)
 K BPARR
"RTN","BPSSCRSL",43,0)
 I +$G(DUZ)=0 D ERRMSG^BPSSCRCV("Unknown User") Q
"RTN","BPSSCRSL",44,0)
 N BPDUZ7
"RTN","BPSSCRSL",45,0)
 S BPDUZ7=+DUZ
"RTN","BPSSCRSL",46,0)
 ;always get current profile from the file
"RTN","BPSSCRSL",47,0)
 ;D READPRFP(.BPARR,+DUZ)
"RTN","BPSSCRSL",48,0)
 D READPROF(.BPARR,+BPDUZ7)
"RTN","BPSSCRSL",49,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRSL",50,0)
 ;edit current profile
"RTN","BPSSCRSL",51,0)
 D EDITPROF(.BPARR,.BPDUZ7)
"RTN","BPSSCRSL",52,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRSL",53,0)
 ;save it if necessary only for SORT LIST field
"RTN","BPSSCRSL",54,0)
 ;(so we used a separate array for this and save it only)
"RTN","BPSSCRSL",55,0)
 N BPSRT S BPSRT(1.12)=BPARR(1.12)
"RTN","BPSSCRSL",56,0)
 D ENDEDIT(.BPSRT,+BPDUZ7)
"RTN","BPSSCRSL",57,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRSL",58,0)
 ;redraw screen
"RTN","BPSSCRSL",59,0)
 D REDRAW^BPSSCRUD("Updating screen...")
"RTN","BPSSCRSL",60,0)
 Q
"RTN","BPSSCRSL",61,0)
 ;
"RTN","BPSSCRSL",62,0)
 ;input:
"RTN","BPSSCRSL",63,0)
 ;BPARRAY - array that all settings:  
"RTN","BPSSCRSL",64,0)
 ;   in the form BPARRAY(instance in "BPS USRSCR" parameter tool entry) = value
"RTN","BPSSCRSL",65,0)
 ;BPDUZ7 - DUZ
"RTN","BPSSCRSL",66,0)
EDITPROF(BPARR,BPDUZ7) ;
"RTN","BPSSCRSL",67,0)
 N BP1
"RTN","BPSSCRSL",68,0)
 N BPRET
"RTN","BPSSCRSL",69,0)
 N BPSTR
"RTN","BPSSCRSL",70,0)
 S BPSTR="S^T:TRANSACTION DATE;D:DIVISION;I:INSURANCE;C:REJECT CODE;P:PATIENT NAME;N:DRUG NAME;B:BILL TYPE (BB/RT);L:FILL LOCATION;R:RELEASED/NON-RELEASED;A:ACTIVE/DISCONTINUED"
"RTN","BPSSCRSL",71,0)
 I $$EDITFLD^BPSSCRCV(1.12,+BPDUZ7,BPSTR,"ENTER SORT TYPE","TRANSACTION DATE",.BPARR)=-1 S BPDUZ7=0 Q
"RTN","BPSSCRSL",72,0)
 Q
"RTN","BPSSCRSL",73,0)
 ;
"RTN","BPSSCRSL",74,0)
 ;input:
"RTN","BPSSCRSL",75,0)
 ;BPARRAY - array that all settings:  
"RTN","BPSSCRSL",76,0)
 ;in the form BPARRAY(instance in "BPS USRSCR" parameter tool entry) = value
"RTN","BPSSCRSL",77,0)
 ;BPDUZ7 - DUZ
"RTN","BPSSCRSL",78,0)
 ;
"RTN","BPSSCRSL",79,0)
ENDEDIT(BPARRAY,BPDUZ7) ;
"RTN","BPSSCRSL",80,0)
 I $$PROMPT^BPSSCRCV("S^Y:YES;N:NO","DO YOU WANT TO SAVE THIS VIEW AS YOUR PREFERRED VIEW (Y/N)?","")="Y" D
"RTN","BPSSCRSL",81,0)
 . D FILEALL^BPSSCRCV(.BPARRAY,BPDUZ7)
"RTN","BPSSCRSL",82,0)
 Q
"RTN","BPSSCRSL",83,0)
 ;read profile information (used in other routines as well)
"RTN","BPSSCRSL",84,0)
 ;input:
"RTN","BPSSCRSL",85,0)
 ;BPDUZ7 - DUZ
"RTN","BPSSCRSL",86,0)
 ;input/output:
"RTN","BPSSCRSL",87,0)
 ;BPARRAY - to return back profile information, as reference
"RTN","BPSSCRSL",88,0)
 ;see description in the top of the routine
"RTN","BPSSCRSL",89,0)
READPROF(BPARRAY,BPDUZ7) ;
"RTN","BPSSCRSL",90,0)
 N RETV,RETARR,BPFLDNO,BPDIV,BP1
"RTN","BPSSCRSL",91,0)
 N RECIENS
"RTN","BPSSCRSL",92,0)
 S RECIENS=BPDUZ7_","
"RTN","BPSSCRSL",93,0)
 F BPFLDNO=1.01,1.02,1.03,1.04,1.05,1.06,1.07,1.08,1.09,1.1,1.11,1.12,1.13,1.14,1.15,1.16,1.17,1.18 D
"RTN","BPSSCRSL",94,0)
 . S RETV=$$GETPARAM(BPFLDNO,+BPDUZ7)
"RTN","BPSSCRSL",95,0)
 . S BPARRAY(BPFLDNO)=RETV
"RTN","BPSSCRSL",96,0)
 I BPARRAY(1.13)="D" D
"RTN","BPSSCRSL",97,0)
 . S BPARRAY("DIVS")=$$GETPARAM(2,+BPDUZ7)
"RTN","BPSSCRSL",98,0)
 Q
"RTN","BPSSCRSL",99,0)
 ;
"RTN","BPSSCRSL",100,0)
SORTTYPE(BPSTYPE) ;
"RTN","BPSSCRSL",101,0)
 Q:(BPSTYPE="T") "Transaction Date"
"RTN","BPSSCRSL",102,0)
 Q:(BPSTYPE="D") "ECME division"
"RTN","BPSSCRSL",103,0)
 Q:(BPSTYPE="I") "Insurance"
"RTN","BPSSCRSL",104,0)
 Q:(BPSTYPE="C") "Reject Code"
"RTN","BPSSCRSL",105,0)
 Q:(BPSTYPE="P") "Patient Name"
"RTN","BPSSCRSL",106,0)
 Q:(BPSTYPE="N") "Drug Name"
"RTN","BPSSCRSL",107,0)
 Q:(BPSTYPE="B") "Claim's Origin (BB/RT)"
"RTN","BPSSCRSL",108,0)
 Q:(BPSTYPE="L") "Fill Location"
"RTN","BPSSCRSL",109,0)
 Q:(BPSTYPE="R") "Released/Non-released"
"RTN","BPSSCRSL",110,0)
 Q:(BPSTYPE="A") "Active/Discontinued"
"RTN","BPSSCRSL",111,0)
 Q ""
"RTN","BPSSCRSL",112,0)
 ;
"RTN","BPSSCRSL",113,0)
 ;
"RTN","BPSSCRSL",114,0)
GETPARAM(BPFLDNO,BPDUZ) ;
"RTN","BPSSCRSL",115,0)
 Q $$GET^XPAR(BPDUZ_";VA(200,","BPS USRSCR",BPFLDNO,"I")
"RTN","BPSSCRSL",116,0)
 ;
"RTN","BPSSCRSL",117,0)
 ;save value of the parameter
"RTN","BPSSCRSL",118,0)
SAVEPAR(BPFLDNO,BPDUZ,BPVAL) ;
"RTN","BPSSCRSL",119,0)
 D EN^XPAR(BPDUZ_";VA(200,","BPS USRSCR",BPFLDNO,BPVAL,.BPERR)
"RTN","BPSSCRSL",120,0)
 I BPERR'="0" W !,BPERR,! Q 0
"RTN","BPSSCRSL",121,0)
 Q 1
"RTN","BPSSCRSL",122,0)
 ;
"RTN","BPSSCRU1")
0^340^B2399860
"RTN","BPSSCRU1",1,0)
BPSSCRU1 ;BHAM ISC/SS - ECME SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCRU1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRU1",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRU1",4,0)
 ;USER SCREEN
"RTN","BPSSCRU1",5,0)
 Q
"RTN","BPSSCRU1",6,0)
 ;
"RTN","BPSSCRU1",7,0)
 ;get date/time range
"RTN","BPSSCRU1",8,0)
 ;input:
"RTN","BPSSCRU1",9,0)
 ; BPROF - to store usre profile info
"RTN","BPSSCRU1",10,0)
 ;output:
"RTN","BPSSCRU1",11,0)
 ; BPROF("BDT") - start datetime in FM format
"RTN","BPSSCRU1",12,0)
 ; BPROF("EDT") - end datetime in FM format
"RTN","BPSSCRU1",13,0)
GETDT(BPROF) ;
"RTN","BPSSCRU1",14,0)
 N BPNOW,X,BPHORL,%
"RTN","BPSSCRU1",15,0)
 D NOW^%DTC S BPNOW=%
"RTN","BPSSCRU1",16,0)
 I ($G(BPROF(1.04))'="D")&($G(BPROF(1.04))'="H") S BPROF(1.04)="D"
"RTN","BPSSCRU1",17,0)
 I +$G(BPROF(1.05))=0 S BPROF(1.05)=1
"RTN","BPSSCRU1",18,0)
 I $G(BPROF(1.04))="D" D
"RTN","BPSSCRU1",19,0)
 . S BPROF("BDT")=$$FMADD^XLFDT(BPNOW\1,-$G(BPROF(1.05)))-0.000001
"RTN","BPSSCRU1",20,0)
 . S BPROF("EDT")=(BPNOW\1)+0.9
"RTN","BPSSCRU1",21,0)
 I $G(BPROF(1.04))="H" D
"RTN","BPSSCRU1",22,0)
 . S BPROF("BDT")=$$FMADD^XLFDT(BPNOW,0,-$G(BPROF(1.05)))
"RTN","BPSSCRU1",23,0)
 . S BPROF("EDT")=BPNOW
"RTN","BPSSCRU1",24,0)
 Q 1
"RTN","BPSSCRU1",25,0)
 ;
"RTN","BPSSCRU1",26,0)
 ;
"RTN","BPSSCRU1",27,0)
ISCOPAY ;stub
"RTN","BPSSCRU1",28,0)
 Q "COPAY"
"RTN","BPSSCRU1",29,0)
 ;
"RTN","BPSSCRU1",30,0)
CLPRCNTG ;stub
"RTN","BPSSCRU1",31,0)
 Q "%%"
"RTN","BPSSCRU1",32,0)
 ;
"RTN","BPSSCRU1",33,0)
PTCLMINF ;stub
"RTN","BPSSCRU1",34,0)
 Q "X claims payable"
"RTN","BPSSCRU1",35,0)
 ;
"RTN","BPSSCRU1",36,0)
 ;/**
"RTN","BPSSCRU1",37,0)
 ;get user name from file #200
"RTN","BPSSCRU1",38,0)
 ;input: BPDUZ ien in file 200
"RTN","BPSSCRU1",39,0)
 ;output name as string
"RTN","BPSSCRU1",40,0)
GETUSRNM(BPDUZ) ;
"RTN","BPSSCRU1",41,0)
 Q $E($$GET1^DIQ(200,+BPDUZ,.01,"E"),1,20)
"RTN","BPSSCRU1",42,0)
 ;
"RTN","BPSSCRU1",43,0)
 ;/**
"RTN","BPSSCRU1",44,0)
 ;Checks if the CLAIM for specific Transaction is CLOSED?
"RTN","BPSSCRU1",45,0)
 ;BP59 - 9002313.59
"RTN","BPSSCRU1",46,0)
CLOSED(BP59) ;*/
"RTN","BPSSCRU1",47,0)
 N BPCLAIM
"RTN","BPSSCRU1",48,0)
 ;get claim ptr to #9002313.02
"RTN","BPSSCRU1",49,0)
 S BPCLAIM=+$P($G(^BPST(BP59,0)),U,3)  ;$$GET1^DIQ(9002313.59,BP59,3,"I") I 'CLAIM Q 0
"RTN","BPSSCRU1",50,0)
 ; get closed status
"RTN","BPSSCRU1",51,0)
 Q +$P($G(^BPSC(BPCLAIM,900)),U)=1  ;Q $$GET1^DIQ(9002313.02,CLAIM,901,"I")
"RTN","BPSSCRU1",52,0)
 ;
"RTN","BPSSCRU2")
0^341^B62609575
"RTN","BPSSCRU2",1,0)
BPSSCRU2 ;BHAM ISC/SS - ECME SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCRU2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRU2",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRU2",4,0)
 ;USER SCREEN
"RTN","BPSSCRU2",5,0)
 Q
"RTN","BPSSCRU2",6,0)
 ;/**
"RTN","BPSSCRU2",7,0)
 ;Input:
"RTN","BPSSCRU2",8,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",9,0)
 ;Output:
"RTN","BPSSCRU2",10,0)
 ;get filling "location" like "WINDOW/LOCALMAIL/CMOP"
"RTN","BPSSCRU2",11,0)
GETMWC(BP59) ;*/
"RTN","BPSSCRU2",12,0)
 N BP1 S BP1=$$RXREF(BP59)
"RTN","BPSSCRU2",13,0)
 Q:+BP1=0 ""
"RTN","BPSSCRU2",14,0)
 Q $$MWC($P(BP1,U),$P(BP1,U,2))
"RTN","BPSSCRU2",15,0)
 ;
"RTN","BPSSCRU2",16,0)
 ;converts numbers to letters to display on the screen
"RTN","BPSSCRU2",17,0)
 ;2-MAIL/3-WINDOW/4-CMOP
"RTN","BPSSCRU2",18,0)
MWCNAME(BPMWC) ;
"RTN","BPSSCRU2",19,0)
 Q $S(BPMWC=2:"M",BPMWC=3:"W",BPMWC=4:"C",1:"?")
"RTN","BPSSCRU2",20,0)
 ;/**
"RTN","BPSSCRU2",21,0)
 ;Input:
"RTN","BPSSCRU2",22,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",23,0)
 ;Output:
"RTN","BPSSCRU2",24,0)
 ;get RX pointer in file #52 and refill number in its multiple (0 - original refill)
"RTN","BPSSCRU2",25,0)
RXREF(BP59) ;
"RTN","BPSSCRU2",26,0)
 N BPRX,BPREF
"RTN","BPSSCRU2",27,0)
 S BPRX=+$P($G(^BPST(BP59,1)),U,11) ;ptr to RX node in #52
"RTN","BPSSCRU2",28,0)
 S BPREF=+$P($G(^BPST(BP59,1)),U) ;ptr to refill multiple in #52
"RTN","BPSSCRU2",29,0)
 Q BPRX_U_BPREF
"RTN","BPSSCRU2",30,0)
 ; determines if the refill was MAIL/WINDOW/CMOP
"RTN","BPSSCRU2",31,0)
MWC(BPRX,BPREF) ;MAIL/WINDOW/CMOP
"RTN","BPSSCRU2",32,0)
 ;input:
"RTN","BPSSCRU2",33,0)
 ; BPRX ptr to #52 (RX)
"RTN","BPSSCRU2",34,0)
 ; BPREF ptr to #52.1 (refills)
"RTN","BPSSCRU2",35,0)
 ;return value:
"RTN","BPSSCRU2",36,0)
 ; 2-MAIL/3-WINDOW/4-CMOP
"RTN","BPSSCRU2",37,0)
 N BPX,BPY,BPZ S BPY=2
"RTN","BPSSCRU2",38,0)
 ;if 1st fill check #52 (#11) MAIL/WINDOW
"RTN","BPSSCRU2",39,0)
 I BPREF=0 S BPX=$P($G(^PSRX(BPRX,0)),U,11)
"RTN","BPSSCRU2",40,0)
 ;if refill check refills multiple #52.1 (#2) MAIL/WINDOW
"RTN","BPSSCRU2",41,0)
 E  S BPX=$P($G(^PSRX(BPRX,1,BPREF,0)),U,2)
"RTN","BPSSCRU2",42,0)
 ; if WINDOW then 3(W)
"RTN","BPSSCRU2",43,0)
 I BPX="W" Q 3
"RTN","BPSSCRU2",44,0)
 ; else
"RTN","BPSSCRU2",45,0)
 ;  check STATUS of RX
"RTN","BPSSCRU2",46,0)
 ;  if STATUS="SUSPENSE" check 
"RTN","BPSSCRU2",47,0)
 I $G(^PSRX(BPRX,"STA"))=5 D  Q BPY
"RTN","BPSSCRU2",48,0)
 . ;   check #52.5
"RTN","BPSSCRU2",49,0)
 . S BPX=$O(^PS(52.5,"B",BPRX,0))
"RTN","BPSSCRU2",50,0)
 . ;   if CMOP INDICATOR = "P" then 2 (M)
"RTN","BPSSCRU2",51,0)
 . S BPZ=$P($G(^PS(52.5,BPX,0)),U,7)
"RTN","BPSSCRU2",52,0)
 . I (BPZ="")!(BPZ="P") S BPY=2 Q
"RTN","BPSSCRU2",53,0)
 . ;   else (i.e. Q!X!L) 4(C)
"RTN","BPSSCRU2",54,0)
 . S BPY=4
"RTN","BPSSCRU2",55,0)
 ;  else 
"RTN","BPSSCRU2",56,0)
 ;  check CMOP EVENTS for this 0 fill
"RTN","BPSSCRU2",57,0)
 S BPY=2
"RTN","BPSSCRU2",58,0)
 S BPX=0 F  S BPX=$O(^PSRX(BPRX,4,BPX)) Q:+BPX=0!(BPY=4)  D
"RTN","BPSSCRU2",59,0)
 . ;  if exists for BPREF then 4("C")
"RTN","BPSSCRU2",60,0)
 . I $P($G(^PSRX(BPRX,4,BPX,0)),U,3)=BPREF S BPY=4
"RTN","BPSSCRU2",61,0)
 ;  else 2("M")
"RTN","BPSSCRU2",62,0)
 Q BPY
"RTN","BPSSCRU2",63,0)
 ;
"RTN","BPSSCRU2",64,0)
 ;
"RTN","BPSSCRU2",65,0)
 ;/**
"RTN","BPSSCRU2",66,0)
 ;Input:
"RTN","BPSSCRU2",67,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",68,0)
 ;Output:
"RTN","BPSSCRU2",69,0)
 ; insurance ien ^ name ^ phone
"RTN","BPSSCRU2",70,0)
GETINSUR(BP59) ;get insurance info by the pointer of #9002313.59
"RTN","BPSSCRU2",71,0)
 N BPHONE,BPINSNM,BPINSID,BP57,BPINSN,BPX
"RTN","BPSSCRU2",72,0)
 S BPX=$$NAMEPHON^BPSSCRU3(BP59)
"RTN","BPSSCRU2",73,0)
 S BPINSNM=$P(BPX,U,1)
"RTN","BPSSCRU2",74,0)
 S BPHONE=$P(BPX,U,2)
"RTN","BPSSCRU2",75,0)
 ;Get a temporary ID for the insurance from ^TMP list of insurances.
"RTN","BPSSCRU2",76,0)
 ;If doesn't exist yet then create a new record in ^TMP list of insurances 
"RTN","BPSSCRU2",77,0)
 ;   for this insurance and return the ID for the record.
"RTN","BPSSCRU2",78,0)
 ;A lifetime for ^TMP list of insurances is the time period the user is using 
"RTN","BPSSCRU2",79,0)
 ;   the User Screen menu option
"RTN","BPSSCRU2",80,0)
 S BPINSID=$$CHKINSUR^BPSSCR(BPINSNM,BPHONE)
"RTN","BPSSCRU2",81,0)
 I $L(BPHONE)=0 S BPHONE=" "
"RTN","BPSSCRU2",82,0)
 I $L(BPINSNM)=0 S BPINSNM="?NODATA?"
"RTN","BPSSCRU2",83,0)
 Q BPINSID_U_BPINSNM_U_BPHONE
"RTN","BPSSCRU2",84,0)
 ;
"RTN","BPSSCRU2",85,0)
 ;/**
"RTN","BPSSCRU2",86,0)
 ;Input:
"RTN","BPSSCRU2",87,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",88,0)
 ;Output:
"RTN","BPSSCRU2",89,0)
 ;transaction date
"RTN","BPSSCRU2",90,0)
TRANDT(BP59) ;
"RTN","BPSSCRU2",91,0)
 Q $P($G(^BPST(BP59,0)),U,8)\1
"RTN","BPSSCRU2",92,0)
 ;
"RTN","BPSSCRU2",93,0)
 ;/**
"RTN","BPSSCRU2",94,0)
 ;Input:
"RTN","BPSSCRU2",95,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",96,0)
 ;Output:
"RTN","BPSSCRU2",97,0)
 ;ECME pharmacy division (9002313.56)
"RTN","BPSSCRU2",98,0)
DIVIS(BP59) ;
"RTN","BPSSCRU2",99,0)
 Q $P($G(^BPST(BP59,1)),U,7)
"RTN","BPSSCRU2",100,0)
 ;
"RTN","BPSSCRU2",101,0)
 ;/**
"RTN","BPSSCRU2",102,0)
 ;Input:
"RTN","BPSSCRU2",103,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",104,0)
 ;Output:
"RTN","BPSSCRU2",105,0)
 ;patient's DFN (file #2)
"RTN","BPSSCRU2",106,0)
GETPATID(BP59) ;
"RTN","BPSSCRU2",107,0)
 Q $P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRU2",108,0)
 ;
"RTN","BPSSCRU2",109,0)
 ;/**
"RTN","BPSSCRU2",110,0)
 ;determines if the RX is active 
"RTN","BPSSCRU2",111,0)
 ;Input:
"RTN","BPSSCRU2",112,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",113,0)
 ;Output:
"RTN","BPSSCRU2",114,0)
 ;Active (returns 1) means : ACTIVE/NON-VERIFIED/REFILL/HOLD/DRUG INTERACTIONS/SUSPENDED
"RTN","BPSSCRU2",115,0)
 ;inactive (returns 0) means: Discontinued/deleted/expired
"RTN","BPSSCRU2",116,0)
 ;error (returns -1)
"RTN","BPSSCRU2",117,0)
ACTIVERX(BP59) ;
"RTN","BPSSCRU2",118,0)
 Q $$RXACTIVE($$RXSTATUS(+$$RXREF(BP59),0))
"RTN","BPSSCRU2",119,0)
 ;return RX status as ACT/DIS/etc
"RTN","BPSSCRU2",120,0)
RXST(BP59) ;
"RTN","BPSSCRU2",121,0)
 N BPRXREF
"RTN","BPSSCRU2",122,0)
 S BPRXREF=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRU2",123,0)
 ;display status ONLY if the refill is the most recent 
"RTN","BPSSCRU2",124,0)
 ;otherwise display blanks (three spaces for sorting purposes)
"RTN","BPSSCRU2",125,0)
 I +$P(BPRXREF,U,2)'=(+$$LSTRFL^PSOBPSU1(+$P(BPRXREF,U,1))) Q "***"
"RTN","BPSSCRU2",126,0)
 Q $$RXSTANAM($$RXSTATUS(+$P(BPRXREF,U,1),0))
"RTN","BPSSCRU2",127,0)
 ;/**
"RTN","BPSSCRU2",128,0)
 ;RX status
"RTN","BPSSCRU2",129,0)
 ;Input 
"RTN","BPSSCRU2",130,0)
 ; RXNUM:
"RTN","BPSSCRU2",131,0)
 ;  ien of file #52 (if MODE=0) 
"RTN","BPSSCRU2",132,0)
 ;  or RX number (if MODE=1)
"RTN","BPSSCRU2",133,0)
 ; MODE:
"RTN","BPSSCRU2",134,0)
 ;  0-ien of file #52
"RTN","BPSSCRU2",135,0)
 ;  1-RX number  
"RTN","BPSSCRU2",136,0)
 ;----------
"RTN","BPSSCRU2",137,0)
 ;Output:
"RTN","BPSSCRU2",138,0)
 ; 0    if not found
"RTN","BPSSCRU2",139,0)
 ; status set#
"RTN","BPSSCRU2",140,0)
RXSTATUS(RXNUM,MODE) ;*/
"RTN","BPSSCRU2",141,0)
 I $G(MODE) S RXNUM=$O(^PSRX("B",RXNUM,0)) I +RXNUM=0 Q -1
"RTN","BPSSCRU2",142,0)
 I '$D(^PSRX(RXNUM,"STA")) Q -1
"RTN","BPSSCRU2",143,0)
 Q $G(^PSRX(RXNUM,"STA"))
"RTN","BPSSCRU2",144,0)
 ;/**
"RTN","BPSSCRU2",145,0)
 ;if RX "valid" 
"RTN","BPSSCRU2",146,0)
RXACTIVE(BPRXSTAT) ;*/
"RTN","BPSSCRU2",147,0)
 ; 0    not valid
"RTN","BPSSCRU2",148,0)
 ; 1    valid (i.e. ACTIVE/NON-VERIFIED/REFILL/HOLD/DRUG INTERACTIONS/SUSPENDED) 
"RTN","BPSSCRU2",149,0)
 ; -1   doesn't exist
"RTN","BPSSCRU2",150,0)
 Q:BPRXSTAT<6 1  ;active
"RTN","BPSSCRU2",151,0)
 ;/**
"RTN","BPSSCRU2",152,0)
 ;RX status text
"RTN","BPSSCRU2",153,0)
RXSTANAM(BPRXSTAT) ;*/
"RTN","BPSSCRU2",154,0)
 Q:BPRXSTAT=0 "ACT"  ; ACTIVE; 
"RTN","BPSSCRU2",155,0)
 Q:BPRXSTAT=1 "NVER"  ; NON-VERIFIED; 
"RTN","BPSSCRU2",156,0)
 Q:BPRXSTAT=3 "HLD"  ; HOLD; 
"RTN","BPSSCRU2",157,0)
 Q:BPRXSTAT=5 "SUS"  ; SUSPENDED; 
"RTN","BPSSCRU2",158,0)
 Q:BPRXSTAT=11 "EXP"  ; EXPIRED; 
"RTN","BPSSCRU2",159,0)
 Q:BPRXSTAT=12 "DIS"  ; DISCONTINUED; 
"RTN","BPSSCRU2",160,0)
 Q:BPRXSTAT=13 "DEL"  ; DELETED; 
"RTN","BPSSCRU2",161,0)
 Q:BPRXSTAT=14 "DIS"  ; DISCONTINUED BY PROVIDER; 
"RTN","BPSSCRU2",162,0)
 Q:BPRXSTAT=15 "DIS"  ; DISCONTINUED (EDIT); 
"RTN","BPSSCRU2",163,0)
 Q:BPRXSTAT=16 "HLD"  ; PROVIDER HOLD; 
"RTN","BPSSCRU2",164,0)
 Q:BPRXSTAT=-1 "???"
"RTN","BPSSCRU2",165,0)
 Q ""
"RTN","BPSSCRU2",166,0)
 ;/**
"RTN","BPSSCRU2",167,0)
 ;Input:
"RTN","BPSSCRU2",168,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",169,0)
 ;Output:
"RTN","BPSSCRU2",170,0)
 ;returns:
"RTN","BPSSCRU2",171,0)
 ;>0  Released
"RTN","BPSSCRU2",172,0)
 ;0   non released
"RTN","BPSSCRU2",173,0)
 ;-1  error
"RTN","BPSSCRU2",174,0)
ISRXREL(BP59) ;
"RTN","BPSSCRU2",175,0)
 N BP1
"RTN","BPSSCRU2",176,0)
 S BP1=$$REFILINF(BP59)
"RTN","BPSSCRU2",177,0)
 Q:BP1<0 -1
"RTN","BPSSCRU2",178,0)
 Q $P(BP1,U,2) ; i.e. it is non-released if there is no any release date
"RTN","BPSSCRU2",179,0)
 ;
"RTN","BPSSCRU2",180,0)
 ;release status
"RTN","BPSSCRU2",181,0)
RL(BP59) ;
"RTN","BPSSCRU2",182,0)
 Q $S($$ISRXREL(BP59)>0:"RL",1:"NR")
"RTN","BPSSCRU2",183,0)
 ;/**
"RTN","BPSSCRU2",184,0)
 ;get refill (including original refill) info by BP59
"RTN","BPSSCRU2",185,0)
 ;Input:
"RTN","BPSSCRU2",186,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU2",187,0)
 ;Output:
"RTN","BPSSCRU2",188,0)
 ;returns:
"RTN","BPSSCRU2",189,0)
 ;on error : "-1"  
"RTN","BPSSCRU2",190,0)
 ;on success : refill# ^ release date ^label print date ^ fill date ^ issue date
"RTN","BPSSCRU2",191,0)
REFILINF(BP59) ;*/
"RTN","BPSSCRU2",192,0)
 N BP1 S BP1=$$RXREF(BP59)
"RTN","BPSSCRU2",193,0)
 N BPRX S BPRX=$P(BP1,U,1) ;ptr to #52
"RTN","BPSSCRU2",194,0)
 N BPREF S BPREF=$P(BP1,U,2) ;ptr in its refill multiple
"RTN","BPSSCRU2",195,0)
 I BPREF,$$IFREFILL(BPRX,BPREF)=0 Q -1  ;if bad data
"RTN","BPSSCRU2",196,0)
 ;original refill
"RTN","BPSSCRU2",197,0)
 I BPREF=0 Q "0"_U_$$RXRELDT(BPRX)_U_$$RXLBLDT(BPRX,1)_U_$$RXFILDT(BPRX)_U_$$RXISSDT(BPRX)
"RTN","BPSSCRU2",198,0)
 ;refill's release date
"RTN","BPSSCRU2",199,0)
 I BPREF>0 Q BPREF_U_$$REFRELDT(BPRX,BPREF)_U_$$REFLBLDT(BPRX,1)_U_$$REFFILDT(BPRX,BPREF)_U_$$REFISSDT(BPRX,BPREF)
"RTN","BPSSCRU2",200,0)
 Q -1
"RTN","BPSSCRU2",201,0)
 ;
"RTN","BPSSCRU2",202,0)
 ;-Prescriptions-----------------------
"RTN","BPSSCRU2",203,0)
 ;RX issue date
"RTN","BPSSCRU2",204,0)
RXISSDT(BPRX) ;
"RTN","BPSSCRU2",205,0)
 Q +$P($G(^PSRX(BPRX,0)),U,13)
"RTN","BPSSCRU2",206,0)
 ;
"RTN","BPSSCRU2",207,0)
 ;RX's release date
"RTN","BPSSCRU2",208,0)
RXRELDT(BPRX) ;
"RTN","BPSSCRU2",209,0)
 Q +$P($G(^PSRX(BPRX,2)),U,13)
"RTN","BPSSCRU2",210,0)
 ;
"RTN","BPSSCRU2",211,0)
 ;RX's fill date
"RTN","BPSSCRU2",212,0)
RXFILDT(BPRX) ;
"RTN","BPSSCRU2",213,0)
 Q +$P($G(^PSRX(BPRX,2)),U,2)
"RTN","BPSSCRU2",214,0)
 ;
"RTN","BPSSCRU2",215,0)
 ;get label date for RX,
"RTN","BPSSCRU2",216,0)
RXLBLDT(BPRX,BPDIR) ;
"RTN","BPSSCRU2",217,0)
 ;BPDIR=0 - the first
"RTN","BPSSCRU2",218,0)
 ;BPDIR=1 - the last
"RTN","BPSSCRU2",219,0)
 N BPRET
"RTN","BPSSCRU2",220,0)
 I BPDIR=0 S BPRET=$O(^PSRX(BPRX,"L",0))
"RTN","BPSSCRU2",221,0)
 I BPDIR=1 S BPRET=$O(^PSRX(BPRX,"L",9999),-1)
"RTN","BPSSCRU2",222,0)
 I BPRET S BPRET=$P($G(^PSRX(BPRX,"L",+BPRET,0)),U)\1
"RTN","BPSSCRU2",223,0)
 Q BPRET
"RTN","BPSSCRU2",224,0)
 ;
"RTN","BPSSCRU2",225,0)
 ;-Refills -----------------------
"RTN","BPSSCRU2",226,0)
 ;get label date for refills
"RTN","BPSSCRU2",227,0)
REFLBLDT(BPRX,BPDIR) ;
"RTN","BPSSCRU2",228,0)
 Q $$RXLBLDT(BPRX,BPDIR)
"RTN","BPSSCRU2",229,0)
 ;
"RTN","BPSSCRU2",230,0)
 ;refill's release date
"RTN","BPSSCRU2",231,0)
REFRELDT(BPRX,BPREF) ;
"RTN","BPSSCRU2",232,0)
 Q +$P($G(^PSRX(BPRX,1,BPREF,0)),U,18)
"RTN","BPSSCRU2",233,0)
 ;
"RTN","BPSSCRU2",234,0)
 ;refill's refill date
"RTN","BPSSCRU2",235,0)
REFFILDT(BPRX,BPREF) ;
"RTN","BPSSCRU2",236,0)
 Q +$P($G(^PSRX(BPRX,1,BPREF,0)),U)
"RTN","BPSSCRU2",237,0)
 ;
"RTN","BPSSCRU2",238,0)
 ;refill's issue date
"RTN","BPSSCRU2",239,0)
REFISSDT(BPRX,BPREF) ;
"RTN","BPSSCRU2",240,0)
 Q $$REFDISDT(BPRX,BPREF)
"RTN","BPSSCRU2",241,0)
 ;
"RTN","BPSSCRU2",242,0)
 ;refill's dispense date
"RTN","BPSSCRU2",243,0)
REFDISDT(BPRX,BPREF) ;
"RTN","BPSSCRU2",244,0)
 Q +$P($G(^PSRX(BPRX,1,BPREF,0)),U,19)
"RTN","BPSSCRU2",245,0)
 ;
"RTN","BPSSCRU2",246,0)
 ;if refill exists
"RTN","BPSSCRU2",247,0)
IFREFILL(BPRX,BPREF) ;
"RTN","BPSSCRU2",248,0)
 Q $D(^PSRX(BPRX,1,BPREF))>0
"RTN","BPSSCRU2",249,0)
 ;/**
"RTN","BPSSCRU2",250,0)
 ;Get shortened drug name concatenated with its IEN in file 50) for sorting
"RTN","BPSSCRU2",251,0)
 ;
"RTN","BPSSCRU2",252,0)
SORTDRUG(BP59) ;
"RTN","BPSSCRU2",253,0)
 ;Get the name of the drug
"RTN","BPSSCRU2",254,0)
 N BPRX S BPRX=+$$RXREF(BP59)
"RTN","BPSSCRU2",255,0)
 N BPDRUG S BPDRUG=+$P($G(^PSRX(BPRX,0)),U,6) ;drug ptr to file #50
"RTN","BPSSCRU2",256,0)
 N BPDRNAME S BPDRNAME=$P($G(^PSDRUG(BPDRUG,0)),U) ; drug name
"RTN","BPSSCRU2",257,0)
 Q $E(BPDRNAME,1,10)_"-"_BPDRUG
"RTN","BPSSCRU2",258,0)
 ;
"RTN","BPSSCRU2",259,0)
 ;/**
"RTN","BPSSCRU2",260,0)
 ;input 
"RTN","BPSSCRU2",261,0)
 ;ptr to 9002313.59
"RTN","BPSSCRU2",262,0)
 ;output :
"RTN","BPSSCRU2",263,0)
 ; BB - back billing
"RTN","BPSSCRU2",264,0)
 ; RT - all other values in (#1201) RX ACTION field on 9002313.59
"RTN","BPSSCRU2",265,0)
RTBB(BP59) ;*/
"RTN","BPSSCRU2",266,0)
 N BPTRBB
"RTN","BPSSCRU2",267,0)
 S BPTRBB=$P($G(^BPST(BP59,12)),U)
"RTN","BPSSCRU2",268,0)
 I BPTRBB="" Q "**"
"RTN","BPSSCRU2",269,0)
 I BPTRBB="BB" Q "BB"
"RTN","BPSSCRU2",270,0)
 Q "RT"
"RTN","BPSSCRU2",271,0)
 ;
"RTN","BPSSCRU2",272,0)
 ;------------ patient's name
"RTN","BPSSCRU2",273,0)
PATNAME(BPDFN) ;
"RTN","BPSSCRU2",274,0)
 Q $E($P($G(^DPT(BPDFN,0)),U),1,15)
"RTN","BPSSCRU2",275,0)
 ;
"RTN","BPSSCRU2",276,0)
SSN4(DFN) ;last 4 SSN
"RTN","BPSSCRU2",277,0)
 N X
"RTN","BPSSCRU2",278,0)
 S X=$P($G(^DPT(DFN,0)),U,9)
"RTN","BPSSCRU2",279,0)
 Q "("_$E(X,$L(X)-3,$L(X))_")"
"RTN","BPSSCRU2",280,0)
 ;
"RTN","BPSSCRU2",281,0)
 ;get drug generic name
"RTN","BPSSCRU2",282,0)
DRGNAM(BP50) ;
"RTN","BPSSCRU2",283,0)
 ;BP50 - ptr to #50
"RTN","BPSSCRU2",284,0)
 Q $E($P($G(^PSDRUG(BP50,0)),U),1,35)
"RTN","BPSSCRU2",285,0)
 ;get drug
"RTN","BPSSCRU2",286,0)
GETDRUG(BP52,BPREFN) ;
"RTN","BPSSCRU2",287,0)
 ;return value:
"RTN","BPSSCRU2",288,0)
 ; 0 - unknown
"RTN","BPSSCRU2",289,0)
 ; n - ptr to DRUG file #50
"RTN","BPSSCRU2",290,0)
 Q +$P($G(^PSRX(BP52,0)),U,6)
"RTN","BPSSCRU2",291,0)
 ;
"RTN","BPSSCRU2",292,0)
GETDRG59(BP59) ;
"RTN","BPSSCRU2",293,0)
 N BPX
"RTN","BPSSCRU2",294,0)
 S BPX=$$RXREF(BP59)
"RTN","BPSSCRU2",295,0)
 Q $$GETDRUG(+BPX,$P(BPX,U,2))
"RTN","BPSSCRU2",296,0)
 ;
"RTN","BPSSCRU2",297,0)
 ;
"RTN","BPSSCRU2",298,0)
 ;review %% for each of claims in the array 
"RTN","BPSSCRU2",299,0)
 ;and calculate "overall" "done" status
"RTN","BPSSCRU2",300,0)
 ;input:
"RTN","BPSSCRU2",301,0)
 ; BPARR59 - array of ptr to #9002313.59
"RTN","BPSSCRU2",302,0)
 ;output:
"RTN","BPSSCRU2",303,0)
 ; status
"RTN","BPSSCRU2",304,0)
FINISHST(BPARR59) ;
"RTN","BPSSCRU2",305,0)
 N BPFIN,BP59
"RTN","BPSSCRU2",306,0)
 S BPFIN=1,BP59=0
"RTN","BPSSCRU2",307,0)
 F  S BP59=$O(BPARR59(BP59)) Q:+BP59=0  D  Q:BPFIN=0
"RTN","BPSSCRU2",308,0)
 . I $$PRCNTG^BPSSCRU3(BP59)<99 S BPFIN=0
"RTN","BPSSCRU2",309,0)
 I BPFIN=1 Q "**FINISHED**"
"RTN","BPSSCRU2",310,0)
 Q ""
"RTN","BPSSCRU2",311,0)
 ;
"RTN","BPSSCRU2",312,0)
 ;/**
"RTN","BPSSCRU2",313,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU2",314,0)
 ;output :
"RTN","BPSSCRU2",315,0)
 ;ECME number 
"RTN","BPSSCRU2",316,0)
 ; 7 digits of the prescription IEN file 52
"RTN","BPSSCRU2",317,0)
 ;or 7 spaces
"RTN","BPSSCRU2",318,0)
ECMENUM(BP59) ;*/
"RTN","BPSSCRU2",319,0)
 N X
"RTN","BPSSCRU2",320,0)
 S X=$P($G(^BPST(BP59,0)),"^")
"RTN","BPSSCRU2",321,0)
 I X="" Q $$FORMAT(X,7," ",1)
"RTN","BPSSCRU2",322,0)
 Q $$FORMAT(X\1,7,"0",1)
"RTN","BPSSCRU2",323,0)
 ;
"RTN","BPSSCRU2",324,0)
 ;BPRX - ptr to #52
"RTN","BPSSCRU2",325,0)
RXNUM(BPRX) ;
"RTN","BPSSCRU2",326,0)
 Q $P($G(^PSRX(BPRX,0)),U)_$S($G(^PSRX(BPRX,"IB")):"$",1:"")
"RTN","BPSSCRU2",327,0)
 ;
"RTN","BPSSCRU2",328,0)
 ;/**
"RTN","BPSSCRU2",329,0)
 ;get NDC
"RTN","BPSSCRU2",330,0)
 ;input 
"RTN","BPSSCRU2",331,0)
 ;BPRX - ptr to #52
"RTN","BPSSCRU2",332,0)
 ;BPREF - refill # (0,1,2,3...)
"RTN","BPSSCRU2",333,0)
NDC(BPRX,BPREF) ;*/
"RTN","BPSSCRU2",334,0)
 Q $$GETNDC^PSONDCUT(BPRX,BPREF)
"RTN","BPSSCRU2",335,0)
 ;
"RTN","BPSSCRU2",336,0)
DRGNAME(BP59) ;drug name BP59 -ptr to .59 file
"RTN","BPSSCRU2",337,0)
 N BPRX,BPREF
"RTN","BPSSCRU2",338,0)
 S BPRX=+$P($G(^BPST(BP59,1)),U,11) ;ptr to RX node in #52
"RTN","BPSSCRU2",339,0)
 S BPREF=+$P($G(^BPST(BP59,1)),U) ;ptr to refill multiple in #52
"RTN","BPSSCRU2",340,0)
 Q $E($$DRGNAM^BPSSCRU2($$GETDRUG^BPSSCRU2(BPRX,BPREF)),1,23)
"RTN","BPSSCRU2",341,0)
 ;
"RTN","BPSSCRU2",342,0)
 ;is the number even?
"RTN","BPSSCRU2",343,0)
 ;1-yes
"RTN","BPSSCRU2",344,0)
 ;0 -no
"RTN","BPSSCRU2",345,0)
ISEVEN(BPNUM) ;
"RTN","BPSSCRU2",346,0)
 Q ((BPNUM/2)-(BPNUM\2))=0
"RTN","BPSSCRU2",347,0)
 ;
"RTN","BPSSCRU2",348,0)
 ;BPSTR - string to format
"RTN","BPSSCRU2",349,0)
 ;BPSMLEN - max lenght
"RTN","BPSSCRU2",350,0)
 ;BPSCHR - char to add
"RTN","BPSSCRU2",351,0)
 ;BPSLFT - 1 - add from the left, 0 - from the right
"RTN","BPSSCRU2",352,0)
FORMAT(BPSTR,BPSMLEN,BPSCHR,BPSLFT) ;
"RTN","BPSSCRU2",353,0)
 N LN S LN=$L(BPSTR)
"RTN","BPSSCRU2",354,0)
 N ZZ S ZZ=""
"RTN","BPSSCRU2",355,0)
 I LN=BPSMLEN Q BPSTR
"RTN","BPSSCRU2",356,0)
 I LN>BPSMLEN Q:BPSLFT $E(BPSTR,LN-BPSMLEN+1,9999) Q $E(BPSTR,1,BPSMLEN)
"RTN","BPSSCRU2",357,0)
 S $P(ZZ,BPSCHR,BPSMLEN-LN+1)=""
"RTN","BPSSCRU2",358,0)
 Q:BPSLFT ZZ_BPSTR
"RTN","BPSSCRU2",359,0)
 Q BPSTR_ZZ
"RTN","BPSSCRU2",360,0)
 ;
"RTN","BPSSCRU3")
0^342^B34228996
"RTN","BPSSCRU3",1,0)
BPSSCRU3 ;BHAM ISC/SS - ECME SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCRU3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRU3",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRU3",4,0)
 ;USER SCREEN
"RTN","BPSSCRU3",5,0)
 Q
"RTN","BPSSCRU3",6,0)
 ;get comment from BPS TRANSACTION file
"RTN","BPSSCRU3",7,0)
 ;BP59 - ien in that file
"RTN","BPSSCRU3",8,0)
COMMENT(BP59) ;
"RTN","BPSSCRU3",9,0)
 N BPCMNT,BPX
"RTN","BPSSCRU3",10,0)
 S BPCMNT=$O(^BPST(BP59,11,999999),-1)
"RTN","BPSSCRU3",11,0)
 I BPCMNT="" Q ""
"RTN","BPSSCRU3",12,0)
 S BPX=$G(^BPST(BP59,11,BPCMNT,0))
"RTN","BPSSCRU3",13,0)
 Q $$DATTIM($P(BPX,U,1)\1)_" - "_$P(BPX,U,3)
"RTN","BPSSCRU3",14,0)
 ;
"RTN","BPSSCRU3",15,0)
DATTIM(X) ;Convert FM date to displayable (mm/dd/yy HH:MM) format.
"RTN","BPSSCRU3",16,0)
 I +X=0 W ""
"RTN","BPSSCRU3",17,0)
 N DATE,YR,BPT,BPM,BPH,BPAP
"RTN","BPSSCRU3",18,0)
 I $G(X) S YR=$E(X,2,3)
"RTN","BPSSCRU3",19,0)
 I $G(X) S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_YR,1:"")
"RTN","BPSSCRU3",20,0)
 S BPT=$P(X,".",2) S:$L(BPT)<4 BPT=BPT_$E("0000",1,4-$L(BPT))
"RTN","BPSSCRU3",21,0)
 S BPH=$E(BPT,1,2),BPM=$E(BPT,3,4)
"RTN","BPSSCRU3",22,0)
 S BPAP="a" I BPH>12 S BPH=BPH-12,BPAP="p" S:$L(BPH)<2 BPH="0"_BPH
"RTN","BPSSCRU3",23,0)
 I BPT S:'BPH BPH=12 S DATE=DATE_" "_BPH_":"_BPM_BPAP
"RTN","BPSSCRU3",24,0)
 Q $G(DATE)
"RTN","BPSSCRU3",25,0)
 ;/**
"RTN","BPSSCRU3",26,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",27,0)
 ;returns the string with none, one or more than one of the following:
"RTN","BPSSCRU3",28,0)
 ; PB - payable
"RTN","BPSSCRU3",29,0)
 ; RJ - rejected
"RTN","BPSSCRU3",30,0)
 ; RA - reversal accepted
"RTN","BPSSCRU3",31,0)
 ; RR
"RTN","BPSSCRU3",32,0)
 ; AR - autoreversal
"RTN","BPSSCRU3",33,0)
 ; SR - stranded
"RTN","BPSSCRU3",34,0)
 ; example: "^RV^AR"
"RTN","BPSSCRU3",35,0)
CLAIMST(BP59,BPDESRC) ;*/
"RTN","BPSSCRU3",36,0)
 N BPX,BPRET,BPSTATUS
"RTN","BPSSCRU3",37,0)
 S BPRET="^"
"RTN","BPSSCRU3",38,0)
 S BPX=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRU3",39,0)
 S BPSTATUS=$$STATUS^BPSOSRX(+BPX,$P(BPX,U,2))
"RTN","BPSSCRU3",40,0)
 Q $P(BPSTATUS,U,1,3)
"RTN","BPSSCRU3",41,0)
 ;Q $P(BPSTATUS,U,1)_U_$P(BPSTATUS,U,2)_U_$P(BPSTATUS,U,3)
"RTN","BPSSCRU3",42,0)
 ;/**
"RTN","BPSSCRU3",43,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",44,0)
 ;returns the string with none, one or more tha one of the following:
"RTN","BPSSCRU3",45,0)
 ; PB - payable
"RTN","BPSSCRU3",46,0)
 ; RJ - rejected
"RTN","BPSSCRU3",47,0)
 ; RV - reversal
"RTN","BPSSCRU3",48,0)
 ; AR - autoreversal
"RTN","BPSSCRU3",49,0)
 ; SR - stranded
"RTN","BPSSCRU3",50,0)
 ; example: "^RV^AR"
"RTN","BPSSCRU3",51,0)
CLAIMST2(BP59) ;*/
"RTN","BPSSCRU3",52,0)
 N BPX,BPRET,BPSTATUS
"RTN","BPSSCRU3",53,0)
 S BPRET="^"
"RTN","BPSSCRU3",54,0)
 S BPX=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRU3",55,0)
 S BPSTATUS=$$STATUS^BPSOSRX(+BPX,$P(BPX,U,2))
"RTN","BPSSCRU3",56,0)
 I BPSTATUS["E REVERSAL" S BPRET=BPRET_"RV^"
"RTN","BPSSCRU3",57,0)
 I BPSTATUS["E PAYABLE" S BPRET=BPRET_"PB^"
"RTN","BPSSCRU3",58,0)
 I BPSTATUS["E REJECTED" S BPRET=BPRET_"RJ^"
"RTN","BPSSCRU3",59,0)
 I BPSTATUS["E STRANDED" S BPRET=BPRET_"SR^"
"RTN","BPSSCRU3",60,0)
 I BPSTATUS["E REVERSAL STRANDED" S BPRET=BPRET_"SR^"
"RTN","BPSSCRU3",61,0)
 Q BPRET
"RTN","BPSSCRU3",62,0)
 ;/**
"RTN","BPSSCRU3",63,0)
 ;pointers for RESPONSE file (#9002313.03) by pointer in TRANSACTION file #9002313.59
"RTN","BPSSCRU3",64,0)
 ;B59 - ptr to #9002313.59
"RTN","BPSSCRU3",65,0)
 ;BPRESP - ptr to #9002313.03
"RTN","BPSSCRU3",66,0)
 ;BPPOS - position inside #9002313.03 (i.e. the number 
"RTN","BPSSCRU3",67,0)
 ;of the claim in the transmission - currently we always have only 1
"RTN","BPSSCRU3",68,0)
GRESPPOS(BP59,BPRESP,BPPOS) ;*/
"RTN","BPSSCRU3",69,0)
 I $G(^BPST(BP59,4)) D  ; reversal kind of message
"RTN","BPSSCRU3",70,0)
 . S BPRESP=+$P(^BPST(BP59,4),U,2)
"RTN","BPSSCRU3",71,0)
 . S BPPOS=1
"RTN","BPSSCRU3",72,0)
 E  D
"RTN","BPSSCRU3",73,0)
 . S BPRESP=+$P($G(^BPST(BP59,0)),U,5)
"RTN","BPSSCRU3",74,0)
 . S BPPOS=+$P($G(^BPST(BP59,0)),U,9)
"RTN","BPSSCRU3",75,0)
 Q:+BPRESP=0 0
"RTN","BPSSCRU3",76,0)
 Q:+BPPOS=0 0
"RTN","BPSSCRU3",77,0)
 Q 1
"RTN","BPSSCRU3",78,0)
 ;
"RTN","BPSSCRU3",79,0)
 ;/**
"RTN","BPSSCRU3",80,0)
 ;reject message from RESPONSE file
"RTN","BPSSCRU3",81,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",82,0)
 ;BPTOP - top level index (for exmpl "504" for ^BPSR(D0,504)= (#504) Message [1F]
"RTN","BPSSCRU3",83,0)
 ;BPDEEP - lower level (for exmpl BPTOP=1000 and BPDEEP=525 for  
"RTN","BPSSCRU3",84,0)
 ;  ^BPSR(D0,1000,D1,525)= (#525) DUR Response Data [1F]
"RTN","BPSSCRU3",85,0)
 ;
"RTN","BPSSCRU3",86,0)
GETMESS(BPTOP,BPDEEP,BP59) ;
"RTN","BPSSCRU3",87,0)
 N BP59DAT,BPRESP,BPPOS
"RTN","BPSSCRU3",88,0)
 N BP1
"RTN","BPSSCRU3",89,0)
 ;S (BPRESP,BPPOS)=0
"RTN","BPSSCRU3",90,0)
 ;get response and position in the BPS RESPONSE file
"RTN","BPSSCRU3",91,0)
 I $$GRESPPOS(BP59,.BPRESP,.BPPOS)=0 Q ""
"RTN","BPSSCRU3",92,0)
 ; -------- transmission specific message ----------
"RTN","BPSSCRU3",93,0)
 I BPTOP=504 Q $P($G(^BPSR(BPRESP,504)),U)
"RTN","BPSSCRU3",94,0)
 ;
"RTN","BPSSCRU3",95,0)
 ; -------claim specific message-----------
"RTN","BPSSCRU3",96,0)
 ;assuming there is only one claim/response per transmission
"RTN","BPSSCRU3",97,0)
 S BP1=$O(^BPSR(BPRESP,BPTOP,0))
"RTN","BPSSCRU3",98,0)
 I BP1=0 Q ""
"RTN","BPSSCRU3",99,0)
 ;---525: DUR
"RTN","BPSSCRU3",100,0)
 ;---526: Additional Message Information
"RTN","BPSSCRU3",101,0)
 ;---504: Message for the claim
"RTN","BPSSCRU3",102,0)
 I (BPDEEP=525)!(BPDEEP=526)!(BPDEEP=504) Q $P($G(^BPSR(BPRESP,1000,BPPOS,BPDEEP)),U)
"RTN","BPSSCRU3",103,0)
 Q ""
"RTN","BPSSCRU3",104,0)
 ;
"RTN","BPSSCRU3",105,0)
 ;reject message from RESPONSE file
"RTN","BPSSCRU3",106,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",107,0)
 ;BPARR1 - array to return messages (by ref)
"RTN","BPSSCRU3",108,0)
 ;BPN1 - index for the array (by ref - will 
"RTN","BPSSCRU3",109,0)
 ;  be incremented if more than one node added)
"RTN","BPSSCRU3",110,0)
 ;BPMLEN - max length for each string
"RTN","BPSSCRU3",111,0)
 ;PBPREF - for prefix string
"RTN","BPSSCRU3",112,0)
 ;. D GETMESS^BPSSCRU3(1000,504,BP59,.BPARR,.BPN,50)
"RTN","BPSSCRU3",113,0)
 ;compare GETRJCOD from BPSSCRu2
"RTN","BPSSCRU3",114,0)
GETRJCOD(BP59,BPARR1,BPN1,BPMLEN,PBPREF) ;
"RTN","BPSSCRU3",115,0)
 N BP59DAT S BP59DAT=$G(^BPST(BP59,0))
"RTN","BPSSCRU3",116,0)
 N BPRESP,BPPOS
"RTN","BPSSCRU3",117,0)
 N BPRJCOD
"RTN","BPSSCRU3",118,0)
 N BPRJTXT
"RTN","BPSSCRU3",119,0)
 N BPSTR
"RTN","BPSSCRU3",120,0)
 N BPRJ
"RTN","BPSSCRU3",121,0)
 ;pointers for RESPONSE file (#9002313.03) by pointer in TRANSACTION file #9002313.59
"RTN","BPSSCRU3",122,0)
 ;get response and position 
"RTN","BPSSCRU3",123,0)
 I $$GRESPPOS(BP59,.BPRESP,.BPPOS)=0 Q
"RTN","BPSSCRU3",124,0)
 S BPRJ=0
"RTN","BPSSCRU3",125,0)
 S BPSTR=""
"RTN","BPSSCRU3",126,0)
 F  S BPRJ=$O(^BPSR(BPRESP,1000,BPPOS,511,BPRJ)) Q:+BPRJ=0  D
"RTN","BPSSCRU3",127,0)
 . S BPRJCOD=$P($G(^BPSR(BPRESP,1000,BPPOS,511,BPRJ,0)),U)
"RTN","BPSSCRU3",128,0)
 . Q:$L(BPRJCOD)=0
"RTN","BPSSCRU3",129,0)
 . S BPRJTXT=$$GETRJNAM(BPRJCOD)
"RTN","BPSSCRU3",130,0)
 . S BPN1=BPN1+1,BPARR1(BPN1)=PBPREF_BPRJTXT
"RTN","BPSSCRU3",131,0)
 Q BPN1
"RTN","BPSSCRU3",132,0)
 ;/**
"RTN","BPSSCRU3",133,0)
 ;Input:
"RTN","BPSSCRU3",134,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU3",135,0)
 ;Output:
"RTN","BPSSCRU3",136,0)
 ; BPRCODES - array for reject codes by reference
"RTN","BPSSCRU3",137,0)
REJCODES(BP59,BPRCODES) ;get reject codes
"RTN","BPSSCRU3",138,0)
 N BPRESP,BPPOS,BPA,BPR
"RTN","BPSSCRU3",139,0)
 ;pointers for RESPONSE file (#9002313.03) by pointer in TRANSACTION file #9002313.59
"RTN","BPSSCRU3",140,0)
 ;get response and position
"RTN","BPSSCRU3",141,0)
 I $$GRESPPOS(BP59,.BPRESP,.BPPOS)=0 Q
"RTN","BPSSCRU3",142,0)
 ;
"RTN","BPSSCRU3",143,0)
 S BPA=0
"RTN","BPSSCRU3",144,0)
 F  S BPA=$O(^BPSR(BPRESP,1000,BPPOS,511,BPA)) Q:'BPA  D
"RTN","BPSSCRU3",145,0)
 . S BPR=$P(^BPSR(BPRESP,1000,BPPOS,511,BPA,0),U)
"RTN","BPSSCRU3",146,0)
 . I BPR'="" S BPRCODES(BPR)=""
"RTN","BPSSCRU3",147,0)
 Q
"RTN","BPSSCRU3",148,0)
 ;/**
"RTN","BPSSCRU3",149,0)
 ;BPRJCODE - code
"RTN","BPSSCRU3",150,0)
GETRJNAM(BPRJCODE) ;*/
"RTN","BPSSCRU3",151,0)
 N BPRJIEN
"RTN","BPSSCRU3",152,0)
 S BPRJIEN=$O(^BPSF(9002313.93,"B",BPRJCODE,0))
"RTN","BPSSCRU3",153,0)
 Q:+BPRJIEN=0 ""
"RTN","BPSSCRU3",154,0)
 Q BPRJCODE_":"_$P($G(^BPSF(9002313.93,BPRJIEN,0)),U,2)
"RTN","BPSSCRU3",155,0)
 ;/**
"RTN","BPSSCRU3",156,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",157,0)
 ;was the claim ever autoreversed ?
"RTN","BPSSCRU3",158,0)
AUTOREV(BP59) ;*/
"RTN","BPSSCRU3",159,0)
 N BP02
"RTN","BPSSCRU3",160,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSSCRU3",161,0)
 Q +$P($G(^BPSC(BP02,0)),U,7)
"RTN","BPSSCRU3",162,0)
 ;
"RTN","BPSSCRU3",163,0)
 ;/**
"RTN","BPSSCRU3",164,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",165,0)
 ;returns :
"RTN","BPSSCRU3",166,0)
 ;0 Waiting to start
"RTN","BPSSCRU3",167,0)
 ;10 Gathering claim info
"RTN","BPSSCRU3",168,0)
 ;19 Special Grouping
"RTN","BPSSCRU3",169,0)
 ;30 Waiting for packet build
"RTN","BPSSCRU3",170,0)
 ;31 Wait for retry (insurer asleep)
"RTN","BPSSCRU3",171,0)
 ;40 Packet being built
"RTN","BPSSCRU3",172,0)
 ;50 Waiting for transmit
"RTN","BPSSCRU3",173,0)
 ;51 Wait for retry (comms error)
"RTN","BPSSCRU3",174,0)
 ;60 Transmitting
"RTN","BPSSCRU3",175,0)
 ;70 Receiving Response
"RTN","BPSSCRU3",176,0)
 ;80 Waiting to process response
"RTN","BPSSCRU3",177,0)
 ;90 Processing response
"RTN","BPSSCRU3",178,0)
 ;99 Done
"RTN","BPSSCRU3",179,0)
 ;
"RTN","BPSSCRU3",180,0)
PRCNTG(BP59) ;*/
"RTN","BPSSCRU3",181,0)
 Q +$P($G(^BPST(BP59,0)),U,2)
"RTN","BPSSCRU3",182,0)
 ;
"RTN","BPSSCRU3",183,0)
 ;
"RTN","BPSSCRU3",184,0)
LINE(BPN,BPCH) ;
"RTN","BPSSCRU3",185,0)
 N BP1
"RTN","BPSSCRU3",186,0)
 S $P(BP1,BPCH,BPN+1)=""
"RTN","BPSSCRU3",187,0)
 Q BP1
"RTN","BPSSCRU3",188,0)
 ;
"RTN","BPSSCRU3",189,0)
DTTIME(X) ;Convert FM date to displayable (mm/dd/yy HH:MM) format.
"RTN","BPSSCRU3",190,0)
 I +X=0 W ""
"RTN","BPSSCRU3",191,0)
 N DATE,YR,BPT,BPM,BPH,BPAP,BPS
"RTN","BPSSCRU3",192,0)
 I $G(X) S YR=$E(X,1,3)+1700
"RTN","BPSSCRU3",193,0)
 I $G(X) S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_YR,1:"")
"RTN","BPSSCRU3",194,0)
 S BPT=$P(X,".",2)
"RTN","BPSSCRU3",195,0)
 I BPT S:$L(BPT)<6 BPT=BPT_$E("000000",1,6-$L(BPT))
"RTN","BPSSCRU3",196,0)
 S BPH=$E(BPT,1,2),BPM=$E(BPT,3,4),BPS=$E(BPT,5,6)
"RTN","BPSSCRU3",197,0)
 I BPT S DATE=DATE_"@"_BPH_":"_BPM_":"_BPS
"RTN","BPSSCRU3",198,0)
 Q $G(DATE)
"RTN","BPSSCRU3",199,0)
 ;
"RTN","BPSSCRU3",200,0)
 ;call IB API to get insurance data, then select proper insurance by its name
"RTN","BPSSCRU3",201,0)
 ;get its phone number
"RTN","BPSSCRU3",202,0)
 ;input: 
"RTN","BPSSCRU3",203,0)
 ; DFN - patient IEN in #2
"RTN","BPSSCRU3",204,0)
 ; BPDOS - date of service
"RTN","BPSSCRU3",205,0)
 ; BPINSNM - insurance name
"RTN","BPSSCRU3",206,0)
 ;output: insurance ien^insurance name^phone
"RTN","BPSSCRU3",207,0)
GETPHONE(BPDFN,BPDOS,BPINSNM) ;
"RTN","BPSSCRU3",208,0)
 N BPX,BPZZ,BP1,BPPHONE
"RTN","BPSSCRU3",209,0)
 S BPPHONE=""
"RTN","BPSSCRU3",210,0)
 I $$INSUR^IBBAPI(BPDFN,BPDOS,,.BPZZ,"1,6")'=1 Q ""
"RTN","BPSSCRU3",211,0)
 S BP1="" F  S BP1=$O(BPZZ("IBBAPI","INSUR",BP1)) Q:+BP1=0  D
"RTN","BPSSCRU3",212,0)
 . I BPINSNM=$P($G(BPZZ("IBBAPI","INSUR",BP1,1)),U,2) S BPPHONE=$G(BPZZ("IBBAPI","INSUR",BP1,6)) Q
"RTN","BPSSCRU3",213,0)
 Q BPPHONE
"RTN","BPSSCRU3",214,0)
 ;
"RTN","BPSSCRU3",215,0)
 ;try to get insurance name and phone from #9002313.59, #9002313.57 and from INSUR^IBBAPI 
"RTN","BPSSCRU3",216,0)
 ;input: BP59 - ien in #9002313.59
"RTN","BPSSCRU3",217,0)
 ;return insurance_name^phone#
"RTN","BPSSCRU3",218,0)
NAMEPHON(BP59) ;
"RTN","BPSSCRU3",219,0)
 N BPHONE,BPINSNM,BPINSID,BP57,BPINSN
"RTN","BPSSCRU3",220,0)
 S BPHONE=$P($G(^BPST(BP59,10,+$G(^BPST(BP59,9)),3)),U,2)
"RTN","BPSSCRU3",221,0)
 S BPINSNM=$P($G(^BPST(BP59,10,+$G(^BPST(BP59,9)),0)),U,7)
"RTN","BPSSCRU3",222,0)
 S BP57=0
"RTN","BPSSCRU3",223,0)
 F  Q:(BPHONE'="")&(BPINSNM'="")  S BP57=$O(^BPSTL("B",BP59,BP57)) Q:+BP57=0  D
"RTN","BPSSCRU3",224,0)
 . S BPINSN=+$G(^BPSTL(BP57,9))
"RTN","BPSSCRU3",225,0)
 . S:BPHONE="" BPHONE=$P($G(^BPSTL(BP57,10,BPINSN,3)),U,2)
"RTN","BPSSCRU3",226,0)
 . S:BPINSNM="" BPINSNM=$P($G(^BPSTL(BP57,10,BPINSN,0)),U,7)
"RTN","BPSSCRU3",227,0)
 ;
"RTN","BPSSCRU3",228,0)
 I (BPINSNM'="")&(BPHONE="") D
"RTN","BPSSCRU3",229,0)
 . S BPDOS=+$P($G(^BPST(BP59,12)),U,2)\1
"RTN","BPSSCRU3",230,0)
 . I BPDOS=0 S BPDOS=+$P($G(^BPST(BP59,0)),U,8)\1
"RTN","BPSSCRU3",231,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRU3",232,0)
 . S BPHONE=$$GETPHONE(BPDFN,BPDOS,BPINSNM)
"RTN","BPSSCRU3",233,0)
 Q BPINSNM_U_BPHONE
"RTN","BPSSCRU3",234,0)
 ;
"RTN","BPSSCRU4")
0^343^B58150912
"RTN","BPSSCRU4",1,0)
BPSSCRU4 ;BHAM ISC/SS - ECME SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCRU4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRU4",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRU4",4,0)
 ;USER SCREEN
"RTN","BPSSCRU4",5,0)
 Q
"RTN","BPSSCRU4",6,0)
 ;
"RTN","BPSSCRU4",7,0)
 ;repeatedly prompts the user for line#
"RTN","BPSSCRU4",8,0)
 ;the user should "^" to quit or enter a correct line #
"RTN","BPSSCRU4",9,0)
 ;input:
"RTN","BPSSCRU4",10,0)
 ;  BPROMPT - prompt string
"RTN","BPSSCRU4",11,0)
 ;  BPTYPE expected user's selection on level 
"RTN","BPSSCRU4",12,0)
 ;  of P-patient or C-claim or PC - both
"RTN","BPSSCRU4",13,0)
 ;  BPERRMES - optional - the message to display when the user
"RTN","BPSSCRU4",14,0)
 ;    tries to make multi line selection
"RTN","BPSSCRU4",15,0)
 ;  BPDFLT - default value for the prompt (optional)
"RTN","BPSSCRU4",16,0)
 ;output:
"RTN","BPSSCRU4",17,0)
 ;  piece 1: 
"RTN","BPSSCRU4",18,0)
 ;   1 - okay
"RTN","BPSSCRU4",19,0)
 ;   <0 - errors
"RTN","BPSSCRU4",20,0)
 ;   0 - user wants to quit
"RTN","BPSSCRU4",21,0)
 ;  piece 2: patient ien #2
"RTN","BPSSCRU4",22,0)
 ;  piece 3: insurance ien #36
"RTN","BPSSCRU4",23,0)
 ;  piece 4: ptr to #9002313.59
"RTN","BPSSCRU4",24,0)
 ;  piece 5: 1st line for index(es) in LM "VALM" array
"RTN","BPSSCRU4",25,0)
 ;  piece 6: patient's index
"RTN","BPSSCRU4",26,0)
 ;  piece 7: claim's index
"RTN","BPSSCRU4",27,0)
ASKLINE(BPROMPT,BPTYPE,BPERRMES,BPDFLT) ;
"RTN","BPSSCRU4",28,0)
 N BPRET,BPCNT
"RTN","BPSSCRU4",29,0)
 S BPRET="",BPCNT=0
"RTN","BPSSCRU4",30,0)
 F  S BPRET=$$SELLINE(BPROMPT,BPTYPE,VALMAR,$G(BPDFLT)) Q:BPRET'<0  D
"RTN","BPSSCRU4",31,0)
 . ;D RE^VALM4
"RTN","BPSSCRU4",32,0)
 . ;
"RTN","BPSSCRU4",33,0)
 . I BPCNT<1 S BPCNT=BPCNT+1 W !
"RTN","BPSSCRU4",34,0)
 . E  S BPCNT=0 D RE^VALM4
"RTN","BPSSCRU4",35,0)
 . I BPRET=-1 W " - Invalid line number" ; (invalid Patient summary line)"
"RTN","BPSSCRU4",36,0)
 . I BPRET=-8 W " - ",$S($G(BPERRMES):BPERRMES,1:" Invalid line number")
"RTN","BPSSCRU4",37,0)
 . I BPRET=-4 W " - Invalid line number" ; (invalid RX line)"
"RTN","BPSSCRU4",38,0)
 . I BPRET=-2 W " - Please select Patient's summary line."
"RTN","BPSSCRU4",39,0)
 . I BPRET=-3 W " - Please specify RX line."
"RTN","BPSSCRU4",40,0)
 . I BPRET<-4 W " - Incorrect format." ; Corrupted array (",BPRET,")"
"RTN","BPSSCRU4",41,0)
 Q BPRET
"RTN","BPSSCRU4",42,0)
 ;/**
"RTN","BPSSCRU4",43,0)
 ;prompts the user for line# for various menu option of the User Screen
"RTN","BPSSCRU4",44,0)
 ;input:
"RTN","BPSSCRU4",45,0)
 ;  BPROMPT - prompt string
"RTN","BPSSCRU4",46,0)
 ;  BPTYPE - expected user's selection on level 
"RTN","BPSSCRU4",47,0)
 ;  of P-patient or C-claim or PC - both
"RTN","BPSSCRU4",48,0)
 ;  BPTMP1 - temporary global (VALMAR)
"RTN","BPSSCRU4",49,0)
 ;  BPDFLT - default value for the prompt (optional)
"RTN","BPSSCRU4",50,0)
 ;output:
"RTN","BPSSCRU4",51,0)
 ;  piece 1: 
"RTN","BPSSCRU4",52,0)
 ;   1 - okay
"RTN","BPSSCRU4",53,0)
 ;   <0 - errors
"RTN","BPSSCRU4",54,0)
 ;   0 - user wants to quit
"RTN","BPSSCRU4",55,0)
 ;  piece 2: patient ien #2
"RTN","BPSSCRU4",56,0)
 ;  piece 3: insurance ien #36
"RTN","BPSSCRU4",57,0)
 ;  piece 4: ptr to #9002313.59
"RTN","BPSSCRU4",58,0)
 ;  piece 5: 1st line for index(es) in LM "VALM" array
"RTN","BPSSCRU4",59,0)
 ;  piece 6: patient's index
"RTN","BPSSCRU4",60,0)
 ;  piece 7: claim's index
"RTN","BPSSCRU4",61,0)
SELLINE(BPROMPT,BPTYPE,BPTMP1,BPDFLT) ;*/
"RTN","BPSSCRU4",62,0)
 N BPX,BPLINE,BPPATIND,BPCLMIND
"RTN","BPSSCRU4",63,0)
 N BPDFN,BPSINSUR,BP59,BP1LN
"RTN","BPSSCRU4",64,0)
 S BPLINE=$$PROMPT(BPROMPT,$G(BPDFLT))
"RTN","BPSSCRU4",65,0)
 I BPLINE="^" Q 0
"RTN","BPSSCRU4",66,0)
 S BPPATIND=+$P(BPLINE,".")
"RTN","BPSSCRU4",67,0)
 I (BPLINE["-")!(BPLINE[",") Q -8  ;multiple line input in not allowed
"RTN","BPSSCRU4",68,0)
 I '$D(@BPTMP1@("LMIND",BPPATIND)) Q -1  ;the patient level doesn't exist
"RTN","BPSSCRU4",69,0)
 S BPCLMIND=+$P(BPLINE,".",2)
"RTN","BPSSCRU4",70,0)
 I BPTYPE="P",BPCLMIND>0 Q -2  ;P was requested but claim portion was provided
"RTN","BPSSCRU4",71,0)
 I BPTYPE="C",BPCLMIND=0 Q -3  ;C was requested but claim portion was not provided
"RTN","BPSSCRU4",72,0)
 I '$D(@BPTMP1@("LMIND",BPPATIND,BPCLMIND)) Q -4  ;the claim level doesn't exist
"RTN","BPSSCRU4",73,0)
 S BPDFN=$O(@BPTMP1@("LMIND",BPPATIND,BPCLMIND,0))
"RTN","BPSSCRU4",74,0)
 I +BPDFN=0 Q -5  ;error
"RTN","BPSSCRU4",75,0)
 S BPSINSUR=$O(@BPTMP1@("LMIND",BPPATIND,BPCLMIND,BPDFN,""))
"RTN","BPSSCRU4",76,0)
 I BPSINSUR="" Q -6  ;error
"RTN","BPSSCRU4",77,0)
 ;if fractional part was entered
"RTN","BPSSCRU4",78,0)
 I BPCLMIND>0 D  I +BP59=0 Q -7  ;error
"RTN","BPSSCRU4",79,0)
 . S BP59=$O(@BPTMP1@("LMIND",BPPATIND,BPCLMIND,BPDFN,BPSINSUR,0))
"RTN","BPSSCRU4",80,0)
 I BPCLMIND=0 S BP59=0
"RTN","BPSSCRU4",81,0)
 S BP1LN=$O(@BPTMP1@("LMIND",BPPATIND,BPCLMIND,BPDFN,BPSINSUR,BP59,0))
"RTN","BPSSCRU4",82,0)
 I +BP1LN=0 Q -7  ;error
"RTN","BPSSCRU4",83,0)
 Q "1"_U_BPDFN_U_BPSINSUR_U_BP59_U_BP1LN_U_BPPATIND_U_BPCLMIND
"RTN","BPSSCRU4",84,0)
 ;
"RTN","BPSSCRU4",85,0)
 ;input:
"RTN","BPSSCRU4",86,0)
 ;BPSPROM - prompt text
"RTN","BPSSCRU4",87,0)
 ;BPSDFVL - default value (optional)
"RTN","BPSSCRU4",88,0)
 ;returns:
"RTN","BPSSCRU4",89,0)
 ; "response^"
"RTN","BPSSCRU4",90,0)
PROMPT(BPSPROM,BPSDFVL) ;
"RTN","BPSSCRU4",91,0)
 N BPRET,DIR,X,Y,DIRUT
"RTN","BPSSCRU4",92,0)
 S BPRET="^"
"RTN","BPSSCRU4",93,0)
 S DIR(0)="F^::2",DIR("A")=BPSPROM
"RTN","BPSSCRU4",94,0)
 I $L($G(BPSDFVL))>0 S DIR("B")=$G(BPSDFVL)
"RTN","BPSSCRU4",95,0)
 D ^DIR I $D(DIRUT) Q "^"
"RTN","BPSSCRU4",96,0)
 S $P(BPRET,U)=Y
"RTN","BPSSCRU4",97,0)
 Q BPRET
"RTN","BPSSCRU4",98,0)
 ;
"RTN","BPSSCRU4",99,0)
 ;/**
"RTN","BPSSCRU4",100,0)
 ;check and process user input
"RTN","BPSSCRU4",101,0)
 ;input:
"RTN","BPSSCRU4",102,0)
 ;  BPLINE - input string
"RTN","BPSSCRU4",103,0)
 ;  BPTYPE - expected user's selection on level 
"RTN","BPSSCRU4",104,0)
 ;  of P-patient or C-claim or PC - both
"RTN","BPSSCRU4",105,0)
 ;  BPTMP1 - temporary global (VALMAR)
"RTN","BPSSCRU4",106,0)
 ;output:
"RTN","BPSSCRU4",107,0)
 ;  piece 1: 
"RTN","BPSSCRU4",108,0)
 ;   1 - okay
"RTN","BPSSCRU4",109,0)
 ;   <0 - errors
"RTN","BPSSCRU4",110,0)
 ;   0 - user wants to quit
"RTN","BPSSCRU4",111,0)
 ;  piece 2: patient ien #2
"RTN","BPSSCRU4",112,0)
 ;  piece 3: insurance ien #36
"RTN","BPSSCRU4",113,0)
 ;  piece 4: ptr to #9002313.59
"RTN","BPSSCRU4",114,0)
 ;  piece 5: 1st line for index(es) in LM "VALM" array
"RTN","BPSSCRU4",115,0)
 ;  piece 6: patient's index
"RTN","BPSSCRU4",116,0)
 ;  piece 7: claim's index
"RTN","BPSSCRU4",117,0)
CHECKLN(BPLINE,BPTYPE,BPTMP1) ;*/
"RTN","BPSSCRU4",118,0)
 N BPX,BPPATIND,BPCLMIND
"RTN","BPSSCRU4",119,0)
 N BPDFN,BPSINSUR,BP59,BP1LN
"RTN","BPSSCRU4",120,0)
 I BPLINE="^" Q 0
"RTN","BPSSCRU4",121,0)
 S BPPATIND=+$P(BPLINE,".")
"RTN","BPSSCRU4",122,0)
 I '$D(@BPTMP1@("LMIND",BPPATIND)) Q -1  ;the patient level doesn't exist
"RTN","BPSSCRU4",123,0)
 S BPCLMIND=+$P(BPLINE,".",2)
"RTN","BPSSCRU4",124,0)
 I BPTYPE="P",BPCLMIND>0 Q -2  ;P was requested but claim portion was provided
"RTN","BPSSCRU4",125,0)
 I BPTYPE="C",BPCLMIND=0 Q -3  ;C was requested but claim portion was not provided
"RTN","BPSSCRU4",126,0)
 I '$D(@BPTMP1@("LMIND",BPPATIND,BPCLMIND)) Q -4  ;the claim level doesn't exist
"RTN","BPSSCRU4",127,0)
 S BPDFN=$O(@BPTMP1@("LMIND",BPPATIND,BPCLMIND,0))
"RTN","BPSSCRU4",128,0)
 I +BPDFN=0 Q -5  ;error
"RTN","BPSSCRU4",129,0)
 S BPSINSUR=$O(@BPTMP1@("LMIND",BPPATIND,BPCLMIND,BPDFN,""))
"RTN","BPSSCRU4",130,0)
 I BPSINSUR="" Q -6  ;error
"RTN","BPSSCRU4",131,0)
 ;if fractional part was entered
"RTN","BPSSCRU4",132,0)
 I BPCLMIND>0 D  I +BP59=0 Q -7  ;error
"RTN","BPSSCRU4",133,0)
 . S BP59=$O(@BPTMP1@("LMIND",BPPATIND,BPCLMIND,BPDFN,BPSINSUR,0))
"RTN","BPSSCRU4",134,0)
 I BPCLMIND=0 S BP59=0
"RTN","BPSSCRU4",135,0)
 S BP1LN=$O(@BPTMP1@("LMIND",BPPATIND,BPCLMIND,BPDFN,BPSINSUR,BP59,0))
"RTN","BPSSCRU4",136,0)
 I +BP1LN=0 Q -7  ;error
"RTN","BPSSCRU4",137,0)
 Q "1"_U_BPDFN_U_BPSINSUR_U_BP59_U_BP1LN_U_BPPATIND_U_BPCLMIND
"RTN","BPSSCRU4",138,0)
 ;
"RTN","BPSSCRU4",139,0)
 ;
"RTN","BPSSCRU4",140,0)
 ;BPTMP = VALMAR
"RTN","BPSSCRU4",141,0)
 ;input:
"RTN","BPSSCRU4",142,0)
 ; BPROMPT - prompt text
"RTN","BPSSCRU4",143,0)
 ; BPTYPE - expected user's selection on level 
"RTN","BPSSCRU4",144,0)
 ;  of P-patient or C-claim or PC - both
"RTN","BPSSCRU4",145,0)
 ; BPTMP - temporary global (like VALMAR)
"RTN","BPSSCRU4",146,0)
 ; BPARRLN2 - to return results
"RTN","BPSSCRU4",147,0)
 ;output :
"RTN","BPSSCRU4",148,0)
 ;  1 if okay
"RTN","BPSSCRU4",149,0)
 ;  -1 -invalid format
"RTN","BPSSCRU4",150,0)
 ;  ^ - quit
"RTN","BPSSCRU4",151,0)
 ;  BPARRLN2 - Array(B59)="line# in VALM"^"PatientIndex.ClaimIndex"
"RTN","BPSSCRU4",152,0)
 ;example:
"RTN","BPSSCRU4",153,0)
 ;  BPARR(30045.00001)=134^2.34
"RTN","BPSSCRU4",154,0)
ASKLINES(BPROMPT,BPTYPE,BPARRLN2,BPTMP) ;
"RTN","BPSSCRU4",155,0)
 N BPQ,BPXLN,BPN,BPLN,BPZ
"RTN","BPSSCRU4",156,0)
 N BPL,BPCLM
"RTN","BPSSCRU4",157,0)
 N BPARRLN1,BPX1
"RTN","BPSSCRU4",158,0)
 S BPSPROM="Select item(s)"
"RTN","BPSSCRU4",159,0)
 S BPLN=$$PROMPT(BPSPROM,"")
"RTN","BPSSCRU4",160,0)
 I BPLN="^" Q "^"
"RTN","BPSSCRU4",161,0)
 S BPLN=$P(BPLN,U)
"RTN","BPSSCRU4",162,0)
 S BPQ=0
"RTN","BPSSCRU4",163,0)
 F BPN=1:1 S BPX1=$P(BPLN,",",BPN) Q:$L(BPX1)=0  D  Q:BPQ'=0
"RTN","BPSSCRU4",164,0)
 . S BPZ=$$MKINDEXS(BPX1,BPTMP,.BPARRLN1)
"RTN","BPSSCRU4",165,0)
 . I BPZ<1 S BPQ=-1
"RTN","BPSSCRU4",166,0)
 . I (BPZ=-1)!(BPZ=-2) W !,"Invalid format.",!
"RTN","BPSSCRU4",167,0)
 . I (BPZ=-3) W !,"Not a valid selection.",!
"RTN","BPSSCRU4",168,0)
 Q:BPQ=-1 -1
"RTN","BPSSCRU4",169,0)
 ;
"RTN","BPSSCRU4",170,0)
 N BPPAT,BPCLM
"RTN","BPSSCRU4",171,0)
 S BPPAT=0 F  S BPPAT=$O(BPARRLN1(BPPAT)) Q:BPPAT=""  D
"RTN","BPSSCRU4",172,0)
 . S BPCLM=0 F  S BPCLM=$O(BPARRLN1(BPPAT,BPCLM)) Q:BPCLM=""  D
"RTN","BPSSCRU4",173,0)
 . . S BP1=$G(BPARRLN1(BPPAT,BPCLM))
"RTN","BPSSCRU4",174,0)
 . . Q:$L(BP1)=0
"RTN","BPSSCRU4",175,0)
 . . S BPARRLN2(+$P(BP1,U,4))=+$P(BP1,U,5)_U_BPPAT_"."_BPCLM
"RTN","BPSSCRU4",176,0)
 Q 1
"RTN","BPSSCRU4",177,0)
 ;
"RTN","BPSSCRU4",178,0)
 ;/**
"RTN","BPSSCRU4",179,0)
 ;checks for dashes and if so then create a number of indexes for the range
"RTN","BPSSCRU4",180,0)
 ;i.e. convert all "1.2-2.3" to "1.2,1.3,1.4,2.1,2.2,2.3"
"RTN","BPSSCRU4",181,0)
 ;AND create entries in BPARR for all "right" indexes
"RTN","BPSSCRU4",182,0)
 ;input:
"RTN","BPSSCRU4",183,0)
 ;BPVAL - value to check (exmpl: "1.2-2.4")
"RTN","BPSSCRU4",184,0)
 ;BPTMP1 - global ref with data (exmpl: VALMAR)
"RTN","BPSSCRU4",185,0)
 ;BPARR - array with parsed line indexes 
"RTN","BPSSCRU4",186,0)
 ;output:
"RTN","BPSSCRU4",187,0)
 ;Exmpl:
"RTN","BPSSCRU4",188,0)
 ; BPARR(1.2)=""
"RTN","BPSSCRU4",189,0)
 ; BPARR(1.3)=""
"RTN","BPSSCRU4",190,0)
 ; ...
"RTN","BPSSCRU4",191,0)
 ; returns:
"RTN","BPSSCRU4",192,0)
 ; 1 - okay
"RTN","BPSSCRU4",193,0)
 ; <0 invalid format 
"RTN","BPSSCRU4",194,0)
MKINDEXS(BPVAL,BPTMP1,BPARR) ;
"RTN","BPSSCRU4",195,0)
 N BPFR,BPTO,BPQ,BPRET
"RTN","BPSSCRU4",196,0)
 N BPPAT,BPCLM,BPCLSTRT,BPCLEND,BPQ2
"RTN","BPSSCRU4",197,0)
 N BPFRPAT,BPTOPAT,BPFRCLM,BPTOCLM,BP1
"RTN","BPSSCRU4",198,0)
 S BPQ=0
"RTN","BPSSCRU4",199,0)
 S BPRET=1
"RTN","BPSSCRU4",200,0)
 I BPVAL'["-" D  Q BPRET
"RTN","BPSSCRU4",201,0)
 . S BPPAT=$P(BPVAL,".",1)
"RTN","BPSSCRU4",202,0)
 . I BPPAT'=+BPPAT S BPRET=-1 Q  ;invalid format, patient part is not numeric
"RTN","BPSSCRU4",203,0)
 . S BPCLM=$P(BPVAL,".",2)
"RTN","BPSSCRU4",204,0)
 . ;if only patient index
"RTN","BPSSCRU4",205,0)
 . I $L(BPCLM)=0 D  Q
"RTN","BPSSCRU4",206,0)
 . . S BPQ2=0
"RTN","BPSSCRU4",207,0)
 . . F BPCLM=1:1 D  Q:BPQ2'=0
"RTN","BPSSCRU4",208,0)
 . . . ;quit if there are no more claims for the patient
"RTN","BPSSCRU4",209,0)
 . . . S BP1=$$CHECKLN(BPPAT_"."_BPCLM,"C",BPTMP1)
"RTN","BPSSCRU4",210,0)
 . . . I BP1<1 S BPQ2=1 Q
"RTN","BPSSCRU4",211,0)
 . . . S BPARR(+BPPAT,+BPCLM)=BP1
"RTN","BPSSCRU4",212,0)
 . ;if only patient+claim index
"RTN","BPSSCRU4",213,0)
 . I BPCLM'=+BPCLM S BPRET=-2 Q  ;invalid format, claim portion is not numeric
"RTN","BPSSCRU4",214,0)
 . S BP1=$$CHECKLN(BPPAT_"."_BPCLM,"C",BPTMP1)
"RTN","BPSSCRU4",215,0)
 . I BP1<1 S BPRET=-3 Q  ;not found
"RTN","BPSSCRU4",216,0)
 . S BPARR(+BPPAT,+BPCLM)=BP1
"RTN","BPSSCRU4",217,0)
 ;********* if contains "-"
"RTN","BPSSCRU4",218,0)
 S BPFR=$P(BPVAL,"-",1)
"RTN","BPSSCRU4",219,0)
 S BPTO=$P(BPVAL,"-",2)
"RTN","BPSSCRU4",220,0)
 I BPTO["-" Q -3  ;invalid format (to many dashes)
"RTN","BPSSCRU4",221,0)
 S BPFRPAT=$P(BPFR,".",1)
"RTN","BPSSCRU4",222,0)
 S BPTOPAT=$P(BPTO,".",1)
"RTN","BPSSCRU4",223,0)
 S BPFRCLM=$P(BPFR,".",2)
"RTN","BPSSCRU4",224,0)
 I $L(BPFRCLM)=0 S BPFRCLM=1
"RTN","BPSSCRU4",225,0)
 S BPTOCLM=$P(BPTO,".",2)
"RTN","BPSSCRU4",226,0)
 I $L(BPTOCLM)=0 S BPTOCLM=999999
"RTN","BPSSCRU4",227,0)
 I BPFRPAT'=+BPFRPAT Q -1  ;invalid format, patient part is not numeric
"RTN","BPSSCRU4",228,0)
 I BPTOPAT'=+BPTOPAT Q -1  ;invalid format, patient part is not numeric
"RTN","BPSSCRU4",229,0)
 I BPFRCLM'=+BPFRCLM Q -2  ;invalid format, claim portion is not numeric
"RTN","BPSSCRU4",230,0)
 I BPTOCLM'=+BPTOCLM Q -2  ;invalid format, claim portion is not numeric
"RTN","BPSSCRU4",231,0)
 F BPPAT=BPFRPAT:1:BPTOPAT D
"RTN","BPSSCRU4",232,0)
 . I BPPAT=BPFRPAT S BPCLSTRT=BPFRCLM
"RTN","BPSSCRU4",233,0)
 . E  S BPCLSTRT=1
"RTN","BPSSCRU4",234,0)
 . I BPPAT=BPTOPAT S BPCLEND=BPTOCLM
"RTN","BPSSCRU4",235,0)
 . E  S BPCLEND=999999
"RTN","BPSSCRU4",236,0)
 . S BPQ2=0
"RTN","BPSSCRU4",237,0)
 . F BPCLM=BPCLSTRT:1:BPCLEND D  Q:BPQ2'=0
"RTN","BPSSCRU4",238,0)
 . . ;quit if there are no more claims for the patient
"RTN","BPSSCRU4",239,0)
 . . S BP1=$$CHECKLN(BPPAT_"."_BPCLM,"C",BPTMP1)
"RTN","BPSSCRU4",240,0)
 . . I BP1<1 S BPQ2=1 Q
"RTN","BPSSCRU4",241,0)
 . . S BPARR(+BPPAT,+BPCLM)=BP1
"RTN","BPSSCRU4",242,0)
 Q 1
"RTN","BPSSCRU4",243,0)
 ;
"RTN","BPSSCRU5")
0^344^B63071819
"RTN","BPSSCRU5",1,0)
BPSSCRU5 ;BHAM ISC/SS - ECME SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCRU5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRU5",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRU5",4,0)
 ;USER SCREEN
"RTN","BPSSCRU5",5,0)
 Q
"RTN","BPSSCRU5",6,0)
 ;
"RTN","BPSSCRU5",7,0)
DATETIME(Y) ;EP - convert fileman date.time to printable
"RTN","BPSSCRU5",8,0)
 X ^DD("DD")
"RTN","BPSSCRU5",9,0)
 Q Y
"RTN","BPSSCRU5",10,0)
 ;
"RTN","BPSSCRU5",11,0)
 ;create a history of claims and responses in #9002313.57 file 
"RTN","BPSSCRU5",12,0)
 ;record for the specified transaction in #9002313.59 file
"RTN","BPSSCRU5",13,0)
 ;input:
"RTN","BPSSCRU5",14,0)
 ; BP59 - ptr to #9002313.59
"RTN","BPSSCRU5",15,0)
 ; BPHIST - array to return results
"RTN","BPSSCRU5",16,0)
 ;output:
"RTN","BPSSCRU5",17,0)
 ; Array in BPHIST with the format:
"RTN","BPSSCRU5",18,0)
 ;  BPHIST(type,timedate,PointerToResponseClaimFile)=PointerTo#9002313.57
"RTN","BPSSCRU5",19,0)
 ;  where:
"RTN","BPSSCRU5",20,0)
 ;  type "C" - BPS CLAIM file, "R" - BPS RESPONSE file
"RTN","BPSSCRU5",21,0)
 ;  PointerToResponseClaimFile - pointer to 9002313.03 or 9002313.02
"RTN","BPSSCRU5",22,0)
MKHIST(BP59,BPHIST) ;
"RTN","BPSSCRU5",23,0)
 N BP57,BPLSTCLM,BPLSTRSP,BPDAT57,BP1,BPSSTDT
"RTN","BPSSCRU5",24,0)
 S BP57=0
"RTN","BPSSCRU5",25,0)
 N BPSARR02
"RTN","BPSSCRU5",26,0)
 N BPSARR03
"RTN","BPSSCRU5",27,0)
 ; -- process BPS LOG OF TRANSACTIONS file
"RTN","BPSSCRU5",28,0)
 F  S BP57=$O(^BPSTL("B",BP59,BP57)) Q:+BP57=0  D
"RTN","BPSSCRU5",29,0)
 . ;claim transmissions
"RTN","BPSSCRU5",30,0)
 . S BPDAT57(0)=$G(^BPSTL(BP57,0))
"RTN","BPSSCRU5",31,0)
 . S BPSSTDT=+$P(BPDAT57(0),U,11) ;start time
"RTN","BPSSCRU5",32,0)
 . S BPLSTCLM=+$P(BPDAT57(0),U,4) ;claim
"RTN","BPSSCRU5",33,0)
 . I BPLSTCLM>0 D
"RTN","BPSSCRU5",34,0)
 . . S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,5) ;transmitted on
"RTN","BPSSCRU5",35,0)
 . . I BP1=0 S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,6) ;rec created on
"RTN","BPSSCRU5",36,0)
 . . ;old BPS CLAIMS recs don't have dates, so use START TIME from .57 file but 
"RTN","BPSSCRU5",37,0)
 . . ;only at the very first time (using $D for this)
"RTN","BPSSCRU5",38,0)
 . . I BP1=0 I '$D(BPSARR02(BPLSTCLM)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",39,0)
 . . I BP1 S BPHIST("C",BP1,BPLSTCLM)=BP57_U_"C"
"RTN","BPSSCRU5",40,0)
 . S BPLSTRSP=+$P(BPDAT57(0),U,5) ;response
"RTN","BPSSCRU5",41,0)
 . I BPLSTRSP>0 D
"RTN","BPSSCRU5",42,0)
 . . S BP1=+$P($G(^BPSR(BPLSTRSP,0)),U,2) ;received on
"RTN","BPSSCRU5",43,0)
 . . I BP1=0 I '$D(BPSARR03(BPLSTRSP)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",44,0)
 . . I BP1 S BPHIST("R",BP1,BPLSTRSP)=BP57_U_"C"
"RTN","BPSSCRU5",45,0)
 . ;reversal transmissions
"RTN","BPSSCRU5",46,0)
 . S BPDAT57(4)=$G(^BPSTL(BP57,4))
"RTN","BPSSCRU5",47,0)
 . S BPLSTCLM=+$P(BPDAT57(4),U,1) ;reversal
"RTN","BPSSCRU5",48,0)
 . I BPLSTCLM>0 D
"RTN","BPSSCRU5",49,0)
 . . S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,5) ;transmitted on
"RTN","BPSSCRU5",50,0)
 . . I BP1=0 S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,6) ;rec created on
"RTN","BPSSCRU5",51,0)
 . . I BP1=0 I '$D(BPSARR02(BPLSTCLM)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",52,0)
 . . I BP1 S BPHIST("C",BP1,BPLSTCLM)=BP57_U_"R"
"RTN","BPSSCRU5",53,0)
 . S BPLSTRSP=+$P(BPDAT57(4),U,2) ;reversal response
"RTN","BPSSCRU5",54,0)
 . I BPLSTRSP>0 D
"RTN","BPSSCRU5",55,0)
 . . S BP1=+$P($G(^BPSR(BPLSTRSP,0)),U,2) ;received on
"RTN","BPSSCRU5",56,0)
 . . I BP1=0 I '$D(BPSARR03(BPLSTRSP)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",57,0)
 . . I BP1 S BPHIST("R",BP1,BPLSTRSP)=BP57_U_"R"
"RTN","BPSSCRU5",58,0)
 ;--------
"RTN","BPSSCRU5",59,0)
 ;sorting: pairs (send/respond) in reversed chronological order
"RTN","BPSSCRU5",60,0)
 N BPCLDT1,BPCLIEN,BPRSDT1,BPRSIEN,BPCLDT2
"RTN","BPSSCRU5",61,0)
 S BPCLDT1=0
"RTN","BPSSCRU5",62,0)
 F  S BPCLDT1=$O(BPHIST("C",BPCLDT1)) Q:BPCLDT1=""  D
"RTN","BPSSCRU5",63,0)
 . S BPCLIEN=$O(BPHIST("C",BPCLDT1,0)) Q:BPCLIEN=""  D
"RTN","BPSSCRU5",64,0)
 . . S BPCLDT2=+$O(BPHIST("C",BPCLDT1))
"RTN","BPSSCRU5",65,0)
 . . I BPCLDT2=0 S BPCLDT2=9999999
"RTN","BPSSCRU5",66,0)
 . . S BPRSDT1=BPCLDT1
"RTN","BPSSCRU5",67,0)
 . . F  S BPRSDT1=$O(BPHIST("R",BPRSDT1)) Q:BPRSDT1=""!(BPRSDT1>BPCLDT2)  D
"RTN","BPSSCRU5",68,0)
 . . . S BPRSIEN=$O(BPHIST("R",BPRSDT1,0)) Q:BPRSIEN=""  D
"RTN","BPSSCRU5",69,0)
 . . . . S BPHIST("C",BPCLDT1,BPCLIEN,"R",BPRSIEN)=BPHIST("R",BPRSDT1,BPRSIEN)
"RTN","BPSSCRU5",70,0)
 ;
"RTN","BPSSCRU5",71,0)
 Q
"RTN","BPSSCRU5",72,0)
 ;returns text for the transaction code in file #9002313.02 -- BPS CLAIMS FILE
"RTN","BPSSCRU5",73,0)
TRTYPE(BPTRCD) ;
"RTN","BPSSCRU5",74,0)
 I BPTRCD="E1" Q "Eligibility Verification"
"RTN","BPSSCRU5",75,0)
 I BPTRCD="B1" Q "REQUEST"  ;"Billing"
"RTN","BPSSCRU5",76,0)
 I BPTRCD="B2" Q "REVERSAL"  ; "Reversal"
"RTN","BPSSCRU5",77,0)
 I BPTRCD="B3" Q "Rebill"
"RTN","BPSSCRU5",78,0)
 I BPTRCD="P1" Q "P.A. Request & Billing"
"RTN","BPSSCRU5",79,0)
 I BPTRCD="P2" Q "P.A. Reversal"
"RTN","BPSSCRU5",80,0)
 I BPTRCD="P3" Q "P.A. Inquiry"
"RTN","BPSSCRU5",81,0)
 I BPTRCD="P4" Q "P.A. Request Only"
"RTN","BPSSCRU5",82,0)
 I BPTRCD="N1" Q "Information Reporting"
"RTN","BPSSCRU5",83,0)
 I BPTRCD="N2" Q "Information Reporting Reversal"
"RTN","BPSSCRU5",84,0)
 I BPTRCD="N3" Q "Information Reporting Rebill"
"RTN","BPSSCRU5",85,0)
 I BPTRCD="C1" Q "Controlled Substance Reporting"
"RTN","BPSSCRU5",86,0)
 I BPTRCD="C2" Q "Controlled Substance Reporting Reversal"
"RTN","BPSSCRU5",87,0)
 I BPTRCD="C3" Q "Controlled Substance Reporting Rebill"
"RTN","BPSSCRU5",88,0)
 Q ""
"RTN","BPSSCRU5",89,0)
 ;
"RTN","BPSSCRU5",90,0)
 ;get NDC for LOG
"RTN","BPSSCRU5",91,0)
 ;BPIEN02 - IEN in #9002313.02 file
"RTN","BPSSCRU5",92,0)
LNDC(BPIEN02) ;
"RTN","BPSSCRU5",93,0)
 N BPDAT02,BPNDC
"RTN","BPSSCRU5",94,0)
 S BPDAT02(400)=$G(^BPSC(BPIEN02,400,1,400))
"RTN","BPSSCRU5",95,0)
 S BPNDC=$E($P(BPDAT02(400),U,7),3,99)
"RTN","BPSSCRU5",96,0)
 S BPNDC=$E(BPNDC,1,5)_"-"_$E(BPNDC,6,9)_"-"_$E(BPNDC,10,11)
"RTN","BPSSCRU5",97,0)
 Q BPNDC
"RTN","BPSSCRU5",98,0)
 ;prepares array of reject codes
"RTN","BPSSCRU5",99,0)
 ; BPIEN03 - IEN in #9002313.03 file
"RTN","BPSSCRU5",100,0)
 ; BPRCODES - array to return results
"RTN","BPSSCRU5",101,0)
REJCODES(BPIEN03,BPRCODES) ;
"RTN","BPSSCRU5",102,0)
 N BPA,BPR
"RTN","BPSSCRU5",103,0)
 S BPA=0
"RTN","BPSSCRU5",104,0)
 F  S BPA=$O(^BPSR(BPIEN03,1000,1,511,BPA)) Q:'BPA  D
"RTN","BPSSCRU5",105,0)
 . S BPR=$P(^BPSR(BPIEN03,1000,1,511,BPA,0),U)
"RTN","BPSSCRU5",106,0)
 . I BPR'="" S BPRCODES(BPR)=""
"RTN","BPSSCRU5",107,0)
 Q
"RTN","BPSSCRU5",108,0)
 ;status of the response
"RTN","BPSSCRU5",109,0)
RESPSTAT(BPIEN03) ;
"RTN","BPSSCRU5",110,0)
 N BP1
"RTN","BPSSCRU5",111,0)
 S BP1=$P($G(^BPSR(BPIEN03,1000,1,110)),U,2)
"RTN","BPSSCRU5",112,0)
 Q:BP1="A" "Approved"
"RTN","BPSSCRU5",113,0)
 Q:BP1="C" "Captured"
"RTN","BPSSCRU5",114,0)
 Q:BP1="D" "Duplicate of Paid"
"RTN","BPSSCRU5",115,0)
 Q:BP1="F" "PA Deferred"
"RTN","BPSSCRU5",116,0)
 Q:BP1="P" "Paid"
"RTN","BPSSCRU5",117,0)
 Q:BP1="Q" "Duplicate of Capture"
"RTN","BPSSCRU5",118,0)
 Q:BP1="R" "Rejected"
"RTN","BPSSCRU5",119,0)
 Q:BP1="S" "Duplicate of Approved"
"RTN","BPSSCRU5",120,0)
 Q ""
"RTN","BPSSCRU5",121,0)
 ;
"RTN","BPSSCRU5",122,0)
 ;Electronic payer - ptr to #9002313.92 
"RTN","BPSSCRU5",123,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRU5",124,0)
PYRIEN(BPIEN02) ;
"RTN","BPSSCRU5",125,0)
 Q $P($G(^BPSF(9002313.92,+$P($G(^BPSC(BPIEN02,0)),U,2),0)),U)
"RTN","BPSSCRU5",126,0)
 ;
"RTN","BPSSCRU5",127,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRU5",128,0)
B2PYRIEN(BPIEN02,BP57) ;
"RTN","BPSSCRU5",129,0)
 N BPX,BPX2
"RTN","BPSSCRU5",130,0)
 S BPX=$G(^BPSF(9002313.92,+$$PYRIEN(BPIEN02),"REVERSAL"))
"RTN","BPSSCRU5",131,0)
 I $L(BPX)=0 D
"RTN","BPSSCRU5",132,0)
 . S BPX2=+$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,3)
"RTN","BPSSCRU5",133,0)
 . S BPX=$P($G(^BPSF(9002313.92,BPX2,0)),U)
"RTN","BPSSCRU5",134,0)
 Q BPX
"RTN","BPSSCRU5",135,0)
 ;
"RTN","BPSSCRU5",136,0)
 ;B3 payer sheet 
"RTN","BPSSCRU5",137,0)
B3PYRIEN(BPIEN02,BP59,BP57) ;
"RTN","BPSSCRU5",138,0)
 N BPX,BPX2
"RTN","BPSSCRU5",139,0)
 S BPX2=+$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,4)
"RTN","BPSSCRU5",140,0)
 S BPX=$P($G(^BPSF(9002313.92,BPX2,0)),U)
"RTN","BPSSCRU5",141,0)
 Q BPX
"RTN","BPSSCRU5",142,0)
 ;
"RTN","BPSSCRU5",143,0)
ALLTRANS(BP59) ;
"RTN","BPSSCRU5",144,0)
 N BPX,BPRXIEN,BPREF,BP1,BPISSDT,BPZERO
"RTN","BPSSCRU5",145,0)
 S BP1=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRU5",146,0)
 S BPRXIEN=$P(BP1,U,1)
"RTN","BPSSCRU5",147,0)
 S BPREF=$P(BP1,U,2)
"RTN","BPSSCRU5",148,0)
 S BPZERO=$G(^BPST(BP59,0))
"RTN","BPSSCRU5",149,0)
 S BPISSDT=$$GET1^DIQ(52,BPRXIEN,1)
"RTN","BPSSCRU5",150,0)
 ;
"RTN","BPSSCRU5",151,0)
 ;
"RTN","BPSSCRU5",152,0)
 ;BPLN= line to use in SETLINE
"RTN","BPSSCRU5",153,0)
 ;BPX - long string to display
"RTN","BPSSCRU5",154,0)
 ;BPMLEN - max length
"RTN","BPSSCRU5",155,0)
 ;BPPREFX - prefix string
"RTN","BPSSCRU5",156,0)
 ;BPMARG - left margin
"RTN","BPSSCRU5",157,0)
WRAPLN(BPLN,BPX,BPMLEN,BPPREFX,BPMARG) ;
"RTN","BPSSCRU5",158,0)
 N BPQ,BPLEN,BPXX
"RTN","BPSSCRU5",159,0)
 S BPQ=0
"RTN","BPSSCRU5",160,0)
 S BPLEN=BPMLEN-$L(BPPREFX)
"RTN","BPSSCRU5",161,0)
 S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",162,0)
 D SETLINE^BPSSCRLG(.BPLN,BPPREFX_BPXX)
"RTN","BPSSCRU5",163,0)
 S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",164,0)
 I $L(BPX)<1 Q
"RTN","BPSSCRU5",165,0)
 S BPLEN=BPMLEN-BPMARG
"RTN","BPSSCRU5",166,0)
 F  D  Q:BPQ=1
"RTN","BPSSCRU5",167,0)
 . S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",168,0)
 . D SETLINE^BPSSCRLG(.BPLN,$$SPACES(BPMARG)_BPXX)
"RTN","BPSSCRU5",169,0)
 . S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",170,0)
 . I $L(BPX)<1 S BPQ=1
"RTN","BPSSCRU5",171,0)
 Q
"RTN","BPSSCRU5",172,0)
 ;
"RTN","BPSSCRU5",173,0)
 ;to prepare spaces
"RTN","BPSSCRU5",174,0)
SPACES(BPN) ;
"RTN","BPSSCRU5",175,0)
 N BPX
"RTN","BPSSCRU5",176,0)
 S $P(BPX," ",BPN+1)=""
"RTN","BPSSCRU5",177,0)
 Q BPX
"RTN","BPSSCRU5",178,0)
 ;
"RTN","BPSSCRU5",179,0)
 ;BPN= line counter (index) 
"RTN","BPSSCRU5",180,0)
 ;BPARR - array for lines
"RTN","BPSSCRU5",181,0)
 ;BPX - long string to display
"RTN","BPSSCRU5",182,0)
 ;BPMLEN - mas length
"RTN","BPSSCRU5",183,0)
 ;BPPREFX - prefix string
"RTN","BPSSCRU5",184,0)
 ;BPMARG - left margin
"RTN","BPSSCRU5",185,0)
WRAPLN2(BPN,BPARR,BPX,BPMLEN,BPPREFX,BPMARG) ;
"RTN","BPSSCRU5",186,0)
 N BPQ,BPLEN,BPXX
"RTN","BPSSCRU5",187,0)
 S BPQ=0
"RTN","BPSSCRU5",188,0)
 S BPLEN=BPMLEN-$L(BPPREFX)
"RTN","BPSSCRU5",189,0)
 S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",190,0)
 D SETLN(.BPN,.BPARR,BPPREFX_BPXX)
"RTN","BPSSCRU5",191,0)
 S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",192,0)
 I $L(BPX)<1 Q
"RTN","BPSSCRU5",193,0)
 S BPLEN=BPMLEN-BPMARG
"RTN","BPSSCRU5",194,0)
 F  D  Q:BPQ=1
"RTN","BPSSCRU5",195,0)
 . S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",196,0)
 . D SETLN(.BPN,.BPARR,$$SPACES(BPMARG)_BPXX)
"RTN","BPSSCRU5",197,0)
 . S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",198,0)
 . I $L(BPX)<1 S BPQ=1
"RTN","BPSSCRU5",199,0)
 Q
"RTN","BPSSCRU5",200,0)
 ;
"RTN","BPSSCRU5",201,0)
 ;
"RTN","BPSSCRU5",202,0)
SETLN(BPN,BPARR,BPTXT) ;
"RTN","BPSSCRU5",203,0)
 S BPN=BPN+1,BPARR(BPN)=BPTXT
"RTN","BPSSCRU5",204,0)
 Q
"RTN","BPSSCRU5",205,0)
 ;---
"RTN","BPSSCRU5",206,0)
 ;check 2nd insurance
"RTN","BPSSCRU5",207,0)
 ;if there then ask user and print message
"RTN","BPSSCRU5",208,0)
CH2NDINS(BP59,BPPATNAM,BPINSNAM,BPRXINFO) ;
"RTN","BPSSCRU5",209,0)
 N BPRETV
"RTN","BPSSCRU5",210,0)
 S BPRETV=$$NEXTINS^BPSSCRCL(BP59,BPINSNAM)
"RTN","BPSSCRU5",211,0)
 Q:+BPRETV=0
"RTN","BPSSCRU5",212,0)
 D PRN(BPPATNAM,BPRETV,.BPRXINFO,"S")
"RTN","BPSSCRU5",213,0)
 W !!
"RTN","BPSSCRU5",214,0)
 I $$YESNO^BPSSCRRS("Do you want to print the information (above) concerning additional insurance?   (Y/N)")'=1 Q
"RTN","BPSSCRU5",215,0)
 D PRN(BPPATNAM,BPRETV,.BPRXINFO,"P")
"RTN","BPSSCRU5",216,0)
 Q
"RTN","BPSSCRU5",217,0)
 ;
"RTN","BPSSCRU5",218,0)
 ;BPPRNFL
"RTN","BPSSCRU5",219,0)
 ; S- print to screen
"RTN","BPSSCRU5",220,0)
PRN(BPPATNAM,BPRETV,BPRXINFO,BPPRNFL) ;
"RTN","BPSSCRU5",221,0)
 I BPPRNFL="S" W @IOF D MS2NDINS Q
"RTN","BPSSCRU5",222,0)
 D PRINT("MS2NDINS^BPSSCRU5","BPS 2ND INSURANCE INFO","BP*")
"RTN","BPSSCRU5",223,0)
 W !!
"RTN","BPSSCRU5",224,0)
 Q
"RTN","BPSSCRU5",225,0)
 ;
"RTN","BPSSCRU5",226,0)
MS2NDINS ;
"RTN","BPSSCRU5",227,0)
 N Y,Z
"RTN","BPSSCRU5",228,0)
 W !,"This patient HAS additional insurance with Rx Coverage that may be"
"RTN","BPSSCRU5",229,0)
 W !,"used to bill this claim.  The system WILL change the CT entry to a"
"RTN","BPSSCRU5",230,0)
 W !,"NON-BILLABLE Episode. If appropriate, please go to Claims Tracking"
"RTN","BPSSCRU5",231,0)
 W !,"to manually create a bill to the additional payer listed below."
"RTN","BPSSCRU5",232,0)
 W !!,"Patient: ",?18,BPPATNAM
"RTN","BPSSCRU5",233,0)
 S Y=$P(BPRETV,U,4)\1 D DD^%DT
"RTN","BPSSCRU5",234,0)
 W !,"Date of service: ",?18,Y
"RTN","BPSSCRU5",235,0)
 W !,"Insurance: ",?18,$P(BPRETV,U,2)
"RTN","BPSSCRU5",236,0)
 W !,"Group number: ",?18,$P(BPRETV,U,3)
"RTN","BPSSCRU5",237,0)
 S Z=0 F  S Z=$O(BPRXINFO(Z)) Q:+Z=0  W !,BPRXINFO(Z)
"RTN","BPSSCRU5",238,0)
 Q
"RTN","BPSSCRU5",239,0)
 ;
"RTN","BPSSCRU5",240,0)
 ;Prints report
"RTN","BPSSCRU5",241,0)
 ;propmpts user to choose device (including queuing)
"RTN","BPSSCRU5",242,0)
 ;TXTSRC - name of the report's entry point
"RTN","BPSSCRU5",243,0)
 ;DESCR - description for the Task Manager
"RTN","BPSSCRU5",244,0)
 ;SAVEVARS - mask for vars that need to be available in the report
"RTN","BPSSCRU5",245,0)
 ;  (exmpl: "BP*")
"RTN","BPSSCRU5",246,0)
PRINT(TXTSRC,DESCR,SAVEVARS) ;
"RTN","BPSSCRU5",247,0)
 N Y,QUITVAR,SCRFLAG
"RTN","BPSSCRU5",248,0)
 S (QUITVAR,SCRFLAG)=0
"RTN","BPSSCRU5",249,0)
 D DEVICE Q:QUITVAR
"RTN","BPSSCRU5",250,0)
 D @TXTSRC
"RTN","BPSSCRU5",251,0)
 D ^%ZISC
"RTN","BPSSCRU5",252,0)
 I QUITVAR W !,"Cancelled"
"RTN","BPSSCRU5",253,0)
 Q
"RTN","BPSSCRU5",254,0)
 ;
"RTN","BPSSCRU5",255,0)
DEVICE ;
"RTN","BPSSCRU5",256,0)
 N DIR,DIRUT,POP
"RTN","BPSSCRU5",257,0)
 N ZTRTN,ZTIO,ZTSAVE,ZTDESC,%ZIS
"RTN","BPSSCRU5",258,0)
 K IO("Q") S %ZIS="QM"
"RTN","BPSSCRU5",259,0)
 W ! D ^%ZIS
"RTN","BPSSCRU5",260,0)
 I POP S QUITVAR=1 Q
"RTN","BPSSCRU5",261,0)
 S SCRFLAG=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSSCRU5",262,0)
 I $D(IO("Q")) D  S QUITVAR=1
"RTN","BPSSCRU5",263,0)
 . S ZTRTN=TXTSRC
"RTN","BPSSCRU5",264,0)
 . S ZTIO=ION
"RTN","BPSSCRU5",265,0)
 . S ZTSAVE(SAVEVARS)=""
"RTN","BPSSCRU5",266,0)
 . S ZTDESC=DESCR
"RTN","BPSSCRU5",267,0)
 . D ^%ZTLOAD
"RTN","BPSSCRU5",268,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","BPSSCRU5",269,0)
 . D HOME^%ZIS
"RTN","BPSSCRU5",270,0)
 U IO
"RTN","BPSSCRU5",271,0)
 Q
"RTN","BPSSCRU5",272,0)
 ;
"RTN","BPSSCRUD")
0^345^B1170745
"RTN","BPSSCRUD",1,0)
BPSSCRUD ;BHAM ISC/SS - ECME SCREEN UPDATE DISPLAY ;05-APR-05
"RTN","BPSSCRUD",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSSCRUD",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSSCRUD",4,0)
 Q
"RTN","BPSSCRUD",5,0)
 ;
"RTN","BPSSCRUD",6,0)
UD ;
"RTN","BPSSCRUD",7,0)
 D REDRAW("Updating screen...")
"RTN","BPSSCRUD",8,0)
 Q
"RTN","BPSSCRUD",9,0)
 ;
"RTN","BPSSCRUD",10,0)
 ;
"RTN","BPSSCRUD",11,0)
 ;redraw screen
"RTN","BPSSCRUD",12,0)
REDRAW(BPTXT) ;
"RTN","BPSSCRUD",13,0)
 W !,$S($L($G(BPTXT))>0:$G(BPTXT),1:"Please wait...")
"RTN","BPSSCRUD",14,0)
 N BPARR
"RTN","BPSSCRUD",15,0)
 D RESTVIEW^BPSSCR01(.BPARR) ;prevent VIES setting stored in TMP from cleanup
"RTN","BPSSCRUD",16,0)
 D CLEAN^VALM10
"RTN","BPSSCRUD",17,0)
 D SAVEVIEW^BPSSCR01(.BPARR) ;put VIES setting back to TMP
"RTN","BPSSCRUD",18,0)
 S VALMCNT=$$INIT^BPSSCR01()
"RTN","BPSSCRUD",19,0)
 D HDR^BPSSCR
"RTN","BPSSCRUD",20,0)
 S VALMBCK="R"
"RTN","BPSSCRUD",21,0)
 Q
"RTN","BPSSCRUD",22,0)
 ;
"RTN","BPSUSCR")
0^306^B1083418
"RTN","BPSUSCR",1,0)
BPSUSCR ;BHAM ISC/FLS - ECME STRANDED CLAIMS SCREEN MAIN ;10-MAR-2005
"RTN","BPSUSCR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSUSCR",3,0)
 ;STRANDED CLAIMS SCREEN
"RTN","BPSUSCR",4,0)
 Q
"RTN","BPSUSCR",5,0)
EN ; -- main entry point for BPS ECME USER SCREEN
"RTN","BPSUSCR",6,0)
 N BPTMPGL,DUOUT,DTOUT,BPQ
"RTN","BPSUSCR",7,0)
 S BPQ=$$MESSAGE^BPSUSCR1() I BPQ=1 Q
"RTN","BPSUSCR",8,0)
 D GETDTS^BPSUSCR1(.BPARR) Q:$D(DUOUT)!$D(DTOUT)
"RTN","BPSUSCR",9,0)
 D EN^VALM("BPS LSTMN ECME UNSTRAND")
"RTN","BPSUSCR",10,0)
 Q
"RTN","BPSUSCR",11,0)
 ;
"RTN","BPSUSCR",12,0)
HDR ; -- header code
"RTN","BPSUSCR",13,0)
 S BPBDT=$$FMTE^XLFDT($P(BPBDT,"."),"5Z")
"RTN","BPSUSCR",14,0)
 S BPEDT=$$FMTE^XLFDT($P(BPEDT,"."),"5Z")
"RTN","BPSUSCR",15,0)
 S VALMHDR(1)="Claims Stranded from "_BPBDT_" through "_BPEDT
"RTN","BPSUSCR",16,0)
 S VALMHDR(2)="Sorted by Transaction Date"
"RTN","BPSUSCR",17,0)
 Q
"RTN","BPSUSCR",18,0)
 ;
"RTN","BPSUSCR",19,0)
INIT ; -- init variables and list array
"RTN","BPSUSCR",20,0)
 W !,"Please wait..."
"RTN","BPSUSCR",21,0)
 D INIT^BPSUSCR1
"RTN","BPSUSCR",22,0)
 Q
"RTN","BPSUSCR",23,0)
 ;
"RTN","BPSUSCR",24,0)
HELP ; -- help code
"RTN","BPSUSCR",25,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSUSCR",26,0)
 K X
"RTN","BPSUSCR",27,0)
 Q
"RTN","BPSUSCR",28,0)
 ;
"RTN","BPSUSCR",29,0)
EXIT ; -- exit code
"RTN","BPSUSCR",30,0)
 K BPARR,BPEDT,BPBDT
"RTN","BPSUSCR",31,0)
 D CLEAN^VALM10
"RTN","BPSUSCR",32,0)
 Q
"RTN","BPSUSCR1")
0^307^B18903469
"RTN","BPSUSCR1",1,0)
BPSUSCR1 ;BHAM ISC/FLS - STRANDED CLAIMS SCREEN ;10-MAR-2005
"RTN","BPSUSCR1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSUSCR1",3,0)
 Q
"RTN","BPSUSCR1",4,0)
 ;
"RTN","BPSUSCR1",5,0)
INIT ; -- init variables and list array
"RTN","BPSUSCR1",6,0)
 N BPLN,BPLM,BP59,BPSORT,BPDUZ7,BPRET,CONT
"RTN","BPSUSCR1",7,0)
 ;get date/time range
"RTN","BPSUSCR1",8,0)
 K ^TMP($J),^TMP("BPSUSCR",$J)
"RTN","BPSUSCR1",9,0)
 S BPTMPGL="^TMP(""BPSUSCR"",$J)"
"RTN","BPSUSCR1",10,0)
 S CONT=1,VALMCNT=0
"RTN","BPSUSCR1",11,0)
 D COLLECT^BPSUSCR4(.BPARR)
"RTN","BPSUSCR1",12,0)
 Q
"RTN","BPSUSCR1",13,0)
 ;
"RTN","BPSUSCR1",14,0)
HELP ; -- help code
"RTN","BPSUSCR1",15,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSUSCR1",16,0)
 K X
"RTN","BPSUSCR1",17,0)
 Q
"RTN","BPSUSCR1",18,0)
 ;
"RTN","BPSUSCR1",19,0)
EXIT ; -- exit code
"RTN","BPSUSCR1",20,0)
 Q
"RTN","BPSUSCR1",21,0)
 ;
"RTN","BPSUSCR1",22,0)
 ; Warning message for 'Transmitting' claims
"RTN","BPSUSCR1",23,0)
MESSAGE() ;
"RTN","BPSUSCR1",24,0)
 W !!!,"Please be aware that if there are claims appearing on the ECME User Screen"
"RTN","BPSUSCR1",25,0)
 W !,"with a status of 'In progress - Transmitting', then there may be a problem"
"RTN","BPSUSCR1",26,0)
 W !,"with HL7 or with system connectivity with the Austin Automation Center (AAC)."
"RTN","BPSUSCR1",27,0)
 W !,"Please contact your IRM to verify that connectivity to the AAC is working"
"RTN","BPSUSCR1",28,0)
 W !,"and the HL7 link BPS NCPDP is processing messages before using this option"
"RTN","BPSUSCR1",29,0)
 W !,"to unstrand claims with a status of 'In progress - Transmitting'.",!
"RTN","BPSUSCR1",30,0)
 N DIR,X,Y,BPQ
"RTN","BPSUSCR1",31,0)
 S BPQ=0
"RTN","BPSUSCR1",32,0)
 S DIR(0)="YA",DIR("A")="Do you want to continue? "
"RTN","BPSUSCR1",33,0)
 S DIR("B")="NO"
"RTN","BPSUSCR1",34,0)
 D ^DIR
"RTN","BPSUSCR1",35,0)
 I Y'=1 S BPQ=1
"RTN","BPSUSCR1",36,0)
 W !!
"RTN","BPSUSCR1",37,0)
 Q BPQ
"RTN","BPSUSCR1",38,0)
 ;
"RTN","BPSUSCR1",39,0)
GETDTS(BPARR) ; Transaction dates to view.
"RTN","BPSUSCR1",40,0)
 N DIR
"RTN","BPSUSCR1",41,0)
 K DIRUT,DIROUT,DUOUT,DTOUT,Y
"RTN","BPSUSCR1",42,0)
 S DIR(0)="DA^:DT:EX",DIR("A")="FIRST TRANSACTION DATE: "
"RTN","BPSUSCR1",43,0)
 S DIR("B")="T-1"
"RTN","BPSUSCR1",44,0)
 D ^DIR
"RTN","BPSUSCR1",45,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","BPSUSCR1",46,0)
 S BPARR("BDT")=Y_".000001"
"RTN","BPSUSCR1",47,0)
ENDDT ;
"RTN","BPSUSCR1",48,0)
 K DIRUT,DIROUT,DUOUT,DTOUT,Y
"RTN","BPSUSCR1",49,0)
 S DIR(0)="DA^"_$P(BPARR("BDT"),".",1)_":DT:EX",DIR("A")="LAST TRANSACTION DATE: "
"RTN","BPSUSCR1",50,0)
 S DIR("B")="T"
"RTN","BPSUSCR1",51,0)
 D ^DIR
"RTN","BPSUSCR1",52,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","BPSUSCR1",53,0)
 S BPARR("EDT")=$$EDATE(Y)
"RTN","BPSUSCR1",54,0)
 Q
"RTN","BPSUSCR1",55,0)
 ;
"RTN","BPSUSCR1",56,0)
EDATE(DATE) ;
"RTN","BPSUSCR1",57,0)
 N RTN,%,%H
"RTN","BPSUSCR1",58,0)
 S RTN=DATE_".235959"
"RTN","BPSUSCR1",59,0)
 D NOW^%DTC
"RTN","BPSUSCR1",60,0)
 I $P(%,".")=DATE S $P(%H,",",2)=$P(%H,",",2)-1800 D YX^%DTC S RTN=DATE_%
"RTN","BPSUSCR1",61,0)
 Q RTN
"RTN","BPSUSCR1",62,0)
ALL ; Unstrand all claims currently selected.
"RTN","BPSUSCR1",63,0)
 D FULL^VALM1
"RTN","BPSUSCR1",64,0)
 N D0,DIR,SEQ,LAST
"RTN","BPSUSCR1",65,0)
 S LAST=+$O(^TMP($J,2,""),-1)
"RTN","BPSUSCR1",66,0)
 I LAST=0 D  Q
"RTN","BPSUSCR1",67,0)
 . W !,"There are no stranded claims in this date range to unstrand"
"RTN","BPSUSCR1",68,0)
 . D PRESSANY^BPSOSU5()
"RTN","BPSUSCR1",69,0)
 S DIR(0)="Y",DIR("A")="ARE YOU SURE? (YES/NO) ",DIR("B")="YES" D ^DIR Q:'Y
"RTN","BPSUSCR1",70,0)
 W !,"PLEASE WAIT"
"RTN","BPSUSCR1",71,0)
 S SEQ=0
"RTN","BPSUSCR1",72,0)
 F  S SEQ=$O(^TMP($J,2,SEQ)) Q:'SEQ  D
"RTN","BPSUSCR1",73,0)
 .  S D0=""
"RTN","BPSUSCR1",74,0)
 .  F  S D0=$O(^TMP($J,2,SEQ,D0)) Q:'D0  D
"RTN","BPSUSCR1",75,0)
 .  .  D PURGE(D0)
"RTN","BPSUSCR1",76,0)
 .  .  Q
"RTN","BPSUSCR1",77,0)
 .  Q
"RTN","BPSUSCR1",78,0)
 W !,"Done"
"RTN","BPSUSCR1",79,0)
 D CLEAN^VALM10
"RTN","BPSUSCR1",80,0)
 D COLLECT^BPSUSCR4(.BPARR)
"RTN","BPSUSCR1",81,0)
 Q
"RTN","BPSUSCR1",82,0)
SELECT ; Select entries from the list and run each through the unstrand function
"RTN","BPSUSCR1",83,0)
 N D0,DIR,I,J,VAR,BPTMPGL,PT,POP,LAST
"RTN","BPSUSCR1",84,0)
 S LAST=+$O(^TMP($J,2,""),-1)
"RTN","BPSUSCR1",85,0)
 I LAST=0 D  Q
"RTN","BPSUSCR1",86,0)
 . W !,"There are no stranded claims to select"
"RTN","BPSUSCR1",87,0)
 . D PRESSANY^BPSOSU5()
"RTN","BPSUSCR1",88,0)
 K DTOUT,DUOUT
"RTN","BPSUSCR1",89,0)
 S BPTMPGL="^TMP(""BPSUSCR"",$J)"
"RTN","BPSUSCR1",90,0)
 S VAR=""
"RTN","BPSUSCR1",91,0)
 S DIR(0)="LO^1:"_LAST
"RTN","BPSUSCR1",92,0)
 S DIR("A")="Enter a Selection of Stranded Claims",DIR("B")=""
"RTN","BPSUSCR1",93,0)
 D ^DIR
"RTN","BPSUSCR1",94,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","BPSUSCR1",95,0)
 S VAR=Y
"RTN","BPSUSCR1",96,0)
 F I=1:1:$L(VAR,",") S PT=$P(VAR,",",I) D
"RTN","BPSUSCR1",97,0)
 .  Q:PT=""
"RTN","BPSUSCR1",98,0)
 .  I PT'["-" S D0=$O(^TMP($J,2,PT,"")) D PURGE(D0) Q
"RTN","BPSUSCR1",99,0)
 .  F J=$P(PT,"-"):1:$P(PT,"-",2) S D0=$O(^TMP($J,2,J,"")) D PURGE(D0)
"RTN","BPSUSCR1",100,0)
 .  Q
"RTN","BPSUSCR1",101,0)
 D CLEAN^VALM10
"RTN","BPSUSCR1",102,0)
 D COLLECT^BPSUSCR4(.BPARR)
"RTN","BPSUSCR1",103,0)
 Q
"RTN","BPSUSCR1",104,0)
PRINT ;
"RTN","BPSUSCR1",105,0)
 N %ZIS
"RTN","BPSUSCR1",106,0)
 S %ZIS="M"
"RTN","BPSUSCR1",107,0)
 S %ZIS("A")="Select Printer: ",%ZIS("B")="" D ^%ZIS
"RTN","BPSUSCR1",108,0)
 Q:IOPAR=""
"RTN","BPSUSCR1",109,0)
 D PHDR
"RTN","BPSUSCR1",110,0)
 D PLINE
"RTN","BPSUSCR1",111,0)
 D ^%ZISC
"RTN","BPSUSCR1",112,0)
 Q
"RTN","BPSUSCR1",113,0)
PHDR ;
"RTN","BPSUSCR1",114,0)
 U IO
"RTN","BPSUSCR1",115,0)
 W !,"Claims Stranded from ",BPBDT," through ",BPEDT
"RTN","BPSUSCR1",116,0)
 ;
"RTN","BPSUSCR1",117,0)
 W !!,?4,"TRANS DT",?15,"PATIENT NAME",?36,"ID",?41,"EXTERN RX#",?54,"RF",?57,"FILL DT",?68,"INS CO"
"RTN","BPSUSCR1",118,0)
 W !,?4,"--------",?15,"------------",?36,"--",?41,"----------",?54,"--",?57,"-------",?68,"------"
"RTN","BPSUSCR1",119,0)
 Q
"RTN","BPSUSCR1",120,0)
PLINE ;
"RTN","BPSUSCR1",121,0)
 N SEQ,LINE
"RTN","BPSUSCR1",122,0)
 S SEQ=0
"RTN","BPSUSCR1",123,0)
 F  S SEQ=$O(^TMP("BPSUSCR",$J,SEQ)) Q:'SEQ  D
"RTN","BPSUSCR1",124,0)
 .  S LINE=$G(^TMP("BPSUSCR",$J,SEQ,0))
"RTN","BPSUSCR1",125,0)
 .  U IO
"RTN","BPSUSCR1",126,0)
 .  W !,$E(LINE,1,79)
"RTN","BPSUSCR1",127,0)
 .  Q
"RTN","BPSUSCR1",128,0)
 Q
"RTN","BPSUSCR1",129,0)
PURGE(IEN59)      ;
"RTN","BPSUSCR1",130,0)
 N ABSBRXI,MES
"RTN","BPSUSCR1",131,0)
 S ABSBRXI=IEN59
"RTN","BPSUSCR1",132,0)
 D SETSTAT^BPSOSU(99)
"RTN","BPSUSCR1",133,0)
 S MES="E STRANDED"
"RTN","BPSUSCR1",134,0)
 I $P($G(^BPST(IEN59,4)),"^",1)!($P($G(^BPST(IEN59,4)),"^",4)]"") S MES="E REVERSAL STRANDED"
"RTN","BPSUSCR1",135,0)
 D SETRESU^BPSOSU(99,MES)
"RTN","BPSUSCR1",136,0)
 Q
"RTN","BPSUSCR4")
0^308^B10796851
"RTN","BPSUSCR4",1,0)
BPSUSCR4 ;BHAM ISC/FLS - USER SCREEN ;14-FEB-05
"RTN","BPSUSCR4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSUSCR4",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","BPSUSCR4",4,0)
 ;
"RTN","BPSUSCR4",5,0)
 Q
"RTN","BPSUSCR4",6,0)
 ;
"RTN","BPSUSCR4",7,0)
 ; COLLECT - Compile stranded claims
"RTN","BPSUSCR4",8,0)
 ;   Input:
"RTN","BPSUSCR4",9,0)
 ;     BPARR - Date Range
"RTN","BPSUSCR4",10,0)
 ;   Output:
"RTN","BPSUSCR4",11,0)
 ;     ^TMP("BPSUSCR",$J)
"RTN","BPSUSCR4",12,0)
 ;     ^TMP($J,2)
"RTN","BPSUSCR4",13,0)
COLLECT(BPARR) ;
"RTN","BPSUSCR4",14,0)
 N TFILE,CFILE,SDT,STATUS,IEN59,VART,LSTUDT,CD0,DATA
"RTN","BPSUSCR4",15,0)
 N RX,REFILL,NAME,SSN,INSCO,FILLDT,SEQ,ITEM,MESSAGE
"RTN","BPSUSCR4",16,0)
 K BPBDT,BPEDT
"RTN","BPSUSCR4",17,0)
 K ^TMP($J),^TMP("BPSUSCR",$J)
"RTN","BPSUSCR4",18,0)
 S VALMCNT=0,TFILE=9002313.59,CFILE=9002313.02
"RTN","BPSUSCR4",19,0)
 S BPBDT=BPARR("BDT") ;start date and time
"RTN","BPSUSCR4",20,0)
 S BPEDT=BPARR("EDT") ;end date and time
"RTN","BPSUSCR4",21,0)
 ;
"RTN","BPSUSCR4",22,0)
 ; Loop through all statii from 0 to 98
"RTN","BPSUSCR4",23,0)
 S STATUS=-1
"RTN","BPSUSCR4",24,0)
 F  S STATUS=$O(^BPST("AD",STATUS)) Q:STATUS>98  D
"RTN","BPSUSCR4",25,0)
 . ; Status of 31 is Insurer Asleep - these will process when insurer wakes up
"RTN","BPSUSCR4",26,0)
 . ; Insurer asleep disabled for Phase III so these should appear on the report for now
"RTN","BPSUSCR4",27,0)
 . ;I STATUS=31 Q
"RTN","BPSUSCR4",28,0)
 . S IEN59=0
"RTN","BPSUSCR4",29,0)
 . F  S IEN59=$O(^BPST("AD",STATUS,IEN59)) Q:'IEN59  D
"RTN","BPSUSCR4",30,0)
 .. S VART=$G(^BPST(IEN59,0)) Q:VART=""
"RTN","BPSUSCR4",31,0)
 .. S LSTUDT=$$GET1^DIQ(TFILE,IEN59,7,"I")
"RTN","BPSUSCR4",32,0)
 .. I LSTUDT<BPBDT!(LSTUDT>BPEDT) Q
"RTN","BPSUSCR4",33,0)
 .. S LSTUDT=$P(LSTUDT,".",1)
"RTN","BPSUSCR4",34,0)
 .. I LSTUDT="" Q
"RTN","BPSUSCR4",35,0)
 .. S RX=$$GET1^DIQ(TFILE,IEN59,1.11)
"RTN","BPSUSCR4",36,0)
 .. S REFILL=$$GET1^DIQ(TFILE,IEN59,9)
"RTN","BPSUSCR4",37,0)
 .. S CD0=$$GET1^DIQ(TFILE,IEN59,3,"I")
"RTN","BPSUSCR4",38,0)
 .. I CD0'="" D
"RTN","BPSUSCR4",39,0)
 ... S FILLDT=$$GET1^DIQ(CFILE,CD0,401),FILLDT=$$HL7TFM^XLFDT(FILLDT)
"RTN","BPSUSCR4",40,0)
 .. I CD0="" D
"RTN","BPSUSCR4",41,0)
 ... S FILLDT=$P($G(^BPST(IEN59,12)),"^",2)
"RTN","BPSUSCR4",42,0)
 .. S NAME=$$GET1^DIQ(TFILE,IEN59,5,"E")
"RTN","BPSUSCR4",43,0)
 .. S SSN="",VART=$G(^BPST(IEN59,0))
"RTN","BPSUSCR4",44,0)
 .. I $P(VART,"^",6)]"" S SSN=$P($G(^DPT($P(VART,"^",6),0)),"^",9),SSN=$E(SSN,$L(SSN)-3,$L(SSN))
"RTN","BPSUSCR4",45,0)
 .. S INSCO=$P($G(^BPST(IEN59,10,1,0)),"^",7)
"RTN","BPSUSCR4",46,0)
 .. S ^TMP($J,1,LSTUDT,IEN59)=NAME_U_SSN_U_RX_U_REFILL_U_FILLDT_U_INSCO_U_STATUS
"RTN","BPSUSCR4",47,0)
 ;
"RTN","BPSUSCR4",48,0)
 ; Now that the data is sorted, format it and build list for display
"RTN","BPSUSCR4",49,0)
 S (SEQ,ITEM)=0
"RTN","BPSUSCR4",50,0)
 S SDT="" F  S SDT=$O(^TMP($J,1,SDT)) Q:SDT=""  D
"RTN","BPSUSCR4",51,0)
 . S IEN59="" F  S IEN59=$O(^TMP($J,1,SDT,IEN59)) Q:IEN59=""  D
"RTN","BPSUSCR4",52,0)
 .. S DATA=$G(^TMP($J,1,SDT,IEN59))
"RTN","BPSUSCR4",53,0)
 .. S LSTUDT=$$FORMAT($$FMTE^XLFDT(SDT,"5Z"),10)
"RTN","BPSUSCR4",54,0)
 .. S NAME=$$FORMAT($P(DATA,U,1),20)
"RTN","BPSUSCR4",55,0)
 .. S SSN=$$FORMAT($P(DATA,U,2),4)
"RTN","BPSUSCR4",56,0)
 .. S RX=$$FORMAT($P(DATA,U,3),12)
"RTN","BPSUSCR4",57,0)
 .. S REFILL=$J($P(DATA,U,4),2)
"RTN","BPSUSCR4",58,0)
 .. S FILLDT=$$FMTE^XLFDT($P(DATA,U,5),"5Z")
"RTN","BPSUSCR4",59,0)
 .. S INSCO=$$FORMAT($P(DATA,U,6),12)
"RTN","BPSUSCR4",60,0)
 .. S SEQ=SEQ+1
"RTN","BPSUSCR4",61,0)
 .. S ITEM=ITEM+1
"RTN","BPSUSCR4",62,0)
 .. S ^TMP("BPSUSCR",$J,SEQ,0)=$J(ITEM,3)_" "_LSTUDT_" "_NAME_" "_SSN_" "_RX_" "_REFILL_" "_FILLDT_" "_INSCO
"RTN","BPSUSCR4",63,0)
 .. S ^TMP($J,2,ITEM,IEN59)=""
"RTN","BPSUSCR4",64,0)
 .. S SEQ=SEQ+1
"RTN","BPSUSCR4",65,0)
 .. S MESSAGE=$$STATI^BPSOSU($P(DATA,U,7))
"RTN","BPSUSCR4",66,0)
 .. I $E(MESSAGE,1)="?" S MESSAGE="Unknown Status"
"RTN","BPSUSCR4",67,0)
 .. S ^TMP("BPSUSCR",$J,SEQ,0)="    In Progress - "_MESSAGE
"RTN","BPSUSCR4",68,0)
 S VALMCNT=SEQ
"RTN","BPSUSCR4",69,0)
 Q
"RTN","BPSUSCR4",70,0)
 ;
"RTN","BPSUSCR4",71,0)
FORMAT(D1,LEN) ;
"RTN","BPSUSCR4",72,0)
 N OUT
"RTN","BPSUSCR4",73,0)
 S D1=$G(D1),LEN=$G(LEN)
"RTN","BPSUSCR4",74,0)
 S D1=$$NOSPACE(D1)
"RTN","BPSUSCR4",75,0)
 S OUT=$E($E(D1,1,LEN)_$J("",LEN),1,LEN)
"RTN","BPSUSCR4",76,0)
 Q OUT
"RTN","BPSUSCR4",77,0)
NOSPACE(VAR) ;
"RTN","BPSUSCR4",78,0)
 N RTN,SEQ,I
"RTN","BPSUSCR4",79,0)
 S RTN=""
"RTN","BPSUSCR4",80,0)
 F I=1:1:$L(VAR," ") I $P(VAR," ",I)'="" S SEQ=$G(SEQ)+1,$P(RTN," ",SEQ)=$P(VAR," ",I)
"RTN","BPSUSCR4",81,0)
 Q RTN
"RTN","BPSUTIL")
0^271^B1870851
"RTN","BPSUTIL",1,0)
BPSUTIL ;BHAM ISC/FLS - General Utility functions ;06/01/2004
"RTN","BPSUTIL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1**;JUN 2004
"RTN","BPSUTIL",3,0)
 Q
"RTN","BPSUTIL",4,0)
DIC19 ; Convert menu item descriptions to upper case
"RTN","BPSUTIL",5,0)
 N DIC,ENT,GLO,TXT,OPT,VAR,NEW,I
"RTN","BPSUTIL",6,0)
 S DIC=19,GLO="^DIC",TXT="BPS"
"RTN","BPSUTIL",7,0)
 F  S TXT=$O(@GLO@(DIC,"B",TXT)) Q:(TXT]"BPT")!(TXT="")  D
"RTN","BPSUTIL",8,0)
 .  S ENT=$O(@GLO@(DIC,"B",TXT,""))
"RTN","BPSUTIL",9,0)
 .  S VAR=$G(@GLO@(DIC,ENT,0)) Q:VAR=""
"RTN","BPSUTIL",10,0)
 .  S OPT=$P(VAR,"^",2),NEW=OPT
"RTN","BPSUTIL",11,0)
 .  F I=1:1:$L(OPT," ") D
"RTN","BPSUTIL",12,0)
 .  .  S $P(NEW," ",I)=$$MAKEUPR($P(OPT," ",I))
"RTN","BPSUTIL",13,0)
 .  W !,"NEW ",NEW
"RTN","BPSUTIL",14,0)
 .  W !,"OLD ",OPT
"RTN","BPSUTIL",15,0)
 .  Q
"RTN","BPSUTIL",16,0)
 Q
"RTN","BPSUTIL",17,0)
 ;
"RTN","BPSUTIL",18,0)
MAKEUPR(X) ;
"RTN","BPSUTIL",19,0)
 N TST,VAL
"RTN","BPSUTIL",20,0)
 S VAL=X
"RTN","BPSUTIL",21,0)
 S TST=$$UPPER(X)
"RTN","BPSUTIL",22,0)
 I $L(TST)>2,"|THE|FOR|NOW|AND|FOR|"'[("|"_TST_"|") S $E(VAL)=$$UPPER($E(VAL))
"RTN","BPSUTIL",23,0)
 Q VAL
"RTN","BPSUTIL",24,0)
 ;
"RTN","BPSUTIL",25,0)
UPPER(X) ;
"RTN","BPSUTIL",26,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSUTIL",27,0)
 ;
"RTN","BPSUTIL",28,0)
ECMEON(SITE) ; - Returns 1 if ECME is turned ON or 0 if not
"RTN","BPSUTIL",29,0)
 ; SITE - Pointer to #59 (OUTPATIENT SITE)
"RTN","BPSUTIL",30,0)
 Q:'$G(SITE) 0
"RTN","BPSUTIL",31,0)
 I $D(^BPS(9002313.56,"C",SITE)) Q 1
"RTN","BPSUTIL",32,0)
 Q 0
"RTN","BPSUTIL",33,0)
 ;
"RTN","BPSUTIL",34,0)
CMOPON(SITE) ; - Returns 1 if CMOP is turned ON for ECME or 0 if not
"RTN","BPSUTIL",35,0)
 ; SITE - Pointer to #59 (OUTPATIENT SITE)
"RTN","BPSUTIL",36,0)
 Q:'$G(SITE) 0
"RTN","BPSUTIL",37,0)
 N PHRM
"RTN","BPSUTIL",38,0)
 S PHRM=$O(^BPS(9002313.56,"C",SITE,0)) I 'PHRM Q 0
"RTN","BPSUTIL",39,0)
 Q $$GET1^DIQ(9002313.56,PHRM,1,"I")
"SEC","^DIC",9002313.02,9002313.02,0,"AUDIT")
@
"SEC","^DIC",9002313.02,9002313.02,0,"DD")
@
"SEC","^DIC",9002313.02,9002313.02,0,"DEL")
@
"SEC","^DIC",9002313.02,9002313.02,0,"LAYGO")
@
"SEC","^DIC",9002313.02,9002313.02,0,"RD")
Pp
"SEC","^DIC",9002313.02,9002313.02,0,"WR")
@
"SEC","^DIC",9002313.03,9002313.03,0,"AUDIT")
@
"SEC","^DIC",9002313.03,9002313.03,0,"DD")
@
"SEC","^DIC",9002313.03,9002313.03,0,"DEL")
@
"SEC","^DIC",9002313.03,9002313.03,0,"LAYGO")
@
"SEC","^DIC",9002313.03,9002313.03,0,"RD")
Pp
"SEC","^DIC",9002313.03,9002313.03,0,"WR")
@
"SEC","^DIC",9002313.1,9002313.1,0,"AUDIT")
@
"SEC","^DIC",9002313.1,9002313.1,0,"DD")
@
"SEC","^DIC",9002313.1,9002313.1,0,"DEL")
@
"SEC","^DIC",9002313.1,9002313.1,0,"LAYGO")
@
"SEC","^DIC",9002313.1,9002313.1,0,"RD")
Pp
"SEC","^DIC",9002313.1,9002313.1,0,"WR")
@
"SEC","^DIC",9002313.21,9002313.21,0,"AUDIT")
@
"SEC","^DIC",9002313.21,9002313.21,0,"DD")
@
"SEC","^DIC",9002313.21,9002313.21,0,"DEL")
@
"SEC","^DIC",9002313.21,9002313.21,0,"LAYGO")
@
"SEC","^DIC",9002313.21,9002313.21,0,"RD")
@
"SEC","^DIC",9002313.21,9002313.21,0,"WR")
@
"SEC","^DIC",9002313.22,9002313.22,0,"AUDIT")
@
"SEC","^DIC",9002313.22,9002313.22,0,"DD")
@
"SEC","^DIC",9002313.22,9002313.22,0,"DEL")
@
"SEC","^DIC",9002313.22,9002313.22,0,"LAYGO")
@
"SEC","^DIC",9002313.22,9002313.22,0,"RD")
@
"SEC","^DIC",9002313.22,9002313.22,0,"WR")
@
"SEC","^DIC",9002313.23,9002313.23,0,"AUDIT")
@
"SEC","^DIC",9002313.23,9002313.23,0,"DD")
@
"SEC","^DIC",9002313.23,9002313.23,0,"DEL")
@
"SEC","^DIC",9002313.23,9002313.23,0,"LAYGO")
@
"SEC","^DIC",9002313.23,9002313.23,0,"RD")
@
"SEC","^DIC",9002313.23,9002313.23,0,"WR")
@
"SEC","^DIC",9002313.24,9002313.24,0,"AUDIT")
@
"SEC","^DIC",9002313.24,9002313.24,0,"DD")
@
"SEC","^DIC",9002313.24,9002313.24,0,"DEL")
@
"SEC","^DIC",9002313.24,9002313.24,0,"LAYGO")
@
"SEC","^DIC",9002313.24,9002313.24,0,"RD")
@
"SEC","^DIC",9002313.24,9002313.24,0,"WR")
@
"SEC","^DIC",9002313.31,9002313.31,0,"AUDIT")
@
"SEC","^DIC",9002313.31,9002313.31,0,"DD")
@
"SEC","^DIC",9002313.31,9002313.31,0,"DEL")
@
"SEC","^DIC",9002313.31,9002313.31,0,"LAYGO")
@
"SEC","^DIC",9002313.31,9002313.31,0,"RD")
Pp
"SEC","^DIC",9002313.31,9002313.31,0,"WR")
@
"SEC","^DIC",9002313.4,9002313.4,0,"AUDIT")
@
"SEC","^DIC",9002313.4,9002313.4,0,"DD")
@
"SEC","^DIC",9002313.4,9002313.4,0,"DEL")
@
"SEC","^DIC",9002313.4,9002313.4,0,"LAYGO")
@
"SEC","^DIC",9002313.4,9002313.4,0,"RD")
Pp
"SEC","^DIC",9002313.4,9002313.4,0,"WR")
@
"SEC","^DIC",9002313.51,9002313.51,0,"AUDIT")
@
"SEC","^DIC",9002313.51,9002313.51,0,"DD")
@
"SEC","^DIC",9002313.51,9002313.51,0,"DEL")
@
"SEC","^DIC",9002313.51,9002313.51,0,"LAYGO")
@
"SEC","^DIC",9002313.51,9002313.51,0,"RD")
Pp
"SEC","^DIC",9002313.51,9002313.51,0,"WR")
@
"SEC","^DIC",9002313.511,9002313.511,0,"AUDIT")
@
"SEC","^DIC",9002313.511,9002313.511,0,"DD")
@
"SEC","^DIC",9002313.511,9002313.511,0,"DEL")
@
"SEC","^DIC",9002313.511,9002313.511,0,"LAYGO")
@
"SEC","^DIC",9002313.511,9002313.511,0,"RD")
Pp
"SEC","^DIC",9002313.511,9002313.511,0,"WR")
@
"SEC","^DIC",9002313.515,9002313.515,0,"AUDIT")
@
"SEC","^DIC",9002313.515,9002313.515,0,"DD")
@
"SEC","^DIC",9002313.515,9002313.515,0,"DEL")
@
"SEC","^DIC",9002313.515,9002313.515,0,"LAYGO")
@
"SEC","^DIC",9002313.515,9002313.515,0,"RD")
Pp
"SEC","^DIC",9002313.515,9002313.515,0,"WR")
@
"SEC","^DIC",9002313.516,9002313.516,0,"AUDIT")
@
"SEC","^DIC",9002313.516,9002313.516,0,"DD")
@
"SEC","^DIC",9002313.516,9002313.516,0,"DEL")
@
"SEC","^DIC",9002313.516,9002313.516,0,"LAYGO")
@
"SEC","^DIC",9002313.516,9002313.516,0,"RD")
Pp
"SEC","^DIC",9002313.516,9002313.516,0,"WR")
@
"SEC","^DIC",9002313.53,9002313.53,0,"AUDIT")
@
"SEC","^DIC",9002313.53,9002313.53,0,"DD")
@
"SEC","^DIC",9002313.53,9002313.53,0,"DEL")
@
"SEC","^DIC",9002313.53,9002313.53,0,"LAYGO")
@
"SEC","^DIC",9002313.53,9002313.53,0,"RD")
Pp
"SEC","^DIC",9002313.53,9002313.53,0,"WR")
@
"SEC","^DIC",9002313.55,9002313.55,0,"AUDIT")
@
"SEC","^DIC",9002313.55,9002313.55,0,"DD")
@
"SEC","^DIC",9002313.55,9002313.55,0,"DEL")
@
"SEC","^DIC",9002313.55,9002313.55,0,"LAYGO")
@
"SEC","^DIC",9002313.55,9002313.55,0,"RD")
Pp
"SEC","^DIC",9002313.55,9002313.55,0,"WR")
@
"SEC","^DIC",9002313.56,9002313.56,0,"AUDIT")
@
"SEC","^DIC",9002313.56,9002313.56,0,"DD")
@
"SEC","^DIC",9002313.56,9002313.56,0,"DEL")
@
"SEC","^DIC",9002313.56,9002313.56,0,"LAYGO")
@
"SEC","^DIC",9002313.56,9002313.56,0,"RD")
Pp
"SEC","^DIC",9002313.56,9002313.56,0,"WR")
@
"SEC","^DIC",9002313.57,9002313.57,0,"AUDIT")
@
"SEC","^DIC",9002313.57,9002313.57,0,"DD")
@
"SEC","^DIC",9002313.57,9002313.57,0,"DEL")
@
"SEC","^DIC",9002313.57,9002313.57,0,"LAYGO")
@
"SEC","^DIC",9002313.57,9002313.57,0,"RD")
Pp
"SEC","^DIC",9002313.57,9002313.57,0,"WR")
@
"SEC","^DIC",9002313.58,9002313.58,0,"AUDIT")
@
"SEC","^DIC",9002313.58,9002313.58,0,"DD")
@
"SEC","^DIC",9002313.58,9002313.58,0,"DEL")
@
"SEC","^DIC",9002313.58,9002313.58,0,"LAYGO")
@
"SEC","^DIC",9002313.58,9002313.58,0,"RD")
Pp
"SEC","^DIC",9002313.58,9002313.58,0,"WR")
@
"SEC","^DIC",9002313.59,9002313.59,0,"AUDIT")
@
"SEC","^DIC",9002313.59,9002313.59,0,"DD")
@
"SEC","^DIC",9002313.59,9002313.59,0,"DEL")
@
"SEC","^DIC",9002313.59,9002313.59,0,"LAYGO")
@
"SEC","^DIC",9002313.59,9002313.59,0,"RD")
Pp
"SEC","^DIC",9002313.59,9002313.59,0,"WR")
@
"SEC","^DIC",9002313.61,9002313.61,0,"AUDIT")
@
"SEC","^DIC",9002313.61,9002313.61,0,"DD")
@
"SEC","^DIC",9002313.61,9002313.61,0,"DEL")
@
"SEC","^DIC",9002313.61,9002313.61,0,"LAYGO")
@
"SEC","^DIC",9002313.61,9002313.61,0,"RD")
pP
"SEC","^DIC",9002313.61,9002313.61,0,"WR")
@
"SEC","^DIC",9002313.81,9002313.81,0,"AUDIT")
@
"SEC","^DIC",9002313.81,9002313.81,0,"DD")
@
"SEC","^DIC",9002313.81,9002313.81,0,"DEL")
@
"SEC","^DIC",9002313.81,9002313.81,0,"LAYGO")
@
"SEC","^DIC",9002313.81,9002313.81,0,"RD")
Pp
"SEC","^DIC",9002313.81,9002313.81,0,"WR")
@
"SEC","^DIC",9002313.82103,9002313.82103,0,"AUDIT")
@
"SEC","^DIC",9002313.82103,9002313.82103,0,"DD")
@
"SEC","^DIC",9002313.82103,9002313.82103,0,"DEL")
@
"SEC","^DIC",9002313.82103,9002313.82103,0,"LAYGO")
@
"SEC","^DIC",9002313.82103,9002313.82103,0,"RD")
Pp
"SEC","^DIC",9002313.82103,9002313.82103,0,"WR")
@
"SEC","^DIC",9002313.82305,9002313.82305,0,"AUDIT")
@
"SEC","^DIC",9002313.82305,9002313.82305,0,"DD")
@
"SEC","^DIC",9002313.82305,9002313.82305,0,"DEL")
@
"SEC","^DIC",9002313.82305,9002313.82305,0,"LAYGO")
@
"SEC","^DIC",9002313.82305,9002313.82305,0,"RD")
Pp
"SEC","^DIC",9002313.82305,9002313.82305,0,"WR")
@
"SEC","^DIC",9002313.82306,9002313.82306,0,"AUDIT")
@
"SEC","^DIC",9002313.82306,9002313.82306,0,"DD")
@
"SEC","^DIC",9002313.82306,9002313.82306,0,"DEL")
@
"SEC","^DIC",9002313.82306,9002313.82306,0,"LAYGO")
@
"SEC","^DIC",9002313.82306,9002313.82306,0,"RD")
Pp
"SEC","^DIC",9002313.82306,9002313.82306,0,"WR")
@
"SEC","^DIC",9002313.82307,9002313.82307,0,"AUDIT")
@
"SEC","^DIC",9002313.82307,9002313.82307,0,"DD")
@
"SEC","^DIC",9002313.82307,9002313.82307,0,"DEL")
@
"SEC","^DIC",9002313.82307,9002313.82307,0,"LAYGO")
@
"SEC","^DIC",9002313.82307,9002313.82307,0,"RD")
Pp
"SEC","^DIC",9002313.82307,9002313.82307,0,"WR")
@
"SEC","^DIC",9002313.82308,9002313.82308,0,"AUDIT")
@
"SEC","^DIC",9002313.82308,9002313.82308,0,"DD")
@
"SEC","^DIC",9002313.82308,9002313.82308,0,"DEL")
@
"SEC","^DIC",9002313.82308,9002313.82308,0,"LAYGO")
@
"SEC","^DIC",9002313.82308,9002313.82308,0,"RD")
pP
"SEC","^DIC",9002313.82308,9002313.82308,0,"WR")
@
"SEC","^DIC",9002313.82309,9002313.82309,0,"AUDIT")
@
"SEC","^DIC",9002313.82309,9002313.82309,0,"DD")
@
"SEC","^DIC",9002313.82309,9002313.82309,0,"DEL")
@
"SEC","^DIC",9002313.82309,9002313.82309,0,"LAYGO")
@
"SEC","^DIC",9002313.82309,9002313.82309,0,"RD")
Pp
"SEC","^DIC",9002313.82309,9002313.82309,0,"WR")
@
"SEC","^DIC",9002313.82406,9002313.82406,0,"AUDIT")
@
"SEC","^DIC",9002313.82406,9002313.82406,0,"DD")
@
"SEC","^DIC",9002313.82406,9002313.82406,0,"DEL")
@
"SEC","^DIC",9002313.82406,9002313.82406,0,"LAYGO")
@
"SEC","^DIC",9002313.82406,9002313.82406,0,"RD")
Pp
"SEC","^DIC",9002313.82406,9002313.82406,0,"WR")
@
"SEC","^DIC",9002313.82408,9002313.82408,0,"AUDIT")
@
"SEC","^DIC",9002313.82408,9002313.82408,0,"DD")
@
"SEC","^DIC",9002313.82408,9002313.82408,0,"DEL")
@
"SEC","^DIC",9002313.82408,9002313.82408,0,"LAYGO")
@
"SEC","^DIC",9002313.82408,9002313.82408,0,"RD")
Pp
"SEC","^DIC",9002313.82408,9002313.82408,0,"WR")
@
"SEC","^DIC",9002313.82416,9002313.82416,0,"AUDIT")
@
"SEC","^DIC",9002313.82416,9002313.82416,0,"DD")
@
"SEC","^DIC",9002313.82416,9002313.82416,0,"DEL")
@
"SEC","^DIC",9002313.82416,9002313.82416,0,"LAYGO")
@
"SEC","^DIC",9002313.82416,9002313.82416,0,"RD")
Pp
"SEC","^DIC",9002313.82416,9002313.82416,0,"WR")
@
"SEC","^DIC",9002313.82419,9002313.82419,0,"AUDIT")
@
"SEC","^DIC",9002313.82419,9002313.82419,0,"DD")
@
"SEC","^DIC",9002313.82419,9002313.82419,0,"DEL")
Pp
"SEC","^DIC",9002313.82419,9002313.82419,0,"LAYGO")
@
"SEC","^DIC",9002313.82419,9002313.82419,0,"RD")
@
"SEC","^DIC",9002313.82419,9002313.82419,0,"WR")
@
"SEC","^DIC",9002313.8242,9002313.8242,0,"AUDIT")
@
"SEC","^DIC",9002313.8242,9002313.8242,0,"DD")
@
"SEC","^DIC",9002313.8242,9002313.8242,0,"DEL")
@
"SEC","^DIC",9002313.8242,9002313.8242,0,"LAYGO")
@
"SEC","^DIC",9002313.8242,9002313.8242,0,"RD")
Pp
"SEC","^DIC",9002313.8242,9002313.8242,0,"WR")
@
"SEC","^DIC",9002313.82423,9002313.82423,0,"AUDIT")
@
"SEC","^DIC",9002313.82423,9002313.82423,0,"DD")
@
"SEC","^DIC",9002313.82423,9002313.82423,0,"DEL")
@
"SEC","^DIC",9002313.82423,9002313.82423,0,"LAYGO")
@
"SEC","^DIC",9002313.82423,9002313.82423,0,"RD")
Pp
"SEC","^DIC",9002313.82423,9002313.82423,0,"WR")
@
"SEC","^DIC",9002313.82425,9002313.82425,0,"AUDIT")
@
"SEC","^DIC",9002313.82425,9002313.82425,0,"DD")
@
"SEC","^DIC",9002313.82425,9002313.82425,0,"DEL")
@
"SEC","^DIC",9002313.82425,9002313.82425,0,"LAYGO")
@
"SEC","^DIC",9002313.82425,9002313.82425,0,"RD")
Pp
"SEC","^DIC",9002313.82425,9002313.82425,0,"WR")
@
"SEC","^DIC",9002313.82429,9002313.82429,0,"AUDIT")
@
"SEC","^DIC",9002313.82429,9002313.82429,0,"DD")
@
"SEC","^DIC",9002313.82429,9002313.82429,0,"DEL")
@
"SEC","^DIC",9002313.82429,9002313.82429,0,"LAYGO")
@
"SEC","^DIC",9002313.82429,9002313.82429,0,"RD")
Pp
"SEC","^DIC",9002313.82429,9002313.82429,0,"WR")
@
"SEC","^DIC",9002313.82432,9002313.82432,0,"AUDIT")
@
"SEC","^DIC",9002313.82432,9002313.82432,0,"DD")
@
"SEC","^DIC",9002313.82432,9002313.82432,0,"DEL")
@
"SEC","^DIC",9002313.82432,9002313.82432,0,"LAYGO")
@
"SEC","^DIC",9002313.82432,9002313.82432,0,"RD")
Pp
"SEC","^DIC",9002313.82432,9002313.82432,0,"WR")
@
"SEC","^DIC",9002313.82436,9002313.82436,0,"AUDIT")
@
"SEC","^DIC",9002313.82436,9002313.82436,0,"DD")
@
"SEC","^DIC",9002313.82436,9002313.82436,0,"DEL")
@
"SEC","^DIC",9002313.82436,9002313.82436,0,"LAYGO")
@
"SEC","^DIC",9002313.82436,9002313.82436,0,"RD")
Pp
"SEC","^DIC",9002313.82436,9002313.82436,0,"WR")
@
"SEC","^DIC",9002313.82439,9002313.82439,0,"AUDIT")
@
"SEC","^DIC",9002313.82439,9002313.82439,0,"DD")
@
"SEC","^DIC",9002313.82439,9002313.82439,0,"DEL")
@
"SEC","^DIC",9002313.82439,9002313.82439,0,"LAYGO")
@
"SEC","^DIC",9002313.82439,9002313.82439,0,"RD")
Pp
"SEC","^DIC",9002313.82439,9002313.82439,0,"WR")
@
"SEC","^DIC",9002313.8244,9002313.8244,0,"AUDIT")
@
"SEC","^DIC",9002313.8244,9002313.8244,0,"DD")
@
"SEC","^DIC",9002313.8244,9002313.8244,0,"DEL")
@
"SEC","^DIC",9002313.8244,9002313.8244,0,"LAYGO")
@
"SEC","^DIC",9002313.8244,9002313.8244,0,"RD")
Pp
"SEC","^DIC",9002313.8244,9002313.8244,0,"WR")
@
"SEC","^DIC",9002313.82441,9002313.82441,0,"AUDIT")
@
"SEC","^DIC",9002313.82441,9002313.82441,0,"DD")
@
"SEC","^DIC",9002313.82441,9002313.82441,0,"DEL")
@
"SEC","^DIC",9002313.82441,9002313.82441,0,"LAYGO")
@
"SEC","^DIC",9002313.82441,9002313.82441,0,"RD")
Pp
"SEC","^DIC",9002313.82441,9002313.82441,0,"WR")
@
"SEC","^DIC",9002313.82501,9002313.82501,0,"AUDIT")
@
"SEC","^DIC",9002313.82501,9002313.82501,0,"DD")
@
"SEC","^DIC",9002313.82501,9002313.82501,0,"DEL")
@
"SEC","^DIC",9002313.82501,9002313.82501,0,"LAYGO")
@
"SEC","^DIC",9002313.82501,9002313.82501,0,"RD")
Pp
"SEC","^DIC",9002313.82501,9002313.82501,0,"WR")
@
"SEC","^DIC",9002313.82522,9002313.82522,0,"AUDIT")
@
"SEC","^DIC",9002313.82522,9002313.82522,0,"DD")
@
"SEC","^DIC",9002313.82522,9002313.82522,0,"DEL")
@
"SEC","^DIC",9002313.82522,9002313.82522,0,"LAYGO")
@
"SEC","^DIC",9002313.82522,9002313.82522,0,"RD")
Pp
"SEC","^DIC",9002313.82522,9002313.82522,0,"WR")
@
"SEC","^DIC",9002313.82528,9002313.82528,0,"AUDIT")
@
"SEC","^DIC",9002313.82528,9002313.82528,0,"DD")
@
"SEC","^DIC",9002313.82528,9002313.82528,0,"DEL")
@
"SEC","^DIC",9002313.82528,9002313.82528,0,"LAYGO")
@
"SEC","^DIC",9002313.82528,9002313.82528,0,"RD")
Pp
"SEC","^DIC",9002313.82528,9002313.82528,0,"WR")
@
"SEC","^DIC",9002313.82529,9002313.82529,0,"AUDIT")
@
"SEC","^DIC",9002313.82529,9002313.82529,0,"DD")
@
"SEC","^DIC",9002313.82529,9002313.82529,0,"DEL")
@
"SEC","^DIC",9002313.82529,9002313.82529,0,"LAYGO")
@
"SEC","^DIC",9002313.82529,9002313.82529,0,"RD")
Pp
"SEC","^DIC",9002313.82529,9002313.82529,0,"WR")
@
"SEC","^DIC",9002313.82532,9002313.82532,0,"AUDIT")
@
"SEC","^DIC",9002313.82532,9002313.82532,0,"DD")
@
"SEC","^DIC",9002313.82532,9002313.82532,0,"DEL")
@
"SEC","^DIC",9002313.82532,9002313.82532,0,"LAYGO")
@
"SEC","^DIC",9002313.82532,9002313.82532,0,"RD")
Pp
"SEC","^DIC",9002313.82532,9002313.82532,0,"WR")
@
"SEC","^DIC",9002313.82533,9002313.82533,0,"AUDIT")
@
"SEC","^DIC",9002313.82533,9002313.82533,0,"DD")
@
"SEC","^DIC",9002313.82533,9002313.82533,0,"DEL")
@
"SEC","^DIC",9002313.82533,9002313.82533,0,"LAYGO")
@
"SEC","^DIC",9002313.82533,9002313.82533,0,"RD")
Pp
"SEC","^DIC",9002313.82533,9002313.82533,0,"WR")
@
"SEC","^DIC",9002313.82535,9002313.82535,0,"AUDIT")
@
"SEC","^DIC",9002313.82535,9002313.82535,0,"DD")
@
"SEC","^DIC",9002313.82535,9002313.82535,0,"DEL")
@
"SEC","^DIC",9002313.82535,9002313.82535,0,"LAYGO")
@
"SEC","^DIC",9002313.82535,9002313.82535,0,"RD")
Pp
"SEC","^DIC",9002313.82535,9002313.82535,0,"WR")
@
"SEC","^DIC",9002313.83,9002313.83,0,"AUDIT")
@
"SEC","^DIC",9002313.83,9002313.83,0,"DD")
@
"SEC","^DIC",9002313.83,9002313.83,0,"DEL")
@
"SEC","^DIC",9002313.83,9002313.83,0,"LAYGO")
@
"SEC","^DIC",9002313.83,9002313.83,0,"RD")
Pp
"SEC","^DIC",9002313.83,9002313.83,0,"WR")
@
"SEC","^DIC",9002313.89,9002313.89,0,"AUDIT")
@
"SEC","^DIC",9002313.89,9002313.89,0,"DD")
@
"SEC","^DIC",9002313.89,9002313.89,0,"DEL")
@
"SEC","^DIC",9002313.89,9002313.89,0,"LAYGO")
@
"SEC","^DIC",9002313.89,9002313.89,0,"RD")
Pp
"SEC","^DIC",9002313.89,9002313.89,0,"WR")
@
"SEC","^DIC",9002313.91,9002313.91,0,"AUDIT")
@
"SEC","^DIC",9002313.91,9002313.91,0,"DD")
@
"SEC","^DIC",9002313.91,9002313.91,0,"DEL")
@
"SEC","^DIC",9002313.91,9002313.91,0,"LAYGO")
@
"SEC","^DIC",9002313.91,9002313.91,0,"RD")
Pp
"SEC","^DIC",9002313.91,9002313.91,0,"WR")
@
"SEC","^DIC",9002313.92,9002313.92,0,"AUDIT")
@
"SEC","^DIC",9002313.92,9002313.92,0,"DD")
@
"SEC","^DIC",9002313.92,9002313.92,0,"DEL")
@
"SEC","^DIC",9002313.92,9002313.92,0,"LAYGO")
@
"SEC","^DIC",9002313.92,9002313.92,0,"RD")
Pp
"SEC","^DIC",9002313.92,9002313.92,0,"WR")
@
"SEC","^DIC",9002313.93,9002313.93,0,"AUDIT")
@
"SEC","^DIC",9002313.93,9002313.93,0,"DD")
@
"SEC","^DIC",9002313.93,9002313.93,0,"DEL")
@
"SEC","^DIC",9002313.93,9002313.93,0,"LAYGO")
@
"SEC","^DIC",9002313.93,9002313.93,0,"RD")
Pp
"SEC","^DIC",9002313.93,9002313.93,0,"WR")
@
"SEC","^DIC",9002313.94,9002313.94,0,"AUDIT")
@
"SEC","^DIC",9002313.94,9002313.94,0,"DD")
@
"SEC","^DIC",9002313.94,9002313.94,0,"DEL")
@
"SEC","^DIC",9002313.94,9002313.94,0,"LAYGO")
@
"SEC","^DIC",9002313.94,9002313.94,0,"RD")
Pp
"SEC","^DIC",9002313.94,9002313.94,0,"WR")
@
"VER")
8.0^22.0
"^DD",9002313.02,9002313.02,0)
FIELD^^9999^61
"^DD",9002313.02,9002313.02,0,"DDA")
N
"^DD",9002313.02,9002313.02,0,"DT")
3060118
"^DD",9002313.02,9002313.02,0,"IX","AD",9002313.02,.04)

"^DD",9002313.02,9002313.02,0,"IX","AE",9002313.02,.05)

"^DD",9002313.02,9002313.02,0,"IX","AF",9002313.02,401)

"^DD",9002313.02,9002313.02,0,"IX","AG",9002313.02,902)

"^DD",9002313.02,9002313.02,0,"IX","B",9002313.02,.01)

"^DD",9002313.02,9002313.02,0,"IX","C",9002313.02,1.01)

"^DD",9002313.02,9002313.02,0,"IX","D",9002313.02,1.02)

"^DD",9002313.02,9002313.02,0,"IX","E",9002313.02,1.03)

"^DD",9002313.02,9002313.02,0,"NM","BPS CLAIMS")

"^DD",9002313.02,9002313.02,0,"PT",9002313.03,.01)

"^DD",9002313.02,9002313.02,0,"PT",9002313.31,.03)

"^DD",9002313.02,9002313.02,0,"PT",9002313.57,3)

"^DD",9002313.02,9002313.02,0,"PT",9002313.57,401)

"^DD",9002313.02,9002313.02,0,"PT",9002313.59,3)

"^DD",9002313.02,9002313.02,0,"PT",9002313.59,401)

"^DD",9002313.02,9002313.02,0,"VRPK")
BPS
"^DD",9002313.02,9002313.02,.01,0)
Claim ID^F^^0;1^K:$L(X)>32!($L(X)<1) X
"^DD",9002313.02,9002313.02,.01,1,0)
^.1
"^DD",9002313.02,9002313.02,.01,1,1,0)
9002313.02^B^MUMPS
"^DD",9002313.02,9002313.02,.01,1,1,1)
S ^BPSC("B",$E(X,1,32),DA)=""
"^DD",9002313.02,9002313.02,.01,1,1,2)
K ^BPSC("B",$E(X,1,32),DA)
"^DD",9002313.02,9002313.02,.01,1,1,"DT")
3030725
"^DD",9002313.02,9002313.02,.01,3)
Answer must be 1-32 characters in length.
"^DD",9002313.02,9002313.02,.01,21,0)
^.001^4^4^3040428^^^
"^DD",9002313.02,9002313.02,.01,21,1,0)
External Claim ID value.  This is a pointer to the ID field of the BPS 
"^DD",9002313.02,9002313.02,.01,21,2,0)
RESPONSES FILE (#9002313.03).  This value is a concatenation of a prefix 
"^DD",9002313.02,9002313.02,.01,21,3,0)
of the text 'VA' along with the claim year, the service provider ID,the
"^DD",9002313.02,9002313.02,.01,21,4,0)
BIN number and the last seven digits of the prescription IEN.
"^DD",9002313.02,9002313.02,.01,"DT")
3031124
"^DD",9002313.02,9002313.02,.02,0)
Electronic payor^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.02,9002313.02,.02,3)
Enter the payer sheet for the claim
"^DD",9002313.02,9002313.02,.02,21,0)
^^1^1^3050729^
"^DD",9002313.02,9002313.02,.02,21,1,0)
This is the payer sheet used by the claim
"^DD",9002313.02,9002313.02,.02,"DT")
3050729
"^DD",9002313.02,9002313.02,.04,0)
Transmit Flag^S^1:YES (BATCH FILE);0:NO;2:YES (POINT OF SALE);^0;4^Q
"^DD",9002313.02,9002313.02,.04,1,0)
^.1
"^DD",9002313.02,9002313.02,.04,1,1,0)
9002313.02^AD
"^DD",9002313.02,9002313.02,.04,1,1,1)
S ^BPSC("AD",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,.04,1,1,2)
K ^BPSC("AD",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,.04,1,1,"DT")
2950524
"^DD",9002313.02,9002313.02,.04,21,0)
^.001^2^2^3050316^^
"^DD",9002313.02,9002313.02,.04,21,1,0)
Numerical code to indicate a transmit status.  Current values are 0 for 
"^DD",9002313.02,9002313.02,.04,21,2,0)
'No' 1 for 'Yes' Batch and 2 for 'Yes' Point of Sale.
"^DD",9002313.02,9002313.02,.04,"DT")
3031119
"^DD",9002313.02,9002313.02,.05,0)
Transmitted On^DO^^0;5^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.02,9002313.02,.05,.1)
'
"^DD",9002313.02,9002313.02,.05,1,0)
^.1
"^DD",9002313.02,9002313.02,.05,1,1,0)
9002313.02^AE
"^DD",9002313.02,9002313.02,.05,1,1,1)
S ^BPSC("AE",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,.05,1,1,2)
K ^BPSC("AE",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,.05,1,1,"DT")
2950622
"^DD",9002313.02,9002313.02,.05,2)
S Y(0)=Y S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.05,2.1)
S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.05,21,0)
^.001^1^1^3050316^^
"^DD",9002313.02,9002313.02,.05,21,1,0)
Date on which the data was transmitted.
"^DD",9002313.02,9002313.02,.05,"DT")
3031119
"^DD",9002313.02,9002313.02,.06,0)
Created On^DO^^0;6^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.02,9002313.02,.06,2)
S Y(0)=Y S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.06,2.1)
S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.06,21,0)
^^1^1^3031125^^
"^DD",9002313.02,9002313.02,.06,21,1,0)
Date on which this record was created.
"^DD",9002313.02,9002313.02,.06,"DT")
3031125
"^DD",9002313.02,9002313.02,.07,0)
AUTO REVERSE FLAG^S^0:NO;1:UNRELEASED CLAIM;2:INPATIENT CLAIM;^0;7^Q
"^DD",9002313.02,9002313.02,.07,3)
If auto-reversed, enter the type of auto-reversal
"^DD",9002313.02,9002313.02,.07,21,0)
^^3^3^3060105^
"^DD",9002313.02,9002313.02,.07,21,1,0)
This flag is marking ECME Claims that were automatically reversed because 
"^DD",9002313.02,9002313.02,.07,21,2,0)
the Prescription was not released in time or the claim was an inpatient 
"^DD",9002313.02,9002313.02,.07,21,3,0)
claim.
"^DD",9002313.02,9002313.02,.07,"DT")
3060105
"^DD",9002313.02,9002313.02,1.01,0)
Patient Name^F^^1;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X
"^DD",9002313.02,9002313.02,1.01,1,0)
^.1
"^DD",9002313.02,9002313.02,1.01,1,1,0)
9002313.02^C
"^DD",9002313.02,9002313.02,1.01,1,1,1)
S ^BPSC("C",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,1.01,1,1,2)
K ^BPSC("C",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,1.01,1,1,"DT")
2950606
"^DD",9002313.02,9002313.02,1.01,3)
Answer must be 1-30 characters in length.
"^DD",9002313.02,9002313.02,1.01,21,0)
^^2^2^3040331^
"^DD",9002313.02,9002313.02,1.01,21,1,0)
Patient name extracted from the VA patient file.  This entry is free text 
"^DD",9002313.02,9002313.02,1.01,21,2,0)
to accommodate the NCPDP formatting requirements.
"^DD",9002313.02,9002313.02,1.01,"DT")
3040331
"^DD",9002313.02,9002313.02,1.02,0)
Billing Item PCN #^F^^1;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.02,9002313.02,1.02,1,0)
^.1
"^DD",9002313.02,9002313.02,1.02,1,1,0)
9002313.02^D
"^DD",9002313.02,9002313.02,1.02,1,1,1)
S ^BPSC("D",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,1.02,1,1,2)
K ^BPSC("D",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,1.02,1,1,"DT")
2950606
"^DD",9002313.02,9002313.02,1.02,3)
Answer must be 1-30 characters in length
"^DD",9002313.02,9002313.02,1.02,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,1.02,21,1,0)
The prescription number for this claim.
"^DD",9002313.02,9002313.02,1.02,"DT")
3031124
"^DD",9002313.02,9002313.02,1.03,0)
Billing Item VCN #^F^^1;3^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X
"^DD",9002313.02,9002313.02,1.03,1,0)
^.1
"^DD",9002313.02,9002313.02,1.03,1,1,0)
9002313.02^E
"^DD",9002313.02,9002313.02,1.03,1,1,1)
S ^BPSC("E",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,1.03,1,1,2)
K ^BPSC("E",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,1.03,1,1,"DT")
2950606
"^DD",9002313.02,9002313.02,1.03,3)
Answer must be 1-30 characters in length.
"^DD",9002313.02,9002313.02,1.03,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,1.03,21,1,0)
VA Claim number for this claim.
"^DD",9002313.02,9002313.02,1.03,"DT")
3031124
"^DD",9002313.02,9002313.02,1.04,0)
VA PLAN IEN^F^^1;4^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.02,9002313.02,1.04,3)
Answer must be 1-30 characters in length.
"^DD",9002313.02,9002313.02,1.04,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,1.04,21,1,0)
Internal identifier number for the VA Plan Code.
"^DD",9002313.02,9002313.02,1.04,"DT")
3031124
"^DD",9002313.02,9002313.02,101,0)
BIN Number^F^^100;1^K:$L(X)>6!($L(X)<6) X
"^DD",9002313.02,9002313.02,101,3)
Answer must be 6 characters in length.
"^DD",9002313.02,9002313.02,101,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,101,21,1,0)
Card Issuer ID or Bank ID Number used for network routing.
"^DD",9002313.02,9002313.02,101,"DT")
3031124
"^DD",9002313.02,9002313.02,102,0)
Version/Release Number^F^^100;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,102,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,102,21,0)
^^2^2^3031124^
"^DD",9002313.02,9002313.02,102,21,1,0)
Code identifying the Enrollment Standard format of the file sent or 
"^DD",9002313.02,9002313.02,102,21,2,0)
received.
"^DD",9002313.02,9002313.02,102,"DT")
3031124
"^DD",9002313.02,9002313.02,103,0)
Transaction Code^F^^100;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,103,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,103,21,0)
^^15^15^3031124^
"^DD",9002313.02,9002313.02,103,21,1,0)
Code to identify the transaction type for this claim.
"^DD",9002313.02,9002313.02,103,21,2,0)
E1=Eligibility Verification
"^DD",9002313.02,9002313.02,103,21,3,0)
B1=Billing
"^DD",9002313.02,9002313.02,103,21,4,0)
B2=Reversal
"^DD",9002313.02,9002313.02,103,21,5,0)
B3=Rebill
"^DD",9002313.02,9002313.02,103,21,6,0)
P1=P.A. Request & Billing
"^DD",9002313.02,9002313.02,103,21,7,0)
P2=P.A. Reversal
"^DD",9002313.02,9002313.02,103,21,8,0)
P3=P.A. Inquiry
"^DD",9002313.02,9002313.02,103,21,9,0)
P4=P.A. Request Only
"^DD",9002313.02,9002313.02,103,21,10,0)
N1=Information Reporting
"^DD",9002313.02,9002313.02,103,21,11,0)
N2=Information Reporting Reversal
"^DD",9002313.02,9002313.02,103,21,12,0)
N3=Information Reporting Rebill
"^DD",9002313.02,9002313.02,103,21,13,0)
C1=Controlled Substance Reporting
"^DD",9002313.02,9002313.02,103,21,14,0)
C2=Controlled Substance Reporting Reversal
"^DD",9002313.02,9002313.02,103,21,15,0)
C3=Controlled Substance Reporting Rebill
"^DD",9002313.02,9002313.02,103,"DT")
3031124
"^DD",9002313.02,9002313.02,104,0)
Processor Control Number^F^^100;4^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,104,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.02,104,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,104,21,1,0)
Number which will uniquely identify the submitter of the claim.
"^DD",9002313.02,9002313.02,104,"DT")
3031124
"^DD",9002313.02,9002313.02,109,0)
Transaction Count^F^^100;9^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,109,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,109,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,109,21,1,0)
Count of transactions in the transmission.
"^DD",9002313.02,9002313.02,109,"DT")
3031124
"^DD",9002313.02,9002313.02,110,0)
Software Vendor/Cert ID^F^^100;10^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,110,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.02,110,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,110,21,1,0)
Certification number which Identifies the patients insurance carrier.
"^DD",9002313.02,9002313.02,110,"DT")
3031124
"^DD",9002313.02,9002313.02,201,0)
Service Provider ID^F^^200;1^K:$L(X)>15!($L(X)<12) X
"^DD",9002313.02,9002313.02,201,3)
Answer must be 12-15 characters in length.
"^DD",9002313.02,9002313.02,201,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,201,21,1,0)
ID assigned to a pharmacy or provider.
"^DD",9002313.02,9002313.02,201,"DT")
3031124
"^DD",9002313.02,9002313.02,202,0)
Service Provider ID Qualifier^F^^200;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,202,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,202,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.02,202,21,1,0)
Qualifier indicating which ID number was used.
"^DD",9002313.02,9002313.02,202,"DT")
3020730
"^DD",9002313.02,9002313.02,301,0)
Group ID^F^^300;1^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.02,301,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.02,301,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,301,21,1,0)
ID assigned to the cardholder group or employer group.
"^DD",9002313.02,9002313.02,301,"DT")
3031124
"^DD",9002313.02,9002313.02,302,0)
Cardholder ID^F^^300;2^K:$L(X)>20!($L(X)<18) X
"^DD",9002313.02,9002313.02,302,3)
Answer must be 18-20 characters in length.
"^DD",9002313.02,9002313.02,302,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,302,21,1,0)
Insurance ID assigned to the cardholder.
"^DD",9002313.02,9002313.02,302,"DT")
3031124
"^DD",9002313.02,9002313.02,303,0)
Person Code^F^^300;3^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.02,303,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.02,303,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,303,21,1,0)
Code assigned to a specific person within a family.
"^DD",9002313.02,9002313.02,303,"DT")
3031124
"^DD",9002313.02,9002313.02,304,0)
Date of Birth^FO^^300;4^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.02,304,2)
S Y(0)=Y S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,304,2.1)
S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,304,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.02,304,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,304,21,1,0)
Patient date of birth in the format CCYYMMDD.
"^DD",9002313.02,9002313.02,304,"DT")
3031124
"^DD",9002313.02,9002313.02,305,0)
Patient Gender Code^FO^^300;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,305,2)
S Y(0)=Y S Y=$S(Y=1:"MALE",Y=2:"FEMALE",1:Y)
"^DD",9002313.02,9002313.02,305,2.1)
S Y=$S(Y=1:"MALE",Y=2:"FEMALE",1:Y)
"^DD",9002313.02,9002313.02,305,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,305,21,0)
^^4^4^3031124^
"^DD",9002313.02,9002313.02,305,21,1,0)
One of three codes to indicated the gender of the patient.
"^DD",9002313.02,9002313.02,305,21,2,0)
0 = Not Specific
"^DD",9002313.02,9002313.02,305,21,3,0)
1 = Male
"^DD",9002313.02,9002313.02,305,21,4,0)
2 = Female
"^DD",9002313.02,9002313.02,305,"DT")
3031124
"^DD",9002313.02,9002313.02,306,0)
Patient Relationship Code^FO^^300;6^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,306,2)
S Y(0)=Y S Y=$S(Y=1:"CARDHOLDER",Y=2:"SPOUSE",Y=3:"CHILD",1:Y)
"^DD",9002313.02,9002313.02,306,2.1)
S Y=$S(Y=1:"CARDHOLDER",Y=2:"SPOUSE",Y=3:"CHILD",1:Y)
"^DD",9002313.02,9002313.02,306,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,306,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,306,21,1,0)
Code indicating relationship of patient to cardholder.
"^DD",9002313.02,9002313.02,306,"DT")
3031124
"^DD",9002313.02,9002313.02,307,0)
Patient Location^F^^300;7^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,307,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,307,21,0)
^^14^14^3031124^
"^DD",9002313.02,9002313.02,307,21,1,0)
Code identifying the location of the patient when receiving pharmacy 
"^DD",9002313.02,9002313.02,307,21,2,0)
services.
"^DD",9002313.02,9002313.02,307,21,3,0)
=Not Specified
"^DD",9002313.02,9002313.02,307,21,4,0)
1=Home
"^DD",9002313.02,9002313.02,307,21,5,0)
2=Inter-Care
"^DD",9002313.02,9002313.02,307,21,6,0)
3=Nursing Home
"^DD",9002313.02,9002313.02,307,21,7,0)
4=Long Term/Extended Care
"^DD",9002313.02,9002313.02,307,21,8,0)
5=Rest Home
"^DD",9002313.02,9002313.02,307,21,9,0)
6=Boarding Home
"^DD",9002313.02,9002313.02,307,21,10,0)
7=Skilled Care Facility
"^DD",9002313.02,9002313.02,307,21,11,0)
8=Sub-Acute Care Facility
"^DD",9002313.02,9002313.02,307,21,12,0)
9=Acute Care Facility
"^DD",9002313.02,9002313.02,307,21,13,0)
1=Outpatient
"^DD",9002313.02,9002313.02,307,21,14,0)
11=Hospice
"^DD",9002313.02,9002313.02,307,"DT")
3031124
"^DD",9002313.02,9002313.02,308,0)
Other Coverage Code^F^^300;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.02,9002313.02,308,3)
Answer must be 1-2 characters in length.
"^DD",9002313.02,9002313.02,308,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,308,21,1,0)
Code indicating whether or not the patient has other insurance coverage.
"^DD",9002313.02,9002313.02,308,"DT")
3031124
"^DD",9002313.02,9002313.02,309,0)
Eligibility Clarification Code^F^^300;9^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,309,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,309,21,0)
^^2^2^3031124^
"^DD",9002313.02,9002313.02,309,21,1,0)
Code indicating that the pharmacy is clarifying eligibility based on 
"^DD",9002313.02,9002313.02,309,21,2,0)
receiving a denial.
"^DD",9002313.02,9002313.02,309,"DT")
3031124
"^DD",9002313.02,9002313.02,310,0)
Patient First Name^F^^300;10^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.02,310,3)
Answer must be 12 characters in length.
"^DD",9002313.02,9002313.02,310,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,310,21,1,0)
First name of patient receiving the prescription.
"^DD",9002313.02,9002313.02,310,"DT")
3031124
"^DD",9002313.02,9002313.02,311,0)
Patient Last Name^F^^300;11^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.02,311,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.02,311,21,0)
^^1^1^3040331^
"^DD",9002313.02,9002313.02,311,21,1,0)
Last Name of patient receiving the prescription.
"^DD",9002313.02,9002313.02,311,"DT")
3040331
"^DD",9002313.02,9002313.02,312,0)
Cardholder First Name^F^^300;12^K:$L(X)>14!($L(X)<1) X
"^DD",9002313.02,9002313.02,312,3)
Answer must be 1-14 characters in length.
"^DD",9002313.02,9002313.02,312,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,312,21,1,0)
First name of the Cardholder/Subscriber.
"^DD",9002313.02,9002313.02,312,"DT")
3031124
"^DD",9002313.02,9002313.02,313,0)
Cardholder Last Name^F^^300;13^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.02,9002313.02,313,3)
Answer must be 1-17 characters in length.
"^DD",9002313.02,9002313.02,313,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,313,21,1,0)
Last name of the cardholder/subscriber.
"^DD",9002313.02,9002313.02,313,"DT")
3031124
"^DD",9002313.02,9002313.02,314,0)
Home Plan^F^^300;14^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.02,9002313.02,314,3)
Answer must be 1-5 characters in length.
"^DD",9002313.02,9002313.02,314,21,0)
^^3^3^3031124^
"^DD",9002313.02,9002313.02,314,21,1,0)
Code identifying the Blue Cross or Blue Shield plan ID which indicates 
"^DD",9002313.02,9002313.02,314,21,2,0)
where the member's coverage has been designated. Usually where the member 
"^DD",9002313.02,9002313.02,314,21,3,0)
lives or purchased their coverage.
"^DD",9002313.02,9002313.02,314,"DT")
3031124
"^DD",9002313.02,9002313.02,315,0)
Employer Name^F^^300;15^K:$L(X)>32!($L(X)<1) X
"^DD",9002313.02,9002313.02,315,3)
Answer must be 1-32 characters in length.
"^DD",9002313.02,9002313.02,315,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,315,21,1,0)
Complete name of employer.
"^DD",9002313.02,9002313.02,315,"DT")
3031124
"^DD",9002313.02,9002313.02,316,0)
Employer Street Address^F^^300;16^K:$L(X)>32!($L(X)<1) X
"^DD",9002313.02,9002313.02,316,3)
Answer must be 1-32 characters in length.
"^DD",9002313.02,9002313.02,316,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.02,316,21,1,0)
Free-form text for address information.
"^DD",9002313.02,9002313.02,316,"DT")
3031124
"^DD",9002313.02,9002313.02,317,0)
Employer City Address^F^^300;17^K:$L(X)>22!($L(X)<1) X
"^DD",9002313.02,9002313.02,317,3)
Answer must be 1-22 characters in length.
"^DD",9002313.02,9002313.02,317,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,317,21,1,0)
Free-form text for city name.
"^DD",9002313.02,9002313.02,317,"DT")
3031124
"^DD",9002313.02,9002313.02,318,0)
Employer State^F^^300;18^K:$L(X)>4!($L(X)<1) X
"^DD",9002313.02,9002313.02,318,3)
Answer must be 1-4 characters in length.
"^DD",9002313.02,9002313.02,318,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,318,21,1,0)
Standard State/Province Code as defined by appropriate government agency.
"^DD",9002313.02,9002313.02,318,"DT")
3031124
"^DD",9002313.02,9002313.02,319,0)
Employer Zip Code^F^^300;19^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.02,9002313.02,319,3)
Answer must be 1-15 characters in length.
"^DD",9002313.02,9002313.02,319,21,0)
^^2^2^3031124^
"^DD",9002313.02,9002313.02,319,21,1,0)
Code defining international postal zone excluding punctuation and blanks 
"^DD",9002313.02,9002313.02,319,21,2,0)
(zip code for US).
"^DD",9002313.02,9002313.02,319,"DT")
3031124
"^DD",9002313.02,9002313.02,320,0)
Employer Phone Number^F^^320;20^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.02,9002313.02,320,3)
Answer must be 1-12 characters in length.
"^DD",9002313.02,9002313.02,320,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,320,21,1,0)
Ten digit phone number of employer.
"^DD",9002313.02,9002313.02,320,"DT")
3031124
"^DD",9002313.02,9002313.02,322,0)
Patient Street Address^F^^321;2^K:$L(X)>32!($L(X)<1) X
"^DD",9002313.02,9002313.02,322,3)
Answer must be 1-32 characters in length.
"^DD",9002313.02,9002313.02,322,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,322,21,1,0)
Free-form text for Patient address information.
"^DD",9002313.02,9002313.02,322,"DT")
3031124
"^DD",9002313.02,9002313.02,323,0)
Patient City Address^F^^321;3^K:$L(X)>22!($L(X)<1) X
"^DD",9002313.02,9002313.02,323,3)
Answer must be 1-22 characters in length.
"^DD",9002313.02,9002313.02,323,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,323,21,1,0)
Free-form text for city name.
"^DD",9002313.02,9002313.02,323,"DT")
3031124
"^DD",9002313.02,9002313.02,324,0)
Patient State/Prov Address^F^^321;4^K:$L(X)>4!($L(X)<1) X
"^DD",9002313.02,9002313.02,324,3)
Answer must be 1-4 characters in length.
"^DD",9002313.02,9002313.02,324,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,324,21,1,0)
Standard State/Province Code as defined by appropriate government agency.
"^DD",9002313.02,9002313.02,324,"DT")
3031124
"^DD",9002313.02,9002313.02,325,0)
Patient Zip/Postal Zone^F^^321;5^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.02,9002313.02,325,3)
Answer must be 1-15 characters in length.
"^DD",9002313.02,9002313.02,325,21,0)
^^2^2^3031124^
"^DD",9002313.02,9002313.02,325,21,1,0)
Code defining international postal zone excluding punctuation and blanks 
"^DD",9002313.02,9002313.02,325,21,2,0)
(zip code for US).
"^DD",9002313.02,9002313.02,325,"DT")
3031124
"^DD",9002313.02,9002313.02,326,0)
Patient Phone Number^F^^321;6^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,326,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.02,326,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,326,21,1,0)
Ten digit  phone number of patient.
"^DD",9002313.02,9002313.02,326,"DT")
3031124
"^DD",9002313.02,9002313.02,327,0)
Carrier ID #^F^^320;27^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.02,9002313.02,327,3)
Answer must be 1-12 characters in length.
"^DD",9002313.02,9002313.02,327,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,327,21,1,0)
Carrier code assigned in Worker's Compensation Program.
"^DD",9002313.02,9002313.02,327,"DT")
3031124
"^DD",9002313.02,9002313.02,329,0)
Patient SSN^F^^320;29^K:$L(X)>11!($L(X)<1) X
"^DD",9002313.02,9002313.02,329,3)
Answer must be 1-11 characters in length.
"^DD",9002313.02,9002313.02,329,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,329,21,1,0)
The Social Security Number as assigned by the US Government.
"^DD",9002313.02,9002313.02,329,"DT")
3031124
"^DD",9002313.02,9002313.02,331,0)
Patient ID Qualifier^F^^330;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,331,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,331,21,0)
^^6^6^3031124^
"^DD",9002313.02,9002313.02,331,21,1,0)
Code qualifying the 'Patient ID'.
"^DD",9002313.02,9002313.02,331,21,2,0)
Blank=Not Specified
"^DD",9002313.02,9002313.02,331,21,3,0)
1=Social Security Number
"^DD",9002313.02,9002313.02,331,21,4,0)
2=Driver's License Number
"^DD",9002313.02,9002313.02,331,21,5,0)
3=U.S. Military ID
"^DD",9002313.02,9002313.02,331,21,6,0)
99=Other
"^DD",9002313.02,9002313.02,331,"DT")
3031124
"^DD",9002313.02,9002313.02,332,0)
Patient ID  ^F^^330;2^K:$L(X)>20!($L(X)<20) X
"^DD",9002313.02,9002313.02,332,3)
Answer must be 20 characters in length.
"^DD",9002313.02,9002313.02,332,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,332,21,1,0)
ID assigned to the patient.
"^DD",9002313.02,9002313.02,332,"DT")
3031124
"^DD",9002313.02,9002313.02,333,0)
Employer ID^F^^330;3^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.02,333,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.02,333,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,333,21,1,0)
ID assigned to employer.
"^DD",9002313.02,9002313.02,333,"DT")
3031124
"^DD",9002313.02,9002313.02,334,0)
Smoker/Non Smoker^F^^330;4^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,334,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,334,21,0)
^^4^4^3031124^
"^DD",9002313.02,9002313.02,334,21,1,0)
Code indicating the patient as a smoker or non-smoker.
"^DD",9002313.02,9002313.02,334,21,2,0)
Blank=Not Specified
"^DD",9002313.02,9002313.02,334,21,3,0)
1=Non-Smoker
"^DD",9002313.02,9002313.02,334,21,4,0)
2=Smoker
"^DD",9002313.02,9002313.02,334,"DT")
3031124
"^DD",9002313.02,9002313.02,335,0)
Pregnancy Indicator^F^^330;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,335,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,335,21,0)
^^4^4^3031124^
"^DD",9002313.02,9002313.02,335,21,1,0)
Code indicating the patient as pregnant or non-pregnant.
"^DD",9002313.02,9002313.02,335,21,2,0)
Blank=Not Specified
"^DD",9002313.02,9002313.02,335,21,3,0)
1=Not pregnant
"^DD",9002313.02,9002313.02,335,21,4,0)
2=Pregnant
"^DD",9002313.02,9002313.02,335,"DT")
3031124
"^DD",9002313.02,9002313.02,336,0)
Facility ID^F^^330;6^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,336,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.02,336,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,336,21,1,0)
ID assigned to the patient's clinic/host party.
"^DD",9002313.02,9002313.02,336,"DT")
3031124
"^DD",9002313.02,9002313.02,400,0)
Medication(s)^9002313.0201A^^400;0
"^DD",9002313.02,9002313.02,400,21,0)
^.001^1^1^3040126^^^^
"^DD",9002313.02,9002313.02,400,21,1,0)
Medications included in this prescription.
"^DD",9002313.02,9002313.02,400,"DT")
2950522
"^DD",9002313.02,9002313.02,401,0)
Date of Service^F^^401;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.02,401,1,0)
^.1
"^DD",9002313.02,9002313.02,401,1,1,0)
9002313.02^AF
"^DD",9002313.02,9002313.02,401,1,1,1)
S ^BPSC("AF",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,401,1,1,2)
K ^BPSC("AF",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,401,1,1,"DT")
2950724
"^DD",9002313.02,9002313.02,401,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.02,401,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,401,21,1,0)
Date prescription was dispensed.
"^DD",9002313.02,9002313.02,401,"DT")
3031124
"^DD",9002313.02,9002313.02,498.09,0)
Authorized Rep State/Prov^F^^498;9^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,498.09,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,498.09,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,498.09,21,1,0)
Standard State/Province code as defined by appropriate government agency.
"^DD",9002313.02,9002313.02,498.09,"DT")
3031124
"^DD",9002313.02,9002313.02,524,0)
Plan ID^F^^520;4^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.02,524,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.02,524,21,0)
^^2^2^3031124^
"^DD",9002313.02,9002313.02,524,21,1,0)
Assigned by the processor to identify a set of parameters, benefit, or 
"^DD",9002313.02,9002313.02,524,21,2,0)
coverage criteria used to adjudicate a claim.
"^DD",9002313.02,9002313.02,524,"DT")
3031124
"^DD",9002313.02,9002313.02,901,0)
CLOSED^S^1:YES;^900;1^Q
"^DD",9002313.02,9002313.02,901,"DT")
3040513
"^DD",9002313.02,9002313.02,902,0)
CLOSED DATE/TIME^D^^900;2^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.02,9002313.02,902,1,0)
^.1
"^DD",9002313.02,9002313.02,902,1,1,0)
9002313.02^AG
"^DD",9002313.02,9002313.02,902,1,1,1)
S ^BPSC("AG",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,902,1,1,2)
K ^BPSC("AG",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,902,1,1,"DT")
3040518
"^DD",9002313.02,9002313.02,902,3)
(No range limit on date)
"^DD",9002313.02,9002313.02,902,"DT")
3060118
"^DD",9002313.02,9002313.02,903,0)
CLOSED BY^P200'^VA(200,^900;3^Q
"^DD",9002313.02,9002313.02,903,"DT")
3040513
"^DD",9002313.02,9002313.02,904,0)
CLOSED REASON^*P356.8'^IBE(356.8,^900;4^S DIC("S")="I $P(^IBE(356.8,+Y,0),U,2)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",9002313.02,9002313.02,904,3)
Enter the Claim Close Reason.
"^DD",9002313.02,9002313.02,904,12)
Only ECME-supported non-billable reasons can be entered.
"^DD",9002313.02,9002313.02,904,12.1)
S DIC("S")="I $P(^IBE(356.8,+Y,0),U,2)"
"^DD",9002313.02,9002313.02,904,21,0)
^^2^2^3050729^
"^DD",9002313.02,9002313.02,904,21,1,0)
The ECME-supported non-billable reason entered by the user or defaulted by
"^DD",9002313.02,9002313.02,904,21,2,0)
the system.
"^DD",9002313.02,9002313.02,904,"DT")
3050729
"^DD",9002313.02,9002313.02,905,0)
DROP TO PAPER^S^D:DROP TO PAPER;N:NON-BILLABLE;^900;5^Q
"^DD",9002313.02,9002313.02,905,21,0)
^.001^4^4^3050518^^^
"^DD",9002313.02,9002313.02,905,21,1,0)
If close reason is 90 DAY RX FILL NOT COVERED or 
"^DD",9002313.02,9002313.02,905,21,2,0)
NOT A CONTRACTED PROVIDER then user will be prompted:
"^DD",9002313.02,9002313.02,905,21,3,0)
Treat as (N)on-Billable Episode or (D)rop Bill to Paper? 
"^DD",9002313.02,9002313.02,905,21,4,0)
the answer is stored in this field and sent to IB
"^DD",9002313.02,9002313.02,905,"DT")
3050517
"^DD",9002313.02,9002313.02,9999,0)
RAW DATA SENT^9002313.29999^^M;0
"^DD",9002313.02,9002313.02,9999,21,0)
^^1^1^3040331^
"^DD",9002313.02,9002313.02,9999,21,1,0)
An exact copy of the record sent via the communications protocol.
"^DD",9002313.02,9002313.0201,0)
Medication(s) SUB-FIELD^^600^117
"^DD",9002313.02,9002313.0201,0,"DT")
3040126
"^DD",9002313.02,9002313.0201,0,"IX","AC",9002313.0201,.03)

"^DD",9002313.02,9002313.0201,0,"IX","B",9002313.0201,.01)

"^DD",9002313.02,9002313.0201,0,"NM","Medication(s)")

"^DD",9002313.02,9002313.0201,0,"UP")
9002313.02
"^DD",9002313.02,9002313.0201,.01,0)
Medication Order^MNJ9,0^^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.02,9002313.0201,.01,1,0)
^.1
"^DD",9002313.02,9002313.0201,.01,1,1,0)
9002313.0201^B
"^DD",9002313.02,9002313.0201,.01,1,1,1)
S ^BPSC(DA(1),400,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0201,.01,1,1,2)
K ^BPSC(DA(1),400,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0201,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",9002313.02,9002313.0201,.01,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,.01,21,1,0)
Free text to indicate meds ordered.
"^DD",9002313.02,9002313.0201,.01,"DT")
3031125
"^DD",9002313.02,9002313.0201,.02,0)
VCPT IEN^F^^0;2^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.02,9002313.0201,.02,3)
Answer must be 1-8 characters in length.
"^DD",9002313.02,9002313.0201,.02,21,0)
^.001^1^1^3040126^^
"^DD",9002313.02,9002313.0201,.02,21,1,0)
Internal ID number for the CPT code.
"^DD",9002313.02,9002313.0201,.02,"DT")
3040126
"^DD",9002313.02,9002313.0201,.03,0)
Medication Number^NJ9,0^^0;3^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.02,9002313.0201,.03,1,0)
^.1
"^DD",9002313.02,9002313.0201,.03,1,1,0)
9002313.0201^AC
"^DD",9002313.02,9002313.0201,.03,1,1,1)
S ^BPSC(DA(1),400,"AC",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0201,.03,1,1,2)
K ^BPSC(DA(1),400,"AC",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0201,.03,1,1,"DT")
2950525
"^DD",9002313.02,9002313.0201,.03,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",9002313.02,9002313.0201,.03,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,.03,21,1,0)
Number of the med ordered.
"^DD",9002313.02,9002313.0201,.03,"DT")
3031125
"^DD",9002313.02,9002313.0201,.04,0)
Medication Name^F^^0;4^K:$L(X)>50!($L(X)<1) X
"^DD",9002313.02,9002313.0201,.04,3)
Answer must be 1-50 characters in length.
"^DD",9002313.02,9002313.0201,.04,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,.04,21,1,0)
Name of the med ordered.
"^DD",9002313.02,9002313.0201,.04,"DT")
3031125
"^DD",9002313.02,9002313.0201,.05,0)
PRESCRIPTION IEN^P52'^PSRX(^0;5^Q
"^DD",9002313.02,9002313.0201,.05,3)

"^DD",9002313.02,9002313.0201,.05,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,.05,21,1,0)
Internal ID number of the prescription.
"^DD",9002313.02,9002313.0201,.05,"DT")
3031125
"^DD",9002313.02,9002313.0201,308,0)
Other Coverage Code^F^^300;8^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,308,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,308,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,308,21,1,0)
Code indicating whether or not the patient has other insurance coverage.
"^DD",9002313.02,9002313.0201,308,"DT")
3031125
"^DD",9002313.02,9002313.0201,315,0)
Employer Name^F^^310;5^K:$L(X)>30!($L(X)<30) X
"^DD",9002313.02,9002313.0201,315,3)
Answer must be 30 characters in length.
"^DD",9002313.02,9002313.0201,315,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,315,21,1,0)
Complete name of employer.
"^DD",9002313.02,9002313.0201,315,"DT")
3031125
"^DD",9002313.02,9002313.0201,316,0)
Employer Street Address^F^^310;6^K:$L(X)>30!($L(X)<30) X
"^DD",9002313.02,9002313.0201,316,3)
Answer must be 30 characters in length.
"^DD",9002313.02,9002313.0201,316,21,0)
^^1^1^3040126^
"^DD",9002313.02,9002313.0201,316,21,1,0)
The Street address of the insured's employer.
"^DD",9002313.02,9002313.0201,316,"DT")
3020731
"^DD",9002313.02,9002313.0201,317,0)
Employer City Address^F^^310;7^K:$L(X)>20!($L(X)<20) X
"^DD",9002313.02,9002313.0201,317,3)
Answer must be 20 characters in length.
"^DD",9002313.02,9002313.0201,317,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,317,21,1,0)
Free-form text for city name.
"^DD",9002313.02,9002313.0201,317,"DT")
3031125
"^DD",9002313.02,9002313.0201,318,0)
Employer State/Prov Address^F^^310;8^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,318,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,318,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,318,21,1,0)
Standard State/Province Code as defined by appropriate government agency.
"^DD",9002313.02,9002313.0201,318,"DT")
3031125
"^DD",9002313.02,9002313.0201,319,0)
Employer Zip/Postal Zone^F^^310;9^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,319,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,319,21,0)
^^2^2^3031125^
"^DD",9002313.02,9002313.0201,319,21,1,0)
Code defining international postal zone excluding punctuation and blanks 
"^DD",9002313.02,9002313.0201,319,21,2,0)
(zip code for US).
"^DD",9002313.02,9002313.0201,319,"DT")
3031125
"^DD",9002313.02,9002313.0201,320,0)
Employer Phone Number^F^^310;10^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,320,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0201,320,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,320,21,1,0)
Ten digit phone number of employer.
"^DD",9002313.02,9002313.0201,320,"DT")
3031125
"^DD",9002313.02,9002313.0201,321,0)
Employer Contact Name^F^^320;1^K:$L(X)>30!($L(X)<30) X
"^DD",9002313.02,9002313.0201,321,3)
Answer must be 30 characters in length.
"^DD",9002313.02,9002313.0201,321,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,321,21,1,0)
Employer primary contact.
"^DD",9002313.02,9002313.0201,321,"DT")
3031125
"^DD",9002313.02,9002313.0201,327,0)
Carrier ID^F^^320;7^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,327,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0201,327,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,327,21,1,0)
Carrier code assigned in Worker's Compensation Program.
"^DD",9002313.02,9002313.0201,327,"DT")
3031125
"^DD",9002313.02,9002313.0201,330,0)
Alternate ID^F^^320;10^K:$L(X)>20!($L(X)<20) X
"^DD",9002313.02,9002313.0201,330,3)
Answer must be 20 characters in length.
"^DD",9002313.02,9002313.0201,330,21,0)
^^3^3^3031125^
"^DD",9002313.02,9002313.0201,330,21,1,0)
Person identifier to be used for controlled product reporting. Identifier 
"^DD",9002313.02,9002313.0201,330,21,2,0)
may be that of the patient or the person picking up the prescription as 
"^DD",9002313.02,9002313.0201,330,21,3,0)
required by the governing body.
"^DD",9002313.02,9002313.0201,330,"DT")
3031125
"^DD",9002313.02,9002313.0201,337,0)
COB/Other Payments Cnt^F^^330;7^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,337,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,337,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,337,21,1,0)
Count of other payment occurrences.
"^DD",9002313.02,9002313.0201,337,"DT")
3031125
"^DD",9002313.02,9002313.0201,337.01,0)
COB/Other Payments  ^9002313.0401A^^337;0
"^DD",9002313.02,9002313.0201,343,0)
Dispensing Status^F^^340;3^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,343,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,343,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,343,21,1,0)
The status of the medication order at the time the claim was built.
"^DD",9002313.02,9002313.0201,343,"DT")
3020731
"^DD",9002313.02,9002313.0201,344,0)
Qty Intended to be Dispensed^F^^340;4^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,344,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0201,344,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,344,21,1,0)
The quantity ordered - may differ from qty dispensed depending on stock 
"^DD",9002313.02,9002313.0201,344,21,2,0)
levels
"^DD",9002313.02,9002313.0201,344,"DT")
3020731
"^DD",9002313.02,9002313.0201,345,0)
Days Supply Intd Dispensed^F^^340;5^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,345,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.0201,345,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,345,21,1,0)
The days supply from the order information.
"^DD",9002313.02,9002313.0201,345,"DT")
3020731
"^DD",9002313.02,9002313.0201,401,0)
Date of Service^FO^^400;1^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,401,2)
S Y(0)=Y S Y=$$FM2EXT^BPSOSU1(Y-17000000)
"^DD",9002313.02,9002313.0201,401,2.1)
S Y=$$FM2EXT^BPSOSU1(Y-17000000)
"^DD",9002313.02,9002313.0201,401,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,401,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,401,21,1,0)
The fill/refill date
"^DD",9002313.02,9002313.0201,401,"DT")
3020726
"^DD",9002313.02,9002313.0201,402,0)
Prescription/Service Ref Num^F^^400;2^K:$L(X)>7!($L(X)<1) X
"^DD",9002313.02,9002313.0201,402,3)
Answer must be 1-7 characters in length.
"^DD",9002313.02,9002313.0201,402,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,402,21,1,0)
The first seven digits of the prescription IEN
"^DD",9002313.02,9002313.0201,402,"DT")
3020724
"^DD",9002313.02,9002313.0201,403,0)
Fill Number^FO^^400;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,403,2)
S Y(0)=Y S:$E(Y,1,1)'["D" Y=+Y
"^DD",9002313.02,9002313.0201,403,2.1)
S:$E(Y,1,1)'["D" Y=+Y
"^DD",9002313.02,9002313.0201,403,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,403,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,403,21,1,0)
The fill/refill number, starting at 0 for the original fill.
"^DD",9002313.02,9002313.0201,403,"DT")
3020805
"^DD",9002313.02,9002313.0201,404,0)
Metric Quantity^FO^^400;4^K:$L(X)>5!($L(X)<5) X
"^DD",9002313.02,9002313.0201,404,2)
S Y(0)=Y S Y=+Y
"^DD",9002313.02,9002313.0201,404,2.1)
S Y=+Y
"^DD",9002313.02,9002313.0201,404,3)
Answer must be 5 characters in length.
"^DD",9002313.02,9002313.0201,404,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,404,21,1,0)
The metric quantity of the medication dispensed. 
"^DD",9002313.02,9002313.0201,404,"DT")
2971223
"^DD",9002313.02,9002313.0201,405,0)
Days Supply^FO^^400;5^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,405,2)
S Y(0)=Y S:$E(Y,1,1)'["D" Y=+Y
"^DD",9002313.02,9002313.0201,405,2.1)
S:$E(Y,1,1)'["D" Y=+Y
"^DD",9002313.02,9002313.0201,405,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.0201,405,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,405,21,1,0)
The actual days supply dispensed.
"^DD",9002313.02,9002313.0201,405,"DT")
3020805
"^DD",9002313.02,9002313.0201,406,0)
Compound Code^F^^400;6^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,406,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,406,21,0)
^^2^2^3040331^
"^DD",9002313.02,9002313.0201,406,21,1,0)
Field indicating whether this prescription was a compound (1)
"^DD",9002313.02,9002313.0201,406,21,2,0)
or not a compound (0).
"^DD",9002313.02,9002313.0201,406,"DT")
3040331
"^DD",9002313.02,9002313.0201,407,0)
Product/Service ID^FO^^400;7^K:$L(X)>19!($L(X)<11) X
"^DD",9002313.02,9002313.0201,407,2)
S Y(0)=Y Q:$E(Y,1,1)["D"  S Y=$E(Y,1,5)_"-"_$E(Y,6,9)_"-"_$E(Y,10,11)
"^DD",9002313.02,9002313.0201,407,2.1)
Q:$E(Y,1,1)["D"  S Y=$E(Y,1,5)_"-"_$E(Y,6,9)_"-"_$E(Y,10,11)
"^DD",9002313.02,9002313.0201,407,3)
Answer must be 11-19 characters in length.
"^DD",9002313.02,9002313.0201,407,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,407,21,1,0)
NDC code in our case.
"^DD",9002313.02,9002313.0201,407,"DT")
3020805
"^DD",9002313.02,9002313.0201,408,0)
Dispense as Wrtn/Prd Sel Cd^F^^400;8^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,408,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,408,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,408,21,1,0)
Indicator for whether the prescription was to be dispensed only as 
"^DD",9002313.02,9002313.0201,408,21,2,0)
written.
"^DD",9002313.02,9002313.0201,408,"DT")
3020726
"^DD",9002313.02,9002313.0201,409,0)
Ingredient Cost Submitted^FO^^400;9^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,409,2)
S Y(0)=Y ;S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.02,9002313.0201,409,2.1)
;S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.02,9002313.0201,409,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,409,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,409,21,1,0)
Cost amount for the ingredients of compounds.
"^DD",9002313.02,9002313.0201,409,"DT")
3020805
"^DD",9002313.02,9002313.0201,410,0)
Sales Tax^FO^^400;10^K:$L(X)>6!($L(X)<6) X
"^DD",9002313.02,9002313.0201,410,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM($E(Y,3,$L(Y))),7,2)
"^DD",9002313.02,9002313.0201,410,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM($E(Y,3,$L(Y))),7,2)
"^DD",9002313.02,9002313.0201,410,3)
Answer must be 6 characters in length.
"^DD",9002313.02,9002313.0201,410,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,410,21,1,0)
Sales Tax charged (not applicable for VA)
"^DD",9002313.02,9002313.0201,410,"DT")
2950621
"^DD",9002313.02,9002313.0201,411,0)
Prescriber ID^F^^400;11^K:$L(X)>15!($L(X)<10) X
"^DD",9002313.02,9002313.0201,411,3)
Answer must be 10-15 characters in length.
"^DD",9002313.02,9002313.0201,411,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,411,21,1,0)
Prescriber identification number.
"^DD",9002313.02,9002313.0201,411,"DT")
3020726
"^DD",9002313.02,9002313.0201,412,0)
Dispensing Fee Submitted^FO^^400;12^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,412,2)
S Y(0)=Y ;S Y="$"_$J($$DFF2EXT^BPSECFM($E(Y,3,$L(Y))),7,2)
"^DD",9002313.02,9002313.0201,412,2.1)
;S Y="$"_$J($$DFF2EXT^BPSECFM($E(Y,3,$L(Y))),7,2)
"^DD",9002313.02,9002313.0201,412,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,412,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,412,21,1,0)
Add-on fee charged in a retail setting.  This field will probably be used 
"^DD",9002313.02,9002313.0201,412,21,2,0)
when the Tricare functionality is added.
"^DD",9002313.02,9002313.0201,412,"DT")
3020805
"^DD",9002313.02,9002313.0201,414,0)
Date Prescription Written^F^^400;14^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,414,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,414,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,414,21,1,0)
This will be the fill/refill date for local fills, the released date for 
"^DD",9002313.02,9002313.0201,414,21,2,0)
CMOP.
"^DD",9002313.02,9002313.0201,414,"DT")
2950410
"^DD",9002313.02,9002313.0201,415,0)
Number Refills Authorized^F^^400;15^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,415,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,415,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,415,21,1,0)
The number of refills allowed that was entered during order entry.
"^DD",9002313.02,9002313.0201,415,"DT")
2950410
"^DD",9002313.02,9002313.0201,416,0)
PA/MC Code & Number^F^^400;16^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,416,3)
Answer must be 12 characters in length.
"^DD",9002313.02,9002313.0201,416,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,416,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.02,9002313.0201,416,"DT")
2950410
"^DD",9002313.02,9002313.0201,418,0)
Level of Service^F^^400;18^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,418,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,418,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,418,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.02,9002313.0201,418,"DT")
2950410
"^DD",9002313.02,9002313.0201,419,0)
Prescription Origin Code^F^^400;19^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,419,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,419,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,419,21,1,0)
Not used by VA - left in for IHS
"^DD",9002313.02,9002313.0201,419,"DT")
2950410
"^DD",9002313.02,9002313.0201,420,0)
Submission Clarification Code^F^^400;20^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,420,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,420,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,420,21,1,0)
Not used by VA - left in for IHS
"^DD",9002313.02,9002313.0201,420,"DT")
3020726
"^DD",9002313.02,9002313.0201,421,0)
Primary Care Provider ID^F^^400;21^K:$L(X)>15!($L(X)<10) X
"^DD",9002313.02,9002313.0201,421,3)
Answer must be 10-15 characters in length.
"^DD",9002313.02,9002313.0201,421,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,421,21,1,0)
Provider ID number
"^DD",9002313.02,9002313.0201,421,"DT")
3020726
"^DD",9002313.02,9002313.0201,422,0)
Clinic ID Number^F^^400;22^K:$L(X)>5!($L(X)<5) X
"^DD",9002313.02,9002313.0201,422,3)
Answer must be 5 characters in length.
"^DD",9002313.02,9002313.0201,422,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,422,21,1,0)
Clinic ID where the prescription was entered.
"^DD",9002313.02,9002313.0201,422,"DT")
2950410
"^DD",9002313.02,9002313.0201,423,0)
Basis of Cost Determination^F^^400;23^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,423,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,423,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,423,21,1,0)
How the amount charged was arrived at.
"^DD",9002313.02,9002313.0201,423,"DT")
2950410
"^DD",9002313.02,9002313.0201,424,0)
Diagnosis Code^F^^400;24^K:$L(X)>15!($L(X)<6) X
"^DD",9002313.02,9002313.0201,424,3)
Answer must be 6-15 characters in length.
"^DD",9002313.02,9002313.0201,424,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,424,21,1,0)
Diagnosis code that applies to this prescription.  
"^DD",9002313.02,9002313.0201,424,21,2,0)
Not used for third party billing as of this date - so it
"^DD",9002313.02,9002313.0201,424,21,3,0)
is not used, but may be used in the future.
"^DD",9002313.02,9002313.0201,424,"DT")
3020726
"^DD",9002313.02,9002313.0201,425,0)
Drug Type^F^^420;25^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,425,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.0201,425,21,0)
^^8^8^3031203^
"^DD",9002313.02,9002313.0201,425,21,1,0)
Code to indicate the type of
"^DD",9002313.02,9002313.0201,425,21,2,0)
drug dispensed.
"^DD",9002313.02,9002313.0201,425,21,3,0)
 
"^DD",9002313.02,9002313.0201,425,21,4,0)
=Not specified
"^DD",9002313.02,9002313.0201,425,21,5,0)
1=Single source brand
"^DD",9002313.02,9002313.0201,425,21,6,0)
2=Branded generic
"^DD",9002313.02,9002313.0201,425,21,7,0)
3=Generic
"^DD",9002313.02,9002313.0201,425,21,8,0)
4=O.T.C. (over the counter)
"^DD",9002313.02,9002313.0201,425,"DT")
3010125
"^DD",9002313.02,9002313.0201,426,0)
Usual & Customary Charge^F^^400;26^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,426,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,426,21,0)
^^4^4^3031203^
"^DD",9002313.02,9002313.0201,426,21,1,0)
Amount charged cash
"^DD",9002313.02,9002313.0201,426,21,2,0)
customers for the prescription
"^DD",9002313.02,9002313.0201,426,21,3,0)
exclusive of sales tax or other
"^DD",9002313.02,9002313.0201,426,21,4,0)
amounts claimed.
"^DD",9002313.02,9002313.0201,426,"DT")
3020726
"^DD",9002313.02,9002313.0201,427,0)
Prescriber Last Name^F^^420;27^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.02,9002313.0201,427,3)
Answer must be 1-17 characters in length.
"^DD",9002313.02,9002313.0201,427,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,427,21,1,0)
Last Name of the Prescriber
"^DD",9002313.02,9002313.0201,427,"DT")
3010125
"^DD",9002313.02,9002313.0201,428,0)
Postage Amt. Claimed^F^^420;28^K:$L(X)>6!($L(X)<1) X
"^DD",9002313.02,9002313.0201,428,3)
Answer must be 1-6 characters in length.
"^DD",9002313.02,9002313.0201,428,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,428,21,1,0)
Dollar amount of postage
"^DD",9002313.02,9002313.0201,428,21,2,0)
claimed.
"^DD",9002313.02,9002313.0201,428,"DT")
3010125
"^DD",9002313.02,9002313.0201,429,0)
Unit Dose Indicator^F^^400;29^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,429,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,429,21,0)
^^7^7^3031203^
"^DD",9002313.02,9002313.0201,429,21,1,0)
Code indicating the type of unit
"^DD",9002313.02,9002313.0201,429,21,2,0)
dose dispensing.
"^DD",9002313.02,9002313.0201,429,21,3,0)
 
"^DD",9002313.02,9002313.0201,429,21,4,0)
=Not Specified
"^DD",9002313.02,9002313.0201,429,21,5,0)
1=Not Unit Dose
"^DD",9002313.02,9002313.0201,429,21,6,0)
2=Manufacturer Unit Dose
"^DD",9002313.02,9002313.0201,429,21,7,0)
3=Pharmacy Unit Dose
"^DD",9002313.02,9002313.0201,429,"DT")
2950410
"^DD",9002313.02,9002313.0201,430,0)
Gross Amount Due^F^^400;30^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,430,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,430,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,430,21,1,0)
Total amount submitted to the
"^DD",9002313.02,9002313.0201,430,21,2,0)
payer.
"^DD",9002313.02,9002313.0201,430,"DT")
3020726
"^DD",9002313.02,9002313.0201,431,0)
Other Payer Amount^F^^430;1^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,431,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,431,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,431,21,1,0)
Amount of any payment known
"^DD",9002313.02,9002313.0201,431,21,2,0)
by the pharmacy from other
"^DD",9002313.02,9002313.0201,431,21,3,0)
sources (including coupons).
"^DD",9002313.02,9002313.0201,431,"DT")
3020726
"^DD",9002313.02,9002313.0201,432,0)
Basis of Days Supply Det^F^^420;32^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.02,9002313.0201,432,3)
Answer must be 1-3 characters in length.
"^DD",9002313.02,9002313.0201,432,21,0)
^^9^9^3031203^
"^DD",9002313.02,9002313.0201,432,21,1,0)
Code indicating the method by
"^DD",9002313.02,9002313.0201,432,21,2,0)
which the days supply was
"^DD",9002313.02,9002313.0201,432,21,3,0)
determined.
"^DD",9002313.02,9002313.0201,432,21,4,0)
 
"^DD",9002313.02,9002313.0201,432,21,5,0)
=Not specified
"^DD",9002313.02,9002313.0201,432,21,6,0)
1=Explicit directions
"^DD",9002313.02,9002313.0201,432,21,7,0)
2=PRN directions (take as needed
"^DD",9002313.02,9002313.0201,432,21,8,0)
pharmacist estimate)
"^DD",9002313.02,9002313.0201,432,21,9,0)
3=As directed by physician
"^DD",9002313.02,9002313.0201,432,"DT")
3010125
"^DD",9002313.02,9002313.0201,433,0)
Patient Paid Amount Submitted^F^^430;3^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,433,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,433,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,433,21,1,0)
Amount the pharmacy
"^DD",9002313.02,9002313.0201,433,21,2,0)
received from the patient for
"^DD",9002313.02,9002313.0201,433,21,3,0)
the prescription dispensed.
"^DD",9002313.02,9002313.0201,433,"DT")
3020726
"^DD",9002313.02,9002313.0201,434,0)
Date of Injury^F^^430;4^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.02,9002313.0201,434,3)
Answer must be 1-10 characters in length.
"^DD",9002313.02,9002313.0201,434,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,434,21,1,0)
Date on which the injury
"^DD",9002313.02,9002313.0201,434,21,2,0)
occurred.
"^DD",9002313.02,9002313.0201,434,"DT")
3020726
"^DD",9002313.02,9002313.0201,435,0)
Claim/Ref ID Number^F^^430;5^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.02,9002313.0201,435,3)
Answer must be 1-30 characters in length.
"^DD",9002313.02,9002313.0201,435,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,435,21,1,0)
Identifies the claim number
"^DD",9002313.02,9002313.0201,435,21,2,0)
assigned by Workers
"^DD",9002313.02,9002313.0201,435,21,3,0)
Compensation Program.
"^DD",9002313.02,9002313.0201,435,"DT")
3020726
"^DD",9002313.02,9002313.0201,436,0)
Product/Service ID Qualifier^F^^430;6^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.02,9002313.0201,436,3)
Answer must be 1-3 characters in length.
"^DD",9002313.02,9002313.0201,436,21,0)
^^33^33^3031203^
"^DD",9002313.02,9002313.0201,436,21,1,0)
Code qualifying the value in
"^DD",9002313.02,9002313.0201,436,21,2,0)
'Product/Service ID' (47-D7)
"^DD",9002313.02,9002313.0201,436,21,3,0)
 
"^DD",9002313.02,9002313.0201,436,21,4,0)
Not Specified Blank
"^DD",9002313.02,9002313.0201,436,21,5,0)
Not Specified 
"^DD",9002313.02,9002313.0201,436,21,6,0)
Universal Product Code (UPC) 1
"^DD",9002313.02,9002313.0201,436,21,7,0)
Health Related Item (HRI) 2
"^DD",9002313.02,9002313.0201,436,21,8,0)
National Drug Code (NDC) 3
"^DD",9002313.02,9002313.0201,436,21,9,0)
Universal Product Number (UPN) 4
"^DD",9002313.02,9002313.0201,436,21,10,0)
Department of Defense (DOD) 5
"^DD",9002313.02,9002313.0201,436,21,11,0)
Drug Use Review/ Professional Pharmacy Service (DUR/PPS) 6
"^DD",9002313.02,9002313.0201,436,21,12,0)
Common Procedure Terminology (CPT4) 7
"^DD",9002313.02,9002313.0201,436,21,13,0)
Common Procedure Terminology (CPT5) 8
"^DD",9002313.02,9002313.0201,436,21,14,0)
Health Care Financing Administration Common Procedural
"^DD",9002313.02,9002313.0201,436,21,15,0)
Coding System (HCPCS)
"^DD",9002313.02,9002313.0201,436,21,16,0)
9
"^DD",9002313.02,9002313.0201,436,21,17,0)
Pharmacy Practice Activity Classification (PPAC) 1
"^DD",9002313.02,9002313.0201,436,21,18,0)
National Pharmaceutical Product Interface Code(NAPPI) 11
"^DD",9002313.02,9002313.0201,436,21,19,0)
International Article Numbering System(EAN) 12
"^DD",9002313.02,9002313.0201,436,21,20,0)
Drug Identification Number(DIN) 13
"^DD",9002313.02,9002313.0201,436,21,21,0)
Medi-Span GPI 14
"^DD",9002313.02,9002313.0201,436,21,22,0)
First DataBank GCN 15
"^DD",9002313.02,9002313.0201,436,21,23,0)
Medical Economics GPO 16
"^DD",9002313.02,9002313.0201,436,21,24,0)
Medi-Span DDID 17
"^DD",9002313.02,9002313.0201,436,21,25,0)
First DataBank SmartKey 18
"^DD",9002313.02,9002313.0201,436,21,26,0)
Medical Economics GM 19
"^DD",9002313.02,9002313.0201,436,21,27,0)
International Classification of Diseases(ICD9) 2
"^DD",9002313.02,9002313.0201,436,21,28,0)
International Classification of Diseases (ICD10) 21
"^DD",9002313.02,9002313.0201,436,21,29,0)
Medi-Span Diagnosis Code 22
"^DD",9002313.02,9002313.0201,436,21,30,0)
Common Dental Terminology (CDT) 25
"^DD",9002313.02,9002313.0201,436,21,31,0)
American Psychiatric Association Diagnostic Statistical Manual
"^DD",9002313.02,9002313.0201,436,21,32,0)
of Mental Disorders (DSM IV)
"^DD",9002313.02,9002313.0201,436,21,33,0)
Other                       99
"^DD",9002313.02,9002313.0201,436,"DT")
3020726
"^DD",9002313.02,9002313.0201,437,0)
Alternate Product Code^F^^430;7^K:$L(X)>13!($L(X)<1) X
"^DD",9002313.02,9002313.0201,437,3)
Answer must be 1-13 characters in length.
"^DD",9002313.02,9002313.0201,437,21,0)
^^7^7^3031203^
"^DD",9002313.02,9002313.0201,437,21,1,0)
This field identifies the actual product
"^DD",9002313.02,9002313.0201,437,21,2,0)
code for the item that was dispensed.
"^DD",9002313.02,9002313.0201,437,21,3,0)
The type of product is defined by field
"^DD",9002313.02,9002313.0201,437,21,4,0)
436-E1. This field should only be used
"^DD",9002313.02,9002313.0201,437,21,5,0)
if the National Drug Code number is not
"^DD",9002313.02,9002313.0201,437,21,6,0)
available. The code number here is the
"^DD",9002313.02,9002313.0201,437,21,7,0)
UPC number or the HRI number.
"^DD",9002313.02,9002313.0201,437,"DT")
3020726
"^DD",9002313.02,9002313.0201,438,0)
Incentive Amount Submitted^F^^430;8^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.02,9002313.0201,438,3)
Answer must be 6-8 characters in length.
"^DD",9002313.02,9002313.0201,438,21,0)
^^6^6^3031203^
"^DD",9002313.02,9002313.0201,438,21,1,0)
Amount represents a fee that
"^DD",9002313.02,9002313.0201,438,21,2,0)
is submitted by the pharmacy
"^DD",9002313.02,9002313.0201,438,21,3,0)
for contractually agreed upon
"^DD",9002313.02,9002313.0201,438,21,4,0)
services. This amount is
"^DD",9002313.02,9002313.0201,438,21,5,0)
included in the 'Gross Amount
"^DD",9002313.02,9002313.0201,438,21,6,0)
Due' (43-DU).
"^DD",9002313.02,9002313.0201,438,"DT")
3020726
"^DD",9002313.02,9002313.0201,439,0)
Reason for Service Code^F^^430;9^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,439,3)
Answer must be 4 characters in length.
"^DD",9002313.02,9002313.0201,439,21,0)
^^4^4^3031203^
"^DD",9002313.02,9002313.0201,439,21,1,0)
Code identifying the type of
"^DD",9002313.02,9002313.0201,439,21,2,0)
utilization conflict detected or
"^DD",9002313.02,9002313.0201,439,21,3,0)
the reason for the pharmacist s
"^DD",9002313.02,9002313.0201,439,21,4,0)
professional service.
"^DD",9002313.02,9002313.0201,439,"DT")
3020726
"^DD",9002313.02,9002313.0201,440,0)
Professional Service Code^F^^430;10^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,440,3)
Answer must be 4 characters in length.
"^DD",9002313.02,9002313.0201,440,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,440,21,1,0)
Code to indicate whether the service provided was professional or 
"^DD",9002313.02,9002313.0201,440,21,2,0)
institutional.
"^DD",9002313.02,9002313.0201,440,"DT")
3020726
"^DD",9002313.02,9002313.0201,441,0)
Result of Service Code^F^^440;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,441,3)
Answer must be 4 characters in length.
"^DD",9002313.02,9002313.0201,441,21,0)
^^4^4^3031203^
"^DD",9002313.02,9002313.0201,441,21,1,0)
Action taken by a pharmacist
"^DD",9002313.02,9002313.0201,441,21,2,0)
in response to a conflict or the
"^DD",9002313.02,9002313.0201,441,21,3,0)
result of a pharmacist s
"^DD",9002313.02,9002313.0201,441,21,4,0)
professional service.
"^DD",9002313.02,9002313.0201,441,"DT")
3020726
"^DD",9002313.02,9002313.0201,442,0)
Quantity Dispensed^F^^440;2^K:$L(X)>10!($L(X)<8) X
"^DD",9002313.02,9002313.0201,442,3)
Answer must be 8-10 characters in length.
"^DD",9002313.02,9002313.0201,442,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,442,21,1,0)
Quantity dispensed expressed
"^DD",9002313.02,9002313.0201,442,21,2,0)
in metric decimal units.
"^DD",9002313.02,9002313.0201,442,"DT")
3020726
"^DD",9002313.02,9002313.0201,443,0)
Other Payer Date^F^^440;3^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,443,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,443,21,0)
^^4^4^3031203^
"^DD",9002313.02,9002313.0201,443,21,1,0)
Payment or denial date of the
"^DD",9002313.02,9002313.0201,443,21,2,0)
claim submitted to the other
"^DD",9002313.02,9002313.0201,443,21,3,0)
payer. Used for coordination of
"^DD",9002313.02,9002313.0201,443,21,4,0)
benefits.
"^DD",9002313.02,9002313.0201,443,"DT")
3020726
"^DD",9002313.02,9002313.0201,444,0)
Provider ID^F^^440;4^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,444,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,444,21,0)
^^4^4^3031203^
"^DD",9002313.02,9002313.0201,444,21,1,0)
Unique ID assigned to the
"^DD",9002313.02,9002313.0201,444,21,2,0)
person responsible for the
"^DD",9002313.02,9002313.0201,444,21,3,0)
dispensing of the prescription
"^DD",9002313.02,9002313.0201,444,21,4,0)
or provision of the service.
"^DD",9002313.02,9002313.0201,444,"DT")
3020730
"^DD",9002313.02,9002313.0201,445,0)
Orig Pres Prod/Srv Cd^F^^440;5^K:$L(X)>19!($L(X)<19) X
"^DD",9002313.02,9002313.0201,445,3)
Answer must be 19 characters in length.
"^DD",9002313.02,9002313.0201,445,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,445,21,1,0)
Code of the initially prescribed
"^DD",9002313.02,9002313.0201,445,21,2,0)
product or service.
"^DD",9002313.02,9002313.0201,445,"DT")
3020730
"^DD",9002313.02,9002313.0201,446,0)
Originally Prescribed Quantity^F^^440;6^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,446,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0201,446,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,446,21,1,0)
Product initially prescribed
"^DD",9002313.02,9002313.0201,446,21,2,0)
amount expressed in metric
"^DD",9002313.02,9002313.0201,446,21,3,0)
decimal units.
"^DD",9002313.02,9002313.0201,446,"DT")
3020730
"^DD",9002313.02,9002313.0201,447,0)
Comp Ingred Component Cnt^F^^440;7^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,447,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,447,21,0)
^.001^4^4^3031216^^
"^DD",9002313.02,9002313.0201,447,21,1,0)
Count of compound product
"^DD",9002313.02,9002313.0201,447,21,2,0)
IDs (both active and inactive)
"^DD",9002313.02,9002313.0201,447,21,3,0)
in the compound mixture
"^DD",9002313.02,9002313.0201,447,21,4,0)
submitted.
"^DD",9002313.02,9002313.0201,447,"DT")
3020730
"^DD",9002313.02,9002313.0201,447.01,0)
Compound Repeating Fields^9002313.0501A^^447;0
"^DD",9002313.02,9002313.0201,447.01,"DT")
3021031
"^DD",9002313.02,9002313.0201,450,0)
Compound Dosage Form Desc Cd^F^^440;10^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,450,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,450,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,450,21,1,0)
Description of the compound ingredients.
"^DD",9002313.02,9002313.0201,450,"DT")
3020730
"^DD",9002313.02,9002313.0201,451,0)
Compound Disp Unit Form Ind^F^^450;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,451,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,451,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,451,21,1,0)
NCPDP standard product
"^DD",9002313.02,9002313.0201,451,21,2,0)
billing codes.
"^DD",9002313.02,9002313.0201,451,"DT")
3020730
"^DD",9002313.02,9002313.0201,452,0)
Compound Route of Admin^F^^450;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,452,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,452,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,452,21,1,0)
Code for the route of
"^DD",9002313.02,9002313.0201,452,21,2,0)
administration of the complete
"^DD",9002313.02,9002313.0201,452,21,3,0)
compound mixture.
"^DD",9002313.02,9002313.0201,452,"DT")
3020730
"^DD",9002313.02,9002313.0201,453,0)
Orig Pres/Serv ID Qual^F^^450;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,453,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,453,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,453,21,1,0)
Code qualifying the value in 'Originally Prescribed
"^DD",9002313.02,9002313.0201,453,21,2,0)
Product/Service Code  (Field 445-EA).
"^DD",9002313.02,9002313.0201,453,"DT")
3020730
"^DD",9002313.02,9002313.0201,454,0)
Scheduled Pres ID Number^F^^450;4^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,454,3)
Answer must be 12 characters in length.
"^DD",9002313.02,9002313.0201,454,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,454,21,1,0)
The serial number of the prescription blank/form.
"^DD",9002313.02,9002313.0201,454,"DT")
3020730
"^DD",9002313.02,9002313.0201,455,0)
Pres/Srv Ref Number Qual^F^^450;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,455,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,455,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,455,21,1,0)
Indicates the type of billing submitted.
"^DD",9002313.02,9002313.0201,455,"DT")
3020730
"^DD",9002313.02,9002313.0201,456,0)
Assoc Pres/Srv Ref Number^F^^450;6^K:$L(X)>7!($L(X)<7) X
"^DD",9002313.02,9002313.0201,456,3)
Answer must be 7 characters in length.
"^DD",9002313.02,9002313.0201,456,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0201,456,21,1,0)
Related  Prescription/Service Reference Number  (42-D2)
"^DD",9002313.02,9002313.0201,456,21,2,0)
to which the service is associated.
"^DD",9002313.02,9002313.0201,456,"DT")
3020730
"^DD",9002313.02,9002313.0201,457,0)
Assoc Pres/Srv Date^F^^450;7^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,457,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,457,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,457,21,1,0)
Date of the Associated Prescription/Service Reference Number.
"^DD",9002313.02,9002313.0201,457,"DT")
3020730
"^DD",9002313.02,9002313.0201,458,0)
Procedure Mod Code Cnt^F^^450;8^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,458,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,458,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0201,458,21,1,0)
Count of the  Procedure
"^DD",9002313.02,9002313.0201,458,21,2,0)
Modifier Code  (459-ER)
"^DD",9002313.02,9002313.0201,458,21,3,0)
occurrences.
"^DD",9002313.02,9002313.0201,458,"DT")
3020730
"^DD",9002313.02,9002313.0201,459,0)
Procedure Modifier Code^9002313.201459A^^459;0
"^DD",9002313.02,9002313.0201,459,21,0)
^^1^1^3031216^
"^DD",9002313.02,9002313.0201,459,21,1,0)
Multiple for storing procedure code information.
"^DD",9002313.02,9002313.0201,460,0)
Quantity Prescribed^F^^450;10^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,460,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0201,460,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,460,21,1,0)
Quantity prescribed during order entry.
"^DD",9002313.02,9002313.0201,460,"DT")
3020730
"^DD",9002313.02,9002313.0201,461,0)
Prior Authorization Type Code^F^^460;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,461,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,461,21,0)
^^1^1^3031203^
"^DD",9002313.02,9002313.0201,461,21,1,0)
Code clarifying the  Prior Authorization Number  (462- EV).
"^DD",9002313.02,9002313.0201,461,"DT")
3020730
"^DD",9002313.02,9002313.0201,462,0)
Prior Authorization Num Sub^F^^460;2^K:$L(X)>11!($L(X)<11) X
"^DD",9002313.02,9002313.0201,462,3)
Answer must be 11 characters in length.
"^DD",9002313.02,9002313.0201,462,21,0)
^^3^3^3031204^
"^DD",9002313.02,9002313.0201,462,21,1,0)
Number submitted by the
"^DD",9002313.02,9002313.0201,462,21,2,0)
provider to identify the prior
"^DD",9002313.02,9002313.0201,462,21,3,0)
authorization.
"^DD",9002313.02,9002313.0201,462,"DT")
3020730
"^DD",9002313.02,9002313.0201,463,0)
Intermediary Auth Type ID^F^^460;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,463,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,463,21,0)
^^3^3^3031204^
"^DD",9002313.02,9002313.0201,463,21,1,0)
Value indicating that
"^DD",9002313.02,9002313.0201,463,21,2,0)
authorization occurred for
"^DD",9002313.02,9002313.0201,463,21,3,0)
intermediary processing.
"^DD",9002313.02,9002313.0201,463,"DT")
3020730
"^DD",9002313.02,9002313.0201,464,0)
Intermediary Auth ID^F^^460;4^K:$L(X)>11!($L(X)<11) X
"^DD",9002313.02,9002313.0201,464,3)
Answer must be 11 characters in length.
"^DD",9002313.02,9002313.0201,464,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,464,21,1,0)
Value indicating intermediary
"^DD",9002313.02,9002313.0201,464,21,2,0)
authorization occurred.
"^DD",9002313.02,9002313.0201,464,"DT")
3020730
"^DD",9002313.02,9002313.0201,465,0)
Provider ID Qualifier^F^^460;5^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,465,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,465,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,465,21,1,0)
Code qualifying the  Provider ID  (444-E9).
"^DD",9002313.02,9002313.0201,465,"DT")
3020730
"^DD",9002313.02,9002313.0201,466,0)
Prescriber ID Qualifier^F^^460;6^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,466,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,466,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,466,21,1,0)
Code qualifying the  Prescriber ID  (411-DB).
"^DD",9002313.02,9002313.0201,466,"DT")
3020730
"^DD",9002313.02,9002313.0201,467,0)
Prescriber Location Code^F^^460;7^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,467,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.0201,467,21,0)
^^4^4^3031204^
"^DD",9002313.02,9002313.0201,467,21,1,0)
Location address code
"^DD",9002313.02,9002313.0201,467,21,2,0)
assigned to the prescriber as
"^DD",9002313.02,9002313.0201,467,21,3,0)
identified in the National
"^DD",9002313.02,9002313.0201,467,21,4,0)
Provider System (NPS).
"^DD",9002313.02,9002313.0201,467,"DT")
3020730
"^DD",9002313.02,9002313.0201,468,0)
Primary Care Prov ID Qual^F^^460;8^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,468,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,468,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,468,21,1,0)
Code qualifying the  Primary Care Provider ID  (421-DL).
"^DD",9002313.02,9002313.0201,468,"DT")
3020730
"^DD",9002313.02,9002313.0201,469,0)
Primary Care Prov Loc Cd^F^^460;9^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,469,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.0201,469,21,0)
^.001^5^5^3031216^^
"^DD",9002313.02,9002313.0201,469,21,1,0)
Location address code
"^DD",9002313.02,9002313.0201,469,21,2,0)
assigned to the primary care
"^DD",9002313.02,9002313.0201,469,21,3,0)
provider as identified in the
"^DD",9002313.02,9002313.0201,469,21,4,0)
National Provider System
"^DD",9002313.02,9002313.0201,469,21,5,0)
(NPS).
"^DD",9002313.02,9002313.0201,469,"DT")
3020730
"^DD",9002313.02,9002313.0201,470,0)
Primary Care Prov Last Name^F^^460;10^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,470,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,470,21,0)
^^1^1^3031216^
"^DD",9002313.02,9002313.0201,470,21,1,0)
Last name of the Primary Care Provider
"^DD",9002313.02,9002313.0201,470,"DT")
3020730
"^DD",9002313.02,9002313.0201,471,0)
Other Payer Reject Count^F^^470;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,471,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,471,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,471,21,1,0)
Count of  Other Payer Reject Code  (472-6E) occurrences.
"^DD",9002313.02,9002313.0201,471,"DT")
3020730
"^DD",9002313.02,9002313.0201,473.01,0)
DUR/PPS Repeating Fields^9002313.1001A^^473.01;0
"^DD",9002313.02,9002313.0201,473.01,21,0)
^.001^1^1^3040126^^
"^DD",9002313.02,9002313.0201,473.01,21,1,0)
Count of Drug Utilization sub-records.
"^DD",9002313.02,9002313.0201,477,0)
Professional Srv Fee Submitted^F^^470;7^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,477,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,477,21,0)
^^3^3^3031204^
"^DD",9002313.02,9002313.0201,477,21,1,0)
Amount submitted by the
"^DD",9002313.02,9002313.0201,477,21,2,0)
provider for professional
"^DD",9002313.02,9002313.0201,477,21,3,0)
services rendered.
"^DD",9002313.02,9002313.0201,477,"DT")
3020730
"^DD",9002313.02,9002313.0201,478,0)
Other Amt Claimed Sub Cnt^F^^470;8^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,478,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,478,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,478,21,1,0)
Count of other amount claimed submitted occurrences.
"^DD",9002313.02,9002313.0201,478,"DT")
3020730
"^DD",9002313.02,9002313.0201,478.01,0)
Pricing Repeating Section^9002313.0601A^^478.01;0
"^DD",9002313.02,9002313.0201,478.01,21,0)
^.001^1^1^3040126^^
"^DD",9002313.02,9002313.0201,478.01,21,1,0)
Pricing record information counter.
"^DD",9002313.02,9002313.0201,481,0)
Flat Sales Tax Amt Sub^F^^480;1^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,481,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,481,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,481,21,1,0)
Flat sales tax submitted for prescription. This amount is
"^DD",9002313.02,9002313.0201,481,21,2,0)
included in the  Gross Amount Due  (43-DU).
"^DD",9002313.02,9002313.0201,481,"DT")
3020730
"^DD",9002313.02,9002313.0201,482,0)
Percentage Sales Tax Amt Sub^F^^480;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,482,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,482,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,482,21,1,0)
Percentage sales tax submitted.
"^DD",9002313.02,9002313.0201,482,"DT")
3020730
"^DD",9002313.02,9002313.0201,483,0)
Percentage Sales Tax Rate Sub^F^^480;3^K:$L(X)>7!($L(X)<7) X
"^DD",9002313.02,9002313.0201,483,3)
Answer must be 7 characters in length.
"^DD",9002313.02,9002313.0201,483,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,483,21,1,0)
Percentage sales tax rate used to calculate  Percentage Sales
"^DD",9002313.02,9002313.0201,483,21,2,0)
Tax Amount Submitted  (482- GE
"^DD",9002313.02,9002313.0201,483,"DT")
3020730
"^DD",9002313.02,9002313.0201,484,0)
Percentage Sales Tax Basis Sub^F^^480;4^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,484,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,484,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,484,21,1,0)
Code indicating the basis for percentage sales tax.
"^DD",9002313.02,9002313.0201,484,"DT")
3020730
"^DD",9002313.02,9002313.0201,485,0)
Coupon Type^F^^480;5^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,485,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,485,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,485,21,1,0)
Code indicating the type of coupon being used.
"^DD",9002313.02,9002313.0201,485,"DT")
3020730
"^DD",9002313.02,9002313.0201,486,0)
Coupon Number^F^^480;6^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,486,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,486,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,486,21,1,0)
Unique serial number assigned to the prescription coupons.
"^DD",9002313.02,9002313.0201,486,"DT")
3020730
"^DD",9002313.02,9002313.0201,487,0)
Coupon Value Amount^F^^480;7^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,487,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,487,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,487,21,1,0)
Value of the coupon.
"^DD",9002313.02,9002313.0201,487,"DT")
3020730
"^DD",9002313.02,9002313.0201,491,0)
Diagnosis Code Count^F^^490;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,491,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,491,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,491,21,1,0)
Count of diagnosis occurrences.
"^DD",9002313.02,9002313.0201,491,"DT")
3020730
"^DD",9002313.02,9002313.0201,491.01,0)
Clinical Diagnosis Repeating^9002313.0701A^^491.01;0
"^DD",9002313.02,9002313.0201,491.01,21,0)
^.001^1^1^3040126^^^
"^DD",9002313.02,9002313.0201,491.01,21,1,0)
Count of Diagnosis sub-records.
"^DD",9002313.02,9002313.0201,493.01,0)
Clinical Information Repeating^9002313.0801A^^493.01;0
"^DD",9002313.02,9002313.0201,493.01,21,0)
^.001^1^1^3040126^^^
"^DD",9002313.02,9002313.0201,493.01,21,1,0)
Count of clinical information sub-records.
"^DD",9002313.02,9002313.0201,498.01,0)
Request Type^F^^498;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,498.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,498.01,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,498.01,21,1,0)
Code identifying type of prior
"^DD",9002313.02,9002313.0201,498.01,21,2,0)
authorization request.
"^DD",9002313.02,9002313.0201,498.01,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.02,0)
Request Period Date-Begin^F^^498;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,498.02,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,498.02,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,498.02,21,1,0)
Beginning date for a prior
"^DD",9002313.02,9002313.0201,498.02,21,2,0)
authorization request.
"^DD",9002313.02,9002313.0201,498.02,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.03,0)
Request Period Date-End^F^^498;3^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,498.03,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0201,498.03,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,498.03,21,1,0)
End date for a prior
"^DD",9002313.02,9002313.0201,498.03,21,2,0)
authorization request.
"^DD",9002313.02,9002313.0201,498.03,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.04,0)
Basis of Request^F^^498;4^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,498.04,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,498.04,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,498.04,21,1,0)
Code describing the reason for
"^DD",9002313.02,9002313.0201,498.04,21,2,0)
prior authorization request.
"^DD",9002313.02,9002313.0201,498.04,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.05,0)
Authorized Rep First Name^F^^498;5^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,498.05,3)
Answer must be 12 characters in length.
"^DD",9002313.02,9002313.0201,498.05,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,498.05,21,1,0)
First name of the patients authorized representative.
"^DD",9002313.02,9002313.0201,498.05,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.06,0)
Authorized Rep Last Name^F^^498;6^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,498.06,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,498.06,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,498.06,21,1,0)
Last name of the patients authorized representative.
"^DD",9002313.02,9002313.0201,498.06,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.07,0)
Authorized Rep Street Address^F^^498;7^K:$L(X)>30!($L(X)<30) X
"^DD",9002313.02,9002313.0201,498.07,3)
Answer must be 30 characters in length.
"^DD",9002313.02,9002313.0201,498.07,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,498.07,21,1,0)
Free-form text for address information.
"^DD",9002313.02,9002313.0201,498.07,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.08,0)
Authorized Rep City Address^F^^498;8^K:$L(X)>20!($L(X)<20) X
"^DD",9002313.02,9002313.0201,498.08,3)
Answer must be 20 characters in length.
"^DD",9002313.02,9002313.0201,498.08,21,0)
^.001^1^1^3031204^^
"^DD",9002313.02,9002313.0201,498.08,21,1,0)
Free-form text for city name.
"^DD",9002313.02,9002313.0201,498.08,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.09,0)
Authorized Rep State/Prov^F^^498;9^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,498.09,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,498.09,21,0)
^^1^1^3040331^
"^DD",9002313.02,9002313.0201,498.09,21,1,0)
Authorized Rep's State or Province
"^DD",9002313.02,9002313.0201,498.09,"DT")
3040331
"^DD",9002313.02,9002313.0201,498.11,0)
Authorized Rep Zip/Postal Zone^F^^498;11^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0201,498.11,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0201,498.11,21,0)
^^1^1^3040331^
"^DD",9002313.02,9002313.0201,498.11,21,1,0)
Authorized Rep's Zip Code
"^DD",9002313.02,9002313.0201,498.11,"DT")
3040331
"^DD",9002313.02,9002313.0201,498.12,0)
Prescriber Phone Number^F^^498;12^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,498.12,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0201,498.12,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0201,498.12,21,1,0)
Ten digit phone number of the
"^DD",9002313.02,9002313.0201,498.12,21,2,0)
prescriber.
"^DD",9002313.02,9002313.0201,498.12,"DT")
3020730
"^DD",9002313.02,9002313.0201,498.13,0)
Prior Auth Supporting Doc^9002313.0901^^498.13;0
"^DD",9002313.02,9002313.0201,498.14,0)
Prior Auth Number Assigned^F^^498;14^K:$L(X)>11!($L(X)<11) X
"^DD",9002313.02,9002313.0201,498.14,3)
Answer must be 11 characters in length.
"^DD",9002313.02,9002313.0201,498.14,21,0)
^^3^3^3031204^
"^DD",9002313.02,9002313.0201,498.14,21,1,0)
Unique number identifying the
"^DD",9002313.02,9002313.0201,498.14,21,2,0)
prior authorization assigned by
"^DD",9002313.02,9002313.0201,498.14,21,3,0)
the processor.
"^DD",9002313.02,9002313.0201,498.14,"DT")
3020730
"^DD",9002313.02,9002313.0201,503,0)
Authorization Number^F^^500;3^K:$L(X)>20!($L(X)<20) X
"^DD",9002313.02,9002313.0201,503,3)
Answer must be 20 characters in length.
"^DD",9002313.02,9002313.0201,503,21,0)
^^3^3^3031204^
"^DD",9002313.02,9002313.0201,503,21,1,0)
Unique number identifying the
"^DD",9002313.02,9002313.0201,503,21,2,0)
prior authorization assigned by
"^DD",9002313.02,9002313.0201,503,21,3,0)
the processor.
"^DD",9002313.02,9002313.0201,503,"DT")
3020730
"^DD",9002313.02,9002313.0201,600,0)
Unit of Measure^F^^600;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0201,600,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0201,600,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0201,600,21,1,0)
Unit of measure of the prescription.
"^DD",9002313.02,9002313.0201,600,"DT")
3020730
"^DD",9002313.02,9002313.0401,0)
COB/Other Payments   SUB-FIELD^^472^9
"^DD",9002313.02,9002313.0401,0,"DT")
3020731
"^DD",9002313.02,9002313.0401,0,"IX","B",9002313.0401,.01)

"^DD",9002313.02,9002313.0401,0,"NM","COB/Other Payments  ")

"^DD",9002313.02,9002313.0401,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0401,.01,0)
COB/Other Paymnt Cntr^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0401,.01,1,0)
^.1
"^DD",9002313.02,9002313.0401,.01,1,1,0)
9002313.0401^B
"^DD",9002313.02,9002313.0401,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),337,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0401,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),337,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0401,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0401,.01,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,.01,21,1,0)
Count of other payment occurrences.
"^DD",9002313.02,9002313.0401,.01,"DT")
3031125
"^DD",9002313.02,9002313.0401,338,0)
Other Payer Coverage Type^F^^0;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0401,338,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0401,338,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,338,21,1,0)
Code identifying the type of 'Other Payer ID' (34).
"^DD",9002313.02,9002313.0401,338,"DT")
3031125
"^DD",9002313.02,9002313.0401,339,0)
Other Payer ID Qualifier^F^^0;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0401,339,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0401,339,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,339,21,1,0)
Code qualifying  the 'Other Payer ID' (34).
"^DD",9002313.02,9002313.0401,339,"DT")
3031125
"^DD",9002313.02,9002313.0401,340,0)
Other Payer ID^F^^0;4^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0401,340,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0401,340,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,340,21,1,0)
ID assigned to the payer.
"^DD",9002313.02,9002313.0401,340,"DT")
3031125
"^DD",9002313.02,9002313.0401,341,0)
Other Payer Amt Paid Cnt^F^^0;6^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0401,341,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0401,341,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,341,21,1,0)
Count of the payer amount paid occurrences.
"^DD",9002313.02,9002313.0401,341,"DT")
3031125
"^DD",9002313.02,9002313.0401,342,0)
Other Payer Amt Paid Qual^9002313.401342A^^1;0
"^DD",9002313.02,9002313.0401,443,0)
Other Payer Date^F^^0;5^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0401,443,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0401,443,21,0)
^^2^2^3031125^
"^DD",9002313.02,9002313.0401,443,21,1,0)
Payment or denial date of the claim submitted to the other payer. Used 
"^DD",9002313.02,9002313.0401,443,21,2,0)
for coordination of benefits.
"^DD",9002313.02,9002313.0401,443,"DT")
3031125
"^DD",9002313.02,9002313.0401,471,0)
Other Payer Reject Count^F^^0;7^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0401,471,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0401,471,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,471,21,1,0)
Count of 'Other Payer Reject Code' (472) occurrences.
"^DD",9002313.02,9002313.0401,471,"DT")
3031125
"^DD",9002313.02,9002313.0401,472,0)
Other Payer Reject Code^9002313.401472A^^2;0
"^DD",9002313.02,9002313.0501,0)
Compound Repeating Fields SUB-FIELD^^490^6
"^DD",9002313.02,9002313.0501,0,"DT")
3020731
"^DD",9002313.02,9002313.0501,0,"IX","B",9002313.0501,.01)

"^DD",9002313.02,9002313.0501,0,"NM","Compound Repeating Fields")

"^DD",9002313.02,9002313.0501,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0501,.01,0)
Compound Repeating Count^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0501,.01,1,0)
^.1
"^DD",9002313.02,9002313.0501,.01,1,1,0)
9002313.0501^B
"^DD",9002313.02,9002313.0501,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),447,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0501,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),447,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0501,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0501,.01,21,0)
^^1^1^3031216^
"^DD",9002313.02,9002313.0501,.01,21,1,0)
Count of Compounds for this medication.
"^DD",9002313.02,9002313.0501,.01,"DT")
3020801
"^DD",9002313.02,9002313.0501,448,0)
Compound Ingredient Quantity^F^^0;4^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0501,448,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.0501,448,21,0)
^^4^4^3031203^
"^DD",9002313.02,9002313.0501,448,21,1,0)
Amount expressed in metric
"^DD",9002313.02,9002313.0501,448,21,2,0)
decimal units of the product
"^DD",9002313.02,9002313.0501,448,21,3,0)
included in the compound
"^DD",9002313.02,9002313.0501,448,21,4,0)
mixture
"^DD",9002313.02,9002313.0501,448,"DT")
3020731
"^DD",9002313.02,9002313.0501,449,0)
Compound Ingredient Drug Cost^F^^0;5^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0501,449,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0501,449,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0501,449,21,1,0)
Ingredient cost for the metric decimal quantity of the product
"^DD",9002313.02,9002313.0501,449,21,2,0)
included in the compound mixture indicated in Compound Ingredient
"^DD",9002313.02,9002313.0501,449,21,3,0)
Quantity  (Field 448-ED).
"^DD",9002313.02,9002313.0501,449,"DT")
3020731
"^DD",9002313.02,9002313.0501,488,0)
Compound Product ID Qualifier^F^^0;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0501,488,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0501,488,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0501,488,21,1,0)
Code qualifying the type of
"^DD",9002313.02,9002313.0501,488,21,2,0)
product dispensed.
"^DD",9002313.02,9002313.0501,488,"DT")
3020731
"^DD",9002313.02,9002313.0501,489,0)
Compound Product ID  ^F^^0;3^K:$L(X)>19!($L(X)<19) X
"^DD",9002313.02,9002313.0501,489,3)
Answer must be 19 characters in length.
"^DD",9002313.02,9002313.0501,489,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.0501,489,21,1,0)
Product identification of an
"^DD",9002313.02,9002313.0501,489,21,2,0)
ingredient used in a
"^DD",9002313.02,9002313.0501,489,21,3,0)
compound.
"^DD",9002313.02,9002313.0501,489,"DT")
3020731
"^DD",9002313.02,9002313.0501,490,0)
Compound Ingred Basis of Cost^F^^0;6^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0501,490,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0501,490,21,0)
^^2^2^3031203^
"^DD",9002313.02,9002313.0501,490,21,1,0)
The code for the method of determining the
"^DD",9002313.02,9002313.0501,490,21,2,0)
amount charged.
"^DD",9002313.02,9002313.0501,490,"DT")
3020731
"^DD",9002313.02,9002313.0601,0)
Pricing Repeating Section SUB-FIELD^^480^3
"^DD",9002313.02,9002313.0601,0,"DT")
3020801
"^DD",9002313.02,9002313.0601,0,"IX","B",9002313.0601,.01)

"^DD",9002313.02,9002313.0601,0,"NM","Pricing Repeating Section")

"^DD",9002313.02,9002313.0601,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0601,.01,0)
Pricing Counter^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0601,.01,1,0)
^.1
"^DD",9002313.02,9002313.0601,.01,1,1,0)
9002313.0601^B
"^DD",9002313.02,9002313.0601,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),478.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0601,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),478.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0601,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0601,.01,21,0)
^^2^2^3040126^
"^DD",9002313.02,9002313.0601,.01,21,1,0)
The number of pricing entries in the sub file.  Used for coordination of
"^DD",9002313.02,9002313.0601,.01,21,2,0)
benefits.
"^DD",9002313.02,9002313.0601,.01,"DT")
3020801
"^DD",9002313.02,9002313.0601,479,0)
Other Amt Claimed Sub Qual^F^^0;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0601,479,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0601,479,21,0)
^^4^4^3031204^
"^DD",9002313.02,9002313.0601,479,21,1,0)
Code identifying the additional
"^DD",9002313.02,9002313.0601,479,21,2,0)
incurred cost claimed in  Other
"^DD",9002313.02,9002313.0601,479,21,3,0)
Amount Claimed Submitted 
"^DD",9002313.02,9002313.0601,479,21,4,0)
(48-H9).
"^DD",9002313.02,9002313.0601,479,"DT")
3020801
"^DD",9002313.02,9002313.0601,480,0)
Other Amt Claimed Sub  ^F^^0;3^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0601,480,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0601,480,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0601,480,21,1,0)
Other amount claimed subtotal
"^DD",9002313.02,9002313.0601,480,"DT")
3020801
"^DD",9002313.02,9002313.0701,0)
Clinical Diagnosis Repeating SUB-FIELD^^492^3
"^DD",9002313.02,9002313.0701,0,"DT")
3020801
"^DD",9002313.02,9002313.0701,0,"IX","B",9002313.0701,.01)

"^DD",9002313.02,9002313.0701,0,"NM","Clinical Diagnosis Repeating")

"^DD",9002313.02,9002313.0701,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0701,.01,0)
Diagnosis Counter^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0701,.01,1,0)
^.1
"^DD",9002313.02,9002313.0701,.01,1,1,0)
9002313.0701^B
"^DD",9002313.02,9002313.0701,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),491.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0701,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),491.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0701,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0701,.01,21,0)
^^1^1^3040126^
"^DD",9002313.02,9002313.0701,.01,21,1,0)
The number of diagnosis codes defined for this medication order.
"^DD",9002313.02,9002313.0701,.01,"DT")
3020801
"^DD",9002313.02,9002313.0701,424,0)
Diagnosis Code  ^F^^0;3^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0701,424,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0701,424,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0701,424,21,1,0)
Code identifying the diagnosis of the patient.
"^DD",9002313.02,9002313.0701,424,"DT")
3020801
"^DD",9002313.02,9002313.0701,492,0)
Dianosis Code Qualifier^F^^0;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0701,492,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0701,492,21,0)
^^18^18^3031204^
"^DD",9002313.02,9002313.0701,492,21,1,0)
Code qualifying the  Diagnosis Code  (424-DO).
"^DD",9002313.02,9002313.0701,492,21,2,0)
 
"^DD",9002313.02,9002313.0701,492,21,3,0)
Blank=Not Specified
"^DD",9002313.02,9002313.0701,492,21,4,0)
=Not Specified
"^DD",9002313.02,9002313.0701,492,21,5,0)
1=International Classification of Diseases
"^DD",9002313.02,9002313.0701,492,21,6,0)
(ICD9)
"^DD",9002313.02,9002313.0701,492,21,7,0)
2=International Classification of Diseases
"^DD",9002313.02,9002313.0701,492,21,8,0)
(ICD1)
"^DD",9002313.02,9002313.0701,492,21,9,0)
3=National Criteria Care Institute (NCCI)
"^DD",9002313.02,9002313.0701,492,21,10,0)
4=The Systematized Nomenclature of
"^DD",9002313.02,9002313.0701,492,21,11,0)
Human and Veterinary Medicine
"^DD",9002313.02,9002313.0701,492,21,12,0)
(SNOMED)
"^DD",9002313.02,9002313.0701,492,21,13,0)
5=Common Dental Terminology (CDT)
"^DD",9002313.02,9002313.0701,492,21,14,0)
6=Medi-Span Diagnosis Code
"^DD",9002313.02,9002313.0701,492,21,15,0)
7=American Psychiatric Association
"^DD",9002313.02,9002313.0701,492,21,16,0)
Diagnostic Statistical Manual of Mental
"^DD",9002313.02,9002313.0701,492,21,17,0)
Disorders(DSM IV)
"^DD",9002313.02,9002313.0701,492,21,18,0)
99=Other
"^DD",9002313.02,9002313.0701,492,"DT")
3020801
"^DD",9002313.02,9002313.0801,0)
Clinical Information Repeating SUB-FIELD^^499^6
"^DD",9002313.02,9002313.0801,0,"DT")
3020801
"^DD",9002313.02,9002313.0801,0,"IX","B",9002313.0801,.01)

"^DD",9002313.02,9002313.0801,0,"NM","Clinical Information Repeating")

"^DD",9002313.02,9002313.0801,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0801,.01,0)
(493) Clinical Info Counter^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0801,.01,1,0)
^.1
"^DD",9002313.02,9002313.0801,.01,1,1,0)
9002313.0801^B
"^DD",9002313.02,9002313.0801,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),493.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0801,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),493.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0801,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0801,.01,21,0)
^^1^1^3040126^
"^DD",9002313.02,9002313.0801,.01,21,1,0)
The number of clinical indicator records for the medication order.
"^DD",9002313.02,9002313.0801,.01,"DT")
3020820
"^DD",9002313.02,9002313.0801,494,0)
Measurement Date^F^^0;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0801,494,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.0801,494,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0801,494,21,1,0)
Date clinical information was collected or measured.
"^DD",9002313.02,9002313.0801,494,"DT")
3020801
"^DD",9002313.02,9002313.0801,495,0)
Measurement Time^F^^0;3^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0801,495,3)
Answer must be 4 characters in length.
"^DD",9002313.02,9002313.0801,495,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0801,495,21,1,0)
Time clinical information was collected or measured.
"^DD",9002313.02,9002313.0801,495,"DT")
3020801
"^DD",9002313.02,9002313.0801,496,0)
Measurement Dimension^F^^0;4^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0801,496,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0801,496,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0801,496,21,1,0)
Code indicating the clinical domain of the observed value
"^DD",9002313.02,9002313.0801,496,21,2,0)
in  Measurement Value  (499- H4).
"^DD",9002313.02,9002313.0801,496,"DT")
3020801
"^DD",9002313.02,9002313.0801,497,0)
Measurement Unit^F^^0;5^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0801,497,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0801,497,21,0)
^^2^2^3031204^
"^DD",9002313.02,9002313.0801,497,21,1,0)
Code indicating the metric or English units used with the
"^DD",9002313.02,9002313.0801,497,21,2,0)
clinical information.
"^DD",9002313.02,9002313.0801,497,"DT")
3020801
"^DD",9002313.02,9002313.0801,499,0)
Measurement Value^F^^0;6^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.0801,499,3)
Answer must be 15 characters in length.
"^DD",9002313.02,9002313.0801,499,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.0801,499,21,1,0)
Actual value of clinical information.
"^DD",9002313.02,9002313.0801,499,"DT")
3020801
"^DD",9002313.02,9002313.0901,0)
Prior Auth Supporting Doc SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.0901,0,"DT")
3020801
"^DD",9002313.02,9002313.0901,0,"NM","Prior Auth Supporting Doc")

"^DD",9002313.02,9002313.0901,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0901,.01,0)
Prior Auth Supporting Doc^WL^^0;1^Q
"^DD",9002313.02,9002313.0901,.01,"DT")
3020801
"^DD",9002313.02,9002313.1001,0)
DUR/PPS Repeating Fields SUB-FIELD^^476^7
"^DD",9002313.02,9002313.1001,0,"DT")
3020801
"^DD",9002313.02,9002313.1001,0,"IX","B",9002313.1001,.01)

"^DD",9002313.02,9002313.1001,0,"NM","DUR/PPS Repeating Fields")

"^DD",9002313.02,9002313.1001,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.1001,.01,0)
(473) DUR/PPS Code Counter^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.1001,.01,1,0)
^.1
"^DD",9002313.02,9002313.1001,.01,1,1,0)
9002313.1001^B
"^DD",9002313.02,9002313.1001,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),473.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.1001,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),473.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.1001,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.1001,.01,21,0)
^^1^1^3040126^
"^DD",9002313.02,9002313.1001,.01,21,1,0)
The number of DUR messages that were returned in the response message.
"^DD",9002313.02,9002313.1001,.01,"DT")
3020820
"^DD",9002313.02,9002313.1001,439,0)
Reason for Service Code^F^^0;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.1001,439,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.1001,439,21,0)
^^4^4^3031204^
"^DD",9002313.02,9002313.1001,439,21,1,0)
Code identifying the type of
"^DD",9002313.02,9002313.1001,439,21,2,0)
utilization conflict detected or
"^DD",9002313.02,9002313.1001,439,21,3,0)
the reason for the pharmacist s
"^DD",9002313.02,9002313.1001,439,21,4,0)
professional service.
"^DD",9002313.02,9002313.1001,439,"DT")
3020801
"^DD",9002313.02,9002313.1001,440,0)
Professional Service Code^F^^0;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.1001,440,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.1001,440,21,0)
^^4^4^3031204^
"^DD",9002313.02,9002313.1001,440,21,1,0)
Code identifying the type of
"^DD",9002313.02,9002313.1001,440,21,2,0)
utilization conflict detected or
"^DD",9002313.02,9002313.1001,440,21,3,0)
the reason for the pharmacist s
"^DD",9002313.02,9002313.1001,440,21,4,0)
professional service.
"^DD",9002313.02,9002313.1001,440,"DT")
3020801
"^DD",9002313.02,9002313.1001,441,0)
Result of Service Code^F^^0;4^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.1001,441,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.1001,441,21,0)
^^4^4^3031204^
"^DD",9002313.02,9002313.1001,441,21,1,0)
Action taken by a pharmacist
"^DD",9002313.02,9002313.1001,441,21,2,0)
in response to a conflict or the
"^DD",9002313.02,9002313.1001,441,21,3,0)
result of a pharmacist s
"^DD",9002313.02,9002313.1001,441,21,4,0)
professional service.
"^DD",9002313.02,9002313.1001,441,"DT")
3020801
"^DD",9002313.02,9002313.1001,474,0)
DUR/PPS Level of Effort^F^^0;5^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.1001,474,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.1001,474,21,0)
^^6^6^3031204^
"^DD",9002313.02,9002313.1001,474,21,1,0)
Code indicating the level of
"^DD",9002313.02,9002313.1001,474,21,2,0)
effort as determined by the
"^DD",9002313.02,9002313.1001,474,21,3,0)
complexity of decision making
"^DD",9002313.02,9002313.1001,474,21,4,0)
or resources utilized by a
"^DD",9002313.02,9002313.1001,474,21,5,0)
pharmacist to perform a
"^DD",9002313.02,9002313.1001,474,21,6,0)
professional service
"^DD",9002313.02,9002313.1001,474,"DT")
3020801
"^DD",9002313.02,9002313.1001,475,0)
DUR Co-Agent ID Qualifier^F^^0;6^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.1001,475,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.1001,475,21,0)
^^1^1^3031204^
"^DD",9002313.02,9002313.1001,475,21,1,0)
Code qualifying the value in DUR Co-Agent ID  (476-H6).
"^DD",9002313.02,9002313.1001,475,"DT")
3020801
"^DD",9002313.02,9002313.1001,476,0)
DUR Co-Agent ID  ^F^^0;7^K:$L(X)>19!($L(X)<19) X
"^DD",9002313.02,9002313.1001,476,3)
Answer must be 19 characters in length.
"^DD",9002313.02,9002313.1001,476,21,0)
^^6^6^3031204^
"^DD",9002313.02,9002313.1001,476,21,1,0)
Identifies the co-existing agent
"^DD",9002313.02,9002313.1001,476,21,2,0)
contributing to the DUR event
"^DD",9002313.02,9002313.1001,476,21,3,0)
(drug or disease conflicting
"^DD",9002313.02,9002313.1001,476,21,4,0)
with the prescribed drug or
"^DD",9002313.02,9002313.1001,476,21,5,0)
prompting pharmacist
"^DD",9002313.02,9002313.1001,476,21,6,0)
professional service).
"^DD",9002313.02,9002313.1001,476,"DT")
3020801
"^DD",9002313.02,9002313.201459,0)
Procedure Modifier Code SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.201459,0,"DT")
3020801
"^DD",9002313.02,9002313.201459,0,"IX","B",9002313.201459,.01)

"^DD",9002313.02,9002313.201459,0,"NM","Procedure Modifier Code")

"^DD",9002313.02,9002313.201459,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.201459,.01,0)
Procedure Modifier Code^F^^0;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.201459,.01,1,0)
^.1
"^DD",9002313.02,9002313.201459,.01,1,1,0)
9002313.201459^B
"^DD",9002313.02,9002313.201459,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),459,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.201459,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),459,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.201459,.01,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.201459,.01,21,0)
^^3^3^3031203^
"^DD",9002313.02,9002313.201459,.01,21,1,0)
Count of the  Procedure
"^DD",9002313.02,9002313.201459,.01,21,2,0)
Modifier Code  (459-ER)
"^DD",9002313.02,9002313.201459,.01,21,3,0)
occurrences.
"^DD",9002313.02,9002313.201459,.01,"DT")
3020801
"^DD",9002313.02,9002313.29999,0)
RAW DATA SENT SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.29999,0,"DT")
3000830
"^DD",9002313.02,9002313.29999,0,"NM","RAW DATA SENT")

"^DD",9002313.02,9002313.29999,0,"UP")
9002313.02
"^DD",9002313.02,9002313.29999,.01,0)
RAW DATA SENT^WL^^0;1^Q
"^DD",9002313.02,9002313.29999,.01,21,0)
^^4^4^3031124^^
"^DD",9002313.02,9002313.29999,.01,21,1,0)
A copy of the raw packet is saved here.
"^DD",9002313.02,9002313.29999,.01,21,2,0)
It's intended to be of help in times of dispute.
"^DD",9002313.02,9002313.29999,.01,21,3,0)
This field could be winnowed before the rest of the 9002313.02 is winnowed.
"^DD",9002313.02,9002313.29999,.01,21,4,0)
For instance, it might make sense to only keep a month of these around.
"^DD",9002313.02,9002313.29999,.01,"DT")
3031124
"^DD",9002313.02,9002313.401342,0)
Other Payer Amt Paid Qual SUB-FIELD^^431^2
"^DD",9002313.02,9002313.401342,0,"DT")
3020731
"^DD",9002313.02,9002313.401342,0,"IX","B",9002313.401342,.01)

"^DD",9002313.02,9002313.401342,0,"NM","Other Payer Amt Paid Qual")

"^DD",9002313.02,9002313.401342,0,"UP")
9002313.0401
"^DD",9002313.02,9002313.401342,.01,0)
Other Payer Amt Paid Qual^F^^0;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.401342,.01,1,0)
^.1
"^DD",9002313.02,9002313.401342,.01,1,1,0)
9002313.401342^B
"^DD",9002313.02,9002313.401342,.01,1,1,1)
S ^BPSC(DA(3),400,DA(2),337,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.401342,.01,1,1,2)
K ^BPSC(DA(3),400,DA(2),337,DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.401342,.01,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.401342,.01,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.401342,.01,21,1,0)
Code qualifying the 'Other Payer Amount Paid' (431).
"^DD",9002313.02,9002313.401342,.01,"DT")
3031125
"^DD",9002313.02,9002313.401342,431,0)
Other Payer Amount Paid^F^^0;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.401342,431,3)
Answer must be 8 characters in length.
"^DD",9002313.02,9002313.401342,431,21,0)
^^2^2^3031125^
"^DD",9002313.02,9002313.401342,431,21,1,0)
Amount of any payment known by the pharmacy from other sources (including 
"^DD",9002313.02,9002313.401342,431,21,2,0)
coupons).
"^DD",9002313.02,9002313.401342,431,"DT")
3031125
"^DD",9002313.02,9002313.401472,0)
Other Payer Reject Code SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.401472,0,"DT")
3020731
"^DD",9002313.02,9002313.401472,0,"IX","B",9002313.401472,.01)

"^DD",9002313.02,9002313.401472,0,"NM","Other Payer Reject Code")

"^DD",9002313.02,9002313.401472,0,"UP")
9002313.0401
"^DD",9002313.02,9002313.401472,.01,0)
Other Payer Reject Code^F^^0;1^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.401472,.01,1,0)
^.1
"^DD",9002313.02,9002313.401472,.01,1,1,0)
9002313.401472^B
"^DD",9002313.02,9002313.401472,.01,1,1,1)
S ^BPSC(DA(3),400,DA(2),337,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.401472,.01,1,1,2)
K ^BPSC(DA(3),400,DA(2),337,DA(1),2,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.401472,.01,3)
Answer must be 3 characters in length.
"^DD",9002313.02,9002313.401472,.01,21,0)
^^2^2^3031125^
"^DD",9002313.02,9002313.401472,.01,21,1,0)
The error encountered by the previous "Other Payer" in 'Reject Code' 
"^DD",9002313.02,9002313.401472,.01,21,2,0)
(511).
"^DD",9002313.02,9002313.401472,.01,"DT")
3031125
"^DD",9002313.03,9002313.03,0)
FIELD^^9999^17
"^DD",9002313.03,9002313.03,0,"DDA")
N
"^DD",9002313.03,9002313.03,0,"DT")
3020820
"^DD",9002313.03,9002313.03,0,"IX","AC",9002313.0301,501)

"^DD",9002313.03,9002313.03,0,"IX","AE",9002313.03,.02)

"^DD",9002313.03,9002313.03,0,"IX","B",9002313.03,.01)

"^DD",9002313.03,9002313.03,0,"NM","BPS RESPONSES")

"^DD",9002313.03,9002313.03,0,"PT",9002313.57,4)

"^DD",9002313.03,9002313.03,0,"PT",9002313.57,402)

"^DD",9002313.03,9002313.03,0,"PT",9002313.59,4)

"^DD",9002313.03,9002313.03,0,"PT",9002313.59,402)

"^DD",9002313.03,9002313.03,0,"VRPK")
BPS
"^DD",9002313.03,9002313.03,.01,0)
ID^RP9002313.02'^BPSC(^0;1^Q
"^DD",9002313.03,9002313.03,.01,1,0)
^.1
"^DD",9002313.03,9002313.03,.01,1,1,0)
9002313.03^B
"^DD",9002313.03,9002313.03,.01,1,1,1)
S ^BPSR("B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.03,.01,1,1,2)
K ^BPSR("B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.03,.01,3)

"^DD",9002313.03,9002313.03,.01,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.03,.01,21,1,0)
Internal Identifier for BPS responses.
"^DD",9002313.03,9002313.03,.01,"DT")
3031124
"^DD",9002313.03,9002313.03,.02,0)
Date/Time Response Received^D^^0;2^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.03,9002313.03,.02,1,0)
^.1
"^DD",9002313.03,9002313.03,.02,1,1,0)
9002313.03^AE
"^DD",9002313.03,9002313.03,.02,1,1,1)
S ^BPSR("AE",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.03,.02,1,1,2)
K ^BPSR("AE",$E(X,1,30),DA)
"^DD",9002313.03,9002313.03,.02,1,1,"DT")
2950724
"^DD",9002313.03,9002313.03,.02,21,0)
^.001^1^1^3040322^^
"^DD",9002313.03,9002313.03,.02,21,1,0)
Date that response was received on the system.
"^DD",9002313.03,9002313.03,.02,"DT")
3031124
"^DD",9002313.03,9002313.03,102,0)
Version/Release Number^F^^100;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.03,9002313.03,102,3)
Answer must be 2 characters in length.
"^DD",9002313.03,9002313.03,102,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.03,102,21,1,0)
NCPDP Version/Release Number.
"^DD",9002313.03,9002313.03,102,"DT")
3031124
"^DD",9002313.03,9002313.03,103,0)
Transaction Code^F^^100;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.03,9002313.03,103,3)
Answer must be 2 characters in length.
"^DD",9002313.03,9002313.03,103,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.03,103,21,1,0)
Code identifying the type of transaction.
"^DD",9002313.03,9002313.03,103,"DT")
3031124
"^DD",9002313.03,9002313.03,109,0)
Transaction Count^F^^100;9^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.03,109,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.03,109,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.03,109,21,1,0)
Count of transactions in the transmission. 
"^DD",9002313.03,9002313.03,109,"DT")
3031124
"^DD",9002313.03,9002313.03,201,0)
Service Provider ID^F^^200;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.03,9002313.03,201,3)
Answer must be 1-15 characters in length.
"^DD",9002313.03,9002313.03,201,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.03,201,21,1,0)
ID assigned to a pharmacy or provider.
"^DD",9002313.03,9002313.03,201,"DT")
3031124
"^DD",9002313.03,9002313.03,202,0)
Service Provider ID Qualifier^F^^200;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.03,202,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.03,202,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.03,202,21,1,0)
Code qualifying the 'Service Provider ID' (21)
"^DD",9002313.03,9002313.03,202,"DT")
3031124
"^DD",9002313.03,9002313.03,301,0)
Group ID^F^^300;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.03,9002313.03,301,3)
Answer must be 1-15 characters in length.
"^DD",9002313.03,9002313.03,301,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.03,301,21,1,0)
ID assigned to the cardholder group or employer group.
"^DD",9002313.03,9002313.03,301,"DT")
3031124
"^DD",9002313.03,9002313.03,401,0)
Date of Service^F^^400;1^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.03,401,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.03,401,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.03,401,21,1,0)
Identifies date the prescription was filled or professional service 
"^DD",9002313.03,9002313.03,401,21,2,0)
rendered.
"^DD",9002313.03,9002313.03,401,"DT")
3031124
"^DD",9002313.03,9002313.03,501,0)
Response Status (Header)^F^^500;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.03,501,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.03,501,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.03,501,21,1,0)
A text message indicating the status of this response.
"^DD",9002313.03,9002313.03,501,"DT")
3031124
"^DD",9002313.03,9002313.03,504,0)
Message^F^^504;1^K:$L(X)>250!($L(X)<1) X
"^DD",9002313.03,9002313.03,504,3)
Answer must be 1-250 characters in length.
"^DD",9002313.03,9002313.03,504,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.03,504,21,1,0)
Free form message.
"^DD",9002313.03,9002313.03,504,"DT")
3031124
"^DD",9002313.03,9002313.03,524,0)
Plan Identification^F^^500;24^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.03,524,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.03,524,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.03,524,21,1,0)
Assigned by the processor to identify a set of parameters, benefit, or 
"^DD",9002313.03,9002313.03,524,21,2,0)
coverage criteria used to adjudicate a claim.
"^DD",9002313.03,9002313.03,524,"DT")
3031124
"^DD",9002313.03,9002313.03,545,0)
Network Reimbursement ID^F^^540;5^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.03,9002313.03,545,3)
Answer must be 1-10 characters in length.
"^DD",9002313.03,9002313.03,545,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.03,545,21,1,0)
Field defined by the processor. It identifies the network, for the 
"^DD",9002313.03,9002313.03,545,21,2,0)
covered member, used to calculate the reimbursement to the pharmacy.
"^DD",9002313.03,9002313.03,545,"DT")
3031124
"^DD",9002313.03,9002313.03,568,0)
Payer ID Qualifier^F^^560;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.03,568,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.03,568,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.03,568,21,1,0)
Code indicating the type of payer ID.
"^DD",9002313.03,9002313.03,568,"DT")
3031124
"^DD",9002313.03,9002313.03,569,0)
Payer ID  ^F^^560;9^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.03,9002313.03,569,3)
Answer must be 1-10 characters in length.
"^DD",9002313.03,9002313.03,569,21,0)
^^1^1^3040126^
"^DD",9002313.03,9002313.03,569,21,1,0)
Payer identification - the payer this claim was submitted to.
"^DD",9002313.03,9002313.03,569,"DT")
3020807
"^DD",9002313.03,9002313.03,1000,0)
Response(s)^9002313.0301A^^1000;0
"^DD",9002313.03,9002313.03,1000,21,0)
^^1^1^3040331^
"^DD",9002313.03,9002313.03,1000,21,1,0)
Text message containing the response to the claim.
"^DD",9002313.03,9002313.03,9999,0)
RAW DATA RECEIVED^9002313.39999^^M;0
"^DD",9002313.03,9002313.0301,0)
Response(s) SUB-FIELD^^1000^55
"^DD",9002313.03,9002313.0301,0,"DT")
3020820
"^DD",9002313.03,9002313.0301,0,"IX","B",9002313.0301,.01)

"^DD",9002313.03,9002313.0301,0,"NM","Response(s)")

"^DD",9002313.03,9002313.0301,0,"UP")
9002313.03
"^DD",9002313.03,9002313.0301,.01,0)
Medication Order^MNJ9,0^^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.03,9002313.0301,.01,1,0)
^.1
"^DD",9002313.03,9002313.0301,.01,1,1,0)
9002313.0301^B
"^DD",9002313.03,9002313.0301,.01,1,1,1)
S ^BPSR(DA(1),1000,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.0301,.01,1,1,2)
K ^BPSR(DA(1),1000,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.0301,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",9002313.03,9002313.0301,.01,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,.01,21,1,0)
Detailing of medications in this claim.
"^DD",9002313.03,9002313.0301,.01,"DT")
3031124
"^DD",9002313.03,9002313.0301,112,0)
Transaction Response Status^F^^110;2^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.0301,112,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.0301,112,21,0)
^^9^9^3031124^
"^DD",9002313.03,9002313.0301,112,21,1,0)
Code indicating the status of the transaction.
"^DD",9002313.03,9002313.0301,112,21,2,0)
A=Approved
"^DD",9002313.03,9002313.0301,112,21,3,0)
C=Captured
"^DD",9002313.03,9002313.0301,112,21,4,0)
D=Duplicate of Paid
"^DD",9002313.03,9002313.0301,112,21,5,0)
F=PA Deferred
"^DD",9002313.03,9002313.0301,112,21,6,0)
P=Paid
"^DD",9002313.03,9002313.0301,112,21,7,0)
Q=Duplicate of Capture
"^DD",9002313.03,9002313.0301,112,21,8,0)
R=Rejected
"^DD",9002313.03,9002313.0301,112,21,9,0)
S=Duplicate of Approved
"^DD",9002313.03,9002313.0301,112,"DT")
3031124
"^DD",9002313.03,9002313.0301,346,0)
Basis of Calc - Disp Fee^F^^340;6^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.0301,346,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.0301,346,21,0)
^^9^9^3031124^
"^DD",9002313.03,9002313.0301,346,21,1,0)
Code indicating how the reimbursement amount was calculated for 
"^DD",9002313.03,9002313.0301,346,21,2,0)
'Dispensing Fee Paid' (57).
"^DD",9002313.03,9002313.0301,346,21,3,0)
Blank=Not Specified
"^DD",9002313.03,9002313.0301,346,21,4,0)
=Not Specified
"^DD",9002313.03,9002313.0301,346,21,5,0)
1=Quantity Dispensed
"^DD",9002313.03,9002313.0301,346,21,6,0)
2=Quantity Intended To Be Dispensed
"^DD",9002313.03,9002313.0301,346,21,7,0)
3=Usual & Customary/Prorated
"^DD",9002313.03,9002313.0301,346,21,8,0)
4=Waived Due To Partial Fill
"^DD",9002313.03,9002313.0301,346,21,9,0)
99=Other
"^DD",9002313.03,9002313.0301,346,"DT")
3031124
"^DD",9002313.03,9002313.0301,347,0)
Basis of Calc - Copay^F^^340;7^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.0301,347,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.0301,347,21,0)
^^9^9^3031124^
"^DD",9002313.03,9002313.0301,347,21,1,0)
Code indicating how the reimbursement amount was calculated for 'Patient 
"^DD",9002313.03,9002313.0301,347,21,2,0)
Pay Amount'(55).
"^DD",9002313.03,9002313.0301,347,21,3,0)
Blank=Not Specified
"^DD",9002313.03,9002313.0301,347,21,4,0)
=Not Specified
"^DD",9002313.03,9002313.0301,347,21,5,0)
1=Quantity Dispensed
"^DD",9002313.03,9002313.0301,347,21,6,0)
2=Quantity Intended To Be Dispensed
"^DD",9002313.03,9002313.0301,347,21,7,0)
3=Usual & Customary/Prorated
"^DD",9002313.03,9002313.0301,347,21,8,0)
4=Waived Due To Partial Fill
"^DD",9002313.03,9002313.0301,347,21,9,0)
99=Other
"^DD",9002313.03,9002313.0301,347,"DT")
3031124
"^DD",9002313.03,9002313.0301,348,0)
Basis of Calc-Flat Sales Tax^F^^340;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.0301,348,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.0301,348,21,0)
^^6^6^3031124^
"^DD",9002313.03,9002313.0301,348,21,1,0)
Code indicating how the reimbursement amount was calculated for 'Flat 
"^DD",9002313.03,9002313.0301,348,21,2,0)
Sales Tax Amount Paid' (558).
"^DD",9002313.03,9002313.0301,348,21,3,0)
Blank=Not Specified
"^DD",9002313.03,9002313.0301,348,21,4,0)
=Not Specified
"^DD",9002313.03,9002313.0301,348,21,5,0)
1=Quantity Dispensed
"^DD",9002313.03,9002313.0301,348,21,6,0)
2=Quantity Intended To Be Dispensed
"^DD",9002313.03,9002313.0301,348,"DT")
3031124
"^DD",9002313.03,9002313.0301,349,0)
Basis of Calc-Prctg Sales Tax^F^^340;9^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.0301,349,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.0301,349,21,0)
^^6^6^3031124^
"^DD",9002313.03,9002313.0301,349,21,1,0)
Code indicating how the reimbursement amount was calculated for 
"^DD",9002313.03,9002313.0301,349,21,2,0)
'Percentage Sales Tax Amount Paid' (559).
"^DD",9002313.03,9002313.0301,349,21,3,0)
Blank=Not Specified
"^DD",9002313.03,9002313.0301,349,21,4,0)
=Not Specified
"^DD",9002313.03,9002313.0301,349,21,5,0)
1=Quantity Dispensed
"^DD",9002313.03,9002313.0301,349,21,6,0)
2=Quantity Intended To Be Dispensed
"^DD",9002313.03,9002313.0301,349,"DT")
3031124
"^DD",9002313.03,9002313.0301,402,0)
Prescription/Service Ref Num^F^^400;2^K:$L(X)>7!($L(X)<1) X
"^DD",9002313.03,9002313.0301,402,3)
Answer must be 1-7 characters in length.
"^DD",9002313.03,9002313.0301,402,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.0301,402,21,1,0)
Reference number assigned by the provider for the dispensed drug/product 
"^DD",9002313.03,9002313.0301,402,21,2,0)
and/or service provided.
"^DD",9002313.03,9002313.0301,402,"DT")
3031124
"^DD",9002313.03,9002313.0301,455,0)
Prescription/Srvc Ref Num Qual^F^^450;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.0301,455,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.0301,455,21,0)
^^4^4^3031124^
"^DD",9002313.03,9002313.0301,455,21,1,0)
Indicates the type of billing submitted.
"^DD",9002313.03,9002313.0301,455,21,2,0)
Blank=Not Specified
"^DD",9002313.03,9002313.0301,455,21,3,0)
1=Rx Billing
"^DD",9002313.03,9002313.0301,455,21,4,0)
2=Service Billing
"^DD",9002313.03,9002313.0301,455,"DT")
3031124
"^DD",9002313.03,9002313.0301,498.14,0)
Prior Auth Number Assigned^F^^498;6^K:$L(X)>11!($L(X)<1) X
"^DD",9002313.03,9002313.0301,498.14,3)
Answer must be 1-11 characters in length.
"^DD",9002313.03,9002313.0301,498.14,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.0301,498.14,21,1,0)
Unique number identifying the prior authorization assigned by the 
"^DD",9002313.03,9002313.0301,498.14,21,2,0)
processor.
"^DD",9002313.03,9002313.0301,498.14,"DT")
3031124
"^DD",9002313.03,9002313.0301,498.51,0)
Prior Auth Processed Date^F^^498;1^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,498.51,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,498.51,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,498.51,21,1,0)
Date the prior authorization request was processed.
"^DD",9002313.03,9002313.0301,498.51,"DT")
3031124
"^DD",9002313.03,9002313.0301,498.52,0)
Prior Auth Effective Date^F^^498;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,498.52,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,498.52,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,498.52,21,1,0)
Date the prior authorization became effective.
"^DD",9002313.03,9002313.0301,498.52,"DT")
3031124
"^DD",9002313.03,9002313.0301,498.53,0)
Prior Auth Expiration Date^F^^498;3^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,498.53,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,498.53,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,498.53,21,1,0)
Date the prior authorization expires.
"^DD",9002313.03,9002313.0301,498.53,"DT")
3031124
"^DD",9002313.03,9002313.0301,498.54,0)
Prior Auth Refills Authorized^F^^498;4^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.0301,498.54,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.0301,498.54,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,498.54,21,1,0)
Number of refills authorized by the prior authorization
"^DD",9002313.03,9002313.0301,498.54,"DT")
3031124
"^DD",9002313.03,9002313.0301,498.55,0)
Prior Auth Qty Accumulated^F^^498;5^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.03,9002313.0301,498.55,3)
Answer must be 1-10 characters in length.
"^DD",9002313.03,9002313.0301,498.55,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,498.55,21,1,0)
Accumulated authorized amount expressed in metric decimal units.
"^DD",9002313.03,9002313.0301,498.55,"DT")
3031124
"^DD",9002313.03,9002313.0301,498.57,0)
Prior Auth Quantity^F^^498;7^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.03,9002313.0301,498.57,3)
Answer must be 1-10 characters in length.
"^DD",9002313.03,9002313.0301,498.57,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,498.57,21,1,0)
Amount authorized expressed in metric decimal units.
"^DD",9002313.03,9002313.0301,498.57,"DT")
3031124
"^DD",9002313.03,9002313.0301,498.58,0)
Prior Auth Dollars Authorized^F^^498;8^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,498.58,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,498.58,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,498.58,21,1,0)
Amount authorized in the prior authorization.
"^DD",9002313.03,9002313.0301,498.58,"DT")
3031124
"^DD",9002313.03,9002313.0301,501,0)
Response Status (Prescription)^FO^^500;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.0301,501,1,0)
^.1
"^DD",9002313.03,9002313.0301,501,1,1,0)
9002313.03^AC
"^DD",9002313.03,9002313.0301,501,1,1,1)
S ^BPSR("AC",$E(X,1,30),DA(1),DA)=""
"^DD",9002313.03,9002313.0301,501,1,1,2)
K ^BPSR("AC",$E(X,1,30),DA(1),DA)
"^DD",9002313.03,9002313.0301,501,1,1,"DT")
2950622
"^DD",9002313.03,9002313.0301,501,2)
S Y(0)=Y S Y=$S(Y="P":"CLAIM PAYABLE",Y="C":"CLAIM CAPTURED",Y="D":"DUPLICATE CLAIM",Y="R":"REJECTED CLAIM",Y="DP":"DUPLICATE OF PAYABLE CLAIM",Y="DC":"DUPLICATE OF CAPTURED CLAIM",1:"<NONE>")
"^DD",9002313.03,9002313.0301,501,2.1)
S Y=$S(Y="P":"CLAIM PAYABLE",Y="C":"CLAIM CAPTURED",Y="D":"DUPLICATE CLAIM",Y="R":"REJECTED CLAIM",Y="DP":"DUPLICATE OF PAYABLE CLAIM",Y="DC":"DUPLICATE OF CAPTURED CLAIM",1:"<NONE>")
"^DD",9002313.03,9002313.0301,501,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.0301,501,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,501,21,1,0)
Status of the response from the payor.
"^DD",9002313.03,9002313.0301,501,"DT")
3031124
"^DD",9002313.03,9002313.0301,503,0)
Authorization Number^F^^500;3^K:$L(X)>20!($L(X)<14) X
"^DD",9002313.03,9002313.0301,503,3)
Answer must be 14-20 characters in length.
"^DD",9002313.03,9002313.0301,503,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,503,21,1,0)
Number assigned by the processor to identify an authorized transaction.
"^DD",9002313.03,9002313.0301,503,"DT")
3031124
"^DD",9002313.03,9002313.0301,504,0)
Message^F^^504;1^K:$L(X)>250!($L(X)<1) X
"^DD",9002313.03,9002313.0301,504,3)
Answer must be 1-250 characters in length.
"^DD",9002313.03,9002313.0301,504,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,504,21,1,0)
Free text message from payor.
"^DD",9002313.03,9002313.0301,504,"DT")
3031124
"^DD",9002313.03,9002313.0301,505,0)
Patient Pay Amount^FO^^500;5^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,505,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,505,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,505,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,505,21,0)
^^4^4^3040331^
"^DD",9002313.03,9002313.0301,505,21,1,0)
Amount that is calculated by the processor and returned to the pharmacy 
"^DD",9002313.03,9002313.0301,505,21,2,0)
as the TOTAL amount to be paid by the patient to the pharmacy; the 
"^DD",9002313.03,9002313.0301,505,21,3,0)
patient's total cost share, including co-payments, amounts applied to 
"^DD",9002313.03,9002313.0301,505,21,4,0)
deductible, over maximum amounts, penalties, etc.
"^DD",9002313.03,9002313.0301,505,"DT")
3040331
"^DD",9002313.03,9002313.0301,506,0)
Ingredient Cost Paid^FO^^500;6^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,506,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,506,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,506,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,506,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,506,21,1,0)
Drug ingredient cost paid included in the 'Total Amount Paid' (59).
"^DD",9002313.03,9002313.0301,506,"DT")
3031124
"^DD",9002313.03,9002313.0301,507,0)
Dispensing Fee Paid^FO^^500;7^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,507,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,507,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,507,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,507,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,507,21,1,0)
Dispensing fee paid included in the 'Total Amount Paid' (59).
"^DD",9002313.03,9002313.0301,507,"DT")
3031124
"^DD",9002313.03,9002313.0301,508,0)
Sales Tax Paid^FO^^500;8^K:$L(X)>6!($L(X)<6) X
"^DD",9002313.03,9002313.0301,508,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,508,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,508,3)
Answer must be 6 characters in length.
"^DD",9002313.03,9002313.0301,508,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,508,21,1,0)
The amount of sales tax paid for the prescription dispensed. 
"^DD",9002313.03,9002313.0301,508,"DT")
3031124
"^DD",9002313.03,9002313.0301,509,0)
Total Amount Paid^FO^^500;9^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,509,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,509,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,509,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,509,21,0)
^^6^6^3031124^
"^DD",9002313.03,9002313.0301,509,21,1,0)
Total amount to be paid by the claims processor (i.e. pharmacy 
"^DD",9002313.03,9002313.0301,509,21,2,0)
receivable). Represents a sum of 'Ingredient Cost Paid' (56), 'Dispensing
"^DD",9002313.03,9002313.0301,509,21,3,0)
Fee Paid' (57), 'Flat Sales Tax Amount Paid' (558), 'Percentage Sales Tax
"^DD",9002313.03,9002313.0301,509,21,4,0)
Amount Paid' (559), 'Incentive Amount Paid' (521), 'Professional Service
"^DD",9002313.03,9002313.0301,509,21,5,0)
Fee Paid' (562), 'Other Amount Paid' (565), less 'Patient Pay Amount'
"^DD",9002313.03,9002313.0301,509,21,6,0)
(55) and 'Other Payer Amount Recognized' (566).
"^DD",9002313.03,9002313.0301,509,"DT")
3031124
"^DD",9002313.03,9002313.0301,510,0)
Reject Count^F^^500;10^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.03,9002313.0301,510,3)
Answer must be 2 characters in length.
"^DD",9002313.03,9002313.0301,510,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,510,21,1,0)
Count of 'Reject Code' (511) occurrences.
"^DD",9002313.03,9002313.0301,510,"DT")
3031124
"^DD",9002313.03,9002313.0301,511,0)
Reject Code(s)^9002313.03511A^^511;0
"^DD",9002313.03,9002313.0301,511,21,0)
^.001^1^1^3040126^^
"^DD",9002313.03,9002313.0301,511,21,1,0)
Multiple rejection codes.
"^DD",9002313.03,9002313.0301,512,0)
Accumulated Deductible Amount^FO^^500;12^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,512,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,512,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,512,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,512,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,512,21,1,0)
Amount in dollars met by the patient/family in a deductible plan.
"^DD",9002313.03,9002313.0301,512,"DT")
3031124
"^DD",9002313.03,9002313.0301,513,0)
Remaining Deductible Amount^FO^^500;13^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,513,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,513,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,513,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,513,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,513,21,1,0)
Amount not met by the patient/family in the deductible plan.
"^DD",9002313.03,9002313.0301,513,"DT")
3031124
"^DD",9002313.03,9002313.0301,514,0)
Remaining Benefit Amount^FO^^500;14^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,514,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,514,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,514,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,514,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,514,21,1,0)
Amount remaining in a patient/family plan with a periodic maximum benefit.
"^DD",9002313.03,9002313.0301,514,"DT")
3031124
"^DD",9002313.03,9002313.0301,517,0)
Amt Applied to Periodic Deduct^FO^^500;17^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,517,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,517,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,517,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,517,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.0301,517,21,1,0)
Amount to be collected from a patient that is included in 'Patient Pay 
"^DD",9002313.03,9002313.0301,517,21,2,0)
Amount' (55) that is applied to a periodic deductible.
"^DD",9002313.03,9002313.0301,517,"DT")
3031124
"^DD",9002313.03,9002313.0301,518,0)
Amount of Copay/CoInsurance^FO^^500;18^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,518,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,518,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,518,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,518,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.0301,518,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay 
"^DD",9002313.03,9002313.0301,518,21,2,0)
Amount' (55) that is due to a per prescription copay/coinsurance.
"^DD",9002313.03,9002313.0301,518,"DT")
3031124
"^DD",9002313.03,9002313.0301,519,0)
Amt Attrib to Prod Selection^FO^^500;19^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,519,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,519,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,519,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,519,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.0301,519,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay 
"^DD",9002313.03,9002313.0301,519,21,2,0)
Amount' (55) that is due to the patient's selection of drug product.
"^DD",9002313.03,9002313.0301,519,"DT")
3031124
"^DD",9002313.03,9002313.0301,520,0)
Amt Exceed Per Benefit Max^FO^^500;20^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,520,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,520,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,520,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,520,21,0)
^^3^3^3031124^
"^DD",9002313.03,9002313.0301,520,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay 
"^DD",9002313.03,9002313.0301,520,21,2,0)
Amount' (55) that is due to the patient exceeding a periodic benefit 
"^DD",9002313.03,9002313.0301,520,21,3,0)
maximum.
"^DD",9002313.03,9002313.0301,520,"DT")
3031124
"^DD",9002313.03,9002313.0301,521,0)
Incentive Amount Paid^FO^^500;21^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,521,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,521,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,521,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,521,21,0)
^^3^3^3031124^
"^DD",9002313.03,9002313.0301,521,21,1,0)
Amount represents the contractually agreed upon incentive fee paid for 
"^DD",9002313.03,9002313.0301,521,21,2,0)
specific services rendered. Amount is included in the 'Total Amount Paid' 
"^DD",9002313.03,9002313.0301,521,21,3,0)
(59).
"^DD",9002313.03,9002313.0301,521,"DT")
3031124
"^DD",9002313.03,9002313.0301,522,0)
Basis of Reimb Determination^F^^500;22^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.03,9002313.0301,522,3)
Answer must be 2 characters in length.
"^DD",9002313.03,9002313.0301,522,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.0301,522,21,1,0)
Code identifying how the reimbursement amount was calculated for 
"^DD",9002313.03,9002313.0301,522,21,2,0)
'Ingredient Cost Paid' (56).
"^DD",9002313.03,9002313.0301,522,"DT")
3031124
"^DD",9002313.03,9002313.0301,523,0)
Amount Attributed to Sales Tax^FO^^500;23^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,523,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,523,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,523,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,523,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.0301,523,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay 
"^DD",9002313.03,9002313.0301,523,21,2,0)
Amount' (55) that is due to sales tax paid.
"^DD",9002313.03,9002313.0301,523,"DT")
3031124
"^DD",9002313.03,9002313.0301,525,0)
DUR Response Data^F^^525;1^K:$L(X)>250!($L(X)<1) X
"^DD",9002313.03,9002313.0301,525,3)
Answer must be 1-250 characters in length.
"^DD",9002313.03,9002313.0301,525,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,525,21,1,0)
Text that provides additional detail regarding a DUR conflict.
"^DD",9002313.03,9002313.0301,525,"DT")
3031124
"^DD",9002313.03,9002313.0301,526,0)
Additional Message Information^F^^526;1^K:$L(X)>250!($L(X)<1) X
"^DD",9002313.03,9002313.0301,526,3)
Answer must be 1-250 characters in length.
"^DD",9002313.03,9002313.0301,526,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,526,21,1,0)
Free text message.
"^DD",9002313.03,9002313.0301,526,"DT")
3031124
"^DD",9002313.03,9002313.0301,547,0)
Approved Message Code Count^F^^540;7^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.0301,547,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.0301,547,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,547,21,1,0)
Count of the 'Approved Message Code' (548-6F) occurrences.
"^DD",9002313.03,9002313.0301,547,"DT")
3031124
"^DD",9002313.03,9002313.0301,548,0)
Approved Message Code ^9002313.301548A^^548;0
"^DD",9002313.03,9002313.0301,549,0)
Help Desk Phone Number Qual^F^^540;9^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.0301,549,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.0301,549,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,549,21,1,0)
Code qualifying the phone number in the 'Help Desk Phone Number' (55).
"^DD",9002313.03,9002313.0301,549,"DT")
3031124
"^DD",9002313.03,9002313.0301,550,0)
Help Desk Phone Number  ^F^^540;10^K:$L(X)>18!($L(X)<1) X
"^DD",9002313.03,9002313.0301,550,3)
Answer must be 1-18 characters in length.
"^DD",9002313.03,9002313.0301,550,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,550,21,1,0)
Ten digit phone number of the help desk.
"^DD",9002313.03,9002313.0301,550,"DT")
3031124
"^DD",9002313.03,9002313.0301,551,0)
Preferred Product Count^F^^550;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.0301,551,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.0301,551,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,551,21,1,0)
Count of preferred product occurrences.
"^DD",9002313.03,9002313.0301,551,"DT")
3031124
"^DD",9002313.03,9002313.0301,551.01,0)
Preferred Product Repeating^9002313.1301A^^551.01;0
"^DD",9002313.03,9002313.0301,551.01,"DT")
3020809
"^DD",9002313.03,9002313.0301,557,0)
Tax Exempt Indicator^F^^550;7^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.0301,557,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.0301,557,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,557,21,1,0)
Code indicating the payer as exempt from taxes.
"^DD",9002313.03,9002313.0301,557,"DT")
3031124
"^DD",9002313.03,9002313.0301,558,0)
Flat Sales Tax Amount Paid^F^^550;8^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,558,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,558,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,558,21,1,0)
Flat sales tax paid which is included in the 'Total Amount Paid' (59).
"^DD",9002313.03,9002313.0301,558,"DT")
3031124
"^DD",9002313.03,9002313.0301,559,0)
Percentage Sales Tax Amt Paid^FO^^550;9^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,559,2)
S Y(0)=Y S Y=$J($$DFF2EXT^BPSECFM(Y),8,2)
"^DD",9002313.03,9002313.0301,559,2.1)
S Y=$J($$DFF2EXT^BPSECFM(Y),8,2)
"^DD",9002313.03,9002313.0301,559,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,559,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.0301,559,21,1,0)
Amount of percentage sales tax paid which is included in the 'Total 
"^DD",9002313.03,9002313.0301,559,21,2,0)
Amount Paid' (59).
"^DD",9002313.03,9002313.0301,559,"DT")
3031124
"^DD",9002313.03,9002313.0301,560,0)
Percentage Sales Tax Rate Paid^FO^^550;10^K:$L(X)>7!($L(X)<7) X
"^DD",9002313.03,9002313.0301,560,2)
S Y(0)=Y S Y=$J($$DFF2EXT^BPSECFM(Y),7,4)
"^DD",9002313.03,9002313.0301,560,2.1)
S Y=$J($$DFF2EXT^BPSECFM(Y),7,4)
"^DD",9002313.03,9002313.0301,560,3)
Answer must be 7 characters in length.
"^DD",9002313.03,9002313.0301,560,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.0301,560,21,1,0)
Percentage sales tax rate used to calculate 'Percentage Sales Tax Amount 
"^DD",9002313.03,9002313.0301,560,21,2,0)
Paid' (559).
"^DD",9002313.03,9002313.0301,560,"DT")
3031124
"^DD",9002313.03,9002313.0301,561,0)
Percentage Sales Tx Basis Pd^F^^560;1^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.0301,561,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.0301,561,21,0)
^^5^5^3031124^
"^DD",9002313.03,9002313.0301,561,21,1,0)
Code indicating the percentage sales tax paid basis.
"^DD",9002313.03,9002313.0301,561,21,2,0)
Blank=Not Specified
"^DD",9002313.03,9002313.0301,561,21,3,0)
1=Gross Amount Due
"^DD",9002313.03,9002313.0301,561,21,4,0)
2=Ingredient Cost
"^DD",9002313.03,9002313.0301,561,21,5,0)
3=Ingredient Cost + Dispensing Fee
"^DD",9002313.03,9002313.0301,561,"DT")
3031124
"^DD",9002313.03,9002313.0301,562,0)
Professional Service Fee Paid^F^^560;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,562,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,562,21,0)
^^1^1^3031125^
"^DD",9002313.03,9002313.0301,562,21,1,0)
Amount submitted by the provider for professional services rendered.
"^DD",9002313.03,9002313.0301,562,"DT")
3031125
"^DD",9002313.03,9002313.0301,563,0)
Other Amount Paid Count^F^^560;3^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.0301,563,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.0301,563,21,0)
^^1^1^3031125^
"^DD",9002313.03,9002313.0301,563,21,1,0)
Count of the other amount paid occurrences.
"^DD",9002313.03,9002313.0301,563,"DT")
3031125
"^DD",9002313.03,9002313.0301,563.01,0)
Other Amt Paid Repeating Flds^9002313.1401A^^563.01;0
"^DD",9002313.03,9002313.0301,563.01,"DT")
3020809
"^DD",9002313.03,9002313.0301,566,0)
Other Payer Amount Recognized^F^^560;6^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,566,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,566,21,0)
^^1^1^3031125^
"^DD",9002313.03,9002313.0301,566,21,1,0)
Total dollar amount of any payment from another source including coupons.
"^DD",9002313.03,9002313.0301,566,"DT")
3031125
"^DD",9002313.03,9002313.0301,567.01,0)
DUR/PPS Repeating Flds^9002313.1101A^^567.01;0
"^DD",9002313.03,9002313.0301,567.01,"DT")
3040331
"^DD",9002313.03,9002313.0301,1000,0)
Duplicate Response Data^F^^1000;1^K:$L(X)>85!($L(X)<1) X
"^DD",9002313.03,9002313.0301,1000,3)
Answer must be 1-85 characters in length.
"^DD",9002313.03,9002313.0301,1000,21,0)
^^1^1^3031125^
"^DD",9002313.03,9002313.0301,1000,21,1,0)
Response text to indicate duplicated data.
"^DD",9002313.03,9002313.0301,1000,"DT")
3031125
"^DD",9002313.03,9002313.03511,0)
Reject Code(s) SUB-FIELD^^546^2
"^DD",9002313.03,9002313.03511,0,"DT")
3020808
"^DD",9002313.03,9002313.03511,0,"IX","B",9002313.03511,.01)

"^DD",9002313.03,9002313.03511,0,"NM","Reject Code(s)")

"^DD",9002313.03,9002313.03511,0,"UP")
9002313.0301
"^DD",9002313.03,9002313.03511,.01,0)
Reject Code(s)^MFO^^0;1^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.03,9002313.03511,.01,1,0)
^.1
"^DD",9002313.03,9002313.03511,.01,1,1,0)
9002313.03511^B
"^DD",9002313.03,9002313.03511,.01,1,1,1)
S ^BPSR(DA(2),1000,DA(1),511,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.03511,.01,1,1,2)
K ^BPSR(DA(2),1000,DA(1),511,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.03511,.01,2)
S Y(0)=Y S Y=$$TRANREJ^BPSECFM(Y)
"^DD",9002313.03,9002313.03511,.01,2.1)
S Y=$$TRANREJ^BPSECFM(Y)
"^DD",9002313.03,9002313.03511,.01,3)
Answer must be 1-3 characters in length.
"^DD",9002313.03,9002313.03511,.01,21,0)
^^2^2^3040126^
"^DD",9002313.03,9002313.03511,.01,21,1,0)
The code returned in the response indicating the reason(s)
"^DD",9002313.03,9002313.03511,.01,21,2,0)
why the claim was rejected.
"^DD",9002313.03,9002313.03511,.01,"DT")
3020828
"^DD",9002313.03,9002313.03511,546,0)
Reject Fld Occurrence Ind^F^^0;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.03511,546,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.03511,546,21,0)
^^1^1^3040126^
"^DD",9002313.03,9002313.03511,546,21,1,0)
The number of times a particular field caused a rejection to be triggered.
"^DD",9002313.03,9002313.03511,546,"DT")
3020807
"^DD",9002313.03,9002313.1101,0)
DUR/PPS Repeating Flds SUB-FIELD^^544^9
"^DD",9002313.03,9002313.1101,0,"DT")
3020820
"^DD",9002313.03,9002313.1101,0,"IX","B",9002313.1101,.01)

"^DD",9002313.03,9002313.1101,0,"NM","DUR/PPS Repeating Flds")

"^DD",9002313.03,9002313.1101,0,"UP")
9002313.0301
"^DD",9002313.03,9002313.1101,.01,0)
(567) DUR/PPS Resp Cd Counter^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.1101,.01,1,0)
^.1
"^DD",9002313.03,9002313.1101,.01,1,1,0)
9002313.1101^B
"^DD",9002313.03,9002313.1101,.01,1,1,1)
S ^BPSR(DA(2),1000,DA(1),567.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.1101,.01,1,1,2)
K ^BPSR(DA(2),1000,DA(1),567.01,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.1101,.01,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.1101,.01,21,0)
^^1^1^3031125^
"^DD",9002313.03,9002313.1101,.01,21,1,0)
Counter number for each DUR/PPS set/logical grouping.
"^DD",9002313.03,9002313.1101,.01,"DT")
3031125
"^DD",9002313.03,9002313.1101,439,0)
Reason for Service Code^FO^^0;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.1101,439,2)
S Y(0)=Y S Y=$$TRANSCD^BPSECFM(Y)
"^DD",9002313.03,9002313.1101,439,2.1)
S Y=$$TRANSCD^BPSECFM(Y)
"^DD",9002313.03,9002313.1101,439,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.1101,439,21,0)
^^2^2^3031125^
"^DD",9002313.03,9002313.1101,439,21,1,0)
Code identifying the type of utilization conflict detected or the reason 
"^DD",9002313.03,9002313.1101,439,21,2,0)
for the pharmacist's professional service.
"^DD",9002313.03,9002313.1101,439,"DT")
3031125
"^DD",9002313.03,9002313.1101,528,0)
Clinical Significance Code^F^^0;3^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.1101,528,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.1101,528,21,0)
^^2^2^3031125^^
"^DD",9002313.03,9002313.1101,528,21,1,0)
Code identifying the significance or severity level of a clinical event 
"^DD",9002313.03,9002313.1101,528,21,2,0)
as contained in the originating data base.
"^DD",9002313.03,9002313.1101,528,"DT")
3031125
"^DD",9002313.03,9002313.1101,529,0)
Other Pharmacy Indicator^F^^0;4^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.1101,529,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.1101,529,21,0)
^^2^2^3040126^
"^DD",9002313.03,9002313.1101,529,21,1,0)
Indicator telling whether the medication that caused the DUR to be 
"^DD",9002313.03,9002313.1101,529,21,2,0)
triggered came from the current pharmacy, or an outside pharmacy.
"^DD",9002313.03,9002313.1101,529,"DT")
3020820
"^DD",9002313.03,9002313.1101,530,0)
Previous Date of Fill^F^^0;5^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.1101,530,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.1101,530,21,0)
^^1^1^3031125^
"^DD",9002313.03,9002313.1101,530,21,1,0)
Date prescription was previously filled.
"^DD",9002313.03,9002313.1101,530,"DT")
3031125
"^DD",9002313.03,9002313.1101,531,0)
Quantity of Previous Fill^F^^0;6^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.03,9002313.1101,531,3)
Answer must be 1-10 characters in length.
"^DD",9002313.03,9002313.1101,531,21,0)
^^2^2^3031125^
"^DD",9002313.03,9002313.1101,531,21,1,0)
Amount expressed in metric decimal units of the conflicting agent that 
"^DD",9002313.03,9002313.1101,531,21,2,0)
was previously filled.
"^DD",9002313.03,9002313.1101,531,"DT")
3031125
"^DD",9002313.03,9002313.1101,532,0)
Database Indicator^F^^0;7^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.1101,532,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.1101,532,21,0)
^^1^1^3031125^
"^DD",9002313.03,9002313.1101,532,21,1,0)
Code identifying the source of drug information used for DUR processing.
"^DD",9002313.03,9002313.1101,532,"DT")
3031125
"^DD",9002313.03,9002313.1101,533,0)
Other Prescriber Indicator^F^^0;8^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.1101,533,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.1101,533,21,0)
^^2^2^3031125^
"^DD",9002313.03,9002313.1101,533,21,1,0)
Code comparing the prescriber of the current prescription to the 
"^DD",9002313.03,9002313.1101,533,21,2,0)
prescriber of the previously filled conflicting prescription.
"^DD",9002313.03,9002313.1101,533,"DT")
3031125
"^DD",9002313.03,9002313.1101,544,0)
DUR Free Text Message^F^^0;9^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.03,9002313.1101,544,3)
Answer must be 1-30 characters in length.
"^DD",9002313.03,9002313.1101,544,21,0)
^^1^1^3031125^
"^DD",9002313.03,9002313.1101,544,21,1,0)
Text that provides additional detail regarding a DUR conflict.
"^DD",9002313.03,9002313.1101,544,"DT")
3031125
"^DD",9002313.03,9002313.1301,0)
Preferred Product Repeating SUB-FIELD^^556^6
"^DD",9002313.03,9002313.1301,0,"DT")
3020807
"^DD",9002313.03,9002313.1301,0,"IX","B",9002313.1301,.01)

"^DD",9002313.03,9002313.1301,0,"NM","Preferred Product Repeating")

"^DD",9002313.03,9002313.1301,0,"UP")
9002313.0301
"^DD",9002313.03,9002313.1301,.01,0)
Preferred Product Counter^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.1301,.01,1,0)
^.1
"^DD",9002313.03,9002313.1301,.01,1,1,0)
9002313.1301^B
"^DD",9002313.03,9002313.1301,.01,1,1,1)
S ^BPSR(DA(2),1000,DA(1),551.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.1301,.01,1,1,2)
K ^BPSR(DA(2),1000,DA(1),551.01,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.1301,.01,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.1301,.01,21,0)
^^1^1^3040331^
"^DD",9002313.03,9002313.1301,.01,21,1,0)
Sequential counter of the Preferred Product occurences.
"^DD",9002313.03,9002313.1301,.01,"DT")
3040331
"^DD",9002313.03,9002313.1301,552,0)
Preferred Product ID Qualifier^F^^1;1^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.1301,552,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.1301,552,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.1301,552,21,1,0)
Code qualifying the type of product ID submitted in 'Preferred Product 
"^DD",9002313.03,9002313.1301,552,21,2,0)
ID' (553).
"^DD",9002313.03,9002313.1301,552,"DT")
3031124
"^DD",9002313.03,9002313.1301,553,0)
Preferred Product ID  ^F^^1;2^K:$L(X)>19!($L(X)<1) X
"^DD",9002313.03,9002313.1301,553,3)
Answer must be 1-19 characters in length.
"^DD",9002313.03,9002313.1301,553,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.1301,553,21,1,0)
Alternate product recommended by the plan.
"^DD",9002313.03,9002313.1301,553,"DT")
3031124
"^DD",9002313.03,9002313.1301,554,0)
Preferred Product Incentive^F^^1;3^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.1301,554,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.1301,554,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.1301,554,21,1,0)
Amount of pharmacy incentive available for substitution of preferred 
"^DD",9002313.03,9002313.1301,554,21,2,0)
product.
"^DD",9002313.03,9002313.1301,554,"DT")
3031124
"^DD",9002313.03,9002313.1301,555,0)
Preferred Product Copay Inc^F^^1;4^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.1301,555,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.1301,555,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.1301,555,21,1,0)
Amount of patient's copay/cost-share incentive for preferred product.
"^DD",9002313.03,9002313.1301,555,"DT")
3031124
"^DD",9002313.03,9002313.1301,556,0)
Preferred Product Description^F^^1;5^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.03,9002313.1301,556,3)
Answer must be 1-40 characters in length.
"^DD",9002313.03,9002313.1301,556,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.1301,556,21,1,0)
Free text message.
"^DD",9002313.03,9002313.1301,556,"DT")
3031124
"^DD",9002313.03,9002313.1401,0)
Other Amt Paid Repeating Flds SUB-FIELD^^565^3
"^DD",9002313.03,9002313.1401,0,"DT")
3020807
"^DD",9002313.03,9002313.1401,0,"IX","B",9002313.1401,.01)

"^DD",9002313.03,9002313.1401,0,"NM","Other Amt Paid Repeating Flds")

"^DD",9002313.03,9002313.1401,0,"UP")
9002313.0301
"^DD",9002313.03,9002313.1401,.01,0)
Other Amt Paid Counter^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.1401,.01,1,0)
^.1
"^DD",9002313.03,9002313.1401,.01,1,1,0)
9002313.1401^B
"^DD",9002313.03,9002313.1401,.01,1,1,1)
S ^BPSR(DA(2),1000,DA(1),563.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.1401,.01,1,1,2)
K ^BPSR(DA(2),1000,DA(1),563.01,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.1401,.01,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.1401,.01,21,0)
^^1^1^3031125^
"^DD",9002313.03,9002313.1401,.01,21,1,0)
Count of the other amount paid occurrences.
"^DD",9002313.03,9002313.1401,.01,"DT")
3031125
"^DD",9002313.03,9002313.1401,564,0)
Other Amount Paid Qualifier^F^^1;1^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.1401,564,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.1401,564,21,0)
^^1^1^3031125^
"^DD",9002313.03,9002313.1401,564,21,1,0)
Code clarifying the value in the 'Other Amount Paid' (565).
"^DD",9002313.03,9002313.1401,564,"DT")
3031125
"^DD",9002313.03,9002313.1401,565,0)
Other Amount Paid  ^F^^1;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.1401,565,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.1401,565,21,0)
^^2^2^3031125^
"^DD",9002313.03,9002313.1401,565,21,1,0)
Amount paid for additional  costs claimed in 'Other Amount Claimed 
"^DD",9002313.03,9002313.1401,565,21,2,0)
Submitted' (48).
"^DD",9002313.03,9002313.1401,565,"DT")
3031125
"^DD",9002313.03,9002313.301548,0)
Approved Message Code  SUB-FIELD^^.01^1
"^DD",9002313.03,9002313.301548,0,"DT")
3020808
"^DD",9002313.03,9002313.301548,0,"IX","B",9002313.301548,.01)

"^DD",9002313.03,9002313.301548,0,"NM","Approved Message Code ")

"^DD",9002313.03,9002313.301548,0,"UP")
9002313.0301
"^DD",9002313.03,9002313.301548,.01,0)
Approved Message Code ^F^^0;1^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.03,9002313.301548,.01,1,0)
^.1
"^DD",9002313.03,9002313.301548,.01,1,1,0)
9002313.301548^B
"^DD",9002313.03,9002313.301548,.01,1,1,1)
S ^BPSR(DA(2),1000,DA(1),548,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.301548,.01,1,1,2)
K ^BPSR(DA(2),1000,DA(1),548,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.301548,.01,3)
Answer must be 1-3 characters in length.
"^DD",9002313.03,9002313.301548,.01,21,0)
^^2^2^3031124^
"^DD",9002313.03,9002313.301548,.01,21,1,0)
Message code, on an approved claim/service, communicating the need for an 
"^DD",9002313.03,9002313.301548,.01,21,2,0)
additional follow-up.
"^DD",9002313.03,9002313.301548,.01,"DT")
3031124
"^DD",9002313.03,9002313.39999,0)
RAW DATA RECEIVED SUB-FIELD^^.01^1
"^DD",9002313.03,9002313.39999,0,"DT")
3000830
"^DD",9002313.03,9002313.39999,0,"NM","RAW DATA RECEIVED")

"^DD",9002313.03,9002313.39999,0,"UP")
9002313.03
"^DD",9002313.03,9002313.39999,.01,0)
RAW DATA RECEIVED^WL^^0;1^Q
"^DD",9002313.03,9002313.39999,.01,21,0)
^^3^3^3000830^
"^DD",9002313.03,9002313.39999,.01,21,1,0)
A copy of the raw data packet received.
"^DD",9002313.03,9002313.39999,.01,21,2,0)
This could be of use in diagnosing weird problems,
"^DD",9002313.03,9002313.39999,.01,21,3,0)
such as the time a packet was apparently shifted two places.
"^DD",9002313.03,9002313.39999,.01,"DT")
3000830
"^DD",9002313.1,9002313.1,0)
FIELD^^1^2
"^DD",9002313.1,9002313.1,0,"DT")
3040115
"^DD",9002313.1,9002313.1,0,"IX","B",9002313.1,.01)

"^DD",9002313.1,9002313.1,0,"NM","BPS COMBINED INSURANCE")

"^DD",9002313.1,9002313.1,0,"VRPK")
BPS
"^DD",9002313.1,9002313.1,.01,0)
PATIENT NAME^RP2'X^DPT(^0;1^S DINUM=X
"^DD",9002313.1,9002313.1,.01,1,0)
^.1
"^DD",9002313.1,9002313.1,.01,1,1,0)
9002313.1^B
"^DD",9002313.1,9002313.1,.01,1,1,1)
S ^BPSCOMB("B",$E(X,1,30),DA)=""
"^DD",9002313.1,9002313.1,.01,1,1,2)
K ^BPSCOMB("B",$E(X,1,30),DA)
"^DD",9002313.1,9002313.1,.01,3)

"^DD",9002313.1,9002313.1,.01,21,0)
^^1^1^3031125^
"^DD",9002313.1,9002313.1,.01,21,1,0)
Name of the patient receiving the prescription.
"^DD",9002313.1,9002313.1,.01,"DT")
3031125
"^DD",9002313.1,9002313.1,1,0)
COMPANY^9002313.11^^1;0
"^DD",9002313.1,9002313.11,0)
COMPANY SUB-FIELD^^.11^11
"^DD",9002313.1,9002313.11,0,"DT")
3040115
"^DD",9002313.1,9002313.11,0,"IX","B",9002313.11,.01)

"^DD",9002313.1,9002313.11,0,"NM","COMPANY")

"^DD",9002313.1,9002313.11,0,"UP")
9002313.1
"^DD",9002313.1,9002313.11,.01,0)
COMPANY^MF^^0;1^K:$L(X)>35!($L(X)<5) X
"^DD",9002313.1,9002313.11,.01,1,0)
^.1
"^DD",9002313.1,9002313.11,.01,1,1,0)
9002313.11^B
"^DD",9002313.1,9002313.11,.01,1,1,1)
S ^BPSCOMB(DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002313.1,9002313.11,.01,1,1,2)
K ^BPSCOMB(DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002313.1,9002313.11,.01,3)
Answer must be 5-35 characters in length.
"^DD",9002313.1,9002313.11,.01,21,0)
^.001^1^1^3040116^^^
"^DD",9002313.1,9002313.11,.01,21,1,0)
Name of the insurance company providing the coverage.
"^DD",9002313.1,9002313.11,.01,"DT")
3040115
"^DD",9002313.1,9002313.11,.02,0)
INSURANCE TYPE^S^PRVT:PRIVATE;CARE:MEDICARE;CAID:MEDICAID;SELF:SELF PAY;^0;2^Q
"^DD",9002313.1,9002313.11,.02,21,0)
^^1^1^3031125^
"^DD",9002313.1,9002313.11,.02,21,1,0)
Type insurance coverage.
"^DD",9002313.1,9002313.11,.02,"DT")
3031125
"^DD",9002313.1,9002313.11,.03,0)
NAME OF POLICY HOLDER^F^^0;3^K:$L(X)>30!($L(X)<3) X
"^DD",9002313.1,9002313.11,.03,3)
Answer must be 3-30 characters in length.
"^DD",9002313.1,9002313.11,.03,21,0)
^^1^1^3031125^
"^DD",9002313.1,9002313.11,.03,21,1,0)
Name of the person through who the coverage originates.
"^DD",9002313.1,9002313.11,.03,"DT")
3031125
"^DD",9002313.1,9002313.11,.04,0)
POLICY NUMBER^F^^0;4^K:$L(X)>15!($L(X)<3) X
"^DD",9002313.1,9002313.11,.04,3)
Answer must be 3-15 characters in length.
"^DD",9002313.1,9002313.11,.04,21,0)
^.001^1^1^3040428^^
"^DD",9002313.1,9002313.11,.04,21,1,0)
Number of the insurance policy providing the coverage.
"^DD",9002313.1,9002313.11,.04,"DT")
3031125
"^DD",9002313.1,9002313.11,.05,0)
ELIGIBILITY START DATE^D^^0;5^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.1,9002313.11,.05,21,0)
^^1^1^3031125^
"^DD",9002313.1,9002313.11,.05,21,1,0)
First date that coverage starts.
"^DD",9002313.1,9002313.11,.05,"DT")
3031125
"^DD",9002313.1,9002313.11,.06,0)
ELIGIBILITY END DATE^D^^0;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.1,9002313.11,.06,3)

"^DD",9002313.1,9002313.11,.06,21,0)
^^1^1^3031125^
"^DD",9002313.1,9002313.11,.06,21,1,0)
Date on which the coverage ends.
"^DD",9002313.1,9002313.11,.06,"DT")
3031125
"^DD",9002313.1,9002313.11,.07,0)
POLICY HOLDER^F^^0;7^K:$L(X)>45!($L(X)<5) X
"^DD",9002313.1,9002313.11,.07,3)
Answer must be 5-45 characters in length.
"^DD",9002313.1,9002313.11,.07,21,0)
^^1^1^3040115^
"^DD",9002313.1,9002313.11,.07,21,1,0)
Name of the actual policy holder
"^DD",9002313.1,9002313.11,.07,"DT")
3040115
"^DD",9002313.1,9002313.11,.08,0)
SOURCE FILE^P1'^DIC(^0;8^Q
"^DD",9002313.1,9002313.11,.08,21,0)
^^1^1^3031125^
"^DD",9002313.1,9002313.11,.08,21,1,0)
A description of the source for the data.
"^DD",9002313.1,9002313.11,.08,"DT")
3031125
"^DD",9002313.1,9002313.11,.09,0)
SOURCE IEN^NJ15,0^^0;9^K:+X'=X!(X>999999999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.1,9002313.11,.09,3)
Type a Number between 1 and 999999999999999, 0 Decimal Digits
"^DD",9002313.1,9002313.11,.09,21,0)
^^1^1^3031125^
"^DD",9002313.1,9002313.11,.09,21,1,0)
Internal ID for the data source.
"^DD",9002313.1,9002313.11,.09,"DT")
3031125
"^DD",9002313.1,9002313.11,.1,0)
PRIVATE INSURANCE SUB IEN^NJ8,0^^0;10^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.1,9002313.11,.1,3)
Type a Number between 0 and 99999999, 0 Decimal Digits
"^DD",9002313.1,9002313.11,.1,21,0)
^^1^1^3031125^
"^DD",9002313.1,9002313.11,.1,21,1,0)
Internal ID of the insurance subscriber.
"^DD",9002313.1,9002313.11,.1,"DT")
3031125
"^DD",9002313.1,9002313.11,.11,0)
RELATIONSHIP TO INSURED^F^^0;11^K:$L(X)>30!($L(X)<5) X
"^DD",9002313.1,9002313.11,.11,3)
Answer must be 5-30 characters in length.
"^DD",9002313.1,9002313.11,.11,21,0)
^.001^1^1^3040115^^
"^DD",9002313.1,9002313.11,.11,21,1,0)
Relationship between the patient and the subscriber.
"^DD",9002313.1,9002313.11,.11,"DT")
3040115
"^DD",9002313.21,9002313.21,0)
FIELD^^1^2
"^DD",9002313.21,9002313.21,0,"DDA")
N
"^DD",9002313.21,9002313.21,0,"DT")
3050509
"^DD",9002313.21,9002313.21,0,"ID",1)
W "   ",$P(^(0),U,2)
"^DD",9002313.21,9002313.21,0,"IX","B",9002313.21,.01)

"^DD",9002313.21,9002313.21,0,"NM","BPS NCPDP PROFESSIONAL SERVICE CODE")

"^DD",9002313.21,9002313.21,0,"VRPK")
BPS
"^DD",9002313.21,9002313.21,.01,0)
CODE^RF^^0;1^K:$L(X)>5!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.21,9002313.21,.01,1,0)
^.1
"^DD",9002313.21,9002313.21,.01,1,1,0)
9002313.21^B
"^DD",9002313.21,9002313.21,.01,1,1,1)
S ^BPS(9002313.21,"B",$E(X,1,30),DA)=""
"^DD",9002313.21,9002313.21,.01,1,1,2)
K ^BPS(9002313.21,"B",$E(X,1,30),DA)
"^DD",9002313.21,9002313.21,.01,3)
Answer must be 1-5 characters in length
"^DD",9002313.21,9002313.21,.01,21,0)
^^2^2^3050624^
"^DD",9002313.21,9002313.21,.01,21,1,0)
Code identifying pharmacist intervention when a conflict code has been identified or service has been
"^DD",9002313.21,9002313.21,.01,21,2,0)
rendered. 
"^DD",9002313.21,9002313.21,.01,"DT")
3050509
"^DD",9002313.21,9002313.21,1,0)
DESCRIPTION^F^^0;2^K:$L(X)>50!($L(X)<1) X
"^DD",9002313.21,9002313.21,1,3)
Answer must be 1-50 characters in length
"^DD",9002313.21,9002313.21,1,21,0)
^.001^1^1^3050624^^
"^DD",9002313.21,9002313.21,1,21,1,0)
Description of the NCPDP PROFESSIONAL SERVICE CODE use to override DUR rejects (e.g., PHARMACIST CONSULTED OTHER SOURCE,PRESCRIBER CONSULTED).
"^DD",9002313.21,9002313.21,1,"DT")
3050509
"^DD",9002313.22,9002313.22,0)
FIELD^^1^2
"^DD",9002313.22,9002313.22,0,"DDA")
N
"^DD",9002313.22,9002313.22,0,"DT")
3050509
"^DD",9002313.22,9002313.22,0,"ID",1)
W "   ",$P(^(0),U,2)
"^DD",9002313.22,9002313.22,0,"IX","B",9002313.22,.01)

"^DD",9002313.22,9002313.22,0,"NM","BPS NCPDP RESULT OF SERVICE CODE")

"^DD",9002313.22,9002313.22,0,"VRPK")
BPS
"^DD",9002313.22,9002313.22,.01,0)
CODE^RF^^0;1^K:$L(X)>5!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.22,9002313.22,.01,1,0)
^.1
"^DD",9002313.22,9002313.22,.01,1,1,0)
9002313.22^B
"^DD",9002313.22,9002313.22,.01,1,1,1)
S ^BPS(9002313.22,"B",$E(X,1,30),DA)=""
"^DD",9002313.22,9002313.22,.01,1,1,2)
K ^BPS(9002313.22,"B",$E(X,1,30),DA)
"^DD",9002313.22,9002313.22,.01,3)
Answer must be 1-5 characters in length
"^DD",9002313.22,9002313.22,.01,21,0)
^.001^1^1^3050624^^^
"^DD",9002313.22,9002313.22,.01,21,1,0)
Action taken by a pharmacist in response to a conflict or the result of a pharmacist's professional service.
"^DD",9002313.22,9002313.22,.01,"DT")
3050509
"^DD",9002313.22,9002313.22,1,0)
DESCRIPTION^F^^0;2^K:$L(X)>50!($L(X)<1) X
"^DD",9002313.22,9002313.22,1,3)
Answer must be 1-50 characters in length
"^DD",9002313.22,9002313.22,1,21,0)
^^1^1^3050624^
"^DD",9002313.22,9002313.22,1,21,1,0)
Description of the NCPDP RESULT OF SERVICE CODE used to override DUR rejects (e.g., FILLED, WITH DIFFERENT DOSAGE FORM,THERAPY CHANGED)
"^DD",9002313.22,9002313.22,1,"DT")
3050509
"^DD",9002313.23,9002313.23,0)
FIELD^^1^2
"^DD",9002313.23,9002313.23,0,"DDA")
N
"^DD",9002313.23,9002313.23,0,"DT")
3050512
"^DD",9002313.23,9002313.23,0,"ID",1)
W "   ",$P(^(0),U,2)
"^DD",9002313.23,9002313.23,0,"IX","B",9002313.23,.01)

"^DD",9002313.23,9002313.23,0,"NM","BPS NCPDP REASON FOR SERVICE CODE")

"^DD",9002313.23,9002313.23,0,"VRPK")
BPS
"^DD",9002313.23,9002313.23,.01,0)
CODE^RF^^0;1^K:$L(X)>5!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.23,9002313.23,.01,1,0)
^.1
"^DD",9002313.23,9002313.23,.01,1,1,0)
9002313.23^B
"^DD",9002313.23,9002313.23,.01,1,1,1)
S ^BPS(9002313.23,"B",$E(X,1,30),DA)=""
"^DD",9002313.23,9002313.23,.01,1,1,2)
K ^BPS(9002313.23,"B",$E(X,1,30),DA)
"^DD",9002313.23,9002313.23,.01,3)
Answer must be 1-5 characters in length
"^DD",9002313.23,9002313.23,.01,21,0)
^^1^1^3050624^
"^DD",9002313.23,9002313.23,.01,21,1,0)
Code identifying the type of utilization conflict detected or the reason for the pharmacist's professional service. 
"^DD",9002313.23,9002313.23,.01,"DT")
3050512
"^DD",9002313.23,9002313.23,1,0)
DESCRIPTION^F^^0;2^K:$L(X)>60!($L(X)<1) X
"^DD",9002313.23,9002313.23,1,3)
Answer must be 1-60 characters in length
"^DD",9002313.23,9002313.23,1,21,0)
^.001^1^1^3050624^^
"^DD",9002313.23,9002313.23,1,21,1,0)
Description of the NCPDP REASON FOR SERVICE CODE used to override DUR rejects (e.g., SUBOPTIMAL DRUG/INDICATION, LABORATORY TEST NEEDED).
"^DD",9002313.23,9002313.23,1,"DT")
3050624
"^DD",9002313.24,9002313.24,0)
FIELD^^1^2
"^DD",9002313.24,9002313.24,0,"DDA")
N
"^DD",9002313.24,9002313.24,0,"DT")
3050627
"^DD",9002313.24,9002313.24,0,"ID",1)
W "   ",$P(^(0),U,2)
"^DD",9002313.24,9002313.24,0,"IX","B",9002313.24,.01)

"^DD",9002313.24,9002313.24,0,"NM","BPS NCPDP DAW CODE")

"^DD",9002313.24,9002313.24,0,"VRPK")
BPS
"^DD",9002313.24,9002313.24,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.24,9002313.24,.01,1,0)
^.1
"^DD",9002313.24,9002313.24,.01,1,1,0)
9002313.24^B
"^DD",9002313.24,9002313.24,.01,1,1,1)
S ^BPS(9002313.24,"B",$E(X,1,30),DA)=""
"^DD",9002313.24,9002313.24,.01,1,1,2)
K ^BPS(9002313.24,"B",$E(X,1,30),DA)
"^DD",9002313.24,9002313.24,.01,3)
Answer must be 1-2 characters in length
"^DD",9002313.24,9002313.24,.01,21,0)
^^1^1^3050627^
"^DD",9002313.24,9002313.24,.01,21,1,0)
Code indicating whether or not the prescriber's instructions regarding generic substitution were followed.
"^DD",9002313.24,9002313.24,.01,"DT")
3050627
"^DD",9002313.24,9002313.24,1,0)
DESCRIPTION^F^^0;2^K:$L(X)>100!($L(X)<1) X
"^DD",9002313.24,9002313.24,1,3)
Answer must be 1-100 characters in length
"^DD",9002313.24,9002313.24,1,21,0)
^^1^1^3050627^
"^DD",9002313.24,9002313.24,1,21,1,0)
Description of the DAW code (e.g., SUBSTITUTION NOT ALLOWED BY PRESCRIBER).
"^DD",9002313.24,9002313.24,1,"DT")
3050627
"^DD",9002313.31,9002313.31,0)
FIELD^^903^9
"^DD",9002313.31,9002313.31,0,"DT")
3040116
"^DD",9002313.31,9002313.31,0,"IX","B",9002313.31,.01)

"^DD",9002313.31,9002313.31,0,"NM","BPS CERTIFICATION")

"^DD",9002313.31,9002313.31,0,"VRPK")
BPS
"^DD",9002313.31,9002313.31,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.31,9002313.31,.01,1,0)
^.1
"^DD",9002313.31,9002313.31,.01,1,1,0)
9002313.31^B
"^DD",9002313.31,9002313.31,.01,1,1,1)
S ^BPS(9002313.31,"B",$E(X,1,30),DA)=""
"^DD",9002313.31,9002313.31,.01,1,1,2)
K ^BPS(9002313.31,"B",$E(X,1,30),DA)
"^DD",9002313.31,9002313.31,.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.31,9002313.31,.01,21,0)
^^2^2^3040116^
"^DD",9002313.31,9002313.31,.01,21,1,0)
Name of the certification - typically whichever Processor the 
"^DD",9002313.31,9002313.31,.01,21,2,0)
certification is being done for.
"^DD",9002313.31,9002313.31,.01,"DT")
3040116
"^DD",9002313.31,9002313.31,.03,0)
CREATED 9002313.02^P9002313.02'^BPSC(^0;3^Q
"^DD",9002313.31,9002313.31,.03,21,0)
^^1^1^3040120^
"^DD",9002313.31,9002313.31,.03,21,1,0)
The date this certification was created.
"^DD",9002313.31,9002313.31,.03,"DT")
3000928
"^DD",9002313.31,9002313.31,.04,0)
POINT TO 9002313.4^P9002313.92'^BPSF(9002313.92,^0;4^Q
"^DD",9002313.31,9002313.31,.04,21,0)
^.001^2^2^3031030^^
"^DD",9002313.31,9002313.31,.04,21,1,0)
Points to the FSI INSURER (from whence comes the pointer to the
"^DD",9002313.31,9002313.31,.04,21,2,0)
9002313.92 format)
"^DD",9002313.31,9002313.31,.04,"DT")
3031030
"^DD",9002313.31,9002313.31,.05,0)
SWITCH TYPE^S^NDC:NDC;ENVOY:ENVOY;VA:VA;^0;5^Q
"^DD",9002313.31,9002313.31,.05,21,0)
^^5^5^3040120^
"^DD",9002313.31,9002313.31,.05,21,1,0)
Type of switch the payer uses.
"^DD",9002313.31,9002313.31,.05,21,2,0)
 
"^DD",9002313.31,9002313.31,.05,21,3,0)
'NDC' FOR NDC; 
"^DD",9002313.31,9002313.31,.05,21,4,0)
'ENVOY' FOR ENVOY; 
"^DD",9002313.31,9002313.31,.05,21,5,0)
'VA' FOR VA;
"^DD",9002313.31,9002313.31,.05,"DT")
3031030
"^DD",9002313.31,9002313.31,1,0)
NCPDP FIELD #^9002313.311PA^^1;0
"^DD",9002313.31,9002313.31,1,21,0)
^.001^2^2^3040120^^^^
"^DD",9002313.31,9002313.31,1,21,1,0)
Contains field information for any NCPDP fields which need to
"^DD",9002313.31,9002313.31,1,21,2,0)
be defaulted.
"^DD",9002313.31,9002313.31,2,0)
RX IN POSITION #^9002313.312A^^2;0
"^DD",9002313.31,9002313.31,2,21,0)
^.001^2^2^3040120^^^^
"^DD",9002313.31,9002313.31,2,21,1,0)
The prescription order when submitting multiple claims in one 
"^DD",9002313.31,9002313.31,2,21,2,0)
transmission.
"^DD",9002313.31,9002313.31,901,0)
PAYER SHEET^P9002313.92'^BPSF(9002313.92,^4;1^Q
"^DD",9002313.31,9002313.31,901,21,0)
^^2^2^3040120^
"^DD",9002313.31,9002313.31,901,21,1,0)
Pointer to the payer sheet file to determine which payer sheet is used in 
"^DD",9002313.31,9002313.31,901,21,2,0)
this certification.
"^DD",9002313.31,9002313.31,901,"DT")
3031028
"^DD",9002313.31,9002313.31,902,0)
VA PINS MULTIPLE^9002313.31902A^^3;0
"^DD",9002313.31,9002313.31,903,0)
PATIENT IEN^P2'^DPT(^4;2^Q
"^DD",9002313.31,9002313.31,903,21,0)
^^2^2^3040120^
"^DD",9002313.31,9002313.31,903,21,1,0)
Pointer to the patient file to link the patient being used for 
"^DD",9002313.31,9002313.31,903,21,2,0)
certification to the certification being performed.
"^DD",9002313.31,9002313.31,903,"DT")
3031105
"^DD",9002313.31,9002313.311,0)
NCPDP FIELD # SUB-FIELD^^.02^3
"^DD",9002313.31,9002313.311,0,"DT")
3000928
"^DD",9002313.31,9002313.311,0,"IX","B",9002313.311,.01)

"^DD",9002313.31,9002313.311,0,"NM","NCPDP FIELD #")

"^DD",9002313.31,9002313.311,0,"UP")
9002313.31
"^DD",9002313.31,9002313.311,.01,0)
NCPDP FIELD #^MP9002313.91'^BPSF(9002313.91,^0;1^Q
"^DD",9002313.31,9002313.311,.01,1,0)
^.1
"^DD",9002313.31,9002313.311,.01,1,1,0)
9002313.311^B
"^DD",9002313.31,9002313.311,.01,1,1,1)
S ^BPS(9002313.31,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002313.31,9002313.311,.01,1,1,2)
K ^BPS(9002313.31,DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002313.31,9002313.311,.01,21,0)
^^2^2^3040120^
"^DD",9002313.31,9002313.311,.01,21,1,0)
Pointer to the NCPDP fields file, for use in defining special values
"^DD",9002313.31,9002313.311,.01,21,2,0)
used only during certification.
"^DD",9002313.31,9002313.311,.01,"DT")
3000928
"^DD",9002313.31,9002313.311,.0199,0)
FIELD NAME^CJ30^^ ; ^X ^DD(9002313.311,.0199,9.3) S X=$P(Y(9002313.311,.0199,101),U,3) S D0=Y(9002313.311,.0199,80) S D1=Y(9002313.311,.0199,81)
"^DD",9002313.31,9002313.311,.0199,9)
^
"^DD",9002313.31,9002313.311,.0199,9.01)
9002313.91^.03;9002313.311^.01
"^DD",9002313.31,9002313.311,.0199,9.1)
NCPDP FIELD #:Name
"^DD",9002313.31,9002313.311,.0199,9.2)
S Y(9002313.311,.0199,81)=$S($D(D1):D1,1:""),Y(9002313.311,.0199,80)=$S($D(D0):D0,1:""),Y(9002313.311,.0199,1)=$S($D(^BPS(9002313.31,D0,1,D1,0)):^(0),1:"")
"^DD",9002313.31,9002313.311,.0199,9.3)
X ^DD(9002313.311,.0199,9.2) S D0=$P(Y(9002313.311,.0199,1),U,1) S:'$D(^BPSF(9002313.91,+D0,0)) D0=-1 S Y(9002313.311,.0199,101)=$S($D(^BPSF(9002313.91,D0,0)):^(0),1:"")
"^DD",9002313.31,9002313.311,.0199,21,0)
^^1^1^3040120^
"^DD",9002313.31,9002313.311,.0199,21,1,0)
The name of the field being used for certification.
"^DD",9002313.31,9002313.311,.0199,"DT")
3001017
"^DD",9002313.31,9002313.311,.02,0)
VALUE^F^^0;2^K:$L(X)>200!($L(X)<1) X
"^DD",9002313.31,9002313.311,.02,3)
Answer must be 1-200 characters in length.
"^DD",9002313.31,9002313.311,.02,21,0)
^^2^2^3040116^
"^DD",9002313.31,9002313.311,.02,21,1,0)
The value (if any) that the certification information should
"^DD",9002313.31,9002313.311,.02,21,2,0)
be defaulted to.
"^DD",9002313.31,9002313.311,.02,"DT")
3000928
"^DD",9002313.31,9002313.312,0)
RX IN POSITION # SUB-FIELD^^1^2
"^DD",9002313.31,9002313.312,0,"DT")
3000928
"^DD",9002313.31,9002313.312,0,"IX","B",9002313.312,.01)

"^DD",9002313.31,9002313.312,0,"NM","RX IN POSITION #")

"^DD",9002313.31,9002313.312,0,"UP")
9002313.31
"^DD",9002313.31,9002313.312,.01,0)
RX IN POSITION #^MNJ1,0^^0;1^K:+X'=X!(X>4)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.31,9002313.312,.01,1,0)
^.1
"^DD",9002313.31,9002313.312,.01,1,1,0)
9002313.312^B
"^DD",9002313.31,9002313.312,.01,1,1,1)
S ^BPS(9002313.31,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",9002313.31,9002313.312,.01,1,1,2)
K ^BPS(9002313.31,DA(1),2,"B",$E(X,1,30),DA)
"^DD",9002313.31,9002313.312,.01,3)
Type a Number between 1 and 4, 0 Decimal Digits
"^DD",9002313.31,9002313.312,.01,21,0)
^^2^2^3040120^
"^DD",9002313.31,9002313.312,.01,21,1,0)
The position within the transmission of the particular prescription
"^DD",9002313.31,9002313.312,.01,21,2,0)
that is being certified.
"^DD",9002313.31,9002313.312,.01,"DT")
3000928
"^DD",9002313.31,9002313.312,1,0)
NCPDP FIELD #^9002313.3121PA^^1;0
"^DD",9002313.31,9002313.312,1,21,0)
^^1^1^3040331^
"^DD",9002313.31,9002313.312,1,21,1,0)
The NCPDP field that needs to be defaulted.
"^DD",9002313.31,9002313.3121,0)
NCPDP FIELD # SUB-FIELD^^.02^3
"^DD",9002313.31,9002313.3121,0,"DT")
3000928
"^DD",9002313.31,9002313.3121,0,"IX","B",9002313.3121,.01)

"^DD",9002313.31,9002313.3121,0,"NM","NCPDP FIELD #")

"^DD",9002313.31,9002313.3121,0,"UP")
9002313.312
"^DD",9002313.31,9002313.3121,.01,0)
NCPDP FIELD #^MP9002313.91'^BPSF(9002313.91,^0;1^Q
"^DD",9002313.31,9002313.3121,.01,1,0)
^.1
"^DD",9002313.31,9002313.3121,.01,1,1,0)
9002313.3121^B
"^DD",9002313.31,9002313.3121,.01,1,1,1)
S ^BPS(9002313.31,DA(2),2,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002313.31,9002313.3121,.01,1,1,2)
K ^BPS(9002313.31,DA(2),2,DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002313.31,9002313.3121,.01,21,0)
^.001^1^1^3040120^^
"^DD",9002313.31,9002313.3121,.01,21,1,0)
The numeric part of the NCPDP field ID.
"^DD",9002313.31,9002313.3121,.01,"DT")
3000928
"^DD",9002313.31,9002313.3121,.0199,0)
FIELD NAME^CJ30^^ ; ^X ^DD(9002313.3121,.0199,9.4) S X=$P(Y(9002313.3121,.0199,101),U,3) S D0=Y(9002313.3121,.0199,80) S D1=Y(9002313.3121,.0199,81) S D2=Y(9002313.3121,.0199,82)
"^DD",9002313.31,9002313.3121,.0199,9)
^
"^DD",9002313.31,9002313.3121,.0199,9.01)
9002313.91^.03;9002313.3121^.01
"^DD",9002313.31,9002313.3121,.0199,9.1)
NCPDP FIELD #:Name
"^DD",9002313.31,9002313.3121,.0199,9.2)
S Y(9002313.3121,.0199,82)=$S($D(D2):D2,1:""),Y(9002313.3121,.0199,81)=$S($D(D1):D1,1:""),Y(9002313.3121,.0199,80)=$S($D(D0):D0,1:"")
"^DD",9002313.31,9002313.3121,.0199,9.3)
X ^DD(9002313.3121,.0199,9.2) S Y(9002313.3121,.0199,1)=$S($D(^BPS(9002313.31,D0,2,D1,1,D2,0)):^(0),1:"")
"^DD",9002313.31,9002313.3121,.0199,9.4)
X ^DD(9002313.3121,.0199,9.3) S D0=$P(Y(9002313.3121,.0199,1),U,1) S:'$D(^BPSF(9002313.91,+D0,0)) D0=-1 S Y(9002313.3121,.0199,101)=$S($D(^BPSF(9002313.91,D0,0)):^(0),1:"")
"^DD",9002313.31,9002313.3121,.0199,21,0)
^^1^1^3040120^
"^DD",9002313.31,9002313.3121,.0199,21,1,0)
The name of the field being used for certification.
"^DD",9002313.31,9002313.3121,.02,0)
VALUE^F^^0;2^K:$L(X)>200!($L(X)<1) X
"^DD",9002313.31,9002313.3121,.02,3)
Answer must be 1-200 characters in length.
"^DD",9002313.31,9002313.3121,.02,21,0)
^^1^1^3040116^
"^DD",9002313.31,9002313.3121,.02,21,1,0)
The default value for the field.
"^DD",9002313.31,9002313.3121,.02,"DT")
3000928
"^DD",9002313.31,9002313.31902,0)
VA PINS MULTIPLE SUB-FIELD^^17^17
"^DD",9002313.31,9002313.31902,0,"DT")
3031028
"^DD",9002313.31,9002313.31902,0,"IX","B",9002313.31902,.01)

"^DD",9002313.31,9002313.31902,0,"NM","VA PINS MULTIPLE")

"^DD",9002313.31,9002313.31902,0,"UP")
9002313.31
"^DD",9002313.31,9002313.31902,.01,0)
PLAN ID^MF^^0;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.31,9002313.31902,.01,1,0)
^.1
"^DD",9002313.31,9002313.31902,.01,1,1,0)
9002313.31902^B
"^DD",9002313.31,9002313.31902,.01,1,1,1)
S ^BPS(9002313.31,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",9002313.31,9002313.31902,.01,1,1,2)
K ^BPS(9002313.31,DA(1),3,"B",$E(X,1,30),DA)
"^DD",9002313.31,9002313.31902,.01,3)
Answer must be 1-15 characters in length.
"^DD",9002313.31,9002313.31902,.01,21,0)
^.001^1^1^3031028^^^
"^DD",9002313.31,9002313.31902,.01,21,1,0)
Enter the Plan ID pointer to the IB Insurance file.
"^DD",9002313.31,9002313.31902,.01,"DT")
3031028
"^DD",9002313.31,9002313.31902,1,0)
PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.31,9002313.31902,1,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,1,21,1,0)
Enter the payer sheet ien for file 9002313.92.
"^DD",9002313.31,9002313.31902,1,"DT")
3031028
"^DD",9002313.31,9002313.31902,2,0)
BIN^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.31,9002313.31902,2,3)
Answer must be 1-10 characters in length.
"^DD",9002313.31,9002313.31902,2,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,2,21,1,0)
Enter the BIN number for the payer.
"^DD",9002313.31,9002313.31902,2,"DT")
3031028
"^DD",9002313.31,9002313.31902,3,0)
PCN^F^^1;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.31,9002313.31902,3,3)
Answer must be 1-10 characters in length.
"^DD",9002313.31,9002313.31902,3,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,3,21,1,0)
Enter the PCN for this payer.
"^DD",9002313.31,9002313.31902,3,"DT")
3031028
"^DD",9002313.31,9002313.31902,4,0)
GROUP ID^F^^1;3^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.31,9002313.31902,4,3)
Answer must be 1-15 characters in length.
"^DD",9002313.31,9002313.31902,4,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,4,21,1,0)
Enter the insurance group number for the patient.
"^DD",9002313.31,9002313.31902,4,"DT")
3031028
"^DD",9002313.31,9002313.31902,5,0)
CARDHOLDER ID^F^^1;4^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.31,9002313.31902,5,3)
Answer must be 1-20 characters in length.
"^DD",9002313.31,9002313.31902,5,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,5,21,1,0)
Enter the patient's Cardholder ID.
"^DD",9002313.31,9002313.31902,5,"DT")
3031028
"^DD",9002313.31,9002313.31902,6,0)
PATIENT RELATIONSHIP CODE^F^^1;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.31,9002313.31902,6,3)
Answer must be 1 character in length.
"^DD",9002313.31,9002313.31902,6,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,6,21,1,0)
Enter the patient relationship code.  1=veteran, 2=spouse, 3=child
"^DD",9002313.31,9002313.31902,6,"DT")
3031028
"^DD",9002313.31,9002313.31902,7,0)
CARDHOLDER FIRST NAME^F^^1;6^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.31,9002313.31902,7,3)
Answer must be 1-12 characters in length.
"^DD",9002313.31,9002313.31902,7,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,7,21,1,0)
Enter the cardholder's first name.
"^DD",9002313.31,9002313.31902,7,"DT")
3031028
"^DD",9002313.31,9002313.31902,8,0)
CARDHOLDER LAST NAME^F^^1;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.31,9002313.31902,8,3)
Answer must be 1-15 characters in length.
"^DD",9002313.31,9002313.31902,8,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,8,21,1,0)
Enter the cardholder's last name.
"^DD",9002313.31,9002313.31902,8,"DT")
3031028
"^DD",9002313.31,9002313.31902,9,0)
HOME PLAN STATE^F^^1;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.31,9002313.31902,9,3)
Answer must be 1-2 characters in length.
"^DD",9002313.31,9002313.31902,9,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,9,21,1,0)
Enter the home state of the insurance plan.
"^DD",9002313.31,9002313.31902,9,"DT")
3031028
"^DD",9002313.31,9002313.31902,11,0)
USUAL & CUSTOMARY CHARGE^F^^2;3^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.31,9002313.31902,11,3)
Answer must be 1-8 characters in length.
"^DD",9002313.31,9002313.31902,11,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,11,21,1,0)
Enter the dollar amount charged.
"^DD",9002313.31,9002313.31902,11,"DT")
3031028
"^DD",9002313.31,9002313.31902,12,0)
DISPENSING FEE SUBMITTED^F^^2;1^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.31,9002313.31902,12,3)
Answer must be 1-8 characters in length.
"^DD",9002313.31,9002313.31902,12,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,12,21,1,0)
Enter the amount for the dispensing fee.
"^DD",9002313.31,9002313.31902,12,"DT")
3031028
"^DD",9002313.31,9002313.31902,13,0)
BASIS OF COST DETERMINATION^F^^2;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.31,9002313.31902,13,3)
Answer must be 1-2 characters in length.
"^DD",9002313.31,9002313.31902,13,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,13,21,1,0)
Enter the basis of cost determination.  01=AWP, 07=Usual & Customary.
"^DD",9002313.31,9002313.31902,13,"DT")
3031028
"^DD",9002313.31,9002313.31902,14,0)
GROSS AMOUNT DUE^F^^2;4^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.31,9002313.31902,14,3)
Answer must be 1-8 characters in length.
"^DD",9002313.31,9002313.31902,14,21,0)
^^2^2^3031028^
"^DD",9002313.31,9002313.31902,14,21,1,0)
Enter gross amount due which contains the sum of the dispensing fee, 
"^DD",9002313.31,9002313.31902,14,21,2,0)
administrative fee, and Usual & Customary charge.
"^DD",9002313.31,9002313.31902,14,"DT")
3031028
"^DD",9002313.31,9002313.31902,15,0)
ADMINISTRATIVE FEE^F^^2;5^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.31,9002313.31902,15,3)
Answer must be 1-8 characters in length.
"^DD",9002313.31,9002313.31902,15,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,15,21,1,0)
Enter the amount of the administrative fee.  Default is zero dollars.
"^DD",9002313.31,9002313.31902,15,"DT")
3031028
"^DD",9002313.31,9002313.31902,16,0)
VA FILL NUMBER^F^^2;6^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.31,9002313.31902,16,3)
Answer must be 1-3 characters in length.
"^DD",9002313.31,9002313.31902,16,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,16,21,1,0)
Enter the fill number from test packet.
"^DD",9002313.31,9002313.31902,16,"DT")
3031028
"^DD",9002313.31,9002313.31902,17,0)
SOFTWARE VENDOR CERT/ID^F^^2;7^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.31,9002313.31902,17,3)
Answer must be 1-30 characters in length.
"^DD",9002313.31,9002313.31902,17,21,0)
^^1^1^3031028^
"^DD",9002313.31,9002313.31902,17,21,1,0)
Enter the certification ID supplied by the payer.
"^DD",9002313.31,9002313.31902,17,"DT")
3031028
"^DD",9002313.4,9002313.4,0)
FIELD^^2128.99^36
"^DD",9002313.4,9002313.4,0,"DDA")
N
"^DD",9002313.4,9002313.4,0,"DT")
3040112
"^DD",9002313.4,9002313.4,0,"IX","ADialOut",9002313.4,100.07)

"^DD",9002313.4,9002313.4,0,"IX","AFormat",9002313.4,100.01)

"^DD",9002313.4,9002313.4,0,"IX","APricing",9002313.4,100.06)

"^DD",9002313.4,9002313.4,0,"IX","B",9002313.4,.01)

"^DD",9002313.4,9002313.4,0,"NM","BPS INSURER")

"^DD",9002313.4,9002313.4,0,"PT",9002313.02,.02)

"^DD",9002313.4,9002313.4,0,"PT",9002313.522,.03)

"^DD",9002313.4,9002313.4,0,"PT",9002313.57,701)

"^DD",9002313.4,9002313.4,0,"PT",9002313.57,702)

"^DD",9002313.4,9002313.4,0,"PT",9002313.57,703)

"^DD",9002313.4,9002313.4,0,"PT",9002313.57,803)

"^DD",9002313.4,9002313.4,0,"PT",9002313.59,701)

"^DD",9002313.4,9002313.4,0,"PT",9002313.59,702)

"^DD",9002313.4,9002313.4,0,"PT",9002313.59,703)

"^DD",9002313.4,9002313.4,0,"PT",9002313.59,803)

"^DD",9002313.4,9002313.4,0,"VRPK")
BPS
"^DD",9002313.4,9002313.4,.01,0)
NAME^RP9999999.18'X^AUTNINS(^0;1^SET DINUM=X
"^DD",9002313.4,9002313.4,.01,1,0)
^.1
"^DD",9002313.4,9002313.4,.01,1,1,0)
9002313.4^B
"^DD",9002313.4,9002313.4,.01,1,1,1)
S ^BPSEI("B",$E(X,1,30),DA)=""
"^DD",9002313.4,9002313.4,.01,1,1,2)
K ^BPSEI("B",$E(X,1,30),DA)
"^DD",9002313.4,9002313.4,.01,3)

"^DD",9002313.4,9002313.4,.01,21,0)
^.001^1^1^3040126^^^^
"^DD",9002313.4,9002313.4,.01,21,1,0)
Insurance company Name.
"^DD",9002313.4,9002313.4,.01,"DT")
2931117
"^DD",9002313.4,9002313.4,100.01,0)
RX - NCPDP Record Format^*P9002313.92'^BPSF(9002313.92,^100;1^S DIC("S")="I DUZ(0)[""@""!(($P(^(1),U,6)=1!($P(^(1),U,6)=3))&($P(^(1),U,7)'=1))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9002313.4,9002313.4,100.01,1,0)
^.1
"^DD",9002313.4,9002313.4,100.01,1,1,0)
9002313.4^AFormat
"^DD",9002313.4,9002313.4,100.01,1,1,1)
S ^BPSEI("AFormat",$E(X,1,30),DA)=""
"^DD",9002313.4,9002313.4,100.01,1,1,2)
K ^BPSEI("AFormat",$E(X,1,30),DA)
"^DD",9002313.4,9002313.4,100.01,1,1,"DT")
3000815
"^DD",9002313.4,9002313.4,100.01,12)
Programmer may select any.  Others must select a format that's in either Production or Field Testing.
"^DD",9002313.4,9002313.4,100.01,12.1)
S DIC("S")="I DUZ(0)[""@""!(($P(^(1),U,6)=1!($P(^(1),U,6)=3))&($P(^(1),U,7)'=1))"
"^DD",9002313.4,9002313.4,100.01,21,0)
^^1^1^3040116^
"^DD",9002313.4,9002313.4,100.01,21,1,0)
The payer sheet associated with this payer.
"^DD",9002313.4,9002313.4,100.01,"DT")
3010117
"^DD",9002313.4,9002313.4,100.02,0)
RX - Dispensing Fee^NJ5,2^^100;2^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99.99)!(X<0) X
"^DD",9002313.4,9002313.4,100.02,3)
Type a Dollar Amount between 0 and 99.99, 2 Decimal Digits
"^DD",9002313.4,9002313.4,100.02,21,0)
^^1^1^3040116^
"^DD",9002313.4,9002313.4,100.02,21,1,0)
Dispensing fee (not used within VA)
"^DD",9002313.4,9002313.4,100.02,"DT")
2950503
"^DD",9002313.4,9002313.4,100.03,0)
RX - Activation Date^D^^100;3^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.4,9002313.4,100.03,21,0)
^^1^1^3040116^
"^DD",9002313.4,9002313.4,100.03,21,1,0)
The date the insurer became active and able to receive claims.
"^DD",9002313.4,9002313.4,100.03,"DT")
2950724
"^DD",9002313.4,9002313.4,100.04,0)
RX - # Days Backbill^NJ3,0^^100;4^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.4,9002313.4,100.04,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.4,9002313.4,100.04,21,0)
^^1^1^3040116^
"^DD",9002313.4,9002313.4,100.04,21,1,0)
Number of days allowed for resubmission of claims.
"^DD",9002313.4,9002313.4,100.04,"DT")
2950724
"^DD",9002313.4,9002313.4,100.05,0)
RX - Help Telephone #^F^^100;5^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.4,9002313.4,100.05,3)
Answer must be 1-20 characters in length.
"^DD",9002313.4,9002313.4,100.05,21,0)
^^1^1^3040116^
"^DD",9002313.4,9002313.4,100.05,21,1,0)
Help desk telephone number for this insurer.
"^DD",9002313.4,9002313.4,100.05,"DT")
2950724
"^DD",9002313.4,9002313.4,100.06,0)
RX - PRICING METHOD^P9002313.53'^BPS(9002313.53,^100;6^Q
"^DD",9002313.4,9002313.4,100.06,1,0)
^.1
"^DD",9002313.4,9002313.4,100.06,1,1,0)
9002313.4^APricing
"^DD",9002313.4,9002313.4,100.06,1,1,1)
S ^BPSEI("APricing",$E(X,1,30),DA)=""
"^DD",9002313.4,9002313.4,100.06,1,1,2)
K ^BPSEI("APricing",$E(X,1,30),DA)
"^DD",9002313.4,9002313.4,100.06,1,1,"%D",0)
^^1^1^3000728^
"^DD",9002313.4,9002313.4,100.06,1,1,"%D",1,0)
used by file 9002313.53 field .99
"^DD",9002313.4,9002313.4,100.06,1,1,"DT")
3000728
"^DD",9002313.4,9002313.4,100.06,21,0)
^^1^1^3040116^
"^DD",9002313.4,9002313.4,100.06,21,1,0)
Pricing method for use with this insurer.
"^DD",9002313.4,9002313.4,100.06,"DT")
3000728
"^DD",9002313.4,9002313.4,100.07,0)
RX - DIAL OUT TO^F^^100;7^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.4,9002313.4,100.07,1,0)
^.1
"^DD",9002313.4,9002313.4,100.07,1,1,0)
9002313.4^ADialOut
"^DD",9002313.4,9002313.4,100.07,1,1,1)
S ^BPSEI("ADialOut",$E(X,1,30),DA)=""
"^DD",9002313.4,9002313.4,100.07,1,1,2)
K ^BPSEI("ADialOut",$E(X,1,30),DA)
"^DD",9002313.4,9002313.4,100.07,1,1,"%D",0)
^^1^1^3000728^
"^DD",9002313.4,9002313.4,100.07,1,1,"%D",1,0)
used by file 9002313.55 computed field .99
"^DD",9002313.4,9002313.4,100.07,1,1,"DT")
3000728
"^DD",9002313.4,9002313.4,100.07,3)
Answer must be 1-5 characters in length.
"^DD",9002313.4,9002313.4,100.07,21,0)
^^3^3^3040331^
"^DD",9002313.4,9002313.4,100.07,21,1,0)
This is a pointer for IHS but we made it free text for VA.
"^DD",9002313.4,9002313.4,100.07,21,2,0)
The VA doesn't use it, it is included only so that the original
"^DD",9002313.4,9002313.4,100.07,21,3,0)
IHS fields will be in place when we share the package with them.
"^DD",9002313.4,9002313.4,100.07,"DT")
3040331
"^DD",9002313.4,9002313.4,100.08,0)
GRACE PERIOD^NJ5,0^^100;8^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.4,9002313.4,100.08,3)
Type a Number between 0 and 99999, 0 Decimal Digits
"^DD",9002313.4,9002313.4,100.08,21,0)
^^2^2^3000321^
"^DD",9002313.4,9002313.4,100.08,21,1,0)
# of days beyond expiration - used by BPSOS25 - see 9002313.99 field 951
"^DD",9002313.4,9002313.4,100.08,21,2,0)
for more details about how this works
"^DD",9002313.4,9002313.4,100.08,"DT")
3001002
"^DD",9002313.4,9002313.4,100.09,0)
NCPDP FORM - PRINT DRUG NAME^S^1:YES;0:NO;^100;9^Q
"^DD",9002313.4,9002313.4,100.09,21,0)
^^3^3^3000525^
"^DD",9002313.4,9002313.4,100.09,21,1,0)
Some insurance companies are asking that the drug name be printed.
"^DD",9002313.4,9002313.4,100.09,21,2,0)
We'll squeeze it onto the NCPDP form somehow. 
"^DD",9002313.4,9002313.4,100.09,21,3,0)
Set this flag for any such company.
"^DD",9002313.4,9002313.4,100.09,"DT")
3000525
"^DD",9002313.4,9002313.4,100.11,0)
NCPDP FORM - PRINT DIAGNOSIS^S^1:YES;0:NO;^100;11^Q
"^DD",9002313.4,9002313.4,100.11,21,0)
^^1^1^3000525^
"^DD",9002313.4,9002313.4,100.11,21,1,0)
Like NCPDP FORM - PRINT DRUG NAME
"^DD",9002313.4,9002313.4,100.11,"DT")
3000525
"^DD",9002313.4,9002313.4,100.12,0)
NCPDP FORM - PHARM # TO USE^S^0:NABP #;1:TAX ID #;2:SPECIAL #;^100;12^Q
"^DD",9002313.4,9002313.4,100.12,21,0)
^^1^1^3040120^
"^DD",9002313.4,9002313.4,100.12,21,1,0)
The Pharmacy identification # that is required by the insurer.
"^DD",9002313.4,9002313.4,100.12,"DT")
3000727
"^DD",9002313.4,9002313.4,100.13,0)
NCPDP FORM - PRINT TAX ID #^S^1:YES;0:NO;^100;13^Q
"^DD",9002313.4,9002313.4,100.13,21,0)
^^3^3^3040331^
"^DD",9002313.4,9002313.4,100.13,21,1,0)
Refers to printing the tax id # above the pharmacy #.
"^DD",9002313.4,9002313.4,100.13,21,2,0)
Do not confuse with PHARM # TO USE and the tax id # there - this refers
"^DD",9002313.4,9002313.4,100.13,21,3,0)
to printing the tax id # in lieu of the pharmacy #.
"^DD",9002313.4,9002313.4,100.13,"DT")
3040331
"^DD",9002313.4,9002313.4,100.97,0)
RX - DIAL OUT TO, RESOLVED^CJ30^^ ; ^S X=$P($G(^BPSEI(D0,100)),U,7) S:X="" X=$P($G(^BPS(9002313.99,1,"DIAL-OUT DEFAULT")),U) S:X X=$P($G(^BPS(9002313.55,X,0)),U)
"^DD",9002313.4,9002313.4,100.97,9)
^
"^DD",9002313.4,9002313.4,100.97,9.01)

"^DD",9002313.4,9002313.4,100.97,9.1)
S X=$P($G(^BPSEI(D0,100)),U,7) S:X="" X=$P($G(^BPS(9002313.99,1,"DIAL-OUT DEFAULT")),U) S:X X=$P($G(^BPS(9002313.55,X,0)),U)
"^DD",9002313.4,9002313.4,100.97,21,0)
^^1^1^3040120^
"^DD",9002313.4,9002313.4,100.97,21,1,0)
Not used by VA.
"^DD",9002313.4,9002313.4,100.99,0)
NCPDP FORM - ANY SET^CJ8,0^^ ; ^S X=$P($G(^BPSEI(D0,100)),U,9,13)'?."^"
"^DD",9002313.4,9002313.4,100.99,9)
^
"^DD",9002313.4,9002313.4,100.99,9.01)

"^DD",9002313.4,9002313.4,100.99,9.1)
S X=$P($G(^BPSEI(D0,100)),U,9,13)'?."^"
"^DD",9002313.4,9002313.4,100.99,21,0)
^^2^2^3040120^
"^DD",9002313.4,9002313.4,100.99,21,1,0)
The NCPDP format to be used for the particular insurer.
"^DD",9002313.4,9002313.4,100.99,21,2,0)
used by IHS for 3.x claims.  Not used by VA
"^DD",9002313.4,9002313.4,101.01,0)
RX SLEEPING UNTIL^D^^101;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.4,9002313.4,101.01,21,0)
^^5^5^3000621^
"^DD",9002313.4,9002313.4,101.01,21,1,0)
Fields 101.* are used in the case of a response with rejection
"^DD",9002313.4,9002313.4,101.01,21,2,0)
because of host not available, host not responding, etc. - that is,
"^DD",9002313.4,9002313.4,101.01,21,3,0)
when the insurer's system is purposefully not processing claims,
"^DD",9002313.4,9002313.4,101.01,21,4,0)
like when Alaska Medicaid shuts down overnight.   We reschedule the claims
"^DD",9002313.4,9002313.4,101.01,21,5,0)
for later retry.
"^DD",9002313.4,9002313.4,101.01,"DT")
3000621
"^DD",9002313.4,9002313.4,101.02,0)
RX SLEEP WAIT BASE^NJ5,0^^101;2^K:+X'=X!(X>86400)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.4,9002313.4,101.02,3)
Type a Number between 1 and 86400, 0 Decimal Digits
"^DD",9002313.4,9002313.4,101.02,21,0)
^^2^2^3000621^
"^DD",9002313.4,9002313.4,101.02,21,1,0)
Number of seconds to wait after the first time we discover the
"^DD",9002313.4,9002313.4,101.02,21,2,0)
insurer is asleep.
"^DD",9002313.4,9002313.4,101.02,"DT")
3000621
"^DD",9002313.4,9002313.4,101.03,0)
RX SLEEP WAIT MULT^NJ6,3^^101;3^K:+X'=X!(X>10)!(X<1)!(X?.E1"."4N.N) X
"^DD",9002313.4,9002313.4,101.03,3)
Type a Number between 1 and 10, 3 Decimal Digits
"^DD",9002313.4,9002313.4,101.03,21,0)
^^2^2^3000621^
"^DD",9002313.4,9002313.4,101.03,21,1,0)
Each time the retry discovers the insurer is still asleep, 
"^DD",9002313.4,9002313.4,101.03,21,2,0)
multiple the wait time by this much for the next wait.
"^DD",9002313.4,9002313.4,101.03,"DT")
3000621
"^DD",9002313.4,9002313.4,101.04,0)
RX SLEEP WAIT MAX^NJ5,0^^101;4^K:+X'=X!(X>86400)!(X<300)!(X?.E1"."1N.N) X
"^DD",9002313.4,9002313.4,101.04,3)
Type a Number between 300 and 86400, 0 Decimal Digits
"^DD",9002313.4,9002313.4,101.04,21,0)
^^1^1^3000621^
"^DD",9002313.4,9002313.4,101.04,21,1,0)
Maximum number of seconds to allow the rx sleep wait interval (101.05) to grow to.
"^DD",9002313.4,9002313.4,101.04,"DT")
3000621
"^DD",9002313.4,9002313.4,101.05,0)
RX SLEEP WAIT CURR^NJ5,0^^101;5^K:+X'=X!(X>86400)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.4,9002313.4,101.05,3)
Type a Number between 1 and 86400, 0 Decimal Digits
"^DD",9002313.4,9002313.4,101.05,21,0)
^^1^1^3000621^
"^DD",9002313.4,9002313.4,101.05,21,1,0)
Current value of the sleep wait timer.  (Expected expiry time is in 101.01)
"^DD",9002313.4,9002313.4,101.05,"DT")
3000621
"^DD",9002313.4,9002313.4,101.06,0)
RX SLEEP PROBER^P9002313.59'^BPST(^101;6^Q
"^DD",9002313.4,9002313.4,101.06,21,0)
^.001^8^8^3030729^^
"^DD",9002313.4,9002313.4,101.06,21,1,0)
BPSOSQ2 - when insurer is asleep, only one claim at a time is allowed
"^DD",9002313.4,9002313.4,101.06,21,2,0)
to probe whether the insurer has awakened.  This is that claim.
"^DD",9002313.4,9002313.4,101.06,21,3,0)
All others have to stay in status 31 until the insurer is known to
"^DD",9002313.4,9002313.4,101.06,21,4,0)
be awakened.
"^DD",9002313.4,9002313.4,101.06,21,5,0)
This is done to
"^DD",9002313.4,9002313.4,101.06,21,6,0)
* avoid sending lots of redundant, rejected claims during the sleep time
"^DD",9002313.4,9002313.4,101.06,21,7,0)
* avoid constructing wasteful 9002313.02 entries (and .03 responses)
"^DD",9002313.4,9002313.4,101.06,21,8,0)
  for repetitive rejections
"^DD",9002313.4,9002313.4,101.06,"DT")
3000914
"^DD",9002313.4,9002313.4,102.01,0)
RX POSTAGE ALLOWED^S^1:YES;0:NO;^102;1^Q
"^DD",9002313.4,9002313.4,102.01,21,0)
^^1^1^3000621^
"^DD",9002313.4,9002313.4,102.01,21,1,0)
Does this insurer accept postage charges via POS claims?
"^DD",9002313.4,9002313.4,102.01,"DT")
3000621
"^DD",9002313.4,9002313.4,102.02,0)
RX POSTAGE POS LIMIT^NJ6,2^^102;2^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>100)!(X<0) X
"^DD",9002313.4,9002313.4,102.02,3)
Type a Dollar Amount between 0 and 100, 2 Decimal Digits
"^DD",9002313.4,9002313.4,102.02,21,0)
^^1^1^3000621^
"^DD",9002313.4,9002313.4,102.02,21,1,0)
Alaska Medicaid, for example, only allows POS postage claims for up to $15.
"^DD",9002313.4,9002313.4,102.02,"DT")
3000621
"^DD",9002313.4,9002313.4,102.03,0)
RX SUPPLIES POSTAGE ALLOWED^S^0:NO;1:YES;^102;3^Q
"^DD",9002313.4,9002313.4,102.03,21,0)
^^2^2^3000621^
"^DD",9002313.4,9002313.4,102.03,21,1,0)
The insurer might accept POS claims for postage for prescriptions,
"^DD",9002313.4,9002313.4,102.03,21,2,0)
but are POS claims for postage for supplies allowed?
"^DD",9002313.4,9002313.4,102.03,"DT")
3000621
"^DD",9002313.4,9002313.4,103.01,0)
RX SUPPLIES ALLOWED^S^1:YES;0:NO;^103;1^Q
"^DD",9002313.4,9002313.4,103.01,21,0)
^^2^2^3000621^
"^DD",9002313.4,9002313.4,103.01,21,1,0)
Does the insurer accept POS claims for supply items (as opposed to
"^DD",9002313.4,9002313.4,103.01,21,2,0)
prescription drugs?)
"^DD",9002313.4,9002313.4,103.01,"DT")
3000621
"^DD",9002313.4,9002313.4,104.01,0)
RX PRIORITY^NJ7,2^^104;1^K:+X'=X!(X>1000)!(X<-1000)!(X?.E1"."3N.N) X
"^DD",9002313.4,9002313.4,104.01,3)
Type a Number between -1000 and 1000, 2 Decimal Digits
"^DD",9002313.4,9002313.4,104.01,21,0)
^^8^8^3000920^^
"^DD",9002313.4,9002313.4,104.01,21,1,0)
When there are multiple private insurances and the insurance selection
"^DD",9002313.4,9002313.4,104.01,21,2,0)
program is trying to choose among them, and none of the standard rules
"^DD",9002313.4,9002313.4,104.01,21,3,0)
produce any distinction, the program will choose the most recently added
"^DD",9002313.4,9002313.4,104.01,21,4,0)
insurance from the patient's record as the first one.
"^DD",9002313.4,9002313.4,104.01,21,5,0)
     BUT... if you want to give special preference to a particular
"^DD",9002313.4,9002313.4,104.01,21,6,0)
insurer, such as a specific pharmacy insurance, use this setting.
"^DD",9002313.4,9002313.4,104.01,21,7,0)
The higher number will have higher priority in order to break the tie.
"^DD",9002313.4,9002313.4,104.01,21,8,0)
For example, you might set PAID PRESCRIPTIONS to 8.
"^DD",9002313.4,9002313.4,104.01,"DT")
3000920
"^DD",9002313.4,9002313.4,105.01,0)
PREBILL - WHICH FORM^S^60.13:NCPDP;60:UB92;60.2:1500;^105;1^Q
"^DD",9002313.4,9002313.4,105.01,3)

"^DD",9002313.4,9002313.4,105.01,21,0)
^^4^4^3000725^^
"^DD",9002313.4,9002313.4,105.01,21,1,0)
If this insurer's pharmacy bills should be printed on a different form
"^DD",9002313.4,9002313.4,105.01,21,2,0)
from the system-wide default, then put the billing items field number of
"^DD",9002313.4,9002313.4,105.01,21,3,0)
the appropriate pre-bill list here.  Example: 60.2 for a 1500,
"^DD",9002313.4,9002313.4,105.01,21,4,0)
 60 for a UB92, 60.13 for an NCPDP form.
"^DD",9002313.4,9002313.4,105.01,"DT")
3000725
"^DD",9002313.4,9002313.4,105.02,0)
PREBILL - FORM FOR ROLLOVERS^S^60.13:NCPDP;60:UB92;60.2:1500;^105;2^Q
"^DD",9002313.4,9002313.4,105.02,3)

"^DD",9002313.4,9002313.4,105.02,21,0)
^^3^3^3000724^
"^DD",9002313.4,9002313.4,105.02,21,1,0)
Rollovers are different - if you are rolling over a claim after
"^DD",9002313.4,9002313.4,105.02,21,2,0)
a partial payment (or denial?) from a previous insurer, maybe it goes
"^DD",9002313.4,9002313.4,105.02,21,3,0)
on a different form?  
"^DD",9002313.4,9002313.4,105.02,"DT")
3000725
"^DD",9002313.4,9002313.4,105.99,0)
PREBILL - ANY SET^CJ8,0^^ ; ^S X=$G(^BPSEI(D0,105))'?."^"
"^DD",9002313.4,9002313.4,105.99,9)
^
"^DD",9002313.4,9002313.4,105.99,9.01)

"^DD",9002313.4,9002313.4,105.99,9.1)
S X=$G(^BPSEI(D0,105))'?."^"
"^DD",9002313.4,9002313.4,105.99,21,0)
^^1^1^3040120^
"^DD",9002313.4,9002313.4,105.99,21,1,0)
Flag indicating whether or not this insurer requires precertification.
"^DD",9002313.4,9002313.4,107.01,0)
WORKERS COMP INSURANCE^S^ONLY:USE ONLY FOR WORKERS COMP;BOTH:BOTH WORKERS COMP AND NON-WC;NEVER:NEVER USE FOR WORKERS COMP;^107;1^Q
"^DD",9002313.4,9002313.4,107.01,21,0)
^^3^3^3000818^
"^DD",9002313.4,9002313.4,107.01,21,1,0)
Insurance handling may vary depending on whether this is a workers comp-
"^DD",9002313.4,9002313.4,107.01,21,2,0)
covered visit.  This field tells you whether the insurance should be 
"^DD",9002313.4,9002313.4,107.01,21,3,0)
used only for workers comp, never for workers comp, or both cases.
"^DD",9002313.4,9002313.4,107.01,"DT")
3000818
"^DD",9002313.4,9002313.4,228.11,0)
BILLABLE NDC #^9002313.41^^BILLABLE NDC #;0
"^DD",9002313.4,9002313.4,228.12,0)
BILLABLE DRUG NAME^9002313.44^^BILLABLE DRUG NAME;0
"^DD",9002313.4,9002313.4,228.12,21,0)
^^2^2^3040331^
"^DD",9002313.4,9002313.4,228.12,21,1,0)
The drug description - this field is word processing to accomodate 
"^DD",9002313.4,9002313.4,228.12,21,2,0)
compounds which would consist of multiple drugs.
"^DD",9002313.4,9002313.4,2128.11,0)
UNBILLABLE NDC #^9002313.43^^UNBILLABLE NDC #;0
"^DD",9002313.4,9002313.4,2128.11,21,0)
^^1^1^3040120^
"^DD",9002313.4,9002313.4,2128.11,21,1,0)
List of unbillable NDC's for this particular insurer.
"^DD",9002313.4,9002313.4,2128.12,0)
UNBILLABLE DRUG NAME^9002313.45^^UNBILLABLE DRUG NAME;0
"^DD",9002313.4,9002313.4,2128.12,21,0)
^^2^2^3040331^
"^DD",9002313.4,9002313.4,2128.12,21,1,0)
Drug name for unbillable items.  This field is also word processing to 
"^DD",9002313.4,9002313.4,2128.12,21,2,0)
accomadate compounds.
"^DD",9002313.4,9002313.4,2128.13,0)
UNBILLABLE OTC^S^1:OTC DRUGS ARE UNBILLABLE;0:OTC DRUGS ARE BILLABLE;^UNBILLABLE OTC;1^Q
"^DD",9002313.4,9002313.4,2128.13,21,0)
^^2^2^3001007^
"^DD",9002313.4,9002313.4,2128.13,21,1,0)
This field can be used to override the system-wide setting for 
"^DD",9002313.4,9002313.4,2128.13,21,2,0)
whether OTC drugs are billable.  
"^DD",9002313.4,9002313.4,2128.13,"DT")
3001007
"^DD",9002313.4,9002313.4,2128.99,0)
ANY UN/BILLABLES SET^CJ8^^ ; ^S X=$$ANYSET^BPSOSQQ(D0)
"^DD",9002313.4,9002313.4,2128.99,9)
^
"^DD",9002313.4,9002313.4,2128.99,9.01)

"^DD",9002313.4,9002313.4,2128.99,9.1)
S X=$$ANYSET^BPSOSQQ(D0)
"^DD",9002313.4,9002313.4,2128.99,21,0)
^^2^2^3040120^
"^DD",9002313.4,9002313.4,2128.99,21,1,0)
Flag used for quick reference to determine if any of the unbillable fields
"^DD",9002313.4,9002313.4,2128.99,21,2,0)
are set.
"^DD",9002313.4,9002313.4,2128.99,"DT")
3001110
"^DD",9002313.4,9002313.41,0)
BILLABLE NDC # SUB-FIELD^^.01^1
"^DD",9002313.4,9002313.41,0,"DT")
3000914
"^DD",9002313.4,9002313.41,0,"IX","B",9002313.41,.01)

"^DD",9002313.4,9002313.41,0,"NM","BILLABLE NDC #")

"^DD",9002313.4,9002313.41,0,"UP")
9002313.4
"^DD",9002313.4,9002313.41,.01,0)
BILLABLE NDC #^MF^^0;1^K:$L(X)>11!($L(X)<11)!'(X?11N) X
"^DD",9002313.4,9002313.41,.01,1,0)
^.1
"^DD",9002313.4,9002313.41,.01,1,1,0)
9002313.41^B
"^DD",9002313.4,9002313.41,.01,1,1,1)
S ^BPSEI(DA(1),"BILLABLE NDC #","B",$E(X,1,30),DA)=""
"^DD",9002313.4,9002313.41,.01,1,1,2)
K ^BPSEI(DA(1),"BILLABLE NDC #","B",$E(X,1,30),DA)
"^DD",9002313.4,9002313.41,.01,3)
Answer must be 11 characters in length.
"^DD",9002313.4,9002313.41,.01,21,0)
^^3^3^3000914^
"^DD",9002313.4,9002313.41,.01,21,1,0)
9002313.99 has a list of unbillable NDC #s.  But if this insurer happens
"^DD",9002313.4,9002313.41,.01,21,2,0)
to allow billing for such a number, enter it here.   It will override the
"^DD",9002313.4,9002313.41,.01,21,3,0)
9002313.99 value.
"^DD",9002313.4,9002313.41,.01,"DT")
3000914
"^DD",9002313.4,9002313.43,0)
UNBILLABLE NDC # SUB-FIELD^^.01^1
"^DD",9002313.4,9002313.43,0,"DT")
3000914
"^DD",9002313.4,9002313.43,0,"IX","B",9002313.43,.01)

"^DD",9002313.4,9002313.43,0,"NM","UNBILLABLE NDC #")

"^DD",9002313.4,9002313.43,0,"UP")
9002313.4
"^DD",9002313.4,9002313.43,.01,0)
UNBILLABLE NDC #^MF^^0;1^K:$L(X)>11!($L(X)<11)!'(X?11N) X
"^DD",9002313.4,9002313.43,.01,1,0)
^.1
"^DD",9002313.4,9002313.43,.01,1,1,0)
9002313.43^B
"^DD",9002313.4,9002313.43,.01,1,1,1)
S ^BPSEI(DA(1),"UNBILLABLE NDC #","B",$E(X,1,30),DA)=""
"^DD",9002313.4,9002313.43,.01,1,1,2)
K ^BPSEI(DA(1),"UNBILLABLE NDC #","B",$E(X,1,30),DA)
"^DD",9002313.4,9002313.43,.01,3)
Answer must be 11 characters in length.
"^DD",9002313.4,9002313.43,.01,21,0)
^^3^3^3000914^
"^DD",9002313.4,9002313.43,.01,21,1,0)
NDC # unbillable for this specific company.
"^DD",9002313.4,9002313.43,.01,21,2,0)
If NDC # unbillable for all companies, it goes in the 9002313.99 version
"^DD",9002313.4,9002313.43,.01,21,3,0)
of this field.
"^DD",9002313.4,9002313.43,.01,"DT")
3000914
"^DD",9002313.4,9002313.44,0)
BILLABLE DRUG NAME SUB-FIELD^^.01^1
"^DD",9002313.4,9002313.44,0,"DT")
3000914
"^DD",9002313.4,9002313.44,0,"NM","BILLABLE DRUG NAME")

"^DD",9002313.4,9002313.44,0,"UP")
9002313.4
"^DD",9002313.4,9002313.44,.01,0)
BILLABLE DRUG NAME^WL^^0;1^Q
"^DD",9002313.4,9002313.44,.01,21,0)
^^5^5^3000914^
"^DD",9002313.4,9002313.44,.01,21,1,0)
SET $T TRUE  if the drug name X is billable for this company.
"^DD",9002313.4,9002313.44,.01,21,2,0)
$T false does not necessarily mean unbillable.
"^DD",9002313.4,9002313.44,.01,21,3,0)
A series of XECUTEs; it stops when it gets a TRUE result.
"^DD",9002313.4,9002313.44,.01,21,4,0)
Future:  X(1) = drug name from ___ (what other source?)
"^DD",9002313.4,9002313.44,.01,21,5,0)
X(2)=...
"^DD",9002313.4,9002313.44,.01,"DT")
3000914
"^DD",9002313.4,9002313.45,0)
UNBILLABLE DRUG NAME SUB-FIELD^^.01^1
"^DD",9002313.4,9002313.45,0,"DT")
3000914
"^DD",9002313.4,9002313.45,0,"NM","UNBILLABLE DRUG NAME")

"^DD",9002313.4,9002313.45,0,"UP")
9002313.4
"^DD",9002313.4,9002313.45,.01,0)
UNBILLABLE DRUG NAME^WL^^0;1^Q
"^DD",9002313.4,9002313.45,.01,21,0)
^^3^3^3000914^
"^DD",9002313.4,9002313.45,.01,21,1,0)
See BILLABLE DRUG NAME.
"^DD",9002313.4,9002313.45,.01,21,2,0)
If $T=1, the drug is judged to be unbillable for this company and
"^DD",9002313.4,9002313.45,.01,21,3,0)
the XECUTEs stop.
"^DD",9002313.4,9002313.45,.01,"DT")
3000914
"^DD",9002313.51,9002313.51,0)
FIELD^^100.01^13
"^DD",9002313.51,9002313.51,0,"DT")
3050714
"^DD",9002313.51,9002313.51,0,"IX","AD",9002313.522,.02)

"^DD",9002313.51,9002313.51,0,"IX","B",9002313.51,.01)

"^DD",9002313.51,9002313.51,0,"NM","BPS DATA INPUT")

"^DD",9002313.51,9002313.51,0,"VRPK")
BPS
"^DD",9002313.51,9002313.51,.01,0)
START TIME^RD^^0;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.51,9002313.51,.01,1,0)
^.1
"^DD",9002313.51,9002313.51,.01,1,1,0)
9002313.51^B
"^DD",9002313.51,9002313.51,.01,1,1,1)
S ^BPS(9002313.51,"B",$E(X,1,30),DA)=""
"^DD",9002313.51,9002313.51,.01,1,1,2)
K ^BPS(9002313.51,"B",$E(X,1,30),DA)
"^DD",9002313.51,9002313.51,.01,3)

"^DD",9002313.51,9002313.51,.01,21,0)
^^1^1^3000529^
"^DD",9002313.51,9002313.51,.01,21,1,0)
Date/time record was created.
"^DD",9002313.51,9002313.51,.01,"DT")
3000529
"^DD",9002313.51,9002313.51,.02,0)
USER^P200'^VA(200,^0;2^Q
"^DD",9002313.51,9002313.51,.02,21,0)
^^1^1^3040120^
"^DD",9002313.51,9002313.51,.02,21,1,0)
DUZ of the user who created this input.
"^DD",9002313.51,9002313.51,.02,"DT")
3000529
"^DD",9002313.51,9002313.51,.03,0)
ORIGIN^P9002313.516'^BPS(9002313.516,^0;3^Q
"^DD",9002313.51,9002313.51,.03,21,0)
^^1^1^3040120^
"^DD",9002313.51,9002313.51,.03,21,1,0)
Point of origin - clinic where the order was originally entered.
"^DD",9002313.51,9002313.51,.03,"DT")
3001117
"^DD",9002313.51,9002313.51,1.01,0)
ASK INSURANCE^S^0:NO;1:YES;^1;1^Q
"^DD",9002313.51,9002313.51,1.01,"DT")
3000529
"^DD",9002313.51,9002313.51,1.02,0)
ASK PREAUTH NUMBER^S^0:NO;1:YES;^1;2^Q
"^DD",9002313.51,9002313.51,1.02,"DT")
3000529
"^DD",9002313.51,9002313.51,1.03,0)
ASK PRICING^S^0:NO;1:YES;^1;3^Q
"^DD",9002313.51,9002313.51,1.03,"DT")
3000529
"^DD",9002313.51,9002313.51,1.04,0)
ASK FILL DATE^S^0:NO;1:YES;^1;4^Q
"^DD",9002313.51,9002313.51,1.04,"DT")
3000529
"^DD",9002313.51,9002313.51,1.05,0)
ASK NCPDP OVERRIDES^S^1:YES;0:NO;^1;5^Q
"^DD",9002313.51,9002313.51,1.05,"DT")
3001120
"^DD",9002313.51,9002313.51,2,0)
LINE ITEMS^9002313.512A^^2;0
"^DD",9002313.51,9002313.51,2,21,0)
^.001^2^2^3050719^^^^
"^DD",9002313.51,9002313.51,2,21,1,0)
Line Item information for claims that have been submitted
"^DD",9002313.51,9002313.51,2,21,2,0)
to ECME and are waiting to be processed.
"^DD",9002313.51,9002313.51,2,"DT")
3050719
"^DD",9002313.51,9002313.51,3.01,0)
RX ACTION^F^^3;1^K:$L(X)>4!($L(X)<1) X
"^DD",9002313.51,9002313.51,3.01,3)
Answer must be 1-4 characters in length
"^DD",9002313.51,9002313.51,3.01,21,0)
^^3^3^3050629^
"^DD",9002313.51,9002313.51,3.01,21,1,0)
This is the BWHERE parameter passed into BPSNCPDP and is the action 
"^DD",9002313.51,9002313.51,3.01,21,2,0)
that is being performed on this RX (AREV, BB, CRLB, CRLR, CRLX, DC, DDED, 
"^DD",9002313.51,9002313.51,3.01,21,3,0)
DE, ED, ERES, EREV, OF, PC, PE, PL, PP, RF, RL, RN, RRL, and RS).
"^DD",9002313.51,9002313.51,3.01,"DT")
3050629
"^DD",9002313.51,9002313.51,3.02,0)
DATE OF SERVICE^D^^3;2^S %DT="E" D ^%DT S X=Y K:X<1 X
"^DD",9002313.51,9002313.51,3.02,3)
(No range limit on date)
"^DD",9002313.51,9002313.51,3.02,21,0)
^^1^1^3050525^
"^DD",9002313.51,9002313.51,3.02,21,1,0)
Date used in the 401-D1 (DATE OF SERVICE) field in the NCPDP transaction
"^DD",9002313.51,9002313.51,3.02,"DT")
3050525
"^DD",9002313.51,9002313.51,4,0)
DUR^9002313.514^^4;0
"^DD",9002313.51,9002313.51,4,21,0)
^^3^3^3050628^
"^DD",9002313.51,9002313.51,4,21,1,0)
This multiple will track the Drug Utilization Review (DUR) information
"^DD",9002313.51,9002313.51,4,21,2,0)
passed by Outpatient Pharmacy to ECME and that will eventually be put
"^DD",9002313.51,9002313.51,4,21,3,0)
in the DUR segment of the NCPDP claim.
"^DD",9002313.51,9002313.51,4,"DT")
3050614
"^DD",9002313.51,9002313.51,100.01,0)
DEFAULT NDC #^S^0:NO;1:YES;^100;1^Q
"^DD",9002313.51,9002313.51,100.01,"DT")
3000602
"^DD",9002313.51,9002313.512,0)
LINE ITEMS SUB-FIELD^^100^57
"^DD",9002313.51,9002313.512,0,"DT")
3050714
"^DD",9002313.51,9002313.512,0,"IX","B",9002313.512,.01)

"^DD",9002313.51,9002313.512,0,"NM","LINE ITEMS")

"^DD",9002313.51,9002313.512,0,"UP")
9002313.51
"^DD",9002313.51,9002313.512,.01,0)
LINE NUMBER^MNJ6,0^^0;1^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.51,9002313.512,.01,1,0)
^.1
"^DD",9002313.51,9002313.512,.01,1,1,0)
9002313.512^B
"^DD",9002313.51,9002313.512,.01,1,1,1)
S ^BPS(9002313.51,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",9002313.51,9002313.512,.01,1,1,2)
K ^BPS(9002313.51,DA(1),2,"B",$E(X,1,30),DA)
"^DD",9002313.51,9002313.512,.01,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",9002313.51,9002313.512,.01,21,0)
^^5^5^3040331^
"^DD",9002313.51,9002313.512,.01,21,1,0)
Not edited by user, normally.   
"^DD",9002313.51,9002313.512,.01,21,2,0)
We assign a bunch of these early.
"^DD",9002313.51,9002313.512,.01,21,3,0)
We probably will allow LAYGO on the form.
"^DD",9002313.51,9002313.512,.01,21,4,0)
Could be by-user parameter as to how many of these get initialized.
"^DD",9002313.51,9002313.512,.01,21,5,0)
Until then, BPSOSI hardcodes it as 9.
"^DD",9002313.51,9002313.512,.01,"DT")
3040331
"^DD",9002313.51,9002313.512,.02,0)
RX DISP^F^^0;2^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.51,9002313.512,.02,3)
Answer must be 1-20 characters in length.
"^DD",9002313.51,9002313.512,.02,21,0)
^.001^1^1^3031204^^
"^DD",9002313.51,9002313.512,.02,21,1,0)
Prescription number that is being submitted to ECME.
"^DD",9002313.51,9002313.512,.02,"DT")
3000529
"^DD",9002313.51,9002313.512,.03,0)
NDC DISP^F^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.51,9002313.512,.03,3)
Answer must be 1-20 characters in length.
"^DD",9002313.51,9002313.512,.03,21,0)
^^1^1^3031204^
"^DD",9002313.51,9002313.512,.03,21,1,0)
The NDC number that will be sent on the Claim.
"^DD",9002313.51,9002313.512,.03,"DT")
3000529
"^DD",9002313.51,9002313.512,.04,0)
PAT DISP^F^^0;4^K:$L(X)>31!($L(X)<1) X
"^DD",9002313.51,9002313.512,.04,3)
Answer must be 1-31 characters in length.
"^DD",9002313.51,9002313.512,.04,21,0)
^^1^1^3031204^
"^DD",9002313.51,9002313.512,.04,21,1,0)
Patient IEN for the claim.
"^DD",9002313.51,9002313.512,.04,"DT")
3000529
"^DD",9002313.51,9002313.512,.05,0)
DRUG DISP^F^^0;5^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.51,9002313.512,.05,3)
Answer must be 1-40 characters in length.
"^DD",9002313.51,9002313.512,.05,21,0)
^^1^1^3031204^
"^DD",9002313.51,9002313.512,.05,21,1,0)
Drug description that is going to be billed.
"^DD",9002313.51,9002313.512,.05,"DT")
3000623
"^DD",9002313.51,9002313.512,.06,0)
DATE DISP^F^^0;6^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.51,9002313.512,.06,3)
Enter the date when the prescription was filled or type FIND.
"^DD",9002313.51,9002313.512,.06,21,0)
^.001^2^2^3031204^^
"^DD",9002313.51,9002313.512,.06,21,1,0)
Enter the date when the prescription was filled.
"^DD",9002313.51,9002313.512,.06,21,2,0)
Type FIND to get help with finding the exact date.
"^DD",9002313.51,9002313.512,.06,"DT")
3000529
"^DD",9002313.51,9002313.512,1.01,0)
RXI^P52'^PSRX(^1;1^Q
"^DD",9002313.51,9002313.512,1.01,21,0)
^^1^1^3031204^
"^DD",9002313.51,9002313.512,1.01,21,1,0)
IEN of the prescription.
"^DD",9002313.51,9002313.512,1.01,"DT")
3000529
"^DD",9002313.51,9002313.512,1.02,0)
RXR^NJ3,0^^1;2^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.51,9002313.512,1.02,3)
Type a Number between 0 and 999, 0 Decimal Digits
"^DD",9002313.51,9002313.512,1.02,21,0)
^^1^1^3031204^
"^DD",9002313.51,9002313.512,1.02,21,1,0)
The fill number that this claim refers to.
"^DD",9002313.51,9002313.512,1.02,"DT")
3000531
"^DD",9002313.51,9002313.512,1.03,0)
DRUG^P50'^PSDRUG(^1;3^Q
"^DD",9002313.51,9002313.512,1.03,21,0)
^^1^1^3031204^
"^DD",9002313.51,9002313.512,1.03,21,1,0)
The IEN to the Drug file.
"^DD",9002313.51,9002313.512,1.03,"DT")
3000529
"^DD",9002313.51,9002313.512,1.04,0)
PATIENT^P2'^DPT(^1;4^Q
"^DD",9002313.51,9002313.512,1.04,21,0)
^^1^1^3040120^
"^DD",9002313.51,9002313.512,1.04,21,1,0)
Patient the order was for.
"^DD",9002313.51,9002313.512,1.04,"DT")
3000529
"^DD",9002313.51,9002313.512,1.05,0)
AWP MED^NJ6,0^^1;5^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.51,9002313.512,1.05,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",9002313.51,9002313.512,1.05,21,0)
^^2^2^3000529^
"^DD",9002313.51,9002313.512,1.05,21,1,0)
Pointer to AWP-MED TRANSACTION file. We don't explicitly say it this
"^DD",9002313.51,9002313.512,1.05,21,2,0)
way  because not every site has that file.
"^DD",9002313.51,9002313.512,1.05,"DT")
3000529
"^DD",9002313.51,9002313.512,1.06,0)
VISIT^P9000010'^AUPNVSIT(^1;6^Q
"^DD",9002313.51,9002313.512,1.06,"DT")
3000529
"^DD",9002313.51,9002313.512,1.07,0)
IEN .59^F^^1;7^K:$L(X)>16!($L(X)<1) X
"^DD",9002313.51,9002313.512,1.07,3)
Answer must be 1-16 characters in length.
"^DD",9002313.51,9002313.512,1.07,21,0)
^^3^3^3000529^
"^DD",9002313.51,9002313.512,1.07,21,1,0)
Pointer to 9002313.59, ABSB RX POS WORKING.
"^DD",9002313.51,9002313.512,1.07,21,2,0)
Just a place to figure out this value in advance; the entry it "points"
"^DD",9002313.51,9002313.512,1.07,21,3,0)
to isn't created until after the form is done, when PF1 E is pressed.
"^DD",9002313.51,9002313.512,1.07,"DT")
3000529
"^DD",9002313.51,9002313.512,1.09,0)
NCPDP OVERRIDE^P9002313.511^BPS(9002313.511,^1;9^Q
"^DD",9002313.51,9002313.512,1.09,21,0)
^^1^1^3031204^
"^DD",9002313.51,9002313.512,1.09,21,1,0)
Flag to indicate if over-riding the pre-authorization is allowed.
"^DD",9002313.51,9002313.512,1.09,"DT")
3001118
"^DD",9002313.51,9002313.512,2.01,0)
PREAUTHORIZATION NUMBER^F^^2;1^K:$L(X)>16!($L(X)<1) X
"^DD",9002313.51,9002313.512,2.01,3)
Answer must be 1-16 characters in length.
"^DD",9002313.51,9002313.512,2.01,21,0)
^^3^3^3031204^
"^DD",9002313.51,9002313.512,2.01,21,1,0)
Number indicating that the payer was contacted ahead
"^DD",9002313.51,9002313.512,2.01,21,2,0)
of time and authorized the charge.  This is the number
"^DD",9002313.51,9002313.512,2.01,21,3,0)
they give to use when submitting the claim.
"^DD",9002313.51,9002313.512,2.01,"DT")
3000529
"^DD",9002313.51,9002313.512,2.02,0)
Prior Authorization Type Code^S^0:Not Specified;1:Prior Authorization;2:Medical Certification;3:EPSDT;4:Exemption from Copay;5:Exemption from RX;6:Family Plan. Indic.;7:AFDC;8:Payer Defined Exemption;^2;2^Q
"^DD",9002313.51,9002313.512,2.02,21,0)
^^12^12^3031204^
"^DD",9002313.51,9002313.512,2.02,21,1,0)
Code indicating what type of prior authorization was performed.
"^DD",9002313.51,9002313.512,2.02,21,2,0)
 
"^DD",9002313.51,9002313.512,2.02,21,3,0)
 
"^DD",9002313.51,9002313.512,2.02,21,4,0)
=Not specified
"^DD",9002313.51,9002313.512,2.02,21,5,0)
1=Prior authorization
"^DD",9002313.51,9002313.512,2.02,21,6,0)
2=Medical certification
"^DD",9002313.51,9002313.512,2.02,21,7,0)
3=EPSDT
"^DD",9002313.51,9002313.512,2.02,21,8,0)
4=Exemption from co-pay
"^DD",9002313.51,9002313.512,2.02,21,9,0)
5=Exemption from prescription limits
"^DD",9002313.51,9002313.512,2.02,21,10,0)
6=Family planning indicator
"^DD",9002313.51,9002313.512,2.02,21,11,0)
7=AFDC
"^DD",9002313.51,9002313.512,2.02,21,12,0)
8=Payor defined exemption
"^DD",9002313.51,9002313.512,2.02,"DT")
3020829
"^DD",9002313.51,9002313.512,5.01,0)
QTY^NJ10,3^^5;1^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."4N.N) X
"^DD",9002313.51,9002313.512,5.01,3)
Type a Number between -999999 and 999999, 3 Decimal Digits
"^DD",9002313.51,9002313.512,5.01,21,0)
^^1^1^3031204^
"^DD",9002313.51,9002313.512,5.01,21,1,0)
Quantity dispensed.
"^DD",9002313.51,9002313.512,5.01,"DT")
3000529
"^DD",9002313.51,9002313.512,5.02,0)
UNIT PRICE^NJ13,6^^5;2^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."7N.N) X
"^DD",9002313.51,9002313.512,5.02,3)
Type a Number between 0 and 999999, 6 Decimal Digits
"^DD",9002313.51,9002313.512,5.02,21,0)
^^1^1^3040120^
"^DD",9002313.51,9002313.512,5.02,21,1,0)
Unit price of the drug.
"^DD",9002313.51,9002313.512,5.02,"DT")
3000529
"^DD",9002313.51,9002313.512,5.03,0)
INGR COST^NJ13,6^^5;3^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."7N.N) X
"^DD",9002313.51,9002313.512,5.03,3)
Type a Number between -999999 and 999999, 6 Decimal Digits
"^DD",9002313.51,9002313.512,5.03,21,0)
^^1^1^3040120^
"^DD",9002313.51,9002313.512,5.03,21,1,0)
Ingredient cost for this prescription.
"^DD",9002313.51,9002313.512,5.03,"DT")
3000529
"^DD",9002313.51,9002313.512,5.04,0)
DISP FEE^NJ5,2^^5;4^K:+X'=X!(X>99)!(X<-99)!(X?.E1"."3N.N) X
"^DD",9002313.51,9002313.512,5.04,3)
Type a Number between -99 and 99, 2 Decimal Digits
"^DD",9002313.51,9002313.512,5.04,21,0)
^^1^1^3040120^
"^DD",9002313.51,9002313.512,5.04,21,1,0)
Dispensing fee for the prescription.
"^DD",9002313.51,9002313.512,5.04,"DT")
3000529
"^DD",9002313.51,9002313.512,5.05,0)
TOTAL PRICE^NJ13,6^^5;5^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."7N.N) X
"^DD",9002313.51,9002313.512,5.05,3)
Type a Number between -999999 and 999999, 6 Decimal Digits
"^DD",9002313.51,9002313.512,5.05,21,0)
^^2^2^3040120^
"^DD",9002313.51,9002313.512,5.05,21,1,0)
The total price of the prescription including dispensing fee, ingredient 
"^DD",9002313.51,9002313.512,5.05,21,2,0)
costs and taxes (if any).
"^DD",9002313.51,9002313.512,5.05,"DT")
3000529
"^DD",9002313.51,9002313.512,5.06,0)
PRICE SOURCE^S^APSAMDF:AWP MED-TRANSACTION FILE;PSDRUG-AWPPDU:AWPPDU IN DRUG FILE;PSDRUG-PPDU:PPDU IN DRUG FILE;ABSCPT:ILC A/R CHARGE FILE;NOT FOUND:NOT FOUND;PSRX-AWP:AWP IN PRESC FILE;PSRX-UNIT:UNIT PRICE IN PRESC FILE;^5;6^Q
"^DD",9002313.51,9002313.512,5.06,21,0)
^^3^3^3001110^^
"^DD",9002313.51,9002313.512,5.06,21,1,0)
UNITPRI1^BPSOSQP tells you the source of the unit price
"^DD",9002313.51,9002313.512,5.06,21,2,0)
Display it in page 7 pricing data.
"^DD",9002313.51,9002313.512,5.06,21,3,0)
Reassuring to know - Helps catch glaring errors, too.
"^DD",9002313.51,9002313.512,5.06,"DT")
3001208
"^DD",9002313.51,9002313.512,6.01,0)
PINS 1^F^^6;1^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.51,9002313.512,6.01,3)
Answer must be 1-20 characters in length.
"^DD",9002313.51,9002313.512,6.01,21,0)
^^2^2^3031208^
"^DD",9002313.51,9002313.512,6.01,21,1,0)
Insurance ranking field 1 - This is the one to bill first.
"^DD",9002313.51,9002313.512,6.01,21,2,0)
once this one pays, secondary and tertiary insurances can be billed.
"^DD",9002313.51,9002313.512,6.01,"DT")
3000531
"^DD",9002313.51,9002313.512,6.02,0)
PINS 2^F^^6;2^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.51,9002313.512,6.02,3)
Answer must be 1-20 characters in length.
"^DD",9002313.51,9002313.512,6.02,21,0)
^^2^2^3031208^
"^DD",9002313.51,9002313.512,6.02,21,1,0)
Insurance ranking field 2 - This is the secondary insurance company
"^DD",9002313.51,9002313.512,6.02,21,2,0)
to bill.
"^DD",9002313.51,9002313.512,6.02,"DT")
3000531
"^DD",9002313.51,9002313.512,6.03,0)
PINS 3^F^^6;3^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.51,9002313.512,6.03,3)
Answer must be 1-20 characters in length.
"^DD",9002313.51,9002313.512,6.03,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,6.03,21,1,0)
Insurance ranking field 3 - the third company to bill.
"^DD",9002313.51,9002313.512,6.03,"DT")
3000531
"^DD",9002313.51,9002313.512,7.01,0)
INSURER 1^F^^7;1^K:$L(X)>35!($L(X)<1) X
"^DD",9002313.51,9002313.512,7.01,3)
Answer must be 1-35 characters in length.
"^DD",9002313.51,9002313.512,7.01,21,0)
^.001^1^1^3040115^^^
"^DD",9002313.51,9002313.512,7.01,21,1,0)
Text name of the primary insurance company.
"^DD",9002313.51,9002313.512,7.01,"DT")
3040112
"^DD",9002313.51,9002313.512,7.02,0)
INSURER 2^F^^7;2^K:$L(X)>35!($L(X)<1) X
"^DD",9002313.51,9002313.512,7.02,3)
Answer must be 1-35 characters in length.
"^DD",9002313.51,9002313.512,7.02,21,0)
^.001^1^1^3040112^^
"^DD",9002313.51,9002313.512,7.02,21,1,0)
Text name of the secondary insurance company.
"^DD",9002313.51,9002313.512,7.02,"DT")
3040112
"^DD",9002313.51,9002313.512,7.03,0)
INSURER 3^F^^7;3^K:$L(X)>35!($L(X)<1) X
"^DD",9002313.51,9002313.512,7.03,3)
Answer must be 1-35 characters in length.
"^DD",9002313.51,9002313.512,7.03,21,0)
^.001^1^1^3040112^^
"^DD",9002313.51,9002313.512,7.03,21,1,0)
Text name of the third insurance company.
"^DD",9002313.51,9002313.512,7.03,"DT")
3040112
"^DD",9002313.51,9002313.512,8.01,0)
VA INSURANCE PLAN IEN^P355.3'^IBA(355.3,^8;1^Q
"^DD",9002313.51,9002313.512,8.01,3)
This is the Group Insurance IEN
"^DD",9002313.51,9002313.512,8.01,21,0)
^.001^1^1^3050714^^^
"^DD",9002313.51,9002313.512,8.01,21,1,0)
Plan IEN for the Insurance company within VA.
"^DD",9002313.51,9002313.512,8.01,"DT")
3050714
"^DD",9002313.51,9002313.512,8.02,0)
VA BIN^F^^8;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.51,9002313.512,8.02,3)
Answer must be 1-10 characters in length.
"^DD",9002313.51,9002313.512,8.02,21,0)
^^3^3^3031208^
"^DD",9002313.51,9002313.512,8.02,21,1,0)
BIN number within VA - the BIN number is a number assigned to each 
"^DD",9002313.51,9002313.512,8.02,21,2,0)
pharmacy for inclusion in claims, which identifies which pharmacy 
"^DD",9002313.51,9002313.512,8.02,21,3,0)
submitted the claim.
"^DD",9002313.51,9002313.512,8.02,"DT")
3030623
"^DD",9002313.51,9002313.512,8.03,0)
VA PCN^F^^8;3^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.51,9002313.512,8.03,3)
Answer must be 1-10 characters in length.
"^DD",9002313.51,9002313.512,8.03,21,0)
^^2^2^3031208^
"^DD",9002313.51,9002313.512,8.03,21,1,0)
Processor control number. This number indicates which clearinghouse is to 
"^DD",9002313.51,9002313.512,8.03,21,2,0)
adjudicate the claim.
"^DD",9002313.51,9002313.512,8.03,"DT")
3030623
"^DD",9002313.51,9002313.512,8.04,0)
VA PAYER SHEET B1^F^^8;4^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.51,9002313.512,8.04,3)
Answer must be 1-30 characters in length.
"^DD",9002313.51,9002313.512,8.04,21,0)
^.001^2^2^3031208^^
"^DD",9002313.51,9002313.512,8.04,21,1,0)
Payer sheet IEN - indicator for which payer sheet was used in the
"^DD",9002313.51,9002313.512,8.04,21,2,0)
claim submission.
"^DD",9002313.51,9002313.512,8.04,"DT")
3031112
"^DD",9002313.51,9002313.512,8.05,0)
VA GROUP ID^F^^8;5^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.51,9002313.512,8.05,3)
Answer must be 1-15 characters in length.
"^DD",9002313.51,9002313.512,8.05,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,8.05,21,1,0)
The group ID number for the transaction.
"^DD",9002313.51,9002313.512,8.05,"DT")
3030623
"^DD",9002313.51,9002313.512,8.06,0)
VA CARDHOLDER ID^F^^8;6^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.51,9002313.512,8.06,3)
Answer must be 1-20 characters in length.
"^DD",9002313.51,9002313.512,8.06,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,8.06,21,1,0)
The ID for the person who is insured under this plan.
"^DD",9002313.51,9002313.512,8.06,"DT")
3030623
"^DD",9002313.51,9002313.512,8.07,0)
VA PATIENT RELATIONSHIP CODE^F^^8;7^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.51,9002313.512,8.07,3)
Answer must be 1 character in length.
"^DD",9002313.51,9002313.512,8.07,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,8.07,21,1,0)
Relationship of the patient to the person who is covered.
"^DD",9002313.51,9002313.512,8.07,"DT")
3030623
"^DD",9002313.51,9002313.512,8.08,0)
VA CARDHOLDER FIRST NAME^F^^8;8^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.51,9002313.512,8.08,3)
Answer must be 1-12 characters in length.
"^DD",9002313.51,9002313.512,8.08,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,8.08,21,1,0)
First Name of the cardholder.
"^DD",9002313.51,9002313.512,8.08,"DT")
3030623
"^DD",9002313.51,9002313.512,8.09,0)
VA CARDHOLDER LAST NAME^F^^8;9^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.51,9002313.512,8.09,3)
Answer must be 1-15 characters in length.
"^DD",9002313.51,9002313.512,8.09,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,8.09,21,1,0)
Last name of the cardholder.
"^DD",9002313.51,9002313.512,8.09,"DT")
3030623
"^DD",9002313.51,9002313.512,8.11,0)
VA HOME PLAN STATE^F^^8;10^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.51,9002313.512,8.11,3)
Answer must be 1-3 characters in length.
"^DD",9002313.51,9002313.512,8.11,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,8.11,21,1,0)
State of residence of the cardholder.
"^DD",9002313.51,9002313.512,8.11,"DT")
3030623
"^DD",9002313.51,9002313.512,8.12,0)
VA PAYER SHEET B2^P9002313.92'^BPSF(9002313.92,^8;11^Q
"^DD",9002313.51,9002313.512,8.12,3)
Enter reversal payer sheet IEN.
"^DD",9002313.51,9002313.512,8.12,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,8.12,21,1,0)
Enter the Reversal Payer Sheet IEN.
"^DD",9002313.51,9002313.512,8.12,"DT")
3031112
"^DD",9002313.51,9002313.512,8.13,0)
VA PAYER SHEET B3^P9002313.92'^BPSF(9002313.92,^8;12^Q
"^DD",9002313.51,9002313.512,8.13,3)
Enter reversal payer sheet ien.
"^DD",9002313.51,9002313.512,8.13,21,0)
^.001^1^1^3031208^^
"^DD",9002313.51,9002313.512,8.13,21,1,0)
Enter Reversal Payer Sheet IEN.
"^DD",9002313.51,9002313.512,8.13,"DT")
3031112
"^DD",9002313.51,9002313.512,8.14,0)
VA INSURANCE PLAN NAME^F^^8;15^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.51,9002313.512,8.14,3)
Answer must be 1-40 characters in length.
"^DD",9002313.51,9002313.512,8.14,"DT")
3050614
"^DD",9002313.51,9002313.512,8.15,0)
CERTIFY MODE^S^0:CERTIFY MODE OFF;1:CERTIFY MODE ON;^8;14^Q
"^DD",9002313.51,9002313.512,8.15,3)
Null or 0 means not in certify mode and 1 means in certify mode.
"^DD",9002313.51,9002313.512,8.15,21,0)
^^1^1^3041014^
"^DD",9002313.51,9002313.512,8.15,21,1,0)
Null or 0 means not in certify mode and 1 means in certify mode.
"^DD",9002313.51,9002313.512,8.15,"DT")
3041014
"^DD",9002313.51,9002313.512,8.16,0)
CERT IEN^NJ11,0^^8;13^K:+X'=X!(X>99999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.51,9002313.512,8.16,3)
Type a Number between 1 and 99999999999, 0 Decimal Digits
"^DD",9002313.51,9002313.512,8.16,21,0)
^.001^2^2^3031208^^^
"^DD",9002313.51,9002313.512,8.16,21,1,0)
This field is used during certification testing to map the prescription 
"^DD",9002313.51,9002313.512,8.16,21,2,0)
to the certification entry in file 9002313.51.
"^DD",9002313.51,9002313.512,8.16,"DT")
3031113
"^DD",9002313.51,9002313.512,9.01,0)
VA DISPENSING FEE^F^^9;1^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.51,9002313.512,9.01,3)
Answer must be 1-8 characters in length.
"^DD",9002313.51,9002313.512,9.01,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,9.01,21,1,0)
Dispense fee charged for filling a prescription.
"^DD",9002313.51,9002313.512,9.01,"DT")
3030623
"^DD",9002313.51,9002313.512,9.02,0)
VA BASIS OF COST DETERMINATION^F^^9;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.51,9002313.512,9.02,3)
Answer must be 1-2 characters in length.
"^DD",9002313.51,9002313.512,9.02,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,9.02,21,1,0)
Basis of cost, or how the amount charged was calculated.
"^DD",9002313.51,9002313.512,9.02,"DT")
3030623
"^DD",9002313.51,9002313.512,9.03,0)
VA USUAL & CUSTOMARY^F^^9;3^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.51,9002313.512,9.03,3)
Answer must be 1-8 characters in length.
"^DD",9002313.51,9002313.512,9.03,21,0)
^^1^1^3040331^
"^DD",9002313.51,9002313.512,9.03,21,1,0)
Usual and cutomary amount charged for a prescription.
"^DD",9002313.51,9002313.512,9.03,"DT")
3040331
"^DD",9002313.51,9002313.512,9.04,0)
VA GROSS AMOUNT DUE^F^^9;4^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.51,9002313.512,9.04,3)
Answer must be 1-8 characters in length.
"^DD",9002313.51,9002313.512,9.04,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,9.04,21,1,0)
Total amount charged to the third party payer.
"^DD",9002313.51,9002313.512,9.04,"DT")
3030623
"^DD",9002313.51,9002313.512,9.05,0)
VA ADMINISTRATIVE FEE^F^^9;5^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.51,9002313.512,9.05,3)
Answer must be 1-8 characters in length.
"^DD",9002313.51,9002313.512,9.05,21,0)
^^1^1^3040331^
"^DD",9002313.51,9002313.512,9.05,21,1,0)
Administrative cost for filling the prescription.
"^DD",9002313.51,9002313.512,9.05,"DT")
3040331
"^DD",9002313.51,9002313.512,9.06,0)
DRUG QUANTITY^F^^9;6^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.51,9002313.512,9.06,3)
Answer must be 1-5 characters in length.
"^DD",9002313.51,9002313.512,9.06,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,9.06,21,1,0)
Quantity of the drug dispensed.
"^DD",9002313.51,9002313.512,9.06,"DT")
3030701
"^DD",9002313.51,9002313.512,9.07,0)
INGREDIENT COST^F^^9;7^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.51,9002313.512,9.07,3)
Answer must be 1-8 characters in length.
"^DD",9002313.51,9002313.512,9.07,21,0)
^^1^1^3040322^
"^DD",9002313.51,9002313.512,9.07,21,1,0)
How much VA paid for the ingredients of the prescription.
"^DD",9002313.51,9002313.512,9.07,"DT")
3030701
"^DD",9002313.51,9002313.512,9.08,0)
VA NDC^F^^9;8^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.51,9002313.512,9.08,3)
Answer must be 1-20 characters in length.
"^DD",9002313.51,9002313.512,9.08,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.512,9.08,21,1,0)
The NDC number of the drug.
"^DD",9002313.51,9002313.512,9.08,"DT")
3030701
"^DD",9002313.51,9002313.512,9.09,0)
VA FILL^F^^9;9^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.51,9002313.512,9.09,3)
Answer must be 1-3 characters in length.
"^DD",9002313.51,9002313.512,9.09,21,0)
^^2^2^3031208^
"^DD",9002313.51,9002313.512,9.09,21,1,0)
Indicates which fill/refill number this claim was for.
"^DD",9002313.51,9002313.512,9.09,21,2,0)
starts at 0 for the original fill.
"^DD",9002313.51,9002313.512,9.09,"DT")
3030701
"^DD",9002313.51,9002313.512,9.1,0)
SOFTWARE VENDOR/CERT ID^F^^9;10^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.51,9002313.512,9.1,3)
Answer must be 1-30 characters in length.
"^DD",9002313.51,9002313.512,9.1,21,0)
^^2^2^3040331^
"^DD",9002313.51,9002313.512,9.1,21,1,0)
Certiciation ID number to be included on the claim when
"^DD",9002313.51,9002313.512,9.1,21,2,0)
submitting to third party payers which require certification.
"^DD",9002313.51,9002313.512,9.1,"DT")
3040331
"^DD",9002313.51,9002313.512,10.01,0)
VA GROUP NAME^F^^10;1^K:$L(X)>20!($L(X)<2) X
"^DD",9002313.51,9002313.512,10.01,3)
Answer must be 2-20 characters in length
"^DD",9002313.51,9002313.512,10.01,21,0)
^^1^1^3050615^
"^DD",9002313.51,9002313.512,10.01,21,1,0)
This is the Group Name from the Group Insurance file
"^DD",9002313.51,9002313.512,10.01,"DT")
3050615
"^DD",9002313.51,9002313.512,10.02,0)
VA INSURANCE CO PHONE #^F^^10;2^K:$L(X)>20!($L(X)<7) X
"^DD",9002313.51,9002313.512,10.02,3)
Answer must be 7-20 characters in length
"^DD",9002313.51,9002313.512,10.02,21,0)
^^1^1^3050615^
"^DD",9002313.51,9002313.512,10.02,21,1,0)
This is the Claim (RX) Phone Number from the Insurance Company file
"^DD",9002313.51,9002313.512,10.02,"DT")
3050615
"^DD",9002313.51,9002313.512,10.03,0)
VA PHARMACY PLAN^F^^10;3^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.51,9002313.512,10.03,3)
Answer must be 1-30 characters in length
"^DD",9002313.51,9002313.512,10.03,21,0)
^^1^1^3050615^
"^DD",9002313.51,9002313.512,10.03,21,1,0)
This is a VA National Plan ID for the Plan
"^DD",9002313.51,9002313.512,10.03,"DT")
3050615
"^DD",9002313.51,9002313.512,100,0)
INS SEL SCRATCH^9002313.522A^^I;0
"^DD",9002313.51,9002313.514,0)
DUR SUB-FIELD^^3^4
"^DD",9002313.51,9002313.514,0,"DT")
3050614
"^DD",9002313.51,9002313.514,0,"IX","B",9002313.514,.01)

"^DD",9002313.51,9002313.514,0,"NM","DUR")

"^DD",9002313.51,9002313.514,0,"UP")
9002313.51
"^DD",9002313.51,9002313.514,.01,0)
DUR COUNTER^NJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.51,9002313.514,.01,1,0)
^.1
"^DD",9002313.51,9002313.514,.01,1,1,0)
9002313.514^B
"^DD",9002313.51,9002313.514,.01,1,1,1)
S ^BPS(9002313.51,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",9002313.51,9002313.514,.01,1,1,2)
K ^BPS(9002313.51,DA(1),4,"B",$E(X,1,30),DA)
"^DD",9002313.51,9002313.514,.01,3)
Enter the DUR counter for the claim
"^DD",9002313.51,9002313.514,.01,21,0)
^^1^1^3050614^
"^DD",9002313.51,9002313.514,.01,21,1,0)
Counter used in field 473-7E of the DUR segment of the claim
"^DD",9002313.51,9002313.514,.01,"DT")
3050614
"^DD",9002313.51,9002313.514,1,0)
DUR PROFESSIONAL SERVICE CODE^F^^0;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.51,9002313.514,1,3)
Enter the Professional Service Code for the claim
"^DD",9002313.51,9002313.514,1,"DT")
3050614
"^DD",9002313.51,9002313.514,2,0)
DUR REASON FOR SERVICE CODE^F^^0;3^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.51,9002313.514,2,3)
Enter the Reason for Service Code
"^DD",9002313.51,9002313.514,2,"DT")
3050614
"^DD",9002313.51,9002313.514,3,0)
DUR RESULT OF SERVICE CODE^F^^0;4^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.51,9002313.514,3,3)
Enter the Result of Service Code for the claim
"^DD",9002313.51,9002313.514,3,"DT")
3050614
"^DD",9002313.51,9002313.522,0)
INS SEL SCRATCH SUB-FIELD^^1.01^5
"^DD",9002313.51,9002313.522,0,"DT")
3040126
"^DD",9002313.51,9002313.522,0,"IX","B",9002313.522,.01)

"^DD",9002313.51,9002313.522,0,"NM","INS SEL SCRATCH")

"^DD",9002313.51,9002313.522,0,"UP")
9002313.512
"^DD",9002313.51,9002313.522,.01,0)
INS LINE^RNJ6,0^^0;1^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.51,9002313.522,.01,1,0)
^.1
"^DD",9002313.51,9002313.522,.01,1,1,0)
9002313.522^B
"^DD",9002313.51,9002313.522,.01,1,1,1)
S ^BPS(9002313.51,DA(2),2,DA(1),"I","B",$E(X,1,30),DA)=""
"^DD",9002313.51,9002313.522,.01,1,1,2)
K ^BPS(9002313.51,DA(2),2,DA(1),"I","B",$E(X,1,30),DA)
"^DD",9002313.51,9002313.522,.01,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",9002313.51,9002313.522,.01,21,0)
^.001^1^1^3031208^^^
"^DD",9002313.51,9002313.522,.01,21,1,0)
Corresponds to the subscript returned in the ARRAY(n) of ^BPSOS25
"^DD",9002313.51,9002313.522,.01,"DT")
3000601
"^DD",9002313.51,9002313.522,.02,0)
ORDER^S^1:1st;2:2nd;3:3rd;^0;2^Q
"^DD",9002313.51,9002313.522,.02,1,0)
^.1^^0
"^DD",9002313.51,9002313.522,.02,1,1,0)
9002313.51^AD
"^DD",9002313.51,9002313.522,.02,1,1,1)
S ^BPS(9002313.51,"AD",$E(X,1,30),DA(2),DA(1),DA)=""
"^DD",9002313.51,9002313.522,.02,1,1,2)
K ^BPS(9002313.51,"AD",$E(X,1,30),DA(2),DA(1),DA)
"^DD",9002313.51,9002313.522,.02,1,1,"%D",0)
^^2^2^3000531^
"^DD",9002313.51,9002313.522,.02,1,1,"%D",1,0)
Index by order of insurances.
"^DD",9002313.51,9002313.522,.02,1,1,"%D",2,0)
^BPS(9002313.51,DA(2),2,DA(1),"I","AD",order,DA)=""
"^DD",9002313.51,9002313.522,.02,1,1,"DT")
3000531
"^DD",9002313.51,9002313.522,.02,21,0)
^.001^1^1^3040331^^^
"^DD",9002313.51,9002313.522,.02,21,1,0)
The order of insurance: 1st for primary, etc.
"^DD",9002313.51,9002313.522,.02,"DT")
3040331
"^DD",9002313.51,9002313.522,.03,0)
INSURER^P9002313.4'^BPSEI(^0;3^Q
"^DD",9002313.51,9002313.522,.03,21,0)
^.001^1^1^3040126^^
"^DD",9002313.51,9002313.522,.03,21,1,0)
Name of the insurer for this item.
"^DD",9002313.51,9002313.522,.03,"DT")
3040126
"^DD",9002313.51,9002313.522,.04,0)
PINS^F^^0;4^K:$L(X)>20!($L(X)<4) X
"^DD",9002313.51,9002313.522,.04,3)
Answer must be 4-20 characters in length.
"^DD",9002313.51,9002313.522,.04,21,0)
^^1^1^3031208^
"^DD",9002313.51,9002313.522,.04,21,1,0)
The priority for this insurance in the rankings.
"^DD",9002313.51,9002313.522,.04,"DT")
3000601
"^DD",9002313.51,9002313.522,1.01,0)
DESCRIPTION^F^^1;1^K:$L(X)>200!($L(X)<1) X
"^DD",9002313.51,9002313.522,1.01,3)
Answer must be 1-200 characters in length.
"^DD",9002313.51,9002313.522,1.01,21,0)
^.001^2^2^3031208^^
"^DD",9002313.51,9002313.522,1.01,21,1,0)
Construct a description - ID #, expiration date, etc.
"^DD",9002313.51,9002313.522,1.01,21,2,0)
Could split into separate fields with new stuff
"^DD",9002313.51,9002313.522,1.01,"DT")
3000531
"^DD",9002313.511,9002313.511,0)
FIELD^^1^3
"^DD",9002313.511,9002313.511,0,"DT")
3001018
"^DD",9002313.511,9002313.511,0,"IX","B",9002313.511,.01)

"^DD",9002313.511,9002313.511,0,"NM","BPS NCPDP OVERRIDE")

"^DD",9002313.511,9002313.511,0,"PT",9002313.512,1.09)

"^DD",9002313.511,9002313.511,0,"PT",9002313.57,1.13)

"^DD",9002313.511,9002313.511,0,"PT",9002313.59,1.13)

"^DD",9002313.511,9002313.511,0,"VRPK")
BPS
"^DD",9002313.511,9002313.511,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.511,9002313.511,.01,1,0)
^.1
"^DD",9002313.511,9002313.511,.01,1,1,0)
9002313.511^B
"^DD",9002313.511,9002313.511,.01,1,1,1)
S ^BPS(9002313.511,"B",$E(X,1,30),DA)=""
"^DD",9002313.511,9002313.511,.01,1,1,2)
K ^BPS(9002313.511,"B",$E(X,1,30),DA)
"^DD",9002313.511,9002313.511,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",9002313.511,9002313.511,.01,21,0)
^.001^1^1^3040120^^
"^DD",9002313.511,9002313.511,.01,21,1,0)
Name of the override.  Must start with punctuation.
"^DD",9002313.511,9002313.511,.02,0)
CREATED ON^D^^0;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.511,9002313.511,.02,21,0)
^^1^1^3031208^
"^DD",9002313.511,9002313.511,.02,21,1,0)
Date the override was created.
"^DD",9002313.511,9002313.511,.02,"DT")
3001018
"^DD",9002313.511,9002313.511,1,0)
NCPDP FIELD^9002313.5111PA^^1;0
"^DD",9002313.511,9002313.511,1,21,0)
^.001^1^1^3040120^^^
"^DD",9002313.511,9002313.511,1,21,1,0)
Which NCPDP field this override is used for.
"^DD",9002313.511,9002313.5111,0)
NCPDP FIELD SUB-FIELD^^.02^2
"^DD",9002313.511,9002313.5111,0,"DT")
3001018
"^DD",9002313.511,9002313.5111,0,"IX","B",9002313.5111,.01)

"^DD",9002313.511,9002313.5111,0,"NM","NCPDP FIELD")

"^DD",9002313.511,9002313.5111,0,"UP")
9002313.511
"^DD",9002313.511,9002313.5111,.01,0)
NCPDP FIELD^MP9002313.91'^BPSF(9002313.91,^0;1^Q
"^DD",9002313.511,9002313.5111,.01,1,0)
^.1
"^DD",9002313.511,9002313.5111,.01,1,1,0)
9002313.5111^B
"^DD",9002313.511,9002313.5111,.01,1,1,1)
S ^BPS(9002313.511,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002313.511,9002313.5111,.01,1,1,2)
K ^BPS(9002313.511,DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002313.511,9002313.5111,.01,21,0)
^^1^1^3040120^
"^DD",9002313.511,9002313.5111,.01,21,1,0)
The NCPDP field number to be overridden.
"^DD",9002313.511,9002313.5111,.01,"DT")
3001018
"^DD",9002313.511,9002313.5111,.02,0)
VALUE^F^^0;2^K:$L(X)>200!($L(X)<1) X
"^DD",9002313.511,9002313.5111,.02,3)
Answer must be 1-200 characters in length.
"^DD",9002313.511,9002313.5111,.02,21,0)
^^2^2^3031208^
"^DD",9002313.511,9002313.5111,.02,21,1,0)
The value that should be inserted into this field instead of what would
"^DD",9002313.511,9002313.5111,.02,21,2,0)
normally be pulled from the data files.
"^DD",9002313.511,9002313.5111,.02,"DT")
3001018
"^DD",9002313.515,9002313.515,0)
FIELD^^100.01^8
"^DD",9002313.515,9002313.515,0,"DT")
3001025
"^DD",9002313.515,9002313.515,0,"IX","B",9002313.515,.01)

"^DD",9002313.515,9002313.515,0,"NM","BPS INPUT USER PREF")

"^DD",9002313.515,9002313.515,0,"VRPK")
BPS
"^DD",9002313.515,9002313.515,.01,0)
USER^RP200'^VA(200,^0;1^Q
"^DD",9002313.515,9002313.515,.01,1,0)
^.1
"^DD",9002313.515,9002313.515,.01,1,1,0)
9002313.515^B
"^DD",9002313.515,9002313.515,.01,1,1,1)
S ^BPS(9002313.515,"B",$E(X,1,30),DA)=""
"^DD",9002313.515,9002313.515,.01,1,1,2)
K ^BPS(9002313.515,"B",$E(X,1,30),DA)
"^DD",9002313.515,9002313.515,.01,3)

"^DD",9002313.515,9002313.515,.01,21,0)
^^1^1^3040126^
"^DD",9002313.515,9002313.515,.01,21,1,0)
The user whose preferences are being stored in this entry.
"^DD",9002313.515,9002313.515,.01,"DT")
3000602
"^DD",9002313.515,9002313.515,.02,0)
SAME SETTINGS AS^P200'^VA(200,^0;2^Q
"^DD",9002313.515,9002313.515,.02,21,0)
^^10^10^3000815^
"^DD",9002313.515,9002313.515,.02,21,1,0)
What settings are to be used for this user?
"^DD",9002313.515,9002313.515,.02,21,2,0)
1. First, we take settings from user `1 as system-wide defaults.
"^DD",9002313.515,9002313.515,.02,21,3,0)
2. If this field is defined, any of that user's settings take precedence
"^DD",9002313.515,9002313.515,.02,21,4,0)
    over the system-wide settings.
"^DD",9002313.515,9002313.515,.02,21,5,0)
3. Finally, specific settings in this user's record are applied.
"^DD",9002313.515,9002313.515,.02,21,6,0)
A typical use of this SAME SETTINGS AS field might be to identify 
"^DD",9002313.515,9002313.515,.02,21,7,0)
all pharmacy users with the head of the pharmacy, and all business office
"^DD",9002313.515,9002313.515,.02,21,8,0)
users with the head of the business office.  That would be an easy way
"^DD",9002313.515,9002313.515,.02,21,9,0)
to do something like, say, default ASK INSURANCE to YES for business office
"^DD",9002313.515,9002313.515,.02,21,10,0)
users and ASK INSURANCE to NO for pharmacy users.
"^DD",9002313.515,9002313.515,.02,"DT")
3000815
"^DD",9002313.515,9002313.515,.03,0)
OLD-STYLE INPUT^S^1:YES;0:NO;^0;3^Q
"^DD",9002313.515,9002313.515,.03,21,0)
^^6^6^3000815^
"^DD",9002313.515,9002313.515,.03,21,1,0)
Set this field to YES if you want to have the old-style input dialogue,
"^DD",9002313.515,9002313.515,.03,21,2,0)
the one that doesn't use Screenman, but is restricted to just straight
"^DD",9002313.515,9002313.515,.03,21,3,0)
prescription number and NDC number input.  In this case, only the
"^DD",9002313.515,9002313.515,.03,21,4,0)
DEFAULT NDC # field affects the old-style input.  You can jump out of the
"^DD",9002313.515,9002313.515,.03,21,5,0)
old-style input into the new-style Screenman by typing SCREENMAN at the
"^DD",9002313.515,9002313.515,.03,21,6,0)
very first prescription # prompt.
"^DD",9002313.515,9002313.515,.03,"DT")
3000815
"^DD",9002313.515,9002313.515,1.01,0)
ASK INSURANCE^S^0:NO;1:YES;^1;1^Q
"^DD",9002313.515,9002313.515,1.01,21,0)
^^2^2^3000602^
"^DD",9002313.515,9002313.515,1.01,21,1,0)
Same field names and storage locations as in file 9002313.51.
"^DD",9002313.515,9002313.515,1.01,21,2,0)
We can just copy the node when initialized a 9002313.51 entry.
"^DD",9002313.515,9002313.515,1.01,"DT")
3000602
"^DD",9002313.515,9002313.515,1.02,0)
ASK PREAUTH^S^0:NO;1:YES;^1;2^Q
"^DD",9002313.515,9002313.515,1.02,21,0)
^^2^2^3040428^
"^DD",9002313.515,9002313.515,1.02,21,1,0)
Flag to indicate whether the preauthorization question will be asked in 
"^DD",9002313.515,9002313.515,1.02,21,2,0)
the dialog.
"^DD",9002313.515,9002313.515,1.02,"DT")
3040428
"^DD",9002313.515,9002313.515,1.03,0)
ASK PRICING^S^0:NO;1:YES;^1;3^Q
"^DD",9002313.515,9002313.515,1.03,21,0)
^^2^2^3040428^
"^DD",9002313.515,9002313.515,1.03,21,1,0)
Flag which determines whether or not the prescription pricing question 
"^DD",9002313.515,9002313.515,1.03,21,2,0)
will be asked during the dialog.
"^DD",9002313.515,9002313.515,1.03,"DT")
3040428
"^DD",9002313.515,9002313.515,1.04,0)
ASK FILL DATE^S^0:NO;1:YES;^1;4^Q
"^DD",9002313.515,9002313.515,1.04,21,0)
^^2^2^3040428^
"^DD",9002313.515,9002313.515,1.04,21,1,0)
Flag to determine if we will ask the for a Fill Date during the 
"^DD",9002313.515,9002313.515,1.04,21,2,0)
Electronic Claims dialog.
"^DD",9002313.515,9002313.515,1.04,"DT")
3040428
"^DD",9002313.515,9002313.515,100.01,0)
DEFAULT NDC #^S^0:NO;1:YES;^100;1^Q
"^DD",9002313.515,9002313.515,100.01,21,0)
^^6^6^3000602^
"^DD",9002313.515,9002313.515,100.01,21,1,0)
There's an NDC number stored in the Prescription file
"^DD",9002313.515,9002313.515,100.01,21,2,0)
and it would make a handy default.  But some pharmacies do not want
"^DD",9002313.515,9002313.515,100.01,21,3,0)
this default to be presented - they want the techs to always, always, 
"^DD",9002313.515,9002313.515,100.01,21,4,0)
always scan the package from which the prescription is being filled.
"^DD",9002313.515,9002313.515,100.01,21,5,0)
However, certain others really do need a default - like programmers
"^DD",9002313.515,9002313.515,100.01,21,6,0)
doing testing.  And business office personnel doing price lookups.
"^DD",9002313.515,9002313.515,100.01,"DT")
3000602
"^DD",9002313.516,9002313.516,0)
FIELD^^1^2
"^DD",9002313.516,9002313.516,0,"DDA")
N
"^DD",9002313.516,9002313.516,0,"DT")
3001117
"^DD",9002313.516,9002313.516,0,"IX","B",9002313.516,.01)

"^DD",9002313.516,9002313.516,0,"NM","BPS ORIGIN OF INPUT")

"^DD",9002313.516,9002313.516,0,"PT",9002313.51,.03)

"^DD",9002313.516,9002313.516,0,"PT",9002313.57,.14)

"^DD",9002313.516,9002313.516,0,"PT",9002313.59,.14)

"^DD",9002313.516,9002313.516,0,"VRPK")
BPS
"^DD",9002313.516,9002313.516,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.516,9002313.516,.01,1,0)
^.1
"^DD",9002313.516,9002313.516,.01,1,1,0)
9002313.516^B
"^DD",9002313.516,9002313.516,.01,1,1,1)
S ^BPS(9002313.516,"B",$E(X,1,30),DA)=""
"^DD",9002313.516,9002313.516,.01,1,1,2)
K ^BPS(9002313.516,"B",$E(X,1,30),DA)
"^DD",9002313.516,9002313.516,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",9002313.516,9002313.516,.01,21,0)
^^1^1^3040120^
"^DD",9002313.516,9002313.516,.01,21,1,0)
Code name to be used to identify where the input came from.
"^DD",9002313.516,9002313.516,1,0)
DESCRIPTION^9002313.5161^^1;0
"^DD",9002313.516,9002313.5161,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",9002313.516,9002313.5161,0,"DT")
3001117
"^DD",9002313.516,9002313.5161,0,"NM","DESCRIPTION")

"^DD",9002313.516,9002313.5161,0,"UP")
9002313.516
"^DD",9002313.516,9002313.5161,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",9002313.516,9002313.5161,.01,"DT")
3001117
"^DD",9002313.53,9002313.53,0)
FIELD^^1^7
"^DD",9002313.53,9002313.53,0,"DDA")
N
"^DD",9002313.53,9002313.53,0,"DT")
3001027
"^DD",9002313.53,9002313.53,0,"IX","B",9002313.53,.01)

"^DD",9002313.53,9002313.53,0,"NM","BPS PRICING TABLES")

"^DD",9002313.53,9002313.53,0,"PT",9002313.4,100.06)

"^DD",9002313.53,9002313.53,0,"VRPK")
BPS
"^DD",9002313.53,9002313.53,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.53,9002313.53,.01,1,0)
^.1
"^DD",9002313.53,9002313.53,.01,1,1,0)
9002313.53^B
"^DD",9002313.53,9002313.53,.01,1,1,1)
S ^BPS(9002313.53,"B",$E(X,1,30),DA)=""
"^DD",9002313.53,9002313.53,.01,1,1,2)
K ^BPS(9002313.53,"B",$E(X,1,30),DA)
"^DD",9002313.53,9002313.53,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",9002313.53,9002313.53,.01,21,0)
^^1^1^3040120^
"^DD",9002313.53,9002313.53,.01,21,1,0)
Name for the Pricing table.
"^DD",9002313.53,9002313.53,.02,0)
UNIT PRICE SOURCE^RS^APSAMDF:AWP-MED TRANSACTION FILE;ABSCPT:CHARGE FILE;PSDRUG-PPDU:DRUG FILE PRICE PER DISPENSE UNIT;PSDRUG-AWPPDU:DRUG FILE AWP PER DISP UNIT;PSRX-UNIT:PRESCRIPTION FILE UNIT PRICE;PSRX-AWP:PRESCRIPTION FILE AWP;^0;2^Q
"^DD",9002313.53,9002313.53,.02,21,0)
^^6^6^3001110^^^^
"^DD",9002313.53,9002313.53,.02,21,1,0)
Various sources of drug prices - pick the primary one here.
"^DD",9002313.53,9002313.53,.02,21,2,0)
If the price should somehow be missing, others will be tried.
"^DD",9002313.53,9002313.53,.02,21,3,0)
Note that ABSCPT method presumes the DRGDFN already has a CPT code.
"^DD",9002313.53,9002313.53,.02,21,4,0)
(When creating ABSVCPT entry, an ABSCPT entry will be created if needed,
"^DD",9002313.53,9002313.53,.02,21,5,0)
regardless of pricing method.)  If no price is found anywhere, $1.001 is
"^DD",9002313.53,9002313.53,.02,21,6,0)
used arbitrarily (set by routine BPSOSQP).
"^DD",9002313.53,9002313.53,.02,"DT")
3001027
"^DD",9002313.53,9002313.53,.03,0)
FORMULA^RS^STEP:APPLY STEP FORMULA TO UNIT PRICE;LINEAR:LINEAR;^0;3^Q
"^DD",9002313.53,9002313.53,.03,21,0)
^^1^1^3040120^
"^DD",9002313.53,9002313.53,.03,21,1,0)
The actual formula to be used for pricing.  (Not used by VA)
"^DD",9002313.53,9002313.53,.03,"DT")
3001027
"^DD",9002313.53,9002313.53,.04,0)
MULTIPLIER^RNJ7,5^^0;4^K:+X'=X!(X>9)!(X<0)!(X?.E1"."6N.N) X
"^DD",9002313.53,9002313.53,.04,3)
Type a Number between 0 and 9, 5 Decimal Digits
"^DD",9002313.53,9002313.53,.04,21,0)
^^1^1^3000311^
"^DD",9002313.53,9002313.53,.04,21,1,0)
Defaults to 1.   For 95% for example, use .95
"^DD",9002313.53,9002313.53,.04,"DT")
3001027
"^DD",9002313.53,9002313.53,.05,0)
DISPENSING FEE^RNJ6,2^^0;5^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>100)!(X<0) X
"^DD",9002313.53,9002313.53,.05,3)
Type a Dollar Amount between 0 and 100, 2 Decimal Digits
"^DD",9002313.53,9002313.53,.05,21,0)
^^3^3^3040331^
"^DD",9002313.53,9002313.53,.05,21,1,0)
Specific dispensing fee for insurer in ^BPSEI takes priority over this.
"^DD",9002313.53,9002313.53,.05,21,2,0)
The ^ABSSETUP value could be used as a default if all else fails.
"^DD",9002313.53,9002313.53,.05,21,3,0)
See routine BPSOSQP
"^DD",9002313.53,9002313.53,.05,"DT")
3040331
"^DD",9002313.53,9002313.53,.99,0)
IN USE BY ANY INSURERS^CJ8^^ ; ^S X=$D(^BPSEI("APricing",D0))>0
"^DD",9002313.53,9002313.53,.99,9)
^
"^DD",9002313.53,9002313.53,.99,9.01)

"^DD",9002313.53,9002313.53,.99,9.1)
S X=$D(^BPSEI("APricing",D0))>0
"^DD",9002313.53,9002313.53,.99,21,0)
^^1^1^3040331^
"^DD",9002313.53,9002313.53,.99,21,1,0)
Flag indicating whether the formulary is currently being used.
"^DD",9002313.53,9002313.53,.99,"DT")
3040331
"^DD",9002313.53,9002313.53,1,0)
DESCRIPTION^9002313.531^^DESCRIPTION;0
"^DD",9002313.53,9002313.53,1,21,0)
^^1^1^3040331^
"^DD",9002313.53,9002313.53,1,21,1,0)
Description of the formula in English.
"^DD",9002313.53,9002313.531,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",9002313.53,9002313.531,0,"DT")
3001027
"^DD",9002313.53,9002313.531,0,"NM","DESCRIPTION")

"^DD",9002313.53,9002313.531,0,"UP")
9002313.53
"^DD",9002313.53,9002313.531,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",9002313.53,9002313.531,.01,"DT")
3040331
"^DD",9002313.55,9002313.55,0)
FIELD^^.01^1
"^DD",9002313.55,9002313.55,0,"DDA")
N
"^DD",9002313.55,9002313.55,0,"DT")
3060124
"^DD",9002313.55,9002313.55,0,"IX","B",9002313.55,.01)

"^DD",9002313.55,9002313.55,0,"NM","BPS DIALOUT")

"^DD",9002313.55,9002313.55,0,"PT",9002313.99,440.01)

"^DD",9002313.55,9002313.55,0,"VRPK")
BPS
"^DD",9002313.55,9002313.55,.01,0)
DIALOUT NAME^RF^^0;1^K:$L(X)>10!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.55,9002313.55,.01,1,0)
^.1
"^DD",9002313.55,9002313.55,.01,1,1,0)
9002313.55^B
"^DD",9002313.55,9002313.55,.01,1,1,1)
S ^BPS(9002313.55,"B",$E(X,1,30),DA)=""
"^DD",9002313.55,9002313.55,.01,1,1,2)
K ^BPS(9002313.55,"B",$E(X,1,30),DA)
"^DD",9002313.55,9002313.55,.01,3)
Enter the name of the dialout queue
"^DD",9002313.55,9002313.55,.01,21,0)
^^3^3^3060127^
"^DD",9002313.55,9002313.55,.01,21,1,0)
This is the name of the dialout queue.  For VA sites, the only name that
"^DD",9002313.55,9002313.55,.01,21,2,0)
should be defined is "1VA".  No local changes should be made to this
"^DD",9002313.55,9002313.55,.01,21,3,0)
field.
"^DD",9002313.55,9002313.55,.01,"DT")
3060127
"^DD",9002313.56,9002313.56,0)
FIELD^^13800^54
"^DD",9002313.56,9002313.56,0,"DT")
3050830
"^DD",9002313.56,9002313.56,0,"IX","B",9002313.56,.01)

"^DD",9002313.56,9002313.56,0,"IX","C",9002313.5601,.01)

"^DD",9002313.56,9002313.56,0,"NM","BPS PHARMACIES")

"^DD",9002313.56,9002313.56,0,"PT",9002313.57,1.07)

"^DD",9002313.56,9002313.56,0,"PT",9002313.59,1.07)

"^DD",9002313.56,9002313.56,0,"PT",9002313.72,.01)

"^DD",9002313.56,9002313.56,0,"VRPK")
BPS
"^DD",9002313.56,9002313.56,.01,0)
NAME^RFX^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.56,9002313.56,.01,1,0)
^.1
"^DD",9002313.56,9002313.56,.01,1,1,0)
9002313.56^B
"^DD",9002313.56,9002313.56,.01,1,1,1)
S ^BPS(9002313.56,"B",$E(X,1,30),DA)=""
"^DD",9002313.56,9002313.56,.01,1,1,2)
K ^BPS(9002313.56,"B",$E(X,1,30),DA)
"^DD",9002313.56,9002313.56,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",9002313.56,9002313.56,.01,7.5)
I $D(X) S X=$$UP^XLFSTR(X)
"^DD",9002313.56,9002313.56,.01,21,0)
^^1^1^3050729^
"^DD",9002313.56,9002313.56,.01,21,1,0)
This is the name used to distinquish the BPS Pharmacy.
"^DD",9002313.56,9002313.56,.01,"DT")
3050729
"^DD",9002313.56,9002313.56,.02,0)
NCPDP #^RF^^0;2^K:$L(X)>10!($L(X)<3) X
"^DD",9002313.56,9002313.56,.02,3)
This is a number assigned to your pharmacy by the NCPDP.  It was previously known as the NABP #.
"^DD",9002313.56,9002313.56,.02,21,0)
^^1^1^3050823^
"^DD",9002313.56,9002313.56,.02,21,1,0)
The NCPDP # is sent as part of the electronic claim header.
"^DD",9002313.56,9002313.56,.02,"DT")
3050823
"^DD",9002313.56,9002313.56,.03,0)
DEFAULT DEA #^RF^^0;3^K:$L(X)>12!($L(X)<3) X
"^DD",9002313.56,9002313.56,.03,3)
Answer must be 3-12 characters in length.
"^DD",9002313.56,9002313.56,.03,21,0)
^^4^4^3050823^
"^DD",9002313.56,9002313.56,.03,21,1,0)
Many insurances require the prescriber's DEA number as part of the 
"^DD",9002313.56,9002313.56,.03,21,2,0)
claim.  If your pharmacy has a DEA # that may be used in case a 
"^DD",9002313.56,9002313.56,.03,21,3,0)
prescriber doesn't have this DEA # on file with you, enter that
"^DD",9002313.56,9002313.56,.03,21,4,0)
default DEA # here.
"^DD",9002313.56,9002313.56,.03,"DT")
3040607
"^DD",9002313.56,9002313.56,.04,0)
AR TYPE^P9001626'^ABSBTYP(^0;4^Q
"^DD",9002313.56,9002313.56,.04,3)
Answer must be 1-10 characters in length.
"^DD",9002313.56,9002313.56,.04,21,0)
^^8^8^3000413^
"^DD",9002313.56,9002313.56,.04,21,1,0)
When charges (in the .57) file are posted to accounts receivable
"^DD",9002313.56,9002313.56,.04,21,2,0)
(in routine BPSOSB3) we need to select an accounts receivable type
"^DD",9002313.56,9002313.56,.04,21,3,0)
before posting it.   The accounts receivable type can be selected by
"^DD",9002313.56,9002313.56,.04,21,4,0)
pharmacy, by setting the pointer in this field.   
"^DD",9002313.56,9002313.56,.04,21,5,0)
-
"^DD",9002313.56,9002313.56,.04,21,6,0)
Or, more simply, if you want every pharmacy charge to always go to the
"^DD",9002313.56,9002313.56,.04,21,7,0)
same accounts receivable type, put it in as a default in 9002313.99,
"^DD",9002313.56,9002313.56,.04,21,8,0)
in the DEFAULT RX A/R TYPE field.
"^DD",9002313.56,9002313.56,.04,"DT")
3000413
"^DD",9002313.56,9002313.56,.05,0)
TAX ID #^F^^0;5^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.56,9002313.56,.05,3)
Answer must be 1-15 characters in length.
"^DD",9002313.56,9002313.56,.05,21,0)
^^2^2^3000725^
"^DD",9002313.56,9002313.56,.05,21,1,0)
Usually, this field will be blank - use the Tax ID # from the billing
"^DD",9002313.56,9002313.56,.05,21,2,0)
setup file instead.
"^DD",9002313.56,9002313.56,.05,"DT")
3000725
"^DD",9002313.56,9002313.56,.06,0)
ENVOY TERMINAL ID^NJ10,0^^0;6^K:+X'=X!(X>9999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.56,9002313.56,.06,3)
Type a Number between 1 and 9999999999, 0 Decimal Digits
"^DD",9002313.56,9002313.56,.06,"DT")
3000918
"^DD",9002313.56,9002313.56,.07,0)
SITE DOMAIN^F^^0;7^K:$L(X)>35!($L(X)<1) X
"^DD",9002313.56,9002313.56,.07,3)
Answer must be 1-35 characters in length.
"^DD",9002313.56,9002313.56,.07,21,0)
^^1^1^3031028^
"^DD",9002313.56,9002313.56,.07,21,1,0)
Enter the site domain used for this pharmacy to send 3rd party claims.
"^DD",9002313.56,9002313.56,.07,"DT")
3031028
"^DD",9002313.56,9002313.56,.09,0)
AUTO-REVERSE PARAMETER^NJ2,0^^0;9^K:+X'=X!(X>30)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.56,9002313.56,.09,3)
You have to enter a number between 0 and 30.
"^DD",9002313.56,9002313.56,.09,21,0)
^.001^11^11^3050830^^
"^DD",9002313.56,9002313.56,.09,21,1,0)
ECME shall use the following AUTO-REVERSE site parameter when
"^DD",9002313.56,9002313.56,.09,21,2,0)
determining whether non-released prescription claims (that have
"^DD",9002313.56,9002313.56,.09,21,3,0)
a PAYABLE payer returned response) are to be automatically REVERSED.
"^DD",9002313.56,9002313.56,.09,21,4,0)
 
"^DD",9002313.56,9002313.56,.09,21,5,0)
The AUTO-REVERSE site parameter is set for the number of days that
"^DD",9002313.56,9002313.56,.09,21,6,0)
ECME will wait before the claim is automatically REVERSED. The user
"^DD",9002313.56,9002313.56,.09,21,7,0)
is allowed to enter a number as follows:
"^DD",9002313.56,9002313.56,.09,21,8,0)
 
"^DD",9002313.56,9002313.56,.09,21,9,0)
0 - ECME Auto-Reverse is turned off, 1 to 30 - ECME will wait the
"^DD",9002313.56,9002313.56,.09,21,10,0)
entered number of days before REVERSING the non-released Rx with a
"^DD",9002313.56,9002313.56,.09,21,11,0)
PAYABLE payer returned response.
"^DD",9002313.56,9002313.56,.09,"DT")
3050830
"^DD",9002313.56,9002313.56,1,0)
CMOP SWITCH^RS^0:CMOP OFF;1:CMOP ON;^0;8^Q
"^DD",9002313.56,9002313.56,1,3)
Enter ON to process CMOP claims via ECME, OFF to not process CMOP claims via ECME.
"^DD",9002313.56,9002313.56,1,21,0)
^^2^2^3050823^
"^DD",9002313.56,9002313.56,1,21,1,0)
Indicates whether ECME shall process CMOP claims.  If ON, CMOP claims 
"^DD",9002313.56,9002313.56,1,21,2,0)
will be processed.  If OFF, CMOP claims will not be processed.
"^DD",9002313.56,9002313.56,1,"DT")
3050729
"^DD",9002313.56,9002313.56,102.03,0)
SITE CITY^RF^^ADDR;3^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,102.03,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,102.03,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,102.03,21,1,0)
Enter City
"^DD",9002313.56,9002313.56,102.03,"DT")
3040607
"^DD",9002313.56,9002313.56,120.01,0)
SITE ADDRESS 1^RF^^ADDR;1^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.01,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,120.01,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,120.01,21,1,0)
The site's street address. 
"^DD",9002313.56,9002313.56,120.01,"DT")
3040607
"^DD",9002313.56,9002313.56,120.02,0)
SITE ADDRESS 2^F^^ADDR;2^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.02,3)
Answer must be 1-25 characters in length
"^DD",9002313.56,9002313.56,120.02,21,0)
^^1^1^3040325^
"^DD",9002313.56,9002313.56,120.02,21,1,0)
Site's address line 2.
"^DD",9002313.56,9002313.56,120.02,"DT")
3040325
"^DD",9002313.56,9002313.56,120.03,0)
SITE ADDRESS NAME^RF^^ADDR;8^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.03,3)
Answer must be 1-40 characters in length.
"^DD",9002313.56,9002313.56,120.03,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,120.03,21,1,0)
Site's Business name.
"^DD",9002313.56,9002313.56,120.03,"DT")
3040607
"^DD",9002313.56,9002313.56,120.04,0)
SITE STATE^RP5'^DIC(5,^ADDR;4^Q
"^DD",9002313.56,9002313.56,120.04,3)

"^DD",9002313.56,9002313.56,120.04,"DT")
3040607
"^DD",9002313.56,9002313.56,120.05,0)
SITE ZIP CODE^RF^^ADDR;5^K:$L(X)>10!($L(X)<5) X
"^DD",9002313.56,9002313.56,120.05,3)
Answer must be 5-10 characters in length.
"^DD",9002313.56,9002313.56,120.05,"DT")
3040607
"^DD",9002313.56,9002313.56,120.06,0)
SITE PHONE^F^^ADDR;6^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.06,3)
Answer must be 1-20 characters in length.
"^DD",9002313.56,9002313.56,120.06,21,0)
^^1^1^3010331^
"^DD",9002313.56,9002313.56,120.06,21,1,0)
For NCPDP claim forms.
"^DD",9002313.56,9002313.56,120.06,"DT")
3010331
"^DD",9002313.56,9002313.56,120.07,0)
SITE FAX^F^^ADDR;7^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.07,3)
Answer must be 1-20 characters in length.
"^DD",9002313.56,9002313.56,120.07,21,0)
^^1^1^3010331^
"^DD",9002313.56,9002313.56,120.07,21,1,0)
For NCPDP claim forms.
"^DD",9002313.56,9002313.56,120.07,"DT")
3010331
"^DD",9002313.56,9002313.56,120.11,0)
HOURS OF OPERATION^F^^HOURS;1^K:$L(X)>2!($L(X)<1)!'(X?1N.N) X
"^DD",9002313.56,9002313.56,120.11,3)
Answer must be 0 to 24 hours.
"^DD",9002313.56,9002313.56,120.11,21,0)
^.001^1^1^3040315^^
"^DD",9002313.56,9002313.56,120.11,21,1,0)
Enter the hours of operation for the Pharmacy (0 to 24 hours).
"^DD",9002313.56,9002313.56,120.11,"DT")
3040315
"^DD",9002313.56,9002313.56,120.12,0)
START DAY RANGE^F^^HOURS;2^K:$L(X)>3!($L(X)<3)!'(X?3A) X
"^DD",9002313.56,9002313.56,120.12,3)
Answer must be 3 characters in length
"^DD",9002313.56,9002313.56,120.12,21,0)
^^1^1^3031028^
"^DD",9002313.56,9002313.56,120.12,21,1,0)
Enter the start of the day for this Pharmacy.
"^DD",9002313.56,9002313.56,120.12,"DT")
3040315
"^DD",9002313.56,9002313.56,120.13,0)
END DAY RANGE^F^^HOURS;3^K:$L(X)>3!($L(X)<3)!'(X?3A) X
"^DD",9002313.56,9002313.56,120.13,3)
Answer must be 3 characters in length
"^DD",9002313.56,9002313.56,120.13,21,0)
^^1^1^3031028^
"^DD",9002313.56,9002313.56,120.13,21,1,0)
Enter the end of the day range for this Pharmacy.
"^DD",9002313.56,9002313.56,120.13,"DT")
3040315
"^DD",9002313.56,9002313.56,120.14,0)
START HOUR RANGE^F^^HOURS;4^K:$L(X)>4!($L(X)<4)!'(X?4N) X
"^DD",9002313.56,9002313.56,120.14,3)
Answer must be 0000 to 2359
"^DD",9002313.56,9002313.56,120.14,21,0)
^^1^1^3031028^
"^DD",9002313.56,9002313.56,120.14,21,1,0)
Enter the start hour range for this Pharmacy.  
"^DD",9002313.56,9002313.56,120.14,"DT")
3040315
"^DD",9002313.56,9002313.56,120.15,0)
END HOUR RANGE^F^^HOURS;5^K:$L(X)>4!($L(X)<4)!'(X?4N) X
"^DD",9002313.56,9002313.56,120.15,3)
Answer must be 0000 to 2359
"^DD",9002313.56,9002313.56,120.15,21,0)
^^1^1^3031028^
"^DD",9002313.56,9002313.56,120.15,21,1,0)
Enter the end hour range for this Pharmacy.
"^DD",9002313.56,9002313.56,120.15,"DT")
3040315
"^DD",9002313.56,9002313.56,120.21,0)
Sunday Open Time^F^^TOPEN;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.21,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.21,21,0)
^.001^1^1^3040521^^
"^DD",9002313.56,9002313.56,120.21,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.21,"DT")
3040521
"^DD",9002313.56,9002313.56,120.22,0)
Monday Open Time^F^^TOPEN;2^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.22,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.22,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.22,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.22,"DT")
3040521
"^DD",9002313.56,9002313.56,120.23,0)
Tuesday Open Time^F^^TOPEN;3^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.23,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.23,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.23,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.23,"DT")
3040521
"^DD",9002313.56,9002313.56,120.24,0)
Wednesday Open Time^F^^TOPEN;4^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.24,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.24,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.24,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.24,"DT")
3040521
"^DD",9002313.56,9002313.56,120.25,0)
Thursday Open Time^F^^TOPEN;5^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.25,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.25,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.25,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.25,"DT")
3040521
"^DD",9002313.56,9002313.56,120.26,0)
Friday Open Time^F^^TOPEN;6^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.26,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.26,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.26,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.26,"DT")
3040521
"^DD",9002313.56,9002313.56,120.27,0)
Saturday Open Time^F^^TOPEN;7^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.27,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.27,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.27,21,1,0)
Opening time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.27,"DT")
3040521
"^DD",9002313.56,9002313.56,120.31,0)
Sunday Close Time^F^^TCLOSE;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.31,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.31,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.31,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.31,"DT")
3040521
"^DD",9002313.56,9002313.56,120.32,0)
Monday Close Time^F^^TCLOSE;2^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.32,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.32,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.32,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.32,"DT")
3040521
"^DD",9002313.56,9002313.56,120.33,0)
Tuesday Close Time^F^^TCLOSE;3^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.33,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.33,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.33,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.33,"DT")
3040521
"^DD",9002313.56,9002313.56,120.34,0)
Wednesday Close Time^F^^TCLOSE;4^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.34,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.34,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.34,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.34,"DT")
3040521
"^DD",9002313.56,9002313.56,120.35,0)
Thursday Close Time^F^^TCLOSE;5^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.35,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.35,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.35,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.35,"DT")
3040521
"^DD",9002313.56,9002313.56,120.36,0)
Friday Close Time^F^^TCLOSE;6^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.36,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.36,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.36,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.36,"DT")
3040521
"^DD",9002313.56,9002313.56,120.37,0)
Saturday Close Time^F^^TCLOSE;7^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.56,9002313.56,120.37,3)
Answer must be 4 characters in length.
"^DD",9002313.56,9002313.56,120.37,21,0)
^^1^1^3040521^
"^DD",9002313.56,9002313.56,120.37,21,1,0)
Closing time in military format: 0000 to 2359
"^DD",9002313.56,9002313.56,120.37,"DT")
3040521
"^DD",9002313.56,9002313.56,130.01,0)
REMITTANCE ADDRESS NAME^RF^^REMIT;1^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.01,3)
Answer must be 1-40 characters in length.
"^DD",9002313.56,9002313.56,130.01,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,130.01,21,1,0)
Pharmacy Business Name
"^DD",9002313.56,9002313.56,130.01,"DT")
3040607
"^DD",9002313.56,9002313.56,130.02,0)
REMIT ADDRESS 1^RF^^REMIT;2^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.02,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,130.02,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,130.02,21,1,0)
Street Address (Line 1) for the Remittance Address.
"^DD",9002313.56,9002313.56,130.02,"DT")
3040607
"^DD",9002313.56,9002313.56,130.03,0)
REMIT ADDRESS 2^F^^REMIT;3^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.03,3)
Answer must be 1-25 characters in length
"^DD",9002313.56,9002313.56,130.03,21,0)
^^1^1^3040326^
"^DD",9002313.56,9002313.56,130.03,21,1,0)
Street Address (Line 2) for the Remittance Address.
"^DD",9002313.56,9002313.56,130.03,"DT")
3040326
"^DD",9002313.56,9002313.56,130.04,0)
REMIT DWELLING NUMBER^F^^REMIT;4^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.04,3)
Answer must be 1-8 characters in length.
"^DD",9002313.56,9002313.56,130.04,21,0)
^.001^1^1^3031222^^
"^DD",9002313.56,9002313.56,130.04,21,1,0)
Enter the dwelling number for the claim remittance address.
"^DD",9002313.56,9002313.56,130.04,"DT")
3031222
"^DD",9002313.56,9002313.56,130.07,0)
REMIT STATE^RP5'^DIC(5,^REMIT;7^Q
"^DD",9002313.56,9002313.56,130.07,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,130.07,21,1,0)
Enter the state for the claim remittance address.
"^DD",9002313.56,9002313.56,130.07,"DT")
3040607
"^DD",9002313.56,9002313.56,130.08,0)
REMIT ZIP^RF^^REMIT;8^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.08,3)
Answer must be 1-10 characters in length.
"^DD",9002313.56,9002313.56,130.08,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,130.08,21,1,0)
Enter the zip for the claim remittance address.
"^DD",9002313.56,9002313.56,130.08,"DT")
3040607
"^DD",9002313.56,9002313.56,130.5,0)
REMIT OTHER DESIGNATION^F^^REMIT;5^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.5,3)
Answer must be 1-8 characters in length.
"^DD",9002313.56,9002313.56,130.5,21,0)
^.001^1^1^3031222^^
"^DD",9002313.56,9002313.56,130.5,21,1,0)
Enter the other designation for the claim remittance address.
"^DD",9002313.56,9002313.56,130.5,"DT")
3031222
"^DD",9002313.56,9002313.56,130.6,0)
REMIT CITY^RF^^REMIT;6^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.6,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,130.6,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,130.6,21,1,0)
Enter the city for the claim remittance address.
"^DD",9002313.56,9002313.56,130.6,"DT")
3040607
"^DD",9002313.56,9002313.56,950,0)
INSURER-ASSIGNED #^9002313.6P^^INSURER-ASSIGNED #;0
"^DD",9002313.56,9002313.56,1830.01,0)
CONTACT NAMES^F^^REP;1^K:$L(X)>100!($L(X)<1) X
"^DD",9002313.56,9002313.56,1830.01,3)
Answer must be 1-100 characters in length.
"^DD",9002313.56,9002313.56,1830.01,21,0)
^^4^4^3000420^
"^DD",9002313.56,9002313.56,1830.01,21,1,0)
You may enter more than one name, separated by "/".
"^DD",9002313.56,9002313.56,1830.01,21,2,0)
Put corresponding phone numbers separated by "/" in the phone number field.
"^DD",9002313.56,9002313.56,1830.01,21,3,0)
A random name-phone combination will appear on each bill and that way
"^DD",9002313.56,9002313.56,1830.01,21,4,0)
the calls get distributed evenly.
"^DD",9002313.56,9002313.56,1830.01,"DT")
3000420
"^DD",9002313.56,9002313.56,1830.02,0)
CONTACT PHONES^F^^REP;2^K:$L(X)>100!($L(X)<1) X
"^DD",9002313.56,9002313.56,1830.02,3)
Answer must be 1-100 characters in length.
"^DD",9002313.56,9002313.56,1830.02,21,0)
^^1^1^3000420^
"^DD",9002313.56,9002313.56,1830.02,21,1,0)
(See CONTACT NAMES description for details about "/"-separated list.)
"^DD",9002313.56,9002313.56,1830.02,"DT")
3000420
"^DD",9002313.56,9002313.56,1900.01,0)
VA CONTACT^RP200'^VA(200,^REP;3^Q
"^DD",9002313.56,9002313.56,1900.01,3)
Pointer to the New Person file for the VA contact information.
"^DD",9002313.56,9002313.56,1900.01,21,0)
^.001^1^1^3040625^^
"^DD",9002313.56,9002313.56,1900.01,21,1,0)
Pointer to the New Person file for the VA contact person information.
"^DD",9002313.56,9002313.56,1900.01,"DT")
3040625
"^DD",9002313.56,9002313.56,1900.02,0)
VA ALTERNATE CONTACT^RP200'^VA(200,^REP;4^Q
"^DD",9002313.56,9002313.56,1900.02,3)
Pointer to the New Person file for the Alternant VA contact.
"^DD",9002313.56,9002313.56,1900.02,21,0)
^.001^1^1^3040625^^^
"^DD",9002313.56,9002313.56,1900.02,21,1,0)
Pointer to the New Person file for the Alternant VA contact.
"^DD",9002313.56,9002313.56,1900.02,"DT")
3040625
"^DD",9002313.56,9002313.56,1900.03,0)
VA LEAD PHARMACIST^RP200'^VA(200,^REP;5^Q
"^DD",9002313.56,9002313.56,1900.03,3)
Pointer to the New Person file for the lead Pharmacists.
"^DD",9002313.56,9002313.56,1900.03,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,1900.03,21,1,0)
Pointer to the New Person file for the lead Pharmacists. 
"^DD",9002313.56,9002313.56,1900.03,"DT")
3040607
"^DD",9002313.56,9002313.56,1900.04,0)
VA LEAD PHARMACIST LICENSE #^F^^REP1;1^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.56,9002313.56,1900.04,3)
Answer must be 1-40 characters in length.
"^DD",9002313.56,9002313.56,1900.04,"DT")
3040608
"^DD",9002313.56,9002313.56,3001.01,0)
MEDICAID #^F^^CAID;1^K:$L(X)>12!($L(X)<3) X
"^DD",9002313.56,9002313.56,3001.01,3)
Answer must be 3-12 characters in length.
"^DD",9002313.56,9002313.56,3001.01,21,0)
^^2^2^3000311^
"^DD",9002313.56,9002313.56,3001.01,21,1,0)
Some Medicaid formats require a special Medicaid pharmacy number instead
"^DD",9002313.56,9002313.56,3001.01,21,2,0)
of the NABP #.
"^DD",9002313.56,9002313.56,3001.01,"DT")
3000311
"^DD",9002313.56,9002313.56,3001.02,0)
DEFAULT CAID PROVIDER #^F^^CAID;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.56,9002313.56,3001.02,3)
Answer must be 1-10 characters in length.
"^DD",9002313.56,9002313.56,3001.02,21,0)
^^5^5^3000420^
"^DD",9002313.56,9002313.56,3001.02,21,1,0)
For Alaska Medicaid (at least), we can have a default provider number
"^DD",9002313.56,9002313.56,3001.02,21,2,0)
to use for when a prescriber doesn't have a Medicaid number.
"^DD",9002313.56,9002313.56,3001.02,21,3,0)
Similar to DEFAULT DEA # field, apparently.   It's just that Alaska Medicaid
"^DD",9002313.56,9002313.56,3001.02,21,4,0)
just doesn't deal in the usual kinds of numbers (i.e., NABP #, DEA #)
"^DD",9002313.56,9002313.56,3001.02,21,5,0)
and for some wacky reason, they just have to have their own.
"^DD",9002313.56,9002313.56,3001.02,"DT")
3000420
"^DD",9002313.56,9002313.56,13800,0)
OUTPATIENT SITE^9002313.5601P^^OPSITE;0
"^DD",9002313.56,9002313.5601,0)
OUTPATIENT SITE SUB-FIELD^^1^2
"^DD",9002313.56,9002313.5601,0,"DT")
3050802
"^DD",9002313.56,9002313.5601,0,"IX","B",9002313.5601,.01)

"^DD",9002313.56,9002313.5601,0,"NM","OUTPATIENT SITE")

"^DD",9002313.56,9002313.5601,0,"UP")
9002313.56
"^DD",9002313.56,9002313.5601,.01,0)
OUTPATIENT SITE^MP59'^PS(59,^0;1^Q
"^DD",9002313.56,9002313.5601,.01,1,0)
^.1^^-1
"^DD",9002313.56,9002313.5601,.01,1,1,0)
9002313.5601^B
"^DD",9002313.56,9002313.5601,.01,1,1,1)
S ^BPS(9002313.56,DA(1),"OPSITE","B",$E(X,1,30),DA)=""
"^DD",9002313.56,9002313.5601,.01,1,1,2)
K ^BPS(9002313.56,DA(1),"OPSITE","B",$E(X,1,30),DA)
"^DD",9002313.56,9002313.5601,.01,1,2,0)
9002313.56^C
"^DD",9002313.56,9002313.5601,.01,1,2,1)
S ^BPS(9002313.56,"C",$E(X,1,30),DA(1),DA)=""
"^DD",9002313.56,9002313.5601,.01,1,2,2)
K ^BPS(9002313.56,"C",$E(X,1,30),DA(1),DA)
"^DD",9002313.56,9002313.5601,.01,1,2,"DT")
3010119
"^DD",9002313.56,9002313.5601,.01,3)
Enter one or more OUTPATIENT SITES to associate with this ECME Pharmacy entry.
"^DD",9002313.56,9002313.5601,.01,21,0)
^^2^2^3050802^
"^DD",9002313.56,9002313.5601,.01,21,1,0)
One or more of the VISTA pharmacy package's Outpatient Sites (File 59) 
"^DD",9002313.56,9002313.5601,.01,21,2,0)
must be associated with the ECME Pharmacy entry.
"^DD",9002313.56,9002313.5601,.01,"DT")
3050802
"^DD",9002313.56,9002313.5601,1,0)
PRESCRIBER^9002313.56011P^^1;0
"^DD",9002313.56,9002313.56011,0)
PRESCRIBER SUB-FIELD^^.01^1
"^DD",9002313.56,9002313.56011,0,"DT")
3000311
"^DD",9002313.56,9002313.56011,0,"IX","B",9002313.56011,.01)

"^DD",9002313.56,9002313.56011,0,"NM","PRESCRIBER")

"^DD",9002313.56,9002313.56011,0,"UP")
9002313.5601
"^DD",9002313.56,9002313.56011,.01,0)
PRESCRIBER^MP200'^VA(200,^0;1^Q
"^DD",9002313.56,9002313.56011,.01,1,0)
^.1
"^DD",9002313.56,9002313.56011,.01,1,1,0)
9002313.56011^B
"^DD",9002313.56,9002313.56011,.01,1,1,1)
S ^BPS(9002313.56,DA(2),"OPSITE",DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002313.56,9002313.56011,.01,1,1,2)
K ^BPS(9002313.56,DA(2),"OPSITE",DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002313.56,9002313.56011,.01,21,0)
^^2^2^3000311^
"^DD",9002313.56,9002313.56011,.01,21,1,0)
This is to handle the unusual situation at Sitka / Haines, where Haines
"^DD",9002313.56,9002313.56011,.01,21,2,0)
has multiple "pharmacies" corresponding to the prescriber.  
"^DD",9002313.56,9002313.56011,.01,"DT")
3000311
"^DD",9002313.56,9002313.6,0)
INSURER-ASSIGNED # SUB-FIELD^^.02^2
"^DD",9002313.56,9002313.6,0,"DT")
3000918
"^DD",9002313.56,9002313.6,0,"IX","B",9002313.6,.01)

"^DD",9002313.56,9002313.6,0,"NM","INSURER-ASSIGNED #")

"^DD",9002313.56,9002313.6,0,"UP")
9002313.56
"^DD",9002313.56,9002313.6,.01,0)
INSURER^MP9999999.18'^AUTNINS(^0;1^Q
"^DD",9002313.56,9002313.6,.01,1,0)
^.1
"^DD",9002313.56,9002313.6,.01,1,1,0)
9002313.6^B
"^DD",9002313.56,9002313.6,.01,1,1,1)
S ^BPS(9002313.56,DA(1),"INSURER-ASSIGNED #","B",$E(X,1,30),DA)=""
"^DD",9002313.56,9002313.6,.01,1,1,2)
K ^BPS(9002313.56,DA(1),"INSURER-ASSIGNED #","B",$E(X,1,30),DA)
"^DD",9002313.56,9002313.6,.01,3)
Answer must be 5-35 characters in length.
"^DD",9002313.56,9002313.6,.01,21,0)
^^2^2^3000918^
"^DD",9002313.56,9002313.6,.01,21,1,0)
Multiple: various insurers may assign their own peculiar number
"^DD",9002313.56,9002313.6,.01,21,2,0)
to the pharmacy, to be used in lieu of the NABP #.
"^DD",9002313.56,9002313.6,.01,"DT")
3000918
"^DD",9002313.56,9002313.6,.02,0)
INSURER-ASSIGNED #^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.56,9002313.6,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.56,9002313.6,.02,"DT")
3000918
"^DD",9002313.57,9002313.57,0)
FIELD^^10544^231
"^DD",9002313.57,9002313.57,0,"DDA")
N
"^DD",9002313.57,9002313.57,0,"DT")
3051213
"^DD",9002313.57,9002313.57,0,"IX","AC",9002313.57,5)

"^DD",9002313.57,9002313.57,0,"IX","AE",9002313.57,3)

"^DD",9002313.57,9002313.57,0,"IX","AER",9002313.57,401)

"^DD",9002313.57,9002313.57,0,"IX","AF",9002313.57,4)

"^DD",9002313.57,9002313.57,0,"IX","AFR",9002313.57,402)

"^DD",9002313.57,9002313.57,0,"IX","AG",9002313.57,13)

"^DD",9002313.57,9002313.57,0,"IX","AH",9002313.57,7)

"^DD",9002313.57,9002313.57,0,"IX","AI",9002313.57,1.06)

"^DD",9002313.57,9002313.57,0,"IX","AR",9002313.57,.15)

"^DD",9002313.57,9002313.57,0,"IX","AS",9002313.57,.16)

"^DD",9002313.57,9002313.57,0,"IX","B",9002313.57,.01)

"^DD",9002313.57,9002313.57,0,"NM","BPS LOG OF TRANSACTIONS")

"^DD",9002313.57,9002313.57,0,"PT",9002313.61,.03)

"^DD",9002313.57,9002313.57,0,"VRPK")
BPS
"^DD",9002313.57,9002313.57,.01,0)
ENTRY #^RF^^0;1^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.57,9002313.57,.01,1,0)
^.1
"^DD",9002313.57,9002313.57,.01,1,1,0)
9002313.57^B
"^DD",9002313.57,9002313.57,.01,1,1,1)
S ^BPSTL("B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,.01,1,1,2)
K ^BPSTL("B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,.01,3)
Answer must be 1-30 characters in length.
"^DD",9002313.57,9002313.57,.01,21,0)
^^1^1^3031208^
"^DD",9002313.57,9002313.57,.01,21,1,0)
Sequential entry number
"^DD",9002313.57,9002313.57,.01,"DT")
3001115
"^DD",9002313.57,9002313.57,.13,0)
TYPE^S^1:PRESCRIPTION;2:POSTAGE FOR PRESCRIPTION;3:NON-PRESCRIPTION;^0;13^Q
"^DD",9002313.57,9002313.57,.13,21,0)
^^1^1^3031208^
"^DD",9002313.57,9002313.57,.13,21,1,0)
Set of codes for the type of transaction that is being logged.
"^DD",9002313.57,9002313.57,.13,"DT")
3010105
"^DD",9002313.57,9002313.57,.14,0)
ORIGIN^P9002313.516'^BPS(9002313.516,^0;14^Q
"^DD",9002313.57,9002313.57,.14,21,0)
^^2^2^3031208^
"^DD",9002313.57,9002313.57,.14,21,1,0)
Pointer to where in the system the data came from.  Whether 
"^DD",9002313.57,9002313.57,.14,21,2,0)
it was entered directly into ECME or through the Pharmacy system.
"^DD",9002313.57,9002313.57,.14,"DT")
3001117
"^DD",9002313.57,9002313.57,.15,0)
POSTED TO A/R^F^^0;15^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.57,9002313.57,.15,1,0)
^.1
"^DD",9002313.57,9002313.57,.15,1,1,0)
9002313.57^AR
"^DD",9002313.57,9002313.57,.15,1,1,1)
S ^BPSTL("AR",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,.15,1,1,2)
K ^BPSTL("AR",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,.15,1,1,"DT")
3010105
"^DD",9002313.57,9002313.57,.15,3)
Answer must be 1-30 characters in length.
"^DD",9002313.57,9002313.57,.15,21,0)
^.001^1^1^3031216^^^
"^DD",9002313.57,9002313.57,.15,21,1,0)
What the individual interface's $$ posting routine returns to BPSOSBB.
"^DD",9002313.57,9002313.57,.15,"DT")
3010105
"^DD",9002313.57,9002313.57,.16,0)
NEEDS BILLING^S^1:YES;0:NO (DONE);^0;16^Q
"^DD",9002313.57,9002313.57,.16,1,0)
^.1
"^DD",9002313.57,9002313.57,.16,1,1,0)
9002313.57^AS
"^DD",9002313.57,9002313.57,.16,1,1,1)
S ^BPSTL("AS",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,.16,1,1,2)
K ^BPSTL("AS",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,.16,1,1,"DT")
3010124
"^DD",9002313.57,9002313.57,.16,21,0)
^.001^2^2^3031208^^
"^DD",9002313.57,9002313.57,.16,21,1,0)
Set by transaction completion (BPSOSBC).
"^DD",9002313.57,9002313.57,.16,21,2,0)
Cleared by background job after posting done (BPSOSBD).
"^DD",9002313.57,9002313.57,.16,"DT")
3010124
"^DD",9002313.57,9002313.57,1,0)
STATUS^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.57,9002313.57,1,3)
Type a Number between 0 and 99, 0 Decimal Digits
"^DD",9002313.57,9002313.57,1,21,0)
^^1^1^3000418^
"^DD",9002313.57,9002313.57,1,21,1,0)
Should always be 99 (complete) here in file 9002313.57.
"^DD",9002313.57,9002313.57,1,"DT")
3000418
"^DD",9002313.57,9002313.57,1.05,0)
ABSBDIV SOURCE^S^1:59 OUTPATIENT SITE;2:59.4 INPATIENT SITE;^1;5^Q
"^DD",9002313.57,9002313.57,1.05,21,0)
^^4^4^3031216^
"^DD",9002313.57,9002313.57,1.05,21,1,0)
Reserved: to indicate from where ABSBDIV was
"^DD",9002313.57,9002313.57,1.05,21,2,0)
obtained; when you try to map this back 
"^DD",9002313.57,9002313.57,1.05,21,3,0)
to a pharmacy in 9002313.56, you know which
"^DD",9002313.57,9002313.57,1.05,21,4,0)
subscript to look under.  
"^DD",9002313.57,9002313.57,1.05,"DT")
3000418
"^DD",9002313.57,9002313.57,1.06,0)
INSURER^F^^1;6^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.57,9002313.57,1.06,1,0)
^.1
"^DD",9002313.57,9002313.57,1.06,1,1,0)
9002313.57^AI
"^DD",9002313.57,9002313.57,1.06,1,1,1)
S ^BPSTL("AI",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,1.06,1,1,2)
K ^BPSTL("AI",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,1.06,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,1.06,3)
Answer must be 1-12 characters in length.
"^DD",9002313.57,9002313.57,1.06,21,0)
^^4^4^3031216^
"^DD",9002313.57,9002313.57,1.06,21,1,0)
Pointer to both INSURER (^AUTNINS) and BPS
"^DD",9002313.57,9002313.57,1.06,21,2,0)
INSURER (^BPSEI) $D(^BPSEI(n,100)) then 
"^DD",9002313.57,9002313.57,1.06,21,3,0)
see details of how to send this claim
"^DD",9002313.57,9002313.57,1.06,21,4,0)
electronically 
"^DD",9002313.57,9002313.57,1.06,"DT")
3031216
"^DD",9002313.57,9002313.57,1.07,0)
PHARMACY^P9002313.56'^BPS(9002313.56,^1;7^Q
"^DD",9002313.57,9002313.57,1.07,21,0)
^^1^1^3040331^
"^DD",9002313.57,9002313.57,1.07,21,1,0)
Textual description of the Pharmacy involved with this transation.
"^DD",9002313.57,9002313.57,1.07,"DT")
3040331
"^DD",9002313.57,9002313.57,1.08,0)
PINS PIECE^NJ1,0^^1;8^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.57,9002313.57,1.08,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",9002313.57,9002313.57,1.08,21,0)
^^7^7^3031216^
"^DD",9002313.57,9002313.57,1.08,21,1,0)
Type a Number between 1 and 9, 0 Decimal Digits 
"^DD",9002313.57,9002313.57,1.08,21,2,0)
DESCRIPTION:      Pointer to which of the PINS pieces in 
"^DD",9002313.57,9002313.57,1.08,21,3,0)
^(6) is in use for this claim.  Use this to keep track
"^DD",9002313.57,9002313.57,1.08,21,4,0)
of where you are in billing down the line to
"^DD",9002313.57,9002313.57,1.08,21,5,0)
various insurers.   (Probably won't automatically roll over to next
"^DD",9002313.57,9002313.57,1.08,21,6,0)
insurer, but maybe we will have an option to edit
"^DD",9002313.57,9002313.57,1.08,21,7,0)
insurance info, try next insurance, etc.)
"^DD",9002313.57,9002313.57,1.08,"DT")
3010330
"^DD",9002313.57,9002313.57,1.09,0)
PREAUTHORIZATION #^F^^1;9^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.57,9002313.57,1.09,3)
Answer must be 1-15 characters in length.
"^DD",9002313.57,9002313.57,1.09,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,1.09,21,1,0)
Number assigned by the processor to identify a preauthorized transaction.
"^DD",9002313.57,9002313.57,1.09,"DT")
3000418
"^DD",9002313.57,9002313.57,1.11,0)
ABSBRXI^P52'^PSRX(^1;11^Q
"^DD",9002313.57,9002313.57,1.11,21,0)
^.001^1^1^3031216^^
"^DD",9002313.57,9002313.57,1.11,21,1,0)
Pointer from the RX file into BPS Transactions.
"^DD",9002313.57,9002313.57,1.11,"DT")
3000711
"^DD",9002313.57,9002313.57,1.1199,0)
RXI-INTERNAL^CJ8^^ ; ^S Y(9002313.57,1.1199,1)=$S($D(^BPSTL(D0,1)):^(1),1:"") S X=$P(Y(9002313.57,1.1199,1),U,11),X=X
"^DD",9002313.57,9002313.57,1.1199,9)
^
"^DD",9002313.57,9002313.57,1.1199,9.01)
9002313.57^1.11
"^DD",9002313.57,9002313.57,1.1199,9.1)
INTERNAL(ABSBRXI)
"^DD",9002313.57,9002313.57,1.1199,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,1.1199,21,1,0)
Internal ID to the claims file.
"^DD",9002313.57,9002313.57,1.12,0)
RESUBMIT AFTER REVERSAL^S^0:DONE;1:RESUBMIT AFTER REVERSAL;2:RESUBMITTING;^1;12^Q
"^DD",9002313.57,9002313.57,1.12,3)
Enter the status of the resubmit
"^DD",9002313.57,9002313.57,1.12,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,1.12,21,1,0)
Indicator that a transaction has been resubmitted after being backed out.
"^DD",9002313.57,9002313.57,1.12,"DT")
3051213
"^DD",9002313.57,9002313.57,1.13,0)
NCPDP OVERRIDES^P9002313.511'^BPS(9002313.511,^1;13^Q
"^DD",9002313.57,9002313.57,1.13,21,0)
^^2^2^3040120^
"^DD",9002313.57,9002313.57,1.13,21,1,0)
Pointer to the overrides file for any fields that are not straight 
"^DD",9002313.57,9002313.57,1.13,21,2,0)
forward, but are required by the payer.
"^DD",9002313.57,9002313.57,1.13,"DT")
3010330
"^DD",9002313.57,9002313.57,3,0)
CLAIM^P9002313.02'^BPSC(^0;4^Q
"^DD",9002313.57,9002313.57,3,1,0)
^.1
"^DD",9002313.57,9002313.57,3,1,1,0)
9002313.57^AE
"^DD",9002313.57,9002313.57,3,1,1,1)
S ^BPSTL("AE",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,3,1,1,2)
K ^BPSTL("AE",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,3,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,3,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,3,21,1,0)
Claim number 
"^DD",9002313.57,9002313.57,3,"DT")
3001111
"^DD",9002313.57,9002313.57,3.1,0)
CLAIM IEN^CJ8^^ ; ^S Y(9002313.57,3.1,1)=$S($D(^BPSTL(D0,0)):^(0),1:"") S X=$P(Y(9002313.57,3.1,1),U,4),X=X
"^DD",9002313.57,9002313.57,3.1,9)
^
"^DD",9002313.57,9002313.57,3.1,9.01)
9002313.57^3
"^DD",9002313.57,9002313.57,3.1,9.1)
INTERNAL(CLAIM)
"^DD",9002313.57,9002313.57,3.1,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,3.1,21,1,0)
Pointer to the BPS claims file - 9002313.02
"^DD",9002313.57,9002313.57,4,0)
RESPONSE^P9002313.03'^BPSR(^0;5^Q
"^DD",9002313.57,9002313.57,4,1,0)
^.1
"^DD",9002313.57,9002313.57,4,1,1,0)
9002313.57^AF
"^DD",9002313.57,9002313.57,4,1,1,1)
S ^BPSTL("AF",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,4,1,1,2)
K ^BPSTL("AF",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,4,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,4,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,4,21,1,0)
Pointer to the corresponding response in the response file, 9002313.03
"^DD",9002313.57,9002313.57,4,"DT")
3001111
"^DD",9002313.57,9002313.57,4.0098,0)
RESULT WITH REVERSAL^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.57,9002313.57,4.0098,9)
^
"^DD",9002313.57,9002313.57,4.0098,9.01)

"^DD",9002313.57,9002313.57,4.0098,9.1)
S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.57,9002313.57,4.0098,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,4.0098,21,1,0)
Result if the claim had to be reversed for whatever reason.
"^DD",9002313.57,9002313.57,4.0099,0)
RESULT^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,4.0099,9)
^
"^DD",9002313.57,9002313.57,4.0099,9.01)

"^DD",9002313.57,9002313.57,4.0099,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,4.0099,21,0)
^^1^1^3040331^
"^DD",9002313.57,9002313.57,4.0099,21,1,0)
Result from the payer - maybe be Paid, rejected, captuured, accepted.
"^DD",9002313.57,9002313.57,4.0099,"DT")
3040331
"^DD",9002313.57,9002313.57,4.1,0)
RESPONSE IEN^CJ8^^ ; ^S Y(9002313.57,4.1,1)=$S($D(^BPSTL(D0,0)):^(0),1:"") S X=$P(Y(9002313.57,4.1,1),U,5),X=X
"^DD",9002313.57,9002313.57,4.1,9)
^
"^DD",9002313.57,9002313.57,4.1,9.01)
9002313.57^4
"^DD",9002313.57,9002313.57,4.1,9.1)
INTERNAL(RESPONSE)
"^DD",9002313.57,9002313.57,4.1,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,4.1,21,1,0)
Response file record number of any reversals.
"^DD",9002313.57,9002313.57,5,0)
PATIENT^P2'^DPT(^0;6^Q
"^DD",9002313.57,9002313.57,5,1,0)
^.1
"^DD",9002313.57,9002313.57,5,1,1,0)
9002313.57^AC
"^DD",9002313.57,9002313.57,5,1,1,1)
S ^BPSTL("AC",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,5,1,1,2)
K ^BPSTL("AC",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,5,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,5,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,5,21,1,0)
The patient this transaction refers to.
"^DD",9002313.57,9002313.57,5,"DT")
3031216
"^DD",9002313.57,9002313.57,7,0)
LAST UPDATE^D^^0;8^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57,7,1,0)
^.1
"^DD",9002313.57,9002313.57,7,1,1,0)
9002313.57^AH
"^DD",9002313.57,9002313.57,7,1,1,1)
S ^BPSTL("AH",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,7,1,1,2)
K ^BPSTL("AH",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,7,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,7,21,0)
^^2^2^3000418^
"^DD",9002313.57,9002313.57,7,21,1,0)
Date/time the POS transaction completed processing,
"^DD",9002313.57,9002313.57,7,21,2,0)
as copied from 9002313.59 at the time the .57 record was created.
"^DD",9002313.57,9002313.57,7,"DT")
3001111
"^DD",9002313.57,9002313.57,8,0)
VCPT^F^^1;3^K:$L(X)>7!($L(X)<4) X
"^DD",9002313.57,9002313.57,8,3)
Answer must be 4-7 characters in length.
"^DD",9002313.57,9002313.57,8,21,0)
^^2^2^3031216^
"^DD",9002313.57,9002313.57,8,21,1,0)
 Reference number assigned by the provider for
"^DD",9002313.57,9002313.57,8,21,2,0)
 the dispensed drug/product and/or service provided.
"^DD",9002313.57,9002313.57,8,"DT")
3031216
"^DD",9002313.57,9002313.57,8.0099,0)
VCPT-INTERNAL^CJ8^^ ; ^S Y(9002313.57,8.0099,1)=$S($D(^BPSTL(D0,1)):^(1),1:"") S X=$P(Y(9002313.57,8.0099,1),U,3),X=X
"^DD",9002313.57,9002313.57,8.0099,9)
^
"^DD",9002313.57,9002313.57,8.0099,9.01)
9002313.57^8
"^DD",9002313.57,9002313.57,8.0099,9.1)
INTERNAL(VCPT)
"^DD",9002313.57,9002313.57,8.0099,21,0)
^^3^3^3031216^
"^DD",9002313.57,9002313.57,8.0099,21,1,0)
Internal ID to reference number assigned by the
"^DD",9002313.57,9002313.57,8.0099,21,2,0)
provider for the dispensed drug/product and/or
"^DD",9002313.57,9002313.57,8.0099,21,3,0)
service provided.  
"^DD",9002313.57,9002313.57,9,0)
ABSBRXR^F^^1;1^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.57,9002313.57,9,3)
Answer must be 1-5 characters in length.
"^DD",9002313.57,9002313.57,9,21,0)
^.001^1^1^3031216^^
"^DD",9002313.57,9002313.57,9,21,1,0)
Point to refill multiple in ^PSRX file 52
"^DD",9002313.57,9002313.57,9,"DT")
3000418
"^DD",9002313.57,9002313.57,10,0)
ABSBNDC^F^^1;2^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.57,9002313.57,10,3)
Answer must be 1-12 characters in length.
"^DD",9002313.57,9002313.57,10,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,10,21,1,0)
NDC number referenced in this transaction.
"^DD",9002313.57,9002313.57,10,"DT")
3000418
"^DD",9002313.57,9002313.57,10.0099,0)
USER-INTERNAL^CJ8^^ ; ^S Y(9002313.57,10.0099,1)=$S($D(^BPSTL(D0,0)):^(0),1:"") S X=$P(Y(9002313.57,10.0099,1),U,10),X=X
"^DD",9002313.57,9002313.57,10.0099,9)
^
"^DD",9002313.57,9002313.57,10.0099,9.01)
9002313.57^13
"^DD",9002313.57,9002313.57,10.0099,9.1)
INTERNAL(USER)
"^DD",9002313.57,9002313.57,10.0099,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,10.0099,21,1,0)
IEN of the user generating the transaction
"^DD",9002313.57,9002313.57,11,0)
ABSBDIV^F^^1;4^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.57,9002313.57,11,3)
Answer must be 1-10 characters in length.
"^DD",9002313.57,9002313.57,11,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,11,21,1,0)
Division this transaction is for.
"^DD",9002313.57,9002313.57,11,"DT")
3000418
"^DD",9002313.57,9002313.57,12,0)
ABSBVISI^F^^0;7^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.57,9002313.57,12,3)
Answer must be 1-10 characters in length.
"^DD",9002313.57,9002313.57,12,21,0)
^.001^1^1^3031217^^
"^DD",9002313.57,9002313.57,12,21,1,0)
Pointer to 9000010 VISIT
"^DD",9002313.57,9002313.57,12,"DT")
3000418
"^DD",9002313.57,9002313.57,13,0)
USER^P200'^VA(200,^0;10^Q
"^DD",9002313.57,9002313.57,13,1,0)
^.1
"^DD",9002313.57,9002313.57,13,1,1,0)
9002313.57^AG
"^DD",9002313.57,9002313.57,13,1,1,1)
S ^BPSTL("AG",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,13,1,1,2)
K ^BPSTL("AG",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,13,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,13,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,13,21,1,0)
Who created the ECME claim
"^DD",9002313.57,9002313.57,13,"DT")
3001111
"^DD",9002313.57,9002313.57,14,0)
POSITION IN CLAIM^NJ1,0^^0;9^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.57,9002313.57,14,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",9002313.57,9002313.57,14,21,0)
^^1^1^3000418^
"^DD",9002313.57,9002313.57,14,21,1,0)
This is the D1 subscript into 9002313.02 and .03
"^DD",9002313.57,9002313.57,14,"DT")
3000418
"^DD",9002313.57,9002313.57,15,0)
START TIME^D^^0;11^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57,15,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,15,21,1,0)
Time, including the seconds that the transaction was initiated.
"^DD",9002313.57,9002313.57,15,"DT")
3000418
"^DD",9002313.57,9002313.57,16,0)
COMMS LOG^F^^0;12^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.57,9002313.57,16,3)
Answer must be 1-10 characters in length.
"^DD",9002313.57,9002313.57,16,21,0)
^^1^1^3001110^^
"^DD",9002313.57,9002313.57,16,21,1,0)
Points to ^BPSECP("LOG",*
"^DD",9002313.57,9002313.57,16,"DT")
3000418
"^DD",9002313.57,9002313.57,111,0)
COMMENT MULTIPLE^9002313.57111DA^^11;0
"^DD",9002313.57,9002313.57,111,21,0)
^.001^1^1^3050629^^
"^DD",9002313.57,9002313.57,111,21,1,0)
User's comment
"^DD",9002313.57,9002313.57,111,"DT")
3050627
"^DD",9002313.57,9002313.57,201,0)
RESULT CODE^F^^2;1^K:$L(X)>9!($L(X)<1) X
"^DD",9002313.57,9002313.57,201,3)
Answer must be 1-9 characters in length.
"^DD",9002313.57,9002313.57,201,21,0)
^^2^2^3040322^
"^DD",9002313.57,9002313.57,201,21,1,0)
Code indicating whether the claim was successfully
"^DD",9002313.57,9002313.57,201,21,2,0)
billed or rejected.
"^DD",9002313.57,9002313.57,201,"DT")
3000418
"^DD",9002313.57,9002313.57,202,0)
RESULT TEXT^F^^2;2^K:$L(X)>222!($L(X)<1) X
"^DD",9002313.57,9002313.57,202,3)
Answer must be 1-222 characters in length.
"^DD",9002313.57,9002313.57,202,21,0)
^^2^2^3031208^
"^DD",9002313.57,9002313.57,202,21,1,0)
Textual description of the reason for rejection, if the claim was 
"^DD",9002313.57,9002313.57,202,21,2,0)
rejected.
"^DD",9002313.57,9002313.57,202,"DT")
3000418
"^DD",9002313.57,9002313.57,301,0)
CANCELLATION REQUESTED^F^^3;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.57,9002313.57,301,3)
Answer must be 1-10 characters in length.
"^DD",9002313.57,9002313.57,301,21,0)
^^2^2^3031208^
"^DD",9002313.57,9002313.57,301,21,1,0)
Indicator to show that a claim was requested to be canceled
"^DD",9002313.57,9002313.57,301,21,2,0)
during the process,
"^DD",9002313.57,9002313.57,301,"DT")
3000418
"^DD",9002313.57,9002313.57,302,0)
CANCELED DURING STATUS^F^^3;2^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.57,9002313.57,302,3)
Answer must be 1-5 characters in length.
"^DD",9002313.57,9002313.57,302,21,0)
^^1^1^3010330^
"^DD",9002313.57,9002313.57,302,21,1,0)
See file 9002313.59 field 302
"^DD",9002313.57,9002313.57,302,"DT")
3010330
"^DD",9002313.57,9002313.57,401,0)
REVERSAL CLAIM^P9002313.02'^BPSC(^4;1^Q
"^DD",9002313.57,9002313.57,401,1,0)
^.1
"^DD",9002313.57,9002313.57,401,1,1,0)
9002313.57^AER
"^DD",9002313.57,9002313.57,401,1,1,1)
S ^BPSTL("AER",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,401,1,1,2)
K ^BPSTL("AER",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,401,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,401,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57,401,21,1,0)
Pointer to file 9002313.02 BPS CLAIMS file for the reversal
"^DD",9002313.57,9002313.57,401,21,2,0)
transaction.
"^DD",9002313.57,9002313.57,401,"DT")
3001111
"^DD",9002313.57,9002313.57,402,0)
REVERSAL RESPONSE^P9002313.03'^BPSR(^4;2^Q
"^DD",9002313.57,9002313.57,402,1,0)
^.1
"^DD",9002313.57,9002313.57,402,1,1,0)
9002313.57^AFR
"^DD",9002313.57,9002313.57,402,1,1,1)
S ^BPSTL("AFR",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,402,1,1,2)
K ^BPSTL("AFR",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,402,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,402,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57,402,21,1,0)
Pointer to the BPS responses file 9002313.03 for the 
"^DD",9002313.57,9002313.57,402,21,2,0)
reversal response.
"^DD",9002313.57,9002313.57,402,"DT")
3001111
"^DD",9002313.57,9002313.57,403,0)
PAPER REVERSAL^S^1:YES;^4;3^Q
"^DD",9002313.57,9002313.57,403,21,0)
^^3^3^3010330^
"^DD",9002313.57,9002313.57,403,21,1,0)
Non-electronic - i.e., paper - claims can be reversed.
"^DD",9002313.57,9002313.57,403,21,2,0)
Instead of pointers to electronic claim and response in fields 401, 402,
"^DD",9002313.57,9002313.57,403,21,3,0)
you have the flag 1 here in field 403.
"^DD",9002313.57,9002313.57,403,"DT")
3010330
"^DD",9002313.57,9002313.57,404,0)
REVERSAL REASON^F^^4;4^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.57,9002313.57,404,3)
Answer must be 1-40 characters in length
"^DD",9002313.57,9002313.57,404,21,0)
^^1^1^3050525^
"^DD",9002313.57,9002313.57,404,21,1,0)
Reason for the reversal
"^DD",9002313.57,9002313.57,404,"DT")
3050525
"^DD",9002313.57,9002313.57,501,0)
QUANTITY^NJ12,3^^5;1^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."4N.N) X
"^DD",9002313.57,9002313.57,501,3)
Type a Number between 0 and 99999999, 3 Decimal Digits
"^DD",9002313.57,9002313.57,501,21,0)
^^6^6^3031217^
"^DD",9002313.57,9002313.57,501,21,1,0)
These 500-599 fields, stored in ^(5), hold a
"^DD",9002313.57,9002313.57,501,21,2,0)
temporary copy of the pricing data as
"^DD",9002313.57,9002313.57,501,21,3,0)
calculated in ^BPSOSQP.  Then later, when the
"^DD",9002313.57,9002313.57,501,21,4,0)
BPS() array is being set up in BPSECC*,
"^DD",9002313.57,9002313.57,501,21,5,0)
appropriate values can be lifted from here,
"^DD",9002313.57,9002313.57,501,21,6,0)
rather than being recalculated.  
"^DD",9002313.57,9002313.57,501,"DT")
3000418
"^DD",9002313.57,9002313.57,502,0)
UNIT PRICE^NJ18,8^^5;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."9N.N) X
"^DD",9002313.57,9002313.57,502,3)
Type a Number between 0 and 999999999, 8 Decimal Digits
"^DD",9002313.57,9002313.57,502,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,502,21,1,0)
Price per unit of prescription.
"^DD",9002313.57,9002313.57,502,"DT")
3000418
"^DD",9002313.57,9002313.57,503,0)
SUBTOTAL^NJ18,8^^5;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."9N.N) X
"^DD",9002313.57,9002313.57,503,3)
Type a Number between 0 and 999999999, 8 Decimal Digits
"^DD",9002313.57,9002313.57,503,21,0)
^^3^3^3031217^
"^DD",9002313.57,9002313.57,503,21,1,0)
= QUANTITY * UNIT PRICE This is what
"^DD",9002313.57,9002313.57,503,21,2,0)
we want to send as the INGREDIENT COST 
"^DD",9002313.57,9002313.57,503,21,3,0)
field in the NCPDP message.
"^DD",9002313.57,9002313.57,503,"DT")
3000418
"^DD",9002313.57,9002313.57,504,0)
DISPENSING FEE^NJ6,2^^5;4^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>100)!(X<0) X
"^DD",9002313.57,9002313.57,504,3)
Type a Dollar Amount between 0 and 100, 2 Decimal Digits
"^DD",9002313.57,9002313.57,504,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,504,21,1,0)
Service fee the pharmacy charges for dispensing the drug.
"^DD",9002313.57,9002313.57,504,"DT")
3000418
"^DD",9002313.57,9002313.57,505,0)
TOTAL PRICE^NJ12,2^^5;5^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",9002313.57,9002313.57,505,3)
Type a Number between 0 and 999999999, 2 Decimal Digits
"^DD",9002313.57,9002313.57,505,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,505,21,1,0)
=SUBTOTAL + DISPENSING FEE
"^DD",9002313.57,9002313.57,505,"DT")
3000418
"^DD",9002313.57,9002313.57,506,0)
PRICE MANUALLY ENTERED^S^1:YES;0:NO;^5;6^Q
"^DD",9002313.57,9002313.57,506,21,0)
^^4^4^3031217^
"^DD",9002313.57,9002313.57,506,21,1,0)
FUTURE:  set this to 1 if the pricing was manually entered.  This may be
"^DD",9002313.57,9002313.57,506,21,2,0)
of use if you are rolling to the next insurer and want to know whether or
"^DD",9002313.57,9002313.57,506,21,3,0)
not to erase the prices and recompute, just in case there are multiple
"^DD",9002313.57,9002313.57,506,21,4,0)
pricing tables in use.
"^DD",9002313.57,9002313.57,506,"DT")
3010330
"^DD",9002313.57,9002313.57,601,0)
PINS 1^F^^6;1^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.57,9002313.57,601,3)
Answer must be 1-20 characters in length.
"^DD",9002313.57,9002313.57,601,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,601,21,1,0)
Primary insurance
"^DD",9002313.57,9002313.57,601,"DT")
3000418
"^DD",9002313.57,9002313.57,602,0)
PINS 2^F^^6;2^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.57,9002313.57,602,3)
Answer must be 1-20 characters in length.
"^DD",9002313.57,9002313.57,602,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,602,21,1,0)
Secondary insurance
"^DD",9002313.57,9002313.57,602,"DT")
3000418
"^DD",9002313.57,9002313.57,603,0)
PINS 3^F^^6;3^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.57,9002313.57,603,3)
Answer must be 1-20 characters in length.
"^DD",9002313.57,9002313.57,603,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,603,21,1,0)
Tertiary Insurance
"^DD",9002313.57,9002313.57,603,"DT")
3000418
"^DD",9002313.57,9002313.57,701,0)
INSURER 1^P9002313.4'^BPSEI(^7;1^Q
"^DD",9002313.57,9002313.57,701,21,0)
^^3^3^3040428^
"^DD",9002313.57,9002313.57,701,21,1,0)
The first insurer listed for this Patient.  This field points to the BPS 
"^DD",9002313.57,9002313.57,701,21,2,0)
INSURER file (#9002313.4).  Since ECME uses the insurance from Integrated 
"^DD",9002313.57,9002313.57,701,21,3,0)
Billing (IB) this field will not be used by ECME.
"^DD",9002313.57,9002313.57,701,"DT")
3040428
"^DD",9002313.57,9002313.57,702,0)
INSURER 2^P9002313.4^BPSEI(^7;2^Q
"^DD",9002313.57,9002313.57,702,21,0)
^^3^3^3040428^
"^DD",9002313.57,9002313.57,702,21,1,0)
The second insurer listed for this Patient.  This field points to the BPS 
"^DD",9002313.57,9002313.57,702,21,2,0)
INSURER file (#9002313.4).  Since ECME uses the insurance from Integrated 
"^DD",9002313.57,9002313.57,702,21,3,0)
Billing (IB) this field will not be used by ECME.
"^DD",9002313.57,9002313.57,702,"DT")
3040428
"^DD",9002313.57,9002313.57,703,0)
INSURER 3^P9002313.4'^BPSEI(^7;3^Q
"^DD",9002313.57,9002313.57,703,21,0)
^^3^3^3040428^
"^DD",9002313.57,9002313.57,703,21,1,0)
The third insurer listed for this Patient.  This field points to the BPS 
"^DD",9002313.57,9002313.57,703,21,2,0)
INSURER file (#9002313.4).  Since ECME uses the insurance from Integrated 
"^DD",9002313.57,9002313.57,703,21,3,0)
Billing (IB) this field will not be used by ECME.
"^DD",9002313.57,9002313.57,703,"DT")
3040428
"^DD",9002313.57,9002313.57,801,0)
RETRY AFTER^D^^8;1^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57,801,21,0)
^^3^3^3031217^
"^DD",9002313.57,9002313.57,801,21,1,0)
 Due to dial out error or insurer asleep, retry this claim no earlier than
"^DD",9002313.57,9002313.57,801,21,2,0)
this time.  (May provide some way to poke it into activity, overriding
"^DD",9002313.57,9002313.57,801,21,3,0)
this.) 
"^DD",9002313.57,9002313.57,801,"DT")
3010330
"^DD",9002313.57,9002313.57,802,0)
RETRY ON DIAL OUT^S^0:NO;1:YES;^8;2^Q
"^DD",9002313.57,9002313.57,802,3)

"^DD",9002313.57,9002313.57,802,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,802,21,1,0)
not used by VA
"^DD",9002313.57,9002313.57,802,"DT")
3031216
"^DD",9002313.57,9002313.57,803,0)
RETRY SLEEPING INSURER^P9002313.4'^BPSEI(^8;3^Q
"^DD",9002313.57,9002313.57,803,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,803,21,1,0)
Pointer to insurer file, not used by VA
"^DD",9002313.57,9002313.57,803,"DT")
3010330
"^DD",9002313.57,9002313.57,901,0)
CURRENT VA INSURER^F^^9;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.57,9002313.57,901,3)
Answer must be 1-15 characters in length.
"^DD",9002313.57,9002313.57,901,21,0)
^^2^2^3040331^
"^DD",9002313.57,9002313.57,901,21,1,0)
This field is used for the 1st patient insurance for a VA prescri
"^DD",9002313.57,9002313.57,901,21,2,0)
and it points to the payer sheet to use.
"^DD",9002313.57,9002313.57,901,"DT")
3040331
"^DD",9002313.57,9002313.57,902,0)
VA PINS MULTIPLE^9002313.57902PA^^10;0
"^DD",9002313.57,9002313.57,902,21,0)
^.001^1^1^3041014^^^^
"^DD",9002313.57,9002313.57,902,21,1,0)
List of VA insurers
"^DD",9002313.57,9002313.57,1201,0)
RX ACTION^F^^12;1^K:$L(X)>4!($L(X)<1) X
"^DD",9002313.57,9002313.57,1201,3)
Answer must be 1-4 characters in length
"^DD",9002313.57,9002313.57,1201,21,0)
^^3^3^3050629^
"^DD",9002313.57,9002313.57,1201,21,1,0)
This is the BWHERE parameter passed into BPSNCPDP and is the action
"^DD",9002313.57,9002313.57,1201,21,2,0)
that is being performed on this RX (AREV, BB, CRLB, CRLR, CRLX, DC, DDED,
"^DD",9002313.57,9002313.57,1201,21,3,0)
DE, ED, ERES, EREV, OF, PC, PE, PL, PP, RF, RL, RN, RRL, and RS).
"^DD",9002313.57,9002313.57,1201,"DT")
3050629
"^DD",9002313.57,9002313.57,1202,0)
DATE OF SERVICE^D^^12;2^S %DT="E" D ^%DT S X=Y K:X<1 X
"^DD",9002313.57,9002313.57,1202,3)
(No range limit on date)
"^DD",9002313.57,9002313.57,1202,21,0)
^^1^1^3050525^
"^DD",9002313.57,9002313.57,1202,21,1,0)
Date used for the 401-D1 (DATE OF SERVICE) in the NCPDP transaction
"^DD",9002313.57,9002313.57,1202,"DT")
3050525
"^DD",9002313.57,9002313.57,1300,0)
DUR DATA^9002313.5713^^13;0
"^DD",9002313.57,9002313.57,1300,21,0)
^^3^3^3050628^
"^DD",9002313.57,9002313.57,1300,21,1,0)
This multiple will track the Drug Utilization Review (DUR) information
"^DD",9002313.57,9002313.57,1300,21,2,0)
passed by Outpatient Pharmacy to ECME and that will eventually be put
"^DD",9002313.57,9002313.57,1300,21,3,0)
in the DUR segment of the NCPDP claim.
"^DD",9002313.57,9002313.57,9999.92,0)
HRN & FAC^CJ16^^ ; ^N IEN57 S IEN57=D0,X=$$HRN^BPSOS57
"^DD",9002313.57,9002313.57,9999.92,9)
^
"^DD",9002313.57,9002313.57,9999.92,9.01)

"^DD",9002313.57,9002313.57,9999.92,9.1)
N IEN57 S IEN57=D0,X=$$HRN^BPSOS57
"^DD",9002313.57,9002313.57,9999.92,21,0)
^^2^2^3040331^
"^DD",9002313.57,9002313.57,9999.92,21,1,0)
Health record number and faciltity ID - this is set to 
"^DD",9002313.57,9002313.57,9999.92,21,2,0)
the pointer to the patient file and the division.
"^DD",9002313.57,9002313.57,9999.92,"DT")
3040331
"^DD",9002313.57,9002313.57,9999.93,0)
DRUG NAME^CJ30^^ ; ^N IEN57 S IEN57=D0,X=$$DRGNAME^BPSOS57
"^DD",9002313.57,9002313.57,9999.93,9)
^
"^DD",9002313.57,9002313.57,9999.93,9.01)

"^DD",9002313.57,9002313.57,9999.93,9.1)
N IEN57 S IEN57=D0,X=$$DRGNAME^BPSOS57
"^DD",9002313.57,9002313.57,9999.93,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.93,21,1,0)
Drug name from file 50
"^DD",9002313.57,9002313.57,9999.94,0)
DRUG IEN^CJ8^^ ; ^N IEN57 S IEN57=D0,X=$$DRGDFN^BPSOS57
"^DD",9002313.57,9002313.57,9999.94,9)
^
"^DD",9002313.57,9002313.57,9999.94,9.01)

"^DD",9002313.57,9002313.57,9999.94,9.1)
N IEN57 S IEN57=D0,X=$$DRGDFN^BPSOS57
"^DD",9002313.57,9002313.57,9999.94,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.94,21,1,0)
The IEN of the drug from file 50.
"^DD",9002313.57,9002313.57,9999.95,0)
RELEASED DATE/TIME (INT)^CJ14^^ ; ^N IEN57 S IEN57=D0,X=$$RELDATE^BPSOS57
"^DD",9002313.57,9002313.57,9999.95,9)
^
"^DD",9002313.57,9002313.57,9999.95,9.01)

"^DD",9002313.57,9002313.57,9999.95,9.1)
N IEN57 S IEN57=D0,X=$$RELDATE^BPSOS57
"^DD",9002313.57,9002313.57,9999.95,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.95,21,1,0)
Release date and time from the prescription file, 52.
"^DD",9002313.57,9002313.57,9999.95,"DT")
3010410
"^DD",9002313.57,9002313.57,9999.96,0)
NET PAID BY INSURER^CJ8^^ ; ^N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.57,9002313.57,9999.96,9)
^
"^DD",9002313.57,9002313.57,9999.96,9.01)

"^DD",9002313.57,9002313.57,9999.96,9.1)
N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.57,9002313.57,9999.96,21,0)
^^1^1^3040331^
"^DD",9002313.57,9002313.57,9999.96,21,1,0)
Amount paid after the discounts and deductible have been subtracted.
"^DD",9002313.57,9002313.57,9999.96,"DT")
3040331
"^DD",9002313.57,9002313.57,9999.97,0)
ELAPSED TIME (PRINTABLE)^CJ20^^ ; ^S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIF^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.97,9)
^
"^DD",9002313.57,9002313.57,9999.97,9.01)

"^DD",9002313.57,9002313.57,9999.97,9.1)
S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIF^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.97,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.97,21,1,0)
Elapsed time between submission and response in external format.
"^DD",9002313.57,9002313.57,9999.97,"DT")
3010206
"^DD",9002313.57,9002313.57,9999.98,0)
ELAPSED TIME (SECONDS)^CJ8^^ ; ^S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIFI^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.98,9)
^
"^DD",9002313.57,9002313.57,9999.98,9.01)

"^DD",9002313.57,9002313.57,9999.98,9.1)
S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIFI^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.98,21,0)
^^2^2^3040331^
"^DD",9002313.57,9002313.57,9999.98,21,1,0)
Elapsed time between submission and repsonse expressed as a number of 
"^DD",9002313.57,9002313.57,9999.98,21,2,0)
seconds.
"^DD",9002313.57,9002313.57,9999.98,"DT")
3040331
"^DD",9002313.57,9002313.57,9999.99,0)
RESULT CATEGORY^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,9999.99,9)
^
"^DD",9002313.57,9002313.57,9999.99,9.01)

"^DD",9002313.57,9002313.57,9999.99,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,9999.99,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,9999.99,21,1,0)
The category of the transmission - accepted, payable, rejected, etc.
"^DD",9002313.57,9002313.57,9999.99,"DT")
3001115
"^DD",9002313.57,9002313.57,10101,0)
BIN NUMBER^CJ6^^ ; ^S X=$$FIELD^BPSOS57(101)
"^DD",9002313.57,9002313.57,10101,9)
^
"^DD",9002313.57,9002313.57,10101,9.01)

"^DD",9002313.57,9002313.57,10101,9.1)
S X=$$FIELD^BPSOS57(101)
"^DD",9002313.57,9002313.57,10101,21,0)
^^1^1^3040322^
"^DD",9002313.57,9002313.57,10101,21,1,0)
BIN number from the response file.
"^DD",9002313.57,9002313.57,10102,0)
VERSION/RELEASE NUMBER^CJ2^^ ; ^S X=$$FIELD^BPSOS57(102)
"^DD",9002313.57,9002313.57,10102,9)
^
"^DD",9002313.57,9002313.57,10102,9.01)

"^DD",9002313.57,9002313.57,10102,9.1)
S X=$$FIELD^BPSOS57(102)
"^DD",9002313.57,9002313.57,10102,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10102,21,1,0)
Version/release number from the BPS claims file.
"^DD",9002313.57,9002313.57,10103,0)
TRANSACTION CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(103)
"^DD",9002313.57,9002313.57,10103,9)
^
"^DD",9002313.57,9002313.57,10103,9.01)

"^DD",9002313.57,9002313.57,10103,9.1)
S X=$$FIELD^BPSOS57(103)
"^DD",9002313.57,9002313.57,10103,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10103,21,1,0)
Type of transaction from the claim file.
"^DD",9002313.57,9002313.57,10104,0)
PROCESSOR CONTROL NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(104)
"^DD",9002313.57,9002313.57,10104,9)
^
"^DD",9002313.57,9002313.57,10104,9.01)

"^DD",9002313.57,9002313.57,10104,9.1)
S X=$$FIELD^BPSOS57(104)
"^DD",9002313.57,9002313.57,10104,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10104,21,1,0)
PCN number from the claims file.
"^DD",9002313.57,9002313.57,10201,0)
PHARMACY NUMBER^CJ12^^ ; ^S X=$$FIELD^BPSOS57(201)
"^DD",9002313.57,9002313.57,10201,9)
^
"^DD",9002313.57,9002313.57,10201,9.01)

"^DD",9002313.57,9002313.57,10201,9.1)
S X=$$FIELD^BPSOS57(201)
"^DD",9002313.57,9002313.57,10201,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10201,21,1,0)
The Pharmacy's NABP number from the claims file.
"^DD",9002313.57,9002313.57,10301,0)
GROUP NUMBER^CJ15^^ ; ^S X=$$FIELD^BPSOS57(301)
"^DD",9002313.57,9002313.57,10301,9)
^
"^DD",9002313.57,9002313.57,10301,9.01)

"^DD",9002313.57,9002313.57,10301,9.1)
S X=$$FIELD^BPSOS57(301)
"^DD",9002313.57,9002313.57,10301,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10301,21,1,0)
The group number of the insurance used from the BPS claims file.
"^DD",9002313.57,9002313.57,10302,0)
CARDHOLDER ID NUMBER^CJ18^^ ; ^S X=$$FIELD^BPSOS57(302)
"^DD",9002313.57,9002313.57,10302,9)
^
"^DD",9002313.57,9002313.57,10302,9.01)

"^DD",9002313.57,9002313.57,10302,9.1)
S X=$$FIELD^BPSOS57(302)
"^DD",9002313.57,9002313.57,10302,21,0)
^^2^2^3040322^
"^DD",9002313.57,9002313.57,10302,21,1,0)
The insured person's cardholder identification number from the claims 
"^DD",9002313.57,9002313.57,10302,21,2,0)
file.
"^DD",9002313.57,9002313.57,10302,"DT")
3040322
"^DD",9002313.57,9002313.57,10303,0)
PERSON CODE^CJ3^^ ; ^S X=$$FIELD^BPSOS57(303)
"^DD",9002313.57,9002313.57,10303,9)
^
"^DD",9002313.57,9002313.57,10303,9.01)

"^DD",9002313.57,9002313.57,10303,9.1)
S X=$$FIELD^BPSOS57(303)
"^DD",9002313.57,9002313.57,10303,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10303,21,1,0)
The person code from the BPS claims file.
"^DD",9002313.57,9002313.57,10304,0)
DATE OF BIRTH^CJ8^^ ; ^S X=$$FIELD^BPSOS57(304)
"^DD",9002313.57,9002313.57,10304,9)
^
"^DD",9002313.57,9002313.57,10304,9.01)

"^DD",9002313.57,9002313.57,10304,9.1)
S X=$$FIELD^BPSOS57(304)
"^DD",9002313.57,9002313.57,10304,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10304,21,1,0)
Date of birth of the patient from the BPS claims file.
"^DD",9002313.57,9002313.57,10305,0)
SEX CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(305)
"^DD",9002313.57,9002313.57,10305,9)
^
"^DD",9002313.57,9002313.57,10305,9.01)

"^DD",9002313.57,9002313.57,10305,9.1)
S X=$$FIELD^BPSOS57(305)
"^DD",9002313.57,9002313.57,10305,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10305,21,1,0)
Sex of the patient, "M" or "F"
"^DD",9002313.57,9002313.57,10306,0)
RELATIONSHIP CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(306)
"^DD",9002313.57,9002313.57,10306,9)
^
"^DD",9002313.57,9002313.57,10306,9.01)

"^DD",9002313.57,9002313.57,10306,9.1)
S X=$$FIELD^BPSOS57(306)
"^DD",9002313.57,9002313.57,10306,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10306,21,1,0)
Relationship of the patient to the insured - from the BPS claims file.
"^DD",9002313.57,9002313.57,10307,0)
CUSTOMER LOCATION^CJ2^^ ; ^S X=$$FIELD^BPSOS57(307)
"^DD",9002313.57,9002313.57,10307,9)
^
"^DD",9002313.57,9002313.57,10307,9.01)

"^DD",9002313.57,9002313.57,10307,9.1)
S X=$$FIELD^BPSOS57(307)
"^DD",9002313.57,9002313.57,10307,21,0)
^^6^6^3031222^
"^DD",9002313.57,9002313.57,10307,21,1,0)
Code identifying the location of the patient when receiving pharmacy
"^DD",9002313.57,9002313.57,10307,21,2,0)
services.  =Not Specified 1=Home 2=Inter-Care 3=Nursing Home 4=Long
"^DD",9002313.57,9002313.57,10307,21,3,0)
Term/Extended Care 5=Rest Home 6=Boarding Home 7=Skilled Care Facility
"^DD",9002313.57,9002313.57,10307,21,4,0)
8=Sub-Acute Care Facility 9=Acute Care Facility 1=Outpatient 11=Hospice
"^DD",9002313.57,9002313.57,10307,21,5,0)
 
"^DD",9002313.57,9002313.57,10307,21,6,0)
from the BPS claims file
"^DD",9002313.57,9002313.57,10308,0)
OTHER COVERAGE CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(308)
"^DD",9002313.57,9002313.57,10308,9)
^
"^DD",9002313.57,9002313.57,10308,9.01)

"^DD",9002313.57,9002313.57,10308,9.1)
S X=$$FIELD^BPSOS57(308)
"^DD",9002313.57,9002313.57,10308,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10308,21,1,0)
Code indicating whether or not the patient has other insurance coverage.
"^DD",9002313.57,9002313.57,10309,0)
ELIGIBILITY CLARIFICATION CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(309)
"^DD",9002313.57,9002313.57,10309,9)
^
"^DD",9002313.57,9002313.57,10309,9.01)

"^DD",9002313.57,9002313.57,10309,9.1)
S X=$$FIELD^BPSOS57(309)
"^DD",9002313.57,9002313.57,10309,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10309,21,1,0)
Code indicating that the pharmacy is clarifying eligibility based on
"^DD",9002313.57,9002313.57,10309,21,2,0)
receiving a denial. Comes from the BPS claims file.  
"^DD",9002313.57,9002313.57,10310,0)
PATIENT FIRST NAME^CJ12^^ ; ^S X=$$FIELD^BPSOS57(310)
"^DD",9002313.57,9002313.57,10310,9)
^
"^DD",9002313.57,9002313.57,10310,9.01)

"^DD",9002313.57,9002313.57,10310,9.1)
S X=$$FIELD^BPSOS57(310)
"^DD",9002313.57,9002313.57,10310,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10310,21,1,0)
First name of patient receiving the prescription, from the BPS claims 
"^DD",9002313.57,9002313.57,10310,21,2,0)
file.
"^DD",9002313.57,9002313.57,10311,0)
PATIENT LAST NAME^CJ15^^ ; ^S X=$$FIELD^BPSOS57(311)
"^DD",9002313.57,9002313.57,10311,9)
^
"^DD",9002313.57,9002313.57,10311,9.01)

"^DD",9002313.57,9002313.57,10311,9.1)
S X=$$FIELD^BPSOS57(311)
"^DD",9002313.57,9002313.57,10311,21,0)
^^1^1^3040331^
"^DD",9002313.57,9002313.57,10311,21,1,0)
Last Name of patient receiving the prescripion from the BPS claims file.
"^DD",9002313.57,9002313.57,10311,"DT")
3040331
"^DD",9002313.57,9002313.57,10312,0)
CARDHOLDER FIRST NAME^CJ12^^ ; ^S X=$$FIELD^BPSOS57(312)
"^DD",9002313.57,9002313.57,10312,9)
^
"^DD",9002313.57,9002313.57,10312,9.01)

"^DD",9002313.57,9002313.57,10312,9.1)
S X=$$FIELD^BPSOS57(312)
"^DD",9002313.57,9002313.57,10312,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10312,21,1,0)
First name of the Cardholder/Subscriber from the BPS claims file.
"^DD",9002313.57,9002313.57,10313,0)
CARDHOLDER LAST NAME^CJ15^^ ; ^S X=$$FIELD^BPSOS57(313)
"^DD",9002313.57,9002313.57,10313,9)
^
"^DD",9002313.57,9002313.57,10313,9.01)

"^DD",9002313.57,9002313.57,10313,9.1)
S X=$$FIELD^BPSOS57(313)
"^DD",9002313.57,9002313.57,10313,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10313,21,1,0)
Last name of the Cardholder/Subscriber from the BPS claims file. 
"^DD",9002313.57,9002313.57,10314,0)
HOME PLAN^CJ3^^ ; ^S X=$$FIELD^BPSOS57(314)
"^DD",9002313.57,9002313.57,10314,9)
^
"^DD",9002313.57,9002313.57,10314,9.01)

"^DD",9002313.57,9002313.57,10314,9.1)
S X=$$FIELD^BPSOS57(314)
"^DD",9002313.57,9002313.57,10314,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10314,21,1,0)
Code identifying the Blue Cross or Blue Shield plan ID which indicates
"^DD",9002313.57,9002313.57,10314,21,2,0)
where the member's coverage has been designated. Usually where the member
"^DD",9002313.57,9002313.57,10314,21,3,0)
lives or purchased their coverage from the BPS claims file.
"^DD",9002313.57,9002313.57,10315,0)
EMPLOYER NAME^CJ30^^ ; ^S X=$$FIELD^BPSOS57(315)
"^DD",9002313.57,9002313.57,10315,9)
^
"^DD",9002313.57,9002313.57,10315,9.01)

"^DD",9002313.57,9002313.57,10315,9.1)
S X=$$FIELD^BPSOS57(315)
"^DD",9002313.57,9002313.57,10315,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10315,21,1,0)
Complete name of employer. 
"^DD",9002313.57,9002313.57,10316,0)
EMPLOYER STREET ADDRESS^CJ30^^ ; ^S X=$$FIELD^BPSOS57(316)
"^DD",9002313.57,9002313.57,10316,9)
^
"^DD",9002313.57,9002313.57,10316,9.01)

"^DD",9002313.57,9002313.57,10316,9.1)
S X=$$FIELD^BPSOS57(316)
"^DD",9002313.57,9002313.57,10316,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10316,21,1,0)
Free-form text for address information from the claims file.
"^DD",9002313.57,9002313.57,10317,0)
EMPLOYER CITY ADDRESS^CJ20^^ ; ^S X=$$FIELD^BPSOS57(317)
"^DD",9002313.57,9002313.57,10317,9)
^
"^DD",9002313.57,9002313.57,10317,9.01)

"^DD",9002313.57,9002313.57,10317,9.1)
S X=$$FIELD^BPSOS57(317)
"^DD",9002313.57,9002313.57,10317,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10317,21,1,0)
Free-form text for city name.
"^DD",9002313.57,9002313.57,10318,0)
EMPLOYER STATE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(318)
"^DD",9002313.57,9002313.57,10318,9)
^
"^DD",9002313.57,9002313.57,10318,9.01)

"^DD",9002313.57,9002313.57,10318,9.1)
S X=$$FIELD^BPSOS57(318)
"^DD",9002313.57,9002313.57,10318,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10318,21,1,0)
Standard State/Province Code as defined by appropriate government agency.
"^DD",9002313.57,9002313.57,10319,0)
EMPLOYER ZIP CODE^CJ9^^ ; ^S X=$$FIELD^BPSOS57(319)
"^DD",9002313.57,9002313.57,10319,9)
^
"^DD",9002313.57,9002313.57,10319,9.01)

"^DD",9002313.57,9002313.57,10319,9.1)
S X=$$FIELD^BPSOS57(319)
"^DD",9002313.57,9002313.57,10319,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10319,21,1,0)
Code defining international postal zone excluding punctuation and blanks
"^DD",9002313.57,9002313.57,10319,21,2,0)
(zip code for US).
"^DD",9002313.57,9002313.57,10320,0)
EMPLOYER PHONE NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(320)
"^DD",9002313.57,9002313.57,10320,9)
^
"^DD",9002313.57,9002313.57,10320,9.01)

"^DD",9002313.57,9002313.57,10320,9.1)
S X=$$FIELD^BPSOS57(320)
"^DD",9002313.57,9002313.57,10320,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10320,21,1,0)
Ten digit phone number of employer.
"^DD",9002313.57,9002313.57,10321,0)
EMPLOYER CONTACT NAME^CJ30^^ ; ^S X=$$FIELD^BPSOS57(321)
"^DD",9002313.57,9002313.57,10321,9)
^
"^DD",9002313.57,9002313.57,10321,9.01)

"^DD",9002313.57,9002313.57,10321,9.1)
S X=$$FIELD^BPSOS57(321)
"^DD",9002313.57,9002313.57,10321,21,0)
^^1^1^3040322^
"^DD",9002313.57,9002313.57,10321,21,1,0)
Contact persons' name of the cardholders' employer.
"^DD",9002313.57,9002313.57,10321,"DT")
3040322
"^DD",9002313.57,9002313.57,10322,0)
PATIENT STREET ADDRESS^CJ30^^ ; ^S X=$$FIELD^BPSOS57(322)
"^DD",9002313.57,9002313.57,10322,9)
^
"^DD",9002313.57,9002313.57,10322,9.01)

"^DD",9002313.57,9002313.57,10322,9.1)
S X=$$FIELD^BPSOS57(322)
"^DD",9002313.57,9002313.57,10322,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10322,21,1,0)
Free-form text for Patient address information.
"^DD",9002313.57,9002313.57,10323,0)
PATIENT CITY ADDRESS^CJ20^^ ; ^S X=$$FIELD^BPSOS57(323)
"^DD",9002313.57,9002313.57,10323,9)
^
"^DD",9002313.57,9002313.57,10323,9.01)

"^DD",9002313.57,9002313.57,10323,9.1)
S X=$$FIELD^BPSOS57(323)
"^DD",9002313.57,9002313.57,10323,21,0)
^.001^1^1^3031222^^
"^DD",9002313.57,9002313.57,10323,21,1,0)
Free-form text for city name.
"^DD",9002313.57,9002313.57,10323,"DT")
3031222
"^DD",9002313.57,9002313.57,10324,0)
PATIENT STATE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(324)
"^DD",9002313.57,9002313.57,10324,9)
^
"^DD",9002313.57,9002313.57,10324,9.01)

"^DD",9002313.57,9002313.57,10324,9.1)
S X=$$FIELD^BPSOS57(324)
"^DD",9002313.57,9002313.57,10324,21,0)
^.001^2^2^3031222^^
"^DD",9002313.57,9002313.57,10324,21,1,0)
Standard State/Province Code as defined by appropriate government agency.
"^DD",9002313.57,9002313.57,10324,21,2,0)
Comes from the BPS claims file.
"^DD",9002313.57,9002313.57,10325,0)
PATIENT ZIP CODE^CJ9^^ ; ^S X=$$FIELD^BPSOS57(325)
"^DD",9002313.57,9002313.57,10325,9)
^
"^DD",9002313.57,9002313.57,10325,9.01)

"^DD",9002313.57,9002313.57,10325,9.1)
S X=$$FIELD^BPSOS57(325)
"^DD",9002313.57,9002313.57,10325,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10325,21,1,0)
Code defining international postal zone excluding punctuation and blanks
"^DD",9002313.57,9002313.57,10325,21,2,0)
(zip code for US). From the BPS claims file.
"^DD",9002313.57,9002313.57,10326,0)
PATIENT PHONE NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(326)
"^DD",9002313.57,9002313.57,10326,9)
^
"^DD",9002313.57,9002313.57,10326,9.01)

"^DD",9002313.57,9002313.57,10326,9.1)
S X=$$FIELD^BPSOS57(326)
"^DD",9002313.57,9002313.57,10326,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10326,21,1,0)
Ten digit  phone number of patient. From the BPS claims file.
"^DD",9002313.57,9002313.57,10327,0)
CARRIER ID NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(327)
"^DD",9002313.57,9002313.57,10327,9)
^
"^DD",9002313.57,9002313.57,10327,9.01)

"^DD",9002313.57,9002313.57,10327,9.1)
S X=$$FIELD^BPSOS57(327)
"^DD",9002313.57,9002313.57,10327,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,10327,21,1,0)
The ID number of the insurance carrier.
"^DD",9002313.57,9002313.57,10328,0)
PATIENT WEIGHT^CJ3^^ ; ^S X=$$FIELD^BPSOS57(328)
"^DD",9002313.57,9002313.57,10328,9)
^
"^DD",9002313.57,9002313.57,10328,9.01)

"^DD",9002313.57,9002313.57,10328,9.1)
S X=$$FIELD^BPSOS57(328)
"^DD",9002313.57,9002313.57,10328,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10328,21,1,0)
Patient's weight from the patient file.
"^DD",9002313.57,9002313.57,10329,0)
PATIENT SSN^CJ9^^ ; ^S X=$$FIELD^BPSOS57(329)
"^DD",9002313.57,9002313.57,10329,9)
^
"^DD",9002313.57,9002313.57,10329,9.01)

"^DD",9002313.57,9002313.57,10329,9.1)
S X=$$FIELD^BPSOS57(329)
"^DD",9002313.57,9002313.57,10329,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10329,21,1,0)
Patient SSN from the claims file.
"^DD",9002313.57,9002313.57,10401,0)
DATE FILLED^CJ8^^ ; ^S X=$$FIELD^BPSOS57(401)
"^DD",9002313.57,9002313.57,10401,9)
^
"^DD",9002313.57,9002313.57,10401,9.01)

"^DD",9002313.57,9002313.57,10401,9.1)
S X=$$FIELD^BPSOS57(401)
"^DD",9002313.57,9002313.57,10401,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10401,21,1,0)
The fill/refill date 
"^DD",9002313.57,9002313.57,10402,0)
PRESCRIPTION NUMBER^CJ7^^ ; ^S X=$$FIELD^BPSOS57(402)
"^DD",9002313.57,9002313.57,10402,9)
^
"^DD",9002313.57,9002313.57,10402,9.01)

"^DD",9002313.57,9002313.57,10402,9.1)
S X=$$FIELD^BPSOS57(402)
"^DD",9002313.57,9002313.57,10402,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10402,21,1,0)
  The first seven digits of the prescription IEN 
"^DD",9002313.57,9002313.57,10403,0)
NEW/REFILL CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(403)
"^DD",9002313.57,9002313.57,10403,9)
^
"^DD",9002313.57,9002313.57,10403,9.01)

"^DD",9002313.57,9002313.57,10403,9.1)
S X=$$FIELD^BPSOS57(403)
"^DD",9002313.57,9002313.57,10403,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10403,21,1,0)
The fill/refill number, starting at 0 for the original fill.
"^DD",9002313.57,9002313.57,10404,0)
METRIC QUANTITY^CJ5^^ ; ^S X=$$FIELD^BPSOS57(404)
"^DD",9002313.57,9002313.57,10404,9)
^
"^DD",9002313.57,9002313.57,10404,9.01)

"^DD",9002313.57,9002313.57,10404,9.1)
S X=$$FIELD^BPSOS57(404)
"^DD",9002313.57,9002313.57,10404,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10404,21,1,0)
Metric quantity of the drug.
"^DD",9002313.57,9002313.57,10405,0)
DAYS SUPPLY^CJ3^^ ; ^S X=$$FIELD^BPSOS57(405)
"^DD",9002313.57,9002313.57,10405,9)
^
"^DD",9002313.57,9002313.57,10405,9.01)

"^DD",9002313.57,9002313.57,10405,9.1)
S X=$$FIELD^BPSOS57(405)
"^DD",9002313.57,9002313.57,10405,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10405,21,1,0)
The actual days supply dispensed.
"^DD",9002313.57,9002313.57,10406,0)
COMPOUND CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(406)
"^DD",9002313.57,9002313.57,10406,9)
^
"^DD",9002313.57,9002313.57,10406,9.01)

"^DD",9002313.57,9002313.57,10406,9.1)
S X=$$FIELD^BPSOS57(406)
"^DD",9002313.57,9002313.57,10406,21,0)
^^2^2^3040331^
"^DD",9002313.57,9002313.57,10406,21,1,0)
Field indicating whether this prescription was a compound (1) or not a
"^DD",9002313.57,9002313.57,10406,21,2,0)
compund (0). 
"^DD",9002313.57,9002313.57,10406,"DT")
3040331
"^DD",9002313.57,9002313.57,10407,0)
NDC NUMBER^CJ11^^ ; ^S X=$$FIELD^BPSOS57(407)
"^DD",9002313.57,9002313.57,10407,9)
^
"^DD",9002313.57,9002313.57,10407,9.01)

"^DD",9002313.57,9002313.57,10407,9.1)
S X=$$FIELD^BPSOS57(407)
"^DD",9002313.57,9002313.57,10407,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10407,21,1,0)
NDC code in our case.
"^DD",9002313.57,9002313.57,10408,0)
DISPENSE AS WRITTEN^CJ1^^ ; ^S X=$$FIELD^BPSOS57(408)
"^DD",9002313.57,9002313.57,10408,9)
^
"^DD",9002313.57,9002313.57,10408,9.01)

"^DD",9002313.57,9002313.57,10408,9.1)
S X=$$FIELD^BPSOS57(408)
"^DD",9002313.57,9002313.57,10408,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10408,21,1,0)
Indicator for whether the prescription was to be dispensed only as
"^DD",9002313.57,9002313.57,10408,21,2,0)
written. 
"^DD",9002313.57,9002313.57,10409,0)
INGREDIENT COST^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(409)
"^DD",9002313.57,9002313.57,10409,9)
^
"^DD",9002313.57,9002313.57,10409,9.01)

"^DD",9002313.57,9002313.57,10409,9.1)
S X=$$FIELD^BPSOS57(409)
"^DD",9002313.57,9002313.57,10409,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10409,21,1,0)
Cost amount for the ingredients of compounds. 
"^DD",9002313.57,9002313.57,10409,"DT")
3010405
"^DD",9002313.57,9002313.57,10410,0)
SALES TAX^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(410)
"^DD",9002313.57,9002313.57,10410,9)
^
"^DD",9002313.57,9002313.57,10410,9.01)

"^DD",9002313.57,9002313.57,10410,9.1)
S X=$$FIELD^BPSOS57(410)
"^DD",9002313.57,9002313.57,10410,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10410,21,1,0)
 Sales Tax charged (not applicable for VA)
"^DD",9002313.57,9002313.57,10411,0)
PRESCRIBER ID^CJ10^^ ; ^S X=$$FIELD^BPSOS57(411)
"^DD",9002313.57,9002313.57,10411,9)
^
"^DD",9002313.57,9002313.57,10411,9.01)

"^DD",9002313.57,9002313.57,10411,9.1)
S X=$$FIELD^BPSOS57(411)
"^DD",9002313.57,9002313.57,10411,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10411,21,1,0)
Prescriber identification number.  
"^DD",9002313.57,9002313.57,10412,0)
DISPENSING FEE SUBMITTED^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(412)
"^DD",9002313.57,9002313.57,10412,9)
^
"^DD",9002313.57,9002313.57,10412,9.01)

"^DD",9002313.57,9002313.57,10412,9.1)
S X=$$FIELD^BPSOS57(412)
"^DD",9002313.57,9002313.57,10412,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10412,21,1,0)
Add-on fee charged in a retail setting.  This field will probably be used
"^DD",9002313.57,9002313.57,10412,21,2,0)
when the Tricare functionality is added.
"^DD",9002313.57,9002313.57,10414,0)
DATE PRESCRIPTION WRITTEN^CJ8^^ ; ^S X=$$FIELD^BPSOS57(414)
"^DD",9002313.57,9002313.57,10414,9)
^
"^DD",9002313.57,9002313.57,10414,9.01)

"^DD",9002313.57,9002313.57,10414,9.1)
S X=$$FIELD^BPSOS57(414)
"^DD",9002313.57,9002313.57,10414,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10414,21,1,0)
This will be the fill/refill date for local fills, the released date for
"^DD",9002313.57,9002313.57,10414,21,2,0)
CMOP.
"^DD",9002313.57,9002313.57,10415,0)
NUMBER OF REFILLS AUTHORIZED^CJ2^^ ; ^S X=$$FIELD^BPSOS57(415)
"^DD",9002313.57,9002313.57,10415,9)
^
"^DD",9002313.57,9002313.57,10415,9.01)

"^DD",9002313.57,9002313.57,10415,9.1)
S X=$$FIELD^BPSOS57(415)
"^DD",9002313.57,9002313.57,10415,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10415,21,1,0)
The number of refills allowed that was entered during order entry.
"^DD",9002313.57,9002313.57,10416,0)
PRIOR AUTH/MC CODE AND NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(416)
"^DD",9002313.57,9002313.57,10416,9)
^
"^DD",9002313.57,9002313.57,10416,9.01)

"^DD",9002313.57,9002313.57,10416,9.1)
S X=$$FIELD^BPSOS57(416)
"^DD",9002313.57,9002313.57,10416,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10416,21,1,0)
 Not used for VA - left in for IHS 
"^DD",9002313.57,9002313.57,10418,0)
LEVEL OF SERVICE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(418)
"^DD",9002313.57,9002313.57,10418,9)
^
"^DD",9002313.57,9002313.57,10418,9.01)

"^DD",9002313.57,9002313.57,10418,9.1)
S X=$$FIELD^BPSOS57(418)
"^DD",9002313.57,9002313.57,10418,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10418,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.57,9002313.57,10419,0)
PRESCRIPTION ORIGIN CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(419)
"^DD",9002313.57,9002313.57,10419,9)
^
"^DD",9002313.57,9002313.57,10419,9.01)

"^DD",9002313.57,9002313.57,10419,9.1)
S X=$$FIELD^BPSOS57(419)
"^DD",9002313.57,9002313.57,10419,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10419,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.57,9002313.57,10420,0)
PRESCRIPTION CLARIFICATION^CJ2^^ ; ^S X=$$FIELD^BPSOS57(420)
"^DD",9002313.57,9002313.57,10420,9)
^
"^DD",9002313.57,9002313.57,10420,9.01)

"^DD",9002313.57,9002313.57,10420,9.1)
S X=$$FIELD^BPSOS57(420)
"^DD",9002313.57,9002313.57,10420,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10420,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.57,9002313.57,10421,0)
PRIMARY PRESCRIBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(421)
"^DD",9002313.57,9002313.57,10421,9)
^
"^DD",9002313.57,9002313.57,10421,9.01)

"^DD",9002313.57,9002313.57,10421,9.1)
S X=$$FIELD^BPSOS57(421)
"^DD",9002313.57,9002313.57,10421,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10421,21,1,0)
Provider ID number
"^DD",9002313.57,9002313.57,10422,0)
CLINIC ID NUMBER^CJ5^^ ; ^S X=$$FIELD^BPSOS57(422)
"^DD",9002313.57,9002313.57,10422,9)
^
"^DD",9002313.57,9002313.57,10422,9.01)

"^DD",9002313.57,9002313.57,10422,9.1)
S X=$$FIELD^BPSOS57(422)
"^DD",9002313.57,9002313.57,10422,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10422,21,1,0)
Clinic ID where the prescription was entered.
"^DD",9002313.57,9002313.57,10423,0)
BASIS OF COST DETERMINATION^CJ2^^ ; ^S X=$$FIELD^BPSOS57(423)
"^DD",9002313.57,9002313.57,10423,9)
^
"^DD",9002313.57,9002313.57,10423,9.01)

"^DD",9002313.57,9002313.57,10423,9.1)
S X=$$FIELD^BPSOS57(423)
"^DD",9002313.57,9002313.57,10423,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10423,21,1,0)
How the amount charged was arrived at.
"^DD",9002313.57,9002313.57,10424,0)
DIAGNOSIS CODE^CJ6^^ ; ^S X=$$FIELD^BPSOS57(424)
"^DD",9002313.57,9002313.57,10424,9)
^
"^DD",9002313.57,9002313.57,10424,9.01)

"^DD",9002313.57,9002313.57,10424,9.1)
S X=$$FIELD^BPSOS57(424)
"^DD",9002313.57,9002313.57,10424,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10424,21,1,0)
Diagnosis code that applies to this prescription.  Not used for third
"^DD",9002313.57,9002313.57,10424,21,2,0)
party billing as of this date - so it is not used, but may be used in the
"^DD",9002313.57,9002313.57,10424,21,3,0)
future.  
"^DD",9002313.57,9002313.57,10425,0)
DRUG TYPE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(425)
"^DD",9002313.57,9002313.57,10425,9)
^
"^DD",9002313.57,9002313.57,10425,9.01)

"^DD",9002313.57,9002313.57,10425,9.1)
S X=$$FIELD^BPSOS57(425)
"^DD",9002313.57,9002313.57,10425,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10425,21,1,0)
Code to indicate the type of drug dispensed.  =Not specified 1=Single
"^DD",9002313.57,9002313.57,10425,21,2,0)
source brand 2=Branded generic 3=Generic 4=O.T.C. (over the counter)
"^DD",9002313.57,9002313.57,10426,0)
USUAL AND CUSTOMARY CHARGE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(426)
"^DD",9002313.57,9002313.57,10426,9)
^
"^DD",9002313.57,9002313.57,10426,9.01)

"^DD",9002313.57,9002313.57,10426,9.1)
S X=$$FIELD^BPSOS57(426)
"^DD",9002313.57,9002313.57,10426,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10426,21,1,0)
Amount charged cash customers for the prescription exclusive of sales tax
"^DD",9002313.57,9002313.57,10426,21,2,0)
or other amounts claimed.
"^DD",9002313.57,9002313.57,10426,"DT")
3010405
"^DD",9002313.57,9002313.57,10427,0)
PRESCRIBER LAST NAME^CJ15^^ ; ^S X=$$FIELD^BPSOS57(427)
"^DD",9002313.57,9002313.57,10427,9)
^
"^DD",9002313.57,9002313.57,10427,9.01)

"^DD",9002313.57,9002313.57,10427,9.1)
S X=$$FIELD^BPSOS57(427)
"^DD",9002313.57,9002313.57,10427,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10427,21,1,0)
Last Name of the Prescriber
"^DD",9002313.57,9002313.57,10428,0)
POSTAGE AMOUNT CLAIMED^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(428)
"^DD",9002313.57,9002313.57,10428,9)
^
"^DD",9002313.57,9002313.57,10428,9.01)

"^DD",9002313.57,9002313.57,10428,9.1)
S X=$$FIELD^BPSOS57(428)
"^DD",9002313.57,9002313.57,10428,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10428,21,1,0)
Dollar amount of postage claimed.
"^DD",9002313.57,9002313.57,10429,0)
UNIT DOSE INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(429)
"^DD",9002313.57,9002313.57,10429,9)
^
"^DD",9002313.57,9002313.57,10429,9.01)

"^DD",9002313.57,9002313.57,10429,9.1)
S X=$$FIELD^BPSOS57(429)
"^DD",9002313.57,9002313.57,10429,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10429,21,1,0)
Code indicating the type of unit dose dispensing. =Not Specified 1=Not
"^DD",9002313.57,9002313.57,10429,21,2,0)
Unit Dose 2=Manufacturer Unit Dose 3=Pharmacy Unit Dose
"^DD",9002313.57,9002313.57,10430,0)
GROSS AMOUNT DUE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(430)
"^DD",9002313.57,9002313.57,10430,9)
^
"^DD",9002313.57,9002313.57,10430,9.01)

"^DD",9002313.57,9002313.57,10430,9.1)
S X=$$FIELD^BPSOS57(430)
"^DD",9002313.57,9002313.57,10430,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10430,21,1,0)
Total amount submitted to the payer. 
"^DD",9002313.57,9002313.57,10431,0)
OTHER PAYOR AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(431)
"^DD",9002313.57,9002313.57,10431,9)
^
"^DD",9002313.57,9002313.57,10431,9.01)

"^DD",9002313.57,9002313.57,10431,9.1)
S X=$$FIELD^BPSOS57(431)
"^DD",9002313.57,9002313.57,10431,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10431,21,1,0)
Amount of any payment known by the pharmacy from other sources (including
"^DD",9002313.57,9002313.57,10431,21,2,0)
coupons).
"^DD",9002313.57,9002313.57,10432,0)
BASIS OF DAYS SUPPLY DET^CJ1^^ ; ^S X=$$FIELD^BPSOS57(432)
"^DD",9002313.57,9002313.57,10432,9)
^
"^DD",9002313.57,9002313.57,10432,9.01)

"^DD",9002313.57,9002313.57,10432,9.1)
S X=$$FIELD^BPSOS57(432)
"^DD",9002313.57,9002313.57,10432,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10432,21,1,0)
Code indicating the method by which the days supply was determined. =Not
"^DD",9002313.57,9002313.57,10432,21,2,0)
specified 1=Explicit directions 2=PRN directions (take as needed
"^DD",9002313.57,9002313.57,10432,21,3,0)
pharmacist estimate) 3=As directed by physician
"^DD",9002313.57,9002313.57,10433,0)
PATIENT PAID AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(433)
"^DD",9002313.57,9002313.57,10433,9)
^
"^DD",9002313.57,9002313.57,10433,9.01)

"^DD",9002313.57,9002313.57,10433,9.1)
S X=$$FIELD^BPSOS57(433)
"^DD",9002313.57,9002313.57,10433,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10433,21,1,0)
Amount the pharmacy received from the patient for the prescription
"^DD",9002313.57,9002313.57,10433,21,2,0)
dispensed.
"^DD",9002313.57,9002313.57,10434,0)
DATE OF INJURY^CJ8^^ ; ^S X=$$FIELD^BPSOS57(434)
"^DD",9002313.57,9002313.57,10434,9)
^
"^DD",9002313.57,9002313.57,10434,9.01)

"^DD",9002313.57,9002313.57,10434,9.1)
S X=$$FIELD^BPSOS57(434)
"^DD",9002313.57,9002313.57,10434,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10434,21,1,0)
Date on which the injury occurred. 
"^DD",9002313.57,9002313.57,10435,0)
CLAIM/REF ID NUMBER^CJ14^^ ; ^S X=$$FIELD^BPSOS57(435)
"^DD",9002313.57,9002313.57,10435,9)
^
"^DD",9002313.57,9002313.57,10435,9.01)

"^DD",9002313.57,9002313.57,10435,9.1)
S X=$$FIELD^BPSOS57(435)
"^DD",9002313.57,9002313.57,10435,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10435,21,1,0)
Identifies the claim number assigned by Workers Compensation Program.
"^DD",9002313.57,9002313.57,10436,0)
ALT. PRODUCT TYPE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(436)
"^DD",9002313.57,9002313.57,10436,9)
^
"^DD",9002313.57,9002313.57,10436,9.01)

"^DD",9002313.57,9002313.57,10436,9.1)
S X=$$FIELD^BPSOS57(436)
"^DD",9002313.57,9002313.57,10436,21,0)
^^16^16^3031222^
"^DD",9002313.57,9002313.57,10436,21,1,0)
Code qualifying the value in 'Product/Service ID' (47-D7) Not Specified
"^DD",9002313.57,9002313.57,10436,21,2,0)
Blank Not Specified  Universal Product Code (UPC) 1 Health Related Item
"^DD",9002313.57,9002313.57,10436,21,3,0)
(HRI) 2 National Drug Code (NDC) 3 Universal Product Number (UPN) 4
"^DD",9002313.57,9002313.57,10436,21,4,0)
Department of Defense (DOD) 5 Drug Use Review/ Professional Pharmacy
"^DD",9002313.57,9002313.57,10436,21,5,0)
Service (DUR/PPS) 6 Common Procedure Terminology (CPT4) 7 Common
"^DD",9002313.57,9002313.57,10436,21,6,0)
Procedure Terminology (CPT5) 8 Health Care Financing Administration
"^DD",9002313.57,9002313.57,10436,21,7,0)
Common Procedural Coding System (HCPCS) 9 Pharmacy Practice Activity
"^DD",9002313.57,9002313.57,10436,21,8,0)
Classification (PPAC) 1 National Pharmaceutical Product Interface
"^DD",9002313.57,9002313.57,10436,21,9,0)
Code(NAPPI) 11 International Article Numbering System(EAN) 12 Drug
"^DD",9002313.57,9002313.57,10436,21,10,0)
Identification Number(DIN) 13 Medi-Span GPI 14 First DataBank GCN 15
"^DD",9002313.57,9002313.57,10436,21,11,0)
Medical Economics GPO 16 Medi-Span DDID 17 First DataBank SmartKey 18
"^DD",9002313.57,9002313.57,10436,21,12,0)
Medical Economics GM 19 International Classification of Diseases(ICD9) 2
"^DD",9002313.57,9002313.57,10436,21,13,0)
International Classification of Diseases (ICD10) 21 Medi-Span Diagnosis
"^DD",9002313.57,9002313.57,10436,21,14,0)
Code 22 Common Dental Terminology (CDT) 25 American Psychiatric
"^DD",9002313.57,9002313.57,10436,21,15,0)
Association Diagnostic Statistical Manual of Mental Disorders (DSM IV)
"^DD",9002313.57,9002313.57,10436,21,16,0)
Other       99
"^DD",9002313.57,9002313.57,10437,0)
ALT. PRODUCT CODE^CJ13^^ ; ^S X=$$FIELD^BPSOS57(437)
"^DD",9002313.57,9002313.57,10437,9)
^
"^DD",9002313.57,9002313.57,10437,9.01)

"^DD",9002313.57,9002313.57,10437,9.1)
S X=$$FIELD^BPSOS57(437)
"^DD",9002313.57,9002313.57,10437,21,0)
^^4^4^3031222^
"^DD",9002313.57,9002313.57,10437,21,1,0)
This field identifies the actual product code for the item that was
"^DD",9002313.57,9002313.57,10437,21,2,0)
dispensed.  The type of product is defined by field 436-E1. This field
"^DD",9002313.57,9002313.57,10437,21,3,0)
should only be used if the National Drug Code number is not available. The
"^DD",9002313.57,9002313.57,10437,21,4,0)
code number here is the UPC number or the HRI number
"^DD",9002313.57,9002313.57,10438,0)
INCENTIVE AMOUNT SUBMITTED^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(438)
"^DD",9002313.57,9002313.57,10438,9)
^
"^DD",9002313.57,9002313.57,10438,9.01)

"^DD",9002313.57,9002313.57,10438,9.1)
S X=$$FIELD^BPSOS57(438)
"^DD",9002313.57,9002313.57,10438,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10438,21,1,0)
Amount represents a fee that is submitted by the pharmacy for
"^DD",9002313.57,9002313.57,10438,21,2,0)
contractually agreed upon services. This amount is included in the 'Gross
"^DD",9002313.57,9002313.57,10438,21,3,0)
Amount Due' (43-DU).  
"^DD",9002313.57,9002313.57,10439,0)
DUR CONFLICT CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(439)
"^DD",9002313.57,9002313.57,10439,9)
^
"^DD",9002313.57,9002313.57,10439,9.01)

"^DD",9002313.57,9002313.57,10439,9.1)
S X=$$FIELD^BPSOS57(439)
"^DD",9002313.57,9002313.57,10439,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10439,21,1,0)
Code identifying the type of utilization conflict detected or the reason
"^DD",9002313.57,9002313.57,10439,21,2,0)
for the pharmacist s professional service.
"^DD",9002313.57,9002313.57,10440,0)
DUR INTERVENTION CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(440)
"^DD",9002313.57,9002313.57,10440,9)
^
"^DD",9002313.57,9002313.57,10440,9.01)

"^DD",9002313.57,9002313.57,10440,9.1)
S X=$$FIELD^BPSOS57(440)
"^DD",9002313.57,9002313.57,10440,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10440,21,1,0)
Code to indicate whether an intervention was entered.
"^DD",9002313.57,9002313.57,10441,0)
DUR OUTCOME CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(441)
"^DD",9002313.57,9002313.57,10441,9)
^
"^DD",9002313.57,9002313.57,10441,9.01)

"^DD",9002313.57,9002313.57,10441,9.1)
S X=$$FIELD^BPSOS57(441)
"^DD",9002313.57,9002313.57,10441,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10441,21,1,0)
The outcome of the DUR - whether the prescription had to be modified.
"^DD",9002313.57,9002313.57,10442,0)
METRIC DECIMAL QUANTITY^CJ9,3^^ ; ^S X=$$FIELD^BPSOS57(442)
"^DD",9002313.57,9002313.57,10442,9)
^
"^DD",9002313.57,9002313.57,10442,9.01)

"^DD",9002313.57,9002313.57,10442,9.1)
S X=$$FIELD^BPSOS57(442)
"^DD",9002313.57,9002313.57,10442,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10442,21,1,0)
Quantity dispensed expressed in metric decimal units.
"^DD",9002313.57,9002313.57,10443,0)
OTHER PAYOR DATE^CJ8^^ ; ^S X=$$FIELD^BPSOS57(443)
"^DD",9002313.57,9002313.57,10443,9)
^
"^DD",9002313.57,9002313.57,10443,9.01)

"^DD",9002313.57,9002313.57,10443,9.1)
S X=$$FIELD^BPSOS57(443)
"^DD",9002313.57,9002313.57,10443,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10443,21,1,0)
Payment or denial date of the claim submitted to the other payer. Used for
"^DD",9002313.57,9002313.57,10443,21,2,0)
coordination of benefits.
"^DD",9002313.57,9002313.57,10444,0)
PHARMACIST ID^CJ10^^ ; ^S X=$$FIELD^BPSOS57(444)
"^DD",9002313.57,9002313.57,10444,9)
^
"^DD",9002313.57,9002313.57,10444,9.01)

"^DD",9002313.57,9002313.57,10444,9.1)
S X=$$FIELD^BPSOS57(444)
"^DD",9002313.57,9002313.57,10444,21,0)
^.001^2^2^3031222^^
"^DD",9002313.57,9002313.57,10444,21,1,0)
Unique ID assigned to the person responsible for the dispensing of the
"^DD",9002313.57,9002313.57,10444,21,2,0)
prescription or provision of the service.
"^DD",9002313.57,9002313.57,10501,0)
RESPONSE STATUS^CJ1^^ ; ^S X=$$FIELD^BPSOS57(501)
"^DD",9002313.57,9002313.57,10501,9)
^
"^DD",9002313.57,9002313.57,10501,9.01)

"^DD",9002313.57,9002313.57,10501,9.1)
S X=$$FIELD^BPSOS57(501)
"^DD",9002313.57,9002313.57,10501,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10501,21,1,0)
Status flag indicating whether the transaction was "P"aid, "R"ejected,
"^DD",9002313.57,9002313.57,10501,21,2,0)
"A"ccepted, or "C"aptured.
"^DD",9002313.57,9002313.57,10503,0)
AUTHORIZATION NUMBER^CJ14^^ ; ^S X=$$FIELD^BPSOS57(503)
"^DD",9002313.57,9002313.57,10503,9)
^
"^DD",9002313.57,9002313.57,10503,9.01)

"^DD",9002313.57,9002313.57,10503,9.1)
S X=$$FIELD^BPSOS57(503)
"^DD",9002313.57,9002313.57,10503,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10503,21,1,0)
Authorization number for pre-authorization requests.
"^DD",9002313.57,9002313.57,10504,0)
MESSAGE^CJ200^^ ; ^S X=$$FIELD^BPSOS57(504)
"^DD",9002313.57,9002313.57,10504,9)
^
"^DD",9002313.57,9002313.57,10504,9.01)

"^DD",9002313.57,9002313.57,10504,9.1)
S X=$$FIELD^BPSOS57(504)
"^DD",9002313.57,9002313.57,10504,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10504,21,1,0)
Free form Message.
"^DD",9002313.57,9002313.57,10505,0)
PATIENT PAY AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(505)
"^DD",9002313.57,9002313.57,10505,9)
^
"^DD",9002313.57,9002313.57,10505,9.01)

"^DD",9002313.57,9002313.57,10505,9.1)
S X=$$FIELD^BPSOS57(505)
"^DD",9002313.57,9002313.57,10505,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10505,21,1,0)
Amount the patient pays (copay).
"^DD",9002313.57,9002313.57,10505,"DT")
3010405
"^DD",9002313.57,9002313.57,10506,0)
INGREDIENT COST PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(506)
"^DD",9002313.57,9002313.57,10506,9)
^
"^DD",9002313.57,9002313.57,10506,9.01)

"^DD",9002313.57,9002313.57,10506,9.1)
S X=$$FIELD^BPSOS57(506)
"^DD",9002313.57,9002313.57,10506,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10506,21,1,0)
Drug ingredient cost paid included in the 'Total Amount Paid' (59).
"^DD",9002313.57,9002313.57,10507,0)
CONTRACT FEE PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(507)
"^DD",9002313.57,9002313.57,10507,9)
^
"^DD",9002313.57,9002313.57,10507,9.01)

"^DD",9002313.57,9002313.57,10507,9.1)
S X=$$FIELD^BPSOS57(507)
"^DD",9002313.57,9002313.57,10507,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10507,21,1,0)
Dispensing fee paid included in the 'Total Amount Paid' (59).
"^DD",9002313.57,9002313.57,10508,0)
SALES TAX PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(508)
"^DD",9002313.57,9002313.57,10508,9)
^
"^DD",9002313.57,9002313.57,10508,9.01)

"^DD",9002313.57,9002313.57,10508,9.1)
S X=$$FIELD^BPSOS57(508)
"^DD",9002313.57,9002313.57,10508,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10508,21,1,0)
The amount of sales tax paid for the prescription dispensed.
"^DD",9002313.57,9002313.57,10509,0)
TOTAL AMOUNT PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(509)
"^DD",9002313.57,9002313.57,10509,9)
^
"^DD",9002313.57,9002313.57,10509,9.01)

"^DD",9002313.57,9002313.57,10509,9.1)
S X=$$FIELD^BPSOS57(509)
"^DD",9002313.57,9002313.57,10509,21,0)
^^6^6^3031222^
"^DD",9002313.57,9002313.57,10509,21,1,0)
Total amount to be paid by the claims processor (i.e. pharmacy
"^DD",9002313.57,9002313.57,10509,21,2,0)
receivable). Represents a sum of 'Ingredient Cost Paid' (56), 'Dispensing
"^DD",9002313.57,9002313.57,10509,21,3,0)
Fee Paid' (57), 'Flat Sales Tax Amount Paid' (558), 'Percentage Sales Tax
"^DD",9002313.57,9002313.57,10509,21,4,0)
Amount Paid' (559), 'Incentive Amount Paid' (521), 'Professional Service
"^DD",9002313.57,9002313.57,10509,21,5,0)
Fee Paid' (562), 'Other Amount Paid' (565), less 'Patient Pay Amount'
"^DD",9002313.57,9002313.57,10509,21,6,0)
(55) and 'Other Payer Amount Recognized' (566).
"^DD",9002313.57,9002313.57,10510,0)
REJECT COUNT^CJ2^^ ; ^S X=$$FIELD^BPSOS57(510)
"^DD",9002313.57,9002313.57,10510,9)
^
"^DD",9002313.57,9002313.57,10510,9.01)

"^DD",9002313.57,9002313.57,10510,9.1)
S X=$$FIELD^BPSOS57(510)
"^DD",9002313.57,9002313.57,10510,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10510,21,1,0)
Count of 'Reject Code' (511) occurrences.
"^DD",9002313.57,9002313.57,10511,0)
REJECT CODES^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511)
"^DD",9002313.57,9002313.57,10511,9)
^
"^DD",9002313.57,9002313.57,10511,9.01)

"^DD",9002313.57,9002313.57,10511,9.1)
S X=$$FIELD^BPSOS57(511)
"^DD",9002313.57,9002313.57,10511,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511,21,1,0)
Multiple rejection codes. 
"^DD",9002313.57,9002313.57,10511.01,0)
REJECT CODE #1^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.01)
"^DD",9002313.57,9002313.57,10511.01,9)
^
"^DD",9002313.57,9002313.57,10511.01,9.01)

"^DD",9002313.57,9002313.57,10511.01,9.1)
S X=$$FIELD^BPSOS57(511.01)
"^DD",9002313.57,9002313.57,10511.01,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.01,21,1,0)
Reject code #1 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.02,0)
REJECT CODE #2^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.02)
"^DD",9002313.57,9002313.57,10511.02,9)
^
"^DD",9002313.57,9002313.57,10511.02,9.01)

"^DD",9002313.57,9002313.57,10511.02,9.1)
S X=$$FIELD^BPSOS57(511.02)
"^DD",9002313.57,9002313.57,10511.02,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.02,21,1,0)
Reject code #2 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.03,0)
REJECT CODE #3^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.03)
"^DD",9002313.57,9002313.57,10511.03,9)
^
"^DD",9002313.57,9002313.57,10511.03,9.01)

"^DD",9002313.57,9002313.57,10511.03,9.1)
S X=$$FIELD^BPSOS57(511.03)
"^DD",9002313.57,9002313.57,10511.03,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.03,21,1,0)
Reject code #3 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.04,0)
REJECT CODE #4^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.04)
"^DD",9002313.57,9002313.57,10511.04,9)
^
"^DD",9002313.57,9002313.57,10511.04,9.01)

"^DD",9002313.57,9002313.57,10511.04,9.1)
S X=$$FIELD^BPSOS57(511.04)
"^DD",9002313.57,9002313.57,10511.04,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.04,21,1,0)
Reject code #4 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.05,0)
REJECT CODE #5^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.05)
"^DD",9002313.57,9002313.57,10511.05,9)
^
"^DD",9002313.57,9002313.57,10511.05,9.01)

"^DD",9002313.57,9002313.57,10511.05,9.1)
S X=$$FIELD^BPSOS57(511.05)
"^DD",9002313.57,9002313.57,10511.05,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.05,21,1,0)
Reject code #5 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.06,0)
REJECT CODE #6^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.06)
"^DD",9002313.57,9002313.57,10511.06,9)
^
"^DD",9002313.57,9002313.57,10511.06,9.01)

"^DD",9002313.57,9002313.57,10511.06,9.1)
S X=$$FIELD^BPSOS57(511.06)
"^DD",9002313.57,9002313.57,10511.06,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.06,21,1,0)
Reject code #6 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.07,0)
REJECT CODE #7^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.07)
"^DD",9002313.57,9002313.57,10511.07,9)
^
"^DD",9002313.57,9002313.57,10511.07,9.01)

"^DD",9002313.57,9002313.57,10511.07,9.1)
S X=$$FIELD^BPSOS57(511.07)
"^DD",9002313.57,9002313.57,10511.07,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.07,21,1,0)
Reject code #7 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.08,0)
REJECT CODE #8^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.08)
"^DD",9002313.57,9002313.57,10511.08,9)
^
"^DD",9002313.57,9002313.57,10511.08,9.01)

"^DD",9002313.57,9002313.57,10511.08,9.1)
S X=$$FIELD^BPSOS57(511.08)
"^DD",9002313.57,9002313.57,10511.08,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.08,21,1,0)
Reject code #8 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.09,0)
REJECT CODE #9^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.09)
"^DD",9002313.57,9002313.57,10511.09,9)
^
"^DD",9002313.57,9002313.57,10511.09,9.01)

"^DD",9002313.57,9002313.57,10511.09,9.1)
S X=$$FIELD^BPSOS57(511.09)
"^DD",9002313.57,9002313.57,10511.09,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.09,21,1,0)
Reject code #9 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.1,0)
REJECT CODE #10^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.1)
"^DD",9002313.57,9002313.57,10511.1,9)
^
"^DD",9002313.57,9002313.57,10511.1,9.01)

"^DD",9002313.57,9002313.57,10511.1,9.1)
S X=$$FIELD^BPSOS57(511.1)
"^DD",9002313.57,9002313.57,10511.1,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.1,21,1,0)
Reject code #10 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.11,0)
REJECT CODE #11^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.11)
"^DD",9002313.57,9002313.57,10511.11,9)
^
"^DD",9002313.57,9002313.57,10511.11,9.01)

"^DD",9002313.57,9002313.57,10511.11,9.1)
S X=$$FIELD^BPSOS57(511.11)
"^DD",9002313.57,9002313.57,10511.11,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.11,21,1,0)
Reject code #11 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.11,"DT")
3010405
"^DD",9002313.57,9002313.57,10511.12,0)
REJECT CODE #12^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.12)
"^DD",9002313.57,9002313.57,10511.12,9)
^
"^DD",9002313.57,9002313.57,10511.12,9.01)

"^DD",9002313.57,9002313.57,10511.12,9.1)
S X=$$FIELD^BPSOS57(511.12)
"^DD",9002313.57,9002313.57,10511.12,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.12,21,1,0)
Reject code #12 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.13,0)
REJECT CODE #13^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.13)
"^DD",9002313.57,9002313.57,10511.13,9)
^
"^DD",9002313.57,9002313.57,10511.13,9.01)

"^DD",9002313.57,9002313.57,10511.13,9.1)
S X=$$FIELD^BPSOS57(511.13)
"^DD",9002313.57,9002313.57,10511.13,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.13,21,1,0)
Reject code #13 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.14,0)
REJECT CODE #14^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.14)
"^DD",9002313.57,9002313.57,10511.14,9)
^
"^DD",9002313.57,9002313.57,10511.14,9.01)

"^DD",9002313.57,9002313.57,10511.14,9.1)
S X=$$FIELD^BPSOS57(511.14)
"^DD",9002313.57,9002313.57,10511.14,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.14,21,1,0)
Reject code #14 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.15,0)
REJECT CODE #15^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.15)
"^DD",9002313.57,9002313.57,10511.15,9)
^
"^DD",9002313.57,9002313.57,10511.15,9.01)

"^DD",9002313.57,9002313.57,10511.15,9.1)
S X=$$FIELD^BPSOS57(511.15)
"^DD",9002313.57,9002313.57,10511.15,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.15,21,1,0)
Reject code #15 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.16,0)
REJECT CODE #16^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.16)
"^DD",9002313.57,9002313.57,10511.16,9)
^
"^DD",9002313.57,9002313.57,10511.16,9.01)

"^DD",9002313.57,9002313.57,10511.16,9.1)
S X=$$FIELD^BPSOS57(511.16)
"^DD",9002313.57,9002313.57,10511.16,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.16,21,1,0)
Reject code #16 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.17,0)
REJECT CODE #17^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.17)
"^DD",9002313.57,9002313.57,10511.17,9)
^
"^DD",9002313.57,9002313.57,10511.17,9.01)

"^DD",9002313.57,9002313.57,10511.17,9.1)
S X=$$FIELD^BPSOS57(511.17)
"^DD",9002313.57,9002313.57,10511.17,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.17,21,1,0)
Reject code #17 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.18,0)
REJECT CODE #18^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.18)
"^DD",9002313.57,9002313.57,10511.18,9)
^
"^DD",9002313.57,9002313.57,10511.18,9.01)

"^DD",9002313.57,9002313.57,10511.18,9.1)
S X=$$FIELD^BPSOS57(511.18)
"^DD",9002313.57,9002313.57,10511.18,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.18,21,1,0)
Reject code #18 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.19,0)
REJECT CODE #19^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.19)
"^DD",9002313.57,9002313.57,10511.19,9)
^
"^DD",9002313.57,9002313.57,10511.19,9.01)

"^DD",9002313.57,9002313.57,10511.19,9.1)
S X=$$FIELD^BPSOS57(511.19)
"^DD",9002313.57,9002313.57,10511.19,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.19,21,1,0)
Reject code #19 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.2,0)
REJECT CODE #20^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.2)
"^DD",9002313.57,9002313.57,10511.2,9)
^
"^DD",9002313.57,9002313.57,10511.2,9.01)

"^DD",9002313.57,9002313.57,10511.2,9.1)
S X=$$FIELD^BPSOS57(511.2)
"^DD",9002313.57,9002313.57,10511.2,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.2,21,1,0)
Reject code #20 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10512,0)
ACCUMULATED DEDUCTIBLE AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(512)
"^DD",9002313.57,9002313.57,10512,9)
^
"^DD",9002313.57,9002313.57,10512,9.01)

"^DD",9002313.57,9002313.57,10512,9.1)
S X=$$FIELD^BPSOS57(512)
"^DD",9002313.57,9002313.57,10512,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10512,21,1,0)
Amount in dollars met by the patient/family in a deductible plan.
"^DD",9002313.57,9002313.57,10513,0)
REMAINING DEDUCTIBLE AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(513)
"^DD",9002313.57,9002313.57,10513,9)
^
"^DD",9002313.57,9002313.57,10513,9.01)

"^DD",9002313.57,9002313.57,10513,9.1)
S X=$$FIELD^BPSOS57(513)
"^DD",9002313.57,9002313.57,10513,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10513,21,1,0)
Amount not met by the patient/family in the deductible plan.
"^DD",9002313.57,9002313.57,10514,0)
REMAINING BENEFIT AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(514)
"^DD",9002313.57,9002313.57,10514,9)
^
"^DD",9002313.57,9002313.57,10514,9.01)

"^DD",9002313.57,9002313.57,10514,9.1)
S X=$$FIELD^BPSOS57(514)
"^DD",9002313.57,9002313.57,10514,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10514,21,1,0)
Amount remaining in a patient/family plan with a periodic maximum benefit.
"^DD",9002313.57,9002313.57,10515,0)
POSTAGE AMOUNT PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(515)
"^DD",9002313.57,9002313.57,10515,9)
^
"^DD",9002313.57,9002313.57,10515,9.01)

"^DD",9002313.57,9002313.57,10515,9.1)
S X=$$FIELD^BPSOS57(515)
"^DD",9002313.57,9002313.57,10515,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10515,21,1,0)
Not applicable to the VA.
"^DD",9002313.57,9002313.57,10516,0)
DRUG DESCRIPTION^CJ30^^ ; ^S X=$$FIELD^BPSOS57(516)
"^DD",9002313.57,9002313.57,10516,9)
^
"^DD",9002313.57,9002313.57,10516,9.01)

"^DD",9002313.57,9002313.57,10516,9.1)
S X=$$FIELD^BPSOS57(516)
"^DD",9002313.57,9002313.57,10516,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10516,21,1,0)
Text description for the drug from the drug file 50.
"^DD",9002313.57,9002313.57,10517,0)
AMOUNT APP TO PER DEDUCTIBLE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(517)
"^DD",9002313.57,9002313.57,10517,9)
^
"^DD",9002313.57,9002313.57,10517,9.01)

"^DD",9002313.57,9002313.57,10517,9.1)
S X=$$FIELD^BPSOS57(517)
"^DD",9002313.57,9002313.57,10517,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10517,21,1,0)
Amount to be collected from a patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10517,21,2,0)
Amount' (55) that is applied to a periodic deductible.
"^DD",9002313.57,9002313.57,10518,0)
AMOUNT OF CO-PAY/CO-INSURANCE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(518)
"^DD",9002313.57,9002313.57,10518,9)
^
"^DD",9002313.57,9002313.57,10518,9.01)

"^DD",9002313.57,9002313.57,10518,9.1)
S X=$$FIELD^BPSOS57(518)
"^DD",9002313.57,9002313.57,10518,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10518,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10518,21,2,0)
Amount' (55) that is due to a per prescription copay/coinsurance.
"^DD",9002313.57,9002313.57,10519,0)
AMOUNT ATTR TO PRODUCT SELECT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(519)
"^DD",9002313.57,9002313.57,10519,9)
^
"^DD",9002313.57,9002313.57,10519,9.01)

"^DD",9002313.57,9002313.57,10519,9.1)
S X=$$FIELD^BPSOS57(519)
"^DD",9002313.57,9002313.57,10519,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10519,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10519,21,2,0)
Amount' (55) that is due to the patient's selection of drug product.
"^DD",9002313.57,9002313.57,10520,0)
AMOUNT EXCEED PER BENEFIT MAX^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(520)
"^DD",9002313.57,9002313.57,10520,9)
^
"^DD",9002313.57,9002313.57,10520,9.01)

"^DD",9002313.57,9002313.57,10520,9.1)
S X=$$FIELD^BPSOS57(520)
"^DD",9002313.57,9002313.57,10520,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10520,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10520,21,2,0)
Amount' (55) that is due to the patient exceeding a periodic benefit
"^DD",9002313.57,9002313.57,10520,21,3,0)
maximum.
"^DD",9002313.57,9002313.57,10521,0)
INCENTIVE FEE PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(521)
"^DD",9002313.57,9002313.57,10521,9)
^
"^DD",9002313.57,9002313.57,10521,9.01)

"^DD",9002313.57,9002313.57,10521,9.1)
S X=$$FIELD^BPSOS57(521)
"^DD",9002313.57,9002313.57,10521,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10521,21,1,0)
Amount represents the contractually agreed upon incentive fee paid for
"^DD",9002313.57,9002313.57,10521,21,2,0)
specific services rendered. Amount is included in the 'Total Amount Paid'
"^DD",9002313.57,9002313.57,10521,21,3,0)
(59).
"^DD",9002313.57,9002313.57,10521,"DT")
3010405
"^DD",9002313.57,9002313.57,10522,0)
BASIS OF REIMBURSEMENT DET^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(522)
"^DD",9002313.57,9002313.57,10522,9)
^
"^DD",9002313.57,9002313.57,10522,9.01)

"^DD",9002313.57,9002313.57,10522,9.1)
S X=$$FIELD^BPSOS57(522)
"^DD",9002313.57,9002313.57,10522,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10522,21,1,0)
Code identifying how the reimbursement amount was calculated for
"^DD",9002313.57,9002313.57,10522,21,2,0)
'Ingredient Cost Paid' (56).
"^DD",9002313.57,9002313.57,10523,0)
AMOUNT ATTRIBUTED TO SALES TAX^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(523)
"^DD",9002313.57,9002313.57,10523,9)
^
"^DD",9002313.57,9002313.57,10523,9.01)

"^DD",9002313.57,9002313.57,10523,9.1)
S X=$$FIELD^BPSOS57(523)
"^DD",9002313.57,9002313.57,10523,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10523,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10523,21,2,0)
Amount' (55) that is due to sales tax paid.
"^DD",9002313.57,9002313.57,10524,0)
PLAN ID^CJ8^^ ; ^S X=$$FIELD^BPSOS57(524)
"^DD",9002313.57,9002313.57,10524,9)
^
"^DD",9002313.57,9002313.57,10524,9.01)

"^DD",9002313.57,9002313.57,10524,9.1)
S X=$$FIELD^BPSOS57(524)
"^DD",9002313.57,9002313.57,10524,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10524,21,1,0)
Plan Identification Number.
"^DD",9002313.57,9002313.57,10525,0)
DUR RESPONSE DATA^CJ160^^ ; ^S X=$$FIELD^BPSOS57(525)
"^DD",9002313.57,9002313.57,10525,9)
^
"^DD",9002313.57,9002313.57,10525,9.01)

"^DD",9002313.57,9002313.57,10525,9.1)
S X=$$FIELD^BPSOS57(525)
"^DD",9002313.57,9002313.57,10525,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10525,21,1,0)
Text that provides additional detail regarding a DUR conflict.
"^DD",9002313.57,9002313.57,10525.01,0)
DUR COUNT^CJ1^^ ; ^X ^DD(9002313.57,10525.01,9.5) S X=$S(Y(9002313.57,10525.01,2):Y(9002313.57,10525.01,3),Y(9002313.57,10525.01,5):Y(9002313.57,10525.01,6),Y(9002313.57,10525.01,8):Y(9002313.57,10525.01,9),Y(9002313.57,10525.01,10):X)
"^DD",9002313.57,9002313.57,10525.01,9)
^
"^DD",9002313.57,9002313.57,10525.01,9.01)
9002313.57^10525.3;9002313.57^10525.2;9002313.57^10525.1
"^DD",9002313.57,9002313.57,10525.01,9.1)
$S(DUR #1 RAW DATA="":0,DUR #2 RAW DATA="":1,DUR #3 RAW DATA="":2,1:3)
"^DD",9002313.57,9002313.57,10525.01,9.2)
X $P(^DD(9002313.57,10525.1,0),U,5,99) S Y(9002313.57,10525.01,1)=X X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.01,4)=X
"^DD",9002313.57,9002313.57,10525.01,9.3)
X ^DD(9002313.57,10525.01,9.2) X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.01,7)=X S X=Y(9002313.57,10525.01,1)="",Y(9002313.57,10525.01,2)=X S X=0
"^DD",9002313.57,9002313.57,10525.01,9.4)
X ^DD(9002313.57,10525.01,9.3) S Y(9002313.57,10525.01,3)=X S X=Y(9002313.57,10525.01,4)="",Y(9002313.57,10525.01,5)=X S X=1,Y(9002313.57,10525.01,6)=X
"^DD",9002313.57,9002313.57,10525.01,9.5)
X ^DD(9002313.57,10525.01,9.4) S X=Y(9002313.57,10525.01,7)="",Y(9002313.57,10525.01,8)=X S X=2,Y(9002313.57,10525.01,9)=X S X=1,Y(9002313.57,10525.01,10)=X S X=3
"^DD",9002313.57,9002313.57,10525.01,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10525.01,21,1,0)
Number of DUR messages to be displayed.
"^DD",9002313.57,9002313.57,10525.1,0)
DUR #1 RAW DATA^CJ53^^ ; ^X ^DD(9002313.57,10525.1,9.5) S X=$S(Y(9002313.57,10525.1,4):Y(9002313.57,10525.1,5),Y(9002313.57,10525.1,6):X)
"^DD",9002313.57,9002313.57,10525.1,9)
^
"^DD",9002313.57,9002313.57,10525.1,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1,9.1)
$S($E(DUR RESPONSE DATA,1,2)="  ":"",1:$E(DUR RESPONSE DATA,1,53))
"^DD",9002313.57,9002313.57,10525.1,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1,1)=X S X=Y(9002313.57,10525.1,1),Y(9002313.57,10525.1,2)=X S X=1,Y(9002313.57,10525.1,3)=X S X=2
"^DD",9002313.57,9002313.57,10525.1,9.3)
X ^DD(9002313.57,10525.1,9.2) S X=$E(Y(9002313.57,10525.1,2),Y(9002313.57,10525.1,3),X)="  ",Y(9002313.57,10525.1,4)=X S X="",Y(9002313.57,10525.1,5)=X S X=1
"^DD",9002313.57,9002313.57,10525.1,9.4)
X ^DD(9002313.57,10525.1,9.3) S Y(9002313.57,10525.1,6)=X,Y(9002313.57,10525.1,7)=X S X=Y(9002313.57,10525.1,1),Y(9002313.57,10525.1,8)=X S X=1
"^DD",9002313.57,9002313.57,10525.1,9.5)
X ^DD(9002313.57,10525.1,9.4) S Y(9002313.57,10525.1,9)=X S X=53,X=$E(Y(9002313.57,10525.1,8),Y(9002313.57,10525.1,9),X)
"^DD",9002313.57,9002313.57,10525.1,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10525.1,21,1,0)
Raw Data DUR message sent from the payer and stored in the response file.
"^DD",9002313.57,9002313.57,10525.1439,0)
DUR #1 DRUG CONFLICT CODE^CJ2^^ ; ^X ^DD(9002313.57,10525.1439,9.2) S Y(9002313.57,10525.1439,3)=X S X=2,X=$E(Y(9002313.57,10525.1439,2),Y(9002313.57,10525.1439,3),X)
"^DD",9002313.57,9002313.57,10525.1439,9)
^
"^DD",9002313.57,9002313.57,10525.1439,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1439,9.1)
$E(DUR RESPONSE DATA,1,2)
"^DD",9002313.57,9002313.57,10525.1439,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1439,1)=X S X=Y(9002313.57,10525.1439,1),Y(9002313.57,10525.1439,2)=X S X=1
"^DD",9002313.57,9002313.57,10525.1439,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10525.1439,21,1,0)
Severity level code for the first DUR.
"^DD",9002313.57,9002313.57,10525.1528,0)
DUR #1 SEVERITY INDEX CODE^CJ1^^ ; ^X ^DD(9002313.57,10525.1528,9.2) S X=$E(Y(9002313.57,10525.1528,2),X)
"^DD",9002313.57,9002313.57,10525.1528,9)
^
"^DD",9002313.57,9002313.57,10525.1528,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1528,9.1)
$E(DUR RESPONSE DATA,3)
"^DD",9002313.57,9002313.57,10525.1528,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1528,1)=X S X=Y(9002313.57,10525.1528,1),Y(9002313.57,10525.1528,2)=X S X=3
"^DD",9002313.57,9002313.57,10525.1528,21,0)
^.001^4^4^3040106^^
"^DD",9002313.57,9002313.57,10525.1528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.1528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10525.1528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10525.1528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10525.1528,"DT")
3040106
"^DD",9002313.57,9002313.57,10525.1529,0)
DUR #1 OTHER PHARMACY INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.1529,9.2) S X=$E(Y(9002313.57,10525.1529,2),X)
"^DD",9002313.57,9002313.57,10525.1529,9)
^
"^DD",9002313.57,9002313.57,10525.1529,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1529,9.1)
$E(DUR RESPONSE DATA,4)
"^DD",9002313.57,9002313.57,10525.1529,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1529,1)=X S X=Y(9002313.57,10525.1529,1),Y(9002313.57,10525.1529,2)=X S X=4
"^DD",9002313.57,9002313.57,10525.1529,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10525.1529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.1529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.1529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.1529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.1529,"DT")
3040106
"^DD",9002313.57,9002313.57,10525.153,0)
DUR #1 PREVIOUS DATE OF FILL^CJ8^^ ; ^X ^DD(9002313.57,10525.153,9.2) S Y(9002313.57,10525.153,3)=X S X=12,X=$E(Y(9002313.57,10525.153,2),Y(9002313.57,10525.153,3),X)
"^DD",9002313.57,9002313.57,10525.153,9)
^
"^DD",9002313.57,9002313.57,10525.153,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.153,9.1)
$E(DUR RESPONSE DATA,5,12)
"^DD",9002313.57,9002313.57,10525.153,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.153,1)=X S X=Y(9002313.57,10525.153,1),Y(9002313.57,10525.153,2)=X S X=5
"^DD",9002313.57,9002313.57,10525.153,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10525.153,21,1,0)
Previous fill date
"^DD",9002313.57,9002313.57,10525.1531,0)
DUR #1 QTY OF PREVIOUS FILL^CJ5^^ ; ^X ^DD(9002313.57,10525.1531,9.2) S Y(9002313.57,10525.1531,3)=X S X=17,X=$E(Y(9002313.57,10525.1531,2),Y(9002313.57,10525.1531,3),X)
"^DD",9002313.57,9002313.57,10525.1531,9)
^
"^DD",9002313.57,9002313.57,10525.1531,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1531,9.1)
$E(DUR RESPONSE DATA,13,17)
"^DD",9002313.57,9002313.57,10525.1531,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1531,1)=X S X=Y(9002313.57,10525.1531,1),Y(9002313.57,10525.1531,2)=X S X=13
"^DD",9002313.57,9002313.57,10525.1531,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,10525.1531,21,1,0)
The quantity of the previous fill that caused the DUR to be triggered.
"^DD",9002313.57,9002313.57,10525.1532,0)
DUR #1 DATABASE INDICATOR^CJ1^^ ; ^X ^DD(9002313.57,10525.1532,9.2) S X=$E(Y(9002313.57,10525.1532,2),X)
"^DD",9002313.57,9002313.57,10525.1532,9)
^
"^DD",9002313.57,9002313.57,10525.1532,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1532,9.1)
$E(DUR RESPONSE DATA,18)
"^DD",9002313.57,9002313.57,10525.1532,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1532,1)=X S X=Y(9002313.57,10525.1532,1),Y(9002313.57,10525.1532,2)=X S X=18
"^DD",9002313.57,9002313.57,10525.1532,21,0)
^.001^6^6^3040106^^
"^DD",9002313.57,9002313.57,10525.1532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.1532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10525.1532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10525.1532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10525.1532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10525.1532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10525.1533,0)
DUR #1 OTHER PRESCRIBER INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.1533,9.2) S X=$E(Y(9002313.57,10525.1533,2),X)
"^DD",9002313.57,9002313.57,10525.1533,9)
^
"^DD",9002313.57,9002313.57,10525.1533,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1533,9.1)
$E(DUR RESPONSE DATA,19)
"^DD",9002313.57,9002313.57,10525.1533,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1533,1)=X S X=Y(9002313.57,10525.1533,1),Y(9002313.57,10525.1533,2)=X S X=19
"^DD",9002313.57,9002313.57,10525.1533,21,0)
^.001^6^6^3040106^^
"^DD",9002313.57,9002313.57,10525.1533,21,1,0)
Code that indicates the prescriber of the current fill relationship to the
"^DD",9002313.57,9002313.57,10525.1533,21,2,0)
prescriber of the conflicting prescription.
"^DD",9002313.57,9002313.57,10525.1533,21,3,0)
 
"^DD",9002313.57,9002313.57,10525.1533,21,4,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.1533,21,5,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10525.1533,21,6,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10525.1544,0)
DUR #1 FREE TEXT^CJ30^^ ; ^X ^DD(9002313.57,10525.1544,9.2) S Y(9002313.57,10525.1544,3)=X S X=49,X=$E(Y(9002313.57,10525.1544,2),Y(9002313.57,10525.1544,3),X)
"^DD",9002313.57,9002313.57,10525.1544,9)
^
"^DD",9002313.57,9002313.57,10525.1544,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1544,9.1)
$E(DUR RESPONSE DATA,20,49)
"^DD",9002313.57,9002313.57,10525.1544,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1544,1)=X S X=Y(9002313.57,10525.1544,1),Y(9002313.57,10525.1544,2)=X S X=20
"^DD",9002313.57,9002313.57,10525.1544,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.1544,21,1,0)
Actual DUR text
"^DD",9002313.57,9002313.57,10525.1999,0)
DUR #1 RESERVE SPACE^CJ4^^ ; ^X ^DD(9002313.57,10525.1999,9.2) S Y(9002313.57,10525.1999,3)=X S X=53,X=$E(Y(9002313.57,10525.1999,2),Y(9002313.57,10525.1999,3),X)
"^DD",9002313.57,9002313.57,10525.1999,9)
^
"^DD",9002313.57,9002313.57,10525.1999,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1999,9.1)
$E(DUR RESPONSE DATA,50,53)
"^DD",9002313.57,9002313.57,10525.1999,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1999,1)=X S X=Y(9002313.57,10525.1999,1),Y(9002313.57,10525.1999,2)=X S X=50
"^DD",9002313.57,9002313.57,10525.1999,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.1999,21,1,0)
Reserved space for additional information.
"^DD",9002313.57,9002313.57,10525.2,0)
DUR #2 RAW DATA^CJ53^^ ; ^X ^DD(9002313.57,10525.2,9.5) S X=$S(Y(9002313.57,10525.2,4):Y(9002313.57,10525.2,5),Y(9002313.57,10525.2,6):X)
"^DD",9002313.57,9002313.57,10525.2,9)
^
"^DD",9002313.57,9002313.57,10525.2,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.2,9.1)
$S($E(DUR RESPONSE DATA,54,55)="  ":"",1:$E(DUR RESPONSE DATA,54,106))
"^DD",9002313.57,9002313.57,10525.2,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.2,1)=X S X=Y(9002313.57,10525.2,1),Y(9002313.57,10525.2,2)=X S X=54,Y(9002313.57,10525.2,3)=X S X=55
"^DD",9002313.57,9002313.57,10525.2,9.3)
X ^DD(9002313.57,10525.2,9.2) S X=$E(Y(9002313.57,10525.2,2),Y(9002313.57,10525.2,3),X)="  ",Y(9002313.57,10525.2,4)=X S X="",Y(9002313.57,10525.2,5)=X S X=1
"^DD",9002313.57,9002313.57,10525.2,9.4)
X ^DD(9002313.57,10525.2,9.3) S Y(9002313.57,10525.2,6)=X,Y(9002313.57,10525.2,7)=X S X=Y(9002313.57,10525.2,1),Y(9002313.57,10525.2,8)=X S X=54
"^DD",9002313.57,9002313.57,10525.2,9.5)
X ^DD(9002313.57,10525.2,9.4) S Y(9002313.57,10525.2,9)=X S X=106,X=$E(Y(9002313.57,10525.2,8),Y(9002313.57,10525.2,9),X)
"^DD",9002313.57,9002313.57,10525.2,21,0)
^.001^2^2^3040106^^
"^DD",9002313.57,9002313.57,10525.2,21,1,0)
DUR information returned by the payor that has not been formatted
"^DD",9002313.57,9002313.57,10525.2,21,2,0)
yet.
"^DD",9002313.57,9002313.57,10525.2439,0)
DUR #2 DRUG CONFLICT CODE^CJ2^^ ; ^X ^DD(9002313.57,10525.2439,9.2) S Y(9002313.57,10525.2439,3)=X S X=2,X=$E(Y(9002313.57,10525.2439,2),Y(9002313.57,10525.2439,3),X)
"^DD",9002313.57,9002313.57,10525.2439,9)
^
"^DD",9002313.57,9002313.57,10525.2439,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2439,9.1)
$E(DUR #2 RAW DATA,1,2)
"^DD",9002313.57,9002313.57,10525.2439,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2439,1)=X S X=Y(9002313.57,10525.2439,1),Y(9002313.57,10525.2439,2)=X S X=1
"^DD",9002313.57,9002313.57,10525.2439,21,0)
^.001^4^4^3040106^^
"^DD",9002313.57,9002313.57,10525.2439,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.2439,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.2439,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.2439,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.2528,0)
DUR #2 SEVERITY INDEX CODE^CJ1^^ ; ^X ^DD(9002313.57,10525.2528,9.2) S X=$E(Y(9002313.57,10525.2528,2),X)
"^DD",9002313.57,9002313.57,10525.2528,9)
^
"^DD",9002313.57,9002313.57,10525.2528,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2528,9.1)
$E(DUR #2 RAW DATA,3)
"^DD",9002313.57,9002313.57,10525.2528,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2528,1)=X S X=Y(9002313.57,10525.2528,1),Y(9002313.57,10525.2528,2)=X S X=3
"^DD",9002313.57,9002313.57,10525.2528,21,0)
^.001^4^4^3040106^^
"^DD",9002313.57,9002313.57,10525.2528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.2528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10525.2528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10525.2528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10525.2529,0)
DUR #2 OTHER PHARMACY INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.2529,9.2) S X=$E(Y(9002313.57,10525.2529,2),X)
"^DD",9002313.57,9002313.57,10525.2529,9)
^
"^DD",9002313.57,9002313.57,10525.2529,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2529,9.1)
$E(DUR #2 RAW DATA,4)
"^DD",9002313.57,9002313.57,10525.2529,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2529,1)=X S X=Y(9002313.57,10525.2529,1),Y(9002313.57,10525.2529,2)=X S X=4
"^DD",9002313.57,9002313.57,10525.2529,21,0)
^.001^4^4^3040106^^
"^DD",9002313.57,9002313.57,10525.2529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.2529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.2529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.2529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.253,0)
DUR #2 PREVIOUS DATE OF FILL^CJ8^^ ; ^X ^DD(9002313.57,10525.253,9.2) S Y(9002313.57,10525.253,3)=X S X=12,X=$E(Y(9002313.57,10525.253,2),Y(9002313.57,10525.253,3),X)
"^DD",9002313.57,9002313.57,10525.253,9)
^
"^DD",9002313.57,9002313.57,10525.253,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.253,9.1)
$E(DUR #2 RAW DATA,5,12)
"^DD",9002313.57,9002313.57,10525.253,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.253,1)=X S X=Y(9002313.57,10525.253,1),Y(9002313.57,10525.253,2)=X S X=5
"^DD",9002313.57,9002313.57,10525.253,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.253,21,1,0)
Fill date of the previous fill that is causing the DUR conflict.
"^DD",9002313.57,9002313.57,10525.2531,0)
DUR #2 QTY OF PREVIOUS FILL^CJ5^^ ; ^X ^DD(9002313.57,10525.2531,9.2) S Y(9002313.57,10525.2531,3)=X S X=17,X=$E(Y(9002313.57,10525.2531,2),Y(9002313.57,10525.2531,3),X)
"^DD",9002313.57,9002313.57,10525.2531,9)
^
"^DD",9002313.57,9002313.57,10525.2531,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2531,9.1)
$E(DUR #2 RAW DATA,13,17)
"^DD",9002313.57,9002313.57,10525.2531,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2531,1)=X S X=Y(9002313.57,10525.2531,1),Y(9002313.57,10525.2531,2)=X S X=13
"^DD",9002313.57,9002313.57,10525.2531,21,0)
^.001^1^1^3040106^^^
"^DD",9002313.57,9002313.57,10525.2531,21,1,0)
Quantity of the fill that is causing the conflict.
"^DD",9002313.57,9002313.57,10525.2532,0)
DUR #2 DATABASE INDICATOR^CJ1^^ ; ^X ^DD(9002313.57,10525.2532,9.2) S X=$E(Y(9002313.57,10525.2532,2),X)
"^DD",9002313.57,9002313.57,10525.2532,9)
^
"^DD",9002313.57,9002313.57,10525.2532,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2532,9.1)
$E(DUR #2 RAW DATA,18)
"^DD",9002313.57,9002313.57,10525.2532,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2532,1)=X S X=Y(9002313.57,10525.2532,1),Y(9002313.57,10525.2532,2)=X S X=18
"^DD",9002313.57,9002313.57,10525.2532,21,0)
^.001^6^6^3040106^^
"^DD",9002313.57,9002313.57,10525.2532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.2532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10525.2532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10525.2532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10525.2532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10525.2532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10525.2533,0)
DUR #2 OTHER PRESCRIBER INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.2533,9.2) S X=$E(Y(9002313.57,10525.2533,2),X)
"^DD",9002313.57,9002313.57,10525.2533,9)
^
"^DD",9002313.57,9002313.57,10525.2533,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2533,9.1)
$E(DUR #2 RAW DATA,19)
"^DD",9002313.57,9002313.57,10525.2533,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2533,1)=X S X=Y(9002313.57,10525.2533,1),Y(9002313.57,10525.2533,2)=X S X=19
"^DD",9002313.57,9002313.57,10525.2533,21,0)
^.001^6^6^3040106^^
"^DD",9002313.57,9002313.57,10525.2533,21,1,0)
Code that indicates the prescriber of the current fill relationship to the
"^DD",9002313.57,9002313.57,10525.2533,21,2,0)
prescriber of the conflicting prescription.
"^DD",9002313.57,9002313.57,10525.2533,21,3,0)
 
"^DD",9002313.57,9002313.57,10525.2533,21,4,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.2533,21,5,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10525.2533,21,6,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10525.2544,0)
DUR #2 FREE TEXT^CJ30^^ ; ^X ^DD(9002313.57,10525.2544,9.2) S Y(9002313.57,10525.2544,3)=X S X=49,X=$E(Y(9002313.57,10525.2544,2),Y(9002313.57,10525.2544,3),X)
"^DD",9002313.57,9002313.57,10525.2544,9)
^
"^DD",9002313.57,9002313.57,10525.2544,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2544,9.1)
$E(DUR #2 RAW DATA,20,49)
"^DD",9002313.57,9002313.57,10525.2544,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2544,1)=X S X=Y(9002313.57,10525.2544,1),Y(9002313.57,10525.2544,2)=X S X=20
"^DD",9002313.57,9002313.57,10525.2544,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.2544,21,1,0)
Actual DUR text
"^DD",9002313.57,9002313.57,10525.2999,0)
DUR #2 RESERVE SPACE^CJ4^^ ; ^X ^DD(9002313.57,10525.2999,9.2) S Y(9002313.57,10525.2999,3)=X S X=53,X=$E(Y(9002313.57,10525.2999,2),Y(9002313.57,10525.2999,3),X)
"^DD",9002313.57,9002313.57,10525.2999,9)
^
"^DD",9002313.57,9002313.57,10525.2999,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2999,9.1)
$E(DUR #2 RAW DATA,50,53)
"^DD",9002313.57,9002313.57,10525.2999,9.2)
X $P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2999,1)=X S X=Y(9002313.57,10525.2999,1),Y(9002313.57,10525.2999,2)=X S X=50
"^DD",9002313.57,9002313.57,10525.2999,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.2999,21,1,0)
Reserved space for additional information.
"^DD",9002313.57,9002313.57,10525.3,0)
DUR #3 RAW DATA^CJ53^^ ; ^X ^DD(9002313.57,10525.3,9.5) S X=$S(Y(9002313.57,10525.3,4):Y(9002313.57,10525.3,5),Y(9002313.57,10525.3,6):X)
"^DD",9002313.57,9002313.57,10525.3,9)
^
"^DD",9002313.57,9002313.57,10525.3,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.3,9.1)
$S($E(DUR RESPONSE DATA,107,108)="  ":"",1:$E(DUR RESPONSE DATA,107,159))
"^DD",9002313.57,9002313.57,10525.3,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.3,1)=X S X=Y(9002313.57,10525.3,1),Y(9002313.57,10525.3,2)=X S X=107,Y(9002313.57,10525.3,3)=X S X=108
"^DD",9002313.57,9002313.57,10525.3,9.3)
X ^DD(9002313.57,10525.3,9.2) S X=$E(Y(9002313.57,10525.3,2),Y(9002313.57,10525.3,3),X)="  ",Y(9002313.57,10525.3,4)=X S X="",Y(9002313.57,10525.3,5)=X S X=1
"^DD",9002313.57,9002313.57,10525.3,9.4)
X ^DD(9002313.57,10525.3,9.3) S Y(9002313.57,10525.3,6)=X,Y(9002313.57,10525.3,7)=X S X=Y(9002313.57,10525.3,1),Y(9002313.57,10525.3,8)=X S X=107
"^DD",9002313.57,9002313.57,10525.3,9.5)
X ^DD(9002313.57,10525.3,9.4) S Y(9002313.57,10525.3,9)=X S X=159,X=$E(Y(9002313.57,10525.3,8),Y(9002313.57,10525.3,9),X)
"^DD",9002313.57,9002313.57,10525.3,21,0)
^^2^2^3040106^
"^DD",9002313.57,9002313.57,10525.3,21,1,0)
DUR information returned by the payor that has not been formatted
"^DD",9002313.57,9002313.57,10525.3,21,2,0)
yet.
"^DD",9002313.57,9002313.57,10525.3439,0)
DUR #3 DRUG CONFLICT CODE^CJ2^^ ; ^X ^DD(9002313.57,10525.3439,9.2) S Y(9002313.57,10525.3439,3)=X S X=2,X=$E(Y(9002313.57,10525.3439,2),Y(9002313.57,10525.3439,3),X)
"^DD",9002313.57,9002313.57,10525.3439,9)
^
"^DD",9002313.57,9002313.57,10525.3439,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3439,9.1)
$E(DUR #3 RAW DATA,1,2)
"^DD",9002313.57,9002313.57,10525.3439,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3439,1)=X S X=Y(9002313.57,10525.3439,1),Y(9002313.57,10525.3439,2)=X S X=1
"^DD",9002313.57,9002313.57,10525.3439,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10525.3439,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.3439,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.3439,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.3439,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.3528,0)
DUR #3 SEVERITY INDEX CODE^CJ1^^ ; ^X ^DD(9002313.57,10525.3528,9.2) S X=$E(Y(9002313.57,10525.3528,2),X)
"^DD",9002313.57,9002313.57,10525.3528,9)
^
"^DD",9002313.57,9002313.57,10525.3528,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3528,9.1)
$E(DUR #3 RAW DATA,3)
"^DD",9002313.57,9002313.57,10525.3528,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3528,1)=X S X=Y(9002313.57,10525.3528,1),Y(9002313.57,10525.3528,2)=X S X=3
"^DD",9002313.57,9002313.57,10525.3528,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10525.3528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.3528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10525.3528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10525.3528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10525.3529,0)
DUR #3 OTHER PHARMACY INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.3529,9.2) S X=$E(Y(9002313.57,10525.3529,2),X)
"^DD",9002313.57,9002313.57,10525.3529,9)
^
"^DD",9002313.57,9002313.57,10525.3529,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3529,9.1)
$E(DUR #3 RAW DATA,4)
"^DD",9002313.57,9002313.57,10525.3529,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3529,1)=X S X=Y(9002313.57,10525.3529,1),Y(9002313.57,10525.3529,2)=X S X=4
"^DD",9002313.57,9002313.57,10525.3529,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10525.3529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.3529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.3529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.3529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.353,0)
DUR #3 PREVIOUS DATE OF FILL^CJ8^^ ; ^X ^DD(9002313.57,10525.353,9.2) S Y(9002313.57,10525.353,3)=X S X=12,X=$E(Y(9002313.57,10525.353,2),Y(9002313.57,10525.353,3),X)
"^DD",9002313.57,9002313.57,10525.353,9)
^
"^DD",9002313.57,9002313.57,10525.353,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.353,9.1)
$E(DUR #3 RAW DATA,5,12)
"^DD",9002313.57,9002313.57,10525.353,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.353,1)=X S X=Y(9002313.57,10525.353,1),Y(9002313.57,10525.353,2)=X S X=5
"^DD",9002313.57,9002313.57,10525.353,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10525.353,21,1,0)
Fill date of the previous fill that is causing the DUR conflict.
"^DD",9002313.57,9002313.57,10525.3531,0)
DUR #3 QTY OF PREVIOUS FILL^CJ5^^ ; ^X ^DD(9002313.57,10525.3531,9.2) S Y(9002313.57,10525.3531,3)=X S X=17,X=$E(Y(9002313.57,10525.3531,2),Y(9002313.57,10525.3531,3),X)
"^DD",9002313.57,9002313.57,10525.3531,9)
^
"^DD",9002313.57,9002313.57,10525.3531,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3531,9.1)
$E(DUR #3 RAW DATA,13,17)
"^DD",9002313.57,9002313.57,10525.3531,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3531,1)=X S X=Y(9002313.57,10525.3531,1),Y(9002313.57,10525.3531,2)=X S X=13
"^DD",9002313.57,9002313.57,10525.3531,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.3531,21,1,0)
Quantity of the fill that is causing the conflict.
"^DD",9002313.57,9002313.57,10525.3531,"DT")
3040106
"^DD",9002313.57,9002313.57,10525.3532,0)
DUR #3 DATABASE INDICATOR^CJ1^^ ; ^X ^DD(9002313.57,10525.3532,9.2) S X=$E(Y(9002313.57,10525.3532,2),X)
"^DD",9002313.57,9002313.57,10525.3532,9)
^
"^DD",9002313.57,9002313.57,10525.3532,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3532,9.1)
$E(DUR #3 RAW DATA,18)
"^DD",9002313.57,9002313.57,10525.3532,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3532,1)=X S X=Y(9002313.57,10525.3532,1),Y(9002313.57,10525.3532,2)=X S X=18
"^DD",9002313.57,9002313.57,10525.3532,21,0)
^^6^6^3040106^
"^DD",9002313.57,9002313.57,10525.3532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.3532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10525.3532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10525.3532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10525.3532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10525.3532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10525.3533,0)
DUR #3 OTHER PRESCRIBER INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.3533,9.2) S X=$E(Y(9002313.57,10525.3533,2),X)
"^DD",9002313.57,9002313.57,10525.3533,9)
^
"^DD",9002313.57,9002313.57,10525.3533,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3533,9.1)
$E(DUR #3 RAW DATA,19)
"^DD",9002313.57,9002313.57,10525.3533,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3533,1)=X S X=Y(9002313.57,10525.3533,1),Y(9002313.57,10525.3533,2)=X S X=19
"^DD",9002313.57,9002313.57,10525.3533,21,0)
^^6^6^3040106^
"^DD",9002313.57,9002313.57,10525.3533,21,1,0)
Code that indicates the prescriber of the current fill relationship to the
"^DD",9002313.57,9002313.57,10525.3533,21,2,0)
prescriber of the conflicting prescription.
"^DD",9002313.57,9002313.57,10525.3533,21,3,0)
 
"^DD",9002313.57,9002313.57,10525.3533,21,4,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.3533,21,5,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10525.3533,21,6,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10525.3544,0)
DUR #3 FREE TEXT^CJ30^^ ; ^X ^DD(9002313.57,10525.3544,9.2) S Y(9002313.57,10525.3544,3)=X S X=49,X=$E(Y(9002313.57,10525.3544,2),Y(9002313.57,10525.3544,3),X)
"^DD",9002313.57,9002313.57,10525.3544,9)
^
"^DD",9002313.57,9002313.57,10525.3544,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3544,9.1)
$E(DUR #3 RAW DATA,20,49)
"^DD",9002313.57,9002313.57,10525.3544,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3544,1)=X S X=Y(9002313.57,10525.3544,1),Y(9002313.57,10525.3544,2)=X S X=20
"^DD",9002313.57,9002313.57,10525.3544,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10525.3544,21,1,0)
Actual DUR text
"^DD",9002313.57,9002313.57,10525.3999,0)
DUR #3 RESERVE SPACE^CJ4^^ ; ^X ^DD(9002313.57,10525.3999,9.2) S Y(9002313.57,10525.3999,3)=X S X=53,X=$E(Y(9002313.57,10525.3999,2),Y(9002313.57,10525.3999,3),X)
"^DD",9002313.57,9002313.57,10525.3999,9)
^
"^DD",9002313.57,9002313.57,10525.3999,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3999,9.1)
$E(DUR #3 RAW DATA,50,53)
"^DD",9002313.57,9002313.57,10525.3999,9.2)
X $P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3999,1)=X S X=Y(9002313.57,10525.3999,1),Y(9002313.57,10525.3999,2)=X S X=50
"^DD",9002313.57,9002313.57,10525.3999,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10525.3999,21,1,0)
Reserved space for additional information.
"^DD",9002313.57,9002313.57,10526,0)
ADDITIONAL MESSAGE INFORMATION^CJ200^^ ; ^S X=$$FIELD^BPSOS57(526)
"^DD",9002313.57,9002313.57,10526,9)
^
"^DD",9002313.57,9002313.57,10526,9.01)

"^DD",9002313.57,9002313.57,10526,9.1)
S X=$$FIELD^BPSOS57(526)
"^DD",9002313.57,9002313.57,10526,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10526,21,1,0)
Free text, additional information from the payor.
"^DD",9002313.57,9002313.57,10528,0)
CLINICAL SIGNIFICANCE CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(528)
"^DD",9002313.57,9002313.57,10528,9)
^
"^DD",9002313.57,9002313.57,10528,9.01)

"^DD",9002313.57,9002313.57,10528,9.1)
S X=$$FIELD^BPSOS57(528)
"^DD",9002313.57,9002313.57,10528,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10529,0)
OTHER PHARMACY INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(529)
"^DD",9002313.57,9002313.57,10529,9)
^
"^DD",9002313.57,9002313.57,10529,9.01)

"^DD",9002313.57,9002313.57,10529,9.1)
S X=$$FIELD^BPSOS57(529)
"^DD",9002313.57,9002313.57,10529,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10530,0)
PREVIOUS DATE OF FILL^CJ8^^ ; ^S X=$$FIELD^BPSOS57(530)
"^DD",9002313.57,9002313.57,10530,9)
^
"^DD",9002313.57,9002313.57,10530,9.01)

"^DD",9002313.57,9002313.57,10530,9.1)
S X=$$FIELD^BPSOS57(530)
"^DD",9002313.57,9002313.57,10530,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10530,21,1,0)
Fill date of the prescription causing the DUR conflict.
"^DD",9002313.57,9002313.57,10531,0)
QUANTITY OF PREVIOUS FILL^CJ5^^ ; ^S X=$$FIELD^BPSOS57(531)
"^DD",9002313.57,9002313.57,10531,9)
^
"^DD",9002313.57,9002313.57,10531,9.01)

"^DD",9002313.57,9002313.57,10531,9.1)
S X=$$FIELD^BPSOS57(531)
"^DD",9002313.57,9002313.57,10531,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10531,21,1,0)
Quantity of the prescription causing the conflict.
"^DD",9002313.57,9002313.57,10532,0)
DATABASE INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(532)
"^DD",9002313.57,9002313.57,10532,9)
^
"^DD",9002313.57,9002313.57,10532,9.01)

"^DD",9002313.57,9002313.57,10532,9.1)
S X=$$FIELD^BPSOS57(532)
"^DD",9002313.57,9002313.57,10532,21,0)
^^6^6^3040106^
"^DD",9002313.57,9002313.57,10532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10533,0)
OTHER PRESCRIBER INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(533)
"^DD",9002313.57,9002313.57,10533,9)
^
"^DD",9002313.57,9002313.57,10533,9.01)

"^DD",9002313.57,9002313.57,10533,9.1)
S X=$$FIELD^BPSOS57(533)
"^DD",9002313.57,9002313.57,10533,21,0)
^^3^3^3040106^
"^DD",9002313.57,9002313.57,10533,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10533,21,2,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10533,21,3,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10535,0)
DUR OVERFLOW^CJ1^^ ; ^S X=$$FIELD^BPSOS57(535)
"^DD",9002313.57,9002313.57,10535,9)
^
"^DD",9002313.57,9002313.57,10535,9.01)

"^DD",9002313.57,9002313.57,10535,9.1)
S X=$$FIELD^BPSOS57(535)
"^DD",9002313.57,9002313.57,10535,21,0)
^^2^2^3040106^
"^DD",9002313.57,9002313.57,10535,21,1,0)
Additional DUR information that did not fit in the other 
"^DD",9002313.57,9002313.57,10535,21,2,0)
fields provided.
"^DD",9002313.57,9002313.57,10544,0)
FREE TEXT^CJ30^^ ; ^S X=$$FIELD^BPSOS57(544)
"^DD",9002313.57,9002313.57,10544,9)
^
"^DD",9002313.57,9002313.57,10544,9.01)

"^DD",9002313.57,9002313.57,10544,9.1)
S X=$$FIELD^BPSOS57(544)
"^DD",9002313.57,9002313.57,10544,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10544,21,1,0)
Even more room for additional free text DUR information.
"^DD",9002313.57,9002313.57111,0)
COMMENT MULTIPLE SUB-FIELD^^.03^3
"^DD",9002313.57,9002313.57111,0,"DT")
3050527
"^DD",9002313.57,9002313.57111,0,"IX","B",9002313.57111,.01)

"^DD",9002313.57,9002313.57111,0,"NM","COMMENT MULTIPLE")

"^DD",9002313.57,9002313.57111,0,"UP")
9002313.57
"^DD",9002313.57,9002313.57111,.01,0)
DATE^D^^0;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57111,.01,1,0)
^.1
"^DD",9002313.57,9002313.57111,.01,1,1,0)
9002313.57111^B
"^DD",9002313.57,9002313.57111,.01,1,1,1)
S ^BPSTL(DA(1),11,"B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57111,.01,1,1,2)
K ^BPSTL(DA(1),11,"B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57111,.01,21,0)
^.001^1^1^3050527^^^
"^DD",9002313.57,9002313.57111,.01,21,1,0)
To store user's comment date
"^DD",9002313.57,9002313.57111,.01,"DT")
3050527
"^DD",9002313.57,9002313.57111,.02,0)
USER^P200'^VA(200,^0;2^Q
"^DD",9002313.57,9002313.57111,.02,21,0)
^.001^1^1^3050629^^
"^DD",9002313.57,9002313.57111,.02,21,1,0)
ECME user
"^DD",9002313.57,9002313.57111,.02,"DT")
3050527
"^DD",9002313.57,9002313.57111,.03,0)
COMMENT^F^^0;3^K:$L(X)>74!($L(X)<1) X
"^DD",9002313.57,9002313.57111,.03,3)
Answer must be 1-74 characters in length.
"^DD",9002313.57,9002313.57111,.03,21,0)
^^1^1^3050527^
"^DD",9002313.57,9002313.57111,.03,21,1,0)
Comment text
"^DD",9002313.57,9002313.57111,.03,"DT")
3050527
"^DD",9002313.57,9002313.5713,0)
DUR DATA SUB-FIELD^^3^4
"^DD",9002313.57,9002313.5713,0,"DT")
3050615
"^DD",9002313.57,9002313.5713,0,"IX","B",9002313.5713,.01)

"^DD",9002313.57,9002313.5713,0,"NM","DUR DATA")

"^DD",9002313.57,9002313.5713,0,"UP")
9002313.57
"^DD",9002313.57,9002313.5713,.01,0)
DUR COUNTER^NJ4,0^^0;1^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.57,9002313.5713,.01,1,0)
^.1
"^DD",9002313.57,9002313.5713,.01,1,1,0)
9002313.5713^B
"^DD",9002313.57,9002313.5713,.01,1,1,1)
S ^BPSTL(DA(1),13,"B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.5713,.01,1,1,2)
K ^BPSTL(DA(1),13,"B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.5713,.01,3)
Type a number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.57,9002313.5713,.01,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,.01,21,1,0)
This is the field used to populate the 473-7E field of the claim
"^DD",9002313.57,9002313.5713,.01,"DT")
3050615
"^DD",9002313.57,9002313.5713,1,0)
DUR PROFESSIONAL SERVICE CODE^F^^0;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.5713,1,3)
Answer must be 1-2 characters in length
"^DD",9002313.57,9002313.5713,1,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,1,21,1,0)
This is the field used to populate the 439-E4 field of the claim
"^DD",9002313.57,9002313.5713,1,"DT")
3050615
"^DD",9002313.57,9002313.5713,2,0)
DUR REASON FOR SERVICE CODE^F^^0;3^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.5713,2,3)
Answer must be 1-2 characters in length
"^DD",9002313.57,9002313.5713,2,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,2,21,1,0)
This is the field used to populate the 440-E5 field of the claim
"^DD",9002313.57,9002313.5713,2,"DT")
3050615
"^DD",9002313.57,9002313.5713,3,0)
DUR RESULT OF SERVICE CODE^F^^0;4^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.5713,3,3)
Answer must be 1-2 characters in length
"^DD",9002313.57,9002313.5713,3,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,3,21,1,0)
This is the field used to populate the 441-E6 field of the claim
"^DD",9002313.57,9002313.5713,3,"DT")
3050615
"^DD",9002313.57,9002313.57902,0)
VA PINS MULTIPLE SUB-FIELD^^902.27^25
"^DD",9002313.57,9002313.57902,0,"DT")
3050913
"^DD",9002313.57,9002313.57902,0,"IX","B",9002313.57902,.01)

"^DD",9002313.57,9002313.57902,0,"NM","VA PINS MULTIPLE")

"^DD",9002313.57,9002313.57902,0,"UP")
9002313.57
"^DD",9002313.57,9002313.57902,.01,0)
PLAN ID^MP355.3'^IBA(355.3,^0;1^Q
"^DD",9002313.57,9002313.57902,.01,1,0)
^.1
"^DD",9002313.57,9002313.57902,.01,1,1,0)
9002313.57902^B
"^DD",9002313.57,9002313.57902,.01,1,1,1)
S ^BPSTL(DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57902,.01,1,1,2)
K ^BPSTL(DA(1),10,"B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57902,.01,3)
Enter the group insurance record
"^DD",9002313.57,9002313.57902,.01,21,0)
^^1^1^3050727^
"^DD",9002313.57,9002313.57902,.01,21,1,0)
Insurance plan id sent from the IB API
"^DD",9002313.57,9002313.57902,.01,"DT")
3050727
"^DD",9002313.57,9002313.57902,902.02,0)
PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.57,9002313.57902,902.02,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.02,21,1,0)
Payer sheet IEN to be used with the associated insurer.
"^DD",9002313.57,9002313.57902,902.02,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.03,0)
BIN^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.03,3)
Answer must be 1-10 characters in length.
"^DD",9002313.57,9002313.57902,902.03,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.03,21,1,0)
Card Issuer ID or Bank ID Number used for network routing.
"^DD",9002313.57,9002313.57902,902.03,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.04,0)
PCN^F^^1;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.04,3)
Answer must be 1-10 characters in length.
"^DD",9002313.57,9002313.57902,902.04,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.04,21,1,0)
Processor control number assigned for the payer sheet.
"^DD",9002313.57,9002313.57902,902.04,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.05,0)
GROUP ID^F^^1;3^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.05,3)
Answer must be 1-17 characters in length
"^DD",9002313.57,9002313.57902,902.05,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.05,21,1,0)
ID assigned to the cardholder group or employer group.
"^DD",9002313.57,9002313.57902,902.05,"DT")
3050913
"^DD",9002313.57,9002313.57902,902.06,0)
CARDHOLDER ID^F^^1;4^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.06,3)
Answer must be 1-20 characters in length.
"^DD",9002313.57,9002313.57902,902.06,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.06,21,1,0)
Insured person
"^DD",9002313.57,9002313.57902,902.06,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.07,0)
PATIENT RELATIONSHIP CODE^F^^1;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.07,3)
Answer must be 1 character in length.
"^DD",9002313.57,9002313.57902,902.07,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.07,21,1,0)
Patient relationship to insurance subscriber.
"^DD",9002313.57,9002313.57902,902.07,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.08,0)
CARDHOLDER FIRST NAME^F^^1;6^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.08,3)
Answer must be 1-12 characters in length.
"^DD",9002313.57,9002313.57902,902.08,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.08,21,1,0)
First name of the Cardholder/Subscriber. 
"^DD",9002313.57,9002313.57902,902.08,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.09,0)
CARDHOLDER LAST NAME^F^^1;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.09,3)
Answer must be 1-15 characters in length.
"^DD",9002313.57,9002313.57902,902.09,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.09,21,1,0)
Last name of the Cardholder/Subscriber. 
"^DD",9002313.57,9002313.57902,902.09,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.11,0)
HOME PLAN STATE^F^^1;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.11,3)
Answer must be 1-2 characters in length.
"^DD",9002313.57,9002313.57902,902.11,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.11,21,1,0)
Usually the state where the member lives or purchased their coverage.
"^DD",9002313.57,9002313.57902,902.11,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.12,0)
DISPENSING FEE SUBMITTED^F^^2;1^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.12,3)
Answer must be 1-8 characters in length.
"^DD",9002313.57,9002313.57902,902.12,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57902,902.12,21,1,0)
Fee amount submitted for the cost associated with dispensing this
"^DD",9002313.57,9002313.57902,902.12,21,2,0)
prescription. 
"^DD",9002313.57,9002313.57902,902.12,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.13,0)
BASIS OF COST DETERMINATION^F^^2;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.13,3)
Answer must be 1-2 characters in length.
"^DD",9002313.57,9002313.57902,902.13,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57902,902.13,21,1,0)
Code indicating the method by which 'Ingredient Cost Submitted' was
"^DD",9002313.57,9002313.57902,902.13,21,2,0)
calculated.
"^DD",9002313.57,9002313.57902,902.13,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.14,0)
USUAL & CUSTOMARY CHARGE^F^^2;3^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.14,3)
Answer must be 1-8 characters in length.
"^DD",9002313.57,9002313.57902,902.14,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57902,902.14,21,1,0)
Amount charged cash customers for the prescription exclusive of sales tax
"^DD",9002313.57,9002313.57902,902.14,21,2,0)
or other amounts claimed.
"^DD",9002313.57,9002313.57902,902.14,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.15,0)
GROSS AMOUNT DUE^F^^2;4^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.15,3)
Answer must be 1-8 characters in length.
"^DD",9002313.57,9002313.57902,902.15,21,0)
^^9^9^3031217^
"^DD",9002313.57,9002313.57902,902.15,21,1,0)
 Total price claimed from all sources.  For prescription claim request,
"^DD",9002313.57,9002313.57902,902.15,21,2,0)
field represents a sum of 'Ingredient Cost Submitted' (49-D9),
"^DD",9002313.57,9002313.57902,902.15,21,3,0)
'Dispensing Fee Submitted' (412-DC), 'Flat Sales Tax Amount
"^DD",9002313.57,9002313.57902,902.15,21,4,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted' (482-GE),
"^DD",9002313.57,9002313.57902,902.15,21,5,0)
'Incentive Amount Submitted' (438-E3), 'Other Amount Claimed' (48-H9).
"^DD",9002313.57,9002313.57902,902.15,21,6,0)
For service claim request, field represents a sum of 'Professional
"^DD",9002313.57,9002313.57902,902.15,21,7,0)
Services Fee Submitted' (477-BE), 'Flat Sales Tax Amount
"^DD",9002313.57,9002313.57902,902.15,21,8,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted'(482-GE),
"^DD",9002313.57,9002313.57902,902.15,21,9,0)
'Other Amount Claimed' (48-H9)
"^DD",9002313.57,9002313.57902,902.15,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.16,0)
ADMINISTRATIVE FEE^F^^2;5^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.16,3)
Answer must be 1-8 characters in length.
"^DD",9002313.57,9002313.57902,902.16,21,0)
^.001^1^1^3031217^^
"^DD",9002313.57,9002313.57902,902.16,21,1,0)
Fee charged for any costs related to preparing the prescription.
"^DD",9002313.57,9002313.57902,902.16,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.17,0)
VA FILL NUMBER^F^^2;6^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.17,3)
Answer must be 1-3 characters in length.
"^DD",9002313.57,9002313.57902,902.17,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.17,21,1,0)
Which fill/refill this transaction is for.
"^DD",9002313.57,9002313.57902,902.17,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.18,0)
SOFTWARE VENDOR/CERT ID^F^^2;7^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.18,3)
Answer must be 1-30 characters in length.
"^DD",9002313.57,9002313.57902,902.18,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57902,902.18,21,1,0)
Certification number assigned by payer to the sending entity,
"^DD",9002313.57,9002313.57902,902.18,21,2,0)
allowing claims to be sent.
"^DD",9002313.57,9002313.57902,902.18,"DT")
3030729
"^DD",9002313.57,9002313.57902,902.19,0)
B2 PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;3^Q
"^DD",9002313.57,9002313.57902,902.19,3)
Enter the Reversal payer sheet IEN.
"^DD",9002313.57,9002313.57902,902.19,21,0)
^.001^1^1^3031217^^
"^DD",9002313.57,9002313.57902,902.19,21,1,0)
Enter the Reversal payer sheet IEN.
"^DD",9002313.57,9002313.57902,902.19,"DT")
3031112
"^DD",9002313.57,9002313.57902,902.21,0)
B3 PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;4^Q
"^DD",9002313.57,9002313.57902,902.21,3)
Enter the Rebill payer sheet IEN.
"^DD",9002313.57,9002313.57902,902.21,21,0)
^^1^1^3031112^
"^DD",9002313.57,9002313.57902,902.21,21,1,0)
Enter the Rebill payer sheet IEN.
"^DD",9002313.57,9002313.57902,902.21,"DT")
3031112
"^DD",9002313.57,9002313.57902,902.22,0)
CERTIFY MODE^S^0:CERTIFY MODE ON;1:CERTIFY MODE OFF;^0;5^Q
"^DD",9002313.57,9002313.57902,902.22,3)
Enter null or 0 for Certify mode off.  Enter 1 for Certify mode on.
"^DD",9002313.57,9002313.57902,902.22,21,0)
^.001^1^1^3040421^^
"^DD",9002313.57,9002313.57902,902.22,21,1,0)
Enter null or 0 for Certify mode off.  Enter 1 for Certify mode on.
"^DD",9002313.57,9002313.57902,902.22,"DT")
3031112
"^DD",9002313.57,9002313.57902,902.23,0)
CERT IEN^NJ10,0^^0;6^K:+X'=X!(X>9999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.57,9002313.57902,902.23,3)
Type a Number between 1 and 9999999999, 0 Decimal Digits
"^DD",9002313.57,9002313.57902,902.23,21,0)
^.001^2^2^3031113^^
"^DD",9002313.57,9002313.57902,902.23,21,1,0)
This field is used during certification testing, and contains the pointer 
"^DD",9002313.57,9002313.57902,902.23,21,2,0)
to the Certification file 9002313.31.
"^DD",9002313.57,9002313.57902,902.23,"DT")
3031113
"^DD",9002313.57,9002313.57902,902.24,0)
PLAN NAME^F^^0;7^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.24,3)
Answer must be 1-40 characters in length.
"^DD",9002313.57,9002313.57902,902.24,21,0)
^^1^1^3041014^
"^DD",9002313.57,9002313.57902,902.24,21,1,0)
This field is the Plan Name for the insurance being filed.
"^DD",9002313.57,9002313.57902,902.24,"DT")
3041014
"^DD",9002313.57,9002313.57902,902.25,0)
GROUP NAME^F^^3;1^K:$L(X)>20!($L(X)<2) X
"^DD",9002313.57,9002313.57902,902.25,3)
Answer must be 2-20 characters in length
"^DD",9002313.57,9002313.57902,902.25,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.57902,902.25,21,1,0)
This is the Group Name for the Group Insurance file
"^DD",9002313.57,9002313.57902,902.25,"DT")
3050913
"^DD",9002313.57,9002313.57902,902.26,0)
INSURANCE CO PHONE #^F^^3;2^K:$L(X)>20!($L(X)<7) X
"^DD",9002313.57,9002313.57902,902.26,3)
Answer must be 7-20 characters in length
"^DD",9002313.57,9002313.57902,902.26,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.57902,902.26,21,1,0)
This is the Claims (RX) phone number from the Insurance Company file
"^DD",9002313.57,9002313.57902,902.26,"DT")
3050615
"^DD",9002313.57,9002313.57902,902.27,0)
PHARMACY PLAN ID^F^^3;3^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.27,3)
Answer must be 1-30 characters in length
"^DD",9002313.57,9002313.57902,902.27,21,0)
^^1^1^3050617^
"^DD",9002313.57,9002313.57902,902.27,21,1,0)
This is a ID of the Plan file
"^DD",9002313.57,9002313.57902,902.27,"DT")
3050617
"^DD",9002313.58,9002313.58,0)
FIELD^^1103^55
"^DD",9002313.58,9002313.58,0,"DDA")
N
"^DD",9002313.58,9002313.58,0,"DT")
3031217
"^DD",9002313.58,9002313.58,0,"IX","B",9002313.58,.01)

"^DD",9002313.58,9002313.58,0,"NM","BPS STATISTICS")

"^DD",9002313.58,9002313.58,0,"VRPK")
BPS
"^DD",9002313.58,9002313.58,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.58,9002313.58,.01,1,0)
^.1
"^DD",9002313.58,9002313.58,.01,1,1,0)
9002313.58^B
"^DD",9002313.58,9002313.58,.01,1,1,1)
S ^BPSECX("S","B",$E(X,1,30),DA)=""
"^DD",9002313.58,9002313.58,.01,1,1,2)
K ^BPSECX("S","B",$E(X,1,30),DA)
"^DD",9002313.58,9002313.58,.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.58,9002313.58,.01,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,.01,21,1,0)
Name of the Statistical group.
"^DD",9002313.58,9002313.58,.01,"DT")
3031217
"^DD",9002313.58,9002313.58,2,0)
Date/Time Cleared^D^^0;2^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.58,9002313.58,2,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,2,21,1,0)
Date and time that the claim cleared the queue.
"^DD",9002313.58,9002313.58,2,"DT")
2991111
"^DD",9002313.58,9002313.58,101,0)
Submissions - Total^NJ9,0^^S;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,101,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,101,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,101,21,1,0)
Total number of submissions to ECME.
"^DD",9002313.58,9002313.58,101,"DT")
2991111
"^DD",9002313.58,9002313.58,102,0)
Submissions - Unique^NJ9,0^^S;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,102,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,102,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,102,21,1,0)
Total number of unique claim submissions to ECME.
"^DD",9002313.58,9002313.58,102,"DT")
2991111
"^DD",9002313.58,9002313.58,103,0)
Submissions - Repeat^NJ9,0^^S;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,103,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,103,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,103,21,1,0)
Total number of repeat claim submissions to ECME.
"^DD",9002313.58,9002313.58,103,"DT")
2991111
"^DD",9002313.58,9002313.58,200,0)
Result - Count^CJ9,0^^ ; ^S X=$G(^BPSECX("S",D0,"R")),X=$P(X,U,2)+$P(X,U,3)+$P(X,U,4)+$P(X,U,5)
"^DD",9002313.58,9002313.58,200,9)
^
"^DD",9002313.58,9002313.58,200,9.01)

"^DD",9002313.58,9002313.58,200,9.1)
S X=$G(^BPSECX("S",D0,"R")),X=$P(X,U,2)+$P(X,U,3)+$P(X,U,4)+$P(X,U,5)
"^DD",9002313.58,9002313.58,200,21,0)
^^1^1^3040331^
"^DD",9002313.58,9002313.58,200,21,1,0)
Total number of claims for which a response was received.
"^DD",9002313.58,9002313.58,200,"DT")
3040331
"^DD",9002313.58,9002313.58,201,0)
Result - Unbillable^NJ9,0^^R;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,201,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,201,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,201,21,1,0)
Total number of claims that were unbillable.
"^DD",9002313.58,9002313.58,201,"DT")
2991111
"^DD",9002313.58,9002313.58,202,0)
Result - Rejected^NJ9,0^^R;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,202,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,202,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,202,21,1,0)
Total number of claims that were rejected by the payer.
"^DD",9002313.58,9002313.58,202,"DT")
2991111
"^DD",9002313.58,9002313.58,203,0)
Result - Paid^NJ9,0^^R;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,203,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,203,21,0)
^^1^1^3040322^
"^DD",9002313.58,9002313.58,203,21,1,0)
Total number of claims that were paid by the payer.
"^DD",9002313.58,9002313.58,203,"DT")
2991111
"^DD",9002313.58,9002313.58,204,0)
Result - Duplicate^NJ9,0^^R;4^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,204,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,204,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,204,21,1,0)
Total number of claims for which a duplicate result was received.
"^DD",9002313.58,9002313.58,204,"DT")
2991111
"^DD",9002313.58,9002313.58,205,0)
Result - Captured^NJ9,0^^R;5^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,205,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,205,21,0)
^^2^2^3031217^
"^DD",9002313.58,9002313.58,205,21,1,0)
Total number of claims that was captured by the payer but has not been 
"^DD",9002313.58,9002313.58,205,21,2,0)
adjudicated by the payer yet.
"^DD",9002313.58,9002313.58,205,"DT")
2991111
"^DD",9002313.58,9002313.58,219,0)
Result - Other^NJ9,0^^R;19^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,219,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,219,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,219,21,1,0)
Total number of claims that did not fall into the other categories.
"^DD",9002313.58,9002313.58,219,"DT")
2991111
"^DD",9002313.58,9002313.58,301,0)
$ Paid^NJ12,2^^M;1^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999999.99)!(X<0) X
"^DD",9002313.58,9002313.58,301,3)
Type a Dollar Amount between 0 and 999999999.99, 2 Decimal Digits
"^DD",9002313.58,9002313.58,301,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,301,21,1,0)
Total dollar amount of paid claims.
"^DD",9002313.58,9002313.58,301,"DT")
2991111
"^DD",9002313.58,9002313.58,302,0)
$ Copay^NJ12,2^^M;2^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999999.99)!(X<0) X
"^DD",9002313.58,9002313.58,302,3)
Type a Dollar Amount between 0 and 999999999.99, 2 Decimal Digits
"^DD",9002313.58,9002313.58,302,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,302,21,1,0)
Total Copay amount for claims.
"^DD",9002313.58,9002313.58,302,"DT")
2991111
"^DD",9002313.58,9002313.58,402,0)
Comms - Send Packets^NJ9,0^^C;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,402,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,402,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,402,21,1,0)
Total number of packets sent from ECME.
"^DD",9002313.58,9002313.58,402,"DT")
2991111
"^DD",9002313.58,9002313.58,403,0)
Comms - Send Bytes^NJ9,0^^C;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,403,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,403,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,403,21,1,0)
Total number of bytes sent through ECME.
"^DD",9002313.58,9002313.58,403,"DT")
2991111
"^DD",9002313.58,9002313.58,404,0)
Comms - Receive Packets^NJ9,0^^C;4^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,404,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,404,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,404,21,1,0)
Total number of packets received back from the payer.
"^DD",9002313.58,9002313.58,404,"DT")
2991111
"^DD",9002313.58,9002313.58,405,0)
Comms - Receive Bytes^NJ9,0^^C;5^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,405,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,405,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,405,21,1,0)
Total number of bytes received back from the payer.
"^DD",9002313.58,9002313.58,405,"DT")
2991111
"^DD",9002313.58,9002313.58,406,0)
Comms - Ignored Message^NJ9,0^^C;6^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,406,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,406,21,0)
^^1^1^3040322^
"^DD",9002313.58,9002313.58,406,21,1,0)
Total number of communications with ignored messages.
"^DD",9002313.58,9002313.58,406,"DT")
2991115
"^DD",9002313.58,9002313.58,407,0)
Comms - Send ACK^NJ9,0^^C;7^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,407,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,407,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,407,21,1,0)
Number of communication acknowledgements sent.
"^DD",9002313.58,9002313.58,407,"DT")
2991111
"^DD",9002313.58,9002313.58,408,0)
Comms - Send NAK^NJ9,0^^C;8^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,408,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,408,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,408,21,1,0)
Number of "NO ACKNOWLEDGMENTS" sent. 
"^DD",9002313.58,9002313.58,408,"DT")
2991111
"^DD",9002313.58,9002313.58,409,0)
Comms - Send EOT^NJ9,0^^C;9^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,409,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,409,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,409,21,1,0)
Number of end of transmission communications sent.
"^DD",9002313.58,9002313.58,409,"DT")
2991115
"^DD",9002313.58,9002313.58,411,0)
Comms - TCode 01^NJ9,0^^C;11^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,411,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,411,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,411,21,1,0)
Number of claims in dial out mode.
"^DD",9002313.58,9002313.58,411,"DT")
2991111
"^DD",9002313.58,9002313.58,412,0)
Comms - TCode 02^NJ9,0^^C;12^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,412,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,412,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,412,21,1,0)
Number of claims in sending/connect mode.
"^DD",9002313.58,9002313.58,412,"DT")
2991111
"^DD",9002313.58,9002313.58,413,0)
Comms - TCode 03^NJ9,0^^C;13^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,413,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,413,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,413,21,1,0)
Number of claims in receiving error mode.
"^DD",9002313.58,9002313.58,413,"DT")
2991111
"^DD",9002313.58,9002313.58,414,0)
Comms - TCode 04^RNJ9,0^^C;14^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,414,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,414,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,414,21,1,0)
Number of claims in no carrier detected mode.
"^DD",9002313.58,9002313.58,414,"DT")
2991111
"^DD",9002313.58,9002313.58,415,0)
Comms - TCode 11^NJ9,0^^C;15^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,415,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,415,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,415,21,1,0)
Number of claims in "other" mode.
"^DD",9002313.58,9002313.58,415,"DT")
2991111
"^DD",9002313.58,9002313.58,419,0)
Comms - TCode Other^NJ9,0^^C;19^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,419,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,419,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,419,21,1,0)
Number of claims in "other" mode.
"^DD",9002313.58,9002313.58,419,"DT")
2991111
"^DD",9002313.58,9002313.58,501,0)
Comms - Transaction Time Comms^NJ9,0^^CT;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,501,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,501,21,0)
^^3^3^2991115^
"^DD",9002313.58,9002313.58,501,21,1,0)
The time it takes from ENQ received from host through sending ACK.
"^DD",9002313.58,9002313.58,501,21,2,0)
That is, the time we're directly communicating with the modem on behalf of
"^DD",9002313.58,9002313.58,501,21,3,0)
this packet.
"^DD",9002313.58,9002313.58,501,"DT")
2991115
"^DD",9002313.58,9002313.58,601,0)
Dial Session - Count^NJ9,0^^D;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,601,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,601,21,0)
^.001^1^1^3031217^^
"^DD",9002313.58,9002313.58,601,21,1,0)
How many times we have dialed the phone.
"^DD",9002313.58,9002313.58,601,"DT")
2991115
"^DD",9002313.58,9002313.58,602,0)
Dial Session - Packets^NJ9,0^^D;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,602,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,602,21,0)
^^2^2^2991115^
"^DD",9002313.58,9002313.58,602,21,1,0)
How many packets were transmit-received.
"^DD",9002313.58,9002313.58,602,21,2,0)
(So this field / #601 = avg # packets handled for a dial-up session.)
"^DD",9002313.58,9002313.58,602,"DT")
2991115
"^DD",9002313.58,9002313.58,603,0)
Dial Session - Error^NJ9,0^^D;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,603,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,603,21,0)
^^3^3^2991115^
"^DD",9002313.58,9002313.58,603,21,1,0)
How many times a dial-up session returned an error.
"^DD",9002313.58,9002313.58,603,21,2,0)
Even if it did a zillion transactions successfully and then returned an
"^DD",9002313.58,9002313.58,603,21,3,0)
error, this counter gets incremented.
"^DD",9002313.58,9002313.58,603,"DT")
2991115
"^DD",9002313.58,9002313.58,604,0)
Dial Session - No connect^NJ9,0^^D;4^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,604,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,604,21,0)
^^1^1^2991115^
"^DD",9002313.58,9002313.58,604,21,1,0)
How many times we dialed the phone and didn't get connected.
"^DD",9002313.58,9002313.58,604,"DT")
2991115
"^DD",9002313.58,9002313.58,701,0)
Comms Response - Not STX^NJ9,0^^CR;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,701,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,701,21,0)
^^2^2^2991115^
"^DD",9002313.58,9002313.58,701,21,1,0)
How many times we sent a message and didn't get an STX in reply as
"^DD",9002313.58,9002313.58,701,21,2,0)
expected.
"^DD",9002313.58,9002313.58,701,"DT")
2991115
"^DD",9002313.58,9002313.58,702,0)
Comms Response - ENQ^NJ9,0^^CR;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,702,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,702,21,0)
^^2^2^2991115^
"^DD",9002313.58,9002313.58,702,21,1,0)
How many times we sent a claim, expecting STX with a response to follow,
"^DD",9002313.58,9002313.58,702,21,2,0)
but got ENQ instead.
"^DD",9002313.58,9002313.58,702,"DT")
2991115
"^DD",9002313.58,9002313.58,703,0)
Comms Response - NAK^NJ9,0^^CR;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,703,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,703,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,703,21,1,0)
Number of "No Acknowledgements" responses received.
"^DD",9002313.58,9002313.58,703,"DT")
2991115
"^DD",9002313.58,9002313.58,704,0)
Comms Response - +++^NJ9,0^^CR;4^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,704,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,704,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,704,21,1,0)
Number of +++ responses received.
"^DD",9002313.58,9002313.58,704,"DT")
2991115
"^DD",9002313.58,9002313.58,705,0)
Comms Response - Null^NJ9,0^^CR;5^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,705,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,705,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,705,21,1,0)
Number of null responses received.
"^DD",9002313.58,9002313.58,705,"DT")
2991115
"^DD",9002313.58,9002313.58,709,0)
Comms Response - Other^NJ9,0^^CR;9^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,709,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,709,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,709,21,1,0)
Number of miscellaneous responses received.
"^DD",9002313.58,9002313.58,709,"DT")
2991115
"^DD",9002313.58,9002313.58,719,0)
Comms - ENQ not received^NJ9,0^^CR;19^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,719,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,719,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,719,21,1,0)
Number of communications inquiries that did not receive a carriage return.
"^DD",9002313.58,9002313.58,719,"DT")
2991117
"^DD",9002313.58,9002313.58,801,0)
Comms - Receive No ETX^NJ9,0^^CR2;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,801,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,801,21,0)
^.001^4^4^3031217^^
"^DD",9002313.58,9002313.58,801,21,1,0)
Problems noted while receiving responses.
"^DD",9002313.58,9002313.58,801,21,2,0)
We sent claim.  We received STX. But something went wrong while receiving
"^DD",9002313.58,9002313.58,801,21,3,0)
the response and we never saw ETX.  Maybe a babbling connection that sent
"^DD",9002313.58,9002313.58,801,21,4,0)
too many bytes?
"^DD",9002313.58,9002313.58,801,"DT")
2991115
"^DD",9002313.58,9002313.58,802,0)
Comms - EOT during response^NJ9,0^^CR2;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,802,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,802,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,802,21,1,0)
Number of end of transmissions during response receipt.
"^DD",9002313.58,9002313.58,802,"DT")
2991115
"^DD",9002313.58,9002313.58,803,0)
Comms - Null during response^NJ9,0^^CR2;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,803,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,803,21,0)
^^2^2^2991115^
"^DD",9002313.58,9002313.58,803,21,1,0)
Maybe we lost the connection while receiving response.
"^DD",9002313.58,9002313.58,803,21,2,0)
(An overt hang-up by the host should show up in piece 4, the +++)
"^DD",9002313.58,9002313.58,803,"DT")
2991115
"^DD",9002313.58,9002313.58,804,0)
Comms - +++ during response^NJ9,0^^CR2;4^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,804,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,804,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,804,21,1,0)
Number of +++ received during response receipt.
"^DD",9002313.58,9002313.58,804,"DT")
2991115
"^DD",9002313.58,9002313.58,809,0)
Comms - Other during response^NJ9,0^^CR2;9^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,809,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,809,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,809,21,1,0)
Number of "other" types of communication received for responses.
"^DD",9002313.58,9002313.58,809,"DT")
2991115
"^DD",9002313.58,9002313.58,901,0)
Comms - Response to NAK count^NJ9,0^^CRN;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,901,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,901,21,0)
^^3^3^2991115^
"^DD",9002313.58,9002313.58,901,21,1,0)
We sent a NAK; the count is in field 408.
"^DD",9002313.58,9002313.58,901,21,2,0)
This field counts the replies to our NAKs, should = 408, shouldn't it?
"^DD",9002313.58,9002313.58,901,21,3,0)
Types of responses to NAK are in the following pieces.
"^DD",9002313.58,9002313.58,901,"DT")
2991115
"^DD",9002313.58,9002313.58,902,0)
Comms - Response to NAK STX^NJ9,0^^CRN;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,902,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,902,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,902,21,1,0)
Number of communication responses to "No acknowledgement start of text".
"^DD",9002313.58,9002313.58,902,"DT")
2991115
"^DD",9002313.58,9002313.58,903,0)
Comms - Response to NAK null^NJ9,0^^CRN;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,903,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,903,21,0)
^^1^1^3040331^
"^DD",9002313.58,9002313.58,903,21,1,0)
Number of respsonse to "No Acknowledgement null CRN".
"^DD",9002313.58,9002313.58,903,"DT")
3040331
"^DD",9002313.58,9002313.58,904,0)
Comms - Response to NAK +++^NJ9,0^^CRN;4^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,904,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,904,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,904,21,1,0)
Number of communication response to "No acknowledgement +++ CRN".
"^DD",9002313.58,9002313.58,904,"DT")
2991115
"^DD",9002313.58,9002313.58,909,0)
Comms - Response to NAK other^NJ9,0^^CRN;9^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,909,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,909,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,909,21,1,0)
Number of communication responses to "No acknowledgement other CRN".
"^DD",9002313.58,9002313.58,909,"DT")
2991115
"^DD",9002313.58,9002313.58,1001,0)
ABSBPOSV FILEARAY count^NJ9,0^^ABSBPOSV;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,1001,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,1001,21,0)
^.001^1^1^3031217^^^
"^DD",9002313.58,9002313.58,1001,21,1,0)
How many times FILEARAY was called to start the claims submission process.
"^DD",9002313.58,9002313.58,1001,"DT")
2991115
"^DD",9002313.58,9002313.58,1002,0)
ABSBPOSV FILEARAY # of claims^NJ9,0^^ABSBPOSV;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,1002,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,1002,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,1002,21,1,0)
How many times FILARAY was called to retrieve visit file information.
"^DD",9002313.58,9002313.58,1002,"DT")
2991115
"^DD",9002313.58,9002313.58,1101,0)
VISIT Found by PCC link^NJ9,0^^V;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,1101,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,1101,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,1101,21,1,0)
How many times PCC link found visit information.
"^DD",9002313.58,9002313.58,1101,"DT")
2991115
"^DD",9002313.58,9002313.58,1102,0)
VISIT Found by AA index^NJ9,0^^V;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,1102,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,1102,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,1102,21,1,0)
How many times the visit was found by the AA index.
"^DD",9002313.58,9002313.58,1102,"DT")
2991115
"^DD",9002313.58,9002313.58,1103,0)
VISIT Created new^NJ9,0^^V;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.58,9002313.58,1103,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",9002313.58,9002313.58,1103,21,0)
^^1^1^3031217^
"^DD",9002313.58,9002313.58,1103,21,1,0)
How many times a new visit was created.
"^DD",9002313.58,9002313.58,1103,"DT")
2991115
"^DD",9002313.59,9002313.59,0)
FIELD^^9999.99^70
"^DD",9002313.59,9002313.59,0,"DDA")
N
"^DD",9002313.59,9002313.59,0,"DT")
3051207
"^DD",9002313.59,9002313.59,0,"IX","AC",9002313.59,5)

"^DD",9002313.59,9002313.59,0,"IX","AD",9002313.59,1)

"^DD",9002313.59,9002313.59,0,"IX","AE",9002313.59,3)

"^DD",9002313.59,9002313.59,0,"IX","AER",9002313.59,401)

"^DD",9002313.59,9002313.59,0,"IX","AF",9002313.59,4)

"^DD",9002313.59,9002313.59,0,"IX","AFR",9002313.59,402)

"^DD",9002313.59,9002313.59,0,"IX","AG",9002313.59,13)

"^DD",9002313.59,9002313.59,0,"IX","AH",9002313.59,7)

"^DD",9002313.59,9002313.59,0,"IX","AR",9002313.59,.15)

"^DD",9002313.59,9002313.59,0,"IX","B",9002313.59,.01)

"^DD",9002313.59,9002313.59,0,"NM","BPS TRANSACTION")

"^DD",9002313.59,9002313.59,0,"PT",9002313.4,101.06)

"^DD",9002313.59,9002313.59,0,"PT",9002313.92,1.11)

"^DD",9002313.59,9002313.59,0,"VRPK")
BPS
"^DD",9002313.59,9002313.59,.01,0)
ENTRY#^RF^^0;1^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.59,9002313.59,.01,1,0)
^.1
"^DD",9002313.59,9002313.59,.01,1,1,0)
9002313.59^B
"^DD",9002313.59,9002313.59,.01,1,1,1)
S ^BPST("B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,.01,1,1,2)
K ^BPST("B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,.01,3)
Answer must be 1-20 characters in length.
"^DD",9002313.59,9002313.59,.01,21,0)
^.001^1^1^3040326^^
"^DD",9002313.59,9002313.59,.01,21,1,0)
Transaction entry number.
"^DD",9002313.59,9002313.59,.01,"DT")
3031125
"^DD",9002313.59,9002313.59,.13,0)
TYPE^S^1:PRESCRIPTION;2:POSTAGE FOR PRESCRIPTION;3:NON-PRESCRIPTION;^0;13^Q
"^DD",9002313.59,9002313.59,.13,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,.13,21,1,0)
Textual description of the transaction type.
"^DD",9002313.59,9002313.59,.13,"DT")
3031125
"^DD",9002313.59,9002313.59,.14,0)
ORIGIN^P9002313.516'^BPS(9002313.516,^0;14^Q
"^DD",9002313.59,9002313.59,.14,21,0)
^^1^1^3040126^
"^DD",9002313.59,9002313.59,.14,21,1,0)
Pointer to show where the data came from (IHS)
"^DD",9002313.59,9002313.59,.14,"DT")
3001117
"^DD",9002313.59,9002313.59,.15,0)
POSTED TO A/R^F^^0;15^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.59,9002313.59,.15,1,0)
^.1
"^DD",9002313.59,9002313.59,.15,1,1,0)
9002313.59^AR
"^DD",9002313.59,9002313.59,.15,1,1,1)
S ^BPST("AR",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,.15,1,1,2)
K ^BPST("AR",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,.15,1,1,"DT")
3010105
"^DD",9002313.59,9002313.59,.15,3)
Answer must be 1-30 characters in length.
"^DD",9002313.59,9002313.59,.15,21,0)
^^1^1^3010105^
"^DD",9002313.59,9002313.59,.15,21,1,0)
Not applicable to 9002313.59.  See 9002313.57 for usage there.
"^DD",9002313.59,9002313.59,.15,"DT")
3010105
"^DD",9002313.59,9002313.59,.16,0)
NEEDS BILLING (N/A)^F^^0;16^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.59,9002313.59,.16,3)
Answer must be 1 character in length.
"^DD",9002313.59,9002313.59,.16,21,0)
^^1^1^3010124^
"^DD",9002313.59,9002313.59,.16,21,1,0)
Placeholder - this field is used in 9002313.57.
"^DD",9002313.59,9002313.59,.16,"DT")
3010124
"^DD",9002313.59,9002313.59,1,0)
STATUS^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.59,9002313.59,1,1,0)
^.1
"^DD",9002313.59,9002313.59,1,1,1,0)
9002313.59^AD
"^DD",9002313.59,9002313.59,1,1,1,1)
S ^BPST("AD",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,1,1,1,2)
K ^BPST("AD",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,1,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,1,3)
Type a Number between 0 and 99, 0 Decimal Digits
"^DD",9002313.59,9002313.59,1,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,1,21,1,0)
Textual description of the transaction status.
"^DD",9002313.59,9002313.59,1,"DT")
3031125
"^DD",9002313.59,9002313.59,1.05,0)
ABSBDIV SOURCE^S^1:59 OUTPATIENT SITE;2:59.4 INPATIENT SITE;^1;5^Q
"^DD",9002313.59,9002313.59,1.05,21,0)
^^3^3^3000311^
"^DD",9002313.59,9002313.59,1.05,21,1,0)
Reserved: to indicate from where ABSBDIV was obtained; when you try to map
"^DD",9002313.59,9002313.59,1.05,21,2,0)
this back to a pharmacy in 9002313.56, you know which subscript to look
"^DD",9002313.59,9002313.59,1.05,21,3,0)
under.
"^DD",9002313.59,9002313.59,1.05,"DT")
3000311
"^DD",9002313.59,9002313.59,1.06,0)
INSURER^F^^1;6^K:$L(X)>35!($L(X)<5) X
"^DD",9002313.59,9002313.59,1.06,3)
Answer must be 5-35 characters in length.
"^DD",9002313.59,9002313.59,1.06,21,0)
^.001^3^3^3040112^^^^
"^DD",9002313.59,9002313.59,1.06,21,1,0)
Pointer to both INSURER (^AUTNINS) and BPS INSURER (^BPSEI)
"^DD",9002313.59,9002313.59,1.06,21,2,0)
$D(^BPSEI(n,100))
"^DD",9002313.59,9002313.59,1.06,21,3,0)
then see details of how to send this claim electronically
"^DD",9002313.59,9002313.59,1.06,"DT")
3040112
"^DD",9002313.59,9002313.59,1.07,0)
PHARMACY^P9002313.56'^BPS(9002313.56,^1;7^Q
"^DD",9002313.59,9002313.59,1.07,21,0)
^^1^1^3040322^
"^DD",9002313.59,9002313.59,1.07,21,1,0)
Textual description of the Pharmacy involved with this transaction.
"^DD",9002313.59,9002313.59,1.07,"DT")
3031125
"^DD",9002313.59,9002313.59,1.08,0)
PINS PIECE^NJ1,0^^1;8^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.59,9002313.59,1.08,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",9002313.59,9002313.59,1.08,21,0)
^^5^5^3000318^^
"^DD",9002313.59,9002313.59,1.08,21,1,0)
Pointer to which of the PINS pieces in ^(6) is in use for this claim.
"^DD",9002313.59,9002313.59,1.08,21,2,0)
Use this to keep track of where you are in billing down the line to
"^DD",9002313.59,9002313.59,1.08,21,3,0)
various insurers.   (Probably won't automatically roll over to next
"^DD",9002313.59,9002313.59,1.08,21,4,0)
insurer, but maybe we will have an option to edit insurance info, try next
"^DD",9002313.59,9002313.59,1.08,21,5,0)
insurance, etc.)
"^DD",9002313.59,9002313.59,1.08,"DT")
3000318
"^DD",9002313.59,9002313.59,1.09,0)
PREAUTHORIZATION #^F^^1;9^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.59,9002313.59,1.09,3)
Answer must be 1-12 characters in length.
"^DD",9002313.59,9002313.59,1.09,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,1.09,21,1,0)
Number assigned by the processor to identify a preauthorized transaction.
"^DD",9002313.59,9002313.59,1.09,"DT")
3031125
"^DD",9002313.59,9002313.59,1.11,0)
ABSBRXI^P52'^PSRX(^1;11^Q
"^DD",9002313.59,9002313.59,1.11,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,1.11,21,1,0)
Pointer from the RX file into BPS Transactions.
"^DD",9002313.59,9002313.59,1.11,"DT")
3031125
"^DD",9002313.59,9002313.59,1.1199,0)
RXI INTERNAL^CJ8^^ ; ^S Y(9002313.59,1.1199,1)=$S($D(^BPST(D0,1)):^(1),1:"") S X=$P(Y(9002313.59,1.1199,1),U,11),X=X
"^DD",9002313.59,9002313.59,1.1199,9)
^
"^DD",9002313.59,9002313.59,1.1199,9.01)
9002313.59^1.11
"^DD",9002313.59,9002313.59,1.1199,9.1)
INTERNAL(ABSBRXI)
"^DD",9002313.59,9002313.59,1.1199,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,1.1199,21,1,0)
Internal ID to the claims file.
"^DD",9002313.59,9002313.59,1.1199,"DT")
3031125
"^DD",9002313.59,9002313.59,1.12,0)
RESUBMIT AFTER REVERSAL^S^1:RESUBMIT AFTER REVERSAL;0:DONE;2:RESUBMITTING;^1;12^Q
"^DD",9002313.59,9002313.59,1.12,3)
Enter the status of the resubmit
"^DD",9002313.59,9002313.59,1.12,21,0)
^.001^1^1^3051207^^^
"^DD",9002313.59,9002313.59,1.12,21,1,0)
Indicator that a transaction has been resubmitted after being backed out.
"^DD",9002313.59,9002313.59,1.12,"DT")
3051207
"^DD",9002313.59,9002313.59,1.13,0)
NCPDP OVERRIDES^P9002313.511'^BPS(9002313.511,^1;13^Q
"^DD",9002313.59,9002313.59,1.13,21,0)
^^1^1^3040126^
"^DD",9002313.59,9002313.59,1.13,21,1,0)
Override information for the NCPDP fields.
"^DD",9002313.59,9002313.59,1.13,"DT")
3001019
"^DD",9002313.59,9002313.59,1.14,0)
DUR/PPS Pointer^F^^1;14^K:$L(X)>120!($L(X)<5) X
"^DD",9002313.59,9002313.59,1.14,3)
Answer must be 5-120 characters in length.
"^DD",9002313.59,9002313.59,1.14,21,0)
^.001^1^1^3040112^^
"^DD",9002313.59,9002313.59,1.14,21,1,0)
Pointer to DUR/PPS code.
"^DD",9002313.59,9002313.59,1.14,"DT")
3040112
"^DD",9002313.59,9002313.59,1.15,0)
Prior Authorization Type Code^S^0:Not Specified;1:Prior Authorization;2:Medical Certification;3:EPSDT;4:Exemption from Copay;5:Exemption from RX;6:Family Plan. Indic.;7:AFDC;8:Payer Defined Exemption;^1;15^Q
"^DD",9002313.59,9002313.59,1.15,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,1.15,21,1,0)
Indicates the type of authorization made before transaction was submitted.
"^DD",9002313.59,9002313.59,1.15,"DT")
3031125
"^DD",9002313.59,9002313.59,3,0)
CLAIM^P9002313.02'^BPSC(^0;4^Q
"^DD",9002313.59,9002313.59,3,1,0)
^.1
"^DD",9002313.59,9002313.59,3,1,1,0)
9002313.59^AE
"^DD",9002313.59,9002313.59,3,1,1,1)
S ^BPST("AE",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,3,1,1,2)
K ^BPST("AE",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,3,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,3,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,3,21,1,0)
Claim number for this transaction.
"^DD",9002313.59,9002313.59,3,"DT")
3031125
"^DD",9002313.59,9002313.59,3.1,0)
CLAIM IEN^CJ8^^ ; ^S Y(9002313.59,3.1,1)=$S($D(^BPST(D0,0)):^(0),1:"") S X=$P(Y(9002313.59,3.1,1),U,4),X=X
"^DD",9002313.59,9002313.59,3.1,9)
^
"^DD",9002313.59,9002313.59,3.1,9.01)
9002313.59^3
"^DD",9002313.59,9002313.59,3.1,9.1)
INTERNAL(CLAIM)
"^DD",9002313.59,9002313.59,3.1,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,3.1,21,1,0)
Claim internal identifier for this transaction.
"^DD",9002313.59,9002313.59,3.1,"DT")
3031125
"^DD",9002313.59,9002313.59,4,0)
RESPONSE^P9002313.03'^BPSR(^0;5^Q
"^DD",9002313.59,9002313.59,4,1,0)
^.1
"^DD",9002313.59,9002313.59,4,1,1,0)
9002313.59^AF
"^DD",9002313.59,9002313.59,4,1,1,1)
S ^BPST("AF",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,4,1,1,2)
K ^BPST("AF",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,4,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,4,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,4,21,1,0)
Textual description of the response to this submission.
"^DD",9002313.59,9002313.59,4,"DT")
3031125
"^DD",9002313.59,9002313.59,4.0098,0)
RESULT WITH REVERSAL^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.59,9002313.59,4.0098,9)
^
"^DD",9002313.59,9002313.59,4.0098,9.01)

"^DD",9002313.59,9002313.59,4.0098,9.1)
S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.59,9002313.59,4.0098,21,0)
^^1^1^3040126^
"^DD",9002313.59,9002313.59,4.0098,21,1,0)
The overall result.
"^DD",9002313.59,9002313.59,4.0099,0)
RESULT^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,4.0099,9)
^
"^DD",9002313.59,9002313.59,4.0099,9.01)

"^DD",9002313.59,9002313.59,4.0099,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,4.0099,21,0)
^^1^1^3040126^
"^DD",9002313.59,9002313.59,4.0099,21,1,0)
The result of the transmission.
"^DD",9002313.59,9002313.59,4.1,0)
RESPONSE IEN^CJ8^^ ; ^S Y(9002313.59,4.1,1)=$S($D(^BPST(D0,0)):^(0),1:"") S X=$P(Y(9002313.59,4.1,1),U,5),X=X
"^DD",9002313.59,9002313.59,4.1,9)
^
"^DD",9002313.59,9002313.59,4.1,9.01)
9002313.59^4
"^DD",9002313.59,9002313.59,4.1,9.1)
INTERNAL(RESPONSE)
"^DD",9002313.59,9002313.59,4.1,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,4.1,21,1,0)
Internal identifier for the response.
"^DD",9002313.59,9002313.59,4.1,"DT")
3031125
"^DD",9002313.59,9002313.59,5,0)
PATIENT^P2'^DPT(^0;6^Q
"^DD",9002313.59,9002313.59,5,1,0)
^.1
"^DD",9002313.59,9002313.59,5,1,1,0)
9002313.59^AC
"^DD",9002313.59,9002313.59,5,1,1,1)
S ^BPST("AC",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,5,1,1,2)
K ^BPST("AC",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,5,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,5,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,5,21,1,0)
Patient name.
"^DD",9002313.59,9002313.59,5,"DT")
3040609
"^DD",9002313.59,9002313.59,7,0)
LAST UPDATE^D^^0;8^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59,7,1,0)
^.1
"^DD",9002313.59,9002313.59,7,1,1,0)
9002313.59^AH
"^DD",9002313.59,9002313.59,7,1,1,1)
S ^BPST("AH",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,7,1,1,2)
K ^BPST("AH",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,7,1,1,"DT")
2991028
"^DD",9002313.59,9002313.59,7,3)

"^DD",9002313.59,9002313.59,7,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,7,21,1,0)
Last date this record was updated.
"^DD",9002313.59,9002313.59,7,"DT")
3031125
"^DD",9002313.59,9002313.59,8,0)
VCPT^F^^1;3^K:$L(X)>15!($L(X)<8) X
"^DD",9002313.59,9002313.59,8,3)
Answer must be 8-15 characters in length.
"^DD",9002313.59,9002313.59,8,21,0)
^.001^2^2^3040126^^
"^DD",9002313.59,9002313.59,8,21,1,0)
Reference number assigned by the provider for the dispensed drug/product 
"^DD",9002313.59,9002313.59,8,21,2,0)
and/or service provided.
"^DD",9002313.59,9002313.59,8,"DT")
3040126
"^DD",9002313.59,9002313.59,8.0099,0)
VCPT-INTERNAL^CJ8^^ ; ^S Y(9002313.59,8.0099,1)=$S($D(^BPST(D0,1)):^(1),1:"") S X=$P(Y(9002313.59,8.0099,1),U,3),X=X
"^DD",9002313.59,9002313.59,8.0099,9)
^
"^DD",9002313.59,9002313.59,8.0099,9.01)
9002313.59^8
"^DD",9002313.59,9002313.59,8.0099,9.1)
INTERNAL(VCPT)
"^DD",9002313.59,9002313.59,8.0099,21,0)
^^2^2^3031125^
"^DD",9002313.59,9002313.59,8.0099,21,1,0)
Internal ID to reference number assigned by the provider for the dispensed
"^DD",9002313.59,9002313.59,8.0099,21,2,0)
drug/product and/or service provided.
"^DD",9002313.59,9002313.59,8.0099,"DT")
3031125
"^DD",9002313.59,9002313.59,9,0)
ABSBRXR^F^^1;1^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.59,9002313.59,9,3)
Answer must be 1-5 characters in length.
"^DD",9002313.59,9002313.59,9,21,0)
^.001^1^1^3040120^^
"^DD",9002313.59,9002313.59,9,21,1,0)
Prescription number IEN.
"^DD",9002313.59,9002313.59,9,"DT")
2991025
"^DD",9002313.59,9002313.59,10,0)
ABSBNDC^F^^1;2^K:$L(X)>11!($L(X)<5) X
"^DD",9002313.59,9002313.59,10,3)
Answer must be 5-11 characters in length.
"^DD",9002313.59,9002313.59,10,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59,10,21,1,0)
The NDC number of the drug involved in this transaction.
"^DD",9002313.59,9002313.59,10,"DT")
3031006
"^DD",9002313.59,9002313.59,10.0099,0)
USER-INTERNAL^CJ8^^ ; ^S Y(9002313.59,10.0099,1)=$S($D(^BPST(D0,0)):^(0),1:"") S X=$P(Y(9002313.59,10.0099,1),U,10),X=X
"^DD",9002313.59,9002313.59,10.0099,9)
^
"^DD",9002313.59,9002313.59,10.0099,9.01)
9002313.59^13
"^DD",9002313.59,9002313.59,10.0099,9.1)
INTERNAL(USER)
"^DD",9002313.59,9002313.59,10.0099,21,0)
^^1^1^3040331^
"^DD",9002313.59,9002313.59,10.0099,21,1,0)
The DUZ of the user who sent the transaction.
"^DD",9002313.59,9002313.59,10.0099,"DT")
3040331
"^DD",9002313.59,9002313.59,11,0)
ABSBDIV^F^^1;4^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.59,9002313.59,11,3)
Answer must be 1-5 characters in length.
"^DD",9002313.59,9002313.59,11,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59,11,21,1,0)
The division ID for the transaction.
"^DD",9002313.59,9002313.59,11,"DT")
2991025
"^DD",9002313.59,9002313.59,12,0)
ABSBVISI^F^^0;7^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.59,9002313.59,12,3)
Answer must be 1-8 characters in length.
"^DD",9002313.59,9002313.59,12,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59,12,21,1,0)
The VISN ID of the transaction, if any.
"^DD",9002313.59,9002313.59,12,"DT")
2991025
"^DD",9002313.59,9002313.59,13,0)
USER^P200'^VA(200,^0;10^Q
"^DD",9002313.59,9002313.59,13,1,0)
^.1
"^DD",9002313.59,9002313.59,13,1,1,0)
9002313.59^AG
"^DD",9002313.59,9002313.59,13,1,1,1)
S ^BPST("AG",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,13,1,1,2)
K ^BPST("AG",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,13,1,1,"DT")
2991026
"^DD",9002313.59,9002313.59,13,21,0)
^^1^1^3040331^
"^DD",9002313.59,9002313.59,13,21,1,0)
User name who entered this tranaction.
"^DD",9002313.59,9002313.59,13,"DT")
3040331
"^DD",9002313.59,9002313.59,14,0)
POSITION IN CLAIM^NJ2,0^^0;9^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.59,9002313.59,14,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",9002313.59,9002313.59,14,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,14,21,1,0)
Sequential order in the claim transactions.
"^DD",9002313.59,9002313.59,14,"DT")
3031125
"^DD",9002313.59,9002313.59,15,0)
START TIME^D^^0;11^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59,15,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,15,21,1,0)
Time this transaction was started.
"^DD",9002313.59,9002313.59,15,"DT")
3031126
"^DD",9002313.59,9002313.59,16,0)
COMMS LOG^F^^0;12^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.59,9002313.59,16,3)
Answer must be 1-10 characters in length.
"^DD",9002313.59,9002313.59,16,21,0)
^^2^2^3001110^^
"^DD",9002313.59,9002313.59,16,21,1,0)
Points to the ^BPSECP("LOG",n) where the communications program which
"^DD",9002313.59,9002313.59,16,21,2,0)
handled the most recent phone call on behalf of this prescription.
"^DD",9002313.59,9002313.59,16,"DT")
2991027
"^DD",9002313.59,9002313.59,111,0)
COMMENT MULTIPLE^9002313.59111DA^^11;0
"^DD",9002313.59,9002313.59,111,21,0)
^.001^1^1^3050629^^
"^DD",9002313.59,9002313.59,111,21,1,0)
User's comment
"^DD",9002313.59,9002313.59,111,"DT")
3050627
"^DD",9002313.59,9002313.59,201,0)
RESULT CODE^NJ11,7^^2;1^K:+X'=X!(X>999.999)!(X<0)!(X?.E1"."8N.N) X
"^DD",9002313.59,9002313.59,201,3)
Type a Number between 0 and 999.999, 7 Decimal Digits
"^DD",9002313.59,9002313.59,201,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,201,21,1,0)
Code indicated the result of the adjudication of this claim.
"^DD",9002313.59,9002313.59,201,"DT")
3031126
"^DD",9002313.59,9002313.59,202,0)
RESULT TEXT^F^^2;2^K:$L(X)>200!($L(X)<1) X
"^DD",9002313.59,9002313.59,202,3)
Answer must be 1-200 characters in length.
"^DD",9002313.59,9002313.59,202,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,202,21,1,0)
Textual explanation of the result code.
"^DD",9002313.59,9002313.59,202,"DT")
3031126
"^DD",9002313.59,9002313.59,301,0)
CANCELLATION REQUESTED^F^^3;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.59,9002313.59,301,3)
Answer must be 1-10 characters in length.
"^DD",9002313.59,9002313.59,301,21,0)
^^2^2^3000831^
"^DD",9002313.59,9002313.59,301,21,1,0)
Actually a pointer to ^VA(200,
"^DD",9002313.59,9002313.59,301,21,2,0)
Who requested the cancellation
"^DD",9002313.59,9002313.59,301,"DT")
3000831
"^DD",9002313.59,9002313.59,302,0)
CANCELED DURING STATUS^F^^3;2^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.59,9002313.59,302,3)
Answer must be 1-5 characters in length.
"^DD",9002313.59,9002313.59,302,21,0)
^^4^4^3000831^
"^DD",9002313.59,9002313.59,302,21,1,0)
This field is null, until a cancellation is successful.
"^DD",9002313.59,9002313.59,302,21,2,0)
Then, the STATUS field is copied into here, primarily to
"^DD",9002313.59,9002313.59,302,21,3,0)
indicated that the cancellation was successful, and maybe
"^DD",9002313.59,9002313.59,302,21,4,0)
useful to know what the status was at the time it was canceled.
"^DD",9002313.59,9002313.59,302,"DT")
3000831
"^DD",9002313.59,9002313.59,401,0)
REVERSAL CLAIM^P9002313.02'^BPSC(^4;1^Q
"^DD",9002313.59,9002313.59,401,1,0)
^.1
"^DD",9002313.59,9002313.59,401,1,1,0)
9002313.59^AER
"^DD",9002313.59,9002313.59,401,1,1,1)
S ^BPST("AER",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,401,1,1,2)
K ^BPST("AER",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,401,1,1,"%D",0)
^^1^1^3000623^
"^DD",9002313.59,9002313.59,401,1,1,"%D",1,0)
^BPST("AER",reversal claim #,IEN59)=""
"^DD",9002313.59,9002313.59,401,1,1,"DT")
3000623
"^DD",9002313.59,9002313.59,401,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,401,21,1,0)
Request to reverse this claim.
"^DD",9002313.59,9002313.59,401,"DT")
3031125
"^DD",9002313.59,9002313.59,402,0)
REVERSAL RESPONSE^P9002313.03'^BPSR(^4;2^Q
"^DD",9002313.59,9002313.59,402,1,0)
^.1
"^DD",9002313.59,9002313.59,402,1,1,0)
9002313.59^AFR
"^DD",9002313.59,9002313.59,402,1,1,1)
S ^BPST("AFR",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,402,1,1,2)
K ^BPST("AFR",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,402,1,1,"%D",0)
^^1^1^3000623^
"^DD",9002313.59,9002313.59,402,1,1,"%D",1,0)
^BPST("AFR",reversal response,IEN59)=""
"^DD",9002313.59,9002313.59,402,1,1,"DT")
3000623
"^DD",9002313.59,9002313.59,402,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,402,21,1,0)
Response to reversal message.
"^DD",9002313.59,9002313.59,402,"DT")
3031125
"^DD",9002313.59,9002313.59,403,0)
PAPER REVERSAL^S^1:YES;^4;3^Q
"^DD",9002313.59,9002313.59,403,21,0)
^^3^3^3000821^
"^DD",9002313.59,9002313.59,403,21,1,0)
Paper claims can be reversed.  But instead of an electronic request
"^DD",9002313.59,9002313.59,403,21,2,0)
and response in fields 401,402; you have a 1 here in field 403,
"^DD",9002313.59,9002313.59,403,21,3,0)
since reversal of a paper claim always succeeds.
"^DD",9002313.59,9002313.59,403,"DT")
3000821
"^DD",9002313.59,9002313.59,404,0)
REVERSAL REASON^F^^4;4^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.59,9002313.59,404,3)
Answer must be 1-40 characters in length
"^DD",9002313.59,9002313.59,404,21,0)
^^1^1^3050525^
"^DD",9002313.59,9002313.59,404,21,1,0)
Reason for the reversal
"^DD",9002313.59,9002313.59,404,"DT")
3050525
"^DD",9002313.59,9002313.59,501,0)
QUANTITY^NJ10,3^^5;1^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."4N.N) X
"^DD",9002313.59,9002313.59,501,3)
Type a Number between -999999 and 999999, 3 Decimal Digits
"^DD",9002313.59,9002313.59,501,21,0)
^^4^4^3001110^^
"^DD",9002313.59,9002313.59,501,21,1,0)
These 500-599 fields, stored in ^(5), hold a temporary copy of the pricing
"^DD",9002313.59,9002313.59,501,21,2,0)
data as calculated in ^BPSOSQP.  Then later, when the BPS() array is
"^DD",9002313.59,9002313.59,501,21,3,0)
being set up in BPSECC*, appropriate values can be lifted from here,
"^DD",9002313.59,9002313.59,501,21,4,0)
rather than being recalculated.
"^DD",9002313.59,9002313.59,501,"DT")
3000313
"^DD",9002313.59,9002313.59,502,0)
UNIT PRICE^NJ14,6^^5;2^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."7N.N) X
"^DD",9002313.59,9002313.59,502,3)
Type a Number between 0 and 9999999, 6 Decimal Digits
"^DD",9002313.59,9002313.59,502,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,502,21,1,0)
Price per unit of prescription.
"^DD",9002313.59,9002313.59,502,"DT")
3031126
"^DD",9002313.59,9002313.59,503,0)
SUBTOTAL^NJ13,6^^5;3^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."7N.N) X
"^DD",9002313.59,9002313.59,503,3)
Type a Number between 0 and 999999, 6 Decimal Digits
"^DD",9002313.59,9002313.59,503,21,0)
^^3^3^3000313^
"^DD",9002313.59,9002313.59,503,21,1,0)
= QUANTITY * UNIT PRICE
"^DD",9002313.59,9002313.59,503,21,2,0)
This is probably what we want to send as the INGREDIENT COST field in the
"^DD",9002313.59,9002313.59,503,21,3,0)
NCPDP message.
"^DD",9002313.59,9002313.59,503,"DT")
3000313
"^DD",9002313.59,9002313.59,504,0)
DISPENSING FEE^NJ5,2^^5;4^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99)!(X<0) X
"^DD",9002313.59,9002313.59,504,3)
Type a Dollar Amount between 0 and 99, 2 Decimal Digits
"^DD",9002313.59,9002313.59,504,21,0)
^^2^2^3000313^
"^DD",9002313.59,9002313.59,504,21,1,0)
Storing it here, since it can vary by insurer (or maybe by Pharmacy, too?
"^DD",9002313.59,9002313.59,504,21,2,0)
maybe we want to put a field in 9002313.56)
"^DD",9002313.59,9002313.59,504,"DT")
3000313
"^DD",9002313.59,9002313.59,505,0)
TOTAL PRICE^NJ9,2O^^5;5^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<0) X
"^DD",9002313.59,9002313.59,505,2)
S Y(0)=Y S X=$J(X,0,2)
"^DD",9002313.59,9002313.59,505,2.1)
S X=$J(X,0,2)
"^DD",9002313.59,9002313.59,505,3)
Type a Dollar Amount between 0 and 999999, 2 Decimal Digits
"^DD",9002313.59,9002313.59,505,21,0)
^^1^1^3000313^
"^DD",9002313.59,9002313.59,505,21,1,0)
=SUBTOTAL + DISPENSING FEE
"^DD",9002313.59,9002313.59,505,"DT")
3040116
"^DD",9002313.59,9002313.59,506,0)
PRICE MANUALLY ENTERED^S^1:YES;0:NO;^5;6^Q
"^DD",9002313.59,9002313.59,506,21,0)
^^4^4^3000821^
"^DD",9002313.59,9002313.59,506,21,1,0)
FUTURE:  set this to 1 if the pricing was manually entered.
"^DD",9002313.59,9002313.59,506,21,2,0)
This may be of use if you are rolling to the next insurer and want to
"^DD",9002313.59,9002313.59,506,21,3,0)
know whether or not to erase the prices and recompute, just in case
"^DD",9002313.59,9002313.59,506,21,4,0)
there are multiple pricing tables in use.
"^DD",9002313.59,9002313.59,506,"DT")
3000821
"^DD",9002313.59,9002313.59,507,0)
ADMINISTRATIVE FEE^F^^5;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.59,9002313.59,507,3)
Answer must be 1-15 characters in length.
"^DD",9002313.59,9002313.59,507,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,507,21,1,0)
Any fee charged for handling of the paperwork.
"^DD",9002313.59,9002313.59,507,"DT")
3031126
"^DD",9002313.59,9002313.59,601,0)
PINS 1^F^^6;1^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.59,9002313.59,601,3)
Answer must be 1-20 characters in length.
"^DD",9002313.59,9002313.59,601,21,0)
^^1^1^3000317^
"^DD",9002313.59,9002313.59,601,21,1,0)
PINS 1^PINS 2^PINS 3, just like in ^AUPNVSIT(ien,"PINS")
"^DD",9002313.59,9002313.59,601,"DT")
3000317
"^DD",9002313.59,9002313.59,602,0)
PINS 2^F^^6;2^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.59,9002313.59,602,3)
Answer must be 1-20 characters in length.
"^DD",9002313.59,9002313.59,602,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,602,21,1,0)
PINS 1^PINS 2^PINS 3, just like in ^AUPNVSIT(ien,"PINS")
"^DD",9002313.59,9002313.59,602,"DT")
3031126
"^DD",9002313.59,9002313.59,603,0)
PINS 3^F^^6;3^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.59,9002313.59,603,3)
Answer must be 1-20 characters in length.
"^DD",9002313.59,9002313.59,603,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,603,21,1,0)
PINS 1^PINS 2^PINS 3, just like in ^AUPNVSIT(ien,"PINS")
"^DD",9002313.59,9002313.59,603,"DT")
3031126
"^DD",9002313.59,9002313.59,701,0)
INSURER 1^P9002313.4'^BPSEI(^7;1^Q
"^DD",9002313.59,9002313.59,701,21,0)
^.001^1^1^3040126^^
"^DD",9002313.59,9002313.59,701,21,1,0)
The primary insurer.
"^DD",9002313.59,9002313.59,701,"DT")
3040126
"^DD",9002313.59,9002313.59,702,0)
INSURER 2^P9002313.4'^BPSEI(^7;2^Q
"^DD",9002313.59,9002313.59,702,21,0)
^.001^1^1^3040126^^
"^DD",9002313.59,9002313.59,702,21,1,0)
The secondary insurer.
"^DD",9002313.59,9002313.59,702,"DT")
3040126
"^DD",9002313.59,9002313.59,703,0)
INSURER 3^P9002313.4'^BPSEI(^7;3^Q
"^DD",9002313.59,9002313.59,703,21,0)
^.001^1^1^3040126^^
"^DD",9002313.59,9002313.59,703,21,1,0)
The tertiary insurer.
"^DD",9002313.59,9002313.59,703,"DT")
3040126
"^DD",9002313.59,9002313.59,801,0)
RETRY AFTER^D^^8;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59,801,21,0)
^^2^2^3000621^
"^DD",9002313.59,9002313.59,801,21,1,0)
Due to dial out error or insurer asleep, retry this claim no earlier than
"^DD",9002313.59,9002313.59,801,21,2,0)
this time.  (May provide some way to poke it into activity, overriding this.)
"^DD",9002313.59,9002313.59,801,"DT")
3000621
"^DD",9002313.59,9002313.59,802,0)
RETRY ON DIAL OUT^F^^8;2^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.59,9002313.59,802,3)
Answer must be 1 character in length.
"^DD",9002313.59,9002313.59,802,21,0)
^.001^1^1^3040126^^
"^DD",9002313.59,9002313.59,802,21,1,0)
Number of times the dialout was retried - not used by VA
"^DD",9002313.59,9002313.59,802,"DT")
3040126
"^DD",9002313.59,9002313.59,803,0)
RETRY SLEEPING INSURER^P9002313.4'^BPSEI(^8;3^Q
"^DD",9002313.59,9002313.59,803,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59,803,21,1,0)
Number of times to retry an insurer who is currently down.
"^DD",9002313.59,9002313.59,803,"DT")
3001110
"^DD",9002313.59,9002313.59,901,0)
CURRENT VA INSURER^F^^9;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.59,9002313.59,901,3)
Answer must be 1-15 characters in length.
"^DD",9002313.59,9002313.59,901,21,0)
^^2^2^3040120^
"^DD",9002313.59,9002313.59,901,21,1,0)
The insurer being submitted to currently, if there are Primary, Secondary,
"^DD",9002313.59,9002313.59,901,21,2,0)
and tertiary insurers defined.
"^DD",9002313.59,9002313.59,901,"DT")
3030626
"^DD",9002313.59,9002313.59,902,0)
VA PINS MULTIPLE^9002313.59902PA^^10;0
"^DD",9002313.59,9002313.59,902,21,0)
^.001^1^1^3050119^^^^
"^DD",9002313.59,9002313.59,902,21,1,0)
List of the insurers for the patient.
"^DD",9002313.59,9002313.59,1201,0)
RX ACTION^F^^12;1^K:$L(X)>4!($L(X)<1) X
"^DD",9002313.59,9002313.59,1201,3)
Answer must be 1-4 characters in length.
"^DD",9002313.59,9002313.59,1201,21,0)
^^3^3^3050629^
"^DD",9002313.59,9002313.59,1201,21,1,0)
This is the BWHERE parameter passed into BPSNCPDP and is the action
"^DD",9002313.59,9002313.59,1201,21,2,0)
that is being performed on this RX (AREV, BB, CRLB, CRLR, CRLX, DC, DDED,
"^DD",9002313.59,9002313.59,1201,21,3,0)
DE, ED, ERES, EREV, OF, PC, PE, PL, PP, RF, RL, RN, RRL, and RS).
"^DD",9002313.59,9002313.59,1201,"DT")
3050629
"^DD",9002313.59,9002313.59,1202,0)
DATE OF SERVICE^D^^12;2^S %DT="E" D ^%DT S X=Y K:X<1 X
"^DD",9002313.59,9002313.59,1202,3)
(No range limit on date)
"^DD",9002313.59,9002313.59,1202,21,0)
^^1^1^3050525^
"^DD",9002313.59,9002313.59,1202,21,1,0)
Date to be used for the 401-D1 (DATE OF SERVICE) field for the claim
"^DD",9002313.59,9002313.59,1202,"DT")
3050525
"^DD",9002313.59,9002313.59,1300,0)
DUR DATA^9002313.5913^^13;0
"^DD",9002313.59,9002313.59,1300,21,0)
^^3^3^3050628^
"^DD",9002313.59,9002313.59,1300,21,1,0)
This multiple will track the Drug Utilization Review (DUR) information
"^DD",9002313.59,9002313.59,1300,21,2,0)
passed by Outpatient Pharmacy to ECME and that will eventually be put 
"^DD",9002313.59,9002313.59,1300,21,3,0)
in the DUR segment of the NCPDP claim.
"^DD",9002313.59,9002313.59,9999.96,0)
NET PAID BY INSURER^CJ8,2^^ ; ^N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.59,9002313.59,9999.96,9)
^
"^DD",9002313.59,9002313.59,9999.96,9.01)

"^DD",9002313.59,9002313.59,9999.96,9.1)
N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.59,9002313.59,9999.96,21,0)
^^1^1^3040331^
"^DD",9002313.59,9002313.59,9999.96,21,1,0)
Amount paid after the discounts and deductable have been subtracted.
"^DD",9002313.59,9002313.59,9999.96,"DT")
3040331
"^DD",9002313.59,9002313.59,9999.97,0)
ELAPSED TIME (PRINTABLE)^CJ8^^ ; ^S X=$$TIMEDIF^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.97,9)
^
"^DD",9002313.59,9002313.59,9999.97,9.01)

"^DD",9002313.59,9002313.59,9999.97,9.1)
S X=$$TIMEDIF^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.97,21,0)
^^2^2^3040331^
"^DD",9002313.59,9002313.59,9999.97,21,1,0)
The elapsed time between the filling of the prescription and
"^DD",9002313.59,9002313.59,9999.97,21,2,0)
the return of the response fromt he payer.
"^DD",9002313.59,9002313.59,9999.97,"DT")
3040331
"^DD",9002313.59,9002313.59,9999.98,0)
ELAPSED TIME (SECONDS)^CJ8^^ ; ^S X=$$TIMEDIFI^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.98,9)
^
"^DD",9002313.59,9002313.59,9999.98,9.01)

"^DD",9002313.59,9002313.59,9999.98,9.1)
S X=$$TIMEDIFI^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.98,21,0)
^^2^2^3040120^
"^DD",9002313.59,9002313.59,9999.98,21,1,0)
The number of seconds between the placing of the order and the receipt of
"^DD",9002313.59,9002313.59,9999.98,21,2,0)
the response.
"^DD",9002313.59,9002313.59,9999.98,"DT")
3001020
"^DD",9002313.59,9002313.59,9999.99,0)
RESULT CATEGORY^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,9999.99,9)
^
"^DD",9002313.59,9002313.59,9999.99,9.01)

"^DD",9002313.59,9002313.59,9999.99,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,9999.99,21,0)
^.001^5^5^3040405^^
"^DD",9002313.59,9002313.59,9999.99,21,1,0)
The category of the response.
"^DD",9002313.59,9002313.59,9999.99,21,2,0)
 
"^DD",9002313.59,9002313.59,9999.99,21,3,0)
"P"aid
"^DD",9002313.59,9002313.59,9999.99,21,4,0)
"R"ejected
"^DD",9002313.59,9002313.59,9999.99,21,5,0)
"A"ccepted
"^DD",9002313.59,9002313.59,9999.99,"DT")
3040405
"^DD",9002313.59,9002313.59111,0)
COMMENT MULTIPLE SUB-FIELD^^.03^3
"^DD",9002313.59,9002313.59111,0,"DT")
3050503
"^DD",9002313.59,9002313.59111,0,"IX","B",9002313.59111,.01)

"^DD",9002313.59,9002313.59111,0,"NM","COMMENT MULTIPLE")

"^DD",9002313.59,9002313.59111,0,"UP")
9002313.59
"^DD",9002313.59,9002313.59111,.01,0)
DATE^D^^0;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59111,.01,1,0)
^.1
"^DD",9002313.59,9002313.59111,.01,1,1,0)
9002313.59111^B
"^DD",9002313.59,9002313.59111,.01,1,1,1)
S ^BPST(DA(1),11,"B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59111,.01,1,1,2)
K ^BPST(DA(1),11,"B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59111,.01,21,0)
^.001^1^1^3050527^^^^
"^DD",9002313.59,9002313.59111,.01,21,1,0)
To store user's comments date
"^DD",9002313.59,9002313.59111,.01,"DT")
3050503
"^DD",9002313.59,9002313.59111,.02,0)
USER^P200'^VA(200,^0;2^Q
"^DD",9002313.59,9002313.59111,.02,3)

"^DD",9002313.59,9002313.59111,.02,21,0)
^.001^1^1^3050629^^^
"^DD",9002313.59,9002313.59111,.02,21,1,0)
ECME user
"^DD",9002313.59,9002313.59111,.02,"DT")
3050503
"^DD",9002313.59,9002313.59111,.03,0)
COMMENT^F^^0;3^K:$L(X)>74!($L(X)<1) X
"^DD",9002313.59,9002313.59111,.03,3)
Answer must be 1-74 characters in length.
"^DD",9002313.59,9002313.59111,.03,21,0)
^^1^1^3050503^
"^DD",9002313.59,9002313.59111,.03,21,1,0)
Comment text
"^DD",9002313.59,9002313.59111,.03,"DT")
3050503
"^DD",9002313.59,9002313.5913,0)
DUR DATA SUB-FIELD^^3^4
"^DD",9002313.59,9002313.5913,0,"DT")
3050614
"^DD",9002313.59,9002313.5913,0,"IX","B",9002313.5913,.01)

"^DD",9002313.59,9002313.5913,0,"NM","DUR DATA")

"^DD",9002313.59,9002313.5913,0,"UP")
9002313.59
"^DD",9002313.59,9002313.5913,.01,0)
DUR COUNTER^NJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.59,9002313.5913,.01,1,0)
^.1
"^DD",9002313.59,9002313.5913,.01,1,1,0)
9002313.5913^B
"^DD",9002313.59,9002313.5913,.01,1,1,1)
S ^BPST(DA(1),13,"B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.5913,.01,1,1,2)
K ^BPST(DA(1),13,"B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.5913,.01,3)
Enter the DUR counter for the claim
"^DD",9002313.59,9002313.5913,.01,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,.01,21,1,0)
This is the counter that will be used for field 473-7E of the claim
"^DD",9002313.59,9002313.5913,.01,"DT")
3050614
"^DD",9002313.59,9002313.5913,1,0)
DUR PROFESSIONAL SERVICE CODE^F^^0;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.5913,1,3)
Enter the professional service code for the claim
"^DD",9002313.59,9002313.5913,1,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,1,21,1,0)
This will be used for field 439-E4 of the claim
"^DD",9002313.59,9002313.5913,1,"DT")
3050614
"^DD",9002313.59,9002313.5913,2,0)
DUR REASON FOR SERVICE CODE^F^^0;3^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.5913,2,3)
Enter the DUR Reason for the Service Code for the claim
"^DD",9002313.59,9002313.5913,2,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,2,21,1,0)
This will be used for field 440-E5 of the claim
"^DD",9002313.59,9002313.5913,2,"DT")
3050614
"^DD",9002313.59,9002313.5913,3,0)
DUR RESULT OF SERVICE CODE^F^^0;4^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.5913,3,3)
Enter the Result of Service Code for the claim
"^DD",9002313.59,9002313.5913,3,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,3,21,1,0)
This will be used for field 441-E6 of the claim
"^DD",9002313.59,9002313.5913,3,"DT")
3050614
"^DD",9002313.59,9002313.59902,0)
VA PINS MULTIPLE SUB-FIELD^^902.27^25
"^DD",9002313.59,9002313.59902,0,"DT")
3050913
"^DD",9002313.59,9002313.59902,0,"IX","B",9002313.59902,.01)

"^DD",9002313.59,9002313.59902,0,"NM","VA PINS MULTIPLE")

"^DD",9002313.59,9002313.59902,0,"UP")
9002313.59
"^DD",9002313.59,9002313.59902,.01,0)
PLAN ID^MP355.3'^IBA(355.3,^0;1^Q
"^DD",9002313.59,9002313.59902,.01,1,0)
^.1
"^DD",9002313.59,9002313.59902,.01,1,1,0)
9002313.59902^B
"^DD",9002313.59,9002313.59902,.01,1,1,1)
S ^BPST(DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59902,.01,1,1,2)
K ^BPST(DA(1),10,"B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59902,.01,3)
Enter Group Insurance record
"^DD",9002313.59,9002313.59902,.01,21,0)
^.001^1^1^3041014^^^^
"^DD",9002313.59,9002313.59902,.01,21,1,0)
ID assigned to the insurance plan.
"^DD",9002313.59,9002313.59902,.01,"DT")
3050727
"^DD",9002313.59,9002313.59902,902.02,0)
PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.59,9002313.59902,902.02,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59902,902.02,21,1,0)
The payer sheet to be used for this particular insurer.
"^DD",9002313.59,9002313.59902,902.02,"DT")
3030626
"^DD",9002313.59,9002313.59902,902.03,0)
BIN^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.03,3)
Answer must be 1-10 characters in length.
"^DD",9002313.59,9002313.59902,902.03,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.03,21,1,0)
Card Issuer ID or Bank ID Number used for network routing.
"^DD",9002313.59,9002313.59902,902.03,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.04,0)
PCN^F^^1;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.04,3)
Answer must be 1-10 characters in length.
"^DD",9002313.59,9002313.59902,902.04,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.04,21,1,0)
The prescription number for this claim.
"^DD",9002313.59,9002313.59902,902.04,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.05,0)
GROUP ID^F^^1;3^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.05,3)
Answer must be 1-17 characters in length
"^DD",9002313.59,9002313.59902,902.05,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.05,21,1,0)
ID assigned to the cardholder group or employer group.
"^DD",9002313.59,9002313.59902,902.05,"DT")
3050913
"^DD",9002313.59,9002313.59902,902.06,0)
CARDHOLDER ID^F^^1;4^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.06,3)
Answer must be 1-20 characters in length.
"^DD",9002313.59,9002313.59902,902.06,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.06,21,1,0)
ID number assigned to Cardholder/Subscriber.
"^DD",9002313.59,9002313.59902,902.06,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.07,0)
PATIENT RELATIONSHIP CODE^F^^1;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.07,3)
Answer must be 1 character in length.
"^DD",9002313.59,9002313.59902,902.07,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.07,21,1,0)
Patient relationship to insurance subscriber.
"^DD",9002313.59,9002313.59902,902.07,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.08,0)
CARDHOLDER FIRST NAME^F^^1;6^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.08,3)
Answer must be 1-30 characters in length.
"^DD",9002313.59,9002313.59902,902.08,21,0)
^.001^1^1^3050119^^
"^DD",9002313.59,9002313.59902,902.08,21,1,0)
First name of the Cardholder/Subscriber.
"^DD",9002313.59,9002313.59902,902.08,"DT")
3050119
"^DD",9002313.59,9002313.59902,902.09,0)
CARDHOLDER LAST NAME^F^^1;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.09,3)
Answer must be 1-15 characters in length.
"^DD",9002313.59,9002313.59902,902.09,21,0)
^.001^1^1^3050119^^
"^DD",9002313.59,9002313.59902,902.09,21,1,0)
Last name of the Cardholder/Subscriber.
"^DD",9002313.59,9002313.59902,902.09,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.11,0)
HOME PLAN STATE^F^^1;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.11,3)
Answer must be 1-2 characters in length.
"^DD",9002313.59,9002313.59902,902.11,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.11,21,1,0)
Usually the state where the member lives or purchased their coverage. 
"^DD",9002313.59,9002313.59902,902.11,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.12,0)
DISPENSING FEE SUBMITTED^F^^2;1^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.12,3)
Answer must be 1-8 characters in length.
"^DD",9002313.59,9002313.59902,902.12,21,0)
^^2^2^3031126^
"^DD",9002313.59,9002313.59902,902.12,21,1,0)
Fee amount submitted for the cost associated with dispensing this 
"^DD",9002313.59,9002313.59902,902.12,21,2,0)
prescription.
"^DD",9002313.59,9002313.59902,902.12,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.13,0)
BASIS OF COST DETERMINATION^F^^2;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.13,3)
Answer must be 1-2 characters in length.
"^DD",9002313.59,9002313.59902,902.13,21,0)
^^2^2^3031126^
"^DD",9002313.59,9002313.59902,902.13,21,1,0)
Code indicating the method by which 'Ingredient Cost Submitted' was
"^DD",9002313.59,9002313.59902,902.13,21,2,0)
calculated.
"^DD",9002313.59,9002313.59902,902.13,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.14,0)
USUAL & CUSTOMARY CHARGE^F^^2;3^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.14,3)
Answer must be 1-8 characters in length.
"^DD",9002313.59,9002313.59902,902.14,21,0)
^^2^2^3031126^
"^DD",9002313.59,9002313.59902,902.14,21,1,0)
Amount charged cash customers for the prescription exclusive of sales tax 
"^DD",9002313.59,9002313.59902,902.14,21,2,0)
or other amounts claimed.
"^DD",9002313.59,9002313.59902,902.14,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.15,0)
GROSS AMOUNT DUE^F^^2;4^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.15,3)
Answer must be 1-8 characters in length.
"^DD",9002313.59,9002313.59902,902.15,21,0)
^^9^9^3031126^
"^DD",9002313.59,9002313.59902,902.15,21,1,0)
Total price claimed from all sources.  For prescription claim request, 
"^DD",9002313.59,9002313.59902,902.15,21,2,0)
field represents a sum of 'Ingredient Cost Submitted'  (49-D9), 
"^DD",9002313.59,9002313.59902,902.15,21,3,0)
'Dispensing Fee Submitted' (412-DC), 'Flat Sales Tax Amount 
"^DD",9002313.59,9002313.59902,902.15,21,4,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted' (482-GE), 
"^DD",9002313.59,9002313.59902,902.15,21,5,0)
'Incentive Amount Submitted' (438-E3), 'Other Amount Claimed' (48-H9). 
"^DD",9002313.59,9002313.59902,902.15,21,6,0)
For service claim request, field represents a sum of 'Professional 
"^DD",9002313.59,9002313.59902,902.15,21,7,0)
Services Fee Submitted' (477-BE), 'Flat Sales Tax Amount 
"^DD",9002313.59,9002313.59902,902.15,21,8,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted'(482-GE), 
"^DD",9002313.59,9002313.59902,902.15,21,9,0)
'Other Amount Claimed' (48-H9).
"^DD",9002313.59,9002313.59902,902.15,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.16,0)
ADMINISTRATIVE FEE^F^^2;5^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.16,3)
Answer must be 1-8 characters in length.
"^DD",9002313.59,9002313.59902,902.16,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.16,21,1,0)
Fee charged for any costs related to preparing the prescription.
"^DD",9002313.59,9002313.59902,902.16,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.17,0)
VA FILL NUMBER^F^^2;6^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.17,3)
Answer must be 1-3 characters in length.
"^DD",9002313.59,9002313.59902,902.17,21,0)
^^2^2^3040120^
"^DD",9002313.59,9002313.59902,902.17,21,1,0)
Which fill number this transaction is in reference to.
"^DD",9002313.59,9002313.59902,902.17,21,2,0)
Starts with '0' for the original fill.
"^DD",9002313.59,9002313.59902,902.17,"DT")
3030701
"^DD",9002313.59,9002313.59902,902.18,0)
SOFTWARE VENDOR/CERT ID^F^^2;7^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.18,3)
Answer must be 1-30 characters in length.
"^DD",9002313.59,9002313.59902,902.18,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59902,902.18,21,1,0)
Certification number assigned by the payer for submission of claims.
"^DD",9002313.59,9002313.59902,902.18,"DT")
3030729
"^DD",9002313.59,9002313.59902,902.19,0)
B2 PAYER SHEET IEN^P9002313.92'^BPSF(9002313.92,^0;3^Q
"^DD",9002313.59,9002313.59902,902.19,3)
Enter the reversal payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.19,21,0)
^^1^1^3031112^
"^DD",9002313.59,9002313.59902,902.19,21,1,0)
Enter the Reversal Payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.19,"DT")
3031112
"^DD",9002313.59,9002313.59902,902.21,0)
B3 Rebill Payer Sheet^P9002313.92'^BPSF(9002313.92,^0;4^Q
"^DD",9002313.59,9002313.59902,902.21,3)
Enter the Rebill payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.21,21,0)
^^1^1^3031112^
"^DD",9002313.59,9002313.59902,902.21,21,1,0)
Enter the Rebill payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.21,"DT")
3031112
"^DD",9002313.59,9002313.59902,902.22,0)
CERTIFY MODE^S^0:CERTIFY MODE OFF;1:CERTFIY MODE ON;^0;5^Q
"^DD",9002313.59,9002313.59902,902.22,3)
Enter null or 0 for certify mode off.  Enter 1 for Cerify mode on.
"^DD",9002313.59,9002313.59902,902.22,21,0)
^^1^1^3040331^
"^DD",9002313.59,9002313.59902,902.22,21,1,0)
Enter null or 0 for certify mode off.  Enter 1 for certify mode on.
"^DD",9002313.59,9002313.59902,902.22,23,0)
^^3^3^3031126^
"^DD",9002313.59,9002313.59902,902.22,23,1,0)
^
"^DD",9002313.59,9002313.59902,902.22,23,2,0)
E
"^DD",9002313.59,9002313.59902,902.22,23,3,0)
Y
"^DD",9002313.59,9002313.59902,902.22,"DT")
3040331
"^DD",9002313.59,9002313.59902,902.23,0)
CERT IEN^NJ9,0^^0;6^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.59,9002313.59902,902.23,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",9002313.59,9002313.59902,902.23,21,0)
^.001^2^2^3031113^^
"^DD",9002313.59,9002313.59902,902.23,21,1,0)
This field is used during certification testing, and points to the entry 
"^DD",9002313.59,9002313.59902,902.23,21,2,0)
to use to pull certification data.
"^DD",9002313.59,9002313.59902,902.23,"DT")
3031113
"^DD",9002313.59,9002313.59902,902.24,0)
PLAN NAME^F^^0;7^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.24,3)
Answer must be 1-40 characters in length.
"^DD",9002313.59,9002313.59902,902.24,21,0)
^^1^1^3041014^
"^DD",9002313.59,9002313.59902,902.24,21,1,0)
This field contains the Plan Name for the insurance being filed.
"^DD",9002313.59,9002313.59902,902.24,"DT")
3041014
"^DD",9002313.59,9002313.59902,902.25,0)
GROUP NAME^F^^3;1^K:$L(X)>20!($L(X)<2) X
"^DD",9002313.59,9002313.59902,902.25,3)
Answer must be 2-20 characters in length
"^DD",9002313.59,9002313.59902,902.25,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.59902,902.25,21,1,0)
This is the group name from the Group Insurance File
"^DD",9002313.59,9002313.59902,902.25,"DT")
3050913
"^DD",9002313.59,9002313.59902,902.26,0)
INSURANCE CO PHONE #^F^^3;2^K:$L(X)>20!($L(X)<7) X
"^DD",9002313.59,9002313.59902,902.26,3)
Answer must be 7-20 characters in length
"^DD",9002313.59,9002313.59902,902.26,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.59902,902.26,21,1,0)
This is the Claim (RX) phone number from the Insurance Company file
"^DD",9002313.59,9002313.59902,902.26,"DT")
3050614
"^DD",9002313.59,9002313.59902,902.27,0)
PHARMACY PLAN ID^F^^3;3^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.27,3)
Answer must be 1-30 characters in length
"^DD",9002313.59,9002313.59902,902.27,21,0)
^^1^1^3050617^
"^DD",9002313.59,9002313.59902,902.27,21,1,0)
This is a ID of the plan file
"^DD",9002313.59,9002313.59902,902.27,"DT")
3050617
"^DD",9002313.61,9002313.61,0)
FIELD^^10016^29
"^DD",9002313.61,9002313.61,0,"DDA")
N
"^DD",9002313.61,9002313.61,0,"DT")
3040609
"^DD",9002313.61,9002313.61,0,"IX","AD",9002313.61,.02)

"^DD",9002313.61,9002313.61,0,"IX","AE",9002313.61,.03)

"^DD",9002313.61,9002313.61,0,"IX","B",9002313.61,.01)

"^DD",9002313.61,9002313.61,0,"IX","C",9002313.61,.04)

"^DD",9002313.61,9002313.61,0,"NM","BPS REPORT MASTER")

"^DD",9002313.61,9002313.61,0,"VRPK")
BPS
"^DD",9002313.61,9002313.61,.01,0)
RELEASED DATE^RF^^0;1^K:$L(X)>12!($L(X)<7) X
"^DD",9002313.61,9002313.61,.01,1,0)
^.1
"^DD",9002313.61,9002313.61,.01,1,1,0)
9002313.61^B
"^DD",9002313.61,9002313.61,.01,1,1,1)
S ^BPSECX("RPT","B",$E(X,1,30),DA)=""
"^DD",9002313.61,9002313.61,.01,1,1,2)
K ^BPSECX("RPT","B",$E(X,1,30),DA)
"^DD",9002313.61,9002313.61,.01,3)
Answer must be 7-12 characters in length.
"^DD",9002313.61,9002313.61,.01,21,0)
^.001^4^4^3040205^^
"^DD",9002313.61,9002313.61,.01,21,1,0)
As obtained from Prescription File (#52) ^PSRX("AL",*) in BPSOSM1
"^DD",9002313.61,9002313.61,.01,21,2,0)
but then we take off the time part. This is to facilitate sorting, and
"^DD",9002313.61,9002313.61,.01,21,3,0)
speed, too. We sort first on this date, and then by insurer. If we
"^DD",9002313.61,9002313.61,.01,21,4,0)
included time here, we get page breaks everywhere.
"^DD",9002313.61,9002313.61,.01,"DT")
3040121
"^DD",9002313.61,9002313.61,.02,0)
TRANSACT DATE^D^^0;2^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",9002313.61,9002313.61,.02,.1)
TRANS. DATE
"^DD",9002313.61,9002313.61,.02,1,0)
^.1
"^DD",9002313.61,9002313.61,.02,1,1,0)
9002313.61^AD
"^DD",9002313.61,9002313.61,.02,1,1,1)
S ^BPSECX("RPT","AD",$E(X,1,30),DA)=""
"^DD",9002313.61,9002313.61,.02,1,1,2)
K ^BPSECX("RPT","AD",$E(X,1,30),DA)
"^DD",9002313.61,9002313.61,.02,1,1,"%D",0)
^^1^1^3010406^
"^DD",9002313.61,9002313.61,.02,1,1,"%D",1,0)
For efficient reporting by transaction date.
"^DD",9002313.61,9002313.61,.02,1,1,"DT")
3010406
"^DD",9002313.61,9002313.61,.02,3)
(No range limit on date)
"^DD",9002313.61,9002313.61,.02,21,0)
^^3^3^3040322^
"^DD",9002313.61,9002313.61,.02,21,1,0)
The date that the realtime transaction was submitted to the payor whether 
"^DD",9002313.61,9002313.61,.02,21,2,0)
that transaction was a first time submission, a resubmission, or a 
"^DD",9002313.61,9002313.61,.02,21,3,0)
reversal.
"^DD",9002313.61,9002313.61,.02,"DT")
3040122
"^DD",9002313.61,9002313.61,.03,0)
TRANSACTION^P9002313.57'^BPSTL(^0;3^Q
"^DD",9002313.61,9002313.61,.03,1,0)
^.1
"^DD",9002313.61,9002313.61,.03,1,1,0)
9002313.61^AE
"^DD",9002313.61,9002313.61,.03,1,1,1)
S ^BPSECX("RPT","AE",$E(X,1,30),DA)=""
"^DD",9002313.61,9002313.61,.03,1,1,2)
K ^BPSECX("RPT","AE",$E(X,1,30),DA)
"^DD",9002313.61,9002313.61,.03,1,1,"%D",0)
0^^4^4^3010410^
"^DD",9002313.61,9002313.61,.03,1,1,"%D",1,0)
The reason for this index is to screen entries when searching on
"^DD",9002313.61,9002313.61,.03,1,1,"%D",2,0)
the transaction file (.57).  The screen "I $D(^BPSECX(""RPT"",""AE"",D0))"
"^DD",9002313.61,9002313.61,.03,1,1,"%D",3,0)
answers the question "Is this transaction the most recent transaction
"^DD",9002313.61,9002313.61,.03,1,1,"%D",4,0)
for the associated prescription/fill?"
"^DD",9002313.61,9002313.61,.03,1,1,"DT")
3010410
"^DD",9002313.61,9002313.61,.03,21,0)
^^3^3^3040121^
"^DD",9002313.61,9002313.61,.03,21,1,0)
Internal pointer to the BPS Log of Transactions file (9002313.57)
"^DD",9002313.61,9002313.61,.03,21,2,0)
transaction for this RXI,RXR. Should be same as the 9002313.59, but maybe
"^DD",9002313.61,9002313.61,.03,21,3,0)
different.  Can be used to retrieve computed for this transaction.
"^DD",9002313.61,9002313.61,.03,"DT")
3040121
"^DD",9002313.61,9002313.61,.04,0)
RXI^P52'^PSRX(^0;4^Q
"^DD",9002313.61,9002313.61,.04,1,0)
^.1
"^DD",9002313.61,9002313.61,.04,1,1,0)
9002313.61^C
"^DD",9002313.61,9002313.61,.04,1,1,1)
S ^BPSECX("RPT","C",$E(X,1,30),DA)=""
"^DD",9002313.61,9002313.61,.04,1,1,2)
K ^BPSECX("RPT","C",$E(X,1,30),DA)
"^DD",9002313.61,9002313.61,.04,1,1,"DT")
3010123
"^DD",9002313.61,9002313.61,.04,21,0)
^^1^1^3040120^
"^DD",9002313.61,9002313.61,.04,21,1,0)
The internal number pointing to an entry in the Prescription File (#52). 
"^DD",9002313.61,9002313.61,.04,"DT")
3040120
"^DD",9002313.61,9002313.61,.05,0)
RXR^NJ4,0^^0;5^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.61,9002313.61,.05,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",9002313.61,9002313.61,.05,21,0)
^^1^1^3010123^
"^DD",9002313.61,9002313.61,.05,21,1,0)
Refill multiple
"^DD",9002313.61,9002313.61,.05,"DT")
3010123
"^DD",9002313.61,9002313.61,.06,0)
RESULT TYPE^NJ2,0^^0;6^K:+X'=X!(X>20)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.61,9002313.61,.06,3)
Type a Number between 0 and 20, 0 Decimal Digits
"^DD",9002313.61,9002313.61,.06,21,0)
^^4^4^3040121^
"^DD",9002313.61,9002313.61,.06,21,1,0)
To aid in sorting claims these values are use to group claims that have 
"^DD",9002313.61,9002313.61,.06,21,2,0)
been processed.
"^DD",9002313.61,9002313.61,.06,21,3,0)
Values are E PAYABLE,E CAPTURED,E DUPLICATE, E REJECTED, E REVERSAL
"^DD",9002313.61,9002313.61,.06,21,4,0)
ACCEPTED, E REVERSAL REJECTED, PAPER, and PAPER REVERSAL
"^DD",9002313.61,9002313.61,.06,"DT")
3040121
"^DD",9002313.61,9002313.61,.07,0)
FINISH DATE^D^^0;7^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.61,9002313.61,.07,21,0)
^^2^2^3040121^
"^DD",9002313.61,9002313.61,.07,21,1,0)
Date that data entry for the prescription was completed in the Outpatient 
"^DD",9002313.61,9002313.61,.07,21,2,0)
Pharmacy System.
"^DD",9002313.61,9002313.61,.07,"DT")
3040121
"^DD",9002313.61,9002313.61,.08,0)
FILL DATE^D^^0;8^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.61,9002313.61,.08,21,0)
^^3^3^3040121^
"^DD",9002313.61,9002313.61,.08,21,1,0)
Date on which the last prescription was delivered to the patient,
"^DD",9002313.61,9002313.61,.08,21,2,0)
including the date that the last prescription was mailed in the case of
"^DD",9002313.61,9002313.61,.08,21,3,0)
mail delivery. This can depend on the fill number currently being used.
"^DD",9002313.61,9002313.61,.08,"DT")
3040121
"^DD",9002313.61,9002313.61,.09,0)
ISSUE DATE^D^^0;9^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.61,9002313.61,.09,21,0)
^^1^1^3040121^
"^DD",9002313.61,9002313.61,.09,21,1,0)
Date when the physician wrote the prescription.
"^DD",9002313.61,9002313.61,.09,"DT")
3040121
"^DD",9002313.61,9002313.61,.095,0)
LABEL DATE^D^^0;10^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.61,9002313.61,.095,21,0)
^^1^1^3040121^
"^DD",9002313.61,9002313.61,.095,21,1,0)
Date the label was printed by the pharmacy for the prescription.
"^DD",9002313.61,9002313.61,.095,"DT")
3040121
"^DD",9002313.61,9002313.61,1,0)
REMARKS^9002313.611^^1;0
"^DD",9002313.61,9002313.61,1,21,0)
^^4^4^3040126^
"^DD",9002313.61,9002313.61,1,21,1,0)
Space to put in remarks as rejections are worked.  The text is printed on
"^DD",9002313.61,9002313.61,1,21,2,0)
the rejection report.  You might use this field to explain why certain
"^DD",9002313.61,9002313.61,1,21,3,0)
rejections are solidly so, as a way of saying "this one has been worked
"^DD",9002313.61,9002313.61,1,21,4,0)
on."
"^DD",9002313.61,9002313.61,1300,0)
MESSAGE^9002313.6213^^M;0
"^DD",9002313.61,9002313.61,1800,0)
REJECTION REASONS^9002313.6118^^R;0
"^DD",9002313.61,9002313.61,1800,21,0)
^^2^2^3040126^
"^DD",9002313.61,9002313.61,1800,21,1,0)
Reason on the reply from the payor as to why the claim was rejected.  This
"^DD",9002313.61,9002313.61,1800,21,2,0)
is a standard set of codes stored in the file BPS NCPDP REJECT CODES.
"^DD",9002313.61,9002313.61,10001,0)
RX DELETED^CJ1^^ ; ^S X=$$DELETED^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10001,9)
^
"^DD",9002313.61,9002313.61,10001,9.01)

"^DD",9002313.61,9002313.61,10001,9.1)
S X=$$DELETED^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10001,21,0)
^^2^2^3040121^
"^DD",9002313.61,9002313.61,10001,21,1,0)
Computed field designed to check the refill multiple to determine if the 
"^DD",9002313.61,9002313.61,10001,21,2,0)
prescription has been deleted.
"^DD",9002313.61,9002313.61,10001,"DT")
3040121
"^DD",9002313.61,9002313.61,10002,0)
INSURER HELP #^CJ30^^ ; ^S X=$$INSHELP^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10002,9)
^
"^DD",9002313.61,9002313.61,10002,9.01)

"^DD",9002313.61,9002313.61,10002,9.1)
S X=$$INSHELP^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10002,21,0)
^^3^3^3040322^
"^DD",9002313.61,9002313.61,10002,21,1,0)
The telephone number of the help desk of the insurer to whom the claim is 
"^DD",9002313.61,9002313.61,10002,21,2,0)
sent.  This might be helpful in resolving technical issue such as why no 
"^DD",9002313.61,9002313.61,10002,21,3,0)
responses are coming from their system.
"^DD",9002313.61,9002313.61,10002,"DT")
3040121
"^DD",9002313.61,9002313.61,10003,0)
RX RELEASED DATE/TIME^CJ20^^ ; ^S X=$$RELTIME^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10003,9)
^
"^DD",9002313.61,9002313.61,10003,9.01)

"^DD",9002313.61,9002313.61,10003,9.1)
S X=$$RELTIME^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10003,21,0)
^^1^1^3040121^
"^DD",9002313.61,9002313.61,10003,21,1,0)
Release date and time as obtained from the Prescription File (#52).
"^DD",9002313.61,9002313.61,10003,"DT")
3040121
"^DD",9002313.61,9002313.61,10004,0)
RX RETURNED TO STOCK^CJ20^^ ; ^S X=$$RETSTOCK^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10004,9)
^
"^DD",9002313.61,9002313.61,10004,9.01)

"^DD",9002313.61,9002313.61,10004,9.1)
S X=$$RETSTOCK^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10004,21,0)
^^1^1^3040121^
"^DD",9002313.61,9002313.61,10004,21,1,0)
Date and time that a prescription was returned to stock.
"^DD",9002313.61,9002313.61,10004,"DT")
3040121
"^DD",9002313.61,9002313.61,10005,0)
UNINSURED^CB^^ ; ^X ^DD(9002313.61,10005,10) S X=$S('$D(^AUTNINS(+$P(Y(9002313.61,10005,301),U,6),0)):"",1:$P(^(0),U,1))="SELF PAY",Y=X,X=Y(9002313.61,10005,202),X=X!Y S D0=Y(9002313.61,10005,80)
"^DD",9002313.61,9002313.61,10005,9)
^
"^DD",9002313.61,9002313.61,10005,9.01)
9002313.57^1.06;9002313.61^.03
"^DD",9002313.61,9002313.61,10005,9.1)
(TRANSACTION:INSURER=0)!(TRANSACTION:INSURER="")!(TRANSACTION:INSURER="SELF PAY")
"^DD",9002313.61,9002313.61,10005,9.2)
S Y(9002313.61,10005,80)=$S($D(D0):D0,1:""),Y(9002313.61,10005,1)=$S($D(^BPSECX("RPT",D0,0)):^(0),1:"")
"^DD",9002313.61,9002313.61,10005,9.3)
X ^DD(9002313.61,10005,9.2) S D0=$P(Y(9002313.61,10005,1),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1 S Y(9002313.61,10005,180)=$S($D(D0):D0,1:"")
"^DD",9002313.61,9002313.61,10005,9.4)
X ^DD(9002313.61,10005,9.3) S Y(9002313.61,10005,101)=$S($D(^BPSTL(D0,1)):^(1),1:"")
"^DD",9002313.61,9002313.61,10005,9.5)
X ^DD(9002313.61,10005,9.4) S X=$S('$D(^AUTNINS(+$P(Y(9002313.61,10005,101),U,6),0)):"",1:$P(^(0),U,1))=0,Y(9002313.61,10005,102)=X
"^DD",9002313.61,9002313.61,10005,9.6)
X ^DD(9002313.61,10005,9.5) S D0=$P(Y(9002313.61,10005,1),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1 S Y(9002313.61,10005,280)=$S($D(D0):D0,1:"")
"^DD",9002313.61,9002313.61,10005,9.7)
X ^DD(9002313.61,10005,9.6) S Y(9002313.61,10005,201)=$S($D(^BPSTL(D0,1)):^(1),1:"")
"^DD",9002313.61,9002313.61,10005,9.8)
X ^DD(9002313.61,10005,9.7) S X=$S('$D(^AUTNINS(+$P(Y(9002313.61,10005,201),U,6),0)):"",1:$P(^(0),U,1))="",Y=X,X=Y(9002313.61,10005,102),X=X!Y
"^DD",9002313.61,9002313.61,10005,9.9)
X ^DD(9002313.61,10005,9.8) S Y(9002313.61,10005,202)=X,D0=$P(Y(9002313.61,10005,1),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1
"^DD",9002313.61,9002313.61,10005,10)
X ^DD(9002313.61,10005,9.9) S Y(9002313.61,10005,301)=$S($D(^BPSTL(D0,1)):^(1),1:"")
"^DD",9002313.61,9002313.61,10005,21,0)
^^2^2^3040121^
"^DD",9002313.61,9002313.61,10005,21,1,0)
Computed field used to determine whether or not a patient has insurance 
"^DD",9002313.61,9002313.61,10005,21,2,0)
for this prescription.
"^DD",9002313.61,9002313.61,10005,"DT")
3040121
"^DD",9002313.61,9002313.61,10006,0)
AMOUNT PAYABLE^CJ10,2^^ ; ^X ^DD(9002313.61,10006,9.4) S Y(9002313.61,10006,103)=X S X="",X=$S(Y(9002313.61,10006,2):Y(9002313.61,10006,102),Y(9002313.61,10006,103):X) S D0=Y(9002313.61,10006,80)
"^DD",9002313.61,9002313.61,10006,9)
^
"^DD",9002313.61,9002313.61,10006,9.01)
9002313.57^9999.96;9002313.61^.03;9002313.61^.06
"^DD",9002313.61,9002313.61,10006,9.1)
$S(RESULT TYPE=4:TRANSACTION:NET PAID,1:"")
"^DD",9002313.61,9002313.61,10006,9.2)
S Y(9002313.61,10006,80)=$S($D(D0):D0,1:""),Y(9002313.61,10006,1)=$S($D(^BPSECX("RPT",D0,0)):^(0),1:"") S X=$P(Y(9002313.61,10006,1),U,6)=4
"^DD",9002313.61,9002313.61,10006,9.3)
X ^DD(9002313.61,10006,9.2) S Y(9002313.61,10006,2)=X,D0=$P(Y(9002313.61,10006,1),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1
"^DD",9002313.61,9002313.61,10006,9.4)
X ^DD(9002313.61,10006,9.3) X $P(^DD(9002313.57,9999.96,0),U,5,99) S Y(9002313.61,10006,101)=X S X=Y(9002313.61,10006,101),Y(9002313.61,10006,102)=X S X=1
"^DD",9002313.61,9002313.61,10006,21,0)
^^2^2^3040121^
"^DD",9002313.61,9002313.61,10006,21,1,0)
Computed field which uses the RESULT TYPE to determine if there is a net 
"^DD",9002313.61,9002313.61,10006,21,2,0)
payable amount from the BPS TRANSACTION File (#9002313.59).
"^DD",9002313.61,9002313.61,10006,"DT")
3040121
"^DD",9002313.61,9002313.61,10007,0)
AMOUNT SHORTED^CJ8,2^^ ; ^X ^DD(9002313.61,10007,9.7) S X=$S(Y(9002313.61,10007,2):Y(9002313.61,10007,202),Y(9002313.61,10007,203):X) S D0=Y(9002313.61,10007,80)
"^DD",9002313.61,9002313.61,10007,9)
^
"^DD",9002313.61,9002313.61,10007,9.01)
9002313.57^9999.96;9002313.57^505;9002313.61^.03;9002313.61^.06
"^DD",9002313.61,9002313.61,10007,9.1)
$S(RESULT TYPE=4:(TRANSACTION:TOTAL PRICE-(TRANSACTION:NET PAID BY INSURER)),1:"")
"^DD",9002313.61,9002313.61,10007,9.2)
S Y(9002313.61,10007,80)=$S($D(D0):D0,1:""),Y(9002313.61,10007,1)=$S($D(^BPSECX("RPT",D0,0)):^(0),1:"") S X=$P(Y(9002313.61,10007,1),U,6)=4
"^DD",9002313.61,9002313.61,10007,9.3)
X ^DD(9002313.61,10007,9.2) S Y(9002313.61,10007,2)=X,Y(9002313.61,10007,3)=X,D0=$P(Y(9002313.61,10007,1),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1
"^DD",9002313.61,9002313.61,10007,9.4)
X ^DD(9002313.61,10007,9.3) S Y(9002313.61,10007,180)=$S($D(D0):D0,1:""),Y(9002313.61,10007,101)=$S($D(^BPSTL(D0,5)):^(5),1:"")
"^DD",9002313.61,9002313.61,10007,9.5)
X ^DD(9002313.61,10007,9.4) S X=$P(Y(9002313.61,10007,101),U,5),Y(9002313.61,10007,102)=X
"^DD",9002313.61,9002313.61,10007,9.6)
X ^DD(9002313.61,10007,9.5) S D0=$P(Y(9002313.61,10007,1),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1 X $P(^DD(9002313.57,9999.96,0),U,5,99) S Y(9002313.61,10007,201)=X
"^DD",9002313.61,9002313.61,10007,9.7)
X ^DD(9002313.61,10007,9.6) S X=Y(9002313.61,10007,201),Y=X,X=Y(9002313.61,10007,102),X=X-Y,Y(9002313.61,10007,202)=X S X=1,Y(9002313.61,10007,203)=X S X=""
"^DD",9002313.61,9002313.61,10007,21,0)
^^1^1^3040121^
"^DD",9002313.61,9002313.61,10007,21,1,0)
Difference between the amount requested and the amount paid.
"^DD",9002313.61,9002313.61,10007,"DT")
3040121
"^DD",9002313.61,9002313.61,10008,0)
AMOUNT CAPTURED^CJ10,2^^ ; ^X ^DD(9002313.61,10008,9.5) S X=$S(Y(9002313.61,10008,2):Y(9002313.61,10008,102),Y(9002313.61,10008,103):X) S D0=Y(9002313.61,10008,80)
"^DD",9002313.61,9002313.61,10008,9)
^
"^DD",9002313.61,9002313.61,10008,9.01)
9002313.57^505;9002313.61^.03;9002313.61^.06
"^DD",9002313.61,9002313.61,10008,9.1)
$S(RESULT TYPE=3:TRANSACTION:TOTAL PRICE,1:"")
"^DD",9002313.61,9002313.61,10008,9.2)
S Y(9002313.61,10008,80)=$S($D(D0):D0,1:""),Y(9002313.61,10008,1)=$S($D(^BPSECX("RPT",D0,0)):^(0),1:"") S X=$P(Y(9002313.61,10008,1),U,6)=3
"^DD",9002313.61,9002313.61,10008,9.3)
X ^DD(9002313.61,10008,9.2) S Y(9002313.61,10008,2)=X,D0=$P(Y(9002313.61,10008,1),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1
"^DD",9002313.61,9002313.61,10008,9.4)
X ^DD(9002313.61,10008,9.3) S Y(9002313.61,10008,101)=$S($D(^BPSTL(D0,5)):^(5),1:"") S X=$P(Y(9002313.61,10008,101),U,5)
"^DD",9002313.61,9002313.61,10008,9.5)
X ^DD(9002313.61,10008,9.4) S Y(9002313.61,10008,102)=X S X=1,Y(9002313.61,10008,103)=X S X=""
"^DD",9002313.61,9002313.61,10008,21,0)
^^1^1^3040127^
"^DD",9002313.61,9002313.61,10008,21,1,0)
Total amount of the claim if the Result Status is E CAPTURED.
"^DD",9002313.61,9002313.61,10008,"DT")
3040127
"^DD",9002313.61,9002313.61,10009,0)
AMOUNT DUPLICATE^CJ10,2^^ ; ^X ^DD(9002313.61,10009,9.5) S X=$S(Y(9002313.61,10009,2):Y(9002313.61,10009,102),Y(9002313.61,10009,103):X) S D0=Y(9002313.61,10009,80)
"^DD",9002313.61,9002313.61,10009,9)
^
"^DD",9002313.61,9002313.61,10009,9.01)
9002313.57^505;9002313.61^.03;9002313.61^.06
"^DD",9002313.61,9002313.61,10009,9.1)
$S(RESULT TYPE=2:TRANSACTION:TOTAL PRICE,1:"")
"^DD",9002313.61,9002313.61,10009,9.2)
S Y(9002313.61,10009,80)=$S($D(D0):D0,1:""),Y(9002313.61,10009,1)=$S($D(^BPSECX("RPT",D0,0)):^(0),1:"") S X=$P(Y(9002313.61,10009,1),U,6)=2
"^DD",9002313.61,9002313.61,10009,9.3)
X ^DD(9002313.61,10009,9.2) S Y(9002313.61,10009,2)=X,D0=$P(Y(9002313.61,10009,1),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1
"^DD",9002313.61,9002313.61,10009,9.4)
X ^DD(9002313.61,10009,9.3) S Y(9002313.61,10009,101)=$S($D(^BPSTL(D0,5)):^(5),1:"") S X=$P(Y(9002313.61,10009,101),U,5)
"^DD",9002313.61,9002313.61,10009,9.5)
X ^DD(9002313.61,10009,9.4) S Y(9002313.61,10009,102)=X S X=1,Y(9002313.61,10009,103)=X S X=""
"^DD",9002313.61,9002313.61,10009,21,0)
^^1^1^3040122^
"^DD",9002313.61,9002313.61,10009,21,1,0)
If this is a duplicate claim this will be the total amount of the claim.
"^DD",9002313.61,9002313.61,10009,"DT")
3040122
"^DD",9002313.61,9002313.61,10010,0)
AMOUNT PAPER^CJ8,2^^ ; ^X ^DD(9002313.61,10010,9.6) S X=$S(Y(9002313.61,10010,4):Y(9002313.61,10010,102),Y(9002313.61,10010,103):X) S D0=Y(9002313.61,10010,80)
"^DD",9002313.61,9002313.61,10010,9)
^
"^DD",9002313.61,9002313.61,10010,9.01)
9002313.57^505;9002313.61^.03;9002313.61^10005;9002313.61^.06
"^DD",9002313.61,9002313.61,10010,9.1)
$S((RESULT TYPE=9)&(UNINSURED=0):TRANSACTION:TOTAL PRICE,1:"")
"^DD",9002313.61,9002313.61,10010,9.2)
X $P(^DD(9002313.61,10005,0),U,5,99) S Y(9002313.61,10010,3)=X S Y(9002313.61,10010,80)=$S($D(D0):D0,1:""),Y(9002313.61,10010,1)=$S($D(^BPSECX("RPT",D0,0)):^(0),1:"")
"^DD",9002313.61,9002313.61,10010,9.3)
X ^DD(9002313.61,10010,9.2) S X=$P(Y(9002313.61,10010,1),U,6)=9,Y(9002313.61,10010,2)=X S X=Y(9002313.61,10010,3)=0,Y=X,X=Y(9002313.61,10010,2),X=X&Y
"^DD",9002313.61,9002313.61,10010,9.4)
X ^DD(9002313.61,10010,9.3) S Y(9002313.61,10010,4)=X,D0=$P(Y(9002313.61,10010,1),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1
"^DD",9002313.61,9002313.61,10010,9.5)
X ^DD(9002313.61,10010,9.4) S Y(9002313.61,10010,101)=$S($D(^BPSTL(D0,5)):^(5),1:"") S X=$P(Y(9002313.61,10010,101),U,5)
"^DD",9002313.61,9002313.61,10010,9.6)
X ^DD(9002313.61,10010,9.5) S Y(9002313.61,10010,102)=X S X=1,Y(9002313.61,10010,103)=X S X=""
"^DD",9002313.61,9002313.61,10010,21,0)
^^2^2^3040122^
"^DD",9002313.61,9002313.61,10010,21,1,0)
If the claim Result Type is Paper and the patient has insurance then this 
"^DD",9002313.61,9002313.61,10010,21,2,0)
amount will be the total amount of the claim.
"^DD",9002313.61,9002313.61,10010,"DT")
3040122
"^DD",9002313.61,9002313.61,10011,0)
AMOUNT UNINSURED^CJ8,2^^ ; ^X ^DD(9002313.61,10011,9.6) S X=$S(Y(9002313.61,10011,4):Y(9002313.61,10011,102),Y(9002313.61,10011,103):X) S D0=Y(9002313.61,10011,80)
"^DD",9002313.61,9002313.61,10011,9)
^
"^DD",9002313.61,9002313.61,10011,9.01)
9002313.57^505;9002313.61^.03;9002313.61^10005;9002313.61^.06
"^DD",9002313.61,9002313.61,10011,9.1)
$S((RESULT TYPE=9)&(UNINSURED):TRANSACTION:TOTAL PRICE,1:"")
"^DD",9002313.61,9002313.61,10011,9.2)
X $P(^DD(9002313.61,10005,0),U,5,99) S Y(9002313.61,10011,3)=X S Y(9002313.61,10011,80)=$S($D(D0):D0,1:""),Y(9002313.61,10011,1)=$S($D(^BPSECX("RPT",D0,0)):^(0),1:"")
"^DD",9002313.61,9002313.61,10011,9.3)
X ^DD(9002313.61,10011,9.2) S X=$P(Y(9002313.61,10011,1),U,6)=9,Y(9002313.61,10011,2)=X S X=Y(9002313.61,10011,3),Y=X,X=Y(9002313.61,10011,2),X=X&Y
"^DD",9002313.61,9002313.61,10011,9.4)
X ^DD(9002313.61,10011,9.3) S Y(9002313.61,10011,4)=X,D0=$P(Y(9002313.61,10011,1),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1
"^DD",9002313.61,9002313.61,10011,9.5)
X ^DD(9002313.61,10011,9.4) S Y(9002313.61,10011,101)=$S($D(^BPSTL(D0,5)):^(5),1:"") S X=$P(Y(9002313.61,10011,101),U,5)
"^DD",9002313.61,9002313.61,10011,9.6)
X ^DD(9002313.61,10011,9.5) S Y(9002313.61,10011,102)=X S X=1,Y(9002313.61,10011,103)=X S X=""
"^DD",9002313.61,9002313.61,10011,21,0)
^^2^2^3040122^
"^DD",9002313.61,9002313.61,10011,21,1,0)
If the Result Type of the claim is PAPER and the patient is marked as 
"^DD",9002313.61,9002313.61,10011,21,2,0)
uninsured then this will return the total amount of the claim.
"^DD",9002313.61,9002313.61,10011,"DT")
3040122
"^DD",9002313.61,9002313.61,10012,0)
AMOUNT OTHER^CJ8,2^^ ; ^X ^DD(9002313.61,10012,9.7) S X=$S(Y(9002313.61,10012,2):Y(9002313.61,10012,3),Y(9002313.61,10012,5):Y(9002313.61,10012,6),Y(9002313.61,10012,8):Y(9002313.61,10012,102),Y(9002313.61,10012,103):X) S D0=Y(9002313.61,10012,80)
"^DD",9002313.61,9002313.61,10012,9)
^
"^DD",9002313.61,9002313.61,10012,9.01)
9002313.57^505;9002313.61^.03;9002313.61^.06;9002313.61^10001;9002313.61^10004
"^DD",9002313.61,9002313.61,10012,9.1)
$S(RX RETURNED TO STOCK:"",RX DELETED:"",RESULT TYPE<0:TRANSACTION:TOTAL PRICE,1:"")
"^DD",9002313.61,9002313.61,10012,9.2)
X $P(^DD(9002313.61,10001,0),U,5,99) S Y(9002313.61,10012,4)=X X $P(^DD(9002313.61,10004,0),U,5,99) S Y(9002313.61,10012,1)=X S Y(9002313.61,10012,80)=$S($D(D0):D0,1:"")
"^DD",9002313.61,9002313.61,10012,9.3)
X ^DD(9002313.61,10012,9.2) S Y(9002313.61,10012,7)=$S($D(^BPSECX("RPT",D0,0)):^(0),1:"") S X=Y(9002313.61,10012,1),Y(9002313.61,10012,2)=X S X=""
"^DD",9002313.61,9002313.61,10012,9.4)
X ^DD(9002313.61,10012,9.3) S Y(9002313.61,10012,3)=X S X=Y(9002313.61,10012,4),Y(9002313.61,10012,5)=X S X="",Y(9002313.61,10012,6)=X S X=$P(Y(9002313.61,10012,7),U,6)
"^DD",9002313.61,9002313.61,10012,9.5)
X ^DD(9002313.61,10012,9.4) S X=X<0,Y(9002313.61,10012,8)=X,D0=$P(Y(9002313.61,10012,7),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1
"^DD",9002313.61,9002313.61,10012,9.6)
X ^DD(9002313.61,10012,9.5) S Y(9002313.61,10012,101)=$S($D(^BPSTL(D0,5)):^(5),1:"") S X=$P(Y(9002313.61,10012,101),U,5)
"^DD",9002313.61,9002313.61,10012,9.7)
X ^DD(9002313.61,10012,9.6) S Y(9002313.61,10012,102)=X S X=1,Y(9002313.61,10012,103)=X S X=""
"^DD",9002313.61,9002313.61,10012,21,0)
^^3^3^3040122^
"^DD",9002313.61,9002313.61,10012,21,1,0)
If this claim has a RESULT TYPE less than zero, there is an error
"^DD",9002313.61,9002313.61,10012,21,2,0)
and this field will return the TOTAL PRICE of the claim to reflect
"^DD",9002313.61,9002313.61,10012,21,3,0)
the error.
"^DD",9002313.61,9002313.61,10013,0)
AMOUNT REJECTED^CJ8,2^^ ; ^X ^DD(9002313.61,10013,9.5) S X=$S(Y(9002313.61,10013,2):Y(9002313.61,10013,102),Y(9002313.61,10013,103):X) S D0=Y(9002313.61,10013,80)
"^DD",9002313.61,9002313.61,10013,9)
^
"^DD",9002313.61,9002313.61,10013,9.01)
9002313.57^505;9002313.61^.03;9002313.61^.06
"^DD",9002313.61,9002313.61,10013,9.1)
$S(RESULT TYPE=1:TRANSACTION:TOTAL PRICE,1:"")
"^DD",9002313.61,9002313.61,10013,9.2)
S Y(9002313.61,10013,80)=$S($D(D0):D0,1:""),Y(9002313.61,10013,1)=$S($D(^BPSECX("RPT",D0,0)):^(0),1:"") S X=$P(Y(9002313.61,10013,1),U,6)=1
"^DD",9002313.61,9002313.61,10013,9.3)
X ^DD(9002313.61,10013,9.2) S Y(9002313.61,10013,2)=X,D0=$P(Y(9002313.61,10013,1),U,3) S:'$D(^BPSTL(+D0,0)) D0=-1
"^DD",9002313.61,9002313.61,10013,9.4)
X ^DD(9002313.61,10013,9.3) S Y(9002313.61,10013,101)=$S($D(^BPSTL(D0,5)):^(5),1:"") S X=$P(Y(9002313.61,10013,101),U,5)
"^DD",9002313.61,9002313.61,10013,9.5)
X ^DD(9002313.61,10013,9.4) S Y(9002313.61,10013,102)=X S X=1,Y(9002313.61,10013,103)=X S X=""
"^DD",9002313.61,9002313.61,10013,21,0)
^^2^2^3040331^
"^DD",9002313.61,9002313.61,10013,21,1,0)
If this claim has a RESULT TYPE of 1, i.e. it is a rejected claim, then 
"^DD",9002313.61,9002313.61,10013,21,2,0)
this will return the TOTAL PRICE of the claim.
"^DD",9002313.61,9002313.61,10013,"DT")
3040331
"^DD",9002313.61,9002313.61,10014,0)
RELEASE DATE^CJ8^^ ; ^S X=$$RELDATE^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10014,9.01)

"^DD",9002313.61,9002313.61,10014,9.1)
S X=$$RELDATE^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10014,21,0)
^^2^2^3040322^
"^DD",9002313.61,9002313.61,10014,21,1,0)
This is the date that the pharmacist physically fills the prescription.  
"^DD",9002313.61,9002313.61,10014,21,2,0)
This usually but not always coincides with the fill date.
"^DD",9002313.61,9002313.61,10014,"DT")
3040322
"^DD",9002313.61,9002313.61,10015,0)
REVERSAL DATE^CD^^ ; ^S X=$$GREVDT^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10015,9.01)

"^DD",9002313.61,9002313.61,10015,9.1)
S X=$$GREVDT^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10015,21,0)
^^1^1^3040122^
"^DD",9002313.61,9002313.61,10015,21,1,0)
Returns the REVERSAL DATE from the Electronic Claims (#9002313.02) file.
"^DD",9002313.61,9002313.61,10015,"DT")
3040122
"^DD",9002313.61,9002313.61,10016,0)
SORT DATE^CD^^ ; ^S X=$$SORTDT^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10016,9.01)

"^DD",9002313.61,9002313.61,10016,9.1)
S X=$$SORTDT^BPSOSM(D0)
"^DD",9002313.61,9002313.61,10016,21,0)
^^2^2^3040205^
"^DD",9002313.61,9002313.61,10016,21,1,0)
Field to return what ever date field has been selected in the Payables or 
"^DD",9002313.61,9002313.61,10016,21,2,0)
Reversals reports.
"^DD",9002313.61,9002313.61,10016,"DT")
3040205
"^DD",9002313.61,9002313.611,0)
REMARKS SUB-FIELD^^.01^1
"^DD",9002313.61,9002313.611,0,"DT")
3010127
"^DD",9002313.61,9002313.611,0,"NM","REMARKS")

"^DD",9002313.61,9002313.611,0,"UP")
9002313.61
"^DD",9002313.61,9002313.611,.01,0)
REMARKS^W^^0;1^Q
"^DD",9002313.61,9002313.611,.01,21,0)
^^4^4^3010127^
"^DD",9002313.61,9002313.611,.01,21,1,0)
Space to put in remarks as rejections are worked.  The text is printed
"^DD",9002313.61,9002313.611,.01,21,2,0)
on the rejection report.  You might use this field to explain why
"^DD",9002313.61,9002313.611,.01,21,3,0)
certain rejections are solidly so, as a way of saying "this one has been
"^DD",9002313.61,9002313.611,.01,21,4,0)
worked on."
"^DD",9002313.61,9002313.611,.01,"DT")
3010127
"^DD",9002313.61,9002313.6118,0)
REJECTION REASONS SUB-FIELD^^.01^1
"^DD",9002313.61,9002313.6118,0,"DT")
3040121
"^DD",9002313.61,9002313.6118,0,"NM","REJECTION REASONS")

"^DD",9002313.61,9002313.6118,0,"UP")
9002313.61
"^DD",9002313.61,9002313.6118,.01,0)
REJECTION REASONS^WL^^0;1^Q
"^DD",9002313.61,9002313.6118,.01,21,0)
^^2^2^3040126^
"^DD",9002313.61,9002313.6118,.01,21,1,0)
Reason on the reply from the payor as to why the claim was rejected.  
"^DD",9002313.61,9002313.6118,.01,21,2,0)
This is a standard set of codes stored in the file BPS NCPDP REJECT CODES.
"^DD",9002313.61,9002313.6118,.01,"DT")
3040126
"^DD",9002313.61,9002313.6213,0)
MESSAGE SUB-FIELD^^.01^1
"^DD",9002313.61,9002313.6213,0,"DT")
3010126
"^DD",9002313.61,9002313.6213,0,"NM","MESSAGE")

"^DD",9002313.61,9002313.6213,0,"UP")
9002313.61
"^DD",9002313.61,9002313.6213,.01,0)
MESSAGE^W^^0;1^Q
"^DD",9002313.61,9002313.6213,.01,21,0)
^^1^1^3040126^
"^DD",9002313.61,9002313.6213,.01,21,1,0)
Response messages from the payor to describe the action taken.
"^DD",9002313.61,9002313.6213,.01,"DT")
3040126
"^DD",9002313.81,9002313.81,0)
FIELD^^.02^2
"^DD",9002313.81,9002313.81,0,"DDA")
N
"^DD",9002313.81,9002313.81,0,"DT")
3010406
"^DD",9002313.81,9002313.81,0,"IX","B",9002313.81,.01)

"^DD",9002313.81,9002313.81,0,"NM","BPS TRANSLATE 9999999.36")

"^DD",9002313.81,9002313.81,0,"VRPK")
BPS
"^DD",9002313.81,9002313.81,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.81,9002313.81,.01,1,0)
^.1
"^DD",9002313.81,9002313.81,.01,1,1,0)
9002313.81^B
"^DD",9002313.81,9002313.81,.01,1,1,1)
S ^BPSF(9002313.81,"B",$E(X,1,30),DA)=""
"^DD",9002313.81,9002313.81,.01,1,1,2)
K ^BPSF(9002313.81,"B",$E(X,1,30),DA)
"^DD",9002313.81,9002313.81,.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.81,9002313.81,.01,21,0)
^^1^1^3010406^
"^DD",9002313.81,9002313.81,.01,21,1,0)
This much exactly match the name in the .01 field of ^AUTTRLSH.
"^DD",9002313.81,9002313.81,.01,"DT")
3010406
"^DD",9002313.81,9002313.81,.02,0)
RELATIONSHIP CODE^S^1:CARDHOLDER;2:SPOUSE;3:CHILD;4:OTHER;^0;2^Q
"^DD",9002313.81,9002313.81,.02,"DT")
3010406
"^DD",9002313.82103,9002313.82103,0)
FIELD^^.02^2
"^DD",9002313.82103,9002313.82103,0,"DDA")
N
"^DD",9002313.82103,9002313.82103,0,"DT")
3010409
"^DD",9002313.82103,9002313.82103,0,"IX","B",9002313.82103,.01)

"^DD",9002313.82103,9002313.82103,0,"NM","BPS NCPDP FIELD 103")

"^DD",9002313.82103,9002313.82103,0,"VRPK")
BPS
"^DD",9002313.82103,9002313.82103,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<2)!'(X'?1P.E) X
"^DD",9002313.82103,9002313.82103,.01,1,0)
^.1
"^DD",9002313.82103,9002313.82103,.01,1,1,0)
9002313.82103^B
"^DD",9002313.82103,9002313.82103,.01,1,1,1)
S ^BPSF(9002313.82103,"B",$E(X,1,30),DA)=""
"^DD",9002313.82103,9002313.82103,.01,1,1,2)
K ^BPSF(9002313.82103,"B",$E(X,1,30),DA)
"^DD",9002313.82103,9002313.82103,.01,3)
Answer must be 2 characters in length.
"^DD",9002313.82103,9002313.82103,.01,21,0)
^^17^17^3040106^
"^DD",9002313.82103,9002313.82103,.01,21,1,0)
Transaction code of the data being sent.
"^DD",9002313.82103,9002313.82103,.01,21,2,0)
 
"^DD",9002313.82103,9002313.82103,.01,21,3,0)
E1=Eligibility Verification
"^DD",9002313.82103,9002313.82103,.01,21,4,0)
B1=Billing
"^DD",9002313.82103,9002313.82103,.01,21,5,0)
B2=Reversal
"^DD",9002313.82103,9002313.82103,.01,21,6,0)
B3=Rebill
"^DD",9002313.82103,9002313.82103,.01,21,7,0)
P1=P.A. Request & Billing
"^DD",9002313.82103,9002313.82103,.01,21,8,0)
P2=P.A. Reversal
"^DD",9002313.82103,9002313.82103,.01,21,9,0)
P3=P.A. Inquiry
"^DD",9002313.82103,9002313.82103,.01,21,10,0)
P4=P.A. Request Only
"^DD",9002313.82103,9002313.82103,.01,21,11,0)
N1=Information Reporting
"^DD",9002313.82103,9002313.82103,.01,21,12,0)
N2=Information Reporting Reversal
"^DD",9002313.82103,9002313.82103,.01,21,13,0)
N3=Information Reporting Rebill
"^DD",9002313.82103,9002313.82103,.01,21,14,0)
C1=Controlled Substance Reporting
"^DD",9002313.82103,9002313.82103,.01,21,15,0)
C2=Controlled Substance Reporting
"^DD",9002313.82103,9002313.82103,.01,21,16,0)
Reversal
"^DD",9002313.82103,9002313.82103,.01,21,17,0)
C3=Controlled Substance Reporting Rebill
"^DD",9002313.82103,9002313.82103,.01,"DT")
3010409
"^DD",9002313.82103,9002313.82103,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82103,9002313.82103,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82103,9002313.82103,.02,21,0)
^.001^1^1^3031204^^
"^DD",9002313.82103,9002313.82103,.02,21,1,0)
What data element the code represents within the NCPDP standard.
"^DD",9002313.82103,9002313.82103,.02,"DT")
3010409
"^DD",9002313.82305,9002313.82305,0)
FIELD^^.02^2
"^DD",9002313.82305,9002313.82305,0,"DDA")
N
"^DD",9002313.82305,9002313.82305,0,"DT")
3010409
"^DD",9002313.82305,9002313.82305,0,"IX","B",9002313.82305,.01)

"^DD",9002313.82305,9002313.82305,0,"NM","BPS NCPDP FIELD 305")

"^DD",9002313.82305,9002313.82305,0,"VRPK")
BPS
"^DD",9002313.82305,9002313.82305,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82305,9002313.82305,.01,1,0)
^.1
"^DD",9002313.82305,9002313.82305,.01,1,1,0)
9002313.82305^B
"^DD",9002313.82305,9002313.82305,.01,1,1,1)
S ^BPSF(9002313.82305,"B",$E(X,1,30),DA)=""
"^DD",9002313.82305,9002313.82305,.01,1,1,2)
K ^BPSF(9002313.82305,"B",$E(X,1,30),DA)
"^DD",9002313.82305,9002313.82305,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82305,9002313.82305,.01,21,0)
^.001^5^5^3040107^^^
"^DD",9002313.82305,9002313.82305,.01,21,1,0)
Patient Gender code
"^DD",9002313.82305,9002313.82305,.01,21,2,0)
 
"^DD",9002313.82305,9002313.82305,.01,21,3,0)
M=Male
"^DD",9002313.82305,9002313.82305,.01,21,4,0)
F=Female
"^DD",9002313.82305,9002313.82305,.01,21,5,0)
U=Unknown
"^DD",9002313.82305,9002313.82305,.01,"DT")
3010409
"^DD",9002313.82305,9002313.82305,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82305,9002313.82305,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82305,9002313.82305,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82305,9002313.82305,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82305,9002313.82305,.02,"DT")
3010409
"^DD",9002313.82306,9002313.82306,0)
FIELD^^.02^2
"^DD",9002313.82306,9002313.82306,0,"DDA")
N
"^DD",9002313.82306,9002313.82306,0,"DT")
3010413
"^DD",9002313.82306,9002313.82306,0,"IX","B",9002313.82306,.01)

"^DD",9002313.82306,9002313.82306,0,"NM","BPS NCPDP FIELD 306")

"^DD",9002313.82306,9002313.82306,0,"VRPK")
BPS
"^DD",9002313.82306,9002313.82306,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82306,9002313.82306,.01,1,0)
^.1
"^DD",9002313.82306,9002313.82306,.01,1,1,0)
9002313.82306^B
"^DD",9002313.82306,9002313.82306,.01,1,1,1)
S ^BPSF(9002313.82306,"B",$E(X,1,30),DA)=""
"^DD",9002313.82306,9002313.82306,.01,1,1,2)
K ^BPSF(9002313.82306,"B",$E(X,1,30),DA)
"^DD",9002313.82306,9002313.82306,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82306,9002313.82306,.01,21,0)
^^11^11^3040107^
"^DD",9002313.82306,9002313.82306,.01,21,1,0)
Relationship code - relationship of patient to the insured.
"^DD",9002313.82306,9002313.82306,.01,21,2,0)
 
"^DD",9002313.82306,9002313.82306,.01,21,3,0)
=Not Specified
"^DD",9002313.82306,9002313.82306,.01,21,4,0)
1=Cardholder
"^DD",9002313.82306,9002313.82306,.01,21,5,0)
2=Spouse
"^DD",9002313.82306,9002313.82306,.01,21,6,0)
3=Child
"^DD",9002313.82306,9002313.82306,.01,21,7,0)
4=Other
"^DD",9002313.82306,9002313.82306,.01,21,8,0)
5=Student
"^DD",9002313.82306,9002313.82306,.01,21,9,0)
6=Disabled Dependent
"^DD",9002313.82306,9002313.82306,.01,21,10,0)
7=Adult Dependent
"^DD",9002313.82306,9002313.82306,.01,21,11,0)
8=Significant Other
"^DD",9002313.82306,9002313.82306,.01,"DT")
3010413
"^DD",9002313.82306,9002313.82306,.02,0)
MEANING^F^^0;2^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.82306,9002313.82306,.02,3)
Answer must be 1-15 characters in length.
"^DD",9002313.82306,9002313.82306,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82306,9002313.82306,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82306,9002313.82306,.02,"DT")
3010413
"^DD",9002313.82307,9002313.82307,0)
FIELD^^.02^2
"^DD",9002313.82307,9002313.82307,0,"DDA")
N
"^DD",9002313.82307,9002313.82307,0,"DT")
3010409
"^DD",9002313.82307,9002313.82307,0,"IX","B",9002313.82307,.01)

"^DD",9002313.82307,9002313.82307,0,"NM","BPS NCPDP FIELD 307")

"^DD",9002313.82307,9002313.82307,0,"VRPK")
BPS
"^DD",9002313.82307,9002313.82307,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<2)!'(X'?1P.E) X
"^DD",9002313.82307,9002313.82307,.01,1,0)
^.1
"^DD",9002313.82307,9002313.82307,.01,1,1,0)
9002313.82307^B
"^DD",9002313.82307,9002313.82307,.01,1,1,1)
S ^BPSF(9002313.82307,"B",$E(X,1,30),DA)=""
"^DD",9002313.82307,9002313.82307,.01,1,1,2)
K ^BPSF(9002313.82307,"B",$E(X,1,30),DA)
"^DD",9002313.82307,9002313.82307,.01,3)
Answer must be 2 characters in length.
"^DD",9002313.82307,9002313.82307,.01,21,0)
^.001^15^15^3040107^^
"^DD",9002313.82307,9002313.82307,.01,21,1,0)
Code Identifying the location of the patient at the time they
"^DD",9002313.82307,9002313.82307,.01,21,2,0)
received pharmacy services.
"^DD",9002313.82307,9002313.82307,.01,21,3,0)
 
"^DD",9002313.82307,9002313.82307,.01,21,4,0)
=Not specified
"^DD",9002313.82307,9002313.82307,.01,21,5,0)
1=Home
"^DD",9002313.82307,9002313.82307,.01,21,6,0)
2=Inter-Care
"^DD",9002313.82307,9002313.82307,.01,21,7,0)
3=Nursing Home
"^DD",9002313.82307,9002313.82307,.01,21,8,0)
4=Long Term/Extended Care
"^DD",9002313.82307,9002313.82307,.01,21,9,0)
5=Rest Home
"^DD",9002313.82307,9002313.82307,.01,21,10,0)
6=Boarding Home
"^DD",9002313.82307,9002313.82307,.01,21,11,0)
7=Skilled Care Facility
"^DD",9002313.82307,9002313.82307,.01,21,12,0)
8=Sub-Acute Care Facility
"^DD",9002313.82307,9002313.82307,.01,21,13,0)
9=Acute Care Facility
"^DD",9002313.82307,9002313.82307,.01,21,14,0)
1=Outpatient
"^DD",9002313.82307,9002313.82307,.01,21,15,0)
11=Hospice
"^DD",9002313.82307,9002313.82307,.01,"DT")
3010409
"^DD",9002313.82307,9002313.82307,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82307,9002313.82307,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82307,9002313.82307,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82307,9002313.82307,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82307,9002313.82307,.02,"DT")
3010409
"^DD",9002313.82308,9002313.82308,0)
FIELD^^.02^2
"^DD",9002313.82308,9002313.82308,0,"DDA")
N
"^DD",9002313.82308,9002313.82308,0,"DT")
3010409
"^DD",9002313.82308,9002313.82308,0,"IX","B",9002313.82308,.01)

"^DD",9002313.82308,9002313.82308,0,"NM","BPS NCPDP FIELD 308")

"^DD",9002313.82308,9002313.82308,0,"VRPK")
BPS
"^DD",9002313.82308,9002313.82308,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82308,9002313.82308,.01,1,0)
^.1
"^DD",9002313.82308,9002313.82308,.01,1,1,0)
9002313.82308^B
"^DD",9002313.82308,9002313.82308,.01,1,1,1)
S ^BPSF(9002313.82308,"B",$E(X,1,30),DA)=""
"^DD",9002313.82308,9002313.82308,.01,1,1,2)
K ^BPSF(9002313.82308,"B",$E(X,1,30),DA)
"^DD",9002313.82308,9002313.82308,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82308,9002313.82308,.01,21,0)
^^13^13^3040107^
"^DD",9002313.82308,9002313.82308,.01,21,1,0)
=Not Specified
"^DD",9002313.82308,9002313.82308,.01,21,2,0)
1=No other coverage identified
"^DD",9002313.82308,9002313.82308,.01,21,3,0)
2=Other coverage exists-payment collected
"^DD",9002313.82308,9002313.82308,.01,21,4,0)
3=Other coverage exists-this claim not
"^DD",9002313.82308,9002313.82308,.01,21,5,0)
covered
"^DD",9002313.82308,9002313.82308,.01,21,6,0)
4=Other coverage exists-payment not
"^DD",9002313.82308,9002313.82308,.01,21,7,0)
collected
"^DD",9002313.82308,9002313.82308,.01,21,8,0)
5=Managed care plan denial
"^DD",9002313.82308,9002313.82308,.01,21,9,0)
6=Other coverage denied-not a
"^DD",9002313.82308,9002313.82308,.01,21,10,0)
participating provider
"^DD",9002313.82308,9002313.82308,.01,21,11,0)
7=Other coverage exists-not in effect at
"^DD",9002313.82308,9002313.82308,.01,21,12,0)
time of service
"^DD",9002313.82308,9002313.82308,.01,21,13,0)
8=Claim is a billing for a copay
"^DD",9002313.82308,9002313.82308,.01,"DT")
3010409
"^DD",9002313.82308,9002313.82308,.02,0)
MEANING^F^^0;2^K:$L(X)>70!($L(X)<1) X
"^DD",9002313.82308,9002313.82308,.02,3)
Answer must be 1-70 characters in length.
"^DD",9002313.82308,9002313.82308,.02,21,0)
^.001^1^1^3031204^^
"^DD",9002313.82308,9002313.82308,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82308,9002313.82308,.02,"DT")
3010409
"^DD",9002313.82309,9002313.82309,0)
FIELD^^.02^2
"^DD",9002313.82309,9002313.82309,0,"DDA")
N
"^DD",9002313.82309,9002313.82309,0,"DT")
3010409
"^DD",9002313.82309,9002313.82309,0,"IX","B",9002313.82309,.01)

"^DD",9002313.82309,9002313.82309,0,"NM","BPS NCPDP FIELD 309")

"^DD",9002313.82309,9002313.82309,0,"VRPK")
BPS
"^DD",9002313.82309,9002313.82309,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82309,9002313.82309,.01,1,0)
^.1
"^DD",9002313.82309,9002313.82309,.01,1,1,0)
9002313.82309^B
"^DD",9002313.82309,9002313.82309,.01,1,1,1)
S ^BPSF(9002313.82309,"B",$E(X,1,30),DA)=""
"^DD",9002313.82309,9002313.82309,.01,1,1,2)
K ^BPSF(9002313.82309,"B",$E(X,1,30),DA)
"^DD",9002313.82309,9002313.82309,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82309,9002313.82309,.01,21,0)
^^10^10^3040107^
"^DD",9002313.82309,9002313.82309,.01,21,1,0)
Code indicating that the pharmacy is clarifying eligibility based on
"^DD",9002313.82309,9002313.82309,.01,21,2,0)
receiving a denial.
"^DD",9002313.82309,9002313.82309,.01,21,3,0)
 
"^DD",9002313.82309,9002313.82309,.01,21,4,0)
=Not Specified
"^DD",9002313.82309,9002313.82309,.01,21,5,0)
1=No Override
"^DD",9002313.82309,9002313.82309,.01,21,6,0)
2=Override
"^DD",9002313.82309,9002313.82309,.01,21,7,0)
3=Full Time Student
"^DD",9002313.82309,9002313.82309,.01,21,8,0)
4=Disabled Dependent
"^DD",9002313.82309,9002313.82309,.01,21,9,0)
5=Dependent Parent
"^DD",9002313.82309,9002313.82309,.01,21,10,0)
6=Significant Other
"^DD",9002313.82309,9002313.82309,.01,"DT")
3010409
"^DD",9002313.82309,9002313.82309,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82309,9002313.82309,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82309,9002313.82309,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82309,9002313.82309,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82309,9002313.82309,.02,"DT")
3010409
"^DD",9002313.82406,9002313.82406,0)
FIELD^^.02^2
"^DD",9002313.82406,9002313.82406,0,"DDA")
N
"^DD",9002313.82406,9002313.82406,0,"DT")
3010409
"^DD",9002313.82406,9002313.82406,0,"IX","B",9002313.82406,.01)

"^DD",9002313.82406,9002313.82406,0,"NM","BPS NCPDP FIELD 406")

"^DD",9002313.82406,9002313.82406,0,"VRPK")
BPS
"^DD",9002313.82406,9002313.82406,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82406,9002313.82406,.01,1,0)
^.1
"^DD",9002313.82406,9002313.82406,.01,1,1,0)
9002313.82406^B
"^DD",9002313.82406,9002313.82406,.01,1,1,1)
S ^BPSF(9002313.82406,"B",$E(X,1,30),DA)=""
"^DD",9002313.82406,9002313.82406,.01,1,1,2)
K ^BPSF(9002313.82406,"B",$E(X,1,30),DA)
"^DD",9002313.82406,9002313.82406,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82406,9002313.82406,.01,21,0)
^^5^5^3040107^
"^DD",9002313.82406,9002313.82406,.01,21,1,0)
Code indicating whether or not the prescription is a compound.
"^DD",9002313.82406,9002313.82406,.01,21,2,0)
 
"^DD",9002313.82406,9002313.82406,.01,21,3,0)
=Not Specified
"^DD",9002313.82406,9002313.82406,.01,21,4,0)
1=Not a Compound
"^DD",9002313.82406,9002313.82406,.01,21,5,0)
2=Compound
"^DD",9002313.82406,9002313.82406,.01,"DT")
3010409
"^DD",9002313.82406,9002313.82406,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82406,9002313.82406,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82406,9002313.82406,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82406,9002313.82406,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82406,9002313.82406,.02,"DT")
3010409
"^DD",9002313.82408,9002313.82408,0)
FIELD^^.02^2
"^DD",9002313.82408,9002313.82408,0,"DDA")
N
"^DD",9002313.82408,9002313.82408,0,"DT")
3010409
"^DD",9002313.82408,9002313.82408,0,"IX","B",9002313.82408,.01)

"^DD",9002313.82408,9002313.82408,0,"NM","BPS NCPDP FIELD 408")

"^DD",9002313.82408,9002313.82408,0,"VRPK")
BPS
"^DD",9002313.82408,9002313.82408,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.82408,9002313.82408,.01,1,0)
^.1
"^DD",9002313.82408,9002313.82408,.01,1,1,0)
9002313.82408^B
"^DD",9002313.82408,9002313.82408,.01,1,1,1)
S ^BPSF(9002313.82408,"B",$E(X,1,30),DA)=""
"^DD",9002313.82408,9002313.82408,.01,1,1,2)
K ^BPSF(9002313.82408,"B",$E(X,1,30),DA)
"^DD",9002313.82408,9002313.82408,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82408,9002313.82408,.01,21,0)
^^15^15^3040107^
"^DD",9002313.82408,9002313.82408,.01,21,1,0)
Code indicating whether or not the patient has other insurance coverage.
"^DD",9002313.82408,9002313.82408,.01,21,2,0)
 
"^DD",9002313.82408,9002313.82408,.01,21,3,0)
=Not Specified
"^DD",9002313.82408,9002313.82408,.01,21,4,0)
1=No other coverage identified
"^DD",9002313.82408,9002313.82408,.01,21,5,0)
2=Other coverage exists-payment collected
"^DD",9002313.82408,9002313.82408,.01,21,6,0)
3=Other coverage exists-this claim not
"^DD",9002313.82408,9002313.82408,.01,21,7,0)
covered
"^DD",9002313.82408,9002313.82408,.01,21,8,0)
4=Other coverage exists-payment not
"^DD",9002313.82408,9002313.82408,.01,21,9,0)
collected
"^DD",9002313.82408,9002313.82408,.01,21,10,0)
5=Managed care plan denial
"^DD",9002313.82408,9002313.82408,.01,21,11,0)
6=Other coverage denied-not a
"^DD",9002313.82408,9002313.82408,.01,21,12,0)
participating provider
"^DD",9002313.82408,9002313.82408,.01,21,13,0)
7=Other coverage exists-not in effect at
"^DD",9002313.82408,9002313.82408,.01,21,14,0)
time of service
"^DD",9002313.82408,9002313.82408,.01,21,15,0)
8=Claim is a billing for a copay
"^DD",9002313.82408,9002313.82408,.01,"DT")
3010409
"^DD",9002313.82408,9002313.82408,.02,0)
MEANING^F^^0;2^K:$L(X)>70!($L(X)<1) X
"^DD",9002313.82408,9002313.82408,.02,3)
Answer must be 1-70 characters in length.
"^DD",9002313.82408,9002313.82408,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82408,9002313.82408,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82408,9002313.82408,.02,"DT")
3010409
"^DD",9002313.82416,9002313.82416,0)
FIELD^^.02^2
"^DD",9002313.82416,9002313.82416,0,"DDA")
N
"^DD",9002313.82416,9002313.82416,0,"DT")
3010409
"^DD",9002313.82416,9002313.82416,0,"IX","B",9002313.82416,.01)

"^DD",9002313.82416,9002313.82416,0,"NM","BPS NCPDP FIELD 416")

"^DD",9002313.82416,9002313.82416,0,"VRPK")
BPS
"^DD",9002313.82416,9002313.82416,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82416,9002313.82416,.01,1,0)
^.1
"^DD",9002313.82416,9002313.82416,.01,1,1,0)
9002313.82416^B
"^DD",9002313.82416,9002313.82416,.01,1,1,1)
S ^BPSF(9002313.82416,"B",$E(X,1,30),DA)=""
"^DD",9002313.82416,9002313.82416,.01,1,1,2)
K ^BPSF(9002313.82416,"B",$E(X,1,30),DA)
"^DD",9002313.82416,9002313.82416,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82416,9002313.82416,.01,21,0)
^^12^12^3040107^
"^DD",9002313.82416,9002313.82416,.01,21,1,0)
Value indicating prior authorization or medical certification occurred,
"^DD",9002313.82416,9002313.82416,.01,21,2,0)
and the number associated with the code in the left most position.
"^DD",9002313.82416,9002313.82416,.01,21,3,0)
 
"^DD",9002313.82416,9002313.82416,.01,21,4,0)
=Not specified
"^DD",9002313.82416,9002313.82416,.01,21,5,0)
1=Prior authorization
"^DD",9002313.82416,9002313.82416,.01,21,6,0)
2=Medical certification
"^DD",9002313.82416,9002313.82416,.01,21,7,0)
3=EPSDT
"^DD",9002313.82416,9002313.82416,.01,21,8,0)
4=Exemption from co-pay
"^DD",9002313.82416,9002313.82416,.01,21,9,0)
5=Exemption from prescription limits
"^DD",9002313.82416,9002313.82416,.01,21,10,0)
6=Family planning indicator
"^DD",9002313.82416,9002313.82416,.01,21,11,0)
7=AFDC
"^DD",9002313.82416,9002313.82416,.01,21,12,0)
8=Payor defined exemption
"^DD",9002313.82416,9002313.82416,.01,"DT")
3010409
"^DD",9002313.82416,9002313.82416,.02,0)
MEANING^F^^0;2^K:$L(X)>50!($L(X)<1) X
"^DD",9002313.82416,9002313.82416,.02,3)
Answer must be 1-50 characters in length.
"^DD",9002313.82416,9002313.82416,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82416,9002313.82416,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82416,9002313.82416,.02,"DT")
3010409
"^DD",9002313.82419,9002313.82419,0)
FIELD^^.02^2
"^DD",9002313.82419,9002313.82419,0,"DDA")
N
"^DD",9002313.82419,9002313.82419,0,"DT")
3010409
"^DD",9002313.82419,9002313.82419,0,"IX","B",9002313.82419,.01)

"^DD",9002313.82419,9002313.82419,0,"NM","BPS NCPDP FIELD 419")

"^DD",9002313.82419,9002313.82419,0,"VRPK")
BPS
"^DD",9002313.82419,9002313.82419,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82419,9002313.82419,.01,1,0)
^.1
"^DD",9002313.82419,9002313.82419,.01,1,1,0)
9002313.82419^B
"^DD",9002313.82419,9002313.82419,.01,1,1,1)
S ^BPSF(9002313.82419,"B",$E(X,1,30),DA)=""
"^DD",9002313.82419,9002313.82419,.01,1,1,2)
K ^BPSF(9002313.82419,"B",$E(X,1,30),DA)
"^DD",9002313.82419,9002313.82419,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82419,9002313.82419,.01,21,0)
^^7^7^3040107^
"^DD",9002313.82419,9002313.82419,.01,21,1,0)
Code indicating the origin of the prescription.
"^DD",9002313.82419,9002313.82419,.01,21,2,0)
 
"^DD",9002313.82419,9002313.82419,.01,21,3,0)
=Not Specified
"^DD",9002313.82419,9002313.82419,.01,21,4,0)
1=Written
"^DD",9002313.82419,9002313.82419,.01,21,5,0)
2=Telephone
"^DD",9002313.82419,9002313.82419,.01,21,6,0)
3=Electronic
"^DD",9002313.82419,9002313.82419,.01,21,7,0)
4=Facsimile
"^DD",9002313.82419,9002313.82419,.01,"DT")
3010409
"^DD",9002313.82419,9002313.82419,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82419,9002313.82419,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82419,9002313.82419,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82419,9002313.82419,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82419,9002313.82419,.02,"DT")
3010409
"^DD",9002313.8242,9002313.8242,0)
FIELD^^.02^2
"^DD",9002313.8242,9002313.8242,0,"DDA")
N
"^DD",9002313.8242,9002313.8242,0,"DT")
3010409
"^DD",9002313.8242,9002313.8242,0,"IX","B",9002313.8242,.01)

"^DD",9002313.8242,9002313.8242,0,"NM","BPS NCPDP FIELD 420")

"^DD",9002313.8242,9002313.8242,0,"VRPK")
BPS
"^DD",9002313.8242,9002313.8242,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<2)!'(X'?1P.E) X
"^DD",9002313.8242,9002313.8242,.01,1,0)
^.1
"^DD",9002313.8242,9002313.8242,.01,1,1,0)
9002313.8242^B
"^DD",9002313.8242,9002313.8242,.01,1,1,1)
S ^BPSF(9002313.8242,"B",$E(X,1,30),DA)=""
"^DD",9002313.8242,9002313.8242,.01,1,1,2)
K ^BPSF(9002313.8242,"B",$E(X,1,30),DA)
"^DD",9002313.8242,9002313.8242,.01,3)
Answer must be 2 characters in length.
"^DD",9002313.8242,9002313.8242,.01,21,0)
^^32^32^3040107^
"^DD",9002313.8242,9002313.8242,.01,21,1,0)
Code indicating that the pharmacist is clarifying the submission.
"^DD",9002313.8242,9002313.8242,.01,21,2,0)
 
"^DD",9002313.8242,9002313.8242,.01,21,3,0)
=Not Specified, Default
"^DD",9002313.8242,9002313.8242,.01,21,4,0)
1=No Override
"^DD",9002313.8242,9002313.8242,.01,21,5,0)
2=Other Override
"^DD",9002313.8242,9002313.8242,.01,21,6,0)
3=Vacation Supply-The pharmacist is
"^DD",9002313.8242,9002313.8242,.01,21,7,0)
indicating that the cardholder has
"^DD",9002313.8242,9002313.8242,.01,21,8,0)
requested a vacation supply of the
"^DD",9002313.8242,9002313.8242,.01,21,9,0)
medicine.
"^DD",9002313.8242,9002313.8242,.01,21,10,0)
4=Lost Prescription-The pharmacist is
"^DD",9002313.8242,9002313.8242,.01,21,11,0)
indicating that the cardholder has
"^DD",9002313.8242,9002313.8242,.01,21,12,0)
requested a replacement of medication that
"^DD",9002313.8242,9002313.8242,.01,21,13,0)
has been lost.
"^DD",9002313.8242,9002313.8242,.01,21,14,0)
5=Therapy Change-The pharmacist is
"^DD",9002313.8242,9002313.8242,.01,21,15,0)
indicating that the physician has
"^DD",9002313.8242,9002313.8242,.01,21,16,0)
determined that a change in therapy was
"^DD",9002313.8242,9002313.8242,.01,21,17,0)
required; either that the medication was
"^DD",9002313.8242,9002313.8242,.01,21,18,0)
used faster than expected, or a different
"^DD",9002313.8242,9002313.8242,.01,21,19,0)
dosage form is needed, etc.
"^DD",9002313.8242,9002313.8242,.01,21,20,0)
6=Starter Dose-The pharmacist is
"^DD",9002313.8242,9002313.8242,.01,21,21,0)
indicating that the previous medication was
"^DD",9002313.8242,9002313.8242,.01,21,22,0)
a starter dose and now additional
"^DD",9002313.8242,9002313.8242,.01,21,23,0)
medication is needed to continue
"^DD",9002313.8242,9002313.8242,.01,21,24,0)
treatment.
"^DD",9002313.8242,9002313.8242,.01,21,25,0)
7=Medically Necessary-The pharmacist is
"^DD",9002313.8242,9002313.8242,.01,21,26,0)
indicating that this medication has been
"^DD",9002313.8242,9002313.8242,.01,21,27,0)
determined by the physician to be
"^DD",9002313.8242,9002313.8242,.01,21,28,0)
medically necessary
"^DD",9002313.8242,9002313.8242,.01,21,29,0)
8=Process Compound For Approved
"^DD",9002313.8242,9002313.8242,.01,21,30,0)
Ingredients
"^DD",9002313.8242,9002313.8242,.01,21,31,0)
9=Encounters
"^DD",9002313.8242,9002313.8242,.01,21,32,0)
99=Other
"^DD",9002313.8242,9002313.8242,.01,"DT")
3010409
"^DD",9002313.8242,9002313.8242,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.8242,9002313.8242,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.8242,9002313.8242,.02,21,0)
^^1^1^3031204^
"^DD",9002313.8242,9002313.8242,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.8242,9002313.8242,.02,"DT")
3010409
"^DD",9002313.82423,9002313.82423,0)
FIELD^^.02^2
"^DD",9002313.82423,9002313.82423,0,"DDA")
N
"^DD",9002313.82423,9002313.82423,0,"DT")
3010409
"^DD",9002313.82423,9002313.82423,0,"IX","B",9002313.82423,.01)

"^DD",9002313.82423,9002313.82423,0,"NM","BPS NCPDP FIELD 423")

"^DD",9002313.82423,9002313.82423,0,"VRPK")
BPS
"^DD",9002313.82423,9002313.82423,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<2)!'(X'?1P.E) X
"^DD",9002313.82423,9002313.82423,.01,1,0)
^.1
"^DD",9002313.82423,9002313.82423,.01,1,1,0)
9002313.82423^B
"^DD",9002313.82423,9002313.82423,.01,1,1,1)
S ^BPSF(9002313.82423,"B",$E(X,1,30),DA)=""
"^DD",9002313.82423,9002313.82423,.01,1,1,2)
K ^BPSF(9002313.82423,"B",$E(X,1,30),DA)
"^DD",9002313.82423,9002313.82423,.01,3)
Answer must be 2 characters in length.
"^DD",9002313.82423,9002313.82423,.01,21,0)
^^14^14^3040107^
"^DD",9002313.82423,9002313.82423,.01,21,1,0)
Code indicating the method by which 'Ingredient Cost Submitted' (Field
"^DD",9002313.82423,9002313.82423,.01,21,2,0)
49-D9) was calculated.
"^DD",9002313.82423,9002313.82423,.01,21,3,0)
 
"^DD",9002313.82423,9002313.82423,.01,21,4,0)
 
"^DD",9002313.82423,9002313.82423,.01,21,5,0)
Blank=Not Specified
"^DD",9002313.82423,9002313.82423,.01,21,6,0)
=Not Specified
"^DD",9002313.82423,9002313.82423,.01,21,7,0)
1=AWP (Average Wholesale Price)
"^DD",9002313.82423,9002313.82423,.01,21,8,0)
2=Local Wholesaler
"^DD",9002313.82423,9002313.82423,.01,21,9,0)
3=Direct
"^DD",9002313.82423,9002313.82423,.01,21,10,0)
4=EAC (Estimated Acquisition Cost)
"^DD",9002313.82423,9002313.82423,.01,21,11,0)
5=Acquisition
"^DD",9002313.82423,9002313.82423,.01,21,12,0)
6=MAC (Maximum Allowable Cost)
"^DD",9002313.82423,9002313.82423,.01,21,13,0)
7=Usual & Customary
"^DD",9002313.82423,9002313.82423,.01,21,14,0)
9=Other
"^DD",9002313.82423,9002313.82423,.01,"DT")
3010409
"^DD",9002313.82423,9002313.82423,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82423,9002313.82423,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82423,9002313.82423,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82423,9002313.82423,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82423,9002313.82423,.02,"DT")
3010409
"^DD",9002313.82425,9002313.82425,0)
FIELD^^.02^2
"^DD",9002313.82425,9002313.82425,0,"DDA")
N
"^DD",9002313.82425,9002313.82425,0,"DT")
3010409
"^DD",9002313.82425,9002313.82425,0,"IX","B",9002313.82425,.01)

"^DD",9002313.82425,9002313.82425,0,"NM","BPS NCPDP FIELD 425")

"^DD",9002313.82425,9002313.82425,0,"VRPK")
BPS
"^DD",9002313.82425,9002313.82425,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82425,9002313.82425,.01,1,0)
^.1
"^DD",9002313.82425,9002313.82425,.01,1,1,0)
9002313.82425^B
"^DD",9002313.82425,9002313.82425,.01,1,1,1)
S ^BPSF(9002313.82425,"B",$E(X,1,30),DA)=""
"^DD",9002313.82425,9002313.82425,.01,1,1,2)
K ^BPSF(9002313.82425,"B",$E(X,1,30),DA)
"^DD",9002313.82425,9002313.82425,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82425,9002313.82425,.01,21,0)
^^7^7^3040108^
"^DD",9002313.82425,9002313.82425,.01,21,1,0)
Code to indicate the type of drug dispensed.
"^DD",9002313.82425,9002313.82425,.01,21,2,0)
 
"^DD",9002313.82425,9002313.82425,.01,21,3,0)
=Not specified
"^DD",9002313.82425,9002313.82425,.01,21,4,0)
1=Single source brand
"^DD",9002313.82425,9002313.82425,.01,21,5,0)
2=Branded generic
"^DD",9002313.82425,9002313.82425,.01,21,6,0)
3=Generic
"^DD",9002313.82425,9002313.82425,.01,21,7,0)
4=O.T.C. (over the counter)
"^DD",9002313.82425,9002313.82425,.01,"DT")
3010409
"^DD",9002313.82425,9002313.82425,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82425,9002313.82425,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82425,9002313.82425,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82425,9002313.82425,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82425,9002313.82425,.02,"DT")
3010409
"^DD",9002313.82429,9002313.82429,0)
FIELD^^.02^2
"^DD",9002313.82429,9002313.82429,0,"DDA")
N
"^DD",9002313.82429,9002313.82429,0,"DT")
3010409
"^DD",9002313.82429,9002313.82429,0,"IX","B",9002313.82429,.01)

"^DD",9002313.82429,9002313.82429,0,"NM","BPS NCPDP FIELD 429")

"^DD",9002313.82429,9002313.82429,0,"VRPK")
BPS
"^DD",9002313.82429,9002313.82429,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82429,9002313.82429,.01,1,0)
^.1
"^DD",9002313.82429,9002313.82429,.01,1,1,0)
9002313.82429^B
"^DD",9002313.82429,9002313.82429,.01,1,1,1)
S ^BPSF(9002313.82429,"B",$E(X,1,30),DA)=""
"^DD",9002313.82429,9002313.82429,.01,1,1,2)
K ^BPSF(9002313.82429,"B",$E(X,1,30),DA)
"^DD",9002313.82429,9002313.82429,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82429,9002313.82429,.01,21,0)
^^6^6^3040108^
"^DD",9002313.82429,9002313.82429,.01,21,1,0)
Code indicating the type of unit dose dispensing.
"^DD",9002313.82429,9002313.82429,.01,21,2,0)
 
"^DD",9002313.82429,9002313.82429,.01,21,3,0)
=Not Specified
"^DD",9002313.82429,9002313.82429,.01,21,4,0)
1=Not Unit Dose
"^DD",9002313.82429,9002313.82429,.01,21,5,0)
2=Manufacturer Unit Dose
"^DD",9002313.82429,9002313.82429,.01,21,6,0)
3=Pharmacy Unit Dose
"^DD",9002313.82429,9002313.82429,.01,"DT")
3010409
"^DD",9002313.82429,9002313.82429,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82429,9002313.82429,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82429,9002313.82429,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82429,9002313.82429,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82429,9002313.82429,.02,"DT")
3010409
"^DD",9002313.82432,9002313.82432,0)
FIELD^^.02^2
"^DD",9002313.82432,9002313.82432,0,"DDA")
N
"^DD",9002313.82432,9002313.82432,0,"DT")
3010409
"^DD",9002313.82432,9002313.82432,0,"IX","B",9002313.82432,.01)

"^DD",9002313.82432,9002313.82432,0,"NM","BPS NCPDP FIELD 432")

"^DD",9002313.82432,9002313.82432,0,"VRPK")
BPS
"^DD",9002313.82432,9002313.82432,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82432,9002313.82432,.01,1,0)
^.1
"^DD",9002313.82432,9002313.82432,.01,1,1,0)
9002313.82432^B
"^DD",9002313.82432,9002313.82432,.01,1,1,1)
S ^BPSF(9002313.82432,"B",$E(X,1,30),DA)=""
"^DD",9002313.82432,9002313.82432,.01,1,1,2)
K ^BPSF(9002313.82432,"B",$E(X,1,30),DA)
"^DD",9002313.82432,9002313.82432,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82432,9002313.82432,.01,21,0)
^^7^7^3040108^
"^DD",9002313.82432,9002313.82432,.01,21,1,0)
Code indicating the method by which the days supply was determined.
"^DD",9002313.82432,9002313.82432,.01,21,2,0)
 
"^DD",9002313.82432,9002313.82432,.01,21,3,0)
 
"^DD",9002313.82432,9002313.82432,.01,21,4,0)
=Not specified
"^DD",9002313.82432,9002313.82432,.01,21,5,0)
1=Explicit directions
"^DD",9002313.82432,9002313.82432,.01,21,6,0)
2=PRN directions (take as needed pharmacist estimate)
"^DD",9002313.82432,9002313.82432,.01,21,7,0)
3=As directed by physician
"^DD",9002313.82432,9002313.82432,.01,"DT")
3010409
"^DD",9002313.82432,9002313.82432,.02,0)
MEANING^F^^0;2^K:$L(X)>50!($L(X)<1) X
"^DD",9002313.82432,9002313.82432,.02,3)
Answer must be 1-50 characters in length.
"^DD",9002313.82432,9002313.82432,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82432,9002313.82432,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82432,9002313.82432,.02,"DT")
3010409
"^DD",9002313.82436,9002313.82436,0)
FIELD^^.02^2
"^DD",9002313.82436,9002313.82436,0,"DDA")
N
"^DD",9002313.82436,9002313.82436,0,"DT")
3010409
"^DD",9002313.82436,9002313.82436,0,"IX","B",9002313.82436,.01)

"^DD",9002313.82436,9002313.82436,0,"NM","BPS NCPDP FIELD 436")

"^DD",9002313.82436,9002313.82436,0,"VRPK")
BPS
"^DD",9002313.82436,9002313.82436,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82436,9002313.82436,.01,1,0)
^.1
"^DD",9002313.82436,9002313.82436,.01,1,1,0)
9002313.82436^B
"^DD",9002313.82436,9002313.82436,.01,1,1,1)
S ^BPSF(9002313.82436,"B",$E(X,1,30),DA)=""
"^DD",9002313.82436,9002313.82436,.01,1,1,2)
K ^BPSF(9002313.82436,"B",$E(X,1,30),DA)
"^DD",9002313.82436,9002313.82436,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82436,9002313.82436,.01,21,0)
^^1^1^3040108^
"^DD",9002313.82436,9002313.82436,.01,21,1,0)
Code qualifying the value in 'Product/Service ID' (47-D7).
"^DD",9002313.82436,9002313.82436,.01,"DT")
3010409
"^DD",9002313.82436,9002313.82436,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82436,9002313.82436,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82436,9002313.82436,.02,21,0)
^.001^1^1^3031204^^
"^DD",9002313.82436,9002313.82436,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82436,9002313.82436,.02,"DT")
3010409
"^DD",9002313.82439,9002313.82439,0)
FIELD^^.02^2
"^DD",9002313.82439,9002313.82439,0,"DDA")
N
"^DD",9002313.82439,9002313.82439,0,"DT")
3010406
"^DD",9002313.82439,9002313.82439,0,"IX","B",9002313.82439,.01)

"^DD",9002313.82439,9002313.82439,0,"NM","BPS NCPDP FIELD 439")

"^DD",9002313.82439,9002313.82439,0,"VRPK")
BPS
"^DD",9002313.82439,9002313.82439,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<2)!'(X'?1P.E) X
"^DD",9002313.82439,9002313.82439,.01,1,0)
^.1
"^DD",9002313.82439,9002313.82439,.01,1,1,0)
9002313.82439^B
"^DD",9002313.82439,9002313.82439,.01,1,1,1)
S ^BPSF(9002313.82439,"B",$E(X,1,30),DA)=""
"^DD",9002313.82439,9002313.82439,.01,1,1,2)
K ^BPSF(9002313.82439,"B",$E(X,1,30),DA)
"^DD",9002313.82439,9002313.82439,.01,3)
Answer must be 2 characters in length.
"^DD",9002313.82439,9002313.82439,.01,21,0)
^^2^2^3040108^
"^DD",9002313.82439,9002313.82439,.01,21,1,0)
Code used when over-riding DUR warning.  The reason for
"^DD",9002313.82439,9002313.82439,.01,21,2,0)
service.
"^DD",9002313.82439,9002313.82439,.01,"DT")
3010406
"^DD",9002313.82439,9002313.82439,.02,0)
MEANING^F^^0;2^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.82439,9002313.82439,.02,3)
Answer must be 1-40 characters in length.
"^DD",9002313.82439,9002313.82439,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82439,9002313.82439,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82439,9002313.82439,.02,"DT")
3010406
"^DD",9002313.8244,9002313.8244,0)
FIELD^^.02^2
"^DD",9002313.8244,9002313.8244,0,"DDA")
N
"^DD",9002313.8244,9002313.8244,0,"DT")
3010409
"^DD",9002313.8244,9002313.8244,0,"IX","B",9002313.8244,.01)

"^DD",9002313.8244,9002313.8244,0,"NM","BPS NCPDP FIELD 440")

"^DD",9002313.8244,9002313.8244,0,"VRPK")
BPS
"^DD",9002313.8244,9002313.8244,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.8244,9002313.8244,.01,1,0)
^.1
"^DD",9002313.8244,9002313.8244,.01,1,1,0)
9002313.8244^B
"^DD",9002313.8244,9002313.8244,.01,1,1,1)
S ^BPSF(9002313.8244,"B",$E(X,1,30),DA)=""
"^DD",9002313.8244,9002313.8244,.01,1,1,2)
K ^BPSF(9002313.8244,"B",$E(X,1,30),DA)
"^DD",9002313.8244,9002313.8244,.01,3)
Answer must be 1-2 characters in length.
"^DD",9002313.8244,9002313.8244,.01,21,0)
^^1^1^3040108^
"^DD",9002313.8244,9002313.8244,.01,21,1,0)
Code indicating whether a DUR intervention was recorded.
"^DD",9002313.8244,9002313.8244,.01,"DT")
3010409
"^DD",9002313.8244,9002313.8244,.02,0)
MEANING^F^^0;2^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.8244,9002313.8244,.02,3)
Answer must be 1-40 characters in length.
"^DD",9002313.8244,9002313.8244,.02,21,0)
^^1^1^3031204^
"^DD",9002313.8244,9002313.8244,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.8244,9002313.8244,.02,"DT")
3010409
"^DD",9002313.82441,9002313.82441,0)
FIELD^^.02^2
"^DD",9002313.82441,9002313.82441,0,"DDA")
N
"^DD",9002313.82441,9002313.82441,0,"DT")
3010409
"^DD",9002313.82441,9002313.82441,0,"IX","B",9002313.82441,.01)

"^DD",9002313.82441,9002313.82441,0,"NM","BPS NCPDP FIELD 441")

"^DD",9002313.82441,9002313.82441,0,"VRPK")
BPS
"^DD",9002313.82441,9002313.82441,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<2)!'(X'?1P.E) X
"^DD",9002313.82441,9002313.82441,.01,1,0)
^.1
"^DD",9002313.82441,9002313.82441,.01,1,1,0)
9002313.82441^B
"^DD",9002313.82441,9002313.82441,.01,1,1,1)
S ^BPSF(9002313.82441,"B",$E(X,1,30),DA)=""
"^DD",9002313.82441,9002313.82441,.01,1,1,2)
K ^BPSF(9002313.82441,"B",$E(X,1,30),DA)
"^DD",9002313.82441,9002313.82441,.01,3)
Answer must be 2 characters in length.
"^DD",9002313.82441,9002313.82441,.01,21,0)
^^29^29^3040108^
"^DD",9002313.82441,9002313.82441,.01,21,1,0)
Action taken by a pharmacist in response to a conflict or the result of a
"^DD",9002313.82441,9002313.82441,.01,21,2,0)
pharmacist s professional service.
"^DD",9002313.82441,9002313.82441,.01,21,3,0)
 
"^DD",9002313.82441,9002313.82441,.01,21,4,0)
=Not Specified
"^DD",9002313.82441,9002313.82441,.01,21,5,0)
1A=Filled As Is, False Positive
"^DD",9002313.82441,9002313.82441,.01,21,6,0)
1B=Filled Prescription As Is
"^DD",9002313.82441,9002313.82441,.01,21,7,0)
1C=Filled, With Different Dose
"^DD",9002313.82441,9002313.82441,.01,21,8,0)
1D=Filled, With Different Directions
"^DD",9002313.82441,9002313.82441,.01,21,9,0)
1E=Filled, With Different Drug
"^DD",9002313.82441,9002313.82441,.01,21,10,0)
1F=Filled, With Different Quantity
"^DD",9002313.82441,9002313.82441,.01,21,11,0)
1G=Filled, With Prescriber Approval
"^DD",9002313.82441,9002313.82441,.01,21,12,0)
1H=Brand-to-Generic Change
"^DD",9002313.82441,9002313.82441,.01,21,13,0)
1J=Rx-to-OTC Change
"^DD",9002313.82441,9002313.82441,.01,21,14,0)
1K=Filled with Different Dosage Form
"^DD",9002313.82441,9002313.82441,.01,21,15,0)
2A=Prescription Not Filled
"^DD",9002313.82441,9002313.82441,.01,21,16,0)
2B=Not Filled, Directions Clarified
"^DD",9002313.82441,9002313.82441,.01,21,17,0)
3A=Recommendation Accepted
"^DD",9002313.82441,9002313.82441,.01,21,18,0)
3B=Recommendation Not Accepted
"^DD",9002313.82441,9002313.82441,.01,21,19,0)
3C=Discontinued Drug
"^DD",9002313.82441,9002313.82441,.01,21,20,0)
3D=Regimen Changed
"^DD",9002313.82441,9002313.82441,.01,21,21,0)
3E=Therapy Changed
"^DD",9002313.82441,9002313.82441,.01,21,22,0)
3F=Therapy Changed-cost increased
"^DD",9002313.82441,9002313.82441,.01,21,23,0)
acknowledged
"^DD",9002313.82441,9002313.82441,.01,21,24,0)
3G=Drug Therapy Unchanged
"^DD",9002313.82441,9002313.82441,.01,21,25,0)
3H=Follow-Up/Report
"^DD",9002313.82441,9002313.82441,.01,21,26,0)
3J=Patient Referral
"^DD",9002313.82441,9002313.82441,.01,21,27,0)
3K=Instructions Understood
"^DD",9002313.82441,9002313.82441,.01,21,28,0)
3M=Compliance Aid Provided
"^DD",9002313.82441,9002313.82441,.01,21,29,0)
3N=Medication Administered
"^DD",9002313.82441,9002313.82441,.01,"DT")
3010409
"^DD",9002313.82441,9002313.82441,.02,0)
MEANING^F^^0;2^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.82441,9002313.82441,.02,3)
Answer must be 1-40 characters in length.
"^DD",9002313.82441,9002313.82441,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82441,9002313.82441,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82441,9002313.82441,.02,"DT")
3010409
"^DD",9002313.82501,9002313.82501,0)
FIELD^^.02^2
"^DD",9002313.82501,9002313.82501,0,"DDA")
N
"^DD",9002313.82501,9002313.82501,0,"DT")
3010409
"^DD",9002313.82501,9002313.82501,0,"IX","B",9002313.82501,.01)

"^DD",9002313.82501,9002313.82501,0,"NM","BPS NCPDP FIELD 501")

"^DD",9002313.82501,9002313.82501,0,"VRPK")
BPS
"^DD",9002313.82501,9002313.82501,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82501,9002313.82501,.01,1,0)
^.1
"^DD",9002313.82501,9002313.82501,.01,1,1,0)
9002313.82501^B
"^DD",9002313.82501,9002313.82501,.01,1,1,1)
S ^BPSF(9002313.82501,"B",$E(X,1,30),DA)=""
"^DD",9002313.82501,9002313.82501,.01,1,1,2)
K ^BPSF(9002313.82501,"B",$E(X,1,30),DA)
"^DD",9002313.82501,9002313.82501,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82501,9002313.82501,.01,21,0)
^^4^4^3040108^
"^DD",9002313.82501,9002313.82501,.01,21,1,0)
Code indicating the status of the transmission.
"^DD",9002313.82501,9002313.82501,.01,21,2,0)
 
"^DD",9002313.82501,9002313.82501,.01,21,3,0)
A=Accepted
"^DD",9002313.82501,9002313.82501,.01,21,4,0)
R=Rejected
"^DD",9002313.82501,9002313.82501,.01,"DT")
3010409
"^DD",9002313.82501,9002313.82501,.02,0)
MEANING^F^^0;2^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.82501,9002313.82501,.02,3)
Answer must be 1-40 characters in length.
"^DD",9002313.82501,9002313.82501,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82501,9002313.82501,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82501,9002313.82501,.02,"DT")
3010409
"^DD",9002313.82522,9002313.82522,0)
FIELD^^.02^2
"^DD",9002313.82522,9002313.82522,0,"DDA")
N
"^DD",9002313.82522,9002313.82522,0,"DT")
3010409
"^DD",9002313.82522,9002313.82522,0,"IX","B",9002313.82522,.01)

"^DD",9002313.82522,9002313.82522,0,"NM","BPS NCPDP FIELD 522")

"^DD",9002313.82522,9002313.82522,0,"VRPK")
BPS
"^DD",9002313.82522,9002313.82522,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<2)!'(X'?1P.E) X
"^DD",9002313.82522,9002313.82522,.01,1,0)
^.1
"^DD",9002313.82522,9002313.82522,.01,1,1,0)
9002313.82522^B
"^DD",9002313.82522,9002313.82522,.01,1,1,1)
S ^BPSF(9002313.82522,"B",$E(X,1,30),DA)=""
"^DD",9002313.82522,9002313.82522,.01,1,1,2)
K ^BPSF(9002313.82522,"B",$E(X,1,30),DA)
"^DD",9002313.82522,9002313.82522,.01,3)
Answer must be 2 characters in length.
"^DD",9002313.82522,9002313.82522,.01,21,0)
^^16^16^3040108^
"^DD",9002313.82522,9002313.82522,.01,21,1,0)
Code identifying how the reimbursement amount was calculated for  
"^DD",9002313.82522,9002313.82522,.01,21,2,0)
Ingredient Cost Paid  (56-F6).
"^DD",9002313.82522,9002313.82522,.01,21,3,0)
 
"^DD",9002313.82522,9002313.82522,.01,21,4,0)
=Not Specified
"^DD",9002313.82522,9002313.82522,.01,21,5,0)
1=Ingredient Cost Paid as Submitted
"^DD",9002313.82522,9002313.82522,.01,21,6,0)
2=Ingredient Cost Reduced to AWP Pricing
"^DD",9002313.82522,9002313.82522,.01,21,7,0)
3=Ingredient Cost Reduced to AWP Less
"^DD",9002313.82522,9002313.82522,.01,21,8,0)
X% Pricing
"^DD",9002313.82522,9002313.82522,.01,21,9,0)
4=Usual & Customary Paid as Submitted
"^DD",9002313.82522,9002313.82522,.01,21,10,0)
5=Paid Lower of Ingredient Cost Plus Fees
"^DD",9002313.82522,9002313.82522,.01,21,11,0)
Versus Usual & Customary
"^DD",9002313.82522,9002313.82522,.01,21,12,0)
6=MAC Pricing Ingredient Cost Paid
"^DD",9002313.82522,9002313.82522,.01,21,13,0)
7=MAC Pricing Ingredient Cost Reduced to
"^DD",9002313.82522,9002313.82522,.01,21,14,0)
MAC
"^DD",9002313.82522,9002313.82522,.01,21,15,0)
8=Contract Pricing
"^DD",9002313.82522,9002313.82522,.01,21,16,0)
9=Acquisition Pricing
"^DD",9002313.82522,9002313.82522,.01,"DT")
3010409
"^DD",9002313.82522,9002313.82522,.02,0)
MEANING^F^^0;2^K:$L(X)>70!($L(X)<1) X
"^DD",9002313.82522,9002313.82522,.02,3)
Answer must be 1-70 characters in length.
"^DD",9002313.82522,9002313.82522,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82522,9002313.82522,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82522,9002313.82522,.02,"DT")
3010409
"^DD",9002313.82528,9002313.82528,0)
FIELD^^.02^2
"^DD",9002313.82528,9002313.82528,0,"DDA")
N
"^DD",9002313.82528,9002313.82528,0,"DT")
3010406
"^DD",9002313.82528,9002313.82528,0,"IX","B",9002313.82528,.01)

"^DD",9002313.82528,9002313.82528,0,"NM","BPS NCPDP FIELD 528")

"^DD",9002313.82528,9002313.82528,0,"VRPK")
BPS
"^DD",9002313.82528,9002313.82528,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82528,9002313.82528,.01,1,0)
^.1
"^DD",9002313.82528,9002313.82528,.01,1,1,0)
9002313.82528^B
"^DD",9002313.82528,9002313.82528,.01,1,1,1)
S ^BPSF(9002313.82528,"B",$E(X,1,30),DA)=""
"^DD",9002313.82528,9002313.82528,.01,1,1,2)
K ^BPSF(9002313.82528,"B",$E(X,1,30),DA)
"^DD",9002313.82528,9002313.82528,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82528,9002313.82528,.01,21,0)
^^7^7^3040108^
"^DD",9002313.82528,9002313.82528,.01,21,1,0)
Code identifying the significance or severity level of a clinical event as
"^DD",9002313.82528,9002313.82528,.01,21,2,0)
contained in the originating data base.
"^DD",9002313.82528,9002313.82528,.01,21,3,0)
 
"^DD",9002313.82528,9002313.82528,.01,21,4,0)
Blank=Not Specified
"^DD",9002313.82528,9002313.82528,.01,21,5,0)
1=Major
"^DD",9002313.82528,9002313.82528,.01,21,6,0)
2=Moderate
"^DD",9002313.82528,9002313.82528,.01,21,7,0)
3=Minor
"^DD",9002313.82528,9002313.82528,.01,"DT")
3010406
"^DD",9002313.82528,9002313.82528,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82528,9002313.82528,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82528,9002313.82528,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82528,9002313.82528,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82528,9002313.82528,.02,"DT")
3010406
"^DD",9002313.82529,9002313.82529,0)
FIELD^^.02^2
"^DD",9002313.82529,9002313.82529,0,"DDA")
N
"^DD",9002313.82529,9002313.82529,0,"DT")
3010406
"^DD",9002313.82529,9002313.82529,0,"IX","B",9002313.82529,.01)

"^DD",9002313.82529,9002313.82529,0,"NM","BPS NCPDP FIELD 529")

"^DD",9002313.82529,9002313.82529,0,"VRPK")
BPS
"^DD",9002313.82529,9002313.82529,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82529,9002313.82529,.01,1,0)
^.1
"^DD",9002313.82529,9002313.82529,.01,1,1,0)
9002313.82529^B
"^DD",9002313.82529,9002313.82529,.01,1,1,1)
S ^BPSF(9002313.82529,"B",$E(X,1,30),DA)=""
"^DD",9002313.82529,9002313.82529,.01,1,1,2)
K ^BPSF(9002313.82529,"B",$E(X,1,30),DA)
"^DD",9002313.82529,9002313.82529,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82529,9002313.82529,.01,21,0)
^^7^7^3040108^
"^DD",9002313.82529,9002313.82529,.01,21,1,0)
Code indicating the pharmacy responsible for the previous event involved
"^DD",9002313.82529,9002313.82529,.01,21,2,0)
in the DUR conflict.
"^DD",9002313.82529,9002313.82529,.01,21,3,0)
 
"^DD",9002313.82529,9002313.82529,.01,21,4,0)
=Not Specified
"^DD",9002313.82529,9002313.82529,.01,21,5,0)
1=Your Pharmacy
"^DD",9002313.82529,9002313.82529,.01,21,6,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.82529,9002313.82529,.01,21,7,0)
3=Other Pharmacy
"^DD",9002313.82529,9002313.82529,.01,"DT")
3010406
"^DD",9002313.82529,9002313.82529,.02,0)
MEANING^F^^0;2^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.82529,9002313.82529,.02,3)
Answer must be 1-40 characters in length.
"^DD",9002313.82529,9002313.82529,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82529,9002313.82529,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82529,9002313.82529,.02,"DT")
3010406
"^DD",9002313.82532,9002313.82532,0)
FIELD^^.02^2
"^DD",9002313.82532,9002313.82532,0,"DDA")
N
"^DD",9002313.82532,9002313.82532,0,"DT")
3010406
"^DD",9002313.82532,9002313.82532,0,"IX","B",9002313.82532,.01)

"^DD",9002313.82532,9002313.82532,0,"NM","BPS NCPDP FIELD 532")

"^DD",9002313.82532,9002313.82532,0,"VRPK")
BPS
"^DD",9002313.82532,9002313.82532,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82532,9002313.82532,.01,1,0)
^.1
"^DD",9002313.82532,9002313.82532,.01,1,1,0)
9002313.82532^B
"^DD",9002313.82532,9002313.82532,.01,1,1,1)
S ^BPSF(9002313.82532,"B",$E(X,1,30),DA)=""
"^DD",9002313.82532,9002313.82532,.01,1,1,2)
K ^BPSF(9002313.82532,"B",$E(X,1,30),DA)
"^DD",9002313.82532,9002313.82532,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82532,9002313.82532,.01,21,0)
^^8^8^3040108^
"^DD",9002313.82532,9002313.82532,.01,21,1,0)
Code identifying the source of drug information used for DUR processing.
"^DD",9002313.82532,9002313.82532,.01,21,2,0)
 
"^DD",9002313.82532,9002313.82532,.01,21,3,0)
Blank=Not Specified
"^DD",9002313.82532,9002313.82532,.01,21,4,0)
1=First Databank
"^DD",9002313.82532,9002313.82532,.01,21,5,0)
2=Medi-Span
"^DD",9002313.82532,9002313.82532,.01,21,6,0)
3=Redbook
"^DD",9002313.82532,9002313.82532,.01,21,7,0)
4=Processor Developed
"^DD",9002313.82532,9002313.82532,.01,21,8,0)
5=Other
"^DD",9002313.82532,9002313.82532,.01,"DT")
3010406
"^DD",9002313.82532,9002313.82532,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82532,9002313.82532,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82532,9002313.82532,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82532,9002313.82532,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82532,9002313.82532,.02,"DT")
3010406
"^DD",9002313.82533,9002313.82533,0)
FIELD^^.02^2
"^DD",9002313.82533,9002313.82533,0,"DDA")
N
"^DD",9002313.82533,9002313.82533,0,"DT")
3010406
"^DD",9002313.82533,9002313.82533,0,"IX","B",9002313.82533,.01)

"^DD",9002313.82533,9002313.82533,0,"NM","BPS NCPDP FIELD 533")

"^DD",9002313.82533,9002313.82533,0,"VRPK")
BPS
"^DD",9002313.82533,9002313.82533,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82533,9002313.82533,.01,1,0)
^.1
"^DD",9002313.82533,9002313.82533,.01,1,1,0)
9002313.82533^B
"^DD",9002313.82533,9002313.82533,.01,1,1,1)
S ^BPSF(9002313.82533,"B",$E(X,1,30),DA)=""
"^DD",9002313.82533,9002313.82533,.01,1,1,2)
K ^BPSF(9002313.82533,"B",$E(X,1,30),DA)
"^DD",9002313.82533,9002313.82533,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82533,9002313.82533,.01,21,0)
^^6^6^3040108^
"^DD",9002313.82533,9002313.82533,.01,21,1,0)
Code comparing the prescriber of the current prescription to the
"^DD",9002313.82533,9002313.82533,.01,21,2,0)
prescriber of the previously filled conflicting prescription.
"^DD",9002313.82533,9002313.82533,.01,21,3,0)
 
"^DD",9002313.82533,9002313.82533,.01,21,4,0)
=Not Specified
"^DD",9002313.82533,9002313.82533,.01,21,5,0)
1=Same Prescriber
"^DD",9002313.82533,9002313.82533,.01,21,6,0)
2=Other Prescriber
"^DD",9002313.82533,9002313.82533,.01,"DT")
3010406
"^DD",9002313.82533,9002313.82533,.02,0)
MEANING^F^^0;2^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.82533,9002313.82533,.02,3)
Answer must be 1-40 characters in length.
"^DD",9002313.82533,9002313.82533,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82533,9002313.82533,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82533,9002313.82533,.02,"DT")
3010406
"^DD",9002313.82535,9002313.82535,0)
FIELD^^.02^2
"^DD",9002313.82535,9002313.82535,0,"DDA")
N
"^DD",9002313.82535,9002313.82535,0,"DT")
3010406
"^DD",9002313.82535,9002313.82535,0,"IX","B",9002313.82535,.01)

"^DD",9002313.82535,9002313.82535,0,"NM","BPS NCPDP FIELD 535")

"^DD",9002313.82535,9002313.82535,0,"VRPK")
BPS
"^DD",9002313.82535,9002313.82535,.01,0)
CODE^RF^^0;1^K:$L(X)>1!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.82535,9002313.82535,.01,1,0)
^.1
"^DD",9002313.82535,9002313.82535,.01,1,1,0)
9002313.82535^B
"^DD",9002313.82535,9002313.82535,.01,1,1,1)
S ^BPSF(9002313.82535,"B",$E(X,1,30),DA)=""
"^DD",9002313.82535,9002313.82535,.01,1,1,2)
K ^BPSF(9002313.82535,"B",$E(X,1,30),DA)
"^DD",9002313.82535,9002313.82535,.01,3)
Answer must be 1 character in length.
"^DD",9002313.82535,9002313.82535,.01,21,0)
^^2^2^3040108^
"^DD",9002313.82535,9002313.82535,.01,21,1,0)
An indication to the originator of the claim that additional DUR
"^DD",9002313.82535,9002313.82535,.01,21,2,0)
information is available from the processor.
"^DD",9002313.82535,9002313.82535,.01,"DT")
3010406
"^DD",9002313.82535,9002313.82535,.02,0)
MEANING^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.82535,9002313.82535,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.82535,9002313.82535,.02,21,0)
^^1^1^3031204^
"^DD",9002313.82535,9002313.82535,.02,21,1,0)
What data element the two letter represents in the NCPDP standard.
"^DD",9002313.82535,9002313.82535,.02,"DT")
3010406
"^DD",9002313.83,9002313.83,0)
FIELD^^.03^3
"^DD",9002313.83,9002313.83,0,"DDA")
N
"^DD",9002313.83,9002313.83,0,"DT")
3010411
"^DD",9002313.83,9002313.83,0,"IX","B",9002313.83,.01)

"^DD",9002313.83,9002313.83,0,"IX","C",9002313.83,.03)

"^DD",9002313.83,9002313.83,0,"NM","BPS RESULT CATEGORY")

"^DD",9002313.83,9002313.83,0,"VRPK")
BPS
"^DD",9002313.83,9002313.83,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.83,9002313.83,.01,1,0)
^.1
"^DD",9002313.83,9002313.83,.01,1,1,0)
9002313.83^B
"^DD",9002313.83,9002313.83,.01,1,1,1)
S ^BPSF(9002313.83,"B",$E(X,1,30),DA)=""
"^DD",9002313.83,9002313.83,.01,1,1,2)
K ^BPSF(9002313.83,"B",$E(X,1,30),DA)
"^DD",9002313.83,9002313.83,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",9002313.83,9002313.83,.01,21,0)
^^1^1^3040126^
"^DD",9002313.83,9002313.83,.01,21,1,0)
Descriptive name of this result category.
"^DD",9002313.83,9002313.83,.01,"DT")
3040126
"^DD",9002313.83,9002313.83,.02,0)
ABBREVIATION^F^^0;2^K:$L(X)>5!($L(X)<1) X
"^DD",9002313.83,9002313.83,.02,3)
Answer must be 1-5 characters in length.
"^DD",9002313.83,9002313.83,.02,21,0)
^^1^1^3010410^
"^DD",9002313.83,9002313.83,.02,21,1,0)
An abbreviation which can be displayed in a 5-character wide column.
"^DD",9002313.83,9002313.83,.02,"DT")
3010410
"^DD",9002313.83,9002313.83,.03,0)
OTHER NAME^F^^0;3^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.83,9002313.83,.03,1,0)
^.1
"^DD",9002313.83,9002313.83,.03,1,1,0)
9002313.83^C
"^DD",9002313.83,9002313.83,.03,1,1,1)
S ^BPSF(9002313.83,"C",$E(X,1,30),DA)=""
"^DD",9002313.83,9002313.83,.03,1,1,2)
K ^BPSF(9002313.83,"C",$E(X,1,30),DA)
"^DD",9002313.83,9002313.83,.03,1,1,"DT")
3010411
"^DD",9002313.83,9002313.83,.03,3)
Answer must be 1-20 characters in length.
"^DD",9002313.83,9002313.83,.03,21,0)
^^2^2^3010411^
"^DD",9002313.83,9002313.83,.03,21,1,0)
Any other way of saying this kind of a claim result, usually
"^DD",9002313.83,9002313.83,.03,21,2,0)
colloquial or short, usually without the "E " prefix.  For lookup.
"^DD",9002313.83,9002313.83,.03,"DT")
3010411
"^DD",9002313.89,9002313.89,0)
FIELD^^.02^2
"^DD",9002313.89,9002313.89,0,"DDA")
N
"^DD",9002313.89,9002313.89,0,"DT")
2950623
"^DD",9002313.89,9002313.89,0,"IX","B",9002313.89,.01)

"^DD",9002313.89,9002313.89,0,"NM","BPS ERROR CODES")

"^DD",9002313.89,9002313.89,0,"VRPK")
BPS
"^DD",9002313.89,9002313.89,.01,0)
Code^RNJ5,0X^^0;1^K:+X'=X!(X>99999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",9002313.89,9002313.89,.01,1,0)
^.1
"^DD",9002313.89,9002313.89,.01,1,1,0)
9002313.89^B
"^DD",9002313.89,9002313.89,.01,1,1,1)
S ^BPSF(9002313.89,"B",$E(X,1,30),DA)=""
"^DD",9002313.89,9002313.89,.01,1,1,2)
K ^BPSF(9002313.89,"B",$E(X,1,30),DA)
"^DD",9002313.89,9002313.89,.01,3)
Type a Number between 1 and 99999, 0 Decimal Digits
"^DD",9002313.89,9002313.89,.01,21,0)
^^1^1^3031125^
"^DD",9002313.89,9002313.89,.01,21,1,0)
Numeric code associated with this particular error.
"^DD",9002313.89,9002313.89,.01,"DT")
3031125
"^DD",9002313.89,9002313.89,.02,0)
Description^F^^0;2^K:$L(X)>70!($L(X)<1) X
"^DD",9002313.89,9002313.89,.02,3)
Answer must be 1-70 characters in length.
"^DD",9002313.89,9002313.89,.02,21,0)
^^1^1^3031125^
"^DD",9002313.89,9002313.89,.02,21,1,0)
Textual description of the error.
"^DD",9002313.89,9002313.89,.02,"DT")
3031125
"^DD",9002313.91,9002313.91,0)
FIELD^^40^11
"^DD",9002313.91,9002313.91,0,"DDA")
N
"^DD",9002313.91,9002313.91,0,"DT")
3030512
"^DD",9002313.91,9002313.91,0,"ID",.03)
W "   ",$P(^(0),U,3)
"^DD",9002313.91,9002313.91,0,"IX","B",9002313.91,.01)

"^DD",9002313.91,9002313.91,0,"IX","C",9002313.91,.03)

"^DD",9002313.91,9002313.91,0,"IX","D",9002313.91,.06)

"^DD",9002313.91,9002313.91,0,"NM","BPS NCPDP FIELD DEFS")

"^DD",9002313.91,9002313.91,0,"PT",9002313.311,.01)

"^DD",9002313.91,9002313.91,0,"PT",9002313.3121,.01)

"^DD",9002313.91,9002313.91,0,"PT",9002313.5111,.01)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9201,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9202,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9203,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9204,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9205,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9206,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9207,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9208,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9209,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.921,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9213,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9214,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9215,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9216,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9217,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9218,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9219,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.922,.02)

"^DD",9002313.91,9002313.91,0,"VRPK")
BPS
"^DD",9002313.91,9002313.91,.01,0)
Number^RNJ6,2^^0;1^K:+X'=X!(X>800)!(X<0)!(X?.E1"."3N.N) X
"^DD",9002313.91,9002313.91,.01,1,0)
^.1
"^DD",9002313.91,9002313.91,.01,1,1,0)
9002313.91^B
"^DD",9002313.91,9002313.91,.01,1,1,1)
S ^BPSF(9002313.91,"B",$E(X,1,30),DA)=""
"^DD",9002313.91,9002313.91,.01,1,1,2)
K ^BPSF(9002313.91,"B",$E(X,1,30),DA)
"^DD",9002313.91,9002313.91,.01,3)
Type a Number between 0 and 800, 2 Decimal Digits
"^DD",9002313.91,9002313.91,.01,21,0)
^^1^1^3040121^
"^DD",9002313.91,9002313.91,.01,21,1,0)
The NCPDP field number from the NCPDP data dictionary.
"^DD",9002313.91,9002313.91,.01,"DT")
3030512
"^DD",9002313.91,9002313.91,.02,0)
ID^F^^0;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.91,9002313.91,.02,3)
Answer must be 2 characters in length.
"^DD",9002313.91,9002313.91,.02,21,0)
^^2^2^3040121^
"^DD",9002313.91,9002313.91,.02,21,1,0)
The Alphanumeric field identifier.  Each field consists of
"^DD",9002313.91,9002313.91,.02,21,2,0)
a 3 digit numeric and a two digit alpha segment.
"^DD",9002313.91,9002313.91,.02,"DT")
2950406
"^DD",9002313.91,9002313.91,.03,0)
Name^F^^0;3^K:$L(X)>30!($L(X)<3) X
"^DD",9002313.91,9002313.91,.03,1,0)
^.1
"^DD",9002313.91,9002313.91,.03,1,1,0)
9002313.91^C
"^DD",9002313.91,9002313.91,.03,1,1,1)
S ^BPSF(9002313.91,"C",$E(X,1,30),DA)=""
"^DD",9002313.91,9002313.91,.03,1,1,2)
K ^BPSF(9002313.91,"C",$E(X,1,30),DA)
"^DD",9002313.91,9002313.91,.03,1,1,"DT")
3001007
"^DD",9002313.91,9002313.91,.03,3)
Answer must be 3-30 characters in length.
"^DD",9002313.91,9002313.91,.03,21,0)
^^2^2^3040121^
"^DD",9002313.91,9002313.91,.03,21,1,0)
Descriptive name the tells what the field is within the
"^DD",9002313.91,9002313.91,.03,21,2,0)
pharmacy environment.
"^DD",9002313.91,9002313.91,.03,"DT")
3001007
"^DD",9002313.91,9002313.91,.04,0)
Format^S^N:NUMERIC;A/N:ALPHA/NUMERIC;D:SIGNED NUMERIC;^0;4^Q
"^DD",9002313.91,9002313.91,.04,21,0)
^^2^2^3040121^
"^DD",9002313.91,9002313.91,.04,21,1,0)
M code goes here to format the field before storing it in the
"^DD",9002313.91,9002313.91,.04,21,2,0)
database.  
"^DD",9002313.91,9002313.91,.04,"DT")
2950406
"^DD",9002313.91,9002313.91,.05,0)
Length^NJ4,0^^0;5^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.91,9002313.91,.05,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.91,9002313.91,.05,21,0)
^^1^1^3040121^
"^DD",9002313.91,9002313.91,.05,21,1,0)
Max length of the field from the NCPDP data dictionary.
"^DD",9002313.91,9002313.91,.05,"DT")
2950406
"^DD",9002313.91,9002313.91,.06,0)
5.1 ID^F^^5;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.91,9002313.91,.06,1,0)
^.1
"^DD",9002313.91,9002313.91,.06,1,1,0)
9002313.91^D
"^DD",9002313.91,9002313.91,.06,1,1,1)
S ^BPSF(9002313.91,"D",$E(X,1,30),DA)=""
"^DD",9002313.91,9002313.91,.06,1,1,2)
K ^BPSF(9002313.91,"D",$E(X,1,30),DA)
"^DD",9002313.91,9002313.91,.06,1,1,"%D",0)
^^3^3^3020807^
"^DD",9002313.91,9002313.91,.06,1,1,"%D",1,0)
Cross reference of the 5.1 Field ID.  This cross reference will be used in
"^DD",9002313.91,9002313.91,.06,1,1,"%D",2,0)
the processing of the response as a means of translating the value to a
"^DD",9002313.91,9002313.91,.06,1,1,"%D",3,0)
field number.
"^DD",9002313.91,9002313.91,.06,1,1,"DT")
3020807
"^DD",9002313.91,9002313.91,.06,3)
Answer must be 2 characters in length.
"^DD",9002313.91,9002313.91,.06,21,0)
^^3^3^3040121^
"^DD",9002313.91,9002313.91,.06,21,1,0)
The same as the .02 field, but for specific use when creating
"^DD",9002313.91,9002313.91,.06,21,2,0)
5.1 claims.  The 5.1 fields were separated because IHS was doing
"^DD",9002313.91,9002313.91,.06,21,3,0)
3.x and 5.1 claims concurrently.
"^DD",9002313.91,9002313.91,.06,"DT")
3020807
"^DD",9002313.91,9002313.91,.07,0)
5.1 Length^NJ4,0^^5;2^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.91,9002313.91,.07,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.91,9002313.91,.07,21,0)
^^1^1^3040121^
"^DD",9002313.91,9002313.91,.07,21,1,0)
Length of the field from the 5.1 NCPDP standard.
"^DD",9002313.91,9002313.91,.07,"DT")
3020724
"^DD",9002313.91,9002313.91,10,0)
Get Code^9002313.9101^^10;0
"^DD",9002313.91,9002313.91,10,21,0)
^^2^2^3040121^
"^DD",9002313.91,9002313.91,10,21,1,0)
M code that tells the BPS system where to find the 
"^DD",9002313.91,9002313.91,10,21,2,0)
particular piece of data for this field.
"^DD",9002313.91,9002313.91,20,0)
Format Code^9002313.9102^^20;0
"^DD",9002313.91,9002313.91,20,21,0)
^^1^1^3040322^
"^DD",9002313.91,9002313.91,20,21,1,0)
M code to format the data before storing it in the claim.
"^DD",9002313.91,9002313.91,30,0)
Set Code^9002313.9103^^30;0
"^DD",9002313.91,9002313.91,30,21,0)
^^1^1^3040326^
"^DD",9002313.91,9002313.91,30,21,1,0)
M code to store the data in the appropriate segment within the claim.
"^DD",9002313.91,9002313.91,40,0)
5.1 Format Code^9002313.9104^^25;0
"^DD",9002313.91,9002313.91,40,21,0)
^.001^3^3^3040326^^
"^DD",9002313.91,9002313.91,40,21,1,0)
M code to format the data before storing it in the claim.
"^DD",9002313.91,9002313.91,40,21,2,0)
5.1 was separate within IHS because they were doing 3.2 and
"^DD",9002313.91,9002313.91,40,21,3,0)
5.1 at the same time.
"^DD",9002313.91,9002313.9101,0)
Get Code SUB-FIELD^^.01^1
"^DD",9002313.91,9002313.9101,0,"DT")
2950420
"^DD",9002313.91,9002313.9101,0,"NM","Get Code")

"^DD",9002313.91,9002313.9101,0,"UP")
9002313.91
"^DD",9002313.91,9002313.9101,.01,0)
Get Code^WL^^0;1^Q
"^DD",9002313.91,9002313.9101,.01,"DT")
2950420
"^DD",9002313.91,9002313.9102,0)
Format Code SUB-FIELD^^.01^1
"^DD",9002313.91,9002313.9102,0,"DT")
2950420
"^DD",9002313.91,9002313.9102,0,"NM","Format Code")

"^DD",9002313.91,9002313.9102,0,"UP")
9002313.91
"^DD",9002313.91,9002313.9102,.01,0)
Format Code^WL^^0;1^Q
"^DD",9002313.91,9002313.9102,.01,"DT")
2950420
"^DD",9002313.91,9002313.9103,0)
Set Code SUB-FIELD^^.01^1
"^DD",9002313.91,9002313.9103,0,"DT")
2950420
"^DD",9002313.91,9002313.9103,0,"NM","Set Code")

"^DD",9002313.91,9002313.9103,0,"UP")
9002313.91
"^DD",9002313.91,9002313.9103,.01,0)
Set Code^WL^^0;1^Q
"^DD",9002313.91,9002313.9103,.01,"DT")
2950420
"^DD",9002313.91,9002313.9104,0)
5.1 Format Code SUB-FIELD^^.01^1
"^DD",9002313.91,9002313.9104,0,"DT")
3020724
"^DD",9002313.91,9002313.9104,0,"NM","5.1 Format Code")

"^DD",9002313.91,9002313.9104,0,"UP")
9002313.91
"^DD",9002313.91,9002313.9104,.01,0)
5.1 Format Code^WL^^0;1^Q
"^DD",9002313.91,9002313.9104,.01,"DT")
3020724
"^DD",9002313.92,9002313.92,0)
FIELD^^1901^35
"^DD",9002313.92,9002313.92,0,"DDA")
N
"^DD",9002313.92,9002313.92,0,"DT")
3051230
"^DD",9002313.92,9002313.92,0,"IX","B",9002313.92,.01)

"^DD",9002313.92,9002313.92,0,"IX","C",9002313.92,1.01)

"^DD",9002313.92,9002313.92,0,"IX","D",9002313.92,1.04)

"^DD",9002313.92,9002313.92,0,"NM","BPS NCPDP FORMATS")

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.07)

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.08)

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.09)

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.11)

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.12)

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.13)

"^DD",9002313.92,9002313.92,0,"PT",9002313.02,.02)

"^DD",9002313.92,9002313.92,0,"PT",9002313.31,.04)

"^DD",9002313.92,9002313.92,0,"PT",9002313.31,901)

"^DD",9002313.92,9002313.92,0,"PT",9002313.31902,1)

"^DD",9002313.92,9002313.92,0,"PT",9002313.4,100.01)

"^DD",9002313.92,9002313.92,0,"PT",9002313.512,8.12)

"^DD",9002313.92,9002313.92,0,"PT",9002313.512,8.13)

"^DD",9002313.92,9002313.92,0,"PT",9002313.57902,902.02)

"^DD",9002313.92,9002313.92,0,"PT",9002313.57902,902.19)

"^DD",9002313.92,9002313.92,0,"PT",9002313.57902,902.21)

"^DD",9002313.92,9002313.92,0,"PT",9002313.59902,902.02)

"^DD",9002313.92,9002313.92,0,"PT",9002313.59902,902.19)

"^DD",9002313.92,9002313.92,0,"PT",9002313.59902,902.21)

"^DD",9002313.92,9002313.92,0,"PT",9002313.92,1001)

"^DD",9002313.92,9002313.92,0,"VRPK")
BPS
"^DD",9002313.92,9002313.92,.01,0)
Record Format Name^RF^^0;1^K:$L(X)>30!($L(X)<3) X
"^DD",9002313.92,9002313.92,.01,1,0)
^.1
"^DD",9002313.92,9002313.92,.01,1,1,0)
9002313.92^B
"^DD",9002313.92,9002313.92,.01,1,1,1)
S ^BPSF(9002313.92,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.92,.01,1,1,2)
K ^BPSF(9002313.92,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.92,.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.92,9002313.92,.01,21,0)
^.001^1^1^3040220^^
"^DD",9002313.92,9002313.92,.01,21,1,0)
Textual description of this record format.
"^DD",9002313.92,9002313.92,.01,"DT")
3031125
"^DD",9002313.92,9002313.92,1.01,0)
NDC BIN Number^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.92,9002313.92,1.01,1,0)
^.1
"^DD",9002313.92,9002313.92,1.01,1,1,0)
9002313.92^C
"^DD",9002313.92,9002313.92,1.01,1,1,1)
S ^BPSF(9002313.92,"C",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.92,1.01,1,1,2)
K ^BPSF(9002313.92,"C",$E(X,1,30),DA)
"^DD",9002313.92,9002313.92,1.01,1,1,"DT")
3010112
"^DD",9002313.92,9002313.92,1.01,3)
Answer must be 1-10 characters in length.
"^DD",9002313.92,9002313.92,1.01,21,0)
^^1^1^3031125^
"^DD",9002313.92,9002313.92,1.01,21,1,0)
Identifying number for this format.
"^DD",9002313.92,9002313.92,1.01,"DT")
3031125
"^DD",9002313.92,9002313.92,1.02,0)
Version^S^32:Version 3.2;3A:Version 3.A;3C:Version 3.C;3B:Version 3.B;51:Version 5.1;^1;2^Q
"^DD",9002313.92,9002313.92,1.02,21,0)
^^1^1^3031125^
"^DD",9002313.92,9002313.92,1.02,21,1,0)
Version number under which this format is sent.
"^DD",9002313.92,9002313.92,1.02,"DT")
3031125
"^DD",9002313.92,9002313.92,1.03,0)
Maximum RX's Per Claim^NJ2,0^^1;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.92,1.03,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",9002313.92,9002313.92,1.03,21,0)
^^2^2^3031125^
"^DD",9002313.92,9002313.92,1.03,21,1,0)
Integer value indicating the maximum number of prescriptions that can be 
"^DD",9002313.92,9002313.92,1.03,21,2,0)
sent per claim number.
"^DD",9002313.92,9002313.92,1.03,"DT")
3031125
"^DD",9002313.92,9002313.92,1.04,0)
Envoy Plan Number^NJ6,0^^1;4^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.92,1.04,1,0)
^.1
"^DD",9002313.92,9002313.92,1.04,1,1,0)
9002313.92^D
"^DD",9002313.92,9002313.92,1.04,1,1,1)
S ^BPSF(9002313.92,"D",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.92,1.04,1,1,2)
K ^BPSF(9002313.92,"D",$E(X,1,30),DA)
"^DD",9002313.92,9002313.92,1.04,1,1,"DT")
3010112
"^DD",9002313.92,9002313.92,1.04,3)
Type a Number between 1 and 999999, 0 Decimal Digits
"^DD",9002313.92,9002313.92,1.04,21,0)
^^1^1^3000918^
"^DD",9002313.92,9002313.92,1.04,21,1,0)
Like a Bin number, but it's Envoy's version of it.
"^DD",9002313.92,9002313.92,1.04,"DT")
3010112
"^DD",9002313.92,9002313.92,1.05,0)
Help Telephone #^F^^1;5^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.92,9002313.92,1.05,3)
Answer must be 1-30 characters in length.
"^DD",9002313.92,9002313.92,1.05,21,0)
^^10^10^3001110^^
"^DD",9002313.92,9002313.92,1.05,21,1,0)
This is the telephone number to call for assistance in figuring out
"^DD",9002313.92,9002313.92,1.05,21,2,0)
rejected claims.  There is another place for such a phone number, in
"^DD",9002313.92,9002313.92,1.05,21,3,0)
the BPS INSURER file, file #9002313.4, field 100.05 - that insurer-
"^DD",9002313.92,9002313.92,1.05,21,4,0)
specific number takes precedence over this number when printing reports.
"^DD",9002313.92,9002313.92,1.05,21,5,0)
The reason for having this number is that we can ship it as part of
"^DD",9002313.92,9002313.92,1.05,21,6,0)
the formats (saving individual sites the trouble of finding it and
"^DD",9002313.92,9002313.92,1.05,21,7,0)
typing it in.)  And also, it saves the trouble of typing the same number
"^DD",9002313.92,9002313.92,1.05,21,8,0)
into multiple insurance companies' records, such as when you have a half
"^DD",9002313.92,9002313.92,1.05,21,9,0)
dozen flavors of PCS or if you have a monolith like Paid Prescriptions
"^DD",9002313.92,9002313.92,1.05,21,10,0)
acting as an umbrella for lots of insurances.
"^DD",9002313.92,9002313.92,1.05,"DT")
3001003
"^DD",9002313.92,9002313.92,1.06,0)
Production/Testing Status^*S^0:DISABLED;1:DEVELOPMENT;2:FIELD TESTING;3:PRODUCTION;^1;6^Q
"^DD",9002313.92,9002313.92,1.06,12)
Programmer may select any.  Others: may select only formats in FIELD TESTING or PRODUCTION.
"^DD",9002313.92,9002313.92,1.06,12.1)
S DIC("S")="I Y=2!(Y=3)!(DUZ(0)=""@"")"
"^DD",9002313.92,9002313.92,1.06,21,0)
^^3^3^3001115^
"^DD",9002313.92,9002313.92,1.06,21,1,0)
To be used as a screen when attaching a format to an insurer.
"^DD",9002313.92,9002313.92,1.06,21,2,0)
Don't allow non-production formats.  Those will have to be entered
"^DD",9002313.92,9002313.92,1.06,21,3,0)
directly with Fileman.
"^DD",9002313.92,9002313.92,1.06,"DT")
3010119
"^DD",9002313.92,9002313.92,1.07,0)
Is A Reversal Format^S^1:YES;0:NO;^1;7^Q
"^DD",9002313.92,9002313.92,1.07,21,0)
^^2^2^3001115^
"^DD",9002313.92,9002313.92,1.07,21,1,0)
To be used as a screen when selecting format to attach to an insurance.
"^DD",9002313.92,9002313.92,1.07,21,2,0)
Don't allow reversal format to be selected as the insurance's format!
"^DD",9002313.92,9002313.92,1.07,"DT")
3001115
"^DD",9002313.92,9002313.92,1.08,0)
Add Disp. Fee to Ingr. Cost^S^1:YES;0:NO;^1;8^Q
"^DD",9002313.92,9002313.92,1.08,21,0)
^^4^4^3010109^
"^DD",9002313.92,9002313.92,1.08,21,1,0)
Many formats expect the Ingredient Cost to include the Dispensing Fee, too.
"^DD",9002313.92,9002313.92,1.08,21,2,0)
The default for this is "YES".
"^DD",9002313.92,9002313.92,1.08,21,3,0)
Set this field to NO for any formats that should have only the
"^DD",9002313.92,9002313.92,1.08,21,4,0)
Ingredient Cost in the Ingredient Cost, exclusive of Dispensing Fee.
"^DD",9002313.92,9002313.92,1.08,"DT")
3010109
"^DD",9002313.92,9002313.92,1.09,0)
Contract Required^S^1:YES;0:NO;U:UNK;D:DONE;^1;9^Q
"^DD",9002313.92,9002313.92,1.09,21,0)
^^3^3^3010119^^^^
"^DD",9002313.92,9002313.92,1.09,21,1,0)
Does the pharmacy need a contract with the payor in order to submit claims?
"^DD",9002313.92,9002313.92,1.09,21,2,0)
Yes, No, Unknown, and Done
"^DD",9002313.92,9002313.92,1.09,21,3,0)
"Done" means done nationally, for all IHS sites.
"^DD",9002313.92,9002313.92,1.09,"DT")
3010119
"^DD",9002313.92,9002313.92,1.1,0)
Total exclusive of Patient Amt^S^1:Y;0:N;^1;10^Q
"^DD",9002313.92,9002313.92,1.1,21,0)
^^13^13^3010207^
"^DD",9002313.92,9002313.92,1.1,21,1,0)
This refers to the interpretation of the fields in the response packets,
"^DD",9002313.92,9002313.92,1.1,21,2,0)
as copied to 9002313.03, Response(s) multiple, 
"^DD",9002313.92,9002313.92,1.1,21,3,0)
fields 509 Total Amount Paid and 505 Patient Paid Amount.
"^DD",9002313.92,9002313.92,1.1,21,4,0)
For most formats and insurers, it seems, 509 Total Amount Paid
"^DD",9002313.92,9002313.92,1.1,21,5,0)
means Total, Patient plus Insurer..
"^DD",9002313.92,9002313.92,1.1,21,6,0)
But BC/BS ARIZONA doesn't do it that way - for them, 509 contains
"^DD",9002313.92,9002313.92,1.1,21,7,0)
only the amount paid by insurance.
"^DD",9002313.92,9002313.92,1.1,21,8,0)
$$NETPAID1 needs to know whether to do the subtraction.
"^DD",9002313.92,9002313.92,1.1,21,9,0)
If $$NETPAID1 encounters a case where (#509)<(#505), 
"^DD",9002313.92,9002313.92,1.1,21,10,0)
it will set the flag in the format, locally.
"^DD",9002313.92,9002313.92,1.1,21,11,0)
But we try to stay ahead of the curve and ship the flag where needed.
"^DD",9002313.92,9002313.92,1.1,21,12,0)
So as of today (Feb. 7, 2001) we ship this flag set for BC/BS ARIZONA 
"^DD",9002313.92,9002313.92,1.1,21,13,0)
format.
"^DD",9002313.92,9002313.92,1.1,"DT")
3010207
"^DD",9002313.92,9002313.92,1.11,0)
ASLEEP PROBER^P9002313.59'^BPST(^1;11^Q
"^DD",9002313.92,9002313.92,1.11,3)
Enter the claim to test whether the insurer is awake
"^DD",9002313.92,9002313.92,1.11,21,0)
^^2^2^3060105^
"^DD",9002313.92,9002313.92,1.11,21,1,0)
The BPS Transaction used as the test prober to test when the insurer is 
"^DD",9002313.92,9002313.92,1.11,21,2,0)
'awake'.
"^DD",9002313.92,9002313.92,1.11,"DT")
3060105
"^DD",9002313.92,9002313.92,1.12,0)
ASLEEP RETRY TIME^D^^1;12^S %DT="EST" D ^%DT S X=Y K:X<1 X
"^DD",9002313.92,9002313.92,1.12,3)
Enter date/time when to retry sending to payer
"^DD",9002313.92,9002313.92,1.12,21,0)
^^1^1^3060105^
"^DD",9002313.92,9002313.92,1.12,21,1,0)
The time to wait before re-trying to see if the insure is 'awake'.
"^DD",9002313.92,9002313.92,1.12,"DT")
3060105
"^DD",9002313.92,9002313.92,1.13,0)
SOFTWARE VENDOR/CERT ID^F^^1;13^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.92,9002313.92,1.13,3)
Answer must be 1-10 characters in length.
"^DD",9002313.92,9002313.92,1.13,21,0)
^^2^2^3040220^
"^DD",9002313.92,9002313.92,1.13,21,1,0)
Certification ID number assigned by the payer or processor to indicate 
"^DD",9002313.92,9002313.92,1.13,21,2,0)
that the entity particular payer or processor. 
"^DD",9002313.92,9002313.92,1.13,"DT")
3030707
"^DD",9002313.92,9002313.92,1.14,0)
PAYER SHEET VERSION^RNJ4,0^^1;14^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.92,1.14,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",9002313.92,9002313.92,1.14,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.92,1.14,21,1,0)
Which version of the NCPDP standard this payer sheet is for.
"^DD",9002313.92,9002313.92,1.14,"DT")
3031204
"^DD",9002313.92,9002313.92,10,0)
Claim Header (Required)^9002313.9201A^^10;0
"^DD",9002313.92,9002313.92,10,21,0)
^.001^2^2^3040220^^^
"^DD",9002313.92,9002313.92,10,21,1,0)
Information that is inserted into the header portion of the transmission 
"^DD",9002313.92,9002313.92,10,21,2,0)
which identifies the submitter to the payer.  
"^DD",9002313.92,9002313.92,20,0)
Claim Header (Optional)^9002313.9202A^^20;0
"^DD",9002313.92,9002313.92,20,21,0)
^.001^1^1^3040220^^
"^DD",9002313.92,9002313.92,20,21,1,0)
Additional special handling segments for the claim header. 
"^DD",9002313.92,9002313.92,30,0)
Claim Information (Required)^9002313.9203A^^30;0
"^DD",9002313.92,9002313.92,30,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.92,30,21,1,0)
Additional claim segment manipulations.  
"^DD",9002313.92,9002313.92,40,0)
Claim Information (Optional)^9002313.9204A^^40;0
"^DD",9002313.92,9002313.92,100,0)
5.1 Transaction Header Segment^9002313.9205A^^100;0
"^DD",9002313.92,9002313.92,100,"DT")
3020801
"^DD",9002313.92,9002313.92,110,0)
5.1 Patient Segment^9002313.9206A^^110;0
"^DD",9002313.92,9002313.92,120,0)
5.1 Insurance Segment^9002313.9207A^^120;0
"^DD",9002313.92,9002313.92,130,0)
5.1 Claim Segment^9002313.9208A^^130;0
"^DD",9002313.92,9002313.92,140,0)
5.1 Pharmacy Provider Segment^9002313.9209A^^140;0
"^DD",9002313.92,9002313.92,150,0)
5.1 Prescriber Segment^9002313.921A^^150;0
"^DD",9002313.92,9002313.92,160,0)
5.1 COB/Other Payments Segment^9002313.9213A^^160;0
"^DD",9002313.92,9002313.92,170,0)
5.1 Workers Comp Segment^9002313.9214A^^170;0
"^DD",9002313.92,9002313.92,180,0)
5.1 DUR/PPS Segment^9002313.9215A^^180;0
"^DD",9002313.92,9002313.92,190,0)
5.1 Pricing Segment^9002313.9216A^^190;0
"^DD",9002313.92,9002313.92,200,0)
5.1 Coupon Segment^9002313.9217A^^200;0
"^DD",9002313.92,9002313.92,210,0)
5.1 Compound Segment^9002313.9218A^^210;0
"^DD",9002313.92,9002313.92,220,0)
5.1 Prior Auth Segment^9002313.9219A^^220;0
"^DD",9002313.92,9002313.92,230,0)
5.1 Clinical Segment^9002313.922A^^230;0
"^DD",9002313.92,9002313.92,1001,0)
Reversal Format^P9002313.92'^BPSF(9002313.92,^REVERSAL;1^Q
"^DD",9002313.92,9002313.92,1001,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.92,1001,21,1,0)
The name of the payer sheet that is to be used for reversals.
"^DD",9002313.92,9002313.92,1001,"DT")
3040220
"^DD",9002313.92,9002313.92,1901,0)
Developer's Remarks^9002313.921901^^DEVELOPER'S REMARKS;0
"^DD",9002313.92,9002313.92,1901,21,0)
^^2^2^3040220^
"^DD",9002313.92,9002313.92,1901,21,1,0)
General remarks for the payer sheet, anything that will help describe the 
"^DD",9002313.92,9002313.92,1901,21,2,0)
function of the sheet, etc.  
"^DD",9002313.92,9002313.92,1901,"DT")
3010117
"^DD",9002313.92,9002313.9201,0)
Claim Header (Required) SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9201,0,"DT")
3031210
"^DD",9002313.92,9002313.9201,0,"IX","B",9002313.9201,.01)

"^DD",9002313.92,9002313.9201,0,"NM","Claim Header (Required)")

"^DD",9002313.92,9002313.9201,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9201,.01,0)
Claim Header (Required) Order^MNJ2,0^^0;1^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9201,.01,1,0)
^.1
"^DD",9002313.92,9002313.9201,.01,1,1,0)
9002313.9201^B
"^DD",9002313.92,9002313.9201,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9201,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),10,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9201,.01,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",9002313.92,9002313.9201,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9201,.01,21,1,0)
The indicator that determines the type of transmission being sent.
"^DD",9002313.92,9002313.9201,.01,"DT")
3040220
"^DD",9002313.92,9002313.9201,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9201,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9201,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9201,.02,"DT")
3040220
"^DD",9002313.92,9002313.9201,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;UNK:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9201,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9201,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9201,.03,"DT")
3040220
"^DD",9002313.92,9002313.9201,1,0)
Special Code^9002313.92011^^1;0
"^DD",9002313.92,9002313.9201,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9201,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9201,2,0)
Programming Notes^9002313.92012^^2;0
"^DD",9002313.92,9002313.9201,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9201,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92011,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92011,0,"DT")
2950420
"^DD",9002313.92,9002313.92011,0,"NM","Special Code")

"^DD",9002313.92,9002313.92011,0,"UP")
9002313.9201
"^DD",9002313.92,9002313.92011,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92011,.01,"DT")
2950420
"^DD",9002313.92,9002313.92012,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92012,0,"DT")
2950421
"^DD",9002313.92,9002313.92012,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92012,0,"UP")
9002313.9201
"^DD",9002313.92,9002313.92012,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92012,.01,"DT")
2950421
"^DD",9002313.92,9002313.9202,0)
Claim Header (Optional) SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9202,0,"DT")
2950520
"^DD",9002313.92,9002313.9202,0,"IX","B",9002313.9202,.01)

"^DD",9002313.92,9002313.9202,0,"NM","Claim Header (Optional)")

"^DD",9002313.92,9002313.9202,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9202,.01,0)
Claim Header (Optional) Order^MNJ2,0^^0;1^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9202,.01,1,0)
^.1
"^DD",9002313.92,9002313.9202,.01,1,1,0)
9002313.9202^B
"^DD",9002313.92,9002313.9202,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),20,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9202,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),20,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9202,.01,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",9002313.92,9002313.9202,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9202,.01,21,1,0)
Identification of the header segment.
"^DD",9002313.92,9002313.9202,.01,"DT")
3040220
"^DD",9002313.92,9002313.9202,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9202,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9202,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9202,.02,"DT")
3040220
"^DD",9002313.92,9002313.9202,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9202,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9202,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9202,.03,"DT")
3040220
"^DD",9002313.92,9002313.9202,1,0)
Special Code^9002313.92021^^1;0
"^DD",9002313.92,9002313.9202,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9202,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be excuted.
"^DD",9002313.92,9002313.9202,2,0)
Programming Notes^9002313.92022^^2;0
"^DD",9002313.92,9002313.9202,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9202,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92021,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92021,0,"DT")
2950420
"^DD",9002313.92,9002313.92021,0,"NM","Special Code")

"^DD",9002313.92,9002313.92021,0,"UP")
9002313.9202
"^DD",9002313.92,9002313.92021,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92021,.01,"DT")
2950420
"^DD",9002313.92,9002313.92022,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92022,0,"DT")
2950421
"^DD",9002313.92,9002313.92022,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92022,0,"UP")
9002313.9202
"^DD",9002313.92,9002313.92022,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92022,.01,"DT")
2950421
"^DD",9002313.92,9002313.9203,0)
Claim Information (Required) SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9203,0,"DT")
2950520
"^DD",9002313.92,9002313.9203,0,"IX","B",9002313.9203,.01)

"^DD",9002313.92,9002313.9203,0,"NM","Claim Information (Required)")

"^DD",9002313.92,9002313.9203,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9203,.01,0)
Claim Info (Required) Order^MNJ2,0^^0;1^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9203,.01,1,0)
^.1
"^DD",9002313.92,9002313.9203,.01,1,1,0)
9002313.9203^B
"^DD",9002313.92,9002313.9203,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),30,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9203,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),30,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9203,.01,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",9002313.92,9002313.9203,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9203,.01,21,1,0)
Header segment ID.
"^DD",9002313.92,9002313.9203,.01,"DT")
3040220
"^DD",9002313.92,9002313.9203,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9203,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9203,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9203,.02,"DT")
3040220
"^DD",9002313.92,9002313.9203,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9203,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9203,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9203,.03,"DT")
3040220
"^DD",9002313.92,9002313.9203,1,0)
Special Code^9002313.92031^^1;0
"^DD",9002313.92,9002313.9203,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9203,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9203,2,0)
Programming Notes^9002313.92032^^2;0
"^DD",9002313.92,9002313.9203,2,21,0)
^^1^1^3040220^^^
"^DD",9002313.92,9002313.9203,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92031,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92031,0,"DT")
2950420
"^DD",9002313.92,9002313.92031,0,"NM","Special Code")

"^DD",9002313.92,9002313.92031,0,"UP")
9002313.9203
"^DD",9002313.92,9002313.92031,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92031,.01,"DT")
2950420
"^DD",9002313.92,9002313.92032,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92032,0,"DT")
2950421
"^DD",9002313.92,9002313.92032,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92032,0,"UP")
9002313.9203
"^DD",9002313.92,9002313.92032,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92032,.01,"DT")
2950421
"^DD",9002313.92,9002313.9204,0)
Claim Information (Optional) SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9204,0,"DT")
2950520
"^DD",9002313.92,9002313.9204,0,"IX","B",9002313.9204,.01)

"^DD",9002313.92,9002313.9204,0,"NM","Claim Information (Optional)")

"^DD",9002313.92,9002313.9204,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9204,.01,0)
Claim Info (Optional) Order^MNJ2,0^^0;1^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9204,.01,1,0)
^.1
"^DD",9002313.92,9002313.9204,.01,1,1,0)
9002313.9204^B
"^DD",9002313.92,9002313.9204,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),40,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9204,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),40,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9204,.01,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",9002313.92,9002313.9204,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9204,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9204,.01,"DT")
3040220
"^DD",9002313.92,9002313.9204,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9204,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9204,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9204,.02,"DT")
3040220
"^DD",9002313.92,9002313.9204,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9204,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9204,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9204,.03,"DT")
3040220
"^DD",9002313.92,9002313.9204,1,0)
Special Code^9002313.92041^^1;0
"^DD",9002313.92,9002313.9204,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9204,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9204,2,0)
Programming Notes^9002313.92042^^2;0
"^DD",9002313.92,9002313.92041,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92041,0,"DT")
2950420
"^DD",9002313.92,9002313.92041,0,"NM","Special Code")

"^DD",9002313.92,9002313.92041,0,"UP")
9002313.9204
"^DD",9002313.92,9002313.92041,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92041,.01,"DT")
2950420
"^DD",9002313.92,9002313.92042,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92042,0,"DT")
2950421
"^DD",9002313.92,9002313.92042,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92042,0,"UP")
9002313.9204
"^DD",9002313.92,9002313.92042,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92042,.01,"DT")
2950421
"^DD",9002313.92,9002313.9205,0)
5.1 Transaction Header Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9205,0,"DT")
3031223
"^DD",9002313.92,9002313.9205,0,"IX","B",9002313.9205,.01)

"^DD",9002313.92,9002313.9205,0,"NM","5.1 Transaction Header Segment")

"^DD",9002313.92,9002313.9205,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9205,.01,0)
5.1 Transaction Header Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9205,.01,1,0)
^.1
"^DD",9002313.92,9002313.9205,.01,1,1,0)
9002313.9205^B
"^DD",9002313.92,9002313.9205,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),100,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9205,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),100,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9205,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9205,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9205,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9205,.01,"DT")
3040220
"^DD",9002313.92,9002313.9205,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9205,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9205,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9205,.02,"DT")
3040220
"^DD",9002313.92,9002313.9205,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;U:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9205,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9205,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9205,.03,"DT")
3040220
"^DD",9002313.92,9002313.9205,1,0)
Special Code^9002313.92051^^1;0
"^DD",9002313.92,9002313.9205,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9205,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9205,2,0)
Programming Notes^9002313.92052^^2;0
"^DD",9002313.92,9002313.9205,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9205,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92051,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92051,0,"DT")
3020801
"^DD",9002313.92,9002313.92051,0,"NM","Special Code")

"^DD",9002313.92,9002313.92051,0,"UP")
9002313.9205
"^DD",9002313.92,9002313.92051,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92051,.01,"DT")
3020801
"^DD",9002313.92,9002313.92052,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92052,0,"DT")
3020801
"^DD",9002313.92,9002313.92052,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92052,0,"UP")
9002313.9205
"^DD",9002313.92,9002313.92052,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92052,.01,"DT")
3020801
"^DD",9002313.92,9002313.9206,0)
5.1 Patient Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9206,0,"DT")
3031223
"^DD",9002313.92,9002313.9206,0,"IX","B",9002313.9206,.01)

"^DD",9002313.92,9002313.9206,0,"NM","5.1 Patient Segment")

"^DD",9002313.92,9002313.9206,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9206,.01,0)
5.1 Patient Segment Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9206,.01,1,0)
^.1
"^DD",9002313.92,9002313.9206,.01,1,1,0)
9002313.9206^B
"^DD",9002313.92,9002313.9206,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),110,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9206,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),110,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9206,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9206,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9206,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9206,.01,"DT")
3040220
"^DD",9002313.92,9002313.9206,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9206,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9206,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9206,.02,"DT")
3040220
"^DD",9002313.92,9002313.9206,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9206,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9206,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9206,.03,"DT")
3040220
"^DD",9002313.92,9002313.9206,1,0)
Special Code^9002313.92061^^1;0
"^DD",9002313.92,9002313.9206,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9206,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9206,2,0)
Programming Notes^9002313.92062^^2;0
"^DD",9002313.92,9002313.9206,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9206,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92061,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92061,0,"DT")
3020801
"^DD",9002313.92,9002313.92061,0,"NM","Special Code")

"^DD",9002313.92,9002313.92061,0,"UP")
9002313.9206
"^DD",9002313.92,9002313.92061,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92061,.01,"DT")
3020801
"^DD",9002313.92,9002313.92062,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92062,0,"DT")
3020801
"^DD",9002313.92,9002313.92062,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92062,0,"UP")
9002313.9206
"^DD",9002313.92,9002313.92062,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92062,.01,"DT")
3020801
"^DD",9002313.92,9002313.9207,0)
5.1 Insurance Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9207,0,"DT")
3031223
"^DD",9002313.92,9002313.9207,0,"IX","B",9002313.9207,.01)

"^DD",9002313.92,9002313.9207,0,"NM","5.1 Insurance Segment")

"^DD",9002313.92,9002313.9207,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9207,.01,0)
5.1 Insurance Segment Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9207,.01,1,0)
^.1
"^DD",9002313.92,9002313.9207,.01,1,1,0)
9002313.9207^B
"^DD",9002313.92,9002313.9207,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),120,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9207,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),120,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9207,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9207,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9207,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9207,.01,"DT")
3040220
"^DD",9002313.92,9002313.9207,.02,0)
NCPDP Field Defs^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9207,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9207,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9207,.02,"DT")
3040220
"^DD",9002313.92,9002313.9207,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9207,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9207,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9207,.03,"DT")
3040220
"^DD",9002313.92,9002313.9207,1,0)
Special Code^9002313.92071^^1;0
"^DD",9002313.92,9002313.9207,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9207,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9207,2,0)
Programming Notes^9002313.92072^^2;0
"^DD",9002313.92,9002313.9207,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9207,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92071,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92071,0,"DT")
3020801
"^DD",9002313.92,9002313.92071,0,"NM","Special Code")

"^DD",9002313.92,9002313.92071,0,"UP")
9002313.9207
"^DD",9002313.92,9002313.92071,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92071,.01,"DT")
3020801
"^DD",9002313.92,9002313.92072,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92072,0,"DT")
3020801
"^DD",9002313.92,9002313.92072,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92072,0,"UP")
9002313.9207
"^DD",9002313.92,9002313.92072,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92072,.01,"DT")
3020801
"^DD",9002313.92,9002313.9208,0)
5.1 Claim Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9208,0,"DT")
3031223
"^DD",9002313.92,9002313.9208,0,"IX","B",9002313.9208,.01)

"^DD",9002313.92,9002313.9208,0,"NM","5.1 Claim Segment")

"^DD",9002313.92,9002313.9208,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9208,.01,0)
5.1 Claim Segment Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9208,.01,1,0)
^.1
"^DD",9002313.92,9002313.9208,.01,1,1,0)
9002313.9208^B
"^DD",9002313.92,9002313.9208,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),130,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9208,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),130,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9208,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9208,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9208,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9208,.01,"DT")
3040220
"^DD",9002313.92,9002313.9208,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9208,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9208,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9208,.02,"DT")
3040220
"^DD",9002313.92,9002313.9208,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9208,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9208,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9208,.03,"DT")
3040220
"^DD",9002313.92,9002313.9208,1,0)
Special Code^9002313.92081^^1;0
"^DD",9002313.92,9002313.9208,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9208,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9208,2,0)
Programming Notes^9002313.92082^^2;0
"^DD",9002313.92,9002313.9208,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9208,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92081,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92081,0,"DT")
3020801
"^DD",9002313.92,9002313.92081,0,"NM","Special Code")

"^DD",9002313.92,9002313.92081,0,"UP")
9002313.9208
"^DD",9002313.92,9002313.92081,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92081,.01,"DT")
3020801
"^DD",9002313.92,9002313.92082,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92082,0,"DT")
3020801
"^DD",9002313.92,9002313.92082,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92082,0,"UP")
9002313.9208
"^DD",9002313.92,9002313.92082,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92082,.01,"DT")
3020801
"^DD",9002313.92,9002313.9209,0)
5.1 Pharmacy Provider Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9209,0,"DT")
3031223
"^DD",9002313.92,9002313.9209,0,"IX","B",9002313.9209,.01)

"^DD",9002313.92,9002313.9209,0,"NM","5.1 Pharmacy Provider Segment")

"^DD",9002313.92,9002313.9209,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9209,.01,0)
5.1 Pharmacy Provider Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9209,.01,1,0)
^.1
"^DD",9002313.92,9002313.9209,.01,1,1,0)
9002313.9209^B
"^DD",9002313.92,9002313.9209,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),140,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9209,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),140,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9209,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9209,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9209,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9209,.01,"DT")
3040220
"^DD",9002313.92,9002313.9209,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9209,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9209,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9209,.02,"DT")
3040220
"^DD",9002313.92,9002313.9209,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9209,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9209,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9209,.03,"DT")
3040220
"^DD",9002313.92,9002313.9209,1,0)
Special Code^9002313.92091^^1;0
"^DD",9002313.92,9002313.9209,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9209,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9209,2,0)
Programming Notes^9002313.92092^^2;0
"^DD",9002313.92,9002313.9209,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9209,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92091,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92091,0,"DT")
3020801
"^DD",9002313.92,9002313.92091,0,"NM","Special Code")

"^DD",9002313.92,9002313.92091,0,"UP")
9002313.9209
"^DD",9002313.92,9002313.92091,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92091,.01,"DT")
3020801
"^DD",9002313.92,9002313.92092,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92092,0,"DT")
3020801
"^DD",9002313.92,9002313.92092,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92092,0,"UP")
9002313.9209
"^DD",9002313.92,9002313.92092,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92092,.01,"DT")
3020801
"^DD",9002313.92,9002313.921,0)
5.1 Prescriber Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.921,0,"DT")
3031223
"^DD",9002313.92,9002313.921,0,"IX","B",9002313.921,.01)

"^DD",9002313.92,9002313.921,0,"NM","5.1 Prescriber Segment")

"^DD",9002313.92,9002313.921,0,"UP")
9002313.92
"^DD",9002313.92,9002313.921,.01,0)
5.1 Prescriber Segment Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.921,.01,1,0)
^.1
"^DD",9002313.92,9002313.921,.01,1,1,0)
9002313.921^B
"^DD",9002313.92,9002313.921,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),150,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.921,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),150,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.921,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.921,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.921,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.921,.01,"DT")
3040220
"^DD",9002313.92,9002313.921,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.921,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.921,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.921,.02,"DT")
3040220
"^DD",9002313.92,9002313.921,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.921,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.921,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.921,.03,"DT")
3040220
"^DD",9002313.92,9002313.921,1,0)
Special Code^9002313.9211^^1;0
"^DD",9002313.92,9002313.921,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.921,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.921,2,0)
Programming Notes^9002313.9212^^2;0
"^DD",9002313.92,9002313.921,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.921,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9211,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.9211,0,"DT")
3020801
"^DD",9002313.92,9002313.9211,0,"NM","Special Code")

"^DD",9002313.92,9002313.9211,0,"UP")
9002313.921
"^DD",9002313.92,9002313.9211,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.9211,.01,"DT")
3020801
"^DD",9002313.92,9002313.9212,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.9212,0,"DT")
3020801
"^DD",9002313.92,9002313.9212,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.9212,0,"UP")
9002313.921
"^DD",9002313.92,9002313.9212,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.9212,.01,"DT")
3020801
"^DD",9002313.92,9002313.9213,0)
5.1 COB/Other Payments Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9213,0,"DT")
3031223
"^DD",9002313.92,9002313.9213,0,"IX","B",9002313.9213,.01)

"^DD",9002313.92,9002313.9213,0,"NM","5.1 COB/Other Payments Segment")

"^DD",9002313.92,9002313.9213,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9213,.01,0)
5.1 COB/Other Payments Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9213,.01,1,0)
^.1
"^DD",9002313.92,9002313.9213,.01,1,1,0)
9002313.9213^B
"^DD",9002313.92,9002313.9213,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),160,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9213,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),160,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9213,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9213,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9213,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9213,.01,"DT")
3040220
"^DD",9002313.92,9002313.9213,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9213,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9213,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9213,.02,"DT")
3040220
"^DD",9002313.92,9002313.9213,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9213,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9213,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9213,.03,"DT")
3040220
"^DD",9002313.92,9002313.9213,1,0)
Special Code^9002313.92131^^1;0
"^DD",9002313.92,9002313.9213,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9213,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9213,2,0)
Programming Notes^9002313.92132^^2;0
"^DD",9002313.92,9002313.9213,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9213,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92131,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92131,0,"DT")
3020801
"^DD",9002313.92,9002313.92131,0,"NM","Special Code")

"^DD",9002313.92,9002313.92131,0,"UP")
9002313.9213
"^DD",9002313.92,9002313.92131,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92131,.01,"DT")
3020801
"^DD",9002313.92,9002313.92132,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92132,0,"DT")
3020801
"^DD",9002313.92,9002313.92132,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92132,0,"UP")
9002313.9213
"^DD",9002313.92,9002313.92132,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92132,.01,"DT")
3020801
"^DD",9002313.92,9002313.9214,0)
5.1 Workers Comp Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9214,0,"DT")
3031223
"^DD",9002313.92,9002313.9214,0,"IX","B",9002313.9214,.01)

"^DD",9002313.92,9002313.9214,0,"NM","5.1 Workers Comp Segment")

"^DD",9002313.92,9002313.9214,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9214,.01,0)
5.1 Workers Comp Segment Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9214,.01,1,0)
^.1
"^DD",9002313.92,9002313.9214,.01,1,1,0)
9002313.9214^B
"^DD",9002313.92,9002313.9214,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),170,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9214,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),170,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9214,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9214,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9214,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9214,.01,"DT")
3040220
"^DD",9002313.92,9002313.9214,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9214,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9214,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9214,.02,"DT")
3040220
"^DD",9002313.92,9002313.9214,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9214,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9214,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9214,.03,"DT")
3040220
"^DD",9002313.92,9002313.9214,1,0)
Special Code^9002313.92141^^1;0
"^DD",9002313.92,9002313.9214,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9214,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9214,2,0)
Programming Notes^9002313.92142^^2;0
"^DD",9002313.92,9002313.9214,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9214,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92141,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92141,0,"DT")
3020801
"^DD",9002313.92,9002313.92141,0,"NM","Special Code")

"^DD",9002313.92,9002313.92141,0,"UP")
9002313.9214
"^DD",9002313.92,9002313.92141,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92141,.01,"DT")
3020801
"^DD",9002313.92,9002313.92142,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92142,0,"DT")
3020801
"^DD",9002313.92,9002313.92142,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92142,0,"UP")
9002313.9214
"^DD",9002313.92,9002313.92142,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92142,.01,"DT")
3020801
"^DD",9002313.92,9002313.9215,0)
5.1 DUR/PPS Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9215,0,"DT")
3031223
"^DD",9002313.92,9002313.9215,0,"IX","B",9002313.9215,.01)

"^DD",9002313.92,9002313.9215,0,"NM","5.1 DUR/PPS Segment")

"^DD",9002313.92,9002313.9215,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9215,.01,0)
5.1 DUR/PPS Segment Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9215,.01,1,0)
^.1
"^DD",9002313.92,9002313.9215,.01,1,1,0)
9002313.9215^B
"^DD",9002313.92,9002313.9215,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),180,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9215,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),180,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9215,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9215,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9215,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9215,.01,"DT")
3040220
"^DD",9002313.92,9002313.9215,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9215,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9215,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9215,.02,"DT")
3040220
"^DD",9002313.92,9002313.9215,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9215,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9215,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9215,.03,"DT")
3040220
"^DD",9002313.92,9002313.9215,1,0)
Special Code^9002313.92151^^1;0
"^DD",9002313.92,9002313.9215,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9215,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9215,2,0)
Programming Notes^9002313.92152^^2;0
"^DD",9002313.92,9002313.9215,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9215,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92151,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92151,0,"DT")
3020801
"^DD",9002313.92,9002313.92151,0,"NM","Special Code")

"^DD",9002313.92,9002313.92151,0,"UP")
9002313.9215
"^DD",9002313.92,9002313.92151,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92151,.01,"DT")
3020801
"^DD",9002313.92,9002313.92152,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92152,0,"DT")
3020801
"^DD",9002313.92,9002313.92152,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92152,0,"UP")
9002313.9215
"^DD",9002313.92,9002313.92152,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92152,.01,"DT")
3020801
"^DD",9002313.92,9002313.9216,0)
5.1 Pricing Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9216,0,"DT")
3031223
"^DD",9002313.92,9002313.9216,0,"IX","B",9002313.9216,.01)

"^DD",9002313.92,9002313.9216,0,"NM","5.1 Pricing Segment")

"^DD",9002313.92,9002313.9216,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9216,.01,0)
5.1 Pricing Segment Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9216,.01,1,0)
^.1
"^DD",9002313.92,9002313.9216,.01,1,1,0)
9002313.9216^B
"^DD",9002313.92,9002313.9216,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),190,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9216,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),190,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9216,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9216,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9216,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9216,.01,"DT")
3040220
"^DD",9002313.92,9002313.9216,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9216,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9216,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9216,.02,"DT")
3040220
"^DD",9002313.92,9002313.9216,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9216,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9216,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9216,.03,"DT")
3040220
"^DD",9002313.92,9002313.9216,1,0)
Special Code^9002313.92161^^1;0
"^DD",9002313.92,9002313.9216,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9216,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9216,2,0)
Programming Notes^9002313.92162^^2;0
"^DD",9002313.92,9002313.9216,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9216,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92161,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92161,0,"DT")
3020801
"^DD",9002313.92,9002313.92161,0,"NM","Special Code")

"^DD",9002313.92,9002313.92161,0,"UP")
9002313.9216
"^DD",9002313.92,9002313.92161,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92161,.01,"DT")
3020801
"^DD",9002313.92,9002313.92162,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92162,0,"DT")
3020801
"^DD",9002313.92,9002313.92162,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92162,0,"UP")
9002313.9216
"^DD",9002313.92,9002313.92162,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92162,.01,"DT")
3020801
"^DD",9002313.92,9002313.9217,0)
5.1 Coupon Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9217,0,"DT")
3031223
"^DD",9002313.92,9002313.9217,0,"IX","B",9002313.9217,.01)

"^DD",9002313.92,9002313.9217,0,"NM","5.1 Coupon Segment")

"^DD",9002313.92,9002313.9217,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9217,.01,0)
5.1 Coupon Segment Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9217,.01,1,0)
^.1
"^DD",9002313.92,9002313.9217,.01,1,1,0)
9002313.9217^B
"^DD",9002313.92,9002313.9217,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),200,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9217,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),200,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9217,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9217,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9217,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9217,.01,"DT")
3040220
"^DD",9002313.92,9002313.9217,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9217,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9217,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9217,.02,"DT")
3040220
"^DD",9002313.92,9002313.9217,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9217,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9217,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9217,.03,"DT")
3040220
"^DD",9002313.92,9002313.9217,1,0)
Special Code^9002313.92171^^1;0
"^DD",9002313.92,9002313.9217,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9217,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9217,2,0)
Programming Notes^9002313.92172^^2;0
"^DD",9002313.92,9002313.9217,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9217,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92171,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92171,0,"DT")
3020801
"^DD",9002313.92,9002313.92171,0,"NM","Special Code")

"^DD",9002313.92,9002313.92171,0,"UP")
9002313.9217
"^DD",9002313.92,9002313.92171,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92171,.01,"DT")
3020801
"^DD",9002313.92,9002313.92172,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92172,0,"DT")
3020801
"^DD",9002313.92,9002313.92172,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92172,0,"UP")
9002313.9217
"^DD",9002313.92,9002313.92172,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92172,.01,"DT")
3020801
"^DD",9002313.92,9002313.9218,0)
5.1 Compound Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9218,0,"DT")
3031223
"^DD",9002313.92,9002313.9218,0,"IX","B",9002313.9218,.01)

"^DD",9002313.92,9002313.9218,0,"NM","5.1 Compound Segment")

"^DD",9002313.92,9002313.9218,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9218,.01,0)
5.1 Compound Segment Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9218,.01,1,0)
^.1
"^DD",9002313.92,9002313.9218,.01,1,1,0)
9002313.9218^B
"^DD",9002313.92,9002313.9218,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),210,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9218,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),210,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9218,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9218,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9218,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9218,.01,"DT")
3040220
"^DD",9002313.92,9002313.9218,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9218,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9218,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9218,.02,"DT")
3040220
"^DD",9002313.92,9002313.9218,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9218,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9218,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9218,.03,"DT")
3040220
"^DD",9002313.92,9002313.9218,1,0)
Special Code^9002313.92181^^1;0
"^DD",9002313.92,9002313.9218,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9218,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9218,2,0)
Programming Notes^9002313.92182^^2;0
"^DD",9002313.92,9002313.9218,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9218,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.92181,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92181,0,"DT")
3020801
"^DD",9002313.92,9002313.92181,0,"NM","Special Code")

"^DD",9002313.92,9002313.92181,0,"UP")
9002313.9218
"^DD",9002313.92,9002313.92181,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92181,.01,"DT")
3020801
"^DD",9002313.92,9002313.92182,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92182,0,"DT")
3020801
"^DD",9002313.92,9002313.92182,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92182,0,"UP")
9002313.9218
"^DD",9002313.92,9002313.92182,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92182,.01,"DT")
3020801
"^DD",9002313.92,9002313.9219,0)
5.1 Prior Auth Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9219,0,"DT")
3031223
"^DD",9002313.92,9002313.9219,0,"IX","B",9002313.9219,.01)

"^DD",9002313.92,9002313.9219,0,"NM","5.1 Prior Auth Segment")

"^DD",9002313.92,9002313.9219,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9219,.01,0)
5.1 Prior Auth Segment Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9219,.01,1,0)
^.1
"^DD",9002313.92,9002313.9219,.01,1,1,0)
9002313.9219^B
"^DD",9002313.92,9002313.9219,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),220,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9219,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),220,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9219,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9219,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9219,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9219,.01,"DT")
3040220
"^DD",9002313.92,9002313.9219,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9219,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9219,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9219,.02,"DT")
3040220
"^DD",9002313.92,9002313.9219,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9219,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9219,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.9219,.03,"DT")
3040220
"^DD",9002313.92,9002313.9219,1,0)
Special Code^9002313.92191^^1;0
"^DD",9002313.92,9002313.9219,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9219,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9219,2,0)
Programming Notes^9002313.92192^^2;0
"^DD",9002313.92,9002313.9219,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9219,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.921901,0)
Developer's Remarks SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.921901,0,"DT")
3010112
"^DD",9002313.92,9002313.921901,0,"NM","Developer's Remarks")

"^DD",9002313.92,9002313.921901,0,"UP")
9002313.92
"^DD",9002313.92,9002313.921901,.01,0)
Developer's Remarks^WL^^0;1^Q
"^DD",9002313.92,9002313.921901,.01,"DT")
3010117
"^DD",9002313.92,9002313.92191,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92191,0,"DT")
3020801
"^DD",9002313.92,9002313.92191,0,"NM","Special Code")

"^DD",9002313.92,9002313.92191,0,"UP")
9002313.9219
"^DD",9002313.92,9002313.92191,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.92191,.01,"DT")
3020801
"^DD",9002313.92,9002313.92192,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92192,0,"DT")
3020801
"^DD",9002313.92,9002313.92192,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.92192,0,"UP")
9002313.9219
"^DD",9002313.92,9002313.92192,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.92192,.01,"DT")
3020801
"^DD",9002313.92,9002313.922,0)
5.1 Clinical Segment SUB-FIELD^^2^5
"^DD",9002313.92,9002313.922,0,"DT")
3031223
"^DD",9002313.92,9002313.922,0,"IX","B",9002313.922,.01)

"^DD",9002313.92,9002313.922,0,"NM","5.1 Clinical Segment")

"^DD",9002313.92,9002313.922,0,"UP")
9002313.92
"^DD",9002313.92,9002313.922,.01,0)
5.1 Clinical Segment Order^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.922,.01,1,0)
^.1
"^DD",9002313.92,9002313.922,.01,1,1,0)
9002313.922^B
"^DD",9002313.92,9002313.922,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),230,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.922,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),230,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.922,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.922,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.922,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.922,.01,"DT")
3040220
"^DD",9002313.92,9002313.922,.02,0)
NCPDP Field Number^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.922,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.922,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.922,.02,"DT")
3040220
"^DD",9002313.92,9002313.922,.03,0)
Processing Mode^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.922,.03,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.922,.03,21,1,0)
Which processing mode in effect for this segment.
"^DD",9002313.92,9002313.922,.03,"DT")
3040220
"^DD",9002313.92,9002313.922,1,0)
Special Code^9002313.9221^^1;0
"^DD",9002313.92,9002313.922,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.922,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.922,2,0)
Programming Notes^9002313.9222^^2;0
"^DD",9002313.92,9002313.922,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.922,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9221,0)
Special Code SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.9221,0,"DT")
3020801
"^DD",9002313.92,9002313.9221,0,"NM","Special Code")

"^DD",9002313.92,9002313.9221,0,"UP")
9002313.922
"^DD",9002313.92,9002313.9221,.01,0)
Special Code^WL^^0;1^Q
"^DD",9002313.92,9002313.9221,.01,"DT")
3020801
"^DD",9002313.92,9002313.9222,0)
Programming Notes SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.9222,0,"DT")
3020801
"^DD",9002313.92,9002313.9222,0,"NM","Programming Notes")

"^DD",9002313.92,9002313.9222,0,"UP")
9002313.922
"^DD",9002313.92,9002313.9222,.01,0)
Programming Notes^WL^^0;1^Q
"^DD",9002313.92,9002313.9222,.01,"DT")
3020801
"^DD",9002313.93,9002313.93,0)
FIELD^^.02^2
"^DD",9002313.93,9002313.93,0,"DDA")
N
"^DD",9002313.93,9002313.93,0,"DT")
3030820
"^DD",9002313.93,9002313.93,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",9002313.93,9002313.93,0,"IX","B",9002313.93,.01)

"^DD",9002313.93,9002313.93,0,"NM","BPS NCPDP REJECT CODES")

"^DD",9002313.93,9002313.93,0,"PT",9002313.323,.01)

"^DD",9002313.93,9002313.93,0,"PT",9002313.7,1.15)

"^DD",9002313.93,9002313.93,0,"VRPK")
BPS
"^DD",9002313.93,9002313.93,.01,0)
Code^RF^^0;1^K:$L(X)>3!($L(X)<2) X
"^DD",9002313.93,9002313.93,.01,1,0)
^.1
"^DD",9002313.93,9002313.93,.01,1,1,0)
9002313.93^B
"^DD",9002313.93,9002313.93,.01,1,1,1)
S ^BPSF(9002313.93,"B",$E(X,1,30),DA)=""
"^DD",9002313.93,9002313.93,.01,1,1,2)
K ^BPSF(9002313.93,"B",$E(X,1,30),DA)
"^DD",9002313.93,9002313.93,.01,3)
Answer must be 2-3 characters in length.
"^DD",9002313.93,9002313.93,.01,21,0)
^.001^1^1^3040326^^
"^DD",9002313.93,9002313.93,.01,21,1,0)
Numerical entry for the reason for the claim rejection.
"^DD",9002313.93,9002313.93,.01,"DT")
3031125
"^DD",9002313.93,9002313.93,.02,0)
Explanation^F^^0;2^K:$L(X)>70!($L(X)<1) X
"^DD",9002313.93,9002313.93,.02,3)
Answer must be 1-70 characters in length.
"^DD",9002313.93,9002313.93,.02,21,0)
^^1^1^3031125^
"^DD",9002313.93,9002313.93,.02,21,1,0)
Textual explanation of the claim rejection.
"^DD",9002313.93,9002313.93,.02,"DT")
3031125
"^DD",9002313.94,9002313.94,0)
FIELD^^1^3
"^DD",9002313.94,9002313.94,0,"DDA")
N
"^DD",9002313.94,9002313.94,0,"DT")
3000818
"^DD",9002313.94,9002313.94,0,"IX","B",9002313.94,.01)

"^DD",9002313.94,9002313.94,0,"NM","BPS INSURANCE RULES")

"^DD",9002313.94,9002313.94,0,"PT",9002313.9903,.02)

"^DD",9002313.94,9002313.94,0,"VRPK")
BPS
"^DD",9002313.94,9002313.94,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.94,9002313.94,.01,1,0)
^.1
"^DD",9002313.94,9002313.94,.01,1,1,0)
9002313.94^B
"^DD",9002313.94,9002313.94,.01,1,1,1)
S ^BPSF(9002313.94,"B",$E(X,1,30),DA)=""
"^DD",9002313.94,9002313.94,.01,1,1,2)
K ^BPSF(9002313.94,"B",$E(X,1,30),DA)
"^DD",9002313.94,9002313.94,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",9002313.94,9002313.94,.01,21,0)
^^1^1^3040123^
"^DD",9002313.94,9002313.94,.01,21,1,0)
Name of the Insurance rule to be defined.
"^DD",9002313.94,9002313.94,.02,0)
ROUTINE^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.94,9002313.94,.02,3)
Answer must be 1-30 characters in length.
"^DD",9002313.94,9002313.94,.02,21,0)
^^3^3^3040331^^
"^DD",9002313.94,9002313.94,.02,21,1,0)
label~routine for this rule's logic.
"^DD",9002313.94,9002313.94,.02,21,2,0)
The routine's parameters must be as follows:
"^DD",9002313.94,9002313.94,.02,21,3,0)
  (.ARRAY,ABSBPATI,PTSPLUS,PTSMINUS)
"^DD",9002313.94,9002313.94,.02,"DT")
3040331
"^DD",9002313.94,9002313.94,1,0)
DESCRIPTION^9002313.941^^1;0
"^DD",9002313.94,9002313.94,1,21,0)
^^1^1^3040123^
"^DD",9002313.94,9002313.94,1,21,1,0)
Free text description of what this insurance rule is used for.
"^DD",9002313.94,9002313.941,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",9002313.94,9002313.941,0,"DT")
3000818
"^DD",9002313.94,9002313.941,0,"NM","DESCRIPTION")

"^DD",9002313.94,9002313.941,0,"UP")
9002313.94
"^DD",9002313.94,9002313.941,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",9002313.94,9002313.941,.01,"DT")
3000818
"^DD",9002313.99,9002313.99,0)
FIELD^^10000^112
"^DD",9002313.99,9002313.99,0,"DDA")
N
"^DD",9002313.99,9002313.99,0,"DT")
3050719
"^DD",9002313.99,9002313.99,0,"IX","B",9002313.99,.01)

"^DD",9002313.99,9002313.99,0,"NM","BPS SETUP")

"^DD",9002313.99,9002313.99,0,"VRPK")
BPS
"^DD",9002313.99,9002313.99,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.99,9002313.99,.01,1,0)
^.1
"^DD",9002313.99,9002313.99,.01,1,1,0)
9002313.99^B
"^DD",9002313.99,9002313.99,.01,1,1,1)
S ^BPS(9002313.99,"B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.99,.01,1,1,2)
K ^BPS(9002313.99,"B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.99,.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.99,9002313.99,.01,"DT")
3050729
"^DD",9002313.99,9002313.99,.04,0)
*M Vendor^S^DTM:DTM;MSM:MSM;CACHE:CACHE;^0;4^Q
"^DD",9002313.99,9002313.99,.04,"DT")
3001016
"^DD",9002313.99,9002313.99,2.01,0)
PCN or VCN on reports?^RS^PCN:PCN;VCN:VCN;^2;1^Q
"^DD",9002313.99,9002313.99,2.01,21,0)
^^2^2^2960717^^
"^DD",9002313.99,9002313.99,2.01,21,1,0)
Enter VCN if you want most reports to show VCN.
"^DD",9002313.99,9002313.99,2.01,21,2,0)
Default is PCN.
"^DD",9002313.99,9002313.99,2.01,23,0)
^^1^1^2960717^^
"^DD",9002313.99,9002313.99,2.01,23,1,0)
Rou. BPSER10, BPSER20, BPSER40.
"^DD",9002313.99,9002313.99,2.01,"DT")
2960717
"^DD",9002313.99,9002313.99,3.01,0)
ECME TIMEOUT^RNJ2,0^^0;2^K:+X'=X!(X>30)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,3.01,3)
Type a Number between 0 and 30, 0 Decimal Digits. This is the maximum number of seconds the display will wait for a claims processing status.
"^DD",9002313.99,9002313.99,3.01,21,0)
^.001^4^4^3050929^^^
"^DD",9002313.99,9002313.99,3.01,21,1,0)
This is the maximum number of seconds used for the display of the 
"^DD",9002313.99,9002313.99,3.01,21,2,0)
claims processing status.  After this time, claims processing will 
"^DD",9002313.99,9002313.99,3.01,21,3,0)
continue but the user will not see messages indicating the progress 
"^DD",9002313.99,9002313.99,3.01,21,4,0)
of the claim.
"^DD",9002313.99,9002313.99,3.01,"DT")
3050729
"^DD",9002313.99,9002313.99,3.02,0)
PAYER RESPONSE TEST MODE^S^1:ON;0:OFF;^0;3^Q
"^DD",9002313.99,9002313.99,3.02,3)
Set this to On to enable payer overrides.  Do not enable at production sites.
"^DD",9002313.99,9002313.99,3.02,21,0)
^^2^2^3050720^
"^DD",9002313.99,9002313.99,3.02,21,1,0)
This field enables the testing of Payer Response Overrides - 1 for On, 0 
"^DD",9002313.99,9002313.99,3.02,21,2,0)
(or "") for Off.  This should never be ON at a production site.
"^DD",9002313.99,9002313.99,3.02,"DT")
3050720
"^DD",9002313.99,9002313.99,115.01,0)
KEEP DISPHIST^S^0:NO;1:YES;^BPSOS6*;1^Q
"^DD",9002313.99,9002313.99,115.01,21,0)
^^2^2^3000406^
"^DD",9002313.99,9002313.99,115.01,21,1,0)
Should DISPHIST be used to keep a temporary history of List Manager activity?
"^DD",9002313.99,9002313.99,115.01,21,2,0)
(It's for debugging.)
"^DD",9002313.99,9002313.99,115.01,"DT")
3000406
"^DD",9002313.99,9002313.99,115.02,0)
SET $ZT^S^0:NO;1:YES;^BPSOS6*;2^Q
"^DD",9002313.99,9002313.99,115.02,21,0)
^^2^2^3000406^
"^DD",9002313.99,9002313.99,115.02,21,1,0)
Should $ZT be set at various places in BPSOS6?
"^DD",9002313.99,9002313.99,115.02,21,2,0)
(For debugging - to make sure you get the NEW'ed variables.)
"^DD",9002313.99,9002313.99,115.02,"DT")
3000406
"^DD",9002313.99,9002313.99,119.01,0)
BPSOSM1 LAST BEGIN DATE^D^^BPSOSM1;1^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,119.01,"DT")
3010129
"^DD",9002313.99,9002313.99,119.02,0)
BPSOSM1 LAST THRU DATE^D^^BPSOSM1;2^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,119.02,3)

"^DD",9002313.99,9002313.99,119.02,"DT")
3010129
"^DD",9002313.99,9002313.99,119.03,0)
BPSOSM1 LAST STARTED RUN^D^^BPSOSM1;3^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,119.03,"DT")
3010129
"^DD",9002313.99,9002313.99,119.04,0)
BPSOSM1 LAST FINISHED RUN^D^^BPSOSM1;4^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,119.04,"DT")
3010129
"^DD",9002313.99,9002313.99,119.05,0)
BPSOSM1 LAST TRANSACTION^NJ12,0^^BPSOSM1;5^K:+X'=X!(X>999999999999)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.99,9002313.99,119.05,3)
Type a number between 0 and 999999999999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,119.05,21,0)
^^2^2^3040503^^
"^DD",9002313.99,9002313.99,119.05,21,1,0)
This field holds the last transaction that was used to update the BPS 
"^DD",9002313.99,9002313.99,119.05,21,2,0)
REPORT MASTER file (#9002313.61).
"^DD",9002313.99,9002313.99,119.05,23,0)
^^2^2^3040503^
"^DD",9002313.99,9002313.99,119.05,23,1,0)
This field holds the last transaction that was used to update the BPS 
"^DD",9002313.99,9002313.99,119.05,23,2,0)
REPORT MASTER file (#9002313.61).
"^DD",9002313.99,9002313.99,119.05,"DT")
3040503
"^DD",9002313.99,9002313.99,120.01,0)
BPSOSR1 CURRENT JOB^NJ4,0^^BPSOSR1;1^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,120.01,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,120.01,"DT")
3000907
"^DD",9002313.99,9002313.99,120.02,0)
BPSOSR1 LAST DATETIME^D^^BPSOSR1;2^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,120.02,"DT")
3000907
"^DD",9002313.99,9002313.99,120.03,0)
BPSOSR1 STOP SIGNAL^S^0:RUNNING;1:REQUESTED STOP;2:STOPPED;^BPSOSR1;3^Q
"^DD",9002313.99,9002313.99,120.03,"DT")
3000907
"^DD",9002313.99,9002313.99,120.04,0)
BPSOSR1 POLLING INTERVAL^NJ5,0^^BPSOSR1;4^K:+X'=X!(X>10800)!(X<30)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,120.04,3)
Type a Number between 30 and 10800, 0 Decimal Digits
"^DD",9002313.99,9002313.99,120.04,21,0)
^^2^2^3000907^
"^DD",9002313.99,9002313.99,120.04,21,1,0)
Minimum 30 seconds - got to give BPSOSRX time to set up data
"^DD",9002313.99,9002313.99,120.04,21,2,0)
and start background jobs.  Maximum 3 hours, very arbitrarily chosen.
"^DD",9002313.99,9002313.99,120.04,"DT")
3000907
"^DD",9002313.99,9002313.99,120.05,0)
BPSOSR1 REACH BACK^NJ5,0^^BPSOSR1;5^K:+X'=X!(X>86400)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,120.05,3)
Type a Number between 0 and 86400, 0 Decimal Digits
"^DD",9002313.99,9002313.99,120.05,21,0)
^^7^7^3000907^
"^DD",9002313.99,9002313.99,120.05,21,1,0)
How many seconds to reach back before the last datetime processed.
"^DD",9002313.99,9002313.99,120.05,21,2,0)
Higher value - you'll spend more time querying status of already-proc'd
"^DD",9002313.99,9002313.99,120.05,21,3,0)
claims.   Lower value - you'll miss some and have to pick them up on
"^DD",9002313.99,9002313.99,120.05,21,4,0)
a later sweep, like at the end of the day or end of the week.
"^DD",9002313.99,9002313.99,120.05,21,5,0)
The bigger this value is, the bigger your Polling interval should be.
"^DD",9002313.99,9002313.99,120.05,21,6,0)
You don't want to reach back through the whole day's records every 30
"^DD",9002313.99,9002313.99,120.05,21,7,0)
seconds, for instance.
"^DD",9002313.99,9002313.99,120.05,"DT")
3000907
"^DD",9002313.99,9002313.99,120.06,0)
BPSOSR1 INDEX FOR NEW CLAIMS^F^^BPSOSR1;6^K:$L(X)>9!($L(X)<1) X
"^DD",9002313.99,9002313.99,120.06,3)
Answer must be 1-9 characters in length.
"^DD",9002313.99,9002313.99,120.06,21,0)
^^1^1^3000907^
"^DD",9002313.99,9002313.99,120.06,21,1,0)
^PSRX(index,datetime,rxi,rxr) for new claims - what index?
"^DD",9002313.99,9002313.99,120.06,"DT")
3000907
"^DD",9002313.99,9002313.99,120.07,0)
BPSOSR1 INDEX FOR REVERSALS^F^^BPSOSR1;7^K:$L(X)>9!($L(X)<1) X
"^DD",9002313.99,9002313.99,120.07,3)
Answer must be 1-9 characters in length.
"^DD",9002313.99,9002313.99,120.07,21,0)
^^1^1^3000907^
"^DD",9002313.99,9002313.99,120.07,21,1,0)
^PSRX(index,datetime,rxi,rxr) for reversals - what index?
"^DD",9002313.99,9002313.99,120.07,"DT")
3000907
"^DD",9002313.99,9002313.99,140.01,0)
BPSOSX DELTA 1^NJ8,4^^BPSOSX;1^K:+X'=X!(X>366)!(X<0)!(X?.E1"."5N.N) X
"^DD",9002313.99,9002313.99,140.01,3)
Type a Number between 0 and 366, 4 Decimal Digits
"^DD",9002313.99,9002313.99,140.01,21,0)
^^1^1^3001118^
"^DD",9002313.99,9002313.99,140.01,21,1,0)
Number of days back to beginning of period
"^DD",9002313.99,9002313.99,140.01,"DT")
3001118
"^DD",9002313.99,9002313.99,140.02,0)
BPSOSX DELTA 2^NJ8,4^^BPSOSX;2^K:+X'=X!(X>366)!(X<0)!(X?.E1"."5N.N) X
"^DD",9002313.99,9002313.99,140.02,3)
Type a Number between 0 and 366, 4 Decimal Digits
"^DD",9002313.99,9002313.99,140.02,21,0)
^^1^1^3001118^
"^DD",9002313.99,9002313.99,140.02,21,1,0)
Number of days back to end of period.
"^DD",9002313.99,9002313.99,140.02,"DT")
3001118
"^DD",9002313.99,9002313.99,140.03,0)
BPSOSX HRS FOR PURGE^NJ10,4^^BPSOSX;3^K:+X'=X!(X>99999)!(X<4)!(X?.E1"."5N.N) X
"^DD",9002313.99,9002313.99,140.03,3)
Type a Number between 4 and 99999, 4 Decimal Digits
"^DD",9002313.99,9002313.99,140.03,21,0)
^^1^1^3001118^
"^DD",9002313.99,9002313.99,140.03,21,1,0)
HRS hours arg passed to PURGE^BPSOSU7
"^DD",9002313.99,9002313.99,140.03,"DT")
3001118
"^DD",9002313.99,9002313.99,170.01,0)
A/R PACKAGE^S^0:INFORMATIX;1:NONE;3:IHS 3RD PARTY BILLING;99:OTHER;2:ANMC NIGHTLY CHECKER;4:PATIENT ACCOUNTS COMPONENT;^A/R INTERFACE;1^Q
"^DD",9002313.99,9002313.99,170.01,"DT")
3010207
"^DD",9002313.99,9002313.99,230.01,0)
*LAST TRANS THRU BPSOSB1^NJ7,0^^BILLING;1^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,230.01,3)
Type a Number between 1 and 9999999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,230.01,21,0)
^^6^6^3000530^
"^DD",9002313.99,9002313.99,230.01,21,1,0)
Points to the last entry in 9002313.57 that's completely been through
"^DD",9002313.99,9002313.99,230.01,21,2,0)
processing in routine BPSOSB1.  This way, you can reliably restart
"^DD",9002313.99,9002313.99,230.01,21,3,0)
BPSOSB1 if it should fail in the middle of a run.
"^DD",9002313.99,9002313.99,230.01,21,4,0)
-
"^DD",9002313.99,9002313.99,230.01,21,5,0)
And every time, it keeps track of what's been posted so you can
"^DD",9002313.99,9002313.99,230.01,21,6,0)
remember where you should start the next time through.
"^DD",9002313.99,9002313.99,230.01,"DT")
3010316
"^DD",9002313.99,9002313.99,235.01,0)
BILLING - NEXT SCHEDULED TIME^D^^BILLING - NEW;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,235.01,21,0)
^^3^3^3010124^
"^DD",9002313.99,9002313.99,235.01,21,1,0)
Set by TASKAT^BPSOSBD when scheduling a billing job.
"^DD",9002313.99,9002313.99,235.01,21,2,0)
Subsequently, as transactions near completion they see this
"^DD",9002313.99,9002313.99,235.01,21,3,0)
and realize that they don't need to schedule another billing job.
"^DD",9002313.99,9002313.99,235.01,"DT")
3010124
"^DD",9002313.99,9002313.99,235.02,0)
BILLING - DELTA TIME - MINUTES^NJ9,4^^BILLING - NEW;2^K:+X'=X!(X>9999.9999)!(X<1)!(X?.E1"."5N.N) X
"^DD",9002313.99,9002313.99,235.02,3)
Type a Number between 1 and 9999.9999, 4 Decimal Digits
"^DD",9002313.99,9002313.99,235.02,21,0)
^^3^3^3010124^
"^DD",9002313.99,9002313.99,235.02,21,1,0)
How many minutes between firing up of background jobs.
"^DD",9002313.99,9002313.99,235.02,21,2,0)
Used by scheduling logic in BPSOSBD.
"^DD",9002313.99,9002313.99,235.02,21,3,0)
Default (at last check) was 1 minute.
"^DD",9002313.99,9002313.99,235.02,"DT")
3010124
"^DD",9002313.99,9002313.99,235.03,0)
BILLING - DISABLED^S^1:DISABLED;0:ENABLED;^BILLING - NEW;3^Q
"^DD",9002313.99,9002313.99,235.03,21,0)
^^2^2^3010124^
"^DD",9002313.99,9002313.99,235.03,21,1,0)
By setting this flag, the billing job will be scheduled, but it won't
"^DD",9002313.99,9002313.99,235.03,21,2,0)
do anything.
"^DD",9002313.99,9002313.99,235.03,"DT")
3010124
"^DD",9002313.99,9002313.99,235.04,0)
BILLING - POST PAPER CLAIMS^S^1:YES;0:NO;^BILLING - NEW;4^Q
"^DD",9002313.99,9002313.99,235.04,"DT")
3010303
"^DD",9002313.99,9002313.99,235.05,0)
ILC ADJUSTMENTS BATCH NUMBER^F^^BILLING - NEW;5^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.99,9002313.99,235.05,3)
Answer must be 1-10 characters in length.
"^DD",9002313.99,9002313.99,235.05,21,0)
^^6^6^3010330^
"^DD",9002313.99,9002313.99,235.05,21,1,0)
Points to ^ABSBPMNT(*)
"^DD",9002313.99,9002313.99,235.05,21,2,0)
The batch number into which we are currently posting adjustments,
"^DD",9002313.99,9002313.99,235.05,21,3,0)
for reversed transactions.  The batch might have been released,
"^DD",9002313.99,9002313.99,235.05,21,4,0)
so you have to check to see if the batch is still open before you can
"^DD",9002313.99,9002313.99,235.05,21,5,0)
post anything to it.  you may have to create a new batch.
"^DD",9002313.99,9002313.99,235.05,21,6,0)
See also fields 235.06 and 235.07.
"^DD",9002313.99,9002313.99,235.05,"DT")
3010330
"^DD",9002313.99,9002313.99,235.06,0)
ILC ADJUSTMENTS BATCH LAST USE^D^^BILLING - NEW;6^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,235.06,21,0)
^^1^1^3010330^
"^DD",9002313.99,9002313.99,235.06,21,1,0)
Date when we last made an entry into this batch.
"^DD",9002313.99,9002313.99,235.06,"DT")
3010330
"^DD",9002313.99,9002313.99,235.07,0)
ILC ADJUSTMENTS BATCH LIFESPAN^NJ2,0^^BILLING - NEW;7^K:+X'=X!(X>31)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,235.07,3)
Type a Number between 1 and 31, 0 Decimal Digits
"^DD",9002313.99,9002313.99,235.07,21,0)
^^8^8^3010330^
"^DD",9002313.99,9002313.99,235.07,21,1,0)
How many days we will keep an adjustments batch around.
"^DD",9002313.99,9002313.99,235.07,21,2,0)
Default is 1.
"^DD",9002313.99,9002313.99,235.07,21,3,0)
If you want to have one batch for every week, set it to 7.
"^DD",9002313.99,9002313.99,235.07,21,4,0)
One batch for every month - 30 or 31.
"^DD",9002313.99,9002313.99,235.07,21,5,0)
Note that the batch will not necessarily be released on its own
"^DD",9002313.99,9002313.99,235.07,21,6,0)
Actually, someone has to release it from inside of A/R land.
"^DD",9002313.99,9002313.99,235.07,21,7,0)
This parameter is used to help Point of Sale to decide when it needs
"^DD",9002313.99,9002313.99,235.07,21,8,0)
to create a new batch.
"^DD",9002313.99,9002313.99,235.07,"DT")
3010330
"^DD",9002313.99,9002313.99,240,0)
BILLING LOG FILE^9002313.9902A^^BILLING LOG FILE;0
"^DD",9002313.99,9002313.99,370.01,0)
SUPPRESS V POV V68.1^S^1:YES;2:NO (SO PUT IT IN AUTOMATICALLY);^CREATING A/R;1^Q
"^DD",9002313.99,9002313.99,370.01,21,0)
^^5^5^3000420^
"^DD",9002313.99,9002313.99,370.01,21,1,0)
Usually, when we post charges to A/R in BPSOSB3, we will automatically
"^DD",9002313.99,9002313.99,370.01,21,2,0)
make sure that the visit has a V POV of V68.1 ISSUE REPEAT PRESCRIPT.
"^DD",9002313.99,9002313.99,370.01,21,3,0)
Set this to 1 YES to suppress this feature.
"^DD",9002313.99,9002313.99,370.01,21,4,0)
(I inquired about whether this should be done always or only when the
"^DD",9002313.99,9002313.99,370.01,21,5,0)
prescription is refill - the answer is "always")
"^DD",9002313.99,9002313.99,370.01,"DT")
3000420
"^DD",9002313.99,9002313.99,370.02,0)
SUPPRESS V PROVIDER^S^1:YES;0:NO (SO PUT IT IN AUTOMATICALLY);^CREATING A/R;2^Q
"^DD",9002313.99,9002313.99,370.02,21,0)
^^5^5^3000420^
"^DD",9002313.99,9002313.99,370.02,21,1,0)
When posting to A/R, the default behavior is to see whether there is
"^DD",9002313.99,9002313.99,370.02,21,2,0)
a provider assigned to this visit yet - and if not, take the prescriber
"^DD",9002313.99,9002313.99,370.02,21,3,0)
(just take it from the first prescription) and put this prescriber as the
"^DD",9002313.99,9002313.99,370.02,21,4,0)
primary provider for the visit.
"^DD",9002313.99,9002313.99,370.02,21,5,0)
Set this field to 1 TRUE to suppress this behavior.
"^DD",9002313.99,9002313.99,370.02,"DT")
3000420
"^DD",9002313.99,9002313.99,370.03,0)
SUPPRESS CLINIC^S^1:YE;1:YES;0:NO (SO PUT IT IN AUTOMATICALLY);^CREATING A/R;3^Q
"^DD",9002313.99,9002313.99,370.03,21,0)
^^3^3^3000420^
"^DD",9002313.99,9002313.99,370.03,21,1,0)
By default, posting to A/R will also look to see if the visit has been
"^DD",9002313.99,9002313.99,370.03,21,2,0)
assigned a CLINIC.  If not, the clinic PHARMACY will be stuffed in there
"^DD",9002313.99,9002313.99,370.03,21,3,0)
automatically.  Set this field to YES to suppress this behavior.
"^DD",9002313.99,9002313.99,370.03,"DT")
3000420
"^DD",9002313.99,9002313.99,440.01,0)
DEFAULT DIAL OUT^*P9002313.55'^BPS(9002313.55,^DIAL-OUT DEFAULT;1^S DIC("S")="I $P(^(0),U)'=""DEFAULT""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9002313.99,9002313.99,440.01,3)
Answer must be 1-10 characters in length.
"^DD",9002313.99,9002313.99,440.01,12)
The default points to some dial-out other than the DEFAULT dialout - it's where the default gets its defaults from.
"^DD",9002313.99,9002313.99,440.01,12.1)
S DIC("S")="I $P(^(0),U)'=""DEFAULT"""
"^DD",9002313.99,9002313.99,440.01,"DT")
3001007
"^DD",9002313.99,9002313.99,577.01,0)
EOB INSURER^P9999999.18'^AUTNINS(^EOB-SCREEN;1^Q
"^DD",9002313.99,9002313.99,577.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.99,9002313.99,577.01,"DT")
3000504
"^DD",9002313.99,9002313.99,577.02,0)
EOB START DATE/TIME^D^^EOB-SCREEN;2^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,577.02,"DT")
3000504
"^DD",9002313.99,9002313.99,577.03,0)
EOB END DATE/TIME^D^^EOB-SCREEN;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,577.03,"DT")
3000504
"^DD",9002313.99,9002313.99,577.04,0)
EOB DEPOSIT DATE^D^^EOB-SCREEN;4^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,577.04,"DT")
3000505
"^DD",9002313.99,9002313.99,577.05,0)
EOB $ TOTAL^NJ9,2^^EOB-SCREEN;5^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<0) X
"^DD",9002313.99,9002313.99,577.05,3)
Type a Dollar Amount between 0 and 999999, 2 Decimal Digits
"^DD",9002313.99,9002313.99,577.05,"DT")
3000505
"^DD",9002313.99,9002313.99,665.01,0)
NCPDP FORM - PRINT DRUG NAME^S^1:YES;0:NO;^FORMS - NCPDP;1^Q
"^DD",9002313.99,9002313.99,665.01,21,0)
^^3^3^3001110^^
"^DD",9002313.99,9002313.99,665.01,21,1,0)
These are system-wide defaults.
"^DD",9002313.99,9002313.99,665.01,21,2,0)
You can set insurer-specific values for these using fields in 
"^DD",9002313.99,9002313.99,665.01,21,3,0)
^BPSEI(...), FILE 9002313.4, BPS INSURER.
"^DD",9002313.99,9002313.99,665.01,"DT")
3000724
"^DD",9002313.99,9002313.99,665.02,0)
NCPDP FORM - PRINT DIAGNOSIS^S^1:YES;0:NO;^FORMS - NCPDP;2^Q
"^DD",9002313.99,9002313.99,665.02,"DT")
3000724
"^DD",9002313.99,9002313.99,665.03,0)
NCPDP FORM - PHARM # TO USE^S^0:NABP #;1:INSURER-ASSIGNED PHARMACY NUMBER;2:TAX ID #;^FORMS - NCPDP;3^Q
"^DD",9002313.99,9002313.99,665.03,"DT")
3000724
"^DD",9002313.99,9002313.99,665.04,0)
NCPDP FORM - PRINT TAX ID #^S^1:YES;0:NO;^FORMS - NCPDP;4^Q
"^DD",9002313.99,9002313.99,665.04,21,0)
^^3^3^3000724^
"^DD",9002313.99,9002313.99,665.04,21,1,0)
This refers to printing the tax id # just above the pharmacy number,
"^DD",9002313.99,9002313.99,665.04,21,2,0)
yet in the same box.  Don't confuse with the tax id # in the PHARM # TO USE
"^DD",9002313.99,9002313.99,665.04,21,3,0)
field - which prints the tax id # in lieu of the pharmacy number
"^DD",9002313.99,9002313.99,665.04,"DT")
3000724
"^DD",9002313.99,9002313.99,667.01,0)
PREBILL - DEFAULT FORM^S^60.13:NCPDP form;60:UB92;60.2:1500;^FORMS - PREBILL;1^Q
"^DD",9002313.99,9002313.99,667.01,3)

"^DD",9002313.99,9002313.99,667.01,21,0)
^^9^9^3001110^^
"^DD",9002313.99,9002313.99,667.01,21,1,0)
This is a FIELD NUMBER in the BILLING ITEMS file.
"^DD",9002313.99,9002313.99,667.01,21,2,0)
It points to the field corresponding to the prebill list
"^DD",9002313.99,9002313.99,667.01,21,3,0)
where pharmacy paper claims should go when the bills are first created.
"^DD",9002313.99,9002313.99,667.01,21,4,0)
The default default in the program is 60.13, PRINT NCPDP PHARMACY.
"^DD",9002313.99,9002313.99,667.01,21,5,0)
If you want your pharmacy bills to go to, say, a UB92, then set this field
"^DD",9002313.99,9002313.99,667.01,21,6,0)
to 60.  Or set it to 60.2 to send pharmacy bills to a 1500.
"^DD",9002313.99,9002313.99,667.01,21,7,0)
-
"^DD",9002313.99,9002313.99,667.01,21,8,0)
If you want to have a different field for different insurance companies,
"^DD",9002313.99,9002313.99,667.01,21,9,0)
then use the corresponding field in file 9002313.4, BPS INSURER.
"^DD",9002313.99,9002313.99,667.01,"DT")
3000725
"^DD",9002313.99,9002313.99,667.02,0)
PREBILL - FORM FOR ROLLOVERS^S^60.13:NCPDP;60:UB92;60.2:1500;^FORMS - PREBILL;2^Q
"^DD",9002313.99,9002313.99,667.02,3)

"^DD",9002313.99,9002313.99,667.02,21,0)
^^3^3^3000724^
"^DD",9002313.99,9002313.99,667.02,21,1,0)
The default default in the program is 60 - print rolled-over bills
"^DD",9002313.99,9002313.99,667.02,21,2,0)
on UB92.  (Not NCPDP - how,where do you put the amount paid by the
"^DD",9002313.99,9002313.99,667.02,21,3,0)
first insurer?)
"^DD",9002313.99,9002313.99,667.02,"DT")
3000725
"^DD",9002313.99,9002313.99,941,0)
RX NUMERIC^S^0:MEANS INTERNAL RX #;1:MEANS EXTERNAL RX #;^INPUT;1^Q
"^DD",9002313.99,9002313.99,941,21,0)
^^5^5^3000404^
"^DD",9002313.99,9002313.99,941,21,1,0)
When the "Prescription" prompt is answered with a pure numeric input,
"^DD",9002313.99,9002313.99,941,21,2,0)
should we interpret that to be an internal or external RX #?
"^DD",9002313.99,9002313.99,941,21,3,0)
If this is set to 0 (INTERNAL RX #), then if you wish to input an
"^DD",9002313.99,9002313.99,941,21,4,0)
external RX #, you need to use the syntax   RX number
"^DD",9002313.99,9002313.99,941,21,5,0)
to force it to be interpreted as an external RX #.
"^DD",9002313.99,9002313.99,941,"DT")
3000404
"^DD",9002313.99,9002313.99,942,0)
COMPARE NDC # TO DRUG^S^1:YES;0:NO;^INPUT;2^Q
"^DD",9002313.99,9002313.99,942,21,0)
^^5^5^3001007^
"^DD",9002313.99,9002313.99,942,21,1,0)
For interactive input, compare the NDC # typed or scanned
"^DD",9002313.99,9002313.99,942,21,2,0)
with the NDC # stored in the drug file (as pointed to by this prescription)
"^DD",9002313.99,9002313.99,942,21,3,0)
and do an are-you-sure? if they differ.  
"^DD",9002313.99,9002313.99,942,21,4,0)
The reason is to avoid accidental pricing mistakes.
"^DD",9002313.99,9002313.99,942,21,5,0)
(As of 10/07/2000 - field is defined; code isn't there yet)
"^DD",9002313.99,9002313.99,942,"DT")
3001007
"^DD",9002313.99,9002313.99,943,0)
USUAL INPUT METHOD^S^0:MANUAL;1:VISTA PSO CALLS ECME;2:BACKGROUND SCANNER OF PSRX;^INPUT;3^Q
"^DD",9002313.99,9002313.99,943,3)
Enter the default method used to create ECME claims
"^DD",9002313.99,9002313.99,943,21,0)
^^1^1^3050729^
"^DD",9002313.99,9002313.99,943,21,1,0)
This field stores the default method used to create ECME claims
"^DD",9002313.99,9002313.99,943,"DT")
3050729
"^DD",9002313.99,9002313.99,951,0)
INS GRACE DEFAULT^NJ3,0^^INS;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,951,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,951,21,0)
^^6^6^3001110^^
"^DD",9002313.99,9002313.99,951,21,1,0)
Default grace period for insurance - treat it as current even if the
"^DD",9002313.99,9002313.99,951,21,2,0)
eligibility expired within this many days ago.
"^DD",9002313.99,9002313.99,951,21,3,0)
Each insurer can have their own - File 9002313.4, field 100.08.
"^DD",9002313.99,9002313.99,951,21,4,0)
For those which don't have that field, the default comes from here.
"^DD",9002313.99,9002313.99,951,21,5,0)
If this field is missing, the default default is 30 days, hardcoded in
"^DD",9002313.99,9002313.99,951,21,6,0)
routine BPSOS25.
"^DD",9002313.99,9002313.99,951,"DT")
3000321
"^DD",9002313.99,9002313.99,952,0)
*ASK INS DURING INPUT^S^1:YES;0:NO;^INS;2^Q
"^DD",9002313.99,9002313.99,952,21,0)
^^3^3^3000321^
"^DD",9002313.99,9002313.99,952,21,1,0)
If true, then user will be prompted for insurance selection during
"^DD",9002313.99,9002313.99,952,21,2,0)
input, in routine ABSBPOSV.   If false (or missing), then no insurance
"^DD",9002313.99,9002313.99,952,21,3,0)
questions appear in ABSBPOSV and a default will be selected in ABSBPOSW.
"^DD",9002313.99,9002313.99,952,"DT")
3001016
"^DD",9002313.99,9002313.99,953,0)
NO FI TRANSLATION IN BPSOS29^S^1:SUPPRESS FI TRANSLATION;0:(DEFAULT) DO FI TRANSLATION;^INS;3^Q
"^DD",9002313.99,9002313.99,953,21,0)
^^9^9^3001016^
"^DD",9002313.99,9002313.99,953,21,1,0)
INSURER, field 1301 - should we translate Medicaid into state's Medicaid?
"^DD",9002313.99,9002313.99,953,21,2,0)
Yes, unless this field is explicitly set to suppress the translation.
"^DD",9002313.99,9002313.99,953,21,3,0)
Needed originally for Pawhuska, where Medicaid in IEN 3 is pointed to by
"^DD",9002313.99,9002313.99,953,21,4,0)
all of the Medicaid Eligible entries, but where IEN 3 is set to RX 
"^DD",9002313.99,9002313.99,953,21,5,0)
unbillable!  We need to looka the OKLAHOMA MEDICAID in order to see 
"^DD",9002313.99,9002313.99,953,21,6,0)
RX as billable.
"^DD",9002313.99,9002313.99,953,21,7,0)
-
"^DD",9002313.99,9002313.99,953,21,8,0)
Important!  This only happens in BPSOS29, which only happens in
"^DD",9002313.99,9002313.99,953,21,9,0)
non-ILC A/R sites, at least as of October 2000.
"^DD",9002313.99,9002313.99,953,"DT")
3001016
"^DD",9002313.99,9002313.99,960.01,0)
INS BASE PRVT^NJ4,0^^INS BASE SCORES;1^K:+X'=X!(X>1000)!(X<-1000)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,960.01,3)
Type a Number between -1000 and 1000, 0 Decimal Digits
"^DD",9002313.99,9002313.99,960.01,"DT")
3000818
"^DD",9002313.99,9002313.99,960.02,0)
INS BASE CARE^NJ4,0^^INS BASE SCORES;2^K:+X'=X!(X>1000)!(X<-1000)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,960.02,3)
Type a Number between -1000 and 1000, 0 Decimal Digits
"^DD",9002313.99,9002313.99,960.02,"DT")
3000818
"^DD",9002313.99,9002313.99,960.03,0)
INS BASE CAID^NJ4,0^^INS BASE SCORES;3^K:+X'=X!(X>1000)!(X<-1000)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,960.03,3)
Type a Number between -1000 and 1000, 0 Decimal Digits
"^DD",9002313.99,9002313.99,960.03,"DT")
3000818
"^DD",9002313.99,9002313.99,960.04,0)
INS BASE RR^NJ4,0^^INS BASE SCORES;4^K:+X'=X!(X>1000)!(X<-1000)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,960.04,3)
Type a Number between -1000 and 1000, 0 Decimal Digits
"^DD",9002313.99,9002313.99,960.04,"DT")
3000818
"^DD",9002313.99,9002313.99,960.05,0)
INS BASE SELF^NJ4,0^^INS BASE SCORES;5^K:+X'=X!(X>1000)!(X<-1000)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,960.05,3)
Type a Number between -1000 and 1000, 0 Decimal Digits
"^DD",9002313.99,9002313.99,960.05,"DT")
3000818
"^DD",9002313.99,9002313.99,970.01,0)
INS RULE ORDER^9002313.9903I^^INS RULES;0
"^DD",9002313.99,9002313.99,1490,0)
NULL FILE^F^^NULL FILE;1^K:$L(X)>127!($L(X)<1) X
"^DD",9002313.99,9002313.99,1490,3)
Answer must be 1-127 characters in length.
"^DD",9002313.99,9002313.99,1490,21,0)
^^3^3^3000318^^
"^DD",9002313.99,9002313.99,1490,21,1,0)
Path and filename of a "null" file we can throw away output to.
"^DD",9002313.99,9002313.99,1490,21,2,0)
Originally for when BPSOS25 calls ABSBCOMB.
"^DD",9002313.99,9002313.99,1490,21,3,0)
If not present, BPSOS25 defaults it to /dev/null
"^DD",9002313.99,9002313.99,1490,"DT")
3000318
"^DD",9002313.99,9002313.99,1501,0)
OUTSIDE LINE^F^^OUTSIDE LINE;1^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.99,9002313.99,1501,3)
Answer must be 1-12 characters in length.
"^DD",9002313.99,9002313.99,1501,21,0)
^^5^5^3000317^
"^DD",9002313.99,9002313.99,1501,21,1,0)
The phone numbers in the DIAL OUT file 9002313.55 should be just the
"^DD",9002313.99,9002313.99,1501,21,2,0)
number to dial once you have an outside line.   If you need something like
"^DD",9002313.99,9002313.99,1501,21,3,0)
a 9 in front, then set this node to that value, such as "9," to request
"^DD",9002313.99,9002313.99,1501,21,4,0)
an outside line and then pause.  A leading 1 (as in 18006544518) belongs
"^DD",9002313.99,9002313.99,1501,21,5,0)
in the DIAL OUT file, not here.
"^DD",9002313.99,9002313.99,1501,"DT")
3000317
"^DD",9002313.99,9002313.99,1660.01,0)
POSTAGE CPT^P9002300'^ABSCPT(9002300,^POSTAGE;1^Q
"^DD",9002313.99,9002313.99,1660.01,3)
Answer must be 3-10 characters in length.
"^DD",9002313.99,9002313.99,1660.01,21,0)
^^1^1^3000620^
"^DD",9002313.99,9002313.99,1660.01,21,1,0)
Points to the charge code for postage for mailing prescriptions.
"^DD",9002313.99,9002313.99,1660.01,"DT")
3001120
"^DD",9002313.99,9002313.99,1801,0)
RX AR TYPE DEFAULT^P9001626'^ABSBTYP(^RX A/R TYPE;1^Q
"^DD",9002313.99,9002313.99,1801,3)

"^DD",9002313.99,9002313.99,1801,21,0)
^^5^5^3000413^
"^DD",9002313.99,9002313.99,1801,21,1,0)
BPSOSB3 posts charges to accounts receivable.  We need to decide on
"^DD",9002313.99,9002313.99,1801,21,2,0)
an AR TYPE before we call ABSBMAKE.  The first choice is the A/R type 
"^DD",9002313.99,9002313.99,1801,21,3,0)
from the PHARMACY field in the 9002313.57 record - it points to the
"^DD",9002313.99,9002313.99,1801,21,4,0)
9002313.56 file, and we can have a different a/r type for each pharmacy.
"^DD",9002313.99,9002313.99,1801,21,5,0)
But this here is a default default.
"^DD",9002313.99,9002313.99,1801,"DT")
3000413
"^DD",9002313.99,9002313.99,1811.01,0)
RECEIPT STYLE^F^^RECEIPT;1^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.99,9002313.99,1811.01,3)
Answer must be 1-8 characters in length.
"^DD",9002313.99,9002313.99,1811.01,21,0)
^^1^1^3000905^
"^DD",9002313.99,9002313.99,1811.01,21,1,0)
Must match a line tag at the top of BPSECP3.
"^DD",9002313.99,9002313.99,1811.01,"DT")
3000905
"^DD",9002313.99,9002313.99,1960.01,0)
OK MEDICAID INSURANCE NAME^P9999999.18'^AUTNINS(^SPECIAL;1^Q
"^DD",9002313.99,9002313.99,1960.01,3)
Answer must be 1-10 characters in length.
"^DD",9002313.99,9002313.99,1960.01,"DT")
3001027
"^DD",9002313.99,9002313.99,1960.02,0)
OK MEDICAID CYCLE (SECONDS)^NJ4,0^^SPECIAL;2^K:+X'=X!(X>1800)!(X<5)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,1960.02,3)
Type a Number between 5 and 1800, 0 Decimal Digits
"^DD",9002313.99,9002313.99,1960.02,21,0)
^^3^3^3000816^
"^DD",9002313.99,9002313.99,1960.02,21,1,0)
After this many seconds without new prescriptions detected,
"^DD",9002313.99,9002313.99,1960.02,21,2,0)
we assume that data entry is complete so we may proceed to decide
"^DD",9002313.99,9002313.99,1960.02,21,3,0)
which ones to submit.
"^DD",9002313.99,9002313.99,1960.02,"DT")
3001027
"^DD",9002313.99,9002313.99,1960.03,0)
OK MEDICAID LIMIT^NJ2,0^^SPECIAL;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,1960.03,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",9002313.99,9002313.99,1960.03,21,0)
^^1^1^3000816^
"^DD",9002313.99,9002313.99,1960.03,21,1,0)
Limit is this many prescriptions in a month.
"^DD",9002313.99,9002313.99,1960.03,"DT")
3000816
"^DD",9002313.99,9002313.99,1980.01,0)
STARTUP DATE^D^^STARTUP;1^S %DT="EX" D ^%DT S X=Y K:3991231<X!(3000410>X) X
"^DD",9002313.99,9002313.99,1980.01,3)
TYPE A DATE BETWEEN 4/10/2000 AND 12/31/2099
"^DD",9002313.99,9002313.99,1980.01,21,0)
^^4^4^3000410^
"^DD",9002313.99,9002313.99,1980.01,21,1,0)
The date when POS activity went "live".
"^DD",9002313.99,9002313.99,1980.01,21,2,0)
This is needed by BPSOSD1 so it won't pick up prescriptions before the 
"^DD",9002313.99,9002313.99,1980.01,21,3,0)
POS "live" date.  This is needed by ABSBLRX at Sitka so it won't
"^DD",9002313.99,9002313.99,1980.01,21,4,0)
do billing for prescriptions for visits starting on this date.
"^DD",9002313.99,9002313.99,1980.01,"DT")
3000410
"^DD",9002313.99,9002313.99,2128.11,0)
UNBILLABLE NDC #^9002313.9905^^UNBILLABLE NDC #;0
"^DD",9002313.99,9002313.99,2128.12,0)
UNBILLABLE DRUG NAME^9002313.9904^^UNBILLABLE DRUG NAME;0
"^DD",9002313.99,9002313.99,2128.13,0)
UNBILLABLE OTC^S^1:OTC DRUGS ARE UNBILLABLE;0:OTC DRUGS ARE BILLABLE;^UNBILLABLE OTC;1^Q
"^DD",9002313.99,9002313.99,2128.13,21,0)
^^6^6^3001007^
"^DD",9002313.99,9002313.99,2128.13,21,1,0)
This is the system default setting to indicate that OTC drugs are
"^DD",9002313.99,9002313.99,2128.13,21,2,0)
unbillable.  It can be set on an insurance-specific basis, too.
"^DD",9002313.99,9002313.99,2128.13,21,3,0)
If the system-wide setting is for OTC DRUGS ARE UNBILLABLE,
"^DD",9002313.99,9002313.99,2128.13,21,4,0)
any SELF, SELF PAY, or uninsured cases will still be considered as
"^DD",9002313.99,9002313.99,2128.13,21,5,0)
billable.  (Although you could still edit SELF PAY to say it's billable,
"^DD",9002313.99,9002313.99,2128.13,21,6,0)
for instance.)
"^DD",9002313.99,9002313.99,2128.13,"DT")
3001007
"^DD",9002313.99,9002313.99,2270.01,0)
WO INSURER LIST TYPE^S^1:ALL (Ignore list);2:Those LISTED here;3:EXCEPT these here;^WRITEOFF-SCREEN;1^Q
"^DD",9002313.99,9002313.99,2270.01,"DT")
3000509
"^DD",9002313.99,9002313.99,2270.02,0)
WO ARTYPE LIST TYPE^S^1:ALL (Ignore list);2:Those LISTED here;3:EXCEPT these here;^WRITEOFF-SCREEN;2^Q
"^DD",9002313.99,9002313.99,2270.02,"DT")
3000509
"^DD",9002313.99,9002313.99,2270.03,0)
WO BAL MIN^NJ10,2^^WRITEOFF-SCREEN;3^S:X["$" X=$P(X,"$",2) K:X'?."-".N.1".".2N!(X>1000000)!(X<-1000000) X
"^DD",9002313.99,9002313.99,2270.03,3)
Type the MINIMUM balance of an account to include on the write-offs list.
"^DD",9002313.99,9002313.99,2270.03,"DT")
3000518
"^DD",9002313.99,9002313.99,2270.04,0)
WO BAL MAX^NJ10,2^^WRITEOFF-SCREEN;4^S:X["$" X=$P(X,"$",2) K:X'?."-".N.1".".2N!(X>1000000)!(X<-1000000) X
"^DD",9002313.99,9002313.99,2270.04,3)
Type the MAXIMUM balance of an account to include on the write-offs list.
"^DD",9002313.99,9002313.99,2270.04,"DT")
3000518
"^DD",9002313.99,9002313.99,2270.05,0)
WO AGE IN DAYS^NJ4,0^^WRITEOFF-SCREEN;5^K:+X'=X!(X>9999)!(X<10)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,2270.05,3)
Type a Number between 10 and 9999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,2270.05,"DT")
3000509
"^DD",9002313.99,9002313.99,2270.06,0)
WO CLINIC LIST TYPE^S^1:ALL (Ignore list);2:Those LISTED here;3:EXCEPT these here;^WRITEOFF-SCREEN;6^Q
"^DD",9002313.99,9002313.99,2270.06,"DT")
3000509
"^DD",9002313.99,9002313.99,2270.11,0)
WO PMT^S^0:DON'T CONSIDER;1:BY CURRENT INSURER;2:YES, ANY PAYMENT;^WRITEOFF-SCREEN;11^Q
"^DD",9002313.99,9002313.99,2270.11,"DT")
3000511
"^DD",9002313.99,9002313.99,2270.12,0)
WO REASON PTR^P9002320'^ABSADJR(9002320,^WRITEOFF-SCREEN;12^Q
"^DD",9002313.99,9002313.99,2270.12,"DT")
3001120
"^DD",9002313.99,9002313.99,2270.7,0)
WO DIAGNOSIS LIST TYPE^S^1:ALL (Ignore list);2:Those LISTED here;3:EXCEPT these here;^WRITEOFF-SCREEN;7^Q
"^DD",9002313.99,9002313.99,2270.7,"DT")
3000509
"^DD",9002313.99,9002313.99,2270.8,0)
WO DATE OF SERVICE^D^^WRITEOFF-SCREEN;8^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,2270.8,"DT")
3000509
"^DD",9002313.99,9002313.99,2270.9,0)
WO BAL AS PCT^NJ6,2^^WRITEOFF-SCREEN;9^K:+X'=X!(X>999.99)!(X<0)!(X?.E1"."3N.N) X
"^DD",9002313.99,9002313.99,2270.9,3)
Type a Number between 0 and 999.99, 2 Decimal Digits
"^DD",9002313.99,9002313.99,2270.9,"DT")
3000510
"^DD",9002313.99,9002313.99,2271,0)
WO ARTYPE^9002313.992271PA^^WRITEOFF-SCREEN ARTYPE;0
"^DD",9002313.99,9002313.99,2272.01,0)
WO BATCH^P9001625.1'^ABSBPMNT(^WRITEOFF-SCREEN BATCH;1^Q
"^DD",9002313.99,9002313.99,2272.01,3)
Answer must be 1-10 characters in length.
"^DD",9002313.99,9002313.99,2272.01,"DT")
3000517
"^DD",9002313.99,9002313.99,2273,0)
WO CLINIC^9002313.992273PA^^WRITEOFF-SCREEN CLINIC;0
"^DD",9002313.99,9002313.99,2274,0)
WO DIAG^9002313.992274PA^^WRITEOFF-SCREEN DIAG;0
"^DD",9002313.99,9002313.99,2279,0)
WO INSURER^9002313.992279PA^^WRITEOFF-SCREEN INSURER;0
"^DD",9002313.99,9002313.99,2341.01,0)
WINNOW .57 AFTER POSTING^NJ4,0^^WINNOW;1^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,2341.01,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,2341.01,"DT")
3001026
"^DD",9002313.99,9002313.99,2341.02,0)
WINNOW UNPOSTED .57^NJ4,0^^WINNOW;2^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,2341.02,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,2341.02,"DT")
3001026
"^DD",9002313.99,9002313.99,2341.03,0)
WINNOW LOG FILES^NJ7,2^^WINNOW;3^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."3N.N) X
"^DD",9002313.99,9002313.99,2341.03,3)
Type a Number between 0 and 9999, 2 Decimal Digits
"^DD",9002313.99,9002313.99,2341.03,"DT")
3001116
"^DD",9002313.99,9002313.99,2341.04,0)
WINNOW COMBINED INSURANCE^NJ7,2^^WINNOW;4^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."3N.N) X
"^DD",9002313.99,9002313.99,2341.04,3)
Type a Number between 0 and 9999, 2 Decimal Digits
"^DD",9002313.99,9002313.99,2341.04,"DT")
3001116
"^DD",9002313.99,9002313.99,2341.05,0)
WINNOW .03 RAW DATA^NJ4,0^^WINNOW;5^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,2341.05,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,2341.05,"DT")
3001218
"^DD",9002313.99,9002313.99,2341.06,0)
WINNOW .03 CONTENTS^NJ4,0^^WINNOW;6^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,2341.06,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,2341.06,"DT")
3001218
"^DD",9002313.99,9002313.99,2341.07,0)
WINNOW .02 RAW DATA^NJ4,0^^WINNOW;7^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,2341.07,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,2341.07,"DT")
3001218
"^DD",9002313.99,9002313.99,2341.08,0)
WINNOW .02 CONTENTS^NJ4,0^^WINNOW;8^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,2341.08,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,2341.08,"DT")
3001218
"^DD",9002313.99,9002313.99,2341.09,0)
WINNOW .51^NJ4,0^^WINNOW;9^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,2341.09,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,2341.09,"DT")
3001218
"^DD",9002313.99,9002313.99,2341.1,0)
WINNOW .511^NJ4,0^^WINNOW;10^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,2341.1,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,2341.1,"DT")
3001218
"^DD",9002313.99,9002313.99,2341.11,0)
WINNOW .59^NJ4,0^^WINNOW;11^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,2341.11,3)
Type a Number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,2341.11,"DT")
3001218
"^DD",9002313.99,9002313.99,2342.01,0)
WINNOW LOG FILE^F^^WINNOW LOG;1^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.99,9002313.99,2342.01,3)
Answer must be 1-20 characters in length.
"^DD",9002313.99,9002313.99,2342.01,"DT")
3001219
"^DD",9002313.99,9002313.99,2342.02,0)
WINNOW LOG -1^F^^WINNOW LOG;2^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.99,9002313.99,2342.02,3)
Answer must be 1-20 characters in length.
"^DD",9002313.99,9002313.99,2342.02,"DT")
3001219
"^DD",9002313.99,9002313.99,2342.03,0)
WINNOW LOG -2^F^^WINNOW LOG;3^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.99,9002313.99,2342.03,3)
Answer must be 1-20 characters in length.
"^DD",9002313.99,9002313.99,2342.03,"DT")
3001219
"^DD",9002313.99,9002313.99,2343.01,0)
WINNOW TESTING FLAG^S^1:YES;0:NO;^WINNOW TESTING;1^Q
"^DD",9002313.99,9002313.99,2343.01,"DT")
3001219
"^DD",9002313.99,9002313.99,2380,0)
WORKERS COMP^9002313.9901P^^WORKERS COMP;0
"^DD",9002313.99,9002313.99,2388,0)
WRITE OFF INSURER^9002313.992388PA^^WRITE OFF INSURER;0
"^DD",9002313.99,9002313.99,2389,0)
WRITE OFF SELF PAY^9002313.992389PA^^WRITE OFF SELF PAY;0
"^DD",9002313.99,9002313.99,2500,0)
CERTIFIER^P200'^VA(200,^CERTIFIER;1^Q
"^DD",9002313.99,9002313.99,2500,3)
ENTER THE DUZ OF THE PERSON PERFORMING CERTIFICATION
"^DD",9002313.99,9002313.99,2500,21,0)
^^1^1^3031125^
"^DD",9002313.99,9002313.99,2500,21,1,0)
CONTAINS THE DUZ OF THE PERSON PERFORMING CERTIFICATION.
"^DD",9002313.99,9002313.99,2500,"DT")
3031125
"^DD",9002313.99,9002313.99,5151,0)
NCPDP 5.1 CONVERSION^D^^NCPDP51;1^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.99,5151,21,0)
^^4^4^3021031^
"^DD",9002313.99,9002313.99,5151,21,1,0)
This field will be used to document when the conversion of the claim file,
"^DD",9002313.99,9002313.99,5151,21,2,0)
done in preparation of the use of NCPDP 5.1, is completed.  It should be
"^DD",9002313.99,9002313.99,5151,21,3,0)
set from within the post install routine (^BPSOSJ1) run by the POS V1.0
"^DD",9002313.99,9002313.99,5151,21,4,0)
Patch 3 kids file.
"^DD",9002313.99,9002313.99,5151,"DT")
3021031
"^DD",9002313.99,9002313.99,6000,0)
VA SITE CONTACT^P200'^VA(200,^VITRIA;1^Q
"^DD",9002313.99,9002313.99,6000,3)
ENTER THE VA CONTACT FOR VITRIA.
"^DD",9002313.99,9002313.99,6000,21,0)
^.001^1^1^3040127^^
"^DD",9002313.99,9002313.99,6000,21,1,0)
Enter the VA Site Contact for Vitria.
"^DD",9002313.99,9002313.99,6000,"DT")
3031030
"^DD",9002313.99,9002313.99,6001,0)
VA Alternate Site Contract^P200'^VA(200,^VITRIA;2^Q
"^DD",9002313.99,9002313.99,6001,3)
ENTER THE VA ALTERNATE SITE CONTACT FOR VITRIA.
"^DD",9002313.99,9002313.99,6001,21,0)
^^1^1^3050907^
"^DD",9002313.99,9002313.99,6001,21,1,0)
Enter the VA Alternate Site Contact for Vitria.
"^DD",9002313.99,9002313.99,6001,"DT")
3050907
"^DD",9002313.99,9002313.99,6003,0)
VITRIA INTERFACE VERSION #^F^^VITRIA;3^K:$L(X)>35!($L(X)<1) X
"^DD",9002313.99,9002313.99,6003,3)
Answer must be 1-35 characters in length.
"^DD",9002313.99,9002313.99,6003,21,0)
^.001^1^1^3040127^^
"^DD",9002313.99,9002313.99,6003,21,1,0)
Enter the Vitria supplied interface verison number.
"^DD",9002313.99,9002313.99,6003,"DT")
3031030
"^DD",9002313.99,9002313.99,9999,0)
SITE TYPE^RS^0:VA;1:IHS;^SITE TYPE;1^Q
"^DD",9002313.99,9002313.99,9999,3)
Enter 0 (zero) for VA or 1 for IHS.
"^DD",9002313.99,9002313.99,9999,21,0)
^^4^4^3030616^
"^DD",9002313.99,9002313.99,9999,21,1,0)
This field is used to determine whether the site is a Veterens 
"^DD",9002313.99,9002313.99,9999,21,2,0)
Administration site or and Indian Health Services Site.  Based on this 
"^DD",9002313.99,9002313.99,9999,21,3,0)
answer, the ECME system will process in two different manners with 
"^DD",9002313.99,9002313.99,9999,21,4,0)
respect to claims generation and data collection methods.
"^DD",9002313.99,9002313.99,9999,"DT")
3030616
"^DD",9002313.99,9002313.99,10000,0)
VA LAST SEQUENCE^NJ10,0^^3;1^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,10000,3)
Type a Number between 0 and 9999999999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,10000,"DT")
3030724
"^DD",9002313.99,9002313.9901,0)
WORKERS COMP SUB-FIELD^^.01^1
"^DD",9002313.99,9002313.9901,0,"DT")
3000418
"^DD",9002313.99,9002313.9901,0,"IX","B",9002313.9901,.01)

"^DD",9002313.99,9002313.9901,0,"NM","WORKERS COMP")

"^DD",9002313.99,9002313.9901,0,"UP")
9002313.99
"^DD",9002313.99,9002313.9901,.01,0)
WORKERS COMP^MP9999999.18'^AUTNINS(^0;1^Q
"^DD",9002313.99,9002313.9901,.01,1,0)
^.1
"^DD",9002313.99,9002313.9901,.01,1,1,0)
9002313.9901^B
"^DD",9002313.99,9002313.9901,.01,1,1,1)
S ^BPS(9002313.99,DA(1),"WORKERS COMP","B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.9901,.01,1,1,2)
K ^BPS(9002313.99,DA(1),"WORKERS COMP","B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.9901,.01,21,0)
^^4^4^3000418^
"^DD",9002313.99,9002313.9901,.01,21,1,0)
A list of insurers which are exclusively workers comp insurances:
"^DD",9002313.99,9002313.9901,.01,21,2,0)
if it's not workers comp claim, do not select this insurance.
"^DD",9002313.99,9002313.9901,.01,21,3,0)
If it is a workers comp claim, and any of these insurances appear,
"^DD",9002313.99,9002313.9901,.01,21,4,0)
that insurance should be the primary insurance for the claim.
"^DD",9002313.99,9002313.9901,.01,"DT")
3000418
"^DD",9002313.99,9002313.9902,0)
BILLING LOG FILE SUB-FIELD^^.04^4
"^DD",9002313.99,9002313.9902,0,"DT")
3000419
"^DD",9002313.99,9002313.9902,0,"IX","B",9002313.9902,.01)

"^DD",9002313.99,9002313.9902,0,"NM","BILLING LOG FILE")

"^DD",9002313.99,9002313.9902,0,"UP")
9002313.99
"^DD",9002313.99,9002313.9902,.01,0)
BILLING LOG FILE^F^^0;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.99,9002313.9902,.01,1,0)
^.1
"^DD",9002313.99,9002313.9902,.01,1,1,0)
9002313.9902^B
"^DD",9002313.99,9002313.9902,.01,1,1,1)
S ^BPS(9002313.99,DA(1),"BILLING LOG FILE","B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.9902,.01,1,1,2)
K ^BPS(9002313.99,DA(1),"BILLING LOG FILE","B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.9902,.01,3)
Answer must be 1-10 characters in length.
"^DD",9002313.99,9002313.9902,.01,21,0)
^^1^1^3000419^
"^DD",9002313.99,9002313.9902,.01,21,1,0)
Point to the ^TMP("ABSBPOSU",log file number,...)
"^DD",9002313.99,9002313.9902,.01,"DT")
3000419
"^DD",9002313.99,9002313.9902,.02,0)
DATE-TIME^D^^0;2^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.99,9002313.9902,.02,1,0)
^.1^^0
"^DD",9002313.99,9002313.9902,.02,21,0)
^^1^1^3000419^
"^DD",9002313.99,9002313.9902,.02,21,1,0)
The date-time the log file was written (start time)
"^DD",9002313.99,9002313.9902,.02,"DT")
3000419
"^DD",9002313.99,9002313.9902,.03,0)
STEP #^F^^0;3^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.99,9002313.9902,.03,3)
Answer must be 1-3 characters in length.
"^DD",9002313.99,9002313.9902,.03,21,0)
^^1^1^3000419^
"^DD",9002313.99,9002313.9902,.03,21,1,0)
BPSOSBn for step number n, in general.
"^DD",9002313.99,9002313.9902,.03,"DT")
3000419
"^DD",9002313.99,9002313.9902,.04,0)
DEBUGGING LOG^F^^0;4^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.99,9002313.9902,.04,3)
Answer must be 1-10 characters in length.
"^DD",9002313.99,9002313.9902,.04,21,0)
^^2^2^3000419^
"^DD",9002313.99,9002313.9902,.04,21,1,0)
Pointer to ^TMP("ABSBPOSU",*) of where the debugging log file is stored.
"^DD",9002313.99,9002313.9902,.04,21,2,0)
It's a verbose version of the regular log file.
"^DD",9002313.99,9002313.9902,.04,"DT")
3000419
"^DD",9002313.99,9002313.9903,0)
INS RULE ORDER SUB-FIELD^^.04^4
"^DD",9002313.99,9002313.9903,0,"DT")
3000818
"^DD",9002313.99,9002313.9903,0,"ID",.02)
S %I=Y,Y=$S('$D(^(0)):"",$D(^BPSF(9002313.94,+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(9002313.94,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",9002313.99,9002313.9903,0,"IX","B",9002313.9903,.01)

"^DD",9002313.99,9002313.9903,0,"NM","INS RULE ORDER")

"^DD",9002313.99,9002313.9903,0,"UP")
9002313.99
"^DD",9002313.99,9002313.9903,.01,0)
INS RULE ORDER^MNJ8,3^^0;1^K:+X'=X!(X>1000)!(X<1)!(X?.E1"."4N.N) X
"^DD",9002313.99,9002313.9903,.01,1,0)
^.1
"^DD",9002313.99,9002313.9903,.01,1,1,0)
9002313.9903^B
"^DD",9002313.99,9002313.9903,.01,1,1,1)
S ^BPS(9002313.99,DA(1),"INS RULES","B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.9903,.01,1,1,2)
K ^BPS(9002313.99,DA(1),"INS RULES","B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.9903,.01,3)
Type a Number between 1 and 1000, 3 Decimal Digits
"^DD",9002313.99,9002313.9903,.01,21,0)
^^1^1^3000818^
"^DD",9002313.99,9002313.9903,.01,21,1,0)
A list of insurance rules to be applied to the list of candidates.
"^DD",9002313.99,9002313.9903,.01,"DT")
3000818
"^DD",9002313.99,9002313.9903,.02,0)
INS RULE NAME^P9002313.94'^BPSF(9002313.94,^0;2^Q
"^DD",9002313.99,9002313.9903,.02,"DT")
3000818
"^DD",9002313.99,9002313.9903,.03,0)
INS RULE POINTS PLUS^NJ8,3^^0;3^K:+X'=X!(X>1000)!(X<0)!(X?.E1"."4N.N) X
"^DD",9002313.99,9002313.9903,.03,3)
Type a Number between 0 and 1000, 3 Decimal Digits
"^DD",9002313.99,9002313.9903,.03,"DT")
3000818
"^DD",9002313.99,9002313.9903,.04,0)
INS RULE POINTS MINUS^NJ8,3^^0;4^K:+X'=X!(X>1000)!(X<0)!(X?.E1"."4N.N) X
"^DD",9002313.99,9002313.9903,.04,3)
Type a Number between 0 and 1000, 3 Decimal Digits
"^DD",9002313.99,9002313.9903,.04,"DT")
3000818
"^DD",9002313.99,9002313.9904,0)
UNBILLABLE DRUG NAME SUB-FIELD^^.01^1
"^DD",9002313.99,9002313.9904,0,"DT")
3000914
"^DD",9002313.99,9002313.9904,0,"NM","UNBILLABLE DRUG NAME")

"^DD",9002313.99,9002313.9904,0,"UP")
9002313.99
"^DD",9002313.99,9002313.9904,.01,0)
UNBILLABLE DRUG NAME^WL^^0;1^Q
"^DD",9002313.99,9002313.9904,.01,21,0)
^^9^9^3000914^
"^DD",9002313.99,9002313.9904,.01,21,1,0)
A series of XECUTEs, given X = drug name (from the drug file)
"^DD",9002313.99,9002313.9904,.01,21,2,0)
and future X(1) = drug name from (where?),...
"^DD",9002313.99,9002313.9904,.01,21,3,0)
Sets $T = true if the drug is unbillable.
"^DD",9002313.99,9002313.9904,.01,21,4,0)
Example:  I X["ACETAMINOPHEN"&(X'["CODEINE")
"^DD",9002313.99,9002313.9904,.01,21,5,0)
This would say that any ACETAMINOPHEN is unbillable,
"^DD",9002313.99,9002313.9904,.01,21,6,0)
unless is has CODEINE in the name.
"^DD",9002313.99,9002313.9904,.01,21,7,0)
This rule applies to all insurers.  If an insurer has an exception,
"^DD",9002313.99,9002313.9904,.01,21,8,0)
then program the exception in the FSI INSURER file entry for that
"^DD",9002313.99,9002313.9904,.01,21,9,0)
insurer.  
"^DD",9002313.99,9002313.9904,.01,"DT")
3000914
"^DD",9002313.99,9002313.9905,0)
UNBILLABLE NDC # SUB-FIELD^^.01^1
"^DD",9002313.99,9002313.9905,0,"DT")
3000914
"^DD",9002313.99,9002313.9905,0,"IX","B",9002313.9905,.01)

"^DD",9002313.99,9002313.9905,0,"NM","UNBILLABLE NDC #")

"^DD",9002313.99,9002313.9905,0,"UP")
9002313.99
"^DD",9002313.99,9002313.9905,.01,0)
UNBILLABLE NDC #^MF^^0;1^K:$L(X)>11!($L(X)<11)!'(X?11N) X
"^DD",9002313.99,9002313.9905,.01,1,0)
^.1
"^DD",9002313.99,9002313.9905,.01,1,1,0)
9002313.9905^B
"^DD",9002313.99,9002313.9905,.01,1,1,1)
S ^BPS(9002313.99,DA(1),"UNBILLABLE NDC #","B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.9905,.01,1,1,2)
K ^BPS(9002313.99,DA(1),"UNBILLABLE NDC #","B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.9905,.01,3)
Answer must be 11 characters in length.
"^DD",9002313.99,9002313.9905,.01,21,0)
^^4^4^3000914^
"^DD",9002313.99,9002313.9905,.01,21,1,0)
NDC #s unbillable, regardless of insurance company.
"^DD",9002313.99,9002313.9905,.01,21,2,0)
If some insurer does cover this NDC #, the exception can be put
"^DD",9002313.99,9002313.9905,.01,21,3,0)
in the FSI INSURER file entry for this insurer, in the BILLABLE NDC # 
"^DD",9002313.99,9002313.9905,.01,21,4,0)
multiple.
"^DD",9002313.99,9002313.9905,.01,"DT")
3000914
"^DD",9002313.99,9002313.992271,0)
WO ARTYPE SUB-FIELD^^.01^1
"^DD",9002313.99,9002313.992271,0,"DT")
3000509
"^DD",9002313.99,9002313.992271,0,"IX","B",9002313.992271,.01)

"^DD",9002313.99,9002313.992271,0,"NM","WO ARTYPE")

"^DD",9002313.99,9002313.992271,0,"UP")
9002313.99
"^DD",9002313.99,9002313.992271,.01,0)
WO ARTYPE^MP9001626'^ABSBTYP(^0;1^Q
"^DD",9002313.99,9002313.992271,.01,1,0)
^.1
"^DD",9002313.99,9002313.992271,.01,1,1,0)
9002313.992271^B
"^DD",9002313.99,9002313.992271,.01,1,1,1)
S ^BPS(9002313.99,DA(1),"WRITEOFF-SCREEN ARTYPE","B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.992271,.01,1,1,2)
K ^BPS(9002313.99,DA(1),"WRITEOFF-SCREEN ARTYPE","B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.992271,.01,"DT")
3000509
"^DD",9002313.99,9002313.992273,0)
WO CLINIC SUB-FIELD^^.01^1
"^DD",9002313.99,9002313.992273,0,"DT")
3000509
"^DD",9002313.99,9002313.992273,0,"IX","B",9002313.992273,.01)

"^DD",9002313.99,9002313.992273,0,"NM","WO CLINIC")

"^DD",9002313.99,9002313.992273,0,"UP")
9002313.99
"^DD",9002313.99,9002313.992273,.01,0)
WO CLINIC^MP40.7'^DIC(40.7,^0;1^Q
"^DD",9002313.99,9002313.992273,.01,1,0)
^.1
"^DD",9002313.99,9002313.992273,.01,1,1,0)
9002313.992273^B
"^DD",9002313.99,9002313.992273,.01,1,1,1)
S ^BPS(9002313.99,DA(1),"WRITEOFF-SCREEN CLINIC","B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.992273,.01,1,1,2)
K ^BPS(9002313.99,DA(1),"WRITEOFF-SCREEN CLINIC","B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.992273,.01,"DT")
3000509
"^DD",9002313.99,9002313.992274,0)
WO DIAG SUB-FIELD^^.01^1
"^DD",9002313.99,9002313.992274,0,"DT")
3000509
"^DD",9002313.99,9002313.992274,0,"IX","B",9002313.992274,.01)

"^DD",9002313.99,9002313.992274,0,"NM","WO DIAG")

"^DD",9002313.99,9002313.992274,0,"UP")
9002313.99
"^DD",9002313.99,9002313.992274,.01,0)
WO DIAG^MP80'^ICD9(^0;1^Q
"^DD",9002313.99,9002313.992274,.01,1,0)
^.1
"^DD",9002313.99,9002313.992274,.01,1,1,0)
9002313.992274^B
"^DD",9002313.99,9002313.992274,.01,1,1,1)
S ^BPS(9002313.99,DA(1),"WRITEOFF-SCREEN DIAG","B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.992274,.01,1,1,2)
K ^BPS(9002313.99,DA(1),"WRITEOFF-SCREEN DIAG","B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.992274,.01,"DT")
3000509
"^DD",9002313.99,9002313.992279,0)
WO INSURER SUB-FIELD^^.01^1
"^DD",9002313.99,9002313.992279,0,"DT")
3000509
"^DD",9002313.99,9002313.992279,0,"IX","B",9002313.992279,.01)

"^DD",9002313.99,9002313.992279,0,"NM","WO INSURER")

"^DD",9002313.99,9002313.992279,0,"UP")
9002313.99
"^DD",9002313.99,9002313.992279,.01,0)
WO INSURER^MP9999999.18'^AUTNINS(^0;1^Q
"^DD",9002313.99,9002313.992279,.01,1,0)
^.1
"^DD",9002313.99,9002313.992279,.01,1,1,0)
9002313.992279^B
"^DD",9002313.99,9002313.992279,.01,1,1,1)
S ^BPS(9002313.99,DA(1),"WRITEOFF-SCREEN INSURER","B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.992279,.01,1,1,2)
K ^BPS(9002313.99,DA(1),"WRITEOFF-SCREEN INSURER","B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.992279,.01,"DT")
3000509
"^DD",9002313.99,9002313.992388,0)
WRITE OFF INSURER SUB-FIELD^^.01^1
"^DD",9002313.99,9002313.992388,0,"DT")
3000420
"^DD",9002313.99,9002313.992388,0,"IX","B",9002313.992388,.01)

"^DD",9002313.99,9002313.992388,0,"NM","WRITE OFF INSURER")

"^DD",9002313.99,9002313.992388,0,"UP")
9002313.99
"^DD",9002313.99,9002313.992388,.01,0)
WRITE OFF INSURER^MP9999999.18'^AUTNINS(^0;1^Q
"^DD",9002313.99,9002313.992388,.01,1,0)
^.1
"^DD",9002313.99,9002313.992388,.01,1,1,0)
9002313.992388^B
"^DD",9002313.99,9002313.992388,.01,1,1,1)
S ^BPS(9002313.99,DA(1),"WRITE OFF INSURER","B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.992388,.01,1,1,2)
K ^BPS(9002313.99,DA(1),"WRITE OFF INSURER","B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.992388,.01,21,0)
^^3^3^3000420^
"^DD",9002313.99,9002313.992388,.01,21,1,0)
A list of "insurers" which are really code words for automatic write-offs.
"^DD",9002313.99,9002313.992388,.01,21,2,0)
Examples from Mt. Edgecumbe include GREAT WEST LIFE/SEARHC (employees)
"^DD",9002313.99,9002313.992388,.01,21,3,0)
and N/B PREGNANCY (non-beneficiary carrying a beneficiary-to-be.)
"^DD",9002313.99,9002313.992388,.01,"DT")
3000420
"^DD",9002313.99,9002313.992389,0)
WRITE OFF SELF PAY SUB-FIELD^^.01^1
"^DD",9002313.99,9002313.992389,0,"DT")
3000420
"^DD",9002313.99,9002313.992389,0,"IX","B",9002313.992389,.01)

"^DD",9002313.99,9002313.992389,0,"NM","WRITE OFF SELF PAY")

"^DD",9002313.99,9002313.992389,0,"UP")
9002313.99
"^DD",9002313.99,9002313.992389,.01,0)
WRITE OFF SELF PAY^MP9999999.25'^AUTTBEN(^0;1^Q
"^DD",9002313.99,9002313.992389,.01,1,0)
^.1
"^DD",9002313.99,9002313.992389,.01,1,1,0)
9002313.992389^B
"^DD",9002313.99,9002313.992389,.01,1,1,1)
S ^BPS(9002313.99,DA(1),"WRITE OFF SELF PAY","B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.992389,.01,1,1,2)
K ^BPS(9002313.99,DA(1),"WRITE OFF SELF PAY","B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.992389,.01,3)
Answer must be 1-10 characters in length.
"^DD",9002313.99,9002313.992389,.01,21,0)
^^2^2^3000420^
"^DD",9002313.99,9002313.992389,.01,21,1,0)
For SELF PAY, if the patient is a beneficiary, the account is automatically
"^DD",9002313.99,9002313.992389,.01,21,2,0)
written off (well, actually placed on the fake pre-bill list.)
"^DD",9002313.99,9002313.992389,.01,"DT")
3000420
"^DIC",9002313.02,9002313.02,0)
BPS CLAIMS^9002313.02
"^DIC",9002313.02,9002313.02,0,"GL")
^BPSC(
"^DIC",9002313.02,9002313.02,"%",0)
^1.005^1^1
"^DIC",9002313.02,9002313.02,"%",1,0)
BPS
"^DIC",9002313.02,9002313.02,"%","B","ABSP",1)

"^DIC",9002313.02,9002313.02,"%","B","BPS",1)

"^DIC",9002313.02,9002313.02,"%D",0)
^^7^7^3031216^
"^DIC",9002313.02,9002313.02,"%D",1,0)
Intermediate form of claims.  Fields are stored in formatted form.
"^DIC",9002313.02,9002313.02,"%D",2,0)
Raw packet is stored, too.  
"^DIC",9002313.02,9002313.02,"%D",3,0)
 
"^DIC",9002313.02,9002313.02,"%D",4,0)
Most fields are in Free Text format to accommodate NCPDP Standard
"^DIC",9002313.02,9002313.02,"%D",5,0)
formatting criteria and required field lengths.  Fields other than those
"^DIC",9002313.02,9002313.02,"%D",6,0)
with decimals in the number correlate directly to the field numbers
"^DIC",9002313.02,9002313.02,"%D",7,0)
supplied in the NCPDP Data Dictionary.
"^DIC",9002313.02,"B","BPS CLAIMS",9002313.02)

"^DIC",9002313.03,9002313.03,0)
BPS RESPONSES^9002313.03P
"^DIC",9002313.03,9002313.03,0,"GL")
^BPSR(
"^DIC",9002313.03,9002313.03,"%",0)
^1.005^1^1
"^DIC",9002313.03,9002313.03,"%",1,0)
BPS
"^DIC",9002313.03,9002313.03,"%","B","ABSP",1)

"^DIC",9002313.03,9002313.03,"%","B","BPS",1)

"^DIC",9002313.03,9002313.03,"%D",0)
^^3^3^3020809^^^^
"^DIC",9002313.03,9002313.03,"%D",1,0)
Intermediate form of responses to claims.
"^DIC",9002313.03,9002313.03,"%D",2,0)
Data is stored in formatted form, as received from insurer.
"^DIC",9002313.03,9002313.03,"%D",3,0)
Raw data packet may also be present.
"^DIC",9002313.03,"B","BPS RESPONSES",9002313.03)

"^DIC",9002313.1,9002313.1,0)
BPS COMBINED INSURANCE^9002313.1P
"^DIC",9002313.1,9002313.1,0,"GL")
^BPSCOMB(
"^DIC",9002313.1,9002313.1,"%",0)
^1.005^1^1
"^DIC",9002313.1,9002313.1,"%",1,0)
BPS
"^DIC",9002313.1,9002313.1,"%","B","ABSP",1)

"^DIC",9002313.1,9002313.1,"%","B","BPS",1)

"^DIC",9002313.1,9002313.1,"%D",0)
^^5^5^3010205^
"^DIC",9002313.1,9002313.1,"%D",1,0)
Temporarily gather insurance data into a common global
"^DIC",9002313.1,9002313.1,"%D",2,0)
to facilitate automatic insurance selection.  A copy of the
"^DIC",9002313.1,9002313.1,"%D",3,0)
^ABSBCOMB file as found in ILC A/R Version 2.   The only reason
"^DIC",9002313.1,9002313.1,"%D",4,0)
a separate file is kept here is because of namespacing.
"^DIC",9002313.1,9002313.1,"%D",5,0)
Some reworking will be needed for BBM package.
"^DIC",9002313.1,"B","BPS COMBINED INSURANCE",9002313.1)

"^DIC",9002313.21,9002313.21,0)
BPS NCPDP PROFESSIONAL SERVICE CODE^9002313.21
"^DIC",9002313.21,9002313.21,0,"GL")
^BPS(9002313.21,
"^DIC",9002313.21,9002313.21,"%",0)
^1.005^^0
"^DIC",9002313.21,9002313.21,"%D",0)
^^3^3^3050701^
"^DIC",9002313.21,9002313.21,"%D",1,0)
This file is used to store the possible NCPDP PROFESSIONAL SERVICE CODE 
"^DIC",9002313.21,9002313.21,"%D",2,0)
values, which are used for overriding DUR rejects.  No local changes 
"^DIC",9002313.21,9002313.21,"%D",3,0)
should ever be made to this file.
"^DIC",9002313.21,"B","BPS NCPDP PROFESSIONAL SERVICE CODE",9002313.21)

"^DIC",9002313.22,9002313.22,0)
BPS NCPDP RESULT OF SERVICE CODE^9002313.22
"^DIC",9002313.22,9002313.22,0,"GL")
^BPS(9002313.22,
"^DIC",9002313.22,9002313.22,"%",0)
^1.005^^0
"^DIC",9002313.22,9002313.22,"%D",0)
^^4^4^3050701^
"^DIC",9002313.22,9002313.22,"%D",1,0)
This file is used to store the possible NCPDP RESULT OF SERVICE CODE 
"^DIC",9002313.22,9002313.22,"%D",2,0)
values, which are used for overriding DUR rejects.  No
"^DIC",9002313.22,9002313.22,"%D",3,0)
local changes should
"^DIC",9002313.22,9002313.22,"%D",4,0)
ever be made to this file.
"^DIC",9002313.22,"B","BPS NCPDP RESULT OF SERVICE CODE",9002313.22)

"^DIC",9002313.23,9002313.23,0)
BPS NCPDP REASON FOR SERVICE CODE^9002313.23
"^DIC",9002313.23,9002313.23,0,"GL")
^BPS(9002313.23,
"^DIC",9002313.23,9002313.23,"%",0)
^1.005^^0
"^DIC",9002313.23,9002313.23,"%D",0)
^^3^3^3050701^
"^DIC",9002313.23,9002313.23,"%D",1,0)
This file is used to store the possible NCPDP REASON FOR SERVICE CODE 
"^DIC",9002313.23,9002313.23,"%D",2,0)
values, which are used for overriding DUR rejects.  No local changes 
"^DIC",9002313.23,9002313.23,"%D",3,0)
should ever be made to this file.
"^DIC",9002313.23,"B","BPS NCPDP REASON FOR SERVICE CODE",9002313.23)

"^DIC",9002313.24,9002313.24,0)
BPS NCPDP DAW CODE^9002313.24
"^DIC",9002313.24,9002313.24,0,"GL")
^BPS(9002313.24,
"^DIC",9002313.24,9002313.24,"%",0)
^1.005^^0
"^DIC",9002313.24,9002313.24,"%D",0)
^^3^3^3050701^
"^DIC",9002313.24,9002313.24,"%D",1,0)
This file is used to store NCPDP DAW (Dispense As Written) codes, which 
"^DIC",9002313.24,9002313.24,"%D",2,0)
are used for prescription electronic claim transmission to third party 
"^DIC",9002313.24,9002313.24,"%D",3,0)
payers.  No local changes should ever be made to this file.
"^DIC",9002313.24,"B","BPS NCPDP DAW CODE",9002313.24)

"^DIC",9002313.31,9002313.31,0)
BPS CERTIFICATION^9002313.31
"^DIC",9002313.31,9002313.31,0,"GL")
^BPS(9002313.31,
"^DIC",9002313.31,9002313.31,"%",0)
^1.005^1^1
"^DIC",9002313.31,9002313.31,"%",1,0)
BPS
"^DIC",9002313.31,9002313.31,"%","B","ABSP",1)

"^DIC",9002313.31,9002313.31,"%","B","BPS",1)

"^DIC",9002313.31,9002313.31,"%D",0)
^^4^4^3010205^^
"^DIC",9002313.31,9002313.31,"%D",1,0)
Data for development use in certifying software when required by
"^DIC",9002313.31,9002313.31,"%D",2,0)
switches and claims end processors.  
"^DIC",9002313.31,9002313.31,"%D",3,0)
Also contains test claim used by MGR/TEST option.
"^DIC",9002313.31,9002313.31,"%D",4,0)
This file is completely overwritten by installation.
"^DIC",9002313.31,"B","BPS CERTIFICATION",9002313.31)

"^DIC",9002313.4,9002313.4,0)
BPS INSURER^9002313.4P
"^DIC",9002313.4,9002313.4,0,"GL")
^BPSEI(
"^DIC",9002313.4,9002313.4,"%",0)
^1.005^1^1
"^DIC",9002313.4,9002313.4,"%",1,0)
BPS
"^DIC",9002313.4,9002313.4,"%","B","ABSP",1)

"^DIC",9002313.4,9002313.4,"%","B","BPS",1)

"^DIC",9002313.4,9002313.4,"%D",0)
^^3^3^3010205^
"^DIC",9002313.4,9002313.4,"%D",1,0)
Insurers for whom claims are being sent electronically.
"^DIC",9002313.4,9002313.4,"%D",2,0)
Various other insurer-specific, BPS-specific parameters.
"^DIC",9002313.4,9002313.4,"%D",3,0)
DINUM'd to ^AUTNINS.
"^DIC",9002313.4,"B","BPS INSURER",9002313.4)

"^DIC",9002313.51,9002313.51,0)
BPS DATA INPUT^9002313.51
"^DIC",9002313.51,9002313.51,0,"GL")
^BPS(9002313.51,
"^DIC",9002313.51,9002313.51,"%",0)
^1.005^1^1
"^DIC",9002313.51,9002313.51,"%",1,0)
BPS
"^DIC",9002313.51,9002313.51,"%","B","ABSP",1)

"^DIC",9002313.51,9002313.51,"%","B","BPS",1)

"^DIC",9002313.51,9002313.51,"%D",0)
^^4^4^3010205^^^
"^DIC",9002313.51,9002313.51,"%D",1,0)
Data input.  Used by Screen Manager; routines BPSOSI* primarily.
"^DIC",9002313.51,9002313.51,"%D",2,0)
BPSOSRX calls and old-style data input also manage to find their way
"^DIC",9002313.51,9002313.51,"%D",3,0)
into this file - it's one standard pathway through which all data arrives
"^DIC",9002313.51,9002313.51,"%D",4,0)
in Point of Sale.
"^DIC",9002313.51,"B","BPS DATA INPUT",9002313.51)

"^DIC",9002313.511,9002313.511,0)
BPS NCPDP OVERRIDE^9002313.511
"^DIC",9002313.511,9002313.511,0,"GL")
^BPS(9002313.511,
"^DIC",9002313.511,9002313.511,"%",0)
^1.005^2^2
"^DIC",9002313.511,9002313.511,"%",1,0)
BPS
"^DIC",9002313.511,9002313.511,"%",2,0)
PS
"^DIC",9002313.511,9002313.511,"%","B","ABSP",1)

"^DIC",9002313.511,9002313.511,"%","B","BPS",1)

"^DIC",9002313.511,9002313.511,"%","B","PS",2)

"^DIC",9002313.511,9002313.511,"%D",0)
^^2^2^3010205^^^
"^DIC",9002313.511,9002313.511,"%D",1,0)
More input.  Override of specific NCPDP fields.
"^DIC",9002313.511,9002313.511,"%D",2,0)
BPSOSO* routines (letter O)
"^DIC",9002313.511,"B","BPS NCPDP OVERRIDE",9002313.511)

"^DIC",9002313.515,9002313.515,0)
BPS INPUT USER PREF^9002313.515
"^DIC",9002313.515,9002313.515,0,"GL")
^BPS(9002313.515,
"^DIC",9002313.515,9002313.515,"%",0)
^1.005^1^1
"^DIC",9002313.515,9002313.515,"%",1,0)
BPS
"^DIC",9002313.515,9002313.515,"%","B","ABSP",1)

"^DIC",9002313.515,9002313.515,"%","B","BPS",1)

"^DIC",9002313.515,9002313.515,"%D",0)
^^2^2^3010205^^
"^DIC",9002313.515,9002313.515,"%D",1,0)
User preferences for certain operations, especially Screenman input.
"^DIC",9002313.515,9002313.515,"%D",2,0)
Seldom used.
"^DIC",9002313.515,"B","BPS INPUT USER PREF",9002313.515)

"^DIC",9002313.516,9002313.516,0)
BPS ORIGIN OF INPUT^9002313.516
"^DIC",9002313.516,9002313.516,0,"GL")
^BPS(9002313.516,
"^DIC",9002313.516,9002313.516,"%",0)
^1.005^1^1
"^DIC",9002313.516,9002313.516,"%",1,0)
BPS
"^DIC",9002313.516,9002313.516,"%","B","ABSP",1)

"^DIC",9002313.516,9002313.516,"%","B","BPS",1)

"^DIC",9002313.516,9002313.516,"%D",0)
^^2^2^3010205^^
"^DIC",9002313.516,9002313.516,"%D",1,0)
Codes used in 9002313.59, 9002313.57, 9002313.51 to describe where
"^DIC",9002313.516,9002313.516,"%D",2,0)
the input came from.  This file is overwritten by installation.
"^DIC",9002313.516,"B","BPS ORIGIN OF INPUT",9002313.516)

"^DIC",9002313.53,9002313.53,0)
BPS PRICING TABLES^9002313.53
"^DIC",9002313.53,9002313.53,0,"GL")
^BPS(9002313.53,
"^DIC",9002313.53,9002313.53,"%",0)
^1.005^1^1
"^DIC",9002313.53,9002313.53,"%",1,0)
BPS
"^DIC",9002313.53,9002313.53,"%","B","ABSP",1)

"^DIC",9002313.53,9002313.53,"%","B","BPS",1)

"^DIC",9002313.53,9002313.53,"%D",0)
^^4^4^3010205^
"^DIC",9002313.53,9002313.53,"%D",1,0)
Different pricing policies can be maintained for different insurers.
"^DIC",9002313.53,9002313.53,"%D",2,0)
`1 is always named STANDARD and is placed there by installation, originally.
"^DIC",9002313.53,9002313.53,"%D",3,0)
Site may create more.  STANDARD is not changed by upgrade (that is, no
"^DIC",9002313.53,9002313.53,"%D",4,0)
overwriting happens.)
"^DIC",9002313.53,"B","BPS PRICING TABLES",9002313.53)

"^DIC",9002313.55,9002313.55,0)
BPS DIALOUT^9002313.55
"^DIC",9002313.55,9002313.55,0,"GL")
^BPS(9002313.55,
"^DIC",9002313.55,9002313.55,"%",0)
^1.005^1^1
"^DIC",9002313.55,9002313.55,"%",1,0)
BPS
"^DIC",9002313.55,9002313.55,"%","B","BPS",1)

"^DIC",9002313.55,9002313.55,"%D",0)
^^7^7^3060127^
"^DIC",9002313.55,9002313.55,"%D",1,0)
This table is a subset of an original table used by IHS.  For IHS, the 
"^DIC",9002313.55,9002313.55,"%D",2,0)
table was used to set up parameters and track activity for their modem
"^DIC",9002313.55,9002313.55,"%D",3,0)
connections.  The VA needs the table defined and the Dialout Name (.01) 
"^DIC",9002313.55,9002313.55,"%D",4,0)
field set in order to ensure entries on the transmit queue are transmitted
"^DIC",9002313.55,9002313.55,"%D",5,0)
to the payer.  The only value in this table should be "1VA".  No local
"^DIC",9002313.55,9002313.55,"%D",6,0)
changes should ever be made to this file.  In addition, other tables 
"^DIC",9002313.55,9002313.55,"%D",7,0)
should not point to this file as it may be deleted in phase IV of ECME.
"^DIC",9002313.55,"B","BPS DIALOUT",9002313.55)

"^DIC",9002313.56,9002313.56,0)
BPS PHARMACIES^9002313.56
"^DIC",9002313.56,9002313.56,0,"GL")
^BPS(9002313.56,
"^DIC",9002313.56,9002313.56,"%",0)
^1.005^1^1
"^DIC",9002313.56,9002313.56,"%",1,0)
BPS
"^DIC",9002313.56,9002313.56,"%","B","ABSP",1)

"^DIC",9002313.56,9002313.56,"%","B","BPS",1)

"^DIC",9002313.56,9002313.56,"%D",0)
^^2^2^3010205^^^
"^DIC",9002313.56,9002313.56,"%D",1,0)
Pharmacy-specific data -- NCPDP #, default DEA #, etc.
"^DIC",9002313.56,9002313.56,"%D",2,0)
One BPS PHARMACY has a list of one or more OUTPATIENT SITES (file 59)
"^DIC",9002313.56,"B","BPS PHARMACIES",9002313.56)

"^DIC",9002313.57,9002313.57,0)
BPS LOG OF TRANSACTIONS^9002313.57
"^DIC",9002313.57,9002313.57,0,"GL")
^BPSTL(
"^DIC",9002313.57,9002313.57,"%",0)
^1.005^1^1
"^DIC",9002313.57,9002313.57,"%",1,0)
BPS
"^DIC",9002313.57,9002313.57,"%","B","ABSP",1)

"^DIC",9002313.57,9002313.57,"%","B","BPS",1)

"^DIC",9002313.57,9002313.57,"%D",0)
^^2^2^3001120^^^
"^DIC",9002313.57,9002313.57,"%D",1,0)
A copy of 9002313.59.  As each transaction completes, a snapshot of 
"^DIC",9002313.57,9002313.57,"%D",2,0)
9002313.59 entry is placed here in 9002313.57.
"^DIC",9002313.57,"B","BPS LOG OF TRANSACTIONS",9002313.57)

"^DIC",9002313.58,9002313.58,0)
BPS STATISTICS^9002313.58
"^DIC",9002313.58,9002313.58,0,"GL")
^BPSECX("S",
"^DIC",9002313.58,9002313.58,"%",0)
^1.005^1^1
"^DIC",9002313.58,9002313.58,"%",1,0)
BPS
"^DIC",9002313.58,9002313.58,"%","B","ABSP",1)

"^DIC",9002313.58,9002313.58,"%","B","BPS",1)

"^DIC",9002313.58,9002313.58,"%D",0)
^^1^1^3010305^^^^
"^DIC",9002313.58,9002313.58,"%D",1,0)
Statistics, as displayed by List Manager and ^BPSOS2.
"^DIC",9002313.58,"B","BPS STATISTICS",9002313.58)

"^DIC",9002313.59,9002313.59,0)
BPS TRANSACTION^9002313.59
"^DIC",9002313.59,9002313.59,0,"GL")
^BPST(
"^DIC",9002313.59,9002313.59,"%",0)
^1.005^1^1
"^DIC",9002313.59,9002313.59,"%",1,0)
BPS
"^DIC",9002313.59,9002313.59,"%","B","ABSP",1)

"^DIC",9002313.59,9002313.59,"%","B","BPS",1)

"^DIC",9002313.59,9002313.59,"%D",0)
^^2^2^3001120^^^
"^DIC",9002313.59,9002313.59,"%D",1,0)
Transactions in progress.  When complete (status 99), a copy of the
"^DIC",9002313.59,9002313.59,"%D",2,0)
record is placed in 9002313.57.
"^DIC",9002313.59,"B","BPS TRANSACTION",9002313.59)

"^DIC",9002313.61,9002313.61,0)
BPS REPORT MASTER^9002313.61
"^DIC",9002313.61,9002313.61,0,"GL")
^BPSECX("RPT",
"^DIC",9002313.61,9002313.61,"%",0)
^1.005^1^1
"^DIC",9002313.61,9002313.61,"%",1,0)
BPS
"^DIC",9002313.61,9002313.61,"%","B","ABSP",1)

"^DIC",9002313.61,9002313.61,"%","B","BPS",1)

"^DIC",9002313.61,9002313.61,"%D",0)
^1.001^2^2^3031208^^^
"^DIC",9002313.61,9002313.61,"%D",1,0)
Ties together pointers to the prescription/fill and the latest transaction
"^DIC",9002313.61,9002313.61,"%D",2,0)
for the fill - for easy Fileman report writing.
"^DIC",9002313.61,"B","BPS REPORT MASTER",9002313.61)

"^DIC",9002313.81,9002313.81,0)
BPS TRANSLATE 9999999.36^9002313.81
"^DIC",9002313.81,9002313.81,0,"GL")
^BPSF(9002313.81,
"^DIC",9002313.81,9002313.81,"%",0)
^1.005^1^1
"^DIC",9002313.81,9002313.81,"%",1,0)
BPS
"^DIC",9002313.81,9002313.81,"%","B","ABSP",1)

"^DIC",9002313.81,9002313.81,"%","B","BPS",1)

"^DIC",9002313.81,9002313.81,"%D",0)
^^2^2^3010406^
"^DIC",9002313.81,9002313.81,"%D",1,0)
Translation of relationship names (which match those in 9999999.36,
"^DIC",9002313.81,9002313.81,"%D",2,0)
^AUTTRLSH) to relationship code for claim messages.
"^DIC",9002313.81,"B","BPS TRANSLATE 9999999.36",9002313.81)

"^DIC",9002313.82103,9002313.82103,0)
BPS NCPDP FIELD 103^9002313.82103
"^DIC",9002313.82103,9002313.82103,0,"GL")
^BPSF(9002313.82103,
"^DIC",9002313.82103,9002313.82103,"%",0)
^1.005^1^1
"^DIC",9002313.82103,9002313.82103,"%",1,0)
BPS
"^DIC",9002313.82103,9002313.82103,"%","B","ABSP",1)

"^DIC",9002313.82103,9002313.82103,"%","B","BPS",1)

"^DIC",9002313.82103,9002313.82103,"%D",0)
^^30^30^3010409^^^^
"^DIC",9002313.82103,9002313.82103,"%D",1,0)
Values for NCPDP field 103, Transaction Code.
"^DIC",9002313.82103,9002313.82103,"%D",2,0)
~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~
"^DIC",9002313.82103,9002313.82103,"%D",3,0)
GENERAL REMARK ABOUT THE 9002313.82*** FILES:
"^DIC",9002313.82103,9002313.82103,"%D",4,0)
They're used much like a Fileman Set of Codes field might be used.
"^DIC",9002313.82103,9002313.82103,"%D",5,0)
So why aren't they implemented as a Set of Codes?
"^DIC",9002313.82103,9002313.82103,"%D",6,0)
1) Sometimes the same field appears in more than one file.
"^DIC",9002313.82103,9002313.82103,"%D",7,0)
   We avoid maintaining the same set of codes multiple times.
"^DIC",9002313.82103,9002313.82103,"%D",8,0)
2) Quantity of data - some of these fields would have to be chopped
"^DIC",9002313.82103,9002313.82103,"%D",9,0)
   and abbreviated in a big way in order to fit in one global data.
"^DIC",9002313.82103,9002313.82103,"%D",10,0)
   dictionary node.
"^DIC",9002313.82103,9002313.82103,"%D",11,0)
3) Consistency - we nevertheless want to hand all of these NCPDP fields 
"^DIC",9002313.82103,9002313.82103,"%D",12,0)
   with set of codes-like values in a consistent way, so even the ones 
"^DIC",9002313.82103,9002313.82103,"%D",13,0)
   which don't fall under the conditions 1) or 2) are handled this way.
"^DIC",9002313.82103,9002313.82103,"%D",14,0)
4) Future extensions / expansions, which are at the whim of NCPDP,
"^DIC",9002313.82103,9002313.82103,"%D",15,0)
   can be handled with no change to the Point of Sale application.
"^DIC",9002313.82103,9002313.82103,"%D",16,0)
5) Backwards compatibility - many fields in 9002313.02 and .03 are 
"^DIC",9002313.82103,9002313.82103,"%D",17,0)
   already implemented as free text fields, sometimes with a two-byte
"^DIC",9002313.82103,9002313.82103,"%D",18,0)
   field ID prefixed.  It could get messy if we had to change them.
"^DIC",9002313.82103,9002313.82103,"%D",19,0)
~ ~ ~ ~ ~
"^DIC",9002313.82103,9002313.82103,"%D",20,0)
Now, what we might do in future development is to implement certain 
"^DIC",9002313.82103,9002313.82103,"%D",21,0)
fields as pointers to these files.
"^DIC",9002313.82103,9002313.82103,"%D",22,0)
~ ~ ~ ~ ~
"^DIC",9002313.82103,9002313.82103,"%D",23,0)
Special note for Version 1.0:
"^DIC",9002313.82103,9002313.82103,"%D",24,0)
     These fields are not used by any options reachable by users.
"^DIC",9002313.82103,9002313.82103,"%D",25,0)
     However, they are usable in Join-type pointers with certain computed
"^DIC",9002313.82103,9002313.82103,"%D",26,0)
     fields in 9002313.57 BPS TRANSACTIONS, and as such, may be of
"^DIC",9002313.82103,9002313.82103,"%D",27,0)
     interest in developing site-specific receipts now, and as a 
"^DIC",9002313.82103,9002313.82103,"%D",28,0)
     platform for developing a general receipt capability for the next
"^DIC",9002313.82103,9002313.82103,"%D",29,0)
     version.
"^DIC",9002313.82103,9002313.82103,"%D",30,0)
~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 
"^DIC",9002313.82103,"B","BPS NCPDP FIELD 103",9002313.82103)

"^DIC",9002313.82305,9002313.82305,0)
BPS NCPDP FIELD 305^9002313.82305
"^DIC",9002313.82305,9002313.82305,0,"GL")
^BPSF(9002313.82305,
"^DIC",9002313.82305,9002313.82305,"%",0)
^1.005^1^1
"^DIC",9002313.82305,9002313.82305,"%",1,0)
BPS
"^DIC",9002313.82305,9002313.82305,"%","B","ABSP",1)

"^DIC",9002313.82305,9002313.82305,"%","B","BPS",1)

"^DIC",9002313.82305,9002313.82305,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82305,9002313.82305,"%D",1,0)
Values for NCPDP field 305, Sex Code.
"^DIC",9002313.82305,"B","BPS NCPDP FIELD 305",9002313.82305)

"^DIC",9002313.82306,9002313.82306,0)
BPS NCPDP FIELD 306^9002313.82306
"^DIC",9002313.82306,9002313.82306,0,"GL")
^BPSF(9002313.82306,
"^DIC",9002313.82306,9002313.82306,"%",0)
^1.005^1^1
"^DIC",9002313.82306,9002313.82306,"%",1,0)
BPS
"^DIC",9002313.82306,9002313.82306,"%","B","ABSP",1)

"^DIC",9002313.82306,9002313.82306,"%","B","BPS",1)

"^DIC",9002313.82306,9002313.82306,"%D",0)
^^1^1^3010413^
"^DIC",9002313.82306,9002313.82306,"%D",1,0)
Values for NCPDP field 306, RELATIONSHIP CODE.
"^DIC",9002313.82306,"B","BPS NCPDP FIELD 306",9002313.82306)

"^DIC",9002313.82307,9002313.82307,0)
BPS NCPDP FIELD 307^9002313.82307
"^DIC",9002313.82307,9002313.82307,0,"GL")
^BPSF(9002313.82307,
"^DIC",9002313.82307,9002313.82307,"%",0)
^1.005^1^1
"^DIC",9002313.82307,9002313.82307,"%",1,0)
BPS
"^DIC",9002313.82307,9002313.82307,"%","B","ABSP",1)

"^DIC",9002313.82307,9002313.82307,"%","B","BPS",1)

"^DIC",9002313.82307,9002313.82307,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82307,9002313.82307,"%D",1,0)
Values for NCPDP field 307, Customer Location.
"^DIC",9002313.82307,"B","BPS NCPDP FIELD 307",9002313.82307)

"^DIC",9002313.82308,9002313.82308,0)
BPS NCPDP FIELD 308^9002313.82308
"^DIC",9002313.82308,9002313.82308,0,"GL")
^BPSF(9002313.82308,
"^DIC",9002313.82308,9002313.82308,"%",0)
^1.005^1^1
"^DIC",9002313.82308,9002313.82308,"%",1,0)
BPS
"^DIC",9002313.82308,9002313.82308,"%","B","ABSP",1)

"^DIC",9002313.82308,9002313.82308,"%","B","BPS",1)

"^DIC",9002313.82308,9002313.82308,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82308,9002313.82308,"%D",1,0)
Values for NCPDP field 308, Other Coverage Code
"^DIC",9002313.82308,"B","BPS NCPDP FIELD 308",9002313.82308)

"^DIC",9002313.82309,9002313.82309,0)
BPS NCPDP FIELD 309^9002313.82309
"^DIC",9002313.82309,9002313.82309,0,"GL")
^BPSF(9002313.82309,
"^DIC",9002313.82309,9002313.82309,"%",0)
^1.005^1^1
"^DIC",9002313.82309,9002313.82309,"%",1,0)
BPS
"^DIC",9002313.82309,9002313.82309,"%","B","ABSP",1)

"^DIC",9002313.82309,9002313.82309,"%","B","BPS",1)

"^DIC",9002313.82309,9002313.82309,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82309,9002313.82309,"%D",1,0)
Values for NCPDP field 309, Eligibility Clarification Code.
"^DIC",9002313.82309,"B","BPS NCPDP FIELD 309",9002313.82309)

"^DIC",9002313.82406,9002313.82406,0)
BPS NCPDP FIELD 406^9002313.82406
"^DIC",9002313.82406,9002313.82406,0,"GL")
^BPSF(9002313.82406,
"^DIC",9002313.82406,9002313.82406,"%",0)
^1.005^1^1
"^DIC",9002313.82406,9002313.82406,"%",1,0)
BPS
"^DIC",9002313.82406,9002313.82406,"%","B","ABSP",1)

"^DIC",9002313.82406,9002313.82406,"%","B","BPS",1)

"^DIC",9002313.82406,9002313.82406,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82406,9002313.82406,"%D",1,0)
Values for NCPDP field 406, Compound Code
"^DIC",9002313.82406,"B","BPS NCPDP FIELD 406",9002313.82406)

"^DIC",9002313.82408,9002313.82408,0)
BPS NCPDP FIELD 408^9002313.82408
"^DIC",9002313.82408,9002313.82408,0,"GL")
^BPSF(9002313.82408,
"^DIC",9002313.82408,9002313.82408,"%",0)
^1.005^1^1
"^DIC",9002313.82408,9002313.82408,"%",1,0)
BPS
"^DIC",9002313.82408,9002313.82408,"%","B","ABSP",1)

"^DIC",9002313.82408,9002313.82408,"%","B","BPS",1)

"^DIC",9002313.82408,9002313.82408,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82408,9002313.82408,"%D",1,0)
Values for NCPDP field 408, Dispense as Written (DAW) / Product Selection Code.
"^DIC",9002313.82408,"B","BPS NCPDP FIELD 408",9002313.82408)

"^DIC",9002313.82416,9002313.82416,0)
BPS NCPDP FIELD 416^9002313.82416
"^DIC",9002313.82416,9002313.82416,0,"GL")
^BPSF(9002313.82416,
"^DIC",9002313.82416,9002313.82416,"%",0)
^1.005^1^1
"^DIC",9002313.82416,9002313.82416,"%",1,0)
BPS
"^DIC",9002313.82416,9002313.82416,"%","B","ABSP",1)

"^DIC",9002313.82416,9002313.82416,"%","B","BPS",1)

"^DIC",9002313.82416,9002313.82416,"%D",0)
^^2^2^3010409^
"^DIC",9002313.82416,9002313.82416,"%D",1,0)
Values for the leading digit of NCPDP field 416,
"^DIC",9002313.82416,9002313.82416,"%D",2,0)
PAMC Code and Number.
"^DIC",9002313.82416,"B","BPS NCPDP FIELD 416",9002313.82416)

"^DIC",9002313.82419,9002313.82419,0)
BPS NCPDP FIELD 419^9002313.82419
"^DIC",9002313.82419,9002313.82419,0,"GL")
^BPSF(9002313.82419,
"^DIC",9002313.82419,9002313.82419,"%",0)
^1.005^1^1
"^DIC",9002313.82419,9002313.82419,"%",1,0)
BPS
"^DIC",9002313.82419,9002313.82419,"%","B","ABSP",1)

"^DIC",9002313.82419,9002313.82419,"%","B","BPS",1)

"^DIC",9002313.82419,9002313.82419,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82419,9002313.82419,"%D",1,0)
Values for NCPDP field 419, Prescription Origin Code.
"^DIC",9002313.82419,"B","BPS NCPDP FIELD 419",9002313.82419)

"^DIC",9002313.8242,9002313.8242,0)
BPS NCPDP FIELD 420^9002313.8242
"^DIC",9002313.8242,9002313.8242,0,"GL")
^BPSF(9002313.8242,
"^DIC",9002313.8242,9002313.8242,"%",0)
^1.005^1^1
"^DIC",9002313.8242,9002313.8242,"%",1,0)
BPS
"^DIC",9002313.8242,9002313.8242,"%","B","ABSP",1)

"^DIC",9002313.8242,9002313.8242,"%","B","BPS",1)

"^DIC",9002313.8242,9002313.8242,"%D",0)
^^1^1^3010409^
"^DIC",9002313.8242,9002313.8242,"%D",1,0)
Values for NCPDP Field 420, Prescription Clarification Code
"^DIC",9002313.8242,"B","BPS NCPDP FIELD 420",9002313.8242)

"^DIC",9002313.82423,9002313.82423,0)
BPS NCPDP FIELD 423^9002313.82423
"^DIC",9002313.82423,9002313.82423,0,"GL")
^BPSF(9002313.82423,
"^DIC",9002313.82423,9002313.82423,"%",0)
^1.005^1^1
"^DIC",9002313.82423,9002313.82423,"%",1,0)
BPS
"^DIC",9002313.82423,9002313.82423,"%","B","ABSP",1)

"^DIC",9002313.82423,9002313.82423,"%","B","BPS",1)

"^DIC",9002313.82423,9002313.82423,"%D",0)
^^2^2^3010409^
"^DIC",9002313.82423,9002313.82423,"%D",1,0)
Values for NCPDP Field 423, BASIS OF COST DETERMINATION.
"^DIC",9002313.82423,9002313.82423,"%D",2,0)
Indicates the method by which the drug cost (field 409) was calculated.
"^DIC",9002313.82423,"B","BPS NCPDP FIELD 423",9002313.82423)

"^DIC",9002313.82425,9002313.82425,0)
BPS NCPDP FIELD 425^9002313.82425
"^DIC",9002313.82425,9002313.82425,0,"GL")
^BPSF(9002313.82425,
"^DIC",9002313.82425,9002313.82425,"%",0)
^1.005^1^1
"^DIC",9002313.82425,9002313.82425,"%",1,0)
BPS
"^DIC",9002313.82425,9002313.82425,"%","B","ABSP",1)

"^DIC",9002313.82425,9002313.82425,"%","B","BPS",1)

"^DIC",9002313.82425,9002313.82425,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82425,9002313.82425,"%D",1,0)
Values for NCPDP field 425, Drug Type
"^DIC",9002313.82425,"B","BPS NCPDP FIELD 425",9002313.82425)

"^DIC",9002313.82429,9002313.82429,0)
BPS NCPDP FIELD 429^9002313.82429
"^DIC",9002313.82429,9002313.82429,0,"GL")
^BPSF(9002313.82429,
"^DIC",9002313.82429,9002313.82429,"%",0)
^1.005^1^1
"^DIC",9002313.82429,9002313.82429,"%",1,0)
BPS
"^DIC",9002313.82429,9002313.82429,"%","B","ABSP",1)

"^DIC",9002313.82429,9002313.82429,"%","B","BPS",1)

"^DIC",9002313.82429,9002313.82429,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82429,9002313.82429,"%D",1,0)
Values for NCPDP field 429, Unit Dose Indicator
"^DIC",9002313.82429,"B","BPS NCPDP FIELD 429",9002313.82429)

"^DIC",9002313.82432,9002313.82432,0)
BPS NCPDP FIELD 432^9002313.82432
"^DIC",9002313.82432,9002313.82432,0,"GL")
^BPSF(9002313.82432,
"^DIC",9002313.82432,9002313.82432,"%",0)
^1.005^1^1
"^DIC",9002313.82432,9002313.82432,"%",1,0)
BPS
"^DIC",9002313.82432,9002313.82432,"%","B","ABSP",1)

"^DIC",9002313.82432,9002313.82432,"%","B","BPS",1)

"^DIC",9002313.82432,9002313.82432,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82432,9002313.82432,"%D",1,0)
Values for NCPDP field 432, BASIS OF DAYS SUPPLY DETERMINATION.
"^DIC",9002313.82432,"B","BPS NCPDP FIELD 432",9002313.82432)

"^DIC",9002313.82436,9002313.82436,0)
BPS NCPDP FIELD 436^9002313.82436
"^DIC",9002313.82436,9002313.82436,0,"GL")
^BPSF(9002313.82436,
"^DIC",9002313.82436,9002313.82436,"%",0)
^1.005^1^1
"^DIC",9002313.82436,9002313.82436,"%",1,0)
BPS
"^DIC",9002313.82436,9002313.82436,"%","B","ABSP",1)

"^DIC",9002313.82436,9002313.82436,"%","B","BPS",1)

"^DIC",9002313.82436,9002313.82436,"%D",0)
^^4^4^3010409^
"^DIC",9002313.82436,9002313.82436,"%D",1,0)
Values for Field 436, Alternate Product Type.  The code number
"^DIC",9002313.82436,9002313.82436,"%D",2,0)
that identifies the product type that was dispensed.  This code is
"^DIC",9002313.82436,9002313.82436,"%D",3,0)
used only if the National Drug Code number is 
"^DIC",9002313.82436,9002313.82436,"%D",4,0)
not available.
"^DIC",9002313.82436,"B","BPS NCPDP FIELD 436",9002313.82436)

"^DIC",9002313.82439,9002313.82439,0)
BPS NCPDP FIELD 439^9002313.82439
"^DIC",9002313.82439,9002313.82439,0,"GL")
^BPSF(9002313.82439,
"^DIC",9002313.82439,9002313.82439,"%",0)
^1.005^1^1
"^DIC",9002313.82439,9002313.82439,"%",1,0)
BPS
"^DIC",9002313.82439,9002313.82439,"%","B","ABSP",1)

"^DIC",9002313.82439,9002313.82439,"%","B","BPS",1)

"^DIC",9002313.82439,9002313.82439,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82439,9002313.82439,"%D",1,0)
Values for NCPDP field 439, DUR Conflict Code.
"^DIC",9002313.82439,"B","BPS NCPDP FIELD 439",9002313.82439)

"^DIC",9002313.8244,9002313.8244,0)
BPS NCPDP FIELD 440^9002313.8244
"^DIC",9002313.8244,9002313.8244,0,"GL")
^BPSF(9002313.8244,
"^DIC",9002313.8244,9002313.8244,"%",0)
^1.005^1^1
"^DIC",9002313.8244,9002313.8244,"%",1,0)
BPS
"^DIC",9002313.8244,9002313.8244,"%","B","ABSP",1)

"^DIC",9002313.8244,9002313.8244,"%","B","BPS",1)

"^DIC",9002313.8244,9002313.8244,"%D",0)
^^1^1^3010409^
"^DIC",9002313.8244,9002313.8244,"%D",1,0)
Values for NCPDP field 440, DUR Intervention Code.
"^DIC",9002313.8244,"B","BPS NCPDP FIELD 440",9002313.8244)

"^DIC",9002313.82441,9002313.82441,0)
BPS NCPDP FIELD 441^9002313.82441
"^DIC",9002313.82441,9002313.82441,0,"GL")
^BPSF(9002313.82441,
"^DIC",9002313.82441,9002313.82441,"%",0)
^1.005^1^1
"^DIC",9002313.82441,9002313.82441,"%",1,0)
BPS
"^DIC",9002313.82441,9002313.82441,"%","B","ABSP",1)

"^DIC",9002313.82441,9002313.82441,"%","B","BPS",1)

"^DIC",9002313.82441,9002313.82441,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82441,9002313.82441,"%D",1,0)
Values for NCPDP field 441, DUR Outcome Code
"^DIC",9002313.82441,"B","BPS NCPDP FIELD 441",9002313.82441)

"^DIC",9002313.82501,9002313.82501,0)
BPS NCPDP FIELD 501^9002313.82501
"^DIC",9002313.82501,9002313.82501,0,"GL")
^BPSF(9002313.82501,
"^DIC",9002313.82501,9002313.82501,"%",0)
^1.005^1^1
"^DIC",9002313.82501,9002313.82501,"%",1,0)
BPS
"^DIC",9002313.82501,9002313.82501,"%","B","ABSP",1)

"^DIC",9002313.82501,9002313.82501,"%","B","BPS",1)

"^DIC",9002313.82501,9002313.82501,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82501,9002313.82501,"%D",1,0)
Values for NCPDP field 501, Response Status
"^DIC",9002313.82501,"B","BPS NCPDP FIELD 501",9002313.82501)

"^DIC",9002313.82522,9002313.82522,0)
BPS NCPDP FIELD 522^9002313.82522
"^DIC",9002313.82522,9002313.82522,0,"GL")
^BPSF(9002313.82522,
"^DIC",9002313.82522,9002313.82522,"%",0)
^1.005^1^1
"^DIC",9002313.82522,9002313.82522,"%",1,0)
BPS
"^DIC",9002313.82522,9002313.82522,"%","B","ABSP",1)

"^DIC",9002313.82522,9002313.82522,"%","B","BPS",1)

"^DIC",9002313.82522,9002313.82522,"%D",0)
^^1^1^3010409^
"^DIC",9002313.82522,9002313.82522,"%D",1,0)
Values for field 522, BASIS OF REIMBURSEMENT DETERMINATION
"^DIC",9002313.82522,"B","BPS NCPDP FIELD 522",9002313.82522)

"^DIC",9002313.82528,9002313.82528,0)
BPS NCPDP FIELD 528^9002313.82528
"^DIC",9002313.82528,9002313.82528,0,"GL")
^BPSF(9002313.82528,
"^DIC",9002313.82528,9002313.82528,"%",0)
^1.005^1^1
"^DIC",9002313.82528,9002313.82528,"%",1,0)
BPS
"^DIC",9002313.82528,9002313.82528,"%","B","ABSP",1)

"^DIC",9002313.82528,9002313.82528,"%","B","BPS",1)

"^DIC",9002313.82528,9002313.82528,"%D",0)
^^2^2^3010406^
"^DIC",9002313.82528,9002313.82528,"%D",1,0)
Meanings of codes in NCPDP field 528.
"^DIC",9002313.82528,9002313.82528,"%D",2,0)
CLINICAL SIGNIFICANCE CODE a/k/a SEVERITY INDEX CODE.
"^DIC",9002313.82528,"B","BPS NCPDP FIELD 528",9002313.82528)

"^DIC",9002313.82529,9002313.82529,0)
BPS NCPDP FIELD 529^9002313.82529
"^DIC",9002313.82529,9002313.82529,0,"GL")
^BPSF(9002313.82529,
"^DIC",9002313.82529,9002313.82529,"%",0)
^1.005^1^1
"^DIC",9002313.82529,9002313.82529,"%",1,0)
BPS
"^DIC",9002313.82529,9002313.82529,"%","B","ABSP",1)

"^DIC",9002313.82529,9002313.82529,"%","B","BPS",1)

"^DIC",9002313.82529,9002313.82529,"%D",0)
^^1^1^3010406^
"^DIC",9002313.82529,9002313.82529,"%D",1,0)
Values of NCPDP field 529, OTHER PHARMACY INDICATOR.
"^DIC",9002313.82529,"B","BPS NCPDP FIELD 529",9002313.82529)

"^DIC",9002313.82532,9002313.82532,0)
BPS NCPDP FIELD 532^9002313.82532
"^DIC",9002313.82532,9002313.82532,0,"GL")
^BPSF(9002313.82532,
"^DIC",9002313.82532,9002313.82532,"%",0)
^1.005^1^1
"^DIC",9002313.82532,9002313.82532,"%",1,0)
BPS
"^DIC",9002313.82532,9002313.82532,"%","B","ABSP",1)

"^DIC",9002313.82532,9002313.82532,"%","B","BPS",1)

"^DIC",9002313.82532,9002313.82532,"%D",0)
^^1^1^3010406^
"^DIC",9002313.82532,9002313.82532,"%D",1,0)
Values of NCPDP field 532, DATABASE INDICATOR.
"^DIC",9002313.82532,"B","BPS NCPDP FIELD 532",9002313.82532)

"^DIC",9002313.82533,9002313.82533,0)
BPS NCPDP FIELD 533^9002313.82533
"^DIC",9002313.82533,9002313.82533,0,"GL")
^BPSF(9002313.82533,
"^DIC",9002313.82533,9002313.82533,"%",0)
^1.005^1^1
"^DIC",9002313.82533,9002313.82533,"%",1,0)
BPS
"^DIC",9002313.82533,9002313.82533,"%","B","ABSP",1)

"^DIC",9002313.82533,9002313.82533,"%","B","BPS",1)

"^DIC",9002313.82533,9002313.82533,"%D",0)
^^1^1^3010413^^
"^DIC",9002313.82533,9002313.82533,"%D",1,0)
Values for NCPDP field 533, OTHER PRESCRIBER INDICATOR.
"^DIC",9002313.82533,"B","BPS NCPDP FIELD 533",9002313.82533)

"^DIC",9002313.82535,9002313.82535,0)
BPS NCPDP FIELD 535^9002313.82535
"^DIC",9002313.82535,9002313.82535,0,"GL")
^BPSF(9002313.82535,
"^DIC",9002313.82535,9002313.82535,"%",0)
^1.005^1^1
"^DIC",9002313.82535,9002313.82535,"%",1,0)
BPS
"^DIC",9002313.82535,9002313.82535,"%","B","ABSP",1)

"^DIC",9002313.82535,9002313.82535,"%","B","BPS",1)

"^DIC",9002313.82535,9002313.82535,"%D",0)
^^1^1^3010406^
"^DIC",9002313.82535,9002313.82535,"%D",1,0)
Values for NCPDP field 535, DUR OVERFLOW.
"^DIC",9002313.82535,"B","BPS NCPDP FIELD 535",9002313.82535)

"^DIC",9002313.83,9002313.83,0)
BPS RESULT CATEGORY^9002313.83
"^DIC",9002313.83,9002313.83,0,"GL")
^BPSF(9002313.83,
"^DIC",9002313.83,9002313.83,"%",0)
^1.005^1^1
"^DIC",9002313.83,9002313.83,"%",1,0)
BPS
"^DIC",9002313.83,9002313.83,"%","B","ABSP",1)

"^DIC",9002313.83,9002313.83,"%","B","BPS",1)

"^DIC",9002313.83,9002313.83,"%D",0)
^^2^2^3010410^
"^DIC",9002313.83,9002313.83,"%D",1,0)
A list of the possible result categories,
"^DIC",9002313.83,9002313.83,"%D",2,0)
as returned by CATEG^BPSOSUC().
"^DIC",9002313.83,"B","BPS RESULT CATEGORY",9002313.83)

"^DIC",9002313.89,9002313.89,0)
BPS ERROR CODES^9002313.89
"^DIC",9002313.89,9002313.89,0,"GL")
^BPSF(9002313.89,
"^DIC",9002313.89,9002313.89,"%",0)
^1.005^1^1
"^DIC",9002313.89,9002313.89,"%",1,0)
BPS
"^DIC",9002313.89,9002313.89,"%","B","ABSP",1)

"^DIC",9002313.89,9002313.89,"%","B","BPS",1)

"^DIC",9002313.89,9002313.89,"%D",0)
^^1^1^3010205^^^^
"^DIC",9002313.89,9002313.89,"%D",1,0)
Obsolete.  But it may be revived.
"^DIC",9002313.89,"B","BPS ERROR CODES",9002313.89)

"^DIC",9002313.91,9002313.91,0)
BPS NCPDP FIELD DEFS^9002313.91
"^DIC",9002313.91,9002313.91,0,"GL")
^BPSF(9002313.91,
"^DIC",9002313.91,9002313.91,"%",0)
^1.005^1^1
"^DIC",9002313.91,9002313.91,"%",1,0)
BPS
"^DIC",9002313.91,9002313.91,"%","B","ABSP",1)

"^DIC",9002313.91,9002313.91,"%","B","BPS",1)

"^DIC",9002313.91,9002313.91,"%D",0)
^^3^3^3010205^^^^
"^DIC",9002313.91,9002313.91,"%D",1,0)
The NCPDP Data Dictionary
"^DIC",9002313.91,9002313.91,"%D",2,0)
Individual fields which combine into formatted packets.
"^DIC",9002313.91,9002313.91,"%D",3,0)
Installation overwrites this file, totally.
"^DIC",9002313.91,"B","BPS NCPDP FIELD DEFS",9002313.91)

"^DIC",9002313.92,9002313.92,0)
BPS NCPDP FORMATS^9002313.92
"^DIC",9002313.92,9002313.92,0,"GL")
^BPSF(9002313.92,
"^DIC",9002313.92,9002313.92,"%",0)
^1.005^1^1
"^DIC",9002313.92,9002313.92,"%",1,0)
BPS
"^DIC",9002313.92,9002313.92,"%","B","ABSP",1)

"^DIC",9002313.92,9002313.92,"%","B","BPS",1)

"^DIC",9002313.92,9002313.92,"%D",0)
^^4^4^3010205^^^^
"^DIC",9002313.92,9002313.92,"%D",1,0)
The formats for sending claims.  
"^DIC",9002313.92,9002313.92,"%D",2,0)
As derived from NDC Payor Sheets and Envoy Plan Sheets.
"^DIC",9002313.92,9002313.92,"%D",3,0)
Never modify locally, except in cooperation with development.
"^DIC",9002313.92,9002313.92,"%D",4,0)
Installation overwrites this file, totally.
"^DIC",9002313.92,"B","BPS NCPDP FORMATS",9002313.92)

"^DIC",9002313.93,9002313.93,0)
BPS NCPDP REJECT CODES^9002313.93
"^DIC",9002313.93,9002313.93,0,"GL")
^BPSF(9002313.93,
"^DIC",9002313.93,9002313.93,"%",0)
^1.005^1^1
"^DIC",9002313.93,9002313.93,"%",1,0)
BPS
"^DIC",9002313.93,9002313.93,"%","B","ABSP",1)

"^DIC",9002313.93,9002313.93,"%","B","BPS",1)

"^DIC",9002313.93,9002313.93,"%D",0)
^^3^3^3001120^^
"^DIC",9002313.93,9002313.93,"%D",1,0)
Rejection codes as defined by NCPDP.
"^DIC",9002313.93,9002313.93,"%D",2,0)
Never ever edit.
"^DIC",9002313.93,9002313.93,"%D",3,0)
Installation overwrites this file, totally.
"^DIC",9002313.93,"B","BPS NCPDP REJECT CODES",9002313.93)

"^DIC",9002313.94,9002313.94,0)
BPS INSURANCE RULES^9002313.94
"^DIC",9002313.94,9002313.94,0,"GL")
^BPSF(9002313.94,
"^DIC",9002313.94,9002313.94,"%",0)
^1.005^1^1
"^DIC",9002313.94,9002313.94,"%",1,0)
BPS
"^DIC",9002313.94,9002313.94,"%","B","ABSP",1)

"^DIC",9002313.94,9002313.94,"%","B","BPS",1)

"^DIC",9002313.94,9002313.94,"%D",0)
^^2^2^3001120^^
"^DIC",9002313.94,9002313.94,"%D",1,0)
The insurance rules which are available for selection.
"^DIC",9002313.94,9002313.94,"%D",2,0)
Never edit this file.  Installation overwrites it.
"^DIC",9002313.94,"B","BPS INSURANCE RULES",9002313.94)

"^DIC",9002313.99,9002313.99,0)
BPS SETUP^9002313.99
"^DIC",9002313.99,9002313.99,0,"GL")
^BPS(9002313.99,
"^DIC",9002313.99,9002313.99,"%",0)
^1.005^1^1
"^DIC",9002313.99,9002313.99,"%",1,0)
BPS
"^DIC",9002313.99,9002313.99,"%","B","ABSP",1)

"^DIC",9002313.99,9002313.99,"%","B","BPS",1)

"^DIC",9002313.99,9002313.99,"%D",0)
^^2^2^3001120^^^
"^DIC",9002313.99,9002313.99,"%D",1,0)
All manner of parameters and stuff.
"^DIC",9002313.99,9002313.99,"%D",2,0)
Always has one and only one entry, IEN `1.
"^DIC",9002313.99,"B","BPS SETUP",9002313.99)

**INSTALL NAME**
PSO*7.0*148
"BLD",5470,0)
PSO*7.0*148^OUTPATIENT PHARMACY^0^3060324^y
"BLD",5470,1,0)
^^278^278^3060317^^^^
"BLD",5470,1,1,0)
The National Council for Prescription Drug Programs (NCPDP) standard was
"BLD",5470,1,2,0)
adopted under the Healthcare Insurance Portability and Accountability Act
"BLD",5470,1,3,0)
(HIPAA) for pharmacy claims. The HIPAA NCPDP - GLOBAL project involves six
"BLD",5470,1,4,0)
different applications that have been significantly changed to enable VA
"BLD",5470,1,5,0)
Medical Centers to perform third party electronic billing for prescriptions
"BLD",5470,1,6,0)
using the NCPDP standard. 
"BLD",5470,1,7,0)
 
"BLD",5470,1,8,0)
Below is a list of all the applications involved in this project along with
"BLD",5470,1,9,0)
their patch number:
"BLD",5470,1,10,0)
  
"BLD",5470,1,11,0)
   APPLICATION/VERSION                                  PATCH
"BLD",5470,1,12,0)
   -----------------------------------------------------------------
"BLD",5470,1,13,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*148
"BLD",5470,1,14,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*276
"BLD",5470,1,15,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*90
"BLD",5470,1,16,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0  PSX*2*48
"BLD",5470,1,17,0)
   ACCOUNTS RECEIVABLE (AR) V. 4.5                      PRCA*4.5*230
"BLD",5470,1,18,0)
   ELECTRONIC CLAIMS MANAGEMENT ENGINE (ECME) V. 1.0    BPS*1*1
"BLD",5470,1,19,0)
 
"BLD",5470,1,20,0)
Veterans Health Information Systems and Technology Architecture (VistA)
"BLD",5470,1,21,0)
software applications and infrastructure were enhanced, in order to allow the
"BLD",5470,1,22,0)
electronic transmission of outpatient pharmacy prescription claims (WINDOW
"BLD",5470,1,23,0)
and MAIL fills) to third party payers via the network connections available
"BLD",5470,1,24,0)
through the Austin Automation Center (AAC). VistA will be enhanced to receive
"BLD",5470,1,25,0)
electronic adjudicated responses from the third party payers, which include
"BLD",5470,1,26,0)
real-time processing for Drug Review Utilization and Refill Too Soon rejects.
"BLD",5470,1,27,0)
Reject information will be displayed to the pharmacist as the prescription is
"BLD",5470,1,28,0)
being processed. The pharmacist will have the capability to take the
"BLD",5470,1,29,0)
appropriate action to ensure patient safety or to override the reject and
"BLD",5470,1,30,0)
resubmit the claim to the payer for payment. When a status of "PAYABLE" is
"BLD",5470,1,31,0)
returned by the payer for a released prescription, VistA will automatically
"BLD",5470,1,32,0)
create the bill in IB, authorize it and immediately create the receivable in
"BLD",5470,1,33,0)
the AR application. Since the exact amount being paid by the payer is known,
"BLD",5470,1,34,0)
a decrease adjustment will be automatically generated and applied so that the
"BLD",5470,1,35,0)
receivable is equal to the net amount due from the payer.
"BLD",5470,1,36,0)
 
"BLD",5470,1,37,0)
The system also provides electronic payment matching capability (for
"BLD",5470,1,38,0)
electronically billable outpatient pharmacy prescriptions) using the existing
"BLD",5470,1,39,0)
Electronic Data Interchange (EDI) Lockbox functionality which processes other
"BLD",5470,1,40,0)
electronic payments from third party payers. This real-time electronic claims
"BLD",5470,1,41,0)
processing capability will be provided in accordance with the HIPAA, EDI
"BLD",5470,1,42,0)
and the NCPDP mandated format standards, specifically NCPDP Telecommunication
"BLD",5470,1,43,0)
Standard V. 5.1. Additional functionality delivered with this project 
"BLD",5470,1,44,0)
includes:
"BLD",5470,1,45,0)
 
"BLD",5470,1,46,0)
   . Auto-Release/Outpatient Pharmacy Automation Interface (OPAI) Integration.
"BLD",5470,1,47,0)
   . Back-billing capability to allow electronic billing of claims from within
"BLD",5470,1,48,0)
     the IB application.
"BLD",5470,1,49,0)
   . Capability to MOVE a group of subscribers from one insurance plan to
"BLD",5470,1,50,0)
     another while automatically "expiring" the old plan, which is a major
"BLD",5470,1,51,0)
     time saver.
"BLD",5470,1,52,0)
   . Pharmacy Dispensed As Written (DAW) prescription processing.
"BLD",5470,1,53,0)
  
"BLD",5470,1,54,0)
Overview of the Process:
"BLD",5470,1,55,0)
  
"BLD",5470,1,56,0)
When a prescription is about to be filled and dispensed by the pharmacy, the
"BLD",5470,1,57,0)
OP application submits the prescription to the new ECME application. ECME then
"BLD",5470,1,58,0)
contacts IB to verify whether or not the prescription is electronically
"BLD",5470,1,59,0)
billable. If so, ECME gathers the information necessary to generate a NCPDP
"BLD",5470,1,60,0)
claim. The claim information is passed to the VistA Health Level Seven (HL7)
"BLD",5470,1,61,0)
package. The HL7 package then sends the billing information to the AAC, where
"BLD",5470,1,62,0)
it is routed to the corresponding third party insurance via Emdeon (formerly
"BLD",5470,1,63,0)
WebMD).
"BLD",5470,1,64,0)
  
"BLD",5470,1,65,0)
Once the payer processes the information, the response coming back from the
"BLD",5470,1,66,0)
payer is passed back to the site that made the request, and the information
"BLD",5470,1,67,0)
is stored in the ECME package. If the third party payer accepted the claim,
"BLD",5470,1,68,0)
the adjudicated information is passed along to IB. If the claim was rejected
"BLD",5470,1,69,0)
the problem can be worked on and a new claim can be submitted to the payer.
"BLD",5470,1,70,0)
  
"BLD",5470,1,71,0)
For electronically billable CMOP prescription processing, the third party
"BLD",5470,1,72,0)
claim is sent before the prescription information is transmitted to the
"BLD",5470,1,73,0)
CMOP facility to be filled. Once the adjudicating response is electronically
"BLD",5470,1,74,0)
received from the third party payer, if there are no Drug Utilization Review
"BLD",5470,1,75,0)
or Refill Too Soon rejects, the prescription is then transmitted to the CMOP
"BLD",5470,1,76,0)
facility. When the CMOP center sends the dispensing information back to VistA,
"BLD",5470,1,77,0)
the National Drug Code (NDC) information is checked against the NDC sent to
"BLD",5470,1,78,0)
the third party payer and, if different, a new claim is generated in the
"BLD",5470,1,79,0)
background and is sent to the third party payer. In case the CMOP facility
"BLD",5470,1,80,0)
indicates that it is unable to fill a "PAYABLE" prescription fill, a reversal
"BLD",5470,1,81,0)
is automatically submitted to the third party payer for the corresponding
"BLD",5470,1,82,0)
fill.
"BLD",5470,1,83,0)
 
"BLD",5470,1,84,0)
This patch modifies the OP application to perform real-time electronic claim
"BLD",5470,1,85,0)
submission to third party payers. It will also enable OP users to see and act
"BLD",5470,1,86,0)
on third party payer rejects such as Drug Utilization Review (DUR) and Refill
"BLD",5470,1,87,0)
Too Soon rejects along with their daily normal prescription processing 
"BLD",5470,1,88,0)
activities. The following areas of OP have been changed:
"BLD",5470,1,89,0)
  
"BLD",5470,1,90,0)
1.  Patient Prescription Processing [PSO LM BACKDOOR ORDERS] option 
"BLD",5470,1,91,0)
 
"BLD",5470,1,92,0)
    At the point that the prescription is verified, the New Order, Edit,
"BLD",5470,1,93,0)
    Renew, Refill, and Pull Early from Suspense functions will begin the
"BLD",5470,1,94,0)
    third party billing evaluations. If IB determines that the
"BLD",5470,1,95,0)
    prescription is third party billable, a message will be displayed on
"BLD",5470,1,96,0)
    the user's screen stating that the claim is being submitted to ECME
"BLD",5470,1,97,0)
    and it will also show the progress of the claim. If the payer rejects
"BLD",5470,1,98,0)
    the claim for DUR or Refill Too Soon, the payer's information will be
"BLD",5470,1,99,0)
    displayed, and the user will be given the opportunity to either ignore
"BLD",5470,1,100,0)
    the payer's response and move on with the filling process; override
"BLD",5470,1,101,0)
    the reject by resubmitting the claim or postpone the processing of the
"BLD",5470,1,102,0)
    prescription by taking no action when the reject is received. For
"BLD",5470,1,103,0)
    prescriptions that have been electronically submitted to the third
"BLD",5470,1,104,0)
    party payer, an indicator is displayed on the Patient Prescription
"BLD",5470,1,105,0)
    Processing screen. This indicator will take the form of "e" next to
"BLD",5470,1,106,0)
    the prescription number (e.g.,"2090303$e").  
"BLD",5470,1,107,0)
  
"BLD",5470,1,108,0)
    A new section called REFILL TOO SOON/DUR REJECTS (Third Party) has
"BLD",5470,1,109,0)
    been created in the Medication Profile screen to single out
"BLD",5470,1,110,0)
    prescription that had an electronic claim rejected by third party
"BLD",5470,1,111,0)
    payers for REFILL TOO SOON or DUR reasons. Prescriptions under this
"BLD",5470,1,112,0)
    section have certain restrictions. Basically, they cannot be renewed,
"BLD",5470,1,113,0)
    refilled, reprinted, copied or released until the REJECT is resolved.
"BLD",5470,1,114,0)
    When an individual prescription is selected, the user will have a new
"BLD",5470,1,115,0)
    hidden option called REJ - View Reject, which will allow them to
"BLD",5470,1,116,0)
    resolve the REJECT and remove it from the REFILL TOO SOON/DUR REJECTS
"BLD",5470,1,117,0)
    (Third Party) section.
"BLD",5470,1,118,0)
   
"BLD",5470,1,119,0)
    The prescription release option was modified to perform NDC (National
"BLD",5470,1,120,0)
    Drug Code) validation for electronically billable prescriptions. When
"BLD",5470,1,121,0)
    the user selects a new NDC a new claim is submitted to the payer
"BLD",5470,1,122,0)
    before the prescription is released.
"BLD",5470,1,123,0)
   
"BLD",5470,1,124,0)
    In the OP Medications screen, a new DAW CODE field (#81) of the 
"BLD",5470,1,125,0)
    PRESCRIPTION file (#52) was created for electronically billable
"BLD",5470,1,126,0)
    prescriptions and can be edited by selecting '21' at the 'Select
"BLD",5470,1,127,0)
    Action' prompt. For non-electronically billable prescriptions this
"BLD",5470,1,128,0)
    field is not displayed at all.
"BLD",5470,1,129,0)
    
"BLD",5470,1,130,0)
    When the electronically billable prescription is released, this option
"BLD",5470,1,131,0)
    will allow the user to edit the NDC code for the prescription. In the
"BLD",5470,1,132,0)
    OP Medications screen the NDC field is listed under the Drug field
"BLD",5470,1,133,0)
    and can be edited by selecting '2' to edit the drug at the 'Select
"BLD",5470,1,134,0)
    Action' prompt. For sites that do not allow Drug editing, the option
"BLD",5470,1,135,0)
    '2' will allow editing of the NDC only.
"BLD",5470,1,136,0)
 
"BLD",5470,1,137,0)
2.  Return Medication to Stock [PSO RETURNED STOCK] option 
"BLD",5470,1,138,0)
 
"BLD",5470,1,139,0)
    The Return Medication to Stock function was modified to notify the
"BLD",5470,1,140,0)
    third party payer that a previously billed prescription was not
"BLD",5470,1,141,0)
    actually filled. If the prescription was previously billed to a third
"BLD",5470,1,142,0)
    party payer and a payable response was received, the claim will be
"BLD",5470,1,143,0)
    reversed, and the pharmacy user will see messaging stating that the
"BLD",5470,1,144,0)
    third party claim was submitted for reversal. If a claim for the
"BLD",5470,1,145,0)
    prescription was previously rejected by the third party payer, the
"BLD",5470,1,146,0)
    user will see a message indicating that no reversal was required. If
"BLD",5470,1,147,0)
    the prescription was not previously billed to a third party payer, no
"BLD",5470,1,148,0)
    message regarding electronic billing will be displayed.
"BLD",5470,1,149,0)
 
"BLD",5470,1,150,0)
3.  Delete a Prescription [PSO RXDL] option 
"BLD",5470,1,151,0)
 
"BLD",5470,1,152,0)
    The message for Delete a Prescription was modified to perform in the 
"BLD",5470,1,153,0)
    same manner as the Return Medication to Stock function described
"BLD",5470,1,154,0)
    above.
"BLD",5470,1,155,0)
  
"BLD",5470,1,156,0)
4.  Pull Early from Suspense [PSO PNDRX] option 
"BLD",5470,1,157,0)
  
"BLD",5470,1,158,0)
    The Pull Early from Suspense function was modified to submit a third 
"BLD",5470,1,159,0)
    party claim for the prescription. A message will display to notify the
"BLD",5470,1,160,0)
    user of the status of the claim as it is going through the submission 
"BLD",5470,1,161,0)
    process.  
"BLD",5470,1,162,0)
 
"BLD",5470,1,163,0)
5.  Print from Suspense File [PSO PNDLBL] option 
"BLD",5470,1,164,0)
 
"BLD",5470,1,165,0)
    This option was modified to submit third party claims in the same
"BLD",5470,1,166,0)
    manner as stated above except the Print from Suspense File function
"BLD",5470,1,167,0)
    will be performed in the background. No user interaction will occur.
"BLD",5470,1,168,0)
  
"BLD",5470,1,169,0)
6.  ePharmacy Menu [PSO EPHARMACY MENU] menu
"BLD",5470,1,170,0)
 
"BLD",5470,1,171,0)
    This new menu was created for electronic billing related options. It
"BLD",5470,1,172,0)
    is being placed under the Rx (Prescriptions) [PSO RX] menu. Two new
"BLD",5470,1,173,0)
    options are being added under this new menu:
"BLD",5470,1,174,0)
 
"BLD",5470,1,175,0)
    6.1 Third Party Payer Rejects - Worklist [PSO REJECTS WORKLIST] option
"BLD",5470,1,176,0)
 
"BLD",5470,1,177,0)
        This option is used to process third party payer rejects that have
"BLD",5470,1,178,0)
        clinical significance. For now, only DUR (Drug Utilization Review)
"BLD",5470,1,179,0)
        and REFILL TOO SOON rejects are being considered as having
"BLD",5470,1,180,0)
        clinical significance.
"BLD",5470,1,181,0)
 
"BLD",5470,1,182,0)
    6.2 Third Party Payer Rejects - View/Process [PSO REJECTS 
"BLD",5470,1,183,0)
        VIEW/PROCESS] option
"BLD",5470,1,184,0)
 
"BLD",5470,1,185,0)
        This option performs the same functionality as the option above.
"BLD",5470,1,186,0)
        However, the user has more filtering capabilities through this
"BLD",5470,1,187,0)
        option. In addition, closed/resolved rejects can only be viewed by
"BLD",5470,1,188,0)
        using this option.
"BLD",5470,1,189,0)
          
"BLD",5470,1,190,0)
7.  Release Medication [PSO RELEASE] option 
"BLD",5470,1,191,0)
 
"BLD",5470,1,192,0)
    The prescription release process was modified to perform NDC (National
"BLD",5470,1,193,0)
    Drug Code) validation for electronically billable prescriptions. When
"BLD",5470,1,194,0)
    the user selects a new NDC, a new claim is submitted to the payer
"BLD",5470,1,195,0)
    before the prescription is released. Besides this option, the 
"BLD",5470,1,196,0)
    prescription can be released from the Medication Profile screen and
"BLD",5470,1,197,0)
    from the Outpatient Rx's [PSD OUTPATIENT] option in the Controlled
"BLD",5470,1,198,0)
    Substances application.
"BLD",5470,1,199,0)
   
"BLD",5470,1,200,0)
8.  View Prescriptions [PSO VIEW] option
"BLD",5470,1,201,0)
  
"BLD",5470,1,202,0)
    This option was changed to include two new sections: ECME Log and ECME
"BLD",5470,1,203,0)
    REJECT Log. Information about third party payer submission and rejects
"BLD",5470,1,204,0)
    will be displayed under these sections.
"BLD",5470,1,205,0)
    
"BLD",5470,1,206,0)
9.  Edit Prescriptions [PSO RXEDIT] option
"BLD",5470,1,207,0)
 
"BLD",5470,1,208,0)
    The new DAW CODE field (#81) of the PRESCRIPTION file (#52) was
"BLD",5470,1,209,0)
    created for electronically billable prescriptions and can be edited
"BLD",5470,1,210,0)
    through this option. For non-electronically billable prescriptions,
"BLD",5470,1,211,0)
    the field is not displayed at all.
"BLD",5470,1,212,0)
    
"BLD",5470,1,213,0)
    Once an electronically billable prescription is released, this option
"BLD",5470,1,214,0)
    will allow the user to edit the NDC code. The NDC code is displayed on
"BLD",5470,1,215,0)
    the screen just below the Drug field, and can be edited by selecting
"BLD",5470,1,216,0)
    field '2' to edit the Drug. For sites that do not allow Drug editing,
"BLD",5470,1,217,0)
    the field '2' can be used to edit the NDC code only.
"BLD",5470,1,218,0)
 
"BLD",5470,1,219,0)
10. The NDC field (#4) under the CMOP EVENT multiple (#52.01) of the
"BLD",5470,1,220,0)
    PRESCRIPTION file (#52) has been renamed to NDC RECEIVED. This field
"BLD",5470,1,221,0)
    holds the NDC that was received from the CMOP facility with the
"BLD",5470,1,222,0)
    dispensing message. The renaming was necessary due to the addition of 
"BLD",5470,1,223,0)
    the NDC SENT field (#12) under the same multiple that is being created
"BLD",5470,1,224,0)
    by this project (see below item 11).
"BLD",5470,1,225,0)
  
"BLD",5470,1,226,0)
11. A new NDC SENT field (#12) is being created under the CMOP EVENT 
"BLD",5470,1,227,0)
    multiple (#52.01) of the PRESCRIPTION file (#52), to store the NDC
"BLD",5470,1,228,0)
    that was transmission to CMOP. This field is used for electronic 
"BLD",5470,1,229,0)
    billing purposes to analyze the difference between the NDC sent to
"BLD",5470,1,230,0)
    CMOP and the actual dispensed NDC by the CMOP facility.
"BLD",5470,1,231,0)
 
"BLD",5470,1,232,0)
12. A new DAW CODE field (#81) is being created on the PRESCRIPTION
"BLD",5470,1,233,0)
    file (#52) and also under the REFILL multiple (#52.1) of the
"BLD",5470,1,234,0)
    PRESCRIPTION file (#52). This field contains the NCPDP DAW used in the
"BLD",5470,1,235,0)
    electronic claims submission to third party payers (insurance
"BLD",5470,1,236,0)
    companies).
"BLD",5470,1,237,0)
 
"BLD",5470,1,238,0)
13. A new RE-TRANSMIT FLAG field (#82) is being created on the 
"BLD",5470,1,239,0)
    PRESCRIPTION file (#52) and also under the REFILL multiple (#52.1) of 
"BLD",5470,1,240,0)
    the PRESCRIPTION file (#52). This field is used to indicate that a
"BLD",5470,1,241,0)
    claim should be electronically re-transmitted to the 3rd party payer
"BLD",5470,1,242,0)
    (insurance company). It will be primarily used by CMOP and local mail
"BLD",5470,1,243,0)
    prescriptions.
"BLD",5470,1,244,0)
   
"BLD",5470,1,245,0)
14. A new multiple REJECT INFO field (#52.25) has been created on the
"BLD",5470,1,246,0)
    PRESCRIPTION file (#52) to store information about DUR and Refill Too
"BLD",5470,1,247,0)
    Soon Rejects returned by 3rd party payers. 
"BLD",5470,1,248,0)
    The following fields are part of this multiple:
"BLD",5470,1,249,0)
 
"BLD",5470,1,250,0)
        .01   NCPDP REJECT CODE      
"BLD",5470,1,251,0)
          1   DATE/TIME DETECTED     
"BLD",5470,1,252,0)
          2   PAYER MESSAGE          
"BLD",5470,1,253,0)
          3   REASON                 
"BLD",5470,1,254,0)
          4   PHARMACIST             
"BLD",5470,1,255,0)
          5   FILL NUMBER            
"BLD",5470,1,256,0)
          6   GROUP NAME             
"BLD",5470,1,257,0)
          7   PLAN CONTACT           
"BLD",5470,1,258,0)
          8   PLAN PREVIOUS FILL DATE
"BLD",5470,1,259,0)
          9   STATUS   
"BLD",5470,1,260,0)
         10   CLOSED DATE/TIME 
"BLD",5470,1,261,0)
         11   CLOSED BY
"BLD",5470,1,262,0)
         12   CLOSE REASON
"BLD",5470,1,263,0)
         13   CLOSE COMMENTS
"BLD",5470,1,264,0)
         14   REASON FOR SERVICE CODE
"BLD",5470,1,265,0)
         15   PROFESSIONAL SERVICE CODE
"BLD",5470,1,266,0)
         16   RESPONSE ID
"BLD",5470,1,267,0)
         17   OTHER REJECTS     
"BLD",5470,1,268,0)
         18   DUR TEXT          
"BLD",5470,1,269,0)
         19   RESULT OF SERVICE CODE
"BLD",5470,1,270,0)
         20   INSURANCE NAME    
"BLD",5470,1,271,0)
         21   GROUP NUMBER      
"BLD",5470,1,272,0)
         22   CARDHOLDER ID 
"BLD",5470,1,273,0)
         23   RE-OPENED
"BLD",5470,1,274,0)
 
"BLD",5470,1,275,0)
    Two new cross-references named "REJDAT" and "REJSTS" were created for
"BLD",5470,1,276,0)
    this multiple in the PRESCRIPTION file (#52). The "REJDAT" uses the
"BLD",5470,1,277,0)
    DATE/TIME DETECTED field (#1) and the "REJSTS" uses the STATUS field
"BLD",5470,1,278,0)
    (#9).
"BLD",5470,4,0)
^9.64PA^52^1
"BLD",5470,4,52,0)
52
"BLD",5470,4,52,2,0)
^9.641^52.1^5
"BLD",5470,4,52,2,52,0)
PRESCRIPTION  (File-top level)
"BLD",5470,4,52,2,52,1,0)
^9.6411^82^2
"BLD",5470,4,52,2,52,1,81,0)
DAW CODE
"BLD",5470,4,52,2,52,1,82,0)
RE-TRANSMIT FLAG
"BLD",5470,4,52,2,52.01,0)
CMOP EVENT  (sub-file)
"BLD",5470,4,52,2,52.01,1,0)
^9.6411^4^2
"BLD",5470,4,52,2,52.01,1,4,0)
NDC RECEIVED
"BLD",5470,4,52,2,52.01,1,12,0)
NDC SENT
"BLD",5470,4,52,2,52.1,0)
REFILL  (sub-file)
"BLD",5470,4,52,2,52.1,1,0)
^9.6411^82^2
"BLD",5470,4,52,2,52.1,1,81,0)
DAW CODE
"BLD",5470,4,52,2,52.1,1,82,0)
RE-TRANSMIT FLAG
"BLD",5470,4,52,2,52.25,0)
REJECT INFO  (sub-file)
"BLD",5470,4,52,2,52.25,1,0)
^9.6411^^
"BLD",5470,4,52,2,52.3,0)
ACTIVITY LOG  (sub-file)
"BLD",5470,4,52,2,52.3,1,0)
^9.6411^.02^1
"BLD",5470,4,52,2,52.3,1,.02,0)
REASON
"BLD",5470,4,52,222)
y^y^p^^^^n^^n
"BLD",5470,4,52,224)

"BLD",5470,4,"APDD",52,52)

"BLD",5470,4,"APDD",52,52,81)

"BLD",5470,4,"APDD",52,52,82)

"BLD",5470,4,"APDD",52,52.01)

"BLD",5470,4,"APDD",52,52.01,4)

"BLD",5470,4,"APDD",52,52.01,12)

"BLD",5470,4,"APDD",52,52.1)

"BLD",5470,4,"APDD",52,52.1,81)

"BLD",5470,4,"APDD",52,52.1,82)

"BLD",5470,4,"APDD",52,52.25)

"BLD",5470,4,"APDD",52,52.3)

"BLD",5470,4,"APDD",52,52.3,.02)

"BLD",5470,4,"B",52,52)

"BLD",5470,"INI")

"BLD",5470,"INID")
^^
"BLD",5470,"INIT")

"BLD",5470,"KRN",0)
^9.67PA^8989.52^19
"BLD",5470,"KRN",.4,0)
.4
"BLD",5470,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5470,"KRN",.401,0)
.401
"BLD",5470,"KRN",.402,0)
.402
"BLD",5470,"KRN",.403,0)
.403
"BLD",5470,"KRN",.5,0)
.5
"BLD",5470,"KRN",.84,0)
.84
"BLD",5470,"KRN",3.6,0)
3.6
"BLD",5470,"KRN",3.8,0)
3.8
"BLD",5470,"KRN",9.2,0)
9.2
"BLD",5470,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",5470,"KRN",9.8,0)
9.8
"BLD",5470,"KRN",9.8,"NM",0)
^9.68A^95^77
"BLD",5470,"KRN",9.8,"NM",4,0)
PSOR52^^0^B30307425
"BLD",5470,"KRN",9.8,"NM",5,0)
PSODISP^^0^B54775378
"BLD",5470,"KRN",9.8,"NM",7,0)
PSON52^^0^B59165642
"BLD",5470,"KRN",9.8,"NM",9,0)
PSOORED4^^0^B47668549
"BLD",5470,"KRN",9.8,"NM",10,0)
PSOORED6^^0^B70246977
"BLD",5470,"KRN",9.8,"NM",11,0)
PSOOREDT^^0^B64105311
"BLD",5470,"KRN",9.8,"NM",12,0)
PSOORNE1^^0^B67734150
"BLD",5470,"KRN",9.8,"NM",13,0)
PSOORUT1^^0^B65051729
"BLD",5470,"KRN",9.8,"NM",14,0)
PSOP^^0^B46184688
"BLD",5470,"KRN",9.8,"NM",15,0)
PSORESK^^0^B58029902
"BLD",5470,"KRN",9.8,"NM",16,0)
PSORN52^^0^B41220096
"BLD",5470,"KRN",9.8,"NM",17,0)
PSORXDL^^0^B58159508
"BLD",5470,"KRN",9.8,"NM",18,0)
PSOSULBL^^0^B38582182
"BLD",5470,"KRN",9.8,"NM",19,0)
PSOSUPOE^^0^B53974014
"BLD",5470,"KRN",9.8,"NM",20,0)
PSOSUPRX^^0^B45474972
"BLD",5470,"KRN",9.8,"NM",24,0)
PSOHLD^^0^B48797916
"BLD",5470,"KRN",9.8,"NM",25,0)
PSOHLDA^^0^B10413296
"BLD",5470,"KRN",9.8,"NM",27,0)
PSORN52A^^0^B17618155
"BLD",5470,"KRN",9.8,"NM",28,0)
PSOBPSUT^^0^B48196473
"BLD",5470,"KRN",9.8,"NM",29,0)
PSORXVW^^0^B58205807
"BLD",5470,"KRN",9.8,"NM",30,0)
PSOARX^^0^B37361096
"BLD",5470,"KRN",9.8,"NM",31,0)
PSORXPR^^0^B29756238
"BLD",5470,"KRN",9.8,"NM",32,0)
PSORXVW1^^0^B63758683
"BLD",5470,"KRN",9.8,"NM",33,0)
PSOORNE2^^0^B64900877
"BLD",5470,"KRN",9.8,"NM",35,0)
PSOCSRL^^0^B35996406
"BLD",5470,"KRN",9.8,"NM",36,0)
PSORXVW2^^0^B41122049
"BLD",5470,"KRN",9.8,"NM",37,0)
PSONDCUT^^0^B19534590
"BLD",5470,"KRN",9.8,"NM",38,0)
PSODISPS^^0^B29958665
"BLD",5470,"KRN",9.8,"NM",39,0)
PSODRG^^0^B30303688
"BLD",5470,"KRN",9.8,"NM",40,0)
PSOP1^^0^B25363822
"BLD",5470,"KRN",9.8,"NM",41,0)
PSOORNW1^^0^B42345668
"BLD",5470,"KRN",9.8,"NM",42,0)
PSOORNW2^^0^B43033604
"BLD",5470,"KRN",9.8,"NM",44,0)
PSODISP3^^0^B12357588
"BLD",5470,"KRN",9.8,"NM",46,0)
PSOHLDIS^^0^B68225842
"BLD",5470,"KRN",9.8,"NM",47,0)
PSOLMUTL^^0^B9324541
"BLD",5470,"KRN",9.8,"NM",48,0)
PSOREJP0^^0^B37884354
"BLD",5470,"KRN",9.8,"NM",49,0)
PSOREJP1^^0^B53365466
"BLD",5470,"KRN",9.8,"NM",50,0)
PSOREJUT^^0^B27615812
"BLD",5470,"KRN",9.8,"NM",52,0)
PSORXRP1^^0^B25369368
"BLD",5470,"KRN",9.8,"NM",53,0)
PSOREF^^0^B65936340
"BLD",5470,"KRN",9.8,"NM",54,0)
PSOVER1^^0^B52134870
"BLD",5470,"KRN",9.8,"NM",55,0)
PSORXRPT^^0^B37272513
"BLD",5470,"KRN",9.8,"NM",57,0)
PSOORCPY^^0^B21376105
"BLD",5470,"KRN",9.8,"NM",58,0)
PSORENW^^0^B34935503
"BLD",5470,"KRN",9.8,"NM",59,0)
PSORENW4^^0^B54619443
"BLD",5470,"KRN",9.8,"NM",60,0)
PSOREJU1^^0^B55721099
"BLD",5470,"KRN",9.8,"NM",61,0)
PSOREJP2^^0^B42289795
"BLD",5470,"KRN",9.8,"NM",62,0)
PSODAWUT^^0^B1596507
"BLD",5470,"KRN",9.8,"NM",63,0)
PSOORED7^^0^B10132898
"BLD",5470,"KRN",9.8,"NM",65,0)
PSORN52C^^0^B48742207
"BLD",5470,"KRN",9.8,"NM",66,0)
PSOBPSU1^^0^B40165335
"BLD",5470,"KRN",9.8,"NM",67,0)
PSOLLL3^^0^B8025943
"BLD",5470,"KRN",9.8,"NM",68,0)
PSOCAN2^^0^B66349002
"BLD",5470,"KRN",9.8,"NM",69,0)
PSOORED2^^0^B62628461
"BLD",5470,"KRN",9.8,"NM",70,0)
PSOORDRG^^0^B42987232
"BLD",5470,"KRN",9.8,"NM",71,0)
PSOCMOP^^0^B37025252
"BLD",5470,"KRN",9.8,"NM",72,0)
PSOORED3^^0^B55877013
"BLD",5470,"KRN",9.8,"NM",73,0)
PSORXL^^0^B71179264
"BLD",5470,"KRN",9.8,"NM",74,0)
PSORXL1^^0^B42190830
"BLD",5470,"KRN",9.8,"NM",76,0)
PSOREJU2^^0^B36306554
"BLD",5470,"KRN",9.8,"NM",79,0)
PSOCMOPB^^0^B12231465
"BLD",5470,"KRN",9.8,"NM",80,0)
PSOSUCHG^^0^B73300969
"BLD",5470,"KRN",9.8,"NM",81,0)
PSOSUCH1^^0^B18079381
"BLD",5470,"KRN",9.8,"NM",82,0)
PSOORAL^^0^B2433943
"BLD",5470,"KRN",9.8,"NM",83,0)
PSOORAL1^^0^B59592714
"BLD",5470,"KRN",9.8,"NM",84,0)
PSOHLDC^^0^B35362366
"BLD",5470,"KRN",9.8,"NM",85,0)
PSOHLEXP^^0^B10259031
"BLD",5470,"KRN",9.8,"NM",86,0)
PSOMAUEX^^0^B21036438
"BLD",5470,"KRN",9.8,"NM",87,0)
PSOORUTL^^0^B42520369
"BLD",5470,"KRN",9.8,"NM",88,0)
PSOAUTOC^^0^B66351677
"BLD",5470,"KRN",9.8,"NM",89,0)
PSOCAN3^^0^B71670516
"BLD",5470,"KRN",9.8,"NM",90,0)
PSOORED1^^0^B65457372
"BLD",5470,"KRN",9.8,"NM",91,0)
PSOVERC^^0^B9313505
"BLD",5470,"KRN",9.8,"NM",92,0)
PSOPKIV1^^0^B25219791
"BLD",5470,"KRN",9.8,"NM",93,0)
PSOLLLH^^0^B23086524
"BLD",5470,"KRN",9.8,"NM",94,0)
PSORXEDT^^0^B39919801
"BLD",5470,"KRN",9.8,"NM",95,0)
PSOHLNEW^^0^B78866487
"BLD",5470,"KRN",9.8,"NM","B","PSOARX",30)

"BLD",5470,"KRN",9.8,"NM","B","PSOAUTOC",88)

"BLD",5470,"KRN",9.8,"NM","B","PSOBPSU1",66)

"BLD",5470,"KRN",9.8,"NM","B","PSOBPSUT",28)

"BLD",5470,"KRN",9.8,"NM","B","PSOCAN2",68)

"BLD",5470,"KRN",9.8,"NM","B","PSOCAN3",89)

"BLD",5470,"KRN",9.8,"NM","B","PSOCMOP",71)

"BLD",5470,"KRN",9.8,"NM","B","PSOCMOPB",79)

"BLD",5470,"KRN",9.8,"NM","B","PSOCSRL",35)

"BLD",5470,"KRN",9.8,"NM","B","PSODAWUT",62)

"BLD",5470,"KRN",9.8,"NM","B","PSODISP",5)

"BLD",5470,"KRN",9.8,"NM","B","PSODISP3",44)

"BLD",5470,"KRN",9.8,"NM","B","PSODISPS",38)

"BLD",5470,"KRN",9.8,"NM","B","PSODRG",39)

"BLD",5470,"KRN",9.8,"NM","B","PSOHLD",24)

"BLD",5470,"KRN",9.8,"NM","B","PSOHLDA",25)

"BLD",5470,"KRN",9.8,"NM","B","PSOHLDC",84)

"BLD",5470,"KRN",9.8,"NM","B","PSOHLDIS",46)

"BLD",5470,"KRN",9.8,"NM","B","PSOHLEXP",85)

"BLD",5470,"KRN",9.8,"NM","B","PSOHLNEW",95)

"BLD",5470,"KRN",9.8,"NM","B","PSOLLL3",67)

"BLD",5470,"KRN",9.8,"NM","B","PSOLLLH",93)

"BLD",5470,"KRN",9.8,"NM","B","PSOLMUTL",47)

"BLD",5470,"KRN",9.8,"NM","B","PSOMAUEX",86)

"BLD",5470,"KRN",9.8,"NM","B","PSON52",7)

"BLD",5470,"KRN",9.8,"NM","B","PSONDCUT",37)

"BLD",5470,"KRN",9.8,"NM","B","PSOORAL",82)

"BLD",5470,"KRN",9.8,"NM","B","PSOORAL1",83)

"BLD",5470,"KRN",9.8,"NM","B","PSOORCPY",57)

"BLD",5470,"KRN",9.8,"NM","B","PSOORDRG",70)

"BLD",5470,"KRN",9.8,"NM","B","PSOORED1",90)

"BLD",5470,"KRN",9.8,"NM","B","PSOORED2",69)

"BLD",5470,"KRN",9.8,"NM","B","PSOORED3",72)

"BLD",5470,"KRN",9.8,"NM","B","PSOORED4",9)

"BLD",5470,"KRN",9.8,"NM","B","PSOORED6",10)

"BLD",5470,"KRN",9.8,"NM","B","PSOORED7",63)

"BLD",5470,"KRN",9.8,"NM","B","PSOOREDT",11)

"BLD",5470,"KRN",9.8,"NM","B","PSOORNE1",12)

"BLD",5470,"KRN",9.8,"NM","B","PSOORNE2",33)

"BLD",5470,"KRN",9.8,"NM","B","PSOORNW1",41)

"BLD",5470,"KRN",9.8,"NM","B","PSOORNW2",42)

"BLD",5470,"KRN",9.8,"NM","B","PSOORUT1",13)

"BLD",5470,"KRN",9.8,"NM","B","PSOORUTL",87)

"BLD",5470,"KRN",9.8,"NM","B","PSOP",14)

"BLD",5470,"KRN",9.8,"NM","B","PSOP1",40)

"BLD",5470,"KRN",9.8,"NM","B","PSOPKIV1",92)

"BLD",5470,"KRN",9.8,"NM","B","PSOR52",4)

"BLD",5470,"KRN",9.8,"NM","B","PSOREF",53)

"BLD",5470,"KRN",9.8,"NM","B","PSOREJP0",48)

"BLD",5470,"KRN",9.8,"NM","B","PSOREJP1",49)

"BLD",5470,"KRN",9.8,"NM","B","PSOREJP2",61)

"BLD",5470,"KRN",9.8,"NM","B","PSOREJU1",60)

"BLD",5470,"KRN",9.8,"NM","B","PSOREJU2",76)

"BLD",5470,"KRN",9.8,"NM","B","PSOREJUT",50)

"BLD",5470,"KRN",9.8,"NM","B","PSORENW",58)

"BLD",5470,"KRN",9.8,"NM","B","PSORENW4",59)

"BLD",5470,"KRN",9.8,"NM","B","PSORESK",15)

"BLD",5470,"KRN",9.8,"NM","B","PSORN52",16)

"BLD",5470,"KRN",9.8,"NM","B","PSORN52A",27)

"BLD",5470,"KRN",9.8,"NM","B","PSORN52C",65)

"BLD",5470,"KRN",9.8,"NM","B","PSORXDL",17)

"BLD",5470,"KRN",9.8,"NM","B","PSORXEDT",94)

"BLD",5470,"KRN",9.8,"NM","B","PSORXL",73)

"BLD",5470,"KRN",9.8,"NM","B","PSORXL1",74)

"BLD",5470,"KRN",9.8,"NM","B","PSORXPR",31)

"BLD",5470,"KRN",9.8,"NM","B","PSORXRP1",52)

"BLD",5470,"KRN",9.8,"NM","B","PSORXRPT",55)

"BLD",5470,"KRN",9.8,"NM","B","PSORXVW",29)

"BLD",5470,"KRN",9.8,"NM","B","PSORXVW1",32)

"BLD",5470,"KRN",9.8,"NM","B","PSORXVW2",36)

"BLD",5470,"KRN",9.8,"NM","B","PSOSUCH1",81)

"BLD",5470,"KRN",9.8,"NM","B","PSOSUCHG",80)

"BLD",5470,"KRN",9.8,"NM","B","PSOSULBL",18)

"BLD",5470,"KRN",9.8,"NM","B","PSOSUPOE",19)

"BLD",5470,"KRN",9.8,"NM","B","PSOSUPRX",20)

"BLD",5470,"KRN",9.8,"NM","B","PSOVER1",54)

"BLD",5470,"KRN",9.8,"NM","B","PSOVERC",91)

"BLD",5470,"KRN",19,0)
19
"BLD",5470,"KRN",19,"NM",0)
^9.68A^7^4
"BLD",5470,"KRN",19,"NM",3,0)
PSO EPHARMACY MENU^^0
"BLD",5470,"KRN",19,"NM",5,0)
PSO REJECTS VIEW/PROCESS^^0
"BLD",5470,"KRN",19,"NM",6,0)
PSO REJECTS WORKLIST^^0
"BLD",5470,"KRN",19,"NM",7,0)
PSO RX^^2
"BLD",5470,"KRN",19,"NM","B","PSO EPHARMACY MENU",3)

"BLD",5470,"KRN",19,"NM","B","PSO REJECTS VIEW/PROCESS",5)

"BLD",5470,"KRN",19,"NM","B","PSO REJECTS WORKLIST",6)

"BLD",5470,"KRN",19,"NM","B","PSO RX",7)

"BLD",5470,"KRN",19.1,0)
19.1
"BLD",5470,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5470,"KRN",101,0)
101
"BLD",5470,"KRN",101,"NM",0)
^9.68A^19^19
"BLD",5470,"KRN",101,"NM",1,0)
PSO REJECT DISPLAY IGNORE^^0
"BLD",5470,"KRN",101,"NM",2,0)
PSO REJECT DISPLAY MENU^^0
"BLD",5470,"KRN",101,"NM",3,0)
PSO REJECT DISPLAY OVERRIDE^^0
"BLD",5470,"KRN",101,"NM",4,0)
PSO REJECT DISPLAY RESUBMIT^^0
"BLD",5470,"KRN",101,"NM",5,0)
PSO REJECT DISPLAY RX EDIT^^0
"BLD",5470,"KRN",101,"NM",6,0)
PSO REJECT DISPLAY RX VIEW^^0
"BLD",5470,"KRN",101,"NM",7,0)
PSO REJECTS DRUG SORT^^0
"BLD",5470,"KRN",101,"NM",8,0)
PSO REJECTS MENU^^0
"BLD",5470,"KRN",101,"NM",9,0)
PSO REJECTS PATIENT SORT^^0
"BLD",5470,"KRN",101,"NM",10,0)
PSO REJECTS REASON SORT^^0
"BLD",5470,"KRN",101,"NM",11,0)
PSO REJECTS REFRESH^^0
"BLD",5470,"KRN",101,"NM",12,0)
PSO REJECTS RX SORT^^0
"BLD",5470,"KRN",101,"NM",13,0)
PSO REJECTS SELECT^^0
"BLD",5470,"KRN",101,"NM",14,0)
PSO REJECT DISPLAY OUTSIDE CALL^^0
"BLD",5470,"KRN",101,"NM",15,0)
PSO LM SELECT MENU^^3
"BLD",5470,"KRN",101,"NM",16,0)
PSO HIDDEN ACTIONS^^2
"BLD",5470,"KRN",101,"NM",17,0)
PSO REJECT DISPLAY SUSPENSE DATE^^0
"BLD",5470,"KRN",101,"NM",18,0)
PSO REJECT DISPLAY REOPEN^^0
"BLD",5470,"KRN",101,"NM",19,0)
PSO REJECT DISPLAY MENU - RESOLVED^^0
"BLD",5470,"KRN",101,"NM","B","PSO HIDDEN ACTIONS",16)

"BLD",5470,"KRN",101,"NM","B","PSO LM SELECT MENU",15)

"BLD",5470,"KRN",101,"NM","B","PSO REJECT DISPLAY IGNORE",1)

"BLD",5470,"KRN",101,"NM","B","PSO REJECT DISPLAY MENU",2)

"BLD",5470,"KRN",101,"NM","B","PSO REJECT DISPLAY MENU - RESOLVED",19)

"BLD",5470,"KRN",101,"NM","B","PSO REJECT DISPLAY OUTSIDE CALL",14)

"BLD",5470,"KRN",101,"NM","B","PSO REJECT DISPLAY OVERRIDE",3)

"BLD",5470,"KRN",101,"NM","B","PSO REJECT DISPLAY REOPEN",18)

"BLD",5470,"KRN",101,"NM","B","PSO REJECT DISPLAY RESUBMIT",4)

"BLD",5470,"KRN",101,"NM","B","PSO REJECT DISPLAY RX EDIT",5)

"BLD",5470,"KRN",101,"NM","B","PSO REJECT DISPLAY RX VIEW",6)

"BLD",5470,"KRN",101,"NM","B","PSO REJECT DISPLAY SUSPENSE DATE",17)

"BLD",5470,"KRN",101,"NM","B","PSO REJECTS DRUG SORT",7)

"BLD",5470,"KRN",101,"NM","B","PSO REJECTS MENU",8)

"BLD",5470,"KRN",101,"NM","B","PSO REJECTS PATIENT SORT",9)

"BLD",5470,"KRN",101,"NM","B","PSO REJECTS REASON SORT",10)

"BLD",5470,"KRN",101,"NM","B","PSO REJECTS REFRESH",11)

"BLD",5470,"KRN",101,"NM","B","PSO REJECTS RX SORT",12)

"BLD",5470,"KRN",101,"NM","B","PSO REJECTS SELECT",13)

"BLD",5470,"KRN",409.61,0)
409.61
"BLD",5470,"KRN",409.61,"NM",0)
^9.68A^3^3
"BLD",5470,"KRN",409.61,"NM",1,0)
PSO REJECT DISPLAY^^0
"BLD",5470,"KRN",409.61,"NM",2,0)
PSO REJECTS PROCESSING^^0
"BLD",5470,"KRN",409.61,"NM",3,0)
PSO REJECT DISPLAY - RESOLVED^^0
"BLD",5470,"KRN",409.61,"NM","B","PSO REJECT DISPLAY",1)

"BLD",5470,"KRN",409.61,"NM","B","PSO REJECT DISPLAY - RESOLVED",3)

"BLD",5470,"KRN",409.61,"NM","B","PSO REJECTS PROCESSING",2)

"BLD",5470,"KRN",771,0)
771
"BLD",5470,"KRN",771,"NM",0)
^9.68A^^0
"BLD",5470,"KRN",870,0)
870
"BLD",5470,"KRN",870,"NM",0)
^9.68A^^0
"BLD",5470,"KRN",8989.51,0)
8989.51
"BLD",5470,"KRN",8989.52,0)
8989.52
"BLD",5470,"KRN",8994,0)
8994
"BLD",5470,"KRN","B",.4,.4)

"BLD",5470,"KRN","B",.401,.401)

"BLD",5470,"KRN","B",.402,.402)

"BLD",5470,"KRN","B",.403,.403)

"BLD",5470,"KRN","B",.5,.5)

"BLD",5470,"KRN","B",.84,.84)

"BLD",5470,"KRN","B",3.6,3.6)

"BLD",5470,"KRN","B",3.8,3.8)

"BLD",5470,"KRN","B",9.2,9.2)

"BLD",5470,"KRN","B",9.8,9.8)

"BLD",5470,"KRN","B",19,19)

"BLD",5470,"KRN","B",19.1,19.1)

"BLD",5470,"KRN","B",101,101)

"BLD",5470,"KRN","B",409.61,409.61)

"BLD",5470,"KRN","B",771,771)

"BLD",5470,"KRN","B",870,870)

"BLD",5470,"KRN","B",8989.51,8989.51)

"BLD",5470,"KRN","B",8989.52,8989.52)

"BLD",5470,"KRN","B",8994,8994)

"BLD",5470,"QUES",0)
^9.62^^
"BLD",5470,"REQB",0)
^9.611^32^12
"BLD",5470,"REQB",16,0)
PSO*7.0*159^2
"BLD",5470,"REQB",20,0)
PSO*7.0*196^2
"BLD",5470,"REQB",22,0)
PSO*7.0*174^2
"BLD",5470,"REQB",23,0)
PSS*1.0*90^2
"BLD",5470,"REQB",24,0)
PSX*2.0*48^2
"BLD",5470,"REQB",25,0)
PSO*7.0*210^2
"BLD",5470,"REQB",27,0)
PSO*7.0*209^2
"BLD",5470,"REQB",28,0)
PSO*7.0*219^2
"BLD",5470,"REQB",29,0)
PSO*7.0*207^2
"BLD",5470,"REQB",30,0)
PSO*7.0*161^2
"BLD",5470,"REQB",31,0)
PSO*7.0*213^2
"BLD",5470,"REQB",32,0)
PSO*7.0*235^2
"BLD",5470,"REQB","B","PSO*7.0*159",16)

"BLD",5470,"REQB","B","PSO*7.0*161",30)

"BLD",5470,"REQB","B","PSO*7.0*174",22)

"BLD",5470,"REQB","B","PSO*7.0*196",20)

"BLD",5470,"REQB","B","PSO*7.0*207",29)

"BLD",5470,"REQB","B","PSO*7.0*209",27)

"BLD",5470,"REQB","B","PSO*7.0*210",25)

"BLD",5470,"REQB","B","PSO*7.0*213",31)

"BLD",5470,"REQB","B","PSO*7.0*219",28)

"BLD",5470,"REQB","B","PSO*7.0*235",32)

"BLD",5470,"REQB","B","PSS*1.0*90",23)

"BLD",5470,"REQB","B","PSX*2.0*48",24)

"FIA",52)
PRESCRIPTION
"FIA",52,0)
^PSRX(
"FIA",52,0,0)
52Is
"FIA",52,0,1)
y^y^p^^^^n^^n
"FIA",52,0,10)

"FIA",52,0,11)

"FIA",52,0,"RLRO")

"FIA",52,0,"VR")
7.0^PSO
"FIA",52,52)
1
"FIA",52,52,52.25)

"FIA",52,52,81)

"FIA",52,52,82)

"FIA",52,52.01)
1
"FIA",52,52.01,4)

"FIA",52,52.01,12)

"FIA",52,52.1)
1
"FIA",52,52.1,81)

"FIA",52,52.1,82)

"FIA",52,52.25)
0
"FIA",52,52.3)
1
"FIA",52,52.3,.02)

"IX",52,52,"REJDAT",0)
52^REJDAT^Cross-reference to sort REJECTs by the DATE/TIME DETECTED field.^R^^F^IR^W^52.25^^^^^LS
"IX",52,52,"REJDAT",1)
S ^PSRX("REJDAT",X,DA(1),DA)=""
"IX",52,52,"REJDAT",2)
K ^PSRX("REJDAT",X,DA(1),DA)
"IX",52,52,"REJDAT",2.5)
K ^PSRX("REJDAT")
"IX",52,52,"REJDAT",11.1,0)
^.114IA^1^1
"IX",52,52,"REJDAT",11.1,1,0)
1^F^52.25^1^^1^F
"IX",52,52,"REJDAT",11.1,1,3)

"IX",52,52,"REJSTS",0)
52^REJSTS^Cross-reference for the STATUS field in the REJECT INFO (#52.25) sub-file.^R^^F^IR^W^52.25^^^^^LS
"IX",52,52,"REJSTS",1)
S ^PSRX("REJSTS",X,DA(1),DA)=""
"IX",52,52,"REJSTS",2)
K ^PSRX("REJSTS",X,DA(1),DA)
"IX",52,52,"REJSTS",2.5)
K ^PSRX("REJSTS")
"IX",52,52,"REJSTS",11.1,0)
^.114IA^1^1
"IX",52,52,"REJSTS",11.1,1,0)
1^F^52.25^9^^1^F
"KRN",19,142,-1)
2^7
"KRN",19,142,0)
PSO RX^Rx (Prescriptions)^^M^327^^^^^^^147^^1^
"KRN",19,142,10,0)
^19.01IP^26^26
"KRN",19,142,10,26,0)
2927903
"KRN",19,142,10,26,"^")
PSO EPHARMACY MENU
"KRN",19,142,10,"A6359",1)
New Prescription Entry^449^^
"KRN",19,142,10,"A6359",2)
Refill Prescriptions^459^^
"KRN",19,142,10,"A6359",3)
Edit Prescriptions^469^^
"KRN",19,142,10,"A6359",4)
Reprint An Outpatient Label^470^^
"KRN",19,142,10,"A6359",5)
View Prescriptions^475^^
"KRN",19,142,10,"A6359",6)
Cancel Prescription^476^^
"KRN",19,142,10,"A6359",7)
Hold/Remove from Hold^479^^
"KRN",19,142,10,"A6359",8)
Partial Prescription^478^^
"KRN",19,142,"U")
RX (PRESCRIPTIONS)
"KRN",19,2927902,-1)
0^6
"KRN",19,2927902,0)
PSO REJECTS WORKLIST^Third Party Payer Rejects - Worklist^^R^^PSORPH^^^^^^OUTPATIENT PHARMACY^^
"KRN",19,2927902,1,0)
^19.06^5^5^3051028^^^^
"KRN",19,2927902,1,1,0)
This option gives user the ability to process Third Party Payer Rejects for
"KRN",19,2927902,1,2,0)
one, multiple or all Outpatient Pharmacy Divisions. Only OPEN/UNRESOLVED 
"KRN",19,2927902,1,3,0)
rejects that have clinical significance, such as DUR (Drug Utilization Review)
"KRN",19,2927902,1,4,0)
and Fill Too Soon, are added to the Worklist. Once the reject is marked 
"KRN",19,2927902,1,5,0)
CLOSED/RESOLVED it is automatically removed from the Worklist.
"KRN",19,2927902,20)

"KRN",19,2927902,25)
PSOREJP0
"KRN",19,2927902,"U")
THIRD PARTY PAYER REJECTS - WO
"KRN",19,2927903,-1)
0^3
"KRN",19,2927903,0)
PSO EPHARMACY MENU^ePharmacy Menu^^M^^^^^^^^
"KRN",19,2927903,10,0)
^19.01IP^2^2
"KRN",19,2927903,10,1,0)
2927902^WL
"KRN",19,2927903,10,1,"^")
PSO REJECTS WORKLIST
"KRN",19,2927903,10,2,0)
2927904^VP
"KRN",19,2927903,10,2,"^")
PSO REJECTS VIEW/PROCESS
"KRN",19,2927903,99)
60341,60924
"KRN",19,2927903,"U")
EPHARMACY MENU
"KRN",19,2927904,-1)
0^5
"KRN",19,2927904,0)
PSO REJECTS VIEW/PROCESS^Third Party Payer Rejects - View/Process^^R^^PSORPH^^^^^^
"KRN",19,2927904,1,0)
^19.06^5^5^3051028^^
"KRN",19,2927904,1,1,0)
This option provides information about Third Party Payer Rejects that have
"KRN",19,2927904,1,2,0)
clinical significance, such as DUR (Drug Utilization Review) and Fill Too Soon.
"KRN",19,2927904,1,3,0)
Past rejects that have already been CLOSED/RESOLVED can be viewed through this
"KRN",19,2927904,1,4,0)
option. Besides, this option also gives the user the ability to process OPEN/
"KRN",19,2927904,1,5,0)
RESOLVED in order to have them marked CLOSED/RESOLVED.
"KRN",19,2927904,25)
PSOREJP2
"KRN",19,2927904,"U")
THIRD PARTY PAYER REJECTS - VI
"KRN",101,4682,-1)
3^15
"KRN",101,4682,0)
PSO LM SELECT MENU^Order Selection Menu^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,4682,4)
25
"KRN",101,4682,10,0)
^101.01PA^12^10
"KRN",101,4682,24)
I $$ACTIONS^PSOLMUTL
"KRN",101,4682,26)
D A^PSOORUT3,SHOW^VALM S:$G(PSOACT)["E" XQORM("#")=$O(^ORD(101,"B","PSO LM EDIT SELECT ORDER",0))_"^1:21"
"KRN",101,4682,28)
Select Action: 
"KRN",101,4682,99)
60341,60924
"KRN",101,4689,-1)
2^16
"KRN",101,4689,0)
PSO HIDDEN ACTIONS^Outpatient Pharmacy Hidden Actions^^M^73335^^^^^^^147
"KRN",101,4689,10,0)
^101.01PA^32^32
"KRN",101,4689,10,32,0)
7399^REJ^35^
"KRN",101,4689,10,32,"^")
PSO REJECT DISPLAY OUTSIDE CALL
"KRN",101,7386,-1)
0^8
"KRN",101,7386,0)
PSO REJECTS MENU^Rejects Processing Menu^^M^^^^^^^^
"KRN",101,7386,4)
26^4
"KRN",101,7386,10,0)
^101.01PA^5^5
"KRN",101,7386,10,1,0)
7387^PA^^
"KRN",101,7386,10,1,"^")
PSO REJECTS PATIENT SORT
"KRN",101,7386,10,2,0)
7388^DR^^
"KRN",101,7386,10,2,"^")
PSO REJECTS DRUG SORT
"KRN",101,7386,10,3,0)
7389^RE^^
"KRN",101,7386,10,3,"^")
PSO REJECTS REASON SORT
"KRN",101,7386,10,4,0)
7390^RF^^
"KRN",101,7386,10,4,"^")
PSO REJECTS REFRESH
"KRN",101,7386,10,5,0)
7392^RX^^
"KRN",101,7386,10,5,"^")
PSO REJECTS RX SORT
"KRN",101,7386,20)

"KRN",101,7386,26)
D SHOW^VALM,HDR^PSOREJP0 S XQORM("#")=$O(^ORD(101,"B","PSO REJECTS SELECT",""))_"^1:"_(VALMCNT\2)
"KRN",101,7386,28)
Select: 
"KRN",101,7386,99)
60341,60924
"KRN",101,7387,-1)
0^9
"KRN",101,7387,0)
PSO REJECTS PATIENT SORT^Sort by Patient^^A^^^^^^^^
"KRN",101,7387,4)
^^^PA
"KRN",101,7387,20)
D PAT^PSOREJP0
"KRN",101,7387,99)
60341,60924
"KRN",101,7388,-1)
0^7
"KRN",101,7388,0)
PSO REJECTS DRUG SORT^Sort by Drug^^A^^^^^^^^
"KRN",101,7388,4)
^^^DR
"KRN",101,7388,20)
D DRG^PSOREJP0
"KRN",101,7388,99)
60341,60924
"KRN",101,7389,-1)
0^10
"KRN",101,7389,0)
PSO REJECTS REASON SORT^Sort by Reason^^A^^^^^^^^
"KRN",101,7389,4)
^^^RE
"KRN",101,7389,20)
D REA^PSOREJP0
"KRN",101,7389,99)
60341,60924
"KRN",101,7390,-1)
0^11
"KRN",101,7390,0)
PSO REJECTS REFRESH^Screen Refresh^^A^^^^^^^^
"KRN",101,7390,4)
^^^SR
"KRN",101,7390,20)
D REF^PSOREJP0
"KRN",101,7390,99)
60341,60924
"KRN",101,7391,-1)
0^13
"KRN",101,7391,0)
PSO REJECTS SELECT^Select Prescription^^A^^^^^^^^
"KRN",101,7391,4)
^^^SP
"KRN",101,7391,20)
D SEL^PSOREJP0
"KRN",101,7391,99)
60341,60924
"KRN",101,7392,-1)
0^12
"KRN",101,7392,0)
PSO REJECTS RX SORT^Sort by Prescription^^A^^^^^^^^
"KRN",101,7392,4)
^^^RX
"KRN",101,7392,20)
D RX^PSOREJP0
"KRN",101,7392,99)
60341,60924
"KRN",101,7394,-1)
0^3
"KRN",101,7394,0)
PSO REJECT DISPLAY OVERRIDE^Override Reject^^A^^^^^^^^
"KRN",101,7394,4)
^^^OVR
"KRN",101,7394,20)
D OVR^PSOREJP1
"KRN",101,7394,99)
60341,60924
"KRN",101,7395,-1)
0^4
"KRN",101,7395,0)
PSO REJECT DISPLAY RESUBMIT^Resubmit Claim^^A^^^^^^^^
"KRN",101,7395,4)
^^^RES
"KRN",101,7395,20)
D RES^PSOREJP1
"KRN",101,7395,99)
60341,60924
"KRN",101,7396,-1)
0^5
"KRN",101,7396,0)
PSO REJECT DISPLAY RX EDIT^Edit Rx^^A^^^^^^^^
"KRN",101,7396,4)
^^^ED
"KRN",101,7396,20)
D EDT^PSOREJP1
"KRN",101,7396,99)
60341,60924
"KRN",101,7397,-1)
0^2
"KRN",101,7397,0)
PSO REJECT DISPLAY MENU^Reject Display Menu^^M^^^^^^^^
"KRN",101,7397,4)
26^4
"KRN",101,7397,10,0)
^101.01PA^6^6
"KRN",101,7397,10,1,0)
7396^ED^2^
"KRN",101,7397,10,1,"^")
PSO REJECT DISPLAY RX EDIT
"KRN",101,7397,10,2,0)
7395^RES^5^
"KRN",101,7397,10,2,"^")
PSO REJECT DISPLAY RESUBMIT
"KRN",101,7397,10,3,0)
7394^OVR^4^
"KRN",101,7397,10,3,"^")
PSO REJECT DISPLAY OVERRIDE
"KRN",101,7397,10,4,0)
7405^IGN^3^
"KRN",101,7397,10,4,"^")
PSO REJECT DISPLAY IGNORE
"KRN",101,7397,10,5,0)
7398^VW^1^
"KRN",101,7397,10,5,"^")
PSO REJECT DISPLAY RX VIEW
"KRN",101,7397,10,6,0)
7436^CSD^6^
"KRN",101,7397,10,6,"^")
PSO REJECT DISPLAY SUSPENSE DATE
"KRN",101,7397,20)

"KRN",101,7397,26)
D SHOW^VALM,HDR^PSOREJP1
"KRN",101,7397,28)
Select: 
"KRN",101,7397,99)
60341,60924
"KRN",101,7398,-1)
0^6
"KRN",101,7398,0)
PSO REJECT DISPLAY RX VIEW^View Rx^^A^^^^^^^^
"KRN",101,7398,20)
D VIEW^PSOREJP1
"KRN",101,7398,99)
60341,60924
"KRN",101,7399,-1)
0^14
"KRN",101,7399,0)
PSO REJECT DISPLAY OUTSIDE CALL^View REJECT^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,7399,20)
S PSOREJRX=$P(PSOLST($P(PSLST,",",ORD)),"^",2) D OUT^PSOREJP1(PSOREJRX)
"KRN",101,7399,99)
60341,60924
"KRN",101,7405,-1)
0^1
"KRN",101,7405,0)
PSO REJECT DISPLAY IGNORE^Ignore Reject^^A^^^^^^^^
"KRN",101,7405,4)
^^^CR
"KRN",101,7405,20)
D CLO^PSOREJP2
"KRN",101,7405,99)
60341,60924
"KRN",101,7436,-1)
0^17
"KRN",101,7436,0)
PSO REJECT DISPLAY SUSPENSE DATE^Change Suspense Date^^A^^^^^^^^
"KRN",101,7436,4)
^^^
"KRN",101,7436,20)
D CHG^PSOREJP2
"KRN",101,7436,99)
60341,60924
"KRN",101,7445,-1)
0^19
"KRN",101,7445,0)
PSO REJECT DISPLAY MENU - RESOLVED^Reject Display Menu - Resolved^^M^^^^^^^^
"KRN",101,7445,4)
26^4
"KRN",101,7445,10,0)
^101.01PA^3^3
"KRN",101,7445,10,1,0)
7398^VW^1^
"KRN",101,7445,10,1,"^")
PSO REJECT DISPLAY RX VIEW
"KRN",101,7445,10,2,0)
7396^ED^2^
"KRN",101,7445,10,2,"^")
PSO REJECT DISPLAY RX EDIT
"KRN",101,7445,10,3,0)
7446^OPN^3^
"KRN",101,7445,10,3,"^")
PSO REJECT DISPLAY REOPEN
"KRN",101,7445,26)
D SHOW^VALM,HDR^PSOREJP1
"KRN",101,7445,28)
Select: 
"KRN",101,7445,99)
60341,60924
"KRN",101,7446,-1)
0^18
"KRN",101,7446,0)
PSO REJECT DISPLAY REOPEN^Reopen Reject^^A^^^^^^^^
"KRN",101,7446,4)
^^^
"KRN",101,7446,20)
D OPN^PSOREJP2
"KRN",101,7446,99)
60341,60924
"KRN",409.61,599,-1)
0^2
"KRN",409.61,599,0)
PSO REJECTS PROCESSING^1^^80^5^20^0^1^^PSO REJECTS MENU^Rejects Processing Screen^1^^1
"KRN",409.61,599,1)
^PSO HIDDEN ACTIONS #1
"KRN",409.61,599,"ARRAY")
 ^TMP("PSOREJP0",$J)
"KRN",409.61,599,"COL",0)
^409.621^^0
"KRN",409.61,599,"FNL")
D EXIT^PSOREJP0
"KRN",409.61,599,"HDR")
D HDR^PSOREJP0
"KRN",409.61,599,"HLP")
D HELP^PSOREJP0
"KRN",409.61,599,"INIT")
D INIT^PSOREJP0
"KRN",409.61,600,-1)
0^1
"KRN",409.61,600,0)
PSO REJECT DISPLAY^1^^80^7^20^0^1^^PSO REJECT DISPLAY MENU^Reject Information(UNRESOLVED)^1^^1
"KRN",409.61,600,1)
^PSO HIDDEN ACTIONS #1
"KRN",409.61,600,"ARRAY")
 ^TMP("PSOREJP1",$J)
"KRN",409.61,600,"COL",0)
^409.621^^0
"KRN",409.61,600,"FNL")
D EXIT^PSOREJP1
"KRN",409.61,600,"HDR")
D HDR^PSOREJP1
"KRN",409.61,600,"HLP")
D HELP^PSOREJP1
"KRN",409.61,600,"INIT")
D INIT^PSOREJP1
"KRN",409.61,605,-1)
0^3
"KRN",409.61,605,0)
PSO REJECT DISPLAY - RESOLVED^1^^80^7^21^0^1^^PSO REJECT DISPLAY MENU - RESOLVED^Reject Information(RESOLVED)^1^^1
"KRN",409.61,605,1)
^PSO HIDDEN ACTIONS #1
"KRN",409.61,605,"ARRAY")
 ^TMP("PSOREJP1",$J)
"KRN",409.61,605,"FNL")
D EXIT^PSOREJP1
"KRN",409.61,605,"HDR")
D HDR^PSOREJP1
"KRN",409.61,605,"HLP")
D HELP^PSOREJP1
"KRN",409.61,605,"INIT")
D INIT^PSOREJP1
"MBREQ")
1
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",147,-1)
1^1
"PKG",147,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",147,20,0)
^9.402P^^
"PKG",147,22,0)
^9.49I^1^1
"PKG",147,22,1,0)
7.0^2971216^2990115^327
"PKG",147,22,1,"PAH",1,0)
148^3060324^73335
"PKG",147,22,1,"PAH",1,1,0)
^^278^278^3060324
"PKG",147,22,1,"PAH",1,1,1,0)
The National Council for Prescription Drug Programs (NCPDP) standard was
"PKG",147,22,1,"PAH",1,1,2,0)
adopted under the Healthcare Insurance Portability and Accountability Act
"PKG",147,22,1,"PAH",1,1,3,0)
(HIPAA) for pharmacy claims. The HIPAA NCPDP - GLOBAL project involves six
"PKG",147,22,1,"PAH",1,1,4,0)
different applications that have been significantly changed to enable VA
"PKG",147,22,1,"PAH",1,1,5,0)
Medical Centers to perform third party electronic billing for prescriptions
"PKG",147,22,1,"PAH",1,1,6,0)
using the NCPDP standard. 
"PKG",147,22,1,"PAH",1,1,7,0)
 
"PKG",147,22,1,"PAH",1,1,8,0)
Below is a list of all the applications involved in this project along with
"PKG",147,22,1,"PAH",1,1,9,0)
their patch number:
"PKG",147,22,1,"PAH",1,1,10,0)
  
"PKG",147,22,1,"PAH",1,1,11,0)
   APPLICATION/VERSION                                  PATCH
"PKG",147,22,1,"PAH",1,1,12,0)
   -----------------------------------------------------------------
"PKG",147,22,1,"PAH",1,1,13,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*148
"PKG",147,22,1,"PAH",1,1,14,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*276
"PKG",147,22,1,"PAH",1,1,15,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*90
"PKG",147,22,1,"PAH",1,1,16,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0  PSX*2*48
"PKG",147,22,1,"PAH",1,1,17,0)
   ACCOUNTS RECEIVABLE (AR) V. 4.5                      PRCA*4.5*230
"PKG",147,22,1,"PAH",1,1,18,0)
   ELECTRONIC CLAIMS MANAGEMENT ENGINE (ECME) V. 1.0    BPS*1*1
"PKG",147,22,1,"PAH",1,1,19,0)
 
"PKG",147,22,1,"PAH",1,1,20,0)
Veterans Health Information Systems and Technology Architecture (VistA)
"PKG",147,22,1,"PAH",1,1,21,0)
software applications and infrastructure were enhanced, in order to allow the
"PKG",147,22,1,"PAH",1,1,22,0)
electronic transmission of outpatient pharmacy prescription claims (WINDOW
"PKG",147,22,1,"PAH",1,1,23,0)
and MAIL fills) to third party payers via the network connections available
"PKG",147,22,1,"PAH",1,1,24,0)
through the Austin Automation Center (AAC). VistA will be enhanced to receive
"PKG",147,22,1,"PAH",1,1,25,0)
electronic adjudicated responses from the third party payers, which include
"PKG",147,22,1,"PAH",1,1,26,0)
real-time processing for Drug Review Utilization and Refill Too Soon rejects.
"PKG",147,22,1,"PAH",1,1,27,0)
Reject information will be displayed to the pharmacist as the prescription is
"PKG",147,22,1,"PAH",1,1,28,0)
being processed. The pharmacist will have the capability to take the
"PKG",147,22,1,"PAH",1,1,29,0)
appropriate action to ensure patient safety or to override the reject and
"PKG",147,22,1,"PAH",1,1,30,0)
resubmit the claim to the payer for payment. When a status of "PAYABLE" is
"PKG",147,22,1,"PAH",1,1,31,0)
returned by the payer for a released prescription, VistA will automatically
"PKG",147,22,1,"PAH",1,1,32,0)
create the bill in IB, authorize it and immediately create the receivable in
"PKG",147,22,1,"PAH",1,1,33,0)
the AR application. Since the exact amount being paid by the payer is known,
"PKG",147,22,1,"PAH",1,1,34,0)
a decrease adjustment will be automatically generated and applied so that the
"PKG",147,22,1,"PAH",1,1,35,0)
receivable is equal to the net amount due from the payer.
"PKG",147,22,1,"PAH",1,1,36,0)
 
"PKG",147,22,1,"PAH",1,1,37,0)
The system also provides electronic payment matching capability (for
"PKG",147,22,1,"PAH",1,1,38,0)
electronically billable outpatient pharmacy prescriptions) using the existing
"PKG",147,22,1,"PAH",1,1,39,0)
Electronic Data Interchange (EDI) Lockbox functionality which processes other
"PKG",147,22,1,"PAH",1,1,40,0)
electronic payments from third party payers. This real-time electronic claims
"PKG",147,22,1,"PAH",1,1,41,0)
processing capability will be provided in accordance with the HIPAA, EDI
"PKG",147,22,1,"PAH",1,1,42,0)
and the NCPDP mandated format standards, specifically NCPDP Telecommunication
"PKG",147,22,1,"PAH",1,1,43,0)
Standard V. 5.1. Additional functionality delivered with this project 
"PKG",147,22,1,"PAH",1,1,44,0)
includes:
"PKG",147,22,1,"PAH",1,1,45,0)
 
"PKG",147,22,1,"PAH",1,1,46,0)
   . Auto-Release/Outpatient Pharmacy Automation Interface (OPAI) Integration.
"PKG",147,22,1,"PAH",1,1,47,0)
   . Back-billing capability to allow electronic billing of claims from within
"PKG",147,22,1,"PAH",1,1,48,0)
     the IB application.
"PKG",147,22,1,"PAH",1,1,49,0)
   . Capability to MOVE a group of subscribers from one insurance plan to
"PKG",147,22,1,"PAH",1,1,50,0)
     another while automatically "expiring" the old plan, which is a major
"PKG",147,22,1,"PAH",1,1,51,0)
     time saver.
"PKG",147,22,1,"PAH",1,1,52,0)
   . Pharmacy Dispensed As Written (DAW) prescription processing.
"PKG",147,22,1,"PAH",1,1,53,0)
  
"PKG",147,22,1,"PAH",1,1,54,0)
Overview of the Process:
"PKG",147,22,1,"PAH",1,1,55,0)
  
"PKG",147,22,1,"PAH",1,1,56,0)
When a prescription is about to be filled and dispensed by the pharmacy, the
"PKG",147,22,1,"PAH",1,1,57,0)
OP application submits the prescription to the new ECME application. ECME then
"PKG",147,22,1,"PAH",1,1,58,0)
contacts IB to verify whether or not the prescription is electronically
"PKG",147,22,1,"PAH",1,1,59,0)
billable. If so, ECME gathers the information necessary to generate a NCPDP
"PKG",147,22,1,"PAH",1,1,60,0)
claim. The claim information is passed to the VistA Health Level Seven (HL7)
"PKG",147,22,1,"PAH",1,1,61,0)
package. The HL7 package then sends the billing information to the AAC, where
"PKG",147,22,1,"PAH",1,1,62,0)
it is routed to the corresponding third party insurance via Emdeon (formerly
"PKG",147,22,1,"PAH",1,1,63,0)
WebMD).
"PKG",147,22,1,"PAH",1,1,64,0)
  
"PKG",147,22,1,"PAH",1,1,65,0)
Once the payer processes the information, the response coming back from the
"PKG",147,22,1,"PAH",1,1,66,0)
payer is passed back to the site that made the request, and the information
"PKG",147,22,1,"PAH",1,1,67,0)
is stored in the ECME package. If the third party payer accepted the claim,
"PKG",147,22,1,"PAH",1,1,68,0)
the adjudicated information is passed along to IB. If the claim was rejected
"PKG",147,22,1,"PAH",1,1,69,0)
the problem can be worked on and a new claim can be submitted to the payer.
"PKG",147,22,1,"PAH",1,1,70,0)
  
"PKG",147,22,1,"PAH",1,1,71,0)
For electronically billable CMOP prescription processing, the third party
"PKG",147,22,1,"PAH",1,1,72,0)
claim is sent before the prescription information is transmitted to the
"PKG",147,22,1,"PAH",1,1,73,0)
CMOP facility to be filled. Once the adjudicating response is electronically
"PKG",147,22,1,"PAH",1,1,74,0)
received from the third party payer, if there are no Drug Utilization Review
"PKG",147,22,1,"PAH",1,1,75,0)
or Refill Too Soon rejects, the prescription is then transmitted to the CMOP
"PKG",147,22,1,"PAH",1,1,76,0)
facility. When the CMOP center sends the dispensing information back to VistA,
"PKG",147,22,1,"PAH",1,1,77,0)
the National Drug Code (NDC) information is checked against the NDC sent to
"PKG",147,22,1,"PAH",1,1,78,0)
the third party payer and, if different, a new claim is generated in the
"PKG",147,22,1,"PAH",1,1,79,0)
background and is sent to the third party payer. In case the CMOP facility
"PKG",147,22,1,"PAH",1,1,80,0)
indicates that it is unable to fill a "PAYABLE" prescription fill, a reversal
"PKG",147,22,1,"PAH",1,1,81,0)
is automatically submitted to the third party payer for the corresponding
"PKG",147,22,1,"PAH",1,1,82,0)
fill.
"PKG",147,22,1,"PAH",1,1,83,0)
 
"PKG",147,22,1,"PAH",1,1,84,0)
This patch modifies the OP application to perform real-time electronic claim
"PKG",147,22,1,"PAH",1,1,85,0)
submission to third party payers. It will also enable OP users to see and act
"PKG",147,22,1,"PAH",1,1,86,0)
on third party payer rejects such as Drug Utilization Review (DUR) and Refill
"PKG",147,22,1,"PAH",1,1,87,0)
Too Soon rejects along with their daily normal prescription processing 
"PKG",147,22,1,"PAH",1,1,88,0)
activities. The following areas of OP have been changed:
"PKG",147,22,1,"PAH",1,1,89,0)
  
"PKG",147,22,1,"PAH",1,1,90,0)
1.  Patient Prescription Processing [PSO LM BACKDOOR ORDERS] option 
"PKG",147,22,1,"PAH",1,1,91,0)
 
"PKG",147,22,1,"PAH",1,1,92,0)
    At the point that the prescription is verified, the New Order, Edit,
"PKG",147,22,1,"PAH",1,1,93,0)
    Renew, Refill, and Pull Early from Suspense functions will begin the
"PKG",147,22,1,"PAH",1,1,94,0)
    third party billing evaluations. If IB determines that the
"PKG",147,22,1,"PAH",1,1,95,0)
    prescription is third party billable, a message will be displayed on
"PKG",147,22,1,"PAH",1,1,96,0)
    the user's screen stating that the claim is being submitted to ECME
"PKG",147,22,1,"PAH",1,1,97,0)
    and it will also show the progress of the claim. If the payer rejects
"PKG",147,22,1,"PAH",1,1,98,0)
    the claim for DUR or Refill Too Soon, the payer's information will be
"PKG",147,22,1,"PAH",1,1,99,0)
    displayed, and the user will be given the opportunity to either ignore
"PKG",147,22,1,"PAH",1,1,100,0)
    the payer's response and move on with the filling process; override
"PKG",147,22,1,"PAH",1,1,101,0)
    the reject by resubmitting the claim or postpone the processing of the
"PKG",147,22,1,"PAH",1,1,102,0)
    prescription by taking no action when the reject is received. For
"PKG",147,22,1,"PAH",1,1,103,0)
    prescriptions that have been electronically submitted to the third
"PKG",147,22,1,"PAH",1,1,104,0)
    party payer, an indicator is displayed on the Patient Prescription
"PKG",147,22,1,"PAH",1,1,105,0)
    Processing screen. This indicator will take the form of "e" next to
"PKG",147,22,1,"PAH",1,1,106,0)
    the prescription number (e.g.,"2090303$e").  
"PKG",147,22,1,"PAH",1,1,107,0)
  
"PKG",147,22,1,"PAH",1,1,108,0)
    A new section called REFILL TOO SOON/DUR REJECTS (Third Party) has
"PKG",147,22,1,"PAH",1,1,109,0)
    been created in the Medication Profile screen to single out
"PKG",147,22,1,"PAH",1,1,110,0)
    prescription that had an electronic claim rejected by third party
"PKG",147,22,1,"PAH",1,1,111,0)
    payers for REFILL TOO SOON or DUR reasons. Prescriptions under this
"PKG",147,22,1,"PAH",1,1,112,0)
    section have certain restrictions. Basically, they cannot be renewed,
"PKG",147,22,1,"PAH",1,1,113,0)
    refilled, reprinted, copied or released until the REJECT is resolved.
"PKG",147,22,1,"PAH",1,1,114,0)
    When an individual prescription is selected, the user will have a new
"PKG",147,22,1,"PAH",1,1,115,0)
    hidden option called REJ - View Reject, which will allow them to
"PKG",147,22,1,"PAH",1,1,116,0)
    resolve the REJECT and remove it from the REFILL TOO SOON/DUR REJECTS
"PKG",147,22,1,"PAH",1,1,117,0)
    (Third Party) section.
"PKG",147,22,1,"PAH",1,1,118,0)
   
"PKG",147,22,1,"PAH",1,1,119,0)
    The prescription release option was modified to perform NDC (National
"PKG",147,22,1,"PAH",1,1,120,0)
    Drug Code) validation for electronically billable prescriptions. When
"PKG",147,22,1,"PAH",1,1,121,0)
    the user selects a new NDC a new claim is submitted to the payer
"PKG",147,22,1,"PAH",1,1,122,0)
    before the prescription is released.
"PKG",147,22,1,"PAH",1,1,123,0)
   
"PKG",147,22,1,"PAH",1,1,124,0)
    In the OP Medications screen, a new DAW CODE field (#81) of the 
"PKG",147,22,1,"PAH",1,1,125,0)
    PRESCRIPTION file (#52) was created for electronically billable
"PKG",147,22,1,"PAH",1,1,126,0)
    prescriptions and can be edited by selecting '21' at the 'Select
"PKG",147,22,1,"PAH",1,1,127,0)
    Action' prompt. For non-electronically billable prescriptions this
"PKG",147,22,1,"PAH",1,1,128,0)
    field is not displayed at all.
"PKG",147,22,1,"PAH",1,1,129,0)
    
"PKG",147,22,1,"PAH",1,1,130,0)
    When the electronically billable prescription is released, this option
"PKG",147,22,1,"PAH",1,1,131,0)
    will allow the user to edit the NDC code for the prescription. In the
"PKG",147,22,1,"PAH",1,1,132,0)
    OP Medications screen the NDC field is listed under the Drug field
"PKG",147,22,1,"PAH",1,1,133,0)
    and can be edited by selecting '2' to edit the drug at the 'Select
"PKG",147,22,1,"PAH",1,1,134,0)
    Action' prompt. For sites that do not allow Drug editing, the option
"PKG",147,22,1,"PAH",1,1,135,0)
    '2' will allow editing of the NDC only.
"PKG",147,22,1,"PAH",1,1,136,0)
 
"PKG",147,22,1,"PAH",1,1,137,0)
2.  Return Medication to Stock [PSO RETURNED STOCK] option 
"PKG",147,22,1,"PAH",1,1,138,0)
 
"PKG",147,22,1,"PAH",1,1,139,0)
    The Return Medication to Stock function was modified to notify the
"PKG",147,22,1,"PAH",1,1,140,0)
    third party payer that a previously billed prescription was not
"PKG",147,22,1,"PAH",1,1,141,0)
    actually filled. If the prescription was previously billed to a third
"PKG",147,22,1,"PAH",1,1,142,0)
    party payer and a payable response was received, the claim will be
"PKG",147,22,1,"PAH",1,1,143,0)
    reversed, and the pharmacy user will see messaging stating that the
"PKG",147,22,1,"PAH",1,1,144,0)
    third party claim was submitted for reversal. If a claim for the
"PKG",147,22,1,"PAH",1,1,145,0)
    prescription was previously rejected by the third party payer, the
"PKG",147,22,1,"PAH",1,1,146,0)
    user will see a message indicating that no reversal was required. If
"PKG",147,22,1,"PAH",1,1,147,0)
    the prescription was not previously billed to a third party payer, no
"PKG",147,22,1,"PAH",1,1,148,0)
    message regarding electronic billing will be displayed.
"PKG",147,22,1,"PAH",1,1,149,0)
 
"PKG",147,22,1,"PAH",1,1,150,0)
3.  Delete a Prescription [PSO RXDL] option 
"PKG",147,22,1,"PAH",1,1,151,0)
 
"PKG",147,22,1,"PAH",1,1,152,0)
    The message for Delete a Prescription was modified to perform in the 
"PKG",147,22,1,"PAH",1,1,153,0)
    same manner as the Return Medication to Stock function described
"PKG",147,22,1,"PAH",1,1,154,0)
    above.
"PKG",147,22,1,"PAH",1,1,155,0)
  
"PKG",147,22,1,"PAH",1,1,156,0)
4.  Pull Early from Suspense [PSO PNDRX] option 
"PKG",147,22,1,"PAH",1,1,157,0)
  
"PKG",147,22,1,"PAH",1,1,158,0)
    The Pull Early from Suspense function was modified to submit a third 
"PKG",147,22,1,"PAH",1,1,159,0)
    party claim for the prescription. A message will display to notify the
"PKG",147,22,1,"PAH",1,1,160,0)
    user of the status of the claim as it is going through the submission 
"PKG",147,22,1,"PAH",1,1,161,0)
    process.  
"PKG",147,22,1,"PAH",1,1,162,0)
 
"PKG",147,22,1,"PAH",1,1,163,0)
5.  Print from Suspense File [PSO PNDLBL] option 
"PKG",147,22,1,"PAH",1,1,164,0)
 
"PKG",147,22,1,"PAH",1,1,165,0)
    This option was modified to submit third party claims in the same
"PKG",147,22,1,"PAH",1,1,166,0)
    manner as stated above except the Print from Suspense File function
"PKG",147,22,1,"PAH",1,1,167,0)
    will be performed in the background. No user interaction will occur.
"PKG",147,22,1,"PAH",1,1,168,0)
  
"PKG",147,22,1,"PAH",1,1,169,0)
6.  ePharmacy Menu [PSO EPHARMACY MENU] menu
"PKG",147,22,1,"PAH",1,1,170,0)
 
"PKG",147,22,1,"PAH",1,1,171,0)
    This new menu was created for electronic billing related options. It
"PKG",147,22,1,"PAH",1,1,172,0)
    is being placed under the Rx (Prescriptions) [PSO RX] menu. Two new
"PKG",147,22,1,"PAH",1,1,173,0)
    options are being added under this new menu:
"PKG",147,22,1,"PAH",1,1,174,0)
 
"PKG",147,22,1,"PAH",1,1,175,0)
    6.1 Third Party Payer Rejects - Worklist [PSO REJECTS WORKLIST] option
"PKG",147,22,1,"PAH",1,1,176,0)
 
"PKG",147,22,1,"PAH",1,1,177,0)
        This option is used to process third party payer rejects that have
"PKG",147,22,1,"PAH",1,1,178,0)
        clinical significance. For now, only DUR (Drug Utilization Review)
"PKG",147,22,1,"PAH",1,1,179,0)
        and REFILL TOO SOON rejects are being considered as having
"PKG",147,22,1,"PAH",1,1,180,0)
        clinical significance.
"PKG",147,22,1,"PAH",1,1,181,0)
 
"PKG",147,22,1,"PAH",1,1,182,0)
    6.2 Third Party Payer Rejects - View/Process [PSO REJECTS 
"PKG",147,22,1,"PAH",1,1,183,0)
        VIEW/PROCESS] option
"PKG",147,22,1,"PAH",1,1,184,0)
 
"PKG",147,22,1,"PAH",1,1,185,0)
        This option performs the same functionality as the option above.
"PKG",147,22,1,"PAH",1,1,186,0)
        However, the user has more filtering capabilities through this
"PKG",147,22,1,"PAH",1,1,187,0)
        option. In addition, closed/resolved rejects can only be viewed by
"PKG",147,22,1,"PAH",1,1,188,0)
        using this option.
"PKG",147,22,1,"PAH",1,1,189,0)
          
"PKG",147,22,1,"PAH",1,1,190,0)
7.  Release Medication [PSO RELEASE] option 
"PKG",147,22,1,"PAH",1,1,191,0)
 
"PKG",147,22,1,"PAH",1,1,192,0)
    The prescription release process was modified to perform NDC (National
"PKG",147,22,1,"PAH",1,1,193,0)
    Drug Code) validation for electronically billable prescriptions. When
"PKG",147,22,1,"PAH",1,1,194,0)
    the user selects a new NDC, a new claim is submitted to the payer
"PKG",147,22,1,"PAH",1,1,195,0)
    before the prescription is released. Besides this option, the 
"PKG",147,22,1,"PAH",1,1,196,0)
    prescription can be released from the Medication Profile screen and
"PKG",147,22,1,"PAH",1,1,197,0)
    from the Outpatient Rx's [PSD OUTPATIENT] option in the Controlled
"PKG",147,22,1,"PAH",1,1,198,0)
    Substances application.
"PKG",147,22,1,"PAH",1,1,199,0)
   
"PKG",147,22,1,"PAH",1,1,200,0)
8.  View Prescriptions [PSO VIEW] option
"PKG",147,22,1,"PAH",1,1,201,0)
  
"PKG",147,22,1,"PAH",1,1,202,0)
    This option was changed to include two new sections: ECME Log and ECME
"PKG",147,22,1,"PAH",1,1,203,0)
    REJECT Log. Information about third party payer submission and rejects
"PKG",147,22,1,"PAH",1,1,204,0)
    will be displayed under these sections.
"PKG",147,22,1,"PAH",1,1,205,0)
    
"PKG",147,22,1,"PAH",1,1,206,0)
9.  Edit Prescriptions [PSO RXEDIT] option
"PKG",147,22,1,"PAH",1,1,207,0)
 
"PKG",147,22,1,"PAH",1,1,208,0)
    The new DAW CODE field (#81) of the PRESCRIPTION file (#52) was
"PKG",147,22,1,"PAH",1,1,209,0)
    created for electronically billable prescriptions and can be edited
"PKG",147,22,1,"PAH",1,1,210,0)
    through this option. For non-electronically billable prescriptions,
"PKG",147,22,1,"PAH",1,1,211,0)
    the field is not displayed at all.
"PKG",147,22,1,"PAH",1,1,212,0)
    
"PKG",147,22,1,"PAH",1,1,213,0)
    Once an electronically billable prescription is released, this option
"PKG",147,22,1,"PAH",1,1,214,0)
    will allow the user to edit the NDC code. The NDC code is displayed on
"PKG",147,22,1,"PAH",1,1,215,0)
    the screen just below the Drug field, and can be edited by selecting
"PKG",147,22,1,"PAH",1,1,216,0)
    field '2' to edit the Drug. For sites that do not allow Drug editing,
"PKG",147,22,1,"PAH",1,1,217,0)
    the field '2' can be used to edit the NDC code only.
"PKG",147,22,1,"PAH",1,1,218,0)
 
"PKG",147,22,1,"PAH",1,1,219,0)
10. The NDC field (#4) under the CMOP EVENT multiple (#52.01) of the
"PKG",147,22,1,"PAH",1,1,220,0)
    PRESCRIPTION file (#52) has been renamed to NDC RECEIVED. This field
"PKG",147,22,1,"PAH",1,1,221,0)
    holds the NDC that was received from the CMOP facility with the
"PKG",147,22,1,"PAH",1,1,222,0)
    dispensing message. The renaming was necessary due to the addition of 
"PKG",147,22,1,"PAH",1,1,223,0)
    the NDC SENT field (#12) under the same multiple that is being created
"PKG",147,22,1,"PAH",1,1,224,0)
    by this project (see below item 11).
"PKG",147,22,1,"PAH",1,1,225,0)
  
"PKG",147,22,1,"PAH",1,1,226,0)
11. A new NDC SENT field (#12) is being created under the CMOP EVENT 
"PKG",147,22,1,"PAH",1,1,227,0)
    multiple (#52.01) of the PRESCRIPTION file (#52), to store the NDC
"PKG",147,22,1,"PAH",1,1,228,0)
    that was transmission to CMOP. This field is used for electronic 
"PKG",147,22,1,"PAH",1,1,229,0)
    billing purposes to analyze the difference between the NDC sent to
"PKG",147,22,1,"PAH",1,1,230,0)
    CMOP and the actual dispensed NDC by the CMOP facility.
"PKG",147,22,1,"PAH",1,1,231,0)
 
"PKG",147,22,1,"PAH",1,1,232,0)
12. A new DAW CODE field (#81) is being created on the PRESCRIPTION
"PKG",147,22,1,"PAH",1,1,233,0)
    file (#52) and also under the REFILL multiple (#52.1) of the
"PKG",147,22,1,"PAH",1,1,234,0)
    PRESCRIPTION file (#52). This field contains the NCPDP DAW used in the
"PKG",147,22,1,"PAH",1,1,235,0)
    electronic claims submission to third party payers (insurance
"PKG",147,22,1,"PAH",1,1,236,0)
    companies).
"PKG",147,22,1,"PAH",1,1,237,0)
 
"PKG",147,22,1,"PAH",1,1,238,0)
13. A new RE-TRANSMIT FLAG field (#82) is being created on the 
"PKG",147,22,1,"PAH",1,1,239,0)
    PRESCRIPTION file (#52) and also under the REFILL multiple (#52.1) of 
"PKG",147,22,1,"PAH",1,1,240,0)
    the PRESCRIPTION file (#52). This field is used to indicate that a
"PKG",147,22,1,"PAH",1,1,241,0)
    claim should be electronically re-transmitted to the 3rd party payer
"PKG",147,22,1,"PAH",1,1,242,0)
    (insurance company). It will be primarily used by CMOP and local mail
"PKG",147,22,1,"PAH",1,1,243,0)
    prescriptions.
"PKG",147,22,1,"PAH",1,1,244,0)
   
"PKG",147,22,1,"PAH",1,1,245,0)
14. A new multiple REJECT INFO field (#52.25) has been created on the
"PKG",147,22,1,"PAH",1,1,246,0)
    PRESCRIPTION file (#52) to store information about DUR and Refill Too
"PKG",147,22,1,"PAH",1,1,247,0)
    Soon Rejects returned by 3rd party payers. 
"PKG",147,22,1,"PAH",1,1,248,0)
    The following fields are part of this multiple:
"PKG",147,22,1,"PAH",1,1,249,0)
 
"PKG",147,22,1,"PAH",1,1,250,0)
        .01   NCPDP REJECT CODE      
"PKG",147,22,1,"PAH",1,1,251,0)
          1   DATE/TIME DETECTED     
"PKG",147,22,1,"PAH",1,1,252,0)
          2   PAYER MESSAGE          
"PKG",147,22,1,"PAH",1,1,253,0)
          3   REASON                 
"PKG",147,22,1,"PAH",1,1,254,0)
          4   PHARMACIST             
"PKG",147,22,1,"PAH",1,1,255,0)
          5   FILL NUMBER            
"PKG",147,22,1,"PAH",1,1,256,0)
          6   GROUP NAME             
"PKG",147,22,1,"PAH",1,1,257,0)
          7   PLAN CONTACT           
"PKG",147,22,1,"PAH",1,1,258,0)
          8   PLAN PREVIOUS FILL DATE
"PKG",147,22,1,"PAH",1,1,259,0)
          9   STATUS   
"PKG",147,22,1,"PAH",1,1,260,0)
         10   CLOSED DATE/TIME 
"PKG",147,22,1,"PAH",1,1,261,0)
         11   CLOSED BY
"PKG",147,22,1,"PAH",1,1,262,0)
         12   CLOSE REASON
"PKG",147,22,1,"PAH",1,1,263,0)
         13   CLOSE COMMENTS
"PKG",147,22,1,"PAH",1,1,264,0)
         14   REASON FOR SERVICE CODE
"PKG",147,22,1,"PAH",1,1,265,0)
         15   PROFESSIONAL SERVICE CODE
"PKG",147,22,1,"PAH",1,1,266,0)
         16   RESPONSE ID
"PKG",147,22,1,"PAH",1,1,267,0)
         17   OTHER REJECTS     
"PKG",147,22,1,"PAH",1,1,268,0)
         18   DUR TEXT          
"PKG",147,22,1,"PAH",1,1,269,0)
         19   RESULT OF SERVICE CODE
"PKG",147,22,1,"PAH",1,1,270,0)
         20   INSURANCE NAME    
"PKG",147,22,1,"PAH",1,1,271,0)
         21   GROUP NUMBER      
"PKG",147,22,1,"PAH",1,1,272,0)
         22   CARDHOLDER ID 
"PKG",147,22,1,"PAH",1,1,273,0)
         23   RE-OPENED
"PKG",147,22,1,"PAH",1,1,274,0)
 
"PKG",147,22,1,"PAH",1,1,275,0)
    Two new cross-references named "REJDAT" and "REJSTS" were created for
"PKG",147,22,1,"PAH",1,1,276,0)
    this multiple in the PRESCRIPTION file (#52). The "REJDAT" uses the
"PKG",147,22,1,"PAH",1,1,277,0)
    DATE/TIME DETECTED field (#1) and the "REJSTS" uses the STATUS field
"PKG",147,22,1,"PAH",1,1,278,0)
    (#9).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
77
"RTN","PSOARX")
0^30^B37361096
"RTN","PSOARX",1,0)
PSOARX ;B'ham ISC/SAB - display archived rxs ;03/10/94  1:08 pm 
"RTN","PSOARX",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,148**;DEC 1997
"RTN","PSOARX",3,0)
GET S RX=^PSRX(DA,0),J=DA,RX2=$G(^PSRX(DA,2)),R3=$G(^(3)),RTN=$G(^("TN")) S DFN=+$P(RX,"^",2) S ANS="",FFX=0
"RTN","PSOARX",4,0)
 S PSDIV=$S($D(^PS(59,+$P(RX2,"^",9),0)):$P(^(0),"^",1)_" ("_$P(^(0),"^",6)_")",1:"Unknown"),PSDIV=$E(PSDIV,1,28)
"RTN","PSOARX",5,0)
 S PSEXDT=$P(RX2,"^",6),PSEXDT=$S(PSEXDT]"":$E(PSEXDT,4,5)_"/"_$E(PSEXDT,6,7)_"/"_$E(PSEXDT,2,3),1:"Unknown")
"RTN","PSOARX",6,0)
PR D STAT
"RTN","PSOARX",7,0)
 W !!,"Rx: "_$P(RX,"^")
"RTN","PSOARX",8,0)
 S MED=+$P(RX,"^",6),M1="" S:$D(^PSDRUG(MED,0)) M1=^(0) W ?20,$S($P(M1,"^",3)["S":"      Item: ",1:"      Drug: "),$P(M1,"^",1),?65,$S(RTN'="":"Trade Name: "_RTN,1:"")
"RTN","PSOARX",9,0)
 W ?96,"QTY: ",$P(RX,"^",7),"     ",$S($P(RX,"^",8)?1N.N:$P(RX,"^",8),1:"??")," Day Supply"
"RTN","PSOARX",10,0)
 W !?7,"SIG: "
"RTN","PSOARX",11,0)
 I '$P(^PSRX(DA,"SIG"),"^",2) S (SIG,X)=$P($G(^PSRX(DA,"SIG")),"^") D SIGONE^PSOHELP W SIG G RFL
"RTN","PSOARX",12,0)
 F I=0:0 S I=$O(^PSRX(DA,"SIG1",I)) Q:'I  W $P(^PSRX(DA,"SIG1",I,0),"^") W:$O(^PSRX(DA,"SIG1",I)) !?12
"RTN","PSOARX",13,0)
RFL S II=J D LAST^PSORFL W !?4,"Latest: "_RFL,?37,"# of Refills: "_$P(RX,"^",9)
"RTN","PSOARX",14,0)
 S RFM=$P(RX,"^",9),PL=0 I $O(^PSRX(DA,1,0)) F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RFM=RFM-1,PL=PL+1
"RTN","PSOARX",15,0)
 W "  Remaining: "_RFM
"RTN","PSOARX",16,0)
 S PHYS=$S($D(^VA(200,+$P(RX,"^",4),0)):$P(^(0),"^"),1:"Unknown") W ?70,"Provider: "_PHYS
"RTN","PSOARX",17,0)
DTT S DTT=$P(RX,"^",13) D DAT W !?4,"Issued: "_DAT,?43,"Clinic: "_$S($D(^SC(+$P(RX,"^",5),0)):$P(^(0),"^",1),1:"Not on File"),?71,"Division: "_PSDIV
"RTN","PSOARX",18,0)
 S DTT=$P(RX2,"^",1)\1 D DAT W !?4,"Logged: "_DAT,?42,"Routing: " S X=$F("MWI",$P(RX,"^",11))-1 W:X $P("Mail^Window^Inpatient","^",X),?69,"Clerk Code: "_$S($D(^VA(200,+$P(RX,"^",16),0)):$P(^(0),"^"),1:"Unknown")
"RTN","PSOARX",19,0)
 W !?3,"Expires: "_PSEXDT
"RTN","PSOARX",20,0)
 W ?46,"Cap: "_$P("Non-^","^",$S($D(^PS(55,DFN,0)):+$P(^(0),"^",2),1:0)),"Safety",?73,"Status: "_ST I ($D(PS)#2),PS="DISCONTINUE",ST["DISCONTINUE" S PS="Reinstate"
"RTN","PSOARX",21,0)
 G:$D(PSOZVER) REM S DTT=$P(RX2,"^",2) D DAT W !?4,"Filled: "_DAT,?24,"Pharmacist: "_$S($D(^VA(200,+$P(RX2,"^",3),0)):$P(^(0),"^",1),1:""),?56,"Verifying Pharmacist: "_$S($D(^VA(200,+$P(RX2,"^",10),0)):$P(^(0),"^",1),1:"")
"RTN","PSOARX",22,0)
 W ?75,"Lot #: "_$P(RX2,"^",4),?85," QTY: "_$P(RX,"^",7)
"RTN","PSOARX",23,0)
REM W !?2,$S($P(RX2,"^",15):"Returned to Stock:  "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3),1:"Released: "_$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:""))
"RTN","PSOARX",24,0)
 W !?3,"Remarks: "_$P(R3,"^",7)
"RTN","PSOARX",25,0)
 S PSOZ=0 D HEAD:PL F N=0:0 S N=$O(^PSRX(DA,1,N)) Q:'N  S P1=^(N,0) D N G Q:ANS'=""
"RTN","PSOARX",26,0)
ACT G Q:'$O(^PSRX(DA,"A",0)) G Q:ANS="^" D H1 F N=0:0 D LP1 Q:PSOZ
"RTN","PSOARX",27,0)
 I $O(^PSRX(DA,4,0)) D CMOP^PSOARCTG
"RTN","PSOARX",28,0)
 G Q
"RTN","PSOARX",29,0)
A1 D H1:FFX,DAT1 W !,N1,?3,DAT1,?14 S X=$P(P1,U,2),X=$F("HUCELPRWSIVDABXGKNM",X)-1
"RTN","PSOARX",30,0)
 W:X $P("Hold^Unhold^DC'd^Edit^Renewed^Partial^Reinstate^Reprint^Suspense^Returned Stock^Intervention^Deleted^Drug Interaction^Processed^X-Interface^Patient Inst.^PKI/DEA^Dispense Completed^ECME^","^",X) W ?25
"RTN","PSOARX",31,0)
 S X=$P(P1,U,4) W:X]"" $S(X>0&(X<6):"Refill "_X,X=6:"Partial",X>6:"Refill "_(X-1),1:"Original"),?35,$S($D(^VA(200,+$P(P1,"^",3),0)):$P(^(0),"^",1),1:"Unknown")
"RTN","PSOARX",32,0)
 G:PSOZ A2 W ?60,N2,?63,DAT2,?74 S X=$P(P2,U,2),X=$F("HUCELPRWSIVDABXGKNM",X)-1
"RTN","PSOARX",33,0)
 W:X $P("Hold^Unhold^DC'd^Edit^Renewed^Partial^Reinstate^Reprint^Suspense^Returned Stock^Intervention^Deleted^Drug Interaction^Processed^X-Interface^Patient Inst.^PKI/DEA^Dispense Completed^ECME^","^",X) W ?85
"RTN","PSOARX",34,0)
 S X=$P(P2,U,4) W:X]"" $S(X>0&(X<6):"Refill "_X,X=6:"Partial",X>6:"Refill "_(X-1),1:"Original"),?95,$S($D(^VA(200,+$P(P1,"^",3),0)):$P(^(0),"^",1),1:"Unknown")
"RTN","PSOARX",35,0)
A2 W:($P(P1,U,5)]"")!(('PSOZ)&($P(P2,U,5)]"")) ! W:$P(P1,U,5)]"" ?5,"Comment: "_$E($P(P1,U,5),1,45) Q:PSOZ  W:$P(P2,U,5)]"" ?65,"Comment: "_$E($P(P2,U,5),1,45)
"RTN","PSOARX",36,0)
 I ($L($P(P1,U,5))>45)!($L($P(P2,U,5))>45) W ! W:$L($P(P1,U,5))>45 ?14,$E($P(P1,U,5),46,75) W:('PSOZ)&($L($P(P2,U,5))>45) ?79,$E($P(P2,U,5),46,75)
"RTN","PSOARX",37,0)
 Q
"RTN","PSOARX",38,0)
N S (DTT1,DTT2)="" Q:ANS="^"  D HEAD:FFX W !,N,?3 S DTT1=$P(P1,"^",8)\1,DTT2=$P(P1,U,1) D DAT1 W DAT1,?14,DAT2,?27,$P(P1,"^",4),?32
"RTN","PSOARX",39,0)
 S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^"),1:"Unknown")
"RTN","PSOARX",40,0)
 S X=$P(P1,"^",2),X=$F("MWIBD",X)-1 W:X $P("Mail^Window^Inpatient","^",X),?40,$P(P1,"^",6),?52,$E($S($D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^",1),1:""),1,16),?70,PSDIV
"RTN","PSOARX",41,0)
 W !?4,$S($P(P1,"^",16):"Returned to Stock:  "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:"Released: "_$S($P(P1,"^",18):$E($P(P1,"^",18),4,5)_"/"_$E($P(P1,"^",18),6,7)_"/"_$E($P(P1,"^",18),2,3),1:""))
"RTN","PSOARX",42,0)
 I $P($G(^PSRX(DA,1,N,"IB")),"^")]"" W "     Copay Billing #:  "_$P($G(^PSRX(DA,1,N,"IB")),"^")
"RTN","PSOARX",43,0)
 W !?5,"Remarks: "_$P(P1,"^",3) Q
"RTN","PSOARX",44,0)
Q K ANS,PSDIV,PSEXDT,MED,M1,FFX,DTT,DAT,RX,RX2,R3,RTN,SIG,STA,P1,PL,P0,Z0,Z1,EXDT,DAT1,DAT2,DTT1,DTT2,I,N,N1,N2,P2,PSOAC,PSOZ,RFM
"RTN","PSOARX",45,0)
 Q
"RTN","PSOARX",46,0)
LP1 S PSOZ=0,(N,N1)=$O(^PSRX(DA,"A",N)) S:'N PSOZ=1 Q:PSOZ  S P1=^(N1,0),DTT1=P1\1,(N,N2)=$O(^PSRX(DA,"A",N)) S:'N PSOZ=1 S (P2,DTT2)=""
"RTN","PSOARX",47,0)
 I 'PSOZ S P2=^PSRX(DA,"A",N2,0),DTT2=P2\1
"RTN","PSOARX",48,0)
 D A1
"RTN","PSOARX",49,0)
 Q
"RTN","PSOARX",50,0)
HEAD D:$Y>(PSOACPL-20) HD1^PSOARCSV
"RTN","PSOARX",51,0)
 W !,"#",?3,"Log Date",?14,"Refill Date",?27,"QTY",?32,"Routing",?40,"Lot #",?52,"Pharmacist",?70,"Division",! F I=1:1:79 W "="
"RTN","PSOARX",52,0)
 S FFX=0 Q
"RTN","PSOARX",53,0)
H1 ;
"RTN","PSOARX",54,0)
 W !!,"Activity Log:",!,"#",?3,"Date",?14,"Reason",?25,"Rx Ref",?35,"Security",?60,"#",?63,"Date",?74,"Reason",?85,"Rx Ref",?95,"Security",! F I=1:1:55 W "="
"RTN","PSOARX",55,0)
 W ?60 F I=1:1:60 W "="
"RTN","PSOARX",56,0)
 Q
"RTN","PSOARX",57,0)
DAT ;
"RTN","PSOARX",58,0)
 S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSOARX",59,0)
 Q
"RTN","PSOARX",60,0)
DAT1 S (DAT1,DAT2)="",DTT1=DTT1\1,DTT2=DTT2\1 S:DTT1?7N DAT1=$E(DTT1,4,5)_"/"_$E(DTT1,6,7)_"/"_$E(DTT1,2,3) S:(DTT2?7N)&('PSOZ) DAT2=$E(DTT2,4,5)_"/"_$E(DTT2,6,7)_"/"_$E(DTT2,2,3)
"RTN","PSOARX",61,0)
 Q
"RTN","PSOARX",62,0)
STAT ;gets status of rx
"RTN","PSOARX",63,0)
 S ST0=$P(^PSRX(DA,"STA"),"^") I ST0<12,$O(^PS(52.5,"B",J,0)),$D(^PS(52.5,+$O(^(0)),0)),'$G(^("P")) S ST0=5
"RTN","PSOARX",64,0)
 I ST0<12,$P(RX2,"^",6)<DT S ST0=11
"RTN","PSOARX",65,0)
 S ST=$P("Error^Active^Non-Verified^Refill^Hold^Non-Verified^Suspended^^^^^Done^Expired^Discontinued^Deleted^Discontinued^Discontinued (Edit)^Provider Hold^","^",ST0+2)
"RTN","PSOARX",66,0)
 Q
"RTN","PSOAUTOC")
0^88^B66351677
"RTN","PSOAUTOC",1,0)
PSOAUTOC ;BIR/SAB - autocancel rxs on admission ;08/15/94
"RTN","PSOAUTOC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,24,30,36,88,146,132,223,148**;DEC 1997
"RTN","PSOAUTOC",3,0)
 ;External reference to File #59.7 supported by DBIA 694
"RTN","PSOAUTOC",4,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOAUTOC",5,0)
 ;External reference ^DPT(PSODFN,.1) supported by DBIA 10035
"RTN","PSOAUTOC",6,0)
 ;External reference ^DGPM("AMV1" supported by DBIA 2249
"RTN","PSOAUTOC",7,0)
 ;External reference ^DGPM("APTT1" supported by DBIA 2249
"RTN","PSOAUTOC",8,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSOAUTOC",9,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOAUTOC",10,0)
AUTO I '$P(^PS(59.7,1,40.1),"^") W $C(7),!,"Autocancel System Parameter must be set to 'YES'",!,"before prescriptions are discontinued."
"RTN","PSOAUTOC",11,0)
 K %DT,DIC S DIC(0)="XZM",(DIE,DIC)="^DIC(19.2,",X="PSO AUTOCANCEL" D ^DIC
"RTN","PSOAUTOC",12,0)
 I +Y>0 D EDIT^XUTMOPT("PSO AUTOCANCEL") G EX
"RTN","PSOAUTOC",13,0)
 D RESCH^XUTMOPT("PSO AUTOCANCEL","","","24H","L"),EDIT^XUTMOPT("PSO AUTOCANCEL")
"RTN","PSOAUTOC",14,0)
EX K Y,C,D,D0,DI,DQ,DA,DIE,DR,DIC,X
"RTN","PSOAUTOC",15,0)
 Q
"RTN","PSOAUTOC",16,0)
TASK ;TaskMan entry point
"RTN","PSOAUTOC",17,0)
 G:'$P(^PS(59.7,1,40.1),"^") KILL S X="T-3" D ^%DT S PSOD2=Y,PSOD0=Y-.01,PSODL=Y+.3
"RTN","PSOAUTOC",18,0)
 S PSOD=PSOD0 F  S PSOD=$O(^DGPM("AMV1",PSOD)),PSODFN=0 Q:'PSOD!(PSOD>PSODL)  F PSODFN=0:0 S PSODFN=$O(^DGPM("AMV1",PSOD,PSODFN)) Q:'PSODFN  I $G(^DPT(PSODFN,.1))]"",$O(^PS(55,PSODFN,"P",0)),'$O(^DGPM("APTT1",PSODFN,PSOD)) D CAN
"RTN","PSOAUTOC",19,0)
 G KILL
"RTN","PSOAUTOC",20,0)
CAN ;discontinue Rxs
"RTN","PSOAUTOC",21,0)
 S DFN=PSODFN K VAIN D INP^VADPT I $P($G(VAIN(4)),"^"),$D(^PS(59.7,1,40.19,"B",$P($G(VAIN(4)),"^"))) Q
"RTN","PSOAUTOC",22,0)
 I $D(^PS(55,PSODFN,0)),$P($G(^PS(55,PSODFN,0)),U,6)'=2 D EN^PSOHLUP(PSODFN)
"RTN","PSOAUTOC",23,0)
 F PSORXJ=0:0 S PSORXJ=$O(^PS(55,PSODFN,"P",PSORXJ)) Q:'PSORXJ  I $D(^(PSORXJ,0)) S PSORX=^(0) D
"RTN","PSOAUTOC",24,0)
 .I $D(^PSRX(PSORX,0)) S PSO0=^(0),PSO2=$G(^(2)),STA=+^("STA") I STA<11,PSO2,$P(PSO2,"^",6)'<DT,$E(PSO2,1,7)'>PSOD2!(STA=16) D
"RTN","PSOAUTOC",25,0)
 ..S $P(^PSRX(PSORX,3),"^",5)=$S($P($G(^PSRX(PSORX,3)),"^"):$P(^(3),"^"),1:DT),$P(^("STA"),"^")=12
"RTN","PSOAUTOC",26,0)
 ..D REVERSE^PSOBPSU1(PSORX,,"DC",7)
"RTN","PSOAUTOC",27,0)
 ..D CAN^PSOTPCAN(PSORX)
"RTN","PSOAUTOC",28,0)
 ..D FIL^PSOCAN3
"RTN","PSOAUTOC",29,0)
 ..;remove from hold
"RTN","PSOAUTOC",30,0)
 ..I $G(^PSRX(PSORX,"H"))]"" D
"RTN","PSOAUTOC",31,0)
 ...K:$P(^PSRX(PSORX,"H"),"^") ^PSRX("AH",$P(^PSRX(PSORX,"H"),"^"),PSORX) S ^PSRX(PSORX,"H")=""
"RTN","PSOAUTOC",32,0)
 ...I '$P($G(^PSRX(PSORX,2)),"^",2),$P($G(^(3)),"^") S $P(^PSRX(PSORX,2),"^",2)=$P(^(3),"^")
"RTN","PSOAUTOC",33,0)
 ..;Add activity record
"RTN","PSOAUTOC",34,0)
 ..S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(PSORX,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOAUTOC",35,0)
 ..S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(PSORX,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOAUTOC",36,0)
 ..D NOW^%DTC S ACNT=ACNT+1,^PSRX(PSORX,"A",0)="^52.3DA^"_ACNT_"^"_ACNT S ^PSRX(PSORX,"A",ACNT,0)=%_"^"_"C"_"^^"_RFCNT_"^"_"Auto Discontinued on Admission"
"RTN","PSOAUTOC",37,0)
 ..;delete from suspense
"RTN","PSOAUTOC",38,0)
 ..D:$O(^PS(52.5,"B",PSORX,0))
"RTN","PSOAUTOC",39,0)
 ...I $O(^PSRX(PSORX,1,0)) S DA=PSORX,SUSD=$P($G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),0)),"^",2) D:'$G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),"P")) REF^PSOCAN2
"RTN","PSOAUTOC",40,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)),DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOAUTOC",41,0)
 ..;remove from non-verified file
"RTN","PSOAUTOC",42,0)
 ..I $G(^PS(52.4,PSORX,0))]"" S DIK="^PS(52.4,",DA=PSORX D ^DIK K DIK
"RTN","PSOAUTOC",43,0)
 ..S STAT="OD",PHARMST="",COM="Auto Discontinued on Admission" D EN^PSOHLSN1(PSORX,STAT,PHARMST,COM,"A")
"RTN","PSOAUTOC",44,0)
 ;auto-dc pending orders
"RTN","PSOAUTOC",45,0)
 ;F PSOIORD=0:0 S PSOIORD=$O(^PS(52.41,"AOR",PSODFN,PSOIORD)) Q:'PSOIORD  F PSORD=0:0 S PSORD=$O(^PS(52.41,"AOR",PSODFN,PSOIORD,PSORD)) Q:'PSORD  D
"RTN","PSOAUTOC",46,0)
 ;.I $P(^PS(52.41,PSORD,0),"^",3)="RF" S DA=PSORD,DIK="^PS(52.41," D ^DIK K DA,DIK Q
"RTN","PSOAUTOC",47,0)
 ;.K ^PS(52.41,"AOR",PSODFN,PSOIORD,PSORD) S $P(^PS(52.41,PSORD,0),"^",3)="DC"
"RTN","PSOAUTOC",48,0)
 ;.D EN^PSOHLSN(+^PS(52.41,PSORD,0),"OC","Auto Canceled on Admission","A")
"RTN","PSOAUTOC",49,0)
 K PSORD,PSOIORD
"RTN","PSOAUTOC",50,0)
 Q
"RTN","PSOAUTOC",51,0)
KILL K %,%H,%T,ACNT,DA,DFN,DIRUT,DTOUT,PSO,PSO0,PSO2,PSOD,PSOD0,PSOD2,PSODFN,PSODL,PSORX,PSORXJ,PSOSD,RF,RFCNT,SUB,TM,TSKDT,VAIN,X,X1,X2,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","PSOAUTOC",52,0)
 K ORD,PHARMST,STAT,COM S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOAUTOC",53,0)
 Q
"RTN","PSOAUTOC",54,0)
SETUP ;initialize nightly Rx cost compile job
"RTN","PSOAUTOC",55,0)
 K %DT,DIC,DTOUT S DIC(0)="XZM",DIC="^DIC(19.2,",X="PSO COSTDAY NIGHTJOB" D ^DIC
"RTN","PSOAUTOC",56,0)
 I +Y>0 D EDIT^XUTMOPT("PSO COSTDAY NIGHTJOB") G OUT
"RTN","PSOAUTOC",57,0)
 D RESCH^XUTMOPT("PSO COSTDAY NIGHTJOB","","","24H","L"),EDIT^XUTMOPT("PSO COSTDAY NIGHTJOB")
"RTN","PSOAUTOC",58,0)
OUT K Y,DIC,X,PSOTM,PSOOPTN,PSOPTN,%DT,DTOUT
"RTN","PSOAUTOC",59,0)
 Q
"RTN","PSOAUTOC",60,0)
 ;initialize management data compile job
"RTN","PSOAUTOC",61,0)
SETUP1 K %DT,DIC,DTOUT S DIC(0)="ZXM",DIC="^DIC(19.2,",X="PSO MGMT NIGHTLY COMPILE" D ^DIC
"RTN","PSOAUTOC",62,0)
 I +Y>0 D EDIT^XUTMOPT("PSO MGMT NIGHTLY COMPILE") G OUT
"RTN","PSOAUTOC",63,0)
 D RESCH^XUTMOPT("PSO MGMT NIGHTLY COMPILE","","","24H","L"),EDIT^XUTMOPT("PSO MGMT NIGHTLY COMPILE")
"RTN","PSOAUTOC",64,0)
 K Y,DIC,X,PSOTM,DIR,PSOOPTN,PSOPTN,%DT,DTOUT
"RTN","PSOAUTOC",65,0)
 Q
"RTN","PSOAUTOC",66,0)
APSOD(PSODFN) ;sends mail message that date of death has been deleted
"RTN","PSOAUTOC",67,0)
 I $G(PSODFN),$D(^PS(52.91,PSODFN,0)) D
"RTN","PSOAUTOC",68,0)
 .I $P(^PS(52.91,PSODFN,0),"^",3),$P(^(0),"^",4)=5 D
"RTN","PSOAUTOC",69,0)
 ..S $P(^PS(52.91,PSODFN,0),"^",3)="",$P(^PS(52.91,PSODFN,0),"^",4)=""
"RTN","PSOAUTOC",70,0)
 ..S ^PS(52.91,"AX",DT,PSODFN)=""
"RTN","PSOAUTOC",71,0)
 ..I $D(^PS(55,PSODFN,0)),$P($G(^PS(55,PSODFN,"PS")),"^")="" D
"RTN","PSOAUTOC",72,0)
 ...N PSORESPS,PSORESFG,PSORESF1 S PSORESFG=0 F PSORESPS=0:0 S PSORESPS=$O(^PS(53,PSORESPS)) Q:'PSORESPS!(PSORESFG)  D
"RTN","PSOAUTOC",73,0)
 ....S PSORESF1=$P($G(^PS(53,PSORESPS,0)),"^") S PSORESF1=$$UP^XLFSTR(PSORESF1) I PSORESF1="NON-VA" S $P(^PS(55,PSODFN,"PS"),"^")=PSORESPS,PSORESFG=1
"RTN","PSOAUTOC",74,0)
 N DI,DA,DR,DIE,DIC,X,Y
"RTN","PSOAUTOC",75,0)
 S ZTDTH=$H,ZTREQ="@",ZTSAVE("ZTREQ")="",ZTSAVE("PSODFN")="",ZTRTN="MAIL^PSOAUTOC",ZTDESC="Sends Mail Message that a Date of Death was Deleted",ZTIO="" D ^%ZTLOAD
"RTN","PSOAUTOC",76,0)
 Q
"RTN","PSOAUTOC",77,0)
MAIL ;builds mail message
"RTN","PSOAUTOC",78,0)
 S DIC=2,DA=PSODFN,DR=.351,DIQ="PTDOD" D EN^DIQ1 I PTDOD(2,DA,.351)]"" G EX1
"RTN","PSOAUTOC",79,0)
 K ^TMP("PSOHLD",$J),^TMP("PSOAD",$J),TOTRX,TOTPRX
"RTN","PSOAUTOC",80,0)
 F I=0:0 S I=$O(^PSRX("APSOD",PSODFN,I)) Q:'I  S TOTRX=$G(TOTRX)+1
"RTN","PSOAUTOC",81,0)
 F I=0:0 S I=$O(^PS(52.41,"APSOD",PSODFN,I)) Q:'I  S TOTPRX=$G(TOTPRX)+1
"RTN","PSOAUTOC",82,0)
 F I=0:0 S I=$O(^PS(55,PSODFN,"NVA","APSOD",I)) Q:'I  S TOTNVA=$G(TOTNVA)+1
"RTN","PSOAUTOC",83,0)
 K I Q:'$G(TOTRX)&('$G(TOTPRX))&('$G(TOTNVA))
"RTN","PSOAUTOC",84,0)
 S ENT=0,DFN=PSODFN D DEM^VADPT
"RTN","PSOAUTOC",85,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=$P(^DPT(PSODFN,0),"^")_" ID#: "_VA("PID")_" DOB: "_$P(VADM(3),"^",2)
"RTN","PSOAUTOC",86,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" " S Y=DT D DD^%DT
"RTN","PSOAUTOC",87,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="This patient had a Date of Death deleted on "_Y_"."
"RTN","PSOAUTOC",88,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="When a Date of Death is entered ALL active prescriptions, pending orders, and",ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Non-VA Meds are discontinued automatically. The following Outpatient"
"RTN","PSOAUTOC",89,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Prescriptions and/or Pending Orders should be reviewed for this patient using",ENT=ENT+1,^TMP("PSOAD",$J,ENT)="the Patient Prescription Processing option."
"RTN","PSOAUTOC",90,0)
 S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" "
"RTN","PSOAUTOC",91,0)
 I $G(TOTRX) S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Total number of Prescriptions found for review is "_TOTRX D
"RTN","PSOAUTOC",92,0)
 .F I=0:0 S I=$O(^PSRX("APSOD",PSODFN,I)) Q:'I  S ^TMP("PSOHLD",$J,$P(^PSDRUG($P(^PSRX(I,0),"^",6),0),"^"),I)=I
"RTN","PSOAUTOC",93,0)
 .S DRG="" F  S DRG=$O(^TMP("PSOHLD",$J,DRG)) Q:DRG=""  F I=0:0 S I=$O(^TMP("PSOHLD",$J,DRG,I)) Q:'I  S RX=^TMP("PSOHLD",$J,DRG,I) D
"RTN","PSOAUTOC",94,0)
 ..S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Rx: "_$P(^PSRX(RX,0),"^")_"  Drug: "_DRG
"RTN","PSOAUTOC",95,0)
 N PSOLPI,PSOLPIX,PSOLPIST,PSOLPND
"RTN","PSOAUTOC",96,0)
 I $G(TOTPRX) S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" " D
"RTN","PSOAUTOC",97,0)
 .S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Total number of Pending Orders found and reinstated is "_TOTPRX
"RTN","PSOAUTOC",98,0)
 .F PSOLPI=0:0 S PSOLPI=$O(^PS(52.41,"APSOD",PSODFN,PSOLPI)) Q:'PSOLPI  D
"RTN","PSOAUTOC",99,0)
 ..S $P(^PS(52.41,PSOLPI,0),"^",3)=$P(^PS(52.41,PSOLPI,"DDSTA"),";"),^PS(52.41,"AOR",PSODFN,$P(^PS(52.41,PSOLPI,"DDSTA"),";",2),PSOLPI)=""
"RTN","PSOAUTOC",100,0)
 ..S PSOLPIX=$P($G(^PS(52.41,PSOLPI,0)),"^"),PSOLPIST=$P($G(^(0)),"^",3)
"RTN","PSOAUTOC",101,0)
 ..I PSOLPIX D
"RTN","PSOAUTOC",102,0)
 ...I PSOLPIST'="NW",PSOLPIST'="RNW",PSOLPIST'="RF" Q
"RTN","PSOAUTOC",103,0)
 ...;Reset remaining cross references
"RTN","PSOAUTOC",104,0)
 ...S PSOLPND=$G(^PS(52.41,PSOLPI,0))
"RTN","PSOAUTOC",105,0)
 ...I $P(PSOLPND,"^",12),$P(PSOLPND,"^",13) S ^PS(52.41,"ACL",$P(PSOLPND,"^",13),$P(PSOLPND,"^",12),PSOLPI)=""
"RTN","PSOAUTOC",106,0)
 ...I $P(^PS(52.41,PSOLPI,"INI"),"^"),$P(PSOLPND,"^",12) S ^PS(52.41,"AD",$P(PSOLPND,"^",12),$P(^PS(52.41,PSOLPI,"INI"),"^"),PSOLPI)=""
"RTN","PSOAUTOC",107,0)
 ...I PSOLPIST="RNW",$P(PSOLPND,"^",21) S ^PS(52.41,"AQ",$P(PSOLPND,"^",21),PSOLPI)=""
"RTN","PSOAUTOC",108,0)
 ...I PSOLPIST="RF" Q
"RTN","PSOAUTOC",109,0)
 ...;Update CPRS with Pending order information on new and renewals
"RTN","PSOAUTOC",110,0)
 ...D EN^PSOHLSN(PSOLPIX,"SC","IP")
"RTN","PSOAUTOC",111,0)
 ..K ^PS(52.41,"APSOD",PSODFN,PSOLPI),ORTYP
"RTN","PSOAUTOC",112,0)
 ..S ENT=ENT+1,ORTYP=$P(^PS(52.41,PSOLPI,0),"^",3)
"RTN","PSOAUTOC",113,0)
 ..S MED=$S($P(^PS(52.41,PSOLPI,0),"^",9):$P(^PSDRUG($P(^PS(52.41,PSOLPI,0),"^",9),0),"^"),1:$P(^PS(50.7,$P(^PS(52.41,PSOLPI,0),"^",8),0),"^"))
"RTN","PSOAUTOC",114,0)
 ..I $G(MED)']"" S MED="NO DRUG OR ORDERABLE ITEM FOUND"
"RTN","PSOAUTOC",115,0)
 ..S ^TMP("PSOAD",$J,ENT)=$S(ORTYP="RF":"Refill",ORTYP="RNW":"Renew",ORTYP="HD":"On Hold",1:"New")_" Order Request  -  "
"RTN","PSOAUTOC",116,0)
 ..S ^TMP("PSOAD",$J,ENT)=^TMP("PSOAD",$J,ENT)_"Medication: "_MED
"RTN","PSOAUTOC",117,0)
 I $G(TOTNVA) S ENT=ENT+1,^TMP("PSOAD",$J,ENT)=" " D
"RTN","PSOAUTOC",118,0)
 .N PSODD,MED,PSOOI,PSONVA,NVA S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Total number of Non-VA Med Orders found and reinstated is "_TOTNVA
"RTN","PSOAUTOC",119,0)
 .F NVA=0:0 S NVA=$O(^PS(55,PSODFN,"NVA","APSOD",NVA)) Q:'NVA  D
"RTN","PSOAUTOC",120,0)
 ..S PSOOI=$P(^PS(55,PSODFN,"NVA",NVA,0),"^"),PSODD=$P(^(0),"^",2),PLACER=$P(^(0),"^",8),LOCATION=$P(^(0),"^",12),DFN=PSODFN
"RTN","PSOAUTOC",121,0)
 ..S MED=$S(PSODD:$P($G(^PSDRUG(PSODD,0)),"^"),1:$P(^PS(50.7,+PSOOI,0),"^")_" "_$P(^PS(50.606,$P(^PS(50.7,+PSOOI,0),"^",2),0),"^"))
"RTN","PSOAUTOC",122,0)
 ..S $P(^PS(55,PSODFN,"NVA",NVA,0),"^",6)="",$P(^(0),"^",7)="" K ^PS(55,PSODFN,"NVA","APSOD",NVA)
"RTN","PSOAUTOC",123,0)
 ..S ENT=ENT+1,^TMP("PSOAD",$J,ENT)="Non-VA "_MED,REIN=1,PSONVA=NVA D REIN^PSONVNEW
"RTN","PSOAUTOC",124,0)
 ..K PSOOI,PSODD,PLACER,LOCATION,MED,REIN
"RTN","PSOAUTOC",125,0)
 S XMDUZ=.5,XMSUB="Date of Death Deleted for "_$P(^DPT(PSODFN,0),"^")_" ("_VA("BID")_")",XMTEXT="^TMP(""PSOAD"",$J," N DIFROM
"RTN","PSOAUTOC",126,0)
 F I=0:0 S I=$O(^XUSEC("PSORPH",I)) Q:'I  S XMY(I)=""
"RTN","PSOAUTOC",127,0)
 D ^XMD
"RTN","PSOAUTOC",128,0)
EX1 K ^TMP("PSOHLD",$J),XMSUB,XMTEXT,XMY,XMDUZ,^TMP("PSOAD",$J),I,TOTRX,TOTPRX,PSODFN,ENT,ORTYP,X,Y,MED,RX,PTDOD
"RTN","PSOAUTOC",129,0)
 Q
"RTN","PSOBPSU1")
0^66^B40165335
"RTN","PSOBPSU1",1,0)
PSOBPSU1 ;BIRM/MFR - BPS (ECME) Utilities 1 ;10/15/04
"RTN","PSOBPSU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOBPSU1",3,0)
 ;Reference to $$EN^BPSNCPDP supported by IA 4415
"RTN","PSOBPSU1",4,0)
 ;References to $$NDCFMT^PSSNDCUT,$$GETNDC^PSSNDCUT supported by IA 4707
"RTN","PSOBPSU1",5,0)
 ;References to $$ECMEON^BPSUTIL,$$CMOPON^BPSUTIL supported by IA 4410
"RTN","PSOBPSU1",6,0)
 ;References to STORESP^IBNCPDP supported by IA 4299
"RTN","PSOBPSU1",7,0)
 ;
"RTN","PSOBPSU1",8,0)
ECMESND(RX,RFL,DATE,FROM,NDC,CMOP,RVTX,OVRC,CNDC,RESP,IGSW,ALTX) ; - Sends Rx Release information to ECME/IB and 
"RTN","PSOBPSU1",9,0)
 ;                                                       updates NDC in the DRUG/PRESCRIPTION files
"RTN","PSOBPSU1",10,0)
 ;Reference to routine EN^BPSNCPDP supported by DBIA #4304
"RTN","PSOBPSU1",11,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",12,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",13,0)
 ;       (r) DATE - Date of Service
"RTN","PSOBPSU1",14,0)
 ;       (r) FROM - Function within OP (See BWHERE param. in EN^BPSNCPDP api)
"RTN","PSOBPSU1",15,0)
 ;       (o) NDC  - NDC Number (If not passed, will be retrieved from DRUG file)
"RTN","PSOBPSU1",16,0)
 ;       (o) CMOP - CMOP Prescription (1-YES/0-NO) (Default: 0)
"RTN","PSOBPSU1",17,0)
 ;       (o) RVTX - REVERSE text (e.g., RX EDIT, RX RELEASE-NDC CHANGE, etc)
"RTN","PSOBPSU1",18,0)
 ;       (o) OVRC - Set of 3 NCPDP override codes separated by "^": 
"RTN","PSOBPSU1",19,0)
 ;                  Piece 1: NCPDP Professional Service Code for overriding DUR REJECTS
"RTN","PSOBPSU1",20,0)
 ;                  Piece 2: NCPDP Reason for Service Code for overriding DUR REJECTS
"RTN","PSOBPSU1",21,0)
 ;                  Piece 3: NCPDP Result of Service Code for overriding DUR REJECTS
"RTN","PSOBPSU1",22,0)
 ;       (o) CNDC - Changed NDC? 1 - Yes / 0 - No (Default: NO)
"RTN","PSOBPSU1",23,0)
 ;       (o) IGSW - Ignore Switches (Master and CMOP)? 1 - Yes / 0 - No (Default: NO)
"RTN","PSOBPSU1",24,0)
 ;       (o) ALTX - Alternative Text to be placed in the Rx ECME Activity Log
"RTN","PSOBPSU1",25,0)
 ;Output:    RESP - Response from $$EN^BPSNCPDP api
"RTN","PSOBPSU1",26,0)
 ;
"RTN","PSOBPSU1",27,0)
 ; - Retrieving the NDC code from the DRUG file if not passed in, then save it in the DRUG file
"RTN","PSOBPSU1",28,0)
 N ACT,NDCACT,DA
"RTN","PSOBPSU1",29,0)
 ;
"RTN","PSOBPSU1",30,0)
 I '$D(RFL) S RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",31,0)
 ;
"RTN","PSOBPSU1",32,0)
 ; - ECME is not turned ON for the Rx's Division
"RTN","PSOBPSU1",33,0)
 I '$G(IGSW),'$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) S RESP="-1^ECME SWITCH OFF" Q
"RTN","PSOBPSU1",34,0)
 ;
"RTN","PSOBPSU1",35,0)
 ; - ECME CMOP is not turned ON for the Rx's Division
"RTN","PSOBPSU1",36,0)
 I '$G(IGSW),$G(CMOP),'$$CMOPON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) S RESP="-1^CMOP SWITCH OFF" Q
"RTN","PSOBPSU1",37,0)
 ;
"RTN","PSOBPSU1",38,0)
 ; - Saving the NDC to be displayed on the ECME Activity Log
"RTN","PSOBPSU1",39,0)
 I $G(CNDC) D
"RTN","PSOBPSU1",40,0)
 . I $G(NDC)'="" S NDCACT=NDC Q
"RTN","PSOBPSU1",41,0)
 . S NDCACT=$$GETNDC^PSONDCUT(RX,RFL)
"RTN","PSOBPSU1",42,0)
 ;
"RTN","PSOBPSU1",43,0)
 I $$NDCFMT^PSSNDCUT($G(NDC))="" D
"RTN","PSOBPSU1",44,0)
 . S NDC=$$GETNDC^PSSNDCUT($$GET1^DIQ(52,RX,6,"I"),$$RXSITE^PSOBPSUT(RX,RFL),+$G(CMOP))
"RTN","PSOBPSU1",45,0)
 . I $G(NDC)'="" D SAVNDC^PSONDCUT(RX,RFL,NDC,+$G(CMOP))
"RTN","PSOBPSU1",46,0)
 ;
"RTN","PSOBPSU1",47,0)
 ; - Creating ECME Activity Log on the PRESCRIPTION file
"RTN","PSOBPSU1",48,0)
 S ACT="Submitted" I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" S ACT="Reversal/Re-submit sent"
"RTN","PSOBPSU1",49,0)
 S ACT=ACT_" to ECME:"
"RTN","PSOBPSU1",50,0)
 ;
"RTN","PSOBPSU1",51,0)
 ; - Marked any 'unresolved' REJECTS as 'resolved' (Reason: 1 - Claim re-submitted)
"RTN","PSOBPSU1",52,0)
 D CLSALL^PSOREJU2(RX,RFL,1,"AUTOMATICALLY CLOSED",DUZ)
"RTN","PSOBPSU1",53,0)
 ;
"RTN","PSOBPSU1",54,0)
 ; - Call to ECME (NEWing STAT because ECME was overwritting it - Important variable for CMOP release PSXVND)
"RTN","PSOBPSU1",55,0)
 N STAT
"RTN","PSOBPSU1",56,0)
 I $G(RVTX)="",FROM="ED" S RVTX="RX EDITED"
"RTN","PSOBPSU1",57,0)
 S RESP=$$EN^BPSNCPDP(RX,RFL,$$DOS(RX,RFL,.DATE),FROM,NDC,$G(RVTX),$G(OVRC))
"RTN","PSOBPSU1",58,0)
 ;
"RTN","PSOBPSU1",59,0)
 ; - Reseting the Re-transmission flag
"RTN","PSOBPSU1",60,0)
 D RETRXF^PSOREJU2(RX,RFL,0)
"RTN","PSOBPSU1",61,0)
 ;
"RTN","PSOBPSU1",62,0)
 ; - Logging ECME Activity Log to the PRESCRIPTION file
"RTN","PSOBPSU1",63,0)
 I $G(ALTX)="" D
"RTN","PSOBPSU1",64,0)
 . N X S X=""
"RTN","PSOBPSU1",65,0)
 . S:FROM="OF" X="WINDOW FILL(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",66,0)
 . S:FROM="RF" X="WINDOW REFILL(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",67,0)
 . S:FROM="RN" X="RX RENEWED(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",68,0)
 . S:FROM="PL" X="SUSP LABEL PRINTED(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",69,0)
 . S:FROM="PE"!(FROM="PP") X="PULLED FROM SUSPENSE(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",70,0)
 . S:FROM="PC" X="CMOP TRANSMISSION(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",71,0)
 . S:FROM="RRL" X="RELEASED RX PREVIOUSLY REVERSED"
"RTN","PSOBPSU1",72,0)
 . S:FROM="ED" X="RX EDITED"
"RTN","PSOBPSU1",73,0)
 . S:$G(RVTX)'="" X=RVTX
"RTN","PSOBPSU1",74,0)
 . S:$G(OVRC)'="" X="DUR OVERRIDE CODES("_$P(OVRC,"^",1)_"/"_$P(OVRC,"^",2)_"/"_$P(OVRC,"^",3)_")"
"RTN","PSOBPSU1",75,0)
 . S:$G(CNDC) X=X_"(NDC:"_NDCACT_")" S ACT=ACT_X
"RTN","PSOBPSU1",76,0)
 . S ACT=ACT_$$STS(RX,RFL,RESP)
"RTN","PSOBPSU1",77,0)
 I $G(ALTX)'="" S ACT=ACT_ALTX_$$STS(RX,RFL,RESP)
"RTN","PSOBPSU1",78,0)
 I +RESP=2,$$STATUS^PSOBPSUT(RX,RFL)="" S ACT="Not ECME Billable: "_$P(RESP,"^",2)
"RTN","PSOBPSU1",79,0)
 D ECMEACT(RX,RFL,ACT,DUZ)
"RTN","PSOBPSU1",80,0)
 Q
"RTN","PSOBPSU1",81,0)
 ;
"RTN","PSOBPSU1",82,0)
REVERSE(RX,RFL,FROM,RSN,RTXT,IGRL,NDC) ; - Reverse a claim and close all OPEN/UNRESOLVED Rejects
"RTN","PSOBPSU1",83,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",84,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",85,0)
 ;       (r) FROM - Function within OP (See BWHERE param. in EN^BPSNCPDP api)
"RTN","PSOBPSU1",86,0)
 ;       (o) RSN  - Close Reason (2:RX ON HOLD;4: RX RETURNED TO STOCK,5:RX DELETED,etc...)
"RTN","PSOBPSU1",87,0)
 ;       (o) RTXT - Close Reason TEXT (Usually no passed if RSN is passed)
"RTN","PSOBPSU1",88,0)
 ;       (o) IGRL - Ignore RELEASE DATE, reverse anyway  
"RTN","PSOBPSU1",89,0)
 ;       (o) NDC  - NDC number related to the reversal (Note: might be an invalid NDC)
"RTN","PSOBPSU1",90,0)
 ;
"RTN","PSOBPSU1",91,0)
 I '$D(RFL) S RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",92,0)
 ;
"RTN","PSOBPSU1",93,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q
"RTN","PSOBPSU1",94,0)
 ;
"RTN","PSOBPSU1",95,0)
 N RESP,STS,ACT,STAT,DA,STATUS,NOACT S RSN=+$G(RSN),RTXT=$G(RTXT)
"RTN","PSOBPSU1",96,0)
 I RTXT="",RSN D
"RTN","PSOBPSU1",97,0)
 . S:RSN=2 RTXT="RX PLACED ON HOLD" S:RSN=3 RTXT="RX SUSPENDED" S:RSN=4 RTXT="RX RETURNED TO STOCK"
"RTN","PSOBPSU1",98,0)
 . S:RSN=5 RTXT="RX DELETED" S:RSN=7 RTXT="RX DISCONTINUED" S:RSN=8 RTXT="RX EDITED"
"RTN","PSOBPSU1",99,0)
 ;
"RTN","PSOBPSU1",100,0)
 D CLSALL^PSOREJU2(RX,RFL,RSN,RTXT,DUZ)
"RTN","PSOBPSU1",101,0)
 ;
"RTN","PSOBPSU1",102,0)
 I '$G(IGRL),$$RXRLDT^PSOBPSUT(RX,RFL) Q
"RTN","PSOBPSU1",103,0)
 ;
"RTN","PSOBPSU1",104,0)
 ; - Reseting the Re-transmission flag if Rx is being suspended
"RTN","PSOBPSU1",105,0)
 I RSN=3!($$GET1^DIQ(52,RX,100,"I")=5) D RETRXF^PSOREJU2(RX,RFL,1)
"RTN","PSOBPSU1",106,0)
 ;
"RTN","PSOBPSU1",107,0)
 S STATUS=$$STATUS^PSOBPSUT(RX,RFL),NOACT=0
"RTN","PSOBPSU1",108,0)
 I STATUS'="E PAYABLE",STATUS'="IN PROGRESS",STATUS'="E REVERSAL REJECTED",STATUS'="E REVERSAL STRANDED",STATUS'="E DUPLICATE" S NOACT=1
"RTN","PSOBPSU1",109,0)
 ;
"RTN","PSOBPSU1",110,0)
 S RESP=$$EN^BPSNCPDP(RX,RFL,$$DOS(RX,RFL),FROM,$$GETNDC^PSONDCUT(RX,RFL),RTXT)
"RTN","PSOBPSU1",111,0)
 ;
"RTN","PSOBPSU1",112,0)
 ; - Logging ECME Activity Log
"RTN","PSOBPSU1",113,0)
 I '$G(NOACT) D
"RTN","PSOBPSU1",114,0)
 . S ACT="Reversal sent to ECME: "_RTXT_$S($G(NDC)'="":" ("_NDC_")",1:"")_$$STS(RX,RFL,+RESP)
"RTN","PSOBPSU1",115,0)
 . D ECMEACT(RX,RFL,ACT,DUZ)
"RTN","PSOBPSU1",116,0)
 ;
"RTN","PSOBPSU1",117,0)
 Q
"RTN","PSOBPSU1",118,0)
 ;
"RTN","PSOBPSU1",119,0)
DOS(RX,RFL,DATE) ; Return the Date Of Service for ECME
"RTN","PSOBPSU1",120,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",121,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",122,0)
 ;       (o) DATE - Possible Date Of Service
"RTN","PSOBPSU1",123,0)
 ;Output:    DOS  - Actual Date Of Service
"RTN","PSOBPSU1",124,0)
 ;
"RTN","PSOBPSU1",125,0)
 I '$D(RFL) S RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",126,0)
 ;
"RTN","PSOBPSU1",127,0)
 ; - Retrieving FILL DATE from the PRESCRIPTION file if not passed
"RTN","PSOBPSU1",128,0)
 I $G(DATE)="" S DATE=$$RXRLDT^PSOBPSUT(RX,RFL)
"RTN","PSOBPSU1",129,0)
 ; - Retrieving FILL DATE from the PRESCRIPTION file if not passed
"RTN","PSOBPSU1",130,0)
 I 'DATE S DATE=$$RXFLDT^PSOBPSUT(RX,RFL)
"RTN","PSOBPSU1",131,0)
 ; - Future Date not allowed
"RTN","PSOBPSU1",132,0)
 I DATE>DT!'DATE S DATE=DT
"RTN","PSOBPSU1",133,0)
 ;
"RTN","PSOBPSU1",134,0)
 Q (DATE\1)
"RTN","PSOBPSU1",135,0)
 ;
"RTN","PSOBPSU1",136,0)
RELEASE(RX,RFL,USR) ; - Notifies IB that the Rx was RELEASED
"RTN","PSOBPSU1",137,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",138,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",139,0)
 ;       (o) USR  - User responsible for releasing the Rx (Default: .5 - Postmaster)
"RTN","PSOBPSU1",140,0)
 ;
"RTN","PSOBPSU1",141,0)
 N IBAR,RXAR,FLDT
"RTN","PSOBPSU1",142,0)
 ;
"RTN","PSOBPSU1",143,0)
 S:'$D(RFL) RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",144,0)
 S:'$D(USR) USR=.5
"RTN","PSOBPSU1",145,0)
 ;
"RTN","PSOBPSU1",146,0)
 D GETS^DIQ(52,RX_",",".01;2;6;7;8;22","I","RXAR")
"RTN","PSOBPSU1",147,0)
 S DFN=+$G(RXAR(52,RX_",",2,"I"))
"RTN","PSOBPSU1",148,0)
 S IBAR("PRESCRIPTION")=RX,IBAR("RX NO")=$G(RXAR(52,RX_",",.01,"I"))
"RTN","PSOBPSU1",149,0)
 S IBAR("CLAIMID")=$E((RX#10000000)+10000000,2,8),IBAR("USER")=USR
"RTN","PSOBPSU1",150,0)
 S IBAR("DRUG")=RXAR(52,RX_",",6,"I"),IBAR("NDC")=$$GETNDC^PSONDCUT(RX,RFL)
"RTN","PSOBPSU1",151,0)
 S FLDT=$$RXFLDT^PSOBPSUT(RX,RFL) I FLDT>DT S FLDT=DT
"RTN","PSOBPSU1",152,0)
 S IBAR("FILL NUMBER")=RFL,IBAR("FILL DATE")=FLDT
"RTN","PSOBPSU1",153,0)
 S IBAR("QTY")=$G(RXAR(52,RX_",",7,"I")),IBAR("DAYS SUPPLY")=$G(RXAR(52,RX_",",8,"I"))
"RTN","PSOBPSU1",154,0)
 ;
"RTN","PSOBPSU1",155,0)
 I RFL D
"RTN","PSOBPSU1",156,0)
 . D GETS^DIQ(52.1,RFL_","_RX_",",".01;1;1.1","I","RFAR")
"RTN","PSOBPSU1",157,0)
 . S IBAR("QTY")=$G(RFAR(52.1,RFL_","_RX_",",1,"I"))
"RTN","PSOBPSU1",158,0)
 . S IBAR("DAYS SUPPLY")=$G(RFAR(52.1,RFL_","_RX_",",1.1,"I"))
"RTN","PSOBPSU1",159,0)
 ;
"RTN","PSOBPSU1",160,0)
 S IBAR("STATUS")="RELEASED" D STORESP^IBNCPDP(DFN,.IBAR)
"RTN","PSOBPSU1",161,0)
 ;
"RTN","PSOBPSU1",162,0)
 Q
"RTN","PSOBPSU1",163,0)
 ;
"RTN","PSOBPSU1",164,0)
LSTRFL(RX) ;  - Returns the latest fill for the Prescription
"RTN","PSOBPSU1",165,0)
 ; Input: (r) RX     - Rx IEN (#52)
"RTN","PSOBPSU1",166,0)
 ;Output:     LSTRFL - Most recent refill #
"RTN","PSOBPSU1",167,0)
 N I,LSTRFL
"RTN","PSOBPSU1",168,0)
 S (I,LSTRFL)=0 F  S I=$O(^PSRX(RX,1,I)) Q:'I  S LSTRFL=I
"RTN","PSOBPSU1",169,0)
 Q LSTRFL
"RTN","PSOBPSU1",170,0)
 ;
"RTN","PSOBPSU1",171,0)
ECMEACT(RX,RFL,COMM,USR) ; - Add an Activity to the ECME Activity Log (PRESCRIPTION file)
"RTN","PSOBPSU1",172,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",173,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",174,0)
 ;       (r) COMM - Comments (up to 75 characters)
"RTN","PSOBPSU1",175,0)
 ;       (o) USR  - User logging the comments (Default: DUZ)
"RTN","PSOBPSU1",176,0)
 ;
"RTN","PSOBPSU1",177,0)
 S:'$D(RFL) RFL=$$LSTRFL(RX) S:'$D(USR) USR=DUZ
"RTN","PSOBPSU1",178,0)
 S:'$D(^VA(200,+USR,0)) USR=DUZ S COMM=$E($G(COMM),1,75)
"RTN","PSOBPSU1",179,0)
 ;
"RTN","PSOBPSU1",180,0)
 I COMM="" Q
"RTN","PSOBPSU1",181,0)
 I '$D(^PSRX(RX)) Q
"RTN","PSOBPSU1",182,0)
 ;
"RTN","PSOBPSU1",183,0)
 N DIC,DA,DD,DO,DR,DINUM,Y,DLAYGO
"RTN","PSOBPSU1",184,0)
 S DA(1)=RX,DIC="^PSRX("_RX_",""A"",",DLAYGO=52.3,DIC(0)="L"
"RTN","PSOBPSU1",185,0)
 S DIC("DR")=".02///M;.03////"_USR_";.04///"_RFL_";.05///"_COMM
"RTN","PSOBPSU1",186,0)
 S X=$$NOW^XLFDT() D FILE^DICN
"RTN","PSOBPSU1",187,0)
 Q
"RTN","PSOBPSU1",188,0)
 ;
"RTN","PSOBPSU1",189,0)
STS(RX,RFL,RSP) ; Adds the Status to the ECME Activity Log according to Rx/fill claim status Response
"RTN","PSOBPSU1",190,0)
 N STS
"RTN","PSOBPSU1",191,0)
 S STS=$S($$STATUS^PSOBPSUT(RX,RFL)'="IN PROGRESS"&($$STATUS^PSOBPSUT(RX,RFL)'=""):"-"_$$STATUS^PSOBPSUT(RX,RFL),1:"")
"RTN","PSOBPSU1",192,0)
 S:+RSP=1 STS="-NO SUBMISSION THROUGH ECME" S:+RSP=3 STS="-NO REVERSAL NEEDED" S:+RSP=4 STS="-NOT PROCESSED"
"RTN","PSOBPSU1",193,0)
 S:+RSP=5 STS="-SOFTWARE ERROR"
"RTN","PSOBPSU1",194,0)
 I +RSP=2,$$STATUS^PSOBPSUT(RX,RFL)'="" S STS="-NOT BILLABLE:"_$P(RSP,"^",2)
"RTN","PSOBPSU1",195,0)
 Q STS
"RTN","PSOBPSUT")
0^28^B48196473
"RTN","PSOBPSUT",1,0)
PSOBPSUT ;BIRM/MFR - BPS (ECME) Utilities ; 07 Jun 2005  8:39 PM
"RTN","PSOBPSUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOBPSUT",3,0)
 ;Reference to $$ECMEON^BPSUTIL supported by IA 4410
"RTN","PSOBPSUT",4,0)
 ;Reference to IBSEND^BPSECMP2 supported by IA 4411
"RTN","PSOBPSUT",5,0)
 ;Reference to $$STATUS^BPSOSRX supported by IA 4412
"RTN","PSOBPSUT",6,0)
 ;Reference to $$NDCFMT^PSSNDCUT supported by IA 4707
"RTN","PSOBPSUT",7,0)
 ;Reference to $$CLAIM^BPSBUTL,IBSEND^BPSBUTL supported by IA 4719
"RTN","PSOBPSUT",8,0)
 ;
"RTN","PSOBPSUT",9,0)
ECME(RX) ; Returns "e" if Rx/Refill is Electronically Billable (3rd party)
"RTN","PSOBPSUT",10,0)
 Q $S($$STATUS^BPSOSRX(RX,$$LSTRFL^PSOBPSU1(RX))'="":"e",1:"")
"RTN","PSOBPSUT",11,0)
 ;
"RTN","PSOBPSUT",12,0)
STATUS(RX,RFL) ; Returns the Rx's ECME Status (calls STATUS^BPSOSRX)
"RTN","PSOBPSUT",13,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",14,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",15,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",16,0)
 Q $P($$STATUS^BPSOSRX(RX,RFL),"^")
"RTN","PSOBPSUT",17,0)
 ;
"RTN","PSOBPSUT",18,0)
SUBMIT(RX,RFL,IGRL) ; Returns whether the Rx should be submitted to ECME at the moment or not
"RTN","PSOBPSUT",19,0)
 ; Input:  (r) RX   - Rx IEN (#52) 
"RTN","PSOBPSUT",20,0)
 ;         (o) RFL  - Refill # (Def.: most recent)
"RTN","PSOBPSUT",21,0)
 ;         (o) IGRL - Ignore Release Date? (1-YES/0-NO) (Def.: 0 - NO)
"RTN","PSOBPSUT",22,0)
 ;         
"RTN","PSOBPSUT",23,0)
 ; - Get the REFILL # (multiple IEN)
"RTN","PSOBPSUT",24,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",25,0)
 ; - Not the latest fill for the prescription
"RTN","PSOBPSUT",26,0)
 I RFL'=$$LSTRFL^PSOBPSU1(RX) Q 0
"RTN","PSOBPSUT",27,0)
 ; - Status not ACTIVE
"RTN","PSOBPSUT",28,0)
 I $$GET1^DIQ(52,RX,100,"I")'=0 Q 0
"RTN","PSOBPSUT",29,0)
 ; Will suspend for CMOP
"RTN","PSOBPSUT",30,0)
 I $$CMOP(RX,RFL) Q 0
"RTN","PSOBPSUT",31,0)
 ; - ECME turned OFF for Rx's site
"RTN","PSOBPSUT",32,0)
 I '$$ECMEON^BPSUTIL($$RXSITE(RX,RFL)) Q 0
"RTN","PSOBPSUT",33,0)
 ; - Rx is RELEASED - Do not submit
"RTN","PSOBPSUT",34,0)
 I '$G(IGRL),$$RXRLDT(RX,RFL) Q 0
"RTN","PSOBPSUT",35,0)
 ; - Future Fill/AUTO SUSPENSE ON - will suspend
"RTN","PSOBPSUT",36,0)
 I $$RXFLDT(RX,RFL)>DT,$$GET1^DIQ(59,$$RXSITE(RX,RFL),.16,"I") Q 0
"RTN","PSOBPSUT",37,0)
 Q 1
"RTN","PSOBPSUT",38,0)
 ;
"RTN","PSOBPSUT",39,0)
CMOP(RX,RFL) ; Returns if the Rx will be a CMOP Rx or not
"RTN","PSOBPSUT",40,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",41,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",42,0)
 ; Output: 1 - CMOP / 0 - NON-CMOP
"RTN","PSOBPSUT",43,0)
 ;
"RTN","PSOBPSUT",44,0)
 N DFN,CMOP,MAIL,MAILEXP,DRUG,WARNS,STATUS,MW,A
"RTN","PSOBPSUT",45,0)
 ; Get the REFILL # (multiple IEN)
"RTN","PSOBPSUT",46,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",47,0)
 ; MAIL=MAIL Code, MAILEXP=Mail Code Expiration Date
"RTN","PSOBPSUT",48,0)
 S CMOP=0
"RTN","PSOBPSUT",49,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I"),MAIL=$$GET1^DIQ(55,DFN,.03,"I"),MAILEXP=$$GET1^DIQ(55,DFN,.05,"I")
"RTN","PSOBPSUT",50,0)
 I MAIL>1,MAILEXP=""!(MAILEXP>DT) G QCMOP
"RTN","PSOBPSUT",51,0)
 ; Get drug IEN and cheDRUG if CMOP  ,$S($G(MAILEXP)=""!($G(MAILEXP)>DT):1,1:0)
"RTN","PSOBPSUT",52,0)
 S DRUG=$$GET1^DIQ(52,RX,6,"I") G QCMOP:'DRUG,QCMOP:'$D(^PSDRUG("AQ",DRUG))
"RTN","PSOBPSUT",53,0)
 ; Not marked for O.P.
"RTN","PSOBPSUT",54,0)
 I $$GET1^DIQ(50,DRUG,63)'["O" G QCMOP
"RTN","PSOBPSUT",55,0)
 ; Drug Warning >11
"RTN","PSOBPSUT",56,0)
 S WARNS=$$GET1^DIQ(50,DRUG,8) I $L(WARNS)>11 G QCMOP
"RTN","PSOBPSUT",57,0)
 ; If tradename
"RTN","PSOBPSUT",58,0)
 I $$GET1^DIQ(52,RX,6.5)'="" G QCMOP
"RTN","PSOBPSUT",59,0)
 ; If Cancelled, Expired, Deleted, Hold
"RTN","PSOBPSUT",60,0)
 S STATUS=$$GET1^DIQ(52,RX,100,"I") I STATUS>9!(STATUS=4)!(STATUS=3) G QCMOP
"RTN","PSOBPSUT",61,0)
 ; Rx RELEASED
"RTN","PSOBPSUT",62,0)
 I $$RXRLDT^PSOBPSUT(RX,RFL) G QCMOP
"RTN","PSOBPSUT",63,0)
 ; MAIL/WINDOW
"RTN","PSOBPSUT",64,0)
 S MW=$S('RFL:$$GET1^DIQ(52,RX,11,"I"),1:$$GET1^DIQ(52.1,RFL_","_RX,2,"I"))
"RTN","PSOBPSUT",65,0)
 ; IF WINDOW/ORIGINAL/FUTURE FILL SETS MW = MAIL
"RTN","PSOBPSUT",66,0)
 I MW="W",$$RXFLDT^PSOBPSUT(RX,RFL)>DT S MW="M"
"RTN","PSOBPSUT",67,0)
 ; If not MAIL
"RTN","PSOBPSUT",68,0)
 I MW'="M" G QCMOP
"RTN","PSOBPSUT",69,0)
 S CMOP=1
"RTN","PSOBPSUT",70,0)
 ;
"RTN","PSOBPSUT",71,0)
QCMOP Q CMOP
"RTN","PSOBPSUT",72,0)
 ;
"RTN","PSOBPSUT",73,0)
RXRLDT(RX,RFL) ; Returns the Rx Release Date
"RTN","PSOBPSUT",74,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",75,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",76,0)
 ;        
"RTN","PSOBPSUT",77,0)
 ; Output:  RXRLDT - Rx Release Date
"RTN","PSOBPSUT",78,0)
 N RXRLDT
"RTN","PSOBPSUT",79,0)
 I '$G(RX) Q ""
"RTN","PSOBPSUT",80,0)
 S RXRLDT=$$GET1^DIQ(52,RX,31,"I")
"RTN","PSOBPSUT",81,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",82,0)
 I RFL S RXRLDT=$$GET1^DIQ(52.1,RFL_","_RX,17,"I")
"RTN","PSOBPSUT",83,0)
 Q RXRLDT
"RTN","PSOBPSUT",84,0)
 ;
"RTN","PSOBPSUT",85,0)
RXFLDT(RX,RFL) ; Returns the Rx Fill Date
"RTN","PSOBPSUT",86,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",87,0)
 ;         (o) RFL - Refill # (Default: most recent)      
"RTN","PSOBPSUT",88,0)
 ; Output:  RXFLDT - Rx Fill Date
"RTN","PSOBPSUT",89,0)
 N RXFLDT
"RTN","PSOBPSUT",90,0)
 I '$G(RX) Q ""
"RTN","PSOBPSUT",91,0)
 S RXFLDT=$$GET1^DIQ(52,RX,22,"I")
"RTN","PSOBPSUT",92,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",93,0)
 I RFL S RXFLDT=$$GET1^DIQ(52.1,RFL_","_RX,.01,"I")
"RTN","PSOBPSUT",94,0)
 Q RXFLDT
"RTN","PSOBPSUT",95,0)
 ;
"RTN","PSOBPSUT",96,0)
RXSUDT(RX,RFL) ; Returns the prescription/fill Suspense Date for the RX/Reject passed in
"RTN","PSOBPSUT",97,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSUT",98,0)
 ;       (o) RFL  - Refill IEN (#52.1)
"RTN","PSOBPSUT",99,0)
 ;Output: SUSPENSE DATE (External format) or <NULL>, if not suspended
"RTN","PSOBPSUT",100,0)
 ;
"RTN","PSOBPSUT",101,0)
 I $G(^PSRX(RX,"STA"))'=5 Q ""
"RTN","PSOBPSUT",102,0)
 N SURX,SURFL
"RTN","PSOBPSUT",103,0)
 S SURX=$O(^PS(52.5,"B",RX,0)) I 'SURX Q ""
"RTN","PSOBPSUT",104,0)
 I $$GET1^DIQ(52.5,SURX,.05,"I") Q ""
"RTN","PSOBPSUT",105,0)
 S SURFL=+$$GET1^DIQ(52.5,SURX,9) I RFL'=SURFL Q ""
"RTN","PSOBPSUT",106,0)
 Q $$GET1^DIQ(52.5,SURX,.02,"I")
"RTN","PSOBPSUT",107,0)
 ;
"RTN","PSOBPSUT",108,0)
RXSITE(RX,RFL) ; Returns the Rx DIVISION
"RTN","PSOBPSUT",109,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",110,0)
 ;         (o) RFL - Refill #
"RTN","PSOBPSUT",111,0)
 ; Output:  SITE - Rx Fill Date
"RTN","PSOBPSUT",112,0)
 ;        
"RTN","PSOBPSUT",113,0)
 N SITE
"RTN","PSOBPSUT",114,0)
 I '$G(RX) Q
"RTN","PSOBPSUT",115,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",116,0)
 I RFL S SITE=$$GET1^DIQ(52.1,RFL_","_RX,8,"I")
"RTN","PSOBPSUT",117,0)
 I 'RFL!'$G(SITE) S SITE=$$GET1^DIQ(52,RX,20,"I")
"RTN","PSOBPSUT",118,0)
 Q SITE
"RTN","PSOBPSUT",119,0)
 ;
"RTN","PSOBPSUT",120,0)
MANREL(RX,RFL,PID) ; ePharmacy Manual Rx Release
"RTN","PSOBPSUT",121,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",122,0)
 ;       (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",123,0)
 ;       (o) PID - Displays PID/Drug/Rx in the NDC prompts
"RTN","PSOBPSUT",124,0)
 ;Output: "" (null - OK to Release) OR "^" (User entered "^", or no valid NDC on file for ePharmacy Rx)
"RTN","PSOBPSUT",125,0)
 ;       
"RTN","PSOBPSUT",126,0)
 N ACTION
"RTN","PSOBPSUT",127,0)
 ;
"RTN","PSOBPSUT",128,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",129,0)
 ;
"RTN","PSOBPSUT",130,0)
 ; - Checking for REJECTS before proceeding to Rx Release
"RTN","PSOBPSUT",131,0)
 I $$FIND^PSOREJUT(RX,RFL) D  I ACTION="Q"!(ACTION="^") W ! Q "^"
"RTN","PSOBPSUT",132,0)
 . S ACTION=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","OIQ","Q")
"RTN","PSOBPSUT",133,0)
 ;
"RTN","PSOBPSUT",134,0)
 ; - ePharmacy switch is OFF
"RTN","PSOBPSUT",135,0)
 I '$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) Q ""
"RTN","PSOBPSUT",136,0)
 ;
"RTN","PSOBPSUT",137,0)
 ; - Not an ePharmacy Rx
"RTN","PSOBPSUT",138,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q ""
"RTN","PSOBPSUT",139,0)
 ;
"RTN","PSOBPSUT",140,0)
 ; - NDC editing before Rx release
"RTN","PSOBPSUT",141,0)
 S ACTION=$$CHGNDC^PSONDCUT(RX,RFL,$G(PID)) I ACTION="^" D  Q "^"
"RTN","PSOBPSUT",142,0)
 . W !!,$C(7),"A valid NDC must be entered before the Release function can be completed.",! H 1
"RTN","PSOBPSUT",143,0)
 ;
"RTN","PSOBPSUT",144,0)
 ; - Checking for OPEN/UNRESOLVED 3rd. Party Payer Rejects (After possible NDC edit)
"RTN","PSOBPSUT",145,0)
 I $$FIND^PSOREJUT(RX,RFL) D  I ACTION="Q"!(ACTION="^") W ! Q "^"
"RTN","PSOBPSUT",146,0)
 . S ACTION=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","OIQ","Q")
"RTN","PSOBPSUT",147,0)
 ;
"RTN","PSOBPSUT",148,0)
 ; - Notifying IB of a Rx RELEASE event 
"RTN","PSOBPSUT",149,0)
 D RELEASE^PSOBPSU1(RX,RFL,DUZ)
"RTN","PSOBPSUT",150,0)
 ;
"RTN","PSOBPSUT",151,0)
 Q ""
"RTN","PSOBPSUT",152,0)
 ;
"RTN","PSOBPSUT",153,0)
AUTOREL(RX,RFL,RLDT,NDC,SRC,STS,HNG) ; Sends Rx Release information to ECME/IB and updates NDC
"RTN","PSOBPSUT",154,0)
 ;                                 in the DRUG/PRESCRIPTION files
"RTN","PSOBPSUT",155,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",156,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSOBPSUT",157,0)
 ;       (r) RLDT- Release Date
"RTN","PSOBPSUT",158,0)
 ;       (r) NDC - NDC Number (Must be 11 digits)
"RTN","PSOBPSUT",159,0)
 ;       (o) SRC - SOURCE: "C" - CMOP / "A" - OPAI
"RTN","PSOBPSUT",160,0)
 ;       (o) STS - Status: (S)uccessful/(U)nsuccessful Release (Default: "S" - Successful)
"RTN","PSOBPSUT",161,0)
 ;       (o) HNG - HANG time after resubmission and before checking the status of the claim (Default: 0)
"RTN","PSOBPSUT",162,0)
 ;       
"RTN","PSOBPSUT",163,0)
 N RXNDC,SITE
"RTN","PSOBPSUT",164,0)
 ;
"RTN","PSOBPSUT",165,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",166,0)
 ;
"RTN","PSOBPSUT",167,0)
 S:'$D(STS) STS="S" S:'$D(SRC) SRC="" S HNG=+$G(HNG)
"RTN","PSOBPSUT",168,0)
 S RXNDC=$$GETNDC^PSONDCUT(RX,RFL)
"RTN","PSOBPSUT",169,0)
 ;
"RTN","PSOBPSUT",170,0)
 ; - Saves the NDC from CMOP/Automated Dispensing Machine in the Prescription file
"RTN","PSOBPSUT",171,0)
 I $$NDCFMT^PSSNDCUT(NDC)'="" D SAVNDC^PSONDCUT(RX,RFL,$$NDCFMT^PSSNDCUT(NDC),$S(SRC="C":1,1:0))
"RTN","PSOBPSUT",172,0)
 ;
"RTN","PSOBPSUT",173,0)
 ; - Not an ePharmacy Rx
"RTN","PSOBPSUT",174,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q ""
"RTN","PSOBPSUT",175,0)
 ;
"RTN","PSOBPSUT",176,0)
 ; - Unsuccessful Release 
"RTN","PSOBPSUT",177,0)
 I STS="U" D  Q
"RTN","PSOBPSUT",178,0)
 . D REVERSE^PSOBPSU1(RX,RFL,"CRLX",,"UNSUCCESSFUL "_$S(SRC="C":"CMOP",1:"EXT INTERFACE")_" RELEASE",1)
"RTN","PSOBPSUT",179,0)
 ;
"RTN","PSOBPSUT",180,0)
 ; - Notifying IB of a Rx RELEASE event 
"RTN","PSOBPSUT",181,0)
 D RELEASE^PSOBPSU1(RX,RFL)
"RTN","PSOBPSUT",182,0)
 ;
"RTN","PSOBPSUT",183,0)
 ; - Invalid NDC from Automated Dispensing Machine
"RTN","PSOBPSUT",184,0)
 I SRC="A",$$NDCFMT^PSSNDCUT(NDC)="" D  Q
"RTN","PSOBPSUT",185,0)
 . D REVERSE^PSOBPSU1(RX,RFL,"CRLR",,"INVALID EXT INTERFACE NDC",1,NDC)
"RTN","PSOBPSUT",186,0)
 ;
"RTN","PSOBPSUT",187,0)
 ; - Invalid NDC number for CMOP
"RTN","PSOBPSUT",188,0)
 I SRC="C",$$NDCFMT^PSSNDCUT(NDC)="" D  Q
"RTN","PSOBPSUT",189,0)
 . D REVERSE^PSOBPSU1(RX,RFL,"CRLR",,"INVALID CMOP NDC",1,NDC)
"RTN","PSOBPSUT",190,0)
 ;
"RTN","PSOBPSUT",191,0)
 ; - If NDC not equal RXNDC, issue reversal and submit new claim
"RTN","PSOBPSUT",192,0)
 I SRC="A",$$NDCFMT^PSSNDCUT(NDC)'=RXNDC D  Q
"RTN","PSOBPSUT",193,0)
 . D ECMESND^PSOBPSU1(RX,RFL,RLDT,"RL",$$NDCFMT^PSSNDCUT(NDC),,"AUTO RELEASE",,1,,1)
"RTN","PSOBPSUT",194,0)
 . H HNG
"RTN","PSOBPSUT",195,0)
 . ; - If new claim returned PAYABLE, save new NDC in the DRUG/PRESCRIPTION files
"RTN","PSOBPSUT",196,0)
 . I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" D SAVNDC^PSONDCUT(RX,RFL,$$NDCFMT^PSSNDCUT(NDC),0,1)
"RTN","PSOBPSUT",197,0)
 ;
"RTN","PSOBPSUT",198,0)
 ; - If NDC not equal RXNDC, issue reversal and submit new claim
"RTN","PSOBPSUT",199,0)
 I SRC="C",$$NDCFMT^PSSNDCUT(NDC)'=RXNDC D  Q
"RTN","PSOBPSUT",200,0)
 . ; - Reverse/Resubmit with correct NDC
"RTN","PSOBPSUT",201,0)
 . D ECMESND^PSOBPSU1(RX,RFL,RLDT,"CRLB",$$NDCFMT^PSSNDCUT(NDC),1,"CMOP RELEASE",,1,,1)
"RTN","PSOBPSUT",202,0)
 . ; - Wait for a response from the Payer for the submission above
"RTN","PSOBPSUT",203,0)
 . H HNG
"RTN","PSOBPSUT",204,0)
 . ; - If new claim returned PAYABLE, save new NDC in the DRUG/PRESCRIPTION files
"RTN","PSOBPSUT",205,0)
 . I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" D SAVNDC^PSONDCUT(RX,RFL,$$NDCFMT^PSSNDCUT(NDC),1,1)
"RTN","PSOBPSUT",206,0)
 ;
"RTN","PSOBPSUT",207,0)
 ; - Calls ECME api responsible for notifying IB to create a BILL
"RTN","PSOBPSUT",208,0)
 D IBSEND(RX,RFL)
"RTN","PSOBPSUT",209,0)
 ;
"RTN","PSOBPSUT",210,0)
 Q
"RTN","PSOBPSUT",211,0)
 ;
"RTN","PSOBPSUT",212,0)
IBSEND(RX,RFL) ; Rx Release: Calls ECME, which will call  IB to create a bill
"RTN","PSOBPSUT",213,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",214,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSOBPSUT",215,0)
 ;
"RTN","PSOBPSUT",216,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",217,0)
 ;
"RTN","PSOBPSUT",218,0)
 ; - ECME turned OFF for Rx's site
"RTN","PSOBPSUT",219,0)
 I '$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) Q
"RTN","PSOBPSUT",220,0)
 ;
"RTN","PSOBPSUT",221,0)
 ; - Not an ePharmacy Rx
"RTN","PSOBPSUT",222,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q ""
"RTN","PSOBPSUT",223,0)
 ;
"RTN","PSOBPSUT",224,0)
 ; - Calls ECME previously reversed, re-submit the claim to the payer
"RTN","PSOBPSUT",225,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="E REVERSAL ACCEPTED"!($$STATUS^PSOBPSUT(RX,RFL)="IN PROGRESS") D  Q
"RTN","PSOBPSUT",226,0)
 . D ECMESND^PSOBPSU1(RX,RFL,$$RXRLDT^PSOBPSUT(RX,RFL),"RRL")
"RTN","PSOBPSUT",227,0)
 ;
"RTN","PSOBPSUT",228,0)
 ; - Notifying ECME of a BILLING event 
"RTN","PSOBPSUT",229,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" D  Q
"RTN","PSOBPSUT",230,0)
 . N PSOCLAIM S PSOCLAIM=$$CLAIM^BPSBUTL(RX,RFL)
"RTN","PSOBPSUT",231,0)
 . D IBSEND^BPSECMP2($P(PSOCLAIM,"^",2),$P(PSOCLAIM,"^",3),"BILL",DUZ)
"RTN","PSOBPSUT",232,0)
 ;
"RTN","PSOBPSUT",233,0)
 Q
"RTN","PSOBPSUT",234,0)
 ;
"RTN","PSOBPSUT",235,0)
RETRX(RX,RFL) ; - Re-transmit a claim for the prescription/fill?
"RTN","PSOBPSUT",236,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",237,0)
 ;       (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",238,0)
 ;Output: 1 - Re-transmit  /  0 - Don't re-transmit
"RTN","PSOBPSUT",239,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",240,0)
 ;
"RTN","PSOBPSUT",241,0)
 I RFL Q +$$GET1^DIQ(52.1,RFL_","_RX,82,"I")
"RTN","PSOBPSUT",242,0)
 Q +$$GET1^DIQ(52,RX,82,"I")
"RTN","PSOCAN2")
0^68^B66349002
"RTN","PSOCAN2",1,0)
PSOCAN2 ;BHAM ISC/JMB - modular rx cancel with speed ability drug check ; 07/25/96  7:23 PM
"RTN","PSOCAN2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,18,62,46,88,164,235,148**;DEC 1997
"RTN","PSOCAN2",3,0)
 ;External reference to ^PSDRUG supported by dbia 221
"RTN","PSOCAN2",4,0)
REINS N DODR
"RTN","PSOCAN2",5,0)
 I $P(^PSRX(DA,2),"^",6)<DT D  Q
"RTN","PSOCAN2",6,0)
 .S Y=$P(^PSRX(DA,2),"^",6) X ^DD("DD")
"RTN","PSOCAN2",7,0)
 .W !!,"Rx: "_$P(^PSRX(DA,0),"^")_" Drug: "_$S($D(^PSDRUG($P(^PSRX(DA,0),"^",6),0)):$P(^(0),"^"),1:""),!,"Expired "_Y_" and cannot be Reinstated!",!
"RTN","PSOCAN2",8,0)
 .D PAUSE^VALM1
"RTN","PSOCAN2",9,0)
 I $D(^PSRX("APSOD",$P(^PSRX(DA,0),"^",2),DA)) S PSCAN($P(^PSRX(DA,0),"^"))=DA_"^R",DODR=1 D AUTOD G ACT
"RTN","PSOCAN2",10,0)
 I $P(PSOPAR,"^",2),'$D(^XUSEC("PSORPH",DUZ)) D VERIFY D  D AREC^PSOCAN1 Q
"RTN","PSOCAN2",11,0)
 .S RX1=$P(^PSRX(DA,0),"^") S:'$D(PSCAN(RX1)) PSCAN(RX1)=DA_"^R" K RX1
"RTN","PSOCAN2",12,0)
ACT W ! F I=1:1:80 W "="
"RTN","PSOCAN2",13,0)
 D ^PSOBUILD S DRG=+$P(^PSRX(DA,0),"^",6),DRG=$S($D(^PSDRUG(DRG,0)):$P(^(0),"^"),1:""),HOLDRX=RX
"RTN","PSOCAN2",14,0)
 W !!,RX_"  "_DRG D DRGDRG S RX=HOLDRX K HOLDRX Q:$P(^PSRX(+PSCAN(RX),"STA"),"^")'=12!($G(PSORX("DFLG")))  S DA=+PSCAN(RX),REA=$P(PSCAN(RX),"^",2) D CAN^PSOCAN W !
"RTN","PSOCAN2",15,0)
 N RXIEN S RXIEN=DA
"RTN","PSOCAN2",16,0)
 ;Takes action on reinstated Rx's
"RTN","PSOCAN2",17,0)
 S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S RFCNT=RF
"RTN","PSOCAN2",18,0)
 S (LPRT,LREF)="" F LL=0:0 S LL=$O(^PSRX(DA,"L",LL)) Q:'LL  S LPRT=$P($G(^PSRX(DA,"L",LL,0)),"."),LREF=$P($G(^(0)),"^",2)
"RTN","PSOCAN2",19,0)
 I 'RFCNT S FDT=$S($P($G(^PSRX(DA,2)),"^",2)'="":$P($G(^PSRX(DA,2)),"^",2),1:$P($G(^PSRX(DA,2)),"^")) S RELDT=$P(^(2),"^",13),RELDT=$P(RELDT,".")
"RTN","PSOCAN2",20,0)
 I RFCNT S FDT=$P($G(^PSRX(DA,1,RFCNT,0)),"^"),RELDT=$P(^(0),"^",18),RELDT=$P(RELDT,".")
"RTN","PSOCAN2",21,0)
 S Y=FDT D DD^%DT S XFDT=Y I RELDT'="" S Y=RELDT D DD^%DT S XRELDT=Y
"RTN","PSOCAN2",22,0)
 I LPRT'="" S Y=LPRT D DD^%DT S XLPDT=Y
"RTN","PSOCAN2",23,0)
 ;If Rx was released, do nothing
"RTN","PSOCAN2",24,0)
 I RELDT'="" W !,RX_" Reinstated -- ",!?3,$S('RFCNT:"Filled",1:"Refilled # "_LREF)_": "_XFDT,?32,"Printed: "_$S(LREF=RFCNT:XLPDT,1:""),?56,"Released: "_$G(XRELDT) H 3 Q
"RTN","PSOCAN2",25,0)
 ;If Rx not released, check fill/refill date for action
"RTN","PSOCAN2",26,0)
 I $G(PSXSYS) D REINS^PSOCMOPA I $G(XFLAG) K XFLAG Q
"RTN","PSOCAN2",27,0)
 W !,"Prescription #"_RX_" REINSTATED!"
"RTN","PSOCAN2",28,0)
 ;
"RTN","PSOCAN2",29,0)
 I $$SUBMIT^PSOBPSUT(RXIEN) D
"RTN","PSOCAN2",30,0)
 . N ACTION
"RTN","PSOCAN2",31,0)
 . D ECMESND^PSOBPSU1(RXIEN,,,$S($O(^PSRX(RXIEN,1,0)):"RF",1:"OF"))
"RTN","PSOCAN2",32,0)
 . I $$FIND^PSOREJUT(RXIEN) S ACTION=$$HDLG^PSOREJU1(RXIEN,,"79,88","OF","IOQ","I")
"RTN","PSOCAN2",33,0)
 ;
"RTN","PSOCAN2",34,0)
 W !?3,"Prescription #",RX," "
"RTN","PSOCAN2",35,0)
 I FDT<DT D
"RTN","PSOCAN2",36,0)
 .W $S('RFCNT:"Filled",1:"Refilled # "_LREF)_":  "_XFDT,?32,"Printed: "_$S(LREF=RFCNT:XLPDT,1:""),?56,"Released:"
"RTN","PSOCAN2",37,0)
 .S DIR("A")="     ** Do you want to print the label now",DIR("B")="N",DIR(0)="Y",DIR("?")="Enter 'Y' to print the label now.  If 'N' is entered, the label may be reprinted through reprint at a later date."
"RTN","PSOCAN2",38,0)
 .D ^DIR K DIR Q:$G(DIRUT)!('Y)  S PPL=DA D Q^PSORXL Q
"RTN","PSOCAN2",39,0)
 I FDT=DT W $S('RFCNT:"Filled",1:"Refilled # "_LREF)_": "_XFDT,?32,"Printed: "_$S(LREF=RFCNT:XLPDT,1:"")
"RTN","PSOCAN2",40,0)
 I  W ?56,"Released:",!?5,"Either print the label using the reprint option ",!?7,"or check later to see if the label has been printed." Q
"RTN","PSOCAN2",41,0)
 I FDT>DT W $S('RFCNT:"Filled",1:"Refilled # "_LREF)_": "_XFDT,?32,"Printed: "_$S(LREF=RFCNT:XLPDT,1:"")
"RTN","PSOCAN2",42,0)
 I  W ?56,"Released:" I '$G(DODR) W !?5,"Placing Rx on suspense.  Please wait..." D SUS
"RTN","PSOCAN2",43,0)
 K DODR
"RTN","PSOCAN2",44,0)
 Q
"RTN","PSOCAN2",45,0)
SUS ;Adds rec to suspense
"RTN","PSOCAN2",46,0)
 S ACT=1,RXN=DA,RX0=^PSRX(DA,0),RXS=$O(^PS(52.5,"B",DA,0)) I RXS S DA=RXS,DIK="^PS(52.5," D ^DIK S DA=RXN
"RTN","PSOCAN2",47,0)
 S RXP=$S($D(RXP):RXP,1:0),DIC="^PS(52.5,",DIC(0)="L",X=RXN,DIC("DR")=".02///"_FDT_";.03///"_$P(RX0,"^",2)_";.04///M;.05///"_RXP_";.06////"_$G(PSOSITE)_";2///0" K DD,DO D FILE^DICN
"RTN","PSOCAN2",48,0)
 I +$G(Y),$G(RFCNT)'="" S $P(^PS(52.5,+Y,0),"^",13)=$G(RFCNT)
"RTN","PSOCAN2",49,0)
 S DA=RXN,$P(^PSRX(DA,"STA"),"^")=5,LFD=$E($P(^PSRX(DA,3),"^"),4,5)_"-"_$E($P(^(3),"^"),6,7)_"-"_$E($P(^(3),"^"),2,3)
"RTN","PSOCAN2",50,0)
 S ACOM="RX Placed on Suspense until "_LFD D AREC^PSOCAN1 S ST="SC",PHST="ZS" D EN^PSOHLSN1(DA,ST,PHST,ACOM) K ST,PHST
"RTN","PSOCAN2",51,0)
 Q
"RTN","PSOCAN2",52,0)
DRGDRG ;Checks for drug/drug interaction, duplicate drug and class
"RTN","PSOCAN2",53,0)
 Q:$P(^PSRX(DA,2),"^",6)<DT
"RTN","PSOCAN2",54,0)
 S STA="ACTIVE^NON-VERIFIED^R^HOLD^NON-VERIFIED^ACTIVE^^^^^^ACTIVE^DISCONTINUED^^DISCONTINUED^DISCONTINUED^HOLD"
"RTN","PSOCAN2",55,0)
 S STAT=$P(STA,"^",$P(^PSRX(DA,"STA"),"^")+1)
"RTN","PSOCAN2",56,0)
 S X=$P(^PSRX(DA,0),"^",6),DIC="^PSDRUG(",DIC(0)="MZO" D ^DIC K DIC Q:$D(DTOUT)!(Y<0)
"RTN","PSOCAN2",57,0)
 K HOLD S NAME=$P(Y(0),"^") I +$G(PSOSD(STAT,NAME))=+PSCAN(RX) S HOLD(STAT,NAME)=$G(PSOSD(STAT,NAME)) K PSOSD(STAT,NAME)
"RTN","PSOCAN2",58,0)
 S:$G(PSONEW("OLD VAL"))=+Y PSODRG("QFLG")=1
"RTN","PSOCAN2",59,0)
 K PSOY S PSOY=Y,PSOY(0)=Y(0)
"RTN","PSOCAN2",60,0)
 S PSORENW("OIRXN")=DA D SET^PSODRG,POST^PSODRG S REA=$P(PSCAN($P(^PSRX(PSORENW("OIRXN"),0),"^")),"^",2)
"RTN","PSOCAN2",61,0)
 W ! S:$G(HOLD(STAT,NAME))]"" PSOSD(STAT,NAME)=$G(HOLD(STAT,NAME)) K HOLD,STA,STAT,PSORENW("OIRXN")
"RTN","PSOCAN2",62,0)
 Q
"RTN","PSOCAN2",63,0)
VERIFY ;Put in non-verify file
"RTN","PSOCAN2",64,0)
 S PSRXDA=DA,DIC="^PS(52.4,",DLAYGO=52.4,(X,DINUM)=PSRXDA,DIC(0)="ML",DIC("DR")="1////"_PSODFN_";2////"_DUZ_";4////"_DT
"RTN","PSOCAN2",65,0)
 K DD,DO D FILE^DICN K DIC,DLAYGO,DINUM
"RTN","PSOCAN2",66,0)
 S DA=PSRXDA S $P(^PSRX(DA,"STA"),"^")=1
"RTN","PSOCAN2",67,0)
 S ST="SC",PHST="IP",VCOM="Put in non-verified status" D EN^PSOHLSN1(DA,ST,PHST,VCOM) K ST,PHST,VCOM
"RTN","PSOCAN2",68,0)
 Q
"RTN","PSOCAN2",69,0)
HLD N PSDTEST,PDA,CMOP,SUSD I $P(^PSRX(DA,"STA"),"^")=3 D
"RTN","PSOCAN2",70,0)
 .S ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" while on hold during Rx cancel. " K:$P(^PSRX(DA,"H"),"^") ^PSRX("AH",$P(^PSRX(DA,"H"),"^"),DA) S ^PSRX(DA,"H")=""
"RTN","PSOCAN2",71,0)
 .I $P(^PSRX(DA,0),"^",13),'$O(^PSRX(DA,1,0)) S DIE=52,DR="22///"_$E($P(^PSRX(DA,0),"^",13),1,7) D ^DIE K DIE,DR Q
"RTN","PSOCAN2",72,0)
 .S (IFN,SUSD)=0 F  S IFN=$O(^PSRX(DA,1,IFN)) Q:'IFN  S SUSD=IFN,RFDT=$P(^PSRX(DA,1,IFN,0),"^")
"RTN","PSOCAN2",73,0)
 .Q:'$G(SUSD)  I '$P(^PSRX(DA,1,SUSD,0),"^",18) S PSDTEST=0 D  I 'PSDTEST K ^PSRX(DA,1,SUSD),^PSRX("AD",RFDT,DA,SUSD),^PSRX(DA,1,"B",RFDT,SUSD),IFN,SUSD,RFDT
"RTN","PSOCAN2",74,0)
 ..F PDA=0:0 S PDA=$O(^PSRX(DA,"L",PDA)) Q:'PDA  I $P($G(^PSRX(DA,"L",PDA,0)),"^",2)=SUSD S PSDTEST=1
"RTN","PSOCAN2",75,0)
 ..K CMOP D ^PSOCMOPA I $G(CMOP(CMOP("L")))="",$G(CMOP("S"))'="L" Q
"RTN","PSOCAN2",76,0)
 ..S PSDTEST=1
"RTN","PSOCAN2",77,0)
 Q
"RTN","PSOCAN2",78,0)
REF S IFN=0 F  S IFN=$O(^PSRX(DA,1,IFN)) Q:'IFN  I $P($G(^PSRX(DA,1,IFN,0)),"^")=SUSD,'$P(^(0),"^",18) D
"RTN","PSOCAN2",79,0)
 .D DELREF I $G(PSORFDEL) K PSORFDEL Q
"RTN","PSOCAN2",80,0)
 .K PSORFDEL K ^PSRX(DA,1,IFN),^PSRX("AD",SUSD,DA,IFN),^PSRX(DA,1,"B",SUSD,IFN)
"RTN","PSOCAN2",81,0)
 .S $P(^PSRX(DA,1,0),"^",4)=$P(^PSRX(DA,1,0),"^",4)-1,DA(1)=DA
"RTN","PSOCAN2",82,0)
 .S NODE=0 D SPR^PSOUTL K DA(1),RF,NODE
"RTN","PSOCAN2",83,0)
 S IFN=0 F  S IFN=$O(^PSRX(DA,1,IFN)) Q:'IFN  I '$O(^PSRX(DA,1,IFN)) S $P(^PSRX(DA,3),"^")=+$P(^PSRX(DA,1,IFN,0),"^"),$P(^(3),"^",2)=SUSD
"RTN","PSOCAN2",84,0)
 I '$O(^PSRX(DA,1,0)) S $P(^PSRX(DA,3),"^")=$P(^PSRX(DA,2),"^",2),$P(^PSRX(DA,3),"^",2)=SUSD
"RTN","PSOCAN2",85,0)
 K IFN,SUSD
"RTN","PSOCAN2",86,0)
 Q
"RTN","PSOCAN2",87,0)
KILL K %,ACNT,ACOM,ACT,ALL,BCNUM,CMOP,CNT,DA,DAYS360,DEAD,DRG,DIRUT,DR,DRUG,DTOUT,DUOUT,FDT,HOLD,I,II,IN,IT,JJ,LC,LFD,LINE,LL,LPRT,LREF,LSI,NAME,NDF,NOEXP,NSF,OUT,RXSP,EN,WARN K:'$G(POERR) INCOM
"RTN","PSOCAN2",88,0)
 K PSODRUG,PCNT,POP,PPL,PS,PSFROM,PSINV,PLINE,PSI,PSINV,PSOCAN,PSOCMOP,PSODFN,PSODRG,PSOOPT,PSOSD,PSPOP,PSRXDA,PSS,PSVC,PSONOOR
"RTN","PSOCAN2",89,0)
 K REA,RELDT,RF,RFDATE,RFCNT,RFL,RFL1,RFLL,RP,RX,RX0,RXCNT,RXDA,RXN,RXNUM,RXP,RXREC,RXREF,RXS,SDATE,SPCANC,SS,STAT,SUB,X,XFDT,XLPDT,XRELDT,Y D KVA^VADPT Q
"RTN","PSOCAN2",90,0)
DELREF ;
"RTN","PSOCAN2",91,0)
 N RDL,PSCNODE
"RTN","PSOCAN2",92,0)
 S PSORFDEL=0
"RTN","PSOCAN2",93,0)
 F RDL=0:0 S RDL=$O(^PSRX(DA,4,RDL)) Q:'RDL  I $G(IFN)=$P($G(^PSRX(DA,4,RDL,0)),"^",3) S PSCNODE=$G(^(0))
"RTN","PSOCAN2",94,0)
 I $G(PSCNODE)="" Q
"RTN","PSOCAN2",95,0)
 I +$P(PSCNODE,"^",4)<3 S PSORFDEL=1
"RTN","PSOCAN2",96,0)
 Q
"RTN","PSOCAN2",97,0)
AUTOD ;reinstates Rxs dc'd by date of death
"RTN","PSOCAN2",98,0)
 I $G(^PSRX(DA,"DDSTA"))']"" K ^PSRX("APSOD",+$P(^PSRX(DA,0),"^",2),DA),DODR Q
"RTN","PSOCAN2",99,0)
 S DODS=$P(^PSRX(DA,"DDSTA"),"^"),DODD=$P(^("DDSTA"),"^",2,245)
"RTN","PSOCAN2",100,0)
 S FILE=$P(DODS,";"),STA=$P(DODS,";",2)
"RTN","PSOCAN2",101,0)
 I FILE=52.4 D  Q
"RTN","PSOCAN2",102,0)
 .S RXN=DA,^PS(52.4,DA,0)=DODD,DIK="^PS(52.4," D IX^DIK K DIK,DA S DA=RXN,$P(^PSRX(DA,"STA"),"^")=STA
"RTN","PSOCAN2",103,0)
 .S ST="SC",PHST="IP",ACOM="Date of Death Deleted. Returned to Non-Verified status."
"RTN","PSOCAN2",104,0)
 .K ^PSRX("APSOD",$P(^PSRX(DA,0),"^",2),DA),^PSRX(DA,"DDSTA")
"RTN","PSOCAN2",105,0)
 .S DA=RXN D LOG D EN^PSOHLSN1(DA,ST,PHST,ACOM) K ST,PHST,ACOM,RXN
"RTN","PSOCAN2",106,0)
 I FILE=52.5 D  Q
"RTN","PSOCAN2",107,0)
 .;Adds rec to suspense
"RTN","PSOCAN2",108,0)
 .S RXN=DA,RXS=$O(^PS(52.5,"B",DA,0)) I RXS S DA=RXS,DIK="^PS(52.5," D ^DIK
"RTN","PSOCAN2",109,0)
 .S DIC="^PS(52.5,",DIC(0)="L",X=RXN K DD,DO D FILE^DICN S DA=+Y
"RTN","PSOCAN2",110,0)
 .S ^PS(52.5,DA,0)=DODD,^PS(52.5,DA,"P")=0,LFD=$E($P(^PS(52.5,DA,0),"^",2),4,5)_"-"_$E($P(^(0),"^",2),6,7)_"-"_$E($P(^(0),"^",2),2,3)
"RTN","PSOCAN2",111,0)
 .S DIK="^PS(52.5," D IX^DIK K DIK,DA S DA=RXN,$P(^PSRX(DA,"STA"),"^")=STA
"RTN","PSOCAN2",112,0)
 .S ACOM="Date of Death Deleted. RX Placed on Suspense until "_LFD
"RTN","PSOCAN2",113,0)
 .K ^PSRX("APSOD",PSODFN,DA),^PSRX(DA,"DDSTA")
"RTN","PSOCAN2",114,0)
 .I STA=5 S ST="SC",PHST="ZS" D LOG D EN^PSOHLSN1(DA,ST,PHST,ACOM) K ST,PHST,ACOM,LFD
"RTN","PSOCAN2",115,0)
 I FILE=52 S ^PSRX(DA,"STA")=STA I STA=3!(STA=16) D  Q
"RTN","PSOCAN2",116,0)
 .S ^PSRX(DA,"H")=DODD,^PSRX("AH",$P(^PSRX(DA,"H"),"^"),DA)=""
"RTN","PSOCAN2",117,0)
 .S ACOM="Date of Death Deleted. Medication Returned to"_$S(STA=16:" Provider",1:"")_" Hold Status "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)_"."
"RTN","PSOCAN2",118,0)
 .D LOG,EN^PSOHLSN1(DA,"OH","",ACOM) K ACOM
"RTN","PSOCAN2",119,0)
 .K ^PSRX("APSOD",PSODFN,DA),^PSRX(DA,"DDSTA")
"RTN","PSOCAN2",120,0)
 S ACOM="Date of Death Deleted. Prescription Reinstated." D EN^PSOHLSN1(DA,"SC","CM",ACOM),LOG K ACOM
"RTN","PSOCAN2",121,0)
 Q
"RTN","PSOCAN2",122,0)
LOG K ACNT F SUB=0:0 S SUB=$O(^PSRX(DA,"A",SUB)) Q:'SUB  S ACNT=$G(ACNT)+1
"RTN","PSOCAN2",123,0)
 S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S RFCNT=$G(RFCNT)+1 S:RF>5 RFCNT=$G(RFCNT)+1
"RTN","PSOCAN2",124,0)
 S ACNT=$G(ACNT)+1
"RTN","PSOCAN2",125,0)
 D NOW^%DTC S ^PSRX(DA,"A",0)="^52.3DA^"_ACNT_"^"_ACNT S ^PSRX(DA,"A",ACNT,0)=%_"^R^"_DUZ_"^"_RFCNT_"^"_ACOM
"RTN","PSOCAN2",126,0)
 K ^PSRX("APSOD",PSODFN,DA),ACNT,RFCNT,RF,%
"RTN","PSOCAN2",127,0)
 S $P(^PSRX(DA,3),"^")=$P(^PSRX(DA,3),"^",5),$P(^(3),"^",2)=$P(^(3),"^",8)
"RTN","PSOCAN2",128,0)
 S $P(^PSRX(DA,3),"^",5)="",$P(^(3),"^",8)=""
"RTN","PSOCAN2",129,0)
 Q
"RTN","PSOCAN2",130,0)
NVER ;Called from PSOCAN3, needs DA defined
"RTN","PSOCAN2",131,0)
 N PSONVC,PSONVCP,PSONVCC
"RTN","PSOCAN2",132,0)
 S PSONVC="SC",PSONVCP="IP",PSONVCC="Put in non-verified status" D EN^PSOHLSN1(DA,PSONVC,PSONVCP,PSONVCC)
"RTN","PSOCAN2",133,0)
 Q
"RTN","PSOCAN2",134,0)
RMB(IDX) ;remove Rx if found in array BBRX() (Bingo Board)
"RTN","PSOCAN2",135,0)
 N ST4,ST5,ST6,K
"RTN","PSOCAN2",136,0)
 S ST4=BBRX(IDX) Q:ST4'[(DA_",")
"RTN","PSOCAN2",137,0)
 S ST6=""
"RTN","PSOCAN2",138,0)
 F K=1:1 S ST5=$P(ST4,",",K) Q:'ST5  D
"RTN","PSOCAN2",139,0)
 . S:ST5'=DA ST6=ST6_$S('ST6:"",1:",")_ST5
"RTN","PSOCAN2",140,0)
 . S:ST6]"" BBRX(IDX)=ST6_"," K:ST6="" BBRX(IDX)
"RTN","PSOCAN2",141,0)
 I '$D(BBRX) K BINGCRT
"RTN","PSOCAN2",142,0)
 Q
"RTN","PSOCAN3")
0^89^B71670516
"RTN","PSOCAN3",1,0)
PSOCAN3 ;BIR/RTR/SAB - auto dc rxs due to death ;2/5/97
"RTN","PSOCAN3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,24,27,32,36,94,88,117,131,146,139,132,223,235,148**;DEC 1997
"RTN","PSOCAN3",3,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOCAN3",4,0)
 ;External references to L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOCAN3",5,0)
 Q
"RTN","PSOCAN3",6,0)
APSOD(PSODFN) ;called from file #2 date of death xref 'APOSD'
"RTN","PSOCAN3",7,0)
 N D,DA,DB,DC,DE,DG,DH,DI,DIC,DIE,DIG,DIH,DIK,DIR,DIQ,DIU,DIV,DIW,DK,DL,DM,DP,DQ,DU,DV,DW,DR
"RTN","PSOCAN3",8,0)
 S PSODEATH=1 D CAN K PSODEATH
"RTN","PSOCAN3",9,0)
 Q
"RTN","PSOCAN3",10,0)
CAN ;discontinued rxs due to death
"RTN","PSOCAN3",11,0)
 I $G(PSODFN),$D(^PS(52.91,PSODFN,0)) D
"RTN","PSOCAN3",12,0)
 .I '$P($G(^PS(52.91,PSODFN,0)),"^",3)!($P($G(^(0)),"^",3)>DT) S $P(^PS(52.91,PSODFN,0),"^",3)=DT,$P(^PS(52.91,PSODFN,0),"^",4)=5,^PS(52.91,"AX",DT,PSODFN)="" D SET^PSOTPCAN(PSODFN)
"RTN","PSOCAN3",13,0)
 F PSORXJ=0:0 S PSORXJ=$O(^PS(55,PSODFN,"P",PSORXJ)) Q:'PSORXJ  I $D(^(PSORXJ,0)) S PSORX=^(0) S STA=$S($P($G(^PSRX(PSORX,"STA")),"^")<11:1,$P($G(^("STA")),"^")=16:1,1:0) D:STA
"RTN","PSOCAN3",14,0)
 .I $D(^PSRX(PSORX,0)),$P($G(^PSRX(PSORX,"STA")),"^")="" D SETC
"RTN","PSOCAN3",15,0)
 .D REVERSE^PSOBPSU1(PSORX,,"DC",7)
"RTN","PSOCAN3",16,0)
 .I $D(^PSRX(PSORX,0)),$P($G(^PSRX(PSORX,2)),"^",6)'<DT S PSO0=^(0),PSO2=$G(^(2)) D
"RTN","PSOCAN3",17,0)
 ..S ^PSRX(PSORX,"DDSTA")="52;"_$P(^PSRX(PSORX,"STA"),"^")
"RTN","PSOCAN3",18,0)
 ..;remove from hold
"RTN","PSOCAN3",19,0)
 ..I $G(^PSRX(PSORX,"H"))]"" D
"RTN","PSOCAN3",20,0)
 ...S ^PSRX(PSORX,"DDSTA")="52;"_$P(^PSRX(PSORX,"STA"),"^")_"^"_^PSRX(PSORX,"H")
"RTN","PSOCAN3",21,0)
 ...K:$P(^PSRX(PSORX,"H"),"^") ^PSRX("AH",$P(^PSRX(PSORX,"H"),"^"),PSORX) S ^PSRX(PSORX,"H")=""
"RTN","PSOCAN3",22,0)
 ...I '$P($G(^PSRX(PSORX,2)),"^",2),$P($G(^(3)),"^") S $P(^PSRX(PSORX,2),"^",2)=$P(^(3),"^")
"RTN","PSOCAN3",23,0)
 ...I $G(PSODEATH),$P(^PSRX(PSORX,0),"^",2) S ^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",24,0)
 ..;delete from non-verified file
"RTN","PSOCAN3",25,0)
 ..I $G(^PS(52.4,PSORX,0))]"" S ^PSRX(PSORX,"DDSTA")="52.4;"_$P(^PSRX(PSORX,"STA"),"^")_"^"_^PS(52.4,PSORX,0),DIK="^PS(52.4,",DA=PSORX D ^DIK K DIK
"RTN","PSOCAN3",26,0)
 ..I $G(PSODEATH),$P(^PSRX(PSORX,0),"^",2) S ^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",27,0)
 ..;delete from suspense
"RTN","PSOCAN3",28,0)
 ..D:$O(^PS(52.5,"B",PSORX,0))
"RTN","PSOCAN3",29,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)) I '$G(^PS(52.5,DA,"P")),$G(PSODEATH) S ^PSRX(PSORX,"DDSTA")="52.5;5^"_^PS(52.5,DA,0),^PSRX("APSOD",$P(^PSRX(PSORX,0),"^",2),PSORX)=""
"RTN","PSOCAN3",30,0)
 ...I $O(^PSRX(PSORX,1,0)),'$G(PSODEATH) S DA=PSORX,SUSD=$P($G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),0)),"^",2) D:'$G(^PS(52.5,$O(^PS(52.5,"B",PSORX,0)),"P")) REF^PSOCAN2
"RTN","PSOCAN3",31,0)
 ...S DA=$O(^PS(52.5,"B",PSORX,0)),DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOCAN3",32,0)
 ..D SETC
"RTN","PSOCAN3",33,0)
 ..;activity record
"RTN","PSOCAN3",34,0)
 ..S (COM,ACOM)=$S($G(PSODEATH):"Date of Death Entered by MAS",1:"Discontinued by Pharmacy")_"."
"RTN","PSOCAN3",35,0)
 ..S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(PSORX,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOCAN3",36,0)
 ..S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(PSORX,1,RF)) Q:'RF  S RFCNT=RF
"RTN","PSOCAN3",37,0)
 ..D NOW^%DTC S ACNT=ACNT+1,^PSRX(PSORX,"A",0)="^52.3DA^"_ACNT_"^"_ACNT
"RTN","PSOCAN3",38,0)
 ..S ^PSRX(PSORX,"A",ACNT,0)=%_"^"_"C"_"^^"_RFCNT_"^"_"Auto Discontinued Due to Death. "_ACOM
"RTN","PSOCAN3",39,0)
 ..;check for label/release/pending release
"RTN","PSOCAN3",40,0)
 ..D FIL
"RTN","PSOCAN3",41,0)
 ..S STAT="OD",PHARMST="" D EN^PSOHLSN1(PSORX,STAT,PHARMST,COM,"A") K COMM,PHARMST,STAT
"RTN","PSOCAN3",42,0)
 ;dc pending orders
"RTN","PSOCAN3",43,0)
 F PDA=0:0 S PDA=$O(^PS(52.41,"P",PSODFN,PDA)) Q:'PDA  I $P(^PS(52.41,PDA,0),"^",3)'="DC"&($P(^(0),"^",3)'="DE") D
"RTN","PSOCAN3",44,0)
 .I $G(PSODEATH) D
"RTN","PSOCAN3",45,0)
 ..S ^PS(52.41,PDA,"DDSTA")=$P(^PS(52.41,PDA,0),"^",3)_";"_+$P($G(^PS(52.41,PDA,"INI")),"^"),^PS(52.41,"APSOD",PSODFN,PDA)=""
"RTN","PSOCAN3",46,0)
 ..S $P(^PS(52.41,PDA,4),"^")="Date of Death Entered by MAS."
"RTN","PSOCAN3",47,0)
 .S $P(^PS(52.41,PDA,0),"^",3)="DC"
"RTN","PSOCAN3",48,0)
 .K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,PDA,"INI")),"^"),PDA)
"RTN","PSOCAN3",49,0)
 .S COM=$S($G(PSODEATH):"Date of Death Entered by MAS.",1:""),PL=$P(^PS(52.41,PDA,0),"^"),$P(^(0),"^",3)="DC"
"RTN","PSOCAN3",50,0)
 .D EN^PSOHLSN(PL,"OC",COM,"A") K COM,PL
"RTN","PSOCAN3",51,0)
 ;dc non-va meds
"RTN","PSOCAN3",52,0)
 D APSOD^PSONVNEW
"RTN","PSOCAN3",53,0)
KILL K %,%H,%T,ACNT,DA,PDA,DIRUT,DTOUT,PSO,PSO0,PSO2,PSOD,PSOD0,PSODFN,PSODL,PSORX,PSORXJ,PSOSD,RF,RFCNT,SUB,TM,TSKDT,X,X1,X2,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","PSOCAN3",54,0)
 D KVAR^VADPT S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOCAN3",55,0)
 Q
"RTN","PSOCAN3",56,0)
CAN1 Q:$G(DODR)
"RTN","PSOCAN3",57,0)
 S PSOMGDFN=$G(PSODFN) ; SAVE IN CASE CANCELING RX THAT WAS MERGED TO ANOTHER DFN
"RTN","PSOCAN3",58,0)
 I $G(^PSRX(DA,"H"))]"" D HLD^PSOCAN2
"RTN","PSOCAN3",59,0)
 D REVERSE^PSOBPSU1(DA,,"DC",7)
"RTN","PSOCAN3",60,0)
 S PSCANVAR=0,RXDA=DA,DA=$O(^PS(52.5,"B",DA,0)) I DA,'$G(^PS(52.5,DA,"P")) S PSCANVAR=1 D
"RTN","PSOCAN3",61,0)
 .S SUSD=$P($G(^PS(52.5,DA,0)),"^",2)
"RTN","PSOCAN3",62,0)
 .S:+$G(^PS(52.5,DA,"P"))'=1 ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" while suspended. "_$G(COM)
"RTN","PSOCAN3",63,0)
 .S DIK="^PS(52.5," D ^DIK K DIK S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2)
"RTN","PSOCAN3",64,0)
 .D AREC^PSOCAN1 S DA=RXDA I $O(^PSRX(DA,1,0)) D REF^PSOCAN2
"RTN","PSOCAN3",65,0)
 I $G(REA)="C" S DA=$O(^PS(52.5,"B",RXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOCAN3",66,0)
 I 'PSCANVAR S:$D(SPCANC) ACOM=$S(REA="C":"Discontinued",1:"Reinstated")_" during Rx cancel.  "
"RTN","PSOCAN3",67,0)
ADD S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2) S:$G(PSOOPT)=3 REA="L"
"RTN","PSOCAN3",68,0)
 D:'$G(PSCANVAR) AREC^PSOCAN1 S:REA="L" REA="C" S:REA'="C" $P(^PSRX(DA,"STA"),"^")=0
"RTN","PSOCAN3",69,0)
 N PSOTPCNZ S PSOTPCNZ=0 I $P(^PSRX(DA,"STA"),"^")'=12 S PSOTPCNZ=1
"RTN","PSOCAN3",70,0)
 S:REA="C"&($P(^PSRX(DA,"STA"),"^")<12)!($P(^("STA"),"^")=16) $P(^PSRX(DA,"STA"),"^")=12 I $P($G(^PSRX(DA,"STA")),"^")=12,$G(PSOTPCNZ) D CAN^PSOTPCAN(DA)
"RTN","PSOCAN3",71,0)
 K PSOTPCNZ
"RTN","PSOCAN3",72,0)
 I REA="R" D
"RTN","PSOCAN3",73,0)
 .I $P(^PSRX(DA,3),"^",8) S $P(^PSRX(DA,3),"^",2)=$P(^PSRX(DA,3),"^",8),$P(^(3),"^",8)=""
"RTN","PSOCAN3",74,0)
 .I $P(^PSRX(DA,3),"^",5) S $P(^PSRX(DA,3),"^")=$P(^PSRX(DA,3),"^",5),$P(^(3),"^",5)=""
"RTN","PSOCAN3",75,0)
 I REA="C" D
"RTN","PSOCAN3",76,0)
 .S:'$P(^PSRX(DA,3),"^",5) $P(^PSRX(DA,3),"^",5)=$S($P($G(^PSRX(DA,3)),"^"):$P(^(3),"^"),1:DT)
"RTN","PSOCAN3",77,0)
 .I $O(^PS(52.41,"ARF",DA,0)),'$O(^PS(52.41,"APSOD",PSODFN,0)) S HLDDA=DA,DA=$O(^PS(52.41,"ARF",DA,0)),DIK="^PS(52.41," D ^DIK S DA=HLDDA K HLDDA
"RTN","PSOCAN3",78,0)
 .;check for label/release/pending release
"RTN","PSOCAN3",79,0)
 .I $G(PSOOPT)'=3 D FILX
"RTN","PSOCAN3",80,0)
 S PSONOOR=$S($D(PSONOOR):PSONOOR,1:"D"),STAT=$S(REA="C":"OD",1:"SC"),PHARMST=$S(REA="C":"",1:"CM")
"RTN","PSOCAN3",81,0)
 S COM=$S(REA="C":$S($G(PSOOPT)=3&('$G(DUP)):"Renewed",1:"Discontinued")_" by Pharmacy",1:"Reinstated by Pharmacy")
"RTN","PSOCAN3",82,0)
 D EN^PSOHLSN1(DA,STAT,PHARMST,COM,$S($G(PSOOPT)=3&('$G(DUP)):"",1:PSONOOR)) K COM,STAT,PHARMST,PSCANVAR
"RTN","PSOCAN3",83,0)
 I REA="C" D
"RTN","PSOCAN3",84,0)
 .I $G(^PS(52.4,DA,0))]"" S PSCDA=DA,DIK="^PS(52.4," D ^DIK S DA=PSCDA K DIK,PSCDA
"RTN","PSOCAN3",85,0)
 I $G(PSOMGDFN)'="" S PSODFN=PSOMGDFN K PSOMGDFN
"RTN","PSOCAN3",86,0)
 Q:(REA="C")!('$P($G(PSOPAR),"^",2))!($P(^PSRX(DA,2),"^",10)]"")
"RTN","PSOCAN3",87,0)
 Q:$D(^XUSEC("PSORPH",DUZ))  S PSVC=$P(^PSRX(DA,0),"^",16) F JJ=0:0 S JJ=$O(^PS(55,PSODFN,"P",JJ)) Q:'JJ  I $D(^(JJ,0)),+^(0)=DA Q
"RTN","PSOCAN3",88,0)
 Q:'JJ  S PSRXIN=DA,DIC="^PS(52.4,",DLAYGO=52.4,(X,DINUM)=PSRXIN,DIC(0)="ML"
"RTN","PSOCAN3",89,0)
 S DIC("DR")="1////"_$G(PSODFN)_";2////"_DUZ_";4////"_DT
"RTN","PSOCAN3",90,0)
 K DD,DO D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM
"RTN","PSOCAN3",91,0)
 K DA,DIK S DA=PSRXIN K PSRXIN S $P(^PSRX(DA,"STA"),"^")=1 D NVER^PSOCAN2
"RTN","PSOCAN3",92,0)
 W !,"Rx # "_$P(^PSRX(DA,0),"^")_" is still non-verified!"
"RTN","PSOCAN3",93,0)
 Q
"RTN","PSOCAN3",94,0)
OERR I '$D(^XUSEC("PSORPH",DUZ)),'$P($G(PSOPAR),"^",2) S VALMSG="Invalid Action Selection!",VALMBCK="" Q
"RTN","PSOCAN3",95,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSOCAN3",96,0)
 K PSOPLCK S PSOCANRD=+$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^",4),PSOCANRA=1
"RTN","PSOCAN3",97,0)
 I $P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^"),$P(^("STA"),"^")=1!($P(^("STA"),"^")=4) S:$G(SPEED) PSONOORS=$G(PSONOOR) D DEL^PSOCAN4 S:$G(PSONOORS)'="" PSONOOR=$G(PSONOORS) K PSONOORS D KCAN D ULP Q
"RTN","PSOCAN3",98,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D KCAN D ULP Q
"RTN","PSOCAN3",99,0)
 I '+^PSRX($P(PSOLST(ORN),"^",2),"OR1"),$P(^("STA"),"^")=12 S VALMSG="Rx Cannot be Reinstated.  No Orderable Item." D KCAN D ULP D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOCAN3",100,0)
 I $P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12,$P($G(^("PKI")),"^") S VALMSG="Cannot be Reinstated - Digitally Signed" D KCAN D ULP D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOCAN3",101,0)
 I $P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12 S PSOCANRZ=1
"RTN","PSOCAN3",102,0)
 D HLDHDR^PSOLMUTL S X=$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),PS=$S($P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^")=12:"Reinstate: ",1:"Discontinue: ")
"RTN","PSOCAN3",103,0)
 S POERR=1,DFNHLD=PSODFN,DA=$P(PSOLST(ORN),"^",2)
"RTN","PSOCAN3",104,0)
 D LMNO D:$P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=12 RMP
"RTN","PSOCAN3",105,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOCAN3",106,0)
 K POERR,PSCAN,PSI,PSL S PSODFN=DFNHLD K DFNHLD D ULP
"RTN","PSOCAN3",107,0)
 D KCAN
"RTN","PSOCAN3",108,0)
 Q
"RTN","PSOCAN3",109,0)
 Q
"RTN","PSOCAN3",110,0)
ULP D UL^PSSLOCK(+$G(PSODFN))
"RTN","PSOCAN3",111,0)
 Q
"RTN","PSOCAN3",112,0)
 ;
"RTN","PSOCAN3",113,0)
LMNO ; Calls LMNO^PSOCAN
"RTN","PSOCAN3",114,0)
 N PSODFN,PSORX,RXN,RX0
"RTN","PSOCAN3",115,0)
 S PSPOP=0,RXNUM=X S PSODFN=+$P(^PSRX(DA,0),"^",2) D LMNO^PSOCAN
"RTN","PSOCAN3",116,0)
 Q
"RTN","PSOCAN3",117,0)
 ;
"RTN","PSOCAN3",118,0)
KCAN ;
"RTN","PSOCAN3",119,0)
 K PSOCANRA,PSOCANRC,PSOCANRD,PSOCANRN,PSOCANRP,PSOCANRZ,PSOMSG
"RTN","PSOCAN3",120,0)
 Q
"RTN","PSOCAN3",121,0)
 ;
"RTN","PSOCAN3",122,0)
KCAN1 ;
"RTN","PSOCAN3",123,0)
 K PSOCANRC,PSOCANRD,PSOCANRN,PSOCANRP,PSOCANRZ
"RTN","PSOCAN3",124,0)
 Q
"RTN","PSOCAN3",125,0)
 ;
"RTN","PSOCAN3",126,0)
RMP ;remove Rx if found in array PSORX("PSOL") (Label Queue)
"RTN","PSOCAN3",127,0)
 Q:'$D(PSORX("PSOL"))  S:'$G(DA) DA=$P(PSOLST(ORN),"^",2)
"RTN","PSOCAN3",128,0)
 N I,J,FND,ST1,ST2,ST3 S I=0
"RTN","PSOCAN3",129,0)
 F  S I=$O(PSORX("PSOL",I)) Q:'I  D
"RTN","PSOCAN3",130,0)
 . S ST1=PSORX("PSOL",I) Q:ST1'[(DA_",")
"RTN","PSOCAN3",131,0)
 . S ST3="",FND=0
"RTN","PSOCAN3",132,0)
 . F J=1:1 S ST2=$P(ST1,",",J) Q:'ST2  D
"RTN","PSOCAN3",133,0)
 . . I ST2=DA S FND=1 Q
"RTN","PSOCAN3",134,0)
 . . S ST3=ST3_$S('ST3:"",1:",")_ST2
"RTN","PSOCAN3",135,0)
 . I FND D
"RTN","PSOCAN3",136,0)
 . . S:ST3]"" PSORX("PSOL",I)=ST3_","
"RTN","PSOCAN3",137,0)
 . . K:ST3="" PSORX("PSOL",I)
"RTN","PSOCAN3",138,0)
 . . D:$D(BBRX(I)) RMB^PSOCAN2(I)
"RTN","PSOCAN3",139,0)
 Q
"RTN","PSOCAN3",140,0)
 ;
"RTN","PSOCAN3",141,0)
FIL Q:'$G(PSORX)
"RTN","PSOCAN3",142,0)
 S PSOFC=PSORX G FILC
"RTN","PSOCAN3",143,0)
FILX Q:'$G(DA)
"RTN","PSOCAN3",144,0)
 S PSOFC=DA
"RTN","PSOCAN3",145,0)
FILC ;
"RTN","PSOCAN3",146,0)
 N PFC,PSOFFLAG
"RTN","PSOCAN3",147,0)
 I $P($G(^PSRX(PSOFC,2)),"^",13) G FILQ
"RTN","PSOCAN3",148,0)
 S PSOFFLAG=0 F PFC=0:0 S PFC=$O(^PSRX(PSOFC,1,PFC)) Q:'PFC!(PSOFFLAG)  I $P($G(^PSRX(PSOFC,1,PFC,0)),"^",18) S PSOFFLAG=1
"RTN","PSOCAN3",149,0)
 I PSOFFLAG G FILQ
"RTN","PSOCAN3",150,0)
 F PFC=0:0 S PFC=$O(^PSRX(PSOFC,"L",PFC)) Q:'PFC!(PSOFFLAG)  I $D(^PSRX(PSOFC,"L",PFC,0)),'$P($G(^(0)),"^",5) S PSOFFLAG=1
"RTN","PSOCAN3",151,0)
 I PSOFFLAG G FILQ
"RTN","PSOCAN3",152,0)
 S PSOFCSUS=$O(^PS(52.5,"B",PSOFC,0))
"RTN","PSOCAN3",153,0)
 I $G(PSOFCSUS),$P($G(^PS(52.5,PSOFCSUS,0)),"^",7)="L"!($P($G(^(0)),"^",7)="X") G FILQ
"RTN","PSOCAN3",154,0)
 S $P(^PSRX(PSOFC,3),"^",8)=$P($G(^PSRX(PSOFC,3)),"^",2)
"RTN","PSOCAN3",155,0)
 S $P(^PSRX(PSOFC,3),"^",2)=$P($G(^PSRX(PSOFC,2)),"^",2)
"RTN","PSOCAN3",156,0)
 I $P($G(^PSRX(PSOFC,"OR1")),"^",3) S $P(^PSRX(PSOFC,3),"^")=$P($G(^PSRX($P(^PSRX(PSOFC,"OR1"),"^",3),3)),"^")
"RTN","PSOCAN3",157,0)
FILQ K PSOFC,PSOFCSUS
"RTN","PSOCAN3",158,0)
 Q
"RTN","PSOCAN3",159,0)
 ;
"RTN","PSOCAN3",160,0)
SETC ;Called from Date of Death
"RTN","PSOCAN3",161,0)
 S $P(^PSRX(PSORX,"STA"),"^")=12,$P(^PSRX(PSORX,3),"^",5)=$S($P($G(^PSRX(PSORX,3)),"^"):$P(^(3),"^"),1:DT) D CAN^PSOTPCAN(PSORX)
"RTN","PSOCAN3",162,0)
 Q
"RTN","PSOCMOP")
0^71^B37025252
"RTN","PSOCMOP",1,0)
PSOCMOP ;BIR/HTW-Rx Order Entry Screen for CMOP ;02/19/98  9:21 AM 
"RTN","PSOCMOP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,16,21,27,43,61,126,148**;DEC 1997
"RTN","PSOCMOP",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOCMOP",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOCMOP",5,0)
 ;External reference to ^PSDRUG supported by DBIA 3165
"RTN","PSOCMOP",6,0)
 ;External reference to ^PSSHUIDG supported by DBIA 3621
"RTN","PSOCMOP",7,0)
TOP ;
"RTN","PSOCMOP",8,0)
 I $G(PSOFROM)="EDIT" S PPL=$G(PSORX("PSOL",1)) Q:$G(PPL)']""  G TEST
"RTN","PSOCMOP",9,0)
 I $G(PPL) G START
"RTN","PSOCMOP",10,0)
 I '$G(RXLTOP) S PPL=$G(DA) G TEST
"RTN","PSOCMOP",11,0)
 S:'$G(PPL) PPL=$G(PSORX("PSOL",1)) G:$G(PPL)']"" D1
"RTN","PSOCMOP",12,0)
START ;          Establish CMOP PPL
"RTN","PSOCMOP",13,0)
TEST N ACT,B,C,CK,COMM,CNT,DFLG,I,FLAG,MW,NEWDT,PI,P1,P2,REL,RFD,RX,RX0,RXN
"RTN","PSOCMOP",14,0)
 N RXP,RXS,SD,VALMSG,X,X7,Y,ZD,DFN,TRX
"RTN","PSOCMOP",15,0)
 S (P1,P2)=1,FLAG=0
"RTN","PSOCMOP",16,0)
 ;   PSOMC=Mail Code, PSOMDT=Mail Code Expiration Date
"RTN","PSOCMOP",17,0)
 S TRX=$P($G(PPL),",",1)
"RTN","PSOCMOP",18,0)
 S DFN=$P(^PSRX(TRX,0),"^",2),PSOMDT=$P($G(^PS(55,DFN,0)),"^",5),PSOMC=$P($G(^PS(55,DFN,0)),"^",3) K DFN,TRX
"RTN","PSOCMOP",19,0)
 I (PSOMC>1&(PSOMDT>DT))!(PSOMC>1&(PSOMDT<1)) K PSOMC,PSOMDT G RESET
"RTN","PSOCMOP",20,0)
LOOP F CNT=1:1 S RX=$P($G(PPL),",",CNT) Q:RX']""  D  S:'FLAG $P(RX("PSO"),",",P1)=RX,P1=P1+1 S FLAG=0
"RTN","PSOCMOP",21,0)
 .;          Get drug IEN and check if CMOP
"RTN","PSOCMOP",22,0)
 .S CK=$P($G(^PSRX(RX,0)),"^",6) Q:'$D(^PSDRUG("AQ",CK))
"RTN","PSOCMOP",23,0)
 .;          If not marked for O.P., unmark for CMOP...
"RTN","PSOCMOP",24,0)
 .I $P($G(^PSDRUG(CK,2)),"^",3)'["O" D UNMARK^PSOCMOP Q
"RTN","PSOCMOP",25,0)
 .;          Check Drug Warning >11
"RTN","PSOCMOP",26,0)
 .N WARNS,COMM S WARNS=$P(^PSDRUG(CK,0),U,8) I $L(WARNS)>11 D  Q
"RTN","PSOCMOP",27,0)
 .. S COMM(1)="Rx# "_$P(^PSRX(RX,0),"^")_" CMOP cannot dispense - Drug warnings >11 characters."
"RTN","PSOCMOP",28,0)
 .. S COMM(2)="Drug Name: "_$P(^PSDRUG(CK,0),U)_"  (IEN: # "_CK_")"
"RTN","PSOCMOP",29,0)
 .. D COMM(RX,.COMM)
"RTN","PSOCMOP",30,0)
 .;           Q:If partial or pull early
"RTN","PSOCMOP",31,0)
 .Q:$G(RXPR(RX))!($G(RXRS(RX)))
"RTN","PSOCMOP",32,0)
 .;           Q:If standard reprint but allow edit reprint
"RTN","PSOCMOP",33,0)
 .I $G(RXRP(RX))&($P($G(RXRP(RX)),"^",4)'=1) Q
"RTN","PSOCMOP",34,0)
 .;           Q:If tradename
"RTN","PSOCMOP",35,0)
 .Q:$G(^PSRX(RX,"TN"))]""
"RTN","PSOCMOP",36,0)
 .;           Q: If Cancelled, Expired, Deleted, Hold
"RTN","PSOCMOP",37,0)
 .Q:$P(^PSRX(RX,"STA"),"^")>9!($P(^("STA"),"^")=4)!($P(^("STA"),"^")=3)
"RTN","PSOCMOP",38,0)
 .;        Find last fill
"RTN","PSOCMOP",39,0)
 .S RFD=0 F X7=0:0 S X7=$O(^PSRX(RX,1,X7)) Q:'$G(X7)  S (RFD)=X7
"RTN","PSOCMOP",40,0)
 .Q:$G(RXFL(RX))&(RFD)&($G(RXFL(RX))'=RFD)
"RTN","PSOCMOP",41,0)
 .I '$O(^PSRX(RX,1,0)),'$P($G(^PSRX(RX,2)),"^",13),$P($G(^(0)),"^",11)="W",$S($P($G(^PSRX(RX,2)),"^",2):$P($G(^(2)),"^",2),1:+$G(PSOX("FILL DATE")))>DT D
"RTN","PSOCMOP",42,0)
 ..S PSOCPDA=$G(DA) K DIE S DA=RX,DIE="^PSRX(",DR="11////M" D ^DIE K DIE S:$G(PSOCPDA) DA=$G(PSOCPDA) K PSOCPDA
"RTN","PSOCMOP",43,0)
 .;           Q:If not "Mail"
"RTN","PSOCMOP",44,0)
 .S MW=$S($G(RFD)>0:$P(^PSRX(RX,1,RFD,0),"^",2),1:$P(^PSRX(RX,0),"^",11)) K X7 I $G(MW)="W"  K RFD Q
"RTN","PSOCMOP",45,0)
 .;
"RTN","PSOCMOP",46,0)
 .;           Q:If fill was CMOPed and other than a '3' 'not dispensed' 
"RTN","PSOCMOP",47,0)
 .Q:'$$FILTRAN(RX,RFD)
"RTN","PSOCMOP",48,0)
 .;
"RTN","PSOCMOP",49,0)
 .;            Check if released, for use in Sus
"RTN","PSOCMOP",50,0)
 .S REL=$S(RFD=0:$P($G(^PSRX(RX,2)),"^",13),1:$P($G(^PSRX(RX,1,RFD,0)),"^",18)) K RFD
"RTN","PSOCMOP",51,0)
 .I $G(REL) Q
"RTN","PSOCMOP",52,0)
 .;           Save CMOP's in PSXPPL1
"RTN","PSOCMOP",53,0)
 .S $P(RX("CMOP"),",",P2)=RX,P2=P2+1,FLAG=1 Q
"RTN","PSOCMOP",54,0)
 K PPL S PPL=$G(RX("PSO")),RX1("CMOP")=$G(RX("CMOP")) K RX("PSO")
"RTN","PSOCMOP",55,0)
 G:$G(XFROM)="EDIT" D1 ; passed from PSXEDIT
"RTN","PSOCMOP",56,0)
RESET ;
"RTN","PSOCMOP",57,0)
 G:'$G(RX("CMOP")) D1
"RTN","PSOCMOP",58,0)
 I $G(XFROM)="REINSTATE"!($G(XFROM)="UNHOLD") Q
"RTN","PSOCMOP",59,0)
 I $G(PSOFROM)="EDIT",($G(REL)]"") S PPL=RX("CMOP") G D1
"RTN","PSOCMOP",60,0)
S ;           Auto-Suspend CMOPS
"RTN","PSOCMOP",61,0)
 N DA,Y
"RTN","PSOCMOP",62,0)
 F PI=1:1 S DA=$P($G(RX("CMOP")),",",PI) Q:'DA  D SUS
"RTN","PSOCMOP",63,0)
 S SUSPT="SUSPENSE"
"RTN","PSOCMOP",64,0)
 G D1
"RTN","PSOCMOP",65,0)
SUS ;
"RTN","PSOCMOP",66,0)
 I $G(XFROM)="REINSTATE" W !,RX_" REINSTATED -- "
"RTN","PSOCMOP",67,0)
 S ACT=1,RXN=DA,RX0=^PSRX(DA,0),SD=$S($G(ZD(DA)):$E(ZD(DA),1,7),1:$P(^(3),"^")),RXS=$O(^PS(52.5,"B",DA,0)) I RXS D  Q:$G(DFLG)
"RTN","PSOCMOP",68,0)
 .S DA=RXS,DIK="^PS(52.5," D ^DIK S DA=RXN
"RTN","PSOCMOP",69,0)
 K X7 S RFD1=0 F X7=0:0 S X7=$O(^PSRX(DA,1,X7)) Q:'$G(X7)  S (RFD1)=X7
"RTN","PSOCMOP",70,0)
LOCK S RXP=+$G(RXPR(DA)),DIC="^PS(52.5,",DIC(0)="",X=RXN
"RTN","PSOCMOP",71,0)
 S DIC("DR")=".02////"_SD_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04////M;.05////"_RXP_";.06////"_PSOSITE_";2////0;3////Q;9////"_RFD1
"RTN","PSOCMOP",72,0)
 K DD,DO D FILE^DICN K DD,DO S DA=RXN I +Y S PSONAME=$P(^PSRX(DA,0),"^",2) K ^PS(52.5,"AC",PSONAME,SD,+Y),PSONAME
"RTN","PSOCMOP",73,0)
 S $P(^PSRX(RXN,"STA"),"^")=5,LFD=$E(SD,4,5)_"-"_$E(SD,6,7)_"-"_$E(SD,2,3) D ACT
"RTN","PSOCMOP",74,0)
 W !!,"RX# ",$P(^PSRX(RXN,0),"^")_" HAS BEEN SUSPENDED for CMOP Until "_LFD_"."
"RTN","PSOCMOP",75,0)
 S VALMSG="Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended for CMOP Until "_LFD_"."
"RTN","PSOCMOP",76,0)
 S COMM="Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended for CMOP Until "_LFD_"."
"RTN","PSOCMOP",77,0)
 D EN^PSOHLSN1(RXN,"SC","ZS",COMM) K COMM
"RTN","PSOCMOP",78,0)
 ;- Calling ECME to reverse any PAYABLE claim for the prescription/fill
"RTN","PSOCMOP",79,0)
 D REVERSE^PSOBPSU1(RXN,,"DC",3)
"RTN","PSOCMOP",80,0)
 Q
"RTN","PSOCMOP",81,0)
ACT I '$D(RXF) S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOCMOP",82,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOCMOP",83,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOCMOP",84,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_DUZ_"^"_RXF_"^"_"RX Placed on Suspense for CMOP until "_LFD
"RTN","PSOCMOP",85,0)
 K RXF,I,FDA,DIC,DIE,DR,Y,X,%,%H,%I
"RTN","PSOCMOP",86,0)
 Q
"RTN","PSOCMOP",87,0)
D1 K CNT,COUNT,DFLG,DIRUT,DIROUT,DTOUT,DUOUT,EXDT,FLAG,FLD,L,PDUZ,PI,X7
"RTN","PSOCMOP",88,0)
 K PSOCMOP,REF,REPRINT,RFDATE,RFL1,RFLL,RXPD,SD,SUSPT,WARN,XFROM,ZY,RX1
"RTN","PSOCMOP",89,0)
 Q
"RTN","PSOCMOP",90,0)
RXL N FROM S FROM=$G(PSOFROM)
"RTN","PSOCMOP",91,0)
 I ((FROM="NEW")!(FROM="REFILL")!(FROM="CANCEL")!(FROM="BATCH")!($G(XFROM)="HOLD")!($G(XFROM)="BATCH")) G TOP
"RTN","PSOCMOP",92,0)
 Q
"RTN","PSOCMOP",93,0)
SUS1 ;
"RTN","PSOCMOP",94,0)
 N PPL
"RTN","PSOCMOP",95,0)
 S PPL=DA D TEST
"RTN","PSOCMOP",96,0)
 I $G(PPL)']"" S XFLAG=1
"RTN","PSOCMOP",97,0)
 S RX("CMOP")=$G(RX1("CMOP"))
"RTN","PSOCMOP",98,0)
 Q
"RTN","PSOCMOP",99,0)
A S:'$G(PPL) PPL=$G(PSORX("PSOL",PPL1)) G:$G(PPL)']"" D1
"RTN","PSOCMOP",100,0)
 G TEST
"RTN","PSOCMOP",101,0)
UNMARK ;Entry point to unmark drug for CMOP dispense
"RTN","PSOCMOP",102,0)
 N X,Z,%
"RTN","PSOCMOP",103,0)
 S $P(^PSDRUG(CK,3),"^",1)=0 K ^PSDRUG("AQ",CK)
"RTN","PSOCMOP",104,0)
 S:'$D(^PSDRUG(CK,4,0)) ^PSDRUG(CK,4,0)="^50.0214DA^^"
"RTN","PSOCMOP",105,0)
 S (X,Z)=0 F  S Z=$O(^PSDRUG(CK,4,Z)) Q:'Z  S X=Z
"RTN","PSOCMOP",106,0)
 S X=X+1 D NOW^%DTC S ^PSDRUG(CK,4,X,0)=%_"^E^"_DUZ_"^CMOP Dispense^"_$S($G(^PSDRUG(CK,3))=1:"YES",$G(^PSDRUG(CK,3))=0:"NO",1:"")
"RTN","PSOCMOP",107,0)
 S $P(^PSDRUG(CK,4,0),"^",3)=X,$P(^(0),"^",4)=$P(^(0),"^",4)+1
"RTN","PSOCMOP",108,0)
 I $$PATCH^XPDUTL("PSS*1.0*70") D DRG^PSSHUIDG(CK)
"RTN","PSOCMOP",109,0)
 K X,Z,%
"RTN","PSOCMOP",110,0)
 Q
"RTN","PSOCMOP",111,0)
FILTRAN(RX,RFD) ; Test fill's CMOP tran status, return 1 if OK to send
"RTN","PSOCMOP",112,0)
 N DA,CMOP
"RTN","PSOCMOP",113,0)
 S DA=RX
"RTN","PSOCMOP",114,0)
 D ^PSOCMOPA
"RTN","PSOCMOP",115,0)
 I '$D(CMOP(RFD)) Q 1
"RTN","PSOCMOP",116,0)
 I CMOP(RFD)=3 Q 1
"RTN","PSOCMOP",117,0)
 Q 0
"RTN","PSOCMOP",118,0)
COMM(RXN,COMM) ;EP process problem message to g.cmop managers
"RTN","PSOCMOP",119,0)
 N XMSUB,XMTEXT
"RTN","PSOCMOP",120,0)
 S XMTEXT="COMM(",XMY("I:G.CMOP MANAGERS")=""
"RTN","PSOCMOP",121,0)
 S XMSUB="CMOP RX PROBLEM ENCOUNTERED"
"RTN","PSOCMOP",122,0)
 D ^XMD
"RTN","PSOCMOP",123,0)
 Q
"RTN","PSOCMOP",124,0)
CMPRXTYP(SUSDA) ; given suspense record SUSDA returns RX CMOP TYPE C - CS, N -Non-CS
"RTN","PSOCMOP",125,0)
 ;used in compound index ^PS(52.5,"CMP",STAT,TYP,DIV,DATE,DFN,DA)
"RTN","PSOCMOP",126,0)
 N RXDA,DRGDA,DEA,TYP
"RTN","PSOCMOP",127,0)
 S RXDA=$P(^PS(52.5,SUSDA,0),U),DRGDA=$P(^PSRX(RXDA,0),U,6)
"RTN","PSOCMOP",128,0)
 S TYP="N",DEA=$P(^PSDRUG(DRGDA,0),U,3) F I=3,4,5 I DEA[I S TYP="C"
"RTN","PSOCMOP",129,0)
 Q TYP
"RTN","PSOCMOP",130,0)
NOW() D NOW^%DTC Q %
"RTN","PSOCMOP",131,0)
 ;
"RTN","PSOCMOP",132,0)
PIECE(REC,DLM,VP) ; VP="Variable^Piece"
"RTN","PSOCMOP",133,0)
 ; Set Variable V = piece P of REC using delimiter DLM
"RTN","PSOCMOP",134,0)
 N V,P S V=$P(VP,U),P=$P(VP,U,2),@V=$P(REC,DLM,P)
"RTN","PSOCMOP",135,0)
 Q
"RTN","PSOCMOP",136,0)
PUT(REC,DLM,VP) ; VP="Variable^Piece"
"RTN","PSOCMOP",137,0)
 ; pass by reference D PUT^PSOCMOP(.REC,DLM,VP)
"RTN","PSOCMOP",138,0)
 ; Set Variable V into piece P of REC using delimiter DLM
"RTN","PSOCMOP",139,0)
 N V,P S V=$P(VP,U),P=$P(VP,U,2)
"RTN","PSOCMOP",140,0)
 S $P(REC,DLM,P)=$G(@V)
"RTN","PSOCMOP",141,0)
 Q
"RTN","PSOCMOP",142,0)
KCMPX(SUS,VAL) ; Kill ^PS(52.5,"CMP",VAL index given SUS
"RTN","PSOCMOP",143,0)
 N SDT,TYP,DFN,DIV,RX,F,XX
"RTN","PSOCMOP",144,0)
 S F=$G(^PS(52.5,SUS,0)) Q:'+F  S TYP=$$CMPRXTYP(SUS)
"RTN","PSOCMOP",145,0)
 F XX="RX^1","SDT^2","DFN^3","DIV^6" D PIECE(F,U,XX)
"RTN","PSOCMOP",146,0)
 K ^PS(52.5,"CMP",VAL,TYP,DIV,SDT,DFN,SUS)
"RTN","PSOCMOP",147,0)
 Q
"RTN","PSOCMOP",148,0)
SCMPX(SUS,VAL) ; Set  ^PS(52.5,"CMP",VAL index given SUS
"RTN","PSOCMOP",149,0)
 N SDT,TYP,DFN,DIV,RX,F,XX
"RTN","PSOCMOP",150,0)
 S F=$G(^PS(52.5,SUS,0)) Q:'+F  S TYP=$$CMPRXTYP(SUS)
"RTN","PSOCMOP",151,0)
 F XX="RX^1","SDT^2","DFN^3","DIV^6" D PIECE(F,U,XX)
"RTN","PSOCMOP",152,0)
 S ^PS(52.5,"CMP",VAL,TYP,DIV,SDT,DFN,SUS)=""
"RTN","PSOCMOP",153,0)
 Q
"RTN","PSOCMOPB")
0^79^B12231465
"RTN","PSOCMOPB",1,0)
PSOCMOPB ;BIR/HTW-CMOP Release/Edit Utility ; 6/17/97 [ 12/15/97  2:11 PM ]
"RTN","PSOCMOPB",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,148**;DEC 1997
"RTN","PSOCMOPB",3,0)
OREL(RXP) ;      Called from PSODISP to check for CMOP during manual Release
"RTN","PSOCMOPB",4,0)
 ; IF ePharmacy Rx and it was returned to Stock, allow release
"RTN","PSOCMOPB",5,0)
 I $$STATUS^PSOBPSUT(RXP,0)'="",$$RXRLDT^PSOBPSUT(RXP,0)="",$$GET1^DIQ(52,RXP,32.1,"I") G D1
"RTN","PSOCMOPB",6,0)
 D LAST
"RTN","PSOCMOPB",7,0)
 ;      This for original fill. No release unless cancelled.
"RTN","PSOCMOPB",8,0)
 I $G(CMOP(0))=0!($G(CMOP(0))=1)!($G(CMOP(0))=2) S ISUF=1
"RTN","PSOCMOPB",9,0)
 G D1
"RTN","PSOCMOPB",10,0)
RREL(RXP,RFL) ;      This for Release Refills PSODISP
"RTN","PSOCMOPB",11,0)
 ; IF ePharmacy Rx and it was returned to Stock, allow release
"RTN","PSOCMOPB",12,0)
 I $$STATUS^PSOBPSUT(RXP,RFL)'="",$$RXRLDT^PSOBPSUT(RXP,RFL)="",$$GET1^DIQ(52.1,RFL_","_RXP,14,"I") G D1
"RTN","PSOCMOPB",13,0)
 D LAST
"RTN","PSOCMOPB",14,0)
 ; 
"RTN","PSOCMOPB",15,0)
RREL1 ; No release of fills unless cancelled
"RTN","PSOCMOPB",16,0)
 I $G(CMOP(YY))=0!($G(CMOP(YY))=1)!($G(CMOP(YY))=2) S ISUF=1
"RTN","PSOCMOPB",17,0)
 G D1
"RTN","PSOCMOPB",18,0)
CS(RXP) N YY,ISUF
"RTN","PSOCMOPB",19,0)
 I +$G(XTYPE) S YY=$P($G(XTYPE),"^",2) D RREL(RXP,YY) I $G(ISUF) S XFLAG=1 K ISUF Q
"RTN","PSOCMOPB",20,0)
 I $P($G(XTYPE),"^")="" D OREL(RXP) I $G(ISUF) S XFLAG=1 K ISUF Q
"RTN","PSOCMOPB",21,0)
 Q
"RTN","PSOCMOPB",22,0)
LAST ; Find last event, Find last fill
"RTN","PSOCMOPB",23,0)
 F B=0:0 S B=$O(^PSRX(RXP,4,B)) Q:(+B<1)  S CMOP($P(^PSRX(RXP,4,B,0),"^",3))=$P(^PSRX(RXP,4,B,0),"^",4)
"RTN","PSOCMOPB",24,0)
 Q
"RTN","PSOCMOPB",25,0)
D1 ;
"RTN","PSOCMOPB",26,0)
 K CMOP,PSXACT,PSXRXN,PSXDA,PSXRX0,PSXRXS,PSXRXP,PSXLFD,PSXRXF,PSXFDA,PSXIR
"RTN","PSOCMOPB",27,0)
 K PSXACT,CNT,PPLSAVE,PSXPPL1,PSXCK,P1,P2,PSXPPL,PSXIEN,PSXDRUG,PSXLF
"RTN","PSOCMOPB",28,0)
 K PSXRX,PSXSD,FLAG,NEWDT,PSXFDT,I,SUSPT,PSX1,PSX2,PSXER,PSXJOB,B,C
"RTN","PSOCMOPB",29,0)
 Q
"RTN","PSOCMOPB",30,0)
SUS ; From SUP^PSORXED1 If suspense date edited to future date resuspend
"RTN","PSOCMOPB",31,0)
 S RXN=DA,RX0=^PSRX(DA,0),DA=RXS,DIK="^PS(52.5," D ^DIK S DA=RXN
"RTN","PSOCMOPB",32,0)
 S DIC="^PS(52.5,",DIC(0)="L",X=RXN
"RTN","PSOCMOPB",33,0)
 S DIC("DR")=".02///"_SD_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///0;.06////"_PSOSITE_";2///0;3////Q;9////"_$G(RFD)
"RTN","PSOCMOPB",34,0)
 K DD,DO D FILE^DICN K DD,DO
"RTN","PSOCMOPB",35,0)
 K ^PS(52.5,"AC",$P(^PSRX(RXN,0),"^",2),SD,+Y)
"RTN","PSOCMOPB",36,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOCMOPB",37,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOCMOPB",38,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^E^"_DUZ_"^"_RFD_"^Suspended for CMOP until "_$E(SD,4,5)_"-"_$E(SD,6,7)_"-"_$E(SD,2,3)
"RTN","PSOCMOPB",39,0)
 W !,"RX# "_$P(RX0,"^")_" HAS BEEN SUSPENDED FOR CMOP UNTIL "_$E(SD,4,5)_"-"_$E(SD,6,7)_"-"_$E(SD,2,3)_".",!
"RTN","PSOCMOPB",40,0)
 K PSOCMOP
"RTN","PSOCMOPB",41,0)
 Q
"RTN","PSOCMOPB",42,0)
EQTY ;W !,"Y=",Y
"RTN","PSOCMOPB",43,0)
 S DIR(0)="52,7" S DRG=+$P(^PSRX(ZRX,0),"^",6) S DIR("A")="QTY "_$S($D(^PSDRUG("AQ",DRG)):$G(^PSDRUG(DRG,5)),1:"")
"RTN","PSOCMOPB",44,0)
 S:$P(^PSRX(ZRX,0),"^",7) DIR("B")=$P(^(0),"^",7)
"RTN","PSOCMOPB",45,0)
 D ^DIR K DIR
"RTN","PSOCMOPB",46,0)
 I Y["^",($L(Y)>1) W $C(7),"   Sorry no ^ jumping allowed" K Y G EQTY
"RTN","PSOCMOPB",47,0)
 I Y["^"!($D(DTOUT)) S PSXEXIT=1
"RTN","PSOCMOPB",48,0)
 K Y,DIR
"RTN","PSOCMOPB",49,0)
 Q
"RTN","PSOCMOPB",50,0)
EQTY2 ;
"RTN","PSOCMOPB",51,0)
 S DIR(0)="52.1,1" S DRG=+$P(^PSRX(ZRX,0),"^",6)
"RTN","PSOCMOPB",52,0)
 S DIR("A")="QTY "_$S($D(^PSDRUG("AQ",DRG)):$G(^PSDRUG(DRG,5)),1:"")
"RTN","PSOCMOPB",53,0)
 S DIR("B")=$P(^PSRX(ZRX,1,PSXRFL,0),"^",4)
"RTN","PSOCMOPB",54,0)
 D ^DIR
"RTN","PSOCMOPB",55,0)
 I Y["^",($L(Y)>1) W $C(7),"   Sorry no ^ jumping allowed" K Y G EQTY2
"RTN","PSOCMOPB",56,0)
 I Y["^"!($D(DTOUT)) S PSXEXIT=1
"RTN","PSOCMOPB",57,0)
 D QTY
"RTN","PSOCMOPB",58,0)
 I $G(X)']"" G EQTY2
"RTN","PSOCMOPB",59,0)
 K Y S:X>0 $P(^PSRX(ZRX,1,PSXRFL,0),"^",4)=X
"RTN","PSOCMOPB",60,0)
 Q
"RTN","PSOCMOPB",61,0)
QTY ;Check quantity
"RTN","PSOCMOPB",62,0)
 I X>99999999!($L(X)>11)!(X'?.N.1".".2N) K X G HELP
"RTN","PSOCMOPB",63,0)
 Q
"RTN","PSOCMOPB",64,0)
HELP ; QTY HELP
"RTN","PSOCMOPB",65,0)
 W !!,"This is a CMOP drug.  The quantity may not contain alpha characters (i.e.; ML)    or more than two decimal places (i.e.; .01)."
"RTN","PSOCMOPB",66,0)
 W !,"Enter a whole number between 0 and 99999999 inclusive. The total entry cannot     exceed 11 characters." K Z0
"RTN","PSOCMOPB",67,0)
 Q
"RTN","PSOCSRL")
0^35^B35996406
"RTN","PSOCSRL",1,0)
PSOCSRL ;BIR/BHW-release interface for control substance pkg ;7/22/94
"RTN","PSOCSRL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**27,71,118,148**;DEC 1997
"RTN","PSOCSRL",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOCSRL",4,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOCSRL",5,0)
 ;External reference to ^PS(59.7 supported by DBIA 694
"RTN","PSOCSRL",6,0)
 ;External reference to SERV^IBARX1 supported by DBIA 2245
"RTN","PSOCSRL",7,0)
EN(RXP,XTYPE,PSRH) ;
"RTN","PSOCSRL",8,0)
 N NCPDP
"RTN","PSOCSRL",9,0)
 I '$D(PSOPAR) D  G:'$D(PSOPAR) EX
"RTN","PSOCSRL",10,0)
 .D ^PSOLSET I '$D(PSOPAR) W $C(7),!!,?5,"Site Parameters must be defined to use the Release option!",! Q
"RTN","PSOCSRL",11,0)
 .S PSOCSUB=1
"RTN","PSOCSRL",12,0)
 K XFLAG D CS^PSOCMOPB(RXP) I $G(XFLAG) K XFLAG Q
"RTN","PSOCSRL",13,0)
 S Y=$G(^PS(59,PSOSITE,"IB")),PSOIBSS=$$SERV^IBARX1(+Y) I 'PSOIBSS D IBSSR^PSOUTL I 'PSOIBFL D  G EX
"RTN","PSOCSRL",14,0)
 .W $C(7),!!,"The IB SERVICE/SECTION defined in your site parameter file is not valid.",!,"You will not be able to release any medication until this is corrected!",!
"RTN","PSOCSRL",15,0)
 W !! S PSIN=+$P($G(^PS(59.7,1,49.99)),"^",2)
"RTN","PSOCSRL",16,0)
 Q:'$D(^XUSEC("PSORPH",PSRH))
"RTN","PSOCSRL",17,0)
 I '$D(^PSRX(+$G(RXP),0))!($G(RXP)']"") W !?7,$C(7),$C(7),$C(7),"   NON-EXISTENT PRESCRIPTION" G EX
"RTN","PSOCSRL",18,0)
 D:$P($G(^PS(55,+$P(^PSRX(+RXP,0),"^",2),0)),"^",6)'=2 EN^PSOHLUP($P(^PSRX(+RXP,0),"^",2))
"RTN","PSOCSRL",19,0)
 I +$P($G(^PSRX(+RXP,"STA")),"^")=13!+$P($G(^PSRX(+RXP,0)),"^",2)=0 W !?7,$C(7),$C(7),"    PRESCRIPTION IS A DELETED PERSCRIPTION NUMBER" G EX
"RTN","PSOCSRL",20,0)
 I +$P($G(^PSRX(+RXP,"STA")),"^"),$S($P(^("STA"),"^")=2:0,$P(^("STA"),"^")=5:0,$P(^("STA"),"^")=11:0,$P(^("STA"),"^")=12:0,1:1) G EX
"RTN","PSOCSRL",21,0)
 G:$G(XTYPE)]"" REF
"RTN","PSOCSRL",22,0)
ORI ;orig
"RTN","PSOCSRL",23,0)
 K LBLP,ISUF I $P(^PSRX(RXP,2),"^",13) S Y=$P(^PSRX(RXP,2),"^",13) X ^DD("DD") W !!?7,$C(7),$C(7),"ORIGINAL PRESCRIPTION WAS LAST RELEASED ON "_Y,! G EX
"RTN","PSOCSRL",24,0)
 I $P(^PSRX(RXP,2),"^",15) S RESK=$P(^(2),"^",15)  W !,"Original Fill returned to stock on "_$E(RESK,4,5)_"/"_$E(RESK,6,7)_"/"_$E(RESK,2,3),! G EX
"RTN","PSOCSRL",25,0)
 S PSOCPN=$P(^PSRX(RXP,0),"^",2),QTY=$P($G(^PSRX(RXP,0)),"^",7),QDRUG=$P(^PSRX(RXP,0),"^",6)
"RTN","PSOCSRL",26,0)
 I '$P($G(^PSRX(RXP,2)),"^",13),+$P($G(^(2)),"^",2)'<PSIN S RXFD=$P(^(2),"^",2) D  G:$G(PSOUT) EX D:$G(LBLP) UPDATE I $G(ISUF) D UPDATE
"RTN","PSOCSRL",27,0)
 .S SUPN=$O(^PS(52.5,"B",RXP,0)) I SUPN,$D(^PS(52.5,"C",RXFD,SUPN)),$G(^PS(52.5,SUPN,"P"))'=1 S ISUF=1 Q
"RTN","PSOCSRL",28,0)
 .F LBL=0:0 S LBL=$O(^PSRX(RXP,"L",LBL)) Q:'LBL  I '+$P(^PSRX(RXP,"L",LBL,0),"^",2),'$P(^(0),"^",5) S LBLP=1
"RTN","PSOCSRL",29,0)
 .Q:'$G(LBLP)  D ASK Q:$G(PSOUT)
"RTN","PSOCSRL",30,0)
 .;
"RTN","PSOCSRL",31,0)
 .; - Checking for OPEN/UNRESOLVED 3rd. Party Payer Rejects / NDC Editing
"RTN","PSOCSRL",32,0)
 .I $$MANREL^PSOBPSUT(RXP,0)="^" Q
"RTN","PSOCSRL",33,0)
 .;
"RTN","PSOCSRL",34,0)
 .S:$D(^PSDRUG(QDRUG,660.1)) ^PSDRUG(QDRUG,660.1)=^PSDRUG(QDRUG,660.1)-QTY
"RTN","PSOCSRL",35,0)
 .Q:$P($G(^PSRX(RXP,2)),"^",13)
"RTN","PSOCSRL",36,0)
 .D NOW^%DTC S DIE="^PSRX(",DA=RXP,DR="31///"_%_";23///"_PSRH
"RTN","PSOCSRL",37,0)
 .D ^DIE K DIE,DR,DA,LBL
"RTN","PSOCSRL",38,0)
 .D EN^PSOHLSN1(RXP,"ZD")
"RTN","PSOCSRL",39,0)
 .; ECME - 3rd Party Billing
"RTN","PSOCSRL",40,0)
 .;
"RTN","PSOCSRL",41,0)
 .; - Notifying IB through ECME of the Rx being released
"RTN","PSOCSRL",42,0)
 .D IBSEND^PSOBPSUT(RXP,0)
"RTN","PSOCSRL",43,0)
 G EX
"RTN","PSOCSRL",44,0)
REF ;release ref or par
"RTN","PSOCSRL",45,0)
 K LBLP,ISUF,IFN D QTY S:($P($G(XTYPE),"^")="P") $P(^PSRX(RXP,"TYPE"),"^")=0
"RTN","PSOCSRL",46,0)
EX K OUT,RX2,RXFD,RESK,ISUF,SUPN,%,DIC,IFN,J,DA,DR,DIE,X,Y,RXP,REC,DIRUT,PSOCPN,PSOCPRX,PSOIBSS,PSOIBFL,PSOIBLP,PSOIBST,QDRUG,QTY,XTYPE,PSRH,Y,PSIN
"RTN","PSOCSRL",47,0)
 K DIR,DUOUT,DTOUT,LBL,LBLP,PSOUT
"RTN","PSOCSRL",48,0)
 Q
"RTN","PSOCSRL",49,0)
UPDATE I $G(ISUF) W $C(7),!!?7,$S($P(XTYPE,"^")=1:"RE",$P(XTYPE,"^")="P":"PARTIAL ",1:"ORIGINAL")_"FILL ON SUSPENSE !",!,$C(7) Q
"RTN","PSOCSRL",50,0)
 S PSOCPRX=$P(^PSRX(RXP,0),"^") D CP^PSOCP
"RTN","PSOCSRL",51,0)
 W !?7,"PRESCRIPTION NUMBER "_$P(^PSRX(RXP,0),"^")_" RELEASED"
"RTN","PSOCSRL",52,0)
 Q
"RTN","PSOCSRL",53,0)
QTY S PSOCPN=$P(^PSRX(RXP,0),"^",2),QDRUG=$P(^PSRX(RXP,0),"^",6) K LBLP
"RTN","PSOCSRL",54,0)
 D:$P($G(^PSRX(RXP,$P(XTYPE,"^"),$P(XTYPE,"^",2),0)),"^")'<PSIN  K ISUF,LBLP G:$G(PSOUT) EX
"RTN","PSOCSRL",55,0)
 .S RXFD=$E($P(^PSRX(RXP,$P(XTYPE,"^"),$P(XTYPE,"^",2),0),"^"),1,7),SUPN=$O(^PS(52.5,"B",RXP,0)) I SUPN,$D(^PS(52.5,"C",RXFD,SUPN)),$G(^PS(52.5,SUPN,"P"))'=1 S ISUF=1 D UPDATE Q
"RTN","PSOCSRL",56,0)
 .I $P(^PSRX(RXP,$P(XTYPE,"^"),$P(XTYPE,"^",2),0),"^",$S($P($G(XTYPE),"^"):18,1:19))]""!($P(^(0),"^",16)) K IFN Q
"RTN","PSOCSRL",57,0)
 .F LBL=0:0 S LBL=$O(^PSRX(RXP,"L",LBL)) Q:'LBL  I $P(^PSRX(RXP,"L",LBL,0),"^",2)=$S('$P(XTYPE,"^"):(99-$P(XTYPE,"^",2)),1:$P(XTYPE,"^",2)) S LBLP=1
"RTN","PSOCSRL",58,0)
 .Q:'$G(LBLP)  D ASK Q:$G(PSOUT)
"RTN","PSOCSRL",59,0)
 .;
"RTN","PSOCSRL",60,0)
 .; - Checking for OPEN/UNRESOLVED 3rd. Party Payer Rejects / NDC Editing
"RTN","PSOCSRL",61,0)
 .I XTYPE,$$MANREL^PSOBPSUT(RXP,$P(XTYPE,"^",2))="^" Q
"RTN","PSOCSRL",62,0)
 .;
"RTN","PSOCSRL",63,0)
 .S IFN=$P(XTYPE,"^",2) S:$G(^PSDRUG(QDRUG,660.1))]"" QTY=$P(^PSRX(RXP,$P(XTYPE,"^"),$P(XTYPE,"^",2),0),"^",4),^PSDRUG(QDRUG,660.1)=^PSDRUG(QDRUG,660.1)-QTY
"RTN","PSOCSRL",64,0)
 .D NOW^%DTC S DIE="^PSRX("_RXP_","""_$P(XTYPE,"^")_""","
"RTN","PSOCSRL",65,0)
 .S DA(1)=RXP,DA=$P(XTYPE,"^",2)
"RTN","PSOCSRL",66,0)
 .S DR=$S(+XTYPE:17,1:8)_"///"_%_";"_$S(+XTYPE:4,1:.05)_"////"_PSRH
"RTN","PSOCSRL",67,0)
 .D ^DIE K DIE,DR,DA
"RTN","PSOCSRL",68,0)
 .K PSODISPP S:'$P($G(XTYPE),"^") PSODISPP=1 D EN^PSOHLSN1(RXP,"ZD") K PSODISPP
"RTN","PSOCSRL",69,0)
 .;
"RTN","PSOCSRL",70,0)
 .; - Notifying IB through ECME of the Rx being released
"RTN","PSOCSRL",71,0)
 .I XTYPE D IBSEND^PSOBPSUT(RXP,$P(XTYPE,"^",2))
"RTN","PSOCSRL",72,0)
 .;
"RTN","PSOCSRL",73,0)
 .K:+XTYPE ^PSRX("ACP",$P($G(^PSRX(RXP,0)),"^",2),$P($G(^PSRX(RXP,1,$P(XTYPE,"^",2),0)),"^"),$P(XTYPE,"^",2),RXP)
"RTN","PSOCSRL",74,0)
 .I +XTYPE,$G(IFN),'$G(ISUF) S PSOCPRX=$P(^PSRX(RXP,0),"^"),YY=$P(XTYPE,"^",2) D CP^PSOCP
"RTN","PSOCSRL",75,0)
 W:$G(IFN) !!?7,"PRESCRIPTION NUMBER "_$P(^PSRX(RXP,0),"^")_$S('+$G(XTYPE):" Partial Fill",1:" REFILL")_" #"_$P(XTYPE,"^",2)_" RELEASED"
"RTN","PSOCSRL",76,0)
 W:'$G(IFN) !!?7,$S(+$G(XTYPE):"REFILL",1:"PARTIAL")_" #"_$P(XTYPE,"^",2)_" NOT RELEASED"
"RTN","PSOCSRL",77,0)
 K IFN
"RTN","PSOCSRL",78,0)
 Q
"RTN","PSOCSRL",79,0)
ASK ;confirm
"RTN","PSOCSRL",80,0)
 W ! K DIR S DIR(0)="SA^1:YES;0:NO",DIR("B")="Yes",DIR("A",1)="Are You sure you want to release "_$S($G(XTYPE)']"":"Original ",$P(XTYPE,"^")=1:"Re",1:"Partial ")_"fill"_$S($P(XTYPE,"^",2):" #"_$P(XTYPE,"^",2),1:"")
"RTN","PSOCSRL",81,0)
 S DIR("A")="for Prescription #"_$P(^PSRX(RXP,0),"^")_": " D ^DIR K DIR
"RTN","PSOCSRL",82,0)
 S:'Y!($D(DIRUT)) PSOUT=1
"RTN","PSOCSRL",83,0)
 ;bingo board call
"RTN","PSOCSRL",84,0)
 I Y,$G(XTYPE)="",$P(^PSRX(RXP,0),"^",11)["W" S BINGRO="W",BINGNAM=$P(^PSRX(RXP,0),"^",2),BINGDIV=$P(^PSRX(RXP,2),"^",9)
"RTN","PSOCSRL",85,0)
 I Y,$G(XTYPE)["P",$P($G(^PSRX(RXP,"P",$P(XTYPE,"^",2),0)),"^",2)["W" S BINGRPR="W",BNGPDV=$P(^PSRX(RXP,"P",$P(XTYPE,"^",2),0),"^",9),BINGNAM=$P($G(^PSRX(RXP,0)),"^",2)
"RTN","PSOCSRL",86,0)
 I Y,+$G(XTYPE)=1,$P($G(^PSRX(RXP,1,$P(XTYPE,"^",2),0)),"^",2)["W" S BINGRPR="W",BNGRDV=$P(^PSRX(RXP,1,$P(XTYPE,"^",2),0),"^",9),BINGNAM=$P($G(^PSRX(RXP,0)),"^",2)
"RTN","PSOCSRL",87,0)
 I $D(DISGROUP),($D(BINGDIV)!$D(BNGPDV)!$D(BNGRDV)),($D(BINGRO)!$D(BINGRPR)) D REL^PSOBING1 K BINGNAM,BINGDIV,BINGRO,BINGRPR,BNGPDV,BNGRDV
"RTN","PSOCSRL",88,0)
 Q
"RTN","PSODAWUT")
0^62^B1596507
"RTN","PSODAWUT",1,0)
PSODAWUT ;BIRM/MFR - BPS (ECME) - DAW Utilities ;10/15/04
"RTN","PSODAWUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSODAWUT",3,0)
 ;Reference to $$DAWEXT^PSSDAWUT supported by IA 4708
"RTN","PSODAWUT",4,0)
 ;
"RTN","PSODAWUT",5,0)
GETDAW(RX,RFL) ; Returns the DAW code for a specific Prescription/Fill
"RTN","PSODAWUT",6,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSODAWUT",7,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSODAWUT",8,0)
 ;
"RTN","PSODAWUT",9,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSODAWUT",10,0)
 ;
"RTN","PSODAWUT",11,0)
 I 'RFL Q +$$GET1^DIQ(52,RX,81)
"RTN","PSODAWUT",12,0)
 Q +$$GET1^DIQ(52.1,RFL_","_RX,81)
"RTN","PSODAWUT",13,0)
 ;
"RTN","PSODAWUT",14,0)
SAVDAW(RX,RFL,DAW) ; - Saves the DAW code for a specific Prescription/Fill
"RTN","PSODAWUT",15,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSODAWUT",16,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSODAWUT",17,0)
 ;
"RTN","PSODAWUT",18,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSODAWUT",19,0)
 ;
"RTN","PSODAWUT",20,0)
 N DIE,DA,DR
"RTN","PSODAWUT",21,0)
 S DR="81///"_+DAW
"RTN","PSODAWUT",22,0)
 I 'RFL S DA=RX,DIE="^PSRX(" D ^DIE
"RTN","PSODAWUT",23,0)
 I RFL,$D(^PSRX(RX,1,RFL,0)) S DIE="^PSRX("_RX_",1,",DA(1)=RX,DA=RFL D ^DIE
"RTN","PSODAWUT",24,0)
 Q
"RTN","PSODAWUT",25,0)
 ;
"RTN","PSODAWUT",26,0)
EDTDAW(RX,RFL,DAW) ; - Edits the DAW code for a specific Prescription/Fill W/OUT SAVING IT
"RTN","PSODAWUT",27,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSODAWUT",28,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSODAWUT",29,0)
 ;       (o) DAW - Default DAW code (Default: from Rx file)
"RTN","PSODAWUT",30,0)
 ;Output: $$EDTDAW - DAW code selected or "^" (up arrow) 
"RTN","PSODAWUT",31,0)
 ;       
"RTN","PSODAWUT",32,0)
 N DIR,Y,DA
"RTN","PSODAWUT",33,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSODAWUT",34,0)
 ;
"RTN","PSODAWUT",35,0)
 I '$D(DAW) S DAW=$$GETDAW(RX,RFL)
"RTN","PSODAWUT",36,0)
 ;
"RTN","PSODAWUT",37,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q
"RTN","PSODAWUT",38,0)
 ;
"RTN","PSODAWUT",39,0)
 S DIR(0)="52,81",DIR("B")=DAW D ^DIR I $D(DIRUT) S DAW="^" Q
"RTN","PSODAWUT",40,0)
 S DAW=Y W " - ",$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSODAWUT",41,0)
 Q
"RTN","PSODISP")
0^5^B54775378
"RTN","PSODISP",1,0)
PSODISP ;BIR/SAB,PWC-MANUAL BARCODE RELEASE FUNCTION ;03/02/93
"RTN","PSODISP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,71,131,156,185,148**;DEC 1997
"RTN","PSODISP",3,0)
 ;Reference to $$SERV^IBARX1 supported by DBIA 2245
"RTN","PSODISP",4,0)
 ;Reference to ^PSD(58.8 supported by DBIA 1036
"RTN","PSODISP",5,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSODISP",6,0)
 ;Reference to ^PSDRUG supported by DBIA 221
"RTN","PSODISP",7,0)
 ;Reference to ^PSDRUG("AQ" supported by DBIA 3165
"RTN","PSODISP",8,0)
 ;Reference to ^XTMP("PSA" supported by DBIA 1036
"RTN","PSODISP",9,0)
 ;Reference to ^PS(59.7 supported by DBIA 694
"RTN","PSODISP",10,0)
AC K CX,PSODA,PSODT,PSRH,DA,DR,DIE,X,X1,X2,Y,RXP,CX,PX,REC,DIR,YDT,REC,RDUZ,DIRUT,PSOCPN,PSOCPRX,YY,QDRUG,QTY,TYPE,XTYPE,DUOUT,PSOPID
"RTN","PSODISP",11,0)
 K ^UTILITY($J,"PSOHL") S PSOPID=1
"RTN","PSODISP",12,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) W $C(7),!!,?5,"Site Parameters must be defined to use the Release option!",! G EXIT
"RTN","PSODISP",13,0)
 S Y=$G(^PS(59,PSOSITE,"IB")),PSOIBSS=$$SERV^IBARX1(+Y) I 'PSOIBSS D IBSSR^PSOUTL I 'PSOIBFL D   G EXIT
"RTN","PSODISP",14,0)
 .W $C(7),!!,"The IB SERVICE/SECTION defined in your site parameter file is not valid.",!,"You will not be able to release any medication until this is corrected!",!
"RTN","PSODISP",15,0)
AC1 W !! S PSIN=+$P($G(^PS(59.7,1,49.99)),"^",2)
"RTN","PSODISP",16,0)
 S DIC("S")="I $D(^XUSEC(""PSORPH"",+Y))",DIC("A")="Enter PHARMACIST: ",DIC="^VA(200,",DIC(0)="QEAM" D ^DIC G:"^"[X EXIT K DIC G:$D(DTOUT)!($D(DUOUT))!($D(DIRUT))!(Y=-1) EXIT S PSRH=+Y
"RTN","PSODISP",17,0)
 ;check for Drug Acct background job K8 & K7.1
"RTN","PSODISP",18,0)
 S X="PSA IV ALL LOCATIONS",DIC(0)="MZ",DIC=19.2 D ^DIC I Y=-1 K DIC,X,Y G BC
"RTN","PSODISP",19,0)
 I $P($G(Y(0)),U,2)>DT S PSODA=1 S:'$P($G(^XTMP("PSA",0)),U,2) $P(^(0),U,2)=DT G BC
"RTN","PSODISP",20,0)
 S X="PSA IV ALL LOCATIONS",DIC(0)="MZ",DIC=19 D ^DIC K DIC,X G:Y=-1 BC
"RTN","PSODISP",21,0)
 K DIQ,PSA S DA=+Y,DIC=19,DIQ="PSA",DR=200,DIQ(0)="IN" D EN^DIQ1
"RTN","PSODISP",22,0)
 I '$D(PSA(19,DA,200,"I")) K DIC,DA,X,Y,DIQ G BC
"RTN","PSODISP",23,0)
 I PSA(19,DA,200,"I")>DT S PSODA=1 S:'$P($G(^XTMP("PSA",0)),U,2) $P(^(0),U,2)=DT
"RTN","PSODISP",24,0)
 K PSA,DIC,DA,X,Y,DIQ
"RTN","PSODISP",25,0)
BC ;
"RTN","PSODISP",26,0)
 K MAN I $G(RXP),$D(DISGROUP),$D(BINGNAM),($D(BINGDIV)!$D(BNGPDV)!$D(BNGRDV)),($D(BINGRO)!$D(BINGRPR)) D REL^PSOBING1 K BINGNAM,BINGDIV,BINGRO,BINGRPR,BNGPDV,BNGRDV
"RTN","PSODISP",27,0)
 Q:$G(POERR)  W !! K CMOP,ISUF,DIR,LBL,LBLP S DIR("A")="Enter/Wand PRESCRIPTION number",DIR("?")="^D HELP^PSODISP",DIR(0)="FO" D ^DIR
"RTN","PSODISP",28,0)
 I $D(DIRUT)!($D(DTOUT))!($D(DUOUT)) K DIRUT,DTOUT,DUOUT G AC1
"RTN","PSODISP",29,0)
 I X'["-" D BCI W:'$G(RXP) !,"INVALID PRESCRIPTION NUMBER" G:'$G(RXP) BC S MAN=1 G BC1
"RTN","PSODISP",30,0)
 I X["-",$P(X,"-")'=$P($$SITE^VASITE(),"^",3) W !?7,$C(7),$C(7),"   INVALID STATION NUMBER !!",$C(7),$C(7),! G BC
"RTN","PSODISP",31,0)
 I X["-" S RXP=$P(X,"-",2) I '$D(^PSRX(+$G(RXP),0))!($G(RXP)']"") W !?7,$C(7),$C(7),$C(7),"   NON-EXISTENT PRESCRIPTION" G BC
"RTN","PSODISP",32,0)
 I $D(^PSRX(RXP,0)) D  G BC1
"RTN","PSODISP",33,0)
 .S PSOLOUD=1 D:$P($G(^PS(55,+$P(^PSRX(+RXP,0),"^",2),0)),"^",6)'=2 EN^PSOHLUP($P(^PSRX(+RXP,0),"^",2)) K PSOLOUD
"RTN","PSODISP",34,0)
 W !?7,$C(7),$C(7),$C(7),"   IMPROPER BARCODE FORMAT" G BC
"RTN","PSODISP",35,0)
BC1 ;
"RTN","PSODISP",36,0)
 D ICN^PSODPT(+$P(^PSRX(RXP,0),"^",2))
"RTN","PSODISP",37,0)
 I +$P($G(^PSRX(+RXP,"PKI")),"^") D  Q:$G(POERR)  G BC
"RTN","PSODISP",38,0)
 .I $G(SPEED) W !!?7,$C(7),$C(7),"Rx# "_$P(^PSRX(RXP,0),"^") S PSOLIST=4
"RTN","PSODISP",39,0)
 .W !!,?7,"UNABLE TO RELEASE - THIS ORDER MUST BE RELEASED THROUGH THE OUTPATIENT",!,?7,"RX'S [PSD OUTPATIENT] OPTION IN THE CONTROLLED SUBSTANCE MENU"
"RTN","PSODISP",40,0)
 I +$P($G(^PSRX(+RXP,"STA")),"^")=13!(+$P($G(^PSRX(+RXP,0)),"^",2)=0) W !?7,$C(7),$C(7),"    PRESCRIPTION IS A DELETED PRESCRIPTION NUMBER" Q:$G(POERR)  D DCHK G BC
"RTN","PSODISP",41,0)
 I +$P($G(^PSRX(+RXP,"STA")),"^"),$S($P(^("STA"),"^")=2:0,$P(^("STA"),"^")=5:0,$P(^("STA"),"^")=11:0,$P(^("STA"),"^")=12:0,$P(^("STA"),"^")=14:0,$P(^("STA"),"^")=15:0,1:1) D STAT^PSODISPS Q:$G(POERR)  D DCHK G BC
"RTN","PSODISP",42,0)
 ;drug stocked in Drug Acct Location?
"RTN","PSODISP",43,0)
 S PSODA(1)=$S($D(^PSD(58.8,+$O(^PSD(58.8,"AOP",+PSOSITE,0)),1,+$P(^PSRX(RXP,0),U,6))):1,1:0)
"RTN","PSODISP",44,0)
 I $P(^PSRX(RXP,2),"^",13) S Y=$P(^PSRX(RXP,2),"^",13) X ^DD("DD") S OUT=1 D  K OUT Q:$G(POERR)  D DCHK G BC
"RTN","PSODISP",45,0)
 .W !!?7,$C(7),$C(7),$S($G(SPEED):"Rx# "_$P(^PSRX(RXP,0),"^"),1:"Original prescription")_" was last released on "_Y,!?7,"Checking for unreleased refills/partials " D REF
"RTN","PSODISP",46,0)
BATCH ;
"RTN","PSODISP",47,0)
 I $P(^PSRX(RXP,2),"^",15),'$P(^(2),"^",14) S RESK=$P(^(2),"^",15)  W !!?5,"Rx# "_$P(^PSRX(RXP,0),"^")_" Original Fill returned to stock on "_$E(RESK,4,5)_"/"_$E(RESK,6,7)_"/"_$E(RESK,2,3),! G REF
"RTN","PSODISP",48,0)
 N PSODISP S PSODISP=$$GET1^DIQ(59,PSOSITE_",",105,"I")   ;flag to determine if site is running HL7 v.2.4 Dispense Machines
"RTN","PSODISP",49,0)
 S PSOCPN=$P(^PSRX(RXP,0),"^",2),QTY=$P($G(^PSRX(RXP,0)),"^",7),QDRUG=$P(^PSRX(RXP,0),"^",6)
"RTN","PSODISP",50,0)
 ;original
"RTN","PSODISP",51,0)
 I '$P($G(^PSRX(RXP,2)),"^",13),+$P($G(^(2)),"^",2)'<PSIN S RXFD=$P(^(2),"^",2) D  D:$G(LBLP) UPDATE I $G(ISUF) D UPDATE G REF
"RTN","PSODISP",52,0)
 .S SUPN=$O(^PS(52.5,"B",RXP,0)) I SUPN,$D(^PS(52.5,"C",RXFD,SUPN)),$G(^PS(52.5,SUPN,"P"))'=1,'$P($G(^(0)),"^",5) S ISUF=1 Q
"RTN","PSODISP",53,0)
 .I $D(^PSDRUG("AQ",QDRUG)) K CMOP D OREL^PSOCMOPB(RXP) K CMOP I $G(ISUF) K ISUF,CMOP Q
"RTN","PSODISP",54,0)
 .;
"RTN","PSODISP",55,0)
 .F LBL=0:0 S LBL=$O(^PSRX(RXP,"L",LBL)) Q:'LBL  I '+$P(^PSRX(RXP,"L",LBL,0),"^",2),'$P(^(0),"^",5),$P(^(0),"^",3)'["INTERACTION" S LBLP=1
"RTN","PSODISP",56,0)
 .Q:'$G(LBLP)
"RTN","PSODISP",57,0)
 .;
"RTN","PSODISP",58,0)
 .; - Checking for OPEN/UNRESOLVED 3rd. Party Payer Rejects / NDC Editing
"RTN","PSODISP",59,0)
 .I $$MANREL^PSOBPSUT(RXP,0,$G(PSOPID))="^" Q
"RTN","PSODISP",60,0)
 .;
"RTN","PSODISP",61,0)
 .S:$D(^PSDRUG(QDRUG,660.1)) ^PSDRUG(QDRUG,660.1)=^PSDRUG(QDRUG,660.1)-QTY
"RTN","PSODISP",62,0)
 .D NOW^%DTC S DIE="^PSRX(",DA=RXP,DR="31///"_%_";23////"_PSRH_";32.1///@;32.2///@",PSODT=% D ^DIE K DIE,DR,DA,LBL
"RTN","PSODISP",63,0)
 .;
"RTN","PSODISP",64,0)
 .; - Notifying IB through ECME of the Rx has been released
"RTN","PSODISP",65,0)
 .D IBSEND^PSOBPSUT(RXP,0)
"RTN","PSODISP",66,0)
 .;
"RTN","PSODISP",67,0)
 .D EN^PSOHLSN1(RXP,"ZD")
"RTN","PSODISP",68,0)
 .;if appropriate update ^XTMP("PSA", for Drug Acct
"RTN","PSODISP",69,0)
 .I $G(PSODA),$G(PSODA(1)),'$D(^PSRX("AR",+PSODT,+RXP,0)) S ^XTMP("PSA",+PSOSITE,+QDRUG,+DT)=$G(^XTMP("PSA",+PSOSITE,+QDRUG,+DT))+QTY
"RTN","PSODISP",70,0)
REF ;release refills and partials
"RTN","PSODISP",71,0)
 K LBLP,IFN F XTYPE=1,"P" K IFN D QTY^PSODISPS
"RTN","PSODISP",72,0)
 Q:+$G(OUT)!($G(POERR))  D DCHK
"RTN","PSODISP",73,0)
 G BC
"RTN","PSODISP",74,0)
UPDATE I $G(ISUF) W $C(7),!!?7,"Prescription "_$P(^PSRX(RXP,0),"^")_" - Original Fill on Suspense !",!,$C(7) Q
"RTN","PSODISP",75,0)
 N BFILL S BFILL=0
"RTN","PSODISP",76,0)
 S PSOCPRX=$P(^PSRX(RXP,0),"^") D CP^PSOCP
"RTN","PSODISP",77,0)
 W !?7,"Prescription Number "_$P(^PSRX(RXP,0),"^")_" Released"
"RTN","PSODISP",78,0)
 ;initialize bingo board variables
"RTN","PSODISP",79,0)
 I $G(LBLP),$P(^PSRX(RXP,0),"^",11)["W" S BINGRO="W",BINGNAM=$P(^PSRX(RXP,0),"^",2),BINGDIV=$P(^PSRX(RXP,2),"^",9)
"RTN","PSODISP",80,0)
 I $G(PSODISP)=2.4 D    ;HL7 v2.4 dispensing machines
"RTN","PSODISP",81,0)
 . F I=0:0 S SUB=$O(^PSRX(RXP,"A",I)) Q:'I  I $P(^PSRX(RXP,"A",I,0),"^",2)="N" D XMIT    ;only send release dt/time transmission for dispensed orders
"RTN","PSODISP",82,0)
 Q
"RTN","PSODISP",83,0)
EXIT ;
"RTN","PSODISP",84,0)
 K OUT,RX2,RXFD,RESK,ISUF,SUPN,%,DIC,IFN,J,DA,DR,DIE,X,X1,X2,Y,RXP,CX,PX,REC,DIR,YDT,REC,RDUZ,DIRUT,PSOCPN,PSOCPRX,PSOIBSS,PSOIBFL,PSOIBLP,PSOIBST,YY,QDRUG,QTY,TYPE,XTYPE,DUOUT,PSRH,XX,Y,PSIN,MAN,PSODISP,SUB
"RTN","PSODISP",85,0)
 Q
"RTN","PSODISP",86,0)
GETFILL ; get the fill number
"RTN","PSODISP",87,0)
 S NFLD=0,UU="" F  S UU=$O(^PSRX(+RXP,1,UU)) Q:UU=""  S:$D(^PSRX(+RXP,1,UU,0)) NFLD=NFLD+1
"RTN","PSODISP",88,0)
 Q
"RTN","PSODISP",89,0)
HELP W !!,"Wand the barcode number of the prescription or manually key in",!,"the number below the barcode or the prescription number.",!,"The barcode number should be of the format - 'NNN-NNNNNNN'"
"RTN","PSODISP",90,0)
 Q
"RTN","PSODISP",91,0)
BCI S RXP=0
"RTN","PSODISP",92,0)
RXP S RXP=$O(^PSRX("B",X,RXP)) I $P($G(^PSRX(+RXP,"STA")),"^")=13 G RXP ;GET RECORD NUMBER FROM SCRIPT NUMBER
"RTN","PSODISP",93,0)
 Q
"RTN","PSODISP",94,0)
DCHK ;checks for duplicate
"RTN","PSODISP",95,0)
 Q:'$G(MAN)
"RTN","PSODISP",96,0)
 I $D(DISGROUP),$D(BINGNAM),($D(BINGDIV)!$D(BNGPDV)!$D(BNGRDV)),($D(BINGRO)!$D(BINGRPR)) D REL^PSOBING1 K BINGNAM,BINGDIV,BINGRO,BINGRPR,BNGPDV,BNGRDV
"RTN","PSODISP",97,0)
 S RXP=$O(^PSRX("B",$P(^PSRX(RXP,0),"^"),RXP)) I 'RXP K POERR,MAN Q
"RTN","PSODISP",98,0)
 I $P($G(^PSRX(RXP,"STA")),"^")=13 G DCHK
"RTN","PSODISP",99,0)
 I $D(DISGROUP),$D(BINGNAM),($D(BINGDIV)!$D(BNGPDV)!$D(BNGRDV)),($D(BINGRO)!$D(BINGRPR)) D REL^PSOBING1 K BINGNAM,BINGDIV,BINGRO,BINGRPR,BNGPDV,BNGRDV
"RTN","PSODISP",100,0)
 W !!,"Duplicate Rx # "_$P(^PSRX(RXP,0),"^")_" found."
"RTN","PSODISP",101,0)
 S POERR=1 D BC1^PSODISP
"RTN","PSODISP",102,0)
 I $D(DISGROUP),$D(BINGNAM),($D(BINGDIV)!$D(BNGPDV)!$D(BNGRDV)),($D(BINGRO)!$D(BINGRPR)) D REL^PSOBING1 K BINGNAM,BINGDIV,BINGRO,BINGRPR,BNGPDV,BNGRDV
"RTN","PSODISP",103,0)
 G DCHK
"RTN","PSODISP",104,0)
 Q
"RTN","PSODISP",105,0)
XMIT D NOW^%DTC S PSODTM=%
"RTN","PSODISP",106,0)
 S IDGN=$P(^PSRX(+RXP,0),"^",6)
"RTN","PSODISP",107,0)
 K ^UTILITY($J,"PSOHL")
"RTN","PSODISP",108,0)
 S ^UTILITY($J,"PSOHL",1)=+RXP_"^"_IDGN_"^"_PSODTM_"^"_+$G(PDUZ)_"^0^^PSO DISP^^^"_FP_"^"_FPN
"RTN","PSODISP",109,0)
 S ZTRTN="INIT^PSORELDT",ZTDESC="EXTERNAL INTERFACE FOR RELEASE DATE/TIME",ZTIO="",ZTDTH=$H,ZTSAVE("^UTILITY($J,""PSOHL"",")="",ZTSAVE("PSOSITE")="",ZTSAVE("RXP")="",ZTSAVE("PSOLAP")="" D ^%ZTLOAD K ^UTILITY($J,"PSOHL")
"RTN","PSODISP",110,0)
 Q
"RTN","PSODISP3")
0^44^B12357588
"RTN","PSODISP3",1,0)
PSODISP3 ;ISC-BHAM/SAB rx speed release ;08/30/95 10:24
"RTN","PSODISP3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,13,148**;DEC 1997
"RTN","PSODISP3",3,0)
 ;External reference ^PS(59.7 supported by DBIA 694
"RTN","PSODISP3",4,0)
 ;External reference ^XTMP("PSA" supported by DBIA 1036
"RTN","PSODISP3",5,0)
 ;External reference $$SERV^IBARX supported by DBIA 2245
"RTN","PSODISP3",6,0)
SEL N VALMCNT I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSODISP3",7,0)
 K ^UTILITY($J,"PSOPCE"),QFLG,PSOFDR,DIR,DUOUT,DIRUT S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" Q
"RTN","PSODISP3",8,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,DTOUT I +Y S (SPEED,PSOOELSE,PSOPCECT)=1 D FULL^VALM1 S LST=Y D
"RTN","PSODISP3",9,0)
 . D ASK Q:$G(QFLG)  S PSOLIST=0,PSOPID=1
"RTN","PSODISP3",10,0)
 . F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""  D
"RTN","PSODISP3",11,0)
 . . K ISUF,IFN S ORN=$P(LST,",",ORD)
"RTN","PSODISP3",12,0)
 . . S RXP=$P(PSOLST($P(LST,",",ORD)),"^",2),POERR=1
"RTN","PSODISP3",13,0)
 . . D:+PSOLST(ORN)=52 FULL^VALM1,BC1^PSODISP W ! S PSOLIST=PSOLIST+1
"RTN","PSODISP3",14,0)
 . . I PSOLIST=5 D
"RTN","PSODISP3",15,0)
 . . . K DIR,DIRUT S DIR(0)="E",DIR("A",1)="",DIR("A")="Press Return to Continue"
"RTN","PSODISP3",16,0)
 . . . W ! D ^DIR K DIR,DIRUT S PSOLIST=0
"RTN","PSODISP3",17,0)
 . I $D(DISGROUP),$D(BINGNAM),($D(BINGDIV)!$D(BNGPDV)!$D(BNGRDV)),($D(BINGRO)!$D(BINGRPR)) N TM,TM1 D REL^PSOBING1 K BINGNAM,BINGDIV,BINGRO,BINGRPR,BNGPDV,BNGRDV D
"RTN","PSODISP3",18,0)
 . . K DIR,DIRUT S DIR(0)="E",DIR("A",1)="",DIR("A")="Press Return to Continue"
"RTN","PSODISP3",19,0)
 . . W ! D ^DIR K DIR,DIRUT
"RTN","PSODISP3",20,0)
 I '$G(PSOOELSE) S VALMBCK="" Q
"RTN","PSODISP3",21,0)
 S VALMBCK="R",PSORXED=1 D BLD^PSOORUT1
"RTN","PSODISP3",22,0)
 ;D PCE^PSODISP
"RTN","PSODISP3",23,0)
EX K SPEED,PSOPCECT,PSOOELSE,QFLG,PSORXED,OUT,RX2,RXFD,RESK,ISUF,SUPN,%,DIC,IFN,J,DA,DR,DIE,X,X1,X2,Y,RXP,CX,PX,ORD,LST,POERR,PSOLIST
"RTN","PSODISP3",24,0)
 K REC,DIR,YDT,REC,RDUZ,DIRUT,PSOCPN,PSOCPRX,PSOIBSS,PSOIBFL,PSOIBLP,PSOIBST,YY,QDRUG,QTY,TYPE,XTYPE,DUOUT,PSRH,XX,Y,PSIN
"RTN","PSODISP3",25,0)
 Q
"RTN","PSODISP3",26,0)
ASK ;
"RTN","PSODISP3",27,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) S VALMSG="Site Parameters must be defined to use the Release option!",VALMBCK="R",QFLG=1 Q
"RTN","PSODISP3",28,0)
 S VALMBCK="Q",Y=$G(^PS(59,PSOSITE,"IB")),PSOIBSS=$$SERV^IBARX1(+Y) I 'PSOIBSS D IBSSR^PSOUTL I 'PSOIBFL D  S VALMBCK="R",QFLG=1 Q
"RTN","PSODISP3",29,0)
 .W $C(7),!!,"The IB SERVICE/SECTION defined in your site parameter file is not valid.",!,"You will not be able to release any medication until this is corrected!",! H 3
"RTN","PSODISP3",30,0)
 W !! S PSIN=+$P($G(^PS(59.7,1,49.99)),"^",2)
"RTN","PSODISP3",31,0)
RPH S DIC("S")="I $D(^XUSEC(""PSORPH"",+Y))",DIC("A")="Enter PHARMACIST: ",DIC="^VA(200,",DIC(0)="QEAM" D ^DIC I "^"[X S QFLG=1 Q
"RTN","PSODISP3",32,0)
 G:Y=-1 RPH K DIC I $D(DIRUT) S QFLG=1 Q
"RTN","PSODISP3",33,0)
 S PSRH=+Y
"RTN","PSODISP3",34,0)
 ;check for Drug Acct background job K8 & K7.1
"RTN","PSODISP3",35,0)
 S X="PSA IV ALL LOCATIONS",DIC(0)="MZ",DIC=19.2 D ^DIC I Y=-1 K DIC,X,Y Q
"RTN","PSODISP3",36,0)
 I $P($G(Y(0)),U,2)>DT S PSODA=1 S:'$P($G(^XTMP("PSA",0)),U,2) $P(^(0),U,2)=DT Q
"RTN","PSODISP3",37,0)
 S X="PSA IV ALL LOCATIONS",DIC(0)="MZ",DIC=19 D ^DIC K DIC,X Q:Y=-1
"RTN","PSODISP3",38,0)
 K DIQ,PSA S DA=+Y,DIC=19,DIQ="PSA",DR=200,DIQ(0)="IN" D EN^DIQ1
"RTN","PSODISP3",39,0)
 I '$D(PSA(19,DA,200,"I")) K DIC,DA,X,Y,DIQ Q
"RTN","PSODISP3",40,0)
 I PSA(19,DA,200,"I")>DT S PSODA=1 S:'$P($G(^XTMP("PSA",0)),U,2) $P(^(0),U,2)=DT
"RTN","PSODISP3",41,0)
 K PSA,DIC,DA,X,Y,DIQ
"RTN","PSODISP3",42,0)
 Q
"RTN","PSODISPS")
0^38^B29958665
"RTN","PSODISPS",1,0)
PSODISPS ;BIR/SAB-CONTINUATION OF RELEASE FUNCTION ;3/2/93
"RTN","PSODISPS",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,13,9,27,67,71,156,118,148**;DEC 1997
"RTN","PSODISPS",3,0)
 ;External reference ^PS(59.7 supported by DBIA 694
"RTN","PSODISPS",4,0)
 ;External reference to ^PSDRUG("AQ" supported by DBIA 3165
"RTN","PSODISPS",5,0)
 ;External reference ^XTMP("PSA" supported by DBIA 1036
"RTN","PSODISPS",6,0)
 ;External reference $$SERV^IBARX1 supported by DBIA 2245
"RTN","PSODISPS",7,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSODISPS",8,0)
 ;
"RTN","PSODISPS",9,0)
QTY ; Refill Release
"RTN","PSODISPS",10,0)
 ;
"RTN","PSODISPS",11,0)
 S PSOCPN=$P(^PSRX(RXP,0),"^",2),QDRUG=$P(^PSRX(RXP,0),"^",6) K LBLP
"RTN","PSODISPS",12,0)
 F YY=0:0 S YY=$O(^PSRX(RXP,XTYPE,YY)) Q:'YY  D:$P($G(^PSRX(RXP,XTYPE,YY,0)),"^")'<PSIN  K ISUF,LBLP
"RTN","PSODISPS",13,0)
 .S RXFD=$E($P(^PSRX(RXP,XTYPE,YY,0),"^"),1,7),SUPN=$O(^PS(52.5,"B",RXP,0)) I SUPN,$D(^PS(52.5,"C",RXFD,SUPN)),$G(^PS(52.5,SUPN,"P"))'=1,$G(XTYPE) S ISUF=1 Q
"RTN","PSODISPS",14,0)
 .I XTYPE=1,($D(^PSDRUG("AQ",QDRUG))) K CMOP D RREL^PSOCMOPB(RXP,YY) K CMOP Q:$G(ISUF)
"RTN","PSODISPS",15,0)
 .I $P(^PSRX(RXP,XTYPE,YY,0),"^",$S($G(XTYPE):18,1:19))]""!($P(^(0),"^",16)) K IFN Q
"RTN","PSODISPS",16,0)
 .;
"RTN","PSODISPS",17,0)
 .; - Checking for OPEN/UNRESOLVED 3rd. Party Payer Rejects / NDC Editing
"RTN","PSODISPS",18,0)
 .I XTYPE,$$MANREL^PSOBPSUT(RXP,YY,$G(PSOPID))="^" Q
"RTN","PSODISPS",19,0)
 .;
"RTN","PSODISPS",20,0)
 .F LBL=0:0 S LBL=$O(^PSRX(RXP,"L",LBL)) Q:'LBL  I $P(^PSRX(RXP,"L",LBL,0),"^",2)=$S('XTYPE:(99-YY),1:YY) S LBLP=1
"RTN","PSODISPS",21,0)
 .Q:'$G(LBLP)  S IFN=YY S:$G(^PSDRUG(QDRUG,660.1))]"" QTY=$P(^PSRX(RXP,XTYPE,YY,0),"^",4),^PSDRUG(QDRUG,660.1)=^PSDRUG(QDRUG,660.1)-QTY
"RTN","PSODISPS",22,0)
 .K DA,DR,DIE D NOW^%DTC S DIE="^PSRX("_RXP_","""_XTYPE_""",",DA(1)=RXP
"RTN","PSODISPS",23,0)
 .S DA=YY,DR=$S(XTYPE:17,1:8)_"///"_%_";"_$S(XTYPE:4,1:.05)_"////"_PSRH
"RTN","PSODISPS",24,0)
 .S PSODT=% D ^DIE K DIE,DR,DA
"RTN","PSODISPS",25,0)
 .;
"RTN","PSODISPS",26,0)
 .; - Notifying IB through ECME of the Rx being released
"RTN","PSODISPS",27,0)
 .I XTYPE D IBSEND^PSOBPSUT(RXP,YY)
"RTN","PSODISPS",28,0)
 .;
"RTN","PSODISPS",29,0)
 .K PSODISPP S:$G(XTYPE)="P" PSODISPP=1 D EN^PSOHLSN1(RXP,"ZD") K PSODISPP
"RTN","PSODISPS",30,0)
 .K:XTYPE ^PSRX("ACP",$P($G(^PSRX(RXP,0)),"^",2),$P($G(^PSRX(RXP,1,YY,0)),"^"),YY,RXP)
"RTN","PSODISPS",31,0)
 .I XTYPE,$G(IFN),'$G(ISUF) S PSOCPRX=$P(^PSRX(RXP,0),"^") D CP^PSOCP
"RTN","PSODISPS",32,0)
 .;if appropriate update ^XTMP("PSA", for Drug Acct.
"RTN","PSODISPS",33,0)
 .I $G(PSODA),$G(PSODA(1)),'$D(^PSRX("AR",+PSODT,+RXP,YY)) D
"RTN","PSODISPS",34,0)
 ..S ^XTMP("PSA",+PSOSITE,+QDRUG,DT)=$G(^XTMP("PSA",+PSOSITE,+QDRUG,DT))+$P($G(^PSRX(RXP,XTYPE,YY,0)),"^",4)
"RTN","PSODISPS",35,0)
 .;initialize bingo board variables
"RTN","PSODISPS",36,0)
 .I $G(IFN),$P($G(^PSRX(RXP,XTYPE,IFN,0)),"^",2)["W" S BINGRPR="W",BNGPDV=$P(^PSRX(RXP,XTYPE,IFN,0),"^",9),BINGNAM=$P($G(^PSRX(RXP,0)),"^",2)
"RTN","PSODISPS",37,0)
 W:$G(IFN) !?7,"Prescription Number "_$P(^PSRX(RXP,0),"^")_$S('$G(XTYPE):" Partial Fill",1:" Refill(s)")_" Released" I $G(SPEED) G XMIT
"RTN","PSODISPS",38,0)
 W:'$G(IFN) !?7,"No "_$S($G(XTYPE):"Refill(s)",1:"Partial(s)")_" to be Released"
"RTN","PSODISPS",39,0)
XMIT I $G(PSODISP)=2.4 D  ;build an send HL7 v2.4 messages to dispense system
"RTN","PSODISPS",40,0)
 . F I=0:0 S SUB=$O(^PSRX(RXP,"A",I)) Q:'I  I $P(^PSRX(RXP,"A",I,0),"^",2)="N" D
"RTN","PSODISPS",41,0)
 .. D NOW^%DTC S PSODTM=% K ^UTILITY($J,"PSOHL")
"RTN","PSODISPS",42,0)
 .. S IDGN=$P(^PSRX(+RXP,0),"^",6),FP=$S(XTYPE=1:"R",1:"P")
"RTN","PSODISPS",43,0)
 .. S ^UTILITY($J,"PSOHL",1)=+RXP_"^"_IDGN_"^"_PSODTM_"^"_+$G(PDUZ)_"^0^^PSO DISP^^^"_FP_"^"_IFN
"RTN","PSODISPS",44,0)
 .. S ZTRTN="INIT^PSORELDT",ZTDESC="EXTERNAL INTERFACE FOR RELEASE DATE/TIME",ZTIO="",ZTDTH=$H,ZTSAVE("^UTILITY($J,""PSOHL"",")="",ZTSAVE("PSOSITE")="",ZTSAVE("RXP")="" D ^%ZTLOAD K ^UTILITY($J,"PSOHL")
"RTN","PSODISPS",45,0)
 K IFN
"RTN","PSODISPS",46,0)
 Q
"RTN","PSODISPS",47,0)
STAT S RX0=^PSRX(RXP,0),$P(RX0,"^",15)=+^("STA"),RX2=^PSRX(RXP,2),J=RXP D ^PSOFUNC
"RTN","PSODISPS",48,0)
 W !!?5,$C(7),$C(7),"Rx# "_$P(^PSRX(RXP,0),"^")_" has a status of "_ST_" and is not eligible for",!?5,"release."_$S('$D(^XUSEC("PSORPH",DUZ)):"  Please check with a Pharmacist!",1:"")
"RTN","PSODISPS",49,0)
 K RX0,ST
"RTN","PSODISPS",50,0)
 Q
"RTN","PSODISPS",51,0)
OERR I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) W $C(7),!!,?5,"Site Parameters must be defined to use the Release option!",! S VALMBCK="" Q
"RTN","PSODISPS",52,0)
 S VALMBCK="Q",Y=$G(^PS(59,PSOSITE,"IB")),PSOIBSS=$$SERV^IBARX1(+Y) I 'PSOIBSS D IBSSR^PSOUTL I 'PSOIBFL D  S VALMBCK="" G EX
"RTN","PSODISPS",53,0)
 .W $C(7),!!,"The IB SERVICE/SECTION defined in your site parameter file is not valid.",!,"You will not be able to release any medication until this is corrected!",!
"RTN","PSODISPS",54,0)
 W !! S PSIN=+$P($G(^PS(59.7,1,49.99)),"^",2),RXP=$P(PSOLST($P(PSLST,",",ORD)),"^",2)
"RTN","PSODISPS",55,0)
 S DIC("S")="I $D(^XUSEC(""PSORPH"",+Y))",DIC("A")="Enter PHARMACIST: ",DIC="^VA(200,",DIC(0)="QEAM" D ^DIC G:"^"[X EX K DIC G:$D(DTOUT)!($D(DUOUT))!($D(DIRUT))!(Y=-1) EX S PSRH=+Y
"RTN","PSODISPS",56,0)
 ;check for Drug Acct background job K8 & K7.1
"RTN","PSODISPS",57,0)
 S X="PSA IV ALL LOCATIONS",DIC(0)="MZ",DIC=19.2 D ^DIC I Y=-1 K DIC,X,Y G DOIT
"RTN","PSODISPS",58,0)
 I $P($G(Y(0)),U,2)>DT S PSODA=1 S:'$P($G(^XTMP("PSA",0)),U,2) $P(^(0),U,2)=DT G DOIT
"RTN","PSODISPS",59,0)
 S X="PSA IV ALL LOCATIONS",DIC(0)="MZ",DIC=19 D ^DIC K DIC,X G:Y=-1 DOIT
"RTN","PSODISPS",60,0)
 K DIQ,PSA S DA=+Y,DIC=19,DIQ="PSA",DR=200,DIQ(0)="IN" D EN^DIQ1
"RTN","PSODISPS",61,0)
 I '$D(PSA(19,DA,200,"I")) K DIC,DA,X,Y,DIQ G DOIT
"RTN","PSODISPS",62,0)
 I PSA(19,DA,200,"I")>DT S PSODA=1 S:'$P($G(^XTMP("PSA",0)),U,2) $P(^(0),U,2)=DT
"RTN","PSODISPS",63,0)
 K PSA,DIC,DA,X,Y,DIQ
"RTN","PSODISPS",64,0)
 ;
"RTN","PSODISPS",65,0)
DOIT S POERR=1 D FULL^VALM1,BC1^PSODISP
"RTN","PSODISPS",66,0)
 I $D(DISGROUP),$D(BINGNAM),($D(BINGDIV)!$D(BNGPDV)!$D(BNGRDV)),($D(BINGRO)!$D(BINGRPR)) N TM,TM1 D REL^PSOBING1 K BINGNAM,BINGDIV,BINGRO,BINGRPR,BNGPDV,BNGRDV
"RTN","PSODISPS",67,0)
EX ;
"RTN","PSODISPS",68,0)
 K OUT,RX2,RXFD,RESK,ISUF,SUPN,%,DIC,IFN,J,DA,DR,DIE,X,X1,X2,Y,RXP,CX,PX,REC,DIR,YDT,REC,RDUZ,DIRUT,PSOCPN,PSOCPRX,PSOIBSS,PSOIBFL,PSOIBLP,PSOIBST,YY,QDRUG,QTY,TYPE,XTYPE,DUOUT,PSRH,XX,Y,PSIN,POERR,SUB
"RTN","PSODISPS",69,0)
 K DIR S DIR("A",1)=" ",DIR("A")="Press Return to Continue",DIR(0)="E" D ^DIR K DIRUT,DUOUT,DTOUT,DIR S VALMBCK="R"
"RTN","PSODISPS",70,0)
 S PSORXED=1 D ^PSOBUILD,ACT^PSOORNE2 K PSORXED Q
"RTN","PSODRG")
0^39^B30303688
"RTN","PSODRG",1,0)
PSODRG ;IHS/DSD/JCM-ORDER ENTRY DRUG SELECTION ;03/30/93
"RTN","PSODRG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,23,36,53,54,46,112,139,207,148**;DEC 1997
"RTN","PSODRG",3,0)
 ;Reference ^PSDRUG supported by DBIA 221
"RTN","PSODRG",4,0)
 ;Reference ^PS(50.7 supported by DBIA 2223
"RTN","PSODRG",5,0)
 ;Reference to PSSDIN supported by DBIA 3166
"RTN","PSODRG",6,0)
 ;Reference to $$NDCFMT^PSSNDCUT supported by IA 4707
"RTN","PSODRG",7,0)
 ;----------------------------------------------------------
"RTN","PSODRG",8,0)
START ;
"RTN","PSODRG",9,0)
 S (PSONEW("DFLG"),PSONEW("FIELD"),PSODRG("QFLG"))=0
"RTN","PSODRG",10,0)
 D SELECT G:$G(PSORXED("DFLG")) END ; Select Drug
"RTN","PSODRG",11,0)
 ;
"RTN","PSODRG",12,0)
 I $G(PSORX("EDIT")),$G(PSOY),$G(PSODRUG("IEN"))=+PSOY D  G:$G(PSORXED("DFLG")) END
"RTN","PSODRG",13,0)
 . N NDC D NDC(+$G(PSORXED("IRXN")),0,+PSOY,.NDC) I $G(NDC)="^" S PSORXED("DFLG")=1 Q
"RTN","PSODRG",14,0)
 . I $G(NDC)'="" S (PSODRUG("NDC"),PSORXED("FLD",27))=NDC
"RTN","PSODRG",15,0)
 ;
"RTN","PSODRG",16,0)
 I $G(PSORX("EDIT"))]"",'PSONEW("FIELD") D TRADE
"RTN","PSODRG",17,0)
 G:PSONEW("DFLG")!(PSODRG("QFLG"))!($G(PSORXED("DFLG"))) END
"RTN","PSODRG",18,0)
 D SET ; Set various drug information
"RTN","PSODRG",19,0)
 D NFI ; Display dispense drug/orderable item text
"RTN","PSODRG",20,0)
 D:'$G(PSOEDIT) POST I $G(PSORX("DFLG")) S PSONEW("DFLG")=1 K:'$G(PSORX("EDIT")) PSORX("DFLG") ; Do any post selection action
"RTN","PSODRG",21,0)
END ;D EOJ
"RTN","PSODRG",22,0)
 Q
"RTN","PSODRG",23,0)
 ;------------------------------------------------------------
"RTN","PSODRG",24,0)
 ;
"RTN","PSODRG",25,0)
SELECT ;
"RTN","PSODRG",26,0)
 K:'$G(PSORXED) CLOZPAT
"RTN","PSODRG",27,0)
 K DIC,X,Y,PSODRUG("TRADE NAME"),PSODRUG("NDC"),PSODRUG("DAW") S:$G(POERR)&($P($G(OR0),"^",9)) Y=$P(^PSDRUG($P(OR0,"^",9),0),"^")
"RTN","PSODRG",28,0)
 I $G(PSODRUG("IEN"))]"" S Y=PSODRUG("NAME"),PSONEW("OLD VAL")=PSODRUG("IEN")
"RTN","PSODRG",29,0)
 W !,"DRUG: "_$S($G(Y)]"":Y_"// ",1:"") R X:$S($D(DTIME):DTIME,1:300) I '$T S DTOUT=1
"RTN","PSODRG",30,0)
 I X="",$G(Y)]"" S:Y X=Y S:'X X=$G(PSODRUG("IEN")) S:X X="`"_X
"RTN","PSODRG",31,0)
 G:X="" SELECT
"RTN","PSODRG",32,0)
 I X?1."?" W !!,"Answer with DRUG NUMBER, or GENERIC NAME, or VA PRODUCT NAME, or",!,"NATIONAL DRUG CLASS, or SYNONYM" G SELECT
"RTN","PSODRG",33,0)
 I $G(PSORXED),X["^" S PSORXED("DFLG")=1 G SELECTX
"RTN","PSODRG",34,0)
 I X="^"!(X["^^")!($D(DTOUT)) S PSONEW("DFLG")=1 G SELECTX
"RTN","PSODRG",35,0)
 I '$G(POERR),X[U,$L(X)>1 S PSODIR("FLD")=PSONEW("FLD") D JUMP^PSODIR1 S:$G(PSODIR("FIELD")) PSONEW("FIELD")=PSODIR("FIELD") K PSODIR S PSODRG("QFLG")=1 G SELECTX
"RTN","PSODRG",36,0)
 S DIC=50,DIC(0)="EMQZVT",DIC("T")="",D="B^C^VAPN^VAC"
"RTN","PSODRG",37,0)
 S DIC("S")="I $S('$D(^PSDRUG(+Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0),$S($P($G(^PSDRUG(+Y,2)),""^"",3)'[""O"":0,1:1),$D(^PSDRUG(""ASP"",+$G(^(2)),+Y))"
"RTN","PSODRG",38,0)
 D MIX^DIC1 K DIC,D
"RTN","PSODRG",39,0)
 I $D(DTOUT) S PSONEW("DFLG")=1 G SELECTX
"RTN","PSODRG",40,0)
 I $D(DUOUT) K DUOUT G SELECT
"RTN","PSODRG",41,0)
 I Y<0 G SELECT
"RTN","PSODRG",42,0)
 S:$G(PSONEW("OLD VAL"))=+Y&('$G(PSOEDIT)) PSODRG("QFLG")=1
"RTN","PSODRG",43,0)
 K PSOY S PSOY=Y,PSOY(0)=Y(0)
"RTN","PSODRG",44,0)
 I $P(PSOY(0),"^")="OTHER DRUG"!($P(PSOY(0),"^")="OUTSIDE DRUG") D TRADE
"RTN","PSODRG",45,0)
SELECTX K X,Y,DTOUT,DUOUT,PSONEW("OLD VAL")
"RTN","PSODRG",46,0)
 Q
"RTN","PSODRG",47,0)
 ;
"RTN","PSODRG",48,0)
NDC(RX,RFL,DRG,NDC) ; Editing NDC for ECME Released Rx's
"RTN","PSODRG",49,0)
 S NDC=$S($G(NDC)'="":$G(NDC),1:$$GETNDC^PSONDCUT(RX,.RFL))
"RTN","PSODRG",50,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q
"RTN","PSODRG",51,0)
 I '$$RXRLDT^PSOBPSUT(RX,RFL) Q
"RTN","PSODRG",52,0)
 ;
"RTN","PSODRG",53,0)
 S NDC=$S($G(NDC)'="":$G(NDC),1:$$GETNDC^PSONDCUT(RX,.RFL))
"RTN","PSODRG",54,0)
 D NDCEDT^PSONDCUT(RX,.RFL,$G(DRG),$G(PSOSITE),.NDC)
"RTN","PSODRG",55,0)
 Q
"RTN","PSODRG",56,0)
 ;
"RTN","PSODRG",57,0)
TRADE ;
"RTN","PSODRG",58,0)
 K DIR,DIC,DA,X,Y
"RTN","PSODRG",59,0)
 S DIR(0)="52,6.5" S:$G(PSOTRN)]"" DIR("B")=$G(PSOTRN) D ^DIR K DIR,DIC
"RTN","PSODRG",60,0)
 I X="@" S Y=X K DIRUT
"RTN","PSODRG",61,0)
 I $D(DIRUT) S:$D(DUOUT)!$D(DTOUT)&('$D(PSORX("EDIT"))) PSONEW("DFLG")=1 G TRADEX
"RTN","PSODRG",62,0)
 S PSODRUG("TRADE NAME")=Y
"RTN","PSODRG",63,0)
TRADEX I $G(PSORXED("DFLG")),$D(DIRUT) S PSORXED("DFLG")=1
"RTN","PSODRG",64,0)
 K DIRUT,DTOUT,DUOUT,X,Y,DA,DR,DIE
"RTN","PSODRG",65,0)
 Q
"RTN","PSODRG",66,0)
SET ;
"RTN","PSODRG",67,0)
 N STAT S PSODRUG("IEN")=+PSOY,PSODRUG("VA CLASS")=$P(PSOY(0),"^",2)
"RTN","PSODRG",68,0)
 S PSODRUG("NAME")=$P(PSOY(0),"^")
"RTN","PSODRG",69,0)
 S:+$G(^PSDRUG(+PSOY,2)) PSODRUG("OI")=+$G(^(2)),PSODRUG("OIN")=$P(^PS(50.7,+$G(^(2)),0),"^")
"RTN","PSODRG",70,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(+PSOY,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSODRG",71,0)
 S PSODRUG("MAXDOSE")=$P(PSOY(0),"^",4),PSODRUG("DEA")=$P(PSOY(0),"^",3)
"RTN","PSODRG",72,0)
 S PSODRUG("CLN")=$S($D(^PSDRUG(+PSOY,"ND")):+$P(^("ND"),"^",6),1:0)
"RTN","PSODRG",73,0)
 S PSODRUG("SIG")=$P(PSOY(0),"^",5)
"RTN","PSODRG",74,0)
 I $G(PSODRUG("NDC"))="" S PSODRUG("NDC")=$$GETNDC^PSSNDCUT(+PSOY,$G(PSOSITE))
"RTN","PSODRG",75,0)
 S PSODRUG("DAW")=+$$GET1^DIQ(50,+PSOY,81)
"RTN","PSODRG",76,0)
 S PSODRUG("STKLVL")=$G(^PSDRUG(+PSOY,660.1))
"RTN","PSODRG",77,0)
 G:$G(^PSDRUG(+PSOY,660))']"" SETX
"RTN","PSODRG",78,0)
 S PSOX1=$G(^PSDRUG(+PSOY,660))
"RTN","PSODRG",79,0)
 S PSODRUG("COST")=$P($G(PSOX1),"^",6)
"RTN","PSODRG",80,0)
 S PSODRUG("UNIT")=$P($G(PSOX1),"^",8)
"RTN","PSODRG",81,0)
 S PSODRUG("EXPIRATION DATE")=$P($G(PSOX1),"^",9)
"RTN","PSODRG",82,0)
SETX K PSOX1,PSOY
"RTN","PSODRG",83,0)
 Q
"RTN","PSODRG",84,0)
NFI ;display restriction/guidelines
"RTN","PSODRG",85,0)
 D EN^PSSDIN(PSODRUG("OI"),PSODRUG("IEN")) S NFI=$$PROMPT^PSSDIN
"RTN","PSODRG",86,0)
 I NFI]"","ODY"[NFI D TD^PSONFI
"RTN","PSODRG",87,0)
 K NFI Q
"RTN","PSODRG",88,0)
POST ;order checks
"RTN","PSODRG",89,0)
 K PSORX("INTERVENE") N STAT,SIG,PTR,NDF,VAP S PSORX("DFLG")=0
"RTN","PSODRG",90,0)
 D ^PSOBUILD
"RTN","PSODRG",91,0)
 D @$S($G(COPY):"^PSOCPDUP",1:"^PSODRDUP") ; Set PSORX("DFLG")=1 if process to stop
"RTN","PSODRG",92,0)
 Q:$G(PSORX("DFLG"))
"RTN","PSODRG",93,0)
 W:$G(PSOFIN)']"" !,"Now doing drug interaction and allergy checks.  Please wait...",!
"RTN","PSODRG",94,0)
 D ^PSODGDGI
"RTN","PSODRG",95,0)
 I $G(PSORX("INTERVENE"))]"" D FULL^VALM1,^PSORXI S VALMBCK="R"
"RTN","PSODRG",96,0)
 G:PSORX("DFLG") POSTX
"RTN","PSODRG",97,0)
 D:$P($G(^PSDRUG(PSODRUG("IEN"),"CLOZ1")),"^")]"" CLOZ G:PSORX("DFLG") POSTX
"RTN","PSODRG",98,0)
 K PSORX("INTERVENE")
"RTN","PSODRG",99,0)
 I $D(PSODRUG("NDF")) S NDF=$P(PSODRUG("NDF"),"A"),VAP=$P(PSODRUG("NDF"),"A",2),PTR=NDF_"."_VAP
"RTN","PSODRG",100,0)
 I $G(NDF) D CHK^PSODGAL(PSODFN,"DR",PTR) K NDF,VAP,PTR
"RTN","PSODRG",101,0)
 I $P($G(PSODRUG("NDF")),"A")=0 D CHK1^PSODGAL(PSODFN)
"RTN","PSODRG",102,0)
 I $D(PSODRUG("VA CLASS")) D CLASS^PSODGAL
"RTN","PSODRG",103,0)
POSTX ;
"RTN","PSODRG",104,0)
 K PSORX("INTERVENE"),DA
"RTN","PSODRG",105,0)
 Q
"RTN","PSODRG",106,0)
 ;
"RTN","PSODRG",107,0)
EOJ ;
"RTN","PSODRG",108,0)
 K PSODRG
"RTN","PSODRG",109,0)
 Q
"RTN","PSODRG",110,0)
 ;
"RTN","PSODRG",111,0)
CLOZ ;
"RTN","PSODRG",112,0)
 S ANQRTN=$P(^PSDRUG(PSODRUG("IEN"),"CLOZ1"),"^"),ANQX=0
"RTN","PSODRG",113,0)
 S P(5)=PSODRUG("IEN"),DFN=PSODFN,X=ANQRTN
"RTN","PSODRG",114,0)
 X ^%ZOSF("TEST") I  D @("^"_ANQRTN) S:$G(ANQX) PSORX("DFLG")=1
"RTN","PSODRG",115,0)
 K P(5),ANQRTN,ANQX,X
"RTN","PSODRG",116,0)
 Q
"RTN","PSODRG",117,0)
 ;
"RTN","PSODRG",118,0)
EN(DRG) ;returns lab test identified for clozapine order checking
"RTN","PSODRG",119,0)
 K LAB I $P($G(^PSDRUG(DRG,"CLOZ1")),"^")'="PSOCLO1" S LAB("NOT")=0 Q
"RTN","PSODRG",120,0)
 I $P($G(^PSDRUG(DRG,"CLOZ1")),"^")="PSOCLO1" D
"RTN","PSODRG",121,0)
 .S (CNT,I)=0 F  S I=$O(^PSDRUG(DRG,"CLOZ2",I)) Q:'I  S CNT=$G(CNT)+1
"RTN","PSODRG",122,0)
 .I CNT'=2 S LAB("BAD TEST")=0 K CNT Q
"RTN","PSODRG",123,0)
 .K CNT F I=0:0 S I=$O(^PSDRUG(DRG,"CLOZ2",I)) Q:'I  D
"RTN","PSODRG",124,0)
 ..S LABT=$S($P(^PSDRUG(DRG,"CLOZ2",I,0),"^",4)=1:"WBC",1:"ANC"),LAB(LABT)=$P(^PSDRUG(DRG,"CLOZ2",I,0),"^")_"^"_$P(^(0),"^",3)_"^"_$P(^(0),"^",4)
"RTN","PSODRG",125,0)
 K LABT,I
"RTN","PSODRG",126,0)
 Q
"RTN","PSOHLD")
0^24^B48797916
"RTN","PSOHLD",1,0)
PSOHLD ;BIR/SAB - hold unhold functionality ;07/15/96
"RTN","PSOHLD",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,16,21,24,27,32,55,82,114,130,166,148**;DEC 1997
"RTN","PSOHLD",3,0)
 ;External reference to ^DD(52-DBIA 999,  VA(200-DBIA 224, NA^ORX1-DBIA 2186,
"RTN","PSOHLD",4,0)
 ; L, UL, PSOL, and PSOUL^PSSLOCK-DBIA 2789, ^%DTC-DBIA 10000, ^DIE-DBIA 10018, ^DIR-DBIA 10026,
"RTN","PSOHLD",5,0)
 ; ^DIK-DBIA 10013, ^VALM1-DBIA 10016, ^XUSEC(-DBIA 10076
"RTN","PSOHLD",6,0)
UHLD I '$D(PSOPAR) D ^PSOLSET G:'$D(PSOPAR) EX
"RTN","PSOHLD",7,0)
 I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSOHLD",8,0)
 I $G(PSONACT) W $C(7),$C(7) S VALMSG="No Pharmacy Orderable Item !",VALMBCK="" Q
"RTN","PSOHLD",9,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSOHLD",10,0)
 ;W !! S DIC("A")="Unhold Prescription #: ",(DIE,DIC)="^PSRX(",DIC(0)="AEMQZ",DIC("S")="I $G(^PSRX(+Y,""H""))]"""",$P(^(""STA""),""^"")'=16" D ^DIC G:"^"[$E(X) EX G:Y<0 UHLD S (DA,PPL)=+Y,DFN=$P(Y(0),"^",2)
"RTN","PSOHLD",11,0)
 K PSOPLCK D PSOL^PSSLOCK(DA) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D ULP Q
"RTN","PSOHLD",12,0)
 S Y(0)=^PSRX(DA,0),STA=+$G(^("STA"))
"RTN","PSOHLD",13,0)
 I STA=16 S VALMSG="Placed on HOLD by Provider!" K Y,STA D PSOUL^PSSLOCK(DA) D ULP S VALMBCK="" Q
"RTN","PSOHLD",14,0)
 I STA'=3!('$D(^XUSEC("PSORPH",DUZ))) S VALMSG="Invalid Action Selection!",VALMBCK="" K Y,STA D PSOUL^PSSLOCK(DA) D ULP Q
"RTN","PSOHLD",15,0)
 D FULL^VALM1 K DIR,DTOUT,DUOUT,DIRUT D NOOR I $D(DIRUT) D ULP G EX
"RTN","PSOHLD",16,0)
 I DT>$P(^PSRX(DA,2),"^",6) D  D ULP G EX
"RTN","PSOHLD",17,0)
 .S VALMSG="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11
"RTN","PSOHLD",18,0)
 .S ^PSRX(DA,"H")="",COMM="Medication Expired on "_$E($P(^(2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM,"") K COMM
"RTN","PSOHLD",19,0)
EN S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I,RSDT=$P(^(0),"^")
"RTN","PSOHLD",20,0)
 I RXF D  I $D(Y) D ULP G EX
"RTN","PSOHLD",21,0)
 .S (PSDA,DA(1))=DA,DA=RXF,DIE="^PSRX("_DA(1)_",1,"
"RTN","PSOHLD",22,0)
 .S RLDT=$P(^PSRX(DA(1),1,DA,0),"^",18)
"RTN","PSOHLD",23,0)
 .S DR=$S('RLDT:".01R;2;",1:"")_"3COMMENTS"
"RTN","PSOHLD",24,0)
 .S PSOUNHLD=1 D ^DIE K PSOUNHLD
"RTN","PSOHLD",25,0)
 .S ZD(PSDA)=$P(^PSRX(DA(1),1,DA,0),"^")
"RTN","PSOHLD",26,0)
 .Q:$D(Y)  S PSORX("FILL DATE")=$P(^PSRX(DA(1),1,DA,0),"^"),DA=PSDA K DA(1)
"RTN","PSOHLD",27,0)
 ;
"RTN","PSOHLD",28,0)
 S ACT=1,DIE="^PSRX(",FDT=$S($P(^PSRX(DA,2),"^",2):$P(^PSRX(DA,2),"^",2),1:DT)
"RTN","PSOHLD",29,0)
 S RLDT=$P(^PSRX(DA,2),"^",13),DR="",RLDTP1=$P(RLDT,".",1)
"RTN","PSOHLD",30,0)
 I 'RXF&'RLDT S DR="22//^S X=FDT;11;Q;"
"RTN","PSOHLD",31,0)
 I RLDT&($P(^PSRX(DA,2),"^",2)="") S DR="22//^S X=RLDTP1;11;Q;"
"RTN","PSOHLD",32,0)
 S DR=DR_"100///0;101///^S X=$S(RXF:$G(ZD(PSDA)),1:$P(^PSRX(PSDA,2),""^"",2))"
"RTN","PSOHLD",33,0)
 ;
"RTN","PSOHLD",34,0)
 D ^DIE K FDT I $D(Y) S VALMBCK="R" D ULP G EX
"RTN","PSOHLD",35,0)
 S COMM="Medication Removed from Hold by Pharmacy" D EN^PSOHLSN1(DA,"OE","",COMM,PSONOOR) K COMM,PSONOOR
"RTN","PSOHLD",36,0)
 S PSORX("FILL DATE")=$S('RXF:$P(^PSRX(DA,2),"^",2),1:ZD(PSDA)) K ^PSRX("AH",$P(^PSRX(DA,"H"),"^"),DA) S ^PSRX(DA,"H")="" D ACT^PSOHLDA S (NEW1,NEW11)="^^"
"RTN","PSOHLD",37,0)
 S (RXF,RXFL(DA))=0 F JJ=0:0 S JJ=$O(^PSRX(DA,1,JJ)) Q:'JJ  S (RXFL(DA),RXF)=JJ
"RTN","PSOHLD",38,0)
 I $G(PSXSYS) D UNHOLD^PSOCMOPA I $G(XFLAG) D ULP G EX
"RTN","PSOHLD",39,0)
 I $G(DA) D RELC I $G(PSOHRL) D ULP G EX
"RTN","PSOHLD",40,0)
 I PSORX("FILL DATE")>DT,$P(PSOPAR,"^",6) D S^PSORXL,EX,ULP Q
"RTN","PSOHLD",41,0)
 S PCOMH(DA)="Medication Removed from Hold by Pharmacy"
"RTN","PSOHLD",42,0)
 I $G(DA) S RXRH(DA)=DA
"RTN","PSOHLD",43,0)
 I $P($G(^PSRX(DA,2)),"^",15)'="" S $P(^PSRX(DA,2),"^",14)=1,RXRP(DA)=1,$P(RXRP(DA),"^",2)=$P($G(^PSRX(DA,0)),"^",18) ; MARK PRESCRIPTION AND LABEL AS BEING REPRINTED WHEN UNHOLDING A RETURNED TO SOTCK PRESCRIPTION
"RTN","PSOHLD",44,0)
 ;
"RTN","PSOHLD",45,0)
 ; - Submitting Rx to ECME
"RTN","PSOHLD",46,0)
 N ACTION
"RTN","PSOHLD",47,0)
 I $$SUBMIT^PSOBPSUT(DA,+$G(RXFL(DA))) D  I ACTION="Q"!(ACTION="^") D ULP G EX
"RTN","PSOHLD",48,0)
 . N RX,RFL S RX=DA,RFL=+$G(RXFL(DA))
"RTN","PSOHLD",49,0)
 . N DA S ACTION=""
"RTN","PSOHLD",50,0)
 . D ECMESND^PSOBPSU1(RX,RFL,,$S(RFL:"RF",1:"OF"))
"RTN","PSOHLD",51,0)
 . I $$FIND^PSOREJUT(RX,RFL) D
"RTN","PSOHLD",52,0)
 . . S ACTION=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","IOQ","I")
"RTN","PSOHLD",53,0)
 ;
"RTN","PSOHLD",54,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=DA_"," D ULP G EX
"RTN","PSOHLD",55,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOHLD",56,0)
 I $L(PSORX("PSOL",PSOX2))+$L(DA)<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_DA_","
"RTN","PSOHLD",57,0)
 E  S PSORX("PSOL",PSOX2+1)=DA_","
"RTN","PSOHLD",58,0)
 ; 
"RTN","PSOHLD",59,0)
 D ULP
"RTN","PSOHLD",60,0)
EX D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) D ^PSOBUILD
"RTN","PSOHLD",61,0)
 K PSOHRL,PSOMSG,PSOPLCK,ST,PSL,PSNP,IR,NOW,DR,NEW1,NEW11,RTN,DA,PPL,RXN,RX0,RXS,DIK,RXP,FLD,ACT,DIE,DIC,DIR,DIE,X,Y,DIRUT,DUOUT,SUSPT,C,D0,LFD,I,PSDA,RFDATE,DI,DQ,%,RFN,XFLAG
"RTN","PSOHLD",62,0)
 K HRX,PSHLD,PSOLIST,PSORX("FILL DATE"),STA,QTY,RFDT,PSORX0,PSRXN,RXF,JJ Q
"RTN","PSOHLD",63,0)
 ;
"RTN","PSOHLD",64,0)
HLD ;
"RTN","PSOHLD",65,0)
 I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSOHLD",66,0)
 I $G(PSONACT) W $C(7),$C(7) S VALMSG="No Pharmacy Orderable Item !",VALMBCK="" Q
"RTN","PSOHLD",67,0)
 I '$D(^XUSEC("PSORPH",DUZ)) S VALMSG="Invalid Action Selection!",VALMBCK="" Q
"RTN","PSOHLD",68,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient."),VALMBCK="" K PSOPLCK Q
"RTN","PSOHLD",69,0)
 K PSOPLCK D PSOL^PSSLOCK(DA) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D ULP Q
"RTN","PSOHLD",70,0)
 S Y(0)=^PSRX(DA,0),STA=+$G(^("STA")) I DT>$P(^PSRX(DA,2),"^",6) D  D ULP G D1
"RTN","PSOHLD",71,0)
 .S VALMSG="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3),VALMBCK="R"
"RTN","PSOHLD",72,0)
 .I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11 D
"RTN","PSOHLD",73,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(DA,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM) K COMM
"RTN","PSOHLD",74,0)
 S ST=$P("ERROR^ACTIVE^NON-VERIFIED^REFILL^HOLD^NON-VERIFIED^SUSPENDED^^^^^DONE^EXPIRED^DISCONTINUED^DELETED^DISCONTINUED^DISCONTINUED (EDIT)^PROVIDER HOLD^","^",STA+2)
"RTN","PSOHLD",75,0)
 I STA,STA'>4!(STA>11) D  D ULP G D1
"RTN","PSOHLD",76,0)
 .S VALMSG="Rx: "_$P(Y(0),"^")_" is currently in a status of "_ST,VALMBCK="R" K ST,Y Q
"RTN","PSOHLD",77,0)
 D FULL^VALM1 D NOOR I $D(DIRUT) D ULP G D1
"RTN","PSOHLD",78,0)
 D HLD^PSOCMOPA I $G(XFLAG) K XFLAG D ULP G D1
"RTN","PSOHLD",79,0)
 K DIR S DIR("A")=$P(^DD(52,99,0),"^"),DIR(0)="52,99" D ^DIR S FLD(99)=Y I $D(DUOUT)!($D(DIRUT)) K DIRUT,DUOUT,DIR D ULP G D1
"RTN","PSOHLD",80,0)
 I $G(FLD(99))=99 K DIR S DIR("A")=$P(^DD(52,99.1,0),"^"),DIR(0)="52,99.1" D ^DIR S FLD(99.1)=Y G AR
"RTN","PSOHLD",81,0)
 E  K DIR S DIR(0)="FO^10:100",DIR("A")="HOLD COMMENTS" D ^DIR S FLD(99.1)=Y
"RTN","PSOHLD",82,0)
AR I $D(DUOUT)!($D(DTOUT)) K DIRUT,DUOUT,DIR S VALMBCK="R" D ULP G D1
"RTN","PSOHLD",83,0)
 F PI=1:1 Q:$P(PPL,",",PI)=""  S DA=$P(PPL,",",PI) D H S DA=PSDA K PSDA D:$D(PSORX("PSOL")) RMP^PSOHLDA
"RTN","PSOHLD",84,0)
 K PI D ^PSOBUILD
"RTN","PSOHLD",85,0)
 D ULP
"RTN","PSOHLD",86,0)
D1 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) K PSOMSG,PSOPLCK,RFN,DIR,RSDT,FLD,DA,ACT,X,Y,DIRUT,DUOUT,DTOUT,DIROUT
"RTN","PSOHLD",87,0)
 Q
"RTN","PSOHLD",88,0)
 ;
"RTN","PSOHLD",89,0)
H ; - Rx HOLD update
"RTN","PSOHLD",90,0)
 D HOLD^PSOHLDA
"RTN","PSOHLD",91,0)
 Q
"RTN","PSOHLD",92,0)
 ;
"RTN","PSOHLD",93,0)
FLD N DA K DIR S DIR("A")=$P(^DD(52,99,0),"^"),DIR(0)="52,99" D ^DIR Q:$D(DUOUT)!($D(DIRUT))  S FLD(99)=Y
"RTN","PSOHLD",94,0)
 S COMM=Y(0)
"RTN","PSOHLD",95,0)
 I $G(FLD(99))=99 K DIR S DIR("A")=$P(^DD(52,99.1,0),"^"),DIR(0)="52,99.1" D ^DIR Q:$D(DUOUT)!($D(DIRUT))  S (FLD(99.1),COMM)=Y Q
"RTN","PSOHLD",96,0)
 E  S FLD(99.1)=""
"RTN","PSOHLD",97,0)
 Q
"RTN","PSOHLD",98,0)
NOOR ;ask nature of order
"RTN","PSOHLD",99,0)
 K DIR,DTOUT,DTOUT,DIRUT I $T(NA^ORX1)]""  D  Q
"RTN","PSOHLD",100,0)
 .S PSONOOR=$$NA^ORX1("W",0,"B","Nature of Order",0,"WPSDIVX"_$S(+$G(^VA(200,DUZ,"PS")):"E",1:""))
"RTN","PSOHLD",101,0)
 .I +PSONOOR S PSONOOR=$P(PSONOOR,"^",3) Q
"RTN","PSOHLD",102,0)
 .S DIRUT=1 K PSONOOR
"RTN","PSOHLD",103,0)
 S DIR("A")="Nature of Order: ",DIR("B")="WRITTEN"
"RTN","PSOHLD",104,0)
 S DIR(0)="SA^W:WRITTEN;V:VERBAL;P:TELEPHONE;S:SERVICE CORRECTED;D:DUPLICATE;I:POLICY"_$S(+$G(^VA(200,DUZ,"PS")):";E:PROVIDER ENTERED",1:"")
"RTN","PSOHLD",105,0)
NOORX D ^DIR K DIR,DTOUT,DTOUT Q:$D(DIRUT)  S PSONOOR=Y
"RTN","PSOHLD",106,0)
 Q
"RTN","PSOHLD",107,0)
ULP ;
"RTN","PSOHLD",108,0)
 D UL^PSSLOCK(+$G(PSODFN))
"RTN","PSOHLD",109,0)
 Q
"RTN","PSOHLD",110,0)
RELC ;
"RTN","PSOHLD",111,0)
 S (PSOHRL,PSOHTX)=0  F PSOHT=0:0 S PSOHT=$O(^PSRX(DA,1,PSOHT)) Q:'PSOHT  S:$D(^PSRX(DA,1,PSOHT,0)) PSOHTX=PSOHT
"RTN","PSOHLD",112,0)
 I $G(PSOHTX) S PSOHRL=$S($P($G(^PSRX(DA,1,PSOHTX,0)),"^",18):1,1:0)
"RTN","PSOHLD",113,0)
 I '$G(PSOHTX) S PSOHRL=$S($P($G(^PSRX(DA,2)),"^",13):1,1:0)
"RTN","PSOHLD",114,0)
 K PSOHTX,PSOHT
"RTN","PSOHLD",115,0)
 Q
"RTN","PSOHLDA")
0^25^B10413296
"RTN","PSOHLDA",1,0)
PSOHLDA ;BIR/MFR - HOLD/UNHOLD functionality (cont.) ;07/15/96
"RTN","PSOHLDA",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOHLDA",3,0)
 ;
"RTN","PSOHLDA",4,0)
HOLD ;hold function
"RTN","PSOHLDA",5,0)
 I $P($G(^PSRX(DA,"STA")),"^")=3 Q
"RTN","PSOHLDA",6,0)
 S RSDT=$S($P(^PSRX(DA,2),"^",13):$P(^PSRX(DA,3),"^"),1:"@"),(PSUS,ACT,RXF,RFN,I)=0 F  S I=$O(^PSRX(DA,1,I)) Q:'I  D
"RTN","PSOHLDA",7,0)
 .S RXF=I,RFN=RFN+1 S:RFN=1 RSDT=$S('$P(^PSRX(DA,1,I,0),"^",18):$P(^PSRX(DA,2),"^",2),1:$P(^PSRX(DA,1,I,0),"^"))
"RTN","PSOHLDA",8,0)
 .I RFN>1,'$P(^PSRX(DA,1,I,0),"^",18) S RSDT=$P(^PSRX(DA,1,RXF-1,0),"^") Q
"RTN","PSOHLDA",9,0)
 .S:RFN>1 RSDT=$P(^PSRX(DA,1,RXF,0),"^")
"RTN","PSOHLDA",10,0)
 I RXF D
"RTN","PSOHLDA",11,0)
 .S (PSDA,DA(1))=DA,DA=RXF,DIE="^PSRX("_DA(1)_",1,",DR="4" D ^DIE
"RTN","PSOHLDA",12,0)
 .S $P(^PSRX(DA(1),1,DA,0),"^",3)=$S($G(FLD(99.1))]"":$E(FLD(99.1),1,60),1:"")
"RTN","PSOHLDA",13,0)
 .S DA=PSDA K DA(1)
"RTN","PSOHLDA",14,0)
 S DIE="^PSRX(",DR=$S('RXF&('$P(^PSRX(DA,2),"^",13)):"22///@;",1:"")_"99///"_FLD(99)_";99.1///^S X=FLD(99.1);99.2///"_DT_";100///3;101///"_RSDT D ^DIE Q:$D(Y)
"RTN","PSOHLDA",15,0)
 S:$G(PSOHD) VALMSG="RX# "_$P(^PSRX(DA,0),"^")_" has been placed in a hold status."
"RTN","PSOHLDA",16,0)
 K RXRS(DA)
"RTN","PSOHLDA",17,0)
 I +$G(PSDA) S DA=$O(^PS(52.5,"B",PSDA,0)) I DA S:$P($G(^PS(52.5,DA,"P")),"^")=0 PSUS=1 S DIK="^PS(52.5," D ^DIK K DA,DIK
"RTN","PSOHLDA",18,0)
 S:+$G(PSDA) DA=PSDA D ACT
"RTN","PSOHLDA",19,0)
 S PSOHNX=+$P($G(^PSRX(+$G(DA),"H")),"^") D
"RTN","PSOHLDA",20,0)
 .I $G(PSOHNX),$G(PSOHNX)'=99 S COMM=$P($P($P(^DD(52,99,0),"^",3),";",PSOHNX),":",2) Q
"RTN","PSOHLDA",21,0)
 .I $G(PSOHNX)=99,$P($G(^PSRX(DA,"H")),"^",2)'="" S COMM=$P($G(^("H")),"^",2) Q
"RTN","PSOHLDA",22,0)
 .S COMM="Medication placed on Hold "_$E(DT,4,5)_"-"_$E(DT,6,7)_"-"_$E(DT,2,3)
"RTN","PSOHLDA",23,0)
 D EN^PSOHLSN1(DA,"OH","",COMM,PSONOOR) K COMM,PSOHNX
"RTN","PSOHLDA",24,0)
 ;
"RTN","PSOHLDA",25,0)
 ; - Closes any OPEN/UNRESOLVED REJECTs and Reverses ECME Claim
"RTN","PSOHLDA",26,0)
 D REVERSE^PSOBPSU1(DA,+$G(RXF),"HLD",2)
"RTN","PSOHLDA",27,0)
 Q
"RTN","PSOHLDA",28,0)
 ;
"RTN","PSOHLDA",29,0)
ACT ;adds activity info for rx removed or placed on hold
"RTN","PSOHLDA",30,0)
 D NOW^%DTC S NOW=%
"RTN","PSOHLDA",31,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOHLDA",32,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOHLDA",33,0)
 S ^PSRX(DA,"A",IR,0)=NOW_"^"_$S(ACT:"U",1:"H")_"^"_DUZ_"^"_$S(RXF>5:RXF+1,1:RXF)_"^"_"RX "_$S('ACT:"placed in a",1:"removed from")_" HOLD status "_$S(+$G(PSUS):"and removed from SUSPENSE ",1:"")_"("_$E(DT,4,5)_"-"_$E(DT,6,7)_"-"_$E(DT,2,3)_")"
"RTN","PSOHLDA",34,0)
 K PSUS,RXF,I,FDA,DIC,DIE,DR,Y,X,%,%I,%H,RSDT
"RTN","PSOHLDA",35,0)
 Q
"RTN","PSOHLDA",36,0)
 ;
"RTN","PSOHLDA",37,0)
RMP ;remove Rx if found in array PSORX("PSOL")
"RTN","PSOHLDA",38,0)
 Q:'$G(DA)
"RTN","PSOHLDA",39,0)
 N I,J,K,PSOX2,PSOX3,PSOX9 S I=0
"RTN","PSOHLDA",40,0)
 F  S I=$O(PSORX("PSOL",I)) Q:'I  S PSOX2=PSORX("PSOL",I) D:PSOX2[(DA_",")
"RTN","PSOHLDA",41,0)
 .S PSOX9="",K=0 F J=1:1 S PSOX3=$P(PSOX2,",",J) Q:'PSOX3  D
"RTN","PSOHLDA",42,0)
 ..I PSOX3=DA,$P($G(^PSRX(DA,"STA")),"^")=3 S K=1 Q
"RTN","PSOHLDA",43,0)
 ..S PSOX9=PSOX9_$S('PSOX9:"",1:",")_PSOX3
"RTN","PSOHLDA",44,0)
 .I K S:PSOX9]"" PSORX("PSOL",I)=PSOX9_"," K:PSOX9="" PSORX("PSOL",I) D:$D(BBRX(I)) RMB
"RTN","PSOHLDA",45,0)
 Q
"RTN","PSOHLDA",46,0)
RMB ;remove Rx if found in array BBRX()
"RTN","PSOHLDA",47,0)
 S PSOX2=BBRX(I) D:PSOX2[(DA_",")
"RTN","PSOHLDA",48,0)
 .S PSOX9="" F J=1:1 S PSOX3=$P(PSOX2,",",J) Q:'PSOX3  S:PSOX3'=DA PSOX9=PSOX9_$S('PSOX9:"",1:",")_PSOX3
"RTN","PSOHLDA",49,0)
 .S:PSOX9]"" BBRX(I)=PSOX9_"," K:PSOX9="" BBRX(I)
"RTN","PSOHLDA",50,0)
 Q
"RTN","PSOHLDC")
0^84^B35362366
"RTN","PSOHLDC",1,0)
PSOHLDC ;BIR/RTR-Process incoming cancel messages from CHCS ;09/06/02
"RTN","PSOHLDC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**111,121,146,223,148**;DEC 1997
"RTN","PSOHLDC",3,0)
 ;External reference to ^PSSLOCK supported by DBIA 2789
"RTN","PSOHLDC",4,0)
 ;
"RTN","PSOHLDC",5,0)
ENDC ;
"RTN","PSOHLDC",6,0)
 ;Process exceptions
"RTN","PSOHLDC",7,0)
 N DA,PSOEXINP,PSOHLINR,PSOHLSTP,PSOHLSTR,PSOHLPL,PSOHLCM,PSOCANRC,PSOCANRN,PSOHUIOR
"RTN","PSOHLDC",8,0)
 S (PSOHBDS,PSOEXXQ)=0
"RTN","PSOHLDC",9,0)
 I PSOHDFOR S PSOEXMS="Invalid message structure." D NAK^PSOHLEXC Q
"RTN","PSOHLDC",10,0)
 F PSOHMSG="MSH","PID","ORC" Q:PSOEXXQ  I '$D(PSOHLMIS(PSOHMSG)) S PSOEXMS="Missing "_PSOHMSG_" segment." S PSOHBDS=1 D NAK^PSOHLEXC
"RTN","PSOHLDC",11,0)
 I $G(PSOEXXQ) Q
"RTN","PSOHLDC",12,0)
 I $G(HL("SAN"))="" S PSOEXMS="Missing sending application name." D NAK^PSOHLEXC Q
"RTN","PSOHLDC",13,0)
 S PSOHY("EXAPP")=HL("SAN")
"RTN","PSOHLDC",14,0)
 I '$G(PSOHY("PAT"))!('$D(^DPT(+$G(PSOHY("PAT")),0))) S PSOEXMS="Invalid patient entry." D NAK^PSOHLEXC Q
"RTN","PSOHLDC",15,0)
 I $G(PSOHY("CHNUM"))="" S PSOEXMS="Missing CHCS Placer Order Number." D NAK^PSOHLEXC Q
"RTN","PSOHLDC",16,0)
 D CAN^PSOHLEXC
"RTN","PSOHLDC",17,0)
 I $G(PSOEXXQ) Q
"RTN","PSOHLDC",18,0)
 S (PSOEXINP,PSOHLINR)=0
"RTN","PSOHLDC",19,0)
 S PSOEXINP=$O(^PS(52.41,"C",PSOHY("CHNUM"),PSOHY("EXAPP"),0)) I PSOEXINP D PEND Q
"RTN","PSOHLDC",20,0)
 S PSOHLINR=$O(^PSRX("D",PSOHY("CHNUM"),PSOHY("EXAPP"),0)) I PSOHLINR D RX Q
"RTN","PSOHLDC",21,0)
 S PSOEXMS="Unable to find order in Pharmacy." D NAK^PSOHLEXC
"RTN","PSOHLDC",22,0)
 Q
"RTN","PSOHLDC",23,0)
PEND ;Process a DC message on a Pending order
"RTN","PSOHLDC",24,0)
 I PSOHY("PAT")'=$P($G(^PS(52.41,PSOEXINP,0)),"^",2) S PSOEXMS="Patient mismatch in Pending order." D NAK^PSOHLEXC Q
"RTN","PSOHLDC",25,0)
 K PSOMSG D PSOL^PSSLOCK(+PSOEXINP_"S") I '$G(PSOMSG) S PSOEXMS="Pending order is being edited by another user." D NAK^PSOHLEXC K PSOMSG Q
"RTN","PSOHLDC",26,0)
 K PSOMSG
"RTN","PSOHLDC",27,0)
 S PSOHLSTP=$P($G(^PS(52.41,PSOEXINP,0)),"^",3)
"RTN","PSOHLDC",28,0)
 I PSOHLSTP'="NW" D  D NAK^PSOHLEXC Q
"RTN","PSOHLDC",29,0)
 .S PSOEXMS="Unable to cancel Pending order, status is "_$S(PSOHLSTP="HD":"HOLD",PSOHLSTP="RNW":"RENEW",PSOHLSTP="DE":"DISCONTINUE (EDIT)",PSOHLSTP="DC":"DISCONTINUE",PSOHLSTP="RF":"REFILL REQUEST",1:"UNKNOWN")_"."
"RTN","PSOHLDC",30,0)
 S $P(^PS(52.41,PSOEXINP,0),"^",3)="DC"
"RTN","PSOHLDC",31,0)
 S PSOHLPL=$P(^PS(52.41,PSOEXINP,0),"^")
"RTN","PSOHLDC",32,0)
 K ^PS(52.41,"AOR",+$P($G(^PS(52.41,PSOEXINP,0)),"^",2),+$P($G(^PS(52.41,PSOEXINP,"INI")),"^"),PSOEXINP)
"RTN","PSOHLDC",33,0)
 S PSOHLCM="Discontinued by Provider."
"RTN","PSOHLDC",34,0)
 S $P(^PS(52.41,PSOEXINP,4),"^")=PSOHLCM
"RTN","PSOHLDC",35,0)
 D PVSET
"RTN","PSOHLDC",36,0)
 S PSOHUIOR=1
"RTN","PSOHLDC",37,0)
 I PSOHLPL D EN^PSOHLSN(PSOHLPL,"OC",PSOHLCM,"")
"RTN","PSOHLDC",38,0)
 D PSOUL^PSSLOCK(+PSOEXINP_"S")
"RTN","PSOHLDC",39,0)
 D ACK^PSOHLEXC
"RTN","PSOHLDC",40,0)
 K PSOHUIOR
"RTN","PSOHLDC",41,0)
 Q
"RTN","PSOHLDC",42,0)
RX ;Process a DC message on a prescription
"RTN","PSOHLDC",43,0)
 N PSOSUSD,PSOIFN,PSORFDT,PSOHTEST,PSOHPDA,CMOP,ACOM,PSOARECX,PSODFN
"RTN","PSOHLDC",44,0)
 S PSOARECX=0
"RTN","PSOHLDC",45,0)
 I PSOHY("PAT")'=$P($G(^PSRX(PSOHLINR,0)),"^",2) S PSOEXMS="Patient mismatch in prescription." D NAK^PSOHLEXC Q
"RTN","PSOHLDC",46,0)
 S PSODFN=$P($G(^PSRX(PSOHLINR,0)),"^",2)
"RTN","PSOHLDC",47,0)
 K PSOMSG D PSOL^PSSLOCK(PSOHLINR) I '$G(PSOMSG) S PSOEXMS="Prescription is being edited by another user." D NAK^PSOHLEXC K PSOMSG Q
"RTN","PSOHLDC",48,0)
 K PSOMSG
"RTN","PSOHLDC",49,0)
 S PSOHLSTR=$P($G(^PSRX(PSOHLINR,"STA")),"^")
"RTN","PSOHLDC",50,0)
 I PSOHLSTR>11,PSOHLSTR<16 D  D NAK^PSOHLEXC Q
"RTN","PSOHLDC",51,0)
 .S PSOEXMS="Unable to cancel prescription, status is "_$S(PSOHLSTR=12:"DISCONTINUED",PSOHLSTR=13:"DELETED",PSOHLSTR=14:"DISCONTINUED BY PROVIDER",1:"DISCONTINUED (EDIT)")_"."
"RTN","PSOHLDC",52,0)
 S (PSOHLCM,ACOM)="Discontinued by Provider."
"RTN","PSOHLDC",53,0)
 I PSOHLSTR=3!(PSOHLSTR=16) D
"RTN","PSOHLDC",54,0)
 .S (PSOHLCM,ACOM)="Discontinued by Provider while on hold." K:$P($G(^PSRX(PSOHLINR,"H")),"^") ^PSRX("AH",$P($G(^PSRX(PSOHLINR,"H")),"^"),PSOHLINR) S ^PSRX(PSOHLINR,"H")=""
"RTN","PSOHLDC",55,0)
 .I $P(^PSRX(PSOHLINR,0),"^",13),'$O(^PSRX(PSOHLINR,1,0)) S DIE=52,DR="22///"_$E($P(^PSRX(PSOHLINR,0),"^",13),1,7),DA=PSOHLINR D ^DIE K DIE,DA,DR Q
"RTN","PSOHLDC",56,0)
 .S (PSOIFN,PSOSUSD)=0,PSORFDT="" F  S PSOIFN=$O(^PSRX(PSOHLINR,1,PSOIFN)) Q:'PSOIFN  S PSOSUSD=PSOIFN,PSORFDT=$P($G(^PSRX(PSOHLINR,1,PSOIFN,0)),"^")
"RTN","PSOHLDC",57,0)
 .I $G(PSORFDT)=""!('$G(PSOSUSD)) Q
"RTN","PSOHLDC",58,0)
 .I '$P($G(^PSRX(PSOHLINR,1,PSOSUSD,0)),"^",18) S PSOHTEST=0 D  I 'PSOHTEST K ^PSRX(PSOHLINR,1,PSOSUSD),^PSRX("AD",PSORFDT,PSOHLINR,PSOSUSD),^PSRX(PSOHLINR,1,"B",PSORFDT,PSOSUSD),PSOIFN,PSOSUSD,PSORFDT
"RTN","PSOHLDC",59,0)
 ..F PSOHPDA=0:0 S PSOHPDA=$O(^PSRX(PSOHLINR,"L",PSOHPDA)) Q:'PSOHPDA  I $P($G(^PSRX(PSOHLINR,"L",PSOHPDA,0)),"^",2)=PSOSUSD S PSOHTEST=1
"RTN","PSOHLDC",60,0)
 ..K CMOP S DA=PSOHLINR D ^PSOCMOPA I $G(CMOP(CMOP("L")))="",$G(CMOP("S"))'="L" Q
"RTN","PSOHLDC",61,0)
 ..S PSOHTEST=1
"RTN","PSOHLDC",62,0)
 D SUS
"RTN","PSOHLDC",63,0)
 I '$G(PSOARECX) D ACTL
"RTN","PSOHLDC",64,0)
 S $P(^PSRX(PSOHLINR,"STA"),"^")=14,$P(^PSRX(PSOHLINR,3),"^",5)=$S($P($G(^PSRX(PSOHLINR,3)),"^"):$P(^(3),"^"),1:DT)
"RTN","PSOHLDC",65,0)
 D CAN^PSOTPCAN(PSOHLINR),REVERSE^PSOBPSU1(PSOHLINR,,"DC",7)
"RTN","PSOHLDC",66,0)
 I $O(^PS(52.41,"ARF",PSOHLINR,0)),'$O(^PS(52.41,"APSOD",PSODFN,0)) S DA=$O(^PS(52.41,"ARF",PSOHLINR,0)),DIK="^PS(52.41," D ^DIK K DIK
"RTN","PSOHLDC",67,0)
 D PVSET
"RTN","PSOHLDC",68,0)
 S PSOHUIOR=1
"RTN","PSOHLDC",69,0)
 D EN^PSOHLSN1(PSOHLINR,"OD","","Discontinued by Provider","")
"RTN","PSOHLDC",70,0)
 K PSOHUIOR
"RTN","PSOHLDC",71,0)
 I $G(^PS(52.4,PSOHLINR,0))]"" S DA=PSOHLINR,DIK="^PS(52.4," D ^DIK K DIK
"RTN","PSOHLDC",72,0)
 D PSOUL^PSSLOCK(PSOHLINR)
"RTN","PSOHLDC",73,0)
 D ACK^PSOHLEXC
"RTN","PSOHLDC",74,0)
 Q
"RTN","PSOHLDC",75,0)
SUS N RXDA,SUSDA,IFN,PSORFDEL,SUSD,RF,NODE
"RTN","PSOHLDC",76,0)
 S RXDA=PSOHLINR,(DA,SUSDA)=$O(^PS(52.5,"B",PSOHLINR,0)) D:DA
"RTN","PSOHLDC",77,0)
 .S SUSD=$P($G(^PS(52.5,DA,0)),"^",2)
"RTN","PSOHLDC",78,0)
 .S:+$G(^PS(52.5,DA,"P"))'=1 (PSOHLCM,ACOM)="Discontinued by Provider while suspended."
"RTN","PSOHLDC",79,0)
 .I $O(^PSRX(PSOHLINR,1,0)) S PSOARECX=1 D ACTL S DA=PSOHLINR D:'$G(^PS(52.5,+SUSDA,"P")) REF^PSOCAN2
"RTN","PSOHLDC",80,0)
 .I $P($G(^PS(52.5,+SUSDA,0)),"^",2),$P($G(^(0)),"^",3) S DA=SUSDA,DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOHLDC",81,0)
 Q
"RTN","PSOHLDC",82,0)
ACTL ;Add Activity log
"RTN","PSOHLDC",83,0)
 N PSORXREF,REA,PSOACNT,PSOSIBB,PSORFH,PSORFCNT
"RTN","PSOHLDC",84,0)
 S PSORXREF=0,PSODFN=+$P(^PSRX(PSOHLINR,0),"^",2) D
"RTN","PSOHLDC",85,0)
 .S PSOACNT=0 F PSOSUBB=0:0 S PSOSUBB=$O(^PSRX(PSOHLINR,"A",PSOSUBB)) Q:'PSOSUBB  S PSOACNT=PSOSUBB
"RTN","PSOHLDC",86,0)
 .S PSORFCNT=0 F PSORFH=0:0 S PSORFH=$O(^PSRX(PSOHLINR,1,PSORFH)) Q:'PSORFH  S PSORFCNT=PSORFH S:PSORFH>5 PSORFCNT=PSORFH+1
"RTN","PSOHLDC",87,0)
 .D NOW^%DTC S ^PSRX(PSOHLINR,"A",0)="^52.3DA^"_(PSOACNT+1)_"^"_(PSOACNT+1),^PSRX(PSOHLINR,"A",PSOACNT+1,0)=%_"^C^"_$G(PSOHY("PROV"))_"^"_PSORFCNT_"^"_$G(PSOHLCM)
"RTN","PSOHLDC",88,0)
 .S REA="C" S DA=PSOHLINR N EXP,PCD,IFN D EXP^PSOHELP1
"RTN","PSOHLDC",89,0)
 Q
"RTN","PSOHLDC",90,0)
PVSET ;
"RTN","PSOHLDC",91,0)
 N DIC,X,Y,USER1
"RTN","PSOHLDC",92,0)
 D USER^PSOORFI2(PSOHY("PROV"))
"RTN","PSOHLDC",93,0)
 S PSOCANRC=PSOHY("PROV"),PSOCANRN=USER1
"RTN","PSOHLDC",94,0)
 Q
"RTN","PSOHLDIS")
0^46^B68225842
"RTN","PSOHLDIS",1,0)
PSOHLDIS ;BIR/PWC,SAB - Automated Dispense Completion HL7 v.2.4 ;01/05/04
"RTN","PSOHLDIS",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**156,189,193,209,148**;DEC 1997
"RTN","PSOHLDIS",3,0)
 ;Reference to ^PSDRUG supported by DBIA #221
"RTN","PSOHLDIS",4,0)
 ;Reference to $$NDCFMT^PSSNDCUT supported by IA 4707
"RTN","PSOHLDIS",5,0)
 ;This routine is called by FACK1^PSOHLDS
"RTN","PSOHLDIS",6,0)
 K OK
"RTN","PSOHLDIS",7,0)
 F I=0:0 S I=$O(PSOMSG(I)) Q:'I  D
"RTN","PSOHLDIS",8,0)
 .I $P(PSOMSG(I),"|")="MSH" S NODE1=PSOMSG(I) Q
"RTN","PSOHLDIS",9,0)
 .I $P(PSOMSG(I),"|")="MSA" S NODE2=PSOMSG(I) Q
"RTN","PSOHLDIS",10,0)
 .I $P(PSOMSG(I),"|")="PID" S NODE3=PSOMSG(I) Q
"RTN","PSOHLDIS",11,0)
 .I $P(PSOMSG(I),"|")="ORC" S NODE4=PSOMSG(I) Q
"RTN","PSOHLDIS",12,0)
 .I $P(PSOMSG(I),"|")="RXD" S NODE5=PSOMSG(I) Q
"RTN","PSOHLDIS",13,0)
 ;PID segment
"RTN","PSOHLDIS",14,0)
 S PID=$P($G(NODE3),"|",4)   ;this contains all the patient id numbers
"RTN","PSOHLDIS",15,0)
 F XX=1:1 S PIDD=$P(PID,"^",XX) Q:PIDD=""  D
"RTN","PSOHLDIS",16,0)
 . S PIDID=$P(PIDD,"~",5)
"RTN","PSOHLDIS",17,0)
 . I PIDID="NI" S PICN=$P(PIDD,"~",1)   ;ICN #
"RTN","PSOHLDIS",18,0)
 . I PIDID="SS" S PSSN=$P(PIDD,"~",1)   ;SSN #
"RTN","PSOHLDIS",19,0)
 . I PIDID="PI" S PPID=$P(PIDD,"~",1)   ;patient ID
"RTN","PSOHLDIS",20,0)
 . I PIDID="PN" S PCLM=$P(PIDD,"~",1)   ;claim #
"RTN","PSOHLDIS",21,0)
 ;ORC segment
"RTN","PSOHLDIS",22,0)
 S RXID=$P($P($G(NODE4),"|",3),"^")    ;RX #
"RTN","PSOHLDIS",23,0)
 S DFN=$P(^PSRX(RXID,0),"^",2) D DEM^VADPT
"RTN","PSOHLDIS",24,0)
 S NAME=VADM(1),DOB=$P(VADM(3),"^"),SEX=$P(VADM(5),"^") K VADM
"RTN","PSOHLDIS",25,0)
 S FPER=$P($P($G(NODE4),"|",11),"~")   ;filling person
"RTN","PSOHLDIS",26,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+FPER D
"RTN","PSOHLDIS",27,0)
 .D ^DIC I +Y>0 S FPER=+Y,FPERN=$P(Y,"^",2) Q
"RTN","PSOHLDIS",28,0)
 .S FPER="",FPERN="UNKNOWN"
"RTN","PSOHLDIS",29,0)
 S CPHARM=$P($P($G(NODE4),"|",12),"~") ;checking pharmacist
"RTN","PSOHLDIS",30,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+CPHARM D  K DIC,X,Y
"RTN","PSOHLDIS",31,0)
 .D ^DIC I +Y>0 S CPHARM=+Y,CPHARMN=$P(Y,"^",2) Q
"RTN","PSOHLDIS",32,0)
 .S CPHARM="",CPHARMN="UNKNOWN"
"RTN","PSOHLDIS",33,0)
 ;RXD segment
"RTN","PSOHLDIS",34,0)
 S FILL=$P($P($G(NODE5),"|",2),"^")         ;fill #
"RTN","PSOHLDIS",35,0)
 S GIVECOD=$P($P($G(NODE5),"|",3),"^")      ;give code
"RTN","PSOHLDIS",36,0)
 S X=$P($P($G(NODE5),"|",4),"^"),DISPDT=$$FMDATE^HLFNC(X) K X  ;dispense date
"RTN","PSOHLDIS",37,0)
 S PSORX=$P($P($G(NODE5),"|",8),"^")        ;prescription #
"RTN","PSOHLDIS",38,0)
 S NDC=$P($P($G(NODE5),"|",10),"^")  ;NDC #
"RTN","PSOHLDIS",39,0)
 K F I NDC]"" D  K L,F
"RTN","PSOHLDIS",40,0)
 .S F=""
"RTN","PSOHLDIS",41,0)
 .F L=1:1:$L(NDC,"^") I $P(NDC,"^",L)'=""  S F=$G(F)_$P(NDC,"^",L)_$S($P(NDC,"^",(L+1))]"":",",1:"")
"RTN","PSOHLDIS",42,0)
 .S NDC=F
"RTN","PSOHLDIS",43,0)
 S X=$P($P($G(NODE5),"|",10),"^",2),RELDT=$S($$FMDATE^HLFNC(X)>0:$$FMDATE^HLFNC(X),1:"") K X  ;release dt
"RTN","PSOHLDIS",44,0)
 S PRT=$S($P($P($G(NODE5),"|",10),"^",3)=1:1,$P($P($G(NODE5),"|",10),"^",3)=2:1,1:0)  ;label printed by vendor
"RTN","PSOHLDIS",45,0)
 S MEDDISP=$S($P($P($G(NODE5),"|",10),"^",3)=1:1,$P($P($G(NODE5),"|",10),"^",3)=4:1,1:0)  ;med dispensed by vendor
"RTN","PSOHLDIS",46,0)
 S RPHARM=$P($P($G(NODE5),"|",11),"~",1)      ;releasing pharmacist
"RTN","PSOHLDIS",47,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+RPHARM D
"RTN","PSOHLDIS",48,0)
 .D ^DIC I +Y>0 S RPHARM=+Y Q
"RTN","PSOHLDIS",49,0)
 .S RPHARM=""
"RTN","PSOHLDIS",50,0)
 S LOT=$P($G(NODE5),"|",19)
"RTN","PSOHLDIS",51,0)
 I LOT]"" D  K L,F
"RTN","PSOHLDIS",52,0)
 .S F=""
"RTN","PSOHLDIS",53,0)
 .F L=1:1:$L(LOT,"^") I $P(LOT,"^",L)'=""  S F=$G(F)_$P(LOT,"^",L)_$S($P(LOT,"^",(L+1))]"":",",1:"")
"RTN","PSOHLDIS",54,0)
 .S LOT=F
"RTN","PSOHLDIS",55,0)
 S X=$P($P($G(NODE5),"|",20),"^"),EXPDT=$S($$FMDATE^HLFNC(X)>0:$$FMDATE^HLFNC(X),1:"") K X   ;expiration date
"RTN","PSOHLDIS",56,0)
 S MFG=$P($P($G(NODE5),"|",21),"^")         ;manufacturer
"RTN","PSOHLDIS",57,0)
 K F I MFG]"" D  K L,F
"RTN","PSOHLDIS",58,0)
 .F L=1:1:$L(MFG) Q:$P(MFG,"^",L)=""  S F=$G(F)_$P(MFG,"^",L)_$S($P(MFG,"^",(L+1))]"":",",1:"")
"RTN","PSOHLDIS",59,0)
 .S MFG=F
"RTN","PSOHLDIS",60,0)
 S EXRX=^PS(52.51,EIN,0)
"RTN","PSOHLDIS",61,0)
 S IRX=$P(EXRX,"^"),FLL=$P(EXRX,"^",8),FLLN=$P(EXRX,"^",9),RPT=$P(EXRX,"^",5),(DIV,PSOSITE)=$P(EXRX,"^",11),PSOPAR=$G(^PS(59,DIV,0))
"RTN","PSOHLDIS",62,0)
 S PSOPAR7=$G(^PS(59,PSOSITE,"IB")),PSOSYS=$G(^PS(59.7,1,40.1))
"RTN","PSOHLDIS",63,0)
 S RXN=$P(^PSRX(IRX,0),"^"),DRG=$P(^(0),"^",6),QTY=$P(^(0),"^",7)
"RTN","PSOHLDIS",64,0)
 I MEDDISP,FLL="F" D      ;PSO*209
"RTN","PSOHLDIS",65,0)
 .I 'FLLN D  Q            ;No fill# = orig fill
"RTN","PSOHLDIS",66,0)
 ..S $P(^PSRX(IRX,2),"^",4)=LOT,$P(^(2),"^",8)=MFG,$P(^(2),"^",11)=EXPDT,$P(^PSRX(IRX,"OR1"),"^",6)=FPER,$P(^("OR1"),"^",7)=CPHARM
"RTN","PSOHLDIS",67,0)
 ..S:$G(^PSDRUG(DRG,660.1))]"" ^PSDRUG(DRG,660.1)=^PSDRUG(DRG,660.1)-QTY
"RTN","PSOHLDIS",68,0)
 ..I $P($G(^PS(59,DIV,"DISP")),"^",2),$G(RELDT) D
"RTN","PSOHLDIS",69,0)
 ...S DIE="^PSRX(",DA=IRX,DR="31///"_RELDT_";23////"_RPHARM_";32.1///@;32.2///@" D ^DIE K DIE,DR,DA
"RTN","PSOHLDIS",70,0)
 ...I $P(^PSRX(IRX,0),"^",11)["W" S BRT="W",BNAM=$P(^PSRX(IRX,0),"^",2),BDIV=$P(^(2),"^",9) S:BDIV'="" BGRP=$P($G(^PS(59,BDIV,1)),"^",20)
"RTN","PSOHLDIS",71,0)
 ...S PSOCPRX=$P(^PSRX(IRX,0),"^"),RXP=IRX D CP^PSOCP
"RTN","PSOHLDIS",72,0)
 ...D EN^PSOHLSN1(IRX,"ZD"),AUTOREL^PSOBPSUT(IRX,FLLN,RELDT,NDC,"A",,30)
"RTN","PSOHLDIS",73,0)
 ..E  I $$NDCFMT^PSSNDCUT(NDC)'="",$$STATUS^PSOBPSUT(IRX,FLLN)="" D SAVNDC^PSONDCUT(IRX,FLLN,NDC)
"RTN","PSOHLDIS",74,0)
 .I FLLN D
"RTN","PSOHLDIS",75,0)
 ..S $P(^PSRX(IRX,1,FLLN,0),"^",6)=LOT,$P(^(0),"^",14)=MFG,$P(^(0),"^",15)=EXPDT,$P(^(1),"^",4)=FPER,$P(^(1),"^",5)=CPHARM
"RTN","PSOHLDIS",76,0)
 ..S:$G(^PSDRUG(DRG,660.1))]"" ^PSDRUG(DRG,660.1)=^PSDRUG(DRG,660.1)-$P(^PSRX(IRX,1,FLLN,0),"^",4)
"RTN","PSOHLDIS",77,0)
 ..I $P($G(^PS(59,DIV,"DISP")),"^",2),$G(RELDT) D
"RTN","PSOHLDIS",78,0)
 ...S DIE="^PSRX("_IRX_","""_1_""",",DA(1)=IRX,DA=FLLN
"RTN","PSOHLDIS",79,0)
 ...S DR="17///"_RELDT_";4////"_RPHARM D ^DIE K DIE,DR,DA
"RTN","PSOHLDIS",80,0)
 ...I $P(^PSRX(IRX,1,FLLN,0),"^",2)["W" S BRT="W",BDIV=$P(^PSRX(IRX,1,FLLN,0),"^",9),BNAM=$P(^PSRX(IRX,0),"^",2) S:BDIV'="" BGRP=$P($G(^PS(59,BDIV,1)),"^",20)
"RTN","PSOHLDIS",81,0)
 ...N YY S YY=FLLN        ;PSO*209
"RTN","PSOHLDIS",82,0)
 ...S PSOCPRX=$P(^PSRX(IRX,0),"^"),RXP=IRX D CP^PSOCP
"RTN","PSOHLDIS",83,0)
 ...D EN^PSOHLSN1(IRX,"ZD"),AUTOREL^PSOBPSUT(IRX,FLLN,RELDT,NDC,"A",,30)
"RTN","PSOHLDIS",84,0)
 ..E  I $$NDCFMT^PSSNDCUT(NDC)'="",$$STATUS^PSOBPSUT(IRX,FLLN)="" D SAVNDC^PSONDCUT(IRX,FLLN,NDC)
"RTN","PSOHLDIS",85,0)
 ;partial
"RTN","PSOHLDIS",86,0)
 I MEDDISP,FLL="P" D      ;PSO*209
"RTN","PSOHLDIS",87,0)
 .S $P(^PSRX(IRX,"P",FLLN,0),"^",6)=LOT,$P(^(0),"^",12)=NDC,$P(^PSRX(IRX,"P",FLLN,1),"^")=MFG,$P(^(1),"^",3)=FPER,$P(^(1),"^",4)=CPHARM
"RTN","PSOHLDIS",88,0)
 .S:$G(^PSDRUG(DRG,660.1))]"" ^PSDRUG(DRG,660.1)=^PSDRUG(DRG,660.1)-$P(^PSRX(IRX,"P",FLLN,0),"^",4)
"RTN","PSOHLDIS",89,0)
 .I $P($G(^PS(59,DIV,"DISP")),"^",2),$G(RELDT) D
"RTN","PSOHLDIS",90,0)
 ..S DIE="^PSRX("_IRX_","""_"P"_""",",DA(1)=IRX,DA=FLLN
"RTN","PSOHLDIS",91,0)
 ..S DR="8///"_RELDT_";.05////"_RPHARM D ^DIE K DIE,DR,DA
"RTN","PSOHLDIS",92,0)
 ..I $P(^PSRX(IRX,"P",FLLN,0),"^",2)["W" S BRT="W",BDIV=$P(^PSRX(IRX,"P",FLLN,0),"^",9),BNAM=$P(^PSRX(IRX,0),"^",2) S:BDIV'="" BGRP=$P($G(^PS(59,BDIV,1)),"^",20)
"RTN","PSOHLDIS",93,0)
 S RXF=0 F I=0:0 S I=$O(^PSRX(RXID,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOHLDIS",94,0)
 S ACL=0 F I=0:0 S I=$O(^PSRX(RXID,"A",I)) Q:'I  S ACL=(ACL+1)
"RTN","PSOHLDIS",95,0)
 D NOW^%DTC S NOW=%,ACL=ACL+1,^PSRX(RXID,"A",0)="^52.3DA^"_ACL_"^"_ACL
"RTN","PSOHLDIS",96,0)
 S ^PSRX(RXID,"A",ACL,0)=NOW_"^N^"_RPHARM_"^"_RXF_"^"_$S(MEDDISP:"External Interface Dispensing is Complete.",1:"Medication WAS NOT Dispensed through Interface!")
"RTN","PSOHLDIS",97,0)
 I MEDDISP D
"RTN","PSOHLDIS",98,0)
 .S ^PSRX(RXID,"A",ACL,2,0)="^52.34A^2^2"
"RTN","PSOHLDIS",99,0)
 .S ^PSRX(RXID,"A",ACL,2,1,0)="Filled By: "_FPERN
"RTN","PSOHLDIS",100,0)
 .S ^PSRX(RXID,"A",ACL,2,2,0)="Checking Pharmacist: "_CPHARMN
"RTN","PSOHLDIS",101,0)
 .D DRGACCT(RXID)         ;PSO*209
"RTN","PSOHLDIS",102,0)
 I PRT D
"RTN","PSOHLDIS",103,0)
 .S LBI=0 F LB=0:0 S LB=$O(^PSRX(RXID,"L",LB)) Q:'LB  S LBI=LBI+1
"RTN","PSOHLDIS",104,0)
 .S LBI=LBI+1,^PSRX(RXID,"L",0)="^52.032DA^"_LBI_"^"_LBI
"RTN","PSOHLDIS",105,0)
 .S ^PSRX(RXID,"L",LBI,0)=NOW_"^"_$S(FLL="F":FLLN,1:(99-FLLN))_"^"_"From Rx # "_$P(^PSRX(RXID,0),"^")_$S(FLL="P":" (Partial)",1:"")_$S($G(HLRPT):" (Reprint)",1:"")_" (External Interface)"_"^"_HLUSER
"RTN","PSOHLDIS",106,0)
 K ACL,I,NOW,LBI,LB,PRT,MEDDISP
"RTN","PSOHLDIS",107,0)
 I $D(BGRP),$D(BNAM),$D(BDIV) D REL
"RTN","PSOHLDIS",108,0)
 ;
"RTN","PSOHLDIS",109,0)
END K ADA,BDA,BDIV,BNGRXP,BNGSUS,BNAME,BRX,CNT1,CT,DA,DD,DIC,DIE,DIK,DIR,DO,DR,DTOUT,DUOUT,GRP,GRTP,JOES
"RTN","PSOHLDIS",110,0)
 K NAM,NDA,NFLAG,NME,ODA,PSZ,RXO,SSN,TDFN,TFLAG,TIC,TICK,TIEN,TM,TM1,TSSN,X,Y,XX,BNAM,BRT,BGRP
"RTN","PSOHLDIS",111,0)
 K Y,OK,XQADATA,SITEN,RDOM,CMOP,REQT,RTDTM,SITENUM,XQSOP,XQMSG,SITEN,NAME,XQAMSG,SITEN
"RTN","PSOHLDIS",112,0)
 K XQAROU,XQAID,RDTM,NODE1,NODE2,NODE3,NODE4,NODE5,PIDID,PIDD,PICN,PSSN,PPID,PCLM
"RTN","PSOHLDIS",113,0)
 K CPHARM,CPHARMN,FPER,FPERN,RPHARM
"RTN","PSOHLDIS",114,0)
 Q
"RTN","PSOHLDIS",115,0)
REL ;displays to bingo board
"RTN","PSOHLDIS",116,0)
 N NAM,NAME,RXO,SSN S ADA="",BRXP=RXID
"RTN","PSOHLDIS",117,0)
 F XX=0:0 S XX=$O(^PS(52.11,"B",BNAM,XX)) Q:'XX  D
"RTN","PSOHLDIS",118,0)
 .F BRX=0:0 S BRX=$O(^PS(52.11,XX,2,"B",BRX)) Q:'BRX  I BRX=BRXP S (DA,ODA)=XX
"RTN","PSOHLDIS",119,0)
 Q:'$D(DA)
"RTN","PSOHLDIS",120,0)
 I $P($G(^PS(52.11,DA,0)),"^",7)]"" Q
"RTN","PSOHLDIS",121,0)
 I $P($P($G(^PS(52.11,DA,0)),"^",5),".")'=DT S DIK="^PS(52.11," D ^DIK K DIK Q
"RTN","PSOHLDIS",122,0)
 N TM,TM1 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2)
"RTN","PSOHLDIS",123,0)
 S NM=$P(^DPT($P(^PS(52.11,DA,0),"^"),0),"^"),DR="6////"_$E(TM1_"0000",1,4)_";8////"_NM_"",DIE="^PS(52.11,"
"RTN","PSOHLDIS",124,0)
 L +^PS(52.11,DA):2 E  Q
"RTN","PSOHLDIS",125,0)
 D ^DIE L -^PS(52.11,DA) I $G(X)="" S DIK="^PS(52.11," D ^DIK K DIK Q
"RTN","PSOHLDIS",126,0)
 S RX0=^PS(52.11,DA,0),JOES=$P(RX0,"^",4),TICK=+$P($G(RX0),"^",2),GRP=$P($G(^PS(59.3,$P($G(^PS(52.11,DA,0)),"^",3),0)),"^",2)
"RTN","PSOHLDIS",127,0)
 I GRP="T",'$G(TICK) S DIK="^PS(52.11," D ^DIK K DIK
"RTN","PSOHLDIS",128,0)
 Q:'$G(DA)
"RTN","PSOHLDIS",129,0)
 S PSZ=0 I '$D(^PS(59.2,DT,0)) K DD,DIC,DO,DA S X=DT,DIC="^PS(59.2,",DIC(0)="",DINUM=X D FILE^DICN S PSZ=1 Q:Y'>0 
"RTN","PSOHLDIS",130,0)
 I PSZ=1 S DA(1)=+Y,DIC=DIC_DA(1)_",1,",(DINUM,X)=JOES,DIC(0)="",DIC("P")=$P(^DD(59.2,1,0),"^",2) K DD,DO D FILE^DICN K DIC,DA Q:Y'>0
"RTN","PSOHLDIS",131,0)
 I PSZ=0 K DD,DIC,DO,DA S DA(1)=DT,(DINUM,X)=JOES,DIC="^PS(59.2,"_DT_",1,",DIC(0)="LZ" D FILE^DICN K DIC,DA,DO
"RTN","PSOHLDIS",132,0)
 S DA=ODA D STATS1^PSOBRPRT,WTIME^PSOBING1
"RTN","PSOHLDIS",133,0)
 Q
"RTN","PSOHLDIS",134,0)
ERROR ;sends the error message back to the sending station
"RTN","PSOHLDIS",135,0)
 ;parse the data from the msh segment in order to send back the error message
"RTN","PSOHLDIS",136,0)
 ;OK=1 - segment missing
"RTN","PSOHLDIS",137,0)
 ;OK=2 - Rx does not exists
"RTN","PSOHLDIS",138,0)
 D NOW^%DTC
"RTN","PSOHLDIS",139,0)
 S REJ=$S(OK=1:"MISSING SEGMENT(S)",OK=2:"PRESCRIPTION "_$S($G(PSORX):"#: "_PSORX,1:"")_" DOES NOT EXISTS",1:"")
"RTN","PSOHLDIS",140,0)
 S ACKDATE=$P($$FMTHL7^XLFDT(%),"-",1)
"RTN","PSOHLDIS",141,0)
 S ^TMP("PSO2",$J,1)="MSH|^~\&|PSO VISTA||PSO DISPENSE||"_$G(ACKDATE)_"||RDS^013|10001|P|2.4|||NE|NE"
"RTN","PSOHLDIS",142,0)
 ;S ^TMP("PSO2",$J,2)="MFE|MUP|"_$G(J)_"|"_$G(ACKDATE)_"|"_$G(SITE)_"|CE"
"RTN","PSOHLDIS",143,0)
 ;S ^TMP("PSO2",$J,3)="ZLF|4|^"_$G(USER)_"||"_$G(REJ)
"RTN","PSOHLDIS",144,0)
 K %,ACKDATE,USER,Y,REJ,OK
"RTN","PSOHLDIS",145,0)
 Q
"RTN","PSOHLDIS",146,0)
DRGACCT(RXP) ;update Drug Accountability Package                      ;PSO*209
"RTN","PSOHLDIS",147,0)
 S RXP=+$G(RXP) Q:'RXP
"RTN","PSOHLDIS",148,0)
 N PSA,DIC,DA,X,Y,DIQ,PSODA,PSOSITE,QDRUG,JOB192 S (JOB192,PSODA)=0
"RTN","PSOHLDIS",149,0)
 ;check for Drug Acct background job
"RTN","PSOHLDIS",150,0)
 S X="PSA IV ALL LOCATIONS",DIC(0)="MZ",DIC=19.2 D ^DIC S JOB192=Y
"RTN","PSOHLDIS",151,0)
 I JOB192>0,$P($G(Y(0)),U,2)>DT D
"RTN","PSOHLDIS",152,0)
 . S PSODA=1
"RTN","PSOHLDIS",153,0)
 . S:'$P($G(^XTMP("PSA",0)),U,2) $P(^(0),U,2)=DT
"RTN","PSOHLDIS",154,0)
 I JOB192'>0 D             ;check old way of scheduling
"RTN","PSOHLDIS",155,0)
 . S X="PSA IV ALL LOCATIONS",DIC(0)="MZ",DIC=19 D ^DIC
"RTN","PSOHLDIS",156,0)
 . K DIQ,PSA S DA=+Y,DIC=19,DIQ="PSA",DR=200,DIQ(0)="IN" D EN^DIQ1
"RTN","PSOHLDIS",157,0)
 . I $G(PSA(19,DA,200,"I"))>DT D
"RTN","PSOHLDIS",158,0)
 . . S PSODA=1
"RTN","PSOHLDIS",159,0)
 . . S:'$P($G(^XTMP("PSA",0)),U,2) $P(^(0),U,2)=DT
"RTN","PSOHLDIS",160,0)
 ;drug stocked in Drug Acct Location?
"RTN","PSOHLDIS",161,0)
 S PSOSITE=+$O(^PS(59,0))
"RTN","PSOHLDIS",162,0)
 S PSODA(1)=$S($D(^PSD(58.8,+$O(^PSD(58.8,"AOP",PSOSITE,0)),1,+$P(^PSRX(RXP,0),U,6))):1,1:0)
"RTN","PSOHLDIS",163,0)
 ;if appropriate update ^XTMP("PSA", for Drug Acct
"RTN","PSOHLDIS",164,0)
 S QTY=$P($G(^PSRX(RXP,0)),"^",7)
"RTN","PSOHLDIS",165,0)
 S QDRUG=+$P($G(^PSRX(RXP,0)),"^",6)
"RTN","PSOHLDIS",166,0)
 Q:'QDRUG
"RTN","PSOHLDIS",167,0)
 I $G(PSODA),$G(PSODA(1)),'$D(^PSRX("AR",$$NOW^XLFDT,RXP,0)) S ^XTMP("PSA",PSOSITE,QDRUG,DT)=$G(^XTMP("PSA",PSOSITE,QDRUG,DT))+QTY
"RTN","PSOHLDIS",168,0)
 Q
"RTN","PSOHLEXP")
0^85^B10259031
"RTN","PSOHLEXP",1,0)
PSOHLEXP ;BIR/RTR-Auto expire prescriptions ;10/10/96
"RTN","PSOHLEXP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,22,36,73,148**;DEC 1997
"RTN","PSOHLEXP",3,0)
 ;External reference to STATUS^ORQOR2 is supported by DBIA 3458
"RTN","PSOHLEXP",4,0)
 ;
"RTN","PSOHLEXP",5,0)
EN N PSOEXRX,PSOEXCOM,PSOEXSTS,SUSD,PSOEXSTA,ZZDT,IFN,NODE,RF,PIFN,PSUSD,PRFDT,PDA,PSDTEST,ORN
"RTN","PSOHLEXP",6,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOHLEXP",7,0)
 S X1=DT,X2=-1 D C^%DTC S ZZDT=X
"RTN","PSOHLEXP",8,0)
 F PSOEXRX=0:0 S PSOEXRX=$O(^PSRX("AG",ZZDT,PSOEXRX)) Q:'PSOEXRX  D:$D(^PSRX(PSOEXRX,0))
"RTN","PSOHLEXP",9,0)
 .Q:$P($G(^PSRX(PSOEXRX,2)),"^",6)'=ZZDT
"RTN","PSOHLEXP",10,0)
 .S DA=$O(^PS(52.5,"B",PSOEXRX,0))
"RTN","PSOHLEXP",11,0)
 .I DA S SUSD=$P($G(^PS(52.5,DA,0)),"^",2) I SUSD,$P($G(^(0)),"^",3) S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOHLEXP",12,0)
 .I $D(^PS(52.4,PSOEXRX,0)) S DIK="^PS(52.4,",DA=PSOEXRX D ^DIK K DIK
"RTN","PSOHLEXP",13,0)
 .I $G(^PSRX(PSOEXRX,"H"))]"" K:$P(^PSRX(PSOEXRX,"H"),"^") ^PSRX("AH",$P(^PSRX(PSOEXRX,"H"),"^"),PSOEXRX) S ^PSRX(PSOEXRX,"H")=""
"RTN","PSOHLEXP",14,0)
 .S PSOEXSTA=$P($G(^PSRX(PSOEXRX,"STA")),"^")
"RTN","PSOHLEXP",15,0)
 .Q:PSOEXSTA=13!(PSOEXSTA="")
"RTN","PSOHLEXP",16,0)
 .I '$P($G(^PSRX(PSOEXRX,"OR1")),"^",2) D EN^PSOHLSN1(PSOEXRX,"ZC","") I $P($G(^PSRX(PSOEXRX,"OR1")),"^",2) D
"RTN","PSOHLEXP",17,0)
 ..I PSOEXSTA=12!(PSOEXSTA=14)!(PSOEXSTA=15) D EN^PSOHLSN1(PSOEXRX,"OD","","","A")
"RTN","PSOHLEXP",18,0)
 .I PSOEXSTA=11 S ORN=$P($G(^PSRX(PSOEXRX,"OR1")),"^",2) I ORN,+$$STATUS^ORQOR2(ORN)=6 D
"RTN","PSOHLEXP",19,0)
 ..S $P(^PSRX(PSOEXRX,0),"^",19)=1
"RTN","PSOHLEXP",20,0)
 ..D EN^PSOHLSN1(PSOEXRX,"SC","ZE","Prescription is expired")
"RTN","PSOHLEXP",21,0)
 .Q:PSOEXSTA>9
"RTN","PSOHLEXP",22,0)
 .S $P(^PSRX(PSOEXRX,"STA"),"^")=11
"RTN","PSOHLEXP",23,0)
 .I '$G(PSUSD) D REVERSE^PSOBPSU1(PSOEXRX,0,"DE",5,"RX EXPIRED")
"RTN","PSOHLEXP",24,0)
 .S (PIFN,PSUSD,PRFDT)=0 F  S PIFN=$O(^PSRX(PSOEXRX,1,PIFN)) Q:'PIFN  S PSUSD=PIFN,PRFDT=+$P($G(^PSRX(PSOEXRX,1,PIFN,0)),"^")
"RTN","PSOHLEXP",25,0)
 .I $G(PSUSD) I '$P($G(^PSRX(PSOEXRX,1,PSUSD,0)),"^",18) S PSDTEST=0 D  I 'PSDTEST K ^PSRX(PSOEXRX,1,PSUSD),^PSRX("AD",PRFDT,PSOEXRX,PSUSD),^PSRX(PSOEXRX,1,"B",PRFDT,PSUSD) D NSET
"RTN","PSOHLEXP",26,0)
 ..D REVERSE^PSOBPSU1(PSOEXRX,PSUSD,"DE",5,"RX EXPIRED")
"RTN","PSOHLEXP",27,0)
 ..F PDA=0:0 S PDA=$O(^PSRX(PSOEXRX,"L",PDA)) Q:'PDA  I $P($G(^PSRX(PSOEXRX,"L",PDA,0)),"^",2)=PSUSD S PSDTEST=1
"RTN","PSOHLEXP",28,0)
 ..S DA=PSOEXRX K CMOP D ^PSOCMOPA I $G(CMOP(CMOP("L")))="",$G(CMOP("S"))'="L" Q
"RTN","PSOHLEXP",29,0)
 ..S PSDTEST=1
"RTN","PSOHLEXP",30,0)
 .Q:'$P($G(^PSRX(PSOEXRX,"OR1")),"^",2)
"RTN","PSOHLEXP",31,0)
 .S $P(^PSRX(PSOEXRX,0),"^",19)=1
"RTN","PSOHLEXP",32,0)
 .S PSOEXCOM="Prescription past expiration date" D EN^PSOHLSN1(PSOEXRX,"SC","ZE",PSOEXCOM)
"RTN","PSOHLEXP",33,0)
 Q
"RTN","PSOHLEXP",34,0)
NSET ;
"RTN","PSOHLEXP",35,0)
 N PSONM,PSONMX
"RTN","PSOHLEXP",36,0)
 S PSONM="" F PSONMX=0:0 S PSONMX=$O(^PSRX(PSOEXRX,1,PSONMX)) Q:'PSONMX  S PSONM=PSONMX
"RTN","PSOHLEXP",37,0)
 S ^PSRX(PSOEXRX,1,0)="^52.1DA^"_$G(PSONM)_"^"_$G(PSONM)
"RTN","PSOHLEXP",38,0)
 Q
"RTN","PSOHLEXP",39,0)
SETUP ;
"RTN","PSOHLEXP",40,0)
 K %DT,DIC,DTOUT S DIC(0)="XZM",DIC="^DIC(19.2,",X="PSO EXPIRE PRESCRIPTIONS" D ^DIC
"RTN","PSOHLEXP",41,0)
 I +Y>0 D EDIT^XUTMOPT("PSO EXPIRE PRESCRIPTIONS") K DIC,Y,X Q
"RTN","PSOHLEXP",42,0)
 D RESCH^XUTMOPT("PSO EXPIRE PRESCRIPTIONS","","","24H","L"),EDIT^XUTMOPT("PSO EXPIRE PRESCRIPTIONS") K DIC,Y,X
"RTN","PSOHLEXP",43,0)
OUT Q
"RTN","PSOHLNEW")
0^95^B78866487
"RTN","PSOHLNEW",1,0)
PSOHLNEW ;BIR/RTR - CPRS orders ;07/21/96
"RTN","PSOHLNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,7,15,46,71,98,111,124,117,131,146,132,143,223,235,148**;DEC 1997
"RTN","PSOHLNEW",3,0)
 ;40.8-728,50-221,SC-2675,100-2219,50.7-2223,EN^ORERR-2187
"RTN","PSOHLNEW",4,0)
EN(MSG) ;
"RTN","PSOHLNEW",5,0)
 N PSODDRUG,ENTERED,LOCATION,PLACER,PSOOC,ROUTE,NATURE,PREV,ROUTING,OO,OR,STAT,ZZ,DFN,COMM,QCOUNT,OCOUNT,Q1I,QTARRAY,QTARRAY2,EE,PP,XOFLAG,PSODYSPL,PSOFILNM
"RTN","PSOHLNEW",6,0)
 N ONEFLAG,SERV,WPCT,EFFECT,PROV,PENDING,RRX,PSOLQ1I,PSOLQ1II,PSOQWX,PSOLQ1IX,PSONVA,PSOICD,PSOSCP,EEE
"RTN","PSOHLNEW",7,0)
 N OBXAR,AA,II,SIG1,FILLER,COMM,GG,FF,JJ,JJJ,CT,LIM,VAR,VAR1,QQQ,PSRNFLAG,PSRNQFLG,RCOMM,XOFLAGZ,NWFLAG,PFLAG,PSINPTR,INPTRX,PSOIBN,PSOIBY
"RTN","PSOHLNEW",8,0)
 N DSIG,PSOCHFFL,PSOCVI,PSOMO,PSOXRP,NN,LL,LLL,WPARRAY,QTVAR,POVAR,POVAR1,ORCSEG,NNN,OOO,AAA,NNNN,POLIM,NNCK,PRIOR,IPPLACER,PLACERXX,EER,PSERRPID,PSERRPV1,PSERRORC,PSOEXFLG,PSOMSORR,PDFN
"RTN","PSOHLNEW",9,0)
 S (SEND,PSOSND,OCOUNT)=0 K PSOPLC,PSOFFL,PSORSO,PSOSUSZ
"RTN","PSOHLNEW",10,0)
 F OO=0:0 S OO=$O(MSG(OO)) Q:'OO!(SEND)!(PSOSND)  D:$P(MSG(OO),"|")="PID" SPDFN I $P(MSG(OO),"|")="ORC",$P(MSG(OO),"|",2)'="NW",$P(MSG(OO),"|",2)'="XO" D
"RTN","PSOHLNEW",11,0)
 .S OR("STAT")=$P(MSG(OO),"|",2),OR("PLACE")=+$P(MSG(OO),"|",3),PLACERXX=+$P($P(MSG(OO),"|",3),";",2),OR("COMM")=$P(MSG(OO),"|",17),OR("USER")=$P(MSG(OO),"|",11) I $P(MSG(OO),"|",2)'="DE",$P(MSG(OO),"|",2)'="NA" S SEND=1 D FILL Q
"RTN","PSOHLNEW",12,0)
 .S PSOPLC=+$P(MSG(OO),"|",3),PSOFFL=+$P(MSG(OO),"|",4),PSOSND=1,PSOCHFFL=$P($P(MSG(OO),"|",4),"^")
"RTN","PSOHLNEW",13,0)
 I $G(OR("COMM"))["^" S OR("COMM")=$P(OR("COMM"),"^",5)
"RTN","PSOHLNEW",14,0)
 I PSOSND,$G(PSOCHFFL)["S",$G(OR("STAT"))="NA" D CHCS^PSOHLNE1 Q
"RTN","PSOHLNEW",15,0)
 I PSOSND,'$D(^PSRX(+$G(PSOFFL),0)) S COMM="Order was not located by Pharmacy" D EN^ORERR(COMM,.MSG) D KL Q
"RTN","PSOHLNEW",16,0)
 I PSOSND,$G(PDFN),PDFN'=+$P($G(^PSRX(+$G(PSOFFL),0)),"^",2) S COMM="Patient does not match" D EN^ORERR(COMM,.MSG) D KL Q
"RTN","PSOHLNEW",17,0)
 I PSOSND,$G(OR("STAT"))'="DE" N PSONAS S PSONAS=$S($P($G(^PSRX(PSOFFL,"OR1")),"^",2)="":1,1:0) S $P(^PSRX(PSOFFL,"OR1"),"^",2)=PSOPLC,^PSRX("APL",PSOPLC,PSOFFL)="" D:PSONAS EN^PSOHDR("PRES",PSOFFL) D KL Q
"RTN","PSOHLNEW",18,0)
 D KL
"RTN","PSOHLNEW",19,0)
 I SEND,$G(OR("STAT"))="Z@" G PURGE^PSOHLNE2
"RTN","PSOHLNEW",20,0)
 I SEND,$G(OR("STAT"))="ZF" G REF^PSOHLNE2
"RTN","PSOHLNEW",21,0)
 I SEND,$G(OR("STAT"))'="CA",$G(OR("STAT"))'="DC",$G(OR("STAT"))'="HD",$G(OR("STAT"))'="RL",$G(OR("STAT"))'="SS" S RCOMM="Invalid Order Control Code" D EN^ORERR(RCOMM,.MSG) Q
"RTN","PSOHLNEW",22,0)
 I SEND K SEND G:$G(OR("STAT"))="SS" ESTAT D EN^PSOORUTL(.OR) S PLACER=OR("PLACE"),STAT=OR("STAT"),COMM=OR("COMM") S PSOMSORR=1 D  K PSOMSORR Q
"RTN","PSOHLNEW",23,0)
 .I $G(OR("FILLER"))="" D  D ERROR^PSOHLSN Q
"RTN","PSOHLNEW",24,0)
 ..F EER=0:0 S EER=$O(MSG(EER)) Q:'EER  S:$P(MSG(EER),"|")="PV1" PSERRPV1=MSG(EER) S:$P(MSG(EER),"|")="PID" PSERRPID=MSG(EER) S:$P(MSG(EER),"|")="ORC"&($G(PSERRORC)="") PSERRORC=MSG(EER)
"RTN","PSOHLNEW",25,0)
 .I $P(OR("FILLER"),"^",2)="R" S FILLER=$P(OR("FILLER"),"^") D EN^PSOHLSN1(FILLER,STAT,$G(OR("PHARMST")),COMM) K:$G(PSOEXFLG) PSOMSORR,PLACERXX D:$G(PSOEXFLG) EN^PSOHLSN1(FILLER,"SC","ZE","") D:$G(PSOSUSZ) SUS^PSOORUT1 K PSOSUSZ Q
"RTN","PSOHLNEW",26,0)
 .D EN^PSOHLSN(PLACER,STAT,COMM) Q
"RTN","PSOHLNEW",27,0)
 D KL^PSOHLSIH S RRX=1 F ZZ=0:0 S ZZ=$O(MSG(ZZ)) Q:'ZZ  S PSOSEG=$G(MSG(ZZ)),PSOTYPE=$P(PSOSEG,"|") S PSOSEG=$E(PSOSEG,5,$L(PSOSEG)) I PSOTYPE'="NTE" D @PSOTYPE
"RTN","PSOHLNEW",28,0)
 I $G(PSRNFLAG) S PSOMO=0 D MISRN^PSOHLNE1 I $G(PSOMO) Q
"RTN","PSOHLNEW",29,0)
 S PSRNQFLG=0 I $G(PSRNFLAG),$G(PREV) D  I $G(PSRNQFLG) S RCOMM="Duplicate Renewal Request. Order rejected by Pharmacy." D EN^ORERR(RCOMM,.MSG) D RERROR^PSOHLSN D KL^PSOHLSIH Q
"RTN","PSOHLNEW",30,0)
 .I $P($G(^PSRX(PREV,"OR1")),"^",4) S PSRNQFLG=1 Q
"RTN","PSOHLNEW",31,0)
 .I $O(^PS(52.41,"AQ",PREV,0)) S PSRNQFLG=1
"RTN","PSOHLNEW",32,0)
 .I $G(XOFLAG),$G(DFN)'=$S($G(PFLAG):$P($G(^PS(52.41,+$G(PREV),0)),"^",2),1:$P($G(^PSRX(+$G(PREV),0)),"^",2)) S RCOMM="Patient mismatch on previous order." D EN^ORERR(RCOMM,.MSG) S XOFLAGZ=1 D RERROR^PSOHLSN D KL^PSOHLSIH Q
"RTN","PSOHLNEW",33,0)
 I $G(DFN)'=+$P($G(^OR(100,+$G(PLACER),0)),"^",2) G MISX^PSOHLNE1
"RTN","PSOHLNEW",34,0)
 I $G(PLACER) D NFILE
"RTN","PSOHLNEW",35,0)
 D KL^PSOHLSIH
"RTN","PSOHLNEW",36,0)
 Q
"RTN","PSOHLNEW",37,0)
ESTAT ;
"RTN","PSOHLNEW",38,0)
 D EXP^PSOHLNE1
"RTN","PSOHLNEW",39,0)
 Q
"RTN","PSOHLNEW",40,0)
MSH Q
"RTN","PSOHLNEW",41,0)
PID S DFN=+$P(PSOSEG,"|",3)
"RTN","PSOHLNEW",42,0)
 Q
"RTN","PSOHLNEW",43,0)
PV1 S LOCATION=+$P(+$P(PSOSEG,"|",3),"^")
"RTN","PSOHLNEW",44,0)
 S:'$D(^SC(LOCATION,0)) LOCATION=""
"RTN","PSOHLNEW",45,0)
 S INPTRX=0 I $G(LOCATION) S PSINPTR=$P($G(^SC(LOCATION,0)),"^",4) I PSINPTR Q
"RTN","PSOHLNEW",46,0)
 I $G(LOCATION) S INPTRX=$P($G(^SC(LOCATION,0)),"^",15)
"RTN","PSOHLNEW",47,0)
 I '$G(INPTRX) S INPTRX=$O(^DG(40.8,0))
"RTN","PSOHLNEW",48,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOHLNEW",49,0)
 S PSINPTR=+$$SITE^VASITE(DT,INPTRX)
"RTN","PSOHLNEW",50,0)
 Q
"RTN","PSOHLNEW",51,0)
DG1 S $P(PSOICD($P(PSOSEG,"|",1)),"^")=$P($P(PSOSEG,"|",3),"^")
"RTN","PSOHLNEW",52,0)
 Q
"RTN","PSOHLNEW",53,0)
ORC ;
"RTN","PSOHLNEW",54,0)
 Q:$P(PSOSEG,"|")="DE"
"RTN","PSOHLNEW",55,0)
 S:$P(PSOSEG,"|")="XO" XOFLAG=1 D ^PSOHLNE1 S:$G(PRIOR)="A" PRIOR="E" S:$G(PRIOR)="" PRIOR="R"
"RTN","PSOHLNEW",56,0)
 Q
"RTN","PSOHLNEW",57,0)
 ;
"RTN","PSOHLNEW",58,0)
RXO I $O(MSG(ZZ,0)) D ^PSOHLNE2 G RXOPS
"RTN","PSOHLNEW",59,0)
 S PSORDITE=$P($P(PSOSEG,"|"),"^",4)
"RTN","PSOHLNEW",60,0)
 S PSODDRUG=$P($P(PSOSEG,"|",10),"^",4) I $G(PSODDRUG) S:'$D(^PSDRUG(PSODDRUG,0)) PSODDRUG=""
"RTN","PSOHLNEW",61,0)
 S PSOXQTY=$P(PSOSEG,"|",11)
"RTN","PSOHLNEW",62,0)
 S PSOREFIL=$P(PSOSEG,"|",13)
"RTN","PSOHLNEW",63,0)
 S PSODYSPL=$P(PSOSEG,"|",17)
"RTN","PSOHLNEW",64,0)
RXOPS S ONEFLAG=0,WPCT=1,LL=ZZ+1
"RTN","PSOHLNEW",65,0)
 I $P($G(MSG(LL)),"|")="NTE" D
"RTN","PSOHLNEW",66,0)
 .S ONEFLAG=1,WORDP=$S($P(MSG(LL),"|",2):$P(MSG(LL),"|",2),1:$P(MSG(LL),"|",3)) S:$P(MSG(LL),"|",4)'="" WPARRAY(WORDP,WPCT)=$P(MSG(LL),"|",4) S:$P(MSG(LL),"|",4)'="" WPCT=WPCT+1 F LLL=0:0 S LLL=$O(MSG(LL,LLL)) Q:'LLL  D
"RTN","PSOHLNEW",67,0)
 ..I $G(MSG(LL,LLL))'="" S WPARRAY(WORDP,WPCT)=$G(MSG(LL,LLL)),WPCT=WPCT+1
"RTN","PSOHLNEW",68,0)
 I ONEFLAG S LL=LL+1 I $P($G(MSG(LL)),"|")="NTE" D NTE^PSOHLNE1
"RTN","PSOHLNEW",69,0)
 K WORDP
"RTN","PSOHLNEW",70,0)
 Q
"RTN","PSOHLNEW",71,0)
RXR I $P($P(PSOSEG,"|"),"^",4) S ROUTE(RRX)=$P($P(PSOSEG,"|"),"^",4) S RRX=RRX+1
"RTN","PSOHLNEW",72,0)
 Q
"RTN","PSOHLNEW",73,0)
OBX I $O(MSG(ZZ,0)) D OBXX^PSOHLNE2 G OBXNTE
"RTN","PSOHLNEW",74,0)
 S OCOUNT=OCOUNT+1
"RTN","PSOHLNEW",75,0)
 S OBXAR(OCOUNT,1)=$P(PSOSEG,"|",5)
"RTN","PSOHLNEW",76,0)
OBXNTE ;
"RTN","PSOHLNEW",77,0)
 S LL=ZZ+1,PSOBCT=2
"RTN","PSOHLNEW",78,0)
 I $P($G(MSG(LL)),"|")="NTE" D
"RTN","PSOHLNEW",79,0)
 .I $P(MSG(LL),"|",4)'="" S PSOBCT=3,OBXAR(OCOUNT,2)=$P(MSG(LL),"|",4)
"RTN","PSOHLNEW",80,0)
 .F LLL=0:0 S LLL=$O(MSG(LL,LLL)) Q:'LLL  D
"RTN","PSOHLNEW",81,0)
 ..I $P($G(MSG(LL,LLL)),"|",4)'="" S OBXAR(OCOUNT,PSOBCT)=$P(MSG(LL,LLL),"|",4),PSOBCT=PSOBCT+1
"RTN","PSOHLNEW",82,0)
 Q
"RTN","PSOHLNEW",83,0)
ZRN S PSODSC=1_"^"_$P(PSOSEG,"|",2)
"RTN","PSOHLNEW",84,0)
 I $O(MSG(ZZ,0)) F T=0:0 S T=$O(MSG(ZZ,T)) Q:'T  S PSODSC(T)=MSG(ZZ,T)
"RTN","PSOHLNEW",85,0)
 K T
"RTN","PSOHLNEW",86,0)
 Q
"RTN","PSOHLNEW",87,0)
 ;
"RTN","PSOHLNEW",88,0)
ZRX D ZRX^PSOHLNE1
"RTN","PSOHLNEW",89,0)
 Q
"RTN","PSOHLNEW",90,0)
 ;
"RTN","PSOHLNEW",91,0)
ZCL D ZCL^PSOHLNE1
"RTN","PSOHLNEW",92,0)
 Q
"RTN","PSOHLNEW",93,0)
ZSC D CP^PSOHLNE1
"RTN","PSOHLNEW",94,0)
 Q
"RTN","PSOHLNEW",95,0)
NFILE ;
"RTN","PSOHLNEW",96,0)
 I $G(PSODSC) D ^PSONVNEW Q  ;adds non-va med to #55
"RTN","PSOHLNEW",97,0)
 ;
"RTN","PSOHLNEW",98,0)
 K DD,DO,DIC S DLAYGO="52.41",DIC="^PS(52.41,",DIC(0)="L",X=PLACER,DIC("DR")="1////"_DFN_";2////"_PSOOC_";6////"_$G(EFFECT)_";12////"_$G(PSOXQTY)_";25////"_$G(PRIOR)
"RTN","PSOHLNEW",99,0)
 S DIC("DR")=DIC("DR")_";22////"_$G(PSORSO)_";22.1////"_$G(PREV)_";19////"_$G(ROUTING)_";17////"_$G(SERV)_";7////"_$G(NATURE)_";13////"_$G(PSOREFIL)_";1.1////"_$G(LOCATION)_";117////"_$G(DSIG)
"RTN","PSOHLNEW",100,0)
 D FILE^DICN K DIC,DR I Y<0 Q
"RTN","PSOHLNEW",101,0)
 S PENDING=+Y
"RTN","PSOHLNEW",102,0)
 S $P(^PS(52.41,PENDING,0),"^",4)=$S($G(ENTERED):+$G(ENTERED),1:""),$P(^(0),"^",5)=$S($G(PROV):+$G(PROV),1:""),$P(^(0),"^",8)=$S($G(PSORDITE):+$G(PSORDITE),1:""),$P(^(0),"^",9)=$S($G(PSODDRUG):+$G(PSODDRUG),1:""),$P(^(0),"^",15)=$G(ROUTE)
"RTN","PSOHLNEW",103,0)
 S ^PS(52.41,PENDING,"IBQ")=$G(PSOIBY)
"RTN","PSOHLNEW",104,0)
 I $G(PSODYSPL)'="",$E(PSODYSPL)?1A S PSODYSPL=$E(PSODYSPL,2,$L(PSODYSPL))
"RTN","PSOHLNEW",105,0)
 S $P(^PS(52.41,PENDING,"INI"),"^")=$G(PSINPTR),$P(^(0),"^",12)=$G(PSOLOG),$P(^(0),"^",22)=$G(PSODYSPL)
"RTN","PSOHLNEW",106,0)
 I $G(QCOUNT) S ^PS(52.41,PENDING,1,0)="^52.413^"_QCOUNT_"^"_QCOUNT
"RTN","PSOHLNEW",107,0)
 S PSOQWX=$G(PSODDRUG) D:'$G(PSOQWX) OID^PSOHLNE1
"RTN","PSOHLNEW",108,0)
 F PP=0:0 S PP=$O(Q1I(PP)) Q:'PP  S ^PS(52.41,PENDING,1,PP,0)=$S($G(PSOQWX)&($G(PSOLQ1II(PP))):Q1I(PP),$G(PSOQWX)&($G(PSOLQ1IX(PP))'="")&('$G(PSOLQ1II(PP))):PSOLQ1IX(PP),1:PSOLQ1I(PP))
"RTN","PSOHLNEW",109,0)
 F EE=0:0 S EE=$O(QTARRAY(EE)) Q:'EE  S ^PS(52.41,PENDING,1,EE,1)=QTARRAY(EE),^PS(52.41,PENDING,1,EE,2)=$S($G(PSOQWX)&($G(PSOLQ1II(EE))):$G(QTARRAY2(EE)),$G(PSOQWX)&($G(PSOLQ1IX(EE))'="")&('$G(PSOLQ1II(EE))):PSOLQ1IX(EE),1:$G(PSOLQ1I(EE))) D
"RTN","PSOHLNEW",110,0)
 .S $P(^PS(52.41,PENDING,1,EE,1),"^",8)=+$G(ROUTE(EE))
"RTN","PSOHLNEW",111,0)
 S:$P($G(^PS(52.41,PENDING,1,1,1)),"^",3) $P(^PS(52.41,PENDING,0),"^",18)=$E($P($G(^PS(52.41,PENDING,1,1,1)),"^",3),1,7)
"RTN","PSOHLNEW",112,0)
 D STUFF^PSOHLNE2
"RTN","PSOHLNEW",113,0)
 D ^PSOHLPII
"RTN","PSOHLNEW",114,0)
 S LL=0 I $O(WPARRAY(6,0)) F LLL=0:0 S LLL=$O(WPARRAY(6,LLL)) Q:'LLL  S LL=LL+1 S ^PS(52.41,PENDING,3,LL,0)=$G(WPARRAY(6,LLL))
"RTN","PSOHLNEW",115,0)
 I LL S ^PS(52.41,PENDING,3,0)="^52.42^"_LL_"^"_LL
"RTN","PSOHLNEW",116,0)
 S LL=0 I $O(WPARRAY(7,0)) F LLL=0:0 S LLL=$O(WPARRAY(7,LLL)) Q:'LLL  S LL=LL+1 S ^PS(52.41,PENDING,"INS1",LL,0)=$G(WPARRAY(7,LLL))
"RTN","PSOHLNEW",117,0)
 I LL S ^PS(52.41,PENDING,"INS1",0)="^^"_LL_"^"_LL_"^"_$G(DT)_"^"
"RTN","PSOHLNEW",118,0)
 I $P($G(^PS(50.7,+$G(PSORDITE),"INS")),"^")'="" S $P(^PS(52.41,PENDING,"INS"),"^",2)=$S($O(^PS(52.41,PENDING,"INS1",0)):1,1:0)
"RTN","PSOHLNEW",119,0)
 I $G(OCOUNT) S ^PS(52.41,PENDING,"OBX",0)="^52.4118A^"_OCOUNT_"^"_OCOUNT F OCOUNT=1:1:OCOUNT D
"RTN","PSOHLNEW",120,0)
 .S ^PS(52.41,PENDING,"OBX",OCOUNT,0)=$G(OBXAR(OCOUNT,1))
"RTN","PSOHLNEW",121,0)
 .D USER^PSOORFI2(+$G(PROV)) S ^PS(52.41,PENDING,"OBX",OCOUNT,1)=USER1 K USER1
"RTN","PSOHLNEW",122,0)
 .S PSOBCT=1 F LLL=2:1 Q:'$D(OBXAR(OCOUNT,LLL))  S ^PS(52.41,PENDING,"OBX",OCOUNT,2,PSOBCT,0)=OBXAR(OCOUNT,LLL),^PS(52.41,PENDING,"OBX",OCOUNT,2,0)="^^"_PSOBCT_"^"_PSOBCT_"^"_$G(DT)_"^"
"RTN","PSOHLNEW",123,0)
 D ^PSOHLPIS
"RTN","PSOHLNEW",124,0)
 K DIK S DIK="^PS(52.41,",DA=PENDING D IX^DIK
"RTN","PSOHLNEW",125,0)
 I $G(PSOOC)="RNW",$G(PREV),$D(^PSRX(+$G(PREV),0)) D EN^PSOHLSN1(PREV,"SC","ZZ","")
"RTN","PSOHLNEW",126,0)
 S PSOMSORR=1,IPPLACER=$P($G(^PS(52.41,PENDING,0)),"^") I IPPLACER D
"RTN","PSOHLNEW",127,0)
 .I '$G(XOFLAG) D EN^PSOHLSN(IPPLACER,"OK","IP") Q
"RTN","PSOHLNEW",128,0)
 .D EN^PSOHLSN(IPPLACER,"XR","IP") I $G(PFLAG) D DCP^PSOHLSN Q
"RTN","PSOHLNEW",129,0)
 .K PSOMSORR I $D(^PSRX(+$G(PREV),0)) D  D EN^PSOHLSN1(PREV,"RP","","","A")
"RTN","PSOHLNEW",130,0)
 ..S $P(^PSRX(PREV,"STA"),"^")=15,$P(^PSRX(PREV,3),"^",5)=$S($P($G(^PSRX(PREV,3)),"^"):$P(^(3),"^"),1:DT)
"RTN","PSOHLNEW",131,0)
 ..D REVERSE^PSOBPSU1(PREV,,"DC",7),CAN^PSOTPCAN(PREV),CAN^PSOUTL(PREV)
"RTN","PSOHLNEW",132,0)
 ..D CNT^PSOHLNE1
"RTN","PSOHLNEW",133,0)
 ..D:$G(^PS(52.41,PENDING,1,1,0))=""&($P($G(^PS(52.41,PENDING,1,1,1)),"^")="")&($G(^PS(52.41,PENDING,"SIG",1,0))="")
"RTN","PSOHLNEW",134,0)
 ...N FSIG,BSIG
"RTN","PSOHLNEW",135,0)
 ...I '$P($G(^PSRX(PREV,"SIG")),"^",2),$P($G(^("SIG")),"^")'="" D
"RTN","PSOHLNEW",136,0)
 ....D EN3^PSOUTLA1(PREV,70)
"RTN","PSOHLNEW",137,0)
 ....I $G(BSIG(1))'="" S ^PS(52.41,PENDING,"SIG",1,0)=$G(BSIG(1)) I $O(BSIG(1)) F EE=1:0 S EE=$O(BSIG(EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",EE,0)=$G(BSIG(EE))
"RTN","PSOHLNEW",138,0)
 ...I $P($G(^PSRX(PREV,"SIG")),"^",2),$G(^PSRX(PREV,"SIG1",1,0))'="" D
"RTN","PSOHLNEW",139,0)
 ....D FSIG^PSOUTLA("R",PREV,70)
"RTN","PSOHLNEW",140,0)
 ....I $G(FSIG(1))'="" S ^PS(52.41,PENDING,"SIG",1,0)=$G(FSIG(1)) I $O(FSIG(1)) F EE=1:0 S EE=$O(FSIG(EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",EE,0)=$G(FSIG(EE))
"RTN","PSOHLNEW",141,0)
 ...F EE=0:0 S EE=$O(^PS(52.41,PENDING,"SIG",EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",0)="^52.4124A^"_EE_"^"_EE
"RTN","PSOHLNEW",142,0)
 S (EE,EEE)=0 F  S EE=$O(PSOICD(EE)) Q:EE=""  D
"RTN","PSOHLNEW",143,0)
 .S EEE=EEE+1,^PS(52.41,PENDING,"ICD",EEE,0)=PSOICD(EE)
"RTN","PSOHLNEW",144,0)
 .S ^PS(52.41,PENDING,"ICD",0)="^52.41311PA"_U_EEE_U_EEE
"RTN","PSOHLNEW",145,0)
 Q
"RTN","PSOHLNEW",146,0)
SPDFN S PDFN=$P($G(MSG(OO)),"|",4) Q
"RTN","PSOHLNEW",147,0)
KL K PSOPLC,PSOFFL,PSOSND
"RTN","PSOHLNEW",148,0)
 Q
"RTN","PSOHLNEW",149,0)
FILL ;
"RTN","PSOHLNEW",150,0)
 S (PSOFILNM,OR("PSOFILNM"))=$P($P(MSG(OO),"|",4),"^")
"RTN","PSOHLNEW",151,0)
 Q
"RTN","PSOLLL3")
0^67^B8025943
"RTN","PSOLLL3",1,0)
PSOLLL3 ;BHAM/JLC - LASER LABELS ;11/20/02
"RTN","PSOLLL3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,161,148**;DEC 1997
"RTN","PSOLLL3",3,0)
 ;
"RTN","PSOLLL3",4,0)
 S PRCOPAY=$S('$D(PSOCPN):0,1:1)
"RTN","PSOLLL3",5,0)
PF ;PATIENT FILL DOCUMENT
"RTN","PSOLLL3",6,0)
 I $G(PSOIO("PFI"))]"" X PSOIO("PFI")
"RTN","PSOLLL3",7,0)
 D  S PSOFONT=OFONT
"RTN","PSOLLL3",8,0)
 . S OFONT=PSOFONT,PSOFONT=PSOHFONT
"RTN","PSOLLL3",9,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL for this prescription" D PRINT(T,1,1) S PSOY=PSOY+PSOYI Q
"RTN","PSOLLL3",10,0)
 . I RXF+1=(1+$P(RXY,"^",9)) S T="NO REFILLS LEFT for this prescription" D PRINT(T,1,1) S PSOY=PSOY+PSOYI Q
"RTN","PSOLLL3",11,0)
 . S T="PHONE IN OR MAIL THIS REFILL REQUEST" D PRINT(T,1,1)
"RTN","PSOLLL3",12,0)
 . S PSOFONT=OFONT,T="Follow the refill instructions provided with your prescription." D PRINT(T,0,1)
"RTN","PSOLLL3",13,0)
 . S PSOFONT=OFONT,OPSOX=PSOX,PSOX=PSOX+300,T="For Refill Call "_$P(PS,"^",3)_"-"_$P(PS,"^",4) D PRINT(T,0) S PSOX=OPSOX
"RTN","PSOLLL3",14,0)
 S T=PNM_"  "_$G(SSNPN) D PRINT(T,1)
"RTN","PSOLLL3",15,0)
 S T="Rx# "_RXN_"   " D PRINT(T,1)
"RTN","PSOLLL3",16,0)
 D STRT^PSOLLU1("SEC2",T,.L) S OPSOX=PSOX,PSOX=L($E(PSOFONT,2,99))*300+PSOX
"RTN","PSOLLL3",17,0)
 S T=DATE_"  Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),PSOY=PSOY-PSOYI D PRINT(T) S PSOX=OPSOX
"RTN","PSOLLL3",18,0)
 S T=$S($$STATUS^PSOBPSUT(RX,+RXF)'="":"3rd Party Rx",1:"") D PRINT(T,1)
"RTN","PSOLLL3",19,0)
 S T="Qty: "_$G(QTY)_"  "_$G(PSDU)_"    Days supply: "_$G(DAYS) D PRINT(T,0)
"RTN","PSOLLL3",20,0)
 S T=DRUG D PRINT(T,0)
"RTN","PSOLLL3",21,0)
 S T=$$GETNDC(RX,RXF) D PRINT(T,1)
"RTN","PSOLLL3",22,0)
 D  D PRINT(T,1)
"RTN","PSOLLL3",23,0)
 . S NOR=$P(RXY,"^",9)-RXF
"RTN","PSOLLL3",24,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL" Q
"RTN","PSOLLL3",25,0)
 . I NOR=0 S T="NO REFILLS LEFT" Q
"RTN","PSOLLL3",26,0)
 . S T="May refill "_NOR_"X by "_EXPDT
"RTN","PSOLLL3",27,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLL3",28,0)
 D PRINT(COPAYVAR)
"RTN","PSOLLL3",29,0)
 S T=$P(PS,"^")_"-"_$P(PS,"^",6) D STRT^PSOLLU1("SEC2",T,.L)
"RTN","PSOLLL3",30,0)
 S OPSOX=PSOX,PSOX=2340-(L($E(PSOFONT,2,99))*300),PSOY=PSOY-PSOYI
"RTN","PSOLLL3",31,0)
 D PRINT(T)
"RTN","PSOLLL3",32,0)
 S PSOX=OPSOX,PSOYI=PSOBYI
"RTN","PSOLLL3",33,0)
 I $G(PSOIO("SBT"))]"" X PSOIO("SBT")
"RTN","PSOLLL3",34,0)
 S X2=PSOINST_"-"_RX
"RTN","PSOLLL3",35,0)
 W X2
"RTN","PSOLLL3",36,0)
 I $G(PSOIO("EBT"))]"" X PSOIO("EBT")
"RTN","PSOLLL3",37,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL3",38,0)
 Q
"RTN","PSOLLL3",39,0)
PRINT(T,BOLD,HDR) ;
"RTN","PSOLLL3",40,0)
 S BOLD=+$G(BOLD),HDR=+$G(HDR)
"RTN","PSOLLL3",41,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL3",42,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL3",43,0)
 I HDR D
"RTN","PSOLLL3",44,0)
 . S OPSOX=PSOX D STRT^PSOLLU1("SEC2",T,.L)
"RTN","PSOLLL3",45,0)
 . S PSOX=4.2-L($E(PSOFONT,2,99))*300/2+OPSOX
"RTN","PSOLLL3",46,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL3",47,0)
 W T,!
"RTN","PSOLLL3",48,0)
 I HDR S PSOX=OPSOX
"RTN","PSOLLL3",49,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL3",50,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL3",51,0)
 Q
"RTN","PSOLLL3",52,0)
GETNDC(RX,RFL) ; Returns the Rx NDC #
"RTN","PSOLLL3",53,0)
 ; Input:  (r) RX - Rx IEN (#52)
"RTN","PSOLLL3",54,0)
 ;         (o) RFL - Refill #
"RTN","PSOLLL3",55,0)
 ; Output:     NDC - Rx NDC #
"RTN","PSOLLL3",56,0)
 N NDC,I S NDC=""
"RTN","PSOLLL3",57,0)
 I '$D(RFL) D
"RTN","PSOLLL3",58,0)
 . S (RFL,I)=0 F  S I=$O(^PSRX(RX,1,I)) Q:'I  S RFL=I
"RTN","PSOLLL3",59,0)
 I RFL S NDC=$$GET1^DIQ(52.1,RFL_","_RX,11)
"RTN","PSOLLL3",60,0)
 I 'RFL!(NDC="") S NDC=$$GET1^DIQ(52,RX,27)
"RTN","PSOLLL3",61,0)
 Q NDC
"RTN","PSOLLLH")
0^93^B23086524
"RTN","PSOLLLH",1,0)
PSOLLLH ;BIR/EJW - HIPAA/NCPDP LASER LABELS ;11/3/2004
"RTN","PSOLLLH",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**161,148**;DEC 1997
"RTN","PSOLLLH",3,0)
 ;
"RTN","PSOLLLH",4,0)
 ;Reference to DUR1^BPSNCPD3 supported by DBIA 4560
"RTN","PSOLLLH",5,0)
SIGLOG N I,J,RXF,RXY,RXN,RX,FIRST,DATE,BLNKLIN,RX2,FDT,BLNKLN2,LAST
"RTN","PSOLLLH",6,0)
 D DEM^VADPT
"RTN","PSOLLLH",7,0)
 S FIRST=1,LAST=0
"RTN","PSOLLLH",8,0)
 S $P(BLNKLN2," ",37)=" "
"RTN","PSOLLLH",9,0)
 S $P(BLNKLIN,"_",32)="_"
"RTN","PSOLLLH",10,0)
 F I=1:1:$L(PPL,",") S RX=$P(PPL,",",I) D
"RTN","PSOLLLH",11,0)
 .I RX="" Q
"RTN","PSOLLLH",12,0)
 .S RXY=$G(^PSRX(RX,0)) I RXY="" Q
"RTN","PSOLLLH",13,0)
 .S RX2=$G(^PSRX(RX,2)),FDT=$P(RX2,"^",2)
"RTN","PSOLLLH",14,0)
 .I FIRST!(I#4=1) D HDR S FIRST=0
"RTN","PSOLLLH",15,0)
 .S RXF=+$O(^PSRX(RX,1,"A"),-1)
"RTN","PSOLLLH",16,0)
 .I RXF>0 I +^PSRX(RX,1,RXF,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLH",17,0)
 .S DATE=$E(FDT,1,7),Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSOLLLH",18,0)
 .S RXN=$P(RXY,"^")
"RTN","PSOLLLH",19,0)
 .S T="Rx# "_RXN_"  "
"RTN","PSOLLLH",20,0)
 .S T=T_DATE_"  "_"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9))_"   _____" D PRINT(T)
"RTN","PSOLLLH",21,0)
 S LAST=1 D SIGN
"RTN","PSOLLLH",22,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PSOLLLH",23,0)
 Q
"RTN","PSOLLLH",24,0)
 ;
"RTN","PSOLLLH",25,0)
SIGN ;
"RTN","PSOLLLH",26,0)
 N II
"RTN","PSOLLLH",27,0)
 S II=I#4
"RTN","PSOLLLH",28,0)
 I LAST,II>0 F J=1:1:(4-II) S T=" " D PRINT(T)
"RTN","PSOLLLH",29,0)
 S PSOY=PSOY+10
"RTN","PSOLLLH",30,0)
 S T="Pt. Sig."_BLNKLIN D PRINT(T)
"RTN","PSOLLLH",31,0)
 S PSOY=PSOY+5
"RTN","PSOLLLH",32,0)
 D PRINT($$PLANNM())
"RTN","PSOLLLH",33,0)
 S PSOY=PSOY+15
"RTN","PSOLLLH",34,0)
 S T="Relationship_________________ Counseled? _____" D PRINT(T)
"RTN","PSOLLLH",35,0)
 S PSOY=PSOY+10
"RTN","PSOLLLH",36,0)
 S T=PNM_"  "_$G(SSNP) D PRINT(T,1)
"RTN","PSOLLLH",37,0)
 Q
"RTN","PSOLLLH",38,0)
 ;
"RTN","PSOLLLH",39,0)
HDR ;
"RTN","PSOLLLH",40,0)
 I 'FIRST D SIGN W @IOF
"RTN","PSOLLLH",41,0)
 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSOLLLH",42,0)
 S T="VAMC "_$P(PS,"^",7)_", "_STATE_" "_$G(PSOHZIP) D PRINT(T)
"RTN","PSOLLLH",43,0)
 S T=$P(PS2,"^",2)_"  "_TECH_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4) D PRINT(T)
"RTN","PSOLLLH",44,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSOLLLH",45,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLLH",46,0)
 N REPMSG
"RTN","PSOLLLH",47,0)
 S REPMSG=BLNKLN2_"(REPRINT)"
"RTN","PSOLLLH",48,0)
 S T="By signing below"_$S($G(REPRINT):REPMSG,1:"") D PRINT(T,1)
"RTN","PSOLLLH",49,0)
 S T="you acknowledge receipt of the following Rx's" D PRINT(T,1)
"RTN","PSOLLLH",50,0)
 S T=" " D PRINT(T)
"RTN","PSOLLLH",51,0)
 S PSOY=PSOY-20
"RTN","PSOLLLH",52,0)
 Q
"RTN","PSOLLLH",53,0)
 ;
"RTN","PSOLLLH",54,0)
PRINT(T,B) ;
"RTN","PSOLLLH",55,0)
 S BOLD=$G(B)
"RTN","PSOLLLH",56,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLLH",57,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLLH",58,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLLH",59,0)
 W T,!
"RTN","PSOLLLH",60,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLLH",61,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLLH",62,0)
 Q
"RTN","PSOLLLH",63,0)
 ;
"RTN","PSOLLLH",64,0)
QUEUE ; ENTRY POINT TO PRINT STAND-ALONE MULTI-RX FORM
"RTN","PSOLLLH",65,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) Q
"RTN","PSOLLLH",66,0)
 N REPRINT,PS,STATE,PS2,PSOHZIP,TECH
"RTN","PSOLLLH",67,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLLH",68,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLH",69,0)
 I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLLH",70,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLLH",71,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLLH",72,0)
 D 6^VADPT,PID^VADPT6 S SSNP=$E($G(VA("PID")),5,12)
"RTN","PSOLLLH",73,0)
 S REPRINT=1
"RTN","PSOLLLH",74,0)
LRP W !! S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")<10",DIC="^PSRX(",DIC("A")="Reprint Signature Log for Prescription: ",DIC(0)="QEAZ" D ^DIC K P,DIC("A") I Y<0!("^"[X) D KILL Q
"RTN","PSOLLLH",75,0)
 W !
"RTN","PSOLLLH",76,0)
 S (PPL,RX)=+Y
"RTN","PSOLLLH",77,0)
 N RXY
"RTN","PSOLLLH",78,0)
 S RXY=$G(^PSRX(RX,0)) I RXY="" Q
"RTN","PSOLLLH",79,0)
 S TECH=$P($G(^VA(200,+$P(RXY,"^",16),0)),"^")
"RTN","PSOLLLH",80,0)
 S DFN=$P(RXY,"^",2)
"RTN","PSOLLLH",81,0)
GETPT2 D DEM^VADPT S PNM=VADM(1)
"RTN","PSOLLLH",82,0)
 I $P(VADM(6),"^",2)]"" D  G LRP
"RTN","PSOLLLH",83,0)
 .W $C(7),!!,PNM_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSOLLLH",84,0)
Q1 W ! K POP,ZTSK S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A")
"RTN","PSOLLLH",85,0)
 I $G(POP) Q
"RTN","PSOLLLH",86,0)
 I $G(IOST(0)),'$D(^%ZIS(2,IOST(0),55,"B","LL")) W !,"Must specify a laser labels printer for Signature Log Reprint" G Q1
"RTN","PSOLLLH",87,0)
 I '$G(IOST(0)) W !,"Nothing queued to print." H 1 Q
"RTN","PSOLLLH",88,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y
"RTN","PSOLLLH",89,0)
 F G="PPL","REPRINT","TECH","PNM","STATE","PS2","PSOHZIP","PSOPAR","PSOSITE","PS","PSONOW","PSOSYS","RX","SSNP" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOLLLH",90,0)
 S ZTRTN="DQ^PSOLLLH",ZTIO=PSLION,ZTDESC="Outpatient Pharmacy Signature Log Reprint",ZTDTH=$H,PDUZ=DUZ
"RTN","PSOLLLH",91,0)
 D ^%ZISC,^%ZTLOAD W:$D(ZTSK) !!,"Signature Log Reprint queued",!! H 1 K G
"RTN","PSOLLLH",92,0)
 G QUEUE
"RTN","PSOLLLH",93,0)
 Q
"RTN","PSOLLLH",94,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLH",95,0)
 I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLLH",96,0)
 G SIGLOG
"RTN","PSOLLLH",97,0)
 ;
"RTN","PSOLLLH",98,0)
PLANNM() ; Returns Insurance Name (3rd Party)
"RTN","PSOLLLH",99,0)
 S PLANNM=""
"RTN","PSOLLLH",100,0)
 N I,DUR,RX
"RTN","PSOLLLH",101,0)
 F I=1:1:$L(PPL,",") S RX=+$P(PPL,",",I) D  I PLANNM'="" Q
"RTN","PSOLLLH",102,0)
 .I 'RX Q
"RTN","PSOLLLH",103,0)
 .D DUR1^BPSNCPD3(RX,$$LSTRFL^PSOBPSU1(RX),.DUR) S PLANNM=$G(DUR(1,"INSURANCE NAME"))
"RTN","PSOLLLH",104,0)
 Q PLANNM
"RTN","PSOLLLH",105,0)
KILL ; CLEAN UP VARIABLES
"RTN","PSOLLLH",106,0)
 K DIC,DFN,PNM,PPL,PSZIP,RX,SSNP,VA,VADDR1,VADM,VAEL,VAPA,VASTREET
"RTN","PSOLLLH",107,0)
 Q
"RTN","PSOLMUTL")
0^47^B9324541
"RTN","PSOLMUTL",1,0)
PSOLMUTL ;BIR/SAB - listman utilities ;03/07/95
"RTN","PSOLMUTL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**19,46,84,99,131,132,148**;DEC 1997
"RTN","PSOLMUTL",3,0)
 ;External reference FULL^VALM1 supported by dbia 10116
"RTN","PSOLMUTL",4,0)
 ;External reference $$SETSTR^VALM1 supported by dbia 10116
"RTN","PSOLMUTL",5,0)
 ;External reference EN2^GMRAPEMO supported by dbia 190
"RTN","PSOLMUTL",6,0)
 ;External reference to ^ORD(101 supported by DBIA 872
"RTN","PSOLMUTL",7,0)
 ;
"RTN","PSOLMUTL",8,0)
EN W @IOF S VALMCNT=0
"RTN","PSOLMUTL",9,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) W $C(7),!!?5,"Site parameter must be defined!",! G INITQ
"RTN","PSOLMUTL",10,0)
 D EN^PSOLMPI
"RTN","PSOLMUTL",11,0)
INITQ Q
"RTN","PSOLMUTL",12,0)
HDR ;patient med profile display
"RTN","PSOLMUTL",13,0)
 K VALMHDR S HDR=^TMP("PSOHDR",$J,1,0)
"RTN","PSOLMUTL",14,0)
 S:^TMP("PSOHDR",$J,8,0) X=IORVON_"<A>"_IORVOFF,HDR=$$SETSTR^VALM1(X,HDR,80-$L(X),80) S VALMHDR(1)=HDR
"RTN","PSOLMUTL",15,0)
 S HDR="  PID: "_^TMP("PSOHDR",$J,2,0)
"RTN","PSOLMUTL",16,0)
 S VALMHDR(2)=$$SETSTR^VALM1("Ht(cm): "_^TMP("PSOHDR",$J,7,0),HDR,52,27)
"RTN","PSOLMUTL",17,0)
 S HDR="  DOB: "_^TMP("PSOHDR",$J,3,0)_" ("_^TMP("PSOHDR",$J,4,0)_")"
"RTN","PSOLMUTL",18,0)
 S VALMHDR(3)=$$SETSTR^VALM1(" Wt(kg): "_^TMP("PSOHDR",$J,6,0),HDR,51,28)
"RTN","PSOLMUTL",19,0)
 S HDR="  SEX: "_$E(^TMP("PSOHDR",$J,5,0),1,44)
"RTN","PSOLMUTL",20,0)
 S VALMHDR(4)=HDR
"RTN","PSOLMUTL",21,0)
 S $P(VALMHDR(4)," ",30)="  "_$E(^TMP("PSOHDR",$J,5,0),48,80)
"RTN","PSOLMUTL",22,0)
 Q:$G(PS)="VIEW"!($G(PS)="DELETE")
"RTN","PSOLMUTL",23,0)
 S VALMHDR(5)=$G(^TMP("PSOHDR",$J,9,0))
"RTN","PSOLMUTL",24,0)
 S VALMHDR(6)=$G(^TMP("PSOHDR",$J,10,0))
"RTN","PSOLMUTL",25,0)
 Q
"RTN","PSOLMUTL",26,0)
 ;
"RTN","PSOLMUTL",27,0)
NEWALL(DFN) ; Enter Allergy info.
"RTN","PSOLMUTL",28,0)
 N PSOID D FULL^VALM1,EN2^GMRAPEM0,^PSOORUT2 S VALMBCK="R"
"RTN","PSOLMUTL",29,0)
 Q
"RTN","PSOLMUTL",30,0)
NEWSEL ;allows order selection by number instead of action
"RTN","PSOLMUTL",31,0)
 S Y=$P(XQORNOD(0),"=",2) N VALMCNT D NEWSEL^PSOORNE2
"RTN","PSOLMUTL",32,0)
 Q
"RTN","PSOLMUTL",33,0)
EDTSEL ;allows edit selection by number instead of action - active orders
"RTN","PSOLMUTL",34,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOOREDT
"RTN","PSOLMUTL",35,0)
 Q
"RTN","PSOLMUTL",36,0)
SELAL ;selection of allergy by number instead of action - select allergy
"RTN","PSOLMUTL",37,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D SELAL^PSOORDA
"RTN","PSOLMUTL",38,0)
 Q
"RTN","PSOLMUTL",39,0)
EDTNEW ;allows edit selection by number instead of action - new orders
"RTN","PSOLMUTL",40,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOORNE1
"RTN","PSOLMUTL",41,0)
 Q
"RTN","PSOLMUTL",42,0)
EDTRNEW ;allows edit selection by number instead of action - renew orders
"RTN","PSOLMUTL",43,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2) D EDTSEL^PSOORNE4
"RTN","PSOLMUTL",44,0)
 Q
"RTN","PSOLMUTL",45,0)
EDTPEN ;allows edit selection by number instead of action - pending orders
"RTN","PSOLMUTL",46,0)
 N VALMCNT S Y=$P(XQORNOD(0),"=",2),SEDT=1 G EDTSEL^PSOORNEW
"RTN","PSOLMUTL",47,0)
 Q
"RTN","PSOLMUTL",48,0)
HLDHDR ;keeps patient's header info
"RTN","PSOLMUTL",49,0)
 S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSOLMUTL",50,0)
 Q
"RTN","PSOLMUTL",51,0)
 ;
"RTN","PSOLMUTL",52,0)
BYPASS S:$G(PSOFDR) SIGOK=1 S Y=-1,VALMBCK="Q"
"RTN","PSOLMUTL",53,0)
 Q
"RTN","PSOLMUTL",54,0)
ACTIONS() ;screen actions on active orders
"RTN","PSOLMUTL",55,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",56,0)
 N DIC,X,Y K DIC,Y S DIC="^ORD(101,"_DA(1)_",10,",X=DA,DIC(0)="ZN" D ^DIC Q:Y<0 0
"RTN","PSOLMUTL",57,0)
 S Y=Y(0,0)
"RTN","PSOLMUTL",58,0)
 I Y="PSO REFILL" Q $S(PSOACT["R":1,1:0)
"RTN","PSOLMUTL",59,0)
 I Y="PSO RENEW" Q $S(PSOACT["N":1,1:0)
"RTN","PSOLMUTL",60,0)
 I Y="PSO REPRINT" Q $S(PSOACT["P":1,1:0)
"RTN","PSOLMUTL",61,0)
 I Y="PSO EDIT ORDERS" Q $S(PSOACT["E":1,1:0)
"RTN","PSOLMUTL",62,0)
 I Y="PSO RELEASE" Q $S(PSOACT["L":1,1:0)
"RTN","PSOLMUTL",63,0)
 I Y="PSO PARTIAL" Q $S(PSOACT["T":1,1:0)
"RTN","PSOLMUTL",64,0)
 I Y="PSO CANCEL" Q $S(PSOACT["D":1,1:0)
"RTN","PSOLMUTL",65,0)
 I Y="PSO HOLD" Q $S(PSOACT["H":1,1:0)
"RTN","PSOLMUTL",66,0)
 I Y="PSO UNHOLD" Q $S(PSOACT["U":1,1:0)
"RTN","PSOLMUTL",67,0)
 I Y="PSO LM BACKDOOR COPY" Q $S(PSOACT["C":1,1:0)
"RTN","PSOLMUTL",68,0)
 I Y="PSO VERIFY" Q $S(PSOACT["V":1,1:0)
"RTN","PSOLMUTL",69,0)
 I Y="PSO ACTIVITY LOGS" Q 1
"RTN","PSOLMUTL",70,0)
 Q 1
"RTN","PSOLMUTL",71,0)
ACTIONS1() ;screen actions on pending orders
"RTN","PSOLMUTL",72,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",73,0)
 N DIC,X,Y K DIC,Y S DIC="^ORD(101,"_DA(1)_",10,",X=DA,DIC(0)="ZN" D ^DIC Q:Y<0 0
"RTN","PSOLMUTL",74,0)
 S Y=Y(0,0)
"RTN","PSOLMUTL",75,0)
 I Y="PSO LM DISCONTINUE" Q $S(PSOACT["D":1,1:0)
"RTN","PSOLMUTL",76,0)
 I Y="PSO LM EDIT" Q $S(PSOACT["E":1,1:0)
"RTN","PSOLMUTL",77,0)
 I Y="PSO LM FINISH" Q $S(PSOACT["F":1,1:0)
"RTN","PSOLMUTL",78,0)
 Q 1
"RTN","PSOLMUTL",79,0)
PKIACT() ;screen actions on pending orders DEA/PKI proj.
"RTN","PSOLMUTL",80,0)
 Q:$G(PKI1)=2 0
"RTN","PSOLMUTL",81,0)
 Q 1
"RTN","PSOMAUEX")
0^86^B21036438
"RTN","PSOMAUEX",1,0)
PSOMAUEX ;BIR/SAB-Auto expire of prescriptions ;10/10/96
"RTN","PSOMAUEX",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**40,73,139,148**;DEC 1997
"RTN","PSOMAUEX",3,0)
 ;External reference to ^PS(59.7 is supported by DBIA 694
"RTN","PSOMAUEX",4,0)
 ;External reference to STATUS^ORQOR2 is supported by DBIA 3458
"RTN","PSOMAUEX",5,0)
 ;
"RTN","PSOMAUEX",6,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOMAUEX",7,0)
 W @IOF,!!?10," ******* Auto Expire of Prescriptions *******"
"RTN","PSOMAUEX",8,0)
 W !!,"You need to run this job only if expired prescriptions are showing up as active"
"RTN","PSOMAUEX",9,0)
 W !,"orders on the Orders tab in CPRS. This could be due to the following:"
"RTN","PSOMAUEX",10,0)
 W !,"1. The Expire Prescriptions [PSO EXPIRE PRESCRIPTIONS] option was not"
"RTN","PSOMAUEX",11,0)
 W !,"   queued as a daily task.       *****  AND *****"
"RTN","PSOMAUEX",12,0)
 W !,"2. Those patient's prescription(s) were never being accessed/viewed in"
"RTN","PSOMAUEX",13,0)
 W !,"   Patient Prescription Processing [PSO LM BACKDOOR ORDERS] option.",!
"RTN","PSOMAUEX",14,0)
 W !,"*******************************************************************************"
"RTN","PSOMAUEX",15,0)
 W !,"* For sites that have not queued the Expire Prescriptions job on their        *"
"RTN","PSOMAUEX",16,0)
 W !,"* daily task schedule, you  should do so by selecting the Queue Background    *"
"RTN","PSOMAUEX",17,0)
 W !,"* Jobs [PSO AUTOQUEUE JOBS] option from the Maintenance (Outpatient Pharmacy) *"
"RTN","PSOMAUEX",18,0)
 W !,"* [PSO MAINTENANCE] option and in the Edit Option Schedule template make an   *"
"RTN","PSOMAUEX",19,0)
 W !,"* entry for Expire Prescriptions [PSO EXPIRE PRESCRIPTIONS] option and        *"
"RTN","PSOMAUEX",20,0)
 W !,"* schedule it to run daily.                                                   *"
"RTN","PSOMAUEX",21,0)
 W !,"*******************************************************************************"
"RTN","PSOMAUEX",22,0)
 W !!
"RTN","PSOMAUEX",23,0)
 S ZZIDT=$S($P($G(^PS(59.7,1,49.99)),"^",7):$P(^PS(59.7,1,49.99),"^",7),1:$P($G(^PS(59.7,1,49.99)),"^",4))
"RTN","PSOMAUEX",24,0)
 I 'ZZIDT D  Q  ; V7.0 inst. dt not found, quit this job
"RTN","PSOMAUEX",25,0)
 .W !!!,"***** Outpatient installation date was not found, *****"
"RTN","PSOMAUEX",26,0)
 .W !,"***** therefore this job cannot be run!!!!!       *****",!!
"RTN","PSOMAUEX",27,0)
 ;
"RTN","PSOMAUEX",28,0)
 ; - Ask for START DATE
"RTN","PSOMAUEX",29,0)
 K %DT S %DT(0)=-DT,%DT="AEP",%DT("A")="Start Date: "
"RTN","PSOMAUEX",30,0)
 S %DT("B")=$$FMTE^XLFDT($$FMADD^XLFDT(ZZIDT\1-121))
"RTN","PSOMAUEX",31,0)
 W ! D ^%DT I Y<0!($D(DTOUT)) Q
"RTN","PSOMAUEX",32,0)
 S ZZIDT=Y
"RTN","PSOMAUEX",33,0)
 ;
"RTN","PSOMAUEX",34,0)
 K %DT D NOW^%DTC S %DT="RAEX",%DT(0)=%,%DT("A")="Select the Date/Time to queue this job: "
"RTN","PSOMAUEX",35,0)
 W ! D ^%DT K %DT I $D(DTOUT)!(Y<0) W !!!?10,"Job not queued!" Q
"RTN","PSOMAUEX",36,0)
 S ZTDTH=$G(Y),ZTSAVE("ZZIDT")="",ZTIO="",ZTRTN="EN^PSOMAUEX",ZTDESC="Auto expire of Rxs "
"RTN","PSOMAUEX",37,0)
 D ^%ZTLOAD
"RTN","PSOMAUEX",38,0)
 W:$D(ZTSK) !!,"Task Queued !",!
"RTN","PSOMAUEX",39,0)
 Q
"RTN","PSOMAUEX",40,0)
EN S X1=ZZIDT,X2=-121 D C^%DTC S ZZDT=X  ;setting the start date to 120 days before the install date
"RTN","PSOMAUEX",41,0)
 S X1=DT,X2=-1 D C^%DTC S CDT=X  ; setting the end date to todate-1
"RTN","PSOMAUEX",42,0)
 F  S ZZDT=$O(^PSRX("AG",ZZDT)) Q:'ZZDT!(ZZDT>CDT)  D EN1
"RTN","PSOMAUEX",43,0)
 K PSOEXRX,PSOEXSTA,ZZIDT,ZZDT,CDT,ORN,PIFN,PSUSD,PRFDT,PDA,PSDTEST S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOMAUEX",44,0)
 Q
"RTN","PSOMAUEX",45,0)
EN1 ;
"RTN","PSOMAUEX",46,0)
 F PSOEXRX=0:0 S PSOEXRX=$O(^PSRX("AG",ZZDT,PSOEXRX)) Q:'PSOEXRX  D
"RTN","PSOMAUEX",47,0)
 .Q:$P($G(^PSRX(PSOEXRX,2)),"^",6)'=ZZDT
"RTN","PSOMAUEX",48,0)
 .I $D(^PSRX(PSOEXRX,0)) D EN2
"RTN","PSOMAUEX",49,0)
 Q
"RTN","PSOMAUEX",50,0)
EN2 ;
"RTN","PSOMAUEX",51,0)
 S DA=$O(^PS(52.5,"B",PSOEXRX,0))
"RTN","PSOMAUEX",52,0)
 I DA,$P($G(^PS(52.5,DA,0)),"^",2),$P($G(^(0)),"^",3) S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOMAUEX",53,0)
 I $D(^PS(52.4,PSOEXRX,0)) S DIK="^PS(52.4,",DA=PSOEXRX D ^DIK K DIK
"RTN","PSOMAUEX",54,0)
 I $G(^PSRX(PSOEXRX,"H"))]"" K:$P(^PSRX(PSOEXRX,"H"),"^") ^PSRX("AH",$P(^PSRX(PSOEXRX,"H"),"^"),PSOEXRX) S ^PSRX(PSOEXRX,"H")=""
"RTN","PSOMAUEX",55,0)
 S PSOEXSTA=$P($G(^PSRX(PSOEXRX,"STA")),"^")
"RTN","PSOMAUEX",56,0)
 I PSOEXSTA=11 D
"RTN","PSOMAUEX",57,0)
 .S $P(^PSRX(PSOEXRX,0),"^",19)=1
"RTN","PSOMAUEX",58,0)
 .S ORN=$P($G(^PSRX(PSOEXRX,"OR1")),"^",2)
"RTN","PSOMAUEX",59,0)
 .I ORN,+$$STATUS^ORQOR2(ORN)=6 D
"RTN","PSOMAUEX",60,0)
 ..D EN^PSOHLSN1(PSOEXRX,"SC","ZE","Prescription is expired")
"RTN","PSOMAUEX",61,0)
 I (PSOEXSTA="")!(PSOEXSTA>9) Q
"RTN","PSOMAUEX",62,0)
 ;
"RTN","PSOMAUEX",63,0)
 ;get only those Rxs whoes status lies within 0 & 9
"RTN","PSOMAUEX",64,0)
 I PSOEXSTA?1N,+$P($G(^PSRX(PSOEXRX,2)),"^",6),+$P($G(^(2)),"^",6)<DT D
"RTN","PSOMAUEX",65,0)
 .S $P(^PSRX(PSOEXRX,"STA"),"^")=11
"RTN","PSOMAUEX",66,0)
 .I $P($G(^PSRX(PSOEXRX,"OR1")),"^",2) D
"RTN","PSOMAUEX",67,0)
 ..D EN^PSOHLSN1(PSOEXRX,"SC","ZE","Prescription past expiration date")
"RTN","PSOMAUEX",68,0)
 .S (PIFN,PSUSD,PRFDT)=0
"RTN","PSOMAUEX",69,0)
 .F  S PIFN=$O(^PSRX(PSOEXRX,1,PIFN)) Q:'PIFN  S PSUSD=PIFN,PRFDT=+$P($G(^PSRX(PSOEXRX,1,PIFN,0)),"^")
"RTN","PSOMAUEX",70,0)
 .D REVERSE^PSOBPSU1(PSOEXRX,+PSUSD,"DE",5,"RX EXPIRED")
"RTN","PSOMAUEX",71,0)
 .I $G(PSUSD),'$P($G(^PSRX(PSOEXRX,1,PSUSD,0)),"^",18) D EN3
"RTN","PSOMAUEX",72,0)
 Q
"RTN","PSOMAUEX",73,0)
EN3 ;
"RTN","PSOMAUEX",74,0)
 S (PSDTEST,PDA)=0 F  S PDA=$O(^PSRX(PSOEXRX,"L",PDA)) Q:'PDA  S:$P($G(^PSRX(PSOEXRX,"L",PDA,0)),"^",2)=PSUSD PSDTEST=1
"RTN","PSOMAUEX",75,0)
 Q:PSDTEST
"RTN","PSOMAUEX",76,0)
 S DA=PSOEXRX K CMOP D ^PSOCMOPA
"RTN","PSOMAUEX",77,0)
 I $G(CMOP(CMOP("L")))="",$G(CMOP("S"))="L" S PSDTEST=1
"RTN","PSOMAUEX",78,0)
ENX I 'PSDTEST K ^PSRX(PSOEXRX,1,PSUSD),^PSRX("AD",PRFDT,PSOEXRX,PSUSD),^PSRX(PSOEXRX,1,"B",PRFDT,PSUSD) D NSET
"RTN","PSOMAUEX",79,0)
 Q
"RTN","PSOMAUEX",80,0)
NSET ;
"RTN","PSOMAUEX",81,0)
 N PSONM,PSONMX
"RTN","PSOMAUEX",82,0)
 S PSONM="" F PSONMX=0:0 S PSONMX=$O(^PSRX(PSOEXRX,1,PSONMX)) Q:'PSONMX  S PSONM=PSONMX
"RTN","PSOMAUEX",83,0)
 S ^PSRX(PSOEXRX,1,0)="^52.1DA^"_$G(PSONM)_"^"_$G(PSONM)
"RTN","PSOMAUEX",84,0)
 Q
"RTN","PSON52")
0^7^B59165642
"RTN","PSON52",1,0)
PSON52 ;BIR/DSD - files new entries in prescription file ;08/09/93
"RTN","PSON52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,16,23,27,32,46,71,111,124,117,131,139,157,143,219,148**;DEC 1997
"RTN","PSON52",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSON52",4,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSON52",5,0)
 ;External reference to ^XUSEC supported by DBIA 10076
"RTN","PSON52",6,0)
EN(PSOX) ;Entry Point
"RTN","PSON52",7,0)
START ;
"RTN","PSON52",8,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Monitor
"RTN","PSON52",9,0)
 D INIT G:PSON52("QFLG") END D NFILE Q:$G(PSONEW("DFLG"))  D PS55,DIK
"RTN","PSON52",10,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Monitor
"RTN","PSON52",11,0)
 D FINISH
"RTN","PSON52",12,0)
 I $P(^PSRX(PSOX("IRXN"),0),"^",11)="W",$G(^("IB")) S ^PSRX("ACP",$P(^PSRX(PSOX("IRXN"),0),"^",2),$P(^(2),"^",2),0,PSOX("IRXN"))=""
"RTN","PSON52",13,0)
END D EOJ
"RTN","PSON52",14,0)
 Q
"RTN","PSON52",15,0)
INIT ;
"RTN","PSON52",16,0)
 K X,%DT S:$G(PSOID) PSOX("ISSUE DATE")=PSOID
"RTN","PSON52",17,0)
 S PSOX("CS")=0
"RTN","PSON52",18,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSOX("CS"),"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSOX("CS"),"^",2)=1
"RTN","PSON52",19,0)
 S PSON52("QFLG")=0,X1=PSOX("ISSUE DATE"),X2=PSOX("DAYS SUPPLY")*(PSOX("# OF REFILLS")+1)\1
"RTN","PSON52",20,0)
 I $D(CLOZPAT) S X2=$S(X2=14:14,X2=7:7,1:X2) G DT
"RTN","PSON52",21,0)
 S X2=$S(PSOX("DAYS SUPPLY")=X2:X2,+$G(PSOX("CS")):184,+$G(DEA("CS")):184,1:366)
"RTN","PSON52",22,0)
 I X2<30 D
"RTN","PSON52",23,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSON52",24,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSON52",25,0)
DT D C^%DTC S PSOX("STOP DATE")=$P(X,".") K X
"RTN","PSON52",26,0)
 I PSOX("# OF REFILLS")>0 S X1=PSOX("FILL DATE"),X2=$S((PSOX("DAYS SUPPLY")-10\1)<1:1,1:PSOX("DAYS SUPPLY")-10\1) D C^%DTC S PSOX("NEXT POSSIBLE REFILL")=$P(X,".") K X
"RTN","PSON52",27,0)
 S PSOX("TYPE OF RX")=0,PSOX("DISPENSED DATE")=PSOX("FILL DATE") D NOW^%DTC S PSOX("LOGIN DATE")=$S($P($G(OR0),"^",12):$P($G(OR0),"^",12),1:%) K %,X
"RTN","PSON52",28,0)
 S PSOX("STATUS")=$S($G(PSOX("STATUS"))]"":PSOX("STATUS"),$D(PSORX("VERIFY")):1,1:0)
"RTN","PSON52",29,0)
 S PSOX("COPIES")=$S($G(PSOX("COPIES"))]"":PSOX("COPIES"),1:1)
"RTN","PSON52",30,0)
 I $G(PSORX("PHARM"))]"" S PSOX("PHARMACIST")=PSORX("PHARM") K PSORX("PHARM")
"RTN","PSON52",31,0)
INITX Q
"RTN","PSON52",32,0)
 ;
"RTN","PSON52",33,0)
NFILE I $G(OR0) D  Q:$G(PSONEW("DFLG"))
"RTN","PSON52",34,0)
 .D NOOR^PSONEW Q:$G(PSONEW("DFLG"))
"RTN","PSON52",35,0)
 .I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSONEW("REMARKS")=$G(PSONEW("REMARKS"))_" CPRS Order #"_$P(OR0,"^")_" Edited."
"RTN","PSON52",36,0)
 S DIC="^PSRX(",DLAYGO=52,DIC(0)="L",X=PSOX("RX #") K DD,DO D FILE^DICN S PSOX("IRXN")=+Y K DLAYGO,X,Y,DIC,DD,DO D:+$G(DGI) TECH^PSODGDGI
"RTN","PSON52",37,0)
 F PSOX1=0:1 S PSON52=$P($T(DD+PSOX1),";;",2,4) Q:PSON52=""  K PSOY S PSOY=$P(PSON52,";;") I $G(@PSOY)]"" S $P(PSON52(PSOX("IRXN"),$P(PSON52,";;",2)),"^",$P(PSON52,";;",3))=@PSOY
"RTN","PSON52",38,0)
 F I=1:1:PSOX("ENT") S ^PSRX(PSOX("IRXN"),6,I,0)=PSOX("DOSE",I)_"^"_$G(PSOX("DOSE ORDERED",I))_"^"_$G(PSOX("UNITS",I))_"^"_$G(PSOX("NOUN",I))_"^" D
"RTN","PSON52",39,0)
 .S ^PSRX(PSOX("IRXN"),6,I,0)=^PSRX(PSOX("IRXN"),6,I,0)_$G(PSOX("DURATION",I))_"^"_$G(PSOX("CONJUNCTION",I))_"^"_$G(PSOX("ROUTE",I))_"^"_$G(PSOX("SCHEDULE",I))_"^"_$G(PSOX("VERB",I))
"RTN","PSON52",40,0)
 .I $G(PSOX("ODOSE",I))]"" S ^PSRX(PSOX("IRXN"),6,I,1)=PSOX("ODOSE",I)
"RTN","PSON52",41,0)
 S ^PSRX(PSOX("IRXN"),6,0)="^52.0113^"_PSOX("ENT")_"^"_PSOX("ENT")
"RTN","PSON52",42,0)
 K PSOX1,PSOY
"RTN","PSON52",43,0)
 S PSOX1="" F  S PSOX1=$O(PSON52(PSOX("IRXN"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),PSOX1)=$G(PSON52(PSOX("IRXN"),PSOX1))
"RTN","PSON52",44,0)
 I $O(PSOX("SIG",0)) D
"RTN","PSON52",45,0)
 .S D=0 F  S D=$O(PSOX("SIG",D)) Q:'D  S ^PSRX(PSOX("IRXN"),"INS1",D,0)=PSOX("SIG",D),TP=$G(TP)+1
"RTN","PSON52",46,0)
 .S ^PSRX(PSOX("IRXN"),"INS1",0)="^52.0115^"_TP_"^"_TP_"^"_DT_"^^" K TP,D
"RTN","PSON52",47,0)
 I $G(PSOX("SINS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=PSOX("SINS")
"RTN","PSON52",48,0)
 I $G(SIGOK) D
"RTN","PSON52",49,0)
 .S $P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1,^PSRX(PSOX("IRXN"),"SIG1",0)="^52.04A^^"
"RTN","PSON52",50,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSOX("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSON52",51,0)
 .K SIG
"RTN","PSON52",52,0)
 I $D(PSOINSFL) S ^PSRX(PSOX("IRXN"),"A",0)="^52.3DA^1^1",^PSRX(PSOX("IRXN"),"A",1,0)=DT_"^G^^0^Patient Instructions "_$S(PSOINSFL=1:"",1:"Not ")_"Sent By Provider."
"RTN","PSON52",53,0)
 I $G(OR0) S:$P(OR0,"^",24) ^PSRX(PSOX("IRXN"),"PKI")=1
"RTN","PSON52",54,0)
 K PSOX1,PSOFINFL,HLDSIG,D,PSOINSFL,D
"RTN","PSON52",55,0)
 D:$G(^TMP("PSODAI",$J,0))
"RTN","PSON52",56,0)
 .S $P(^PSRX(PSOX("IRXN"),3),"^",6)=1
"RTN","PSON52",57,0)
 .I $O(^TMP("PSODAI",$J,0)) S DAI=0 F  S DAI=$O(^TMP("PSODAI",$J,DAI)) Q:'DAI  D
"RTN","PSON52",58,0)
 ..S:'$D(^PSRX(PSOX("IRXN"),"DAI",0)) ^PSRX(PSOX("IRXN"),"DAI",0)="^52.03^^" S ^PSRX(PSOX("IRXN"),"DAI",DAI,0)=^TMP("PSODAI",$J,DAI,0)
"RTN","PSON52",59,0)
 ..S $P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1
"RTN","PSON52",60,0)
 .K ^TMP("PSODAI",$J),DAI
"RTN","PSON52",61,0)
 I $G(PSOX("CHCS NUMBER"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^")=$G(PSOX("CHCS NUMBER"))
"RTN","PSON52",62,0)
 I $G(PSOX("EXTERNAL SYSTEM"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^",2)=$G(PSOX("EXTERNAL SYSTEM"))
"RTN","PSON52",63,0)
 I $G(PSOX("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=$G(PSOX("NEWCOPAY"))
"RTN","PSON52",64,0)
IBQ ;Next line, set SC question based on Copay status?
"RTN","PSON52",65,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))
"RTN","PSON52",66,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="") S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD  ;don't set if SC % is null or 0, just set it in ICD node
"RTN","PSON52",67,0)
 I PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1) S ^PSRX(PSOX("IRXN"),"IBQ")="^^^^^^^"
"RTN","PSON52",68,0)
 D ICD^PSODIAG
"RTN","PSON52",69,0)
 K PSOANSQ,PSOANSQD,PSOX("NEWCOPAY")
"RTN","PSON52",70,0)
 L -^PSRX("B",PSOX("IRXN"))
"RTN","PSON52",71,0)
 Q
"RTN","PSON52",72,0)
 ;
"RTN","PSON52",73,0)
PS55 ;
"RTN","PSON52",74,0)
 L +^PS(55,PSODFN,"P"):0
"RTN","PSON52",75,0)
 S:'$D(^PS(55,PSODFN,"P",0)) ^(0)="^55.03PA^^"
"RTN","PSON52",76,0)
 F PSOX1=$P(^PS(55,PSODFN,"P",0),"^",3):1 Q:'$D(^PS(55,PSODFN,"P",PSOX1))
"RTN","PSON52",77,0)
 S PSOX("55 IEN")=PSOX1
"RTN","PSON52",78,0)
 S ^PS(55,PSODFN,"P",PSOX1,0)=PSOX("IRXN"),$P(^PS(55,PSODFN,"P",0),"^",3,4)=PSOX1_"^"_($P(^PS(55,PSODFN,"P",0),"^",4)+1)
"RTN","PSON52",79,0)
 S ^PS(55,PSODFN,"P","A",PSONEW("STOP DATE"),PSOX("IRXN"))=""
"RTN","PSON52",80,0)
PS55X L -^PS(55,PSODFN,"P")
"RTN","PSON52",81,0)
 K PSOX1
"RTN","PSON52",82,0)
 Q
"RTN","PSON52",83,0)
DIK ;
"RTN","PSON52",84,0)
 I $D(^XUSEC("PSORPH",DUZ)) S DA=PSOX("IRXN"),DIE=52,DR="41////"_PSOCOU_";S:'X Y=""@1"";42////"_PSOCOUU_";@1" D ^DIE K DIE,DR
"RTN","PSON52",85,0)
 K DIK,DA S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSON52",86,0)
 S DA=PSOX("IRXN") D ORC^PSORN52C
"RTN","PSON52",87,0)
 Q
"RTN","PSON52",88,0)
FINISH ;
"RTN","PSON52",89,0)
ANQ I $G(ANQDATA)]"" D NOW^%DTC G:$D(^PS(52.52,"B",%)) ANQ D
"RTN","PSON52",90,0)
 .K DD,DO S DIC="^PS(52.52,",DIC(0)="L",DLAYGO=52.52,X=% D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","PSON52",91,0)
 .S ^PS(52.52,+Y,0)=$P(Y,"^",2)_"^"_PSOX("IRXN")_"^"_ANQDATA,^PS(52.52,"A",PSOX("IRXN"),+Y)="" K ANQDATA,X,Y,%,ANQREM
"RTN","PSON52",92,0)
 G:PSOX("STATUS")=4 FINISHP
"RTN","PSON52",93,0)
 I $D(PSORX("VERIFY")) D  G FINISHX
"RTN","PSON52",94,0)
 .K DIC,DLAYGO,DINUM,DIADD,X,DD,DO S DIC="^PS(52.4,",DLAYGO=52.4,DINUM=PSOX("IRXN"),DIC(0)="ML",X=PSOX("IRXN")
"RTN","PSON52",95,0)
 .D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM S ^PS(52.4,PSOX("IRXN"),0)=PSOX("IRXN")_"^"_PSODFN_"^"_DUZ_"^"_"^"_$E(PSOX("LOGIN DATE"),1,7)_"^"_PSOX("IRXN")_"^"_PSOX("STOP DATE")
"RTN","PSON52",96,0)
 .K DIK,DA S DIK="^PS(52.4,",DA=PSOX("IRXN") D IX^DIK K DIK,DA
"RTN","PSON52",97,0)
 ;
"RTN","PSON52",98,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSON52",99,0)
 ;
"RTN","PSON52",100,0)
 ; - Calling ECME for claims generation and transmission / REJECT handling
"RTN","PSON52",101,0)
 N ACTION
"RTN","PSON52",102,0)
 I $$SUBMIT^PSOBPSUT(PSOX("IRXN"),0) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSON52",103,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOX("IRXN"),0,PSOX("FILL DATE"),"OF")
"RTN","PSON52",104,0)
 . I $$FIND^PSOREJUT(PSOX("IRXN"),0) D
"RTN","PSON52",105,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOX("IRXN"),0,"79,88","OF","IOQ","I")
"RTN","PSON52",106,0)
 ;
"RTN","PSON52",107,0)
FINISHP ;
"RTN","PSON52",108,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSON52",109,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSON52",110,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSON52",111,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSON52",112,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSON52",113,0)
FINISHX ;call to build Rx array for bingo board
"RTN","PSON52",114,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSON52",115,0)
 K PSOX1,PSOX2
"RTN","PSON52",116,0)
 Q
"RTN","PSON52",117,0)
EOJ ;
"RTN","PSON52",118,0)
 ;B xref locked in routine PSONRXN
"RTN","PSON52",119,0)
 L -^PSRX("B",PSOX("IRXN")) K OTHDOS,DA,PSON52,PSOPRC,RTE,SCH,PSOX("INS"),PSONEW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT
"RTN","PSON52",120,0)
 D PSOUL^PSSLOCK(PSOX("IRXN"))
"RTN","PSON52",121,0)
 Q
"RTN","PSON52",122,0)
 ;
"RTN","PSON52",123,0)
 ;;PSOX("SIG");;SIG;;1
"RTN","PSON52",124,0)
DD ;;PSOX("RX #");;0;;1
"RTN","PSON52",125,0)
 ;;PSOX("ISSUE DATE");;0;;13
"RTN","PSON52",126,0)
 ;;PSODFN;;0;;2
"RTN","PSON52",127,0)
 ;;PSOX("PATIENT STATUS");;0;;3
"RTN","PSON52",128,0)
 ;;PSOX("PROVIDER");;0;;4
"RTN","PSON52",129,0)
 ;;PSOX("CLINIC");;0;;5
"RTN","PSON52",130,0)
 ;;PSODRUG("IEN");;0;;6
"RTN","PSON52",131,0)
 ;;PSODRUG("TRADE NAME");;TN;;1
"RTN","PSON52",132,0)
 ;;PSOX("QTY");;0;;7
"RTN","PSON52",133,0)
 ;;PSOX("DAYS SUPPLY");;0;;8
"RTN","PSON52",134,0)
 ;;PSOX("# OF REFILLS");;0;;9
"RTN","PSON52",135,0)
 ;;PSOX("COPIES");;0;;18
"RTN","PSON52",136,0)
 ;;PSOX("MAIL/WINDOW");;0;;11
"RTN","PSON52",137,0)
 ;;PSOX("REMARKS");;3;;7
"RTN","PSON52",138,0)
 ;;PSOX("CLERK CODE");;0;;16
"RTN","PSON52",139,0)
 ;;PSODRUG("COST");;0;;17
"RTN","PSON52",140,0)
 ;;PSOSITE;;2;;9
"RTN","PSON52",141,0)
 ;;PSOX("LOGIN DATE");;2;;1
"RTN","PSON52",142,0)
 ;;PSOX("FILL DATE");;2;;2
"RTN","PSON52",143,0)
 ;;PSOX("PHARMACIST");;2;;3
"RTN","PSON52",144,0)
 ;;PSOX("LOT #");;2;;4
"RTN","PSON52",145,0)
 ;;PSOX("DISPENSED DATE");;2;;5
"RTN","PSON52",146,0)
 ;;PSOX("STOP DATE");;2;;6
"RTN","PSON52",147,0)
 ;;PSODRUG("NDC");;2;;7
"RTN","PSON52",148,0)
 ;;PSODRUG("DAW");;EPH;;1
"RTN","PSON52",149,0)
 ;;PSODRUG("MANUFACTURER");;2;;8
"RTN","PSON52",150,0)
 ;;PSOX("EXPIRATION DATE");;2;;11
"RTN","PSON52",151,0)
 ;;PSOX("GENERIC PROVIDER");;2;;12
"RTN","PSON52",152,0)
 ;;PSOX("RELEASED DATE/TIME");;2;;13
"RTN","PSON52",153,0)
 ;;PSOX("METHOD OF PICK-UP");;MP;;1
"RTN","PSON52",154,0)
 ;;PSOX("STATUS");;STA;;1
"RTN","PSON52",155,0)
 ;;PSOX("LAST DISPENSED DATE");;3;;1
"RTN","PSON52",156,0)
 ;;PSOX("NEXT POSSIBLE REFILL");;3;;2
"RTN","PSON52",157,0)
 ;;PSOX("COSIGNING PROVIDER");;3;;3
"RTN","PSON52",158,0)
 ;;PSOX("TYPE OF RX");;TYPE;;1
"RTN","PSON52",159,0)
 ;;PSOX("SAND");;SAND;;1
"RTN","PSON52",160,0)
 ;;PSOX("POE");;POE;;1
"RTN","PSON52",161,0)
 ;;PSOX("INS");;INS;;1
"RTN","PSONDCUT")
0^37^B19534590
"RTN","PSONDCUT",1,0)
PSONDCUT ;BIRM/MFR - NDC Utilities ;10/15/04
"RTN","PSONDCUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSONDCUT",3,0)
 ;Reference to $$ECMEON^BPSUTIL supported by DBIA 4410
"RTN","PSONDCUT",4,0)
 ;References to $$GETNDC^PSSNDCUT,$$NDCFMT^PSSNDCUT,SAVNDC^PSSNDCUT supported by IA 4707
"RTN","PSONDCUT",5,0)
 ;
"RTN","PSONDCUT",6,0)
CHGNDC(RX,RFL,BCODE)   ; Prompt for NDC code during Rx Release for HIPAA/NCPDP project
"RTN","PSONDCUT",7,0)
 ;Input:  (r) RX     - Rx IEN (#52)
"RTN","PSONDCUT",8,0)
 ;        (o) RFL    - Refill Number (#52.1)
"RTN","PSONDCUT",9,0)
 ;        (o) BCODE  - Displays PID: 999-99-9999/MED: XXXXX XXXXXXXXXXX 999MG in the NDC prompt (1-YES/0-NO)
"RTN","PSONDCUT",10,0)
 ;        
"RTN","PSONDCUT",11,0)
 ;Output: (r) NDCCHG - NDC was changed? (1-YES/0-NO)^New NDC number 
"RTN","PSONDCUT",12,0)
 ;                     OR "^" if no valid NDC or "^" entered
"RTN","PSONDCUT",13,0)
 ;        
"RTN","PSONDCUT",14,0)
 N PSONDC,NEWNDC,SITE
"RTN","PSONDCUT",15,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSONDCUT",16,0)
 S SITE=$$RXSITE^PSOBPSUT(RX,RFL) I '$$ECMEON^BPSUTIL(SITE) Q "^"  ; ECME is not turned ON for the Rx's Division
"RTN","PSONDCUT",17,0)
 ;
"RTN","PSONDCUT",18,0)
 ; - Retrieving Rx NDC and Fill Date
"RTN","PSONDCUT",19,0)
 S PSONDC=$$GETNDC(RX,RFL)
"RTN","PSONDCUT",20,0)
 ;
"RTN","PSONDCUT",21,0)
 ; - Prompts for NDC number
"RTN","PSONDCUT",22,0)
 I $G(BCODE) F I=1:1:5 W $C(7)
"RTN","PSONDCUT",23,0)
 S NEWNDC=PSONDC D NDCEDT(RX,RFL,,SITE,.NEWNDC,$G(BCODE)) I NEWNDC="^"!(NEWNDC="") Q "^"
"RTN","PSONDCUT",24,0)
 ;
"RTN","PSONDCUT",25,0)
 ; - If NDC changed, resubmit to ECME and save new NDC in the DRUG and PRESCRIPTION files
"RTN","PSONDCUT",26,0)
 I PSONDC'=NEWNDC D  Q ("1^"_NEWNDC)
"RTN","PSONDCUT",27,0)
 . D SAVNDC(RX,RFL,NEWNDC,0,1)
"RTN","PSONDCUT",28,0)
 . D ECMESND^PSOBPSU1(RX,RFL,,"ED",NEWNDC,,"RX RELEASE-NDC CHANGE",,1,,1)
"RTN","PSONDCUT",29,0)
 Q 0
"RTN","PSONDCUT",30,0)
 ;
"RTN","PSONDCUT",31,0)
NDCEDT(RX,RFL,DRG,SITE,NDC,BCODE) ; Allows editing of the Rx NDC code
"RTN","PSONDCUT",32,0)
 ; Input: (r) RX    - Rx IEN (#52) 
"RTN","PSONDCUT",33,0)
 ;        (o) RFL   - Refill Number (#52.1)
"RTN","PSONDCUT",34,0)
 ;        (o) DRG   - Drug IEN (#50)
"RTN","PSONDCUT",35,0)
 ;        (o) NDC   - Default NDC Number/Return parameter ("" means no NDC selected)  (Note: REQUIRED for Output value)
"RTN","PSONDCUT",36,0)
 ;        (o) BCODE - Display the PID/Drug Name in the NDC prompt
"RTN","PSONDCUT",37,0)
 ;Output: (r) .NDC  - Selected NDC Number
"RTN","PSONDCUT",38,0)
 ;
"RTN","PSONDCUT",39,0)
 N SNDC,SYN,Z,IDX,I,PID,DFN,DRGNAM,PRPT,DIR
"RTN","PSONDCUT",40,0)
 K ^TMP($J,"PSONDCDP"),^TMP($J,"PSONDCFM")
"RTN","PSONDCUT",41,0)
 I '$G(DRG),$G(RX) S DRG=$$GET1^DIQ(52,RX,6,"I")
"RTN","PSONDCUT",42,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSONDCUT",43,0)
 S IDX=0,SITE=+$G(SITE) I 'SITE,$G(RX) S SITE=$$RXSITE^PSOBPSUT(RX,RFL)
"RTN","PSONDCUT",44,0)
 ;
"RTN","PSONDCUT",45,0)
 ; - Setting the NDC currently on the PRESCRIPTION (passed in)
"RTN","PSONDCUT",46,0)
 I $G(NDC)'="",$$NDCFMT^PSSNDCUT(NDC)'="" S IDX=1,^TMP($J,"PSONDCFM",IDX)=NDC,^TMP($J,"PSONDCDP",NDC)=IDX
"RTN","PSONDCUT",47,0)
 ;
"RTN","PSONDCUT",48,0)
 ; - Retrieving NDC from the PRESCRIPTION file
"RTN","PSONDCUT",49,0)
 I $G(RX) D
"RTN","PSONDCUT",50,0)
 . S NDC=$$GETNDC(RX,RFL)
"RTN","PSONDCUT",51,0)
 . I NDC'="",'$D(^TMP($J,"PSONDCDP",NDC)) D
"RTN","PSONDCUT",52,0)
 . . S IDX=IDX+1,^TMP($J,"PSONDCFM",IDX)=NDC,^TMP($J,"PSONDCDP",NDC)=IDX
"RTN","PSONDCUT",53,0)
 ;
"RTN","PSONDCUT",54,0)
 S:'IDX IDX=1
"RTN","PSONDCUT",55,0)
 ;
"RTN","PSONDCUT",56,0)
 ; - Retrieving NDC from the DRUG/NDF files
"RTN","PSONDCUT",57,0)
 S NDC=$$GETNDC^PSSNDCUT(DRG)
"RTN","PSONDCUT",58,0)
 I NDC'="",'$D(^TMP($J,"PSONDCDP",NDC)) D
"RTN","PSONDCUT",59,0)
 . S IDX=IDX+1,^TMP($J,"PSONDCFM",IDX)=NDC,^TMP($J,"PSONDCDP",NDC)=IDX
"RTN","PSONDCUT",60,0)
 ; 
"RTN","PSONDCUT",61,0)
 ; - Retrieving NDC by OUTPATIENT SITE from the DRUG/NDF files
"RTN","PSONDCUT",62,0)
 S NDC=$$GETNDC^PSSNDCUT(DRG,SITE)
"RTN","PSONDCUT",63,0)
 I NDC'="",'$D(^TMP($J,"PSONDCDP",NDC)) D
"RTN","PSONDCUT",64,0)
 . S IDX=IDX+1,^TMP($J,"PSONDCFM",IDX)=NDC,^TMP($J,"PSONDCDP",NDC)=IDX
"RTN","PSONDCUT",65,0)
 ;
"RTN","PSONDCUT",66,0)
 ; - Retrieving NDCs from SYNONYMS
"RTN","PSONDCUT",67,0)
 S SYN=0
"RTN","PSONDCUT",68,0)
 F  S SYN=$O(^PSDRUG(DRG,1,SYN)) Q:SYN=""  D
"RTN","PSONDCUT",69,0)
 . S Z=$G(^PSDRUG(DRG,1,SYN,0)),SNDC=$$NDCFMT^PSSNDCUT($P(Z,"^",2)) I SNDC="" Q
"RTN","PSONDCUT",70,0)
 . I $D(^TMP($J,"PSONDCDP",SNDC)) Q
"RTN","PSONDCUT",71,0)
 . S IDX=IDX+1,^TMP($J,"PSONDCFM",IDX)=SNDC
"RTN","PSONDCUT",72,0)
 . S ^TMP($J,"PSONDCDP",SNDC)=IDX
"RTN","PSONDCUT",73,0)
 ;
"RTN","PSONDCUT",74,0)
 I '$D(^TMP($J,"PSONDCFM")) D  S NDC="^" G END
"RTN","PSONDCUT",75,0)
 . W !!,"No valid NDC codes found for "_$$GET1^DIQ(50,DRG,.01),$C(7)
"RTN","PSONDCUT",76,0)
 ;
"RTN","PSONDCUT",77,0)
ASK ; Ask for NDC
"RTN","PSONDCUT",78,0)
 S PRPT=""
"RTN","PSONDCUT",79,0)
 I $G(BCODE) D
"RTN","PSONDCUT",80,0)
 . S DFN=$$GET1^DIQ(52,RX,2,"I") D DEM^VADPT S PID=$P(VADM(2),"^",2)
"RTN","PSONDCUT",81,0)
 . S DRGNAM=$E($$GET1^DIQ(50,DRG,.01),1,25),PRPT="PID: "_PID_"/MED: "_DRGNAM_"/"
"RTN","PSONDCUT",82,0)
 K DIR S DIR(0)="FOA^1:15",DIR("A")=PRPT_"NDC: ",DIR("B")=$G(^TMP($J,"PSONDCFM",1)) I DIR("B")="" K DIR("B")
"RTN","PSONDCUT",83,0)
 S DIR("?")="^D NDCHLP^PSONDCUT" D ^DIR I $D(DIRUT) S NDC="^" G END
"RTN","PSONDCUT",84,0)
 I Y'?.N S NDC=Y I '$D(^TMP($J,"PSONDCDP",NDC)) W !,$C(7) D NDCHLP W !,$C(7) G ASK
"RTN","PSONDCUT",85,0)
 I Y?.N D  I NDC="" W !,$C(7) D NDCHLP W !,$C(7) G ASK
"RTN","PSONDCUT",86,0)
 . I $L(Y)=11 S NDC=$$NDCFMT^PSSNDCUT(Y) S:NDC'="" NDC=$S($D(^TMP($J,"PSONDCDP",NDC)):NDC,1:"") Q
"RTN","PSONDCUT",87,0)
 . S NDC=$G(^TMP($J,"PSONDCFM",+Y))
"RTN","PSONDCUT",88,0)
 W " ",NDC
"RTN","PSONDCUT",89,0)
 ;
"RTN","PSONDCUT",90,0)
END K ^TMP($J,"PSONDCDP"),^TMP($J,"PSONDCFM")
"RTN","PSONDCUT",91,0)
 Q
"RTN","PSONDCUT",92,0)
 ;
"RTN","PSONDCUT",93,0)
SAVNDC(RX,RFL,NDC,CMP,DRG) ; Saves the NDC in the PRESCRIPTION and DRUG files
"RTN","PSONDCUT",94,0)
 ; Input: (r) RX - Rx IEN (#52)
"RTN","PSONDCUT",95,0)
 ;        (o) RFL - Refill Number (#52.1)
"RTN","PSONDCUT",96,0)
 ;        (r) NDC - NDC Number
"RTN","PSONDCUT",97,0)
 ;        (o) CMP - CMOP? (1-YES/0-NO)
"RTN","PSONDCUT",98,0)
 ;        (o) DRG - Save in the DRUG file (1-YES/0-NO) ((Def: 0)
"RTN","PSONDCUT",99,0)
 ;
"RTN","PSONDCUT",100,0)
 S NDC=$$NDCFMT^PSSNDCUT(NDC) I NDC="" Q
"RTN","PSONDCUT",101,0)
 ;
"RTN","PSONDCUT",102,0)
 ;- Saving the NDC in the PRESCRIPTION file (#52)
"RTN","PSONDCUT",103,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSONDCUT",104,0)
 ;
"RTN","PSONDCUT",105,0)
 N DA,DIE,DR
"RTN","PSONDCUT",106,0)
 I 'RFL S DIE="^PSRX(",DA=RX,DR="27///"_NDC D ^DIE
"RTN","PSONDCUT",107,0)
 I RFL,$D(^PSRX(RX,1,RFL,0)) S DIE="^PSRX("_RX_",1,",DA(1)=RX,DA=RFL,DR="11///"_NDC D ^DIE
"RTN","PSONDCUT",108,0)
 ;
"RTN","PSONDCUT",109,0)
 ;- Saving the NDC in the DRUG file (#50)
"RTN","PSONDCUT",110,0)
 I $G(DRG) D SAVNDC^PSSNDCUT($$GET1^DIQ(52,RX,6,"I"),$$RXSITE^PSOBPSUT(RX,RFL),NDC,$G(CMP))
"RTN","PSONDCUT",111,0)
 Q
"RTN","PSONDCUT",112,0)
 ;
"RTN","PSONDCUT",113,0)
GETNDC(RX,RFL) ; Returns the Rx NDC #
"RTN","PSONDCUT",114,0)
 ; Input:  (r) RX - Rx IEN (#52)
"RTN","PSONDCUT",115,0)
 ;         (o) RFL - Refill #
"RTN","PSONDCUT",116,0)
 ; Output:     NDC - Rx NDC #
"RTN","PSONDCUT",117,0)
 N NDC,I S NDC=""
"RTN","PSONDCUT",118,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSONDCUT",119,0)
 I RFL S NDC=$$GET1^DIQ(52.1,RFL_","_RX,11)
"RTN","PSONDCUT",120,0)
 I 'RFL!(NDC="") S NDC=$$GET1^DIQ(52,RX,27)
"RTN","PSONDCUT",121,0)
 Q $$NDCFMT^PSSNDCUT(NDC)
"RTN","PSONDCUT",122,0)
 ;
"RTN","PSONDCUT",123,0)
NDCHLP ; Help Text for the NDC Code Selection
"RTN","PSONDCUT",124,0)
 N I
"RTN","PSONDCUT",125,0)
 W !,"Select one of the following valid NDC code(s) below: ",!
"RTN","PSONDCUT",126,0)
 S I=0 F  S I=$O(^TMP($J,"PSONDCFM",I)) Q:'I  D
"RTN","PSONDCUT",127,0)
 . W !?10,$J(I,2)," - ",^TMP($J,"PSONDCFM",I)
"RTN","PSONDCUT",128,0)
 Q
"RTN","PSOORAL")
0^82^B2433943
"RTN","PSOORAL",1,0)
PSOORAL ;BHAM-ISC/SAB - activity log list ; 28-APR-1995
"RTN","PSOORAL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOORAL",3,0)
EN ; -- main entry point for PSO LM ACTIVITY LOGS
"RTN","PSOORAL",4,0)
 D EN^VALM("PSO LM ACTIVITY LOGS")
"RTN","PSOORAL",5,0)
 Q
"RTN","PSOORAL",6,0)
 ;
"RTN","PSOORAL",7,0)
HDR ; -- header code
"RTN","PSOORAL",8,0)
 D HDR^PSOLMUTL
"RTN","PSOORAL",9,0)
 Q
"RTN","PSOORAL",10,0)
 ;
"RTN","PSOORAL",11,0)
INIT ; -- init variables and list array
"RTN","PSOORAL",12,0)
 I $G(PS)="VIEW"!($G(PS)="DELETE")!($G(PS)="REJECT") D
"RTN","PSOORAL",13,0)
 .I ST<12,$P(RX2,"^",6)<DT S ST=11
"RTN","PSOORAL",14,0)
 .S VALM("TITLE")="Rx View "_"("_$P("Error^Active^Non-Verified^Refill^Hold^Non-Verified^Suspended^^^^^Done^Expired^Discontinued^Deleted^Discontinued^Discontinued (Edit)^Provider Hold^","^",ST+2)_")"
"RTN","PSOORAL",15,0)
 S VALMCNT=PSOAL
"RTN","PSOORAL",16,0)
 Q
"RTN","PSOORAL",17,0)
 ;
"RTN","PSOORAL",18,0)
HELP ; -- help code
"RTN","PSOORAL",19,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOORAL",20,0)
 Q
"RTN","PSOORAL",21,0)
 ;
"RTN","PSOORAL",22,0)
EXIT ; -- exit code
"RTN","PSOORAL",23,0)
 S VALMBCK="Q" Q
"RTN","PSOORAL",24,0)
 ;
"RTN","PSOORAL",25,0)
EXPND ; -- expand code
"RTN","PSOORAL",26,0)
 Q
"RTN","PSOORAL",27,0)
 ;
"RTN","PSOORAL1")
0^83^B59592714
"RTN","PSOORAL1",1,0)
PSOORAL1 ;BHAM ISC/SAB - Build Listman activity logs ;11/16/92 13:11
"RTN","PSOORAL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**71,156,148**;DEC 1997
"RTN","PSOORAL1",3,0)
 N RX0,VALMCNT K DIR,DTOUT,DUOUT,DIRUT,^TMP("PSOAL",$J) S DA=$P(PSOLST(ORN),"^",2),RX0=^PSRX(DA,0),J=DA,RX2=$G(^(2)),R3=$G(^(3)),CMOP=$O(^PSRX(DA,4,0))
"RTN","PSOORAL1",4,0)
 S IEN=0,DIR(0)="LO^1:"_$S(CMOP:8,1:7),DIR("A",1)=" ",DIR("A",2)="Select Activity Log by  number",DIR("A",3)="1.  Refill      2.  Partial      3.  Activity     4.  Labels"
"RTN","PSOORAL1",5,0)
 S DIR("A")=$S(CMOP:"5.  Copay       6.  ECME         7.  CMOP Events  8.  All Logs",1:"5.  Copay       6.  ECME         7.  All Logs")
"RTN","PSOORAL1",6,0)
 S DIR("B")=$S(CMOP:8,1:7) D ^DIR S PSOELSE=+Y I +Y S Y=$S(CMOP&(Y[8):"1,2,3,4,5,6,7",'CMOP&(Y[7):"1,2,3,4,5,6",1:Y) S ACT=Y D FULL^VALM1 D
"RTN","PSOORAL1",7,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Rx #: "_$P(RX0,"^")_"   Original Fill Released: " I $P(RX2,"^",13) S DTT=$P(RX2,"^",13) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT K DAT,DTT
"RTN","PSOORAL1",8,0)
 .I $P(RX2,"^",15) S DTT=$P(RX2,"^",15) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"(Returned to Stock "_DAT_")" K DAT,DTT
"RTN","PSOORAL1",9,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Routing: "_$S($P(RX0,"^",11)="W":"Window",1:"Mail")_$S($P($G(^PSRX(DA,"OR1")),"^",5):"      Finished by: "_$P(^VA(200,$P(^PSRX(DA,"OR1"),"^",5),0),"^"),1:"")
"RTN","PSOORAL1",10,0)
 .D:$G(^PSRX(DA,"H"))]""&($P(PSOLST(ORN),"^",3)="HOLD") HLD^PSOORAL2
"RTN","PSOORAL1",11,0)
 .F LOG=1:1:$L(ACT,",") Q:$P(ACT,",",LOG)']""  S LBL=$P(ACT,",",LOG) D @$S(LBL=1:"RF^PSOORAL2",LBL=2:"PAR^PSOORAL2",LBL=3:"ACT",LBL=5:"COPAY",LBL=6:"ECME",LBL=7:"^PSORXVW2",1:"LBL")
"RTN","PSOORAL1",12,0)
 I 'PSOELSE S VALMBCK="" K PSOELSE Q 
"RTN","PSOORAL1",13,0)
 K ST0,RFL,RFLL,RFL1,II,J,N,PHYS,L1,DIRUT,PSDIV,PSEXDT,MED,M1,FFX,DTT,DAT,R3,RTN,SIG,STA,P1,PL,P0,Z0,Z1,EXDT,IFN,DIR,DUOUT,DTOUT,PSOELSE
"RTN","PSOORAL1",14,0)
 K LBL,I,RFDATE,%H,%I,RN,RFT
"RTN","PSOORAL1",15,0)
 S PSOAL=IEN K IEN,ACT,LBL,LOG D EN^PSOORAL S VALMBCK="R"
"RTN","PSOORAL1",16,0)
 Q
"RTN","PSOORAL1",17,0)
ACT ;activity log
"RTN","PSOORAL1",18,0)
 N CNT
"RTN","PSOORAL1",19,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Activity Log:"
"RTN","PSOORAL1",20,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Reason         Rx Ref         Initiator Of Activity",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL1",21,0)
 I '$O(^PSRX(DA,"A",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO Activity to report" Q
"RTN","PSOORAL1",22,0)
 S CNT=0
"RTN","PSOORAL1",23,0)
 F N=0:0 S N=$O(^PSRX(DA,"A",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D DAT D
"RTN","PSOORAL1",24,0)
 .I $P(P1,"^",2)="M" Q
"RTN","PSOORAL1",25,0)
 .S IEN=IEN+1,CNT=CNT+1,^TMP("PSOAL",$J,IEN,0)=CNT_"   "_DAT_"    ",$P(RN," ",15)=" ",REA=$P(P1,"^",2),REA=$F("HUCELPRWSIVDABXGKN",REA)-1
"RTN","PSOORAL1",26,0)
 .I REA D
"RTN","PSOORAL1",27,0)
 ..S STA=$P("HOLD^UNHOLD^DISCONTINUED^EDIT^RENEWED^PARTIAL^REINSTATE^REPRINT^SUSPENSE^RETURNED^INTERVENTION^DELETED^DRUG INTERACTION^PROCESSED^X-INTERFACE^PATIENT INSTR.^PKI/DEA^DISP COMPLETED^","^",REA)
"RTN","PSOORAL1",28,0)
 ..S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA_$E(RN,$L(STA)+1,15)
"RTN","PSOORAL1",29,0)
 .E  S $P(STA," ",15)=" ",^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA
"RTN","PSOORAL1",30,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSOORAL1",31,0)
 .S RFT=$S(RF>0&(RF<6):"REFILL "_RF,RF=6:"PARTIAL",RF>6:"REFILL "_(RF-1),1:"ORIGINAL")
"RTN","PSOORAL1",32,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$E(RN,$L(RFT)+1,15)_$S($D(^VA(200,+$P(P1,"^",3),0)):$P(^(0),"^"),1:$P(P1,"^",3))
"RTN","PSOORAL1",33,0)
 .;S:$P(P1,"^",5)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(P1,"^",5)
"RTN","PSOORAL1",34,0)
 .I $P(P1,"^",5)]"" N PSOACBRK,PSOACBRV D
"RTN","PSOORAL1",35,0)
 ..S PSOACBRV=$P(P1,"^",5)
"RTN","PSOORAL1",36,0)
 ..I $L(PSOACBRV)<71 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_PSOACBRV Q
"RTN","PSOORAL1",37,0)
 ..I $E(PSOACBRV,1,70)'[" " S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$E(PSOACBRV,1,70),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$E(PSOACBRV,71,245) Q
"RTN","PSOORAL1",38,0)
 ..F PSOACBRK=245:-1 Q:PSOACBRK=0  I $E(PSOACBRV,PSOACBRK)=" ",PSOACBRK<71 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$E(PSOACBRV,1,PSOACBRK),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$E(PSOACBRV,PSOACBRK,245) Q
"RTN","PSOORAL1",39,0)
 .I $P($G(^PSRX(DA,"A",N,1)),"^")]"" S IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",5)=$P($G(^PSRX(DA,"A",N,1)),"^") I $P($G(^PSRX(DA,"A",N,1)),"^",2)]"" S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_":"_$P($G(^PSRX(DA,"A",N,1)),"^",2)
"RTN","PSOORAL1",40,0)
 .I $O(^PSRX(DA,"A",N,2,0)) F I=0:0 S I=$O(^PSRX(DA,"A",N,2,I)) Q:'I  S MIG=^PSRX(DA,"A",N,2,I,0) D
"RTN","PSOORAL1",41,0)
 ..F SG=1:1:$L(MIG) S:$L(^TMP("PSOAL",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",9)=" " S:$P(MIG," ",SG)'="" ^TMP("PSOAL",$J,IEN,0)=$G(^TMP("PSOAL",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORAL1",42,0)
 K MIG,SG,I
"RTN","PSOORAL1",43,0)
 Q
"RTN","PSOORAL1",44,0)
LBL ;label log
"RTN","PSOORAL1",45,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Label Log:"
"RTN","PSOORAL1",46,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Rx Ref                    Printed By",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL1",47,0)
 I '$O(^PSRX(DA,"L",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Labels printed." Q
"RTN","PSOORAL1",48,0)
 F L1=0:0 S L1=$O(^PSRX(DA,"L",L1)) Q:'L1  S LBL=^PSRX(DA,"L",L1,0),DTT=$P(^(0),"^") D DAT D
"RTN","PSOORAL1",49,0)
 .S $P(RN," ",26)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=L1_"   "_DAT_"    ",RFT=$S($P(LBL,"^",2):"REFILL "_$P(LBL,"^",2),1:"ORIGINAL"),RFT=RFT_$E(RN,$L(RFT)+1,26)
"RTN","PSOORAL1",50,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$P($G(^VA(200,$P(LBL,"^",4),0)),"^"),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(LBL,"^",3)
"RTN","PSOORAL1",51,0)
 Q
"RTN","PSOORAL1",52,0)
 ;
"RTN","PSOORAL1",53,0)
COPAY ;Copay activity log
"RTN","PSOORAL1",54,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Copay Activity Log:"
"RTN","PSOORAL1",55,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Reason               Rx Ref         Initiator Of Activity",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL1",56,0)
 I '$O(^PSRX(DA,"COPAY",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO Copay activity to report" Q
"RTN","PSOORAL1",57,0)
 F N=0:0 S N=$O(^PSRX(DA,"COPAY",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D DAT D
"RTN","PSOORAL1",58,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"    ",$P(RN," ",21)=" ",REA=$P(P1,"^",2),REA=$F("ARICE",REA)-1
"RTN","PSOORAL1",59,0)
 .I REA D
"RTN","PSOORAL1",60,0)
 ..S STA=$P("ANNUAL CAP REACHED^COPAY RESET^IB-INITIATED COPAY^REMOVE COPAY CHARGE^RX EDITED^","^",REA)
"RTN","PSOORAL1",61,0)
 ..S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA_$E(RN,$L(STA)+1,21)
"RTN","PSOORAL1",62,0)
 .E  S $P(STA," ",21)=" ",^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA
"RTN","PSOORAL1",63,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSOORAL1",64,0)
 .S RFT=$S(RF>0:"REFILL "_RF,1:"ORIGINAL")
"RTN","PSOORAL1",65,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$E(RN,$L(RFT)+1,15)_$S($D(^VA(200,+$P(P1,"^",3),0)):$P(^(0),"^"),1:$P(P1,"^",3))
"RTN","PSOORAL1",66,0)
 .S:$P(P1,"^",5)]""!($P(P1,"^",6)]"")!($P(P1,"^",7)]"") IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comment: "_$P(P1,"^",5)
"RTN","PSOORAL1",67,0)
 .I $P(P1,"^",6)]"" S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"  Old value="_$P(P1,"^",6)_"   New value="_$P(P1,"^",7)
"RTN","PSOORAL1",68,0)
 Q
"RTN","PSOORAL1",69,0)
 ;
"RTN","PSOORAL1",70,0)
ECME ; ECME activity log
"RTN","PSOORAL1",71,0)
 N N,P1,RFT,PSOACBRK,PSOACBRV,MIG,SG,I,NOTFND,CNT,LINE
"RTN","PSOORAL1",72,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="ECME Log:"
"RTN","PSOORAL1",73,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date/Time           Rx Ref          Initiator Of Activity"
"RTN","PSOORAL1",74,0)
 S IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSOORAL1",75,0)
 S NOTFND=1,I=0 F  S I=$O(^PSRX(DA,"A",I)) Q:'I  S Z=$G(^PSRX(DA,"A",I,0)) I $P(Z,"^",2)="M" S NOTFND=0 Q
"RTN","PSOORAL1",76,0)
 I NOTFND S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO ECME Activity to report" Q
"RTN","PSOORAL1",77,0)
 S CNT=0
"RTN","PSOORAL1",78,0)
 F N=0:0 S N=$O(^PSRX(DA,"A",N)) Q:'N  S P1=^(N,0) D
"RTN","PSOORAL1",79,0)
 .I $P(P1,"^",2)'="M" Q
"RTN","PSOORAL1",80,0)
 .S IEN=IEN+1,CNT=CNT+1
"RTN","PSOORAL1",81,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSOORAL1",82,0)
 .S LINE=CNT,$E(LINE,5)=$$FMTE^XLFDT($P(P1,"^"),2),$E(LINE,25)=$S(RF:"REFILL "_RF,1:"ORIGINAL")
"RTN","PSOORAL1",83,0)
 .S $E(LINE,41)=$$GET1^DIQ(200,+$P(P1,"^",3),.01)
"RTN","PSOORAL1",84,0)
 .S ^TMP("PSOAL",$J,IEN,0)=LINE
"RTN","PSOORAL1",85,0)
 .I $P(P1,"^",5)]"" D
"RTN","PSOORAL1",86,0)
 ..S PSOACBRV=$P(P1,"^",5)
"RTN","PSOORAL1",87,0)
 ..I $L(PSOACBRV)<71 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_PSOACBRV Q
"RTN","PSOORAL1",88,0)
 ..I $E(PSOACBRV,1,70)'[" " S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$E(PSOACBRV,1,70),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$E(PSOACBRV,71,245) Q
"RTN","PSOORAL1",89,0)
 ..F PSOACBRK=245:-1 Q:PSOACBRK=0  I $E(PSOACBRV,PSOACBRK)=" ",PSOACBRK<71 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$E(PSOACBRV,1,PSOACBRK),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$E(PSOACBRV,PSOACBRK,245) Q
"RTN","PSOORAL1",90,0)
 .I $O(^PSRX(DA,"A",N,2,0)) F I=0:0 S I=$O(^PSRX(DA,"A",N,2,I)) Q:'I  S MIG=^PSRX(DA,"A",N,2,I,0) D
"RTN","PSOORAL1",91,0)
 ..F SG=1:1:$L(MIG) D
"RTN","PSOORAL1",92,0)
 ...S:$L(^TMP("PSOAL",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",9)=" "
"RTN","PSOORAL1",93,0)
 ...S:$P(MIG," ",SG)'="" ^TMP("PSOAL",$J,IEN,0)=$G(^TMP("PSOAL",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSOORAL1",94,0)
 D DISPREJ
"RTN","PSOORAL1",95,0)
 Q
"RTN","PSOORAL1",96,0)
 ;
"RTN","PSOORAL1",97,0)
DISPREJ  ;
"RTN","PSOORAL1",98,0)
 N LN,SEQ,REJ,PRI,VAR,X,X1,X2,I,RFT
"RTN","PSOORAL1",99,0)
 I '$D(^PSRX(DA,"REJ")) Q
"RTN","PSOORAL1",100,0)
 S PRI="PSOAL",$P(LN,"=",80)="",SEQ=0
"RTN","PSOORAL1",101,0)
 S IEN=$G(IEN)+1,^TMP(PRI,$J,IEN,0)=" "
"RTN","PSOORAL1",102,0)
 S IEN=IEN+1,^TMP(PRI,$J,IEN,0)="ECME REJECT Log:"
"RTN","PSOORAL1",103,0)
 S IEN=IEN+1,^TMP(PRI,$J,IEN,0)="#   Date/Time         Rx Ref    Reject                   STATUS"
"RTN","PSOORAL1",104,0)
 S IEN=IEN+1,^TMP(PRI,$J,IEN,0)=LN
"RTN","PSOORAL1",105,0)
 F REJ=0:0 S REJ=$O(^PSRX(DA,"REJ",REJ)) Q:'REJ  D
"RTN","PSOORAL1",106,0)
 . S VAR=$G(^PSRX(DA,"REJ",REJ,0))
"RTN","PSOORAL1",107,0)
 . S RFT=+$P(VAR,"^",4)
"RTN","PSOORAL1",108,0)
 . S SEQ=SEQ+1,X=SEQ,$E(X,5)=$$FMTE^XLFDT($P(VAR,"^",2),2),$E(X,23)=$S(RFT:"REFILL "_RFT,1:"ORIGINAL")
"RTN","PSOORAL1",109,0)
 . S $E(X,33)=$S(+VAR=79:"REFILL TOO SOON",1:"DRUG UTILIZATION REVIEW")
"RTN","PSOORAL1",110,0)
 . S $E(X,58)=$S($P(VAR,"^",5):"RESOLVED",1:"UNRESOLVED") S:$P(VAR,"^",14) $E(X,67)="(RE-OPENED)"
"RTN","PSOORAL1",111,0)
 . S IEN=IEN+1,^TMP(PRI,$J,IEN,0)=X
"RTN","PSOORAL1",112,0)
 . I $P(VAR,"^",5) D
"RTN","PSOORAL1",113,0)
 . . S IEN=IEN+1,X=$$GET1^DIQ(52.25,REJ_","_DA,12)
"RTN","PSOORAL1",114,0)
 . . S X1=$$GET1^DIQ(52.25,REJ_","_DA,13) S:X1'="" X=X1_" ("_X_")"
"RTN","PSOORAL1",115,0)
 . . F I=1:1 Q:X=""  D
"RTN","PSOORAL1",116,0)
 . . . S ^TMP(PRI,$J,IEN,0)=$S(I=1:"Comments: ",1:"          ")_$E(X,1,69)
"RTN","PSOORAL1",117,0)
 . . . S X=$E(X,70,999) S:X'="" IEN=IEN+1
"RTN","PSOORAL1",118,0)
 Q
"RTN","PSOORAL1",119,0)
 ;
"RTN","PSOORAL1",120,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSOORAL1",121,0)
 Q
"RTN","PSOORCPY")
0^57^B21376105
"RTN","PSOORCPY",1,0)
PSOORCPY ;BIR/SAB-copy orders from backdoor ;10/17/96
"RTN","PSOORCPY",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,21,27,32,46,100,117,148**;DEC 1997
"RTN","PSOORCPY",3,0)
 ;External references LK^ORX2 and ULK^ORX2 supported by DBIA 867
"RTN","PSOORCPY",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORCPY",5,0)
 ;External references L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOORCPY",6,0)
 ;I '$D(^XUSEC("PSORPH",DUZ)) S VALMSG="Invalid Action Selection!",VALMBCK="" Q
"RTN","PSOORCPY",7,0)
 I $$LMREJ^PSOREJU1($P(PSOLST(ORN),"^",2),,.VALMSG,.VALMBCK) Q
"RTN","PSOORCPY",8,0)
 I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSOORCPY",9,0)
 I $G(PSONACT) W $C(7),$C(7) S VALMSG="No Pharmacy Orderable Item !",VALMBCK="" K PSOCOPY D ^PSOBUILD Q
"RTN","PSOORCPY",10,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSOORCPY",11,0)
 K PSOPLCK S X=PSODFN_";DPT(" D LK^ORX2 I 'Y S VALMSG="Another person is entering orders for this patient.",VALMBCK="" D UL^PSSLOCK(PSODFN) Q
"RTN","PSOORCPY",12,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG G EX
"RTN","PSOORCPY",13,0)
 N VALMCNT K PSOEDIT S (PSOCOPY,COPY,PSORXED)=1 D FULL^VALM1
"RTN","PSOORCPY",14,0)
 S PSORXED("DFLG")=0,(RXN,DA,PSORXED("IRXN"))=$P(PSOLST(ORN),"^",2),PSORXED("RX0")=^PSRX(PSORXED("IRXN"),0),PSORXED("RX2")=$G(^(2)),PSORXED("RX3")=$G(^(3)),PSOI=$P($G(^("OR1")),"^"),PSOSIG=$P($G(^("SIG")),"^"),STAT=+^("STA")
"RTN","PSOORCPY",15,0)
 S PSORXED("INS")=$G(^PSRX(PSORXED("IRXN"),"INS")),PSORXED("ENT")=0
"RTN","PSOORCPY",16,0)
 S:$G(^PSRX(PSORXED("IRXN"),"INSS"))]"" PSORXED("SINS")=^PSRX(PSORXED("IRXN"),"INSS")
"RTN","PSOORCPY",17,0)
 S D=0 F  S D=$O(^PSRX(PSORXED("IRXN"),"INS1",D)) Q:'D  S PSORXED("SIG",D)=^PSRX(PSORXED("IRXN"),"INS1",D,0)
"RTN","PSOORCPY",18,0)
 I '$O(PSORXED("SIG",0)),$G(PSORXED("INS"))]"" S PSORXED("SIG",1)=PSORXED("INS")
"RTN","PSOORCPY",19,0)
 I $G(^PSRX(PSORXED("IRXN"),"TN"))]"" S PSODRUG("TRADE NAME")=^PSRX(PSORXED("IRXN"),"TN")
"RTN","PSOORCPY",20,0)
 F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORXED("IRXN"),6,I,0) D
"RTN","PSOORCPY",21,0)
 .Q:$P(DOSE,"^")']""!($P(DOSE,"^",8)']"")
"RTN","PSOORCPY",22,0)
 .S PSORXED("ENT")=PSORXED("ENT")+1
"RTN","PSOORCPY",23,0)
 .S PSORXED("DOSE",PSORXED("ENT"))=$P(DOSE,"^"),PSORXED("UNITS",PSORXED("ENT"))=$P(DOSE,"^",3),PSORXED("DOSE ORDERED",PSORXED("ENT"))=$P(DOSE,"^",2)
"RTN","PSOORCPY",24,0)
 .S PSORXED("ROUTE",PSORXED("ENT"))=$P(DOSE,"^",7),PSORXED("SCHEDULE",PSORXED("ENT"))=$P(DOSE,"^",8),PSORXED("DURATION",PSORXED("ENT"))=$P(DOSE,"^",5)
"RTN","PSOORCPY",25,0)
 .S PSORXED("CONJUNCTION",PSORXED("ENT"))=$P(DOSE,"^",6),PSORXED("VERB",PSORXED("ENT"))=$P(DOSE,"^",9)
"RTN","PSOORCPY",26,0)
 .I $G(^PSRX(PSORXED("IRXN"),6,I,1))]"" S PSORXED("ODOSE",PSORXED("ENT"))=^PSRX(PSORXED("IRXN"),6,I,1)
"RTN","PSOORCPY",27,0)
 .I $G(PSORXED("DURATION",PSORXED("ENT")))]"" D  K DR,DUR1
"RTN","PSOORCPY",28,0)
 ..S DUR1=PSORXED("DURATION",PSORXED("ENT"))
"RTN","PSOORCPY",29,0)
 ..S PSORXED("DURATION",PSORXED("ENT"))=$S($E(DUR1,1)'?.N:$E(DUR1,2,99)_$E(DUR1,1),1:DUR1)
"RTN","PSOORCPY",30,0)
 .S PSORXED("NOUN",PSORXED("ENT"))=$P(DOSE,"^",4) K DOSE
"RTN","PSOORCPY",31,0)
 I $G(^PSDRUG($P(PSORXED("RX0"),"^",6),"I"))]"",^("I")<DT S VALMSG="Cannot COPY.  This drug has been inactivated!" S VALMBCK="R" G OUT
"RTN","PSOORCPY",32,0)
 I $P(^PSDRUG($P(PSORXED("RX0"),"^",6),2),"^",3)'["O" S VALMSG="Cannot Copy.  Drug no longer used by Outpatient!",VALMBCK="R" G OUT
"RTN","PSOORCPY",33,0)
 ;Check for invalid Dosage
"RTN","PSOORCPY",34,0)
 N PSOOCPRX,PSOOLPF,PSOOLPD,PSONOSIG S PSOOCPRX=PSORXED("IRXN") D CDOSE^PSORENW0
"RTN","PSOORCPY",35,0)
 I PSOOLPF D  S VALMBCK="R" G OUT
"RTN","PSOORCPY",36,0)
 .S VALMSG="Cannot copy, invalid Dosage of "_$G(PSOOLPD)
"RTN","PSOORCPY",37,0)
 I PSONOSIG D  S VALMBCK="R" G OUT
"RTN","PSOORCPY",38,0)
 .S VALMSG="Cannot copy, missing Sig"
"RTN","PSOORCPY",39,0)
 I '$P($G(^PSDRUG($P(PSORXED("RX0"),"^",6),2)),"^") S VALMBCK="R" G OUT
"RTN","PSOORCPY",40,0)
 S DREN=$P(PSORXED("RX0"),"^",6),PSODAYS=$P(PSORXED("RX0"),"^",8),PSORXST=+$P($G(^PS(53,$P(PSORXED("RX0"),"^",3),0)),"^",7) S POERR=1 D DRG^PSOORDRG K POERR
"RTN","PSOORCPY",41,0)
 I $G(PSORX("DFLG")) S VALMBCK="R"
"RTN","PSOORCPY",42,0)
 D EN^PSOORED1(.PSORXED) I $G(PSORX("FN")) S VALMBCK="Q",PSOFROM="NEW" D DCORD^PSONEW2
"RTN","PSOORCPY",43,0)
 E  S VALMBCK="R"
"RTN","PSOORCPY",44,0)
OUT ;
"RTN","PSOORCPY",45,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOORCPY",46,0)
 K PSOCOPY D ^PSOBUILD,ACT^PSOORNE2
"RTN","PSOORCPY",47,0)
EX S X=PSODFN_";DPT(" D ULK^ORX2
"RTN","PSOORCPY",48,0)
 D UL^PSSLOCK(PSODFN)
"RTN","PSOORCPY",49,0)
 K PSOMSG,PSONEW,PSOSIG,STA,DREN,PSODAYS,PSORXST,PSOCOPY,PSORXED,FST,FLD,IEN,FLN,INCOM,PSOI,COPY,SIG,SIGOK,PSODRUG,^TMP("PSOPO",$J)
"RTN","PSOORCPY",50,0)
 D CLEAN^PSOVER1,EOJ^PSONEW
"RTN","PSOORCPY",51,0)
 Q
"RTN","PSOORCPY",52,0)
LOCK ;
"RTN","PSOORCPY",53,0)
 I $P($G(PSOPLCK),"^")'=0 Q
"RTN","PSOORCPY",54,0)
 W !!,$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2),1:"Another person")_" is working on this patient."
"RTN","PSOORCPY",55,0)
 K DIR S DIR(0)="E",DIR("A")="     Press Return to Continue" D ^DIR K DIR
"RTN","PSOORCPY",56,0)
 Q
"RTN","PSOORDRG")
0^70^B42987232
"RTN","PSOORDRG",1,0)
PSOORDRG ;BIR/SAB - order entry drug selection ;11/13/97
"RTN","PSOORDRG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,29,49,46,81,105,134,144,132,188,207,148**;DEC 1997
"RTN","PSOORDRG",3,0)
 ;External references to ^PSJORUT2 supported by DBIA 2376
"RTN","PSOORDRG",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORDRG",5,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSOORDRG",6,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORDRG",7,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORDRG",8,0)
 ;External reference to ^PS(56 supported by DBIA 2229
"RTN","PSOORDRG",9,0)
 ;External reference to ^PS(50.416 supported by DBIA 692
"RTN","PSOORDRG",10,0)
 ;External reference to DDIEX^PSNAPIS supported by DBIA 2574
"RTN","PSOORDRG",11,0)
 ;External references to ^ORRDI1 supported by DBIA 4659
"RTN","PSOORDRG",12,0)
 ;Reference to $$GETNDC^PSSNDCUT supported by IA 4707
"RTN","PSOORDRG",13,0)
 ;
"RTN","PSOORDRG",14,0)
EN(PSODFN,DREN) ;
"RTN","PSOORDRG",15,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC"),^TMP($J,"DI"_PSODFN),PSOPHI S INDX=0
"RTN","PSOORDRG",16,0)
 ;build patient's drug profile outpat/inpat/non-va
"RTN","PSOORDRG",17,0)
 D BLD,ENCHK^PSJORUT2(PSODFN,.INDX),NVA
"RTN","PSOORDRG",18,0)
 ;collect drug info
"RTN","PSOORDRG",19,0)
DRG ;S X=DREN,DIC="^PSDRUG(",DIC(0)="MQNZO" D ^DIC K DIC,PSOY Q:Y<1  S PSOY=Y,PSOY(0)=Y(0) K X,Y
"RTN","PSOORDRG",20,0)
 N PSOICT S PSOICT=""
"RTN","PSOORDRG",21,0)
 S PSOY=DREN_"^"_$P($G(^PSDRUG(DREN,0)),"^"),PSOY(0)=$G(^PSDRUG(DREN,0)) K X,Y
"RTN","PSOORDRG",22,0)
 S PSODRUG("IEN")=+PSOY,PSODRUG("VA CLASS")=$P(PSOY(0),"^",2),PSODRUG("NAME")=$P(PSOY(0),"^")
"RTN","PSOORDRG",23,0)
 S:+$G(^PSDRUG(+PSOY,2)) PSODRUG("OI")=+$G(^(2)),PSODRUG("OIN")=$P(^PS(50.7,+$G(^(2)),0),"^")
"RTN","PSOORDRG",24,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(+PSOY,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORDRG",25,0)
 S PSODRUG("MAXDOSE")=$P(PSOY(0),"^",4),PSODRUG("DEA")=$P(PSOY(0),"^",3),PSODRUG("CLN")=$S($D(^PSDRUG(+PSOY,"ND")):+$P(^("ND"),"^",6),1:0)
"RTN","PSOORDRG",26,0)
 S PSODRUG("SIG")=$P(PSOY(0),"^",5),PSODRUG("NDC")=$$GETNDC^PSSNDCUT(+PSOY,$G(PSOSITE))
"RTN","PSOORDRG",27,0)
 S PSODRUG("DAW")=$$GET1^DIQ(50,+PSOY,81)
"RTN","PSOORDRG",28,0)
 S PSOX1=$G(^PSDRUG(+PSOY,660)),PSODRUG("COST")=$P($G(PSOX1),"^",6),PSODRUG("UNIT")=$P($G(PSOX1),"^",8),PSODRUG("EXPIRATION DATE")=$P($G(PSOX1),"^",9)
"RTN","PSOORDRG",29,0)
 K PSOX1,PSOY Q:$G(POERR)
"RTN","PSOORDRG",30,0)
 ;dup drug/class check
"RTN","PSOORDRG",31,0)
 S DNM=0 F  S DNM=$O(^TMP($J,"ORDERS",DNM)) Q:'DNM  D
"RTN","PSOORDRG",32,0)
 .S DRNM=$P(^TMP($J,"ORDERS",DNM),"^",3)
"RTN","PSOORDRG",33,0)
 .I PSODRUG("NAME")=DRNM S DD=$G(DD)+1,^TMP($J,"DD",DD,0)=PSODRUG("IEN")_"^"_PSODRUG("NAME")_"^"_$P(^TMP($J,"ORDERS",DNM),"^",4)_"^"_$P(^(DNM),"^",5) Q:'$G(PSOPHI)
"RTN","PSOORDRG",34,0)
 .I PSODRUG("VA CLASS")]"",$E(PSODRUG("VA CLASS"),1,4)=$E($P(^TMP($J,"ORDERS",DNM),"^"),1,4),DRNM'=PSODRUG("NAME") D
"RTN","PSOORDRG",35,0)
 ..I $E(PSODRUG("VA CLASS"),1,2)="HA",$E($P(^TMP($J,"ORDERS",DNM),"^"),1,2)="HA" Q
"RTN","PSOORDRG",36,0)
 ..S PSODC=$O(^PS(50.605,"B",PSODRUG("VA CLASS"),0)) Q:'PSODC
"RTN","PSOORDRG",37,0)
 ..S DC=$G(DC)+1,^TMP($J,"DC",DC,0)=PSODRUG("VA CLASS")
"RTN","PSOORDRG",38,0)
 ..S PSODC=$P(^PS(50.605,PSODC,0),"^",2),^TMP($J,"DC",DC,0)=^TMP($J,"DC",DC,0)_"^"_PSODC_"^"_$O(^PSDRUG("B",DRNM,0))_"^"_DRNM_"^"_$P(^TMP($J,"ORDERS",DNM),"^",4)_"^"_$P(^(DNM),"^",5)
"RTN","PSOORDRG",39,0)
 ;drug interaction check
"RTN","PSOORDRG",40,0)
 S DRG=0
"RTN","PSOORDRG",41,0)
 F  S DRG=$O(^TMP($J,"ORDERS",DRG)) Q:'DRG  S NDF=$P(^TMP($J,"ORDERS",DRG),"^",2) D
"RTN","PSOORDRG",42,0)
 .S IT=0,PSOICT=""
"RTN","PSOORDRG",43,0)
 .F  S IT=$O(^PS(56,"APD",NDF,PSODRUG("NDF"),IT)) Q:'IT  D
"RTN","PSOORDRG",44,0)
 ..Q:$$DDIEX^PSNAPIS($P(NDF,"A"),$P(NDF,"A",2))
"RTN","PSOORDRG",45,0)
 ..Q:$$DDIEX^PSNAPIS($P(PSODRUG("NDF"),"A"),$P(PSODRUG("NDF"),"A",2))
"RTN","PSOORDRG",46,0)
 ..Q:$P(^PS(56,IT,0),"^",7)&($P(^PS(56,IT,0),"^",7)<DT)
"RTN","PSOORDRG",47,0)
 ..I 'PSOICT S PSOICT=IT Q
"RTN","PSOORDRG",48,0)
 ..I $P($G(^PS(56,IT,0)),"^",4)=1 S PSOICT=IT Q
"RTN","PSOORDRG",49,0)
 ..Q
"RTN","PSOORDRG",50,0)
 .I 'PSOICT Q
"RTN","PSOORDRG",51,0)
 .S IT=PSOICT
"RTN","PSOORDRG",52,0)
 .S DRNM=$P(^TMP($J,"ORDERS",DRG),"^",3),ORN=$P(^(DRG),"^",4),RXN=$P(^(DRG),"^",5)
"RTN","PSOORDRG",53,0)
 .S DI=$G(DI)+1,^TMP($J,"DI",DI,0)=$O(^PSDRUG("B",DRNM,0))_"^"_DRNM_"^"_IT_"^"_$S($P(^PS(56,IT,0),"^",4)=1:"CRITICAL",1:"SIGNIFICANT")_"^"
"RTN","PSOORDRG",54,0)
 .S ^TMP($J,"DI",DI,0)=^TMP($J,"DI",DI,0)_$P(^PS(50.416,$P(^PS(56,IT,0),"^",2),0),"^")_"^"_$P(^PS(50.416,$P(^PS(56,IT,0),"^",3),0),"^")_"^"_ORN_"^"_RXN
"RTN","PSOORDRG",55,0)
 I +$G(PSODRUG("NDF"))'=0 D
"RTN","PSOORDRG",56,0)
 .I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSOORDRG",57,0)
 .I '$$HAVEHDR^ORRDI1 Q
"RTN","PSOORDRG",58,0)
 .D REMOTE^PSOORRDI(PSODFN,DREN)
"RTN","PSOORDRG",59,0)
 .K ^TMP($J,"DI"_PSODFN) ;THIS LEVEL ONLY NEEDED FOR BACKDOOR OUTPATIENT PHARMACY CHECKS
"RTN","PSOORDRG",60,0)
 Q:$G(PSOPHI)
"RTN","PSOORDRG",61,0)
EXIT K ^TMP($J,"ORDERS"),DFN,DA,DNM,DUPRX0,RX,Y,ZZ,PSOCLOZ,PSOY,DRG,DNM,DD,DI,DC,IT,PSODRUG,PSOY,ORN,DRNM
"RTN","PSOORDRG",62,0)
 K PSOX,EXPDT,PSODRUG0,PSORX0,PSORX2,PSORX3,PSOST0,PSOVACL,X,Y,X1,X2,RXN
"RTN","PSOORDRG",63,0)
 Q
"RTN","PSOORDRG",64,0)
BLD K ^TMP($J,"ORDERS") I '$D(PSODFN)!('$D(DT)) G EXIT
"RTN","PSOORDRG",65,0)
 S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X D BUILD G GETX
"RTN","PSOORDRG",66,0)
 Q
"RTN","PSOORDRG",67,0)
BUILD ;build profiles
"RTN","PSOORDRG",68,0)
 S EXPDT=PSODTCUT-1,RX=0
"RTN","PSOORDRG",69,0)
 F  S EXPDT=$O(^PS(55,PSODFN,"P","A",EXPDT)) Q:'EXPDT  F  S RX=$O(^PS(55,PSODFN,"P","A",EXPDT,RX)) Q:'RX  I $D(^PSRX(RX,0)) D GET
"RTN","PSOORDRG",70,0)
 S EN=0
"RTN","PSOORDRG",71,0)
 F PSOEN=0:0 S PSOEN=$O(^PS(52.41,"AOR",PSODFN,PSOEN)) Q:'PSOEN  D
"RTN","PSOORDRG",72,0)
 .F  S EN=$O(^PS(52.41,"AOR",PSODFN,PSOEN,EN)) Q:'EN  D
"RTN","PSOORDRG",73,0)
 ..S PSOOI=^PS(52.41,EN,0) I $P(PSOOI,"^",3)'="DC"&($P(PSOOI,"^",3)'="DE") D:'$P(^PS(52.41,EN,0),"^",9) BLDOI I $P(^PS(52.41,EN,0),"^",9) S PSODD=+$P(PSOOI,"^",9) D SETTMP
"RTN","PSOORDRG",74,0)
 D BUILDX
"RTN","PSOORDRG",75,0)
 Q
"RTN","PSOORDRG",76,0)
 ;
"RTN","PSOORDRG",77,0)
BLDOI ;If no DD/non-standard dose, get all drugs for OI
"RTN","PSOORDRG",78,0)
 N PSOI S PSOI=$P(PSOOI,"^",8) Q:'PSOOI
"RTN","PSOORDRG",79,0)
 S PSODD="" F  S PSODD=$O(^PSDRUG("ASP",PSOI,PSODD)) Q:'PSODD  D SETTMP
"RTN","PSOORDRG",80,0)
 Q
"RTN","PSOORDRG",81,0)
 ;
"RTN","PSOORDRG",82,0)
SETTMP ;Create ^TMP($J,"ORDERS"
"RTN","PSOORDRG",83,0)
 Q:$P(PSOOI,"^",3)="RF"
"RTN","PSOORDRG",84,0)
 S DRG=$S(PSODD:$P($G(^PSDRUG(PSODD,0)),"^"),1:"") Q:DRG']""
"RTN","PSOORDRG",85,0)
 S INDX=$G(INDX)+1,^TMP($J,"ORDERS",INDX)=$S(PSODD:$P(^PSDRUG(PSODD,0),"^",2),1:"")_"^"_$S($G(^PSDRUG(PSODD,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)_"^"_DRG_"^"_$P(^PS(52.41,EN,0),"^")_"^"_EN_"P;O"
"RTN","PSOORDRG",86,0)
 Q
"RTN","PSOORDRG",87,0)
 ;
"RTN","PSOORDRG",88,0)
BUILDX K EN,PSOOI,PSODD,PSOEN Q
"RTN","PSOORDRG",89,0)
 ;
"RTN","PSOORDRG",90,0)
GET ;data for profiles
"RTN","PSOORDRG",91,0)
 S PSORX0=^PSRX(RX,0),PSOST0=+^("STA") Q:PSOST0>5&(PSOST0'=16)
"RTN","PSOORDRG",92,0)
 S PSORX2=$G(^PSRX(RX,2)),PSORX3=$G(^(3)),ORN=$P($G(^("OR1")),"^",2) S:PSORX3="" PSORX3=$P(PSORX2,"^",2)
"RTN","PSOORDRG",93,0)
 S PSODRUG=+$P(PSORX0,"^",6) Q:'$D(^PSDRUG(PSODRUG,0))
"RTN","PSOORDRG",94,0)
 S PSODRUG0=^PSDRUG(PSODRUG,0),PSOVACL=$P(PSODRUG0,"^",2)
"RTN","PSOORDRG",95,0)
 ;
"RTN","PSOORDRG",96,0)
 I EXPDT<DT D
"RTN","PSOORDRG",97,0)
 .N DIE,DIC,DR,DA S STAT="SC",DIE=52,DA=RX,DR="100////11" D ^DIE K DIE,DIC,DR,DA
"RTN","PSOORDRG",98,0)
 .D ECAN^PSOUTL(RX) S DA=RX
"RTN","PSOORDRG",99,0)
 .S COMM="Prescription Expired",PHARMST="ZE" D EN^PSOHLSN1(DA,STAT,PHARMST,COMM)
"RTN","PSOORDRG",100,0)
 S INDX=$G(INDX)+1
"RTN","PSOORDRG",101,0)
 S ^TMP($J,"ORDERS",INDX)=PSOVACL_"^"_$S($G(^PSDRUG(PSODRUG,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)_"^"_$P(^PSDRUG(PSODRUG,0),"^")_"^"_ORN_"^"_RX_"R;O"
"RTN","PSOORDRG",102,0)
 Q
"RTN","PSOORDRG",103,0)
GETX ;
"RTN","PSOORDRG",104,0)
 K PSOX,EXPDT,PSODRUG,PSODRUG0,PSORX0,PSORX2,PSORX3,PSOST0,PSOVACL,X,Y,X1,X2,ORN
"RTN","PSOORDRG",105,0)
 Q
"RTN","PSOORDRG",106,0)
CLOZ ;
"RTN","PSOORDRG",107,0)
 S ANQRTN=$P(^PSDRUG(PSODRUG("IEN"),"CLOZ1"),"^"),ANQX=0,P(5)=PSODRUG("IEN"),DFN=PSODFN,X=ANQRTN
"RTN","PSOORDRG",108,0)
 X ^%ZOSF("TEST") I  D @("^"_ANQRTN) S:$G(ANQX) PSORX("DFLG")=1
"RTN","PSOORDRG",109,0)
 K P(5),ANQRTN,ANQX,X
"RTN","PSOORDRG",110,0)
 Q
"RTN","PSOORDRG",111,0)
DRGCHK(PSODFN,DREN,DDRUG)    ;Only check DREN against drug in DDRG()
"RTN","PSOORDRG",112,0)
 ;* PSODFN = Patient's DFN
"RTN","PSOORDRG",113,0)
 ;* DREN   = Dispense drug to be checked against the drug in the array
"RTN","PSOORDRG",114,0)
 ;* DDRUG  = The array of dispense drug in the buffer.
"RTN","PSOORDRG",115,0)
 ;*
"RTN","PSOORDRG",116,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC")
"RTN","PSOORDRG",117,0)
 NEW DDRUG0,DDRUGND,COD,PSJINX S COD="",PSJINX=0
"RTN","PSOORDRG",118,0)
 S DDRUG=0 F  S DDRUG=$O(DDRUG(DDRUG)) Q:'DDRUG  D DDRUG^PSJORUT2
"RTN","PSOORDRG",119,0)
 D DRG
"RTN","PSOORDRG",120,0)
 Q
"RTN","PSOORDRG",121,0)
OIDRG(PSODFN,PSOI) ;checks every drug tied to orderable item passed by package use
"RTN","PSOORDRG",122,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC"),DD,DC,DI N DREN S INDX=0,PSOPHI=1
"RTN","PSOORDRG",123,0)
 ;build patient's drug profile inpat/outpat/non-va
"RTN","PSOORDRG",124,0)
 D BLD,ENCHK^PSJORUT2(PSODFN,.INDX),NVA
"RTN","PSOORDRG",125,0)
 F DREN=0:0 S DREN=$O(^PSDRUG("ASP",PSOI,DREN)) Q:'DREN  I $D(^PSDRUG(DREN,O)) D DRG
"RTN","PSOORDRG",126,0)
 K PSOPHI D EXIT
"RTN","PSOORDRG",127,0)
 Q
"RTN","PSOORDRG",128,0)
NVA ;checks existing nva
"RTN","PSOORDRG",129,0)
 F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",I)) Q:'I  D:$D(^PS(55,PSODFN,"NVA",I,0))
"RTN","PSOORDRG",130,0)
 .Q:$P(^PS(55,PSODFN,"NVA",I,0),"^",7)
"RTN","PSOORDRG",131,0)
 .S PSOI=$P(^PS(55,PSODFN,"NVA",I,0),"^"),DRG=$P(^(0),"^",2),ORN=$P(^(0),"^",8)
"RTN","PSOORDRG",132,0)
 .I DRG,$G(^PSDRUG(DRG,0))]"" D NVA1 K DRG Q
"RTN","PSOORDRG",133,0)
 .K DRG F DRG=0:0 S DRG=$O(^PSDRUG("ASP",PSOI,DRG)) Q:'DRG  D:$D(^PSDRUG(DRG,0)) NVA1
"RTN","PSOORDRG",134,0)
 K I,PSOOTC,ORN,PSOI,DRG,DRGN,PSOY,VACL,NDF
"RTN","PSOORDRG",135,0)
 Q
"RTN","PSOORDRG",136,0)
NVA1 S PSOY=$G(^PSDRUG(DRG,0)),DRGN=$P(PSOY,"^"),VACL=$P(PSOY,"^",2)
"RTN","PSOORDRG",137,0)
 S NDF=$S($G(^PSDRUG(DRG,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORDRG",138,0)
 S INDX=$G(INDX)+1,^TMP($J,"ORDERS",INDX)=VACL_"^"_NDF_"^"_DRGN_"^"_ORN_"^"_I_"N;O"
"RTN","PSOORDRG",139,0)
 Q
"RTN","PSOORED1")
0^90^B65457372
"RTN","PSOORED1",1,0)
PSOORED1 ;ISC-BHAM/SAB - edit orders from backdoor ; 03/06/95 10:24
"RTN","PSOORED1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**5,23,46,78,114,117,131,146,223,148**;DEC 1997
"RTN","PSOORED1",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOORED1",4,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOORED1",5,0)
EN(PSORENW) ;
"RTN","PSOORED1",6,0)
 N LST,ORD,ORN K VALMBCK,PSORX("FN") S PSOAC=1,(PSORX("QFLG"),PSORX("DFLG"))=0 ;D DREN^PSOORNW2,INIT
"RTN","PSOORED1",7,0)
 D INIT
"RTN","PSOORED1",8,0)
 D @$S($P(PSOPAR,"^",7):"AUTO^PSONRXN",1:"MANUAL^PSONRXN")
"RTN","PSOORED1",9,0)
 I '$D(PSONEW("RX #")),'$P(PSOPAR,"^",7) D PAUSE^VALM1 K VALMSG,PSONEW("QFLG") S VALMBCK="Q" Q
"RTN","PSOORED1",10,0)
 I '$D(PSONEW("RX #")) K VALMSG D DEL^PSONEW,PAUSE^VALM1 S VALMBCK="Q" Q
"RTN","PSOORED1",11,0)
 S PSORENW("RX #")=PSONEW("RX #") I '$P(PSOPAR,"^",7) D  Q:$G(PSONEW("DFLG"))!($G(PSONEW("QFLG")))
"RTN","PSOORED1",12,0)
 .S PSOX=PSORENW("RX #") D CHECK^PSONRXN
"RTN","PSOORED1",13,0)
 I $G(PSONEW("DFLG"))!$G(PSONEW("QFLG")) D DEL^PSONEW,PAUSE^VALM1 S VALMBCK="Q" K PSORENW Q
"RTN","PSOORED1",14,0)
 D EN^PSOORNE1(.PSORENW) I '$G(PSORX("FN")) D:$P($G(PSOPAR),"^",7)=1  S VALMBCK="Q" Q
"RTN","PSOORED1",15,0)
 .S DIE="^PS(59,",DA=PSOSITE,PSOY=$O(PSONEW("OLD LAST RX#","")),PSOX=PSONEW("OLD LAST RX#",PSOY)
"RTN","PSOORED1",16,0)
 .L +^PS(59,+PSOSITE,PSOY):0
"RTN","PSOORED1",17,0)
 .S DR=$S(PSOY=8:"2003////"_PSOX,PSOY=3:"1002.1////"_PSOX,1:"2003////"_PSOX)
"RTN","PSOORED1",18,0)
 .D:PSOX<$P(^PS(59,+PSOSITE,PSOY),"^",3) ^DIE K DIE,X,Y L -^PS(59,+PSOSITE,PSOY)
"RTN","PSOORED1",19,0)
 .I $D(PSONEW("RX #")) L -^PSRX("B",PSONEW("RX #"))
"RTN","PSOORED1",20,0)
 .K PSOX,PSOY Q
"RTN","PSOORED1",21,0)
 Q:$G(COPY)
"RTN","PSOORED1",22,0)
TRY S $P(^PSRX(PSORENW("OIRXN"),"STA"),"^")=15,DA=PSORENW("OIRXN")
"RTN","PSOORED1",23,0)
 S $P(^PSRX(DA,3),"^",5)=$S($P($G(^PSRX(DA,3)),"^"):$P(^(3),"^"),1:DT)
"RTN","PSOORED1",24,0)
 D REVERSE^PSOBPSU1(DA,,"DC",7),CAN^PSOTPCAN(DA)
"RTN","PSOORED1",25,0)
 ;cancel/discontinue action
"RTN","PSOORED1",26,0)
 S PHARM="",STAT="RP",COMM="Prescription discontinued due to editing." D EN^PSOHLSN1(DA,STAT,PHARM,COMM,PSONOOR) K STAT,PHARM,COMM
"RTN","PSOORED1",27,0)
 S ACOM="Discontinued due to editing. New Rx created "_$P(^PSRX(PSORENW("IRXN"),0),"^")_"."
"RTN","PSOORED1",28,0)
 I $G(^PSRX(DA,"H"))]"" D
"RTN","PSOORED1",29,0)
 .I $P(^PSRX(DA,"STA"),"^")=3!($P(^("STA"),"^")=16) D
"RTN","PSOORED1",30,0)
 ..S DIE=52,DR="22///"_$P(^PSRX(DA,3),"^") D ^DIE S ACOM="Discontinued due to editing while on hold. " K:$P(^PSRX(DA,"H"),"^") ^PSRX("AH",$P(^PSRX(DA,"H"),"^"),DA)
"RTN","PSOORED1",31,0)
 ..S ^PSRX(DA,"H")=""
"RTN","PSOORED1",32,0)
 S RXDA=DA,(DA,SUSDA)=$O(^PS(52.5,"B",RXDA,0)) D:DA
"RTN","PSOORED1",33,0)
 .S SUSD=$P($G(^PS(52.5,DA,0)),"^",2)
"RTN","PSOORED1",34,0)
 .S:+$G(^PS(52.5,DA,"P"))'=1 ACOM="Discontinued due to editing while suspended."
"RTN","PSOORED1",35,0)
 .I $O(^PSRX(RXDA,1,0)) S DA=RXDA D:'$G(^PS(52.5,+SUSDA,"P")) REF^PSOCAN2
"RTN","PSOORED1",36,0)
 .S DA=SUSDA,DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORED1",37,0)
 K SUSD,SUSDA S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2) D
"RTN","PSOORED1",38,0)
 .S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(DA,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOORED1",39,0)
 .S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOORED1",40,0)
 .D NOW^%DTC S ^PSRX(DA,"A",0)="^52.3DA^"_(ACNT+1)_"^"_(ACNT+1),^PSRX(DA,"A",ACNT+1,0)=%_"^C^"_DUZ_"^"_RFCNT_"^"_$G(ACOM)
"RTN","PSOORED1",41,0)
 .I $G(PSOOIFLG),'$G(PSOMRFLG) S $P(^PSRX(DA,"A",ACNT+1,1),"^")="Pharmacy Orderable Item Edited."
"RTN","PSOORED1",42,0)
 .I '$G(PSOOIFLG),$G(PSOMRFLG) S $P(^PSRX(DA,"A",ACNT+1,1),"^")="Medication Route/Schedule Edited."
"RTN","PSOORED1",43,0)
 .I $G(PSOOIFLG),$G(PSOMRFLG) S $P(^PSRX(DA,"A",ACNT+1,1),"^")="Pharmacy Orderable Item and Medication Route/Schedule Edited."
"RTN","PSOORED1",44,0)
 .S REA="C" D EXP^PSOHELP1
"RTN","PSOORED1",45,0)
 I $G(^PS(52.4,DA,0))]"" S PSCDA=DA,DIK="^PS(52.4," D ^DIK S DA=PSCDA K DIK,PSCDA
"RTN","PSOORED1",46,0)
 Q
"RTN","PSOORED1",47,0)
INS K X,QUIT,Y,DIR,DIRUT,DUOUT,DTOUT,DIC,INSDEL,UPMI,^TMP($J,"INS1")
"RTN","PSOORED1",48,0)
 I '$O(^PSRX(PSORXED("IRXN"),6,0)),'$O(PSORXED("DOSE",0)) D UPMI Q:$G(QUIT)  ;G INS1
"RTN","PSOORED1",49,0)
 I $G(^PSRX(PSORXED("IRXN"),"INS"))]"" S PSORXED("FLD",114)=^PSRX(PSORXED("IRXN"),"INS") K UPMI G INS1
"RTN","PSOORED1",50,0)
 K DD,GG F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"INS1",I)) Q:'I  S DD=$G(DD)+1
"RTN","PSOORED1",51,0)
 I $G(DD)=1 S PSORXED("FLD",114)=^PSRX(PSORXED("IRXN"),"INS1",$O(^PSRX(PSORXED("IRXN"),"INS1",0)),0) K UPMI,DD G INS1
"RTN","PSOORED1",52,0)
 I $O(^PSRX(PSORXED("IRXN"),"INS1",0)) D  G INSX
"RTN","PSOORED1",53,0)
 .F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"INS1",I)) Q:'I  S ^TMP($J,"INS1",I,0)=^PSRX(PSORXED("IRXN"),"INS1",I,0)
"RTN","PSOORED1",54,0)
 .S ^TMP($J,"INS1",0)=^PSRX(PSORXED("IRXN"),"INS1",0)
"RTN","PSOORED1",55,0)
 .S DIC="^TMP($J,""INS1"",",DWPK=2,DWLW=80 D EN^DIWE I $G(X)="^" K ^TMP($J,"INS1") Q
"RTN","PSOORED1",56,0)
 .I '$O(^TMP($J,"INS1",0)) S INSDEL=1
"RTN","PSOORED1",57,0)
 .S D=0 F  S D=$O(^PSRX(PSORXED("IRXN"),"INS1",D)) Q:'D  S PSORXED("SIG",D)=^PSRX(PSORXED("IRXN"),"INS1",D,0)
"RTN","PSOORED1",58,0)
INS1 K Y,DIR,DIRUT,DUOUT,DTOUT,DIC,X
"RTN","PSOORED1",59,0)
 I $G(UPMI) K UPMI I $G(^PS(50.7,PSODRUG("OI"),"INS"))]"" S PSORXED("FLD",114)=^PS(50.7,PSODRUG("OI"),"INS")
"RTN","PSOORED1",60,0)
 S:$G(PSORXED("FLD",114))]"" DIR("B")=PSORXED("FLD",114)
"RTN","PSOORED1",61,0)
 S DIR("?")="Enter Quick codes or Free Text",DIR(0)="52,114" D ^DIR
"RTN","PSOORED1",62,0)
 I $D(DTOUT)!($D(DUOUT))!($G(PSORXED("FLD",114))=X) K PSORXED("FLD",114) G INSX
"RTN","PSOORED1",63,0)
 I X'="",X'="@" D SIG^PSOHELP G INS1:'$D(X)
"RTN","PSOORED1",64,0)
 S PSORXED("FLD",114)=X
"RTN","PSOORED1",65,0)
 I $G(INS1)]"" W " ("_$E(INS1,2,9999999)_")"
"RTN","PSOORED1",66,0)
 G:(X']""!(X="@")) INSX
"RTN","PSOORED1",67,0)
 S (PSORXED("INS"),PSORXED("SIG",1))=$E(INS1,2,9999999) D EN^PSOFSIG(.PSORXED)
"RTN","PSOORED1",68,0)
INSX I $P($G(^PS(55,PSODFN,"LAN")),"^") K DIR D
"RTN","PSOORED1",69,0)
 .I $G(^PSRX(PSORXED("IRXN"),"INSS"))]"" S PSORXED("SINS")=^PSRX(PSORXED("IRXN"),"INSS")
"RTN","PSOORED1",70,0)
 .D SINS^PSODIR(.PSORXED) I $G(PSORXED("SINS"))']"" K ^PSRX(PSORXED("IRXN"),"INSS") Q
"RTN","PSOORED1",71,0)
 .S PSORXED("FLD",114.1)=PSORXED("SINS")
"RTN","PSOORED1",72,0)
 K DIRUT,DUOUT,DTOUT,DIR,X,Y,DIC,DWPK
"RTN","PSOORED1",73,0)
 Q
"RTN","PSOORED1",74,0)
INIT ;setup psorenw array
"RTN","PSOORED1",75,0)
 S PSORENW("RX0")=^PSRX(PSORENW("IRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN"))
"RTN","PSOORED1",76,0)
 I $G(PSOSIGFL),$G(PSORX("SIG"))]"" S PSORENW("SIG")=PSORX("SIG"),SIGOK=0
"RTN","PSOORED1",77,0)
 E  D
"RTN","PSOORED1",78,0)
 .I '$P($G(^PSRX(PSORENW("IRXN"),"SIG")),"^",2) S PSORENW("SIG")=$P($G(^("SIG")),"^")
"RTN","PSOORED1",79,0)
 .E  D
"RTN","PSOORED1",80,0)
 ..S SIGOK=1 Q:$O(SIG(0))
"RTN","PSOORED1",81,0)
 ..S D=0 F I=0:0 S D=D+1,I=$O(^PSRX(PSORENW("IRXN"),"SIG1",I)) Q:'I  S SIG(D)=^PSRX(PSORENW("IRXN"),"SIG1",I,0)
"RTN","PSOORED1",82,0)
 ..K PSOX1,D
"RTN","PSOORED1",83,0)
 S PSORENW("OIRXN")=PSORENW("IRXN")
"RTN","PSOORED1",84,0)
 S PSORENW("PROVIDER")=$S($G(PSORENW("PROVIDER")):PSORENW("PROVIDER"),1:$P(PSORENW("RX0"),"^",4))
"RTN","PSOORED1",85,0)
 S (PSORENW("PROVIDER NAME"),PSORX("PROVIDER NAME"))=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSOORED1",86,0)
 I $P($G(^VA(200,PSORENW("PROVIDER"),"PS")),"^",7),$P($G(^("PS")),"^",8) S PSORENW("COSIGNING PROVIDER")=$P($G(^("PS")),"^",8)
"RTN","PSOORED1",87,0)
 S PSORENW("CLINIC")=$S($G(PSORENW("CLINIC")):PSORENW("CLINIC"),1:$P(PSORENW("RX0"),"^",5))
"RTN","PSOORED1",88,0)
 S PSORENW("REMARKS")="New Order Created by "_$S($G(COPY)&('$G(PSOEDIT)):"copying",1:"editing")_" Rx # "_$P(PSORENW("RX0"),"^")_"."
"RTN","PSOORED1",89,0)
 S PSORENW("COSIGNER")=$S($G(PSORENW("COSIGNER")):PSORENW("COSIGNER"),$P(PSORENW("RX3"),"^",3):$P(PSORENW("RX3"),"^",3),1:"")
"RTN","PSOORED1",90,0)
 K:PSORENW("COSIGNER")="" PSORENW("COSIGNER")
"RTN","PSOORED1",91,0)
 S PSORENW("PSODFN")=$P(PSORENW("RX0"),"^",2)
"RTN","PSOORED1",92,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSOORED1",93,0)
 S:$G(PSODRUG("IEN")) PSORENW("DRUG IEN")=PSODRUG("IEN")
"RTN","PSOORED1",94,0)
 I $G(PSORENW("DAYS SUPPLY")) G QTY
"RTN","PSOORED1",95,0)
 S PSORENW("DAYS SUPPLY")=$S($D(CLOZPAT):7,1:$P(PSORENW("RX0"),"^",8))
"RTN","PSOORED1",96,0)
QTY S PSORENW("QTY")=$S($G(PSORENW("QTY")):PSORENW("QTY"),1:$P(PSORENW("RX0"),"^",7))
"RTN","PSOORED1",97,0)
RFN S PSORENW("# OF REFILLS")=$S($D(CLOZPAT):0,$G(PSORENW("# OF REFILLS")):PSORENW("# OF REFILLS"),1:$P(PSORENW("RX0"),"^",9))
"RTN","PSOORED1",98,0)
 S (PSOID,Y,PSORENW("FILL DATE"),PSORENW("ISSUE DATE"))=DT
"RTN","PSOORED1",99,0)
 S:PSORENW("CLINIC") PSORX("CLINIC")=$P(^SC(+PSORENW("CLINIC"),0),"^")
"RTN","PSOORED1",100,0)
 S PSORENW("PATIENT STATUS")=$S($G(PSORENW("PATIENT STATUS")):PSORENW("PATIENT STATUS"),'$P(PSORENW("RX0"),"^",3):$G(^PS(55,PSORENW("PSODFN"),"PS")),1:$P(PSORENW("RX0"),"^",3))
"RTN","PSOORED1",101,0)
 S PSORENW("PTST NODE")=$G(^PS(53,PSORENW("PATIENT STATUS"),0))
"RTN","PSOORED1",102,0)
 S PSDAYS=$S($G(PSORENW("DAYS SUPPLY")):PSORENW("DAYS SUPPLY"),'$P(PSORENW("RX0"),"^",8):$P(PSORENW("PTST NODE"),"^",3),1:$P(PSORENW("RX0"),"^",8))
"RTN","PSOORED1",103,0)
 I $G(PSODRUG("IEN")) S DREN=PSODRUG("IEN"),POERR=1 D DRG^PSOORDRG K POERR
"RTN","PSOORED1",104,0)
 D:$G(PSORENW("# OF REFILLS"))']"" RF
"RTN","PSOORED1",105,0)
 S PSORENW("MAIL/WINDOW")=$S($G(PSORENW("MAIL/WINDOW"))]"":PSORENW("MAIL/WINDOW"),1:$P(PSORENW("RX0"),"^",11))
"RTN","PSOORED1",106,0)
 S PSORX("MAIL/WINDOW")=$S(PSORENW("MAIL/WINDOW")="W":"WINDOW",1:"MAIL")
"RTN","PSOORED1",107,0)
 S PSORENW("COPIES")=$S($G(PSORENW("COPIES")):PSORENW("COPIES"),$P(PSORENW("RX0"),"^",18):$P(PSORENW("RX0"),"^",18),1:1)
"RTN","PSOORED1",108,0)
 S PSORENW("CLERK CODE")=DUZ
"RTN","PSOORED1",109,0)
 S:$G(PSORX("CLERK CODE"))']"" PSORX("CLERK CODE")=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSOORED1",110,0)
 Q:$D(COPY)  S PSORENW("ENT")=0 ;Q:$G(PSOSIGFL)!($D(COPY))
"RTN","PSOORED1",111,0)
 K PSORENW("ENT") F I=0:0 S I=$O(PSORENW("DOSE",I)) Q:'I  S PSORENW("ENT")=$G(PSORENW("ENT"))+1
"RTN","PSOORED1",112,0)
 I $O(^TMP($J,"INS1",0)) D
"RTN","PSOORED1",113,0)
 .K PSORXED("SIG"),DD
"RTN","PSOORED1",114,0)
 .F I=0:0 S I=$O(^TMP($J,"INS1",I)) Q:'I  S PSORENW("SIG",I)=^TMP($J,"INS1",I,0)
"RTN","PSOORED1",115,0)
 .K ^TMP($J,"INS1")
"RTN","PSOORED1",116,0)
 I $G(^PSRX(PSORENW("IRXN"),"INS"))]"" S PSORENW("INS")=^PSRX(PSORENW("IRXN"),"INS")
"RTN","PSOORED1",117,0)
 I $G(^PSRX(PSORENW("IRXN"),"INSS"))]"" S PSORENW("SINS")=^PSRX(PSORENW("IRXN"),"INSS")
"RTN","PSOORED1",118,0)
 I '$G(PSORENW("ENT")),'$G(PSOSIGFL) D DOLST1^PSOORED3(.PSORENW) S PSORENW("ENT")=+$G(OLENT)
"RTN","PSOORED1",119,0)
 Q
"RTN","PSOORED1",120,0)
RF ;# of refills
"RTN","PSOORED1",121,0)
 S PTRF=$S($P(PSORENW("PTST NODE"),"^",4)]"":$P(PSORENW("PTST NODE"),"^",4),1:11)
"RTN","PSOORED1",122,0)
 S CS=0 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S CS=1
"RTN","PSOORED1",123,0)
 I CS D
"RTN","PSOORED1",124,0)
 .S PSOX1=$S(PTRF>5:5,1:PTRF),PSOX=$S(PSOX1=5:5,1:PSOX1)
"RTN","PSOORED1",125,0)
 .S PSOX=$S('PSOX:0,PSDAYS=90:1,1:PSOX),PSDY1=$S(PSDAYS<60:5,PSDAYS'<60&(PSDAYS'>89):2,PSDAYS=90:1,1:0) S PSORENW("# OF REFILLS")=$S(PSOX'>PSDY1:PSOX,1:PSDY1)
"RTN","PSOORED1",126,0)
 E  D
"RTN","PSOORED1",127,0)
 .S PSOX1=PTRF,PSOX=$S(PSOX1=11:11,1:PSOX1),PSOX=$S('PSOX:0,PSDAYS=90:3,1:PSOX)
"RTN","PSOORED1",128,0)
 .S PSDY1=$S(PSDAYS<60:11,PSDAYS'<60&(PSDAYS'>89):5,PSDAYS=90:3,1:0) S PSORENW("# OF REFILLS")=$S(PSOX'>PSDY1:PSOX,1:PSDY1)
"RTN","PSOORED1",129,0)
 I PSODRUG("DEA")["A"&(PSODRUG("DEA")'["B")!(PSODRUG("DEA")["F") S PSORENW("# OF REFILLS")=0
"RTN","PSOORED1",130,0)
 K PSDY,PSDY1,PTRF,PSOX,PSOX1,PSDAYS,CS
"RTN","PSOORED1",131,0)
 Q
"RTN","PSOORED1",132,0)
UPMI ;add dosing data for pre-poe rxs
"RTN","PSOORED1",133,0)
 W !! K PSONEW("DFLG"),DIR,DIRUT,DTOUT,DUOUT S DIR(0)="Y",DIR("B")="No",DIR("A")="Dosing Instructions Are Missing!! Do You Want to Add Them"
"RTN","PSOORED1",134,0)
 D ^DIR I 'Y!($D(DIRUT)) S QUIT=1 K DIR,DIRUT,DUOT,DUOUT Q
"RTN","PSOORED1",135,0)
 S UPMI=1,EDTHLD=$G(PSORX("EDIT")) K PSORX("EDIT")
"RTN","PSOORED1",136,0)
 D DOSE1^PSOORED5(.PSORXED) S (PSORXED,PSORX("EDIT"))=EDTHLD K EDTHLD I $G(PSONEW("DFLG")) S QUIT=1
"RTN","PSOORED1",137,0)
 Q
"RTN","PSOORED2")
0^69^B62628461
"RTN","PSOORED2",1,0)
PSOORED2 ;ISC-BHAM/SAB-edit orders from backdoor con't ;03/06/95 10:24
"RTN","PSOORED2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,51,46,78,102,114,117,133,159,148**;DEC 1997
"RTN","PSOORED2",3,0)
 ;Reference to $$DIVNCPDP^BPSBUTL supported by IA 4719
"RTN","PSOORED2",4,0)
 ;called from psooredt. cmop edit checks.
"RTN","PSOORED2",5,0)
 Q
"RTN","PSOORED2",6,0)
ISDT D CHK K RF I $G(CMRL) W !,"Released by CMOP.  No editing allowed on Issue Date." D PAUSE^VALM1 K CMRL Q
"RTN","PSOORED2",7,0)
 S %DT="AEX",%DT(0)=-$P(^PSRX(DA,2),"^",2),Y=$P(RX0,"^",13) X ^DD("DD") S %DT("A")="ISSUE DATE: ",%DT("B")=Y D ^%DT I "^"[$E(X) K X,Y,%DT,DTOUT,DUOUT Q
"RTN","PSOORED2",8,0)
 G:Y=-1 ISDT S PSORXED("FLD",1)=Y
"RTN","PSOORED2",9,0)
 ;S DR="1///"_Y,DIE=52 D ^DIE
"RTN","PSOORED2",10,0)
 D KV K X,Y,%DT
"RTN","PSOORED2",11,0)
 Q
"RTN","PSOORED2",12,0)
FLDT D CHK K RF I $G(CMRL) W !,"Released by CMOP.  No editing allowed on Fill Date." D PAUSE^VALM1 K CMRL Q
"RTN","PSOORED2",13,0)
 D KV S Y=$P(^PSRX(DA,2),"^",2) X ^DD("DD") S DIR("A")="FILL DATE",DIR("B")=Y
"RTN","PSOORED2",14,0)
 S DIR(0)="D^"_$P(RX0,"^",13)_":"_$P(PSORXED("RX2"),"^",6)_":EX"
"RTN","PSOORED2",15,0)
 S DIR("?",1)="The earliest fill date allowed is determined by the Issue Date,",DIR("?",2)="the Fill Date cannot be before the Issue Date or past the Expiration Date."
"RTN","PSOORED2",16,0)
 S DIR("?")="Both the month and day are required." D ^DIR
"RTN","PSOORED2",17,0)
 I $D(DIRUT) D KV K PSORXED("FLD",22),X,Y Q
"RTN","PSOORED2",18,0)
 S PSORXED("FLD",22)=Y ;S DR="22R///"_Y,DIE=52 D ^DIE
"RTN","PSOORED2",19,0)
 K X,Y
"RTN","PSOORED2",20,0)
KV K DIR,DUOUT,DTOUT,DIRUT
"RTN","PSOORED2",21,0)
 Q
"RTN","PSOORED2",22,0)
CHK I $D(^PSRX("AR",+$P(PSORXED("RX2"),"^",13),PSORXED("IRXN"))) S CMRL=1 Q
"RTN","PSOORED2",23,0)
 F RF=0:0 S RF=$O(^PSRX(PSORXED("IRXN"),1,RF)) Q:'RF  I $D(^PSRX("AR",+$P(^PSRX(PSORXED("IRXN"),1,RF,0),"^",18),PSORXED("IRXN"))) S CMRL=1
"RTN","PSOORED2",24,0)
 Q
"RTN","PSOORED2",25,0)
CHK1 I +^PSRX(PSORXED("IRXN"),"STA")=5 D  Q:'$G(CMRL)
"RTN","PSOORED2",26,0)
 .S SURX=$O(^PS(52.5,PSORXED("IRXN"),0)) Q:'SURX  I $P(^PS(52.5,SURX,0),"^",7)']""!($P(^(0),"^",7)="Q") S CMRL=1
"RTN","PSOORED2",27,0)
 .E  S CMRL=0
"RTN","PSOORED2",28,0)
 F FEV=0:0 S FEV=$O(^PSRX(PSORXED("IRXN"),4,FEV)) Q:'FEV  I '$P(^PSRX(PSORXED("IRXN"),4,FEV,0),"^",3),$P(^(0),"^",4)<3 S CMRL=0
"RTN","PSOORED2",29,0)
 Q
"RTN","PSOORED2",30,0)
REF ;shows refill info
"RTN","PSOORED2",31,0)
 S RFN=0 F N=0:0 S N=$O(^PSRX(PSORXED("IRXN"),1,N)) Q:'N  S RFM=N,RFN=RFN+1
"RTN","PSOORED2",32,0)
 ;G:RFM=1 SRF 
"RTN","PSOORED2",33,0)
 W ! K DA,DR D KV S DIR(0)="Y",DIR("B")="No",DIR("A")="There "_$S(RFN>1:"are ",1:"is ")_RFN_" refill"_$S(RFN>1:"s.",1:".")_"  Do you want to edit"
"RTN","PSOORED2",34,0)
 D ^DIR D KV Q:'Y
"RTN","PSOORED2",35,0)
SRF W !!,"#  Log Date   Refill Date  Qty               Routing  Lot #       Pharmacist",! F I=1:1:80 W "="
"RTN","PSOORED2",36,0)
 F N=0:0 S N=$O(^PSRX(PSORXED("IRXN"),1,N)) Q:'N  S P1=^(N,0) D
"RTN","PSOORED2",37,0)
 .S DTT=$P(P1,"^",8)\1 D DAT S LOG=DAT,DTT=$P(P1,"^"),$P(RN," ",10)=" " D DAT
"RTN","PSOORED2",38,0)
 .W !,N_"  "_LOG_"   "_DAT_"      "_$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)_"  "_$S($P(P1,"^",2)="M":"MAIL  ",1:"WINDOW")_"   "_$P(P1,"^",6)_$E(RN,$L($P(P1,"^",6))+1,12)
"RTN","PSOORED2",39,0)
 .W $E($S($D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16)
"RTN","PSOORED2",40,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"Unknown") W !,"Division: "_PSDIV_$E("        ",$L(PSDIV)+1,8)_"  "
"RTN","PSOORED2",41,0)
 .W "Dispensed: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")_"  "
"RTN","PSOORED2",42,0)
 .S RTS=$S($P(P1,"^",16):" Returned to Stock: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" Released: "_$S($P(P1,"^",18):$E($P(P1,"^",18),4,5)_"/"_$E($P(P1,"^",18),6,7)_"/"_$E($P(P1,"^",18),2,3),1:""))
"RTN","PSOORED2",43,0)
 .W RTS W:$P(P1,"^",3)]"" !,"   Remarks: "_$P(P1,"^",3)
"RTN","PSOORED2",44,0)
 S DA(1)=PSORXED("IRXN") I RFN=1 S Y=RFM G RFM
"RTN","PSOORED2",45,0)
 W ! D KV S DIR("A")="Select a Refill",DIR(0)="NO^1:"_RFM_":0" D ^DIR Q:$D(DIRUT)
"RTN","PSOORED2",46,0)
RFM I '$D(^PSRX(PSORXED("IRXN"),1,Y,0)) W !,$C(7),"Invalid selection.",! G SRF
"RTN","PSOORED2",47,0)
 S CMRL=0 I $D(^PSRX("AR",+$P(^PSRX(PSORXED("IRXN"),1,Y,0),"^",18),PSORXED("IRXN"),Y)) S CMRL=1 G RFX
"RTN","PSOORED2",48,0)
 F FEV=0:0 S FEV=$O(^PSRX(PSORXED("IRXN"),4,FEV)) Q:'FEV  I $P(^PSRX(PSORXED("IRXN"),4,FEV,0),"^",3)=Y,$P(^(0),"^",4)<3 S CMRL=1
"RTN","PSOORED2",49,0)
RFX N RFL,NDC,DAW,FLDS,QUIT,CHGNDC,CHANGED
"RTN","PSOORED2",50,0)
 W ! S DA=Y,DIE="^PSRX("_DA(1)_",1,",DR=$S('CMRL:".01;1.1",1:"1.2:5;8")
"RTN","PSOORED2",51,0)
 D GETS^DIQ(52.1,DA_","_DA(1)_",",".01;1;1.1;8;11;81","I","FLDS")
"RTN","PSOORED2",52,0)
 S:$D(^PSRX(DA(1),1,DA,0)) PSORXED("RX1")=^PSRX(DA(1),1,DA,0),(RFED,RFL)=DA
"RTN","PSOORED2",53,0)
 D ^DIE S QUIT=$D(Y) K FEV,RFN,RFM,X,Y,DR
"RTN","PSOORED2",54,0)
 I '$G(DA) D REVERSE^PSOBPSU1(PSORXED("IRXN"),RFL,"DE",5) K CMRL,RFED D:$D(PSORX("PSOL"))&($G(DI)=.01) RFD Q
"RTN","PSOORED2",55,0)
 I 'CMRL,'QUIT S DR="1;1.2:5;8" D ^DIE S QUIT=$D(Y)
"RTN","PSOORED2",56,0)
 I '$D(^PSRX(PSORXED("IRXN"),1,RFL)) Q
"RTN","PSOORED2",57,0)
 I 'QUIT,$$STATUS^PSOBPSUT(PSORXED("IRXN"),RFL)'="" D
"RTN","PSOORED2",58,0)
 . S NDC=$$GETNDC^PSONDCUT(PSORXED("IRXN"),RFL)
"RTN","PSOORED2",59,0)
 . D EDTDAW^PSODAWUT(PSORXED("IRXN"),RFL,.DAW) I $G(DAW)="^" Q
"RTN","PSOORED2",60,0)
 . D SAVDAW^PSODAWUT(PSORXED("IRXN"),RFL,+$G(DAW))
"RTN","PSOORED2",61,0)
 . D NDC^PSODRG(PSORXED("IRXN"),RFL,,.NDC) I $G(NDC)="^",$G(NDC)="" Q
"RTN","PSOORED2",62,0)
 . I NDC'=$$GETNDC^PSONDCUT(PSORXED("IRXN"),RFL) S CHGNDC=1
"RTN","PSOORED2",63,0)
 . D SAVNDC^PSONDCUT(PSORXED("IRXN"),RFL,NDC)
"RTN","PSOORED2",64,0)
 S CHANGED=$$CHANGED(PSORXED("IRXN"),RFL,.FLDS)
"RTN","PSOORED2",65,0)
 I CHANGED D
"RTN","PSOORED2",66,0)
 . I $P(CHANGED,"^",2),'$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(PSORXED("IRXN"),RFL)) D  Q
"RTN","PSOORED2",67,0)
 . . D REVERSE^PSOBPSU1(PSORXED("IRXN"),RFL,"DC",99,"REFILL DIVISION CHANGED",1)
"RTN","PSOORED2",68,0)
 . I $$SUBMIT^PSOBPSUT(PSORXED("IRXN"),RFL,1) D
"RTN","PSOORED2",69,0)
 . . N RX S RX=PSORXED("IRXN")
"RTN","PSOORED2",70,0)
 . . I '$P(CHANGED,"^",2),$$STATUS^PSOBPSUT(RX,RFL)="" Q
"RTN","PSOORED2",71,0)
 . . D ECMESND^PSOBPSU1(RX,RFL,,"ED",$$GETNDC^PSONDCUT(RX,RFL),,$S($P(CHANGED,"^",2):"REFILL DIVISION CHANGED",1:"REFILL EDITED"),,+$G(CHGNDC))
"RTN","PSOORED2",72,0)
 . . ;- Checking/Handling DUR/79 Rejects
"RTN","PSOORED2",73,0)
 . . I $$FIND^PSOREJUT(RX,RFL) S X=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","IOQ","I")
"RTN","PSOORED2",74,0)
 K DIE,CMRL,DA,DR
"RTN","PSOORED2",75,0)
 Q
"RTN","PSOORED2",76,0)
CHANGED(RX,RFL,PRIOR) ; - Check if fields have changed and should for 3rd Party Claim resubmission
"RTN","PSOORED2",77,0)
 ;Input:  (r) RX    - Rx IEN
"RTN","PSOORED2",78,0)
 ;        (r) RFL   - Refill #
"RTN","PSOORED2",79,0)
 ;        (r) PRIOR - Array with fields
"RTN","PSOORED2",80,0)
 ;Output:  CHANGED  - 0 - Not changed / 1 - Refill field changed ^ Rx Division changed (1 - YES)
"RTN","PSOORED2",81,0)
 N CHANGED,SAVED
"RTN","PSOORED2",82,0)
 S CHANGED=0 D GETS^DIQ(52.1,RFL_","_RX_",",".01;1;1.1;8;11;81","I","SAVED")
"RTN","PSOORED2",83,0)
 F I=.01,1,1.1,11,81 I $G(PRIOR(52.1,RFL_","_RX_",",I,"I"))'=$G(SAVED(52.1,RFL_","_RX_",",I,"I")) S CHANGED=1 Q
"RTN","PSOORED2",84,0)
 I $$DIVNCPDP^BPSBUTL(+$G(PRIOR(52.1,RFL_","_RX_",",8,"I")))'=$$DIVNCPDP^BPSBUTL(+$G(SAVED(52.1,RFL_","_RX_",",8,"I"))) S CHANGED="1^1"
"RTN","PSOORED2",85,0)
 Q CHANGED
"RTN","PSOORED2",86,0)
 ;
"RTN","PSOORED2",87,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSOORED2",88,0)
 Q
"RTN","PSOORED2",89,0)
DIE S DIE=52 D ^DIE I $D(Y) S PSORXED("DFLG")=1
"RTN","PSOORED2",90,0)
 K DIE,DR,X,Y
"RTN","PSOORED2",91,0)
 Q
"RTN","PSOORED2",92,0)
RFD ;check for deleted refill
"RTN","PSOORED2",93,0)
 M PSOZ1("PSOL")=PSORX("PSOL") N I,J,K,PSOX2,PSOX3,PSOX9 S (I,K)=0 D
"RTN","PSOORED2",94,0)
 .F  S I=$O(PSOZ1("PSOL",I)) Q:'I!(K)  S PSOX2=PSOZ1("PSOL",I) I PSOX2[(PSORXED("IRXN")_",") S PSOX9="" D
"RTN","PSOORED2",95,0)
 ..F J=1:1 S PSOX3=$P(PSOX2,",",J) Q:'PSOX3  D
"RTN","PSOORED2",96,0)
 ...I 'K,PSOX3=PSORXED("IRXN") S K=1
"RTN","PSOORED2",97,0)
 ...E  S PSOX9=PSOX9_$S('PSOX9:"",1:",")_PSOX3
"RTN","PSOORED2",98,0)
 ..I K S:PSOX9]"" PSORX("PSOL",I)=PSOX9_"," K:PSOX9="" PSORX("PSOL",I)
"RTN","PSOORED2",99,0)
 K PSOZ1("PSOL")
"RTN","PSOORED2",100,0)
 Q
"RTN","PSOORED2",101,0)
EDTDOSE ;edit med instructions fields
"RTN","PSOORED2",102,0)
 I '$O(^PSRX(PSORXED("IRXN"),6,0)) D DOSE^PSOORED5 Q
"RTN","PSOORED2",103,0)
 D ^PSOORED3
"RTN","PSOORED2",104,0)
 Q
"RTN","PSOORED2",105,0)
UPD ;updates dosing array
"RTN","PSOORED2",106,0)
 S HENT=ENT
"RTN","PSOORED2",107,0)
UPD1 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"",'$D(PSORXED("DOSE",(HENT+2))) K PSORXED("CONJUNCTION",(HENT+1)) Q
"RTN","PSOORED2",108,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD1
"RTN","PSOORED2",109,0)
 .K PSORXED("CONJUNCTION",(HENT+1))
"RTN","PSOORED2",110,0)
 .F  Q:'$D(PSORXED("DOSE",(HENT+2)))  D
"RTN","PSOORED2",111,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED2",112,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED2",113,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED2",114,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED2",115,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED2",116,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED2",117,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED2",118,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED2",119,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED2",120,0)
 ..S HENT=HENT+1
"RTN","PSOORED2",121,0)
 ..I $G(PSORXED("CONJUNCTION",(HENT+2)))]"" Q
"RTN","PSOORED2",122,0)
 ..K PSORXED("UNITS",(HENT+1)),PSORXED("NOUN",(HENT+1)),PSORXED("DURATION",(HENT+1)),PSORXED("CONJUNCTION",(HENT+1)),PSORXED("ROUTE",(HENT+1)),PSORXED("SCHEDULE",(HENT+1)),PSORXED("DOSE",(HENT+1)),PSORXED("DOSE ORDERED",(HENT+1))
"RTN","PSOORED2",123,0)
 ..K PSORXED("VERB",(HENT+1)),PSORXED("ODOSE",(HENT+1))
"RTN","PSOORED2",124,0)
 S PSORXED("ENT")=HENT K HENT,SENT D EN^PSOFSIG(.PSORXED)
"RTN","PSOORED2",125,0)
 Q
"RTN","PSOORED2",126,0)
UPD2 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"",'$D(PSORXED("DOSE",(HENT+2))) K PSORXED("CONJUNCTION",(HENT+1)) Q
"RTN","PSOORED2",127,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD1
"RTN","PSOORED2",128,0)
 .K PSORXED("CONJUNCTION",(HENT+1)) I $D(PSORXED("DOSE",(HENT+2))) D
"RTN","PSOORED2",129,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED2",130,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED2",131,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED2",132,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED2",133,0)
 ..S PSORXED("VERB",(HENT+1))=$G(PSORXED("VERB",(HENT+2)))
"RTN","PSOORED2",134,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED2",135,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED2",136,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED2",137,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED2",138,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED2",139,0)
 ..S HENT=HENT+1
"RTN","PSOORED2",140,0)
 ..I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" Q
"RTN","PSOORED2",141,0)
 ..K PSORXED("UNITS",(HENT+1)),PSORXED("NOUN",(HENT+1)),PSORXED("DURATION",(HENT+1)),PSORXED("ROUTE",(HENT+1)),PSORXED("SCHEDULE",(HENT+1)),PSORXED("DOSE",(HENT+1)),PSORXED("DOSE ORDERED",(HENT+1)),PSORXED("VERB",(HENT+1))
"RTN","PSOORED2",142,0)
 ..K PSORXED("ODOSE",(HENT+1))
"RTN","PSOORED2",143,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S SENT=$G(SENT)+1
"RTN","PSOORED2",144,0)
 S PSORXED("ENT")=SENT K HENT,SENT D EN^PSOFSIG(.PSORXED)
"RTN","PSOORED2",145,0)
 Q
"RTN","PSOORED3")
0^72^B55877013
"RTN","PSOORED3",1,0)
PSOORED3 ;BIR/SAB-edit finished orders through backdoor ;05/22/00
"RTN","PSOORED3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,78,99,117,133,148**;DEC 1997
"RTN","PSOORED3",3,0)
 ;External reference to PS(51.2 supported by DBIA 2226
"RTN","PSOORED3",4,0)
 ;called from psoored2
"RTN","PSOORED3",5,0)
 D DOLST
"RTN","PSOORED3",6,0)
 ;
"RTN","PSOORED3",7,0)
DOSE ;adds dosing info
"RTN","PSOORED3",8,0)
 I '$G(PSORXED("ENT")) F  S I=$O(PSORXED("DOSE",I)) Q:'I  S PSORXED("ENT")=$G(PSORXED("ENT"))+1
"RTN","PSOORED3",9,0)
 K ROU,UNITN,STRE,PSODOSE,RTE,NOUN,VERB M PSODOSE=PSORXED
"RTN","PSOORED3",10,0)
 D KV K FIELD,DOSEOR,DOOR,X,Y,UNITS S ENT=1
"RTN","PSOORED3",11,0)
ASK S ROU="PSOORED3" D ASK^PSOBKDED K ROU I $G(JUMP) K JUMP G JUMP
"RTN","PSOORED3",12,0)
 G:$D(DIRUT) EXQ
"RTN","PSOORED3",13,0)
 I $G(QUIT)]"" K QUIT,ROU Q
"RTN","PSOORED3",14,0)
 ;
"RTN","PSOORED3",15,0)
 I $G(VERB)]"" S PSORXED("VERB",ENT)=VERB G DUPD
"RTN","PSOORED3",16,0)
VER D VER^PSOOREDX I X[U,$L(X)>1 S FIELD="VER" G JUMP
"RTN","PSOORED3",17,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",18,0)
 I X="@" K PSORXED("VERB",ENT),VERB G DUPD
"RTN","PSOORED3",19,0)
 S:X'="" (PSORXED("VERB",ENT),VERB)=X
"RTN","PSOORED3",20,0)
DUPD ;
"RTN","PSOORED3",21,0)
 I $G(PSORXED("DOSE",ENT))'?.N&($G(PSORXED("DOSE",ENT))'?.N1".".N)!'DOSE("LD") K PSORXED("DOSE ORDERED",ENT),DUPD G NOU1
"RTN","PSOORED3",22,0)
 D DUPD^PSOOREDX
"RTN","PSOORED3",23,0)
 S DIR("B")=$S($G(PSORXED("DOSE ORDERED",ENT))]"":PSORXED("DOSE ORDERED",ENT),1:"") S:$E($G(DIR("B")),1)="." DIR("B")="0"_$G(DIR("B")) K:DIR("B")="" DIR("B")
"RTN","PSOORED3",24,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUPD" G JUMP
"RTN","PSOORED3",25,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",26,0)
 I X="@"!(X=0) W !,"Dispense Units Per Dose is Required!!",! G DUPD
"RTN","PSOORED3",27,0)
 D STR^PSOOREDX
"RTN","PSOORED3",28,0)
NOU1 G:'$G(PSORXED("DOSE ORDERED",ENT)) RTE
"RTN","PSOORED3",29,0)
 D CNON
"RTN","PSOORED3",30,0)
 N PSONDEF
"RTN","PSOORED3",31,0)
 I $G(NOUN)]"" S PSORXED("NOUN",ENT)=NOUN
"RTN","PSOORED3",32,0)
NOU D NOU^PSOOREDX I X[U,$L(X)>1 S FIELD="NOU" G JUMP
"RTN","PSOORED3",33,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",34,0)
 I X="@" K PSORXED("NOUN",ENT),NOUN G RTE
"RTN","PSOORED3",35,0)
 I X'="",$G(PSONDEF)="" S NOUN=X
"RTN","PSOORED3",36,0)
 I X'="",$G(PSONDEF)'=X S NOUN=X
"RTN","PSOORED3",37,0)
 S:X'="" PSORXED("NOUN",ENT)=X
"RTN","PSOORED3",38,0)
RTE S:$G(PSORXED("ROUTE",ENT))']"" DRET=1
"RTN","PSOORED3",39,0)
 K JUMP S ROU="PSOORED3" D RTE^PSOBKDED K ROU
"RTN","PSOORED3",40,0)
 I $G(JUMP) K JUMP G JUMP
"RTN","PSOORED3",41,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",42,0)
 I $G(QUIT) K QUIT,ROU Q
"RTN","PSOORED3",43,0)
 ;
"RTN","PSOORED3",44,0)
SCH D SCH^PSOBKDED I X[U,$L(X)>1 S FIELD="SCH" G JUMP
"RTN","PSOORED3",45,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",46,0)
 S SCH=Y D SCH^PSOSIG I $G(SCH)']"" G SCH
"RTN","PSOORED3",47,0)
 S PSORXED("SCHEDULE",ENT)=SCH W " ("_SCHEX_")" K SCH,SCHEX,X,Y,PSOSCH
"RTN","PSOORED3",48,0)
 S:PSORXED("ENT")<ENT PSORXED("ENT")=ENT
"RTN","PSOORED3",49,0)
 ;
"RTN","PSOORED3",50,0)
DUR D KV K EXP S DIR(0)="52.0113,4",DIR("A")="LIMITED DURATION (IN MONTHS, WEEKS, DAYS, HOURS OR MINUTES)"
"RTN","PSOORED3",51,0)
 S DIR("B")=$S($G(DUR)]"":DUR,$G(PSORXED("DURATION",ENT))]"":PSORXED("DURATION",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOORED3",52,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUR" G JUMP
"RTN","PSOORED3",53,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",54,0)
 D DUR1^PSOOREDX
"RTN","PSOORED3",55,0)
 ;
"RTN","PSOORED3",56,0)
CON D CON^PSOOREDX I X[U,$L(X)>1 S FIELD="CON" G JUMP
"RTN","PSOORED3",57,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED3",58,0)
 I X="@",$G(PSORXED("CONJUNCTION",ENT))="" W !,?10,"Invalid Entry - nothing to delete!!" G CON
"RTN","PSOORED3",59,0)
 S:X'=""&(X'="@") PSORXED("CONJUNCTION",ENT)=Y
"RTN","PSOORED3",60,0)
 I X="@" D CON1^PSOOREDX G:$D(DIRUT) EXQ G:'Y CON N CKX S CKX=1 D UPD^PSOOREDX G CON
"RTN","PSOORED3",61,0)
 I $G(PSORXED("CONJUNCTION",ENT))]"" S ENT=ENT+1 K DIR G ASK
"RTN","PSOORED3",62,0)
 S DENT=$O(PSORXED("DOSE",ENT)) I DENT,(ENT+1)'=DENT D
"RTN","PSOORED3",63,0)
 .K PSORXED("DOSE",DENT),PSORXED("NOUN",DENT),PSORXED("VERB",DENT),PSORXED("DOSE ORDERED",DENT),PSORXED("ROUTE",DENT),PSORXED("ODOSE",DENT)
"RTN","PSOORED3",64,0)
 .K PSORXED("SCHEDULE",DENT),PSORXED("DURATION",DENT),PSORXED("CONJUNCTION",DENT),DENT
"RTN","PSOORED3",65,0)
 I $G(FIELD)]"" K FIELD S QUIT=1
"RTN","PSOORED3",66,0)
 I $O(^PSRX(PSORXED("IRXN"),"INS1",0)) D
"RTN","PSOORED3",67,0)
 .F D=0:0 S D=$O(^PSRX(PSORXED("IRXN"),"INS1",D)) Q:'D  S PSORXED("SIG",D)=^PSRX(PSORXED("IRXN"),"INS1",D,0)
"RTN","PSOORED3",68,0)
 D EN^PSOFSIG(.PSORXED) D VER^PSOORED7:'$G(PSOVER) I $G(CKX),'$G(PSOSIGFL) D M1 K CKX
"RTN","PSOORED3",69,0)
 I $G(PSOSIGFL)=1 S PSORXED("ENT")=ENT,SIGOK=1 G EX1
"RTN","PSOORED3",70,0)
 K QTY,QTYHLD S:$G(PSORXED("QTY")) QTYHLD=PSORXED("QTY") D QTY^PSOSIG(.PSORXED) I $G(PSORXED("QTY")) S QTY=1
"RTN","PSOORED3",71,0)
 I $G(QTYHLD),'$G(PSORXED("QTY")) S PSORXED("QTY")=QTYHLD
"RTN","PSOORED3",72,0)
 K QTYHLD Q:$G(PSOVER)!($G(PSOREEDQ))
"RTN","PSOORED3",73,0)
UDSIG I $O(SIG(0)) D
"RTN","PSOORED3",74,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSORXED("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSORXED("IRXN"),"SIG1",0),"^",3)=+$P($G(^PSRX(PSORXED("IRXN"),"SIG1",0)),"^",3)+1,$P(^(0),"^",4)=+$P($G(^(0)),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSOORED3",75,0)
 .S (A,I)=0 F  S I=$O(^PSRX(PSORXED("IRXN"),"A",I)) Q:'I  S A=A+1
"RTN","PSOORED3",76,0)
 .D NOW^%DTC I $G(QTY) S A=A+1,^PSRX(PSORXED("IRXN"),"A",A,0)=%_"^E^"_DUZ_"^0^Quantity Updated "_"("_$P(^PSRX(PSORXED("IRXN"),0),"^",7)_")",$P(^PSRX(PSORXED("IRXN"),0),"^",7)=$G(PSORXED("QTY")) K QTY
"RTN","PSOORED3",77,0)
 .S A=A+1,^PSRX(PSORXED("IRXN"),"A",A,0)=%_"^E^"_DUZ_"^0^New Dosing Instructions Added",^PSRX(PSORXED("IRXN"),"A",A,1)="ORIGINAL SIG^" D
"RTN","PSOORED3",78,0)
 ..I '$P($G(^PSRX(PSORXED("IRXN"),"SIG")),"^",2) S $P(^PSRX(PSORXED("IRXN"),"A",A,1),"^",2)=$P($G(^PSRX(PSORXED("IRXN"),"SIG")),"^") Q
"RTN","PSOORED3",79,0)
 ..F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S ^PSRX(PSORXED("IRXN"),"A",A,2,I,0)=^PSRX(PSORXED("IRXN"),"SIG1",I,0),^PSRX(PSORXED("IRXN"),"A",A,2,0)="^52.34A^"_I_"^"_I
"RTN","PSOORED3",80,0)
 .S ^PSRX(PSORXED("IRXN"),"SIG")="^1"
"RTN","PSOORED3",81,0)
 .K SIG,A,I
"RTN","PSOORED3",82,0)
 S ^PSRX(PSORXED("IRXN"),6,0)="^52.0113^"_ENT_"^"_ENT
"RTN","PSOORED3",83,0)
 F I=1:1:ENT S ^PSRX(PSORXED("IRXN"),6,I,0)=PSORXED("DOSE",I)_"^"_$G(PSORXED("DOSE ORDERED",I))_"^"_$G(PSORXED("UNITS",I))_"^"_$G(PSORXED("NOUN",I))_"^" D
"RTN","PSOORED3",84,0)
 .S ^PSRX(PSORXED("IRXN"),6,I,0)=^PSRX(PSORXED("IRXN"),6,I,0)_$G(PSORXED("DURATION",I))_"^"_$G(PSORXED("CONJUNCTION",I))_"^"_$G(PSORXED("ROUTE",I))_"^"_$G(PSORXED("SCHEDULE",I))_"^"_$G(PSORXED("VERB",I))
"RTN","PSOORED3",85,0)
 .S ^PSRX(PSORXED("IRXN"),6,I,1)=$G(PSORXED("ODOSE",I))
"RTN","PSOORED3",86,0)
 S ^PSRX(PSORXED("IRXN"),"POE")=1
"RTN","PSOORED3",87,0)
 G EX
"RTN","PSOORED3",88,0)
 Q
"RTN","PSOORED3",89,0)
EX ;
"RTN","PSOORED3",90,0)
 K PSORXED("DOSE"),DOSE,DUPD,SCH,PSORXED("NOUN"),PSORXED("VERB"),VERB,NOUN,PSORXED("DOSE ORDERED"),DOSEOR,PSORXED("ROUTE"),ENT,PSORTE,SIG,PSODOSE
"RTN","PSOORED3",91,0)
 K PSORXED("SCHEDULE"),PSORXED("DURATION"),PSORXED("CONJUNCTION"),DURA,X,Y,PSORXED("ODOSE")
"RTN","PSOORED3",92,0)
EX1 K STRE,UNITN,DOSE,DUPD,SCH,VERB,NOUN,DOSEOR,RTE,DUR,X,Y,ENTS,PSOSCH,ERTE,ROU
"RTN","PSOORED3",93,0)
KV K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSOORED3",94,0)
 Q
"RTN","PSOORED3",95,0)
EXQ K PSORXED,PSOSIGFL M PSORXED=PSODOSE D EN^PSOFSIG(.PSORXED) S PSORXED("DFLG")=1 D M1 G EX
"RTN","PSOORED3",96,0)
 Q
"RTN","PSOORED3",97,0)
M1 D M1^PSOOREDX
"RTN","PSOORED3",98,0)
 Q
"RTN","PSOORED3",99,0)
DOLST1(PSORXED) ;
"RTN","PSOORED3",100,0)
 ;
"RTN","PSOORED3",101,0)
DOLST F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),6,I)) Q:'I  S INST=^(I,0) D
"RTN","PSOORED3",102,0)
 .S PSORXED("DOSE",I)=$P(INST,"^"),PSORXED("DOSE ORDERED",I)=$P(INST,"^",2),PSORXED("UNITS",I)=$P(INST,"^",3),PSORXED("NOUN",I)=$P(INST,"^",4)
"RTN","PSOORED3",103,0)
 .I $P(INST,"^",5)]"" D
"RTN","PSOORED3",104,0)
 ..S PSORXED("DURATION",I)=$S($E($P(INST,"^",5),1)'?.N:$E($P(INST,"^",5),2,99)_$E($P(INST,"^",5),1),1:$P(INST,"^",5))
"RTN","PSOORED3",105,0)
 .S PSORXED("ROUTE",I)=$P(INST,"^",7),PSORXED("SCHEDULE",I)=$P(INST,"^",8)
"RTN","PSOORED3",106,0)
 .S PSORXED("CONJUNCTION",I)=$P(INST,"^",6),PSORXED("VERB",I)=$P(INST,"^",9),OLENT=I
"RTN","PSOORED3",107,0)
 .S PSORXED("ODOSE",I)=$G(^PSRX(PSORXED("IRXN"),6,I,1))
"RTN","PSOORED3",108,0)
 K:'$O(PSORXED("DOSE",0)) PSORXED("ENT"),OLENT
"RTN","PSOORED3",109,0)
 S PSORXED("INS")=$G(^PSRX(PSORXED("IRXN"),"INS"))
"RTN","PSOORED3",110,0)
 Q
"RTN","PSOORED3",111,0)
UPDSIG ;updates sig
"RTN","PSOORED3",112,0)
 K ^PSRX(PSORXED("IRXN"),"SIG1")
"RTN","PSOORED3",113,0)
 S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSORXED("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSORXED("IRXN"),"SIG1",0),"^",3)=+$P($G(^PSRX(PSORXED("IRXN"),"SIG1",0)),"^",3)+1,$P(^(0),"^",4)=+$P($G(^(0)),"^",4)+1
"RTN","PSOORED3",114,0)
 S ^PSRX(PSORXED("IRXN"),"SIG")="^1"
"RTN","PSOORED3",115,0)
 Q
"RTN","PSOORED3",116,0)
JUMP ;jump to fields
"RTN","PSOORED3",117,0)
 I $L($E(X,2,99))<3 W !,"Field Name Must Be At Least 3 Characters in Length",! G @FIELD
"RTN","PSOORED3",118,0)
 D FNM^PSOOREDX
"RTN","PSOORED3",119,0)
 I FLDNM']"" K X,NM,FLDNM W !,"INVALID FIELD NAME.  PLEASE TRY AGAIN!",! G @FIELD
"RTN","PSOORED3",120,0)
 F AR=1:1:PSORXED("ENT") W !,AR_". "_$P(FLDNM,"^",2)_": "_$S(NM="ROU"&($G(PSORXED($P(FLDNM,"^"),AR))):$P(^PS(51.2,PSORXED($P(FLDNM,"^"),AR),0),"^"),1:$G(PSORXED($P(FLDNM,"^"),AR))) S AR1=AR
"RTN","PSOORED3",121,0)
 D KV S DIR("A",1)="* Indicates which fields will create a New Order",DIR("A")="Select Field to Edit by number",DIR(0)="NO^1:"_AR1 D ^DIR G:$D(DIRUT) @FIELD
"RTN","PSOORED3",122,0)
 D JFN^PSOOREDX G:FLDNM="" @FIELD G @FLDNM
"RTN","PSOORED3",123,0)
 G EX
"RTN","PSOORED3",124,0)
 Q
"RTN","PSOORED3",125,0)
 ;
"RTN","PSOORED3",126,0)
CNON ;
"RTN","PSOORED3",127,0)
 I $G(NOUN)'="" Q
"RTN","PSOORED3",128,0)
 I '$G(PSORXED("DOSE ORDERED",ENT)) Q
"RTN","PSOORED3",129,0)
 N PSONLT,PSONLL,PSONLG
"RTN","PSOORED3",130,0)
 S PSONLL=$P($G(DOSE("DD",+$G(PSODRUG("IEN")))),"^",9) I PSONLL="" Q
"RTN","PSOORED3",131,0)
 S PSONLG=$L(PSONLL)
"RTN","PSOORED3",132,0)
 I PSONLG'>3 Q
"RTN","PSOORED3",133,0)
 S PSONLT=$E(PSONLL,(PSONLG-2),PSONLG)
"RTN","PSOORED3",134,0)
 I PSONLT'="(S)",PSONLT'="(s)" Q
"RTN","PSOORED3",135,0)
 ;test noun of (S)
"RTN","PSOORED3",136,0)
 K NOUN ; NOT SURE ABOUT THIS???
"RTN","PSOORED3",137,0)
 I $G(PSORXED("DOSE ORDERED",ENT))>1 S PSORXED("NOUN",ENT)=$E(PSONLL,1,(PSONLG-3))_$E(PSONLT,2) Q
"RTN","PSOORED3",138,0)
 S PSORXED("NOUN",ENT)=$E(PSONLL,1,(PSONLG-3))
"RTN","PSOORED3",139,0)
 Q
"RTN","PSOORED4")
0^9^B47668549
"RTN","PSOORED4",1,0)
PSOORED4 ;BIR/SAB - Edit front door dosing ;07/13/00
"RTN","PSOORED4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,91,78,99,111,117,133,159,148**;DEC 1997
"RTN","PSOORED4",3,0)
 ;External reference ^PS(51 supported by DBIA 2224
"RTN","PSOORED4",4,0)
 ;External reference to PS(51.2 supported by DBIA 2226
"RTN","PSOORED4",5,0)
 ;External reference to PS(51.1 supported by DBIA 2225
"RTN","PSOORED4",6,0)
 ;called from psoornew
"RTN","PSOORED4",7,0)
 ;
"RTN","PSOORED4",8,0)
DOSE(PSORXED) ;
"RTN","PSOORED4",9,0)
 I '$G(PSODRUG("IEN")) W !,"DRUG NAME REQUIRED!" D 2^PSOORNW1 I '$G(PSODRUG("IEN")) S VALMSG="No Dispense Drug Selected" Q
"RTN","PSOORED4",10,0)
 K ROU,STRE,UNITN,PSODOSE M PSODOSE=PSORXED
"RTN","PSOORED4",11,0)
 D KV K FIELD,DOSEOR,DUPD,X,Y,UNITS S ENT=1,OLENT=PSORXED("ENT")
"RTN","PSOORED4",12,0)
ASK I $G(ORD) W !!,"Possible SIG: " D
"RTN","PSOORED4",13,0)
 .;Coded only for outside orders with no Patient Instructions
"RTN","PSOORED4",14,0)
 .I $O(SIG(""))="",$G(ORD),$P($G(^PS(52.41,ORD,"EXT")),"^")'="" D SIGS^PSOHCPRS
"RTN","PSOORED4",15,0)
 .S INST=0 F  S INST=$O(SIG(INST)) Q:'INST  S MIG=SIG(INST) D
"RTN","PSOORED4",16,0)
 ..F SG=1:1:$L(MIG," ") W:$X+$L($P(MIG," ",SG)_" ")>IOM !?14 W $P(MIG," ",SG)_" "
"RTN","PSOORED4",17,0)
 K SG,INST,MIG
"RTN","PSOORED4",18,0)
 S ROU="PSOORED4",II=ENT D ASK^PSOBKDED K ROU,II I $G(JUMP) K JUMP G JUMP
"RTN","PSOORED4",19,0)
 G:$D(DIRUT) EXQ
"RTN","PSOORED4",20,0)
 ;
"RTN","PSOORED4",21,0)
 I $G(VERB)]"" S PSORXED("VERB",ENT)=VERB G DUPD
"RTN","PSOORED4",22,0)
VER D VER^PSOOREDX I X[U,$L(X)>1 S FIELD="VER" G JUMP
"RTN","PSOORED4",23,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",24,0)
 I X="@" K PSORXED("VERB",ENT),VERB G DUPD
"RTN","PSOORED4",25,0)
 S:X'="" (PSORXED("VERB",ENT),VERB)=X
"RTN","PSOORED4",26,0)
DUPD ;
"RTN","PSOORED4",27,0)
 I $G(PSORXED("DOSE",ENT))'?.N&($G(PSORXED("DOSE",ENT))'?.N1".".N)!'DOSE("LD") K PSORXED("DOSE ORDERED",ENT),DUPD G NOU1
"RTN","PSOORED4",28,0)
 D DUPD^PSOOREDX
"RTN","PSOORED4",29,0)
 S DIR("B")=$S($G(PSORXED("DOSE ORDERED",ENT))]"":PSORXED("DOSE ORDERED",ENT),1:1) S:$E($G(DIR("B")),1)="." DIR("B")="0"_$G(DIR("B")) K:DIR("B")="" DIR("B")
"RTN","PSOORED4",30,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUPD" G JUMP
"RTN","PSOORED4",31,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",32,0)
 I X="@"!(X=0) W !,"Dispense Units Per Dose is Required!!",! G DUPD
"RTN","PSOORED4",33,0)
 D STR^PSOOREDX
"RTN","PSOORED4",34,0)
NOU1 G:'$G(PSORXED("DOSE ORDERED",ENT)) RTE
"RTN","PSOORED4",35,0)
 D CNON^PSOORED3
"RTN","PSOORED4",36,0)
 N PSONDEF
"RTN","PSOORED4",37,0)
 I $G(NOUN)]"" S PSORXED("NOUN",ENT)=NOUN
"RTN","PSOORED4",38,0)
NOU D NOU^PSOOREDX I X[U,$L(X)>1 S FIELD="NOU" G JUMP
"RTN","PSOORED4",39,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",40,0)
 I X="@" K PSORXED("NOUN",ENT),NOUN G RTE
"RTN","PSOORED4",41,0)
 I X'="",$G(PSONDEF)="" S NOUN=X
"RTN","PSOORED4",42,0)
 I X'="",$G(PSONDEF)'=X S NOUN=X
"RTN","PSOORED4",43,0)
 S:X'="" PSORXED("NOUN",ENT)=X
"RTN","PSOORED4",44,0)
 ;
"RTN","PSOORED4",45,0)
RTE K JUMP S ROU="PSOORED4" D RTE^PSOBKDED K ROU
"RTN","PSOORED4",46,0)
 I $G(JUMP) K JUMP G JUMP
"RTN","PSOORED4",47,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",48,0)
 ;
"RTN","PSOORED4",49,0)
SCH D SCH^PSOBKDED I X[U,$L(X)>1 S FIELD="SCH" G JUMP
"RTN","PSOORED4",50,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",51,0)
 S SCH=Y D SCH^PSOSIG I $G(SCH)']"" G SCH
"RTN","PSOORED4",52,0)
 S PSORXED("SCHEDULE",ENT)=SCH W " ("_SCHEX_")" K SCH,SCHEX,X,Y,PSOSCH
"RTN","PSOORED4",53,0)
 S:PSORXED("ENT")<ENT PSORXED("ENT")=ENT
"RTN","PSOORED4",54,0)
 ;
"RTN","PSOORED4",55,0)
DUR D KV K EXP S DIR(0)="52.0113,4",DIR("A")="LIMITED DURATION (IN DAYS, HOURS OR MINUTES)"
"RTN","PSOORED4",56,0)
 S DIR("B")=$S($G(PSORXED("DURATION",ENT))]"":PSORXED("DURATION",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOORED4",57,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUR" G JUMP
"RTN","PSOORED4",58,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",59,0)
 D DUR1^PSOOREDX
"RTN","PSOORED4",60,0)
 ;
"RTN","PSOORED4",61,0)
CON D CON^PSOOREDX I X[U,$L(X)>1 S FIELD="CON" G JUMP
"RTN","PSOORED4",62,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOORED4",63,0)
 I X="@",$G(PSORXED("CONJUNCTION",ENT))="" W !,?10,"Invalid Entry - nothing to delete!!" G CON
"RTN","PSOORED4",64,0)
 S:X'=""&(X'="@") PSORXED("CONJUNCTION",ENT)=Y
"RTN","PSOORED4",65,0)
 I X="@",$D(PSORXED("CONJUNCTION",ENT)) D CON1^PSOOREDX G:$D(DIRUT) EXQ G:'Y CON N CKX S CKX=1 D UPD^PSOOREDX G CON
"RTN","PSOORED4",66,0)
 I $G(PSORXED("CONJUNCTION",ENT))]"" S ENT=ENT+1 K DIR G ASK
"RTN","PSOORED4",67,0)
 S X=$G(PSORXED("INS")) D SIG^PSOHELP S:$G(INS1)]"" PSORXED("SIG")=$E(INS1,2,9999999)
"RTN","PSOORED4",68,0)
 D EN^PSOFSIG(.PSORXED),VERI I $G(CKX),'$G(PSOSIGFL) D MP1 K CKX
"RTN","PSOORED4",69,0)
 I $G(PSOSIGFL)=1 S PSORXED("ENT")=ENT,SIGOK=1,VALMSG="This change will create a new prescription!",NCPDPFLG=1
"RTN","PSOORED4",70,0)
 K QTYHLD S:$G(PSORXED("QTY")) QTYHLD=PSORXED("QTY") D QTY^PSOSIG(.PSORXED) I $G(PSORXED("QTY")) S QTY=1
"RTN","PSOORED4",71,0)
 I $G(QTYHLD),'$G(PSORXED("QTY")) S PSORXED("QTY")=QTYHLD
"RTN","PSOORED4",72,0)
 K QTYHLD
"RTN","PSOORED4",73,0)
 I '$G(PSORXED("QTY")),$P(OR0,"^",10) S PSORXED("QTY")=$P(OR0,"^",10)
"RTN","PSOORED4",74,0)
EX ;
"RTN","PSOORED4",75,0)
 K PSOBDR,PSOBDRG,PSOSCH,DUPD,STRE,UNITN,SCH,VERB,NOUN,DOSEOR,RTE,DUR,X,Y,ENTS,PSODOSE,OLENT,FIELD,FLDNM,AR,NM,ENT,STRE,UNITN,PSODOSE,ERTE,ROU
"RTN","PSOORED4",76,0)
KV K DTOUT,DUOUT,DIR,DIRUT
"RTN","PSOORED4",77,0)
 Q
"RTN","PSOORED4",78,0)
EXQ ;
"RTN","PSOORED4",79,0)
 K PSORXED,PSOSIGFL M PSORXED=PSODOSE D EN^PSOFSIG(.PSORXED) D MP1
"RTN","PSOORED4",80,0)
 I $D(PSOBDR) M PSODRUG=PSOBDR K PSOBDR,PSOBDRG
"RTN","PSOORED4",81,0)
 G EX Q
"RTN","PSOORED4",82,0)
MP1 D MP1^PSOOREDX
"RTN","PSOORED4",83,0)
 Q
"RTN","PSOORED4",84,0)
VERI ;checks for changes to dosing instructions
"RTN","PSOORED4",85,0)
 S ENTS=0
"RTN","PSOORED4",86,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S ENTS=$G(ENTS)+1
"RTN","PSOORED4",87,0)
 I ENTS<OLENT!(ENTS>OLENT) S PSOSIGFL=1 Q
"RTN","PSOORED4",88,0)
 F I=1:1:OLENT D
"RTN","PSOORED4",89,0)
 .I PSODOSE("DOSE",I)'=$G(PSORXED("DOSE",I)) S PSOSIGFL=1
"RTN","PSOORED4",90,0)
 .I $G(PSODOSE("DURATION",I))]"" D
"RTN","PSOORED4",91,0)
 ..S DURATION=$S($E(PSODOSE("DURATION",I),1)'?.N:$E(PSODOSE("DURATION",I),2,99)_$E(PSODOSE("DURATION",I),1),1:PSODOSE("DURATION",I))
"RTN","PSOORED4",92,0)
 ..I +DURATION'=+$G(PSORXED("DURATION",I)) S PSOSIGFL=1
"RTN","PSOORED4",93,0)
 .I $G(PSODOSE("CONJUNCTION",I))'=$G(PSORXED("CONJUNCTION",I)) S PSOSIGFL=1
"RTN","PSOORED4",94,0)
 .I PSODOSE("ROUTE",I)'=$G(PSORXED("ROUTE",I)) S PSOSIGFL=1
"RTN","PSOORED4",95,0)
 .I PSODOSE("SCHEDULE",I)'=$G(PSORXED("SCHEDULE",I)) S PSOSIGFL=1
"RTN","PSOORED4",96,0)
 K DURATION Q
"RTN","PSOORED4",97,0)
JUMP ;jump to fields
"RTN","PSOORED4",98,0)
 I $L($E(X,2,99))<3 W !,"Field Name Must Be At Least 3 Characters in Length",! G @FIELD
"RTN","PSOORED4",99,0)
 D FNM^PSOOREDX
"RTN","PSOORED4",100,0)
 I FLDNM']"" K X,NM,FLDNM W !,"INVALID FIELD NAME.  PLEASE TRY AGAIN!",! G @FIELD
"RTN","PSOORED4",101,0)
 F AR=1:1:PSORXED("ENT") W !,AR_". "_$P(FLDNM,"^",2)_": "_$S(NM="ROU"&($G(PSORXED($P(FLDNM,"^"),AR))):$P(^PS(51.2,PSORXED($P(FLDNM,"^"),AR),0),"^"),1:$G(PSORXED($P(FLDNM,"^"),AR))) S AR1=AR
"RTN","PSOORED4",102,0)
 D KV S DIR("A",1)="* Indicates which fields will create a New Order",DIR("A")="Select Field to Edit by number",DIR(0)="NO^1:"_AR1 D ^DIR G:$D(DIRUT) @FIELD
"RTN","PSOORED4",103,0)
 D JFN^PSOOREDX G:FLDNM="" @FIELD G @FLDNM
"RTN","PSOORED4",104,0)
 G EX
"RTN","PSOORED4",105,0)
 Q
"RTN","PSOORED4",106,0)
HLP ;help text for med route
"RTN","PSOORED4",107,0)
 D FULL^VALM1 W !,"Please enter how patient will use the medication!"
"RTN","PSOORED4",108,0)
 S DIC=51.2,X="??",DIC(0)="M",DIC("S")="I $P(^PS(51.2,+Y,0),""^"",4)" D ^DIC K DIC,X,Y
"RTN","PSOORED4",109,0)
 Q
"RTN","PSOORED4",110,0)
SCHLP ;
"RTN","PSOORED4",111,0)
 D FULL^VALM1 W !,"You can choose an entry from the Administration Schedule File (#51.1),",!,"Medication Instruction File (#51) or enter free text."
"RTN","PSOORED4",112,0)
 W !,"The free text entry cannot contain more than 2 spaces or be greater than 20",!,"characters in length."
"RTN","PSOORED4",113,0)
 W ! S DIR(0)="S^A:Administration Schedule File;M:Medication Instruction File;B:Both;F:Free Text",DIR("B")="Both"
"RTN","PSOORED4",114,0)
 S DIR("A")="Do you want to list from" D ^DIR I Y="F"!($G(DIRUT)) K X,Y G X
"RTN","PSOORED4",115,0)
 S LBL=Y G @LBL
"RTN","PSOORED4",116,0)
A ;display 51.1 entries only
"RTN","PSOORED4",117,0)
B K X,Y,DIC S X="??",DIC="^PS(51.1,",DIC(0)="QES",DIC("W")="D DICW^PSOORED4",D="APPSJ" W ! D IX^DIC
"RTN","PSOORED4",118,0)
 K DIC,X I LBL="A"!($G(DTOUT)) K LBL G X
"RTN","PSOORED4",119,0)
 I Y=-1!($G(DUOUT)) K DIR,DTOUT,DUOUT S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to continue with the Medication Instruction File"
"RTN","PSOORED4",120,0)
 D ^DIR I 'Y!($G(DTOUT)) K DIR,X,Y G X
"RTN","PSOORED4",121,0)
M K X,Y,DIC S DIC=51,X="??",DIC(0)="M" D ^DIC K DIC,X,Y,DTOUT,DUOUT,LBL
"RTN","PSOORED4",122,0)
X S DIR("?")="^D SCHLP^PSOORED4",DIR("A")="Schedule: ",DIR(0)="FA^1:20^I X[""""""""!(X?.E1C.E)!($A(X)=45)!($L(X,"" "")>3)!($L(X)>20)!($L(X)<1) K X"
"RTN","PSOORED4",123,0)
 S DIR("B")=$S($D(PSOSCH)&('$D(PSORXED("SCHEDULE",ENT))):PSOSCH,$G(PSORXED("SCHEDULE",ENT))]"":PSORXED("SCHEDULE",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOORED4",124,0)
 Q
"RTN","PSOORED4",125,0)
DICW ;
"RTN","PSOORED4",126,0)
 S Z=$P(^PS(51.1,+Y,0),"^",5),Z=$S(Z="O":-1,Z="S":1,Z="R":-2,1:0) W:Z "  ",$S(Z>0:"SHIFT",Z=-2:"RANGE",1:"ONE-TIME")
"RTN","PSOORED4",127,0)
 I Z'<0,$D(PSJW),$D(^(PSJPP'="PSJ"+1,PSJW,0)),$P(^(0),"^",Z+2)]"" W "  ",$P(^(0),"^",Z+2)
"RTN","PSOORED4",128,0)
 ;Naked reference on DICW+2 is from DICW+1, ^PS(51.1,+Y,0)
"RTN","PSOORED4",129,0)
 Q
"RTN","PSOORED6")
0^10^B70246977
"RTN","PSOORED6",1,0)
PSOORED6 ;BIR/SAB - edit orders from backdoor ;03/06/96
"RTN","PSOORED6",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**78,104,117,133,143,219,148**;DEC 1997
"RTN","PSOORED6",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORED6",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORED6",5,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOORED6",6,0)
 ;Reference to $$DIVNCPDP^BPSBUTL supported by IA 4719
"RTN","PSOORED6",7,0)
DRG ;select drug
"RTN","PSOORED6",8,0)
 S PSORX("EDIT")=1,RX0HLD=RX0
"RTN","PSOORED6",9,0)
 S PSODRUG("IEN")=$S($G(PSODRUG("IEN"))]"":PSODRUG("IEN"),1:$P(RX0,"^",6)),PSODRUG("NAME")=$S($G(PSODRUG("NAME"))]"":PSODRUG("NAME"),1:$P(^PSDRUG($P(RX0,"^",6),0),"^"))
"RTN","PSOORED6",10,0)
 D ^PSODRG I PSODRUG("IEN")=$P(RX0,"^",6) K PSORXED("FLD",6)
"RTN","PSOORED6",11,0)
 D:PSODRUG("IEN")'=$P(RX0,"^",6)  I $G(PSORX("DFLG")) K PSORXED("FLD",6) S PSORXED("DFLG")=1 Q
"RTN","PSOORED6",12,0)
 .D POST^PSODRG
"RTN","PSOORED6",13,0)
 .I '$O(^PSRX(PSORXED("IRXN"),1,0)) S PSORXED("FLD",17)=$G(PSODRUG("COST"))
"RTN","PSOORED6",14,0)
 .I $G(PSORX("DFLG")) K PSORXED("FLD",6),PSODRUG,PSOOIFLG,PSOSIGFL,VALMSG Q
"RTN","PSOORED6",15,0)
 .D KV S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="You have changed the dispense drug from",DIR("A",2)=$P(^PSDRUG($P(PSORXED("RX0"),"^",6),0),"^")_" to "_$P(^PSDRUG(PSODRUG("IEN"),0),"^")_".",DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORED6",16,0)
 .D ^DIR K DIR I $D(DIRUT) S PSORX("DFLG")=1 D M1
"RTN","PSOORED6",17,0)
 .Q:$D(DIRUT)!('Y)
"RTN","PSOORED6",18,0)
 .S PSOREEDQ=1 D DOLST^PSOORED3,DOSE^PSOORED3 K PSOREEDQ
"RTN","PSOORED6",19,0)
 .I '$O(PSORXED("DOSE",0)) S PSORX("DFLG")=1 Q
"RTN","PSOORED6",20,0)
 .D:$G(PSOSIGFL) M2
"RTN","PSOORED6",21,0)
 S RX0=RX0HLD K RX0HLD I $G(PSODRUG("OI"))=$G(PSOI) D  Q
"RTN","PSOORED6",22,0)
 .D:$O(^TMP("PSORXDC",$J,0))
"RTN","PSOORED6",23,0)
 ..W !!,"This edit will discontinue the duplicate Rx & change the dispensed drug!"
"RTN","PSOORED6",24,0)
 ..K DIR,X,Y S DIR("A")="Do You Want to Proceed",DIR("B")="NO",DIR(0)="Y"
"RTN","PSOORED6",25,0)
 ..D ^DIR K DIR S:'Y!($D(DIRUT)) PSORXED("DFLG")=1 D:Y DCORD^PSONEW2
"RTN","PSOORED6",26,0)
 .Q:$G(PSORXED("DFLG"))
"RTN","PSOORED6",27,0)
 .I PSODRUG("IEN")'=$P(RX0,"^",6) D
"RTN","PSOORED6",28,0)
 ..S PSORXED("FLD",6)=PSODRUG("IEN"),PSORXED("FLD",39.2)=PSOI
"RTN","PSOORED6",29,0)
 .S:$G(PSODRUG("TRADE NAME"))]"" PSORXED("FLD",6.5)=PSODRUG("TRADE NAME")
"RTN","PSOORED6",30,0)
 .S:$G(PSODRUG("NDC"))]"" PSORXED("FLD",27)=PSODRUG("NDC")
"RTN","PSOORED6",31,0)
 .S:$G(PSODRUG("DAW"))]"" PSORXED("FLD",81)=PSODRUG("DAW")
"RTN","PSOORED6",32,0)
 W !!,"New Orderable Item selected. This edit will create a new prescription!",! D PAUSE^VALM1 S VALMSG="New Orderable Item selected. This edit will create a new prescription!" S (PSOOIFLG,PSOSIGFL)=1
"RTN","PSOORED6",33,0)
 Q
"RTN","PSOORED6",34,0)
PSOCOU ;patient counseling
"RTN","PSOORED6",35,0)
 K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED",DR=41 D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED6",36,0)
 D KV S DIR(0)="52,41" S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR) D ^DIR K DIR,PSORXED(52,DA,DR)
"RTN","PSOORED6",37,0)
 I $D(DIRUT) K PSORXED("FLD",41) D KV Q
"RTN","PSOORED6",38,0)
 S PSORXED("FLD",DR)=Y D  K DIRUT
"RTN","PSOORED6",39,0)
 .I Y D  Q
"RTN","PSOORED6",40,0)
 ..K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED",DR=42 D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED6",41,0)
 ..K DIR,DIRUT S DIR(0)="52,42" S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR) D ^DIR K DIR,PSORXED(52,DA,DR)
"RTN","PSOORED6",42,0)
 ..I $D(DIRUT) K PSORXED("FLD",41),DUOUT,DTOUT Q
"RTN","PSOORED6",43,0)
 ..S PSORXED("FLD",42)=Y
"RTN","PSOORED6",44,0)
 .S PSORXED("FLD",41)=0,PSORXED("FLD",42)="@"
"RTN","PSOORED6",45,0)
 Q
"RTN","PSOORED6",46,0)
PSOI ;select orderable item
"RTN","PSOORED6",47,0)
 W !!,"Current Orderable Item: "_$P(^PS(50.7,PSOI,0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSOORED6",48,0)
 S DIC("B")=$P(^PS(50.7,PSOI,0),"^"),DIC="^PS(50.7,",DIC(0)="AEMQZ"
"RTN","PSOORED6",49,0)
 S DIC("S")="I '$P(^PS(50.7,+Y,0),""^"",4)!($P(^(0),""^"",4)'<DT) N PSOF,PSOL S (PSOF,PSOL)=0 F  S PSOL=$O(^PSDRUG(""ASP"",+Y,PSOL)) Q:PSOF!'PSOL  "
"RTN","PSOORED6",50,0)
 S DIC("S")=DIC("S")_"I $P($G(^PSDRUG(PSOL,2)),U,3)[""O"",'$G(^(""I""))!($G(^(""I""))'<DT) S PSOF=1" D ^DIC I "^"[X S PSORXED("DFLG")=1 Q
"RTN","PSOORED6",51,0)
 G:Y<1 PSOI Q:PSOI=+Y
"RTN","PSOORED6",52,0)
 S PSODRUG("OI")=+Y,PSODRUG("OIN")=Y(0,0) K DIC
"RTN","PSOORED6",53,0)
 I PSOI'=PSODRUG("OI") W !!,"New Orderable Item selected. This edit will create a new prescription!",! D  K PSHOLDD Q
"RTN","PSOORED6",54,0)
 .D PAUSE^VALM1,M2
"RTN","PSOORED6",55,0)
 .S PSHOLDD=$G(PSODRUG("IEN")) K PSODRUG("IEN"),PSODRUG("NAME") S PSODRUG("DEA")="",(PSOOIFLG,PSOSIGFL)=1
"RTN","PSOORED6",56,0)
 .D DREN^PSOORNW2
"RTN","PSOORED6",57,0)
 .I $G(PSHOLDD),$G(PSODRUG("IEN")),$G(PSHOLDD)'=$G(PSODRUG("IEN")) D  Q:$G(PSORX("DFLG"))
"RTN","PSOORED6",58,0)
 ..D FULL^VALM1,POST^PSODRG S VALMBCK="R"
"RTN","PSOORED6",59,0)
 ..I $G(PSORX("DFLG")) K PSODRUG S PSODRUG("IEN")=$G(PSHOLDD),PSODRUG("NAME")=$P($G(^PSDRUG(PSODRUG("IEN"),0)),"^") K PSOOIFLG,PSOSIGFL S VALMSG=""
"RTN","PSOORED6",60,0)
 .I '$G(PSODRUG("IEN")) W !!,"DRUG NAME REQUIRED!" D 2^PSOORNW1
"RTN","PSOORED6",61,0)
 .I '$G(PSODRUG("IEN")) K PSORXED("FLD"),INDEL,^TMP($J,"INS1"),PSOSIGFL,VALMSG S PSORXED("DFLG")=1,VALMSG="Dispense Drug NOT Selected!" Q
"RTN","PSOORED6",62,0)
 .D KV S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="You have changed the Orderable Item from",DIR("A",2)=$P(^PS(50.7,PSOI,0),"^")_" to "_PSODRUG("OIN")_".",DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORED6",63,0)
 .D ^DIR K DIR I $D(DIRUT) K PSODRUG("OIN"),PSOOIFLG,PSOSIGFL S PSODRUG("OI")=PSOI,VALMSG="",PSORX("DFLG")=1 Q
"RTN","PSOORED6",64,0)
 .I 'Y S PSORX("DFLG")=1 Q
"RTN","PSOORED6",65,0)
 .S PSOREEDQ=1 D DOLST^PSOORED3,DOSE^PSOORED3 K PSOREEDQ
"RTN","PSOORED6",66,0)
 .I '$O(PSORXED("DOSE",0)) S PSORX("DFLG")=1 Q
"RTN","PSOORED6",67,0)
 .D:$G(PSOSIGFL) M2
"RTN","PSOORED6",68,0)
 S PSORXED("FLD",39.2)=PSOI
"RTN","PSOORED6",69,0)
 Q
"RTN","PSOORED6",70,0)
NCPDP ;Reverse previously billed Rx on an edited orderable item or drug. 
"RTN","PSOORED6",71,0)
 N RX,NPSOY
"RTN","PSOORED6",72,0)
 S RX=$G(PSORXED("IRXN")) I RX="" D
"RTN","PSOORED6",73,0)
 . S NPSOY=$O(PSONEW("OLD LAST RX#","")),NPSOY=$G(PSONEW("OLD LAST RX#",NPSOY)),RX=$O(^PSRX("B",NPSOY,RX))
"RTN","PSOORED6",74,0)
 I 'RX Q
"RTN","PSOORED6",75,0)
 D REVERSE^PSOBPSU1(RX,,"DC",7) S NCPDPFLG=0
"RTN","PSOORED6",76,0)
 Q
"RTN","PSOORED6",77,0)
UPDATE ;add new data to file
"RTN","PSOORED6",78,0)
 N RXREF,UPDATE,FLDS,CHGNDC
"RTN","PSOORED6",79,0)
 Q:'$G(PSORXED("IRXN"))
"RTN","PSOORED6",80,0)
 I $O(PSORXED("FLD",0))!($G(^TMP($J,"INS1",0))]"")!($G(INSDEL))!($O(PSORXED("ODOSE",0))) D  G:'Y UPDX
"RTN","PSOORED6",81,0)
 .K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED6",82,0)
 .S DIR(0)="Y",DIR("A")="Are You Sure You Want to Update Rx "_$P(^PSRX(PSORXED("IRXN"),0),"^"),DIR("B")="Yes"
"RTN","PSOORED6",83,0)
 .D ^DIR K DIR I 'Y D M1 Q
"RTN","PSOORED6",84,0)
 .I $D(^PSRX(PSORXED("IRXN"),1,0))  D
"RTN","PSOORED6",85,0)
 ..S RXREF=$P(^PSRX(PSORXED("IRXN"),0),"^",9)-$P(^PSRX(PSORXED("IRXN"),1,0),"^",4)
"RTN","PSOORED6",86,0)
 .E  S RXREF=0
"RTN","PSOORED6",87,0)
 .K X,DIRUT,DUOUT,DTOUT
"RTN","PSOORED6",88,0)
 I $D(PSORXED("FLD",39.3)) D UPDATE^PSODIAG  ;update ICD's after edit
"RTN","PSOORED6",89,0)
 ; - Retrieving fields before changes that are relevant for 3rd Party Billing
"RTN","PSOORED6",90,0)
 D GETS^DIQ(52,PSORXED("IRXN")_",","4;7;8;20;22;27;81","I","FLDS")
"RTN","PSOORED6",91,0)
 K Y S DA=PSORXED("IRXN"),DIE="^PSRX(",FLD=0
"RTN","PSOORED6",92,0)
 F  S FLD=$O(PSORXED("FLD",FLD)) Q:'FLD  D
"RTN","PSOORED6",93,0)
 .I FLD=12!(FLD=24)!(FLD=35) D  Q
"RTN","PSOORED6",94,0)
 ..I FLD=12,PSORXED("FLD",12)="@" S $P(^PSRX(DA,3),"^",7)="" Q
"RTN","PSOORED6",95,0)
 ..I FLD=12,PSORXED("FLD",12)]"" S $P(^PSRX(DA,3),"^",7)=PSORXED("FLD",12) Q
"RTN","PSOORED6",96,0)
 ..I FLD=24,PSORXED("FLD",24)="@" S $P(^PSRX(DA,2),"^",4)="" Q
"RTN","PSOORED6",97,0)
 ..I FLD=24,PSORXED("FLD",24)]"" S $P(^PSRX(DA,2),"^",4)=PSORXED("FLD",24) Q
"RTN","PSOORED6",98,0)
 ..I FLD=35,PSORXED("FLD",35)="@" S $P(^PSRX(DA,"MP"),"^")="" Q
"RTN","PSOORED6",99,0)
 ..I FLD=35,PSORXED("FLD",35)]"" S $P(^PSRX(DA,"MP"),"^")=PSORXED("FLD",35) Q
"RTN","PSOORED6",100,0)
 .I FLD=114 D  Q
"RTN","PSOORED6",101,0)
 ..I PSORXED("FLD",114)="@" K ^PSRX(DA,"INS"),^PSRX(DA,"INS1")
"RTN","PSOORED6",102,0)
 ..I PSORXED("FLD",114)'="@" D
"RTN","PSOORED6",103,0)
 ...S ^PSRX(DA,"INS")=PSORXED("FLD",114)
"RTN","PSOORED6",104,0)
 ...S X=PSORXED("FLD",114) D SIG^PSOHELP Q:$G(INS1)']""
"RTN","PSOORED6",105,0)
 ...S PSORXED("SIG",1)=$E(INS1,2,9999999) K ^PSRX(DA,"INS1")
"RTN","PSOORED6",106,0)
 ...S ^PSRX(DA,"INS1",0)="^52.0115^1^1^"_DT_"^^"
"RTN","PSOORED6",107,0)
 ...S ^PSRX(DA,"INS1",1,0)=PSORXED("SIG",1)
"RTN","PSOORED6",108,0)
 ..D DOLST^PSOORED3 K:PSORXED("FLD",114)="@" PSORXED("SIG") D EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3
"RTN","PSOORED6",109,0)
 .I FLD=27 D  Q
"RTN","PSOORED6",110,0)
 ..I PSORXED("FLD",27)'=$$GETNDC^PSONDCUT(DA,0) S CHGNDC=1
"RTN","PSOORED6",111,0)
 ..D SAVNDC^PSONDCUT(DA,0,PSORXED("FLD",27),0,1)
"RTN","PSOORED6",112,0)
 .I FLD=81 D SAVDAW^PSODAWUT(DA,0,PSORXED("FLD",81)) Q
"RTN","PSOORED6",113,0)
 .S DR=FLD_"////"_PSORXED("FLD",FLD) D ^DIE
"RTN","PSOORED6",114,0)
 .I FLD=4 D UDPROV^PSOOREDT Q
"RTN","PSOORED6",115,0)
 ;
"RTN","PSOORED6",116,0)
 ; - Re-submitting Rx to ECME due to edits
"RTN","PSOORED6",117,0)
 N CHANGED S CHANGED=$$CHANGED(PSORXED("IRXN"),.FLDS)
"RTN","PSOORED6",118,0)
 I CHANGED D
"RTN","PSOORED6",119,0)
 . N RX S RX=PSORXED("IRXN") Q:'RX
"RTN","PSOORED6",120,0)
 . I $P(CHANGED,"^",2),'$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(RX,0)) D  Q
"RTN","PSOORED6",121,0)
 . . D REVERSE^PSOBPSU1(RX,0,"DC",99,"RX DIVISION CHANGED",1)
"RTN","PSOORED6",122,0)
 . I $$SUBMIT^PSOBPSUT(RX,0,1) D
"RTN","PSOORED6",123,0)
 . . I '$P(CHANGED,"^",2),$$STATUS^PSOBPSUT(RX,0)="" Q
"RTN","PSOORED6",124,0)
 . . D ECMESND^PSOBPSU1(RX,0,,"ED",$$GETNDC^PSONDCUT(RX,0),,$S($P(CHANGED,"^",2):"RX DIVISION CHANGED",1:"RX EDITED"),,+$G(CHGNDC))
"RTN","PSOORED6",125,0)
 . . ;- Checking/Handling DUR/79 Rejects
"RTN","PSOORED6",126,0)
 . . I $$FIND^PSOREJUT(RX,0) S X=$$HDLG^PSOREJU1(RX,0,"79,88","ED","IOQ","I")
"RTN","PSOORED6",127,0)
 ;
"RTN","PSOORED6",128,0)
 I $G(INSDEL) K ^PSRX(DA,"INS"),^PSRX(DA,"INS1") D DOLST^PSOORED3 K PSORXED("SIG") D EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3 G UPDX
"RTN","PSOORED6",129,0)
 I $O(^TMP($J,"INS1",0)) D
"RTN","PSOORED6",130,0)
 .K ^PSRX(DA,"INS"),^PSRX(DA,"INS1"),DD,PSORXED("SIG")
"RTN","PSOORED6",131,0)
 .F I=0:0 S I=$O(^TMP($J,"INS1",I)) Q:'I  S (PSORXED("SIG",I),^PSRX(DA,"INS1",I,0))=^TMP($J,"INS1",I,0),DD=$G(DD)+1
"RTN","PSOORED6",132,0)
 .S ^PSRX(DA,"INS1",0)=^TMP($J,"INS1",0)
"RTN","PSOORED6",133,0)
 .I DD=1 S ^PSRX(DA,"INS")=^PSRX(DA,"INS1",1,0)
"RTN","PSOORED6",134,0)
 .D DOLST^PSOORED3,EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3
"RTN","PSOORED6",135,0)
 ;
"RTN","PSOORED6",136,0)
UPDX ;
"RTN","PSOORED6",137,0)
 K DIE,DA,DR,FLD,X,Y,PSORXED("FLD"),DD,^TMP($J,"INS1")
"RTN","PSOORED6",138,0)
KV K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED6",139,0)
 Q
"RTN","PSOORED6",140,0)
UPD ;updates dosing array
"RTN","PSOORED6",141,0)
 S HENT=ENT
"RTN","PSOORED6",142,0)
UPD1 ;
"RTN","PSOORED6",143,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD
"RTN","PSOORED6",144,0)
 .K PSORXED("CONJUNCTION",(HENT+1))
"RTN","PSOORED6",145,0)
 .I $D(PSORXED("DOSE",(HENT+2))) D
"RTN","PSOORED6",146,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED6",147,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED6",148,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED6",149,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED6",150,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED6",151,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED6",152,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED6",153,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED6",154,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED6",155,0)
 ..S PSORXED("VERB",(HENT+1))=$G(PSORXED("VERB",(HENT+2)))
"RTN","PSOORED6",156,0)
 ..K PSORXED("DOSE",(HENT+2)),PSORXED("ODOSE",(HENT+2)),PSORXED("DOSE ORDERED",(HENT+2))
"RTN","PSOORED6",157,0)
 ..K PSORXED("UNITS",(HENT+2)),PSORXED("NOUN",(HENT+2)),PSORXED("DURATION",(HENT+2)),PSORXED("ROUTE",(HENT+2)),PSORXED("SCHEDULE",(HENT+2)),PSORXED("VERB",(HENT+2))
"RTN","PSOORED6",158,0)
 .S HENT=HENT+1
"RTN","PSOORED6",159,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S SENT=$G(SENT)+1
"RTN","PSOORED6",160,0)
 Q
"RTN","PSOORED6",161,0)
 ;
"RTN","PSOORED6",162,0)
CHANGED(RX,PRIOR) ; - Check if fields have changed and should for 3rd Party Claim resubmission
"RTN","PSOORED6",163,0)
 ;Input:  (r) RX    - Rx IEN
"RTN","PSOORED6",164,0)
 ;        (r) PRIOR - Array with fields
"RTN","PSOORED6",165,0)
 ;Output:  CHANGED  - 0 - Not changed / 1 - Original Rx field changed ^ Rx Division changed (1 - YES)
"RTN","PSOORED6",166,0)
 N CHANGED,SAVED
"RTN","PSOORED6",167,0)
 S CHANGED=0 D GETS^DIQ(52,RX_",","4;7;8;20;22;27;81","I","SAVED")
"RTN","PSOORED6",168,0)
 F I=4,7,8,22,27,81 D  I CHANGED Q
"RTN","PSOORED6",169,0)
 . I $G(PRIOR(52,RX_",",I,"I"))'=$G(SAVED(52,RX_",",I,"I")) S CHANGED=1 Q
"RTN","PSOORED6",170,0)
 I $$DIVNCPDP^BPSBUTL(+$G(PRIOR(52,RX_",",20,"I")))'=$$DIVNCPDP^BPSBUTL(+$G(SAVED(52,RX_",",20,"I"))) S CHANGED="1^1"
"RTN","PSOORED6",171,0)
 Q CHANGED
"RTN","PSOORED6",172,0)
 ;
"RTN","PSOORED6",173,0)
M1 D M1^PSOOREDX
"RTN","PSOORED6",174,0)
 Q
"RTN","PSOORED6",175,0)
M2 D M2^PSOOREDX
"RTN","PSOORED6",176,0)
 Q
"RTN","PSOORED7")
0^63^B10132898
"RTN","PSOORED7",1,0)
PSOORED7 ;ISC-BHAM/MFR-edit orders from backdoor con't ;03/06/95 10:24
"RTN","PSOORED7",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOORED7",3,0)
 ;called from psooredt. cmop edit checks.
"RTN","PSOORED7",4,0)
 ;External reference to File #50 @NOCHG+17 supported by DBIA 221
"RTN","PSOORED7",5,0)
 ;
"RTN","PSOORED7",6,0)
NOCHG S CMRL=1 D CHK1^PSOORED2 I '$G(CMRL) W !,"No editing allowed of "_$S(FLN=9:"Day Supply",FLN=10:"Quantity",1:"# of Refills")_" (CMOP)." D PAUSE^VALM1 K CMRL Q
"RTN","PSOORED7",7,0)
 K CMRL,DIC,DIQ
"RTN","PSOORED7",8,0)
 S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED" D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED7",9,0)
 S PSORXED($S(FLN=9:"DAYS SUPPLY",FLN=10:"QTY",1:"# OF REFILLS"))=PSORXED(52,DA,DR)
"RTN","PSOORED7",10,0)
 D:'$O(PSORXED("DOSE",0)) DOLST^PSOORED3
"RTN","PSOORED7",11,0)
 I FLN=9 D  Q
"RTN","PSOORED7",12,0)
 .D DAYS^PSODIR1(.PSORXED) I $G(PSORXED("DFLG")) K PSORXED("FLD",8) Q
"RTN","PSOORED7",13,0)
 .S PSORXED("FLD",8)=PSORXED("DAYS SUPPLY")
"RTN","PSOORED7",14,0)
 I FLN=10 D  Q
"RTN","PSOORED7",15,0)
 .D QTY^PSODIR1(.PSORXED) I $G(PSORXED("DFLG")) K PSORXED("FLD",7) Q
"RTN","PSOORED7",16,0)
 .S:$G(PSORXED("QTY")) PSORXED("FLD",7)=PSORXED("QTY")
"RTN","PSOORED7",17,0)
 I FLN=11 D  Q
"RTN","PSOORED7",18,0)
 .S X=$G(PSORXED("PATIENT STATUS")) S:'X X=$P(RX0,"^",3)
"RTN","PSOORED7",19,0)
 .S DIC=53,DIC(0)="QXZ" D ^DIC K DIC
"RTN","PSOORED7",20,0)
 .S:+Y PSORXED("PTST NODE")=Y(0)
"RTN","PSOORED7",21,0)
 .S:'$G(PSORXED("PATIENT STATUS")) PSORXED("PATIENT STATUS")=+Y
"RTN","PSOORED7",22,0)
 .K X,Y
"RTN","PSOORED7",23,0)
 .I $G(PSODRUG("IEN"))=$P(RX0,"^",6) K PSODRUG S X="`"_$P(RX0,"^",6),DIC=50,DIC(0)="QXZ" D ^DIC K PSOY S PSOY=Y,PSOY(0)=Y(0) D SET^PSODRG
"RTN","PSOORED7",24,0)
 .S:'$G(PSORXED("DAYS SUPPLY")) PSORXED("DAYS SUPPLY")=$P(RX0,"^",8)
"RTN","PSOORED7",25,0)
 .F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),1,I)) Q:'I  S RFTT=$G(RFTT)+1
"RTN","PSOORED7",26,0)
 .D REFILL^PSODIR1(.PSORXED) K RFTT
"RTN","PSOORED7",27,0)
 .I $G(PSORXED("DFLG")) K PSORXED("FLD",9) Q
"RTN","PSOORED7",28,0)
 .I PSORXED("# OF REFILLS")=$P(RX0,"^",9) Q
"RTN","PSOORED7",29,0)
 .S PSORXED("FLD",9)=PSORXED("# OF REFILLS")
"RTN","PSOORED7",30,0)
 Q
"RTN","PSOORED7",31,0)
VER ;checks for changes to dosing instructions
"RTN","PSOORED7",32,0)
 S ENTS=0
"RTN","PSOORED7",33,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S ENTS=$G(ENTS)+1
"RTN","PSOORED7",34,0)
 I ENTS<OLENT!(ENTS>OLENT) S PSOSIGFL=1 Q
"RTN","PSOORED7",35,0)
 F I=1:1:OLENT D:$D(^PSRX(PSORXED("IRXN"),6,I,0))
"RTN","PSOORED7",36,0)
 .I $P(^PSRX(PSORXED("IRXN"),6,I,0),"^")'=PSORXED("DOSE",I) S PSOSIGFL=1
"RTN","PSOORED7",37,0)
 .I $P(^PSRX(PSORXED("IRXN"),6,I,0),"^")=PSORXED("DOSE",I) D
"RTN","PSOORED7",38,0)
 ..I $G(PSORXED("DOSE ORDERED",I)) S:PSORXED("DOSE ORDERED",I)'=$P(^PSRX(PSORXED("IRXN"),6,I,0),"^",2) PSOSIGFL=1
"RTN","PSOORED7",39,0)
 .I $G(PSORXED("DURATION",I))]"" D
"RTN","PSOORED7",40,0)
 ..S DURATION=$S($E($P(^PSRX(PSORXED("IRXN"),6,I,0),"^",5),1)'?.N:$E($P(^PSRX(PSORXED("IRXN"),6,I,0),"^",5),2,99)_$E($P(^PSRX(PSORXED("IRXN"),6,I,0),"^",5),1),1:$P(^PSRX(PSORXED("IRXN"),6,I,0),"^",5))
"RTN","PSOORED7",41,0)
 ..I +DURATION'=+$G(PSORXED("DURATION",I)) S PSOSIGFL=1
"RTN","PSOORED7",42,0)
 .I $P(^PSRX(PSORXED("IRXN"),6,I,0),"^",6)'=$G(PSORXED("CONJUNCTION",I)) S PSOSIGFL=1
"RTN","PSOORED7",43,0)
 .I $P(^PSRX(PSORXED("IRXN"),6,I,0),"^",7)'=$G(PSORXED("ROUTE",I)) S PSOSIGFL=1
"RTN","PSOORED7",44,0)
 .I $P(^PSRX(PSORXED("IRXN"),6,I,0),"^",8)'=PSORXED("SCHEDULE",I) S PSOSIGFL=1
"RTN","PSOORED7",45,0)
 .I $G(^PSRX(PSORXED("IRXN"),6,I,1))'=$G(PSORXED("ODOSE",I)) S PSOSIGFL=1
"RTN","PSOORED7",46,0)
 K DURATION
"RTN","PSOORED7",47,0)
 Q
"RTN","PSOOREDT")
0^11^B64105311
"RTN","PSOOREDT",1,0)
PSOOREDT ;BIR/SAB - edit orders from backdoor ;03/06/96
"RTN","PSOOREDT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,20,27,37,57,46,78,102,104,119,143,148**;DEC 1997
"RTN","PSOOREDT",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOOREDT",4,0)
 ;External reference to PSSLOCK supported by DBIA 2789
"RTN","PSOOREDT",5,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSOOREDT",6,0)
SEL K PSOISLKD,PSOLOKED S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY D SVAL K PSOPLCK S VALMBCK="" Q
"RTN","PSOOREDT",7,0)
 K PSOPLCK D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) D UL^PSSLOCK(+$G(PSODFN)) D SVALO K PSOMSG S VALMBCK="" Q
"RTN","PSOOREDT",8,0)
 K PSOMSG S PSOLOKED=1
"RTN","PSOOREDT",9,0)
 K PSORX("DFLG"),DIR,DUOUT,DIRUT S DIR("A")="Select fields by number"
"RTN","PSOOREDT",10,0)
 S DIR(0)="LO^1:"_$S($$STATUS^PSOBPSUT($P(PSOLST(ORN),"^",2))'="":21,$G(REF):20,1:19)
"RTN","PSOOREDT",11,0)
 D ^DIR I $D(DIRUT) K DIR,DIRUT,DTOUT S VALMBCK="" D UL K PSOLOKED Q
"RTN","PSOOREDT",12,0)
EDTSEL N VALMCNT K PSOISLKD,PSORX("DFLG"),PSOOIFLG,PSOMRFLG,DIR,DIRUT,DTOUT,DTOUT,ZONE S (PSOEDIT,PSORXED)=1 I +Y S FST=Y D HLDHDR^PSOLMUTL D  G EX ;PSO LM SELECT MENU protocol
"RTN","PSOOREDT",13,0)
 .I '$G(PSOLOKED) S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY D SVAL K PSOPLCK S VALMBCK="",(PSOISLKD,PSODE)=1 Q
"RTN","PSOOREDT",14,0)
 .I '$G(PSOLOKED) K PSOPLCK D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) D UL^PSSLOCK(+$G(PSODFN)) D SVALO K PSOMSG S VALMBCK="",(PSOISLKD,PSODE)=1 Q
"RTN","PSOOREDT",15,0)
 .K PSOMSG,PSOPLCK S (NEWEDT,PSOLOKED)=1 D EDT
"RTN","PSOOREDT",16,0)
 E  S VALMBCK="",PSODE=1
"RTN","PSOOREDT",17,0)
EX I $G(PSOISLKD) D UL K PSOISLKD G EX2
"RTN","PSOOREDT",18,0)
 I '$G(PSOSIGFL),'$G(PSORXED("DFLG")) D UPDATE^PSOORED6 D LOG^PSORXED,POST^PSORXED G EX1
"RTN","PSOOREDT",19,0)
 I $G(PSOSIGFL)=1 D  Q:$G(PSORX("FN"))
"RTN","PSOOREDT",20,0)
 .N PSOTMP
"RTN","PSOOREDT",21,0)
 .S PSOTMP=$G(PSOFROM),PSOFROM="NEW"
"RTN","PSOOREDT",22,0)
 .S VALMSG="This change will create a new prescription!",NCPDPFLG=1
"RTN","PSOOREDT",23,0)
 .D EN^PSOORED1(.PSORXED)
"RTN","PSOOREDT",24,0)
 .I $G(PSORX("FN")) D  Q
"RTN","PSOOREDT",25,0)
 ..D ^PSOBUILD
"RTN","PSOOREDT",26,0)
 ..K QUIT,PSORX("DFLG"),FST,FLD,IEN,FLN,INCOM,PSOI,PSODRUG,PSOEDIT
"RTN","PSOOREDT",27,0)
 ..K PSORENW,PSOSIGFL,PSOOIFLG,PSOMRFLG,PSODIR,CHK,PSORX("SIG"),PSODE
"RTN","PSOOREDT",28,0)
 ..K PSOTRN,PSORX("EDIT"),PSORXED("FLD"),NEWEDT
"RTN","PSOOREDT",29,0)
 ..D EOJ^PSONEW
"RTN","PSOOREDT",30,0)
 ..D UL K PSOLOKED S VALMBCK="Q"
"RTN","PSOOREDT",31,0)
 .S PSOFROM=PSOTMP I PSOFROM="" K PSOFROM
"RTN","PSOOREDT",32,0)
 ;
"RTN","PSOOREDT",33,0)
EX1 I '$G(PSODE)!('$G(ZONE)) I $G(PSORENW("OIRXN")) D EN^PSOHLSN1(PSORENW("OIRXN"),"XX","","Order edited")
"RTN","PSOOREDT",34,0)
QUIT D UL K PSOLOKED D ^PSOBUILD,ACT^PSOORNE2 D:+^PSRX($P(PSOLST(ORN),"^",2),"STA")=5 EN^PSOCMOPC($P(PSOLST(ORN),"^",2))
"RTN","PSOOREDT",35,0)
 K:'$O(^PSRX($P(PSOLST(ORN),"^",2),1,0)) REF
"RTN","PSOOREDT",36,0)
EX2 S VALMBCK=$S($G(PSORX("FN")):"Q",$G(ZONE):"Q",1:"R") K PSORXED,FST,FLD,IEN,FLN,INCOM,PSOI,PSODRUG,PSOEDIT,PSORENW,PSOSIGFL,PSODIR,CHK,PSORX("SIG"),PSODE,PSOTRN,PSORX("DFLG"),RFED,ZONE,PSORX("EDIT"),PSOOIFLG,PSOMRFLG,SIG,QUIT
"RTN","PSOOREDT",37,0)
 K NEWEDT I $G(VALMBCK)="R" W ! D CLEAN^PSOVER1 H 2
"RTN","PSOOREDT",38,0)
 Q
"RTN","PSOOREDT",39,0)
 ;
"RTN","PSOOREDT",40,0)
EDT S NCPDPFLG=0
"RTN","PSOOREDT",41,0)
 S I=0 F  S I=$O(^PSRX($P(PSOLST(ORN),"^",2),1,I)) Q:'I  S PSORXED("RX1")=^PSRX($P(PSOLST(ORN),"^",2),1,I,0)
"RTN","PSOOREDT",42,0)
 S (RX0,PSORXED("RX0"))=^PSRX($P(PSOLST(ORN),"^",2),0),PSORXED("RX2")=$G(^(2)),PSORXED("RX3")=$G(^(3)),PSOSIG=$P(^("SIG"),"^")
"RTN","PSOOREDT",43,0)
 F FLD=1:1:$L(FST,",") Q:$P(FST,",",FLD)']""!($G(PSORXED("DFLG")))!($G(PSORX("DFLG")))  S FLN=+$P(FST,",",FLD) D
"RTN","PSOOREDT",44,0)
 .S PSORXED("DFLG")=0,(DA,PSORXED("IRXN"),PSORENW("OIRXN"))=$P(PSOLST(ORN),"^",2),RX0=^PSRX(PSORXED("IRXN"),0) S:$G(PSOSIG)="" PSOSIG=$P(^("SIG"),"^")
"RTN","PSOOREDT",45,0)
 .I '$G(PSOSIGFL) D
"RTN","PSOOREDT",46,0)
 ..S PSOI=+^PSRX(DA,"OR1"),PSODAYS=$P(RX0,"^",8),PSORXST=+$P($G(^PS(53,$P(RX0,"^",3),0)),"^",7)
"RTN","PSOOREDT",47,0)
 ..I 'PSOI S PSOI=+^PSDRUG($P(RX0,"^",6),2),$P(^PSRX(DA,"OR1"),"^")=PSOI
"RTN","PSOOREDT",48,0)
 ..S:'$G(PSODRUG("IEN")) PSODRUG("IEN")=$P(RX0,"^",6),PSODRUG("NAME")=$P(^PSDRUG($P(RX0,"^",6),0),"^")
"RTN","PSOOREDT",49,0)
 ..S PSODRUG("OI")=PSOI
"RTN","PSOOREDT",50,0)
 .S PSORX("PROVIDER")=$P(RX0,"^",4),PSORX("PROVIDER NAME")=$P(^VA(200,$P(RX0,"^",4),0),"^"),PSOTRN=$G(^PSRX(DA,"TN"))
"RTN","PSOOREDT",51,0)
 .D:'$G(CHK) POP^PSOSIGNO(DA),CHK Q:$G(PSORXED("DFLG"))
"RTN","PSOOREDT",52,0)
 .S FDR="39.2^"_$S($P(PSOPAR,"^",3):"6",1:"")_";6.5^113^114^3^1^22R^24^8^7^9^4^11;"_$S($P(RX0,"^",11)="W"&($P(PSOPAR,"^",12)):"35;",1:"")_"^10.6^5^20^23^12^PSOCOU^RF^81"
"RTN","PSOOREDT",53,0)
 .I FLN=20,'$G(REF) S VALMSG="There is no Refill Data to be edited." Q
"RTN","PSOOREDT",54,0)
 .S DR=$P(FDR,"^",FLN) I DR="RF" D REF^PSOORED2 Q
"RTN","PSOOREDT",55,0)
 .I DR="PSOCOU" D PSOCOU^PSOORED6 Q
"RTN","PSOOREDT",56,0)
 .I FLN=2,'$P(PSOPAR,"^",3) D  Q
"RTN","PSOOREDT",57,0)
 ..N NDC D NDC^PSODRG(RXN,0,,.NDC) I $G(NDC)="^"!($G(NDC)="") Q
"RTN","PSOOREDT",58,0)
 ..S (PSODRUG("NDC"),PSORXED("FLD",27))=NDC
"RTN","PSOOREDT",59,0)
 .I FLN'>2,'$P(PSOPAR,"^",3) S VALMSG="Check site parameters, Drug data is not editable." Q
"RTN","PSOOREDT",60,0)
 .I FLN=3 D EDTDOSE^PSOORED2 Q
"RTN","PSOOREDT",61,0)
 .I FLN=4 D INS^PSOORED1 Q
"RTN","PSOOREDT",62,0)
 .I FLN=1 D PSOI^PSOORED6 N PSOX S PSORXED=1,PSOX("IRXN")=$S($D(DA):DA,$D(PSORXED("IRXN")):PSORXED("IRXN"),$D(PSORENW("OIRXN")):PSORENW("OIRXN")) D:'$G(PSORXED("DFLG")) EN^PSODIAG Q
"RTN","PSOOREDT",63,0)
 .I FLN=2 D DRG^PSOORED6 N PSOX S PSORXED=1,PSOX("IRXN")=PSORXED("IRXN") D:'$G(PSORXED("DFLG")) EN^PSODIAG S:$O(^PSRX(PSORXED("IRXN"),1,0)) REF=1 Q
"RTN","PSOOREDT",64,0)
 .I FLN=12 D PROV Q
"RTN","PSOOREDT",65,0)
 .I FLN=6 D ISDT^PSOORED2 Q
"RTN","PSOOREDT",66,0)
 .I FLN=7 D FLDT^PSOORED2 Q
"RTN","PSOOREDT",67,0)
 .I FLN=21,$$STATUS^PSOBPSUT(RXN,0)="" S VALMSG="Invalid selection!" Q
"RTN","PSOOREDT",68,0)
 .I FLN=21 D  Q
"RTN","PSOOREDT",69,0)
 ..N DAW D EDTDAW^PSODAWUT(RXN,0,.DAW) I $G(DAW)="^" Q
"RTN","PSOOREDT",70,0)
 ..S (PSODRUG("DAW"),PSORXED("FLD",81))=DAW
"RTN","PSOOREDT",71,0)
 .I FLN=9!(FLN=10)!(FLN=11) D NOCHG^PSOORED7 Q
"RTN","PSOOREDT",72,0)
 .S DR=+DR
"RTN","PSOOREDT",73,0)
 .K DIR,DIRUT,DIROUT ;S DIE=52 D ^DIE I $D(Y) S PSORXED("DFLG")=1
"RTN","PSOOREDT",74,0)
 .K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED" D EN^DIQ1 K DIC,DIQ
"RTN","PSOOREDT",75,0)
 .S DIR("B")=$S($G(PSORXED("FLD",DR))]"":PSORXED("FLD",DR),1:PSORXED(52,DA,DR)),DIR(0)="52,"_DR D ^DIR
"RTN","PSOOREDT",76,0)
 .I DR=24!(DR=12) S PSORXED("FLD",DR)=X
"RTN","PSOOREDT",77,0)
 .I $D(DIRUT) K DIR,DIRUT,DUOUT,DTOUT,PSORXED(52,DA,DR),PSORXED("FLD",DR) Q
"RTN","PSOOREDT",78,0)
 .I DR'=5,X="@" W !,"Data Required!",! K DIC,DIQ,DR,DA,DIR,DIRUT,PSORXED(52,DA,DR),X,Y Q
"RTN","PSOOREDT",79,0)
 .I DR=5,X'="@" S Y=+Y
"RTN","PSOOREDT",80,0)
 .I DR=3!(DR=20)!(DR=23) S Y=+Y
"RTN","PSOOREDT",81,0)
 .S PSORXED("FLD",DR)=$S(X="@":X,1:Y) K DIR,DIRUT,DIROUT,X,Y,PSORXED(52,DA,DR)
"RTN","PSOOREDT",82,0)
 .I DR=11,PSORXED("FLD",DR)="W",$P(PSOPAR,"^",12) D
"RTN","PSOOREDT",83,0)
 ..D FIELD^DID(52,DR,"","LABEL","ZZ") S PSORXED(ZZ("LABEL"))=PSORXED("FLD",DR) K ZZ
"RTN","PSOOREDT",84,0)
 ..S DR=35,DIQ="PSORXED" D EN^DIQ1 K DIC,DIQ,DIRUT,DUOUT,DTOUT
"RTN","PSOOREDT",85,0)
 ..S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR)
"RTN","PSOOREDT",86,0)
 ..S DIR(0)="52,"_(DR) D ^DIR I $D(DIRUT),X'="@" K DIR,DIRUT Q
"RTN","PSOOREDT",87,0)
 ..S PSORXED("FLD",DR)=X K DIR,DIRUT,DIROUT,X,Y,PSORXED(52,DA,DR)
"RTN","PSOOREDT",88,0)
 .I $G(PSORXED("FLD",DR))]"" D FIELD^DID(52,DR,"","LABEL","ZZ") S PSORXED(ZZ("LABEL"))=PSORXED("FLD",DR) K ZZ
"RTN","PSOOREDT",89,0)
 Q:$G(PSOSIGFL)
"RTN","PSOOREDT",90,0)
 S (RX1,I,RFD,RFDT)=0 F  S I=$O(^PSRX(PSORXED("IRXN"),1,I)) Q:'I  S RFD=I,RFDT=$P(^PSRX(PSORXED("IRXN"),1,I,0),"^"),RX1(I)=$G(RX1(I))+1
"RTN","PSOOREDT",91,0)
 Q
"RTN","PSOOREDT",92,0)
CHK S CHK=1 I $G(^PSDRUG($P(PSORXED("RX0"),"^",6),"I"))]"",^("I")<DT S VALMSG="This drug has been inactivated. ",PSORXED("DFLG")=1 Q
"RTN","PSOOREDT",93,0)
 K PSPOP I $G(PSODIV),$P(PSORXED("RX2"),"^",9)'=PSOSITE S PSPRXN=PSORXED("IRXN") D  Q:PSORXED("DFLG")
"RTN","PSOOREDT",94,0)
 .I '$P(PSOSYS,"^",2) S VALMSG="RX# "_$P(^PSRX(PSPRXN,0),"^")_" is not a valid choice. (Different Division)" S PSORXED("DFLG")=1 Q
"RTN","PSOOREDT",95,0)
 .I $P(PSOSYS,"^",3) K DIR,DUOUT,DTOUT D  K DIR,DUOUT,DTOUT Q
"RTN","PSOOREDT",96,0)
 ..W $C(7) S DIR("A",1)="",DIR("A",2)="RX# "_$P(^PSRX(PSPRXN,0),"^")_" is from another division.",DIR("A")="Continue: (Y/N)",DIR(0)="Y",DIR("?",1)="'Y' FOR YES",DIR("?")="'N' FOR NO"
"RTN","PSOOREDT",97,0)
 ..S DIR("B")="N" D ^DIR I 'Y!($D(DIRUT)) S PSORXED("DFLG")=1 W !
"RTN","PSOOREDT",98,0)
 ;
"RTN","PSOOREDT",99,0)
 I $P(^PSRX(PSORXED("IRXN"),"STA"),"^")=14!($P(^("STA"),"^")=15) S PSORXED("DFLG")=1 S VALMSG="Discontinued prescriptions cannot be edited." Q
"RTN","PSOOREDT",100,0)
 I $P(^PSRX(PSORXED("IRXN"),"STA"),"^")=16 S PSORXED("DFLG")=1 S VALMSG="Prescriptions on Provider Hold cannot be edited." Q
"RTN","PSOOREDT",101,0)
CHKX K PSPOP,DIR,DTOUT,DUOUT,Y,X Q
"RTN","PSOOREDT",102,0)
 Q
"RTN","PSOOREDT",103,0)
PROV ;select provider
"RTN","PSOOREDT",104,0)
 S PSORXED("PROVIDER")=$P(RX0,"^",4),PSORXED("PROVIDER NAME")=$P(^VA(200,$P(RX0,"^",4),0),"^")
"RTN","PSOOREDT",105,0)
 D PROV^PSODIR(.PSORXED) I PSORXED("PROVIDER")'=$P(RX0,"^",4) D
"RTN","PSOOREDT",106,0)
 .K DIR,DIRUT W ! S DIR(0)="Y",DIR("A",1)="You have changed the name of the provider entered for this Rx."
"RTN","PSOOREDT",107,0)
 .S DIR("A",2)="This edit will cause the provider's name to be update for all fills.",DIR("A")="Do you want to continue" D ^DIR
"RTN","PSOOREDT",108,0)
 .I 'Y!$D(DIRUT) K PSORX("PROVIDER"),PSORX("PROVIDER NAME"),PSORX("COSIGNING PROVIDER") Q
"RTN","PSOOREDT",109,0)
 .S PSORXED("FLD",4)=PSORXED("PROVIDER") K DIR,DIRUT,DUOUT
"RTN","PSOOREDT",110,0)
 .S PSORXED("FLD",109)=$G(PSORXED("COSIGNING PROVIDER"))
"RTN","PSOOREDT",111,0)
 Q
"RTN","PSOOREDT",112,0)
UDPROV ;update provider
"RTN","PSOOREDT",113,0)
 S $P(^PSRX(PSORXED("IRXN"),0),"^",4)=PSORXED("PROVIDER"),$P(^(3),"^",3)=$G(PSORX("COSIGNING PROVIDER"))
"RTN","PSOOREDT",114,0)
 F XTY="1","P" F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),XTY,I)) Q:'I  S $P(^PSRX(PSORXED("IRXN"),XTY,I,0),"^",17)=PSORXED("PROVIDER") S:XTY RFED=I
"RTN","PSOOREDT",115,0)
 K XTY,I
"RTN","PSOOREDT",116,0)
 Q
"RTN","PSOOREDT",117,0)
SIG ;edit medication instructions (SIG)
"RTN","PSOOREDT",118,0)
 S PSOFDR=+$P(^PSRX(PSORXED("IRXN"),"SIG"),"^",2) I PSOFDR D
"RTN","PSOOREDT",119,0)
 .F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORXED("IRXN"),"SIG1",I,0)
"RTN","PSOOREDT",120,0)
 E  S PSORX("SIG")=$P(^PSRX(PSORXED("IRXN"),"SIG"),"^")
"RTN","PSOOREDT",121,0)
 D SIG^PSODIR1(.PSORX) D:$G(PSORX("SIG"))]"" EN1^PSOSIGNO(PSORXED("IRXN"),PSORX("SIG"))
"RTN","PSOOREDT",122,0)
 I '$G(PSOSIGFL),$G(PSORX("SIG"))]"" S ^PSRX(PSORXED("IRXN"),"SIG")=PSORX("SIG") K ^PSRX(PSORXED("IRXN"),"SIG1") Q
"RTN","PSOOREDT",123,0)
 S PSOMRFLG=1
"RTN","PSOOREDT",124,0)
 Q
"RTN","PSOOREDT",125,0)
UL ;
"RTN","PSOOREDT",126,0)
 I '$G(PSOLOKED) Q
"RTN","PSOOREDT",127,0)
 D UL^PSSLOCK(PSODFN)
"RTN","PSOOREDT",128,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOOREDT",129,0)
 Q
"RTN","PSOOREDT",130,0)
SVAL ;Set message for patient lock
"RTN","PSOOREDT",131,0)
 S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.")
"RTN","PSOOREDT",132,0)
 Q
"RTN","PSOOREDT",133,0)
SVALO ;Set message for order lock
"RTN","PSOOREDT",134,0)
 S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order.")
"RTN","PSOOREDT",135,0)
 Q
"RTN","PSOOREDT",136,0)
 ;
"RTN","PSOORNE1")
0^12^B67734150
"RTN","PSOORNE1",1,0)
PSOORNE1 ;BIR/SAB - Display new orders from backdoor ;03/06/95
"RTN","PSOORNE1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,21,27,32,37,46,71,94,104,117,133,148**;DEC 1997
"RTN","PSOORNE1",3,0)
 ;External reference to ^PS(55 is supported by DBIA 2228
"RTN","PSOORNE1",4,0)
EN(PSONEW) D DSPL^PSOORNE3,^PSOLMPO2
"RTN","PSOORNE1",5,0)
 Q
"RTN","PSOORNE1",6,0)
EDT N FLD,LST K DIR,DUOUT,DIRUT S DIR("A")="Select Field to Edit by number",DIR(0)="LO^1:14" D ^DIR I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DTOUT S VALMBCK="" Q
"RTN","PSOORNE1",7,0)
EDTSEL S:'$G(COPY) PSOEDIT=1 S (PSONEW("DFLG"),PSONEW("FIELD"),PSONEW3)=0
"RTN","PSOORNE1",8,0)
 I +Y S LST=Y D HLDHDR^PSOLMUTL D  Q:$G(PSORX("DFLG"))!($G(PSORX("QFLG")))  S VALMBCK="R" G DSPL^PSOORNE3
"RTN","PSOORNE1",9,0)
 .F FLD=1:1:$L(LST,",") Q:$P(LST,",",FLD)']""  D @(+$P(LST,",",FLD)) Q:$G(PSODIR("DFLG"))!($G(PSODIR("QFLG")))
"RTN","PSOORNE1",10,0)
 E  S VALMBCK="" D FULL^VALM1
"RTN","PSOORNE1",11,0)
 D RDSPL G DSPL^PSOORNE3
"RTN","PSOORNE1",12,0)
 Q
"RTN","PSOORNE1",13,0)
ACP K VALMSG,DIR,PSORX("DFLG") D VER I $G(PSONEW2("QFLG"))!($G(PSORX("DFLG"))) S VALMBCK="Q" K PSONEW2 Q
"RTN","PSOORNE1",14,0)
 N PSONOBCK S PSONOBCK=$S($G(PSOSIGFL):1,1:0)
"RTN","PSOORNE1",15,0)
 D NOOR^PSONEW I $D(DIRUT) S PSONEW("DFLG")=1 K DIR,X,Y,DIRUT,DUOUT,DTOUT Q
"RTN","PSOORNE1",16,0)
 D RXNCHK,RDSPL
"RTN","PSOORNE1",17,0)
 I $G(PSONEW("QFLG")) S PSONEW("DFLG")=1 K DIR,X,Y,DIRUT,DUOUT,DTOUT Q
"RTN","PSOORNE1",18,0)
 D DISPLAY^PSONEW2
"RTN","PSOORNE1",19,0)
 D ^PSONEWG I $G(PSOCPZ("DFLG")) S PSONEW("DFLG")=1 K PSOANSQ,DIR,X,Y,DIRUT,DUOUT,DTOUT,PSOCPZ("DFLG"),PSOANSQD Q
"RTN","PSOORNE1",20,0)
 K PSOCPZ("DFLG")
"RTN","PSOORNE1",21,0)
 K DIR,DIRUT,X,Y S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this correct" D ^DIR
"RTN","PSOORNE1",22,0)
 I $D(DIRUT) S PSONEW("DFLG")=1 K PSOANSQ,PSOANSQD,DIR,X,Y,DIRUT,DUOUT,DTOUT Q
"RTN","PSOORNE1",23,0)
 I 'Y S VALMBCK="R" K PSOANSQ,DIR,X,Y,DIRUT,DUOUT,DTOUT D DSPL^PSOORNE3 Q
"RTN","PSOORNE1",24,0)
 W "..." K PSOANSQD,DIR,X,Y,DIRUT,DUOUT,DTOUT D DCORD^PSONEW2
"RTN","PSOORNE1",25,0)
 I $G(NCPDPFLG) D NCPDP^PSOORED6
"RTN","PSOORNE1",26,0)
 K:$G(COPY)!($G(PSOSIGFL)) PRC,PHI
"RTN","PSOORNE1",27,0)
 S:'$G(PSOID) PSOID=DT S (PSORX("FN"),PSONEW("POE"))=1 D EN^PSON52(.PSONEW) ; Files entry in File 52
"RTN","PSOORNE1",28,0)
 I $G(PSOBEDT) D
"RTN","PSOORNE1",29,0)
 .I '$D(^TMP("PSOBEDT",$J,PSODFN,0)) S ^TMP("PSOBEDT",$J,PSODFN,0)=PSORXED("IRXN") S:$G(PSONEW("MAIL/WINDOW"))["W" ^TMP("PSOBEDT",$J,PSODFN,1)=1 Q
"RTN","PSOORNE1",30,0)
 .S ^TMP("PSOBEDT",$J,PSODFN,0)=^TMP("PSOBEDT",$J,PSODFN,0)_","_PSORXED("IRXN")
"RTN","PSOORNE1",31,0)
 .I $G(PSONEW("MAIL/WINDOW"))["W" S ^TMP("PSOBEDT",$J,PSODFN,1)=1
"RTN","PSOORNE1",32,0)
 D NPSOSD^PSOUTIL(.PSONEW) ; Adds newly added rx to PSOSD array
"RTN","PSOORNE1",33,0)
 D ^PSOBUILD S VALMBCK="Q"
"RTN","PSOORNE1",34,0)
 K PSONEW("# OF REFILLS"),PSONEW("DAYS SUPPLY"),SDA,SEG1,SSN1,STA,Z4,ZDA
"RTN","PSOORNE1",35,0)
 Q:$G(COPY)  S PSONEW("DFLG")=0
"RTN","PSOORNE1",36,0)
 Q
"RTN","PSOORNE1",37,0)
VER I $G(PSOAC),$G(PSODRUG("NAME"))']"" D FULL^VALM1,2^PSOORNW1
"RTN","PSOORNE1",38,0)
 I $G(PSODRUG("NAME"))']"" S VALMSG="A Dispense Drug Must be Chosen!" S PSONEW2("QFLG")=1 Q
"RTN","PSOORNE1",39,0)
 I '$G(PSONEW("ENT")) W !,"Dosing Instruction Missing!!",! D  I PSONEW("DFLG")=1 S PSONEW2("QFLG")=1 Q
"RTN","PSOORNE1",40,0)
 .S PSOORRNW=1
"RTN","PSOORNE1",41,0)
 .K VALMSG D FULL^VALM1 W !,"Drug: "_PSODRUG("NAME")
"RTN","PSOORNE1",42,0)
 .I $O(SIG(0)) F I=1:1 Q:$G(SIG(I))']""  W !,SIG(I)
"RTN","PSOORNE1",43,0)
 .E   I $G(^PSRX(PSONEW("OIRXN"),"SIG"))]"" S X=$P(^PSRX(PSONEW("OIRXN"),"SIG"),"^") D SIGONE^PSOHELP W !,$E($G(INS1),2,250)
"RTN","PSOORNE1",44,0)
 .W ! D 5 K PSOORRNW I PSONEW("DFLG")=1 D M3 Q
"RTN","PSOORNE1",45,0)
 .D 6 D:PSONEW("DFLG")=1 M3
"RTN","PSOORNE1",46,0)
 D:$G(COPY) PROV^PSOUTIL(.PSORENW) I PSONEW("DFLG")=1 S PSONEW2("QFLG")=1 Q
"RTN","PSOORNE1",47,0)
 D FULL^VALM1,POST^PSODRG:'$G(PSOSIGFL) K PSONOOR I $G(PSORX("DFLG")) S VALMBCK="Q" Q
"RTN","PSOORNE1",48,0)
 I +$G(PSEXDT) D
"RTN","PSOORNE1",49,0)
 .D FULL^VALM1 S:$G(PSONEW("MAIL/WINDOW"))["W" BINGCRT="Y",BINGRTE="W"
"RTN","PSOORNE1",50,0)
 .D:+$G(PSEXDT)
"RTN","PSOORNE1",51,0)
 ..S Y=PSONEW("FILL DATE") X ^DD("DD") W !!,$C(7),Y_" fill date is greater than possible expiration date of " S Y=$P(PSEXDT,"^",2) X ^DD("DD") W Y_"."
"RTN","PSOORNE1",52,0)
 .S PSONEW2("QFLG")=1,VALMBCK="R" D PAUSE^VALM1
"RTN","PSOORNE1",53,0)
 Q
"RTN","PSOORNE1",54,0)
1 I $G(PSOSIGFL) S PSOAC=1 D 2^PSOORNW1 K PSOAC D RDSPL G DSPL^PSOORNE3 Q
"RTN","PSOORNE1",55,0)
 D 6^PSOBKDED D RDSPL G DSPL^PSOORNE3 Q
"RTN","PSOORNE1",56,0)
 ;
"RTN","PSOORNE1",57,0)
2 D 3^PSOBKDED Q
"RTN","PSOORNE1",58,0)
 ;
"RTN","PSOORNE1",59,0)
3 D 1^PSOBKDED Q
"RTN","PSOORNE1",60,0)
 ;
"RTN","PSOORNE1",61,0)
4 D 2^PSOBKDED Q
"RTN","PSOORNE1",62,0)
 ;
"RTN","PSOORNE1",63,0)
5 I '$G(PSODRUG("IEN")) W !,"DRUG NAME REQUIRED!" D 2^PSOORNW1 I '$G(PSODRUG("IEN")) S VALMSG="No Dispense Drug Selected" Q
"RTN","PSOORNE1",64,0)
 W !!,"Drug: "_PSODRUG("NAME") D 10^PSOBKDED Q
"RTN","PSOORNE1",65,0)
 ;
"RTN","PSOORNE1",66,0)
6 D INS^PSOBKDED Q:$G(PSONEW("DFLG"))  I $P($G(^PS(55,PSODFN,"LAN")),"^") D SINS^PSODIR(.PSONEW)
"RTN","PSOORNE1",67,0)
 Q
"RTN","PSOORNE1",68,0)
 ;
"RTN","PSOORNE1",69,0)
7 D 8^PSOBKDED Q
"RTN","PSOORNE1",70,0)
 ;
"RTN","PSOORNE1",71,0)
8 D 7^PSOBKDED Q
"RTN","PSOORNE1",72,0)
 ;
"RTN","PSOORNE1",73,0)
9 D 9^PSOBKDED Q
"RTN","PSOORNE1",74,0)
 ;
"RTN","PSOORNE1",75,0)
10 D 12^PSOBKDED Q
"RTN","PSOORNE1",76,0)
 ;
"RTN","PSOORNE1",77,0)
11 D 5^PSOBKDED Q
"RTN","PSOORNE1",78,0)
 ;
"RTN","PSOORNE1",79,0)
12 D 4^PSOBKDED Q
"RTN","PSOORNE1",80,0)
 ;
"RTN","PSOORNE1",81,0)
13 D 11^PSOBKDED Q
"RTN","PSOORNE1",82,0)
 ;
"RTN","PSOORNE1",83,0)
14 D 13^PSOBKDED Q
"RTN","PSOORNE1",84,0)
 ;
"RTN","PSOORNE1",85,0)
SUMM ;print break down of orders to be finished
"RTN","PSOORNE1",86,0)
 K ^TMP($J,"PSOCZT"),^TMP($J,"PSODPAT"),PAT,RT,DIR,DUOUT,DIRUT,PSZLQUIT
"RTN","PSOORNE1",87,0)
 S DIR("A")="Do you want an Order Summary",DIR(0)="Y",DIR("B")="No"
"RTN","PSOORNE1",88,0)
 D ^DIR K DIR I 'Y!($D(DIRUT)) K Y,X,DIRUT Q
"RTN","PSOORNE1",89,0)
 K PSOINPRT,DIQ,^UTILITY("DIQ1",$J) I $G(PSOPINST) S DA=PSOPINST,DIC=4,DIQ(0)="E",DR=".01" D EN^DIQ1 S PSOINPRT=$G(^UTILITY("DIQ1",$J,4,DA,.01,"E")) K ^UTILITY("DIQ1",$J),DA,DR,DIC,DIQ
"RTN","PSOORNE1",90,0)
 I $D(^PS(52.41,"ACL")) N PSOCLSUM D SUMMCL I $G(PSOCLSUM) K PSOINPRT Q
"RTN","PSOORNE1",91,0)
 F PSI=0:0 S PSI=$O(^PS(52.41,"AOR",PSI)) Q:'PSI  F PSID=0:0 S PSID=$O(^PS(52.41,"AOR",PSI,PSID)) Q:'PSID  F PIN=0:0 S PIN=$O(^PS(52.41,"AOR",PSI,PSID,PIN)) Q:'PIN  D
"RTN","PSOORNE1",92,0)
 .I '$D(^TMP($J,"PSOCZT",PSID,"PAT")) F PZA="PAT","WIN","MAIL","CLIN" S ^TMP($J,"PSOCZT",PSID,PZA)=0
"RTN","PSOORNE1",93,0)
 .I '$D(^TMP($J,"PSODPAT",PSID,PSI)) S ^TMP($J,"PSODPAT",PSID,PSI)=1,^TMP($J,"PSOCZT",PSID,"PAT")=^TMP($J,"PSOCZT",PSID,"PAT")+1
"RTN","PSOORNE1",94,0)
 .S PZROUT=$P($G(^PS(52.41,PIN,0)),"^",17) I PZROUT'="" S ^TMP($J,"PSOCZT",PSID,$S(PZROUT="C":"CLIN",PZROUT="M":"MAIL",1:"WIN"))=^TMP($J,"PSOCZT",PSID,$S(PZROUT="C":"CLIN",PZROUT="M":"MAIL",1:"WIN"))+1
"RTN","PSOORNE1",95,0)
 W @IOF W !?20,"Pending Outpatient Medication Orders",! I $G(PSZCNT)>1 W ?20,"(signed in under "_$G(PSOINPRT)_")",!
"RTN","PSOORNE1",96,0)
 F PSOINL=0:0 S PSOINL=$O(^TMP($J,"PSOCZT",PSOINL)) Q:'PSOINL!($G(PSZLQUIT))  D
"RTN","PSOORNE1",97,0)
 .I ($Y+6)>IOSL K DIR S DIR(0)="E" D ^DIR K DIR D:$G(Y)  I '$G(Y) S PSZLQUIT=1 W ! Q
"RTN","PSOORNE1",98,0)
 ..W @IOF W !?20,"Pending Outpatient Medication Orders",! I $G(PSZCNT)>1 W ?20,"(signed in under "_$G(PSOINPRT)_")",!
"RTN","PSOORNE1",99,0)
 .K ^UTILITY("DIQ1",$J),DIQ,PSOINPRX S DA=$G(PSOINL),DIC=4,DIQ(0)="E",DR=".01" D EN^DIQ1 S PSOINPRX=$G(^UTILITY("DIQ1",$J,4,DA,.01,"E")) K ^UTILITY("DIQ1",$J),DA,DR,DIC,DIQ
"RTN","PSOORNE1",100,0)
 .W !,"Division: ",$G(PSOINPRX)
"RTN","PSOORNE1",101,0)
 .W !,"Patients: "_$G(^TMP($J,"PSOCZT",PSOINL,"PAT"))_"  Window: "_$G(^("WIN"))_"  Mail: "_$G(^("MAIL"))_"  Clinic: "_$G(^("CLIN")),!
"RTN","PSOORNE1",102,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSOORNE1",103,0)
 K ^TMP($J,"PSOCZT"),^TMP($J,"PSODPAT"),RT,PSOINPRT,PSOINPRX,PSI,PSID,PIN,PZA,PZROUT,PSOINL,PSZLQUIT
"RTN","PSOORNE1",104,0)
 Q
"RTN","PSOORNE1",105,0)
SUMMCL ;
"RTN","PSOORNE1",106,0)
 W ! K DIR S DIR(0)="SMB^D:DIVISION;C:CLINIC",DIR("A")="Do you want the summary by Division or Clinic",DIR("B")="Division",DIR("?")=" "
"RTN","PSOORNE1",107,0)
 S DIR("?",1)="Enter 'D' to see the summary by Division, and within Division the orders",DIR("?",2)="shown by Mail, Window, or Administered in Clinic.",DIR("?",3)="Enter 'C' to see the summary by Clinic, along with Clinic Sort Groups."
"RTN","PSOORNE1",108,0)
 D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) S PSOCLSUM=1 Q
"RTN","PSOORNE1",109,0)
 Q:$G(Y)="D"
"RTN","PSOORNE1",110,0)
 S PSOCLSUM=1
"RTN","PSOORNE1",111,0)
 K ^TMP($J,"PSOLOC"),^TMP($J,"PSOLOCP") N PSCX,PSCXL,PSLX,PSCIN,PSCPT,PSCNDE,PSNCL,PSNPAT,PSCLOUT,PSCSFLAG,PCCNT,PSOCAG
"RTN","PSOORNE1",112,0)
 F PSCX=0:0 S PSCX=$O(^PS(52.41,"ACL",PSCX)) Q:'PSCX  F PSLX=0:0 S PSLX=$O(^PS(52.41,"ACL",PSCX,PSLX)) Q:'PSLX  F PSCIN=0:0 S PSCIN=$O(^PS(52.41,"ACL",PSCX,PSLX,PSCIN)) Q:'PSCIN  S PSCPT=+$P($G(^PS(52.41,PSCIN,0)),"^",2) D:PSCPT
"RTN","PSOORNE1",113,0)
 .S PSCNDE=$G(^PS(52.41,PSCIN,0))
"RTN","PSOORNE1",114,0)
 .I $P(PSCNDE,"^",3)'="NW",$P(PSCNDE,"^",3)'="RNW",$P(PSCNDE,"^",3)'="RF" Q
"RTN","PSOORNE1",115,0)
 .I $P(PSCNDE,"^",13)="" Q
"RTN","PSOORNE1",116,0)
 .S PSNCL=+$P(PSCNDE,"^",13),PSNPAT=+$P(PSCNDE,"^",2)
"RTN","PSOORNE1",117,0)
 .I '$D(^TMP($J,"PSOLOC",PSNCL)) S ^TMP($J,"PSOLOC",PSNCL)="1^1",^TMP($J,"PSOLOCP",PSNCL,PSNPAT)="" Q
"RTN","PSOORNE1",118,0)
 .S $P(^TMP($J,"PSOLOC",PSNCL),"^",2)=$P(^TMP($J,"PSOLOC",PSNCL),"^",2)+1
"RTN","PSOORNE1",119,0)
 .I '$D(^TMP($J,"PSOLOCP",PSNCL,PSNPAT)) S $P(^TMP($J,"PSOLOC",PSNCL),"^")=$P(^TMP($J,"PSOLOC",PSNCL),"^")+1
"RTN","PSOORNE1",120,0)
 .S ^TMP($J,"PSOLOCP",PSNCL,PSNPAT)=""
"RTN","PSOORNE1",121,0)
 I '$O(^TMP($J,"PSOLOC",0)) G SUMMQ
"RTN","PSOORNE1",122,0)
 W @IOF W !?20,"Pending Outpatient Medication Orders" I $G(PSZCNT)>1 W !?20,"(signed in under "_$G(PSOINPRT)_")"
"RTN","PSOORNE1",123,0)
 F PSCXL=0:0 S PSCXL=$O(^TMP($J,"PSOLOC",PSCXL)) Q:'PSCXL!($G(PSCLOUT))  D
"RTN","PSOORNE1",124,0)
 .I ($Y+7)>IOSL D CLDIR Q:$G(PSCLOUT)
"RTN","PSOORNE1",125,0)
 .W !!,"Clinic:   ",$P($G(^SC(+PSCXL,0)),"^")
"RTN","PSOORNE1",126,0)
 .W !,"Patients: ",$P($G(^TMP($J,"PSOLOC",PSCXL)),"^"),?16,"Orders: ",$P($G(^TMP($J,"PSOLOC",PSCXL)),"^",2)
"RTN","PSOORNE1",127,0)
 .W !,"In Sort Groups:"
"RTN","PSOORNE1",128,0)
 .S (PCCNT,PSCSFLAG)=0 F PSCSORT=0:0 S PSCSORT=$O(^PS(59.8,PSCSORT)) Q:'PSCSORT!($G(PSCLOUT))  I $D(^PS(59.8,PSCSORT,1,"B",PSCXL)) S PSOCAG=0 D
"RTN","PSOORNE1",129,0)
 ..S PSCSFLAG=1 S:($Y+5)>IOSL&(PCCNT) PSOCAG=1 D:($Y+5)>IOSL&(PCCNT) CLDIR Q:$G(PSCLOUT)  W:$G(PSOCAG) !,"Clinic: "_$P($G(^SC(PSCXL,0)),"^")_"   cont." W:$G(PCCNT)>0 ! W ?16,$P($G(^PS(59.8,PSCSORT,0)),"^") S PCCNT=1
"RTN","PSOORNE1",130,0)
 .I '$G(PSCSFLAG) W ?16,"*** NO CLINIC SORT GROUPS ***"
"RTN","PSOORNE1",131,0)
 I '$G(PSCLOUT) K DIR S DIR(0)="E",DIR("A")="Press <RET> to continue"  D ^DIR K DIR
"RTN","PSOORNE1",132,0)
SUMMQ K ^TMP($J,"PSOLOC"),^TMP($J,"PSOLOCP")
"RTN","PSOORNE1",133,0)
 Q
"RTN","PSOORNE1",134,0)
CLDIR K DIR S DIR(0)="E",DIR("A")="Press <RET> to continue, '^' to exit" D ^DIR K DIR I Y'=1 S PSCLOUT=1 Q
"RTN","PSOORNE1",135,0)
 W @IOF
"RTN","PSOORNE1",136,0)
 Q
"RTN","PSOORNE1",137,0)
RXNCHK I $G(PSONEW("RX #"))']"" D RXNCHK^PSOORNE5
"RTN","PSOORNE1",138,0)
 Q
"RTN","PSOORNE1",139,0)
RDSPL D RDSPL^PSOORNE5
"RTN","PSOORNE1",140,0)
 Q
"RTN","PSOORNE1",141,0)
M3 D M3^PSOOREDX
"RTN","PSOORNE1",142,0)
 Q
"RTN","PSOORNE2")
0^33^B64900877
"RTN","PSOORNE2",1,0)
PSOORNE2 ;BIR/SAB-display finished orders from backdoor ;5/23/05 2:05pm
"RTN","PSOORNE2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,21,23,27,32,37,46,84,103,117,131,146,156,210,148**;DEC 1997
"RTN","PSOORNE2",3,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSOORNE2",4,0)
 ;External reference ^YSCL(603.01 supported by DBIA 2697
"RTN","PSOORNE2",5,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOORNE2",6,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOORNE2",7,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSOORNE2",8,0)
 ;Reference to $$DAWEXT^PSSDAWUT supported by IA 4708
"RTN","PSOORNE2",9,0)
 ;
"RTN","PSOORNE2",10,0)
SEL N ORN,ORD I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOORNE2",11,0)
 D K1^PSOORNE6 S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR I $D(DIRUT) D KV^PSOVER1 S VALMBCK="" Q
"RTN","PSOORNE2",12,0)
NEWSEL N ORN,ORD D K2^PSOORNE6
"RTN","PSOORNE2",13,0)
 I +Y S PSOOELSE=1,PSLST=Y K PSOREEDT D
"RTN","PSOORNE2",14,0)
 .F ORD=1:1:$L(PSLST,",") Q:$P(PSLST,",",ORD)']""  S ORN=+$P(PSLST,",",ORD) D @$S(+PSOLST(ORN)=52:"ACT",1:"PEN^PSOORNE5") K PSOREEDT,PSOSIGFL,PSONACT,SIGOK,PSOFDR,DRET,SIG,INS1 D UL1 I $G(PSOQUIT) K PSOQUIT Q
"RTN","PSOORNE2",15,0)
 K PRC,PHI,RTE I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSOORNE2",16,0)
 K PSONACT,PSOOELSE D ^PSOBUILD,BLD^PSOORUT1,K3^PSOORNE6
"RTN","PSOORNE2",17,0)
 Q
"RTN","PSOORNE2",18,0)
 ;
"RTN","PSOORNE2",19,0)
ACT N REF K ^TMP("PSOAO",$J),PCOMX,PDA,PHI,PRC,ACOM,ANS,PSOFDR,CLOZPAT,ANQREM,DUR,DRET
"RTN","PSOORNE2",20,0)
 S RXN=$P(PSOLST(ORN),"^",2),RX0=^PSRX(RXN,0),RX2=$G(^(2)),RX3=$G(^(3)),ST=+$G(^("STA")),RXOR=$G(^("OR1")),POE=$G(^("POE")),EXDT=$S($P($G(^(2)),"^",6)>DT:1,1:0)
"RTN","PSOORNE2",21,0)
 I 'RX3 S RX3=$P(RX2,"^",2),$P(^PSRX(RXN,3),"^")=$P(RX2,"^",2)
"RTN","PSOORNE2",22,0)
 S PSODRG=+$P(RX0,"^",6),PSODRUG0=^PSDRUG(PSODRG,0),INDT=$G(^("I"))
"RTN","PSOORNE2",23,0)
 I 'RXOR,$P(^PSDRUG(PSODRG,2),"^") S $P(^PSRX(RXN,"OR1"),"^")=$P(^PSDRUG(PSODRG,2),"^"),RXOR=$P(^PSDRUG(PSODRG,2),"^")
"RTN","PSOORNE2",24,0)
 I $P($G(^PSDRUG(PSODRG,"CLOZ1")),"^")="PSOCLO1" D
"RTN","PSOORNE2",25,0)
 .S CLOZPAT=$O(^YSCL(603.01,"C",PSODFN,0)) Q:'CLOZPAT
"RTN","PSOORNE2",26,0)
 .S CLOZPAT=$S($P(^YSCL(603.01,CLOZPAT,0),"^",3)="B":1,1:0)
"RTN","PSOORNE2",27,0)
 I $D(^XUSEC("PSORPH",DUZ)) S RPH=1 D
"RTN","PSOORNE2",28,0)
 .S PSOACT=$S('ST&($G(INDT)]"")&(DT>$G(INDT)):"DHPLATC",ST=1:"DVE",ST=4:"DV",ST=3:"DU",ST=5:"ELTD",ST=11:"TDPCL",ST=12&EXDT:"DCL",ST=12&'EXDT:"CL",ST>12&(ST'=16):"L",ST=16:"DL",1:"DHPEATCL")
"RTN","PSOORNE2",29,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",30,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" K SURX Q
"RTN","PSOORNE2",31,0)
 .S:ST'=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="DL",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",32,0)
 .S:ST=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="L",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",33,0)
 .I ST=14!(ST=15) S VALMSG="Rx Discontinued By "_$S(ST=14:"Provider",1:"Edit")_". Cannot be Reinstated."
"RTN","PSOORNE2",34,0)
 .S:ST=16 VALMSG="Rx Placed on HOLD by Provider."
"RTN","PSOORNE2",35,0)
 E  D
"RTN","PSOORNE2",36,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" Q
"RTN","PSOORNE2",37,0)
 .S PSOACT=$S(ST'<1&(ST'>4)!(ST>12):"",ST=12&EXDT&($P($G(PSOPAR),"^",2)):"CDPLT",1:"CPLT")
"RTN","PSOORNE2",38,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",39,0)
 .S:'$D(^PS(50.7,+$P(RXOR,"^"),0)) PSOACT="L",PSONACT=1,VALMSG="No Pharmacy Orderable Item !"
"RTN","PSOORNE2",40,0)
 ;K PSOLKFL D PSOL^PSSLOCK(RXN) I '$G(PSOMSG) K PSOMSG S PSOLKFL=1 S PSOACT="",VALMSG="This Order is being edited by another user."
"RTN","PSOORNE2",41,0)
 K PSOMSG S IEN=0,$P(RN," ",12)=" "
"RTN","PSOORNE2",42,0)
 I $G(RPH),ST=1,$P($G(^PSRX(RXN,"PKI")),"^") N PKI,PKI1,PKIR,PKIE,DA S DA=RXN D CER^PSOPKIV1 K DA D:$G(PKI1) L1^PSOPKIV1
"RTN","PSOORNE2",43,0)
 D DIN^PSONFI(+RXOR,$P(RX0,"^",6))
"RTN","PSOORNE2",44,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=$S($P($G(^PSRX(RXN,"TPB")),"^"):"            TPB Rx #: ",1:"                Rx #: ")
"RTN","PSOORNE2",45,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_$P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN)_$E(RN,$L($P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN))+1,12)
"RTN","PSOORNE2",46,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):1,1:"#")_")"_" *Orderable Item: "_$S($D(^PS(50.7,$P(+RXOR,"^"),0)):$P(^PS(50.7,$P(+RXOR,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"")_NFIO
"RTN","PSOORNE2",47,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",48,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):2,1:"#")_")"_$S($D(^PSDRUG("AQ",$P(RX0,"^",6))):"       CMOP ",1:"            ")_"Drug: "_$P(^PSDRUG($P(RX0,"^",6),0),"^")_NFID
"RTN","PSOORNE2",49,0)
 S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",50,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="",$$RXRLDT^PSOBPSUT(RXN,0) D
"RTN","PSOORNE2",51,0)
 . S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" "_$S('$P(PSOPAR,"^",3):"(2)",1:"   ")_"             NDC: "_$$GETNDC^PSONDCUT(RXN,0)
"RTN","PSOORNE2",52,0)
 S:$G(^PSRX(RXN,"TN"))]"" IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="          Trade Name: "_$G(^PSRX(RXN,"TN"))
"RTN","PSOORNE2",53,0)
 D DOSE^PSOORNE5
"RTN","PSOORNE2",54,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (4)Pat Instructions:" D INS^PSOORNE5
"RTN","PSOORNE2",55,0)
 D PC^PSOORNE5
"RTN","PSOORNE2",56,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="                 SIG:"
"RTN","PSOORNE2",57,0)
 I '$P($G(^PSRX(RXN,"SIG")),"^",2) S SIGOK=0 D  G PTST
"RTN","PSOORNE2",58,0)
 .S X=$P($G(^PSRX(RXN,"SIG")),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOORNE2",59,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOAO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAO",$J,IEN,0)," ",21)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOAO",$J,IEN,0)=$G(^TMP("PSOAO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNE2",60,0)
 S SIGOK=1
"RTN","PSOORNE2",61,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  D                  ;PSO*210
"RTN","PSOORNE2",62,0)
 . S MIG=$P(^PSRX(RXN,"SIG1",I,0),"^")
"RTN","PSOORNE2",63,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAO",$J)),21)
"RTN","PSOORNE2",64,0)
 S SIGOK=1 K MIG,SG
"RTN","PSOORNE2",65,0)
PTST S $P(RN," ",25)=" ",PTST=$S($G(^PS(53,+$P(RX0,"^",3),0))]"":$P($G(^PS(53,+$P(RX0,"^",3),0)),"^"),1:""),IEN=IEN+1
"RTN","PSOORNE2",66,0)
 S ^TMP("PSOAO",$J,IEN,0)=" (5)  Patient Status: "_PTST_$E(RN,$L(PTST)+1,25)
"RTN","PSOORNE2",67,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (6)      Issue Date: "_$E($P(RX0,"^",13),4,5)_"/"_$E($P(RX0,"^",13),6,7)_"/"_$E($P(RX0,"^",13),2,3)
"RTN","PSOORNE2",68,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (7)  Fill Date: "_$E($P(RX2,"^",2),4,5)_"/"_$E($P(RX2,"^",2),6,7)_"/"_$E($P(RX2,"^",2),2,3)
"RTN","PSOORNE2",69,0)
 S ROU=$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSOORNE2",70,0)
 S REFL=$P(RX0,"^",9),I=0 F  S I=$O(^PSRX(RXN,1,I)) Q:'I  S REFL=REFL-1,ROU=$S($P(^PSRX(RXN,1,I,0),"^",2)="W":"Window",1:"Mail")
"RTN","PSOORNE2",71,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="      Last Fill Date: "_$E($P(RX3,"^"),4,5)_"/"_$E($P(RX3,"^"),6,7)_"/"_$E($P(RX3,"^"),2,3)
"RTN","PSOORNE2",72,0)
 D CMOP^PSOORNE3
"RTN","PSOORNE2",73,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_" ("_ROU_$S($G(PSOCMOP)]"":", "_PSOCMOP,1:"")_")" K ROU,PSOCMOP
"RTN","PSOORNE2",74,0)
 S IEN=IEN+1 I $P(RX2,"^",15) S ^TMP("PSOAO",$J,IEN,0)="   Returned to Stock: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3)_$S($P(RX2,"^",14):" (Reprinted)",1:"")
"RTN","PSOORNE2",75,0)
 E  S ^TMP("PSOAO",$J,IEN,0)="   Last Release Date: " D
"RTN","PSOORNE2",76,0)
 .S RLD=$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:"")
"RTN","PSOORNE2",77,0)
 .I $O(^PSRX(RXN,1,0)) F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  D
"RTN","PSOORNE2",78,0)
 ..I $P(^PSRX(RXN,1,I,0),"^",18) S RLD=$E($P(^(0),"^",18),4,5)_"/"_$E($P(^(0),"^",18),6,7)_"/"_$E($P(^(0),"^",18),2,3)
"RTN","PSOORNE2",79,0)
 .S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_$S($G(RLD)]"":RLD,1:"        ")
"RTN","PSOORNE2",80,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (8)      Lot #: "_$P($G(RX2),"^",4)
"RTN","PSOORNE2",81,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="             Expires: "_$E($P(RX2,"^",6),4,5)_"/"_$E($P(RX2,"^",6),6,7)_"/"_$E($P(RX2,"^",6),2,3)
"RTN","PSOORNE2",82,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                          MFG: "_$P($G(RX2),"^",8)
"RTN","PSOORNE2",83,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(9)      Days Supply: "_$P(RX0,"^",8)_$S($L($P(RX0,"^",8))=1:" ",1:"")
"RTN","PSOORNE2",84,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                    (10)  QTY"_$S($P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)]"":" ("_$P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)_")",1:" (  )")_": "_$P(RX0,"^",7)
"RTN","PSOORNE2",85,0)
 I $P($G(^PSDRUG($P(RX0,"^",6),5)),"^")]"" D
"RTN","PSOORNE2",86,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNE2",87,0)
 .S ^TMP("PSOAO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^") K RN
"RTN","PSOORNE2",88,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(11)    # of Refills: "_$P(RX0,"^",9)_$S($L($P(RX0,"^",9))=1:" ",1:"")_"                          Remaining: "_REFL
"RTN","PSOORNE2",89,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(12)        Provider: "_$S($D(^VA(200,$P(RX0,"^",4),0)):$P(^VA(200,$P(RX0,"^",4),0),"^"),1:"UNKNOWN")
"RTN","PSOORNE2",90,0)
 I $P(RX3,"^",3) S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,$S($G(PSORX("COSIGNING PROVIDER")):PSORX("COSIGNING PROVIDER"),1:$P(RX3,"^",3)),0),"^")
"RTN","PSOORNE2",91,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(13)         Routing: "_$S($P(RX0,"^",11)="M":"MAIL",1:"WINDOW")_"                  (14)     Copies: "_$S($P(RX0,"^",18):$P(RX0,"^",18),1:1)
"RTN","PSOORNE2",92,0)
 S:$P(RX0,"^",11)="W"&($P(PSOPAR,"^",12)) IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="    Method of Pickup: "_$G(^PSRX(RXN,"MP"))
"RTN","PSOORNE2",93,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(15)          Clinic: "_$S($D(^SC(+$P(RX0,"^",5),0)):$P(^SC($P(RX0,"^",5),0),"^"),1:"Not on File")
"RTN","PSOORNE2",94,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(16)        Division: "_$S($G(^PS(59,+$P(RX2,"^",9),0))]"":$P(^PS(59,$P(RX2,"^",9),0),"^")_" ("_$P(^(0),"^",6)_")",1:"UNKNOWN")
"RTN","PSOORNE2",95,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(17)      Pharmacist: "_$S($P(RX2,"^",3):$P(^VA(200,$P(RX2,"^",3),0),"^"),1:"")
"RTN","PSOORNE2",96,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(18)         Remarks:" D RMK^PSOORNE3
"RTN","PSOORNE2",97,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(19)      Counseling: "_$S($P($G(^PSRX(RXN,"PC")),"^"):"YES",1:"NO")_"                      "_$S($P($G(^PSRX(RXN,"PC")),"^"):"Was Counseling Understood: "_$S($P($G(^PSRX(RXN,"PC")),"^",2):"YES",1:"NO"),1:"")
"RTN","PSOORNE2",98,0)
 S:$O(^PSRX(RXN,1,0)) REF=1,IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(20)     Refill Data"
"RTN","PSOORNE2",99,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="" D
"RTN","PSOORNE2",100,0)
 . N DAW S IEN=IEN+1,DAW=$$GETDAW^PSODAWUT(RXN,0)
"RTN","PSOORNE2",101,0)
 . S ^TMP("PSOAO",$J,IEN,0)="(21)        DAW Code: "_DAW_" - "_$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSOORNE2",102,0)
 D DISP^PSOORNE6
"RTN","PSOORNE2",103,0)
 I $G(PSOBEDT),PSOACT["E" S PSOACT="E"
"RTN","PSOORNE2",104,0)
 I $G(PSOBEDT),PSOACT'["E" S PSOACT=""
"RTN","PSOORNE2",105,0)
 Q:$G(PSORXED)!($G(COPY))!($G(UPMI))  S:$G(PSOBEDT) (PSOEDIT,PSORXED)=1 D ^PSOLMLST ; I '$G(PSOLKFL) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOORNE2",106,0)
 K DRET,SIG
"RTN","PSOORNE2",107,0)
 Q
"RTN","PSOORNE2",108,0)
UL1 ;
"RTN","PSOORNE2",109,0)
 ;I +PSOLST(ORN)=52 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOORNE2",110,0)
 ;I $D(^PS(52.41,$P(PSOLST(ORN),"^",2),0)) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)_"S")
"RTN","PSOORNE2",111,0)
 Q
"RTN","PSOORNW1")
0^41^B42345668
"RTN","PSOORNW1",1,0)
PSOORNW1 ;ISC BHAM/SAB - continuation of finish of new order ;07/19/96 12:58 PM
"RTN","PSOORNW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**23,46,78,117,131,133,172,148**;DEC 1997
"RTN","PSOORNW1",3,0)
 ;Reference ^YSCL(603.01 supported by DBIA 2697
"RTN","PSOORNW1",4,0)
 ;Reference ^PS(55 supported by DBIA 2228
"RTN","PSOORNW1",5,0)
 ;Reference ^PSDRUG( supported by DBIA 221
"RTN","PSOORNW1",6,0)
 ;Reference to $$GETNDC^PSSNDCUT supported by IA 4707
"RTN","PSOORNW1",7,0)
 ;
"RTN","PSOORNW1",8,0)
2 I $G(ORD) W !!,"Instructions: " D
"RTN","PSOORNW1",9,0)
 .S INST=0 F  S INST=$O(^PS(52.41,ORD,2,INST)) Q:'INST  S (MIG,INST(INST))=^PS(52.41,ORD,2,INST,0) D
"RTN","PSOORNW1",10,0)
 ..F SG=1:1:$L(MIG," ") W:$X+$L($P(MIG," ",SG)_" ")>IOM !?14 W $P(MIG," ",SG)_" "
"RTN","PSOORNW1",11,0)
 .S:'$D(PSODRUG("OI")) PSODRUG("OI")=$P(OR0,"^",8)
"RTN","PSOORNW1",12,0)
 .K INST,TY,MIG,SG
"RTN","PSOORNW1",13,0)
 S (PSDC,PSI)=0 W !!,"The following Drug(s) are available for selection:"
"RTN","PSOORNW1",14,0)
 F PSI=0:0 S PSI=$O(^PSDRUG("ASP",PSODRUG("OI"),PSI)) Q:'PSI  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($P($G(^PSDRUG(PSI,2)),"^",3)'["O":0,1:1) D
"RTN","PSOORNW1",15,0)
 .S PSDC=PSDC+1 W !,PSDC_". "_$P(^PSDRUG(PSI,0),"^")_$S($P(^(0),"^",9):"     (N/F)",1:"")
"RTN","PSOORNW1",16,0)
 .S PSDC(PSDC)=PSI
"RTN","PSOORNW1",17,0)
 I PSDC=0 D
"RTN","PSOORNW1",18,0)
 . N X,DRG
"RTN","PSOORNW1",19,0)
 . S DRG=+$P($G(^PS(52.41,+$G(ORD),0)),"^",9)
"RTN","PSOORNW1",20,0)
 . S X=$$GET1^DIQ(50,DRG,100)
"RTN","PSOORNW1",21,0)
 . I X'="",(DT>X) D
"RTN","PSOORNW1",22,0)
 . . W !!,"   This Dispense Drug is now Inactive. You may select a"
"RTN","PSOORNW1",23,0)
 . . W !,"    new Orderable Item, or you can enter a new Order with"
"RTN","PSOORNW1",24,0)
 . . W !,"    an Active Drug.",!
"RTN","PSOORNW1",25,0)
 . E  W !!,"No drugs available!",!
"RTN","PSOORNW1",26,0)
 . K DIR S DIR(0)="E",DIR("A")="Press return to continue"
"RTN","PSOORNW1",27,0)
 . D ^DIR K DIR
"RTN","PSOORNW1",28,0)
 G:'PSDC ETX I $G(PSOBDRG),'$D(PSOBDR) M PSOBDR=PSODRUG
"RTN","PSOORNW1",29,0)
 I PSDC'=1 D
"RTN","PSOORNW1",30,0)
 .I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),2)),"^")=$G(PSODRUG("OI")) Q
"RTN","PSOORNW1",31,0)
 .K PSODRUG("NAME"),PSODRUG("IEN")
"RTN","PSOORNW1",32,0)
 W ! D KV S DIR(0)="N^1:"_PSDC,DIR("A")="Select Drug by number" D ^DIR
"RTN","PSOORNW1",33,0)
 I $D(DIRUT) S OUT=1 G EX
"RTN","PSOORNW1",34,0)
 D KV K PSOY S PSOY=PSDC(Y),PSOY(0)=^PSDRUG(PSOY,0),PSOCSIG=0
"RTN","PSOORNW1",35,0)
 I $G(PSODRUG("IEN")),PSODRUG("IEN")'=+PSOY D:$G(ORD)  G:$D(DIRUT) EX
"RTN","PSOORNW1",36,0)
 .D KV S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="You have changed the dispense drug from",DIR("A",2)=PSODRUG("NAME")_" to "_$P(^PSDRUG(+PSOY,0),"^")_".",DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORNW1",37,0)
 .D ^DIR I $D(DIRUT) S OUT=1 Q
"RTN","PSOORNW1",38,0)
 .S:Y PSOCSIG=1
"RTN","PSOORNW1",39,0)
 .I 'Y D URX I $D(DIRUT) S OUT=1 Q
"RTN","PSOORNW1",40,0)
 D KV
"RTN","PSOORNW1",41,0)
CT1 I $P($G(^PSDRUG(PSOY,"CLOZ1")),"^")="PSOCLO1",'$O(^YSCL(603.01,"C",PSODFN,0)) S VALMSG="Patient Not Registered in Clozapine Program",VALMBCK="Q" K PSOY,PSDC Q
"RTN","PSOORNW1",42,0)
 S PSODRUG("IEN")=+PSOY,PSODRUG("VA CLASS")=$P(PSOY(0),"^",2),PSODRUG("NAME")=$P(PSOY(0),"^")
"RTN","PSOORNW1",43,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(+PSOY,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORNW1",44,0)
 S PSODRUG("MAXDOSE")=$P(PSOY(0),"^",4),PSODRUG("DEA")=$P(PSOY(0),"^",3),PSODRUG("CLN")=$S($D(^PSDRUG(+PSOY,"ND")):+$P(^("ND"),"^",6),1:0)
"RTN","PSOORNW1",45,0)
 S PSODRUG("SIG")=$P(PSOY(0),"^",5),PSODRUG("NDC")=$$GETNDC^PSSNDCUT(+PSOY,$G(PSOSITE)),PSODRUG("STKLVL")=$G(^PSDRUG(+PSOY,660.1))
"RTN","PSOORNW1",46,0)
 S PSODRUG("DAW")=+$$GET1^DIQ(50,+PSOY,81)
"RTN","PSOORNW1",47,0)
 I $G(^PSDRUG(+PSOY,660))']"" D:'$G(PSOFIN)&('$G(PSOCOPY)) POST^PSODRG G ETX
"RTN","PSOORNW1",48,0)
 S PSOX1=$G(^PSDRUG(+PSOY,660)),PSODRUG("COST")=$P($G(PSOX1),"^",6),PSODRUG("UNIT")=$P($G(PSOX1),"^",8),PSODRUG("EXPIRATION DATE")=$P($G(PSOX1),"^",9)
"RTN","PSOORNW1",49,0)
 D:'$G(PSOFIN)&('$G(PSOCOPY)) POST^PSODRG
"RTN","PSOORNW1",50,0)
 I $G(PSORX("DFLG")) K PSODRUG N LST Q:$G(PSOAC)!($G(NEWEDT))  D DSPL^PSOORFI1 S VALMBCK="Q" Q
"RTN","PSOORNW1",51,0)
ETX D REF S VALMBCK="R" I 'PSDC S VALMSG="NO dispense drugs tied to this orderable item!" S PSOQFLG=1
"RTN","PSOORNW1",52,0)
TX D KV K PSDC,PSI,X,Y,PSOX1,PSOY
"RTN","PSOORNW1",53,0)
 Q
"RTN","PSOORNW1",54,0)
EX M PSODRUG=PSOBDR K PSOBDR,PSOBDRG S PSOQFLG=1,VALMBCK="R" D MP1^PSOOREDX
"RTN","PSOORNW1",55,0)
 D TX Q
"RTN","PSOORNW1",56,0)
URX D KV S DIR(0)="Y",DIR("A")="Are You Sure You Want to Update Rx",DIR("B")="Yes"
"RTN","PSOORNW1",57,0)
 D ^DIR S:$D(DIRUT)!('Y) DIRUT=1
"RTN","PSOORNW1",58,0)
 Q
"RTN","PSOORNW1",59,0)
REF Q:'$D(PSODRUG("DEA"))!('$G(PSODRUG("IEN")))!('$G(^PS(55,PSODFN,"PS")))
"RTN","PSOORNW1",60,0)
 S PSONEW("CS")=0,PTRF=$S(+$G(^PS(55,PSODFN,"PS"))&($P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",4)]""):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",4),1:5)
"RTN","PSOORNW1",61,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSONEW("CS"),"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSONEW("CS"),"^",2)=1
"RTN","PSOORNW1",62,0)
 I $P($G(PSONEW("CS")),"^",2)=1 S PSONEW("# OF REFILLS")=0 Q
"RTN","PSOORNW1",63,0)
 I +PSONEW("CS") D
"RTN","PSOORNW1",64,0)
 .S PSOX=$S($P($G(OR0),"^",11)>5:5,1:+$P($G(OR0),"^",11))
"RTN","PSOORNW1",65,0)
 .S PSOX=$S(PSOX>PTRF:PTRF,1:PSOX)
"RTN","PSOORNW1",66,0)
 .S PSONEW("# OF REFILLS")=PSOX
"RTN","PSOORNW1",67,0)
 E  D
"RTN","PSOORNW1",68,0)
 .S PSOX=$S($P($G(OR0),"^",11)'>PTRF&($P($G(OR0),"^",11)'>11):11,1:PTRF)
"RTN","PSOORNW1",69,0)
 I '$D(CLOZPAT) I PSODRUG("DEA")["A"&(PSODRUG("DEA")'["B")!(PSODRUG("DEA")["F") S PSOX=0,PSONEW("# OF REFILLS")=0 K PSDY,PSDY1,PTRF Q
"RTN","PSOORNW1",70,0)
 I $D(CLOZPAT) S (PSOX,PSONEW("N# REF"),PSONEW("# OF REFILLS"))=$S(CLOZPAT=1&($G(PSONEW("# OF REFILLS"))>1):1,1:0),PSONEW("DAYS SUPPLY")=7,ORCHK=1 K PSDY,PSDY1,PTRF Q
"RTN","PSOORNW1",71,0)
 S PSONEW("# OF REFILLS")=$S($G(PSONEW("# OF REFILLS"))'="":$G(PSONEW("# OF REFILLS")),1:PSOX) K PSDY,PSDY1,PTRF
"RTN","PSOORNW1",72,0)
 Q
"RTN","PSOORNW1",73,0)
EDNEW K PSMAX,PSFMAX F DEA=1:1 Q:$E(PSODEA,DEA)=""  I $E(+PSODEA,DEA)>1,$E(+PSODEA,DEA)<6 S CS=1
"RTN","PSOORNW1",74,0)
 I CS D
"RTN","PSOORNW1",75,0)
 .S PSOX1=$S(PTRF>5:5,1:PTRF),PSOX=$S(PSOX1=5:5,1:PSOX1)
"RTN","PSOORNW1",76,0)
 .S PSOX=$S('PSOX:0,PSDAYS=90:1,1:PSOX),PSDY1=$S(PSDAYS<60:5,PSDAYS'<60&(PSDAYS'>89):2,PSDAYS=90:1,1:0) S MAX=$S(PSOX'>PSDY1:PSOX,1:PSDY1)
"RTN","PSOORNW1",77,0)
 E  D
"RTN","PSOORNW1",78,0)
 .S PSOX1=PTRF,PSOX=$S(PSOX1=11:11,1:PSOX1),PSOX=$S('PSOX:0,PSDAYS=90:3,1:PSOX)
"RTN","PSOORNW1",79,0)
 .S PSDY1=$S(PSDAYS<60:11,PSDAYS'<60&(PSDAYS'>89):5,PSDAYS=90:3,1:0) S MAX=$S(PSOX'>PSDY1:PSOX,1:PSDY1)
"RTN","PSOORNW1",80,0)
 I PSRF>MAX D
"RTN","PSOORNW1",81,0)
 .W $C(7),!!,PSRF_" refills are not correct for a "_PSDAYS_" day supply.",!,"Please enter correct # of refills for a "_PSDAYS_" day supply. Max refills allowed is "_MAX_".",!
"RTN","PSOORNW1",82,0)
 .S (PSMAX("MAX"),PSFMAX("MAX"))=MAX,(PSMAX("RF"),PSFMAX("RF"))=PSRF,(PSMAX("DAYS"),PSFMAX("DAYS"))=PSDAYS,(PSMAX,PSFMAX)=1
"RTN","PSOORNW1",83,0)
 K PSTMAX D EDSTAT
"RTN","PSOORNW1",84,0)
 Q
"RTN","PSOORNW1",85,0)
STATDAY K PSMAX,PSRMAX,PSFMAX,PSTMAX S PSDAYS=$P(^PSRX(DA,0),"^",8),PSRF=$P(^PSRX(DA,0),"^",9),PTST=$P(^PS(53,X,0),"^"),PTDY=$P(^(0),"^",3),PTRF=$P(^(0),"^",4)
"RTN","PSOORNW1",86,0)
EDSTAT I PSRF>PTRF W !,$C(7),PSRF_" refills are greater than "_PTRF_" allowed for "_$P(PTST,"^")_" Rx Patient Status.",! S PSTMAX=1,PSTMAX("PTRF")=PTRF,PSTMAX("PSRF")=PSRF,PSTMAX("PT")=$P(PTST,"^")
"RTN","PSOORNW1",87,0)
 Q
"RTN","PSOORNW1",88,0)
OERF S DIR(0)="N^0:"_PSOX,DIR("A")="# OF REFILLS"
"RTN","PSOORNW1",89,0)
 S DIR("B")=$S($G(POERR):PSONEW("# OF REFILLS"),$G(PSONEW("N# REF"))]"":PSONEW("N# REF"),$G(PSONEW("# OF REFILLS"))]"":PSONEW("# OF REFILLS"),$G(PSOX1)]""&(PSOX>PSOX1):PSOX1,1:PSOX)
"RTN","PSOORNW1",90,0)
 S DIR("?")="Enter a whole number.  The maximum is set by the Rx Patient Status because there is no Dispense Drug."
"RTN","PSOORNW1",91,0)
 D ^DIR G:$D(DIRUT) REFX
"RTN","PSOORNW1",92,0)
 S (PSONEW("N# REF"),PSONEW("# OF REFILLS"))=Y
"RTN","PSOORNW1",93,0)
REFX S:'$D(PSONEW("# OF REFILLS")) PSONEW("# OF REFILLS")=$S($G(PSONEW("N# REF"))]"":PSONEW("N# REF"),$G(PSOX1)]""&($G(PSOX)>PSOX1):PSOX1,1:PSOX)
"RTN","PSOORNW1",94,0)
 K X,Y,PSOX,PSOX1,PSDY,PSDY1,DEA
"RTN","PSOORNW1",95,0)
KV K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSOORNW1",96,0)
 Q
"RTN","PSOORNW2")
0^42^B43033604
"RTN","PSOORNW2",1,0)
PSOORNW2 ;ISC-BHAM/SAB - edit orders from oerr ;5/24/95 @ 09:08:55
"RTN","PSOORNW2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,23,37,46,117,131,133,148**;DEC 1997
"RTN","PSOORNW2",3,0)
 ;Reference to ^YSCL(603.01 supported by DBIA 2697
"RTN","PSOORNW2",4,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSOORNW2",5,0)
 ;Reference to ^PSDRUG( supported by DBIA 221
"RTN","PSOORNW2",6,0)
 ;Reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOORNW2",7,0)
 ;Reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORNW2",8,0)
 ;Reference to $$GETNDC^PSSNDCUT supported by IA 4707
"RTN","PSOORNW2",9,0)
 ;
"RTN","PSOORNW2",10,0)
1 I $G(PSODRUG("OI")) M:$G(PSOBDRG) PSOBDR=PSODRUG W !!,"Current Orderable Item: "_$P(^PS(50.7,PSODRUG("OI"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSOORNW2",11,0)
 S DIC("B")=$S($G(PSODRUG("OIN"))]"":PSODRUG("OIN"),1:""),DIC="^PS(50.7,",DIC(0)="AEMQZ"
"RTN","PSOORNW2",12,0)
 S DIC("S")="I '$P(^PS(50.7,+Y,0),""^"",4)!($P(^(0),""^"",4)'<DT) N PSOF,PSOL S (PSOF,PSOL)=0 F  S PSOL=$O(^PSDRUG(""ASP"",+Y,PSOL)) Q:PSOF!'PSOL  "
"RTN","PSOORNW2",13,0)
 S DIC("S")=DIC("S")_"I $P($G(^PSDRUG(PSOL,2)),U,3)[""O"",'$G(^(""I""))!($G(^(""I""))'<DT) S PSOF=1" D ^DIC K DIC I X["^"!($D(DTOUT)) S OUT=1 Q
"RTN","PSOORNW2",14,0)
 S PSOY=Y
"RTN","PSOORNW2",15,0)
 I +Y'=OI D  I 'Y!($D(DIRUT)) D KV,MP1^PSOOREDX K DIC,Y,PSOY S OUT=1 Q
"RTN","PSOORNW2",16,0)
 .D KV S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="",DIR("A")="This edit will create a new order.  Do you want to continue" D ^DIR
"RTN","PSOORNW2",17,0)
 G:Y<1 1 S PSODRUG("OI")=+PSOY,PSODRUG("OIN")=$P(PSOY,"^",2),PSONEW("CLERK CODE")=DUZ D KV K DIC,PSOY
"RTN","PSOORNW2",18,0)
 N PSOIC S PSOIC=1 D DREN
"RTN","PSOORNW2",19,0)
 D 2^PSOORNEW Q
"RTN","PSOORNW2",20,0)
4 S PSONEW("FLD")=1 D ISSDT^PSODIR2(.PSONEW) ; Issue Date
"RTN","PSOORNW2",21,0)
 I PSOID>PSONEW("FILL DATE") S PSONEW("FILL DATE")=PSOID,PSORX("FILL DATE")=PSORX("ISSUE DATE")
"RTN","PSOORNW2",22,0)
 Q
"RTN","PSOORNW2",23,0)
 ;
"RTN","PSOORNW2",24,0)
5 S PSONEW("FLD")=2 D FILLDT^PSODIR2(.PSONEW) ; Fill date
"RTN","PSOORNW2",25,0)
 Q
"RTN","PSOORNW2",26,0)
 ;
"RTN","PSOORNW2",27,0)
INS S PSONEW("FLD")=114 D INS^PSODIR(.PSONEW) ; Pat Inst
"RTN","PSOORNW2",28,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") D SINS^PSODIR(.PSONEW)
"RTN","PSOORNW2",29,0)
 Q
"RTN","PSOORNW2",30,0)
 ;
"RTN","PSOORNW2",31,0)
3 S PSONEW("FLD")=3 D PTSTAT^PSODIR1(.PSONEW) ; Get Patient Status
"RTN","PSOORNW2",32,0)
 I +$G(^PS(55,PSODFN,"PS")) S RXPT=+^("PS") I $G(^PS(53,RXPT,0))]"" D  Q
"RTN","PSOORNW2",33,0)
 .S PSONEW("# OF REFILLS")=$S(+$P(OR0,"^",11)>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:+$P(OR0,"^",11)),PSOMAX=+$P(^PS(53,RXPT,0),"^",4)
"RTN","PSOORNW2",34,0)
 .S PSOMAX=$S($G(PSOCS):5,1:11),PSOMAX=$S(PSOMAX>+$P(^PS(53,RXPT,0),"^",4):+$P(^PS(53,RXPT,0),"^",4),1:PSOMAX)
"RTN","PSOORNW2",35,0)
 .S PSONEW("# OF REFILLS")=$S(PSONEW("# OF REFILLS")>PSOMAX:PSOMAX,1:PSONEW("# OF REFILLS"))
"RTN","PSOORNW2",36,0)
 I $G(PSOMAX) S PSONEW("# OF REFILLS")=$S(+$P(OR0,"^",11)>PSOMAX:PSOMAX,1:+$P(OR0,"^",11))
"RTN","PSOORNW2",37,0)
 I $G(PSODRUG("DEA"))["A"&($G(PSODRUG("DEA"))'["B")!($G(PSODRUG("DEA"))["F") D
"RTN","PSOORNW2",38,0)
 .S PSONEW("# OF REFILLS")=0,VALMSG="No refills allowed on "_$S(PSODRUG("DEA")["F":"this drug.",1:"Narcotics ...")
"RTN","PSOORNW2",39,0)
 Q
"RTN","PSOORNW2",40,0)
 ;
"RTN","PSOORNW2",41,0)
12 S PSONEW("FLD")=4 D PROV^PSODIR(.PSONEW) ; Get Provider
"RTN","PSOORNW2",42,0)
 Q
"RTN","PSOORNW2",43,0)
 ;
"RTN","PSOORNW2",44,0)
11 S PSONEW("FLD")=5 D CLINIC^PSODIR2(.PSONEW) ; Get Clinic
"RTN","PSOORNW2",45,0)
 Q
"RTN","PSOORNW2",46,0)
 ;
"RTN","PSOORNW2",47,0)
8 S PSONEW("FLD")=7 D QTY^PSODIR1(.PSONEW) ; Get quantity
"RTN","PSOORNW2",48,0)
 Q
"RTN","PSOORNW2",49,0)
 ;
"RTN","PSOORNW2",50,0)
7 I '$G(PSODRUG("IEN")) W $C(7),!!,"No Dispense Drug!",! K DIR,DUOUT,DIRUT,DTOUT D 2^PSOORNW1
"RTN","PSOORNW2",51,0)
 I '$G(PSODRUG("IEN")) W !,$C(7),"No Dispense Drug Selected! A new Orderable Item may need to be selected.",! Q
"RTN","PSOORNW2",52,0)
 S PSONEW("FLD")=8 D DAYS^PSODIR1(.PSONEW) ; Get days supply
"RTN","PSOORNW2",53,0)
 Q:'$G(PSONEW("PATIENT STATUS"))
"RTN","PSOORNW2",54,0)
 K PSDY,PSDY1,PSMAX,PSTMAX S PSDAYS=PSONEW("DAYS SUPPLY"),PSRF=PSONEW("# OF REFILLS"),PTST=$P(^PS(53,PSONEW("PATIENT STATUS"),0),"^"),PTDY=$P(^(0),"^",3),PTRF=$P(^(0),"^",4),PSODEA=PSODRUG("DEA"),CS=0 ;D EDNEW^PSOORNW1
"RTN","PSOORNW2",55,0)
 Q
"RTN","PSOORNW2",56,0)
9 ;
"RTN","PSOORNW2",57,0)
 I '$G(PSONEW("PATIENT STATUS")) W !!,"Rx Patient Status required!",! D 3 I '$G(PSONEW("PATIENT STATUS")) S VALMSG="Rx Patient Status required!",VALMBCK="R" Q
"RTN","PSOORNW2",58,0)
 I +$G(^PS(55,PSODFN,"PS")) S RXPT=+^("PS") I $G(^PS(53,RXPT,0))]"" D  G ASK
"RTN","PSOORNW2",59,0)
 .S PSOMAX=$S($G(CLOZPAT)=1:1,$G(CLOZPAT)=0:0,1:+$P(^PS(53,RXPT,0),"^",4)) K RXPT
"RTN","PSOORNW2",60,0)
 .S:'$G(PSONEW("# OF REFILLS")) PSONEW("# OF REFILLS")=$S(+$P(OR0,"^",11)>PSOMAX:PSOMAX,1:+$P(OR0,"^",11))
"RTN","PSOORNW2",61,0)
 .S (PSONEW("N# REF"),PSONEW("# OF REFILLS"))=$S(PSONEW("# OF REFILLS")>PSOMAX:PSOMAX,1:PSONEW("# OF REFILLS"))
"RTN","PSOORNW2",62,0)
 .I '$D(CLOZPAT) I $G(PSODRUG("DEA"))["A"&($G(PSODRUG("DEA"))'["B")!($G(PSODRUG("DEA"))["F") D  Q
"RTN","PSOORNW2",63,0)
 ..S (PSOMAX,PSONEW("N# REF"),PSONEW("# OF REFILLS"))=0,VALMSG="No refills allowed on "_$S(PSODRUG("DEA")["F":"this drug.",1:"Narcotics ...")
"RTN","PSOORNW2",64,0)
 .I $D(PSODRUG("DEA")) F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S PSOMAX=5
"RTN","PSOORNW2",65,0)
 I '$D(CLOZPAT) I $G(PSODRUG("DEA"))["A"&($G(PSODRUG("DEA"))'["B")!($G(PSODRUG("DEA"))["F") D  Q
"RTN","PSOORNW2",66,0)
 .S (PSONEW("N# REF"),PSONEW("# OF REFILLS"))=0,VALMSG="No refills allowed on "_$S(PSODRUG("DEA")["F":"this drug.",1:"Narcotics ...")
"RTN","PSOORNW2",67,0)
 S (PSONEW("N# REF"),PSOMAX,PSONEW("# OF REFILLS"))=+$P(OR0,"^",11)
"RTN","PSOORNW2",68,0)
ASK S PSONEW("FLD")=9 D REFILL^PSODIR1(.PSONEW) ; Get # of refills
"RTN","PSOORNW2",69,0)
 K PSOMAX,PSMAX,PSTMAX S PSDAYS=PSONEW("DAYS SUPPLY"),PSRF=PSONEW("# OF REFILLS"),PTST=$P(^PS(53,PSONEW("PATIENT STATUS"),0),"^"),PTDY=$P(^(0),"^",3),PTRF=$P(^(0),"^",4),PSODEA=$G(PSODRUG("DEA")),CS=0 D EDNEW^PSOORNW1
"RTN","PSOORNW2",70,0)
 Q
"RTN","PSOORNW2",71,0)
 ;
"RTN","PSOORNW2",72,0)
6 Q  K DA S PSONEW("FLD")=10 D SIG^PSODIR1(.PSONEW) ; Get sig
"RTN","PSOORNW2",73,0)
 I $G(PSONEW("SIG"))]"" D EN^PSOSIGNO(ORD,PSONEW("SIG")) S SIG(1)=PSONEW("SIG")
"RTN","PSOORNW2",74,0)
 I $G(PSOSIGFL) D
"RTN","PSOORNW2",75,0)
 .K DIRUT,DUOUT,DTOUT,DIR S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="",DIR("A")="This edit will create a new order.  Do you want to continue" D ^DIR
"RTN","PSOORNW2",76,0)
 .I 'Y!($D(DIRUT)) K DIR,DIRUT,DUOUT,DTOUT,DIC,Y,PSOSIGFL,PSONEW("SIG") S SIGOK=1
"RTN","PSOORNW2",77,0)
 S PSONEW("CLERK CODE")=DUZ K DIR,DIRUT,DUOUT,DTOUT,DIC,Y
"RTN","PSOORNW2",78,0)
 Q
"RTN","PSOORNW2",79,0)
 ;
"RTN","PSOORNW2",80,0)
13 S PSONEW("FLD")=11 D COPIES^PSODIR1(.PSONEW) ; Get # of copies
"RTN","PSOORNW2",81,0)
 Q
"RTN","PSOORNW2",82,0)
 ;
"RTN","PSOORNW2",83,0)
10 S PSONEW("FLD")=12 D MW^PSODIR2(.PSONEW) ; Get Mail/Window Info
"RTN","PSOORNW2",84,0)
 Q
"RTN","PSOORNW2",85,0)
 ;
"RTN","PSOORNW2",86,0)
14 S PSONEW("FLD")=13 D RMK^PSODIR2(.PSONEW) ; Get Remarks
"RTN","PSOORNW2",87,0)
 Q
"RTN","PSOORNW2",88,0)
DREN ;
"RTN","PSOORNW2",89,0)
 S (PSDC,PSI)=0
"RTN","PSOORNW2",90,0)
 F  S PSI=$O(^PSDRUG("ASP",PSODRUG("OI"),PSI)) Q:'PSI  I $S('$D(^PSDRUG(PSI,"I")):1,'^("I"):1,DT'>^("I"):1,1:0),$S($P($G(^PSDRUG(PSI,2)),"^",3)'["O":0,1:1) S PSDC=PSDC+1,PSDC(PSDC)=PSI
"RTN","PSOORNW2",91,0)
 I PSDC'=1 D  G DRENX
"RTN","PSOORNW2",92,0)
 .I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),2)),"^")=$G(PSODRUG("OI")) Q
"RTN","PSOORNW2",93,0)
 .K PSODRUG("NAME"),PSODRUG("IEN")
"RTN","PSOORNW2",94,0)
 K PSOY S PSI=PSDC(1),PSOY=^PSDRUG(PSI,0)
"RTN","PSOORNW2",95,0)
 I $P($G(^PSDRUG(PSI,"CLOZ1")),"^")="PSOCLO1",'$O(^YSCL(603.01,"C",PSODFN,0)) K PSOY,PSI Q
"RTN","PSOORNW2",96,0)
 S PSODRUG("IEN")=+PSI,PSODRUG("VA CLASS")=$P(PSOY,"^",2),PSODRUG("NAME")=$P(PSOY,"^")
"RTN","PSOORNW2",97,0)
 S PSODRUG("NDF")=$S($G(^PSDRUG(PSI,"ND"))]"":+^("ND")_"A"_$P(^("ND"),"^",3),1:0)
"RTN","PSOORNW2",98,0)
 S PSODRUG("MAXDOSE")=$P(PSOY,"^",4),PSODRUG("DEA")=$P(PSOY,"^",3),PSODRUG("CLN")=$S($D(^PSDRUG(+PSI,"ND")):+$P(^("ND"),"^",6),1:0)
"RTN","PSOORNW2",99,0)
 S PSODRUG("SIG")=$P(PSOY,"^",5),PSODRUG("NDC")=$$GETNDC^PSSNDCUT(+PSI,$G(PSOSITE)),PSODRUG("STKLVL")=$G(^PSDRUG(+PSI,660.1))
"RTN","PSOORNW2",100,0)
 S PSODRUG("DAW")=+$$GET1^DIQ(50,+PSI,81)
"RTN","PSOORNW2",101,0)
 G:$G(^PSDRUG(+PSI,660))']"" DRENX
"RTN","PSOORNW2",102,0)
 S PSOX1=$G(^PSDRUG(+PSI,660)),PSODRUG("COST")=$P($G(PSOX1),"^",6),PSODRUG("UNIT")=$P($G(PSOX1),"^",8),PSODRUG("EXPIRATION DATE")=$P($G(PSOX1),"^",9)
"RTN","PSOORNW2",103,0)
DRENX K PSDC,PSI,PSOY,Y,PSOXI,X Q
"RTN","PSOORNW2",104,0)
KV K DIR,DIRUT,DUOUT,DTOUT Q
"RTN","PSOORUT1")
0^13^B65051729
"RTN","PSOORUT1",1,0)
PSOORUT1 ;BIR/SAB - Utility routine for oerr interface ;02/22/95
"RTN","PSOORUT1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,14,30,46,132,148**;DEC 1997
"RTN","PSOORUT1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORUT1",4,0)
 ;External reference to ^PSXOPUTL supported by DBIA 2203
"RTN","PSOORUT1",5,0)
 ;called from HD^PSOORUTL
"RTN","PSOORUT1",6,0)
REL ;removed order from hold
"RTN","PSOORUT1",7,0)
 S ACT=1,ORS=0
"RTN","PSOORUT1",8,0)
 I POERR("PSOFILNM")["S" S DA=+POERR("PSOFILNM") D  G EXIT^PSOORUTL
"RTN","PSOORUT1",9,0)
 .Q:'$D(^PS(52.41,DA,0))  Q:$P(^PS(52.41,DA,0),"^",3)="RF"
"RTN","PSOORUT1",10,0)
 .S $P(^PS(52.41,DA,0),"^",3)="NW",POERR("STAT")="OR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUT1",11,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order RELEASED from HOLD by OE/RR before finished." S $P(^PS(52.41,DA,4),"^")=POERR("COMM"),ORS=1
"RTN","PSOORUT1",12,0)
 S DA=POERR("PSOFILNM") I $D(^PSRX(DA,0)) S ORS=1,PSDA=DA D  G EXIT^PSOORUTL
"RTN","PSOORUT1",13,0)
 .S POERR("FILLER")=DA_"^R",POERR("STAT")="OR"
"RTN","PSOORUT1",14,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription Released from HOLD by OE/RR"
"RTN","PSOORUT1",15,0)
 .I DT>$P(^PSRX(DA,2),"^",6) D
"RTN","PSOORUT1",16,0)
 ..S EXP=$P(^PSRX(DA,2),"^",6) S:$P(^PSRX(DA,"STA"),"^")<12 $P(^PSRX(DA,"STA"),"^")=11,PSOEXFLG=1 S POERR("STAT")="UR",POERR("COMM")="Medication Expired on "_$E(EXP,4,5)_"/"_$E(EXP,6,7)_"/"_$E(EXP,2,3)_".",POERR("PHARMST")="" D ECAN^PSOUTL(DA) Q
"RTN","PSOORUT1",17,0)
 .I $P(^PSRX(DA,"STA"),"^")'=16 S POERR("STAT")="UR",POERR("COMM")="Unable to Release from Hold" Q
"RTN","PSOORUT1",18,0)
 .S RXFL(DA)=0,FDT=$P(^PSRX(DA,2),"^",2)
"RTN","PSOORUT1",19,0)
 .I $O(^PSRX(DA,1,0)) F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S FDT=$P(^PSRX(DA,1,I,0),"^"),RXFL(DA)=I
"RTN","PSOORUT1",20,0)
 .I FDT>DT N PSOSITEZ,ZPSOPAR6 S PSOSITEZ=$S($P($G(^PSRX(DA,2)),"^",9):$P(^(2),"^",9),1:$O(^PS(59,0))),ZPSOPAR6=$P($G(^PS(59,PSOSITEZ,1)),"^",6) I ZPSOPAR6 D  Q
"RTN","PSOORUT1",21,0)
 ..S RXXDA=DA,DA=$O(^PS(52.5,"B",RXXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORUT1",22,0)
 ..S DA=RXXDA
"RTN","PSOORUT1",23,0)
 ..S DIC="^PS(52.5,",DIC(0)="L",DLAYGO=52.5,X=RXXDA,DIC("DR")=".02///"_FDT_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///0;.06////"_PSOSITEZ_";2///0;9///"_RXFL(DA) K DD,DO D FILE^DICN K RXFL,DD,DO
"RTN","PSOORUT1",24,0)
 ..S DA=RXXDA K RXXDA S $P(^PSRX(DA,"STA"),"^")=5,LFD=$E(FDT,4,5)_"-"_$E(FDT,6,7)_"-"_$E(FDT,2,3) D ACT1
"RTN","PSOORUT1",25,0)
 ..S PSOSUSZ=1
"RTN","PSOORUT1",26,0)
 .E  S $P(^PSRX(DA,"STA"),"^")=0
"RTN","PSOORUT1",27,0)
 .S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",28,0)
 .D ACT^PSOORUTL
"RTN","PSOORUT1",29,0)
 .I $$SUBMIT^PSOBPSUT(DA) D ECMESND^PSOBPSU1(DA,,$$RXFLDT^PSOBPSUT(DA),$S('$O(^PSRX(DA,1,0)):"OF",1:"RF"))
"RTN","PSOORUT1",30,0)
 G EXIT^PSOORUTL
"RTN","PSOORUT1",31,0)
ACT1 I '$D(RXF) S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",32,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOORUT1",33,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOORUT1",34,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_POERR("USER")_"^"_RXF_"^"_"RX Placed on Suspense until "_LFD
"RTN","PSOORUT1",35,0)
 Q
"RTN","PSOORUT1",36,0)
SUS ;
"RTN","PSOORUT1",37,0)
 I $P($G(^PSRX(+$G(FILLER),"STA")),"^")=5 N PSOMSORR,PLACERXX D EN^PSOHLSN1(+$G(FILLER),"SC","ZS","")
"RTN","PSOORUT1",38,0)
 Q
"RTN","PSOORUT1",39,0)
BLD ;builds med profile for Listman
"RTN","PSOORUT1",40,0)
 K ^TMP("PSOPF",$J),PSOLST S:$G(PSOOPT)'=3 PSOOPT=0 I '$G(PSOSD) S ^TMP("PSOPF",$J,1,0)="This patient has no prescriptions" S PSOCNT=0,PSOPF=1 Q
"RTN","PSOORUT1",41,0)
 D EOJ,SHOW
"RTN","PSOORUT1",42,0)
EOJ ;
"RTN","PSOORUT1",43,0)
 K PSOQFLG,PSODRG,PSODATA,PSOLF
"RTN","PSOORUT1",44,0)
 Q
"RTN","PSOORUT1",45,0)
 ;-----------------------------------------------------------------
"RTN","PSOORUT1",46,0)
SHOW ;
"RTN","PSOORUT1",47,0)
 ; - ePharmacy modification to create a section for Rx with REJECTs
"RTN","PSOORUT1",48,0)
 N PSOTMP,PSOSTS,PSODRNM,I,PSORX
"RTN","PSOORUT1",49,0)
 S (PSOSTS,PSODRNM)=""
"RTN","PSOORUT1",50,0)
 F  S PSOSTS=$O(PSOSD(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",51,0)
 . F  S PSODRNM=$O(PSOSD(PSOSTS,PSODRNM)) Q:PSODRNM=""  D
"RTN","PSOORUT1",52,0)
 . . S PSORX=+$G(PSOSD(PSOSTS,PSODRNM))
"RTN","PSOORUT1",53,0)
 . . I PSOSTS="ACTIVE",$$FIND^PSOREJUT(PSORX) D  Q
"RTN","PSOORUT1",54,0)
 . . . S PSOTMP(" REJECT",PSODRNM)=PSOSTS
"RTN","PSOORUT1",55,0)
 . . S PSOTMP(PSOSTS,PSODRNM)=PSOSTS
"RTN","PSOORUT1",56,0)
 ;
"RTN","PSOORUT1",57,0)
 S (PSOSTS,PSODRG)="",(PSOCNT,PSOQFLG,IEN)=0
"RTN","PSOORUT1",58,0)
 K RN,DL S $P(RN," ",12)=" ",$P(DL," ",40)=" "
"RTN","PSOORUT1",59,0)
 F PSCNT=0:0 S PSOSTS=$O(PSOTMP(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",60,0)
 . D STA
"RTN","PSOORUT1",61,0)
 . F PSOCT=0:0 S PSODRG=$O(PSOTMP(PSOSTS,PSODRG)) Q:PSODRG=""  Q:PSOCNT>1000!PSOQFLG  D
"RTN","PSOORUT1",62,0)
 . . S PSOSTA=PSOTMP(PSOSTS,PSODRG)
"RTN","PSOORUT1",63,0)
 . . S PSODATA=PSOSD(PSOSTA,PSODRG) I PSOSTA="ZNONVA" D NVA Q
"RTN","PSOORUT1",64,0)
 . . S PSOCNT=PSOCNT+1 I PSOSTA="PENDING" D PEN Q
"RTN","PSOORUT1",65,0)
 . . S:'$D(^PSRX(+PSODATA,0)) PSOCNT=PSOCNT-1 D:$D(^(0)) DISPL
"RTN","PSOORUT1",66,0)
 S (VALMCNT,PSOPF)=IEN
"RTN","PSOORUT1",67,0)
SHOWX K DIRUT,DTOUT,DUOUT,DIROUT,PSODRG
"RTN","PSOORUT1",68,0)
 Q
"RTN","PSOORUT1",69,0)
 ;
"RTN","PSOORUT1",70,0)
DISPL S IEN=IEN+1 N PSOID,PSOCMOP,STATLTH,ECME
"RTN","PSOORUT1",71,0)
 K PSOLNT,PSOQTL,PSOLSP S PSOLRX=$S($G(^PSRX(+PSODATA,"IB")):13,1:14)-$L($P(^PSRX(+PSODATA,0),"^")),$P(PSOLNT," ",PSOLRX)=" ",PSODQL=$L($P(PSODRG,"^"))+$L($P(^PSRX(+PSODATA,0),"^",7))
"RTN","PSOORUT1",72,0)
 I PSODQL<39 S $P(PSOQTL," ",(40-PSODQL))=" "
"RTN","PSOORUT1",73,0)
 E  S $P(PSOQTL," ",(52-$L($P(^PSRX(+PSODATA,0),"^",7))))=" ",$P(PSOLSP," ",(41-$L($P(PSODRG,"^"))))=" "
"RTN","PSOORUT1",74,0)
 S ECME=$$ECME^PSOBPSUT(+PSODATA) I ECME'="" S PSOLNT=$E(PSOLNT,1,$L(PSOLNT)-1)
"RTN","PSOORUT1",75,0)
 S ^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(^PSRX(+PSODATA,0),"^")_$S($G(^PSRX(+PSODATA,"IB")):"$",1:"")_ECME_PSOLNT_$P(PSODRG,"^")_$S(PSODQL<39:PSOQTL_$P(^PSRX(+PSODATA,0),"^",7)_" ",1:$G(PSOLSP))
"RTN","PSOORUT1",76,0)
 S STA="A^N^R^H^N^S^^^^^^E^DC^^DC^DE^H^P^"
"RTN","PSOORUT1",77,0)
 S PSOCMOP=""
"RTN","PSOORUT1",78,0)
 I $D(^PSDRUG("AQ",$P(^PSRX(+PSODATA,0),"^",6))) S PSOCMOP=">"
"RTN","PSOORUT1",79,0)
 N X S X="PSXOPUTL" X ^%ZOSF("TEST") K X I $T D
"RTN","PSOORUT1",80,0)
 .N DA S DA=+PSODATA D ^PSXOPUTL K DA
"RTN","PSOORUT1",81,0)
 .I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S PSOCMOP="T"
"RTN","PSOORUT1",82,0)
 .K PSXZ
"RTN","PSOORUT1",83,0)
 S STATLTH=$P(STA,"^",$P(PSODATA,"^",2)+1)
"RTN","PSOORUT1",84,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(STA,"^",$P(PSODATA,"^",2)+1)_$G(PSOCMOP)_$S($L(STATLTH)+$L(PSOCMOP)=0:"   ",$L(STATLTH)+$L(PSOCMOP)=1:"  ",$L(STATLTH)+$L(PSOCMOP)=2:" ",1:"")
"RTN","PSOORUT1",85,0)
 S PSOID=$P(^PSRX(+PSODATA,0),"^",13),PSOLF=+$G(^(3)),^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$E(PSOID,4,5)_"-"_$E(PSOID,6,7)_" "
"RTN","PSOORUT1",86,0)
 F PSOX=0:0 S PSOX=$O(^PSRX(+PSODATA,1,PSOX)) Q:'PSOX  D
"RTN","PSOORUT1",87,0)
 . I +$G(^PSRX(+PSODATA,1,PSOX,0))=PSOLF,$P($G(^PSRX(+PSODATA,1,PSOX,0)),"^",16) S PSOLF=PSOLF_"^R"
"RTN","PSOORUT1",88,0)
 K PSOX
"RTN","PSOORUT1",89,0)
 I '$O(^PSRX(+PSODATA,1,0)),$P(^PSRX(+PSODATA,2),"^",15) S PSOLF=PSOLF_"^R"
"RTN","PSOORUT1",90,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$S($G(PSOLF):$E(PSOLF,4,5),1:"  ")_"-"_$S($G(PSOLF):$E(PSOLF,6,7),1:"  ")_$S($P(PSOLF,"^",2)="R":"R ",1:"  ")
"RTN","PSOORUT1",91,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$J($P(PSODATA,"^",6),2)_" "_$J($P(PSODATA,"^",8),3)
"RTN","PSOORUT1",92,0)
 I PSODQL>38 S IEN=IEN+1 S ^TMP("PSOPF",$J,IEN,0)=PSOQTL_"Qty: "_$P(^PSRX(+PSODATA,0),"^",7)
"RTN","PSOORUT1",93,0)
 K PSOLNT,PSOQTL,PSOLSP,PSOLRX,PSODQL
"RTN","PSOORUT1",94,0)
 S PSOLST(PSOCNT)="52^"_+PSODATA_"^"_PSOSTA
"RTN","PSOORUT1",95,0)
 K PSODATA,PSOLF S PSOPF=IEN
"RTN","PSOORUT1",96,0)
 Q
"RTN","PSOORUT1",97,0)
 ;
"RTN","PSOORUT1",98,0)
STA N LABEL,LINE,POS
"RTN","PSOORUT1",99,0)
 S LABEL=PSOSTS,IEN=IEN+1
"RTN","PSOORUT1",100,0)
 I PSOSTS="ZNONVA" S LABEL="Non-VA MEDS (Not dispensed by VA)"
"RTN","PSOORUT1",101,0)
 I PSOSTS=" REJECT" S LABEL="REFILL TOO SOON/DUR REJECTS (Third Party)"
"RTN","PSOORUT1",102,0)
 S POS=80-$L(LABEL)/2,$P(LINE,"-",81)="",$E(LINE,POS+1,POS+$L(LABEL))=LABEL
"RTN","PSOORUT1",103,0)
 S ^TMP("PSOPF",$J,IEN,0)=LINE
"RTN","PSOORUT1",104,0)
 Q
"RTN","PSOORUT1",105,0)
PENX S PSOLST(PSOCNT)="52.41^"_$P(PSODATA,"^",10)_"^"_PSOSTA
"RTN","PSOORUT1",106,0)
 K PSODATA,PSOLF,RN,PSOLSP,PSOQTL,PSOLNT
"RTN","PSOORUT1",107,0)
 Q
"RTN","PSOORUT1",108,0)
PEN ;
"RTN","PSOORUT1",109,0)
 N PSOQTL,PSOLNT,PSOLNTZ,PSOQTLX,PSCMOPF,SPACEZ
"RTN","PSOORUT1",110,0)
 Q:'$D(^PS(52.41,$P(PSODATA,"^",10),0))
"RTN","PSOORUT1",111,0)
 S PSCMOPF=0 I $P($G(PSODATA),"^",11),$D(^PSDRUG("AQ",$P(PSODATA,"^",11))) S PSCMOPF=1
"RTN","PSOORUT1",112,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(PSODRG,"^")
"RTN","PSOORUT1",113,0)
 S PSOLNT=$L($P(PSODRG,"^")),PSOLNTZ=$L($P(PSODATA,"^",8))
"RTN","PSOORUT1",114,0)
 S $P(PSOQTLX," ",(11-PSOLNTZ))=" "
"RTN","PSOORUT1",115,0)
 S:PSOLNT<37 $P(PSOQTL," ",(37-PSOLNT))=" "
"RTN","PSOORUT1",116,0)
 I PSOLNT<38 D  G PENX
"RTN","PSOORUT1",117,0)
 .I PSOLNT=37 S PSOQTL=""
"RTN","PSOORUT1",118,0)
 .I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") Q
"RTN","PSOORUT1",119,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  "_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")
"RTN","PSOORUT1",120,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")_$P(PSODATA,"^",6)
"RTN","PSOORUT1",121,0)
 S IEN=IEN+1,$P(SPACEZ," ",42)=" "
"RTN","PSOORUT1",122,0)
 I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") G PENX
"RTN","PSOORUT1",123,0)
 S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")
"RTN","PSOORUT1",124,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)
"RTN","PSOORUT1",125,0)
 G PENX
"RTN","PSOORUT1",126,0)
 ;
"RTN","PSOORUT1",127,0)
NVA ; Setting the Non-VA Meds on the Medication Profile Screen (ListMan)
"RTN","PSOORUT1",128,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="  "_$P(PSODRG,"^")_" "
"RTN","PSOORUT1",129,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",6))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",130,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)_" "
"RTN","PSOORUT1",131,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",8))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",132,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",8)
"RTN","PSOORUT1",133,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+20)>70 D  Q
"RTN","PSOORUT1",134,0)
 . S IEN=IEN+1,$P(^TMP("PSOPF",$J,IEN,0)," ",51)="Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",135,0)
 F I=0:0 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_" " Q:$L(^TMP("PSOPF",$J,IEN,0))>49
"RTN","PSOORUT1",136,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",137,0)
 Q
"RTN","PSOORUTL")
0^87^B42520369
"RTN","PSOORUTL",1,0)
PSOORUTL ;ISC BHAM/SAB  - updates order status from oerr ;02/22/95
"RTN","PSOORUTL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**14,46,146,132,118,199,223,148**;DEC 1997
"RTN","PSOORUTL",3,0)
 ;External reference to EN^ORERR - 2187
"RTN","PSOORUTL",4,0)
 ;External reference to ^PS(55 - 2228
"RTN","PSOORUTL",5,0)
 ;Input variables, poerr("psofilnm")=pharmacy pointer # from OE/RR, poerr("stat")=Order Control status
"RTN","PSOORUTL",6,0)
 ;poerr("pharmst")=will contain 'ZE'if rx has expired, poerr("comm")=Comments, poerr("user")=Person placing request
"RTN","PSOORUTL",7,0)
EN(POERR) ;
"RTN","PSOORUTL",8,0)
 N PSZORS,III
"RTN","PSOORUTL",9,0)
 F OO=0:0 S OO=$O(MSG(OO)) Q:'OO  I $P(MSG(OO),"|")="ZRN" S NVA=1
"RTN","PSOORUTL",10,0)
 I $G(NVA) G NVA
"RTN","PSOORUTL",11,0)
 G:POERR("PSOFILNM")'["S" RXO S III=+POERR("PSOFILNM")
"RTN","PSOORUTL",12,0)
 S ORS=0 I $D(^PS(52.41,III,0)) D  G PEXIT
"RTN","PSOORUTL",13,0)
 .Q:$P($G(^PS(52.41,III,0)),"^",3)="RF"
"RTN","PSOORUTL",14,0)
 .I $G(PDFN),$P($G(^PS(52.41,III,0)),"^",2),PDFN'=$P(^PS(52.41,III,0),"^",2) S ORS=1
"RTN","PSOORUTL",15,0)
RXO S III=POERR("PSOFILNM") I $D(^PSRX(III,0)) D  G PEXIT
"RTN","PSOORUTL",16,0)
 .I $G(PDFN),$P($G(^PSRX(III,0)),"^",2),PDFN'=$P(^PSRX(III,0),"^",2) S ORS=1
"RTN","PSOORUTL",17,0)
 S (ORS,PSZORS)=1
"RTN","PSOORUTL",18,0)
PEXIT I $G(ORS) S POERR("STAT")=$S(POERR("STAT")="CA":"UC",POERR("STAT")="DC":"UD",POERR("STAT")="HD":"UH",1:"UR"),POERR("FILLER")="",POERR("COMM")=$S($G(PSZORS):"Unable to locate order.",1:"Patient does not match.") K ORS,PSZORS,III Q
"RTN","PSOORUTL",19,0)
 S POERR("PHARMST")="" G:POERR("STAT")="HD"!(POERR("STAT")="RL") HD
"RTN","PSOORUTL",20,0)
 S ORS=0 I POERR("PSOFILNM")["S" S DA=+POERR("PSOFILNM") I $D(^PS(52.41,DA,0)) D  G EXIT
"RTN","PSOORUTL",21,0)
 .Q:$P($G(^PS(52.41,DA,0)),"^",3)="RF"
"RTN","PSOORUTL",22,0)
 .S $P(^PS(52.41,DA,0),"^",3)="DC",POERR("PLACE")=$P(^(0),"^"),POERR("STAT")="CR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUTL",23,0)
 .K ^PS(52.41,"AOR",+$P($G(^PS(52.41,DA,0)),"^",2),+$P($G(^PS(52.41,DA,"INI")),"^"),DA)
"RTN","PSOORUTL",24,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order Canceled by OE/RR before finishing." S ORS=1,$P(^PS(52.41,DA,4),"^")=$G(POERR("COMM"))
"RTN","PSOORUTL",25,0)
 S DA=POERR("PSOFILNM") D:$D(^PSRX(DA,0)) REVERSE^PSOBPSU1(DA,,"DC",7)
"RTN","PSOORUTL",26,0)
 I $D(^PSRX(DA,0)) D  S $P(^PSRX(DA,"STA"),"^")=14,$P(^PSRX(DA,3),"^",5)=$S($P($G(^PSRX(DA,3)),"^"):$P(^(3),"^"),1:DT) D CAN^PSOTPCAN(DA) G EXIT
"RTN","PSOORUTL",27,0)
 .;cancel/discontinue action
"RTN","PSOORUTL",28,0)
 .S POERR("PLACE")=+$P($G(^PSRX(DA,"OR1")),"^",2),POERR("STAT")=$S(POERR("STAT")="CA":"CR",1:"DR"),POERR("FILLER")=DA_"^R"
"RTN","PSOORUTL",29,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription DISCONTINUED by OERR"
"RTN","PSOORUTL",30,0)
 .S ORS=1 D CAN
"RTN","PSOORUTL",31,0)
EXIT I '$G(ORS) D
"RTN","PSOORUTL",32,0)
 .S POERR("STAT")=$S(POERR("STAT")="CA":"UC",POERR("STAT")="DC":"UD",POERR("STAT")="HD":"UH",1:"UR"),POERR("FILLER")="",POERR("COMM")="Order was not located by Pharmacy"
"RTN","PSOORUTL",33,0)
 K EXP,ORS,DA,ACOM,RXDA,SUSD,PSUS,RXF,I,FDA,DIC,DIE,DR,Y,X,%,%I,%H,RSDT,ACNT,ACT,DIK,FDT,IR,LFD,NOW,ORD,PSDA,PSCDA,PSODFN,PSUS,RF,RFCNT,RXN,RXP,RXREF,SD,SUB
"RTN","PSOORUTL",34,0)
 Q
"RTN","PSOORUTL",35,0)
CAN S ACOM="Discontinued by OE/RR." I $P(^PSRX(DA,"STA"),"^")=3!($P(^("STA"),"^")=16) D
"RTN","PSOORUTL",36,0)
 .S ACOM="Discontinued by OE/RR while on hold. " K:$P(^PSRX(DA,"H"),"^") ^PSRX("AH",$P(^PSRX(DA,"H"),"^"),DA) S ^PSRX(DA,"H")=""
"RTN","PSOORUTL",37,0)
 .I $P(^PSRX(DA,0),"^",13),'$O(^PSRX(DA,1,0)) S DIE=52,DR="22///"_$E($P(^PSRX(DA,0),"^",13),1,7) D ^DIE K DIE,DR Q
"RTN","PSOORUTL",38,0)
 .S (IFN,SUSD)=0 F  S IFN=$O(^PSRX(DA,1,IFN)) Q:'IFN  S SUSD=IFN,RFDT=$P(^PSRX(DA,1,IFN,0),"^")
"RTN","PSOORUTL",39,0)
 .Q:'$G(SUSD)  I '$P(^PSRX(DA,1,SUSD,0),"^",18) S PSDTEST=0 D  I 'PSDTEST K ^PSRX(DA,1,SUSD),^PSRX("AD",RFDT,DA,SUSD),^PSRX(DA,1,"B",RFDT,SUSD),IFN,SUSD,RFDT
"RTN","PSOORUTL",40,0)
 ..F PDA=0:0 S PDA=$O(^PSRX(DA,"L",PDA)) Q:'PDA  I $P($G(^PSRX(DA,"L",PDA,0)),"^",2)=SUSD S PSDTEST=1
"RTN","PSOORUTL",41,0)
 ..K CMOP D ^PSOCMOPA I $G(CMOP(CMOP("L")))="",$G(CMOP("S"))'="L" Q
"RTN","PSOORUTL",42,0)
 ..S PSDTEST=1
"RTN","PSOORUTL",43,0)
 S RXDA=DA,(DA,SUSDA)=$O(^PS(52.5,"B",DA,0)) D:DA
"RTN","PSOORUTL",44,0)
 .S SUSD=$P($G(^PS(52.5,DA,0)),"^",2)
"RTN","PSOORUTL",45,0)
 .S:+$G(^PS(52.5,DA,"P"))'=1 ACOM="Discontinued by OE/RR while suspended."
"RTN","PSOORUTL",46,0)
 .I $O(^PSRX(RXDA,1,0)) S DA=RXDA D:'$G(^PS(52.5,+SUSDA,"P")) REF^PSOCAN2
"RTN","PSOORUTL",47,0)
 .S DA=SUSDA,DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORUTL",48,0)
 K SUSD,SUSDA S DA=RXDA,RXREF=0,PSODFN=+$P(^PSRX(DA,0),"^",2) D
"RTN","PSOORUTL",49,0)
 .S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(DA,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOORUTL",50,0)
 .S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOORUTL",51,0)
 .D NOW^%DTC S ^PSRX(DA,"A",0)="^52.3DA^"_(ACNT+1)_"^"_(ACNT+1),^PSRX(DA,"A",ACNT+1,0)=%_"^C^"_POERR("USER")_"^"_RFCNT_"^"_$G(ACOM)
"RTN","PSOORUTL",52,0)
 .S REA="C" D EXP^PSOHELP1
"RTN","PSOORUTL",53,0)
 I $G(^PS(52.4,DA,0))]"" S PSCDA=DA,DIK="^PS(52.4," D ^DIK S DA=PSCDA K DIK,PSCDA
"RTN","PSOORUTL",54,0)
 Q
"RTN","PSOORUTL",55,0)
HD ;place order on hold
"RTN","PSOORUTL",56,0)
 G:POERR("STAT")="RL" REL^PSOORUT1 S (ACT,ORS)=0 I POERR("PSOFILNM")["S" D  G EXIT
"RTN","PSOORUTL",57,0)
 .S DA=+POERR("PSOFILNM")
"RTN","PSOORUTL",58,0)
 .Q:'$D(^PS(52.41,DA,0))  Q:$P(^PS(52.41,DA,0),"^",3)="RF"
"RTN","PSOORUTL",59,0)
 .S $P(^PS(52.41,DA,0),"^",3)="HD",POERR("STAT")="HR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUTL",60,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order PLACED on HOLD by OERR before finished." S $P(^PS(52.41,DA,4),"^")=POERR("COMM"),ORS=1
"RTN","PSOORUTL",61,0)
 S DA=POERR("PSOFILNM") I $D(^PSRX(DA,0)) S ORS=1,PSDA=DA D  G EXIT
"RTN","PSOORUTL",62,0)
 .S POERR("FILLER")=DA_"^R"
"RTN","PSOORUTL",63,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription Placed on HOLD by OERR"
"RTN","PSOORUTL",64,0)
 .I DT>$P(^PSRX(DA,2),"^",6) S EXP=$P(^(2),"^",6) S:$P(^PSRX(DA,"STA"),"^")<12 $P(^PSRX(DA,"STA"),"^")=11,PSOEXFLG=1 S POERR("STAT")="UH",POERR("COMM")="Prescription EXPIRED on "_$E(EXP,4,5)_"/"_$E(EXP,6,7)_"/"_$E(EXP,2,3)_"." D  Q
"RTN","PSOORUTL",65,0)
 ..D ECAN^PSOUTL(DA)
"RTN","PSOORUTL",66,0)
 .I $P(^PSRX(DA,"STA"),"^")=3!($P(^("STA"),"^")>11) S POERR("STAT")="UH",POERR("COMM")="Unable to place on HOLD" Q
"RTN","PSOORUTL",67,0)
 .S $P(^PSRX(DA,"STA"),"^")=16,POERR("STAT")="HR",^PSRX(DA,"H")=99_"^"_POERR("COMM")_"^"_DT
"RTN","PSOORUTL",68,0)
 .S (PSUS,RXF)=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:RXF>1 RSDT=$P(^(RXF-1,0),"^")
"RTN","PSOORUTL",69,0)
 .S DA=PSDA D ACT D REVERSE^PSOBPSU1(DA,,"HLD",2)
"RTN","PSOORUTL",70,0)
 .S DA=$O(^PS(52.5,"B",PSDA,0)) I DA S DIK="^PS(52.5,",PSUS=1 D ^DIK K DA,DIK
"RTN","PSOORUTL",71,0)
 I 'ORS S POERR("COMM")="Unable to place order on HOLD" G EXIT
"RTN","PSOORUTL",72,0)
 Q
"RTN","PSOORUTL",73,0)
NVA ;non-va med action
"RTN","PSOORUTL",74,0)
 N DIE,DR,DA K NVA
"RTN","PSOORUTL",75,0)
 I POERR("PSOFILNM")'["N"!('$D(^PS(55,PDFN,"NVA",+POERR("PSOFILNM"),0))) D EN^ORERR("Order was not located by Pharmacy",.MSG) Q
"RTN","PSOORUTL",76,0)
 I $G(OR("STAT"))'="CA",$G(OR("STAT"))'="DC" D EN^ORERR("Invalid Order Control Code",.MSG) Q
"RTN","PSOORUTL",77,0)
XO S ORD=+POERR("PSOFILNM")
"RTN","PSOORUTL",78,0)
 N TMP
"RTN","PSOORUTL",79,0)
 D NOW^%DTC
"RTN","PSOORUTL",80,0)
 K TMP S TMP(55.05,ORD_","_PDFN_",",5)=$S($G(PSODEATH):2,1:1)
"RTN","PSOORUTL",81,0)
 S TMP(55.05,ORD_","_PDFN_",",6)=%
"RTN","PSOORUTL",82,0)
 D FILE^DIE("","TMP")
"RTN","PSOORUTL",83,0)
 S PLACER=$P(^PS(55,PDFN,"NVA",ORD,0),"^",8)
"RTN","PSOORUTL",84,0)
 K MSG S NULLFLDS="F JJ=0:1:LIMIT S FIELD(JJ)="""""
"RTN","PSOORUTL",85,0)
 K ^UTILITY("DIQ1",$J),DIQ S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOORUTL",86,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOHINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIQ,DIC
"RTN","PSOORUTL",87,0)
 S MSG(1)="MSH|^~\&|PHARMACY|"_$G(PSOHINST)_"|||||ORR"
"RTN","PSOORUTL",88,0)
 ;
"RTN","PSOORUTL",89,0)
 S DFN=PDFN,COUNT=1,LIMIT=5 X NULLFLDS D DEM^VADPT S NAME=$G(VADM(1)) K VADM
"RTN","PSOORUTL",90,0)
 S FIELD(0)="PID",FIELD(3)=DFN,FIELD(5)=NAME
"RTN","PSOORUTL",91,0)
 D SEG^PSOHLSN1
"RTN","PSOORUTL",92,0)
 ;
"RTN","PSOORUTL",93,0)
 S LIMIT=15 X NULLFLDS
"RTN","PSOORUTL",94,0)
 S FIELD(0)="ORC",FIELD(2)=PLACER_"^OR",FIELD(3)=+POERR("PSOFILNM")_"N^PS"
"RTN","PSOORUTL",95,0)
 S FIELD(1)="SC",FIELD(5)="DC"
"RTN","PSOORUTL",96,0)
 D SEG^PSOHLSN1
"RTN","PSOORUTL",97,0)
 I $G(PSODEATH) S MSG(COUNT)=MSG(COUNT)_"|^^^^DATE OF DEATH ENTERED BY MAS.^"
"RTN","PSOORUTL",98,0)
 ;
"RTN","PSOORUTL",99,0)
 D SEND^PSOHLSN1 K FIELDS,LIMIT,PSODSC,PSONVA,OI
"RTN","PSOORUTL",100,0)
 Q
"RTN","PSOORUTL",101,0)
 ;
"RTN","PSOORUTL",102,0)
ACT ;activity log
"RTN","PSOORUTL",103,0)
 D NOW^%DTC S NOW=%
"RTN","PSOORUTL",104,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOORUTL",105,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOORUTL",106,0)
 S ^PSRX(DA,"A",IR,0)=NOW_"^"_$S(ACT:"U",1:"H")_"^"_POERR("USER")_"^"_RXF_"^"_"RX "_$S('ACT:"placed in a",1:"removed from")_" HOLD status "_$S(+$G(PSUS):"and removed from SUSPENSE ",1:"")_"("_$E(DT,4,5)_"-"_$E(DT,6,7)_"-"_$E(DT,2,3)_") by OERR."
"RTN","PSOORUTL",107,0)
 Q
"RTN","PSOP")
0^14^B46184688
"RTN","PSOP",1,0)
PSOP ;BIR/SAB - Medication profile long or short ;02/25/94
"RTN","PSOP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,15,98,132,148**;DEC 1997
"RTN","PSOP",3,0)
 ;External reference to PS(55 supported by DBIA 2228
"RTN","PSOP",4,0)
 ;External reference to PS(59.7 supported by DBIA 694
"RTN","PSOP",5,0)
 ;External reference to PSDRUG supported by DBIA 221
"RTN","PSOP",6,0)
 W !! K ^TMP($J),ZTSK,CLS S DIC=2,DIC(0)="QEAM" D ^DIC G Q:Y<0  S PSOLOUD=1,DFN=+Y D:$P($G(^PS(55,+Y,0)),"^",6)'=2 EN^PSOHLUP(+Y) K PSOLOUD S Y=DFN
"RTN","PSOP",7,0)
DOIT S (FN,DFN,D0,DA)=+Y I '$D(^PS(55,+Y,"P")),'$D(^("ARC")),'$D(^("NVA")),'$D(^PS(52.41,"AOR",+Y)) W !?20,$C(7),"NO PHARMACY INFORMATION" H 5 D ^PSODEM G PSOP
"RTN","PSOP",8,0)
 I '$O(^PS(55,+Y,"P",0)),$D(^PS(55,+Y,"ARC")) D ^PSODEM W !!,"PATIENT HAS ARCHIVED PRESCRIPTIONS",! G PSOP
"RTN","PSOP",9,0)
 S DIR("?")="Enter 'L' for a long profile or 'S' for a short profile",DIR("A")="LONG or SHORT: ",DIR(0)="SA^L:LONG;S:SHORT",DIR("B")="SHORT" D ^DIR G:$D(DUOUT)!$D(DIRUT) Q S PLS=Y K DIR
"RTN","PSOP",10,0)
S S DIR(0)="SA^D:DATE;M:MEDICATION;C:CLASS",DIR("A")="Sort by DATE, CLASS or MEDICATION: ",DIR("B")=$S($P($G(PSOPAR),"^",14)=2:"MEDICATION",$P($G(PSOPAR),"^",14)=1:"CLASS",1:"DATE")
"RTN","PSOP",11,0)
 S DIR("?",1)="Enter 'DATE', 'CLASS' or 'MEDICATION' to determine the order in which",DIR("?")="prescriptions will appear on the profile." D ^DIR G:$D(DUOUT)!$D(DIRUT) Q S PSRT=$S(Y="D":"DATE",Y="M":"DRUG",1:"CLSS")
"RTN","PSOP",12,0)
 S HDR=$S(Y="D":"ISSUE DATE",Y="M":"DRUG NAME",1:"DRUG CLASS") K DIR
"RTN","PSOP",13,0)
 K DIR G:PSRT="DATE" DEV S DIR("A")="Profile Expiration/Discontinued cutoff",DIR("B")=120,DIR(0)="N^1:9999:0",DIR("?",1)="Enter the number of days which will cut discontinued and expired Rx's from",DIR("?")="the profile."
"RTN","PSOP",14,0)
 D ^DIR G:$D(DTOUT)!($D(DUOUT)) Q K DIR S X1=DT,X2=-X D C^%DTC S PSODTCT=X
"RTN","PSOP",15,0)
DEV D SORT^PSOP1 G:$D(DUOUT)!($D(DTOUT)) Q
"RTN","PSOP",16,0)
 K %ZIS,IOP,ZTSK S PSOION=ION,%ZIS="MQ" D ^%ZIS K %ZIS I POP S IOP=PSOION D ^%ZIS K IOP,PSOION G Q
"RTN","PSOP",17,0)
 K PSOION I $D(IO("Q")) S ZTDESC="Patient Medication Profile",ZTRTN="P^PSOP" D  G PSOP
"RTN","PSOP",18,0)
 .F G="HDR","TO","FR","SDT","PSFR","PSTO","DTS","CLS","EDT","DRS","PSODTCT","FN","DFN","DA","D0","PLS","PSRT","PSOPAR" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOP",19,0)
 .K IO("Q") D ^%ZTLOAD W:$D(ZTSK) !,"Task Queued to Print",! K Q,ZTSK D Q
"RTN","PSOP",20,0)
 D P,Q G PSOP
"RTN","PSOP",21,0)
P U IO S PAGE=1,$P(PSOPLINE,"-",80)="" K ^TMP($J) D LOOP D ^PSODEM W:$O(^PS(55,DA,"ARC",0)) !!,"Patient Has Archived Prescriptions",!
"RTN","PSOP",22,0)
 I $Y+10>IOSL,$E(IOST)="C" D DIR^PSOP1 Q:$D(PQT)  W @IOF
"RTN","PSOP",23,0)
 W:$P($G(^PS(59.7,1,40.1)),"^") !,"Outpatient prescriptions are discontinued 72 hours after admission"
"RTN","PSOP",24,0)
 W !!?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",25,0)
 I PLS="S" D ^PSOP1 G Q
"RTN","PSOP",26,0)
 W ! S DRUG="" F II=0:0 S DRUG=$O(^TMP($J,DRUG)) Q:DRUG=""!($D(PQT))  F J=0:0 S J=$O(^TMP($J,DRUG,J)) Q:'J  D O W:$G(PQT) @IOF Q:$G(PQT)  I $Y+8>IOSL,$E(IOST)="C" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",27,0)
 D PEND^PSOP2,NVA^PSOP2
"RTN","PSOP",28,0)
Q D ^%ZISC K CP,HDR,X1,X2,RX3,^TMP($J),ST0,PSODTCT,ST,D0,DIC,DIR,DIRUT,DUOUT,G,II,K,RXD,RXF,ZX,DRUG,X,DFN,PHYS,PSRT,CT,AL,I1,PLS,REF,LMI,PI,FN,Y,I,J,RX,DRX,ST,RX0,RX2,DA,PSOPLINE,PAGE,PRLBL,PSOPATOK
"RTN","PSOP",29,0)
 K PSOLR,PSDIV,PQT,TO,FR,CLS,DRG,DRS,DTS,DTOUT,PSFR,PSTO,SDT,EDT,PPP,FSIG,IIII,STAT,PP,EEEE,PPPCNT,PENDREX,PSOPEND,PPDIS,PPOI,PCOUNT,PPCOUNT,PPP S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOP",30,0)
 ;
"RTN","PSOP",31,0)
O S RX0=^PSRX(J,0),RX2=$G(^(2)),RX3=$G(^(3)),$P(RX0,"^",15)=$G(^("STA")),DRX="NOT ON FILE",CP=$S(+$G(^PSRX(J,"IB")):"$",1:" ") S:$P(RX0,"^",15)="" $P(RX0,"^",15)=-1
"RTN","PSOP",32,0)
 ;
"RTN","PSOP",33,0)
 I $D(^PSDRUG(+$P(RX0,"^",6),0)) S DRX=$P(^(0),"^")
"RTN","PSOP",34,0)
 I $Y+10>IOSL,IOSL["C-" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",35,0)
 I $Y+10>IOSL,$E(IOST)'="C" S PAGE=PAGE+1 D
"RTN","PSOP",36,0)
 .W @IOF,!,$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP",37,0)
 .W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",38,0)
 .W !,PSOPLINE
"RTN","PSOP",39,0)
 W !!,"Rx #: "_CP_$P(RX0,"^"),$$ECME^PSOBPSUT(J),?32,"Drug: ",$G(DRX)
"RTN","PSOP",40,0)
 S PSOBRSIG=$P($G(^PSRX(J,"SIG")),"^",2) K FSIG,BSIG D
"RTN","PSOP",41,0)
 .I PSOBRSIG D FSIG^PSOUTLA("R",J,70) Q
"RTN","PSOP",42,0)
 .D EN2^PSOUTLA1(J,70) F IIII=0:0 S IIII=$O(BSIG(IIII)) Q:'IIII  S FSIG(IIII)=BSIG(IIII)
"RTN","PSOP",43,0)
 K PSOBRSIG,IIII,BSIG
"RTN","PSOP",44,0)
 W !?2,"SIG: "_$G(FSIG(1)) D:$O(FSIG(1))
"RTN","PSOP",45,0)
 .F IIII=1:0 S IIII=$O(FSIG(IIII)) Q:'IIII!($G(PQT))  W !?7,$G(FSIG(IIII))  D:($Y+5>IOSL)&($E(IOST)["C") DIR^PSOP1 Q:$G(PQT)  D:$Y+5>IOSL
"RTN","PSOP",46,0)
 ..S PAGE=PAGE+1
"RTN","PSOP",47,0)
 ..W @IOF,!,$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP",48,0)
 ..W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",49,0)
 ..W !,PSOPLINE
"RTN","PSOP",50,0)
 Q:$G(PQT)
"RTN","PSOP",51,0)
 W !?2,"QTY: ",$P(RX0,"^",7),?23,"# of Refills: ",$P(RX0,"^",9),?45,"Issue/Expr: " S Y=$P(RX0,"^",13) W $E(Y,4,5),"-",$E(Y,6,7),"-",$E(Y,2,3),"/" S Y=$P(RX2,"^",6) W:Y $E(Y,4,5),"-",$E(Y,6,7),"-",$E(Y,2,3)
"RTN","PSOP",52,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(RX0,"^",4) D ^DIC S PHYS=$S(+Y:$P(Y,"^",2),1:"Unknown") K DIC,X,Y
"RTN","PSOP",53,0)
 W !?2,"Prov: "_PHYS,?30,"Entry By: "_$P(RX0,"^",16),?45,"Filled: " S Y=$P(RX2,"^",2) W:Y $E(Y,4,5),"-",$E(Y,6,7),"-",$E(Y,2,3) W " (",$P(RX0,"^",11),")"
"RTN","PSOP",54,0)
 I $P(RX3,"^",3) D
"RTN","PSOP",55,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(RX3,"^",3) D ^DIC S PHYS=$S(+Y:$P(Y,"^",2),1:"Unknown") K DIC,X,Y W !?2,"Cosigner: "_PHYS K PHYS
"RTN","PSOP",56,0)
 S PSOLR=$S($P(RX2,"^",13):$P(RX2,"^",13),1:"") F PSOX=0:0 S PSOX=$O(^PSRX(J,1,PSOX)) Q:'PSOX  S:$P(^PSRX(J,1,PSOX,0),"^",18) PSOLR=$P(^(0),"^",18)
"RTN","PSOP",57,0)
 W !?2,"Last Released: " W:PSOLR $E(PSOLR,4,5)_"-"_$E(PSOLR,6,7)_"-"_$E(PSOLR,2,3)
"RTN","PSOP",58,0)
 W ?45,$S($P(RX2,"^",15):"Original Fill Returned to Stock",1:"Original Release: "_$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"-"_$E($P(RX2,"^",13),6,7)_"-"_$E($P(RX2,"^",13),2,3),1:""))
"RTN","PSOP",59,0)
 S CT=0,REF=$P(RX0,"^",9) F K=0:0 S K=$O(^PSRX(J,1,K)) Q:'K  S RX1=^PSRX(J,1,K,0) D
"RTN","PSOP",60,0)
 .I $Y+5>IOSL,IOSL["C-" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",61,0)
 .I $Y+5>IOSL,$E(IOST)'="C" S PAGE=PAGE+1 D
"RTN","PSOP",62,0)
 ..W @IOF,!,$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP",63,0)
 ..W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",64,0)
 ..W !,PSOPLINE
"RTN","PSOP",65,0)
 .W !?2,"Refilled: "_$E($P(RX1,"^"),4,5)_"-"_$E($P(RX1,"^"),6,7)_"-"_$E($P(RX1,"^"),2,3)_" ("_$P(RX1,"^",2)_")"_$S($P(RX1,"^",16):"(R)",1:"")
"RTN","PSOP",66,0)
 .W ?30,"Released: "_$S($P(RX1,"^",18):$E($P(RX1,"^",18),4,5)_"-"_$E($P(RX1,"^",18),6,7)_"-"_$E($P(RX1,"^",18),2,3),1:"")
"RTN","PSOP",67,0)
 .S REF=REF-1
"RTN","PSOP",68,0)
 I $Y+2>IOSL,IOSL["C-" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",69,0)
 I $Y+2>IOSL,$E(IOST)'="C" S PAGE=PAGE+1 W @IOF,!,$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP",70,0)
 I $O(^PSRX(J,"P",0)) W !?2,"Partials: " F K=0:0 S K=$O(^PSRX(J,"P",K)) Q:'K  W $E(^(K,0),4,5),"-",$E(^(0),6,7),"-",$E(^(0),2,3)," (",$P(^(0),"^",2),") QTY:",$P(^(0),"^",4)_$S($P(^(0),"^",16):" (R)",1:"")_", "
"RTN","PSOP",71,0)
 W:$P(RX3,"^",7)]"" !?2,"Remarks: ",$P(RX3,"^",7) D STAT^PSOFUNC
"RTN","PSOP",72,0)
 S PSDIV=$S($D(^PS(59,+$P(RX2,"^",9),0)):$P(^(0),"^")_" ("_$P(^(0),"^",6)_")",1:"Unknown")
"RTN","PSOP",73,0)
 W !?2,"Division: "_$E(PSDIV,1,25),?40,ST,?60,REF," Refill"_$S(REF'=1:"s",1:"")," Left"
"RTN","PSOP",74,0)
 Q
"RTN","PSOP",75,0)
LOOP F I=0:0 S I=$O(^PS(55,DFN,"P",I)) Q:'I  S J=+^(I,0) D  I $G(PSOPATOK),$D(^PSRX(J,0)),$P($G(^PSRX(J,"STA")),"^")'=13 S PRLBL=PSRT_"^PSOP2" D @PRLBL
"RTN","PSOP",76,0)
 .S PSOPATOK=1 I $P($G(^PSRX(+$G(J),0)),"^",2),DFN'=$P($G(^(0)),"^",2) K ^PS(55,DFN,"P",I,0) S:$P($G(^PS(55,DFN,"P",0)),"^",4) $P(^PS(55,DFN,"P",0),"^",4)=$P($G(^(0)),"^",4)-1 S PSOPATOK=0
"RTN","PSOP1")
0^40^B25363822
"RTN","PSOP1",1,0)
PSOP1 ;BHAM ISC/SAB - prints short medication profile ;02/25/94
"RTN","PSOP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,46,103,132,148**;DEC 1997
"RTN","PSOP1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOP1",4,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSOP1",5,0)
 K RX,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSOP1",6,0)
 D HD S DRUG="" F I=0:0 S DRUG=$O(^TMP($J,DRUG)) Q:DRUG=""!($G(PQT))  D  G:$D(DTOUT)!($D(DUOUT))!($D(DIROUT)) Q
"RTN","PSOP1",7,0)
 .F J=0:0 S J=$O(^TMP($J,DRUG,J)) Q:'J!($G(PQT))  S RX0=^(J),RX2=$G(^PSRX(J,2)),$P(RX0,"^",15)=$G(^("STA")),CP=$S(+$G(^PSRX(J,"IB")):"$",1:" ") S:$P(RX2,"^",15)&($P(RX2,"^",2)) RST($P(RX2,"^",2))=1 S:$P(RX0,"^",15)="" $P(RX0,"^",15)=-1 D W
"RTN","PSOP1",8,0)
 D:'$G(PQT) PEND^PSOP2,NVA^PSOP2
"RTN","PSOP1",9,0)
Q D ^%ZISC K ^TMP($J),PQT,PSODTCT,ST,D0,DIC,DIR,DIRUT,DUOUT,G,II,K,RXD,RXF,ZX,DRUG,X,DFN,PHYS,PSRT,CT,AL,I1,PLS,REF,LMI,PI,FN,Y,I,J,RX,DRX,ST,RX0,RX2,DA,PPPSTAT,PPP,EEEE,PPPCNT,PENDREX,PSOPEND,PPDIS,PPOI,PCOUNT,PP,FSIG S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOP1",10,0)
 K ZZZZ Q
"RTN","PSOP1",11,0)
W I $Y+6>IOSL,$E(IOST)="C" D DIR W @IOF Q:$D(PQT)  D HD
"RTN","PSOP1",12,0)
 U IO I IO'=IO(0),$Y+6>IOSL W @IOF D HD
"RTN","PSOP1",13,0)
 I $E(IOST)'="C",$Y+6>IOSL W @IOF D HD
"RTN","PSOP1",14,0)
 D STAT^PSOFUNC S STA="A^N^R^H^P^S^^^^^^E^DC^^DC^DE^PH",ST=$P(STA,"^",(ST0+1)) K STA
"RTN","PSOP1",15,0)
 W !,CP_$P(RX0,"^"),$$ECME^PSOBPSUT(J),?13,$S($D(^PSDRUG(+$P(RX0,"^",6),0)):$P(^(0),"^"),1:"NOT ON FILE"),?54,$S($L(ST)=1:" "_ST,1:ST)
"RTN","PSOP1",16,0)
 S RXD=$P($G(^PSRX(J,3)),"^"),RXF=$P(RX0,"^",9) F II=0:0 S II=$O(^PSRX(J,1,II)) Q:'II  S RXF=RXF-1 S:$P(^PSRX(J,1,II,0),"^",16) RST($P(^(0),"^"))=1
"RTN","PSOP1",17,0)
 W ?58,$S($L(RXF)=1:" "_RXF,1:RXF)
"RTN","PSOP1",18,0)
 W ?61,$E($P(RX0,"^",13),4,5)_"-"_$E($P(RX0,"^",13),6,7)_"-"_$E($P(RX0,"^",13),2,3) W:RXD ?70,$E(RXD,4,5)_"-"_$E(RXD,6,7)_"-"_$E(RXD,2,3)_$S($G(RST(RXD)):"R",1:"")
"RTN","PSOP1",19,0)
 S PSOPRSIG=$P($G(^PSRX(J,"SIG")),"^",2) K FSIG,BSIG D
"RTN","PSOP1",20,0)
 .I PSOPRSIG D FSIG^PSOUTLA("R",J,50) Q
"RTN","PSOP1",21,0)
 .D EN2^PSOUTLA1(J,50) F GGGG=0:0 S GGGG=$O(BSIG(GGGG)) Q:'GGGG  S FSIG(GGGG)=BSIG(GGGG)
"RTN","PSOP1",22,0)
 K PSOPRSIG,GGGG,BSIG
"RTN","PSOP1",23,0)
 W !?5,"QTY: ",$P(RX0,"^",7),?24,"SIG: ",$G(FSIG(1)) D:$O(FSIG(1))
"RTN","PSOP1",24,0)
 .F GGGG=1:0 S GGGG=$O(FSIG(GGGG)) Q:'GGGG!($G(PQT))  W !,?29,$G(FSIG(GGGG)) D:$Y+5>IOSL&($E(IOST)="C") DIR Q:$G(PQT)  I '$G(PQT),($Y+5>IOSL) W @IOF D HD
"RTN","PSOP1",25,0)
 K GGGG,FSIG Q:$G(PQT)
"RTN","PSOP1",26,0)
 ;D SIG
"RTN","PSOP1",27,0)
 K RST Q
"RTN","PSOP1",28,0)
HD D:PAGE>1
"RTN","PSOP1",29,0)
 .W !,"Patient: "_$P(^DPT(DFN,0),"^")_" ("_$E($P(^DPT(DFN,0),"^",9),6,9)_")",?70,"Page: "_PAGE
"RTN","PSOP1",30,0)
 .W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP1",31,0)
 W !?57,"REF",!?1,"Rx#",?13,"Drug",?54,"ST",?57,"REM",?62,"Issued",?70,"Last Fill",!,PSOPLINE S PAGE=PAGE+1
"RTN","PSOP1",32,0)
 Q
"RTN","PSOP1",33,0)
SORT K DIR,DUOUT,DTOUT
"RTN","PSOP1",34,0)
 S DIR("B")="All",DIR("A",1)=" ",DIR("A")="All Medications or Selection (A/S): ",DIR(0)="SAM^A:All;S:Select Range",DIR("?",1)="Enter 'A' to Print Entire Medication Profile",DIR("?")="   or 'S' for Selection Range" D ^DIR
"RTN","PSOP1",35,0)
 K DIR Q:$D(DIRUT)!(Y="A")!(Y="E")  D @PSRT
"RTN","PSOP1",36,0)
 Q
"RTN","PSOP1",37,0)
DATE ;asks date range
"RTN","PSOP1",38,0)
 W ! K %DT S %DT="AEX",%DT("A")="Starting Date: " D ^%DT  I "^"[X S DUOUT=1 Q
"RTN","PSOP1",39,0)
 G:Y<0 DATE S SDT=+Y,%DT(0)=SDT,FR=$E(SDT,4,5)_"/"_$E(SDT,6,7)_"/"_$E(SDT,2,3)
"RTN","PSOP1",40,0)
EDT S %DT("A")="Ending Date: " D ^%DT  I "^"[X S DUOUT=1 Q
"RTN","PSOP1",41,0)
 G:Y<0 EDT S EDT=+Y,DTS=1,TO=$E(EDT,4,5)_"/"_$E(EDT,6,7)_"/"_$E(EDT,2,3)
"RTN","PSOP1",42,0)
 K %DT Q
"RTN","PSOP1",43,0)
DRUG ;asks drug list
"RTN","PSOP1",44,0)
 W ! S DIC("A")="Start with Drug: ",DIC(0)="AEMQ",DIC=50
"RTN","PSOP1",45,0)
 S DIC("S")="I $S('$D(^PSDRUG(Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0),$S('$D(^PSDRUG(Y,2)):1,$P(^(2),""^"",3)'[""O"":0,1:1)"
"RTN","PSOP1",46,0)
 D ^DIC I "^"[X S DUOUT=1 K DIC Q
"RTN","PSOP1",47,0)
 G:Y<0 DRUG S FR=$P(Y,"^",2)
"RTN","PSOP1",48,0)
 F %=$L($E(FR,1,30)):-1:1 S M=$A(FR,%) I M>32 S Y1=$E(FR,1,%-1)_$C(M-1)_$C(122) Q
"RTN","PSOP1",49,0)
 S PSFR=Y1 K Y1,Y,X
"RTN","PSOP1",50,0)
TO S DIC("A")="To Drug: " D ^DIC I "^"[X S DUOUT=1 K DIC Q
"RTN","PSOP1",51,0)
 G:Y<0 TO I FR]$P(Y,"^",2) W !,$C(7),"Less Than 'Start' Value" K X,Y G TO
"RTN","PSOP1",52,0)
 S TO=$P(Y,"^",2),DRS=1
"RTN","PSOP1",53,0)
 F %=$L($E(TO,1,30)):-1:1 S M=$A(TO,%) I M>32 S Y1=$E(TO,1,%-1)_$C(M+1)_$C(122) Q
"RTN","PSOP1",54,0)
 S PSTO=Y1 K Y1,Y,X,DIC
"RTN","PSOP1",55,0)
 Q
"RTN","PSOP1",56,0)
CLSS ;asks drug class list
"RTN","PSOP1",57,0)
 W ! S DIC("A")="Start with Drug Class: ",DIC(0)="AEQ",DIC=50.605 D ^DIC I "^"[X S DUOUT=1 Q
"RTN","PSOP1",58,0)
 G:Y<0 CLSS S FR=$P(Y,"^",2)
"RTN","PSOP1",59,0)
 F %=$L($E(FR,1,30)):-1:1 S M=$A(FR,%) I M>32 S Y1=$E(FR,1,%-1)_$C(M-1)_$C(122) Q
"RTN","PSOP1",60,0)
 S PSFR=Y1 K Y1,Y,X
"RTN","PSOP1",61,0)
TO1 S DIC("A")="To Drug Class: " D ^DIC I "^"[X S DUOUT=1 Q
"RTN","PSOP1",62,0)
 G:Y<0 TO1 I FR]$P(Y,"^",2) W !,$C(7),"Less Than 'Start' Value" K X,Y G TO1
"RTN","PSOP1",63,0)
 S TO=$P(Y,"^",2)
"RTN","PSOP1",64,0)
 F %=$L($E(TO,1,30)):-1:1 S M=$A(TO,%) I M>32 S Y1=$E(TO,1,%-1)_$C(M+1)_$C(122) Q
"RTN","PSOP1",65,0)
 S PSTO=Y1,CLS=1 K Y,Y1,X
"RTN","PSOP1",66,0)
 Q
"RTN","PSOP1",67,0)
DIR K PQT,DTOUT,DUOUT,DIR,DIRUT S DIR(0)="E" D ^DIR S:$D(DUOUT)!($D(DTOUT)) PQT=1 Q
"RTN","PSOP1",68,0)
SIG I '$P(^PSRX(J,"SIG"),"^",2) D  Q
"RTN","PSOP1",69,0)
 .S X=$P(^PSRX(J,"SIG"),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOP1",70,0)
 .F SG=1:1:$L(SIG) W:($X+$L($P(SIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W:$P(SIG," ",SG)]"" $P(SIG," ",SG)_" "
"RTN","PSOP1",71,0)
 S MIG=$P(^PSRX(J,"SIG"),"^"),SIGOK=1 D
"RTN","PSOP1",72,0)
 .F SG=1:1:$L(MIG) Q:$P(MIG," ",SG)=""  W:($X+$L($P(MIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W $P(MIG," ",SG)_" "
"RTN","PSOP1",73,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  S MIG=$P(^PSRX(RXN,"SIG1",I,0),"^") D
"RTN","PSOP1",74,0)
 .F SG=1:1:$L(MIG) Q:$P(MIG," ",SG)=""  W:($X+$L($P(MIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W $P(MIG," ",SG)_" "
"RTN","PSOP1",75,0)
 Q
"RTN","PSOPKIV1")
0^92^B25219791
"RTN","PSOPKIV1",1,0)
PSOPKIV1 ;BHAM ISC/MHA - validate PKI cert. ; 05/09/2002  8:15 am
"RTN","PSOPKIV1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**131,146,223,148**;DEC 1997
"RTN","PSOPKIV1",3,0)
 ;Ref. to ^ORWOR1 supported by DBIA 3750
"RTN","PSOPKIV1",4,0)
CER ;
"RTN","PSOPKIV1",5,0)
 N P1,P2
"RTN","PSOPKIV1",6,0)
 I $D(OR0) S P1=$P(OR0,"^"),P2=$P(OR0,"^",2)
"RTN","PSOPKIV1",7,0)
 E  S P1=$P($G(^PSRX(DA,"OR1")),"^",2),P2=$P($G(^(0)),"^",2)
"RTN","PSOPKIV1",8,0)
 I P1<1 S PKI=-1,VALMSG="Invalid CPRS Pointer - Unable to Process" Q
"RTN","PSOPKIV1",9,0)
CT N PKIRT D VERIFY^ORWOR1(.PKIRT,P1,P2)
"RTN","PSOPKIV1",10,0)
 S PKI=+PKIRT I PKI=1 S VALMSG="Digitally Signed Order",PKIE="Processing "_VALMSG Q
"RTN","PSOPKIV1",11,0)
 I PKI<2 S VALMSG=$P(PKIRT,"^",2) Q
"RTN","PSOPKIV1",12,0)
 S PKI1=$S(PKI>89802014&(PKI<89802019)!((PKI>89802020)&(PKI<89802023)):2,1:1)
"RTN","PSOPKIV1",13,0)
 S PKIE="Digital Signature Failed: "_$P($T(@($E(PKI,7,8))),";;",2)
"RTN","PSOPKIV1",14,0)
 S:'$G(PSOZVER) VALMSG="Signature Failed: "_$P($T(@($E(PKI,7,8))),";;",2)
"RTN","PSOPKIV1",15,0)
 S:PKI1=2 PKIE=PKIE_" - Order Auto Discontinued" S:$L(PKIE)>75 PKIE=$E(PKIE,1,75)
"RTN","PSOPKIV1",16,0)
 Q
"RTN","PSOPKIV1",17,0)
L1 ;
"RTN","PSOPKIV1",18,0)
 S PKID=1,IEN=IEN+1,^TMP($S($G(ST)=1:"PSOAO",1:"PSOPO"),$J,IEN,0)=PKIE Q
"RTN","PSOPKIV1",19,0)
ERR(ER) ;
"RTN","PSOPKIV1",20,0)
 Q:'ER
"RTN","PSOPKIV1",21,0)
 N ERM S ERM=$P($T(@($E(ER,7,8))),";;",2) I ERM]"" Q "Signature Failed: "_ERM
"RTN","PSOPKIV1",22,0)
 Q ""
"RTN","PSOPKIV1",23,0)
REA ;
"RTN","PSOPKIV1",24,0)
 D KV^PSOVER1
"RTN","PSOPKIV1",25,0)
 W ! S DIR("A")="Enter Override Reason ",DIR(0)="F^5:70",DIR("?")="Free text reason must be entered, should be between 5 to 70 characters and must not contain embedded up-arrow, e.g. Spoke with the Provider."
"RTN","PSOPKIV1",26,0)
 S:$G(PKIR)]"" DIR("B")=PKIR D ^DIR S:'$D(DIRUT) PKIR=Y
"RTN","PSOPKIV1",27,0)
 I $D(DIRUT) K PKIR I $D(OR0) S:$P(OR0,"^",3)="RNW" PSONEW("QFLG")=1 S:$P(OR0,"^",3)="NW" PSORX("DFLG")=1
"RTN","PSOPKIV1",28,0)
 D KV^PSOVER1 K Y Q
"RTN","PSOPKIV1",29,0)
ACT(DA) ;
"RTN","PSOPKIV1",30,0)
 Q:'DA
"RTN","PSOPKIV1",31,0)
 N I,J D AR
"RTN","PSOPKIV1",32,0)
 S ^PSRX(DA,"A",0)="^52.3DA^"_J_"^"_J,^PSRX(DA,"A",J,0)=%_"^K^"_DUZ_"^0^INVALID PKI CERT. "_PKI
"RTN","PSOPKIV1",33,0)
 S ^PSRX(DA,"A",J,2,1,0)=PKIR,^PSRX(DA,"A",J,2,0)="^52.34A^1^1"
"RTN","PSOPKIV1",34,0)
 K PKIR Q
"RTN","PSOPKIV1",35,0)
 ;
"RTN","PSOPKIV1",36,0)
AR ;
"RTN","PSOPKIV1",37,0)
 S (I,J)=0 F  S I=$O(^PSRX(DA,"A",I)) Q:'I  S J=I
"RTN","PSOPKIV1",38,0)
 S J=J+1 D NOW^%DTC Q
"RTN","PSOPKIV1",39,0)
DCP ;
"RTN","PSOPKIV1",40,0)
 Q:'$D(^PS(52.41,ORD,0))
"RTN","PSOPKIV1",41,0)
 K ^PS(52.41,"AOR",$P(^PS(52.41,ORD,0),"^",2),+$P($G(^PS(52.41,ORD,"INI")),"^"),ORD),^PS(52.41,"AD",$P(^PS(52.41,ORD,0),"^",12),+$P($G(^PS(52.41,ORD,"INI")),"^"),ORD)
"RTN","PSOPKIV1",42,0)
 S $P(^PS(52.41,ORD,0),"^",3)="DC"
"RTN","PSOPKIV1",43,0)
 S PKIE=$P(PKIE," - ")_" - "_PKI,$P(^PS(52.41,ORD,4),"^")=PKIE
"RTN","PSOPKIV1",44,0)
 D EN^PSOHLSN($P(^PS(52.41,ORD,0),"^"),"OD",PKIE,"A")
"RTN","PSOPKIV1",45,0)
 Q
"RTN","PSOPKIV1",46,0)
 ;
"RTN","PSOPKIV1",47,0)
DCV ;
"RTN","PSOPKIV1",48,0)
 W ! D KV^PSOVER1 K PKIR S DIR(0)="Y",DIR("B")="N",DIR("A",1)="Digitally signed Schedule II Rx cannot be deleted, it can only be D/Ced."
"RTN","PSOPKIV1",49,0)
 S DIR("A")="Are you sure you want to D/C this Rx: " D ^DIR,KV^PSOVER1
"RTN","PSOPKIV1",50,0)
 I 'Y S VALMSG="No Action Taken!",VALMBCK="R" Q
"RTN","PSOPKIV1",51,0)
 S:'$D(INCOM) INCOM="DCed by Pharmacy for PKI" S DIR("B")=INCOM
"RTN","PSOPKIV1",52,0)
 ;
"RTN","PSOPKIV1",53,0)
 W ! S DIR("A")="Reason for D/Cing",DIR(0)="F^5:75",DIR("?")="Reason must be entered and should be 5 to 75 characters and must not contain embedded uparrow"
"RTN","PSOPKIV1",54,0)
 D ^DIR I $D(DIRUT) D KV^PSOVER1 S VALMSG="No Action Taken!",VALMBCK="R" Q
"RTN","PSOPKIV1",55,0)
 S PKIR=Y D KV^PSOVER1
"RTN","PSOPKIV1",56,0)
DCV0 Q:'$D(^PS(52.4,DA,0))
"RTN","PSOPKIV1",57,0)
 S $P(^PSRX(DA,"STA"),"^")=12,$P(^PSRX(DA,3),"^",5)=$S($P($G(^PSRX(DA,3)),"^"):$P(^(3),"^"),1:DT)
"RTN","PSOPKIV1",58,0)
 D REVERSE^PSOBPSU1(DA,,"DC",7),CAN^PSOTPCAN(DA) N I,J D AR
"RTN","PSOPKIV1",59,0)
 S ^PSRX(DA,"A",J,0)=%_"^C^"_DUZ_"^0^Discontinued during verification"
"RTN","PSOPKIV1",60,0)
 S J=J+1 D ADR
"RTN","PSOPKIV1",61,0)
 N PKIX S PKIX=DA D EN^PSOHLSN1(DA,"OD","",PKIR,PSONOOR)
"RTN","PSOPKIV1",62,0)
 S DA=PKIX S DIK="^PS(52.4," D ^DIK K DIK
"RTN","PSOPKIV1",63,0)
 Q
"RTN","PSOPKIV1",64,0)
 ;
"RTN","PSOPKIV1",65,0)
DCV1 N PKIR,PSONOOR,DA S DA=PSONV,PKIR=$P($G(PKIE),"-")_" - "_PKI,PSONOOR="A" D DCV0
"RTN","PSOPKIV1",66,0)
 Q
"RTN","PSOPKIV1",67,0)
ADR ;
"RTN","PSOPKIV1",68,0)
 S ^PSRX(DA,"A",0)="^52.3DA^"_J_"^"_J
"RTN","PSOPKIV1",69,0)
 S ^PSRX(DA,"A",J,0)=%_"^K^"_DUZ_"^0^Digitally signed"
"RTN","PSOPKIV1",70,0)
 S ^PSRX(DA,"A",J,2,1,0)=$S($G(PKIR)]"":PKIR,1:"Digitally signed order Discontinued"),^PSRX(DA,"A",J,2,0)="^52.34A^1^1"
"RTN","PSOPKIV1",71,0)
 Q
"RTN","PSOPKIV1",72,0)
RV ;
"RTN","PSOPKIV1",73,0)
 N TY,T,T1,T2,MIG,SG
"RTN","PSOPKIV1",74,0)
 S (T,T2)=0
"RTN","PSOPKIV1",75,0)
 F  S T=$O(^PS(52.41,ORD,"OBX",T)) Q:'T  D
"RTN","PSOPKIV1",76,0)
 .S T1=0,$P(TY(T2)," ",23)=" "
"RTN","PSOPKIV1",77,0)
 .F  S T1=$O(^PS(52.41,ORD,"OBX",T,2,T1)) Q:'T1  D
"RTN","PSOPKIV1",78,0)
 ..S MIG=^PS(52.41,ORD,"OBX",T,2,T1,0)
"RTN","PSOPKIV1",79,0)
 ..F SG=1:1:$L(MIG," ") S:$L(TY(T2)_" "_$P(MIG," ",SG))>80 T2=T2+1,$P(TY(T2)," ",23)=" " S TY(T2)=$G(TY(T2))_" "_$P(MIG," ",SG)
"RTN","PSOPKIV1",80,0)
 .S T2=T2+4
"RTN","PSOPKIV1",81,0)
 S T2=T2+2 D CNTRL^VALM10(T2,1,$L(PKIE),IORVON,IORVOFF,0)
"RTN","PSOPKIV1",82,0)
 Q
"RTN","PSOPKIV1",83,0)
 ;
"RTN","PSOPKIV1",84,0)
00 ;;Order Text is blank;;
"RTN","PSOPKIV1",85,0)
01 ;;DEA # missing;;
"RTN","PSOPKIV1",86,0)
02 ;;Drug Schedule missing;;
"RTN","PSOPKIV1",87,0)
03 ;;DEA # not valid;;
"RTN","PSOPKIV1",88,0)
04 ;;Valid Certificate not found;;
"RTN","PSOPKIV1",89,0)
05 ;;Couldn't load CSP;;
"RTN","PSOPKIV1",90,0)
06 ;;Smart card Reader not found;;
"RTN","PSOPKIV1",91,0)
07 ;;Certificate with DEA # not found;;
"RTN","PSOPKIV1",92,0)
08 ;;Certificate not valid for schedule;;
"RTN","PSOPKIV1",93,0)
10 ;;Crypto Error (contact IRM);;
"RTN","PSOPKIV1",94,0)
15 ;;Corrupted (Decode failure);;
"RTN","PSOPKIV1",95,0)
16 ;;Corrupted (Hash mismatch);;
"RTN","PSOPKIV1",96,0)
17 ;;Certificate revoked;;
"RTN","PSOPKIV1",97,0)
18 ;;Verification failure;;
"RTN","PSOPKIV1",98,0)
19 ;;Before Cert effective date;;
"RTN","PSOPKIV1",99,0)
20 ;;Certificate expired;;
"RTN","PSOPKIV1",100,0)
21 ;;No Cert with a valid date found;;
"RTN","PSOPKIV1",101,0)
22 ;;Signature Check failed (Invalid Signature);;
"RTN","PSOR52")
0^4^B30307425
"RTN","PSOR52",1,0)
PSOR52 ;IHS/DSD/JCM - Files refill entries in prescription file ;03/10/93
"RTN","PSOR52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,22,27,181,148**;DEC 1997
"RTN","PSOR52",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOR52",4,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOR52",5,0)
 ; This routine is responsible for the actual
"RTN","PSOR52",6,0)
 ; filling of the refill prescription.
"RTN","PSOR52",7,0)
 ;---------------------------------------------------------   
"RTN","PSOR52",8,0)
EN(PSOX) ;Entry Point
"RTN","PSOR52",9,0)
START ;
"RTN","PSOR52",10,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT monitor
"RTN","PSOR52",11,0)
 D INIT G:PSOR52("QFLG") END
"RTN","PSOR52",12,0)
 D FILE
"RTN","PSOR52",13,0)
 D DIK
"RTN","PSOR52",14,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Monitor
"RTN","PSOR52",15,0)
 D FINISH
"RTN","PSOR52",16,0)
END D EOJ
"RTN","PSOR52",17,0)
 Q
"RTN","PSOR52",18,0)
 ;---------------------------------------------------------
"RTN","PSOR52",19,0)
 ;
"RTN","PSOR52",20,0)
INIT ;
"RTN","PSOR52",21,0)
 S PSOR52("QFLG")=0
"RTN","PSOR52",22,0)
 S PSOX("QTY")=$P(PSOX("RX0"),"^",7),PSOX("DAYS SUPPLY")=$P(PSOX("RX0"),"^",8)
"RTN","PSOR52",23,0)
 S:$G(^PSDRUG($P(PSOX("RX0"),"^",6),660))]"" PSOX("COST")=$P(^PSDRUG($P(PSOX("RX0"),"^",6),660),"^",6)
"RTN","PSOR52",24,0)
 D NOW^%DTC S PSOX("LOGIN DATE")=$E(%,1,7)
"RTN","PSOR52",25,0)
 S X1=PSOX("FILL DATE"),X2=PSOX("DAYS SUPPLY")-10\1 D C^%DTC S PSOX1=X
"RTN","PSOR52",26,0)
 S X1=$P(PSOX("RX2"),"^",2)
"RTN","PSOR52",27,0)
 S X2=PSOX("DAYS SUPPLY")*(PSOX("NUMBER")+1)-10\1
"RTN","PSOR52",28,0)
 D C^%DTC S PSOX2=X
"RTN","PSOR52",29,0)
 S PSOX("NEXT POSSIBLE REFILL")=$S(PSOX1>PSOX2:PSOX1,1:PSOX2)
"RTN","PSOR52",30,0)
 K X,PSOX1,PSOX2
"RTN","PSOR52",31,0)
 S (PSOX("LAST DISPENSED DATE"),PSOX("DISPENSED DATE"))=PSOX("FILL DATE")
"RTN","PSOR52",32,0)
 I PSOX("FILL DATE")>$S($G(PSOX("LOGIN DATE")):$E(PSOX("LOGIN DATE"),1,7),1:DT),$P(PSOPAR,"^",6) D
"RTN","PSOR52",33,0)
 .S PSOX("OLD MAIL/WINDOW")=$S($G(PSOX("MAIL/WINDOW"))]"":PSOX("MAIL/WINDOW"),1:"MAIL"),PSOX("MAIL/WINDOW")="M"
"RTN","PSOR52",34,0)
 I $P(PSOX("RX2"),"^",12)]"" S PSOX("GENERIC PROVIDER")=$P(PSOX("RX2"),"^",12)
"RTN","PSOR52",35,0)
 S PSOX("PROVIDER")=$P(PSOX("RX0"),"^",4)
"RTN","PSOR52",36,0)
 S:'$D(PSOX("CLERK CODE")) PSOX("CLERK CODE")=DUZ
"RTN","PSOR52",37,0)
 S PSOX("DAW")=$$GETDAW^PSODAWUT(+PSOX("IRXN"))
"RTN","PSOR52",38,0)
INITX Q
"RTN","PSOR52",39,0)
 ;
"RTN","PSOR52",40,0)
FILE ;     
"RTN","PSOR52",41,0)
 ;L +^PSRX(PSOX("IRXN")):0
"RTN","PSOR52",42,0)
 I '$D(^PSRX(PSOX("IRXN"),1,0)) S ^(0)="^52.1DA^1^1"
"RTN","PSOR52",43,0)
 E  S ^PSRX(PSOX("IRXN"),1,0)=$P(^PSRX(PSOX("IRXN"),1,0),"^",1,2)_"^"_PSOX("NUMBER")_"^"_($P(^(0),"^",4)+1)
"RTN","PSOR52",44,0)
 F PSOX1=1:1 S PSOR52=$P($T(DD+PSOX1),";;",2,4) Q:PSOR52=""  K PSOY S PSOY=$P(PSOR52,";;") I $D(@PSOY) S $P(PSOR52(PSOX("IRXN"),1,PSOX("NUMBER"),$P(PSOR52,";;",2)),"^",$P(PSOR52,";;",3))=@PSOY
"RTN","PSOR52",45,0)
 K PSOX1,PSOY
"RTN","PSOR52",46,0)
 S PSOX1="" F  S PSOX1=$O(PSOR52(PSOX("IRXN"),1,PSOX("NUMBER"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),1,PSOX("NUMBER"),PSOX1)=$G(PSOR52(PSOX("IRXN"),1,PSOX("NUMBER"),PSOX1))
"RTN","PSOR52",47,0)
 K PSOX1
"RTN","PSOR52",48,0)
 S:PSOX("STA")=6 $P(^PSRX(PSOX("IRXN"),"STA"),"^")=0
"RTN","PSOR52",49,0)
 S $P(^PSRX(PSOX("IRXN"),3),"^",1,2)=PSOX("LAST DISPENSED DATE")_"^"_PSOX("NEXT POSSIBLE REFILL")
"RTN","PSOR52",50,0)
 S $P(^PSRX(PSOX("IRXN"),3),"^",4)=PSOX("LAST REFILL DATE")
"RTN","PSOR52",51,0)
 I $D(PSOX("METHOD OF PICK-UP")),PSOX("FILL DATE")'>DT S $P(^PSRX(PSOX("IRXN"),"MP"),"^")=PSOX("METHOD OF PICK-UP")
"RTN","PSOR52",52,0)
 ;L -^PSRX(PSOX("IRXN"))
"RTN","PSOR52",53,0)
 Q
"RTN","PSOR52",54,0)
 ;
"RTN","PSOR52",55,0)
DIK ;
"RTN","PSOR52",56,0)
 K DIK,DA
"RTN","PSOR52",57,0)
 S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSOR52",58,0)
 I +$G(^PSRX(DA,"IB")),$P(^PSRX(DA,1,PSOX("NUMBER"),0),"^",2)="W" S ^PSRX("ACP",$P(^PSRX(DA,0),"^",2),$P(^PSRX(DA,1,PSOX("NUMBER"),0),"^"),PSOX("NUMBER"),DA)="" K DA
"RTN","PSOR52",59,0)
 D:$T(EN^PSOHDR)]"" EN^PSOHDR("PREF",PSOX("IRXN"))
"RTN","PSOR52",60,0)
 Q
"RTN","PSOR52",61,0)
 ;
"RTN","PSOR52",62,0)
FINISH ;
"RTN","PSOR52",63,0)
 I $G(PSOX("QS"))="S" D  G FINISHX
"RTN","PSOR52",64,0)
 . S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=PSOX("NUMBER")
"RTN","PSOR52",65,0)
 . D SUS^PSORXL K DA
"RTN","PSOR52",66,0)
 ;
"RTN","PSOR52",67,0)
 ; - Previous ePharmacy Refill was Deleted and a new one is being entered
"RTN","PSOR52",68,0)
 I '$$SUBMIT^PSOBPSUT(PSOX("IRXN"),PSOX("NUMBER")),$$STATUS^PSOBPSUT(PSOX("IRXN"),PSOX("NUMBER"))'="" D
"RTN","PSOR52",69,0)
 . D RETRXF^PSOREJU2(PSOX("IRXN"),PSOX("NUMBER"),1)
"RTN","PSOR52",70,0)
 ;
"RTN","PSOR52",71,0)
 I PSOX("FILL DATE")>$S($G(PSOX("LOGIN DATE")):$E(PSOX("LOGIN DATE"),1,7),1:DT),$P(PSOPAR,"^",6) D  G FINISHX
"RTN","PSOR52",72,0)
 .K PSOXRXFL I $D(RXFL(PSOX("IRXN"))) S PSOXRXFL=$G(RXFL(PSOX("IRXN")))
"RTN","PSOR52",73,0)
 .S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=PSOX("NUMBER")
"RTN","PSOR52",74,0)
 .D SUS^PSORXL K DA
"RTN","PSOR52",75,0)
 .I $G(PSOXRXFL)'="" S RXFL(PSOX("IRXN"))=$G(PSOXRXFL) K PSOXRXFL
"RTN","PSOR52",76,0)
 ;
"RTN","PSOR52",77,0)
 ; - Calling ECME for claims generation and transmission / REJECT handling
"RTN","PSOR52",78,0)
 N ACTION
"RTN","PSOR52",79,0)
 I $$SUBMIT^PSOBPSUT(PSOX("IRXN"),PSOX("NUMBER")) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSOR52",80,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOX("IRXN"),PSOX("NUMBER"),PSOX("FILL DATE"),"RF")
"RTN","PSOR52",81,0)
 . I $$FIND^PSOREJUT(PSOX("IRXN"),PSOX("NUMBER")) D
"RTN","PSOR52",82,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOX("IRXN"),PSOX("NUMBER"),"79,88","OF","IOQ","I")
"RTN","PSOR52",83,0)
 ;
"RTN","PSOR52",84,0)
 I $G(PSOX("QS"))="Q" D  G FINISHX
"RTN","PSOR52",85,0)
 . I $G(PPL),$L(PPL_PSOX("IRXN")_",")>240 D TRI^PSOBBC D Q^PSORXL K PPL,RXFL
"RTN","PSOR52",86,0)
 . S RXFL(PSOX("IRXN"))=PSOX("NUMBER")
"RTN","PSOR52",87,0)
 . I $G(PPL) S PPL=PPL_PSOX("IRXN")_","
"RTN","PSOR52",88,0)
 . E  S PPL=PSOX("IRXN")_","
"RTN","PSOR52",89,0)
 ;
"RTN","PSOR52",90,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=PSOX("NUMBER") G FINISHX
"RTN","PSOR52",91,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOR52",92,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSOR52",93,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSOR52",94,0)
 S RXFL(PSOX("IRXN"))=PSOX("NUMBER")
"RTN","PSOR52",95,0)
 ;
"RTN","PSOR52",96,0)
FINISHX ; 
"RTN","PSOR52",97,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSOR52",98,0)
 K PSOX1,PSOX2
"RTN","PSOR52",99,0)
 Q
"RTN","PSOR52",100,0)
EOJ ;
"RTN","PSOR52",101,0)
 I $D(PSOX("OLD MAIL/WINDOW")) S PSOX("MAIL/WINDOW")=PSOX("OLD MAIL/WINDOW") K PSOX("OLD MAIL/WINDOW")
"RTN","PSOR52",102,0)
 S DA=$O(^PS(52.41,"ARF",PSOX("IRXN"),0)) I DA D  S DIK="^PS(52.41," D ^DIK
"RTN","PSOR52",103,0)
 .S PSORFKL=DA D PSOUL^PSSLOCK(PSORFKL_"S") K PSORFKL
"RTN","PSOR52",104,0)
 K PSOR52,DA,DIK
"RTN","PSOR52",105,0)
 Q
"RTN","PSOR52",106,0)
 ;
"RTN","PSOR52",107,0)
DD ;rx data nodes
"RTN","PSOR52",108,0)
 ;;PSOX("PROVIDER");;0;;17
"RTN","PSOR52",109,0)
 ;;PSOX("QTY");;0;;4
"RTN","PSOR52",110,0)
 ;;PSOX("DAYS SUPPLY");;0;;10
"RTN","PSOR52",111,0)
 ;;PSOX("MAIL/WINDOW");;0;;2
"RTN","PSOR52",112,0)
 ;;PSOX("REMARKS");;0;;3
"RTN","PSOR52",113,0)
 ;;PSOX("CLERK CODE");;0;;7
"RTN","PSOR52",114,0)
 ;;PSOX("COST");;0;;11
"RTN","PSOR52",115,0)
 ;;PSOSITE;;0;;9
"RTN","PSOR52",116,0)
 ;;PSOX("LOGIN DATE");;0;;8
"RTN","PSOR52",117,0)
 ;;PSOX("FILL DATE");;0;;1
"RTN","PSOR52",118,0)
 ;;PSOX("PHARMACIST");;0;;5
"RTN","PSOR52",119,0)
 ;;PSOX("LOT #");;0;;6
"RTN","PSOR52",120,0)
 ;;PSOX("DISPENSED DATE");;0;;19
"RTN","PSOR52",121,0)
 ;;PSOX("NDC");;1;;3
"RTN","PSOR52",122,0)
 ;;PSOX("DAW");;EPH;;1
"RTN","PSOR52",123,0)
 ;;PSOX("MANUFACTURER");;0;;14
"RTN","PSOR52",124,0)
 ;;PSOX("EXPIRATION DATE");;0;;15
"RTN","PSOR52",125,0)
 ;;PSOX("GENERIC PROVIDER");;1;;1
"RTN","PSOR52",126,0)
 ;;PSOX("RELEASED DATE/TIME");;0;;18
"RTN","PSOREF")
0^53^B65936340
"RTN","PSOREF",1,0)
PSOREF ;BIR/SAB-refill data entry ;07/07/96
"RTN","PSOREF",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,23,27,36,46,78,130,131,148**;DEC 1997
"RTN","PSOREF",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOREF",4,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOREF",5,0)
 ;
"RTN","PSOREF",6,0)
EOJ ;
"RTN","PSOREF",7,0)
 K PSOMSG,PSOREF,PSORX("BAR CODE"),PSOLIST,LFD,MAX,MIN,NODE,PS,PSOERR,REF,RF,RXO,RXN,RXP,RXS,SD,VAERR,PSORX("FILL DATE")
"RTN","PSOREF",8,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOREF",9,0)
 Q
"RTN","PSOREF",10,0)
OERR ;single refil
"RTN","PSOREF",11,0)
 I $$LMREJ^PSOREJU1($P(PSOLST(ORN),"^",2),,.VALMSG,.VALMBCK) Q
"RTN","PSOREF",12,0)
 I $D(RXRP($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="A Reprint Label has been requested!" Q
"RTN","PSOREF",13,0)
 I $D(RXPR($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="A Partial has already been requested!" Q
"RTN","PSOREF",14,0)
 I $D(RXRS($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="Rx is being pulled from suspense!" Q
"RTN","PSOREF",15,0)
 I $D(RXFL($P(PSOLST(ORN),"^",2))) S PTRX=$P(PSOLST(ORN),"^",2) D ^PSOCMOPT I '$G(PSOXFLAG) K PSOXFLAG S VALMBCK="",VALMSG="Fill already requested for CMOP!" Q
"RTN","PSOREF",16,0)
 K PSOXFLAG
"RTN","PSOREF",17,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG Q
"RTN","PSOREF",18,0)
 N RXN K PSORX("FILL DATE") D FULL^VALM1 S:$G(PSOFROM)'="NEW" PSOFROM="REFILL" S PSOREF("DFLG")=0,PSOREF("IRXN")=$P(PSOLST(ORN),"^",2),PSOREF("QFLG")=0
"RTN","PSOREF",19,0)
 K PSOID D ^PSOREF1 I PSOREF("DFLG") D EOJ S VALMBCK="R" Q
"RTN","PSOREF",20,0)
 D ^PSOREF0
"RTN","PSOREF",21,0)
 W ! K DIR,DIRUT,DTOUT,DUOUT S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DIRUT,DTOUT,DUOUT S PSORXED=1 D ^PSOBUILD,ACT^PSOORNE2 K PSORXED S VALMBCK="Q" D EOJ
"RTN","PSOREF",22,0)
 Q
"RTN","PSOREF",23,0)
SPEED ;speed refill
"RTN","PSOREF",24,0)
 K LST,PSORX("FILL DATE") N VALMCNT I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOREF",25,0)
 K DIR,DIRUT S DIR(0)="Y",DIR("B")="NO",DIR("A")="Barcode Refill",DIR("?")="If you want to use a barcode reader to process refills enter 'Y'."
"RTN","PSOREF",26,0)
 D ^DIR K DIR,DUOUT,DTOUT I $D(DIRUT) S VALMBCK="" Q
"RTN","PSOREF",27,0)
 G BCREF:Y
"RTN","PSOREF",28,0)
 K PSOREF,PSOFDR,DIR,DUOUT,DIRUT S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" Q
"RTN","PSOREF",29,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,DTOUT I +Y S (ASK,SPEED,PSOOELSE)=1 D FULL^VALM1 S LST=Y D  G:$G(PSOREF("DFLG"))!($G(PSOREF("QFLG"))) SPEEDX
"RTN","PSOREF",30,0)
 .F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""!($G(PSOREF("QFLG")))  S ORN=$P(LST,",",ORD) D:+PSOLST(ORN)=52
"RTN","PSOREF",31,0)
 ..I $$LMREJ^PSOREJU1($P(PSOLST(ORN),"^",2)) W $C(7),!!,"Rx "_$$GET1^DIQ(52,$P(PSOLST(ORN),"^",2),.01)_" has OPEN/UNRESOLVED 3rd Party Payer Reject!" K DIR D PAUSE^VALM1 Q
"RTN","PSOREF",32,0)
 ..D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) W $C(7),!!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing Rx "_$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^")),! D PAUSE^VALM1 K PSOMSG Q
"RTN","PSOREF",33,0)
 ..K PSOMSG I $D(RXRP($P(PSOLST(ORN),"^",2))) W $C(7),!!,"A Reprint Label has been requested!" D ULK D PAUSE^VALM1 Q
"RTN","PSOREF",34,0)
 ..I $D(RXPR($P(PSOLST(ORN),"^",2))) W $C(7),!!,"A Partial has already been requested!" D ULK D PAUSE^VALM1 Q
"RTN","PSOREF",35,0)
 ..I $D(RXFL($P(PSOLST(ORN),"^",2))) S PTRX=$P(PSOLST(ORN),"^",2) D ^PSOCMOPT I '$G(PSOXFLAG) K PSOXFLAG W $C(7),!!,"A CMOP fill has already been requested for Rx "_$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^") D ULK D PAUSE^VALM1 Q
"RTN","PSOREF",36,0)
 ..K PSOXFLAG I $D(RXRS($P(PSOLST(ORN),"^",2))) W $C(7),!!,"Rx is being pulled from suspense!" D ULK D PAUSE^VALM1 Q
"RTN","PSOREF",37,0)
 ..I $P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")=11 D  D ULK Q
"RTN","PSOREF",38,0)
 ...W $C(7),!!?5,"RX "_$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^")_" is in an EXPIRED status." W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR
"RTN","PSOREF",39,0)
 ..S PSOREF("IRXN")=$P(PSOLST(ORN),"^",2) I ASK D ^PSOREF1 S ASK=0 D:$G(PSOREF("QFLG")) ULK Q:$G(PSOREF("QFLG"))
"RTN","PSOREF",40,0)
 ..N RXN D FULL^VALM1 S:$G(PSOFROM)'="NEW" PSOFROM="REFILL" S PSOREF("DFLG")=0,PSOREF("IRXN")=$P(PSOLST(ORN),"^",2)
"RTN","PSOREF",41,0)
 ..I PSOREF("DFLG") D EOJ S VALMBCK="R" Q
"RTN","PSOREF",42,0)
 ..D ^PSOREF0 D ULK
"RTN","PSOREF",43,0)
 S:'$G(PSOOELSE) VALMBCK=""
"RTN","PSOREF",44,0)
 S PSORXED=1 D ^PSOBUILD,BLD^PSOORUT1
"RTN","PSOREF",45,0)
SPEEDX K PSOREF,PSORX("BAR CODE"),PSOLIST,LFD,MAX,MIN,NODE,PS,PSOERR,REF,RF,RXO,RXN,RXP,RXS,SD,VAERR,PSORX("FILL DATE")
"RTN","PSOREF",46,0)
 K LST,SPEED,PSORXED,PSOREF,PSOFDR,PSOOELSE,ASK S:'$D(VALMBCK) VALMBCK="R"
"RTN","PSOREF",47,0)
 K PSORX("FILL DATE"),PSORX("MAIL/WINDOW"),PSORX("METHOD OF PICK-UP")
"RTN","PSOREF",48,0)
 Q
"RTN","PSOREF",49,0)
BCREF ;barcode refills
"RTN","PSOREF",50,0)
 K LST,DIR,DIRUT,DUOUT,DTOUT D FULL^VALM1
"RTN","PSOREF",51,0)
ASK S DIR(0)="FO^5:245^K:X'?3N1""-""1.N X",DIR("A")="WAND BARCODE"
"RTN","PSOREF",52,0)
 S DIR("?",1)="Wand the barcoded number of the prescription to be processed."
"RTN","PSOREF",53,0)
 S DIR("?",2)="The number should be of the form NNN-NNNNNN",DIR("?",3)="where the number before the dash is your station number."
"RTN","PSOREF",54,0)
 S DIR("?")="Enter ""^"", or a RETURN to quit."
"RTN","PSOREF",55,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) S VALMBCK="" G BCREFX
"RTN","PSOREF",56,0)
 I $G(X)']"",'$G(LST) S VALMBCK="" G BCREFX
"RTN","PSOREF",57,0)
 I $D(DIRUT),+$G(LST) D  S VALMBCK="R" G BCREFX
"RTN","PSOREF",58,0)
 .K DIR,DIRUT,DTOUT,PSOOELSE,DTOUT
"RTN","PSOREF",59,0)
 .S (BCREF,ASK,SPEED,PSOOELSE)=1 D FULL^VALM1 D
"RTN","PSOREF",60,0)
 ..F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""!($G(PSOREF("QFLG")))  S ORN=$P(LST,",",ORD) D:+PSOLST(ORN)=52
"RTN","PSOREF",61,0)
 ...I $$LMREJ^PSOREJU1($P(PSOLST(ORN),"^",2)) W $C(7),!!,"Rx "_$$GET1^DIQ(52,$P(PSOLST(ORN),"^",2),.01)_" has OPEN/UNRESOLVED 3rd Party Payer Reject!" K DIR D PAUSE^VALM1 Q
"RTN","PSOREF",62,0)
 ...D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) W $C(7),!!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing Rx "_$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^")),! D PAUSE^VALM1 K PSOMSG Q
"RTN","PSOREF",63,0)
 ...K PSOMSG I $D(RXRP($P(PSOLST(ORN),"^",2))) W $C(7),!!,"A Reprint Label has been requested for Rx "_$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),! D ULK D PAUSE^VALM1 Q
"RTN","PSOREF",64,0)
 ...I $D(RXPR($P(PSOLST(ORN),"^",2))) W $C(7),!!,"A Partial has already been requested for Rx "_$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),! D ULK D PAUSE^VALM1 Q
"RTN","PSOREF",65,0)
 ...I $D(RXFL($P(PSOLST(ORN),"^",2))) S PTRX=$P(PSOLST(ORN),"^",2) D ^PSOCMOPT I '$G(PSOXFLAG) K PSOXFLAG W $C(7),!!,"A CMOP fill has already been requested for Rx "_$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^") D ULK D PAUSE^VALM1 Q
"RTN","PSOREF",66,0)
 ...K PSOXFLAG I $D(RXRS($P(PSOLST(ORN),"^",2))) W $C(7),!!,"Rx "_$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^")_" is being pulled from suspense!" D ULK D PAUSE^VALM1 Q
"RTN","PSOREF",67,0)
 ...S PSOREF("IRXN")=$P(PSOLST(ORN),"^",2) I ASK D ^PSOREF1 S ASK=0 D:$G(PSOREF("DFLG")) ULK Q:$G(PSOREF("DFLG"))
"RTN","PSOREF",68,0)
 ...N RXN D FULL^VALM1 S:$G(PSOFROM)'="NEW" PSOFROM="REFILL" S PSOREF("DFLG")=0,PSOREF("IRXN")=$P(PSOLST(ORN),"^",2)
"RTN","PSOREF",69,0)
 ...I PSOREF("DFLG") D EOJ S VALMBCK="R" Q
"RTN","PSOREF",70,0)
 ...D ^PSOREF0 D ULK
"RTN","PSOREF",71,0)
 F RX=1:1:PSOCNT I $P(PSOLST(RX),"^",2)=$P(X,"-",2) D  Q
"RTN","PSOREF",72,0)
 .I $D(PSOBBC(RX)) Q
"RTN","PSOREF",73,0)
 .S LST=$G(LST)_RX_",",PSOBBC(RX)=1
"RTN","PSOREF",74,0)
 G ASK
"RTN","PSOREF",75,0)
BCREFX K BCREF,ASK,LST,SPEED,RX,PSOBBC,DIR,DIRUT,PSORXED,PSOREF,PSOFDR,PSOOELSE S PSORXED=1 D ^PSOBUILD,BLD^PSOORUT1
"RTN","PSOREF",76,0)
 S VALMBCK="R" Q
"RTN","PSOREF",77,0)
REFILL(PLACER) ;passes flag to CPRS for front door refill request
"RTN","PSOREF",78,0)
 ;PLACER=PHARMACY NUMBER
"RTN","PSOREF",79,0)
 N PSORFRM,PSOLC,PSODRG,PSODRUG0,RXN,ST,PSODEA
"RTN","PSOREF",80,0)
 I $G(PLACER)["S"!('$G(PLACER)) Q "-1^Not a Valid Outpatient Medication Order."
"RTN","PSOREF",81,0)
 S RXN=PLACER I '$D(^PSRX(RXN,0)) Q "-1^Not a Valid Outpatient Medication Order."
"RTN","PSOREF",82,0)
 S RX0=^PSRX(RXN,0),PSODRG=$P(^PSRX(RXN,0),"^",6),ST=+^("STA"),PSODRUG0=^PSDRUG(PSODRG,0),PSODEA=$P($G(^(0)),"^",3),DIV=$P(^PSRX(RXN,2),"^",9),PSORFRM=$P(RX0,"^",9)
"RTN","PSOREF",83,0)
 I PSODEA["2" Q "0^Schedule 2 Drug. Order cannot be refilled."
"RTN","PSOREF",84,0)
 I '$P($G(^PSRX(RXN,"OR1")),"^"),'$P($G(^PSDRUG(PSODRG,2)),"^") Q "0^Cannot Refill. Drug not matched to a Pharmacy Orderable Item."
"RTN","PSOREF",85,0)
 I '$P($G(^PSRX(RXN,"OR1")),"^"),$P($G(^PSDRUG(PSODRG,2)),"^") S $P(^PSRX(RXN,"OR1"),"^")=$P(^PSDRUG(PSODRG,2),"^")
"RTN","PSOREF",86,0)
 S CLOZPAT=$S($P($G(^PSDRUG(PSODRG,"CLOZ1")),"^")="PSOCLO1":1,1:0)
"RTN","PSOREF",87,0)
 I 'CLOZPAT I PSODEA["A"&(PSODEA'["B")!(PSODEA["F") Q "0^"_$S(PSODEA["F":"",1:"Narcotic Drug. ")_"Order Non-Refillable."
"RTN","PSOREF",88,0)
 K CLOZPAT I DT>$P($G(^PSRX(RXN,2)),"^",6) Q "0^Non-Refillable.  Prescription has Expired."
"RTN","PSOREF",89,0)
 I $P(^PSRX(RXN,3),"^",2)>$P(^PSRX(RXN,2),"^",6) Q "0^Next Refill Date Past Expiration Date.  New Order Required."
"RTN","PSOREF",90,0)
 I '$P($G(^PS(59,DIV,1)),"^",11),$G(^PSDRUG(PSODRG,"I"))]"",DT>$G(^("I")) Q "0^Inactive Drug, Non Refillable."
"RTN","PSOREF",91,0)
 I ST Q "0^Prescription is in a Non-Refillable Status."
"RTN","PSOREF",92,0)
 I $P($G(^PSDRUG(PSODRG,2)),"^",3)'["O" Q "0^Cannot Refill. Drug No Longer Used by Outpatient Pharmacy."
"RTN","PSOREF",93,0)
 S PSORFRM=$P(RX0,"^",9) F PSOJ=0:0 S PSOJ=$O(^PSRX(RXN,1,PSOJ)) Q:'PSOJ  S PSORFRM=PSORFRM-1
"RTN","PSOREF",94,0)
 I PSORFRM<1 Q "0^No Refills remaining. New Med order required."
"RTN","PSOREF",95,0)
 I $P(^PSRX(RXN,3),"^"),DT=$P(^PSRX(RXN,3),"^") Q "0^Can't Refill, Fill Date already exists for "_$E($P(^PSRX(RXN,3),"^"),4,5)_"/"_$E($P(^PSRX(RXN,3),"^"),6,7)_"/"_$E($P(^PSRX(RXN,3),"^"),2,3)_"."
"RTN","PSOREF",96,0)
 I $P(^PSRX(RXN,3),"^"),DT<$P(^PSRX(RXN,3),"^") Q "0^Can't Refill, later Refill Date already exists for "_$E($P(^PSRX(RXN,3),"^"),4,5)_"/"_$E($P(^PSRX(RXN,3),"^"),6,7)_"/"_$E($P(^PSRX(RXN,3),"^"),2,3)_"."
"RTN","PSOREF",97,0)
 I $O(^PS(52.41,"ARF",RXN,0)) Q "0^Pending Refill Request already exists."
"RTN","PSOREF",98,0)
 Q 1
"RTN","PSOREF",99,0)
 ;
"RTN","PSOREF",100,0)
ULK D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOREF",101,0)
 Q
"RTN","PSOREJP0")
0^48^B37884354
"RTN","PSOREJP0",1,0)
PSOREJP0 ;BIRM/MFR - Third Party Rejects Processing Screen ;04/28/05
"RTN","PSOREJP0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOREJP0",3,0)
 ;
"RTN","PSOREJP0",4,0)
 N PSOREJST,PSORJSRT,PSORJASC,PSOSTFLT,PSODRFLT,PSOPTFLT,PSORXFLT,PSOINFLT
"RTN","PSOREJP0",5,0)
 ;
"RTN","PSOREJP0",6,0)
 ; - Division/Site selection
"RTN","PSOREJP0",7,0)
 D SEL^PSOREJU1("DIVISION","^PS(59,",.PSOREJST) I $G(PSOREJST)="^" G EXIT
"RTN","PSOREJP0",8,0)
 ;
"RTN","PSOREJP0",9,0)
 S PSORJSRT="PA",PSORJASC=1,PSOSTFLT="U",(PSODRFLT,PSOPTFLT,PSORXFLT,PSOINFLT)="ALL"
"RTN","PSOREJP0",10,0)
 D LST
"RTN","PSOREJP0",11,0)
 G EXIT
"RTN","PSOREJP0",12,0)
 ;
"RTN","PSOREJP0",13,0)
LST ; - Invokes Listmanager
"RTN","PSOREJP0",14,0)
 W !,"Please wait..." D EN^VALM("PSO REJECTS PROCESSING") D FULL^VALM1
"RTN","PSOREJP0",15,0)
 Q
"RTN","PSOREJP0",16,0)
 ;
"RTN","PSOREJP0",17,0)
HDR      ; - Header code
"RTN","PSOREJP0",18,0)
 N LINE1,LINE2
"RTN","PSOREJP0",19,0)
 S LINE1=$$SITES(),LINE2="" I $L(LINE1)>80 S $E(LINE1,78,999)="..."
"RTN","PSOREJP0",20,0)
 ;
"RTN","PSOREJP0",21,0)
 S LINE2="Selection: ALL "_$S(PSOSTFLT="U":"UNRESOLVED ",PSOSTFLT="R":"RESOLVED ",1:"")_"REJECTS"
"RTN","PSOREJP0",22,0)
 I $G(PSOPTFLT)'="ALL" S LINE2=LINE2_" FOR "_$$NAME("P")
"RTN","PSOREJP0",23,0)
 I $G(PSODRFLT)'="ALL" S LINE2=LINE2_" FOR "_$$NAME("D")
"RTN","PSOREJP0",24,0)
 I $G(PSORXFLT)'="ALL" S LINE2=LINE2_" FOR PRESCRIPTION "_$$NAME("R")
"RTN","PSOREJP0",25,0)
 I $G(PSOINFLT)'="ALL" S LINE2=LINE2_" FOR "_$$NAME("I")
"RTN","PSOREJP0",26,0)
 S VALMHDR(1)=LINE1,VALMHDR(2)=LINE2
"RTN","PSOREJP0",27,0)
 ;
"RTN","PSOREJP0",28,0)
 D SETHDR()
"RTN","PSOREJP0",29,0)
 Q
"RTN","PSOREJP0",30,0)
 ;
"RTN","PSOREJP0",31,0)
SETHDR() ; Displays the Header Line
"RTN","PSOREJP0",32,0)
 N HDR,ORD
"RTN","PSOREJP0",33,0)
 ;
"RTN","PSOREJP0",34,0)
 S HDR="  #",$E(HDR,5)="Rx#",$E(HDR,18)="PATIENT(ID)",$E(HDR,43)="DRUG",$E(HDR,64)="REASON"
"RTN","PSOREJP0",35,0)
 S ORD=$S(PSORJASC=1:"[^]",1:"[v]")
"RTN","PSOREJP0",36,0)
 S:PSORJSRT="RX" $E(HDR,8,10)=ORD S:PSORJSRT="PA" $E(HDR,29,31)=ORD
"RTN","PSOREJP0",37,0)
 S:PSORJSRT="DR" $E(HDR,47,49)=ORD S:PSORJSRT="RE" $E(HDR,70,72)=ORD
"RTN","PSOREJP0",38,0)
 S $E(HDR,81)="" D INSTR^VALM1(IORVON_HDR_IOINORM,1,4)
"RTN","PSOREJP0",39,0)
 Q
"RTN","PSOREJP0",40,0)
 ;
"RTN","PSOREJP0",41,0)
INIT ; Populates the Body section for ListMan
"RTN","PSOREJP0",42,0)
 K ^TMP("PSOREJP0",$J)
"RTN","PSOREJP0",43,0)
 D SETSORT(PSORJSRT),SETLINE
"RTN","PSOREJP0",44,0)
 S VALMSG="Select the entry # to view or ?? for more actions"
"RTN","PSOREJP0",45,0)
 Q
"RTN","PSOREJP0",46,0)
 ;
"RTN","PSOREJP0",47,0)
SETLINE ; Sets the line to be displayed in ListMan
"RTN","PSOREJP0",48,0)
 N SUB,SEQ,LINE,Z,X,TOTAL,LUCRO,QTDE,TOT,I,X1,X2
"RTN","PSOREJP0",49,0)
 I '$D(^TMP("PSOREJSR",$J)) D  Q
"RTN","PSOREJP0",50,0)
 . F I=1:1:7 S ^TMP("PSOREJP0",$J,I,0)=""
"RTN","PSOREJP0",51,0)
 . S ^TMP("PSOREJP0",$J,8,0)="               No Clinical Third Party Payer Rejects found."
"RTN","PSOREJP0",52,0)
 . S VALMCNT=1
"RTN","PSOREJP0",53,0)
 S SUB="",LINE=0 K ^TMP("PSOREJP0",$J)
"RTN","PSOREJP0",54,0)
 F  S SUB=$O(^TMP("PSOREJSR",$J,SUB),PSORJASC) Q:SUB=""  D
"RTN","PSOREJP0",55,0)
 . S Z=$G(^TMP("PSOREJSR",$J,SUB))
"RTN","PSOREJP0",56,0)
 . S X1="",SEQ=$G(SEQ)+1,X1=$J(SEQ,3)
"RTN","PSOREJP0",57,0)
 . S $E(X1,5)=$P(Z,"^",3),$E(X1,18)=$P(Z,"^",4),$E(X1,43)=$P(Z,"^",5),$E(X1,64)=$P(Z,"^",6)
"RTN","PSOREJP0",58,0)
 . S LINE=LINE+1,^TMP("PSOREJP0",$J,LINE,0)=X1
"RTN","PSOREJP0",59,0)
 . S X2="",$E(X2,5)="Payer Message: "_$P(Z,"^",7)
"RTN","PSOREJP0",60,0)
 . S LINE=LINE+1,^TMP("PSOREJP0",$J,LINE,0)=X2
"RTN","PSOREJP0",61,0)
 . S ^TMP("PSOREJP0",$J,SEQ,"RX")=$P(Z,"^",1,2)
"RTN","PSOREJP0",62,0)
 F I=1:1:LINE D
"RTN","PSOREJP0",63,0)
 . D:(I#2) CNTRL^VALM10(I,1,80,IOINHI,IOINORM),CNTRL^VALM10(I,64,3,IOUON,IOINORM),CNTRL^VALM10(I,67,80,IOINHI,IOINORM)
"RTN","PSOREJP0",64,0)
 S VALMCNT=+$G(LINE)
"RTN","PSOREJP0",65,0)
 Q
"RTN","PSOREJP0",66,0)
 ;
"RTN","PSOREJP0",67,0)
SETSORT(FIELD) ; - Sets the data sorted by the FIELD specified
"RTN","PSOREJP0",68,0)
 N RX,STS
"RTN","PSOREJP0",69,0)
 K ^TMP("PSOREJSR",$J)
"RTN","PSOREJP0",70,0)
 S RX=0
"RTN","PSOREJP0",71,0)
 F STS=0,1 D
"RTN","PSOREJP0",72,0)
 . I PSOSTFLT="U",STS=1 Q
"RTN","PSOREJP0",73,0)
 . I PSOSTFLT="R",STS=0 Q
"RTN","PSOREJP0",74,0)
 . I $G(PSORXFLT)'="ALL" D SETTMP(+PSORXFLT,STS) Q
"RTN","PSOREJP0",75,0)
 . F  S RX=$O(^PSRX("REJSTS",STS,RX)) Q:'RX  D
"RTN","PSOREJP0",76,0)
 . . D SETTMP(RX,STS)
"RTN","PSOREJP0",77,0)
 Q
"RTN","PSOREJP0",78,0)
 ;
"RTN","PSOREJP0",79,0)
SETTMP(RX,STS) ; - Sets ^TMP global that will be displayed in the body section
"RTN","PSOREJP0",80,0)
 N REJ,REJLST,FILL,CODE,RXNUM,PTNAME,DRNAME,MSG,REASON,MSG,X,Z,SORT,I
"RTN","PSOREJP0",81,0)
 I $$FILTER(RX) Q
"RTN","PSOREJP0",82,0)
 S REJ=0
"RTN","PSOREJP0",83,0)
 F  S REJ=$O(^PSRX("REJSTS",STS,RX,REJ)) Q:'REJ  D
"RTN","PSOREJP0",84,0)
 . I $G(PSORXFLT)="ALL",$$CLOSED^PSOREJP1(RX,REJ),$$REOPN^PSOREJP1(RX,REJ) Q
"RTN","PSOREJP0",85,0)
 . S FILL=+$$GET1^DIQ(52.25,REJ_","_RX,5)
"RTN","PSOREJP0",86,0)
 . I '$$DIV(RX,FILL) Q
"RTN","PSOREJP0",87,0)
 . K REJLST D GET^PSOREJU2(RX,FILL,.REJLST,,1) I '$D(REJLST) Q
"RTN","PSOREJP0",88,0)
 . I $$FILTER(,REJLST(REJ,"INSURANCE NAME")) Q
"RTN","PSOREJP0",89,0)
 . S PTNAME=$$PTNAME(RX)
"RTN","PSOREJP0",90,0)
 . S DRNAME=$$GET1^DIQ(52,RX,6)
"RTN","PSOREJP0",91,0)
 . S RXNUM=$$GET1^DIQ(52,RX,.01)
"RTN","PSOREJP0",92,0)
 . S CODE=$G(REJLST(REJ,"CODE"))
"RTN","PSOREJP0",93,0)
 . S MSG=$G(REJLST(REJ,"PAYER MESSAGE")) I $L(MSG)>60 S MSG=$E(MSG,1,58)_"..."
"RTN","PSOREJP0",94,0)
 . S REASON=$S(CODE=88:"DUR:"_$G(REJLST(REJ,"REASON")),1:"79 :REFILL TOO SOON")
"RTN","PSOREJP0",95,0)
 . S Z="",$P(Z,"^")=RX,$P(Z,"^",2)=REJ,$P(Z,"^",3)=RXNUM,$P(Z,"^",4)=PTNAME
"RTN","PSOREJP0",96,0)
 . S $P(Z,"^",5)=$E(DRNAME,1,20),$P(Z,"^",6)=$E(REASON,1,17),$P(Z,"^",7)=MSG
"RTN","PSOREJP0",97,0)
 . S SORT=$S(FIELD="PA":PTNAME,FIELD="DR":DRNAME,FIELD="RX":RXNUM_" ",1:REASON)_RX_REJ
"RTN","PSOREJP0",98,0)
 . S ^TMP("PSOREJSR",$J,SORT)=Z
"RTN","PSOREJP0",99,0)
 Q
"RTN","PSOREJP0",100,0)
 ;
"RTN","PSOREJP0",101,0)
PAT ; Sort by Patient
"RTN","PSOREJP0",102,0)
 D SORT("PA")
"RTN","PSOREJP0",103,0)
 Q
"RTN","PSOREJP0",104,0)
DRG ; Sort by Drug
"RTN","PSOREJP0",105,0)
 D SORT("DR")
"RTN","PSOREJP0",106,0)
 Q
"RTN","PSOREJP0",107,0)
RX ; Sort by Rx
"RTN","PSOREJP0",108,0)
 D SORT("RX")
"RTN","PSOREJP0",109,0)
 Q
"RTN","PSOREJP0",110,0)
REA ; Sort by Reason
"RTN","PSOREJP0",111,0)
 D SORT("RE")
"RTN","PSOREJP0",112,0)
 Q
"RTN","PSOREJP0",113,0)
SORT(FIELD) ; Sort entries by FIELD
"RTN","PSOREJP0",114,0)
 I PSORJSRT=FIELD S PSORJASC=$S(PSORJASC=1:-1,1:1)
"RTN","PSOREJP0",115,0)
 E  S PSORJSRT=FIELD,PSORJASC=1
"RTN","PSOREJP0",116,0)
 D REF
"RTN","PSOREJP0",117,0)
 Q
"RTN","PSOREJP0",118,0)
 ;
"RTN","PSOREJP0",119,0)
REF ; Screen Refresh
"RTN","PSOREJP0",120,0)
 W ?52,"Please wait..." D INIT S VALMBCK="R"
"RTN","PSOREJP0",121,0)
 Q
"RTN","PSOREJP0",122,0)
 ;
"RTN","PSOREJP0",123,0)
SEL ; Process selection of one entry
"RTN","PSOREJP0",124,0)
 N PSOSEL,XQORM,Z,RX,REJ,PSOCHNG
"RTN","PSOREJP0",125,0)
 S PSOSEL=+$P($P(Y(1),"^",4),"=",2) I 'PSOSEL S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOREJP0",126,0)
 S Z=$G(^TMP("PSOREJP0",$J,PSOSEL,"RX"))
"RTN","PSOREJP0",127,0)
 S RX=$P(Z,"^"),REJ=$P(Z,"^",2) I 'RX!'REJ S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOREJP0",128,0)
 S PSOCHNG=0 D EN^PSOREJP1(RX,REJ,.PSOCHNG) I $G(PSOCHNG) D REF
"RTN","PSOREJP0",129,0)
 Q
"RTN","PSOREJP0",130,0)
 ;
"RTN","PSOREJP0",131,0)
EXIT ;
"RTN","PSOREJP0",132,0)
 K ^TMP("PSOREJP0",$J),^TMP("PSOREJSR",$J)
"RTN","PSOREJP0",133,0)
 Q
"RTN","PSOREJP0",134,0)
 ;
"RTN","PSOREJP0",135,0)
HELP Q
"RTN","PSOREJP0",136,0)
 ;
"RTN","PSOREJP0",137,0)
SITES() ; Returns the list of sites along with their NCPDP #s
"RTN","PSOREJP0",138,0)
 N CNT,SITE,SITES,NAME
"RTN","PSOREJP0",139,0)
 I '$D(PSOREJST) Q ""
"RTN","PSOREJP0",140,0)
 I $G(PSOREJST)="ALL" Q "Divisions: ALL"
"RTN","PSOREJP0",141,0)
 S SITE=0 F  S SITE=$O(PSOREJST(SITE)) Q:'SITE  D
"RTN","PSOREJP0",142,0)
 . S NAME=$$GET1^DIQ(59,SITE,.01)
"RTN","PSOREJP0",143,0)
 . S SITES=$G(SITES)_", "_NAME
"RTN","PSOREJP0",144,0)
 S $E(SITES,1,2)="",SITES="Division"_$S($L(SITES,",")>1:"s",1:" ")_": "_SITES
"RTN","PSOREJP0",145,0)
 Q SITES
"RTN","PSOREJP0",146,0)
 ;
"RTN","PSOREJP0",147,0)
DIV(RX,FILL) ; Check if the Division for the Prescription/Fill was selected by the user
"RTN","PSOREJP0",148,0)
 ;
"RTN","PSOREJP0",149,0)
 I $G(PSOREJST)="ALL" Q 1
"RTN","PSOREJP0",150,0)
 I $D(PSOREJST($$RXSITE^PSOBPSUT(RX,FILL))) Q 1
"RTN","PSOREJP0",151,0)
 Q 0
"RTN","PSOREJP0",152,0)
 ;
"RTN","PSOREJP0",153,0)
PTNAME(RX) ; Returns header displayable Patient Name (Last 4 SSN)
"RTN","PSOREJP0",154,0)
 N DFN,VADM,PTNAME
"RTN","PSOREJP0",155,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I") D DEM^VADPT
"RTN","PSOREJP0",156,0)
 S PTNAME=$E($G(VADM(1)),1,18)_"("_$P($P($G(VADM(2)),"^",2),"-",3)_")"
"RTN","PSOREJP0",157,0)
 Q PTNAME
"RTN","PSOREJP0",158,0)
 ;
"RTN","PSOREJP0",159,0)
FILTER(RX,INS) ; - Filter entries based on user's selection
"RTN","PSOREJP0",160,0)
 N FILTER,NAME
"RTN","PSOREJP0",161,0)
 S FILTER=1
"RTN","PSOREJP0",162,0)
 I $G(PSOPTFLT)'="ALL",$D(RX),'$D(PSOPTFLT($$GET1^DIQ(52,RX,2,"I"))) Q FILTER
"RTN","PSOREJP0",163,0)
 I $G(PSODRFLT)'="ALL",$D(RX),'$D(PSODRFLT($$GET1^DIQ(52,RX,6,"I"))) Q FILTER
"RTN","PSOREJP0",164,0)
 I $G(PSOINFLT)'="ALL",$D(INS) D  Q FILTER
"RTN","PSOREJP0",165,0)
 . S NAME="" F  S NAME=$O(PSOINFLT(NAME)) Q:NAME=""  I $$UP^XLFSTR(INS)[$$UP^XLFSTR(NAME) S FILTER=0 Q
"RTN","PSOREJP0",166,0)
 Q 0
"RTN","PSOREJP0",167,0)
 ;
"RTN","PSOREJP0",168,0)
NAME(TYPE) ; - Returns the name if ONE was selected or "MULTIPLE ..."
"RTN","PSOREJP0",169,0)
 N I,CNT
"RTN","PSOREJP0",170,0)
 ;
"RTN","PSOREJP0",171,0)
 I TYPE="P",$O(PSOPTFLT($O(PSOPTFLT(""))))="" Q $$GET1^DIQ(2,$O(PSOPTFLT("")),.01)
"RTN","PSOREJP0",172,0)
 I TYPE="D",$O(PSODRFLT($O(PSODRFLT(""))))="" Q $$GET1^DIQ(50,$O(PSODRFLT("")),.01)
"RTN","PSOREJP0",173,0)
 I TYPE="I",$O(PSOINFLT($O(PSOINFLT(""))))="" Q $O(PSOINFLT(""))
"RTN","PSOREJP0",174,0)
 I TYPE="R" Q $$GET1^DIQ(52,PSORXFLT,.01)
"RTN","PSOREJP0",175,0)
 Q "MULTIPLE "_$S(TYPE="P":"PATIENTS",TYPE="D":"DRUGS",1:"INSURANCE COMPANIES")
"RTN","PSOREJP1")
0^49^B53365466
"RTN","PSOREJP1",1,0)
PSOREJP1 ;BIRM/MFR - Third Party Reject Display Screen ;04/29/05
"RTN","PSOREJP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOREJP1",3,0)
 ;Reference to File 9002313.93 - BPS NCPDP REJECT CODES supported by DBIA 4720
"RTN","PSOREJP1",4,0)
 ;
"RTN","PSOREJP1",5,0)
EN(RX,REJ,CHANGE) ; Entry point
"RTN","PSOREJP1",6,0)
 ;
"RTN","PSOREJP1",7,0)
 ; - DO NOT change the IF logic below as both of them might get executed (intentional)
"RTN","PSOREJP1",8,0)
 S FILL=+$$GET1^DIQ(52.25,REJ_","_RX,5)
"RTN","PSOREJP1",9,0)
 I $$CLOSED(RX,REJ) D EN^VALM("PSO REJECT DISPLAY - RESOLVED")
"RTN","PSOREJP1",10,0)
 I '$$CLOSED(RX,REJ) D EN^VALM("PSO REJECT DISPLAY")
"RTN","PSOREJP1",11,0)
 D FULL^VALM1
"RTN","PSOREJP1",12,0)
 Q
"RTN","PSOREJP1",13,0)
 ;
"RTN","PSOREJP1",14,0)
HDR      ; - Builds the Header section
"RTN","PSOREJP1",15,0)
 N LINE1,LINE2,X
"RTN","PSOREJP1",16,0)
 S VALMHDR(1)=$$DVINFO^PSOREJU2(RX,FILL,1),VALMHDR(2)=$$PTINFO^PSOREJU2(RX,1)
"RTN","PSOREJP1",17,0)
 S VALMHDR(3)=$$RXINFO(RX,FILL,1),VALMHDR(4)=$$RXINFO(RX,FILL,2)
"RTN","PSOREJP1",18,0)
 Q
"RTN","PSOREJP1",19,0)
 ;
"RTN","PSOREJP1",20,0)
INIT ; Builds the Body  section
"RTN","PSOREJP1",21,0)
 N DATA,LINE
"RTN","PSOREJP1",22,0)
 K ^TMP("PSOREJP1",$J) S VALMCNT=0,LINE=0
"RTN","PSOREJP1",23,0)
 D GET^PSOREJU2(RX,FILL,.DATA,REJ,1)
"RTN","PSOREJP1",24,0)
 D REJ                   ; Display the REJECT Information
"RTN","PSOREJP1",25,0)
 D OTH                   ; Display the Other Rejects Information
"RTN","PSOREJP1",26,0)
 D INS                   ; Display the Insurance Information
"RTN","PSOREJP1",27,0)
 D CLS                   ; Display the Resolution Information
"RTN","PSOREJP1",28,0)
 S VALMCNT=LINE
"RTN","PSOREJP1",29,0)
 Q
"RTN","PSOREJP1",30,0)
 ;
"RTN","PSOREJP1",31,0)
REJ ; - DUR Information
"RTN","PSOREJP1",32,0)
 N TYPE,PFLDT
"RTN","PSOREJP1",33,0)
 D SETLN("REJECT Information",1,1)
"RTN","PSOREJP1",34,0)
 S TYPE=$S($G(DATA(REJ,"CODE"))=79:"79 - REFILL TOO SOON",1:"88 - DUR REJECT")
"RTN","PSOREJP1",35,0)
 D SETLN("Reject Type   : "_TYPE_" received on "_$$FMTE^XLFDT($G(DATA(REJ,"DATE/TIME"))),,,17)
"RTN","PSOREJP1",36,0)
 D SETLN("Reject Status : "_$G(DATA(REJ,"STATUS")),,,17)
"RTN","PSOREJP1",37,0)
 D SET("PAYER MESSAGE",64)
"RTN","PSOREJP1",38,0)
 D SET("REASON",64)
"RTN","PSOREJP1",39,0)
 S PFLDT=$$FMTE^XLFDT($G(DATA(REJ,"PLAN PREVIOUS FILL DATE")))
"RTN","PSOREJP1",40,0)
 D SET("DUR TEXT",64,$S(PFLDT="":1,1:0))
"RTN","PSOREJP1",41,0)
 I PFLDT'="" D SETLN("Last Fill Date: "_PFLDT_" (from payer)",,1,17)
"RTN","PSOREJP1",42,0)
 Q
"RTN","PSOREJP1",43,0)
 ;
"RTN","PSOREJP1",44,0)
OTH ; - Other Rejects Information
"RTN","PSOREJP1",45,0)
 N LST,I,RJC,J,LAST
"RTN","PSOREJP1",46,0)
 S LST=$G(DATA(REJ,"OTHER REJECTS")) I LST="" Q
"RTN","PSOREJP1",47,0)
 D SETLN()
"RTN","PSOREJP1",48,0)
 D SETLN("OTHER REJECTS",1,1)
"RTN","PSOREJP1",49,0)
 F I=1:1:$L(LST,",") S RJC=$P(LST,",",I) D
"RTN","PSOREJP1",50,0)
 . S LAST=1 F J=(I+1):1:$L(LST,",") I $P(LST,",",J)'="" S LAST=0 Q
"RTN","PSOREJP1",51,0)
 . I RJC'="" D SETLN(RJC_" - "_$$EXP(RJC),,$S(LAST:1,1:0),6)
"RTN","PSOREJP1",52,0)
 Q
"RTN","PSOREJP1",53,0)
 ;
"RTN","PSOREJP1",54,0)
INS ; - Insurance Information
"RTN","PSOREJP1",55,0)
 D SETLN()
"RTN","PSOREJP1",56,0)
 D SETLN("INSURANCE Information",1,1)
"RTN","PSOREJP1",57,0)
 D SETLN("Insurance     : "_$G(DATA(REJ,"INSURANCE NAME")),,,17)
"RTN","PSOREJP1",58,0)
 D SETLN("Contact       : "_$G(DATA(REJ,"PLAN CONTACT")),,,17)
"RTN","PSOREJP1",59,0)
 D SETLN("Group Name    : "_$G(DATA(REJ,"GROUP NAME")),,,17)
"RTN","PSOREJP1",60,0)
 D SETLN("Group Number  : "_$G(DATA(REJ,"GROUP NUMBER")),,,17)
"RTN","PSOREJP1",61,0)
 D SETLN("Cardholder ID : "_$G(DATA(REJ,"CARDHOLDER ID")),,1,17)
"RTN","PSOREJP1",62,0)
 Q
"RTN","PSOREJP1",63,0)
 ;
"RTN","PSOREJP1",64,0)
CLS ; - Resolution Information
"RTN","PSOREJP1",65,0)
 I '$$CLOSED(RX,REJ) Q
"RTN","PSOREJP1",66,0)
 D SETLN()
"RTN","PSOREJP1",67,0)
 D SETLN("RESOLUTION Information",1,1)
"RTN","PSOREJP1",68,0)
 D SETLN("Resolved By   : "_$G(DATA(REJ,"CLOSED BY")),,,17)
"RTN","PSOREJP1",69,0)
 D SETLN("Date/Time     : "_$G(DATA(REJ,"CLOSED DATE/TIME")),,,17)
"RTN","PSOREJP1",70,0)
 I $G(DATA(REJ,"CLOSE COMMENTS"))'="" D SET("CLOSE COMMENTS",64)
"RTN","PSOREJP1",71,0)
 I $G(DATA(REJ,"COD1"))'="" D SETLN("Reason for Svc: "_$$OVRX^PSOREJU1(1,$G(DATA(REJ,"COD1"))),,,17)
"RTN","PSOREJP1",72,0)
 I $G(DATA(REJ,"COD2"))'="" D SETLN("Profes. Svc   : "_$$OVRX^PSOREJU1(2,$G(DATA(REJ,"COD2"))),,,17)
"RTN","PSOREJP1",73,0)
 I $G(DATA(REJ,"COD3"))'="" D SETLN("Result of Svc : "_$$OVRX^PSOREJU1(3,$G(DATA(REJ,"COD3"))),,,17)
"RTN","PSOREJP1",74,0)
 D SETLN("Reason        : "_$G(DATA(REJ,"CLOSE REASON")),,1,17)
"RTN","PSOREJP1",75,0)
 Q
"RTN","PSOREJP1",76,0)
 ;
"RTN","PSOREJP1",77,0)
SET(FIELD,L,UND) ; Sets the lines for fields that require text wrapping
"RTN","PSOREJP1",78,0)
 N TXT,T
"RTN","PSOREJP1",79,0)
 S TXT=DATA(REJ,FIELD) I $L(TXT)'>L D SETLN($$LABEL(FIELD)_TXT,,$S($G(UND):1,1:0),80-L) Q
"RTN","PSOREJP1",80,0)
 F I=1:1 Q:TXT=""  D
"RTN","PSOREJP1",81,0)
 . I I=1 D SETLN($$LABEL(FIELD)_$E(TXT,1,L),,,80-L) S TXT=$E(TXT,L+1,999) Q
"RTN","PSOREJP1",82,0)
 . S T="",$E(T,81-L)=$E(TXT,1,L) D SETLN(T,,$S($E(TXT,L+1,999)=""&$G(UND):1,1:0),80-L) S TXT=$E(TXT,L+1,999)
"RTN","PSOREJP1",83,0)
 Q
"RTN","PSOREJP1",84,0)
 ;
"RTN","PSOREJP1",85,0)
LABEL(FIELD) ; Sets the label for the field
"RTN","PSOREJP1",86,0)
 I FIELD="REASON" Q "Reason        : "
"RTN","PSOREJP1",87,0)
 I FIELD="PAYER MESSAGE" Q "Payer Message : "
"RTN","PSOREJP1",88,0)
 I FIELD="DUR TEXT" Q "DUR Text      : "
"RTN","PSOREJP1",89,0)
 I FIELD="CLOSE COMMENTS" Q "Comments      : "
"RTN","PSOREJP1",90,0)
 Q ""
"RTN","PSOREJP1",91,0)
 ;
"RTN","PSOREJP1",92,0)
VIEW ; - Rx View hidden action
"RTN","PSOREJP1",93,0)
 N VALMCNT,TITLE
"RTN","PSOREJP1",94,0)
 I $G(PSOBACK) D  Q
"RTN","PSOREJP1",95,0)
 . S VALMSG="Not available through Backdoor!",VALMBCK="R"
"RTN","PSOREJP1",96,0)
 S TITLE=VALM("TITLE")
"RTN","PSOREJP1",97,0)
 ;
"RTN","PSOREJP1",98,0)
 ; - DO structure used to avoid losing variables RX,FILL,REJ,LINE,TITLE
"RTN","PSOREJP1",99,0)
 DO
"RTN","PSOREJP1",100,0)
 . N PSOVDA,DA,PS
"RTN","PSOREJP1",101,0)
 . S (PSOVDA,DA)=RX,PS="REJECT"
"RTN","PSOREJP1",102,0)
 . N RX,REJ,FILL,LINE,TITLE D DP^PSORXVW
"RTN","PSOREJP1",103,0)
 ;
"RTN","PSOREJP1",104,0)
 S VALMBCK="R",VALM("TITLE")=TITLE
"RTN","PSOREJP1",105,0)
 Q
"RTN","PSOREJP1",106,0)
 ;
"RTN","PSOREJP1",107,0)
EDT ; - Rx Edit hidden action
"RTN","PSOREJP1",108,0)
 N VALMCNT,TITLE
"RTN","PSOREJP1",109,0)
 I $G(PSOBACK) D  Q
"RTN","PSOREJP1",110,0)
 . S VALMSG="Not available through Backdoor!",VALMBCK="R"
"RTN","PSOREJP1",111,0)
 S TITLE=VALM("TITLE")
"RTN","PSOREJP1",112,0)
 ;
"RTN","PSOREJP1",113,0)
 ; - DO structure used to avoid losing variables RX,FILL,REJ,LINE,TITLE
"RTN","PSOREJP1",114,0)
 DO
"RTN","PSOREJP1",115,0)
 . N PSOSITE,ORN,PSOPAR,PSOLIST
"RTN","PSOREJP1",116,0)
 . S PSOSITE=$$RXSITE^PSOBPSUT(RX,FILL),ORN=RX
"RTN","PSOREJP1",117,0)
 . S PSOPAR=$G(^PS(59,PSOSITE,1)),PSOLIST(1)=ORN_","
"RTN","PSOREJP1",118,0)
 . N RX,REJ,FILL,LINE,TITLE D EPH^PSORXEDT
"RTN","PSOREJP1",119,0)
 ;
"RTN","PSOREJP1",120,0)
 K VALMBCK I $$CLOSED(RX,REJ),$D(PSOSTFLT),PSOSTFLT'="B" S CHANGE=1 Q
"RTN","PSOREJP1",121,0)
 S VALMBCK="R",VALM("TITLE")=TITLE
"RTN","PSOREJP1",122,0)
 Q
"RTN","PSOREJP1",123,0)
 ;
"RTN","PSOREJP1",124,0)
OVR ; - Override a REJECT action
"RTN","PSOREJP1",125,0)
 I $$CLOSED(RX,REJ) D  Q
"RTN","PSOREJP1",126,0)
 . S VALMSG="This Reject is marked resolved!",VALMBCK="R" W $C(7)
"RTN","PSOREJP1",127,0)
 I $$GET1^DIQ(52.25,REJ_","_RX,.01)'=88 D  Q
"RTN","PSOREJP1",128,0)
 . S VALMSG="Only DUR rejects can be overriden!",VALMBCK="R" W $C(7)
"RTN","PSOREJP1",129,0)
 N COD1,COD2,COD3
"RTN","PSOREJP1",130,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",131,0)
 S COD1=$$OVRCOD^PSOREJU1(1,$$GET1^DIQ(52.25,REJ_","_RX,14)) I COD1="^" S VALMBCK="R" Q
"RTN","PSOREJP1",132,0)
 S COD2=$$OVRCOD^PSOREJU1(2) I COD2="^" S VALMBCK="R" Q
"RTN","PSOREJP1",133,0)
 S COD3=$$OVRCOD^PSOREJU1(3) I COD3="^" S VALMBCK="R" Q
"RTN","PSOREJP1",134,0)
 ;
"RTN","PSOREJP1",135,0)
 D OVRDSP^PSOREJU1(COD1_"^"_COD2_"^"_COD3)
"RTN","PSOREJP1",136,0)
 ;
"RTN","PSOREJP1",137,0)
RES ; - Re-submit a claim action
"RTN","PSOREJP1",138,0)
 I $$CLOSED(RX,REJ) D  Q
"RTN","PSOREJP1",139,0)
 . S VALMSG="This Reject is marked resolved!",VALMBCK="R"
"RTN","PSOREJP1",140,0)
 N DIR,OVRC,RESP
"RTN","PSOREJP1",141,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",142,0)
 S DIR(0)="Y",DIR("A")="     Confirm? ",DIR("B")="YES"
"RTN","PSOREJP1",143,0)
 S DIR("A",1)="     When you confirm, a new claim will be submitted for"
"RTN","PSOREJP1",144,0)
 S DIR("A",2)="     the prescription and this REJECT will be marked"
"RTN","PSOREJP1",145,0)
 S DIR("A",3)="     resolved."
"RTN","PSOREJP1",146,0)
 S DIR("A",4)=" "
"RTN","PSOREJP1",147,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" Q
"RTN","PSOREJP1",148,0)
 D CLOSE^PSOREJUT(RX,FILL,REJ,DUZ,1,,$G(COD1),$G(COD2),$G(COD3))
"RTN","PSOREJP1",149,0)
 I $G(COD1)'="" S OVRC=$G(COD1)_"^"_$G(COD2)_"^"_$G(COD3)
"RTN","PSOREJP1",150,0)
 D ECMESND^PSOBPSU1(RX,FILL,,"ED",$$GETNDC^PSONDCUT(RX,FILL),,,$G(OVRC),,.RESP,,"REJECT WORKLIST RESUBMISSION")
"RTN","PSOREJP1",151,0)
 I $G(RESP) D  Q
"RTN","PSOREJP1",152,0)
 . W !!?10,"Claim could not be submitted. Please try again later!"
"RTN","PSOREJP1",153,0)
 . W !,?10,"Reason: ",$S($P(RESP,"^",2)="":"UNKNOWN",1:$P(RESP,"^",2)),$C(7) H 2
"RTN","PSOREJP1",154,0)
 I $D(PSOSTFLT),PSOSTFLT'="B" S CHANGE=1
"RTN","PSOREJP1",155,0)
 Q
"RTN","PSOREJP1",156,0)
 ;
"RTN","PSOREJP1",157,0)
EXIT ;
"RTN","PSOREJP1",158,0)
 K ^TMP("PSOREJP1",$J)
"RTN","PSOREJP1",159,0)
 Q
"RTN","PSOREJP1",160,0)
 ;
"RTN","PSOREJP1",161,0)
SETLN(TEXT,REV,UND,HIG) ; Sets a line to be displayed in the Body section
"RTN","PSOREJP1",162,0)
 N X
"RTN","PSOREJP1",163,0)
 S:$G(TEXT)="" $E(TEXT,80)=""
"RTN","PSOREJP1",164,0)
 S:$L(TEXT)>80 TEXT=$E(TEXT,1,80)
"RTN","PSOREJP1",165,0)
 S LINE=LINE+1,^TMP("PSOREJP1",$J,LINE,0)=$G(TEXT)
"RTN","PSOREJP1",166,0)
 ;
"RTN","PSOREJP1",167,0)
 I $G(REV) D  Q
"RTN","PSOREJP1",168,0)
 . D CNTRL^VALM10(LINE,1,$L(TEXT),IORVON,IOINORM)
"RTN","PSOREJP1",169,0)
 . I $G(UND) D CNTRL^VALM10(LINE,$L(TEXT)+1,80,IOUON,IOINORM)
"RTN","PSOREJP1",170,0)
 I $G(UND) D CNTRL^VALM10(LINE,1,80,IOUON,IOINORM)
"RTN","PSOREJP1",171,0)
 I $G(HIG) D
"RTN","PSOREJP1",172,0)
 . D CNTRL^VALM10(LINE,HIG,80,IOINHI,IOINORM)
"RTN","PSOREJP1",173,0)
 Q
"RTN","PSOREJP1",174,0)
HELP ;
"RTN","PSOREJP1",175,0)
 Q
"RTN","PSOREJP1",176,0)
 ;
"RTN","PSOREJP1",177,0)
RXINFO(RX,FILL,LINE) ; Returns header displayable Rx Information
"RTN","PSOREJP1",178,0)
 N TXT,RXINFO,LBL,CMOP,DRG
"RTN","PSOREJP1",179,0)
 I LINE=1 D
"RTN","PSOREJP1",180,0)
 . S RXINFO="Rx#      : "_$$GET1^DIQ(52,RX,.01)_"/"_FILL
"RTN","PSOREJP1",181,0)
 . S $E(RXINFO,30)="ECME#: "_$E(10000000+RX,2,8)
"RTN","PSOREJP1",182,0)
 . S $E(RXINFO,55)="Fill Date: "_$$FMTE^XLFDT($$RXFLDT^PSOBPSUT(RX,FILL))
"RTN","PSOREJP1",183,0)
 I LINE=2 D
"RTN","PSOREJP1",184,0)
 . S DRG=$$GET1^DIQ(52,RX,6,"I"),CMOP=$S($D(^PSDRUG("AQ",DRG)):1,1:0)
"RTN","PSOREJP1",185,0)
 . S RXINFO=$S(CMOP:"CMOP ",1:"")_"Drug",$E(RXINFO,10)=": "_$E($$GET1^DIQ(52,RX,6),1,43)
"RTN","PSOREJP1",186,0)
 . S $E(RXINFO,56)="NDC Code: "_$$GETNDC^PSONDCUT(RX,FILL)
"RTN","PSOREJP1",187,0)
 Q $G(RXINFO)
"RTN","PSOREJP1",188,0)
 ;
"RTN","PSOREJP1",189,0)
CLOSED(RX,REJ) ; Returns whether the REJECT is RESOLVED or NOT
"RTN","PSOREJP1",190,0)
 Q $S($$GET1^DIQ(52.25,REJ_","_RX,10)="":0,1:1)
"RTN","PSOREJP1",191,0)
 ;
"RTN","PSOREJP1",192,0)
REOPN(RX,REJ) ; Returns whether the REJECT was RE-OPENED or NOT
"RTN","PSOREJP1",193,0)
 Q $S($$GET1^DIQ(52.25,REJ_","_RX,23)="":0,1:1)
"RTN","PSOREJP1",194,0)
 ;
"RTN","PSOREJP1",195,0)
EXP(CODE) ; - Returns the explanation field (.02) for a reject code
"RTN","PSOREJP1",196,0)
 ; Input:  (r) CODE - .01 field (Code) value from file 9002313.93
"RTN","PSOREJP1",197,0)
 ; Output: .02 field (Explanation) value from file 9002313.93
"RTN","PSOREJP1",198,0)
 N DIC,X,Y
"RTN","PSOREJP1",199,0)
 S DIC=9002313.93,DIC(0)="Z",X=CODE D ^DIC
"RTN","PSOREJP1",200,0)
 Q $P($G(Y(0)),"^",2)
"RTN","PSOREJP1",201,0)
 ;
"RTN","PSOREJP1",202,0)
OUT(RX) ; - Supported call by outside PROTOCOLs to act on specific REJECTs
"RTN","PSOREJP1",203,0)
 N I,RFL,DATA,REJ,PSOBACK,VALMCNT
"RTN","PSOREJP1",204,0)
 S PSOBACK=1
"RTN","PSOREJP1",205,0)
 S (RFL,I)=0 F I=1:1 Q:'$D(^PSRX(RX,1,I))  S RFL=I
"RTN","PSOREJP1",206,0)
 S X=$$FIND^PSOREJUT(RX,RFL,.DATA) S REJ=$O(DATA(""))
"RTN","PSOREJP1",207,0)
 I '$G(REJ) S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOREJP1",208,0)
 D EN(RX,REJ) S VALMBCK="R"
"RTN","PSOREJP1",209,0)
 Q
"RTN","PSOREJP2")
0^61^B42289795
"RTN","PSOREJP2",1,0)
PSOREJP2 ;BIRM/MFR - Third Party Rejects View/Process ;04/28/05
"RTN","PSOREJP2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOREJP2",3,0)
 ;Reference to ^PSSLOCK   supported by DBIA #2789
"RTN","PSOREJP2",4,0)
 ; 
"RTN","PSOREJP2",5,0)
 N PSORJSRT,PSOPTFLT,PSODRFLT,PSORXFLT,PSOBYFLD,PSOSTFLT,DIR,DIRUT,DUOUT,DTOUT
"RTN","PSOREJP2",6,0)
 N PSOINFLT
"RTN","PSOREJP2",7,0)
 S PSORJASC=1
"RTN","PSOREJP2",8,0)
 ;
"RTN","PSOREJP2",9,0)
 ; - Division/Site selection
"RTN","PSOREJP2",10,0)
 D SEL^PSOREJU1("DIVISION","^PS(59,",.PSOREJST) I $G(PSOREJST)="^" G EXIT
"RTN","PSOREJP2",11,0)
 ;
"RTN","PSOREJP2",12,0)
SEL ; - Field Selection (Patient/Drug/Rx)
"RTN","PSOREJP2",13,0)
 S DIR(0)="S^P:PATIENT;D:DRUG;R:Rx;I:INSURANCE",DIR("B")="P"
"RTN","PSOREJP2",14,0)
 S DIR("A")="By (P)atient, (D)rug, (R)x or (I)nsurance" D ^DIR I $D(DIRUT) G EXIT
"RTN","PSOREJP2",15,0)
 S PSOBYFLD=Y,DIR("B")=""
"RTN","PSOREJP2",16,0)
 ;
"RTN","PSOREJP2",17,0)
 I PSOBYFLD="P" D  I $G(PSOPTFLT)="^" G SEL
"RTN","PSOREJP2",18,0)
 . S (PSODRFLT,PSORXFLT,PSOINFLT)="ALL",PSORJSRT="DR"
"RTN","PSOREJP2",19,0)
 . D SEL^PSOREJU1("PATIENT","^DPT(",.PSOPTFLT)
"RTN","PSOREJP2",20,0)
 ;
"RTN","PSOREJP2",21,0)
 I PSOBYFLD="D" D  I $G(PSODRFLT)="^" G SEL
"RTN","PSOREJP2",22,0)
 . S (PSOPTFLT,PSORXFLT,PSOINFLT)="ALL",PSORJSRT="PA"
"RTN","PSOREJP2",23,0)
 . D SEL^PSOREJU1("DRUG","^PSDRUG(",.PSODRFLT)
"RTN","PSOREJP2",24,0)
 ;
"RTN","PSOREJP2",25,0)
 I PSOBYFLD="R" D  I $D(DUOUT)!$D(DTOUT)!'$G(PSORXFLT) G SEL
"RTN","PSOREJP2",26,0)
 . S (PSOPTFLT,PSODRFLT,PSOINFLT)="ALL",PSORJSRT="PA"
"RTN","PSOREJP2",27,0)
 . N DIC,Y,X,OK K PSOSTFLT,PSORXFLT
"RTN","PSOREJP2",28,0)
 . S DIC=52,DIC(0)="QEZA",DIC("A")="PRESCRIPTION: "
"RTN","PSOREJP2",29,0)
 . F  W ! D ^DIC D  Q:$G(OK) 
"RTN","PSOREJP2",30,0)
 . . I $D(DUOUT)!$D(DTOUT)!(X="") S OK=1 Q
"RTN","PSOREJP2",31,0)
 . . I '$O(^PSRX(+Y,"REJ",0)) D  Q
"RTN","PSOREJP2",32,0)
 . . . W !?40,"Prescription does not have rejects!",$C(7)
"RTN","PSOREJP2",33,0)
 . . S PSORXFLT=+Y,OK=1
"RTN","PSOREJP2",34,0)
 ;
"RTN","PSOREJP2",35,0)
 I PSOBYFLD="I" D  I $O(PSOINFLT(""))="" G SEL
"RTN","PSOREJP2",36,0)
 . S (PSOPTFLT,PSODRFLT,PSORXFLT)="ALL",PSORJSRT="PA"
"RTN","PSOREJP2",37,0)
 . N DIR,Y,X,OK K PSOINFLT W !
"RTN","PSOREJP2",38,0)
 . S DIR("A",1)="Enter the whole or part of the Insurance Company"
"RTN","PSOREJP2",39,0)
 . S DIR("A",2)="name for which you want to view/process REJECTS."
"RTN","PSOREJP2",40,0)
 . S DIR("A",3)=""
"RTN","PSOREJP2",41,0)
 . S DIR(0)="FO^3:30",DIR("A")="  INSURANCE"
"RTN","PSOREJP2",42,0)
 . F  D ^DIR D  Q:$G(OK) 
"RTN","PSOREJP2",43,0)
 . . I $D(DIRUT)!(X="") S OK=1 Q
"RTN","PSOREJP2",44,0)
 . . S PSOINFLT(X)="" K DIR("A") S DIR("A")="ANOTHER ONE"
"RTN","PSOREJP2",45,0)
 ;
"RTN","PSOREJP2",46,0)
 ; - Status Selection (UNRESOLVED or RESOLVED)
"RTN","PSOREJP2",47,0)
 I $G(PSOSTFLT)="" D  I $D(DIRUT) G EXIT
"RTN","PSOREJP2",48,0)
 . S DIR(0)="S^U:UNRESOLVED;R:RESOLVED;B:BOTH",DIR("B")="B"
"RTN","PSOREJP2",49,0)
 . S DIR("A")="(U)NRESOLVED, (R)RESOLVED or (B)OTH REJECT statuses" D ^DIR
"RTN","PSOREJP2",50,0)
 . S PSOSTFLT=Y
"RTN","PSOREJP2",51,0)
 ;
"RTN","PSOREJP2",52,0)
 D LST^PSOREJP0
"RTN","PSOREJP2",53,0)
 ;
"RTN","PSOREJP2",54,0)
EXIT Q
"RTN","PSOREJP2",55,0)
 ;
"RTN","PSOREJP2",56,0)
CLO      ; - Ignore a REJECT hidden action
"RTN","PSOREJP2",57,0)
 I $$CLOSED^PSOREJP1(RX,REJ) D  Q
"RTN","PSOREJP2",58,0)
 . S VALMSG="This Reject is marked resolved!",VALMBCK="R"
"RTN","PSOREJP2",59,0)
 N DIR,COM
"RTN","PSOREJP2",60,0)
 D FULL^VALM1
"RTN","PSOREJP2",61,0)
 I '$$SIG^PSOREJU1() S VALMBCK="R" Q
"RTN","PSOREJP2",62,0)
 W !
"RTN","PSOREJP2",63,0)
 S COM=$$COM^PSOREJU1() I COM="^" S VALMBCK="R" Q
"RTN","PSOREJP2",64,0)
 W !
"RTN","PSOREJP2",65,0)
 S DIR(0)="Y",DIR("A")="     Confirm? ",DIR("B")="NO"
"RTN","PSOREJP2",66,0)
 S DIR("A",1)="     When you confirm this REJECT will be marked RESOLVED."
"RTN","PSOREJP2",67,0)
 S DIR("A",2)=" "
"RTN","PSOREJP2",68,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" Q
"RTN","PSOREJP2",69,0)
 W ?40,"[Closing..." D CLOSE^PSOREJUT(RX,FILL,REJ,DUZ,6,COM) W "OK]",!,$C(7) H 1
"RTN","PSOREJP2",70,0)
 I $D(PSOSTFLT),PSOSTFLT'="B" S CHANGE=1
"RTN","PSOREJP2",71,0)
 Q
"RTN","PSOREJP2",72,0)
 ;
"RTN","PSOREJP2",73,0)
OPN ; - Re-open a Closed/Resolved Reject
"RTN","PSOREJP2",74,0)
 I '$$CLOSED^PSOREJP1(RX,REJ) D  Q
"RTN","PSOREJP2",75,0)
 . S VALMSG="This Reject is NOT marked resolved!",VALMBCK="R"
"RTN","PSOREJP2",76,0)
 N DIR,COM,REJDATA,NEWDATA
"RTN","PSOREJP2",77,0)
 D FULL^VALM1
"RTN","PSOREJP2",78,0)
 I '$$SIG^PSOREJU1() S VALMBCK="R" Q
"RTN","PSOREJP2",79,0)
 W !
"RTN","PSOREJP2",80,0)
 S DIR(0)="Y",DIR("A")="     Confirm? ",DIR("B")="NO"
"RTN","PSOREJP2",81,0)
 S DIR("A",1)="     When you confirm this REJECT will be marked UNRESOLVED."
"RTN","PSOREJP2",82,0)
 S DIR("A",2)=" "
"RTN","PSOREJP2",83,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" Q
"RTN","PSOREJP2",84,0)
 ;
"RTN","PSOREJP2",85,0)
 W ?40,"[Re-opening..."
"RTN","PSOREJP2",86,0)
 K REJDATA D GET^PSOREJU2(RX,FILL,.REJDATA,REJ,1) D SETOPN^PSOREJU2(RX,REJ)
"RTN","PSOREJP2",87,0)
 K NEWDATA M NEWDATA=REJDATA(REJ) S NEWDATA("PHARMACIST")=DUZ
"RTN","PSOREJP2",88,0)
 D SAVE^PSOREJUT(RX,FILL,.NEWDATA),RETRXF^PSOREJU2(RX,FILL,0)
"RTN","PSOREJP2",89,0)
 W "OK]",!,$C(7) H 1
"RTN","PSOREJP2",90,0)
 S CHANGE=1
"RTN","PSOREJP2",91,0)
 Q
"RTN","PSOREJP2",92,0)
 ;
"RTN","PSOREJP2",93,0)
CHG ; - Change Suspense Date action
"RTN","PSOREJP2",94,0)
 I $$CLOSED^PSOREJP1(RX,REJ) D  Q
"RTN","PSOREJP2",95,0)
 . S VALMSG="This Reject is marked resolved!",VALMBCK="R" W $C(7)
"RTN","PSOREJP2",96,0)
 ;
"RTN","PSOREJP2",97,0)
 N SUSDT,PSOMSG,Y,SUSRX,%DT,DA,DIE,DR,ISSDT,EXPDT,PSOMSG
"RTN","PSOREJP2",98,0)
 ;
"RTN","PSOREJP2",99,0)
 S RFL=+$$GET1^DIQ(52.25,REJ_","_RX,5),SUSDT=$$RXSUDT^PSOBPSUT(RX,RFL)
"RTN","PSOREJP2",100,0)
 I SUSDT="" S VALMSG="Prescription is not suspended!",VALMBCK="R" W $C(7) Q
"RTN","PSOREJP2",101,0)
 I $$RXRLDT^PSOBPSUT(RX,RFL) S VALMSG="Prescription has been released already!",VALMBCK="R" W $C(7) Q
"RTN","PSOREJP2",102,0)
 D PSOL^PSSLOCK(RX) I '$G(PSOMSG) S VALMSG=$P(PSOMSG,"^",2),VALMBCK="R" W $C(7) Q
"RTN","PSOREJP2",103,0)
 ;
"RTN","PSOREJP2",104,0)
 S ISSDT=$$GET1^DIQ(52,RX,1,"I"),EXPDT=$$GET1^DIQ(52,RX,26,"I")
"RTN","PSOREJP2",105,0)
 S SUSRX=$O(^PS(52.5,"B",RX,0))
"RTN","PSOREJP2",106,0)
 ;
"RTN","PSOREJP2",107,0)
SUDT ; Asks for the new Suspense Date
"RTN","PSOREJP2",108,0)
 D FULL^VALM1 S %DT("B")=$$FMTE^XLFDT(SUSDT),%DT="EA",%DT("A")="SUSPENSE DATE: "
"RTN","PSOREJP2",109,0)
 W ! D ^%DT I Y<0!($D(DTOUT)) D PSOUL^PSSLOCK(RX) S VALMBCK="R" Q
"RTN","PSOREJP2",110,0)
 I Y<ISSDT D  G SUDT
"RTN","PSOREJP2",111,0)
 . W !!?5,"Suspense Date cannot be before Issue Date: ",$$FMTE^XLFDT(ISSDT),$C(7)
"RTN","PSOREJP2",112,0)
 I Y>EXPDT D  G SUDT
"RTN","PSOREJP2",113,0)
 . W !!?5,"Suspense Date cannot be after Expiration Date: ",$$FMTE^XLFDT(EXPDT),$C(7)
"RTN","PSOREJP2",114,0)
 S SUSDT=Y
"RTN","PSOREJP2",115,0)
 ;
"RTN","PSOREJP2",116,0)
 N DIR,DIRUT W !
"RTN","PSOREJP2",117,0)
 S DIR("A",1)="     When you confirm, this REJECT will be marked resolved. A"
"RTN","PSOREJP2",118,0)
 S DIR("A",2)="     new claim will be re-submitted to the 3rd party payer"
"RTN","PSOREJP2",119,0)
 I $$GET1^DIQ(52.5,SUSRX,3)="" D
"RTN","PSOREJP2",120,0)
 . I SUSDT>DT D
"RTN","PSOREJP2",121,0)
 . . S DIR("A",3)="     when the prescription label for this fill is printed"
"RTN","PSOREJP2",122,0)
 . . S DIR("A",4)="     from suspense on "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",123,0)
 . . S DIR("A",5)=" "
"RTN","PSOREJP2",124,0)
 . . S DIR("A",6)="     Note: THE LABEL FOR THIS PRESCRIPTION FILL WILL NOT BE"
"RTN","PSOREJP2",125,0)
 . . S DIR("A",7)="           PRINTED LOCAL FROM SUSPENSE BEFORE "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",126,0)
 . E  D
"RTN","PSOREJP2",127,0)
 . . S DIR("A",3)="     the next time local labels are printed from suspense."
"RTN","PSOREJP2",128,0)
 E  D
"RTN","PSOREJP2",129,0)
 . I SUSDT>DT D
"RTN","PSOREJP2",130,0)
 . . S DIR("A",3)="     when the prescription is transmitted to CMOP on "
"RTN","PSOREJP2",131,0)
 . . S DIR("A",4)="     "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",132,0)
 . . S DIR("A",5)=" "
"RTN","PSOREJP2",133,0)
 . . S DIR("A",6)="     Note: THIS PRESCRIPTION FILL WILL NOT BE TRANSMITTED TO"
"RTN","PSOREJP2",134,0)
 . . S DIR("A",7)="           CMOP BEFORE "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",135,0)
 . E  D
"RTN","PSOREJP2",136,0)
 . . S DIR("A",3)="     when this prescription fill is transmitted to CMOP on"
"RTN","PSOREJP2",137,0)
 . . S DIR("A",4)="     the next CMOP transmission."
"RTN","PSOREJP2",138,0)
    ;
"RTN","PSOREJP2",139,0)
 S DIR("A",$O(DIR("A",""),-1)+1)=" "
"RTN","PSOREJP2",140,0)
 S DIR(0)="Y",DIR("A")="     Confirm? ",DIR("B")="YES"
"RTN","PSOREJP2",141,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" D PSOUL^PSSLOCK(RX) Q
"RTN","PSOREJP2",142,0)
 ;
"RTN","PSOREJP2",143,0)
 ; - Suspense/Fill Date updates
"RTN","PSOREJP2",144,0)
 I SUSDT'=$$RXSUDT^PSOBPSUT(RX,RFL) D
"RTN","PSOREJP2",145,0)
 . N DA,DIE,DR,PSOX,SFN,INDT,DEAD
"RTN","PSOREJP2",146,0)
 . S DA=SUSRX,DIE="^PS(52.5,",DR=".02///"_SUSDT D ^DIE
"RTN","PSOREJP2",147,0)
 . S SFN=SUSRX,DEAD=0,INDT=SUSDT D CHANGE^PSOSUCH1(RX,RFL)
"RTN","PSOREJP2",148,0)
 ;
"RTN","PSOREJP2",149,0)
 ; - Flagging the prescription to be re-submitted to ECME on the next CMOP/Print from Suspense
"RTN","PSOREJP2",150,0)
 D RETRXF^PSOREJU2(RX,RFL,1)
"RTN","PSOREJP2",151,0)
 W ?40,"[Closing..."
"RTN","PSOREJP2",152,0)
 D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,8,"Fill Date changed to "_$$FMTE^XLFDT(SUSDT)_". A new claim will be re-submitted on this date.")
"RTN","PSOREJP2",153,0)
 W "OK]",!,$C(7) H 1 I $D(PSOSTFLT),PSOSTFLT'="B" S CHANGE=1
"RTN","PSOREJP2",154,0)
 D PSOUL^PSSLOCK(RX)
"RTN","PSOREJP2",155,0)
 Q
"RTN","PSOREJU1")
0^60^B55721099
"RTN","PSOREJU1",1,0)
PSOREJU1 ;BIRM/MFR - BPS (ECME) - Clinical Rejects Utilities (1) ;10/15/04
"RTN","PSOREJU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOREJU1",3,0)
 ;Reference to $$ECMEON^BPSUTIL supported by DBIA 4410
"RTN","PSOREJU1",4,0)
 ;Reference to File 9002313.21 - BPS NCPDP PROFESSIONAL SERVICE CODE supported by DBIA 4712
"RTN","PSOREJU1",5,0)
 ;Reference to File 9002313.22 - BPS NCPDP RESULT OF SERVICE CODE supported by DBIA 4713
"RTN","PSOREJU1",6,0)
 ;Reference to File 9002313.23 - BPS NCPDP REASON FOR SERVICE CODE supported by DBIA 4714
"RTN","PSOREJU1",7,0)
 ;
"RTN","PSOREJU1",8,0)
 ;
"RTN","PSOREJU1",9,0)
ACTION(RX,REJ,OPTS,DEF) ;
"RTN","PSOREJU1",10,0)
 ; Input:  (r) RX   - Rx IEN (#52) 
"RTN","PSOREJU1",11,0)
 ;         (r) REJ  - REJECT ID (IEN)
"RTN","PSOREJU1",12,0)
 ;         (r) OPTS - Available options ("QIO" for QUIT/IGNORE/OVERRIDE)
"RTN","PSOREJU1",13,0)
 ;         (o) DEF  - Default Option ("O", "I" or "Q")
"RTN","PSOREJU1",14,0)
 ; Output: ACTION: "I^Comments" - Ignore Reject
"RTN","PSOREJU1",15,0)
 ;                 "O^COD1^COD2^COD3" - Override with the Override codes COD1(Prof.),COD2(Reason) and COD3(Result)
"RTN","PSOREJU1",16,0)
 ;                 "Q" - Quit
"RTN","PSOREJU1",17,0)
 ;                 "^" - Up-arrow entered or timed out
"RTN","PSOREJU1",18,0)
 ;
"RTN","PSOREJU1",19,0)
 N ACTION,COM,OVR,X,DIR,DIRUT,Y
"RTN","PSOREJU1",20,0)
 ;         
"RTN","PSOREJU1",21,0)
 I '$G(RX)!'$G(REJ) Q
"RTN","PSOREJU1",22,0)
 I '$D(^PSRX(RX,"REJ",REJ)) Q
"RTN","PSOREJU1",23,0)
 ;
"RTN","PSOREJU1",24,0)
 ; - Display DUR/79 REJECT information
"RTN","PSOREJU1",25,0)
 D DISPLAY(RX,REJ)
"RTN","PSOREJU1",26,0)
 ;
"RTN","PSOREJU1",27,0)
ASK K ACTION,DIR,DIRUT
"RTN","PSOREJU1",28,0)
 S DIR(0)="SO^",DIR("A")=""
"RTN","PSOREJU1",29,0)
 S:(OPTS["O") DIR(0)=DIR(0)_"O:(O)VERRIDE - RESUBMIT WITH OVERRIDE CODES;",DIR("A")=DIR("A")_"(O)verride,"
"RTN","PSOREJU1",30,0)
 S:(OPTS["I") DIR(0)=DIR(0)_"I:(I)GNORE - FILL Rx WITHOUT CLAIM SUBMISSION;",DIR("A")=DIR("A")_"(I)gnore,"
"RTN","PSOREJU1",31,0)
 S:(OPTS["Q") DIR(0)=DIR(0)_"Q:(Q)UIT - SEND TO WORKLIST (REQUIRES INTERVENTION);",DIR("A")=DIR("A")_"(Q)uit,"
"RTN","PSOREJU1",32,0)
 S $E(DIR(0),$L(DIR(0)))="",$E(DIR("A"),$L(DIR("A")))="",DIR("??")="^D HELP^PSOREJU2("""_OPTS_""")"
"RTN","PSOREJU1",33,0)
 S:$G(DEF)'="" DIR("B")=DEF D ^DIR I $D(DIRUT) W ! Q "Q"
"RTN","PSOREJU1",34,0)
 ;
"RTN","PSOREJU1",35,0)
 ; - STOP/QUIT Action
"RTN","PSOREJU1",36,0)
 S ACTION=Y I ACTION="Q" Q ACTION
"RTN","PSOREJU1",37,0)
 ;
"RTN","PSOREJU1",38,0)
 ; - IGNORE Action 
"RTN","PSOREJU1",39,0)
 K DIR,DIRUT,X
"RTN","PSOREJU1",40,0)
 I ACTION="I" S COM=$$COM() G ASK:COM="^" G ASK:'$$SIG() S ACTION=ACTION_"^"_COM
"RTN","PSOREJU1",41,0)
 ;
"RTN","PSOREJU1",42,0)
 ; - OVERRIDE Action
"RTN","PSOREJU1",43,0)
 I ACTION="O" D  G ASK:OVR="^"
"RTN","PSOREJU1",44,0)
 . S OVR=$$OVR() S ACTION=ACTION_"^"_OVR
"RTN","PSOREJU1",45,0)
 ;
"RTN","PSOREJU1",46,0)
 Q ACTION
"RTN","PSOREJU1",47,0)
 ;
"RTN","PSOREJU1",48,0)
SIG() ; - Get electronic signature
"RTN","PSOREJU1",49,0)
 N CODE,X,X1,Y
"RTN","PSOREJU1",50,0)
 S CODE=$P($G(^VA(200,DUZ,20)),U,4),Y=0 I '$L(CODE) D  Q Y
"RTN","PSOREJU1",51,0)
 . W $C(7),!,"You do not have an electronic signature code."
"RTN","PSOREJU1",52,0)
 . W !,"Please contact your IRM office." H 2
"RTN","PSOREJU1",53,0)
 D SIG^XUSESIG S Y=(X1'="")
"RTN","PSOREJU1",54,0)
 Q Y
"RTN","PSOREJU1",55,0)
 ;
"RTN","PSOREJU1",56,0)
COM() ; - Ask for CLOSE comments
"RTN","PSOREJU1",57,0)
 K COM,DIR,DIRUT,X
"RTN","PSOREJU1",58,0)
 W ! S DIR(0)="F^3:100" S DIR("A")="Comments" D ^DIR
"RTN","PSOREJU1",59,0)
 S COM=X I $D(DIRUT) S COM="^"
"RTN","PSOREJU1",60,0)
 Q COM
"RTN","PSOREJU1",61,0)
 ;
"RTN","PSOREJU1",62,0)
OVR() ; - Ask for OVERRIDE codes
"RTN","PSOREJU1",63,0)
 N COD1,COD2,COD3,DIR,DIRUT W !
"RTN","PSOREJU1",64,0)
 S COD1=$$OVRCOD(1,$$GET1^DIQ(52.25,REJ_","_RX,14)) I COD1="^" Q "^"
"RTN","PSOREJU1",65,0)
 S COD2=$$OVRCOD(2) I COD2="^" Q "^"
"RTN","PSOREJU1",66,0)
 S COD3=$$OVRCOD(3) I COD3="^" Q "^"
"RTN","PSOREJU1",67,0)
 ;
"RTN","PSOREJU1",68,0)
 D OVRDSP^PSOREJU1(COD1_"^"_COD2_"^"_COD3) W !
"RTN","PSOREJU1",69,0)
 ;
"RTN","PSOREJU1",70,0)
 S DIR(0)="Y",DIR("A")="     Confirm? ",DIR("B")="YES"
"RTN","PSOREJU1",71,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) Q "^"
"RTN","PSOREJU1",72,0)
 ;
"RTN","PSOREJU1",73,0)
 Q (COD2_"^"_COD1_"^"_COD3)
"RTN","PSOREJU1",74,0)
 ;
"RTN","PSOREJU1",75,0)
OVRDSP(LST) ; - Display the Override Codes
"RTN","PSOREJU1",76,0)
 N I W !
"RTN","PSOREJU1",77,0)
 F I=1:1:3 D
"RTN","PSOREJU1",78,0)
 . W !?5,$S(I=1:"Reason for Service Code  : ",I=2:"Professional Service Code: ",1:"Result of Service Code   : ")
"RTN","PSOREJU1",79,0)
 . W $E($$OVRX(I,$P(LST,"^",I)),1,48)
"RTN","PSOREJU1",80,0)
 Q
"RTN","PSOREJU1",81,0)
 ;
"RTN","PSOREJU1",82,0)
DISPLAY(RX,REJ,KEY) ; - Displays REJECT information
"RTN","PSOREJU1",83,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJU1",84,0)
 ;         (r) REJ - REJECT ID (IEN)
"RTN","PSOREJU1",85,0)
 ;         (o) KEY - Display "Press any KEY to continue..." (1-YES/0-NO) (Default: 0)
"RTN","PSOREJU1",86,0)
 ;         
"RTN","PSOREJU1",87,0)
 I '$G(RX)!'$G(REJ) Q
"RTN","PSOREJU1",88,0)
 I '$D(^PSRX(RX,"REJ",REJ)) Q
"RTN","PSOREJU1",89,0)
 ;
"RTN","PSOREJU1",90,0)
 N DATA,RFL,LINE,%
"RTN","PSOREJU1",91,0)
 S RFL=+$$GET1^DIQ(52.25,REJ_","_RX,5)
"RTN","PSOREJU1",92,0)
 D GET^PSOREJU2(RX,RFL,.DATA,REJ) I '$D(DATA(REJ)) Q
"RTN","PSOREJU1",93,0)
 ;
"RTN","PSOREJU1",94,0)
 W !!?16,"*** REJECT RECEIVED FROM THIRD PARTY PAYER ***"
"RTN","PSOREJU1",95,0)
 S $P(LINE,"-",74)="" W !?3,LINE
"RTN","PSOREJU1",96,0)
 W !?3,$$DVINFO^PSOREJU2(RX,RFL)
"RTN","PSOREJU1",97,0)
 W !?3,$$PTINFO^PSOREJU2(RX)
"RTN","PSOREJU1",98,0)
 W !?3,"Prescription : ",$$GET1^DIQ(52,RX,.01),"/",RFL," - ",$E($$GET1^DIQ(52,RX,6),1,20),?54,"ECME#: ",$E(RX+10000000,2,8)
"RTN","PSOREJU1",99,0)
 W !?3,"Reject Type  : ",DATA(REJ,"CODE")," - ",$S(DATA(REJ,"CODE")=79:"REFILL TOO SOON",1:"DUR REJECT")
"RTN","PSOREJU1",100,0)
 W " received on "_$$FMTE^XLFDT($G(DATA(REJ,"DATE/TIME")))
"RTN","PSOREJU1",101,0)
 I $G(DATA(REJ,"PAYER MESSAGE"))'="" W !?3,"Payer Message: " D PRT^PSOREJU2("PAYER MESSAGE",18,58)
"RTN","PSOREJU1",102,0)
 I $G(DATA(REJ,"REASON"))'="" W !?3,"Reason       : " D PRT^PSOREJU2("REASON",18,58)
"RTN","PSOREJU1",103,0)
 I $G(DATA(REJ,"DUR TEXT"))'="" W !?3,"DUR Text     : ",DATA(REJ,"DUR TEXT")
"RTN","PSOREJU1",104,0)
 W !?3,"Insurance    : ",DATA(REJ,"INSURANCE NAME"),?50,"Contact: ",DATA(REJ,"PLAN CONTACT")
"RTN","PSOREJU1",105,0)
 W !?3,"Group Name   : ",DATA(REJ,"GROUP NAME"),?45,"Group Number: ",DATA(REJ,"GROUP NUMBER")
"RTN","PSOREJU1",106,0)
 I $G(DATA(REJ,"CARDHOLDER ID"))'="" W !?3,"Cardholder ID: ",DATA(REJ,"CARDHOLDER ID")
"RTN","PSOREJU1",107,0)
 I DATA(REJ,"PLAN PREVIOUS FILL DATE")'="" D
"RTN","PSOREJU1",108,0)
 . W !?3,"Last Fill Dt.: ",DATA(REJ,"PLAN PREVIOUS FILL DATE")
"RTN","PSOREJU1",109,0)
 . W:DATA(REJ,"PLAN PREVIOUS FILL DATE")'="" "   (from payer)"
"RTN","PSOREJU1",110,0)
 W !?3,LINE,$C(7) I $G(KEY) W !?3,"Press <RETURN> to continue..." R %:DTIME W !
"RTN","PSOREJU1",111,0)
 Q
"RTN","PSOREJU1",112,0)
 ;
"RTN","PSOREJU1",113,0)
HDLG(RX,RFL,CODES,FROM,OPTS,DEF) ; - REJECT Handling
"RTN","PSOREJU1",114,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOREJU1",115,0)
 ;       (o) RFL  - Refill # (Default: most recent)
"RTN","PSOREJU1",116,0)
 ;       (r) CODES - List of REJECT CODES to be handled separated by commas (e.g. "79,88")
"RTN","PSOREJU1",117,0)
 ;       (r) FROM  - Same values as BWHERE param. in the EN^BPSNCPDP api
"RTN","PSOREJU1",118,0)
 ;       (r) OPTS  - Available options ("SIO" for STOP/IGNORE/OVERRIDE)
"RTN","PSOREJU1",119,0)
 ;       (o) DEF   - Default Option ("O", "I" or "Q")
"RTN","PSOREJU1",120,0)
 ;Output: ACTION   - "O"-Override, "I"-Ignore,"Q"-Quit,"^"-Up-arrow entered
"RTN","PSOREJU1",121,0)
 ;       
"RTN","PSOREJU1",122,0)
 N REJDATA,NEWDATA,CODE,ACTION,REJ,RSP,REJCDI S CODE=""
"RTN","PSOREJU1",123,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJU1",124,0)
 F REJCDI=1:1 S CODE=$P(CODES,",",REJCDI) Q:CODE=""  D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",125,0)
 . S ACTION=""
"RTN","PSOREJU1",126,0)
 . I $$FIND^PSOREJUT(RX,RFL,.REJDATA,CODE) D
"RTN","PSOREJU1",127,0)
 . . S REJ=$O(REJDATA(""))
"RTN","PSOREJU1",128,0)
 . . S ACTION=$$ACTION(RX,REJ,$S(CODE=79:$TR(OPTS,"O"),1:OPTS),$G(DEF)) I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",129,0)
 . . I $P(ACTION,"^")="I" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,6,$P(ACTION,"^",2)) Q
"RTN","PSOREJU1",130,0)
 . . I $P(ACTION,"^")="O" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,1,,$P(ACTION,"^",3),$P(ACTION,"^",2),$P(ACTION,"^",4))
"RTN","PSOREJU1",131,0)
 . . D ECMESND^PSOBPSU1(RX,RFL,,FROM,$$GETNDC^PSONDCUT(RX,RFL),,,$P(ACTION,"^",2,4),,.RESP)
"RTN","PSOREJU1",132,0)
 . . I $G(RESP) D  Q
"RTN","PSOREJU1",133,0)
 . . . W !!?10,"Claim could not be submitted. Please try again later!"
"RTN","PSOREJU1",134,0)
 . . . W !,?10,"Reason: ",$S($P(RESP,"^",2)="":"UNKNOWN",1:$P(RESP,"^",2)),$C(7)
"RTN","PSOREJU1",135,0)
 . . K NEWDATA I $$FIND^PSOREJUT(RX,RFL,.NEWDATA,CODE) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",136,0)
 . . . S ACTION=$$ACTION(RX,$O(NEWDATA("")),OPTS,$G(DEF)) I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",137,0)
 . . . I $P(ACTION,"^")="I" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,6,$P(ACTION,"^",2))
"RTN","PSOREJU1",138,0)
 . . . I $P(ACTION,"^")="O" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,1,,$P(ACTION,"^",3),$P(ACTION,"^",2),$P(ACTION,"^",4))
"RTN","PSOREJU1",139,0)
 Q ACTION
"RTN","PSOREJU1",140,0)
 ;
"RTN","PSOREJU1",141,0)
OVRX(TYPE,CODE) ; - Returns the extentend code/description of the NCPDP DUR override codes
"RTN","PSOREJU1",142,0)
 ; Input: (r) TYPE  - 1 (REASON FOR SERVICE), 2 (PROFESSIONAL SERVICE) or 3 (RESULT OF SERVICE)
"RTN","PSOREJU1",143,0)
 ;        (r) CODE  - Table IEN
"RTN","PSOREJU1",144,0)
 ; Output: "CODE - DESCRIPTION"
"RTN","PSOREJU1",145,0)
 N FILE,DIC,X,Y
"RTN","PSOREJU1",146,0)
 S FILE=9002313+$S(TYPE=1:.23,TYPE=2:.21,1:.22)
"RTN","PSOREJU1",147,0)
 S DIC=FILE,X=CODE D ^DIC
"RTN","PSOREJU1",148,0)
 I TYPE=1 Q CODE_" - "_$$GET1^DIQ(9002313.23,+Y,1)
"RTN","PSOREJU1",149,0)
 I TYPE=2 Q CODE_" - "_$$GET1^DIQ(9002313.21,+Y,1)
"RTN","PSOREJU1",150,0)
 I TYPE=3 Q CODE_" - "_$$GET1^DIQ(9002313.22,+Y,1)
"RTN","PSOREJU1",151,0)
 Q ""
"RTN","PSOREJU1",152,0)
 ;
"RTN","PSOREJU1",153,0)
 ;
"RTN","PSOREJU1",154,0)
OVRCOD(TYPE,VALUE) ; - Prompt for NCPDP Override Codes
"RTN","PSOREJU1",155,0)
 N DIC,X,Y,FILE,PRPT
"RTN","PSOREJU1",156,0)
 ; 
"RTN","PSOREJU1",157,0)
 I TYPE=1 S FILE=9002313.23,PRPT="Reason for Service Code  : "
"RTN","PSOREJU1",158,0)
 I TYPE=2 S FILE=9002313.21,PRPT="Professional Service Code: "
"RTN","PSOREJU1",159,0)
 I TYPE=3 S FILE=9002313.22,PRPT="Result of Service Code   : "
"RTN","PSOREJU1",160,0)
 S DIC=FILE,DIC(0)="Z"
"RTN","PSOREJU1",161,0)
 I $G(VALUE)'="" S X=VALUE D ^DIC I Y>0 W !,PRPT,VALUE,"       ",$P(Y(0),"^",2) Q VALUE
"RTN","PSOREJU1",162,0)
 S DIC=FILE,DIC(0)="AQE",DIC("A")=PRPT
"RTN","PSOREJU1",163,0)
 D ^DIC I $D(DTOUT)!$D(DUOUT)!(Y<0) Q "^"
"RTN","PSOREJU1",164,0)
 Q $P(Y,"^",2)
"RTN","PSOREJU1",165,0)
 ;
"RTN","PSOREJU1",166,0)
SEL(FIELD,FILE,ARRAY) ; - Provides field selection (one, multiple or ALL)
"RTN","PSOREJU1",167,0)
 N DIC,DTOUT,DUOUT,QT,Y,X
"RTN","PSOREJU1",168,0)
 W !!,"You may select a single or multiple "_FIELD_"S,"
"RTN","PSOREJU1",169,0)
 W !,"or enter ^ALL to select all "_FIELD_"S.",!
"RTN","PSOREJU1",170,0)
 K ARRAY S DIC=FILE,DIC(0)="QEZAM",DIC("A")=FIELD_": "
"RTN","PSOREJU1",171,0)
 F  D ^DIC Q:X=""  D  Q:$G(QT)
"RTN","PSOREJU1",172,0)
 . I X="^ALL" K ARRAY S ARRAY="ALL",QT=1 Q
"RTN","PSOREJU1",173,0)
 . I $D(DTOUT)!$D(DUOUT) K ARRAY S ARRAY="^",QT=1 Q
"RTN","PSOREJU1",174,0)
 . W "   ",$P(Y,"^",2),$S($D(ARRAY(+Y)):"       (already selected)",1:"")
"RTN","PSOREJU1",175,0)
 . W ! S ARRAY(+Y)="",DIC("A")="ANOTHER ONE: "
"RTN","PSOREJU1",176,0)
 I '$D(ARRAY) S ARRAY="^"
"RTN","PSOREJU1",177,0)
 Q
"RTN","PSOREJU1",178,0)
 ;
"RTN","PSOREJU1",179,0)
LMREJ(RX,RFL,MSG,BCK) ; Used by ListManager hidden actions to detect unresolved 3rd Party Rejects
"RTN","PSOREJU1",180,0)
 ;Input:  (r) RX   - Rx IEN (#52)
"RTN","PSOREJU1",181,0)
 ;        (o) RFL  - Refill # (Default: most recent)
"RTN","PSOREJU1",182,0)
 ;Output: (o) MSG  - Usually this will be used to set VALMSG variable, which shoud be passed in by ref.
"RTN","PSOREJU1",183,0)
 ;        (o) BCK  - This will be used to set VALMBCK variable, which shoud be passed in by ref.
"RTN","PSOREJU1",184,0)
 ;
"RTN","PSOREJU1",185,0)
 I '$D(^PSRX(+RX)) Q 0
"RTN","PSOREJU1",186,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJU1",187,0)
 I $$FIND^PSOREJUT(RX,RFL) D  Q 1
"RTN","PSOREJU1",188,0)
 . S MSG="NOT ALLOWED! Rx has OPEN 3rd Party Payer Reject.",BCK="R" W $C(7),$C(7)
"RTN","PSOREJU1",189,0)
 Q 0
"RTN","PSOREJU1",190,0)
 ;
"RTN","PSOREJU1",191,0)
DUP(RX,RSP) ; Checks if REJECT has already been logged in the PRESCRIPTION file
"RTN","PSOREJU1",192,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJU1",193,0)
 ;         (o) RSP - Response IEN
"RTN","PSOREJU1",194,0)
 ; Output:     DUP - 1: Already logged (duplicate) 
"RTN","PSOREJU1",195,0)
 ;                   0: Not yet logged on PRESCRIPTION file
"RTN","PSOREJU1",196,0)
 N DUP,IDX S (DUP,IDX)=0
"RTN","PSOREJU1",197,0)
 F  S IDX=$O(^PSRX(RX,"REJ",IDX)) Q:'IDX  D  Q:DUP
"RTN","PSOREJU1",198,0)
 . I +RSP=+$$GET1^DIQ(52.25,IDX_","_RX,16,"I") S DUP=1
"RTN","PSOREJU1",199,0)
 Q DUP
"RTN","PSOREJU1",200,0)
 ;
"RTN","PSOREJU1",201,0)
OTH(CODE,LST) ; Removes the current Reject code from the list
"RTN","PSOREJU1",202,0)
 ; Input:  (r) CODE  - Current Reject Code (79 or 88)
"RTN","PSOREJU1",203,0)
 ;         (o) LST   - List of all Reject codes with response (comma separated)
"RTN","PSOREJU1",204,0)
 ; Output:     OTH   - List of OTHER Reject codes (w/out 79 or 88)
"RTN","PSOREJU1",205,0)
 ;
"RTN","PSOREJU1",206,0)
 N I,OTH
"RTN","PSOREJU1",207,0)
 F I=1:1:$L(LST,",") D
"RTN","PSOREJU1",208,0)
 . I $P(LST,",",I),$P(LST,",",I)'=CODE S OTH=$G(OTH)_","_$P(LST,",",I)
"RTN","PSOREJU1",209,0)
 S $E(OTH)=""
"RTN","PSOREJU1",210,0)
 Q OTH
"RTN","PSOREJU1",211,0)
 ;
"RTN","PSOREJU1",212,0)
DAT(DAT) ; - External Date
"RTN","PSOREJU1",213,0)
 S X=$$HL7TFM^XLFDT(DAT) I X<0 Q ""
"RTN","PSOREJU1",214,0)
 Q X
"RTN","PSOREJU1",215,0)
 ;
"RTN","PSOREJU1",216,0)
CLEAN(STR) ; Remove blanks from the end of a string and replaces ";" with ","
"RTN","PSOREJU1",217,0)
 N LEN F LEN=$L(STR):-1:1 Q:$E(STR,LEN)'=" "
"RTN","PSOREJU1",218,0)
 S STR=$TR(STR,";",",")
"RTN","PSOREJU1",219,0)
 Q $E(STR,1,LEN)
"RTN","PSOREJU2")
0^76^B36306554
"RTN","PSOREJU2",1,0)
PSOREJU2 ;BIRM/MFR - BPS (ECME) - Clinical Rejects Utilites (1) ;10/15/04
"RTN","PSOREJU2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOREJU2",3,0)
 ;Reference to $$NABP^BPSUTL supported by DBIA 4410
"RTN","PSOREJU2",4,0)
 ;Reference to File 9002313.23 - BPS NCPDP REASON FOR SERVICE CODE supported by DBIA 4714
"RTN","PSOREJU2",5,0)
 ;
"RTN","PSOREJU2",6,0)
GET(RX,RFL,REJDATA,REJID,OKCL,CODE) ;
"RTN","PSOREJU2",7,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJU2",8,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOREJU2",9,0)
 ;         (r) REJDATA(REJECT IEN,FIELD) - Array where these Reject fields will be returned:
"RTN","PSOREJU2",10,0)
 ;                       "CODE" - Reject Code (79 or 88)
"RTN","PSOREJU2",11,0)
 ;                       "DATE/TIME" - DATE/TIME Reject was detected
"RTN","PSOREJU2",12,0)
 ;                       "PAYER MESSAGE" - Message returned by the payer
"RTN","PSOREJU2",13,0)
 ;                       "REASON" - Reject Reason description (from payer)
"RTN","PSOREJU2",14,0)
 ;                       "INSURANCE NAME" - Patient's Insurance Company Name
"RTN","PSOREJU2",15,0)
 ;                       "GROUP NAME" - Patient's Insurance Group Name
"RTN","PSOREJU2",16,0)
 ;                       "GROUP NUMBER" - Patient's Insurance Group Number
"RTN","PSOREJU2",17,0)
 ;                       "CARDHOLDER ID" - Patient's Insurance Cardholder ID
"RTN","PSOREJU2",18,0)
 ;                       "PLAN CONTACT" - Plan's Contact (eg., "1-800-...")
"RTN","PSOREJU2",19,0)
 ;                       "PLAN PREVIOUS FILL DATE" - Last time Rx was paid by payer
"RTN","PSOREJU2",20,0)
 ;                       "STATUS" - REJECTS status ("OPEN/UNRESOLVED" or "CLOSED/RESOLVED")
"RTN","PSOREJU2",21,0)
 ;                       "DUR TEXT" - Payer's DUR description
"RTN","PSOREJU2",22,0)
 ;                       "OTHER REJECTS" - Other Rejects on the same response
"RTN","PSOREJU2",23,0)
 ;                       "REASON SVC CODE" - Reason for Service Code
"RTN","PSOREJU2",24,0)
 ;                  If REJECT is closed, the following fields will be returned:
"RTN","PSOREJU2",25,0)
 ;                       "CLOSED DATE/TIME" - DATE/TIME Reject was closed
"RTN","PSOREJU2",26,0)
 ;                       "CLOSED BY" - Name of the user responsible for closing Reject
"RTN","PSOREJU2",27,0)
 ;                       "CLOSE REASON" - Reason for closing Reject (text)
"RTN","PSOREJU2",28,0)
 ;                       "CLOSE COMMENTS" - User entered comments
"RTN","PSOREJU2",29,0)
 ;         (o) REJID - REJECT IEN in the PRESCRIPTION file for retrieve this REJECT
"RTN","PSOREJU2",30,0)
 ;         (o) OKCL - If set to 1, CLOSED REJECTs will also be returned
"RTN","PSOREJU2",31,0)
 ;         (o) CODE - Only REJECTs with this CODE should be returned
"RTN","PSOREJU2",32,0)
 ;
"RTN","PSOREJU2",33,0)
 N REJS,ARRAY,REJFLD,IDX
"RTN","PSOREJU2",34,0)
 ;
"RTN","PSOREJU2",35,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJU2",36,0)
 ;
"RTN","PSOREJU2",37,0)
 K REJDATA
"RTN","PSOREJU2",38,0)
 I '$O(^PSRX(RX,"REJ",0)) Q
"RTN","PSOREJU2",39,0)
 ;
"RTN","PSOREJU2",40,0)
 K REJS S RFL=+$G(RFL)
"RTN","PSOREJU2",41,0)
 I $G(REJID) D
"RTN","PSOREJU2",42,0)
 . I +$P($G(^PSRX(RX,"REJ",REJID,0)),"^",4)'=RFL Q
"RTN","PSOREJU2",43,0)
 . I '$G(OKCL),$P($G(^PSRX(RX,"REJ",REJID,0)),"^",5) Q
"RTN","PSOREJU2",44,0)
 . S REJS(REJID)=""
"RTN","PSOREJU2",45,0)
 E  D
"RTN","PSOREJU2",46,0)
 . S IDX=999
"RTN","PSOREJU2",47,0)
 . F  S IDX=$O(^PSRX(RX,"REJ",IDX),-1) Q:'IDX  D
"RTN","PSOREJU2",48,0)
 . . I +$P($G(^PSRX(RX,"REJ",IDX,0)),"^",4)'=RFL Q
"RTN","PSOREJU2",49,0)
 . . I '$G(OKCL),$P($G(^PSRX(RX,"REJ",IDX,0)),"^",5) Q
"RTN","PSOREJU2",50,0)
 . . S REJS(IDX)=""
"RTN","PSOREJU2",51,0)
 I '$D(REJS) Q
"RTN","PSOREJU2",52,0)
 ;
"RTN","PSOREJU2",53,0)
 S IDX=0
"RTN","PSOREJU2",54,0)
 F  S IDX=$O(REJS(IDX)) Q:'IDX  D
"RTN","PSOREJU2",55,0)
 . K ARRAY D GETS^DIQ(52.25,IDX_","_RX_",","*","","ARRAY")
"RTN","PSOREJU2",56,0)
 . K REJFLD M REJFLD=ARRAY(52.25,IDX_","_RX_",")
"RTN","PSOREJU2",57,0)
 . I $G(CODE),REJFLD(.01)'=CODE Q
"RTN","PSOREJU2",58,0)
 . S REJDATA(IDX,"CODE")=$G(REJFLD(.01))
"RTN","PSOREJU2",59,0)
 . S REJDATA(IDX,"DATE/TIME")=$G(REJFLD(1))
"RTN","PSOREJU2",60,0)
 . S REJDATA(IDX,"PAYER MESSAGE")=$G(REJFLD(2))
"RTN","PSOREJU2",61,0)
 . S REJDATA(IDX,"REASON")=$G(REJFLD(3))
"RTN","PSOREJU2",62,0)
 . S REJDATA(IDX,"PHARMACIST")=$G(REJFLD(4))
"RTN","PSOREJU2",63,0)
 . S REJDATA(IDX,"INSURANCE NAME")=$G(REJFLD(20))
"RTN","PSOREJU2",64,0)
 . S REJDATA(IDX,"GROUP NAME")=$G(REJFLD(6))
"RTN","PSOREJU2",65,0)
 . S REJDATA(IDX,"GROUP NUMBER")=$G(REJFLD(21))
"RTN","PSOREJU2",66,0)
 . S REJDATA(IDX,"CARDHOLDER ID")=$G(REJFLD(22))
"RTN","PSOREJU2",67,0)
 . S REJDATA(IDX,"PLAN CONTACT")=$G(REJFLD(7))
"RTN","PSOREJU2",68,0)
 . S REJDATA(IDX,"PLAN PREVIOUS FILL DATE")=$G(REJFLD(8))
"RTN","PSOREJU2",69,0)
 . S REJDATA(IDX,"STATUS")=$G(REJFLD(9))
"RTN","PSOREJU2",70,0)
 . S REJDATA(IDX,"OTHER REJECTS")=$G(REJFLD(17))
"RTN","PSOREJU2",71,0)
 . S REJDATA(IDX,"DUR TEXT")=$G(REJFLD(18))
"RTN","PSOREJU2",72,0)
 . S REJDATA(IDX,"REASON SVC CODE")=$G(REJFLD(14))
"RTN","PSOREJU2",73,0)
 . S REJDATA(IDX,"RESPONSE IEN")=$G(REJFLD(16))
"RTN","PSOREJU2",74,0)
 . I '$G(OKCL) Q
"RTN","PSOREJU2",75,0)
 . S REJDATA(IDX,"CLOSED DATE/TIME")=$G(REJFLD(10))
"RTN","PSOREJU2",76,0)
 . S REJDATA(IDX,"CLOSED BY")=$G(REJFLD(11))
"RTN","PSOREJU2",77,0)
 . S REJDATA(IDX,"CLOSE REASON")=$G(REJFLD(12))
"RTN","PSOREJU2",78,0)
 . S REJDATA(IDX,"CLOSE COMMENTS")=$G(REJFLD(13))
"RTN","PSOREJU2",79,0)
 . S REJDATA(IDX,"COD1")=$G(REJFLD(14))
"RTN","PSOREJU2",80,0)
 . S REJDATA(IDX,"COD2")=$G(REJFLD(15))
"RTN","PSOREJU2",81,0)
 . S REJDATA(IDX,"COD3")=$G(REJFLD(19))
"RTN","PSOREJU2",82,0)
 Q
"RTN","PSOREJU2",83,0)
 ;
"RTN","PSOREJU2",84,0)
HELP(OPTS) ; Display the Help Text for the DUR handling options (OVERRIDE/IGNORE/STOP/QUIT)
"RTN","PSOREJU2",85,0)
 ;
"RTN","PSOREJU2",86,0)
 I OPTS["O" D
"RTN","PSOREJU2",87,0)
 . W !?1,"(O)verride - This option will provide the prompts for the code sets needed to"
"RTN","PSOREJU2",88,0)
 . W !?1,"             override this reject and get a payable 3rd party claim. Before"
"RTN","PSOREJU2",89,0)
 . W !?1,"             you select this option, you may need to call the 3rd party payer"
"RTN","PSOREJU2",90,0)
 . W !?1,"             to determine which code sets are needed to override a particular"
"RTN","PSOREJU2",91,0)
 . W !?1,"             reject. Once the proper override is accepted the label will print"
"RTN","PSOREJU2",92,0)
 . W !?1,"             and the prescription can be filled."
"RTN","PSOREJU2",93,0)
 ;
"RTN","PSOREJU2",94,0)
 I OPTS["I" D
"RTN","PSOREJU2",95,0)
 . W !?1,"(I)gnore   - Choosing Ignore will by-pass 3rd party processing and will allow"
"RTN","PSOREJU2",96,0)
 . W !?1,"             you to print a label and fill the prescription. This essentially"
"RTN","PSOREJU2",97,0)
 . W !?1,"             ignores the clinical safety issues suggested by the 3rd party"
"RTN","PSOREJU2",98,0)
 . W !?1,"             payer and will NOT result in a payable claim."
"RTN","PSOREJU2",99,0)
 ;           
"RTN","PSOREJU2",100,0)
 I OPTS["Q" D
"RTN","PSOREJU2",101,0)
 . W !?1,"(Q)uit     - Choosing Quit will postpone the processing of this prescription"
"RTN","PSOREJU2",102,0)
 . W !?1,"             until this 3rd party reject is resolved. A label will not be"
"RTN","PSOREJU2",103,0)
 . W !?1,"             printed for this prescription and it can not be filled/dispensed"
"RTN","PSOREJU2",104,0)
 . W !?1,"             until this reject is resolved. Rejects can be resolved through"
"RTN","PSOREJU2",105,0)
 . W !?1,"             the Worklist option under the ePharmacy menu."
"RTN","PSOREJU2",106,0)
 ;
"RTN","PSOREJU2",107,0)
 Q
"RTN","PSOREJU2",108,0)
 ;
"RTN","PSOREJU2",109,0)
DVINFO(RX,RFL,LM) ; Returns header displayable Division Information
"RTN","PSOREJU2",110,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOREJU2",111,0)
 ;       (o) RFL  - Refill # (Default: most recent)
"RTN","PSOREJU2",112,0)
 ;       (o) LM   - ListManager format? (1 - Yes / 0 - No) - Default: 0
"RTN","PSOREJU2",113,0)
 N TXT,DVINFO
"RTN","PSOREJU2",114,0)
 S DVINFO="Division : "_$$GET1^DIQ(59,+$$RXSITE^PSOBPSUT(RX,RFL),.01)
"RTN","PSOREJU2",115,0)
 S $E(DVINFO,$S($G(LM):58,1:51))="NCPDP#: "_+$$NABP^BPSBUTL(RX,RFL)
"RTN","PSOREJU2",116,0)
 Q DVINFO
"RTN","PSOREJU2",117,0)
 ;
"RTN","PSOREJU2",118,0)
PTINFO(RX,LM) ; Returns header displayable Patient Information
"RTN","PSOREJU2",119,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOREJU2",120,0)
 ;       (o) LM   - ListManager format? (1 - Yes / 0 - No) - Default: 0
"RTN","PSOREJU2",121,0)
 N DFN,VADM,PTINFO
"RTN","PSOREJU2",122,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I") D DEM^VADPT
"RTN","PSOREJU2",123,0)
 S PTINFO="Patient  : "_$E($G(VADM(1)),1,$S($G(LM):24,1:20))_"("_$P($G(VADM(2)),"^",2)_")"
"RTN","PSOREJU2",124,0)
 S PTINFO=PTINFO_"  Sex: "_$P($G(VADM(5)),"^")
"RTN","PSOREJU2",125,0)
 S $E(PTINFO,$S($G(LM):61,1:54))="DOB: "_$P($G(VADM(3)),"^",2)_"("_$P($G(VADM(4)),"^")_")"
"RTN","PSOREJU2",126,0)
 Q PTINFO
"RTN","PSOREJU2",127,0)
 ;
"RTN","PSOREJU2",128,0)
RETRXF(RX,RFL,ONOFF) ; - Set/Reset the Re-transmission flag
"RTN","PSOREJU2",129,0)
 ;Input: (r) RX    - Rx IEN (#52)
"RTN","PSOREJU2",130,0)
 ;       (r) RFL   - Refill IEN (#52.1)
"RTN","PSOREJU2",131,0)
 ;       (o) ONOFF - Turn flag ON or OFF (1 - ON / 0 - OFF) (Default: OFF) 
"RTN","PSOREJU2",132,0)
 N DA,DIE,DR
"RTN","PSOREJU2",133,0)
 S DR="82///"_$S($G(ONOFF):"YES",1:"@")
"RTN","PSOREJU2",134,0)
 I 'RFL S DA=RX,DIE="^PSRX("
"RTN","PSOREJU2",135,0)
 I RFL S DA(1)=RX,DA=RFL,DIE="^PSRX("_RX_",1,"
"RTN","PSOREJU2",136,0)
 D ^DIE
"RTN","PSOREJU2",137,0)
 Q
"RTN","PSOREJU2",138,0)
 ;
"RTN","PSOREJU2",139,0)
REASON(TXT) ; Extracts the Reason for service code from the REASON text field
"RTN","PSOREJU2",140,0)
 ; Input: (r) TXT  - Reason text (e.g., NN Reason for Service Code Text)
"RTN","PSOREJU2",141,0)
 ;Output:   REASON - NN (if on valid and on file (#9002313.23), null otherwise)
"RTN","PSOREJU2",142,0)
 N REASEON,DIC,X,Y
"RTN","PSOREJU2",143,0)
 S REASON=$P(TXT," ") I $L(REASON)'=2 Q ""
"RTN","PSOREJU2",144,0)
 S DIC=9002313.23,X=REASON D ^DIC I Y<0 Q ""
"RTN","PSOREJU2",145,0)
 Q REASON
"RTN","PSOREJU2",146,0)
 ;
"RTN","PSOREJU2",147,0)
SETOPN(RX,REJ) ; - Set the Reject RE-OPENED flag to YES
"RTN","PSOREJU2",148,0)
 ;Input: (r) RX    - Rx IEN (#52)
"RTN","PSOREJU2",149,0)
 ;       (r) REJ   - Reject IEN (#52.25)
"RTN","PSOREJU2",150,0)
 ;       
"RTN","PSOREJU2",151,0)
 I '$D(^PSRX(RX,"REJ",REJ)) Q
"RTN","PSOREJU2",152,0)
 N DIE,DA,DR
"RTN","PSOREJU2",153,0)
 S DIE="^PSRX("_RX_",""REJ"",",DA(1)=RX,DA=REJ,DR="23///YES" D ^DIE
"RTN","PSOREJU2",154,0)
 Q
"RTN","PSOREJU2",155,0)
 ;
"RTN","PSOREJU2",156,0)
PRT(FIELD,P,L) ; Sets the lines for fields that require text wrapping
"RTN","PSOREJU2",157,0)
 ;Input: FIELD - Subscript name from the DATA(REJ,FIELD) array
"RTN","PSOREJU2",158,0)
 ;         P   - Position where the content should be printed
"RTN","PSOREJU2",159,0)
 ;         L   - Lenght of the text on each line
"RTN","PSOREJU2",160,0)
 N TXT
"RTN","PSOREJU2",161,0)
 S TXT=DATA(REJ,FIELD) I $L(TXT)'>L W ?P,TXT Q
"RTN","PSOREJU2",162,0)
 F I=1:1 Q:TXT=""  D
"RTN","PSOREJU2",163,0)
 . I I=1 W ?P,$E(TXT,1,L),! S TXT=$E(TXT,L+1,999) Q
"RTN","PSOREJU2",164,0)
 . W ?P,$E(TXT,1,L) S TXT=$E(TXT,L+1,999) W:TXT'="" !
"RTN","PSOREJU2",165,0)
 Q
"RTN","PSOREJU2",166,0)
 ;
"RTN","PSOREJU2",167,0)
CLSALL(RX,RFL,REA,COM,USR) ; Close/Resolve All Rejects
"RTN","PSOREJU2",168,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOREJU2",169,0)
 ;       (o) RFL  - Refill # (Default: most recent)
"RTN","PSOREJU2",170,0)
 ;       (r) REA  - Close REASON code
"RTN","PSOREJU2",171,0)
 ;       (o) COM  - Close COMMENTS
"RTN","PSOREJU2",172,0)
 ;       (o) USR  - User DUZ responsible for closing all rejects
"RTN","PSOREJU2",173,0)
 N REJ,REJDATA,DIE,DR,DA
"RTN","PSOREJU2",174,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJU2",175,0)
 ;
"RTN","PSOREJU2",176,0)
 ; - Closing OPEN/UNRESOLVED rejects
"RTN","PSOREJU2",177,0)
 I $$FIND^PSOREJUT(RX,RFL,.REJDATA) D
"RTN","PSOREJU2",178,0)
 . S REJ="" F  S REJ=$O(REJDATA(REJ)) Q:'REJ  D
"RTN","PSOREJU2",179,0)
 . . D CLOSE^PSOREJUT(RX,RFL,REJ,USR,REA,$G(COM))
"RTN","PSOREJU2",180,0)
 ;
"RTN","PSOREJU2",181,0)
 Q
"RTN","PSOREJUT")
0^50^B27615812
"RTN","PSOREJUT",1,0)
PSOREJUT ;BIRM/MFR - BPS (ECME) - Clinical Rejects Utilites ; 07 Jun 2005  9:39 PM
"RTN","PSOREJUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOREJUT",3,0)
 ;Reference to $$ECMEON^BPSUTIL supported by DBIA 4410
"RTN","PSOREJUT",4,0)
 ;Reference to DUR1^BPSNCPD3 supported by DBIA 4560
"RTN","PSOREJUT",5,0)
 ;Reference to $$ADDCOMM^BPSBUTL supported by IA 4719
"RTN","PSOREJUT",6,0)
 ;
"RTN","PSOREJUT",7,0)
SAVE(RX,RFL,REJ) ; - Saves DUR Information int he PRESRIPTION file
"RTN","PSOREJUT",8,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJUT",9,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOREJUT",10,0)
 ;         (r) REJ - Array containg information about the REJECT on the following
"RTN","PSOREJUT",11,0)
 ;                   subscripts:
"RTN","PSOREJUT",12,0)
 ;                   "CODE"   - Reject Code (79 or 88)
"RTN","PSOREJUT",13,0)
 ;                   "DATE/TIME"   - Date/Time Reject Detected
"RTN","PSOREJUT",14,0)
 ;                   "PAYER MESSAGE" - Message returned by Payer (up to 140 chars long)
"RTN","PSOREJUT",15,0)
 ;                   "REASON" - Reject Reason (up to 100 chars long)
"RTN","PSOREJUT",16,0)
 ;                   "DUR TEXT" - Payer's DUR descripiton
"RTN","PSOREJUT",17,0)
 ;                   "INSURANCE NAME" - Patient's Insurance Company Name
"RTN","PSOREJUT",18,0)
 ;                   "GROUP NAME" - Patient's Insurance Group Name
"RTN","PSOREJUT",19,0)
 ;                   "GROUP NUMBER" - Patient's Insurance Group Number
"RTN","PSOREJUT",20,0)
 ;                   "CARDHOLDER ID" - Patient's Insurance Cardholder ID
"RTN","PSOREJUT",21,0)
 ;                   "PLAN CONTACT" - Patient's Insurance Plan Contact (1-800)
"RTN","PSOREJUT",22,0)
 ;                   "PREVIOUS FILL" - Plan's Previous Fill Date
"RTN","PSOREJUT",23,0)
 ;                   "OTHER REJECTS" - Other Rejects with same Response
"RTN","PSOREJUT",24,0)
 ;                   "PHARMACIST" - Pharmacist DUZ
"RTN","PSOREJUT",25,0)
 ;                   "RESPONSE IEN" - Pointer to the RESPONSE file in ECME
"RTN","PSOREJUT",26,0)
 ;                   "REASON SVC CODE" - Reason for Service Code (pointer to BPS NCPDP REASON FOR SERVICE CODE)
"RTN","PSOREJUT",27,0)
 ;                   "RE-OPENED" - Re-Open Flag
"RTN","PSOREJUT",28,0)
 ;
"RTN","PSOREJUT",29,0)
 N %,DIC,DR,DA,X,DINUM,DD,DO,DLAYGO
"RTN","PSOREJUT",30,0)
 ;
"RTN","PSOREJUT",31,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJUT",32,0)
 ;
"RTN","PSOREJUT",33,0)
 ; - If Reject Code different than 79 or 88, Quit
"RTN","PSOREJUT",34,0)
 S REJ("CODE")=+$G(REJ("CODE")) I REJ("CODE")'=79,REJ("CODE")'=88 Q
"RTN","PSOREJUT",35,0)
 ;
"RTN","PSOREJUT",36,0)
 S REJ("PAYER MESSAGE")=$E($G(REJ("PAYER MESSAGE")),1,140),REJ("REASON")=$E($G(REJ("REASON")),1,100)
"RTN","PSOREJUT",37,0)
 S REJ("DUR TEXT")=$E($G(REJ("DUR TEXT")),1,100),REJ("GROUP NAME")=$E($G(REJ("GROUP NAME")),1,30)
"RTN","PSOREJUT",38,0)
 S REJ("INSURANCE NAME")=$E($G(REJ("INSURANCE NAME")),1,30),REJ("PLAN CONTACT")=$E($G(REJ("PLAN CONTACT")),1,30)
"RTN","PSOREJUT",39,0)
 S REJ("GROUP NUMBER")=$E($G(REJ("GROUP NUMBER")),1,30),REJ("OTHER REJECTS")=$E($G(REJ("OTHER REJECTS")),1,15)
"RTN","PSOREJUT",40,0)
 S REJ("CARDHOLDER ID")=$E($G(REJ("CARDHOLDER ID")),1,20)
"RTN","PSOREJUT",41,0)
 I $G(REJ("DATE/TIME"))="" D NOW^%DTC S REJ("DATE/TIME")=%
"RTN","PSOREJUT",42,0)
 ;
"RTN","PSOREJUT",43,0)
 S DIC="^PSRX("_RX_",""REJ"",",DA(1)=RX,DIC(0)=""
"RTN","PSOREJUT",44,0)
 S X=+$G(REJ("CODE")),DINUM=$O(^PSRX(RX,"REJ",9999),-1)+1
"RTN","PSOREJUT",45,0)
 S DIC("DR")="1///"_$G(REJ("DATE/TIME"))_";2///"_REJ("PAYER MESSAGE")_";3///"_REJ("REASON")_";4////"_$G(REJ("PHARMACIST"))_";5///"_RFL
"RTN","PSOREJUT",46,0)
 S DIC("DR")=DIC("DR")_";6///"_REJ("GROUP NAME")_";7///"_REJ("PLAN CONTACT")_";8///"_$G(REJ("PREVIOUS FILL"))
"RTN","PSOREJUT",47,0)
 S DIC("DR")=DIC("DR")_";9///0;14///"_$G(REJ("REASON SVC CODE"))_";16///"_$G(REJ("RESPONSE IEN"))
"RTN","PSOREJUT",48,0)
 S DIC("DR")=DIC("DR")_";17///"_$G(REJ("OTHER REJECTS"))_";18///"_REJ("DUR TEXT")_";20///"_REJ("INSURANCE NAME")
"RTN","PSOREJUT",49,0)
 S DIC("DR")=DIC("DR")_";21///"_REJ("GROUP NUMBER")_";22///"_REJ("CARDHOLDER ID")_";23///"_$G(REJ("RE-OPENED"))
"RTN","PSOREJUT",50,0)
 K DD,DO D FILE^DICN K DD,DO
"RTN","PSOREJUT",51,0)
 Q
"RTN","PSOREJUT",52,0)
 ;
"RTN","PSOREJUT",53,0)
CLOSE(RX,RFL,REJ,USR,REA,COM,COD1,COD2,COD3) ; - Mark a DUR/REFILL TOO SOON reject RESOLVED
"RTN","PSOREJUT",54,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJUT",55,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOREJUT",56,0)
 ;         (r) REJ - REJECT ID (IEN)
"RTN","PSOREJUT",57,0)
 ;         (o) USR - User (file #200 IEN) responsible for closing the REJECT
"RTN","PSOREJUT",58,0)
 ;         (r) REA - Reason for closing the REJECT:
"RTN","PSOREJUT",59,0)
 ;                       1:CLAIM RE-SUBMITTED
"RTN","PSOREJUT",60,0)
 ;                       2:RX ON HOLD
"RTN","PSOREJUT",61,0)
 ;                       3:RX SUSPENDED
"RTN","PSOREJUT",62,0)
 ;                       4:RX RETURNED TO STOCK
"RTN","PSOREJUT",63,0)
 ;                       5:RX DELETED
"RTN","PSOREJUT",64,0)
 ;                       6:OVERRIDEN W/OUT RE-SUBMISSION
"RTN","PSOREJUT",65,0)
 ;                      99:OTHER
"RTN","PSOREJUT",66,0)
 ;         (o) COM - Close comments manually entered by the user
"RTN","PSOREJUT",67,0)
 ;         (o) COD1 - NCPDP Reason for Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",68,0)
 ;         (o) COD2 - NCPDP Professional Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",69,0)
 ;         (o) COD3 - NCPDP Result of Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",70,0)
 ;
"RTN","PSOREJUT",71,0)
 I '$G(RX)!'$G(REJ) Q
"RTN","PSOREJUT",72,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJUT",73,0)
 I '$D(^PSRX(RX,"REJ",REJ)) Q
"RTN","PSOREJUT",74,0)
 I $$GET1^DIQ(52.25,REJ_","_RX,5)'=+$G(RFL) Q
"RTN","PSOREJUT",75,0)
 S:'$G(REA) REA=99 S COM=$TR($G(COM),";^",",,")
"RTN","PSOREJUT",76,0)
 ;
"RTN","PSOREJUT",77,0)
 N DQ,DA,DIE,DR,X,Y
"RTN","PSOREJUT",78,0)
 D NOW^%DTC
"RTN","PSOREJUT",79,0)
 S DA(1)=RX,DA=REJ,DIE="^PSRX("_RX_",""REJ"","
"RTN","PSOREJUT",80,0)
 S DR="9///1;10///"_%_";11////"_$G(USR)_";12///"_REA_";13///"
"RTN","PSOREJUT",81,0)
 S DR=DR_COM_";14///"_$G(COD1)_";15///"_$G(COD2)_";19///"_$G(COD3)
"RTN","PSOREJUT",82,0)
 D ^DIE S X=$$ADDCOMM^BPSBUTL(RX,RFL,COM)
"RTN","PSOREJUT",83,0)
 Q
"RTN","PSOREJUT",84,0)
 ;
"RTN","PSOREJUT",85,0)
FIND(RX,RFL,REJDATA,CODE) ; - Returns whether a prescription/fill contains UNRESOLVED rejects
"RTN","PSOREJUT",86,0)
 ; Input:  (r) RX   - Rx IEN (#52) 
"RTN","PSOREJUT",87,0)
 ;         (o) RFL  - Refill # (If not passed, look original and all refills)
"RTN","PSOREJUT",88,0)
 ;         (o) CODE - Specific Reject Code to be checked
"RTN","PSOREJUT",89,0)
 ;         
"RTN","PSOREJUT",90,0)
 ; Output: 1 - Rx contains unresoveld Rejects 
"RTN","PSOREJUT",91,0)
 ;         0 - Rx does not contain unresolved Rejects
"RTN","PSOREJUT",92,0)
 ;         .REJDATA - Array containg the Reject(s) data (see 
"RTN","PSOREJUT",93,0)
 ;                    GET^PSOREJU2 for fields documentation)
"RTN","PSOREJUT",94,0)
 ;
"RTN","PSOREJUT",95,0)
 I $G(RFL),$$STATUS^PSOBPSUT(RX,RFL)="" Q 0
"RTN","PSOREJUT",96,0)
 ;
"RTN","PSOREJUT",97,0)
 K REJDATA
"RTN","PSOREJUT",98,0)
 I $G(RFL) D
"RTN","PSOREJUT",99,0)
 . D GET^PSOREJU2(RX,RFL,.REJDATA,,,$G(CODE))
"RTN","PSOREJUT",100,0)
 E  S RFL=0 D  I '$D(REJDATA) F  S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  D  Q:$D(REJDATA)
"RTN","PSOREJUT",101,0)
 . D GET^PSOREJU2(RX,RFL,.REJDATA,,,$G(CODE))
"RTN","PSOREJUT",102,0)
 ;
"RTN","PSOREJUT",103,0)
 Q $S($D(REJDATA):1,1:0)
"RTN","PSOREJUT",104,0)
 ;
"RTN","PSOREJUT",105,0)
SYNC(RX,RFL,USR) ;
"RTN","PSOREJUT",106,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJUT",107,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOREJUT",108,0)
 ;         (o) USR - User using the system when this routine is called
"RTN","PSOREJUT",109,0)
 ;
"RTN","PSOREJUT",110,0)
 N REJ,REJS,I,IDX,CODE,DATA,TXT
"RTN","PSOREJUT",111,0)
 L +^PSRX("REJ",RX):0 Q:'$T
"RTN","PSOREJUT",112,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJUT",113,0)
 D DUR1^BPSNCPD3(RX,RFL,.REJ)
"RTN","PSOREJUT",114,0)
 K REJS S IDX=""
"RTN","PSOREJUT",115,0)
 F  S IDX=$O(REJ(IDX)) Q:IDX=""  D
"RTN","PSOREJUT",116,0)
 . S TXT=$G(REJ(IDX,"REJ CODE LST"))
"RTN","PSOREJUT",117,0)
 . F I=1:1:$L(TXT,",") D
"RTN","PSOREJUT",118,0)
 . . S CODE=+$P(TXT,",",I) I CODE'=79,CODE'=88 Q
"RTN","PSOREJUT",119,0)
 . . I $$DUP^PSOREJU1(RX,+$$CLEAN^PSOREJU1($G(REJ(IDX,"RESPONSE IEN")))) Q
"RTN","PSOREJUT",120,0)
 . . S REJS(IDX,CODE)=""
"RTN","PSOREJUT",121,0)
 I '$D(REJS) L -^PSRX("REJ",RX) Q
"RTN","PSOREJUT",122,0)
 ;
"RTN","PSOREJUT",123,0)
 S (IDX,CODE)=""
"RTN","PSOREJUT",124,0)
 F  S IDX=$O(REJS(IDX)) Q:IDX=""  D
"RTN","PSOREJUT",125,0)
 . F  S CODE=$O(REJS(IDX,CODE)) Q:CODE=""  D
"RTN","PSOREJUT",126,0)
 . . K DATA
"RTN","PSOREJUT",127,0)
 . . S DATA("DUR TEXT")=$$CLEAN^PSOREJU1($G(REJ(IDX,"DUR FREE TEXT DESC")))
"RTN","PSOREJUT",128,0)
 . . S DATA("PAYER MESSAGE")=$$CLEAN^PSOREJU1($G(REJ(IDX,"PAYER MESSAGE")))
"RTN","PSOREJUT",129,0)
 . . S DATA("CODE")=CODE
"RTN","PSOREJUT",130,0)
 . . S DATA("REASON")=$$CLEAN^PSOREJU1($G(REJ(IDX,"REASON")))
"RTN","PSOREJUT",131,0)
 . . S DATA("PHARMACIST")=$G(USR)
"RTN","PSOREJUT",132,0)
 . . S DATA("INSURANCE NAME")=$$CLEAN^PSOREJU1($G(REJ(IDX,"INSURANCE NAME")))
"RTN","PSOREJUT",133,0)
 . . S DATA("GROUP NAME")=$$CLEAN^PSOREJU1($G(REJ(IDX,"GROUP NAME")))
"RTN","PSOREJUT",134,0)
 . . S DATA("GROUP NUMBER")=$$CLEAN^PSOREJU1($G(REJ(IDX,"GROUP NUMBER")))
"RTN","PSOREJUT",135,0)
 . . S DATA("CARDHOLDER ID")=$$CLEAN^PSOREJU1($G(REJ(IDX,"CARDHOLDER ID")))
"RTN","PSOREJUT",136,0)
 . . S DATA("PLAN CONTACT")=$$CLEAN^PSOREJU1($G(REJ(IDX,"PLAN CONTACT")))
"RTN","PSOREJUT",137,0)
 . . S DATA("PREVIOUS FILL")=$$CLEAN^PSOREJU1($$DAT^PSOREJU1($G(REJ(IDX,"PREVIOUS FILL DATE"))))
"RTN","PSOREJUT",138,0)
 . . S DATA("OTHER REJECTS")=$$CLEAN^PSOREJU1($$OTH^PSOREJU1(CODE,$G(REJ(IDX,"REJ CODE LST"))))
"RTN","PSOREJUT",139,0)
 . . S DATA("RESPONSE IEN")=+$$CLEAN^PSOREJU1($G(REJ(IDX,"RESPONSE IEN")))
"RTN","PSOREJUT",140,0)
 . . S DATA("REASON SVC CODE")=$$REASON^PSOREJU2($G(REJ(IDX,"REASON")))
"RTN","PSOREJUT",141,0)
 . . D SAVE(RX,RFL,.DATA)
"RTN","PSOREJUT",142,0)
 L -^PSRX("REJ",RX)
"RTN","PSOREJUT",143,0)
 Q
"RTN","PSORENW")
0^58^B34935503
"RTN","PSORENW",1,0)
PSORENW ;BIR/SAB-renew main driver ;07/07/96
"RTN","PSORENW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,30,46,71,96,100,130,148**;DEC 1997
"RTN","PSORENW",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORENW",4,0)
 ;External references L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW",5,0)
 ;External reference to LK^ORX2 and ULK^ORX2 supported by DBIA 867
"RTN","PSORENW",6,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORENW",7,0)
 ;External reference to MAIN^TIUEDIT supported by DBIA 2410
"RTN","PSORENW",8,0)
 ;
"RTN","PSORENW",9,0)
ASK ;
"RTN","PSORENW",10,0)
 K PSORENW("FILL DATE") D FILLDT^PSODIR2(.PSORENW) S:$G(PSORENW("DFLG")) VALMSG="Renew Rx request canceled",VALMBCK="R"
"RTN","PSORENW",11,0)
 I PSORENW("DFLG")!('$D(PSORENW("FILL DATE"))) S PSORENW("QFLG")=1,PSORENW("DFLG")=0 G ASKX
"RTN","PSORENW",12,0)
 S PSORNW("FILL DATE")=PSORENW("FILL DATE")
"RTN","PSORENW",13,0)
 D MW^PSOCMOPA(.PSORENW)
"RTN","PSORENW",14,0)
 I PSORENW("DFLG") S PSORENW("QFLG")=1,PSORENW("DFLG")=0 G ASKX
"RTN","PSORENW",15,0)
 S PSORNW("MAIL/WINDOW")=PSORENW("MAIL/WINDOW") S PSORX("MAIL/WINDOW")=$S(PSORENW("MAIL/WINDOW")="M":"MAIL",1:"WINDOW")
"RTN","PSORENW",16,0)
 D NOORE^PSONEW(.PSORENW) S:$G(PSORENW("DFLG")) VALMSG="Renew Rx request canceled",VALMBCK="R"
"RTN","PSORENW",17,0)
 I PSORENW("DFLG")!('$D(PSORENW("FILL DATE"))) S PSORENW("QFLG")=1,PSORENW("DFLG")=0
"RTN","PSORENW",18,0)
ASKX Q
"RTN","PSORENW",19,0)
 ;
"RTN","PSORENW",20,0)
EOJ ;
"RTN","PSORENW",21,0)
 K VERB,RTE,DRET,PSOMSG,PSORNW,PSOLIST,PSORENW,PSORX("BAR CODE"),PSORX("FILL DATE"),PSODIR,PSOID,PSONOOR,PSOCOU,PSOCOUU,PSOID,PSOFDMX,PSODRUG,COPY,PSOBCKDR
"RTN","PSORENW",22,0)
 S RXN=$O(^TMP("PSORXN",$J,0)) I RXN D
"RTN","PSORENW",23,0)
 .S RXN1=^TMP("PSORXN",$J,RXN) D EN^PSOHLSN1(RXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSORENW",24,0)
 .I $P(^PSRX(RXN,"STA"),"^")=5 D EN^PSOHLSN1(RXN,"SC","ZS",$P(RXN1,"^",4))
"RTN","PSORENW",25,0)
 K RXN,RXN1,^TMP("PSORXN",$J)
"RTN","PSORENW",26,0)
 I $G(PSONOTE) D MAIN^TIUEDIT(3,.TIUDA,PSODFN,"","","","",1)
"RTN","PSORENW",27,0)
 K PSONOTE
"RTN","PSORENW",28,0)
 Q
"RTN","PSORENW",29,0)
OERR ;entry for renew backdoor
"RTN","PSORENW",30,0)
 I $$LMREJ^PSOREJU1($P(PSOLST(ORN),"^",2),,.VALMSG,.VALMBCK) Q
"RTN","PSORENW",31,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSORENW",32,0)
 K PSOPLCK S X=PSODFN_";DPT(" D LK^ORX2 I 'Y S VALMSG="Another person is entering orders for this patient.",VALMBCK="" D UL^PSSLOCK(PSODFN) Q
"RTN","PSORENW",33,0)
 K PSOID,PSOFDMX,PSORX("FILL DATE"),PSORENW("FILL DATE"),PSORX("QS"),PSORENW("QS"),PSOBARCD,COPY
"RTN","PSORENW",34,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG D ULPAT Q
"RTN","PSORENW",35,0)
 S PSOBCKDR=1,PSOFROM="NEW",PSORENW("OIRXN")=$P(PSOLST(ORN),"^",2),PSOOPT=3,(PSORENW("DFLG"),PSORENW("QFLG"),PSORX("DFLG"))=0
"RTN","PSORENW",36,0)
 S PSONEW("DAYS SUPPLY")=$P(^PSRX(PSORENW("OIRXN"),0),"^",8),PSONEW("# OF REFILLS")=$P(^(0),"^",9)
"RTN","PSORENW",37,0)
 D FULL^VALM1,ASK D:PSORENW("QFLG") KLIB^PSORENW1 D:PSORENW("QFLG") ULPAT D:PSORENW("QFLG") PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) G:PSORENW("QFLG") EOJ D ^PSORENW0
"RTN","PSORENW",38,0)
 D ULPAT,EOJ,KLIB^PSORENW1 K PSOOPT,PSONEW,PSORX("DFLG")
"RTN","PSORENW",39,0)
 Q
"RTN","PSORENW",40,0)
ULPAT K PSOMSG D UL^PSSLOCK(PSODFN) S X=PSODFN_";DPT(" D ULK^ORX2
"RTN","PSORENW",41,0)
 Q
"RTN","PSORENW",42,0)
RENEW(PLACER,PSOCPDRG) ;passes flag to CPRS for front door renews
"RTN","PSORENW",43,0)
 ;-1=couldn't find order, 0=unable to renew, 1=renewable
"RTN","PSORENW",44,0)
 ;Placer=Pharmacy number
"RTN","PSORENW",45,0)
 N PSOSURX,PSORFRM,PSOLC,PSODRG,PSODRUG0,RXN,ST,PSONEWOI,PSOOLDOI,PSOIFLAG,PSOINA
"RTN","PSORENW",46,0)
 I $G(PLACER)["S"!('$G(PLACER)) Q "-1^Not a Valid Outpatient Medication Order."
"RTN","PSORENW",47,0)
 S RXN=PLACER I '$D(^PSRX(RXN,0)) Q "-1^Not a Valid Outpatient Medication Order."
"RTN","PSORENW",48,0)
 S RX0=^PSRX(RXN,0),PSODRG=+$P(^PSRX(RXN,0),"^",6),ST=+^("STA"),PSODRUG0=^PSDRUG(PSODRG,0)
"RTN","PSORENW",49,0)
 S PSOIFLAG=0,PSOOLDOI=+$P($G(^PSRX(RXN,"OR1")),"^"),PSONEWOI=+$P($G(^PSDRUG(+$G(PSODRG),2)),"^") I PSONEWOI,PSONEWOI'=PSOOLDOI S PSOIFLAG=1
"RTN","PSORENW",50,0)
 S PSOINA=$P($G(^PS(50.7,PSONEWOI,0)),"^",4)
"RTN","PSORENW",51,0)
 I PSOINA,DT>PSOINA Q "0^This Orderable Item has been Inactivated."
"RTN","PSORENW",52,0)
 I ST=5 S PSOSURX=$O(^PS(52.5,"B",RXN,0)) I PSOSURX,$P($G(^PS(52.5,PSOSURX,0)),"^",7)="L" Q "0^Rx loading into a CMOP Transmission."
"RTN","PSORENW",53,0)
 S X1=DT,X2=-120 D C^%DTC I $P($G(^PSRX(RXN,2)),"^",6)<X Q "0^Prescription Expired more than 120 Days."
"RTN","PSORENW",54,0)
 S X1=DT,X2=-120 D C^%DTC I $P($G(^PSRX(RXN,3)),"^",5),$P($G(^(3)),"^",5)<X,$P(^("STA"),"^")=12 Q "0^Prescription Discontinued more than 120 Days."
"RTN","PSORENW",55,0)
 I $G(PSOCPDRG),$G(PSOCPDRG)'=$G(PSODRG) Q "0^Drug Mismatch, Non-Renewable."
"RTN","PSORENW",56,0)
 N PSOOCPRX,PSOOLPF,PSOOLPD,PSONOSIG S PSOOCPRX=RXN D CDOSE^PSORENW0 I PSOOLPF Q "0^Non-Renewable, invalid Dosage of "_$G(PSOOLPD)
"RTN","PSORENW",57,0)
 I PSONOSIG Q "0^Non-Renewable, missing Sig."
"RTN","PSORENW",58,0)
 I $P($G(^PSDRUG(PSODRG,2)),"^",3)'["O" Q "0^Drug is No longer used by Outpatient Pharmacy."
"RTN","PSORENW",59,0)
 I $G(^PSDRUG(PSODRG,"I"))]"",DT>$G(^("I")) Q "0^This Drug has been Inactivated."
"RTN","PSORENW",60,0)
 I $P(PSODRUG0,"^",3)["A",$P(PSODRUG0,"^",3)'["B" Q "0^Non-Renewable Drug Narcotic."
"RTN","PSORENW",61,0)
 I $P(PSODRUG0,"^",3)["W" Q "0^Non-Renewable Drug."
"RTN","PSORENW",62,0)
 I $D(^PS(53,+$P(RX0,"^",3),0)),'$P(^(0),"^",5) Q "0^Non-Renewable Prescription."
"RTN","PSORENW",63,0)
 S PSOLC=$P(RX0,"^"),PSOLC=$E(PSOLC,$L(PSOLC)) I $A(PSOLC)'<90 Q "0^Max number of renewals (26) has been reached."
"RTN","PSORENW",64,0)
 I ST,ST'=2,ST'=5,ST'=6,ST'=11,ST'=12,ST'=14 Q "0^Prescritpion is in a Non-Renewable Status."
"RTN","PSORENW",65,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",4) Q "0^Duplicate Rx Renewal Request."
"RTN","PSORENW",66,0)
 I $O(^PS(52.41,"AQ",RXN,0)) Q "0^Duplicate Rx Renewal Request."
"RTN","PSORENW",67,0)
 K PSORFRM,PSOLC,PSODRG,PSODRUG0,RXN,ST
"RTN","PSORENW",68,0)
 Q 1_$S($G(PSOIFLAG):"^"_$G(PSONEWOI),1:"")
"RTN","PSORENW",69,0)
 ;
"RTN","PSORENW",70,0)
INST1 ;Set Pharmacy Instructions array
"RTN","PSORENW",71,0)
 N PSOTZ
"RTN","PSORENW",72,0)
 I $O(^PSRX(RXN,"PI",0)) S PHI=$G(^PSRX(RXN,"PI",0)),PSOTZ=0 D
"RTN","PSORENW",73,0)
 .F  S PSOTZ=$O(^PSRX(RXN,"PI",PSOTZ)) Q:PSOTZ=""  S PHI(PSOTZ)=$G(^PSRX(RXN,"PI",PSOTZ,0))
"RTN","PSORENW",74,0)
 Q
"RTN","PSORENW",75,0)
INST2 ;Set Instructions and Comments
"RTN","PSORENW",76,0)
 I '$G(PSORENW("OIRXN")) Q
"RTN","PSORENW",77,0)
 I $G(PSOFDR) Q
"RTN","PSORENW",78,0)
 N PSOPHL,PSOPRL
"RTN","PSORENW",79,0)
 I $O(^PSRX(PSORENW("OIRXN"),"PI",0)) K PHI S PHI=$G(^PSRX(PSORENW("OIRXN"),"PI",0)),PSOPHL="" D
"RTN","PSORENW",80,0)
 .F  S PSOPHL=$O(^PSRX(PSORENW("OIRXN"),"PI",PSOPHL)) Q:PSOPHL=""  S PHI(PSOPHL)=$G(^PSRX(PSORENW("OIRXN"),"PI",PSOPHL,0))
"RTN","PSORENW",81,0)
 I $O(^PSRX(PSORENW("OIRXN"),"PRC",0)) K PRC S PRC=$G(^PSRX(PSORENW("OIRXN"),"PRC",0)),PSOPRL="" D
"RTN","PSORENW",82,0)
 .F  S PSOPRL=$O(^PSRX(PSORENW("OIRXN"),"PRC",PSOPRL)) Q:PSOPRL=""  S PRC(PSOPRL)=$G(^PSRX(PSORENW("OIRXN"),"PRC",PSOPRL,0))
"RTN","PSORENW",83,0)
 Q
"RTN","PSORENW4")
0^59^B54619443
"RTN","PSORENW4",1,0)
PSORENW4 ;BIR/SAB - rx speed renew ;03/06/95
"RTN","PSORENW4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,37,64,46,75,71,100,130,117,152,148**;DEC 1997
"RTN","PSORENW4",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORENW4",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORENW4",5,0)
 ;External references L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORENW4",6,0)
 ;External reference to LK^ORX2 and ULK^ORX2 supported by DBIA 867
"RTN","PSORENW4",7,0)
SEL I $P(PSOPAR,"^",4)=0 S VALMSG="Renewing is NOT Allowed. Check Site Parameters!",VALMBCK="" Q
"RTN","PSORENW4",8,0)
 N VALMCNT I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!",VALMBCK="" Q
"RTN","PSORENW4",9,0)
 S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.") K PSOPLCK S VALMBCK="" Q
"RTN","PSORENW4",10,0)
 K PSOPLCK S X=PSODFN_";DPT(" D LK^ORX2 I 'Y S VALMSG="Another person is entering orders for this patient.",VALMBCK="" D UL^PSSLOCK(PSODFN) Q
"RTN","PSORENW4",11,0)
 K PRC,PHI,PSORX("EDIT"),PSOFDR,DIR,DUOUT,DIRUT,PSORNSPD S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" G SELQ
"RTN","PSORENW4",12,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,DTOUT I +Y S (SPEED,PSOOELSE,PSORNSPD)=1 D FULL^VALM1 S LST=Y D
"RTN","PSORENW4",13,0)
 .S (PSODIR("DFLG"),PSODIR("FIELD"))=0,PSOOPT=3,(PSORENW("DFLG"),PSORENW("QFLG"),PSORX("DFLG"))=0 D INIT Q:PSORENW("DFLG")
"RTN","PSORENW4",14,0)
 .F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""  S ORN=$P(LST,",",ORD) D:+PSOLST(ORN)=52 PROCESS S PSORENW("DFLG")=0
"RTN","PSORENW4",15,0)
 I '$G(PSOOELSE) S VALMBCK="" G SELQ
"RTN","PSORENW4",16,0)
 S VALMBCK="R"
"RTN","PSORENW4",17,0)
 D ^PSOBUILD,BLD^PSOORUT1 K DIR,DIRUT,DTOUT,DUOUT,LST,ORD,IEN,ORN,RPH,ST,REFL,REF,PSOACT,ORSV,PSORNW,PSORENW,PSONO,PSOCO,PSOCU,PSODIR,DSMSG,SPEED,PSORENW,PSOOELSE,PSOOPT,PSORX("FILL DATE"),PSORX("ISSUE DATE"),PSOID,PSOMSG,PSORX("DFLG"),PSOQTY
"RTN","PSORENW4",18,0)
SELQ K PSORNSPD,RTE,DRET,PRC,PHI S X=PSODFN_";DPT(" D ULK^ORX2,UL^PSSLOCK(PSODFN),CLEAN^PSOVER1
"RTN","PSORENW4",19,0)
 Q
"RTN","PSORENW4",20,0)
 ;
"RTN","PSORENW4",21,0)
PROCESS ; Process one order at a time
"RTN","PSORENW4",22,0)
 I $$LMREJ^PSOREJU1($P(PSOLST(ORN),"^",2)) W $C(7),!!,"Rx "_$$GET1^DIQ(52,$P(PSOLST(ORN),"^",2),.01)_" has OPEN/UNRESOLVED 3rd Party Payer Rejects!" K DIR,PSOMSG D PAUSE^VALM1 Q
"RTN","PSORENW4",23,0)
 D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) W $C(7),!!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing Rx "_$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^")),! K DIR,PSOMSG D PAUSE^VALM1 Q
"RTN","PSORENW4",24,0)
 K RET,DRET,PRC,PHI S PSORENW("OIRXN")=$P(PSOLST(ORN),"^",2),PSOFROM="NEW"
"RTN","PSORENW4",25,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN")),SIGOK=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^",2)
"RTN","PSORENW4",26,0)
 I SIGOK F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORENW("OIRXN"),"SIG1",I,0)
"RTN","PSORENW4",27,0)
 S PSOIBOLD=$G(PSORENW("OIRXN")) D SETIB^PSORENW1
"RTN","PSORENW4",28,0)
 I '$G(PSORENW("PROVIDER")) D
"RTN","PSORENW4",29,0)
 .S PSORENW("PROVIDER")=$P(PSORENW("RX0"),"^",4)
"RTN","PSORENW4",30,0)
 .S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW4",31,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW4",32,0)
 I '$G(PSORENW("CLINIC")) S PSORENW("CLINIC")=$P(PSORENW("RX0"),"^",5)
"RTN","PSORENW4",33,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")
"RTN","PSORENW4",34,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^")
"RTN","PSORENW4",35,0)
 S PSORENW("PSODFN")=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW4",36,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW4",37,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6)
"RTN","PSORENW4",38,0)
 S PSORENW("QTY")=$P(PSORENW("RX0"),"^",7)
"RTN","PSORENW4",39,0)
 ;S PSORENW("DAYS SUPPLY")=$P(PSORENW("RX0"),"^",8)
"RTN","PSORENW4",40,0)
 ;S PSORENW("# OF REFILLS")=$P(PSORENW("RX0"),"^",9)
"RTN","PSORENW4",41,0)
 S PSORENW("INS")=$S($G(PSORENW("ENT"))]"":PSORENW("ENT"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW4",42,0)
 S:$G(PSORENW("ENT"))']"" PSORENW("ENT")=0
"RTN","PSORENW4",43,0)
 F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW4",44,0)
 .S PSORENW("ENT")=PSORENW("ENT")+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW4",45,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW4",46,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW4",47,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW4",48,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW4",49,0)
 .K DOSE
"RTN","PSORENW4",50,0)
 I $P($G(^PSDRUG(PSORENW("DRUG IEN"),"CLOZ1")),"^")="PSOCLO1",$P(^VA(200,PSORENW("PROVIDER"),"PS"),"^",2)'?2U7N D  D KLIB^PSORENW1 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSORENW4",51,0)
 .W $C(7),!!,"Only providers with DEA numbers can write prescriptions for clozaril.",!
"RTN","PSORENW4",52,0)
 I $G(PSORNW("MAIL/WINDOW"))]"" S PSORENW("MAIL/WINDOW")=PSORNW("MAIL/WINDOW")
"RTN","PSORENW4",53,0)
 I $O(^PSRX(PSORENW("OIRXN"),"PI",0)) D  K T
"RTN","PSORENW4",54,0)
 .S PHI=^PSRX(PSORENW("OIRXN"),"PI",0),T=0
"RTN","PSORENW4",55,0)
 .F  S T=$O(^PSRX(PSORENW("OIRXN"),"PI",T)) Q:'T  S PHI(T)=^PSRX(PSORENW("OIRXN"),"PI",T,0)
"RTN","PSORENW4",56,0)
 I $O(^PSRX(PSORENW("OIRXN"),"PRC",0)) D  K T
"RTN","PSORENW4",57,0)
 .S PRC=^PSRX(PSORENW("OIRXN"),"PRC",0),T=0
"RTN","PSORENW4",58,0)
 .F  S T=$O(^PSRX(PSORENW("OIRXN"),"PRC",T)) Q:'T  S PRC(T)=^PSRX(PSORENW("OIRXN"),"PRC",T,0)
"RTN","PSORENW4",59,0)
 W !!,"Now Renewing Rx # "_PSORENW("ORX #")_"   Drug: "_$P($G(^PSDRUG(+$G(PSORENW("DRUG IEN")),0)),"^"),!
"RTN","PSORENW4",60,0)
 I '$P($G(^PSDRUG($P(PSORENW("RX0"),"^",6),2)),"^") D  G:$G(PSORENW("DFLG")) PROCESSX
"RTN","PSORENW4",61,0)
 .I $P($G(^PSRX(PSORENW("OIRXN"),"OR1")),"^") S PSODRUG("OI")=$P(^PSRX(PSORENW("OIRXN"),"OR1"),"^"),PSODRUG("OIN")=$P(^PS(50.7,+^("OR1"),0),"^") Q
"RTN","PSORENW4",62,0)
 .W !!,"Cannot Renew!!  No Pharmacy Orderable Item!" S VALMSG="Cannot Renew!!  No Pharmacy Orderable Item!",PSORX("DFLG")=1
"RTN","PSORENW4",63,0)
 D CHECK^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",64,0)
 D FILDATE^PSORENW0
"RTN","PSORENW4",65,0)
 D DRUG^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",66,0)
 D RXN^PSORENW0 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",67,0)
 D STOP^PSORENW1
"RTN","PSORENW4",68,0)
DSPL K PSOEDT,PSOLM S PSDY=PSORENW("DAYS SUPPLY"),PSRF=PSORENW("# OF REFILLS")
"RTN","PSORENW4",69,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S PSODIR("CS")=1
"RTN","PSORENW4",70,0)
 I $G(PSODIR("CS")) D
"RTN","PSORENW4",71,0)
 .S PSORENW("# OF REFILLS")=$S(PSDY<60:5,PSDY'<60&(PSDY'>89):2,PSDY=90:1,1:0)
"RTN","PSORENW4",72,0)
 .I PSORENW("# OF REFILLS")>PSRF S PSORENW("# OF REFILLS")=PSRF
"RTN","PSORENW4",73,0)
 D DSPLY^PSORENW3 G:PSORENW("DFLG") PROCESSX
"RTN","PSORENW4",74,0)
 D:$D(^XUSEC("PSORPH",DUZ))!('$P(PSOPAR,"^",2)) VER1^PSOORNE4(.PSORENW) G:PSORENW("DFLG")=1 PROCESSX
"RTN","PSORENW4",75,0)
 I $G(PSOQTY) D QTY^PSODIR1(.PSORENW) G:PSORENW("DFLG")=1 PROCESSX
"RTN","PSORENW4",76,0)
 D EN^PSORN52(.PSORENW)
"RTN","PSORENW4",77,0)
 D RNPSOSD^PSOUTIL
"RTN","PSORENW4",78,0)
 D CAN^PSORENW0,DCORD^PSONEW2
"RTN","PSORENW4",79,0)
 S PSORENW("# OF REFILLS")=PSRF K PSDY,PSRF,PSODIR("CS"),DEA,PSORENW("ENT")
"RTN","PSORENW4",80,0)
 S BBRN="",BBRN1=$O(^PSRX("B",PSORENW("NRX #"),BBRN)) I $P($G(^PSRX(BBRN1,0)),"^",11)["W" S BINGCRT="Y",BINGRTE="W",BBFLG=1,BBRX(1)=$G(BBRX(1))_BBRN1_","
"RTN","PSORENW4",81,0)
PROCESSX I PSORENW("DFLG") D  W:'$G(POERR) !,$C(7),"Rx NOT RENEWED. RENEWED RX DELETED",! S POERR("DFLG")=1 D CLEAN^PSOVER1
"RTN","PSORENW4",82,0)
 .K PHI,PRC,PSODRUG,SIG,PSORXED,SIGOK
"RTN","PSORENW4",83,0)
 .K PSORENW("DOSE"),PSORENW("DURATION"),PSORENW("DRUG IEN"),PSORENW("ENT"),PSORENW("INS"),PSORENW("NOUN"),PSORENW("ROUTE"),PSORENW("SCHEDULE"),PSORENW("SIG"),PSORENW("VERB"),PSORENW("UNITS")
"RTN","PSORENW4",84,0)
 .K DIR,DIRUT,DTOUT S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DIRUT,DTOUT
"RTN","PSORENW4",85,0)
 K PSORDLOK I PSORENW("DFLG") S PSORDLOK=1
"RTN","PSORENW4",86,0)
 D:$G(PSORENW("OLD FILL DATE"))]"" SUSDATEK^PSOUTIL(.PSORENW)
"RTN","PSORENW4",87,0)
 K BBRN,BBRN1,PSODRUG,PSORX("PROVIDER NAME"),PSORX("CLINIC")
"RTN","PSORENW4",88,0)
 K PSOEDT,PSOLM S:$G(PSORENW("FROM"))="" (PSORENW("DFLG"),PSORENW("QFLG"))=0
"RTN","PSORENW4",89,0)
 I $G(PSORDLOK) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSORENW4",90,0)
 D KLIB^PSORENW1
"RTN","PSORENW4",91,0)
 K PSORDLOK
"RTN","PSORENW4",92,0)
 S RXN=$O(^TMP("PSORXN",$J,0)) I RXN D
"RTN","PSORENW4",93,0)
 .S RXN1=^TMP("PSORXN",$J,RXN) D EN^PSOHLSN1(RXN,$P(RXN1,"^"),$P(RXN1,"^",2),"",$P(RXN1,"^",3))
"RTN","PSORENW4",94,0)
 .I $P(^PSRX(RXN,"STA"),"^")=5 D EN^PSOHLSN1(RXN,"SC","ZS",$P(RXN1,"^",4))
"RTN","PSORENW4",95,0)
 K RXN,RXN1,^TMP("PSORXN",$J)
"RTN","PSORENW4",96,0)
 Q
"RTN","PSORENW4",97,0)
INIT ;
"RTN","PSORENW4",98,0)
 D ASK Q:PSORENW("DFLG")
"RTN","PSORENW4",99,0)
 D NOORE^PSONEW(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",100,0)
 Q
"RTN","PSORENW4",101,0)
ASK ;upfront questions
"RTN","PSORENW4",102,0)
 W !! D ISSDT^PSODIR2(.PSORENW) Q:PSORENW("DFLG")  S PSORENW("ISSUE DATE")=PSOID
"RTN","PSORENW4",103,0)
 D FILLDT^PSODIR2(.PSORENW) K PSONEW("DAYS SUPPLY"),PSONEW("# OF REFILLS") Q:PSORENW("DFLG")
"RTN","PSORENW4",104,0)
 S PSORNW("FILL DATE")=PSORENW("FILL DATE")
"RTN","PSORENW4",105,0)
 D MW^PSODIR2(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",106,0)
 D PTSTAT^PSODIR1(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",107,0)
 D DAYS^PSODIR1(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",108,0)
 S PSODRUG("DEA")=0 D REFILL^PSODIR1(.PSORENW) K PSODRUG("DEA") Q:PSORENW("DFLG")
"RTN","PSORENW4",109,0)
 K DIR,DIRUT S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you want to edit Renewed Rx(s) QTY " D ^DIR I $D(DIRUT) S PSORENW("DFLG")=1 K DIR,DIRUT Q
"RTN","PSORENW4",110,0)
 S PSOQTY=Y K DIR,DIRUT
"RTN","PSORENW4",111,0)
 D CLINIC^PSODIR2(.PSORENW) Q:PSORENW("DFLG")
"RTN","PSORENW4",112,0)
 D PROV^PSODIR(.PSORENW) S:PSORENW("DFLG") PSORENW("DFLG")=0
"RTN","PSORENW4",113,0)
 Q
"RTN","PSORESK")
0^15^B58029902
"RTN","PSORESK",1,0)
PSORESK ;BIR/SAB-return to stock ;03/31/93
"RTN","PSORESK",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,9,27,40,47,55,85,130,185,184,196,148**;DEC 1997
"RTN","PSORESK",3,0)
 ;
"RTN","PSORESK",4,0)
 ;REF/IA
"RTN","PSORESK",5,0)
 ;^PSDRUG/221
"RTN","PSORESK",6,0)
 ;^PS(59.7/694
"RTN","PSORESK",7,0)
 ;L, UL, PSOL, and PSOUL^PSSLOCK/2789
"RTN","PSORESK",8,0)
 ;^PS(55/2228
"RTN","PSORESK",9,0)
 ;PSDRTS^PSDOPT0/3064
"RTN","PSORESK",10,0)
AC I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) W !!,"Outpatient Pharmacy Site Parameters are required!" Q
"RTN","PSORESK",11,0)
 S RESK=1 K PSODEF,^UTILITY($J,"PSOPCE") S PSOPCECT=1
"RTN","PSORESK",12,0)
BC K PSOWHERE,PSODEFLG,PSOINVTX,XTYPE W !! S DIR("A")="Enter/Wand PRESCRIPTION number",DIR("?")="^D HP^PSORESK1",DIR(0)="FO" D ^DIR K DIR I $D(DIRUT) K PSODEF G EX
"RTN","PSORESK",13,0)
 I X'["-" D BCI W:'$G(RXP) !,"INVALID Rx" G:'$G(RXP) BC G BC1
"RTN","PSORESK",14,0)
 I X["-" D  I $P(X,"-")'=$G(PSORESST) W !,$C(7),$C(7),"   INVALID STATION NUMBER !!",$C(7),$C(7),! K PSORESST G BC
"RTN","PSORESK",15,0)
 .K PSORESST S PSORESSX=$G(X) K PSORESAR S DA=$P($$SITE^VASITE(),"^") I $G(DA) S DIC=4,DIQ(0)="I",DIQ="PSORESAR",DR="99" D EN^DIQ1 S PSORESST=$G(PSORESAR(4,DA,99,"I")) K PSORESAR,DIQ,DA,DR S X=$G(PSORESSX) K PSORESSX
"RTN","PSORESK",16,0)
 I X["-" S RXP=$P(X,"-",2) I '$D(^PSRX(+$G(RXP),0))!($G(RXP)']"") W !,$C(7),$C(7),$C(7),"   NON-EXISTENT Rx" G BC
"RTN","PSORESK",17,0)
 G:$D(^PSRX(RXP,0)) BC1 W !,$C(7),$C(7),$C(7),"   IMPROPER BARCODE FORMAT" G BC
"RTN","PSORESK",18,0)
BC1 ;
"RTN","PSORESK",19,0)
 S PSORRDFN=+$P($G(^PSRX(RXP,0)),"^",2)
"RTN","PSORESK",20,0)
 D ICN^PSODPT(PSORRDFN)
"RTN","PSORESK",21,0)
 S PSOPLCK=$$L^PSSLOCK(PSORRDFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY K PSOPLCK G BC
"RTN","PSORESK",22,0)
 K PSOPLCK D PSOL^PSSLOCK(RXP) I '$G(PSOMSG) W !!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),! K PSOMSG D UL^PSSLOCK(+$G(PSORRDFN)) G BC
"RTN","PSORESK",23,0)
 S PSOLOUD=1 D:$P($G(^PS(55,+$P(^PSRX(RXP,0),"^",2),0)),"^",6)'=2 EN^PSOHLUP($P(^PSRX(RXP,0),"^",2)) K PSOLOUD
"RTN","PSORESK",24,0)
 I $S('+$P($G(^PSRX(+RXP,"STA")),"^"):0,$P(^("STA"),"^")=11:0,$P(^("STA"),"^")=12:0,$P(^("STA"),"^")=14:0,$P(^("STA"),"^")=15:0,1:1) D STAT^PSORESK1 D UL G BC
"RTN","PSORESK",25,0)
 S COPAYFLG=1,QDRUG=$P($G(^PSRX(RXP,0)),"^",6),QTY=$P($G(^(0)),"^",7) I $O(^PSRX(RXP,1,0)) G REF
"RTN","PSORESK",26,0)
 S Y="O" I $O(^PSRX(RXP,"P",0)) D  I $D(DUOUT)!($D(DTOUT)) D UL G BC
"RTN","PSORESK",27,0)
 .S DIR(0)="SA^O:ORIGINAL;P:PARTIAL",DIR("B")="ORIGINAL",DIR("A",1)="",DIR("A",2)="There are Partials for this Rx.",DIR("A")="Which are you Returning To Stock? "
"RTN","PSORESK",28,0)
 .S DIR("?")=" Press return for Original. Enter 'P' for Partial" D ^DIR K DIR
"RTN","PSORESK",29,0)
 S XTYPE=$S(Y="O":"O",1:"P") G:Y="P" PAR
"RTN","PSORESK",30,0)
 I $P($G(^PSRX(RXP,2)),"^",15) D  G BC
"RTN","PSORESK",31,0)
 .W !,$C(7),$C(7),"Original fill for Rx # "_$P(^PSRX(RXP,0),"^")_" was Returned to Stock." D UL
"RTN","PSORESK",32,0)
 I '$P($G(^PSRX(RXP,2)),"^",13) W !,$C(7),$C(7),"Rx # "_$P(^PSRX(RXP,0),"^")_" was NOT released !" D UL G BC
"RTN","PSORESK",33,0)
 S PSOLOCRL=$P($G(^PSRX(RXP,2)),"^",13),PSOWHERE=$S($D(^PSRX("AR",+$G(PSOLOCRL),RXP,0)):1,1:0)
"RTN","PSORESK",34,0)
 W ! S DIR("B")="YES",DIR("A",1)="Are you sure you want to RETURN TO STOCK Rx # "_$P(^PSRX(RXP,0),"^")
"RTN","PSORESK",35,0)
 S DIR("A",2)="for "_$P(^DPT($P(^PSRX(RXP,0),"^",2),0),"^")_" ("_$E($P(^(0),"^",9),6,9)_")",DIR("A")="Drug: "_$P(^PSDRUG($P(^PSRX(RXP,0),"^",6),0),"^")
"RTN","PSORESK",36,0)
 I $G(PSOWHERE) S DIR("A",3)=" ",DIR("A",4)="   *** This prescription was filled at the CMOP *** ",DIR("A",5)=" "
"RTN","PSORESK",37,0)
 S DIR(0)="YO" D ^DIR K DIR I Y=0!($D(DIRUT)) D UL G BC
"RTN","PSORESK",38,0)
 ;ORI
"RTN","PSORESK",39,0)
 D  D UL,EX S (RESK,PSOPCECT)=1 G BC
"RTN","PSORESK",40,0)
 .;VMP OIFO BAY PINES;PSO*7.0*196;KILL PSDS
"RTN","PSORESK",41,0)
 .I $T(PSDRTS^PSDOPT0)]"" D PSDRTS^PSDOPT0(RXP,"O^"_0,$P(^PSRX(RXP,2),"^",9),$P(^PSRX(RXP,0),"^",7)) D MSG K PSDS
"RTN","PSORESK",42,0)
 .Q:$G(RETSK)
"RTN","PSORESK",43,0)
 .K PSOINVTX,PSODEFLG I $G(PSOWHERE),$G(^PSDRUG(QDRUG,660.1)) D INVT^PSORXDL I $G(PSODEFLG) W !!?5,"Prescription Not Returned to Stock!",! Q
"RTN","PSORESK",44,0)
 .I +$G(^PSRX(RXP,"IB")) D CP^PSORESK1 Q:'$G(COPAYFLG)
"RTN","PSORESK",45,0)
 .;Ask comments until answered, do not allow exiting.
"RTN","PSORESK",46,0)
 .F  D  I '$D(DIRUT) Q
"RTN","PSORESK",47,0)
 ..K DIR,DUOUT,DTOUT,DIRUT,X,Y
"RTN","PSORESK",48,0)
 ..S DIR(0)="F0^10:75",DIR("A")="Comments",DIR("?")="Comments are required, 10-75 characters."
"RTN","PSORESK",49,0)
 ..S DIR("B")=$S($D(PSODEF):PSODEF,1:"Per Pharmacy Request")
"RTN","PSORESK",50,0)
 ..D ^DIR I $D(DIRUT) W !?5,"Comments are required, 10-75 characters.",! Q
"RTN","PSORESK",51,0)
 ..S (PSODEF,COM)=$G(Y) K DIR,X,Y
"RTN","PSORESK",52,0)
 ..Q
"RTN","PSORESK",53,0)
 .I $G(^PSDRUG(QDRUG,660.1)) D
"RTN","PSORESK",54,0)
 ..I $G(PSOWHERE),'$G(PSOINVTX) Q
"RTN","PSORESK",55,0)
 ..S ^PSDRUG(QDRUG,660.1)=^PSDRUG(QDRUG,660.1)+QTY
"RTN","PSORESK",56,0)
 .I $G(PSOWHERE) K ^PSRX("AR",+$G(PSOLOCRL),RXP,0)
"RTN","PSORESK",57,0)
 .D NOW^%DTC S DA=RXP,DA=RXP,DIE="^PSRX(",DR="31///@;32.1///"_% D ^DIE K DIE,DR,DA Q:$D(Y)
"RTN","PSORESK",58,0)
 .D ACT^PSORESK1 S DA=$O(^PS(52.5,"B",RXP,0)) I DA S DIK="^PS(52.5," D ^DIK
"RTN","PSORESK",59,0)
 .D REVERSE^PSOBPSU1(RXP,0,"RS",4,,1)
"RTN","PSORESK",60,0)
 .D EN^PSOHLSN1(RXP,"ZD") W !,"Rx # "_$P(^PSRX(RXP,0),"^")_" Returned to Stock.",!
"RTN","PSORESK",61,0)
 .Q
"RTN","PSORESK",62,0)
 ;
"RTN","PSORESK",63,0)
REF I $O(^PSRX(RXP,1,0)),$O(^PSRX(RXP,"P",0)) D  I $D(DTOUT)!($D(DUOUT)) D UL G BC
"RTN","PSORESK",64,0)
 .S DIR(0)="SA^R:REFILL;P:PARTIAL",DIR("B")="REFILL",DIR("A",1)="",DIR("A",2)="There are Refills and Partials for this Rx.",DIR("A")="Which are you Returning To Stock? "
"RTN","PSORESK",65,0)
 .S DIR("?")=" Press return for Refill. Enter 'P' for Partial" D ^DIR K DIR
"RTN","PSORESK",66,0)
 I $O(^PSRX(RXP,1,0)),$O(^PSRX(RXP,"P",0)) S XTYPE=$S(Y="R":1,1:"P")
"RTN","PSORESK",67,0)
PAR S:$G(XTYPE)']"" XTYPE=1 S TYPE=0 F YY=0:0 S YY=$O(^PSRX(RXP,XTYPE,YY)) Q:'YY  S TYPE=YY
"RTN","PSORESK",68,0)
 I 'TYPE D UL,EX S (RESK,PSOPCECT)=1 G BC
"RTN","PSORESK",69,0)
 I $P($G(^PSRX(RXP,XTYPE,TYPE,0)),"^",16) W $C(7),!!,"Last Fill Already Returned to Stock !",! D UL,EX S (RESK,PSOPCECT)=1 G BC
"RTN","PSORESK",70,0)
 I '$P(^PSRX(RXP,XTYPE,TYPE,0),"^",$S(XTYPE:18,1:19)) W !!,$C(7),$C(7),$S(XTYPE:"Refill",1:"PARTIAL")_" #"_TYPE_" was NOT released !",! D UL G BC
"RTN","PSORESK",71,0)
 W ! K DIR,DUOUT,DTOUT
"RTN","PSORESK",72,0)
 K PSOLOCRL,PSOWHERE I $G(XTYPE) S PSOLOCRL=$P($G(^PSRX(RXP,XTYPE,+$G(TYPE),0)),"^",18),PSOWHERE=$S($D(^PSRX("AR",+$G(PSOLOCRL),RXP,+$G(TYPE))):1,1:0)
"RTN","PSORESK",73,0)
 W ! S DIR("B")="YES",DIR("A",1)="Are you sure you want to RETURN TO STOCK Rx # "_$P(^PSRX(RXP,0),"^")_$S(XTYPE:" Refill ",1:" Partial ")_"# "_TYPE,DIR(0)="Y"
"RTN","PSORESK",74,0)
 S DIR("A",2)="for "_$P(^DPT($P(^PSRX(RXP,0),"^",2),0),"^")_" ("_$E($P(^(0),"^",9),6,9)_")",DIR("A")="Drug: "_$P(^PSDRUG($P(^PSRX(RXP,0),"^",6),0),"^")
"RTN","PSORESK",75,0)
 I $G(PSOWHERE) S DIR("A",3)=" ",DIR("A",4)="   *** This prescription was filled at the CMOP *** ",DIR("A",5)=" "
"RTN","PSORESK",76,0)
 D ^DIR K DIR I 'Y!($D(DUOUT))!($D(DTOUT)) D UL G BC
"RTN","PSORESK",77,0)
 I $T(PSDRTS^PSDOPT0)]"" D
"RTN","PSORESK",78,0)
 .;VMP OIFO BAY PINES;PSO*7.0*196;KILL PSDS
"RTN","PSORESK",79,0)
 .I XTYPE D PSDRTS^PSDOPT0(RXP,"R^"_TYPE,$P(^PSRX(RXP,1,TYPE,0),"^",9),$P(^(0),"^",4)) D MSG K PSDS Q
"RTN","PSORESK",80,0)
 .D PSDRTS^PSDOPT0(RXP,"P^"_TYPE,$P(^PSRX(RXP,"P",TYPE,0),"^",9),$P(^(0),"^",4)) D MSG K PSDS
"RTN","PSORESK",81,0)
 I $G(RETSK) D UL,EX G BC
"RTN","PSORESK",82,0)
 K PSOINVTX,PSODEFLG I $G(PSOWHERE),$G(^PSDRUG(QDRUG,660.1)) D INVT^PSORXDL I $G(PSODEFLG) W !!?5,"Prescription Not Returned to Stock!",! D UL G BC
"RTN","PSORESK",83,0)
 I +$G(^PSRX(RXP,"IB")),XTYPE D CP^PSORESK1 I '$G(COPAYFLG) D UL G BC
"RTN","PSORESK",84,0)
 ;Ask comments until answered, do not allow exiting.
"RTN","PSORESK",85,0)
 F  D  I '$D(DIRUT) Q
"RTN","PSORESK",86,0)
 .K DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","PSORESK",87,0)
 .S DIR(0)="F0^10:75",DIR("A")="Comments",DIR("?")="Comments are required, 10-75 characters."
"RTN","PSORESK",88,0)
 .S DIR("B")=$S($D(PSODEF):PSODEF,1:"Per Pharmacy Request")
"RTN","PSORESK",89,0)
 .D ^DIR K DIR I $D(DIRUT) W !?5,"Comments are required, 10-75 characters.",! Q
"RTN","PSORESK",90,0)
 .Q
"RTN","PSORESK",91,0)
 S (PSODEF,COM)=$G(Y) K X,Y
"RTN","PSORESK",92,0)
 D NOW^%DTC S QTY=$P(^PSRX(RXP,XTYPE,TYPE,0),"^",4) I $G(^PSDRUG(QDRUG,660.1)) D
"RTN","PSORESK",93,0)
 .I $G(PSOWHERE),'$G(PSOINVTX) Q
"RTN","PSORESK",94,0)
 .S ^PSDRUG(QDRUG,660.1)=^PSDRUG(QDRUG,660.1)+$G(QTY)
"RTN","PSORESK",95,0)
 I $G(PSOWHERE) K ^PSRX("AR",+$G(PSOLOCRL),RXP,$G(TYPE))
"RTN","PSORESK",96,0)
 I XTYPE D REVERSE^PSOBPSU1(RXP,TYPE,"RS",4,,1)
"RTN","PSORESK",97,0)
 S DA(1)=RXP,DA=TYPE,DIE="^PSRX("_DA(1)_","_$S(XTYPE:1,1:"""P""")_",",DR=$S(XTYPE:"17////@",1:"8////@")_";.01///@"
"RTN","PSORESK",98,0)
 W ! D ^DIE I $D(Y) D UL G BC
"RTN","PSORESK",99,0)
 D:XTYPE'="P" NPF D ACT^PSORESK1
"RTN","PSORESK",100,0)
 W !!,"Rx # "_$P(^PSRX(RXP,0),"^")_$S(XTYPE:" REFILL",1:" PARTIAL")_" #"_TYPE_" Returned to Stock" S DA=$O(^PS(52.5,"B",RXP,0)) I DA S DIK="^PS(52.5," D ^DIK
"RTN","PSORESK",101,0)
 K PSODISPP S:'$G(XTYPE) PSODISPP=1 D EN^PSOHLSN1(RXP,"ZD") K PSODISPP
"RTN","PSORESK",102,0)
 D UL G BC
"RTN","PSORESK",103,0)
EX ;
"RTN","PSORESK",104,0)
 K DA,DR,DIE,X,X1,X2,Y,RXP,REC,DIR,XDT,REC,RDUZ,DIRUT,PSOCPN,PSOCPRX,YY,QDRUG,QTY,TYPE,XTYPE,I,%,DIRUT,COPAYFLG,PSOINVTX,RESK,PSOPCECT,COM,PSOWHERE,PSOLOCRL,PSODEFLG,PSORRDFN,PSOMSG,PSOPLCK,PSDCS,PSDRS,RETSK
"RTN","PSORESK",105,0)
 Q
"RTN","PSORESK",106,0)
MSG I $G(PSDCS),'$G(PSDRS) W !!,"The PSDMGR key is required to return a CONTROLLED SUBSTANCE Rx to stock and",!,"update corresponding vault balances." S RETSK=1
"RTN","PSORESK",107,0)
 Q
"RTN","PSORESK",108,0)
BCI S RXP=0
"RTN","PSORESK",109,0)
RXP S RXP=$O(^PSRX("B",X,RXP)) I $P($G(^PSRX(+RXP,"STA")),"^")=13 G RXP
"RTN","PSORESK",110,0)
 Q
"RTN","PSORESK",111,0)
UL ;
"RTN","PSORESK",112,0)
 I $G(RXP) D PSOUL^PSSLOCK(RXP)
"RTN","PSORESK",113,0)
 D UL^PSSLOCK(+$G(PSORRDFN))
"RTN","PSORESK",114,0)
 Q
"RTN","PSORESK",115,0)
NPF N PSOY I $G(TYPE)-1>0,+$P(^PSRX(RXP,1,TYPE-1,0),"^") D
"RTN","PSORESK",116,0)
 .S X1=+$P(^PSRX(RXP,1,$G(TYPE)-1,0),"^"),X2=$P(^PSRX(RXP,0),"^",8)-10\1
"RTN","PSORESK",117,0)
 .D C^%DTC S PSOY=X,X1=$P(^PSRX(RXP,2),"^",2),X2=TYPE*$P(^PSRX(RXP,0),"^",8)-10\1
"RTN","PSORESK",118,0)
 .D C^%DTC S X=$S(PSOY<X:X,1:PSOY)
"RTN","PSORESK",119,0)
 I $G(TYPE)-1<1 D
"RTN","PSORESK",120,0)
 .S X1=$P(^PSRX(RXP,2),"^",2),X2=$P(^PSRX(RXP,0),"^",8)-10\1
"RTN","PSORESK",121,0)
 .D C^%DTC S:$P(^PSRX(RXP,3),"^",8) X=""
"RTN","PSORESK",122,0)
 I $G(X) S DA=RXP,DIE=52,DR="102///"_X D ^DIE K DIE
"RTN","PSORESK",123,0)
 Q
"RTN","PSORN52")
0^16^B41220096
"RTN","PSORN52",1,0)
PSORN52 ;BIR/DSD - files renewal entries in prescription file ;08/09/93
"RTN","PSORN52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,11,27,37,46,79,71,100,117,157,143,219,148**;DEC 1997
"RTN","PSORN52",3,0)
 ;Ext ref to ^PS(55 sup by DBIA 2228
"RTN","PSORN52",4,0)
 ;Ext ref to PSOUL^PSSLOCK sup by DBIA 2789
"RTN","PSORN52",5,0)
 ;Ext ref to ^VA(200 sup by DBIA 10060
"RTN","PSORN52",6,0)
EN(PSOX) ;EP
"RTN","PSORN52",7,0)
START ;
"RTN","PSORN52",8,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Mon
"RTN","PSORN52",9,0)
 N PSOIBHLD,PSOSCOTH,PSOSCOTX S (PSOSCOTH,PSOSCOTX)=0 S PSOIBHLD="" I $G(PSOFDR),$G(ORD) D
"RTN","PSORN52",10,0)
 .S PSOIBHLD=$S($P($G(^PS(52.41,ORD,0)),"^",16)="SC":1,$P($G(^(0)),"^",16)="NSC":0,1:"")
"RTN","PSORN52",11,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",12,0)
 .N PSOIBHLX S PSOIBHLX=$G(^PS(52.41,ORD,"IBQ"))
"RTN","PSORN52",13,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^")=1:1,$P(PSOIBHLX,"^")=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",2)=1:1,$P(PSOIBHLX,"^",2)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",3)=1:1,$P(PSOIBHLX,"^",3)=0:0,1:"")
"RTN","PSORN52",14,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^",4)=1:1,$P(PSOIBHLX,"^",4)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",5)=1:1,$P(PSOIBHLX,"^",5)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",6)=1:1,$P(PSOIBHLX,"^",6)=0:0,1:"")
"RTN","PSORN52",15,0)
 .I $P(PSOIBHLX,"^")=1!($P(PSOIBHLX,"^",2)=1)!($P(PSOIBHLX,"^",3)=1)!($P(PSOIBHLX,"^",4)=1)!($P(PSOIBHLX,"^",5)=1)!($P(PSOIBHLX,"^",6)=1) S PSOSCOTH=1
"RTN","PSORN52",16,0)
 I $G(PSOSCOTH)!($G(PSORX("SC"))="SC")!($G(PSORX("SC"))="NSC") S PSOSCOTX=1
"RTN","PSORN52",17,0)
 K PSOSCP D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSORN52",18,0)
 I $G(PSOFDR),$G(ORD) I $D(^PS(52.41,ORD,"ICD")) S FILE=52.41 D GET^PSORN52D
"RTN","PSORN52",19,0)
 ;Set ans to renew from Rx, only if no ans from Pend file
"RTN","PSORN52",20,0)
 I $G(PSORENW("OIRXN")) D
"RTN","PSORN52",21,0)
 .N PSOLDIBQ S PSOLDIBQ=$G(^PSRX(PSORENW("OIRXN"),"IBQ"))
"RTN","PSORN52",22,0)
 .I $P(PSOIBHLD,"^")="" D
"RTN","PSORN52",23,0)
 ..I $P($G(^PSRX(PSORENW("OIRXN"),"IB")),"^")=2 S $P(PSOIBHLD,"^")=0
"RTN","PSORN52",24,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",25,0)
 .I PSOLDIBQ="" Q
"RTN","PSORN52",26,0)
 .D IBHLD^PSORN52A
"RTN","PSORN52",27,0)
 D INIT G:PSORN52("QFLG") END D FILE^PSORN52A
"RTN","PSORN52",28,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Mon
"RTN","PSORN52",29,0)
 K PSOANSQ,PSOANSQD,PSONEWFF
"RTN","PSORN52",30,0)
 I $G(PSOIBHLD)'="" D
"RTN","PSORN52",31,0)
 .;Set answers based on Pend Renew, prior to Phar call
"RTN","PSORN52",32,0)
 .Q:'$G(PSOX("IRXN"))
"RTN","PSORN52",33,0)
 .I $P(PSOIBHLD,"^")=1!($P(PSOIBHLD,"^")=0) S PSOANSQ("SC")=$P(PSOIBHLD,"^")
"RTN","PSORN52",34,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",35,0)
 .I $P(PSOIBHLD,"^",2)=1!($P(PSOIBHLD,"^",2)=0) S PSOANSQ(PSOX("IRXN"),"MST")=$P(PSOIBHLD,"^",2)
"RTN","PSORN52",36,0)
 .I $P(PSOIBHLD,"^",3)=1!($P(PSOIBHLD,"^",3)=0) S PSOANSQ(PSOX("IRXN"),"VEH")=$P(PSOIBHLD,"^",3)
"RTN","PSORN52",37,0)
 .I $P(PSOIBHLD,"^",4)=1!($P(PSOIBHLD,"^",4)=0) S PSOANSQ(PSOX("IRXN"),"RAD")=$P(PSOIBHLD,"^",4)
"RTN","PSORN52",38,0)
 .I $P(PSOIBHLD,"^",5)=1!($P(PSOIBHLD,"^",5)=0) S PSOANSQ(PSOX("IRXN"),"PGW")=$P(PSOIBHLD,"^",5)
"RTN","PSORN52",39,0)
 .I $P(PSOIBHLD,"^",6)=1!($P(PSOIBHLD,"^",6)=0) S PSOANSQ(PSOX("IRXN"),"HNC")=$P(PSOIBHLD,"^",6)
"RTN","PSORN52",40,0)
 .I $P(PSOIBHLD,"^",7)=1!($P(PSOIBHLD,"^",7)=0) S PSOANSQ(PSOX("IRXN"),"CV")=$P(PSOIBHLD,"^",7)
"RTN","PSORN52",41,0)
 K PSOIBHLD
"RTN","PSORN52",42,0)
 I '$G(PSOFDR) I $G(PSORENW("OIRXN")) S FILE=52 D GET^PSORN52D
"RTN","PSORN52",43,0)
 S PSONEW("NEWCOPAY")="" I PSOSCP<50 I '$P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7),$G(DUZ("AG"))="V" S PSOFLAG=0 D COPAY^PSOCPB
"RTN","PSORN52",44,0)
 I PSOSCP>49!($P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)=1) S PSOFLAG=0 D SC^PSOMLLD2
"RTN","PSORN52",45,0)
 I $$DT^PSOMLLDT D
"RTN","PSORN52",46,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D MESS D CV^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"CV")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",47,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D MESS D VEH^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"VEH")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",48,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D MESS D RAD^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"RAD")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",49,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D MESS D PGW^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"PGW")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",50,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D MESS D MST^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"MST")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",51,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D MESS D HNC^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"HNC")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",52,0)
 K PSOSCOTH,PSOSCOTX
"RTN","PSORN52",53,0)
 I $G(PSONEW("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=PSONEW("NEWCOPAY")
"RTN","PSORN52",54,0)
 ;
"RTN","PSORN52",55,0)
 D FINISH,ACP^PSOUTIL
"RTN","PSORN52",56,0)
 ;
"RTN","PSORN52",57,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ(PSOX("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"RAD"))
"RTN","PSORN52",58,0)
 S PSOSCFLD=PSOSCFLD_"^"_$G(PSOANSQ(PSOX("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"CV"))
"RTN","PSORN52",59,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="") S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD
"RTN","PSORN52",60,0)
 ;
"RTN","PSORN52",61,0)
 D FILE2^PSORN52D
"RTN","PSORN52",62,0)
 K PSONEW("NEWCOPAY"),PSOANSQ
"RTN","PSORN52",63,0)
END D EOJ
"RTN","PSORN52",64,0)
 Q
"RTN","PSORN52",65,0)
INIT S PSORN52("QFLG")=0 S:'$D(PSOX("DAYS SUPPLY")) PSOX("DAYS SUPPLY")=$P(PSOX("RX0"),"^",8)
"RTN","PSORN52",66,0)
 S:'$D(PSOX("# OF REFILLS")) PSOX("# OF REFILLS")=$P(PSOX("RX0"),"^",9) S:'$D(PSOX("ISSUE DATE")) PSOX("ISSUE DATE")=DT
"RTN","PSORN52",67,0)
 D INIT^PSON52 K PSON52
"RTN","PSORN52",68,0)
 Q
"RTN","PSORN52",69,0)
 ;
"RTN","PSORN52",70,0)
FINISH ;
"RTN","PSORN52",71,0)
 G:PSOX("STATUS")=4 FINISHP
"RTN","PSORN52",72,0)
 I $D(PSORX("VERIFY")) D  G FINISHX
"RTN","PSORN52",73,0)
 .K DIC,DLAYGO,DINUM,DIADD,X,DD,DO S DIC="^PS(52.4,",DLAYGO=52.4,DINUM=PSOX("IRXN"),DIC(0)="ML"
"RTN","PSORN52",74,0)
 .S X=PSOX("IRXN") D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM,X
"RTN","PSORN52",75,0)
 .S ^PS(52.4,PSOX("IRXN"),0)=PSOX("IRXN")_"^"_$P(PSOX("NRX0"),"^",2)_"^"_DUZ_"^"_$G(PSOX("OIRXN"))_"^"_$E(PSOX("LOGIN DATE"),1,7)_"^"_PSOX("IRXN")_"^"_PSOX("STOP DATE")
"RTN","PSORN52",76,0)
 .K DIK,DA S DIK="^PS(52.4,",DA=PSOX("IRXN") D IX^DIK K DIK,DA
"RTN","PSORN52",77,0)
 ;
"RTN","PSORN52",78,0)
 I $G(PSOX("QS"))="S",$G(PSOBARCD) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",79,0)
 ;
"RTN","PSORN52",80,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",81,0)
 ;
"RTN","PSORN52",82,0)
 ; - Submitting Rx to ECME for 3rd Party Billing
"RTN","PSORN52",83,0)
 N ACTION
"RTN","PSORN52",84,0)
 I $$SUBMIT^PSOBPSUT(PSOX("IRXN"),0) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSORN52",85,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSOX("IRXN"),0,PSOX("FILL DATE"),"RN")
"RTN","PSORN52",86,0)
 . I $$FIND^PSOREJUT(PSOX("IRXN"),0) D
"RTN","PSORN52",87,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSOX("IRXN"),0,"79,88","RN","IOQ","I")
"RTN","PSORN52",88,0)
 ;
"RTN","PSORN52",89,0)
 I $G(PSOX("QS"))="Q",$G(PSOBARCD) D  G FINISHX
"RTN","PSORN52",90,0)
 . N PSOFROM S PSOFROM="BATCH" I $G(PPL),$L(PPL_PSOX("IRXN")_",")>240 D TRI^PSOBBC D Q^PSORXL K PPL,RXFL
"RTN","PSORN52",91,0)
 .S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",92,0)
 . I $G(PPL) S PPL=PPL_PSOX("IRXN")_","
"RTN","PSORN52",93,0)
 . E  S PPL=PSOX("IRXN")_","
"RTN","PSORN52",94,0)
 . Q
"RTN","PSORN52",95,0)
FINISHP I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSORN52",96,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORN52",97,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSORN52",98,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSORN52",99,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",100,0)
FINISHX ;
"RTN","PSORN52",101,0)
 ;call to build bingo board Rx array
"RTN","PSORN52",102,0)
 S:'$G(PSORX("MAIL/WINDOW")) PSORX("MAIL/WINDOW")=$P(PSORENW("NRX0"),"^",11)
"RTN","PSORN52",103,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSORN52",104,0)
 K PSOX1,PSOX2
"RTN","PSORN52",105,0)
 Q
"RTN","PSORN52",106,0)
EOJ ;
"RTN","PSORN52",107,0)
 L -^PSRX("B",PSOX("IRXN")) K PSORN52,PSOX("INS"),PSORENW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT,PSOIBHLD,PSOX("SINS"),PSORENW("SINS"),PSORXED("SINS"),FILE
"RTN","PSORN52",108,0)
 D PSOUL^PSSLOCK(PSOX("IRXN")) D PSOUL^PSSLOCK(PSOX("OIRXN"))
"RTN","PSORN52",109,0)
 Q
"RTN","PSORN52",110,0)
MESS ;
"RTN","PSORN52",111,0)
 I $G(PSOSCOTX)=1&(PSOSCP<50) W:$G(PSODRUG("DEA"))'["S"&($G(PSODRUG("DEA"))'["I") !!,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! S PSOSCOTX=2
"RTN","PSORN52",112,0)
 Q
"RTN","PSORN52A")
0^27^B17618155
"RTN","PSORN52A",1,0)
PSORN52A ;IHS/DSD/JCM/SAB/FLS-Break up of PSORN52 ;08/09/93
"RTN","PSORN52A",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**157,148**;DEC 1997
"RTN","PSORN52A",3,0)
 Q  ; Call from tag
"RTN","PSORN52A",4,0)
 ;
"RTN","PSORN52A",5,0)
IBHLD ;
"RTN","PSORN52A",6,0)
 I $P(PSOIBHLD,"^",2)="" S $P(PSOIBHLD,"^",2)=$S($P(PSOLDIBQ,"^",2)=1:1,$P(PSOLDIBQ,"^",2)=0:0,1:"")
"RTN","PSORN52A",7,0)
 I $P(PSOIBHLD,"^",3)="" S $P(PSOIBHLD,"^",3)=$S($P(PSOLDIBQ,"^",3)=1:1,$P(PSOLDIBQ,"^",3)=0:0,1:"")
"RTN","PSORN52A",8,0)
 I $P(PSOIBHLD,"^",4)="" S $P(PSOIBHLD,"^",4)=$S($P(PSOLDIBQ,"^",4)=1:1,$P(PSOLDIBQ,"^",4)=0:0,1:"")
"RTN","PSORN52A",9,0)
 I $P(PSOIBHLD,"^",5)="" S $P(PSOIBHLD,"^",5)=$S($P(PSOLDIBQ,"^",5)=1:1,$P(PSOLDIBQ,"^",5)=0:0,1:"")
"RTN","PSORN52A",10,0)
 I $P(PSOIBHLD,"^",6)="" S $P(PSOIBHLD,"^",6)=$S($P(PSOLDIBQ,"^",6)=1:1,$P(PSOLDIBQ,"^",6)=0:0,1:"")
"RTN","PSORN52A",11,0)
 I $P(PSOIBHLD,"^",7)="" S $P(PSOIBHLD,"^",7)=$S($P(PSOLDIBQ,"^",7)=1:1,$P(PSOLDIBQ,"^",7)=0:0,1:"")
"RTN","PSORN52A",12,0)
 Q
"RTN","PSORN52A",13,0)
 ;
"RTN","PSORN52A",14,0)
FILE ; - Filling ^PSRX and ^PS(55 entries
"RTN","PSORN52A",15,0)
 S PSOX("NRX0")=PSORENW("RX0"),PSOX("NRX2")=PSORENW("RX2"),PSOX("NRX3")=PSORENW("RX3"),$P(PSOX("NRX3"),"^",5)=""
"RTN","PSORN52A",16,0)
 S $P(PSOX("NRX0"),"^")=PSOX("NRX #") S:$G(PSOX("PROVIDER"))]"" $P(PSOX("NRX0"),"^",4)=PSOX("PROVIDER")
"RTN","PSORN52A",17,0)
 I $G(PSORNSPD),$G(PSOX("PATIENT STATUS")),$G(PSOX("PATIENT STATUS"))?.N S $P(PSOX("NRX0"),"^",3)=PSOX("PATIENT STATUS")
"RTN","PSORN52A",18,0)
 S:$G(PSOX("COSIGNING PROVIDER"))]"" $P(PSOX("NRX3"),"^",3)=PSOX("COSIGNING PROVIDER")
"RTN","PSORN52A",19,0)
 S $P(PSOX("NRX0"),"^",5)=PSOX("CLINIC"),$P(PSOX("NRX0"),"^",9)=PSOX("# OF REFILLS")
"RTN","PSORN52A",20,0)
 I $G(PSOX("DAYS SUPPLY")) S $P(PSOX("NRX0"),"^",8)=PSOX("DAYS SUPPLY")
"RTN","PSORN52A",21,0)
 I $G(PSOX("QTY")) S $P(PSOX("NRX0"),"^",7)=PSOX("QTY")
"RTN","PSORN52A",22,0)
 S $P(PSOX("NRX0"),"^",11)=$S(PSOX("FILL DATE")>DT&($P(PSOPAR,"^",6)):"M",$D(PSOX("MAIL/WINDOW")):PSOX("MAIL/WINDOW"),1:$P(PSOX("NRX0"),"^",11))
"RTN","PSORN52A",23,0)
 S $P(PSOX("NRX0"),"^",13)=PSOX("ISSUE DATE"),$P(PSOX("STA"),"^")=PSOX("STATUS"),$P(PSOX("NRX0"),"^",16)=$S($G(PSOX("CLERK CODE"))]"":PSOX("CLERK CODE"),1:DUZ)
"RTN","PSORN52A",24,0)
 S $P(PSOX("NRX0"),"^",17)=$G(PSODRUG("COST"))
"RTN","PSORN52A",25,0)
 S $P(PSOX("NRX2"),"^")=PSOX("LOGIN DATE"),$P(PSOX("NRX2"),"^",2)=PSOX("FILL DATE"),$P(PSOX("NRX2"),"^",3)="",$P(PSOX("NRX2"),"^",5)=PSOX("DISPENSED DATE")
"RTN","PSORN52A",26,0)
 S $P(PSOX("NRX2"),"^",6)=PSOX("STOP DATE"),$P(PSOX("NRX2"),"^",7)=$S($G(PSOX("NDC"))]"":PSOX("NDC"),1:$G(PSODRUG("NDC")))
"RTN","PSORN52A",27,0)
 S $P(PSOX("NRX2"),"^",8)=$S($G(PSOX("MANUFACTURER"))]"":PSOX("MANUFACTURER"),1:$G(PSODRUG("MANUFACTURER")))
"RTN","PSORN52A",28,0)
 S $P(PSOX("NRX2"),"^",9)=+PSOSITE,$P(PSOX("NRX2"),"^",10)=""
"RTN","PSORN52A",29,0)
 S $P(PSOX("NRX2"),"^",11)=$S($G(PSOX("EXPIRATION DATE"))]"":PSOX("EXPIRATION DATE"),1:$G(PSODRUG("EXPIRATION DATE")))
"RTN","PSORN52A",30,0)
 S:$G(PSOX("GENERIC PROVIDER"))]"" $P(PSOX("NRX2"),"^",12)=PSOX("GENERIC PROVIDER")
"RTN","PSORN52A",31,0)
 S $P(PSOX("NRX2"),"^",13)="",$P(PSOX("NRX2"),"^",15)="",$P(PSOX("NRX3"),"^",4)=$P(PSOX("NRX3"),"^")
"RTN","PSORN52A",32,0)
 S $P(PSOX("EPH"),"^")=$S($G(PSOX("DAW"))]"":PSOX("DAW"),1:$G(PSODRUG("DAW")))
"RTN","PSORN52A",33,0)
 ;S PSOX("LAST DISPENSED DATE")=$P(PSOX("NRX3"),"^")
"RTN","PSORN52A",34,0)
 S PSOX("LAST DISPENSED DATE")=PSOX("DISPENSED DATE")
"RTN","PSORN52A",35,0)
 S $P(PSOX("NRX3"),"^")=PSOX("LAST DISPENSED DATE")
"RTN","PSORN52A",36,0)
 S:$G(PSOX("NEXT POSSIBLE REFILL"))]"" $P(PSOX("NRX3"),"^",2)=PSOX("NEXT POSSIBLE REFILL")
"RTN","PSORN52A",37,0)
 S:'$P(^VA(200,$P(PSOX("NRX0"),"^",4),"PS"),"^",7) $P(PSOX("NRX3"),"^",3)=""
"RTN","PSORN52A",38,0)
 S:$G(PSOX("REMARKS"))']"" PSOX("REMARKS")="RENEWED FROM RX # "_$P(PSOX("RX0"),"^")
"RTN","PSORN52A",39,0)
 S $P(PSOX("NRX3"),"^",7)=PSOX("REMARKS"),$P(PSOX("NRX3"),"^",8)=""
"RTN","PSORN52A",40,0)
 ;
"RTN","PSORN52A",41,0)
 ; - File OTHER PATIENT INSTRUCTIONS into ^PSRX
"RTN","PSORN52A",42,0)
 I $G(PSOFXRNX) S PSOFXRN=1
"RTN","PSORN52A",43,0)
 D ^PSORN52C,FILE^PSORN52D
"RTN","PSORN52A",44,0)
 I $G(^PSRX(PSOX("OIRXN"),"INSS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=^PSRX(PSOX("OIRXN"),"INSS") K PSOX1 G F55
"RTN","PSORN52A",45,0)
 I $G(PSOX("SINS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=PSOX("SINS")
"RTN","PSORN52A",46,0)
 K PSOX1
"RTN","PSORN52A",47,0)
 ;
"RTN","PSORN52A",48,0)
 ; - File data into ^PS(55)
"RTN","PSORN52A",49,0)
F55 L +^PS(55,PSODFN,"P"):2 S:'$D(^PS(55,PSODFN,"P",0)) ^(0)="^55.03PA^^"
"RTN","PSORN52A",50,0)
 F PSOX1=$P(^PS(55,PSODFN,"P",0),"^",3):1 Q:'$D(^PS(55,PSODFN,"P",PSOX1))
"RTN","PSORN52A",51,0)
 S PSOX("55 IEN")=PSOX1
"RTN","PSORN52A",52,0)
 S ^PS(55,PSODFN,"P",PSOX1,0)=PSOX("IRXN"),$P(^PS(55,PSODFN,"P",0),"^",3,4)=PSOX1_"^"_($P(^PS(55,PSODFN,"P",0),"^",4)+1)
"RTN","PSORN52A",53,0)
 S ^PS(55,PSODFN,"P","A",PSOX("STOP DATE"),PSOX("IRXN"))=""
"RTN","PSORN52A",54,0)
 L -^PS(55,PSODFN,"P")
"RTN","PSORN52A",55,0)
 K PSOX1
"RTN","PSORN52A",56,0)
 ;
"RTN","PSORN52A",57,0)
 ; - Patient Counseling questions
"RTN","PSORN52A",58,0)
 I $G(OR0) D FULL^VALM1,COUN^PSONEW S PSONOOR=""
"RTN","PSORN52A",59,0)
 I $D(^XUSEC("PSORPH",DUZ)) S DA=PSOX("IRXN"),DIE=52,DR="41////"_PSOCOU_";S:'X Y=""@1"";42////"_PSOCOUU_";@1" D ^DIE K DIE,DR
"RTN","PSORN52A",60,0)
 ;
"RTN","PSORN52A",61,0)
 ; - Re-indexing file 52 entry
"RTN","PSORN52A",62,0)
 K DIK,DA S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSORN52A",63,0)
 S DA=PSOX("IRXN") D ORC^PSORN52C
"RTN","PSORN52A",64,0)
 Q
"RTN","PSORN52C")
0^65^B48742207
"RTN","PSORN52C",1,0)
PSORN52C ;BIR/SAB-files renewal entries con't ;08/09/93
"RTN","PSORN52C",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,7,11,27,46,75,87,100,111,124,117,131,146,148**;DEC 1997
"RTN","PSORN52C",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORN52C",4,0)
 S DIC="^PSRX(",DLAYGO=52,DIC(0)="L",X=PSOX("NRX #") K DD,DO
"RTN","PSORN52C",5,0)
 D FILE^DICN S PSOX("IRXN")=+Y K DLAYGO,X,Y,DIC,DD,DO
"RTN","PSORN52C",6,0)
 D:+$G(DGI) TECH^PSODGDGI ; L +^PSRX(PSOX("IRXN")):0
"RTN","PSORN52C",7,0)
 D:$G(^TMP("PSODAI",$J,0))
"RTN","PSORN52C",8,0)
 .S $P(^PSRX(PSOX("IRXN"),3),"^",6)=1
"RTN","PSORN52C",9,0)
 .I $O(^TMP("PSODAI",$J,0)) S DAI=0 F  S DAI=$O(^TMP("PSODAI",$J,DAI)) Q:'DAI  D
"RTN","PSORN52C",10,0)
 ..S:'$D(^PSRX(PSOX("IRXN"),"DAI",0)) ^PSRX(PSOX("IRXN"),"DAI",0)="^52.03^^" S ^PSRX(PSOX("IRXN"),"DAI",DAI,0)=^TMP("PSODAI",$J,DAI,0)
"RTN","PSORN52C",11,0)
 ..S $P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1
"RTN","PSORN52C",12,0)
 .K ^TMP("PSODAI",$J),DAI
"RTN","PSORN52C",13,0)
 S PSORN52(PSOX("IRXN"),0)=PSOX("NRX0"),PSORN52(PSOX("IRXN"),2)=PSOX("NRX2"),PSORN52(PSOX("IRXN"),3)=PSOX("NRX3")
"RTN","PSORN52C",14,0)
 S PSORN52(PSOX("IRXN"),"EPH")=PSOX("EPH")
"RTN","PSORN52C",15,0)
 S:'$G(PSOX("ENT")) PSORN52(PSOX("IRXN"),"SIG")=PSOX("SIG")
"RTN","PSORN52C",16,0)
 S PSORN52(PSOX("IRXN"),"STA")=PSOX("STA")
"RTN","PSORN52C",17,0)
 S:$G(PSOX("TN"))]"" PSORN52(PSOX("IRXN"),"TN")=PSOX("TN")
"RTN","PSORN52C",18,0)
 I $G(PSOX("METHOD OF PICK-UP"))]"",PSOX("FILL DATE")'>DT S PSORN52(PSOX("IRXN"),"MP")=PSOX("METHOD OF PICK-UP")
"RTN","PSORN52C",19,0)
 S PSORN52(PSOX("IRXN"),"TYPE")=0
"RTN","PSORN52C",20,0)
 S PSOX1="" F  S PSOX1=$O(PSORN52(PSOX("IRXN"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),PSOX1)=$G(PSORN52(PSOX("IRXN"),PSOX1))
"RTN","PSORN52C",21,0)
 I $O(SIG(0)) D  G ENT
"RTN","PSORN52C",22,0)
 .S II=0 F I=0:0 S I=$O(SIG(I)) Q:'I  S ^PSRX(PSOX("IRXN"),"SIG1",I,0)=SIG(I),II=II+1
"RTN","PSORN52C",23,0)
 .S ^PSRX(PSOX("IRXN"),"SIG1",0)="^52.04A^"_II_"^"_II,$P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1 K I,II
"RTN","PSORN52C",24,0)
 .S $P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1
"RTN","PSORN52C",25,0)
ENT S ^PSRX(PSOX("IRXN"),"POE")=1,^PSRX(PSOX("IRXN"),"INS")=$G(PSOX("INS"))
"RTN","PSORN52C",26,0)
 I $G(OR0) S:$P(OR0,"^",24) ^PSRX(PSOX("IRXN"),"PKI")=1
"RTN","PSORN52C",27,0)
 I $G(PSOX("SIG",1))]"",'$O(PSOX("SIG",1)) S ^PSRX(PSOX("IRXN"),"INS1",1,0)=PSOX("SIG",1),^PSRX(PSOX("IRXN"),"INS1",0)="^52.0115^1^1^"_DT_"^^"
"RTN","PSORN52C",28,0)
 I $O(^PSRX(PSOX("OIRXN"),"INS1",0)) D
"RTN","PSORN52C",29,0)
 .F D=0:0 S D=$O(^PSRX(PSOX("OIRXN"),"INS1",D)) Q:'D  S ^PSRX(PSOX("IRXN"),"INS1",D,0)=^PSRX(PSOX("OIRXN"),"INS1",D,0)
"RTN","PSORN52C",30,0)
 .S ^PSRX(PSOX("IRXN"),"INS1",0)=^PSRX(PSOX("OIRXN"),"INS1",0)
"RTN","PSORN52C",31,0)
TNT F I=1:1:PSOX("ENT") S ^PSRX(PSOX("IRXN"),6,I,0)=PSOX("DOSE",I)_"^"_$G(PSOX("DOSE ORDERED",I))_"^"_$G(PSOX("UNITS",I))_"^"_$G(PSOX("NOUN",I))_"^" D
"RTN","PSORN52C",32,0)
 .S ^PSRX(PSOX("IRXN"),6,I,0)=^PSRX(PSOX("IRXN"),6,I,0)_$G(PSOX("DURATION",I))_"^"_$G(PSOX("CONJUNCTION",I))_"^"_$G(PSOX("ROUTE",I))_"^"_$G(PSOX("SCHEDULE",I))_"^"_$G(PSOX("VERB",I))
"RTN","PSORN52C",33,0)
 .I $G(PSOX("ODOSE",I))]"" S ^PSRX(PSOX("IRXN"),6,I,1)=PSOX("ODOSE",I)
"RTN","PSORN52C",34,0)
 S:$G(PSOX("ENT")) ^PSRX(PSOX("IRXN"),6,0)="^52.0113^"_PSOX("ENT")_"^"_PSOX("ENT")
"RTN","PSORN52C",35,0)
 Q
"RTN","PSORN52C",36,0)
ORC ;
"RTN","PSORN52C",37,0)
 D MARK^PSOTPCAN
"RTN","PSORN52C",38,0)
 K PSORDEDT,GG,PSOHD,PSOID,PTST,PTDY,PTRF,RFCNT,RN,SEG1,SIG,SIGOK,DIC
"RTN","PSORN52C",39,0)
 K ST0,STA,STP,STR,JJ,LSI,MM,ORDG,ORIG,PHARMST,PSCAN,PSCNT,PSOI,GMRAL,DIC,DIE,HDR,IEN,NAME D KVA^VADPT
"RTN","PSORN52C",40,0)
 I $G(PSOFDR) D 
"RTN","PSORN52C",41,0)
 .I $G(PKI1)=1,$G(PKIR)]"" D ACT^PSOPKIV1(PSOX("IRXN"))
"RTN","PSORN52C",42,0)
 .S $P(^PSRX(PSOX("IRXN"),"OR1"),"^",2)=$P(OR0,"^"),^PSRX("APL",$P(OR0,"^"),PSOX("IRXN"))=""
"RTN","PSORN52C",43,0)
 .I $P($G(^PS(52.41,+$G(ORD),"EXT")),"^")="" I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) K:'$G(PSOPRC) PRC K PHI
"RTN","PSORN52C",44,0)
 .I $O(PRC(0)) S T=0 F  S T=$O(PRC(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PRC",T,0)=PRC(T),^PSRX(PSOX("IRXN"),"PRC",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",45,0)
 .I $O(PHI(0)) S T=0 F  S T=$O(PHI(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PI",T,0)=PHI(T),^PSRX(PSOX("IRXN"),"PI",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",46,0)
 .I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) D  S PSOI=1 Q
"RTN","PSORN52C",47,0)
 ..S POERR("PLACER")=$P(^PS(52.41,ORD,0),"^"),PSORDEDT=ORD
"RTN","PSORN52C",48,0)
 ..K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,ORD,"INI")),"^"),ORD)
"RTN","PSORN52C",49,0)
 ..S DA=ORD,DIK="^PS(52.41," D ^DIK
"RTN","PSORN52C",50,0)
 ..S $P(^PSRX(PSOX("IRXN"),"OR1"),"^")=$G(PSODRUG("OI"))
"RTN","PSORN52C",51,0)
 .E  S $P(^PSRX(PSOX("IRXN"),"OR1"),"^")=$P(OR0,"^",8)
"RTN","PSORN52C",52,0)
 .D PSOUL^PSSLOCK(ORD_"S") S DIK="^PS(52.41,",DA=ORD D ^DIK K DIK,DA
"RTN","PSORN52C",53,0)
 S:$G(PSOX("OIRXN"))&('$G(COPY)) $P(^PSRX(PSOX("IRXN"),"OR1"),"^",3)=PSOX("OIRXN"),$P(^PSRX(PSOX("OIRXN"),"OR1"),"^",4)=PSOX("IRXN"),^PSRX("AQ",PSOX("IRXN"),PSOX("OIRXN"))=""
"RTN","PSORN52C",54,0)
 I $O(PRC(0)) S T=0 F  S T=$O(PRC(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PRC",T,0)=PRC(T),^PSRX(PSOX("IRXN"),"PRC",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",55,0)
 I $O(PHI(0)) S T=0 F  S T=$O(PHI(T)) Q:'T  S ^PSRX(PSOX("IRXN"),"PI",T,0)=PHI(T),^PSRX(PSOX("IRXN"),"PI",0)="^^"_T_"^"_T_"^"_DT_"^"
"RTN","PSORN52C",56,0)
 S $P(^PSRX(PSOX("IRXN"),"OR1"),"^",5)=DUZ
"RTN","PSORN52C",57,0)
 S PHARMST="",$P(^PSRX(PSOX("IRXN"),"OR1"),"^")=$G(PSODRUG("OI"))
"RTN","PSORN52C",58,0)
 S RXN=PSOX("IRXN") D SAVE
"RTN","PSORN52C",59,0)
 S STAT=$S($G(OR0)]""&('$G(PSOI)):"SC",$G(PSOI):"RO",1:"SN") S PHARMST=$S('$G(PSORX("VERIFY")):"CM",1:"IP") ;D EN^PSOHLSN1(RXN,STAT,PHARMST,"",PSONOOR)
"RTN","PSORN52C",60,0)
 S ^TMP("PSORXN",$J,RXN)=STAT_"^"_PHARMST_"^"_PSONOOR D PSOL^PSSLOCK(RXN)
"RTN","PSORN52C",61,0)
 D RESTORE K PSORDEDT,PHI,PRC,STAT,COMM,PSOI,OR2,OR1,PHARMST,RXN,DRG,STA,ACT,OCXR,OCXD1,OCXDT,OCXI
"RTN","PSORN52C",62,0)
 Q
"RTN","PSORN52C",63,0)
BBRX ;build bingo board Rx array; called by PSON52,PSOR52,PSORN52
"RTN","PSORN52C",64,0)
 I $G(BBRX(1))']"" S BBRX(1)=PSOX("IRXN")_"," Q
"RTN","PSORN52C",65,0)
 F PSOX1=0:0 S PSOX1=$O(BBRX(PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORN52C",66,0)
 I $L(BBRX(PSOX2))+$L(PSOX("IRXN"))<220 S BBRX(PSOX2)=BBRX(PSOX2)_PSOX("IRXN")_","
"RTN","PSORN52C",67,0)
 E  S BBRX(PSOX2+1)=PSOX("IRXN")_","
"RTN","PSORN52C",68,0)
 Q
"RTN","PSORN52C",69,0)
SAVE ;this module will be used to save PSO arrays
"RTN","PSORN52C",70,0)
 K ^TMP("PSOLST",$J) F I=0:0 S I=$O(PSOLST(I)) Q:'I  S ^TMP("PSOLST",$J,I,0)=PSOLST(I)
"RTN","PSORN52C",71,0)
 K ^TMP("PSOSD",$J) S (STA,DRG)="" F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DRG=$O(PSOSD(STA,DRG)) Q:DRG=""  S ^TMP("PSOSD",$J,STA,DRG)=PSOSD(STA,DRG)
"RTN","PSORN52C",72,0)
 I $G(PSOSD) S ^TMP("PSOSD",$J,0)=PSOSD
"RTN","PSORN52C",73,0)
 I $G(PSODRUG("NAME"))]"" K ^TMP("PSODRUG",$J) S STA=""  F  S STA=$O(PSODRUG(STA)) Q:STA=""  S ^TMP("PSODRUG",$J,STA)=PSODRUG(STA)
"RTN","PSORN52C",74,0)
 I $G(PSOX("# OF REFILLS"))]"" K ^TMP("PSOX",$J),^TMP("PSORENW",$J),^TMP("PSONEW",$J),^TMP("PSORXED",$J) D
"RTN","PSORN52C",75,0)
 .S STA="" F  S STA=$O(PSOX(STA)) Q:STA=""  S ^TMP("PSOX",$J,STA)=$G(PSOX(STA)) D
"RTN","PSORN52C",76,0)
 ..I STA="OLD LAST RX#",$O(PSOX(STA,"")) K ^TMP("PSOX",$J,STA) S ^TMP("PSOX",$J,STA,$O(PSOX(STA,"")))=PSOX(STA,$O(PSOX(STA,""))) D  Q
"RTN","PSORN52C",77,0)
 ...I $O(PSONEW(STA,"")) S ^TMP("PSONEW",$J,STA,$O(PSONEW(STA,"")))=PSONEW(STA,$O(PSONEW(STA,"")))
"RTN","PSORN52C",78,0)
 ...I $O(PSORENW(STA,"")) S ^TMP("PSORENW",$J,STA,$O(PSORENW(STA,"")))=PSORENW(STA,$O(PSORENW(STA,"")))
"RTN","PSORN52C",79,0)
 ...I $O(PSORXED(STA,"")) S ^TMP("PSORXED",$J,STA,$O(PSORXED(STA,"")))=PSORXED(STA,$O(PSORXED(STA,"")))
"RTN","PSORN52C",80,0)
 ..F ACT="PSORENW","PSONEW","PSORXED" I $G(@(ACT_"("""_STA_""")"))]"" S ^TMP(ACT,$J,STA)=@(ACT_"("""_STA_""")")
"RTN","PSORN52C",81,0)
 K PSOPTPST,PSOSD,PSONEW,PSOLST,PSORENW,PSORXED,PSODRUG
"RTN","PSORN52C",82,0)
 Q
"RTN","PSORN52C",83,0)
RESTORE ;this module restore saved arrays
"RTN","PSORN52C",84,0)
 S STA=0 F  S STA=$O(^TMP("PSOLST",$J,STA)) Q:'STA  S PSOLST(STA)=^TMP("PSOLST",$J,STA,0)
"RTN","PSORN52C",85,0)
 I $G(^TMP("PSOSD",$J,0)) S PSOSD=$G(^TMP("PSOSD",$J,0))
"RTN","PSORN52C",86,0)
 S (STA,DRG)="" F  S STA=$O(^TMP("PSOSD",$J,STA)) Q:STA=""  F  S DRG=$O(^TMP("PSOSD",$J,STA,DRG)) Q:DRG=""  S PSOSD(STA,DRG)=^TMP("PSOSD",$J,STA,DRG)
"RTN","PSORN52C",87,0)
 S STA="" F  S STA=$O(^TMP("PSODRUG",$J,STA)) Q:STA=""  S PSODRUG(STA)=^TMP("PSODRUG",$J,STA)
"RTN","PSORN52C",88,0)
 S STA="" F ACT="PSOX","PSORENW","PSONEW","PSORXED" D:$O(^TMP(ACT,$J,STA))]""
"RTN","PSORN52C",89,0)
 .F  S STA=$O(^TMP(ACT,$J,STA)) Q:STA=""  I STA'="OLD LAST RX#" S @(ACT_"("""_STA_""")")=^TMP(ACT,$J,STA)
"RTN","PSORN52C",90,0)
 I $O(^TMP("PSOX",$J,"OLD LAST RX#","")) S PSOX("OLD LAST RX#",$O(^TMP("PSOX",$J,"OLD LAST RX#","")))=^TMP("PSOX",$J,"OLD LAST RX#",$O(^TMP("PSOX",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",91,0)
 I $O(^TMP("PSONEW",$J,"OLD LAST RX#","")) S PSONEW("OLD LAST RX#",$O(^TMP("PSONEW",$J,"OLD LAST RX#","")))=^TMP("PSONEW",$J,"OLD LAST RX#",$O(^TMP("PSONEW",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",92,0)
 I $O(^TMP("PSORENW",$J,"OLD LAST RX#","")) S PSORENW("OLD LAST RX#",$O(^TMP("PSORENW",$J,"OLD LAST RX#","")))=^TMP("PSORENW",$J,"OLD LAST RX#",$O(^TMP("PSORENW",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",93,0)
 I $O(^TMP("PSORXED",$J,"OLD LAST RX#","")) S PSORXED("OLD LAST RX#",$O(^TMP("PSORXED",$J,"OLD LAST RX#","")))=^TMP("PSORXED",$J,"OLD LAST RX#",$O(^TMP("PSORXED",$J,"OLD LAST RX#","")))
"RTN","PSORN52C",94,0)
 K ^TMP("PSOSD",$J),^TMP("PSODRUG",$J),^TMP("PSOX",$J),^TMP("PSORENW",$J),^TMP("PSONEW",$J),^TMP("PSORXED",$J),^TMP("PSOLST",$J)
"RTN","PSORN52C",95,0)
 Q
"RTN","PSORXDL")
0^17^B58159508
"RTN","PSORXDL",1,0)
PSORXDL ;BIR/SAB - Deletes one prescription ;06/10/96
"RTN","PSORXDL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,17,9,27,117,131,148**;DEC 1997
"RTN","PSORXDL",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSORXDL",4,0)
 ;External references L, UL, PSOL, and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORXDL",5,0)
 ;External reference to ^PS(59.7 supported by DBIA 694
"RTN","PSORXDL",6,0)
 ;External reference to ^PSDRUG( supported by DBIA 221
"RTN","PSORXDL",7,0)
 I '$D(^XUSEC("PSORPH",DUZ)) W !,$C(7),"Requires Pharmacy Key (PSORPH) !" Q
"RTN","PSORXDL",8,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"SITE PARAMETERS MUST BE DEFINED!",! Q
"RTN","PSORXDL",9,0)
 K DA,PSODEFLG,PSOHLRE,PSOHLDAH,QTY,PSOABCDA,PSOREF S (PSDEL,PSOXXDEL)=1,PS="DELETE",DIC("S")="I $P($G(^(0)),""^"",2),$P($G(^(""STA"")),""^"")'=13,$G(^(2))" D A1^PSORXVW K DIC("S") G:'$G(DA) KILL
"RTN","PSORXDL",10,0)
 D FULL^VALM1
"RTN","PSORXDL",11,0)
 S RXN=+$G(DA)
"RTN","PSORXDL",12,0)
 S PSORXDFN=+$P($G(^PSRX(RXN,0)),"^",2)
"RTN","PSORXDL",13,0)
 S PSOPLCK=$$L^PSSLOCK(PSORXDFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY K PSOPLCK G PSORXDL
"RTN","PSORXDL",14,0)
 K PSOPLCK D PSOL^PSSLOCK(RXN) I '$G(PSOMSG) W !,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),! K PSOMSG D ULP G PSORXDL
"RTN","PSORXDL",15,0)
 S (REL,PSOGGFL)=0 F PSOGG=0:0 S PSOGG=$O(^PSRX(DA,1,PSOGG)) Q:'PSOGG  S:$D(^PSRX(DA,1,PSOGG,0)) PSOGGFL=PSOGG
"RTN","PSORXDL",16,0)
 S REL=$S($G(PSOGGFL)&($P($G(^PSRX(DA,1,+$G(PSOGGFL),0)),"^",18))&('$P($G(^(0)),"^",16)):1,'$G(PSOGGFL)&($P($G(^PSRX(DA,2)),"^",13))&('$P($G(^(2)),"^",15)):1,1:0)
"RTN","PSORXDL",17,0)
 I REL W !!,$S($G(PSOGGFL):"Refill number "_$G(PSOGGFL),1:"The Original Fill")," has already been released for Rx # "_$P($G(^PSRX(DA,0)),"^")
"RTN","PSORXDL",18,0)
 I REL W !,"Drug: ",$P($G(^PSDRUG(+$P($G(^PSRX(DA,0)),"^",6),0)),"^"),?49,$P($G(^DPT(+$P($G(^PSRX(DA,0)),"^",2),0)),"^")
"RTN","PSORXDL",19,0)
 I REL W ! K DIR S DIR(0)="Y",DIR("A")="Return this fill to stock and delete the prescription",DIR("B")="N" D  D ^DIR K DIR G:$G(Y)=1 PASS W !!?5,"No Action Taken.",!  D ULK,ULP,KILL G PSORXDL
"RTN","PSORXDL",20,0)
 .S DIR("?")=" ",DIR("?",1)="Enter 'Y' to return this last fill to stock and continue with the deleting of",DIR("?",2)="this prescription, enter 'N' to exit."
"RTN","PSORXDL",21,0)
 K DIR S DIR(0)="Y",DIR("A",1)="Are you sure you want to DELETE Rx # "_$P(^PSRX(DA,0),"^"),DIR("A",2)="Drug: "_$P(^PSDRUG($P(^PSRX(DA,0),"^",6),0),"^")
"RTN","PSORXDL",22,0)
 S DIR("A")="for "_$P(^DPT($P(^PSRX(DA,0),"^",2),0),"^")
"RTN","PSORXDL",23,0)
 S DIR("B")="NO" D ^DIR D:$D(DTOUT) ULK,ULP G:$D(DTOUT) KILL I $D(DIRUT)!'Y D ULK,ULP,KILL G PSORXDL
"RTN","PSORXDL",24,0)
PASS N PSORXDAC K PSOXYZF S PSORXDAC=$O(^PS(52.5,"B",DA,0)) I PSORXDAC,$P($G(^PS(52.5,PSORXDAC,0)),"^",7)="L" N PSOXYZ S PSOXYZF=0 W !!,"Please wait, Rx is Loading for CMOP Transmission.." D
"RTN","PSORXDL",25,0)
 .F PSOXYZ=1:1:5 W "." H 1 I $P($G(^PS(52.5,PSORXDAC,0)),"^",7)'="L" S PSOXYZF=1
"RTN","PSORXDL",26,0)
 I $G(PSOXYZF)=0 W !!,"Sorry, still loading for CMOP transmission, try again later.",! D ULK,ULP,KILL K PSOXYZF G PSORXDL
"RTN","PSORXDL",27,0)
 K PSOXYZF
"RTN","PSORXDL",28,0)
 I $G(REL) S PSOHLRE=REL,PSOHLDAH=$G(DA)
"RTN","PSORXDL",29,0)
 I $G(REL) S RXP=DA S PSODEFLG=0 D RESK I $G(PSODEFLG) D ULK,ULP,KILL G PSORXDL
"RTN","PSORXDL",30,0)
 I $G(PSOHLRE) W !!?5,"Deleting prescription..",! S DA=$G(PSOHLDAH),REL=$G(PSOHLRE)
"RTN","PSORXDL",31,0)
 S PSOABCDA=$G(DA) D NOOR^PSOCAN4 I $D(DIRUT) W " NO ACTION TAKEN!",! D ULK,ULP,KILL G PSORXDL
"RTN","PSORXDL",32,0)
 S DA=$G(PSOABCDA) K DIR,PSOABCDA S DIR("A")="Comments",DIR("B")="Per Pharmacy Request",DIR(0)="F^5:100" D ^DIR K DIR I $D(DIRUT) W !!?5,"NO ACTION TAKEN!",! D ULK,ULP G KILL
"RTN","PSORXDL",33,0)
 I $G(PKI1) N INCOM S INCOM=Y D DCV^PSOPKIV1,ULK,ULP G PSORXDL
"RTN","PSORXDL",34,0)
ENQ S PSOIB=$S($D(^PSRX(DA,"IB")):^PSRX(DA,"IB"),1:0) ;Check if copay
"RTN","PSORXDL",35,0)
 S RX=^PSRX(DA,0),RXN=DA
"RTN","PSORXDL",36,0)
 S $P(^PSRX(RXN,"STA"),"^")=13,$P(^PSRX(RXN,"D"),"^")=$G(Y)
"RTN","PSORXDL",37,0)
 S DA=RXN K ^PSRX("ACP",$P(^PSRX(DA,0),"^",2),+$P(^(2),"^",2),0,DA) D ACT
"RTN","PSORXDL",38,0)
 S DA=RXN I $G(^PSRX(DA,"H"))]"" K ^PSRX("AH",+$P(^PSRX(DA,"H"),"^"),DA) S ^PSRX(DA,"H")=""
"RTN","PSORXDL",39,0)
 D EN^PSOHLSN1(DA,"OC","",$P(^PSRX(DA,"D"),"^"),PSONOOR)
"RTN","PSORXDL",40,0)
 S DA=$O(^PS(52.5,"B",RXN,0)) I DA S DIK="^PS(52.5," D ^DIK
"RTN","PSORXDL",41,0)
 S DA=RXN I $D(^PS(52.4,RXN)) S DIK="^PS(52.4," D ^DIK
"RTN","PSORXDL",42,0)
 K PSOABCDA I $G(DA) S PSOABCDA=$G(DA)
"RTN","PSORXDL",43,0)
 I $O(^PS(52.41,"ARF",RXN,0)) S DA=$O(^PS(52.41,"ARF",RXN,0)),DIK="^PS(52.41," D ^DIK K DA,DIK
"RTN","PSORXDL",44,0)
 I $G(PSOABCDA) S DA=$G(PSOABCDA)
"RTN","PSORXDL",45,0)
 I $G(PSOABCDA) S DA=$G(PSOABCDA) K PSOABCDA
"RTN","PSORXDL",46,0)
 Q:+$G(PSORX("INTERVENE"))!($G(PSVFLAG))  I $D(DA),'$G(PSOZVER) D ULK,ULP G PSORXDL
"RTN","PSORXDL",47,0)
 S ^PSDRUG(+$P(RX,"^",6),660.1)=$S($D(^PSDRUG(+$P(RX,"^",6),660.1)):^(660.1),1:0)+$P(RX,"^",7)
"RTN","PSORXDL",48,0)
 S DFN=+$P(RX,"^",2) F I=0:0 S I=$O(^PS(55,DFN,"P",I)) Q:'I  I +^(I,0)=RXN K ^(0) S ^(0)=$P(^PS(55,DFN,"P",0),"^",1,3)_"^"_($P(^(0),"^",4)-1)
"RTN","PSORXDL",49,0)
 F I=0:0 S I=$O(^PS(55,DFN,"P","A",I)) Q:'I  I $D(^(I,RXN)) K ^(RXN)
"RTN","PSORXDL",50,0)
 K STAT,COM,RX,RXN Q:+$G(PSORX("INTERVENE"))!($G(PSVFLAG))  I $G(PSDEL) D ULK,ULP G PSORXDL
"RTN","PSORXDL",51,0)
 ;
"RTN","PSORXDL",52,0)
KILL K PSORXDFN,PSOMSG,PSOPLCK,RXO,RX0,RX2,RESK,PSIN,PSODEF,PSOPCECT,PSDEL,I,II,J,N,PHYS,PS,RFDATE,RFL,RFL1,ST,ST0,%,%Y,D0,DA,DI,DIC,DIE,DIH,DIU,DIV,DR,Z,DIG,X,Y,PSOIB,RX,RXN,PSODEFLG,PSOREF,PSOHLRE,PSOHLDAH,PSOGG,PSODLCOM,COPAYFLG
"RTN","PSORXDL",53,0)
 K DIR,RXP,DIRUT,DUOUT,DTOUT,SIGOK,REL,PSONODF,PSONOOR,PSOGGFL,PSOXYZF,TYPE,XTYPE,QDRUG,QTY,PSOWHERE,PSOLOCRL,PSOCPRX,PSODT,PSODA,PSOINVTX,IFN,PSROF,PSOABCDA,PSOXXDEL
"RTN","PSORXDL",54,0)
 Q
"RTN","PSORXDL",55,0)
ACT ;adds activity info for deleted rx
"RTN","PSORXDL",56,0)
 S (RXF,PSOREF)=0 F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  S (RXF,PSOREF)=I S:I>5 RXF=I+1 K ^PSRX("ACP",$P(^PSRX(RXN,0),"^",2),$P(^PSRX(RXN,1,I,0),"^"),I,RXN)
"RTN","PSORXDL",57,0)
 S DA=0 F FDA=0:0 S FDA=$O(^PSRX(RXN,"A",FDA)) Q:'FDA  S DA=FDA
"RTN","PSORXDL",58,0)
 D NOW^%DTC S DA=DA+1,^PSRX(RXN,"A",0)="^52.3DA^"_DA_"^"_DA,^PSRX(RXN,"A",DA,0)=%_"^"_"D"_"^"_DUZ_"^"_RXF_"^"_"RX DELETED on "_$E(DT,4,5)_"-"_$E(DT,6,7)_"-"_$E(DT,2,3)
"RTN","PSORXDL",59,0)
EX W !,"...PRESCRIPTION #"_$P(RX,"^")_" MARKED DELETED!!"
"RTN","PSORXDL",60,0)
 K RXF,I,FDA,DIC,DIE,%,%I,%H S DA=RXN
"RTN","PSORXDL",61,0)
 ; - Sending Refill to ECME for claim REVERSAL (Rx Delete)
"RTN","PSORXDL",62,0)
 D REVERSE^PSOBPSU1(RXN,PSOREF,"DE",5,,1)
"RTN","PSORXDL",63,0)
 Q
"RTN","PSORXDL",64,0)
RESK ;
"RTN","PSORXDL",65,0)
 S RESK=1,PSIN=+$P(^PS(59.7,1,49.99),"^",2) K PSODEF S PSOPCECT=1
"RTN","PSORXDL",66,0)
 S PSOLOUD=1 D:$P($G(^PS(55,+$P(^PSRX(RXP,0),"^",2),0)),"^",6)'=2 EN^PSOHLUP($P(^PSRX(RXP,0),"^",2)) K PSOLOUD
"RTN","PSORXDL",67,0)
 I $S('+$P($G(^PSRX(+RXP,"STA")),"^"):0,$P(^("STA"),"^")=11:0,$P(^("STA"),"^")=12:0,$P(^("STA"),"^")=14:0,$P(^("STA"),"^")=15:0,1:1) D STAT^PSORESK1 S PSODEFLG=1 Q
"RTN","PSORXDL",68,0)
 W !!?5,"Returning Medication to Stock..",!
"RTN","PSORXDL",69,0)
 K DIR,PSODLCOM,COM S DIR(0)="F^10:75",DIR("A")="Comments",DIR("?")="Comments are required, 10-75 characters." W ! D ^DIR K DIR S (COM,PSODLCOM)=Y I Y["^"!($D(DIRUT)) W !!,"No Action Taken!",! S PSODEFLG=1 Q
"RTN","PSORXDL",70,0)
 S QDRUG=+$P($G(^PSRX(RXP,0)),"^",6),QTY=$P($G(^(0)),"^",7) I $O(^PSRX(RXP,1,0)) G REF
"RTN","PSORXDL",71,0)
 S XTYPE="O" I $P($G(^PSRX(RXP,2)),"^",15) Q
"RTN","PSORXDL",72,0)
 I $P($G(^PSRX(RXP,2)),"^",2)<$G(PSIN) Q
"RTN","PSORXDL",73,0)
 K PSOLOCRL,PSOWHERE S PSOLOCRL=$P($G(^PSRX(RXP,2)),"^",13)
"RTN","PSORXDL",74,0)
 Q:'$G(PSOLOCRL)
"RTN","PSORXDL",75,0)
 S PSOWHERE=$S($D(^PSRX("AR",$G(PSOLOCRL),RXP,0)):1,1:0)
"RTN","PSORXDL",76,0)
 I +$G(^PSRX(RXP,"IB")) S COPAYFLG=1 D CP^PSORESK1 I '$G(COPAYFLG) S PSODEFLG=1 Q
"RTN","PSORXDL",77,0)
 I $G(^PSDRUG(QDRUG,660.1)),$G(PSOWHERE) D INVT W:$G(PSODEFLG) !!?5,"No Action Taken!",! Q:$G(PSODEFLG)  I $G(PSOINVTX) D INVINC
"RTN","PSORXDL",78,0)
 I $G(^PSDRUG(QDRUG,660.1)),'$G(PSOWHERE) D INVINC
"RTN","PSORXDL",79,0)
 I $G(PSOWHERE) K ^PSRX("AR",$G(PSOLOCRL),RXP,0)
"RTN","PSORXDL",80,0)
 D NOW^%DTC K DIE S DA=RXP,DIE="^PSRX(",DR="31///@;32.1///"_% D ^DIE K DIE
"RTN","PSORXDL",81,0)
 ;D EN^PSOHLSN1(RXP,"ZD")
"RTN","PSORXDL",82,0)
 D ACT^PSORESK1
"RTN","PSORXDL",83,0)
 S DA=$O(^PS(52.5,"B",RXP,0)) I DA K DIK S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSORXDL",84,0)
 D EN^PSOHLSN1(RXP,"ZD")
"RTN","PSORXDL",85,0)
 W !,"Rx # "_$P($G(^PSRX(RXP,0)),"^")_" Returned to Stock.",!
"RTN","PSORXDL",86,0)
 ; - Sending Rx to ECME for claim REVERSAL (Return to Stock)
"RTN","PSORXDL",87,0)
 D REVERSE^PSOBPSU1(RXP,0,"RS",4,,1)
"RTN","PSORXDL",88,0)
 Q
"RTN","PSORXDL",89,0)
REF ;
"RTN","PSORXDL",90,0)
 K TYPE F PSROF=0:0 S PSROF=$O(^PSRX(RXP,1,PSROF)) Q:'PSROF  S:$P($G(^PSRX(RXP,1,PSROF,0)),"^") TYPE=PSROF
"RTN","PSORXDL",91,0)
 I '$G(TYPE) Q
"RTN","PSORXDL",92,0)
 S XTYPE=1
"RTN","PSORXDL",93,0)
 I $P($G(^PSRX(RXP,1,TYPE,0)),"^",16) Q
"RTN","PSORXDL",94,0)
 I '$P($G(^PSRX(RXP,1,TYPE,0)),"^",18) Q
"RTN","PSORXDL",95,0)
 I '$P($G(^PSRX(RXP,1,TYPE,0)),"^",18),$P($G(^(0)),"^")'<PSIN Q
"RTN","PSORXDL",96,0)
 S PSOLOCRL=$P($G(^PSRX(RXP,1,TYPE,0)),"^",18)
"RTN","PSORXDL",97,0)
 Q:'$G(PSOLOCRL)
"RTN","PSORXDL",98,0)
 S PSOWHERE=$S($D(^PSRX("AR",$G(PSOLOCRL),RXP,TYPE)):1,1:0)
"RTN","PSORXDL",99,0)
 S QTY=$P($G(^PSRX(RXP,1,TYPE,0)),"^",4)
"RTN","PSORXDL",100,0)
 I +$G(^PSRX(RXP,"IB")) S COPAYFLG=1 D CP^PSORESK1 I '$G(COPAYFLG) S PSODEFLG=1 Q
"RTN","PSORXDL",101,0)
 I $G(^PSDRUG(QDRUG,660.1)),$G(PSOWHERE) D INVT W:$G(PSODEFLG) !!?5,"No Action Taken!",! Q:$G(PSODEFLG)  I $G(PSOINVTX) D INVINC
"RTN","PSORXDL",102,0)
 I $G(^PSDRUG(QDRUG,660.1)),'$G(PSOWHERE) D INVINC
"RTN","PSORXDL",103,0)
 I $G(PSOWHERE) K ^PSRX("AR",$G(PSOLOCRL),RXP,TYPE)
"RTN","PSORXDL",104,0)
 D NOW^%DTC K DIE S DA(1)=RXP,DA=TYPE,DIE="^PSRX("_DA(1)_",1,",DR="17////@;.01///@" W ! D ^DIE K DIE
"RTN","PSORXDL",105,0)
 ;D EN^PSOHLSN1(RXP,"ZD")
"RTN","PSORXDL",106,0)
 D ACT^PSORESK1
"RTN","PSORXDL",107,0)
 S DA=$O(^PS(52.5,"B",RXP,0)) I DA K DIK S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSORXDL",108,0)
 D EN^PSOHLSN1(RXP,"ZD") W !,"Rx # "_$P($G(^PSRX(RXP,0)),"^")_" Refill Returned to Stock.",!
"RTN","PSORXDL",109,0)
 ; - Sending Rx refill to ECME for claim REVERSAL (Return to Stock)
"RTN","PSORXDL",110,0)
 D REVERSE^PSOBPSU1(RXP,TYPE,"RS",4,,1)
"RTN","PSORXDL",111,0)
 Q
"RTN","PSORXDL",112,0)
INVT ;
"RTN","PSORXDL",113,0)
 S PSOINVTX=0
"RTN","PSORXDL",114,0)
 K DIR,DIRUT S DIR(0)="Y",DIR("B")="N",DIR("A")="This is a CMOP Rx, do you want to increment the local inventory" D  W ! D ^DIR K DIR S:$D(DIRUT) PSODEFLG=1 Q:$G(PSODEFLG)  I $G(Y)=1 S PSOINVTX=1
"RTN","PSORXDL",115,0)
 .S DIR("?")=" ",DIR("?",1)="Enter 'Y' if you want to increment the local inventory with the Quantity that",DIR("?",2)="has been released at the CMOP"
"RTN","PSORXDL",116,0)
 Q
"RTN","PSORXDL",117,0)
INVINC ;
"RTN","PSORXDL",118,0)
 S ^PSDRUG(QDRUG,660.1)=$S($P($G(^PSDRUG(QDRUG,660.1)),"^"):$P($G(^PSDRUG(QDRUG,660.1)),"^"),1:0)+$G(QTY)
"RTN","PSORXDL",119,0)
 Q
"RTN","PSORXDL",120,0)
 ;
"RTN","PSORXDL",121,0)
ULK ;
"RTN","PSORXDL",122,0)
 I $G(RXN) D PSOUL^PSSLOCK(RXN)
"RTN","PSORXDL",123,0)
 Q
"RTN","PSORXDL",124,0)
ULP ;
"RTN","PSORXDL",125,0)
 D UL^PSSLOCK(+$G(PSORXDFN))
"RTN","PSORXDL",126,0)
 Q
"RTN","PSORXEDT")
0^94^B39919801
"RTN","PSORXEDT",1,0)
PSORXEDT ;BIR/SAB-edit rx routine ;10/21/98
"RTN","PSORXEDT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**21,23,44,71,146,185,148**;DEC 1997
"RTN","PSORXEDT",3,0)
 ;Ref. ^PS(55 supp. IA 2228
"RTN","PSORXEDT",4,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) G EOJ Q
"RTN","PSORXEDT",5,0)
 K PSODRUG,PSOLIST,DIR,DIRUT,DUOUT,X,Y,PSOFROM,^TMP("PSOBEDT",$J),NOPP,CLOZPST
"RTN","PSORXEDT",6,0)
 W !! S DIR(0)="FAO^1:245",DIR("A")="Edit Rx(s) => ",DIR("?",1)="Enter Rx Number or A List of numbers Separated",DIR("?")="by Commas, e.g. 1234A,345,937002Q."
"RTN","PSORXEDT",7,0)
 D ^DIR K DIR G:$D(DIRUT) EOJ
"RTN","PSORXEDT",8,0)
 S END=$L(X,","),BAD=0
"RTN","PSORXEDT",9,0)
 F I=1:1:END S RXM=$P(X,",",I) I +RXM F J=I+1:1:END S DUP=$P(X,",",J) I DUP=RXM S $P(X,",",J)="" W !?5,$C(7),"Duplicate Rx # "_RXM_"  was found in your list, ignoring it!",! S BAD=1
"RTN","PSORXEDT",10,0)
 S PSORLST=$P(X,",") F I=2:1:END S RXM=$P(X,",",I) S:RXM'?1.N.A BAD=1 I RXM?1.N.A S PSORLST=PSORLST_","_RXM
"RTN","PSORXEDT",11,0)
 F I=1:1:$L(PSORLST) S RXM=$P(PSORLST,",",I) I +RXM F J=I+1:1:END S DUP=$P(PSORLST,",",J) I DUP=RXM S $P(PSORLST,",",J)=""
"RTN","PSORXEDT",12,0)
BAD I PSORLST D  I 'Y K Y G PSORXEDT
"RTN","PSORXEDT",13,0)
 .W !?15,"=> "_PSORLST
"RTN","PSORXEDT",14,0)
 .K DIR,DIRUT S DIR(0)="Y",DIR("A")="Is this OKAY ",DIR("B")="Yes"
"RTN","PSORXEDT",15,0)
 .D ^DIR K DIR
"RTN","PSORXEDT",16,0)
 .I 'Y!$D(DIRUT) K X,PSORLST,BAD
"RTN","PSORXEDT",17,0)
 K BAD I 'PSORLST K PSORLST G PSORXEDT
"RTN","PSORXEDT",18,0)
 F I=1:1:$L(PSORLST,",") S RXM=$P(PSORLST,",",I) S GOOD=$D(^PSRX("B",RXM)) D
"RTN","PSORXEDT",19,0)
 .I 'GOOD W !!?5,"Couldn't Find RX # "_RXM H 3 Q
"RTN","PSORXEDT",20,0)
 .S RXN=$O(^PSRX("B",RXM,0)) D  I $P(^PSRX(RXN,"STA"),"^")=13 W !!?5,"Rx # "_RXM_" is marked for Deletion." H 3 Q
"RTN","PSORXEDT",21,0)
 ..I $G(RXN),$P($G(^PS(55,+$P($G(^PSRX(RXN,0)),"^",2),0)),"^",6)'=2 S PSOLOUD=1 D EN^PSOHLUP(+$P($G(^PSRX(RXN,0)),"^",2)) K PSOLOUD
"RTN","PSORXEDT",22,0)
 .D LIST K GOOD
"RTN","PSORXEDT",23,0)
 K GOOD,END
"RTN","PSORXEDT",24,0)
EPH ; - Entry for Epharmacy Rx Edit (PSOREJP1)
"RTN","PSORXEDT",25,0)
 F PSOT1=1:1 Q:'$D(PSOLIST(PSOT1))  F PSOLST2=1:1:$L(PSOLIST(PSOT1),",") S ORN=$P(PSOLIST(PSOT1),",",PSOLST2) D:+ORN PT
"RTN","PSORXEDT",26,0)
 ;call to add bingo board data to file 52.11
"RTN","PSORXEDT",27,0)
 K POP,PSOLIST,TM,TM1 G:'$O(PSORX("PSOL",0)) NX
"RTN","PSORXEDT",28,0)
 D:$G(PSORX("PSOL",1))]"" ^PSORXL K PSORX G:$G(NOBG) NX
"RTN","PSORXEDT",29,0)
PRF G:'$P(PSOPAR,"^",8)!($G(NOPP)="H")!($G(NOPP)="S")!('$D(^TMP("PSOBEDT",$J))) BBG
"RTN","PSORXEDT",30,0)
 I $O(^TMP("PSOBEDT",$J,0)),$P(PSOPAR,"^",8) S PSOFROM="NEW",PSOION=ION K RXRS
"RTN","PSORXEDT",31,0)
 G:$D(PSOPROP)&($G(PSOPROP)'=ION) QUP
"RTN","PSORXEDT",32,0)
 I '$D(PSOPROP)!($G(PSOPROP)=ION) D  G:$G(POP)!($E(IOST)["C")!(PSOION=ION) BBG
"RTN","PSORXEDT",33,0)
 .S PSOION=ION W !,"Profiles must be sent to Printer !!",! K IOP,%ZIS,IO("Q"),POP
"RTN","PSORXEDT",34,0)
 .S %ZIS="MNQ",%ZIS("A")="Select Profile Device: " D ^%ZIS K %ZIS("A")
"RTN","PSORXEDT",35,0)
 .Q:$G(POP)!($E(IOST)["C")!(PSOION=ION)  S PSOPROP=ION
"RTN","PSORXEDT",36,0)
QUP S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X,HOLDRPAS=$G(PSOPRPAS),PSOPRPAS=$P(PSOPAR,"^",13)
"RTN","PSORXEDT",37,0)
 F DFN=0:0 S DFN=$O(^TMP("PSOBEDT",$J,DFN)) Q:'DFN  S PPL=^TMP("PSOBEDT",$J,DFN,0) D
"RTN","PSORXEDT",38,0)
 .S ZTRTN="DQ^PSOPRF",ZTIO=PSOPROP,ZTDESC="Outpatient Pharmacy Patient Profiles",ZTDTH=$H
"RTN","PSORXEDT",39,0)
 .F G="PSOPAR","PSODTCUT","PSOPRPAS","DFN","PSOSITE","NEW1","NEW11","PSOBMST","PFIO","PPL" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXEDT",40,0)
 .D ^%ZTLOAD
"RTN","PSORXEDT",41,0)
 W:$D(ZTSK) !,"PROFILE(S) QUEUED to PRINT",!! K G,ZTSK D ^%ZISC
"RTN","PSORXEDT",42,0)
 S PSOPRPAS=$G(HOLDRPAS) K:PSOPRPAS']"" PSOPRPAS K HOLDRPAS
"RTN","PSORXEDT",43,0)
BBG K DFN F PSODFN=0:0 S PSODFN=$O(^TMP("PSOBEDT",$J,PSODFN)) Q:'PSODFN  I $G(^TMP("PSOBEDT",$J,PSODFN,1)),$D(DISGROUP) S TM=$P($G(^TMP("PSOBB",$J)),"^"),TM1=$P($G(^($J)),"^",2),PPL=^TMP("PSOBEDT",$J,PSODFN,0) D ^PSOBING1
"RTN","PSORXEDT",44,0)
NX ;
"RTN","PSORXEDT",45,0)
 K %X,%Y,ACTREF,ACTREN,D,D0,DAT,DFN,DIC,DIQ,DQ,DRG,END,FDR,PSOBEDT,TM,TM1,PSOT1,PSOLST2,NOBG,BBFLG,BINGCRT,BINGRTE,C,CC,CMOP,COM,CT,D1,DI,DREN,BBRX,PSOFROM,POP,PSORX("QFLG"),IT,PSOERR,PSOBCK,PSOBM,PPL
"RTN","PSORXEDT",46,0)
 K ^TMP("PSOBEDT",$J),^TMP("PSOBB",$J),ZTSK,NOPP,VALMSG,VALMBCK D EOJ
"RTN","PSORXEDT",47,0)
END Q
"RTN","PSORXEDT",48,0)
 ;---------------------------------------------------------
"RTN","PSORXEDT",49,0)
PT ;
"RTN","PSORXEDT",50,0)
 N PSOTXEDT,PSOTPEXT S PSOTXEDT=$P($G(^PSRX(ORN,0)),"^",2) I PSOTXEDT I $D(^PS(52.91,PSOTXEDT,0)) I '$P(^PS(52.91,PSOTXEDT,0),"^",3)!($P(^(0),"^",3)>DT) D PDIR^PSOTPCAN(PSOTXEDT) I $G(PSOTPEXT) K PSOTPEXT,PSOTXEDT D EOJ Q
"RTN","PSORXEDT",51,0)
 K PSOTXEDT,PSOTPEXT
"RTN","PSORXEDT",52,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) S ^TMP("PSOBB",$J)=TM_"^"_TM1
"RTN","PSORXEDT",53,0)
 S $P(PSOLST(ORN),"^",2)=ORN,(PSOBEDT)=1
"RTN","PSORXEDT",54,0)
 S (DFN,PSODFN)=+$P(^PSRX(ORN,0),"^",2),PSORX("NAME")=$P(^DPT(DFN,0),"^")
"RTN","PSORXEDT",55,0)
 D ICN^PSODPT(DFN)
"RTN","PSORXEDT",56,0)
 S RX0=^PSRX(ORN,0),RX2=$G(^(2)),RX3=$G(^(3))
"RTN","PSORXEDT",57,0)
 D:$G(DUZ("AG"))="V" COPAY^PSOPTPST ; Deals with copay
"RTN","PSORXEDT",58,0)
 K ^TMP("PSOHDR",$J),^TMP("PSOPI",$J) D ^VADPT,ADD^VADPT
"RTN","PSORXEDT",59,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1),^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSORXEDT",60,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2)
"RTN","PSORXEDT",61,0)
 S ^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSORXEDT",62,0)
 S POERR=1 D RE^PSODEM K POERR,VALMBCK
"RTN","PSORXEDT",63,0)
 S ^TMP("PSOHDR",$J,6,0)=$S($P(WT,"^",8):$P(WT,"^",9)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSORXEDT",64,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$P(HT,"^",9)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSORXEDT",65,0)
 S ^TMP("PSOHDR",$J,9,0)="",^TMP("PSOHDR",$J,10,0)=""
"RTN","PSORXEDT",66,0)
 S GMRA="0^0^111" D ^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSORXEDT",67,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) S ^TMP("PSOBB",$J)=TM_"^"_TM1
"RTN","PSORXEDT",68,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORXEDT",69,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSORXEDT",70,0)
 D CLEAR^VALM1
"RTN","PSORXEDT",71,0)
 S STA="ACTIVE^NON-VERIFIED^REFILL^HOLD^NON-VERIFIED^SUSPENDED^^^^^^EXPIRED^DISCONTINUED^^DISCONTINUED^DISCONTINUED^HOLD"
"RTN","PSORXEDT",72,0)
 S $P(PSOLST(ORN),"^",3)=$P(STA,"^",$P(^PSRX(ORN,"STA"),"^")+1),PSLST=ORN,ORD=1
"RTN","PSORXEDT",73,0)
 D ACT^PSOORNE2
"RTN","PSORXEDT",74,0)
EOJ ;
"RTN","PSORXEDT",75,0)
 K HDR,IK,INDT,LOG,NODE,ORN,P1,PSI,PSL,PSOLION,PSNP,PSOACT,PSOBM,PSOCLC,PSOCNT,PSODD,PSODFN,PSOHD,PSOJ,PSOLST,PSOOI,PSOPF,PSLST
"RTN","PSORXEDT",76,0)
 K PSOIBQS,PSORLST,PSOSD,PSOSIG,PSPRXN,PSORX0,PSORX1,PTST,REFL,RF,RFD,RIFN,RLD,RPH,RTS,RX0,RX1,RX2,RX3,RXM,RXOR,SIG,SIGOK
"RTN","PSORXEDT",77,0)
 D KVA^VADPT K SLPPL,ST,STA,^TMP("PS",$J),PSOQFLG,PSORXED,PSOEDIT,DIR,DIRUT,DUOUT,DTOUT,PSOLOUD,GMRAL,GG,FEV,ACNT
"RTN","PSORXEDT",78,0)
 D FULL^VALM1 K ^TMP("PSOAL",$J),^TMP("PSOAO",$J),^TMP("PSOSF",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOPO",$J),^TMP("PSOHDR",$J),PAT
"RTN","PSORXEDT",79,0)
 K JJ,K,MM,PSDAYS,PSOAC,PSOAL,PSOCOU,PSOCOUU,PSONEW,PSODRUG,PSONOOR,PSRX0,QTY,REA,RFCNT,RFDT,RXDA,RXFL,RXREF,SUB,X,Z,ZII
"RTN","PSORXEDT",80,0)
 K ACOM,CRIT,DA,DDH,DGI,DGS,PSONEW3,SER,SERS,ZONE,RN,RXN,PSOX,PSOERR,ORD,PSOBCK,PSOBILL,SURX,PSORX("QFLG"),PSORX("FN"),CLOZPAT
"RTN","PSORXEDT",81,0)
 Q
"RTN","PSORXEDT",82,0)
LIST ;
"RTN","PSORXEDT",83,0)
 I $G(^PSRX(RXN,0))']"" W !,$C(7),"Rx data is not on file !",! G LISTX
"RTN","PSORXEDT",84,0)
 I $P(^PSRX(RXN,0),"^",15)=13 S PSVD=1 W !,$C(7),"Rx # "_RXM_" has been deleted."
"RTN","PSORXEDT",85,0)
 S RXN1=RXN,RXM1=RXM D:'$G(PSVD) LST1 W "." S RXN=RXN1,RXM=RXM1 K RXN1,RXM1
"RTN","PSORXEDT",86,0)
 F  S RXN=$O(^PSRX("B",RXM,RXN)) Q:'RXN  D
"RTN","PSORXEDT",87,0)
 .I $G(^PSRX(RXN,0))']"" Q
"RTN","PSORXEDT",88,0)
 .I $P(^PSRX(RXN,0),"^",15)=13 Q
"RTN","PSORXEDT",89,0)
 .D LST1
"RTN","PSORXEDT",90,0)
 K RXN1 G LISTX
"RTN","PSORXEDT",91,0)
 Q
"RTN","PSORXEDT",92,0)
LST1 I $G(PSOLIST(1))']"" S PSOLIST(1)=RXN_"," G LISTX
"RTN","PSORXEDT",93,0)
 F PSOX1=0:0 S PSOX1=$O(PSOLIST(PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORXEDT",94,0)
 I $L(PSOLIST(PSOX2))+$L(RXN)<220 S:RXN_","'[PSOLIST(PSOX2) PSOLIST(PSOX2)=PSOLIST(PSOX2)_RXN_","
"RTN","PSORXEDT",95,0)
 E  S:RXN_","'[PSOLIST(PSOX2+1) PSOLIST(PSOX2+1)=RXN_","
"RTN","PSORXEDT",96,0)
LISTX K PSOX1,PSOX2,RXN,PSVD
"RTN","PSORXEDT",97,0)
 Q
"RTN","PSORXL")
0^73^B71179264
"RTN","PSORXL",1,0)
PSORXL ;BHAM ISC/SAB - action to be taken on prescriptions ;03/01/96  9:35
"RTN","PSORXL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,21,24,32,47,135,148**;DEC 1997
"RTN","PSORXL",3,0)
 ;External reference to File #50 supported by DBIA 221
"RTN","PSORXL",4,0)
 ;External references CHPUS^IBACUS and TRI^IBACUS supported by DBIA 2030
"RTN","PSORXL",5,0)
 I $G(PSOTRVV),$G(PPL) S PSORX("PSOL",1)=PPL K PPL
"RTN","PSORXL",6,0)
 N SLBL,PSOSONE,PSOKLRXS
"RTN","PSORXL",7,0)
 S:'$G(PPL) PPL=$G(PSORX("PSOL",1)) G:$P(PSOPAR,"^",26) P
"RTN","PSORXL",8,0)
LBL W !! S DIR("A",1)="Label Printer: "_$S($G(SUSPT):PSLION,1:$G(PSOLAP))
"RTN","PSORXL",9,0)
 S DIR("A")="LABEL: QUEUE/CHANGE PRINTER"_$S($P(PSOPAR,"^",23):"/HOLD",1:"")_$S($P(PSOPAR,"^",24):"/SUSPEND",1:"")_$S($P(PSOPAR,"^",26):"/LABEL",1:"")_" or '^' to bypass "
"RTN","PSORXL",10,0)
 S DIR("?",1)="Enter 'Q' to queue labels to print",DIR("?")="Enter '^' to bypass label functions",DIR("?",4)="Enter 'S' to suspend labels to print later"
"RTN","PSORXL",11,0)
 S DIR("?",2)="Enter 'H' to hold label until Rx can be filled",DIR("?",3)="Enter 'P' for Rx profile"
"RTN","PSORXL",12,0)
 S DIR("?",5)="Enter 'C' to select another label printer"
"RTN","PSORXL",13,0)
 S:$P(PSOPAR,"^",26) DIR("?",5)="Enter 'L' to print labels without queuing"
"RTN","PSORXL",14,0)
TRI ;Tricare
"RTN","PSORXL",15,0)
 S X="IBACUS" X ^%ZOSF("TEST") K X I '$T G PASS
"RTN","PSORXL",16,0)
 I '$$TRI^IBACUS() G PASS
"RTN","PSORXL",17,0)
 I '$D(PSORX("PSOL",1))!($G(PSOSUREP))!($G(PSOEXREP)) G PASS
"RTN","PSORXL",18,0)
 N GGG,PBILL,PSTRD,PSTRDZ,PSTRF,PSTRP,TRXI,TRIRX,PSTRIVAR,VV,VVV,VVCT
"RTN","PSORXL",19,0)
 D DEV^PSOCPTRI
"RTN","PSORXL",20,0)
 K ^TMP($J,"PSONOB"),^TMP($J,"PSOBILL")
"RTN","PSORXL",21,0)
 S VVCT=0 F VV=0:0 S VV=$O(PSORX("PSOL",VV)) Q:'VV  F VVV=1:1 S TRXI=$P(PSORX("PSOL",VV),",",VVV) Q:'TRXI  D
"RTN","PSORXL",22,0)
 .I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSORXL",23,0)
 .I $P($G(^PSRX(+TRXI,"STA")),"^")=3 Q
"RTN","PSORXL",24,0)
 .S PSTRP=$P($G(^PSRX(+TRXI,0)),"^",2),PSTRD=+$G(PSOSITE),PSTRDZ=+$G(DUZ)
"RTN","PSORXL",25,0)
 .S PSTRF=0 F GGG=0:0 S GGG=$O(^PSRX(+TRXI,1,GGG)) Q:'GGG  S PSTRF=GGG
"RTN","PSORXL",26,0)
 .S VVCT=VVCT+1
"RTN","PSORXL",27,0)
 .I $G(RXRP(TRXI))!($G(RXPR(TRXI)))!($G(RXRH(TRXI))) S ^TMP($J,"PSONOB",VVCT)=TRXI Q
"RTN","PSORXL",28,0)
 .S PBILL=$$CHPUS^IBACUS(PSTRP,DT,TRXI,PSTRF,PSOLAP,PSTRD,PSTRDZ) S ^TMP($J,$S($G(PBILL):"PSOBILL",1:"PSONOB"),VVCT)=TRXI
"RTN","PSORXL",29,0)
 I '$D(^TMP($J,"PSOBILL")) K ^TMP($J,"PSONOB") G PASS
"RTN","PSORXL",30,0)
 I '$D(^TMP($J,"PSONOB")),$D(^TMP($J,"PSOBILL")) S (Y,LBL)="H" G H1
"RTN","PSORXL",31,0)
 ;If some Rx's are billable, and some are not
"RTN","PSORXL",32,0)
SETP K PSORX("PSOL"),PPL S VVCT=1 F VV=0:0 S VV=$O(^TMP($J,$S($G(PSTRIVAR):"PSONOB",1:"PSOBILL"),VV)) Q:'VV  S TRIRX=^TMP($J,$S($G(PSTRIVAR):"PSONOB",1:"PSOBILL"),VV) I +TRIRX D
"RTN","PSORXL",33,0)
 .I $G(PSORX("PSOL",1))="" S PSORX("PSOL",1)=TRIRX_"," Q
"RTN","PSORXL",34,0)
 .I $L(PSORX("PSOL",VVCT))+$L(TRIRX)<220 S PSORX("PSOL",VVCT)=PSORX("PSOL",VVCT)_TRIRX_"," Q
"RTN","PSORXL",35,0)
 .S VVCT=VVCT+1 S PSORX("PSOL",VVCT)=TRIRX_","
"RTN","PSORXL",36,0)
 I '$G(PSTRIVAR) S (Y,LBL)="H" S PSOKLRXS=1 K PSORSAVE,PSOPSAVE,PSOHSAVE D RSAVE D H1 D RREST K PSORSAVE,PSOPSAVE,PSOHSAVE K PSOKLRXS S PSTRIVAR=1 G SETP
"RTN","PSORXL",37,0)
 K ^TMP($J,"PSONOB") S PPL=$G(PSORX("PSOL",1))
"RTN","PSORXL",38,0)
PASS ;
"RTN","PSORXL",39,0)
 I $E($G(DIR("A")),1,6)'="LABEL:" D RESDIR^PSOCPTRI
"RTN","PSORXL",40,0)
 S DIR(0)="SA^P:PROFILE;Q:QUEUE;C:CHANGE PRINTER"_$S($P(PSOPAR,"^",23):";H:HOLD",1:"")_$S($P(PSOPAR,"^",24):";S:SUSPENSE",1:"")_$S($P(PSOPAR,"^",26):";L:PRINT",1:""),DIR("B")="Q" D ^DIR D  G:$D(DIRUT)!($D(DUOUT)) EX
"RTN","PSORXL",41,0)
 .I $D(DIRUT)!($D(DUOUT)) D AL^PSOLBL("UT") I $G(PSOEXREP) S PSOEXREX=1
"RTN","PSORXL",42,0)
 .I $G(PSOPULL) I $D(DIRUT)!($D(DUOUT)) S PSOQFLAG=1
"RTN","PSORXL",43,0)
 S:$G(PSOBEDT) NOPP=Y
"RTN","PSORXL",44,0)
 I $G(Y)="C" K PSOCLBL,%ZIS("B") S PSOCLBL=1 D @$S('$D(PSOPAR):"^PSOLSET",1:"PLBL^PSOLSET") K PSOCLBL G LBL
"RTN","PSORXL",45,0)
 I $G(Y)="Q",$D(RXRS),'$G(PSOPULL) D PPLADD^PSOSUPOE
"RTN","PSORXL",46,0)
 I $G(PSXSYS),($G(Y)'="H"),($G(Y)'="P"),('$G(PSOEXREP)) S LBL=Y,(RXLTOP,PPL1)=1 S:'$G(PSOPULL) SLBL=Y D A^PSOCMOP G:'$G(PPL) D1
"RTN","PSORXL",47,0)
 K DIR S LBL=Y S:'$G(PSOPULL) SLBL=Y G Q:Y="Q",S:Y="S",H1:Y="H",P:Y="L" I Y="P" W ! S PSDFN=DFN,PSFROM="" D ^PSODSPL K PSDFN,PSFROM G LBL
"RTN","PSORXL",48,0)
EX I $D(DUOUT)!$D(DIRUT) K BINGCRT,BINGRTE,BBRX,BBFLG S:$D(RXRS) SLBL="^" G:$D(RXRS) RXS K DIR,X,DIRUT,DUOUT,ACT,Y,DTOUT,PPL,REPRINT S NOBG=1 Q
"RTN","PSORXL",49,0)
Q S PPL1=1 G:$G(PPL)']"" D1 S PSNP=0,PSL=1 D  I $G(PSOFROM)="NEW",$P(PSOPAR,"^",8) S PSNP=1
"RTN","PSORXL",50,0)
 .Q:'$P(PSOPAR,"^",8)!($G(PSONOPRT))
"RTN","PSORXL",51,0)
 .F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL!($G(PSNP))  I '$O(^PSRX(SLPPL,1,0)),'$D(RXPR(SLPPL)) S PSNP=1
"RTN","PSORXL",52,0)
 I $G(PSOLAP)]"",$G(PSOLAP)'=ION G QLBL
"RTN","PSORXL",53,0)
Q1 W ! K POP S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A") Q:$G(POP)&($G(PSPARTXX))  G:$G(POP)&($G(PSOSONE)) RXSQ D:$G(POP)&($G(PSONOPRT))  Q:$G(PSOQFLAG)  G:POP!(IO=IO(0)) LBL S PSOLAP=ION
"RTN","PSORXL",54,0)
 .S PSOQFLAG=1
"RTN","PSORXL",55,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSORXL",56,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",10)
"RTN","PSORXL",57,0)
 D ^%ZISC S PSL=0
"RTN","PSORXL",58,0)
QLBL I $G(PSXSYS),('$G(RXLTOP)),('$G(PSOEXREP)) D RXL^PSOCMOP G:'$G(PPL) D1
"RTN","PSORXL",59,0)
 ;
"RTN","PSORXL",60,0)
 ;- Submitting list of Rx to ECME for DUR/79 REJECT check and possible submission to 3rd Pary Payer
"RTN","PSORXL",61,0)
 D ECME^PSORXL1
"RTN","PSORXL",62,0)
 ;
"RTN","PSORXL",63,0)
 S ZTRTN="DQ^PSOLBL",ZTIO=$S($G(SUSPT):PSLION,1:PSOLAP),ZTDESC="Outpatient Pharmacy "_$S($G(SUSPT):"SUSPENSE ",$G(DG):"DRUG INTERACTION ",1:"")_"LABELS OUTPUT ROUTINE",ZTDTH=$S($G(PSOTIME):PSOTIME,1:$H),PDUZ=DUZ
"RTN","PSORXL",64,0)
 F G="PPL1","PSOSYS","DFN","PSOPAR","PDUZ","PCOMX",$S($G(SUSPT):"PFION",1:"PSOLAP"),"PPL","PSOSITE","RXY","COPIES","SIDE","PSOSUSPR","PSOBARS","PSOBAR1","PSOBAR0","PSODELE","PSOPULL","PSTAT","PSODBQ","PSOEXREP","PSOTREP" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",65,0)
 S ZTSAVE("PSORX(")="",ZTSAVE("RXRP(")="",ZTSAVE("RXPR(")="",ZTSAVE("RXRS(")="",ZTSAVE("RXFL(")="",ZTSAVE("PCOMH(")=""
"RTN","PSORXL",66,0)
 D ^%ZISC,^%ZTLOAD K:$G(PSOSONE) RXRS W:$D(ZTSK)&('$G(SUSPT))&('$G(PSOEXREP)) !!,"LABEL(S) QUEUED TO PRINT",!!
"RTN","PSORXL",67,0)
 Q:$G(PSPARTXX)  K G,PDUZ K:'$G(SUSPT) ZTSK Q:$G(DG)
"RTN","PSORXL",68,0)
 G:'$G(PSNP) QUEUP G:$G(PSOPRFLG) QUEUP S HOLDRPAS=$G(PSOPRPAS),PSOPRPAS=$P(PSOPAR,"^",13)
"RTN","PSORXL",69,0)
PLBL S PSOION=ION
"RTN","PSORXL",70,0)
 I '$D(PSOPROP)!($G(PSOPROP)=ION) W $C(7),!,"PROFILES MUST BE SENT TO PRINTER !!",! K IOP,%ZIS,IO("Q"),POP S %ZIS="MNQ",%ZIS("A")="Select PROFILE DEVICE: " D ^%ZIS K %ZIS("A") G:POP QUEUP G:$E(IOST)["C"!(PSOION=ION) PLBL S PSOPROP=ION
"RTN","PSORXL",71,0)
QPRF S ZTRTN="DQ^PSOPRF",ZTIO=PSOPROP,ZTDESC="Outpatient Pharmacy "_$S($G(SUSPT):"SUSPENSE ",1:"")_"PATIENT PROFILES",ZTDTH=$S($G(PSOTIME):PSOTIME,1:$H)
"RTN","PSORXL",72,0)
 F G="PSOPAR","PSODTCUT","PSOPRPAS","DFN","PSOSITE","NEW1","NEW11","PSOBMST","PFIO","PPL" S:$D(@G) ZTSAVE(G)=""
"RTN","PSORXL",73,0)
 D ^%ZTLOAD W:$D(ZTSK)&('$G(SUSPT))&('$G(PSOEXREP)) !,"PROFILE IS QUEUED TO PRINT",!! K G K:'$G(SUSPT) ZTSK D ^%ZISC
"RTN","PSORXL",74,0)
QUEUP D:$G(POP)&($G(PSONOPRT))  Q:$G(PSOQFLAG)  S PSNP=0,PSOPRPAS=$G(HOLDRPAS) K:PSOPRPAS']"" PSOPRPAS K HOLDRPAS G D1
"RTN","PSORXL",75,0)
 .S PSOQFLAG=1
"RTN","PSORXL",76,0)
 Q
"RTN","PSORXL",77,0)
 ;
"RTN","PSORXL",78,0)
S G S^PSORXL1
"RTN","PSORXL",79,0)
SUS S X="IBACUS" X ^%ZOSF("TEST") K X I '$T G SUSL1
"RTN","PSORXL",80,0)
 N TRIDA S TRIDA=DA I '$$TRI^IBACUS() S DA=TRIDA G SUSL1
"RTN","PSORXL",81,0)
 I $G(RXRP(TRIDA))!($G(RXPR(TRIDA)))!($G(RXRH(TRIDA))) S DA=TRIDA G SUSL1
"RTN","PSORXL",82,0)
 N PBILL,PSTRD,PSTRDZ,PSTRF,PSTRP,GGG
"RTN","PSORXL",83,0)
 D DEV^PSOCPTRI
"RTN","PSORXL",84,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSORXL",85,0)
 S PSTRP=$P($G(^PSRX(+TRIDA,0)),"^",2),PSTRD=+$G(PSOSITE),PSTRDZ=+$G(DUZ)
"RTN","PSORXL",86,0)
 S PSTRF=0 F GGG=0:0 S GGG=$O(^PSRX(+TRIDA,1,GGG)) Q:'GGG  S PSTRF=GGG
"RTN","PSORXL",87,0)
 S PBILL=$$CHPUS^IBACUS(PSTRP,DT,TRIDA,PSTRF,PSOLAP,PSTRD,PSTRDZ)
"RTN","PSORXL",88,0)
 I '$G(PBILL) S DA=TRIDA G SUSL1
"RTN","PSORXL",89,0)
 S FLD(99)="99",FLD(99.1)="Awaiting CHAMPUS billing approval"
"RTN","PSORXL",90,0)
 N RSDT,ACT,PSUS,RXF,RFN,I,PSDA,NOW,IR,FDA
"RTN","PSORXL",91,0)
 S DA=TRIDA D H^PSOCPTRH
"RTN","PSORXL",92,0)
 Q
"RTN","PSORXL",93,0)
SUSL1 G SUS^PSORXL1
"RTN","PSORXL",94,0)
H1 S PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",PPL1))
"RTN","PSORXL",95,0)
 D:'$D(^TMP($J,"PSOBILL")) NOOR^PSOHLD I $D(DIRUT) K DIRUT G PSORXL
"RTN","PSORXL",96,0)
 I $D(^TMP($J,"PSOBILL")) S FLD(99)="99",FLD(99.1)="Awaiting CHAMPUS billing approval" G H
"RTN","PSORXL",97,0)
 G:$G(PPL)']"" D1 D FLD^PSOHLD I $D(DUOUT)!($D(DIRUT)) K DIRUT,DUOUT,FLD,DIR G LBL
"RTN","PSORXL",98,0)
H K SPPL G:$D(DTOUT) D1 S SPPL="" F PI=1:1 Q:$P(PPL,",",PI)=""  D
"RTN","PSORXL",99,0)
 .S DA=$P(PPL,",",PI) I $P(^PSRX(DA,"STA"),"^")<10,$P(^("STA"),"^")'=4 D @$S($D(^TMP($J,"PSOBILL")):"H^PSOCPTRH",1:"H^PSOHLD") Q
"RTN","PSORXL",100,0)
 .I $P(^PSRX(DA,"STA"),"^")=4 S SPPL=SPPL_DA_"," Q
"RTN","PSORXL",101,0)
 I $G(SPPL)]"" D
"RTN","PSORXL",102,0)
 .W !!,$C(7),"Drug Interaction Rx(s) " F I=1:1 Q:$P(SPPL,",",I)=""  W $P(^PSRX($P(SPPL,",",I),0),"^")_", "
"RTN","PSORXL",103,0)
 .S PPL=SPPL,DG=1 D Q K DG,SPPL
"RTN","PSORXL",104,0)
D1 K RXLTOP I $G(PPL1),$O(PSORX("PSOL",$G(PPL1))) S PPL1=$O(PSORX("PSOL",PPL1)),PPL=PSORX("PSOL",PPL1) G @$S(LBL="H":"H",LBL="L":"P1",1:"QLBL")
"RTN","PSORXL",105,0)
RXS I $D(RXRS),'$G(PSOKLRXS) I $G(SLBL)="H"!($G(SLBL)="S")!($G(SLBL)="^")!($G(SLBL)="") D  G:$G(PPL)'="" Q
"RTN","PSORXL",106,0)
 .K PPL,PSORX("PSOL") S PSOSONE=1 D PPLADD^PSOSUPOE
"RTN","PSORXL",107,0)
 .Q:$G(PPL)=""  W !!,"You have selected the following Rx(s) to be pulled from suspense:",!
"RTN","PSORXL",108,0)
 .F RXSS=0:0 S RXSS=$O(RXRS(RXSS)) Q:'RXSS  W !," Rx # ",$P($G(^PSRX(+$G(RXSS),0)),"^"),?23,$P($G(^PSDRUG(+$P($G(^PSRX(+$G(RXSS),0)),"^",6),0)),"^")
"RTN","PSORXL",109,0)
 .K DIR W ! S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you still want to pull these Rx(s) from suspense" D ^DIR K DIR I Y'=1 W !!,"Rx(s) will remain in Suspense!",! D RESET^PSOSUPOE K RXRS,PPL
"RTN","PSORXL",110,0)
 K:'$G(PSOKLRXS) RXRS K ^TMP($J,"PSOBILL"),RXPR,RXRP,RXRH,RXSS,LBL,PPL1,PPL,DIR,%DT,%,SD,COUNT,EXDT,L,PDUZ,REF,REPRINT,RFDATE,RFL1,RFLL,RXN,WARN,ZY,FLD,PI,ZD,ACT,X,Y,DIRUT,DUOUT,DTOUT,DIROUT Q
"RTN","PSORXL",111,0)
P S PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",1)) G:$G(PPL)']"" D1
"RTN","PSORXL",112,0)
 I $G(PSOLAP)']"" W ! K POP,ZTSK S %ZIS="M",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS K %ZIS("A") G:POP LBL S PSOLAP=ION
"RTN","PSORXL",113,0)
 S IOP=PSOLAP D ^%ZIS
"RTN","PSORXL",114,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSORXL",115,0)
P1 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",10),PDUZ=DUZ D DQ1^PSOLBL,^%ZISC
"RTN","PSORXL",116,0)
 G:'$P(PSOPAR,"^",8)!(+$G(REPRINT))!($G(PSOFROM)'="NEW") D1 I $G(PSOPROP)']"" S PSOION=ION,%ZIS="M",%ZIS("A")="Select PROFILE DEVICE: " D ^%ZIS K %ZIS("A") G:POP D1 S PSOPROP=ION
"RTN","PSORXL",117,0)
 S IOP=PSOPROP D ^%ZIS D DQ^PSOPRF,^%ZISC G D1
"RTN","PSORXL",118,0)
 Q
"RTN","PSORXL",119,0)
RXSQ K RXRS G RXS
"RTN","PSORXL",120,0)
 Q
"RTN","PSORXL",121,0)
RSAVE N PMX
"RTN","PSORXL",122,0)
 S PMX="" F  S PMX=$O(RXRP(PMX)) Q:PMX=""  S PSORSAVE(PMX)=RXRP(PMX)
"RTN","PSORXL",123,0)
 S PMX="" F  S PMX=$O(RXPR(PMX)) Q:PMX=""  S PSOPSAVE(PMX)=RXPR(PMX)
"RTN","PSORXL",124,0)
 S PMX="" F  S PMX=$O(RXRH(PMX)) Q:PMX=""  S PSOHSAVE(PMX)=RXRH(PMX)
"RTN","PSORXL",125,0)
 Q
"RTN","PSORXL",126,0)
RREST N PMXZ
"RTN","PSORXL",127,0)
 S PMXZ="" F  S PMXZ=$O(PSORSAVE(PMXZ)) Q:PMXZ=""  S RXRP(PMXZ)=PSORSAVE(PMXZ)
"RTN","PSORXL",128,0)
 S PMXZ="" F  S PMXZ=$O(PSOPSAVE(PMXZ)) Q:PMXZ=""  S RXPR(PMXZ)=PSOPSAVE(PMXZ)
"RTN","PSORXL",129,0)
 S PSMX="" F  S PMXZ=$O(PSOHSAVE(PMXZ)) Q:PMXZ=""  S RXRH(PMXZ)=PSOHSAVE(PMXZ)
"RTN","PSORXL",130,0)
 Q
"RTN","PSORXL1")
0^74^B42190830
"RTN","PSORXL1",1,0)
PSORXL1 ;BIR/SAB-action to be taken on prescriptions ;03/01/96
"RTN","PSORXL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**36,46,148**;DEC 1997
"RTN","PSORXL1",3,0)
S S SPPL="",PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",PPL1)) G:$G(PPL)']"" D1
"RTN","PSORXL1",4,0)
S1 F PI=1:1 Q:$P(PPL,",",PI)=""  S DA=$P(PPL,",",PI) D
"RTN","PSORXL1",5,0)
 .I $P(^PSRX(DA,"STA"),"^")<10,$P(^("STA"),"^")'=4 D SUS Q
"RTN","PSORXL1",6,0)
 .I $P(^PSRX(DA,"STA"),"^")=4 S SPPL=SPPL_DA_"," Q
"RTN","PSORXL1",7,0)
 I $G(SPPL)]"" D  K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DUOUT,DTOUT,DIRUT
"RTN","PSORXL1",8,0)
 .W !!,$C(7),"Drug Interaction Rx(s) " F I=1:1 Q:$P(SPPL,",",I)=""  W $P(^PSRX($P(SPPL,",",I),0),"^")_", "
"RTN","PSORXL1",9,0)
 .I $G(PSOLAP)=""!($G(PSOLAP)=$G(ION)) W !,"Label device must be selected for Drug Interaction label!"
"RTN","PSORXL1",10,0)
 .S PPL=SPPL,DG=1 N PPL1 D Q^PSORXL K DG,SPPL
"RTN","PSORXL1",11,0)
 S SUSPT="SUSPENSE" G D1
"RTN","PSORXL1",12,0)
 Q
"RTN","PSORXL1",13,0)
SUS S ACT=1,RXN=DA,RX0=^PSRX(DA,0),SD=$S($G(ZD(DA)):$E(ZD(DA),1,7),1:$P(^(3),"^")),RXS=$O(^PS(52.5,"B",DA,0)) I RXS S RXCMOP=$P($G(^PS(52.5,RXS,0)),"^",7) D  Q:$G(DFLG)!($G(PSOWFLG))
"RTN","PSORXL1",14,0)
 .;checks to see if future fill exists
"RTN","PSORXL1",15,0)
 .S PSOWFLG=0 I '$G(RXPR(DA)),$P($G(^PS(52.5,RXS,"P")),"^")=0,$P($G(^PSRX(DA,"STA")),"^")=5 D SWARN Q:$G(PSOWFLG)
"RTN","PSORXL1",16,0)
 .K PSOWFLG I $G(RXPR(DA)),'$P($G(^PS(52.5,RXS,"P")),"^") D WARN Q:$G(DFLG)
"RTN","PSORXL1",17,0)
 .S DA=RXS,DIK="^PS(52.5," D ^DIK S DA=RXN I $P($G(^PSRX(RXN,"STA")),"^")=5 S $P(^("STA"),"^")=0
"RTN","PSORXL1",18,0)
 G:$G(RXRP(DA))!($G(RXPR(DA))) LOCK
"RTN","PSORXL1",19,0)
 I $G(PSXSYS) D SUS1^PSOCMOP I $G(XFLAG)=1 K XFLAG Q
"RTN","PSORXL1",20,0)
LOCK I $P($G(^PSRX(RXN,"STA")),"^")=3 G SUSQ
"RTN","PSORXL1",21,0)
 S RXP=+$G(RXPR(DA)),DIC="^PS(52.5,",DIC(0)="L",X=RXN,DIC("DR")=".02///"_SD_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///"_RXP_";.06////"_PSOSITE_";2///0" K DD,DO D FILE^DICN D  I +Y,'$G(RXP),$G(RXRP(RXN)) S $P(^PS(52.5,+Y,0),"^",12)=1
"RTN","PSORXL1",22,0)
 .K DD,DO I +Y,$G(PSOEXREP) S $P(^PS(52.5,+Y,0),"^",12)=1
"RTN","PSORXL1",23,0)
 .I +Y S $P(^PS(52.5,+Y,0),"^",13)=$G(RXFL(RXN))
"RTN","PSORXL1",24,0)
 S $P(^PSRX(RXN,"STA"),"^")=5,LFD=$E(SD,4,5)_"-"_$E(SD,6,7)_"-"_$E(SD,2,3) D ACT
"RTN","PSORXL1",25,0)
 W !!,$S(RXP:"Partial ",1:"")_"RX# ",$P(^PSRX(RXN,0),"^")_" has been suspended until "_LFD_"."
"RTN","PSORXL1",26,0)
 S VALMSG=$S(RXP:"Partial ",1:"")_"Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended Until "_LFD_"."_$S($G(RXRP(RXN))&('$G(RXP)):" (Reprint)",1:"")
"RTN","PSORXL1",27,0)
 S COMM=$S(RXP:"Partial ",1:"")_"Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended Until "_LFD_"."_$S($G(RXRP(RXN))&('$G(RXP)):" (Reprint)",1:"")
"RTN","PSORXL1",28,0)
 D:'$D(^TMP("PSORXN",$J,RXN)) EN^PSOHLSN1(RXN,"SC","ZS",COMM)
"RTN","PSORXL1",29,0)
 S:$D(^TMP("PSORXN",$J,RXN)) $P(^TMP("PSORXN",$J,RXN),"^",4)=COMM
"RTN","PSORXL1",30,0)
 ;
"RTN","PSORXL1",31,0)
 ; - If not a PARTIAL, reverse ECME Claim, if necessary
"RTN","PSORXL1",32,0)
 I '$G(RXP) D REVERSE^PSOBPSU1(RXN,,"DC",3)
"RTN","PSORXL1",33,0)
 K COMM
"RTN","PSORXL1",34,0)
SUSQ Q
"RTN","PSORXL1",35,0)
ACT I '$D(RXF) S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSORXL1",36,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSORXL1",37,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXL1",38,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_DUZ_"^"_RXF_"^"_$S(RXP:"Partial ",1:"")_"RX "_$S($G(RXRP(DA))&('$G(RXP)):"Reprint ",1:"")_"Placed on Suspense until "_LFD K RXF,I,FDA,DIC,DIE,DR,Y,X,%,%H,%I
"RTN","PSORXL1",39,0)
 Q
"RTN","PSORXL1",40,0)
D1 I $O(PSORX("PSOL",$G(PPL1))) S PPL1=$O(PSORX("PSOL",$G(PPL1))),PPL=PSORX("PSOL",PPL1) G S1
"RTN","PSORXL1",41,0)
 G:$D(RXRS) RXS^PSORXL
"RTN","PSORXL1",42,0)
 K LBL,PPL1,PPL,DIR,%DT,%,SD,COUNT,EXDT,L,PDUZ,REF,REPRINT,RFDATE,RFL1,RFLL,RXN,WARN,ZY,FLD,PI,ZD,ACT,X,Y,DIRUT,DUOUT,DTOUT,DIROUT,DFLG,RXPD,PSOWFLG
"RTN","PSORXL1",43,0)
 Q
"RTN","PSORXL1",44,0)
WARN W ! K DIR,DIRUT,DUOUT,DTOUT,DFLG S Y=$P(^PS(52.5,RXS,0),"^",2) X ^DD("DD") S RXPD=Y,DIR(0)="SA^S:SUSPEND;Q:QUEUE;E:EXIT"
"RTN","PSORXL1",45,0)
 S DIR("A",1)="Rx #"_$P(^PSRX(DA,0),"^")_" is suspended "_$S($G(RXCMOP)]"":"for CMOP ",1:"")_"until "_RXPD
"RTN","PSORXL1",46,0)
 I $G(RXCMOP)]"" D  G WARN1
"RTN","PSORXL1",47,0)
 .W !!,"A partial entered for this Rx cannot be suspended."
"RTN","PSORXL1",48,0)
 .W !,"You may pull this fill from suspense or print the label now.",!!
"RTN","PSORXL1",49,0)
 .S DIR("A",2)=" ",DIR("A",3)="   Do you want to Queue to print",DIR("A")="                or Exit: "
"RTN","PSORXL1",50,0)
 S DIR("A",2)=" ",DIR("A",3)="   Do you want to: Suspend Partial",DIR("A",4)="                   Queue to print",DIR("A")="                or Exit:  "
"RTN","PSORXL1",51,0)
WARN1 S DIR("B")="EXIT",DIR("?")="^D HLP^PSORXL1" D ^DIR K DIR
"RTN","PSORXL1",52,0)
 I Y="E"!($D(DIRUT))!(Y="S"&($G(RXCMOP)]"")) S DA(1)=DA,DA=RXPR(DA),DIK="^PSRX("_DA(1)_",""P""," D ^DIK S ^PSRX(DA(1),"TYPE")=0,DFLG=1 W $C(7)," Partial Removed!" Q
"RTN","PSORXL1",53,0)
 I Y="Q" S DPPL=PPL,HOLDPPL1=$G(PPL1),DPI=PI,RXLTOP=1 S PPL=$G(RXN)_"," S PSPARTXX=1 D Q^PSORXL K PSPARTXX S DFLG=1,PPL=DPPL,PI=DPI,PPL1=$G(HOLDPPL1) K HOLDPPL1,DPPL,DPPI,DPI,RXLTOP Q
"RTN","PSORXL1",54,0)
 Q
"RTN","PSORXL1",55,0)
HLP I $G(RXCMOP)']"" W !!,"If you choose to suspend this partial Rx, the current suspended fill will",!,"be replaced by the partial.  You may want to pull this fill early instead.",!
"RTN","PSORXL1",56,0)
 I $G(RXCMOP)]"" W !!,"You cannot suspend a partial when a CMOP fill is in suspense, because the partial will replace the CMOP fill in suspense."
"RTN","PSORXL1",57,0)
 W !,"If you choose to queue this partial, the label will printout on the previous",!,"selected label printer.",!
"RTN","PSORXL1",58,0)
 W !,"You may exit without printing or suspending this partial.  This will also delete",!,"the partial Rx entered."
"RTN","PSORXL1",59,0)
 Q
"RTN","PSORXL1",60,0)
SWARN ;
"RTN","PSORXL1",61,0)
 S PSORXLDA=$G(DA),PSORXZD=$P($G(^PS(52.5,RXS,0)),"^",2)
"RTN","PSORXL1",62,0)
 W $C(7),!!,"Rx "_$P($G(^PSRX(DA,0)),"^")_" is already suspended "_$S($G(RXCMOP)]"":"for CMOP ",1:"")_"until "_$E(PSORXZD,4,5)_"-"_$E(PSORXZD,6,7)_"-"_$E(PSORXZD,2,3)_"." K PSORXZD
"RTN","PSORXL1",63,0)
 W !,"By suspending this fill, the fill that is already suspended will be overwritten",!,"and a label will not print for that fill!",!
"RTN","PSORXL1",64,0)
 K DIR S DIR(0)="SA^Q:QUEUE;S:SUSPEND",DIR("B")="Q",DIR("A")="Do you want to Queue to print or Suspend Rx "_$P($G(^PSRX(DA,0)),"^")_": " D ^DIR K DIR
"RTN","PSORXL1",65,0)
 I $G(Y)="S" K RXFL(PSORXLDA) G SWARNQ
"RTN","PSORXL1",66,0)
 I $G(Y)="Q" D  G SWARNQ
"RTN","PSORXL1",67,0)
 . S PSOKSPPL=$G(PPL),PSOZXPPL=$G(PPL1),PSOZXPI=$G(PI),RXLTOP=1
"RTN","PSORXL1",68,0)
 . S PPL=$G(RXN)_"," D SWARS D Q^PSORXL S PSOWFLG=1,PPL=PSOKSPPL
"RTN","PSORXL1",69,0)
 . S PI=PSOZXPI,PPL1=PSOZXPPL K PSOKSPPL,PSOZXPPL,PSOZXPI,RXLTOP,RXFL(+$G(PSORXLDA))
"RTN","PSORXL1",70,0)
 W !!,"Nothing queued to print for Rx "_$P($G(^PSRX(PSORXLDA,0)),"^"),! S PSOWFLG=1
"RTN","PSORXL1",71,0)
SWARNQ ;
"RTN","PSORXL1",72,0)
 S DA=$G(PSORXLDA) K PSORXLDA
"RTN","PSORXL1",73,0)
 Q
"RTN","PSORXL1",74,0)
SWARS ;
"RTN","PSORXL1",75,0)
 S PSOZXFL(PSORXLDA)=+$P($G(^PS(52.5,+$G(RXS),0)),"^",13) I '$G(PSOZXFL(PSORXLDA)) K PSOZXFL Q
"RTN","PSORXL1",76,0)
 S PSOZXFPL=$P(PSOKSPPL,",",+$G(PI),99)
"RTN","PSORXL1",77,0)
 S PSOZXFPN=$L(PSOZXFPL,PPL)-1
"RTN","PSORXL1",78,0)
 I $G(PSOZXFL(PSORXLDA)),$G(PSOZXFPN) S RXFL(PSORXLDA)=$G(PSOZXFL(PSORXLDA))-$G(PSOZXFPN)
"RTN","PSORXL1",79,0)
 K PSOZXFL,PSOZXFPL,PSOZXFPN
"RTN","PSORXL1",80,0)
 Q
"RTN","PSORXL1",81,0)
ECME ; - Looks for DUR/79 REJECTS and send Mail Rx's to ECME that have not been SUSPENDED
"RTN","PSORXL1",82,0)
 N PSOI,PSOJ,PSORX,PSORF,PSOACT,BWH
"RTN","PSORXL1",83,0)
 F PSOI=1:1 S PSORX=+$P($G(PPL),",",PSOI) Q:'PSORX  D
"RTN","PSORXL1",84,0)
 . I $G(RXPR(PSORX)) Q
"RTN","PSORXL1",85,0)
 . S PSOACT="",PSORF=$$LSTRFL^PSOBPSU1(PSORX)
"RTN","PSORXL1",86,0)
 . S BWH=$S(PSORF:"RF",1:"OF")
"RTN","PSORXL1",87,0)
 . I $$FIND^PSOREJUT(PSORX,PSORF) D  I PSOACT="Q" D RMV(PSORX,.PPL) Q
"RTN","PSORXL1",88,0)
 . . S PSOACT=$$HDLG^PSOREJU1(PSORX,PSORF,"79,88",BWH,"OIQ","Q")
"RTN","PSORXL1",89,0)
 Q
"RTN","PSORXL1",90,0)
RMV(RX,PPL) ; Remove the Rx from the label print queue
"RTN","PSORXL1",91,0)
 N XPPL,I
"RTN","PSORXL1",92,0)
 S XPPL=PPL,PPL="" F I=1:1:$L(XPPL,",") I $P(XPPL,",",I)'="",$P(XPPL,",",I)'=RX S PPL=PPL_$P(XPPL,",",I)_","
"RTN","PSORXL1",93,0)
 I PPL="" K PPL
"RTN","PSORXL1",94,0)
 Q
"RTN","PSORXPR")
0^31^B29756238
"RTN","PSORXPR",1,0)
PSORXPR ;BHAM ISC/SAB - view individual prescription ;08/23/96  8:15 am
"RTN","PSORXPR",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**131,156,148**;DEC 1997
"RTN","PSORXPR",3,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSORXPR",4,0)
 ;Reference ^PSDRUG( supported by DBIA 221
"RTN","PSORXPR",5,0)
 ;Reference to ^SC supported by DBIA 10040
"RTN","PSORXPR",6,0)
 ;Reference to ^PSXVIEW supported by DBIA 2204
"RTN","PSORXPR",7,0)
GET S RX0=^PSRX(DA,0),J=DA,$P(RX0,"^",15)=+$G(^("STA")),RX2=$G(^(2)),R3=$G(^(3)),RTN=$G(^("TN")) S (DFN,P0)=+$P(RX0,"^",2) S:$D(^DPT(P0,0)) P0=^(0) S FFX=0
"RTN","PSORXPR",8,0)
 S PSDIV=$S($D(^PS(59,+$P(RX2,"^",9),0)):$P(^(0),"^")_" ("_$P(^(0),"^",6)_")",1:"UNKNOWN"),PSDIV=$E(PSDIV,1,28),PSEXDT=$P(RX2,"^",6),PSEXDT=$S(PSEXDT]"":$E(PSEXDT,4,5)_"/"_$E(PSEXDT,6,7)_"/"_$E(PSEXDT,2,3),1:"UNKNOWN")
"RTN","PSORXPR",9,0)
PR D STAT^PSOFUNC I 'ST0,$D(^PS(52.4,"AREF",DFN,DA)) S ST="UNPRINTED"
"RTN","PSORXPR",10,0)
 ;S:$G(PSLSTVER)&($P($G(^PSRX(+$G(PSONV),"STA")),"^")=4) ST="PENDING DUE TO DRUG INTERACTION"
"RTN","PSORXPR",11,0)
 D PID^VADPT W @IOF,"RX: ",$P(RX0,"^"),?20,"PATIENT: "_$P(P0,"^")_" (",VA("PID")_") ",!,"STATUS: "_ST_"   "_$S($P($G(^PSRX(DA,"IB")),"^")]"":"CO-PAY STATUS",1:"") I ($D(PS)#2),PS="DISCONTINUE",ST["DISCONTINUE" S PS="REINSTATE"
"RTN","PSORXPR",12,0)
 ;W @IOF,!,"RX: ",$P(RX0,"^"),?20,"PATIENT: ",$P(P0,"^")," (",$P(P0,"^",9),") ",!,"STATUS: ",ST_"   "_$S($P($G(^PSRX(DA,"IB")),"^")]"":"CO-PAY STATUS",1:"") I ($D(PS)#2),PS="DISCONTINUE",ST["DISCONTINUE" S PS="REINSTATE"
"RTN","PSORXPR",13,0)
 I $G(PKI1)!($G(PKI)) N PKIT D  W !,PKIT
"RTN","PSORXPR",14,0)
 .I '$D(IORVON) S X="IORVOFF;IORVON" D ENDR^%ZISS S PKIT=IORVON_PKIE_IORVOFF K IORVOFF,IORVON,X Q
"RTN","PSORXPR",15,0)
 .S PKIT=IORVON_PKIE_IORVOFF
"RTN","PSORXPR",16,0)
 S MED=+$P(RX0,"^",6),M1="" S:$D(^PSDRUG(MED,0)) M1=^(0) W !,$S($P(M1,"^",3)["S":"      ITEM: ",1:"      DRUG: "),$S(RTN'="":RTN,1:$P(M1,"^"))_$S('$D(^("I")):"",^("I")']"":"",1:" - (inactivated)")
"RTN","PSORXPR",17,0)
 W !?6," QTY: ",$P(RX0,"^",7),"     ",$S($P(RX0,"^",8)?1N.N:$P(RX0,"^",8),1:"??")," DAY SUPPLY"
"RTN","PSORXPR",18,0)
 K FSIG,BSIG I $P($G(^PSRX(DA,"SIG")),"^",2) D FSIG^PSOUTLA("R",DA,66) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSORXPR",19,0)
 K FSIG,PSREV I '$P($G(^PSRX(DA,"SIG")),"^",2) D EN3^PSOUTLA1(DA,66)
"RTN","PSORXPR",20,0)
 W !?7,"SIG: ",$G(BSIG(1))
"RTN","PSORXPR",21,0)
 I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?12,$G(BSIG(PSREV))
"RTN","PSORXPR",22,0)
 K BSIG,PSREV
"RTN","PSORXPR",23,0)
 S II=J D LAST^PSORFL W !?4,"LATEST: ",RFLL,?37,"# OF REFILLS: ",$P(RX0,"^",9) S PL=0 D:$O(^PSRX(DA,1,0))  W "  REMAINING: ",$P(RX0,"^",9)-PL K IFN
"RTN","PSORXPR",24,0)
 .S IFN=0 F  S IFN=$O(^PSRX(DA,1,IFN)) Q:'IFN  S PL=PL+1
"RTN","PSORXPR",25,0)
DTT S DTT=$P(RX0,"^",13) D DAT W !?4,"ISSUED: ",DAT
"RTN","PSORXPR",26,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(R3,"^",3) D ^DIC
"RTN","PSORXPR",27,0)
 S PHYS=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") W ?41,"PROVIDER: "_PHYS S DTT=$P(RX2,"^")\1
"RTN","PSORXPR",28,0)
 I $P(R3,"^",3),+Y W !?41,"COSIGNER: "_$P(Y,"^",2)
"RTN","PSORXPR",29,0)
 D DAT W !?4,"LOGGED: ",DAT,?43,"CLINIC: ",$S($D(^SC(+$P(RX0,"^",5),0)):$P(^(0),"^"),1:"NOT ON FILE")
"RTN","PSORXPR",30,0)
 W !?3,"EXPIRES: ",PSEXDT,?41,"DIVISION: ",PSDIV,!?7,"CAP: ",$P("NON-^","^",$S($D(^PS(55,DFN,0)):+$P(^(0),"^",2),1:0)),"SAFETY",?42,"ROUTING: " S X=$F("MWI",$P(RX0,"^",11))-1 W:X $P("MAIL^WINDOW^INPATIENT","^",X)
"RTN","PSORXPR",31,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(RX0,"^",16) D ^DIC
"RTN","PSORXPR",32,0)
 W !?2,"ENTRY BY: ",$S(+Y:$P(Y,"^",2),1:$P(RX0,"^",16))
"RTN","PSORXPR",33,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(RX2,"^",10) D ^DIC
"RTN","PSORXPR",34,0)
 W:+Y ?38,"VERIFIED BY: ",$S(+Y:$P(Y,"^",2),1:$P(RX2,"^",10))
"RTN","PSORXPR",35,0)
 G:$D(PSOZVER) REM K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(RX2,"^",3) D ^DIC
"RTN","PSORXPR",36,0)
 W !!,"FILLED: "_RFL,?20,"PHARMACIST: "_$S(+Y:$P(Y,"^",2),1:""),?52,"LOT #: "_$P(RX2,"^",4)
"RTN","PSORXPR",37,0)
 W !," DISPENSED: "_$S($P(RX2,"^",5):$E($P(RX2,"^",5),4,5)_"/"_$E($P(RX2,"^",5),6,7)_"/"_$E($P(RX2,"^",5),2,3),1:"")
"RTN","PSORXPR",38,0)
 W ?$X+10,$S($P(RX2,"^",15):" RETURNED TO STOCK: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3),1:" RELEASED: "_$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:""))
"RTN","PSORXPR",39,0)
REM W:$P($G(^PSRX(DA,3)),"^",7)]"" !?3,"REMARKS: ",$P($G(^PSRX(DA,3)),"^",7) W:$P($G(^PSRX(DA,"D")),"^")]"" !,"DELETION COMMENT: "_$P(^("D"),"^")
"RTN","PSORXPR",40,0)
 D:$G(^PSRX(DA,"H"))]""&($G(ST)="HOLD") HLD^PSORXPR1
"RTN","PSORXPR",41,0)
 W ! D:PL RF^PSORXPR1 G Q:$D(DIRUT)  D PAR^PSORXPR1 G Q:$D(DIRUT)
"RTN","PSORXPR",42,0)
ACT I $O(^PSRX(DA,"A",0)) D CON:$Y>20 G Q:$D(DIRUT) D H1 F N=0:0 S N=$O(^PSRX(DA,"A",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D A1 Q:$D(DIRUT)
"RTN","PSORXPR",43,0)
 G Q:$D(DIRUT) I $O(^PSRX(DA,"L",0)) D:$Y>20 CON Q:$D(DIRUT)  D L1 F L1=0:0 S L1=$O(^PSRX(DA,"L",L1)) Q:'L1  S LBL=^PSRX(DA,"L",L1,0),DTT=$P(^(0),"^") D DAT,LG Q:$D(DIRUT)
"RTN","PSORXPR",44,0)
 N X S X="PSXVIEW" X ^%ZOSF("TEST") K X I $T D ^PSXVIEW
"RTN","PSORXPR",45,0)
 G Q
"RTN","PSORXPR",46,0)
LG I $Y>20 D CON Q:$D(DIRUT)  D L1
"RTN","PSORXPR",47,0)
 W !,L1,?3,DAT,?14,$S($P(LBL,"^",2):"REFILL "_$P(^PSRX(DA,"L",L1,0),"^",2),1:"ORIGINAL")
"RTN","PSORXPR",48,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(^PSRX(DA,"L",L1,0),"^",4) D ^DIC
"RTN","PSORXPR",49,0)
 W ?40,$P(Y,"^",2),!,"COMMENTS: "_$P(^PSRX(DA,"L",L1,0),"^",3) K DIC,X,Y
"RTN","PSORXPR",50,0)
 Q
"RTN","PSORXPR",51,0)
A1 D CON:$Y>20 Q:$D(DIRUT)  D H1:FFX,DAT W !,N,?3,DAT,?14
"RTN","PSORXPR",52,0)
 S X=$P(P1,"^",2),X=$F("HUCELPRWSIVDABXGKNM",X)-1
"RTN","PSORXPR",53,0)
 W:X $P("HOLD^UNHOLD^DISCONTINUED ^EDIT^RENEWED^PARTIAL^REINSTATE^REPRINT^SUSPENSE^RETURNED^INTERVENTION^DELETED^DRUG INTERACTION^PROCESSED^X-INTERFACE^PATIENT INST.^PKI/DEA^DISPENSE COMPLETED^ECME^","^",X)
"RTN","PSORXPR",54,0)
 W ?25 S X=+$P(P1,"^",4) W $S(X>0&(X<6):"REFILL "_X,X=6:"PARTIAL",X>6:"REFILL "_(X-1),1:"ORIGINAL")
"RTN","PSORXPR",55,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(P1,"^",3) D ^DIC
"RTN","PSORXPR",56,0)
 W ?40,$S(+Y:$P(Y,"^",2),1:$P(P1,"^",3)) K DIC,X,Y
"RTN","PSORXPR",57,0)
 W:$P(P1,"^",5)]"" !,"COMMENTS: ",$P(P1,"^",5) Q
"RTN","PSORXPR",58,0)
Q K ST0,RFL,RFLL,RFL1,ST,II,J,N,PHYS,L1,DIRUT,PSDIV,PSEXDT,MED,M1,FFX,DTT,DAT,RX0,RX2,R3,RTN,SIG,STA,P1,PL,P0,Z0,Z1,EXDT,IFN,DIR,DUOUT,DTOUT
"RTN","PSORXPR",59,0)
 K LBL,I,RFDATE,%H,%I K:$G(PS)="VIEW" DFN Q
"RTN","PSORXPR",60,0)
H1 I FFX W @IOF
"RTN","PSORXPR",61,0)
 W !!,"ACTIVITY LOG:",!,"#",?3,"DATE",?14,"REASON",?25,"RX REF",?40,"INITIATOR OF ACTIVITY",! F I=1:1:79 W "="
"RTN","PSORXPR",62,0)
 S FFX=0 W ! Q
"RTN","PSORXPR",63,0)
L1 I FFX W @IOF
"RTN","PSORXPR",64,0)
 W !!,"LABEL LOG:",!,"#",?3,"DATE",?14,"RX REF",?40,"PRINTED BY",! F I=1:1:79 W "="
"RTN","PSORXPR",65,0)
 S FFX=0 W ! Q
"RTN","PSORXPR",66,0)
CON Q:$D(PSOAC)  K DTOUT,DIRUT,DUOUT,DIR S DIR(0)="E" D ^DIR S FFX=1 Q
"RTN","PSORXPR",67,0)
 Q
"RTN","PSORXPR",68,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSORXPR",69,0)
 Q
"RTN","PSORXPR",70,0)
EN ; Entry Point for PSORXED
"RTN","PSORXPR",71,0)
 D PSORXPR K PHYS,RFDATE,RFL,RFL1,ST,ST0,RFLL
"RTN","PSORXPR",72,0)
 Q
"RTN","PSORXRP1")
0^52^B25369368
"RTN","PSORXRP1",1,0)
PSORXRP1 ;BIR/SAB-rx speed reprint listman ;03/06/95
"RTN","PSORXRP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,120,156,148**;DEC 1997
"RTN","PSORXRP1",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORXRP1",4,0)
SEL N PSODISP,VALMCNT I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSORXRP1",5,0)
 S RXCNT=0 K PSOFDR,DIR,DUOUT,DIRUT S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR S LST=Y I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" Q
"RTN","PSORXRP1",6,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,PSOREPX I +LST S PSOOELSE=1 D
"RTN","PSORXRP1",7,0)
 .D FULL^VALM1 K DIR S DIR("A")="Number of Copies? ",DIR(0)="N^1:99:0",DIR("?")="Enter the number of copies you want (1 TO 99)",DIR("B")=1
"RTN","PSORXRP1",8,0)
 .D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S COPIES=Y
"RTN","PSORXRP1",9,0)
 .K DIR S DIR("A")="Print adhesive portion of label only? ",DIR(0)="Y",DIR("B")="No",DIR("?",1)="If entire label, including trailers are to print press RETURN for default."
"RTN","PSORXRP1",10,0)
 .S DIR("?")="Else if only bottle and mailing labels are to print enter Y or YES." D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S SIDE=Y
"RTN","PSORXRP1",11,0)
 .I $P(PSOPAR,"^",30),$$GET1^DIQ(59,PSOSITE_",",105,"I")=2.4 D  Q:$G(PSOREPX)
"RTN","PSORXRP1",12,0)
 ..K DIR,DIRUT S DIR("A")="Do you want to resend to Dispensing System Device",DIR(0)="Y",DIR("B")="No"
"RTN","PSORXRP1",13,0)
 ..D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S PSODISP=$S(Y:0,1:1)
"RTN","PSORXRP1",14,0)
 .K DIRUT,DIR S DIR("A")="Comments: ",DIR(0)="FA^5:60",DIR("?")="5-60 characters input required for activity log." S:$G(PCOMX)]"" DIR("B")=$G(PCOMX)
"RTN","PSORXRP1",15,0)
 .D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S (PCOM,PCOMX)=Y
"RTN","PSORXRP1",16,0)
 .S PSOCLC=DUZ
"RTN","PSORXRP1",17,0)
 .F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""  S ORN=$P(LST,",",ORD),QFLG=0 D:+PSOLST(ORN)=52 RX
"RTN","PSORXRP1",18,0)
 .S VALMBCK="R"
"RTN","PSORXRP1",19,0)
 I $G(PSOREPX) S VALMBCK="R",VALMSG="No Labels Reprinted."
"RTN","PSORXRP1",20,0)
 K PSOREPX
"RTN","PSORXRP1",21,0)
 I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSORXRP1",22,0)
 D ^PSOBUILD
"RTN","PSORXRP1",23,0)
 K PSOMSG,PSORPSRX,QFLG,%,DIR,DUOUT,DTOUT,DIROUT,DIRUT,PCOM,PCOMX,C,I,J,JJJ,K,RX,RXF,X,Y,Z,P,PDA,PSPRXN,COPIES,SIDE,PPL,REPRINT,PSOOELSE,ORD,LST,ORN D KVA^VADPT
"RTN","PSORXRP1",24,0)
 Q
"RTN","PSORXRP1",25,0)
 ;
"RTN","PSORXRP1",26,0)
RX ;process reprint request
"RTN","PSORXRP1",27,0)
 Q:$P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^")>11
"RTN","PSORXRP1",28,0)
 I $$LMREJ^PSOREJU1($P(PSOLST(ORN),"^",2)) W $C(7),!!,"Rx "_$$GET1^DIQ(52,$P(PSOLST(ORN),"^",2),.01)_" has OPEN/UNRESOLVED 3rd Party Payer Rejects!" K DIR D PAUSE^VALM1 Q
"RTN","PSORXRP1",29,0)
 S PSORPSRX=$P(PSOLST(ORN),"^",2) D PSOL^PSSLOCK(PSORPSRX) I '$G(PSOMSG) W $C(7),!!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing Rx "_$P($G(^PSRX(PSORPSRX,0)),"^")),! D PAUSE^VALM1 K PSORPSRX,PSOMSG Q
"RTN","PSORXRP1",30,0)
 S RX=$P(PSOLST(ORN),"^",2),STA=$P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^") D CHK I $G(QFLG) D ULR Q
"RTN","PSORXRP1",31,0)
 S RXF=0,ZD(RX)=DT,REPRINT=1
"RTN","PSORXRP1",32,0)
 S RXRP($P(PSOLST(ORN),"^",2))=1_"^"_COPIES_"^"_SIDE
"RTN","PSORXRP1",33,0)
 I $G(PSODISP)=1 S RXRP($P(PSOLST(ORN),"^",2),"RP")=1
"RTN","PSORXRP1",34,0)
 S RXFL($P(PSOLST(ORN),"^",2))=0 F ZZZ=0:0 S ZZZ=$O(^PSRX($P(PSOLST(ORN),"^",2),1,ZZZ)) Q:'ZZZ  S RXFL($P(PSOLST(ORN),"^",2))=ZZZ
"RTN","PSORXRP1",35,0)
 K ZZZ
"RTN","PSORXRP1",36,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=RX_"," S ST="" D ACT1,ULR Q
"RTN","PSORXRP1",37,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORXRP1",38,0)
 I $L(PSORX("PSOL",PSOX2))+$L(RX)<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_RX_","
"RTN","PSORXRP1",39,0)
 E  S PSORX("PSOL",PSOX2+1)=RX_","
"RTN","PSORXRP1",40,0)
 S ST="" D ACT1
"RTN","PSORXRP1",41,0)
 D ULR
"RTN","PSORXRP1",42,0)
 Q
"RTN","PSORXRP1",43,0)
CHK ;check for valid reprint
"RTN","PSORXRP1",44,0)
 I DT>$P(^PSRX(RX,2),"^",6) D  S QFLG=1 Q
"RTN","PSORXRP1",45,0)
 .I $P(^PSRX(RX,"STA"),"^")<11 S $P(^PSRX(RX,"STA"),"^")=11 D
"RTN","PSORXRP1",46,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(RX,2),6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(RX,"SC","ZE",COMM) K COMM
"RTN","PSORXRP1",47,0)
 S DFN=PSODFN D DEM^VADPT I $P(VADM(6),"^",2)]"" D  S QFLG=1 Q
"RTN","PSORXRP1",48,0)
 .S $P(^PSRX(RX,"STA"),"^")=12,PCOM="Patient Expired "_$P(VADM(6),"^",2),ST="C" D EN^PSOHLSN1(RX,"OD","",PCOM,"A")
"RTN","PSORXRP1",49,0)
 .D ACT1
"RTN","PSORXRP1",50,0)
 I $D(RXPR($P(PSOLST(ORN),"^",2)))!$D(RXRP($P(PSOLST(ORN),"^",2))) S QFLG=1 Q
"RTN","PSORXRP1",51,0)
 D VALID Q:$G(QFLG)
"RTN","PSORXRP1",52,0)
 S X=$O(^PS(52.5,"B",RX,0)) I X,'$G(^PS(52.5,X,"P")) S QFLG=1 Q
"RTN","PSORXRP1",53,0)
 I $G(X)'>0 G GOOD
"RTN","PSORXRP1",54,0)
 I $P($G(^PS(52.5,X,0)),"^",7)']"" G GOOD
"RTN","PSORXRP1",55,0)
 I $P($G(^PS(52.5,X,0)),"^",7)="Q" K X,XX S QFLG=1 Q
"RTN","PSORXRP1",56,0)
 I $P($G(^PS(52.5,X,0)),"^",7)="L" K X,XX S QFLG=1 Q
"RTN","PSORXRP1",57,0)
GOOD K X
"RTN","PSORXRP1",58,0)
 I $D(^PS(52.4,RX)) S QFLG=1 Q
"RTN","PSORXRP1",59,0)
 I $D(^PS(52.4,"AREF",PSODFN,RX)) S QFLG=1 Q
"RTN","PSORXRP1",60,0)
 I $G(PSODIV),$D(^PSRX(RX,2)),+$P(^(2),"^",9),+$P(^(2),"^",9)'=PSOSITE S PSPOP=0,PSPRXN=RX D CHK1^PSOUTLA I $G(POERR)&(PSPOP) S QFLG=1 Q
"RTN","PSORXRP1",61,0)
 I STA=3!(STA=4)!(STA=12) S QFLG=1 Q
"RTN","PSORXRP1",62,0)
 Q
"RTN","PSORXRP1",63,0)
ACT1 S RXF=0 F J=0:0 S J=$O(^PSRX(RX,1,J)) Q:'J  S RXF=J S:J>5 RXF=J+1
"RTN","PSORXRP1",64,0)
 S IR=0 F J=0:0 S J=$O(^PSRX(RX,"A",J)) Q:'J  S IR=J
"RTN","PSORXRP1",65,0)
 S IR=IR+1,^PSRX(RX,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXRP1",66,0)
 D NOW^%DTC S ^PSRX(RX,"A",IR,0)=%_"^"_$S($G(ST)'="C":"W",1:"C")_"^"_DUZ_"^"_RXF_"^"_PCOM_$S($G(ST)'="C":" ("_COPIES_" COPIES)",1:""),PCOMX=PCOM K PC,IR,PS,XX,%,%H,%I,RXF
"RTN","PSORXRP1",67,0)
 S:$P(^PSRX(RX,2),"^",15)&($G(ST)'="C") $P(^PSRX(RX,2),"^",14)=1
"RTN","PSORXRP1",68,0)
 Q
"RTN","PSORXRP1",69,0)
VALID ;check for rx in label array
"RTN","PSORXRP1",70,0)
 I $O(PSORX("PSOL",0)) D
"RTN","PSORXRP1",71,0)
 .F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  I PSORX("PSOL",PSOX1)[RX_"," S QFLG=1 Q
"RTN","PSORXRP1",72,0)
 Q
"RTN","PSORXRP1",73,0)
ULR ;
"RTN","PSORXRP1",74,0)
 I $G(PSORPSRX) D PSOUL^PSSLOCK(PSORPSRX)
"RTN","PSORXRP1",75,0)
 Q
"RTN","PSORXRPT")
0^55^B37272513
"RTN","PSORXRPT",1,0)
PSORXRPT ;BIR/SAB-reprint of a prescription label ;11/8/02
"RTN","PSORXRPT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,21,27,34,120,138,156,148**;DEC 1997
"RTN","PSORXRPT",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORXRPT",4,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORXRPT",5,0)
BCK I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSORXRPT",6,0)
 N PSODISP S PSORPLRX=$P(PSOLST(ORN),"^",2)
"RTN","PSORXRPT",7,0)
 I $$LMREJ^PSOREJU1(PSORPLRX,,.VALMSG,.VALMBCK) Q
"RTN","PSORXRPT",8,0)
 D PSOL^PSSLOCK(PSORPLRX) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG Q
"RTN","PSORXRPT",9,0)
 I $G(POERR) K QFLG D  I $G(QFLG) D ULR G KILL
"RTN","PSORXRPT",10,0)
 .D FULL^VALM1 S X=$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),Y=$P(PSOLST(ORN),"^",2)_"^"_X,Y(0)=$G(^PSRX($P(PSOLST(ORN),"^",2),0))
"RTN","PSORXRPT",11,0)
 .I $D(RXPR($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="A Partial Rx has been requested!",QFLG=1 Q
"RTN","PSORXRPT",12,0)
 .I $D(RXRP($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="A Reprint Label has been requested!",QFLG=1 Q
"RTN","PSORXRPT",13,0)
 .I $D(RXRS($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="Rx is being pulled from suspense!",QFLG=1 Q
"RTN","PSORXRPT",14,0)
 .S RX=$P(PSOLST(ORN),"^",2) D VALID^PSORXRP1 S:$G(QFLG) VALMBCK="",VALMSG="A New Label has been requested already!"
"RTN","PSORXRPT",15,0)
 S (PPL,DA,RX)=+Y,PDA=Y(0),RXF=0,ZD(DA)=DT,REPRINT=1,STA=+$G(^PSRX(+Y,"STA"))
"RTN","PSORXRPT",16,0)
 I $P(^PSRX(RX,"STA"),"^")=14 S VALMBCK="",VALMSG="Cannot Reprint! Discontinued by Provider.",QFLG=1 D ULR,KILL Q
"RTN","PSORXRPT",17,0)
 I $P(^PSRX(RX,"STA"),"^")=15 S VALMBCK="",VALMSG="Cannot Reprint! Discontinued due to editing.",QFLG=1 D ULR,KILL Q
"RTN","PSORXRPT",18,0)
 I $P(^PSRX(RX,"STA"),"^")=16 S VALMBCK="",VALMSG="Cannot Reprint! Placed on HOLD by Provider.",QFLG=1 D ULR,KILL Q
"RTN","PSORXRPT",19,0)
 I DT>$P(^PSRX(RX,2),"^",6) D  G PAUSE
"RTN","PSORXRPT",20,0)
 .W !,$C(7),"Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11 D
"RTN","PSORXRPT",21,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM) K COMM
"RTN","PSORXRPT",22,0)
 S DFN=$P(PDA,"^",2) D DEM^VADPT I $P(VADM(6),"^",2)]"" D  G PAUSE
"RTN","PSORXRPT",23,0)
 .W $C(7),!!,$P(^DPT($P(PDA,"^",2),0),"^")_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSORXRPT",24,0)
 .S $P(^PSRX(RX,"STA"),"^")=12,PCOM="Patient Expired "_$P(VADM(6),"^",2),ST="C" D EN^PSOHLSN1(RX,"OD","",PCOM,"A")
"RTN","PSORXRPT",25,0)
 .D ACT1,ULR,KILL
"RTN","PSORXRPT",26,0)
 S X=$O(^PS(52.5,"B",DA,0)) I X,'$G(^PS(52.5,X,"P")) W !,$C(7),"RX MAY NOT BE PRINTED using this option, use SUSPENSE FUNCTIONS Options." K X G PAUSE
"RTN","PSORXRPT",27,0)
 S PSX=0 F J=0:0 S J=$O(^PSRX(DA,1,J)) Q:'J  S PSX=J
"RTN","PSORXRPT",28,0)
 K X
"RTN","PSORXRPT",29,0)
 I $D(^PS(52.4,DA)) W !,"Prescription is Non-Verified",!! G PAUSE
"RTN","PSORXRPT",30,0)
 S DFN=$P(^PSRX(DA,0),"^",2) I $D(^PS(52.4,"AREF",DFN,DA)) W !,"Prescription is waiting for others to be verified",!! G PAUSE
"RTN","PSORXRPT",31,0)
 I $G(PSODIV),$D(^PSRX(DA,2)),+$P(^(2),"^",9),+$P(^(2),"^",9)'=PSOSITE S PSPOP=0,PSPRXN=DA D CHK1^PSOUTLA G:$G(POERR)&(PSPOP) PAUSE G:PSPOP PAUSE
"RTN","PSORXRPT",32,0)
 I STA=3 W !?3,"Prescription is on Hold" G PAUSE
"RTN","PSORXRPT",33,0)
 I STA=4 W !?3,"Prescription is Pending Due to Drug Interactions" G PAUSE
"RTN","PSORXRPT",34,0)
 I STA=12 W !?3,"Prescription is Discontinued" G PAUSE
"RTN","PSORXRPT",35,0)
 S COPIES=$S($P(PDA,"^",18)]"":$P(PDA,"^",18),1:1)
"RTN","PSORXRPT",36,0)
 K DIR S DIR("A")="Number of Copies? ",DIR("B")=COPIES,DIR(0)="N^1:99:0",DIR("?")="Enter the number of copies you want (1 to 99)"
"RTN","PSORXRPT",37,0)
 D ^DIR K DIR I $D(DIRUT) D ULR G KILL
"RTN","PSORXRPT",38,0)
 S COPIES=Y
"RTN","PSORXRPT",39,0)
 K DIR S DIR("A")="Print adhesive portion of label only? ",DIR(0)="Y",DIR("B")="No",DIR("?",1)="If entire label, including trailers are to print press RETURN for default."
"RTN","PSORXRPT",40,0)
 S DIR("?")="Else if only bottle and mailing labels are to print enter Y or YES." D ^DIR K DIR I $D(DUOUT) D ULR,KILL G PAUSE
"RTN","PSORXRPT",41,0)
 I $D(DIRUT) D ULR G KILL
"RTN","PSORXRPT",42,0)
 S SIDE=Y
"RTN","PSORXRPT",43,0)
 I $P(PSOPAR,"^",30),$$GET1^DIQ(59,PSOSITE_",",105,"I")=2.4 D
"RTN","PSORXRPT",44,0)
 .I $S($P(PSOPAR,"^",30)=3:1,$P(PSOPAR,"^",30)=4:1,1:0),'$$GET1^DIQ(50,$P(PDA,"^",6),28,"I") Q
"RTN","PSORXRPT",45,0)
 .K DIR,DIRUT S DIR("A")="Do you want to resend to Dispensing System Device",DIR(0)="Y",DIR("B")="No"
"RTN","PSORXRPT",46,0)
 .D ^DIR K DIR Q:$D(DIRUT)  S PSODISP=$S(Y:0,1:1)
"RTN","PSORXRPT",47,0)
 I $D(DIRUT) D ULR G KILL
"RTN","PSORXRPT",48,0)
 D ACT I $D(DIRUT) D ULR,KILL G PAUSE
"RTN","PSORXRPT",49,0)
 Q:$G(POERR)&($D(PCOM))  G PAUSE:$D(PCOM)
"RTN","PSORXRPT",50,0)
 F I=1,2,4,6,7,9,13,16 S P(I)=$P(PDA,"^",I)
"RTN","PSORXRPT",51,0)
 S P(6)=+P(6) I $D(^PSRX(DA,"TN")),^("TN")]"" S P(6)=^("TN")
"RTN","PSORXRPT",52,0)
 W !!,"Rx # "_P(1),?23,$E(P(13),4,5)_"/"_$E(P(13),6,7)_"/"_$E(P(13),2,3),!,$S($D(^DPT(+P(2),0)):$P(^(0),"^"),1:"Not on File"),?30,"#"_P(7),!
"RTN","PSORXRPT",53,0)
 I $P($G(^PSRX(DA,"SIG")),"^",2) S D=0 D  K D,FSIG
"RTN","PSORXRPT",54,0)
 .D FSIG^PSOUTLA("R",DA,75) F  S D=$O(FSIG(D)) W !,FSIG(D) Q:'$O(FSIG(D))
"RTN","PSORXRPT",55,0)
 E  D EN3^PSOUTLA1(DA,75) S D=0 F  S D=$O(BSIG(D)) W !,BSIG(D) Q:'$O(BSIG(D))
"RTN","PSORXRPT",56,0)
 K D,BSIG
"RTN","PSORXRPT",57,0)
 W !!,$S((P(6)=+P(6))&$D(^PSDRUG(P(6),0)):$P(^(0),"^"),1:P(6)),! S PHYS=$S($D(^VA(200,+P(4),0)):$P(^(0),"^"),1:"Unknown") W PHYS K PHYS
"RTN","PSORXRPT",58,0)
 W ?25,$S($D(^VA(200,+P(16),0)):$P(^(0),"^"),1:"Unknown"),!,"# of Refills: "_$G(P(9))
"RTN","PSORXRPT",59,0)
 I $G(RX) S RXFL(RX)=0 F ZZZ=0:0 S ZZZ=$O(^PSRX(RX,1,ZZZ)) Q:'ZZZ  S RXFL(RX)=ZZZ
"RTN","PSORXRPT",60,0)
 K PSOELSE I '$G(POERR) S PSOELSE=1 D @$S($P($G(PSOPAR),"^",26):"^PSORXL",1:"Q^PSORXL")
"RTN","PSORXRPT",61,0)
 I '$G(PSOELSE) D
"RTN","PSORXRPT",62,0)
 .S RXRP($P(PSOLST(ORN),"^",2))=1_"^"_COPIES_"^"_SIDE
"RTN","PSORXRPT",63,0)
 .I $G(PSODISP)=1 S RXRP($P(PSOLST(ORN),"^",2),"RP")=1
"RTN","PSORXRPT",64,0)
 .I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=DA_"," Q
"RTN","PSORXRPT",65,0)
 .F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORXRPT",66,0)
 .I $L(PSORX("PSOL",PSOX2))+$L(DA)<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_DA_","
"RTN","PSORXRPT",67,0)
 .E  S PSORX("PSOL",PSOX2+1)=DA_","
"RTN","PSORXRPT",68,0)
 K PCOMX,PSPOP,PPL,COPIES,SIDE,PCOM,IOP,PSL,PSNP,PSOELSE,ZZZ
"RTN","PSORXRPT",69,0)
PAUSE K RX,PPL,ZD(+$G(DA)),DA I $G(POERR) K DIR,DIRUT,DUOUT,DTOUT S DIR(0)="E",DIR("A",1)=" ",DIR("A")="Press Return to Continue" D ^DIR K DIR,DIRUT,DUOUT,DTOUT S VALMBCK="R"
"RTN","PSORXRPT",70,0)
 D ULR K PSORPLRX
"RTN","PSORXRPT",71,0)
 Q
"RTN","PSORXRPT",72,0)
 ;
"RTN","PSORXRPT",73,0)
ACT K DIR S DIR("A")="Comments: ",DIR(0)="FA^5:60",DIR("?")="5-60 characters input required for activity log." S:$G(PCOMX)]"" DIR("B")=$G(PCOMX)
"RTN","PSORXRPT",74,0)
 D ^DIR K DIR Q:$D(DIRUT)!($D(DIROUT))  S (PCOM,PCOMX)=X
"RTN","PSORXRPT",75,0)
 I '$D(PSOCLC) S PSOCLC=DUZ
"RTN","PSORXRPT",76,0)
ACT1 S RXF=0 F J=0:0 S J=$O(^PSRX(DA,1,J)) Q:'J  S RXF=J S:J>5 RXF=J+1
"RTN","PSORXRPT",77,0)
 S IR=0 F J=0:0 S J=$O(^PSRX(DA,"A",J)) Q:'J  S IR=J
"RTN","PSORXRPT",78,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXRPT",79,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^"_$S($G(ST)'="C":"W",1:"C")_"^"_DUZ_"^"_RXF_"^"_PCOM_$S($G(ST)'="C":" ("_COPIES_" COPIES)",1:""),PCOMX=PCOM K PC,IR,PS,PCOM,XX,%,%H,%I,RXF
"RTN","PSORXRPT",80,0)
 S:$P(^PSRX(DA,2),"^",15)&($G(ST)'="C") $P(^PSRX(DA,2),"^",14)=1
"RTN","PSORXRPT",81,0)
 Q
"RTN","PSORXRPT",82,0)
 ;
"RTN","PSORXRPT",83,0)
KILL K QFLG,%,DIR,DUOUT,DTOUT,DIROUT,DIRUT,PCOM,PCOMX,C,DA,DIC,I,J,JJJ,K,RX,RXF,X,Y,Z,DFN,P,PDA,PSPRXN,COPIES,SIDE,PPL,REPRINT,PSOMSG,PSORPLRX D KVA^VADPT Q
"RTN","PSORXRPT",84,0)
 ;
"RTN","PSORXRPT",85,0)
ULR ;
"RTN","PSORXRPT",86,0)
 I $G(PSORPLRX) D PSOUL^PSSLOCK(PSORPLRX)
"RTN","PSORXRPT",87,0)
 Q
"RTN","PSORXVW")
0^29^B58205807
"RTN","PSORXVW",1,0)
PSORXVW ;BHAM ISC/SAB - listman view of a prescription ;5/25/05 2:10pm
"RTN","PSORXVW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**14,35,46,96,103,88,117,131,146,156,185,210,148**;DEC 1997
"RTN","PSORXVW",3,0)
 ;External reference to File ^PS(55 supported by DBIA 2228
"RTN","PSORXVW",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSORXVW",5,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSORXVW",6,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSORXVW",7,0)
 ;External reference to ^SC supported by DBIA 10040
"RTN","PSORXVW",8,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSORXVW",9,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSORXVW",10,0)
 ;External reference to GMRADPT supported by DBIA 10099
"RTN","PSORXVW",11,0)
 ;PSO*210 add call to WORDWRAP^PSOUTLA2 api
"RTN","PSORXVW",12,0)
 ;
"RTN","PSORXVW",13,0)
 S PS="VIEW"
"RTN","PSORXVW",14,0)
A1 W ! S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")'=13",DIC=52,DIC(0)="QEA",DIC("A")=PS_" PRESCRIPTION: " D ^DIC K DIC("A") G:"^"[$E(X) KILL G A1:Y<0 S (DA,PSOVDA)=+Y K DIC
"RTN","PSORXVW",15,0)
DP S (PSODFN,DFN)=+$P(^PSRX(DA,0),"^",2) S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORXVW",16,0)
 D ICN^PSODPT(PSODFN)
"RTN","PSORXVW",17,0)
 K ^TMP("PSOHDR",$J) D ^VADPT,ADD^VADPT
"RTN","PSORXVW",18,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1),^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSORXVW",19,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSORXVW",20,0)
 S POERR=1 D RE^PSODEM K PSOERR
"RTN","PSORXVW",21,0)
 S ^TMP("PSOHDR",$J,6,0)=$S(+$P(WT,"^",8):$P(WT,"^",9)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSORXVW",22,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$P(HT,"^",9)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSORXVW",23,0)
 S GMRA="0^0^111" D EN1^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSORXVW",24,0)
 D DEM^VADPT I +VADM(6) D
"RTN","PSORXVW",25,0)
 .S SSN=$P(^DPT(PSODFN,0),"^",9) W !,$C(7),?10,$P(^DPT(PSODFN,0),"^")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_") DIED "_$P(VADM(6),"^",2),!
"RTN","PSORXVW",26,0)
 .W "All Active Medications will be Autocanceled!",! H 2 S PSODEATH=1
"RTN","PSORXVW",27,0)
 .S ACOM="Date of Death "_$P(VADM(6),"^",2)_".",ZTRTN="CAN^PSOCAN3",ZTDESC="Outpatient Pharmacy Autocancel Due to Death of Patient",ZTSAVE("ACOM")="",ZTSAVE("PSODFN")="",ZTSAVE("PSODEATH")=""
"RTN","PSORXVW",28,0)
 .S ZTIO="",PSOCLC=DUZ,ZTSAVE("PSOCLC")="",ZTDTH=$H D ^%ZTLOAD K ACOM,ZTSK,PSODEATH
"RTN","PSORXVW",29,0)
 K ^TMP("PSOAL",$J),PCOMX,PDA,PHI,PRC,ACOM,ANS
"RTN","PSORXVW",30,0)
 S (DA,RXN)=PSOVDA K PSOVDA S RX0=^PSRX(RXN,0),RX2=$G(^(2)),RX3=$G(^(3)),ST=+$G(^("STA")),RXOR=$G(^("OR1"))
"RTN","PSORXVW",31,0)
 I 'RXOR,$P(^PSDRUG($P(RX0,"^",6),2),"^") S $P(^PSRX(RXN,"OR1"),"^")=$P(^PSDRUG($P(RX0,"^",6),2),"^"),RXOR=$P(^PSDRUG($P(RX0,"^",6),2),"^")
"RTN","PSORXVW",32,0)
 S IEN=0,$P(RN," ",12)=" "
"RTN","PSORXVW",33,0)
 N APPND S APPND=$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN)
"RTN","PSORXVW",34,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$S($P($G(^PSRX(RXN,"TPB")),"^"):"            TPB Rx #: ",1:"                Rx #: ")_$P(RX0,"^")_APPND_$E(RN,$L($P(RX0,"^")_APPND)+1,12)
"RTN","PSORXVW",35,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="      Orderable Item: "_$S($D(^PS(50.7,$P(+RXOR,"^"),0)):$P(^PS(50.7,$P(+RXOR,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"No Pharmacy Orderable Item")
"RTN","PSORXVW",36,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$S($D(^PSDRUG("AQ",$P(RX0,"^",6))):"           CMOP ",1:"                ")_"Drug: "_$P(^PSDRUG($P(RX0,"^",6),0),"^")
"RTN","PSORXVW",37,0)
 S:$G(^PSRX(RXN,"TN"))]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Trade Name: "_$G(^PSRX(RXN,"TN"))
"RTN","PSORXVW",38,0)
 D DOSE^PSORXVW1
"RTN","PSORXVW",39,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Patient Instructions:" I $O(^PSRX(RXN,"INS1",0)) D
"RTN","PSORXVW",40,0)
 . F I=0:0 S I=$O(^PSRX(RXN,"INS1",I)) Q:'I  D                ;PSO*210
"RTN","PSORXVW",41,0)
 .. S MIG=^PSRX(RXN,"INS1",I,0)
"RTN","PSORXVW",42,0)
 .. D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",43,0)
 K MIG,SG
"RTN","PSORXVW",44,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  Other Pat. Instruc: "_$S($G(^PSRX(RXN,"INSS"))]"":^PSRX(RXN,"INSS"),1:"")
"RTN","PSORXVW",45,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                 SIG:"
"RTN","PSORXVW",46,0)
 I '$P($G(^PSRX(RXN,"SIG")),"^",2) D  G PTST
"RTN","PSORXVW",47,0)
 . S X=$P($G(^PSRX(RXN,"SIG")),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSORXVW",48,0)
 . D WORDWRAP^PSOUTLA2(SIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",49,0)
 S SIGOK=1
"RTN","PSORXVW",50,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  D                ;PSO*210
"RTN","PSORXVW",51,0)
 . S MIG=^PSRX(RXN,"SIG1",I,0)
"RTN","PSORXVW",52,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW",53,0)
 S SIGOK=1 K MIG,SG
"RTN","PSORXVW",54,0)
PTST S $P(RN," ",25)=" ",PTST=$S($G(^PS(53,+$P(RX0,"^",3),0))]"":$P($G(^PS(53,+$P(RX0,"^",3),0)),"^"),1:""),IEN=IEN+1
"RTN","PSORXVW",55,0)
 S ^TMP("PSOAL",$J,IEN,0)="      Patient Status: "_PTST_$E(RN,$L(PTST)+1,25)
"RTN","PSORXVW",56,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Issue Date: "_$E($P(RX0,"^",13),4,5)_"/"_$E($P(RX0,"^",13),6,7)_"/"_$E($P(RX0,"^",13),2,3)
"RTN","PSORXVW",57,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                 Fill Date: "_$E($P(RX2,"^",2),4,5)_"/"_$E($P(RX2,"^",2),6,7)_"/"_$E($P(RX2,"^",2),2,3)
"RTN","PSORXVW",58,0)
 S ROU=$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW",59,0)
 S REFL=$P(RX0,"^",9),I=0 F  S I=$O(^PSRX(RXN,1,I)) Q:'I  S REFL=REFL-1,ROU=$S($P(^PSRX(RXN,1,I,0),"^",2)="W":"Window",1:"Mail")
"RTN","PSORXVW",60,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="      Last Fill Date: "_$E($P(RX3,"^"),4,5)_"/"_$E($P(RX3,"^"),6,7)_"/"_$E($P(RX3,"^"),2,3)
"RTN","PSORXVW",61,0)
  D CMOP^PSOORNE3 S DA=RXN
"RTN","PSORXVW",62,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_" ("_ROU_$S($G(PSOCMOP)]"":", "_PSOCMOP,1:"")_")" K ROU,PSOCMOP
"RTN","PSORXVW",63,0)
 S IEN=IEN+1 I $P(RX2,"^",15) S ^TMP("PSOAL",$J,IEN,0)="   Returned to Stock: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3)
"RTN","PSORXVW",64,0)
 E  S ^TMP("PSOAL",$J,IEN,0)="   Last Release Date: " D
"RTN","PSORXVW",65,0)
 .S RLD=$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:"")
"RTN","PSORXVW",66,0)
 .I $O(^PSRX(RXN,1,0)) F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  D
"RTN","PSORXVW",67,0)
 ..I $P(^PSRX(RXN,1,I,0),"^",18) S RLD=$E($P(^(0),"^",18),4,5)_"/"_$E($P(^(0),"^",18),6,7)_"/"_$E($P(^(0),"^",18),2,3)
"RTN","PSORXVW",68,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_$S($G(RLD)]"":RLD,1:"        ")
"RTN","PSORXVW",69,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                     Lot #: "_$P(RX2,"^",4)
"RTN","PSORXVW",70,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Expires: "_$E($P(RX2,"^",6),4,5)_"/"_$E($P(RX2,"^",6),6,7)_"/"_$E($P(RX2,"^",6),2,3)
"RTN","PSORXVW",71,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                       MFG: "_$P($G(RX2),"^",8)
"RTN","PSORXVW",72,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Days Supply: "_$P(RX0,"^",8)_$S($L($P(RX0,"^",8))=1:" ",1:"")
"RTN","PSORXVW",73,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"                           QTY"_$S($P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)]"":" ("_$P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)_")",1:" (  )")_": "_$P(RX0,"^",7)
"RTN","PSORXVW",74,0)
 I $P($G(^PSDRUG($P(RX0,"^",6),5)),"^")]"" D
"RTN","PSORXVW",75,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSORXVW",76,0)
 .S ^TMP("PSOAL",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^") K RN
"RTN","PSORXVW",77,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        # of Refills: "_$P(RX0,"^",9)_$S($L($P(RX0,"^",9))=1:" ",1:"")_"                       Remaining: "_REFL
"RTN","PSORXVW",78,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="            Provider: "_$S($D(^VA(200,$P(RX0,"^",4),0)):$P(^VA(200,$P(RX0,"^",4),0),"^"),1:"UNKNOWN")
"RTN","PSORXVW",79,0)
 I $P(RX3,"^",3) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,$P(RX3,"^",3),0),"^")
"RTN","PSORXVW",80,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Routing: "_$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW",81,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              Copies: "_$S($P(RX0,"^",18):$P(RX0,"^",18),1:1)
"RTN","PSORXVW",82,0)
 S:$P(RX0,"^",11)="W" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="    Method of Pickup: "_$G(^PSRX(RXN,"MP"))
"RTN","PSORXVW",83,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              Clinic: "_$S($D(^SC(+$P(RX0,"^",5),0)):$P(^SC($P(RX0,"^",5),0),"^"),1:"Not on File")
"RTN","PSORXVW",84,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="            Division: "_$P(^PS(59,$P(RX2,"^",9),0),"^")_" ("_$P(^(0),"^",6)_")"
"RTN","PSORXVW",85,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Pharmacist: "_$S($P(RX2,"^",3):$P(^VA(200,$P(RX2,"^",3),0),"^"),1:"")
"RTN","PSORXVW",86,0)
 S:$P(RX2,"^",10)&('$G(PSOCOPY)) IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Verified By: "_$P(^VA(200,$P(RX2,"^",10),0),"^")
"RTN","PSORXVW",87,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  Patient Counseling: "_$S($P($G(^PSRX(RXN,"PC")),"^"):"YES",1:"NO")_"                      "_$S($P($G(^PSRX(RXN,"PC")),"^"):"Was Counseling Understood: "_$S($P($G(^PSRX(RXN,"PC")),"^",2):"YES",1:"NO"),1:"")
"RTN","PSORXVW",88,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             Remarks: "_$P(RX3,"^",7)
"RTN","PSORXVW",89,0)
 D PC^PSORXVW1
"RTN","PSORXVW",90,0)
 I $P($G(^PSRX(DA,"OR1")),"^",5) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="         Finished By: "_$P(^VA(200,$P(^PSRX(DA,"OR1"),"^",5),0),"^")
"RTN","PSORXVW",91,0)
 D ^PSORXVW1 S PSOAL=IEN K IEN,ACT,LBL,LOG
"RTN","PSORXVW",92,0)
 I ST<12,$P(RX2,"^",6)<DT S ST=11
"RTN","PSORXVW",93,0)
 S VALM("TITLE")="Rx View "_"("_$P("Error^Active^Non-Verified^Refill^Hold^Non-Verified^Suspended^^^^^Done^Expired^Discontinued^Deleted^Discontinued^Discontinued (Edit)^Provider Hold^","^",ST+2)_")"
"RTN","PSORXVW",94,0)
 S:$P($G(^PSRX(DA,"PKI")),"^") VALMSG="Digitally Signed Order"
"RTN","PSORXVW",95,0)
 D EN^PSOORAL,KILL G:PS="VIEW" PSORXVW
"RTN","PSORXVW",96,0)
 Q
"RTN","PSORXVW",97,0)
KILL K ^TMP("PSOAL",$J),PSOAL,IEN,^TMP("PSOHDR",$J) K:PS="VIEW" DA
"RTN","PSORXVW",98,0)
 K ST,RFL,RFLL,RFL1,ST,II,J,N,PHYS,L1,DIRUT,PSDIV,PSEXDT,MED,M1,FFX,DTT,DAT,RX0,RX2,R3,RTN,SIG,STA,P1,PL,P0,Z0,Z1,EXDT,IFN,DIR,DUOUT,DTOUT,PSOELSE
"RTN","PSORXVW",99,0)
 K LBL,I,RFDATE,%H,%I,RN,RFT,%,%I,DFN,GMRAL,HDR,POERR,PTST,REFL,RF,RLD,RX3
"RTN","PSORXVW",100,0)
 K RXN,RXOR,SG,VA,VADM,VAERR,VALMBCK,VAPA,X,DIC,REA,ZD,PSOHD,PSOBCK,PSODFN
"RTN","PSORXVW",101,0)
 Q
"RTN","PSORXVW1")
0^32^B63758683
"RTN","PSORXVW1",1,0)
PSORXVW1 ;BIR/SAB-view prescription con't ;5/26/05 10:07am
"RTN","PSORXVW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**35,47,46,71,99,117,156,193,210,148**;DEC 1997
"RTN","PSORXVW1",3,0)
 ;External reference to ^DD(52 supported by DBIA 999
"RTN","PSORXVW1",4,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSORXVW1",5,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSORXVW1",6,0)
 ;
"RTN","PSORXVW1",7,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",6) D
"RTN","PSORXVW1",8,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(^PSRX(RXN,"OR1"),"^",6) D ^DIC
"RTN","PSORXVW1",9,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="           Filled By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",10,0)
 I $P($G(^PSRX(RXN,"OR1")),"^",7) D
"RTN","PSORXVW1",11,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(^PSRX(RXN,"OR1"),"^",7) D ^DIC
"RTN","PSORXVW1",12,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="          Checked By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",13,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(RX0,"^",16) D ^DIC
"RTN","PSORXVW1",14,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Entry By: "_$P(Y,"^",2)_$E(RN,$L($P(Y,"^",2))+1,35)
"RTN","PSORXVW1",15,0)
 S Y=$P(RX2,"^") X ^DD("DD")
"RTN","PSORXVW1",16,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"Entry Date: "_$E($P(RX2,"^"),4,5)_"/"_$E($P(RX2,"^"),6,7)_"/"_$E($P(RX2,"^"),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSORXVW1",17,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" " ;,IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",18,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Original Fill Released: " I $P(RX2,"^",13) S DTT=$P(RX2,"^",13) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT K DAT,DTT
"RTN","PSORXVW1",19,0)
 I $P(RX2,"^",15) S DTT=$P(RX2,"^",15) D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"(Returned to Stock "_DAT_")" K DAT,DTT
"RTN","PSORXVW1",20,0)
 S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"      Routing: "_$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSORXVW1",21,0)
 I $G(^PSRX(DA,"H"))]"",$P(^("STA"),"^")=3 D HLD
"RTN","PSORXVW1",22,0)
 D RF,PAR,ACT,COPAY^PSORXVW2,LBL,ECME^PSOORAL1,^PSORXVW2:$O(^PSRX(DA,4,0))
"RTN","PSORXVW1",23,0)
 Q
"RTN","PSORXVW1",24,0)
ACT ;activity log
"RTN","PSORXVW1",25,0)
 N CNT
"RTN","PSORXVW1",26,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Activity Log:"
"RTN","PSORXVW1",27,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Reason         Rx Ref         Initiator Of Activity",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",28,0)
 I '$O(^PSRX(DA,"A",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO Activity to report" Q
"RTN","PSORXVW1",29,0)
 S CNT=0
"RTN","PSORXVW1",30,0)
 F N=0:0 S N=$O(^PSRX(DA,"A",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D DAT D
"RTN","PSORXVW1",31,0)
 .I $P(P1,"^",2)="M" Q
"RTN","PSORXVW1",32,0)
 .S IEN=IEN+1,CNT=CNT+1,^TMP("PSOAL",$J,IEN,0)=CNT_"   "_DAT_"    ",$P(RN," ",15)=" ",REA=$P(P1,"^",2)
"RTN","PSORXVW1",33,0)
 .S REA=$F("HUCELPRWSIVDABXGKNM",REA)-1
"RTN","PSORXVW1",34,0)
 .I REA D
"RTN","PSORXVW1",35,0)
 ..S STA=$P("HOLD^UNHOLD^DISCONTINUED^EDIT^RENEWED^PARTIAL^REINSTATE^REPRINT^SUSPENSE^RETURNED^INTERVENTION^DELETED^DRUG INTERACTION^PROCESSED^X-INTERFACE^PATIENT INSTR.^PKI/DEA^DISP COMPLETED^ECME^","^",REA)
"RTN","PSORXVW1",36,0)
 ..S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA_$E(RN,$L(STA)+1,15)
"RTN","PSORXVW1",37,0)
 .E  S $P(STA," ",15)=" ",^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA
"RTN","PSORXVW1",38,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSORXVW1",39,0)
 .S RFT=$S(RF>0&(RF<6):"REFILL "_RF,RF=6:"PARTIAL",RF>6:"REFILL "_(RF-1),1:"ORIGINAL")
"RTN","PSORXVW1",40,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(P1,"^",3) D ^DIC
"RTN","PSORXVW1",41,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$E(RN,$L(RFT)+1,15)_$S(+Y:$P(Y,"^",2),1:$P(P1,"^",3))
"RTN","PSORXVW1",42,0)
 .;S:$P(P1,"^",5)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(P1,"^",5)
"RTN","PSORXVW1",43,0)
 .I $P(P1,"^",5)]"" N PSOACBRK,PSOACBRV D
"RTN","PSORXVW1",44,0)
 ..S PSOACBRV=$P(P1,"^",5)
"RTN","PSORXVW1",45,0)
 ..I $L(PSOACBRV)<71 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_PSOACBRV Q
"RTN","PSORXVW1",46,0)
 ..I $E(PSOACBRV,1,70)'[" " S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$E(PSOACBRV,1,70),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$E(PSOACBRV,71,245) Q
"RTN","PSORXVW1",47,0)
 ..F PSOACBRK=245:-1 Q:PSOACBRK=0  I $E(PSOACBRV,PSOACBRK)=" ",PSOACBRK<71 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$E(PSOACBRV,1,PSOACBRK),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$E(PSOACBRV,PSOACBRK,245) Q
"RTN","PSORXVW1",48,0)
 .I $G(^PSRX(DA,"A",N,1))]"" S IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",5)=$P(^PSRX(DA,"A",N,1),"^") I $P(^PSRX(DA,"A",N,1),"^",2)]"" S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_":"_$P(^PSRX(DA,"A",N,1),"^",2)
"RTN","PSORXVW1",49,0)
 .I $O(^PSRX(DA,"A",N,2,0)) F I=0:0 S I=$O(^PSRX(RXN,"A",N,2,I)) Q:'I  S MIG=^PSRX(RXN,"A",N,2,I,0) D
"RTN","PSORXVW1",50,0)
 ..F SG=1:1:$L(MIG) S:$L(^TMP("PSOAL",$J,IEN,0)_" "_$P(MIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0)," ",9)=" " S:$P(MIG," ",SG)'="" ^TMP("PSOAL",$J,IEN,0)=$G(^TMP("PSOAL",$J,IEN,0))_" "_$P(MIG," ",SG)
"RTN","PSORXVW1",51,0)
 K MIG,SG,I Q
"RTN","PSORXVW1",52,0)
LBL ;label log
"RTN","PSORXVW1",53,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Label Log:"
"RTN","PSORXVW1",54,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Rx Ref                    Printed By",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",55,0)
 I '$O(^PSRX(DA,"L",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Labels printed." Q
"RTN","PSORXVW1",56,0)
 F L1=0:0 S L1=$O(^PSRX(DA,"L",L1)) Q:'L1  S LBL=^PSRX(DA,"L",L1,0),DTT=$P(^(0),"^") D DAT D
"RTN","PSORXVW1",57,0)
 .S $P(RN," ",26)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=L1_"   "_DAT_"    ",RFT=$S($P(LBL,"^",2):"REFILL "_$P(LBL,"^",2),1:"ORIGINAL"),RFT=RFT_$E(RN,$L(RFT)+1,26)
"RTN","PSORXVW1",58,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(LBL,"^",4) D ^DIC
"RTN","PSORXVW1",59,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$P(Y,"^",2),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comments: "_$P(LBL,"^",3)
"RTN","PSORXVW1",60,0)
 K DIC,X,Y Q
"RTN","PSORXVW1",61,0)
RF ;refill log
"RTN","PSORXVW1",62,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Refill Log:"
"RTN","PSORXVW1",63,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#  Log Date   Refill Date  Qty               Routing  Lot #       Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",64,0)
 S (RF,PL)=0 F RF=0:0 S RF=$O(^PSRX(DA,1,RF)) Q:'RF  S PL=PL+1
"RTN","PSORXVW1",65,0)
 I 'PL S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Refills For this  Prescription" Q
"RTN","PSORXVW1",66,0)
 F N=0:0 S N=$O(^PSRX(DA,1,N)) Q:'N  S P1=^(N,0) D
"RTN","PSORXVW1",67,0)
 .S DTT=$P(P1,"^",8)\1 D DAT S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"   "
"RTN","PSORXVW1",68,0)
 .S DTT=$P(P1,"^"),$P(RN," ",10)=" " D DAT
"RTN","PSORXVW1",69,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"     "_$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)_"  "_$S($P(P1,"^",2)="M":"Mail",1:"Window")_" "_$P(P1,"^",6)_$E(RN,$L($P(P1,"^",6))+1,12)
"RTN","PSORXVW1",70,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(P1,"^",5) D ^DIC
"RTN","PSORXVW1",71,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_$E($S(+Y:$P(Y,"^",2),1:""),1,16) K DIC,X,Y
"RTN","PSORXVW1",72,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"Unknown"),IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_$E("        ",$L(PSDIV)+1,8)_"  "
"RTN","PSORXVW1",73,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"Dispensed: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")_"  "
"RTN","PSORXVW1",74,0)
 .S RTS=$S($P(P1,"^",16):" Returned to Stock: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" Released: "_$S($P(P1,"^",18):$E($P(P1,"^",18),4,5)_"/"_$E($P(P1,"^",18),6,7)_"/"_$E($P(P1,"^",18),2,3),1:""))
"RTN","PSORXVW1",75,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RTS S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Remarks: "_$P(P1,"^",3)
"RTN","PSORXVW1",76,0)
 K RTS Q
"RTN","PSORXVW1",77,0)
PAR ;partial log
"RTN","PSORXVW1",78,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Partial Fills:"
"RTN","PSORXVW1",79,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Log Date   Date     Qty              Routing    Lot #        Pharmacist",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW1",80,0)
 I '$O(^PSRX(DA,"P",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There are NO Partials for this Prescription" Q
"RTN","PSORXVW1",81,0)
 S N=0 F  S N=$O(^PSRX(DA,"P",N)) Q:'N  S P1=^(N,0),DTT=$P(P1,"^",8)\1 D DAT D
"RTN","PSORXVW1",82,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"  ",QTY=$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)
"RTN","PSORXVW1",83,0)
 .S DTT=$P(P1,"^") D DAT S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_DAT_"  "_QTY_"  "
"RTN","PSORXVW1",84,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"UNKNOWN"),PSDIV=PSDIV_$E("        ",$L(PSDIV)+1,8)
"RTN","PSORXVW1",85,0)
 .S MW=$S($P(P1,"^",2)="M":"Mail",1:"Window"),MW=MW_$E("          ",$L(MW)+1,10)
"RTN","PSORXVW1",86,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=+$P(P1,"^",16) D ^DIC
"RTN","PSORXVW1",87,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_MW_"  "_$P(P1,"^",6)_$E("            ",$L($P(P1,"^",6))+1,10)_$E($S(+Y:$P(Y,"^",2),1:""),1,16)
"RTN","PSORXVW1",88,0)
 .S RTS=$S($P(P1,"^",16):" RETURNED TO STOCK: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" RELEASED: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:""))
"RTN","PSORXVW1",89,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="N,Z",X=$P(P1,"^",7) D ^DIC
"RTN","PSORXVW1",90,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Division: "_PSDIV_" "_RTS ;_"      Entry By: "_$P(Y,"^",2) K DIC,X,Y
"RTN","PSORXVW1",91,0)
 .S:$P(P1,"^",3)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="  REMARKS: "_$P(P1,"^",3) K RTS
"RTN","PSORXVW1",92,0)
 Q
"RTN","PSORXVW1",93,0)
HLD ;hold info
"RTN","PSORXVW1",94,0)
 S DTT=$P(^PSRX(DA,"H"),"^",3) D DAT S HLDR=$P(^DD(52,99,0),"^",3),HLDR=$S($P(^PSRX(DA,"H"),"^")'>6:$P(HLDR,";",$P(^PSRX(DA,"H"),"^")),1:$P(HLDR,";",7)),HLDR=$P(HLDR,":",2)
"RTN","PSORXVW1",95,0)
 S $P(RN," ",60)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Reason: "_HLDR_$E(RN,$L("Hold Reason: "_HLDR)+1,60)_"Hold Date: "_DAT S:$P(^PSRX(DA,"H"),"^",2)]"" IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Hold Comments: "_$P(^PSRX(DA,"H"),"^",2)
"RTN","PSORXVW1",96,0)
 K RN,DAT,DTT,HLDR
"RTN","PSORXVW1",97,0)
 Q
"RTN","PSORXVW1",98,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSORXVW1",99,0)
 Q
"RTN","PSORXVW1",100,0)
INST ;formats instruction from front door
"RTN","PSORXVW1",101,0)
 I $O(^PSRX(DA,"PI",0)) D
"RTN","PSORXVW1",102,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        Instructions:"
"RTN","PSORXVW1",103,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PI",T)) Q:'T  D                  ;PSO*210
"RTN","PSORXVW1",104,0)
 ..S MIG=^PSRX(RXN,"PI",T,0)
"RTN","PSORXVW1",105,0)
 ..D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW1",106,0)
 K T,TY,MIG,SG
"RTN","PSORXVW1",107,0)
 Q
"RTN","PSORXVW1",108,0)
PC ;displays provider comments
"RTN","PSORXVW1",109,0)
 I $O(^PSRX(DA,"PRC",0)) D
"RTN","PSORXVW1",110,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Provider Comments:"
"RTN","PSORXVW1",111,0)
 .S T=0 F  S T=$O(^PSRX(RXN,"PRC",T)) Q:'T  D                 ;PSO*210
"RTN","PSORXVW1",112,0)
 ..S MIG=^PSRX(RXN,"PRC",T,0)
"RTN","PSORXVW1",113,0)
 ..D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAL",$J)),21)
"RTN","PSORXVW1",114,0)
 K T,TY,MIG,SG
"RTN","PSORXVW1",115,0)
 Q
"RTN","PSORXVW1",116,0)
DOSE ;displays dosing instruction for both simple and complex Rxs.
"RTN","PSORXVW1",117,0)
 D DOSE^PSORXVW2
"RTN","PSORXVW1",118,0)
 Q
"RTN","PSORXVW2")
0^36^B41122049
"RTN","PSORXVW2",1,0)
PSORXVW2 ;ISC-BIRM/PDW - view cmop activity logs ;08 Dec 1999 12:48 PM
"RTN","PSORXVW2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**33,71,117,152,148**;DEC 1997
"RTN","PSORXVW2",3,0)
 ; External Referrence to file # 550.2 granted by DBIA 2231
"RTN","PSORXVW2",4,0)
 ;External reference to ^PS(50.607 supported by DBIA 2221
"RTN","PSORXVW2",5,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSORXVW2",6,0)
 ;External reference to File ^PS(55 supported by DBIA 2228
"RTN","PSORXVW2",7,0)
 ;External reference to VA(200 supported by DBIA 10060
"RTN","PSORXVW2",8,0)
 ;get data from event multiple
"RTN","PSORXVW2",9,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" "
"RTN","PSORXVW2",10,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="CMOP Event Log:",IEN=IEN+1
"RTN","PSORXVW2",11,0)
 S ^TMP("PSOAL",$J,IEN,0)="Date/Time             Rx Ref  TRN-Order       Stat             Comments",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW2",12,0)
 F PSXA=0:0 S PSXA=$O(^PSRX(DA,4,PSXA)) Q:'PSXA  S PSX4=^(PSXA,0) D FIX D
"RTN","PSORXVW2",13,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$$DATE(DA,$P(PSX4,"^",3))_"         "_$S('PSXFIL:"Orig",1:"Ref "_$G(PSXFIL))_"    "_$G(PSXBREF)
"RTN","PSORXVW2",14,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"            "_$G(PSXT)_"    "_$S($G(PSXTST)=3:$E($P($G(PSXCAN),"^"),1,35),$G(PSXNDC)'="":"NDC: "_PSXNDC,1:"")
"RTN","PSORXVW2",15,0)
 . I PSXCAR="",PSXID="" Q
"RTN","PSORXVW2",16,0)
 . N X S X="Carrier: "_$E(PSXCAR,1,21)
"RTN","PSORXVW2",17,0)
 . S X=$$SETSTR^VALM1("Pkg ID: ",X,32,8)
"RTN","PSORXVW2",18,0)
 . S X=X_PSXID
"RTN","PSORXVW2",19,0)
 . S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=X
"RTN","PSORXVW2",20,0)
 D:$O(^PSRX(DA,5,0))
"RTN","PSORXVW2",21,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" "
"RTN","PSORXVW2",22,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="CMOP Lot#/Expiration Date Log:",IEN=IEN+1
"RTN","PSORXVW2",23,0)
 .S ^TMP("PSOAL",$J,IEN,0)="Rx Ref               Lot #               Expiration Date"
"RTN","PSORXVW2",24,0)
 .S IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW2",25,0)
 .F PSXZ=0:0 S PSXZ=$O(^PSRX(DA,5,PSXZ)) Q:PSXZ']""  S PSXLOT=^(PSXZ,0) D
"RTN","PSORXVW2",26,0)
 ..S EXPDT=$P(PSXLOT,U,2)
"RTN","PSORXVW2",27,0)
 ..S EXPDT=$E(EXPDT,4,5)_"/"_$E(EXPDT,6,7)_"/"_$E(EXPDT,2,3)
"RTN","PSORXVW2",28,0)
 ..S RXREF=$P(PSXLOT,U,3)
"RTN","PSORXVW2",29,0)
 ..S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=$S(RXREF=0:"Orig",RXREF>0:"Ref "_RXREF,1:"")_"               "_$P(PSXLOT,U)_"              "_EXPDT
"RTN","PSORXVW2",30,0)
FINI K ANS,Y,%,I,Z,PSXLOT,PSXL,PSX4,F,PSXA,C,ER,PSXFIL,PSX4,PSXREA,PSXVID
"RTN","PSORXVW2",31,0)
 K PSXREL,PSXTRDT,PSXT,PSXLOC,DTOUT,DUOUT,PSXSEQ,PSXA,PSXML,P,I1,I2
"RTN","PSORXVW2",32,0)
 K PSXP,PSXE,PSXE1,PSXERR,PSXBAT,ZD1,ZD2,ZDT,RXREF,PSXZ,PSXTST,PSXTCAN
"RTN","PSORXVW2",33,0)
 K PSXRDT,PSXNDC,PSXM,PSXL1,PSXCAN,PSX1,EXPDT,PSXBREF,RXREF1
"RTN","PSORXVW2",34,0)
 K PSXCAR,PSXID
"RTN","PSORXVW2",35,0)
 Q
"RTN","PSORXVW2",36,0)
FIX ; translate data
"RTN","PSORXVW2",37,0)
 S PSXBAT=$P(PSX4,U),PSXSEQ=$P(PSX4,U,2)
"RTN","PSORXVW2",38,0)
 S PSXFIL=$P(PSX4,U,3),PSXTST=$P(PSX4,U,4)
"RTN","PSORXVW2",39,0)
 S PSXBREF=$G(PSXBAT)_"-"_$G(PSXSEQ)
"RTN","PSORXVW2",40,0)
 S PSXZT=$P(PSX4,U,5),PSXZT1=$P(PSXZT,"."),PSXZT2=$P(PSXZT,".",2)
"RTN","PSORXVW2",41,0)
 I $G(PSXZT)']"" K PSXZT,PSXZT1,PSXZT2 G F1
"RTN","PSORXVW2",42,0)
 S PSXZT2=$E(PSXZT2,1,4)
"RTN","PSORXVW2",43,0)
 S PSXZT1=$E(PSXZT1,4,5)_"/"_$E(PSXZT1,6,7)_"/"_$E(PSXZT1,2,3)
"RTN","PSORXVW2",44,0)
 S PSXTCAN=PSXZT1_"@"_PSXZT2 K PSXZT1,PSXZT2,PSXZT
"RTN","PSORXVW2",45,0)
F1 S PSXNDC=$P(PSX4,U,8)
"RTN","PSORXVW2",46,0)
 S PSXCAN=$G(^PSRX(DA,4,PSXA,1))
"RTN","PSORXVW2",47,0)
 S PSXCAR=$P(PSXCAN,U,3)
"RTN","PSORXVW2",48,0)
 S PSXID=$P(PSXCAN,U,4)
"RTN","PSORXVW2",49,0)
 ; get cmop site
"RTN","PSORXVW2",50,0)
 S I1=PSXBAT   ; S I1=$O(^PSX(550.2,"B",PSXBAT,""))
"RTN","PSORXVW2",51,0)
P1 ; get transmission d/t
"RTN","PSORXVW2",52,0)
 S ZDT=$P(^PSX(550.2,I1,0),U,6),ZD1=$P(ZDT,"."),ZD2=$P(ZDT,".",2)
"RTN","PSORXVW2",53,0)
 S ZD2=$E(ZD2,1,4)
"RTN","PSORXVW2",54,0)
 S ZD1=$E(ZD1,4,5)_"/"_$E(ZD1,6,7)_"/"_$E(ZD1,2,3)
"RTN","PSORXVW2",55,0)
 S PSXTRDT=ZD1_"@"_ZD2
"RTN","PSORXVW2",56,0)
Q1 S:PSXTST=0 PSXT="TRAN"
"RTN","PSORXVW2",57,0)
 S PSXRDT="Not Released"
"RTN","PSORXVW2",58,0)
 I PSXTST=1 D
"RTN","PSORXVW2",59,0)
 .I PSXFIL>0,('$D(^PSRX(DA,1,PSXFIL,0))) S PSXT="Disp Refill Deleted" Q
"RTN","PSORXVW2",60,0)
 .S PSX1=$S(PSXFIL=0:$P(^PSRX(DA,2),"^",13),1:$P(^PSRX(DA,1,PSXFIL,0),"^",18))
"RTN","PSORXVW2",61,0)
 .Q:PSX1']""
"RTN","PSORXVW2",62,0)
 .I PSX1'["." S PSXRDT=$E(PSX1,4,5)_"/"_$E(PSX1,6,7)_"/"_$E(PSX1,2,3) G SKIP
"RTN","PSORXVW2",63,0)
 .S ZR=PSX1,ZR1=$P(ZR,"."),ZR2=$P(ZR,".",2)
"RTN","PSORXVW2",64,0)
 .S ZR2=$E(ZR2,1,4)
"RTN","PSORXVW2",65,0)
 .S PSXRDT=$E(ZR1,4,5)_"/"_$E(ZR1,6,7)_"/"_$E(ZR1,2,3)_"@"_ZR2
"RTN","PSORXVW2",66,0)
 .K ZR,ZR1,ZR2
"RTN","PSORXVW2",67,0)
SKIP .S PSXT="DISP"
"RTN","PSORXVW2",68,0)
 S:PSXTST=2 PSXT="RTRN"
"RTN","PSORXVW2",69,0)
 S:PSXTST=3 PSXT="NDISP"
"RTN","PSORXVW2",70,0)
 Q
"RTN","PSORXVW2",71,0)
 ;
"RTN","PSORXVW2",72,0)
COPAY ;Copay activity log
"RTN","PSORXVW2",73,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=" ",IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Copay Activity Log:"
"RTN","PSORXVW2",74,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="#   Date        Reason               Rx Ref         Initiator Of Activity",IEN=IEN+1,$P(^TMP("PSOAL",$J,IEN,0),"=",79)="="
"RTN","PSORXVW2",75,0)
 I '$O(^PSRX(DA,"COPAY",0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="There's NO Copay activity to report" Q
"RTN","PSORXVW2",76,0)
 F N=0:0 S N=$O(^PSRX(DA,"COPAY",N)) Q:'N  S P1=^(N,0),DTT=P1\1 D DAT^PSORXVW1 D
"RTN","PSORXVW2",77,0)
 .S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)=N_"   "_DAT_"    ",$P(RN," ",21)=" ",REA=$P(P1,"^",2),REA=$F("ARICE",REA)-1
"RTN","PSORXVW2",78,0)
 .I REA D
"RTN","PSORXVW2",79,0)
 ..S STA=$P("ANNUAL CAP REACHED^COPAY RESET^IB-INITIATED COPAY^REMOVE COPAY CHARGE^RX EDITED^","^",REA)
"RTN","PSORXVW2",80,0)
 ..S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA_$E(RN,$L(STA)+1,21)
"RTN","PSORXVW2",81,0)
 .E  S $P(STA," ",21)=" ",^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_STA
"RTN","PSORXVW2",82,0)
 .K STA,RN S $P(RN," ",15)=" ",RF=+$P(P1,"^",4)
"RTN","PSORXVW2",83,0)
 .S RFT=$S(RF>0:"REFILL "_RF,1:"ORIGINAL")
"RTN","PSORXVW2",84,0)
 .S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_RFT_$E(RN,$L(RFT)+1,15)_$S($D(^VA(200,+$P(P1,"^",3),0)):$P(^(0),"^"),1:$P(P1,"^",3))
"RTN","PSORXVW2",85,0)
 .S:$P(P1,"^",5)]""!($P(P1,"^",6)]"")!($P(P1,"^",7)]"") IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="Comment: "_$P(P1,"^",5)
"RTN","PSORXVW2",86,0)
 .I $P(P1,"^",6)]"" S ^TMP("PSOAL",$J,IEN,0)=^TMP("PSOAL",$J,IEN,0)_"  Old value="_$P(P1,"^",6)_"   New value="_$P(P1,"^",7)
"RTN","PSORXVW2",87,0)
 Q
"RTN","PSORXVW2",88,0)
DOSE ;displays dosing instruction for both simple and complex Rxs.
"RTN","PSORXVW2",89,0)
 I '$O(^PSRX(DA,6,0)) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              Dosage: " Q
"RTN","PSORXVW2",90,0)
 F I=0:0 S I=$O(^PSRX(DA,6,I)) Q:'I  S DOSE=^PSRX(DA,6,I,0) D DOSE1
"RTN","PSORXVW2",91,0)
 K DOSE
"RTN","PSORXVW2",92,0)
 Q
"RTN","PSORXVW2",93,0)
DOSE1 ;
"RTN","PSORXVW2",94,0)
 I '$P(DOSE,"^",2),$P(DOSE,"^",9)]"" S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                Verb: "_$P(DOSE,"^",9)
"RTN","PSORXVW2",95,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="             *Dosage: "_$S($E($P(DOSE,"^"),1)="."&($P(DOSE,"^",2)):"0",1:"")_$P(DOSE,"^")_$S($P(DOSE,"^",3):$P(^PS(50.607,$P(DOSE,"^",3),0),"^"),1:"")
"RTN","PSORXVW2",96,0)
 I '$P(DOSE,"^",2),$P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="   Oth. Lang. Dosage: "_$G(^PSRX(DA,6,I,1))
"RTN","PSORXVW2",97,0)
 I $P(DOSE,"^",2),$P(DOSE,"^",9)]"" S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                Verb: "_$P(DOSE,"^",9)
"RTN","PSORXVW2",98,0)
 I $P(DOSE,"^",2) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="      Dispense Units: "_$S($E($P(DOSE,"^",2),1)=".":"0",1:"")_$P(DOSE,"^",2)
"RTN","PSORXVW2",99,0)
 I $P(DOSE,"^",2) S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="                Noun: "_$P(DOSE,"^",4)
"RTN","PSORXVW2",100,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="              *Route: "_$S($P(DOSE,"^",7):$P(^PS(51.2,$P(DOSE,"^",7),0),"^"),1:"")
"RTN","PSORXVW2",101,0)
 S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="           *Schedule: "_$P(DOSE,"^",8)
"RTN","PSORXVW2",102,0)
 I $P(DOSE,"^",5)]"" S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="           *Duration: "_$P(DOSE,"^",5)_" ("_$S($P(DOSE,"^",5)["M":"MINUTES",$P(DOSE,"^",5)["H":"HOURS",$P(DOSE,"^",5)["L":"MONTHS",$P(DOSE,"^",5)["W":"WEEKS",1:"DAYS")_")"
"RTN","PSORXVW2",103,0)
 I $P(DOSE,"^",6)]"" S IEN=IEN+1,^TMP("PSOAL",$J,IEN,0)="        *Conjunction: "_$S($P(DOSE,"^",6)="A":"AND",$P(DOSE,"^",6)="T":"THEN",$P(DOSE,"^",6)="E":"EXCEPT",1:"")
"RTN","PSORXVW2",104,0)
 Q
"RTN","PSORXVW2",105,0)
 ;
"RTN","PSORXVW2",106,0)
DATE(RX,RFL) ;
"RTN","PSORXVW2",107,0)
 I $G(PSXTST)=3,$G(PSXTCAN)'="" Q PSXTCAN
"RTN","PSORXVW2",108,0)
 I $G(PSXTST)=1 Q $G(PSXRDT)
"RTN","PSORXVW2",109,0)
 I $G(PSXTST)=3,'RFL,$$GET1^DIQ(52,RX,32.1,"I") Q $$FMTE^XLFDT($$GET1^DIQ(52,RX,32.1,"I"),2)
"RTN","PSORXVW2",110,0)
 I $G(PSXTST)=3,RFL,$$GET1^DIQ(52.1,RFL_","_RX,5,"I") Q $$FMTE^XLFDT($$GET1^DIQ(52.1,RFL_","_RX,32.1,"I"),2)
"RTN","PSORXVW2",111,0)
 Q $G(PSXTRDT)
"RTN","PSORXVW2",112,0)
 ;
"RTN","PSORXVW2",113,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSORXVW2",114,0)
 Q
"RTN","PSOSUCH1")
0^81^B18079381
"RTN","PSOSUCH1",1,0)
PSOSUCH1 ;BHAM ISC/JMB-Change suspense and fill/refill dates ; 4/49/93
"RTN","PSOSUCH1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148**;DEC 1997
"RTN","PSOSUCH1",3,0)
LISTSUS S X="?",DIC("S")="I $D(^PSRX(+$P(^PS(52.5,+Y,0),""^""),0)),$P($G(^(""STA"")),""^"")<11,$P($G(^PS(52.5,+Y,""P"")),""^"")=0",DIC="^PS(52.5,",DIC(0)="ZQ" D ^DIC K DIC W ! Q:Y<0!($D(DTOUT))  Q
"RTN","PSOSUCH1",4,0)
LISTPAT S X="?",DIC(0)="EMQ",DIC="^DPT(",DIC("S")="I $D(^PS(52.5,""AC"",+Y))" D ^DIC K DIC Q
"RTN","PSOSUCH1",5,0)
PSOINST S PSOINST=$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),"^",17),99)),"^") I Y["-",'$D(^PSRX($P(Y,"-",2),0)) W !,?7,$C(7),$C(7),$C(7),"   NON-EXISTENT PRESCRIPTION" G SPEC^PSOSUCHG:ACT="S" G ALL^PSOSUCHG:ACT="A"
"RTN","PSOSUCH1",6,0)
 I Y["-",$P(Y,"-")'=PSOINST W !,?7,$C(7),$C(7),$C(7),"  NOT FROM THIS INSTITUTION" G SPEC^PSOSUCHG:ACT="S" G ALL^PSOSUCHG:ACT="A"
"RTN","PSOSUCH1",7,0)
 Q
"RTN","PSOSUCH1",8,0)
AREC S:'DEAD COM="Change "_$S($G(PSOSUSPA):"Partial",'$G(SUB):"Fill",1:"Refill")_" Date "_$E(OLD,4,5)_"/"_$E(OLD,6,7)_"/"_$E(OLD,2,3)_" to "_$E(INDT,4,5)_"/"_$E(INDT,6,7)_"/"_$E(INDT,2,3)
"RTN","PSOSUCH1",9,0)
 S CNT=0 F SUB=0:0 S SUB=$O(^PSRX(RXREC,"A",SUB)) Q:'SUB  S CNT=SUB
"RTN","PSOSUCH1",10,0)
 S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(RXREC,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOSUCH1",11,0)
 D NOW^%DTC S CNT=CNT+1 S ^PSRX(RXREC,"A",0)="^52.3DA^"_CNT_"^"_CNT,^PSRX(RXREC,"A",CNT,0)=%_"^"_$S(DEAD:"C",1:"S")_"^"_DUZ_"^"_$S($G(PSOSUSPA):6,1:RFCNT)_"^"_COM K PSOSUSPA Q
"RTN","PSOSUCH1",12,0)
CHKDEAD D DEM^VADPT I VADM(1)="" W !?10,"PATIENT NAME UNKNOWN" S DEAD=0 Q
"RTN","PSOSUCH1",13,0)
 I VADM(6)="" S DEAD=0 Q
"RTN","PSOSUCH1",14,0)
 S SUSDOD=$P(VADM(6),"^",2)
"RTN","PSOSUCH1",15,0)
 F RXREC=0:0 S RXREC=$O(^PS(52.5,"AC",DFN,RXREC)) Q:'RXREC  F SRXREC=0:0 S SRXREC=$O(^PS(52.5,"AC",DFN,RXREC,SRXREC)) Q:'SRXREC  S RECORD=$P($G(^PS(52.5,SRXREC,0)),"^") D:RECORD DEAD
"RTN","PSOSUCH1",16,0)
 Q
"RTN","PSOSUCH1",17,0)
DEAD S HOLD=$G(DA),REA="C",COM="Died ("_$G(SUSDOD)_")",DA=RECORD,DEAD=1 D CAN^PSOCAN
"RTN","PSOSUCH1",18,0)
 W:'WARN !!,?10,$P($G(^DPT(DFN,0)),"^")_" DIED "_SUSDOD_" all prescriptions were discontinued" W:'WARN !,?15," and deleted from the suspense file." S WARN=1,DA=HOLD K HOLD,REA
"RTN","PSOSUCH1",19,0)
 Q
"RTN","PSOSUCH1",20,0)
NEXT S PSOX("IRXN")=RXREC D NEXT^PSOUTIL(.PSOX) S NEXT=$P(PSOX("RX3"),"^",2),DA=RXREC,DIE=52,DR="102///"_NEXT D ^DIE K DIE Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOSUCH1",21,0)
 K NEXT,PSOX Q
"RTN","PSOSUCH1",22,0)
 ;
"RTN","PSOSUCH1",23,0)
CHANGE(RXREC,SUB) ; File update for Suspense Date change
"RTN","PSOSUCH1",24,0)
 I $P($G(^PS(52.5,SFN,0)),"^",5) S PSOSUSPA=1,HDSFN=SFN S SRXPAR=+$P(^(0),"^",5),OLD=+$P($G(^PSRX(RXREC,"P",SRXPAR,0)),"^"),DA(1)=RXREC,DA=SRXPAR,DIE="^PSRX("_DA(1)_",""P"",",DR=".01////"_INDT D ^DIE G FIN
"RTN","PSOSUCH1",25,0)
 I '$D(SUB) S SUB=0 F II=0:0 S II=$O(^PSRX(RXREC,1,II)) Q:'II  S SUB=+II
"RTN","PSOSUCH1",26,0)
 S HDSFN=SFN I 'SUB S (X,OLD)=$P(^PSRX(RXREC,2),"^",2),DA=RXREC,DR="22///"_INDT_";101///"_INDT,DIE=52 D
"RTN","PSOSUCH1",27,0)
 .D ^DIE K DIE K:$G(^PS(52.5,HDSFN,"P"))=1 ^PS(52.5,"AC",DFN,+$P($G(^PS(52.5,HDSFN,0)),"^",2),HDSFN) Q:$D(DTOUT)!($D(DUOUT))  D NEXT K DA Q
"RTN","PSOSUCH1",28,0)
 I SUB S (OLD,X)=+$P($G(^PSRX(RXREC,1,SUB,0)),"^"),DA(1)=RXREC,DA=SUB,DIE="^PSRX("_DA(1)_",1,",DR=".01///"_INDT D ^DIE K DIE S $P(^PSRX(RXREC,3),"^")=INDT D
"RTN","PSOSUCH1",29,0)
 .K:$G(^PS(52.5,HDSFN,"P"))=1 ^PS(52.5,"AC",DFN,+$P($G(^PS(52.5,HDSFN,0)),"^",2),HDSFN) D NEXT S DA=RXREC K DA Q
"RTN","PSOSUCH1",30,0)
FIN S DA=HDSFN,DIK="^PS(52.5," D IX1^DIK
"RTN","PSOSUCH1",31,0)
 S SFN=HDSFN D AREC N X S X="PSXCH" X ^%ZOSF("TEST") K X Q:'$T  D:$G(XOK)=1 X^PSXCH Q
"RTN","PSOSUCH1",32,0)
 Q
"RTN","PSOSUCH1",33,0)
 ;
"RTN","PSOSUCH1",34,0)
DAREC ;
"RTN","PSOSUCH1",35,0)
 S SCOM="Rx "_$S($P(SNODE,"^",5):"(Partial) ",1:"")_"deleted from suspense"
"RTN","PSOSUCH1",36,0)
 S SSX=0 F SSXX=0:0 S SSXX=$O(^PSRX(RXREC,"A",SSXX)) Q:'SSXX  S SSX=SSXX
"RTN","PSOSUCH1",37,0)
 S SXCNT=0 F SCXX=0:0 S SCXX=$O(^PSRX(RXREC,1,SCXX)) Q:'SCXX  S SXCNT=SCXX S:SCXX>5 SXCNT=SCXX+1
"RTN","PSOSUCH1",38,0)
 D NOW^%DTC S SSX=SSX+1 S ^PSRX(RXREC,"A",0)="^52.3DA^"_SSX_"^"_SSX,^PSRX(RXREC,"A",SSX,0)=%_"^"_"S"_"^"_DUZ_"^"_$S($P(SNODE,"^",5):6,1:SXCNT)_"^"_SCOM
"RTN","PSOSUCH1",39,0)
 K SCOM,SSX,SSXX,SXCNT,SCXX Q
"RTN","PSOSUCHG")
0^80^B73300969
"RTN","PSOSUCHG",1,0)
PSOSUCHG ;BIR/RTR-CHANGE SUSPENSE AND FILL AND REFILL DATES ;4/29/93
"RTN","PSOSUCHG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,26,130,235,148**;DEC 1997
"RTN","PSOSUCHG",3,0)
 ;External reference A^PSXCH is supported by DBIA 2205
"RTN","PSOSUCHG",4,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOSUCHG",5,0)
 ;External reference P^PSXCH is supported by DBIA 2205
"RTN","PSOSUCHG",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOSUCHG",7,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSOSUCHG",8,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) D WARN^PSOSUDCN Q
"RTN","PSOSUCHG",9,0)
LU N PSOSDLK,PSOLKQT,PSODELLK,PSOSSTP W !! S DIR("A")="Change a specific Rx# or all Rx's for one patient",DIR(0)="SBO^S:SPECIFIC RX;A:ALL RXs FOR ONE PATIENT"
"RTN","PSOSUCHG",10,0)
 S DIR("?",1)="Enter 'S' to change a single prescription suspense date.",DIR("?")="Enter 'A' to change all of the prescription suspense dates for one patient."
"RTN","PSOSUCHG",11,0)
 D ^DIR K DIR G:$G(DIRUT)!(Y="") EXIT S ACT=Y D:ACT="A" ALL D:ACT="S" SPEC D ULK G LU
"RTN","PSOSUCHG",12,0)
EXIT D ULK K ISFLAG,ACT,BC,BCNUM,CBD,CNT,COM,D1,DA,DEAD,DEL,DELCNT,DFN,DIRUT,DR,DTOUT,DUOUT,HDSFN,I,II,INDT,OLD,OUT,PSPOP,RF,RFCNT,RX,RXDATE,RXREC,SFN,STOP,SUB,SUSCNT,VADM,WARN,X,Y,XOK,SRXPAR,SRXREC,SUSDOD,RECORD,PSOPOPUP,PSOSDLK,DELFLAG
"RTN","PSOSUCHG",13,0)
 K VADM,VA("PID"),VA("BID"),PSDIVCHK,PSOMSG,PSOLKQT,PSODELLK,PSOSSTP Q
"RTN","PSOSUCHG",14,0)
SPEC D ULK K INDT S (DELCNT,WARN,PSPOP,OUT)=0 W ! S DIR("A")="Select SUSPENDED Rx #: ",DIR(0)="FOA",DIR("?")="Enter the prescription# or wand the barcode.  To obtain a list of suspense prescriptions, type '??'",DIR("??")="^D LISTSUS^PSOSUCH1"
"RTN","PSOSUCHG",15,0)
 D ^DIR K DIR Q:$D(DIRUT)  D:Y["-" PSOINST^PSOSUPAT G:$G(OUT) SPEC D  W ! S DIC("S")="I $D(^PSRX(+$P(^PS(52.5,+Y,0),""^""),0))",DIC="^PS(52.5,",DIC(0)="ZQE" D ^DIC K DIC W ! Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOSUCHG",16,0)
 .I Y["-" S Y=$P(Y,"-",2),X=+$P($G(^PSRX(Y,0)),"^") Q
"RTN","PSOSUCHG",17,0)
 .S X=Y
"RTN","PSOSUCHG",18,0)
 G:Y<0 SPEC S DEAD=0,(SFN,DA)=+Y,RXREC=+Y(0),DFN=$P(^PS(52.5,SFN,0),"^",3),RXDATE=$P(Y(0),"^",2),STOP=$P(^PSRX(RXREC,2),"^",6),STAT=$P($G(^("STA")),"^") D  Q:$G(PSOLKQT)  D TST G:$T P^PSXCH
"RTN","PSOSUCHG",19,0)
 .K PSOMSG,PSOLKQT D PSOL^PSSLOCK(RXREC) I '$G(PSOMSG) W !,"Rx number: "_$P($G(^PSRX(RXREC,0)),"^")_" cannot be changed because" D LMES,PAUSE S PSOLKQT=1 K PSOMSG Q
"RTN","PSOSUCHG",20,0)
 .K PSOMSG S PSOSDLK(RXREC)=""
"RTN","PSOSUCHG",21,0)
RTN I STAT=11!(STOP<DT)!(STAT=12) D EXPCAN Q
"RTN","PSOSUCHG",22,0)
 D:$P($G(^PSRX(RXREC,"STA")),"^")<9 CHKDEAD^PSOSUCH1 Q:DEAD  I $G(PSODIV),+$P($G(^PS(52.5,SFN,0)),"^",6)'=PSOSITE S PSPOP=0 D CKDIV^PSOSUPAT Q:PSPOP
"RTN","PSOSUCHG",23,0)
 S DA=SFN,DIE=52.5,DR=".02;S INDT=X" D ^DIE K DIE D  Q:$D(Y)  W !
"RTN","PSOSUCHG",24,0)
 .I $D(INDT),INDT'=RXDATE,INDT<+$P($G(^PSRX(RXREC,0)),"^",13) S DA=SFN,DIE=52.5,DR=".02///"_RXDATE D ^DIE K DIE S Y="" W !!,"Suspense date cannot be before Issue Date of Rx!",!
"RTN","PSOSUCHG",25,0)
 I $D(X),X'=RXDATE S DA=RXREC D CHANGE^PSOSUCH1(RXREC)
"RTN","PSOSUCHG",26,0)
 D DEL G:ACT="A" ALL G:ACT="S" SPEC
"RTN","PSOSUCHG",27,0)
ALL D ULK K INDT S (DELCNT,PSDIVCHK,DELFLAG,PSPOP,PSOPOPUP,WARN,SUSCNT)=0 W ! S DIR("A")="Are you entering the patient name or barcode?",DIR(0)="SBO^P:Patient Name;B:Barcode"
"RTN","PSOSUCHG",28,0)
 S DIR("?")="Enter 'P' if you are going to enter the patient name.  Enter 'B' to enter or wand the barcode." D ^DIR K DIR Q:$D(DIRUT)  S BC=Y
"RTN","PSOSUCHG",29,0)
BC S OUT=0 I BC="B" W ! S DIR("A")="Enter/wand barcode",DIR(0)="FO^5:20",DIR("?")="Enter the barcode number or wand the barcode to change all of the prescription suspense dates for one patient" D ^DIR K DIR G:$G(DIRUT) ALL S BCNUM=Y D
"RTN","PSOSUCHG",30,0)
 .S RX=$P(BCNUM,"-",2) I '$G(RX) S OUT=1 W $C(7),!!?5,"Invalid Barcode!" Q
"RTN","PSOSUCHG",31,0)
 .I $D(^PSRX(RX,0)) D PSOINST^PSOSUPAT Q:OUT  S DFN=$P(^PSRX(RX,0),"^",2) W " ",$P($G(^DPT(DFN,0)),"^")
"RTN","PSOSUCHG",32,0)
 G:OUT BC
"RTN","PSOSUCHG",33,0)
 I BC="B",'$D(^PSRX(RX,0)) W $C(7),!!?5,"Invalid Barcode!",! G BC
"RTN","PSOSUCHG",34,0)
 I BC="B",'$D(^PS(52.5,"AC",DFN)) W !!?3,"This patient has no Rx's in suspense that have not already been printed!",! G BC
"RTN","PSOSUCHG",35,0)
NAM I BC="P" W ! S DIC(0)="AEMZQ",DIC="^DPT(",DIC("S")="I $D(^PS(52.5,""AC"",+Y))!($D(^PS(52.5,""AG"",+Y)))" D ^DIC K DIC G:$D(DTOUT)!($D(DUOUT))!(Y<0) ALL S DFN=+Y
"RTN","PSOSUCHG",36,0)
 F CBD=0:0 S CBD=$O(^PS(55,DFN,"P",CBD)) Q:CBD'>0!($G(PSOPOPUP))  S:$D(^PS(55,DFN,"P",CBD,0)) RXREC=+^(0) D:$D(^PS(52.5,"B",RXREC)) TEST D ULK
"RTN","PSOSUCHG",37,0)
 G:ACT="A" ALL G:ACT="S" SPEC
"RTN","PSOSUCHG",38,0)
TEST S SFN=+$O(^PS(52.5,"B",RXREC,0)) Q:'SFN  Q:$P($G(^PS(52.5,SFN,"P")),"^")'=0  S STOP=$P(^PSRX(RXREC,2),"^",6),STAT=$P($G(^("STA")),"^") D  Q:$G(PSOLKQT)  D TST D:$T A^PSXCH Q:$G(XOK)=0  I STAT=11!(STOP<DT)!(STAT=12) D EXPCAN Q
"RTN","PSOSUCHG",39,0)
 .K PSOMSG,PSOLKQT D PSOL^PSSLOCK(RXREC) I '$G(PSOMSG) W !!,"Rx number: "_$P($G(^PSRX(RXREC,0)),"^")_" cannot be changed because" D LMES,PAUSE S PSOLKQT=1 K PSOMSG Q
"RTN","PSOSUCHG",40,0)
 .K PSOMSG S PSOSDLK(RXREC)=""
"RTN","PSOSUCHG",41,0)
 S PSPOP=0 D:PSODIV&('$G(PSDIVCHK)) DIV^PSOSUPAT S PSDIVCHK=1 S:PSPOP PSOPOPUP=1 I 'PSPOP D:$P($G(^PSRX(RXREC,"STA")),"^")<9 CHKDEAD^PSOSUCH1 Q:DEAD  D BEG
"RTN","PSOSUCHG",42,0)
 Q
"RTN","PSOSUCHG",43,0)
BEG S RXDATE=$P(^PS(52.5,SFN,0),"^",2),ISFLAG=0
"RTN","PSOSUCHG",44,0)
 I 'SUSCNT S DA=SFN,DIE=52.5,DR=".02;S INDT=X" D ^DIE D SI Q:ISFLAG  K:$G(^PS(52.5,SFN,"P"))=1 ^PS(52.5,"AC",DFN,+$P(^PS(52.5,SFN,0),"^",2),SFN) S:$D(Y) PSOPOPUP=1 Q:X=""!($D(DTOUT))!($G(PSOPOPUP))  S SUSCNT=1
"RTN","PSOSUCHG",45,0)
 I SUSCNT D IS Q:$G(ISFLAG)  S DA=SFN,DIE=52.5,DR=".02///"_INDT D ^DIE K DIE K:$G(^PS(52.5,SFN,"P"))=1 ^PS(52.5,"AC",DFN,+$P($G(^PS(52.5,SFN,0)),"^",2),SFN) I $D(DTOUT)!($D(DUOUT))!($D(Y)) S PSOPOPUP=1 Q
"RTN","PSOSUCHG",46,0)
 D CHANGE^PSOSUCH1(RXREC)
"RTN","PSOSUCHG",47,0)
DEL I 'DELCNT W !! S DIR("A")="Do you want to delete"_$S($G(ACT)="S":" this Rx ",1:" Rx's ")_"from suspense"_$S($G(ACT)="A":" for this patient",1:""),DIR("B")="N",DIR(0)="Y" D ^DIR K DIR S DELCNT=1 S DEL=Y Q:'Y  I $D(DIRUT) S PSOPOPUP=1 Q
"RTN","PSOSUCHG",48,0)
 I $G(ACT)="A",DELCNT,$G(DEL),'$G(DELFLAG) W !!,"Deleting Rx's from suspense..",! S DELFLAG=1 D DEL1 Q
"RTN","PSOSUCHG",49,0)
 Q:'DEL
"RTN","PSOSUCHG",50,0)
 I '$D(PSOSDLK(RXREC)) D  Q:$G(PSODELLK)
"RTN","PSOSUCHG",51,0)
 .K PSOMSG,PSODELLK D PSOL^PSSLOCK(RXREC) I '$G(PSOMSG) W !,"Rx number: "_$P($G(^PSRX(RXREC,0)),"^")_" cannot be deleted from suspense because" D LMES,PAUSE S PSODELLK=1 K PSOMSG Q
"RTN","PSOSUCHG",52,0)
 .K PSOMSG S PSOSDLK(RXREC)=""
"RTN","PSOSUCHG",53,0)
 I DEL S DA=$O(^PS(52.5,"B",RXREC,0)) D RF S DIK="^PS(52.5," D ^DIK K DIK D:$P(^PSRX(RXREC,"STA"),"^")=5  W:$G(ACT)="S" !!,"Rx# ",$P($G(^PSRX(RXREC,0)),"^")," has been deleted from suspense!",!
"RTN","PSOSUCHG",54,0)
 .S $P(^PSRX(RXREC,"STA"),"^")=0
"RTN","PSOSUCHG",55,0)
 .N PSOZZD S PSOZZD="Removed from suspense" D EN^PSOHLSN1(RXREC,"SC","ZU",PSOZZD) K PSOZZD Q
"RTN","PSOSUCHG",56,0)
 Q
"RTN","PSOSUCHG",57,0)
EXPCAN S DIK="^PS(52.5,",DA=SFN D ^DIK K DIK S Y=STOP D DD^%DT S PSOSSTP=Y I STOP<DT!(STAT=11) D:STAT'=11  W $C(7),!,"Rx# "_$P($G(^PSRX(RXREC,0)),"^")_" expired "_$G(PSOSSTP)_"."
"RTN","PSOSUCHG",58,0)
 .S $P(^PSRX(RXREC,"STA"),"^")=11
"RTN","PSOSUCHG",59,0)
 .N PSOZZD S PSOZZD="Expired while suspended" D EN^PSOHLSN1(RXREC,"SC","ZE",PSOZZD) K PSOZZD
"RTN","PSOSUCHG",60,0)
 W:STAT=12 $C(7),!,"Rx# "_$P(^PSRX(RXREC,0),"^")_" was discontinued "_Y_"." K STAT,STOP Q
"RTN","PSOSUCHG",61,0)
TST N X S X="PSXCH" X ^%ZOSF("TEST") K X Q
"RTN","PSOSUCHG",62,0)
 ;
"RTN","PSOSUCHG",63,0)
RF ;
"RTN","PSOSUCHG",64,0)
 S PSSHLDDA=DA,PSODFS=0
"RTN","PSOSUCHG",65,0)
 S SNODE=$G(^PS(52.5,DA,0)),PSINN=+SNODE D DAREC^PSOSUCH1 I '$G(PSINN)!($P(SNODE,"^",5)) K PSINN,SNODE,PSODFS S DA=PSSHLDDA Q
"RTN","PSOSUCHG",66,0)
 S PSIFN=0 F  S PSIFN=$O(^PSRX(PSINN,1,PSIFN)) Q:'PSIFN  D
"RTN","PSOSUCHG",67,0)
 .I $P($G(^PSRX(PSINN,1,PSIFN,0)),"^")=$P(SNODE,"^",2),'$P($G(^PSRX(PSINN,1,PSIFN,0)),"^",18),$P($G(^PS(52.5,+$G(PSSHLDDA),"P")),"^")=0 D
"RTN","PSOSUCHG",68,0)
 ..N DIK,DA S DIK="^PSRX("_PSINN_",1,",DA(1)=PSINN,DA=PSIFN D ^DIK
"RTN","PSOSUCHG",69,0)
 ..S PSODFS=1,PSUSD=$P(SNODE,"^",2) D DATE
"RTN","PSOSUCHG",70,0)
 I '$G(PSODFS) G RFPS
"RTN","PSOSUCHG",71,0)
 S PSIFN=0 F  S PSIFN=$O(^PSRX(PSINN,1,PSIFN)) Q:'PSIFN  I '$O(^PSRX(PSINN,1,PSIFN)) S $P(^PSRX(PSINN,3),"^")=+$P(^PSRX(PSINN,1,PSIFN,0),"^")
"RTN","PSOSUCHG",72,0)
 I '$O(^PSRX(PSINN,1,0)) S $P(^PSRX(PSINN,3),"^")=$P(^PSRX(PSINN,2),"^",2)
"RTN","PSOSUCHG",73,0)
 S PSOX("IRXN")=PSINN D NEXT^PSOUTIL(.PSOX) S PSONEXT=$P(PSOX("RX3"),"^",2),DA=PSINN,DIE=52,DR="102///"_PSONEXT D ^DIE K DIE K PSONEXT,PSOX
"RTN","PSOSUCHG",74,0)
RFPS K PSODFS,ZZZ,PSINN,PSIFN,PSUSD,PNOD,SNODE S DA=PSSHLDDA K PSSHLDDA Q
"RTN","PSOSUCHG",75,0)
DATE S PNOD=0 F ZZZ=0:0 S ZZZ=$O(^PSRX(PSINN,1,ZZZ)) Q:'ZZZ  S PNOD=ZZZ
"RTN","PSOSUCHG",76,0)
 I PNOD=1 S $P(^PSRX(PSINN,3),"^",4)=$P(^PSRX(PSINN,2),"^",2) Q
"RTN","PSOSUCHG",77,0)
DATEX I $G(PNOD) S PNOD=PNOD-1 G:'$D(^PSRX(PSINN,1,PNOD,0)) DATEX
"RTN","PSOSUCHG",78,0)
 I PNOD=0 S $P(^PSRX(PSINN,3),"^",4)=$P(^PSRX(PSINN,2),"^",2) Q
"RTN","PSOSUCHG",79,0)
 S $P(^PSRX(PSINN,3),"^",4)=$P(^PSRX(PSINN,1,PNOD,0),"^") Q
"RTN","PSOSUCHG",80,0)
 Q
"RTN","PSOSUCHG",81,0)
IS K DIE I $G(INDT),$G(INDT)<+$P($G(^PSRX(RXREC,0)),"^",13) S DIE=52.5,DA=SFN,DR=".02///"_RXDATE D ^DIE K DIE W !!,"Suspense date cannot be before Issue Date for Rx# ",$P($G(^PSRX(RXREC,0)),"^") S ISFLAG=1
"RTN","PSOSUCHG",82,0)
 Q
"RTN","PSOSUCHG",83,0)
SI ;
"RTN","PSOSUCHG",84,0)
 S SUSCNT=1
"RTN","PSOSUCHG",85,0)
 I $D(Y) S (ISFLAG,PSOPOPUP)=1
"RTN","PSOSUCHG",86,0)
 G IS
"RTN","PSOSUCHG",87,0)
DEL1 ;
"RTN","PSOSUCHG",88,0)
 S PSOSUPOP=1
"RTN","PSOSUCHG",89,0)
 F WW=0:0 S WW=$O(^PS(55,DFN,"P",WW)) Q:WW'>0  S:$D(^PS(55,DFN,"P",WW,0)) RXREC=+^(0) D:$D(^PS(52.5,"B",+$G(RXREC)))
"RTN","PSOSUCHG",90,0)
 .I '$D(PSOSDLK(RXREC)) K PSODELLK D DELONE Q:$G(PSODELLK)
"RTN","PSOSUCHG",91,0)
 .I $P($G(^PSRX(RXREC,"STA")),"^")=11!($P($G(^PSRX(RXREC,2)),"^",6)<DT) D EXPCAN1 Q
"RTN","PSOSUCHG",92,0)
 .S DA=$O(^PS(52.5,"B",RXREC,0)) D RF S DIK="^PS(52.5," D ^DIK K DIK D:$P(^PSRX(RXREC,"STA"),"^")=5  W:$G(ACT)="S" !!,"Rx# ",$P($G(^PSRX(RXREC,0)),"^")," has been deleted from suspense!",!
"RTN","PSOSUCHG",93,0)
 ..S $P(^PSRX(RXREC,"STA"),"^")=0
"RTN","PSOSUCHG",94,0)
 ..N PSOZZD S PSOZZD="Removed from suspense" D EN^PSOHLSN1(RXREC,"SC","ZU",PSOZZD) K PSOZZD Q
"RTN","PSOSUCHG",95,0)
 Q
"RTN","PSOSUCHG",96,0)
ULK ;Unlock prescriptions
"RTN","PSOSUCHG",97,0)
 I '$O(PSOSDLK("")) Q
"RTN","PSOSUCHG",98,0)
 N PSOSDLKR S PSOSDLKR="" F  S PSOSDLKR=$O(PSOSDLK(PSOSDLKR)) Q:PSOSDLKR=""  D PSOUL^PSSLOCK(PSOSDLKR)
"RTN","PSOSUCHG",99,0)
 K PSOSDLK
"RTN","PSOSUCHG",100,0)
 Q
"RTN","PSOSUCHG",101,0)
PAUSE ;
"RTN","PSOSUCHG",102,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR W !
"RTN","PSOSUCHG",103,0)
 Q
"RTN","PSOSUCHG",104,0)
LMES ;
"RTN","PSOSUCHG",105,0)
 W !,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order.")
"RTN","PSOSUCHG",106,0)
 Q
"RTN","PSOSUCHG",107,0)
DELONE ;
"RTN","PSOSUCHG",108,0)
 K PSOMSG,PSODELLK D PSOL^PSSLOCK(RXREC) I '$G(PSOMSG) W !,"Rx number: "_$P($G(^PSRX(RXREC,0)),"^")_" cannot be deleted from suspense because" D LMES,PAUSE S PSODELLK=1 K PSOMSG Q
"RTN","PSOSUCHG",109,0)
 K PSOMSG S PSOSDLK(RXREC)=""
"RTN","PSOSUCHG",110,0)
 Q
"RTN","PSOSUCHG",111,0)
EXPCAN1 ;
"RTN","PSOSUCHG",112,0)
 N SFN,Y,PSOSSTP,STAT,STOP
"RTN","PSOSUCHG",113,0)
 S STAT=$P($G(^PSRX(RXREC,"STA")),"^"),STOP=$P($G(^PSRX(RXREC,2)),"^",6)
"RTN","PSOSUCHG",114,0)
 S SFN=+$O(^PS(52.5,"B",RXREC,0)) Q:'SFN
"RTN","PSOSUCHG",115,0)
 S DIK="^PS(52.5,",DA=SFN D ^DIK K DIK S Y=STOP D DD^%DT S PSOSSTP=Y I STOP<DT!(STAT=11) D:STAT'=11  W $C(7),!,"Rx# "_$P($G(^PSRX(RXREC,0)),"^")_" expired "_$G(PSOSSTP)_"."
"RTN","PSOSUCHG",116,0)
 .S $P(^PSRX(RXREC,"STA"),"^")=11
"RTN","PSOSUCHG",117,0)
 .N PSOZZD S PSOZZD="Expired while suspended" D EN^PSOHLSN1(RXREC,"SC","ZE",PSOZZD) K PSOZZD
"RTN","PSOSUCHG",118,0)
 Q
"RTN","PSOSULBL")
0^18^B38582182
"RTN","PSOSULBL",1,0)
PSOSULBL ;BHAM ISC/RTR,SAB-Print Suspended labels ;4/8/93
"RTN","PSOSULBL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**139,173,174,148**;DEC 1997
"RTN","PSOSULBL",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOSULBL",4,0)
 K PDUZ,REPRINT G ^PSOSULB1
"RTN","PSOSULBL",5,0)
BEG ;
"RTN","PSOSULBL",6,0)
 K PSORUNIN,PSORETRY N BPSCNT
"RTN","PSOSULBL",7,0)
 S PSORUNIN="PSOSUSP"_($G(PSOSITE))
"RTN","PSOSULBL",8,0)
 L +@PSORUNIN:10 I '$T D
"RTN","PSOSULBL",9,0)
 . F PSORETRY=1:1:120 L +@PSORUNIN:60 I $T Q  ;waits a Maximum of 2 hours before continuing
"RTN","PSOSULBL",10,0)
 . Q
"RTN","PSOSULBL",11,0)
 K ^UTILITY($J,"PSOPRO") S PSOSEQ=1 F DFN=0:0 S DFN=$O(^PS(52.5,"AC",DFN)) Q:'DFN  D  D:'PSRT PID^VADPT6 D CHKDEAD D:'DEAD&($G(PSOSFLAG)) PRT
"RTN","PSOSULBL",12,0)
 .S PSOSFLAG=0 F ZZ=0:0 S ZZ=$O(^PS(52.5,"AC",DFN,ZZ)) Q:'ZZ!$G(PSOSFLAG)  I ZZ'>PRTDT S PSOSFLAG=1
"RTN","PSOSULBL",13,0)
 D PPL
"RTN","PSOSULBL",14,0)
 D:$D(^UTILITY($J,"PSOPRO"))&($P(PSOPAR,"^",8)) PROF
"RTN","PSOSULBL",15,0)
 G EXIT
"RTN","PSOSULBL",16,0)
PRT F SDT=0:0 S SDT=$O(^PS(52.5,"AC",DFN,SDT)) D:SDT CHK Q:'SDT
"RTN","PSOSULBL",17,0)
 Q
"RTN","PSOSULBL",18,0)
EXIT ;
"RTN","PSOSULBL",19,0)
 K ^TMP($J)
"RTN","PSOSULBL",20,0)
 I $D(PSORUNIN) L -@PSORUNIN
"RTN","PSOSULBL",21,0)
 D ^%ZISC
"RTN","PSOSULBL",22,0)
 K %,%ZIS,CNT,COM,DA,DEAD,DFN,DIRUT,DTTM,G,HDPPL,JJ,JJJ,JJJJ,PDUZ,IOP,ORD,PFIOQ,PSLION,PSRT,POP,PRF,PRTDT,PSLIO,PSNP,PSODBQ,PSOSEQ,PSOSFLAG,PSOSU,PSOTIME,PSOOUT,PSOPRFLG,PSOSEQ,PSOSUSPR,PSSPND,PST,PTL,PPLHLD,PSFNIEN,ZTSK
"RTN","PSOSULBL",23,0)
 K PSORUNIN,PSORETRY,PSRTONE,PSSRT,PSUSDEA,RF,RFCNT,RX,SDT,SFN,SREC,STOP,SUSPT,VADM,VAPA,X,X1,X2,XAK,XDATE,Y,Z,ZZ,WWW,PSDDDATE,SINRX,RXPR,RXPR1,GGGG,XXX,ZII,ZTDESC,ZTRTN,ZTSAVE,RRRR,RXRP,RXRP1,RXFL,SPR S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOSULBL",24,0)
CHK I SDT'>XDATE D TMP Q
"RTN","PSOSULBL",25,0)
 Q
"RTN","PSOSULBL",26,0)
TMP F SFN=0:0 S SFN=$O(^PS(52.5,"AC",DFN,SDT,SFN)) Q:'SFN  D
"RTN","PSOSULBL",27,0)
 . I '$D(^PS(52.5,SFN,0))!'$D(^DPT(+DFN,0)) Q
"RTN","PSOSULBL",28,0)
 . N RXSITE,PRINTED,PSDFN,RXSTS,RXIEN,RXFILL,PARTIAL,RXEXPDT,RESP
"RTN","PSOSULBL",29,0)
 . S RXIEN=+$$GET1^DIQ(52.5,SFN,.01,"I"),RXDFN=$$GET1^DIQ(52,RXIEN,2,"I")
"RTN","PSOSULBL",30,0)
 . S RXSTS=$$GET1^DIQ(52,RXIEN,100,"I"),RXSITE=+$$GET1^DIQ(52.5,SFN,.06,"I"),PRINTED=+$$GET1^DIQ(52.5,SFN,2,"I")
"RTN","PSOSULBL",31,0)
 . S PARTIAL=+$$GET1^DIQ(52.5,SFN,.05,"I"),RXEXPDT=$$GET1^DIQ(52,RXIEN,26,"I")
"RTN","PSOSULBL",32,0)
 . S RXFILL=$$GET1^DIQ(52.5,SFN,9,"I") I RXFILL="" S RXFILL=$$LSTRFL^PSOBPSU1(RXIEN)
"RTN","PSOSULBL",33,0)
 . I RXSITE=$G(PSOSITE),'PRINTED,RXDFN=DFN,RXSTS<9 D
"RTN","PSOSULBL",34,0)
 . . I PARTIAL,'$D(^PSRX(RXIEN,"P",PARTIAL)) Q
"RTN","PSOSULBL",35,0)
 . . I RXEXPDT<DT,RXSTS<11 D  Q
"RTN","PSOSULBL",36,0)
 . . . N RXREC S RXREC=RXIEN D EX^PSOSUTL
"RTN","PSOSULBL",37,0)
 . . . K DIE,DA S DIE=52,DA=RXIEN,DR="100///11" D ^DIE K DIE,DA
"RTN","PSOSULBL",38,0)
 . . . K DIK,DA S DA=SFN,DIK="^PS(52.5," D ^DIK K DIK,DA
"RTN","PSOSULBL",39,0)
 . . I PSRT="D" D
"RTN","PSOSULBL",40,0)
 . . . S PSSRT=$S($G(PSRTONE)="I":VA("PID"),1:$P(^DPT(DFN,0),"^")_$P(^(0),"^",9))
"RTN","PSOSULBL",41,0)
 . . . S PSUSDEA=$P($G(^PS(52.5,SFN,0)),"^",10)
"RTN","PSOSULBL",42,0)
 . . . S SRT=$S(PSUSDEA["A"!(PSUSDEA["C"):"A-"_PSSRT,PSUSDEA["S":"S-"_PSSRT,1:"Z-"_PSSRT)
"RTN","PSOSULBL",43,0)
 . . I PSRT'="D" D
"RTN","PSOSULBL",44,0)
 . . . S SRT=$S(PSRT:$P(^DPT(DFN,0),"^")_$P(^(0),"^",9),1:VA("PID"))
"RTN","PSOSULBL",45,0)
 . . ; - If not partial fill, sending Rx to ECME for 3rd Party billing
"RTN","PSOSULBL",46,0)
 . . I 'PARTIAL,$$RETRX^PSOBPSUT(RXIEN,RXFILL),SDT>DT Q
"RTN","PSOSULBL",47,0)
 . . I 'PARTIAL D  I $$FIND^PSOREJUT(RXIEN,RXFILL) Q
"RTN","PSOSULBL",48,0)
 . . . I $$FIND^PSOREJUT(RXIEN,RXFILL) Q
"RTN","PSOSULBL",49,0)
 . . . I '$$RETRX^PSOBPSUT(RXIEN,RXFILL),$$STATUS^PSOBPSUT(RXIEN,RXFILL)'="" Q
"RTN","PSOSULBL",50,0)
 . . . D ECMESND^PSOBPSU1(RXIEN,RXFILL,,"PL",,,,,,.RESP) I $D(RESP),'RESP S BPSCNT=$G(BPSCNT)+1
"RTN","PSOSULBL",51,0)
 . . S ^TMP($J,SRT,SFN)=RXIEN
"RTN","PSOSULBL",52,0)
 Q
"RTN","PSOSULBL",53,0)
PPL ; Wait some time before printing so response from 3rd party payers can be received
"RTN","PSOSULBL",54,0)
 I $G(BPSCNT)>0 H 60+$S((BPSCNT*15)>7200:7200,1:(BPSCNT*15))
"RTN","PSOSULBL",55,0)
 K PPL,PPL1 S ORD="" F  S ORD=$O(^TMP($J,ORD)) Q:ORD=""  D PPL1
"RTN","PSOSULBL",56,0)
 Q
"RTN","PSOSULBL",57,0)
PPL1 ; Printing Labels
"RTN","PSOSULBL",58,0)
 N PARTIAL,REPRINT,REFILL,Z
"RTN","PSOSULBL",59,0)
 S (PSOPRFLG,SUSPT)=1 S:$D(PSOPROP) PFIO=PSOPROP
"RTN","PSOSULBL",60,0)
 S:'$D(PDUZ) PDUZ=DUZ K RXPR,RXPR1,PPL
"RTN","PSOSULBL",61,0)
 F SFN=0:0 S SFN=$O(^TMP($J,ORD,SFN)) Q:'SFN  D
"RTN","PSOSULBL",62,0)
 .I '$D(^PS(52.5,SFN,0)) Q
"RTN","PSOSULBL",63,0)
 .S Z=$G(^PS(52.5,SFN,0)),SINRX=+$P(Z,"^"),REFILL=+$P(Z,"^",13)
"RTN","PSOSULBL",64,0)
 .S PARTIAL=$P(Z,"^",5),REPRINT=$P(Z,"^",12)
"RTN","PSOSULBL",65,0)
 .; - Screening out OPEN/UNRESOLVED Rejects (3rd Party Payer)
"RTN","PSOSULBL",66,0)
 .I 'PARTIAL,'REPRINT,$$FIND^PSOREJUT(SINRX,REFILL) Q
"RTN","PSOSULBL",67,0)
 .I 'PARTIAL,'REPRINT,$$STATUS^PSOBPSUT(SINRX,REFILL)="IN PROGRESS" Q
"RTN","PSOSULBL",68,0)
 .I $L($G(PPL))<240 D
"RTN","PSOSULBL",69,0)
 ..S PPL=$P(^TMP($J,ORD,SFN),"^")_","_$G(PPL),RXPR(SINRX)=$P(^PS(52.5,SFN,0),"^",5)
"RTN","PSOSULBL",70,0)
 ..S:$P(^PS(52.5,SFN,0),"^",12) RXRP(SINRX)=1
"RTN","PSOSULBL",71,0)
 .E  D
"RTN","PSOSULBL",72,0)
 ..S PPL1=$P(^TMP($J,ORD,SFN),"^")_","_$G(PPL1),RXPR1(SINRX)=$P(^PS(52.5,SFN,0),"^",5)
"RTN","PSOSULBL",73,0)
 ..S:$P(^PS(52.5,SFN,0),"^",12) RXRP1(SINRX)=1
"RTN","PSOSULBL",74,0)
 .S DFN=$P(^PS(52.5,SFN,0),"^",3)
"RTN","PSOSULBL",75,0)
 .I $P(PSOPAR,"^",8),'$D(^PSRX($P(^PS(52.5,SFN,0),"^"),1)),'$G(RXPR(SINRX)),'$G(RXPR1(SINRX)) S PSOPRFLG=0
"RTN","PSOSULBL",76,0)
 S PSNP=$S($P(PSOPAR,"^",8):1,1:0)
"RTN","PSOSULBL",77,0)
 I $G(PPL) D
"RTN","PSOSULBL",78,0)
 .S PPLHLD=$G(PPL1),HDPPL=PPL K PPL1 S (PSODBQ,PSOSUSPR)=1
"RTN","PSOSULBL",79,0)
 .F GGGG=0:0 S GGGG=$O(RXPR(GGGG)) Q:'GGGG  K:'$G(RXPR(GGGG)) RXPR(GGGG)
"RTN","PSOSULBL",80,0)
 I $G(PPL) D DQ^PSOLBL,SEQ D:'$G(PSOPRFLG)
"RTN","PSOSULBL",81,0)
 .I $G(PSOPROP)'=$G(PSLION) S ^UTILITY($J,"PSOPRO",DFN)="" Q
"RTN","PSOSULBL",82,0)
 .D DQ^PSOPRFSS
"RTN","PSOSULBL",83,0)
 I $G(PPLHLD) K RXPR S (PPL,HDPPL)=PPLHLD,(PSODBQ,PSOSUSPR)=1,PSNP=0 S:'$D(PDUZ) PDUZ=DUZ F XXX=0:0 S XXX=$O(RXPR1(XXX)) Q:'XXX  S:$G(RXPR1(XXX)) RXPR(XXX)=RXPR1(XXX)
"RTN","PSOSULBL",84,0)
 I $G(PPLHLD) F RRRR=0:0 S RRRR=$O(RXRP1(RRRR)) Q:'RRRR  S:$D(RXRP1(RRRR)) RXRP(RRRR)=1
"RTN","PSOSULBL",85,0)
 I $G(PPLHLD) D DQ^PSOLBL,SEQ D:'$G(PSOPRFLG)
"RTN","PSOSULBL",86,0)
 .I $G(PSOPROP)'=$G(PSLION) S ^UTILITY($J,"PSOPRO",DFN)="" Q
"RTN","PSOSULBL",87,0)
 .D DQ^PSOPRFSS
"RTN","PSOSULBL",88,0)
 K PPL,PPL1,PPLHLD,RXPR,RXPR1,RXFL Q
"RTN","PSOSULBL",89,0)
SEQ ;
"RTN","PSOSULBL",90,0)
 S SQCOUNT=0 F JJJ=1:1:$L(HDPPL) S:$E(HDPPL,JJJ)="," SQCOUNT=SQCOUNT+1
"RTN","PSOSULBL",91,0)
 F JJJJ=1:1:SQCOUNT S PSFNIEN=$P(HDPPL,",",JJJJ) D:PSFNIEN
"RTN","PSOSULBL",92,0)
 .S PSFNIEN=$O(^PS(52.5,"B",PSFNIEN,0)) I PSFNIEN D
"RTN","PSOSULBL",93,0)
 ..S $P(^PS(52.5,PSFNIEN,0),"^",11)=PSOSEQ,PSOSEQ=PSOSEQ+1 S:$P(^PS(52.5,PSFNIEN,0),"^",8)&($P(^(0),"^",9))&($P(^(0),"^",6)) ^PS(52.5,"AS",$P(^PS(52.5,PSFNIEN,0),"^",8),$P(^(0),"^",9),$P(^(0),"^",6),$P(^(0),"^",11),PSFNIEN)=""
"RTN","PSOSULBL",94,0)
 Q
"RTN","PSOSULBL",95,0)
CHKDEAD D DEM^VADPT I VADM(1)="" S DEAD=0 Q
"RTN","PSOSULBL",96,0)
 I VADM(6)="" S DEAD=0 Q
"RTN","PSOSULBL",97,0)
 S PSDDDATE=$P(VADM(6),"^",2) F WWW=0:0 S WWW=$O(^PS(55,DFN,"P",WWW)) Q:'WWW  I $D(^PS(55,DFN,"P",WWW,0)),$P($G(^(0)),"^") S (DA,RXREC)=$P(^(0),"^") S SFN=$O(^PS(52.5,"B",RXREC,0)) I SFN,$D(^PS(52.5,SFN,0)) S RX=$P(^(0),"^") D DEAD
"RTN","PSOSULBL",98,0)
 Q
"RTN","PSOSULBL",99,0)
DEAD S $P(^PSRX(RX,"STA"),"^")=12,COM="Died ("_$G(PSDDDATE)_")",DA(1)=RX
"RTN","PSOSULBL",100,0)
 S DEAD=1 D ARECD^PSOSUTL S DIK="^PS(52.5,",DA=SFN D ^DIK K DIK
"RTN","PSOSULBL",101,0)
 Q
"RTN","PSOSULBL",102,0)
PROF ;
"RTN","PSOSULBL",103,0)
 S ZTRTN="PRPROF^PSOSULBL",ZTDESC="PRINT PROFILES FROM SUSPENSE",ZTDTH=$H,ZTIO=PSOPROP
"RTN","PSOSULBL",104,0)
 S ZTSAVE("^UTILITY($J,""PSOPRO"",")="",ZTSAVE("PSOPAR")="",ZTSAVE("PSODTCUT")="",ZTSAVE("PSOSITE")="",ZTSAVE("PSOPRPAS")="" D ^%ZTLOAD Q
"RTN","PSOSULBL",105,0)
PRPROF ;
"RTN","PSOSULBL",106,0)
 F LLL=0:0 S LLL=$O(^UTILITY($J,"PSOPRO",LLL)) Q:'LLL  I $D(^DPT(LLL,0)) S DFN=LLL D DQ^PSOPRFSS
"RTN","PSOSULBL",107,0)
 K PSOPAR,PSODTCUT,PSOSITE,PSOPRPAS,LLL,DFN,^UTILITY($J,"PSOPRO") D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOSULBL",108,0)
 Q
"RTN","PSOSUPOE")
0^19^B53974014
"RTN","PSOSUPOE",1,0)
PSOSUPOE ;BIR/RTR - Suspense pull via Listman ;3/1/96
"RTN","PSOSUPOE",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,21,27,34,130,148**;DEC 1997
"RTN","PSOSUPOE",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOSUPOE",4,0)
SEL I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOSUPOE",5,0)
 N PSOGETF,PSOGET,PSOGETFN,ORD,ORN,MW,PDUZ,PSLST,PSOSQ,PSOSQRTE,PSOSQMTH,PSPOP,PSOX1,PSOX2,RXLTOP,RXREC,SFN,SORD,SORN,VALMCNT
"RTN","PSOSUPOE",6,0)
 K DIR,DUOUT,DTOUT S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR K DIR I $D(DTOUT)!($D(DUOUT))!('Y) S VALMSG="Nothing pulled from suspense!",VALMBCK="" Q
"RTN","PSOSUPOE",7,0)
 S PSLST=Y
"RTN","PSOSUPOE",8,0)
SELQ D FULL^VALM1
"RTN","PSOSUPOE",9,0)
 K DIR S DIR("A")="Select routing for Rx(s)",DIR(0)="S^M:MAIL;W:WINDOW",DIR("B")="WINDOW" D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) G END
"RTN","PSOSUPOE",10,0)
 S PSOSQRTE=Y I $G(PSOSQRTE)="W",$P(PSOPAR,"^",12) K DIR S DIR(0)="FO^2:60",DIR("A")="METHOD OF PICK-UP" D ^DIR S PSOSQMTH=$G(Y) K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) G END
"RTN","PSOSUPOE",11,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Pull Rx(s) and delete from suspense",DIR("B")="YES" D  D ^DIR K DIR I Y'=1 G END
"RTN","PSOSUPOE",12,0)
 .S DIR("?",1)="Enter Yes to pull selected Rx(s) from suspense. Since(Rx(s) pulled early from",DIR("?",2)="suspense are not associated with a printed batch, these Rx(s) cannot be"
"RTN","PSOSUPOE",13,0)
 .S DIR("?",3)="reprinted from suspense using the 'Reprint batches from suspense' option.",DIR("?")="Therefore, any Rx(s) pulled early from suspense will be deleted from suspense."
"RTN","PSOSUPOE",14,0)
 Q:$G(PULLONE)
"RTN","PSOSUPOE",15,0)
 F SORD=1:1:$L(PSLST,",") Q:$P(PSLST,",",SORD)']""  S SORN=$P(PSLST,",",SORD) D:+PSOLST(SORN)=52 BEG
"RTN","PSOSUPOE",16,0)
 S VALMBCK="R"
"RTN","PSOSUPOE",17,0)
 I '$G(PSOSQ) S VALMSG="No Rx's pulled from suspense!"
"RTN","PSOSUPOE",18,0)
 Q
"RTN","PSOSUPOE",19,0)
BEG ;
"RTN","PSOSUPOE",20,0)
 S RXREC=$P(PSOLST(SORN),"^",2)
"RTN","PSOSUPOE",21,0)
BEGQ Q:'$D(^PSRX(+$G(RXREC),0))
"RTN","PSOSUPOE",22,0)
 D PSOL^PSSLOCK(RXREC) I '$G(PSOMSG) W !!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing Rx "_$P($G(^PSRX(RXREC,0)),"^")),! K PSOMSG D DIR Q
"RTN","PSOSUPOE",23,0)
 K PSOMSG I $P($G(^PSRX(RXREC,"STA")),"^")'=5 W !!,"Rx# ",$P(^PSRX(RXREC,0),"^")," is not on Suspense!" D DIR,ULRX Q
"RTN","PSOSUPOE",24,0)
 S SFN=$O(^PS(52.5,"B",RXREC,0)) I 'SFN D DIR,ULRX Q
"RTN","PSOSUPOE",25,0)
 S PDUZ=DUZ I +$G(^PS(52.5,SFN,"P")) W !,">>> Rx #",$P(^PSRX(+$P(^(0),"^"),0),"^")," ALREADY PRINTED FROM SUSPENSE.",!,?5,"USE THE REPRINT OPTION TO REPRINT LABEL." D DIR,ULRX Q
"RTN","PSOSUPOE",26,0)
 I +$P($G(^PSRX(RXREC,2)),"^",6)<DT,+$P($G(^("STA")),"^")<11 D  S DIE=52,DA=RXREC,DR="100///11" D ^DIE S DA=SFN,DIK="^PS(52.5," D ^DIK K DIE,DA,DIK W !,"Rx # "_$P(^PSRX(RXREC,0),"^")_" has expired!" D DIR,ULRX Q
"RTN","PSOSUPOE",27,0)
 .N PSCOU,AAA,VVV,QQQ,PSOPRT,PSOEXPI D EX^PSOSUTL
"RTN","PSOSUPOE",28,0)
 I $D(RXRP(RXREC)) W !!,"A reprint has already been requested for Rx # ",$P($G(^PSRX(RXREC,0)),"^") D DIR,ULRX Q
"RTN","PSOSUPOE",29,0)
 I $D(RXPR(RXREC)) W !!,"A partial has already been requested for Rx # ",$P($G(^PSRX(RXREC,0)),"^") D DIR,ULRX Q
"RTN","PSOSUPOE",30,0)
 S PSPOP=0 I $G(PSODIV),$P($G(^PS(52.5,SFN,0)),"^",6)'=$G(PSOSITE) D CKDIV I $G(PSPOP) D DIR,ULRX Q
"RTN","PSOSUPOE",31,0)
 S:$P(^PS(52.5,SFN,0),"^",5) RXPR(RXREC)=$P(^(0),"^",5) S:$P(^PS(52.5,SFN,0),"^",12) RXRP(RXREC)=1
"RTN","PSOSUPOE",32,0)
 S RXFL(RXREC)=$P($G(^PS(52.5,SFN,0)),"^",13),RXRS(RXREC)=$G(PSODFN),RXLTOP=1
"RTN","PSOSUPOE",33,0)
 S RXRS(RXREC)=$G(RXRS(RXREC))_"^"_$S($P($G(^PS(52.5,SFN,0)),"^",4)="W":"W",1:"M")_"^"_$P($G(^PSRX(RXREC,"MP")),"^") S PSOGET="M" D GETMW
"RTN","PSOSUPOE",34,0)
 S RXRS(RXREC)=$G(RXRS(RXREC))_"^"_$G(PSOGETF)_"^"_$G(PSOGETFN)_"^"_$S($G(PSOGET)="W":"W",1:"M")
"RTN","PSOSUPOE",35,0)
 S $P(^PS(52.5,SFN,0),"^",4)=$G(PSOSQRTE) S MW=$G(PSOSQRTE) N RR,RFCNT D MAILS^PSOSUPAT I $D(PSOSQMTH) S $P(^PSRX(RXREC,"MP"),"^")=$G(PSOSQMTH)
"RTN","PSOSUPOE",36,0)
 S PSOSQ=1
"RTN","PSOSUPOE",37,0)
 ;
"RTN","PSOSUPOE",38,0)
 ; - Submitting Rx to ECME for 3rd Party Billing
"RTN","PSOSUPOE",39,0)
 I '$D(RXPR(RXREC)) D
"RTN","PSOSUPOE",40,0)
 . N ACTION,RFL S RFL=$G(RXFL(RXREC)) I RFL="" S RFL=$$LSTRFL^PSOBPSU1(RXREC)
"RTN","PSOSUPOE",41,0)
 . D ECMESND^PSOBPSU1(RXREC,RFL,,"PP")
"RTN","PSOSUPOE",42,0)
 . I $$FIND^PSOREJUT(RXREC,RFL) D
"RTN","PSOSUPOE",43,0)
 . . S ACTION=$$HDLG^PSOREJU1(RXREC,RFL,"79,88","PP","IOQ","I")
"RTN","PSOSUPOE",44,0)
 ;
"RTN","PSOSUPOE",45,0)
 D ULRX K PSOGET,PSOGETF
"RTN","PSOSUPOE",46,0)
 Q
"RTN","PSOSUPOE",47,0)
WIND ;
"RTN","PSOSUPOE",48,0)
 N RRT,RRTT,XXXX,JJJJ,PSINTRX,RTETEST,PSOPSO,SSSS
"RTN","PSOSUPOE",49,0)
 S PBINGRTE=0,PSINTRX=RXREC
"RTN","PSOSUPOE",50,0)
 I $G(RXPR(RXREC)) S RTETEST=$P($G(^PSRX(RXREC,"P",RXPR(PSINTRX),0)),"^",2) S:RTETEST="W" PBINGRTE=1 Q
"RTN","PSOSUPOE",51,0)
 S PSOPSO=0 F SSSS=0:0 S SSSS=$O(^PSRX(PSINTRX,1,SSSS)) Q:'SSSS  S PSOPSO=SSSS
"RTN","PSOSUPOE",52,0)
 I 'PSOPSO S RTETEST=$P($G(^PSRX(PSINTRX,0)),"^",11) S:RTETEST="W" PBINGRTE=1 Q
"RTN","PSOSUPOE",53,0)
 I PSOPSO S RTETEST=$P($G(^PSRX(PSINTRX,1,PSOPSO,0)),"^",2) S:RTETEST="W" PBINGRTE=1 Q
"RTN","PSOSUPOE",54,0)
 Q
"RTN","PSOSUPOE",55,0)
DIR ;
"RTN","PSOSUPOE",56,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR Q
"RTN","PSOSUPOE",57,0)
END S VALMSG="Nothing pulled from suspense!",VALMBCK="R" S:$G(PULLONE)=1 PULLONE=2 Q
"RTN","PSOSUPOE",58,0)
ADD ;Add Rx to SPSORX array
"RTN","PSOSUPOE",59,0)
 I $G(SPSORX("PSOL",1))']"" S SPSORX("PSOL",1)=RXREC_"," Q
"RTN","PSOSUPOE",60,0)
 F PSOX1=0:0 S PSOX1=$O(SPSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOSUPOE",61,0)
 I $L(SPSORX("PSOL",PSOX2))+$L(RXREC)<220 S SPSORX("PSOL",PSOX2)=SPSORX("PSOL",PSOX2)_RXREC_"," Q
"RTN","PSOSUPOE",62,0)
 S SPSORX("PSOL",PSOX2+1)=RXREC_","
"RTN","PSOSUPOE",63,0)
 Q
"RTN","PSOSUPOE",64,0)
BBADD ;
"RTN","PSOSUPOE",65,0)
 N PSOX1,PSOX2
"RTN","PSOSUPOE",66,0)
 I $G(BBRX(1))']"" S BBRX(1)=RXREC_"," Q
"RTN","PSOSUPOE",67,0)
 F PSOX1=0:0 S PSOX1=$O(BBRX(PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOSUPOE",68,0)
 I $L(BBRX(PSOX2))+$L(RXREC)<220 S BBRX(PSOX2)=BBRX(PSOX2)_RXREC_"," Q
"RTN","PSOSUPOE",69,0)
 S BBRX(PSOX2+1)=RXREC_","
"RTN","PSOSUPOE",70,0)
 Q
"RTN","PSOSUPOE",71,0)
PPLADD ;
"RTN","PSOSUPOE",72,0)
 N SZZ,SPSOX1,SPSOX2,LSFN
"RTN","PSOSUPOE",73,0)
 I $G(PPL)'="",$E(PPL,$L(PPL))'="," S PPL=PPL_","
"RTN","PSOSUPOE",74,0)
 F SZZ=0:0 S SZZ=$O(RXRS(SZZ)) Q:'SZZ  D
"RTN","PSOSUPOE",75,0)
 .S LSFN=$O(^PS(52.5,"B",SZZ,0))
"RTN","PSOSUPOE",76,0)
 .Q:'$G(LSFN)
"RTN","PSOSUPOE",77,0)
 .Q:$G(^PS(52.5,LSFN,"P"))
"RTN","PSOSUPOE",78,0)
 .I $G(PPL)="" S PPL=SZZ_"," Q
"RTN","PSOSUPOE",79,0)
 .I $L(PPL)+$L(SZZ)<220 S PPL=PPL_SZZ_"," Q
"RTN","PSOSUPOE",80,0)
 .I $G(PSORX("PSOL",2))']"" S PSORX("PSOL",2)=SZZ_"," Q
"RTN","PSOSUPOE",81,0)
 .F SPSOX1=1:0 S SPSOX1=$O(PSORX("PSOL",SPSOX1)) Q:'SPSOX1  S SPSOX2=SPSOX1
"RTN","PSOSUPOE",82,0)
 .I $L(PSORX("PSOL",SPSOX2))+$L(SZZ)<220 S PSORX("PSOL",SPSOX2)=PSORX("PSOL",SPSOX2)_SZZ_"," Q
"RTN","PSOSUPOE",83,0)
 .S PSORX("PSOL",SPSOX2+1)=SZZ_","
"RTN","PSOSUPOE",84,0)
 Q
"RTN","PSOSUPOE",85,0)
CKDIV ;
"RTN","PSOSUPOE",86,0)
 I '$P($G(PSOSYS),"^",2) W !!?10,"Rx # ",$P(^PSRX(RXREC,0),"^")," is not a valid choice (Different Division)" S PSPOP=1 Q
"RTN","PSOSUPOE",87,0)
 I $P($G(PSOSYS),"^",3) W !!?10 K DIR S DIR("A")="Rx # "_$P(^PSRX(RXREC,0),"^")_" is from another division. OK to Pull",DIR(0)="Y",DIR("B")="YES" D ^DIR K DIR I $G(DIRUT)!('Y) S PSPOP=1
"RTN","PSOSUPOE",88,0)
 Q
"RTN","PSOSUPOE",89,0)
SELONE ;Pull one Rx through Listman
"RTN","PSOSUPOE",90,0)
 I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSOSUPOE",91,0)
 N ORD,MW,PDUZ,PSLST,PSOSQ,PSOSQRTE,PSOSQMTH,PSPOP,PSOX1,PSOX2,PULLONE,RXLTOP,RXREC,SFN,SORD,SORN,VALMCNT
"RTN","PSOSUPOE",92,0)
 S PULLONE=1
"RTN","PSOSUPOE",93,0)
 I +PSOLST(ORN)'=52 S VALMBCK="" Q
"RTN","PSOSUPOE",94,0)
 I +PSOLST(ORN)=52,$P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")'=5 S VALMSG="Rx is not on Suspense!",VALMBCK="" Q
"RTN","PSOSUPOE",95,0)
 I +PSOLST(ORN)=52,$D(RXRS($P(PSOLST(ORN),"^",2))) S VALMSG="Pull early has already been requested!",VALMBCK="" Q
"RTN","PSOSUPOE",96,0)
 D SELQ I $G(PULLONE)=2 S VALMSG="Rx# "_$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^")_" not pulled from suspense!" Q
"RTN","PSOSUPOE",97,0)
 I +PSOLST(ORN)=52 S RXREC=$P(PSOLST(ORN),"^",2) D BEGQ S VALMSG="Rx# "_$P($G(^PSRX(+$G(RXREC),0)),"^")_$S($G(PSOSQ):" pulled",1:" not pulled")_" from Suspense!"
"RTN","PSOSUPOE",98,0)
 S VALMBCK="R"
"RTN","PSOSUPOE",99,0)
 Q
"RTN","PSOSUPOE",100,0)
RESET ;
"RTN","PSOSUPOE",101,0)
 N RSDA,RXMW,RXMP,RXSP,RXR,DA,RXPSRX,RXFILL,RXFILLN
"RTN","PSOSUPOE",102,0)
 F RSDA=0:0 S RSDA=$O(RXRS(RSDA)) Q:'RSDA  D
"RTN","PSOSUPOE",103,0)
 .S RXSP=$O(^PS(52.5,"B",RSDA,0)) Q:'RXSP
"RTN","PSOSUPOE",104,0)
 .Q:'$D(^PS(52.5,RXSP,0))
"RTN","PSOSUPOE",105,0)
 .S RXMW=$S($P($G(RXRS(RSDA)),"^",2)="":"M",1:$P($G(RXRS(RSDA)),"^",2)),RXMP=$P($G(RXRS(RSDA)),"^",3),RXFILL=$P($G(RXRS(RSDA)),"^",4),RXFILLN=$P($G(RXRS(RSDA)),"^",5),RXPSRX=$S($P($G(RXRS(RSDA)),"^",6)="":"M",1:$P($G(RXRS(RSDA)),"^",6))
"RTN","PSOSUPOE",106,0)
 .I RXMW'="" S $P(^PS(52.5,RXSP,0),"^",4)=RXMW D
"RTN","PSOSUPOE",107,0)
 ..I RXFILL="P" D  Q
"RTN","PSOSUPOE",108,0)
 ...I $D(^PSRX(RSDA,"P",+$G(RXFILLN),0)) S $P(^PSRX(RSDA,"P",+$G(RXFILLN),0),"^",2)=$G(RXPSRX),$P(^PSRX(RSDA,"MP"),"^")=RXMP
"RTN","PSOSUPOE",109,0)
 ..I RXFILL="R",$G(RXFILLN) S DA(1)=RSDA,DA=RXFILLN,DIE="^PSRX("_DA(1)_",1,",DR="2////"_RXPSRX D ^DIE K DIE
"RTN","PSOSUPOE",110,0)
 ..I RXFILL="O" S DA=RSDA,DIE="^PSRX(",DR="11////"_RXPSRX D ^DIE K DIE
"RTN","PSOSUPOE",111,0)
 ..S $P(^PSRX(RSDA,"MP"),"^")=RXMP
"RTN","PSOSUPOE",112,0)
 Q
"RTN","PSOSUPOE",113,0)
GETMW ;
"RTN","PSOSUPOE",114,0)
 N GETPAR,GETRX,GETCNT
"RTN","PSOSUPOE",115,0)
 S PSOGETF="O",PSOGETFN=""
"RTN","PSOSUPOE",116,0)
 S GETPAR=$P($G(^PS(52.5,SFN,0)),"^",5)
"RTN","PSOSUPOE",117,0)
 I GETPAR S PSOGET=$P($G(^PSRX(RXREC,"P",GETPAR,0)),"^",2),PSOGETF="P",PSOGETFN=GETPAR Q
"RTN","PSOSUPOE",118,0)
 I '$O(^PSRX(RXREC,1,0)) S PSOGET=$P($G(^PSRX(RXREC,0)),"^",11) Q
"RTN","PSOSUPOE",119,0)
 S GETRX=0 F GETCNT=0:0 S GETCNT=$O(^PSRX(RXREC,1,GETCNT)) Q:'GETCNT  S GETRX=GETCNT
"RTN","PSOSUPOE",120,0)
 S PSOGET=$P($G(^PSRX(RXREC,1,+$G(GETRX),0)),"^",2),PSOGETF="R",PSOGETFN=+$G(GETRX)
"RTN","PSOSUPOE",121,0)
 Q
"RTN","PSOSUPOE",122,0)
ULRX ;
"RTN","PSOSUPOE",123,0)
 I '$G(RXREC) Q
"RTN","PSOSUPOE",124,0)
 D PSOUL^PSSLOCK(RXREC)
"RTN","PSOSUPOE",125,0)
 Q
"RTN","PSOSUPRX")
0^20^B45474972
"RTN","PSOSUPRX",1,0)
PSOSUPRX ;BIR/RTR - Suspense pull early ;3/1/96
"RTN","PSOSUPRX",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,36,130,185,148**;DEC 1997
"RTN","PSOSUPRX",3,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOSUPRX",4,0)
 ;External reference to ^PSSLOCK supported by DBIA 2789
"RTN","PSOSUPRX",5,0)
ST N PSOPLLRX D:'$D(PSOPAR) ^PSOLSET G:'$D(PSOPAR) ST
"RTN","PSOSUPRX",6,0)
 N SUSROUTE,BBRX S SUSPT=1,PSLION=$G(PSOLAP),PSOQFLAG=0 W !! S DIR("A")="Print a specific Rx # or all Rx's for a patient",DIR(0)="SBO^S:SPECIFIC RX;A:ALL RXs FOR A PATIENT"
"RTN","PSOSUPRX",7,0)
 S DIR("?",1)="Enter 'S' to print a suspended prescription label early.",DIR("?")="Enter 'A' to print all prescription suspense labels for a patient."
"RTN","PSOSUPRX",8,0)
 D ^DIR K DIR S SA=Y G:$G(DIRUT)!(Y<0) EXIT I SA="A" D ^PSOSUPAT G EXIT
"RTN","PSOSUPRX",9,0)
LU D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) ;setup start time for bingo
"RTN","PSOSUPRX",10,0)
 K SUSROUTE,BBRX,RXP,RXFL,RXRP,RXPR,RXRR
"RTN","PSOSUPRX",11,0)
 K PSOPROFL,PSOE,RXP1,RXPR,PRF,PSOWIN,PSOWINEN K RTE S MW="" W ! S DIR("A")="Select SUSPENDED Rx #: ",DIR(0)="FOA",DIR("?")="Enter the Rx # or wand the barcode. For a list of suspense prescriptions, type '??'",DIR("??")="^D LIST^PSOSUPRX"
"RTN","PSOSUPRX",12,0)
 S POP=0 D ^DIR K DIR G:$D(DIRUT)!('Y) ST S OUT=0 D:Y["-" PSOINST^PSOSUPAT G:OUT LU
"RTN","PSOSUPRX",13,0)
 S:Y'["-" X=Y S:Y["-" Y=$P(Y,"-",2),X=$P(^PSRX(+Y,0),"^") K Y G:$G(X)="" ST K DIC W ! D  S DIC="^PS(52.5,",DIC(0)="ZQE" D ^DIC K DIC,PSOSPINT W ! G:$D(DTOUT)!($D(DUOUT)) ST G LU:Y<0 S RXREC=+Y(0),SFN=+Y
"RTN","PSOSUPRX",14,0)
 .S PSOSPINT=X S DIC("S")="I $D(^PSRX(+$P(^PS(52.5,+Y,0),""^""),0)),$P($G(^(""STA"")),""^"")=5,$P($G(^(0)),""^"")=PSOSPINT"
"RTN","PSOSUPRX",15,0)
 S PSOPLLRX=$G(RXREC) I PSOPLLRX D PSOL^PSSLOCK(PSOPLLRX) I '$G(PSOMSG) D  K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR K PSOMSG,PSOPLLRX,X,Y G LU
"RTN","PSOSUPRX",16,0)
 .I $P($G(PSOMSG),"^",2)'="" W !,$P($G(PSOMSG),"^",2),! Q
"RTN","PSOSUPRX",17,0)
 .W !,"Another person is editing this order.",!
"RTN","PSOSUPRX",18,0)
 K PSOMSG
"RTN","PSOSUPRX",19,0)
 S PSOLOUD=1 D:$P($G(^PS(55,$P(Y(0),"^",3),0)),"^",6)'=2 EN^PSOHLUP($P(Y(0),"^",3)) K PSOLOUD
"RTN","PSOSUPRX",20,0)
 I $G(PSODIV),$P($G(^PS(52.5,SFN,0)),"^",6)'=$G(PSOSITE) S PSPOP=0,PSOSAV=Y,PSOSAVO=Y(0) D CKDIV^PSOSUPAT S Y=PSOSAV,Y(0)=PSOSAVO K PSOSAV,PSOSAVO,PSOPRFLG D:PSPOP UNLK G:PSPOP LU
"RTN","PSOSUPRX",21,0)
 D CHKDEAD W:DEAD !!,?10,$G(PSDNAME)," DIED ",$G(PSDDDATE) D:'DEAD BEG D:$G(PSOQFLAG) RESET^PSOSUPAT K PSOSPEC,PSOQFLAG,PSOPULL,PSODELE D UNLK G LU
"RTN","PSOSUPRX",22,0)
EXIT K ASKED,CBD,CNT,COM,DA,DEAD,DEL,PSODELE,DFN,DIRUT,DR,DTOUT,DUOUT,HOLDDFN,HDSFN,JJ,MW,OLD,OUT,PDUZ,PSODFN,TM,TM1,RXLTOP,RXRR,PSOGET,PSOGETF,PSOGETFN
"RTN","PSOSUPRX",23,0)
 K PPL,PSOPULL,PSOWIN,PSOWINEN,PRF,PSODBQ,PSPOP,PSOQFLAG,PSOPROFL,PSOSPEC,RF,RFCNT,RTE,RX,RXP1,RXPR,RXREC,SA,SFN,STOP,SUSPT,VADM,ZTSK,RXFL
"RTN","PSOSUPRX",24,0)
 K X,Y,Z,PSOPRFLG,PSDDDATE,PSDNAME,ZZZZ,RXRP Q
"RTN","PSOSUPRX",25,0)
CHKDEAD S (DFN,PSODFN)=+$P(Y(0),"^",3) D DEM^VADPT S PSDNAME=$G(VADM(1)) I VADM(1)="" W !?10,"PATIENT UNKNOWN" S DEAD=0 Q
"RTN","PSOSUPRX",26,0)
 I VADM(6)="" S DEAD=0 Q
"RTN","PSOSUPRX",27,0)
 S PSDDDATE=$P(VADM(6),"^",2),(PDUZ,PSOCLC)=DUZ F ZZZZ=0:0 S ZZZZ=$O(^PS(55,DFN,"P",ZZZZ)) Q:'ZZZZ  I $D(^PS(55,DFN,"P",ZZZZ,0)),$P($G(^(0)),"^") S (DA,RXREC)=$P(^(0),"^") I $O(^PS(52.5,"B",DA,0)) D DEAD
"RTN","PSOSUPRX",28,0)
 Q
"RTN","PSOSUPRX",29,0)
DEAD S HOLD=DA,REA="C",COM="Died ("_$G(PSDDDATE)_")",DA=RXREC,DEAD=1 D CAN^PSOCAN S DA=HOLD K HOLD,REA Q
"RTN","PSOSUPRX",30,0)
BEG S PSOSPEC=1,PDUZ=DUZ I +$G(^PS(52.5,SFN,"P")) W !,">>> Rx #",$P(^PSRX(+$P(^(0),"^"),0),"^")," ALREADY PRINTED FROM SUSPENSE.",!,?5,"USE THE REPRINT OPTION TO REPRINT LABEL.",! Q
"RTN","PSOSUPRX",31,0)
 I +$P($G(^PSRX(RXREC,2)),"^",6)<DT,+$P($G(^("STA")),"^")<11 D  S DIE=52,DA=RXREC,DR="100///"_11 D ^DIE S DA=SFN,DIK="^PS(52.5," D ^DIK K DIE,DA,DIK W !,"Rx # "_$P(^PSRX(RXREC,0),"^")_" has expired!" F PSOE=1:1:3 W "." H 1
"RTN","PSOSUPRX",32,0)
 .D EX^PSOSUTL
"RTN","PSOSUPRX",33,0)
 I '$D(^PS(52.5,SFN,0)) K PSOE Q
"RTN","PSOSUPRX",34,0)
 D ICN^PSODPT(+$P(^PSRX(RXREC,0),"^",2))
"RTN","PSOSUPRX",35,0)
 S RXFL(RXREC)=$P($G(^PS(52.5,SFN,0)),"^",13)
"RTN","PSOSUPRX",36,0)
 S HDSFN=SFN,(PPL,DA)=RXREC S:$P(^PS(52.5,SFN,0),"^",5) (RXP1,RXPR(RXREC))=$P(^(0),"^",5)
"RTN","PSOSUPRX",37,0)
 S:$P(^PS(52.5,SFN,0),"^",12) RXRP(RXREC)=1 D QUES Q:$G(PSOQFLAG)
"RTN","PSOSUPRX",38,0)
 S (PSOPULL,PSODBQ,PSONOPRT)=1,RXLTOP=1 D WIND D Q^PSORXL S PPL=RXREC
"RTN","PSOSUPRX",39,0)
 I '$G(PSOQFLAG) W !!,"LABEL QUEUED TO PRINT",! K RX
"RTN","PSOSUPRX",40,0)
 I '$G(PSOQFLAG) D PRF D:'$G(PSOQFLAG)  S PSOQFLAG=0
"RTN","PSOSUPRX",41,0)
 .S:'$G(PSOPROFL) PSOPRFLG=1 W:$G(PSOPROFL) !!,"PROFILE QUEUED TO PRINT"
"RTN","PSOSUPRX",42,0)
 K PSONOPRT,RXPR,RXP1
"RTN","PSOSUPRX",43,0)
 S PPL=RXREC
"RTN","PSOSUPRX",44,0)
 ;call to bingo board
"RTN","PSOSUPRX",45,0)
 S:$G(SUSROUTE) BBRX(1)=PPL
"RTN","PSOSUPRX",46,0)
 D:$G(BINGRTE)&($D(DISGROUP))&('$G(PSOQFLAG)) ^PSOBING1 K BINGRTE,BBRX
"RTN","PSOSUPRX",47,0)
 Q
"RTN","PSOSUPRX",48,0)
QUES I '$D(RTE) W ! K DIR S DIR("A")="Select routing for Rx(s)",DIR(0)="S^M:MAIL;W:WINDOW",DIR("B")="WINDOW" D ^DIR K DIR S (RTE,MW)=Y I Y["^"!($D(DTOUT)) W !!?5,"Nothing pulled from suspense!",! S PSOQFLAG=1 Q
"RTN","PSOSUPRX",49,0)
 S PSOGET="M" D GETMW^PSOSUPOE S RXRR(RXREC)=$S($P(^PS(52.5,SFN,0),"^",4)="W":"W",1:"M")_"^"_$P($G(^PSRX(RXREC,"MP")),"^")_"^"_$G(PSOGETF)_"^"_$G(PSOGETFN)_"^"_$S($G(PSOGET)="W":"W",1:"M")
"RTN","PSOSUPRX",50,0)
 S:$G(MW)="W" SUSROUTE=1 S $P(^PS(52.5,SFN,0),"^",4)=$G(MW) D:$G(MW)="W"  Q:$G(PSOQFLAG)  D MAIL^PSOSUPAT
"RTN","PSOSUPRX",51,0)
 .I '$G(PSOWIN),$P(PSOPAR,"^",12) S DA=RXREC,DIE="^PSRX(",DR=35 D ^DIE S:$D(Y)!($D(DTOUT)) PSOQFLAG=1 Q:$G(PSOQFLAG)  S PSOWIN=1,PSOWINEN=$P($G(^PSRX(RXREC,"MP")),"^") Q
"RTN","PSOSUPRX",52,0)
 I '$D(PSODELE)!($G(PSOSPEC)) W !! S DIR("A")="Pull Rx(s) and delete from suspense",DIR("B")="Y",DIR(0)="Y" D  D ^DIR K DIR S PSODELE=Y I Y'=1 W $C(7),!!?5,"Nothing pulled from suspense!",! S PSOQFLAG=1 K PSODELE Q
"RTN","PSOSUPRX",53,0)
 .S DIR("?",1)="Enter Yes to pull selected Rx(s) from suspense. Since Rx(s) pulled early from",DIR("?",2)="suspense are not associated with a printed batch, these Rx(s) cannot be"
"RTN","PSOSUPRX",54,0)
 .S DIR("?",3)="reprinted from suspense using the 'Reprint batches from Suspense' option.",DIR("?")="Therefore, any Rx(s) pulled early from suspense will be deleted from suspense."
"RTN","PSOSUPRX",55,0)
 S HDSFN=SFN
"RTN","PSOSUPRX",56,0)
 ;
"RTN","PSOSUPRX",57,0)
 ; - Submitting Rx to ECME for 3rd Party Billing
"RTN","PSOSUPRX",58,0)
 N RFL S RFL=RXFL(RXREC) I RFL="" S RFL=$$LSTRFL^PSOBPSU1(RXREC)
"RTN","PSOSUPRX",59,0)
 D ECMESND^PSOBPSU1(RXREC,RFL,,"PE")
"RTN","PSOSUPRX",60,0)
 I $$FIND^PSOREJUT(RXREC,RFL),$$HDLG^PSOREJU1(RXREC,RFL,"79,88","PE","IOQ","I")="Q" S PSOQFLAG=1 Q
"RTN","PSOSUPRX",61,0)
 ;
"RTN","PSOSUPRX",62,0)
 Q
"RTN","PSOSUPRX",63,0)
PRF S:'$D(DFN) DFN=+$P(^PS(52.5,SFN,0),"^",3) I $P(PSOPAR,"^",8),'$D(^PSRX(RXREC,1)),'$D(PRF(DFN)),'$G(RXP1) S PSOPROFL=1,HOLDDFN=DFN D ^PSOPRF S DFN=HOLDDFN K HOLDDFN S PRF(DFN)=""
"RTN","PSOSUPRX",64,0)
 Q
"RTN","PSOSUPRX",65,0)
LIST S X="?",DIC("S")="I $D(^PSRX(+$P(^PS(52.5,+Y,0),""^""),0)),$P($G(^(""STA"")),""^"")=5",DIC="^PS(52.5,",DIC(0)="ZQ" D ^DIC K DIC W ! Q:Y<0!($D(DTOUT))  Q
"RTN","PSOSUPRX",66,0)
NEXT S PSOX("IRXN")=RX D NEXT^PSOUTIL(.PSOX) S NEXT=$P(PSOX("RX3"),"^",2)
"RTN","PSOSUPRX",67,0)
 S DA=RX,DIE=52,DR="102///"_NEXT D ^DIE K DIE Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOSUPRX",68,0)
 K NEXT,PSOX Q
"RTN","PSOSUPRX",69,0)
WIND ;
"RTN","PSOSUPRX",70,0)
 N RRT,RRTT,XXXX,JJJJ,PSINTRX,RTETEST,PSOPSO,SSSS
"RTN","PSOSUPRX",71,0)
 S BINGRTE=0
"RTN","PSOSUPRX",72,0)
 S RRT=1 F XXXX=1:1:$L(PPL) S RRTT=$E(PPL,XXXX) I RRTT="," S RRT=RRT+1
"RTN","PSOSUPRX",73,0)
 F JJJJ=1:1:RRT Q:$G(BINGRTE)  S PSINTRX=$P(PPL,",",JJJJ) I $D(^PSRX(+PSINTRX,0)) D
"RTN","PSOSUPRX",74,0)
 .I $G(RXPR(PSINTRX)) S RTETEST=$P($G(^PSRX(PSINTRX,"P",RXPR(PSINTRX),0)),"^",2) S:RTETEST="W" BINGRTE=1 Q
"RTN","PSOSUPRX",75,0)
 .S PSOPSO=0 F SSSS=0:0 S SSSS=$O(^PSRX(PSINTRX,1,SSSS)) Q:'SSSS  S PSOPSO=SSSS
"RTN","PSOSUPRX",76,0)
 .I 'PSOPSO S RTETEST=$P($G(^PSRX(PSINTRX,0)),"^",11) S:RTETEST="W" BINGRTE=1 Q
"RTN","PSOSUPRX",77,0)
 .I PSOPSO S RTETEST=$P($G(^PSRX(PSINTRX,1,PSOPSO,0)),"^",2) S:RTETEST="W" BINGRTE=1 Q
"RTN","PSOSUPRX",78,0)
 Q
"RTN","PSOSUPRX",79,0)
UNLK ;Unlock prescription
"RTN","PSOSUPRX",80,0)
 Q:'$G(PSOPLLRX)
"RTN","PSOSUPRX",81,0)
 D PSOUL^PSSLOCK(PSOPLLRX)
"RTN","PSOSUPRX",82,0)
 K PSOPLLRX
"RTN","PSOVER1")
0^54^B52134870
"RTN","PSOVER1",1,0)
PSOVER1 ;BHAM ISC/SAB - verify one rx ;3/9/05 12:53pm
"RTN","PSOVER1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**32,46,90,131,202,207,148**;DEC 1997
"RTN","PSOVER1",3,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSOVER1",4,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOVER1",5,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOVER1",6,0)
 ;External reference to PSSORPH is supported by DBIA 3234
"RTN","PSOVER1",7,0)
 ;External references to ^ORRDI1 supported by DBIA 4659
"RTN","PSOVER1",8,0)
 ;External reference ^XTMP("ORRDI" supported by DBIA 4660
"RTN","PSOVER1",9,0)
REDO ;
"RTN","PSOVER1",10,0)
 S (DRG,PSODRUG("NAME"))=$P(^PSDRUG(+$P(^PSRX(PSONV,0),"^",6),0),"^"),PSODRUG("VA CLASS")=$P(^(0),"^",2)
"RTN","PSOVER1",11,0)
 I '$D(PSODFN) S PSODFN=$P(^PSRX(PSONV,0),"^",2)
"RTN","PSOVER1",12,0)
 S (STA,DNM)="",PSDPSTOP=0,$P(PSONULN,"-",79)="-" F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S DNM=$O(PSOSD(STA,DNM)) Q:DNM=""  K PSZZZDUP I $P(PSOSD(STA,DNM),"^",2)<10 D
"RTN","PSOVER1",13,0)
 .I STA="ZNONVA" D NVA Q
"RTN","PSOVER1",14,0)
 .I PSODRUG("NAME")=$P(DNM,"^")&(PSONV'=$P(PSOSD(STA,DNM),"^")) S PSZZZDUP=1 K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" W ! D ^DIR K DIR S PSDTSTOP=1
"RTN","PSOVER1",15,0)
 .I PSODRUG("VA CLASS")]"",$E(PSODRUG("VA CLASS"),1,4)=$E($P(PSOSD(STA,DNM),"^",5),1,4),PSODRUG("NAME")'=$P(DNM,"^") K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" W ! D ^DIR K DIR D CLS^PSODRDUP S PSDTSTOP=1
"RTN","PSOVER1",16,0)
 .I $G(PSZZZDUP),$G(PSVFLAG),$P($G(^PSRX($P(PSOSD(STA,DNM),"^"),"STA")),"^")=12,$D(^PS(52.4,$P(PSOSD(STA,DNM),"^"),0)) S DA=$P(PSOSD(STA,DNM),"^"),DIK="^PS(52.4," D ^DIK K DIK
"RTN","PSOVER1",17,0)
 .I $G(PSZZZDUP),$G(PSVFLAG),$P($G(^PSRX($P(PSOSD(STA,DNM),"^"),"STA")),"^")'=12 S PSZZQUIT=1
"RTN","PSOVER1",18,0)
 K MSG I $G(PSZZQUIT),$G(PSVFLAG) K PSZZQUIT,PSODRUG,PSODFN,PSZZZDUP,DNM,PSDTSTOP D CLEAN Q
"RTN","PSOVER1",19,0)
 D REMOTE
"RTN","PSOVER1",20,0)
 K PSODRUG,PSODFN,PSZZZDUP,DNM,PSZZQUIT
"RTN","PSOVER1",21,0)
ALLR ;Allergy check
"RTN","PSOVER1",22,0)
 G:'$P($G(^PSRX(PSONV,3)),"^",6) EDIT
"RTN","PSOVER1",23,0)
 I '$G(PSDTSTOP) K DIR S DIR(0)="E" D ^DIR K DIR I $D(DTOUT)!($D(DUOUT)) K PSDTSTOP G OUT
"RTN","PSOVER1",24,0)
 W !!,"A Drug-Allergy Reaction exists for this medication!",!!,"***SIGNIFICANT*** Allergy Reaction"
"RTN","PSOVER1",25,0)
 W !,"Drug: ",$P($G(^PSDRUG(+$P($G(^PSRX(PSONV,0)),"^",6),0)),"^")
"RTN","PSOVER1",26,0)
 I $O(^PSRX(PSONV,"DAI",0)) W !?6,"Ingredients: " D
"RTN","PSOVER1",27,0)
 .F PSPPP=0:0 S PSPPP=$O(^PSRX(PSONV,"DAI",PSPPP)) Q:'PSPPP  I $G(^(PSPPP,0))'="" W:$X+$L($G(^PSRX(PSONV,"DAI",PSPPP,0)))+2>IOM !?19 W $G(^PSRX(PSONV,"DAI",PSPPP,0))_", "
"RTN","PSOVER1",28,0)
 W ! K DIR,PSPPP S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to intervene?" D ^DIR K DIR I X["^"!($D(DTOUT))!($D(DUOUT)) K PSDTSTOP G OUT
"RTN","PSOVER1",29,0)
 I Y S PSORX("INTERVENE")=0 D EN1^PSORXI(PSONV)
"RTN","PSOVER1",30,0)
EDIT I $G(PKI1)=2 D DCV1^PSOPKIV1 G OUT
"RTN","PSOVER1",31,0)
 K PSDTSTOP S DIR("A")="EDIT",DIR("B")="N",DIR(0)="SB^Y:YES;N:NO;P:PROFILE",DIR("?")="Enter Y to change this RX, P to see a profile, or N to procede with verification"
"RTN","PSOVER1",32,0)
 D ^DIR K DIR I Y="Y",$G(PSOACT)]"" S VALMBCK="R" G OUT
"RTN","PSOVER1",33,0)
 I $D(DIRUT),$G(PSOCLK) S PSOCQ=1 G OUT
"RTN","PSOVER1",34,0)
 I $D(DIRUT),$G(PSOACT)]"" S VALMBCK="R" G OUT
"RTN","PSOVER1",35,0)
 G VERIFY:Y="N",PROF:Y="P",OUT:"YNP"'[$E(Y)
"RTN","PSOVER1",36,0)
CHANGE S DA=PSONV,(PSRX1,PSRX2)=$P(^PSRX(PSONV,0),"^",6)
"RTN","PSOVER1",37,0)
 S DEA1=1,DEA2=0,PSDOLD=+DA,DIE="^PSRX(",DR="3;7;8;9;4;5;12;1;22;11;"_$S($P(PSOPAR,"^",12):"35;",1:"")_$S($P(PSOPAR,"^",15):"10.6",1:"")_";@2" D ^DIE
"RTN","PSOVER1",38,0)
 ;I PSRX1'=PSRX2,DEA1'=DEA2 S DR="6////"_PSRX1 D ^DIE
"RTN","PSOVER1",39,0)
 D EXPIRE K DIE,DR,DEA1,DEA2,P(5),PSRX1,PSRX2
"RTN","PSOVER1",40,0)
 K PSD(PSDOLD) S PSDNEW=$P(^PSDRUG($P(^PSRX(PSONV,0),"^",6),0),"^")_"^"_PSONV,PSD(PSDNEW)=PSONV_"^*^1^"_$P(^PSDRUG($P(^PSRX(PSONV,0),"^",6),0),"^",2)
"RTN","PSOVER1",41,0)
 S DA=PSONV D ^PSORXPR
"RTN","PSOVER1",42,0)
 G EDIT:PSDNEW=PSDOLD,REDO
"RTN","PSOVER1",43,0)
PROF I '$D(PSOSD) W !,$C(7),"This patient has no other prescriptions on file",!! G EDIT Q
"RTN","PSOVER1",44,0)
 D ^PSODSPL G EDIT Q
"RTN","PSOVER1",45,0)
 ;
"RTN","PSOVER1",46,0)
EXPIRE S RX0=^PSRX(DA,0),X1=$P($P(RX0,"^",13),"."),X2=$P(RX0,"^",9)+1*$P(RX0,"^",8),X2=$S($P(RX0,"^",8)=X2:X2,X2<181:184,X2=360:366,1:X2),X=X1 D:X1&X2 C^%DTC
"RTN","PSOVER1",47,0)
 K ^PS(55,PSDFN,"P","A",+$P(^PSRX(DA,2),"^",6),DA) S ^PS(55,PSDFN,"P","A",X,DA)="",$P(^PSRX(DA,2),"^",6)=X,$P(^PS(52.4,DA,0),"^",7)=X Q
"RTN","PSOVER1",48,0)
VERIFY G:'$P(PSOPAR,"^",2) VERY
"RTN","PSOVER1",49,0)
 S DIR("A")="VERIFY FOR "_PSONAM_" ? (Y/N/Delete/Quit): ",DIR("B")="Y",DIR(0)="SA^Y:YES;N:NO;D:DELETE;Q:QUIT"
"RTN","PSOVER1",50,0)
 S DIR("?",1)="Enter Y (or return) to verify this prescription",DIR("?",2)="N to leave this prescription non-verified and to end this session of verification",DIR("?")="D to delete this prescription"
"RTN","PSOVER1",51,0)
 D ^DIR K DIR G OUT:Y="N",QUIT:"Q^"[$E(Y),DELETE:Y="D"
"RTN","PSOVER1",52,0)
VERY I $G(PKI1)=1 D REA^PSOPKIV1 G:'$D(PKIR) VERIFY
"RTN","PSOVER1",53,0)
 K ^PSRX(PSONV,"DAI") S $P(^PSRX(PSONV,3),"^",6)=""
"RTN","PSOVER1",54,0)
 K ^PSRX(PSONV,"DRI"),SPFL
"RTN","PSOVER1",55,0)
 I '$O(^PSRX(PSONV,6,0)) D  I $D(DUOUT)!($D(DTOUT)) W !!,"Rx: "_$P(^PSRX(DA,0),"^")_" not Verified!!",! H 2 G OUT
"RTN","PSOVER1",56,0)
 .W !!,"Dosing Instructions Missing. Please add!",!
"RTN","PSOVER1",57,0)
 .I $P($G(^PSRX(PSONV,"SIG")),"^")]"",'$P($G(^("SIG")),"^",2) W "SIG: "_$P(^PSRX(PSONV,"SIG"),"^"),!
"RTN","PSOVER1",58,0)
 .I $P($G(^PSRX(PSONV,"SIG")),"^",2),$O(^PSRX(PSONV,"SIG1",0)) D  K I
"RTN","PSOVER1",59,0)
 ..W "SIG: " F I=0:0 S I=$O(^PSRX(PSONV,"SIG1",I)) Q:'I  W ^PSRX(PSONV,"SIG1",I,0),!
"RTN","PSOVER1",60,0)
 .S DA=PSONV,PSOVER=1 K DIR,DIRUT,DUOUT,DTOUT
"RTN","PSOVER1",61,0)
 .S PSODRUG("IEN")=$P(^PSRX(DA,0),"^",6),PSODFN=$P(^(0),"^",2),PSORXED("IRXN")=DA,PSODRUG("OI")=$P(^PSRX(DA,"OR1"),"^")
"RTN","PSOVER1",62,0)
 .D DOSE^PSSORPH(.DOSE,PSODRUG("IEN"),"O",PSODFN),^PSOORED3
"RTN","PSOVER1",63,0)
 .K PSODFN,PSODRUG("IEN"),DOSE,PSOVER
"RTN","PSOVER1",64,0)
 .I '$G(ENT) S DUOUT=1
"RTN","PSOVER1",65,0)
 .Q:$D(DUOUT)!($D(DTOUT))
"RTN","PSOVER1",66,0)
 .K DIR,DIRUT,DUOUT,DTOUT S DIE=52,DR=114 D ^DIE K DIE,DR,DTOUT
"RTN","PSOVER1",67,0)
 .I X'="" D SIG^PSOHELP D:$G(INS1)]"" EN^DDIOL($E(INS1,2,9999999)) S PSORXED("SIG",1)=$E(INS1,2,9999999)
"RTN","PSOVER1",68,0)
 .D EN^PSOFSIG(.PSORXED,1),UDSIG^PSOORED3 H 2
"RTN","PSOVER1",69,0)
 S DA=PSONV,$P(^PSRX(DA,2),"^",10)=DUZ I $P(^PSRX(DA,2),"^",2)>DT,$P(PSOPAR,"^",6) S (SPFL1,PSOVER)="",PSORX("FILL DATE")=$P(^(2),"^",2),RXF=0 D UPSUS S PSTRIVER=1 D SUS^PSORXL K PSORX("FILL DATE"),PSTRIVER G KILL
"RTN","PSOVER1",70,0)
 S PSOVER(PSONV)="" S $P(^PSRX(PSONV,"STA"),"^")=0,$P(PSOSD("NON-VERIFIED",DRG),"^",2)=0,PSOSD("ACTIVE",DRG)=PSOSD("NON-VERIFIED",DRG)
"RTN","PSOVER1",71,0)
 I $G(PKI1)=1,$G(PKIR)]"" D ACT^PSOPKIV1(DA)
"RTN","PSOVER1",72,0)
 K PSOSD("NON-VERIFIED",DRG) D EN^PSOHLSN1(PSONV,"SC","CM","")
"RTN","PSOVER1",73,0)
 ;
"RTN","PSOVER1",74,0)
 ; - Calling ECME for claims generation and transmission / REJECT handling
"RTN","PSOVER1",75,0)
 N ACTION
"RTN","PSOVER1",76,0)
 I $$SUBMIT^PSOBPSUT(PSONV) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSOVER1",77,0)
 . S ACTION="" D ECMESND^PSOBPSU1(PSONV,,,$S($O(^PSRX(PSONV,1,0)):"RF",1:"OF"))
"RTN","PSOVER1",78,0)
 . I $$FIND^PSOREJUT(PSONV) D
"RTN","PSOVER1",79,0)
 . . S ACTION=$$HDLG^PSOREJU1(PSONV,0,"79,88","OF","IOQ","I")
"RTN","PSOVER1",80,0)
 ;
"RTN","PSOVER1",81,0)
KILL S DA=PSONV,DIK="^PS(52.4," D ^DIK K DA,DIK D DCORD^PSONEW2
"RTN","PSOVER1",82,0)
OUT K DIRUT,DTOUT,DUOUT,UPFLAGX D CLEAN Q
"RTN","PSOVER1",83,0)
DELETE K UPFLAGX D DELETE^PSOVER2 G:$G(UPFLAGX) OUT K PSOSD("NON-VERIFIED",$G(DRG)) Q
"RTN","PSOVER1",84,0)
QUIT S PSOQUIT="" D CLEAN Q
"RTN","PSOVER1",85,0)
UPSUS S $P(PSOSD("NON-VERIFIED",DRG),"^",2)=5,PSOSD("ACTIVE",DRG)=PSOSD("NON-VERIFIED",DRG) K PSOSD("NON-VERIFIED",DRG) D EN^PSOHLSN1(PSONV,"SC","CM","")
"RTN","PSOVER1",86,0)
 Q
"RTN","PSOVER1",87,0)
CLEAN ;cleans up tmp("psorxdc") global
"RTN","PSOVER1",88,0)
 I $O(^TMP("PSORXDC",$J,0)) F RORD=0:0 S RORD=$O(^TMP("PSORXDC",$J,RORD)) Q:'RORD  D
"RTN","PSOVER1",89,0)
 .D PSOUL^PSSLOCK(RORD_$S($P(^TMP("PSORXDC",$J,RORD,0),"^")="P":"S",1:""))
"RTN","PSOVER1",90,0)
 .W !,$S($P(^TMP("PSORXDC",$J,RORD,0),"^")=52:"Prescription",1:"Pending Order")_" #"_$S($P(^TMP("PSORXDC",$J,RORD,0),"^")=52:$P(^PSRX(RORD,0),"^"),1:RORD)_" NOT Discontinued."
"RTN","PSOVER1",91,0)
 K ^TMP("PSORXDC",$J),RORD
"RTN","PSOVER1",92,0)
 Q
"RTN","PSOVER1",93,0)
KV1 ;
"RTN","PSOVER1",94,0)
 K PSOANSQD,DRET,LST,PSOQUIT,PSODRUG,PSONEW,SIG,PSODIR,PHI,PRC,ORCHK,ORDRG,PSOSIGFL,PSORX("ISSUE DATE"),PSORX("FILL DATE"),CLOZPAT
"RTN","PSOVER1",95,0)
KV K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOVER1",96,0)
 Q
"RTN","PSOVER1",97,0)
NVA ;
"RTN","PSOVER1",98,0)
 I $P(PSOSD(STA,DNM),"^",11) D NVA^PSODRDU1 Q
"RTN","PSOVER1",99,0)
 N PSOOI,CLASS,FLG,X,Y,RXREC,IFN
"RTN","PSOVER1",100,0)
 S (Y,FLG)=""
"RTN","PSOVER1",101,0)
 S RXREC=$P(PSOSD(STA,DNM),"^",10),PSOOI=+$G(^PS(55,DFN,"NVA",RXREC,0)),IFN=RXREC N DNM
"RTN","PSOVER1",102,0)
 F  S Y=$O(^PSDRUG("ASP",PSOOI,Y)) Q:Y=""!(FLG)  S DNM=$P(^PSDRUG(Y,0),"^"),CLASS=$P(^PSDRUG(Y,0),"^",2) I PSODRUG("NAME")=DNM!(CLASS=PSODRUG("VA CLASS")) D DSP^PSODRDU1 S FLG=1 Q
"RTN","PSOVER1",103,0)
 Q
"RTN","PSOVER1",104,0)
REMOTE ; 
"RTN","PSOVER1",105,0)
 K ^TMP($J,"DD"),^TMP($J,"DC"),^TMP($J,"DI"),^TMP($J,"DI"_PSODFN) D
"RTN","PSOVER1",106,0)
 .I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSOVER1",107,0)
 .I '$$HAVEHDR^ORRDI1 Q
"RTN","PSOVER1",108,0)
 .W !,"Now doing remote order checks. Please wait..."
"RTN","PSOVER1",109,0)
 .D REMOTE^PSOORRDI(PSODFN,+$P($G(^PSRX(PSONV,0)),"^",6))
"RTN","PSOVER1",110,0)
 .I $P($G(^XTMP("ORRDI","PSOO",PSODFN,0)),"^",3)<0 W !,"Remote data not available - Only local order checks processed." D PAUSE^PSOORRD2 Q
"RTN","PSOVER1",111,0)
 .I $D(^TMP($J,"DD")) D DUP^PSOORRD2
"RTN","PSOVER1",112,0)
 .I $D(^TMP($J,"DC")) D CLS^PSOORRD2
"RTN","PSOVER1",113,0)
 .I $D(^TMP($J,"DI"_PSODFN)) K ^TMP($J,"DI") M ^TMP($J,"DI")=^TMP($J,"DI"_PSODFN) D DRGINT^PSOORRD2
"RTN","PSOVER1",114,0)
 K ^TMP($J,"DD"),^TMP($J,"DC"),^TMP($J,"DI"),^TMP($J,"DI"_PSODFN)
"RTN","PSOVER1",115,0)
 Q
"RTN","PSOVERC")
0^91^B9313505
"RTN","PSOVERC",1,0)
PSOVERC ;BHAM ISC/DMA,SAB - discontinue duplicate class from verify ; 07/22/95 17:11
"RTN","PSOVERC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**146,223,148**;DEC 1997
"RTN","PSOVERC",3,0)
 W !,$C(7)," *** SAME CLASS *** OF DRUG IN RX # ",$P(^PSRX(+$P(RX0,"^"),0),"^"),"  ",$P(DRG,"^") Q:'$P(PSOPAR,"^",18)
"RTN","PSOVERC",4,0)
 S PTST="" I $D(^PS(55,PSDFN,"PS")) S Z=+^("PS") I $D(^PS(53,Z,0)) S PTST=^(0)
"RTN","PSOVERC",5,0)
DATA S DUPRX0=^PSRX($P(RX0,"^"),0),$P(DUPRX0,"^",15)=+$G(^("STA")),PSRFLS=$P(DUPRX0,"^",9),ISSD=$P(^(0),"^",13),RX0=DUPRX0,RX2=^(2),CAN=$P(DUPRX0,"^",15)'<11 K PSONULN S $P(PSONULN,"-",79)="-"
"RTN","PSOVERC",6,0)
 W !!,$J("Status: ",24) S J=$P(RX0,"^") D STAT^PSOFUNC W ST K RX0,RX2 W ?40,$J("Issued: ",24),$E(ISSD,4,5),"-",$E(ISSD,6,7),"-",$E(ISSD,2,3)
"RTN","PSOVERC",7,0)
 W !,$J("SIG: ",24),$P(DUPRX0,"^",10),!,$J("QTY: ",24),$P(DUPRX0,"^",7),?40,$J("# of refills: ",24),PSRFLS
"RTN","PSOVERC",8,0)
 S PHYS=$S($D(^VA(200,+$P(DUPRX0,"^",4),0)):^(0),1:"UNKNOWN")
"RTN","PSOVERC",9,0)
 W !,$J("Provider: ",24),$P(PHYS,"^"),?40,$J("Refills remaining: ",24),PSRFLS-$S($D(^PSRX($P(RX0,"^"),1,0)):$P(^(0),"^",4),1:0)
"RTN","PSOVERC",10,0)
 S LSTFL=+^PSRX($P(RX0,"^"),3) W !?40,$J("Last filled on: ",24),$E(LSTFL,4,5),"-",$E(LSTFL,6,7),"-",$E(LSTFL,2,3)
"RTN","PSOVERC",11,0)
 W !,PSONULN,! I (CAN)!($P(DUPRX0,"^",15)=12) S CAN=1 Q
"RTN","PSOVERC",12,0)
 I PTST["AUTH ABS",'$P(PSOPAR,"^",5) S X=1 Q
"RTN","PSOVERC",13,0)
ASKC S DIR("A")="Discontinue Prescription #"_$P(DUPRX0,"^")_" ",DIR("B")="N",DIR(0)="SA^1:YES;0:NO",DIR("?")="Enter Y to discontinue this Prescription." D ^DIR K DIR
"RTN","PSOVERC",14,0)
 I 'Y W "  Prescription was not discontinued..." Q
"RTN","PSOVERC",15,0)
CANOLD S $P(^PSRX($P(RX0,"^"),"STA"),"^")=12,$P(^PSRX($P(RX0,"^"),3),"^",5)=$S($P($G(^PSRX($P(RX0,"^"),3)),"^"):$P(^(3),"^"),1:DT)
"RTN","PSOVERC",16,0)
 S PSMSG="Discontinued by new prescription",PSREA="C",PSRXREF=0 N PSOVRCTP S PSOVRCTP=$P(RX0,"^") D REVERSE^PSOBPSU1(PSOVRCTP,,"DC",7),CAN^PSOTPCAN(PSOVRCTP) D ACTLOG
"RTN","PSOVERC",17,0)
 S PSI="",$P(PSD(DRG),"^",3)=12 W "  Prescription has been discontinued." S DA=$O(^PS(52.5,"B",$P(RX0,"^"),0)) I DA S PSI=$G(^PS(52.5,DA,"P")),DIK="^PS(52.5," D ^DIK K DIK,DA
"RTN","PSOVERC",18,0)
 D:'PSI SUSPCAN^PSOUTL
"RTN","PSOVERC",19,0)
 Q
"RTN","PSOVERC",20,0)
ACTLOG ;adds activity log for discontinuations
"RTN","PSOVERC",21,0)
 S RXF=0 F JJ=0:0 S JJ=$O(^PSRX($P(RX0,"^"),1,JJ)) Q:'JJ  S RXF=JJ S:JJ>5 RXF=JJ+1
"RTN","PSOVERC",22,0)
 S IR=0 F JJ=0:0 S JJ=$O(^PSRX($P(RX0,"^"),"A",JJ)) Q:'JJ  S IR=JJ
"RTN","PSOVERC",23,0)
 S IR=IR+1,^PSRX($P(RX0,"^"),"A",IR,0)=DT_"^C^"_DUZ_"^"_RXF_"^"_PSMSG K RXF,JJ,IR
"RTN","PSOVERC",24,0)
 Q
"UP",52,52.01,-1)
52^4
"UP",52,52.01,0)
52.01
"UP",52,52.1,-1)
52^1
"UP",52,52.1,0)
52.1
"UP",52,52.25,-1)
52^REJ
"UP",52,52.25,0)
52.25
"UP",52,52.3,-1)
52^A
"UP",52,52.3,0)
52.3
"VER")
8.0^22.0
"^DD",52,52,52.25,0)
REJECT INFO^52.25A^^REJ;0
"^DD",52,52,81,0)
DAW CODE^FX^^EPH;1^D INPUT^PSSDAWUT
"^DD",52,52,81,3)

"^DD",52,52,81,4)
D HLP^PSSDAWUT
"^DD",52,52,81,21,0)
^.001^1^1^3051019^^^^
"^DD",52,52,81,21,1,0)
Dispensed As Written code. This information is used for electronic claim transmission to third party payers (insurance companies).
"^DD",52,52,81,"DT")
3050627
"^DD",52,52,82,0)
RE-TRANSMIT FLAG^S^1:YES;^EPH;2^Q
"^DD",52,52,82,21,0)
^^1^1^3051019^
"^DD",52,52,82,21,1,0)
This field is used to indicate that a claim should be electronically re-transmitted to the 3rd party insurance. It will be primarily used by CMOP and local mail prescriptions.
"^DD",52,52,82,"DT")
3051019
"^DD",52,52.01,4,0)
NDC RECEIVED^F^^0;8^K:$L(X)>20!($L(X)<1) X
"^DD",52,52.01,4,1,0)
^.1^^0
"^DD",52,52.01,4,3)
Answer must be 1-20 characters in length.
"^DD",52,52.01,4,21,0)
^.001^1^1^3030808^^
"^DD",52,52.01,4,21,1,0)
The National Drug Code (NDC) returned for this prescription.
"^DD",52,52.01,4,"DT")
3050607
"^DD",52,52.01,12,0)
NDC SENT^F^^0;9^K:$L(X)>20!($L(X)<1) X
"^DD",52,52.01,12,3)
Answer must be 1-20 characters in length
"^DD",52,52.01,12,21,0)
^^1^1^3050323^
"^DD",52,52.01,12,21,1,0)
The National Drug Code (NDC) sent for this prescription.
"^DD",52,52.01,12,"DT")
3050323
"^DD",52,52.1,81,0)
DAW CODE^FX^^EPH;1^D INPUT^PSSDAWUT
"^DD",52,52.1,81,3)

"^DD",52,52.1,81,4)
D HLP^PSSDAWUT
"^DD",52,52.1,81,21,0)
^.001^1^1^3051019^^^^
"^DD",52,52.1,81,21,1,0)
Dispensed As Written code. This information is used for NCPDP electronic claim transmission to third party payers (insurance companies).
"^DD",52,52.1,81,"DT")
3050627
"^DD",52,52.1,82,0)
RE-TRANSMIT FLAG^S^1:YES;^EPH;2^Q
"^DD",52,52.1,82,21,0)
^^1^1^3051019^
"^DD",52,52.1,82,21,1,0)
This field is used to indicate that a claim should be electronically re-transmitted to the 3rd party insurance. It will be primarily used by CMOP and local mail prescriptions.
"^DD",52,52.1,82,"DT")
3051019
"^DD",52,52.25,0)
REJECT INFO SUB-FIELD^^23^24
"^DD",52,52.25,0,"DIK")
PSOXZA
"^DD",52,52.25,0,"DT")
3051114
"^DD",52,52.25,0,"IX","B",52.25,.01)

"^DD",52,52.25,0,"NM","REJECT INFO")

"^DD",52,52.25,0,"UP")
52
"^DD",52,52.25,.01,0)
NCPDP REJECT CODE^RFX^^0;1^K:$L(X)>4!($L(X)<1) X S DIC(0)="QM",DIC="^BPSF(9002313.93," D ^DIC S X=$P(Y,U,2) K:Y<0 X
"^DD",52,52.25,.01,1,0)
^.1
"^DD",52,52.25,.01,1,1,0)
52.25^B
"^DD",52,52.25,.01,1,1,1)
S ^PSRX(DA(1),"REJ","B",$E(X,1,30),DA)=""
"^DD",52,52.25,.01,1,1,2)
K ^PSRX(DA(1),"REJ","B",$E(X,1,30),DA)
"^DD",52,52.25,.01,3)
Answer must be 1-4 characters in length.
"^DD",52,52.25,.01,21,0)
^.001^1^1^3050629^^
"^DD",52,52.25,.01,21,1,0)
NCPDP Reject Code that indicates the reason for the claim rejection for this prescription.
"^DD",52,52.25,.01,23,0)
^.001^1^1^3050629^^^
"^DD",52,52.25,.01,23,1,0)
Although this fields does not point to the BPS NCPDP REJECT CODES file (#9002313.93), the value should have a corresponding entry in that file.
"^DD",52,52.25,.01,"DT")
3050629
"^DD",52,52.25,1,0)
DATE/TIME DETECTED^D^^0;2^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",52,52.25,1,3)
Date/time when the reject was detected by Outpatient Pharmacy or CMOP.
"^DD",52,52.25,1,21,0)
^^1^1^3050616^
"^DD",52,52.25,1,21,1,0)
Date/Time when the reject was detected by Outpatient Pharmacy.
"^DD",52,52.25,1,"DT")
3051213
"^DD",52,52.25,2,0)
PAYER MESSAGE^F^^1;1^K:$L(X)>140!($L(X)<1) X
"^DD",52,52.25,2,3)
Answer must be 1-140 characters in length
"^DD",52,52.25,2,21,0)
^.001^1^1^3050616^^^^
"^DD",52,52.25,2,21,1,0)
Message from the 3r party payer regarding the rejection of the claim.
"^DD",52,52.25,2,"DT")
3050616
"^DD",52,52.25,3,0)
REASON^F^^1;2^K:$L(X)>100!($L(X)<1) X
"^DD",52,52.25,3,3)
Answer must be 1-100 characters in length
"^DD",52,52.25,3,21,0)
^^1^1^3050616^
"^DD",52,52.25,3,21,1,0)
Reason why the claim is being rejected by the 3rd party payer.
"^DD",52,52.25,3,"DT")
3050419
"^DD",52,52.25,4,0)
PHARMACIST^P200'^VA(200,^0;3^Q
"^DD",52,52.25,4,3)
Pharmacist using the Outpatient Pharmacy appliction when the REJECT was detected.
"^DD",52,52.25,4,21,0)
^^1^1^3050616^
"^DD",52,52.25,4,21,1,0)
Pharmacist using the application when the reject was detected.
"^DD",52,52.25,4,"DT")
3050419
"^DD",52,52.25,5,0)
FILL NUMBER^NJ2,0^^0;4^K:+X'=X!(X>12)!(X<0)!(X?.E1"."1.N) X
"^DD",52,52.25,5,3)
Type a number between 0 and 12, 0 Decimal Digits
"^DD",52,52.25,5,21,0)
^^1^1^3050616^
"^DD",52,52.25,5,21,1,0)
This field is used to indicate which fill the reject is related to.
"^DD",52,52.25,5,"DT")
3050419
"^DD",52,52.25,6,0)
GROUP NAME^F^^2;1^K:$L(X)>30!($L(X)<1) X
"^DD",52,52.25,6,3)
Answer must be 1-30 characters in length
"^DD",52,52.25,6,21,0)
^^1^1^3050616^
"^DD",52,52.25,6,21,1,0)
This is the patient's insurance group name.
"^DD",52,52.25,6,"DT")
3050616
"^DD",52,52.25,7,0)
PLAN CONTACT^F^^2;2^K:$L(X)>30!($L(X)<1) X
"^DD",52,52.25,7,3)
Answer must be 1-30 characters in length
"^DD",52,52.25,7,21,0)
^^1^1^3050616^
"^DD",52,52.25,7,21,1,0)
This is the patient's insurance company contact information.
"^DD",52,52.25,7,"DT")
3050616
"^DD",52,52.25,8,0)
PLAN PREVIOUS FILL DATE^D^^2;3^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",52,52.25,8,3)
(No range limit on date)
"^DD",52,52.25,8,21,0)
^^1^1^3050616^
"^DD",52,52.25,8,21,1,0)
In case of a REFILL TOO SOON reject (#79) and the payer returns the last date the prescription was filled, it will be stored on this field.
"^DD",52,52.25,8,"DT")
3050502
"^DD",52,52.25,9,0)
STATUS^S^0:OPEN/UNRESOLVED;1:CLOSED/RESOLVED;^0;5^Q
"^DD",52,52.25,9,3)
Status of the REJECT. The null value is the same as 0 (zero).
"^DD",52,52.25,9,21,0)
^^1^1^3050616^
"^DD",52,52.25,9,21,1,0)
This field indicates whether the reject is OPEN/UNRESOLVED or CLOSED/RESOLVED.
"^DD",52,52.25,9,"DT")
3050419
"^DD",52,52.25,10,0)
CLOSED DATE/TIME^D^^0;6^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",52,52.25,10,3)
Date/time the Third Party Reject was closed (resolved) by the user.
"^DD",52,52.25,10,21,0)
^^1^1^3050616^
"^DD",52,52.25,10,21,1,0)
Date/Time when the reject was marked CLOSED/RESOLVED.
"^DD",52,52.25,10,"DT")
3050419
"^DD",52,52.25,11,0)
CLOSED BY^P200'^VA(200,^0;7^Q
"^DD",52,52.25,11,3)
User responsible for closing (resolving) the Third Party Reject.
"^DD",52,52.25,11,21,0)
^^1^1^3050616^
"^DD",52,52.25,11,21,1,0)
User responsible for marking the reject CLOSED/RESOLVED.
"^DD",52,52.25,11,"DT")
3050419
"^DD",52,52.25,12,0)
CLOSE REASON^S^1:CLAIM RE-SUBMITTED;2:RX ON HOLD;3:RX SUSPENDED;4:RX RETURNED TO STOCK;5:RX DELETED;6:IGNORED - NO RESUBMISSION;7:RX DISCONTINUED;8:RX EDITED;99:OTHER;^0;8^Q
"^DD",52,52.25,12,21,0)
^^1^1^3050616^
"^DD",52,52.25,12,21,1,0)
This field indicates the reason for marking the reject CLOSED/RESOLVED.
"^DD",52,52.25,12,"DT")
3050708
"^DD",52,52.25,13,0)
CLOSE COMMENTS^F^^3;1^K:$L(X)>100!($L(X)<1) X
"^DD",52,52.25,13,3)
Answer must be 1-100 characters in length
"^DD",52,52.25,13,21,0)
^^1^1^3050616^
"^DD",52,52.25,13,21,1,0)
User entered comments.
"^DD",52,52.25,13,"DT")
3050419
"^DD",52,52.25,14,0)
REASON FOR SERVICE CODE^F^^0;9^K:$L(X)>4!($L(X)<1) X
"^DD",52,52.25,14,3)
Answer must be 1-4 characters in length
"^DD",52,52.25,14,21,0)
^^1^1^3050616^
"^DD",52,52.25,14,21,1,0)
NCPDP field indicating the resason for service code. See NCPDP REASON FOR SERVICE CODE file (#9002313.23) for possible values.
"^DD",52,52.25,14,"DT")
3050518
"^DD",52,52.25,15,0)
PROFESSIONAL SERVICE CODE^F^^0;10^K:$L(X)>4!($L(X)<1) X
"^DD",52,52.25,15,3)
Answer must be 1-4 characters in length
"^DD",52,52.25,15,21,0)
^.001^1^1^3050616^^
"^DD",52,52.25,15,21,1,0)
NCPDP field indicating the professional service code. See NCPDP PROFESSIONAL SERVICE CODE file (#9002313.21) for possible values.
"^DD",52,52.25,15,"DT")
3050518
"^DD",52,52.25,16,0)
RESPONSE ID^NJ10,0^^0;11^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1.N) X
"^DD",52,52.25,16,3)
Type a number between 0 and 9999999999, 0 Decimal Digits
"^DD",52,52.25,16,21,0)
^^1^1^3050616^
"^DD",52,52.25,16,21,1,0)
This field is used to make sure the reject is recorded only once.
"^DD",52,52.25,16,"DT")
3050512
"^DD",52,52.25,17,0)
OTHER REJECTS^F^^0;12^K:$L(X)>15!($L(X)<1) X
"^DD",52,52.25,17,3)
Answer must be 1-15 characters in length
"^DD",52,52.25,17,21,0)
^^1^1^3050616^
"^DD",52,52.25,17,21,1,0)
List of other reject codes that were returned at the same time.
"^DD",52,52.25,17,"DT")
3050425
"^DD",52,52.25,18,0)
DUR TEXT^F^^4;1^K:$L(X)>100!($L(X)<1) X
"^DD",52,52.25,18,3)
Answer must be 1-100 characters in length
"^DD",52,52.25,18,21,0)
^^1^1^3050616^
"^DD",52,52.25,18,21,1,0)
In case of a DUR reject (#88) the 3rd party payer returns an explanation of the DUR (Drug Usability Review).
"^DD",52,52.25,18,"DT")
3050429
"^DD",52,52.25,19,0)
RESULT OF SERVICE CODE^F^^0;13^K:$L(X)>4!($L(X)<1) X
"^DD",52,52.25,19,3)
Answer must be 1-4 characters in length
"^DD",52,52.25,19,21,0)
^^1^1^3050616^
"^DD",52,52.25,19,21,1,0)
NCPDP field indicating the result of service code. See NCPDP RESULT OF SERVICE CODE file (#9002313.22) for possible values.
"^DD",52,52.25,19,"DT")
3050518
"^DD",52,52.25,20,0)
INSURANCE NAME^F^^2;4^K:$L(X)>30!($L(X)<1) X
"^DD",52,52.25,20,3)
Answer must be 1-30 characters in length
"^DD",52,52.25,20,21,0)
^^1^1^3050616^
"^DD",52,52.25,20,21,1,0)
Patient's insurance company name.
"^DD",52,52.25,20,"DT")
3050616
"^DD",52,52.25,21,0)
GROUP NUMBER^F^^2;5^K:$L(X)>30!($L(X)<1) X
"^DD",52,52.25,21,3)
Answer must be 1-30 characters in length
"^DD",52,52.25,21,21,0)
^^1^1^3050616^
"^DD",52,52.25,21,21,1,0)
Patient's insurance group number.
"^DD",52,52.25,21,"DT")
3050616
"^DD",52,52.25,22,0)
CARDHOLDER ID^F^^2;6^K:$L(X)>20!($L(X)<1) X
"^DD",52,52.25,22,3)
Answer must be 1-20 characters in length
"^DD",52,52.25,22,21,0)
^.001^1^1^3050616^^
"^DD",52,52.25,22,21,1,0)
ID number assigned to Cardholder/Subscriber.
"^DD",52,52.25,22,"DT")
3050616
"^DD",52,52.25,23,0)
RE-OPENED^S^1:YES;^0;14^Q
"^DD",52,52.25,23,21,0)
^^1^1^3051114^
"^DD",52,52.25,23,21,1,0)
This flag indicates that the user has manually re-opened another reject and this one was created.
"^DD",52,52.25,23,23,0)
^^1^1^3051114^
"^DD",52,52.25,23,23,1,0)
In order to identify the original reject, use the RESPONSED ID field. It should match with the RESPONSED ID from the re-opened reject.
"^DD",52,52.25,23,"DT")
3051114
"^DD",52,52.3,.02,0)
REASON^S^H:HOLD;U:UNHOLD;C:DISCONTINUED;E:EDIT;L:RENEWED;P:PARTIAL;R:REINSTATE;W:REPRINT;S:SUSPENDED;I:RETURNED;V:INTERVENTION;D:DELETED;A:DRUG INTERACTION;B:PROCESSED;X:INTERFACE;G:PATIENT INST;K:PKI/DEA;N:DISPENSE COMPLETION;M:ECME;^0;2^Q
"^DD",52,52.3,.02,3)
Enter code to indicate the activity taking place for this prescription.
"^DD",52,52.3,.02,21,0)
^.001^1^1^3050621^^^^
"^DD",52,52.3,.02,21,1,0)
What was done that caused activity to happen.
"^DD",52,52.3,.02,23,0)
^.001^9^9^3050621^^^^
"^DD",52,52.3,.02,23,1,0)
Set 'H' for Hold, 'U' for Unhold, 'C' for Discontinued, 'E' for Edit,
"^DD",52,52.3,.02,23,2,0)
'L' for Lost, 'P' for Partial, 'R' for Reinstate, 'W' for Reprint,
"^DD",52,52.3,.02,23,3,0)
'S' for Suspended, 'I' for Returned to Stock, 'V' for Intervention
"^DD",52,52.3,.02,23,4,0)
'D' for Deleted, 'A' for Pending due to drug interactions, 'B' for Unpending.
"^DD",52,52.3,.02,23,5,0)
X will stand for External Interface, 'G' will indicate if patient
"^DD",52,52.3,.02,23,6,0)
instructions was added when the order was received from CPRS. 'K' for 
"^DD",52,52.3,.02,23,7,0)
PKI Certificate regarding digitally signed orders, introduced for the
"^DD",52,52.3,.02,23,8,0)
PKI/DEA project, 'N' will indicate that an Rx was dispensed by an external
"^DD",52,52.3,.02,23,9,0)
interface. 'M' indicates an ECME activity (3rd Party Billing).
"^DD",52,52.3,.02,"DT")
3050621
**INSTALL NAME**
IB*2.0*276
"BLD",5714,0)
IB*2.0*276^INTEGRATED BILLING^0^3060324^y
"BLD",5714,1,0)
^^4^4^3060210^^
"BLD",5714,1,1,0)
HIPAA NCPDP Global project
"BLD",5714,1,2,0)
 
"BLD",5714,1,3,0)
supports the electronic transmission outpatient prescription claims and 
"BLD",5714,1,4,0)
billing collection and management.
"BLD",5714,4,0)
^9.64PA^356^2
"BLD",5714,4,356,0)
356
"BLD",5714,4,356,2,0)
^9.641^356^1
"BLD",5714,4,356,2,356,0)
CLAIMS TRACKING  (File-top level)
"BLD",5714,4,356,2,356,1,0)
^9.6411^1.11^2
"BLD",5714,4,356,2,356,1,1.1,0)
ECME NUMBER
"BLD",5714,4,356,2,356,1,1.11,0)
ECME REJECT
"BLD",5714,4,356,222)
y^n^p^^^^n^^n
"BLD",5714,4,356,224)

"BLD",5714,4,356.8,0)
356.8
"BLD",5714,4,356.8,2,0)
^9.641^356.8^1
"BLD",5714,4,356.8,2,356.8,0)
CLAIMS TRACKING NON-BILLABLE REASONS  (File-top level)
"BLD",5714,4,356.8,2,356.8,1,0)
^9.6411^.03^2
"BLD",5714,4,356.8,2,356.8,1,.02,0)
ECME FLAG
"BLD",5714,4,356.8,2,356.8,1,.03,0)
ECME PAPER FLAG
"BLD",5714,4,356.8,222)
y^n^p^^^^n^^n
"BLD",5714,4,356.8,224)

"BLD",5714,4,"APDD",356,356)

"BLD",5714,4,"APDD",356,356,1.1)

"BLD",5714,4,"APDD",356,356,1.11)

"BLD",5714,4,"APDD",356.8,356.8)

"BLD",5714,4,"APDD",356.8,356.8,.02)

"BLD",5714,4,"APDD",356.8,356.8,.03)

"BLD",5714,4,"B",356,356)

"BLD",5714,4,"B",356.8,356.8)

"BLD",5714,"INIT")
EN^IB20P276
"BLD",5714,"KRN",0)
^9.67PA^8989.52^19
"BLD",5714,"KRN",.4,0)
.4
"BLD",5714,"KRN",.401,0)
.401
"BLD",5714,"KRN",.402,0)
.402
"BLD",5714,"KRN",.403,0)
.403
"BLD",5714,"KRN",.5,0)
.5
"BLD",5714,"KRN",.84,0)
.84
"BLD",5714,"KRN",3.6,0)
3.6
"BLD",5714,"KRN",3.8,0)
3.8
"BLD",5714,"KRN",9.2,0)
9.2
"BLD",5714,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",5714,"KRN",9.8,0)
9.8
"BLD",5714,"KRN",9.8,"NM",0)
^9.68A^66^55
"BLD",5714,"KRN",9.8,"NM",3,0)
IBCNSBL1^^0^B33740946
"BLD",5714,"KRN",9.8,"NM",6,0)
IBNCPBB^^0^B87290144
"BLD",5714,"KRN",9.8,"NM",8,0)
IBNCPER^^0^B67228842
"BLD",5714,"KRN",9.8,"NM",9,0)
IB20P276^^0^B43263639
"BLD",5714,"KRN",9.8,"NM",12,0)
IBCNSUR^^0^B23131946
"BLD",5714,"KRN",9.8,"NM",13,0)
IBCNSUR1^^0^B56652391
"BLD",5714,"KRN",9.8,"NM",15,0)
IBJTU1^^0^B6991546
"BLD",5714,"KRN",9.8,"NM",16,0)
IBTRE^^0^B25125140
"BLD",5714,"KRN",9.8,"NM",17,0)
IBTRED^^0^B22391684
"BLD",5714,"KRN",9.8,"NM",18,0)
IBTRED0^^0^B23652054
"BLD",5714,"KRN",9.8,"NM",19,0)
IBRFN^^0^B49341340
"BLD",5714,"KRN",9.8,"NM",20,0)
IBJTLB1^^0^B10448877
"BLD",5714,"KRN",9.8,"NM",21,0)
IBCNRMFE^^0^B8335815
"BLD",5714,"KRN",9.8,"NM",22,0)
IBCNRPS2^^0^B22515799
"BLD",5714,"KRN",9.8,"NM",23,0)
IBCNRPSI^^0^B13445213
"BLD",5714,"KRN",9.8,"NM",24,0)
IBCNRXI1^^0^B4043997
"BLD",5714,"KRN",9.8,"NM",25,0)
IBJTLA1^^0^B7038251
"BLD",5714,"KRN",9.8,"NM",26,0)
IBCNRRP1^^0^B32540421
"BLD",5714,"KRN",9.8,"NM",27,0)
IBCNRRP3^^0^B55033574
"BLD",5714,"KRN",9.8,"NM",28,0)
IBCNSUR3^^0^B6612795
"BLD",5714,"KRN",9.8,"NM",29,0)
IBNCPEB^^0^B22026532
"BLD",5714,"KRN",9.8,"NM",30,0)
IBCNRU1^^0^B27266594
"BLD",5714,"KRN",9.8,"NM",31,0)
IBJTCA1^^0^B37857636
"BLD",5714,"KRN",9.8,"NM",32,0)
IBNCPNB^^0^B20259867
"BLD",5714,"KRN",9.8,"NM",34,0)
IBCNRP5^^0^B56002389
"BLD",5714,"KRN",9.8,"NM",35,0)
IBCNRP5P^^0^B8700930
"BLD",5714,"KRN",9.8,"NM",36,0)
IBTOBI^^0^B26516930
"BLD",5714,"KRN",9.8,"NM",37,0)
IBTOBI1^^0^B18274759
"BLD",5714,"KRN",9.8,"NM",38,0)
IBJTU2^^0^B10627973
"BLD",5714,"KRN",9.8,"NM",39,0)
IBTUBOA^^0^B30890238
"BLD",5714,"KRN",9.8,"NM",40,0)
IBCD4^^0^B16336305
"BLD",5714,"KRN",9.8,"NM",43,0)
IBNCPRR^^0^B91643429
"BLD",5714,"KRN",9.8,"NM",44,0)
IBNCPDP^^0^B1650924
"BLD",5714,"KRN",9.8,"NM",45,0)
IBNCPDP1^^0^B52180701
"BLD",5714,"KRN",9.8,"NM",46,0)
IBNCPDP2^^0^B37659473
"BLD",5714,"KRN",9.8,"NM",47,0)
IBNCPDP3^^0^B48251954
"BLD",5714,"KRN",9.8,"NM",48,0)
IBNCPDP4^^0^B21200709
"BLD",5714,"KRN",9.8,"NM",49,0)
IBNCPDPC^^0^B34220485
"BLD",5714,"KRN",9.8,"NM",50,0)
IBNCPDPE^^0^B17582633
"BLD",5714,"KRN",9.8,"NM",51,0)
IBNCPDPH^^0^B27130556
"BLD",5714,"KRN",9.8,"NM",52,0)
IBNCPDPI^^0^B8352830
"BLD",5714,"KRN",9.8,"NM",53,0)
IBNCPDPL^^0^B771797
"BLD",5714,"KRN",9.8,"NM",54,0)
IBNCPDPR^^0^B26832098
"BLD",5714,"KRN",9.8,"NM",55,0)
IBNCPDPU^^0^B59250332
"BLD",5714,"KRN",9.8,"NM",56,0)
IBNCPER1^^0^B6437334
"BLD",5714,"KRN",9.8,"NM",57,0)
IBCNRXI2^^0^B2709059
"BLD",5714,"KRN",9.8,"NM",58,0)
IBCC^^0^B35414312
"BLD",5714,"KRN",9.8,"NM",59,0)
IBCNRE5^^0^B1999828
"BLD",5714,"KRN",9.8,"NM",60,0)
IBNCPDPV^^0^B631181
"BLD",5714,"KRN",9.8,"NM",61,0)
IBCNSM^^0^B18162142
"BLD",5714,"KRN",9.8,"NM",62,0)
IBCNSM4^^0^B3479873
"BLD",5714,"KRN",9.8,"NM",63,0)
IBCNSV^^0^B922209
"BLD",5714,"KRN",9.8,"NM",64,0)
IBCNSC^^0^B16200717
"BLD",5714,"KRN",9.8,"NM",65,0)
IBCNRPM2^^0^B20488193
"BLD",5714,"KRN",9.8,"NM",66,0)
IBEVNTP^^0^B8629537
"BLD",5714,"KRN",9.8,"NM","B","IB20P276",9)

"BLD",5714,"KRN",9.8,"NM","B","IBCC",58)

"BLD",5714,"KRN",9.8,"NM","B","IBCD4",40)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRE5",59)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRMFE",21)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRP5",34)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRP5P",35)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRPM2",65)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRPS2",22)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRPSI",23)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRRP1",26)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRRP3",27)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRU1",30)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRXI1",24)

"BLD",5714,"KRN",9.8,"NM","B","IBCNRXI2",57)

"BLD",5714,"KRN",9.8,"NM","B","IBCNSBL1",3)

"BLD",5714,"KRN",9.8,"NM","B","IBCNSC",64)

"BLD",5714,"KRN",9.8,"NM","B","IBCNSM",61)

"BLD",5714,"KRN",9.8,"NM","B","IBCNSM4",62)

"BLD",5714,"KRN",9.8,"NM","B","IBCNSUR",12)

"BLD",5714,"KRN",9.8,"NM","B","IBCNSUR1",13)

"BLD",5714,"KRN",9.8,"NM","B","IBCNSUR3",28)

"BLD",5714,"KRN",9.8,"NM","B","IBCNSV",63)

"BLD",5714,"KRN",9.8,"NM","B","IBEVNTP",66)

"BLD",5714,"KRN",9.8,"NM","B","IBJTCA1",31)

"BLD",5714,"KRN",9.8,"NM","B","IBJTLA1",25)

"BLD",5714,"KRN",9.8,"NM","B","IBJTLB1",20)

"BLD",5714,"KRN",9.8,"NM","B","IBJTU1",15)

"BLD",5714,"KRN",9.8,"NM","B","IBJTU2",38)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPBB",6)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDP",44)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDP1",45)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDP2",46)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDP3",47)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDP4",48)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDPC",49)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDPE",50)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDPH",51)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDPI",52)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDPL",53)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDPR",54)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDPU",55)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPDPV",60)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPEB",29)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPER",8)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPER1",56)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPNB",32)

"BLD",5714,"KRN",9.8,"NM","B","IBNCPRR",43)

"BLD",5714,"KRN",9.8,"NM","B","IBRFN",19)

"BLD",5714,"KRN",9.8,"NM","B","IBTOBI",36)

"BLD",5714,"KRN",9.8,"NM","B","IBTOBI1",37)

"BLD",5714,"KRN",9.8,"NM","B","IBTRE",16)

"BLD",5714,"KRN",9.8,"NM","B","IBTRED",17)

"BLD",5714,"KRN",9.8,"NM","B","IBTRED0",18)

"BLD",5714,"KRN",9.8,"NM","B","IBTUBOA",39)

"BLD",5714,"KRN",19,0)
19
"BLD",5714,"KRN",19,"NM",0)
^9.68A^18^16
"BLD",5714,"KRN",19,"NM",1,0)
IB ECME BILLING EVENTS^^0
"BLD",5714,"KRN",19,"NM",2,0)
IB BILLING CLERK MENU^^2
"BLD",5714,"KRN",19,"NM",3,0)
IB GENERATE ECME RX BILLS^^0
"BLD",5714,"KRN",19,"NM",5,0)
IBCNR E-PHARMACY MENU^^0
"BLD",5714,"KRN",19,"NM",6,0)
IBCNR PLAN STATUS INQUIRY^^0
"BLD",5714,"KRN",19,"NM",7,0)
IBCNR PLAN STATUS REPORT^^0
"BLD",5714,"KRN",19,"NM",9,0)
IBCNR EDIT HIPAA NCPDP FLAG^^0
"BLD",5714,"KRN",19,"NM",10,0)
IBCNR EDIT NCPDP PROCESSOR^^0
"BLD",5714,"KRN",19,"NM",11,0)
IBCNR EDIT PAYER^^0
"BLD",5714,"KRN",19,"NM",12,0)
IBCNR EDIT PBM^^0
"BLD",5714,"KRN",19,"NM",13,0)
IBCNR EDIT PLAN^^0
"BLD",5714,"KRN",19,"NM",14,0)
IBCNR PLAN MATCH^^0
"BLD",5714,"KRN",19,"NM",15,0)
IBCNR GROUP PLAN MATCH^^0
"BLD",5714,"KRN",19,"NM",16,0)
IBCNR TEST PAYER SHEET MATCH^^0
"BLD",5714,"KRN",19,"NM",17,0)
IBCNR GROUP PLAN WORKSHEET^^0
"BLD",5714,"KRN",19,"NM",18,0)
IBCNR PHARMACY PLAN REPORT^^0
"BLD",5714,"KRN",19,"NM","B","IB BILLING CLERK MENU",2)

"BLD",5714,"KRN",19,"NM","B","IB ECME BILLING EVENTS",1)

"BLD",5714,"KRN",19,"NM","B","IB GENERATE ECME RX BILLS",3)

"BLD",5714,"KRN",19,"NM","B","IBCNR E-PHARMACY MENU",5)

"BLD",5714,"KRN",19,"NM","B","IBCNR EDIT HIPAA NCPDP FLAG",9)

"BLD",5714,"KRN",19,"NM","B","IBCNR EDIT NCPDP PROCESSOR",10)

"BLD",5714,"KRN",19,"NM","B","IBCNR EDIT PAYER",11)

"BLD",5714,"KRN",19,"NM","B","IBCNR EDIT PBM",12)

"BLD",5714,"KRN",19,"NM","B","IBCNR EDIT PLAN",13)

"BLD",5714,"KRN",19,"NM","B","IBCNR GROUP PLAN MATCH",15)

"BLD",5714,"KRN",19,"NM","B","IBCNR GROUP PLAN WORKSHEET",17)

"BLD",5714,"KRN",19,"NM","B","IBCNR PHARMACY PLAN REPORT",18)

"BLD",5714,"KRN",19,"NM","B","IBCNR PLAN MATCH",14)

"BLD",5714,"KRN",19,"NM","B","IBCNR PLAN STATUS INQUIRY",6)

"BLD",5714,"KRN",19,"NM","B","IBCNR PLAN STATUS REPORT",7)

"BLD",5714,"KRN",19,"NM","B","IBCNR TEST PAYER SHEET MATCH",16)

"BLD",5714,"KRN",19.1,0)
19.1
"BLD",5714,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",5714,"KRN",19.1,"NM",1,0)
IBCNR E-PHARMACY SUPERVISOR^^0
"BLD",5714,"KRN",19.1,"NM","B","IBCNR E-PHARMACY SUPERVISOR",1)

"BLD",5714,"KRN",101,0)
101
"BLD",5714,"KRN",101,"NM",0)
^9.68A^17^17
"BLD",5714,"KRN",101,"NM",1,0)
IBTRED SUBMIT ECME^^0
"BLD",5714,"KRN",101,"NM",2,0)
IBTRED  MENU^^2
"BLD",5714,"KRN",101,"NM",3,0)
IBTRED  BI MENU^^2
"BLD",5714,"KRN",101,"NM",4,0)
IBCNR STATUS INQUIRY DETAIL^^0
"BLD",5714,"KRN",101,"NM",5,0)
IBCNR STATUS INQUIRY LIST^^0
"BLD",5714,"KRN",101,"NM",6,0)
IBNCPDP PRTCL CT MENU^^0
"BLD",5714,"KRN",101,"NM",7,0)
IBTRED BILLING INFO^^4^
"BLD",5714,"KRN",101,"NM",8,0)
IBTRED PRECERT INFO^^4^
"BLD",5714,"KRN",101,"NM",9,0)
IBTRED UR INFO^^4^
"BLD",5714,"KRN",101,"NM",10,0)
IBNCPDP PRTCL CT EXIT^^0
"BLD",5714,"KRN",101,"NM",11,0)
IBNCPDP VIEW ELIGIBILITY^^0
"BLD",5714,"KRN",101,"NM",12,0)
IBNCPDP PATIENT INSURANCE^^0
"BLD",5714,"KRN",101,"NM",13,0)
IBNCPDP VIEW INSURANCE CO^^0
"BLD",5714,"KRN",101,"NM",14,0)
IBNCPDP VIEW AN BEN^^0
"BLD",5714,"KRN",101,"NM",15,0)
IBNCPDP VIEW EXP POL^^0
"BLD",5714,"KRN",101,"NM",16,0)
IBNCPDP VIEW BEN USED^^0
"BLD",5714,"KRN",101,"NM",17,0)
IBNCPDP QUIT^^0
"BLD",5714,"KRN",101,"NM","B","IBCNR STATUS INQUIRY DETAIL",4)

"BLD",5714,"KRN",101,"NM","B","IBCNR STATUS INQUIRY LIST",5)

"BLD",5714,"KRN",101,"NM","B","IBNCPDP PATIENT INSURANCE",12)

"BLD",5714,"KRN",101,"NM","B","IBNCPDP PRTCL CT EXIT",10)

"BLD",5714,"KRN",101,"NM","B","IBNCPDP PRTCL CT MENU",6)

"BLD",5714,"KRN",101,"NM","B","IBNCPDP QUIT",17)

"BLD",5714,"KRN",101,"NM","B","IBNCPDP VIEW AN BEN",14)

"BLD",5714,"KRN",101,"NM","B","IBNCPDP VIEW BEN USED",16)

"BLD",5714,"KRN",101,"NM","B","IBNCPDP VIEW ELIGIBILITY",11)

"BLD",5714,"KRN",101,"NM","B","IBNCPDP VIEW EXP POL",15)

"BLD",5714,"KRN",101,"NM","B","IBNCPDP VIEW INSURANCE CO",13)

"BLD",5714,"KRN",101,"NM","B","IBTRED  BI MENU",3)

"BLD",5714,"KRN",101,"NM","B","IBTRED  MENU",2)

"BLD",5714,"KRN",101,"NM","B","IBTRED BILLING INFO",7)

"BLD",5714,"KRN",101,"NM","B","IBTRED PRECERT INFO",8)

"BLD",5714,"KRN",101,"NM","B","IBTRED SUBMIT ECME",1)

"BLD",5714,"KRN",101,"NM","B","IBTRED UR INFO",9)

"BLD",5714,"KRN",409.61,0)
409.61
"BLD",5714,"KRN",409.61,"NM",0)
^9.68A^5^5
"BLD",5714,"KRN",409.61,"NM",1,0)
IBCNR PLAN STATUS INQUIRY^^0
"BLD",5714,"KRN",409.61,"NM",2,0)
IBNCPDP INSURANCE MANAGEMENT^^0
"BLD",5714,"KRN",409.61,"NM",3,0)
IBNCPDP LSTMN CT^^0
"BLD",5714,"KRN",409.61,"NM",4,0)
IBNCPDP LSTMN ELIGIBILITY^^0
"BLD",5714,"KRN",409.61,"NM",5,0)
IBNCPDP VIEW PAT INS^^0
"BLD",5714,"KRN",409.61,"NM","B","IBCNR PLAN STATUS INQUIRY",1)

"BLD",5714,"KRN",409.61,"NM","B","IBNCPDP INSURANCE MANAGEMENT",2)

"BLD",5714,"KRN",409.61,"NM","B","IBNCPDP LSTMN CT",3)

"BLD",5714,"KRN",409.61,"NM","B","IBNCPDP LSTMN ELIGIBILITY",4)

"BLD",5714,"KRN",409.61,"NM","B","IBNCPDP VIEW PAT INS",5)

"BLD",5714,"KRN",771,0)
771
"BLD",5714,"KRN",771,"NM",0)
^9.68A^^
"BLD",5714,"KRN",870,0)
870
"BLD",5714,"KRN",8989.51,0)
8989.51
"BLD",5714,"KRN",8989.52,0)
8989.52
"BLD",5714,"KRN",8994,0)
8994
"BLD",5714,"KRN","B",.4,.4)

"BLD",5714,"KRN","B",.401,.401)

"BLD",5714,"KRN","B",.402,.402)

"BLD",5714,"KRN","B",.403,.403)

"BLD",5714,"KRN","B",.5,.5)

"BLD",5714,"KRN","B",.84,.84)

"BLD",5714,"KRN","B",3.6,3.6)

"BLD",5714,"KRN","B",3.8,3.8)

"BLD",5714,"KRN","B",9.2,9.2)

"BLD",5714,"KRN","B",9.8,9.8)

"BLD",5714,"KRN","B",19,19)

"BLD",5714,"KRN","B",19.1,19.1)

"BLD",5714,"KRN","B",101,101)

"BLD",5714,"KRN","B",409.61,409.61)

"BLD",5714,"KRN","B",771,771)

"BLD",5714,"KRN","B",870,870)

"BLD",5714,"KRN","B",8989.51,8989.51)

"BLD",5714,"KRN","B",8989.52,8989.52)

"BLD",5714,"KRN","B",8994,8994)

"BLD",5714,"QUES",0)
^9.62^^
"BLD",5714,"REQB",0)
^9.611^17^17
"BLD",5714,"REQB",1,0)
IB*2.0*223^2
"BLD",5714,"REQB",2,0)
IB*2.0*247^2
"BLD",5714,"REQB",3,0)
IB*2.0*225^2
"BLD",5714,"REQB",4,0)
IB*2.0*251^2
"BLD",5714,"REQB",5,0)
IB*2.0*210^2
"BLD",5714,"REQB",6,0)
IB*2.0*199^2
"BLD",5714,"REQB",7,0)
IB*2.0*249^2
"BLD",5714,"REQB",8,0)
IB*2.0*309^1
"BLD",5714,"REQB",9,0)
IB*2.0*317^1
"BLD",5714,"REQB",10,0)
PRCA*4.5*230^1
"BLD",5714,"REQB",11,0)
IB*2.0*184^1
"BLD",5714,"REQB",12,0)
IB*2.0*155^1
"BLD",5714,"REQB",13,0)
IB*2.0*183^1
"BLD",5714,"REQB",14,0)
IB*2.0*103^1
"BLD",5714,"REQB",15,0)
IB*2.0*137^1
"BLD",5714,"REQB",16,0)
IB*2.0*211^1
"BLD",5714,"REQB",17,0)
IB*2.0*51^1
"BLD",5714,"REQB","B","IB*2.0*103",14)

"BLD",5714,"REQB","B","IB*2.0*137",15)

"BLD",5714,"REQB","B","IB*2.0*155",12)

"BLD",5714,"REQB","B","IB*2.0*183",13)

"BLD",5714,"REQB","B","IB*2.0*184",11)

"BLD",5714,"REQB","B","IB*2.0*199",6)

"BLD",5714,"REQB","B","IB*2.0*210",5)

"BLD",5714,"REQB","B","IB*2.0*211",16)

"BLD",5714,"REQB","B","IB*2.0*223",1)

"BLD",5714,"REQB","B","IB*2.0*225",3)

"BLD",5714,"REQB","B","IB*2.0*247",2)

"BLD",5714,"REQB","B","IB*2.0*249",7)

"BLD",5714,"REQB","B","IB*2.0*251",4)

"BLD",5714,"REQB","B","IB*2.0*309",8)

"BLD",5714,"REQB","B","IB*2.0*317",9)

"BLD",5714,"REQB","B","IB*2.0*51",17)

"BLD",5714,"REQB","B","PRCA*4.5*230",10)

"FIA",356)
CLAIMS TRACKING
"FIA",356,0)
^IBT(356,
"FIA",356,0,0)
356I
"FIA",356,0,1)
y^n^p^^^^n^^n
"FIA",356,0,10)

"FIA",356,0,11)

"FIA",356,0,"RLRO")

"FIA",356,0,"VR")
2.0^IB
"FIA",356,356)
1
"FIA",356,356,1.1)

"FIA",356,356,1.11)

"FIA",356.8)
CLAIMS TRACKING NON-BILLABLE REASONS
"FIA",356.8,0)
^IBE(356.8,
"FIA",356.8,0,0)
356.8
"FIA",356.8,0,1)
y^n^p^^^^n^^n
"FIA",356.8,0,10)

"FIA",356.8,0,11)

"FIA",356.8,0,"RLRO")

"FIA",356.8,0,"VR")
2.0^IB
"FIA",356.8,356.8)
1
"FIA",356.8,356.8,.02)

"FIA",356.8,356.8,.03)

"INIT")
EN^IB20P276
"KRN",19,3166,-1)
2^2
"KRN",19,3166,0)
IB BILLING CLERK MENU^Billing Clerk's Menu^^M^.5^^^^^^^219^^1
"KRN",19,3166,10,0)
^19.01IP^13^13
"KRN",19,3166,10,12,0)
2927466^ERX
"KRN",19,3166,10,12,"^")
IB GENERATE ECME RX BILLS
"KRN",19,3166,"U")
BILLING CLERK'S MENU
"KRN",19,2927223,-1)
0^14
"KRN",19,2927223,0)
IBCNR PLAN MATCH^Match Group Plan to a Pharmacy Plan^^R^^IBCNR E-PHARMACY SUPERVISOR^^^^^^INTEGRATED BILLING
"KRN",19,2927223,1,0)
^19.06^2^2^3040716^^
"KRN",19,2927223,1,1,0)
This option allows a user to match a GROUP INSURANCE PLAN file (#355.3)
"KRN",19,2927223,1,2,0)
record to a PHARMACY PLAN file (#366.03) record.
"KRN",19,2927223,25)
EN^IBCNRPMT
"KRN",19,2927223,"U")
MATCH GROUP PLAN TO A PHARMACY
"KRN",19,2927225,-1)
0^11
"KRN",19,2927225,0)
IBCNR EDIT PAYER^Edit PAYER APPLICATION Sub-file^^R^^IBCNR E-PHARMACY SUPERVISOR^^^^^^INTEGRATED BILLING
"KRN",19,2927225,1,0)
^19.06^2^2^3040716^^
"KRN",19,2927225,1,1,0)
This option allows the user to edit the PAYER APPLICATION sub-file 
"KRN",19,2927225,1,2,0)
(#365.121).  Specific to e-Pharmacy.
"KRN",19,2927225,25)
IBCNRE1
"KRN",19,2927225,"U")
EDIT PAYER APPLICATION SUB-FIL
"KRN",19,2927226,-1)
0^10
"KRN",19,2927226,0)
IBCNR EDIT NCPDP PROCESSOR^Edit NCPDP PROCESSOR APPLICATION Sub-file^^R^^IBCNR E-PHARMACY SUPERVISOR^^^^^^INTEGRATED BILLING
"KRN",19,2927226,1,0)
^19.06^2^2^3040716^^^
"KRN",19,2927226,1,1,0)
This option allows the user to edit the NCPDP PROCESSOR APPLICATION 
"KRN",19,2927226,1,2,0)
sub-file (#366.013).  Specific to e-Pharmacy.
"KRN",19,2927226,25)
IBCNRE2
"KRN",19,2927226,"U")
EDIT NCPDP PROCESSOR APPLICATI
"KRN",19,2927227,-1)
0^12
"KRN",19,2927227,0)
IBCNR EDIT PBM^Edit PBM APPLICATION Sub-file^^R^^IBCNR E-PHARMACY SUPERVISOR^^^^^^INTEGRATED BILLING
"KRN",19,2927227,1,0)
^19.06^2^2^3040716^^^
"KRN",19,2927227,1,1,0)
This option allows the user to edit the PHARMACY BENEFITS MANAGER (PBM) 
"KRN",19,2927227,1,2,0)
APPLICATION sub-file (#366.023).  Specific to e-Pharmacy.
"KRN",19,2927227,25)
IBCNRE3
"KRN",19,2927227,"U")
EDIT PBM APPLICATION SUB-FILE
"KRN",19,2927228,-1)
0^13
"KRN",19,2927228,0)
IBCNR EDIT PLAN^Edit PLAN APPLICATION Sub-file^^R^^IBCNR E-PHARMACY SUPERVISOR^^^^^^INTEGRATED BILLING
"KRN",19,2927228,1,0)
^19.06^2^2^3040716^^
"KRN",19,2927228,1,1,0)
This option allows the user to edit the PLAN APPLICATION sub-file
"KRN",19,2927228,1,2,0)
(#366.033).  Specific to e-Pharmacy.
"KRN",19,2927228,25)
IBCNRE4
"KRN",19,2927228,"U")
EDIT PLAN APPLICATION SUB-FILE
"KRN",19,2927248,-1)
0^17
"KRN",19,2927248,0)
IBCNR GROUP PLAN WORKSHEET^Group Plan Worksheet Report^^R^^^^^^^^INTEGRATED BILLING
"KRN",19,2927248,1,0)
^19.06^3^3^3040310^^^^
"KRN",19,2927248,1,1,0)
The Group Plan Worksheet allows a user to, for a given date range, view
"KRN",19,2927248,1,2,0)
all authorized Bill/Claim activity for a Group Plan that has active
"KRN",19,2927248,1,3,0)
Pharmacy coverage.
"KRN",19,2927248,25)
EN^IBCNRRP1
"KRN",19,2927248,"U")
GROUP PLAN WORKSHEET REPORT
"KRN",19,2927249,-1)
0^18
"KRN",19,2927249,0)
IBCNR PHARMACY PLAN REPORT^Pharmacy Plan Report^^R^^^^^^^^INTEGRATED BILLING
"KRN",19,2927249,1,0)
^19.06^3^3^3040716^^
"KRN",19,2927249,1,1,0)
The Pharmacy Plan Report lists the Plan Name, Plan ID, Banking 
"KRN",19,2927249,1,2,0)
Identification Number (BIN), and Processor Control Number (PCN) for all 
"KRN",19,2927249,1,3,0)
entries.  It can be sorted by Plan Name or BIN and PCN.  
"KRN",19,2927249,25)
IBCNRRP4
"KRN",19,2927249,"U")
PHARMACY PLAN REPORT
"KRN",19,2927250,-1)
0^15
"KRN",19,2927250,0)
IBCNR GROUP PLAN MATCH^Match Multiple Group Plans to a Pharmacy Plan^^R^^IBCNR E-PHARMACY SUPERVISOR^^^^^^INTEGRATED BILLING
"KRN",19,2927250,1,0)
^19.06^2^2^3040716^^^
"KRN",19,2927250,1,1,0)
This option allows a user to match multiple GROUP INSURANCE PLAN file 
"KRN",19,2927250,1,2,0)
(#355.3) records to a PHARMACY PLAN file (#366.03) record.  
"KRN",19,2927250,25)
EN^IBCNRPM1
"KRN",19,2927250,"U")
MATCH MULTIPLE GROUP PLANS TO 
"KRN",19,2927306,-1)
0^9
"KRN",19,2927306,0)
IBCNR EDIT HIPAA NCPDP FLAG^Edit HIPAA NCPDP FLAG^^R^^IBCNR E-PHARMACY SUPERVISOR^^^^^^INTEGRATED BILLING
"KRN",19,2927306,1,0)
^19.06^2^2^3040716^^
"KRN",19,2927306,1,1,0)
This option allows the user to edit the HIPAA NCPDP ACTIVE FLAG (#350.9, 
"KRN",19,2927306,1,2,0)
11.01) (master switch to control e-Pharmacy NCPDP transactions).
"KRN",19,2927306,25)
IBCNRE5
"KRN",19,2927306,"U")
EDIT HIPAA NCPDP FLAG
"KRN",19,2927307,-1)
0^16
"KRN",19,2927307,0)
IBCNR TEST PAYER SHEET MATCH^Match Test Payer Sheet to a Pharmacy Plan^^R^^IBCNR E-PHARMACY SUPERVISOR^^^^^^INTEGRATED BILLING
"KRN",19,2927307,1,0)
^19.06^3^3^3040416^^^^
"KRN",19,2927307,1,1,0)
This option allows the user to override a payer sheet associated with a 
"KRN",19,2927307,1,2,0)
Pharmacy Plan with a test payer sheet.   This option should only be used 
"KRN",19,2927307,1,3,0)
for testing purposes only.
"KRN",19,2927307,25)
EN^IBCNRPS
"KRN",19,2927307,"U")
MATCH TEST PAYER SHEET TO A PH
"KRN",19,2927308,-1)
0^5
"KRN",19,2927308,0)
IBCNR E-PHARMACY MENU^e-Pharmacy Menu^^M^^^^^^^^INTEGRATED BILLING
"KRN",19,2927308,1,0)
^19.06^1^1^3050105^^^
"KRN",19,2927308,1,1,0)
Contains options for the e-Pharmacy Project.
"KRN",19,2927308,10,0)
^19.01IP^14^14
"KRN",19,2927308,10,1,0)
2927306^EHNF
"KRN",19,2927308,10,1,"^")
IBCNR EDIT HIPAA NCPDP FLAG
"KRN",19,2927308,10,2,0)
2927226^ENP
"KRN",19,2927308,10,2,"^")
IBCNR EDIT NCPDP PROCESSOR
"KRN",19,2927308,10,3,0)
2927225^EPAY
"KRN",19,2927308,10,3,"^")
IBCNR EDIT PAYER
"KRN",19,2927308,10,4,0)
2927227^EPBM
"KRN",19,2927308,10,4,"^")
IBCNR EDIT PBM
"KRN",19,2927308,10,5,0)
2927228^EPLA
"KRN",19,2927308,10,5,"^")
IBCNR EDIT PLAN
"KRN",19,2927308,10,6,0)
2927250^MMGP
"KRN",19,2927308,10,6,"^")
IBCNR GROUP PLAN MATCH
"KRN",19,2927308,10,7,0)
2927248^RGPW
"KRN",19,2927308,10,7,"^")
IBCNR GROUP PLAN WORKSHEET
"KRN",19,2927308,10,8,0)
2927249^RPP
"KRN",19,2927308,10,8,"^")
IBCNR PHARMACY PLAN REPORT
"KRN",19,2927308,10,9,0)
2927223^MGP
"KRN",19,2927308,10,9,"^")
IBCNR PLAN MATCH
"KRN",19,2927308,10,10,0)
2927307^MTPS
"KRN",19,2927308,10,10,"^")
IBCNR TEST PAYER SHEET MATCH
"KRN",19,2927308,10,11,0)
2927465^EVNT
"KRN",19,2927308,10,11,"^")
IB ECME BILLING EVENTS
"KRN",19,2927308,10,13,0)
2927606^PSI
"KRN",19,2927308,10,13,"^")
IBCNR PLAN STATUS INQUIRY
"KRN",19,2927308,10,14,0)
2927607^PSR
"KRN",19,2927308,10,14,"^")
IBCNR PLAN STATUS REPORT
"KRN",19,2927308,99)
60326,44831
"KRN",19,2927308,99.1)
60345,62055
"KRN",19,2927308,"U")
E-PHARMACY MENU
"KRN",19,2927465,-1)
0^1
"KRN",19,2927465,0)
IB ECME BILLING EVENTS^ECME Billing Events Report^^R^^^^^^^^
"KRN",19,2927465,1,0)
^^1^1^3040511^
"KRN",19,2927465,1,1,0)
This option prints the ECME Billing Events Report.
"KRN",19,2927465,25)
IBNCPDPE
"KRN",19,2927465,99.1)
59668,58218
"KRN",19,2927465,"U")
ECME BILLING EVENTS REPORT
"KRN",19,2927466,-1)
0^3
"KRN",19,2927466,0)
IB GENERATE ECME RX BILLS^Generate ECME Rx Bills^^R^^^^^^^^
"KRN",19,2927466,1,0)
^^2^2^3040701^
"KRN",19,2927466,1,1,0)
This option is for Back-Billing purposes. It allows to resend a single or 
"KRN",19,2927466,1,2,0)
multiple prescriptions through ECME for electronic billing.
"KRN",19,2927466,25)
EN^IBNCPBB
"KRN",19,2927466,99.1)
59812,55791
"KRN",19,2927466,"U")
GENERATE ECME RX BILLS
"KRN",19,2927606,-1)
0^6
"KRN",19,2927606,0)
IBCNR PLAN STATUS INQUIRY^Group Plan Status Inquiry^^A^^^^^^^^^^1
"KRN",19,2927606,1,0)
^19.06^1^1^3041111^^^
"KRN",19,2927606,1,1,0)
Group Plan Status Inquiry screen
"KRN",19,2927606,20)
D EN^IBCNRPSI
"KRN",19,2927606,"U")
GROUP PLAN STATUS INQUIRY
"KRN",19,2927607,-1)
0^7
"KRN",19,2927607,0)
IBCNR PLAN STATUS REPORT^Group Plan Status Report^^A^^^^^^^^^^1
"KRN",19,2927607,1,0)
^19.06^1^1^3041203^^^^
"KRN",19,2927607,1,1,0)
IBCNR Group Plan Status Report
"KRN",19,2927607,20)
D EN^IBCNRP5
"KRN",19,2927607,"U")
GROUP PLAN STATUS REPORT
"KRN",19.1,918,-1)
0^1
"KRN",19.1,918,0)
IBCNR E-PHARMACY SUPERVISOR^e-Pharmacy Supervisor
"KRN",19.1,918,1,0)
^^1^1^3040416^
"KRN",19.1,918,1,1,0)
Assigned to e-Pharmacy Project edit and matching options.
"KRN",19.1,918,2,0)
^19.12PA
"KRN",101,472,-1)
2^2
"KRN",101,472,0)
IBTRED  MENU^Expanded Claims Tracking Menu^^M^73331^^^^^^^219
"KRN",101,472,10,0)
^101.01PA^10^10
"KRN",101,472,10,1,0)
473^BI^11^
"KRN",101,472,10,1,"^")
IBTRED BILLING INFO
"KRN",101,472,10,2,0)
474^RI^21^
"KRN",101,472,10,2,"^")
IBTRED UR INFO
"KRN",101,472,10,3,0)
475^TA^22^
"KRN",101,472,10,3,"^")
IBTRED PRECERT INFO
"KRN",101,472,10,10,0)
7213^SE^39^
"KRN",101,472,10,10,"^")
IBTRED SUBMIT ECME
"KRN",101,473,-1)
4^7
"KRN",101,473,0)
IBTRED BILLING INFO
"KRN",101,474,-1)
4^9
"KRN",101,474,0)
IBTRED UR INFO
"KRN",101,475,-1)
4^8
"KRN",101,475,0)
IBTRED PRECERT INFO
"KRN",101,578,-1)
2^3
"KRN",101,578,0)
IBTRED  BI MENU^Expanded Claims Tracking Menu (BI)^^M^73331^^^^^^^219
"KRN",101,578,10,0)
^101.01PA^5^5
"KRN",101,578,10,1,0)
473^BI^11^
"KRN",101,578,10,1,"^")
IBTRED BILLING INFO
"KRN",101,578,10,2,0)
474^RI^21^
"KRN",101,578,10,2,"^")
IBTRED UR INFO
"KRN",101,578,10,3,0)
475^TA^22^
"KRN",101,578,10,3,"^")
IBTRED PRECERT INFO
"KRN",101,578,10,5,0)
7213^SE^38^
"KRN",101,578,10,5,"^")
IBTRED SUBMIT ECME
"KRN",101,7213,-1)
0^1
"KRN",101,7213,0)
IBTRED SUBMIT ECME^Submit Claim to ECME^^A^^^^^^^^INTEGRATED BILLING
"KRN",101,7213,1,0)
^101.06^1^1^3041022^^
"KRN",101,7213,1,1,0)
Triggers (re)submission the Pharmacy electronic claim through ECME.
"KRN",101,7213,15)
D BLD^IBTRED S VALMBG=7
"KRN",101,7213,20)
D CT^IBNCPBB(IBTRN)
"KRN",101,7213,99)
60326,44829
"KRN",101,7236,-1)
0^5
"KRN",101,7236,0)
IBCNR STATUS INQUIRY LIST^e-Pharmacy Status Inquiry List^^M^^^^^^^^INTEGRATED BILLING
"KRN",101,7236,2,0)
^101.02A^^0
"KRN",101,7236,4)
40^5^^
"KRN",101,7236,10,0)
^101.01PA^1^1
"KRN",101,7236,10,1,0)
7237^SH^1^^^Show details for a Group Plan status
"KRN",101,7236,10,1,"^")
IBCNR STATUS INQUIRY DETAIL
"KRN",101,7236,26)
D SHOW^VALM
"KRN",101,7236,28)
Select Action:
"KRN",101,7236,99)
60326,44830
"KRN",101,7237,-1)
0^4
"KRN",101,7237,0)
IBCNR STATUS INQUIRY DETAIL^Show details for a Group Plan status^^A^^^^^^^^INTEGRATED BILLING
"KRN",101,7237,20)
D SEL^IBCNRPS2
"KRN",101,7237,99)
60326,44830
"KRN",101,7385,-1)
0^6
"KRN",101,7385,0)
IBNCPDP PRTCL CT MENU^ECME Claims Tracking Menu^^M^^^^^^^^INTEGRATED BILLING
"KRN",101,7385,4)
26^4
"KRN",101,7385,10,0)
^101.01PA^5^5
"KRN",101,7385,10,1,0)
473^BI^1^
"KRN",101,7385,10,1,"^")
IBTRED BILLING INFO
"KRN",101,7385,10,2,0)
475^TA^3^
"KRN",101,7385,10,2,"^")
IBTRED PRECERT INFO
"KRN",101,7385,10,3,0)
474^RI^2^
"KRN",101,7385,10,3,"^")
IBTRED UR INFO
"KRN",101,7385,10,4,0)
7213^SE^4^
"KRN",101,7385,10,4,"^")
IBTRED SUBMIT ECME
"KRN",101,7385,10,5,0)
7414^EX^5^
"KRN",101,7385,10,5,"^")
IBNCPDP PRTCL CT EXIT
"KRN",101,7385,15)
I $G(IBFASTXT)=1 S VALMBCK="Q"
"KRN",101,7385,26)
D SHOW^VALM
"KRN",101,7385,28)
Select Action:
"KRN",101,7385,99)
60326,44830
"KRN",101,7414,-1)
0^10
"KRN",101,7414,0)
IBNCPDP PRTCL CT EXIT^Exit^^A^^^^^^^^
"KRN",101,7414,99)
60326,44830
"KRN",101,7415,-1)
0^11
"KRN",101,7415,0)
IBNCPDP VIEW ELIGIBILITY^View Eligibility Menu (NCPDP)^^M^^^^^^^^INTEGRATED BILLING
"KRN",101,7415,4)
26^4
"KRN",101,7415,10,0)
^101.01PA^1^1
"KRN",101,7415,10,1,0)
7414^EX^1^
"KRN",101,7415,10,1,"^")
IBNCPDP PRTCL CT EXIT
"KRN",101,7415,15)
I $G(IBFASTXT)>2 S VALMBCK="Q"
"KRN",101,7415,20)
K IBFASTXT
"KRN",101,7415,26)
D BM^IBJU1(21,21),SHOW^VALM
"KRN",101,7415,28)
Select Action:
"KRN",101,7415,99)
60326,44830
"KRN",101,7437,-1)
0^12
"KRN",101,7437,0)
IBNCPDP PATIENT INSURANCE^Patient Insurance^^M^^^^^^^^INTEGRATED BILLING
"KRN",101,7437,4)
26^4
"KRN",101,7437,10,0)
^101.01PA^6^6
"KRN",101,7437,10,2,0)
7441^AB^12^
"KRN",101,7437,10,2,"^")
IBNCPDP VIEW AN BEN
"KRN",101,7437,10,3,0)
7443^VP^11^
"KRN",101,7437,10,3,"^")
IBNCPDP VIEW EXP POL
"KRN",101,7437,10,4,0)
7442^BU^21^
"KRN",101,7437,10,4,"^")
IBNCPDP VIEW BEN USED
"KRN",101,7437,10,5,0)
7444^EX^31^
"KRN",101,7437,10,5,"^")
IBNCPDP QUIT
"KRN",101,7437,10,6,0)
7438^INS^22^
"KRN",101,7437,10,6,"^")
IBNCPDP VIEW INSURANCE CO
"KRN",101,7437,15)
I $G(IBFASTXT)=1 S VALMBCK="Q"
"KRN",101,7437,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,7437,26)
D SHOW^VALM
"KRN",101,7437,28)
Select Action:
"KRN",101,7437,99)
60326,44830
"KRN",101,7438,-1)
0^13
"KRN",101,7438,0)
IBNCPDP VIEW INSURANCE CO^View Insurance Co.^^A^^^^^^^^INTEGRATED BILLING
"KRN",101,7438,20)
D INSVIEW^IBNCPDPV
"KRN",101,7438,99)
60326,44830
"KRN",101,7441,-1)
0^14
"KRN",101,7441,0)
IBNCPDP VIEW AN BEN^Annual Benefits^^A^^^^^^^^INTEGRATED BILLING
"KRN",101,7441,4)
^^^VB
"KRN",101,7441,20)
D NXT^IBCNSV("IBCNS VIEW AN BEN")
"KRN",101,7441,99)
60326,44830
"KRN",101,7442,-1)
0^16
"KRN",101,7442,0)
IBNCPDP VIEW BEN USED^Benefits Used^^A^^^^^^^^INTEGRATED BILLING
"KRN",101,7442,4)
^^^VU
"KRN",101,7442,15)
I $G(IBFASTXT)=1 S VALMBCK="Q"
"KRN",101,7442,20)
D NXT^IBCNSV("IBCNS VIEW BEN USED")
"KRN",101,7442,99)
60326,44830
"KRN",101,7443,-1)
0^15
"KRN",101,7443,0)
IBNCPDP VIEW EXP POL^View Policy Info^^A^^^^^^^^INTEGRATED BILLING
"KRN",101,7443,4)
^^^VP
"KRN",101,7443,15)
I $G(IBFASTXT)=1 S VALMBCK="Q"
"KRN",101,7443,20)
D NXT^IBCNSV("IBCNS VIEW EXP POL")
"KRN",101,7443,99)
60326,44830
"KRN",101,7444,-1)
0^17
"KRN",101,7444,0)
IBNCPDP QUIT^Exit^^A^^^^^^^^INTEGRATED BILLING
"KRN",101,7444,4)
^^^EX
"KRN",101,7444,15)
S VALMBCK="Q"
"KRN",101,7444,20)
S VALMBCK="Q"
"KRN",101,7444,99)
60326,44830
"KRN",409.61,563,-1)
0^1
"KRN",409.61,563,0)
IBCNR PLAN STATUS INQUIRY^1^^80^7^20^0^1^Status Inquiry^IBCNR STATUS INQUIRY LIST^Group Plan Status Inquiry^1^^1
"KRN",409.61,563,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,563,"ARRAY")
 ^TMP("IBCNR",$J,"SI")
"KRN",409.61,563,"COL",0)
^409.621^6^6
"KRN",409.61,563,"COL",1,0)
NUMBER^1^4
"KRN",409.61,563,"COL",2,0)
GNAME^5^15^Group Name
"KRN",409.61,563,"COL",3,0)
GNUM^22^17^Group Number
"KRN",409.61,563,"COL",4,0)
TYPE^42^13^Type of Plan
"KRN",409.61,563,"COL",5,0)
PHARM^57^13^Plan ID
"KRN",409.61,563,"COL",6,0)
COV^72^8^Pln Stat
"KRN",409.61,563,"COL","B","COV",6)

"KRN",409.61,563,"COL","B","GNAME",2)

"KRN",409.61,563,"COL","B","GNUM",3)

"KRN",409.61,563,"COL","B","NUMBER",1)

"KRN",409.61,563,"COL","B","PHARM",5)

"KRN",409.61,563,"COL","B","TYPE",4)

"KRN",409.61,563,"FNL")
D EXIT^IBCNRPS2
"KRN",409.61,563,"HDR")
D HDR^IBCNRPS2
"KRN",409.61,563,"HLP")
D HELP^IBCNRPS2
"KRN",409.61,563,"INIT")
D INIT^IBCNRPS2
"KRN",409.61,596,-1)
0^2
"KRN",409.61,596,0)
IBNCPDP INSURANCE MANAGEMENT^1^^160^5^17^1^1^Policy^IBCNSM  INSURANCE MANAGEMENT^NCPDP Insurance Management^4^^1
"KRN",409.61,596,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,596,"ARRAY")
 ^TMP("IBNSM",$J)
"KRN",409.61,596,"COL",0)
^409.621^14^14
"KRN",409.61,596,"COL",1,0)
NUMBER^1^4^^^0
"KRN",409.61,596,"COL",2,0)
NAME^5^15^Insurance Co.^^1
"KRN",409.61,596,"COL",3,0)
POLICY^134^15^Subscriber ID
"KRN",409.61,596,"COL",4,0)
GROUP^39^11^Group
"KRN",409.61,596,"COL",5,0)
HOLDER^52^8^Holder
"KRN",409.61,596,"COL",6,0)
EFFDT^61^9^Effect.
"KRN",409.61,596,"COL",7,0)
EXPIRE^72^9^Expires
"KRN",409.61,596,"COL",8,0)
TYPE^81^8^Type
"KRN",409.61,596,"COL",9,0)
VERIFIED BY^91^12^Verified By
"KRN",409.61,596,"COL",10,0)
VERIFIED ON^105^9^Date Ver.
"KRN",409.61,596,"COL",11,0)
PRECERT^116^5^Pre
"KRN",409.61,596,"COL",12,0)
UR^122^5^UR
"KRN",409.61,596,"COL",13,0)
COB^128^4^COB
"KRN",409.61,596,"COL",14,0)
TYPEPOL^22^15^Type of Policy
"KRN",409.61,596,"COL","AIDENT",0,1)

"KRN",409.61,596,"COL","AIDENT",1,2)

"KRN",409.61,596,"COL","B","COB",13)

"KRN",409.61,596,"COL","B","EFFDT",6)

"KRN",409.61,596,"COL","B","EXPIRE",7)

"KRN",409.61,596,"COL","B","GROUP",4)

"KRN",409.61,596,"COL","B","HOLDER",5)

"KRN",409.61,596,"COL","B","NAME",2)

"KRN",409.61,596,"COL","B","NUMBER",1)

"KRN",409.61,596,"COL","B","POLICY",3)

"KRN",409.61,596,"COL","B","PRECERT",11)

"KRN",409.61,596,"COL","B","TYPE",8)

"KRN",409.61,596,"COL","B","TYPEPOL",14)

"KRN",409.61,596,"COL","B","UR",12)

"KRN",409.61,596,"COL","B","VERIFIED BY",9)

"KRN",409.61,596,"COL","B","VERIFIED ON",10)

"KRN",409.61,596,"FNL")
D EXIT^IBNCPDPI
"KRN",409.61,596,"HDR")
D HDR^IBNCPDPI
"KRN",409.61,596,"HLP")

"KRN",409.61,596,"INIT")
D INIT^IBNCPDPI
"KRN",409.61,598,-1)
0^3
"KRN",409.61,598,0)
IBNCPDP LSTMN CT^1^^80^5^18^1^1^LM template for CT Edit Screen^IBNCPDP PRTCL CT MENU^CLAIMS TRACKING EDIT^1^^1
"KRN",409.61,598,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,598,"ARRAY")
 ^TMP("IBTRED",$J)
"KRN",409.61,598,"FNL")
D EXIT^IBNCPDPC
"KRN",409.61,598,"HDR")
D HDR^IBNCPDPC
"KRN",409.61,598,"HLP")
D HELP^IBNCPDPC
"KRN",409.61,598,"INIT")
D INIT^IBNCPDPC
"KRN",409.61,601,-1)
0^4
"KRN",409.61,601,0)
IBNCPDP LSTMN ELIGIBILITY^1^^80^4^17^1^1^Eligibility^IBNCPDP VIEW ELIGIBILITY^Patient Eligibility^1^^1
"KRN",409.61,601,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,601,"ARRAY")
 ^TMP("IBJTEA",$J)
"KRN",409.61,601,"FNL")
D EXIT^IBNCPDPL
"KRN",409.61,601,"HDR")
D HDR^IBNCPDPL
"KRN",409.61,601,"HLP")
D HELP^IBNCPDPL
"KRN",409.61,601,"INIT")
D INIT^IBNCPDPL
"KRN",409.61,604,-1)
0^5
"KRN",409.61,604,0)
IBNCPDP VIEW PAT INS^1^^150^5^17^1^1^Policy^IBNCPDP PATIENT INSURANCE^Patient Insurance Information^4^^1
"KRN",409.61,604,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,604,"ARRAY")
 ^TMP("IBNSM",$J)
"KRN",409.61,604,"COL",0)
^409.621^14^14
"KRN",409.61,604,"COL",1,0)
NUMBER^1^4^^^0
"KRN",409.61,604,"COL",2,0)
NAME^5^15^Insurance Co.^^1
"KRN",409.61,604,"COL",3,0)
POLICY^134^15^Subscriber ID
"KRN",409.61,604,"COL",4,0)
GROUP^39^11^Group
"KRN",409.61,604,"COL",5,0)
HOLDER^52^8^Holder
"KRN",409.61,604,"COL",6,0)
EFFDT^61^9^Effect.
"KRN",409.61,604,"COL",7,0)
EXPIRE^72^9^Expires
"KRN",409.61,604,"COL",8,0)
TYPE^81^8^Type
"KRN",409.61,604,"COL",9,0)
VERIFIED BY^91^12^Verified By
"KRN",409.61,604,"COL",10,0)
VERIFIED ON^105^9^Date Ver.
"KRN",409.61,604,"COL",11,0)
PRECERT^116^5^Pre
"KRN",409.61,604,"COL",12,0)
UR^122^5^UR
"KRN",409.61,604,"COL",13,0)
COB^128^4^COB
"KRN",409.61,604,"COL",14,0)
TYPEPOL^22^15^Type of Policy
"KRN",409.61,604,"COL","AIDENT",0,1)

"KRN",409.61,604,"COL","AIDENT",1,2)

"KRN",409.61,604,"COL","B","COB",13)

"KRN",409.61,604,"COL","B","EFFDT",6)

"KRN",409.61,604,"COL","B","EXPIRE",7)

"KRN",409.61,604,"COL","B","GROUP",4)

"KRN",409.61,604,"COL","B","HOLDER",5)

"KRN",409.61,604,"COL","B","NAME",2)

"KRN",409.61,604,"COL","B","NUMBER",1)

"KRN",409.61,604,"COL","B","POLICY",3)

"KRN",409.61,604,"COL","B","PRECERT",11)

"KRN",409.61,604,"COL","B","TYPE",8)

"KRN",409.61,604,"COL","B","TYPEPOL",14)

"KRN",409.61,604,"COL","B","UR",12)

"KRN",409.61,604,"COL","B","VERIFIED BY",9)

"KRN",409.61,604,"COL","B","VERIFIED ON",10)

"KRN",409.61,604,"FNL")
D EXIT^IBNCPDPV
"KRN",409.61,604,"HDR")
D HDR^IBNCPDPV
"KRN",409.61,604,"HLP")
D HELP^IBNCPDPV
"KRN",409.61,604,"INIT")
D INIT^IBNCPDPV
"MBREQ")
1
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",219,-1)
1^1
"PKG",219,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",219,20,0)
^9.402P^1^1
"PKG",219,20,1,0)
2^^IBAXDR
"PKG",219,20,1,1)

"PKG",219,20,"B",2,1)

"PKG",219,22,0)
^9.49I^1^1
"PKG",219,22,1,0)
2.0^3021025^2940519
"PKG",219,22,1,"PAH",1,0)
276^3060324^73331
"PKG",219,22,1,"PAH",1,1,0)
^^4^4^3060324
"PKG",219,22,1,"PAH",1,1,1,0)
HIPAA NCPDP Global project
"PKG",219,22,1,"PAH",1,1,2,0)
 
"PKG",219,22,1,"PAH",1,1,3,0)
supports the electronic transmission outpatient prescription claims and 
"PKG",219,22,1,"PAH",1,1,4,0)
billing collection and management.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
55
"RTN","IB20P276")
0^9^B43263639
"RTN","IB20P276",1,0)
IB20P276 ;DALOI/AAT - POST INIT ACTION ;24-JUN-2003
"RTN","IB20P276",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IB20P276",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IB20P276",4,0)
 ;
"RTN","IB20P276",5,0)
 ;
"RTN","IB20P276",6,0)
 ;  Post Init Description: This init will resolve the pointer issues
"RTN","IB20P276",7,0)
 ;  for the new entries required in 350.2 and the update need in
"RTN","IB20P276",8,0)
 ;  file 399.1. This post init is associated with path *132*.
"RTN","IB20P276",9,0)
 ;
"RTN","IB20P276",10,0)
 Q
"RTN","IB20P276",11,0)
 ;
"RTN","IB20P276",12,0)
 ;
"RTN","IB20P276",13,0)
EN ;
"RTN","IB20P276",14,0)
 D BMES^XPDUTL(">>> Adding/modifying CLAIMS TRACKING NON-BILLABLE REASONS in the file #356.8")
"RTN","IB20P276",15,0)
 D NEWNBR
"RTN","IB20P276",16,0)
 ;
"RTN","IB20P276",17,0)
 ;Temporary:
"RTN","IB20P276",18,0)
 D BMES^XPDUTL(">>> Correcting the BPS CLAIM file, field #900 'CLOSE REASON'")
"RTN","IB20P276",19,0)
 D BPSFIX
"RTN","IB20P276",20,0)
 D BMES^XPDUTL(">>> Correcting 'CLOSE REASON' in the temporary IB events log")
"RTN","IB20P276",21,0)
 D LOGFIX
"RTN","IB20P276",22,0)
 ;
"RTN","IB20P276",23,0)
 D BMES^XPDUTL(">>> Enable menu option 'IBCNR EDIT HIPAA NCPDP FLAG'")
"RTN","IB20P276",24,0)
 D OPT
"RTN","IB20P276",25,0)
 ;
"RTN","IB20P276",26,0)
 D BMES^XPDUTL(">>> Reviewing and correcting the PLAN file entries")
"RTN","IB20P276",27,0)
 D ^IBCNRXI1
"RTN","IB20P276",28,0)
 ;
"RTN","IB20P276",29,0)
 D BMES^XPDUTL(">>> All POST-INIT Activities have been completed. <<<")
"RTN","IB20P276",30,0)
 Q
"RTN","IB20P276",31,0)
 ;
"RTN","IB20P276",32,0)
NEWNBR ; Add/Modify IB non-billable reasons #356.8
"RTN","IB20P276",33,0)
 N IBI,IBY,IBMES
"RTN","IB20P276",34,0)
 F IBI=1:1 S IBY=$P($T(REASONS+IBI),";;",2,255) Q:'IBY  D
"RTN","IB20P276",35,0)
 . N IBNAME,IBE02,IBE03,IBL,IBIEN
"RTN","IB20P276",36,0)
 . S IBNAME=$P(IBY,U,2) Q:IBNAME=""
"RTN","IB20P276",37,0)
 . S IBE02=$P(IBY,U,3)
"RTN","IB20P276",38,0)
 . S IBE03=$P(IBY,U,4)
"RTN","IB20P276",39,0)
 . S $E(IBL,33-$L(IBNAME))=" "
"RTN","IB20P276",40,0)
 . S IBMES="  "_$J(IBI,2)_"  "_IBNAME_IBL
"RTN","IB20P276",41,0)
 . S IBIEN=$O(^IBE(356.8,"B",IBNAME,0))
"RTN","IB20P276",42,0)
 . S:IBIEN="" IBIEN=0
"RTN","IB20P276",43,0)
 . S:$G(^IBE(356.8,IBIEN,0))="" IBIEN=0
"RTN","IB20P276",44,0)
 . I IBIEN S IBMES=IBMES_" Already on file"
"RTN","IB20P276",45,0)
 . I 'IBIEN D
"RTN","IB20P276",46,0)
 .. N IBRT,IBIEN,IBERR,IBCNT
"RTN","IB20P276",47,0)
 .. S IBCNT=0
"RTN","IB20P276",48,0)
 .. S IBRT(356.8,"+1,",.01)=IBNAME
"RTN","IB20P276",49,0)
 .. S IBRT(356.8,"+1,",.02)=IBE02
"RTN","IB20P276",50,0)
 .. S IBRT(356.8,"+1,",.03)=IBE03
"RTN","IB20P276",51,0)
 .. D UPDATE^DIE("","IBRT","IBIEN","IBERR")
"RTN","IB20P276",52,0)
 .. I $D(IBERR) D  S IBCNT=IBCNT+1
"RTN","IB20P276",53,0)
 ... N Y S Y="" F  S Y=$O(IBERR(Y)) Q:Y=""  D
"RTN","IB20P276",54,0)
 .... S IBMES=IBMES_" *** Error: "_$G(IBERR(Y,1,"TEXT",1))
"RTN","IB20P276",55,0)
 . I IBIEN D
"RTN","IB20P276",56,0)
 .. S $P(^IBE(356.8,IBIEN,0),U,2)=IBE02
"RTN","IB20P276",57,0)
 .. S $P(^IBE(356.8,IBIEN,0),U,3)=IBE03
"RTN","IB20P276",58,0)
 . D MES^XPDUTL(IBMES)
"RTN","IB20P276",59,0)
 Q
"RTN","IB20P276",60,0)
 ;
"RTN","IB20P276",61,0)
 ;
"RTN","IB20P276",62,0)
OPT ; Enable the menu option "IBCNR EDIT HIPAA NCPDP FLAG" 
"RTN","IB20P276",63,0)
 N IEN,IBRT,IBERR
"RTN","IB20P276",64,0)
 S IEN=$O(^DIC(19,"B","IBCNR EDIT HIPAA NCPDP FLAG",""))
"RTN","IB20P276",65,0)
 I 'IEN D BMES^XPDUTL(" *** Error: option 'IBCNR EDIT HIPAA NCPDP FLAG' not found") Q
"RTN","IB20P276",66,0)
 S IBRT(19,IEN_",",2)="@"
"RTN","IB20P276",67,0)
 D FILE^DIE("E","IBRT","IBERR")
"RTN","IB20P276",68,0)
 I $D(IBERR) D
"RTN","IB20P276",69,0)
 . N Y S Y="" F  S Y=$O(IBERR(Y)) Q:Y=""  D
"RTN","IB20P276",70,0)
 .. D BMES^XPDUTL(" *** Error: "_$G(IBERR(Y,1,"TEXT",1)))
"RTN","IB20P276",71,0)
 Q
"RTN","IB20P276",72,0)
 ;
"RTN","IB20P276",73,0)
 ;
"RTN","IB20P276",74,0)
 ; *** Not implemented ***
"RTN","IB20P276",75,0)
ADDUSR ; Add the user to the New Person file (#200)
"RTN","IB20P276",76,0)
 Q
"RTN","IB20P276",77,0)
 N DIC,X,Y,DO,DD,DLAYGO,IBNAME
"RTN","IB20P276",78,0)
 S IBNAME="E-PHARMACY"
"RTN","IB20P276",79,0)
 S DIC(0)="",DIC="^VA(200,",X=IBNAME D ^DIC
"RTN","IB20P276",80,0)
 I Y>0 D  Q
"RTN","IB20P276",81,0)
 . D BMES^XPDUTL("User "_IBNAME_" already exists in the NEW PERSON file - not added")
"RTN","IB20P276",82,0)
 D BMES^XPDUTL("Adding new user, "_IBNAME_", to the NEW PERSON file")
"RTN","IB20P276",83,0)
 S DLAYGO=200,DIC(0)="L",DIC="^VA(200,",DIC("DR")="1////MRA",X=IBNAME D FILE^DICN K DIC,DO,DD,DLAYGO
"RTN","IB20P276",84,0)
 I Y'>0 D  Q
"RTN","IB20P276",85,0)
 . D BMES^XPDUTL("A problem was encountered trying to add user, "_IBNAME)
"RTN","IB20P276",86,0)
 . D BMES^XPDUTL("The entry must be added manually to the NEW PERSON file")
"RTN","IB20P276",87,0)
 ;
"RTN","IB20P276",88,0)
 D BMES^XPDUTL("User, "_IBNAME_", was successfully added to the NEW PERSON file")
"RTN","IB20P276",89,0)
 Q
"RTN","IB20P276",90,0)
 ;
"RTN","IB20P276",91,0)
 ;Temporary Clean-up procedure to eliminate QTY-DAYS SUPPLY switching
"RTN","IB20P276",92,0)
VERIFY(IBIFN,IBRX,IBFIL) ;check and correct
"RTN","IB20P276",93,0)
 N IBX,QTY,DSUPP,IBZ,IBRXZ
"RTN","IB20P276",94,0)
 S IBRXZ=$G(^PSRX(IBRX,1,IBFIL,0)) Q:IBRXZ=""
"RTN","IB20P276",95,0)
 S QTY=+$P(IBRXZ,U,4) Q:'QTY  Q:QTY>999
"RTN","IB20P276",96,0)
 S DSUPP=+$P(IBRXZ,U,10) Q:'DSUPP  Q:DSUPP>90
"RTN","IB20P276",97,0)
 ;
"RTN","IB20P276",98,0)
 S IBX=0 F  S IBX=$O(^IBA(362.4,"C",IBIFN,IBX)) Q:'IBX  D
"RTN","IB20P276",99,0)
 . ;W !,IBIFN,?10," ",IBRX,?22," ",IBFIL
"RTN","IB20P276",100,0)
 . S IBZ=$G(^IBA(362.4,IBX,0)) Q:IBZ=""
"RTN","IB20P276",101,0)
 . I QTY=+$P(IBZ,U,7),DSUPP=+$P(IBZ,U,6) Q
"RTN","IB20P276",102,0)
 . ;W " *** INCORRECT: QTY/DAYS=",+$P(IBZ,U,7),"/",+$P(IBZ,U,6),", MUST BE ",QTY,"/",DSUPP
"RTN","IB20P276",103,0)
 . D SETQTY(IBX,QTY,DSUPP)
"RTN","IB20P276",104,0)
 Q
"RTN","IB20P276",105,0)
SETQTY(IBX,QTY,DSUPP) ;
"RTN","IB20P276",106,0)
 N IBRT,IBERR
"RTN","IB20P276",107,0)
 S IBRT(362.4,IBX_",",.06)=DSUPP
"RTN","IB20P276",108,0)
 S IBRT(362.4,IBX_",",.07)=QTY
"RTN","IB20P276",109,0)
 D FILE^DIE("","IBRT","IBERR")
"RTN","IB20P276",110,0)
 ;I $D(IBERR) W ! ZW IBERR
"RTN","IB20P276",111,0)
 Q
"RTN","IB20P276",112,0)
 ;
"RTN","IB20P276",113,0)
 ;
"RTN","IB20P276",114,0)
GETRX(IBIFN) ;Get Rx from 362.4
"RTN","IB20P276",115,0)
 N IBX,IBRX,IBRXN
"RTN","IB20P276",116,0)
 S IBRX=0
"RTN","IB20P276",117,0)
 S IBX=+$O(^IBA(362.4,"C",+IBIFN,""))
"RTN","IB20P276",118,0)
 S IBRXN=$P($G(^IBA(362.4,IBX,0)),U)
"RTN","IB20P276",119,0)
 I IBRXN'="" S IBRX=+$O(^PSRX("B",IBRXN,0))
"RTN","IB20P276",120,0)
 Q IBRX
"RTN","IB20P276",121,0)
 ;
"RTN","IB20P276",122,0)
BULL ; Generate a bulletin with modified bills.
"RTN","IB20P276",123,0)
 N IBGRP,XMDUZ,XMTEXT,XMSUB,XMY
"RTN","IB20P276",124,0)
 ;
"RTN","IB20P276",125,0)
 S XMSUB="FIXING 'CANCELLATION' IN NCPDP ZERO BILLS"
"RTN","IB20P276",126,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="^TMP("_$J_",""IB20P276"","
"RTN","IB20P276",127,0)
 S XMY(DUZ)=""
"RTN","IB20P276",128,0)
 S XMY("G.PRCA ERROR")=""
"RTN","IB20P276",129,0)
 D ^XMD
"RTN","IB20P276",130,0)
 Q
"RTN","IB20P276",131,0)
 ;
"RTN","IB20P276",132,0)
 ;
"RTN","IB20P276",133,0)
SETSTA(IBIFN) ; set the status
"RTN","IB20P276",134,0)
 N IBIENS,IBFDA,IBERR
"RTN","IB20P276",135,0)
 S IBIENS=IBIFN_","
"RTN","IB20P276",136,0)
 S IBFDA(430,IBIENS,8)="COLLECTED/CLOSED"
"RTN","IB20P276",137,0)
 D FILE^DIE("E","IBFDA","IBERR")
"RTN","IB20P276",138,0)
 Q '$D(IBERR)
"RTN","IB20P276",139,0)
 ;
"RTN","IB20P276",140,0)
BPSFIX ;CONVERT OLD BPS CODES
"RTN","IB20P276",141,0)
 N I,IBZ,IBY,IBC,IBOTH,IBT,ZNODE
"RTN","IB20P276",142,0)
 S ZNODE="BPSIB-CONVERT-9002313.02-904"
"RTN","IB20P276",143,0)
 I $D(^XTMP(ZNODE,0)) D MES^XPDUTL("*** Already converted") Q
"RTN","IB20P276",144,0)
 F I=1:1 S IBY=$P($T(REASONS+I),";;",2,255) Q:'IBY  S IBC(+IBY)=$O(^IBE(356.8,"B",$P(IBY,U,2),0))
"RTN","IB20P276",145,0)
 S IBOTH=$O(^IBE(356.8,"B","OTHER",0))
"RTN","IB20P276",146,0)
 S I=0 F  S I=$O(^BPSC(I)) Q:'I  S IBZ=$G(^(I,0)) D:$P(IBZ,U,7)=""
"RTN","IB20P276",147,0)
 . N IBOLD,IBNEW
"RTN","IB20P276",148,0)
 . S IBOLD=$P($G(^BPSC(I,900)),U,4) Q:IBOLD=""
"RTN","IB20P276",149,0)
 . S IBNEW=+$G(IBC(IBOLD)) S:'IBNEW IBNEW=IBOTH
"RTN","IB20P276",150,0)
 . ;W !,"I=",I,?10,"CODE=",IBOLD,",   NEW=",IBNEW
"RTN","IB20P276",151,0)
 . S $P(^BPSC(I,900),U,4)=IBNEW
"RTN","IB20P276",152,0)
 . S $P(^BPSC(I,0),U,7)=0  ; as a flag to avoid double conversion
"RTN","IB20P276",153,0)
 S ^XTMP(ZNODE,0)=$$FMADD^XLFDT(DT,365)_U_DT_U_"BPS CONVERSION FLAG"
"RTN","IB20P276",154,0)
 Q
"RTN","IB20P276",155,0)
 ;
"RTN","IB20P276",156,0)
LOGFIX ;CONVERT CLOSE REASON IN THE IB LOG
"RTN","IB20P276",157,0)
 N I,J,IBNODE,IBZ,IBY,IBC,IBOTH,IBT,IBDROP
"RTN","IB20P276",158,0)
 F I=1:1 S IBY=$P($T(REASONS+I),";;",2,255) Q:'IBY  S IBC(+IBY)=$O(^IBE(356.8,"B",$P(IBY,U,2),0))
"RTN","IB20P276",159,0)
 S IBOTH=$O(^IBE(356.8,"B","OTHER",0))
"RTN","IB20P276",160,0)
 ;
"RTN","IB20P276",161,0)
 S (I,IBNODE)="IBNCPDP-"
"RTN","IB20P276",162,0)
 F  S I=$O(^XTMP(I)) Q:I'[IBNODE  D
"RTN","IB20P276",163,0)
 . S J=0 F  S J=$O(^XTMP(I,J)) Q:'J  D
"RTN","IB20P276",164,0)
 .. I '$D(^XTMP(I,J,"IBD","CLOSE REASON")) Q
"RTN","IB20P276",165,0)
 .. I $D(^XTMP(I,J,"IBD","DROP TO PAPER")) Q  ; Already converted
"RTN","IB20P276",166,0)
 .. N IBOLD,IBNEW
"RTN","IB20P276",167,0)
 .. S IBOLD=$G(^XTMP(I,J,"IBD","CLOSE REASON")) Q:IBOLD=""
"RTN","IB20P276",168,0)
 .. S IBNEW=+$G(IBC(IBOLD)) S:'IBNEW IBNEW=IBOTH
"RTN","IB20P276",169,0)
 .. ;W !,"I=",I,",  J=",J,",",?15,"CODE=",IBOLD,",   NEW=",IBNEW
"RTN","IB20P276",170,0)
 .. S ^XTMP(I,J,"IBD","CLOSE REASON")=IBNEW
"RTN","IB20P276",171,0)
 .. S ^XTMP(I,J,"IBD","DROP TO PAPER")=(IBOLD=1)  ;flag to avoid double conversion
"RTN","IB20P276",172,0)
 Q
"RTN","IB20P276",173,0)
 ;
"RTN","IB20P276",174,0)
REASONS ;CLOSE REASON  to add/modify into file #356.8
"RTN","IB20P276",175,0)
 ;;2^NOT INSURED^1^0
"RTN","IB20P276",176,0)
 ;;3^SERVICE NOT COVERED^1^0
"RTN","IB20P276",177,0)
 ;;4^COVERAGE CANCELED^1^0
"RTN","IB20P276",178,0)
 ;;6^INVALID PRESCRIPTION ENTRY^1^0
"RTN","IB20P276",179,0)
 ;;7^PRESCRIPTION DELETED^1^0
"RTN","IB20P276",180,0)
 ;;8^PRESCRIPTION NOT RELEASED^1^0
"RTN","IB20P276",181,0)
 ;;5^DRUG NOT BILLABLE^1^0
"RTN","IB20P276",182,0)
 ;;10^90 DAY RX FILL NOT COVERED^1^1
"RTN","IB20P276",183,0)
 ;;11^NOT A CONTRACTED PROVIDER^1^1
"RTN","IB20P276",184,0)
 ;;12^INVALID MULTIPLES PER DAY SUPP^1^0
"RTN","IB20P276",185,0)
 ;;13^REFILL TOO SOON^1^0
"RTN","IB20P276",186,0)
 ;;9^INVALID NDC FROM CMOP^1^0
"RTN","IB20P276",187,0)
 ;;1^OTHER^1^1
"RTN","IB20P276",188,0)
 ;;
"RTN","IBCC")
0^58^B35414312
"RTN","IBCC",1,0)
IBCC ;ALB/MJB - CANCEL UB-82 THIRD PARTY BILL ;14 JUN 88  10:12
"RTN","IBCC",2,0)
 ;;2.0;INTEGRATED BILLING;**2,19,77,80,51,142,137,161,199,241,155,276**;21-MAR-94
"RTN","IBCC",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCC",4,0)
 ;
"RTN","IBCC",5,0)
 ;MAP TO DGCRC
"RTN","IBCC",6,0)
 ;
"RTN","IBCC",7,0)
 I '$D(IBCAN) S IBCAN=1
"RTN","IBCC",8,0)
ASK ;
"RTN","IBCC",9,0)
 ;***
"RTN","IBCC",10,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBCC" D T1^%ZOSV ;stop rt clock
"RTN","IBCC",11,0)
 ;S XRTL=$ZU(0),XRTN="IBCC-1" D T0^%ZOSV ;start rt clock
"RTN","IBCC",12,0)
 ;
"RTN","IBCC",13,0)
 ; If called at entry point PROCESS, variable IBNOASK will exist.
"RTN","IBCC",14,0)
 ; First time through, IBNOASK=1
"RTN","IBCC",15,0)
 ; Second time through, IBNOASK=2 and it will quit
"RTN","IBCC",16,0)
 I $G(IBNOASK)=2 G Q
"RTN","IBCC",17,0)
 I $G(IBNOASK)=1 S IBNOASK=2
"RTN","IBCC",18,0)
 ;
"RTN","IBCC",19,0)
 G Q:$G(IBCE("EDI"))
"RTN","IBCC",20,0)
 D Q
"RTN","IBCC",21,0)
 S IBQUIT=0
"RTN","IBCC",22,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCC",23,0)
 I '$G(IBNOASK) S DIC="^DGCR(399,",DIC(0)="AEMQZ",DIC("A")="Enter BILL NUMBER or Patient NAME: " W !! D ^DIC I Y<1 S IBQUIT=1 G Q1
"RTN","IBCC",24,0)
 K IB364
"RTN","IBCC",25,0)
NOPTF ; Note if IB364 is >0 it will be used as the ien to update in file 364
"RTN","IBCC",26,0)
 N DA,I
"RTN","IBCC",27,0)
 I '$G(IBNOASK) S IBIFN=+$G(Y)
"RTN","IBCC",28,0)
 I '$G(IBIFN) G ASK
"RTN","IBCC",29,0)
 I IBCAN>1 D NOPTF^IBCB2 I 'IBAC1 D NOPTF1^IBCB2 G ASK
"RTN","IBCC",30,0)
 ; Check if bill has been referred to Counsel
"RTN","IBCC",31,0)
 I $P($G(^PRCA(430,IBIFN,6)),U,4) D  G ASK
"RTN","IBCC",32,0)
 . W !,"This bill has been referred to Regional Counsel and cannot be 'CANCELLED' in"
"RTN","IBCC",33,0)
 . W !,"Integrated Billing.  Please use the option 'TP Referred Follow-up'"
"RTN","IBCC",34,0)
 . W !,"[PRCA RC ACTION MENU] in Accounts Receivable to request that Regional"
"RTN","IBCC",35,0)
 . W !,"Counsel return the bill to your facility."
"RTN","IBCC",36,0)
 . Q
"RTN","IBCC",37,0)
 ;
"RTN","IBCC",38,0)
 ;
"RTN","IBCC",39,0)
 F I=0,"S","U1" S IB(I)=$G(^DGCR(399,IBIFN,I))
"RTN","IBCC",40,0)
 S IBSTAT=$P(IB(0),U,13)
"RTN","IBCC",41,0)
 ;
"RTN","IBCC",42,0)
 ; Restrict access to this process for REQUEST MRA bills
"RTN","IBCC",43,0)
 I IBSTAT=2,'$G(IBCE("EDI")),$$MRAWL^IBCEMU2(IBIFN) D  G ASK
"RTN","IBCC",44,0)
 . W !!?4,"This bill is in a status of REQUEST MRA and it does appear on the"
"RTN","IBCC",45,0)
 . W !?4,"MRA Management Work List.  Please use the 'MRA Management Menu' options"
"RTN","IBCC",46,0)
 . W !?4,"for all processing related to this bill."
"RTN","IBCC",47,0)
 . Q
"RTN","IBCC",48,0)
 ;
"RTN","IBCC",49,0)
 ; Warning message if in a REQUEST MRA status with no MRA on file
"RTN","IBCC",50,0)
 I IBSTAT=2,'$$MRACNT^IBCEMU1(IBIFN) D
"RTN","IBCC",51,0)
 . N REJ
"RTN","IBCC",52,0)
 . D TXSTS^IBCEMU2(IBIFN,,.REJ)
"RTN","IBCC",53,0)
 . W *7,!!?4,"Warning!  This bill is in a status of REQUEST MRA."
"RTN","IBCC",54,0)
 . W !?4,"No MRAs have been received"
"RTN","IBCC",55,0)
 . I REJ W ", but the most recent transmission of this",!?4,"MRA request bill was rejected."
"RTN","IBCC",56,0)
 . I 'REJ W " and there are no rejection messages on file",!?4,"for the most recent transmission of this MRA request bill."
"RTN","IBCC",57,0)
 . Q
"RTN","IBCC",58,0)
 ;
"RTN","IBCC",59,0)
 I IBCAN=2,IB("S")]"",+$P(IB("S"),U,16),$P(IB("S"),U,17)]"" D  G 1
"RTN","IBCC",60,0)
 . W !!,"This bill was cancelled on " S Y=$P(IB("S"),U,17) X ^DD("DD") W Y," by ",$S($P(IB("S"),U,18)']"":IBU,$D(^VA(200,$P(IB("S"),U,18),0)):$P(^(0),U,1),1:IBU),"."
"RTN","IBCC",61,0)
 . S IBQUIT=1
"RTN","IBCC",62,0)
 ; Notify if a payment has been posted to this bill before cancel
"RTN","IBCC",63,0)
 N PRCABILL
"RTN","IBCC",64,0)
 S PRCABILL=$$TPR^PRCAFN(IBIFN)
"RTN","IBCC",65,0)
 I PRCABILL=-1 W !!,"Please note: PRCA was unable to determine if a payment has been posted."
"RTN","IBCC",66,0)
 I PRCABILL>0 W !!,"Please note a PAYMENT of **$"_$$TPR^PRCAFN(IBIFN)_"** has been POSTED to this bill."
"RTN","IBCC",67,0)
 ; if bill was created via Electronic claims process then notify
"RTN","IBCC",68,0)
 ; user that cancellation should occur using ECME package
"RTN","IBCC",69,0)
 I $$GET1^DIQ(399,IBIFN_",",460)]"" D  G:'Y ASK
"RTN","IBCC",70,0)
 . W !!!?5,"This bill was created by the"
"RTN","IBCC",71,0)
 . W !?5,"Electronic Claims Management Engine (ECME)."
"RTN","IBCC",72,0)
 . W !?5,"Cancellation needs to occur in the ECME package by"
"RTN","IBCC",73,0)
 . W !?5,"submitting a REVERSAL to the Payer.",!!
"RTN","IBCC",74,0)
 . K DIR S DIR("A",1)="Has a REVERSAL for this e-Claim already been",DIR("A")="submitted to the payer via the ECME package (Y/N)",DIR(0)="Y",DIR("B")="NO" D ^DIR
"RTN","IBCC",75,0)
 . I Y=0 W !!,"<PLEASE SUBMIT A REVERSAL USING THE APPROPRIATE OPTION IN THE ECME PACKAGE>",$C(7)
"RTN","IBCC",76,0)
 ;
"RTN","IBCC",77,0)
CHK S (IBCCCC,IBQUIT)=0 I '$G(IBCEAUTO) W !!,"ARE YOU SURE YOU WANT TO CANCEL THIS BILL" S %=2 D YN^DICN G:%=0 HELP I %'=1 S IBQUIT=1 G NO
"RTN","IBCC",78,0)
 W:'$G(IBCEAUTO) !!,"LAST CHANCE TO CHANGE YOUR MIND..." S DIE("NO^")="",DIE="^DGCR(399,",DA=IBIFN,DR=$S($G(IBCEAUTO):"16////1;19////EDI/MRA TURNED OFF;S IBCCCC=1;",1:"16;S:'X Y=0;19;S IBCCCC=1;") D ^DIE K DIE,DR
"RTN","IBCC",79,0)
NO I 'IBCCCC W !!,"<NO ACTION TAKEN>",*7 S IBQUIT=1 G ASK:IBCAN<2,Q
"RTN","IBCC",80,0)
 W !!,"...Bill has been cancelled..." D BULL^IBCBULL,BSTAT^IBCDC(IBIFN),PRIOR^IBCCC2(IBIFN)
"RTN","IBCC",81,0)
 ;
"RTN","IBCC",82,0)
 ; cancelling in ingenix claimsmanager if ingenix is running
"RTN","IBCC",83,0)
 ; clean-up of variables is OK if not coming in from ListMan screen
"RTN","IBCC",84,0)
 I $$CM^IBCIUT1(IBIFN) S IBCISNT=4 D ST2^IBCIST I '$G(IBCICNCL) K IBCISNT,IBCISTAT,IBCIREDT,IBCIERR
"RTN","IBCC",85,0)
 ;
"RTN","IBCC",86,0)
 S IBEDI=$G(IB364)
"RTN","IBCC",87,0)
 I 'IBEDI S IBEDI=+$$LAST364^IBCEF4(IBIFN)
"RTN","IBCC",88,0)
 I IBEDI D UPDEDI^IBCEM(IBEDI,"C") ;Update EDI files, if needed
"RTN","IBCC",89,0)
 ;
"RTN","IBCC",90,0)
 F I="S","U1" S IB(I)=$S($D(^DGCR(399,IBIFN,I)):^(I),1:"")
"RTN","IBCC",91,0)
 S PRCASV("ARREC")=IBIFN,PRCASV("AMT")=$S(IB("U1")']"":0,1:$P(IB("U1"),"^")),PRCASV("DATE")=$P(IB("S"),"^",17),PRCASV("BY")=$P(IB("S"),"^",18)
"RTN","IBCC",92,0)
 S PRCASV("COMMENT")=$S($P(IB("S"),U,19)]"":$P(IB("S"),U,19),$P(^IBE(350.9,1,2),"^",7)]"":$P(^(2),"^",7),1:"BILL CANCELLED IN MAS")
"RTN","IBCC",93,0)
 S PRCASV("BY")=$S($P(IB("S"),U,18)]"":$P(IB("S"),U,18),1:"")
"RTN","IBCC",94,0)
 S X=$$CANCEL^RCBEIB($G(PRCASV("ARREC")),$G(PRCASV("DATE")),$G(PRCASV("BY")),$G(PRCASV("AMT")),$G(PRCASV("COMMENT")))
"RTN","IBCC",95,0)
 W !,$S(X:">> The receivable associated with the claim was cancelled.",1:">> The receivable associated with the claim was not cancelled.")
"RTN","IBCC",96,0)
 I $P(X,U,2)]"" W !,">>> ",$P(X,U,2) ; The reason why the claim can not be cancelled.
"RTN","IBCC",97,0)
 I IBCAN<2 D RNB^IBCC1 ;assign a reason not billable
"RTN","IBCC",98,0)
 G ASK:IBCAN<2,Q
"RTN","IBCC",99,0)
 ;
"RTN","IBCC",100,0)
HELP W !,?3,"Answer 'YES' or 'Y' if you wish to cancel this bill.",!,?3,"Answer 'NO' or 'N' if you want to abort." G CHK
"RTN","IBCC",101,0)
 Q
"RTN","IBCC",102,0)
1 I $P(IB(0),U,13)=1 W !,"This record was re-opened on " S Y=$P(IB(0),U,14) X ^DD("DD") W Y,"." G CHK
"RTN","IBCC",103,0)
 G ASK
"RTN","IBCC",104,0)
Q1 K:IBCAN=1 IBQUIT K IBCAN
"RTN","IBCC",105,0)
Q K %,IBEPAR,IBSTAT,IBARST,IBAC1,IB,DFN,IBX,IBZ,DIC,DIE,DR,PRCASV,PRCASVC,X,Y,IBEDI
"RTN","IBCC",106,0)
 ;***
"RTN","IBCC",107,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBCC" D T1^%ZOSV ;stop rt clock
"RTN","IBCC",108,0)
 Q
"RTN","IBCC",109,0)
 ;
"RTN","IBCC",110,0)
PROCESS(IBIFN,IBCAN) ;
"RTN","IBCC",111,0)
 ; Entry point when the bill number is already known.  Use this when
"RTN","IBCC",112,0)
 ; you just want to try to cancel this bill and this bill only.
"RTN","IBCC",113,0)
 ; Input:
"RTN","IBCC",114,0)
 ;   IBIFN - Internal bill# (Required)
"RTN","IBCC",115,0)
 ;   IBCAN - Cancel Flag (optional, defaults to 1 if not included)
"RTN","IBCC",116,0)
 ;
"RTN","IBCC",117,0)
 NEW IBNOASK
"RTN","IBCC",118,0)
 S IBNOASK=1
"RTN","IBCC",119,0)
 S IBCAN=$G(IBCAN,1)
"RTN","IBCC",120,0)
 G ASK
"RTN","IBCC",121,0)
 ;
"RTN","IBCC",122,0)
 ;IBCC
"RTN","IBCD4")
0^40^B16336305
"RTN","IBCD4",1,0)
IBCD4 ;ALB/ARH - AUTOMATED BILLER (ADD NEW BILL - GATHER DX AND PROCEDURES)  ;9/5/93
"RTN","IBCD4",2,0)
 ;;2.0;INTEGRATED BILLING;**14,80,106,160,309,276**;21-MAR-94
"RTN","IBCD4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCD4",4,0)
 ;
"RTN","IBCD4",5,0)
 ;
"RTN","IBCD4",6,0)
IDX(PTF,DT1,DT2) ; find 501 movement Diagnosis and 701 Discharge Diagnosisfor a PTF record within bill range
"RTN","IBCD4",7,0)
 ; check for billable bedsection and SC treatement and duplicates
"RTN","IBCD4",8,0)
 ; results: IBT = number of billable movements within date range
"RTN","IBCD4",9,0)
 ;          IBMSG(X)=" error message " if any errors found
"RTN","IBCD4",10,0)
 ;         ^TMP("IBDX",$J)= PTF IFN
"RTN","IBCD4",11,0)
 ;         ^TMP("IBDX",$J,DX)=""
"RTN","IBCD4",12,0)
 ;         ^TMP("IBDX",$J,-MOVE DATE, x) = Dx
"RTN","IBCD4",13,0)
 N IBMVT,IBN,IBDT,IBCNT,IBBS,IBSC,IBMV,IBDX,IBI,IBX K IBMSG,IBT,^TMP("IBDX",$J)
"RTN","IBCD4",14,0)
 ;
"RTN","IBCD4",15,0)
 D PTFDXDT^IBCSC4F(PTF,DT1,DT2) S IBMVT="M" I +$P($G(^TMP($J,"IBDX","D")),U,3) S IBMVT="D"
"RTN","IBCD4",16,0)
 ;
"RTN","IBCD4",17,0)
 S ^TMP("IBDX",$J)=+PTF S (IBT,IBBS,IBSC)=0,IBCNT=1
"RTN","IBCD4",18,0)
 F IBN="D","M" S IBDT="" F  S IBDT=$O(^TMP($J,"IBDX",IBN,IBDT)) Q:'IBDT  D
"RTN","IBCD4",19,0)
 . S IBMV=$G(^TMP($J,"IBDX",IBN,IBDT)) Q:IBMV=""
"RTN","IBCD4",20,0)
 . ;
"RTN","IBCD4",21,0)
 . I IBN="M" S IBT=IBT+1,IBX="" D  Q:+IBX
"RTN","IBCD4",22,0)
 .. I $P(IBMV,U,3)=1 S IBSC=IBSC+1,IBMSG(IBCNT)=$$FMTE^XLFDT(IBDT)_" movement related to an SC condition.",IBCNT=IBCNT+1,IBX=1
"RTN","IBCD4",23,0)
 .. I $P($G(^DIC(42.4,+$P(IBMV,U,2),0)),U,5)="" S IBBS=IBBS+1,IBMSG(IBCNT)=$$FMTE^XLFDT(IBDT)_" movement is for a non-billable bedsection.",IBCNT=IBCNT+1,IBX=1
"RTN","IBCD4",24,0)
 .. I '$P(IBMV,U,4) S IBMSG(IBCNT)=$$FMTE^XLFDT(IBDT)_" movement does not have a DRG as required for Reasonable Charges.",IBCNT=IBCNT+1
"RTN","IBCD4",25,0)
 . I IBN'=IBMVT Q
"RTN","IBCD4",26,0)
 . ;
"RTN","IBCD4",27,0)
 . S IBI="" F  S IBI=$O(^TMP($J,"IBDX",IBN,IBDT,IBI)) Q:'IBI  D
"RTN","IBCD4",28,0)
 .. S IBDX=$G(^TMP($J,"IBDX",IBN,IBDT,IBI)) Q:'IBDX
"RTN","IBCD4",29,0)
 .. I '$P(IBDX,U,2),IBDT>+$G(^TMP("IBDX",$J,"DX",+IBDX)) S ^TMP("IBDX",$J,"DX",+IBDX)=IBDT_U_IBI
"RTN","IBCD4",30,0)
 ;
"RTN","IBCD4",31,0)
 S IBDX="" F  S IBDX=$O(^TMP("IBDX",$J,"DX",IBDX)) Q:'IBDX  D
"RTN","IBCD4",32,0)
 . S IBX=^TMP("IBDX",$J,"DX",IBDX) I +IBX S ^TMP("IBDX",$J,-IBX,+$P(IBX,U,2))=IBDX
"RTN","IBCD4",33,0)
 K ^TMP($J,"IBDX")
"RTN","IBCD4",34,0)
 ;
"RTN","IBCD4",35,0)
 I +IBSC S IBMSG(IBCNT)="PTF record indicates "_+IBSC_" of "_IBT_" movements are for Service Connected Care.",IBCNT=IBCNT+1
"RTN","IBCD4",36,0)
 I +IBBS S IBMSG(IBCNT)="PTF record indicates "_+IBBS_" of "_IBT_" movements are for a non-billable bedsection.",IBCNT=IBCNT+1
"RTN","IBCD4",37,0)
 S IBT=IBT-IBSC-IBBS I 'IBT S IBMSG(IBCNT)="0 movements are billable."
"RTN","IBCD4",38,0)
IDXE Q
"RTN","IBCD4",39,0)
 ;
"RTN","IBCD4",40,0)
IPRC(PTF,DT1,DT2) ;find 401 and 601 procedures for a PTF record
"RTN","IBCD4",41,0)
 ;results: ^TMP("IBIPRC",$J,PROC DATE)=PROC1^ ... ^PROC5
"RTN","IBCD4",42,0)
 ;where PROC DATE = (45.01,45.01,.01) and (45,45.05,.01) and PROC = (45,45.01,8-12) and (45,45.05,4-8)
"RTN","IBCD4",43,0)
 N IBX,IBY,IBZ,IBI K ^TMP("IBIPRC",$J) I '$D(^DGPT(+$G(PTF),0)) G IPRCE
"RTN","IBCD4",44,0)
 S DT1=$S(+$G(DT1):+DT1,1:0),DT2=$S(+$G(DT2):+DT2,1:9999999),^TMP("IBIPRC",$J)=+PTF
"RTN","IBCD4",45,0)
 S IBX=0 F  S IBX=$O(^DGPT(+PTF,"S",IBX)) Q:'IBX  S IBY=$G(^DGPT(+PTF,"S",IBX,0)) I +IBY'<DT1,+IBY'>DT2 D
"RTN","IBCD4",46,0)
 . S IBZ="" F IBI=8:1:12 I +$P(IBY,U,IBI) S IBZ=IBZ_+$P(IBY,U,IBI)_U
"RTN","IBCD4",47,0)
 . I +IBZ S ^TMP("IBIPRC",$J,+IBY)=$G(^TMP("IBIPRC",$J,+IBY))_IBZ
"RTN","IBCD4",48,0)
 S IBX=0 F  S IBX=$O(^DGPT(+PTF,"P",IBX)) Q:'IBX  S IBY=$G(^DGPT(+PTF,"P",IBX,0)) I +IBY'<DT1,+IBY'>DT2 D
"RTN","IBCD4",49,0)
 . S IBZ="" F IBI=5:1:9 I +$P(IBY,U,IBI) S IBZ=IBZ_+$P(IBY,U,IBI)_U
"RTN","IBCD4",50,0)
 . I +IBZ S ^TMP("IBIPRC",$J,+IBY)=$G(^TMP("IBIPRC",$J,+IBY))_IBZ
"RTN","IBCD4",51,0)
IPRCE Q
"RTN","IBCD4",52,0)
 ;
"RTN","IBCD4",53,0)
RXRF(PIFN,RIFN,IBDT) ; returns data on fill on date for rx (RX # ^ DRUG ^ DAYS SUPPLY ^ FILL DATE ^ QTY ^ NDC #)
"RTN","IBCD4",54,0)
 N X,Y,PLN,RLN,IBFILL S X=""
"RTN","IBCD4",55,0)
 I +$G(PIFN) S PLN=$G(^PSRX(+PIFN,0)) I PLN'="" D
"RTN","IBCD4",56,0)
 . I +$G(IBDT) S RIFN=$O(^PSRX("AD",+IBDT,+PIFN,""))
"RTN","IBCD4",57,0)
 . S RLN="",IBFILL="^^" I $G(RIFN)="" Q
"RTN","IBCD4",58,0)
 . I RIFN=0 S RLN=$G(^PSRX(+PIFN,2)) Q:RLN=""  S IBFILL=$P(PLN,U,8)_"^"_$P(RLN,U,2)_"^"_$P(PLN,U,7)
"RTN","IBCD4",59,0)
 . I +RIFN S RLN=$G(^PSRX(+PIFN,1,+RIFN,0)) Q:RLN=""  S IBFILL=$P(RLN,U,10)_"^"_$P(RLN,U,1)_"^"_$P(RLN,U,4)
"RTN","IBCD4",60,0)
 . S X=$P(PLN,U,1)_"^"_$P(PLN,U,6)_"^"_IBFILL_"^"_$$GETNDC^PSONDCUT(+PIFN,+RIFN)
"RTN","IBCD4",61,0)
 Q X
"RTN","IBCD4",62,0)
 ;
"RTN","IBCD4",63,0)
CHK() ;other checks
"RTN","IBCD4",64,0)
 N X S X=1 I $G(^DPT(+$G(IBDFN),0))="" S X="0^Patient information lacking."
"RTN","IBCD4",65,0)
 Q X
"RTN","IBCD4",66,0)
 ;
"RTN","IBCD4",67,0)
CHKSYS() ;various checks to determine if bill can be created, returns true if passes   XXXXXX
"RTN","IBCD4",68,0)
 ;if fails then returns "0^error message"
"RTN","IBCD4",69,0)
 ;requires nothing
"RTN","IBCD4",70,0)
 N X,Y,I S X=1
"RTN","IBCD4",71,0)
 I '$P($G(^IBE(350.9,1,1)),U,14) S X="0^MAS SERVICE PARAMETER UNKNOWN" G CHKSYSE
"RTN","IBCD4",72,0)
 I +$P($$SITE^VASITE,U,3)<1 S X="0^ACILITY UNDEFINED" G CHKSYSE
"RTN","IBCD4",73,0)
 ;G:$D(IBB) CHKSYSE
"RTN","IBCD4",74,0)
 ;I '$D(DUZ(0)) S X="0^FILEMAN ACCESS UNDEFINED" G CHKSYSE
"RTN","IBCD4",75,0)
 ;I $S($D(DLAYGO):2\1-(DLAYGO\1),1:1),DUZ(0)'="@",$D(^DIC(399,0,"LAYGO"))  S DLAYGO=399
"RTN","IBCD4",76,0)
CHKSYSE Q X
"RTN","IBCD4",77,0)
 ;
"RTN","IBCD4",78,0)
 ;GVARS(IFN) ;get data on bill IFN  (commented out patch 80, does not appear to be used)
"RTN","IBCD4",79,0)
 ;N I S X=1 I '$G(^DGCR(399,+$G(IFN),0)) S X=0 G GVARSE
"RTN","IBCD4",80,0)
 ;F I=0,"M" S IB(I)=$G(^DGCR(399,+IFN,I))
"RTN","IBCD4",81,0)
 ;S DGINPAR=$P($G(^DIC(36,+IB("MP"),0)),U,6,10)
"RTN","IBCD4",82,0)
 ;GVARSE Q X
"RTN","IBCNRE5")
0^59^B1999828
"RTN","IBCNRE5",1,0)
IBCNRE5 ;BHAM ISC/DMK - Edit HIPAA NCPDP ACTIVE FLAG ;09-APR-2004
"RTN","IBCNRE5",2,0)
 ;;2.0;INTEGRATED BILLING;**251,276**;21-MAR-94
"RTN","IBCNRE5",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRE5",4,0)
 ;
"RTN","IBCNRE5",5,0)
 ; Edit HIPAA NCPDP ACTIVE FLAG
"RTN","IBCNRE5",6,0)
 ; (master switch to control e-Pharmacy NCPDP transactions)
"RTN","IBCNRE5",7,0)
 ;
"RTN","IBCNRE5",8,0)
 ; 350.9  IB SITE PARAMETERS File
"RTN","IBCNRE5",9,0)
 ;  11.01 HIPAA NCPDP ACTIVE FLAG Field
"RTN","IBCNRE5",10,0)
 ;
"RTN","IBCNRE5",11,0)
1000 ; Control processing
"RTN","IBCNRE5",12,0)
 N LOCK
"RTN","IBCNRE5",13,0)
 D LOCK I 'LOCK Q
"RTN","IBCNRE5",14,0)
 D HEADING
"RTN","IBCNRE5",15,0)
 D EDIT
"RTN","IBCNRE5",16,0)
 D UNLOCK
"RTN","IBCNRE5",17,0)
 Q
"RTN","IBCNRE5",18,0)
 ;
"RTN","IBCNRE5",19,0)
EDIT ; Edit IB SITE PARAMETERS File
"RTN","IBCNRE5",20,0)
 ; 350.9 IB SITE PARAMETERS
"RTN","IBCNRE5",21,0)
 ;
"RTN","IBCNRE5",22,0)
 N DA,DIDEL,DIC,DIE,DLAYGO,DR,DTOUT,X,Y
"RTN","IBCNRE5",23,0)
 N %,D,D0,DDER,DDH,DI,DQ,DZ
"RTN","IBCNRE5",24,0)
 ;
"RTN","IBCNRE5",25,0)
 S DA=1
"RTN","IBCNRE5",26,0)
 S DIE="^IBE(350.9,"
"RTN","IBCNRE5",27,0)
 ;
"RTN","IBCNRE5",28,0)
 ; 11.01 HIPAA NCPDP ACTIVE FLAG
"RTN","IBCNRE5",29,0)
 S DR="11.01"
"RTN","IBCNRE5",30,0)
 ;
"RTN","IBCNRE5",31,0)
 D ^DIE
"RTN","IBCNRE5",32,0)
 Q
"RTN","IBCNRE5",33,0)
 ;
"RTN","IBCNRE5",34,0)
HEADING ; Print heading
"RTN","IBCNRE5",35,0)
 W @IOF
"RTN","IBCNRE5",36,0)
 W "Edit HIPAA NCPDP ACTIVE FLAG",!
"RTN","IBCNRE5",37,0)
 W "(master switch to control e-Pharmacy NCPDP transactions)",!!
"RTN","IBCNRE5",38,0)
 Q
"RTN","IBCNRE5",39,0)
 ;
"RTN","IBCNRE5",40,0)
LOCK ; Lock IB SITE PARAMETERS File
"RTN","IBCNRE5",41,0)
 S LOCK=0
"RTN","IBCNRE5",42,0)
 I '$D(^IBE(350.9,1,0)) W !!,*7,"IB SITE PARAMETERS File undefined.",! Q
"RTN","IBCNRE5",43,0)
 L +^IBE(350.9,1,0):0
"RTN","IBCNRE5",44,0)
 I '$T W !!,*7,"IB SITE PARAMETERS File unavailable.",! Q
"RTN","IBCNRE5",45,0)
 S LOCK=1
"RTN","IBCNRE5",46,0)
 Q
"RTN","IBCNRE5",47,0)
 ;
"RTN","IBCNRE5",48,0)
UNLOCK ; Unlock IB SITE PARAMETERS File
"RTN","IBCNRE5",49,0)
 L -^IBE(350.9,1,0)
"RTN","IBCNRE5",50,0)
 Q
"RTN","IBCNRMFE")
0^21^B8335815
"RTN","IBCNRMFE",1,0)
IBCNRMFE ;BHAM ISC/DMK - Receive HL7 e-Pharmacy MFE Segment ;23-OCT-2003
"RTN","IBCNRMFE",2,0)
 ;;2.0;INTEGRATED BILLING;**251,276**;21-MAR-94
"RTN","IBCNRMFE",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRMFE",4,0)
 ;
"RTN","IBCNRMFE",5,0)
 ; Description
"RTN","IBCNRMFE",6,0)
 ;
"RTN","IBCNRMFE",7,0)
 ; Receive HL7 e-Pharmacy MFE Segment
"RTN","IBCNRMFE",8,0)
 ; Master File Entry
"RTN","IBCNRMFE",9,0)
 ;
"RTN","IBCNRMFE",10,0)
 ; Prepare for potential subsequent Z** Segment(s)
"RTN","IBCNRMFE",11,0)
 ;
"RTN","IBCNRMFE",12,0)
 ; Called by IBCNRHLT
"RTN","IBCNRMFE",13,0)
 ;
"RTN","IBCNRMFE",14,0)
 ; Entry point
"RTN","IBCNRMFE",15,0)
 ;
"RTN","IBCNRMFE",16,0)
1000 ; Control MFE Segment processing
"RTN","IBCNRMFE",17,0)
 D INIT
"RTN","IBCNRMFE",18,0)
 Q
"RTN","IBCNRMFE",19,0)
 ;
"RTN","IBCNRMFE",20,0)
INIT ; Initialize MFE Segment variables
"RTN","IBCNRMFE",21,0)
 K DATA,DATAAP,DATACM,ERROR
"RTN","IBCNRMFE",22,0)
 N ANAME,FILENO1,KEY
"RTN","IBCNRMFE",23,0)
 ;
"RTN","IBCNRMFE",24,0)
 S EPHARM=1
"RTN","IBCNRMFE",25,0)
 S FILENO=FLN
"RTN","IBCNRMFE",26,0)
 ;
"RTN","IBCNRMFE",27,0)
 S DATE("NOW")=$$NOW^XLFDT()
"RTN","IBCNRMFE",28,0)
 ;
"RTN","IBCNRMFE",29,0)
 ; Record-Level Event Code (action)
"RTN","IBCNRMFE",30,0)
 ; MAC = Activate
"RTN","IBCNRMFE",31,0)
 ; MAD = Add
"RTN","IBCNRMFE",32,0)
 ; MDC = Deactivate
"RTN","IBCNRMFE",33,0)
 ; MDL = Delete
"RTN","IBCNRMFE",34,0)
 ; MUP = Update
"RTN","IBCNRMFE",35,0)
 S IBCNACT=$G(IBSEG(2))
"RTN","IBCNRMFE",36,0)
 ;
"RTN","IBCNRMFE",37,0)
 ; Primary Key Value ID
"RTN","IBCNRMFE",38,0)
 S KEY=$P($G(IBSEG(5)),$E(HLECH,1),1)
"RTN","IBCNRMFE",39,0)
 ;
"RTN","IBCNRMFE",40,0)
 ; Convert HL7 special characters if necessary
"RTN","IBCNRMFE",41,0)
 I KEY[$E(HLECH,3) S KEY=$$TRAN1^IBCNRHLU(KEY)
"RTN","IBCNRMFE",42,0)
 ;
"RTN","IBCNRMFE",43,0)
 I FILENO'=365.12 S IEN=$$LOOKUP1^IBCNRFM1(FILENO,KEY)
"RTN","IBCNRMFE",44,0)
 I FILENO=365.12 S IEN=$$LOOKUP3^IBCNRFM1(FILENO,"C",KEY)
"RTN","IBCNRMFE",45,0)
 ;
"RTN","IBCNRMFE",46,0)
 ; Error?
"RTN","IBCNRMFE",47,0)
 ; V100 = Payer ID Undefined
"RTN","IBCNRMFE",48,0)
 ; V200 = NCPDP Processor Name Undefined
"RTN","IBCNRMFE",49,0)
 ; V300 = Pharmacy Benefits Manager (PBM) Name Undefined
"RTN","IBCNRMFE",50,0)
 ; V400 = Plan ID Undefined
"RTN","IBCNRMFE",51,0)
 ; V500 = Plan ID Undefined
"RTN","IBCNRMFE",52,0)
 I FILE["Pharmacy Plan",IEN=-1 S ERROR="V500" Q
"RTN","IBCNRMFE",53,0)
 I IBCNACT'="MAD",IEN=-1 S ERROR=$S(FILENO=365.12:"V100",FILENO=366.01:"V200",FILENO=366.02:"V300",FILENO=366.03:"V400") Q
"RTN","IBCNRMFE",54,0)
 ;
"RTN","IBCNRMFE",55,0)
 S FIELDNO=$S(FILENO=365.12:1,1:3)
"RTN","IBCNRMFE",56,0)
 S FILENO1=$S(FILENO=365.12:365.13,1:FILENO+.1)
"RTN","IBCNRMFE",57,0)
 S ANAME="E-PHARM"
"RTN","IBCNRMFE",58,0)
 S AIEN=$$LOOKUP1^IBCNRFM1(FILENO1,ANAME)
"RTN","IBCNRMFE",59,0)
 I AIEN=-1 S AIEN=$$ADD1^IBCNRFM1(FILENO1,ANAME)
"RTN","IBCNRMFE",60,0)
 I IEN'=-1 S APIEN=$$LOOKUP2^IBCNRFM1(FILENO,IEN,FIELDNO,ANAME)
"RTN","IBCNRMFE",61,0)
 I IEN=-1 S APIEN=-1
"RTN","IBCNRMFE",62,0)
 ;
"RTN","IBCNRMFE",63,0)
 ; Error?
"RTN","IBCNRMFE",64,0)
 ; V101 = E-PHARM Application Undefined
"RTN","IBCNRMFE",65,0)
 ; V201 = E-PHARM Application Undefined
"RTN","IBCNRMFE",66,0)
 ; V301 = E-PHARM Application Undefined
"RTN","IBCNRMFE",67,0)
 ; V401 = E-PHARM Application Undefined
"RTN","IBCNRMFE",68,0)
 ; V501 = E-PHARM Application Undefined
"RTN","IBCNRMFE",69,0)
 I IBCNACT'="MAD",APIEN=-1 D  Q
"RTN","IBCNRMFE",70,0)
 . S ERROR=$S(FILENO=365.12:"V101",FILENO=366.01:"V201",FILENO=366.02:"V301",FILENO=366.03:"V401")
"RTN","IBCNRMFE",71,0)
 . I FILE["Pharmacy" S ERROR="V501"
"RTN","IBCNRMFE",72,0)
 ;
"RTN","IBCNRMFE",73,0)
 ; MAC = Activate
"RTN","IBCNRMFE",74,0)
 I IBCNACT="MAC" D INITMAC
"RTN","IBCNRMFE",75,0)
 ;
"RTN","IBCNRMFE",76,0)
 ; MAD = Add
"RTN","IBCNRMFE",77,0)
 I IBCNACT="MAD" D INITMAD
"RTN","IBCNRMFE",78,0)
 ;
"RTN","IBCNRMFE",79,0)
 ; MDC = Deactivate
"RTN","IBCNRMFE",80,0)
 I IBCNACT="MDC" D INITMDC
"RTN","IBCNRMFE",81,0)
 ;
"RTN","IBCNRMFE",82,0)
 ; MDL = Delete
"RTN","IBCNRMFE",83,0)
 I IBCNACT="MDL" D INITMDL
"RTN","IBCNRMFE",84,0)
 ;
"RTN","IBCNRMFE",85,0)
 ; MUP = Update
"RTN","IBCNRMFE",86,0)
 I IBCNACT="MUP" D INITMUP
"RTN","IBCNRMFE",87,0)
 Q
"RTN","IBCNRMFE",88,0)
 ;
"RTN","IBCNRMFE",89,0)
INITMAD ; Initialize APPLICATION Subfile variables if MAD (Add) action
"RTN","IBCNRMFE",90,0)
 ; 365.121 PAYER APPLICATION Subfile
"RTN","IBCNRMFE",91,0)
 ; 366.013 NCPDP PROCESSOR APPLICATION Subfile
"RTN","IBCNRMFE",92,0)
 ; 366.023 PHARMACY BENEFITS MANAGER (PBM) APPLICATION Subfile
"RTN","IBCNRMFE",93,0)
 ; 366.033 PLAN APPLICATION Subfile
"RTN","IBCNRMFE",94,0)
 ;
"RTN","IBCNRMFE",95,0)
 ; Process MAD (Add) as MAC (Activate)
"RTN","IBCNRMFE",96,0)
 D INITMAC
"RTN","IBCNRMFE",97,0)
 ;
"RTN","IBCNRMFE",98,0)
 ; .03 LOCAL ACTIVE?
"RTN","IBCNRMFE",99,0)
 ; Set to INACTIVE for PLAN, all others ACTIVE
"RTN","IBCNRMFE",100,0)
 S DATAAP(.03)=$S(FILENO=366.03:0,1:1)
"RTN","IBCNRMFE",101,0)
 ;
"RTN","IBCNRMFE",102,0)
 ; .04 USER EDITED LOCAL
"RTN","IBCNRMFE",103,0)
 S DATAAP(.04)=IDUZ
"RTN","IBCNRMFE",104,0)
 ;
"RTN","IBCNRMFE",105,0)
 ; .05 DATE/TIME LOCAL EDITED
"RTN","IBCNRMFE",106,0)
 S DATAAP(.05)=DATE("NOW")
"RTN","IBCNRMFE",107,0)
 ;
"RTN","IBCNRMFE",108,0)
 ; .13 DATE/TIME CREATED
"RTN","IBCNRMFE",109,0)
 S DATAAP(.13)=DATE("NOW")
"RTN","IBCNRMFE",110,0)
 Q
"RTN","IBCNRMFE",111,0)
 ;
"RTN","IBCNRMFE",112,0)
INITMAC ; Initialize APPLICATION Subfile variables if MAC (Activate) action
"RTN","IBCNRMFE",113,0)
 ; 365.121 PAYER APPLICATION Subfile
"RTN","IBCNRMFE",114,0)
 ; 366.013 NCPDP PROCESSOR APPLICATION Subfile
"RTN","IBCNRMFE",115,0)
 ; 366.023 PHARMACY BENEFITS MANAGER (PBM) APPLICATION Subfile
"RTN","IBCNRMFE",116,0)
 ; 366.033 PLAN APPLICATION Subfile
"RTN","IBCNRMFE",117,0)
 ;
"RTN","IBCNRMFE",118,0)
 ; .02 NATIONAL ACTIVE?
"RTN","IBCNRMFE",119,0)
 S DATAAP(.02)=1
"RTN","IBCNRMFE",120,0)
 ;
"RTN","IBCNRMFE",121,0)
 ; .06 DATE/TIME NATIONAL EDITED
"RTN","IBCNRMFE",122,0)
 S DATAAP(.06)=DATE("NOW")
"RTN","IBCNRMFE",123,0)
 ;
"RTN","IBCNRMFE",124,0)
 ; .11 DEACTIVATED?
"RTN","IBCNRMFE",125,0)
 S DATAAP(.11)=0
"RTN","IBCNRMFE",126,0)
 ;
"RTN","IBCNRMFE",127,0)
 ; .12 DATE/TIME DEACTIVATED
"RTN","IBCNRMFE",128,0)
 S DATAAP(.12)="@"
"RTN","IBCNRMFE",129,0)
 Q
"RTN","IBCNRMFE",130,0)
 ;
"RTN","IBCNRMFE",131,0)
INITMDC ; Initialize APPLICATION Subfile variables if MDC (deactivate) action
"RTN","IBCNRMFE",132,0)
 ; 365.121 PAYER APPLICATION Subfile
"RTN","IBCNRMFE",133,0)
 ; 366.013 NCPDP PROCESSOR APPLICATION Subfile
"RTN","IBCNRMFE",134,0)
 ; 366.023 PHARMACY BENEFITS MANAGER (PBM) APPLICATION Subfile
"RTN","IBCNRMFE",135,0)
 ; 366.033 PLAN APPLICATION Subfile
"RTN","IBCNRMFE",136,0)
 ;
"RTN","IBCNRMFE",137,0)
 ; .02 NATIONAL ACTIVE?
"RTN","IBCNRMFE",138,0)
 S DATAAP(.02)=0
"RTN","IBCNRMFE",139,0)
 ;
"RTN","IBCNRMFE",140,0)
 ; .06 DATE/TIME NATIONAL EDITED
"RTN","IBCNRMFE",141,0)
 S DATAAP(.06)=DATE("NOW")
"RTN","IBCNRMFE",142,0)
 ;
"RTN","IBCNRMFE",143,0)
 ; .11 DEACTIVATED?
"RTN","IBCNRMFE",144,0)
 S DATAAP(.11)=1
"RTN","IBCNRMFE",145,0)
 ;
"RTN","IBCNRMFE",146,0)
 ; .12 DATE/TIME DEACTIVATED
"RTN","IBCNRMFE",147,0)
 S DATAAP(.12)=DATE("NOW")
"RTN","IBCNRMFE",148,0)
 Q
"RTN","IBCNRMFE",149,0)
 ;
"RTN","IBCNRMFE",150,0)
INITMDL ; Initialize APPLICATION Subfile variables if MDL (Delete) action
"RTN","IBCNRMFE",151,0)
 ; 365.121 PAYER APPLICATION Subfile
"RTN","IBCNRMFE",152,0)
 ; 366.013 NCPDP PROCESSOR APPLICATION Subfile
"RTN","IBCNRMFE",153,0)
 ; 366.023 PHARMACY BENEFITS MANAGER (PBM) APPLICATION Subfile
"RTN","IBCNRMFE",154,0)
 ; 366.033 PLAN APPLICATION Subfile
"RTN","IBCNRMFE",155,0)
 ;
"RTN","IBCNRMFE",156,0)
 ; Process MDL (Delete) as MDC (Deactivate)
"RTN","IBCNRMFE",157,0)
 D INITMDC
"RTN","IBCNRMFE",158,0)
 Q
"RTN","IBCNRMFE",159,0)
 ;
"RTN","IBCNRMFE",160,0)
INITMUP ; Initialize APPLICATION Subfile variables if MUP (Update) action
"RTN","IBCNRMFE",161,0)
 ; 365.121 PAYER APPLICATION Subfile
"RTN","IBCNRMFE",162,0)
 ; 366.013 NCPDP PROCESSOR APPLICATION Subfile
"RTN","IBCNRMFE",163,0)
 ; 366.023 PHARMACY BENEFITS MANAGER (PBM) APPLICATION Subfile
"RTN","IBCNRMFE",164,0)
 ; 366.033 PLAN APPLICATION Subfile
"RTN","IBCNRMFE",165,0)
 Q
"RTN","IBCNRP5")
0^34^B56002389
"RTN","IBCNRP5",1,0)
IBCNRP5 ;BHAM ISC/CMW - Group Plan Status Report ;01-NOV-2004
"RTN","IBCNRP5",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBCNRP5",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRP5",4,0)
 ;
"RTN","IBCNRP5",5,0)
EN ;
"RTN","IBCNRP5",6,0)
 ; Initialize variables
"RTN","IBCNRP5",7,0)
 N STOP,IBCNRRTN,IBCNRSPC,RESORT,IBCNTYP,IBSEL
"RTN","IBCNRP5",8,0)
 D:'$D(IOF) HOME^%ZIS
"RTN","IBCNRP5",9,0)
 ;
"RTN","IBCNRP5",10,0)
 S STOP=0,IBPXT=$G(IBPXT)
"RTN","IBCNRP5",11,0)
 W @IOF
"RTN","IBCNRP5",12,0)
 W !,"ePHARM GROUP PLAN STATUS REPORT",!
"RTN","IBCNRP5",13,0)
 W !,"NCPDP process requires that the users match Group Plans to Pharmacy Plans."
"RTN","IBCNRP5",14,0)
 W !,"This report will assist users in matching Group Insurance Plans to Pharmacy"
"RTN","IBCNRP5",15,0)
 W !,"  Plans by searching through GIPF file for Group Plans that "
"RTN","IBCNRP5",16,0)
 W !,"    are linked to an Insurance with active Pharmacy Plan coverage."
"RTN","IBCNRP5",17,0)
 ;
"RTN","IBCNRP5",18,0)
 ; Prompts 
"RTN","IBCNRP5",19,0)
 ; lock global
"RTN","IBCNRP5",20,0)
 S IBCNRRPT=1
"RTN","IBCNRP5",21,0)
 N IBCNRDEV S IBCNRDEV=1
"RTN","IBCNRP5",22,0)
 L +^XTMP("IBCNRP5"):5 I '$T W !!,"Sorry, Status Report in use." H 2 G EXIT
"RTN","IBCNRP5",23,0)
 ;Check for prior compile
"RTN","IBCNRP5",24,0)
P10 D RESORT(.RESORT) I STOP G EXIT
"RTN","IBCNRP5",25,0)
 I $G(RESORT) G P30
"RTN","IBCNRP5",26,0)
 K ^XTMP("IBCNRP5")
"RTN","IBCNRP5",27,0)
 ; compile valid insurance file
"RTN","IBCNRP5",28,0)
P20 D GIPF
"RTN","IBCNRP5",29,0)
 ; select insurance company
"RTN","IBCNRP5",30,0)
P30 D INS I $G(IBSEL)="" G EXIT
"RTN","IBCNRP5",31,0)
 D TYPE I $G(IBCNTYP)="" G EXIT
"RTN","IBCNRP5",32,0)
 ; perform sort/selection
"RTN","IBCNRP5",33,0)
P40 D INSEL
"RTN","IBCNRP5",34,0)
 I '$D(^TMP("IBCNRP5")) G EXIT
"RTN","IBCNRP5",35,0)
 ; print selection
"RTN","IBCNRP5",36,0)
P50 D PRINT^IBCNRP5P
"RTN","IBCNRP5",37,0)
 ;
"RTN","IBCNRP5",38,0)
EXIT ; unlock global
"RTN","IBCNRP5",39,0)
 L -^XTMP("IBCNRP5")
"RTN","IBCNRP5",40,0)
 K IBPXT
"RTN","IBCNRP5",41,0)
 K IBCNSP,IBCPOL,IBIND,IBMULT,IBSEL,IBW,IBALR,IBGRP,IBCNGP
"RTN","IBCNRP5",42,0)
 K IBCNRRPT,IBCNTYP,IBCNRDEV,ZTDESC,ZTSTOP
"RTN","IBCNRP5",43,0)
 K IBCNRP,IBCNRI,IBCNRGP
"RTN","IBCNRP5",44,0)
 K IBICPT,IBICF,IBICL,IBIC,IBINA,IBIEN,INIEN
"RTN","IBCNRP5",45,0)
 K ^TMP("IBCNRP5",$J)
"RTN","IBCNRP5",46,0)
 Q
"RTN","IBCNRP5",47,0)
 ;
"RTN","IBCNRP5",48,0)
RESORT(RESORT) ; check for prior compile
"RTN","IBCNRP5",49,0)
 NEW DIR,BDT,EDT,RDT,HDR,IBDT,X,Y,DIRUT
"RTN","IBCNRP5",50,0)
 I '$D(^XTMP("IBCNRP5")) Q
"RTN","IBCNRP5",51,0)
 S RDT=$P($G(^XTMP("IBCNRP5",0)),U,2)
"RTN","IBCNRP5",52,0)
 S RESORT=0
"RTN","IBCNRP5",53,0)
 S HDR=$$FMTE^XLFDT(RDT,"5Z")
"RTN","IBCNRP5",54,0)
 W !!,"Current Insurance company list compiled on: ",HDR,!
"RTN","IBCNRP5",55,0)
 S DIR(0)="Y"
"RTN","IBCNRP5",56,0)
 S DIR("A")="Do you want to use the existing compiled file"
"RTN","IBCNRP5",57,0)
 S DIR("B")="YES"
"RTN","IBCNRP5",58,0)
 S DIR("?",1)=" Enter YES to use the existing compiled file."
"RTN","IBCNRP5",59,0)
 S DIR("?")=" Enter NO to DELETE existing file and recompile,"
"RTN","IBCNRP5",60,0)
 D ^DIR K DIR
"RTN","IBCNRP5",61,0)
 I $D(DIRUT) S STOP=1 G RESRTX
"RTN","IBCNRP5",62,0)
 S RESORT=Y
"RTN","IBCNRP5",63,0)
 S IBCNRSPC("RESORT")=Y
"RTN","IBCNRP5",64,0)
 ;
"RTN","IBCNRP5",65,0)
RESRTX ;RESORT EXIT
"RTN","IBCNRP5",66,0)
 Q
"RTN","IBCNRP5",67,0)
 ; 
"RTN","IBCNRP5",68,0)
GIPF ; compiler valid insurance
"RTN","IBCNRP5",69,0)
 W !,"*** COMPILING ......"
"RTN","IBCNRP5",70,0)
 N GST1,GP0,GP6,IBCOV,LIM,IBCVRD,IBIEN
"RTN","IBCNRP5",71,0)
 N GPIEN,GPNAM,GPNUM,IBINA
"RTN","IBCNRP5",72,0)
 S GST1=1,(GPIEN,INIEN)=""
"RTN","IBCNRP5",73,0)
 S ^XTMP("IBCNRP5",0)=($$NOW^XLFDT+30)_"^"_$$NOW^XLFDT_"^"_"Group Plan Status Report"
"RTN","IBCNRP5",74,0)
 F  S INIEN=$O(^IBA(355.3,"B",INIEN)) Q:INIEN=""  D
"RTN","IBCNRP5",75,0)
 . S IBINA=$P($G(^DIC(36,+INIEN,0)),U)
"RTN","IBCNRP5",76,0)
 . ; company does not reimburse
"RTN","IBCNRP5",77,0)
 . I $P($G(^DIC(36,+INIEN,0)),U,2)="N" Q
"RTN","IBCNRP5",78,0)
 . ; company is inactive
"RTN","IBCNRP5",79,0)
 . I $P($G(^DIC(36,INIEN,0)),U,5) Q
"RTN","IBCNRP5",80,0)
 . ;
"RTN","IBCNRP5",81,0)
 . F  S GPIEN=$O(^IBA(355.3,"B",INIEN,GPIEN)) Q:GPIEN=""  D
"RTN","IBCNRP5",82,0)
 .. ;chk for active group
"RTN","IBCNRP5",83,0)
 .. S GP0=$G(^IBA(355.3,GPIEN,0)),GP6=$G(^IBA(355.3,GPIEN,6))
"RTN","IBCNRP5",84,0)
 .. I $P(GP0,U,11)=1 Q
"RTN","IBCNRP5",85,0)
 .. ;
"RTN","IBCNRP5",86,0)
 .. ;chk for pharm plan coverage
"RTN","IBCNRP5",87,0)
 .. S IBCOV=$O(^IBE(355.31,"B","PHARMACY",""))
"RTN","IBCNRP5",88,0)
 .. S LIM="",IBCVRD=0
"RTN","IBCNRP5",89,0)
 .. F  S LIM=$O(^IBA(355.32,"B",GPIEN,LIM)) Q:LIM=""  D
"RTN","IBCNRP5",90,0)
 ... I $P(^IBA(355.32,LIM,0),U,2)'=IBCOV Q
"RTN","IBCNRP5",91,0)
 ... ;chk covered status
"RTN","IBCNRP5",92,0)
 ... S IBCVRD=$P(^IBA(355.32,LIM,0),U,4)
"RTN","IBCNRP5",93,0)
 ... I IBCVRD=0 Q
"RTN","IBCNRP5",94,0)
 ... ;set valid insurance/group array
"RTN","IBCNRP5",95,0)
 ... S ^XTMP("IBCNRP5",IBINA,INIEN,GPIEN)=""
"RTN","IBCNRP5",96,0)
 Q
"RTN","IBCNRP5",97,0)
 ;
"RTN","IBCNRP5",98,0)
INS ;
"RTN","IBCNRP5",99,0)
 S IBSEL=""
"RTN","IBCNRP5",100,0)
 W !,"Run Report "
"RTN","IBCNRP5",101,0)
 W " for (S)PECIFIC insurance companies or a (R)ANGE: RANGE// "
"RTN","IBCNRP5",102,0)
 R X:DTIME Q:'$T!(X["^")
"RTN","IBCNRP5",103,0)
 S:X="" X="R" S X=$E(X)
"RTN","IBCNRP5",104,0)
 I "RSrs"'[X W !,"Enter <CR> for Range; 'S' for specific insurance; '^' to quit." G INS
"RTN","IBCNRP5",105,0)
 W "  ",$S("Ss"[X:"SPECIFIC",1:"RANGE") G:"Rr"[X INSO1
"RTN","IBCNRP5",106,0)
INSO S DIC="^DIC(36,",DIC(0)="AEQMZ",DIC("S")="I '$G(^(5))"
"RTN","IBCNRP5",107,0)
 S DIC("A")="   Select "_$S($G(IBICPT):"another ",1:"")_"INSURANCE CO.: "
"RTN","IBCNRP5",108,0)
 D ^DIC K DIC I Y'>0 G INS:'$G(IBICPT) S IBSEL=1 Q
"RTN","IBCNRP5",109,0)
 I $D(IBICPT(+Y)) D  G INSO
"RTN","IBCNRP5",110,0)
 .W !!?3,"Already selected. Choose another insurance company.",!,*7
"RTN","IBCNRP5",111,0)
 S IBICPT(+Y)="",IBICPT=$G(IBICPT)+1 G INSO
"RTN","IBCNRP5",112,0)
 ;
"RTN","IBCNRP5",113,0)
INSO1 W !?3,"Start with INSURANCE COMPANY: FIRST// " R X:DTIME
"RTN","IBCNRP5",114,0)
 G:'$T!(X["^") INS
"RTN","IBCNRP5",115,0)
 I $E(X)="?" W !,"Enter value up to 40 char; <CR> to start with 'first' value; '^' to quit." G INSO1
"RTN","IBCNRP5",116,0)
 S IBICF=X
"RTN","IBCNRP5",117,0)
INSO2 W !?8,"Go to INSURANCE COMPANY: LAST// " R X:DTIME
"RTN","IBCNRP5",118,0)
 G:'$T!(X["^") INSO1
"RTN","IBCNRP5",119,0)
 I $E(X)="?" W !,"Enter value up to 40 char; <CR> to go to 'last' value; '^' to quit." G INSO1
"RTN","IBCNRP5",120,0)
 I X="" S IBICL="zzzzz" S:IBICF="" IBIC="ALL" S IBSEL=1 Q
"RTN","IBCNRP5",121,0)
 I IBICF]X D  G INSO2
"RTN","IBCNRP5",122,0)
 .W *7,!!?3,"The LAST value must follow the FIRST.",!
"RTN","IBCNRP5",123,0)
 S IBICL=X,IBSEL=1
"RTN","IBCNRP5",124,0)
 Q
"RTN","IBCNRP5",125,0)
 ;
"RTN","IBCNRP5",126,0)
TYPE ; Prompt to allow users to inquire for All group plans, or Matched group plans
"RTN","IBCNRP5",127,0)
 N DIR,X,Y,DIRUT
"RTN","IBCNRP5",128,0)
 S IBCNTYP="A"
"RTN","IBCNRP5",129,0)
 S DIR(0)="S^A:All Group Plans;M:Matched Group Plans"
"RTN","IBCNRP5",130,0)
 S DIR("A")=" Select the type of Group Plans you want to see for Insurance selected."
"RTN","IBCNRP5",131,0)
 S DIR("B")="A"
"RTN","IBCNRP5",132,0)
 S DIR("?",1)="  A - All Group Plans"
"RTN","IBCNRP5",133,0)
 S DIR("?",2)="  M - Matched Group Plans"
"RTN","IBCNRP5",134,0)
 D ^DIR K DIR
"RTN","IBCNRP5",135,0)
 I $D(DIRUT) G TYPEX
"RTN","IBCNRP5",136,0)
 S IBCNTYP=Y
"RTN","IBCNRP5",137,0)
TYPEX Q
"RTN","IBCNRP5",138,0)
 ;
"RTN","IBCNRP5",139,0)
INSEL ; - Perform selection for insurance company.
"RTN","IBCNRP5",140,0)
 S VALMCNT=0,VALMBG=1,IBCNGP=0
"RTN","IBCNRP5",141,0)
 K ^TMP("IBCNRP5",$J)
"RTN","IBCNRP5",142,0)
 ; check for specific insurance companies
"RTN","IBCNRP5",143,0)
 I $G(IBICPT) D  Q
"RTN","IBCNRP5",144,0)
 . S (IBINA,IBIEN)=""
"RTN","IBCNRP5",145,0)
 . F  S IBIEN=$O(IBICPT(IBIEN)) Q:IBIEN=""  D
"RTN","IBCNRP5",146,0)
 .. S IBINA=$P($G(^DIC(36,+IBIEN,0)),U)
"RTN","IBCNRP5",147,0)
 .. I '$D(^XTMP("IBCNRP5",IBINA,IBIEN)) D  Q
"RTN","IBCNRP5",148,0)
 ... W *7,!?3,"**NO pharmacy data found for "
"RTN","IBCNRP5",149,0)
 ... W $P(^DIC(36,IBIEN,0),U)_"  "_$P(^DIC(36,IBIEN,.11),U),! R X:2
"RTN","IBCNRP5",150,0)
 .. D INIT
"RTN","IBCNRP5",151,0)
 ;
"RTN","IBCNRP5",152,0)
 ; check for range of insurance companies
"RTN","IBCNRP5",153,0)
 I '$D(IBICL) Q
"RTN","IBCNRP5",154,0)
 S IBIEN=0,IBINA=""
"RTN","IBCNRP5",155,0)
 F  S IBINA=$O(^XTMP("IBCNRP5",IBINA)) Q:IBINA=""  D
"RTN","IBCNRP5",156,0)
 . F  S IBIEN=$O(^XTMP("IBCNRP5",IBINA,IBIEN)) Q:IBIEN=""  D
"RTN","IBCNRP5",157,0)
 ..; for selection "ALL"
"RTN","IBCNRP5",158,0)
 .. I $G(IBIC)="ALL" D INIT Q
"RTN","IBCNRP5",159,0)
 .. ;
"RTN","IBCNRP5",160,0)
 .. ;check for match within first/last range
"RTN","IBCNRP5",161,0)
 .. I (IBICF]IBINA)!(IBINA]IBICL) Q
"RTN","IBCNRP5",162,0)
 .. D INIT
"RTN","IBCNRP5",163,0)
 Q
"RTN","IBCNRP5",164,0)
 ;
"RTN","IBCNRP5",165,0)
INIT ; -- init variables and create list array or report array
"RTN","IBCNRP5",166,0)
 N IBGP0,IBCPOLD,X,IBCPD6,IBCNRPP,IBCOV,IBCVRD,LIM
"RTN","IBCNRP5",167,0)
 F  S IBCNGP=$O(^XTMP("IBCNRP5",IBINA,IBIEN,IBCNGP)) Q:'IBCNGP  D
"RTN","IBCNRP5",168,0)
 . I '$D(^IBA(355.3,+IBCNGP,0)) Q
"RTN","IBCNRP5",169,0)
 . ; if we want all plans, let it pass
"RTN","IBCNRP5",170,0)
 . I IBCNTYP="A" D  Q
"RTN","IBCNRP5",171,0)
 . . D SETPLAN(IBCNGP)
"RTN","IBCNRP5",172,0)
 . ; if we want Matched plans, check for existence of Plan ID
"RTN","IBCNRP5",173,0)
 . I IBCNTYP="M" D  Q
"RTN","IBCNRP5",174,0)
 . . I $P($G(^IBA(355.3,IBCNGP,6)),U)'="" D SETPLAN(IBCNGP)
"RTN","IBCNRP5",175,0)
 I VALMCNT=0 D
"RTN","IBCNRP5",176,0)
 . S ^TMP("IBCNRP5",$J,"DSPDATA",1)=IBIEN
"RTN","IBCNRP5",177,0)
 . S ^TMP("IBCNRP5",$J,"DSPDATA",2)="No data for this Insurance"
"RTN","IBCNRP5",178,0)
 Q
"RTN","IBCNRP5",179,0)
 ;
"RTN","IBCNRP5",180,0)
SETPLAN(IBCNGP) ;
"RTN","IBCNRP5",181,0)
 ; create text
"RTN","IBCNRP5",182,0)
 N IBGPZ,I,IBPLN,IBPLNA,LINE
"RTN","IBCNRP5",183,0)
 S VALMCNT=VALMCNT+1,$P(LINE,"-",80)=""
"RTN","IBCNRP5",184,0)
 S IBGPZ=^IBA(355.3,+IBCNGP,0)
"RTN","IBCNRP5",185,0)
 ; Group Name, Group #, Group Type, Plan ID, Plan Status
"RTN","IBCNRP5",186,0)
 S X=$$FO^IBCNEUT1($P(IBGPZ,U,3),18)
"RTN","IBCNRP5",187,0)
 S X=X_" "_$$FO^IBCNEUT1($P(IBGPZ,U,4),17)
"RTN","IBCNRP5",188,0)
 S X=X_" "_$$FO^IBCNEUT1($$EXPAND^IBTRE(355.3,.09,$P(IBGPZ,U,9)),13)
"RTN","IBCNRP5",189,0)
 S IBPLN=$P($G(^IBA(355.3,+IBCNGP,6)),U)
"RTN","IBCNRP5",190,0)
 ; check for plan
"RTN","IBCNRP5",191,0)
 I IBPLN="" D  Q
"RTN","IBCNRP5",192,0)
 . S ^TMP("IBCNRP5",$J,"DSPDATA",VALMCNT)=IBIEN_"^"_X
"RTN","IBCNRP5",193,0)
 . S VALMCNT=VALMCNT+1,^TMP("IBCNRP5",$J,"DSPDATA",VALMCNT)=IBIEN_"^"_"No Plan Found."
"RTN","IBCNRP5",194,0)
 . S VALMCNT=VALMCNT+1,^TMP("IBCNRP5",$J,"DSPDATA",VALMCNT)=IBIEN_"^"_LINE
"RTN","IBCNRP5",195,0)
 ; check plan status information
"RTN","IBCNRP5",196,0)
 S IBPLNA=$P($G(^IBCNR(366.03,IBPLN,0)),U)
"RTN","IBCNRP5",197,0)
 S X=X_" "_$$FO^IBCNEUT1(IBPLNA,13)
"RTN","IBCNRP5",198,0)
 ;
"RTN","IBCNRP5",199,0)
 N ARRAY D STCHK^IBCNRU1(IBPLN,.ARRAY)
"RTN","IBCNRP5",200,0)
 S X=X_"      "_$$FO^IBCNEUT1($S($G(ARRAY(1))="I":"INACTIVE",1:"ACTIVE"),8)
"RTN","IBCNRP5",201,0)
 S ^TMP("IBCNRP5",$J,"DSPDATA",VALMCNT)=IBIEN_"^"_X
"RTN","IBCNRP5",202,0)
 I $G(ARRAY(6)) D
"RTN","IBCNRP5",203,0)
 . N STATAR
"RTN","IBCNRP5",204,0)
 . D STATAR^IBCNRU1(.STATAR)
"RTN","IBCNRP5",205,0)
 . F I=1:1:$L(ARRAY(6),",") D
"RTN","IBCNRP5",206,0)
 .. S VALMCNT=VALMCNT+1
"RTN","IBCNRP5",207,0)
 .. S ^TMP("IBCNRP5",$J,"DSPDATA",VALMCNT)=IBIEN_"^"_"       "_$G(STATAR($P(ARRAY(6),",",I)))
"RTN","IBCNRP5",208,0)
 . S VALMCNT=VALMCNT+1,^TMP("IBCNRP5",$J,"DSPDATA",VALMCNT)=IBIEN_"^"_LINE
"RTN","IBCNRP5",209,0)
 ;
"RTN","IBCNRP5",210,0)
 Q
"RTN","IBCNRP5P")
0^35^B8700930
"RTN","IBCNRP5P",1,0)
IBCNRP5P ;BHAM ISC/CMW - Group Plan Status Report ;01-NOV-2004
"RTN","IBCNRP5P",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBCNRP5P",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRP5P",4,0)
 ; 
"RTN","IBCNRP5P",5,0)
PRINT ; Entry pt.
"RTN","IBCNRP5P",6,0)
 ;
"RTN","IBCNRP5P",7,0)
 ; Init vars
"RTN","IBCNRP5P",8,0)
 N CRT,MAXCNT,IBPGC,IBBDT,IBEDT,IBPY,IBPXT,IBSRT,IBDTL
"RTN","IBCNRP5P",9,0)
 N X,Y,DIR,DTOUT,DUOUT,LIN,TOTALS,ZTRTN,ZTDESC,ZTSAVE
"RTN","IBCNRP5P",10,0)
 D:'$D(IOF) HOME^%ZIS
"RTN","IBCNRP5P",11,0)
 S ZTRTN="PRT01^IBCNRP5P"
"RTN","IBCNRP5P",12,0)
 S ZTDESC="ePHARM GROUP PLAN STATUS REPORT"
"RTN","IBCNRP5P",13,0)
 S ZTSAVE("^TMP(""IBCNRP5"",$J,")="",ZTSAVE("IBCNTYP")=""
"RTN","IBCNRP5P",14,0)
 D EN^XUTMDEVQ(ZTRTN,ZTDESC,.ZTSAVE)
"RTN","IBCNRP5P",15,0)
 Q
"RTN","IBCNRP5P",16,0)
 ;
"RTN","IBCNRP5P",17,0)
PRT01 ;
"RTN","IBCNRP5P",18,0)
 S (IBPXT,IBPGC)=0
"RTN","IBCNRP5P",19,0)
 ;
"RTN","IBCNRP5P",20,0)
 ; Determine IO parameters
"RTN","IBCNRP5P",21,0)
 I IOST["C-" S MAXCNT=IOSL-3,CRT=1
"RTN","IBCNRP5P",22,0)
 E  S MAXCNT=IOSL-6,CRT=0
"RTN","IBCNRP5P",23,0)
 ;
"RTN","IBCNRP5P",24,0)
 D PRT02(MAXCNT,IBPGC)
"RTN","IBCNRP5P",25,0)
 I $G(ZTSTOP)!IBPXT G PRTEX
"RTN","IBCNRP5P",26,0)
 I CRT,IBPGC>0,'$D(ZTQUEUED) D
"RTN","IBCNRP5P",27,0)
 . I MAXCNT<51 F LIN=1:1:(MAXCNT-$Y) W !
"RTN","IBCNRP5P",28,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","IBCNRP5P",29,0)
 ;
"RTN","IBCNRP5P",30,0)
PRTEX Q
"RTN","IBCNRP5P",31,0)
 ;
"RTN","IBCNRP5P",32,0)
PRT02(MAX,PGC) ; Print data
"RTN","IBCNRP5P",33,0)
 ;
"RTN","IBCNRP5P",34,0)
 ; Init vars
"RTN","IBCNRP5P",35,0)
 N EORMSG,NONEMSG,TOTDASHS,DISPDATA,SORT,CT,PRT1,PRT2
"RTN","IBCNRP5P",36,0)
 ;
"RTN","IBCNRP5P",37,0)
 S EORMSG="*** END OF REPORT ***"
"RTN","IBCNRP5P",38,0)
 S NONEMSG="* * * N O  D A T A  F O U N D * * *"
"RTN","IBCNRP5P",39,0)
 S $P(TOTDASHS,"=",89)=""
"RTN","IBCNRP5P",40,0)
 S CT=0
"RTN","IBCNRP5P",41,0)
 ;
"RTN","IBCNRP5P",42,0)
 ; Display lines of response
"RTN","IBCNRP5P",43,0)
 D LINE
"RTN","IBCNRP5P",44,0)
 Q
"RTN","IBCNRP5P",45,0)
 ;
"RTN","IBCNRP5P",46,0)
LINE ; Print line of data
"RTN","IBCNRP5P",47,0)
 ; Assumes vars from PRINT: PGC,IBPXT,MAX
"RTN","IBCNRP5P",48,0)
 ; Init vars
"RTN","IBCNRP5P",49,0)
 N CT,II,DSP,IBCNSP
"RTN","IBCNRP5P",50,0)
 ;
"RTN","IBCNRP5P",51,0)
 S CT=+$O(^TMP("IBCNRP5",$J,"DSPDATA",""),-1)
"RTN","IBCNRP5P",52,0)
 S IBCNSP=$P(^TMP("IBCNRP5",$J,"DSPDATA",1),U)
"RTN","IBCNRP5P",53,0)
 I $Y+1+CT>MAX D HEADER I $G(ZTSTOP)!IBPXT G LINEX
"RTN","IBCNRP5P",54,0)
 F II=1:1:CT D  Q:$G(ZTSTOP)!IBPXT
"RTN","IBCNRP5P",55,0)
 . S IBCNSP=$P(^TMP("IBCNRP5",$J,"DSPDATA",II),U)
"RTN","IBCNRP5P",56,0)
 . I $Y+1>MAX!('PGC) D HEADER I $G(ZTSTOP)!IBPXT Q
"RTN","IBCNRP5P",57,0)
 . S DSP=$P(^TMP("IBCNRP5",$J,"DSPDATA",II),U,2)
"RTN","IBCNRP5P",58,0)
 . W !,?1,DSP
"RTN","IBCNRP5P",59,0)
 . Q
"RTN","IBCNRP5P",60,0)
 ;
"RTN","IBCNRP5P",61,0)
LINEX ; LINE exit pt
"RTN","IBCNRP5P",62,0)
 Q
"RTN","IBCNRP5P",63,0)
QUITX ;
"RTN","IBCNRP5P",64,0)
 Q
"RTN","IBCNRP5P",65,0)
HEADER ; Print header info for each page
"RTN","IBCNRP5P",66,0)
 ; Assumes vars from PRINT: CRT,PGC,IBPXT,MAX,SRT,BDT,EDT,PYR,RDTL,MAR
"RTN","IBCNRP5P",67,0)
 ; Init vars
"RTN","IBCNRP5P",68,0)
 N DIR,X,Y,DTOUT,DUOUT,OFFSET,HDR,DASHES,DASHES2,LIN
"RTN","IBCNRP5P",69,0)
 ;
"RTN","IBCNRP5P",70,0)
 I CRT,PGC>0,'$D(ZTQUEUED) D  I IBPXT G HEADERX
"RTN","IBCNRP5P",71,0)
 . I MAX<51 F LIN=1:1:(MAX-$Y) W !
"RTN","IBCNRP5P",72,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","IBCNRP5P",73,0)
 . I $D(DTOUT)!$D(DUOUT) S IBPXT=1 Q
"RTN","IBCNRP5P",74,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD() S (ZTSTOP,IBPXT)=1 G HEADERX
"RTN","IBCNRP5P",75,0)
 S PGC=PGC+1
"RTN","IBCNRP5P",76,0)
 W @IOF,!,?1,"ePHARM GROUP PLAN STATUS REPORT"
"RTN","IBCNRP5P",77,0)
 S HDR=$$FMTE^XLFDT($$NOW^XLFDT,1)_"  Page: "_PGC
"RTN","IBCNRP5P",78,0)
 S OFFSET=80-$L(HDR)
"RTN","IBCNRP5P",79,0)
 W ?OFFSET,HDR
"RTN","IBCNRP5P",80,0)
 W !,?1,"Report for "_$S(IBCNTYP="A":"All",IBCNTYP="P":"Pharmacy Covered",1:"Matched")_" Group Plans for "
"RTN","IBCNRP5P",81,0)
 W $$GET1^DIQ(36,IBCNSP_",",.01)_" "_$$GET1^DIQ(36,IBCNSP_",",.111)
"RTN","IBCNRP5P",82,0)
 W !,?1,"Group Name",?20,"Group #",?38,"Plan Type",?52,"Plan ID"
"RTN","IBCNRP5P",83,0)
 W ?71,"Pln Stat"
"RTN","IBCNRP5P",84,0)
 S $P(DASHES,"=",80)=""
"RTN","IBCNRP5P",85,0)
 W !,?1,DASHES
"RTN","IBCNRP5P",86,0)
 ;
"RTN","IBCNRP5P",87,0)
HEADERX ; HEADER exit pt
"RTN","IBCNRP5P",88,0)
 Q
"RTN","IBCNRPM2")
0^65^B20488193
"RTN","IBCNRPM2",1,0)
IBCNRPM2 ;BHAM ISC/CMW - Match Multiple Group Plans to a Pharmacy Plan ;10-MAR-2004
"RTN","IBCNRPM2",2,0)
 ;;2.0;INTEGRATED BILLING;**251,276**;21-MAR-94
"RTN","IBCNRPM2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRPM2",4,0)
 ;; ;
"RTN","IBCNRPM2",5,0)
EN(IBCNRP,IBCNRI,IBCNRGP) ; -- main entry point for IBCNR PAYERSHEET MATCH (LIST TEMPLATE)
"RTN","IBCNRPM2",6,0)
 D EN^VALM("IBCNR GROUP PLAN MATCH")
"RTN","IBCNRPM2",7,0)
 Q
"RTN","IBCNRPM2",8,0)
 ;
"RTN","IBCNRPM2",9,0)
HDR ; -- header code
"RTN","IBCNRPM2",10,0)
 NEW IBCNR0,IBCNRID,IBCNRNM,IBCNR10,IBCNRPBM,IBCNRBIN,IBCNRPCN,IBLEAD
"RTN","IBCNRPM2",11,0)
 NEW IBCNR3,IBCNRIN,NST,LST,X
"RTN","IBCNRPM2",12,0)
 ; get pharmacy plan data
"RTN","IBCNRPM2",13,0)
 S IBCNR0=$G(^IBCNR(366.03,+IBCNRP,0))
"RTN","IBCNRPM2",14,0)
 S IBCNRID=$P(IBCNR0,"^",1) ;id
"RTN","IBCNRPM2",15,0)
 S IBCNRNM=$P(IBCNR0,"^",2) ;name
"RTN","IBCNRPM2",16,0)
 S IBCNR10=$G(^IBCNR(366.03,+IBCNRP,10))
"RTN","IBCNRPM2",17,0)
 S IBCNRPBM=$P(IBCNR10,"^",1) ;pbm
"RTN","IBCNRPM2",18,0)
 S IBCNRBIN=$P(IBCNR10,"^",2) ;bin
"RTN","IBCNRPM2",19,0)
 S IBCNRPCN=$P(IBCNR10,"^",3) ;pcn
"RTN","IBCNRPM2",20,0)
 S IBCNR3=$G(^IBCNR(366.03,+IBCNRP,3,1,0)) ; appl
"RTN","IBCNRPM2",21,0)
 S NST=$S($P(IBCNR3,"^",2)=0:"Inactive ",1:"Active ")
"RTN","IBCNRPM2",22,0)
 S LST=$S($P(IBCNR3,"^",3)=0:"Inactive ",1:"Active ")
"RTN","IBCNRPM2",23,0)
 ; get insurance company name
"RTN","IBCNRPM2",24,0)
 S IBCNRIN=$P($G(^DIC(36,IBCNRI,0)),U)
"RTN","IBCNRPM2",25,0)
 ; row 1
"RTN","IBCNRPM2",26,0)
 S IBLEAD="FOR PHARMACY PLAN: "
"RTN","IBCNRPM2",27,0)
 S X=IBCNRNM_" - "_IBCNRID
"RTN","IBCNRPM2",28,0)
 S VALMHDR(1)=$$SETSTR^VALM1(X,IBLEAD,$L(IBLEAD)+1,80)
"RTN","IBCNRPM2",29,0)
 ; row 2
"RTN","IBCNRPM2",30,0)
 S IBLEAD="BIN: "_IBCNRBIN
"RTN","IBCNRPM2",31,0)
 S X="     PCN: "_IBCNRPCN_"     STATUS:  National "_NST_"/Local "_LST
"RTN","IBCNRPM2",32,0)
 S VALMHDR(2)=$$SETSTR^VALM1(X,IBLEAD,$L(IBLEAD)+1,80)
"RTN","IBCNRPM2",33,0)
 ; row 3
"RTN","IBCNRPM2",34,0)
 ;S X="STATUS:  National "_NST_"/"
"RTN","IBCNRPM2",35,0)
 ;S VALMHDR(3)=$$SETSTR^VALM1("Local "_LST,X,$L(X)+1,80)
"RTN","IBCNRPM2",36,0)
 ; row 4
"RTN","IBCNRPM2",37,0)
 S X="FOR INSURANCE COMPANY: "
"RTN","IBCNRPM2",38,0)
 S VALMHDR(4)=$$SETSTR^VALM1(IBCNRIN,X,$L(X)+1,80)
"RTN","IBCNRPM2",39,0)
 ;
"RTN","IBCNRPM2",40,0)
 Q
"RTN","IBCNRPM2",41,0)
 ;
"RTN","IBCNRPM2",42,0)
INIT ; -- init variables and list array
"RTN","IBCNRPM2",43,0)
 ;
"RTN","IBCNRPM2",44,0)
 I '$D(^TMP("IBCNR",$J,"GP")) D  Q
"RTN","IBCNRPM2",45,0)
 . S VALMCNT=0
"RTN","IBCNRPM2",46,0)
 . W !,*7,"Warning: No Active Group Plans with Pharmacy Coverage Found."
"RTN","IBCNRPM2",47,0)
 ;
"RTN","IBCNRPM2",48,0)
 N GPIEN,IBGP0,IBCPOLD,X,IBCPD6,IBCNRPP,IBCOV,IBCRVD,LIM
"RTN","IBCNRPM2",49,0)
 N IBGNA,IBGNM,IBCNA,IBCNM,IBDAT
"RTN","IBCNRPM2",50,0)
 K ^TMP("IBCNR",$J,"PM")
"RTN","IBCNRPM2",51,0)
 S VALMCNT=0,VALMBG=1,(IBCNA,IBCNM)=""
"RTN","IBCNRPM2",52,0)
 S (IBIND,IBMULT,IBW)=1
"RTN","IBCNRPM2",53,0)
 F  S IBCNA=$O(^TMP("IBCNR",$J,"GP",IBCNA)) Q:IBCNA=""  D
"RTN","IBCNRPM2",54,0)
 . F  S IBCNM=$O(^TMP("IBCNR",$J,"GP",IBCNA,IBCNM)) Q:IBCNM=""  D
"RTN","IBCNRPM2",55,0)
 .. ;get pharm plan id
"RTN","IBCNRPM2",56,0)
 .. S GPIEN=$O(^TMP("IBCNR",$J,"GP",IBCNA,IBCNM,"")),IBDAT=^TMP("IBCNR",$J,"GP",IBCNA,IBCNM,GPIEN)
"RTN","IBCNRPM2",57,0)
 .. ;set up list
"RTN","IBCNRPM2",58,0)
 .. S VALMCNT=VALMCNT+1
"RTN","IBCNRPM2",59,0)
 .. S X=$$SETFLD^VALM1(VALMCNT,"","NUMBER")
"RTN","IBCNRPM2",60,0)
 .. ;
"RTN","IBCNRPM2",61,0)
 .. ;group name
"RTN","IBCNRPM2",62,0)
 .. S X=$$SETFLD^VALM1(IBCNA,X,"GNAME")
"RTN","IBCNRPM2",63,0)
 .. ;
"RTN","IBCNRPM2",64,0)
 .. ;group number
"RTN","IBCNRPM2",65,0)
 .. S X=$$SETFLD^VALM1(IBCNM,X,"GNUM")
"RTN","IBCNRPM2",66,0)
 .. ;
"RTN","IBCNRPM2",67,0)
 .. ;group plan type
"RTN","IBCNRPM2",68,0)
 .. S X=$$SETFLD^VALM1($$EXPAND^IBTRE(355.3,.09,$P(IBDAT,"^",2)),X,"GTYP")
"RTN","IBCNRPM2",69,0)
 .. ;
"RTN","IBCNRPM2",70,0)
 .. ;pharmacy plan
"RTN","IBCNRPM2",71,0)
 .. S IBCNRPP=$P($G(IBDAT),U)
"RTN","IBCNRPM2",72,0)
 .. I IBCNRPP'="" S IBCNRPP=$$GET1^DIQ(366.03,IBCNRPP_",",.02,"E")
"RTN","IBCNRPM2",73,0)
 .. S X=$$SETFLD^VALM1(IBCNRPP,X,"PHRM")
"RTN","IBCNRPM2",74,0)
 .. ;
"RTN","IBCNRPM2",75,0)
 .. ; set up tmp for SEL
"RTN","IBCNRPM2",76,0)
 .. S ^TMP("IBCNR",$J,"PM",VALMCNT,0)=X
"RTN","IBCNRPM2",77,0)
 .. S ^TMP("IBCNR",$J,"PM","IDX",VALMCNT,VALMCNT)=GPIEN
"RTN","IBCNRPM2",78,0)
 ;
"RTN","IBCNRPM2",79,0)
 Q
"RTN","IBCNRPM2",80,0)
 ;
"RTN","IBCNRPM2",81,0)
HELP ; -- help code
"RTN","IBCNRPM2",82,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBCNRPM2",83,0)
 Q
"RTN","IBCNRPM2",84,0)
 ;
"RTN","IBCNRPM2",85,0)
EXIT ; -- exit code
"RTN","IBCNRPM2",86,0)
 K ^TMP("IBCNR",$J,"PM"),VALMBCK,VALMY
"RTN","IBCNRPM2",87,0)
 K IBIND,IBMULT,IBW,IBX
"RTN","IBCNRPM2",88,0)
 D CLEAN^VALM10,CLEAR^VALM1
"RTN","IBCNRPM2",89,0)
 Q
"RTN","IBCNRPM2",90,0)
 ;
"RTN","IBCNRPM2",91,0)
EXPND ; -- expand code
"RTN","IBCNRPM2",92,0)
 Q
"RTN","IBCNRPM2",93,0)
 ;
"RTN","IBCNRPM2",94,0)
SEL ;  Select Plan
"RTN","IBCNRPM2",95,0)
 ;
"RTN","IBCNRPM2",96,0)
 D S1
"RTN","IBCNRPM2",97,0)
 ;
"RTN","IBCNRPM2",98,0)
 I 'IBX Q  ; no group selected
"RTN","IBCNRPM2",99,0)
 ;
"RTN","IBCNRPM2",100,0)
 N DA,DIC,DIE,DR,D,IBSEL
"RTN","IBCNRPM2",101,0)
 S IBX=0
"RTN","IBCNRPM2",102,0)
 F  S IBX=$O(VALMY(IBX)) Q:IBX=""  D
"RTN","IBCNRPM2",103,0)
 . S IBSEL=+$G(^TMP("IBCNR",$J,"PM","IDX",IBX,IBX))
"RTN","IBCNRPM2",104,0)
 . S DA=IBSEL,DIC="^IBA(355.3,",DIE=DIC,DR="6.01////^S X="_IBCNRP
"RTN","IBCNRPM2",105,0)
 . D ^DIE
"RTN","IBCNRPM2",106,0)
 D GIPF^IBCNRPM1
"RTN","IBCNRPM2",107,0)
 D INIT
"RTN","IBCNRPM2",108,0)
 ;
"RTN","IBCNRPM2",109,0)
 S IBX=0 F  S IBX=$O(VALMY(IBX)) Q:'IBX  D
"RTN","IBCNRPM2",110,0)
 . S ^TMP($J,"IBSEL",+$G(^TMP("IBCNR",$J,"PM","IDX",IBX,IBX)))=""
"RTN","IBCNRPM2",111,0)
 ;
"RTN","IBCNRPM2",112,0)
 Q
"RTN","IBCNRPM2",113,0)
 ;
"RTN","IBCNRPM2",114,0)
DEL ; remove a plan from a group
"RTN","IBCNRPM2",115,0)
 D S1
"RTN","IBCNRPM2",116,0)
 ;
"RTN","IBCNRPM2",117,0)
 I 'IBX Q  ; no group selected
"RTN","IBCNRPM2",118,0)
 ;
"RTN","IBCNRPM2",119,0)
 NEW DA,DIC,DIE,DR,IBSEL
"RTN","IBCNRPM2",120,0)
 S IBX=0
"RTN","IBCNRPM2",121,0)
 F  S IBX=$O(VALMY(IBX)) Q:IBX=""  D
"RTN","IBCNRPM2",122,0)
 . S IBSEL=+$G(^TMP("IBCNR",$J,"PM","IDX",IBX,IBX))
"RTN","IBCNRPM2",123,0)
 . S DA=IBSEL,DIC="^IBA(355.3,",DIE=DIC,DR="6.01///@"
"RTN","IBCNRPM2",124,0)
 . D ^DIE
"RTN","IBCNRPM2",125,0)
 D GIPF^IBCNRPM1
"RTN","IBCNRPM2",126,0)
 D INIT
"RTN","IBCNRPM2",127,0)
 ;
"RTN","IBCNRPM2",128,0)
 S IBX=0 F  S IBX=$O(VALMY(IBX)) Q:'IBX  S ^TMP($J,"IBDEL",+$G(^TMP("IBCNR",$J,"PM","IDX",IBX,IBX)))=""
"RTN","IBCNRPM2",129,0)
 ;
"RTN","IBCNRPM2",130,0)
 Q
"RTN","IBCNRPM2",131,0)
 ;
"RTN","IBCNRPM2",132,0)
S1 N DIR,DIRUT,DUOUT,DTOUT,DIROUT,IBOK,IBQUIT,Y,X
"RTN","IBCNRPM2",133,0)
 D EN^VALM2($G(XQORNOD(0))),FULL^VALM1
"RTN","IBCNRPM2",134,0)
 S IBX=$O(VALMY(0)),VALMBCK="R"
"RTN","IBCNRPM2",135,0)
 ;
"RTN","IBCNRPM2",136,0)
 I 'IBX W !!,"No group selected!" D PAUSE^VALM1 Q
"RTN","IBCNRPM2",137,0)
 I 'IBMULT D  G SPQ
"RTN","IBCNRPM2",138,0)
 . D OK^IBCNSM3
"RTN","IBCNRPM2",139,0)
 . I IBQUIT S VALMBCK="Q" Q
"RTN","IBCNRPM2",140,0)
 . I IBOK S IBSEL=+$G(^TMP("IBCNR",$J,"PM","IDX",IBX)),VALMBCK="Q"
"RTN","IBCNRPM2",141,0)
 ;
"RTN","IBCNRPM2",142,0)
 ;S IBSEL=+$G(^TMP("IBCNR",$J,"PM","IDX",IBX))
"RTN","IBCNRPM2",143,0)
 ;Q
"RTN","IBCNRPM2",144,0)
 ;
"RTN","IBCNRPM2",145,0)
SPQ ;
"RTN","IBCNRPM2",146,0)
 S DIR(0)="SB^Y:YES;N:NO",DIR("B")="NO",DIR("A")="OK to Continue? "
"RTN","IBCNRPM2",147,0)
 D ^DIR K DIR
"RTN","IBCNRPM2",148,0)
 I $G(Y)="^" S IBX="" Q
"RTN","IBCNRPM2",149,0)
 I $G(Y(0))="NO" S IBX=""
"RTN","IBCNRPM2",150,0)
 Q
"RTN","IBCNRPS2")
0^22^B22515799
"RTN","IBCNRPS2",1,0)
IBCNRPS2 ;BHAM ISC/ALA - Plan Match ListMan ;13-NOV-2003
"RTN","IBCNRPS2",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBCNRPS2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRPS2",4,0)
 ;;
"RTN","IBCNRPS2",5,0)
EN ; -- main entry point for IBCNR PLAN MATCH
"RTN","IBCNRPS2",6,0)
 D EN^VALM("IBCNR PLAN STATUS INQUIRY")
"RTN","IBCNRPS2",7,0)
 Q
"RTN","IBCNRPS2",8,0)
 ;
"RTN","IBCNRPS2",9,0)
HDR ; -- header code
"RTN","IBCNRPS2",10,0)
 N IBCNS0,IBCNS11,IBCNS13,IBLEAD,X,X1,X2
"RTN","IBCNRPS2",11,0)
 S IBCNS0=$G(^DIC(36,+IBCNSP,0))
"RTN","IBCNRPS2",12,0)
 S IBCNS11=$G(^DIC(36,+IBCNSP,.11))
"RTN","IBCNRPS2",13,0)
 S IBCNS13=$G(^DIC(36,+IBCNSP,.13))
"RTN","IBCNRPS2",14,0)
 S IBLEAD="All Plans for: "
"RTN","IBCNRPS2",15,0)
 S X="Phone: "_$S($P(IBCNS13,"^")]"":$P(IBCNS13,"^"),1:"<not filed>")
"RTN","IBCNRPS2",16,0)
 S VALMHDR(1)=$$SETSTR^VALM1(X,IBLEAD_$P(IBCNS0,"^"),81-$L(X),40)
"RTN","IBCNRPS2",17,0)
 S X1="Precerts: "_$S($P(IBCNS13,"^",3)]"":$P(IBCNS13,"^",3),1:"<not filed>")
"RTN","IBCNRPS2",18,0)
 S X=$TR($J("",$L(IBLEAD)),""," ")_$S($P(IBCNS11,"^")]"":$P(IBCNS11,"^"),1:"<no street address>")
"RTN","IBCNRPS2",19,0)
 S VALMHDR(2)=$$SETSTR^VALM1(X1,X,81-$L(X1),40)
"RTN","IBCNRPS2",20,0)
 S X=$S($P(IBCNS11,"^",4)]"":$P(IBCNS11,"^",4),1:"<no city>")_", "
"RTN","IBCNRPS2",21,0)
 S X=X_$S($P(IBCNS11,"^",5):$P($G(^DIC(5,$P(IBCNS11,"^",5),0)),"^",2),1:"<no state>")_"  "_$E($P(IBCNS11,"^",6),1,5)_$S($E($P(IBCNS11,"^",6),6,9)]"":"-"_$E($P(IBCNS11,"^",6),6,9),1:"")
"RTN","IBCNRPS2",22,0)
 S VALMHDR(3)=$$SETSTR^VALM1(X,"",$L(IBLEAD)+1,80)
"RTN","IBCNRPS2",23,0)
 S X="For:  ",X=$E(X_$J("",23),1,23)_$S(IBCNTYP="A":"All",IBCNTYP="P":"Pharmacy Covered",1:"Matched")_" Group Plans."
"RTN","IBCNRPS2",24,0)
 S VALMHDR(4)=$$SETSTR^VALM1(" ",X,64,17)
"RTN","IBCNRPS2",25,0)
 Q
"RTN","IBCNRPS2",26,0)
 ;
"RTN","IBCNRPS2",27,0)
INIT ; -- init variables and create list array or report array
"RTN","IBCNRPS2",28,0)
 N IBGP0,IBCPOLD,X,IBCPD6,IBCNRPP,IBCOV,IBCVRD,LIM
"RTN","IBCNRPS2",29,0)
 K ^TMP("IBCNR",$J)
"RTN","IBCNRPS2",30,0)
 S VALMCNT=0,VALMBG=1,IBCNGP=0
"RTN","IBCNRPS2",31,0)
 F  S IBCNGP=$O(^IBA(355.3,"B",IBCNSP,IBCNGP)) Q:'IBCNGP  D
"RTN","IBCNRPS2",32,0)
 . ; if we want all plans, let it pass
"RTN","IBCNRPS2",33,0)
 . I IBCNTYP="A" D  Q
"RTN","IBCNRPS2",34,0)
 . . D SETPLAN(IBCNGP)
"RTN","IBCNRPS2",35,0)
 . ; if we want Pharmacy plans, check for pharms
"RTN","IBCNRPS2",36,0)
 . I IBCNTYP="P" D  Q
"RTN","IBCNRPS2",37,0)
 . . S IBCOV=$O(^IBE(355.31,"B","PHARMACY",""))
"RTN","IBCNRPS2",38,0)
 . . S LIM="",IBCVRD=0
"RTN","IBCNRPS2",39,0)
 . . F  S LIM=$O(^IBA(355.32,"B",IBCNGP,LIM)) Q:LIM=""  D
"RTN","IBCNRPS2",40,0)
 . . . I $P(^IBA(355.32,LIM,0),U,2)=IBCOV S IBCVRD=$P(^IBA(355.32,LIM,0),U,4)
"RTN","IBCNRPS2",41,0)
 . . I IBCVRD D SETPLAN(IBCNGP)
"RTN","IBCNRPS2",42,0)
 . ; if we want Matched plans, check for existence of Plan ID
"RTN","IBCNRPS2",43,0)
 . I IBCNTYP="M" D  Q
"RTN","IBCNRPS2",44,0)
 . . I $P($G(^IBA(355.3,IBCNGP,6)),U)'="" D SETPLAN(IBCNGP)
"RTN","IBCNRPS2",45,0)
 I VALMCNT=0 D
"RTN","IBCNRPS2",46,0)
 . S ^TMP("IBCNR",$J,"SI",1,0)="No Plans Available"
"RTN","IBCNRPS2",47,0)
 . S ^TMP("IBCNR",$J,"SI","IDX",1,1)=IBCNGP
"RTN","IBCNRPS2",48,0)
 Q
"RTN","IBCNRPS2",49,0)
 ;
"RTN","IBCNRPS2",50,0)
SETPLAN(IBCNGP) ;
"RTN","IBCNRPS2",51,0)
 ; create text
"RTN","IBCNRPS2",52,0)
 N IBGPZ,I,IBPLN,IBPLNA
"RTN","IBCNRPS2",53,0)
 S VALMCNT=VALMCNT+1
"RTN","IBCNRPS2",54,0)
 S IBGPZ=^IBA(355.3,+IBCNGP,0)
"RTN","IBCNRPS2",55,0)
 ; if creating report and not a list 
"RTN","IBCNRPS2",56,0)
 I $G(IBCNRRPT) D  Q
"RTN","IBCNRPS2",57,0)
 . ; Group Name, Group #, Group Type, Plan ID, Plan Status
"RTN","IBCNRPS2",58,0)
 . S X=$$FO^IBCNEUT1($P(IBGPZ,U,3),18)
"RTN","IBCNRPS2",59,0)
 . S X=X_" "_$$FO^IBCNEUT1($P(IBGPZ,U,4),17)
"RTN","IBCNRPS2",60,0)
 . S X=X_" "_$$FO^IBCNEUT1($$EXPAND^IBTRE(355.3,.09,$P(IBGPZ,U,9)),13)
"RTN","IBCNRPS2",61,0)
 . S IBPLN=$P($G(^IBA(355.3,+IBCNGP,6)),U)
"RTN","IBCNRPS2",62,0)
 . ; check for plan
"RTN","IBCNRPS2",63,0)
 . I IBPLN="" D  Q
"RTN","IBCNRPS2",64,0)
 . . S ^TMP("IBCNR",$J,"DSPDATA",VALMCNT)=X
"RTN","IBCNRPS2",65,0)
 . . S VALMCNT=VALMCNT+1,^TMP("IBCNR",$J,"DSPDATA",VALMCNT)="No Plan Found."
"RTN","IBCNRPS2",66,0)
 . ; check plan status information
"RTN","IBCNRPS2",67,0)
 . S IBPLNA=$P($G(^IBCNR(366.03,IBPLN,0)),U)
"RTN","IBCNRPS2",68,0)
 . S X=X_" "_$$FO^IBCNEUT1(IBPLNA,13)
"RTN","IBCNRPS2",69,0)
 . ;
"RTN","IBCNRPS2",70,0)
 . N ARRAY D STCHK^IBCNRU1(IBPLN,.ARRAY)
"RTN","IBCNRPS2",71,0)
 . S X=X_"      "_$$FO^IBCNEUT1($S($G(ARRAY(1))="I":"INACTIVE",1:"ACTIVE"),8)
"RTN","IBCNRPS2",72,0)
 . S ^TMP("IBCNR",$J,"DSPDATA",VALMCNT)=X
"RTN","IBCNRPS2",73,0)
 . I $G(ARRAY(6)) D
"RTN","IBCNRPS2",74,0)
 . . N STATAR
"RTN","IBCNRPS2",75,0)
 . . D STATAR^IBCNRU1(.STATAR)
"RTN","IBCNRPS2",76,0)
 . . F I=1:1:$L(ARRAY(6),",") D
"RTN","IBCNRPS2",77,0)
 . . . S VALMCNT=VALMCNT+1
"RTN","IBCNRPS2",78,0)
 . . . S ^TMP("IBCNR",$J,"DSPDATA",VALMCNT)="       "_$G(STATAR($P(ARRAY(6),",",I)))
"RTN","IBCNRPS2",79,0)
 ;
"RTN","IBCNRPS2",80,0)
 S X=$$SETFLD^VALM1(VALMCNT,"","NUMBER")
"RTN","IBCNRPS2",81,0)
 ;
"RTN","IBCNRPS2",82,0)
 I '$P(IBGPZ,U,2) S $E(X,4)="+"
"RTN","IBCNRPS2",83,0)
 S X=$$SETFLD^VALM1($P(IBGPZ,U,3),X,"GNAME")
"RTN","IBCNRPS2",84,0)
 ;
"RTN","IBCNRPS2",85,0)
 I '$P(IBGPZ,U,11) S $E(X,24)="*"
"RTN","IBCNRPS2",86,0)
 S X=$$SETFLD^VALM1($P(IBGPZ,U,4),X,"GNUM")
"RTN","IBCNRPS2",87,0)
 ; 
"RTN","IBCNRPS2",88,0)
 S X=$$SETFLD^VALM1($$EXPAND^IBTRE(355.3,.09,$P(IBGPZ,U,9)),X,"TYPE")
"RTN","IBCNRPS2",89,0)
 ; matched plan active or not
"RTN","IBCNRPS2",90,0)
 S IBPLN=$P($G(^IBA(355.3,+IBCNGP,6)),U)
"RTN","IBCNRPS2",91,0)
 I IBPLN'="" D
"RTN","IBCNRPS2",92,0)
 . S IBPLNA=$P($G(^IBCNR(366.03,+IBPLN,0)),U)
"RTN","IBCNRPS2",93,0)
 . S X=$$SETFLD^VALM1(IBPLNA,X,"PHARM")
"RTN","IBCNRPS2",94,0)
 . N ARRAY
"RTN","IBCNRPS2",95,0)
 . D STCHK^IBCNRU1(IBPLN,.ARRAY)
"RTN","IBCNRPS2",96,0)
 . S X=$$SETFLD^VALM1($S($G(ARRAY(1))="A":"ACTIVE",1:"INACTIVE"),X,"COV")
"RTN","IBCNRPS2",97,0)
 S ^TMP("IBCNR",$J,"SI",VALMCNT,0)=X
"RTN","IBCNRPS2",98,0)
 S ^TMP("IBCNR",$J,"SI","IDX",VALMCNT,VALMCNT)=IBCNGP
"RTN","IBCNRPS2",99,0)
 Q
"RTN","IBCNRPS2",100,0)
 ;
"RTN","IBCNRPS2",101,0)
HELP ; -- help code
"RTN","IBCNRPS2",102,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBCNRPS2",103,0)
 Q
"RTN","IBCNRPS2",104,0)
 ;
"RTN","IBCNRPS2",105,0)
EXIT ; -- exit code
"RTN","IBCNRPS2",106,0)
 K ^TMP("IBCNR",$J),VALMBCK,VALMY
"RTN","IBCNRPS2",107,0)
 D CLEAN^VALM10,CLEAR^VALM1
"RTN","IBCNRPS2",108,0)
 Q
"RTN","IBCNRPS2",109,0)
 ;
"RTN","IBCNRPS2",110,0)
SEL ; -- select plan
"RTN","IBCNRPS2",111,0)
 N IBSEL,IBX
"RTN","IBCNRPS2",112,0)
 D S1
"RTN","IBCNRPS2",113,0)
 I 'IBX Q  ; no group selected
"RTN","IBCNRPS2",114,0)
 ;
"RTN","IBCNRPS2",115,0)
 D 
"RTN","IBCNRPS2",116,0)
 . N IBCNRRPT,IBCNGP,VALMCNT,LST,IBCNRDEV
"RTN","IBCNRPS2",117,0)
 . S VALMCNT=0,IBCNRRPT=1,IBCNRDEV=0,IBCNGP=IBSEL
"RTN","IBCNRPS2",118,0)
 . K ^TMP("IBCNR",$J,"DSPDATA")
"RTN","IBCNRPS2",119,0)
 . D SETPLAN(IBSEL)
"RTN","IBCNRPS2",120,0)
 . D PRINT^IBCNRPSI
"RTN","IBCNRPS2",121,0)
 D SPQ
"RTN","IBCNRPS2",122,0)
 Q
"RTN","IBCNRPS2",123,0)
S1 ;
"RTN","IBCNRPS2",124,0)
 N DIR,DIRUT,DUOUT,DTOUT,DIROUT,IBOK,IBQUIT,Y
"RTN","IBCNRPS2",125,0)
 D EN^VALM2($G(XQORNOD(0)),"S"),FULL^VALM1
"RTN","IBCNRPS2",126,0)
 S IBX=$O(VALMY(0)),VALMBCK="R"
"RTN","IBCNRPS2",127,0)
 ;
"RTN","IBCNRPS2",128,0)
 I 'IBX W !!,"No group selected!" G SPQ
"RTN","IBCNRPS2",129,0)
 S IBSEL=+$G(^TMP("IBCNR",$J,"SI","IDX",IBX,IBX))
"RTN","IBCNRPS2",130,0)
 Q
"RTN","IBCNRPS2",131,0)
 ;
"RTN","IBCNRPS2",132,0)
SPQ ;
"RTN","IBCNRPS2",133,0)
 I '$O(IBSEL(0)),VALMBCK="R" D PAUSE^VALM1
"RTN","IBCNRPS2",134,0)
 Q
"RTN","IBCNRPSI")
0^23^B13445213
"RTN","IBCNRPSI",1,0)
IBCNRPSI ;BHAM ISC/ALA - Group Plan Status Inquiry ;14-NOV-2003
"RTN","IBCNRPSI",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBCNRPSI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRPSI",4,0)
 ;
"RTN","IBCNRPSI",5,0)
 ;**Program Description**
"RTN","IBCNRPSI",6,0)
 ;  This program select an insurance company and displays group plans 
"RTN","IBCNRPSI",7,0)
 ; (All, Pharmacy covered or Matched) for that insurance company
"RTN","IBCNRPSI",8,0)
 Q
"RTN","IBCNRPSI",9,0)
 ;
"RTN","IBCNRPSI",10,0)
EN ; Select an insurance company (inquiry entry point)
"RTN","IBCNRPSI",11,0)
 S IBCNRRPT=""
"RTN","IBCNRPSI",12,0)
EN0 ;
"RTN","IBCNRPSI",13,0)
 S DIR(0)="350.9,4.06"
"RTN","IBCNRPSI",14,0)
 S DIR("A")="Select INSURANCE COMPANY",DIR("??")="^D ADH^IBCNSM3"
"RTN","IBCNRPSI",15,0)
 S DIR("?")="Select the Insurance Company for the plan you are entering"
"RTN","IBCNRPSI",16,0)
 D ^DIR K DIR S IBCNSP=+Y I Y<1 G EXIT
"RTN","IBCNRPSI",17,0)
 I $P($G(^DIC(36,+IBCNSP,0)),"^",2)="N" W !,"This company does not reimburse.  "
"RTN","IBCNRPSI",18,0)
 I $P($G(^DIC(36,+IBCNSP,0)),"^",5) W !,*7,"Warning: Inactive Company" H 3 K IBCNSP G EXIT
"RTN","IBCNRPSI",19,0)
 ;
"RTN","IBCNRPSI",20,0)
TYPE ; Prompt to allow users to inquire for All group plans, Pharmacy group
"RTN","IBCNRPSI",21,0)
 ; plans or Matched group plans
"RTN","IBCNRPSI",22,0)
 N DIR,DIRUT
"RTN","IBCNRPSI",23,0)
 ;
"RTN","IBCNRPSI",24,0)
 S DIR(0)="S^A:All Group Plans;P:Pharmacy Group Plans;M:Matched Group Plans"
"RTN","IBCNRPSI",25,0)
 S DIR("A")=" Select the type of Group Plans you want to see"
"RTN","IBCNRPSI",26,0)
 S DIR("B")="M"
"RTN","IBCNRPSI",27,0)
 S DIR("?",1)="  A - All Group Plans"
"RTN","IBCNRPSI",28,0)
 S DIR("?",2)="  P - Pharmacy Group Plans"
"RTN","IBCNRPSI",29,0)
 S DIR("?",3)="  M - Matched Group Plans"
"RTN","IBCNRPSI",30,0)
 D ^DIR K DIR
"RTN","IBCNRPSI",31,0)
 I $D(DIRUT) G TYPEX
"RTN","IBCNRPSI",32,0)
 S IBCNTYP=Y
"RTN","IBCNRPSI",33,0)
 ;
"RTN","IBCNRPSI",34,0)
 D EN^IBCNRPS2
"RTN","IBCNRPSI",35,0)
 ;
"RTN","IBCNRPSI",36,0)
TYPEX ; TYPE exit point
"RTN","IBCNRPSI",37,0)
 ;
"RTN","IBCNRPSI",38,0)
EXIT K IBCNSP,IBCPOL,IBIND,IBMULT,IBSEL,IBW,IBALR,IBGRP,IBCNGP
"RTN","IBCNRPSI",39,0)
 K IBCNRRPT,IBCNTYP,ZTDESC,ZTSTOP,X,Y
"RTN","IBCNRPSI",40,0)
 Q
"RTN","IBCNRPSI",41,0)
 ;
"RTN","IBCNRPSI",42,0)
PRINT ; Entry pt.
"RTN","IBCNRPSI",43,0)
 ;
"RTN","IBCNRPSI",44,0)
 ; Init vars
"RTN","IBCNRPSI",45,0)
 N CRT,MAXCNT,IBPGC,IBBDT,IBEDT,IBPY,IBPXT,IBSRT,IBDTL
"RTN","IBCNRPSI",46,0)
 N X,Y,DIR,DTOUT,DUOUT,LIN,TOTALS
"RTN","IBCNRPSI",47,0)
 D:'$D(IOF) HOME^%ZIS
"RTN","IBCNRPSI",48,0)
 ;
"RTN","IBCNRPSI",49,0)
 S (IBPXT,IBPGC)=0
"RTN","IBCNRPSI",50,0)
 ;
"RTN","IBCNRPSI",51,0)
 ; Determine IO parameters
"RTN","IBCNRPSI",52,0)
 I IOST["C-" S MAXCNT=IOSL-3,CRT=1
"RTN","IBCNRPSI",53,0)
 E  S MAXCNT=IOSL-6,CRT=0
"RTN","IBCNRPSI",54,0)
 ;
"RTN","IBCNRPSI",55,0)
 D PRINTDT(MAXCNT,IBPGC)
"RTN","IBCNRPSI",56,0)
 I $G(ZTSTOP)!IBPXT G EXIT3
"RTN","IBCNRPSI",57,0)
 I CRT,IBPGC>0,'$D(ZTQUEUED) D
"RTN","IBCNRPSI",58,0)
 . I MAXCNT<51 F LIN=1:1:(MAXCNT-$Y) W !
"RTN","IBCNRPSI",59,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","IBCNRPSI",60,0)
 ;
"RTN","IBCNRPSI",61,0)
EXIT3 ; Exit pt
"RTN","IBCNRPSI",62,0)
 Q
"RTN","IBCNRPSI",63,0)
 ;
"RTN","IBCNRPSI",64,0)
PRINTDT(MAX,PGC) ; Print data
"RTN","IBCNRPSI",65,0)
 ;
"RTN","IBCNRPSI",66,0)
 ; Init vars
"RTN","IBCNRPSI",67,0)
 N EORMSG,NONEMSG,TOTDASHS,DISPDATA,SORT,CT,PRT1,PRT2
"RTN","IBCNRPSI",68,0)
 ;
"RTN","IBCNRPSI",69,0)
 S EORMSG="*** END OF REPORT ***"
"RTN","IBCNRPSI",70,0)
 S NONEMSG="* * * N O  D A T A  F O U N D * * *"
"RTN","IBCNRPSI",71,0)
 S $P(TOTDASHS,"=",89)=""
"RTN","IBCNRPSI",72,0)
 S CT=0
"RTN","IBCNRPSI",73,0)
 ;
"RTN","IBCNRPSI",74,0)
 ; Display lines of response
"RTN","IBCNRPSI",75,0)
 D LINE
"RTN","IBCNRPSI",76,0)
 K ^TMP("IBCNR",$J,"DSPDATA")
"RTN","IBCNRPSI",77,0)
 Q
"RTN","IBCNRPSI",78,0)
HEADER ; Print header info for each page
"RTN","IBCNRPSI",79,0)
 ; Assumes vars from PRINT: CRT,PGC,IBPXT,MAX,SRT,BDT,EDT,PYR,RDTL,MAR
"RTN","IBCNRPSI",80,0)
 ; Init vars
"RTN","IBCNRPSI",81,0)
 N DIR,X,Y,DTOUT,DUOUT,OFFSET,HDR,DASHES,DASHES2,LIN
"RTN","IBCNRPSI",82,0)
 ;
"RTN","IBCNRPSI",83,0)
 I CRT,PGC>0,'$D(ZTQUEUED) D  I IBPXT G HEADERX
"RTN","IBCNRPSI",84,0)
 . I MAX<51 F LIN=1:1:(MAX-$Y) W !
"RTN","IBCNRPSI",85,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","IBCNRPSI",86,0)
 . I $D(DTOUT)!$D(DUOUT) S IBPXT=1 Q
"RTN","IBCNRPSI",87,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD() S (ZTSTOP,IBPXT)=1 G HEADERX
"RTN","IBCNRPSI",88,0)
 S PGC=PGC+1
"RTN","IBCNRPSI",89,0)
 W @IOF,!,?1,"ePHARM GROUP PLAN STATUS INQUIRY"
"RTN","IBCNRPSI",90,0)
 S HDR=$$FMTE^XLFDT($$NOW^XLFDT,1)_"  Page: "_PGC
"RTN","IBCNRPSI",91,0)
 S OFFSET=80-$L(HDR)
"RTN","IBCNRPSI",92,0)
 W ?OFFSET,HDR
"RTN","IBCNRPSI",93,0)
 W !,?1,"Report for "_$S(IBCNTYP="A":"All",IBCNTYP="P":"Pharmacy Covered",1:"Matched")_" Group Plans for "_$$GET1^DIQ(36,IBCNSP_",",.01)
"RTN","IBCNRPSI",94,0)
 W !,?1,"Group Name",?20,"Group #",?38,"Plan Type",?52,"Plan ID"
"RTN","IBCNRPSI",95,0)
 W ?71,"Pln Stat"
"RTN","IBCNRPSI",96,0)
 S $P(DASHES,"=",80)=""
"RTN","IBCNRPSI",97,0)
 W !,?1,DASHES
"RTN","IBCNRPSI",98,0)
 ;
"RTN","IBCNRPSI",99,0)
HEADERX ; HEADER exit pt
"RTN","IBCNRPSI",100,0)
 Q
"RTN","IBCNRPSI",101,0)
 ;
"RTN","IBCNRPSI",102,0)
LINE ; Print line of data
"RTN","IBCNRPSI",103,0)
 ; Assumes vars from PRINT: PGC,IBPXT,MAX
"RTN","IBCNRPSI",104,0)
 ; Init vars
"RTN","IBCNRPSI",105,0)
 N CT,II
"RTN","IBCNRPSI",106,0)
 ;
"RTN","IBCNRPSI",107,0)
 S CT=+$O(^TMP("IBCNR",$J,"DSPDATA",""),-1)
"RTN","IBCNRPSI",108,0)
 I $Y+1+CT>MAX D HEADER I $G(ZTSTOP)!IBPXT G LINEX
"RTN","IBCNRPSI",109,0)
 F II=1:1:CT D  Q:$G(ZTSTOP)!IBPXT
"RTN","IBCNRPSI",110,0)
 . I $Y+1>MAX!('PGC) D HEADER I $G(ZTSTOP)!IBPXT Q
"RTN","IBCNRPSI",111,0)
 . W !,?1,^TMP("IBCNR",$J,"DSPDATA",II)
"RTN","IBCNRPSI",112,0)
 . Q
"RTN","IBCNRPSI",113,0)
 ;
"RTN","IBCNRPSI",114,0)
LINEX ; LINE exit pt
"RTN","IBCNRPSI",115,0)
 Q
"RTN","IBCNRPSI",116,0)
QUITX ;
"RTN","IBCNRPSI",117,0)
 Q
"RTN","IBCNRRP1")
0^26^B32540421
"RTN","IBCNRRP1",1,0)
IBCNRRP1 ;BHAM ISC/CMW - Group Plan Worksheet Report ;03-MAR-2004
"RTN","IBCNRRP1",2,0)
 ;;2.0;INTEGRATED BILLING;**251,276**;21-MAR-94
"RTN","IBCNRRP1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRRP1",4,0)
 ;
"RTN","IBCNRRP1",5,0)
 ; e-Pharmacy Group Plan Worksheet Report
"RTN","IBCNRRP1",6,0)
 ;
"RTN","IBCNRRP1",7,0)
 ; Input parameter: N/A
"RTN","IBCNRRP1",8,0)
 ; Other relevant variables:
"RTN","IBCNRRP1",9,0)
 ;   IBCNRRTN = "IBCNRRP1" (current routine name for queuing the 
"RTN","IBCNRRP1",10,0)
 ;                          COMPILE process)
"RTN","IBCNRRP1",11,0)
 ;   IBCNRSPC("BEGDT") = start date for date range
"RTN","IBCNRRP1",12,0)
 ;   IBCNRSPC("ENDDT") = end date for date range
"RTN","IBCNRRP1",13,0)
 ;   IBCNRSPC("SORT") = 1 - By Insurance/Group; 2 - Total Claims; 
"RTN","IBCNRRP1",14,0)
 ;                      3 - Total Charges; 4 - BIN/PCN Exceptions
"RTN","IBCNRRP1",15,0)
 ;   IBCNRSPC("MATCH")= 1 - Matched only; 0 - All 
"RTN","IBCNRRP1",16,0)
 ;
"RTN","IBCNRRP1",17,0)
 ; Enter only from EN tag ONLY
"RTN","IBCNRRP1",18,0)
 Q
"RTN","IBCNRRP1",19,0)
 ;
"RTN","IBCNRRP1",20,0)
 ; Entry point
"RTN","IBCNRRP1",21,0)
EN ;
"RTN","IBCNRRP1",22,0)
 ; Initialize variables
"RTN","IBCNRRP1",23,0)
 N STOP,IBCNRRTN,IBCNRSPC,RESORT
"RTN","IBCNRRP1",24,0)
 D:'$D(IOF) HOME^%ZIS
"RTN","IBCNRRP1",25,0)
 ;
"RTN","IBCNRRP1",26,0)
 S STOP=0,IBPXT=$G(IBPXT)
"RTN","IBCNRRP1",27,0)
 S IBCNRRTN="IBCNRRP1"
"RTN","IBCNRRP1",28,0)
 W @IOF
"RTN","IBCNRRP1",29,0)
 W !,"ePHARM GROUP PLAN WORKSHEET REPORT",!
"RTN","IBCNRRP1",30,0)
 W !,"NCPDP process requires that the users match Group Plans to Pharmacy Plans."
"RTN","IBCNRRP1",31,0)
 W !,"This report will assist users in matching Group Insurance Plans to Pharmacy"
"RTN","IBCNRRP1",32,0)
 W !,"  Plans by searching through Billing/Claims file for authorized claims that "
"RTN","IBCNRRP1",33,0)
 W !,"    have Group Plans with active Pharmacy Plan coverage."
"RTN","IBCNRRP1",34,0)
 ;
"RTN","IBCNRRP1",35,0)
 ; Prompts 
"RTN","IBCNRRP1",36,0)
 ; lock global
"RTN","IBCNRRP1",37,0)
 L +^XTMP(IBCNRRTN):5 I '$T W !!,"Sorry, Worksheet Report in use." H 2 G EXIT
"RTN","IBCNRRP1",38,0)
 ;Check for prior compile
"RTN","IBCNRRP1",39,0)
P10 D RESORT(.RESORT) I STOP G EXIT
"RTN","IBCNRRP1",40,0)
 I $G(RESORT) G P40
"RTN","IBCNRRP1",41,0)
 K ^XTMP(IBCNRRTN)
"RTN","IBCNRRP1",42,0)
 ; Date Range parameters
"RTN","IBCNRRP1",43,0)
P30 D DTRANGE I STOP G:$$STOP EXIT G P10
"RTN","IBCNRRP1",44,0)
 ; Sort parameters
"RTN","IBCNRRP1",45,0)
P40 D SORT I STOP G:$$STOP EXIT G P30
"RTN","IBCNRRP1",46,0)
 ; Select the output device
"RTN","IBCNRRP1",47,0)
P100 D DEVICE(IBCNRRTN,.IBCNRSPC) I STOP!IBPXT G:$$STOP EXIT G P40
"RTN","IBCNRRP1",48,0)
 ;
"RTN","IBCNRRP1",49,0)
EXIT ; Quit this routine
"RTN","IBCNRRP1",50,0)
 ; unlock global
"RTN","IBCNRRP1",51,0)
 L -^XTMP(IBCNRRTN)
"RTN","IBCNRRP1",52,0)
 K IBPXT
"RTN","IBCNRRP1",53,0)
 Q
"RTN","IBCNRRP1",54,0)
 ;
"RTN","IBCNRRP1",55,0)
RESORT(RESORT) ; check for prior compile
"RTN","IBCNRRP1",56,0)
 NEW DIR,BDT,EDT,RDT,HDR,IBDT,X,Y,DIRUT
"RTN","IBCNRRP1",57,0)
 I '$D(^XTMP(IBCNRRTN)) Q
"RTN","IBCNRRP1",58,0)
 S IBDT=$G(^XTMP(IBCNRRTN,0,0))
"RTN","IBCNRRP1",59,0)
 S BDT=$P(IBDT,U,1),EDT=$P(IBDT,U,2),RDT=$P(IBDT,U,3),RESORT=0
"RTN","IBCNRRP1",60,0)
 S HDR=$$FMTE^XLFDT(BDT,"5Z")_" - "_$$FMTE^XLFDT(EDT,"5Z")
"RTN","IBCNRRP1",61,0)
 W !!,"A Report file run on: ",RDT,!,?5," exist for date range: ",HDR,!
"RTN","IBCNRRP1",62,0)
 S DIR(0)="Y"
"RTN","IBCNRRP1",63,0)
 S DIR("A")="Do you want to use the existing report file"
"RTN","IBCNRRP1",64,0)
 S DIR("B")="YES"
"RTN","IBCNRRP1",65,0)
 S DIR("?",1)=" Enter YES to use the existing report file."
"RTN","IBCNRRP1",66,0)
 S DIR("?")=" Enter NO to DELETE existing file and recompile,"
"RTN","IBCNRRP1",67,0)
 D ^DIR K DIR
"RTN","IBCNRRP1",68,0)
 I $D(DIRUT) S STOP=1 G RESRTX
"RTN","IBCNRRP1",69,0)
 S RESORT=Y
"RTN","IBCNRRP1",70,0)
 S IBCNRSPC("RESORT")=Y
"RTN","IBCNRRP1",71,0)
 S IBCNRSPC("BEGDT")=BDT
"RTN","IBCNRRP1",72,0)
 S IBCNRSPC("ENDDT")=EDT
"RTN","IBCNRRP1",73,0)
 ;
"RTN","IBCNRRP1",74,0)
RESRTX ;RESORT EXIT
"RTN","IBCNRRP1",75,0)
 Q
"RTN","IBCNRRP1",76,0)
 ;
"RTN","IBCNRRP1",77,0)
COMPILE(IBCNRRTN,IBCNRSPC) ; 
"RTN","IBCNRRP1",78,0)
 ; Entry point called from EN^XUTMDEVQ in either direct or queued mode.
"RTN","IBCNRRP1",79,0)
 ; Input params:
"RTN","IBCNRRP1",80,0)
 ;  IBCNRRTN = Routine name for ^TMP(...
"RTN","IBCNRRP1",81,0)
 ;  IBCNRSPC = Array passed by ref of the report params
"RTN","IBCNRRP1",82,0)
 ;
"RTN","IBCNRRP1",83,0)
 ; Init scratch globals
"RTN","IBCNRRP1",84,0)
 I '$G(IBCNRSPC("RESORT")) D
"RTN","IBCNRRP1",85,0)
 . ; Compile
"RTN","IBCNRRP1",86,0)
 . I IBCNRRTN="IBCNRRP1" D EN^IBCNRRP2(IBCNRRTN,.IBCNRSPC)
"RTN","IBCNRRP1",87,0)
 ; Print
"RTN","IBCNRRP1",88,0)
 I '$G(ZTSTOP) D
"RTN","IBCNRRP1",89,0)
 . I IBCNRRTN="IBCNRRP1" D EN^IBCNRRP3(IBCNRRTN,.IBCNRSPC)
"RTN","IBCNRRP1",90,0)
 ; Close device
"RTN","IBCNRRP1",91,0)
 D ^%ZISC
"RTN","IBCNRRP1",92,0)
 ;
"RTN","IBCNRRP1",93,0)
 ; Purge task record
"RTN","IBCNRRP1",94,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBCNRRP1",95,0)
 ;
"RTN","IBCNRRP1",96,0)
COMPILX ; COMPILE exit pt
"RTN","IBCNRRP1",97,0)
 Q
"RTN","IBCNRRP1",98,0)
 ;
"RTN","IBCNRRP1",99,0)
STOP() ; Determine if user wants to exit out of the whole option
"RTN","IBCNRRP1",100,0)
 ; Init vars
"RTN","IBCNRRP1",101,0)
 N DIR,X,Y,DIRUT
"RTN","IBCNRRP1",102,0)
 ;
"RTN","IBCNRRP1",103,0)
 W !
"RTN","IBCNRRP1",104,0)
 S DIR(0)="Y"
"RTN","IBCNRRP1",105,0)
 S DIR("A")="Do you want to exit out of this option entirely"
"RTN","IBCNRRP1",106,0)
 S DIR("B")="YES"
"RTN","IBCNRRP1",107,0)
 S DIR("?",1)="  Enter YES to immediately exit out of this option."
"RTN","IBCNRRP1",108,0)
 S DIR("?")="  Enter NO to return to the previous question."
"RTN","IBCNRRP1",109,0)
 D ^DIR K DIR
"RTN","IBCNRRP1",110,0)
 I $D(DIRUT) S (STOP,Y)=1 G STOPX
"RTN","IBCNRRP1",111,0)
 I 'Y S STOP=0
"RTN","IBCNRRP1",112,0)
 ;
"RTN","IBCNRRP1",113,0)
STOPX ; STOP exit pt
"RTN","IBCNRRP1",114,0)
 Q Y
"RTN","IBCNRRP1",115,0)
 ;
"RTN","IBCNRRP1",116,0)
DTRANGE ; Determine start and end dates for date range param
"RTN","IBCNRRP1",117,0)
 ; Init vars
"RTN","IBCNRRP1",118,0)
 N X,Y,DIRUT
"RTN","IBCNRRP1",119,0)
 ;
"RTN","IBCNRRP1",120,0)
 W !
"RTN","IBCNRRP1",121,0)
 ;
"RTN","IBCNRRP1",122,0)
 S DIR(0)="D^::EX"
"RTN","IBCNRRP1",123,0)
 S DIR("A")="Start DATE"
"RTN","IBCNRRP1",124,0)
 S DIR("?",1)="   Please enter a valid date for which an Bill/Claim"
"RTN","IBCNRRP1",125,0)
 S DIR("?")="   would have been authorized."
"RTN","IBCNRRP1",126,0)
 D ^DIR K DIR
"RTN","IBCNRRP1",127,0)
 I $D(DIRUT) S STOP=1 G DTRANGX
"RTN","IBCNRRP1",128,0)
 S IBCNRSPC("BEGDT")=Y
"RTN","IBCNRRP1",129,0)
 ; End date
"RTN","IBCNRRP1",130,0)
DTRANG1 S DIR(0)="D^::EX"
"RTN","IBCNRRP1",131,0)
 S DIR("A")="  End DATE"
"RTN","IBCNRRP1",132,0)
 S DIR("?",1)="   Please enter a valid date for which an Bill/Claim"
"RTN","IBCNRRP1",133,0)
 S DIR("?",2)="   would have been authorized.  This date must not precede"
"RTN","IBCNRRP1",134,0)
 S DIR("?")="   the Start Date."
"RTN","IBCNRRP1",135,0)
 D ^DIR K DIR
"RTN","IBCNRRP1",136,0)
 I $D(DIRUT) S STOP=1 G DTRANGX
"RTN","IBCNRRP1",137,0)
 I Y<IBCNRSPC("BEGDT") D  G DTRANG1
"RTN","IBCNRRP1",138,0)
 . W !,"     End Date must not precede the Start Date."
"RTN","IBCNRRP1",139,0)
 . W !,"     Please reenter."
"RTN","IBCNRRP1",140,0)
 S IBCNRSPC("ENDDT")=Y
"RTN","IBCNRRP1",141,0)
 ;
"RTN","IBCNRRP1",142,0)
DTRANGX ; DTRANGE exit pt
"RTN","IBCNRRP1",143,0)
 Q
"RTN","IBCNRRP1",144,0)
 ;
"RTN","IBCNRRP1",145,0)
SORT ; Prompt to allow users to sort the report
"RTN","IBCNRRP1",146,0)
 ;  by Insurance/Group, Max claims, Max charges
"RTN","IBCNRRP1",147,0)
 NEW DIR,X,Y,DIRUT
"RTN","IBCNRRP1",148,0)
 ;
"RTN","IBCNRRP1",149,0)
 S DIR(0)="S^1:Insurance/Group;2:Total Claims;3:Total Charges;4:Exceptions Only"
"RTN","IBCNRRP1",150,0)
 S DIR("A")=" Select the primary sort field"
"RTN","IBCNRRP1",151,0)
 S DIR("B")=1
"RTN","IBCNRRP1",152,0)
 S DIR("?",1)="  1 - Sort all Claims by Insurance/Group. (Default)"
"RTN","IBCNRRP1",153,0)
 S DIR("?",2)="  2 - Sort by Groups with the most Claims"
"RTN","IBCNRRP1",154,0)
 S DIR("?",3)="  3 - Sort by Groups with the most Charges"
"RTN","IBCNRRP1",155,0)
 S DIR("?",4)="  4 - Show BIN/PCN Exceptions only"
"RTN","IBCNRRP1",156,0)
 D ^DIR K DIR
"RTN","IBCNRRP1",157,0)
 I $D(DIRUT) S STOP=1 G SORTX
"RTN","IBCNRRP1",158,0)
 S IBCNRSPC("SORT")=Y
"RTN","IBCNRRP1",159,0)
 ;
"RTN","IBCNRRP1",160,0)
 ;Prompt for All/Matched only
"RTN","IBCNRRP1",161,0)
 S DIR(0)="SA^A:All;M:Matched Only"
"RTN","IBCNRRP1",162,0)
 S DIR("A")=" List (A)LL Insurance/Groups or (M)atched Only: "
"RTN","IBCNRRP1",163,0)
 S DIR("B")="Matched Only"
"RTN","IBCNRRP1",164,0)
 W ! D ^DIR K DIR
"RTN","IBCNRRP1",165,0)
 I $D(DIRUT) S STOP=1 G SORTX
"RTN","IBCNRRP1",166,0)
 S IBCNRSPC("MATCH")=(Y="M")
"RTN","IBCNRRP1",167,0)
 ;
"RTN","IBCNRRP1",168,0)
SORTX ; SORT exit point
"RTN","IBCNRRP1",169,0)
 Q
"RTN","IBCNRRP1",170,0)
 ;
"RTN","IBCNRRP1",171,0)
 ;
"RTN","IBCNRRP1",172,0)
DEVICE(IBCNRRTN,IBCNRSPC) ; Device Handler and possible TaskManager calls
"RTN","IBCNRRP1",173,0)
 ;
"RTN","IBCNRRP1",174,0)
 ; Input params:
"RTN","IBCNRRP1",175,0)
 ;  IBCNRRTN = Routine name for ^TMP($J,...
"RTN","IBCNRRP1",176,0)
 ;  IBCNRSPC = Array passed by ref of the report params
"RTN","IBCNRRP1",177,0)
 ;
"RTN","IBCNRRP1",178,0)
 ; Init vars
"RTN","IBCNRRP1",179,0)
 N ZTRTN,ZTDESC,ZTSAVE,POP
"RTN","IBCNRRP1",180,0)
 ;
"RTN","IBCNRRP1",181,0)
 ;I IBCNRRTN="IBCNRRP1" W !!!,"*** This report is 132 characters wide ***",!
"RTN","IBCNRRP1",182,0)
 S ZTRTN="COMPILE^IBCNRRP1("""_IBCNRRTN_""",.IBCNRSPC)"
"RTN","IBCNRRP1",183,0)
 S ZTDESC="ePHARM GROUP PLAN WORKSHEET REPORT"
"RTN","IBCNRRP1",184,0)
 S ZTSAVE("IBCNRSPC(")=""
"RTN","IBCNRRP1",185,0)
 S ZTSAVE("IBCNRRTN")=""
"RTN","IBCNRRP1",186,0)
 D EN^XUTMDEVQ(ZTRTN,ZTDESC,.ZTSAVE)
"RTN","IBCNRRP1",187,0)
 I POP S STOP=1
"RTN","IBCNRRP1",188,0)
 ;
"RTN","IBCNRRP1",189,0)
DEVICEX ; DEVICE exit pt
"RTN","IBCNRRP1",190,0)
 Q
"RTN","IBCNRRP1",191,0)
 ;
"RTN","IBCNRRP3")
0^27^B55033574
"RTN","IBCNRRP3",1,0)
IBCNRRP3 ;BHAM ISC/CMW - GROUP PLAN WORKSHEET REPORT PRINT ;03-MAR-2004
"RTN","IBCNRRP3",2,0)
 ;;2.0;INTEGRATED BILLING;**251,276**;21-MAR-94
"RTN","IBCNRRP3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRRP3",4,0)
 ;
"RTN","IBCNRRP3",5,0)
 ; ePHARM GROUP PLAN WORKSHEET REPORT
"RTN","IBCNRRP3",6,0)
 ;
"RTN","IBCNRRP3",7,0)
 ; Called by IBCNRRP1
"RTN","IBCNRRP3",8,0)
 ;
"RTN","IBCNRRP3",9,0)
 ; Input variables from IBCNRRP1 and IBCNRRP2:
"RTN","IBCNRRP3",10,0)
 ;   IBCNRRTN = "IBCNRRP1"
"RTN","IBCNRRP3",11,0)
 ;   IBCNRSPC("BEGDT") = Start Date for dt range
"RTN","IBCNRRP3",12,0)
 ;   IBCNRSPC("ENDDT") = End Date for dt range
"RTN","IBCNRRP3",13,0)
 ;   IBCNRSPC("SORT") = 1 - By Insurance/Group; 2 - Total Claims; 
"RTN","IBCNRRP3",14,0)
 ;                      3 - Total Charges; 4 - Exceptions
"RTN","IBCNRRP3",15,0)
 ;   IBCNRSPC("MATCH") = 1 - Matched Only; 0 - All;
"RTN","IBCNRRP3",16,0)
 ;    
"RTN","IBCNRRP3",17,0)
 ;   ^TMP(IBCNRRTN,1); ^TMP(IBCNRRTN,2); ^TMP(IBCNRRTN,3)
"RTN","IBCNRRP3",18,0)
 ; Must call at appropriate tag
"RTN","IBCNRRP3",19,0)
 Q
"RTN","IBCNRRP3",20,0)
 ;
"RTN","IBCNRRP3",21,0)
 ;
"RTN","IBCNRRP3",22,0)
EN(IBCNRRTN,IBCNRSPC) ; Entry pt.
"RTN","IBCNRRP3",23,0)
 ;
"RTN","IBCNRRP3",24,0)
 ; Init vars
"RTN","IBCNRRP3",25,0)
 N CRT,MAXCNT,IBPGC,IBBDT,IBEDT,IBMAT,IBPY,IBPXT,IBSRT,IBDTL
"RTN","IBCNRRP3",26,0)
 N X,Y,DIR,DTOUT,DUOUT,LIN,TOTALS
"RTN","IBCNRRP3",27,0)
 ;
"RTN","IBCNRRP3",28,0)
 S IBBDT=$G(IBCNRSPC("BEGDT"))
"RTN","IBCNRRP3",29,0)
 S IBEDT=$G(IBCNRSPC("ENDDT"))
"RTN","IBCNRRP3",30,0)
 S IBSRT=$G(IBCNRSPC("SORT"))
"RTN","IBCNRRP3",31,0)
 S IBMAT=$G(IBCNRSPC("MATCH"))
"RTN","IBCNRRP3",32,0)
 S (IBPXT,IBPGC)=0
"RTN","IBCNRRP3",33,0)
 ;
"RTN","IBCNRRP3",34,0)
 ; Determine IO parameters
"RTN","IBCNRRP3",35,0)
 I IOST["C-" S MAXCNT=IOSL-3,CRT=1
"RTN","IBCNRRP3",36,0)
 E  S MAXCNT=IOSL-6,CRT=0
"RTN","IBCNRRP3",37,0)
 ;
"RTN","IBCNRRP3",38,0)
 D PRINT(IBCNRRTN,IBBDT,IBEDT,IBSRT,MAXCNT,IBPGC,IBMAT)
"RTN","IBCNRRP3",39,0)
 I $G(ZTSTOP)!IBPXT G EXIT3
"RTN","IBCNRRP3",40,0)
 I CRT,IBPGC>0,'$D(ZTQUEUED) D
"RTN","IBCNRRP3",41,0)
 . I MAXCNT<51 F LIN=1:1:(MAXCNT-$Y) W !
"RTN","IBCNRRP3",42,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","IBCNRRP3",43,0)
 ;
"RTN","IBCNRRP3",44,0)
EXIT3 ; Exit pt
"RTN","IBCNRRP3",45,0)
 Q
"RTN","IBCNRRP3",46,0)
 ;
"RTN","IBCNRRP3",47,0)
PRINT(RTN,BDT,EDT,SRT,MAX,PGC,MAT) ; Print data
"RTN","IBCNRRP3",48,0)
 ; Input params: RNT = "IBCNRRP1" - routine, BDT = starting dt,
"RTN","IBCNRRP3",49,0)
 ;  EDT = ending dt
"RTN","IBCNRRP3",50,0)
 ;  SRT = 1/2/3
"RTN","IBCNRRP3",51,0)
 ;  MAT = 1/0
"RTN","IBCNRRP3",52,0)
 ;
"RTN","IBCNRRP3",53,0)
 ; Init vars
"RTN","IBCNRRP3",54,0)
 N EORMSG,NONEMSG,TOTDASHS,DISPDATA,SORT,CT,PRT1,PRT2
"RTN","IBCNRRP3",55,0)
 ;
"RTN","IBCNRRP3",56,0)
 S EORMSG="*** END OF REPORT ***"
"RTN","IBCNRRP3",57,0)
 S NONEMSG="* * * N O  D A T A  F O U N D * * *"
"RTN","IBCNRRP3",58,0)
 S $P(TOTDASHS,"=",89)=""
"RTN","IBCNRRP3",59,0)
 S CT=0
"RTN","IBCNRRP3",60,0)
 ;
"RTN","IBCNRRP3",61,0)
 I '$D(^XTMP(RTN)) D HEADER W !,?(132-$L(NONEMSG)\2),NONEMSG,!! G PRINT2
"RTN","IBCNRRP3",62,0)
 ;
"RTN","IBCNRRP3",63,0)
 ; Build lines of data to display
"RTN","IBCNRRP3",64,0)
 K ^TMP("IBCNR",$J,"RPTDATA")
"RTN","IBCNRRP3",65,0)
 D DATA
"RTN","IBCNRRP3",66,0)
 K ^TMP("IBCNR",$J,"DSPDATA")
"RTN","IBCNRRP3",67,0)
 D DISP
"RTN","IBCNRRP3",68,0)
 ; Display lines of response
"RTN","IBCNRRP3",69,0)
 D LINE
"RTN","IBCNRRP3",70,0)
 K ^TMP("IBCNR",$J,"DSPDATA"),^TMP("IBCNR",$J,"RPTDATA")
"RTN","IBCNRRP3",71,0)
 Q
"RTN","IBCNRRP3",72,0)
 ;
"RTN","IBCNRRP3",73,0)
PRINT2 I $G(ZTSTOP)!IBPXT G PRINTX
"RTN","IBCNRRP3",74,0)
 I $Y+1>MAX!('PGC) D HEADER I $G(ZTSTOP)!$G(IBPXT) G PRINTX
"RTN","IBCNRRP3",75,0)
 W !,?(132-$L(EORMSG)\2),EORMSG
"RTN","IBCNRRP3",76,0)
 ;
"RTN","IBCNRRP3",77,0)
PRINTX ; PRINT exit point
"RTN","IBCNRRP3",78,0)
 Q
"RTN","IBCNRRP3",79,0)
 ;
"RTN","IBCNRRP3",80,0)
HEADER ; Print header info for each page
"RTN","IBCNRRP3",81,0)
 ; Assumes vars from PRINT: CRT,PGC,IBPXT,MAX,SRT,BDT,EDT,PYR,RDTL,MAR
"RTN","IBCNRRP3",82,0)
 ; Init vars
"RTN","IBCNRRP3",83,0)
 N DIR,X,Y,DTOUT,DUOUT,OFFSET,HDR,DASHES,DASHES2,LIN
"RTN","IBCNRRP3",84,0)
 ;
"RTN","IBCNRRP3",85,0)
 I CRT,PGC>0,'$D(ZTQUEUED) D  I IBPXT G HEADERX
"RTN","IBCNRRP3",86,0)
 . I MAX<51 F LIN=1:1:(MAX-$Y) W !
"RTN","IBCNRRP3",87,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","IBCNRRP3",88,0)
 . I $D(DTOUT)!$D(DUOUT) S IBPXT=1 Q
"RTN","IBCNRRP3",89,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD() S (ZTSTOP,IBPXT)=1 G HEADERX
"RTN","IBCNRRP3",90,0)
 S PGC=PGC+1
"RTN","IBCNRRP3",91,0)
 W @IOF,!,?1,"ePHARM GROUP PLAN WORKSHEET REPORT"
"RTN","IBCNRRP3",92,0)
 S HDR=$$FMTE^XLFDT($$NOW^XLFDT,1)_"  Page: "_PGC
"RTN","IBCNRRP3",93,0)
 S OFFSET=80-$L(HDR)
"RTN","IBCNRRP3",94,0)
 W ?OFFSET,HDR
"RTN","IBCNRRP3",95,0)
 W !,?1,"Claims with Pharmacy Coverage Sorted by: "_$S(SRT=1:"Insurance/Group",SRT=2:"Max. Total Claims",1:"Max. Total Charges")
"RTN","IBCNRRP3",96,0)
 S HDR=$$FMTE^XLFDT(BDT,"5Z")_" - "_$$FMTE^XLFDT(EDT,"5Z")
"RTN","IBCNRRP3",97,0)
 S OFFSET=80-$L(HDR)\2
"RTN","IBCNRRP3",98,0)
 W !,?OFFSET,HDR
"RTN","IBCNRRP3",99,0)
 ; Display column headings
"RTN","IBCNRRP3",100,0)
 W !,?1,"Insurance Company Name",?40,"Insurance Company Address"
"RTN","IBCNRRP3",101,0)
 W !,?3,"Group Name/Number",?42,"Pharmacy Plan",?60," BIN",?70,"PCN"
"RTN","IBCNRRP3",102,0)
 S $P(DASHES,"=",80)=""
"RTN","IBCNRRP3",103,0)
 W !,?1,DASHES
"RTN","IBCNRRP3",104,0)
 ;
"RTN","IBCNRRP3",105,0)
HEADERX ; HEADER exit pt
"RTN","IBCNRRP3",106,0)
 Q
"RTN","IBCNRRP3",107,0)
 ;
"RTN","IBCNRRP3",108,0)
LINE ; Print line of data
"RTN","IBCNRRP3",109,0)
 ; Assumes vars from PRINT: PGC,IBPXT,MAX
"RTN","IBCNRRP3",110,0)
 ; Init vars
"RTN","IBCNRRP3",111,0)
 N CT,II
"RTN","IBCNRRP3",112,0)
 ;
"RTN","IBCNRRP3",113,0)
 S CT=+$O(^TMP("IBCNR",$J,"DSPDATA",""),-1)
"RTN","IBCNRRP3",114,0)
 I $Y+1+CT>MAX D HEADER I $G(ZTSTOP)!IBPXT G LINEX
"RTN","IBCNRRP3",115,0)
 F II=1:1:CT D  Q:$G(ZTSTOP)!IBPXT
"RTN","IBCNRRP3",116,0)
 . I $Y+1>MAX!('PGC) D HEADER I $G(ZTSTOP)!IBPXT Q
"RTN","IBCNRRP3",117,0)
 . W !,?1,^TMP("IBCNR",$J,"DSPDATA",II)
"RTN","IBCNRRP3",118,0)
 . Q
"RTN","IBCNRRP3",119,0)
 ;
"RTN","IBCNRRP3",120,0)
LINEX ; LINE exit pt
"RTN","IBCNRRP3",121,0)
 Q
"RTN","IBCNRRP3",122,0)
 ;
"RTN","IBCNRRP3",123,0)
DATA ; Gather and format lines of data to be printed
"RTN","IBCNRRP3",124,0)
 ; Assumes vars from PRINT: RTN,SRT,SRT,RDTL,CT,PRT1,PRT2
"RTN","IBCNRRP3",125,0)
 ; Init vars
"RTN","IBCNRRP3",126,0)
 ;
"RTN","IBCNRRP3",127,0)
 ;Loop through and sort TMP file
"RTN","IBCNRRP3",128,0)
 N CNT,IBINS,IBINSNM,IBGRP,IBGRPNM,IBGRPNB,RPDT,RPTOT,RPTCNT,RPTCHG
"RTN","IBCNRRP3",129,0)
 N IBGRP0,IBGRP6,IBGRPNM,IBPLBIN,IBPLNNM,IBPLPCN,IBPPIEN
"RTN","IBCNRRP3",130,0)
 S IBINS=0,CNT=0
"RTN","IBCNRRP3",131,0)
 F  S IBINS=$O(^XTMP(RTN,IBINS)) Q:IBINS=""  D
"RTN","IBCNRRP3",132,0)
 . ;get insurance company name
"RTN","IBCNRRP3",133,0)
 . S IBINSNM=$P($G(^DIC(36,IBINS,0)),U)
"RTN","IBCNRRP3",134,0)
 . I IBINSNM="" S IBINSNM="NO NAME EXISTS"
"RTN","IBCNRRP3",135,0)
 . S IBGRP=0
"RTN","IBCNRRP3",136,0)
 . F  S IBGRP=$O(^XTMP(RTN,IBINS,IBGRP)) Q:IBGRP=""  D
"RTN","IBCNRRP3",137,0)
 .. ;get group info
"RTN","IBCNRRP3",138,0)
 .. S IBGRP0=$G(^IBA(355.3,IBGRP,0))
"RTN","IBCNRRP3",139,0)
 .. ;get pharmacy plan info
"RTN","IBCNRRP3",140,0)
 .. S IBGRP6=$G(^IBA(355.3,IBGRP,6))
"RTN","IBCNRRP3",141,0)
 .. I 'IBGRP6,$G(MAT) Q  ; Matched only
"RTN","IBCNRRP3",142,0)
 .. I IBGRP0 D
"RTN","IBCNRRP3",143,0)
 ... S (IBGRPNM,IBGRPNB)=""
"RTN","IBCNRRP3",144,0)
 ... S IBGRPNM=$P($G(IBGRP0),U,3) I $G(IBGRPNM)="" S IBGRPNM="<blank>"
"RTN","IBCNRRP3",145,0)
 ... S IBGRPNB=$P($G(IBGRP0),U,4) I $G(IBGRPNB)="" S IBGRPNB="<blank>"
"RTN","IBCNRRP3",146,0)
 ... S RPDT=IBGRPNB
"RTN","IBCNRRP3",147,0)
 .. I IBGRP6 D
"RTN","IBCNRRP3",148,0)
 ... S (IBPPIEN,IBPLNNM,IBPLPCN)=""
"RTN","IBCNRRP3",149,0)
 ... S IBPPIEN=$P($G(IBGRP6),U)
"RTN","IBCNRRP3",150,0)
 ... S IBPLNNM=$P($G(^IBCNR(366.03,IBPPIEN,0)),U,2)
"RTN","IBCNRRP3",151,0)
 ... S IBPLBIN=$P($G(^IBCNR(366.03,IBPPIEN,10)),U,2)
"RTN","IBCNRRP3",152,0)
 ... S IBPLPCN=$P($G(^IBCNR(366.03,IBPPIEN,10)),U,3)
"RTN","IBCNRRP3",153,0)
 ... S RPDT=$G(RPDT)_U_$G(IBPLNNM)_U_$G(IBPLBIN)_U_$G(IBPLPCN)
"RTN","IBCNRRP3",154,0)
 .. E  S RPDT=$G(RPDT)_U_U_U
"RTN","IBCNRRP3",155,0)
 .. S RPDT=$G(RPDT)_U_$P($G(IBGRP6),U,2,3)
"RTN","IBCNRRP3",156,0)
 .. S RPTOT=^XTMP(RTN,IBINS,IBGRP)
"RTN","IBCNRRP3",157,0)
 .. S RPTCNT=$P(RPTOT,U),RPTCHG=$P(RPTOT,U,2)
"RTN","IBCNRRP3",158,0)
 .. I SRT=1 D  Q
"RTN","IBCNRRP3",159,0)
 ... S ^TMP("IBCNR",$J,"RPTDATA",SRT,IBINSNM,IBINS,IBGRPNM,IBGRP)=$G(RPDT)
"RTN","IBCNRRP3",160,0)
 .. I SRT=2 D  Q
"RTN","IBCNRRP3",161,0)
 ... S ^TMP("IBCNR",$J,"RPTDATA",-$G(RPTCNT),IBINSNM,IBINS,IBGRPNM,IBGRP)=$G(RPDT)
"RTN","IBCNRRP3",162,0)
 .. I SRT=3 D  Q
"RTN","IBCNRRP3",163,0)
 ... S ^TMP("IBCNR",$J,"RPTDATA",-$G(RPTCHG),IBINSNM,IBINS,IBGRPNM,IBGRP)=$G(RPDT)
"RTN","IBCNRRP3",164,0)
 .. I SRT=4 D  Q
"RTN","IBCNRRP3",165,0)
 ... I '$G(IBGRP6) Q
"RTN","IBCNRRP3",166,0)
 ... N OK S OK=1
"RTN","IBCNRRP3",167,0)
 ... I $G(IBPLBIN)'="",$P(IBGRP6,U,2)'="",IBPLBIN'=$P(IBGRP6,U,2) S OK=0
"RTN","IBCNRRP3",168,0)
 ... I $G(IBPLPCN)'="",$P(IBGRP6,U,3)'="",IBPLPCN'=$P(IBGRP6,U,3) S OK=0
"RTN","IBCNRRP3",169,0)
 ... I 'OK S ^TMP("IBCNR",$J,"RPTDATA",SRT,IBINSNM,IBINS,IBGRPNM,IBGRP)=$G(RPDT)
"RTN","IBCNRRP3",170,0)
 Q
"RTN","IBCNRRP3",171,0)
 ;
"RTN","IBCNRRP3",172,0)
DISP ;set up display data
"RTN","IBCNRRP3",173,0)
 N CNT,DISP1,DISP2,DISP3,DISP4,DISP5,DISPD,DASHES2
"RTN","IBCNRRP3",174,0)
 N IBCNADR,IBCIN11,IBCINST,I
"RTN","IBCNRRP3",175,0)
 S DISP1="",CNT=0,$P(DASHES2,"-",80)=""
"RTN","IBCNRRP3",176,0)
 F  S DISP1=$O(^TMP("IBCNR",$J,"RPTDATA",DISP1)) Q:DISP1=""  D
"RTN","IBCNRRP3",177,0)
 . S DISP2=""
"RTN","IBCNRRP3",178,0)
 . F  S DISP2=$O(^TMP("IBCNR",$J,"RPTDATA",DISP1,DISP2)) Q:DISP2=""  D
"RTN","IBCNRRP3",179,0)
 .. S DISP3=0
"RTN","IBCNRRP3",180,0)
 .. F  S DISP3=$O(^TMP("IBCNR",$J,"RPTDATA",DISP1,DISP2,DISP3)) Q:DISP3=""  D
"RTN","IBCNRRP3",181,0)
 ... S DISP4=""
"RTN","IBCNRRP3",182,0)
 ... F  S DISP4=$O(^TMP("IBCNR",$J,"RPTDATA",DISP1,DISP2,DISP3,DISP4)) Q:DISP4=""  D
"RTN","IBCNRRP3",183,0)
 .... S DISP5=0
"RTN","IBCNRRP3",184,0)
 .... F  S DISP5=$O(^TMP("IBCNR",$J,"RPTDATA",DISP1,DISP2,DISP3,DISP4,DISP5)) Q:DISP5=""  D
"RTN","IBCNRRP3",185,0)
 ..... S DISPD=$G(^TMP("IBCNR",$J,"RPTDATA",DISP1,DISP2,DISP3,DISP4,DISP5))
"RTN","IBCNRRP3",186,0)
 ..... ;get insurance addr
"RTN","IBCNRRP3",187,0)
 ..... S IBCIN11=$G(^DIC(36,DISP3,.11))
"RTN","IBCNRRP3",188,0)
 ..... S IBCINST=$S($P(IBCIN11,U,5)="":"--",1:$P($G(^DIC(5,$P(IBCIN11,U,5),0)),U,2))
"RTN","IBCNRRP3",189,0)
 ..... S IBCNADR=$E($P(IBCIN11,U),1,15)_","_$E($P(IBCIN11,U,4),1,10)_","_IBCINST_" "_$E($P(IBCIN11,U,6),1,5)
"RTN","IBCNRRP3",190,0)
 ..... S CNT=CNT+1
"RTN","IBCNRRP3",191,0)
 ..... ;insurance co and group/plan
"RTN","IBCNRRP3",192,0)
 ..... S ^TMP("IBCNR",$J,"DSPDATA",CNT)=$$FO^IBCNEUT1(DISP2,40)_$$FO^IBCNEUT1(IBCNADR,35,"L")
"RTN","IBCNRRP3",193,0)
 ..... ;bin; pcn; and pharmacy plan
"RTN","IBCNRRP3",194,0)
 ..... S CNT=CNT+1
"RTN","IBCNRRP3",195,0)
 ..... S ^TMP("IBCNR",$J,"DSPDATA",CNT)=$$FO^IBCNEUT1(DISP4_"/"_$P(DISPD,U),35,"L")_$$FO^IBCNEUT1("  "_$P(DISPD,U,2),24,"L")_$$FO^IBCNEUT1(" "_$P(DISPD,U,3),10,"L")_$$FO^IBCNEUT1($P(DISPD,U,4),10,"L")
"RTN","IBCNRRP3",196,0)
 ..... S I=$$FO^IBCNEUT1("",60)_$$FO^IBCNEUT1($P(DISPD,U,5),10,"L")_$$FO^IBCNEUT1($P(DISPD,U,6),10,"L")
"RTN","IBCNRRP3",197,0)
 ..... I $TR(I," ")'="" S CNT=CNT+1,^TMP("IBCNR",$J,"DSPDATA",CNT)=I
"RTN","IBCNRRP3",198,0)
 ..... S CNT=CNT+1
"RTN","IBCNRRP3",199,0)
 ..... S ^TMP("IBCNR",$J,"DSPDATA",CNT)=$$FO^IBCNEUT1(DASHES2,79,"L")
"RTN","IBCNRRP3",200,0)
 ;
"RTN","IBCNRRP3",201,0)
DATAX ; DATA exit pt
"RTN","IBCNRRP3",202,0)
 K RPTDATA
"RTN","IBCNRRP3",203,0)
 Q
"RTN","IBCNRRP3",204,0)
 ;
"RTN","IBCNRU1")
0^30^B27266594
"RTN","IBCNRU1",1,0)
IBCNRU1 ;BHAM ISC/CMW - IB Utilities ;15-OCT-04
"RTN","IBCNRU1",2,0)
 ;;2.0;INTEGRATED BILLING;**251,276**;21-MAR-94
"RTN","IBCNRU1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRU1",4,0)
 ;
"RTN","IBCNRU1",5,0)
 Q
"RTN","IBCNRU1",6,0)
 ;
"RTN","IBCNRU1",7,0)
 ;return array definition
"RTN","IBCNRU1",8,0)
 ;(1) - "A"ctive or "I"nactive flag.
"RTN","IBCNRU1",9,0)
 ;(2) - BIN #.
"RTN","IBCNRU1",10,0)
 ;(3) - PCN #.
"RTN","IBCNRU1",11,0)
 ;(4) - Vender Cert ID.
"RTN","IBCNRU1",12,0)
 ;(5) - Payer Sheets. (B1,B2,B3) (comma separated string).
"RTN","IBCNRU1",13,0)
 ;(6) - Status codes (comma separated string).
"RTN","IBCNRU1",14,0)
 ;
"RTN","IBCNRU1",15,0)
STCHK(PIEN,IBARAY) ;Review status flags for all files related to this pharmacy plan
"RTN","IBCNRU1",16,0)
 ;
"RTN","IBCNRU1",17,0)
 NEW I,IBBIN,IBPCN,IB1,IB2,IB3,IBPBM,IBPRO,IBSTA,IBPAY,IBPST
"RTN","IBCNRU1",18,0)
 NEW IBAPP,IBCODE,IBCERT
"RTN","IBCNRU1",19,0)
 NEW PLN0,PLN10,AIEN,APDAT,APIEN
"RTN","IBCNRU1",20,0)
 NEW NA1,NA2,NA3,NA4,LA1,LA2,LA3,LA4,DA1,DA2,DA3,DA4,FLN
"RTN","IBCNRU1",21,0)
 ;
"RTN","IBCNRU1",22,0)
 K IBARAY
"RTN","IBCNRU1",23,0)
 ;
"RTN","IBCNRU1",24,0)
 I '$G(PIEN) D  G EXT
"RTN","IBCNRU1",25,0)
 . S IBSTA="" D IBC(299)
"RTN","IBCNRU1",26,0)
 I '$D(^IBCNR(366.03,PIEN)) D  G EXT
"RTN","IBCNRU1",27,0)
 . S IBSTA="" D IBC(299)
"RTN","IBCNRU1",28,0)
 ;
"RTN","IBCNRU1",29,0)
 S IBAPP="E-PHARM",IBSTA=1,IBCODE=""
"RTN","IBCNRU1",30,0)
 S PLN0=$G(^IBCNR(366.03,PIEN,0)) D
"RTN","IBCNRU1",31,0)
 . ;
"RTN","IBCNRU1",32,0)
PAY . ;get PAYER
"RTN","IBCNRU1",33,0)
 . S IBPAY=$P(PLN0,U,3) D
"RTN","IBCNRU1",34,0)
 .. I 'IBPAY Q
"RTN","IBCNRU1",35,0)
 .. ;check payer active
"RTN","IBCNRU1",36,0)
 .. S AIEN=$O(^IBE(365.13,"B",IBAPP,"")) I AIEN="" Q
"RTN","IBCNRU1",37,0)
 .. S APIEN=$O(^IBE(365.12,IBPAY,1,"B",AIEN,"")) I APIEN="" Q
"RTN","IBCNRU1",38,0)
 .. S APDAT=$G(^IBE(365.12,IBPAY,1,APIEN,0))
"RTN","IBCNRU1",39,0)
 .. S NA1=$P(APDAT,U,2) I NA1=0 S IBSTA="" D IBC(101)
"RTN","IBCNRU1",40,0)
 .. S LA1=$P(APDAT,U,3) I LA1=0 S IBSTA="" D IBC(102)
"RTN","IBCNRU1",41,0)
 .. S DA1=$P(APDAT,U,11) I DA1=1 S IBSTA="" D IBC(103)
"RTN","IBCNRU1",42,0)
 .. ;
"RTN","IBCNRU1",43,0)
PLN . ;check Plan active
"RTN","IBCNRU1",44,0)
 . S AIEN=$O(^IBCNR(366.13,"B",IBAPP,"")) I AIEN="" Q
"RTN","IBCNRU1",45,0)
 . S APIEN=$O(^IBCNR(366.03,PIEN,3,"B",AIEN,"")) I APIEN="" Q
"RTN","IBCNRU1",46,0)
 . S APDAT=$G(^IBCNR(366.03,PIEN,3,APIEN,0))
"RTN","IBCNRU1",47,0)
 . S NA2=$P(APDAT,U,2) I NA2=0 S IBSTA="" D IBC(201)
"RTN","IBCNRU1",48,0)
 . S LA2=$P(APDAT,U,3) I LA2=0 S IBSTA="" D IBC(202)
"RTN","IBCNRU1",49,0)
 . S DA2=$P(APDAT,U,11) I DA2=1 S IBSTA="" D IBC(203)
"RTN","IBCNRU1",50,0)
 . ;
"RTN","IBCNRU1",51,0)
PHM . ;check pharmacy data
"RTN","IBCNRU1",52,0)
 . I '$D(^IBCNR(366.03,PIEN,10)) D
"RTN","IBCNRU1",53,0)
 .. S IBSTA="" D IBC(599) Q
"RTN","IBCNRU1",54,0)
 .. ;
"RTN","IBCNRU1",55,0)
 . S PLN10=$G(^IBCNR(366.03,PIEN,10)) D
"RTN","IBCNRU1",56,0)
 .. ;
"RTN","IBCNRU1",57,0)
BIN .. ;get BIN
"RTN","IBCNRU1",58,0)
 .. S IBBIN=$P(PLN10,U,2)
"RTN","IBCNRU1",59,0)
 .. S IBARAY(2)=IBBIN
"RTN","IBCNRU1",60,0)
 .. ;
"RTN","IBCNRU1",61,0)
PCN .. ;get PCN
"RTN","IBCNRU1",62,0)
 .. S IBPCN=$P(PLN10,U,3)
"RTN","IBCNRU1",63,0)
 .. S IBARAY(3)=IBPCN
"RTN","IBCNRU1",64,0)
 .. ;
"RTN","IBCNRU1",65,0)
PBM .. ;get PBM
"RTN","IBCNRU1",66,0)
 .. S IBPBM=$P(PLN10,U,1) D
"RTN","IBCNRU1",67,0)
 ... I 'IBPBM Q
"RTN","IBCNRU1",68,0)
 ... ;check PBM active
"RTN","IBCNRU1",69,0)
 ... S AIEN=$O(^IBCNR(366.12,"B",IBAPP,"")) I AIEN="" Q
"RTN","IBCNRU1",70,0)
 ... S APIEN=$O(^IBCNR(366.02,IBPBM,3,"B",AIEN,"")) I APIEN="" Q
"RTN","IBCNRU1",71,0)
 ... S APDAT=$G(^IBCNR(366.02,IBPBM,3,APIEN,0))
"RTN","IBCNRU1",72,0)
 ... S NA3=$P(APDAT,U,2) I NA3=0 D IBC(301) S IBSTA=""
"RTN","IBCNRU1",73,0)
 ... S LA3=$P(APDAT,U,3) I LA3=0 D IBC(302) S IBSTA=""
"RTN","IBCNRU1",74,0)
 ... S DA3=$P(APDAT,U,11) I DA3=1 D IBC(303) S IBSTA=""
"RTN","IBCNRU1",75,0)
 ... ;
"RTN","IBCNRU1",76,0)
PRO .. ;get Processor
"RTN","IBCNRU1",77,0)
 .. S IBPRO=$P(PLN10,U,4) D
"RTN","IBCNRU1",78,0)
 ... I 'IBPRO Q
"RTN","IBCNRU1",79,0)
 ... ;check Processor active flags here
"RTN","IBCNRU1",80,0)
 ... S AIEN=$O(^IBCNR(366.11,"B",IBAPP,"")) I AIEN="" Q
"RTN","IBCNRU1",81,0)
 ... S APIEN=$O(^IBCNR(366.01,IBPRO,3,"B",AIEN,"")) I APIEN="" Q
"RTN","IBCNRU1",82,0)
 ... S APDAT=$G(^IBCNR(366.01,IBPRO,3,APIEN,0))
"RTN","IBCNRU1",83,0)
 ... S NA4=$P(APDAT,U,2) I NA4=0 D IBC(401) S IBSTA=""
"RTN","IBCNRU1",84,0)
 ... S LA4=$P(APDAT,U,3) I LA4=0 D IBC(402) S IBSTA=""
"RTN","IBCNRU1",85,0)
 ... S DA4=$P(APDAT,U,11) I DA4=1 D IBC(403) S IBSTA=""
"RTN","IBCNRU1",86,0)
 ... ;
"RTN","IBCNRU1",87,0)
VND .. ;get Vender Cert
"RTN","IBCNRU1",88,0)
 .. S IBCERT=$P(PLN10,U,6)
"RTN","IBCNRU1",89,0)
 .. S IBARAY(4)=IBCERT
"RTN","IBCNRU1",90,0)
 .. ;
"RTN","IBCNRU1",91,0)
PST .. ; Check payer sheets
"RTN","IBCNRU1",92,0)
 .. N BPS,PST,PSP
"RTN","IBCNRU1",93,0)
 .. N B1,B2,B3
"RTN","IBCNRU1",94,0)
 .. S PST=""
"RTN","IBCNRU1",95,0)
 .. ;check for test/production sheets
"RTN","IBCNRU1",96,0)
 .. S (B1,B2,B3)=""
"RTN","IBCNRU1",97,0)
 .. S B1=$P(PLN10,U,11),B2=$P(PLN10,U,12),B3=$P(PLN10,U,13)
"RTN","IBCNRU1",98,0)
 .. I $G(B1)="" S B1=$P(PLN10,U,7)
"RTN","IBCNRU1",99,0)
 .. I $G(B2)="" S B2=$P(PLN10,U,8)
"RTN","IBCNRU1",100,0)
 .. I $G(B3)="" S B3=$P(PLN10,U,9)
"RTN","IBCNRU1",101,0)
 .. S PST=B1_","_B2_","_B3
"RTN","IBCNRU1",102,0)
 .. ;
"RTN","IBCNRU1",103,0)
 .. I $G(B1)="",$G(B2)="" S IBSTA="" D IBC(699) G PSX
"RTN","IBCNRU1",104,0)
 .. I $G(B1) D PSD(B1) I PSP=0 S IBSTA="" D IBC(601)
"RTN","IBCNRU1",105,0)
 .. I $G(B2) D PSD(B2) I PSP=0 S IBSTA="" D IBC(602)
"RTN","IBCNRU1",106,0)
 .. I $G(B1)="" S IBSTA="" D IBC(603)
"RTN","IBCNRU1",107,0)
 .. I $G(B2)="" S IBSTA="" D IBC(604)
"RTN","IBCNRU1",108,0)
 .. ;
"RTN","IBCNRU1",109,0)
PSX .. S IBARAY(5)=PST
"RTN","IBCNRU1",110,0)
 . ;
"RTN","IBCNRU1",111,0)
 . ;check HIPAA NCPDP flag
"RTN","IBCNRU1",112,0)
 . I '$P($G(^IBE(350.9,1,11)),U) D
"RTN","IBCNRU1",113,0)
 .. S IBSTA="" D IBC(999)
"RTN","IBCNRU1",114,0)
 ;
"RTN","IBCNRU1",115,0)
EXT ;
"RTN","IBCNRU1",116,0)
 S IBARAY(1)=$S(IBSTA="":"I",1:"A")
"RTN","IBCNRU1",117,0)
 I IBCODE="" S IBCODE=200
"RTN","IBCNRU1",118,0)
 S IBARAY(6)=IBCODE
"RTN","IBCNRU1",119,0)
 Q
"RTN","IBCNRU1",120,0)
 ;
"RTN","IBCNRU1",121,0)
PSD(PS) ; check for disabled payersheet
"RTN","IBCNRU1",122,0)
 S PSP=1
"RTN","IBCNRU1",123,0)
 S BPS=$G(^BPSF(9002313.92,PS,1)) I $P(BPS,U,6)=0 S PSP=0
"RTN","IBCNRU1",124,0)
 Q
"RTN","IBCNRU1",125,0)
 ;
"RTN","IBCNRU1",126,0)
IBC(CD) ;set IBCODE
"RTN","IBCNRU1",127,0)
 I '$G(IBCODE) S IBCODE=CD Q
"RTN","IBCNRU1",128,0)
 S IBCODE=IBCODE_","_CD
"RTN","IBCNRU1",129,0)
 Q
"RTN","IBCNRU1",130,0)
 ;
"RTN","IBCNRU1",131,0)
STATAR(AR) ;
"RTN","IBCNRU1",132,0)
 ; setup status code definition array
"RTN","IBCNRU1",133,0)
 K AR
"RTN","IBCNRU1",134,0)
 ; payer
"RTN","IBCNRU1",135,0)
 S AR(101)="Payer not active, national."
"RTN","IBCNRU1",136,0)
 S AR(102)="Payer not active, local."
"RTN","IBCNRU1",137,0)
 S AR(103)="Payer Deactivated."
"RTN","IBCNRU1",138,0)
 ; plan
"RTN","IBCNRU1",139,0)
 S AR(200)="Plan Active"
"RTN","IBCNRU1",140,0)
 S AR(201)="Plan not active, national."
"RTN","IBCNRU1",141,0)
 S AR(202)="Plan not active, local."
"RTN","IBCNRU1",142,0)
 S AR(203)="Plan Deactivated."
"RTN","IBCNRU1",143,0)
 S AR(299)="Plan not found."
"RTN","IBCNRU1",144,0)
 ; pbm
"RTN","IBCNRU1",145,0)
 S AR(301)="PBM not active, national."
"RTN","IBCNRU1",146,0)
 S AR(302)="PBM not active, local."
"RTN","IBCNRU1",147,0)
 S AR(303)="PBM Deactivated."
"RTN","IBCNRU1",148,0)
 ; processor
"RTN","IBCNRU1",149,0)
 S AR(401)="Processor not active, national."
"RTN","IBCNRU1",150,0)
 S AR(402)="Processor not active, local."
"RTN","IBCNRU1",151,0)
 S AR(403)="Processor Deactivated."
"RTN","IBCNRU1",152,0)
 ; pharmacy plan
"RTN","IBCNRU1",153,0)
 S AR(599)="Pharmacy Plan not found."
"RTN","IBCNRU1",154,0)
 ; payer sheets
"RTN","IBCNRU1",155,0)
 S AR(601)="Billing PayerSheet Disabled."
"RTN","IBCNRU1",156,0)
 S AR(602)="Reversal PayerSheet Disabled."
"RTN","IBCNRU1",157,0)
 S AR(603)="Billing PayerSheet Not Found."
"RTN","IBCNRU1",158,0)
 S AR(604)="Reversal PayerSheet Not Found."
"RTN","IBCNRU1",159,0)
 S AR(699)="No Payer Sheets found."
"RTN","IBCNRU1",160,0)
 ;
"RTN","IBCNRU1",161,0)
 S AR(999)="HIPAA NCPDP Inactive."
"RTN","IBCNRU1",162,0)
 ;
"RTN","IBCNRU1",163,0)
 Q
"RTN","IBCNRXI1")
0^24^B4043997
"RTN","IBCNRXI1",1,0)
IBCNRXI1 ;BHAM ISC/DMK - Post-Installation procedure ;25-AUG-2004
"RTN","IBCNRXI1",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBCNRXI1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRXI1",4,0)
 ;
"RTN","IBCNRXI1",5,0)
 ; Description:
"RTN","IBCNRXI1",6,0)
 ; This is a part of the IB*2.0*276 post-installation procedure.
"RTN","IBCNRXI1",7,0)
 ; Its purpose is to review all PLAN file entries.
"RTN","IBCNRXI1",8,0)
 ; If PLAN APPLICATION sub-file, LOCAL ACTIVE? = 1 (active)
"RTN","IBCNRXI1",9,0)
 ; and USER EDITED LOCAL = "dummy" HL7 interface user, then
"RTN","IBCNRXI1",10,0)
 ; reinitialize LOCAL ACTIVE = 0.
"RTN","IBCNRXI1",11,0)
 ; Initial requirements called for initialization to 1, but this
"RTN","IBCNRXI1",12,0)
 ; has changed.
"RTN","IBCNRXI1",13,0)
 ;
"RTN","IBCNRXI1",14,0)
 ; Applicable files, sub-files, and fields:
"RTN","IBCNRXI1",15,0)
 ; 366.033 = PLAN APPLICATION sub-file
"RTN","IBCNRXI1",16,0)
 ;    .03  = LOCAL ACTIVE?
"RTN","IBCNRXI1",17,0)
 ;    .04  = USER EDITED LOCAL
"RTN","IBCNRXI1",18,0)
 ;    .05  = DATE/TIME LOCAL EDITED
"RTN","IBCNRXI1",19,0)
 ;
"RTN","IBCNRXI1",20,0)
1000 ; Control
"RTN","IBCNRXI1",21,0)
 ;
"RTN","IBCNRXI1",22,0)
 ; Call IBCNRXI2 to fix the USER EDITED LOCAL user
"RTN","IBCNRXI1",23,0)
 D EN^IBCNRXI2
"RTN","IBCNRXI1",24,0)
 ;
"RTN","IBCNRXI1",25,0)
 ; Compile List of plans that are being used
"RTN","IBCNRXI1",26,0)
 K ^TMP("IBCNRXI1",$J)
"RTN","IBCNRXI1",27,0)
 D COMPILE
"RTN","IBCNRXI1",28,0)
 ;
"RTN","IBCNRXI1",29,0)
 ; Initialization
"RTN","IBCNRXI1",30,0)
 N DATE,HL7DUZ,IEN,S
"RTN","IBCNRXI1",31,0)
 ; 
"RTN","IBCNRXI1",32,0)
 D INIT
"RTN","IBCNRXI1",33,0)
 I HL7DUZ="" Q
"RTN","IBCNRXI1",34,0)
 ;
"RTN","IBCNRXI1",35,0)
 D GET1
"RTN","IBCNRXI1",36,0)
 K ^TMP("IBCNRXI1",$J)
"RTN","IBCNRXI1",37,0)
 Q
"RTN","IBCNRXI1",38,0)
 ;
"RTN","IBCNRXI1",39,0)
GET1 ; Get PLAN file (#366.03) IEN
"RTN","IBCNRXI1",40,0)
 S IEN(366.03)=0 F  S IEN(366.03)=$O(^IBCNR(366.03,IEN(366.03))) Q:'IEN(366.03)  D GET2
"RTN","IBCNRXI1",41,0)
 Q
"RTN","IBCNRXI1",42,0)
 ;
"RTN","IBCNRXI1",43,0)
GET2 ; Get PLAN APPLICATION sub-file (# 366.033) IEN
"RTN","IBCNRXI1",44,0)
 S IEN(366.033)=0 F  S IEN(366.033)=$O(^IBCNR(366.03,IEN(366.03),3,IEN(366.033))) Q:'IEN(366.033)  D GET3
"RTN","IBCNRXI1",45,0)
 Q
"RTN","IBCNRXI1",46,0)
 ;
"RTN","IBCNRXI1",47,0)
GET3 ; Check PLAN APPLICATION sub-file fields
"RTN","IBCNRXI1",48,0)
 S S=$G(^IBCNR(366.03,IEN(366.03),3,IEN(366.033),0))
"RTN","IBCNRXI1",49,0)
 I $P(S,U,3)=1,$P(S,U,4)=HL7DUZ,'$D(^TMP("IBCNRXI1",$J,IEN(366.03))) D FIX
"RTN","IBCNRXI1",50,0)
 Q
"RTN","IBCNRXI1",51,0)
 ;
"RTN","IBCNRXI1",52,0)
INIT ; Initialize local variables
"RTN","IBCNRXI1",53,0)
 I '$D(U) S U="^"
"RTN","IBCNRXI1",54,0)
 S HL7DUZ=$$FIND1^DIC(200,"","X","INTERFACE,IB IIV") Q:'HL7DUZ
"RTN","IBCNRXI1",55,0)
 S DATE("NOW")=$$NOW^XLFDT()
"RTN","IBCNRXI1",56,0)
 Q
"RTN","IBCNRXI1",57,0)
 ;
"RTN","IBCNRXI1",58,0)
FIX ; Reinitialize (fix) PLAN APPLICATION sub-file fields
"RTN","IBCNRXI1",59,0)
 S $P(S,U,3)=0
"RTN","IBCNRXI1",60,0)
 S $P(S,U,5)=DATE("NOW")
"RTN","IBCNRXI1",61,0)
 S ^IBCNR(366.03,IEN(366.03),3,IEN(366.033),0)=S
"RTN","IBCNRXI1",62,0)
 Q
"RTN","IBCNRXI1",63,0)
 ;
"RTN","IBCNRXI1",64,0)
COMPILE ; Build list of plans that are in use
"RTN","IBCNRXI1",65,0)
 N IEN02,GRP,PL
"RTN","IBCNRXI1",66,0)
 S IEN02=0  F  S IEN02=$O(^BPSC(IEN02)) Q:+IEN02=0  D
"RTN","IBCNRXI1",67,0)
 . S GRP=$P($G(^BPSC(IEN02,1)),"^",4)
"RTN","IBCNRXI1",68,0)
 . I GRP="" Q
"RTN","IBCNRXI1",69,0)
 . S PL=$P($G(^IBA(355.3,GRP,6)),"^",1)
"RTN","IBCNRXI1",70,0)
 . I PL="" Q
"RTN","IBCNRXI1",71,0)
 . S ^TMP("IBCNRXI1",$J,PL)=""
"RTN","IBCNRXI1",72,0)
 Q
"RTN","IBCNRXI2")
0^57^B2709059
"RTN","IBCNRXI2",1,0)
IBCNRXI2 ;BHAM ISC/DMB - Post-Installation procedure ;30-SEP-2005
"RTN","IBCNRXI2",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBCNRXI2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNRXI2",4,0)
 ;
"RTN","IBCNRXI2",5,0)
 ; Description:
"RTN","IBCNRXI2",6,0)
 ; This is a part of the IB*2.0*276 post-installation procedure.
"RTN","IBCNRXI2",7,0)
 ; Its purpose is to review all PLAN file entries.
"RTN","IBCNRXI2",8,0)
 ; If PLAN APPLICATION sub-file, LOCAL ACTIVE? = 1 (active)
"RTN","IBCNRXI2",9,0)
 ;    ,USER EDITED LOCAL = 61230, and DATE/TIME LOCAL EDITTED is before
"RTN","IBCNRXI2",10,0)
 ;    5/28/2004, then change the USER EDITED LOCAL to 'INTERFACE,IB IIV'.
"RTN","IBCNRXI2",11,0)
 ;
"RTN","IBCNRXI2",12,0)
 ; The reason for this is that the Plans were sent out as part of the
"RTN","IBCNRXI2",13,0)
 ;    dormant build with the USER EDITED LOCAL = 62130, which was the  
"RTN","IBCNRXI2",14,0)
 ;    IEN for 'INTERFACE,IB IIV' from the source environment, but this 
"RTN","IBCNRXI2",15,0)
 ;    IEN was updated by the build to be the IEN for this user at the
"RTN","IBCNRXI2",16,0)
 ;    destination sites.
"RTN","IBCNRXI2",17,0)
 ;
"RTN","IBCNRXI2",18,0)
 ; Applicable files, sub-files, and fields:
"RTN","IBCNRXI2",19,0)
 ; 366.033 = PLAN APPLICATION sub-file
"RTN","IBCNRXI2",20,0)
 ;    .03  = LOCAL ACTIVE? (piece 3)
"RTN","IBCNRXI2",21,0)
 ;    .04  = USER EDITED LOCAL (piece 4)
"RTN","IBCNRXI2",22,0)
 ;    .05  = DATE/TIME LOCAL EDITED (piece 5)
"RTN","IBCNRXI2",23,0)
 ;
"RTN","IBCNRXI2",24,0)
 Q
"RTN","IBCNRXI2",25,0)
EN ;
"RTN","IBCNRXI2",26,0)
 ; Initialize local variables
"RTN","IBCNRXI2",27,0)
 N HL7DUZ,IEN1,IEN2,X
"RTN","IBCNRXI2",28,0)
 I '$D(U) S U="^"
"RTN","IBCNRXI2",29,0)
 S HL7DUZ=$$FIND1^DIC(200,"","X","INTERFACE,IB IIV")
"RTN","IBCNRXI2",30,0)
 I HL7DUZ="" Q
"RTN","IBCNRXI2",31,0)
 ;
"RTN","IBCNRXI2",32,0)
 ; Get PLAN file (#366.03) IEN
"RTN","IBCNRXI2",33,0)
 S IEN1=0 F  S IEN1=$O(^IBCNR(366.03,IEN1)) Q:+IEN1=0  D
"RTN","IBCNRXI2",34,0)
 . ;
"RTN","IBCNRXI2",35,0)
 . ; Get PLAN APPLICATION sub-file (# 366.033) IEN
"RTN","IBCNRXI2",36,0)
 . S IEN2=0 F  S IEN2=$O(^IBCNR(366.03,IEN1,3,IEN2)) Q:+IEN2=0  D
"RTN","IBCNRXI2",37,0)
 .. ;
"RTN","IBCNRXI2",38,0)
 .. ; Check PLAN APPLICATION sub-file fields
"RTN","IBCNRXI2",39,0)
 .. ; Local Active flag needs to be Active (1)
"RTN","IBCNRXI2",40,0)
 .. ; User needs to be set to 61230
"RTN","IBCNRXI2",41,0)
 .. ; Date needs to be before 6/28/2004 (dormant release date)
"RTN","IBCNRXI2",42,0)
 .. S X=$G(^IBCNR(366.03,IEN1,3,IEN2,0))
"RTN","IBCNRXI2",43,0)
 .. I $P(X,U,3)'=1 Q
"RTN","IBCNRXI2",44,0)
 .. I $P(X,U,4)'=62130 Q
"RTN","IBCNRXI2",45,0)
 .. I $P(X,U,5)>3040628 Q
"RTN","IBCNRXI2",46,0)
 .. S $P(^IBCNR(366.03,IEN1,3,IEN2,0),"^",4)=HL7DUZ
"RTN","IBCNRXI2",47,0)
 Q
"RTN","IBCNSBL1")
0^3^B33740946
"RTN","IBCNSBL1",1,0)
IBCNSBL1 ;ALB/AAS - NEW INSURANCE POLICY BULLETIN ;29-AUG-93
"RTN","IBCNSBL1",2,0)
 ;;2.0;INTEGRATED BILLING;**6,28,82,249,276**;21-MAR-94
"RTN","IBCNSBL1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSBL1",4,0)
 ;
"RTN","IBCNSBL1",5,0)
BULL ; -- send bulletin
"RTN","IBCNSBL1",6,0)
 N IBCNT
"RTN","IBCNSBL1",7,0)
 S XMSUB="New Insurance Policy For "_$E($P(IBP,"^"),1,20)_"   Pt. Id: "_$P(IBP,"^",2)
"RTN","IBCNSBL1",8,0)
 S IBT(1)=" A new insurance policy has been added for:"
"RTN","IBCNSBL1",9,0)
 S IBT(2)=" Patient: "_$E($P(IBP,"^")_"               ",1,25)_"  PT. ID: "_$P(IBP,"^",2)
"RTN","IBCNSBL1",10,0)
 S IBT(3)=""
"RTN","IBCNSBL1",11,0)
 S IBT(4)=" New Policy: "
"RTN","IBCNSBL1",12,0)
 S IBCNT=4 D HDR,NPOL
"RTN","IBCNSBL1",13,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)=""
"RTN","IBCNSBL1",14,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)=" Previous Policy(s): "
"RTN","IBCNSBL1",15,0)
 D HDR,OPOL
"RTN","IBCNSBL1",16,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)=""
"RTN","IBCNSBL1",17,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)=" Buffer Policy(s): "
"RTN","IBCNSBL1",18,0)
 D BUFF
"RTN","IBCNSBL1",19,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)=""
"RTN","IBCNSBL1",20,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)=" Possible billable Inpt. Care: "
"RTN","IBCNSBL1",21,0)
 D INPT
"RTN","IBCNSBL1",22,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)=""
"RTN","IBCNSBL1",23,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)=" Possible billable Opt. Care: "
"RTN","IBCNSBL1",24,0)
 D OPT
"RTN","IBCNSBL1",25,0)
 I $$ECMEBIL^IBNCPDPU(DFN,DT) D
"RTN","IBCNSBL1",26,0)
 . S IBCNT=IBCNT+1,IBT(IBCNT)=""
"RTN","IBCNSBL1",27,0)
 . S IBCNT=IBCNT+1,IBT(IBCNT)=" *** NOTE: Prescriptions for this patient are ECME BILLABLE and may be"
"RTN","IBCNSBL1",28,0)
 . S IBCNT=IBCNT+1,IBT(IBCNT)=" processed using the GENERATE ECME RX BILLS option contained in the"
"RTN","IBCNSBL1",29,0)
 . S IBCNT=IBCNT+1,IBT(IBCNT)=" Billing Clerk's Menu"
"RTN","IBCNSBL1",30,0)
 ;
"RTN","IBCNSBL1",31,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)=""
"RTN","IBCNSBL1",32,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)=" Added by: "_$P($G(^VA(200,+$P(IBEVTA1,"^",2),0)),"^")
"RTN","IBCNSBL1",33,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)="       on: "_$$DAT1^IBOUTL(+IBEVTA1,"2P")
"RTN","IBCNSBL1",34,0)
 S IBCNT=IBCNT+1,IBT(IBCNT)="   Option: "
"RTN","IBCNSBL1",35,0)
 ;
"RTN","IBCNSBL1",36,0)
 I $D(XQY0) S IBT(IBCNT)=IBT(IBCNT)_$P($G(XQY0),"^",2)
"RTN","IBCNSBL1",37,0)
 I $D(ZTQUEUED),$P($G(XQY0),"^",2)="" S IBT(IBCNT)=IBT(IBCNT)_"Queued Job - "_$G(ZTDESC)
"RTN","IBCNSBL1",38,0)
 D SEND
"RTN","IBCNSBL1",39,0)
BULLQ Q
"RTN","IBCNSBL1",40,0)
 ;
"RTN","IBCNSBL1",41,0)
NPOL ; -- set up new policy
"RTN","IBCNSBL1",42,0)
 S IBCNT=IBCNT+1
"RTN","IBCNSBL1",43,0)
 S IBT(IBCNT)=$$D1(IBEVTA0)
"RTN","IBCNSBL1",44,0)
 Q
"RTN","IBCNSBL1",45,0)
 ;
"RTN","IBCNSBL1",46,0)
OPOL ; -- set up old policies
"RTN","IBCNSBL1",47,0)
 N J,X,IBPCNT
"RTN","IBCNSBL1",48,0)
 S J=0 F  S J=$O(^DPT(DFN,.312,J)) Q:'J  I J'=IBCDFN S X=$G(^DPT(DFN,.312,J,0)) S IBCNT=IBCNT+1,IBT(IBCNT)=$$D1(X) S IBPCNT=$G(IBPCNT)+1
"RTN","IBCNSBL1",49,0)
 I $G(IBPCNT)<1 S IBCNT=IBCNT+1,IBT(IBCNT)="    No Previous Policies On file!"
"RTN","IBCNSBL1",50,0)
 Q
"RTN","IBCNSBL1",51,0)
 ;
"RTN","IBCNSBL1",52,0)
SEND S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBT("
"RTN","IBCNSBL1",53,0)
 K XMY S XMN=0
"RTN","IBCNSBL1",54,0)
 S IBGRP=$P($G(^XMB(3.8,+$P($G(^IBE(350.9,1,4)),"^",4),0)),"^")
"RTN","IBCNSBL1",55,0)
 I IBGRP]"" S XMY("G."_IBGRP_"@"_^XMB("NETNAME"))=""
"RTN","IBCNSBL1",56,0)
 D ^XMD
"RTN","IBCNSBL1",57,0)
 K X,Y,IBI,IBT,IBGRP,XMDUZ,XMTEXT,XMY,XMSUB
"RTN","IBCNSBL1",58,0)
 Q
"RTN","IBCNSBL1",59,0)
 ;
"RTN","IBCNSBL1",60,0)
HDR ; -- print standard header
"RTN","IBCNSBL1",61,0)
 D HDR1("=",76)
"RTN","IBCNSBL1",62,0)
 Q
"RTN","IBCNSBL1",63,0)
 ;
"RTN","IBCNSBL1",64,0)
HDR1(CHAR,LENG) ; -- print header, specify character
"RTN","IBCNSBL1",65,0)
 S IBCNT=IBCNT+1
"RTN","IBCNSBL1",66,0)
 S IBT(IBCNT)="    Insurance Co.     Subscriber ID     Group       Holder  Effective Expires"
"RTN","IBCNSBL1",67,0)
 S IBCNT=IBCNT+1,X="",$P(X,CHAR,LENG)=""
"RTN","IBCNSBL1",68,0)
 S IBT(IBCNT)=X
"RTN","IBCNSBL1",69,0)
 Q
"RTN","IBCNSBL1",70,0)
 ;
"RTN","IBCNSBL1",71,0)
 ;
"RTN","IBCNSBL1",72,0)
D1(IBINS) N X,IBX
"RTN","IBCNSBL1",73,0)
 S IBX="" I '$G(IBINS) G DQ
"RTN","IBCNSBL1",74,0)
 S IBX="    "_$E($S($D(^DIC(36,+IBINS,0)):$E($P(^(0),"^",1),1,16),1:"UNKNOWN")_"                 ",1,16)_"  "
"RTN","IBCNSBL1",75,0)
 S IBX=IBX_$E($P(IBINS,"^",2)_"                ",1,16)_"  "
"RTN","IBCNSBL1",76,0)
 S IBX=IBX_$E($$GRP^IBCNS($P(IBINS,"^",18))_"          ",1,10)_"  "
"RTN","IBCNSBL1",77,0)
 S X=$P(IBINS,"^",6) S IBX=IBX_$E($S(X="v":"SELF",X="s":"SPOUSE",1:"OTHER")_"      ",1,8)
"RTN","IBCNSBL1",78,0)
 S IBX=IBX_$E($$DAT1^IBOUTL($P(IBINS,"^",8))_"          ",1,10)_$$DAT1^IBOUTL($P(IBINS,"^",4))
"RTN","IBCNSBL1",79,0)
DQ Q IBX
"RTN","IBCNSBL1",80,0)
 ;
"RTN","IBCNSBL1",81,0)
OPT ; -- list opt treatment (sched appoints only)
"RTN","IBCNSBL1",82,0)
 N CNT S CNT=0
"RTN","IBCNSBL1",83,0)
 ;
"RTN","IBCNSBL1",84,0)
 I $D(^TMP($J,"SDAMA201","GETAPPT","ERROR")) S IBCNT=IBCNT+1,IBT(IBCNT)="    Unable to look-up Scheduled Appointments." D  Q
"RTN","IBCNSBL1",85,0)
 . F  S CNT=$O(^TMP($J,"SDAMA201","GETAPPT","ERROR",CNT)) Q:'CNT  S IBCNT=IBCNT+1,IBT(IBCNT)="    "_$G(^TMP($J,"SDAMA201","GETAPPT","ERROR",CNT))
"RTN","IBCNSBL1",86,0)
 ;
"RTN","IBCNSBL1",87,0)
 S OPT=0 F  S OPT=$O(^TMP($J,"SDAMA201","GETAPPT",OPT)) Q:'OPT  D
"RTN","IBCNSBL1",88,0)
 .S IBCNT=IBCNT+1
"RTN","IBCNSBL1",89,0)
 .I IBCNT>100 S IBT(IBCNT)="Too many to list" S OPT=9999999 Q
"RTN","IBCNSBL1",90,0)
 .S IBT(IBCNT)="   Outpatient Visit on "_$$DAT1^IBOUTL($G(^TMP($J,"SDAMA201","GETAPPT",OPT,1)))_" to "_$P($G(^TMP($J,"SDAMA201","GETAPPT",OPT,2)),"^",2)
"RTN","IBCNSBL1",91,0)
 .S CNT=CNT+1
"RTN","IBCNSBL1",92,0)
 I 'CNT S IBCNT=IBCNT+1,IBT(IBCNT)="    No Scheduled appointments found."
"RTN","IBCNSBL1",93,0)
 Q
"RTN","IBCNSBL1",94,0)
 ;
"RTN","IBCNSBL1",95,0)
INPT ; -- list inpt. treatment (admissions only)
"RTN","IBCNSBL1",96,0)
 N CNT S CNT=0
"RTN","IBCNSBL1",97,0)
 I $G(^DPT(DFN,.1))]"" S CNT=CNT+1,IBCNT=IBCNT+1,IBT(IBCNT)="    Currently an Inpatient on "_$G(^DPT(DFN,.1))
"RTN","IBCNSBL1",98,0)
 I $G(IBTADD) S IBCNT=IBCNT+1,IBT(IBCNT)="    Entry Added to Claims Tracking for Current Admission."
"RTN","IBCNSBL1",99,0)
 I $G(VAIN(1)) S CNT=CNT+1,IBCNT=IBCNT+1,IBT(IBCNT)="    Previously an inpatient on ward "_$P(VAIN(4),"^",2)_" on "_$$DAT1^IBOUTL($P(START,"."))
"RTN","IBCNSBL1",100,0)
 S INPT=START F  S INPT=$O(^DGPM("APTT1",DFN,INPT)) Q:'INPT!(INPT>END)  S DGPM=0 F  S DGPM=$O(^DGPM("APTT1",DFN,INPT,DGPM)) Q:'DGPM  D
"RTN","IBCNSBL1",101,0)
 .Q:'$G(^DGPM(DGPM,0))
"RTN","IBCNSBL1",102,0)
 .S IBCNT=IBCNT+1
"RTN","IBCNSBL1",103,0)
 .S IBT(IBCNT)="    Inpatient Admission on "_$$DAT1^IBOUTL(+^DGPM(DGPM,0),"2P")
"RTN","IBCNSBL1",104,0)
 .S CNT=CNT+1
"RTN","IBCNSBL1",105,0)
 I 'CNT S IBCNT=IBCNT+1,IBT(IBCNT)="    No Admissions found."
"RTN","IBCNSBL1",106,0)
 Q
"RTN","IBCNSBL1",107,0)
 ;
"RTN","IBCNSBL1",108,0)
BUFF ; -- list insurance buffer entries for the patient
"RTN","IBCNSBL1",109,0)
 N IBBDA,IBX,IBY,IBB40,IBB60
"RTN","IBCNSBL1",110,0)
 I '$$BUFFER^IBCNBU1(DFN) S IBCNT=IBCNT+1,IBT(IBCNT)="    No Insurance Buffer entries for this Patient." Q
"RTN","IBCNSBL1",111,0)
 ;
"RTN","IBCNSBL1",112,0)
 S IBBDA=0 F  S IBBDA=$O(^IBA(355.33,"C",DFN,IBBDA)) Q:'IBBDA  D
"RTN","IBCNSBL1",113,0)
 . S IBB40=$G(^IBA(355.33,IBBDA,40)),IBB60=$G(^IBA(355.33,IBBDA,60))
"RTN","IBCNSBL1",114,0)
 . ;
"RTN","IBCNSBL1",115,0)
 . S IBY=$P($G(^IBA(355.33,+IBBDA,20)),U,1),IBX="    "_$E($S(IBY'="":IBY,1:"UNKNOWN")_"                 ",1,16)_"  "
"RTN","IBCNSBL1",116,0)
 . S IBX=IBX_$E($P(IBB60,"^",4)_"                ",1,16)_"  "
"RTN","IBCNSBL1",117,0)
 . S IBX=IBX_$E($S($P(IBB40,U,3)'="":$P(IBB40,U,3),$P(IBB40,U,2)'="":$P(IBB40,U,2),$P(IBB40,U,1)=0:"Ind. Plan",1:"")_"          ",1,10)_"  "
"RTN","IBCNSBL1",118,0)
 . S IBY=$P(IBB60,"^",5) S IBX=IBX_$E($S(IBY="v":"SELF",IBY="s":"SPOUSE",1:"OTHER")_"      ",1,8)
"RTN","IBCNSBL1",119,0)
 . S IBX=IBX_$E($$DAT1^IBOUTL($P(IBB60,"^",2))_"          ",1,10)_$$DAT1^IBOUTL($P(IBB60,"^",3))
"RTN","IBCNSBL1",120,0)
 . S IBCNT=IBCNT+1,IBT(IBCNT)=IBX
"RTN","IBCNSBL1",121,0)
 Q
"RTN","IBCNSC")
0^64^B16200717
"RTN","IBCNSC",1,0)
IBCNSC ;ALB/NLR - INSURANCE COMPANY EDIT ;12-MAR-1993
"RTN","IBCNSC",2,0)
 ;;2.0;INTEGRATED BILLING;**46,137,184,276**;21-MAR-94
"RTN","IBCNSC",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSC",4,0)
 ;
"RTN","IBCNSC",5,0)
 ;also used for IA #4694
"RTN","IBCNSC",6,0)
 ;
"RTN","IBCNSC",7,0)
EN ; -- main entry point for IBCNS INSURANCE COMPANY, IBCNS VIEW INS CO
"RTN","IBCNSC",8,0)
 NEW IB1ST
"RTN","IBCNSC",9,0)
 K VALMQUIT,VALMEVL,XQORS,^TMP("XQORS",$J),IBCNS
"RTN","IBCNSC",10,0)
 S IBCHANGE="OKAY"
"RTN","IBCNSC",11,0)
 I '$G(IBVIEW) D EN^VALM("IBCNS INSURANCE COMPANY") G ENQ
"RTN","IBCNSC",12,0)
 D EN^VALM("IBCNS VIEW INS CO")
"RTN","IBCNSC",13,0)
ENQ Q
"RTN","IBCNSC",14,0)
 ;
"RTN","IBCNSC",15,0)
HDR ; -- header code
"RTN","IBCNSC",16,0)
 S VALMHDR(1)="Insurance Company Information for: "_$E($P(^DIC(36,IBCNS,0),"^"),1,30)
"RTN","IBCNSC",17,0)
 S VALMHDR(2)="Type of Company: "_$E($P($G(^IBE(355.2,+$P($G(^DIC(36,+IBCNS,0)),"^",13),0)),"^"),1,20)_"                     Currently "_$S(+($P($G(^DIC(36,+IBCNS,0)),"^",5)):"Inactive",1:"Active")
"RTN","IBCNSC",18,0)
 Q
"RTN","IBCNSC",19,0)
 ;
"RTN","IBCNSC",20,0)
INIT ; -- init variables and list array
"RTN","IBCNSC",21,0)
 K VALMQUIT
"RTN","IBCNSC",22,0)
 S VALMCNT=0,VALMBG=1
"RTN","IBCNSC",23,0)
 I '$D(IBCNS) D INSCO Q:$D(VALMQUIT)
"RTN","IBCNSC",24,0)
 D BLD,HDR
"RTN","IBCNSC",25,0)
 Q
"RTN","IBCNSC",26,0)
BLD ; -- list builder
"RTN","IBCNSC",27,0)
 NEW BLNKI
"RTN","IBCNSC",28,0)
 K ^TMP("IBCNSC",$J)
"RTN","IBCNSC",29,0)
 D KILL^VALM10()
"RTN","IBCNSC",30,0)
 F BLNKI=1:1:69 D BLANK(.BLNKI)
"RTN","IBCNSC",31,0)
 ; ESG - 7/29/02 - IIV project - Added payer section
"RTN","IBCNSC",32,0)
 D PARAM^IBCNSC01,MAIN^IBCNSC01,CLAIMS1^IBCNSC0,CLAIMS2^IBCNSC0,PRESCR^IBCNSC1,APPEALS,INQUIRY,PROVID^IBCNSC1,PAYER^IBCNSC01,REMARKS^IBCNSC01,SYN^IBCNSC01
"RTN","IBCNSC",33,0)
 S VALMCNT=+$O(^TMP("IBCNSC",$J,""),-1)
"RTN","IBCNSC",34,0)
 Q
"RTN","IBCNSC",35,0)
 ;
"RTN","IBCNSC",36,0)
APPEALS ;
"RTN","IBCNSC",37,0)
 N OFFSET,START,IBCNS14,IBADD
"RTN","IBCNSC",38,0)
 S IBCNS14=$$ADDRESS^IBCNSC0(IBCNS,.14,7)
"RTN","IBCNSC",39,0)
 S START=40,OFFSET=2
"RTN","IBCNSC",40,0)
 D SET^IBCNSP(START,OFFSET+25," Appeals Office Information ",IORVON,IORVOFF)
"RTN","IBCNSC",41,0)
 D SET^IBCNSP(START+1,OFFSET," Company Name: "_$P($G(^DIC(36,+$P(IBCNS14,"^",7),0)),"^",1))
"RTN","IBCNSC",42,0)
 D SET^IBCNSP(START+2,OFFSET,"       Street: "_$P(IBCNS14,"^",1))
"RTN","IBCNSC",43,0)
 D SET^IBCNSP(START+3,OFFSET,"     Street 2: "_$P(IBCNS14,"^",2))
"RTN","IBCNSC",44,0)
 N OFFSET S OFFSET=45
"RTN","IBCNSC",45,0)
 D SET^IBCNSP(START+1,OFFSET,"     Street 3: "_$P(IBCNS14,"^",3)) S IBADD=1
"RTN","IBCNSC",46,0)
 D SET^IBCNSP(START+1+IBADD,OFFSET,"   City/State: "_$E($P(IBCNS14,"^",4),1,15)_$S($P(IBCNS14,"^",4)="":"",1:", ")_$P($G(^DIC(5,+$P(IBCNS14,"^",5),0)),"^",2)_" "_$E($P(IBCNS14,"^",6),1,5))
"RTN","IBCNSC",47,0)
 D SET^IBCNSP(START+2+IBADD,OFFSET,"        Phone: "_$P(IBCNS14,"^",8))
"RTN","IBCNSC",48,0)
 D SET^IBCNSP(START+3+IBADD,OFFSET,"          Fax: "_$P(IBCNS14,"^",9))
"RTN","IBCNSC",49,0)
 Q
"RTN","IBCNSC",50,0)
 ;
"RTN","IBCNSC",51,0)
INQUIRY ;
"RTN","IBCNSC",52,0)
 ;
"RTN","IBCNSC",53,0)
 N OFFSET,START,IBCNS15,IBADD
"RTN","IBCNSC",54,0)
 S IBCNS15=$$ADDRESS^IBCNSC0(IBCNS,.15,8)
"RTN","IBCNSC",55,0)
 S START=47,OFFSET=2
"RTN","IBCNSC",56,0)
 D SET^IBCNSP(START,OFFSET+25," Inquiry Office Information ",IORVON,IORVOFF)
"RTN","IBCNSC",57,0)
 D SET^IBCNSP(START+1,OFFSET," Company Name: "_$P($G(^DIC(36,+$P(IBCNS15,"^",7),0)),"^",1))
"RTN","IBCNSC",58,0)
 D SET^IBCNSP(START+2,OFFSET,"       Street: "_$P(IBCNS15,"^"))
"RTN","IBCNSC",59,0)
 D SET^IBCNSP(START+3,OFFSET,"     Street 2: "_$P(IBCNS15,"^",2))
"RTN","IBCNSC",60,0)
 N OFFSET S OFFSET=45
"RTN","IBCNSC",61,0)
 D SET^IBCNSP(START+1,OFFSET,"     Street 3: "_$P(IBCNS15,"^",3)) S IBADD=1
"RTN","IBCNSC",62,0)
 D SET^IBCNSP(START+1+IBADD,OFFSET,"   City/State: "_$E($P(IBCNS15,"^",4),1,15)_$S($P(IBCNS15,"^",4)="":"",1:", ")_$P($G(^DIC(5,+$P(IBCNS15,"^",5),0)),"^",2)_" "_$E($P(IBCNS15,"^",6),1,5))
"RTN","IBCNSC",63,0)
 D SET^IBCNSP(START+2+IBADD,OFFSET,"        Phone: "_$P(IBCNS15,"^",8))
"RTN","IBCNSC",64,0)
 D SET^IBCNSP(START+3+IBADD,OFFSET,"          Fax: "_$P(IBCNS15,"^",9))
"RTN","IBCNSC",65,0)
 Q
"RTN","IBCNSC",66,0)
 ;
"RTN","IBCNSC",67,0)
HELP ; -- help code
"RTN","IBCNSC",68,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBCNSC",69,0)
 Q
"RTN","IBCNSC",70,0)
 ;
"RTN","IBCNSC",71,0)
EXIT ; -- exit code
"RTN","IBCNSC",72,0)
 K VALMQUIT,IBCNS,IBCHANGE
"RTN","IBCNSC",73,0)
 D CLEAN^VALM10
"RTN","IBCNSC",74,0)
 Q
"RTN","IBCNSC",75,0)
 ;
"RTN","IBCNSC",76,0)
INSCO ; -- select insurance company
"RTN","IBCNSC",77,0)
 NEW DLAYGO,DIC,X,Y,DTOUT,DUOUT
"RTN","IBCNSC",78,0)
 I '$D(IBCNS) D  G:$D(VALMQUIT) INSCOQ
"RTN","IBCNSC",79,0)
 .S DIC="^DIC(36,",DIC(0)="AEQMZ",DIC("S")="I '$G(^(5))"
"RTN","IBCNSC",80,0)
 .I '$G(IBVIEW) S DLAYGO=36,DIC(0)=DIC(0)_"L"
"RTN","IBCNSC",81,0)
 .D ^DIC K DIC
"RTN","IBCNSC",82,0)
 .S IBCNS=+Y
"RTN","IBCNSC",83,0)
 I $G(IBCNS)<1 K IBCNS S VALMQUIT="" G INSCOQ
"RTN","IBCNSC",84,0)
INSCOQ ;
"RTN","IBCNSC",85,0)
 K DIC
"RTN","IBCNSC",86,0)
 Q
"RTN","IBCNSC",87,0)
 ;
"RTN","IBCNSC",88,0)
BLANK(LINE) ; -- Build blank line
"RTN","IBCNSC",89,0)
 D SET^VALM10(.LINE,$J("",80))
"RTN","IBCNSC",90,0)
 Q
"RTN","IBCNSC",91,0)
 ;
"RTN","IBCNSM")
0^61^B18162142
"RTN","IBCNSM",1,0)
IBCNSM ;ALB/AAS - INSURANCE MANAGEMENT, LIST MANAGER INIT ROUTINE ;21-OCT-92
"RTN","IBCNSM",2,0)
 ;;2.0;INTEGRATED BILLING;**28,46,56,52,82,103,199,276**;21-MAR-94
"RTN","IBCNSM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSM",4,0)
 ;
"RTN","IBCNSM",5,0)
 ;also used for IA #4694
"RTN","IBCNSM",6,0)
 ;
"RTN","IBCNSM",7,0)
% ; -- main entry point
"RTN","IBCNSM",8,0)
EN ;
"RTN","IBCNSM",9,0)
 D DT^DICRW
"RTN","IBCNSM",10,0)
 K XQORS,VALMEVL
"RTN","IBCNSM",11,0)
 D EN^VALM("IBCNS INSURANCE MANAGEMENT")
"RTN","IBCNSM",12,0)
ENQ K DFN
"RTN","IBCNSM",13,0)
 Q
"RTN","IBCNSM",14,0)
 ;
"RTN","IBCNSM",15,0)
 ;
"RTN","IBCNSM",16,0)
INIT ; -- set up inital variables
"RTN","IBCNSM",17,0)
 S U="^",VALMCNT=0,VALMBG=1
"RTN","IBCNSM",18,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBCNSM",19,0)
 ;K I,X,SDBEG,SDEND,SDB,XQORNOD,SDFN,SDCLN,DA,DR,DIE,DNM,DQ
"RTN","IBCNSM",20,0)
 S DIR(0)="350.9,4.02",DIR("A")="Select Patient Name or Insurance Co."
"RTN","IBCNSM",21,0)
 D ^DIR K DIR I $D(DIRUT) S VALMQUIT="" G INITQ
"RTN","IBCNSM",22,0)
 S IBY=Y
"RTN","IBCNSM",23,0)
 I IBY["DPT(" S IBTYP="P",DFN=+IBY D BLD
"RTN","IBCNSM",24,0)
 I IBY["DIC(" S IBTYP="I",IBCNS=+IBY D EN^VALM("IBCNS INSURANCE COMPANY") S VALMQUIT=""
"RTN","IBCNSM",25,0)
 ;
"RTN","IBCNSM",26,0)
INITQ Q
"RTN","IBCNSM",27,0)
 ;
"RTN","IBCNSM",28,0)
 ;
"RTN","IBCNSM",29,0)
PAT ; -- select patient you are working with
"RTN","IBCNSM",30,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCNSM",31,0)
 S DIC(0)="AEQMN",DIC="^DPT(" D ^DIC I +Y<1 S VALMQUIT="" Q
"RTN","IBCNSM",32,0)
 S DFN=+Y
"RTN","IBCNSM",33,0)
 Q
"RTN","IBCNSM",34,0)
 ;
"RTN","IBCNSM",35,0)
 ;
"RTN","IBCNSM",36,0)
BLD ; -- build list of bills
"RTN","IBCNSM",37,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBCNSM",38,0)
 N I,J,K,IBHOLD,IBGRP,IBINS,IBCNT,IBCDFND,IBCPOLD
"RTN","IBCNSM",39,0)
 S (IBN,IBCNT,VALMCNT)=0,IBFILE=2
"RTN","IBCNSM",40,0)
 ;
"RTN","IBCNSM",41,0)
 ; -- find all ins. co data
"RTN","IBCNSM",42,0)
 K IBINS S IBINS=0
"RTN","IBCNSM",43,0)
 D POL^IBCNSU41(DFN)
"RTN","IBCNSM",44,0)
 D ALL^IBCNS1(DFN,"IBINS")
"RTN","IBCNSM",45,0)
 I $G(IBINS(0)) S K=0 F  S K=$O(IBINS(K)) Q:'K  D
"RTN","IBCNSM",46,0)
 .; -- add to list
"RTN","IBCNSM",47,0)
 .W "."
"RTN","IBCNSM",48,0)
 .S IBCNT=IBCNT+1
"RTN","IBCNSM",49,0)
 .S IBCDFND=$G(IBINS(K,0))
"RTN","IBCNSM",50,0)
 .S IBCDFND1=$G(IBINS(K,1))
"RTN","IBCNSM",51,0)
 .S IBCPOLD=$G(^IBA(355.3,+$P($G(IBINS(K,0)),"^",18),0))
"RTN","IBCNSM",52,0)
 .S X=""
"RTN","IBCNSM",53,0)
 .S X=$$SETFLD^VALM1(IBCNT,X,"NUMBER")
"RTN","IBCNSM",54,0)
 .I $D(^DIC(36,+IBCDFND,0)) S X=$$SETFLD^VALM1($P(^(0),"^"),X,"NAME")
"RTN","IBCNSM",55,0)
 .S X=$$SETFLD^VALM1($E($P(IBCDFND,"^",2),1,14),X,"POLICY")
"RTN","IBCNSM",56,0)
 .S IBHOLD=$P(IBCDFND,"^",6),X=$$SETFLD^VALM1($S(IBHOLD="v":"SELF",IBHOLD="s":"SPOUSE",IBHOLD="o":"OTHER",1:"UNKNOWN"),X,"HOLDER")
"RTN","IBCNSM",57,0)
 .S X=$$SETFLD^VALM1($E($$GRP^IBCNS($P(IBCDFND,"^",18)),1,10),X,"GROUP")
"RTN","IBCNSM",58,0)
 .S X=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IBCDFND,"^",8)),X,"EFFDT")
"RTN","IBCNSM",59,0)
 .S X=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IBCDFND,"^",4)),X,"EXPIRE")
"RTN","IBCNSM",60,0)
 .S X=$$SETFLD^VALM1($E($P($G(^IBE(355.1,+$P(IBCPOLD,"^",9),0)),U),1,8),X,"TYPE")
"RTN","IBCNSM",61,0)
 .S X=$$SETFLD^VALM1($P($G(^IBE(355.1,+$P($G(^IBA(355.3,+$P(IBCDFND,"^",18),0)),"^",9),0)),"^"),X,"TYPEPOL")
"RTN","IBCNSM",62,0)
 .S X=$$SETFLD^VALM1($E($P($G(^VA(200,+$P(IBCDFND1,"^",4),0)),U),1,15),X,"VERIFIED BY")
"RTN","IBCNSM",63,0)
 .S X=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IBCDFND1,"^",3)),X,"VERIFIED ON")
"RTN","IBCNSM",64,0)
 .S X=$$SETFLD^VALM1($$YN($P(IBCPOLD,"^",6)),X,"PRECERT")
"RTN","IBCNSM",65,0)
 .S X=$$SETFLD^VALM1($$YN($P(IBCPOLD,"^",5)),X,"UR")
"RTN","IBCNSM",66,0)
 .S X=$$SETFLD^VALM1($$YN($P(IBCDFND,"^",20)),X,"COB")
"RTN","IBCNSM",67,0)
 .K IBHOLD,IBGRP
"RTN","IBCNSM",68,0)
 .D SET(X)
"RTN","IBCNSM",69,0)
 I '$D(^TMP("IBNSM",$J)) D
"RTN","IBCNSM",70,0)
 .S VALMCNT=2,IBCNT=2,^TMP("IBNSM",$J,1,0)=" "
"RTN","IBCNSM",71,0)
 .S ^TMP("IBNSM",$J,2,0)="    No Insurance Policies on file for this patient."
"RTN","IBCNSM",72,0)
 S X=$G(^IBA(354,DFN,60)) I X D
"RTN","IBCNSM",73,0)
 .S IBCNT=IBCNT+1
"RTN","IBCNSM",74,0)
 .S ^TMP("IBNSM",$J,IBCNT,0)="       Verification of No Coverage "_$$FMTE^XLFDT(X)
"RTN","IBCNSM",75,0)
BLDQ ;
"RTN","IBCNSM",76,0)
 Q
"RTN","IBCNSM",77,0)
 ;
"RTN","IBCNSM",78,0)
SET(X) ; -- set arrays
"RTN","IBCNSM",79,0)
 S VALMCNT=VALMCNT+1,^TMP("IBNSM",$J,VALMCNT,0)=X
"RTN","IBCNSM",80,0)
 S ^TMP("IBNSM",$J,"IDX",VALMCNT,IBCNT)=""
"RTN","IBCNSM",81,0)
 S ^TMP("IBNSMDX",$J,IBCNT)=VALMCNT_"^"_IBFILE_"^"_DFN_"^"_K_"^"_IBCDFND
"RTN","IBCNSM",82,0)
 Q
"RTN","IBCNSM",83,0)
 ;
"RTN","IBCNSM",84,0)
HDR ; -- screen header for initial screen
"RTN","IBCNSM",85,0)
 D PID^VADPT
"RTN","IBCNSM",86,0)
 S VALMHDR(1)="Insurance Management for Patient: "_$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")
"RTN","IBCNSM",87,0)
 S VALMHDR(2)=" "
"RTN","IBCNSM",88,0)
 I +$$BUFFER^IBCNBU1(DFN) S VALMHDR(2)="*** Patient has Insurance Buffer Records"
"RTN","IBCNSM",89,0)
 Q
"RTN","IBCNSM",90,0)
 ;
"RTN","IBCNSM",91,0)
FNL ; -- exit and clean up
"RTN","IBCNSM",92,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBCNSM",93,0)
 K IBFASTXT
"RTN","IBCNSM",94,0)
 D CLEAN^VALM10
"RTN","IBCNSM",95,0)
 Q
"RTN","IBCNSM",96,0)
 ;
"RTN","IBCNSM",97,0)
YN(X,Y) ; -- convert 1 or 0 to yes/no/unknown
"RTN","IBCNSM",98,0)
 Q $S($G(X)="":$S($G(Y):"",1:"UNK"),X=0:"NO",X=1:"YES",1:"")
"RTN","IBCNSM",99,0)
 ;
"RTN","IBCNSM",100,0)
CP ; -- change patient
"RTN","IBCNSM",101,0)
 N VALMQUIT
"RTN","IBCNSM",102,0)
 D FULL^VALM1
"RTN","IBCNSM",103,0)
 S IBDFN=DFN D PAT
"RTN","IBCNSM",104,0)
 I $D(VALMQUIT) S DFN=IBDFN
"RTN","IBCNSM",105,0)
 D HDR,BLD
"RTN","IBCNSM",106,0)
 S VALMBCK="R"
"RTN","IBCNSM",107,0)
CPQ K IBDFN
"RTN","IBCNSM",108,0)
 Q
"RTN","IBCNSM",109,0)
 ;
"RTN","IBCNSM",110,0)
PCI S VALMBCK="R" Q
"RTN","IBCNSM",111,0)
 ;
"RTN","IBCNSM",112,0)
FASTEXIT ;just sets a flag signaling system should be exited
"RTN","IBCNSM",113,0)
 S VALMBCK="Q"
"RTN","IBCNSM",114,0)
 D FULL^VALM1
"RTN","IBCNSM",115,0)
 K DIR S DIR(0)="Y",DIR("A")="Exit option entirely",DIR("B")="NO" D ^DIR
"RTN","IBCNSM",116,0)
 I $D(DIRUT)!(Y) S IBFASTXT=1
"RTN","IBCNSM",117,0)
 K DIR
"RTN","IBCNSM",118,0)
 Q
"RTN","IBCNSM4")
0^62^B3479873
"RTN","IBCNSM4",1,0)
IBCNSM4 ;ALB/AAS - INSURANCE MANAGEMENT, LIST MANAGER INIT ROUTINE ;21-OCT-92
"RTN","IBCNSM4",2,0)
 ;;2.0;INTEGRATED BILLING;**56,82,199,276**;21-MAR-94
"RTN","IBCNSM4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSM4",4,0)
 ;
"RTN","IBCNSM4",5,0)
 ;also used for IA #4694
"RTN","IBCNSM4",6,0)
 ;
"RTN","IBCNSM4",7,0)
% ; -- main entry point
"RTN","IBCNSM4",8,0)
EN ;
"RTN","IBCNSM4",9,0)
 D DT^DICRW
"RTN","IBCNSM4",10,0)
 K XQORS,VALMEVL,DFN,IBFASTXT
"RTN","IBCNSM4",11,0)
 I '$G(IBVIEW) D EN^VALM("IBCNS PATIENT INSURANCE")
"RTN","IBCNSM4",12,0)
 I $G(IBVIEW) D EN^VALM("IBCNS VIEW PAT INS")
"RTN","IBCNSM4",13,0)
ENQ K DFN,IBFASTXT,IBEXP1,IBEXP2,IBCDFN,IBFILE,IBI,IBLCNT,IBN,IBCGN,IBCNT,IBDA,IBDIF,IBPPOL,IBDUZ,IBCPOL,IBCDFND1,IBCDFN,IBCNS,IBYE
"RTN","IBCNSM4",14,0)
 Q
"RTN","IBCNSM4",15,0)
 ;
"RTN","IBCNSM4",16,0)
 ;
"RTN","IBCNSM4",17,0)
INIT ; -- set up inital variables
"RTN","IBCNSM4",18,0)
 S U="^",VALMCNT=0,VALMBG=1
"RTN","IBCNSM4",19,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBCNSM4",20,0)
 D:'$D(DFN) PAT G:$D(VALMQUIT) INITQ
"RTN","IBCNSM4",21,0)
 D BLD^IBCNSM
"RTN","IBCNSM4",22,0)
 ;
"RTN","IBCNSM4",23,0)
INITQ Q
"RTN","IBCNSM4",24,0)
 ;
"RTN","IBCNSM4",25,0)
 ;
"RTN","IBCNSM4",26,0)
PAT ; -- select patient you are working with
"RTN","IBCNSM4",27,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBCNSM4",28,0)
 S DIC(0)="AEQMN",DIC="^DPT(" D ^DIC I +Y<1 S VALMQUIT="" Q
"RTN","IBCNSM4",29,0)
 S DFN=+Y
"RTN","IBCNSM4",30,0)
 Q
"RTN","IBCNSM4",31,0)
 ;
"RTN","IBCNSM4",32,0)
HDR ; -- screen header for initial screen
"RTN","IBCNSM4",33,0)
 D PID^VADPT
"RTN","IBCNSM4",34,0)
 S VALMHDR(1)="Insurance Management for Patient: "_$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")
"RTN","IBCNSM4",35,0)
 S VALMHDR(2)=" "
"RTN","IBCNSM4",36,0)
 I +$$BUFFER^IBCNBU1(DFN) S VALMHDR(2)="*** Patient has Insurance Buffer Records"
"RTN","IBCNSM4",37,0)
 Q
"RTN","IBCNSM4",38,0)
 ;
"RTN","IBCNSM4",39,0)
FNL ; -- exit and clean up
"RTN","IBCNSM4",40,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBCNSM4",41,0)
 ;  for patch 56
"RTN","IBCNSM4",42,0)
 ;K IBFASTXT
"RTN","IBCNSM4",43,0)
 D CLEAN^VALM10
"RTN","IBCNSM4",44,0)
 Q
"RTN","IBCNSUR")
0^12^B23131946
"RTN","IBCNSUR",1,0)
IBCNSUR ;ALB/CPM/CMS - MOVE SUBSCRIBERS TO DIFFERENT PLAN ;09-SEP-96
"RTN","IBCNSUR",2,0)
 ;;2.0;INTEGRATED BILLING;**103,276**;21-MAR-94
"RTN","IBCNSUR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSUR",4,0)
 Q
"RTN","IBCNSUR",5,0)
 ;
"RTN","IBCNSUR",6,0)
EN ; Entry point from option. Main processing loop.
"RTN","IBCNSUR",7,0)
 I $S('($D(DUZ)#2):1,'$D(^VA(200,+DUZ,0)):1,1:0) W !!?3,"The variable DUZ must be set to an active user code before continuing." G ENQ
"RTN","IBCNSUR",8,0)
 W !!,?5,"MOVE SUBSCRIBERS OF ONE PLAN TO ANOTHER PLAN"
"RTN","IBCNSUR",9,0)
 W !,?5,"This option may be used to move subscribers from a selected Plan"
"RTN","IBCNSUR",10,0)
 W !,?5,"to a different Plan. The plans may be associated with the same"
"RTN","IBCNSUR",11,0)
 W !,?5,"Insurance Company or a different one. Plan and Annual Benefit"
"RTN","IBCNSUR",12,0)
 W !,?5,"information may be moved as well. Users of this option should"
"RTN","IBCNSUR",13,0)
 W !,?5,"be knowledgeable of the VistA Patient Insurance management options."
"RTN","IBCNSUR",14,0)
 W !
"RTN","IBCNSUR",15,0)
 W !,?5,"This option also gives the user the option to expire the old plan or"
"RTN","IBCNSUR",16,0)
 W !,?5,"replace it completely in the patient insurance profile.  The reason"
"RTN","IBCNSUR",17,0)
 W !,?5,"to expire the old plan is intended for use when Insurance groups change"
"RTN","IBCNSUR",18,0)
 W !,?5,"PBMs for processing electronic Pharmacy claims.  By leaving the old"
"RTN","IBCNSUR",19,0)
 W !,?5,"plan information intact (i.e. do not replace), the user will be able"
"RTN","IBCNSUR",20,0)
 W !,?5,"to monitor PBM changes  that affect the electronic Pharmacy claims."
"RTN","IBCNSUR",21,0)
 ;
"RTN","IBCNSUR",22,0)
 W !!,$TR($J("",75)," ","-")
"RTN","IBCNSUR",23,0)
 S IBSTOP=0 F  D PROC^IBCNSUR1 Q:IBSTOP
"RTN","IBCNSUR",24,0)
ENQ K IBSTOP
"RTN","IBCNSUR",25,0)
 Q
"RTN","IBCNSUR",26,0)
 ;
"RTN","IBCNSUR",27,0)
PROC ; - Process continuation from IBCNSUR1. 
"RTN","IBCNSUR",28,0)
 ; - display old plan attributes; allow new plan to be edited
"RTN","IBCNSUR",29,0)
 D PL^IBCNSUR2
"RTN","IBCNSUR",30,0)
 R !!,?10,"Press any key to continue.    ",IBX:DTIME
"RTN","IBCNSUR",31,0)
 ;
"RTN","IBCNSUR",32,0)
 ; - display coverage limitations; allow add/edit of plan 2 limitations
"RTN","IBCNSUR",33,0)
 D LIM^IBCNSUR2
"RTN","IBCNSUR",34,0)
 ;
"RTN","IBCNSUR",35,0)
 I $P($G(^IBA(355.3,IBP1,0)),"^",11) W !!,"Please note that ",IBC1N,"'s",!,"plan, subscribers were moved from, is already inactive." G PROCDP
"RTN","IBCNSUR",36,0)
 ;
"RTN","IBCNSUR",37,0)
 ; - does the user wish to inactivate the old plan?
"RTN","IBCNSUR",38,0)
 W !! S DIR(0)="Y",DIR("A")="Do you wish to inactivate "_IBC1N_"'s plan subscribers were moved from"
"RTN","IBCNSUR",39,0)
 S DIR("?")="If you wish to inactivate the old plan, enter 'Yes' - otherwise, enter 'No.'"
"RTN","IBCNSUR",40,0)
 D ^DIR K DIR I 'Y W !," <The old plan is still active>" G PROCQ
"RTN","IBCNSUR",41,0)
 ;
"RTN","IBCNSUR",42,0)
 D IRACT^IBCNSJ(IBP1,1) W !!,"The plan has been inactivated."
"RTN","IBCNSUR",43,0)
 ;
"RTN","IBCNSUR",44,0)
PROCDP ; - does the user wish to delete the old plan?
"RTN","IBCNSUR",45,0)
 W !! S DIR(0)="Y",DIR("A")="Do you wish to delete this plan"
"RTN","IBCNSUR",46,0)
 S DIR("?")="If you wish to delete the old plan, enter 'Yes' - otherwise, enter 'No.'"
"RTN","IBCNSUR",47,0)
 D ^DIR K DIR I 'Y G PROCQ
"RTN","IBCNSUR",48,0)
 ;
"RTN","IBCNSUR",49,0)
 D DEL^IBCNSJ(IBP1) W !!,"The plan has been deleted."
"RTN","IBCNSUR",50,0)
 ;
"RTN","IBCNSUR",51,0)
PROCQ Q
"RTN","IBCNSUR",52,0)
 ;
"RTN","IBCNSUR",53,0)
 ;
"RTN","IBCNSUR",54,0)
SEL(IBNP) ; Select a company and plan.
"RTN","IBCNSUR",55,0)
 ;   Input:     IBNP  --  If set to 1, allows adding a new plan and
"RTN","IBCNSUR",56,0)
 ;                    --  Screen Inactive Companies
"RTN","IBCNSUR",57,0)
 ;                    --  If set to 0, must have at least one group plan
"RTN","IBCNSUR",58,0)
 ;  Output:   IBCNS  --  Pointer to selected company in file #36
"RTN","IBCNSUR",59,0)
 ;           IBPLAN  --  Pointer to selected/added plan in file #355.3
"RTN","IBCNSUR",60,0)
 ;           IBQUIT  --  Set to 1 if the user wants to quit.
"RTN","IBCNSUR",61,0)
 ;
"RTN","IBCNSUR",62,0)
 N X,Y K DIC,DIR
"RTN","IBCNSUR",63,0)
 S DIC(0)="QEAMZ",DIC="^DIC(36,"
"RTN","IBCNSUR",64,0)
 I 'IBNP S DIC("S")="I $$ANYGP^IBCNSJ(+Y,0,1)"
"RTN","IBCNSUR",65,0)
 I IBNP S DIC("S")="I '$P($G(^DIC(36,+Y,0)),U,5)"
"RTN","IBCNSUR",66,0)
 S DIC("A")="Select INSURANCE COMPANY: "
"RTN","IBCNSUR",67,0)
 D ^DIC K DIC S IBCNS=+Y
"RTN","IBCNSUR",68,0)
 I Y<0 W "   <No Insurance Company selected>" S IBQUIT=1 G SELQ
"RTN","IBCNSUR",69,0)
 ;
"RTN","IBCNSUR",70,0)
 ; - if a new plan may be added, allow adding
"RTN","IBCNSUR",71,0)
 I IBNP D  I (IBPLAN)!(IBQUIT) G SELQ
"RTN","IBCNSUR",72,0)
 .W !!,"You may add a new Plan at this time or select an existing Plan."
"RTN","IBCNSUR",73,0)
 .D NEW^IBCNSJ3(IBCNS,.IBPLAN,1)
"RTN","IBCNSUR",74,0)
 .I 'IBPLAN,'$$ANYGP^IBCNSJ(+IBCNS,0,1) W !!,*7,"Insurance Company receiving subscribers must have a Plan." S IBQUIT=1
"RTN","IBCNSUR",75,0)
 ;
"RTN","IBCNSUR",76,0)
 ; - see if user wants to select the plan
"RTN","IBCNSUR",77,0)
 W !!,"You may select an existing Plan from a list or enter a specific Plan.",!
"RTN","IBCNSUR",78,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you wish to enter a specific plan"
"RTN","IBCNSUR",79,0)
 S DIR("?")="The look-up facility to select a group plan has been enhanced to use the List Manager.  Enter 'NO' if you wish to select a plan from this look-up, or 'YES' to directly enter a plan."
"RTN","IBCNSUR",80,0)
 D ^DIR K DIR I $D(DIRUT) S IBQUIT=1 G SELQ
"RTN","IBCNSUR",81,0)
 ;
"RTN","IBCNSUR",82,0)
 ; - invoke the plan look-up
"RTN","IBCNSUR",83,0)
 I 'Y D  G SELQ
"RTN","IBCNSUR",84,0)
 .W "   ..." S IBPLAN=0 D LKP^IBCNSU2(IBCNS,0,0,.IBPLAN,0,1)
"RTN","IBCNSUR",85,0)
 .I 'IBPLAN W !!,*7,"*  No plan selected!",! S IBQUIT=1
"RTN","IBCNSUR",86,0)
 ;
"RTN","IBCNSUR",87,0)
 ; - allow a FileMan look-up
"RTN","IBCNSUR",88,0)
 S DIC("A")="Select a GROUP PLAN: "
"RTN","IBCNSUR",89,0)
 S DIC="^IBA(355.3,",DIC(0)="AEQM",DIC("S")="I +^(0)=IBCNS,$P(^(0),U,2)"
"RTN","IBCNSUR",90,0)
 S DIC("W")="N IBX S IBX=$G(^(0)) W ""   Name: "",$E($S($P(IBX,U,3)]"""":$P(IBX,U,3),1:""<none>"")_$J("""",20),1,20),""   Number: "",$S($P(IBX,U,4)]"""":$P(IBX,U,4),1:""<none>"")"
"RTN","IBCNSUR",91,0)
 D ^DIC K DIC S IBPLAN=+Y
"RTN","IBCNSUR",92,0)
 I Y<0 W !!,*7,"*  No plan selected!",! S IBQUIT=1
"RTN","IBCNSUR",93,0)
 ;
"RTN","IBCNSUR",94,0)
SELQ K DIRUT,DUOUT,DTOUT,DIROUT
"RTN","IBCNSUR",95,0)
 Q
"RTN","IBCNSUR1")
0^13^B56652391
"RTN","IBCNSUR1",1,0)
IBCNSUR1 ;ALB/CPM/CMS - MOVE SUBSCRIBERS TO DIFFERENT PLAN (CON'T) ;09-SEP-96
"RTN","IBCNSUR1",2,0)
 ;;2.0;INTEGRATED BILLING;**103,225,276**;21-MAR-94
"RTN","IBCNSUR1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSUR1",4,0)
 Q
"RTN","IBCNSUR1",5,0)
 ;
"RTN","IBCNSUR1",6,0)
 ;
"RTN","IBCNSUR1",7,0)
PROC ; - Top of processing from IBCNSUR
"RTN","IBCNSUR1",8,0)
 ; Move subscribers to another company's insurance plan.
"RTN","IBCNSUR1",9,0)
 N IBCNS,IBPLAN,IBC1,IBC1N,IBC1X,IBC2,IBC2N,IBC2X,IBCPOL
"RTN","IBCNSUR1",10,0)
 N IBP1,IBP1N,IBP1X,IBP2,IBP2N,IBP2X,IBQ,IBQUIT,IBSUB,DFN,IBCDFN
"RTN","IBCNSUR1",11,0)
 N IBXXX,IBX,IBDAT,IBCDFN1,IBNP,IBAB,IBI,IBIAB,IBCAB,IBW,IBST
"RTN","IBCNSUR1",12,0)
 N DIC,DIE,DR,DA,D0,DIR,DIRUT,DIROUT,DTOUT,DUOUT,I,X,Y,DIK,DLAYGO
"RTN","IBCNSUR1",13,0)
 N IBSPLIT,IBEFFDT,IBEXPDT,REF,IBLN
"RTN","IBCNSUR1",14,0)
 ;
"RTN","IBCNSUR1",15,0)
 K ^TMP($J,"IBCNSUR")  ; subscribers
"RTN","IBCNSUR1",16,0)
 K ^TMP($J,"IBCNSUR1") ; e-mail bulletin
"RTN","IBCNSUR1",17,0)
 S REF=$NA(^TMP($J,"IBCNSUR1")),IBLN=0
"RTN","IBCNSUR1",18,0)
 ;
"RTN","IBCNSUR1",19,0)
 S IBQUIT=0
"RTN","IBCNSUR1",20,0)
 W !!!,"=====================",!,"MOVE SUBSCRIBERS FROM",!,"====================="
"RTN","IBCNSUR1",21,0)
 W !!,"Select the Insurance Company and Plan to move subscribers FROM.",!
"RTN","IBCNSUR1",22,0)
 ;
"RTN","IBCNSUR1",23,0)
 ; - select company/plan for subscribers to be moved
"RTN","IBCNSUR1",24,0)
 S IBQUIT=0
"RTN","IBCNSUR1",25,0)
 D SEL^IBCNSUR(0)
"RTN","IBCNSUR1",26,0)
 I IBQUIT S IBSTOP=1 G PROCQ
"RTN","IBCNSUR1",27,0)
 ;
"RTN","IBCNSUR1",28,0)
 ; - collect the plan subscribers
"RTN","IBCNSUR1",29,0)
 S IBC1=IBCNS,IBP1=IBPLAN
"RTN","IBCNSUR1",30,0)
 W !!,"Collecting Subscribers ..."
"RTN","IBCNSUR1",31,0)
 S IBSUB=$$SUBS^IBCNSJ(IBC1,IBP1,0,"^TMP($J,""IBCNSUR"")")
"RTN","IBCNSUR1",32,0)
 I 'IBSUB W !!,?5,*7,"*  This plan has no subscribers!" S IBQUIT=1 G PROCQ
"RTN","IBCNSUR1",33,0)
 W !!,"This plan has ",+IBSUB," subscribers. All subscribers will be moved."
"RTN","IBCNSUR1",34,0)
 ;  
"RTN","IBCNSUR1",35,0)
 ; - select company/plan to move subscribers
"RTN","IBCNSUR1",36,0)
 W !!!,"MOVE SUBSCRIBERS TO"
"RTN","IBCNSUR1",37,0)
 W !!,"Select the Insurance Company and Plan to move subscribers TO.",!
"RTN","IBCNSUR1",38,0)
 D SEL^IBCNSUR(1)
"RTN","IBCNSUR1",39,0)
 I IBQUIT G PROCQ
"RTN","IBCNSUR1",40,0)
 I $P($G(^DIC(36,IBCNS,0)),"^",5) W !!,*7,"You must move the subscribers to an active insurance company!" G PROCQ
"RTN","IBCNSUR1",41,0)
 S IBC2=IBCNS,IBP2=IBPLAN
"RTN","IBCNSUR1",42,0)
 ;
"RTN","IBCNSUR1",43,0)
 ; - make sure not moving the subscribers to their current plan
"RTN","IBCNSUR1",44,0)
 I (IBC1=IBC2)&(IBP1=IBP2) W !!,*7,"You must move the subscribers to a different plan!" G PROCQ
"RTN","IBCNSUR1",45,0)
 ;
"RTN","IBCNSUR1",46,0)
 ; - set name and plan number
"RTN","IBCNSUR1",47,0)
 S IBC1N=$P($G(^DIC(36,+IBC1,0)),U,1)
"RTN","IBCNSUR1",48,0)
 S IBP1N=$P($G(^IBA(355.3,+IBP1,0)),U,3,4),IBP1X=$P(IBP1N,U,2)
"RTN","IBCNSUR1",49,0)
 S IBP1X=$S(IBP1X]"":IBP1X,1:"<Not Specified>")
"RTN","IBCNSUR1",50,0)
 S IBP1N=$S($P(IBP1N,U,1)="":"<Not Specified>",1:$P(IBP1N,U,1))
"RTN","IBCNSUR1",51,0)
 S IBC2N=$P($G(^DIC(36,+IBC2,0)),U,1)
"RTN","IBCNSUR1",52,0)
 S IBP2N=$P($G(^IBA(355.3,+IBP2,0)),U,3,4),IBP2X=$P(IBP2N,U,2)
"RTN","IBCNSUR1",53,0)
 S IBP2X=$S(IBP2X]"":IBP2X,1:"<Not Specified>")
"RTN","IBCNSUR1",54,0)
 S IBP2N=$S($P(IBP2N,U,1)="":"<Not Specified>",1:$P(IBP2N,U,1))
"RTN","IBCNSUR1",55,0)
 ;
"RTN","IBCNSUR1",56,0)
 ; - ask if they want to delete the old insurance
"RTN","IBCNSUR1",57,0)
 S DIR(0)="Y",DIR("A")="Do you want to EXPIRE the old plan by entering the new plan Effective date"
"RTN","IBCNSUR1",58,0)
 S DIR("B")="NO"
"RTN","IBCNSUR1",59,0)
 S DIR("?")="If you wish to apply Effective Date, enter 'Yes' - otherwise, enter 'No'"
"RTN","IBCNSUR1",60,0)
 W ! D ^DIR K DIR
"RTN","IBCNSUR1",61,0)
 I $D(DIRUT) G PROCQ
"RTN","IBCNSUR1",62,0)
 S IBSPLIT=''Y
"RTN","IBCNSUR1",63,0)
 ; if yes then
"RTN","IBCNSUR1",64,0)
 ; - ask the effective date of the new insurance
"RTN","IBCNSUR1",65,0)
 I IBSPLIT D  I IBQ G PROCQ
"RTN","IBCNSUR1",66,0)
 . S IBQ=0
"RTN","IBCNSUR1",67,0)
 . S %DT="AEX",%DT("A")="Effective Date of the new Plan: "
"RTN","IBCNSUR1",68,0)
 . W ! D ^%DT K %DT I Y'>0 S IBQ=1 Q
"RTN","IBCNSUR1",69,0)
 . S IBEFFDT=$P(+Y,".")
"RTN","IBCNSUR1",70,0)
 . S IBEXPDT=$$FMADD^XLFDT(IBEFFDT,-1)
"RTN","IBCNSUR1",71,0)
 ;
"RTN","IBCNSUR1",72,0)
 ; - ask are they sure
"RTN","IBCNSUR1",73,0)
 W !!!,"You selected to move ",IBSUB," subscribers and "
"RTN","IBCNSUR1",74,0)
 W $S(IBSPLIT:"EXPIRE",1:"REPLACE")," the old plan in the patient",!,"profile.",!
"RTN","IBCNSUR1",75,0)
 W !?5,"FROM Insurance Company ",IBC1N
"RTN","IBCNSUR1",76,0)
 W !?10,"Plan Name ",IBP1N,"     Number ",IBP1X
"RTN","IBCNSUR1",77,0)
 W !?5,"TO Insurance Company ",IBC2N
"RTN","IBCNSUR1",78,0)
 W !?10,"Plan Name ",IBP2N,"     Number ",IBP2X
"RTN","IBCNSUR1",79,0)
 I IBSPLIT D
"RTN","IBCNSUR1",80,0)
 . W !?5,"BY switching to the new Insurance/Plan"
"RTN","IBCNSUR1",81,0)
 . W !?10,"with Effective Date ",$$DAT2^IBOUTL(IBEFFDT)
"RTN","IBCNSUR1",82,0)
 W !
"RTN","IBCNSUR1",83,0)
 W !,"Please Note that the old insurance group plan will be "
"RTN","IBCNSUR1",84,0)
 W $S(IBSPLIT:"EXPIRED",1:"REPLACED")," in the patient",!,"profile!",!
"RTN","IBCNSUR1",85,0)
 ;
"RTN","IBCNSUR1",86,0)
 S DIR(0)="Y",DIR("A")="Okay to continue"
"RTN","IBCNSUR1",87,0)
 S DIR("?")="If you wish to move these subscribers, enter 'Yes' - otherwise, enter 'No.'"
"RTN","IBCNSUR1",88,0)
 W ! D ^DIR K DIR
"RTN","IBCNSUR1",89,0)
 I 'Y W !!,?10,"<Okay, nothing moved>" G PROCQ
"RTN","IBCNSUR1",90,0)
 ;
"RTN","IBCNSUR1",91,0)
 ; - should annual benefits be moved?
"RTN","IBCNSUR1",92,0)
 S (IBAB,IBQ)=0
"RTN","IBCNSUR1",93,0)
 I $D(^IBA(355.4,"APY",IBP1)),'$D(^IBA(355.4,"APY",IBP2)) D  G:IBQ PROCQ
"RTN","IBCNSUR1",94,0)
 .S DIR(0)="Y",DIR("A")="Okay to add "_IBC1N_"'s plan Annual Benefits to "_IBC2N_"'s plan"
"RTN","IBCNSUR1",95,0)
 .S DIR("?")="If you wish to move these Annual Benefits, enter 'Yes' - otherwise, enter 'No.'"
"RTN","IBCNSUR1",96,0)
 .W ! D ^DIR K DIR I $D(DIRUT)!$D(DIROUT)!$D(DUOUT)!$D(DTOUT) S IBQ=1
"RTN","IBCNSUR1",97,0)
 .S:Y IBAB=1 K DIRUT,DUOUT,DTOUT,DIROUT
"RTN","IBCNSUR1",98,0)
 ;
"RTN","IBCNSUR1",99,0)
 ; - copy annual benefits over to the new plan
"RTN","IBCNSUR1",100,0)
 I IBAB D
"RTN","IBCNSUR1",101,0)
 .S IBI=0 F  S IBI=$O(^IBA(355.4,"C",IBP1,IBI)) Q:'IBI  D
"RTN","IBCNSUR1",102,0)
 ..S IBIAB=$G(^IBA(355.4,IBI,0)) Q:'IBIAB
"RTN","IBCNSUR1",103,0)
 ..S X=+IBIAB,DIC(0)="L",DLAYGO=355.4,DIC="^IBA(355.4,"
"RTN","IBCNSUR1",104,0)
 ..K DD,DO D FILE^DICN Q:+Y<0  S IBCAB=+Y
"RTN","IBCNSUR1",105,0)
 ..S $P(^IBA(355.4,IBCAB,0),"^",2)=IBP2
"RTN","IBCNSUR1",106,0)
 ..S $P(^IBA(355.4,IBCAB,0),"^",5,6)=$P(IBIAB,"^",5,6)
"RTN","IBCNSUR1",107,0)
 ..F I=1:1:5 I $G(^IBA(355.4,IBI,I))]"" S ^IBA(355.4,IBCAB,I)=^(I)
"RTN","IBCNSUR1",108,0)
 ..S DA=IBCAB,DIK="^IBA(355.4," D IX1^DIK,EDUP^IBCNSA2
"RTN","IBCNSUR1",109,0)
 ;
"RTN","IBCNSUR1",110,0)
 ; - should plan comments be copied over to the new plan?
"RTN","IBCNSUR1",111,0)
 S (IBAB,IBQ)=0
"RTN","IBCNSUR1",112,0)
 I $P($G(^IBA(355.3,IBP1,11,0)),U,4),'$P($G(^IBA(355.3,IBP2,11,0)),U,4) D  G:IBQ PROCQ
"RTN","IBCNSUR1",113,0)
 .S DIR(0)="Y"
"RTN","IBCNSUR1",114,0)
 .S DIR("A")="Okay to add "_IBC1N_"'s Comments to "_IBC2N_"'s plan"
"RTN","IBCNSUR1",115,0)
 .S DIR("?")="If you wish to move these Comments, enter 'Yes'"
"RTN","IBCNSUR1",116,0)
 .S DIR("?")=DIR("?")_" - otherwise, ente"
"RTN","IBCNSUR1",117,0)
 .W ! D ^DIR K DIR I $D(DIRUT)!$D(DIROUT)!$D(DUOUT)!$D(DTOUT) S IBQ=1
"RTN","IBCNSUR1",118,0)
 .S:Y IBAB=1 K DIRUT,DUOUT,DTOUT,DIROUT
"RTN","IBCNSUR1",119,0)
 ;
"RTN","IBCNSUR1",120,0)
 ; - copy plan comments over to the new plan
"RTN","IBCNSUR1",121,0)
 I IBAB D
"RTN","IBCNSUR1",122,0)
 .S DIC="^IBA(355.3,"_IBP2_",11,",DIC(0)="L",DIC("P")=355.311
"RTN","IBCNSUR1",123,0)
 .S IBI=0 F  S IBI=$O(^IBA(355.3,IBP1,11,IBI)) Q:'IBI  D
"RTN","IBCNSUR1",124,0)
 ..I $G(^IBA(355.3,IBP1,11,IBI,0))]"" S X=^(0) D FILE^DICN
"RTN","IBCNSUR1",125,0)
 ;
"RTN","IBCNSUR1",126,0)
 ; The MailMan bulletin header
"RTN","IBCNSUR1",127,0)
 D BHEAD^IBCNSUR3
"RTN","IBCNSUR1",128,0)
 ;
"RTN","IBCNSUR1",129,0)
 ; - move the subscribers to the new plan
"RTN","IBCNSUR1",130,0)
 W !!,"Moving subscribers "
"RTN","IBCNSUR1",131,0)
 S DFN=0 F  S DFN=$O(^TMP($J,"IBCNSUR",DFN)) Q:'DFN  D
"RTN","IBCNSUR1",132,0)
 .S IBCDFN=0 F  S IBCDFN=$O(^TMP($J,"IBCNSUR",DFN,IBCDFN)) Q:'IBCDFN  D
"RTN","IBCNSUR1",133,0)
 ..Q:$P($G(^DPT(DFN,.312,IBCDFN,0)),"^",18)'=IBP1
"RTN","IBCNSUR1",134,0)
 ..;
"RTN","IBCNSUR1",135,0)
 ..D ADS^IBCNSUR3(DFN,IBCDFN)
"RTN","IBCNSUR1",136,0)
 ..I 'IBSPLIT D MODIFINS(IBC2,IBP2,DFN,IBCDFN) ;regular mode
"RTN","IBCNSUR1",137,0)
 ..I IBSPLIT D SPLITINS(IBC2,IBP2,DFN,IBCDFN,IBEFFDT,IBEXPDT)
"RTN","IBCNSUR1",138,0)
 ..; - merge previous benefits used
"RTN","IBCNSUR1",139,0)
 ..S IBDAT="" F  S IBDAT=$O(^IBA(355.5,"APPY",DFN,IBP1,IBDAT)) Q:IBDAT=""  D
"RTN","IBCNSUR1",140,0)
 ...S IBCDFN1=0 F  S IBCDFN1=$O(^IBA(355.5,"APPY",DFN,IBP1,IBDAT,IBCDFN1)) Q:'IBCDFN1  I IBCDFN1=IBCDFN S IBBU=$O(^(IBCDFN1,0)) D
"RTN","IBCNSUR1",141,0)
 ....I '$D(^IBA(355.4,"APY",IBP2,IBDAT)) D DBU^IBCNSJ(IBBU) Q
"RTN","IBCNSUR1",142,0)
 ....D MERG^IBCNSJ13(IBP2,IBBU)
"RTN","IBCNSUR1",143,0)
 ..;
"RTN","IBCNSUR1",144,0)
 ..W "."
"RTN","IBCNSUR1",145,0)
 ;
"RTN","IBCNSUR1",146,0)
 W !!,"Done.  All subscribers were moved as requested!",!
"RTN","IBCNSUR1",147,0)
 D DONE^IBCNSUR3
"RTN","IBCNSUR1",148,0)
 W !,"The Bulletin was sent to you and members of 'IB NEW INSURANCE' Mail Group.",!
"RTN","IBCNSUR1",149,0)
 R !!,?10,"Press any key to continue.  ",IBX:DTIME
"RTN","IBCNSUR1",150,0)
 ;
"RTN","IBCNSUR1",151,0)
 ; - finish processing in IBCNSUR (keep RSIZE down)
"RTN","IBCNSUR1",152,0)
 D PROC^IBCNSUR
"RTN","IBCNSUR1",153,0)
 ;
"RTN","IBCNSUR1",154,0)
 ;
"RTN","IBCNSUR1",155,0)
PROCQ ;I 'IBSTOP S IBQUIT=0 D ASK^IBCOMC2 I IBQUIT=1 S IBSTOP=1
"RTN","IBCNSUR1",156,0)
 K ^TMP($J,"IBCNSUR")
"RTN","IBCNSUR1",157,0)
 K ^TMP($J,"IBCNSUR1")
"RTN","IBCNSUR1",158,0)
 Q
"RTN","IBCNSUR1",159,0)
 ;
"RTN","IBCNSUR1",160,0)
 ; modify the ins plan
"RTN","IBCNSUR1",161,0)
MODIFINS(IBC2,IBP2,DFN,IBCDFN) ;
"RTN","IBCNSUR1",162,0)
 N IBXXX,DIE,DA,DR,IBX
"RTN","IBCNSUR1",163,0)
 ; - change the policy company
"RTN","IBCNSUR1",164,0)
 S IBXXX='$G(^DPT(DFN,.312,IBCDFN,1))
"RTN","IBCNSUR1",165,0)
 S DIE="^DPT(DFN,.312,",DA(1)=DFN,DA=IBCDFN,DR=".01///`"_IBC2 D ^DIE K DIE,DA,DR
"RTN","IBCNSUR1",166,0)
 I IBXXX S $P(^DPT(DFN,.312,IBCDFN,1),"^",1,2)="^"
"RTN","IBCNSUR1",167,0)
 ;
"RTN","IBCNSUR1",168,0)
 ; - repoint Insurance Reviews to the new company
"RTN","IBCNSUR1",169,0)
 S IBX=0 F  S IBX=$O(^IBT(356.2,"D",DFN,IBX)) Q:'IBX  I $P($G(^IBT(356.2,IBX,1)),"^",5)=IBCDFN S DIE="^IBT(356.2,",DA=IBX,DR=".08////"_IBC2 D ^DIE K DIE,DA,DR
"RTN","IBCNSUR1",170,0)
 ;
"RTN","IBCNSUR1",171,0)
 ; - change the policy plan
"RTN","IBCNSUR1",172,0)
 D SWPL^IBCNSJ13(IBP2,DFN,IBCDFN)
"RTN","IBCNSUR1",173,0)
 Q
"RTN","IBCNSUR1",174,0)
 ;
"RTN","IBCNSUR1",175,0)
 ;
"RTN","IBCNSUR1",176,0)
 ;
"RTN","IBCNSUR1",177,0)
 ; change the ins plan effective IBEFFDT
"RTN","IBCNSUR1",178,0)
SPLITINS(IBC2,IBP2,DFN,IBCDFN,IBEFFDT,IBEXPDT) ;
"RTN","IBCNSUR1",179,0)
 N IBX,IBZ,IBZ1,IBRT,IBI,IBIEN,IBCDFN2,IBERR,DIK,DA,DIE,DR,DGRUGA08
"RTN","IBCNSUR1",180,0)
 S IBZ=$G(^DPT(DFN,.312,IBCDFN,0))
"RTN","IBCNSUR1",181,0)
 S IBZ1=$G(^DPT(DFN,.312,IBCDFN,1))
"RTN","IBCNSUR1",182,0)
 ; - ignore if the old plan expired
"RTN","IBCNSUR1",183,0)
 I $P(IBZ,U,4),$P(IBZ,U,4)<IBEFFDT Q
"RTN","IBCNSUR1",184,0)
 ; - if the ins is effective later - no need to split
"RTN","IBCNSUR1",185,0)
 I $P(IBZ,U,8),$P(IBZ,U,8)'<IBEFFDT D MODIFINS(IBC2,IBP2,DFN,IBCDFN) Q
"RTN","IBCNSUR1",186,0)
 ;
"RTN","IBCNSUR1",187,0)
 S DGRUGA08=1 ; Disable HL7 triggered by 2.312/3 and 2.312/8
"RTN","IBCNSUR1",188,0)
 ; - create the new insurance record for the DFN (clone)
"RTN","IBCNSUR1",189,0)
 S IBI="+1,"_DFN_","
"RTN","IBCNSUR1",190,0)
 ; - add a record
"RTN","IBCNSUR1",191,0)
 S IBRT(2.312,IBI,.01)=IBC2
"RTN","IBCNSUR1",192,0)
 D UPDATE^DIE("","IBRT","IBIEN","IBERR")
"RTN","IBCNSUR1",193,0)
 I $D(IBERR) Q  ; error
"RTN","IBCNSUR1",194,0)
 I '$G(IBIEN(1)) Q  ; error
"RTN","IBCNSUR1",195,0)
 S IBCDFN2=+IBIEN(1)
"RTN","IBCNSUR1",196,0)
 ; - clone the insurance data
"RTN","IBCNSUR1",197,0)
 M ^DPT(DFN,.312,IBCDFN2)=^DPT(DFN,.312,IBCDFN)
"RTN","IBCNSUR1",198,0)
 S $P(^DPT(DFN,.312,IBCDFN2,0),U,1)=IBC2
"RTN","IBCNSUR1",199,0)
 S $P(^DPT(DFN,.312,IBCDFN2,0),U,8)=IBEFFDT
"RTN","IBCNSUR1",200,0)
 ; - now reindex
"RTN","IBCNSUR1",201,0)
 S DA(1)=DFN,DA=IBCDFN2,DIK="^DPT("_DFN_",.312,"
"RTN","IBCNSUR1",202,0)
 D IX1^DIK
"RTN","IBCNSUR1",203,0)
 ; - change the policy plan
"RTN","IBCNSUR1",204,0)
 D SWPL^IBCNSJ13(IBP2,DFN,IBCDFN2)
"RTN","IBCNSUR1",205,0)
 ; - set the expiration date
"RTN","IBCNSUR1",206,0)
 S $P(^DPT(DFN,.312,IBCDFN,0),U,4)=IBEXPDT
"RTN","IBCNSUR1",207,0)
 S DA(1)=DFN,DA=IBCDFN,DIK="^DPT("_DFN_",.312,"
"RTN","IBCNSUR1",208,0)
 D IX1^DIK
"RTN","IBCNSUR1",209,0)
 Q
"RTN","IBCNSUR3")
0^28^B6612795
"RTN","IBCNSUR3",1,0)
IBCNSUR3 ;WOIFO/AAT - MOVE SUBSCRIBERS (BULLETIN) ;09-SEP-96
"RTN","IBCNSUR3",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBCNSUR3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSUR3",4,0)
 Q
"RTN","IBCNSUR3",5,0)
 ;
"RTN","IBCNSUR3",6,0)
 ;add line to the bulletin
"RTN","IBCNSUR3",7,0)
ADD(IBTAB,IBX1,IBX2,IBX3,IBX4,IBX5) ;
"RTN","IBCNSUR3",8,0)
 N IBX
"RTN","IBCNSUR3",9,0)
 S IBLN=IBLN+1
"RTN","IBCNSUR3",10,0)
 S IBX="" S:$G(IBTAB)>1 $E(IBX,IBTAB-1)=" "
"RTN","IBCNSUR3",11,0)
 S @REF@(IBLN)=IBX_$G(IBX1)_$G(IBX2)_$G(IBX3)_$G(IBX4)_$G(IBX5)
"RTN","IBCNSUR3",12,0)
 Q
"RTN","IBCNSUR3",13,0)
 ;
"RTN","IBCNSUR3",14,0)
BHEAD ; Bulletin header
"RTN","IBCNSUR3",15,0)
 D ADD(1,"MOVE SUBSCRIBERS OF ONE PLAN TO ANOTHER PLAN")
"RTN","IBCNSUR3",16,0)
 D ADD()
"RTN","IBCNSUR3",17,0)
 D ADD(1,"You selected to move ",IBSUB," subscribers")
"RTN","IBCNSUR3",18,0)
 D ADD()
"RTN","IBCNSUR3",19,0)
 D ADD(5,"FROM Insurance Company ",IBC1N)
"RTN","IBCNSUR3",20,0)
 D ADD(10,"Plan Name ",IBP1N,"     Number ",IBP1X)
"RTN","IBCNSUR3",21,0)
 D ADD(5,"TO Insurance Company ",IBC2N)
"RTN","IBCNSUR3",22,0)
 D ADD(10,"Plan Name ",IBP2N,"     Number ",IBP2X)
"RTN","IBCNSUR3",23,0)
 I IBSPLIT D
"RTN","IBCNSUR3",24,0)
 . D ADD(5,"BY switching to the new Insurance/Plan")
"RTN","IBCNSUR3",25,0)
 . D ADD(10,"with Effective Date ",$$DAT1^IBOUTL(IBEFFDT))
"RTN","IBCNSUR3",26,0)
 D ADD()
"RTN","IBCNSUR3",27,0)
 D ADD(1,"The old insurance group plan is ",$S(IBSPLIT:"set EXPIRED",1:"REPLACED")," in the patient profile."),ADD()
"RTN","IBCNSUR3",28,0)
 D ADD(1,"Patient Name/ID             Whose    Employer              Effective   Expires")
"RTN","IBCNSUR3",29,0)
 D ADD(1,"-------------------------------------------------------------------------------")
"RTN","IBCNSUR3",30,0)
 Q
"RTN","IBCNSUR3",31,0)
 ; Add subscriber to the bulletin
"RTN","IBCNSUR3",32,0)
ADS(DFN,IBCDFN) ;
"RTN","IBCNSUR3",33,0)
 N IBX,IBZ,IB2
"RTN","IBCNSUR3",34,0)
 S IBZ=$G(^DPT(DFN,.312,IBCDFN,0))
"RTN","IBCNSUR3",35,0)
 S IB2=$G(^DPT(DFN,.312,IBCDFN,2))
"RTN","IBCNSUR3",36,0)
 S IBX=$E($P($G(^DPT(DFN,0)),U),1,22),$E(IBX,22)=" "
"RTN","IBCNSUR3",37,0)
 S IBX=$E(IBX_$E($P($G(^DPT(DFN,0)),U,9),6,10),1,28),$E(IBX,28)=" "
"RTN","IBCNSUR3",38,0)
 S IBX=$E(IBX_$$EXTERNAL^DILFD(2.312,6,,$P(IBZ,U,6)),1,36),$E(IBX,37)=" "
"RTN","IBCNSUR3",39,0)
 S IBX=$E(IBX_$P(IB2,U,9),1,59),$E(IBX,59)=" "
"RTN","IBCNSUR3",40,0)
 S IBX=$E(IBX_$$DAT1^IBOUTL($P(IBZ,U,8)),1,71),$E(IBX,71)=" "
"RTN","IBCNSUR3",41,0)
 S IBX=$E(IBX_$$DAT1^IBOUTL($P(IBZ,U,4)),1,80)
"RTN","IBCNSUR3",42,0)
 D ADD(1,IBX)
"RTN","IBCNSUR3",43,0)
 Q
"RTN","IBCNSUR3",44,0)
 ;
"RTN","IBCNSUR3",45,0)
DONE ;
"RTN","IBCNSUR3",46,0)
 N IBGRP,XMDUZ,XMTEXT,XMSUB,XMY,%
"RTN","IBCNSUR3",47,0)
 ;
"RTN","IBCNSUR3",48,0)
 D NOW^%DTC
"RTN","IBCNSUR3",49,0)
 D ADD()
"RTN","IBCNSUR3",50,0)
 D ADD(1,"THE PROCESS COMPLETED SUCCESSFULLY ON "_$$DAT1^IBOUTL(%,1))
"RTN","IBCNSUR3",51,0)
 ;
"RTN","IBCNSUR3",52,0)
 S XMSUB="SUBSCRIPTION LIST FOR INACTIVATED PLAN"
"RTN","IBCNSUR3",53,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="^TMP("_$J_",""IBCNSUR1"","
"RTN","IBCNSUR3",54,0)
 S XMY(DUZ)=""
"RTN","IBCNSUR3",55,0)
 S XMY("G.IB NEW INSURANCE")=""
"RTN","IBCNSUR3",56,0)
 D ^XMD
"RTN","IBCNSUR3",57,0)
 Q
"RTN","IBCNSV")
0^63^B922209
"RTN","IBCNSV",1,0)
IBCNSV ;ALB/AAS - INS. MGMT, INVOKE LIST TEMPLATE ;06-JUL-93
"RTN","IBCNSV",2,0)
 ;;2.0;INTEGRATED BILLING;**276**; 21-MAR-94
"RTN","IBCNSV",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNSV",4,0)
 ;
"RTN","IBCNSV",5,0)
 ;also used for IA #4694
"RTN","IBCNSV",6,0)
 ;
"RTN","IBCNSV",7,0)
NXT(IBTMPNM) ; -- Go to next template
"RTN","IBCNSV",8,0)
 ; -- Input template name
"RTN","IBCNSV",9,0)
 N VALMY,I,J,IBXXV
"RTN","IBCNSV",10,0)
 D EN^VALM2($G(XQORNOD(0)))
"RTN","IBCNSV",11,0)
 D FULL^VALM1 W !!
"RTN","IBCNSV",12,0)
 I $D(VALMY) S IBXXV=0 F  S IBXXV=$O(VALMY(IBXXV)) Q:'IBXXV  D
"RTN","IBCNSV",13,0)
 .S IBPPOL=$G(^TMP("IBNSMDX",$J,$O(^TMP("IBNSM",$J,"IDX",IBXXV,0))))
"RTN","IBCNSV",14,0)
 .Q:IBPPOL=""
"RTN","IBCNSV",15,0)
 .S IBCNS=$P(IBPPOL,"^",5),IBCPOL=$P(IBPPOL,"^",22)
"RTN","IBCNSV",16,0)
 .D EN^VALM(IBTMPNM)
"RTN","IBCNSV",17,0)
 .Q
"RTN","IBCNSV",18,0)
 D BLD^IBCNSM
"RTN","IBCNSV",19,0)
 S VALMBCK="R"
"RTN","IBCNSV",20,0)
 Q
"RTN","IBEVNTP")
0^66^B8629537
"RTN","IBEVNTP",1,0)
IBEVNTP ;DALOI/KML - PURGE ^XTMP("IBNCPDP-"_dt) ;1/17/2006
"RTN","IBEVNTP",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBEVNTP",3,0)
 ;
"RTN","IBEVNTP",4,0)
 Q
"RTN","IBEVNTP",5,0)
EN ;
"RTN","IBEVNTP",6,0)
 W !,"The software supporting the Integrated Billing (IB) option,"
"RTN","IBEVNTP",7,0)
 W !,"ECME Billing Events Report, references the ^XTMP temporary"
"RTN","IBEVNTP",8,0)
 W !,"global array.  The subscript, and associated descendent nodes,"
"RTN","IBEVNTP",9,0)
 W !,"that this report references are at ^XTMP(""IBNCPDP-""_date) where"
"RTN","IBEVNTP",10,0)
 W !,"date is equal to the (fileman) date that the global was created."
"RTN","IBEVNTP",11,0)
 W !,"This program will enable the IRM staff to remove the subscripts"
"RTN","IBEVNTP",12,0)
 W !,"if space for ^XTMP becomes an issue."
"RTN","IBEVNTP",13,0)
 W !!,"Please coordinate this purge with the appropriate staff that"
"RTN","IBEVNTP",14,0)
 W !,"work with the IB and Accounts Receivable packages before"
"RTN","IBEVNTP",15,0)
 W !,"executing this program.  You will need to determine how"
"RTN","IBEVNTP",16,0)
 W !,"how many days worth of data the staff wish to keep."
"RTN","IBEVNTP",17,0)
 N DIR,IBPDATE,IBTODT,IBXTMP,IBSTDT,Y,IBPURGE,IBFRDT,IBENDDT,IBX
"RTN","IBEVNTP",18,0)
 D DT^DILF(,"T+1",.IBTODT)
"RTN","IBEVNTP",19,0)
 S IBSTDT="IBNCPDP-0",IBSTDT=$O(^XTMP(IBSTDT))
"RTN","IBEVNTP",20,0)
 S IBTODT="IBNCPDP-"_IBTODT,IBTODT=$O(^XTMP(IBTODT),-1)
"RTN","IBEVNTP",21,0)
 W !!,"The system has subscripts dating from ",$$FMTE^XLFDT($P(IBSTDT,"-",2))," to ",$$FMTE^XLFDT($P(IBTODT,"-",2)),".",!!
"RTN","IBEVNTP",22,0)
 D DT^DILF(,"T-35",.IBTODT)  ;reset IBTODT
"RTN","IBEVNTP",23,0)
 S DIR(0)="D^::EX"
"RTN","IBEVNTP",24,0)
 S DIR("A")="Enter purge STOP date"
"RTN","IBEVNTP",25,0)
 S DIR("A",1)="The purge will BEGIN at this date: "_$$FMTE^XLFDT($P(IBSTDT,"-",2))
"RTN","IBEVNTP",26,0)
 S DIR("A",2)="and can STOP at this date: "_$$FMTE^XLFDT(IBTODT)_"."
"RTN","IBEVNTP",27,0)
 S DIR("A",3)="You can change the STOP date to an earlier date,"
"RTN","IBEVNTP",28,0)
 S DIR("A",4)="but not a later date (e.g.,STOP date < "_$$FMTE^XLFDT(IBTODT)_")."
"RTN","IBEVNTP",29,0)
2 D ^DIR
"RTN","IBEVNTP",30,0)
 Q:$D(DUOUT)  Q:$D(DTOUT)
"RTN","IBEVNTP",31,0)
 I Y>IBTODT W !,"That STOP date cannot be used.",!! G 2
"RTN","IBEVNTP",32,0)
 S IBPDATE=Y
"RTN","IBEVNTP",33,0)
 K DIR
"RTN","IBEVNTP",34,0)
 S DIR(0)="Y" S DIR("A")="Are you sure? Y/N",DIR("B")="NO" D ^DIR
"RTN","IBEVNTP",35,0)
 Q:'Y
"RTN","IBEVNTP",36,0)
 S IBPURGE=0,IBSTDT="IBNCPDP-0"
"RTN","IBEVNTP",37,0)
 W !,"Starting ..."
"RTN","IBEVNTP",38,0)
 F IBX=1:1 S IBSTDT=$O(^XTMP(IBSTDT)) Q:$P(IBSTDT,"-",2)>IBPDATE  Q:$P(IBSTDT,"-",2)>IBTODT  D
"RTN","IBEVNTP",39,0)
 . S:'IBPURGE IBPURGE=1
"RTN","IBEVNTP",40,0)
 . S:IBX=1 IBFRDT=$P(IBSTDT,"-",2)
"RTN","IBEVNTP",41,0)
 . S IBENDDT=$P(IBSTDT,"-",2)
"RTN","IBEVNTP",42,0)
 . ;K ^XTMP(IBSTDT)
"RTN","IBEVNTP",43,0)
 I 'IBPURGE W !!!,"Data did not meet purge criteria.",!,"Nothing was purged." Q
"RTN","IBEVNTP",44,0)
 W !!,"The system has removed subscripts dating from ",$$FMTE^XLFDT(IBFRDT)," to ",$$FMTE^XLFDT(IBENDDT),".",!!
"RTN","IBEVNTP",45,0)
 ;
"RTN","IBEVNTP",46,0)
 Q
"RTN","IBEVNTP",47,0)
 ;
"RTN","IBEVNTP",48,0)
 ;IBEVNTP
"RTN","IBJTCA1")
0^31^B37857636
"RTN","IBJTCA1",1,0)
IBJTCA1 ;ALB/ARH - TPI CLAIMS INFO BUILD ;16-FEB-1995
"RTN","IBJTCA1",2,0)
 ;;2.0;INTEGRATED BILLING;**39,80,106,137,223,276**;21-MAR-94
"RTN","IBJTCA1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBJTCA1",4,0)
 ;
"RTN","IBJTCA1",5,0)
BLD ; build array for Third Party Joint Inquiry Claims Info screen, IBIFN must be defined
"RTN","IBJTCA1",6,0)
 ;
"RTN","IBJTCA1",7,0)
 N X,IBY,IBZ,IBZ0,IBI,IBT,IBD,IBLN,IBLR,IBD0,IBDI1,IBDM,IBDM1,IBDU,IBDS,IBDU2,IBID0,IBID13,IBNC,IBTC,IBTW,IBSW,IBGRPB,IBGRPE,IBWNR,IBDTX,IBBX19,IBPRVO,IBNABP
"RTN","IBJTCA1",8,0)
 S VALMCNT=0,X="",IBD0=$G(^DGCR(399,+$G(IBIFN),0)) I IBD0="" S VALMQUIT="" G BLDQ
"RTN","IBJTCA1",9,0)
 F IBI="M","M1","U","S","U2","TX" S @("IBD"_IBI)=$G(^DGCR(399,+IBIFN,IBI))
"RTN","IBJTCA1",10,0)
 S IBDI1=$P(IBD0,U,21),IBDI1=$S(IBDI1="S":"I2",IBDI1="T":"I3",1:"I1") S IBDI1=$G(^DGCR(399,+IBIFN,IBDI1))
"RTN","IBJTCA1",11,0)
 S IBID0=$G(^DIC(36,+IBDI1,0)),IBID13=$G(^DIC(36,+IBDI1,.13))
"RTN","IBJTCA1",12,0)
 ;
"RTN","IBJTCA1",13,0)
 ;
"RTN","IBJTCA1",14,0)
 S (IBLN,VALMCNT)=1
"RTN","IBJTCA1",15,0)
 S (IBNC(1),IBTC(1),IBTC(4))=2,IBTC(5)=78,(IBNC(2),IBTC(2))=42,IBNC(3)=35,IBTW(1)=15,IBTW(2)=16,IBTW(4)=12,IBTW(5)=1,IBSW(1)=23,IBSW(2)=21,IBSW(4)=60,IBSW(5)=1
"RTN","IBJTCA1",16,0)
 ;
"RTN","IBJTCA1",17,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",18,0)
 ;
"RTN","IBJTCA1",19,0)
 S IBT="Insurance Demographics" S IBLN=$$SETN(IBT,IBLN,IBLR,1)
"RTN","IBJTCA1",20,0)
 S IBWNR=$$WNRBILL^IBEFUNC(IBIFN)
"RTN","IBJTCA1",21,0)
 S IBNABP=$$NABP^IBNCPDPU(IBIFN)
"RTN","IBJTCA1",22,0)
 S IBT=$S(IBWNR:" *",1:"  ")_"Bill Payer: ",IBD=$P(IBID0,U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",23,0)
 S IBT="Claim Address: " D  S IBD=$P(IBDM,U,5) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",24,0)
 . I $P(IBID0,U,1)'=$P(IBDM,U,4) S IBD=$P(IBDM,U,4) S IBLN=$$SET(IBT,IBD,IBLN,IBLR) S IBT=""
"RTN","IBJTCA1",25,0)
 I $P(IBDM,U,6)'="" S IBT="",IBD=$P(IBDM,U,6) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",26,0)
 I $P(IBDM1,U,1)'="" S IBT="",IBD=$P(IBDM1,U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",27,0)
 S IBT="",IBD=$P(IBDM,U,7),IBD=IBD_$S(IBD'="":", ",1:"")_$P($G(^DIC(5,+$P(IBDM,U,8),0)),U,2)_" "_$P(IBDM,U,9),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",28,0)
 S IBT="Claim Phone: ",IBD=$P($$BADD^IBJTU3(+IBIFN),U,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",29,0)
 ;
"RTN","IBJTCA1",30,0)
 S IBGRPE=IBLN,IBLN=IBGRPB,IBLR=2
"RTN","IBJTCA1",31,0)
 ;
"RTN","IBJTCA1",32,0)
 S IBT="Subscriber Demographics" S IBLN=$$SETN(IBT,IBLN,IBLR,1)
"RTN","IBJTCA1",33,0)
 S IBT="Group Number: ",IBD=$P(IBDI1,U,3) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",34,0)
 S IBT="Group Name: ",IBD=$P(IBDI1,U,15) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",35,0)
 S IBT="Subscriber ID: ",IBD=$P(IBDI1,U,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",36,0)
 S IBT="Employer: ",IBD=$$EMPL(+DFN) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",37,0)
 S IBT="Insured's Name: ",IBD=$P(IBDI1,U,17) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",38,0)
 S IBT="Relationship: ",IBD=$$EXSET^IBJU1($P(IBDI1,U,16),2.312,16) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",39,0)
 ;
"RTN","IBJTCA1",40,0)
 S (IBLN,VALMCNT)=$S(IBLN>IBGRPE:IBLN,1:IBGRPE)
"RTN","IBJTCA1",41,0)
 S (IBNC(1),IBTC(1))=2,(IBNC(2),IBTC(2))=42,IBNC(3)=29,IBTW(1)=12,IBTW(2)=16,IBSW(1)=26,IBSW(2)=22
"RTN","IBJTCA1",42,0)
 S (IBT,IBD)="" S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",43,0)
 ;
"RTN","IBJTCA1",44,0)
 I $$FT^IBCEF(IBIFN)=2 D
"RTN","IBJTCA1",45,0)
 . N IBXDATA,IBXSAVE K ^TMP("IBXSAVE",$J)
"RTN","IBJTCA1",46,0)
 . D F^IBCEF("N-HCFA 1500 BOX 19",,,IBIFN)
"RTN","IBJTCA1",47,0)
 . I IBXDATA'="" S IBBX19(1)=$E(IBXDATA,1,40) S:$E(IBXDATA,41,$L(IBXDATA))'="" IBBX19(2)=$E(IBXDATA,41,$L(IBXDATA))
"RTN","IBJTCA1",48,0)
 ;
"RTN","IBJTCA1",49,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",50,0)
 S IBT="Claim Information" S IBLN=$$SETN(IBT,IBLN,3,1)
"RTN","IBJTCA1",51,0)
 S IBT="Bill Type: ",IBD=$$EXSET^IBJU1($P(IBD0,U,5),399,.05) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",52,0)
 S IBT="Time Frame: ",IBD=$$EXSET^IBJU1($P(IBD0,U,6),399,.06) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",53,0)
 S IBT="Rate Type: ",IBD=$P($G(^DGCR(399.3,+$P(IBD0,U,7),0)),U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",54,0)
 S IBT="AR Status: ",IBD=$P($$ARSTATA^IBJTU4(IBIFN),U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",55,0)
 S IBT=" Sequence: ",IBD=$P($$EXSET^IBJU1($P(IBD0,U,21),399,.21)," ",1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",56,0)
 S IBT="Purch Svc: ",IBD=$S($P(IBDU2,U,11)="":"NO",1:$$EXPAND^IBTRE(399,233,$P(IBDU2,U,11))),IBLN=$$SET(IBT,IBD,IBLN,4)
"RTN","IBJTCA1",57,0)
 I $P(IBDM1,"^",8) S IBT="  ECME No: ",IBD=+$P(IBDM1,"^",8),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",58,0)
 I $L($P(IBDM1,"^",9)) S IBT="ECME Ap No: ",IBD=$P(IBDM1,"^",9),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",59,0)
 I IBNABP'="" S IBT="  NCPDP No: ",IBD=IBNABP,IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",60,0)
 I IBWNR S IBT="MRA Status: ",IBD=$S($P(IBDTX,U,5):$P(IBDTX,U,5),1:"NOT RECEIVED"),IBLN=$$SET(IBT,$S(IBD:$$EXPAND^IBTRE(399,24,IBD),1:IBD),IBLN,IBLR)
"RTN","IBJTCA1",61,0)
 I $G(IBBX19(1))'="" D
"RTN","IBJTCA1",62,0)
 . S IBT="   Box 19: ",IBD=IBBX19(1),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",63,0)
 . I $G(IBBX19(2))'="" S IBT=$J("",11),IBD=IBBX19(2),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",64,0)
 ;
"RTN","IBJTCA1",65,0)
 S IBLR=4,IBPRVO=""
"RTN","IBJTCA1",66,0)
 S IBT="Providers: ",IBD="NONE"
"RTN","IBJTCA1",67,0)
 D F^IBCEF("N-ALL PROVIDERS","IBZ",,IBIFN)
"RTN","IBJTCA1",68,0)
 S IBZ0=0
"RTN","IBJTCA1",69,0)
 S Z=0
"RTN","IBJTCA1",70,0)
 F  S Z=$O(IBZ(Z)) Q:'Z  D
"RTN","IBJTCA1",71,0)
 . I $G(IBZ(Z)),$G(IBZ(Z,1))'="" S IBLN=$$SET(IBT,"(OLD PROV DATA) "_IBZ(Z,1),IBLN,IBLR),IBZ0=1 Q
"RTN","IBJTCA1",72,0)
 . I $P($G(IBZ(Z,1)),U)'="" S IBD=$E($$EXPAND^IBTRE(399.0222,.01,Z)_":"_$J("",15),1,15)_$P(IBZ(Z,1),U)_$S($P(IBZ(Z,1),U,4)'="":" ("_$P(IBZ(Z,1),U,4)_")",1:"") S IBLN=$$SET(IBT,IBD,IBLN,IBLR) S IBT=$J("",11),IBZ0=1
"RTN","IBJTCA1",73,0)
 I 'IBZ0 S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",74,0)
 ;
"RTN","IBJTCA1",75,0)
 S IBGRPE=IBLN,IBLN=IBGRPB+1,IBLR=2
"RTN","IBJTCA1",76,0)
 ;
"RTN","IBJTCA1",77,0)
 S IBT="Charge Type: ",IBD=$$EXSET^IBJU1($P(IBD0,U,27),399,.27) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",78,0)
 S IBT="Service Dates: ",IBD=$$DATE^IBJU1($P(IBDU,U,1))_" - "_$$DATE^IBJU1($P(IBDU,U,2)) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",79,0)
 S IBT="Orig Claim: ",IBD=$$BILL^RCJIBFN2(+IBIFN) S IBLN=$$SET(IBT,$J($P(IBD,U,1),9,2),IBLN,IBLR)
"RTN","IBJTCA1",80,0)
 S IBT="Balance Due: ",IBD=$J($P(IBD,U,3),9,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",81,0)
 I +$P(IBDM,U,2) S IBX=$S($P(IBD0,U,21)="P":2,1:1) D  S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",82,0)
 . S IBT=$S(IBX=2:"Secondary",1:"Primary")_": ",IBD=$P($G(^DIC(36,+$P(IBDM,U,IBX),0)),U,1)
"RTN","IBJTCA1",83,0)
 . S IBX=$P(IBDU2,U,(IBX+3)) I +IBX S IBX="("_$J(IBX,0,2)_")" S IBD=$E(IBD,1,(IBSW(IBLR)-$L(IBX)-2))_"  "_IBX
"RTN","IBJTCA1",84,0)
 I +$P(IBDM,U,3) S IBX=$S($P(IBD0,U,21)="T":2,1:3) D  S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",85,0)
 . S IBT=$S(IBX=2:"Secondary",1:"Tertiary")_": ",IBD=$P($G(^DIC(36,+$P(IBDM,U,IBX),0)),U,1)
"RTN","IBJTCA1",86,0)
 . S IBX=$P(IBDU2,U,(IBX+3)) I +IBX S IBX="("_$J(IBX,0,2)_")" S IBD=$E(IBD,1,(IBSW(IBLR)-$L(IBX)-2))_"  "_IBX
"RTN","IBJTCA1",87,0)
 S IBLN=$$SET("","",IBLN,5)
"RTN","IBJTCA1",88,0)
 I IBWNR S IBT="MRA Rec Date: " D  S IBLN=$$SET(IBT,IBD,IBLN,2)
"RTN","IBJTCA1",89,0)
 . N Z
"RTN","IBJTCA1",90,0)
 . ; find last MRA for receipt date
"RTN","IBJTCA1",91,0)
 . S (IBD,Z)="" F  S Z=$O(^IBM(361.1,"B",IBIFN,Z),-1) Q:'Z  I $P($G(^IBM(361.1,Z,0)),U,4)=1 S IBD=$$DATE^IBJU1($P($P(^IBM(361.1,Z,0),U,6),".")) Q
"RTN","IBJTCA1",92,0)
 F Z=IBLN:1:IBGRPE S IBLN=$$SET("","",IBLN,5)
"RTN","IBJTCA1",93,0)
 ;
"RTN","IBJTCA1",94,0)
 S (IBLN,VALMCNT)=$S(IBLN>IBGRPE:IBLN,1:IBGRPE)
"RTN","IBJTCA1",95,0)
 ;
"RTN","IBJTCA1",96,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",97,0)
 D CONT^IBJTCA2
"RTN","IBJTCA1",98,0)
 ;
"RTN","IBJTCA1",99,0)
 S (IBLN,VALMCNT)=IBLN-1
"RTN","IBJTCA1",100,0)
 ;
"RTN","IBJTCA1",101,0)
BLDQ Q
"RTN","IBJTCA1",102,0)
 ;
"RTN","IBJTCA1",103,0)
EMPL(DFN) ; returns employer name
"RTN","IBJTCA1",104,0)
 Q $P($G(^DPT(+DFN,.311)),U,1)
"RTN","IBJTCA1",105,0)
 ;
"RTN","IBJTCA1",106,0)
SET(TTL,DATA,LN,LR) ;
"RTN","IBJTCA1",107,0)
 N IBY
"RTN","IBJTCA1",108,0)
 S IBY=$J(TTL,IBTW(LR))_DATA D SET1(IBY,LN,IBTC(LR),(IBTW(LR)+IBSW(LR)))
"RTN","IBJTCA1",109,0)
 S LN=LN+1
"RTN","IBJTCA1",110,0)
 Q LN
"RTN","IBJTCA1",111,0)
 ;
"RTN","IBJTCA1",112,0)
SETN(TTL,LN,LR,RV) ;
"RTN","IBJTCA1",113,0)
 N IBY
"RTN","IBJTCA1",114,0)
 S IBY=" "_TTL_" " D SET1(IBY,LN,IBNC(LR),$L(IBY),$G(RV))
"RTN","IBJTCA1",115,0)
 S LN=LN+1
"RTN","IBJTCA1",116,0)
 Q LN
"RTN","IBJTCA1",117,0)
 ;
"RTN","IBJTCA1",118,0)
SET1(STR,LN,COL,WD,RV) ; set up TMP array with screen data
"RTN","IBJTCA1",119,0)
 N IBX S IBX=$G(^TMP("IBJTCA",$J,LN,0))
"RTN","IBJTCA1",120,0)
 S IBX=$$SETSTR^VALM1(STR,IBX,COL,WD)
"RTN","IBJTCA1",121,0)
 D SET^VALM10(LN,IBX) I $G(RV)'="" D CNTRL^VALM10(LN,COL,WD,IORVON,IORVOFF)
"RTN","IBJTCA1",122,0)
 Q
"RTN","IBJTLA1")
0^25^B7038251
"RTN","IBJTLA1",1,0)
IBJTLA1 ;ALB/ARH - TPI ACTIVE BILLS LIST BUILD ;2/14/95
"RTN","IBJTLA1",2,0)
 ;;2.0;INTEGRATED BILLING;**39,80,61,51,153,137,183,276**;21-MAR-94
"RTN","IBJTLA1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBJTLA1",4,0)
 ;
"RTN","IBJTLA1",5,0)
BLDA ; build active list for third party joint inquiry active list
"RTN","IBJTLA1",6,0)
 N IBIFN,IBCNT S VALMCNT=0,IBCNT=0
"RTN","IBJTLA1",7,0)
 S IBIFN=0 F  S IBIFN=$O(^DGCR(399,"C",DFN,IBIFN)) Q:'IBIFN  I $$ACTIVE^IBJTU4(IBIFN) W "." D SCRN
"RTN","IBJTLA1",8,0)
 ;
"RTN","IBJTLA1",9,0)
 I VALMCNT=0 D SET(" ",0),SET("No Active Bills for this Patient",0)
"RTN","IBJTLA1",10,0)
 ;
"RTN","IBJTLA1",11,0)
 Q
"RTN","IBJTLA1",12,0)
 ;
"RTN","IBJTLA1",13,0)
SCRN ; add bill to screen list (IBIFN,DFN must be defined)
"RTN","IBJTLA1",14,0)
 N X,IBY,IBD0,IBDU,IBDM S X=""
"RTN","IBJTLA1",15,0)
 S IBCNT=IBCNT+1,IBD0=$G(^DGCR(399,+IBIFN,0)),IBDU=$G(^DGCR(399,+IBIFN,"U")),IBDM=$G(^DGCR(399,+IBIFN,"M"))
"RTN","IBJTLA1",16,0)
 S IBY=IBCNT,X=$$SETFLD^VALM1(IBY,X,"NUMBER")
"RTN","IBJTLA1",17,0)
 S IBY=$P(IBD0,U,1)_$$ECME^IBTRE(IBIFN),X=$$SETFLD^VALM1(IBY,X,"BILL")
"RTN","IBJTLA1",18,0)
 S IBY=$S($$REF^IBJTU31(+IBIFN):"r",1:""),X=$$SETFLD^VALM1(IBY,X,"REFER")
"RTN","IBJTLA1",19,0)
 S IBY=$S($$IB^IBRUTL(+IBIFN,0):"*",1:""),X=$$SETFLD^VALM1(IBY,X,"HD")
"RTN","IBJTLA1",20,0)
 S IBY=$$DATE($P(IBDU,U,1)),X=$$SETFLD^VALM1(IBY,X,"STFROM")
"RTN","IBJTLA1",21,0)
 S IBY=$$DATE($P(IBDU,U,2)),X=$$SETFLD^VALM1(IBY,X,"STTO")
"RTN","IBJTLA1",22,0)
 ;
"RTN","IBJTLA1",23,0)
 S IBY=$P($$LST^DGMTU(DFN,$P(IBDU,U)),U,4),IBY=$S(IBY="C":"YES",IBY="P":"PEN",IBY="R":"REQ",IBY="G":"GMT",1:"NO"),X=$$SETFLD^VALM1(IBY,X,"MT?")
"RTN","IBJTLA1",24,0)
 S IBY=$$TYPE($P(IBD0,U,5))_$$TF($P(IBD0,U,6)),X=$$SETFLD^VALM1(IBY,X,"TYPE")
"RTN","IBJTLA1",25,0)
 S IBY=" "_$P($$ARSTATA^IBJTU4(IBIFN),U,2),X=$$SETFLD^VALM1(IBY,X,"ARST")
"RTN","IBJTLA1",26,0)
 ;
"RTN","IBJTLA1",27,0)
 S IBY=$P($G(^DGCR(399.3,+$P(IBD0,U,7),0)),U,4),X=$$SETFLD^VALM1(IBY,X,"RATE")
"RTN","IBJTLA1",28,0)
 S IBY=$S($$MINS^IBJTU31(+IBIFN):"+",1:""),X=$$SETFLD^VALM1(IBY,X,"CB")
"RTN","IBJTLA1",29,0)
 S IBY=+$G(^DGCR(399,+IBIFN,"MP"))
"RTN","IBJTLA1",30,0)
 I 'IBY,$$MCRWNR^IBEFUNC($$CURR^IBCEF2(IBIFN)) S IBY=+$$CURR^IBCEF2(IBIFN)
"RTN","IBJTLA1",31,0)
 S IBY=$P($G(^DIC(36,+IBY,0)),U,1)
"RTN","IBJTLA1",32,0)
 S X=$$SETFLD^VALM1(IBY,X,"INSUR")
"RTN","IBJTLA1",33,0)
 S IBY=$$BILL^RCJIBFN2(IBIFN)
"RTN","IBJTLA1",34,0)
 S X=$$SETFLD^VALM1($J(+$P(IBY,U,1),8,2),X,"OAMT")
"RTN","IBJTLA1",35,0)
 S X=$$SETFLD^VALM1($J(+$P(IBY,U,3),8,2),X,"CAMT")
"RTN","IBJTLA1",36,0)
 D SET(X,IBCNT)
"RTN","IBJTLA1",37,0)
 Q
"RTN","IBJTLA1",38,0)
 ;
"RTN","IBJTLA1",39,0)
DATE(X) ; date in external format
"RTN","IBJTLA1",40,0)
 N Y S Y="" I X?7N.E S Y=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBJTLA1",41,0)
 Q Y
"RTN","IBJTLA1",42,0)
 ;
"RTN","IBJTLA1",43,0)
TYPE(X) ; return abbreviated form of Bill Classification (399,.05)
"RTN","IBJTLA1",44,0)
 Q $S(X=1:"IP",X=2:"IH",X=3:"OP",X=4:"OH",1:"")
"RTN","IBJTLA1",45,0)
 ;
"RTN","IBJTLA1",46,0)
TF(X) ; return abbreviated form of Timeframe of Bill (399,.06)
"RTN","IBJTLA1",47,0)
 Q $S(X=2:"-F",X=3:"-C",X=4:"-L",X'=1:"-O",1:"")
"RTN","IBJTLA1",48,0)
 ;
"RTN","IBJTLA1",49,0)
SET(X,CNT) ; set up list manager screen array
"RTN","IBJTLA1",50,0)
 S VALMCNT=VALMCNT+1
"RTN","IBJTLA1",51,0)
 S ^TMP("IBJTLA",$J,VALMCNT,0)=X Q:'CNT
"RTN","IBJTLA1",52,0)
 S ^TMP("IBJTLA",$J,"IDX",VALMCNT,+CNT)=""
"RTN","IBJTLA1",53,0)
 S ^TMP("IBJTLAX",$J,CNT)=VALMCNT_U_IBIFN
"RTN","IBJTLA1",54,0)
 Q
"RTN","IBJTLA1",55,0)
 ;
"RTN","IBJTLB1")
0^20^B10448877
"RTN","IBJTLB1",1,0)
IBJTLB1 ;ALB/ARH - TPI INACTIVE LIST BUILD ;2/14/95
"RTN","IBJTLB1",2,0)
 ;;2.0;INTEGRATED BILLING;**39,80,61,137,276**;21-MAR-94
"RTN","IBJTLB1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBJTLB1",4,0)
 ;
"RTN","IBJTLB1",5,0)
BLDA ; build active list for third party joint inquiry active list, DFN must be defined
"RTN","IBJTLB1",6,0)
 ; first search starts at dt and works backwards for 6 months of bills or IBMAXCNT bills, whichever is greater
"RTN","IBJTLB1",7,0)
 ; all bills for a single day are included in the same search so even IBMAXCNT may be exceeded
"RTN","IBJTLB1",8,0)
 ; if IBEND is defined on entry it is used as the end dt of the search, otherwise DT is used
"RTN","IBJTLB1",9,0)
 ; IBBEG is left defined on exit, if it has a value then it is used by the Change Dates action to define the next
"RTN","IBJTLB1",10,0)
 ; end date of the search, this results in each CD action default working backwards through the date range until
"RTN","IBJTLB1",11,0)
 ; no bills are found and IBBEG is null then search restarts at DT, IBEND is defined so can tell if range changed
"RTN","IBJTLB1",12,0)
 N IBIFN,IBCNT,IBBDT,IBEDT,IBFIRST,IBLAST,IBDT1,IBDT2,IBMAXCNT K IBHMSG
"RTN","IBJTLB1",13,0)
 S IBEDT=$S(+$G(IBEND):IBEND,1:DT),IBBDT=$$FMADD^XLFDT(IBEDT,-180),IBMAXCNT=52
"RTN","IBJTLB1",14,0)
 ;
"RTN","IBJTLB1",15,0)
 S (VALMCNT,IBCNT)=0,IBDT1=$S(IBEDT'="":-(IBEDT+.01),1:""),IBDT2=-IBBDT
"RTN","IBJTLB1",16,0)
 S IBFIRST=IBBDT,IBLAST=-$O(^DGCR(399,"APDS",DFN,""))
"RTN","IBJTLB1",17,0)
 ;
"RTN","IBJTLB1",18,0)
 F  S IBDT1=$O(^DGCR(399,"APDS",DFN,IBDT1)) Q:'IBDT1!(IBDT1>IBDT2&(IBCNT'<IBMAXCNT))  S IBFIRST=-IBDT1 D
"RTN","IBJTLB1",19,0)
 . S IBIFN=0 F  S IBIFN=$O(^DGCR(399,"APDS",DFN,IBDT1,IBIFN)) Q:'IBIFN  I '$$ACTIVE^IBJTU4(IBIFN) D SCRN W "."
"RTN","IBJTLB1",20,0)
 ;
"RTN","IBJTLB1",21,0)
 S IBBEG=$S('IBDT1:"",IBBDT>IBFIRST:IBFIRST,1:IBBDT),IBBDT=$S(+IBBEG:$$DATE(IBBEG),1:"BEGIN")
"RTN","IBJTLB1",22,0)
 S IBEND=$S(IBEDT=""!(IBLAST'>IBEDT):"",1:IBEDT),IBEDT=$S(+IBEND:$$DATE(IBEND),1:"END")
"RTN","IBJTLB1",23,0)
 ;
"RTN","IBJTLB1",24,0)
 I 'IBBEG,'IBEND S IBHMSG="** All Inactive Bills **"
"RTN","IBJTLB1",25,0)
 I $G(IBHMSG)="" S IBHMSG=IBBDT_" - "_IBEDT
"RTN","IBJTLB1",26,0)
 S IBHMSG=IBHMSG_"   ("_VALMCNT_")"
"RTN","IBJTLB1",27,0)
 ;
"RTN","IBJTLB1",28,0)
 I VALMCNT=0 D SET(" ",0),SET("No Inactive Bills for this Patient",0)
"RTN","IBJTLB1",29,0)
 ;
"RTN","IBJTLB1",30,0)
 Q
"RTN","IBJTLB1",31,0)
 ;
"RTN","IBJTLB1",32,0)
SCRN ; add bill to screen list (IBIFN,DFN must be defined)
"RTN","IBJTLB1",33,0)
 N X,IBY,IBD0,IBDU,IBDM S X=""
"RTN","IBJTLB1",34,0)
 S IBCNT=IBCNT+1,IBD0=$G(^DGCR(399,+IBIFN,0)),IBDU=$G(^DGCR(399,+IBIFN,"U")),IBDM=$G(^DGCR(399,+IBIFN,"M"))
"RTN","IBJTLB1",35,0)
 S IBY=IBCNT,X=$$SETFLD^VALM1(IBY,X,"NUMBER")
"RTN","IBJTLB1",36,0)
 S IBY=$P(IBD0,U,1)_$$ECME^IBTRE(IBIFN),X=$$SETFLD^VALM1(IBY,X,"BILL")
"RTN","IBJTLB1",37,0)
        S IBY=$S($$REF^IBJTU31(+IBIFN):"r",1:""),X=$$SETFLD^VALM1(IBY,X,"REFER")
"RTN","IBJTLB1",38,0)
 S IBY=$S($$IB^IBRUTL(+IBIFN,0):"*",1:""),X=$$SETFLD^VALM1(IBY,X,"HD")
"RTN","IBJTLB1",39,0)
 S IBY=$$DATE($P(IBDU,U,1)),X=$$SETFLD^VALM1(IBY,X,"STFROM")
"RTN","IBJTLB1",40,0)
 S IBY=$$DATE($P(IBDU,U,2)),X=$$SETFLD^VALM1(IBY,X,"STTO")
"RTN","IBJTLB1",41,0)
 ;
"RTN","IBJTLB1",42,0)
 S IBY=$$TYPE($P(IBD0,U,5))_$$TF($P(IBD0,U,6)),X=$$SETFLD^VALM1(IBY,X,"TYPE")
"RTN","IBJTLB1",43,0)
 S IBY=" "_$P($$ARSTATA^IBJTU4(IBIFN),U,2),X=$$SETFLD^VALM1(IBY,X,"ARST")
"RTN","IBJTLB1",44,0)
 ;
"RTN","IBJTLB1",45,0)
 S IBY=$P($G(^DGCR(399.3,+$P(IBD0,U,7),0)),U,4),X=$$SETFLD^VALM1(IBY,X,"RATE")
"RTN","IBJTLB1",46,0)
 S IBY=$S($$MINS^IBJTU31(IBIFN):"+",1:""),X=$$SETFLD^VALM1(IBY,X,"CB")
"RTN","IBJTLB1",47,0)
 S IBY=+$G(^DGCR(399,+IBIFN,"MP"))
"RTN","IBJTLB1",48,0)
 I 'IBY,$$MCRWNR^IBEFUNC(+$$CURR^IBCEF2(IBIFN)) S IBY=+$$CURR^IBCEF2(IBIFN)
"RTN","IBJTLB1",49,0)
 S IBY=$P($G(^DIC(36,+IBY,0)),U,1),X=$$SETFLD^VALM1(IBY,X,"INSUR")
"RTN","IBJTLB1",50,0)
 S IBY=$$BILL^RCJIBFN2(IBIFN)
"RTN","IBJTLB1",51,0)
 S X=$$SETFLD^VALM1($J(+$P(IBY,U,1),8,2),X,"OAMT")
"RTN","IBJTLB1",52,0)
 S X=$$SETFLD^VALM1($J(+$P(IBY,U,3),8,2),X,"CAMT")
"RTN","IBJTLB1",53,0)
 D SET(X,IBCNT)
"RTN","IBJTLB1",54,0)
 Q
"RTN","IBJTLB1",55,0)
 ;
"RTN","IBJTLB1",56,0)
DATE(X) ; date in external format
"RTN","IBJTLB1",57,0)
 Q $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBJTLB1",58,0)
 ;
"RTN","IBJTLB1",59,0)
TYPE(X) ; return abbreviated form of Bill Classification (399,.05)
"RTN","IBJTLB1",60,0)
 Q $S(X=1:"IP",X=2:"IH",X=3:"OP",X=4:"OH",1:"")
"RTN","IBJTLB1",61,0)
 ;
"RTN","IBJTLB1",62,0)
TF(X) ; return abbreviated form of Timeframe of Bill (399,.06)
"RTN","IBJTLB1",63,0)
 Q $S(X=2:"-F",X=3:"-C",X=4:"-L",X'=1:"-O",1:"")
"RTN","IBJTLB1",64,0)
 ;
"RTN","IBJTLB1",65,0)
SET(X,CNT) ; set up list manager screen array
"RTN","IBJTLB1",66,0)
 S VALMCNT=VALMCNT+1
"RTN","IBJTLB1",67,0)
 S ^TMP("IBJTLB",$J,VALMCNT,0)=X Q:'CNT
"RTN","IBJTLB1",68,0)
 S ^TMP("IBJTLB",$J,"IDX",VALMCNT,+CNT)=""
"RTN","IBJTLB1",69,0)
 S ^TMP("IBJTLBX",$J,CNT)=VALMCNT_U_IBIFN
"RTN","IBJTLB1",70,0)
 Q
"RTN","IBJTU1")
0^15^B6991546
"RTN","IBJTU1",1,0)
IBJTU1 ;ALB/ARH - TPI UTILITIES ;2/14/95
"RTN","IBJTU1",2,0)
 ;;2.0;INTEGRATED BILLING;**39,80,276**;21-MAR-94
"RTN","IBJTU1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBJTU1",4,0)
 ;
"RTN","IBJTU1",5,0)
PRVSCR(SCRNARR) ; called as part of a screen ACTION PROTOCOL'S ENTRY ACTION to determine if screen has already been displayed
"RTN","IBJTU1",6,0)
 ; returns true if screen array already exists (ie. already displayed), 
"RTN","IBJTU1",7,0)
 ; setting IBFASTXT causes LM to back out of current screens,
"RTN","IBJTU1",8,0)
 ; setting IBPRVSCR causes LM to stop exiting screens when the chosen screen is reached
"RTN","IBJTU1",9,0)
 ; if user tries to execute a screen already displayed it will quit out of existing screens until the asked for screen is found
"RTN","IBJTU1",10,0)
 N X S X=0,IBPRVSCR="" I $G(SCRNARR)'="",$D(^TMP(SCRNARR,$J)) S X=1,IBPRVSCR=SCRNARR,IBFASTXT=3
"RTN","IBJTU1",11,0)
 Q X
"RTN","IBJTU1",12,0)
 ;
"RTN","IBJTU1",13,0)
HDR(IBIFN,DFN,LNS) ; called by a screens's LIST TEMPLATE HEADER to get lines for header, used for all TP screens
"RTN","IBJTU1",14,0)
 ;input:  LNS=header lines to add  ---  defined on exit: VALMHDR array
"RTN","IBJTU1",15,0)
 ;
"RTN","IBJTU1",16,0)
 N X,Y,Z,IBD0,IBPD0,IBDI1,IBCNT S IBIFN=+$G(IBIFN),DFN=+$G(DFN),LNS=+$G(LNS) K VALMHDR
"RTN","IBJTU1",17,0)
 S IBCNT=0,IBD0=$G(^DGCR(399,+IBIFN,0)),IBPD0=$G(^DPT(+DFN,0))
"RTN","IBJTU1",18,0)
 S IBDI1=$P(IBD0,U,21),IBDI1=$S(IBDI1="S":"I2",IBDI1="T":"I3",1:"I1"),IBDI1=$G(^DGCR(399,+IBIFN,IBDI1))
"RTN","IBJTU1",19,0)
 ;
"RTN","IBJTU1",20,0)
1 I LNS'[1 G 2
"RTN","IBJTU1",21,0)
 ; -- first line of screens: BILL NUMBER, PAT NAME, PAT ID, DOB, SUBSCRIBER ID
"RTN","IBJTU1",22,0)
 N IBBILL,IBPAT,IBPATID,IBDOB,IBSUB,IBPNWDTH S IBCNT=IBCNT+1,(IBSUB,IBPATID)=""
"RTN","IBJTU1",23,0)
 S IBBILL=$P(IBD0,U,1)_$$ECME^IBTRE(IBIFN)
"RTN","IBJTU1",24,0)
 S X=$$PT^IBEFUNC(DFN),IBPAT=$P(X,U,1) I $P(X,U,3)'="" S IBPATID=$E(X)_$P(X,U,3)
"RTN","IBJTU1",25,0)
 S IBDOB="DOB: "_$$DATE^IBJU1($P(IBPD0,U,3))
"RTN","IBJTU1",26,0)
 I +IBIFN S X=$P(IBDI1,U,2),X=X_$J("",(13-$L(X))),IBSUB="Subsc ID: "_X
"RTN","IBJTU1",27,0)
 ;
"RTN","IBJTU1",28,0)
 S IBPNWDTH=80-($L(IBBILL)+3+2+$L(IBPATID)+3+$L(IBDOB)+3+$L(IBSUB)),IBPAT=$E(IBPAT,1,IBPNWDTH),Z="   "
"RTN","IBJTU1",29,0)
 S VALMHDR(IBCNT)=IBBILL_Z_IBPAT_"  "_IBPATID_$J("",(IBPNWDTH-$L(IBPAT)))_Z_IBDOB_Z_IBSUB
"RTN","IBJTU1",30,0)
 ;
"RTN","IBJTU1",31,0)
2 I LNS'[2 G 3
"RTN","IBJTU1",32,0)
 ; -- bill screens line 2: STATEMENT DATES, TIMEFRAME, ORIG AMT (AR)
"RTN","IBJTU1",33,0)
 N IBDU S IBCNT=IBCNT+1,IBDU=$G(^DGCR(399,+IBIFN,"U"))
"RTN","IBJTU1",34,0)
 S X=" "_$$DATE^IBJU1(+IBDU)_" - "_$$DATE^IBJU1(+$P(IBDU,U,2)),VALMHDR(IBCNT)=X_$J("",(28-$L(X)))
"RTN","IBJTU1",35,0)
 S X=$$EXSET^IBJU1(+$P(IBD0,U,6),399,.06),VALMHDR(IBCNT)=VALMHDR(IBCNT)_X_$J("",(29-$L(X)))
"RTN","IBJTU1",36,0)
 S X=$$BILL^RCJIBFN2(IBIFN),X="Orig Amt: "_$FN($P(X,U,1),",",2),VALMHDR(IBCNT)=VALMHDR(IBCNT)_X
"RTN","IBJTU1",37,0)
 ;
"RTN","IBJTU1",38,0)
3 I LNS'[3 G HDRQ
"RTN","IBJTU1",39,0)
 ; -- AR screens line 2: CURRENT STATUS (AR), ORIGINAL AMT (AR), CURRENT AMT (AR)
"RTN","IBJTU1",40,0)
 N IBST,IBOC,IBBD,IBY S IBCNT=IBCNT+1,IBY=$$BILL^RCJIBFN2(+IBIFN)
"RTN","IBJTU1",41,0)
 S IBST="AR Status: "_$P($$ARSTATA^IBJTU4(+IBIFN),U,1)
"RTN","IBJTU1",42,0)
 S IBOC="Orig Amt: "_$FN($P(IBY,U,1),",",2)
"RTN","IBJTU1",43,0)
 S IBBD="Balance Due: "_$FN($P(IBY,U,3),",",2)
"RTN","IBJTU1",44,0)
 ;
"RTN","IBJTU1",45,0)
 S X="  "_IBOC_$J("",(20-$L(IBOC)))_" "_IBBD_$J("",(23-$L(IBBD))),Y=80-$L(X),IBST=$E(IBST,1,Y)
"RTN","IBJTU1",46,0)
 S VALMHDR(IBCNT)=IBST_$J("",(Y-$L(IBST)))_X
"RTN","IBJTU1",47,0)
 ;
"RTN","IBJTU1",48,0)
HDRQ Q
"RTN","IBJTU2")
0^38^B10627973
"RTN","IBJTU2",1,0)
IBJTU2 ;ALB/ARH - TPI UTILITIES ;6/6/03 1:05pm
"RTN","IBJTU2",2,0)
 ;;2.0;INTEGRATED BILLING;**39,106,199,211,276**;21-MAR-94
"RTN","IBJTU2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBJTU2",4,0)
 ;
"RTN","IBJTU2",5,0)
PAT() ; select patient, only allows patient's that have bills - returns DFN^NAME if patient selected, 0 otherwise
"RTN","IBJTU2",6,0)
 N X,Y,DFN,DTOUT,DUOUT,DA
"RTN","IBJTU2",7,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBJTU2",8,0)
 S DFN=0,DIC(0)="AEQM",DIC="^DPT(",DIC("S")="I $D(^DGCR(399,""C"",Y))" D ^DIC K DIC I Y'<1 S DFN=Y
"RTN","IBJTU2",9,0)
 Q DFN
"RTN","IBJTU2",10,0)
 ;
"RTN","IBJTU2",11,0)
BILL() ; select bill, returns bill IFN^BILL NUMBER or 0 if none selected
"RTN","IBJTU2",12,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBJTU2",13,0)
 N X,Y,DTOUT,DUOUT,DA,IBY S IBY=0,DIC="^DGCR(399,",DIC(0)="AEMQ" D ^DIC K DIC I Y'<1 S IBY=Y
"RTN","IBJTU2",14,0)
 Q IBY
"RTN","IBJTU2",15,0)
 ;
"RTN","IBJTU2",16,0)
PB() ; select either a patient name (must have a bill) or bill number
"RTN","IBJTU2",17,0)
 ; if patient chosen: returns "1^"_DFN, if bill chosen: returns "2^"_IBIFN, 0 otherwise
"RTN","IBJTU2",18,0)
 N IBX,IBY,DIC,DTOUT,DUOUT,DA,X,Y,DPTNOFZY,IBSTR
"RTN","IBJTU2",19,0)
 S IBY=0
"RTN","IBJTU2",20,0)
 ;
"RTN","IBJTU2",21,0)
PB1 R !!,"Enter BILL NUMBER or PATIENT NAME: ",IBX:DTIME I IBX["^"!(IBX="") G PBQ
"RTN","IBJTU2",22,0)
 ;
"RTN","IBJTU2",23,0)
 I $E(IBX)="?" D  G PB1
"RTN","IBJTU2",24,0)
 . W !
"RTN","IBJTU2",25,0)
 . W !,"   Enter one of following: Patient Name, Bill Number,"
"RTN","IBJTU2",26,0)
 . W !,"   ECME Number or Prescription Number."
"RTN","IBJTU2",27,0)
 . W !,"   You may also use prefixes: 'E.' for ECME# or 'R.' for Prescription."
"RTN","IBJTU2",28,0)
 . W !
"RTN","IBJTU2",29,0)
 ;
"RTN","IBJTU2",30,0)
 ; search for patient name
"RTN","IBJTU2",31,0)
 I IBX?1A4N!(IBX?2A.AP)!(IBX?2.A1",".AP)!(IBX?1A1P.AP) D  I IBY G PBQ
"RTN","IBJTU2",32,0)
 . S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBJTU2",33,0)
 . S DIC="^DPT(",DIC(0)="EQM",DIC("S")="I $D(^DGCR(399,""C"",Y))",X=IBX D ^DIC K DIC I Y'<1 S IBY="1^"_+Y
"RTN","IBJTU2",34,0)
 ;
"RTN","IBJTU2",35,0)
 ; search for bill number
"RTN","IBJTU2",36,0)
 I (IBX?1A1.7AN)!(IBX?3N1"-"1A1.7AN)!(IBX?1"`"1.15N)!(IBX=" ") D  I IBY G PBQ
"RTN","IBJTU2",37,0)
 . S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBJTU2",38,0)
 . S IBSTR=IBX
"RTN","IBJTU2",39,0)
 . I $L(IBSTR,"-")=2,$P(IBSTR,"-")?3N S IBSTR=$P(IBX,"-",2,255)
"RTN","IBJTU2",40,0)
 . S DIC="^DGCR(399,",DIC(0)="EQ",X=IBSTR D ^DIC K DIC I Y'<1 S IBY="2^"_+Y
"RTN","IBJTU2",41,0)
 ;
"RTN","IBJTU2",42,0)
 ; search for ECME number REC^IBRFN()
"RTN","IBJTU2",43,0)
 S IBSTR=IBX
"RTN","IBJTU2",44,0)
 I IBSTR?1.7N S IBSTR="E."_IBSTR
"RTN","IBJTU2",45,0)
 I IBSTR?1"E."1.7N S Y=$$REC^IBRFN(IBSTR) I Y>0 S IBY="2^"_+Y G PBQ
"RTN","IBJTU2",46,0)
 ;
"RTN","IBJTU2",47,0)
 ; search for RX number REC^IBRFN()
"RTN","IBJTU2",48,0)
 S IBSTR=IBX
"RTN","IBJTU2",49,0)
 I IBSTR?1N1.10AN S IBSTR="R."_IBSTR
"RTN","IBJTU2",50,0)
 I IBSTR?1"R."1N1.10AN S Y=$$REC^IBRFN(IBSTR) I Y>0 S IBY="2^"_+Y G PBQ
"RTN","IBJTU2",51,0)
 ;
"RTN","IBJTU2",52,0)
 W "??"
"RTN","IBJTU2",53,0)
 G PB1
"RTN","IBJTU2",54,0)
PBQ Q IBY
"RTN","IBJTU2",55,0)
 ;
"RTN","IBJTU2",56,0)
RCANC(IBIFN,ARR,WDTH) ; if bill cancelled returns ARR = IBIFN ^ PTR TO 200 ^ INITIALS OF WHO CANCELLED IN IB
"RTN","IBJTU2",57,0)
 ;                                        ARR(X) = REASON CANCELLED   with line width passed in
"RTN","IBJTU2",58,0)
 N X,DIWL,DIWR,DIWF,IBDS,IBCNT,IBI,IBD K ARR
"RTN","IBJTU2",59,0)
 S ARR=0,IBIFN=+$G(IBIFN),IBDS=$G(^DGCR(399,IBIFN,"S"))
"RTN","IBJTU2",60,0)
 S X=$P(IBDS,U,18) G:'X RCANCQ
"RTN","IBJTU2",61,0)
 S ARR=IBIFN_U_X_U_$P($G(^VA(200,+X,0)),U,2)
"RTN","IBJTU2",62,0)
 S X=$P(IBDS,U,19) G:X="" RCANCQ
"RTN","IBJTU2",63,0)
 S DIWL=1,DIWR=$G(WDTH),DIWF="" D ^DIWP
"RTN","IBJTU2",64,0)
 S (IBCNT,IBI)=0,DIWL=1 F  S IBI=$O(^UTILITY($J,"W",DIWL,IBI)) Q:'IBI  D
"RTN","IBJTU2",65,0)
 . S IBD=$G(^UTILITY($J,"W",DIWL,IBI,0)) I IBD'="" S IBCNT=IBCNT+1,ARR(IBCNT)=IBD
"RTN","IBJTU2",66,0)
 K ^UTILITY($J,"W")
"RTN","IBJTU2",67,0)
RCANCQ Q
"RTN","IBJTU2",68,0)
 ;
"RTN","IBJTU2",69,0)
DR(DB,DE) ; get a date range from the user, DB is default begin date (FM), DE is default end date
"RTN","IBJTU2",70,0)
 ; returns "begin dt ^ end dt" in FM format, or "" if two valid dates are not entered
"RTN","IBJTU2",71,0)
 N IBY,IBX,%DT,X,Y S (IBX,IBY)="" I $G(DB)?7N S %DT("B")=$$FMTE^XLFDT(DB,2)
"RTN","IBJTU2",72,0)
 S %DT="AEX",%DT("A")="Start Date: " D ^%DT K %DT G:Y<0 DRQ S IBX=Y
"RTN","IBJTU2",73,0)
 S %DT(0)=IBX,%DT("B")=$$FMTE^XLFDT($S(IBX>$G(DE):IBX,1:DE),2)
"RTN","IBJTU2",74,0)
 S %DT="AEX",%DT("A")="End Date: " D ^%DT K %DT G:Y<0 DRQ S IBY=IBX_U_Y
"RTN","IBJTU2",75,0)
DRQ Q IBY
"RTN","IBNCPBB")
0^6^B87290144
"RTN","IBNCPBB",1,0)
IBNCPBB ;DALOI/AAT - ECME BACKBILLING ;24-JUN-2003
"RTN","IBNCPBB",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPBB",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPBB",4,0)
 ;
"RTN","IBNCPBB",5,0)
 ;
"RTN","IBNCPBB",6,0)
 Q
"RTN","IBNCPBB",7,0)
EN ; [IB GENERATE ECME RX BILLS] entry
"RTN","IBNCPBB",8,0)
 N IBMOD1,IBMOD3,IBPAT,IBRX,IBBDT,IBEDT,IBSEL,IBREF,IBPAUSE
"RTN","IBNCPBB",9,0)
 S IBREF=$NA(^TMP($J,"IBNCPBB"))
"RTN","IBNCPBB",10,0)
 S IBPAUSE=1
"RTN","IBNCPBB",11,0)
 K @IBREF D
"RTN","IBNCPBB",12,0)
 . N IBEXIT
"RTN","IBNCPBB",13,0)
 . S IBEXIT=0
"RTN","IBNCPBB",14,0)
 . D MODE I IBEXIT Q
"RTN","IBNCPBB",15,0)
 . I IBMOD1="P" D SELECT I IBEXIT Q
"RTN","IBNCPBB",16,0)
 . I IBMOD1="R" D SELECT2 I IBEXIT Q
"RTN","IBNCPBB",17,0)
 . D CONFIRM I IBEXIT Q
"RTN","IBNCPBB",18,0)
 . D PROCESS I IBEXIT Q
"RTN","IBNCPBB",19,0)
 I IBPAUSE W ! D PAUSE()
"RTN","IBNCPBB",20,0)
 K @IBREF
"RTN","IBNCPBB",21,0)
 Q
"RTN","IBNCPBB",22,0)
 ;
"RTN","IBNCPBB",23,0)
CT(IBTRN) ; CT ENTRY
"RTN","IBNCPBB",24,0)
 N IBZ,IBRX,IBRXN,IBFL,IBEXIT,IBPAT,IBRDT,IBFDT,IBRES,IBBIL,IBBN,IBQ,IBSCRES
"RTN","IBNCPBB",25,0)
 S IBQ=0
"RTN","IBNCPBB",26,0)
 D FULL^VALM1
"RTN","IBNCPBB",27,0)
 W !!,"This option sends electronic Pharmacy Claims to the Payer"
"RTN","IBNCPBB",28,0)
 S VALMBCK="R"
"RTN","IBNCPBB",29,0)
 S IBZ=$G(^IBT(356,IBTRN,0)) Q:IBZ=""
"RTN","IBNCPBB",30,0)
 S IBRX=$P(IBZ,U,8),IBFL=$P(IBZ,U,10)
"RTN","IBNCPBB",31,0)
 I 'IBRX D  Q
"RTN","IBNCPBB",32,0)
 . W !!,"This is not a Pharmacy Claims Tracking record",*7,!
"RTN","IBNCPBB",33,0)
 . D PAUSE("Cannot submit to ECME")
"RTN","IBNCPBB",34,0)
 ;
"RTN","IBNCPBB",35,0)
 ; Release date:
"RTN","IBNCPBB",36,0)
 I IBFL=0 S IBRDT=$P($G(^PSRX(IBRX,2)),U,13)
"RTN","IBNCPBB",37,0)
 E  S IBRDT=$P($G(^PSRX(IBRX,1,IBFL,0)),U,18)
"RTN","IBNCPBB",38,0)
 I 'IBRDT D  Q
"RTN","IBNCPBB",39,0)
 . W !!,"The Prescription is not released.",!
"RTN","IBNCPBB",40,0)
 . D PAUSE("Cannot submit to ECME")
"RTN","IBNCPBB",41,0)
 ;
"RTN","IBNCPBB",42,0)
 S IBPAT=$P(IBZ,U,2)
"RTN","IBNCPBB",43,0)
 I $$SC($P(IBZ,U,19)) D  Q:IBQ
"RTN","IBNCPBB",44,0)
 . N DIR,DIE,DA,DR,Y
"RTN","IBNCPBB",45,0)
 . W !!,"The Rx is marked 'non-billable' in CT: ",$P($G(^IBE(356.8,+$P(IBZ,U,19),0)),U)
"RTN","IBNCPBB",46,0)
 . W !,"If you continue, the NON-BILLABLE REASON will be deleted.",!
"RTN","IBNCPBB",47,0)
 . S DIR(0)="Y",DIR("A")="Are you sure you want to bill this episode"
"RTN","IBNCPBB",48,0)
 . S DIR("B")="NO"
"RTN","IBNCPBB",49,0)
 . S DIR("?")="If you want to bill this Rx, enter 'Yes' - otherwise, enter 'No'"
"RTN","IBNCPBB",50,0)
 . W ! D ^DIR K DIR
"RTN","IBNCPBB",51,0)
 . I 'Y S IBQ=1 Q
"RTN","IBNCPBB",52,0)
 . S DIE="^IBT(356,",DA=IBTRN,DR=".19///@" D ^DIE ;clean NB reason
"RTN","IBNCPBB",53,0)
 . S IBSCRES(IBRX,IBFL)=1 ; sc resolved flag
"RTN","IBNCPBB",54,0)
 ;
"RTN","IBNCPBB",55,0)
 S IBZ=$G(^IBT(356,IBTRN,0)) ; refresh
"RTN","IBNCPBB",56,0)
 I $P(IBZ,U,19) D  Q
"RTN","IBNCPBB",57,0)
 . W !!,"The Prescription is marked 'non-billable' in Claims Tracking",*7
"RTN","IBNCPBB",58,0)
 . W !,"Reason non-billable: ",$P($G(^IBE(356.8,+$P(IBZ,U,19),0),"Unknown"),U),!
"RTN","IBNCPBB",59,0)
 . D PAUSE("Cannot submit to ECME")
"RTN","IBNCPBB",60,0)
 ; Fill/Refill Date:
"RTN","IBNCPBB",61,0)
 S IBFDT=$S('IBFL:$P($G(^PSRX(IBRX,2)),U,2),1:$P($G(^PSRX(IBRX,1,IBFL,0)),U))
"RTN","IBNCPBB",62,0)
 ; Is the patient billable at the released date?
"RTN","IBNCPBB",63,0)
 S IBRES=$$ECMEBIL^IBNCPDPU(IBPAT,IBFDT)
"RTN","IBNCPBB",64,0)
 I 'IBRES D  Q
"RTN","IBNCPBB",65,0)
 . W !!,"The patient is not ECME Billable at the ",$S(IBFL:"re",1:""),"fill date."
"RTN","IBNCPBB",66,0)
 . W !,"Reason: ",$P(IBRES,U,2,255),!
"RTN","IBNCPBB",67,0)
 . D PAUSE("Cannot submit to ECME")
"RTN","IBNCPBB",68,0)
 ;
"RTN","IBNCPBB",69,0)
 S IBRXN=$P(^PSRX(IBRX,0),U)
"RTN","IBNCPBB",70,0)
 S IBBIL=$$BILL(IBRXN,IBRDT)
"RTN","IBNCPBB",71,0)
 I IBBIL,'$P($G(^DGCR(399,IBBIL,"S")),U,16) D  Q
"RTN","IBNCPBB",72,0)
 . W !!,"Rx# ",IBRXN," was previously billed."
"RTN","IBNCPBB",73,0)
 . W !,"Please manually cancel the bill# ",$P($G(^DGCR(399,IBBIL,0)),U)," before submitting claim to ECME.",!
"RTN","IBNCPBB",74,0)
 . D PAUSE("Cannot submit to ECME")
"RTN","IBNCPBB",75,0)
 I IBBIL W !,"The bill# ",$P($G(^DGCR(399,IBBIL,0)),U)," has been cancelled.",!
"RTN","IBNCPBB",76,0)
 ;
"RTN","IBNCPBB",77,0)
 D CONFRX(IBRXN) Q:$G(IBEXIT)
"RTN","IBNCPBB",78,0)
 ;
"RTN","IBNCPBB",79,0)
 W !!,"Submitting Rx# ",IBRXN W:IBFL ", Refill# ",IBFL W " ..."
"RTN","IBNCPBB",80,0)
 S IBRES=$$SUBMIT^IBNCPDPU(IBRX,IBFL) W !,"  ",$S(+IBRES=0:"S",1:"Not s")_"ent through ECME."
"RTN","IBNCPBB",81,0)
 I +IBRES'=0 W !,"  *** ECME returned status: ",$$STAT(IBRES),!
"RTN","IBNCPBB",82,0)
 I +IBRES=0 W !!,"The Rx have been submitted to ECME for electronic billing",!
"RTN","IBNCPBB",83,0)
 D PAUSE()
"RTN","IBNCPBB",84,0)
 Q
"RTN","IBNCPBB",85,0)
 ;
"RTN","IBNCPBB",86,0)
MODE ;
"RTN","IBNCPBB",87,0)
 ; IBMOD1: "P"-Single Patient, "R"-Single Rx
"RTN","IBNCPBB",88,0)
 ; IBMOD3 (if IBMOD1="P"): "U"-Unbilled, "A"-All Rx
"RTN","IBNCPBB",89,0)
 ; IBPAT (if IBMOD1="P"): Patient's DFN
"RTN","IBNCPBB",90,0)
 ; IBBDT,IBEDT (if IBMOD1="P"): From/To dates inclusive
"RTN","IBNCPBB",91,0)
 N DIR,DIC,DIRUT,DUOUT,Y
"RTN","IBNCPBB",92,0)
 S (IBMOD1,IBMOD3)=""
"RTN","IBNCPBB",93,0)
 S DIR(0)="S^P:SINGLE (P)ATIENT;R:SINGLE (R)X"
"RTN","IBNCPBB",94,0)
 S DIR("A")="SINGLE (P)ATIENT, SINGLE (R)X"
"RTN","IBNCPBB",95,0)
 S DIR("B")="P"
"RTN","IBNCPBB",96,0)
 D ^DIR K DIR I $D(DIRUT) S IBEXIT=1,IBPAUSE=0 Q
"RTN","IBNCPBB",97,0)
 S IBMOD1=Y
"RTN","IBNCPBB",98,0)
 ; Enter Rx
"RTN","IBNCPBB",99,0)
 I IBMOD1="R" W ! S DIC="^PSRX(",DIC(0)="AEQMN" D ^DIC S:$D(DUOUT) IBEXIT=1 S IBRX=$S(Y>0:+Y,1:0) S:IBRX="" IBEXIT=1,IBPAUSE=0
"RTN","IBNCPBB",100,0)
 I IBMOD1="R" Q
"RTN","IBNCPBB",101,0)
 ;
"RTN","IBNCPBB",102,0)
 I IBMOD1'="P" W !,"???" S IBEXIT=1 Q  ; Invalid mode
"RTN","IBNCPBB",103,0)
 ; Enter the Patient
"RTN","IBNCPBB",104,0)
 S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC S:$D(DUOUT) IBEXIT=1 S IBPAT=$S(Y>0:+Y,1:0) S:'IBPAT IBEXIT=1,IBPAUSE=0
"RTN","IBNCPBB",105,0)
 Q:IBEXIT
"RTN","IBNCPBB",106,0)
 I '$$ECMEBIL^IBNCPDPU(IBPAT,DT) W *7,!!,"Warning! The patient is currently not ECME billable!"
"RTN","IBNCPBB",107,0)
 ;
"RTN","IBNCPBB",108,0)
 D DATE I IBEXIT S IBPAUSE=0 Q
"RTN","IBNCPBB",109,0)
 ;
"RTN","IBNCPBB",110,0)
 S DIR(0)="S^U:UNBILLED;A:ALL RX"
"RTN","IBNCPBB",111,0)
 S DIR("A")="(U)NBILLED, (A)LL RX"
"RTN","IBNCPBB",112,0)
 S DIR("B")="U"
"RTN","IBNCPBB",113,0)
 D ^DIR K DIR I $D(DIRUT) S IBEXIT=1,IBPAUSE=0 Q
"RTN","IBNCPBB",114,0)
 S IBMOD3=Y
"RTN","IBNCPBB",115,0)
 Q
"RTN","IBNCPBB",116,0)
 ;
"RTN","IBNCPBB",117,0)
 ;begin/end date
"RTN","IBNCPBB",118,0)
DATE ;
"RTN","IBNCPBB",119,0)
 N Y,%DT
"RTN","IBNCPBB",120,0)
 S (IBBDT,IBEDT)=DT
"RTN","IBNCPBB",121,0)
 W !
"RTN","IBNCPBB",122,0)
 S %DT="AEX"
"RTN","IBNCPBB",123,0)
 S %DT("A")="START WITH DATE: ",%DT("B")="TODAY"
"RTN","IBNCPBB",124,0)
 D ^%DT K %DT
"RTN","IBNCPBB",125,0)
 I Y'>0 S IBEXIT=1 Q
"RTN","IBNCPBB",126,0)
 S IBBDT=+Y
"RTN","IBNCPBB",127,0)
 S %DT="AEX"
"RTN","IBNCPBB",128,0)
 S %DT("A")="GO TO DATE: ",%DT("B")="TODAY" ;$$DAT2^IBOUTL(IBBDT)
"RTN","IBNCPBB",129,0)
 D ^%DT K %DT
"RTN","IBNCPBB",130,0)
 I Y'>0 S IBEXIT=1 Q
"RTN","IBNCPBB",131,0)
 S IBEDT=+Y
"RTN","IBNCPBB",132,0)
 Q
"RTN","IBNCPBB",133,0)
 ;
"RTN","IBNCPBB",134,0)
SELECT ; Select from the patient's list
"RTN","IBNCPBB",135,0)
 ; (IBPAT,IBBDT,IBEDT,IBMOD3)
"RTN","IBNCPBB",136,0)
 N IBD,IBRX,IBZ,IBDATA,IBCNT,Y
"RTN","IBNCPBB",137,0)
 S IBCNT=0
"RTN","IBNCPBB",138,0)
 S IBD=$O(^PSRX("AL",IBBDT),-1)
"RTN","IBNCPBB",139,0)
 F  S IBD=$O(^PSRX("AL",IBD)) Q:'IBD  Q:$P(IBD,".")>$P(IBEDT,".")  D
"RTN","IBNCPBB",140,0)
 . S IBRX=0 F  S IBRX=$O(^PSRX("AL",IBD,IBRX)) Q:'IBRX  D
"RTN","IBNCPBB",141,0)
 .. S IBZ=$G(^PSRX(IBRX,0)) Q:IBZ=""
"RTN","IBNCPBB",142,0)
 .. I $P(IBZ,U,2)'=IBPAT Q
"RTN","IBNCPBB",143,0)
 .. I '$P($G(^PSRX(IBRX,2)),U,13) Q  ; not released
"RTN","IBNCPBB",144,0)
 .. S IBDATA=$$RXDATA(IBRX,0)
"RTN","IBNCPBB",145,0)
 .. I ('$P(IBDATA,U,6))!(IBMOD3="A") S IBCNT=IBCNT+1,@IBREF@(IBCNT)=IBDATA
"RTN","IBNCPBB",146,0)
 .. ; Now process refill(s)
"RTN","IBNCPBB",147,0)
 .. S Y=0 F  S Y=$O(^PSRX(IBRX,1,Y)) Q:'Y  D:$P($G(^PSRX(IBRX,1,Y,0)),U,18)
"RTN","IBNCPBB",148,0)
 ... S IBDATA=$$RXDATA(IBRX,Y)
"RTN","IBNCPBB",149,0)
 ... I $P(IBDATA,U,6),IBMOD3'="A" Q  ; unbilled only
"RTN","IBNCPBB",150,0)
 ... S IBCNT=IBCNT+1,@IBREF@(IBCNT)=IBDATA
"RTN","IBNCPBB",151,0)
 ..
"RTN","IBNCPBB",152,0)
 D MKCHOICE
"RTN","IBNCPBB",153,0)
 Q
"RTN","IBNCPBB",154,0)
SELECT2 ; Select from the Rx (and refills) list
"RTN","IBNCPBB",155,0)
 ; (IBRX)
"RTN","IBNCPBB",156,0)
 N IBCNT,Y
"RTN","IBNCPBB",157,0)
 W ! S IBPAUSE=1
"RTN","IBNCPBB",158,0)
 I '$D(^PSRX(IBRX,0)) W !,"The Rx does not exist. Please try again." S IBEXIT=1 Q
"RTN","IBNCPBB",159,0)
 I '$P($G(^PSRX(IBRX,2)),U,13) W !,"The Rx has not been released. Please try again." S IBEXIT=1 Q
"RTN","IBNCPBB",160,0)
 S IBCNT=1,@IBREF@(IBCNT)=$$RXDATA(IBRX,0)
"RTN","IBNCPBB",161,0)
 S Y=0 F  S Y=$O(^PSRX(IBRX,1,Y)) Q:'Y  D:$P($G(^PSRX(IBRX,1,Y,0)),U,18)
"RTN","IBNCPBB",162,0)
 . S IBCNT=IBCNT+1,@IBREF@(IBCNT)=$$RXDATA(IBRX,Y)
"RTN","IBNCPBB",163,0)
 D MKCHOICE
"RTN","IBNCPBB",164,0)
 Q
"RTN","IBNCPBB",165,0)
 ;
"RTN","IBNCPBB",166,0)
MKCHOICE ; Make choice
"RTN","IBNCPBB",167,0)
 N Y
"RTN","IBNCPBB",168,0)
 ; display the collected data
"RTN","IBNCPBB",169,0)
 W !
"RTN","IBNCPBB",170,0)
 S Y=0 F  S Y=$O(@IBREF@(Y)) Q:'Y  D DISP(Y)
"RTN","IBNCPBB",171,0)
 ;
"RTN","IBNCPBB",172,0)
 I $O(@IBREF@(0))="" S IBEXIT=1 W !!," No Rxs meet the entered criteria. Please try again." Q
"RTN","IBNCPBB",173,0)
 I $O(@IBREF@(""),-1)=1 S IBSEL(1)="" Q  ; one item only
"RTN","IBNCPBB",174,0)
 F  W !!,"Enter Line Item(s) to submit to ECME or (A)LL :" R IBSEL:DTIME S:'$T IBEXIT=1 Q:IBEXIT  Q:IBSEL'["?"  D
"RTN","IBNCPBB",175,0)
 . W !?10,"Enter number(s) or item range(s) separated by comma."
"RTN","IBNCPBB",176,0)
 . W !?10,"Example: 1,3,7-11"
"RTN","IBNCPBB",177,0)
 Q:IBEXIT
"RTN","IBNCPBB",178,0)
 I IBSEL'="",$TR(IBSEL,"al","AL")=$E("ALL",1,$L(IBSEL)),$L(IBSEL)<3 W $E("ALL",$L(IBSEL)+1,3) S IBSEL="ALL"
"RTN","IBNCPBB",179,0)
 I IBSEL="" S IBEXIT=1 W " Nothing selected" Q
"RTN","IBNCPBB",180,0)
 I IBSEL="^" S IBEXIT=1 W " Cancelled" Q
"RTN","IBNCPBB",181,0)
 ; Now collect the required into the IBSEL(i) local array
"RTN","IBNCPBB",182,0)
 D PARSE(.IBSEL)
"RTN","IBNCPBB",183,0)
 I $O(IBSEL(0))="" S IBEXIT=1 W !!,"No item(s) match the selection." Q
"RTN","IBNCPBB",184,0)
 Q
"RTN","IBNCPBB",185,0)
 ;
"RTN","IBNCPBB",186,0)
CONFIRM ;
"RTN","IBNCPBB",187,0)
 N DIR,Y
"RTN","IBNCPBB",188,0)
 W !
"RTN","IBNCPBB",189,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Submit the selected RX(s) to ECME for electronic billing"
"RTN","IBNCPBB",190,0)
 D ^DIR I Y'=1 S IBEXIT=1
"RTN","IBNCPBB",191,0)
 Q
"RTN","IBNCPBB",192,0)
 ;
"RTN","IBNCPBB",193,0)
CONFRX(IBRX) ;
"RTN","IBNCPBB",194,0)
 N DIR,Y
"RTN","IBNCPBB",195,0)
 W !
"RTN","IBNCPBB",196,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Submit the Rx# "_IBRX_" to ECME for electronic billing"
"RTN","IBNCPBB",197,0)
 D ^DIR I Y'=1 S IBEXIT=1
"RTN","IBNCPBB",198,0)
 Q
"RTN","IBNCPBB",199,0)
 ;
"RTN","IBNCPBB",200,0)
STAT(X) ;
"RTN","IBNCPBB",201,0)
 I +X<6 Q $P(X,"^",2)
"RTN","IBNCPBB",202,0)
 Q "Unknown Status"
"RTN","IBNCPBB",203,0)
 ;
"RTN","IBNCPBB",204,0)
PROCESS ;
"RTN","IBNCPBB",205,0)
 N RES,IBY,IBD,IBRX,IBFIL,IBERR,IBBIL
"RTN","IBNCPBB",206,0)
 S IBERR=0
"RTN","IBNCPBB",207,0)
 S IBY=0 F  S IBY=$O(IBSEL(IBY)) Q:'IBY  D
"RTN","IBNCPBB",208,0)
 . S IBD=$G(@IBREF@(IBY)) Q:IBD=""
"RTN","IBNCPBB",209,0)
 . S IBRX=$P(IBD,U),IBFIL=+$P(IBD,U,3),IBBIL=$P(IBD,U,6)
"RTN","IBNCPBB",210,0)
 . W !,"Submitting Rx# ",$P(IBD,U,2) W:IBFIL "Refill# ",IBFIL W:'IBFIL " (original fill)" W " ..."
"RTN","IBNCPBB",211,0)
 . I IBBIL,'$P($G(^DGCR(399,IBBIL,"S")),U,16) D  S IBERR=IBERR+1 Q
"RTN","IBNCPBB",212,0)
 .. W !," *** Rx# ",$P(IBD,U,2)," was previously billed."
"RTN","IBNCPBB",213,0)
 .. W !," Please cancel the Bill No ",$P($G(^DGCR(399,IBBIL,0)),U)," before submitting the claim"
"RTN","IBNCPBB",214,0)
 . S RES=$$SUBMIT^IBNCPDPU(IBRX,IBFIL) W "  ",$S(+RES=0:"Sent through ECME",1:"Not sent")
"RTN","IBNCPBB",215,0)
 . I +RES'=0 W !?5,"*** ECME returned status: ",$$STAT(RES) S IBERR=IBERR+1
"RTN","IBNCPBB",216,0)
 I 'IBERR W !!,"The selected Rx(s) have been submitted to ECME",!,"for electronic billing"
"RTN","IBNCPBB",217,0)
 Q
"RTN","IBNCPBB",218,0)
 ;
"RTN","IBNCPBB",219,0)
BILL(IBRXN,IBDT) ; Bill IEN (if any) or null
"RTN","IBNCPBB",220,0)
 N RES,X,IBZ
"RTN","IBNCPBB",221,0)
 S IBDT=$P(IBDT,".")
"RTN","IBNCPBB",222,0)
 S RES=""
"RTN","IBNCPBB",223,0)
 S X="" F  S X=$O(^IBA(362.4,"B",IBRXN,X),-1) Q:X=""  D:X  Q:RES
"RTN","IBNCPBB",224,0)
 . S IBZ=$G(^IBA(362.4,X,0))
"RTN","IBNCPBB",225,0)
 . I $P($P(IBZ,U,3),".")=IBDT,$P(IBZ,U,2) S RES=+$P(IBZ,U,2)
"RTN","IBNCPBB",226,0)
 Q RES
"RTN","IBNCPBB",227,0)
 ;
"RTN","IBNCPBB",228,0)
 ;
"RTN","IBNCPBB",229,0)
RXDATA(IBRX,IBFIL) ;Collect Rx-related data
"RTN","IBNCPBB",230,0)
 ;RxIEN^Rx#^Fill#^RelDate^DrugIEN^BillIEN
"RTN","IBNCPBB",231,0)
 N IBRXN,IBDT,IBDRUG,IBBIL
"RTN","IBNCPBB",232,0)
 S IBRXN=$P($G(^PSRX(IBRX,0)),U) ; Rx Number
"RTN","IBNCPBB",233,0)
 I IBFIL=0 S IBDT=$P($G(^PSRX(IBRX,2)),U,2) ;Fill
"RTN","IBNCPBB",234,0)
 E  S IBDT=$P($G(^PSRX(IBRX,1,IBFIL,0)),U)
"RTN","IBNCPBB",235,0)
 S IBDT=$P(IBDT,".")
"RTN","IBNCPBB",236,0)
 S IBDRUG=+$P($G(^PSRX(IBRX,0)),U,6) ;Drug IEN
"RTN","IBNCPBB",237,0)
 S IBBIL=$$BILL(IBRXN,IBDT)
"RTN","IBNCPBB",238,0)
 Q IBRX_U_IBRXN_U_IBFIL_U_IBDT_U_IBDRUG_U_IBBIL
"RTN","IBNCPBB",239,0)
 ;
"RTN","IBNCPBB",240,0)
DISP(IBITEM) ;
"RTN","IBNCPBB",241,0)
 N IBD,IBBILN,IBDRUG,IBBIL
"RTN","IBNCPBB",242,0)
 S IBD=$G(@IBREF@(IBITEM)) Q:IBD=""
"RTN","IBNCPBB",243,0)
 W !,IBITEM," ",?4,$P(IBD,U,2)," ",?15,$P(IBD,U,3)," ",?20,$$DAT2^IBOUTL($P(IBD,U,4))," "
"RTN","IBNCPBB",244,0)
 W ?32,$E($P($G(^PSDRUG(+$P(IBD,U,5),0)),U),1,30)
"RTN","IBNCPBB",245,0)
 S IBBIL=$P(IBD,U,6)
"RTN","IBNCPBB",246,0)
 I IBBIL W ?64,$P($G(^DGCR(399,+IBBIL,0)),U) I $P($G(^DGCR(399,IBBIL,"S")),U,16) W "(canc)"
"RTN","IBNCPBB",247,0)
 Q
"RTN","IBNCPBB",248,0)
 ;
"RTN","IBNCPBB",249,0)
PARSE(X) ;Parse the input
"RTN","IBNCPBB",250,0)
 N I,J,N
"RTN","IBNCPBB",251,0)
 S X=$TR(X," ")
"RTN","IBNCPBB",252,0)
 S X=$TR(X,";",",")
"RTN","IBNCPBB",253,0)
 I $TR(IBSEL,"al","AL")="ALL" D  Q
"RTN","IBNCPBB",254,0)
 . F I=1:1 Q:'$D(@IBREF@(I))  S IBSEL(I)=""
"RTN","IBNCPBB",255,0)
 F I=1:1:$L(X,",") S N=$P(X,",",I) D:N'=""
"RTN","IBNCPBB",256,0)
 . I N'["-" D:N  Q
"RTN","IBNCPBB",257,0)
 . . I $D(@IBREF@(N)) S X(N)=""
"RTN","IBNCPBB",258,0)
 . ; Processing the range
"RTN","IBNCPBB",259,0)
 . N N1,N2
"RTN","IBNCPBB",260,0)
 . S N1=+$P(N,"-",1),N2=+$P(N,"-",2)
"RTN","IBNCPBB",261,0)
 . F J=N1:$S(N2<N1:-1,1:1):N2 I $D(@IBREF@(J)) S X(J)=""
"RTN","IBNCPBB",262,0)
 Q
"RTN","IBNCPBB",263,0)
 ;
"RTN","IBNCPBB",264,0)
PAUSE(MESSAGE) ;
"RTN","IBNCPBB",265,0)
 W !
"RTN","IBNCPBB",266,0)
 I $G(MESSAGE)'="" W MESSAGE,". "
"RTN","IBNCPBB",267,0)
 W "Press RETURN to continue: "
"RTN","IBNCPBB",268,0)
 R %:DTIME
"RTN","IBNCPBB",269,0)
 Q
"RTN","IBNCPBB",270,0)
 ;
"RTN","IBNCPBB",271,0)
SC(IEN) ; Service connected?
"RTN","IBNCPBB",272,0)
 N IBT
"RTN","IBNCPBB",273,0)
 I 'IEN Q 0
"RTN","IBNCPBB",274,0)
 S IBT=$P($G(^IBE(356.8,IEN,0)),U)
"RTN","IBNCPBB",275,0)
 I IBT="NEEDS SC DETERMINATION" Q 1
"RTN","IBNCPBB",276,0)
 I IBT="OTHER" Q 1
"RTN","IBNCPBB",277,0)
 ;
"RTN","IBNCPBB",278,0)
 Q 0
"RTN","IBNCPDP")
0^44^B1650924
"RTN","IBNCPDP",1,0)
IBNCPDP ;OAK/ELZ - APIS FOR NCPCP/ECME ;10-JUN-2003
"RTN","IBNCPDP",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276**;21-MAR-94
"RTN","IBNCPDP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDP",4,0)
 ;
"RTN","IBNCPDP",5,0)
 ;
"RTN","IBNCPDP",6,0)
RX(DFN,IBD) ; pharmacy package call, passing in IBD by ref
"RTN","IBNCPDP",7,0)
 ; this is called by PSO for all prescriptions issued, return is
"RTN","IBNCPDP",8,0)
 ; a responce to bill ECME or not with array for billing data elements
"RTN","IBNCPDP",9,0)
 ;
"RTN","IBNCPDP",10,0)
 ; IBD("IEN")         = Prescription IEN
"RTN","IBNCPDP",11,0)
 ;    ("FILL NUMBER") = Fill number (0 is initial)
"RTN","IBNCPDP",12,0)
 ;    ("FILL DATE")   = Fill or refill date
"RTN","IBNCPDP",13,0)
 ;    ("RELEASE DATE")= Date of the Rx release in FileMan format
"RTN","IBNCPDP",14,0)
 ;    ("NDC")         = NDC number for drug
"RTN","IBNCPDP",15,0)
 ;    ("DEA")         = DEA special handling info
"RTN","IBNCPDP",16,0)
 ;    ("COST")        = cost of medication being dispenced
"RTN","IBNCPDP",17,0)
 ;    ("AO")          = Agent Orange (0,1 OR Null)
"RTN","IBNCPDP",18,0)
 ;    ("EC")          = Environmental Contaminant (0,1 OR Null)
"RTN","IBNCPDP",19,0)
 ;    ("HNC")         = Head/neck cancer (0,1 OR Null)
"RTN","IBNCPDP",20,0)
 ;    ("IR")          = Ionizing radiation (0,1 OR Null)
"RTN","IBNCPDP",21,0)
 ;    ("MST")         = Military sexual trauma (0,1 OR Null)
"RTN","IBNCPDP",22,0)
 ;    ("SC")          = Service connected (0,1 OR Null)
"RTN","IBNCPDP",23,0)
 ;    ("CV")          = Combat Veteran (0,1 OR Null)
"RTN","IBNCPDP",24,0)
 ;    ("QTY")         = Quantity of med
"RTN","IBNCPDP",25,0)
 ;
"RTN","IBNCPDP",26,0)
 ;
"RTN","IBNCPDP",27,0)
 ; IBD("INS",n,1) = insurance array to bill in n order
"RTN","IBNCPDP",28,0)
 ;                  file 355.3 ien (group)^bin^pcn^payer sheet^group id^
"RTN","IBNCPDP",29,0)
 ;                  cardholder id^patient relationship code^
"RTN","IBNCPDP",30,0)
 ;                  cardholder first name^cardholder last name^
"RTN","IBNCPDP",31,0)
 ;                  home plan state
"RTN","IBNCPDP",32,0)
 ;    ("INS",n,2) = dispensing fee^basis of cost determination^
"RTN","IBNCPDP",33,0)
 ;                  awp or tort rate or cost^gross amount due^
"RTN","IBNCPDP",34,0)
 ;                  administrative fee
"RTN","IBNCPDP",35,0)
 ;
"RTN","IBNCPDP",36,0)
 ;   for basis of cost determination the following is used:
"RTN","IBNCPDP",37,0)
 ;      "07" would be sent for Usual & Customary
"RTN","IBNCPDP",38,0)
 ;      "01" would be sent for AWP
"RTN","IBNCPDP",39,0)
 ;      "05" would be sent for Cost calculations
"RTN","IBNCPDP",40,0)
 ;
"RTN","IBNCPDP",41,0)
 ;    ("INS",n,3) = group name^insurance co^phone number^plan ID
"RTN","IBNCPDP",42,0)
 N IBRES,IBNB
"RTN","IBNCPDP",43,0)
 S IBRES=$$RX^IBNCPDP1(DFN,.IBD)
"RTN","IBNCPDP",44,0)
 ;remove "Not ECME billable: " from the reason text
"RTN","IBNCPDP",45,0)
 S IBNB="Not ECME billable: "
"RTN","IBNCPDP",46,0)
 I IBRES[IBNB S IBRES=$P(IBRES,U)_U_$P($P(IBRES,U,2),IBNB,2)
"RTN","IBNCPDP",47,0)
 Q IBRES
"RTN","IBNCPDP",48,0)
 ;
"RTN","IBNCPDP",49,0)
 ;
"RTN","IBNCPDP",50,0)
STORESP(DFN,IBD) ; this is an API for pharmacy/ecme to use to relay
"RTN","IBNCPDP",51,0)
 ; results of billing using the ecme software.  If electronic billing is
"RTN","IBNCPDP",52,0)
 ; successful, then bills will be established.  If not, then we will
"RTN","IBNCPDP",53,0)
 ; flag the entry in ct for paper or not billable.
"RTN","IBNCPDP",54,0)
 ;
"RTN","IBNCPDP",55,0)
 ; IBD("STATUS")       = Bill status (PAID, REJECTED,REVERSED
"RTN","IBNCPDP",56,0)
 ;                        CLOSED,RELEASED,or SUBMITTED)
"RTN","IBNCPDP",57,0)
 ;    ("FILL DATE")    = Fill Date
"RTN","IBNCPDP",58,0)
 ;    ("PRESCRIPTION") = Prescription IEN from drug file (#52)
"RTN","IBNCPDP",59,0)
 ;    ("FILL NUMBER")  = Fill or refill number
"RTN","IBNCPDP",60,0)
 ;    ("BILLED")       = Amount billed
"RTN","IBNCPDP",61,0)
 ;    ("PAID")         = Amount paid
"RTN","IBNCPDP",62,0)
 ;    ("BCID")         = Reference number to the claim for payment
"RTN","IBNCPDP",63,0)
 ;                       BCID stands for Bill Claim ID
"RTN","IBNCPDP",64,0)
 ;    ("PLAN")         = IEN of the the entry in the GROUP INSURANCE 
"RTN","IBNCPDP",65,0)
 ;                       PLAN file(#355.3)(captured from the 
"RTN","IBNCPDP",66,0)
 ;                       $$RX^IBNCPDP call)
"RTN","IBNCPDP",67,0)
 ;    ("COPAY")        = Patient's copay from ECME response
"RTN","IBNCPDP",68,0)
 ;    ("RX NO")        = RX number from file 52
"RTN","IBNCPDP",69,0)
 ;    ("DRUG")         = IEN of file #50 DRUG
"RTN","IBNCPDP",70,0)
 ;    ("DAYS SUPPLY")  = Days Supply
"RTN","IBNCPDP",71,0)
 ;    ("QTY")          = Quantity
"RTN","IBNCPDP",72,0)
 ;    ("NDC")          = NDC
"RTN","IBNCPDP",73,0)
 ;    ("CLOSE REASON") = Optional, Pointer to the IB file #356.8 
"RTN","IBNCPDP",74,0)
 ;                      "CLAIMS TRACKING NON-BILLABLE REASONS"
"RTN","IBNCPDP",75,0)
 ;    ("CLOSE COMMENT")= Optional, if the close reason is defined 
"RTN","IBNCPDP",76,0)
 ;                       then the Close Comment parameter may be 
"RTN","IBNCPDP",77,0)
 ;                       sent to IB
"RTN","IBNCPDP",78,0)
 ;    ("DROP TO PAPER")= Optional, this parameter may be set to 1(TRUE) 
"RTN","IBNCPDP",79,0)
 ;                       for certain Close Claim Reasons, indicating
"RTN","IBNCPDP",80,0)
 ;                       that that the closed episode still may be 
"RTN","IBNCPDP",81,0)
 ;                       "dropped to paper" - passed to the Autobiller
"RTN","IBNCPDP",82,0)
 ;    ("RELEASE COPAY")= Optional, if the claim is being closed, setting
"RTN","IBNCPDP",83,0)
 ;                       this parameter to 1 (TRUE) indicates that the
"RTN","IBNCPDP",84,0)
 ;                       patients copay should be released off hold
"RTN","IBNCPDP",85,0)
 ;    ("DIVISION")     = Pointer to the MC DIVISION file (#40.8)
"RTN","IBNCPDP",86,0)
 ;    ("AUTH #")       = ECME approval/authorization number
"RTN","IBNCPDP",87,0)
 ;    ("CLAIMID")      = Reference Number to ECME
"RTN","IBNCPDP",88,0)
 ;
"RTN","IBNCPDP",89,0)
 ;
"RTN","IBNCPDP",90,0)
 ; Return is the bill number for success or 1 if not billable.
"RTN","IBNCPDP",91,0)
 ; "0^reason" indicates not success
"RTN","IBNCPDP",92,0)
 ;
"RTN","IBNCPDP",93,0)
 Q $$ECME^IBNCPDP2(DFN,.IBD)
"RTN","IBNCPDP",94,0)
 ;
"RTN","IBNCPDP",95,0)
 ;
"RTN","IBNCPDP",96,0)
UPAWP(IBNDC,IBAWP,IBADT) ; used to update AWPs.  This is an API that
"RTN","IBNCPDP",97,0)
 ; pharmacy will call.
"RTN","IBNCPDP",98,0)
 ;
"RTN","IBNCPDP",99,0)
 ;  IBNDC = NDC number to update with the price.
"RTN","IBNCPDP",100,0)
 ;  IBAWP = average wholesale price of the NDC
"RTN","IBNCPDP",101,0)
 ;  IBADT  = effective date of change (optional, default it today)
"RTN","IBNCPDP",102,0)
 ;
"RTN","IBNCPDP",103,0)
 ;  return will be a positive number indicating success.
"RTN","IBNCPDP",104,0)
 ;  if it is unsuccessful, then "0^reason" will be returned.
"RTN","IBNCPDP",105,0)
 ;
"RTN","IBNCPDP",106,0)
 Q $$UPAWP^IBNCPDP3(IBNDC,IBAWP,$G(IBADT,DT))
"RTN","IBNCPDP",107,0)
 ;
"RTN","IBNCPDP",108,0)
 ;
"RTN","IBNCPDP1")
0^45^B52180701
"RTN","IBNCPDP1",1,0)
IBNCPDP1 ;OAK/ELZ - PROCESSING FOR NEW RX REQUESTS ;20-JUN-2003
"RTN","IBNCPDP1",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276**;21-MAR-94
"RTN","IBNCPDP1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDP1",4,0)
 ;
"RTN","IBNCPDP1",5,0)
 ;NCPDP PHASE III
"RTN","IBNCPDP1",6,0)
 Q
"RTN","IBNCPDP1",7,0)
 ;
"RTN","IBNCPDP1",8,0)
RX(DFN,IBD) ; pharmacy package call, passing in IBD by ref
"RTN","IBNCPDP1",9,0)
 ; this is called by PSO for all prescriptions issued, return is
"RTN","IBNCPDP1",10,0)
 ; a response to bill ECME or not with array for billing data elements
"RTN","IBNCPDP1",11,0)
 ;
"RTN","IBNCPDP1",12,0)
 ;warning: back-billing flag:
"RTN","IBNCPDP1",13,0)
 ;if passed IBSCRES(IBRXN,IBFIL)=1 
"RTN","IBNCPDP1",14,0)
 ; - the the SC Determination is just done by the IB clerk (billable)
"RTN","IBNCPDP1",15,0)
 ;
"RTN","IBNCPDP1",16,0)
 N IBTRKR,IBARR,IBADT,IBRXN,IBFIL,IBTRKRN,IBRMARK,IBANY,IBX,IBT,IBINS,IBSAVE,IBFEE,IBEABD,IBBI,IBIT,IBPRICE,IBRS,IBRT,IBTRN,IBCHG,IBERMSG,IBRES
"RTN","IBNCPDP1",17,0)
 S IBRES="0^Error"
"RTN","IBNCPDP1",18,0)
 K IBD("INS")
"RTN","IBNCPDP1",19,0)
 I '$G(DFN) S IBRES="0^No DFN" G RXQ
"RTN","IBNCPDP1",20,0)
 S (IBEABD,IBADT)=+$G(IBD("FILL DATE"),DT)
"RTN","IBNCPDP1",21,0)
 S IBRXN=+$G(IBD("IEN")) I 'IBRXN S IBRES="0^No Rx IEN" G RXQ
"RTN","IBNCPDP1",22,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBRES="0^No fill number" G RXQ
"RTN","IBNCPDP1",23,0)
 S IBD("QTY")=+$G(IBD("QTY"))
"RTN","IBNCPDP1",24,0)
 I 'IBD("QTY") S IBRES="0^No Quantity" G RXQ
"RTN","IBNCPDP1",25,0)
 ;
"RTN","IBNCPDP1",26,0)
 ; -- claims tracking info
"RTN","IBNCPDP1",27,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBNCPDP1",28,0)
 ; date can't be before parameters
"RTN","IBNCPDP1",29,0)
 S $P(IBTRKR,U)=$S('$P(IBTRKR,U,4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPDP1",30,0)
 ; already in claims tracking
"RTN","IBNCPDP1",31,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP1",32,0)
 I IBTRKRN,$$PAPERBIL(IBTRKRN) S IBRES="0^Existing IB Bill in CT" G RXQ
"RTN","IBNCPDP1",33,0)
 ;
"RTN","IBNCPDP1",34,0)
 I $G(IBD("DEA"))="" D CT S IBRES="0^Null DEA Special Handling field" G RXQ
"RTN","IBNCPDP1",35,0)
 ;
"RTN","IBNCPDP1",36,0)
 ; -- no pharmacy coverage, update ct if applicable, quit
"RTN","IBNCPDP1",37,0)
 I '$$PTCOV^IBCNSU3(DFN,IBADT,"PHARMACY",.IBANY) S IBRMARK=$S($G(IBANY):"SERVICE NOT COVERED",1:"NOT INSURED") D:$P(IBTRKR,U,4)=2 CT S IBRES="0^"_IBRMARK G RXQ
"RTN","IBNCPDP1",38,0)
 ;
"RTN","IBNCPDP1",39,0)
 ;
"RTN","IBNCPDP1",40,0)
 ;  -- check for compound,  NOT BILLABLE 
"RTN","IBNCPDP1",41,0)
 I IBD("DEA")["M"!(IBD("DEA")["0") S IBRMARK="DRUG NOT BILLABLE" D CT S IBRES="0^COMPOUND DRUG" G RXQ
"RTN","IBNCPDP1",42,0)
 ; -- check drug (not investigational, supply, or over the counter drug
"RTN","IBNCPDP1",43,0)
 ;  "E" means always ecme billable
"RTN","IBNCPDP1",44,0)
 I (IBD("DEA")["I"!(IBD("DEA")["S")!(IBD("DEA")["9")),IBD("DEA")'["E" S IBRMARK="DRUG NOT BILLABLE" D CT S IBRES="0^"_IBRMARK G RXQ
"RTN","IBNCPDP1",45,0)
 ;
"RTN","IBNCPDP1",46,0)
 ; -- process patient exemptions if any (if not already resolved)
"RTN","IBNCPDP1",47,0)
 D CL^SDCO21(DFN,IBADT,"",.IBARR)
"RTN","IBNCPDP1",48,0)
 ;
"RTN","IBNCPDP1",49,0)
 ; check out exemptions
"RTN","IBNCPDP1",50,0)
 I $D(IBARR)>9 F IBX=2:1 S IBT=$P($T(EXEMPT+IBX),";;",2) Q:IBT=""!($D(IBRMARK))  D:$D(IBARR(+IBT))
"RTN","IBNCPDP1",51,0)
 . I $G(IBD($P(IBT,U,2)))=0 Q
"RTN","IBNCPDP1",52,0)
 . I $G(IBD($P(IBT,U,2))) S IBRMARK=$P(IBT,U,3) Q
"RTN","IBNCPDP1",53,0)
 . I '$G(IBSCRES(IBRXN,IBFIL)) S IBRMARK="NEEDS SC DETERMINATION"
"RTN","IBNCPDP1",54,0)
 I $D(IBRMARK) D CT S IBRES="0^"_IBRMARK G RXQ
"RTN","IBNCPDP1",55,0)
 ; Clean-up the NEEDS SC DETERMINATION record if resolved
"RTN","IBNCPDP1",56,0)
 ; And check if it is non-billable in CT
"RTN","IBNCPDP1",57,0)
 I IBTRKRN D
"RTN","IBNCPDP1",58,0)
 . N IBNBR,IBNBRT
"RTN","IBNCPDP1",59,0)
 . S IBNBR=$P($G(^IBT(356,+IBTRKRN,0)),U,19) Q:'IBNBR
"RTN","IBNCPDP1",60,0)
 . S IBNBRT=$P($G(^IBE(356.8,IBNBR,0)),U) Q:IBNBRT=""
"RTN","IBNCPDP1",61,0)
 . ; if refill was deleted (not RX) and now the refill is re-entered
"RTN","IBNCPDP1",62,0)
 . ;use $$RXSTATUS^IBNCPRR insetad of $G(^PSRX(IBRXN,"STA"))
"RTN","IBNCPDP1",63,0)
 . I IBNBRT="PRESCRIPTION DELETED",$$RXSTATUS^IBNCPRR(DFN,IBRXN)'=13 D  Q
"RTN","IBNCPDP1",64,0)
 . . N DIE,DA,DR
"RTN","IBNCPDP1",65,0)
 . . ; clean up REASON NOT BILLABLE and ADDITIONAL COMMENT
"RTN","IBNCPDP1",66,0)
 . . S DIE="^IBT(356,",DA=+IBTRKRN,DR=".19////@;1.08////@" D ^DIE
"RTN","IBNCPDP1",67,0)
 . ; Clean up NBR if released
"RTN","IBNCPDP1",68,0)
 . I IBNBRT="PRESCRIPTION NOT RELEASED" D:$G(IBD("RELEASE DATE"))  Q
"RTN","IBNCPDP1",69,0)
 . . N DIE,DA,DR
"RTN","IBNCPDP1",70,0)
 . . S DIE="^IBT(356,",DA=+IBTRKRN,DR=".19////@" D ^DIE
"RTN","IBNCPDP1",71,0)
 . ; Clean up 'Needs SC determ'
"RTN","IBNCPDP1",72,0)
 . I IBNBRT="NEEDS SC DETERMINATION" D  Q
"RTN","IBNCPDP1",73,0)
 . . N DIE,DA,DR
"RTN","IBNCPDP1",74,0)
 . . S DIE="^IBT(356,",DA=+IBTRKRN,DR=".19////@" D ^DIE
"RTN","IBNCPDP1",75,0)
 . S IBRMARK=IBNBRT
"RTN","IBNCPDP1",76,0)
 I $D(IBRMARK) S IBRES="0^Non-Billable in CT: "_IBRMARK G RXQ
"RTN","IBNCPDP1",77,0)
 ;
"RTN","IBNCPDP1",78,0)
 ; -- look up insurance for patient
"RTN","IBNCPDP1",79,0)
 D ALL^IBCNS1(DFN,"IBINS",1,IBADT,1)
"RTN","IBNCPDP1",80,0)
 S IBERMSG="" ; Error message
"RTN","IBNCPDP1",81,0)
 S IBX=0 F  S IBX=$O(IBINS("S",IBX)) Q:'IBX  D
"RTN","IBNCPDP1",82,0)
 . S IBT=0 F  S IBT=$O(IBINS("S",IBX,IBT)) Q:'IBT  D
"RTN","IBNCPDP1",83,0)
 .. N IBDAT,IBPL,IBINSN,IBPIEN,IBY,IBZ
"RTN","IBNCPDP1",84,0)
 .. S IBZ=IBINS(IBT,0)
"RTN","IBNCPDP1",85,0)
 .. S IBPL=$P(IBZ,U,18) ; plan
"RTN","IBNCPDP1",86,0)
 .. Q:'IBPL
"RTN","IBNCPDP1",87,0)
 .. Q:'$$PLCOV^IBCNSU3(IBPL,IBADT,3)  ; not covered
"RTN","IBNCPDP1",88,0)
 .. S IBINSN=$P($G(^DIC(36,+$G(^IBA(355.3,+IBPL,0)),0)),U) ; ins name
"RTN","IBNCPDP1",89,0)
 .. S IBPIEN=+$G(^IBA(355.3,+IBPL,6))
"RTN","IBNCPDP1",90,0)
 .. I 'IBPIEN S IBERMSG="Plan not linked to the Payer" Q  ; Not linked
"RTN","IBNCPDP1",91,0)
 .. D STCHK^IBCNRU1(IBPIEN,.IBY)
"RTN","IBNCPDP1",92,0)
 .. I $E($G(IBY(1)))'="A" S IBERMSG=$$ERMSG($P($G(IBY(6)),",")) Q  ; not active
"RTN","IBNCPDP1",93,0)
 .. S IBDAT=IBPL ; Plan IEN
"RTN","IBNCPDP1",94,0)
 .. S $P(IBDAT,U,2)=$G(IBY(2)) ; BIN
"RTN","IBNCPDP1",95,0)
 .. S $P(IBDAT,U,3)=$G(IBY(3)) ; PCN
"RTN","IBNCPDP1",96,0)
 .. S $P(IBDAT,U,4)=$P($G(^BPSF(9002313.92,+$P($G(IBY(5)),",",1),0)),U) ; Payer Sheet B1
"RTN","IBNCPDP1",97,0)
 .. S $P(IBDAT,U,5)=$P($G(IBINS(IBT,355.3)),U,4) ; Group ID
"RTN","IBNCPDP1",98,0)
 .. S $P(IBDAT,U,6)=$P(IBZ,U,2) ; Cardholder ID
"RTN","IBNCPDP1",99,0)
 .. S $P(IBDAT,U,7)=$P(IBZ,U,16) ; Patient Relationship Code
"RTN","IBNCPDP1",100,0)
 .. S $P(IBDAT,U,8)=$P($P($P(IBZ,U,17),",",2)," ") ; Cardholder First Name
"RTN","IBNCPDP1",101,0)
 .. S $P(IBDAT,U,9)=$P($P(IBZ,U,17),",") ; Cardholder Last Name
"RTN","IBNCPDP1",102,0)
 .. S $P(IBDAT,U,10)=$P($G(^DIC(36,+IBZ,.11)),U,5) ; State
"RTN","IBNCPDP1",103,0)
 .. S $P(IBDAT,U,11)=$P($G(^BPSF(9002313.92,+$P($G(IBY(5)),",",2),0)),U) ; Payer Sheet B2
"RTN","IBNCPDP1",104,0)
 .. S $P(IBDAT,U,12)=$P($G(^BPSF(9002313.92,+$P($G(IBY(5)),",",3),0)),U) ; Payer Sheet B3
"RTN","IBNCPDP1",105,0)
 .. S $P(IBDAT,U,13)=$G(IBY(4)) ; Software/Vendor Cert ID
"RTN","IBNCPDP1",106,0)
 .. S $P(IBDAT,U,14)=IBINSN ; Ins Name
"RTN","IBNCPDP1",107,0)
 .. S IBD("INS",IBX,1)=IBDAT
"RTN","IBNCPDP1",108,0)
 .. S IBD("INS",IBX,3)=$P($G(IBINS(IBT,355.3)),"^",3)_"^"_$$PHONE(+IBZ)_"^"_$$GET1^DIQ(366.03,IBPIEN_",",.01)   ;group name^ins co ph 3^plan ID
"RTN","IBNCPDP1",109,0)
 I '$D(IBD("INS")),IBERMSG'="" S IBRES="0^Not ECME billable: "_IBERMSG G RXQ
"RTN","IBNCPDP1",110,0)
 I '$D(IBD("INS")) S IBRES="0^No Insurance ECME billable" G RXQ
"RTN","IBNCPDP1",111,0)
 ;
"RTN","IBNCPDP1",112,0)
 ; determine rates/prices to use
"RTN","IBNCPDP1",113,0)
 S IBRT=$$RT^IBNCPDPU(DFN,.IBINS)
"RTN","IBNCPDP1",114,0)
 I 'IBRT D CT S IBRES="0^Cannot determine Rate type" G RXQ
"RTN","IBNCPDP1",115,0)
 S IBBI=$$EVNTITM^IBCRU3(+IBRT,3,"PRESCRIPTION FILL",IBADT,.IBRS)
"RTN","IBNCPDP1",116,0)
 I 'IBBI D CT S IBRES="0^Cannot find Billable Item" G RXQ
"RTN","IBNCPDP1",117,0)
 ;1;BEDSECTION;1^
"RTN","IBNCPDP1",118,0)
 ;IBRS(1,18,5)=
"RTN","IBNCPDP1",119,0)
 S IBRS=+$O(IBRS(+IBBI,0))
"RTN","IBNCPDP1",120,0)
 S IBIT=$$ITPTR^IBCRU2(+IBBI,$S($P(IBRT,U,2)="A":$$NDC^IBNCPDPU($G(IBD("NDC"))),1:"PRESCRIPTION"))
"RTN","IBNCPDP1",121,0)
 I 'IBIT,$P(IBRT,U,2)'="C" D CT S IBRES="0^Cannot find Item Pointer" G RXQ
"RTN","IBNCPDP1",122,0)
 ;8
"RTN","IBNCPDP1",123,0)
 S IBPRICE=+$$BICOST^IBCRCI(+IBRT,3,IBADT,"PRESCRIPTION FILL",+IBIT,,,$S($P(IBRT,U,2)="A":IBD("QTY"),1:1))
"RTN","IBNCPDP1",124,0)
 ;36^2991001
"RTN","IBNCPDP1",125,0)
 ;
"RTN","IBNCPDP1",126,0)
 ; get fees if any, ignore return, don't care about price, just need fees
"RTN","IBNCPDP1",127,0)
 S IBCHG=$$RATECHG^IBCRCC(+IBRS,$S($P(IBRT,U,2)'="C":1,1:IBD("QTY")*IBD("COST")),IBADT,.IBFEE)
"RTN","IBNCPDP1",128,0)
 I $P(IBRT,U,2)="C" S IBPRICE=+IBCHG
"RTN","IBNCPDP1",129,0)
 ;
"RTN","IBNCPDP1",130,0)
 I 'IBPRICE D CT S IBRES="0^Cannot find price for Item" G RXQ
"RTN","IBNCPDP1",131,0)
 ;
"RTN","IBNCPDP1",132,0)
 S IBPRICE=(+$G(IBFEE))_U_$S($P(IBRT,U,2)="A":"01",$P(IBRT,U,2)="C":"05",1:"07")_U_$S($P(IBRT,U,2)="C":IBD("QTY")*IBD("COST"),$P(IBRT,U,2)="A":IBPRICE-$G(IBFEE)-$P($G(IBFEE),U,2),1:IBPRICE)_U_IBPRICE_U_(+$P($G(IBFEE),U,2))
"RTN","IBNCPDP1",133,0)
 S IBX=0 F  S IBX=$O(IBD("INS",IBX)) Q:IBX<1  S IBD("INS",IBX,2)=IBPRICE ;_U_$P(IBPAYER,U,6)
"RTN","IBNCPDP1",134,0)
 ;
"RTN","IBNCPDP1",135,0)
 S IBRES=$S($D(IBRMARK):"0^"_IBRMARK,1:1)
"RTN","IBNCPDP1",136,0)
 I IBRES,'$G(IBD("RELEASE DATE")) S IBRMARK="PRESCRIPTION NOT RELEASED"
"RTN","IBNCPDP1",137,0)
 D CT
"RTN","IBNCPDP1",138,0)
 ;
"RTN","IBNCPDP1",139,0)
RXQ D LOG^IBNCPDP2("BILLABLE STATUS CHECK",IBRES)
"RTN","IBNCPDP1",140,0)
 Q IBRES
"RTN","IBNCPDP1",141,0)
 ;
"RTN","IBNCPDP1",142,0)
 ;
"RTN","IBNCPDP1",143,0)
CT ; files in claims tracking
"RTN","IBNCPDP1",144,0)
 I IBTRKR D CT^IBNCPDPU(DFN,IBRXN,IBFIL,IBADT,$G(IBRMARK))
"RTN","IBNCPDP1",145,0)
 Q
"RTN","IBNCPDP1",146,0)
 ;
"RTN","IBNCPDP1",147,0)
EXEMPT ; exemption reasons
"RTN","IBNCPDP1",148,0)
 ; variable from SD call ^ variable from PSO ^ reason not billable
"RTN","IBNCPDP1",149,0)
 ;;1^AO^AGENT ORANGE
"RTN","IBNCPDP1",150,0)
 ;;2^IR^IONIZING RADIATION
"RTN","IBNCPDP1",151,0)
 ;;3^SC^SC TREATMENT
"RTN","IBNCPDP1",152,0)
 ;;4^EC^ENV. CONTAM.
"RTN","IBNCPDP1",153,0)
 ;;5^MST^MILITARY SEXUAL TRAUMA
"RTN","IBNCPDP1",154,0)
 ;;6^HNC^HEAD/NECK CANCER
"RTN","IBNCPDP1",155,0)
 ;;7^CV^COMBAT VETERAN
"RTN","IBNCPDP1",156,0)
 ;;
"RTN","IBNCPDP1",157,0)
 ;
"RTN","IBNCPDP1",158,0)
ERMSG(IBSTL) ; Inactive status reason
"RTN","IBNCPDP1",159,0)
 N IBSTA,IBI,IBARR,IBTXT
"RTN","IBNCPDP1",160,0)
 D STATAR^IBCNRU1(.IBARR)
"RTN","IBNCPDP1",161,0)
 F IBI=1:1:$L(IBSTL,",")+1 S IBSTA=+$P(IBSTL,",",IBI) Q:"^100^200^300^400^"'[(U_IBSTA_U)
"RTN","IBNCPDP1",162,0)
 S IBTXT=$G(IBARR(+IBSTA),"Plan is not active.")
"RTN","IBNCPDP1",163,0)
 Q IBTXT
"RTN","IBNCPDP1",164,0)
 ;
"RTN","IBNCPDP1",165,0)
NEEDSC(IBTXT) ; is the CT NBR one of 'needs sc determination'?
"RTN","IBNCPDP1",166,0)
 I IBTXT="NEEDS SC DETERMINATION" Q 1
"RTN","IBNCPDP1",167,0)
 N I,RES,IBT
"RTN","IBNCPDP1",168,0)
 S RES=0
"RTN","IBNCPDP1",169,0)
 F I=2:1 S IBT=$P($P($T(EXEMPT+I),";;",2),U,3) Q:IBT=""  I IBT=IBTXT S RES=1 Q
"RTN","IBNCPDP1",170,0)
 Q RES
"RTN","IBNCPDP1",171,0)
 ;
"RTN","IBNCPDP1",172,0)
PAPERBIL(IBTRKRN) ; 'paper' bill in CT?
"RTN","IBNCPDP1",173,0)
 N IBZ,IBIFN
"RTN","IBNCPDP1",174,0)
 S IBZ=$G(^IBT(356,IBTRKRN,0)) I IBZ="" Q 0
"RTN","IBNCPDP1",175,0)
 S IBIFN=+$P(IBZ,U,11) I 'IBIFN Q 0
"RTN","IBNCPDP1",176,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,13)=7 Q 0  ; cancelled
"RTN","IBNCPDP1",177,0)
 I $P($G(^DGCR(399,IBIFN,"M1")),U,8)'="" Q 0  ; ecme bill
"RTN","IBNCPDP1",178,0)
 Q 1
"RTN","IBNCPDP1",179,0)
 ;
"RTN","IBNCPDP1",180,0)
 ;gets the insurance phone
"RTN","IBNCPDP1",181,0)
 ;input:
"RTN","IBNCPDP1",182,0)
 ; IB36 - ptr to INSURANCE COMPANY File (#36)
"RTN","IBNCPDP1",183,0)
 ;output:
"RTN","IBNCPDP1",184,0)
 ; the phone number
"RTN","IBNCPDP1",185,0)
PHONE(IB36) ;
"RTN","IBNCPDP1",186,0)
 N IB1
"RTN","IBNCPDP1",187,0)
 ;check first CLAIMS (RX) PHONE NUMBER if empty
"RTN","IBNCPDP1",188,0)
 S IB1=$$GET1^DIQ(36,+IB36,.1311,"E")
"RTN","IBNCPDP1",189,0)
 Q:$L(IB1)>0 IB1
"RTN","IBNCPDP1",190,0)
 ;check BILLING PHONE NUMBER if empty - return nothing
"RTN","IBNCPDP1",191,0)
 S IB1=$$GET1^DIQ(36,+IB36,.132,"E")
"RTN","IBNCPDP1",192,0)
 Q IB1
"RTN","IBNCPDP1",193,0)
 ;
"RTN","IBNCPDP1",194,0)
 ;IBNCPDP1
"RTN","IBNCPDP2")
0^46^B37659473
"RTN","IBNCPDP2",1,0)
IBNCPDP2 ;OAK/ELZ - PROCESSING FOR ECME RESP ;20-JUN-2003
"RTN","IBNCPDP2",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276**;21-MAR-94
"RTN","IBNCPDP2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDP2",4,0)
 ;
"RTN","IBNCPDP2",5,0)
 ;NCPDP PHASE III
"RTN","IBNCPDP2",6,0)
 Q
"RTN","IBNCPDP2",7,0)
 ;
"RTN","IBNCPDP2",8,0)
ECME(DFN,IBD) ; function called by STORESP^IBNCPDP
"RTN","IBNCPDP2",9,0)
 ; input - DFN - patient IEN for the prescription
"RTN","IBNCPDP2",10,0)
 ;         IBD array passed in by reference
"RTN","IBNCPDP2",11,0)
 ;      The IBD array is passed to various subroutines depending
"RTN","IBNCPDP2",12,0)
 ;      on the ePharmacy event as evaluated by IBD("STATUS")
"RTN","IBNCPDP2",13,0)
 I IBD("STATUS")="PAID" Q $$BILL(DFN,.IBD)
"RTN","IBNCPDP2",14,0)
 I IBD("STATUS")="REJECTED" Q $$REJECT^IBNCPDP3(DFN,.IBD)
"RTN","IBNCPDP2",15,0)
 I IBD("STATUS")="REVERSED" Q $$REVERSE^IBNCPDP3(DFN,.IBD)
"RTN","IBNCPDP2",16,0)
 I IBD("STATUS")="CLOSED" Q $$CLOSE^IBNCPDP4(DFN,.IBD)
"RTN","IBNCPDP2",17,0)
 I IBD("STATUS")="RELEASED" Q $$RELEASE^IBNCPDP4(DFN,.IBD)
"RTN","IBNCPDP2",18,0)
 I IBD("STATUS")="SUBMITTED" Q $$SUBMIT^IBNCPDP4(DFN,.IBD)
"RTN","IBNCPDP2",19,0)
 D LOG("UNKNOWN")
"RTN","IBNCPDP2",20,0)
 Q "0^Cannot determine ECME event status"
"RTN","IBNCPDP2",21,0)
 ;
"RTN","IBNCPDP2",22,0)
MATCH(BCID) ;
"RTN","IBNCPDP2",23,0)
 N IBX,IBHAVE
"RTN","IBNCPDP2",24,0)
 S IBX=0,IBHAVE=0 F  S IBX=$O(^DGCR(399,"AG",BCID,IBX)) Q:'IBX  S IBHAVE=1 I '$P($G(^DGCR(399,IBX,"S")),U,16) Q
"RTN","IBNCPDP2",25,0)
 I 'IBX,IBHAVE Q ""
"RTN","IBNCPDP2",26,0)
 Q +IBX
"RTN","IBNCPDP2",27,0)
 ;
"RTN","IBNCPDP2",28,0)
 ;
"RTN","IBNCPDP2",29,0)
BILL(DFN,IBD) ; create fi bill
"RTN","IBNCPDP2",30,0)
 N IBRVCD,IBBS,IBUNITS,IBCPT,IBDIV,IBAA,IBTYPE,IBITEM,IBAMT,IBY,IBSERV,IBFAC,IBSITE,IBDRX,IB,IBCDFN,IBINS,IBIDS,IBIFN,IBDFN,PRCASV,PRCAERR,IBADT,IBRXN,IBFIL,IBTRKRN,DIE,DA,DR,IBRES,IBLOCK,IBLDT,IBNOW,IBDUZ,RCDUZ,IBPREV,IBQUERY,IBPAID,IBACT
"RTN","IBNCPDP2",31,0)
 ;
"RTN","IBNCPDP2",32,0)
 S IBDUZ=.5 ;POSTMASTER
"RTN","IBNCPDP2",33,0)
 ;I $G(IBD("FILLED BY")),$D(^VA(200,+IBD("FILLED BY"))) S IBDUZ=+IBD("FILLED BY")
"RTN","IBNCPDP2",34,0)
 S RCDUZ=IBDUZ
"RTN","IBNCPDP2",35,0)
 ;
"RTN","IBNCPDP2",36,0)
 S IBY=1,IBLOCK=0
"RTN","IBNCPDP2",37,0)
 I 'DFN S IBY="0^Missing DFN" G BILLQ
"RTN","IBNCPDP2",38,0)
 S IBAMT=+$G(IBD("BILLED")) ;FI portion of charge
"RTN","IBNCPDP2",39,0)
 I 'IBAMT S IBY="-1^Zero amount billed" G BILLQ
"RTN","IBNCPDP2",40,0)
 S IBADT=+$G(IBD("FILL DATE"),DT)
"RTN","IBNCPDP2",41,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBY="0^Missing Rx IEN" G BILLQ
"RTN","IBNCPDP2",42,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBY="0^No fill number" G BILLQ
"RTN","IBNCPDP2",43,0)
 S IBDIV=+$G(IBD("DIVISION"))
"RTN","IBNCPDP2",44,0)
 I '$L($G(IBD("CLAIMID"))) S IBY="-1^Missing ECME Number" G BILLQ
"RTN","IBNCPDP2",45,0)
 S IBD("BCID")=(+IBD("CLAIMID"))_";"_IBADT ; The BCID#
"RTN","IBNCPDP2",46,0)
 L +^DGCR(399,"AG",IBD("BCID")):15 E  S IBY="0^Cannot lock ECME number." G BILLQ
"RTN","IBNCPDP2",47,0)
 S IBLOCK=1
"RTN","IBNCPDP2",48,0)
 S IBLDT=$G(^DGCR(399,"AG",IBD("BCID"))) ;Last time called
"RTN","IBNCPDP2",49,0)
 D NOW^%DTC S IBNOW=%
"RTN","IBNCPDP2",50,0)
 ; 2 calls in 45 sec
"RTN","IBNCPDP2",51,0)
 I $P(IBLDT,"^",2)="B" I $$FMDIFF^XLFDT(IBNOW,+IBLDT,2)<45 S IBY="0^Duplicate billing call" G BILLQ
"RTN","IBNCPDP2",52,0)
 ;
"RTN","IBNCPDP2",53,0)
 I $$MATCH(IBD("BCID")) D   ;cancel the previous bill
"RTN","IBNCPDP2",54,0)
 . N IBARR M IBARR=IBD I $$REVERSE^IBNCPDP3(DFN,.IBARR,2)
"RTN","IBNCPDP2",55,0)
 ;
"RTN","IBNCPDP2",56,0)
 ; derive minimal variables
"RTN","IBNCPDP2",57,0)
 I '$$CHECK^IBECEAU(0) S IBY="-1^IB SITE" G BILLQ
"RTN","IBNCPDP2",58,0)
 S IBSERV=$P($G(^IBE(350.1,1,0)),"^",4)
"RTN","IBNCPDP2",59,0)
 I '$$SERV^IBARX1(IBSERV) S IBY="-1^IB SERVICE" G BILLQ
"RTN","IBNCPDP2",60,0)
 I 'IBDIV S IBDIV=+$P($G(^SC(+$P($G(^PSRX(IBRXN,0)),U,5),0)),U,15)
"RTN","IBNCPDP2",61,0)
 I 'IBDIV S IBDIV=+$P($G(^IBE(350.9,1,1)),U,25) ;dflt
"RTN","IBNCPDP2",62,0)
 ; - establish a stub claim/receivable
"RTN","IBNCPDP2",63,0)
 D SET^IBR I IBY<0 G BILLQ
"RTN","IBNCPDP2",64,0)
 ;
"RTN","IBNCPDP2",65,0)
 ; set up the following variables for claim establishment:
"RTN","IBNCPDP2",66,0)
 ; .01 BILL #
"RTN","IBNCPDP2",67,0)
 ; .17 ORIG CLAIM
"RTN","IBNCPDP2",68,0)
 ; .2  AUTO?
"RTN","IBNCPDP2",69,0)
 ; .02 DFN
"RTN","IBNCPDP2",70,0)
 ; .06 TIMEFRAME
"RTN","IBNCPDP2",71,0)
 ; .07 RATE TYPE
"RTN","IBNCPDP2",72,0)
 ; .18 SC AT TIME?
"RTN","IBNCPDP2",73,0)
 ; .04 LOCATION
"RTN","IBNCPDP2",74,0)
 ; .22 DIVISION
"RTN","IBNCPDP2",75,0)
 ; .05 BILL CLASSIF  (3)
"RTN","IBNCPDP2",76,0)
 ; .03 EVT DATE (FILL DATE)
"RTN","IBNCPDP2",77,0)
 ; 151 BILL FROM
"RTN","IBNCPDP2",78,0)
 ; 152 BILL TO
"RTN","IBNCPDP2",79,0)
 ; 101 PRIMARY INS CARRIER
"RTN","IBNCPDP2",80,0)
 K IB
"RTN","IBNCPDP2",81,0)
 S (IB(.02),IBDFN)=DFN
"RTN","IBNCPDP2",82,0)
 S IB(.07)=+$$RT^IBNCPDPU(DFN)
"RTN","IBNCPDP2",83,0)
 I 'IB(.07) S IBY="-1^IB RATE TYPE" G BILLQ
"RTN","IBNCPDP2",84,0)
 ;
"RTN","IBNCPDP2",85,0)
 S IBIFN=PRCASV("ARREC")
"RTN","IBNCPDP2",86,0)
 S IB(.01)=$P(PRCASV("ARBIL"),"-",2)
"RTN","IBNCPDP2",87,0)
 S IB(.17)=""
"RTN","IBNCPDP2",88,0)
 S IB(.2)=0
"RTN","IBNCPDP2",89,0)
 S IB(.06)=1
"RTN","IBNCPDP2",90,0)
 S IB(.18)=$$SC^IBCU3(DFN)
"RTN","IBNCPDP2",91,0)
 S IB(.04)=$S(+$P($G(^DG(40.8,+IBDIV,0)),U,3):7,1:1)
"RTN","IBNCPDP2",92,0)
 S:IBDIV IB(.22)=+IBDIV
"RTN","IBNCPDP2",93,0)
 S IB(.05)=3
"RTN","IBNCPDP2",94,0)
 S (IB(.03),IB(151),IB(152))=IBADT
"RTN","IBNCPDP2",95,0)
 S IBINS=$P($G(^IBA(355.3,+$G(IBD("PLAN")),0)),"^") I IBINS S IB(101)=IBINS
"RTN","IBNCPDP2",96,0)
 ;
"RTN","IBNCPDP2",97,0)
 ; set 362.4 node to rx#^p50^days sup^fill date^qty^ndc
"RTN","IBNCPDP2",98,0)
 S IB(362.4,IBRXN,1)=IBD("RX NO")_"^"_IBD("DRUG")_"^"_IBD("DAYS SUPPLY")_"^"_IBD("FILL DATE")_"^"_IBD("QTY")_"^"_IBD("NDC")
"RTN","IBNCPDP2",99,0)
 ;
"RTN","IBNCPDP2",100,0)
 ; call the autobiller module to create the claim with a default
"RTN","IBNCPDP2",101,0)
 ; diagnosis and procedure for prescriptions
"RTN","IBNCPDP2",102,0)
 D EN^IBCD3(.IBQUERY)
"RTN","IBNCPDP2",103,0)
 D CLOSE^IBSDU(.IBQUERY)
"RTN","IBNCPDP2",104,0)
 ;
"RTN","IBNCPDP2",105,0)
 S ^DGCR(399,"AG",IBD("BCID"))=IBNOW_"^B"
"RTN","IBNCPDP2",106,0)
 S DIE="^DGCR(399,",DA=IBIFN
"RTN","IBNCPDP2",107,0)
 ; update the ECME fields
"RTN","IBNCPDP2",108,0)
 S DR="460////^S X=IBD(""BCID"")" S:$L($G(IBD("AUTH #"))) DR=DR_";461////^S X=IBD(""AUTH #"")"
"RTN","IBNCPDP2",109,0)
 D ^DIE K DA,DR,DIE
"RTN","IBNCPDP2",110,0)
 D SETCT ; Set Claims Tracking record
"RTN","IBNCPDP2",111,0)
 ;
"RTN","IBNCPDP2",112,0)
 ; IEN to 2.3121
"RTN","IBNCPDP2",113,0)
 S IBCDFN=$$PLANN^IBNCPDPU(DFN,IBD("PLAN"),IBADT)
"RTN","IBNCPDP2",114,0)
 I 'IBCDFN S IBY="-1^Plan not found in Patient's Profile." G BILLQ
"RTN","IBNCPDP2",115,0)
 ;
"RTN","IBNCPDP2",116,0)
 ; add the payer (fiscal intermediary) to the claim
"RTN","IBNCPDP2",117,0)
 S IBINS=+IBCDFN,IBCDFN=$P(IBCDFN,"^",2)
"RTN","IBNCPDP2",118,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR="112////"_IBCDFN
"RTN","IBNCPDP2",119,0)
 D ^DIE K DA,DR,DIE,DGRVRCAL
"RTN","IBNCPDP2",120,0)
 ;
"RTN","IBNCPDP2",121,0)
 ; need to make sure we have computed charges.
"RTN","IBNCPDP2",122,0)
 D BILL^IBCRBC(IBIFN)
"RTN","IBNCPDP2",123,0)
 ;
"RTN","IBNCPDP2",124,0)
 ; update the authorize/print fields
"RTN","IBNCPDP2",125,0)
 S DIE="^DGCR(399,",DA=IBIFN
"RTN","IBNCPDP2",126,0)
 S DR="9////1;12////"_DT D ^DIE
"RTN","IBNCPDP2",127,0)
 K DA,DR,DIE
"RTN","IBNCPDP2",128,0)
 ;
"RTN","IBNCPDP2",129,0)
 ; pass the claim to AR
"RTN","IBNCPDP2",130,0)
 D GVAR^IBCBB,ARRAY^IBCBB1 S PRCASV("APR")=IBDUZ D ^PRCASVC6
"RTN","IBNCPDP2",131,0)
 I 'PRCASV("OKAY") S IBY="-1^Cannot establish receivable in AR." G BILLQ
"RTN","IBNCPDP2",132,0)
 D REL^PRCASVC
"RTN","IBNCPDP2",133,0)
 ;
"RTN","IBNCPDP2",134,0)
 ; update the AR status to Active
"RTN","IBNCPDP2",135,0)
 ;  D AUDITX^PRCAUDT(PRCASV("ARREC"))
"RTN","IBNCPDP2",136,0)
 S PRCASV("STATUS")=16
"RTN","IBNCPDP2",137,0)
 D STATUS^PRCASVC1
"RTN","IBNCPDP2",138,0)
 ;
"RTN","IBNCPDP2",139,0)
 ; decrease adjust bill
"RTN","IBNCPDP2",140,0)
 ; Auto decrease from service Bill#,Tran amt,person,reason,Tran date
"RTN","IBNCPDP2",141,0)
 S IBAMT=$G(^DGCR(399,IBIFN,"U1"))
"RTN","IBNCPDP2",142,0)
 S IBPAID=IBD("PAID")
"RTN","IBNCPDP2",143,0)
 D:IBAMT-IBPAID>.01
"RTN","IBNCPDP2",144,0)
 . D DEC^PRCASER1(PRCASV("ARREC"),IBAMT-IBPAID,IBDUZ,"Adjust based on ECME amount paid.",IBADT)
"RTN","IBNCPDP2",145,0)
 . I 'IBPAID S PRCASV("STATUS")=22 D STATUS^PRCASVC1 ; collected/closed
"RTN","IBNCPDP2",146,0)
 ; release copay off hold
"RTN","IBNCPDP2",147,0)
 I 'IBPAID,'$$MOREINS^IBNCPNB(DFN,IBADT) D
"RTN","IBNCPDP2",148,0)
 . S IBACT=$$RELCOPAY^IBNCPNB(DFN,IBRXN,IBFIL,0,IBADT,IBIFN)
"RTN","IBNCPDP2",149,0)
 . I IBACT>0 D RELBUL^IBNCPEB(DFN,IBRXN,IBFIL,IBADT,IBACT,0,"",IBIFN) ; Bulletin
"RTN","IBNCPDP2",150,0)
 ;
"RTN","IBNCPDP2",151,0)
 D  ; set the user in 399
"RTN","IBNCPDP2",152,0)
 . N IBI,IBT F IBI=2,5,11,13,15 S IBT(399,IBIFN_",",IBI)=IBDUZ
"RTN","IBNCPDP2",153,0)
 . D FILE^DIE("","IBT")
"RTN","IBNCPDP2",154,0)
 ;
"RTN","IBNCPDP2",155,0)
BILLQ S IBRES=$S(IBY<0:"0^"_$S($L($P(IBY,"^",2)):$P(IBY,"^",2),1:$P(IBY,"^",3)),$G(IBIFN):+IBIFN,1:IBY)
"RTN","IBNCPDP2",156,0)
 I $G(IBIFN) S IBD("BILL")=IBIFN
"RTN","IBNCPDP2",157,0)
 D LOG("BILL",IBRES)
"RTN","IBNCPDP2",158,0)
 I IBY<0 D BULL^IBNCPEB($G(DFN),.IBD,IBRES,$G(IBIFN))
"RTN","IBNCPDP2",159,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP2",160,0)
 Q IBRES
"RTN","IBNCPDP2",161,0)
 ;
"RTN","IBNCPDP2",162,0)
 ; update claims tracking saying bill has been billed
"RTN","IBNCPDP2",163,0)
SETCT ;
"RTN","IBNCPDP2",164,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP2",165,0)
 I IBTRKRN S DIE="^IBT(356,",DA=IBTRKRN,DR=".11////^S X=IBIFN;.17///@" D ^DIE
"RTN","IBNCPDP2",166,0)
 I IBTRKRN,IBIFN D CTB^IBCDC(IBTRKRN,IBIFN)
"RTN","IBNCPDP2",167,0)
 Q
"RTN","IBNCPDP2",168,0)
 ;
"RTN","IBNCPDP2",169,0)
 ;
"RTN","IBNCPDP2",170,0)
LOG(PROC,RESULT) ;Store the data
"RTN","IBNCPDP2",171,0)
 N NDX,Z,REF
"RTN","IBNCPDP2",172,0)
 S Z="IBNCPDP-"_DT
"RTN","IBNCPDP2",173,0)
 ;last 60 days only;180 for beta-testing
"RTN","IBNCPDP2",174,0)
 I '$D(^XTMP(Z,0)) S ^XTMP(Z,0)=$$FMADD^XLFDT(DT,90)_U_DT
"RTN","IBNCPDP2",175,0)
 L +^XTMP(Z):30 E  Q
"RTN","IBNCPDP2",176,0)
 S NDX=$O(^XTMP(Z,"A"),-1)+1
"RTN","IBNCPDP2",177,0)
 S REF=$NA(^XTMP(Z,NDX))
"RTN","IBNCPDP2",178,0)
 S @REF@("CALL")=PROC
"RTN","IBNCPDP2",179,0)
 L -^XTMP(Z)
"RTN","IBNCPDP2",180,0)
 S @REF@("DFN")=DFN
"RTN","IBNCPDP2",181,0)
 M @REF@("IBD")=IBD
"RTN","IBNCPDP2",182,0)
 S @REF@("TIME")=$$NOW^XLFDT()
"RTN","IBNCPDP2",183,0)
 S @REF@("USER")=DUZ
"RTN","IBNCPDP2",184,0)
 S @REF@("JOB")=$J
"RTN","IBNCPDP2",185,0)
 S @REF@("DEVICE")=$P
"RTN","IBNCPDP2",186,0)
 I $G(RESULT)'="" S @REF@("RESULT")=RESULT
"RTN","IBNCPDP2",187,0)
 Q
"RTN","IBNCPDP2",188,0)
 ;IBNCPDP2
"RTN","IBNCPDP3")
0^47^B48251954
"RTN","IBNCPDP3",1,0)
IBNCPDP3 ;OAK/ELZ - STORES NDC/AWP UPDATES ;20-JUN-2003
"RTN","IBNCPDP3",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276**;21-MAR-94
"RTN","IBNCPDP3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDP3",4,0)
 ;
"RTN","IBNCPDP3",5,0)
 ;
"RTN","IBNCPDP3",6,0)
UPAWP(IBNDC,IBAWP,IBADT) ; updates AWP prices for NDCs
"RTN","IBNCPDP3",7,0)
 ;
"RTN","IBNCPDP3",8,0)
 N IBITEM,IBCS
"RTN","IBNCPDP3",9,0)
 ;
"RTN","IBNCPDP3",10,0)
 ;
"RTN","IBNCPDP3",11,0)
 S IBCS=$P($G(^IBE(350.9,1,9)),"^",12)
"RTN","IBNCPDP3",12,0)
 I 'IBCS Q "0^Unable to find Charge Set"
"RTN","IBNCPDP3",13,0)
 ;
"RTN","IBNCPDP3",14,0)
 S IBNDC=$$NDC^IBNCPDPU(IBNDC)
"RTN","IBNCPDP3",15,0)
 ;
"RTN","IBNCPDP3",16,0)
 S IBITEM=+$$ADDBI^IBCREF("NDC",IBNDC) I IBITEM Q "0^Unable to add item"
"RTN","IBNCPDP3",17,0)
 ;
"RTN","IBNCPDP3",18,0)
 I '$$ADDCI^IBCREF(IBCS,IBITEM,IBADT,IBAWP) Q "0^Unable to add charge"
"RTN","IBNCPDP3",19,0)
 ;
"RTN","IBNCPDP3",20,0)
 Q 1
"RTN","IBNCPDP3",21,0)
 ;
"RTN","IBNCPDP3",22,0)
 ;
"RTN","IBNCPDP3",23,0)
REJECT(DFN,IBD) ; used to process rejected claims
"RTN","IBNCPDP3",24,0)
 ; if ct turned on, need to make sure on file.
"RTN","IBNCPDP3",25,0)
 ; nothing else to do with this here.
"RTN","IBNCPDP3",26,0)
 ;
"RTN","IBNCPDP3",27,0)
 N IBADT,IBTRKR,IBTRKRN,IBRXN,IBFIL,IBEABD,IBY,IBLOCK,IBDUZ,IBRXTYP
"RTN","IBNCPDP3",28,0)
 S IBDUZ=.5
"RTN","IBNCPDP3",29,0)
 S IBY=1,IBLOCK=0
"RTN","IBNCPDP3",30,0)
 ;
"RTN","IBNCPDP3",31,0)
 S IBADT=+$G(IBD("FILL DATE")) I 'IBADT S IBY="0^No fill date" G REJQ
"RTN","IBNCPDP3",32,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBY="0^No Rx IEN" G REJQ
"RTN","IBNCPDP3",33,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBY="0^No fill number" G REJQ
"RTN","IBNCPDP3",34,0)
 S IBD("BCID")=IBD("CLAIMID")_";"_IBADT
"RTN","IBNCPDP3",35,0)
 L +^DGCR(399,"AG",IBD("BCID")):15 E  S IBY="0^Cannot lock ECME number" G REJQ
"RTN","IBNCPDP3",36,0)
 S IBLOCK=1
"RTN","IBNCPDP3",37,0)
 ;
"RTN","IBNCPDP3",38,0)
 ; -- claims tracking info
"RTN","IBNCPDP3",39,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBNCPDP3",40,0)
 ; date can't be before parameters
"RTN","IBNCPDP3",41,0)
 S $P(IBTRKR,"^")=$S('$P(IBTRKR,"^",4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPDP3",42,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP3",43,0)
 ;
"RTN","IBNCPDP3",44,0)
 I $D(IBD("CLOSE REASON")),'$D(IBD("DROP TO PAPER")) S IBD("DROP TO PAPER")=""
"RTN","IBNCPDP3",45,0)
 ;
"RTN","IBNCPDP3",46,0)
 I IBTRKRN,$G(IBD("CLOSE REASON")) D  S IBY=1 G REJQ
"RTN","IBNCPDP3",47,0)
 . N IBCR,IBCC,IBPAP,IBRELC
"RTN","IBNCPDP3",48,0)
 . S IBCR=IBD("CLOSE REASON")
"RTN","IBNCPDP3",49,0)
 . S IBPAP=IBD("DROP TO PAPER")
"RTN","IBNCPDP3",50,0)
 . S IBRELC=$G(IBD("RELEASE COPAY"))
"RTN","IBNCPDP3",51,0)
 . S IBCC=$G(IBD("CLOSE COMMENT"))
"RTN","IBNCPDP3",52,0)
 . D NONBR^IBNCPNB(DFN,IBRXN,IBFIL,IBADT,IBCR,IBPAP,IBRELC,IBCC)
"RTN","IBNCPDP3",53,0)
 ;
"RTN","IBNCPDP3",54,0)
 ; if in CT already - set EABD+60 if still there.
"RTN","IBNCPDP3",55,0)
 I IBTRKRN,$P(^IBT(356,IBTRKRN,0),"^",17) D  S IBY=1 G REJQ
"RTN","IBNCPDP3",56,0)
 . N IBLOCK
"RTN","IBNCPDP3",57,0)
 . L +^IBT(356,IBTRKRN):10 S IBLOCK=$T
"RTN","IBNCPDP3",58,0)
 . S IBEABD=$$EABD^IBTUTL($O(^IBE(356.6,"AC",4,0)),IBADT)
"RTN","IBNCPDP3",59,0)
 . S:'IBEABD IBEABD=DT
"RTN","IBNCPDP3",60,0)
 . S IBEABD=$$FMADD^XLFDT(IBEABD,60)
"RTN","IBNCPDP3",61,0)
 . S DIE="^IBT(356,",DA=IBTRKRN,DR=".17////^S X=IBEABD"
"RTN","IBNCPDP3",62,0)
 . D ^DIE
"RTN","IBNCPDP3",63,0)
 . I IBLOCK L -^IBT(356,IBTRKRN)
"RTN","IBNCPDP3",64,0)
 ;
"RTN","IBNCPDP3",65,0)
 S IBY=1 ; OK
"RTN","IBNCPDP3",66,0)
 ;
"RTN","IBNCPDP3",67,0)
REJQ ;
"RTN","IBNCPDP3",68,0)
 D LOG^IBNCPDP2("REJECT",IBY)
"RTN","IBNCPDP3",69,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP3",70,0)
 Q IBY
"RTN","IBNCPDP3",71,0)
 ;
"RTN","IBNCPDP3",72,0)
 ;
"RTN","IBNCPDP3",73,0)
REVERSE(DFN,IBD,IBAUTO) ;process reversed claims
"RTN","IBNCPDP3",74,0)
 N IBIFN,I,IB,IBIL,IBCHG,IBCRES,IBY,X,Y,DA,DIE,DR,IBADT,IBLOCK,IBLDT
"RTN","IBNCPDP3",75,0)
 N IBNOW,IBDUZ,IBCR,IBRELC,IBCC,IBPAP,IBRXN,IBFIL,IBRTS,IBARES
"RTN","IBNCPDP3",76,0)
 S IBDUZ=.5
"RTN","IBNCPDP3",77,0)
 ;
"RTN","IBNCPDP3",78,0)
 S IBLOCK=0
"RTN","IBNCPDP3",79,0)
 ; find bill number
"RTN","IBNCPDP3",80,0)
 I '$L($G(IBD("CLAIMID"))) S IBY="0^Missing ECME Number" G REVQ
"RTN","IBNCPDP3",81,0)
 S IBADT=+$G(IBD("FILL DATE")) I 'IBADT S IBY="0^Missing Fill Date" G REVQ
"RTN","IBNCPDP3",82,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBY="0^No Rx IEN" G REVQ
"RTN","IBNCPDP3",83,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBY="0^No fill number" G REVQ
"RTN","IBNCPDP3",84,0)
 I $E($G(IBD("RESPONSE")),1)="R" D  G REVQ:+'$G(IBRTS)
"RTN","IBNCPDP3",85,0)
 . S IBY="0^REVERSAL rejected by payer"
"RTN","IBNCPDP3",86,0)
 . S IBRTS=$$RTS(IBD("REVERSAL REASON"))
"RTN","IBNCPDP3",87,0)
 ;
"RTN","IBNCPDP3",88,0)
 S IBD("BCID")=(+IBD("CLAIMID"))_";"_IBADT ; BC ID Number
"RTN","IBNCPDP3",89,0)
 L +^DGCR(399,"AG",IBD("BCID")):15 E  S IBY="0^Cannot lock ECME number" G REVQ
"RTN","IBNCPDP3",90,0)
 S IBLOCK=1
"RTN","IBNCPDP3",91,0)
 I $D(^DGCR(399,"AG",IBD("BCID"))) S ^(IBD("BCID"))=""
"RTN","IBNCPDP3",92,0)
 S IBIFN=$$MATCH^IBNCPDP2(IBD("BCID"))
"RTN","IBNCPDP3",93,0)
 I $D(IBD("CLOSE REASON")),'$D(IBD("DROP TO PAPER")) S IBD("DROP TO PAPER")=""
"RTN","IBNCPDP3",94,0)
 S IBCR=+$G(IBD("CLOSE REASON"))
"RTN","IBNCPDP3",95,0)
 S IBPAP=$G(IBD("DROP TO PAPER"))
"RTN","IBNCPDP3",96,0)
 S IBRELC=$G(IBD("RELEASE COPAY"))
"RTN","IBNCPDP3",97,0)
 S IBCC=$G(IBD("CLOSE COMMENT"))
"RTN","IBNCPDP3",98,0)
 D NONBR^IBNCPNB(DFN,IBRXN,IBFIL,IBADT,IBCR,IBPAP,IBRELC,IBCC)
"RTN","IBNCPDP3",99,0)
 I 'IBIFN S IBY="0^"_$S(IBPAP:"Dropped to paper",IBCR>1:"Set non-billable reason in CT",1:"Cannot find the bill to reverse") G REVQ
"RTN","IBNCPDP3",100,0)
 ;
"RTN","IBNCPDP3",101,0)
 F I=0,"S" S IB(I)=$G(^DGCR(399,IBIFN,I))
"RTN","IBNCPDP3",102,0)
 I IB(0)="" S IBY="0^No data in bill" G REVQ
"RTN","IBNCPDP3",103,0)
 I +$P(IB("S"),U,16),$P(IB("S"),U,17)]"" S IBY="0^Bill already cancelled" G REVQ
"RTN","IBNCPDP3",104,0)
 ;
"RTN","IBNCPDP3",105,0)
 S:'$D(IBCRES) IBCRES="ECME PRESCRIPTION REVERSED"
"RTN","IBNCPDP3",106,0)
 S DA=IBIFN,DR="16////1;19////"_IBCRES,DIE="^DGCR(399,"
"RTN","IBNCPDP3",107,0)
 D ^DIE K DA,DIE,DR
"RTN","IBNCPDP3",108,0)
 ;
"RTN","IBNCPDP3",109,0)
 ; - decrease out the receivable in AR
"RTN","IBNCPDP3",110,0)
 S IB("U1")=$G(^DGCR(399,IBIFN,"U1"))
"RTN","IBNCPDP3",111,0)
 S IBIL=$P($G(^PRCA(430,IBIFN,0)),"^")
"RTN","IBNCPDP3",112,0)
 S IBCHG=$S(IB("U1")']"":0,$P(IB("U1"),"^",1)]"":$P(IB("U1"),"^",1),1:0)
"RTN","IBNCPDP3",113,0)
 ;
"RTN","IBNCPDP3",114,0)
 S X="21^"_IBCHG_"^"_IBIL_"^"_IBDUZ_"^"_DT_"^"_IBCRES
"RTN","IBNCPDP3",115,0)
 D ^PRCASER1
"RTN","IBNCPDP3",116,0)
 S IBARES=Y
"RTN","IBNCPDP3",117,0)
 I IBARES<0 S IBY=IBARES D BULL
"RTN","IBNCPDP3",118,0)
 ;
"RTN","IBNCPDP3",119,0)
 S IBY=$S(IBARES<0:"0^"_$P(IBARES,"^",2),1:1)
"RTN","IBNCPDP3",120,0)
 ;
"RTN","IBNCPDP3",121,0)
 I IBDUZ'=DUZ D  ; set the real user
"RTN","IBNCPDP3",122,0)
 . N IBI,IBT S IBI=18,IBT(399,IBIFN_",",IBI)=IBDUZ D FILE^DIE("","IBT")
"RTN","IBNCPDP3",123,0)
 ;
"RTN","IBNCPDP3",124,0)
REVQ ;
"RTN","IBNCPDP3",125,0)
 I IBY=1,$G(IBIFN) S IBY=+IBIFN
"RTN","IBNCPDP3",126,0)
 D LOG^IBNCPDP2($S($G(IBAUTO)=1:"AUTO REVERSE",$G(IBAUTO)=2:"BILL CANCELLED",1:"REVERSE"),IBY)
"RTN","IBNCPDP3",127,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP3",128,0)
 Q IBY
"RTN","IBNCPDP3",129,0)
 ;
"RTN","IBNCPDP3",130,0)
RTS(IBRR) ; Return to Stock processing on Released Rx
"RTN","IBNCPDP3",131,0)
 ; input - IBRR = reversal reason
"RTN","IBNCPDP3",132,0)
 ; output - 0 = reversal not due to a Rx RETURN TO STOCK or Rx DELETE
"RTN","IBNCPDP3",133,0)
 ;          1 = reversal due to a Rx RETURN TO STOCK or Rx DELETE
"RTN","IBNCPDP3",134,0)
 I IBRR'="RX RETURNED TO STOCK"&(IBRR'="RX DELETED") Q 0
"RTN","IBNCPDP3",135,0)
 N IBTRKRN,IBLOCK2,IBCMT,DA,DIE,DR
"RTN","IBNCPDP3",136,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP3",137,0)
 I 'IBTRKRN Q 0  ; CT record does not exist
"RTN","IBNCPDP3",138,0)
 I '$P($G(^IBT(356,IBTRKRN,0)),U,11) Q 0  ; BILL does not exist
"RTN","IBNCPDP3",139,0)
 S IBCRES=$$GETRSN(DFN,IBRXN,IBFIL)  ; recorded in file 399 entry
"RTN","IBNCPDP3",140,0)
 L +^IBT(356,IBTRKRN):5 S IBLOCK2=$T
"RTN","IBNCPDP3",141,0)
 S DIE="^IBT(356,",DA=IBTRKRN,IBCMT="Rx RTS - May Need Refund"
"RTN","IBNCPDP3",142,0)
 S DR="1.08////"_IBCMT
"RTN","IBNCPDP3",143,0)
 D ^DIE
"RTN","IBNCPDP3",144,0)
 I IBLOCK2 L -^IBT(356,IBTRKRN)
"RTN","IBNCPDP3",145,0)
 Q 1
"RTN","IBNCPDP3",146,0)
 ;
"RTN","IBNCPDP3",147,0)
BULL ; Generate a bulletin if there is an error in cancelling the claim.
"RTN","IBNCPDP3",148,0)
 N IBC,IBT,IBPT,IBGRP,XMDUZ,XMTEXT,XMSUB,XMY
"RTN","IBNCPDP3",149,0)
 ;
"RTN","IBNCPDP3",150,0)
 S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBNCPDP3",151,0)
 S XMSUB=$E($P(IBPT,"^"),1,14)_"  "_$P(IBPT,"^",3)_" - ERROR ENCOUNTERED"
"RTN","IBNCPDP3",152,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBT("
"RTN","IBNCPDP3",153,0)
 S XMY(IBDUZ)=""
"RTN","IBNCPDP3",154,0)
 S IBGRP=$P($G(^XMB(3.8,+$P($G(^IBE(350.9,1,1)),"^",7),0)),"^")
"RTN","IBNCPDP3",155,0)
 I IBGRP]"" S XMY("G."_IBGRP_"@"_^XMB("NETNAME"))=""
"RTN","IBNCPDP3",156,0)
 ;
"RTN","IBNCPDP3",157,0)
 S IBT(1)="An error occurred while cancelling the Pharmacy claim from ECME"
"RTN","IBNCPDP3",158,0)
 S IBT(2)="fiscal intermediary for the following patient:"
"RTN","IBNCPDP3",159,0)
 S IBT(3)=" " S IBC=3
"RTN","IBNCPDP3",160,0)
 D PAT^IBAERR1 ; Accepts IBDUZ
"RTN","IBNCPDP3",161,0)
 S IBC=IBC+1,IBT(IBC)="   Bill #: "_IBIL
"RTN","IBNCPDP3",162,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBNCPDP3",163,0)
 S IBC=IBC+1,IBT(IBC)="The following error was encountered:"
"RTN","IBNCPDP3",164,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBNCPDP3",165,0)
 D ERR^IBAERR1
"RTN","IBNCPDP3",166,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBNCPDP3",167,0)
 S IBC=IBC+1,IBT(IBC)="Please review the circumstances surrounding this error and decrease"
"RTN","IBNCPDP3",168,0)
 S IBC=IBC+1,IBT(IBC)="out this receivable in Accounts Receivable if necessary."
"RTN","IBNCPDP3",169,0)
 D ^XMD
"RTN","IBNCPDP3",170,0)
 Q
"RTN","IBNCPDP3",171,0)
 ;
"RTN","IBNCPDP3",172,0)
GETRSN(DFN,IBRXN,IBFIL) ;
"RTN","IBNCPDP3",173,0)
 ; retrieve charge removal reason from file 354.71
"RTN","IBNCPDP3",174,0)
 ; input - DFN,IBRXN=Rx ien,IBFIL=fill number
"RTN","IBNCPDP3",175,0)
 ; output - charge removal reason 
"RTN","IBNCPDP3",176,0)
 N IBDT,IBDA,IBXRSN,IBRXFIL,IB0
"RTN","IBNCPDP3",177,0)
 S (IBDT,IBDA)=0,IBXRSN=""
"RTN","IBNCPDP3",178,0)
 S IBRXFIL=$S('IBFIL:IBRXN,1:IBRXN_";"_IBFIL)
"RTN","IBNCPDP3",179,0)
 F  S IBDT=$O(^IBAM(354.71,"AD",DFN,IBDT)) Q:'IBDT  Q:IBXRSN]""  D
"RTN","IBNCPDP3",180,0)
 . F  S IBDA=$O(^IBAM(354.71,"AD",DFN,IBDT,IBDA)) Q:'IBDA  Q:IBXRSN]""  D
"RTN","IBNCPDP3",181,0)
 . . S IB0=^IBAM(354.71,IBDA,0)
"RTN","IBNCPDP3",182,0)
 . . Q:$P(IB0,"^",6)'[IBRXFIL
"RTN","IBNCPDP3",183,0)
 . . S IBXRSN=$$GET1^DIQ(354.71,IBDA_",",.19)
"RTN","IBNCPDP3",184,0)
 S:IBXRSN']"" IBXRSN="CHARGE REMOVAL REASON NOT FOUND"
"RTN","IBNCPDP3",185,0)
 Q "Reversal Rej, no pymt due<>"_IBXRSN
"RTN","IBNCPDP3",186,0)
 ;
"RTN","IBNCPDP3",187,0)
 ;IBNCPDP3
"RTN","IBNCPDP4")
0^48^B21200709
"RTN","IBNCPDP4",1,0)
IBNCPDP4 ;DALOI/AAT - HANDLE ECME EVENTS ;20-JUN-2003
"RTN","IBNCPDP4",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPDP4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDP4",4,0)
 ;
"RTN","IBNCPDP4",5,0)
 ;NCPDP PHASE III
"RTN","IBNCPDP4",6,0)
 Q
"RTN","IBNCPDP4",7,0)
 ;
"RTN","IBNCPDP4",8,0)
CLOSE(DFN,IBD) ; Close Claim Event
"RTN","IBNCPDP4",9,0)
 N IBADT,IBTRKR,IBTRKRN,IBRXN,IBFIL,IBEABD,IBRES,IBLOCK,IBDUZ
"RTN","IBNCPDP4",10,0)
 N IBRXTYP,IBCR,DA,DIE,DR
"RTN","IBNCPDP4",11,0)
 S IBDUZ=.5
"RTN","IBNCPDP4",12,0)
 S IBRES=1,IBLOCK=0
"RTN","IBNCPDP4",13,0)
 ;
"RTN","IBNCPDP4",14,0)
 S IBADT=+$G(IBD("FILL DATE")) I 'IBADT S IBRES="0^No fill date" G CLOSEQ
"RTN","IBNCPDP4",15,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBRES="0^No Rx IEN" G CLOSEQ
"RTN","IBNCPDP4",16,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBRES="0^No fill number" G CLOSEQ
"RTN","IBNCPDP4",17,0)
 S IBCR=+$G(IBD("CLOSE REASON")) I 'IBCR S IBRES="0^No close reason" G CLOSEQ
"RTN","IBNCPDP4",18,0)
 S IBD("BCID")=IBD("CLAIMID")_";"_IBADT
"RTN","IBNCPDP4",19,0)
 L +^DGCR(399,"AG",IBD("BCID")):5 S IBLOCK=$T
"RTN","IBNCPDP4",20,0)
 ;
"RTN","IBNCPDP4",21,0)
 ; -- claims tracking info
"RTN","IBNCPDP4",22,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBNCPDP4",23,0)
 ; date can't be before parameters
"RTN","IBNCPDP4",24,0)
 S $P(IBTRKR,"^")=$S('$P(IBTRKR,"^",4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPDP4",25,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP4",26,0)
 ;
"RTN","IBNCPDP4",27,0)
 I 'IBTRKRN S IBRES="0^CT record not found" G CLOSEQ
"RTN","IBNCPDP4",28,0)
 ;
"RTN","IBNCPDP4",29,0)
 D NONBR^IBNCPNB(DFN,IBRXN,IBFIL,IBADT,IBCR,$G(IBD("DROP TO PAPER")),$G(IBD("RELEASE COPAY")),$G(IBD("CLOSE COMMENT")))
"RTN","IBNCPDP4",30,0)
 ;
"RTN","IBNCPDP4",31,0)
 S DIE="^IBT(356,",DA=IBTRKRN
"RTN","IBNCPDP4",32,0)
 ; add ECME #,ECME flag, remove total charges
"RTN","IBNCPDP4",33,0)
 S DR="1.1///"_IBD("CLAIMID")_";1.11///2;.29////@"
"RTN","IBNCPDP4",34,0)
 D ^DIE
"RTN","IBNCPDP4",35,0)
 ;
"RTN","IBNCPDP4",36,0)
 S IBRES=1 ; OK
"RTN","IBNCPDP4",37,0)
CLOSEQ ;
"RTN","IBNCPDP4",38,0)
 D LOG^IBNCPDP2("CLOSE",IBRES)
"RTN","IBNCPDP4",39,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP4",40,0)
 Q IBRES
"RTN","IBNCPDP4",41,0)
 ;
"RTN","IBNCPDP4",42,0)
 ;
"RTN","IBNCPDP4",43,0)
RELEASE(DFN,IBD) ;
"RTN","IBNCPDP4",44,0)
 N IBRES,IBADT,IBRXN,IBFIL,IBRDT,IBLOCK,IBLOCK2,IBTRKR,IBTRKRN
"RTN","IBNCPDP4",45,0)
 N IBEABD,IBNBR,DA,DIE,DR
"RTN","IBNCPDP4",46,0)
 S IBLOCK=0
"RTN","IBNCPDP4",47,0)
 S IBADT=+$G(IBD("FILL DATE")) I 'IBADT S IBRES="0^No fill date" G RELQ
"RTN","IBNCPDP4",48,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBRES="0^No Rx IEN" G RELQ
"RTN","IBNCPDP4",49,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBRES="0^No fill number" G RELQ
"RTN","IBNCPDP4",50,0)
 S IBRDT=+$G(IBD("RELEASE DATE"),-1) I 'IBRDT S IBRES="0^No release date" G RELQ
"RTN","IBNCPDP4",51,0)
 S IBD("BCID")=IBD("CLAIMID")_";"_IBADT
"RTN","IBNCPDP4",52,0)
 L +^DGCR(399,"AG",IBD("BCID")):5 S IBLOCK=$T
"RTN","IBNCPDP4",53,0)
 ; -- claims tracking info
"RTN","IBNCPDP4",54,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBNCPDP4",55,0)
 ; date can't be before parameters
"RTN","IBNCPDP4",56,0)
 S $P(IBTRKR,"^")=$S('$P(IBTRKR,"^",4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPDP4",57,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP4",58,0)
 I 'IBTRKRN S IBRES="0^No CT record found." G RELQ
"RTN","IBNCPDP4",59,0)
 ;
"RTN","IBNCPDP4",60,0)
 ; Remove NBR from CT and set T+60 (if not billed yet)
"RTN","IBNCPDP4",61,0)
 ; Set ECME flags in CT
"RTN","IBNCPDP4",62,0)
 ;
"RTN","IBNCPDP4",63,0)
 L +^IBT(356,IBTRKRN):5 S IBLOCK2=$T
"RTN","IBNCPDP4",64,0)
 S DIE="^IBT(356,",DA=IBTRKRN,DR=""
"RTN","IBNCPDP4",65,0)
 S IBNBR=+$P($G(^IBT(356,IBTRKRN,0)),U,19)
"RTN","IBNCPDP4",66,0)
 ; Clean up "Rx not released"
"RTN","IBNCPDP4",67,0)
 I IBNBR,$P($G(^IBE(356.8,IBNBR,0)),U)="PRESCRIPTION NOT RELEASED" S DR=DR_".19////@;",IBNBR=""
"RTN","IBNCPDP4",68,0)
 ;
"RTN","IBNCPDP4",69,0)
 ; Set EABD if no bill and no NBR
"RTN","IBNCPDP4",70,0)
 I '$P($G(^IBT(356,IBTRKRN,0)),U,11),'IBNBR D
"RTN","IBNCPDP4",71,0)
 . S IBEABD=$$EABD^IBTUTL($O(^IBE(356.6,"AC",4,0)),IBADT)
"RTN","IBNCPDP4",72,0)
 . S:'IBEABD IBEABD=DT
"RTN","IBNCPDP4",73,0)
 . S IBEABD=$$FMADD^XLFDT(IBEABD,60)
"RTN","IBNCPDP4",74,0)
 . S DR=DR_".17////^S X=IBEABD;"
"RTN","IBNCPDP4",75,0)
 ;
"RTN","IBNCPDP4",76,0)
 ; Set ECME Flags
"RTN","IBNCPDP4",77,0)
 S DR=DR_"1.1////"_IBD("CLAIMID")_";"
"RTN","IBNCPDP4",78,0)
 ; Reject status will not be set here
"RTN","IBNCPDP4",79,0)
 ;
"RTN","IBNCPDP4",80,0)
 D ^DIE
"RTN","IBNCPDP4",81,0)
 I IBLOCK2 L -^IBT(356,IBTRKRN)
"RTN","IBNCPDP4",82,0)
 ; 
"RTN","IBNCPDP4",83,0)
 S IBRES=1
"RTN","IBNCPDP4",84,0)
RELQ ;
"RTN","IBNCPDP4",85,0)
 D LOG^IBNCPDP2("RELEASE",IBRES)
"RTN","IBNCPDP4",86,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP4",87,0)
 Q IBRES
"RTN","IBNCPDP4",88,0)
 ;
"RTN","IBNCPDP4",89,0)
SUBMIT(DFN,IBD) ;
"RTN","IBNCPDP4",90,0)
 N IBRES,IBLOCK,IBADT,IBRXN,IBFIL,IBRDT,IBNBR,IBFLAG,IBTRKR,IBTRKRN
"RTN","IBNCPDP4",91,0)
 N IBRESP,DA,DIE,DR
"RTN","IBNCPDP4",92,0)
 S IBLOCK=0
"RTN","IBNCPDP4",93,0)
 S IBADT=+$G(IBD("FILL DATE")) I 'IBADT S IBRES="0^No fill date" G SUBQ
"RTN","IBNCPDP4",94,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBRES="0^No Rx IEN" G SUBQ
"RTN","IBNCPDP4",95,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBRES="0^No fill number" G SUBQ
"RTN","IBNCPDP4",96,0)
 S IBRESP=$G(IBD("RESPONSE")) I IBRESP="" S IBRES="0^No response from the payer" G SUBQ
"RTN","IBNCPDP4",97,0)
 S IBRDT=+$G(IBD("RELEASE DATE"),-1)
"RTN","IBNCPDP4",98,0)
 S IBD("BCID")=IBD("CLAIMID")_";"_IBADT
"RTN","IBNCPDP4",99,0)
 L +^DGCR(399,"AG",IBD("BCID")):5 S IBLOCK=$T
"RTN","IBNCPDP4",100,0)
 ;
"RTN","IBNCPDP4",101,0)
 ; -- claims tracking info
"RTN","IBNCPDP4",102,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBNCPDP4",103,0)
 ; date can't be before parameters
"RTN","IBNCPDP4",104,0)
 S $P(IBTRKR,"^")=$S('$P(IBTRKR,"^",4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPDP4",105,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP4",106,0)
 ;
"RTN","IBNCPDP4",107,0)
 ; If the Rx is not released - set NBR in CT
"RTN","IBNCPDP4",108,0)
 I 'IBRDT,'$P($G(^IBT(356,IBTRKRN,0)),U,19) D NONBR^IBNCPNB(DFN,IBRXN,IBFIL,IBADT,"PRESCRIPTION NOT RELEASED","","","")
"RTN","IBNCPDP4",109,0)
 ;
"RTN","IBNCPDP4",110,0)
 ; If the Rx is released - clean up NBR in CT
"RTN","IBNCPDP4",111,0)
 I IBRDT,$P($G(^IBE(356.8,+$P($G(^IBT(356,IBTRKRN,0)),U,19),0)),U)="PRESCRIPTION NOT RELEASED" D NONBR^IBNCPNB(DFN,IBRXN,IBFIL,IBADT,"","","","")
"RTN","IBNCPDP4",112,0)
 ; Set ECME fields in CT
"RTN","IBNCPDP4",113,0)
 S DIE="^IBT(356,",DA=IBTRKRN
"RTN","IBNCPDP4",114,0)
 S IBFLAG=$S(IBRESP["REJECT":1,1:0)
"RTN","IBNCPDP4",115,0)
 S DR="1.1///"_IBD("CLAIMID")_";1.11///"_IBFLAG
"RTN","IBNCPDP4",116,0)
 D ^DIE
"RTN","IBNCPDP4",117,0)
 S IBRES=1
"RTN","IBNCPDP4",118,0)
SUBQ ;
"RTN","IBNCPDP4",119,0)
 D LOG^IBNCPDP2("SUBMIT",IBRES)
"RTN","IBNCPDP4",120,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP4",121,0)
 Q IBRES
"RTN","IBNCPDP4",122,0)
 ;
"RTN","IBNCPDP4",123,0)
 ;IBNCPDP4
"RTN","IBNCPDPC")
0^49^B34220485
"RTN","IBNCPDPC",1,0)
IBNCPDPC ;DALOI/SS - CLAIMS TRACKING EDITOR for ECME ;27-JUN-2005
"RTN","IBNCPDPC",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPDPC",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDPC",4,0)
 ;This code supports DBIA4693
"RTN","IBNCPDPC",5,0)
 ;
"RTN","IBNCPDPC",6,0)
% ; -- main entry point for IBT CLAIMS TRACKING EDIT
"RTN","IBNCPDPC",7,0)
 ;DFN- patients IEN (file #2)
"RTN","IBNCPDPC",8,0)
 ;IBECMEN - NCPDP/ECME number (last 7 digits of the IEN of file #52)
"RTN","IBNCPDPC",9,0)
 ; that belong to this claim.
"RTN","IBNCPDPC",10,0)
 ;ien in CLAIMS TRACKING file #356  
"RTN","IBNCPDPC",11,0)
 ;
"RTN","IBNCPDPC",12,0)
CT(DFN,IBECMEN,IBREFNUM) ;
"RTN","IBNCPDPC",13,0)
 Q:$$PFSSON^IBNCPDPI()  ;quit if PFSS is ON
"RTN","IBNCPDPC",14,0)
 Q:'$G(DFN)
"RTN","IBNCPDPC",15,0)
 Q:'$G(IBECMEN)
"RTN","IBNCPDPC",16,0)
 N IBTRN
"RTN","IBNCPDPC",17,0)
 S IBTRN=+$$SELCT(IBECMEN,IBREFNUM)
"RTN","IBNCPDPC",18,0)
 I +IBTRN=0 D  Q
"RTN","IBNCPDPC",19,0)
 . W !,"There is no claims tracking record for this claim."
"RTN","IBNCPDPC",20,0)
 . D PAUSE^VALM1
"RTN","IBNCPDPC",21,0)
 D EN^VALM("IBNCPDP LSTMN CT")
"RTN","IBNCPDPC",22,0)
 Q
"RTN","IBNCPDPC",23,0)
 ;
"RTN","IBNCPDPC",24,0)
EN ; -- main entry point for IBT EXPAND/EDIT TRACKING
"RTN","IBNCPDPC",25,0)
 I '$D(DT) D DT^DICRW
"RTN","IBNCPDPC",26,0)
 K XQORS,VALMEVL,DFN,IBTRN,IBTRV,IBTRC,IBTRD
"RTN","IBNCPDPC",27,0)
 I '$G(IBTRN) G EN^IBTRE Q  ; entry from programmer mode
"RTN","IBNCPDPC",28,0)
 D EN^VALM("IBT EXPAND/EDIT TRACKING")
"RTN","IBNCPDPC",29,0)
 K IBFASTXT
"RTN","IBNCPDPC",30,0)
 Q
"RTN","IBNCPDPC",31,0)
 ;
"RTN","IBNCPDPC",32,0)
HDR ; -- header code
"RTN","IBNCPDPC",33,0)
 D PID^VADPT
"RTN","IBNCPDPC",34,0)
 S VALMHDR(1)="Expanded Claims Tracking Info for: "_$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")_"   ROI: "_$$EXPAND^IBTRE(356,.31,$P(^IBT(356,IBTRN,0),"^",31))
"RTN","IBNCPDPC",35,0)
 S VALMHDR(2)="                              For: "_$$ETYP(IBTRN)
"RTN","IBNCPDPC",36,0)
 Q
"RTN","IBNCPDPC",37,0)
 ;
"RTN","IBNCPDPC",38,0)
INIT ; -- init variables and list array
"RTN","IBNCPDPC",39,0)
 K VALMQUIT
"RTN","IBNCPDPC",40,0)
 S VALMCNT=0,VALMBG=1
"RTN","IBNCPDPC",41,0)
 D BLD,HDR
"RTN","IBNCPDPC",42,0)
 Q
"RTN","IBNCPDPC",43,0)
 ;
"RTN","IBNCPDPC",44,0)
BLD ; -- list builder
"RTN","IBNCPDPC",45,0)
 N IBTRND,IBTRND1,IBTRND2,IBETYP
"RTN","IBNCPDPC",46,0)
 K ^TMP("IBTRED",$J)
"RTN","IBNCPDPC",47,0)
 F I=1:1:30 D BLANK(.I)
"RTN","IBNCPDPC",48,0)
 I '$G(IBTRPRF) S IBTRPRF=123
"RTN","IBNCPDPC",49,0)
 I IBTRPRF<10 S X=$S(IBTRPRF=1:"IBTRED  HR MENU",IBTRPRF=2:"IBTRED  IR MENU",IBTRPRF=3:"IBTRED  BI MENU",1:"IBTRED  MENU") D PROT^IBTRPR(X)
"RTN","IBNCPDPC",50,0)
 D KILL^VALM10()
"RTN","IBNCPDPC",51,0)
 S IBTRND=$G(^IBT(356,IBTRN,0)),IBTRND1=$G(^(1))
"RTN","IBNCPDPC",52,0)
 S IBETYP=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBNCPDPC",53,0)
 S VALMCNT=30
"RTN","IBNCPDPC",54,0)
 D VISIT D ^IBTRED0,^IBTRED01
"RTN","IBNCPDPC",55,0)
 Q
"RTN","IBNCPDPC",56,0)
 ;
"RTN","IBNCPDPC",57,0)
VISIT ; -- Visit info Region
"RTN","IBNCPDPC",58,0)
 N OFFSET,START,IBOE,IBOE0
"RTN","IBNCPDPC",59,0)
 S START=1,OFFSET=2
"RTN","IBNCPDPC",60,0)
 D SET^IBCNSP(START,OFFSET," Visit Information ",IORVON,IORVOFF)
"RTN","IBNCPDPC",61,0)
 D SET^IBCNSP(START+1,OFFSET,"    Visit Type: "_$P(IBETYP,"^"))
"RTN","IBNCPDPC",62,0)
 I '$D(IBETYP) N IBETYP S IBETYP=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBNCPDPC",63,0)
 S X=$P(IBETYP,"^",3) D @X
"RTN","IBNCPDPC",64,0)
 Q
"RTN","IBNCPDPC",65,0)
1 ; -- visit region for admission or scheduled admission
"RTN","IBNCPDPC",66,0)
 I $P($G(^DGPM(+$P(IBTRND,"^",5),0)),"^",17) S VAINDT=+$G(^DGPM(+$P(IBTRND,"^",5),0))
"RTN","IBNCPDPC",67,0)
 I '$D(VAIN) S VA200="" D INP^VADPT
"RTN","IBNCPDPC",68,0)
 I VAIN(7)="" S Y=$P(IBTRND,"^",6) D D^DIQ S $P(VAIN(7),"^",2)=Y
"RTN","IBNCPDPC",69,0)
 D SET^IBCNSP(START+2,OFFSET,"Admission Date: "_$P(VAIN(7),"^",2))
"RTN","IBNCPDPC",70,0)
 D SET^IBCNSP(START+3,OFFSET,"          Ward: "_$P(VAIN(4),"^",2))
"RTN","IBNCPDPC",71,0)
 D SET^IBCNSP(START+4,OFFSET,"     Specialty: "_$P(VAIN(3),"^",2))
"RTN","IBNCPDPC",72,0)
 Q
"RTN","IBNCPDPC",73,0)
2 ; -- visit region for  outpatient care
"RTN","IBNCPDPC",74,0)
 S IBOE=$P(IBTRND,"^",4),IBOE0=$$SCE^IBSDU(+IBOE)
"RTN","IBNCPDPC",75,0)
 D SET^IBCNSP(START+2,OFFSET,"    Visit Date: "_$$DAT1^IBOUTL($P(IBTRND,"^",6),"2P"))
"RTN","IBNCPDPC",76,0)
 I +IBOE<1 D  Q
"RTN","IBNCPDPC",77,0)
 .D SET^IBCNSP(START+3,OFFSET,"  No Outpatient Encounter Found") Q
"RTN","IBNCPDPC",78,0)
 D SET^IBCNSP(START+3,OFFSET,"        Clinic: "_$P($G(^SC(+$P(IBOE0,"^",4),0)),"^"))
"RTN","IBNCPDPC",79,0)
 D SET^IBCNSP(START+4,OFFSET,"  Appt. Status: "_$$EXPAND^IBTRE(409.68,.12,$P(IBOE0,"^",12)))
"RTN","IBNCPDPC",80,0)
 D SET^IBCNSP(START+5,OFFSET,"    Appt. Type: "_$$EXPAND^IBTRE(409.68,.1,$P(IBOE0,"^",10)))
"RTN","IBNCPDPC",81,0)
 D SET^IBCNSP(START+6,OFFSET,"  Special Cond: "_$$ENCL(IBOE))
"RTN","IBNCPDPC",82,0)
 Q
"RTN","IBNCPDPC",83,0)
 ;
"RTN","IBNCPDPC",84,0)
3 ; -- visit region for rx refill
"RTN","IBNCPDPC",85,0)
 N PSONTALK,PSOTMP
"RTN","IBNCPDPC",86,0)
 S PSONTALK=1 ;PSORXN=+$P(IBTRND,"^",8),PSOFILL=+$P(IBTRND,"^",10)
"RTN","IBNCPDPC",87,0)
 S X=+$P(IBTRND,"^",8)_"^"_+$P(IBTRND,"^",10) D EN^PSOCPVW
"RTN","IBNCPDPC",88,0)
 I '$D(PSOTMP) D PSOCPVW(+$P(IBTRND,"^",2),+$P(IBTRND,"^",8),.PSOTMP)
"RTN","IBNCPDPC",89,0)
 D SET^IBCNSP(START+2,OFFSET,"Prescription #: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),.01,"E")))
"RTN","IBNCPDPC",90,0)
 I $P(IBTRND,"^",10)=0 D SET^IBCNSP(START+3,OFFSET,"     Fill Date: "_$$FMTE^XLFDT(+$P(IBTRND,"^",6)))
"RTN","IBNCPDPC",91,0)
 I +$P(IBTRND,"^",10) D SET^IBCNSP(START+3,OFFSET,"   Refill Date: "_$$FMTE^XLFDT(+$P(IBTRND,"^",6)))
"RTN","IBNCPDPC",92,0)
 D SET^IBCNSP(START+4,OFFSET,"          Drug: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),6,"E")))
"RTN","IBNCPDPC",93,0)
 D SET^IBCNSP(START+5,OFFSET,"      Quantity: "_$J($G(PSOTMP(52,+$P(IBTRND,"^",8),7,"E")),8))
"RTN","IBNCPDPC",94,0)
 D SET^IBCNSP(START+6,OFFSET,"   Days Supply: "_$J($G(PSOTMP(52,+$P(IBTRND,"^",8),8,"E")),8))
"RTN","IBNCPDPC",95,0)
 D SET^IBCNSP(START+7,OFFSET,"          NDC#: "_$$GETNDC^PSONDCUT(+$P(IBTRND,"^",8),$P(IBTRND,"^",10)),2)
"RTN","IBNCPDPC",96,0)
 D SET^IBCNSP(START+8,OFFSET,"     Physician: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),4,"E")))
"RTN","IBNCPDPC",97,0)
 Q
"RTN","IBNCPDPC",98,0)
 ;
"RTN","IBNCPDPC",99,0)
4 ; -- Visit region for prosthetics
"RTN","IBNCPDPC",100,0)
 D 4^IBTRED01
"RTN","IBNCPDPC",101,0)
 Q
"RTN","IBNCPDPC",102,0)
 ;
"RTN","IBNCPDPC",103,0)
HELP ; -- help code
"RTN","IBNCPDPC",104,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBNCPDPC",105,0)
 Q
"RTN","IBNCPDPC",106,0)
 ;
"RTN","IBNCPDPC",107,0)
EXIT ; -- exit code
"RTN","IBNCPDPC",108,0)
 K VALMQUIT,IBTRN
"RTN","IBNCPDPC",109,0)
 D CLEAN^VALM10,FULL^VALM1
"RTN","IBNCPDPC",110,0)
 Q
"RTN","IBNCPDPC",111,0)
 ;
"RTN","IBNCPDPC",112,0)
BLANK(LINE) ; -- Build blank line
"RTN","IBNCPDPC",113,0)
 D SET^VALM10(.LINE,$J("",80))
"RTN","IBNCPDPC",114,0)
 Q
"RTN","IBNCPDPC",115,0)
 ;
"RTN","IBNCPDPC",116,0)
ETYP(IBTRN) ; -- Expand type of epidose and date
"RTN","IBNCPDPC",117,0)
 N IBY S IBY=""
"RTN","IBNCPDPC",118,0)
 S IBTRND=$G(^IBT(356,+IBTRN,0)) I IBTRND="" G ETYPQ
"RTN","IBNCPDPC",119,0)
 S IBETYPD=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBNCPDPC",120,0)
 I IBETYPD="" G ETYPQ
"RTN","IBNCPDPC",121,0)
 S IBY=$P(IBETYPD,"^")_" on "_$$DAT1^IBOUTL($P(IBTRND,"^",6),"2P")
"RTN","IBNCPDPC",122,0)
ETYPQ Q IBY
"RTN","IBNCPDPC",123,0)
 ;
"RTN","IBNCPDPC",124,0)
ENCL(IBOE) ; -- output format of classifications
"RTN","IBNCPDPC",125,0)
 N I,X,IBCL,IBCL1 S IBCL=""
"RTN","IBNCPDPC",126,0)
 I '$G(IBOE) G ENCLQ
"RTN","IBNCPDPC",127,0)
 S IBCL1=$$ENCL^IBAMTS2(+IBOE)
"RTN","IBNCPDPC",128,0)
 F I=1:1:7 S X=$P(IBCL1,"^",I) S:X IBCL=IBCL_$S(I=1:"AO",I=2:"IR",I=3:"SC",I=4:"EC",I=5:"MST",I=6:"HNC",I=7:"CV",1:"")_"  "
"RTN","IBNCPDPC",129,0)
ENCLQ Q IBCL
"RTN","IBNCPDPC",130,0)
 ;
"RTN","IBNCPDPC",131,0)
SELCT(IBECMEN,IBREFNUM) ;
"RTN","IBNCPDPC",132,0)
 N IBRET,IB356
"RTN","IBNCPDPC",133,0)
 S (IB356,IBRET)=0
"RTN","IBNCPDPC",134,0)
 F  S IB356=+$O(^IBT(356,"AE",IBECMEN,IB356)) Q:((IB356=0)!(IBRET'=0))  D
"RTN","IBNCPDPC",135,0)
 . I IBREFNUM=+$P($G(^IBT(356,IB356,0)),U,10) S IBRET=IB356
"RTN","IBNCPDPC",136,0)
 Q +IBRET
"RTN","IBNCPDPC",137,0)
 ;
"RTN","IBNCPDPC",138,0)
 ;return RX info 
"RTN","IBNCPDPC",139,0)
 ;IBDFN - patient's DFN
"RTN","IBNCPDPC",140,0)
 ;IBRX - ien in #52
"RTN","IBNCPDPC",141,0)
 ;output in .PSOTMP array
"RTN","IBNCPDPC",142,0)
PSOCPVW(IBDFN,IBRX,PSOTMP) ;
"RTN","IBNCPDPC",143,0)
 Q:($G(IBDFN)=0)!($G(IBRX)=0)
"RTN","IBNCPDPC",144,0)
 K ^TMP($J,"IBNCPDP-RXINFO")
"RTN","IBNCPDPC",145,0)
 D RX^PSO52API(IBDFN,"IBNCPDP-RXINFO",IBRX,"",0)
"RTN","IBNCPDPC",146,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),.01,"E")=$G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,.01))
"RTN","IBNCPDPC",147,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),7,"E")=$G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,7))
"RTN","IBNCPDPC",148,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),8,"E")=$G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,8))
"RTN","IBNCPDPC",149,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),6,"E")=$P($G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,6)),U,2)
"RTN","IBNCPDPC",150,0)
 K ^TMP($J,"IBNCPDP-RXINFO")
"RTN","IBNCPDPC",151,0)
 Q
"RTN","IBNCPDPC",152,0)
 ;
"RTN","IBNCPDPE")
0^50^B17582633
"RTN","IBNCPDPE",1,0)
IBNCPDPE ;DALOI/AAT - NCPDP BILLING EVENTS REPORT ;10-JUN-2003
"RTN","IBNCPDPE",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPDPE",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDPE",4,0)
 ;
"RTN","IBNCPDPE",5,0)
 N IBPAT,IBRX,IBBDT,IBEDT,Y,IBM1,IBM2,IBM3,IBQ,IBSCR,IBPAGE,IBDTL
"RTN","IBNCPDPE",6,0)
 N IBECME
"RTN","IBNCPDPE",7,0)
 S (IBECME,IBPAT,IBRX,IBQ,IBSCR,IBPAGE,IBDTL)=0
"RTN","IBNCPDPE",8,0)
 ;date
"RTN","IBNCPDPE",9,0)
 F  D DATE Q:IBQ  Q:$$TESTDATA
"RTN","IBNCPDPE",10,0)
 Q:IBQ
"RTN","IBNCPDPE",11,0)
 D MODE Q:IBQ
"RTN","IBNCPDPE",12,0)
 D DEVICE Q:IBQ
"RTN","IBNCPDPE",13,0)
 D START^IBNCPER
"RTN","IBNCPDPE",14,0)
 D ^%ZISC
"RTN","IBNCPDPE",15,0)
 I IBQ W !,"Cancelled"
"RTN","IBNCPDPE",16,0)
 Q
"RTN","IBNCPDPE",17,0)
DATE ;
"RTN","IBNCPDPE",18,0)
 S (IBBDT,IBEDT)=DT
"RTN","IBNCPDPE",19,0)
 S %DT="AEX"
"RTN","IBNCPDPE",20,0)
 S %DT("A")="START WITH DATE: ",%DT("B")="TODAY"
"RTN","IBNCPDPE",21,0)
 D ^%DT K %DT
"RTN","IBNCPDPE",22,0)
 I Y<0 S IBQ=1 Q
"RTN","IBNCPDPE",23,0)
 S IBBDT=+Y
"RTN","IBNCPDPE",24,0)
 S %DT="AEX"
"RTN","IBNCPDPE",25,0)
 S %DT("A")="GO TO DATE: ",%DT("B")="TODAY"
"RTN","IBNCPDPE",26,0)
 D ^%DT K %DT
"RTN","IBNCPDPE",27,0)
 I Y<0 S IBQ=1 Q
"RTN","IBNCPDPE",28,0)
 S IBEDT=+Y
"RTN","IBNCPDPE",29,0)
 Q
"RTN","IBNCPDPE",30,0)
 ;
"RTN","IBNCPDPE",31,0)
MODE ;
"RTN","IBNCPDPE",32,0)
 N DIR,DIC,DIRUT,DUOUT
"RTN","IBNCPDPE",33,0)
 S (IBM1,IBM2,IBM3)="A"
"RTN","IBNCPDPE",34,0)
 S DIR(0)="S^P:SINGLE PATIENT;R:SINGLE RX;E:SINGLE ECME #;A:ALL ACTIVITY"
"RTN","IBNCPDPE",35,0)
 S DIR("A")="SINGLE (P)ATIENT, SINGLE (R)X, SINGLE (E)CME #, (A)LL ACTIVITY"
"RTN","IBNCPDPE",36,0)
 S DIR("B")="ALL"
"RTN","IBNCPDPE",37,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",38,0)
 S IBM1=Y
"RTN","IBNCPDPE",39,0)
 I IBM1="P" S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC Q:$D(DUOUT)  S IBPAT=$S(Y>0:+Y,1:0) I 'IBPAT W "   ALL" S IBM1="A"
"RTN","IBNCPDPE",40,0)
 I IBM1="R" S DIC="^PSRX(",DIC(0)="AEQMN" D ^DIC Q:$D(DUOUT)  S IBRX=$S(Y>0:+Y,1:0) I 'IBRX W "   ALL" S IBM1="A"
"RTN","IBNCPDPE",41,0)
 I IBM1="E" S DIR(0)="FO^7:7^I X'?1.7N W !!,""Cannot contain alpha characters"" K X",DIR("A")="Enter ECME #" D ^DIR Q:$D(DUOUT)  S IBECME=$S(+Y>0:Y,1:0) I 'IBECME W "   ALL" S IBM1="A"
"RTN","IBNCPDPE",42,0)
 S IBM2="B"
"RTN","IBNCPDPE",43,0)
 ; if "All"
"RTN","IBNCPDPE",44,0)
 I IBM1="A" D  Q:IBQ
"RTN","IBNCPDPE",45,0)
 .S DIR(0)="S^E:ECME BILLABLE;N:NON ECME BILLABLE;B:BOTH"
"RTN","IBNCPDPE",46,0)
 .S DIR("A")="(E)CME BILLABLE;(N)ON ECME BILLABLE;(B)OTH"
"RTN","IBNCPDPE",47,0)
 .S DIR("B")="BOTH"
"RTN","IBNCPDPE",48,0)
 .D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",49,0)
 .S IBM2=Y
"RTN","IBNCPDPE",50,0)
 ;
"RTN","IBNCPDPE",51,0)
 ;Mail/Window/CMOP?
"RTN","IBNCPDPE",52,0)
 S DIR(0)="S^M:MAIL;W:WINDOW;C:CMOP;A:ALL"
"RTN","IBNCPDPE",53,0)
 S DIR("A")="(M)AIL, (W)INDOW, (C)CMOP, (A)LL"
"RTN","IBNCPDPE",54,0)
 S DIR("B")="ALL"
"RTN","IBNCPDPE",55,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",56,0)
 S IBM3=Y
"RTN","IBNCPDPE",57,0)
 ;
"RTN","IBNCPDPE",58,0)
 S DIR(0)="S^S:SUMMARY REPORT;D:DETAILED REPORT"
"RTN","IBNCPDPE",59,0)
 S DIR("A")="(S)UMMARY REPORT, (D)ETAILED REPORT"
"RTN","IBNCPDPE",60,0)
 S DIR("B")="SUMMARY REPORT"
"RTN","IBNCPDPE",61,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",62,0)
 S IBDTL=($E(Y)="D")
"RTN","IBNCPDPE",63,0)
 Q
"RTN","IBNCPDPE",64,0)
 ;
"RTN","IBNCPDPE",65,0)
TESTDATA() N Y
"RTN","IBNCPDPE",66,0)
 S Y=$$HAVEDATA()
"RTN","IBNCPDPE",67,0)
 I 'Y W !!,"No data found in the specified period.",!
"RTN","IBNCPDPE",68,0)
 Q Y
"RTN","IBNCPDPE",69,0)
 ;
"RTN","IBNCPDPE",70,0)
HAVEDATA() ;
"RTN","IBNCPDPE",71,0)
 N IB1,Z
"RTN","IBNCPDPE",72,0)
 S Z="IBNCPDP-"
"RTN","IBNCPDPE",73,0)
 S IB1=Z_IBBDT
"RTN","IBNCPDPE",74,0)
 I $D(^XTMP(IB1)) Q 1
"RTN","IBNCPDPE",75,0)
 I $O(^XTMP(IB1))'[Z Q 0
"RTN","IBNCPDPE",76,0)
 I $O(^XTMP(IB1))](Z_IBEDT) Q 0
"RTN","IBNCPDPE",77,0)
 Q 1
"RTN","IBNCPDPE",78,0)
 ;
"RTN","IBNCPDPE",79,0)
DEVICE ;
"RTN","IBNCPDPE",80,0)
 N DIR,DIRUT,POP,ZTRTN,ZTIO,ZTSAVE,ZTDESC,%ZIS,ZTSK
"RTN","IBNCPDPE",81,0)
 S %ZIS="QM"
"RTN","IBNCPDPE",82,0)
 W ! D ^%ZIS
"RTN","IBNCPDPE",83,0)
 I POP S IBQ=1 Q
"RTN","IBNCPDPE",84,0)
 S IBSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","IBNCPDPE",85,0)
 ;
"RTN","IBNCPDPE",86,0)
 I $D(IO("Q")) D  S IBQ=1
"RTN","IBNCPDPE",87,0)
 . S ZTRTN="START^IBNCPER"
"RTN","IBNCPDPE",88,0)
 . S ZTIO=ION
"RTN","IBNCPDPE",89,0)
 . S ZTSAVE("IB*")=""
"RTN","IBNCPDPE",90,0)
 . S ZTDESC="IB ECME BILLING EVENTS REPORT"
"RTN","IBNCPDPE",91,0)
 . D ^%ZTLOAD
"RTN","IBNCPDPE",92,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","IBNCPDPE",93,0)
 . D HOME^%ZIS
"RTN","IBNCPDPE",94,0)
 U IO
"RTN","IBNCPDPE",95,0)
 Q
"RTN","IBNCPDPE",96,0)
 ;------ added for the User screen --------
"RTN","IBNCPDPE",97,0)
 ;User Screen Entry point (to call from ECME User Screen)
"RTN","IBNCPDPE",98,0)
 ;IBMODE:
"RTN","IBNCPDPE",99,0)
 ; P-patient
"RTN","IBNCPDPE",100,0)
 ; R-Rx
"RTN","IBNCPDPE",101,0)
 ;IBVAL - patient DFN or RX ien (#52)
"RTN","IBNCPDPE",102,0)
 ;
"RTN","IBNCPDPE",103,0)
USRSCREN(IBMODE,IBVAL) ;
"RTN","IBNCPDPE",104,0)
 Q:$$PFSSON^IBNCPDPI()  ;quit if PFSS is ON
"RTN","IBNCPDPE",105,0)
 N IBPAT,IBRX,IBBDT,IBEDT,Y,IBM1,IBM2,IBM3,IBQ,IBSCR,IBPAGE,IBDTL
"RTN","IBNCPDPE",106,0)
 S (IBPAT,IBRX,IBQ,IBSCR,IBPAGE,IBDTL)=0
"RTN","IBNCPDPE",107,0)
 S IBM1=IBMODE
"RTN","IBNCPDPE",108,0)
 I IBM1="P" S IBPAT=+IBVAL
"RTN","IBNCPDPE",109,0)
 I IBM1="R" S IBRX=+IBVAL
"RTN","IBNCPDPE",110,0)
 ;date
"RTN","IBNCPDPE",111,0)
 F  D DATE Q:IBQ  Q:$$TESTDATA
"RTN","IBNCPDPE",112,0)
 Q:IBQ
"RTN","IBNCPDPE",113,0)
 D MODE2 Q:IBQ
"RTN","IBNCPDPE",114,0)
 D DEVICE Q:IBQ
"RTN","IBNCPDPE",115,0)
 D START^IBNCPER
"RTN","IBNCPDPE",116,0)
 D ^%ZISC
"RTN","IBNCPDPE",117,0)
 I IBQ W !,"Cancelled"
"RTN","IBNCPDPE",118,0)
 Q
"RTN","IBNCPDPE",119,0)
 ;
"RTN","IBNCPDPE",120,0)
MODE2 ;
"RTN","IBNCPDPE",121,0)
 N DIR,DIC,DIRUT,DUOUT
"RTN","IBNCPDPE",122,0)
 S (IBM1,IBM2,IBM3)="A"
"RTN","IBNCPDPE",123,0)
 S IBM2="B"
"RTN","IBNCPDPE",124,0)
 ;
"RTN","IBNCPDPE",125,0)
 ;Mail/Window/CMOP?
"RTN","IBNCPDPE",126,0)
 S DIR(0)="S^M:MAIL;W:WINDOW;C:CMOP;A:ALL"
"RTN","IBNCPDPE",127,0)
 S DIR("A")="(M)AIL, (W)INDOW, (C)CMOP, (A)LL"
"RTN","IBNCPDPE",128,0)
 S DIR("B")="ALL"
"RTN","IBNCPDPE",129,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",130,0)
 S IBM3=Y
"RTN","IBNCPDPE",131,0)
 ;
"RTN","IBNCPDPE",132,0)
 S DIR(0)="S^S:SUMMARY REPORT;D:DETAILED REPORT"
"RTN","IBNCPDPE",133,0)
 S DIR("A")="(S)UMMARY REPORT, (D)ETAILED REPORT"
"RTN","IBNCPDPE",134,0)
 S DIR("B")="SUMMARY REPORT"
"RTN","IBNCPDPE",135,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",136,0)
 S IBDTL=($E(Y)="D")
"RTN","IBNCPDPE",137,0)
 Q
"RTN","IBNCPDPE",138,0)
 ;IBNCPDPE
"RTN","IBNCPDPH")
0^51^B27130556
"RTN","IBNCPDPH",1,0)
IBNCPDPH ;DALOI/SS - ECME REPORT OF ON HOLD CHARGES FOR A PATIENT ;JUNE 08 2005
"RTN","IBNCPDPH",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPDPH",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDPH",4,0)
 Q
"RTN","IBNCPDPH",5,0)
 ;
"RTN","IBNCPDPH",6,0)
 ;made after IBOHPT1 to use with ECME User Screen
"RTN","IBNCPDPH",7,0)
 ;see IA# with ECME
"RTN","IBNCPDPH",8,0)
 ;
"RTN","IBNCPDPH",9,0)
ONHOLD(DFN) ;
"RTN","IBNCPDPH",10,0)
 Q:$$PFSSON^IBNCPDPI()  ;quit if PFSS is ON
"RTN","IBNCPDPH",11,0)
 N IBQUIT,IBII,DIRUT,DUOUT,DTOUT,ZTIO,Y S IBQUIT=0
"RTN","IBNCPDPH",12,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBNCPDPH",13,0)
 ;
"RTN","IBNCPDPH",14,0)
 S DIR(0)="DA^::EX",DIR("A")="Start with DATE: "
"RTN","IBNCPDPH",15,0)
 S DIR("?")="Enter the starting date for this report."
"RTN","IBNCPDPH",16,0)
 D ^DIR K DIR G:$D(DIRUT) EXIT S IBSDT=+Y
"RTN","IBNCPDPH",17,0)
 S DIR(0)="DA^"_+Y_":NOW:EX",DIR("A")="     Go to DATE: "
"RTN","IBNCPDPH",18,0)
 S DIR("?")="Enter the ending date for this report."
"RTN","IBNCPDPH",19,0)
 D ^DIR K DIR G:$D(DIRUT) EXIT S IBEDT=+Y
"RTN","IBNCPDPH",20,0)
 ;
"RTN","IBNCPDPH",21,0)
 S DIR(0)="Y",DIR("A")="Include Pharmacy Co-pay charges on this report",DIR("B")="NO"
"RTN","IBNCPDPH",22,0)
 S DIR("?",1)="   Enter:  'Y' - to include Pharmacy Co-pay charges on this report"
"RTN","IBNCPDPH",23,0)
 S DIR("?",2)="           'N' - to exclude Pharmacy Co-pay charges on this report"
"RTN","IBNCPDPH",24,0)
 S DIR("?")="             '^' - to select a new patient"
"RTN","IBNCPDPH",25,0)
 D ^DIR K DIR G:$D(DIRUT) EXIT S IBIBRX=Y
"RTN","IBNCPDPH",26,0)
 ;
"RTN","IBNCPDPH",27,0)
QUEUED ; entry point if queued
"RTN","IBNCPDPH",28,0)
 ;***
"RTN","IBNCPDPH",29,0)
 K ^TMP($J,"IB")
"RTN","IBNCPDPH",30,0)
 D:'$G(IBQUIT) DEVICE D:'$G(IBQUIT) CHRGS,REPORT^IBOHPT2
"RTN","IBNCPDPH",31,0)
 D EXIT
"RTN","IBNCPDPH",32,0)
 ;***
"RTN","IBNCPDPH",33,0)
 Q
"RTN","IBNCPDPH",34,0)
EXIT ;
"RTN","IBNCPDPH",35,0)
 K ^TMP($J,"IB")
"RTN","IBNCPDPH",36,0)
 K DFN,IBEND,IBSDT,IBEDT,IBIBRX,IBCN,IBDT,IBIFN,X
"RTN","IBNCPDPH",37,0)
 K IBRDT,IBRF,IBRX,IBRXN
"RTN","IBNCPDPH",38,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBNCPDPH",39,0)
 D ^%ZISC
"RTN","IBNCPDPH",40,0)
 Q
"RTN","IBNCPDPH",41,0)
DEVICE ;
"RTN","IBNCPDPH",42,0)
 I $D(ZTQUEUED) Q
"RTN","IBNCPDPH",43,0)
 W !!,*7,"*** Margin width of this output is 132 ***"
"RTN","IBNCPDPH",44,0)
 W !,"*** This output should be queued ***"
"RTN","IBNCPDPH",45,0)
 N %ZIS
"RTN","IBNCPDPH",46,0)
 S %ZIS="QM" D ^%ZIS I POP S IBQUIT=1 Q
"RTN","IBNCPDPH",47,0)
 N ZTRTN,ZTIO,ZTDES,ZTSAVE
"RTN","IBNCPDPH",48,0)
 I $D(IO("Q")) S ZTRTN="QUEUED^IBOHPT1",ZTIO=ION,ZTDESC="ON HOLD CHARGE INFO/PT",ZTSAVE("IB*")="",ZTSAVE("DFN")="" D ^%ZTLOAD W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED") D HOME^%ZIS K ZTSK S IBQUIT=1 Q
"RTN","IBNCPDPH",49,0)
 U IO
"RTN","IBNCPDPH",50,0)
 Q
"RTN","IBNCPDPH",51,0)
 ; indexes records that should be included in report
"RTN","IBNCPDPH",52,0)
 ;
"RTN","IBNCPDPH",53,0)
CHRGS ; charges on hold
"RTN","IBNCPDPH",54,0)
 N DATE,IBN,IBND,A,B,C,D,E,IBNX
"RTN","IBNCPDPH",55,0)
 S IBN=0 F  S IBN=$O(^IB("C",DFN,IBN)) Q:'IBN  S IBND=$G(^IB(IBN,0)) D:IBND
"RTN","IBNCPDPH",56,0)
 .I 'IBIBRX,$E($G(^IBE(350.1,+$P(IBND,"^",3),0)),1,3)="PSO" Q
"RTN","IBNCPDPH",57,0)
 .Q:$P(IBND,"^",8)["ADMISSION"
"RTN","IBNCPDPH",58,0)
 .Q:'$P($G(^IB(IBN,1)),"^",6)
"RTN","IBNCPDPH",59,0)
 .Q:'$D(^IB("APDT",IBN))
"RTN","IBNCPDPH",60,0)
 .S (C,D)="",C=$O(^IB("APDT",IBN,C)),D=$O(^IB("APDT",IBN,C,D))
"RTN","IBNCPDPH",61,0)
 .S E=$P($G(^IB(D,0)),U,3)
"RTN","IBNCPDPH",62,0)
 .S A=$P($G(^IBE(350.1,E,0)),U,5)
"RTN","IBNCPDPH",63,0)
 .S IBNX=$S(A=2:$P($Q(^IB("APDT",IBN,C,D)),")",1),A=3:$P($Q(^IB("APDT",IBN,C,D)),")",1),1:IBN)
"RTN","IBNCPDPH",64,0)
 .I (A=2)!(A=3) D
"RTN","IBNCPDPH",65,0)
 ..I IBNX["[""" S IBNX="^"_$P(IBNX,"]",2)
"RTN","IBNCPDPH",66,0)
 .I $P(IBNX,",",4)>0 S IBNX=$P(IBNX,",",4)
"RTN","IBNCPDPH",67,0)
 .S DATE=$P($G(^IB(+$P(IBND,"^",1),0)),"^",17)
"RTN","IBNCPDPH",68,0)
 .S:'DATE DATE=$P($G(^IB(IBNX,1)),"^",5)
"RTN","IBNCPDPH",69,0)
 .S:'DATE DATE=$P($G(^IB(IBNX,1)),"^",2)\1
"RTN","IBNCPDPH",70,0)
 .I (DATE>(IBSDT-.0001))&(DATE<(IBEDT+.9999)) S ^TMP($J,"IB",-DATE,IBNX)="" D BILLS
"RTN","IBNCPDPH",71,0)
 Q
"RTN","IBNCPDPH",72,0)
 ;
"RTN","IBNCPDPH",73,0)
BILLS ; find bills for charges on hold
"RTN","IBNCPDPH",74,0)
 N IBFR,IBT,IBATYPE,IBTO
"RTN","IBNCPDPH",75,0)
 S IBATYPE=$S($P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^")["OPT":"O",$P($G(^IBE(350.1,+IBND,"^",3,0)),"^")["PSO":"RX",1:"I")
"RTN","IBNCPDPH",76,0)
 S IBFR=$P(IBND,"^",14),IBTO=$P(IBND,"^",15)
"RTN","IBNCPDPH",77,0)
 I IBATYPE="I" D INP
"RTN","IBNCPDPH",78,0)
 I IBATYPE="O" D OPT
"RTN","IBNCPDPH",79,0)
 E  D RX
"RTN","IBNCPDPH",80,0)
 Q
"RTN","IBNCPDPH",81,0)
INP ; inpatient bills
"RTN","IBNCPDPH",82,0)
 N IBEV,IBBILL,IBT,X,X1,X2,IBEND,IBOK
"RTN","IBNCPDPH",83,0)
 S IBEV=$P(IBND,"^",16) Q:'IBEV  ; parent event
"RTN","IBNCPDPH",84,0)
 S IBEV=($P($G(^IB(IBEV,0)),"^",17)\1) Q:'IBEV  ; date of parent event
"RTN","IBNCPDPH",85,0)
 S X1=IBEV,X2=1 D C^%DTC S IBEND=X
"RTN","IBNCPDPH",86,0)
 S IBT=(IBEV-.0001) F  S IBT=$O(^DGCR(399,"D",IBT)) Q:'IBT!(IBT'<IBEND)  S IBBILL=0 F  S IBBILL=$O(^DGCR(399,"D",IBT,IBBILL)) Q:IBBILL=""  D
"RTN","IBNCPDPH",87,0)
 .D INPTCK
"RTN","IBNCPDPH",88,0)
 .I IBOK S ^TMP($J,"IB",-DATE,IBNX,IBBILL)=""
"RTN","IBNCPDPH",89,0)
 Q
"RTN","IBNCPDPH",90,0)
 ;
"RTN","IBNCPDPH",91,0)
INPTCK ; does bill belong to charge? returns IBOK=0 if no
"RTN","IBNCPDPH",92,0)
 N IBBILL0,IBBILLU
"RTN","IBNCPDPH",93,0)
 S IBBILL0=$G(^DGCR(399,IBBILL,0)),IBBILLU=$G(^("U"))
"RTN","IBNCPDPH",94,0)
 S IBOK=1
"RTN","IBNCPDPH",95,0)
CK1 ; for same patient?
"RTN","IBNCPDPH",96,0)
 I DFN=$P(IBBILL0,"^",2)
"RTN","IBNCPDPH",97,0)
 S IBOK=$T
"RTN","IBNCPDPH",98,0)
 Q:'IBOK
"RTN","IBNCPDPH",99,0)
CK2 ; same type- inp or opt?
"RTN","IBNCPDPH",100,0)
 N B S B=$S(+$P(IBBILL0,"^",5)<3:"I",1:"O")
"RTN","IBNCPDPH",101,0)
 I B=IBATYPE
"RTN","IBNCPDPH",102,0)
 S IBOK=$T
"RTN","IBNCPDPH",103,0)
 Q:'IBOK
"RTN","IBNCPDPH",104,0)
CK3 ; overlap in date range?
"RTN","IBNCPDPH",105,0)
 N F,T
"RTN","IBNCPDPH",106,0)
 S F=+IBBILLU,T=$P(IBBILLU,"^",2)
"RTN","IBNCPDPH",107,0)
 I (IBTO<F)!(IBFR>T)
"RTN","IBNCPDPH",108,0)
 S IBOK='$T
"RTN","IBNCPDPH",109,0)
 Q:'IBOK
"RTN","IBNCPDPH",110,0)
CK4 ; insurance bill?
"RTN","IBNCPDPH",111,0)
 I $P(IBBILL0,"^",11)="i"
"RTN","IBNCPDPH",112,0)
 S IBOK=$T
"RTN","IBNCPDPH",113,0)
 Q
"RTN","IBNCPDPH",114,0)
OPT ; outpatient bills
"RTN","IBNCPDPH",115,0)
 N X,IBV,IBBILL,IBOK,IBBILL0
"RTN","IBNCPDPH",116,0)
 S IBV=(IBFR\1)-.0001 F  S IBV=$O(^DGCR(399,"AOPV",DFN,IBV)) Q:'IBV!(IBV>IBTO)  S IBBILL=0 D
"RTN","IBNCPDPH",117,0)
 .F  S IBBILL=$O(^DGCR(399,"AOPV",DFN,IBV,IBBILL)) Q:('IBBILL)  D
"RTN","IBNCPDPH",118,0)
 ..Q:$D(^TMP($J,"IB",-DATE,IBNX,IBBILL))
"RTN","IBNCPDPH",119,0)
 ..S IBBILL0=$G(^DGCR(399,IBBILL,0)) D CK4 Q:'IBOK
"RTN","IBNCPDPH",120,0)
 ..S ^TMP($J,"IB",-DATE,IBNX,IBBILL)=""
"RTN","IBNCPDPH",121,0)
 Q
"RTN","IBNCPDPH",122,0)
RX ; rx refill bills
"RTN","IBNCPDPH",123,0)
 Q:'IBIBRX
"RTN","IBNCPDPH",124,0)
 S (IBRX,IBRXN,IBRF,IBRDT)=0 N IENS
"RTN","IBNCPDPH",125,0)
 I $P(IBND,"^",4)'["52:" Q
"RTN","IBNCPDPH",126,0)
 ;
"RTN","IBNCPDPH",127,0)
 S IBRXN=$P($P(IBND,"^",4),":",2),IBRX=$P($P(IBND,"^",8),"-"),IBRF=$P($P(IBND,"^",4),":",3)
"RTN","IBNCPDPH",128,0)
 ;
"RTN","IBNCPDPH",129,0)
 I +IBRF>0 S IENS=+IBRF_","_+IBRXN_",",IBRDT=$$GET1^DIQ(52.1,IENS,.01,"I")
"RTN","IBNCPDPH",130,0)
 I +IBRF=0 S IENS=+IBRXN_",",IBRDT=$$GET1^DIQ(52,IENS,22,"I")
"RTN","IBNCPDPH",131,0)
 ;
"RTN","IBNCPDPH",132,0)
 Q:(IBRX="")!('IBRDT)
"RTN","IBNCPDPH",133,0)
 N X,IBBILL,IBBILL0,IBFILL,IBFILL0,IBOK S IBBILL=0
"RTN","IBNCPDPH",134,0)
 S IBFILL=0 F  S IBFILL=$O(^IBA(362.4,"B",IBRX,IBFILL)) Q:IBFILL=""  D
"RTN","IBNCPDPH",135,0)
 .S IBFILL0=$G(^IBA(362.4,IBFILL,0)) I $P(IBFILL0,"^",3)'=IBRDT Q
"RTN","IBNCPDPH",136,0)
 .S IBBILL=+$P(IBFILL0,"^",2) I 'IBBILL Q
"RTN","IBNCPDPH",137,0)
 .S IBBILL0=$G(^DGCR(399,IBBILL,0)) D CK4 I 'IBOK Q
"RTN","IBNCPDPH",138,0)
 .S ^TMP($J,"IB",-DATE,IBNX,IBBILL)=""
"RTN","IBNCPDPH",139,0)
 Q
"RTN","IBNCPDPI")
0^52^B8352830
"RTN","IBNCPDPI",1,0)
IBNCPDPI ;DALOI/SS - for ECME SCREEN INSURANCE VIEW AND UTILITIES ;05-APR-05
"RTN","IBNCPDPI",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPDPI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDPI",4,0)
 ; -- main entry point
"RTN","IBNCPDPI",5,0)
 Q
"RTN","IBNCPDPI",6,0)
EN ;
"RTN","IBNCPDPI",7,0)
 Q
"RTN","IBNCPDPI",8,0)
EN1(DFN) ;
"RTN","IBNCPDPI",9,0)
 I $G(DFN)'>0 Q
"RTN","IBNCPDPI",10,0)
 Q:$$PFSSON()  ;quit if PFSS is ON
"RTN","IBNCPDPI",11,0)
 N J,POP,START,X,VA,ALMBG,DIC,DT,C,CTRLCOL,DILN
"RTN","IBNCPDPI",12,0)
 ;
"RTN","IBNCPDPI",13,0)
 ;if the user does have IB keys to edit insurances
"RTN","IBNCPDPI",14,0)
 I $D(^XUSEC("IB INSURANCE SUPERVISOR",DUZ))!($D(^XUSEC("IB INSURANCE COMPANY ADD",DUZ))) D  Q
"RTN","IBNCPDPI",15,0)
 . N D1,DA,DDER,DDH,DIE,DR,I
"RTN","IBNCPDPI",16,0)
 . N IBCH,IBCNS,IBCNSEH,IBCNT,IBCPOL,IBDT,IBDUZ,IBFILE,IBLCNT,IBN,IBNEW,IBPPOL
"RTN","IBNCPDPI",17,0)
 . N IBTYP,IBYE,IBCDFN,IBCDFND1,IBCGN
"RTN","IBNCPDPI",18,0)
 . D EN^VALM("IBNCPDP INSURANCE MANAGEMENT")
"RTN","IBNCPDPI",19,0)
 ;if the user doesn't have insurance IB keys
"RTN","IBNCPDPI",20,0)
 D
"RTN","IBNCPDPI",21,0)
 . N D0,IBCAB,IBCDFN,IBCDFND1,IBCNS,IBCNT,IBCPOL,IBDT,IBEXP1
"RTN","IBNCPDPI",22,0)
 . N IBEXP2,IBFILE,IBLCNT,IBN,IBPPOL
"RTN","IBNCPDPI",23,0)
 . D EN1^IBNCPDPV(DFN)
"RTN","IBNCPDPI",24,0)
 Q
"RTN","IBNCPDPI",25,0)
 ;
"RTN","IBNCPDPI",26,0)
INIT ; -- set up initial variables
"RTN","IBNCPDPI",27,0)
 ;DFN should be defined
"RTN","IBNCPDPI",28,0)
 I '$D(DFN) Q
"RTN","IBNCPDPI",29,0)
 S U="^",VALMCNT=0,VALMBG=1
"RTN","IBNCPDPI",30,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBNCPDPI",31,0)
 S IBTYP="P"
"RTN","IBNCPDPI",32,0)
 D BLD^IBCNSM
"RTN","IBNCPDPI",33,0)
 Q
"RTN","IBNCPDPI",34,0)
 ;
"RTN","IBNCPDPI",35,0)
HDR ; -- screen header for initial screen
"RTN","IBNCPDPI",36,0)
 D HDR^IBCNSM
"RTN","IBNCPDPI",37,0)
 Q
"RTN","IBNCPDPI",38,0)
 ;
"RTN","IBNCPDPI",39,0)
HELP ; -- help code
"RTN","IBNCPDPI",40,0)
 Q
"RTN","IBNCPDPI",41,0)
 ;
"RTN","IBNCPDPI",42,0)
EXIT ; -- exit code
"RTN","IBNCPDPI",43,0)
 Q
"RTN","IBNCPDPI",44,0)
 ;
"RTN","IBNCPDPI",45,0)
EXPND ; -- expand code
"RTN","IBNCPDPI",46,0)
 Q
"RTN","IBNCPDPI",47,0)
 ;
"RTN","IBNCPDPI",48,0)
 ;check if PFSS On?
"RTN","IBNCPDPI",49,0)
 ;returns:
"RTN","IBNCPDPI",50,0)
 ; 1 - PFSS is ON
"RTN","IBNCPDPI",51,0)
 ; 0 - PFSS is OFF or not installed
"RTN","IBNCPDPI",52,0)
PFSSON() ;
"RTN","IBNCPDPI",53,0)
 N BPST
"RTN","IBNCPDPI",54,0)
 S BPST=0
"RTN","IBNCPDPI",55,0)
 I $L($T(SWSTAT^IBBAPI))>0 S BPST=+$$SWSTAT^IBBAPI()
"RTN","IBNCPDPI",56,0)
 I BPST=1 D  Q 1
"RTN","IBNCPDPI",57,0)
 . W !,"This functionality is not supported on PFSS sites." D PAUSE^VALM1
"RTN","IBNCPDPI",58,0)
 Q 0
"RTN","IBNCPDPI",59,0)
 ;**
"RTN","IBNCPDPI",60,0)
 ;API for ECME (DBIA #4721)
"RTN","IBNCPDPI",61,0)
 ;Insurance Company lookup API
"RTN","IBNCPDPI",62,0)
 ;NOTE: PFSS needs to modify this code to return back values
"RTN","IBNCPDPI",63,0)
 ;  from the appropriate PFSS file instead of ALL ("0")
"RTN","IBNCPDPI",64,0)
 ;input:
"RTN","IBNCPDPI",65,0)
 ; PRMTMSG - prompt message
"RTN","IBNCPDPI",66,0)
 ; DFLTVAL - INSURANCE NAME as a default value for the prompt (optional)
"RTN","IBNCPDPI",67,0)
 ;output:
"RTN","IBNCPDPI",68,0)
 ; IEN^INSURANCE_NAME^PFSS_STATUS
"RTN","IBNCPDPI",69,0)
 ;   0^^PFSS_STATUS  means ALL selected (temporary solution for PFSS sites)
"RTN","IBNCPDPI",70,0)
 ;  -1^^PFSS_STATUS  nothing was selected, timeout expired or uparrow entered
"RTN","IBNCPDPI",71,0)
 ; where: IEN is record number in file #36.  
"RTN","IBNCPDPI",72,0)
 ; PFSS_STATUS - the value returned by the PFSS switch: 0 - OFF, 1- ON 
"RTN","IBNCPDPI",73,0)
SELINSUR(PRMTMSG,DFLTVAL) ;*/
"RTN","IBNCPDPI",74,0)
 N Y,DUOUT,DTOUT,IBQUIT,DIROUT,IBPFSS
"RTN","IBNCPDPI",75,0)
 S IBPFSS=$$PFSSON()
"RTN","IBNCPDPI",76,0)
 ;PFSS needs to modify this code to return back 
"RTN","IBNCPDPI",77,0)
 ;selection in new PFSS file instead of ALL ("0")
"RTN","IBNCPDPI",78,0)
 I IBPFSS=1 Q "0^^"_IBPFSS
"RTN","IBNCPDPI",79,0)
 S IBQUIT=0
"RTN","IBNCPDPI",80,0)
 N DIC
"RTN","IBNCPDPI",81,0)
 S DIC="^DIC(36,"
"RTN","IBNCPDPI",82,0)
 S DIC(0)="AEMNQ"
"RTN","IBNCPDPI",83,0)
 S:$L($G(DFLTVAL))>0 DIC("B")=DFLTVAL
"RTN","IBNCPDPI",84,0)
 S DIC("A")=PRMTMSG_": "
"RTN","IBNCPDPI",85,0)
 D ^DIC
"RTN","IBNCPDPI",86,0)
 I (Y=-1)!$D(DUOUT)!$D(DTOUT) S IBQUIT=1
"RTN","IBNCPDPI",87,0)
 I IBQUIT=1 Q "-1^^"_IBPFSS
"RTN","IBNCPDPI",88,0)
 Q Y_U_IBPFSS
"RTN","IBNCPDPI",89,0)
 ;
"RTN","IBNCPDPI",90,0)
 ;API for ECME (DBIA #4729)
"RTN","IBNCPDPI",91,0)
 ;Determine Bill# and Account Receivable information about the bill
"RTN","IBNCPDPI",92,0)
 ;input:
"RTN","IBNCPDPI",93,0)
 ; IBRX - pointer to file #52 (internal prescription number)
"RTN","IBNCPDPI",94,0)
 ; IBREF - re-fill number
"RTN","IBNCPDPI",95,0)
 ;output:
"RTN","IBNCPDPI",96,0)
 ;Returns a string of information about the bill requested: 
"RTN","IBNCPDPI",97,0)
 ; piece #1:  Bill number (field(#.01) of file (#399))
"RTN","IBNCPDPI",98,0)
 ; piece #2:  Original Amount of bill 
"RTN","IBNCPDPI",99,0)
 ; piece #3:  Current Status (pointer to file #430.3) 
"RTN","IBNCPDPI",100,0)
 ; piece #4:  Current Balance 
"RTN","IBNCPDPI",101,0)
 ; piece #5:  Total Collected 
"RTN","IBNCPDPI",102,0)
 ; piece #6:  % Collected Returns null if no data or bill found.  
"RTN","IBNCPDPI",103,0)
 ; piece #7:  PFSS switch status: 0-OFF, 1-ON
"RTN","IBNCPDPI",104,0)
 ;On PFSS site the API will always return "^^^^^^1"
"RTN","IBNCPDPI",105,0)
 ;
"RTN","IBNCPDPI",106,0)
BILLINFO(IBRX,IBREF) ;
"RTN","IBNCPDPI",107,0)
 N IBIEN,IBBNUM,RCRET
"RTN","IBNCPDPI",108,0)
 N IBPFSS,IBRETV
"RTN","IBNCPDPI",109,0)
 S RCRET="",IBRETV=""
"RTN","IBNCPDPI",110,0)
 S IBPFSS=$$PFSSON()
"RTN","IBNCPDPI",111,0)
 I IBPFSS=1 S $P(IBRETV,U,7)=IBPFSS Q IBRETV
"RTN","IBNCPDPI",112,0)
 S IBBNUM=$$BILL^IBNCPDPU(IBRX,IBREF)
"RTN","IBNCPDPI",113,0)
 I IBBNUM]"" D
"RTN","IBNCPDPI",114,0)
 .S IBIEN=$O(^DGCR(399,"B",IBBNUM,"")) Q:IBIEN=""
"RTN","IBNCPDPI",115,0)
 .S RCRET=$$BILL^RCJIBFN2(IBIEN)
"RTN","IBNCPDPI",116,0)
 S IBRETV=IBBNUM_U_RCRET
"RTN","IBNCPDPI",117,0)
 S $P(IBRETV,U,7)=IBPFSS
"RTN","IBNCPDPI",118,0)
 Q IBRETV
"RTN","IBNCPDPI",119,0)
 ;
"RTN","IBNCPDPI",120,0)
 ;entry point for TPJI option of the ECME User Screen
"RTN","IBNCPDPI",121,0)
TPJI(DFN) ;
"RTN","IBNCPDPI",122,0)
 Q:$$PFSSON()  ;quit if PFSS is ON
"RTN","IBNCPDPI",123,0)
 I DFN>0 D EN^IBJTLA
"RTN","IBNCPDPI",124,0)
 Q
"RTN","IBNCPDPI",125,0)
 ;
"RTN","IBNCPDPL")
0^53^B771797
"RTN","IBNCPDPL",1,0)
IBNCPDPL ;DALOI/SS - for ECME RESEARCH SCREEN ELIGIBILITY VIEW ;05-APR-05
"RTN","IBNCPDPL",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPDPL",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDPL",4,0)
 ;
"RTN","IBNCPDPL",5,0)
EN ;
"RTN","IBNCPDPL",6,0)
 Q
"RTN","IBNCPDPL",7,0)
 ;
"RTN","IBNCPDPL",8,0)
 ; -- main entry point for IBNCPDP LSTMN ELIGIBILITY
"RTN","IBNCPDPL",9,0)
 ;entry point for ECME "VE View Eligibility" menu option 
"RTN","IBNCPDPL",10,0)
 ;of the main ECME User Screen
"RTN","IBNCPDPL",11,0)
EN1(DFN) ;
"RTN","IBNCPDPL",12,0)
 Q:$$PFSSON^IBNCPDPI()  ;quit if PFSS is ON
"RTN","IBNCPDPL",13,0)
 I $G(DFN)>0 D EN^VALM("IBNCPDP LSTMN ELIGIBILITY")
"RTN","IBNCPDPL",14,0)
 Q
"RTN","IBNCPDPL",15,0)
 ;
"RTN","IBNCPDPL",16,0)
HDR ; -- header code
"RTN","IBNCPDPL",17,0)
 D HDR^IBJTEA
"RTN","IBNCPDPL",18,0)
 Q
"RTN","IBNCPDPL",19,0)
 ;
"RTN","IBNCPDPL",20,0)
INIT ; -- init variables and list array
"RTN","IBNCPDPL",21,0)
 ;D INIT^IBJTEA
"RTN","IBNCPDPL",22,0)
 ;borrowed from INIT^IBJTEA with some changes
"RTN","IBNCPDPL",23,0)
 K ^TMP("IBJTEA",$J)
"RTN","IBNCPDPL",24,0)
 I '$G(DFN) S VALMQUIT="" Q
"RTN","IBNCPDPL",25,0)
 D BLD^IBJTEA
"RTN","IBNCPDPL",26,0)
 Q
"RTN","IBNCPDPL",27,0)
 ;
"RTN","IBNCPDPL",28,0)
HELP ; -- help code
"RTN","IBNCPDPL",29,0)
 D HELP^IBJTEA
"RTN","IBNCPDPL",30,0)
 Q
"RTN","IBNCPDPL",31,0)
 ;
"RTN","IBNCPDPL",32,0)
EXIT ; -- exit code
"RTN","IBNCPDPL",33,0)
 D EXIT^IBJTEA
"RTN","IBNCPDPL",34,0)
 Q
"RTN","IBNCPDPL",35,0)
 ;
"RTN","IBNCPDPL",36,0)
EXPND ; -- expand code
"RTN","IBNCPDPL",37,0)
 Q
"RTN","IBNCPDPL",38,0)
 ;
"RTN","IBNCPDPR")
0^54^B26832098
"RTN","IBNCPDPR",1,0)
IBNCPDPR ;WOIFO/SS - ECME RELEASE CHARGES ON HOLD ;JUNE 08 2005
"RTN","IBNCPDPR",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPDPR",3,0)
 ;; Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDPR",4,0)
 Q
"RTN","IBNCPDPR",5,0)
 ;==========
"RTN","IBNCPDPR",6,0)
 ;version of "IB MT RELEASE CHARGES" option (^IBREL) without PATIENT prompt
"RTN","IBNCPDPR",7,0)
 ;(patient is selected from the User Screen)
"RTN","IBNCPDPR",8,0)
 ;designed to use from ECME User Screen (IA #) in order to access Release 
"RTN","IBNCPDPR",9,0)
 ;copay functionality from ECME
"RTN","IBNCPDPR",10,0)
 ;
"RTN","IBNCPDPR",11,0)
RELH(DFN,IBRXIEN,IBREFL,IBMODE) ;
"RTN","IBNCPDPR",12,0)
 Q:$$PFSSON^IBNCPDPI()  ;quit if PFSS is ON
"RTN","IBNCPDPR",13,0)
 K IBA,PRCABN,BPX,IBI,IBCNT,IB350
"RTN","IBNCPDPR",14,0)
 S IB350=0
"RTN","IBNCPDPR",15,0)
 S IBI=0 F IBNUM=1:1 S IBI=$O(^IB("AH",DFN,IBI)) Q:'IBI  S IBA(IBNUM)=IBI
"RTN","IBNCPDPR",16,0)
 I '$D(IBA) W !!,"This patient does not have any charges 'on hold.'",! G ASK
"RTN","IBNCPDPR",17,0)
 ;
"RTN","IBNCPDPR",18,0)
 S IBPT=$$PT^IBEFUNC(DFN) W @IOF,$P(IBPT,"^"),"      Pt ID: ",$P(IBPT,"^",2),! S I="",$P(I,"-",80)="" W I K I
"RTN","IBNCPDPR",19,0)
 ;if the user selected specific RX/refill
"RTN","IBNCPDPR",20,0)
 I IBMODE="C" D  S:IB350>0 DIR("B")=$P(IB350,U,2)
"RTN","IBNCPDPR",21,0)
 . ;find item that matches selected RX/refill
"RTN","IBNCPDPR",22,0)
 . S IBCNT=0
"RTN","IBNCPDPR",23,0)
 . F  S IBCNT=$O(IBA(IBCNT)) Q:+IBCNT=0  D  Q:IB350>0
"RTN","IBNCPDPR",24,0)
 . . S BPX=$P($G(^IB(IBA(IBCNT),0)),U,4)
"RTN","IBNCPDPR",25,0)
 . . I $P(BPX,":")'=52 Q  ;if not RX type
"RTN","IBNCPDPR",26,0)
 . . I $P($P(BPX,";"),":",2)'=IBRXIEN Q  ;if not given RX#
"RTN","IBNCPDPR",27,0)
 . . I IBREFL>0 I $P($P(BPX,";",2),":",2)'=IBREFL Q  ;if not given refill #
"RTN","IBNCPDPR",28,0)
 . . S IB350=IBA(IBCNT)_"^"_IBCNT
"RTN","IBNCPDPR",29,0)
 ;
"RTN","IBNCPDPR",30,0)
 I IBMODE="C",IB350=0 D  G ASK
"RTN","IBNCPDPR",31,0)
 . W !!,"There is no copay charge 'on hold' for this Rx.",!
"RTN","IBNCPDPR",32,0)
 . D PAUSE^VALM1
"RTN","IBNCPDPR",33,0)
 D RESUME
"RTN","IBNCPDPR",34,0)
 Q
"RTN","IBNCPDPR",35,0)
 ;
"RTN","IBNCPDPR",36,0)
 ;
"RTN","IBNCPDPR",37,0)
ASK ;stub for  ASK
"RTN","IBNCPDPR",38,0)
 Q
"RTN","IBNCPDPR",39,0)
 ;
"RTN","IBNCPDPR",40,0)
 ;the following code was borrowed from IBRREL without changes.
"RTN","IBNCPDPR",41,0)
 ;This was done to avoid code changes in the original code and 
"RTN","IBNCPDPR",42,0)
 ;re-testing it in IB package
"RTN","IBNCPDPR",43,0)
 ; - display header and list charges
"RTN","IBNCPDPR",44,0)
RESUME W !!,"The following IB Actions ",$S($D(PRCABN):"associated with this bill",1:"for this patient")," are ON HOLD:" D HDR
"RTN","IBNCPDPR",45,0)
 S IBQ=0 F IBNUM=1:1 Q:'$D(IBA(IBNUM))  D:'(IBNUM#15)  Q:IBQ  S IBN=IBA(IBNUM) D LST
"RTN","IBNCPDPR",46,0)
 . R !,"Enter RETURN to continue or '^' to stop: ",X:DTIME S:X["^"!('$T) IBQ=1 Q
"RTN","IBNCPDPR",47,0)
 ;
"RTN","IBNCPDPR",48,0)
 ; - prompt user to select IB Actions
"RTN","IBNCPDPR",49,0)
 S DIR(0)="LA^1:"_(IBNUM-1)_"^K:X[""."" X",DIR("A")="Select IB Action"_$E("s",IBNUM>2)_" (REF #) to release (or '^' to exit): ",DIR("?")="^D HELP^IBRREL"
"RTN","IBNCPDPR",50,0)
 W ! D ^DIR K DIR I $D(DIRUT)!($D(DUOUT)) G END:$D(PRCABN) D END W ! G ASK
"RTN","IBNCPDPR",51,0)
 ;
"RTN","IBNCPDPR",52,0)
 S IBRANGE=Y,IBSEQNO=1,IBDUZ=DUZ
"RTN","IBNCPDPR",53,0)
 ;
"RTN","IBNCPDPR",54,0)
 S DIR(0)="Y",DIR("A")="OK to pass "_$S($P(Y,",",2):"these charges",1:"this charge")_" to Accounts Receivable"
"RTN","IBNCPDPR",55,0)
 D ^DIR K DIR I 'Y!($D(DIRUT))!($D(DUOUT)) G END:$D(PRCABN) D END W ! G ASK
"RTN","IBNCPDPR",56,0)
 ;
"RTN","IBNCPDPR",57,0)
 ; - pass charges to Accounts Receivable
"RTN","IBNCPDPR",58,0)
 W !!,"Passing charges to Accounts Receivable...",! D HDR
"RTN","IBNCPDPR",59,0)
 F IBCTR=1:1 S IBNUM=$P(IBRANGE,",",IBCTR) Q:'IBNUM  I $D(IBA(IBNUM)) S IBNOS=IBA(IBNUM) D ^IBR,ERR:Y<1 I Y>0 S IBN=IBA(IBNUM) D LST
"RTN","IBNCPDPR",60,0)
 W !!,"The charge"_$E("s",$P(IBRANGE,",",2)>0)_" listed above "_$S($P(IBRANGE,",",2):"have",1:"has")_" been passed to Accounts Receivable.",!
"RTN","IBNCPDPR",61,0)
 ;
"RTN","IBNCPDPR",62,0)
 I '$D(PRCABN) W !! S DIR(0)="E" D ^DIR K DIR D END W ! G ASK
"RTN","IBNCPDPR",63,0)
 ;
"RTN","IBNCPDPR",64,0)
END K DIC,DIRUT,DUOUT,DTOUT,IBA,IBAFY,IBARTYP,IBATYP,IBCTR,IBN,IBDA,IBDUZ
"RTN","IBNCPDPR",65,0)
 K IBFAC,IBI,IBIL,IBRANGE,IBNOS,IBNUM,IBPT,IBQ,IBSEQNO,IBSERV,IBSITE
"RTN","IBNCPDPR",66,0)
 K IBTOTL,IBTRAN,IBWHER,VA,VAERR,VADM
"RTN","IBNCPDPR",67,0)
 K:'$D(PRCABN) DFN
"RTN","IBNCPDPR",68,0)
 ;***
"RTN","IBNCPDPR",69,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBRREL" D T1^%ZOSV ;stop rt clock
"RTN","IBNCPDPR",70,0)
 Q
"RTN","IBNCPDPR",71,0)
 ;
"RTN","IBNCPDPR",72,0)
 ;
"RTN","IBNCPDPR",73,0)
HDR ; Display charge header.
"RTN","IBNCPDPR",74,0)
 N IBLINE S $P(IBLINE,"=",81)=""
"RTN","IBNCPDPR",75,0)
 W !,IBLINE,!," REF   Action ID  Bill Type",?42,"Bill #",?51,"Fr/Fl Dt",?61,"To/Rls Dt",?73,"Charge"
"RTN","IBNCPDPR",76,0)
 W !,IBLINE Q
"RTN","IBNCPDPR",77,0)
 ;
"RTN","IBNCPDPR",78,0)
LST ; Display individual IB Action.
"RTN","IBNCPDPR",79,0)
 N IBND,IBND1,IBRXN,IBRX,IBRF,IBRDT,IENS
"RTN","IBNCPDPR",80,0)
 S IBND=$G(^IB(IBN,0)),IBND1=$G(^IB(IBN,1)),(IBRXN,IBRX,IBRF,IBRDT)=0
"RTN","IBNCPDPR",81,0)
 I $P(IBND,"^",4)["52:" S IBRXN=$P($P(IBND,"^",4),":",2),IBRX=$P($P(IBND,"^",8),"-"),IBRF=$P($P(IBND,"^",4),":",3)
"RTN","IBNCPDPR",82,0)
 I IBRF>0 S IENS=+IBRF_","_+IBRXN_",",IBRDT=$$GET1^DIQ(52.1,IENS,.01,"I")
"RTN","IBNCPDPR",83,0)
 E  S IENS=+IBRXN_",",IBRDT=$$GET1^DIQ(52,IENS,22,"I")
"RTN","IBNCPDPR",84,0)
 W !?1,$J(IBNUM,2),?7,$J(+IBND,9)
"RTN","IBNCPDPR",85,0)
 W ?18,$S(IBRXN>0:"Rx #: "_IBRX_$S(IBRF>0:"("_IBRF_")",1:""),1:$P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^",8))
"RTN","IBNCPDPR",86,0)
 W ?42,$P($P(IBND,"^",11),"-",2)
"RTN","IBNCPDPR",87,0)
 W ?51,$$DAT1^IBOUTL($S(IBRXN>0:IBRDT,1:$P(IBND,"^",14)))
"RTN","IBNCPDPR",88,0)
 W ?61,$$DAT1^IBOUTL($S($P(IBND,"^",15)'="":($P(IBND,"^",15)),1:$P(IBND1,"^",2)))
"RTN","IBNCPDPR",89,0)
 W ?70,$J(+$P(IBND,"^",7),9,2)
"RTN","IBNCPDPR",90,0)
 Q
"RTN","IBNCPDPR",91,0)
 ;
"RTN","IBNCPDPR",92,0)
ERR ; Display error message.
"RTN","IBNCPDPR",93,0)
 W !?1,$J(IBNUM,2),?7,"Error encountered - a separate bulletin has been posted"
"RTN","IBNCPDPR",94,0)
 Q
"RTN","IBNCPDPR",95,0)
 ;
"RTN","IBNCPDPR",96,0)
HLP ; Display basic help message.
"RTN","IBNCPDPR",97,0)
 W !!,"Enter:    the name of a patient with charges 'on hold,' or"
"RTN","IBNCPDPR",98,0)
 W !?10,"'??' --  to see all patients with charges 'on hold,' or"
"RTN","IBNCPDPR",99,0)
 W !?10,"'^'  --  to quit this option.",!
"RTN","IBNCPDPR",100,0)
 Q
"RTN","IBNCPDPR",101,0)
 ;
"RTN","IBNCPDPR",102,0)
HLP1 ; Display all patients with charges 'on hold.'
"RTN","IBNCPDPR",103,0)
 N DFN,I,IBQ,PID
"RTN","IBNCPDPR",104,0)
 W !!,"The following patients have charges 'on hold:'"
"RTN","IBNCPDPR",105,0)
 S (DFN,IBQ)=0 F I=1:1 S DFN=$O(^IB("AH",DFN)) Q:'DFN  D:'(I#15)  Q:IBQ  S PID=$$PT^IBEFUNC(DFN) W !?3,$P(PID,"^"),$J("",10),$P(PID,"^",2)
"RTN","IBNCPDPR",106,0)
 . R !,"Enter RETURN to continue or '^' to stop: ",X:DTIME S:X["^"!('$T) IBQ=1 Q
"RTN","IBNCPDPR",107,0)
 W ! Q
"RTN","IBNCPDPR",108,0)
 ;
"RTN","IBNCPDPR",109,0)
HELP ; Help for the 'Select' prompt.
"RTN","IBNCPDPR",110,0)
 W !!?4,"Please enter a list or range of IB Actions (i.e. 1,3,5 or 2-4,8), none"
"RTN","IBNCPDPR",111,0)
 W !?4,"greater than ",IBNUM-1,", to be passed to Accounts Receivable, or '^' to quit."
"RTN","IBNCPDPR",112,0)
 Q
"RTN","IBNCPDPR",113,0)
 ;
"RTN","IBNCPDPR",114,0)
 ;
"RTN","IBNCPDPR",115,0)
AR ; Accounts Receivable entry point to release charges.
"RTN","IBNCPDPR",116,0)
 ;   Input: PRCABN -- ien of Bill/Accounts Receivable
"RTN","IBNCPDPR",117,0)
 Q:$D(PRCABN)[0  Q:'$$IB^IBRUTL(PRCABN,1)  G RESUME
"RTN","IBNCPDPR",118,0)
 ;
"RTN","IBNCPDPU")
0^55^B59250332
"RTN","IBNCPDPU",1,0)
IBNCPDPU ;OAK/ELZ - UTILITIES FOR NCPCP ;24-JUN-2003
"RTN","IBNCPDPU",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276**;21-MAR-94
"RTN","IBNCPDPU",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDPU",4,0)
 ;
"RTN","IBNCPDPU",5,0)
 ;NCPDP PHASE III
"RTN","IBNCPDPU",6,0)
 Q
"RTN","IBNCPDPU",7,0)
 ;IA 4702
"RTN","IBNCPDPU",8,0)
 ;
"RTN","IBNCPDPU",9,0)
 ;
"RTN","IBNCPDPU",10,0)
CT(DFN,IBRXN,IBFIL,IBADT,IBRMARK) ; files in claims tracking
"RTN","IBNCPDPU",11,0)
 ; Input:
"RTN","IBNCPDPU",12,0)
 ;  DFN - Patient IEN
"RTN","IBNCPDPU",13,0)
 ;  IBRXN - Rx IEN
"RTN","IBNCPDPU",14,0)
 ;  IBFIL - Fill#
"RTN","IBNCPDPU",15,0)
 ;  IBADT - Fill Date
"RTN","IBNCPDPU",16,0)
 ;  IBRMARK - Non-billable Reason (.01 from 356.8)
"RTN","IBNCPDPU",17,0)
 ;
"RTN","IBNCPDPU",18,0)
 N DIE,DR,DA,IBRXTYP,IBEABD
"RTN","IBNCPDPU",19,0)
 I IBTRKRN D:$D(IBRMARK)  Q
"RTN","IBNCPDPU",20,0)
 . S DIE="^IBT(356,",DA=IBTRKRN,DR=".19///"_IBRMARK D ^DIE
"RTN","IBNCPDPU",21,0)
 ; event type pointer for rx billing
"RTN","IBNCPDPU",22,0)
 S IBRXTYP=$O(^IBE(356.6,"AC",4,0))
"RTN","IBNCPDPU",23,0)
 ; earliest auto-billing date
"RTN","IBNCPDPU",24,0)
 S IBEABD=$$EABD^IBTUTL(IBRXTYP,$$FMADD^XLFDT(IBADT,60))
"RTN","IBNCPDPU",25,0)
 ; space out earliest auto bill date
"RTN","IBNCPDPU",26,0)
 D REFILL^IBTUTL1(DFN,IBRXTYP,IBADT,IBRXN,IBFIL,$G(IBRMARK),IBEABD)
"RTN","IBNCPDPU",27,0)
 Q
"RTN","IBNCPDPU",28,0)
 ;
"RTN","IBNCPDPU",29,0)
NDC(X) ; Massage the NDC as it is stored in Pharmacy
"RTN","IBNCPDPU",30,0)
 ;  Input:  X  --  The NDC as it is stored in Pharmacy
"RTN","IBNCPDPU",31,0)
 ; Output:  X  --  The NDC in the format 5N 1"-" 4N 1"-" 2N
"RTN","IBNCPDPU",32,0)
 ;
"RTN","IBNCPDPU",33,0)
 I $G(X)="" S X="" G NDCQ
"RTN","IBNCPDPU",34,0)
 ;
"RTN","IBNCPDPU",35,0)
 N LEN,PCE,Y,Z
"RTN","IBNCPDPU",36,0)
 ;
"RTN","IBNCPDPU",37,0)
 S Z(1)=5,Z(2)=4,Z(3)=2
"RTN","IBNCPDPU",38,0)
 S PCE=0 F  S PCE=$O(Z(PCE)) Q:'PCE  S LEN=Z(PCE) D
"RTN","IBNCPDPU",39,0)
 .S Y=$P(X,"-",PCE)
"RTN","IBNCPDPU",40,0)
 .I $L(Y)>LEN S Y=$E(Y,2,LEN+1)
"RTN","IBNCPDPU",41,0)
 .I $L(+Y)<LEN S Y=$$FILL(Y,LEN)
"RTN","IBNCPDPU",42,0)
 .S $P(X,"-",PCE)=Y
"RTN","IBNCPDPU",43,0)
 ;
"RTN","IBNCPDPU",44,0)
NDCQ Q X
"RTN","IBNCPDPU",45,0)
 ;
"RTN","IBNCPDPU",46,0)
FILL(X,LEN) ; Zero-fill, right justified.
"RTN","IBNCPDPU",47,0)
 N Y
"RTN","IBNCPDPU",48,0)
 S:'$G(LEN) LEN=1
"RTN","IBNCPDPU",49,0)
 S Y=$E($G(X),1,LEN)
"RTN","IBNCPDPU",50,0)
 F  Q:$L(Y)>(LEN-1)  S Y="0"_Y
"RTN","IBNCPDPU",51,0)
 Q Y
"RTN","IBNCPDPU",52,0)
 ;
"RTN","IBNCPDPU",53,0)
PLANN(DFN,IBX,IBADT) ; returns the ien in the insurance multiple for the given plan
"RTN","IBNCPDPU",54,0)
 ; /patient privided.
"RTN","IBNCPDPU",55,0)
 ;   ien in multiple^insurance co ien
"RTN","IBNCPDPU",56,0)
 N IBPOL,IBY,IBR
"RTN","IBNCPDPU",57,0)
 S IBR=""
"RTN","IBNCPDPU",58,0)
 D ALL^IBCNS1(DFN,"IBPOL",3,IBADT)
"RTN","IBNCPDPU",59,0)
 S IBY=0 F  S IBY=$O(IBPOL(IBY)) Q:IBY<1!(IBR)  I $P(IBPOL(IBY,0),"^",18)=IBX S IBR=$P(IBPOL(IBY,0),"^")_"^"_IBY
"RTN","IBNCPDPU",60,0)
 Q IBR
"RTN","IBNCPDPU",61,0)
 ;
"RTN","IBNCPDPU",62,0)
RT(DFN,IBINS,IBN) ; returns rate type to use for bill
"RTN","IBNCPDPU",63,0)
 ; pass in insurance by ref and which insurance entry to use
"RTN","IBNCPDPU",64,0)
 ; if '$d(ibn) then it loops through to find the first one
"RTN","IBNCPDPU",65,0)
 ; format is RT (ien) ^ Rate Type (Tort or Awp or Cost)
"RTN","IBNCPDPU",66,0)
 N VAEL,VAERR,IBPT,IBRT,IBX
"RTN","IBNCPDPU",67,0)
 D ELIG^VADPT
"RTN","IBNCPDPU",68,0)
 ;
"RTN","IBNCPDPU",69,0)
 ; if primary elig is vet type, use reimbursable
"RTN","IBNCPDPU",70,0)
 S IBPT=$P($G(^DIC(8,+VAEL(1),0)),"^",5) ; = N:NON-VETERAN;Y:VETERAN
"RTN","IBNCPDPU",71,0)
 I IBPT="Y" S IBRT=$O(^DGCR(399.3,"B","REIMBURSABLE INS.",0)) Q $S(IBRT:IBRT,1:8)_"^T"
"RTN","IBNCPDPU",72,0)
 ;
"RTN","IBNCPDPU",73,0)
 ;**** temp for initial testing only, we are not doing Tricare or Champva
"RTN","IBNCPDPU",74,0)
 Q $S($D(IBRT):IBRT,1:"0^unable to determine rate type")
"RTN","IBNCPDPU",75,0)
 ;
"RTN","IBNCPDPU",76,0)
 ; if primary elig is TRICARE/CHAMPUS use one of the champus', depending
"RTN","IBNCPDPU",77,0)
 ; on insurance coverage
"RTN","IBNCPDPU",78,0)
 I $P($G(^DIC(8.1,+$P($G(^DIC(8,+VAEL(3),0)),"^",9),0)),"^")="TRICARE/CHAMPUS" S IBRT=$$UINS("CHAMPUS",.IBINS,.IBN)
"RTN","IBNCPDPU",79,0)
 ;
"RTN","IBNCPDPU",80,0)
 ; if primary elig is CHAMPVA use one of the champva's, depending
"RTN","IBNCPDPU",81,0)
 ; on insurance coverage
"RTN","IBNCPDPU",82,0)
 I $P($G(^DIC(8.1,+$P($G(^DIC(8,+VAEL(3),0)),"^",9),0)),"^")="CHAMPVA" S IBRT=$$UINS("CHAMPVA",.IBINS,.IBN)
"RTN","IBNCPDPU",83,0)
 ;
"RTN","IBNCPDPU",84,0)
 Q $S($D(IBRT):IBRT,1:"0^unable to determine rate type")
"RTN","IBNCPDPU",85,0)
 ;
"RTN","IBNCPDPU",86,0)
 ;
"RTN","IBNCPDPU",87,0)
UINS(IBT,IBINS,IBN) ; in the case of tricare or champva you may have to use
"RTN","IBNCPDPU",88,0)
 ; insurance different rate types insted of the actual tricare or champva
"RTN","IBNCPDPU",89,0)
 N IBRT
"RTN","IBNCPDPU",90,0)
 S IBN=+$G(IBN,$O(IBINS("S",+$O(IBINS("S",0)),0)))
"RTN","IBNCPDPU",91,0)
 I $P($G(^IBE(355.1,+$P($G(IBINS(IBN,355.3)),"^",9),0)),"^")=IBT S IBRT=$O(^DGCR(399.3,"B",IBT,0)),IBRT=$S(IBRT:IBRT_"^"_$S(IBT="CHAMPUS":"A",1:"C"),1:"0^"_IBT_" Rate type not found")
"RTN","IBNCPDPU",92,0)
 I '$D(IBRT) S IBRT=$O(^DGCR(399.3,"B",IBT_" REIMB. INS.",0)),IBRT=$S(IBRT:IBRT_"^"_$S(IBT="CHAMPUS":"A",1:"C"),1:"0^"_IBT_" REIMB. INS. Rate type not found")
"RTN","IBNCPDPU",93,0)
 Q IBRT
"RTN","IBNCPDPU",94,0)
 ;
"RTN","IBNCPDPU",95,0)
BS() ; returns the mccr utility to use
"RTN","IBNCPDPU",96,0)
 N IBX
"RTN","IBNCPDPU",97,0)
 S IBX=0 F  S IBX=$O(^DGCR(399.1,"B","PRESCRIPTION",IBX)) Q:IBX<1  I $P($G(^DGCR(399.1,+$G(IBX),0)),U,5) Q
"RTN","IBNCPDPU",98,0)
 Q IBX
"RTN","IBNCPDPU",99,0)
 ;
"RTN","IBNCPDPU",100,0)
 ; Match IB Bill by the 7-digit ECME number
"RTN","IBNCPDPU",101,0)
RXBIL(IBINP,IBERR) ; Matching NCPDP payments
"RTN","IBNCPDPU",102,0)
 ;Input:
"RTN","IBNCPDPU",103,0)
 ;   IBINP("ECME") - the 7-digit ECME number (Reference Number)
"RTN","IBNCPDPU",104,0)
 ;   IBINP("FILLDT")  - the Rx fill date, YYYYMMDD or FileMan format
"RTN","IBNCPDPU",105,0)
 ;   IBINP("PNM") (optional) - the patient's last name
"RTN","IBNCPDPU",106,0)
 ;Returns:
"RTN","IBNCPDPU",107,0)
 ;   IBERR (by ref) - the error code, or null string if found
"RTN","IBNCPDPU",108,0)
 ;   $$RXBIL - IB Bill IEN, or 0 if not matched
"RTN","IBNCPDPU",109,0)
 N IBKEY,IBECME,BILLDA,IBFOUND,IBMATCH,IBDAT,IBPNAME
"RTN","IBNCPDPU",110,0)
 S IBERR=""
"RTN","IBNCPDPU",111,0)
 S IBECME=$G(IBINP("ECME"))
"RTN","IBNCPDPU",112,0)
 I IBECME'?1.7N S IBERR="Invalid ECME number" Q 0
"RTN","IBNCPDPU",113,0)
 S IBDAT=$G(IBINP("FILLDT")) ; Rx fill date
"RTN","IBNCPDPU",114,0)
 I IBDAT?8N S IBDAT=($E(IBDAT,1,4)-1700)_$E(IBDAT,5,8) ; conv date to FM format
"RTN","IBNCPDPU",115,0)
 I IBDAT'?7N Q $$RXBILND(IBECME)  ; date is not correct or null
"RTN","IBNCPDPU",116,0)
 S IBPNAME=$G(IBINP("PNM")) ; patient's name (optional)
"RTN","IBNCPDPU",117,0)
 S IBKEY=+IBECME_";"_IBDAT ; The ECME Number (BC ID)
"RTN","IBNCPDPU",118,0)
 S BILLDA="",IBFOUND=0,IBMATCH=0
"RTN","IBNCPDPU",119,0)
 ; Search backward
"RTN","IBNCPDPU",120,0)
 F  S BILLDA=$O(^DGCR(399,"AG",IBKEY,BILLDA),-1) Q:BILLDA=""  D  Q:IBFOUND
"RTN","IBNCPDPU",121,0)
 . I 'BILLDA Q  ; IEN must be numeric
"RTN","IBNCPDPU",122,0)
 . I '$D(^DGCR(399,BILLDA,0)) Q  ; Corrupted index
"RTN","IBNCPDPU",123,0)
 . S IBMATCH=1
"RTN","IBNCPDPU",124,0)
 . I IBPNAME'="" I '$$TXMATCH($P(IBPNAME,","),$P($G(^DPT(+$P(^DGCR(399,BILLDA,0),U,2),0)),","),8) Q  ; Patient name doesn't match
"RTN","IBNCPDPU",125,0)
 . S IBFOUND=1
"RTN","IBNCPDPU",126,0)
 I 'BILLDA S IBERR=$S(IBMATCH:"Patient's name does not match",1:"Matching bill not found") ; not matched
"RTN","IBNCPDPU",127,0)
 Q +BILLDA
"RTN","IBNCPDPU",128,0)
 ;
"RTN","IBNCPDPU",129,0)
RXBILND(IBECME) ;Match the bill with no date
"RTN","IBNCPDPU",130,0)
 N IBKEY,IBBC,BILLDA,IBY,IBCUT
"RTN","IBNCPDPU",131,0)
 S IBKEY=+IBECME_";"
"RTN","IBNCPDPU",132,0)
 S IBCUT=$$FMADD^XLFDT(DT,-180) ; only 180 days in the past
"RTN","IBNCPDPU",133,0)
 S BILLDA=0
"RTN","IBNCPDPU",134,0)
 ; Search PRNT/TX forward
"RTN","IBNCPDPU",135,0)
 S IBBC=IBKEY_IBCUT
"RTN","IBNCPDPU",136,0)
 F  S IBBC=$O(^DGCR(399,"AG",IBBC)) Q:IBBC'[IBKEY  D  Q:BILLDA
"RTN","IBNCPDPU",137,0)
 . S IBY="" F  S IBY=$O(^DGCR(399,"AG",IBBC,IBY)) Q:'IBY  D  Q:BILLDA
"RTN","IBNCPDPU",138,0)
 .. I $P($G(^DGCR(399,+IBY,0)),U,13)'=4 Q  ; not PRNT/TX
"RTN","IBNCPDPU",139,0)
 .. S BILLDA=+IBY
"RTN","IBNCPDPU",140,0)
 I BILLDA Q BILLDA
"RTN","IBNCPDPU",141,0)
 ; Search ANY backward
"RTN","IBNCPDPU",142,0)
 S IBBC=IBKEY_"8000000"
"RTN","IBNCPDPU",143,0)
 F  S IBBC=$O(^DGCR(399,"AG",IBBC),-1) Q:IBBC'[IBKEY  Q:$P(IBBC,";",2)<IBCUT  D  Q:BILLDA
"RTN","IBNCPDPU",144,0)
 . S IBY="" F  S IBY=$O(^DGCR(399,"AG",IBBC,IBY),-1) Q:IBY=""  D  Q:BILLDA
"RTN","IBNCPDPU",145,0)
 .. ;I $P($G(^DGCR(399,+IBY,0)),U,13)'=7 Q  ; not CANCELLED
"RTN","IBNCPDPU",146,0)
 .. S BILLDA=+IBY
"RTN","IBNCPDPU",147,0)
 Q BILLDA
"RTN","IBNCPDPU",148,0)
 ;
"RTN","IBNCPDPU",149,0)
 ;Check matching of two strings - case insensitive, no spaces etc.
"RTN","IBNCPDPU",150,0)
TXMATCH(IBTXT1,IBTXT2,IBMAX) ;
"RTN","IBNCPDPU",151,0)
 N IBTR1,IBTR2,IBT1,IBT2
"RTN","IBNCPDPU",152,0)
 ;Checking only first IBMAX characters (long names may be trancated
"RTN","IBNCPDPU",153,0)
 S IBTR1="ABCDEFGHIJKLMNOPQRSTUVWXYZ:;"",'._()<>/\|@#$%&*-=!`~ "
"RTN","IBNCPDPU",154,0)
 S IBTR2="abcdefghijklmnopqrstuvwxyz"
"RTN","IBNCPDPU",155,0)
 S IBT1=$E($TR(IBTXT1,IBTR1,IBTR2),1,IBMAX)
"RTN","IBNCPDPU",156,0)
 S IBT2=$E($TR(IBTXT2,IBTR1,IBTR2),1,IBMAX)
"RTN","IBNCPDPU",157,0)
 Q IBT1=IBT2
"RTN","IBNCPDPU",158,0)
 ;
"RTN","IBNCPDPU",159,0)
ECMEBIL(DFN,IBADT) ; Is the pat ECME Billable (pharmacy coverage only)
"RTN","IBNCPDPU",160,0)
 ; DFN - ptr to the patient
"RTN","IBNCPDPU",161,0)
 ; IBADT  - the date
"RTN","IBNCPDPU",162,0)
 N IBANY,IBERMSG,IBX,IBINS,IBT,IBZ,IBRES,IBCAT,IBCOV,IBPCOV
"RTN","IBNCPDPU",163,0)
 S IBRES=0 ; Not ECME Billable by default
"RTN","IBNCPDPU",164,0)
 S (IBCOV,IBPCOV)=0
"RTN","IBNCPDPU",165,0)
 ; -- look up ins with Rx 
"RTN","IBNCPDPU",166,0)
 D ALL^IBCNS1(DFN,"IBINS",1,IBADT,1)
"RTN","IBNCPDPU",167,0)
 S IBERMSG="" ; Error message
"RTN","IBNCPDPU",168,0)
 S IBCAT=$O(^IBE(355.31,"B","PHARMACY",0))
"RTN","IBNCPDPU",169,0)
 S IBX=0 F  S IBX=$O(IBINS("S",IBX)) Q:'IBX  D  Q:IBRES
"RTN","IBNCPDPU",170,0)
 . S IBT=0 F  S IBT=$O(IBINS("S",IBX,IBT)) Q:'IBT  D  Q:IBRES
"RTN","IBNCPDPU",171,0)
 . . N IBZ,IBPIEN,IBY,IBPL
"RTN","IBNCPDPU",172,0)
 . . S IBZ=$G(IBINS(IBT,0))
"RTN","IBNCPDPU",173,0)
 . . S IBPL=+$P(IBZ,U,18) Q:'IBPL
"RTN","IBNCPDPU",174,0)
 . . S IBCOV=1 ; covered
"RTN","IBNCPDPU",175,0)
 . . I '$$PLCOV^IBCNSU3(IBPL,IBADT,IBCAT) Q
"RTN","IBNCPDPU",176,0)
 . . S IBPCOV=1
"RTN","IBNCPDPU",177,0)
 . . S IBPIEN=+$G(^IBA(355.3,IBPL,6))
"RTN","IBNCPDPU",178,0)
 . . I 'IBPIEN S IBERMSG="Plan not linked to the Payer" Q  ; Not linked
"RTN","IBNCPDPU",179,0)
 . . D STCHK^IBCNRU1(IBPIEN,.IBY)
"RTN","IBNCPDPU",180,0)
 . . I $E($G(IBY(1)))'="A" S:IBERMSG="" IBERMSG=$$ERMSG^IBNCPDP1($P($G(IBY(6)),",")) Q
"RTN","IBNCPDPU",181,0)
 . . S IBRES=1
"RTN","IBNCPDPU",182,0)
 I 'IBCOV Q "0^Not Insured"
"RTN","IBNCPDPU",183,0)
 I 'IBPCOV Q "0^No Pharmacy Coverage"
"RTN","IBNCPDPU",184,0)
 I 'IBRES,IBERMSG'="" Q "0^"_IBERMSG
"RTN","IBNCPDPU",185,0)
 I 'IBRES Q "0^No Insurance ECME billable"
"RTN","IBNCPDPU",186,0)
 ;
"RTN","IBNCPDPU",187,0)
 Q IBRES
"RTN","IBNCPDPU",188,0)
 ;
"RTN","IBNCPDPU",189,0)
SUBMIT(IBRX,IBFIL) ; Submit the Rx claim through ECME
"RTN","IBNCPDPU",190,0)
 ; IBRX - RX ien in file #52
"RTN","IBNCPDPU",191,0)
 ; IBFIL - Fill No (0 for orig fill)
"RTN","IBNCPDPU",192,0)
 N IBDT,IBNDC,IBX
"RTN","IBNCPDPU",193,0)
 I '$G(IBRX)!('$D(IBFIL)) Q "0^Invalid parameters."
"RTN","IBNCPDPU",194,0)
 S IBDT=$S('IBFIL:$P($G(^PSRX(+IBRX,2)),U,2),1:$P($G(^PSRX(+IBRX,1,IBFIL,0)),U,1))
"RTN","IBNCPDPU",195,0)
 S IBX=$$EN^BPSNCPDP(+IBRX,+IBFIL,IBDT,"BB")
"RTN","IBNCPDPU",196,0)
 I +IBX=0 D ECMEACT^PSOBPSU1(+IBRX,+IBFIL,"Claim submitted to 3rd party payer: IB BACK BILLING")
"RTN","IBNCPDPU",197,0)
 Q IBX
"RTN","IBNCPDPU",198,0)
 ;
"RTN","IBNCPDPU",199,0)
REASON(IBX,EXACT) ; Close Claim Reasons
"RTN","IBNCPDPU",200,0)
 Q $P($G(^IBE(356.8,+IBX,0)),U) ; non-billable reason
"RTN","IBNCPDPU",201,0)
 ;
"RTN","IBNCPDPU",202,0)
NABP(IBIFN) ;NABP Number
"RTN","IBNCPDPU",203,0)
 N IBY,IBTRKN,IBRX,IBFIL,IBZ,IBNABP
"RTN","IBNCPDPU",204,0)
 S IBY=+$O(^IBT(356.399,"C",IBIFN,0)) I 'IBY Q ""
"RTN","IBNCPDPU",205,0)
 S IBTRKN=$P($G(^IBT(356.399,IBY,0)),U) I 'IBTRKN Q ""
"RTN","IBNCPDPU",206,0)
 S IBZ=$G(^IBT(356,IBTRKN,0)) I IBZ="" Q ""
"RTN","IBNCPDPU",207,0)
 S IBRX=$P(IBZ,U,8)
"RTN","IBNCPDPU",208,0)
 S IBFIL=$P(IBZ,U,10)
"RTN","IBNCPDPU",209,0)
 S IBNABP=$$NABP^BPSBUTL(IBRX,IBFIL)
"RTN","IBNCPDPU",210,0)
 Q $S(IBNABP=0:"",1:IBNABP)
"RTN","IBNCPDPU",211,0)
 ;
"RTN","IBNCPDPU",212,0)
 ; Get the K-bill# from CT
"RTN","IBNCPDPU",213,0)
BILL(IBRX,IBFIL) ;
"RTN","IBNCPDPU",214,0)
 N IBTRKN,IBIFN
"RTN","IBNCPDPU",215,0)
 S IBTRKN=+$O(^IBT(356,"ARXFL",+$G(IBRX),+$G(IBFIL),""))
"RTN","IBNCPDPU",216,0)
 S IBIFN=+$P($G(^IBT(356,IBTRKN,0)),U,11)
"RTN","IBNCPDPU",217,0)
 Q $P($G(^DGCR(399,IBIFN,0)),U)
"RTN","IBNCPDPU",218,0)
 ;
"RTN","IBNCPDPU",219,0)
REJECT(IBECME,IBDATE) ; Is the e-claim rejected?
"RTN","IBNCPDPU",220,0)
 N IBINP,IBTRKRN,IBY
"RTN","IBNCPDPU",221,0)
 I IBECME'?1.7N Q 0
"RTN","IBNCPDPU",222,0)
 ;S IBINP("ECME")=IBECME
"RTN","IBNCPDPU",223,0)
 ;S IBINP("FILLDT")=IBDATE
"RTN","IBNCPDPU",224,0)
 ;I $$RXBIL(.IBINP) Q 0  ; bill exists
"RTN","IBNCPDPU",225,0)
 S IBTRKRN=+$O(^IBT(356,"AE",IBECME,0)) I 'IBTRKRN Q 0
"RTN","IBNCPDPU",226,0)
 S IBY=$G(^IBT(356,IBTRKRN,1))
"RTN","IBNCPDPU",227,0)
 I $P(IBY,U,11)>0 Q 1  ; Rejected or closed
"RTN","IBNCPDPU",228,0)
 Q 0
"RTN","IBNCPDPU",229,0)
 ;
"RTN","IBNCPDPU",230,0)
 ;
"RTN","IBNCPDPU",231,0)
 ;IBNCPDPU
"RTN","IBNCPDPV")
0^60^B631181
"RTN","IBNCPDPV",1,0)
IBNCPDPV ;DALOI/SS - for ECME SCREEN VIEW PATIENT INSURANCE ;28-OCT-05
"RTN","IBNCPDPV",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPDPV",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPDPV",4,0)
 ; -- main entry point
"RTN","IBNCPDPV",5,0)
 Q
"RTN","IBNCPDPV",6,0)
INSVIEW ;
"RTN","IBNCPDPV",7,0)
 D EN^VALM("IBCNS VIEW INS CO")
"RTN","IBNCPDPV",8,0)
 S VALMBCK="R"
"RTN","IBNCPDPV",9,0)
 Q
"RTN","IBNCPDPV",10,0)
 ;
"RTN","IBNCPDPV",11,0)
EN1(DFN) ;
"RTN","IBNCPDPV",12,0)
 I $G(DFN)'>0 Q
"RTN","IBNCPDPV",13,0)
 D EN
"RTN","IBNCPDPV",14,0)
 Q
"RTN","IBNCPDPV",15,0)
EN ; -- main entry point for IBNCPDP VIEW PAT INS
"RTN","IBNCPDPV",16,0)
 D EN^VALM("IBNCPDP VIEW PAT INS")
"RTN","IBNCPDPV",17,0)
 Q
"RTN","IBNCPDPV",18,0)
 ;
"RTN","IBNCPDPV",19,0)
HDR ; -- header code
"RTN","IBNCPDPV",20,0)
 D HDR^IBCNSM4
"RTN","IBNCPDPV",21,0)
 Q
"RTN","IBNCPDPV",22,0)
 ;
"RTN","IBNCPDPV",23,0)
INIT ; -- init variables and list array
"RTN","IBNCPDPV",24,0)
 D INIT^IBCNSM4
"RTN","IBNCPDPV",25,0)
 Q
"RTN","IBNCPDPV",26,0)
 ;
"RTN","IBNCPDPV",27,0)
HELP ; -- help code
"RTN","IBNCPDPV",28,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBNCPDPV",29,0)
 Q
"RTN","IBNCPDPV",30,0)
 ;
"RTN","IBNCPDPV",31,0)
EXIT ; -- exit code
"RTN","IBNCPDPV",32,0)
 D FNL^IBCNSM4
"RTN","IBNCPDPV",33,0)
 Q
"RTN","IBNCPDPV",34,0)
 ;
"RTN","IBNCPDPV",35,0)
EXPND ; -- expand code
"RTN","IBNCPDPV",36,0)
 Q
"RTN","IBNCPDPV",37,0)
 ;
"RTN","IBNCPEB")
0^29^B22026532
"RTN","IBNCPEB",1,0)
IBNCPEB ;WOIFO/AAT - BULLETINS FOR NCPDP ;05-NOV-04
"RTN","IBNCPEB",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPEB",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPEB",4,0)
 Q
"RTN","IBNCPEB",5,0)
 ;
"RTN","IBNCPEB",6,0)
BULL(DFN,IBD,IBERR,IBIFN) ;Process NCPDP Error Messages.
"RTN","IBNCPEB",7,0)
 N IBC,IBT,IBPT,XMSUB,XMY,XMTEXT,XMDUZ,IBMSGT,IBI,IBGRP,IBDUZ,IBRXNO
"RTN","IBNCPEB",8,0)
 ; Input: same as RX^IBNCPDP2()
"RTN","IBNCPEB",9,0)
 ;
"RTN","IBNCPEB",10,0)
 S IBDUZ=$G(IBD("FILLED BY"))
"RTN","IBNCPEB",11,0)
 S IBRXNO=$G(IBD("RX NO"),"UNKNOWN")
"RTN","IBNCPEB",12,0)
 S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBNCPEB",13,0)
 S XMSUB="NCPDP BILLING ERROR - RX #"_IBRXNO
"RTN","IBNCPEB",14,0)
 S IBC=0
"RTN","IBNCPEB",15,0)
 D T("An error occurred while creating IB Third Party Bill for RX #"_IBRXNO)
"RTN","IBNCPEB",16,0)
 I $G(IBIFN) D T("IB Bill #"_$P($G(^DGCR(399,+IBIFN,0)),U)_" created with errors.")
"RTN","IBNCPEB",17,0)
 D T()
"RTN","IBNCPEB",18,0)
 D T("The following error was encountered: "_$P(IBERR,U,2))
"RTN","IBNCPEB",19,0)
 D T()
"RTN","IBNCPEB",20,0)
 D T("      Patient: "_$S($L(IBPT):$P(IBPT,U)_"       Pt. ID: "_$P(IBPT,U,2),1:"Not Defined"))
"RTN","IBNCPEB",21,0)
 D T(" Rx filled by: "_$P($G(^VA(200,+IBDUZ,0)),U))
"RTN","IBNCPEB",22,0)
 D T(" Prescription: "_IBRXNO)
"RTN","IBNCPEB",23,0)
 D T("  Fill Number: "_$G(IBD("FILL NUMBER")))
"RTN","IBNCPEB",24,0)
 D T("    Fill Date: "_$G(IBD("FILL DATE")))
"RTN","IBNCPEB",25,0)
 D T("   Group Plan: "_$P($G(^IBA(355.3,+$G(IBD("PLAN")),0)),U)_"  (IEN="_+$G(IBD("PLAN"))_")")
"RTN","IBNCPEB",26,0)
 D T("         Drug: "_$P($G(^PSDRUG(+$G(IBD("DRUG")),0)),U))
"RTN","IBNCPEB",27,0)
 D T("Amount Billed: "_$J($G(IBD("BILLED")),5,2))
"RTN","IBNCPEB",28,0)
 D T("  Amount Paid: "_$J($G(IBD("PAID")),5,2))
"RTN","IBNCPEB",29,0)
 D T()
"RTN","IBNCPEB",30,0)
 D T("Please review the circumstances surrounding this error and make necessary")
"RTN","IBNCPEB",31,0)
 D T("corrections.")
"RTN","IBNCPEB",32,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBT("
"RTN","IBNCPEB",33,0)
 S XMY("G.IB ERROR")=""
"RTN","IBNCPEB",34,0)
 D ZXMD
"RTN","IBNCPEB",35,0)
 Q
"RTN","IBNCPEB",36,0)
 ;
"RTN","IBNCPEB",37,0)
 ;call mailman in background (using taskman)
"RTN","IBNCPEB",38,0)
ZXMD ;
"RTN","IBNCPEB",39,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC
"RTN","IBNCPEB",40,0)
 N %,%H,%I,X
"RTN","IBNCPEB",41,0)
 D NOW^%DTC
"RTN","IBNCPEB",42,0)
 S ZTIO="",ZTDTH=%,ZTDESC="NCPDP BILLING ERROR BULLETIN"
"RTN","IBNCPEB",43,0)
 S ZTSAVE("IBT*")="",ZTSAVE("XM*")=""
"RTN","IBNCPEB",44,0)
 S ZTRTN="^XMD"
"RTN","IBNCPEB",45,0)
 D ^%ZTLOAD
"RTN","IBNCPEB",46,0)
 Q
"RTN","IBNCPEB",47,0)
 ;
"RTN","IBNCPEB",48,0)
T(IBTXT) ; Add text to the message
"RTN","IBNCPEB",49,0)
 S IBC=IBC+1,IBT(IBC)=$G(IBTXT," ")
"RTN","IBNCPEB",50,0)
 Q
"RTN","IBNCPEB",51,0)
 ;
"RTN","IBNCPEB",52,0)
 ;-------------------------
"RTN","IBNCPEB",53,0)
 ;Release charges off hold bulletin
"RTN","IBNCPEB",54,0)
RELBUL(DFN,IBRX,IBFIL,IBADT,IBACT,IBCR,IBCC,IBIFN) ;
"RTN","IBNCPEB",55,0)
 ; Input:
"RTN","IBNCPEB",56,0)
 ;   DFN - Patient
"RTN","IBNCPEB",57,0)
 ;   IBRX - Rx IEN
"RTN","IBNCPEB",58,0)
 ;   IBFIL - Refill#
"RTN","IBNCPEB",59,0)
 ;   IBADT - Fill date
"RTN","IBNCPEB",60,0)
 ;   IBACT - pointer to #350
"RTN","IBNCPEB",61,0)
 ;   IBCR - Close Reason code (.01 of BPS CLOSE REASON)
"RTN","IBNCPEB",62,0)
 ;   IBCC - Close Reason Comment
"RTN","IBNCPEB",63,0)
 N IBT,IBC,IBGRP,XMSUB,XMDUZ,XMY,XMTEXT,VAERR,VADM,X,VA
"RTN","IBNCPEB",64,0)
 N IBNAME,IBAGE,IBPID,IBBID
"RTN","IBNCPEB",65,0)
 D DEM^VADPT ; get patient demographic data
"RTN","IBNCPEB",66,0)
 I VAERR K VADM
"RTN","IBNCPEB",67,0)
 S IBNAME=$$PR($G(VADM(1)),26)
"RTN","IBNCPEB",68,0)
 S IBAGE=$$PR($G(VADM(4)),3)
"RTN","IBNCPEB",69,0)
 S IBPID=$G(VA("PID"))
"RTN","IBNCPEB",70,0)
 S IBBID=$G(VA("BID"))
"RTN","IBNCPEB",71,0)
 S XMSUB=$E(IBNAME,1,8)_"("_IBBID_")"_" PATIENT CHRG RELEASED"_"-"_$E($$MCDIV(IBRX,IBFIL),1,11)
"RTN","IBNCPEB",72,0)
 ;
"RTN","IBNCPEB",73,0)
 S IBC=0
"RTN","IBNCPEB",74,0)
 D T("The following charge has been automatically released from HOLD")
"RTN","IBNCPEB",75,0)
 I 'IBCR D T("The decision was made based on the electronic NCPDP response from the Payer")
"RTN","IBNCPEB",76,0)
 I IBCR D T("because the e-pharmacy claim was closed by OPECC as '"_$$REASON^IBNCPDPU(IBCR)_"'")
"RTN","IBNCPEB",77,0)
 I $G(IBCC)'="" D T("Additional comment: "_IBCC)
"RTN","IBNCPEB",78,0)
 D T()
"RTN","IBNCPEB",79,0)
 D T("Name: "_IBNAME_"   Age    : "_IBAGE_"       Pt. ID: "_IBPID)
"RTN","IBNCPEB",80,0)
 ;
"RTN","IBNCPEB",81,0)
 D CHRG
"RTN","IBNCPEB",82,0)
 ; Transmit mail
"RTN","IBNCPEB",83,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBT("
"RTN","IBNCPEB",84,0)
 S IBGRP=$P($G(^XMB(3.8,+$P($G(^IBE(350.9,1,0)),U,11),0)),U)
"RTN","IBNCPEB",85,0)
 I IBGRP]"" S XMY("G."_IBGRP_"@"_^XMB("NETNAME"))=""
"RTN","IBNCPEB",86,0)
 D ^XMD
"RTN","IBNCPEB",87,0)
 Q
"RTN","IBNCPEB",88,0)
 ;
"RTN","IBNCPEB",89,0)
CHRG ; gets charge data and sets up charge lines
"RTN","IBNCPEB",90,0)
 N IBTYP,IBFR,IBTO,IBX,IBX1,IBRXN,IBRF,IENS
"RTN","IBNCPEB",91,0)
 S IBX=$G(^IB(IBACT,0))
"RTN","IBNCPEB",92,0)
 S IBX1=$G(^IB(IBACT,1))
"RTN","IBNCPEB",93,0)
 S IBFR=$$DAT1^IBOUTL($S($P(IBX,U,14)'="":($P(IBX,U,14)),1:$P(IBX1,U,2)))
"RTN","IBNCPEB",94,0)
 S IBTO=$$DAT1^IBOUTL($S($P(IBX,U,15)'="":($P(IBX,U,15)),1:$P(IBX1,U,2)))
"RTN","IBNCPEB",95,0)
 S IBRXN=$P($G(^PSRX(IBRX,0)),U) ;$P($P(IBX,U,8),"-")
"RTN","IBNCPEB",96,0)
 S IBTYP=$P(IBX,U,3)
"RTN","IBNCPEB",97,0)
 S:IBTYP IBTYP=$P($G(^IBE(350.1,IBTYP,0)),U,3)
"RTN","IBNCPEB",98,0)
 S:IBTYP IBTYP=$P($$CATN^PRCAFN(IBTYP),U,2)
"RTN","IBNCPEB",99,0)
 D T("Type: "_$$PR(IBTYP,28)_" Amount : $"_$J(+$P(IBX,U,7),0,2))
"RTN","IBNCPEB",100,0)
 D T("From: "_$$PR(IBFR,28)_" To     : "_IBTO)
"RTN","IBNCPEB",101,0)
 D T("Rx #: "_$$PR(IBRXN_$S(IBFIL:" ("_IBFIL_")",1:""),28)_" Fill Dt: "_$$DAT1^IBOUTL(IBADT))
"RTN","IBNCPEB",102,0)
 D T()
"RTN","IBNCPEB",103,0)
 D T("REFERENCE NUMBER : "_$P(IBX,U))
"RTN","IBNCPEB",104,0)
 D T("FIRST PARTY BILL : "_$P(IBX,U,11))
"RTN","IBNCPEB",105,0)
 I $G(IBIFN) D T("THIRD PARTY BILL : "_$P($G(^PRCA(430,+IBIFN,0)),U))
"RTN","IBNCPEB",106,0)
 Q
"RTN","IBNCPEB",107,0)
 ;
"RTN","IBNCPEB",108,0)
PR(STR,LEN) ; pad right
"RTN","IBNCPEB",109,0)
 N B S STR=$E(STR,1,LEN),$P(B," ",LEN-$L(STR))=" "
"RTN","IBNCPEB",110,0)
 Q STR_$G(B)
"RTN","IBNCPEB",111,0)
 ;
"RTN","IBNCPEB",112,0)
 ;MC Division for the IB
"RTN","IBNCPEB",113,0)
MCDIV(IBRX,IBFIL) ; Get MC DIVISION name from the Rx/Fill
"RTN","IBNCPEB",114,0)
 N IBDIV,IBINST,IBMCDIV,IBNAM,IBUNK
"RTN","IBNCPEB",115,0)
 S IBUNK="DIV UNKNWN"
"RTN","IBNCPEB",116,0)
 ; outpatient division
"RTN","IBNCPEB",117,0)
 I 'IBFIL S IBDIV=+$P($G(^PSRX(IBRX,2)),U,9)
"RTN","IBNCPEB",118,0)
 E  S IBDIV=+$P($G(^PSRX(IBRX,1,IBFIL,0)),U,9)
"RTN","IBNCPEB",119,0)
 I 'IBDIV Q IBUNK
"RTN","IBNCPEB",120,0)
 ; related institution
"RTN","IBNCPEB",121,0)
 S IBINST=+$P($G(^PS(59,IBDIV,"INI")),U) Q:'IBINST IBUNK
"RTN","IBNCPEB",122,0)
 S IBMCDIV=+$O(^DG(40.8,"AD",IBINST,0)) ; medical center division
"RTN","IBNCPEB",123,0)
 I 'IBMCDIV Q IBUNK
"RTN","IBNCPEB",124,0)
 S IBNAM=$P($G(^DG(40.8,IBMCDIV,0)),U)
"RTN","IBNCPEB",125,0)
 Q $S(IBNAM="":IBUNK,1:IBNAM)
"RTN","IBNCPEB",126,0)
 ;
"RTN","IBNCPER")
0^8^B67228842
"RTN","IBNCPER",1,0)
IBNCPER ;DALOI/AAT - NCPDP BILLING EVENTS REPORT ;10-JUN-2003
"RTN","IBNCPER",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPER",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPER",4,0)
 ;
"RTN","IBNCPER",5,0)
 ;NCPDP PHASE III
"RTN","IBNCPER",6,0)
 Q
"RTN","IBNCPER",7,0)
 ;
"RTN","IBNCPER",8,0)
START ;
"RTN","IBNCPER",9,0)
 N REF,IBFROM,IBTO,IBI,IBN,IBRX1,IBFN,IBNDX,IB1ST,IBNUM,X,IBSC,IBNB
"RTN","IBNCPER",10,0)
 N Z,Z1
"RTN","IBNCPER",11,0)
 ;Constants
"RTN","IBNCPER",12,0)
 S IBSC="STATUS CHECK",IBNB="Not ECME billable: ",IBNDX="IBNCPDP-"
"RTN","IBNCPER",13,0)
 ;
"RTN","IBNCPER",14,0)
 S IBFROM=IBNDX_IBBDT I '$D(^XTMP(IBFROM)) S IBFROM=$O(^XTMP(IBFROM)) Q:IBFROM'[IBNDX
"RTN","IBNCPER",15,0)
 S IBTO=IBNDX_IBEDT I '$D(^XTMP(IBTO)) S IBTO=$O(^XTMP(IBTO),-1) Q:IBTO'[IBNDX
"RTN","IBNCPER",16,0)
 S REF=$NA(^TMP($J,"IBNCPDPE"))
"RTN","IBNCPER",17,0)
 K @REF
"RTN","IBNCPER",18,0)
 I $G(IBECME) S IBRX=$$GETRX(IBECME,IBNDX,IBFROM,IBTO) I 'IBRX  W !!,"No data found for the specified ECME #" Q  ; no match with ECME #
"RTN","IBNCPER",19,0)
 ;collect
"RTN","IBNCPER",20,0)
 S IBI=IBFROM F  D  S IBI=$O(^XTMP(IBI)) Q:IBI]IBTO  Q:IBI'[IBNDX
"RTN","IBNCPER",21,0)
 .S IBN=0 F  S IBN=$O(^XTMP(IBI,IBN)) Q:'IBN  D
"RTN","IBNCPER",22,0)
 ..K Z,Z1 M Z=^XTMP(IBI,IBN),Z1=Z("IBD") K Z("IBD")
"RTN","IBNCPER",23,0)
 ..I $G(Z1("IEN"))="" S Z1("IEN")=$G(Z1("PRESCRIPTION"))
"RTN","IBNCPER",24,0)
 ..Q:'$G(Z("DFN"))
"RTN","IBNCPER",25,0)
 ..I IBPAT,Z("DFN")'=IBPAT Q
"RTN","IBNCPER",26,0)
 ..I IBRX,Z1("IEN")'=IBRX Q
"RTN","IBNCPER",27,0)
 ..I $$RX(Z1("IEN"))="" Q
"RTN","IBNCPER",28,0)
 ..I IBM2="E",Z("CALL")[IBSC,'$G(Z("RESULT")) Q
"RTN","IBNCPER",29,0)
 ..I IBM2="N",Z("CALL")'[IBSC Q
"RTN","IBNCPER",30,0)
 ..I IBM2="N",Z("CALL")[IBSC,$G(Z("RESULT")) Q
"RTN","IBNCPER",31,0)
 ..I IBM3'="A",IBM3'=$$RXWMC^IBNCPRR(+Z1("IEN")) Q
"RTN","IBNCPER",32,0)
 ..S @REF@(+$G(Z1("IEN")),+$G(Z1("FILL NUMBER")),IBI,IBN)=""
"RTN","IBNCPER",33,0)
 ;
"RTN","IBNCPER",34,0)
 I '$D(@REF) W !!,"No data found for the specified input criteria" Q
"RTN","IBNCPER",35,0)
 ;
"RTN","IBNCPER",36,0)
 ;print
"RTN","IBNCPER",37,0)
 S IBNUM=0
"RTN","IBNCPER",38,0)
 U IO D HDR
"RTN","IBNCPER",39,0)
 S IBRX1="" F  S IBRX1=$O(@REF@(IBRX1)) Q:IBRX1=""  D  Q:IBQ
"RTN","IBNCPER",40,0)
 .S IBFN="" F  S IBFN=$O(@REF@(IBRX1,IBFN)) Q:IBFN=""  D  Q:IBQ
"RTN","IBNCPER",41,0)
 ..S IB1ST=1
"RTN","IBNCPER",42,0)
 ..S IBI="" F  S IBI=$O(@REF@(IBRX1,IBFN,IBI)) Q:IBI=""  D  Q:IBQ
"RTN","IBNCPER",43,0)
 ...S IBN="" F  S IBN=$O(@REF@(IBRX1,IBFN,IBI,IBN)) Q:IBN=""  D  Q:IBQ
"RTN","IBNCPER",44,0)
 ....N Z,Z1,Y
"RTN","IBNCPER",45,0)
 ....M Z=^XTMP(IBI,IBN),Z1=Z("IBD") K Z("IBD")
"RTN","IBNCPER",46,0)
 ....I IB1ST D  Q:IBQ
"RTN","IBNCPER",47,0)
 .....S IBNUM=IBNUM+1 I IBNUM>1 D ULINE("-") Q:IBQ
"RTN","IBNCPER",48,0)
 .....D CHKP Q:IBQ
"RTN","IBNCPER",49,0)
 .....W !,IBNUM," ",?4,$$RX(IBRX1)," ",?12,IBFN," ",?16,$$DAT($G(Z1("FILL DATE")))
"RTN","IBNCPER",50,0)
 .....W " ",?28,$E($$PAT(+$G(Z("DFN"))),1,21)," ",?50,$E($$DRUG(IBRX1),1,30)
"RTN","IBNCPER",51,0)
 .....S IB1ST=0
"RTN","IBNCPER",52,0)
 ....N IND S IND=6
"RTN","IBNCPER",53,0)
 ....D CHKP Q:IBQ
"RTN","IBNCPER",54,0)
 ....W !,?IND,$$EVNT(Z("CALL"))," ",?16,$$TIM($G(Z("TIME"))),?31," Status:",$E($$STAT(Z("CALL"),$G(Z("RESULT")),$G(Z1("CLOSE REASON")),$G(Z1("BILL"))),1,40)
"RTN","IBNCPER",55,0)
 ....Q:'IBDTL  ; no details
"RTN","IBNCPER",56,0)
 ....I Z("CALL")="BILL" D DBILL Q
"RTN","IBNCPER",57,0)
 ....I Z("CALL")="REJECT" D DREJ Q
"RTN","IBNCPER",58,0)
 ....I Z("CALL")["REVERSE" D DREV Q
"RTN","IBNCPER",59,0)
 ....I Z("CALL")["SUBMIT" D DSUB Q
"RTN","IBNCPER",60,0)
 ....I Z("CALL")["CLOSE" D DCLO Q
"RTN","IBNCPER",61,0)
 ....I Z("CALL")["RELEASE" D DREL Q
"RTN","IBNCPER",62,0)
 ....I Z("CALL")[IBSC D DSTAT^IBNCPER1 Q
"RTN","IBNCPER",63,0)
 ....I Z("CALL")["BILL CANCELLED" D BCANC Q
"RTN","IBNCPER",64,0)
 I IBSCR,'IBQ W !,"End of report, press RETURN to continue." R X:DTIME
"RTN","IBNCPER",65,0)
 K @REF
"RTN","IBNCPER",66,0)
 Q
"RTN","IBNCPER",67,0)
 ;
"RTN","IBNCPER",68,0)
STAT(X,RES,CR,IBIFN) ;
"RTN","IBNCPER",69,0)
 N IBNL
"RTN","IBNCPER",70,0)
 S IBNL="Plan not linked to the Payer"
"RTN","IBNCPER",71,0)
 I X[IBSC,RES[IBNB S RES="0^"_$P(RES,IBNB,2)
"RTN","IBNCPER",72,0)
 I X[IBSC,RES[IBNL S RES="0^Plan not linked" ; shorten too long line
"RTN","IBNCPER",73,0)
 I X[IBSC,'RES,RES["Non-Billable in CT" Q $P(RES,U,2)
"RTN","IBNCPER",74,0)
 I X[IBSC Q $S(RES:"",1:"non-")_"ECME Billable"_$S(RES:"",$P(RES,U,2)="":"",1:", "_$P(RES,U,2))
"RTN","IBNCPER",75,0)
 I X="BILL",'RES,IBIFN Q "Bill "_$$BILL(IBIFN)_" created with ERRORs"
"RTN","IBNCPER",76,0)
 I X="BILL",'RES Q "Error: "_$P(RES,U,2)
"RTN","IBNCPER",77,0)
 I X="BILL" Q "Bill# "_$$BILL(+RES)_" created"
"RTN","IBNCPER",78,0)
 I X["REVERSE",$G(CR)=7,RES=1 Q "set N/B Reason: Rx deleted, no Bill to cancel."
"RTN","IBNCPER",79,0)
 I X["REVERSE" Q $S(RES=1:"success",RES>1:"Bill# "_$$BILL(+RES)_" cancelled",'RES:"ECME Claim reversed, no Bill to cancel",1:$P(RES,U,2))
"RTN","IBNCPER",80,0)
 I 'RES Q $P(RES,U,2)
"RTN","IBNCPER",81,0)
 Q "OK"
"RTN","IBNCPER",82,0)
 ;
"RTN","IBNCPER",83,0)
DBILL ;
"RTN","IBNCPER",84,0)
 I 'Z("RESULT"),$L($P(Z("RESULT"),U,2)),$G(Z1("BILL")) D CHKP Q:IBQ  W !?10,"ERROR DESCRIPTION: ",$P(Z("RESULT"),U,2)
"RTN","IBNCPER",85,0)
 D CHKP Q:IBQ
"RTN","IBNCPER",86,0)
 W !?10,"ECME# ",Z1("CLAIMID"),",",?25,"FILL DATE:",$$DAT(Z1("FILL DATE"))
"RTN","IBNCPER",87,0)
 D RELT($G(Z1("RELEASE DATE")))
"RTN","IBNCPER",88,0)
 I $G(Z1("DIVISION")) D CHKP Q:IBQ  W !?10,"DIVISION: ",$P($G(^DG(40.8,+Z1("DIVISION"),0)),U)
"RTN","IBNCPER",89,0)
 I $G(Z1("DRUG")) D CHKP Q:IBQ  W !?10,"DRUG:",$P($G(^PSDRUG(+Z1("DRUG"),0)),U)
"RTN","IBNCPER",90,0)
 D CHKP Q:IBQ
"RTN","IBNCPER",91,0)
 W !,?10,"NDC:",$G(Z1("NDC"),"No"),", QTY:",$G(Z1("QTY"),"No"),", DAYS SUPPLY:",$G(Z1("DAYS SUPPLY"),"No"),", "
"RTN","IBNCPER",92,0)
 W "BILLED:",$J($G(Z1("BILLED")),0,2),", "
"RTN","IBNCPER",93,0)
 W "PAID:",$J($G(Z1("PAID")),0,2)
"RTN","IBNCPER",94,0)
 D CHKP Q:IBQ
"RTN","IBNCPER",95,0)
 W !?10,"PLAN:",$P($G(^IBA(355.3,+$G(Z1("PLAN")),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$G(Z1("PLAN")),0)),0)),U)
"RTN","IBNCPER",96,0)
 ;S IBU=$P($G(^VA(200,+$G(Z1("FILLED BY")),0)),U)
"RTN","IBNCPER",97,0)
 ;I IBU="" S IBU=$G(Z("USER"))
"RTN","IBNCPER",98,0)
 ;I IBU]"" D CHKP Q:IBQ  W !?10,"USER:",$$USR(IBU)
"RTN","IBNCPER",99,0)
 D CHKP Q:IBQ  W !?10,"USER:",$$USR(+$G(Z1("USER")))
"RTN","IBNCPER",100,0)
 Q
"RTN","IBNCPER",101,0)
 ;
"RTN","IBNCPER",102,0)
 ;reject
"RTN","IBNCPER",103,0)
DREJ ;
"RTN","IBNCPER",104,0)
 D CHKP Q:IBQ
"RTN","IBNCPER",105,0)
 W !?10,"ECME# ",Z1("CLAIMID"),",",?25,"FILL DATE:",$$DAT(Z1("FILL DATE"))
"RTN","IBNCPER",106,0)
 D RELT($G(Z1("RELEASE DATE")))
"RTN","IBNCPER",107,0)
 I $G(Z1("PLAN")) D CHKP Q:IBQ  W !?10,"PLAN:",$P($G(^IBA(355.3,+Z1("PLAN"),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$G(Z1("PLAN")),0)),0)),U)
"RTN","IBNCPER",108,0)
 D CLRS Q:IBQ
"RTN","IBNCPER",109,0)
 ;S IBU=$P($G(^VA(200,+$G(Z1("FILLED BY")),0)),U)
"RTN","IBNCPER",110,0)
 ;I IBU="" S IBU=$G(Z("USER"))
"RTN","IBNCPER",111,0)
 ;I IBU]"" D CHKP Q:IBQ  W !?10,"USER:",$$USR(IBU)
"RTN","IBNCPER",112,0)
 D CHKP Q:IBQ  W !?10,"USER:",$$USR(+$G(Z1("USER")))
"RTN","IBNCPER",113,0)
 Q
"RTN","IBNCPER",114,0)
 ;close
"RTN","IBNCPER",115,0)
DCLO ;
"RTN","IBNCPER",116,0)
 D DREJ
"RTN","IBNCPER",117,0)
 Q
"RTN","IBNCPER",118,0)
 ;submit
"RTN","IBNCPER",119,0)
DSUB ;
"RTN","IBNCPER",120,0)
 D CHKP Q:IBQ
"RTN","IBNCPER",121,0)
 W !?10,"ECME# ",Z1("CLAIMID"),",",?25,"FILL DATE:",$$DAT(Z1("FILL DATE"))
"RTN","IBNCPER",122,0)
 D RELT($G(Z1("RELEASE DATE")))
"RTN","IBNCPER",123,0)
 I $D(Z1("RESPONSE")) D CHKP W !?10,"PAYER RESPONSE: ",Z1("RESPONSE")
"RTN","IBNCPER",124,0)
 I $G(Z1("PLAN")) D CHKP Q:IBQ  W !?10,"PLAN:",$P($G(^IBA(355.3,+Z1("PLAN"),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$G(Z1("PLAN")),0)),0)),U)
"RTN","IBNCPER",125,0)
 ;S IBU=$P($G(^VA(200,+$G(Z1("FILLED BY")),0)),U)
"RTN","IBNCPER",126,0)
 ;I IBU="" S IBU=$G(Z("USER"))
"RTN","IBNCPER",127,0)
 ;I IBU]"" D CHKP Q:IBQ  W !?10,"USER:",$$USR(IBU)
"RTN","IBNCPER",128,0)
 D CHKP Q:IBQ  W !?10,"USER:",$$USR(+$G(Z1("USER")))
"RTN","IBNCPER",129,0)
 Q
"RTN","IBNCPER",130,0)
 ;release
"RTN","IBNCPER",131,0)
DREL ;
"RTN","IBNCPER",132,0)
 D DREJ
"RTN","IBNCPER",133,0)
 Q
"RTN","IBNCPER",134,0)
 ;reverse
"RTN","IBNCPER",135,0)
DREV ;
"RTN","IBNCPER",136,0)
 D CHKP Q:IBQ
"RTN","IBNCPER",137,0)
 W !?10,"ECME# ",Z1("CLAIMID"),",",?25,"FILL DATE:",$$DAT(Z1("FILL DATE"))
"RTN","IBNCPER",138,0)
 D RELT($G(Z1("RELEASE DATE")))
"RTN","IBNCPER",139,0)
 I $D(Z1("RESPONSE")),$E(Z1("RESPONSE"),1)'="A"&($E(Z1("RESPONSE"),1)'="R") K Z1("RESPONSE")  ; only display accepted and rejected on REVERSALS
"RTN","IBNCPER",140,0)
 I $D(Z1("RESPONSE")) D CHKP W !?10,"PAYER RESPONSE: ",Z1("RESPONSE")
"RTN","IBNCPER",141,0)
 I $G(Z1("PLAN")) D CHKP Q:IBQ  W !?10,"PLAN:",$P($G(^IBA(355.3,+Z1("PLAN"),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$G(Z1("PLAN")),0)),0)),U)
"RTN","IBNCPER",142,0)
 D CLRS Q:IBQ
"RTN","IBNCPER",143,0)
 ;S IBU=$P($G(^VA(200,+$G(Z1("FILLED BY")),0)),U)
"RTN","IBNCPER",144,0)
 ;I IBU="" S IBU=$G(Z("USER"))
"RTN","IBNCPER",145,0)
 ;I IBU]"" D CHKP Q:IBQ  W !?10,"USER:",$$USR(IBU)
"RTN","IBNCPER",146,0)
 D CHKP Q:IBQ  W !?10,"USER:",$$USR(+$G(Z1("USER")))
"RTN","IBNCPER",147,0)
 W !?10,"REVERSAL REASON:",$G(Z1("REVERSAL REASON"))
"RTN","IBNCPER",148,0)
 Q
"RTN","IBNCPER",149,0)
 ;
"RTN","IBNCPER",150,0)
BCANC ; bill cancellation generated by auto-reversal (duplicate bill)
"RTN","IBNCPER",151,0)
 D CHKP Q:IBQ
"RTN","IBNCPER",152,0)
 W !?10,"SYSTEM FOUND DUPLICATE BILL WHILE PROCESSING CLAIM"
"RTN","IBNCPER",153,0)
 D CHKP Q:IBQ  W !?10,"USER:",$$USR(+$G(Z1("USER")))
"RTN","IBNCPER",154,0)
 Q
"RTN","IBNCPER",155,0)
 ;
"RTN","IBNCPER",156,0)
 ;
"RTN","IBNCPER",157,0)
RELT(X) I X W ",",?45,"RELEASE DATE:",$$TIM(X)
"RTN","IBNCPER",158,0)
 Q
"RTN","IBNCPER",159,0)
CLRS ;
"RTN","IBNCPER",160,0)
 N TX,PP,RC
"RTN","IBNCPER",161,0)
 S TX="CLOSE REASON"
"RTN","IBNCPER",162,0)
 S PP="DROP TO PAPER"
"RTN","IBNCPER",163,0)
 S RC="RELEASE COPAY"
"RTN","IBNCPER",164,0)
 I $G(Z1(TX)) D CHKP Q:IBQ  W !?10,TX,":",$$REASON^IBNCPDPU(Z1(TX)) W:$G(Z1(PP)) ", ",PP W:$G(Z1(RC)) ", ",RC
"RTN","IBNCPER",165,0)
 S TX="CLOSE COMMENT"
"RTN","IBNCPER",166,0)
 I $L($G(Z1(TX)))>2 D CHKP Q:IBQ  W !?10,"COMMENT:",Z1(TX)
"RTN","IBNCPER",167,0)
 Q
"RTN","IBNCPER",168,0)
 ;
"RTN","IBNCPER",169,0)
HDR ;header
"RTN","IBNCPER",170,0)
 W @IOF S IBPAGE=IBPAGE+1 W ?72,"PAGE ",IBPAGE
"RTN","IBNCPER",171,0)
 W !,?15,"BILLING ECME EVENTS ON ",$$DAT(IBBDT)
"RTN","IBNCPER",172,0)
 I IBBDT'=IBEDT W " TO ",$$DAT(IBEDT)
"RTN","IBNCPER",173,0)
 W "  (",$S(IBDTL:"DETAILED",1:"SUMMARY"),")"
"RTN","IBNCPER",174,0)
 W !?15
"RTN","IBNCPER",175,0)
 I IBM1="R" W "SINGLE PRESCRIPTION - ",$P($G(^PSRX(IBRX,0)),U),"  "
"RTN","IBNCPER",176,0)
 I IBM1="P" W "SINGLE PATIENT - ",$P($G(^DPT(IBPAT,0)),U),"  "
"RTN","IBNCPER",177,0)
 I IBM1="E" W "SINGLE ECME # - ",IBECME
"RTN","IBNCPER",178,0)
 I IBM2="E" W "ECME BILLABLE RX  "
"RTN","IBNCPER",179,0)
 I IBM2="N" W "NON ECME BILLABLE RX  "
"RTN","IBNCPER",180,0)
 I IBM3'="A",IBM1'="R" W $S(IBM3="M":"MAIL",IBM3="C":"CMOP",1:"WINDOW")_" PRESCRIPTIONS ONLY"
"RTN","IBNCPER",181,0)
 W !,?4," RX#   FILL  DATE       PATIENT NAME",?55,"DRUG"
"RTN","IBNCPER",182,0)
 N I W ! F I=1:1:80 W "="
"RTN","IBNCPER",183,0)
 Q
"RTN","IBNCPER",184,0)
 ;
"RTN","IBNCPER",185,0)
GETRX(IBE,IBSS,IBST,IBEND) ; get ien of file 52 from the XTMP temp global
"RTN","IBNCPER",186,0)
 ; array from where the ECME BILLING EVENTS report gets its data
"RTN","IBNCPER",187,0)
 ;  This subroutine is called when the user enters an ECME# as
"RTN","IBNCPER",188,0)
 ;  part of the search criteria
"RTN","IBNCPER",189,0)
 ; input - 
"RTN","IBNCPER",190,0)
 ;   IBE = ECME #
"RTN","IBNCPER",191,0)
 ;   IBSS = "IBNCPDP-"
"RTN","IBNCPER",192,0)
 ;   IBST = "IBNCPDP-"_start date (where date=CYYMMDD)
"RTN","IBNCPER",193,0)
 ;   IBEND = "IBNCPDP-"_end date (same date representation as above)
"RTN","IBNCPER",194,0)
 ; output - returns internal entry number of file #52
"RTN","IBNCPER",195,0)
 N IBRXDA,IBI,IBN,Z,Z1
"RTN","IBNCPER",196,0)
 S IBRXDA=0
"RTN","IBNCPER",197,0)
 S IBI=IBST F  D  S IBI=$O(^XTMP(IBI)) Q:IBI]IBEND  Q:IBI'[IBSS  Q:IBRXDA>0
"RTN","IBNCPER",198,0)
 .S IBN=0 F  S IBN=$O(^XTMP(IBI,IBN)) Q:'IBN  Q:IBRXDA>0  D
"RTN","IBNCPER",199,0)
 ..K Z,Z1 M Z=^XTMP(IBI,IBN),Z1=Z("IBD")
"RTN","IBNCPER",200,0)
 ..Q:'$G(Z("DFN"))
"RTN","IBNCPER",201,0)
 ..Q:$G(Z1("CLAIMID"))'=IBECME
"RTN","IBNCPER",202,0)
 ..S IBRXDA=$G(Z1("PRESCRIPTION"))
"RTN","IBNCPER",203,0)
 Q IBRXDA
"RTN","IBNCPER",204,0)
 ;
"RTN","IBNCPER",205,0)
ULINE(X) ;line
"RTN","IBNCPER",206,0)
 D CHKP Q:IBQ
"RTN","IBNCPER",207,0)
 N I W ! F I=1:1:80 W $G(X,"-")
"RTN","IBNCPER",208,0)
 Q
"RTN","IBNCPER",209,0)
CHKP ;Check for EOP
"RTN","IBNCPER",210,0)
 I $Y>(IOSL-4) D:IBSCR PAUSE Q:IBQ  D HDR
"RTN","IBNCPER",211,0)
 Q
"RTN","IBNCPER",212,0)
DAT(X,Y) Q $$DAT1^IBOUTL(X,.Y)
"RTN","IBNCPER",213,0)
TIM(X) N IBT ;time
"RTN","IBNCPER",214,0)
 S IBT=$$DAT1^IBOUTL(X,1) I $L(IBT," ")<3 Q IBT
"RTN","IBNCPER",215,0)
 I $P(IBT," ",3)="pm" S IBT=$P(IBT," ",1,2)_"p" Q IBT
"RTN","IBNCPER",216,0)
 I $P(IBT," ",3)="am" S IBT=$P(IBT," ",1,2)_"a" Q IBT
"RTN","IBNCPER",217,0)
 Q IBT
"RTN","IBNCPER",218,0)
 ;
"RTN","IBNCPER",219,0)
USR(X) ;
"RTN","IBNCPER",220,0)
 I $D(^VA(200,+X,0)) Q $P(^(0),U)
"RTN","IBNCPER",221,0)
 Q X
"RTN","IBNCPER",222,0)
 ;
"RTN","IBNCPER",223,0)
PAT(DFN) Q $P($G(^DPT(DFN,0),"?"),"^")
"RTN","IBNCPER",224,0)
BILL(BN) Q $P($G(^DGCR(399,BN,0),"?"),"^")
"RTN","IBNCPER",225,0)
ARBILL(BN) Q $P($G(^PRCA(430,BN,0),"?"),"^")
"RTN","IBNCPER",226,0)
RX(X) Q $P($G(^PSRX(+X,0)),U)
"RTN","IBNCPER",227,0)
DRUG(IBRX) Q $P($G(^PSDRUG(+$P($G(^PSRX(+IBRX,0)),U,6),0)),U)
"RTN","IBNCPER",228,0)
EVNT(X) ;Transl
"RTN","IBNCPER",229,0)
 I X="BILL" Q "BILLING"
"RTN","IBNCPER",230,0)
 I X="REVERSE" Q "REVERSAL"
"RTN","IBNCPER",231,0)
 I X="AUTO REVERSE" Q "REVERSAL(A)"
"RTN","IBNCPER",232,0)
 I X["RELEASE" Q "RELEASE"
"RTN","IBNCPER",233,0)
 I X["SUBMIT" Q "SUBMIT"
"RTN","IBNCPER",234,0)
 I X["CLOSE" Q "CLOSE"
"RTN","IBNCPER",235,0)
 I X[IBSC Q "FINISH"
"RTN","IBNCPER",236,0)
 Q X
"RTN","IBNCPER",237,0)
 ;
"RTN","IBNCPER",238,0)
BOCD(X) ;Basis of Cost Determ
"RTN","IBNCPER",239,0)
 I +X=7 Q "USUAL & CUSTOMARY"
"RTN","IBNCPER",240,0)
 I +X=1 Q "AWP"
"RTN","IBNCPER",241,0)
 I +X=5 Q "COST CALCULATIONS"
"RTN","IBNCPER",242,0)
 Q X
"RTN","IBNCPER",243,0)
 ;
"RTN","IBNCPER",244,0)
PAUSE ;
"RTN","IBNCPER",245,0)
 N X U IO(0) W !,"Press RETURN to continue, '^' to exit:" R X:DTIME S:'$T X="^" S:X["^" IBQ=1
"RTN","IBNCPER",246,0)
 U IO
"RTN","IBNCPER",247,0)
 Q
"RTN","IBNCPER",248,0)
 ;IBNCPER
"RTN","IBNCPER1")
0^56^B6437334
"RTN","IBNCPER1",1,0)
IBNCPER1 ;DALOI/KML - NCPDP BILLING EVENTS REPORT ;10-JUN-2003
"RTN","IBNCPER1",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPER1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPER1",4,0)
 ;
"RTN","IBNCPER1",5,0)
 ;NCPDP PHASE III
"RTN","IBNCPER1",6,0)
 Q
"RTN","IBNCPER1",7,0)
 ;
"RTN","IBNCPER1",8,0)
 ;finish
"RTN","IBNCPER1",9,0)
DSTAT ;
"RTN","IBNCPER1",10,0)
 N IBX,IBT,IBSC,IB1ST,IBNXT
"RTN","IBNCPER1",11,0)
 S IB1ST=1
"RTN","IBNCPER1",12,0)
 D CHKP^IBNCPER Q:IBQ
"RTN","IBNCPER1",13,0)
 W !?10,"ELIGIBILITY: " F IBX=2:1 S IBT=$P($T(EXEMPT+IBX^IBNCPDP1),";",3),IBSC=$P(IBT,U,2) Q:IBSC=""  D:$G(Z1(IBSC))]""  Q:IBQ
"RTN","IBNCPER1",14,0)
 . I 'IB1ST W "," I $X>70 D CHKP^IBNCPER Q:IBQ  W !?10 S IB1ST=1
"RTN","IBNCPER1",15,0)
 . W " ",IBSC,":",$S(Z1(IBSC):"Yes",Z1(IBSC)=0:"No",1:"?") S IB1ST=0
"RTN","IBNCPER1",16,0)
 Q:IBQ
"RTN","IBNCPER1",17,0)
 I $G(Z1("DRUG")) D CHKP^IBNCPER Q:IBQ  W !?10,"DRUG:",$P($G(^PSDRUG(+Z1("DRUG"),0)),U)
"RTN","IBNCPER1",18,0)
 D CHKP^IBNCPER Q:IBQ  W !?10
"RTN","IBNCPER1",19,0)
 W "NDC:",$G(Z1("NDC"),"No"),", QTY:",$G(Z1("QTY"),"No"),", COST:",$G(Z1("COST"),"No")
"RTN","IBNCPER1",20,0)
 I $G(Z1("DEA"))]"" W ", DEA:",Z1("DEA")
"RTN","IBNCPER1",21,0)
 ;S IBU=$P($G(^VA(200,+$G(Z1("FILLED BY")),0)),U)
"RTN","IBNCPER1",22,0)
 ;
"RTN","IBNCPER1",23,0)
 S IBX=0,IBNXT=0 F  S IBX=$O(Z1("INS",IBX)) Q:'IBX  D  Q:IBQ  S IBNXT=1
"RTN","IBNCPER1",24,0)
 .N Y S Y=$G(Z1("INS",IBX,1)) Q:'Y
"RTN","IBNCPER1",25,0)
 .I IBNXT D CHKP^IBNCPER Q:IBQ  W !?10,"-----------"
"RTN","IBNCPER1",26,0)
 .D CHKP^IBNCPER Q:IBQ  W !?10
"RTN","IBNCPER1",27,0)
 .W "PLAN:",$P($G(^IBA(355.3,+Y,0)),U,3),"  "
"RTN","IBNCPER1",28,0)
 .W "INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+Y,0)),0)),U)
"RTN","IBNCPER1",29,0)
 .D CHKP^IBNCPER Q:IBQ  W !?10 S IB1ST=1
"RTN","IBNCPER1",30,0)
 .I $P(Y,U,3)]"" W "BIN:",$P(Y,U,2) S IB1ST=0
"RTN","IBNCPER1",31,0)
 .I $P(Y,U,3)]"" W:'IB1ST ", " W "PCN:",$P(Y,U,3) S IB1ST=0
"RTN","IBNCPER1",32,0)
 .I $P(Y,U,4)]"" W:'IB1ST ", " W "PAYER SHEET B1:",$P(Y,U,4) S IB1ST=0
"RTN","IBNCPER1",33,0)
 .D CHKP^IBNCPER Q:IBQ  W !?10 S IB1ST=1
"RTN","IBNCPER1",34,0)
 .I $P(Y,U,11)]"" W "PAYER SHEET B2:",$P(Y,U,11) S IB1ST=0
"RTN","IBNCPER1",35,0)
 .I $P(Y,U,12)]"" W:'IB1ST ", " W "PAYER SHEET B3:",$P(Y,U,12)
"RTN","IBNCPER1",36,0)
 .S Y=$G(Z1("INS",IBX,2)) Q:Y=""
"RTN","IBNCPER1",37,0)
 .D CHKP^IBNCPER Q:IBQ  W !?10 S IB1ST=1
"RTN","IBNCPER1",38,0)
 .I $P(Y,U)]"" W "DISPENSING FEE:",$P(Y,U) S IB1ST=0
"RTN","IBNCPER1",39,0)
 .I $P(Y,U,2)]"" W:'IB1ST ", " W "BASIS OF COST DETERM:",$$BOCD^IBNCPER($P(Y,U,2)) S IB1ST=0
"RTN","IBNCPER1",40,0)
 .D CHKP^IBNCPER Q:IBQ  W !?10 S IB1ST=1
"RTN","IBNCPER1",41,0)
 .I $P(Y,U,3)]"" W "COST:",$J($P(Y,U,3),0,2) S IB1ST=0
"RTN","IBNCPER1",42,0)
 .I $P(Y,U,4)]"" W:'IB1ST ", " W "GROSS AMT DUE:",$J($P(Y,U,4),0,2) S IB1ST=0
"RTN","IBNCPER1",43,0)
 .I $P(Y,U,5)]"" W:'IB1ST ", " W "ADMIN FEE:",$J($P(Y,U,5),0,2)
"RTN","IBNCPER1",44,0)
 Q:IBQ
"RTN","IBNCPER1",45,0)
 ;
"RTN","IBNCPER1",46,0)
 ;I IBU="" S IBU=$G(Z("USER"))
"RTN","IBNCPER1",47,0)
 ;I IBU]"" D CHKP Q:IBQ  W !?10,"USER:",$$USR(IBU)
"RTN","IBNCPER1",48,0)
 D CHKP^IBNCPER Q:IBQ  W !?10,"USER:",$$USR^IBNCPER(+$G(Z1("USER")))
"RTN","IBNCPER1",49,0)
 Q
"RTN","IBNCPER1",50,0)
 ;
"RTN","IBNCPER1",51,0)
 ;IBNCPER1
"RTN","IBNCPNB")
0^32^B20259867
"RTN","IBNCPNB",1,0)
IBNCPNB ;OAK/ELZ - UTILITIES FOR NCPCP ;24-JUN-2003
"RTN","IBNCPNB",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPNB",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPNB",4,0)
 ;
"RTN","IBNCPNB",5,0)
 ;NCPDP PHASE III
"RTN","IBNCPNB",6,0)
 Q
"RTN","IBNCPNB",7,0)
 ;
"RTN","IBNCPNB",8,0)
 ;
"RTN","IBNCPNB",9,0)
NONBR(DFN,IBRX,IBFIL,IBADT,IBCR,IBPAP,IBRC,IBCC) ; Set non-billable reason to CT
"RTN","IBNCPNB",10,0)
 ; input:
"RTN","IBNCPNB",11,0)
 ;    DFN - Patient
"RTN","IBNCPNB",12,0)
 ;    IBRX - Rx IEN
"RTN","IBNCPNB",13,0)
 ;    IBFIL - fill#
"RTN","IBNCPNB",14,0)
 ;    IBADT - fill date
"RTN","IBNCPNB",15,0)
 ;    IBCR - Close Claim Reason (#356.8)
"RTN","IBNCPNB",16,0)
 ;    IBPAP - Autobillable flag (billable (1) / non-billable (0) flag)
"RTN","IBNCPNB",17,0)
 ;    IBRC - Release Copay (entered by OPECC)
"RTN","IBNCPNB",18,0)
 ;    IBCC - Close Reason Comment (entered by OPECC)
"RTN","IBNCPNB",19,0)
 N IBTRKRN,DIE,IBRESN,DR,DA,IBRMARK,IBLOCK,IBEABD,IBEABD,IBACT
"RTN","IBNCPNB",20,0)
 ; update claims tracking
"RTN","IBNCPNB",21,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRX,IBFIL,0))
"RTN","IBNCPNB",22,0)
 I 'IBTRKRN D  ; if it doesn't exist - create it
"RTN","IBNCPNB",23,0)
 . N IBTRKR
"RTN","IBNCPNB",24,0)
 . S IBTRKR=$G(^IBE(350.9,1,6)) ; claims tracking info
"RTN","IBNCPNB",25,0)
 . ; date can't be before parameters
"RTN","IBNCPNB",26,0)
 . S $P(IBTRKR,U)=$S('$P(IBTRKR,U,4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPNB",27,0)
 . I 'IBTRKR Q  ; CT Disabled
"RTN","IBNCPNB",28,0)
 . D CT^IBNCPDPU(DFN,IBRX,IBFIL,IBADT,$G(IBCR))
"RTN","IBNCPNB",29,0)
 . S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRX,IBFIL,0))
"RTN","IBNCPNB",30,0)
 I 'IBTRKRN Q  ; CT disabled
"RTN","IBNCPNB",31,0)
 L +^IBT(356,IBTRKRN):10 S IBLOCK=$T
"RTN","IBNCPNB",32,0)
 S DIE="^IBT(356,",DA=IBTRKRN
"RTN","IBNCPNB",33,0)
 ;
"RTN","IBNCPNB",34,0)
 ;
"RTN","IBNCPNB",35,0)
 ; if Billable - set EABD+60
"RTN","IBNCPNB",36,0)
 I '$G(IBCR) D  G NONBRQ
"RTN","IBNCPNB",37,0)
 .Q:$$GET1^DIQ(356,IBTRKRN_",",.19,"I")  ;quit if non-billable
"RTN","IBNCPNB",38,0)
 .S IBEABD=$$EABD^IBTUTL($O(^IBE(356.6,"AC",4,0)),IBADT)
"RTN","IBNCPNB",39,0)
 .I IBEABD S IBEABD=$$FMADD^XLFDT(IBEABD,60)
"RTN","IBNCPNB",40,0)
 .S DR=".17////^S X=IBEABD" D ^DIE
"RTN","IBNCPNB",41,0)
 ;
"RTN","IBNCPNB",42,0)
 ; if still billable, set the EABD.
"RTN","IBNCPNB",43,0)
 ; 
"RTN","IBNCPNB",44,0)
 ; Don't check for the 2nd insurance in Phase 3 --
"RTN","IBNCPNB",45,0)
 ; allow the claim to become non-billable, ECME has already warned
"RTN","IBNCPNB",46,0)
 ; the user and provided information about the 2nd insurance
"RTN","IBNCPNB",47,0)
 ; in the User Screen
"RTN","IBNCPNB",48,0)
 ; I IBPAP!$$MOREINS(DFN,IBADT) D  G NONBRQ
"RTN","IBNCPNB",49,0)
 ; 
"RTN","IBNCPNB",50,0)
 I IBPAP D  G NONBRQ
"RTN","IBNCPNB",51,0)
 . S IBEABD=$$EABD^IBTUTL($O(^IBE(356.6,"AC",4,0)),IBADT)
"RTN","IBNCPNB",52,0)
 . I IBEABD<DT S IBEABD=DT
"RTN","IBNCPNB",53,0)
 . S DR=".19///@" D ^DIE ; it re-sets .17 (trigger in #356)
"RTN","IBNCPNB",54,0)
 . S DR=".17////^S X=IBEABD"
"RTN","IBNCPNB",55,0)
 . S IBRMARK=$$REASON^IBNCPDPU(IBCR)
"RTN","IBNCPNB",56,0)
 . I IBCC'="" S IBRMARK=IBRMARK_"; "_IBCC
"RTN","IBNCPNB",57,0)
 . I $L($G(IBCC))>2 S DR=DR_";1.08////^S X=$E(IBRMARK,1,80)"
"RTN","IBNCPNB",58,0)
 . D ^DIE
"RTN","IBNCPNB",59,0)
 ;
"RTN","IBNCPNB",60,0)
 ; set non-billable reason
"RTN","IBNCPNB",61,0)
 S IBRMARK=$$REASON^IBNCPDPU(IBCR)
"RTN","IBNCPNB",62,0)
 I IBRMARK="" S IBRMARK="OTHER" S IBCC="Unknown NBR '"_IBCR_"'. "_$G(IBCC)
"RTN","IBNCPNB",63,0)
 S DR=".19///"_IBRMARK
"RTN","IBNCPNB",64,0)
 I $L($G(IBCC))>2 S DR=DR_";1.08////^S X=$E(IBCC,1,80)"
"RTN","IBNCPNB",65,0)
 D ^DIE
"RTN","IBNCPNB",66,0)
 ;
"RTN","IBNCPNB",67,0)
NONBRQ ;
"RTN","IBNCPNB",68,0)
 I $G(IBRC) D  ; Release Copay
"RTN","IBNCPNB",69,0)
 . S IBACT=$$RELCOPAY(DFN,IBRX,IBFIL,1,IBADT,0) ; release copay charges off hold
"RTN","IBNCPNB",70,0)
 . I IBACT D RELBUL^IBNCPEB(DFN,IBRX,IBFIL,IBADT,IBACT,IBCR,$G(IBCC),0)
"RTN","IBNCPNB",71,0)
 I IBLOCK L -^IBT(356,IBTRKRN)
"RTN","IBNCPNB",72,0)
 Q
"RTN","IBNCPNB",73,0)
 ;
"RTN","IBNCPNB",74,0)
 ;
"RTN","IBNCPNB",75,0)
RELCOPAY(DFN,IBRX,IBFIL,IBRETRY,IBADT,IBIFN) ; Release copay charges on hold
"RTN","IBNCPNB",76,0)
 ; Input:
"RTN","IBNCPNB",77,0)
 ;    DFN - Patient IEN
"RTN","IBNCPNB",78,0)
 ;    IBRX - Rx IEN
"RTN","IBNCPNB",79,0)
 ;    IBFIL - fill/refill #
"RTN","IBNCPNB",80,0)
 ;    IBRETRY - retry flag
"RTN","IBNCPNB",81,0)
 ;    IBADT - fill date
"RTN","IBNCPNB",82,0)
 ;    IBIFN - 3rd party bill IEN
"RTN","IBNCPNB",83,0)
 ; this procedure will be called if the Payer agreed to pay 0.00
"RTN","IBNCPNB",84,0)
 ; or the claim was closed as non-billable by the OPECC.
"RTN","IBNCPNB",85,0)
 N IBACT,IBZ,IBFOUND,IBX,IBSEQNO,IBNOS,Y,IBDUZ,RCDUZ
"RTN","IBNCPNB",86,0)
 ; Schedule the task to speed up the whole process
"RTN","IBNCPNB",87,0)
 I 'IBRETRY D RCTASK(DFN,IBRX,IBFIL,+IBRETRY,IBADT,IBIFN) Q 0
"RTN","IBNCPNB",88,0)
 S IBFOUND=0
"RTN","IBNCPNB",89,0)
 S IBACT="A" F  S IBACT=$O(^IB("AH",DFN,IBACT),-1) Q:'IBACT  D  Q:IBFOUND
"RTN","IBNCPNB",90,0)
 . S IBZ=$G(^IB(IBACT,0)) Q:IBZ=""
"RTN","IBNCPNB",91,0)
 . S IBX=$P(IBZ,U,4)
"RTN","IBNCPNB",92,0)
 . I +IBX'=52 Q  ; not an Rx
"RTN","IBNCPNB",93,0)
 . I +$P(IBX,":",2)'=IBRX Q  ; other Rx
"RTN","IBNCPNB",94,0)
 . I +$P(IBX,":",3)'=IBFIL Q  ; other fill
"RTN","IBNCPNB",95,0)
 . S IBFOUND=IBACT
"RTN","IBNCPNB",96,0)
 I 'IBFOUND D RCTASK(DFN,IBRX,IBFIL,+$G(IBRETRY),IBADT,IBIFN) Q 0
"RTN","IBNCPNB",97,0)
 S IBSEQNO=1,IBNOS=IBFOUND
"RTN","IBNCPNB",98,0)
 S IBDUZ=$P($G(^IB(IBFOUND,1)),U) ; who entered the copay charge?
"RTN","IBNCPNB",99,0)
 S RCDUZ=IBDUZ
"RTN","IBNCPNB",100,0)
 D ^IBR I Y<0 Q Y
"RTN","IBNCPNB",101,0)
 Q IBFOUND
"RTN","IBNCPNB",102,0)
 ;
"RTN","IBNCPNB",103,0)
 ;Called by TaskMan
"RTN","IBNCPNB",104,0)
RELCRG ;
"RTN","IBNCPNB",105,0)
 N IBACT
"RTN","IBNCPNB",106,0)
 S IBACT=$$RELCOPAY(DFN,IBRX,IBFIL,IBRETRY,IBADT,IBIFN)
"RTN","IBNCPNB",107,0)
 I IBACT>0 D RELBUL^IBNCPEB(DFN,IBRX,IBFIL,IBADT,IBACT,0,"",IBIFN)
"RTN","IBNCPNB",108,0)
 Q
"RTN","IBNCPNB",109,0)
 ;
"RTN","IBNCPNB",110,0)
 ;Schedule Release Copay
"RTN","IBNCPNB",111,0)
RCTASK(DFN,IBRX,IBFIL,IBRETRY,IBADT,IBIFN) ;
"RTN","IBNCPNB",112,0)
 N I,ZTRTN,ZTSAVE,ZTDESC,ZTDTH,ZTIO
"RTN","IBNCPNB",113,0)
 S IBRETRY=IBRETRY+1
"RTN","IBNCPNB",114,0)
 I IBRETRY>2 Q  ; Only two extra attempts
"RTN","IBNCPNB",115,0)
 S ZTRTN="RELCRG^IBNCPNB"
"RTN","IBNCPNB",116,0)
 F I="DFN","IBRX","IBFIL","IBRETRY","IBADT","IBIFN" S ZTSAVE(I)=""
"RTN","IBNCPNB",117,0)
 S ZTDESC="RELEASE COPAY RX IEN# "_IBRX
"RTN","IBNCPNB",118,0)
 S ZTIO=""
"RTN","IBNCPNB",119,0)
 S ZTDTH=$$HADD^XLFDT($H,0,0,0,$S(IBRETRY=1:10,1:600))
"RTN","IBNCPNB",120,0)
 D ^%ZTLOAD
"RTN","IBNCPNB",121,0)
 Q
"RTN","IBNCPNB",122,0)
 ;
"RTN","IBNCPNB",123,0)
 ;
"RTN","IBNCPNB",124,0)
 ; does the pat have >1 billable insur with pharm coverage?
"RTN","IBNCPNB",125,0)
MOREINS(DFN,IBADT) ;
"RTN","IBNCPNB",126,0)
 ; DFN - ptr to the patient
"RTN","IBNCPNB",127,0)
 ; IBADT - the effective date
"RTN","IBNCPNB",128,0)
 N IBANY,IBX,IBINS,IBT,IBRES,IBCAT
"RTN","IBNCPNB",129,0)
 S IBRES=0 ; No by default
"RTN","IBNCPNB",130,0)
 S IBCAT=$O(^IBE(355.31,"B","PHARMACY",0))
"RTN","IBNCPNB",131,0)
 ; -- look up insurance for patient
"RTN","IBNCPNB",132,0)
 D ALL^IBCNS1(DFN,"IBINS",1,IBADT,1)
"RTN","IBNCPNB",133,0)
 S IBX=0 F  S IBX=$O(IBINS("S",IBX)) Q:'IBX  D  Q:IBRES>1
"RTN","IBNCPNB",134,0)
 . S IBT=0 F  S IBT=$O(IBINS("S",IBX,IBT)) Q:'IBT  D  Q:IBRES>1
"RTN","IBNCPNB",135,0)
 . . N IBPL
"RTN","IBNCPNB",136,0)
 . . S IBPL=+$P($G(IBINS(IBT,0)),U,18) Q:'IBPL
"RTN","IBNCPNB",137,0)
 . . I '$$PLCOV^IBCNSU3(IBPL,IBADT,IBCAT) Q
"RTN","IBNCPNB",138,0)
 . . S IBRES=IBRES+1
"RTN","IBNCPNB",139,0)
 ;
"RTN","IBNCPNB",140,0)
 Q (IBRES>1)
"RTN","IBNCPNB",141,0)
 ;
"RTN","IBNCPNB",142,0)
 ;IBNCPNB
"RTN","IBNCPRR")
0^43^B91643429
"RTN","IBNCPRR",1,0)
IBNCPRR ;DALOI/AAT - Prescription Report for 3rd Party Billing cross check ;07/21/04
"RTN","IBNCPRR",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBNCPRR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBNCPRR",4,0)
 ;
"RTN","IBNCPRR",5,0)
EN ;
"RTN","IBNCPRR",6,0)
 N IBQ,IBSITE,IBWMC,IBENB,IBBDT,IBEDT,IBINS,IBSDE,IBSCR
"RTN","IBNCPRR",7,0)
 S IBQ=0 ; quit flag
"RTN","IBNCPRR",8,0)
 ; Prompts to the user:
"RTN","IBNCPRR",9,0)
 D DIV Q:IBQ  ; Division
"RTN","IBNCPRR",10,0)
 D WMC Q:IBQ  ; W/M/C criteria
"RTN","IBNCPRR",11,0)
 D ENB Q:IBQ  ; ECME/NON-ECME/BOTH criteria
"RTN","IBNCPRR",12,0)
 D DATE Q:IBQ  ; From-To date range
"RTN","IBNCPRR",13,0)
 D INS Q:IBQ  ; Insurance company
"RTN","IBNCPRR",14,0)
 D SDE Q:IBQ  ; Summary/Detailed/Excel criteria
"RTN","IBNCPRR",15,0)
 D DEVICE Q:IBQ
"RTN","IBNCPRR",16,0)
 D RUN
"RTN","IBNCPRR",17,0)
 I IBQ'=2 D PAUSE2
"RTN","IBNCPRR",18,0)
 Q
"RTN","IBNCPRR",19,0)
 ;
"RTN","IBNCPRR",20,0)
DIV N DIC,DIRUT
"RTN","IBNCPRR",21,0)
 W ! S DIC("A")="Division: ",DIC=59,DIC(0)="AEQM" D ^DIC
"RTN","IBNCPRR",22,0)
 I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPRR",23,0)
 I Y'>0 S IBQ=1 Q
"RTN","IBNCPRR",24,0)
 S IBSITE=+Y
"RTN","IBNCPRR",25,0)
 Q
"RTN","IBNCPRR",26,0)
 ;
"RTN","IBNCPRR",27,0)
WMC N DIR,DIRUT,Y
"RTN","IBNCPRR",28,0)
 W ! S DIR("B")="CMOP",DIR("A")="(W)INDOW/(M)AIL/(C)MOP: "
"RTN","IBNCPRR",29,0)
 S DIR(0)="SA^W:WINDOW;M:MAIL;C:CMOP" D ^DIR
"RTN","IBNCPRR",30,0)
 I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPRR",31,0)
 S IBWMC=Y
"RTN","IBNCPRR",32,0)
 Q
"RTN","IBNCPRR",33,0)
 ;
"RTN","IBNCPRR",34,0)
ENB N DIR,DIRUT,Y
"RTN","IBNCPRR",35,0)
 W ! S DIR("B")="ECME BILLABLE",DIR("A")="(E)CME Billable/(N)on-ECME Billable/(B)OTH: "
"RTN","IBNCPRR",36,0)
 S DIR(0)="SA^E:ECME BILLABLE;N:NON-ECME BILLABLE;B:BOTH" D ^DIR
"RTN","IBNCPRR",37,0)
 I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPRR",38,0)
 S IBENB=Y
"RTN","IBNCPRR",39,0)
 Q
"RTN","IBNCPRR",40,0)
 ;
"RTN","IBNCPRR",41,0)
DATE ;
"RTN","IBNCPRR",42,0)
 N %DT,Y
"RTN","IBNCPRR",43,0)
 S (IBBDT,IBEDT)=DT
"RTN","IBNCPRR",44,0)
 S %DT="AEX"
"RTN","IBNCPRR",45,0)
 S %DT("A")="FROM RELEASE DATE: ",%DT("B")="TODAY"
"RTN","IBNCPRR",46,0)
 W ! D ^%DT K %DT
"RTN","IBNCPRR",47,0)
 I Y<0 S IBQ=1 Q
"RTN","IBNCPRR",48,0)
 S IBBDT=+Y
"RTN","IBNCPRR",49,0)
 S %DT="AEX"
"RTN","IBNCPRR",50,0)
 S %DT("A")="TO RELEASE DATE: ",%DT("B")="TODAY" ;$$DAT2^IBOUTL(IBBDT)
"RTN","IBNCPRR",51,0)
 D ^%DT K %DT
"RTN","IBNCPRR",52,0)
 I Y<0 S IBQ=1 Q
"RTN","IBNCPRR",53,0)
 S IBEDT=+Y
"RTN","IBNCPRR",54,0)
 Q
"RTN","IBNCPRR",55,0)
 ;
"RTN","IBNCPRR",56,0)
INS N DIR,DIC,DIRUT,Y
"RTN","IBNCPRR",57,0)
 W ! S DIR("B")="ALL",DIR("A")="(S)INGLE Insurance Company /(A)LL Insurance Companies: "
"RTN","IBNCPRR",58,0)
 S DIR(0)="SA^S:SINGLE INSURANCE COMPANY;A:ALL" D ^DIR
"RTN","IBNCPRR",59,0)
 I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPRR",60,0)
 I Y="A" S IBINS=0 Q
"RTN","IBNCPRR",61,0)
 ;
"RTN","IBNCPRR",62,0)
 S DIC(0)="AEQM",DIC=36
"RTN","IBNCPRR",63,0)
 W ! D ^DIC
"RTN","IBNCPRR",64,0)
 I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPRR",65,0)
 I Y'>0 S IBQ=1 Q
"RTN","IBNCPRR",66,0)
 S IBINS=+Y
"RTN","IBNCPRR",67,0)
 Q
"RTN","IBNCPRR",68,0)
 ;
"RTN","IBNCPRR",69,0)
SDE N DIR,DIRUT
"RTN","IBNCPRR",70,0)
 S DIR("B")="SUMMARY",DIR("A")="(S)UMMARY/(D)ETAILED/(E)XCEL: "
"RTN","IBNCPRR",71,0)
 S DIR(0)="SA^S:SUMMARY;D:DETAILED;E:EXCEL"
"RTN","IBNCPRR",72,0)
 W ! D ^DIR
"RTN","IBNCPRR",73,0)
 I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPRR",74,0)
 S IBSDE=Y
"RTN","IBNCPRR",75,0)
 Q
"RTN","IBNCPRR",76,0)
 ;
"RTN","IBNCPRR",77,0)
DEVICE ;
"RTN","IBNCPRR",78,0)
 N %ZIS,ZTSK,ZTRTN,ZTIO,ZTDESC,POP,ZTSAVE
"RTN","IBNCPRR",79,0)
 S %ZIS="QM"
"RTN","IBNCPRR",80,0)
 W ! D ^%ZIS
"RTN","IBNCPRR",81,0)
 I POP S IBQ=1 Q
"RTN","IBNCPRR",82,0)
 S IBSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","IBNCPRR",83,0)
 ;
"RTN","IBNCPRR",84,0)
 I $D(IO("Q")) D  S IBQ=1
"RTN","IBNCPRR",85,0)
 . S ZTRTN="RUN^IBNCPRR"
"RTN","IBNCPRR",86,0)
 . S ZTIO=ION
"RTN","IBNCPRR",87,0)
 . S ZTSAVE("IB*")=""
"RTN","IBNCPRR",88,0)
 . S ZTDESC="IB ECME CMOP REPORT"
"RTN","IBNCPRR",89,0)
 . D ^%ZTLOAD
"RTN","IBNCPRR",90,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","IBNCPRR",91,0)
 . D HOME^%ZIS
"RTN","IBNCPRR",92,0)
 U IO
"RTN","IBNCPRR",93,0)
 Q
"RTN","IBNCPRR",94,0)
 ;
"RTN","IBNCPRR",95,0)
RUN ;
"RTN","IBNCPRR",96,0)
 N IBPAGE,REF
"RTN","IBNCPRR",97,0)
 S REF=$NA(^TMP($J,"IBNCPRR"))
"RTN","IBNCPRR",98,0)
 K @REF
"RTN","IBNCPRR",99,0)
 S IBPAGE=0
"RTN","IBNCPRR",100,0)
 D COLLECT  ; Collect the data in ^TMP
"RTN","IBNCPRR",101,0)
 U IO
"RTN","IBNCPRR",102,0)
 D REPORT
"RTN","IBNCPRR",103,0)
 I 'IBSCR W !,@IOF
"RTN","IBNCPRR",104,0)
 D ^%ZISC
"RTN","IBNCPRR",105,0)
 K @REF
"RTN","IBNCPRR",106,0)
 Q
"RTN","IBNCPRR",107,0)
 ;
"RTN","IBNCPRR",108,0)
REPORT ;
"RTN","IBNCPRR",109,0)
 N IBDT,IBRX,IBFL,IBPN,DFN,IBD
"RTN","IBNCPRR",110,0)
 D HDR
"RTN","IBNCPRR",111,0)
 I '$D(@REF) W !,"No data meet the criteria."
"RTN","IBNCPRR",112,0)
 S IBDT="" F  S IBDT=$O(@REF@(IBDT)) Q:IBDT=""  D  Q:IBQ
"RTN","IBNCPRR",113,0)
 . S IBPN="" F  S IBPN=$O(@REF@(IBDT,IBPN)) Q:IBPN=""  D  Q:IBQ
"RTN","IBNCPRR",114,0)
 .. S IBRX="" F  S IBRX=$O(@REF@(IBDT,IBPN,IBRX)) Q:IBRX=""  D  Q:IBQ
"RTN","IBNCPRR",115,0)
 ... S IBFL="" F  S IBFL=$O(@REF@(IBDT,IBPN,IBRX,IBFL)) Q:IBFL=""  D  Q:IBQ
"RTN","IBNCPRR",116,0)
 .... S IBD=$G(@REF@(IBDT,IBPN,IBRX,IBFL)) Q:IBD=""
"RTN","IBNCPRR",117,0)
 .... I IBSDE="S" D WRLINE Q
"RTN","IBNCPRR",118,0)
 .... I IBSDE="D" D WRLINE2 Q
"RTN","IBNCPRR",119,0)
 .... I IBSDE="E" D WRLINE3 Q
"RTN","IBNCPRR",120,0)
 ;
"RTN","IBNCPRR",121,0)
 Q
"RTN","IBNCPRR",122,0)
 ;
"RTN","IBNCPRR",123,0)
WRLINE ; Write the summary report line
"RTN","IBNCPRR",124,0)
 D CHKP Q:IBQ
"RTN","IBNCPRR",125,0)
 W !,$$DAT3^IBOUTL(IBDT)," ",?12,$E(IBPN,1,23)," "
"RTN","IBNCPRR",126,0)
 W ?36,$E($P($G(^PSRX(IBRX,0)),U),1,11)," ",?48,IBFL
"RTN","IBNCPRR",127,0)
 W ?51,$P(IBD,U,3)," " ; ECME number
"RTN","IBNCPRR",128,0)
 W ?59,$P($G(^DGCR(399,+$P(IBD,U,4),0)),U)," " ; Bill #
"RTN","IBNCPRR",129,0)
 W ?67,$E($P($G(^DIC(36,+$P(IBD,U,5),0)),U),1,13) ; Insurance
"RTN","IBNCPRR",130,0)
 Q
"RTN","IBNCPRR",131,0)
 ;
"RTN","IBNCPRR",132,0)
WRLINE2 ; Write the detailed report line
"RTN","IBNCPRR",133,0)
 D CHKP Q:IBQ
"RTN","IBNCPRR",134,0)
 W !,$$DAT(IBDT)," ",?10,$E(IBPN,1,18)," "
"RTN","IBNCPRR",135,0)
 W ?29,$$SSN4(+IBD)
"RTN","IBNCPRR",136,0)
 W ?34,$E($P($G(^PSRX(IBRX,0)),U),1,10)," "
"RTN","IBNCPRR",137,0)
 W ?45,IBFL," "
"RTN","IBNCPRR",138,0)
 W ?49,$$DAT($P(IBD,U,2))," "
"RTN","IBNCPRR",139,0)
 W ?60,$E($P($G(^PSDRUG(+$P($G(^PSRX(IBRX,0)),U,6),0)),U),1,20)
"RTN","IBNCPRR",140,0)
 ; ECME#/Rx Status/Copay
"RTN","IBNCPRR",141,0)
 D CHKP Q:IBQ
"RTN","IBNCPRR",142,0)
 W !?5,"ECME#: ",$P(IBD,U,3),", Rx Status: ",$$RXSTAT(+IBD,IBRX),", Rx Copay: ",$$COPAY(IBRX,IBFL)
"RTN","IBNCPRR",143,0)
 ; Bill Number/Insurance/Group
"RTN","IBNCPRR",144,0)
 I $P(IBD,U,4) D CHKP Q:IBQ  D
"RTN","IBNCPRR",145,0)
 . W !?5,"Bill#: ",$P($G(^DGCR(399,+$P(IBD,U,4),0)),U)
"RTN","IBNCPRR",146,0)
 . W ", Insurance: ",$E($P($G(^DIC(36,+$P(IBD,U,5),0)),U),1,20)
"RTN","IBNCPRR",147,0)
 . ;W ", Group Ins.Plan: ?"
"RTN","IBNCPRR",148,0)
 ; CMOP Transactions
"RTN","IBNCPRR",149,0)
 I IBWMC="C" D  Q:IBQ
"RTN","IBNCPRR",150,0)
 . N IBCMOP,IBZ,IBANY
"RTN","IBNCPRR",151,0)
 . S IBANY=0
"RTN","IBNCPRR",152,0)
 . S IBCMOP=0 F  S IBCMOP=$O(^PSRX(IBRX,4,IBCMOP)) Q:'IBCMOP  D  Q:IBQ
"RTN","IBNCPRR",153,0)
 .. S IBZ=$G(^PSRX(IBRX,4,IBCMOP,0)) Q:IBZ=""
"RTN","IBNCPRR",154,0)
 .. I +$P(IBZ,U,3)'=IBFL Q  ; different refill
"RTN","IBNCPRR",155,0)
 .. D CHKP Q:IBQ
"RTN","IBNCPRR",156,0)
 .. W !?5,"CMOP SEQUENCE# ",$P(IBZ,U,2)
"RTN","IBNCPRR",157,0)
 .. W ", STATUS: ",$$EXTERNAL^DILFD(52.01,3,,$P(IBZ,U,4))
"RTN","IBNCPRR",158,0)
 .. W ", NDC: ",$P(IBZ,U,8) S IBANY=1
"RTN","IBNCPRR",159,0)
 . I 'IBANY D CHKP Q:IBQ  W !?5,"NO CMOP TRANSACTIONS FOUND"
"RTN","IBNCPRR",160,0)
 ;
"RTN","IBNCPRR",161,0)
 ; Write activity log
"RTN","IBNCPRR",162,0)
 N IBACT,IBFROM,IBTO
"RTN","IBNCPRR",163,0)
 S IBFROM=IBDT,IBTO=$$NXTREFDT(IBRX,IBFL)
"RTN","IBNCPRR",164,0)
 I IBTO<IBFROM S IBTO=IBFROM
"RTN","IBNCPRR",165,0)
 S IBACT=0  F  S IBACT=$O(^PSRX(IBRX,"A",IBACT)) Q:'IBACT  D  Q:IBQ
"RTN","IBNCPRR",166,0)
 . N IBZ,IBTXT
"RTN","IBNCPRR",167,0)
 . S IBZ=^PSRX(IBRX,"A",IBACT,0) Q:IBZ=""
"RTN","IBNCPRR",168,0)
 . I $P(IBZ,U,2)'="B",$P(IBZ,U,2)'="M" Q
"RTN","IBNCPRR",169,0)
 . I IBZ<IBFROM Q
"RTN","IBNCPRR",170,0)
 . I IBZ>IBTO Q
"RTN","IBNCPRR",171,0)
 . D CHKP Q:IBQ
"RTN","IBNCPRR",172,0)
 . S IBTXT=$P(IBZ,U,5)
"RTN","IBNCPRR",173,0)
 . S:$TR(IBTXT," ")="" IBTXT=$$EXTERNAL^DILFD(52.3,.02,,$P(IBZ,U,2))
"RTN","IBNCPRR",174,0)
 . W !?5,$$DATTIM(+IBZ),?21,$E(IBTXT,1,59)
"RTN","IBNCPRR",175,0)
 D CHKP Q:IBQ
"RTN","IBNCPRR",176,0)
 W !?5,"-------------------------------"
"RTN","IBNCPRR",177,0)
 Q
"RTN","IBNCPRR",178,0)
 ;
"RTN","IBNCPRR",179,0)
WRLINE3 ; Write the Excel report line
"RTN","IBNCPRR",180,0)
 W !,$$DAT(IBDT),U,$E(IBPN,1,23),U
"RTN","IBNCPRR",181,0)
 W $E($P($G(^PSRX(IBRX,0)),U),1,11),U,IBFL,U
"RTN","IBNCPRR",182,0)
 W $$DAT($P(IBD,U,2)),U
"RTN","IBNCPRR",183,0)
 W $P(IBD,U,3),U ; ECME number
"RTN","IBNCPRR",184,0)
 W $P($G(^DGCR(399,+$P(IBD,U,4),0)),U),U ; Bill #
"RTN","IBNCPRR",185,0)
 W $E($P($G(^DIC(36,+$P(IBD,U,5),0)),U),1,13) ; Insurance
"RTN","IBNCPRR",186,0)
 Q
"RTN","IBNCPRR",187,0)
 ;
"RTN","IBNCPRR",188,0)
HDR S IBPAGE=IBPAGE+1
"RTN","IBNCPRR",189,0)
 W @IOF,?10,"IB THIRD PARTY BILLING PHARMACY CROSS-CHECK REPORT for "_$P(^PS(59,IBSITE,0),U),!
"RTN","IBNCPRR",190,0)
 W ?10,$S(IBWMC="C":"CMOP",IBWMC="M":"MAIL",1:"WINDOW")," PRESCRIPTIONS" W ", ",$S(IBSDE="S":"SUMMARY",1:"DETAILED")
"RTN","IBNCPRR",191,0)
 W !?10,"Released ",$$DAT3^IBOUTL(IBBDT)_" to "_$$DAT3^IBOUTL(IBEDT),?70,"Page: "_IBPAGE
"RTN","IBNCPRR",192,0)
 I IBSDE="S" D
"RTN","IBNCPRR",193,0)
 . W !!,"Rel.Date    Patient Name            Rx No   Fill#  ECME#   Bill    Insurance"
"RTN","IBNCPRR",194,0)
 I IBSDE="D" D
"RTN","IBNCPRR",195,0)
 . W !!,"Rel.Date  Patient Name       SSN  Rx No   Fill#  Fil.Date   Drug"
"RTN","IBNCPRR",196,0)
 I IBSDE="E" D
"RTN","IBNCPRR",197,0)
 . W !!,"Rel.Date^Patient Name^SSN^Rx No^Fill#^Fil.Date^ECME#^Bill"
"RTN","IBNCPRR",198,0)
 I IBSDE'="E" D ULINE("=")
"RTN","IBNCPRR",199,0)
 Q
"RTN","IBNCPRR",200,0)
 ;
"RTN","IBNCPRR",201,0)
 ;
"RTN","IBNCPRR",202,0)
COLLECT ;
"RTN","IBNCPRR",203,0)
 N IBDT,IBRX,IBFL,IBP,DFN,IBRXINS,IBZ,IBRXN,IBFLDT,IBPN,IBECN,IBECMBIL,IBRXSITE,IBBIL
"RTN","IBNCPRR",204,0)
 S IBDT=IBBDT-.0001
"RTN","IBNCPRR",205,0)
 ; Released Prescriptions/Refills
"RTN","IBNCPRR",206,0)
 F  S IBDT=$O(^PSRX("AL",IBDT)) Q:'IBDT!($P(IBDT,".")>IBEDT)  D
"RTN","IBNCPRR",207,0)
 . S IBRX="" F  S IBRX=$O(^PSRX("AL",IBDT,IBRX)) Q:IBRX=""  D
"RTN","IBNCPRR",208,0)
 .. S IBZ=$G(^PSRX(IBRX,0))
"RTN","IBNCPRR",209,0)
 .. I IBZ="" Q  ; corrupted x-ref
"RTN","IBNCPRR",210,0)
 .. S IBFL="" F  S IBFL=$O(^PSRX("AL",IBDT,IBRX,IBFL)) Q:IBFL=""  D
"RTN","IBNCPRR",211,0)
 ... S IBRXN=$P(IBZ,U) ; Rx No
"RTN","IBNCPRR",212,0)
 ... S DFN=+$P(IBZ,U,2) ; Patient
"RTN","IBNCPRR",213,0)
 ... S IBPN=$E($P($G(^DPT(DFN,0)),U),1,30) S:IBPN="" IBPN=" "
"RTN","IBNCPRR",214,0)
 ... S IBRXSITE=+$P($G(^PSRX(IBRX,2)),U,9)
"RTN","IBNCPRR",215,0)
 ... I IBSITE'=IBRXSITE Q
"RTN","IBNCPRR",216,0)
 ... S IBFLDT=$S('IBFL:$P($G(^PSRX(IBRX,2)),U,2),1:$P($G(^PSRX(IBRX,1,IBFL,0)),U))
"RTN","IBNCPRR",217,0)
 ... S:'IBFLDT IBFLDT=IBDT
"RTN","IBNCPRR",218,0)
 ... S IBBIL=$$BILL^IBNCPBB(IBRXN,IBFLDT) ; IB Bill
"RTN","IBNCPRR",219,0)
 ... S IBRXINS=$$BILLINS(IBBIL)
"RTN","IBNCPRR",220,0)
 ... I 'IBRXINS S IBRXINS=$$RXINS(IBRX,IBFL)
"RTN","IBNCPRR",221,0)
 ... S IBECMBIL=$$ECMEBIL^IBNCPDPU(DFN,IBFLDT) ; ECME Billable?
"RTN","IBNCPRR",222,0)
 ... ; Apply filters:
"RTN","IBNCPRR",223,0)
 ... I IBENB="E",'IBECMBIL Q
"RTN","IBNCPRR",224,0)
 ... I IBENB="N",IBECMBIL Q
"RTN","IBNCPRR",225,0)
 ... I IBINS,IBRXINS'=IBINS Q
"RTN","IBNCPRR",226,0)
 ... ; Mail/Window/CMOP
"RTN","IBNCPRR",227,0)
 ... I IBWMC'=$$RXWMC(IBRX) Q
"RTN","IBNCPRR",228,0)
 ... S IBECN=$S(IBECMBIL:$$ECMENO(IBRX),1:"")
"RTN","IBNCPRR",229,0)
 ... S @REF@($P(IBDT,"."),IBPN,IBRX,IBFL)=DFN_U_IBFLDT_U_IBECN_U_IBBIL_U_IBRXINS
"RTN","IBNCPRR",230,0)
 ;
"RTN","IBNCPRR",231,0)
 ;;Partial Prescriptions
"RTN","IBNCPRR",232,0)
 ;S IBRXN=0
"RTN","IBNCPRR",233,0)
 ;S IBDT=IBBDT-.001 F  S IBDT=$O(^PSRX("ADP",IBDT)) Q:'IBDT!($P(IBDT,".")>IBEDT)  D
"RTN","IBNCPRR",234,0)
 ;. F  S IBRX=$O(^PSRX("ADP",IBDT,IBRX)) Q:'IBRX  D
"RTN","IBNCPRR",235,0)
 ;.. S IBP=0 F  S IBP=$O(^PSRX("ADP",IBDT,IBRX,IBP)) Q:'IBP  D
"RTN","IBNCPRR",236,0)
 ;... I $G(^PSRX(IBRX,0))="" Q
"RTN","IBNCPRR",237,0)
 ;... S IBPAR=1 D REF
"RTN","IBNCPRR",238,0)
 Q
"RTN","IBNCPRR",239,0)
 ;
"RTN","IBNCPRR",240,0)
RXINS(IBRX,IBFL) ; Determine insurance by the RX
"RTN","IBNCPRR",241,0)
 Q 0
"RTN","IBNCPRR",242,0)
 ;
"RTN","IBNCPRR",243,0)
RXWMC(IBRX) ;WMC
"RTN","IBNCPRR",244,0)
 N IBZ,IBWM
"RTN","IBNCPRR",245,0)
 I $O(^PSRX(IBRX,4,0)) Q "C"
"RTN","IBNCPRR",246,0)
 S IBZ=$G(^PSRX(IBRX,0))
"RTN","IBNCPRR",247,0)
 S IBWM=$P(IBZ,U,11)
"RTN","IBNCPRR",248,0)
 I IBWM="" S IBWM="W" ;default
"RTN","IBNCPRR",249,0)
 Q IBWM
"RTN","IBNCPRR",250,0)
 ;
"RTN","IBNCPRR",251,0)
ECMENO(IBRX) ;
"RTN","IBNCPRR",252,0)
 Q $E(IBRX,$L(IBRX)-6,$L(IBRX))
"RTN","IBNCPRR",253,0)
 ;
"RTN","IBNCPRR",254,0)
BILLINS(IBIFN) ; Insurance from the Bill#
"RTN","IBNCPRR",255,0)
 I 'IBIFN Q 0
"RTN","IBNCPRR",256,0)
 Q +$P($G(^DGCR(399,+IBIFN,"M")),U)
"RTN","IBNCPRR",257,0)
 ;
"RTN","IBNCPRR",258,0)
CHKP ;Check for EOP
"RTN","IBNCPRR",259,0)
 I $Y>(IOSL-4) D:IBSCR PAUSE Q:IBQ  D HDR
"RTN","IBNCPRR",260,0)
 Q
"RTN","IBNCPRR",261,0)
 ;
"RTN","IBNCPRR",262,0)
PAUSE ;
"RTN","IBNCPRR",263,0)
 N X U IO(0) W !!,"Press RETURN to continue, '^' to exit:" R X:DTIME S:'$T X="^" S:X["^" IBQ=2
"RTN","IBNCPRR",264,0)
 U IO
"RTN","IBNCPRR",265,0)
 Q
"RTN","IBNCPRR",266,0)
 ;
"RTN","IBNCPRR",267,0)
PAUSE2 ;
"RTN","IBNCPRR",268,0)
 N X U IO(0) W !!,"Press RETURN to continue:" R X:DTIME S:'$T X="^" S:X["^" IBQ=2
"RTN","IBNCPRR",269,0)
 U IO
"RTN","IBNCPRR",270,0)
 Q
"RTN","IBNCPRR",271,0)
 ;
"RTN","IBNCPRR",272,0)
ULINE(X) ;line
"RTN","IBNCPRR",273,0)
 D CHKP Q:IBQ
"RTN","IBNCPRR",274,0)
 N I W ! F I=1:1:80 W $G(X,"-")
"RTN","IBNCPRR",275,0)
 Q
"RTN","IBNCPRR",276,0)
 ;
"RTN","IBNCPRR",277,0)
DAT(X) ;Convert FM date to displayable (mm/dd/yy) format.
"RTN","IBNCPRR",278,0)
 N DATE,YR
"RTN","IBNCPRR",279,0)
 I $G(X) S YR=$E(X,2,3)
"RTN","IBNCPRR",280,0)
 I $G(X) S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_YR,1:"")
"RTN","IBNCPRR",281,0)
 Q $G(DATE)
"RTN","IBNCPRR",282,0)
 ;
"RTN","IBNCPRR",283,0)
DATTIM(X) ;Convert FM date to displayable (mm/dd/yy HH:MM) format.
"RTN","IBNCPRR",284,0)
 N DATE,YR,IBT,IBM,IBH,IBAP
"RTN","IBNCPRR",285,0)
 I $G(X) S YR=$E(X,2,3)
"RTN","IBNCPRR",286,0)
 I $G(X) S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_YR,1:"")
"RTN","IBNCPRR",287,0)
 S IBT=$P(X,".",2) S:$L(IBT)<4 IBT=IBT_$E("0000",1,4-$L(IBT))
"RTN","IBNCPRR",288,0)
 S IBH=$E(IBT,1,2),IBM=$E(IBT,3,4)
"RTN","IBNCPRR",289,0)
 S IBAP="a" I IBH>12 S IBH=IBH-12,IBAP="p" S:$L(IBH)<2 IBH="0"_IBH
"RTN","IBNCPRR",290,0)
 I IBT S:'IBH IBH=12 S DATE=DATE_" "_IBH_":"_IBM_IBAP
"RTN","IBNCPRR",291,0)
 Q $G(DATE)
"RTN","IBNCPRR",292,0)
 ;
"RTN","IBNCPRR",293,0)
SSN4(DFN) ;last 4 SSN
"RTN","IBNCPRR",294,0)
 N X
"RTN","IBNCPRR",295,0)
 S X=$P($G(^DPT(DFN,0)),U,9)
"RTN","IBNCPRR",296,0)
 Q $E(X,$L(X)-3,$L(X))
"RTN","IBNCPRR",297,0)
 ;
"RTN","IBNCPRR",298,0)
RXSTAT(IBDFN,IBRX) ;
"RTN","IBNCPRR",299,0)
 N IBS
"RTN","IBNCPRR",300,0)
 ;instead of: S IBS=$P($G(^PSRX(IBRX,"STA")),U)
"RTN","IBNCPRR",301,0)
 S IBS=$$RXSTATUS(IBDFN,IBRX)
"RTN","IBNCPRR",302,0)
 Q $$EXTERNAL^DILFD(52,100,,IBS)
"RTN","IBNCPRR",303,0)
 ;
"RTN","IBNCPRR",304,0)
COPAY(IBRX,IBFL) ;
"RTN","IBNCPRR",305,0)
 N IBACT,IBCOP
"RTN","IBNCPRR",306,0)
 S IBACT=$S('IBFL:$P($G(^PSRX(IBRX,"IB")),U,2),1:$P($G(^PSRX(IBRX,1,IBFL,"IB")),U))
"RTN","IBNCPRR",307,0)
 S IBCOP=$P($G(^IB(+IBACT,0)),U,7)
"RTN","IBNCPRR",308,0)
 Q $J(IBCOP,5,2)
"RTN","IBNCPRR",309,0)
 ;
"RTN","IBNCPRR",310,0)
 ; Next refill date (in not exist - DT)
"RTN","IBNCPRR",311,0)
NXTREFDT(IBRX,IBFL) ;
"RTN","IBNCPRR",312,0)
 N IBDT
"RTN","IBNCPRR",313,0)
 S IBDT=$P($P($G(^PSRX(IBRX,1,IBFL+1,0)),U),".")
"RTN","IBNCPRR",314,0)
 S:'IBDT IBDT=DT
"RTN","IBNCPRR",315,0)
 Q IBDT
"RTN","IBNCPRR",316,0)
 ;
"RTN","IBNCPRR",317,0)
RXSTATUS(IBDFN,IBRX) ;
"RTN","IBNCPRR",318,0)
 N X
"RTN","IBNCPRR",319,0)
 K ^TMP($J,"IBNCPDP52")
"RTN","IBNCPRR",320,0)
 D RX^PSO52API(IBDFN,"IBNCPDP52",IBRX,"","ST")
"RTN","IBNCPRR",321,0)
 S X=+$G(^TMP($J,"IBNCPDP52",IBDFN,IBRX,100))
"RTN","IBNCPRR",322,0)
 K ^TMP($J,"IBNCPDP52")
"RTN","IBNCPRR",323,0)
 Q X
"RTN","IBNCPRR",324,0)
 ;
"RTN","IBRFN")
0^19^B49341340
"RTN","IBRFN",1,0)
IBRFN ;ALB/AAS - Supported functions for AR ;5-MAY-1992
"RTN","IBRFN",2,0)
 ;;2.0;INTEGRATED BILLING;**52,130,183,223,309,276**;21-MAR-94
"RTN","IBRFN",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBRFN",4,0)
 ;
"RTN","IBRFN",5,0)
ERR(Y) ; Input Y = -1^error code[;error code...]^literal message
"RTN","IBRFN",6,0)
 ; Output IBRERR = error message 1
"RTN","IBRFN",7,0)
 ;        if more than one code then
"RTN","IBRFN",8,0)
 ;        IBRERR(n)=error code n
"RTN","IBRFN",9,0)
 N N,X,X1,X2 K IBRERR S IBRERR=""
"RTN","IBRFN",10,0)
 G:+Y>0 ERRQ
"RTN","IBRFN",11,0)
 S X2=$P(Y,U,2) F N=1:1 S X=$P(X2,";",N) Q:X=""  S X1=$P($G(^IBE(350.8,+$O(^IBE(350.8,"AC",X,0)),0)),U,2) D
"RTN","IBRFN",12,0)
 .I N=1 S IBRERR=X1
"RTN","IBRFN",13,0)
 .I $P(Y,U,3)]""!($P(X2,";",2,99)]"") S IBRERR(N)=X1
"RTN","IBRFN",14,0)
 I $P(Y,U,3)]"" S N=N+1,IBRERR(N)=$P(Y,U,3)
"RTN","IBRFN",15,0)
ERRQ Q IBRERR
"RTN","IBRFN",16,0)
 ;
"RTN","IBRFN",17,0)
MESS(Y) ;  -input y=error code - from file 350.8 (piece 3)
"RTN","IBRFN",18,0)
 ;   output error message
"RTN","IBRFN",19,0)
 Q $P($G(^IBE(350.8,+$O(^IBE(350.8,"AC",Y,0)),0)),U,2)
"RTN","IBRFN",20,0)
 ;
"RTN","IBRFN",21,0)
SVDT(BN,VDT) ;returns service dates for a specific bill
"RTN","IBRFN",22,0)
 ;  Input:  BN bill number (external form)
"RTN","IBRFN",23,0)
 ;          VDT name of array to hold outpatient visit dates, pass by value (if needed)
"RTN","IBRFN",24,0)
 ; Output:  X function value, string, = 0 if bill not found
"RTN","IBRFN",25,0)
 ;          = 1 (Inpt) or 2 (Outpt)^event date^stmt from date^stmt to date^LOS (I)^Number of visit dates (O)
"RTN","IBRFN",26,0)
 ;          all are internal form, any piece may be null if not defined for the bill
"RTN","IBRFN",27,0)
 ;          array containing outpatient visit dates as subscripts/no data, if VDT passed by value
"RTN","IBRFN",28,0)
 N X,Y,IFN S X=0,BN=$G(BN)
"RTN","IBRFN",29,0)
 I BN'="" S IFN=+$O(^DGCR(399,"B",BN,0)),Y=$G(^DGCR(399,IFN,0)) I Y'="" D
"RTN","IBRFN",30,0)
 . S X=$S(+$P(Y,U,5)<1:"",+$P(Y,U,5)<3:1,+$P(Y,U,5)<5:2,1:"")_U_$P(Y,U,3),Y=$G(^DGCR(399,IFN,"U"))
"RTN","IBRFN",31,0)
 . S X=X_U_$P(Y,U,1)_U_$P(Y,U,2)_U_$P(Y,U,15)_U_$P($G(^DGCR(399,IFN,"OP",0)),U,4)
"RTN","IBRFN",32,0)
 . S Y=0 F  S Y=$O(^DGCR(399,IFN,"OP",Y)) Q:'Y  S VDT(Y)=""
"RTN","IBRFN",33,0)
 Q X
"RTN","IBRFN",34,0)
 ;
"RTN","IBRFN",35,0)
 ;
"RTN","IBRFN",36,0)
REC(IBSTR,IBTYPE) ; Find the AR for an Authorization or Rx number
"RTN","IBRFN",37,0)
 ;   Input: IBSTR - FI Authorization Number or Rx Number
"RTN","IBRFN",38,0)
 ;  Output: IBAR  >0 => ptr to claim/AR in files 399/430
"RTN","IBRFN",39,0)
 ;                -1 => No receivable found
"RTN","IBRFN",40,0)
 ;          IBTYPE (by ref) - how the IBSTR was recognized: 1-Auth,2-ECME,3-Rx#,0-Unknown
"RTN","IBRFN",41,0)
 ;
"RTN","IBRFN",42,0)
 N IBAR,IBARR,IBRX,IBKEY,IBKEYS,IBREF,IBPREF
"RTN","IBRFN",43,0)
 S IBTYPE=0
"RTN","IBRFN",44,0)
 S IBAR=-1
"RTN","IBRFN",45,0)
 I $G(IBSTR)="" G RECQ
"RTN","IBRFN",46,0)
 ;
"RTN","IBRFN",47,0)
 ; extended syntax to indicate the type:
"RTN","IBRFN",48,0)
 ; T.000000 for TRICARE, E.7000000 for ECME, R.50000000 for Rx
"RTN","IBRFN",49,0)
 I $L($P(IBSTR,"."))=1,$P(IBSTR,".",2)'="" D
"RTN","IBRFN",50,0)
 . S IBPREF=$TR($P(IBSTR,"."),"ter","TER")
"RTN","IBRFN",51,0)
 . S IBSTR=$P(IBSTR,".",2,255)
"RTN","IBRFN",52,0)
 . I $E(IBPREF)="T" S IBTYPE=1 ; TRICARE Auth#
"RTN","IBRFN",53,0)
 . I $E(IBPREF)="E" S IBTYPE=2 ; ECME #
"RTN","IBRFN",54,0)
 . I $E(IBPREF)="R" S IBTYPE=3 ; Rx #
"RTN","IBRFN",55,0)
 ;
"RTN","IBRFN",56,0)
 ; look for TRICARE number
"RTN","IBRFN",57,0)
 I (IBTYPE=0)!(IBTYPE=1) S IBAR=$$AREC(IBSTR) I IBAR>0 S IBTYPE=1 G RECQ
"RTN","IBRFN",58,0)
 ;
"RTN","IBRFN",59,0)
 ; - look for ecme number
"RTN","IBRFN",60,0)
 I (IBTYPE=0)!(IBTYPE=2) S IBAR=$$EREC(IBSTR) I IBAR>0 S IBTYPE=2 G RECQ
"RTN","IBRFN",61,0)
 ;
"RTN","IBRFN",62,0)
 I IBTYPE,IBTYPE'=3 G RECQ
"RTN","IBRFN",63,0)
 ;
"RTN","IBRFN",64,0)
 ; - treat as an rx number
"RTN","IBRFN",65,0)
 S IBAR=$$RXREC(IBSTR) I IBAR>0 S IBTYPE=3
"RTN","IBRFN",66,0)
 ;
"RTN","IBRFN",67,0)
RECQ Q IBAR
"RTN","IBRFN",68,0)
 ;
"RTN","IBRFN",69,0)
RXREC(IBRXN) ; Search the Rx
"RTN","IBRFN",70,0)
 N IBR,IBX,IBARR,IBY,IBBIL,IBTRKN,IBFIL,IBRX
"RTN","IBRFN",71,0)
 I $L(IBRXN)<5,'$D(^IBA(362.4,"B",IBRXN)) Q -1
"RTN","IBRFN",72,0)
 ; Scan 362.4
"RTN","IBRFN",73,0)
 ; 1) check the exact match:
"RTN","IBRFN",74,0)
 S IBX=0 F  S IBX=$O(^IBA(362.4,"B",IBRXN,IBX)) Q:'IBX  D
"RTN","IBRFN",75,0)
 . S IBBIL=$P($G(^IBA(362.4,IBX,0)),U,2) Q:'IBBIL
"RTN","IBRFN",76,0)
 . I $P($G(^DGCR(399,IBBIL,0)),U,13)=7 Q  ; ignore cancld
"RTN","IBRFN",77,0)
 . S IBARR(IBBIL)=""
"RTN","IBRFN",78,0)
 ; 2) check Rx with postfixes like "A","B" etc
"RTN","IBRFN",79,0)
 S IBR=IBRXN_" " F  S IBR=$O(^IBA(362.4,"B",IBR)) Q:$E(IBR,1,$L(IBRXN))'=IBRXN  D
"RTN","IBRFN",80,0)
 . I $E(IBR,$L(IBRXN)+1)'?1A Q  ; only letters in postfx
"RTN","IBRFN",81,0)
 . S IBX=0 F  S IBX=$O(^IBA(362.4,"B",IBR,IBX)) Q:'IBX  D
"RTN","IBRFN",82,0)
 . . S IBBIL=$P($G(^IBA(362.4,IBX,0)),U,2) Q:'IBBIL
"RTN","IBRFN",83,0)
 . . I $P($G(^DGCR(399,IBBIL,0)),U,13)=7 Q  ; ignore cancld
"RTN","IBRFN",84,0)
 . . S IBARR(IBBIL)=""
"RTN","IBRFN",85,0)
 ; 3) Now scan CT (356):
"RTN","IBRFN",86,0)
 S IBRX=+$O(^PSRX("B",IBSTR,0))
"RTN","IBRFN",87,0)
 I IBRX S IBFIL="" F  S IBFIL=$O(^IBT(356,"ARXFL",IBRX,IBFIL)) Q:IBFIL=""  D
"RTN","IBRFN",88,0)
 . S IBTRKN="" F  S IBTRKN=$O(^IBT(356,"ARXFL",IBRX,IBFIL,IBTRKN)) Q:IBTRKN=""  D
"RTN","IBRFN",89,0)
 .. S IBBIL=$P($G(^IBT(356,IBTRKN,0)),U,11) Q:'IBBIL
"RTN","IBRFN",90,0)
 .. I $P($G(^DGCR(399,IBBIL,0)),U,13)=7 Q  ; ignore cancld
"RTN","IBRFN",91,0)
 .. S IBARR(IBBIL)=""
"RTN","IBRFN",92,0)
 ;
"RTN","IBRFN",93,0)
 S IBY=$O(IBARR("")) I IBY'>0 Q -1  ;not found
"RTN","IBRFN",94,0)
 I '$O(IBARR(IBY)) D DTL(+IBY,"Rx#",IBRXN) Q +IBY  ;one only
"RTN","IBRFN",95,0)
 W !!,"More than one fill for Rx# ",IBSTR," has been billed."
"RTN","IBRFN",96,0)
 S IBY=$$SEL(.IBARR)
"RTN","IBRFN",97,0)
 D DTL(IBY,"Rx#",IBRXN)
"RTN","IBRFN",98,0)
 Q IBY
"RTN","IBRFN",99,0)
 ;
"RTN","IBRFN",100,0)
AREC(AUTH) ; Find the Receivable for a TRICARE FI Authorization Number
"RTN","IBRFN",101,0)
 ;   Input: AUTH - Fiscal Intermediary Authorization Number
"RTN","IBRFN",102,0)
 ;  Output: IBIFN  >0 => ptr to claim/AR in files 399/430
"RTN","IBRFN",103,0)
 ;                 -1 => No receivable found
"RTN","IBRFN",104,0)
 N IBIFN
"RTN","IBRFN",105,0)
 S IBIFN=-1
"RTN","IBRFN",106,0)
 I $G(AUTH)="" G ARECQ
"RTN","IBRFN",107,0)
 S IBIFN=$P($G(^IBA(351.5,+$O(^IBA(351.5,"AUTH",AUTH,0)),0)),U,9)
"RTN","IBRFN",108,0)
 S:'IBIFN IBIFN=-1
"RTN","IBRFN",109,0)
ARECQ ;
"RTN","IBRFN",110,0)
 D DTL(IBIFN,"TRICARE#",AUTH)
"RTN","IBRFN",111,0)
 Q IBIFN
"RTN","IBRFN",112,0)
 ;
"RTN","IBRFN",113,0)
 ;
"RTN","IBRFN",114,0)
EREC(AUTH) ; Find the Receivable for an ECME FI Number
"RTN","IBRFN",115,0)
 ;   Input: AUTH  - Fiscal Intermediary ECME Number
"RTN","IBRFN",116,0)
 ;  Output: IBIFN  >0 => ptr to claim/AR in files 399/430
"RTN","IBRFN",117,0)
 ;                 -1 => No receivable found
"RTN","IBRFN",118,0)
 ;
"RTN","IBRFN",119,0)
 N IBIFN,IBC,IBX,IBA,IBE,IBES
"RTN","IBRFN",120,0)
 S IBIFN=-1,IBC=0
"RTN","IBRFN",121,0)
 I $G(AUTH)="" G ARECQ
"RTN","IBRFN",122,0)
 S (IBE,IBES)=+AUTH_";"
"RTN","IBRFN",123,0)
 F  S IBE=$O(^DGCR(399,"AG",IBE)) Q:IBE'[IBES  D
"RTN","IBRFN",124,0)
 . S IBX=0 F  S IBX=$O(^DGCR(399,"AG",IBE,IBX)) Q:'IBX  D
"RTN","IBRFN",125,0)
 .. I $P($G(^DGCR(399,IBX,0)),U,13)=7 Q  ;exclude cancld
"RTN","IBRFN",126,0)
 .. S IBA(IBX)="",IBC=IBC+1
"RTN","IBRFN",127,0)
 I IBC'>1 S IBIFN=$O(IBA(0)) G ERECQ  ; only one found
"RTN","IBRFN",128,0)
 W !!,"More than one fill for ECME# ",AUTH," has been billed."
"RTN","IBRFN",129,0)
 S IBIFN=$$SEL(.IBA)
"RTN","IBRFN",130,0)
ERECQ S:'IBIFN IBIFN=-1
"RTN","IBRFN",131,0)
 D DTL(IBIFN,"ECME#",AUTH) ;details
"RTN","IBRFN",132,0)
 Q IBIFN
"RTN","IBRFN",133,0)
 ;
"RTN","IBRFN",134,0)
DTL(IBIFN,TYPE,AUTH) ;Details
"RTN","IBRFN",135,0)
 Q:IBIFN'>0  Q:AUTH=""
"RTN","IBRFN",136,0)
 N IBZ,IBBIL,IBPAT,IBPATN,IBRX,IB3624,IBDRUG,IBQTY,IBDAT,DIR
"RTN","IBRFN",137,0)
 S IBZ=$G(^DGCR(399,IBIFN,0))
"RTN","IBRFN",138,0)
 S IBBIL=$P(IBZ,U),IBPAT=$P(IBZ,U,2),IBDAT=$P(IBZ,U,3)
"RTN","IBRFN",139,0)
 S IBPATN=$P($G(^DPT(+IBPAT,0)),U)
"RTN","IBRFN",140,0)
 S IB3624=$G(^IBA(362.4,+$O(^IBA(362.4,"C",IBIFN,"")),0))
"RTN","IBRFN",141,0)
 D ZERO^IBRXUTL(+$P(IB3624,U,4))
"RTN","IBRFN",142,0)
 S IBDRUG=$G(^TMP($J,"IBDRUG",+$P(IB3624,U,4),.01))
"RTN","IBRFN",143,0)
 K ^TMP($J,"IBDRUG")
"RTN","IBRFN",144,0)
 S IBRX=$P($G(^PSRX(+$P(IB3624,U,5),0)),U)
"RTN","IBRFN",145,0)
 S IBQTY=+$P(IB3624,U,7)
"RTN","IBRFN",146,0)
 W !!,"Found IB Bill ",IBBIL," matching to "_TYPE_" '",AUTH,"':"
"RTN","IBRFN",147,0)
 W !,"Rx#",IBRX," ",$$DAT3^IBOUTL(IBDAT),", ",IBPATN,", ",IBDRUG I IBQTY W " (",IBQTY,")"
"RTN","IBRFN",148,0)
 Q
"RTN","IBRFN",149,0)
 ;
"RTN","IBRFN",150,0)
AUD(IBIFN) ; Does the Accounts Receivable need to be audited?
"RTN","IBRFN",151,0)
 ;   Input: IBIFN  - ptr to claim/AR in files 399/430
"RTN","IBRFN",152,0)
 ;  Output: 0 => Claim does not have to be audited
"RTN","IBRFN",153,0)
 ;               (claim was set up automatically)
"RTN","IBRFN",154,0)
 ;          1 => Claim must be audited
"RTN","IBRFN",155,0)
 ;               (claim was established manually)
"RTN","IBRFN",156,0)
 ;
"RTN","IBRFN",157,0)
AUDQ Q $O(^IBA(351.5,"ACL",+$G(IBIFN),0))'>0
"RTN","IBRFN",158,0)
 ;
"RTN","IBRFN",159,0)
 ;
"RTN","IBRFN",160,0)
TYP(IBIFN) ; Determine the bill type for an Accounts Receivable.
"RTN","IBRFN",161,0)
 ;  Input:  IBIFN - ptr to claim/AR in files 399/430
"RTN","IBRFN",162,0)
 ; Output:  I => Inpatient bill
"RTN","IBRFN",163,0)
 ;          O => Outpatient bill
"RTN","IBRFN",164,0)
 ;          PH => Pharmacy bill
"RTN","IBRFN",165,0)
 ;          PR => Prosthetics bill
"RTN","IBRFN",166,0)
 ;
"RTN","IBRFN",167,0)
 ;          or -1 if the bill type can't be determined.
"RTN","IBRFN",168,0)
 ;
"RTN","IBRFN",169,0)
 N IBATYP,IBATYPN,IBBG,IBN,IBND,IBTYP,IBX
"RTN","IBRFN",170,0)
 S IBTYP=-1
"RTN","IBRFN",171,0)
 I '$G(IBIFN) G TYPQ
"RTN","IBRFN",172,0)
 ;
"RTN","IBRFN",173,0)
 ; - see if AR originated from file #399
"RTN","IBRFN",174,0)
 S IBX=$G(^DGCR(399,IBIFN,0))
"RTN","IBRFN",175,0)
 I IBX]"" D  G TYPQ
"RTN","IBRFN",176,0)
 .S IBTYP=$$BTYP^IBCOIVM1(IBIFN,IBX)
"RTN","IBRFN",177,0)
 .S IBTYP=$S(IBTYP="":-1,IBTYP="P":"PR",IBTYP="R":"PH",1:IBTYP)
"RTN","IBRFN",178,0)
 ;
"RTN","IBRFN",179,0)
 ; - get the bill number
"RTN","IBRFN",180,0)
 S IBX=$P($G(^PRCA(430,IBIFN,0)),U)
"RTN","IBRFN",181,0)
 I IBX="" G TYPQ
"RTN","IBRFN",182,0)
 ;
"RTN","IBRFN",183,0)
 ; - AR must have originated from file #350
"RTN","IBRFN",184,0)
 S IBN=$O(^IB("ABIL",IBX,0))
"RTN","IBRFN",185,0)
 I 'IBN G TYPQ
"RTN","IBRFN",186,0)
 S IBND=$G(^IB(IBN,0))
"RTN","IBRFN",187,0)
 I 'IBND G TYPQ
"RTN","IBRFN",188,0)
 S IBATYP=$G(^IBE(350.1,+$P(IBND,U,3),0)),IBBG=$P(IBATYP,U,11)
"RTN","IBRFN",189,0)
 ;
"RTN","IBRFN",190,0)
 ; - handle TRICARE charges first
"RTN","IBRFN",191,0)
 I IBBG=7 D  G TYPQ
"RTN","IBRFN",192,0)
 .S IBATYPN=$P(IBATYP,U)
"RTN","IBRFN",193,0)
 .S IBTYP=$S(IBATYPN["INPT":"I",IBATYPN["OPT":"O",1:"PH")
"RTN","IBRFN",194,0)
 ;
"RTN","IBRFN",195,0)
 S IBTYP=$S(IBBG=4:"O",IBBG=5:"PH",IBBG=8:"O",1:"I")
"RTN","IBRFN",196,0)
TYPQ Q IBTYP
"RTN","IBRFN",197,0)
 ;
"RTN","IBRFN",198,0)
RELBILL(IBIFN) ; given a Third Party Bill, find all related Third Party bills,
"RTN","IBRFN",199,0)
 ; then find all First Party bills related to any of the Third Party bills
"RTN","IBRFN",200,0)
 ; Input:  IBIFN = internal file number of a Third Party bill
"RTN","IBRFN",201,0)
 ; Output: Third Party Bills (#399)
"RTN","IBRFN",202,0)
 ;    ^TMP("IBRBT", $J, selected bill ifn) = PATIENT HAS ANY RX COVERAGE ON FROM DATE OF BILL?
"RTN","IBRFN",203,0)
 ;    ^TMP("IBRBT", $J, selected bill ifn, matching bill ifn) =
"RTN","IBRFN",204,0)
 ;                                        BILL FROM ^ BILL TO ^ CANCELLED? ^ AR BILL NUMBER ^
"RTN","IBRFN",205,0)
 ;                                        PAYER SEQUENCE ^ PAYER IS MEDICARE SUPPLEMENTAL (0/1) ^ PAYER NAME
"RTN","IBRFN",206,0)
 ; Output:  First Party Bills (#350)
"RTN","IBRFN",207,0)
 ;    ^TMP("IBRBF", $J , selected bill ifn ) = ""
"RTN","IBRFN",208,0)
 ;    ^TMP("IBRBF", $J , selected bill ifn , charge ifn) = 
"RTN","IBRFN",209,0)
 ;                                        BILL FROM ^ BILL TO ^ CANCELLED? ^ AR BILL NUMBER ^
"RTN","IBRFN",210,0)
 ;                                        TOTAL CHARGE ^ ACTION TYPE (SHORT) ^ # DAYS ON HOLD
"RTN","IBRFN",211,0)
 ;
"RTN","IBRFN",212,0)
 N IBIFN1 I '$D(^DGCR(399,+$G(IBIFN),0)) Q
"RTN","IBRFN",213,0)
 D TPTP^IBEFUR(IBIFN)
"RTN","IBRFN",214,0)
 S IBIFN1=0 F  S IBIFN1=$O(^TMP("IBRBT",$J,IBIFN,IBIFN1)) Q:'IBIFN1  D TPFP^IBEFUR(IBIFN1)
"RTN","IBRFN",215,0)
 Q
"RTN","IBRFN",216,0)
 ;
"RTN","IBRFN",217,0)
SEL(IBARR) ; Select an rx bill
"RTN","IBRFN",218,0)
 ;  Input: IBARR - Array of IBIFN
"RTN","IBRFN",219,0)
 ; Output: IBNUM - One of the bill iens, or -1
"RTN","IBRFN",220,0)
 ;
"RTN","IBRFN",221,0)
 N DIR,IBIFN,IBRXN,IBDT,IBZ,IBY,IBC,IBBIL,IBLNK,DFN,IBPT,I
"RTN","IBRFN",222,0)
 ;
"RTN","IBRFN",223,0)
 S IBIFN=$O(IBARR(""))
"RTN","IBRFN",224,0)
 I 'IBIFN Q -1
"RTN","IBRFN",225,0)
 I '$O(IBARR(IBIFN)) Q IBIFN  ; no choice
"RTN","IBRFN",226,0)
 ;
"RTN","IBRFN",227,0)
 W !!?4,"Select one of the following:",!
"RTN","IBRFN",228,0)
 W !?11,"BILL",?23,"RX",?33,"DATE",?46,"PATIENT"
"RTN","IBRFN",229,0)
 W !?6 F I=1:1:60 W "-"
"RTN","IBRFN",230,0)
 ;
"RTN","IBRFN",231,0)
 S (IBIFN,IBC)=0
"RTN","IBRFN",232,0)
 F  S IBIFN=$O(IBARR(IBIFN)) Q:'IBIFN  D
"RTN","IBRFN",233,0)
 . S IBZ=$G(^DGCR(399,IBIFN,0)) Q:IBZ=""
"RTN","IBRFN",234,0)
 . S DFN=+$P(IBZ,U,2),IBPT=$P($G(^DPT(DFN,0)),U)
"RTN","IBRFN",235,0)
 . S IBBIL=$P(IBZ,U)
"RTN","IBRFN",236,0)
 . S IBDT=$P(IBZ,U,3)
"RTN","IBRFN",237,0)
 . S IBY=$G(^IBA(362.4,+$O(^IBA(362.4,"C",IBIFN,0)),0))
"RTN","IBRFN",238,0)
 . S IBRXN=$P(IBY,U)
"RTN","IBRFN",239,0)
 . S IBC=IBC+1
"RTN","IBRFN",240,0)
 . S IBLNK(IBC)=IBIFN
"RTN","IBRFN",241,0)
 . W !?6,IBC,?10,IBBIL," ",?20,IBRXN," ",?32,$$DAT1^IBOUTL(IBDT)," ",?45,IBPT
"RTN","IBRFN",242,0)
 ;
"RTN","IBRFN",243,0)
 ;
"RTN","IBRFN",244,0)
 F  R !!?4,"Select one of the bills by number: ",IBY:DTIME  Q:'$T  Q:"^"[IBY  Q:$D(IBLNK(+IBY))  W:(IBY'="")&(IBY'["?") "  ??"  D
"RTN","IBRFN",245,0)
 . W !!?8,"Enter numeric value from 1 to ",IBC
"RTN","IBRFN",246,0)
 ;
"RTN","IBRFN",247,0)
 S IBIFN=$G(IBLNK(+IBY),-1)
"RTN","IBRFN",248,0)
 Q IBIFN
"RTN","IBTOBI")
0^36^B26516930
"RTN","IBTOBI",1,0)
IBTOBI ;ALB/AAS - CLAIMS TRACKING BILLING INFORMATION PRINT ;27-OCT-93
"RTN","IBTOBI",2,0)
 ;;2.0;INTEGRATED BILLING;**91,160,199,309,276**;21-MAR-94
"RTN","IBTOBI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTOBI",4,0)
 ;
"RTN","IBTOBI",5,0)
% I '$D(DT) D DT^DICRW
"RTN","IBTOBI",6,0)
 W !!,"Bill Preparation Report for a Single Visit"
"RTN","IBTOBI",7,0)
 D END
"RTN","IBTOBI",8,0)
 ;
"RTN","IBTOBI",9,0)
PAT ; -- Select patient
"RTN","IBTOBI",10,0)
 W !!
"RTN","IBTOBI",11,0)
 S DIC="^DPT(",DIC(0)="AEQM"
"RTN","IBTOBI",12,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBTOBI",13,0)
 D ^DIC K DIC I +Y<1 G END
"RTN","IBTOBI",14,0)
 S DFN=+Y
"RTN","IBTOBI",15,0)
 ;
"RTN","IBTOBI",16,0)
VSIT ;
"RTN","IBTOBI",17,0)
 ; -- get claims tracking visit entry
"RTN","IBTOBI",18,0)
 D TRAC^IBTRV K IBY
"RTN","IBTOBI",19,0)
 I '$G(IBTRN) G END
"RTN","IBTOBI",20,0)
 ;
"RTN","IBTOBI",21,0)
DEV ; -- select device, run option
"RTN","IBTOBI",22,0)
 W !
"RTN","IBTOBI",23,0)
 S %ZIS="QM" D ^%ZIS G:POP END
"RTN","IBTOBI",24,0)
 I $D(IO("Q")) S ZTRTN="DQ^IBTOBI",ZTSAVE("IB*")="",ZTSAVE("DFN")="",ZTDESC="IB - Bill Preparation Report" D ^%ZTLOAD K IO("Q"),ZTSK D HOME^%ZIS G PAT
"RTN","IBTOBI",25,0)
 ;
"RTN","IBTOBI",26,0)
 U IO
"RTN","IBTOBI",27,0)
 D ONE,END G PAT
"RTN","IBTOBI",28,0)
 Q
"RTN","IBTOBI",29,0)
DQ ; -- task man entry point
"RTN","IBTOBI",30,0)
 D ONE
"RTN","IBTOBI",31,0)
 ;
"RTN","IBTOBI",32,0)
END ; -- Clean up
"RTN","IBTOBI",33,0)
 W !
"RTN","IBTOBI",34,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBTOBI",35,0)
 D ^%ZISC
"RTN","IBTOBI",36,0)
 K I,J,X,Y,DFN,%ZIS,VA,IBTRN,IBTRND,IBTRND1,IBPAG,IBHDT,IBDISDT,IBETYP,IBQUIT,IBTAG,DIRUT,DUOUT,IBCNT,IBI,IBJ,IBNAR,IBTNOD,IBTRCD1,IBTRTP,IBDA
"RTN","IBTOBI",37,0)
 D KVAR^VADPT
"RTN","IBTOBI",38,0)
 Q
"RTN","IBTOBI",39,0)
ONE ; -- print one billing report from ct
"RTN","IBTOBI",40,0)
 S IBPAG=0,IBHDT=$$HTE^XLFDT($H,1),IBQUIT=0
"RTN","IBTOBI",41,0)
 D PID^VADPT
"RTN","IBTOBI",42,0)
 S IBTRND=$G(^IBT(356,+IBTRN,0)),IBTRND1=$G(^(1))
"RTN","IBTOBI",43,0)
 S IBETYP=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBTOBI",44,0)
 D HDR,SECT1,^IBTOBI1
"RTN","IBTOBI",45,0)
 Q
"RTN","IBTOBI",46,0)
 ;
"RTN","IBTOBI",47,0)
HDR ; -- Print header for billing report
"RTN","IBTOBI",48,0)
 Q:IBQUIT
"RTN","IBTOBI",49,0)
 I '$D(VA("PID")) N I,J D PID^VADPT
"RTN","IBTOBI",50,0)
 I $E(IOST,1,2)="C-",IBPAG D PAUSE^VALM1 I $D(DIRUT) S IBQUIT=1 Q
"RTN","IBTOBI",51,0)
 I $E(IOST,1,2)="C-"!(IBPAG) W @IOF
"RTN","IBTOBI",52,0)
 S IBPAG=IBPAG+1
"RTN","IBTOBI",53,0)
 W !,$S($D(IBCTHDR):IBCTHDR,1:"Bill Preparation Report"),?(IOM-33),"Page ",IBPAG,"  ",IBHDT
"RTN","IBTOBI",54,0)
 W !!,$E($P($G(^DPT(DFN,0)),"^"),1,25),?28,VA("PID"),?50,"DOB: ",$$FMTE^XLFDT($P($G(^DPT(DFN,0)),"^",3),1)
"RTN","IBTOBI",55,0)
 W !,$$EXPAND^IBTRE(356,.18,$P(IBTRND,"^",18))," on ",$$FMTE^XLFDT($P(IBTRND,"^",6),1)
"RTN","IBTOBI",56,0)
 W !,$TR($J(" ",IOM)," ","-")
"RTN","IBTOBI",57,0)
 Q
"RTN","IBTOBI",58,0)
 ;
"RTN","IBTOBI",59,0)
SECT1 ; -- Section 1 - Visit info Region / misc billing info
"RTN","IBTOBI",60,0)
 N IBD
"RTN","IBTOBI",61,0)
 W !," Visit Information "
"RTN","IBTOBI",62,0)
 S IBD(1,1)="    Visit Type: "_$P(IBETYP,"^")
"RTN","IBTOBI",63,0)
 S X=$P(IBETYP,"^",3) I 'X W !,"No Visit Selected" Q
"RTN","IBTOBI",64,0)
 D @X
"RTN","IBTOBI",65,0)
 D MBI
"RTN","IBTOBI",66,0)
 S I=0 F  S I=$O(IBD(I)) Q:'I  W !,$G(IBD(I,1)),?44,$E($G(IBD(I,2)),1,36)
"RTN","IBTOBI",67,0)
 W !?4,$TR($J(" ",IOM-8)," ","-"),!
"RTN","IBTOBI",68,0)
 Q
"RTN","IBTOBI",69,0)
1 ; -- visit region for admission or scheduled admission
"RTN","IBTOBI",70,0)
 S IBDISDT=""
"RTN","IBTOBI",71,0)
 I $P($G(^DGPM(+$P(IBTRND,"^",5),0)),"^",17) S VAINDT=+$G(^DGPM(+$P(IBTRND,"^",5),0)),IBDISDT=+$G(^DGPM(+$P($G(^DGPM(+$P(IBTRND,"^",5),0)),"^",17),0))
"RTN","IBTOBI",72,0)
 I '$D(VAIN) S VA200="" D INP^VADPT
"RTN","IBTOBI",73,0)
 I VAIN(7)="" S Y=$P(IBTRND,"^",6) D D^DIQ S $P(VAIN(7),"^",2)=Y
"RTN","IBTOBI",74,0)
 S IBD(2,1)="Admission Date: "_$P(VAIN(7),"^",2)
"RTN","IBTOBI",75,0)
 S IBD(3,1)="          Ward: "_$P(VAIN(4),"^",2)
"RTN","IBTOBI",76,0)
 S IBD(4,1)="     Specialty: "_$P(VAIN(3),"^",2)
"RTN","IBTOBI",77,0)
 S IBD(5,1)="Discharge Date: "_$$FMTE^XLFDT(IBDISDT,1)
"RTN","IBTOBI",78,0)
 Q
"RTN","IBTOBI",79,0)
2 ; -- visit region for  outpatient care
"RTN","IBTOBI",80,0)
 N IBOE,IBOE0
"RTN","IBTOBI",81,0)
 S IBOE=$P(IBTRND,"^",4),IBOE0=$$SCE^IBSDU(+IBOE)
"RTN","IBTOBI",82,0)
 S IBD(2,1)="    Visit Date: "_$$DAT1^IBOUTL($P(IBTRND,"^",6),"2P")
"RTN","IBTOBI",83,0)
 I +IBOE<1 S IBD(3,1)="  No Outpatient Encounter Found" Q
"RTN","IBTOBI",84,0)
 S IBD(3,1)="        Clinic: "_$P($G(^SC(+$P(IBOE0,U,4),0)),"^")
"RTN","IBTOBI",85,0)
 S IBD(4,1)="  Appt. Status: "_$$EXPAND^IBTRE(409.68,.12,$P(IBOE0,U,12))
"RTN","IBTOBI",86,0)
 S IBD(5,1)="    Appt. Type: "_$$EXPAND^IBTRE(409.68,.1,$P(IBOE0,U,10))
"RTN","IBTOBI",87,0)
 S IBD(6,1)="  Special Cond: "_$$ENCL^IBTRED(IBOE)
"RTN","IBTOBI",88,0)
 Q
"RTN","IBTOBI",89,0)
 ;
"RTN","IBTOBI",90,0)
3 ; -- visit region for rx refill
"RTN","IBTOBI",91,0)
 N PSONTALK,PSOTMP,PSORXN,PSOFILL
"RTN","IBTOBI",92,0)
 S PSONTALK=1 ;PSORXN=+$P(IBTRND,"^",8),PSOFILL=+$P(IBTRND,"^",10)
"RTN","IBTOBI",93,0)
 S X=+$P(IBTRND,"^",8)_"^"_+$P(IBTRND,"^",10) D EN^PSOCPVW
"RTN","IBTOBI",94,0)
 ;if refill was deleted and EN^PSOCPVW doesn't return any data use IB API
"RTN","IBTOBI",95,0)
 I '$D(PSOTMP) D PSOCPVW^IBNCPDPC(+$P(IBTRND,"^",2),+$P(IBTRND,"^",8),.PSOTMP)
"RTN","IBTOBI",96,0)
 S IBD(2,1)="Prescription #: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),.01,"E"))
"RTN","IBTOBI",97,0)
 I $P(IBTRND,"^",10)=0 S IBD(3,1)="     Fill Date: "_$$FMTE^XLFDT(+$P(IBTRND,"^",6))
"RTN","IBTOBI",98,0)
 I +$P(IBTRND,"^",10) S IBD(3,1)="   Refill Date: "_$$FMTE^XLFDT(+$P(IBTRND,"^",6))
"RTN","IBTOBI",99,0)
 S IBD(4,1)="          Drug: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),6,"E"))
"RTN","IBTOBI",100,0)
 S IBD(5,1)="      Quantity: "_$J($G(PSOTMP(52,+$P(IBTRND,"^",8),7,"E")),8)
"RTN","IBTOBI",101,0)
 S IBD(6,1)="   Days Supply: "_$J($G(PSOTMP(52,+$P(IBTRND,"^",8),8,"E")),8)
"RTN","IBTOBI",102,0)
 S IBD(7,1)="          NDC#: "_$$GETNDC^PSONDCUT(+$P(IBTRND,"^",8),$P(IBTRND,"^",10))
"RTN","IBTOBI",103,0)
 S IBD(8,1)="     Physician: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),4,"E"))
"RTN","IBTOBI",104,0)
 Q
"RTN","IBTOBI",105,0)
 ;
"RTN","IBTOBI",106,0)
4 ; -- Visit region for prosthetics
"RTN","IBTOBI",107,0)
 D 4^IBTOBI4
"RTN","IBTOBI",108,0)
 Q
"RTN","IBTOBI",109,0)
 ;
"RTN","IBTOBI",110,0)
MBI ; -- Misc. billing info
"RTN","IBTOBI",111,0)
 S IBD(1,2)=" Visit Billable: "_$S('$P(IBTRND,"^",19):"YES",1:"NO-"_$$EXPAND^IBTRE(356,.19,$P(IBTRND,"^",19)))
"RTN","IBTOBI",112,0)
 S IBD(2,2)=" Second Opinion: "_$S('$P(IBTRND,"^",14):"NOT REQUIRED",1:$S('$P(IBTRND,"^",15):"REQUIRED-NOT OBTAINED",1:"OBTAINED"))
"RTN","IBTOBI",113,0)
 S IBD(3,2)=" Auto Bill Date: "_$$FMTE^XLFDT($P(IBTRND,"^",17),1)
"RTN","IBTOBI",114,0)
 S IBD(4,2)="Special Consent: ROI "_$S('$P(IBTRND,"^",31):"NOT DETERMINED",1:$$EXPAND^IBTRE(356,.31,$P(IBTRND,"^",31)))
"RTN","IBTOBI",115,0)
 S IBD(5,2)="Special Billing: "_$$EXPAND^IBTRE(356,.12,$P(IBTRND,"^",12))
"RTN","IBTOBI",116,0)
 Q
"RTN","IBTOBI",117,0)
 ;
"RTN","IBTOBI1")
0^37^B18274759
"RTN","IBTOBI1",1,0)
IBTOBI1 ;ALB/AAS - CLAIMS TRACKING BILLING INFORMATION PRINT ;27-OCT-93
"RTN","IBTOBI1",2,0)
 ;;2.0;INTEGRATED BILLING;**276**;21-MAR-94
"RTN","IBTOBI1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTOBI1",4,0)
 ;
"RTN","IBTOBI1",5,0)
% ;
"RTN","IBTOBI1",6,0)
 F IBTAG="INS","BI","SC","CLIN^IBTOBI4","IR^IBTOBI2","HR^IBTOBI3" D @IBTAG Q:IBQUIT
"RTN","IBTOBI1",7,0)
 Q
"RTN","IBTOBI1",8,0)
 ;
"RTN","IBTOBI1",9,0)
INS ; -- print ins. stuff
"RTN","IBTOBI1",10,0)
 N TAB,TAB2,IBALLIN,IBDT,IBINS,IBCNT,I,X,IBI,PHON,PHON2,PHON3,P,IBI
"RTN","IBTOBI1",11,0)
 S TAB=5,TAB2=45,IBALLIN=1
"RTN","IBTOBI1",12,0)
 S IBDT=$P(IBTRND,"^",6)
"RTN","IBTOBI1",13,0)
 I '$G(IBDT) S IBDT=DT
"RTN","IBTOBI1",14,0)
 W !,"  Insurance Information "
"RTN","IBTOBI1",15,0)
 ;
"RTN","IBTOBI1",16,0)
 D ALL^IBCNS1(DFN,"IBINS",1,IBDT)
"RTN","IBTOBI1",17,0)
 I $G(IBINS(0))<1 W !,?TAB,"No Insurance Information",!!! G INSQ
"RTN","IBTOBI1",18,0)
 S IBI=0,IBCNT=0 F  S IBI=$O(IBINS(IBI)) Q:'IBI!(IBQUIT)  S IBINS=IBINS(IBI,0) D  Q:IBQUIT
"RTN","IBTOBI1",19,0)
 .S IBCNT=IBCNT+1
"RTN","IBTOBI1",20,0)
 .I ($Y+8)>IOSL D HDR^IBTOBI Q:IBQUIT
"RTN","IBTOBI1",21,0)
 .I IBCNT>1 W !
"RTN","IBTOBI1",22,0)
 .W !?TAB,"     Ins. Co "_IBCNT_": ",$E($P($G(^DIC(36,+IBINS,0)),"^"),1,23)
"RTN","IBTOBI1",23,0)
 .S X=$G(^DIC(36,+IBINS,.13))
"RTN","IBTOBI1",24,0)
 .S PHON=$S($P(X,"^",3)'="":$P(X,"^",3),1:$P(X,"^"))
"RTN","IBTOBI1",25,0)
 .S PHON2=$S($P(X,"^",2)'="":$P(X,"^",2),1:$P(X,"^"))
"RTN","IBTOBI1",26,0)
 .S P=$S($P(IBETYP,"^",3)=1:5,$P(IBETYP,"^",3)=2:6,$P(IBETYP,"^",3)=3:11,1:1)
"RTN","IBTOBI1",27,0)
 .S PHON3=$S($P(X,"^",P)'="":$P(X,"^",P),1:$P(X,"^"))
"RTN","IBTOBI1",28,0)
 .W ?TAB2,"Pre-Cert Phone: ",PHON
"RTN","IBTOBI1",29,0)
 .W !?TAB,"        Subsc.: ",$P(IBINS,"^",17)
"RTN","IBTOBI1",30,0)
 .W ?TAB2,"          Type: ",$E($P($G(^IBE(355.1,+$P($G(^IBA(355.3,+$P(IBINS,"^",18),0)),"^",9),0)),"^"),1,18)
"RTN","IBTOBI1",31,0)
 .W !?TAB,"     Subsc. ID: ",$P(IBINS,"^",2)
"RTN","IBTOBI1",32,0)
 .W ?TAB2,"         Group: ",$$GRP^IBCNS($P(IBINS,"^",18))
"RTN","IBTOBI1",33,0)
 .W !?TAB,"     Coord Ben: ",$E($$EXPAND^IBTRE(2.312,.2,$P(IBINS,"^",20)),1,18)
"RTN","IBTOBI1",34,0)
 .W ?TAB2," Billing Phone: ",PHON2
"RTN","IBTOBI1",35,0)
 .W !,?TAB,"Filing Time Fr: ",$$EXPAND^IBTRE(36,.12,$P($G(^DIC(36,+IBINS,0)),"^",12))
"RTN","IBTOBI1",36,0)
 .W ?TAB2,"  Claims Phone: ",PHON3
"RTN","IBTOBI1",37,0)
 .S X=$P($G(IBINS(IBI,1)),"^",8) I X'="" W !,"     Policy Comment: " W:($L(X)+23)>IOM ! W " ",X
"RTN","IBTOBI1",38,0)
 .D COMM(+$P(IBINS,"^",18))
"RTN","IBTOBI1",39,0)
 .Q:IBQUIT
"RTN","IBTOBI1",40,0)
 .W !?30,"-----------------------------------"
"RTN","IBTOBI1",41,0)
 W:'IBQUIT !?4,$TR($J(" ",IOM-8)," ","-"),!
"RTN","IBTOBI1",42,0)
INSQ Q
"RTN","IBTOBI1",43,0)
 ;
"RTN","IBTOBI1",44,0)
BI ; -- print billing information
"RTN","IBTOBI1",45,0)
 Q:$D(IBCTHDR)
"RTN","IBTOBI1",46,0)
 I ($Y+8)>IOSL D HDR^IBTOBI Q:IBQUIT
"RTN","IBTOBI1",47,0)
BI1 W !,"  Billing Information "
"RTN","IBTOBI1",48,0)
 N IBDGCR,IBDGCRU1,IBDGCRU,IBAMNT,IBD,I,IBIFN,IBADD,IBECME
"RTN","IBTOBI1",49,0)
 S IBIFN=+$P(IBTRND,"^",11)
"RTN","IBTOBI1",50,0)
 S IBDGCR=$G(^DGCR(399,IBIFN,0)),IBDGCRU1=$G(^("U1")),IBDGCRU=$G(^("U"))
"RTN","IBTOBI1",51,0)
 S IBECME=$P($P($G(^DGCR(399,IBIFN,"M1")),U,8),";")
"RTN","IBTOBI1",52,0)
 S IBAMNT=$$BILLD^IBTRED1(IBTRN)
"RTN","IBTOBI1",53,0)
 S IBADD=0
"RTN","IBTOBI1",54,0)
 S IBD(1,1)="  Initial Bill: "_$P(IBDGCR,"^")
"RTN","IBTOBI1",55,0)
 I IBECME D
"RTN","IBTOBI1",56,0)
 . S IBADD=1
"RTN","IBTOBI1",57,0)
 . S IBD(1,1)=IBD(1,1)_"e"
"RTN","IBTOBI1",58,0)
 . S IBD(2,1)="   ECME Number: "_IBECME
"RTN","IBTOBI1",59,0)
 S IBD(2+IBADD,1)="   Bill Status: "_$E($$EXPAND^IBTRE(399,.13,$P(IBDGCR,"^",13)),1,14)
"RTN","IBTOBI1",60,0)
 S IBD(3+IBADD,1)=" Total Charges: $ "_$J($P(IBAMNT,"^"),8)
"RTN","IBTOBI1",61,0)
 S IBD(4+IBADD,1)="   Amount Paid: $ "_$J($P(IBAMNT,"^",2),8)
"RTN","IBTOBI1",62,0)
 ;
"RTN","IBTOBI1",63,0)
 I $P(IBTRND,"^",19) S IBD(5,1)="Reason Not Billable: "_$$EXPAND^IBTRE(356,.19,$P(IBTRND,"^",19)),IBD(6,1)="Additional Comment: "_$P(IBTRND1,"^",8)
"RTN","IBTOBI1",64,0)
 ;
"RTN","IBTOBI1",65,0)
 S IBD(1,2)="Estimated Recv (Pri): $ "_$J($P(IBTRND,"^",21),8)
"RTN","IBTOBI1",66,0)
 S IBD(2,2)="Estimated Recv (Sec): $ "_$J($P(IBTRND,"^",22),8)
"RTN","IBTOBI1",67,0)
 S IBD(3,2)="Estimated Recv (ter): $ "_$J($P(IBTRND,"^",23),8)
"RTN","IBTOBI1",68,0)
 S IBD(4,2)="  Means Test Charges: $ "_$J($P(IBTRND,"^",28),8)
"RTN","IBTOBI1",69,0)
 I $L($P($G(^IBT(356,IBTRN,1)),U,8))>0 S IBD(5,1)="Additional Comment: "_$P($G(^IBT(356,IBTRN,1)),U,8)
"RTN","IBTOBI1",70,0)
 S I=0 F  S I=$O(IBD(I)) Q:'I  W !,$G(IBD(I,1)),?39,$E($G(IBD(I,2)),1,36)
"RTN","IBTOBI1",71,0)
 W:'IBQUIT !,?4,$TR($J(" ",IOM-8)," ","-")
"RTN","IBTOBI1",72,0)
 Q
"RTN","IBTOBI1",73,0)
 ;
"RTN","IBTOBI1",74,0)
SC ; -- print SC information
"RTN","IBTOBI1",75,0)
 I ($Y+7)>IOSL D HDR^IBTOBI Q:IBQUIT
"RTN","IBTOBI1",76,0)
 N VAEL,TAB,IBTRCSC
"RTN","IBTOBI1",77,0)
 D ELIG^VADPT
"RTN","IBTOBI1",78,0)
 W !!,"  Eligibility Information"
"RTN","IBTOBI1",79,0)
 W !,"       Primary Eligibility: "_$P(VAEL(1),"^",2)
"RTN","IBTOBI1",80,0)
 W !,"         Means Test Status: "_$P(VAEL(9),"^",2)
"RTN","IBTOBI1",81,0)
 W !," Service Connected Percent: "_$S(+VAEL(3):+$P(VAEL(3),"^",2)_"%",1:"")
"RTN","IBTOBI1",82,0)
 I 'VAEL(3) W "Patient Not Service Connected",!! G SCQ
"RTN","IBTOBI1",83,0)
 S TAB=5,IBTRCSC=1 D SC^IBTOAT2
"RTN","IBTOBI1",84,0)
SCQ W:'IBQUIT !?4,$TR($J(" ",IOM-8)," ","-"),!
"RTN","IBTOBI1",85,0)
 Q
"RTN","IBTOBI1",86,0)
 ;
"RTN","IBTOBI1",87,0)
COMM(DA) ; -- print comments from GROUP plans.
"RTN","IBTOBI1",88,0)
 Q:IBQUIT
"RTN","IBTOBI1",89,0)
 W !,"Group Plan Comments: "
"RTN","IBTOBI1",90,0)
 Q:'$D(^IBA(355.3,DA,11))
"RTN","IBTOBI1",91,0)
 K ^UTILITY($J,"W")
"RTN","IBTOBI1",92,0)
 S DIWL=10,DIWR=IOM-12,DIWF="W"
"RTN","IBTOBI1",93,0)
 S IBJ=0 F  S IBJ=$O(^IBA(355.3,DA,11,IBJ)) Q:'IBJ  S X=^(IBJ,0) D ^DIWP I IOSL<($Y+3) Q:IBQUIT  D HDR^IBTOBI
"RTN","IBTOBI1",94,0)
 Q:IBQUIT
"RTN","IBTOBI1",95,0)
 D ^DIWW
"RTN","IBTOBI1",96,0)
 K ^UTILITY($J,"W")
"RTN","IBTOBI1",97,0)
 Q
"RTN","IBTRE")
0^16^B25125140
"RTN","IBTRE",1,0)
IBTRE ;ALB/AAS - CLAIMS TRACKING EDITOR ;27-JUN-1993
"RTN","IBTRE",2,0)
 ;;2.0;INTEGRATED BILLING;**122,51,276**;21-MAR-94
"RTN","IBTRE",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRE",4,0)
 ;
"RTN","IBTRE",5,0)
% ; -- main entry point for IBT CLAIMS TRACKING EDIT
"RTN","IBTRE",6,0)
EN ;
"RTN","IBTRE",7,0)
 I '$D(DT) D DT^DICRW
"RTN","IBTRE",8,0)
 K XQORS,VALMEVL,DFN,IBTRN,IBTRV,IBTRC,IBTRD,IBCNS,IBCDFN,IBFASTXT,VA,VAERR,VA200,IBCNT,IBI,IBTBDT,IBTEDT,IBUR,VAIN,VAEL
"RTN","IBTRE",9,0)
 D EN^VALM("IBT CLAIMS TRACKING EDITOR")
"RTN","IBTRE",10,0)
ENQ K IBFASTXT,IBSCP,IBOTB,XQORS,VALMEVL,DFN,IBTRN,IBTRV,IBTRC,IBTRD,IBCNS,IBCDFN,VA,VAERR,VA200,IBCNT,IBI,IBTBDT,IBTEDT,IBUR,IBTRPRF,VAEL,VAIN,PRECERT,IBAMNT,IBDGCR,IBDGCRU1,IBETYP,IBETYPD,IBLCNT,IBTEXT,IBTRND,X,Y,Z,IBTMPNM
"RTN","IBTRE",11,0)
 K IBAPEAL,IBCDFN,IBCNT,IBDEN,IBDENIAL,IBDENIAL,IBPARNT,IBPEN,IBPENAL,IBTCOD,IBTRDD,IBTRSV,IBTYPE,VAINDT,VA,VALMBCK,OFFSET,I1,I3,IBNEW,IBDENT,IBOE,Z1,T,SDCNT
"RTN","IBTRE",12,0)
 Q
"RTN","IBTRE",13,0)
 ;
"RTN","IBTRE",14,0)
HDR ; -- header code
"RTN","IBTRE",15,0)
 D PID^VADPT
"RTN","IBTRE",16,0)
 S VALMHDR(1)="Claims Tracking Entries for: "_$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")
"RTN","IBTRE",17,0)
 S VALMHDR(2)="    for Visits beginning on: "_$$DAT1^IBOUTL(IBTBDT)_" to "_$$DAT1^IBOUTL(IBTEDT)
"RTN","IBTRE",18,0)
 Q
"RTN","IBTRE",19,0)
 ;
"RTN","IBTRE",20,0)
INIT ; -- init variables and list array
"RTN","IBTRE",21,0)
 S U="^",VALMCNT=0,VALMBG=1
"RTN","IBTRE",22,0)
 K ^TMP("IBTRE",$J),^TMP("IBTREDX",$J)
"RTN","IBTRE",23,0)
 K I,X,XQORNOD,DA,DR,DIE,DNM,DQ,IBTEDT,IBTBDT
"RTN","IBTRE",24,0)
 D PAT^IBCNSM I $D(VALMQUIT) G INITQ
"RTN","IBTRE",25,0)
 S IBTBDT=$$FMADD^XLFDT(DT,-365) ; default start date 1 year in past
"RTN","IBTRE",26,0)
 S IBTEDT=$$FMADD^XLFDT(DT,14) ;default end date is 7 days in future.
"RTN","IBTRE",27,0)
 D BLD
"RTN","IBTRE",28,0)
INITQ Q
"RTN","IBTRE",29,0)
 ;
"RTN","IBTRE",30,0)
BLD ; -- Build list of tracking entries
"RTN","IBTRE",31,0)
 K ^TMP("IBTRE",$J),^TMP("IBTREDX",$J)
"RTN","IBTRE",32,0)
 N IBII,J,IBTRN,IBTRND,IBTRND1,VAIN,IBCUR,IBSAV,IBSCP
"RTN","IBTRE",33,0)
 S IBCNT=0,VALMCNT=0
"RTN","IBTRE",34,0)
 I '$G(IBTRPRF) S IBTRPRF=123
"RTN","IBTRE",35,0)
 I IBTRPRF<10 S X=$S(IBTRPRF=1:"IBTRE  HR MENU",IBTRPRF=2:"IBTRE  IR MENU",IBTRPRF=3:"IBTRE  BI MENU",1:"IBTRE  MENU") D PROT^IBTRPR(X)
"RTN","IBTRE",36,0)
 S VALMSG=$$MSG^IBTUTL3(DFN)
"RTN","IBTRE",37,0)
 K VAINDT S VA200="" D INP^VADPT I VAIN(1) D
"RTN","IBTRE",38,0)
 .S IBTRN=$O(^IBT(356,"AD",+VAIN(1),0)),IBCUR="*"
"RTN","IBTRE",39,0)
 .D:IBTRN 1
"RTN","IBTRE",40,0)
 .S IBSAV=IBTRN
"RTN","IBTRE",41,0)
 .S VALMSG=$G(VALMSG)_"    *=Current Admission "
"RTN","IBTRE",42,0)
 .K VAIN,VA200,VAINDT
"RTN","IBTRE",43,0)
 .Q
"RTN","IBTRE",44,0)
 ;
"RTN","IBTRE",45,0)
 S IBCUR="",IBI=-(IBTEDT+.24)
"RTN","IBTRE",46,0)
 F  S IBI=$O(^IBT(356,"APTDT",DFN,IBI)) Q:IBI=""!(IBI>(-IBTBDT+.0001))  S IBTRN=0 F  S IBTRN=$O(^IBT(356,"APTDT",DFN,IBI,IBTRN)) Q:'IBTRN  D 1
"RTN","IBTRE",47,0)
BLDQ Q
"RTN","IBTRE",48,0)
 ;
"RTN","IBTRE",49,0)
1 ; -- build the entry
"RTN","IBTRE",50,0)
 Q:$G(IBSAV)=IBTRN
"RTN","IBTRE",51,0)
 W "."
"RTN","IBTRE",52,0)
 S IBTRND=$G(^IBT(356,IBTRN,0)),IBTRND1=$G(^(1)) ; tracking data
"RTN","IBTRE",53,0)
 Q:+$P(IBTRND,"^",20)<1  ; quit if inactive
"RTN","IBTRE",54,0)
 S IBCNT=IBCNT+1
"RTN","IBTRE",55,0)
 S X=""
"RTN","IBTRE",56,0)
 S X=$$SETFLD^VALM1(IBCNT,X,"NUMBER")
"RTN","IBTRE",57,0)
 S X=$$SETFLD^VALM1(IBCUR_$P($G(^IBE(356.6,+$P(IBTRND,"^",18),0)),"^",2),X,"TYPE")
"RTN","IBTRE",58,0)
 S X=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IBTRND,"^",6),2),X,"DATE")
"RTN","IBTRE",59,0)
 S X=$$SETFLD^VALM1($$EXPAND(356,.24,$P(IBTRND,"^",24)),X,"INSUR")
"RTN","IBTRE",60,0)
 S IBUR="" S:$P(IBTRND,"^",25) IBUR="R" S:$P(IBTRND,"^",26) IBUR=IBUR_"S" S:$P(IBTRND,"^",27) IBUR=IBUR_"L"
"RTN","IBTRE",61,0)
 S X=$$SETFLD^VALM1(IBUR,X,"UR")
"RTN","IBTRE",62,0)
 S X=$$SETFLD^VALM1($S(+$P(IBTRND,"^",19):"NO",1:"YES"_$$ECME(+$P(IBTRND,"^",11),1)),X,"BILLABLE")
"RTN","IBTRE",63,0)
 S X=$$SETFLD^VALM1($$EXPAND(356,.31,$P(IBTRND,"^",31)),X,"ROI")
"RTN","IBTRE",64,0)
 S X=$$SETFLD^VALM1($$ADMDIAG^IBTRE6(IBTRN),X,"DIAGNOSIS")
"RTN","IBTRE",65,0)
 S X=$$SETFLD^VALM1($S($P(IBTRND,"^",7)=3:"YES",1:"NO"),X,"URGENT")
"RTN","IBTRE",66,0)
 S X=$$SETFLD^VALM1($$DAY(IBTRN),X,"DAYS")
"RTN","IBTRE",67,0)
 S X=$$SETFLD^VALM1($P($G(^DGCR(399,+$P(IBTRND,"^",11),0)),U),X,"INITIAL")
"RTN","IBTRE",68,0)
 S X=$$SETFLD^VALM1($$PRECRT^IBTRC1(IBTRN),X,"PRECERT")
"RTN","IBTRE",69,0)
 S X=$$SETFLD^VALM1($E($$EXPAND(356,.12,$P(IBTRND,"^",12)),1,14),X,"SPECIAL")
"RTN","IBTRE",70,0)
 I $G(VAIN(4)) S X=$$SETFLD^VALM1($P(VAIN(4),"^",2),X,"WARD")
"RTN","IBTRE",71,0)
 D SET(X)
"RTN","IBTRE",72,0)
BQ Q
"RTN","IBTRE",73,0)
 ;
"RTN","IBTRE",74,0)
HELP ; -- help code
"RTN","IBTRE",75,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBTRE",76,0)
 Q
"RTN","IBTRE",77,0)
 ;
"RTN","IBTRE",78,0)
EXIT ; -- exit code
"RTN","IBTRE",79,0)
 K ^TMP("IBTRE",$J),^TMP("IBTREDX",$J)
"RTN","IBTRE",80,0)
 K DFN
"RTN","IBTRE",81,0)
 D FULL^VALM1,CLEAN^VALM10
"RTN","IBTRE",82,0)
 Q
"RTN","IBTRE",83,0)
 ;
"RTN","IBTRE",84,0)
SET(X) ; -- set arrays
"RTN","IBTRE",85,0)
 S VALMCNT=VALMCNT+1
"RTN","IBTRE",86,0)
 S ^TMP("IBTRE",$J,VALMCNT,0)=X
"RTN","IBTRE",87,0)
 S ^TMP("IBTRE",$J,"IDX",VALMCNT,IBCNT)=""
"RTN","IBTRE",88,0)
 S ^TMP("IBTREDX",$J,IBCNT)=VALMCNT_"^"_IBTRN
"RTN","IBTRE",89,0)
 Q
"RTN","IBTRE",90,0)
 ;
"RTN","IBTRE",91,0)
EXPAND(FILE,FIELD,VALUE) ; -- return special conditions
"RTN","IBTRE",92,0)
 N Y
"RTN","IBTRE",93,0)
 S Y=VALUE
"RTN","IBTRE",94,0)
 I 'FILE!('FIELD)!(VALUE="") G EXPQ
"RTN","IBTRE",95,0)
 S Y=$$EXTERNAL^DILFD(FILE,FIELD,,VALUE)
"RTN","IBTRE",96,0)
 K ^TMP("DIERR",$J)
"RTN","IBTRE",97,0)
EXPQ Q Y
"RTN","IBTRE",98,0)
 ;
"RTN","IBTRE",99,0)
DAY(X) ; -- compute number of days approved for tracking id
"RTN","IBTRE",100,0)
 N IBI,IBTRC,IBTRCD,IBDAY,IBCDT,IBMAX
"RTN","IBTRE",101,0)
 ;
"RTN","IBTRE",102,0)
 S (IBI,IBDAY)=0 F  S IBI=$O(^IBT(356.2,"C",IBTRN,IBI)) Q:'IBI  D  Q:IBDAY="ALL"
"RTN","IBTRE",103,0)
 .S IBTRCD=$G(^IBT(356.2,+IBI,0))
"RTN","IBTRE",104,0)
 .I $P(IBTRCD,"^",19)'=10 Q  ;review status must be complete
"RTN","IBTRE",105,0)
 .I $P($G(^IBE(356.7,+$P(IBTRCD,"^",11),0)),"^",3)'=10 Q  ;must be an approval
"RTN","IBTRE",106,0)
 .I $P($G(^IBT(356.2,+IBI,1)),"^",8) S IBDAY="ALL" Q
"RTN","IBTRE",107,0)
 .S IBDAY=IBDAY+$$DAY^IBTUTL3($P(IBTRCD,"^",12),$P(IBTRCD,"^",13),IBTRN)
"RTN","IBTRE",108,0)
 I $P(^IBT(356,IBTRN,0),"^",5)  S IBCDT=$$CDT^IBTODD1(IBTRN) I +IBCDT,$P(IBCDT,"^",2) S IBMAX=$$FMDIFF^XLFDT($P(IBCDT,"^",2),+IBCDT)
"RTN","IBTRE",109,0)
 I $G(IBMAX),IBDAY>IBMAX S IBDAY=IBMAX
"RTN","IBTRE",110,0)
 Q IBDAY
"RTN","IBTRE",111,0)
 ;
"RTN","IBTRE",112,0)
ECME(IBBIL,IBNCAN) ;ECME flag
"RTN","IBTRE",113,0)
 I 'IBBIL Q ""
"RTN","IBTRE",114,0)
 I $P($G(^DGCR(399,IBBIL,"M1")),U,8)="" Q ""
"RTN","IBTRE",115,0)
 I $G(IBNCAN),$P($G(^DGCR(399,IBBIL,0)),U,13)=7 Q ""  ; cancelled
"RTN","IBTRE",116,0)
 Q "e"
"RTN","IBTRED")
0^17^B22391684
"RTN","IBTRED",1,0)
IBTRED ;ALB/AAS - EXPAND/EDIT CLAIMS TRACKING ENTRY ;01-JUL-1993
"RTN","IBTRED",2,0)
 ;;2.0;INTEGRATED BILLING;**71,91,160,247,309,276**;21-MAR-94
"RTN","IBTRED",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRED",4,0)
 ;
"RTN","IBTRED",5,0)
% ;
"RTN","IBTRED",6,0)
EN ; -- main entry point for IBT EXPAND/EDIT TRACKING
"RTN","IBTRED",7,0)
 I '$D(DT) D DT^DICRW
"RTN","IBTRED",8,0)
 K XQORS,VALMEVL,DFN,IBTRN,IBTRV,IBTRC,IBTRD
"RTN","IBTRED",9,0)
 I '$G(IBTRN) G EN^IBTRE Q  ; entry from programmer mode
"RTN","IBTRED",10,0)
 D EN^VALM("IBT EXPAND/EDIT TRACKING")
"RTN","IBTRED",11,0)
 K IBFASTXT
"RTN","IBTRED",12,0)
 Q
"RTN","IBTRED",13,0)
 ;
"RTN","IBTRED",14,0)
HDR ; -- header code
"RTN","IBTRED",15,0)
 D PID^VADPT
"RTN","IBTRED",16,0)
 S VALMHDR(1)="Expanded Claims Tracking Info for: "_$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")_"   ROI: "_$$EXPAND^IBTRE(356,.31,$P(^IBT(356,IBTRN,0),"^",31))
"RTN","IBTRED",17,0)
 S VALMHDR(2)="                              For: "_$$ETYP(IBTRN)
"RTN","IBTRED",18,0)
 Q
"RTN","IBTRED",19,0)
 ;
"RTN","IBTRED",20,0)
INIT ; -- init variables and list array
"RTN","IBTRED",21,0)
 K VALMQUIT
"RTN","IBTRED",22,0)
 S VALMCNT=0,VALMBG=1
"RTN","IBTRED",23,0)
 D BLD,HDR
"RTN","IBTRED",24,0)
 Q
"RTN","IBTRED",25,0)
 ;
"RTN","IBTRED",26,0)
BLD ; -- list builder
"RTN","IBTRED",27,0)
 N IBTRND,IBTRND1,IBTRND2,IBETYP
"RTN","IBTRED",28,0)
 K ^TMP("IBTRED",$J)
"RTN","IBTRED",29,0)
 F I=1:1:30 D BLANK(.I)
"RTN","IBTRED",30,0)
 I '$G(IBTRPRF) S IBTRPRF=123
"RTN","IBTRED",31,0)
 I IBTRPRF<10 S X=$S(IBTRPRF=1:"IBTRED  HR MENU",IBTRPRF=2:"IBTRED  IR MENU",IBTRPRF=3:"IBTRED  BI MENU",1:"IBTRED  MENU") D PROT^IBTRPR(X)
"RTN","IBTRED",32,0)
 D KILL^VALM10()
"RTN","IBTRED",33,0)
 S IBTRND=$G(^IBT(356,IBTRN,0)),IBTRND1=$G(^(1))
"RTN","IBTRED",34,0)
 S IBETYP=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBTRED",35,0)
 S VALMCNT=30
"RTN","IBTRED",36,0)
 D VISIT D ^IBTRED0,^IBTRED01
"RTN","IBTRED",37,0)
 Q
"RTN","IBTRED",38,0)
 ;
"RTN","IBTRED",39,0)
VISIT ; -- Visit info Region
"RTN","IBTRED",40,0)
 N OFFSET,START,IBOE,IBOE0
"RTN","IBTRED",41,0)
 S START=1,OFFSET=2
"RTN","IBTRED",42,0)
 D SET^IBCNSP(START,OFFSET," Visit Information ",IORVON,IORVOFF)
"RTN","IBTRED",43,0)
 D SET^IBCNSP(START+1,OFFSET,"    Visit Type: "_$P(IBETYP,"^"))
"RTN","IBTRED",44,0)
 I '$D(IBETYP) N IBETYP S IBETYP=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBTRED",45,0)
 S X=$P(IBETYP,"^",3) D @X
"RTN","IBTRED",46,0)
 Q
"RTN","IBTRED",47,0)
1 ; -- visit region for admission or scheduled admission
"RTN","IBTRED",48,0)
 I $P($G(^DGPM(+$P(IBTRND,"^",5),0)),"^",17) S VAINDT=+$G(^DGPM(+$P(IBTRND,"^",5),0))
"RTN","IBTRED",49,0)
 I '$D(VAIN) S VA200="" D INP^VADPT
"RTN","IBTRED",50,0)
 I VAIN(7)="" S Y=$P(IBTRND,"^",6) D D^DIQ S $P(VAIN(7),"^",2)=Y
"RTN","IBTRED",51,0)
 D SET^IBCNSP(START+2,OFFSET,"Admission Date: "_$P(VAIN(7),"^",2))
"RTN","IBTRED",52,0)
 D SET^IBCNSP(START+3,OFFSET,"          Ward: "_$P(VAIN(4),"^",2))
"RTN","IBTRED",53,0)
 D SET^IBCNSP(START+4,OFFSET,"     Specialty: "_$P(VAIN(3),"^",2))
"RTN","IBTRED",54,0)
 Q
"RTN","IBTRED",55,0)
2 ; -- visit region for  outpatient care
"RTN","IBTRED",56,0)
 S IBOE=$P(IBTRND,"^",4),IBOE0=$$SCE^IBSDU(+IBOE)
"RTN","IBTRED",57,0)
 D SET^IBCNSP(START+2,OFFSET,"    Visit Date: "_$$DAT1^IBOUTL($P(IBTRND,"^",6),"2P"))
"RTN","IBTRED",58,0)
 I +IBOE<1 D  Q
"RTN","IBTRED",59,0)
 .D SET^IBCNSP(START+3,OFFSET,"  No Outpatient Encounter Found") Q
"RTN","IBTRED",60,0)
 D SET^IBCNSP(START+3,OFFSET,"        Clinic: "_$P($G(^SC(+$P(IBOE0,"^",4),0)),"^"))
"RTN","IBTRED",61,0)
 D SET^IBCNSP(START+4,OFFSET,"  Appt. Status: "_$$EXPAND^IBTRE(409.68,.12,$P(IBOE0,"^",12)))
"RTN","IBTRED",62,0)
 D SET^IBCNSP(START+5,OFFSET,"    Appt. Type: "_$$EXPAND^IBTRE(409.68,.1,$P(IBOE0,"^",10)))
"RTN","IBTRED",63,0)
 D SET^IBCNSP(START+6,OFFSET,"  Special Cond: "_$$ENCL(IBOE))
"RTN","IBTRED",64,0)
 Q
"RTN","IBTRED",65,0)
 ;
"RTN","IBTRED",66,0)
3 ; -- visit region for rx refill
"RTN","IBTRED",67,0)
 N PSONTALK,PSOTMP
"RTN","IBTRED",68,0)
 S PSONTALK=1 ;PSORXN=+$P(IBTRND,"^",8),PSOFILL=+$P(IBTRND,"^",10)
"RTN","IBTRED",69,0)
 S X=+$P(IBTRND,"^",8)_"^"_+$P(IBTRND,"^",10) D EN^PSOCPVW
"RTN","IBTRED",70,0)
 ;if refill was deleted and EN^PSOCPVW doesn't return any data use IB API
"RTN","IBTRED",71,0)
 I '$D(PSOTMP) D PSOCPVW^IBNCPDPC(+$P(IBTRND,"^",2),+$P(IBTRND,"^",8),.PSOTMP)
"RTN","IBTRED",72,0)
 D SET^IBCNSP(START+2,OFFSET,"Prescription #: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),.01,"E")))
"RTN","IBTRED",73,0)
 ;I $P(IBTRND,"^",10)=0 D SET^IBCNSP(START+3,OFFSET,"     Fill Date: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),22,"E")))
"RTN","IBTRED",74,0)
 ;I +$P(IBTRND,"^",10) D SET^IBCNSP(START+3,OFFSET,"   Refill Date: "_$G(PSOTMP(52.1,+$P(IBTRND,"^",10),.01,"E")))
"RTN","IBTRED",75,0)
 I $P(IBTRND,"^",10)=0 D SET^IBCNSP(START+3,OFFSET,"     Fill Date: "_$$FMTE^XLFDT(+$P(IBTRND,"^",6)))
"RTN","IBTRED",76,0)
 I +$P(IBTRND,"^",10) D SET^IBCNSP(START+3,OFFSET,"   Refill Date: "_$$FMTE^XLFDT(+$P(IBTRND,"^",6)))
"RTN","IBTRED",77,0)
 D SET^IBCNSP(START+4,OFFSET,"          Drug: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),6,"E")))
"RTN","IBTRED",78,0)
 D SET^IBCNSP(START+5,OFFSET,"      Quantity: "_$J($G(PSOTMP(52,+$P(IBTRND,"^",8),7,"E")),8))
"RTN","IBTRED",79,0)
 D SET^IBCNSP(START+6,OFFSET,"   Days Supply: "_$J($G(PSOTMP(52,+$P(IBTRND,"^",8),8,"E")),8))
"RTN","IBTRED",80,0)
 D SET^IBCNSP(START+7,OFFSET,"          NDC#: "_$$GETNDC^PSONDCUT(+$P(IBTRND,"^",8),$P(IBTRND,"^",10)),2)
"RTN","IBTRED",81,0)
 D SET^IBCNSP(START+8,OFFSET,"     Physician: "_$G(PSOTMP(52,+$P(IBTRND,"^",8),4,"E")))
"RTN","IBTRED",82,0)
 Q
"RTN","IBTRED",83,0)
 ;
"RTN","IBTRED",84,0)
4 ; -- Visit region for prosthetics
"RTN","IBTRED",85,0)
 D 4^IBTRED01
"RTN","IBTRED",86,0)
 Q
"RTN","IBTRED",87,0)
 ;
"RTN","IBTRED",88,0)
HELP ; -- help code
"RTN","IBTRED",89,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBTRED",90,0)
 Q
"RTN","IBTRED",91,0)
 ;
"RTN","IBTRED",92,0)
EXIT ; -- exit code
"RTN","IBTRED",93,0)
 K VALMQUIT,IBTRN
"RTN","IBTRED",94,0)
 D CLEAN^VALM10,FULL^VALM1
"RTN","IBTRED",95,0)
 Q
"RTN","IBTRED",96,0)
 ;
"RTN","IBTRED",97,0)
BLANK(LINE) ; -- Build blank line
"RTN","IBTRED",98,0)
 D SET^VALM10(.LINE,$J("",80))
"RTN","IBTRED",99,0)
 Q
"RTN","IBTRED",100,0)
 ;
"RTN","IBTRED",101,0)
ETYP(IBTRN) ; -- Expand type of epidose and date
"RTN","IBTRED",102,0)
 N IBY S IBY=""
"RTN","IBTRED",103,0)
 S IBTRND=$G(^IBT(356,+IBTRN,0)) I IBTRND="" G ETYPQ
"RTN","IBTRED",104,0)
 S IBETYPD=$G(^IBE(356.6,+$P(IBTRND,"^",18),0))
"RTN","IBTRED",105,0)
 I IBETYPD="" G ETYPQ
"RTN","IBTRED",106,0)
 S IBY=$P(IBETYPD,"^")_" on "_$$DAT1^IBOUTL($P(IBTRND,"^",6),"2P")
"RTN","IBTRED",107,0)
ETYPQ Q IBY
"RTN","IBTRED",108,0)
 ;
"RTN","IBTRED",109,0)
ENCL(IBOE) ; -- output format of classifications
"RTN","IBTRED",110,0)
 N I,X,IBCL,IBCL1 S IBCL=""
"RTN","IBTRED",111,0)
 I '$G(IBOE) G ENCLQ
"RTN","IBTRED",112,0)
 S IBCL1=$$ENCL^IBAMTS2(+IBOE)
"RTN","IBTRED",113,0)
 F I=1:1:7 S X=$P(IBCL1,"^",I) S:X IBCL=IBCL_$S(I=1:"AO",I=2:"IR",I=3:"SC",I=4:"EC",I=5:"MST",I=6:"HNC",I=7:"CV",1:"")_"  "
"RTN","IBTRED",114,0)
ENCLQ Q IBCL
"RTN","IBTRED",115,0)
 ;
"RTN","IBTRED0")
0^18^B23652054
"RTN","IBTRED0",1,0)
IBTRED0 ;ALB/AAS - EXPAND/EDIT CLAIMS TRACKING ENTRY - CONT. ;01-JUL-1993
"RTN","IBTRED0",2,0)
 ;;2.0;INTEGRATED BILLING;**160,210,317,276**;21-MAR-94
"RTN","IBTRED0",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRED0",4,0)
 ;
"RTN","IBTRED0",5,0)
% I '$G(IBTRN)!($G(IORVON)="") G ^IBTRED
"RTN","IBTRED0",6,0)
 D CLIN,BILL,PRE
"RTN","IBTRED0",7,0)
 Q
"RTN","IBTRED0",8,0)
 ;
"RTN","IBTRED0",9,0)
CLIN ; -- clinical data region
"RTN","IBTRED0",10,0)
 N OFFSET,START,IBICD
"RTN","IBTRED0",11,0)
 S START=7,OFFSET=2
"RTN","IBTRED0",12,0)
 ;
"RTN","IBTRED0",13,0)
CLIN1 N IBETYP S IBETYP=$$TRTP^IBTRE1(IBTRN) I 'IBETYP!(IBETYP>2) Q
"RTN","IBTRED0",14,0)
 D SET^IBCNSP(START,OFFSET," Clinical Information ",IORVON,IORVOFF)
"RTN","IBTRED0",15,0)
 I "12"[IBETYP D @IBETYP
"RTN","IBTRED0",16,0)
 Q
"RTN","IBTRED0",17,0)
 ;
"RTN","IBTRED0",18,0)
1 ; -- inpatient clinical data
"RTN","IBTRED0",19,0)
 ;D SET^IBCNSP(START+1,OFFSET,"      Provider: "_$E($P($G(VAIN(2)),"^",2),1,15))
"RTN","IBTRED0",20,0)
 D SET^IBCNSP(START+1,OFFSET,"      Provider: "_$E($$APROV^IBTRE6(IBTRN),1,15))
"RTN","IBTRED0",21,0)
 D SET^IBCNSP(START+2,OFFSET,"Admitting Diag: "_$E($$ADMDIAG^IBTRE6(IBTRN),1,23))
"RTN","IBTRED0",22,0)
 D SET^IBCNSP(START+3,OFFSET,"  Primary Diag: "_$E($$PDIAG^IBTRE6(IBTRN),1,23))
"RTN","IBTRED0",23,0)
 D LISTP^IBTRE6(IBTRN,.IBICD)
"RTN","IBTRED0",24,0)
 D SET^IBCNSP(START+4,OFFSET," 1st Procedure: "_$E($$PROC^IBTRE6(+$G(IBICD(1)),1),1,23))
"RTN","IBTRED0",25,0)
 D SET^IBCNSP(START+5,OFFSET," 2nd Procedure: "_$E($$PROC^IBTRE6(+$G(IBICD(2)),1),1,23))
"RTN","IBTRED0",26,0)
 Q
"RTN","IBTRED0",27,0)
 ;
"RTN","IBTRED0",28,0)
2 ; -- outpatient clinic data
"RTN","IBTRED0",29,0)
 N IBDATE ; Date of service for CSV
"RTN","IBTRED0",30,0)
 S IBDATE=$$TRNDATE^IBACSV(IBTRN)
"RTN","IBTRED0",31,0)
 S IBOE=$P(IBTRND,"^",4)
"RTN","IBTRED0",32,0)
 I +IBOE<1 D SET^IBCNSP(START+1,OFFSET,"  No Outpatient Encounter Found") Q
"RTN","IBTRED0",33,0)
 N SDDXY,SDPRY D SET^SDCO3(+IBOE) S IBPCNT=SDCNT D SET^SDCO4(IBOE) S IBDCNT=SDCNT
"RTN","IBTRED0",34,0)
 D SET^IBCNSP(START+1,OFFSET,"      Provider: "_$E($P($G(^VA(200,+$P($G(SDPRY(1)),"^",2),0)),"^"),1,23)) ;sdd(409.44
"RTN","IBTRED0",35,0)
 D SET^IBCNSP(START+2,OFFSET,"      Provider: "_$E($P($G(^VA(200,+$P($G(SDPRY(2)),"^",2),0)),"^"),1,23)) ;sdd(409.44
"RTN","IBTRED0",36,0)
 D SET^IBCNSP(START+3,OFFSET,"     Diagnosis: "_$E($$DIAG^IBTRE6(+$P($G(SDDXY(1)),"^",2),1,IBDATE),1,23)) ;sdd(409.43
"RTN","IBTRED0",37,0)
 D SET^IBCNSP(START+4,OFFSET,"     Diagnosis: "_$E($$DIAG^IBTRE6(+$P($G(SDDXY(2)),"^",2),1,IBDATE),1,23)) ;sdd(409.43
"RTN","IBTRED0",38,0)
 D SET^IBCNSP(START+5,OFFSET,"  Special Cond: "_$$ENCL^IBTRED(IBOE))
"RTN","IBTRED0",39,0)
 Q
"RTN","IBTRED0",40,0)
 ;
"RTN","IBTRED0",41,0)
BILL ; -- billing information region
"RTN","IBTRED0",42,0)
 N OFFSET,START,IBBIL,IBECME,IBECMEN,IBCOMM
"RTN","IBTRED0",43,0)
 S START=15,OFFSET=2
"RTN","IBTRED0",44,0)
 S IBBIL=+$P(IBTRND,"^",11)
"RTN","IBTRED0",45,0)
 S IBDGCR=$G(^DGCR(399,IBBIL,0)),IBDGCRU1=$G(^("U1"))
"RTN","IBTRED0",46,0)
 S IBECMEN=$P($P($G(^DGCR(399,IBBIL,"M1")),U,8),";") ;ecme#
"RTN","IBTRED0",47,0)
 S IBECME=''IBECMEN
"RTN","IBTRED0",48,0)
 S IBAMNT=$$BILLD^IBTRED1(IBTRN)
"RTN","IBTRED0",49,0)
 D SET^IBCNSP(START,OFFSET+20," Billing Information ",IORVON,IORVOFF)
"RTN","IBTRED0",50,0)
 D SET^IBCNSP(START+1,OFFSET,"    Episode Billable: "_$S(+$P(IBTRND,"^",19):"NO",1:"YES"))
"RTN","IBTRED0",51,0)
 D SET^IBCNSP(START+2,OFFSET," Non-Billable Reason: "_$E($P($G(^IBE(356.8,+$P(IBTRND,"^",19),0)),"^"),1,20))
"RTN","IBTRED0",52,0)
 D SET^IBCNSP(START+3,OFFSET,"      Next Bill Date: "_$$DAT1^IBOUTL($P(IBTRND,"^",17)))
"RTN","IBTRED0",53,0)
 D SET^IBCNSP(START+4,OFFSET,"Work. Comp/OWCP/Tort: "_$E($$EXPAND^IBTRE(356,.12,$P(IBTRND,"^",12)),1,14))
"RTN","IBTRED0",54,0)
 D SET^IBCNSP(START+5,OFFSET,"        Initial Bill: "_$P(IBDGCR,"^")_$S(IBECME:"e",1:""))
"RTN","IBTRED0",55,0)
 I IBECME D SET^IBCNSP(START+6,OFFSET,"         ECME Number: "_IBECMEN)
"RTN","IBTRED0",56,0)
 D SET^IBCNSP(START+6+IBECME,OFFSET,"         Bill Status: "_$E($$EXPAND^IBTRE(399,.13,$P(IBDGCR,"^",13)),1,14))
"RTN","IBTRED0",57,0)
 ;S IBCOMM="" I +$P(IBTRND,"^",19) ; removed 'IF' for displaying the comment
"RTN","IBTRED0",58,0)
 S IBCOMM=$E($P(IBTRND1,"^",8),1,60)
"RTN","IBTRED0",59,0)
 I IBCOMM'="" D SET^IBCNSP(START+7+IBECME,OFFSET,"  Additional Comment: "_IBCOMM)
"RTN","IBTRED0",60,0)
 I $P($G(^IBT(356,IBTRN,3,0)),"^",3) D
"RTN","IBTRED0",61,0)
 . N IBX,IBY
"RTN","IBTRED0",62,0)
 . S IBY="",IBX=0 F  S IBX=$O(^IBT(356,IBTRN,3,IBX)) Q:'IBX  S IBY($P($G(^IBT(356.85,+$G(^IBT(356,IBTRN,3,IBX,0)),0)),"^"))=""
"RTN","IBTRED0",63,0)
 . S IBX="" F  S IBX=$O(IBY(IBX)) Q:IBX=""  S IBY=IBY_$S($L(IBY):", ",1:"")_IBX
"RTN","IBTRED0",64,0)
 . D SET^IBCNSP(START+($S(+$P(IBTRND,"^",19):8,1:7)),OFFSET,"   Billable Findings: "_IBY)
"RTN","IBTRED0",65,0)
 D BILL1
"RTN","IBTRED0",66,0)
 Q
"RTN","IBTRED0",67,0)
 ;
"RTN","IBTRED0",68,0)
BILL1 ; -- other side of billing info
"RTN","IBTRED0",69,0)
 N OFFSET,START
"RTN","IBTRED0",70,0)
 S START=15,OFFSET=45
"RTN","IBTRED0",71,0)
 D SET^IBCNSP(START+1,OFFSET,"       Total Charges: $ "_$J($P(IBAMNT,"^"),8))
"RTN","IBTRED0",72,0)
 D SET^IBCNSP(START+2,OFFSET,"Estimated Recv (Pri): $ "_$J($P(IBTRND,"^",21),8))
"RTN","IBTRED0",73,0)
 D SET^IBCNSP(START+3,OFFSET,"Estimated Recv (Sec): $ "_$J($P(IBTRND,"^",22),8))
"RTN","IBTRED0",74,0)
 D SET^IBCNSP(START+4,OFFSET,"Estimated Recv (ter): $ "_$J($P(IBTRND,"^",23),8))
"RTN","IBTRED0",75,0)
 D SET^IBCNSP(START+5,OFFSET,"  Means Test Charges: $ "_$J($P(IBTRND,"^",28),8))
"RTN","IBTRED0",76,0)
 D SET^IBCNSP(START+6,OFFSET,"         Amount Paid: $ "_$J($P(IBAMNT,"^",2),8))
"RTN","IBTRED0",77,0)
 Q
"RTN","IBTRED0",78,0)
 ;
"RTN","IBTRED0",79,0)
PRE ; -- pre-certification region
"RTN","IBTRED0",80,0)
 N OFFSET,START,IBTRC,IBTRCD
"RTN","IBTRED0",81,0)
 ;S START=15,OFFSET=45
"RTN","IBTRED0",82,0)
 S START=1,OFFSET=45
"RTN","IBTRED0",83,0)
 D SET^IBCNSP(START,OFFSET," Treatment Authorization Info ",IORVON,IORVOFF)
"RTN","IBTRED0",84,0)
 D SET^IBCNSP(START+1,OFFSET,"Authorization #: "_$$PRECRT^IBTRC1(IBTRN))
"RTN","IBTRED0",85,0)
 D SET^IBCNSP(START+2,OFFSET,"      No. Days Approved: "_$J($$DAY^IBTRE(IBTRN),3))
"RTN","IBTRED0",86,0)
 D SET^IBCNSP(START+3,OFFSET,"Second Opinion Required: "_$$EXPAND^IBTRE(356,.14,$P(IBTRND,"^",14)))
"RTN","IBTRED0",87,0)
 D SET^IBCNSP(START+4,OFFSET,"Second Opinion Obtained: "_$$EXPAND^IBTRE(356,.15,$P(IBTRND,"^",15)))
"RTN","IBTRED0",88,0)
 Q
"RTN","IBTRED0",89,0)
 ;
"RTN","IBTRED0",90,0)
SPCOND(IBTRN) ; -- see if sc or other special condition for patient
"RTN","IBTRED0",91,0)
 ; -- if inpt. look in ptf. if opt look opt encounter file
"RTN","IBTRED0",92,0)
 ;
"RTN","IBTRED0",93,0)
 Q ""
"RTN","IBTUBOA")
0^39^B30890238
"RTN","IBTUBOA",1,0)
IBTUBOA ;ALB/RB - UNBILLED AMOUNTS - GENERATE UNBILLED REPORTS ;01-JAN-01
"RTN","IBTUBOA",2,0)
 ;;2.0;INTEGRATED BILLING;**19,31,32,91,123,159,192,155,276**;21-MAR-94
"RTN","IBTUBOA",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTUBOA",4,0)
 ;
"RTN","IBTUBOA",5,0)
% ; - Entry point from Taskman.
"RTN","IBTUBOA",6,0)
 ;ARRAY VARIABLES:
"RTN","IBTUBOA",7,0)
 ;   IBAVG("BILLS-I")=number of inpatient institutional claims
"RTN","IBTUBOA",8,0)
 ;   IBAVG("BILLS-P")=number of inpatient professional claims
"RTN","IBTUBOA",9,0)
 ;   IBAVG("EPISD-I")=number of inpt. episodes for institutional claims
"RTN","IBTUBOA",10,0)
 ;   IBAVG("EPISD-P")=number of inpt. episodes for professional claims
"RTN","IBTUBOA",11,0)
 ;   IBAVG("$AMNT-I")=inpatient institutional amount billed
"RTN","IBTUBOA",12,0)
 ;   IBAVG("$AMNT-P")=inpatient professional amount billed
"RTN","IBTUBOA",13,0)
 ;   IBUNB("EPISM-I")=number of inpatient episodes missing inst. claims
"RTN","IBTUBOA",14,0)
 ;   IBUNB("EPISM-P")=number of inpatient episodes missing prof. claims
"RTN","IBTUBOA",15,0)
 ;   IBUNB("EPISM-I-MRA")=number of MRA req inpat institutional claims
"RTN","IBTUBOA",16,0)
 ;   IBUNB("EPISM-P-MRA")=number of MRA req inpat professional claims
"RTN","IBTUBOA",17,0)
 ;   IBUNB("EPISM-A")=number of inpatient admissions missing claims
"RTN","IBTUBOA",18,0)
 ;                   (any type: Prof,Inst or both)
"RTN","IBTUBOA",19,0)
 ;   IBUNB("EPISM-A-MRA")=number inpt MRA req admissions missing claims
"RTN","IBTUBOA",20,0)
 ;                   (any type: Prof,Inst or both)
"RTN","IBTUBOA",21,0)
 ;   IBUNB("ENCNTRS")=number of outpatient encounters missing claims
"RTN","IBTUBOA",22,0)
 ;   IBUNB("CPTMS-I")=number of CPT codes missing institutional claims
"RTN","IBTUBOA",23,0)
 ;   IBUNB("CPTMS-I-MRA")=number of MRA req CPT codes missing inst claims
"RTN","IBTUBOA",24,0)
 ;   IBUNB("CPTMS-P")=number of CPT codes missing professional claims
"RTN","IBTUBOA",25,0)
 ;   IBUNB("CPTMS-P-MRA")=number of MRA req CPT codes missing prof claims
"RTN","IBTUBOA",26,0)
 ;   IBUNB("PRESCRP")=number of unbilled prescriptions
"RTN","IBTUBOA",27,0)
 ;   IBUNB("PRESCRP-MRA")=number of MRA req prescriptions
"RTN","IBTUBOA",28,0)
 ;   IBUNB("UNBILIP")=unbilled inpatient amount
"RTN","IBTUBOA",29,0)
 ;   IBUNB("UNBILIP-MRA")=MRA req inpatient amount
"RTN","IBTUBOA",30,0)
 ;   IBUNB("UNBILOP")=unbilled outpatient amount
"RTN","IBTUBOA",31,0)
 ;   IBUNB("UNBILOP-MRA")=MRA req outpatient amount
"RTN","IBTUBOA",32,0)
 ;   IBUNB("UNBILRX")=unbilled prescription amount
"RTN","IBTUBOA",33,0)
 ;   IBUNB("UNBILRX-MRA")=MRA req prescription amount
"RTN","IBTUBOA",34,0)
 ;   IBUNB("UNBILTL")=total unbilled amount
"RTN","IBTUBOA",35,0)
 ;   IBUNB("UNBILTL-MRA")=total MRA req amount
"RTN","IBTUBOA",36,0)
 ; 
"RTN","IBTUBOA",37,0)
 ;ARRAY VARIABLES FOR DM EXTRACT:
"RTN","IBTUBOA",38,0)
 ;   IB(1)=Number of inpatient episodes missing institutional claims
"RTN","IBTUBOA",39,0)
 ;   IB(2)=Amount of inpatient episodes missing institutional claims
"RTN","IBTUBOA",40,0)
 ;   IB(3)=Number of inpatient episodes missing professional claims
"RTN","IBTUBOA",41,0)
 ;   IB(4)=Amount of inpatient episodes missing professional claims
"RTN","IBTUBOA",42,0)
 ;   IB(5)=Number of all inpatient episodes missing claims
"RTN","IBTUBOA",43,0)
 ;   IB(6)=Amount of all inpatient episodes missing claims
"RTN","IBTUBOA",44,0)
 ;   IB(7)=Number of unbilled outpatient encounters prior to 9/1/99
"RTN","IBTUBOA",45,0)
 ;   IB(8)=Amount of unbilled outpatient encounters prior to 9/1/99
"RTN","IBTUBOA",46,0)
 ;   IB(9)=Number of procedures without an institutional charge
"RTN","IBTUBOA",47,0)
 ;   IB(10)=Amount of procedures without an institutional charge
"RTN","IBTUBOA",48,0)
 ;   IB(11)=Number of procedures without a professional charge
"RTN","IBTUBOA",49,0)
 ;   IB(12)=Amount of procedures without a professional charge
"RTN","IBTUBOA",50,0)
 ;   IB(13)=Number of all procedures without a charge
"RTN","IBTUBOA",51,0)
 ;   IB(14)=Number of encounters associated with all procedures without
"RTN","IBTUBOA",52,0)
 ;          a charge
"RTN","IBTUBOA",53,0)
 ;   IB(15)=Number of all encounters missing claims
"RTN","IBTUBOA",54,0)
 ;   IB(16)=Amount of all encounters missing claims
"RTN","IBTUBOA",55,0)
 ;   IB(17)=Number of unbilled prescriptions and refills
"RTN","IBTUBOA",56,0)
 ;   IB(18)=Amount of unbilled prescriptions and refills
"RTN","IBTUBOA",57,0)
 ;   IB(19)=Amount of all unbilled episodes of care
"RTN","IBTUBOA",58,0)
 ;
"RTN","IBTUBOA",59,0)
 N IB,IBAMTI,IBAMTP,IBIAV,IBIA,IBNODE,IBOE,IBPA,IBQUERY,IBRX,IBSAV,IBT
"RTN","IBTUBOA",60,0)
 N IBAMTIM,IBAMTPM,IBTYP,IBX,IBY,DFN,DGPM,I,J
"RTN","IBTUBOA",61,0)
 ;
"RTN","IBTUBOA",62,0)
 K ^TMP($J,"IBTUB-INPT"),^TMP($J,"IBTUB-OPT"),^TMP($J,"IBTUB-RX")
"RTN","IBTUBOA",63,0)
 K ^TMP($J,"IBTUB-INPT_MRA"),^TMP($J,"IBTUB-OPT_MRA"),^TMP($J,"IBTUB-RX_MRA")
"RTN","IBTUBOA",64,0)
 ;
"RTN","IBTUBOA",65,0)
 ; - Initialize DM extract variables, if necessary.
"RTN","IBTUBOA",66,0)
 I $G(IBXTRACT) D E^IBJDE(37,1) F IBX=1:1:19 S IB(IBX)=0
"RTN","IBTUBOA",67,0)
 ;
"RTN","IBTUBOA",68,0)
 ; - Initialize Unbilled Amounts variables.
"RTN","IBTUBOA",69,0)
 S (IBUNB("ENCNTRS"),IBUNB("PRESCRP"),IBUNB("PRESCRP-MRA"))=0
"RTN","IBTUBOA",70,0)
 F IBX="IP","OP","RX" S IBUNB("UNBIL"_IBX)=0,IBUNB("UNBIL"_IBX_"-MRA")=0
"RTN","IBTUBOA",71,0)
 F IBX="I","P" S (IBUNB("EPISM-"_IBX),IBUNB("EPISM-"_IBX_"-MRA"),IBUNB("CPTMS-"_IBX),IBUNB("CPTMS-"_IBX_"-MRA"))=0
"RTN","IBTUBOA",72,0)
 S (IBUNB("EPISM-A"),IBUNB("EPISM-A-MRA"))=0
"RTN","IBTUBOA",73,0)
 ;
"RTN","IBTUBOA",74,0)
 ; - Retrieve the Rate Type code for Reimbursable Insurance
"RTN","IBTUBOA",75,0)
 S IBRT=$S($O(^DGCR(399.3,"B","REIMBURSABLE INS.",0)):$O(^(0)),1:8)
"RTN","IBTUBOA",76,0)
 ;
"RTN","IBTUBOA",77,0)
 ; - If Compile/Store - Checks if the Average Bill Amounts exists for
"RTN","IBTUBOA",78,0)
 ;   IBTIMON. If it does not, calls IBTUBAV to calculate/updated it.
"RTN","IBTUBOA",79,0)
 I $G(IBCOMP) D
"RTN","IBTUBOA",80,0)
 . I $P($G(^IBE(356.19,IBTIMON,1)),"^",14)'="" Q
"RTN","IBTUBOA",81,0)
 . ;
"RTN","IBTUBOA",82,0)
 . ; - DQ^IBTUBAV will kill the variables IBTIMON and IBCOMP - That's why
"RTN","IBTUBOA",83,0)
 . ;   they are being set again after this call.
"RTN","IBTUBOA",84,0)
 . S IBSAV=IBTIMON D DQ^IBTUBAV S IBTIMON=IBSAV,IBCOMP=1
"RTN","IBTUBOA",85,0)
 ;
"RTN","IBTUBOA",86,0)
PROC ; - Loops through all the entries in the Claims Tracking file for the
"RTN","IBTUBOA",87,0)
 ;   period selected and calculate the Unbilled Amounts
"RTN","IBTUBOA",88,0)
 S IBDT=IBBDT-.1
"RTN","IBTUBOA",89,0)
 ;
"RTN","IBTUBOA",90,0)
 F  S IBDT=$O(^IBT(356,"D",IBDT)) Q:'IBDT!(IBDT>IBEDT)  D
"RTN","IBTUBOA",91,0)
 . S IBX=0 F  S IBX=$O(^IBT(356,"D",IBDT,IBX)) Q:'IBX  D
"RTN","IBTUBOA",92,0)
 . . S IBNODE=$G(^IBT(356,IBX,0)) Q:IBNODE=""
"RTN","IBTUBOA",93,0)
 . . I $P(IBNODE,U,12) Q  ; Tort-Feasor,Workman's Comp,No-fault Auto Acc.
"RTN","IBTUBOA",94,0)
 . . I $P(IBNODE,U,19) Q  ;  Reason not billable assigned.
"RTN","IBTUBOA",95,0)
 . . I '$P(IBNODE,U,20) Q  ; Inactive.
"RTN","IBTUBOA",96,0)
 . . S DFN=+$P(IBNODE,U,2)
"RTN","IBTUBOA",97,0)
 . . I '$$PTCHK^IBTUBOU(DFN,IBNODE) Q  ; Has a non-veteran eligibility.
"RTN","IBTUBOA",98,0)
 . . I '$$INSURED^IBCNS1(DFN,IBDT) Q  ;  Not insured during care.
"RTN","IBTUBOA",99,0)
 . . I $P(IBNODE,U,5),IBSEL[1,$$COV^IBTUBOU(DFN,IBDT,1) D  Q  ;Inpatient
"RTN","IBTUBOA",100,0)
 . . . S DGPM=+$P(IBNODE,U,5) D INPT^IBTUBO2(DGPM)
"RTN","IBTUBOA",101,0)
 . . I $P(IBNODE,U,4),IBSEL[2,$$COV^IBTUBOU(DFN,IBDT,2) D  Q  ;Outpatient
"RTN","IBTUBOA",102,0)
 . . . S IBOE=+$P(IBNODE,U,4) I $$NCCL^IBTUBOU(IBOE) Q  ; Non-Count Clinic
"RTN","IBTUBOA",103,0)
 . . . D OPT^IBTUBO1(IBOE,.IBQUERY)
"RTN","IBTUBOA",104,0)
 . . I $P(IBNODE,U,8),IBSEL[3,$$COV^IBTUBOU(DFN,IBDT,3) D  Q  ;Prescription
"RTN","IBTUBOA",105,0)
 . . . N IBIFN,IBCSTAT S IBIFN=+$P(IBNODE,U,11)
"RTN","IBTUBOA",106,0)
 . . . I IBIFN S IBCSTAT=$$GET1^DIQ(399,IBIFN_",",.13,"I") Q:$S(IBCSTAT=0:1,IBCSTAT=1:0,IBCSTAT=2:1,IBCSTAT=3:1,IBCSTAT=4:1,IBCSTAT=5:1,IBCSTAT=7:0,1:1)  ;already billed (modified in T9)
"RTN","IBTUBOA",107,0)
 . . . S IBRX=+$P(IBNODE,U,8) D RX^IBTUBO2(IBRX)
"RTN","IBTUBOA",108,0)
 . . ;
"RTN","IBTUBOA",109,0)
 . . ; - Check CT entry event type to get unbilled amounts, if necessary.
"RTN","IBTUBOA",110,0)
 . . S IBTYP=$P($G(^IBE(356.6,+$P(IBNODE,U,18),0)),U,8)
"RTN","IBTUBOA",111,0)
 . . I IBTYP=1,IBSEL[1,$$COV^IBTUBOU(DFN,IBDT,1) D
"RTN","IBTUBOA",112,0)
 . . . D INPT^IBTUBO2(+$O(^DGPM("APTT1",DFN,IBDT,0)))
"RTN","IBTUBOA",113,0)
 . . I IBTYP=2,IBSEL[2,$$COV^IBTUBOU(DFN,IBDT,2) D
"RTN","IBTUBOA",114,0)
 . . . D OPT^IBTUBO1("",.IBQUERY)
"RTN","IBTUBOA",115,0)
 ;
"RTN","IBTUBOA",116,0)
 I $G(IBXTRACT) D XTRACT^IBTUBOU ; Load extract file, if necessary.
"RTN","IBTUBOA",117,0)
 ;
"RTN","IBTUBOA",118,0)
 ; - Calculate the Amount Inpatient INST. & PROF. Unbilled Amounts,
"RTN","IBTUBOA",119,0)
 ;   based on average amounts of Billed Amounts
"RTN","IBTUBOA",120,0)
 S IBIAV=$$INPAVG^IBTUBOU(IBTIMON)
"RTN","IBTUBOA",121,0)
 S IBAMTI=$P(IBIAV,"^")*IBUNB("EPISM-I") ; Inst
"RTN","IBTUBOA",122,0)
 S IBAMTIM=$P(IBIAV,"^")*IBUNB("EPISM-I-MRA") ; Inst
"RTN","IBTUBOA",123,0)
 S IBAMTP=$P(IBIAV,"^",2)*IBUNB("EPISM-P") ; Prof
"RTN","IBTUBOA",124,0)
 S IBAMTPM=$P(IBIAV,"^",2)*IBUNB("EPISM-P-MRA") ; Prof
"RTN","IBTUBOA",125,0)
 ;
"RTN","IBTUBOA",126,0)
 ; - Calculate Unbilled Amounts Totals
"RTN","IBTUBOA",127,0)
 S IBUNB("UNBILIP")=$J(IBAMTI+IBAMTP,0,2)
"RTN","IBTUBOA",128,0)
 S IBUNB("UNBILIP-MRA")=$J(IBAMTIM+IBAMTPM,0,2)
"RTN","IBTUBOA",129,0)
 S IBUNB("UNBILOP")=$J(IBUNB("UNBILOP"),0,2)
"RTN","IBTUBOA",130,0)
 S IBUNB("UNBILOP-MRA")=$J(IBUNB("UNBILOP-MRA"),0,2)
"RTN","IBTUBOA",131,0)
 S IBUNB("UNBILRX")=$J(IBUNB("UNBILRX"),0,2)
"RTN","IBTUBOA",132,0)
 S IBUNB("UNBILRX-MRA")=$J(IBUNB("UNBILRX-MRA"),0,2)
"RTN","IBTUBOA",133,0)
 S IBUNB("UNBILTL")=$J(IBUNB("UNBILIP")+IBUNB("UNBILOP")+IBUNB("UNBILRX"),0,2)
"RTN","IBTUBOA",134,0)
 S IBUNB("UNBILTL-MRA")=$J(IBUNB("UNBILIP-MRA")+IBUNB("UNBILOP-MRA")+IBUNB("UNBILRX-MRA"),0,2)
"RTN","IBTUBOA",135,0)
 ;
"RTN","IBTUBOA",136,0)
 ; - If Compile/Store - update Unbilled Amounts data on file #356.19
"RTN","IBTUBOA",137,0)
 I $G(IBCOMP) D LD^IBTUBOU(3,IBTIMON)
"RTN","IBTUBOA",138,0)
 ;
"RTN","IBTUBOA",139,0)
PRT ; - Print report(s).
"RTN","IBTUBOA",140,0)
 I $G(IBQUERY) D CLOSE^IBSDU(.IBQUERY)
"RTN","IBTUBOA",141,0)
 D REPORT^IBTUBO3
"RTN","IBTUBOA",142,0)
 ;
"RTN","IBTUBOA",143,0)
END K ^TMP($J,"IBTUB-INPT"),^TMP($J,"IBTUB-OPT"),^TMP($J,"IBTUB-RX")
"RTN","IBTUBOA",144,0)
 K IBDT,IBRT,IBUNB
"RTN","IBTUBOA",145,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBTUBOA",146,0)
 D ^%ZISC K IBTEMON,IBXTRACT,D,D0,DA,DIC,DIE
"RTN","IBTUBOA",147,0)
 Q
"VER")
8.0^22.0
"^DD",356,356,1.1,0)
ECME NUMBER^F^^1;10^K:$L(X)>7!($L(X)<7) X
"^DD",356,356,1.1,1,0)
^.1
"^DD",356,356,1.1,1,1,0)
356^AE
"^DD",356,356,1.1,1,1,1)
S ^IBT(356,"AE",$E(X,1,30),DA)=""
"^DD",356,356,1.1,1,1,2)
K ^IBT(356,"AE",$E(X,1,30),DA)
"^DD",356,356,1.1,1,1,"%D",0)
^^2^2^3050328^
"^DD",356,356,1.1,1,1,"%D",1,0)
The cross-reference is important to identify CT billable episodes related 
"^DD",356,356,1.1,1,1,"%D",2,0)
to the ECME number. It will be used for EDI matching purposes.
"^DD",356,356,1.1,1,1,"DT")
3050328
"^DD",356,356,1.1,3)
This field is populated with a value sent by the ECME pkg
"^DD",356,356,1.1,10)
ECME PACKAGE
"^DD",356,356,1.1,21,0)
^^2^2^3050328^
"^DD",356,356,1.1,21,1,0)
This is the ECME NUMBER associated with the e-Pharmacy Claim. This field 
"^DD",356,356,1.1,21,2,0)
may only be set for e-pharmacy prescriptions and refills.
"^DD",356,356,1.1,23,0)
^^7^7^3050328^
"^DD",356,356,1.1,23,1,0)
ECME NUMBER is used to link the CT record to the ECME claim. After the 
"^DD",356,356,1.1,23,2,0)
ECME package successfully submitted e-Pharmacy claim it calls IB and    
"^DD",356,356,1.1,23,3,0)
it creates the CT record accociated with the claim, whether it is rejected
"^DD",356,356,1.1,23,4,0)
by the Payer or approved. This field is especially important for the 
"^DD",356,356,1.1,23,5,0)
rejected e-Pharmacy claims, because IB does not create bills for rejects. 
"^DD",356,356,1.1,23,6,0)
The field ECME NUMBER in CT is the only means AR can recognize EOBs sent 
"^DD",356,356,1.1,23,7,0)
for rejected claims.
"^DD",356,356,1.1,"DT")
3050804
"^DD",356,356,1.11,0)
ECME REJECT^S^0:NO;1:REJECTED;2:CLOSED;^1;11^Q
"^DD",356,356,1.11,3)
Enter "REJECTED" if the e-claim was rejected by the Payer. Enter "CLOSED" if the claim was closed by OPECC.
"^DD",356,356,1.11,21,0)
^^2^2^3050328^
"^DD",356,356,1.11,21,1,0)
This field is a flag to mark ECME claims rejected by the Payer. The field 
"^DD",356,356,1.11,21,2,0)
is only meaningful if the field 1.1 "ECME NUMBER" is defined.
"^DD",356,356,1.11,23,0)
^^4^4^3050328^
"^DD",356,356,1.11,23,1,0)
This field will be set to "YES" when the ECME calls IB to report that the 
"^DD",356,356,1.11,23,2,0)
e-Pharmacy claim has been successfully submitted to the Payer, but 
"^DD",356,356,1.11,23,3,0)
rejected due to any reason. If the e-Pharmacy will be re-submitted and 
"^DD",356,356,1.11,23,4,0)
finally approved by the Payer, this field will be changed to "NO".
"^DD",356,356,1.11,"DT")
3060219
"^DD",356.8,356.8,.02,0)
ECME FLAG^S^0:NO;1:YES;^0;2^Q
"^DD",356.8,356.8,.02,3)
Enter 'Yes' if the record may be used as ECME Close Claim Reason.
"^DD",356.8,356.8,.02,21,0)
^^3^3^3050224^
"^DD",356.8,356.8,.02,21,1,0)
This field is flagging the record to be used as ECME CLOSE CLAIM REASON. 
"^DD",356.8,356.8,.02,21,2,0)
The default value is 'NO'. If the field is set to 'YES' the NON-BILLABLE 
"^DD",356.8,356.8,.02,21,3,0)
REASON will appear as an option in the ECME CLOSE CLAIM SCREEN.
"^DD",356.8,356.8,.02,"DT")
3050224
"^DD",356.8,356.8,.03,0)
ECME PAPER FLAG^S^0:NO;1:YES;^0;3^Q
"^DD",356.8,356.8,.03,3)
Enter 'YES' if the closed ECME claim may be paper-billable.
"^DD",356.8,356.8,.03,21,0)
^^7^7^3050224^
"^DD",356.8,356.8,.03,21,1,0)
This flag is related to NON-BILLABLE REASONs that are marked with 
"^DD",356.8,356.8,.03,21,2,0)
ECME FLAG to be used as ECME CLOSE CLAIM REASON. If this field
"^DD",356.8,356.8,.03,21,3,0)
'ECME PAPER FLAG' is set to 'YES', it indicates that the NON BILLABLE
"^DD",356.8,356.8,.03,21,4,0)
REASON may be potentially billable "on paper". When the ECME user (OPECC)
"^DD",356.8,356.8,.03,21,5,0)
is closing the e-Pharmacy claim and enters the NON BILLABLE REASON as a
"^DD",356.8,356.8,.03,21,6,0)
CLOSE CLAIM REASON, the additional prompt will be issued to the user -
"^DD",356.8,356.8,.03,21,7,0)
should the claim be billed "on paper"?
"^DD",356.8,356.8,.03,"DT")
3050224
**END**
**END**
