Released PSJ*5*169 SEQ #165
Extracted from mail message
**KIDS**:PSJ*5.0*169^

**INSTALL NAME**
PSJ*5.0*169
"BLD",6519,0)
PSJ*5.0*169^INPATIENT MEDICATIONS^0^3060524^y
"BLD",6519,1,0)
^^35^35^3060331^
"BLD",6519,1,1,0)
This patch will correct three problems with the Action Profile reports 
"BLD",6519,1,2,0)
from three Remedy tickets, HD118347 HD120274, and HD68707, as well as one 
"BLD",6519,1,3,0)
undefined variable error with the Patient Profile, [PSJU PR], in ticket 
"BLD",6519,1,4,0)
HD120176.
"BLD",6519,1,5,0)
 
"BLD",6519,1,6,0)
The first Action Profile Report problem was a result of internal testing 
"BLD",6519,1,7,0)
with patch PSJ*5*157, wherein it was noted that if a device used for 
"BLD",6519,1,8,0)
printing did not have a standard page length, the number of lines printed 
"BLD",6519,1,9,0)
in the Additional Medication Orders section of the Action Profile reports 
"BLD",6519,1,10,0)
[PSJU AP-1] and [PSJU AP-2] would vary from patient to patient.  It was 
"BLD",6519,1,11,0)
decided by the Inpatient Medications Workgroup that the number of lines 
"BLD",6519,1,12,0)
printed for this section should be standardized to 10 lines.
"BLD",6519,1,13,0)
 
"BLD",6519,1,14,0)
The second problem occurs only with the Action Profile 2 report, [PSJU 
"BLD",6519,1,15,0)
AP-2].  The problem only occurs if the report is printed to the screen.  
"BLD",6519,1,16,0)
The report prints properly if printed to a printer.  If the patient has a 
"BLD",6519,1,17,0)
verified allergy, a verified adverse reaction, or one of each, the 
"BLD",6519,1,18,0)
Allergy and Adverse Reaction section of the report is printing "No 
"BLD",6519,1,19,0)
Allergy Assessment".  This patch will correct this problem so the AP-2 
"BLD",6519,1,20,0)
report is consistent with the AP-1 report, and shows the correct allergy 
"BLD",6519,1,21,0)
and adverse reaction information for the patient.
"BLD",6519,1,22,0)
 
"BLD",6519,1,23,0)
The third Action Profile Report issue was logged because one-time orders 
"BLD",6519,1,24,0)
are appearing on the Action Profile-1 [PSJU AP-1]  and Action Profile-2 
"BLD",6519,1,25,0)
[PSJU AP-2] reports with the option available to the provider to RENEW 
"BLD",6519,1,26,0)
the orders.  The ability to renew one-time orders was removed due to a 
"BLD",6519,1,27,0)
patient safety issue.  Having the renew option available to the provider 
"BLD",6519,1,28,0)
could lead to a reoccurrence of the patient safety issue.
"BLD",6519,1,29,0)
 
"BLD",6519,1,30,0)
The Undefined Variable Error occurs with the Patient Profile, [PSJU PR].  
"BLD",6519,1,31,0)
When attempting to filter the profile at any WARD prompt, if the user 
"BLD",6519,1,32,0)
presses ENTER or the up-carat (^), instead of being taken to the previous 
"BLD",6519,1,33,0)
filter choices or the main menu, the user is taken to a prompt to filter 
"BLD",6519,1,34,0)
by Room/Bed or Patient.  If the user again presses ENTER or ^, an 
"BLD",6519,1,35,0)
undefined variable error occurs.
"BLD",6519,4,0)
^9.64PA^^
"BLD",6519,"KRN",0)
^9.67PA^8989.52^19
"BLD",6519,"KRN",.4,0)
.4
"BLD",6519,"KRN",.401,0)
.401
"BLD",6519,"KRN",.402,0)
.402
"BLD",6519,"KRN",.403,0)
.403
"BLD",6519,"KRN",.5,0)
.5
"BLD",6519,"KRN",.84,0)
.84
"BLD",6519,"KRN",3.6,0)
3.6
"BLD",6519,"KRN",3.8,0)
3.8
"BLD",6519,"KRN",9.2,0)
9.2
"BLD",6519,"KRN",9.8,0)
9.8
"BLD",6519,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",6519,"KRN",9.8,"NM",1,0)
PSGAPP^^0^27978328
"BLD",6519,"KRN",9.8,"NM",2,0)
PSGCAPP^^0^15658306
"BLD",6519,"KRN",9.8,"NM",3,0)
PSGCAPP0^^0^10698296
"BLD",6519,"KRN",9.8,"NM",4,0)
PSGPR^^0^41426367
"BLD",6519,"KRN",9.8,"NM",5,0)
PSGAPIV^^0^6284918
"BLD",6519,"KRN",9.8,"NM",6,0)
PSGCAPIV^^0^7632761
"BLD",6519,"KRN",9.8,"NM","B","PSGAPIV",5)

"BLD",6519,"KRN",9.8,"NM","B","PSGAPP",1)

"BLD",6519,"KRN",9.8,"NM","B","PSGCAPIV",6)

"BLD",6519,"KRN",9.8,"NM","B","PSGCAPP",2)

"BLD",6519,"KRN",9.8,"NM","B","PSGCAPP0",3)

"BLD",6519,"KRN",9.8,"NM","B","PSGPR",4)

"BLD",6519,"KRN",19,0)
19
"BLD",6519,"KRN",19.1,0)
19.1
"BLD",6519,"KRN",101,0)
101
"BLD",6519,"KRN",409.61,0)
409.61
"BLD",6519,"KRN",771,0)
771
"BLD",6519,"KRN",870,0)
870
"BLD",6519,"KRN",8989.51,0)
8989.51
"BLD",6519,"KRN",8989.52,0)
8989.52
"BLD",6519,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",6519,"KRN",8994,0)
8994
"BLD",6519,"KRN","B",.4,.4)

"BLD",6519,"KRN","B",.401,.401)

"BLD",6519,"KRN","B",.402,.402)

"BLD",6519,"KRN","B",.403,.403)

"BLD",6519,"KRN","B",.5,.5)

"BLD",6519,"KRN","B",.84,.84)

"BLD",6519,"KRN","B",3.6,3.6)

"BLD",6519,"KRN","B",3.8,3.8)

"BLD",6519,"KRN","B",9.2,9.2)

"BLD",6519,"KRN","B",9.8,9.8)

"BLD",6519,"KRN","B",19,19)

"BLD",6519,"KRN","B",19.1,19.1)

"BLD",6519,"KRN","B",101,101)

"BLD",6519,"KRN","B",409.61,409.61)

"BLD",6519,"KRN","B",771,771)

"BLD",6519,"KRN","B",870,870)

"BLD",6519,"KRN","B",8989.51,8989.51)

"BLD",6519,"KRN","B",8989.52,8989.52)

"BLD",6519,"KRN","B",8994,8994)

"BLD",6519,"QUES",0)
^9.62^^
"BLD",6519,"REQB",0)
^9.611^5^3
"BLD",6519,"REQB",3,0)
PSJ*5.0*85^1
"BLD",6519,"REQB",4,0)
PSJ*5.0*58^1
"BLD",6519,"REQB",5,0)
PSJ*5.0*149^1
"BLD",6519,"REQB","B","PSJ*5.0*149",5)

"BLD",6519,"REQB","B","PSJ*5.0*58",4)

"BLD",6519,"REQB","B","PSJ*5.0*85",3)

"MBREQ")
0
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,20,0)
^9.402P^^
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
169^3060524^33234
"PKG",203,22,1,"PAH",1,1,0)
^^35^35^3060524
"PKG",203,22,1,"PAH",1,1,1,0)
This patch will correct three problems with the Action Profile reports 
"PKG",203,22,1,"PAH",1,1,2,0)
from three Remedy tickets, HD118347 HD120274, and HD68707, as well as one 
"PKG",203,22,1,"PAH",1,1,3,0)
undefined variable error with the Patient Profile, [PSJU PR], in ticket 
"PKG",203,22,1,"PAH",1,1,4,0)
HD120176.
"PKG",203,22,1,"PAH",1,1,5,0)
 
"PKG",203,22,1,"PAH",1,1,6,0)
The first Action Profile Report problem was a result of internal testing 
"PKG",203,22,1,"PAH",1,1,7,0)
with patch PSJ*5*157, wherein it was noted that if a device used for 
"PKG",203,22,1,"PAH",1,1,8,0)
printing did not have a standard page length, the number of lines printed 
"PKG",203,22,1,"PAH",1,1,9,0)
in the Additional Medication Orders section of the Action Profile reports 
"PKG",203,22,1,"PAH",1,1,10,0)
[PSJU AP-1] and [PSJU AP-2] would vary from patient to patient.  It was 
"PKG",203,22,1,"PAH",1,1,11,0)
decided by the Inpatient Medications Workgroup that the number of lines 
"PKG",203,22,1,"PAH",1,1,12,0)
printed for this section should be standardized to 10 lines.
"PKG",203,22,1,"PAH",1,1,13,0)
 
"PKG",203,22,1,"PAH",1,1,14,0)
The second problem occurs only with the Action Profile 2 report, [PSJU 
"PKG",203,22,1,"PAH",1,1,15,0)
AP-2].  The problem only occurs if the report is printed to the screen.  
"PKG",203,22,1,"PAH",1,1,16,0)
The report prints properly if printed to a printer.  If the patient has a 
"PKG",203,22,1,"PAH",1,1,17,0)
verified allergy, a verified adverse reaction, or one of each, the 
"PKG",203,22,1,"PAH",1,1,18,0)
Allergy and Adverse Reaction section of the report is printing "No 
"PKG",203,22,1,"PAH",1,1,19,0)
Allergy Assessment".  This patch will correct this problem so the AP-2 
"PKG",203,22,1,"PAH",1,1,20,0)
report is consistent with the AP-1 report, and shows the correct allergy 
"PKG",203,22,1,"PAH",1,1,21,0)
and adverse reaction information for the patient.
"PKG",203,22,1,"PAH",1,1,22,0)
 
"PKG",203,22,1,"PAH",1,1,23,0)
The third Action Profile Report issue was logged because one-time orders 
"PKG",203,22,1,"PAH",1,1,24,0)
are appearing on the Action Profile-1 [PSJU AP-1]  and Action Profile-2 
"PKG",203,22,1,"PAH",1,1,25,0)
[PSJU AP-2] reports with the option available to the provider to RENEW 
"PKG",203,22,1,"PAH",1,1,26,0)
the orders.  The ability to renew one-time orders was removed due to a 
"PKG",203,22,1,"PAH",1,1,27,0)
patient safety issue.  Having the renew option available to the provider 
"PKG",203,22,1,"PAH",1,1,28,0)
could lead to a reoccurrence of the patient safety issue.
"PKG",203,22,1,"PAH",1,1,29,0)
 
"PKG",203,22,1,"PAH",1,1,30,0)
The Undefined Variable Error occurs with the Patient Profile, [PSJU PR].  
"PKG",203,22,1,"PAH",1,1,31,0)
When attempting to filter the profile at any WARD prompt, if the user 
"PKG",203,22,1,"PAH",1,1,32,0)
presses ENTER or the up-carat (^), instead of being taken to the previous 
"PKG",203,22,1,"PAH",1,1,33,0)
filter choices or the main menu, the user is taken to a prompt to filter 
"PKG",203,22,1,"PAH",1,1,34,0)
by Room/Bed or Patient.  If the user again presses ENTER or ^, an 
"PKG",203,22,1,"PAH",1,1,35,0)
undefined variable error occurs.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PSGAPIV")
0^5^B6284918^B5508192
"RTN","PSGAPIV",1,0)
PSGAPIV ;BIR/MV-ACTION PROFILE #1 IV ORDERS ;07 Apr 98 / 1:10 PM
"RTN","PSGAPIV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**9,58,169**;16 DEC 97
"RTN","PSGAPIV",3,0)
 ;
"RTN","PSGAPIV",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGAPIV",5,0)
 ;
"RTN","PSGAPIV",6,0)
START ;
"RTN","PSGAPIV",7,0)
 NEW P,ON,DRG S ON=""
"RTN","PSGAPIV",8,0)
 F PSGEXPDT=PSGDT:0 S PSGEXPDT=$O(^PS(55,PSGP,"IV","AIT",PST,PSGEXPDT)) Q:'PSGEXPDT  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGEXPDT,ON)) Q:ON=""  D IV
"RTN","PSGAPIV",9,0)
 Q
"RTN","PSGAPIV",10,0)
IV ;
"RTN","PSGAPIV",11,0)
 N X,ON55 S DFN=PSGP D GT55^PSIVORFB
"RTN","PSGAPIV",12,0)
 I STP'=9999999\1,(P(2)>STP) Q
"RTN","PSGAPIV",13,0)
 Q:"DE"[P(17)
"RTN","PSGAPIV",14,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGAPIV",15,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGAPIV",16,0)
 I QST'="O" S QST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGAPIV",17,0)
 I DRG S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),DRG=$S(P(4)="H":"* TPN *",1:$E($$ENPDN^PSGMI($P(X,U,6)),1,20))
"RTN","PSGAPIV",18,0)
 S ^TMP($J,$E(PSGAPWDN,1,20),TM,PN,QST_U_DRG,ON_"V")=""
"RTN","PSGAPIV",19,0)
 Q
"RTN","PSGAPIV",20,0)
PRT(ON) ;*** Print IV on Action Profile #1.
"RTN","PSGAPIV",21,0)
 NEW TYPE S TYPE=$P(DRG,U),ON=+ON
"RTN","PSGAPIV",22,0)
 N ON55,DRG,P,PRTST S DFN=PSGP,PRTST=1 D GT55^PSIVORFB
"RTN","PSGAPIV",23,0)
 F X=2,3 S:P(X) P(X)=$E($$ENDTC^PSGMI(P(X)),1,5)
"RTN","PSGAPIV",24,0)
 S PSJSI=$$ENSET^PSGSICHK($P(P("OPI"),"^"))
"RTN","PSGAPIV",25,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGAPIV",26,0)
 I QST'="O" S QST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGAPIV",27,0)
 W !,$J(N,3),$S(QST="O":"   ",1:"  R")_" D N "  ;PSJ*5*169 Don't allow RENEW on one-time orders.
"RTN","PSGAPIV",28,0)
 I '$D(DRG("AD",0)) D PRTST W !
"RTN","PSGAPIV",29,0)
 I $O(DRG("AD",0)) F X=0:0 S X=$O(DRG("AD",X)) Q:'X  W ?11,$$WRTDRG^PSIVUTL(DRG("AD",X),41) D:X=1 PRTST D NP("AD") G:$G(PSJDLW) EXIT W !
"RTN","PSGAPIV",30,0)
 W ?11,"in "
"RTN","PSGAPIV",31,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D:X>1 NP("SOL") W:X>1 ! W ?14,$$WRTDRG^PSIVUTL(DRG("SOL",X),41) G:$G(PSJDLW) EXIT
"RTN","PSGAPIV",32,0)
 W:P(9)]"" " " W P(9)," ",P(8) D:'$G(DRG("AD",1))&PRTST PRTST
"RTN","PSGAPIV",33,0)
 I PSJSI]"" W !?11,"Special Instructions: " F Y=1:1:$L(PSJSI," ") S Y1=$P(PSJSI," ",Y) W:($L(Y1)+$X)>79 !?33 W Y1_" "
"RTN","PSGAPIV",34,0)
 W !
"RTN","PSGAPIV",35,0)
 Q
"RTN","PSGAPIV",36,0)
PRTST ;*** Print the rest of the 1st line.
"RTN","PSGAPIV",37,0)
 W:PRTST ?52,TYPE,?55,P(2),?61,P(3),?67,P(17)
"RTN","PSGAPIV",38,0)
 S PRTST=0
"RTN","PSGAPIV",39,0)
 Q
"RTN","PSGAPIV",40,0)
NP(TYPE) ;
"RTN","PSGAPIV",41,0)
 NEW X
"RTN","PSGAPIV",42,0)
 D:DRG(TYPE,0)>1&($Y+11>IOSL) NP^PSGAPP
"RTN","PSGAPIV",43,0)
 Q
"RTN","PSGAPIV",44,0)
EXIT ;
"RTN","PSGAPIV",45,0)
 Q
"RTN","PSGAPP")
0^1^B27978328^B25259233
"RTN","PSGAPP",1,0)
PSGAPP ;BIR/CML3-PRINT DATA FOR ACTION PROFILE ;05 Oct 98 / 10:36 AM
"RTN","PSGAPP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,20,60,50,111,169**;16 DEC 97
"RTN","PSGAPP",3,0)
 ;
"RTN","PSGAPP",4,0)
LOOP ;
"RTN","PSGAPP",5,0)
 D NOW^%DTC S PSGDT=%,DT=$$DT^XLFDT,PSGPDT=$$ENDTC2^PSGMI(PSGDT),CML=IO'=IO(0)!($E(IOST,1,2)'="C-")
"RTN","PSGAPP",6,0)
 U IO I '$D(^TMP($J)) W:$Y @IOF W !?28,"UNIT DOSE ACTION PROFILE",?62,PSGPDT,!?10,"NO ACTIVE ORDERS FOUND FOR ",$S(PSGSS="G":"WARD GROUP: "_PSGAPWGN,PSGSS="W":"WARD: "_PSGAPWDN,1:"PATIENT(S) SELECTED"),"." G DONE
"RTN","PSGAPP",7,0)
 S PSGVAMC=$$SITE^PSGMMAR2(80)
"RTN","PSGAPP",8,0)
 S (LN,LINE,ALN)="",$P(LN,"_",19)="",$P(LINE,"-",81)="",$P(ALN," -",18)="",ALN=ALN_" A C T I V E"_ALN
"RTN","PSGAPP",9,0)
 S (PN,WD,TM)="" F  S WD=$O(^TMP($J,WD)) Q:WD=""!$D(PSJDLW)  F  S TM=$O(^TMP($J,WD,TM)) Q:TM=""!$D(PSJDLW)  F  S PN=$O(^TMP($J,WD,TM,PN)) Q:PN=""!$D(PSJDLW)  D
"RTN","PSGAPP",10,0)
 . ;naked reference on line below refers to the full reference on the line above
"RTN","PSGAPP",11,0)
 . S PI=$G(^(PN)),AMO=0 S:PI="" PI=$G(^TMP($J,WD,"zz",PN)) D H1
"RTN","PSGAPP",12,0)
 ;
"RTN","PSGAPP",13,0)
DONE ;
"RTN","PSGAPP",14,0)
 W:CML&($Y) @IOF K AD,ALN,AMO,CML,DF,LINE,LN,MF,N,PG,PI,PPN,PSGPDT,RCT,RF,PID,TD,TM,WD,PSJDLW,PSJTEAM,PSGVAMC,PSJCNTR,PSJAMO Q
"RTN","PSGAPP",15,0)
 ;
"RTN","PSGAPP",16,0)
H1 ;
"RTN","PSGAPP",17,0)
 Q:$D(PSJDLW)
"RTN","PSGAPP",18,0)
 I $E(IOST,1)="C" K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DTOUT)!$D(DUOUT) PSJDLW=1 I $D(DTOUT)!$D(DUOUT) Q
"RTN","PSGAPP",19,0)
 S (N,DF)=0,PSEX=$P(PI,"^"),PDOB=$P(PI,"^",2),PID=$P(PI,"^",3),RB=$P(PI,"^",5),AD=$P(PI,"^",6),TD=$P(PI,"^",7),WT=$P(PI,"^",8),PI=$P(PI,"^",4),PPN=$P(PN,"^",2),(DFN,PSGP)=$P(PN,"^",3)
"RTN","PSGAPP",20,0)
 S PAGE=$P(PDOB,";",2),PDOB=$P(PDOB,";"),PG=1 W:$Y @IOF W !?26,"UNIT DOSE ACTION PROFILE #1",?62,PSGPDT
"RTN","PSGAPP",21,0)
 W !?+PSGVAMC,$P(PSGVAMC,U,2)
"RTN","PSGAPP",22,0)
 W !?23,"(Continuation of VA FORM 10-1158)",?72,"Page: 1",!,LINE
"RTN","PSGAPP",23,0)
 W !,"   This form is to be used to REVIEW/RENEW/CANCEL existing active medication",!," orders for inpatients.  Review the active orders listed and beside"
"RTN","PSGAPP",24,0)
 W " each order",!," circle one of the following:",!?30,"R - to RENEW the order",!?30,"D - to DISCONTINUE the order",!?30,"N - to take NO ACTION (the order will remain",!?34,"active until the stop date indicated)"
"RTN","PSGAPP",25,0)
 W !!,"   A new order must be written for any new medication or to make any changes",!," in dosage or directions on an existing order.",!,LINE,!
"RTN","PSGAPP",26,0)
 S PSJOPC="" D ENTRY^PSJHEAD(DFN,PSJOPC,PG,$G(PSJNARC),$G(PSJTEAM,1),1)
"RTN","PSGAPP",27,0)
 W !,LINE,!," No. Action",?16,"Drug",?52,"ST Start Stop  Status/Info",!,ALN
"RTN","PSGAPP",28,0)
END ;
"RTN","PSGAPP",29,0)
 S (ON,DRG)="" F  S DRG=$O(^TMP($J,WD,TM,PN,DRG)) Q:DRG=""  F  S ON=$O(^TMP($J,WD,TM,PN,DRG,ON)) Q:ON=""  S ND=^(ON),SI=$G(^(ON,1)) D NP:$Y+11>IOSL Q:$D(PSJDLW)  D ORDP
"RTN","PSGAPP",30,0)
 Q:$D(PSJDLW)
"RTN","PSGAPP",31,0)
 I $D(^PS(53.1,"AC",PSGP)) W !!?13,"******** THIS PATIENT HAS NON-VERIFIED ORDERS. ********"
"RTN","PSGAPP",32,0)
 S DF=1 W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGAPP",33,0)
 D:$Y+11>IOSL NP1 W:'$D(PSJDLW) !!!?10,"MULTIDISCIPLINARY REVIEW",!?16,"(WHEN APPROPRIATE)",?40,LN_LN,!?40,"PHARMACIST'S SIGNATURE"
"RTN","PSGAPP",34,0)
 D:$Y+7>IOSL NP1 W:'$D(PSJDLW) !!?40,LN_LN,!?40,"NURSE'S SIGNATURE"
"RTN","PSGAPP",35,0)
 ; PSJ*5*169 Standardize AMO section to 10 lines.
"RTN","PSGAPP",36,0)
 N PSJCNTR,PSJAMO
"RTN","PSGAPP",37,0)
 I IOSL-$Y>11 D
"RTN","PSGAPP",38,0)
 . W !!?3,"ADDITIONAL MEDICATION ORDERS:"
"RTN","PSGAPP",39,0)
 . F PSJCNTR=1:1:10 W !!,LINE S PSJAMO=0 I $Y+9>IOSL S PSJAMO=1 D NP1
"RTN","PSGAPP",40,0)
 . S AMO=1
"RTN","PSGAPP",41,0)
 I  W !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE",!
"RTN","PSGAPP",42,0)
 E  I $Y+6<IOSL F Q=$Y+5:1:IOSL-1 W !
"RTN","PSGAPP",43,0)
 W:'$D(PSJDLW) !?2,PPN,?40,PID,?78-$L(PDOB),PDOB
"RTN","PSGAPP",44,0)
 ; PSJ*5*169 Standardize AMO section to 10 lines.
"RTN","PSGAPP",45,0)
 I 'AMO D
"RTN","PSGAPP",46,0)
 .S AMO=1 D NP1 Q:$D(PSJDLW)  D
"RTN","PSGAPP",47,0)
 . . W !!?3,"ADDITIONAL MEDICATION ORDERS:"
"RTN","PSGAPP",48,0)
 . . F PSJCNTR=1:1:10 W !!,LINE S PSJAMO=0 I $Y+9>IOSL S PSJAMO=1 D NP1
"RTN","PSGAPP",49,0)
 .W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE",!
"RTN","PSGAPP",50,0)
 .W:'$D(PSJDLW) !?2,PPN,?40,PID,?78-$L(PDOB),PDOB
"RTN","PSGAPP",51,0)
 Q
"RTN","PSGAPP",52,0)
 ;
"RTN","PSGAPP",53,0)
ORDP ;
"RTN","PSGAPP",54,0)
 S N=N+1 I ND="" D PRT^PSGAPIV(ON) Q
"RTN","PSGAPP",55,0)
 N X,PSG S PSGP=$P(PN,U,3)
"RTN","PSGAPP",56,0)
 D DRGDISP^PSJLMUT1(+PSGP,+ON_"U",39,65,.PSG,0)
"RTN","PSGAPP",57,0)
 S SM=$P(ND,"^",5),NF=$P(ND,"^",6) W !,$J(N,3) W $S($P(DRG,"^")="O":"   ",1:"  R")_" D N "  ;PSJ*5*169 Don't allow RENEW for one-time orders.
"RTN","PSGAPP",58,0)
 W PSG(1),?52,$P(DRG,U),?55,$P(ND,U,2),?61,$P(ND,U,3),?67,$P(ND,U) I NF!SM!$P(ND,U,4) W ?71 W:NF "NF " W:$P(ND,U,4) "WS " W:SM $E("HSM",SM,3)
"RTN","PSGAPP",59,0)
 N X F X=1:0 S X=$O(PSG(X)) Q:'X  W !?11,PSG(X)
"RTN","PSGAPP",60,0)
 I SI]"" W !?11,"Special Instructions: " F X=1:1:$L(SI," ") S Y=$P(SI," ",X) W:$X+$L(Y)>78 !?35 W Y," "
"RTN","PSGAPP",61,0)
 W ! Q
"RTN","PSGAPP",62,0)
 ;
"RTN","PSGAPP",63,0)
NP ;
"RTN","PSGAPP",64,0)
 Q:$G(PSJDLW)
"RTN","PSGAPP",65,0)
 W !!?16,LN,?40,LN_LN,!?16,"Date and Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGAPP",66,0)
 ;
"RTN","PSGAPP",67,0)
NP1 ;
"RTN","PSGAPP",68,0)
 Q:$D(PSJDLW)
"RTN","PSGAPP",69,0)
 I $E(IOST,1)="C" K DIR S DIR(0)="E" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S PSJDLW=1 Q
"RTN","PSGAPP",70,0)
 I $Y+5<IOSL F Q=$Y:1:IOSL-4 W !
"RTN","PSGAPP",71,0)
 S PG=PG+1 W:'AMO !?2,PPN,?40,PID,?78-$L(PDOB),PDOB W:$Y @IOF W !?26,"UNIT DOSE ACTION PROFILE #1",?73-$L(PG),"Page: "_PG
"RTN","PSGAPP",72,0)
 W !?+PSGVAMC,$P(PSGVAMC,U,2)
"RTN","PSGAPP",73,0)
 W !?1,PPN,?40,PID,?60,PDOB
"RTN","PSGAPP",74,0)
 ; PSJ*5*169 Standardize AMO section to 10 lines.
"RTN","PSGAPP",75,0)
 I DF D  Q
"RTN","PSGAPP",76,0)
 . I $G(PSJAMO)=1 W !!,"ADDITIONAL MEDICATION ORDERS (CONTINUED):",! Q
"RTN","PSGAPP",77,0)
 . W !!,LINE
"RTN","PSGAPP",78,0)
 W:'AMO !!," No. Action",?16,"Drug",?52,"ST Start Stop  Status/Info",!,ALN Q
"RTN","PSGAPP",79,0)
 ;
"RTN","PSGAPP",80,0)
ENRCT ;
"RTN","PSGAPP",81,0)
 N DFN,GMRA,GMRAL,RCT,X S DFN=PSGP,GMRA="0^0^111" D EN1^GMRADPT
"RTN","PSGAPP",82,0)
 S X=0 F  S X=$O(GMRAL(X)) Q:'X  I $P(GMRAL(X),"^",2)]"" S RCT($P(GMRAL(X),"^",2))=""
"RTN","PSGAPP",83,0)
 I '$D(RCT) W " ____________________" Q
"RTN","PSGAPP",84,0)
 S RCT="" F X=0:1 S RCT=$O(RCT(RCT)) Q:RCT=""  W:X "," W:$X+$L(RCT)>77 ! W " ",$S(RCT="NKA":"No Known Allergies",1:RCT)
"RTN","PSGAPP",85,0)
 Q
"RTN","PSGCAPIV")
0^6^B7632761^B7164579
"RTN","PSGCAPIV",1,0)
PSGCAPIV ;BIR/MV-ACTION PROFILE #2 IV ORDERS ;07 Apr 98 / 1:10 PM
"RTN","PSGCAPIV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**9,58,169**;16 DEC 97
"RTN","PSGCAPIV",3,0)
 ;
"RTN","PSGCAPIV",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231
"RTN","PSGCAPIV",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173
"RTN","PSGCAPIV",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGCAPIV",7,0)
 ;
"RTN","PSGCAPIV",8,0)
START ;
"RTN","PSGCAPIV",9,0)
 NEW P,ON,DRG S ON=""
"RTN","PSGCAPIV",10,0)
 ;* S:PSGSS'="P" PSGDT=PSGAPSD-.0001 S:PSGSS="P" STP=9999999
"RTN","PSGCAPIV",11,0)
 S PSGDT=PSGAPSD-.0001
"RTN","PSGCAPIV",12,0)
 F PSGEXPDT=PSGDT:0 S PSGEXPDT=$O(^PS(55,PSGP,"IV","AIT",PST,PSGEXPDT)) Q:$S('PSGEXPDT:1,PSGAPO="E":PSGEXPDT>PSGAPFD,1:0)  F  S ON=$O(^PS(55,PSGP,"IV","AIT",PST,PSGEXPDT,ON)) Q:ON=""  D IV
"RTN","PSGCAPIV",13,0)
 Q
"RTN","PSGCAPIV",14,0)
IV ;
"RTN","PSGCAPIV",15,0)
 N X,ON55 S DFN=PSGP D GT55^PSIVORFB
"RTN","PSGCAPIV",16,0)
 Q:"DE"[P(17)
"RTN","PSGCAPIV",17,0)
 S X=$P(P("MR"),U,2) Q:XTYPE=2&(X["IV")  Q:XTYPE=3&(PST="S")&'($S(X="IV":1,X="IVPB":1,1:0))
"RTN","PSGCAPIV",18,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGCAPIV",19,0)
 I QST'="O" S QST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGCAPIV",20,0)
 I DRG S X=$S($G(DRG("AD",1)):DRG("AD",1),1:$G(DRG("SOL",1))),DRG=$S(P(4)="H":"* TPN *",1:$E($$ENPDN^PSGMI($P(X,U,6)),1,20))
"RTN","PSGCAPIV",21,0)
 S ^TMP($J,S1,PSGAPWDN,PN,QST_U_$E(DRG,1,20),ON_"V")=""
"RTN","PSGCAPIV",22,0)
 Q
"RTN","PSGCAPIV",23,0)
PRT(ON) ;*** Print IV orders.
"RTN","PSGCAPIV",24,0)
 NEW TYPE S TYPE=$P(DRG,U),ON=+ON,DCU=0
"RTN","PSGCAPIV",25,0)
 N ON55,DRG,P,PRTST S DFN=PSGP,PRTST=1 D GT55^PSIVORFB
"RTN","PSGCAPIV",26,0)
 F X=2,3 S:P(X) P(X)=$E($$ENDTC^PSGMI(P(X)),1,5)
"RTN","PSGCAPIV",27,0)
 S PSJSI=$$ENSET^PSGSICHK($P(P("OPI"),"^"))
"RTN","PSGCAPIV",28,0)
 ;PSJ*5*169 Set QST so one-time orders will not allow RENEW on report.
"RTN","PSGCAPIV",29,0)
 N QST
"RTN","PSGCAPIV",30,0)
 S QST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3))
"RTN","PSGCAPIV",31,0)
 I QST'="O" S QST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGCAPIV",32,0)
 W !,$J(N,3)
"RTN","PSGCAPIV",33,0)
 I '$O(DRG("AD",0)) D PRTST W !
"RTN","PSGCAPIV",34,0)
 I $O(DRG("AD",0)) F X=0:0 S X=$O(DRG("AD",X)) Q:'X  W ?5,$$WRTDRG^PSIVUTL(DRG("AD",X),41) D:X=1 PRTST D DCU("AD",X),NP("AD") G:$G(PSJDLW) EXIT W !
"RTN","PSGCAPIV",35,0)
 W ?5,"in "
"RTN","PSGCAPIV",36,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D:X>1 NP("SOL") W:X>1 ! W ?8,$$WRTDRG^PSIVUTL(DRG("SOL",X),41) D DCU("SOL",X) G:$G(PSJDLW) EXIT
"RTN","PSGCAPIV",37,0)
 W:P(9)]"" " " W P(9)," ",P(8) D:'$G(DRG("AD",1))&PRTST PRTST
"RTN","PSGCAPIV",38,0)
 I PSJSI]"" W !?5,"Special Instructions: " F Y=1:1:$L(PSJSI," ") S Y1=$P(PSJSI," ",Y) W:($L(Y1)+$X)>79 !?27 W Y1_" "
"RTN","PSGCAPIV",39,0)
 W ! D ORDP1^PSGCAPP
"RTN","PSGCAPIV",40,0)
 Q
"RTN","PSGCAPIV",41,0)
PRTST ;*** Print the rest of the 1st line.
"RTN","PSGCAPIV",42,0)
 W:PRTST ?46,TYPE,?49,P(2),?55,P(3),?61,P(17)
"RTN","PSGCAPIV",43,0)
 S PRTST=0
"RTN","PSGCAPIV",44,0)
 Q
"RTN","PSGCAPIV",45,0)
NP(TYPE) ;*** Print end line after order.
"RTN","PSGCAPIV",46,0)
 NEW X
"RTN","PSGCAPIV",47,0)
 D:DRG(TYPE,0)>1&($Y+11>IOSL) NP^PSGCAPP
"RTN","PSGCAPIV",48,0)
 Q
"RTN","PSGCAPIV",49,0)
DCU(TYPE,X) ;*** Calculate drug cost.
"RTN","PSGCAPIV",50,0)
 NEW COST
"RTN","PSGCAPIV",51,0)
 S:TYPE="AD" COST=$P(^PS(52.6,+DRG(TYPE,X),0),U,7)
"RTN","PSGCAPIV",52,0)
 S:TYPE="SOL" COST=$P(^PS(52.7,+DRG(TYPE,X),0),U,7)
"RTN","PSGCAPIV",53,0)
 S DCU=DCU+(COST*+$P(DRG(TYPE,X),U,3))
"RTN","PSGCAPIV",54,0)
 Q
"RTN","PSGCAPIV",55,0)
EXIT ;
"RTN","PSGCAPIV",56,0)
 Q
"RTN","PSGCAPP")
0^2^B15658306^B13989426
"RTN","PSGCAPP",1,0)
PSGCAPP ;BIR/CML3-PRINT DATA FOR ACTION PROFILE ;05 Oct 98 / 10:21 AM
"RTN","PSGCAPP",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,20,60,111,149,169**;16 DEC 97
"RTN","PSGCAPP",3,0)
LOOP ;
"RTN","PSGCAPP",4,0)
 D NOW^%DTC S PSGDT=%,PSGPDT=$$ENDTC2^PSGMI(PSGDT),CML=IO'=IO(0)!($E(IOST,1,2)'="C-")
"RTN","PSGCAPP",5,0)
 U IO I '$D(^TMP($J)) D  G DONE
"RTN","PSGCAPP",6,0)
 .W:$Y @IOF W !?26,"UNIT DOSE ACTION PROFILE #2",?62,PSGPDT,!?10,"NO ",$S(PSGAPO="E":"EXPIRING",1:"ACTIVE")," ORDERS FOUND FOR ",$S(PSGSS="G":"WARD GROUP: "_PSGAPWGN,PSGSS="W":"WARD: "_PSGAPWDN,1:"PATIENT(S) SELECTED"),"."
"RTN","PSGCAPP",7,0)
 S (LN,LINE,ALN,S1,WD,PN)="",$P(LN,"_",19)="",$P(LINE,"-",81)="",$P(ALN," -",18)="",ALN=ALN_" A C T I V E"_ALN
"RTN","PSGCAPP",8,0)
 S PSGVAMC=$$SITE^PSGMMAR2(80)
"RTN","PSGCAPP",9,0)
 F  S (PS1,S1,PSJTEAM)=$O(^TMP($J,S1)) Q:S1=""!$D(PSJDLW)  S:S1="zz" (PS1,PSJTEAM)="NOT FOUND" F  S WD=$O(^TMP($J,S1,WD)) Q:WD=""!$D(PSJDLW)  D
"RTN","PSGCAPP",10,0)
 . F  S PN=$O(^TMP($J,S1,WD,PN)) Q:PN=""!$D(PSJDLW)  S PI=$G(^(PN)) S:PI="" PI=$G(^TMP($J,S1,"zz",PN)) D H1
"RTN","PSGCAPP",11,0)
 ;
"RTN","PSGCAPP",12,0)
DONE ;PSJ*5*149 Add WD1 to killed variables.
"RTN","PSGCAPP",13,0)
 W:CML&($Y) @IOF K AD,ALN,CML,DF,LINE,LN,MF,N,PG,PI,PPN,PS1,PSGPDT,RCT,RF,PID,TD,WD,PSJDLW,PSGVAMC,WD1,PSJCNTR,PSJAMO Q
"RTN","PSGCAPP",14,0)
 ;
"RTN","PSGCAPP",15,0)
H1 ; first header for patient
"RTN","PSGCAPP",16,0)
 ; PSJ*5*149 Use WD1 to preserve value of WD
"RTN","PSGCAPP",17,0)
 N WD1
"RTN","PSGCAPP",18,0)
 I $G(WD)="zz" S WD1=WD N WD S WD="*NF*"
"RTN","PSGCAPP",19,0)
 D ^PSGCAPP0
"RTN","PSGCAPP",20,0)
 S WD=$G(WD1,WD)
"RTN","PSGCAPP",21,0)
END ;
"RTN","PSGCAPP",22,0)
 S (ON,DRG)="" F  S DRG=$O(^TMP($J,S1,WD,PN,DRG)) Q:DRG=""  F  S ON=$O(^TMP($J,S1,WD,PN,DRG,ON)) Q:ON=""  S ND=^(ON),SI=$G(^(ON,1)) D NP:$Y+12>IOSL Q:$D(PSJDLW)  D ORDP
"RTN","PSGCAPP",23,0)
 Q:$D(PSJDLW)
"RTN","PSGCAPP",24,0)
 I $D(^PS(53.1,"AC",PSGP)) W !!?13,"******** THIS PATIENT HAS NON-VERIFIED ORDERS. ********"
"RTN","PSGCAPP",25,0)
 S DF=1 W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGCAPP",26,0)
 D:$Y+10>IOSL NP1 W:'$D(PSJDLW) !!!?10,"MULTIDISCIPLINARY REVIEW",!?16,"(WHEN APPROPRIATE)",?40,LN_LN,!?40,"PHARMACIST'S SIGNATURE"
"RTN","PSGCAPP",27,0)
 D:$Y+6>IOSL NP1 W:'$D(PSJDLW) !!?40,LN_LN,!?40,"NURSE'S SIGNATURE"
"RTN","PSGCAPP",28,0)
 ; PSJ*5*169 Standardize AMO section to 10 lines.
"RTN","PSGCAPP",29,0)
 N PSJCNTR,PSJAMO
"RTN","PSGCAPP",30,0)
 I IOSL-$Y>10 D
"RTN","PSGCAPP",31,0)
 . W !!?3,"ADDITIONAL MEDICATION ORDERS:"
"RTN","PSGCAPP",32,0)
 . F PSJCNTR=1:1:10 W !!,LINE S PSJAMO=0 I $Y+9>IOSL S PSJAMO=1 D NP1
"RTN","PSGCAPP",33,0)
 I  W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE",!
"RTN","PSGCAPP",34,0)
 E  F Q=$Y+5:1:IOSL-1 W !
"RTN","PSGCAPP",35,0)
 W:'$D(PSJDLW) !?2,PPN,?40,PID,?78-$L(PDOB),PDOB Q
"RTN","PSGCAPP",36,0)
 ;
"RTN","PSGCAPP",37,0)
ORDP ;
"RTN","PSGCAPP",38,0)
 S N=N+1 I ON["V" D PRT^PSGCAPIV(ON) Q
"RTN","PSGCAPP",39,0)
 N X,PSG S PSGP=$P(PN,U,2)
"RTN","PSGCAPP",40,0)
 D DRGDISP^PSJLMUT1(+PSGP,+ON_"U",39,69,.PSG,0)
"RTN","PSGCAPP",41,0)
 S SM=$P(ND,"^",5),NF=$P(ND,"^",6),DCU=$P(ND,"^",7),DCU=$S($E(DCU)=".":"0"_DCU,'DCU:"0.00",1:DCU) W !,$J(N,3)
"RTN","PSGCAPP",42,0)
 W ?5,PSG(1),?46,$P(DRG,"^"),?49,$P(ND,"^",2),?55,$P(ND,"^",3),?61,$P(ND,"^") I NF!SM!$P(ND,"^",4) W ?65 W:NF "NF " W:$P(ND,"^",4) "WS " W:SM $E("HSM",SM,3)
"RTN","PSGCAPP",43,0)
 N X F X=1:0 S X=$O(PSG(X)) Q:'X  W !?5,PSG(X)
"RTN","PSGCAPP",44,0)
 I SI]"" W !?8,"Special Instructions: " F X=1:1:$L(SI," ") S Y=$P(SI," ",X) W:$X+$L(Y)>78 !?31 W Y," "
"RTN","PSGCAPP",45,0)
ORDP1 ;*** Also being called from ^PSGCAPIV.   PSJ*5*169 Don't allow RENEW on one-time orders.
"RTN","PSGCAPP",46,0)
 W !!?5,"__TAKE NO ACTION     __DISCONTINUE     "_$S($P(DRG,"^")="O"!($G(QST)="O"):"       ",1:"__RENEW")_"   COST/DOSE: ",DCU,!?2,"------------------------------------------------------------------------",! Q
"RTN","PSGCAPP",47,0)
 ;
"RTN","PSGCAPP",48,0)
NP ;
"RTN","PSGCAPP",49,0)
 W:'$D(PSJDLW) !!?16,LN,?40,LN_LN,!?16,"Date AND Time",?40,"PROVIDER'S SIGNATURE"
"RTN","PSGCAPP",50,0)
 ;
"RTN","PSGCAPP",51,0)
NP1 ;
"RTN","PSGCAPP",52,0)
 Q:$D(PSJDLW)
"RTN","PSGCAPP",53,0)
 I $E(IOST,1)="C" K DIR S DIR(0)="E" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S PSJDLW=1 Q
"RTN","PSGCAPP",54,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSGCAPP",55,0)
 ;* S PG=PG+1 W !?2,PPN,?40,PID,?78-$L(PDOB),PDOB W:$Y @IOF W !?28,"UNIT DOSE ACTION PROFILE #2",?73-$L(PG),"Page: "_PG,!?1,PPN,?40,PID,?60,PDOB I DF W !!,LINE Q
"RTN","PSGCAPP",56,0)
 S PG=PG+1 W !?2,PPN,?40,PID,?78-$L(PDOB),PDOB W:$Y @IOF
"RTN","PSGCAPP",57,0)
 W !?26,"UNIT DOSE ACTION PROFILE #2",?73-$L(PG),"Page: "_PG
"RTN","PSGCAPP",58,0)
 W !?+PSGVAMC,$P(PSGVAMC,U,2)
"RTN","PSGCAPP",59,0)
 W !?1,PPN,?40,PID,?60,PDOB
"RTN","PSGCAPP",60,0)
 I DF D  Q
"RTN","PSGCAPP",61,0)
 . I $G(PSJAMO)=1 W !!,"ADDITIONAL MEDICATION ORDERS (CONTINUED):",! Q
"RTN","PSGCAPP",62,0)
 . W !!,LINE
"RTN","PSGCAPP",63,0)
 W !!," No. Action",?16,"Drug",?46,"ST Start Stop  Status/Info",!,ALN
"RTN","PSGCAPP",64,0)
 Q
"RTN","PSGCAPP0")
0^3^B10698296^B10374131
"RTN","PSGCAPP0",1,0)
PSGCAPP0 ;BIR/CML3-PRINT DATA FOR ACTION PROFILE CONT. ;01 Feb 99 / 8:48 AM
"RTN","PSGCAPP0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**8,20,85,169**;16 DEC 97
"RTN","PSGCAPP0",3,0)
 ;
"RTN","PSGCAPP0",4,0)
H1 ; first header for patient
"RTN","PSGCAPP0",5,0)
 I $E(IOST,1)="C" K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DTOUT)!$D(DUOUT) PSJDLW=1 I $D(DTOUT)!$D(DUOUT) Q
"RTN","PSGCAPP0",6,0)
 S (N,DF)=0,PSEX=$P(PI,"^"),PDOB=$P(PI,"^",2),PID=$P(PI,"^",3),RB=$P(PI,"^",5),AD=$P(PI,"^",6),TD=$P(PI,"^",7),WT=$P(PI,"^",8),WTD=$P(PI,"^",9),HT=$P(PI,"^",10),HTD=$P(PI,"^",11),PPN=$P(PI,"^",12),PI=$P(PI,"^",4),PSGP=$P(PN,"^",2)
"RTN","PSGCAPP0",7,0)
 S PAGE=$P(PDOB,";",2),PDOB=$P(PDOB,";"),PG=1
"RTN","PSGCAPP0",8,0)
 W:$Y @IOF W !?26,"UNIT DOSE ACTION PROFILE #2",?62,PSGPDT,!?+PSGVAMC,$P(PSGVAMC,U,2),!?23,"(Continuation of VA FORM 10-1158)",?72,"Page: 1",!,LINE
"RTN","PSGCAPP0",9,0)
 W !,"   A new order must be written for any new medication or to make any changes",!," in dosage or directions on an existing order.",!,LINE
"RTN","PSGCAPP0",10,0)
 W !?32-(PSGAPS="P"*13),$S(PSGAPS="T":"Team: ",1:"Treating Provider: "),PS1,!?1,PPN,?32,"Ward: "_WD,!?4,"PID: "_PID W:'PSJPDD ?28 W:PSJPDD ?23,"Last " W "Room-Bed: ",RB,?53,"Ht(cm): ",HT," ",HTD
"RTN","PSGCAPP0",11,0)
 W !?4,"DOB: "_PDOB_"  ("_PAGE_")",?53,"Wt(kg): "_WT," ",WTD
"RTN","PSGCAPP0",12,0)
 W !?4,"Sex: "_PSEX,?51,"Admitted: "_AD
"RTN","PSGCAPP0",13,0)
 ;
"RTN","PSGCAPP0",14,0)
 W !?5,"Dx: "_PI W:TD ?43,"Last Transferred: "_TD
"RTN","PSGCAPP0",15,0)
 ;
"RTN","PSGCAPP0",16,0)
 S PSGP=$P(PN,U,2) S:PSGP=$G(PSGPTMP) PPAGE=PPAGE+1 I PSGP'=$G(PSGPTMP) S PSGPTMP=PSGP,PPAGE=1
"RTN","PSGCAPP0",17,0)
 S ALFLG=0 D ATS^PSJMUTL(68,68,2)
"RTN","PSGCAPP0",18,0)
 ; PSJ*5*169 Make the allergy/ADR algorithm consistent with one used in PSJHEAD for AP-1 report.
"RTN","PSGCAPP0",19,0)
 W !?1,"Allergies: " D:PSGALG+PSGVALG+PSGADR+PSGVADR=0 NONE I PSGALG+PSGVALG+PSGADR_PSGVADR>0 D ALG^PSJHEAD,ADR^PSJHEAD I ALFLG D
"RTN","PSGCAPP0",20,0)
 .W "See patient's first ",$S($E(IOST)="C":"screen",1:"page")," for Allergies/Adverse Reactions"
"RTN","PSGCAPP0",21,0)
 W !,LINE,!,"No. Action",?16,"Drug",?46,"ST Start Stop  Status/Info",!,ALN
"RTN","PSGCAPP0",22,0)
 Q
"RTN","PSGCAPP0",23,0)
NONE ;    
"RTN","PSGCAPP0",24,0)
 ;W:$E(IOST)="P" "______________________________" W !?7,"ADR: " W:$E(IOST)="P" "____________________________________"
"RTN","PSGCAPP0",25,0)
 W "No Allergy Assessment" W !?7,"ADR: " W:$E(IOST)="P" "____________________________________"
"RTN","PSGCAPP0",26,0)
 Q
"RTN","PSGCAPP0",27,0)
ALG ; NOT USED ANYMORE, ALG^PSJHEAD    
"RTN","PSGCAPP0",28,0)
 I PPAGE>1&((PSGALG'<68)!(PSGADR'<63)) S ALFLG=1 Q
"RTN","PSGCAPP0",29,0)
 S KKA=0 F  S KKA=$O(PSGALG(KKA)) Q:'KKA  W:KKA>1 !?12 W PSGALG(KKA)
"RTN","PSGCAPP0",30,0)
 Q
"RTN","PSGCAPP0",31,0)
ADR ; NOT USED ANYMORE, ADR^PSJHEAD 
"RTN","PSGCAPP0",32,0)
 Q:ALFLG
"RTN","PSGCAPP0",33,0)
 W !?7,"ADR: "
"RTN","PSGCAPP0",34,0)
 S KKA=0 F  S KKA=$O(PSGADR(KKA)) Q:'KKA  W:KKA>1 !?12 W PSGADR(KKA)
"RTN","PSGCAPP0",35,0)
 Q
"RTN","PSGCAPP0",36,0)
 ;
"RTN","PSGCAPP0",37,0)
ENRCT ;
"RTN","PSGCAPP0",38,0)
 N DFN,GMRA,GMRAL,RCT,X S DFN=PSGP,GMRA="0^0^111" D ^GMRADPT
"RTN","PSGCAPP0",39,0)
 S X=0 F  S X=$O(GMRAL(X)) Q:'X  I $P(GMRAL(X),U,2)]"" S RCT($P(GMRAL(X),U,2))=""
"RTN","PSGCAPP0",40,0)
 ;W:'$D(RCT) "____________________" S RCT="" F X=1:1 S RCT=$O(RCT(RCT)) Q:RCT=""  W:X>1 "," W:$X+$L(RCT)>77 ! W " ",RCT
"RTN","PSGCAPP0",41,0)
 W:'$D(RCT) "No Allergy Assessment" S RCT="" F X=1:1 S RCT=$O(RCT(RCT)) Q:RCT=""  W:X>1 "," W:$X+$L(RCT)>77 ! W " ",RCT
"RTN","PSGCAPP0",42,0)
 W !,LINE,!," No.",?11,"Drug",?46,"ST Start Stop  Status/Info",!,ALN
"RTN","PSGCAPP0",43,0)
 Q
"RTN","PSGPR")
0^4^B41426367^B40201649
"RTN","PSGPR",1,0)
PSGPR ;BIR/CML3-PATIENT PROFILE ;19 SEP 96 / 3:59 PM
"RTN","PSGPR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,111,169**;16 DEC 97
"RTN","PSGPR",3,0)
 ;* N PSJNEW,PSGPTMP,PPAGE,PSGOEPRF S PSJNEW=1
"RTN","PSGPR",4,0)
 N PSGLI,PSGOE,PSGOEEWF,PSGOH,PSGWD,PSJPWDO,PSJSTOP,PSJTEAM
"RTN","PSGPR",5,0)
 N ACTION,CONT,PAT,LD,LN2,PFLG,PSJNEW,PSGPTMP,PPAGE,PSGOEPRF S PSJNEW=1
"RTN","PSGPR",6,0)
 ;
"RTN","PSGPR",7,0)
 S PSJOPC="UD"
"RTN","PSGPR",8,0)
 D ENCV^PSGSETU
"RTN","PSGPR",9,0)
 ;I '$D(XQUIT) F PSGPR=0:0 S (PSGP,PSGPRWD,PSGPRWG)=0,(PSGPRWDN,PSGPRWGN)="",PSGSSH="PPR" S PSGPTMP=0,PPAGE=1 D GWP^PSJPDIR Q:'$D(PSJSEL)  D @PSJSEL("SELECT")  D ENL^PSGOU I "^N"'[PSGOL D GO
"RTN","PSGPR",10,0)
 I '$D(XQUIT) F PSGPR=0:0 S (PSGP,PSGPRWD,PSGPRWG)=0,(PSGPRWDN,PSGPRWGN)="",PSGSSH="PPR" S PSGPTMP=0,PPAGE=1 D  Q:'$D(PSJSEL("SELECT"))
"RTN","PSGPR",11,0)
 .K PSJSEL,Y F  K ^TMP("PSJSELECT",$J),PSJSEL D ^PSGSEL Q:"^"[PSGSS  S PSJSEL("SELECT")=PSGSS,PSJSTOP="" D
"RTN","PSGPR",12,0)
 ..D:(PSJSEL("SELECT")="P") P^PSJPDIR D:(PSJSEL("SELECT")="W") W^PSJPDIR D:(PSJSEL("SELECT")="G") G^PSJPDIR
"RTN","PSGPR",13,0)
 ..; PSJ*5*169  Check PSJSTOP before continuing.
"RTN","PSGPR",14,0)
 ..Q:$G(PSJSTOP)=1
"RTN","PSGPR",15,0)
 ..I PSJSEL("SELECT")'="P",PSJSEL("SELECT")'="L" D RBPPN^PSJPDIR
"RTN","PSGPR",16,0)
 ..Q:$G(PSJSTOP)=1
"RTN","PSGPR",17,0)
 ..Q:(((PSGSS="W")!(PSGSS="G"))&($G(Y)<0))  Q:((PSGSS="P")&'$D(PSJSEL("P")))
"RTN","PSGPR",18,0)
 ..S (PSGP,WD,WG)=0 S PSGPTMP=0,PPAGE=1 D @PSGSS Q:(((PSGSS="L")!(PSGSS="C"))&($G(Y)<0))  D ENL^PSGOU I "^N"'[PSGOL D GO
"RTN","PSGPR",19,0)
 ;
"RTN","PSGPR",20,0)
DONE ;
"RTN","PSGPR",21,0)
 D:'$D(PSGOEPRF) ENKV^PSGSETU K AND,AT,C,CA,DOB,DRGI,FQC,MF,ND,NF,O,ON,PG,PN,PSGON,PSGORD,PRI,PSGONC,PSGONR,PSGONV,PSGSEL,PX,^TMP("PSGPR",$J)
"RTN","PSGPR",22,0)
 K RCT,PSGAPTM,PSGOL,PSGOS,PSGPR,PSGSS,PSGSSH,PSGPATM,PSGPRWD,PSGPRWDN,PSGPRWG,PSGPRWGN,PSGPRA,PSGPRP,PSJOPC,PSJSEL,S1,S2,S3,S4,HDT,PSGODT,QFLG,RF,SD,SLS,SSN,TF,TM,UD,UDU,WD,WDP,WT,ZTOUT,ZTSK,OD,PDRG
"RTN","PSGPR",23,0)
 Q
"RTN","PSGPR",24,0)
 ;
"RTN","PSGPR",25,0)
GO ;
"RTN","PSGPR",26,0)
 S PSGPRP="P",PSGPRA="" S PSGSS=PSJSEL("SELECT") G:PSGSS'="P" ENDEV
"RTN","PSGPR",27,0)
 K DIR S DIR(0)="SAO^P:PROFILE;E:EXPANDED VIEWS;B:BOTH",DIR("A")="Show PROFILE only, EXPANDED VIEWS only, or BOTH: ",DIR("B")="PROFILE",DIR("?")="^D PH^PSGPR" W ! D ^DIR K DIR Q:"^"[Y  S PSGPRP=Y
"RTN","PSGPR",28,0)
 I "EB"[PSGPRP F  R !!,"Show SHORT, LONG, or NO activity log?  NO// ",AT:DTIME D ALC^PSGVW0 I Q S PSGPRA=AT Q
"RTN","PSGPR",29,0)
 Q:PSGPRA="^"
"RTN","PSGPR",30,0)
ENDEV ;
"RTN","PSGPR",31,0)
 K ZTSAVE S PSGTIR="ENQ^PSGPR",ZTDESC="PATIENT PROFILE" F X="PSGP","PSGP(","PSGSS","PSGPRWD","PSGPRWG","PSGPRWDN","PSGPRWGN","PSGOL","PSGPRA","PSGPRP","PSGPTMP","PSJSEL(","PPAGE" S ZTSAVE(X)=""
"RTN","PSGPR",32,0)
 D ENDEV^PSGTI I POP!$D(IO("Q")) G:$D(PSGOEPRF) DONE Q
"RTN","PSGPR",33,0)
 ;
"RTN","PSGPR",34,0)
ENQ ;
"RTN","PSGPR",35,0)
 K ^TMP("PSGPR",$J)
"RTN","PSGPR",36,0)
 K PSGVBY N RB,ATM S PSGPR=IO'=IO(0)!($E(IOST)'="C") N RBP S RBP=$S($D(PSJSEL("RBP")):PSJSEL("RBP"),1:"P") D @("P"_PSGSS) I PSGPR W:$Y @IOF D ^%ZISC
"RTN","PSGPR",37,0)
 G:$D(PSGOEPRF) DONE Q
"RTN","PSGPR",38,0)
 ;
"RTN","PSGPR",39,0)
G ; get ward group
"RTN","PSGPR",40,0)
 S PSGPRWG=+PSJSEL("WG"),PSGPRWGN=$P(PSJSEL("WG"),"^",2) Q
"RTN","PSGPR",41,0)
 ;
"RTN","PSGPR",42,0)
W ; get ward
"RTN","PSGPR",43,0)
 S PSGPRWD=+PSJSEL("W"),PSGPRWDN=$P(PSJSEL("W"),"^",2)
"RTN","PSGPR",44,0)
 I $D(PSJSEL("TM")) S TM="" F  S TM=$O(PSJSEL("TM",TM)) Q:TM=""  S PSGAPTM(TM)=TM
"RTN","PSGPR",45,0)
 Q
"RTN","PSGPR",46,0)
 ;
"RTN","PSGPR",47,0)
C ;
"RTN","PSGPR",48,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGPR",49,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGPR",50,0)
CDIC ;
"RTN","PSGPR",51,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y
"RTN","PSGPR",52,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGPR",53,0)
 Q
"RTN","PSGPR",54,0)
 ;
"RTN","PSGPR",55,0)
P ; get patient
"RTN","PSGPR",56,0)
 N PAT S PAT="" F  S PAT=$O(PSJSEL("P",PAT)) Q:PAT=""  S PSGP(PAT)=$O(PSJSEL("P",PAT,PSGP))
"RTN","PSGPR",57,0)
 Q
"RTN","PSGPR",58,0)
 ;
"RTN","PSGPR",59,0)
PG ;
"RTN","PSGPR",60,0)
 F PSGPRWD=0:0 S PSGPRWD=$O(^PS(57.5,"AC",PSGPRWG,PSGPRWD)) Q:'PSGPRWD  I $D(^DIC(42,PSGPRWD,0)),$P(^(0),"^")]"" S PSGPRWDN=$P(^(0),"^") D
"RTN","PSGPR",61,0)
 .F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGPRWDN,PSGP)) Q:'PSGP  D
"RTN","PSGPR",62,0)
 ..I RBP="R" S RB=$G(^DPT(PSGP,.101)) S:RB="" RB="zz" S ^TMP("PSGPR",$J,RB,PSGPRWDN,RB)=PSGP
"RTN","PSGPR",63,0)
 ..I RBP="P" D ^PSJAC S ^TMP("PSGPR",$J,PSGPRWDN,PSGP(0))=PSGP
"RTN","PSGPR",64,0)
 I $D(^TMP("PSGPR",$J)) N PSGX S PSGX="^TMP(""PSGPR"",$J)" F  S PSGX=$Q(@PSGX) Q:PSGX'[("""PSGPR"""_","_$J)  S PSGP=$G(@PSGX) D PP0 Q:$G(X)?1"^"."^"
"RTN","PSGPR",65,0)
 Q
"RTN","PSGPR",66,0)
 ;
"RTN","PSGPR",67,0)
PW ;
"RTN","PSGPR",68,0)
 I $D(PSJSEL("TM")) S TM="" F  S TM=$O(PSJSEL("TM",TM)) Q:TM=""  S PSGPATM(TM)=TM
"RTN","PSGPR",69,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGPRWDN,PSGP)) Q:'PSGP  S RB=$G(^DPT(PSGP,.101)),TM="zz" D
"RTN","PSGPR",70,0)
 .I '$D(PSGPATM) D SET Q
"RTN","PSGPR",71,0)
 .S:RB]"" TM=$O(^PS(57.7,"AWRT",PSGPRWD,RB,0)) S:'TM TM="zz" I $D(PSGPATM("ALL"))!$D(PSGPATM(TM))  D SET Q
"RTN","PSGPR",72,0)
 I $D(^TMP("PSGPR",$J)) N PSGX S PSGX="^TMP(""PSGPR"",$J)" F  S PSGX=$Q(@PSGX) Q:PSGX'[("""PSGPR"""_","_$J)  S PSGP=$G(@PSGX) D PP0 Q:$G(X)?1"^"."^"
"RTN","PSGPR",73,0)
 Q
"RTN","PSGPR",74,0)
 ;
"RTN","PSGPR",75,0)
L ;
"RTN","PSGPR",76,0)
 D L^PSGVBW
"RTN","PSGPR",77,0)
 Q
"RTN","PSGPR",78,0)
 ;
"RTN","PSGPR",79,0)
PL S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D PC
"RTN","PSGPR",80,0)
 Q
"RTN","PSGPR",81,0)
 ;
"RTN","PSGPR",82,0)
PC S WDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGPR",83,0)
 S PSGP="" F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:'PSGP  S RB=$G(^DPT(PSGP,.101)),TM="zz" D
"RTN","PSGPR",84,0)
 .D SET Q
"RTN","PSGPR",85,0)
 I $D(^TMP("PSGPR",$J)) N PSGX S PSGX="^TMP(""PSGPR"",$J)" F  S PSGX=$Q(@PSGX) Q:PSGX'[("""PSGPR"""_","_$J)  S PSGP=$G(@PSGX) D PP0 Q:$G(X)?1"^"."^"
"RTN","PSGPR",86,0)
 Q
"RTN","PSGPR",87,0)
 ;
"RTN","PSGPR",88,0)
SET ;
"RTN","PSGPR",89,0)
 S:TM'["zz" TM=$G(^PS(57.7,$G(PSGPRWD),1,TM,0)) I RB="" S RB="z"
"RTN","PSGPR",90,0)
 I RBP="P" D ^PSJAC S ^TMP("PSGPR",$J,TM,PSGP(0))=PSGP Q
"RTN","PSGPR",91,0)
 I RBP="R" S ^TMP("PSGPR",$J,TM,RB)=PSGP
"RTN","PSGPR",92,0)
 Q
"RTN","PSGPR",93,0)
 ;
"RTN","PSGPR",94,0)
PP ;
"RTN","PSGPR",95,0)
 S PAT="" F  S PAT=$O(PSGP(PAT)) Q:PAT=""  S PSGP=PSGP(PAT) D PP0 Q:$G(X)?1"^"."^"
"RTN","PSGPR",96,0)
 Q
"RTN","PSGPR",97,0)
 ;
"RTN","PSGPR",98,0)
PP0 ;
"RTN","PSGPR",99,0)
 N PSJACNWP S PSJACNWP=1 D ^PSJAC I PSGPRP'="E" D ^PSGO I PSGPRP="P",'PSGPR D:'PSGON READ^PSJUTL Q:$G(X)?1"^"."^"  I PSGON S (PSGONC,PSGONF,PSGONR,PSGONV,PSGPRF)=0 D ENVO^PSGOE0 K PSGPRF Q
"RTN","PSGPR",100,0)
 Q:PSGPRP="P"  I PSGPRP="E" U IO D ENGORD^PSGOU,ENPR^PSGO
"RTN","PSGPR",101,0)
 I 'PSGPR,PSGSS'="P",'$D(^TMP("PSG",$J)) D READ^PSJUTL Q
"RTN","PSGPR",102,0)
 S (S1,S2,S3,X)=""
"RTN","PSGPR",103,0)
 F  S S1=$O(^TMP("PSG",$J,S1)) Q:S1=""  F  S S2=$O(^TMP("PSG",$J,S1,S2)) Q:S2=""  F  S S3=$O(^TMP("PSG",$J,S1,S2,S3)) Q:S3=""  D PP1
"RTN","PSGPR",104,0)
 D:X'["^"&PSGPR BOT^PSGO K ^TMP("PSG",$J) Q
"RTN","PSGPR",105,0)
 ;
"RTN","PSGPR",106,0)
PP1 ;
"RTN","PSGPR",107,0)
 ;* S PSGORD=$P(S3,"^",2)_S1 D EN2^PSGVW I PSGPRA'="N" S AT=PSGPRA D ENA^PSGVW0
"RTN","PSGPR",108,0)
 S PSGORD=$P(S3,"^",2)_$S(S1["BD":"",S1["B":"P",S1["CD":"",S1["C":"P",1:"U") D EN2^PSGVW I PSGPRA'="N" S AT=PSGPRA D ENA^PSGVW0
"RTN","PSGPR",109,0)
 S X="" I 'PSGPR S DIR(0)="E" W ! D ^DIR S:$D(DIRUT) X="^" I X["^" S (S1,S2,S3)="~"
"RTN","PSGPR",110,0)
 Q
"RTN","PSGPR",111,0)
 ;
"RTN","PSGPR",112,0)
PH ;
"RTN","PSGPR",113,0)
 W !!?2,"Enter a 'P' to print ONLY the PROFILE of orders for this patient.  Enter an",!,"'E' to print ONLY the EXPANDED VIEW of the orders for this patient.  Enter a",!,"'B' to have BOTH the profile (first) and the expanded views print."
"RTN","PSGPR",114,0)
 W "  Enter an '^'to exit." Q
"RTN","PSGPR",115,0)
 ;
"RTN","PSGPR",116,0)
ENOR S (DFN,PSGP)=+ORVP
"RTN","PSGPR",117,0)
ENLM N PSJNEW,PSGPTMP,PPAGE,PSGOEPRF S PSJNEW=1
"RTN","PSGPR",118,0)
 S PSJOPC="UD",PSGPTMP=0,PPAGE=1
"RTN","PSGPR",119,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGPR",120,0)
 S PSJSEL("SELECT")="P",PSJSEL("P",$P($G(^DPT(DFN,0)),U),DFN)="" D ^VADPT
"RTN","PSGPR",121,0)
 D ^PSJAC,ENL^PSGOU I "^N"'[PSGOL D
"RTN","PSGPR",122,0)
 .S PSGSS="P",(PSGPRWD,PSGPRWG)=0,(PSGPRWDN,PSGPRWGN)=""
"RTN","PSGPR",123,0)
 .S PSGP(PSGP(0))=DFN K PSGP(0) D GO
"RTN","PSGPR",124,0)
 S PSJNKF=1 D READ^PSJUTL G DONE
"VER")
8.0^22.0
"BLD",6519,6)
^165
**END**
**END**
