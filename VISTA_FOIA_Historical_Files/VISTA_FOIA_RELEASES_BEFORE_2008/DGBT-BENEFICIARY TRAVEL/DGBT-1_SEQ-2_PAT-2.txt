$TXT Created by YORTY,M. ROBERT at CSL.FO-WASH.MED.VA.GOV  (KIDS) on Thursday, 04/24/03 at 11:25
=============================================================================
Run Date: MAY 08, 2003                     Designation: DGBT*1*2
Package : DGBT - BENEFICIARY TRAVEL           Priority: Mandatory
Version : 1         SEQ #2                     Status: Released
                  Compliance Date: JUN 08, 2003
=============================================================================

Associated patches: (v)DGBT*1*1    <<= must be installed BEFORE `DGBT*1*2'

Subject: Beneficiary Travel CoreFLS

Category: 
  - Data Dictionary
  - Routine

Description: 
============

 This patch provides Beneficiary Travel with the interface capabilities to
 the Core Financial Logistics System (CoreFLS).  CoreFLS will replace the
 Integrated Funds Distribution, Control Point Activity, and Procurement
 (IFCAP) package.
  
 Vendor information for CoreFLS will be held nationally on a remote
 database.  To alleviate traffic over your network, a local vendor file,
 LOCAL VENDOR (#392.31) will be placed on your local system to be used to
 store and access your frequently use vendors.
  
 A new field is added to the Parameter Rates Enter/Edit option under the
 Beneficiary Travel Main menu.  This field will be used to activate the
 coreFLS interface:
  
 COREFLS ACTIVE:?
      Enter 'Yes' if using the coreFLS system for vendors.
      Choose from: 
        1        YES
        0        NO
  
 This patch may be install independently from the COMMUNICATIONS SERVICE
 LIBRARY (CSL) Package.  A check will be performed to verify the existence
 of the COMMUNICATIONS SERVICE LIBRARY (CSL) Package that will run CoreFLS.
 If it doesn't exist the COREFLS ACTIVE field will default to NO and Bene
 Travel will maintain its current functionality.
  
 A new menu is added to your Beneficiary Travel Menu.  This menu called, 
 Add a local vendor (COREFLS), will allow users holding the DGBT LOCAL
 VENDOR key the ability to add CoreFLS vendors to the LOCAL VENDOR file
 (#392.31) without having to go through the Bene Travel software.  Similar
 to above, a check verifying existence of CoreFLS package is performed
 allowing the user to proceed with the CoreFLS vendor query.
  
 A new menu is added to your Beneficiary Travel Menu.  This menu called, 
 Update Local Vendor (COREFLS), will allow users holding the DGBT LOCAL
 VENDOR key the ability update its local database of vendors with any 
 changes of information at the national database.  It may be wise to run, 
 or queue, this menu weekly, or bi-weekly.
  
 Options effected.
 -----------------
 Parameter Rates Enter/Edit
 Claim Enter/Edit
 View of Claim
 Report of Claim Amounts (Standard Claims by Carrier)
  
 New menus added.
 ----------------
 Add a local vendor (COREFLS)
 Update Local Vendor (COREFLS)
  
 New Security key
 ----------------
 DGBT LOCAL VENDOR
  
 New Fields added with Output/Input Transforms
 ---------------------------------------------
 File: BENEFICIARY TRAVEL CLAIM (#392)
    New Fields added: COREFLS CARRIER (#14)
    Output Transform: K DGBTPRV S DGBTPRV=$$PREV^DGBTCSL(.Y)
  
 File: MAS PARAMETERS (#43)
    New Fields added: COREFLS ACTIVE (#723)
    Input Transform: N DGBTX S DGBTX=X S X="CSLVQ" X ^%ZOSF("TEST") W
         :'$T "   ** COREFLS Package CSL V1.0 not installed. **" S:'$T X=0
         S:$T X=DGBTX Q
  
  
 Technical information.
 ----------------------
 Majority of coding enhancements are done in the DR strings of the DIE
 call.  Each DR string calls a new routine, DGBTCSL. When a prompt for
 COREFLS CARRIER is given, its Output Transform will set up a variable for
 its previous value.  If a value is given at the vendor prompt then no
 Query to CoreFLS is given.  If the previous value is the same as the
 current response (including a <return>) then Query to CoreFLS is given.  
 Reason for this is:  New entries through Fileman to the local vendor file,
 LOCAL VENDOR (#392.31) is forbidden (no LAYGO).  Adding new entries
 is done only by querying and accepting a vendor through CoreFLS.  Due to
 the local file being no LAYGO and adding vendors is done through a
 different file interface, the rule of querying CoreFLS if the current and
 previous values are the same is used.  Example of this is:  User is
 prompted for CoreFLS Vendor and enters a name not found in the local
 vendor file, the response is ??, the user must hit the <return> key to
 pass through.  At this time previous and current values of vendor are the
 same, so the prompt to Query CoreFLS is given.  Only draw back is getting
 the prompt when user is in edit mode and gets the Query coreFLS prompt
 when hitting <return> through accepted responses.
  
 View the DR strings to display executed calls.
  
  
 Example of CoreFLS vendor entry.
 --------------------------------
  
                Beneficiary Travel Claim Information <Enter/Edit>
  
         Name: AAA,WLSTN W               PT ID: ***********      DOB: JUL 
 29,1934
  
 Claim DATE/TIME: APR 23,2002@13:54// 
 Select ACCOUNT: 090 CASH// EMERGENCIES  086 EMERGENCIES     086
 MODE OF TRANSPORTATION:    AMB
          ...OK? Yes//   (Yes)
  
 AUTHORIZING PERSON:    JONES,ROBERT     RJ          CLAIMS AGENT
 COREFLS CARRIER: **ST ??
 COREFLS CARRIER: ?
  Answer with COREFLS LOCAL VENDOR NAME & VENDOR SITE & VENDOR NUMBER
  Do you want the entire 14-Entry COREFLS LOCAL VENDOR List? Y  (Yes)
    Choose from:
    **ACCESS ABILITY   TULSA-OK-01   28896         TULSA-OK-01
    ATLAS LOOSE LEAF INC   PLYMOUTH-MN-01   13471         PLYMOUTH-MN-01
    BARD ACCESS SYSTEMS   CRANSTON-RI-01   7         CRANSTON-RI-01
    BARD ACCESS SYSTEMS   SAlt LAKE-UT-00   7         SAlt LAKE-UT-00
    BAXTER EDWARDS LABS   GRAND PRA-TX-01   22023         GRAND PRA-TX-01
    CITIBANK   JACKSONVI-FL-00   8493         JACKSONVI-FL-00
    CITIBANK   LAS VEGAS-NV-00   8493         LAS VEGAS-NV-00
    STAPLES   FRAMINGHA-MA-01   6811         FRAMINGHA-MA-01
     
 COREFLS CARRIER: 
 DO YOU WANT TO QUERY CoreFLS FOR A VENDOR? NO// YES
 ** CoreFLS Query **
 Vendor Name: **ST
 . . . 
    1    **ST. MICHAEL EMS TRANSFER SERVICE
         P.O. BOX 1140
         TEXARKANA, AR  75504
     
 Select QUERY RESULTS SEQ NO: 1   **ST. MICHAEL EMS TRANSFER SERVICE
         P.O. BOX 1140
         TEXARKANA, AR  75504
 **CoreFLS VENDOR UPDATED**
 MEALS & LODGING: 0// 
 FERRY, BRIDGES, ETC.: 0// 
 MOST ECON. COST: 0// 
 REMARKS: 
  
                  Beneficiary Travel Claim Information <Display>
  
   Claim Date: APR 23,2002@13:54         Division: SALEM, VA
  
         Name: AAA,WLSTN W               PT ID: ***********      DOB: JUL 
 29,1934
  
  Depart From: 3847 HARBORWOOD RD              To: SALEM, VA
               LOS DIABLOS, MS  36501              1970 BOULEVARD
                                                   SALEM, VA  24153-6483
                                                   
  
  Eligibility: COLLATERAL OF VET.
  
      Account: 086 EMERGENCIES                 Most Econ. Cost:       $0.00
  Mode/Trans.: AMB                             Meals & Lodging:       $0.00
 CoreFLS Carrier: **ST. MICHAEL EMS TRANS Ferry, Bridges, Etc.:       $0.00
 Auth. Person: JONES,ROBERT                 Applied Deductible:       $0.00
                                                Amount Payable:       $0.00
  
 Remarks: 
 <I>nformation, <D>isplay claim, <E>dit claim, or <Q>uit Quit// 
  
  
 This patch addresses the following E3R(s):
 ------------------------------------------
 There are no E3Rs associated with this patch.
  
 This patch addresses the following NOIS message(s):
 ---------------------------------------------------
 There are no NOIS messages associated with this patch.
  
 Test Sites:
 -----------
  
  
 =======================INSTALLATION INSTRUCTIONS==========================
  
 This patch can be loaded with users on the system.  However, it would be
 preferable if Bene Travel users were off the system.
  
 If installed during the normal workday it is recommended that the
 following menu options (File #19) and all of their descendants be
 disabled to prevent possible conflicts while running the KIDS Install.
 Other VISTA users will not be affected.
  
     DGBT BENE TRAVEL MENU    Beneficiary Travel Menu
     DGBT BENE TRAVEL RATES   Parameter Rates Enter/Edit
     DGBT BENE TRAVEL SCREEN  Claim Enter/Edit
     DGBT BENE TRAVEL VIEW    View of Claim
     DGBT BENE TRAVEL REPORT  Report of Claim Amounts
  
 Install Time - 5 minutes.
  
 Please ensure that your programming variables are set, 
 including your DUZ(0)="@", otherwise installation will abort.
  
  
 1.   DISABLE ROUTINE MAPPING   (DSM for Open VMS sites only) 
      -----------------------
      Disable routine mapping on all systems for the routines listed in 
      step 3 below.  
       
      NOTE:  If the routines included in this patch are not currently in 
      your mapped routine set, please skip this step.
  
 2.   LOAD TRANSPORT GLOBAL 
      ---------------------
      Choose the PackMan message containing this patch and invoke the 
      INSTALL/CHECK MESSAGE PackMan option.  
  
 3.   COMPONENTS SENT WITH PATCH 
      --------------------------
      The following is a list of the routines included in this patch.  
      The second line of each of these routines now looks like:  
  
      <tab>;;1.0;Beneficiary Travel;**[patch list]**;September 25, 2001
  
                             CHECK^XTSUMBLD results
  Routine name      Before Patch          After Patch         Patch List
  ============      ============          ===========         ==========
 DGBT1P2                     N/A              2129511                2
 DGBTCD                 13829532             15183119                2
 DGBTCE                 14541136             15702743                2
 DGBTCSL                     N/A              3089744                2
 DGBTE                   8229618              8272047                2
 DGBTEE                  8387933             10181481                2
 DGBTEF1                 8937627              8959351                2
 DGBTID                      N/A              2804984                2
 DGBTOA1                14205362             14975908                2
 DGBTOA2                11984900             12202299                2
 DGBTVUP                     N/A             14152123                2
  
   Total number of routines - 11
  
 4.   START UP KIDS 
      -------------
      Start up the Kernel Installation and Distribution System Menu 
      [XPD MAIN]: 
    
           Edits and Distribution ...  
           Utilities ...  
           Installation ...  
    
 Select Kernel Installation & Distribution System Option: INStallation 
                                                          ---
           Load a Distribution 
           Print Transport Global 
           Compare Transport Global to Current System 
           Verify Checksums in Transport Global 
           Install Package(s) 
           Restart Install of Package(s) 
           Unload a Distribution 
           Backup a Transport Global 
    
 Select Installation Option: 
  
 5.   Select Installation Option: 
      ---------------------------
      NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
             NAME, enter DGBT*1.0*2):
       
      a.  Backup a Transport Global - This option will create a backup
          message of any routines exported with this patch. It will not
          backup any other changes such as DD's or templates.
      b.  Compare Transport Global to Current System - This option will
          allow you to view all changes that will be made when this patch
          is installed.  It compares all components of this patch
          (routines, DD's, templates, etc.).
      c.  Verify Checksums in Transport Global - This option will allow
          you to ensure the integrity of the routines that are in the
          transport global.
      
 6.  Select Installation Option: Install Package(s)
                                 ------------------
     a. Choose the Install Package(s) option to start the patch install.
  
     b. When prompted "Want KIDS to Rebuild Menu Trees Upon Completion of 
        Install? YES//", answer 'NO'.
  
     c. When prompted "Want KIDS to INHIBIT LOGONs during the install? 
        YES//", answer 'NO'.
  
     d. When prompted "Want to DISABLE Scheduled Options, Menu Options, and
        Protocols? YES//", answer 'YES'.
  
     e. When prompted "Enter options you wish to mark as 'Out of Order':" 
        Enter the following options:
  
        DGBT*
  
     f. When prompted "Enter protocols you wish to mark as "out Of Order':"
         press <return>.
  
 7.  REBUILD MAPPED ROUTINE(S)  (DSM for Open VMS sites only)
     ==========================
     NOTE: This step is only necessary if you performed step 1 or if you 
     wish to include the routines in your mapped set.
  
  
 8.  AFTER INSTALLATION
     ==================
     After the installation, schedule the 'Update Local Vendor (COREFLS)'
     menu to run weekly, or bi-weekly.  Queue the menu under POSTMASTER 
     (DUZ = .5), giving POSTMASTER the DGBT LOCAL VENDOR key.

Routine Information:
====================

Routine Name:
  - DGBT1P2

 This routine will run the environment check to verify installer has the 
 correct programming variables set up.  It will run a post init to update 
 the new LOCAL VENDOR (#392.31) File information to the Beneficiary Travel 
 namespace entry in the PACKAGE (#9.4) File.

Routine Checksum:

Routine Name:
  - DGBTCD

 Changes to this display routine include the addition of the new CoreFLS 
 Carrier field from the LOCAL VENDOR (#392.31) File. If CoreFLS is active,
 then the CoreFLS Carrier is displayed.  Otherwise, vendor from the VENDOR 
 (#440) File will display.
  
 BEFORE
 ------
 ATT+4^DGBTCD
  
 I DGBTACCT'=4&(DGBTACCT'=5) W !?5,"Carrier: ",$S($P(DGBTVAR(0),U,7):$P(^
  PRC(440,$P(DGBTVAR(0),U,7),0),U),1:"")
  
 AFTER
 -----
 ATT+4^DGBTCD
  
 I DGBTACCT'=4&(DGBTACCT'=5) D
   . S DGX=$S($P(DGBTVAR(0),U,14):"coreFLS",$P(DGBTVAR(0),U,7):"Carrier",1:
     "coreFLS") W:DGX["FLS" !,"coreFLS Carrier: " W:DGX["Carrier" 
   !?5,"Carrier: "
   . W $E($S((DGX["FLS"&$P(DGBTVAR(0),U,14)):$P(^DGBT(392.31,$P(DGBTVAR(0),
     U,14),0),U),(DGX["Carrier"&$P(DGBTVAR(0),U,7)):$P(^PRC(440,$P(DGBTVAR(0),
     U ,7),0),U),1:""),1,27) K DGX

Routine Checksum:

Routine Name:
  - DGBTCE

 This routine edits the Claim entry.  Changes include the addition of 
 CoreFLS Carrier prompt if CoreFLS is active.
  
 BEFORE
 ------
 DIE1+3^DGBTCE
  
 S DIE="^DGBT(392,",DA=DGBTDT,DR="I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41
  ;7;@1;I DGBTMLFB=0 S Y=""@2"";34//;S DGBTMAL=X;35//;S DGBTFAB=X;@2;8//;S 
  DGBTME=X"
  
 AFTER
 -----
 DIE1+3^DGBTCE
  
 S DIE="^DGBT(392,",DA=DGBTDT
 I 'DGBTCORE D
  . S DR="I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41;7;@1;I DGBTMLFB=0 S Y=""
    @2"";34//;S DGBTMAL=X;35//;S DGBTFAB=X;@2;8//;S DGBTME=X"
 I DGBTCORE S DR="" D
  . S DR(1,392,1)="I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41;@3;14;S DGBTCSL
    =$$AFTER^DGBTCSL(392,D0,X,$G(DGBTPRV)) S:DGBTCSL<1 Y=""@3"" W:DGBTCSL<1
    ""   Required"" K DGBTPRV,DGBTCSL;"
  . S DR(1,392,2)="@1;I DGBTMLFB=0 S Y=""@2"";34//;S DGBTMAL=X;35//;S 
    DGBTFAB=X;@2;8//;S DGBTME=X"

Routine Checksum:

Routine Name:
  - DGBTE

 This routine sets a variable to determine if CoreFLS is active.
  
 AFTER
 -----
 OLDCLAIM+6^DGBTE
  
 COREFLS ;  coreFLS vendor interface active/inactive
         S DGBTCORE=$P($G(^DG(43,1,"BT")),U,4)
         ;

Routine Checksum:

Routine Name:
  - DGBTEE

 BEFORE
 ------
 DIE2+2
  
 S DR="3////"_DGBTELIG_";4////"_DGBTSCP_";5///"_DGBTCD_";6////"_DGBTACTN_
  ";I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41;7;@1;I DGBTMLFB=0 S 
  Y=""@2"";34;S DGBTMAL=X;35;S DGBTFAB=X;@2"
  
 DIE3+1^DGBTEE
  
 D ^DIE I X=""!(X="^") S DGBTTOUT=-1 Q
  
 AFTER
 -----
 DIE2+2
  
 I 'DGBTCORE D
 . S DR="3////"_DGBTELIG_";4////"_DGBTSCP_";5///"_DGBTCD_";6////"_DGBTACT
  N_";I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41;7;@1;I DGBTMLFB=0 S 
  Y=""@2"";34;S DGBTMAL=X;35;S DGBTFAB=X;@2"
 I DGBTCORE D
 . S DR(1,392,1)="3////"_DGBTELIG_";4////"_DGBTSCP_";5///"_DGBTCD_";6////
  "_DGBTACTN_";I DGBTACCT=4!(DGBTACCT=5) S Y=""@1"";41;"
 . S DR(1,392,2)="@3;14;S DGBTCSL=$$AFTER^DGBTCSL(392,D0,X,$G(DGBTPRV)) S
  :DGBTCSL<1 Y=""@3"" W:DGBTCSL<1 ""   Required"" K DGBTPRV,DGBTCSL;@1;I 
  DGBTMLFB=0 S Y=""@2"";34;S DGBTMAL=X;35;S DGBTFAB=X;@2"
  
 DIE3+1^DGBTEE
  
 D ^DIE K DR I X=""!(X="^") S DGBTTOUT=-1 Q

Routine Checksum:

Routine Name:
  - DGBTEF1

 This routine adds the prompt for to activate CoreFLS in the Beneficiary 
 Site Parameters.
  
 BEFORE
 ------
 RATES+1^DGBTEF1
  
 S DA=1,DR="720;721",DIE="^DG(43," D ^DIE G QUIT:X="^"!($D(DTOUT))!($D(Y)
  ) K DA,DE,DQ,DR,DIE
  
 AFTER
 -----
 RATES+1^DGBTEF1
  
 S DA=1,DR="720;723;721",DIE="^DG(43," D ^DIE G QUIT:X="^"!($D(D
  TOUT))!($D(Y)) K DA,DE,DQ,DR,DIE

Routine Checksum:

Routine Name:
  - DGBTOA1

 This routine is used as part of the Standard Claims Output report (by
 Carrier).
  
 BEFORE
 ------
 CAR^DGBTOA1
  
 CAR       S VAUTVB="VAUTN",PRCABN=0,DIC="^PRC(440,",VAUTSTR="carrier",VAU
            TNI=2 D FIRST^VAUTOMA
  
 AFTER
 -----
 CAR^DGBTOA1
  
 CAR       I '$P($G(^DG(43,1,"BT")),U,4) S VAUTVB="VAUTN",PRCABN=0,
            DIC="^PRC(440,",VAUTSTR="carrier",VAUTNI=2 D FIRST^VAUTOMA
           I $P($G(^DG(43,1,"BT")),U,4) S VAUTVB="VAUTN",PRCABN=0,
            DIC="^DGBT(392.31,",VAUTSTR="coreFLS Carrier",VAUTNI=2 D
            FIRST^VAUTOMA

Routine Checksum:

Routine Name:
  - DGBTOA2

 This routine is used as part of the Standard Claims Output report (by
 Carrier).
  
 BEFORE
 ------ 
 START+1^DGBTOA2
  
 S DGBTIX=$S(DGBTSL="ACCT":"AC",DGBTSL="CAR":"AS",DGBTSL="TYP":"
  ACTP",1:"C") D SORT G:DGBTU QUIT1 I $D(^UTILITY($J)) D TOTAL^DGBTOA4 G 
  QUIT1
  
 SET+5^DGBTOA2
  
 S DGBTB=$S($P(DGBTK,U,7):$P(^PRC(440,$P(DGBTK,U,7),0),U,1),1:""
   ),DGBTK9=$P(DGBTK,U,9),DGBTK10=$P(DGBTK,U,10)
  
 ACCTU   S DGBTCW=$S(DGBTSL="CAR":$P(^PRC(440,DGBTBY,0),U,1),1:DGBTCW),
          DGBTOTX(D BTDN,DGBTCW)=$S('$D(DGBTOTX(DGBTDN,DGBTCW)):0,
          1:DGBTOTX(DGBTDN,DGBTCW)),DGBTOTX(DGBTDN,DGBTCW)=
          DGBTOTX(DGBTDN,DGBTCW)+1
  
 AFTER
 -----
 START+1^DGBTOA2
  
 S DGBTIX=$S(DGBTSL="ACCT":"AC",DGBTSL="CAR":"AS",DGBTSL="TYP":"ACTP",1:"
  C")
 I $P($G(^DG(43,1,"BT")),U,4) S DGBTIX=$S(DGBTSL="CAR":"AFLS",1:DGBTIX)
 D SORT G:DGBTU QUIT1 I $D(^UTILITY($J)) D TOTAL^DGBTOA4 G QUIT1
  
 SET+5^DGBTOA2
  
 I '$P($G(^DG(43,1,"BT")),U,4) S DGBTB=$S($P(DGBTK,U,7):$P(^PRC(440,$P(DG
  BTK,U,7),0),U,1),1:"")
 I $P($G(^DG(43,1,"BT")),U,4) S DGBTB=$S($P(DGBTK,U,14):$P(^DGBT(392.31,
  $P(DGBTK,U,14),0),U,1),1:"")

Routine Checksum:

Routine Name:
  - DGBTCSL

 This is a new routine and the main CoreFLS interface driver.  It 
 interfaces between the CoreFLS system and the LOCAL VENDOR (#392.31) File.

Routine Checksum:

Routine Name:
  - DGBTVUP

 This is a new routine to run in background/foreground under the menu
 'Update Local Vendor (COREFLS)'. This routine will loop through the LOCAL
 VENDOR (#392.31) and update each vendor and its information if updated on
 the CoreFLS national database. 

Routine Checksum:

Routine Name:
  - DGBTID

 This is a new routine.  It displays Identifier information of vendors 
 from the LOCAL VENDOR (#392.31) file.

Routine Checksum:

=============================================================================
User Information:                               
Entered By  : YORTY,M ROBERT                Date Entered : APR 23, 2002
Completed By: FAIN,ZACHARY                  Date Completed: MAY 08, 2003
Released By : FITCH,DONNA                   Date Released : MAY 08, 2003
=============================================================================


Packman Mail Message:
=====================

$END TXT
