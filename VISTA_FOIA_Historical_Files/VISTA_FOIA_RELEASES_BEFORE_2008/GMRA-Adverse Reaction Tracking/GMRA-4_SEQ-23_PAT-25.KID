EMERGENCY Released GMRA*4*25 SEQ #23
Extracted from mail message
**KIDS**:GMRA*4.0*25^

**INSTALL NAME**
GMRA*4.0*25
"BLD",5674,0)
GMRA*4.0*25^ADVERSE REACTION TRACKING^0^3050608^y
"BLD",5674,1,0)
^^2^2^3050608^
"BLD",5674,1,1,0)
Update to fix blank sign/symptom issue.  Please see FORUM for the
"BLD",5674,1,2,0)
complete description of this patch.
"BLD",5674,4,0)
^9.64PA^^
"BLD",5674,"ABPKG")
n
"BLD",5674,"INIT")
POST^GMRAY25
"BLD",5674,"KRN",0)
^9.67PA^8989.52^19
"BLD",5674,"KRN",.4,0)
.4
"BLD",5674,"KRN",.401,0)
.401
"BLD",5674,"KRN",.402,0)
.402
"BLD",5674,"KRN",.403,0)
.403
"BLD",5674,"KRN",.5,0)
.5
"BLD",5674,"KRN",.84,0)
.84
"BLD",5674,"KRN",3.6,0)
3.6
"BLD",5674,"KRN",3.8,0)
3.8
"BLD",5674,"KRN",9.2,0)
9.2
"BLD",5674,"KRN",9.8,0)
9.8
"BLD",5674,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5674,"KRN",9.8,"NM",1,0)
GMRAGUI1^^0^B56901114
"BLD",5674,"KRN",9.8,"NM",2,0)
GMRAY25^^0^B9257324
"BLD",5674,"KRN",9.8,"NM","B","GMRAGUI1",1)

"BLD",5674,"KRN",9.8,"NM","B","GMRAY25",2)

"BLD",5674,"KRN",19,0)
19
"BLD",5674,"KRN",19.1,0)
19.1
"BLD",5674,"KRN",101,0)
101
"BLD",5674,"KRN",409.61,0)
409.61
"BLD",5674,"KRN",771,0)
771
"BLD",5674,"KRN",870,0)
870
"BLD",5674,"KRN",8989.51,0)
8989.51
"BLD",5674,"KRN",8989.52,0)
8989.52
"BLD",5674,"KRN",8994,0)
8994
"BLD",5674,"KRN","B",.4,.4)

"BLD",5674,"KRN","B",.401,.401)

"BLD",5674,"KRN","B",.402,.402)

"BLD",5674,"KRN","B",.403,.403)

"BLD",5674,"KRN","B",.5,.5)

"BLD",5674,"KRN","B",.84,.84)

"BLD",5674,"KRN","B",3.6,3.6)

"BLD",5674,"KRN","B",3.8,3.8)

"BLD",5674,"KRN","B",9.2,9.2)

"BLD",5674,"KRN","B",9.8,9.8)

"BLD",5674,"KRN","B",19,19)

"BLD",5674,"KRN","B",19.1,19.1)

"BLD",5674,"KRN","B",101,101)

"BLD",5674,"KRN","B",409.61,409.61)

"BLD",5674,"KRN","B",771,771)

"BLD",5674,"KRN","B",870,870)

"BLD",5674,"KRN","B",8989.51,8989.51)

"BLD",5674,"KRN","B",8989.52,8989.52)

"BLD",5674,"KRN","B",8994,8994)

"BLD",5674,"QUES",0)
^9.62^^
"BLD",5674,"REQB",0)
^9.611^1^1
"BLD",5674,"REQB",1,0)
GMRA*4.0*21^1
"BLD",5674,"REQB","B","GMRA*4.0*21",1)

"INIT")
POST^GMRAY25
"MBREQ")
0
"PKG",140,-1)
1^1
"PKG",140,0)
ADVERSE REACTION TRACKING^GMRA^Allergy Tracking System
"PKG",140,20,0)
^9.402P^^
"PKG",140,22,0)
^9.49I^1^1
"PKG",140,22,1,0)
4.0^2960328^2960506^10
"PKG",140,22,1,"PAH",1,0)
25^3050608
"PKG",140,22,1,"PAH",1,1,0)
^^2^2^3050608
"PKG",140,22,1,"PAH",1,1,1,0)
Update to fix blank sign/symptom issue.  Please see FORUM for the
"PKG",140,22,1,"PAH",1,1,2,0)
complete description of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRAGUI1")
0^1^B56901114
"RTN","GMRAGUI1",1,0)
GMRAGUI1 ;SLC/DAN - CPRS GUI support ;6/8/05  14:26
"RTN","GMRAGUI1",2,0)
 ;;4.0;Adverse Reaction Tracking;**21,25**;Mar 29, 1996
"RTN","GMRAGUI1",3,0)
 ;
"RTN","GMRAGUI1",4,0)
 Q
"RTN","GMRAGUI1",5,0)
EN1 ; GETREC, cont'd
"RTN","GMRAGUI1",6,0)
OBSV ;  Get OBSERVATIONS from file 120.85
"RTN","GMRAGUI1",7,0)
 S STRING="~OBSERVATIONS" D NEXT
"RTN","GMRAGUI1",8,0)
 S OBSIEN=0
"RTN","GMRAGUI1",9,0)
OBSLOOP S OBSIEN=$O(^GMR(120.85,"C",GMRAIEN,OBSIEN)) G:OBSIEN<1 EXIT
"RTN","GMRAGUI1",10,0)
 S GMRA(1)=$G(^GMR(120.85,OBSIEN,0)) Q:'$L(GMRA(1))
"RTN","GMRAGUI1",11,0)
 S STRING="tRecord            : "_OBSIEN D NEXT
"RTN","GMRAGUI1",12,0)
 S USRNAM=""
"RTN","GMRAGUI1",13,0)
 S USR=$P(GMRA(1),U,13) I USR'="" D GETUSR
"RTN","GMRAGUI1",14,0)
 S Y=$P(GMRA(1),U,1) X ^DD("DD")
"RTN","GMRAGUI1",15,0)
 S STRING="tDate/Time of Event: "_Y D NEXT
"RTN","GMRAGUI1",16,0)
 S STRING="tObserver          : "_USRNAM D NEXT
"RTN","GMRAGUI1",17,0)
 S SEVCOD=$P(GMRA(1),U,14)
"RTN","GMRAGUI1",18,0)
 S SEVER=$S(SEVCOD=1:"MILD",SEVCOD=2:"MODERATE",SEVCOD=3:"SEVERE",1:"")
"RTN","GMRAGUI1",19,0)
 S STRING="tSeverity          : "_SEVER D NEXT
"RTN","GMRAGUI1",20,0)
 S Y=$P(GMRA(1),U,18) X ^DD("DD")
"RTN","GMRAGUI1",21,0)
 S STRING="tDate Reported     : "_Y D NEXT
"RTN","GMRAGUI1",22,0)
 S USRNAM=""
"RTN","GMRAGUI1",23,0)
 S USR=$P(GMRA(1),U,19) I USR'="" D GETUSR
"RTN","GMRAGUI1",24,0)
 S STRING="tReporting User    : "_USRNAM D NEXT
"RTN","GMRAGUI1",25,0)
 S STRING="t" F I=1:1:60 S STRING=STRING_"-"
"RTN","GMRAGUI1",26,0)
 D NEXT
"RTN","GMRAGUI1",27,0)
 G OBSLOOP
"RTN","GMRAGUI1",28,0)
EXIT Q
"RTN","GMRAGUI1",29,0)
NEXT ;SET ARRAY NODE AND INCREMENT ARRAY COUNTER
"RTN","GMRAGUI1",30,0)
 S @GMRARRAY@(ND)=STRING,ND=ND+1,STRING=""
"RTN","GMRAGUI1",31,0)
 Q
"RTN","GMRAGUI1",32,0)
GETUSR S USRNAM=$$GET1^DIQ(200,USR_",",".01")
"RTN","GMRAGUI1",33,0)
 Q
"RTN","GMRAGUI1",34,0)
 ;
"RTN","GMRAGUI1",35,0)
EIE(GMRAIEN,GMRADFN,GMRARRAY) ;Mark individual entry as entered in error
"RTN","GMRAGUI1",36,0)
 N DIE,DA,DR,Y,DIK,DFN,OROLD,VAIN,X,GMRAOUT,GMRAPA
"RTN","GMRAGUI1",37,0)
 L +^XTMP("GMRAED",GMRADFN):1 I '$T D MESS Q
"RTN","GMRAGUI1",38,0)
 S GMRAPA=GMRAIEN
"RTN","GMRAGUI1",39,0)
 S DIE="^GMR(120.8,",DA=GMRAPA,DR="22///1;23///"_@GMRARRAY@("GMRAERRDT")_";24////"_$G(@GMRARRAY@("GMRAERRBY"),.5)
"RTN","GMRAGUI1",40,0)
 D ^DIE ;Entered in error on date/time by user
"RTN","GMRAGUI1",41,0)
 I $D(@GMRARRAY@("GMRAERRCMTS")) D ADCOM(GMRAPA,"E",$NA(@GMRARRAY@("GMRAERRCMTS"))) ;add comments
"RTN","GMRAGUI1",42,0)
 I $$NKASCR^GMRANKA($P(^GMR(120.8,GMRAPA,0),U)) D
"RTN","GMRAGUI1",43,0)
 .S DIK="^GMR(120.86,",DA=$P(^GMR(120.8,GMRAPA,0),U)
"RTN","GMRAGUI1",44,0)
 .D ^DIK ;If patient's last allergy marked as entered in error then delete assessment
"RTN","GMRAGUI1",45,0)
 S GMRAPA(0)=$G(^GMR(120.8,GMRAPA,0)) Q:GMRAPA(0)=""
"RTN","GMRAGUI1",46,0)
 S GMRAOUT=0
"RTN","GMRAGUI1",47,0)
 D EN1^GMRAEAB ;Sends entered in error bulletin to appropriate mail groups
"RTN","GMRAGUI1",48,0)
 D EN1^GMRAPET0(GMRADFN,GMRAPA,"E",.GMRAOUT) ;21 File Progress Note
"RTN","GMRAGUI1",49,0)
 S DFN=GMRADFN
"RTN","GMRAGUI1",50,0)
 D INP^VADPT S X=$$FIND1^DIC(101,,"BX","GMRA ENTERED IN ERROR")_";ORD(101,"
"RTN","GMRAGUI1",51,0)
 D:X EN^XQOR ;Process protocols hanging off of "entered in error" protocol
"RTN","GMRAGUI1",52,0)
 L -^XTMP("GMRAED",GMRADFN)
"RTN","GMRAGUI1",53,0)
 Q
"RTN","GMRAGUI1",54,0)
 ;
"RTN","GMRAGUI1",55,0)
ADCOM(ENTRY,TYPE,GMRACOM) ;Add comments to allergies
"RTN","GMRAGUI1",56,0)
 ;
"RTN","GMRAGUI1",57,0)
 N FDA,GMRAI,X,DIWL,DIWR
"RTN","GMRAGUI1",58,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=60 S GMRAI=0 F  S GMRAI=$O(@GMRACOM@(GMRAI)) Q:'+GMRAI  S X=@GMRACOM@(GMRAI) D ^DIWP
"RTN","GMRAGUI1",59,0)
 S GMRACOM="^UTILITY($J,""W"",1)"
"RTN","GMRAGUI1",60,0)
 S FDA(120.826,"+1,"_ENTRY_",",.01)=$$NOW^XLFDT
"RTN","GMRAGUI1",61,0)
 S FDA(120.826,"+1,"_ENTRY_",",1)=DUZ
"RTN","GMRAGUI1",62,0)
 S FDA(120.826,"+1,"_ENTRY_",",1.5)=TYPE
"RTN","GMRAGUI1",63,0)
 S FDA(120.826,"+1,"_ENTRY_",",2)=GMRACOM
"RTN","GMRAGUI1",64,0)
 D UPDATE^DIE("","FDA")
"RTN","GMRAGUI1",65,0)
 Q
"RTN","GMRAGUI1",66,0)
 ;
"RTN","GMRAGUI1",67,0)
NKA ;Change patient assessment to NKA
"RTN","GMRAGUI1",68,0)
 ;
"RTN","GMRAGUI1",69,0)
 N DA,DR,DIE,NKA,DFN
"RTN","GMRAGUI1",70,0)
 S DFN=ORDFN
"RTN","GMRAGUI1",71,0)
 L +^XTMP("GMRAED",DFN):1 I '$T D MESS Q
"RTN","GMRAGUI1",72,0)
 S NKA=$$NKA^GMRANKA(DFN)
"RTN","GMRAGUI1",73,0)
 I NKA=0 Q  ;Patient is already NKA
"RTN","GMRAGUI1",74,0)
 I NKA=1 S ORY="-1^Patient has active allergies - can't mark as NKA" Q
"RTN","GMRAGUI1",75,0)
 L +^GMR(120.86,0):5 I '$T S ORY="-1^Unable to update assessment - try again." Q
"RTN","GMRAGUI1",76,0)
 I '$D(^GMR(120.86,DFN,0)) D  ;Add assessment entry
"RTN","GMRAGUI1",77,0)
 .S $P(^GMR(120.86,0),U,3,4)=(DFN_"^"_($P(^GMR(120.86,0),U,4)+1))
"RTN","GMRAGUI1",78,0)
 .S ^GMR(120.86,DFN,0)=DFN_U,^GMR(120.86,"B",DFN,DFN)=""
"RTN","GMRAGUI1",79,0)
 L -^GMR(120.86,0) L +^GMR(120.86,DFN,0):5 I '$T S ORY="-1^Unable to update assessment - try again." Q
"RTN","GMRAGUI1",80,0)
 S DIE="^GMR(120.86,",DA=DFN,DR="1////0;2////"_DUZ_";3///NOW" D ^DIE
"RTN","GMRAGUI1",81,0)
 S ORY=0
"RTN","GMRAGUI1",82,0)
 L -^XTMP("GMRAED",DFN)
"RTN","GMRAGUI1",83,0)
 Q
"RTN","GMRAGUI1",84,0)
 ;
"RTN","GMRAGUI1",85,0)
UPDATE(GMRAIEN,DFN,GMRARRAY) ;Add/edit allergies
"RTN","GMRAGUI1",86,0)
 N NEW,NKA,FDA,NODE,IEN,SUB,FILE,DA,DIK,SIEN,GMRAS0,GMRAIEN,GMRAL,GMRAPA,GMRAAR,GMRALL,GMRADFN,GMRAOUT,GMRAROT
"RTN","GMRAGUI1",87,0)
 S NEW='$G(GMRAIEN)
"RTN","GMRAGUI1",88,0)
 I NEW,$$DUPCHK^GMRAOR0(DFN,$P(@GMRARRAY@("GMRAGNT"),U))=1 S ORY="-1^Patient already has a "_$P(@GMRARRAY@("GMRAGNT"),U)_" reaction entered.  No duplicates allowed." Q
"RTN","GMRAGUI1",89,0)
 L +^XTMP("GMRAED",DFN):1 I '$T D MESS Q
"RTN","GMRAGUI1",90,0)
 D SITE^GMRAUTL S GMRASITE(0)=$G(^GMRD(120.84,+GMRASITE,0))
"RTN","GMRAGUI1",91,0)
 S NKA='$$NKA^GMRANKA(DFN) ;is patient NKA?
"RTN","GMRAGUI1",92,0)
 I NKA,NEW D
"RTN","GMRAGUI1",93,0)
 .S FDA(120.86,"?+"_DFN_",",.01)=DFN
"RTN","GMRAGUI1",94,0)
 .S FDA(120.86,"?+"_DFN_",",1)=1
"RTN","GMRAGUI1",95,0)
 .S FDA(120.86,"?+"_DFN_",",2)=DUZ
"RTN","GMRAGUI1",96,0)
 .S FDA(120.86,"?+"_DFN_",",3)=$G(@GMRARRAY@("GMRAORDT"),$$NOW^XLFDT)
"RTN","GMRAGUI1",97,0)
 .S IEN(DFN)=DFN
"RTN","GMRAGUI1",98,0)
 .D UPDATE^DIE("","FDA","IEN")
"RTN","GMRAGUI1",99,0)
 K FDA,IEN
"RTN","GMRAGUI1",100,0)
 S NODE=$S($G(NEW):"+1,",1:(GMRAIEN_","))
"RTN","GMRAGUI1",101,0)
 S:$G(NEW) FDA(120.8,NODE,.01)=DFN
"RTN","GMRAGUI1",102,0)
 I $P($G(@GMRARRAY@("GMRAGNT")),U,2)["50.67" S $P(@GMRARRAY@("GMRAGNT"),U,2)=$$TGTOG^PSNAPIS($P(@GMRARRAY@("GMRAGNT"),U))_";PSNDF(50.6,"
"RTN","GMRAGUI1",103,0)
 F SUB="GMRAGNT;.02","GMRATYPE;3.1","GMRANATR;17","GMRAORIG;5","GMRAORDT;4","GMRAOBHX;6" D
"RTN","GMRAGUI1",104,0)
 .S FDA(120.8,NODE,$P(SUB,";",2))=$P(@GMRARRAY@($P(SUB,";")),U)
"RTN","GMRAGUI1",105,0)
 .I (SUB["GMRAGNT"),NEW S FDA(120.8,NODE,1)=$P(@GMRARRAY@($P(SUB,";")),U,2)
"RTN","GMRAGUI1",106,0)
 D UPDATE^DIE("","FDA","IEN")
"RTN","GMRAGUI1",107,0)
 S:NEW GMRAIEN=IEN(1)
"RTN","GMRAGUI1",108,0)
 K FDA
"RTN","GMRAGUI1",109,0)
 F SUB="GMRACHT","GMRAIDBN" D
"RTN","GMRAGUI1",110,0)
 .Q:'$D(@GMRARRAY@(SUB))  ;Stop if no updates
"RTN","GMRAGUI1",111,0)
 .S FILE=$S(SUB="GMRACHT":120.813,1:120.814)
"RTN","GMRAGUI1",112,0)
 .S FDA(FILE,"+1,"_GMRAIEN_",",.01)=@GMRARRAY@(SUB,1)
"RTN","GMRAGUI1",113,0)
 .S FDA(FILE,"+1,"_GMRAIEN_",",1)=DUZ
"RTN","GMRAGUI1",114,0)
 .D UPDATE^DIE("","FDA")
"RTN","GMRAGUI1",115,0)
 I $D(@GMRARRAY@("GMRACMTS")) D ADCOM(GMRAIEN,"O",$NA(@GMRARRAY@("GMRACMTS"))) ;Add comments if included
"RTN","GMRAGUI1",116,0)
 K FDA
"RTN","GMRAGUI1",117,0)
 S SUB=0 F  S SUB=$O(@GMRARRAY@("GMRASYMP",SUB)) Q:'+SUB  D
"RTN","GMRAGUI1",118,0)
 .S GMRAS0=^(SUB) ;Naked from above
"RTN","GMRAGUI1",119,0)
 .Q:$P(^(SUB),U)=""  ;25 No text or free text entered so don't store
"RTN","GMRAGUI1",120,0)
 .S SIEN=$O(^GMR(120.8,GMRAIEN,10,"B",$P(GMRAS0,U),0))
"RTN","GMRAGUI1",121,0)
 .I SIEN,$P(^GMR(120.8,GMRAIEN,10,SIEN,0),U,4)=$P(GMRAS0,U,3) Q  ;Exists and nothing has changed
"RTN","GMRAGUI1",122,0)
 .I SIEN,$P(GMRAS0,U,5)="@" S DIK="^GMR(120.8,"_GMRAIEN_",",DA(1)=GMRAIEN,DA=SIEN D ^DIK Q  ;Sign/symptom deleted
"RTN","GMRAGUI1",123,0)
 .S:'SIEN FDA(120.81,"+1,"_GMRAIEN_",",.01)=$S($P(GMRAS0,U)="FT":$O(^GMRD(120.83,"B","OTHER REACTION",0)),1:$P(GMRAS0,U))
"RTN","GMRAGUI1",124,0)
 .S NODE=$S(SIEN:SIEN_","_GMRAIEN,1:"+1,"_GMRAIEN_",")
"RTN","GMRAGUI1",125,0)
 .S:$P(GMRAS0,U)="FT" FDA(120.81,NODE,1)=$P(GMRAS0,U,2)
"RTN","GMRAGUI1",126,0)
 .S FDA(120.81,NODE,2)=DUZ
"RTN","GMRAGUI1",127,0)
 .S FDA(120.81,NODE,3)=$P(GMRAS0,U,3)
"RTN","GMRAGUI1",128,0)
 .D UPDATE^DIE("","FDA","","ERR")
"RTN","GMRAGUI1",129,0)
 .S GMRAROT($P(GMRAS0,U,2))="" ;21 record s/s added
"RTN","GMRAGUI1",130,0)
 I NEW D
"RTN","GMRAGUI1",131,0)
 .S GMRALL(GMRAIEN)="" D VAD^GMRAUTL1(DFN,,.GMRALOC,.GMRANAM) D EN7^GMRAMCB ;Send mark chart/ID band bulletin if needed.
"RTN","GMRAGUI1",132,0)
 .I $P(@GMRARRAY@("GMRAOBHX"),U)="o" D  ;if observed reaction add data to 120.85
"RTN","GMRAGUI1",133,0)
 ..S GMRAOUT=0 ;21
"RTN","GMRAGUI1",134,0)
 ..S GMRAL(GMRAIEN,"O",GMRAIEN)=$G(@GMRARRAY@("GMRARDT"))_"^"_$G(@GMRARRAY@("GMRASEVR"))
"RTN","GMRAGUI1",135,0)
 ..S GMRADFN=DFN
"RTN","GMRAGUI1",136,0)
 ..S GMRAL(GMRAIEN)="^^"_$P($G(@GMRARRAY@("GMRAGNT")),U)_"^^^^"_$G(@GMRARRAY@("GMRAORIG"))
"RTN","GMRAGUI1",137,0)
 ..M GMRAL(GMRAIEN,"S")=@GMRARRAY@("GMRASYMP")
"RTN","GMRAGUI1",138,0)
 ..S SUB=0 F  S SUB=$O(GMRAL(GMRAIEN,"S",SUB)) Q:'+SUB  S $P(GMRAL(GMRAIEN,"S",SUB),U,2)=$P(GMRAL(GMRAIEN,"S",SUB),U,2)_"^" S:$P(GMRAL(GMRAIEN,"S",SUB),U)="FT" $P(GMRAL(GMRAIEN,"S",SUB),U)=$O(^GMRD(120.83,"B","OTHER REACTION",0))
"RTN","GMRAGUI1",139,0)
 ..S GMRAL=GMRAIEN
"RTN","GMRAGUI1",140,0)
 ..D ADVERSE^GMRAOR7(GMRAIEN,.GMRAL) ;adds entry to 120.85
"RTN","GMRAGUI1",141,0)
 ..S GMRAIEN(GMRAIEN)="" ;21
"RTN","GMRAGUI1",142,0)
 ..D EN1^GMRAPET0(GMRADFN,.GMRAIEN,"S",.GMRAOUT) ;21 File progress note
"RTN","GMRAGUI1",143,0)
 ..I $G(@GMRARRAY@("GMRATYPE"))["D" S GMRAPA=GMRAIEN D EN1^GMRAPTB ;21 Send med-watch update
"RTN","GMRAGUI1",144,0)
 .S GMRAAR=$P($G(@GMRARRAY@("GMRAGNT")),U,2),GMRAPA=GMRAIEN
"RTN","GMRAGUI1",145,0)
 .D EN1^GMRAOR9 S ^TMP($J,"GMRASF",1,GMRAPA)="" D RANGE^GMRASIGN(1) ;add ingredients/classes send appropriate bulletins
"RTN","GMRAGUI1",146,0)
 S ORY=0
"RTN","GMRAGUI1",147,0)
 L -^XTMP("GMRAED",DFN)
"RTN","GMRAGUI1",148,0)
 Q
"RTN","GMRAGUI1",149,0)
 ;
"RTN","GMRAGUI1",150,0)
MESS ;Give out locked message
"RTN","GMRAGUI1",151,0)
 N GMRAXBOS,GMRAL1,GMRAL2
"RTN","GMRAGUI1",152,0)
 S GMRAXBOS=$$BROKER^XWBLIB ;In GUI?
"RTN","GMRAGUI1",153,0)
 S GMRAL1="Another user is editing this patient's allergy information."
"RTN","GMRAGUI1",154,0)
 S GMRAL2="Please refresh/review the patient's information before proceeding."
"RTN","GMRAGUI1",155,0)
 I 'GMRAXBOS W !,GMRAL1,!,GMRAL2 D WAIT^GMRAFX3 Q
"RTN","GMRAGUI1",156,0)
 S ORY="-1^"_GMRAL1_"  "_GMRAL2
"RTN","GMRAGUI1",157,0)
 Q
"RTN","GMRAY25")
0^2^B9257324
"RTN","GMRAY25",1,0)
GMRAY25 ;SLC/DAN Post-install routine ;6/8/05  14:33
"RTN","GMRAY25",2,0)
 ;;4.0;Adverse Reaction Tracking;**25**;Mar 29, 1996
"RTN","GMRAY25",3,0)
 ;
"RTN","GMRAY25",4,0)
POST ;Post-install entry point
"RTN","GMRAY25",5,0)
 D IDENTSS
"RTN","GMRAY25",6,0)
 D MAIL
"RTN","GMRAY25",7,0)
 Q
"RTN","GMRAY25",8,0)
 ;
"RTN","GMRAY25",9,0)
IDENTSS ;Identify entries that may not have had their signs/symptoms correctly stored, which may also have caused other important datt to not be stored
"RTN","GMRAY25",10,0)
 N GMRAIEN,GMRA0
"RTN","GMRAY25",11,0)
 S GMRAIEN=0 F  S GMRAIEN=$O(^GMR(120.8,GMRAIEN)) Q:'+GMRAIEN  D
"RTN","GMRAY25",12,0)
 .S GMRA0=$G(^GMR(120.8,GMRAIEN,0))
"RTN","GMRAY25",13,0)
 .Q:$P(GMRA0,U,12)'=""  ;Stop if signed off field has a value
"RTN","GMRAY25",14,0)
 .Q:$$TESTPAT^VADPT($P(GMRA0,U))  ;Stop if test patient
"RTN","GMRAY25",15,0)
 .Q:$P($G(^GMR(120.8,GMRAIEN,"ER")),U)  ;Stop if entered in error
"RTN","GMRAY25",16,0)
 .Q:$P(GMRA0,U,4)<3040101  ;Stop if entry of allergy predates v25 installation
"RTN","GMRAY25",17,0)
 .S ARRAY($$GET1^DIQ(2,$P(GMRA0,U)_",",.01)_" ("_$E($$GET1^DIQ(2,$P(GMRA0,U)_",",.09),6,9)_")",$P(GMRA0,U,2))="" ;Store pt name and reactant
"RTN","GMRAY25",18,0)
 Q
"RTN","GMRAY25",19,0)
 ;
"RTN","GMRAY25",20,0)
MAIL ;Send message indicating post install is finished
"RTN","GMRAY25",21,0)
 N XMSUB,XMTEXT,XMDUZ,XMY,XMZ,GMRATXT,CNT,REACTANT,DIFROM,PNAME
"RTN","GMRAY25",22,0)
 S XMDUZ="PATCH GMRA*4*25 POST-INSTALL",XMY(.5)="" S:$G(DUZ) XMY(DUZ)=""
"RTN","GMRAY25",23,0)
 S GMRATXT(1)="The post-install routine for patch GMRA*4*25"
"RTN","GMRAY25",24,0)
 S GMRATXT(2)="finished on "_$$FMTE^XLFDT($$NOW^XLFDT)_"."
"RTN","GMRAY25",25,0)
 S GMRATXT(3)=""
"RTN","GMRAY25",26,0)
 S CNT=3
"RTN","GMRAY25",27,0)
 I $D(ARRAY) D
"RTN","GMRAY25",28,0)
 .S CNT=CNT+1,GMRATXT(CNT)="The following patients have allergies on file that may be missing"
"RTN","GMRAY25",29,0)
 .S CNT=CNT+1,GMRATXT(CNT)="important data required for order checking due to an error when the allergy"
"RTN","GMRAY25",30,0)
 .S CNT=CNT+1,GMRATXT(CNT)="was saved.  If the user selected the space or dashed line from the"
"RTN","GMRAY25",31,0)
 .S CNT=CNT+1,GMRATXT(CNT)="signs/symptoms box then the allergy would not have been saved correctly and"
"RTN","GMRAY25",32,0)
 .S CNT=CNT+1,GMRATXT(CNT)="needs to be reviewed for accuracy.  The recommended course of action is to"
"RTN","GMRAY25",33,0)
 .S CNT=CNT+1,GMRATXT(CNT)="mark the existing allergy as entered in error and then re-enter the allergy"
"RTN","GMRAY25",34,0)
 .S CNT=CNT+1,GMRATXT(CNT)="information for the patient."
"RTN","GMRAY25",35,0)
 .S CNT=CNT+1,GMRATXT(CNT)=""
"RTN","GMRAY25",36,0)
 .S PNAME="" F  S PNAME=$O(ARRAY(PNAME)) Q:PNAME=""  D
"RTN","GMRAY25",37,0)
 ..S CNT=CNT+1,GMRATXT(CNT)=PNAME
"RTN","GMRAY25",38,0)
 ..S REACTANT="" F  S REACTANT=$O(ARRAY(PNAME,REACTANT)) Q:REACTANT=""  D
"RTN","GMRAY25",39,0)
 ...S CNT=CNT+1,GMRATXT(CNT)="  "_REACTANT
"RTN","GMRAY25",40,0)
 ..S CNT=CNT+1,GMRATXT(CNT)=""
"RTN","GMRAY25",41,0)
 S XMTEXT="GMRATXT(",XMSUB="PATCH GMRA*4*25 Post Install COMPLETED"
"RTN","GMRAY25",42,0)
 D ^XMD
"RTN","GMRAY25",43,0)
 Q
"VER")
8.0^22.0
"BLD",5674,6)
^SEQ #23
**END**
**END**
