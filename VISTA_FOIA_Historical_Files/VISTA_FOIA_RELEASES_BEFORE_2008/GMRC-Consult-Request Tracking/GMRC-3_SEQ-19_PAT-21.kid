Released GMRC*3*21 SEQ #19
Extracted from mail message
**KIDS**:GMRC*3.0*21^

**INSTALL NAME**
GMRC*3.0*21
"BLD",2814,0)
GMRC*3.0*21^CONSULT/REQUEST TRACKING^0^3010711^y
"BLD",2814,1,0)
^^1^1^3010418^^^
"BLD",2814,1,1,0)
Build can be found on the National Patch Module under Patch GMRC*3.0*21.
"BLD",2814,4,0)
^9.64PA^123.5^3
"BLD",2814,4,123,0)
123
"BLD",2814,4,123,2,0)
^9.641^123.02^1
"BLD",2814,4,123,2,123.02,0)
REQUEST PROCESSING ACTIVITY  (sub-file)
"BLD",2814,4,123,2,123.02,1,0)
^9.6411^2^2
"BLD",2814,4,123,2,123.02,1,.01,0)
DATE/TIME OF ACTION ENTRY
"BLD",2814,4,123,2,123.02,1,2,0)
DATE/TIME OF ACTUAL ACTIVITY
"BLD",2814,4,123,222)
y^y^p^^^^n
"BLD",2814,4,123.1,0)
123.1
"BLD",2814,4,123.1,222)
n^y^f^^n^^y^r^n
"BLD",2814,4,123.1,223)

"BLD",2814,4,123.1,224)
I (Y=1)!(Y=2)
"BLD",2814,4,123.5,0)
123.5
"BLD",2814,4,123.5,2,0)
^9.641^123.51^1
"BLD",2814,4,123.5,2,123.51,0)
.01  (sub-file)
"BLD",2814,4,123.5,2,123.51,1,0)
^9.6411^.01^1
"BLD",2814,4,123.5,2,123.51,1,.01,0)
SUB-SERVICE/SPECIALTY
"BLD",2814,4,123.5,222)
y^y^p^^^^n
"BLD",2814,4,"APDD",123,123.02)

"BLD",2814,4,"APDD",123,123.02,.01)

"BLD",2814,4,"APDD",123,123.02,2)

"BLD",2814,4,"APDD",123.5,123.51)

"BLD",2814,4,"APDD",123.5,123.51,.01)

"BLD",2814,4,"B",123,123)

"BLD",2814,4,"B",123.1,123.1)

"BLD",2814,4,"B",123.5,123.5)

"BLD",2814,"ABPKG")
n
"BLD",2814,"INID")
^y
"BLD",2814,"INIT")
GMRCYP21
"BLD",2814,"KRN",0)
^9.67PA^19^17
"BLD",2814,"KRN",.4,0)
.4
"BLD",2814,"KRN",.401,0)
.401
"BLD",2814,"KRN",.402,0)
.402
"BLD",2814,"KRN",.403,0)
.403
"BLD",2814,"KRN",.5,0)
.5
"BLD",2814,"KRN",.84,0)
.84
"BLD",2814,"KRN",3.6,0)
3.6
"BLD",2814,"KRN",3.8,0)
3.8
"BLD",2814,"KRN",9.2,0)
9.2
"BLD",2814,"KRN",9.8,0)
9.8
"BLD",2814,"KRN",9.8,"NM",0)
^9.68A^13^12
"BLD",2814,"KRN",9.8,"NM",2,0)
GMRCTIU1^^0^B24070834
"BLD",2814,"KRN",9.8,"NM",3,0)
GMRCHL7B^^0^B17282245
"BLD",2814,"KRN",9.8,"NM",4,0)
GMRCUTL1^^0^B9504563
"BLD",2814,"KRN",9.8,"NM",5,0)
GMRCP5A^^0^B68074897
"BLD",2814,"KRN",9.8,"NM",6,0)
GMRCPC^^0^B10508967
"BLD",2814,"KRN",9.8,"NM",7,0)
GMRCSTL2^^0^B11548715
"BLD",2814,"KRN",9.8,"NM",8,0)
GMRCSTLM^^0^B45219250
"BLD",2814,"KRN",9.8,"NM",9,0)
GMRCSTL1^^0^B9817212
"BLD",2814,"KRN",9.8,"NM",10,0)
GMRCHL7A^^0^B29143743
"BLD",2814,"KRN",9.8,"NM",11,0)
GMRCHL7U^^0^B22721100
"BLD",2814,"KRN",9.8,"NM",12,0)
GMRCSTS^^0^B42769284
"BLD",2814,"KRN",9.8,"NM",13,0)
GMRCSTS1^^0^B29194073
"BLD",2814,"KRN",9.8,"NM","B","GMRCHL7A",10)

"BLD",2814,"KRN",9.8,"NM","B","GMRCHL7B",3)

"BLD",2814,"KRN",9.8,"NM","B","GMRCHL7U",11)

"BLD",2814,"KRN",9.8,"NM","B","GMRCP5A",5)

"BLD",2814,"KRN",9.8,"NM","B","GMRCPC",6)

"BLD",2814,"KRN",9.8,"NM","B","GMRCSTL1",9)

"BLD",2814,"KRN",9.8,"NM","B","GMRCSTL2",7)

"BLD",2814,"KRN",9.8,"NM","B","GMRCSTLM",8)

"BLD",2814,"KRN",9.8,"NM","B","GMRCSTS",12)

"BLD",2814,"KRN",9.8,"NM","B","GMRCSTS1",13)

"BLD",2814,"KRN",9.8,"NM","B","GMRCTIU1",2)

"BLD",2814,"KRN",9.8,"NM","B","GMRCUTL1",4)

"BLD",2814,"KRN",19,0)
19
"BLD",2814,"KRN",19,"NM",0)
^9.68A^^0
"BLD",2814,"KRN",19.1,0)
19.1
"BLD",2814,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",2814,"KRN",101,0)
101
"BLD",2814,"KRN",409.61,0)
409.61
"BLD",2814,"KRN",771,0)
771
"BLD",2814,"KRN",870,0)
870
"BLD",2814,"KRN",8994,0)
8994
"BLD",2814,"KRN","B",.4,.4)

"BLD",2814,"KRN","B",.401,.401)

"BLD",2814,"KRN","B",.402,.402)

"BLD",2814,"KRN","B",.403,.403)

"BLD",2814,"KRN","B",.5,.5)

"BLD",2814,"KRN","B",.84,.84)

"BLD",2814,"KRN","B",3.6,3.6)

"BLD",2814,"KRN","B",3.8,3.8)

"BLD",2814,"KRN","B",9.2,9.2)

"BLD",2814,"KRN","B",9.8,9.8)

"BLD",2814,"KRN","B",19,19)

"BLD",2814,"KRN","B",19.1,19.1)

"BLD",2814,"KRN","B",101,101)

"BLD",2814,"KRN","B",409.61,409.61)

"BLD",2814,"KRN","B",771,771)

"BLD",2814,"KRN","B",870,870)

"BLD",2814,"KRN","B",8994,8994)

"BLD",2814,"QUES",0)
^9.62^^
"BLD",2814,"REQB",0)
^9.611^2^2
"BLD",2814,"REQB",1,0)
GMRC*3.0*11^2
"BLD",2814,"REQB",2,0)
GMRC*3.0*15^2
"BLD",2814,"REQB","B","GMRC*3.0*11",1)

"BLD",2814,"REQB","B","GMRC*3.0*15",2)

"DATA",123.1,1,0)
ENTERED IN CPRS^^^USE CPRS RELEASE ORDER AFTER PATCH #21^  ^^^^
"DATA",123.1,2,0)
CPRS RELEASED ORDER^5^^^^NW^IP
"FIA",123)
REQUEST/CONSULTATION
"FIA",123,0)
^GMR(123,
"FIA",123,0,0)
123DI
"FIA",123,0,1)
y^y^p^^^^n
"FIA",123,0,10)

"FIA",123,0,11)

"FIA",123,0,"RLRO")

"FIA",123,0,"VR")
3.0^GMRC
"FIA",123,123)
1
"FIA",123,123,40)

"FIA",123,123.02)
1
"FIA",123,123.02,.01)

"FIA",123,123.02,2)

"FIA",123.1)
REQUEST ACTION TYPES
"FIA",123.1,0)
^GMR(123.1,
"FIA",123.1,0,0)
123.1
"FIA",123.1,0,1)
n^y^f^^n^^y^r^n
"FIA",123.1,0,10)

"FIA",123.1,0,11)
I (Y=1)!(Y=2)
"FIA",123.1,0,"RLRO")

"FIA",123.1,0,"VR")
3.0^GMRC
"FIA",123.1,123.1)
0
"FIA",123.5)
REQUEST SERVICES
"FIA",123.5,0)
^GMR(123.5,
"FIA",123.5,0,0)
123.5I
"FIA",123.5,0,1)
y^y^p^^^^n
"FIA",123.5,0,10)

"FIA",123.5,0,11)

"FIA",123.5,0,"RLRO")

"FIA",123.5,0,"VR")
3.0^GMRC
"FIA",123.5,123.5)
1
"FIA",123.5,123.5,10)

"FIA",123.5,123.51)
1
"FIA",123.5,123.51,.01)

"INIT")
GMRCYP21
"MBREQ")
0
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
21^3010711
"PKG",128,22,1,"PAH",1,1,0)
^^1^1^3010711
"PKG",128,22,1,"PAH",1,1,1,0)
Build can be found on the National Patch Module under Patch GMRC*3.0*21.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","GMRCHL7A")
0^10^B29143743
"RTN","GMRCHL7A",1,0)
GMRCHL7A ;SLC/DCM,MA - Receive HL-7 Message form OERR and break it into its components and store it in File 123 ;4/18/01  10:28
"RTN","GMRCHL7A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15,21**;DEC 27, 1997
"RTN","GMRCHL7A",3,0)
 ; This routine invokes IA #2849
"RTN","GMRCHL7A",4,0)
URG(X) ;Return Urgency give Z-code from HL-7 segment; see ORC+9
"RTN","GMRCHL7A",5,0)
 S X=$S(X="S":"STAT",X="R":"ROUTINE",X="ZT":"TODAY",X="Z24":"WITHIN 24 HOURS",X="Z48":"WITHIN 48 HOURS",X="Z72":"WITHIN 72 HOURS",X="ZW":"WITHIN 1 WEEK",X="ZM":"WITHIN 1 MONTH",X="ZNA":"NEXT AVAILABLE",1:X)
"RTN","GMRCHL7A",6,0)
 I $E(X,1)="Z" S X=$S(X="ZT":"TODAY",X="ZE":"EMERGENCY",1:"")
"RTN","GMRCHL7A",7,0)
 Q X
"RTN","GMRCHL7A",8,0)
 ;
"RTN","GMRCHL7A",9,0)
ORC(GMRCORC) ;Get fields from ORC segment and set into GMRC variables
"RTN","GMRCHL7A",10,0)
 ;GMRCTRLC=ORC control code from HL7 Table 119
"RTN","GMRCHL7A",11,0)
 ;GMRCURGI=priority/urgency     GMRCPLCR=who entered the order
"RTN","GMRCHL7A",12,0)
 ;GMRCORNP=provider             GMRCNATO=nature of order
"RTN","GMRCHL7A",13,0)
 ;GMRCAD=date of request        GMRCOCR=order request reason
"RTN","GMRCHL7A",14,0)
 ;GMRCORFN=oe/rr file number    GMRCO=file 123 IEN - if not a new order
"RTN","GMRCHL7A",15,0)
 ;GMRCS38=order status - taken from Table 38, HL7 standard
"RTN","GMRCHL7A",16,0)
 S GMRCTRLC=$P(GMRCORC,SEP1,2),GMRCORFN=$P(GMRCORC,SEP1,3),GMRCORFN=$P($P(GMRCORFN,SEP2,1),";",1),GMRCAPP=$P($P(GMRCORC,SEP1,3),SEP2,2)
"RTN","GMRCHL7A",17,0)
 S GMRCS38=$P(GMRCORC,SEP1,6),GMRCURGI=$P($P(GMRCORC,SEP1,8),SEP2,6),GMRCPLCR=$P(GMRCORC,SEP1,11),GMRCORNP=$P(GMRCORC,SEP1,13)
"RTN","GMRCHL7A",18,0)
 I $L(GMRCURGI) S GMRCURGI="GMRCURGENCY - "_$$URG(GMRCURGI),GMRCURGI=$O(^ORD(101,"B",GMRCURGI,0))
"RTN","GMRCHL7A",19,0)
 S GMRCO=+$P($P(GMRCORC,SEP1,4),SEP2,1)
"RTN","GMRCHL7A",20,0)
 S GMRCODT=$P(GMRCORC,SEP1,16),GMRCAD=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",21,0)
 S GMRCOCR=$P(GMRCORC,SEP1,17),GMRCNATO=$P(GMRCOCR,SEP2,5)
"RTN","GMRCHL7A",22,0)
 Q
"RTN","GMRCHL7A",23,0)
OBR(GMRCOBR) ;Get fields from OBR segment and set into GMRC variables
"RTN","GMRCHL7A",24,0)
 ;GMRCTYPE=GMRC consult or GMRC request  GMRCSS=To Service
"RTN","GMRCHL7A",25,0)
 ;GMRCPLI=place of consultation          GMRCODT=observation date/time
"RTN","GMRCHL7A",26,0)
 ;GMRCATN=person to alert (attention)    GMRCSTDT=status change date/time
"RTN","GMRCHL7A",27,0)
 ;GMRCS123=results status (table 123)    GMRCINTR=results interpreter
"RTN","GMRCHL7A",28,0)
 ;GMRCPRI=procedure from file ^ORD(101,  
"RTN","GMRCHL7A",29,0)
 ;GMRCXMF=foreign consult service
"RTN","GMRCHL7A",30,0)
 ;        a flag that tells the HL7 routine that
"RTN","GMRCHL7A",31,0)
 ;        consults does not need to return CPRS a file
"RTN","GMRCHL7A",32,0)
 ;        IEN for file 123. See routine ^GMRCXMF
"RTN","GMRCHL7A",33,0)
 S GMRCPR=$P($P(GMRCOBR,SEP1,5),SEP2,6)
"RTN","GMRCHL7A",34,0)
 S GMRCTYPE=$S(GMRCPR="99PRC":"P",1:"C")
"RTN","GMRCHL7A",35,0)
 S GMRCPRI="",GMRCSS=""
"RTN","GMRCHL7A",36,0)
 I GMRCPR="99PRC" D
"RTN","GMRCHL7A",37,0)
 . S GMRCPRI=$P($P(GMRCOBR,SEP1,5),SEP2,4)
"RTN","GMRCHL7A",38,0)
 . S GMRCPRI=$S(+GMRCPRI:GMRCPRI_";GMR(123.3,",1:"")
"RTN","GMRCHL7A",39,0)
 . Q
"RTN","GMRCHL7A",40,0)
 ;
"RTN","GMRCHL7A",41,0)
 S GMRCOTXT=$P($P(GMRCOBR,SEP1,5),SEP2,5) ;consult type or service name
"RTN","GMRCHL7A",42,0)
 S GMRCODT=$P(GMRCOBR,SEP1,7) I GMRCODT]"" S GMRCODT=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",43,0)
 S GMRCPLI=$P(GMRCOBR,SEP1,19) I GMRCPLI]"" S GMRCPLI="GMRCPLACE - "_$S(GMRCPLI="OC":"ON CALL",GMRCPLI="B":"BEDSIDE",GMRCPLI="E":"EMERGENCY ROOM",1:GMRCPLI),GMRCPLI=$O(^ORD(101,"B",GMRCPLI,0))
"RTN","GMRCHL7A",44,0)
 S GMRCATN=$P(GMRCOBR,SEP1,20),GMRCSTDT=$P(GMRCOBR,SEP1,23),GMRCSTDT=$$FMDATE^GMRCHL7(GMRCSTDT)
"RTN","GMRCHL7A",45,0)
 S GMRCS123=$P(GMRCOBR,SEP1,26),GMRCINTR=$P(GMRCOBR,SEP1,33)
"RTN","GMRCHL7A",46,0)
 Q
"RTN","GMRCHL7A",47,0)
ZSV(GMRCZSV) ;Get service from ZSV segment and set into GMRCSS
"RTN","GMRCHL7A",48,0)
 S GMRCZSS=$P($P(GMRCZSV,SEP1,2),SEP2,4)
"RTN","GMRCHL7A",49,0)
 I +$G(GMRCZSS) S GMRCSS=+$G(GMRCZSS) ;Set the service if ZSV provided
"RTN","GMRCHL7A",50,0)
 I $L($P(GMRCZSV,"|",3)) S GMRCOTXT=$P(GMRCZSV,"|",3) ;consult type
"RTN","GMRCHL7A",51,0)
 Q
"RTN","GMRCHL7A",52,0)
OBX(GMRCOBX) ;Get fields from OBX segment and set into GMRC variables
"RTN","GMRCHL7A",53,0)
 ;GMRCVTYP=Value type from table 123 - i.e. TX(text), ST(string data),etc.
"RTN","GMRCHL7A",54,0)
 ;GMRCOID=observation id identifying value in seg. 5
"RTN","GMRCHL7A",55,0)
 ;GMRCVAL=observation value coded by segment 3
"RTN","GMRCHL7A",56,0)
 ;GMRCPRDG=provisional diagnosis
"RTN","GMRCHL7A",57,0)
 ;    free text or code^free text^I9C
"RTN","GMRCHL7A",58,0)
 S GMRCMSG=MSG(GMRCOBX)
"RTN","GMRCHL7A",59,0)
 S GMRCVTYP=$P(GMRCMSG,SEP1,3),GMRCOID=$P($P(GMRCMSG,SEP1,4),SEP2,2),GMRCVAL=$P(GMRCOID,SEP2,3)
"RTN","GMRCHL7A",60,0)
 I GMRCOID="REASON FOR REQUEST" D
"RTN","GMRCHL7A",61,0)
 .S GMRCRFQ(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",62,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCRFQ(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",63,0)
 .Q
"RTN","GMRCHL7A",64,0)
 I GMRCOID="PROVISIONAL DIAGNOSIS" D  Q
"RTN","GMRCHL7A",65,0)
 . I GMRCVTYP="TX" S GMRCPRDG=$P(GMRCMSG,SEP1,6) Q
"RTN","GMRCHL7A",66,0)
 . I GMRCVTYP="CE" D  Q
"RTN","GMRCHL7A",67,0)
 .. N PRDXSEG S PRDXSEG=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",68,0)
 .. S GMRCPRDG=$P(PRDXSEG,"^",2)_" ("_$P(PRDXSEG,"^")_")"
"RTN","GMRCHL7A",69,0)
 .. S GMRCPRCD=$P(PRDXSEG,"^")
"RTN","GMRCHL7A",70,0)
 I GMRCOID["COMMENT" D
"RTN","GMRCHL7A",71,0)
 .S GMRCCMT(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",72,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCCMT(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",73,0)
 .Q
"RTN","GMRCHL7A",74,0)
 K LN
"RTN","GMRCHL7A",75,0)
 Q
"RTN","GMRCHL7A",76,0)
EN(MSG) ;Entry point to routine
"RTN","GMRCHL7A",77,0)
 ;MSG = local array which contains the HL-7 segments
"RTN","GMRCHL7A",78,0)
 ;GMRCSEND=sending application   GMRCFAC=sending facility
"RTN","GMRCHL7A",79,0)
 ;GMRCMTP=message type
"RTN","GMRCHL7A",80,0)
 N DFN,GMRCACT,GMRCADD,GMRCFAC,GMRCMTP,GMRCPNM,GMRCO,GMRCOCR,GMRCORNP
"RTN","GMRCHL7A",81,0)
 N GMRCORFN,GMRCPLCR,GMRCRB,GMRCSEND,GMRCSTS,GMRCTRLC,GMRCWARD,ORIFN
"RTN","GMRCHL7A",82,0)
 N GMRCTRLC,GMRCAD,ORC,GMRCSBR,GMRCZSS,GMRCSS,GMRCOTXT,GMRCPRCD
"RTN","GMRCHL7A",83,0)
 S GMRCMSG="",GMRCNOD=0 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) I $E(GMRCMSG,1,3)="MSH" D INIT^GMRCHL7U(GMRCMSG) D  Q
"RTN","GMRCHL7A",84,0)
 .S GMRCSEND=$P(GMRCMSG,SEP1,3),GMRCFAC=$P(GMRCMSG,SEP1,4),GMRCMTP=$P(GMRCMSG,SEP1,9)
"RTN","GMRCHL7A",85,0)
 .Q
"RTN","GMRCHL7A",86,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCHL7A",87,0)
 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) D
"RTN","GMRCHL7A",88,0)
 .I $E(GMRCMSG,1,3)="PID" D PID^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",89,0)
 .I $E(GMRCMSG,1,3)="PV1" D PV1^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",90,0)
 .I $E(GMRCMSG,1,3)="ORC" D ORC(GMRCMSG) Q
"RTN","GMRCHL7A",91,0)
 .I $E(GMRCMSG,1,3)="OBR" D OBR(GMRCMSG) Q
"RTN","GMRCHL7A",92,0)
 .I $E(GMRCMSG,1,3)="ZSV" D ZSV(GMRCMSG) Q
"RTN","GMRCHL7A",93,0)
 .I $E(GMRCMSG,1,3)="OBX" D OBX(GMRCNOD) Q
"RTN","GMRCHL7A",94,0)
 .I $E(GMRCMSG,1,3)="NTE" D NTE^GMRCHL7U(.MSG,GMRCNOD,GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",95,0)
 .I $E(GMRCMSG,1,3)="ZXX" S GMRCOFN=+$P(GMRCMSG,SEP1,2) K MSG(GMRCNOD) Q 
"RTN","GMRCHL7A",96,0)
 .Q
"RTN","GMRCHL7A",97,0)
 ;Note, ZXX is not used yet; planned for future sharing consults with foreign facilities.
"RTN","GMRCHL7A",98,0)
 I '$D(GMRCTRLC) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",99,0)
 I GMRCTRLC="Z@" D CPRSPURG^GMRCPURG(+GMRCO),EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",100,0)
 I GMRCTRLC="NW" D NEW^GMRCHL7B D
"RTN","GMRCHL7A",101,0)
 . I $G(GMRCO) D RETURN^GMRCHL7U(GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",102,0)
 . D REJECT^GMRCHL7U(.MSG,"unable to file order")
"RTN","GMRCHL7A",103,0)
 I $D(GMRCXMF) D
"RTN","GMRCHL7A",104,0)
 .;Set GMRCO=to the file number at this site for a new consult/request before sending HL-7 message to CPRS
"RTN","GMRCHL7A",105,0)
 .S GMRCNOD=0 F  S GMRCNOD=$O(@GMRCMSG(ND)) Q:GMRCNOD=""  I $P(@(GMRCMSG(GMRCNOD)),"|",1)="ORC" S $P(@(GMRCMSG(GMRCNOD)),"|",3)=$G(GMRCO) Q
"RTN","GMRCHL7A",106,0)
 .Q
"RTN","GMRCHL7A",107,0)
 I '$D(GMRCO) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",108,0)
 I $S(GMRCTRLC="CA":1,GMRCTRLC="DC":1,1:0) D DC^GMRCHL7B(GMRCO,GMRCTRLC),RETURN^GMRCHL7U(GMRCO,GMRCTRLC)
"RTN","GMRCHL7A",109,0)
 I GMRCTRLC="NA" D RTN(GMRCORFN,GMRCO)
"RTN","GMRCHL7A",110,0)
 I GMRCTRLC="XX" D MODIFY^GMRCHL7B ;Not currently returned by CPRS
"RTN","GMRCHL7A",111,0)
 ; If consults sends an XX, CPRS returns an NA.
"RTN","GMRCHL7A",112,0)
 D EXIT^GMRCHL7U
"RTN","GMRCHL7A",113,0)
 Q
"RTN","GMRCHL7A",114,0)
RTN(GMRCORN,DA) ;Put ^OR(100, ien for order into ^GMR(123, 
"RTN","GMRCHL7A",115,0)
 S DIE="^GMR(123,",DR=".03////^S X=GMRCORN"
"RTN","GMRCHL7A",116,0)
 L +^GMR(123,DA) D ^DIE L -^GMR(123,DA)
"RTN","GMRCHL7A",117,0)
 K DIE,DR
"RTN","GMRCHL7A",118,0)
 Q
"RTN","GMRCHL7B")
0^3^B17282245
"RTN","GMRCHL7B",1,0)
GMRCHL7B ;SLC/DCM,MA - Process order parameters from ^GMRCHL7A and place data into ^GMR(123 global ;4/18/01  10:28
"RTN","GMRCHL7B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,21**;DEC 27, 1997
"RTN","GMRCHL7B",3,0)
 ; Patch #21 changed Activity title on Consult detail display
"RTN","GMRCHL7B",4,0)
 ; from "ENTERED IN CPRS" to "CPRS RELEASED ORDER".
"RTN","GMRCHL7B",5,0)
NEW ;Add new order
"RTN","GMRCHL7B",6,0)
 ;GMRCO=^GMR(123,IFN, the new file number in file ^GMR(123,
"RTN","GMRCHL7B",7,0)
 ;GMRCORFN=OE/RR file number       GMRCWARD=ward patient is on
"RTN","GMRCHL7B",8,0)
 ;GMRCSS=service consult sent to   GMRCAD=date/time of request
"RTN","GMRCHL7B",9,0)
 ;GMRCPRI=procedure/request        GMRCURGI=urgency
"RTN","GMRCHL7B",10,0)
 ;GMRCATN=attention                GMRCSTS=OE/RR order status
"RTN","GMRCHL7B",11,0)
 ;GMRCORNP=patient's provider      GMRCTYPE=request type (request or consult)
"RTN","GMRCHL7B",12,0)
 ;GMRCSBR=service rendered on what basis (Inpatient, or Outpatient)
"RTN","GMRCHL7B",13,0)
 ;GMRCRFQ=reason for request array - word processing fields
"RTN","GMRCHL7B",14,0)
 ;GMRCOTXT=order display text from dialog or orderable item
"RTN","GMRCHL7B",15,0)
 ;GMRCPRDG=provisional DX
"RTN","GMRCHL7B",16,0)
 ;GMRCPRCD=provisional DX code 
"RTN","GMRCHL7B",17,0)
 N DIC,DLAYGO,X,DR,DIE,GMRCADUZ
"RTN","GMRCHL7B",18,0)
 S DIC="^GMR(123,",DIC(0)="L",X="""N""",DLAYGO=123 D ^DIC K DLAYGO Q:Y<1
"RTN","GMRCHL7B",19,0)
 ; Patch #21 changed GMRCA=1 to GMRCA=2
"RTN","GMRCHL7B",20,0)
 S (DA,GMRCO)=+Y,GMRCSTS=5,GMRCA=2,DIE=DIC
"RTN","GMRCHL7B",21,0)
 L +^GMR(123,GMRCO)
"RTN","GMRCHL7B",22,0)
 S DR=".02////^S X=DFN;.03////^S X=GMRCORFN;.04////^S X=GMRCWARD;.05////^S X=GMRCFAC;.06////^S X=$G(GMRCOFN);1////^S X=GMRCSS;2////^S X=$G(GMRCWARD);3////^S X=GMRCAD;4////^S X=GMRCPRI;5////^S X=GMRCURGI;7////^S X=$G(GMRCATN)"
"RTN","GMRCHL7B",23,0)
 D ^DIE
"RTN","GMRCHL7B",24,0)
 I GMRCOTXT=$$GET1^DIQ(123.5,+GMRCSS,.01) S GMRCOTXT=""
"RTN","GMRCHL7B",25,0)
 ;Added new field .1 to DR on 7/11/98 to save the order text
"RTN","GMRCHL7B",26,0)
 S DR="6////^S X=GMRCPLI;8////^S X=GMRCSTS;9////^S X=GMRCA;10////^S X=GMRCORNP;13////^S X=GMRCTYPE;14////^S X=$G(GMRCSBR);30////^S X=$G(GMRCPRDG);.1////^S X=$G(GMRCOTXT)"
"RTN","GMRCHL7B",27,0)
 I $D(GMRCPRCD) S DR=DR_";30.1///^S X=GMRCPRCD"
"RTN","GMRCHL7B",28,0)
 D ^DIE
"RTN","GMRCHL7B",29,0)
 I $O(GMRCRFQ(0)) D REASON
"RTN","GMRCHL7B",30,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCHL7B",31,0)
 S GMRCA=1 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",32,0)
 I $D(GMRCXMF),$D(GMRCOFN) S $P(^GMR(123,GMRCO,0),"^",21)=GMRCOFN
"RTN","GMRCHL7B",33,0)
 I $D(GMRCACTN) S GMRCADUZ(GMRCACTN)=""
"RTN","GMRCHL7B",34,0)
 D ALERT^GMRCHL7U(DFN,GMRCSS,GMRCPRI,GMRCO,GMRCURGI,"")
"RTN","GMRCHL7B",35,0)
 D PRNT^GMRCUTL1(GMRCSS,GMRCO) ;contains print audit update
"RTN","GMRCHL7B",36,0)
 D EXIT
"RTN","GMRCHL7B",37,0)
 Q
"RTN","GMRCHL7B",38,0)
DC(GMRCO,ACTRL) ;Discontinue request from OERR
"RTN","GMRCHL7B",39,0)
 ;Denied request also gets this action. Deny request updates status to dc
"RTN","GMRCHL7B",40,0)
 ;GMRCO=IEN of record in file ^GMR(123, i.e., ^GMR(123,DA,
"RTN","GMRCHL7B",41,0)
 ;ACTRL=GMRCCTRL=control code defining action -
"RTN","GMRCHL7B",42,0)
 ;         DC control code = action DC for discontinued 
"RTN","GMRCHL7B",43,0)
 ;         CA control code = action DY for denied
"RTN","GMRCHL7B",44,0)
 ;Update the last action taken, order status, and processing activity
"RTN","GMRCHL7B",45,0)
 Q:'$L(GMRCO)
"RTN","GMRCHL7B",46,0)
 N GMRCACT,GMRCSVC,GMRCDFN,GMRCFL,GMRCADUZ,GMRCRQR,DA
"RTN","GMRCHL7B",47,0)
 S GMRCACT=$O(^GMR(123.1,"D",ACTRL,0))
"RTN","GMRCHL7B",48,0)
 S GMRCSTS=$P(^GMR(123.1,GMRCACT,0),"^",2)
"RTN","GMRCHL7B",49,0)
 S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCHL7B",50,0)
 S DR="8////^S X=GMRCSTS;9////^S X=GMRCACT" ; upd status + last action
"RTN","GMRCHL7B",51,0)
 D ^DIE
"RTN","GMRCHL7B",52,0)
 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",53,0)
 ; send 513 back through service printer if order DC'd
"RTN","GMRCHL7B",54,0)
 I $G(ACTRL)="DC",$$DCPRNT^GMRCUTL1(GMRCO,DUZ) D
"RTN","GMRCHL7B",55,0)
 . D PRNT^GMRCUTL1(+$P(^GMR(123,GMRCO,0),U,5),GMRCO)
"RTN","GMRCHL7B",56,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCHL7B",57,0)
 S GMRCFL=$$DCNOTE^GMRCADC(GMRCO,DUZ),GMRCADUZ=""
"RTN","GMRCHL7B",58,0)
 S GMRCRQR=+$P($G(^GMR(123,+GMRCO,0)),"^",14)
"RTN","GMRCHL7B",59,0)
 I +GMRCRQR,GMRCRQR'=DUZ S GMRCADUZ(GMRCRQR)=""
"RTN","GMRCHL7B",60,0)
 S GMRCSVC=$P($G(^GMR(123,+GMRCO,0)),"^",5)
"RTN","GMRCHL7B",61,0)
 I +GMRCSVC S GMRCSVC=$S($D(^GMR(123.5,GMRCSVC,.1)):^(.1),1:$P(^GMR(123.5,GMRCSVC,0),"^",1))
"RTN","GMRCHL7B",62,0)
 E  S GMRCSVC="Unknown Service: Consult # "_GMRCO
"RTN","GMRCHL7B",63,0)
 S GMRCORTX=$S(ACTRL="DC":"Discontinued",1:"Cancelled")
"RTN","GMRCHL7B",64,0)
 S GMRCORTX=GMRCORTX_" Consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCHL7B",65,0)
 N NOTYPE S NOTYPE=$S(ACTRL="DC":23,1:30)
"RTN","GMRCHL7B",66,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,NOTYPE,.GMRCADUZ,GMRCFL)
"RTN","GMRCHL7B",67,0)
 D EXIT
"RTN","GMRCHL7B",68,0)
 Q
"RTN","GMRCHL7B",69,0)
MODIFY ;Change an order/request when an HL7 'XX' code is received
"RTN","GMRCHL7B",70,0)
 ;This is currently not used.
"RTN","GMRCHL7B",71,0)
 ;    When Consults sends an XX, CPRS returns NA with a new order ien.
"RTN","GMRCHL7B",72,0)
 ;GMRCACT=processing activity - from file ^GMR(123.1,
"RTN","GMRCHL7B",73,0)
 S DIE="^GMR(123,",DA=+GMRCO
"RTN","GMRCHL7B",74,0)
 S GMRCWARD=$G(GMRCWARD),GMRCPRI=$G(GMRCPRI),GMRCURGI=$G(GMRCURGI),GMRCSTS=$G(GMRCSTS),GMRCTYPE=$G(GMRCTYPE),GMRCSS=$G(GMRCSS)
"RTN","GMRCHL7B",75,0)
 S GMRCACT=$O(^GMR(123.1,"D",GMRCTRLC,0))
"RTN","GMRCHL7B",76,0)
 S GMRCSTS=$P(^GMR(123.1,GMRCACT,0),"^",2)
"RTN","GMRCHL7B",77,0)
 S DIE=123,DR=".04////^S X=$G(GMRCWARD);1////^S X=$G(GMRCSS);4////^S X=$G(GMRCPRI);5////^S X=$G(GMRCURGI);8////^S X=$G(GMRCSTS);9////^S X=GMRCACT"
"RTN","GMRCHL7B",78,0)
 D ^DIE
"RTN","GMRCHL7B",79,0)
 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",80,0)
 D EXIT Q
"RTN","GMRCHL7B",81,0)
REASON ;load the reason for request into ^GMR(123,IFN,20
"RTN","GMRCHL7B",82,0)
 S ^GMR(123,GMRCO,20,0)="^^^"_$S($D(GMRCDA):GMRCDA,1:DT)_"^"
"RTN","GMRCHL7B",83,0)
 S L=0,LN=1 F  S L=$O(GMRCRFQ(L)) Q:L=""  S ^GMR(123,GMRCO,20,LN,0)=GMRCRFQ(L),LN=LN+1
"RTN","GMRCHL7B",84,0)
 S LN=LN-1,$P(^GMR(123,GMRCO,20,0),"^",3)=LN
"RTN","GMRCHL7B",85,0)
 K L,LN
"RTN","GMRCHL7B",86,0)
 Q
"RTN","GMRCHL7B",87,0)
COMMENT(GMRCARY) ;add comments to the record.  Add the comment header, then the comment lines, and lastly, the number of comment lines to the header
"RTN","GMRCHL7B",88,0)
 ;GMRCARY= GMRCNTC array
"RTN","GMRCHL7B",89,0)
 S LN=0,^GMR(123,GMRCO,40,DA,1,0)="^^^^"_$P(GMRCDA,".",1)_"^"
"RTN","GMRCHL7B",90,0)
 F  S LN=$O(GMRCARY(LN)) Q:LN=""  S ^GMR(123,+GMRCO,40,DA,1,LN,0)=GMRCARY(LN),LN1=LN
"RTN","GMRCHL7B",91,0)
 S $P(^GMR(123,+GMRCO,40,DA,1,0),"^",3,4)=LN1_"^"_LN1
"RTN","GMRCHL7B",92,0)
 K LN,LN1 Q
"RTN","GMRCHL7B",93,0)
 Q
"RTN","GMRCHL7B",94,0)
EXIT ;kill off all variables
"RTN","GMRCHL7B",95,0)
 K DA,DIC,DIE,DR,GMRCORTX,GMRCADUZ
"RTN","GMRCHL7B",96,0)
 Q
"RTN","GMRCHL7U")
0^11^B22721100
"RTN","GMRCHL7U",1,0)
GMRCHL7U ;SLC/DCM,MA - Utilities associated with HL7 messages ;4/18/01  10:29
"RTN","GMRCHL7U",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,21**;DEC 27, 1997
"RTN","GMRCHL7U",3,0)
 ; Patch #21 added more variables to in line tage EXIT.
"RTN","GMRCHL7U",4,0)
INIT(MSH) ;break out MSH segment separators and set other neeed variables
"RTN","GMRCHL7U",5,0)
 ;MSH = MSH segment of the HL-7 message
"RTN","GMRCHL7U",6,0)
 N X
"RTN","GMRCHL7U",7,0)
 S (SEP1,SEP2,SEP3,SEP4,SEP5)=""
"RTN","GMRCHL7U",8,0)
 S SEP1=$E(MSH,4),X=$P(MSH,SEP1,2)
"RTN","GMRCHL7U",9,0)
 S SEP2=$E(X,1),SEP3=$E(X,2),SEP4=$E(X,3),SEP5=$E(X,4)
"RTN","GMRCHL7U",10,0)
 Q
"RTN","GMRCHL7U",11,0)
PID(GMRCPID) ;Get fields from PID segment and set into GMRC variables.
"RTN","GMRCHL7U",12,0)
 S DFN=$P(GMRCPID,SEP1,4),GMRCPNM=$P(GMRCPID,SEP1,6)
"RTN","GMRCHL7U",13,0)
 Q
"RTN","GMRCHL7U",14,0)
NTE(MSG,GMRCNTE,GMRCNODE,CTRLCODE) ;set NTE segments of HL-7 message into variables and globals
"RTN","GMRCHL7U",15,0)
 ;MSG = whole HL-7 array.
"RTN","GMRCHL7U",16,0)
 ;GMRCNTE = Node in array where NTE message begins
"RTN","GMRCHL7U",17,0)
 ;CTRLCODE = segment 1 of the ORC segment of HL-7 message
"RTN","GMRCHL7U",18,0)
 ;GMRCNODE = IEN of entry int file ^GMR(123,
"RTN","GMRCHL7U",19,0)
 N GMRCACT ;not sure why this is newed here
"RTN","GMRCHL7U",20,0)
 S GMRCAD=$G(GMRCAD),GMRCORNP=$G(GMRCORNP),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA),GMRCDEV=$G(GMRCDEV)
"RTN","GMRCHL7U",21,0)
 S GMRCACT=$S(CTRLCODE="CA":19,CTRLCODE="DC":6,CTRLCODE="NW":1,1:$O(^GMR(123.1,"D",CTRLCODE,0)))
"RTN","GMRCHL7U",22,0)
 S GMRCNTC(1)=$P(MSG(GMRCNTE),SEP1,4)
"RTN","GMRCHL7U",23,0)
 S LN=0,LN1=2 F  S LN=$O(MSG(GMRCNTE,LN)) Q:LN=""  S GMRCNTC(LN1)=MSG(GMRCNTE,LN),LN1=LN1+1
"RTN","GMRCHL7U",24,0)
 K LN,LN1
"RTN","GMRCHL7U",25,0)
 Q
"RTN","GMRCHL7U",26,0)
PV1(GMRCPV1) ;Get fields from PV1 segment of HL-7 message and set into GMRC variables
"RTN","GMRCHL7U",27,0)
 ;GMRCRB  = patients room/bed            GMRCWARD=patients ward
"RTN","GMRCHL7U",28,0)
 ;GMRCSBR = service basis to be rendered (Inpatient or Outpatient)
"RTN","GMRCHL7U",29,0)
 N X
"RTN","GMRCHL7U",30,0)
 S X=$P(GMRCPV1,SEP1,3),GMRCSBR=$S(X]"":X,1:"")
"RTN","GMRCHL7U",31,0)
 S X=$P(GMRCPV1,SEP1,4),GMRCWARD=$S($P(X,SEP2,1)]"":$P(X,SEP2,1),1:""),VISIT=$S($P(GMRCPV1,SEP1,20)]"":$P(GMRCPV1,SEP1,20),1:"")
"RTN","GMRCHL7U",32,0)
 S GMRCRB=$S($P(X,SEP2,2)]"":$P(X,SEP2,2),1:"")
"RTN","GMRCHL7U",33,0)
 S:VISIT]"" GMRCVSIT=$$FMDATE^GMRCHL7(VISIT)
"RTN","GMRCHL7U",34,0)
 Q
"RTN","GMRCHL7U",35,0)
 ;
"RTN","GMRCHL7U",36,0)
REJECT(GMRCMSG,REAS) ;action can't be filed send reject message
"RTN","GMRCHL7U",37,0)
 ; Does anyone know why this section has been commented out
"RTN","GMRCHL7U",38,0)
 ; so the new on GMRCMESS is not done or DO MSG^XQOR?
"RTN","GMRCHL7U",39,0)
 N MSH,ORC,I ;GMRCMESS
"RTN","GMRCHL7U",40,0)
 S I=0 F  S I=$O(GMRCMSG(I)) Q:'I  D
"RTN","GMRCHL7U",41,0)
 . I $P(GMRCMSG(I),"|")="PID" S PID=GMRCMSG(I)
"RTN","GMRCHL7U",42,0)
 . I $P(GMRCMSG(I),"|")="ORC" D
"RTN","GMRCHL7U",43,0)
 .. N ORFN,GMRCFN,P17,CTRLCD
"RTN","GMRCHL7U",44,0)
 .. S ORFN=$P(GMRCMSG(I),"|",3),GMRCFN=$P(GMRCMSG(I),"|",4)
"RTN","GMRCHL7U",45,0)
 .. S CTRLCD=$P(GMRCMSG(I),"|",2)
"RTN","GMRCHL7U",46,0)
 .. S ORC="ORC|"_$S(CTRLCD="NW":"UA",1:"UD")_"|"_ORFN_"|"_GMRCFN
"RTN","GMRCHL7U",47,0)
 .. S P17=$S($D(REAS):REAS,1:"UNABLE TO FILE ACTION")
"RTN","GMRCHL7U",48,0)
 .. S $P(ORC,"|",17)="X^REJECTED^99ORN^^"_P17
"RTN","GMRCHL7U",49,0)
 S MSH=$$MSH^GMRCHL7
"RTN","GMRCHL7U",50,0)
 S $P(MSH,SEP1,9)="ORR"
"RTN","GMRCHL7U",51,0)
 S GMRCMESS(1)=MSH
"RTN","GMRCHL7U",52,0)
 S GMRCMESS(2)=PID
"RTN","GMRCHL7U",53,0)
 S GMRCMESS(3)=ORC
"RTN","GMRCHL7U",54,0)
 ;D MSG^XQOR("GMRC EVSEND OR",.GMRCMESS)
"RTN","GMRCHL7U",55,0)
 Q
"RTN","GMRCHL7U",56,0)
 ;
"RTN","GMRCHL7U",57,0)
RETURN(GMRCIEN,GMRCTRLC) ;return IEN of record in ^GMR(123,IEN, to OERR
"RTN","GMRCHL7U",58,0)
 ;GMRCIEN = internal record number of record in ^GMR(123,
"RTN","GMRCHL7U",59,0)
 ;GMRCTRLC=Control code from HL-7 Table 119
"RTN","GMRCHL7U",60,0)
 N MSH,PID,ORC,GMRCORCC
"RTN","GMRCHL7U",61,0)
 S SEP1="|",GMRCORCC=$S(GMRCTRLC="NW":"OK",GMRCTRLC="DC":"DR",1:"OK")
"RTN","GMRCHL7U",62,0)
 S MSH=$$MSH^GMRCHL7($G(X)) S $P(MSH,SEP1,9)="ORR"
"RTN","GMRCHL7U",63,0)
 S PID=$$PID^GMRCHL7(GMRCIEN)
"RTN","GMRCHL7U",64,0)
 D ORC^GMRCHL7(GMRCIEN,GMRCORCC,"") S ORC=$P(ORC,"|",1,4)
"RTN","GMRCHL7U",65,0)
 D BLD^GMRCHL7(MSH,PID,"",ORC,"","",,"",GMRCTRLC)
"RTN","GMRCHL7U",66,0)
 D MSG^XQOR("GMRC EVSEND OR",.GMRCMSG)
"RTN","GMRCHL7U",67,0)
 Q
"RTN","GMRCHL7U",68,0)
FILE(GMRCO,DR) ;File data into ^GMR(123,IEN,40 using ^DIE
"RTN","GMRCHL7U",69,0)
 N DIE,DA
"RTN","GMRCHL7U",70,0)
 ;GMRCO = IEN of record from file ^GMR(123,
"RTN","GMRCHL7U",71,0)
 ;DR = DR string required by ^DIE
"RTN","GMRCHL7U",72,0)
 L +^GMR(123,+GMRCO,40) S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCHL7U",73,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1),DA(1)=+GMRCO
"RTN","GMRCHL7U",74,0)
 S DIE="^GMR(123,"_GMRCO_",40,"
"RTN","GMRCHL7U",75,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCHL7U",76,0)
 D ^DIE
"RTN","GMRCHL7U",77,0)
 I $D(GMRCNTC) D COMMENT^GMRCHL7B(.GMRCNTC)
"RTN","GMRCHL7U",78,0)
 I $D(GMRCCMT) D COMMENT^GMRCHL7B(.GMRCCMT)
"RTN","GMRCHL7U",79,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCHL7U",80,0)
 Q
"RTN","GMRCHL7U",81,0)
EXIT ;Kill variables and exit
"RTN","GMRCHL7U",82,0)
 K HLQ,J,LN,ND,ND1,ND2,SEP1,SEP2,SEP3,SEP4,SEP5
"RTN","GMRCHL7U",83,0)
 K GMRCA,GMRCACT,GMRCAD,GMRCAP,GMRCAPP,GMRCATN,GMRCDA,GMRCDEV,GMRCFAC,GMRCFF,GMRCINTR,GMRCMTP,GMRCMSG,GMRCMSH,GMRCNOD,GMRCNTC,GMRCODT,GMRCOID,GMRCORFN,GMRCPA,GMRCPLCR,GMRCPLI,GMRCPNM,GMRCPR,GMRCPRI,GMRCFQ
"RTN","GMRCHL7U",84,0)
 K GMRCPRDG,GMRCSEND,GMRCSTDT,GMRCSTS,GMRCURGI,GMRCVAL,GMRCVTYP,GMRCWARD,GMRCPRV,GMRCTYPE,GMRCND,GMRCND1,VISIT
"RTN","GMRCHL7U",85,0)
 K GMRCRB,GMRCPRA,GMRCRFQ,MSH,OBXND,PID,GMRCORPV,GMRCOTXT,GMRCNATO
"RTN","GMRCHL7U",86,0)
 K GMRCOFN,GMRCS123,GMRCS38,GMRCCMT
"RTN","GMRCHL7U",87,0)
 K:'$D(GMRCXMF) GMRCTRLC,GMRCSS,GMRCO,GMRCORNP
"RTN","GMRCHL7U",88,0)
 Q
"RTN","GMRCHL7U",89,0)
AUDIT0 ;place activity audit tracking info into global ^GMR(123,IEN,40,
"RTN","GMRCHL7U",90,0)
 ;GMRCACT=processing activity (from ^GMR(123.1,
"RTN","GMRCHL7U",91,0)
 ;GMRCDA=date/time file entered     GMRCAD=date/time activity took place
"RTN","GMRCHL7U",92,0)
 ;GMRCORNP=name of provider         GMRCFF=forwared from (if forwarded)
"RTN","GMRCHL7U",93,0)
 ;GMRCPA=provider previously assigned
"RTN","GMRCHL7U",94,0)
 ;GMRCDEV=device printed to        GMRCCMT=comment array from OBX segment
"RTN","GMRCHL7U",95,0)
 N GMRCDA
"RTN","GMRCHL7U",96,0)
 S X="NOW" D NOW^%DTC S GMRCDA=%
"RTN","GMRCHL7U",97,0)
 L +^GMR(123,+GMRCO,40) S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,+GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCHL7U",98,0)
 S GMRCAD=$S($D(GMRCAD):GMRCAD,1:GMRCDA),GMRCORNP=$G(GMRCORNP),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA),GMRCDEV=$G(GMRCDEV),GMRCPLCR=$G(GMRCPLCR)
"RTN","GMRCHL7U",99,0)
 ;Use the Control code from CPRS in 123.1 to determine the action.
"RTN","GMRCHL7U",100,0)
 ;If action undefined, then use "ADDED COMMENT", entry 20.
"RTN","GMRCHL7U",101,0)
 S GMRCACT=$O(^GMR(123.1,"D",GMRCTRLC,0))
"RTN","GMRCHL7U",102,0)
 S:'GMRCACT GMRCACT=20
"RTN","GMRCHL7U",103,0)
 S DR=".01////^S X=GMRCDA;1////^S X=GMRCACT;2////^S X=GMRCAD;3////^S X=GMRCORNP;4////^S X=GMRCPLCR;6////^S X=GMRCFF;7////^S X=GMRCPA;8////^S X=GMRCDEV"
"RTN","GMRCHL7U",104,0)
 D FILE(GMRCO,DR)
"RTN","GMRCHL7U",105,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCHL7U",106,0)
 Q
"RTN","GMRCHL7U",107,0)
ALERT(GMRCDFN,GMRCSS,GMRCPR,GMRCFN,GMRCURG,GMRCORA) ;generate an alert when receiving a consult
"RTN","GMRCHL7U",108,0)
 ;GMRCDFN=patient DFN from file 2
"RTN","GMRCHL7U",109,0)
 ;GMRCSS=Service
"RTN","GMRCHL7U",110,0)
 ;GMRCPR=procedure being ordered
"RTN","GMRCHL7U",111,0)
 ;GMRCFN=File 123 IEN
"RTN","GMRCHL7U",112,0)
 ;GMRCURG=urgency of request from protocol file
"RTN","GMRCHL7U",113,0)
 ;GMRCADUZ=array of those who receive alerts
"RTN","GMRCHL7U",114,0)
 ;GMRCORA=action to take on alert: 27 is for new alert
"RTN","GMRCHL7U",115,0)
 N GMRCORTX
"RTN","GMRCHL7U",116,0)
 S GMRCORTX="New consult "_$$ORTX^GMRCAU(+GMRCO)_$S(+GMRCURG:" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",1:"")
"RTN","GMRCHL7U",117,0)
 S:'$D(GMRCORA) GMRCORA=27 S:GMRCORA="" GMRCORA=27
"RTN","GMRCHL7U",118,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,GMRCFN,GMRCORA,.GMRCADUZ,1)
"RTN","GMRCHL7U",119,0)
 K GMRCADUZ
"RTN","GMRCHL7U",120,0)
 Q
"RTN","GMRCP5A")
0^5^B68074897
"RTN","GMRCP5A",1,0)
GMRCP5A ;SLC/DCM,RJS,MA - Print Consult form 513 (Gather Data - TIU Results) ;4/18/01  10:29
"RTN","GMRCP5A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13,12,15,21**;Dec 27, 1997
"RTN","GMRCP5A",3,0)
 ; Patch #21 added PRNTAUDT to this routine.
"RTN","GMRCP5A",4,0)
 ;
"RTN","GMRCP5A",5,0)
PRNT(GMRCIFN,TIUFLG,GMRCQUED,GMRCCPY,GMRCGUI,GMRCAUDT) ;
"RTN","GMRCP5A",6,0)
 ;
"RTN","GMRCP5A",7,0)
 ; Input Arguments:
"RTN","GMRCP5A",8,0)
 ;
"RTN","GMRCP5A",9,0)
 ;  GMRCIFN: IEN of the Consult/Request in file 123
"RTN","GMRCP5A",10,0)
 ;   TIUFLG: Called from TIU ?  1=yes 0=no
"RTN","GMRCP5A",11,0)
 ; GMRCQUED: Queued job ?  1=yes 0=no
"RTN","GMRCP5A",12,0)
 ;  GMRCCPY: Chart Copy ? C=Chart Copy  W=Working Copy  null=Not Applicable
"RTN","GMRCP5A",13,0)
 ;  GMRCGUI: Called from the GUI. (Only produce output in a formatted global.)
"RTN","GMRCP5A",14,0)
 ; GMRCAUDT:  Set to 1 in GMRCUTL1 if NW or DC consult.
"RTN","GMRCP5A",15,0)
 ; ZTIO:      Output device when job is tasked
"RTN","GMRCP5A",16,0)
 ;
"RTN","GMRCP5A",17,0)
 N GMRCSIG,GMRCSDT,GMRCCSIG,GMRCSIGT,GMRCADDS
"RTN","GMRCP5A",18,0)
 ;
"RTN","GMRCP5A",19,0)
 I GMRCGUI D  Q
"RTN","GMRCP5A",20,0)
 . D FORMAT(80)
"RTN","GMRCP5A",21,0)
 . D ASSMBL^GMRCP5C(GMRCGUI,80)
"RTN","GMRCP5A",22,0)
 . F GMRCX="GMRCTIU","RES","MCAR" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5A",23,0)
 . K ^TMP("GMRC",$J,"OUTPUT")
"RTN","GMRCP5A",24,0)
 . Q
"RTN","GMRCP5A",25,0)
 ;
"RTN","GMRCP5A",26,0)
 I 'TIUFLG,'GMRCQUED W @IOF I '$$CRT^GMRCP5C,$L($G(IO(0))),'(IO=IO(0)) U IO(0) W !,"PRINTING... "
"RTN","GMRCP5A",27,0)
 ;
"RTN","GMRCP5A",28,0)
 U IO D FORMAT(IOM),ASSMBL^GMRCP5C(IOSL,IOM),PRINT^GMRCP5C(IOSL,IOM)
"RTN","GMRCP5A",29,0)
 ;
"RTN","GMRCP5A",30,0)
 I 'TIUFLG,'$$CRT^GMRCP5C U IO(0) D ^%ZISC
"RTN","GMRCP5A",31,0)
 ;
"RTN","GMRCP5A",32,0)
 I $G(GMRCQUED),$G(ZTSK) D KILL^%ZTLOAD
"RTN","GMRCP5A",33,0)
 ;
"RTN","GMRCP5A",34,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5A",35,0)
 F GMRCX="GMRCTIU","RES","MCAR" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5A",36,0)
 ; If print device (ZTIO) do PRNTAUDT unless there is no GMRCAUDT
"RTN","GMRCP5A",37,0)
 ; GMRCAUDT=1 means print for NW or DC consult
"RTN","GMRCP5A",38,0)
 I $D(ZTIO),$D(GMRCAUDT) D PRNTAUDT(GMRCIFN,ZTIO,GMRCAUDT)
"RTN","GMRCP5A",39,0)
 Q
"RTN","GMRCP5A",40,0)
 ;
"RTN","GMRCP5A",41,0)
PRNTAUDT(GMRCIFN,ZTIO,GMRCAUDT) ; Update the last activity field in 123 and
"RTN","GMRCP5A",42,0)
 ; Processing Activity multiple
"RTN","GMRCP5A",43,0)
 ; Update the activity log to reflect "Printed To:" and the printer
"RTN","GMRCP5A",44,0)
 ; GMRCAUDT=1 indicates the consult is NW or Discontinued
"RTN","GMRCP5A",45,0)
 ; and it should update the audit trail.
"RTN","GMRCP5A",46,0)
 I $G(GMRCAUDT)'=1 K GMRCAUDT  Q
"RTN","GMRCP5A",47,0)
 N GMRCOM,GMRCORNP,GMRCFF,GMRCPA,GMRCAD,GMRCA
"RTN","GMRCP5A",48,0)
 S GMRCA=22
"RTN","GMRCP5A",49,0)
 S GMRCO=GMRCIFN,GMRCDEV=ZTIO
"RTN","GMRCP5A",50,0)
 S DIE="^GMR(123,",DA=+GMRCO,DR="9////^S X=GMRCA"
"RTN","GMRCP5A",51,0)
 L +^GMR(123,GMRCO):5
"RTN","GMRCP5A",52,0)
 D ^DIE
"RTN","GMRCP5A",53,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCP5A",54,0)
 ;Update activity other than HL7 original msg received
"RTN","GMRCP5A",55,0)
 D AUDIT^GMRCP
"RTN","GMRCP5A",56,0)
 KILL GMRCO,GMRCA,GMRCDEV
"RTN","GMRCP5A",57,0)
 Q
"RTN","GMRCP5A",58,0)
 ;
"RTN","GMRCP5A",59,0)
FORMAT(PAGEWID) ;
"RTN","GMRCP5A",60,0)
 ;
"RTN","GMRCP5A",61,0)
 N %I,CMT,COUNT,D0,DFN,DIC,DIQ2,DR,GLOBAL,GMRC400,GMRCADD,GMRCADDT,GMRCAGE,GMRCCSDT
"RTN","GMRCP5A",62,0)
 N GMRCCTIT,GMRCDFN,GMRCDOB,GMRCDVL,GMRCELIG,GMRCEQL,GMRCERR,GMRCFAC,GMRCFP
"RTN","GMRCP5A",63,0)
 N GMRCFTR,GMRCLAST,GMRCMODE,GMRCND,GMRCNDX,GMRCNT,GMRCPG,GMRCPGR,GMRCPNM,GMRCPRNM
"RTN","GMRCP5A",64,0)
 N GMRCPTR,GMRCQSTR,GMRCQSTT,GMRCR0,GMRCR1,GMRCR2,GMRCRB,GMRCRD,GMRCRPT,GMRCSG,GMRCSGAD,GMRCSIGM
"RTN","GMRCP5A",65,0)
 N GMRCSN,GMRCSR,GMRCSVC,GMRCTO,GMRCUL,GMRCWARD,GMRCWLI,GMRCX,LN,MCFILE,MCPROC
"RTN","GMRCP5A",66,0)
 N ND,ND1,ND2,NDS,ORACTION,SEX,TAB,X,Y
"RTN","GMRCP5A",67,0)
 ;
"RTN","GMRCP5A",68,0)
 S GMRCFTR=13,GMRCFP=0,GMRCPG=0
"RTN","GMRCP5A",69,0)
 S GMRCRD=$G(^GMR(123,GMRCIFN,0)),(DFN,GMRCDFN)=$P(GMRCRD,U,2)
"RTN","GMRCP5A",70,0)
 Q:'(DFN)
"RTN","GMRCP5A",71,0)
 D ELIG^VADPT S GMRCELIG=$P(VAEL(6),U,2) K VAEL
"RTN","GMRCP5A",72,0)
 S GMRCDVL="",$P(GMRCDVL,"-",PAGEWID+1)=""
"RTN","GMRCP5A",73,0)
 S GMRCEQL="",$P(GMRCEQL,"=",PAGEWID+1)=""
"RTN","GMRCP5A",74,0)
 S GMRCUL="",$P(GMRCUL,"_",40)=""
"RTN","GMRCP5A",75,0)
 S DFN=GMRCDFN D DEM^GMRCU
"RTN","GMRCP5A",76,0)
 ;
"RTN","GMRCP5A",77,0)
 S GMRCFAC=+$P(GMRCRD,U,21)
"RTN","GMRCP5A",78,0)
 I 'GMRCFAC S GMRCFAC=+$G(DUZ(2))
"RTN","GMRCP5A",79,0)
 I 'GMRCFAC S GMRCFAC=+$$SITE^VASITE()
"RTN","GMRCP5A",80,0)
 I +GMRCFAC S GMRCFAC=$$GET1^DIQ(4,+GMRCFAC,.01)
"RTN","GMRCP5A",81,0)
 E  S GMRCFAC="" Q
"RTN","GMRCP5A",82,0)
 ;
"RTN","GMRCP5A",83,0)
 I $P(GMRCRD,U,12)=2!(TIUFLG) D
"RTN","GMRCP5A",84,0)
 . D PRINT^GMRCTIUP(GMRCIFN,0,0)
"RTN","GMRCP5A",85,0)
 ;
"RTN","GMRCP5A",86,0)
 K GMRCSG I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",87,0)
 .;
"RTN","GMRCP5A",88,0)
 .S GMRCR0=0 F  Q:$D(GMRCSG)  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",89,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",90,0)
 ..Q:'$L($G(GMRCSIG))
"RTN","GMRCP5A",91,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S GMRCSG(GMRCV)=@GMRCV
"RTN","GMRCP5A",92,0)
 ;
"RTN","GMRCP5A",93,0)
 D INIT^GMRCP5B(.GMRCSG) ; Build Header, Footer, Request, and Primary Diagnosis Segments
"RTN","GMRCP5A",94,0)
 ;
"RTN","GMRCP5A",95,0)
 I $L($G(GMRCCPY)) D
"RTN","GMRCP5A",96,0)
 .D BLD("RES",1,1,0,$$CENTER($S(GMRCCPY="C":"C H A R T   C O P Y",1:"W O R K I N G   C O P Y")))
"RTN","GMRCP5A",97,0)
 I ($P(GMRCRD,U,19)="Y") D
"RTN","GMRCP5A",98,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Significant Findings *******"))
"RTN","GMRCP5A",99,0)
 I ($P(GMRCRD,U,19)="N") D
"RTN","GMRCP5A",100,0)
 .D BLD("RES",1,1,0,$$CENTER("******* No Significant Findings *******"))
"RTN","GMRCP5A",101,0)
 I ($P(GMRCRD,U,19)="U") D
"RTN","GMRCP5A",102,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Unknown Significant Findings *******"))
"RTN","GMRCP5A",103,0)
 ;
"RTN","GMRCP5A",104,0)
 I $P(GMRCRD,U,12)=1  D 
"RTN","GMRCP5A",105,0)
 . D BLD("RES",1,2,0,$$CENTER("**** REQUEST CANCELLED    REQUEST CANCELLED ****"))
"RTN","GMRCP5A",106,0)
 I '$D(^TMP("GMRCR",$J,"RES")),'$D(^("MCAR")) D
"RTN","GMRCP5A",107,0)
 .I $L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results for "_GMRCRPT_" available."))
"RTN","GMRCP5A",108,0)
 .I '$L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results available."))
"RTN","GMRCP5A",109,0)
 ;
"RTN","GMRCP5A",110,0)
 I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",111,0)
 .;
"RTN","GMRCP5A",112,0)
 .S (GMRCNT,GMRCR0)=0 F  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",113,0)
 ..N GMRCCSDT,GMRCCSGM,GMRCCSIG,GMRCCTIT,GMRCRPT,GMRCSDT
"RTN","GMRCP5A",114,0)
 ..N GMRCSIG,GMRCSIGM,GMRCSIGT,GMRCV,GMRCENT,GMRCVIS,GMRCVLOC,GMRCNODT
"RTN","GMRCP5A",115,0)
 ..;
"RTN","GMRCP5A",116,0)
 ..F GMRCV="GMRCCSDT","GMRCCSGM","GMRCCSIG","GMRCCTIT","GMRCRPT","GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT","GMRCVIS","GMRCENT","GMRCVLOC","GMRCNODT" D
"RTN","GMRCP5A",117,0)
 ...S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",118,0)
 ..;
"RTN","GMRCP5A",119,0)
 ..S GMRCNDX=$O(^TMP("GMRC",$J,"OUTPUT","RES"," "),-1)+1
"RTN","GMRCP5A",120,0)
 ..I $L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results #"_GMRCR0_" for "_GMRCRPT_" continued.")
"RTN","GMRCP5A",121,0)
 ..I '$L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results #"_GMRCR0_" continued.")
"RTN","GMRCP5A",122,0)
 ..D SUB("H","RES",GMRCNDX," ")
"RTN","GMRCP5A",123,0)
 ..I $L($G(GMRCSIG)) D
"RTN","GMRCP5A",124,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",125,0)
 ...I (GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /es/ "_$$EXDT($G(GMRCSDT))
"RTN","GMRCP5A",126,0)
 ...I '(GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /chart/ " S:$L($G(GMRCSDT)) GMRCX=GMRCX_$$EXDT(GMRCSDT)
"RTN","GMRCP5A",127,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",128,0)
 ...D:$L($G(GMRCSIGT)) SUB("F","RES",GMRCNDX,"                    "_GMRCSIGT)
"RTN","GMRCP5A",129,0)
 ..I $L($G(GMRCCSIG)) D
"RTN","GMRCP5A",130,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",131,0)
 ...I (GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /es/ "_$$EXDT($G(GMRCCSDT))
"RTN","GMRCP5A",132,0)
 ...I '(GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /chart/ " S:$L($G(GMRCCSDT)) GMRCX=GMRCX_$$EXDT(GMRCCSDT)
"RTN","GMRCP5A",133,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",134,0)
 ...D:$L($G(GMRCCTIT)) SUB("F","RES",GMRCNDX,"                      "_GMRCCTIT)
"RTN","GMRCP5A",135,0)
 ..;extra signers
"RTN","GMRCP5A",136,0)
 .. I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA")) D
"RTN","GMRCP5A",137,0)
 ... D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",138,0)
 ... D SUB("F","RES",GMRCNDX," Receipt acknowledged by: ")
"RTN","GMRCP5A",139,0)
 ... N XTRA S XTRA=0 F  S XTRA=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA)) Q:'XTRA  D
"RTN","GMRCP5A",140,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,0))
"RTN","GMRCP5A",141,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,1))
"RTN","GMRCP5A",142,0)
 ..;
"RTN","GMRCP5A",143,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",144,0)
 ..I $L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE #"_GMRCR0_" FOR "_GMRCRPT))
"RTN","GMRCP5A",145,0)
 ..I '$L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE #"_GMRCR0))
"RTN","GMRCP5A",146,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",147,0)
 ..I $L($G(GMRCENT)) D
"RTN","GMRCP5A",148,0)
 ...S GMRCX="         Entry Date: "_$$EXDT($G(GMRCENT))
"RTN","GMRCP5A",149,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",150,0)
 ..I $L($G(GMRCNODT)) D
"RTN","GMRCP5A",151,0)
 ...Q:$$EXDT($G(GMRCNODT))=$$EXDT($G(GMRCENT)) 
"RTN","GMRCP5A",152,0)
 ...S GMRCX="Date/Time of result: "_$$EXDT($G(GMRCNODT))
"RTN","GMRCP5A",153,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",154,0)
 ..I $L($G(GMRCVIS)) D
"RTN","GMRCP5A",155,0)
 ...S GMRCX="              Visit: "_$$EXDT($G(GMRCVIS))
"RTN","GMRCP5A",156,0)
 ...I $L($G(GMRCVLOC)) S GMRCX=GMRCX_"   "_GMRCVLOC
"RTN","GMRCP5A",157,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",158,0)
 ..I $L($G(GMRCVLOC)) S GMRCX=GMRCVLOC
"RTN","GMRCP5A",159,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",160,0)
 ..I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0)) D  I 1
"RTN","GMRCP5A",161,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0))
"RTN","GMRCP5A",162,0)
 ..E  I '$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","")) D
"RTN","GMRCP5A",163,0)
 ...D BLD("RES",1,1,0,$$CENTER("CONSULTATION NOTE TEXT NOT AVAILABLE"))
"RTN","GMRCP5A",164,0)
 ..S GMRCR1=0 F  S GMRCR1=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1)) Q:'GMRCR1  D
"RTN","GMRCP5A",165,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1,0))
"RTN","GMRCP5A",166,0)
 ..;
"RTN","GMRCP5A",167,0)
 ..;  GET ADDENDUMS TO THIS NOTE
"RTN","GMRCP5A",168,0)
 ..;
"RTN","GMRCP5A",169,0)
 ..I +$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",0)) D ADDEND^GMRCP5D(GMRCIFN,GMRCR0,GMRCNDX,GMRCRD,PAGEWID)
"RTN","GMRCP5A",170,0)
 ;
"RTN","GMRCP5A",171,0)
 D FORMAT^GMRCP5D(GMRCIFN,GMRCRD,PAGEWID) ;  GET SERVICE REPORTS AND COMMENTS
"RTN","GMRCP5A",172,0)
 ;
"RTN","GMRCP5A",173,0)
 Q
"RTN","GMRCP5A",174,0)
 ;
"RTN","GMRCP5A",175,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5A",176,0)
 ;
"RTN","GMRCP5A",177,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5A",178,0)
 Q:'$L(X) ""
"RTN","GMRCP5A",179,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5A",180,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5A",181,0)
 ;
"RTN","GMRCP5A",182,0)
CENTER(X) ;
"RTN","GMRCP5A",183,0)
 ;
"RTN","GMRCP5A",184,0)
 N TEXT,COL
"RTN","GMRCP5A",185,0)
 S COL=35-($L(X)\2) Q:(COL<1) X
"RTN","GMRCP5A",186,0)
 S $E(TEXT,COL)=X
"RTN","GMRCP5A",187,0)
 Q TEXT
"RTN","GMRCP5A",188,0)
 ;
"RTN","GMRCP5A",189,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5A",190,0)
 ;
"RTN","GMRCP5A",191,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5A",192,0)
 N LINECNT
"RTN","GMRCP5A",193,0)
 ;
"RTN","GMRCP5A",194,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5A",195,0)
 ;
"RTN","GMRCP5A",196,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5A",197,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5A",198,0)
 ;
"RTN","GMRCP5A",199,0)
 S GMRCLAST=SUB
"RTN","GMRCP5A",200,0)
 Q
"RTN","GMRCP5A",201,0)
 ;
"RTN","GMRCP5A",202,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5A",203,0)
 ;
"RTN","GMRCP5A",204,0)
 N NEXT
"RTN","GMRCP5A",205,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5A",206,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5A",207,0)
 Q
"RTN","GMRCP5A",208,0)
 ;
"RTN","GMRCP5A",209,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5A",210,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5A",211,0)
 ;
"RTN","GMRCPC")
0^6^B10508967
"RTN","GMRCPC",1,0)
GMRCPC ;SLC/DCM,dee,MA - List Manager Routine: Collect and display consults by service and status ;4/18/01  10:29
"RTN","GMRCPC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,7,21**;DEC 27, 1997
"RTN","GMRCPC",3,0)
 ; Patch #21 added clean-up KILL for ^TMP("GMRCTOT",$J)
"RTN","GMRCPC",4,0)
EN ;GMRC List Manager Routine -- main entry point for GMRC PENDING CONSULTS
"RTN","GMRCPC",5,0)
 K GMRCSVC,GMRCSVCP
"RTN","GMRCPC",6,0)
 I $D(GMRCEACT),$L(GMRCEACT) D  I '$D(^GMR(123.5,$G(GMRCSVC),0)) D EXIT Q
"RTN","GMRCPC",7,0)
 .S GMRCSVCP=GMRCEACT
"RTN","GMRCPC",8,0)
 .S GMRCSVC=$O(^GMR(123.5,"B",GMRCSVCP,0))
"RTN","GMRCPC",9,0)
 .Q:'$D(^GMR(123.5,$G(GMRCSVC),0))
"RTN","GMRCPC",10,0)
 .;Build service array
"RTN","GMRCPC",11,0)
 .S GMRCDG=GMRCSVC
"RTN","GMRCPC",12,0)
 .D SERV1^GMRCASV
"RTN","GMRCPC",13,0)
 .S GMRCDT1="ALL"
"RTN","GMRCPC",14,0)
 .S GMRCDT2=0
"RTN","GMRCPC",15,0)
 .D LISTDATE^GMRCSTU1(GMRCDT1,GMRCDT2,.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCPC",16,0)
 ;If no service ask for one
"RTN","GMRCPC",17,0)
 I '$L($G(GMRCSVC)) D EN^GMRCSTLM I $D(GMRCQUT) D EXIT Q
"RTN","GMRCPC",18,0)
 ;Quit if no array of services
"RTN","GMRCPC",19,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S GMRCQUT=1 D EXIT Q
"RTN","GMRCPC",20,0)
 ;
"RTN","GMRCPC",21,0)
 D EN^VALM("GMRC PENDING CONSULTS")
"RTN","GMRCPC",22,0)
 ;
"RTN","GMRCPC",23,0)
HDR ; -- header code
"RTN","GMRCPC",24,0)
 Q:$D(GMRCQUT)!'$D(GMRCCT)
"RTN","GMRCPC",25,0)
 S VALMHDR(1)="To Service:  "_GMRCHEAD
"RTN","GMRCPC",26,0)
 S VALMHDR(2)="From: "_$G(GMRCEDT1)_"   To: "_$G(GMRCEDT2)
"RTN","GMRCPC",27,0)
 I $G(GMRCCTRL)=1 S VALMCAP="     "_VALMCAP
"RTN","GMRCPC",28,0)
 Q
"RTN","GMRCPC",29,0)
 ;
"RTN","GMRCPC",30,0)
INIT ; -- init variables and list array
"RTN","GMRCPC",31,0)
 ;This entry is not used ENORLM^GMRCSTLM is used instead.
"RTN","GMRCPC",32,0)
 Q
"RTN","GMRCPC",33,0)
 ;
"RTN","GMRCPC",34,0)
HELP ; -- help code
"RTN","GMRCPC",35,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","GMRCPC",36,0)
 Q
"RTN","GMRCPC",37,0)
 ;
"RTN","GMRCPC",38,0)
EXIT ; -- exit code
"RTN","GMRCPC",39,0)
 K CNT,CTRLCOL,GMRCCT,GMRCQUT,GMRCSVC,GMRCSVCP,VALMHDR,GMRCCOMP
"RTN","GMRCPC",40,0)
 K GMRCEDT1,GMRCEDT2
"RTN","GMRCPC",41,0)
 K GMRCHEAD,GMRCCTRL,GMRCSTAT
"RTN","GMRCPC",42,0)
 K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J),^TMP("GMRCR",$J,"CP"),^TMP("GMRCRINDEX",$J),^TMP("GMRCTOT",$J)
"RTN","GMRCPC",43,0)
 Q
"RTN","GMRCPC",44,0)
 ;
"RTN","GMRCPC",45,0)
EXPND ; -- expand code
"RTN","GMRCPC",46,0)
 Q
"RTN","GMRCPC",47,0)
 ;
"RTN","GMRCPC",48,0)
CWIDTH(GMRCCTRL) ;Prints a message about how wide the report is.
"RTN","GMRCPC",49,0)
 N WIDTH
"RTN","GMRCPC",50,0)
 S WIDTH=92
"RTN","GMRCPC",51,0)
 I GMRCCTRL#100\10 D
"RTN","GMRCPC",52,0)
 .I GMRCCTRL#100\10=1 S WIDTH=WIDTH+5
"RTN","GMRCPC",53,0)
 .E  S WIDTH=WIDTH+10
"RTN","GMRCPC",54,0)
 I GMRCCTRL#1000\100 S WIDTH=WIDTH-6
"RTN","GMRCPC",55,0)
 Q WIDTH
"RTN","GMRCPC",56,0)
 ;
"RTN","GMRCPC",57,0)
PWIDTH(GMRCCTRL) ;Prints a message about how wide the report is.
"RTN","GMRCPC",58,0)
 W !!,"This print out is "_$$CWIDTH(GMRCCTRL)_" columns wide."
"RTN","GMRCPC",59,0)
 Q
"RTN","GMRCPC",60,0)
 ;
"RTN","GMRCPC",61,0)
PRNTONLY(GMRCCTRL) ;Option to just send the report to a device.
"RTN","GMRCPC",62,0)
 N GMRCQUT,RETURN,GMRCDG,GMRCSTAT,VALMBCK
"RTN","GMRCPC",63,0)
 N GMRCDT1,GMRCDT2,GMRCEDT1,GMRCEDT2
"RTN","GMRCPC",64,0)
 ;Get the statuses
"RTN","GMRCPC",65,0)
 S GMRCSTAT=$$STS^GMRCPC1
"RTN","GMRCPC",66,0)
 I $D(GMRCQUT) D EXIT Q
"RTN","GMRCPC",67,0)
 ;Get the service and date range.
"RTN","GMRCPC",68,0)
 D EN^GMRCSTLM
"RTN","GMRCPC",69,0)
 I $D(GMRCQUT) D EXIT Q
"RTN","GMRCPC",70,0)
 ;Quit if no array of services
"RTN","GMRCPC",71,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S GMRCQUT=1 D EXIT Q
"RTN","GMRCPC",72,0)
 I '($D(GMRCCTRL)#2) S GMRCCTRL=0 ;default to just the list
"RTN","GMRCPC",73,0)
 D PWIDTH(GMRCCTRL)
"RTN","GMRCPC",74,0)
 ;Get the device
"RTN","GMRCPC",75,0)
 D PRNTASK^GMRCSTU
"RTN","GMRCPC",76,0)
 I $D(GMRCQUT) D EXIT Q
"RTN","GMRCPC",77,0)
 ;Save some things if the report is queued
"RTN","GMRCPC",78,0)
 I $D(IO("Q")) D
"RTN","GMRCPC",79,0)
 .S ZTSAVE("GMRCSTAT")=""
"RTN","GMRCPC",80,0)
 .S ZTSAVE("GMRCCTRL")=""
"RTN","GMRCPC",81,0)
 ;Create the report if not queued
"RTN","GMRCPC",82,0)
 E  D ENOR^GMRCSTLM(.RETURN,GMRCDG,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCCTRL)
"RTN","GMRCPC",83,0)
 ;Print the report
"RTN","GMRCPC",84,0)
 D PRNTIT^GMRCSTU("CP","PRNTQ^GMRCPC","CONSULT/REQUEST PACKAGE PRINT SERVICE CONSULTS BY STATUS FROM OPTION")
"RTN","GMRCPC",85,0)
 D EXIT
"RTN","GMRCPC",86,0)
 Q
"RTN","GMRCPC",87,0)
 ;
"RTN","GMRCPC",88,0)
PRNTQ ;Print Queued report from ^TMP global then kill off ^TMP & ^XTMP
"RTN","GMRCPC",89,0)
 ;Create the report
"RTN","GMRCPC",90,0)
 N RETURN,INDEX
"RTN","GMRCPC",91,0)
 D ENOR^GMRCSTLM(.RETURN,GMRCDG,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCCTRL)
"RTN","GMRCPC",92,0)
 U IO
"RTN","GMRCPC",93,0)
 S INDEX=""
"RTN","GMRCPC",94,0)
 F  S INDEX=$O(^TMP("GMRCR",$J,TMPNAME,INDEX)) Q:INDEX=""  W ^TMP("GMRCR",$J,TMPNAME,INDEX,0),!
"RTN","GMRCPC",95,0)
 K ^TMP("GMRCR",$J,TMPNAME),^XTMP("GMRCR",J,DOLLARH,"PRINT"),J,DOLLARH
"RTN","GMRCPC",96,0)
 D ^%ZISC
"RTN","GMRCPC",97,0)
 D EXIT
"RTN","GMRCPC",98,0)
 Q
"RTN","GMRCPC",99,0)
 ;
"RTN","GMRCSTL1")
0^9^B9817212
"RTN","GMRCSTL1",1,0)
GMRCSTL1 ;SLC/DCM,dee;MA - List Manager Format Routine - Get Active Consults by service - pending,active,scheduled,incomplete,etc. ;4/18/01  10:30
"RTN","GMRCSTL1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**7,21**;DEC 27, 1997
"RTN","GMRCSTL1",3,0)
 ; Patch #21 changed array GMRCTOT to ^TMP("GMRCTOT,$J)
"RTN","GMRCSTL1",4,0)
 ; This routine invokes IA #875, #2638
"RTN","GMRCSTL1",5,0)
 Q
"RTN","GMRCSTL1",6,0)
STATNAME(STATUS) ;Return the name for the status number
"RTN","GMRCSTL1",7,0)
 I STATUS<9 Q $S(STATUS=1:"Discont.",STATUS=2:"Completed",STATUS=3:"On Hold",STATUS=4:"Flagged",STATUS=5:"Pending",STATUS=6:"Active",STATUS=7:"Expired",STATUS=8:"Scheduled",1:"No Status")
"RTN","GMRCSTL1",8,0)
 E  Q $S(STATUS=9:"Incomplete",STATUS=10:"Delayed",STATUS=11:"Unreleased",STATUS=12:"Discont/Ed",STATUS=13:"Cancelled",STATUS=14:"Lapsed",STATUS=15:"Renewed",1:"No Status")
"RTN","GMRCSTL1",9,0)
 Q
"RTN","GMRCSTL1",10,0)
 ;
"RTN","GMRCSTL1",11,0)
STATABBR(STATUS) ;Return the name for the status number
"RTN","GMRCSTL1",12,0)
 Q ^ORD(100.01,STATUS,.1)
"RTN","GMRCSTL1",13,0)
 ;
"RTN","GMRCSTL1",14,0)
LISTTOT(COUNT,GEN,INDEX,NAME,GROUPNAM,CONTROL) ;
"RTN","GMRCSTL1",15,0)
 N LOOP,STATUS,STS,CTRLTEMP
"RTN","GMRCSTL1",16,0)
 S CTRLTEMP=$S(CONTROL#2:"^",1:"")
"RTN","GMRCSTL1",17,0)
 I GEN=2 D
"RTN","GMRCSTL1",18,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL1",19,0)
 . S ^TMP("GMRCR",$J,"CP",COUNT,0)=CTRLTEMP
"RTN","GMRCSTL1",20,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL1",21,0)
 . S ^TMP("GMRCR",$J,"CP",COUNT,0)=CTRLTEMP_"          GROUPER: "_NAME_" Totals:"
"RTN","GMRCSTL1",22,0)
 F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) I ^TMP("GMRCTOT",$J,GEN,INDEX,STATUS)>0 D
"RTN","GMRCSTL1",23,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTL1",24,0)
 .S STS=$$STATNAME(STATUS)
"RTN","GMRCSTL1",25,0)
 .I GEN=1 S ^TMP("GMRCR",$J,"CP",COUNT,0)=CTRLTEMP_"To Service "_NAME_" Total Requests "_STS_$J(^TMP("GMRCTOT",$J,1,INDEX,STATUS),6,0)
"RTN","GMRCSTL1",26,0)
 .E  S ^TMP("GMRCR",$J,"CP",COUNT,0)=CTRLTEMP_"To Grouper "_NAME_" Total Requests "_STS_$J(^TMP("GMRCTOT",$J,2,INDEX,STATUS),6,0)
"RTN","GMRCSTL1",27,0)
 ;If any printed are pending then print the total that are pending for all pending status.
"RTN","GMRCSTL1",28,0)
 I ^TMP("GMRCTOT",$J,GEN,INDEX,"P")>0 D
"RTN","GMRCSTL1",29,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTL1",30,0)
 .I GEN=1 S ^TMP("GMRCR",$J,"CP",COUNT,0)=CTRLTEMP_"Total Requests Pending Resolution To Service "_NAME_": "_$J(^TMP("GMRCTOT",$J,1,INDEX,"P"),6,0)
"RTN","GMRCSTL1",31,0)
 .E  S ^TMP("GMRCR",$J,"CP",COUNT,0)=CTRLTEMP_"Total Requests Pending Resolution To Grouper "_NAME_": "_$J(^TMP("GMRCTOT",$J,2,INDEX,"P"),6,0)
"RTN","GMRCSTL1",32,0)
 S COUNT=COUNT+1
"RTN","GMRCSTL1",33,0)
 I GEN=1 S ^TMP("GMRCR",$J,"CP",COUNT,0)=CTRLTEMP_"Total Requests To Service "_NAME_": "_$J(^TMP("GMRCTOT",$J,1,INDEX,"T"),6,0)
"RTN","GMRCSTL1",34,0)
 E  S ^TMP("GMRCR",$J,"CP",COUNT,0)=CTRLTEMP_"Total Requests To Grouper "_NAME_": "_$J(^TMP("GMRCTOT",$J,2,INDEX,"T"),6,0)
"RTN","GMRCSTL1",35,0)
 Q
"RTN","GMRCSTL1",36,0)
 ;
"RTN","GMRCSTL2")
0^7^B11548715
"RTN","GMRCSTL2",1,0)
GMRCSTL2 ;SLC/DCM,dee;MA - List Manager Format Routine - Get Active Consults by service - pending,active,scheduled,incomplete,etc. ;4/18/01  10:31
"RTN","GMRCSTL2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**7,21**;DEC 27, 1997
"RTN","GMRCSTL2",3,0)
 ; Patch #21 changed array GMRCTOT to ^TMP("GMRCTOT",$J)
"RTN","GMRCSTL2",4,0)
 ; Patch #21 also added a plus sign to the $P when setting
"RTN","GMRCSTL2",5,0)
 ; GMRCDLA to check for a NULL value.
"RTN","GMRCSTL2",6,0)
 ; This routine invokes IA #10035,#44, #10040
"RTN","GMRCSTL2",7,0)
 Q
"RTN","GMRCSTL2",8,0)
 ;
"RTN","GMRCSTL2",9,0)
ONESTAT ;Process one status
"RTN","GMRCSTL2",10,0)
 S ^TMP("GMRCTOT",$J,1,GMRCSVC,STATUS)=0
"RTN","GMRCSTL2",11,0)
 S ^TMP("GMRCTOT",$J,2,GMRCSVC,STATUS)=0
"RTN","GMRCSTL2",12,0)
 S GMRCXDT=$S(GMRCDT1="ALL":0,1:9999999-GMRCDT2-.6)
"RTN","GMRCSTL2",13,0)
 F  S GMRCXDT=$O(^GMR(123,"AE",GMRCSVC,STATUS,GMRCXDT)) Q:GMRCXDT=""!(GMRCXDT>(9999999-GMRCDT1))  D
"RTN","GMRCSTL2",14,0)
 .S GMRCPT=0
"RTN","GMRCSTL2",15,0)
ONE .;Loop for one consult at a time
"RTN","GMRCSTL2",16,0)
 .F  S GMRCPT=$O(^GMR(123,"AE",GMRCSVC,STATUS,GMRCXDT,GMRCPT)) Q:GMRCPT=""  D
"RTN","GMRCSTL2",17,0)
 ..; Check for bad "AE" x-ref
"RTN","GMRCSTL2",18,0)
 ..I '$D(^GMR(123,GMRCPT,0)) D  Q
"RTN","GMRCSTL2",19,0)
 ...K ^GMR(123,"AE",GMRCSVC,STATUS,GMRCXDT,GMRCPT)
"RTN","GMRCSTL2",20,0)
 ..I ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=0 D
"RTN","GMRCSTL2",21,0)
 ...S GMRCCT=GMRCCT+1
"RTN","GMRCSTL2",22,0)
 ...S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=CTRLTEMP
"RTN","GMRCSTL2",23,0)
 ...S GMRCCT=GMRCCT+1
"RTN","GMRCSTL2",24,0)
 ...S TEMP="SERVICE: "_GMRCSVCP
"RTN","GMRCSTL2",25,0)
 ...S:GMRCSVCG>0 TEMP=TEMP_" in Group: "_$P(^GMR(123.5,GMRCSVCG,0),"^",1)
"RTN","GMRCSTL2",26,0)
 ...S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=CTRLTEMP_TEMP
"RTN","GMRCSTL2",27,0)
 ...S NUMCLIN=NUMCLIN+1
"RTN","GMRCSTL2",28,0)
 ..S X=9999999-GMRCXDT
"RTN","GMRCSTL2",29,0)
 ..D REGDTM^GMRCU
"RTN","GMRCSTL2",30,0)
 ..S GMRCDT=$P(X," ",1)
"RTN","GMRCSTL2",31,0)
 ..S GMRCDLA=$P(X," ",1)
"RTN","GMRCSTL2",32,0)
 ..S GMRCD(0)=^GMR(123,GMRCPT,0)
"RTN","GMRCSTL2",33,0)
 ..S GMRCPTN=$P(^DPT($P(GMRCD(0),"^",2),0),"^",1)
"RTN","GMRCSTL2",34,0)
 ..S GMRCPTN=$P(GMRCPTN,",",1)_","_$E($P(GMRCPTN,",",2),1)_"."
"RTN","GMRCSTL2",35,0)
 ..S GMRCPTSN="("_$E($P(^(0),"^",9),6,9)_")"
"RTN","GMRCSTL2",36,0)
 ..S GMRCD=0
"RTN","GMRCSTL2",37,0)
 ..S GMRCD=$O(^GMR(123,GMRCPT,40,"B",GMRCD))
"RTN","GMRCSTL2",38,0)
 ..I GMRCD]"" D
"RTN","GMRCSTL2",39,0)
 ...S GMRCDA=""
"RTN","GMRCSTL2",40,0)
 ...S GMRCDA=$O(^GMR(123,+GMRCPT,40,"B",GMRCD,GMRCDA))
"RTN","GMRCSTL2",41,0)
 ..S GMRCDLA=$E($P($G(^GMR(123.1,+$P(GMRCD(0),"^",13),0)),"^"),1,19)
"RTN","GMRCSTL2",42,0)
 ..S GMRCLOC=$P(GMRCD(0),"^",4)
"RTN","GMRCSTL2",43,0)
 ..S:$L(GMRCLOC) GMRCLOC=$E($P($G(^SC(GMRCLOC,0)),"^",1),1,30) ;DBIA#10040
"RTN","GMRCSTL2",44,0)
 ..S LINETEMP=""
"RTN","GMRCSTL2",45,0)
CTRL ..I GMRCCTRL#100\10 D
"RTN","GMRCSTL2",46,0)
 ...I GMRCCTRL#100\10=1 D
"RTN","GMRCSTL2",47,0)
 ....S GMRCLINE=GMRCLINE+1
"RTN","GMRCSTL2",48,0)
 ....S ^TMP("GMRCRINDEX",$J,GMRCLINE)=GMRCPT
"RTN","GMRCSTL2",49,0)
 ....S LINETEMP=$J(GMRCLINE,4)_" "
"RTN","GMRCSTL2",50,0)
 ...E  S LINETEMP=$J(GMRCPT,9)_" "
"RTN","GMRCSTL2",51,0)
 ..I GMRCCTRL#2 S LINETEMP=GMRCPT_"^"_LINETEMP
"RTN","GMRCSTL2",52,0)
 ..I GMRCCTRL#1000\100 D
"RTN","GMRCSTL2",53,0)
 ...S STS=$$STATABBR^GMRCSTL1(STATUS)
"RTN","GMRCSTL2",54,0)
 ...S STS=STS_$J("",4-$L(STS)+1)
"RTN","GMRCSTL2",55,0)
 ..E  D
"RTN","GMRCSTL2",56,0)
 ...S STS=$$STATNAME^GMRCSTL1(STATUS)
"RTN","GMRCSTL2",57,0)
 ...S STS=STS_$J("",10-$L(STS)+1)
"RTN","GMRCSTL2",58,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTL2",59,0)
 ..S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=LINETEMP_STS_GMRCDLA_$J("",20-$L(GMRCDLA))_GMRCDT_" "_GMRCPTN_" "_GMRCPTSN_$J("",12-$L(GMRCPTN)+5)_GMRCLOC
"RTN","GMRCSTL2",60,0)
 ..;
"RTN","GMRCSTL2",61,0)
ADDTOT ..;Add to totals
"RTN","GMRCSTL2",62,0)
 ..;  for all status for this service
"RTN","GMRCSTL2",63,0)
 ..S ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=^TMP("GMRCTOT",$J,1,GMRCSVC,"T")+1
"RTN","GMRCSTL2",64,0)
 ..;  pending for this service
"RTN","GMRCSTL2",65,0)
 ..S:",3,4,5,6,8,9,11,99,"[(","_STATUS_",") ^TMP("GMRCTOT",$J,1,GMRCSVC,"P")=^TMP("GMRCTOT",$J,1,GMRCSVC,"P")+1
"RTN","GMRCSTL2",66,0)
 ..;  this status (STATUS) for this service
"RTN","GMRCSTL2",67,0)
 ..S ^TMP("GMRCTOT",$J,1,GMRCSVC,STATUS)=^TMP("GMRCTOT",$J,1,GMRCSVC,STATUS)+1
"RTN","GMRCSTL2",68,0)
 ;  this status (STATUS) for services to all of its groupers
"RTN","GMRCSTL2",69,0)
 F GRP=GROUPER:-1:1 S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),STATUS)=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),STATUS))+^TMP("GMRCTOT",$J,1,GMRCSVC,STATUS)
"RTN","GMRCSTL2",70,0)
 Q
"RTN","GMRCSTL2",71,0)
 ;
"RTN","GMRCSTLM")
0^8^B45219250
"RTN","GMRCSTLM",1,0)
GMRCSTLM ;SLC/DCM,dee,MA - List Manager Format Routine - Get Active Consults by service - pending,active,scheduled,incomplete,etc. ;4/18/01  10:31
"RTN","GMRCSTLM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,7,21**;DEC 27, 1997
"RTN","GMRCSTLM",3,0)
 ; Patch #21 added a initialization KILL for ^TMP("GMRCTOT",$J)
"RTN","GMRCSTLM",4,0)
 Q
"RTN","GMRCSTLM",5,0)
 ;
"RTN","GMRCSTLM",6,0)
EN ;Ask for new service and date range
"RTN","GMRCSTLM",7,0)
 K GMRCQUT
"RTN","GMRCSTLM",8,0)
 N DIROUT,DTOUT,DUOUT,DIR
"RTN","GMRCSTLM",9,0)
 ;
"RTN","GMRCSTLM",10,0)
 ;Ask for service
"RTN","GMRCSTLM",11,0)
 D ASRV^GMRCASV
"RTN","GMRCSTLM",12,0)
 I $D(GMRCQUT)!'$O(^TMP("GMRCSLIST",$J,0)) S VALMBCK="Q" Q
"RTN","GMRCSTLM",13,0)
 ;
"RTN","GMRCSTLM",14,0)
 ;Ask for date range
"RTN","GMRCSTLM",15,0)
 D ^GMRCSPD
"RTN","GMRCSTLM",16,0)
 I $D(GMRCQUT) S VALMBCK="Q" G EXIT
"RTN","GMRCSTLM",17,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,GMRCDT2,.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTLM",18,0)
 Q
"RTN","GMRCSTLM",19,0)
 ;
"RTN","GMRCSTLM",20,0)
ENOR(RETURN,GMRCSVC,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCCTRL) ;Entry point for GUI interface.
"RTN","GMRCSTLM",21,0)
 ;.RETURN:   This is the root to the returned temp array.
"RTN","GMRCSTLM",22,0)
 ;GMRCSVC:  Service for which consults are to be displayed.
"RTN","GMRCSTLM",23,0)
 ;GMRCDT1:  Starting date or "ALL"
"RTN","GMRCSTLM",24,0)
 ;GMRCDT2:  Ending date if not GMRCDT1="ALL"
"RTN","GMRCSTLM",25,0)
 ;GMRCSTAT: The list of status to include separated by commas
"RTN","GMRCSTLM",26,0)
 ;GMRCCTRL:   0, null or not define then just the display list is 
"RTN","GMRCSTLM",27,0)
 ;                displayed
"RTN","GMRCSTLM",28,0)
 ;            1 then the list will be two pieces with the first piece 
"RTN","GMRCSTLM",29,0)
 ;                being the ien of the consult for selection in the gui
"RTN","GMRCSTLM",30,0)
 ;                and the second piece being the display text.
"RTN","GMRCSTLM",31,0)
 ;           10 then the consults will have a line number on them for
"RTN","GMRCSTLM",32,0)
 ;                selection
"RTN","GMRCSTLM",33,0)
 ;           20 then the consults will have the consult number displayed
"RTN","GMRCSTLM",34,0)
 ;          100 then use abbreviations for the statuses
"RTN","GMRCSTLM",35,0)
 ;      1, (10 or 20) and 100 can be added together to add there features
"RTN","GMRCSTLM",36,0)
 ;
"RTN","GMRCSTLM",37,0)
 ;This temp array is used internally by the report:
"RTN","GMRCSTLM",38,0)
 ;^TMP("GMRCSLIST",$J,n)=ien^name^parient ien^"+" if grouper^status
"RTN","GMRCSTLM",39,0)
 ;  status is "" tracking and/or grouper
"RTN","GMRCSTLM",40,0)
 ;            1  grouper only
"RTN","GMRCSTLM",41,0)
 ;            2  tracking only
"RTN","GMRCSTLM",42,0)
 ;            9  disabled
"RTN","GMRCSTLM",43,0)
 ;
"RTN","GMRCSTLM",44,0)
 N GMRCEDT1,GMRCEDT2,GMRCDG,GMRCHEAD,GMRCCT,GMRCGRP,VALMCNT,VALMBCK
"RTN","GMRCSTLM",45,0)
 K ^TMP("GMRCR",$J,"CP")
"RTN","GMRCSTLM",46,0)
 S RETURN="^TMP(""GMRCR"",$J,""CP"")"
"RTN","GMRCSTLM",47,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTLM",48,0)
 Q:'$D(^GMR(123.5,$G(GMRCSVC),0))
"RTN","GMRCSTLM",49,0)
 ;Build service array
"RTN","GMRCSTLM",50,0)
 S GMRCDG=GMRCSVC
"RTN","GMRCSTLM",51,0)
 D SERV1^GMRCASV
"RTN","GMRCSTLM",52,0)
 ;Get external form of date range
"RTN","GMRCSTLM",53,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL"
"RTN","GMRCSTLM",54,0)
 S:GMRCDT1="ALL" GMRCDT2=0
"RTN","GMRCSTLM",55,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,$G(GMRCDT2),.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTLM",56,0)
 G ENORSTR
"RTN","GMRCSTLM",57,0)
 ;
"RTN","GMRCSTLM",58,0)
ENORLM ;Entry point for List Manager interface.
"RTN","GMRCSTLM",59,0)
 D WAIT^DICD
"RTN","GMRCSTLM",60,0)
 ;
"RTN","GMRCSTLM",61,0)
ENORSTR ;Common part
"RTN","GMRCSTLM",62,0)
 N GMRCDA,NUMCLIN,INDEX,STATUS,LOOP,GROUPER
"RTN","GMRCSTLM",63,0)
 N STS,GMRCD,GMRCDT,GMRCSVCG,TEMP
"RTN","GMRCSTLM",64,0)
 N GMRCPT,CTRLTEMP,LINETEMP,GMRCLINE
"RTN","GMRCSTLM",65,0)
 N GMRCPTN,GMRCPTSN,GMRCDLA,GMRCXDT,GMRCLOC,GMRCSVCP
"RTN","GMRCSTLM",66,0)
 N GRP
"RTN","GMRCSTLM",67,0)
 ;
"RTN","GMRCSTLM",68,0)
 ; Patch #21 added the kill for ^TMP("GMRCTOT",$J)
"RTN","GMRCSTLM",69,0)
 K ^TMP("GMRCR",$J,"CP"),^TMP("GMRCRINDEX",$J),^TMP("GMRCTOT",$J)
"RTN","GMRCSTLM",70,0)
 ;
"RTN","GMRCSTLM",71,0)
 S GMRCCT=0
"RTN","GMRCSTLM",72,0)
 S NUMCLIN=0
"RTN","GMRCSTLM",73,0)
 S GMRCLINE=0
"RTN","GMRCSTLM",74,0)
 S GROUPER=0
"RTN","GMRCSTLM",75,0)
 S GROUPER(0)=0
"RTN","GMRCSTLM",76,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",77,0)
 I '($D(GMRCCTRL)#2) S GMRCCTRL=0 ;default to just the list
"RTN","GMRCSTLM",78,0)
 S CTRLTEMP=$S(GMRCCTRL#2:"^",1:"")
"RTN","GMRCSTLM",79,0)
 S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=CTRLTEMP_$J("",28)_"Consult/Request By Status"
"RTN","GMRCSTLM",80,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",81,0)
 S TEMP="FROM: "_GMRCEDT1_"   TO: "_GMRCEDT2
"RTN","GMRCSTLM",82,0)
 S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=CTRLTEMP_$J("",40-($L(TEMP)/2)+.5)_TEMP
"RTN","GMRCSTLM",83,0)
 ;
"RTN","GMRCSTLM",84,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTLM",85,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL",GMRCDT2=0
"RTN","GMRCSTLM",86,0)
 I '($D(GMRCDT2)#2) S GMRCDT2=""
"RTN","GMRCSTLM",87,0)
 I '($D(GMRCSTAT)#2) S GMRCSTAT="3,4,5,6,8,9,11,99" ;pending consults
"RTN","GMRCSTLM",88,0)
 ;
"RTN","GMRCSTLM",89,0)
CAPTION ;Set the List Mangager Caption Line
"RTN","GMRCSTLM",90,0)
 ; Does GMRCCTRL contain 10 i.e. display line numbers
"RTN","GMRCSTLM",91,0)
 ;                    or 20 i.e. display consult number
"RTN","GMRCSTLM",92,0)
 I $G(VALMAR)="^TMP(""GMRCR"",$J,""CP"")" D
"RTN","GMRCSTLM",93,0)
 .I GMRCCTRL#100\10 D
"RTN","GMRCSTLM",94,0)
 ..I GMRCCTRL#100\10=1 D
"RTN","GMRCSTLM",95,0)
 ...; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",96,0)
 ...I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE","     St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",97,0)
 ...; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",98,0)
 ...E  D CHGCAP^VALM("CAPTION LINE","     Status      Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",99,0)
 ..; Do not display consult number
"RTN","GMRCSTLM",100,0)
 ..E  D
"RTN","GMRCSTLM",101,0)
 ...; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",102,0)
 ...I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE"," Number   St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",103,0)
 ...; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",104,0)
 ...E  D CHGCAP^VALM("CAPTION LINE"," Number   Status      Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",105,0)
 .E  D
"RTN","GMRCSTLM",106,0)
 ..; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",107,0)
 ..I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE","St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",108,0)
 ..; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",109,0)
 ..E  D CHGCAP^VALM("CAPTION LINE","Status      Last Action      Request Date  Patient Name      Pt Location")
"RTN","GMRCSTLM",110,0)
 ;Set screen width
"RTN","GMRCSTLM",111,0)
 S VALM("RM")=$$CWIDTH^GMRCPC(GMRCCTRL)
"RTN","GMRCSTLM",112,0)
 ;
"RTN","GMRCSTLM",113,0)
 S GMRCHEAD=$P($G(^TMP("GMRCSLIST",$J,+$O(^TMP("GMRCSLIST",$J,"")))),"^",2)
"RTN","GMRCSTLM",114,0)
 S INDEX=""
"RTN","GMRCSTLM",115,0)
SVC ;Loop on Service
"RTN","GMRCSTLM",116,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTLM",117,0)
 .S GMRCSVC=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTLM",118,0)
 .S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,INDEX),"^",2)
"RTN","GMRCSTLM",119,0)
 .S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)
"RTN","GMRCSTLM",120,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=0
"RTN","GMRCSTLM",121,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"P")=0
"RTN","GMRCSTLM",122,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"T")=0
"RTN","GMRCSTLM",123,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"P")=0
"RTN","GMRCSTLM",124,0)
GROUPER .;Check if starting a new Grouper
"RTN","GMRCSTLM",125,0)
 .F  Q:GROUPER(GROUPER)=GMRCSVCG  D
"RTN","GMRCSTLM",126,0)
 ..;End of a group so print the group totals
"RTN","GMRCSTLM",127,0)
 ..D LISTTOT^GMRCSTL1(.GMRCCT,2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),"",GMRCCTRL)
"RTN","GMRCSTLM",128,0)
 ..;pop grouper from stack
"RTN","GMRCSTLM",129,0)
 ..S GROUPER=GROUPER-1
"RTN","GMRCSTLM",130,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",4)="+" D
"RTN","GMRCSTLM",131,0)
 ..;Start of a new group so print the group heading.
"RTN","GMRCSTLM",132,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",133,0)
 ..S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=CTRLTEMP
"RTN","GMRCSTLM",134,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",135,0)
 ..S TEMP="GROUPER: "_GMRCSVCP
"RTN","GMRCSTLM",136,0)
 ..S:GMRCSVCG>0 TEMP=TEMP_"  in Group: "_$P(^GMR(123.5,GMRCSVCG,0),"^",1)
"RTN","GMRCSTLM",137,0)
 ..S ^TMP("GMRCR",$J,"CP",GMRCCT,0)=CTRLTEMP_$J("",40-(($L(TEMP)/2)+.5))_TEMP
"RTN","GMRCSTLM",138,0)
 ..;push new grouper on stack
"RTN","GMRCSTLM",139,0)
 ..S GROUPER=GROUPER+1
"RTN","GMRCSTLM",140,0)
 ..S GROUPER(GROUPER)=GMRCSVC
"RTN","GMRCSTLM",141,0)
STAT .;Loop for one status at a time
"RTN","GMRCSTLM",142,0)
 .F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) D ONESTAT^GMRCSTL2
"RTN","GMRCSTLM",143,0)
 .F GRP=GROUPER:-1:1 D
"RTN","GMRCSTLM",144,0)
 ..;  pending for this service to all of its groupers
"RTN","GMRCSTLM",145,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"P")
"RTN","GMRCSTLM",146,0)
 ..;  for all status for this service to all of its groupers
"RTN","GMRCSTLM",147,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"T")
"RTN","GMRCSTLM",148,0)
 .;
"RTN","GMRCSTLM",149,0)
PRINTST .;Print the totals for this service that are >0
"RTN","GMRCSTLM",150,0)
 .I ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")>0 D LISTTOT^GMRCSTL1(.GMRCCT,1,GMRCSVC,GMRCSVCP,$P($G(^GMR(123.5,GMRCSVCG,0)),"^",1),GMRCCTRL)
"RTN","GMRCSTLM",151,0)
 ;
"RTN","GMRCSTLM",152,0)
 ;Done so
"RTN","GMRCSTLM",153,0)
 ;Now list the group totals for the current groups
"RTN","GMRCSTLM",154,0)
 F GROUPER=GROUPER:-1:1 D
"RTN","GMRCSTLM",155,0)
 .D LISTTOT^GMRCSTL1(.GMRCCT,2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),"",GMRCCTRL)
"RTN","GMRCSTLM",156,0)
 ;
"RTN","GMRCSTLM",157,0)
 S VALMCNT=GMRCCT
"RTN","GMRCSTLM",158,0)
 I $D(IOBM),$D(IOTM) S VALMBCK="R"
"RTN","GMRCSTLM",159,0)
EXIT Q
"RTN","GMRCSTLM",160,0)
 ;
"RTN","GMRCSTS")
0^12^B42769284
"RTN","GMRCSTS",1,0)
GMRCSTS ;SLC/DLT,JFR,MA - Group update status of consult and order; 11/25/2000
"RTN","GMRCSTS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**8,18,21**;DEC 27, 1997
"RTN","GMRCSTS",3,0)
 ; Patch 18 - Change UPDCMT to use Editor to add comment and
"RTN","GMRCSTS",4,0)
 ; Added Scheduled consults to selection list.
"RTN","GMRCSTS",5,0)
 ; Patch 21 - Added warning message in line tag WARNING().
"RTN","GMRCSTS",6,0)
 ; This routine invokes IA #2876,3121
"RTN","GMRCSTS",7,0)
 N GMRCTO,GMRCDG,GMRCSVC,GMRCSVCN,GMRCEND,GMRCSTRT,GMRCSTOP,GMRCGRP
"RTN","GMRCSTS",8,0)
 N GMRCCVT,GMRCM,GMRCMT,GMRCDO,DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSTS",9,0)
 D GETSRV I 'GMRCDG D END Q
"RTN","GMRCSTS",10,0)
 D GETDTR I GMRCEND D END Q
"RTN","GMRCSTS",11,0)
 S GMRCM=$$METHOD I GMRCEND D END Q
"RTN","GMRCSTS",12,0)
 S GMRCCVT=$$UPD1 I GMRCEND D END Q
"RTN","GMRCSTS",13,0)
 D UPDCMT(.GMRCMT)
"RTN","GMRCSTS",14,0)
 D VERIFY I GMRCEND D END Q
"RTN","GMRCSTS",15,0)
 D GETENTS^GMRCSTS1(GMRCSVC,GMRCSTRT,GMRCSTOP,GMRCM)
"RTN","GMRCSTS",16,0)
 S GMRCDO=$$WHATTODO I 'GMRCDO D END Q
"RTN","GMRCSTS",17,0)
 D DEVICE I $G(GMRCEND) D END Q
"RTN","GMRCSTS",18,0)
 I $D(IO("Q")) D QUEUE,^%ZISC,END Q
"RTN","GMRCSTS",19,0)
 D PRINT^GMRCSTS1(GMRCM,GMRCCVT,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP,GMRCDO)
"RTN","GMRCSTS",20,0)
 D END Q
"RTN","GMRCSTS",21,0)
GETSRV ;Get a service that the user is authorized to update status for
"RTN","GMRCSTS",22,0)
 D ^GMRCASV Q:'GMRCDG
"RTN","GMRCSTS",23,0)
 S GMRCSVC=+GMRCDG,GMRCSVCN=$P($G(^GMR(123.5,+GMRCSVC,0)),U,1)
"RTN","GMRCSTS",24,0)
 I $P($G(^GMR(123.5,+GMRCDG,0)),"^",4)=DUZ Q  ;user has special privileges
"RTN","GMRCSTS",25,0)
 ;Check for parent service authorization
"RTN","GMRCSTS",26,0)
 N AUTH,PARENT
"RTN","GMRCSTS",27,0)
 I $P(^GMR(123.5,1,0),U,4)=DUZ Q
"RTN","GMRCSTS",28,0)
 S (AUTH,PARENT)=0 F  S PARENT=$O(^GMR(123.5,"APC",+GMRCDG,PARENT)) Q:'PARENT  S:$P($G(^GMR(123.5,+PARENT,0)),U,4)=DUZ AUTH=PARENT
"RTN","GMRCSTS",29,0)
 I 'AUTH D UNAUTH S GMRCDG=0 G GETSRV
"RTN","GMRCSTS",30,0)
 Q
"RTN","GMRCSTS",31,0)
 ;
"RTN","GMRCSTS",32,0)
UNAUTH ;Unauthorized to do special update processing for service or its parent.
"RTN","GMRCSTS",33,0)
 N GMRCMSG
"RTN","GMRCSTS",34,0)
 W !
"RTN","GMRCSTS",35,0)
 S GMRCMSG="You are not defined as the SPECIAL UPDATES INDIVIDUAL for the"
"RTN","GMRCSTS",36,0)
 S GMRCMSG(1)=GMRCSVCN_" service or its parent service."
"RTN","GMRCSTS",37,0)
 S GMRCDG=0
"RTN","GMRCSTS",38,0)
 D EXAC^GMRCADC(.GMRCMSG)
"RTN","GMRCSTS",39,0)
 Q
"RTN","GMRCSTS",40,0)
 ;
"RTN","GMRCSTS",41,0)
GETDTR ;Get the date range
"RTN","GMRCSTS",42,0)
 ;END=# of days (T-END) for stop default limitations
"RTN","GMRCSTS",43,0)
 ;GMRCSTRT=Start date/time
"RTN","GMRCSTS",44,0)
 ;GMRCSTOP=Stop date/time
"RTN","GMRCSTS",45,0)
 ;GMRCEND=1 if user timed out or "^"
"RTN","GMRCSTS",46,0)
 S GMRCEND=0
"RTN","GMRCSTS",47,0)
 N X1,X2,X,END
"RTN","GMRCSTS",48,0)
 S X1=$$DT^XLFDT,X2=-30 D C^%DTC S END=X K X
"RTN","GMRCSTS",49,0)
 D START Q:GMRCEND
"RTN","GMRCSTS",50,0)
 D STOP Q:GMRCEND
"RTN","GMRCSTS",51,0)
 Q
"RTN","GMRCSTS",52,0)
 ;
"RTN","GMRCSTS",53,0)
START ;Get the start date
"RTN","GMRCSTS",54,0)
 N DIR,Y,ORDER,FIRST,GMRCIEN
"RTN","GMRCSTS",55,0)
 S ORDER=$O(^GMR(123,"AC",0)),GMRCIEN=$O(^GMR(123,"AC",+ORDER,""))
"RTN","GMRCSTS",56,0)
 I +$G(GMRCIEN) D
"RTN","GMRCSTS",57,0)
 . S Y=$P($G(^GMR(123,GMRCIEN,0)),U,1)
"RTN","GMRCSTS",58,0)
 . X ^DD("DD") S FIRST=$P(Y,"@",1)
"RTN","GMRCSTS",59,0)
 . S DIR("B")=FIRST
"RTN","GMRCSTS",60,0)
 . W !!,"The first order in Consults has an entry date of "_DIR("B"),!
"RTN","GMRCSTS",61,0)
 . Q
"RTN","GMRCSTS",62,0)
 S DIR(0)="D^:"_END_":AEX",DIR("A")="Update Status Start Date"
"RTN","GMRCSTS",63,0)
 S DIR("?")="^D HELP^%DTC"
"RTN","GMRCSTS",64,0)
 D ^DIR
"RTN","GMRCSTS",65,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",66,0)
 S GMRCSTRT=Y
"RTN","GMRCSTS",67,0)
 Q
"RTN","GMRCSTS",68,0)
 ;
"RTN","GMRCSTS",69,0)
STOP ;Get the stop date
"RTN","GMRCSTS",70,0)
 N DIR,Y,X
"RTN","GMRCSTS",71,0)
 S DIR(0)="D^:"_END_":AEX",DIR("A")="Update Status Stop Date"
"RTN","GMRCSTS",72,0)
 D ^DIR
"RTN","GMRCSTS",73,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",74,0)
 I Y<GMRCSTRT S GMRCSTOP=GMRCSTRT,GMRCSTRT=Y
"RTN","GMRCSTS",75,0)
 E  S GMRCSTOP=Y
"RTN","GMRCSTS",76,0)
 Q
"RTN","GMRCSTS",77,0)
 ;
"RTN","GMRCSTS",78,0)
METHOD() ;Get method to determine which consults to change
"RTN","GMRCSTS",79,0)
 N DIR,Y,X
"RTN","GMRCSTS",80,0)
 ;S DIR(0)="SM^P:Pending;A:Active;S:Scheduled;ALL:For All"
"RTN","GMRCSTS",81,0)
 ;S DIR("A")="Status(es) to search for updating"
"RTN","GMRCSTS",82,0)
 S DIR("A",1)=""
"RTN","GMRCSTS",83,0)
 S DIR("A",2)=""
"RTN","GMRCSTS",84,0)
 S DIR("A",3)="                  1 = Pending"
"RTN","GMRCSTS",85,0)
 S DIR("A",4)="                  2 = Active"
"RTN","GMRCSTS",86,0)
 S DIR("A",5)="                  3 = Scheduled"
"RTN","GMRCSTS",87,0)
 S DIR("A",6)="                  4 = All"
"RTN","GMRCSTS",88,0)
 S DIR("A",7)=""
"RTN","GMRCSTS",89,0)
 S DIR("A",8)="    Enter any combination of numbers separated"
"RTN","GMRCSTS",90,0)
 S DIR("A")="    by a comma or hyphen"
"RTN","GMRCSTS",91,0)
 S DIR(0)="LO^1:4"
"RTN","GMRCSTS",92,0)
 D ^DIR
"RTN","GMRCSTS",93,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1
"RTN","GMRCSTS",94,0)
 Q Y
"RTN","GMRCSTS",95,0)
 S DIR(0)="SM^S:Order Status of Pending or Active;R:Result Activity"
"RTN","GMRCSTS",96,0)
 S DIR("A")="Method to find Consults to Update"
"RTN","GMRCSTS",97,0)
 D ^DIR
"RTN","GMRCSTS",98,0)
 I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1 Q Y
"RTN","GMRCSTS",99,0)
 Q Y
"RTN","GMRCSTS",100,0)
 ;
"RTN","GMRCSTS",101,0)
VERIFY ;Verify the criteria is correct
"RTN","GMRCSTS",102,0)
 W !
"RTN","GMRCSTS",103,0)
 D UPDCRIT^GMRCSTS1(GMRCCVT,GMRCM,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP)
"RTN","GMRCSTS",104,0)
 N DIR
"RTN","GMRCSTS",105,0)
 S DIR(0)="Y",DIR("A")="Is this correct",DIR("B")="NO"
"RTN","GMRCSTS",106,0)
 D ^DIR I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)!('Y)) S GMRCEND=1 Q
"RTN","GMRCSTS",107,0)
 Q
"RTN","GMRCSTS",108,0)
UPD1() ;Determine update status
"RTN","GMRCSTS",109,0)
 N DIR,X,Y
"RTN","GMRCSTS",110,0)
 W !!,"If orders in the date range still have the selected status, this option"
"RTN","GMRCSTS",111,0)
 W !,"will change their status in consults, and update the order."
"RTN","GMRCSTS",112,0)
 W !!,"You may change the status to COMPLETE or DISCONTINUED."
"RTN","GMRCSTS",113,0)
 W !
"RTN","GMRCSTS",114,0)
 S DIR(0)="SAM^D:Discontinued;C:Complete"
"RTN","GMRCSTS",115,0)
 S DIR("A")="Change their status to: "
"RTN","GMRCSTS",116,0)
 D ^DIR I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) S GMRCEND=1 Q Y
"RTN","GMRCSTS",117,0)
 Q $S(Y="D":"1^DC",1:"2^C")
"RTN","GMRCSTS",118,0)
 ;
"RTN","GMRCSTS",119,0)
DEVICE ; device for printout of entries to group update
"RTN","GMRCSTS",120,0)
 N %ZIS,POP
"RTN","GMRCSTS",121,0)
 W !!,"The device selected will print a list of entries from file 123 that will be"
"RTN","GMRCSTS",122,0)
 W !,"updated to ",$S(+GMRCCVT=1:"DISCONTINUED",1:"COMPLETE"),"."
"RTN","GMRCSTS",123,0)
 W !!,"If you choose to update records, the update of the consult entries will take"
"RTN","GMRCSTS",124,0)
 W !,"place upon completion of the report."
"RTN","GMRCSTS",125,0)
 W !!,"It is highly advised that a printer be selected!"
"RTN","GMRCSTS",126,0)
RETRY S %ZIS="QM",%ZIS("A")="Select device for report: ",%ZIS("B")=""
"RTN","GMRCSTS",127,0)
 D ^%ZIS
"RTN","GMRCSTS",128,0)
 I POP S GMRCEND=1 Q
"RTN","GMRCSTS",129,0)
 I $E(IOST,1,2)="C-" D  G:Y<1 RETRY
"RTN","GMRCSTS",130,0)
 . W !!,$C(7),"You have not chosen a printer!  If you do not choose a printer there will",!,"be no record of the entries that were updated."
"RTN","GMRCSTS",131,0)
 . N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSTS",132,0)
 . S DIR(0)="Y",DIR("A")="Are you sure you want to use this device"
"RTN","GMRCSTS",133,0)
 . S DIR("B")="NO" D ^DIR I $D(DIRUT) S GMRCEND=1
"RTN","GMRCSTS",134,0)
 Q
"RTN","GMRCSTS",135,0)
QUEUE ; send task for print and update
"RTN","GMRCSTS",136,0)
 I GMRCDO=2,'$$WARNING D ^%ZISC,END Q  ; Killed report
"RTN","GMRCSTS",137,0)
 N ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSAVE,ZTSK
"RTN","GMRCSTS",138,0)
 S ZTRTN="PRTTSK^GMRCSTS1",ZTDESC="UPDATE OF RECORDS FILE 123"
"RTN","GMRCSTS",139,0)
 S ZTIO=ION
"RTN","GMRCSTS",140,0)
 S ZTSAVE("^TMP(""GMRCLS"",$J,")="",ZTSAVE("GMRC*")=""
"RTN","GMRCSTS",141,0)
 D ^%ZTLOAD I $G(ZTSK) W !,"Task # ",ZTSK
"RTN","GMRCSTS",142,0)
 I '$G(ZTSK) W !,"Unable to queue report!  Try again later."
"RTN","GMRCSTS",143,0)
 Q
"RTN","GMRCSTS",144,0)
UPDCMT(COMMENT) ; get comment to stuff in consult activity
"RTN","GMRCSTS",145,0)
 W !
"RTN","GMRCSTS",146,0)
 N DWPK,DWLW,DIC,DIWEPSE,INDEX
"RTN","GMRCSTS",147,0)
 W !,"Enter the Comment to be applied to all selected Consults"
"RTN","GMRCSTS",148,0)
 S DIC="^TMP(""GMRCTMP"","_$J_",1,",DWLW=80,DWPK=1,DIWEPSE=1
"RTN","GMRCSTS",149,0)
 D EN^DIWE
"RTN","GMRCSTS",150,0)
 S INDEX=0
"RTN","GMRCSTS",151,0)
 F   S INDEX=$O(^TMP("GMRCTMP",$J,1,INDEX))  Q:'INDEX  D
"RTN","GMRCSTS",152,0)
 . S COMMENT(INDEX,0)=^TMP("GMRCTMP",$J,1,INDEX,0)
"RTN","GMRCSTS",153,0)
 K ^TMP("GMRCTMP",$J)
"RTN","GMRCSTS",154,0)
 Q
"RTN","GMRCSTS",155,0)
WHATTODO() ;how to handle the update
"RTN","GMRCSTS",156,0)
 N DIR
"RTN","GMRCSTS",157,0)
 S DIR(0)="SO^1:Print report only;2:Print report & update records;3:Quit"
"RTN","GMRCSTS",158,0)
 S DIR("A")="Choose the method to handle the report"
"RTN","GMRCSTS",159,0)
 D ^DIR I $D(DIRUT)!(Y=3) Q 0
"RTN","GMRCSTS",160,0)
 Q +Y
"RTN","GMRCSTS",161,0)
WARNING() ; If REPORT/UPDATE is being task issue warning message.
"RTN","GMRCSTS",162,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSTS",163,0)
 I $D(IO("Q")) D
"RTN","GMRCSTS",164,0)
 . W !,"WARNING - Records will automatically be updated since the"
"RTN","GMRCSTS",165,0)
 . W !,"report is being tasked.",!
"RTN","GMRCSTS",166,0)
 S DIR("B")="NO",DIR(0)="Y",DIR("A")="Do you wish to continue??"
"RTN","GMRCSTS",167,0)
 D ^DIR I $D(DIRUT) S Y=0
"RTN","GMRCSTS",168,0)
 Q +Y
"RTN","GMRCSTS",169,0)
END K ^TMP("GMRCLS",$J) Q
"RTN","GMRCSTS1")
0^13^B29194073
"RTN","GMRCSTS1",1,0)
GMRCSTS1 ;SLC/JFR,MA - GROUP UPDATE OF CONSULTS cont'd ;4/18/01  10:31
"RTN","GMRCSTS1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**8,18,21**;DEC 27, 1997
"RTN","GMRCSTS1",3,0)
 ; Patch 18 modified PRTTSK to stop for acknowledgement between
"RTN","GMRCSTS1",4,0)
 ; printing the report and continuing with the group update.
"RTN","GMRCSTS1",5,0)
 ; Patch 21 moved the ^%ZISC up a few lines to correct a problem
"RTN","GMRCSTS1",6,0)
 ; of menu going to the printer
"RTN","GMRCSTS1",7,0)
 ; This routine invokes IA #2638
"RTN","GMRCSTS1",8,0)
PROCESS(GMRCCVT,GMRCMT) ;Update consult status by service and date range
"RTN","GMRCSTS1",9,0)
 N GMRCO,GMRCSTS,GMRCTRLC,GMRCORNP,GMRCDEV,GMRCFF,GMRCAD,ORIFN
"RTN","GMRCSTS1",10,0)
 N GMRCOM1,ORIFN
"RTN","GMRCSTS1",11,0)
 Q:'GMRCCVT
"RTN","GMRCSTS1",12,0)
 I '$D(^TMP("GMRCLS",$J)) Q  ;no entries to update
"RTN","GMRCSTS1",13,0)
 S GMRCIEN=0 F  S GMRCIEN=$O(^TMP("GMRCLS",$J,GMRCIEN)) Q:'GMRCIEN  D
"RTN","GMRCSTS1",14,0)
 . Q:'$L($G(^GMR(123,GMRCIEN,0)))
"RTN","GMRCSTS1",15,0)
 . D AUDIT(GMRCIEN,+GMRCCVT,.GMRCMT)
"RTN","GMRCSTS1",16,0)
 . D STSUPD(GMRCIEN,+GMRCCVT)
"RTN","GMRCSTS1",17,0)
 . D CPRSUPDT(GMRCIEN,+GMRCCVT)
"RTN","GMRCSTS1",18,0)
 Q
"RTN","GMRCSTS1",19,0)
PRINT(GMRCM,GMRCCVT,GMRCSVC,GMRCMT,GMRCSTRT,GMRCSTOP,GMRCDO) ;untasked print of records to update
"RTN","GMRCSTS1",20,0)
PRTTSK ; print the report then start the processing
"RTN","GMRCSTS1",21,0)
 ; GMRCM= status of records to find A:active, P:pending, B:Both
"RTN","GMRCSTS1",22,0)
 ; GMRCCVT= status to update records with  1:dc,  2:complete
"RTN","GMRCSTS1",23,0)
 ; GMRCSVC= IEN from file 123.5
"RTN","GMRCSTS1",24,0)
 ; GMRCMT= array (passed by reference) of comment to stuff in records
"RTN","GMRCSTS1",25,0)
 ; GMRCSTRT= first entry date to find/update
"RTN","GMRCSTS1",26,0)
 ; GMRCSTOP= last entry date to find/update
"RTN","GMRCSTS1",27,0)
 ; GMRCDO= 1:print only, 2:print and update records
"RTN","GMRCSTS1",28,0)
 ; GMRCSTAT= Status of consult for the report (P,A,S)
"RTN","GMRCSTS1",29,0)
 N GMRCIEN,GMRCDFN,GMRCPG,GMRCEND,GMRCSTAT
"RTN","GMRCSTS1",30,0)
 S GMRCIEN=0
"RTN","GMRCSTS1",31,0)
 U IO
"RTN","GMRCSTS1",32,0)
 D HDR(1) S GMRCPG=2
"RTN","GMRCSTS1",33,0)
 I '$D(^TMP("GMRCLS",$J)) D  D END
"RTN","GMRCSTS1",34,0)
 . W !,"No records found meeting search criteria"
"RTN","GMRCSTS1",35,0)
 F  S GMRCIEN=$O(^TMP("GMRCLS",$J,GMRCIEN)) Q:'GMRCIEN!($G(GMRCEND))  D
"RTN","GMRCSTS1",36,0)
 . I $Y>(IOSL-5) D HDR(GMRCPG) Q:$G(GMRCEND)  S GMRCPG=GMRCPG+1
"RTN","GMRCSTS1",37,0)
 . Q:'$G(^GMR(123,GMRCIEN,0))
"RTN","GMRCSTS1",38,0)
 . I $P(^GMR(123,GMRCIEN,0),U,12)=1!($P(^(0),U,12)=2) Q
"RTN","GMRCSTS1",39,0)
 . W !,GMRCIEN,?8,$$FMTE^XLFDT(+^GMR(123,GMRCIEN,0))
"RTN","GMRCSTS1",40,0)
 . W ?29,$E($$GET1^DIQ(2,$P(^GMR(123,GMRCIEN,0),U,2),.01),1,26)
"RTN","GMRCSTS1",41,0)
 . W ?56,$$GET1^DIQ(2,$P(^GMR(123,GMRCIEN,0),U,2),.09)
"RTN","GMRCSTS1",42,0)
 . S GMRCSTAT=+^TMP("GMRCLS",$J,GMRCIEN)
"RTN","GMRCSTS1",43,0)
 . W ?70,$S(GMRCSTAT=5:"p",GMRCSTAT=6:"a",GMRCSTAT=8:"s",1:"?")
"RTN","GMRCSTS1",44,0)
 . W " to ",$S(+GMRCCVT=1:"dc",1:"c")
"RTN","GMRCSTS1",45,0)
 D ^%ZISC
"RTN","GMRCSTS1",46,0)
 I GMRCDO=2,'$D(ZTQUEUED) D  ; Not task
"RTN","GMRCSTS1",47,0)
 . S DIR(0)="S^Y:To Update;N:To Quit without Updating"
"RTN","GMRCSTS1",48,0)
 . S DIR("A")="Enter update status "
"RTN","GMRCSTS1",49,0)
 . I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) Q
"RTN","GMRCSTS1",50,0)
 . D ^DIR
"RTN","GMRCSTS1",51,0)
 . I Y="Y" D PROCESS(+GMRCCVT,.GMRCMT)
"RTN","GMRCSTS1",52,0)
 I GMRCDO=2,$D(ZTQUEUED) D PROCESS(+GMRCCVT,.GMRCMT) ; Tasked
"RTN","GMRCSTS1",53,0)
END K ^TMP("GMRCLS",$J)
"RTN","GMRCSTS1",54,0)
 Q
"RTN","GMRCSTS1",55,0)
 ;
"RTN","GMRCSTS1",56,0)
HDR(PAGE) ; print the header for the report
"RTN","GMRCSTS1",57,0)
 I PAGE'=1,$E(IOST,1,2)["C-" N Y D  I '+Y S GMRCEND=1 Q
"RTN","GMRCSTS1",58,0)
 . N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTS1",59,0)
 W @IOF
"RTN","GMRCSTS1",60,0)
 W !,"Group status update of consults in file 123",?70,"Page: ",PAGE W:PAGE'=1 !
"RTN","GMRCSTS1",61,0)
 I PAGE=1 W !,?49,"Printed: ",$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","GMRCSTS1",62,0)
 I PAGE=1 D UPDCRIT(GMRCCVT,GMRCM,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP)
"RTN","GMRCSTS1",63,0)
 W !,"Consult",?70,"Status"
"RTN","GMRCSTS1",64,0)
 W !,"Number    Requested          Patient                    SSN           Change"
"RTN","GMRCSTS1",65,0)
 W !,$$REPEAT^XLFSTR("-",79)
"RTN","GMRCSTS1",66,0)
 Q
"RTN","GMRCSTS1",67,0)
GETENTS(SERV,STRDT,STPDT,SRCH)  ;loop "AE" x-ref and dump into ^TMP
"RTN","GMRCSTS1",68,0)
 N IDT,IEN,STOPI,STRTI,STS,INDEX
"RTN","GMRCSTS1",69,0)
 W !!,"Searching database for entries matching search criteria",!
"RTN","GMRCSTS1",70,0)
 S STOPI=(9999999-STPDT)-1,STRTI=(9999999-STRDT)
"RTN","GMRCSTS1",71,0)
 F INDEX=1:1  Q:$P(SRCH,",",INDEX)=""  D
"RTN","GMRCSTS1",72,0)
 . I $P(SRCH,",",INDEX)=+4 S SRCH="1,2,3,"
"RTN","GMRCSTS1",73,0)
 ; Convert SRCH from 1,2,3 to 5,6,8 (pending,active,scheduled)
"RTN","GMRCSTS1",74,0)
 F INDEX=1:1  Q:$P(SRCH,",",INDEX)=""  D
"RTN","GMRCSTS1",75,0)
 . I $P(SRCH,",",INDEX)=+1 S STS=+5 D GETDATA
"RTN","GMRCSTS1",76,0)
 . I $P(SRCH,",",INDEX)=+2 S STS=+6 D GETDATA
"RTN","GMRCSTS1",77,0)
 . I $P(SRCH,",",INDEX)=+3 S STS=+8 D GETDATA
"RTN","GMRCSTS1",78,0)
GETDATA ; Write ^GMR(123,IEN,0) to TMP
"RTN","GMRCSTS1",79,0)
 S IDT=STOPI
"RTN","GMRCSTS1",80,0)
 F  S IDT=$O(^GMR(123,"AE",SERV,+STS,IDT)) Q:'IDT!(IDT>STRTI)  D
"RTN","GMRCSTS1",81,0)
 . S IEN=0 F  S IEN=$O(^GMR(123,"AE",SERV,+STS,IDT,IEN)) Q:'IEN  D
"RTN","GMRCSTS1",82,0)
 .. S ^TMP("GMRCLS",$J,IEN)=+STS_U_+^GMR(123,IEN,0)
"RTN","GMRCSTS1",83,0)
 .. W "."
"RTN","GMRCSTS1",84,0)
 Q
"RTN","GMRCSTS1",85,0)
AUDIT(GMRCO,UPDSTS,GMRCOM) ;Update the processing activity of the consult
"RTN","GMRCSTS1",86,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",87,0)
 ;UPDSTS= 1 for DC ;  2 for COMPLETE
"RTN","GMRCSTS1",88,0)
 N DA,DIE,GMRCA,GMRCDT,GMRCSTS
"RTN","GMRCSTS1",89,0)
 S GMRCDT=$$NOW^XLFDT,GMRCA=$S(UPDSTS=1:6,1:10)
"RTN","GMRCSTS1",90,0)
 S GMRCSTS=$P(^GMR(123,GMRCO,0),U,12)
"RTN","GMRCSTS1",91,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCSTS1",92,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1),$P(^GMR(123,GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCSTS1",93,0)
 S DIE="^GMR(123,"_+GMRCO_",40,",DA(1)=+GMRCO
"RTN","GMRCSTS1",94,0)
 S DR=".01////^S X=GMRCDT;1////^S X=GMRCA;2////^S X=GMRCDT;3////^S X=DUZ;4////^S X=DUZ"
"RTN","GMRCSTS1",95,0)
 D ^DIE
"RTN","GMRCSTS1",96,0)
 S ^GMR(123,+GMRCO,40,DA,1,0)="^^1^1^"_GMRCDT_"^"
"RTN","GMRCSTS1",97,0)
 I $D(GMRCOM) D
"RTN","GMRCSTS1",98,0)
 . M ^GMR(123,+GMRCO,40,DA,1)=GMRCOM
"RTN","GMRCSTS1",99,0)
 I '$D(GMRCOM) D
"RTN","GMRCSTS1",100,0)
 . N COMMENT
"RTN","GMRCSTS1",101,0)
 . S COMMENT="Status updated from "
"RTN","GMRCSTS1",102,0)
 . S COMMENT=COMMENT_$P(^ORD(100.01,+GMRCSTS,0),"^",1)
"RTN","GMRCSTS1",103,0)
 . S COMMENT=COMMENT_" to "_$S(+UPDSTS=2:"COMPLETE",1:"DISCONTINUED")
"RTN","GMRCSTS1",104,0)
 . S COMMENT=COMMENT_" during group status update process."
"RTN","GMRCSTS1",105,0)
 . S ^GMR(123,+GMRCO,40,DA,1,1,0)=COMMENT
"RTN","GMRCSTS1",106,0)
 K DIE,GMRCA,GMRCDT
"RTN","GMRCSTS1",107,0)
 Q
"RTN","GMRCSTS1",108,0)
STSUPD(GMRCO,UPDSTS) ;change status of consult to COMPLETE or DC
"RTN","GMRCSTS1",109,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",110,0)
 ;UPDSTS= 1 for DC ;  2 for COMPLETE
"RTN","GMRCSTS1",111,0)
 N DIE,DA,DR,X
"RTN","GMRCSTS1",112,0)
 S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCSTS1",113,0)
 S DR="8////^S X=+UPDSTS"
"RTN","GMRCSTS1",114,0)
 D ^DIE
"RTN","GMRCSTS1",115,0)
 Q
"RTN","GMRCSTS1",116,0)
CPRSUPDT(GMRCO,UPDSTS) ;Update CPRS order with new status
"RTN","GMRCSTS1",117,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",118,0)
 ;UPDSTS= status to update CPRS with
"RTN","GMRCSTS1",119,0)
 N GMRCDFN,CTRLCODE
"RTN","GMRCSTS1",120,0)
 S GMRCDFN=$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCSTS1",121,0)
 S CTRLCODE=$S(UPDSTS=1:"OD",1:"RE")
"RTN","GMRCSTS1",122,0)
 ; send HL7 message to CPRS to update order status
"RTN","GMRCSTS1",123,0)
 D EN^GMRCHL7(GMRCDFN,+GMRCO,"","",CTRLCODE,DUZ,"","",1)
"RTN","GMRCSTS1",124,0)
 Q
"RTN","GMRCSTS1",125,0)
UPDCRIT(UPD,STS,SVC,CMT,START,STOP) ;print update criteria on page 1
"RTN","GMRCSTS1",126,0)
 N INDEX,GMRCSTS
"RTN","GMRCSTS1",127,0)
 F INDEX=1:1  Q:$P(STS,",",INDEX)=""  D
"RTN","GMRCSTS1",128,0)
 . I STS[+4 S GMRCSTS="Active, Pending, and Scheduled" Q
"RTN","GMRCSTS1",129,0)
 . I $P(STS,",",INDEX)=+1 S $P(GMRCSTS,",",INDEX)="Pending"
"RTN","GMRCSTS1",130,0)
 . I $P(STS,",",INDEX)=+2 S $P(GMRCSTS,",",INDEX)="Active"
"RTN","GMRCSTS1",131,0)
 . I $P(STS,",",INDEX)=+3 S $P(GMRCSTS,",",INDEX)="Scheduled"
"RTN","GMRCSTS1",132,0)
 W !,"Records will be updated for:"
"RTN","GMRCSTS1",133,0)
 W !,$$REPEAT^XLFSTR("-",78)
"RTN","GMRCSTS1",134,0)
 W !,"          Service: "_$$GET1^DIQ(123.5,SVC,.01)
"RTN","GMRCSTS1",135,0)
 W !,"        Beginning: "_$$FMTE^XLFDT(START)
"RTN","GMRCSTS1",136,0)
 W !,"           Ending: "_$$FMTE^XLFDT(STOP)
"RTN","GMRCSTS1",137,0)
 W !,"           Update: "_GMRCSTS_" "_" Consults"
"RTN","GMRCSTS1",138,0)
 W !,"               To: "_$S(+UPD=2:"COMPLETE",1:"DISCONTINUED")
"RTN","GMRCSTS1",139,0)
 I $D(CMT) W !,"   Update Comment:" D
"RTN","GMRCSTS1",140,0)
 . N I S I=0 F  S I=$O(CMT(I)) Q:'I  D
"RTN","GMRCSTS1",141,0)
 .. W !,CMT(I,0)
"RTN","GMRCSTS1",142,0)
 W !,$$REPEAT^XLFSTR("-",78),!
"RTN","GMRCSTS1",143,0)
 Q
"RTN","GMRCTIU1")
0^2^B24070834
"RTN","GMRCTIU1",1,0)
GMRCTIU1 ;SLC/JER - More CT/TIU interface modules ;4/18/01  10:32
"RTN","GMRCTIU1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,21**;DEC 27, 1997
"RTN","GMRCTIU1",3,0)
ROLLBACK(DA,TIUDA) ; Roll-back a CT record when result is deleted or
"RTN","GMRCTIU1",4,0)
 ;reassigned
"RTN","GMRCTIU1",5,0)
 ;Disassociate Note logic
"RTN","GMRCTIU1",6,0)
 ;The action removes the association of a TIU note with a consult.
"RTN","GMRCTIU1",7,0)
 ;The new CPRS status will change to "ACTIVE", unless one of the
"RTN","GMRCTIU1",8,0)
 ;remaining notes has a completed status. 
"RTN","GMRCTIU1",9,0)
 ;This action should send an alert to the service notification users.
"RTN","GMRCTIU1",10,0)
 N DIE,DR,GMRCSTS,GMRCA,GMRCO,GMRCOM,GMRCORNP,GMRCDFN,GMRCNODE,GMRCLIST,GMRCD0,GMRCD1,GMRCSF,GMRCADUZ,MSGTOSRV,GMRCATX,GMRCORTX
"RTN","GMRCTIU1",11,0)
 S GMRCNODE=$G(^GMR(123,+DA,0))
"RTN","GMRCTIU1",12,0)
 ; If current result has never been posted, no need to roll back
"RTN","GMRCTIU1",13,0)
 ; Patch GMRC*1*21
"RTN","GMRCTIU1",14,0)
 I '+$O(^GMR(123,+DA,50,"B",+TIUDA_";TIU(8925,",0)) Q
"RTN","GMRCTIU1",15,0)
 I ($P(GMRCNODE,U,20)=TIUDA) S DIE="^GMR(123,",DR="16///@" D ^DIE
"RTN","GMRCTIU1",16,0)
 S GMRCD0=DA,GMRCD1=0 F  S GMRCD1=$O(^GMR(123,GMRCD0,50,GMRCD1)) Q:'GMRCD1  D
"RTN","GMRCTIU1",17,0)
 .N DA,DIK
"RTN","GMRCTIU1",18,0)
 .Q:'(TIUDA=+$G(^GMR(123,GMRCD0,50,GMRCD1,0)))
"RTN","GMRCTIU1",19,0)
 .S DA(1)=GMRCD0,DA=GMRCD1
"RTN","GMRCTIU1",20,0)
 .S DIK="^GMR(123,"_DA(1)_",50,"
"RTN","GMRCTIU1",21,0)
 .D ^DIK
"RTN","GMRCTIU1",22,0)
 ;
"RTN","GMRCTIU1",23,0)
 S GMRCA=12,GMRCO=DA
"RTN","GMRCTIU1",24,0)
 D GETLIST^GMRCTIUL(DA,2,1,.GMRCLIST)
"RTN","GMRCTIU1",25,0)
 S GMRCSTS=9
"RTN","GMRCTIU1",26,0)
 I '$G(GMRCLIST(0)) S GMRCSTS=6
"RTN","GMRCTIU1",27,0)
 E  S GMRCD0="" F  S GMRCD0=$O(^TMP("GMRC50",$J,GMRCD0)) Q:'$L(GMRCD0)  D
"RTN","GMRCTIU1",28,0)
 .Q:(+GMRCD0=TIUDA)
"RTN","GMRCTIU1",29,0)
 .S GMRCD1=0 F  S GMRCD1=$O(^TMP("GMRC50",$J,GMRCD0,GMRCD1)) Q:'GMRCD1  D
"RTN","GMRCTIU1",30,0)
 ..S:($P($G(^TMP("GMRC50",$J,GMRCD0,GMRCD1)),U,6)="completed") GMRCSTS=2
"RTN","GMRCTIU1",31,0)
 Q:$G(NOSAVE)
"RTN","GMRCTIU1",32,0)
 D STATUS^GMRCP
"RTN","GMRCTIU1",33,0)
 K ^TMP("GMRC50",$J),^TMP("GMRC50R",$J)
"RTN","GMRCTIU1",34,0)
 ;
"RTN","GMRCTIU1",35,0)
 S GMRCOM=0,MSGTOSRV=0,GMRCRSLT=TIUDA_";TIU(8925," D AUDIT^GMRCP
"RTN","GMRCTIU1",36,0)
 ;
"RTN","GMRCTIU1",37,0)
 ;Build message information if status has changed or sig finding="Y"
"RTN","GMRCTIU1",38,0)
 S GMRCSF=$P(GMRCNODE,U,19)
"RTN","GMRCTIU1",39,0)
 I ($P(GMRCNODE,U,12)=$P($G(^GMR(123,GMRCO,0)),U,12)) D  Q:GMRCATX=""
"RTN","GMRCTIU1",40,0)
 . S GMRCATX="" Q:GMRCSF'="Y"
"RTN","GMRCTIU1",41,0)
 . S GMRCATX="*Removed consult note for "
"RTN","GMRCTIU1",42,0)
 E  S GMRCATX=$S((GMRCSF="Y"):"*",1:"")_"Reactivated consult, removed note for ",MSGTOSRV=1
"RTN","GMRCTIU1",43,0)
 S GMRCORNP=$P(GMRCNODE,U,14),GMRCDFN=$P(GMRCNODE,U,2)
"RTN","GMRCTIU1",44,0)
 S GMRCORTX=$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCTIU1",45,0)
 S GMRCORTX=GMRCATX_GMRCORTX
"RTN","GMRCTIU1",46,0)
 S:GMRCORNP GMRCADUZ(GMRCORNP)=""
"RTN","GMRCTIU1",47,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,23,.GMRCADUZ,MSGTOSRV)
"RTN","GMRCTIU1",48,0)
 Q:($P(GMRCNODE,U,12)=$P($G(^GMR(123,+GMRCO,0)),U,12))
"RTN","GMRCTIU1",49,0)
 ;
"RTN","GMRCTIU1",50,0)
 ;On status change, send "SC" (status change) HL7 msg to update order
"RTN","GMRCTIU1",51,0)
 D EN^GMRCHL7(GMRCDFN,+GMRCO,$G(GMRCTYPE),$G(GMRCRB),"SC",GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCTIU1",52,0)
 Q
"RTN","GMRCTIU1",53,0)
 ;
"RTN","GMRCTIU1",54,0)
STATUS ;Update the status of a consult that has a TIU result
"RTN","GMRCTIU1",55,0)
 N GMRCAD,GMRCATX,GMRCOA,GMRCOSTS,GMRCOTFN,GMRC,GMRCSF,GMRCLAE,GMRCRSLT,GMRCADUZ,GMRCOADT
"RTN","GMRCTIU1",56,0)
 D GETOLD
"RTN","GMRCTIU1",57,0)
 S GMRCORNP=$G(GMRCAUTH) ;author
"RTN","GMRCTIU1",58,0)
 S GMRCRSLT=GMRCTUFN_";TIU(8925,"
"RTN","GMRCTIU1",59,0)
 ;
"RTN","GMRCTIU1",60,0)
 ;Evaluate whether a complete action is actually an addendum or New note
"RTN","GMRCTIU1",61,0)
 I GMRCA=10 S GMRCA=$$EVALACT(GMRCOSTS,+GMRCO,GMRCRSLT)
"RTN","GMRCTIU1",62,0)
 ;
"RTN","GMRCTIU1",63,0)
 ;Update the status and last activity field
"RTN","GMRCTIU1",64,0)
 ;Do not change the status if already completed
"RTN","GMRCTIU1",65,0)
 I GMRCOSTS=2,GMRCSTS=9 S GMRCSTS=2
"RTN","GMRCTIU1",66,0)
 D STATUS^GMRCP
"RTN","GMRCTIU1",67,0)
 ;
"RTN","GMRCTIU1",68,0)
 ;Update activity log
"RTN","GMRCTIU1",69,0)
 D AUDIT
"RTN","GMRCTIU1",70,0)
 ;
"RTN","GMRCTIU1",71,0)
 ;Update the last TIU entry modified and add result to result multiple
"RTN","GMRCTIU1",72,0)
 D ADD^GMRCTIUA(GMRCTUFN,GMRCO)
"RTN","GMRCTIU1",73,0)
 ;
"RTN","GMRCTIU1",74,0)
 ;Update order
"RTN","GMRCTIU1",75,0)
 S GMRCORNP=$P(^GMR(123,+GMRCO,0),"^",14)
"RTN","GMRCTIU1",76,0)
 D EN^GMRCHL7(GMRCDFN,+GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM)
"RTN","GMRCTIU1",77,0)
 ;
"RTN","GMRCTIU1",78,0)
 ;Send a message
"RTN","GMRCTIU1",79,0)
 I $$COMPLETE(GMRCA) D
"RTN","GMRCTIU1",80,0)
 .S GMRCATX=$S((GMRCSF="Y"):"*",1:"")_$S(GMRCA=14:"New Note for ",GMRCA=13:"Addendum Added for ",1:"")
"RTN","GMRCTIU1",81,0)
 .S GMRCORTX=GMRCATX_"Completed Consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCTIU1",82,0)
 .I $P(GMRC(0),"^",14) S GMRCADUZ($P(GMRC(0),"^",14))=""
"RTN","GMRCTIU1",83,0)
 .D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,23,.GMRCADUZ,0)
"RTN","GMRCTIU1",84,0)
 .Q
"RTN","GMRCTIU1",85,0)
 ;
"RTN","GMRCTIU1",86,0)
 Q
"RTN","GMRCTIU1",87,0)
 ;
"RTN","GMRCTIU1",88,0)
GETOLD ;save the old values of status, and the last activity data
"RTN","GMRCTIU1",89,0)
 ;to determine how to update status and TIU activity log
"RTN","GMRCTIU1",90,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0))
"RTN","GMRCTIU1",91,0)
 S GMRCDFN=$P(GMRC(0),"^",2)
"RTN","GMRCTIU1",92,0)
 S GMRCSF=$P(GMRC(0),U,19)
"RTN","GMRCTIU1",93,0)
 S GMRCOSTS=$P(GMRC(0),"^",12) ;status before activity
"RTN","GMRCTIU1",94,0)
 S GMRCLAE=+$P($G(^GMR(123,+GMRCO,40,0)),U,3) ;last activity entry
"RTN","GMRCTIU1",95,0)
 S GMRC(40)=$G(^GMR(123,+GMRCO,40,+GMRCLAE,0))
"RTN","GMRCTIU1",96,0)
 S GMRCOADT=+$P(GMRC(40),U,1) ;last activity entry date
"RTN","GMRCTIU1",97,0)
 S GMRCOA=$P(GMRC(40),"^",2) ;last activity
"RTN","GMRCTIU1",98,0)
 S GMRCOTFN=$P(GMRC(40),"^",9) ;last result
"RTN","GMRCTIU1",99,0)
 Q
"RTN","GMRCTIU1",100,0)
 ;
"RTN","GMRCTIU1",101,0)
AUDIT ;Determine appropriate update activity.
"RTN","GMRCTIU1",102,0)
 ;Quit if new activity is same as previous "Incomplete Rpt" activity
"RTN","GMRCTIU1",103,0)
 I GMRCOTFN=GMRCRSLT,GMRCOA=9,GMRCOA=GMRCA,GMRCOSTS=GMRCSTS Q
"RTN","GMRCTIU1",104,0)
 ;
"RTN","GMRCTIU1",105,0)
 S GMRCOM=0
"RTN","GMRCTIU1",106,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCTIU1",107,0)
 ;Check for overwrite of incomplete rpt activity if the new
"RTN","GMRCTIU1",108,0)
 ;activity occurs within 15 minutes of the last.
"RTN","GMRCTIU1",109,0)
 S GMRCOADT=$$FMADD^XLFDT(GMRCOADT,0,0,15)
"RTN","GMRCTIU1",110,0)
 I GMRCOTFN=GMRCRSLT,GMRCOA=9,$$COMPLETE(GMRCA),GMRCDT<GMRCOADT D AUDIT1 Q
"RTN","GMRCTIU1",111,0)
 D AUDIT^GMRCP Q
"RTN","GMRCTIU1",112,0)
 Q
"RTN","GMRCTIU1",113,0)
 ;
"RTN","GMRCTIU1",114,0)
AUDIT1 ;overwrite last activity
"RTN","GMRCTIU1",115,0)
 L +^GMR(123,+GMRCO,40):5 I '$T S GMRCUT=1,GMRCERR=1,GMRCERMS="Activity Trail Not filed - Consult In Use By Another User." L -^GMR(123,+GMRCO,40)  Q
"RTN","GMRCTIU1",116,0)
 S DA=$P(^GMR(123,+GMRCO,40,0),"^",3)
"RTN","GMRCTIU1",117,0)
 D AUDIT1^GMRCP
"RTN","GMRCTIU1",118,0)
 Q
"RTN","GMRCTIU1",119,0)
 ;
"RTN","GMRCTIU1",120,0)
COMPLETE(GMRCA) ;Determine if the action is a complete action (10,13,14)
"RTN","GMRCTIU1",121,0)
 Q $S(GMRCA=13:1,GMRCA=14:1,GMRCA=10:1,1:0)
"RTN","GMRCTIU1",122,0)
 ;
"RTN","GMRCTIU1",123,0)
EVALACT(GMRCOSTS,GMRCO,GMRCRSLT) ;Evaluate complete action based on prev results and sts
"RTN","GMRCTIU1",124,0)
 N EVALA,GMRCLAE
"RTN","GMRCTIU1",125,0)
 I '$D(^GMR(123,+GMRCO,50)) Q 10
"RTN","GMRCTIU1",126,0)
 I GMRCOSTS'=2 Q 10
"RTN","GMRCTIU1",127,0)
 I '$D(^GMR(123,+GMRCO,50,"B",GMRCRSLT)) Q 14
"RTN","GMRCTIU1",128,0)
 S EVALA=0,GMRCLAE=+$P($G(^GMR(123,+GMRCO,40,0)),U,3)+1
"RTN","GMRCTIU1",129,0)
 F  S GMRCLAE=$O(^GMR(123,+GMRCO,40,GMRCLAE),-1) Q:'GMRCLAE  D  Q:+EVALA
"RTN","GMRCTIU1",130,0)
 . S GMRCLAE(40)=^GMR(123,+GMRCO,40,GMRCLAE,0)
"RTN","GMRCTIU1",131,0)
 . I $P(GMRCLAE(40),U,9)=GMRCRSLT D
"RTN","GMRCTIU1",132,0)
 .. I $P(GMRCLAE(40),U,2)=9 S EVALA=14 Q
"RTN","GMRCTIU1",133,0)
 .. I $$COMPLETE($P(GMRCLAE(40),U,2)) S EVALA=13 Q
"RTN","GMRCTIU1",134,0)
 I +EVALA Q EVALA
"RTN","GMRCTIU1",135,0)
 Q 10
"RTN","GMRCTIU1",136,0)
 ;
"RTN","GMRCUTL1")
0^4^B9504563
"RTN","GMRCUTL1",1,0)
GMRCUTL1 ;SLC/DCM,JFR,MA - General Utilities ;4/18/01  10:32
"RTN","GMRCUTL1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,12,15,21**;DEC 27, 1997
"RTN","GMRCUTL1",3,0)
 ;
"RTN","GMRCUTL1",4,0)
 ; This routine invokes IA #2876,3121
"RTN","GMRCUTL1",5,0)
 ; Patch #21 added variable GMRCAUDT and moved line tag PRNTAUDT
"RTN","GMRCUTL1",6,0)
 ; to GMRCP5A.
"RTN","GMRCUTL1",7,0)
 ;
"RTN","GMRCUTL1",8,0)
ACTM ;;Set correct variables to complete, discontinue, etc. a consult
"RTN","GMRCUTL1",9,0)
 K GMRCQUT
"RTN","GMRCUTL1",10,0)
 S:'+$G(GMRCA) GMRCA=$O(^GMR(123.1,"B",GMRCACTM,""))
"RTN","GMRCUTL1",11,0)
 S GMRCACTM=$P($G(^GMR(123.1,+GMRCA,0)),"^")
"RTN","GMRCUTL1",12,0)
 S ORSTS=$S(GMRCA:$P(^GMR(123.1,GMRCA,0),"^",2),1:0)
"RTN","GMRCUTL1",13,0)
 I 'GMRCA S GMRCQUT=1
"RTN","GMRCUTL1",14,0)
 Q
"RTN","GMRCUTL1",15,0)
PRNT(SRVCIFN,GMRCO) ;print form 513 to a printer when new consult is entered
"RTN","GMRCUTL1",16,0)
 N ORVP,GMRCDEV,GMRCQUED,IOP,%ZIS,POP,ZTDTH,ZTDESC,ZTIO,ZTRTN,ZTSK,GMRCAUDT
"RTN","GMRCUTL1",17,0)
 I '$G(SRVCIFN) S SRVCIFN=+$P(^GMR(123,GMRCO,0),U,5)
"RTN","GMRCUTL1",18,0)
 Q:'$D(^GMR(123.5,SRVCIFN,123))  Q:'$P(^GMR(123.5,SRVCIFN,123),"^",9)
"RTN","GMRCUTL1",19,0)
 S IOP="`"_$P(^GMR(123.5,SRVCIFN,123),"^",9)
"RTN","GMRCUTL1",20,0)
 S %ZIS="N" D ^%ZIS I POP D HOME^%ZIS Q
"RTN","GMRCUTL1",21,0)
 S GMRCDEV=ION,GMRCQUED=1,GMRCAUDT=1
"RTN","GMRCUTL1",22,0)
 S ZTRTN="PRNT^GMRCP5A("_(+GMRCO)_","_(+$G(TIUFLG))_",1,"""_$G(GMRCCPY,"W")_""",0,"_(GMRCAUDT)_")"
"RTN","GMRCUTL1",23,0)
 S ZTDESC="CONSULT/REQUEST PACKAGE PRINT FORM 513 FOR NEW CONSULT"
"RTN","GMRCUTL1",24,0)
 S ZTIO=GMRCDEV,ZTDTH=$H
"RTN","GMRCUTL1",25,0)
 D ^%ZTLOAD
"RTN","GMRCUTL1",26,0)
 D HOME^%ZIS
"RTN","GMRCUTL1",27,0)
 K GMRCQUED,GMRCDEV1
"RTN","GMRCUTL1",28,0)
 Q
"RTN","GMRCUTL1",29,0)
END K GMRCDEV,GMRCDEV1,GMRCOREC,GMRCFMT
"RTN","GMRCUTL1",30,0)
 Q
"RTN","GMRCUTL1",31,0)
PROVDX(OI) ;return PROV DX prompting info from 123.5
"RTN","GMRCUTL1",32,0)
 ;    Input:
"RTN","GMRCUTL1",33,0)
 ;       OI = ref to file 123.5("#;99CON") or file 123.3 (#;99PRC)
"RTN","GMRCUTL1",34,0)
 ;
"RTN","GMRCUTL1",35,0)
 ;    Returns:  string  A^B
"RTN","GMRCUTL1",36,0)
 ;       A = O (optional), R (required) or S (suppress)
"RTN","GMRCUTL1",37,0)
 ;       B = F (free-text) or L (lexicon)
"RTN","GMRCUTL1",38,0)
 ;
"RTN","GMRCUTL1",39,0)
 N GMRCFIL
"RTN","GMRCUTL1",40,0)
 Q:'+$G(OI) "^"
"RTN","GMRCUTL1",41,0)
 S GMRCFIL=$S(OI["99PRC":123.3,1:123.5)
"RTN","GMRCUTL1",42,0)
 Q:'$D(^GMR(GMRCFIL,+OI)) "^"
"RTN","GMRCUTL1",43,0)
 N STRING,NODE
"RTN","GMRCUTL1",44,0)
 I GMRCFIL=123.3 S NODE=$P(^GMR(123.3,+OI,0),U,7,8)
"RTN","GMRCUTL1",45,0)
 I GMRCFIL=123.5 S NODE=$P($G(^GMR(123.5,+OI,1)),U,1,2)
"RTN","GMRCUTL1",46,0)
 I NODE="" Q "O^F" ;values not set
"RTN","GMRCUTL1",47,0)
 S $P(STRING,U)=$S($L($P(NODE,U)):$P(NODE,U),1:"O")
"RTN","GMRCUTL1",48,0)
 S $P(STRING,U,2)=$S($L($P(NODE,U,2)):$P(NODE,U,2),1:"F")
"RTN","GMRCUTL1",49,0)
 Q STRING
"RTN","GMRCUTL1",50,0)
ORIFN(GMRC123) ;return ORIFN associated with give record in ^GMR(123,
"RTN","GMRCUTL1",51,0)
 ; GMRC123 = ien of consult record in file 123
"RTN","GMRCUTL1",52,0)
 Q $P($G(^GMR(123,GMRC123,0)),U,3)
"RTN","GMRCUTL1",53,0)
GETDT(PROMPT,DEFAULT) ;prompt and return FM date
"RTN","GMRCUTL1",54,0)
 ;Input:
"RTN","GMRCUTL1",55,0)
 ;  PROMPT  = text of prompt - DIR("A")          (optional)
"RTN","GMRCUTL1",56,0)
 ;  DEFAULT = default date to prompt - DIR("B")  (optional)
"RTN","GMRCUTL1",57,0)
 ; 
"RTN","GMRCUTL1",58,0)
 ;Output:
"RTN","GMRCUTL1",59,0)
 ; FM date/time if successfully answered, "^" if exit or timeout
"RTN","GMRCUTL1",60,0)
 N DIR,DIRUT,DIROUT,DTOUT,DUOUT,X,Y
"RTN","GMRCUTL1",61,0)
 S DIR(0)="DA^::EPT"
"RTN","GMRCUTL1",62,0)
 S DIR("?")="Enter the date/time the activity took place."
"RTN","GMRCUTL1",63,0)
 S DIR("A")=$S($D(PROMPT):PROMPT_" ",1:"Actual Date/Time of Activity: ")
"RTN","GMRCUTL1",64,0)
 S DIR("B")=$S($D(DEFAULT):DEFAULT,1:"NOW")
"RTN","GMRCUTL1",65,0)
 D ^DIR
"RTN","GMRCUTL1",66,0)
 I $D(DUOUT)!($D(DTOUT)) S Y="^"
"RTN","GMRCUTL1",67,0)
 Q Y
"RTN","GMRCUTL1",68,0)
 ;
"RTN","GMRCUTL1",69,0)
DCPRNT(IEN,USER) ;reprint SF-513 on DC?
"RTN","GMRCUTL1",70,0)
 N SERV,REPR
"RTN","GMRCUTL1",71,0)
 S SERV=$P(^GMR(123,IEN,0),U,5) I 'SERV Q 0
"RTN","GMRCUTL1",72,0)
 S REPR=$P($G(^GMR(123.5,SERV,1)),U,5)
"RTN","GMRCUTL1",73,0)
 I 'REPR Q 1
"RTN","GMRCUTL1",74,0)
 I REPR=2 Q 0
"RTN","GMRCUTL1",75,0)
 I REPR=1,'$$VALID^GMRCAU(SERV,IEN,USER) Q 1
"RTN","GMRCUTL1",76,0)
 Q 0
"RTN","GMRCUTL1",77,0)
 ;
"RTN","GMRCUTL1",78,0)
PREREQ(GMRCARR,GMRCSRV,GMRCDFN,UNRESOLV) ; return service pre-requisite
"RTN","GMRCUTL1",79,0)
 ; pre-requisite stored in 125 nodes in file 123.5 or 123.3
"RTN","GMRCUTL1",80,0)
 ; GMRCARR = array to return containing pre-requisite
"RTN","GMRCUTL1",81,0)
 ; GMRCSRV = ref to file 123.5 (ien;99CON) or 123.3 (ien;99PRC)
"RTN","GMRCUTL1",82,0)
 ; GMRCDFN = patient identifier if to return resolved
"RTN","GMRCUTL1",83,0)
 ; UNRESOLV = 1 or 0 ; if UNRESOLV=1 GMRCARR will be returned unresolved
"RTN","GMRCUTL1",84,0)
 Q:'+GMRCSRV
"RTN","GMRCUTL1",85,0)
 N GMRCFIL
"RTN","GMRCUTL1",86,0)
 S GMRCFIL=$S(GMRCSRV["99PRC":123.3,1:123.5)
"RTN","GMRCUTL1",87,0)
 Q:'$D(^GMR(GMRCFIL,+GMRCSRV,125))
"RTN","GMRCUTL1",88,0)
 I '$D(GMRCDFN)!($G(UNRESOLV)) D  Q
"RTN","GMRCUTL1",89,0)
 . M @GMRCARR=^GMR(GMRCFIL,+GMRCSRV,125)
"RTN","GMRCUTL1",90,0)
 D BLRPLT^TIUSRVD(,,GMRCDFN,,$NA(^GMR(GMRCFIL,+GMRCSRV,125)))
"RTN","GMRCUTL1",91,0)
 I $D(^TMP("TIUBOIL",$J)) M @GMRCARR=^TMP("TIUBOIL",$J)
"RTN","GMRCUTL1",92,0)
 K ^TMP("TIUBOIL",$J)
"RTN","GMRCUTL1",93,0)
 Q
"RTN","GMRCYP21")
0^^B1100411
"RTN","GMRCYP21",1,0)
GMRCYP21 ;SLC/MA - Post Install for patch 21 ; 11/25/2000
"RTN","GMRCYP21",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**21**;DEC 27, 1997
"RTN","GMRCYP21",3,0)
SECURITY ;
"RTN","GMRCYP21",4,0)
 ; Set the security on ^GMR(123.5) so that only users with programmer
"RTN","GMRCYP21",5,0)
 ; access (@) can delete a Consult/Request Servie.
"RTN","GMRCYP21",6,0)
 N SECURITY,GMRCARAY
"RTN","GMRCYP21",7,0)
 S SECURITY("DEL")="@"
"RTN","GMRCYP21",8,0)
 D FILESEC^DDMOD(123.5,.SECURITY)
"RTN","GMRCYP21",9,0)
 D FILE^DID(123.5,"","DEL ACCESS","GMRCARAY")
"RTN","GMRCYP21",10,0)
 I GMRCARAY("DEL ACCESS")'="@" D
"RTN","GMRCYP21",11,0)
 . D BMES^XPDUTL("DEL ACCESS SECURITY DID NOT GET SET TO PROGRAMMER ACCESS")
"RTN","GMRCYP21",12,0)
 . D BMES^XPDUTL("VERIFY THAT  ^DIC(123.5,0,""DEL"" GOT SET TO ""@""")
"RTN","GMRCYP21",13,0)
 . D BMES^XPDUTL("IF THIS IS NOT DONE THE POST-INSTALL DID NOT WORK")
"RTN","GMRCYP21",14,0)
 . D BMES^XPDUTL("CORRECTLY AND FURTHER RESEARCH IS REQUIRED")
"RTN","GMRCYP21",15,0)
 Q
"SEC","^DD",123,123,40,8)

"UP",123,123.02,-1)
123^40
"UP",123,123.02,0)
123.02
"UP",123.5,123.51,-1)
123.5^10
"UP",123.5,123.51,0)
123.51
"VER")
8.0^22.0
"^DD",123,123,40,0)
REQUEST PROCESSING ACTIVITY^123.02DA^^40;0
"^DD",123,123,40,21,0)
^^1^1^2980425^^^^
"^DD",123,123,40,21,1,0)
Maintains history of processing actions.
"^DD",123,123,40,"DT")
2910507
"^DD",123,123.02,0)
REQUEST PROCESSING ACTIVITY SUB-FIELD^^10^11
"^DD",123,123.02,0,"NM","REQUEST PROCESSING ACTIVITY")

"^DD",123,123.02,.01,0)
DATE/TIME OF ACTION ENTRY^RDX^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",123,123.02,.01,.1)
ACTIVITY ENTRY DATE
"^DD",123,123.02,.01,1,0)
^.1
"^DD",123,123.02,.01,1,1,0)
123.02^B
"^DD",123,123.02,.01,1,1,1)
S ^GMR(123,DA(1),40,"B",$E(X,1,30),DA)=""
"^DD",123,123.02,.01,1,1,2)
K ^GMR(123,DA(1),40,"B",$E(X,1,30),DA)
"^DD",123,123.02,.01,3)
Enter the Date/Time you are entering this activity.
"^DD",123,123.02,.01,21,0)
^^2^2^2960129^^
"^DD",123,123.02,.01,21,1,0)
This is the actual date and time the activity tracking update was added
"^DD",123,123.02,.01,21,2,0)
to the REQUEST PROCESSING ACTIVITY multiple.
"^DD",123,123.02,.01,"DT")
3010306
"^DD",123,123.02,2,0)
DATE/TIME OF ACTUAL ACTIVITY^DX^^0;3^S %DT="ETXRS",%DT(0)="-NOW" D ^%DT K %DT(0) S X=Y K:Y<1 X
"^DD",123,123.02,2,.1)

"^DD",123,123.02,2,3)
ENTER BOTH DATE AND TIME.  FUTURE DATE/TIME NOT PERMITTED.
"^DD",123,123.02,2,21,0)
^^2^2^2970611^^^^
"^DD",123,123.02,2,21,1,0)
The Date and time the actual activity was done.  This may be different 
"^DD",123,123.02,2,21,2,0)
than the DATE/TIME OF ACTION ENTRY for certain actions.
"^DD",123,123.02,2,"DT")
3010321
"^DD",123.1,123.1,0)
FIELD^^7^8
"^DD",123.1,123.1,0,"DDA")
N
"^DD",123.1,123.1,0,"DT")
2980701
"^DD",123.1,123.1,0,"IX","AC",123.1,1)

"^DD",123.1,123.1,0,"IX","B",123.1,.01)

"^DD",123.1,123.1,0,"IX","D",123.1,5)

"^DD",123.1,123.1,0,"NM","REQUEST ACTION TYPES")

"^DD",123.1,123.1,0,"PT",101,6)

"^DD",123.1,123.1,0,"PT",123,9)

"^DD",123.1,123.1,0,"PT",123.02,1)

"^DD",123.1,123.1,0,"VRPK")
GMRC
"^DD",123.1,123.1,.001,0)
NUMBER^NJ6,0^^ ^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",123.1,123.1,.001,3)
Enter a number between your sites prefix_000 and your sites prefix_999.
"^DD",123.1,123.1,.001,21,0)
^^1^1^2971205^
"^DD",123.1,123.1,.001,21,1,0)
The internal entry number of the Request Action Type.
"^DD",123.1,123.1,.001,"DT")
2971205
"^DD",123.1,123.1,.01,0)
ACTION TYPE^RFX^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>80!($L(X)<3)!'(X'?1P.E)!(X'?.ANP) X
"^DD",123.1,123.1,.01,1,0)
^.1^^-1
"^DD",123.1,123.1,.01,1,1,0)
123.1^B
"^DD",123.1,123.1,.01,1,1,1)
S ^GMR(123.1,"B",$E(X,1,30),DA)=""
"^DD",123.1,123.1,.01,1,1,2)
K ^GMR(123.1,"B",$E(X,1,30),DA)
"^DD",123.1,123.1,.01,3)
ENTER THE ACTION NAME. ANSWER MUST BE 3-80 CHARACTERS IN LENGTH
"^DD",123.1,123.1,.01,21,0)
^^6^6^2970911^^^^
"^DD",123.1,123.1,.01,21,1,0)
This file contains the tracking actions which may be taken to track
"^DD",123.1,123.1,.01,21,2,0)
a Consult or Request order from its entry in CPRS through its
"^DD",123.1,123.1,.01,21,3,0)
resolution.
"^DD",123.1,123.1,.01,21,4,0)
 
"^DD",123.1,123.1,.01,21,5,0)
This file also contains relationships of CPRS statuses which are the
"^DD",123.1,123.1,.01,21,6,0)
result of the action taken.
"^DD",123.1,123.1,.01,"DT")
2910529
"^DD",123.1,123.1,1,0)
RELATED OE/RR STATUS^P100.01'^ORD(100.01,^0;2^Q
"^DD",123.1,123.1,1,1,0)
^.1
"^DD",123.1,123.1,1,1,1,0)
123.1^AC
"^DD",123.1,123.1,1,1,1,1)
S ^GMR(123.1,"AC",$E(X,1,30),DA)=""
"^DD",123.1,123.1,1,1,1,2)
K ^GMR(123.1,"AC",$E(X,1,30),DA)
"^DD",123.1,123.1,1,1,1,"%D",0)
^^3^3^2920608^^^
"^DD",123.1,123.1,1,1,1,"%D",1,0)
This cross-reference is used when the call to RESULT^GMRCR returns an
"^DD",123.1,123.1,1,1,1,"%D",2,0)
OE/RR status.  This OE/RR status is used to determine the action type to
"^DD",123.1,123.1,1,1,1,"%D",3,0)
use to update activity tracking.
"^DD",123.1,123.1,1,1,1,"DT")
2910529
"^DD",123.1,123.1,1,3)
This is the CPRS Status used to update the order in CPRS.
"^DD",123.1,123.1,1,21,0)
^^2^2^2970911^^^^
"^DD",123.1,123.1,1,21,1,0)
This is the CPRS status which will be used to update the order in OE/RR
"^DD",123.1,123.1,1,21,2,0)
when this action is taken.
"^DD",123.1,123.1,1,"DT")
2970911
"^DD",123.1,123.1,3,0)
DISABLED MESSAGE^F^^0;4^K:$L(X)>40!($L(X)<1) X
"^DD",123.1,123.1,3,3)
Enter the message that will display when this action is disabled, 1-40 characters.
"^DD",123.1,123.1,3,21,0)
^^2^2^2970911^^^^
"^DD",123.1,123.1,3,21,1,0)
This field displays a 'DISABLED' message when this CPRS status has been
"^DD",123.1,123.1,3,21,2,0)
disabled.
"^DD",123.1,123.1,3,"DT")
2920225
"^DD",123.1,123.1,4,0)
HL7 CONTROL CODE FROM CONSULTS^F^^0;5^K:$L(X)>2!($L(X)<1) X
"^DD",123.1,123.1,4,3)
Enter 2 character HL7 code related to the action.
"^DD",123.1,123.1,4,21,0)
^^12^12^2971112^
"^DD",123.1,123.1,4,21,1,0)
This field indicates what HL7 control code is passed to CPRS from
"^DD",123.1,123.1,4,21,2,0)
Consults.
"^DD",123.1,123.1,4,21,3,0)
    Example: 
"^DD",123.1,123.1,4,21,4,0)
             "SN"=Service entered, backdoor consult, automatically
"^DD",123.1,123.1,4,21,5,0)
released from CPRS, though signatures may still be required depending on
"^DD",123.1,123.1,4,21,6,0)
nature of order
"^DD",123.1,123.1,4,21,7,0)
             "OD"=Discontinued
"^DD",123.1,123.1,4,21,8,0)
             "OC"=Denied by service (Cancelled)
"^DD",123.1,123.1,4,21,9,0)
             "SC"=Service status update (generic status change) for active
"^DD",123.1,123.1,4,21,10,0)
and partial results
"^DD",123.1,123.1,4,21,11,0)
             "XX"=Forwarded
"^DD",123.1,123.1,4,21,12,0)
             "RE"=Completed
"^DD",123.1,123.1,4,"DT")
2971112
"^DD",123.1,123.1,5,0)
HL7 CONTROL CODE FROM CPRS^F^^0;6^K:$L(X)>2!($L(X)<1) X
"^DD",123.1,123.1,5,1,0)
^.1
"^DD",123.1,123.1,5,1,1,0)
123.1^D
"^DD",123.1,123.1,5,1,1,1)
S ^GMR(123.1,"D",$E(X,1,30),DA)=""
"^DD",123.1,123.1,5,1,1,2)
K ^GMR(123.1,"D",$E(X,1,30),DA)
"^DD",123.1,123.1,5,1,1,"%D",0)
^^2^2^2971112^
"^DD",123.1,123.1,5,1,1,"%D",1,0)
This cross-reference allows Consults to convert an order control from
"^DD",123.1,123.1,5,1,1,"%D",2,0)
HL7 Table 0119 to a Consult activity for tracking.
"^DD",123.1,123.1,5,1,1,"DT")
2971112
"^DD",123.1,123.1,5,3)
Enter the HL7 Control code passed from CPRS for this action.
"^DD",123.1,123.1,5,21,0)
^^5^5^2971112^
"^DD",123.1,123.1,5,21,1,0)
This field indicates what HL7 control code is passed from CPRS to
"^DD",123.1,123.1,5,21,2,0)
Consults.
"^DD",123.1,123.1,5,21,3,0)
    Example: "NW"=New consult entered and released through CPRS
"^DD",123.1,123.1,5,21,4,0)
             "CA"=Cancelled via the orders tab
"^DD",123.1,123.1,5,21,5,0)
             "DC"=Discontinued
"^DD",123.1,123.1,5,"DT")
2971112
"^DD",123.1,123.1,6,0)
HL7 TABLE 38 ORDER STATUS^F^^0;7^K:$L(X)>2!($L(X)<1) X
"^DD",123.1,123.1,6,3)
Enter the 1-2 character code from HL7 Table 0038
"^DD",123.1,123.1,6,21,0)
^^2^2^2971114^
"^DD",123.1,123.1,6,21,1,0)
This field is for documenting purposes and contains the related Table 38
"^DD",123.1,123.1,6,21,2,0)
order status from HL7 for each activity.
"^DD",123.1,123.1,6,"DT")
2971114
"^DD",123.1,123.1,7,0)
ACTION PRINT NAME^F^^0;8^K:$L(X)>30!($L(X)<1) X
"^DD",123.1,123.1,7,3)
Enter the text to appear before comments on the 513
"^DD",123.1,123.1,7,21,0)
^^1^1^2980624^
"^DD",123.1,123.1,7,21,1,0)
This field is used on the 513 Form as a header for comments.
"^DD",123.1,123.1,7,"DT")
2980624
"^DD",123.5,123.5,10,0)
SUB-SERVICE^123.51P^^10;0
"^DD",123.5,123.5,10,20,0)
^.3LA^^0
"^DD",123.5,123.5,10,21,0)
^.001^4^4^3010102^^^^
"^DD",123.5,123.5,10,21,1,0)
This is the set of services or specialties that may be grouped under
"^DD",123.5,123.5,10,21,2,0)
the Service/Specialty.  A member of this sub-service may also be defined
"^DD",123.5,123.5,10,21,3,0)
to have its own sub-service/specialties. There is no limit to the
"^DD",123.5,123.5,10,21,4,0)
depth of the hierarchy beneath ALL SERVICES.
"^DD",123.5,123.5,10,"DT")
2910710
"^DD",123.5,123.51,0)
SUB-SERVICE SUB-FIELD^^2^2
"^DD",123.5,123.51,0,"NM",.01)

"^DD",123.5,123.51,.01,0)
SUB-SERVICE/SPECIALTY^MP123.5'X^GMR(123.5,^0;1^S Y=X I Y=DA D EN^DDIOL("A SERVICE CAN NOT BE A SUBSERVICE OF ITSELF","","!!?12") K:Y=DA X
"^DD",123.5,123.51,.01,1,0)
^.1
"^DD",123.5,123.51,.01,1,1,0)
123.51^B
"^DD",123.5,123.51,.01,1,1,1)
S ^GMR(123.5,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",123.5,123.51,.01,1,1,2)
K ^GMR(123.5,DA(1),10,"B",$E(X,1,30),DA)
"^DD",123.5,123.51,.01,1,2,0)
123.5^APC^MUMPS
"^DD",123.5,123.51,.01,1,2,1)
S ^GMR(123.5,"APC",$E(X,1,30),DA(1),DA)=""
"^DD",123.5,123.51,.01,1,2,2)
K ^GMR(123.5,"APC",$E(X,1,30),DA(1),DA)
"^DD",123.5,123.51,.01,1,2,"%D",0)
^.101^3^3^3000615^^^
"^DD",123.5,123.51,.01,1,2,"%D",1,0)
This cross-reference is used to find the parents of a given service. This
"^DD",123.5,123.51,.01,1,2,"%D",2,0)
helps identify AC cross-references that need to be updated when the .01
"^DD",123.5,123.51,.01,1,2,"%D",3,0)
name changes, and helps manage forwarding to services.
"^DD",123.5,123.51,.01,1,2,"DT")
2971103
"^DD",123.5,123.51,.01,1,3,0)
123.51^AC^MUMPS
"^DD",123.5,123.51,.01,1,3,1)
I $L($P($G(^GMR(123.5,X,0)),U)) S ^GMR(123.5,DA(1),10,"AC",$P($G(^GMR(123.5,X,0)),U),DA)=""
"^DD",123.5,123.51,.01,1,3,2)
I $L($P($G(^GMR(123.5,X,0)),U)) K ^GMR(123.5,DA(1),10,"AC",$P($G(^GMR(123.5,X,0)),U),DA)
"^DD",123.5,123.51,.01,1,3,"%D",0)
^^2^2^2971103^^
"^DD",123.5,123.51,.01,1,3,"%D",1,0)
This cross-reference is used to build a hierarchical listing of the
"^DD",123.5,123.51,.01,1,3,"%D",2,0)
services alphabetically.
"^DD",123.5,123.51,.01,1,3,"DT")
2971103
"^DD",123.5,123.51,.01,3)
Enter the name of the Service which is to be a SUB-service of the Parent service.
"^DD",123.5,123.51,.01,21,0)
^.001^7^7^3010102^^^^
"^DD",123.5,123.51,.01,21,1,0)
This is the menu of sub-service/specialties that are grouped under this
"^DD",123.5,123.51,.01,21,2,0)
Service.  The sub-service/specialty entries must each be defined as 
"^DD",123.5,123.51,.01,21,3,0)
entries in this file.
"^DD",123.5,123.51,.01,21,4,0)
  
"^DD",123.5,123.51,.01,21,5,0)
There is no limit on how deep the hierarchy of services may be defined.
"^DD",123.5,123.51,.01,21,6,0)
The only requirement is that the "ALL SERVICES" entry be at the top of
"^DD",123.5,123.51,.01,21,7,0)
the hierarchy.
"^DD",123.5,123.51,.01,23,0)
3^.001^3^3^3010102^^^^
"^DD",123.5,123.51,.01,23,1,0)
This file is similar to the Option File and Protocol File.  The same
"^DD",123.5,123.51,.01,23,2,0)
concepts for setting up options should be used to define the Service/
"^DD",123.5,123.51,.01,23,3,0)
Specialty entries.
"^DD",123.5,123.51,.01,"DT")
3010321
"^DIC",123.1,123.1,0)
REQUEST ACTION TYPES^123.1
"^DIC",123.1,123.1,0,"GL")
^GMR(123.1,
"^DIC",123.1,123.1,"%D",0)
^^6^6^2921119^^^^
"^DIC",123.1,123.1,"%D",1,0)
This file identifies the action types which may be used by a service to 
"^DIC",123.1,123.1,"%D",2,0)
track activity related to a consult or request.
"^DIC",123.1,123.1,"%D",3,0)
  
"^DIC",123.1,123.1,"%D",4,0)
Certain action types may have a "GMRCACT " protocol entry in the Protocol
"^DIC",123.1,123.1,"%D",5,0)
File (101) which corresponds to the action type.  Two actions should not 
"^DIC",123.1,123.1,"%D",6,0)
point to the same protocol.
"^DIC",123.1,"B","REQUEST ACTION TYPES",123.1)

**END**
**END**
