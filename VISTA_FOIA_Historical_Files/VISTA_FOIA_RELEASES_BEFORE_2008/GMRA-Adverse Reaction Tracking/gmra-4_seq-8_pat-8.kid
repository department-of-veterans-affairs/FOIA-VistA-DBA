Released GMRA*4*8 SEQ #8
Extracted from mail message
**KIDS**:GMRA*4.0*8^

**INSTALL NAME**
GMRA*4.0*8
"BLD",500,0)
GMRA*4.0*8^ADVERSE REACTION TRACKING^0^^y
"BLD",500,4,0)
^9.64PA^^
"BLD",500,"ABPKG")
n
"BLD",500,"KRN",0)
^9.67PA^19^18
"BLD",500,"KRN",.4,0)
.4
"BLD",500,"KRN",.401,0)
.401
"BLD",500,"KRN",.402,0)
.402
"BLD",500,"KRN",.403,0)
.403
"BLD",500,"KRN",.5,0)
.5
"BLD",500,"KRN",.84,0)
.84
"BLD",500,"KRN",3.6,0)
3.6
"BLD",500,"KRN",3.8,0)
3.8
"BLD",500,"KRN",9.2,0)
9.2
"BLD",500,"KRN",9.8,0)
9.8
"BLD",500,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",500,"KRN",9.8,"NM",1,0)
GMRADSP4^^0^B23403847
"BLD",500,"KRN",9.8,"NM",2,0)
GMRAMCB1^^0^B9893873
"BLD",500,"KRN",9.8,"NM",3,0)
GMRAPEO0^^0^B6566562
"BLD",500,"KRN",9.8,"NM",4,0)
GMRAROBS^^0^B11106013
"BLD",500,"KRN",9.8,"NM",5,0)
GMRADSP6^^0^B14859338
"BLD",500,"KRN",9.8,"NM",6,0)
GMRACMR^^0^B10622222
"BLD",500,"KRN",9.8,"NM","B","GMRACMR",6)

"BLD",500,"KRN",9.8,"NM","B","GMRADSP4",1)

"BLD",500,"KRN",9.8,"NM","B","GMRADSP6",5)

"BLD",500,"KRN",9.8,"NM","B","GMRAMCB1",2)

"BLD",500,"KRN",9.8,"NM","B","GMRAPEO0",3)

"BLD",500,"KRN",9.8,"NM","B","GMRAROBS",4)

"BLD",500,"KRN",19,0)
19
"BLD",500,"KRN",19.1,0)
19.1
"BLD",500,"KRN",101,0)
101
"BLD",500,"KRN",409.61,0)
409.61
"BLD",500,"KRN",771,0)
771
"BLD",500,"KRN",869.2,0)
869.2
"BLD",500,"KRN",870,0)
870
"BLD",500,"KRN",8994,0)
8994
"BLD",500,"KRN","B",.4,.4)

"BLD",500,"KRN","B",.401,.401)

"BLD",500,"KRN","B",.402,.402)

"BLD",500,"KRN","B",.403,.403)

"BLD",500,"KRN","B",.5,.5)

"BLD",500,"KRN","B",.84,.84)

"BLD",500,"KRN","B",3.6,3.6)

"BLD",500,"KRN","B",3.8,3.8)

"BLD",500,"KRN","B",9.2,9.2)

"BLD",500,"KRN","B",9.8,9.8)

"BLD",500,"KRN","B",19,19)

"BLD",500,"KRN","B",19.1,19.1)

"BLD",500,"KRN","B",101,101)

"BLD",500,"KRN","B",409.61,409.61)

"BLD",500,"KRN","B",771,771)

"BLD",500,"KRN","B",869.2,869.2)

"BLD",500,"KRN","B",870,870)

"BLD",500,"KRN","B",8994,8994)

"BLD",500,"QUES",0)
^9.62^^
"BLD",500,"REQB",0)
^9.611^2^2
"BLD",500,"REQB",1,0)
GMRA*4.0*5^1
"BLD",500,"REQB",2,0)
GMRA*4.0*7^1
"BLD",500,"REQB","B","GMRA*4.0*5",1)

"BLD",500,"REQB","B","GMRA*4.0*7",2)

"OER",262,0)
262^GMRA^1^^
"OER",262,1,0)
^100.9951PA^1^1
"OER",262,1,1,0)
45
"OER",262,1,1,1,0)
^100.99511PA^1^1
"OER",262,1,1,1,1,0)
40
"PKG",262,-1)
1^1
"PKG",262,0)
ADVERSE REACTION TRACKING^GMRA^Adverse Reaction Tracking package
"PKG",262,22,0)
^9.49I^1^1
"PKG",262,22,1,0)
4.0^2960328^2960603^112
"PKG",262,22,1,"PAH",1,0)
8
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","GMRACMR")
0^6^B10622222
"RTN","GMRACMR",1,0)
GMRACMR ;HIRMFO/WAA,RM-LIST Chart/ID Band mark report ;9/29/97  08:11
"RTN","GMRACMR",2,0)
 ;;4.0;Adverse Reaction Tracking;**8**;Mar 29, 1996
"RTN","GMRACMR",3,0)
 ;;
"RTN","GMRACMR",4,0)
EN1 ;PRIMARY ENTRY POINT
"RTN","GMRACMR",5,0)
 S GMRAOUT=0
"RTN","GMRACMR",6,0)
QST K DIR S DIR(0)="LAO^1:4"
"RTN","GMRACMR",7,0)
 S DIR(0)=DIR(0)_"^I X[""."" W !,""DO NOT USE DECIMAL VALUES."",$C(7) K X Q"
"RTN","GMRACMR",8,0)
 S DIR("A",1)="     1 Current Inpatients",DIR("A",2)="     2 Outpatients over Date/Time range",DIR("A",3)="     3 New Admissions over Date/Time range",DIR("A",4)="     4 All of the above"
"RTN","GMRACMR",9,0)
 S DIR("A")="Enter the number(s) for those groups to be used in this report: (1-4):"
"RTN","GMRACMR",10,0)
 S DIR("?",1)="   ENTER THE NUMBER(S) FOR THOSE GROUPS TO BE INCLUDED IN THIS REPORT.",DIR("?")="   THIS RESPONSE MUST BE A LIST OR RANGE, E.G., 1,3 OR 2-3"
"RTN","GMRACMR",11,0)
 D ^DIR K DIR
"RTN","GMRACMR",12,0)
 I "^^"[Y S GMRAOUT=1 Q
"RTN","GMRACMR",13,0)
 S GMRAQST=""
"RTN","GMRACMR",14,0)
 S:Y["4" Y="1,2,3"
"RTN","GMRACMR",15,0)
 S GMRASEL=Y
"RTN","GMRACMR",16,0)
 S:GMRASEL["1" GMRAQST=GMRAQST_"W"
"RTN","GMRACMR",17,0)
 S:GMRASEL["2" GMRAQST=GMRAQST_"CM"
"RTN","GMRACMR",18,0)
 S:GMRASEL["3" GMRAQST=GMRAQST_"W"
"RTN","GMRACMR",19,0)
 D DATE Q:GMRAOUT
"RTN","GMRACMR",20,0)
 ;Select the ward or clinic
"RTN","GMRACMR",21,0)
 S Y=$$MDIC^GMRACMR1 I Y<1 S GMRAOUT=1
"RTN","GMRACMR",22,0)
 Q:GMRAOUT
"RTN","GMRACMR",23,0)
 Q
"RTN","GMRACMR",24,0)
DATE ;DATE SELECTION
"RTN","GMRACMR",25,0)
 ;FROM DATE
"RTN","GMRACMR",26,0)
 Q:'(GMRASEL["2"!(GMRASEL["3"))
"RTN","GMRACMR",27,0)
 W !," Enter date/time range in which patients were",!,$S(GMRASEL["3":" admitted into the hospital"_$S(GMRASEL["2":" or",1:""),1:""),$S(GMRASEL["2":" seen at an outpatient clinic",1:""),"."
"RTN","GMRACMR",28,0)
 W !!,"Enter START Date (time optional): " R X:DTIME S:'$T X="^^" I "^^"[X S GMRAOUT=1 Q
"RTN","GMRACMR",29,0)
 I X?1"?".E D  G DATE
"RTN","GMRACMR",30,0)
 .   S %DT="TEX" D HELP^%DTC
"RTN","GMRACMR",31,0)
 .   W !!?4,"ENTER THE START DATE/TIME OF RANGE TO SEE PATIENTS THAT WERE",!?3,$S(GMRASEL["3":" ADMITTED TO THE HOSPITAL"_$S(GMRASEL["2":" OR",1:""),1:""),$S(GMRASEL["2":" SEEN AT AN OUTPATIENT CLINIC",1:""),".",!
"RTN","GMRACMR",32,0)
 .   Q
"RTN","GMRACMR",33,0)
 S %DT="TEX" D ^%DT
"RTN","GMRACMR",34,0)
 I +Y'>0 G DATE
"RTN","GMRACMR",35,0)
 S GMRAST=Y K %DT,Y
"RTN","GMRACMR",36,0)
END ;
"RTN","GMRACMR",37,0)
 W !,"Enter END Date (time optional): T// " R X:DTIME S:'$T X="^^" S:X="" X="T" I "^^"[X S GMRAOUT=1 Q
"RTN","GMRACMR",38,0)
 I X?1"?".E D  G END
"RTN","GMRACMR",39,0)
 .   S %DT="TEX",%DT(0)=GMRAST D HELP^%DTC
"RTN","GMRACMR",40,0)
 .   W !!?4,"ENTER THE END DATE/TIME OF RANGE TO SEE PATIENTS THAT WERE",!?3,$S(GMRASEL["3":" ADMITTED TO THE HOSPITAL"_$S(GMRASEL["2":" OR",1:""),1:""),$S(GMRASEL["2":" SEEN AT AN OUTPATIENT CLINIC",1:""),".",!
"RTN","GMRACMR",41,0)
 .   Q
"RTN","GMRACMR",42,0)
 S %DT(0)=GMRAST,%DT="TEX" D ^%DT
"RTN","GMRACMR",43,0)
 I +Y'>0 G END
"RTN","GMRACMR",44,0)
 S GMRAED=Y_$S(Y=(Y\1):".24",1:"") K %DT,Y
"RTN","GMRACMR",45,0)
 Q
"RTN","GMRADSP4")
0^1^B23403847
"RTN","GMRADSP4",1,0)
GMRADSP4 ;HIRMFO/YMP,RM,WAA,FT-PATIENT'S ALLERGIES PRINTOUT ;7/23/97  09:44
"RTN","GMRADSP4",2,0)
 ;;4.0;Adverse Reaction Tracking;**5,7,8**;Mar 29, 1996
"RTN","GMRADSP4",3,0)
EN1 ; Entry to PRINT PATIENT REACTION DATA option
"RTN","GMRADSP4",4,0)
 W ! S DIC="^DPT(",DIC(0)="AEQM",DIC("A")="Select PATIENT: " D ^DIC K DIC,DLAYGO I +Y'>0 S GMRAOUT=1 G EXIT
"RTN","GMRADSP4",5,0)
 S DFN=+Y
"RTN","GMRADSP4",6,0)
 S GMRAEER=$$ERR(DFN)
"RTN","GMRADSP4",7,0)
 I '$D(^GMR(120.86,DFN,0)) W !!,$C(7),"NO ",$S(GMRAEER:"ACTIVE ",1:""),"ALLERGY/ADVERSE REACTION DATA EXISTS FOR THIS PATIENT",! W:GMRAEER "HOWEVER, THERE IS DATA ENTERED IN ERROR ON FILE",! G EN1:'GMRAEER
"RTN","GMRADSP4",8,0)
 I $P($G(^GMR(120.86,DFN,0)),U,2)=0 W !!,$C(7),"PATIENT HAS ANSWERED NKA",$S(GMRAEER:" BUT HAS ""ENTERED IN ERROR"" DATA ON FILE",1:"") G:'GMRAEER EN1 W !
"RTN","GMRADSP4",9,0)
 S GMRAOUT=0,GMRALINE=$$REPEAT^XLFSTR("=",32),GMRASLIN=$$REPEAT^XLFSTR("-",32)
"RTN","GMRADSP4",10,0)
 D DEM^VADPT
"RTN","GMRADSP4",11,0)
 S GMRAHEAD(1)=$J("ALLERGY/ADVERSE REACTION REPORTS",53)
"RTN","GMRADSP4",12,0)
 S GMRAHEAD(2)=$J($E(VADM(1),1,15),1)_$J(VA("PID"),21)_$J($P(VADM(3),"^",2),24)_$J($S(VADM(4):"("_VADM(4)_")",1:""),5) D KVAR^VADPT K VA S (GMRAHEAD(3),GMRAHEAD(4))="",$P(GMRAHEAD(3),"-",81)=""
"RTN","GMRADSP4",13,0)
 S GMRANOW=$$NOW^XLFDT,GMRANOW=$$FMTE^XLFDT(GMRANOW,"2P")
"RTN","GMRADSP4",14,0)
 S GMRAHEAD(1.5)=$J("Run Date/Time: "_GMRANOW,53)
"RTN","GMRADSP4",15,0)
DIR1 K DIR S DIR("A",1)="Select 1:DRUG, 2:FOOD, 3:OTHER",DIR(0)="LO^1:3",DIR("A")="Type of allergy"
"RTN","GMRADSP4",16,0)
E S DIR(0)=DIR(0)_"^I X[""."" W !,""DO NOT USE DECIMAL VALUES."",$C(7) K X Q"
"RTN","GMRADSP4",17,0)
 D ^DIR K DIR
"RTN","GMRADSP4",18,0)
 G:'$D(Y(0)) EN1 S GMRASEL1=Y(0)
"RTN","GMRADSP4",19,0)
 S GMRATTMP="" F X=1:1:3 I GMRASEL1[X S GMRATTMP=GMRATTMP_$E("DFO",X)
"RTN","GMRADSP4",20,0)
 S GMRASEL=GMRATTMP
"RTN","GMRADSP4",21,0)
 K GMRATTMP
"RTN","GMRADSP4",22,0)
 K DIR S DIR("A",1)="Select 1:ACTIVE, 2:ENTERED IN ERROR",DIR(0)="LO^1:2",DIR("A")="Which would you like to see?"
"RTN","GMRADSP4",23,0)
 S DIR(0)=DIR(0)_"^I X[""."" W !,""DO NOT USE DECIMAL VALUES."",$C(7) K X Q"
"RTN","GMRADSP4",24,0)
 D ^DIR K DIR
"RTN","GMRADSP4",25,0)
 G:Y["^"!'$D(Y(0)) EN1 S GMRASEL2=Y(0)
"RTN","GMRADSP4",26,0)
 K GMRAZIS D DEV^GMRAUTL I POP S GMRAOUT=1 G EXIT
"RTN","GMRADSP4",27,0)
 I $D(IO("Q")) D TASK G EXIT
"RTN","GMRADSP4",28,0)
BEGIN K ^TMP($J,"GMRADSP") S GMRANKA=0 F GMRARECN=0:0 S GMRARECN=$O(^GMR(120.8,"B",DFN,GMRARECN)) Q:GMRARECN'>0!GMRAOUT  D SET
"RTN","GMRADSP4",29,0)
 G PARSE
"RTN","GMRADSP4",30,0)
 Q
"RTN","GMRADSP4",31,0)
SET ; SET SORT ARRAY
"RTN","GMRADSP4",32,0)
 S GMRANKA=$P($G(^GMR(120.86,DFN,0)),U,2) I GMRANKA'=1&(GMRASEL2'[2) Q
"RTN","GMRADSP4",33,0)
 S GMRATEMP=^GMR(120.8,GMRARECN,0),GMRAKIND=$P(GMRATEMP,"^",20),GMRAEER=$S(+$G(^GMR(120.8,GMRARECN,"ER")):1,1:0)
"RTN","GMRADSP4",34,0)
 F %=1:1:$L(GMRASEL) I GMRAKIND[$E(GMRASEL,%) Q:'$P(GMRATEMP,"^",12)&'GMRAEER  S ^TMP($J,"GMRADSP",GMRAEER,GMRAKIND,$P(GMRATEMP,"^",2),GMRARECN)="" Q
"RTN","GMRADSP4",35,0)
 Q
"RTN","GMRADSP4",36,0)
PARSE ;
"RTN","GMRADSP4",37,0)
 S GMRAPG=0,GMRAFG=0,GMRACNT=0 D HDR^GMRADSP3
"RTN","GMRADSP4",38,0)
 I 'GMRANKA&(GMRASEL2'[2) W !,"   This patient has No Known Allergies." Q
"RTN","GMRADSP4",39,0)
 F GMRAZK=1:1:$L(GMRASEL2,",")-1 S GMRACTIV=$S($P(GMRASEL2,",",GMRAZK)=1:0,$P(GMRASEL2,",",GMRAZK)=2:1,1:"") S GMRASTAT=$S(GMRACTIV=0:"ACTIVE",GMRACTIV=1:"E/E",1:"") D:GMRACTIV]"" PARSE2 Q:GMRAOUT
"RTN","GMRADSP4",40,0)
 I 'GMRACNT W !!,"THERE IS NO DATA FOR THIS REPORT."
"RTN","GMRADSP4",41,0)
EXIT ;Quit and kill
"RTN","GMRADSP4",42,0)
 D CLOSE^GMRAUTL
"RTN","GMRADSP4",43,0)
 K ^TMP($J,"GMRADSP")
"RTN","GMRADSP4",44,0)
 D KILL^XUSCLEAN
"RTN","GMRADSP4",45,0)
 Q
"RTN","GMRADSP4",46,0)
PARSE2 ;
"RTN","GMRADSP4",47,0)
 S GMRATYP=""
"RTN","GMRADSP4",48,0)
 F  S GMRATYP=$O(^TMP($J,"GMRADSP",GMRACTIV,GMRATYP)) Q:GMRATYP=""  D PARSECD Q:GMRAOUT
"RTN","GMRADSP4",49,0)
 Q
"RTN","GMRADSP4",50,0)
PARSECD ;
"RTN","GMRADSP4",51,0)
 W:$D(^TMP($J,"GMRADSP",GMRACTIV,GMRATYP)) !,"STATUS: "_GMRASTAT,!,$E(GMRASLIN,1,$L(GMRASTAT)+8)
"RTN","GMRADSP4",52,0)
 S GMRARES=$$OUTTYPE^GMRAUTL(GMRATYP) W:GMRARES'=""&$D(^TMP($J,"GMRADSP",GMRACTIV,GMRATYP)) !,?2,"TYPE: ",GMRARES,!,?2,$E(GMRALINE,1,6+$L(GMRARES)),!
"RTN","GMRADSP4",53,0)
 S GMRAALL=""
"RTN","GMRADSP4",54,0)
 F GMRAZM=0:0 S GMRAALL=$O(^TMP($J,"GMRADSP",GMRACTIV,GMRATYP,GMRAALL)) Q:GMRAALL=""!GMRAOUT  D
"RTN","GMRADSP4",55,0)
 .   S GMRAREC="" F  S GMRAREC=$O(^TMP($J,"GMRADSP",GMRACTIV,GMRATYP,GMRAALL,GMRAREC)) Q:GMRAREC=""!GMRAOUT  D
"RTN","GMRADSP4",56,0)
 .   .   S GMRAPA(0)=$G(^GMR(120.8,GMRAREC,0))
"RTN","GMRADSP4",57,0)
 .   .   S GMRANS="",GMRAPA=GMRAREC,GMRAAL=GMRAALL,GMRACNT=GMRACNT+1
"RTN","GMRADSP4",58,0)
 .   .   S GMRADRUG=($O(^GMR(120.8,GMRAPA,2,0))!$O(^GMR(120.8,GMRAPA,3,0))!$P(GMRAPA(0),"^",20)["D"!$S($P(GMRAPA(0),"^",3)[";PS":1,$P(GMRAPA(0),"^",3)[120.82:$S($D(^GMRD(120.82,+$P(GMRAPA(0),"^",3),0)):$P(^(0),"^",2)["D",1:0),1:0))
"RTN","GMRADSP4",59,0)
 .   .   S GMRAOTH=$O(^GMRD(120.83,"B","OTHER REACTION",""))
"RTN","GMRADSP4",60,0)
 .   .   S GMRAPRNT=1 U:IO IO D EN1^GMRADSP2
"RTN","GMRADSP4",61,0)
 .   .   I 'GMRAOUT W !,".............................................................................." S GMRAFG=1
"RTN","GMRADSP4",62,0)
 .   .   Q
"RTN","GMRADSP4",63,0)
 .   Q
"RTN","GMRADSP4",64,0)
 Q
"RTN","GMRADSP4",65,0)
TASK ;
"RTN","GMRADSP4",66,0)
 S ZTDESC="GMRA Print Complete List of Patient's Reactions",ZTRTN="BEGIN^GMRADSP4",ZTDTH="",ZTIO=ION,ZTSAVE("GMRA*")="",ZTSAVE("DFN")="" D ^%ZTLOAD
"RTN","GMRADSP4",67,0)
 W !!,$S($D(ZTSK):"Request queued...",1:"Request NOT queued please try later...")
"RTN","GMRADSP4",68,0)
 K ZTRTN,ZTDH,ZTSAVE,ZTDTH,ZTSK
"RTN","GMRADSP4",69,0)
 Q
"RTN","GMRADSP4",70,0)
ERR(DFN) ;Checks to see if patient has entered in error data
"RTN","GMRADSP4",71,0)
 N ERR,NUM
"RTN","GMRADSP4",72,0)
 S NUM=0,ERR=0
"RTN","GMRADSP4",73,0)
 F  S NUM=$O(^GMR(120.8,"B",DFN,NUM)) Q:'+NUM  S:+$G(^GMR(120.8,NUM,"ER")) ERR=1 Q:ERR
"RTN","GMRADSP4",74,0)
 Q ERR
"RTN","GMRADSP6")
0^5^B14859338
"RTN","GMRADSP6",1,0)
GMRADSP6 ;HIRMFO/YMP,RM,WAA-LISTING OF ALLERGIES NOT ENTERED IN ERROR ;9/23/97  09:07
"RTN","GMRADSP6",2,0)
 ;;4.0;Adverse Reaction Tracking;**8**;Mar 29, 1996
"RTN","GMRADSP6",3,0)
EN1 ; Entry to ACTIVE LISTING OF PATIENT REACTIONS option
"RTN","GMRADSP6",4,0)
 S GMRAOUT=0
"RTN","GMRADSP6",5,0)
 W ! S DIC="^DPT(",DIC(0)="AEQM",DIC("A")="Select PATIENT: " D ^DIC K DIC,DLAYGO S DFN=+Y I +Y'>0 S GMRAOUT=1 G EXIT
"RTN","GMRADSP6",6,0)
EN3 ;Print Active Patient list if patient is known
"RTN","GMRADSP6",7,0)
 D DEM^VADPT S GMRAHEAD(2)=$J($E(VADM(1),1,15),1)_$J(VA("PID"),21)_$J($P(VADM(3),"^",2),24)_$J($S(VADM(4):"("_VADM(4)_")",1:""),5) D KVAR^VADPT K VA
"RTN","GMRADSP6",8,0)
 S GMRAHEAD(1)=$J("ACTIVE ALLERGY/ADVERSE REACTION LISTING",58),(GMRAHEAD(3),GMRAHEAD(6),GMRAHEAD(7))="",$P(GMRAHEAD(6),"-",81)=""
"RTN","GMRADSP6",9,0)
 S GMRAHEAD(4)=$J("OBS/",73),GMRAHEAD(5)=$J("ADVERSE REACTION",17)_$J("VERIFIED",48)_$J("HIST",8)
"RTN","GMRADSP6",10,0)
 S GMRANOW=$$NOW^XLFDT,GMRANOW=$$FMTE^XLFDT(GMRANOW,"2P")
"RTN","GMRADSP6",11,0)
 S GMRAHEAD(1.5)=$J("Run Date/Time: "_GMRANOW,55)
"RTN","GMRADSP6",12,0)
 I '$D(^GMR(120.86,"B",DFN)) W !!,$C(7),"NO ALLERGY/ADVERSE REACTION DATA EXISTS FOR THIS PATIENT" G EN1
"RTN","GMRADSP6",13,0)
 K GMRAZIS D DEV^GMRAUTL I POP S GMRAOUT=1 G EXIT
"RTN","GMRADSP6",14,0)
 I $D(IO("Q")) D TASK G EXIT
"RTN","GMRADSP6",15,0)
EN2 ; Print Active Patient list if patient and device known
"RTN","GMRADSP6",16,0)
 S (GMRAOUT,GMRAPG)=0 D HDR^GMRADSP3
"RTN","GMRADSP6",17,0)
 S GMRALIN=$$REPEAT^XLFSTR("=",32)
"RTN","GMRADSP6",18,0)
 I $P($G(^GMR(120.86,DFN,0)),U,2)'=1 W !,"   Patient has answered NKA."
"RTN","GMRADSP6",19,0)
 E  F GMRAREC=0:0 S GMRAREC=$O(^GMR(120.8,"B",DFN,GMRAREC)) Q:GMRAREC'>0  D EN2A
"RTN","GMRADSP6",20,0)
 S GMRAREAC=0 G DISP
"RTN","GMRADSP6",21,0)
 Q
"RTN","GMRADSP6",22,0)
EN2A Q:+$G(^GMR(120.8,GMRAREC,"ER"))  S GMRATEMP=$G(^GMR(120.8,GMRAREC,0)) Q:'$P(GMRATEMP,"^",12)
"RTN","GMRADSP6",23,0)
 S GMRAKIND=$P(GMRATEMP,"^",20)
"RTN","GMRADSP6",24,0)
 S ^TMP($J,"GMRADSP",GMRAKIND,$P(GMRATEMP,"^",2),GMRAREC)=""
"RTN","GMRADSP6",25,0)
 Q
"RTN","GMRADSP6",26,0)
DISP ;
"RTN","GMRADSP6",27,0)
 S GMRASPAC=53,GMRATONS=""
"RTN","GMRADSP6",28,0)
 S (GMRAALL,GMRAKIND,GMRARECN)=""
"RTN","GMRADSP6",29,0)
 I '$D(^TMP($J,"GMRADSP")) W !,?33,"No Data Found"
"RTN","GMRADSP6",30,0)
 F X=0:0 S GMRAKIND=$O(^TMP($J,"GMRADSP",GMRAKIND)) Q:GMRAKIND=""!GMRAOUT  D DISP2
"RTN","GMRADSP6",31,0)
 G EXIT
"RTN","GMRADSP6",32,0)
DISP2 D:$Y>(IOSL-4) EOP^GMRADSP3 Q:GMRAOUT
"RTN","GMRADSP6",33,0)
 S GMRATYPE=$$OUTTYPE^GMRAUTL(GMRAKIND)
"RTN","GMRADSP6",34,0)
 W !!?3,"TYPE: ",GMRATYPE,!?3,$E(GMRALIN,1,$L(GMRATYPE)+6)
"RTN","GMRADSP6",35,0)
 F X=0:0 S GMRAALL=$O(^TMP($J,"GMRADSP",GMRAKIND,GMRAALL)) Q:GMRAALL=""!(GMRAOUT)  F GMRARECN=0:0 S GMRARECN=$O(^TMP($J,"GMRADSP",GMRAKIND,GMRAALL,GMRARECN)) Q:GMRARECN'>0  D REST Q:GMRAOUT
"RTN","GMRADSP6",36,0)
 Q
"RTN","GMRADSP6",37,0)
REST ;
"RTN","GMRADSP6",38,0)
 D:$Y>(IOSL-4) EOP^GMRADSP3 Q:GMRAOUT
"RTN","GMRADSP6",39,0)
 S GMRATEMP=$G(^GMR(120.8,GMRARECN,0)) W !,GMRAALL,?60,$P("NO^YES","^",1+$P(GMRATEMP,U,16)),?70,$S($P(GMRATEMP,U,6)="h":"HIST",$P(GMRATEMP,U,6)="o":"OBS",1:"")
"RTN","GMRADSP6",40,0)
 I $D(^GMR(120.8,GMRARECN,10,0)) S GMRAFLG=0,GMRAOTH=$O(^GMRD(120.83,"B","OTHER REACTION",0)) F GMRAX=0:0 S GMRAX=$O(^GMR(120.8,GMRARECN,10,GMRAX)) Q:GMRAX'>0  D
"RTN","GMRADSP6",41,0)
 .N GMRALINE,GMRATON,GMRAZ,GMRAFG2
"RTN","GMRADSP6",42,0)
 .S GMRATON=$G(^GMR(120.8,GMRARECN,10,GMRAX,0))
"RTN","GMRADSP6",43,0)
 .S GMRAFG=$O(^GMR(120.8,GMRARECN,10,GMRAX))
"RTN","GMRADSP6",44,0)
 .I +GMRATON'=GMRAOTH S GMRALINE=$E($S($D(^GMRD(120.83,+GMRATON,0)):$P(^(0),U),1:""),1,23)
"RTN","GMRADSP6",45,0)
 .E  S GMRALINE=$P(GMRATON,U,2)
"RTN","GMRADSP6",46,0)
 .S GMRAZ=$S($P(GMRATON,U,4)'="":$$FMTE^XLFDT($P(GMRATON,U,4),1),1:"")
"RTN","GMRADSP6",47,0)
 .S:GMRAZ'="" GMRALINE=GMRALINE_" ("_GMRAZ_")"
"RTN","GMRADSP6",48,0)
 .I GMRAFG S GMRALINE=GMRALINE_", "
"RTN","GMRADSP6",49,0)
 .D WRITG
"RTN","GMRADSP6",50,0)
 .Q
"RTN","GMRADSP6",51,0)
 Q
"RTN","GMRADSP6",52,0)
WRITG ;
"RTN","GMRADSP6",53,0)
 I 'GMRAFLG W !,?5,"Reactions: " S GMRAFLG=1
"RTN","GMRADSP6",54,0)
 I $X+$L(GMRALINE)>GMRASPAC W !,?16
"RTN","GMRADSP6",55,0)
 W GMRALINE
"RTN","GMRADSP6",56,0)
 Q
"RTN","GMRADSP6",57,0)
EXIT ;Quit and kill
"RTN","GMRADSP6",58,0)
 D CLOSE^GMRAUTL
"RTN","GMRADSP6",59,0)
 K ^TMP($J,"GMRADSP"),X,Y,Z
"RTN","GMRADSP6",60,0)
 D KILL^XUSCLEAN
"RTN","GMRADSP6",61,0)
 Q
"RTN","GMRADSP6",62,0)
TASK ;
"RTN","GMRADSP6",63,0)
 S ZTDESC="This a print out of the allergies signed off for the patient",ZTRTN="EN2^GMRADSP6",ZTDTH="",ZTIO=ION,ZTSAVE("GMRA*")="",ZTSAVE("DFN")="" D ^%ZTLOAD
"RTN","GMRADSP6",64,0)
 W !!,$S($D(ZTSK):"Request queued...",1:"Request NOT queued please try later...")
"RTN","GMRADSP6",65,0)
 K ZTRTN,ZTDH,ZTSAVE,ZTDTH,ZTSK
"RTN","GMRADSP6",66,0)
 Q
"RTN","GMRAMCB1")
0^2^B9893873
"RTN","GMRAMCB1",1,0)
GMRAMCB1 ;HIRMFO/WAA-MARK CHART & ID BAND FIELD EDIT PART 2 ;7/23/97  09:39
"RTN","GMRAMCB1",2,0)
 ;;4.0;Adverse Reaction Tracking;**8**;Mar 29, 1996
"RTN","GMRAMCB1",3,0)
GETAL ; GET PATIENT AND ALLERGY
"RTN","GMRAMCB1",4,0)
 S GMRANS="",DFN=-1,DIC="^DPT(",DIC(0)="AEQM",DIC("A")="Select Patient: " D ^DIC Q:+Y'>0  K DIC,DLAYGO S DFN=+Y
"RTN","GMRAMCB1",5,0)
 L +^GMR(120.8,"B",DFN):0 I '$T W !,"THIS DATA IS CURRENTLY BEING EDITED, TRY LATER." G GETAL
"RTN","GMRAMCB1",6,0)
 D DEM^VADPT S GMRANAM=VADM(1) D INP^VADPT S:'+VAIN(4) GMRALOC="" I +VAIN(4) S GMRAHLOC=+$G(^DIC(42,+VAIN(4),44)),GMRALOC=$P(VAIN(4),U,2)
"RTN","GMRAMCB1",7,0)
 D PID^VADPT6 S GMRAVIP=VA("PID") D KVAR^VADPT K VA
"RTN","GMRAMCB1",8,0)
 D HLP12085^GMRAU851(DFN,"'+$G(^GMR(120.8,+GMRAX,""ER""))") Q:GMRAOUT
"RTN","GMRAMCB1",9,0)
 K GMRAX,GMRALL
"RTN","GMRAMCB1",10,0)
ALL1 W ! S GMRADEL=0
"RTN","GMRAMCB1",11,0)
 K DIR S DIR(0)="FAO^1:60",DIR("A")="Select "_$S('$D(GMRALL):"CAUSATIVE AGENT: ",1:"another CAUSATIVE AGENT: ")
"RTN","GMRAMCB1",12,0)
 S DIR("?",1)="    ENTER THE CAUSATIVE AGENT YOU WISH TO INDICATE HAS"
"RTN","GMRAMCB1",13,0)
 S DIR("?",2)="    HAD ITS ID BAND OR CHART MARKED.",DIR("?")="    ENTER ?? TO SEE LIST OF ALL CAUSATIVE AGENT YOU HAVE SELECTED OR CAN SELECT.",DIR("??")="^D HELP^GMRAMCB"
"RTN","GMRAMCB1",14,0)
 D ^DIR K DIR
"RTN","GMRAMCB1",15,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIROUT)) K X,Y S GMRAOUT=1 Q
"RTN","GMRAMCB1",16,0)
 Q:Y=""  S X=Y K Y I $$UP^XLFSTR(X)="ALL" D ALLSEL Q:GMRAOUT  G:'$D(X) ALL1
"RTN","GMRAMCB1",17,0)
 I X["-" S GMRADEL=1,X=$P(X,"-",2)
"RTN","GMRAMCB1",18,0)
 S GMRAX=X,X=$P($G(^DPT(DFN,0)),"^")
"RTN","GMRAMCB1",19,0)
 K DIC S DIC="^GMR(120.8,",DIC(0)="EZQ",DIC("W")="W ""   "",$P($G(^(0)),U,2)"
"RTN","GMRAMCB1",20,0)
 S DIC("S")="I $P(^(0),U)=DFN,$P($$UP^XLFSTR($P(^(0),U,2)),$$UP^XLFSTR(GMRAX))="""",$P(^(0),U,2)'="""",'+$G(^GMR(120.8,+Y,""ER""))"
"RTN","GMRAMCB1",21,0)
 D ^DIC K DIC I Y<1 G ALL1
"RTN","GMRAMCB1",22,0)
 S GMRAPA=+Y,GMRAPA(0)=$S($D(^GMR(120.8,GMRAPA,0)):^(0),1:"")
"RTN","GMRAMCB1",23,0)
 I GMRAPA(0)="" S GMRADEL=0 G ALL1
"RTN","GMRAMCB1",24,0)
 I GMRADEL D  G ALL1
"RTN","GMRAMCB1",25,0)
 .I '$D(GMRALL(GMRAPA)) W !," YOU HAVE NOT SELECTED THAT CAUSATIVE AGENT." S GMRADEL=0 Q
"RTN","GMRAMCB1",26,0)
 .K GMRALL(GMRAPA) S GMRADEL=0
"RTN","GMRAMCB1",27,0)
 .Q
"RTN","GMRAMCB1",28,0)
 I $D(GMRALL(GMRAPA)) W !," YOU HAVE ALREADY SELECTED THAT CAUSATIVE AGENT",$C(7) G ALL1
"RTN","GMRAMCB1",29,0)
 S GMRALL(GMRAPA)="" G ALL1
"RTN","GMRAMCB1",30,0)
ALLSEL ;THIS WILL ALLOW THE USER TO SELECT ALL ALLERGY
"RTN","GMRAMCB1",31,0)
 S GMRATMP=X F  S %=1 W !,"Do you want to select all the patient's CAUSATIVE AGENTS" D YN^DICN  S:%<0 %=2,GMRAOUT=1 Q:%  W !?4,"ENTER YES OR NO IF YOU WANT ALL THE PATIENT'S CAUSATIVE AGENTS"
"RTN","GMRAMCB1",32,0)
 S X=GMRATMP K GMRATMP Q:%'=1  S X=0 F  S X=$O(^GMR(120.8,"B",DFN,X)) Q:X<1  D
"RTN","GMRAMCB1",33,0)
 .Q:$D(^GMR(120.8,X,"ER"))  Q:$P(^GMR(120.8,X,0),U,2)=""
"RTN","GMRAMCB1",34,0)
 .S GMRALL(X)="" Q
"RTN","GMRAMCB1",35,0)
 K X
"RTN","GMRAMCB1",36,0)
 Q
"RTN","GMRAMCB1",37,0)
SCREEN W !,"Press <CR> to continue or ^ to stop: " R GMRANS:DTIME S:'$T GMRANS="^^" I "^^"'[GMRANS W !?4,$C(7),"ENTER <CR> TO CONTINUE LISTING OR ^ TO EXIT LISTING" G SCREEN
"RTN","GMRAMCB1",38,0)
 D FF Q
"RTN","GMRAMCB1",39,0)
FF ;
"RTN","GMRAMCB1",40,0)
 W #
"RTN","GMRAMCB1",41,0)
 Q
"RTN","GMRAPEO0")
0^3^B6566562
"RTN","GMRAPEO0",1,0)
GMRAPEO0 ;HIRMFO/WAA,RM-EDIT OBSERVED A/AR ;7/23/97  09:41
"RTN","GMRAPEO0",2,0)
 ;;4.0;Adverse Reaction Tracking;**8**;Mar 29, 1996
"RTN","GMRAPEO0",3,0)
EN1 ; Entry to edit Observed A/AR Data
"RTN","GMRAPEO0",4,0)
 ;This code allows the user to select a concomitant reaction by date.
"RTN","GMRAPEO0",5,0)
 ;If that reactant doesn't have a date, then a new date is added
"RTN","GMRAPEO0",6,0)
 ;for the reactant.
"RTN","GMRAPEO0",7,0)
 N GMRAN85
"RTN","GMRAPEO0",8,0)
 S (GMRAX,GMRAN85)=0 I $D(^GMR(120.85,"C",GMRAPA)) S X=0 F  S X=$O(^GMR(120.85,"C",GMRAPA,X)) Q:X<1  S GMRAX=X
"RTN","GMRAPEO0",9,0)
 I GMRAX K X S:$D(^GMR(120.85,GMRAX,0)) DIC("B")=$P(^GMR(120.85,GMRAX,0),U)
"RTN","GMRAPEO0",10,0)
OBS ; 
"RTN","GMRAPEO0",11,0)
 S GMRALAGO=1 D EN2^GMRAU85 I GMRAOUT D:GMRAPA1 UNLOCK^GMRAUTL(120.85,GMRAPA1) G EXIT
"RTN","GMRAPEO0",12,0)
 I $P($G(^GMR(120.85,+$O(^GMR(120.85,"C",GMRAPA,0)),0)),U)="" W !?4,$C(7),"OBSERVATION DATE IS A REQUIRED ENTRY!!" G OBS
"RTN","GMRAPEO0",13,0)
 I $G(GMRAPA1)<1 W !?4,$C(7),"OBSERVATION DATE IS A REQUIRED ENTRY!!" G OBS
"RTN","GMRAPEO0",14,0)
 D EN1^GMRAPER2(GMRAPA,"120.8",.GMRAOUT,$P(^GMR(120.85,GMRAPA1,0),U))
"RTN","GMRAPEO0",15,0)
 I 'GMRAOUT,GMRAN85,$O(^GMR(120.8,GMRAPA,10,0)) D
"RTN","GMRAPEO0",16,0)
 .N GMRAX
"RTN","GMRAPEO0",17,0)
 .S ^GMR(120.85,GMRAPA1,2,0)="^120.8502P^"_$P(^GMR(120.8,GMRAPA,10,0),U,3,4),GMRAX=0 F  S GMRAX=$O(^GMR(120.8,GMRAPA,10,GMRAX)) Q:GMRAX<1  D
"RTN","GMRAPEO0",18,0)
 ..Q:'$D(^GMR(120.8,GMRAPA,10,GMRAX,0))
"RTN","GMRAPEO0",19,0)
 ..S ^GMR(120.85,GMRAPA1,2,GMRAX,0)=$P(^GMR(120.8,GMRAPA,10,GMRAX,0),U,1,2)_"^"_DUZ
"RTN","GMRAPEO0",20,0)
 ..Q
"RTN","GMRAPEO0",21,0)
 .Q
"RTN","GMRAPEO0",22,0)
 G:GMRAOUT EXIT
"RTN","GMRAPEO0",23,0)
 I $D(^XUSEC("GMRA-ALLERGY VERIFY",DUZ)) D MECH^GMRAPED0
"RTN","GMRAPEO0",24,0)
 G EXIT:GMRAOUT
"RTN","GMRAPEO0",25,0)
 D COMM G EXIT:GMRAOUT
"RTN","GMRAPEO0",26,0)
 D ORR G EXIT:GMRAOUT
"RTN","GMRAPEO0",27,0)
EXIT ; Exit line
"RTN","GMRAPEO0",28,0)
 I $G(GMRAPA1)'<0 D UNLOCK^GMRAUTL(120.85,GMRAPA1)
"RTN","GMRAPEO0",29,0)
 K DA,DIK,DR,GMRADT,GMRAR10,GMRAPA1,GMRARAD,GMRARDL,GMRAREC,GMRADATE,GMRARODT,GMRAROT,GMRARPR,GMRAX,GMRAY,GMRAZN
"RTN","GMRAPEO0",30,0)
 Q
"RTN","GMRAPEO0",31,0)
ORR ; Observed the reserved reaction reports
"RTN","GMRAPEO0",32,0)
 Q:$G(GMRAPA1)<1
"RTN","GMRAPEO0",33,0)
 Q:$G(GMRAUSER,0)
"RTN","GMRAPEO0",34,0)
 F  S %=1 W !,"Complete the observed reaction report" D YN^DICN Q:%=1  S:%<0 %=2 Q:%=2  W:%=0 !,"ENTER YES TO EDIT REACTION DATA OR NO TO SKIP REACTION DATA",$C(7)
"RTN","GMRAPEO0",35,0)
 I %=1 D
"RTN","GMRAPEO0",36,0)
 .N %
"RTN","GMRAPEO0",37,0)
 .D EN2^GMRAROBS
"RTN","GMRAPEO0",38,0)
 .Q
"RTN","GMRAPEO0",39,0)
 E  S:%=-1 GMRAOUT=1
"RTN","GMRAPEO0",40,0)
 Q
"RTN","GMRAPEO0",41,0)
COMM ; Fill in the comments
"RTN","GMRAPEO0",42,0)
 S GMRAVCM="O" D ENDING^GMRAPEM1 Q:GMRAOUT
"RTN","GMRAPEO0",43,0)
 I $D(DTOUT) S GMRAOUT=1
"RTN","GMRAPEO0",44,0)
 I 'GMRAOUT D COMCHECK^GMRAPEH0
"RTN","GMRAPEO0",45,0)
 I 'GMRAOUT G:GMRAREQ COMM
"RTN","GMRAPEO0",46,0)
 S GMRAOUT=0
"RTN","GMRAPEO0",47,0)
 K DUOUT,DTOUT,DA,DR,DIE Q
"RTN","GMRAPEO0",48,0)
 K DA,DR,DIE
"RTN","GMRAPEO0",49,0)
 Q
"RTN","GMRAROBS")
0^4^B11106013
"RTN","GMRAROBS",1,0)
GMRAROBS ;HIRMFO/RFM,WAA-OBSERVED REACTION DATA EDIT ;7/23/97  09:42
"RTN","GMRAROBS",2,0)
 ;;4.0;Adverse Reaction Tracking;**8**;Mar 29, 1996
"RTN","GMRAROBS",3,0)
EN1 ; Entry for EDIT OBSERVED REACTION DATA option
"RTN","GMRAROBS",4,0)
 S GMRAOUT=0,GMRALAGO=1 D EN1^GMRAU85 G:GMRAPA1'>0 EXIT
"RTN","GMRAROBS",5,0)
 S GMRAPA=0 D ^GMRADSP7 D EN2
"RTN","GMRAROBS",6,0)
 D UNLOCK^GMRAUTL(120.85,GMRAPA1)
"RTN","GMRAROBS",7,0)
 D EXIT
"RTN","GMRAROBS",8,0)
 Q
"RTN","GMRAROBS",9,0)
EN2 ; ENTRY FROM ENTER/EDIT OPTION  GMRAPA1 AND GMRAPA ARE KNOWN
"RTN","GMRAROBS",10,0)
 S DIE="^GMR(120.85,",DA=GMRAPA1,DR=".01;.5//"_$P($G(^VA(200,DUZ,0)),U)_";14.5;22//"_$$DATE^GMRAUTL1($P(^GMR(120.85,DA,0),U)) D ^DIE G:$D(Y)!('$D(DA)) EXIT
"RTN","GMRAROBS",11,0)
 D:'$D(GMRASITE) SITE^GMRAUTL S GMRASITE(0)=^GMRD(120.84,+GMRASITE,0)
"RTN","GMRAROBS",12,0)
 G:$P(GMRAPA(0),U,20)'["D" EXIT
"RTN","GMRAROBS",13,0)
 G:$P(GMRASITE(0),U,7)="y" FDA
"RTN","GMRAROBS",14,0)
 F  S %=1 W !,"Complete the FDA data" D YN^DICN S:%<0 %=2 Q:%  W !,"ENTER YES TO EDIT FDA DATA ENTER NO TO SKIP FDA DATA",$C(7)
"RTN","GMRAROBS",15,0)
 I %'=1 K % G EXIT
"RTN","GMRAROBS",16,0)
FDA D EN1^GMRAPEL0 G:GMRAOUT EXIT
"RTN","GMRAROBS",17,0)
FDA1 W @IOF,!,"Indicate which FDA Report Sections to be completed:"
"RTN","GMRAROBS",18,0)
 W !,"1.  Reaction Information",!,"2.  Suspect Drug(s) Information",!,"3.  Concomitant Drugs and History",!,"4.  Initial Reporter"
"RTN","GMRAROBS",19,0)
 K DIR S DIR("A")="Choose number(s) of sections to be edited",DIR(0)="LO^1:4"
"RTN","GMRAROBS",20,0)
 S DIR(0)=DIR(0)_"^I X[""."" W !,""DO NOT USE DECIMAL VALUES."",$C(7) K X Q"
"RTN","GMRAROBS",21,0)
 S DIR("?",1)="ENTER THE NUMBER SECTION OR SECTIONS YOU WISH TO COMPLETE."
"RTN","GMRAROBS",22,0)
 S DIR("?",2)="YOU CAN ENTER:   YOU TYPE          SYSTEM WILL DO"
"RTN","GMRAROBS",23,0)
 S DIR("?",3)="   SECTION  -->    1                  SECTION 1"
"RTN","GMRAROBS",24,0)
 S DIR("?",4)="   RANGE    -->   2-4            SECTION 2 AND 3 AND 4"
"RTN","GMRAROBS",25,0)
 S DIR("?",5)="   GROUPS   -->  1,3,4           SECTION 1 AND 3 AND 4"
"RTN","GMRAROBS",26,0)
 S DIR("B")="1-4"
"RTN","GMRAROBS",27,0)
 D ^DIR K DIR G:$D(DIRUT)!(+Y'>0) EXIT
"RTN","GMRAROBS",28,0)
 K GMRAGHC F X=1:1 S GMRAX=$P(Y,",",X) Q:GMRAX']""  S GMRAGHC(GMRAX)=""
"RTN","GMRAROBS",29,0)
 F GMRAXXX=0:0 S GMRAXXX=$O(GMRAGHC(GMRAXXX)) Q:GMRAXXX'>0  D @GMRAXXX S:$D(Y) GMRAOUT=1 Q:GMRAOUT
"RTN","GMRAROBS",30,0)
EXIT ;
"RTN","GMRAROBS",31,0)
 K GMRAGHC,GMRAX,GMRAXXX,Y,X,DA,DIE,DR,GMRADT,GMRABGDT,GMRAENDT,XMB,XMY,VA
"RTN","GMRAROBS",32,0)
 Q
"RTN","GMRAROBS",33,0)
1 W @IOF D RXN^GMRAU851 Q:GMRAOUT  W ! S DA=GMRAPA1,DIE="^GMR(120.85,",DR="5T;6T;7T;9T;10T;11T;12.1T;12.2T" D ^DIE K GMRADT,GMRABGDT,GMRAENDT W !! D EN1^GMRALAB0 K GMRADT,GMRABGDT,GMRAENDT
"RTN","GMRAROBS",34,0)
 Q
"RTN","GMRAROBS",35,0)
2 W @IOF S GMRAOUT=0 K GMRADT,GMRABGDT,GMRAENDT D EN1^GMRAPHR2 K GMRADT,GMRABGDT,GMRAENDT
"RTN","GMRAROBS",36,0)
 Q
"RTN","GMRAROBS",37,0)
3 W @IOF S GMRAOUT=0 K GMRADT,GMRABGDT,GMRAENDT D EN1^GMRAPHR1 Q:GMRAOUT
"RTN","GMRAROBS",38,0)
 W ! S DA=GMRAPA1,DIE="^GMR(120.85,",DR="14" D ^DIE
"RTN","GMRAROBS",39,0)
 K GMRADT,GMRABGDT,GMRAENDT
"RTN","GMRAROBS",40,0)
 Q
"RTN","GMRAROBS",41,0)
4 N GMRAT W @IOF
"RTN","GMRAROBS",42,0)
 S GMRAT=$P($G(^VA(200,DUZ,0)),U,9)
"RTN","GMRAROBS",43,0)
 S:GMRAT'="" GMRAT=$P($G(^DIC(3.1,GMRAT,0)),U)
"RTN","GMRAROBS",44,0)
 S DIE="^GMR(120.85,",DA=GMRAPA1
"RTN","GMRAROBS",45,0)
 S DR="43//"_$P(^VA(200,DUZ,0),U)_";44;45;46;47;48;49;50;51T;52T;52.1//"_GMRAT
"RTN","GMRAROBS",46,0)
 D ^DIE
"RTN","GMRAROBS",47,0)
 Q
"RTN","GMRAROBS",48,0)
 ;
"RTN","GMRAROBS",49,0)
PTBUL ;Fire off the P&T FDA bul
"RTN","GMRAROBS",50,0)
 D NOW^%DTC
"RTN","GMRAROBS",51,0)
 ;1=PATIENT NAME
"RTN","GMRAROBS",52,0)
 ;2=PATIENT SSN
"RTN","GMRAROBS",53,0)
 ;3=REACTANT
"RTN","GMRAROBS",54,0)
 ;4=SIGNED OFF BY
"RTN","GMRAROBS",55,0)
 ;5=NOW
"RTN","GMRAROBS",56,0)
 S DFN=$P(GMRAPA(0),U) D PID^VADPT6
"RTN","GMRAROBS",57,0)
 S XMB(1)=$P(^DPT(DFN,0),U)
"RTN","GMRAROBS",58,0)
 S XMB(2)="("_VA("PID")_")" K VA
"RTN","GMRAROBS",59,0)
 S XMB(3)=$P(GMRAPA(0),U,2),XMB(4)=$P($G(^VA(200,DUZ,0)),U)
"RTN","GMRAROBS",60,0)
 S Y=$$DATE^GMRAUTL1(%) S XMB(5)=Y,XMB="GMRA P&T COMMITTEE FDA"
"RTN","GMRAROBS",61,0)
 S XMY("G.GMRA P&T COMMITTEE FDA")=""
"RTN","GMRAROBS",62,0)
 D ^XMB
"RTN","GMRAROBS",63,0)
 Q
"VER")
8.0^21.0
**END**
**END**
