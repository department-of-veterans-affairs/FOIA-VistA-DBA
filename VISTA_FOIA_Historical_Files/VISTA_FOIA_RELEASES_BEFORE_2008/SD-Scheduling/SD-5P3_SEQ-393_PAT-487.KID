Released SD*5.3*487 SEQ #393
Extracted from mail message
**KIDS**:SD*5.3*487^

**INSTALL NAME**
SD*5.3*487
"BLD",6770,0)
SD*5.3*487^SCHEDULING^0^3060809^y
"BLD",6770,1,0)
^^1^1^3050304^
"BLD",6770,1,1,0)
Correct creation of ASDCN xref.
"BLD",6770,4,0)
^9.64PA^^
"BLD",6770,"ABPKG")
n
"BLD",6770,"INIT")
ASDCN^SD53P487
"BLD",6770,"KRN",0)
^9.67PA^8989.52^19
"BLD",6770,"KRN",.4,0)
.4
"BLD",6770,"KRN",.401,0)
.401
"BLD",6770,"KRN",.402,0)
.402
"BLD",6770,"KRN",.403,0)
.403
"BLD",6770,"KRN",.5,0)
.5
"BLD",6770,"KRN",.84,0)
.84
"BLD",6770,"KRN",3.6,0)
3.6
"BLD",6770,"KRN",3.8,0)
3.8
"BLD",6770,"KRN",9.2,0)
9.2
"BLD",6770,"KRN",9.8,0)
9.8
"BLD",6770,"KRN",9.8,"NM",0)
^9.68A^9^8
"BLD",6770,"KRN",9.8,"NM",2,0)
SD53P487^^0^B2096509
"BLD",6770,"KRN",9.8,"NM",3,0)
SDAMOC^^0^B21770282
"BLD",6770,"KRN",9.8,"NM",4,0)
SDAMOC0^^0^B4630788
"BLD",6770,"KRN",9.8,"NM",5,0)
SDAMOCC^^0^B5703858
"BLD",6770,"KRN",9.8,"NM",6,0)
SDAMOCP^^0^B13982690
"BLD",6770,"KRN",9.8,"NM",7,0)
SDAMOCP1^^0^B17836724
"BLD",6770,"KRN",9.8,"NM",8,0)
SDC^^0^B24948807
"BLD",6770,"KRN",9.8,"NM",9,0)
SDCAN^^0^B837101
"BLD",6770,"KRN",9.8,"NM","B","SD53P487",2)

"BLD",6770,"KRN",9.8,"NM","B","SDAMOC",3)

"BLD",6770,"KRN",9.8,"NM","B","SDAMOC0",4)

"BLD",6770,"KRN",9.8,"NM","B","SDAMOCC",5)

"BLD",6770,"KRN",9.8,"NM","B","SDAMOCP",6)

"BLD",6770,"KRN",9.8,"NM","B","SDAMOCP1",7)

"BLD",6770,"KRN",9.8,"NM","B","SDC",8)

"BLD",6770,"KRN",9.8,"NM","B","SDCAN",9)

"BLD",6770,"KRN",19,0)
19
"BLD",6770,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",6770,"KRN",19,"NM",1,0)
SDAM CANCELLED CLINIC RPT^^0
"BLD",6770,"KRN",19,"NM",2,0)
SDOUTPUT^^3
"BLD",6770,"KRN",19,"NM","B","SDAM CANCELLED CLINIC RPT",1)

"BLD",6770,"KRN",19,"NM","B","SDOUTPUT",2)

"BLD",6770,"KRN",19.1,0)
19.1
"BLD",6770,"KRN",101,0)
101
"BLD",6770,"KRN",409.61,0)
409.61
"BLD",6770,"KRN",771,0)
771
"BLD",6770,"KRN",870,0)
870
"BLD",6770,"KRN",8989.51,0)
8989.51
"BLD",6770,"KRN",8989.52,0)
8989.52
"BLD",6770,"KRN",8994,0)
8994
"BLD",6770,"KRN","B",.4,.4)

"BLD",6770,"KRN","B",.401,.401)

"BLD",6770,"KRN","B",.402,.402)

"BLD",6770,"KRN","B",.403,.403)

"BLD",6770,"KRN","B",.5,.5)

"BLD",6770,"KRN","B",.84,.84)

"BLD",6770,"KRN","B",3.6,3.6)

"BLD",6770,"KRN","B",3.8,3.8)

"BLD",6770,"KRN","B",9.2,9.2)

"BLD",6770,"KRN","B",9.8,9.8)

"BLD",6770,"KRN","B",19,19)

"BLD",6770,"KRN","B",19.1,19.1)

"BLD",6770,"KRN","B",101,101)

"BLD",6770,"KRN","B",409.61,409.61)

"BLD",6770,"KRN","B",771,771)

"BLD",6770,"KRN","B",870,870)

"BLD",6770,"KRN","B",8989.51,8989.51)

"BLD",6770,"KRN","B",8989.52,8989.52)

"BLD",6770,"KRN","B",8994,8994)

"BLD",6770,"QUES",0)
^9.62^^
"BLD",6770,"REQB",0)
^9.611^2^2
"BLD",6770,"REQB",1,0)
SD*5.3*167^2
"BLD",6770,"REQB",2,0)
SD*5.3*478^2
"BLD",6770,"REQB","B","SD*5.3*167",1)

"BLD",6770,"REQB","B","SD*5.3*478",2)

"INIT")
ASDCN^SD53P487
"KRN",19,242,-1)
3^2
"KRN",19,242,0)
SDOUTPUT^Outputs^^M^^^^^^^^SCHEDULING
"KRN",19,242,1,0)
^19.06^2^2^3040401^^^^
"KRN",19,242,1,1,0)
This is the primary menu option which allows the user access to all
"KRN",19,242,1,2,0)
output options of the scheduling module.
"KRN",19,242,10,0)
^19.01IP^32^23
"KRN",19,242,10,31,0)
12064
"KRN",19,242,10,31,"^")
SDAM CANCELLED CLINIC RPT
"KRN",19,242,99)
60387,48219
"KRN",19,242,"U")
OUTPUTS
"KRN",19,12064,-1)
0^1
"KRN",19,12064,0)
SDAM CANCELLED CLINIC RPT^Cancelled Clinic Report^^A^^^^^^^^^^1
"KRN",19,12064,20)
D EN^SDAMOCC
"KRN",19,12064,25)

"KRN",19,12064,"U")
CANCELLED CLINIC REPORT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
487^3060809
"PKG",16,22,1,"PAH",1,1,0)
^^1^1^3060809
"PKG",16,22,1,"PAH",1,1,1,0)
Correct creation of ASDCN xref.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","SD53P487")
0^2^B2096509^n/a
"RTN","SD53P487",1,0)
SD53P487 ;;BP OIFO/RJV Fix ASDCN xref.
"RTN","SD53P487",2,0)
 ;;5.3;Scheduling;**487**;Aug 13, 1993
"RTN","SD53P487",3,0)
 ;
"RTN","SD53P487",4,0)
 ;Routine to loop thru appointments and if no xref for
"RTN","SD53P487",5,0)
 ;cancelled, create it.
"RTN","SD53P487",6,0)
 ;
"RTN","SD53P487",7,0)
 Q
"RTN","SD53P487",8,0)
CHK ;
"RTN","SD53P487",9,0)
 N STATUS,SC,SDDFN,SDAPDTE
"RTN","SD53P487",10,0)
 S SDDFN=0,STATUS="",SC=""
"RTN","SD53P487",11,0)
 F  S SDDFN=$O(^DPT(SDDFN)) Q:+SDDFN=0  D
"RTN","SD53P487",12,0)
 .S SDAPDTE=0 F  S SDAPDTE=$O(^DPT(SDDFN,"S",SDAPDTE)) Q:SDAPDTE=""  D
"RTN","SD53P487",13,0)
 ..S SC=$P(^DPT(SDDFN,"S",SDAPDTE,0),"^",1)
"RTN","SD53P487",14,0)
 ..S STATUS=$P(^DPT(SDDFN,"S",SDAPDTE,0),"^",2)
"RTN","SD53P487",15,0)
 ..I STATUS["C",'$D(^DPT("ASDCN",SC,SDAPDTE,SDDFN)) D
"RTN","SD53P487",16,0)
 ...W !,SDDFN_" - "_SDAPDTE_" - "_SC
"RTN","SD53P487",17,0)
 Q
"RTN","SD53P487",18,0)
ASDCN ;
"RTN","SD53P487",19,0)
 N STATUS,SC,SDDFN,SDAPDTE
"RTN","SD53P487",20,0)
 S SDDFN=0,STATUS="",SC=""
"RTN","SD53P487",21,0)
 F  S SDDFN=$O(^DPT(SDDFN)) Q:+SDDFN=0  D
"RTN","SD53P487",22,0)
 .S SDAPDTE=0 F  S SDAPDTE=$O(^DPT(SDDFN,"S",SDAPDTE)) Q:SDAPDTE=""  D
"RTN","SD53P487",23,0)
 ..I $P($G(^DPT(SDDFN,"S",SDAPDTE,0)),"^",1)="" Q
"RTN","SD53P487",24,0)
 ..S SC=$P(^DPT(SDDFN,"S",SDAPDTE,0),"^",1)
"RTN","SD53P487",25,0)
 ..S STATUS=$P($G(^DPT(SDDFN,"S",SDAPDTE,0)),"^",2)
"RTN","SD53P487",26,0)
 ..I STATUS["C",'$D(^DPT("ASDCN",SC,SDAPDTE,SDDFN)) D
"RTN","SD53P487",27,0)
 ...S ^DPT("ASDCN",SC,SDAPDTE,SDDFN)=$S(STATUS["P":1,1:"")
"RTN","SD53P487",28,0)
 Q
"RTN","SDAMOC")
0^3^B21770282^B21770282
"RTN","SDAMOC",1,0)
SDAMOC ;IOFIO - BAY PINES/TEH - Statistical Report for Cancelled Appointments;4/15/92
"RTN","SDAMOC",2,0)
 ;;5.3;Scheduling;**487**;Aug 13, 1993
"RTN","SDAMOC",3,0)
 ;SCK - 5/18/93 MODS FOR APP CLININCS AND STOP CODES
"RTN","SDAMOC",4,0)
STATS ;
"RTN","SDAMOC",5,0)
 K ^TMP("SDAMC"),^TMP("SDAMCD")
"RTN","SDAMOC",6,0)
 N POP,%,%ZIS,ZTSAVE
"RTN","SDAMOC",7,0)
 S SDFIN=0,SDSORT=SDSEL
"RTN","SDAMOC",8,0)
 S FMT=$$OPTION()
"RTN","SDAMOC",9,0)
 I '$$DIV^SDAMO G STATSQ
"RTN","SDAMOC",10,0)
 I SDSEL=6 S VAUTC=1 G STATS1
"RTN","SDAMOC",11,0)
 I SDSEL=5 S OPT="GETCLN" D @OPT G:SDFIN STATSQ
"RTN","SDAMOC",12,0)
STATS1 ;
"RTN","SDAMOC",13,0)
 I '$$COMPL G ^SDAMOCC
"RTN","SDAMOC",14,0)
 W !!,$$LINE^SDAMOCC("Device Selection")
"RTN","SDAMOC",15,0)
 W !!,"This output requires 132 columns.",!!
"RTN","SDAMOC",16,0)
 S %ZIS="PQM" D ^%ZIS G STATSQ:POP
"RTN","SDAMOC",17,0)
 I $D(IO("Q")) D QUE G STATSQ
"RTN","SDAMOC",18,0)
 W ! D WAIT^DICD
"RTN","SDAMOC",19,0)
 D START^SDAMOC
"RTN","SDAMOC",20,0)
STATSQ ;
"RTN","SDAMOC",21,0)
 D:'$D(ZTQUEUED) ^%ZISC
"RTN","SDAMOC",22,0)
 K SDAMDD,SDAPPT,SDASH,SDAT,SDATA,SDAT,SDCL,SDCLC,SDCLI,SDCLIN,SDCOL,SDDATE,SDDIV,SDDV,SDFLG,SDI,SDLEN,SDNXT,SDPAGE,SDPAT,SDSTAT,SDSTOP,SDTDASH
"RTN","SDAMOC",23,0)
 K ^TMP("SDAMS",$J),SDSEL,FMT,SDFIN,SDRUN,SCTOT,BLD,VAUTC,VAUTD,SDBEG,SDEND,VAUTNI,VAUTSTR,VAUTVB,SDSORT,DIC,DTOUT,DUOUT,DIROUT
"RTN","SDAMOC",24,0)
 K SDCI,SDDFN,SDASH,SDAT,SDBEG,SDCL,SDDV,SDDVNM,SDDVNM,SDEND,SDFLG,SDNXT
"RTN","SDAMOC",25,0)
 K SDPAGE,SDSTOP,SDTAB,SDTDASH,SDTOTT,SDY,Y
"RTN","SDAMOC",26,0)
 K OPT,SDFIN,SDDFN,SDNAME,X,Y
"RTN","SDAMOC",27,0)
 Q
"RTN","SDAMOC",28,0)
 ;
"RTN","SDAMOC",29,0)
START ;
"RTN","SDAMOC",30,0)
 U IO
"RTN","SDAMOC",31,0)
 K ^TMP("SDAMC",$J)
"RTN","SDAMOC",32,0)
 S SDLEN=25,SDPAGE=1,$P(SDASH,"-",IOM+1)="",$P(SDTDASH,"=",IOM+1)="",SDAMDD=$P(^DD(2.98,3,0),U,3)
"RTN","SDAMOC",33,0)
 D EN
"RTN","SDAMOC",34,0)
 I '$D(^TMP("SDAMC",$J)) D NOREP G STATSQ
"RTN","SDAMOC",35,0)
 I FMT=1 D BLD^SDAMOCP
"RTN","SDAMOC",36,0)
 I FMT'=1 D BLD^SDAMOCP1
"RTN","SDAMOC",37,0)
 D STATSQ Q
"RTN","SDAMOC",38,0)
 ;
"RTN","SDAMOC",39,0)
EN ; build ^TMP global
"RTN","SDAMOC",40,0)
 I FMT=1 D BLD1^SDAMOC
"RTN","SDAMOC",41,0)
 I FMT'=1 D BLD1^SDAMOC
"RTN","SDAMOC",42,0)
ENQ Q
"RTN","SDAMOC",43,0)
 ;
"RTN","SDAMOC",44,0)
BLD1 ;
"RTN","SDAMOC",45,0)
 I VAUTD=1 S SDDIV=0 D CLINIC
"RTN","SDAMOC",46,0)
 S SDDV=0 F  S SDDV=$O(VAUTD(SDDV)) Q:'SDDV  S SDDIV=SDDV D CLINIC
"RTN","SDAMOC",47,0)
 Q
"RTN","SDAMOC",48,0)
 ;
"RTN","SDAMOC",49,0)
CLINIC ;all clinic or specific clinic
"RTN","SDAMOC",50,0)
 ;
"RTN","SDAMOC",51,0)
 ;all divisions and all clinics selected
"RTN","SDAMOC",52,0)
 I VAUTD=1&(VAUTC=1) D
"RTN","SDAMOC",53,0)
 .S SDCLIN=0 F  S SDCLIN=$O(^SC(SDCLIN)) Q:'SDCLIN  I $$CLINIC^SDAMU(SDCLIN) S SDCLC=$G(^SC(SDCLIN,0)) D PATIENT
"RTN","SDAMOC",54,0)
 ;specific division and all clinics selected
"RTN","SDAMOC",55,0)
 I SDDIV&(VAUTC=1) D
"RTN","SDAMOC",56,0)
 .S SDCLIN=0 F  S SDCLIN=$O(^SC(SDCLIN)) Q:'SDCLIN  I $$CLINIC^SDAMU(SDCLIN) D
"RTN","SDAMOC",57,0)
 ..S SDCLC=$G(^SC(SDCLIN,0)) I SDDIV=$$DIV^SDAMU(.SDCLIN,.VAUTD,.SDNAME,.SDLEN) D PATIENT
"RTN","SDAMOC",58,0)
 ;all or specific division(s) and specific clinic(s) selected
"RTN","SDAMOC",59,0)
 I VAUTC=0 D
"RTN","SDAMOC",60,0)
 .S SDCLIN=0 F  S SDCLIN=$O(VAUTC(SDCLIN)) Q:'SDCLIN  S SDCLC=$G(^SC(+SDCLIN,0)) D:VAUTD!(SDDIV=$$DIV^SDAMU(.SDCLIN,.VAUTD,.SDNAME,.SDLEN)) PATIENT
"RTN","SDAMOC",61,0)
 Q
"RTN","SDAMOC",62,0)
 ;
"RTN","SDAMOC",63,0)
PATIENT ;loop through appointments - find status of appt.
"RTN","SDAMOC",64,0)
 ;
"RTN","SDAMOC",65,0)
 S SDDATE=SDBEG-.1 N SDCTYP
"RTN","SDAMOC",66,0)
 F SDDATE=SDDATE:0 S SDDATE=$O(^DPT("ASDCN",SDCLIN,SDDATE)) Q:'SDDATE!(SDDATE>(SDEND_".9"))  D
"RTN","SDAMOC",67,0)
 .S SDDFN=0 F  S SDDFN=$O(^DPT("ASDCN",SDCLIN,SDDATE,SDDFN)) Q:SDDFN=""  D SET
"RTN","SDAMOC",68,0)
 Q
"RTN","SDAMOC",69,0)
 ;
"RTN","SDAMOC",70,0)
SET ;Set in ^TMP("SDAMC",$J,Division,Clinic Name,Clinic)
"RTN","SDAMOC",71,0)
 ;
"RTN","SDAMOC",72,0)
 S SDDV=$$DIV^SDAMU(.SDCLIN,.VAUTD,.SDNAME,.SDLEN)
"RTN","SDAMOC",73,0)
 S SDATA=$G(^DPT(SDDFN,"S",SDDATE,0)) I 'SDATA G SETQ
"RTN","SDAMOC",74,0)
 S SDCTYP=$P(SDATA,U,2) I SDCTYP="" G SETQ
"RTN","SDAMOC",75,0)
 I SDCTYP="N"!(SDCTYP="NT")!(SDCTYP="NA")!(SDCTYP="I") G SETQ
"RTN","SDAMOC",76,0)
 S SDCTYP=$S(SDCTYP="C":1,SDCTYP="CA":2,SDCTYP="PC":3,SDCTYP="PCA":4,1:1)
"RTN","SDAMOC",77,0)
 S ^TMP("SDAMC",$J,SDDV,SDCLIN,SDCTYP)=$G(^TMP("SDAMC",$J,SDDV,SDCLIN,SDCTYP))+1
"RTN","SDAMOC",78,0)
 S ^TMP("SDAMCD",$J,SDDV,$P(SDATA,"^",2),SDCLIN,SDDATE,SDDFN)=SDATA_";"_SDDATE
"RTN","SDAMOC",79,0)
SETQ Q
"RTN","SDAMOC",80,0)
 ;
"RTN","SDAMOC",81,0)
GETCLN S SDFIN='$$CLINIC^SDAMO Q
"RTN","SDAMOC",82,0)
 ;
"RTN","SDAMOC",83,0)
GETSC S SDFIN='$$STOP Q
"RTN","SDAMOC",84,0)
 ;
"RTN","SDAMOC",85,0)
NOREP ;report if no data in TMP global
"RTN","SDAMOC",86,0)
 W !!,?29,"Cancelled Clinic Report"
"RTN","SDAMOC",87,0)
 W !,?20,"Date Range ",$$FDATE^VALM1(SDBEG)_" to "_$$FDATE^VALM1(SDEND)
"RTN","SDAMOC",88,0)
 D NOW^%DTC W !,?20,"Run Date: ",$E($$FDTTM^VALM1(%),1,14),?50,"Page: 1"
"RTN","SDAMOC",89,0)
 W !,SDASH
"RTN","SDAMOC",90,0)
 W !!?20,"No data found matching sort parameters"
"RTN","SDAMOC",91,0)
 Q
"RTN","SDAMOC",92,0)
 ;
"RTN","SDAMOC",93,0)
OPTION(CHECK) ;
"RTN","SDAMOC",94,0)
 S X="S^"
"RTN","SDAMOC",95,0)
 S X=X_"1:Summary;"
"RTN","SDAMOC",96,0)
 S X=X_"2:Detail"
"RTN","SDAMOC",97,0)
 S DIR(0)=X,DIR("A")="Select Report Format",DIR("?")="Select format for printed report",DIR("B")="Summary"
"RTN","SDAMOC",98,0)
 D ^DIR K DIR
"RTN","SDAMOC",99,0)
 Q (+Y)
"RTN","SDAMOC",100,0)
QUE ;
"RTN","SDAMOC",101,0)
 S ZTRTN="START^SDAMOC",ZTDESC="Cancelled Clinic Report"
"RTN","SDAMOC",102,0)
 F X="FMT","VAUTC(","VAUTD(","SDSORT","SDSEL","SDBEG","SDEND","VAUTD","VAUTC" S ZTSAVE(X)=""
"RTN","SDAMOC",103,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"Task #",ZTSK," Started."
"RTN","SDAMOC",104,0)
 D HOME^%ZIS K IO("Q"),ZTSK,ZTDESC,ZTQUEUED,ZTRTN
"RTN","SDAMOC",105,0)
 Q
"RTN","SDAMOC",106,0)
STOP() ;
"RTN","SDAMOC",107,0)
 W !!,$$LINE^SDAMO("Stop Code Selection")
"RTN","SDAMOC",108,0)
 S DIC="^DIC(40.7,",VAUTSTR="Stop Code",VAUTVB="VAUTC",VAUTNI=2
"RTN","SDAMOC",109,0)
 D FIRST^VAUTOMA
"RTN","SDAMOC",110,0)
 I Y<0 K VAUTC
"RTN","SDAMOC",111,0)
 Q $D(VAUTC)>0
"RTN","SDAMOC",112,0)
 ;
"RTN","SDAMOC",113,0)
COMPL() ;
"RTN","SDAMOC",114,0)
 I '$$DISP^SDAMOC0 S Y=0 G COMPLQ
"RTN","SDAMOC",115,0)
 S DIR(0)="Y",DIR("A")="Continue",DIR("?")="Enter 'Y'es or 'N'o.",DIR("B")="YES"
"RTN","SDAMOC",116,0)
 D ^DIR K DIR I $D(DTOUT) S Y=0
"RTN","SDAMOC",117,0)
COMPLQ Q (Y)
"RTN","SDAMOC0")
0^4^B4630788^B4630788
"RTN","SDAMOC0",1,0)
SDAMOC0 ;OIFO BAY PINES/TEH - AM MGT REPORTS STATISTICS BUILD GLOBAL ;5/25/93
"RTN","SDAMOC0",2,0)
 ;;5.3;Scheduling;**487**;Aug 13, 1993
"RTN","SDAMOC0",3,0)
 ;
"RTN","SDAMOC0",4,0)
STOPC ;  build global of action counts from division/stopcode in TMP
"RTN","SDAMOC0",5,0)
 S SDT=SDBEG F  S SDT=$O(^SCE("B",SDT)) Q:'SDT!(SDT>SDEND)  D
"RTN","SDAMOC0",6,0)
 . S SDOE=0 F  S SDOE=$O(^SCE("B",SDT,SDOE)) Q:'SDOE  D
"RTN","SDAMOC0",7,0)
 .. I '$D(^SCE(SDOE,0)) Q
"RTN","SDAMOC0",8,0)
 .. S SDOEO=$G(^SCE(SDOE,0))
"RTN","SDAMOC0",9,0)
 .. I '$$OKDIV(+$P($G(SDOEO),U,11))!('$$STCHK(+$P($G(SDOEO),U,3))) Q
"RTN","SDAMOC0",10,0)
 .. S SDDIV=$P($G(^DG(40.8,+$P($G(SDOEO),U,11),0)),U)
"RTN","SDAMOC0",11,0)
 .. S SDCODE=$P($G(^DIC(40.7,+$P(SDOEO,U,3),0)),U)
"RTN","SDAMOC0",12,0)
 .. I $P($G(SDOEO),U,12)>0 S ^TMP("SDAMS",$J,SDDIV,SDCODE,+$P(SDOEO,U,12))=$G(^TMP("SDAMS",$J,SDDIV,SDCODE,+$P(SDOEO,U,12)))+1
"RTN","SDAMOC0",13,0)
 K SDT,SDOE,SDOEO,SDDIV,SDCODE
"RTN","SDAMOC0",14,0)
 Q
"RTN","SDAMOC0",15,0)
 ;
"RTN","SDAMOC0",16,0)
OKDIV(SDDV) ; check for division in list of valid divisions (vautd)
"RTN","SDAMOC0",17,0)
 N Y S Y=0
"RTN","SDAMOC0",18,0)
 I VAUTD S Y=1 G OKDIVQ
"RTN","SDAMOC0",19,0)
 I $D(VAUTD(SDDV)) S Y=1
"RTN","SDAMOC0",20,0)
OKDIVQ Q (+Y)
"RTN","SDAMOC0",21,0)
 ;
"RTN","SDAMOC0",22,0)
STCHK(SDSTC) ;  check for stopcode in list of valid stopcodes (vautc)
"RTN","SDAMOC0",23,0)
 N Y S Y=0
"RTN","SDAMOC0",24,0)
 I VAUTC S Y=1 G STCHKQ
"RTN","SDAMOC0",25,0)
 I $D(VAUTC(SDSTC)) S Y=1
"RTN","SDAMOC0",26,0)
STCHKQ Q (+Y)
"RTN","SDAMOC0",27,0)
 ;
"RTN","SDAMOC0",28,0)
DISP() ; -- display selection choices
"RTN","SDAMOC0",29,0)
 N C,D,I
"RTN","SDAMOC0",30,0)
 D HOME^%ZIS W @IOF,*13
"RTN","SDAMOC0",31,0)
 W $$LINE^SDAMOCC("Report Specifications")
"RTN","SDAMOC0",32,0)
 W !!,"   Encounter Dates: ",$$FDATE^VALM1(SDBEG)," to ",$$FDATE^VALM1(SDEND)
"RTN","SDAMOC0",33,0)
 W !,"     Report Format: ","Appointment Clinics"
"RTN","SDAMOC0",34,0)
 W !!?15,"Divisions",?55,"Clinics"
"RTN","SDAMOC0",35,0)
 W !?15,"---------",?55,"----------"
"RTN","SDAMOC0",36,0)
 S (D,C)=0
"RTN","SDAMOC0",37,0)
 I VAUTD!VAUTC S D=$S(VAUTD:"All",1:$O(VAUTD(0))),C=$S(VAUTC:"All",1:$O(VAUTC(0))) W !?15,$S(D:VAUTD(D),1:D),?55,$S(C:VAUTC(C),1:C)
"RTN","SDAMOC0",38,0)
 S D=+D,C=+C
"RTN","SDAMOC0",39,0)
 F I=1:1 S:D'="" D=$O(VAUTD(D)) S:C'="" C=$O(VAUTC(C)) Q:'D&('C)  W ! W:D ?15,VAUTD(D) W:C ?55,VAUTC(C) I I>9 S I=0 D PAUSE^VALM1 I 'Y G DISPQ
"RTN","SDAMOC0",40,0)
 W !,$$LINE^SDAMOCC("")
"RTN","SDAMOC0",41,0)
 S Y=1
"RTN","SDAMOC0",42,0)
DISPQ Q Y
"RTN","SDAMOCC")
0^5^B5703858^B5703858
"RTN","SDAMOCC",1,0)
SDAMOCC ;IOFIO BAYPINES/TEH - AM Mgt Reports ; 12/1/91
"RTN","SDAMOCC",2,0)
 ;;5.3;Scheduling;**487**;Aug 13, 1993
"RTN","SDAMOCC",3,0)
 ;
"RTN","SDAMOCC",4,0)
EN ; main entry point
"RTN","SDAMOCC",5,0)
 N DIC,SDBEG,SDEND,SDSEL,VAUTD,VAUTC,SDSORT,SDAMLIST,Y,VAUTNI,VAUTSTR,VAUTVB,DIRUT
"RTN","SDAMOCC",6,0)
EN1 I '$$INIT G ENQ
"RTN","SDAMOCC",7,0)
 ;
"RTN","SDAMOCC",8,0)
ASKBDT ;
"RTN","SDAMOCC",9,0)
 W !!,$$LINE("Date Range Selection"),!
"RTN","SDAMOCC",10,0)
 S %DT="AEX",%DT("A")="Select Beginning Date: "
"RTN","SDAMOCC",11,0)
 D ^%DT S SDBEG=Y
"RTN","SDAMOCC",12,0)
 I X="^" Q
"RTN","SDAMOCC",13,0)
 I Y=-1 W !!,"Invalid Date!",! G ASKBDT
"RTN","SDAMOCC",14,0)
 K %DT,Y
"RTN","SDAMOCC",15,0)
ASKEDT ;
"RTN","SDAMOCC",16,0)
 S %DT="AEX",%DT("A")="Select Ending Date: "
"RTN","SDAMOCC",17,0)
 D ^%DT S SDEND=Y
"RTN","SDAMOCC",18,0)
 I X="^" Q
"RTN","SDAMOCC",19,0)
 I Y=-1 W !!,"Invalid Date!",! G ASKEDT
"RTN","SDAMOCC",20,0)
 I SDEND<SDBEG W !!,"Ending Date must be equal to or greater than Beginning Date." G ASKEDT
"RTN","SDAMOCC",21,0)
 K %DT,Y
"RTN","SDAMOCC",22,0)
 ;I '$$RANGE G ENQ
"RTN","SDAMOCC",23,0)
 S SDSEL=1
"RTN","SDAMOCC",24,0)
 S SDSEL=SDSEL+4 ; for backwards compatibility
"RTN","SDAMOCC",25,0)
 G STATS^SDAMOC
"RTN","SDAMOCC",26,0)
ENQ Q
"RTN","SDAMOCC",27,0)
 ;
"RTN","SDAMOCC",28,0)
INIT() ; -- init vars
"RTN","SDAMOCC",29,0)
 Q 1
"RTN","SDAMOCC",30,0)
 ;
"RTN","SDAMOCC",31,0)
RANGE() ; select date range
"RTN","SDAMOCC",32,0)
 ;  input: none
"RTN","SDAMOCC",33,0)
 ; output: SDBEG := begin date
"RTN","SDAMOCC",34,0)
 ;         SDEND := end date
"RTN","SDAMOCC",35,0)
 ; return: was selection made [ 1|yes   0|no]
"RTN","SDAMOCC",36,0)
 ;
"RTN","SDAMOCC",37,0)
 W !!,$$LINE("Date Range Selection")
"RTN","SDAMOCC",38,0)
 Q $$RANGE^SDAMQ(.SDBEG,.SDEND)
"RTN","SDAMOCC",39,0)
 ;
"RTN","SDAMOCC",40,0)
SELECT() ; -- get selection criteria
"RTN","SDAMOCC",41,0)
 ;  input: none
"RTN","SDAMOCC",42,0)
 ; output: SDSEL := criteria selected
"RTN","SDAMOCC",43,0)
 ; return: was selection made [ 1|yes   0|no]
"RTN","SDAMOCC",44,0)
 ;
"RTN","SDAMOCC",45,0)
 W !!,$$LINE("Statisitcs Criteria")
"RTN","SDAMOCC",46,0)
 S X="S^"
"RTN","SDAMOCC",47,0)
 S X=X_"1:Statistics;"
"RTN","SDAMOCC",48,0)
 S X=X_"2:Division(s) Only Statistics"
"RTN","SDAMOCC",49,0)
 S DIR(0)=X,DIR("A")="Which Visits",DIR("B")="Statistics"
"RTN","SDAMOCC",50,0)
 D ^DIR K DIR S SDSEL=$S($D(DIRUT):0,1:+Y)
"RTN","SDAMOCC",51,0)
 Q SDSEL>0
"RTN","SDAMOCC",52,0)
 ;
"RTN","SDAMOCC",53,0)
DIV() ; -- get division data
"RTN","SDAMOCC",54,0)
 ;  input: none
"RTN","SDAMOCC",55,0)
 ; output: VAUTD := divs selected (VAUTD=1 for all)
"RTN","SDAMOCC",56,0)
 ; return: was selection made [ 1|yes   0|no]
"RTN","SDAMOCC",57,0)
 ;
"RTN","SDAMOCC",58,0)
 W:$P($G(^DG(43,1,"GL")),U,2) !!,$$LINE("Division Selection")
"RTN","SDAMOCC",59,0)
 D ASK2^SDDIV I Y<0 K VAUTD
"RTN","SDAMOCC",60,0)
 Q $D(VAUTD)>0
"RTN","SDAMOCC",61,0)
 ;
"RTN","SDAMOCC",62,0)
CLINIC() ; -- get clinic data
"RTN","SDAMOCC",63,0)
 ;  input: VAUTD  := divisions selected
"RTN","SDAMOCC",64,0)
 ; output: VAUTC := clinic selected (VAUTC=1 for all)
"RTN","SDAMOCC",65,0)
 ; return: was selection made [ 1|yes   0|no]
"RTN","SDAMOCC",66,0)
 ;
"RTN","SDAMOCC",67,0)
 W !!,$$LINE("Clinic Selection")
"RTN","SDAMOCC",68,0)
 D CLINIC^SDAMO0
"RTN","SDAMOCC",69,0)
 I Y<0 K VAUTC
"RTN","SDAMOCC",70,0)
CLINICQ Q $D(VAUTC)>0
"RTN","SDAMOCC",71,0)
 ;
"RTN","SDAMOCC",72,0)
STOP() ; -- get stop code data
"RTN","SDAMOCC",73,0)
 ; output: VAUTC := stop codes selected (VAUTC=1 for all)
"RTN","SDAMOCC",74,0)
 ; return: was selection made [ 1|yes   0|no]
"RTN","SDAMOCC",75,0)
 ;
"RTN","SDAMOCC",76,0)
 W !!,$$LINE("Stop Codes Selection")
"RTN","SDAMOCC",77,0)
 S DIC="^DIC(40.7,",VAUTSTR="stop code",VAUTVB="VAUTC",VAUTNI=2
"RTN","SDAMOCC",78,0)
 D FIRST^VAUTOMA
"RTN","SDAMOCC",79,0)
 I Y<0 K VAUTC
"RTN","SDAMOCC",80,0)
STOPQ Q $D(VAUTC)>0
"RTN","SDAMOCC",81,0)
 ;
"RTN","SDAMOCC",82,0)
 ;
"RTN","SDAMOCC",83,0)
LINE(STR) ; -- print line
"RTN","SDAMOCC",84,0)
 ;  input: STR := text to insert
"RTN","SDAMOCC",85,0)
 ; output: none
"RTN","SDAMOCC",86,0)
 ; return: text to use
"RTN","SDAMOCC",87,0)
 ;
"RTN","SDAMOCC",88,0)
 N X
"RTN","SDAMOCC",89,0)
 S:STR]"" STR=" "_STR_" "
"RTN","SDAMOCC",90,0)
 S $P(X,"_",(IOM/2)-($L(STR)/2))=""
"RTN","SDAMOCC",91,0)
 Q X_STR_X
"RTN","SDAMOCC",92,0)
 ;
"RTN","SDAMOCP")
0^6^B13982690^B13982690
"RTN","SDAMOCP",1,0)
SDAMOCP ;IOFO BAY PINES/TEH - Print for Cancelled Statistics;4/15/92
"RTN","SDAMOCP",2,0)
 ;;5.3;Scheduling;**487**;Aug 13, 1993
"RTN","SDAMOCP",3,0)
 ;
"RTN","SDAMOCP",4,0)
HDR ;Report Header
"RTN","SDAMOCP",5,0)
 ;
"RTN","SDAMOCP",6,0)
 N SDSTOP,%
"RTN","SDAMOCP",7,0)
 I SDPAGE>1,$E(IOST,1,2)="C-" D PAUSE^VALM1 I 'Y S SDSTOP=1 Q
"RTN","SDAMOCP",8,0)
HDR1 W @IOF
"RTN","SDAMOCP",9,0)
 W !,?50,"Cancelled Clinic Report - Summary"
"RTN","SDAMOCP",10,0)
 W !,?50,"Date Range: ",$$FDATE^VALM1(SDBEG)_" to "_$$FDATE^VALM1(SDEND)
"RTN","SDAMOCP",11,0)
 D NOW^%DTC
"RTN","SDAMOCP",12,0)
 W !,?54,"Run Date: ",$E($$FDTTM^VALM1(%),1,14)
"RTN","SDAMOCP",13,0)
 W !,?62,"Page: ",SDPAGE S SDPAGE=SDPAGE+1
"RTN","SDAMOCP",14,0)
 W !!,"Division"
"RTN","SDAMOCP",15,0)
 W ?34,"Can'd by Clinic",?52,"Can'd by Clinic RB",?73,"Can'd by Patient",?92,"Can'd by Patient RB",?114,"Total"
"RTN","SDAMOCP",16,0)
 W !,SDASH
"RTN","SDAMOCP",17,0)
 Q
"RTN","SDAMOCP",18,0)
 ;
"RTN","SDAMOCP",19,0)
BLD ;Build output from ^TMP global
"RTN","SDAMOCP",20,0)
 ;
"RTN","SDAMOCP",21,0)
 N SDCTYP,SDTOTS,SDTOTN,SDCI,SDCL,SDDV,SDDVNM,SDFLG,SDNXT,SDTAB
"RTN","SDAMOCP",22,0)
 N SDTOTT,SDY
"RTN","SDAMOCP",23,0)
 S (SDSTOP,SDTOT,SDTOTT,SDFLG)=0,SDDV="" F  S SDDV=$O(^TMP("SDAMC",$J,SDDV)) Q:SDDV=""!(SDSTOP)  D CHK D
"RTN","SDAMOCP",24,0)
 .S SDDVNM=$P($G(^DG(40.8,SDDV,0)),U) W !,SDDVNM
"RTN","SDAMOCP",25,0)
 .S SDCL="" F  S SDCL=$O(^TMP("SDAMC",$J,SDDV,SDCL)) Q:SDCL=""  D
"RTN","SDAMOCP",26,0)
 ..K SDTOT,SDTOTS W !,?12,$P($G(^SC(SDCL,0)),U) S SDTOT=0,SDTOT(SDCL)=0 F SDTOTN=1:1:4 S SDTOTS(SDTOTN)=0
"RTN","SDAMOCP",27,0)
 ..S SDCTYP="" F  S SDCTYP=$O(^TMP("SDAMC",$J,SDDV,SDCL,SDCTYP)) Q:SDCTYP=""  D
"RTN","SDAMOCP",28,0)
 ...S SDTOT=$G(^TMP("SDAMC",$J,SDDV,SDCL,SDCTYP)),SDTOTT=SDTOTT+SDTOT,SDTOTS(SDCTYP)=SDTOT,SDTOT(SDCL)=SDTOT(SDCL)+SDTOT
"RTN","SDAMOCP",29,0)
 ..F SDTOTN=1:1:4 S SDTAB=$S(SDTOTN=1:41,SDTOTN=2:58,SDTOTN=3:79,SDTOTN=4:98,1:0) W ?SDTAB,$J(SDTOTS(SDTOTN),3)
"RTN","SDAMOCP",30,0)
 ..W ?116,$J(SDTOT(SDCL),3)
"RTN","SDAMOCP",31,0)
 W !,?114,"-----",!,?90,"Total Cancellations:",?116,$J(SDTOTT,3)
"RTN","SDAMOCP",32,0)
 W !!,"End of Report!"
"RTN","SDAMOCP",33,0)
BLDQ Q
"RTN","SDAMOCP",34,0)
 ;
"RTN","SDAMOCP",35,0)
MCTOT ;
"RTN","SDAMOCP",36,0)
 N SDAT
"RTN","SDAMOCP",37,0)
 S SDFLG=1,SDDV="" D HDR F  S SDDV=$O(^TMP("SDAMS",$J,SDDV)) Q:SDDV=""  D  Q:SDSTOP
"RTN","SDAMOCP",38,0)
 .W !,$P($G(^DG(40.8,SDDV,0)),U)
"RTN","SDAMOCP",39,0)
 .K SDTOT,SDCNT D TOTAL
"RTN","SDAMOCP",40,0)
 .W ?124,$J(SDTOT,8)
"RTN","SDAMOCP",41,0)
 .D CHK Q:SDSTOP
"RTN","SDAMOCP",42,0)
 .S SDNXT=$O(^TMP("SDAMS",$J,SDDV)) W:SDNXT'="" !,SDASH
"RTN","SDAMOCP",43,0)
 .K SDTOT,SDCNT
"RTN","SDAMOCP",44,0)
 W !,SDTDASH,!,"TOTAL" F SDI=1:1:11 S SDCNT(SDI)=+$G(SDAT("SDAMS",$J,SDI)),SDTOT=$G(SDTOT)+$G(SDCNT(SDI))
"RTN","SDAMOCP",45,0)
 D CNT
"RTN","SDAMOCP",46,0)
 W ?124,$J(SDTOT,8) K SDTOT,SDCNT D CHK I SDSTOP G MCTOTQ
"RTN","SDAMOCP",47,0)
 W !! D LEGEND
"RTN","SDAMOCP",48,0)
MCTOTQ Q
"RTN","SDAMOCP",49,0)
CNT ;Place no-show/no-show auto rebook & cancel/cancel auto-rebook together
"RTN","SDAMOCP",50,0)
 S SDCNT(4)=+$G(SDCNT(4))+(+$G(SDCNT(6))),SDCNT(13)=+$G(SDCI(+SDCL,4))+(+$G(SDCI(+SDCL,6)))
"RTN","SDAMOCP",51,0)
 S SDCNT(5)=+$G(SDCNT(5))+(+$G(SDCNT(7))),SDCNT(14)=+$G(SDCI(+SDCL,5))+(+$G(SDCI(+SDCL,7)))
"RTN","SDAMOCP",52,0)
 F SDI=1,2,3,4,13,6,5,14,7,8 D
"RTN","SDAMOCP",53,0)
 .W ?$$COL(SDI),$J($S($D(SDCNT(SDI)):SDCNT(SDI),1:0),$$LEN(SDI))
"RTN","SDAMOCP",54,0)
 Q
"RTN","SDAMOCP",55,0)
 ;
"RTN","SDAMOCP",56,0)
CHK ;Check to pause on screen
"RTN","SDAMOCP",57,0)
 I $E(IOST,1,2)="C-",($Y+8)>IOSL D PAUSE^VALM1
"RTN","SDAMOCP",58,0)
 S SDY=FMT D:SDY HDR1 I 'SDY S SDSTOP=1 Q
"RTN","SDAMOCP",59,0)
 I ($Y+8)>IOSL D HDR1
"RTN","SDAMOCP",60,0)
 Q
"RTN","SDAMOCP",61,0)
TOTAL ;Totals
"RTN","SDAMOCP",62,0)
 F SDI=1:1:11 S SDCNT(SDI)=+$G(SDCL("SDAMS",$J,SDDV,SDI)),SDTOT=$G(SDTOT)+$G(SDCNT(SDI))
"RTN","SDAMOCP",63,0)
 D CNT
"RTN","SDAMOCP",64,0)
 K SDCNT
"RTN","SDAMOCP",65,0)
 Q
"RTN","SDAMOCP",66,0)
 ;
"RTN","SDAMOCP",67,0)
LEGEND ;Legend on bottom of output
"RTN","SDAMOCP",68,0)
 ;
"RTN","SDAMOCP",69,0)
 W !,?5,"o CI=Checked In ; RB=Rebooked"
"RTN","SDAMOCP",70,0)
 W !,?5,"o 'Cancelled' appointments only reflect appointments cancelled using 'Cancel Clinic Availability'."
"RTN","SDAMOCP",71,0)
 W !,?5,"o 'Checked-In' does not include no-shows or cancelled appointments that have been checked in."
"RTN","SDAMOCP",72,0)
 Q
"RTN","SDAMOCP",73,0)
 ;
"RTN","SDAMOCP",74,0)
COL(SDI) ;Column placement of appt. status
"RTN","SDAMOCP",75,0)
 ;
"RTN","SDAMOCP",76,0)
 ;input - SDI (appt. type)
"RTN","SDAMOCP",77,0)
 ;output - column placement
"RTN","SDAMOCP",78,0)
 Q $S(SDI=1:34,SDI=2:48,SDI=3:63,SDI=4:81,SDI=5:97,SDI=6:92,SDI=7:108,SDI=8:114,SDI=13:87,SDI=14:103)
"RTN","SDAMOCP",79,0)
 ;
"RTN","SDAMOCP",80,0)
LEN(SDI) ;Length of column
"RTN","SDAMOCP",81,0)
 ;
"RTN","SDAMOCP",82,0)
 ;input - SDI (appt. type)
"RTN","SDAMOCP",83,0)
 ;output - length of column
"RTN","SDAMOCP",84,0)
 Q $S(SDI=1:10,SDI=2:11,SDI=3:15,SDI=4:5,SDI=6:4,SDI=5:5,SDI=7:4,SDI=8:9,SDI=13:4,SDI=14:4)
"RTN","SDAMOCP",85,0)
 ;
"RTN","SDAMOCP1")
0^7^B17836724^B17836724
"RTN","SDAMOCP1",1,0)
SDAMOCP1 ;IOFO BAY PINES/TEH - Detail Print for Cancelled Statistics;4/15/92
"RTN","SDAMOCP1",2,0)
 ;;5.3;Scheduling;**487**;Aug 13, 1993
"RTN","SDAMOCP1",3,0)
 ;
"RTN","SDAMOCP1",4,0)
HDR ;Report Header
"RTN","SDAMOCP1",5,0)
 ;
"RTN","SDAMOCP1",6,0)
 N SDSTOP
"RTN","SDAMOCP1",7,0)
 I SDPAGE>1,$E(IOST,1,2)="C-" D PAUSE^VALM1 I 'Y S SDSTOP=1 Q
"RTN","SDAMOCP1",8,0)
HDR1 W @IOF
"RTN","SDAMOCP1",9,0)
 W !,?50,"Cancelled Clinic Report - Detail"
"RTN","SDAMOCP1",10,0)
 W !,?50,"Date Range: ",$$FDATE^VALM1(SDBEG)_" to "_$$FDATE^VALM1(SDEND)
"RTN","SDAMOCP1",11,0)
 D NOW^%DTC
"RTN","SDAMOCP1",12,0)
 W !,?54,"Run Date: ",$E($$FDTTM^VALM1(%),1,14)
"RTN","SDAMOCP1",13,0)
 W !,?62,"Page: ",SDPAGE S SDPAGE=SDPAGE+1
"RTN","SDAMOCP1",14,0)
 W !,"Division"
"RTN","SDAMOCP1",15,0)
 W !,SDASH,!
"RTN","SDAMOCP1",16,0)
 W "Status",?8,"Patient",?30,"SSN",?39,"Appt Date",?61,"Clinic",?81,"Cancel Date",?106,"User",!
"RTN","SDAMOCP1",17,0)
 W SDASH
"RTN","SDAMOCP1",18,0)
 Q
"RTN","SDAMOCP1",19,0)
 ;
"RTN","SDAMOCP1",20,0)
BLD ;Build output from ^TMP global
"RTN","SDAMOCP1",21,0)
 ;
"RTN","SDAMOCP1",22,0)
 N SDTOT,SDTOTT,SDCL,SDDATE,SDUSER,SDCDT
"RTN","SDAMOCP1",23,0)
 D HDR
"RTN","SDAMOCP1",24,0)
 I IOST["P-" K DIRUT
"RTN","SDAMOCP1",25,0)
 S (SDSTOP,SDTOTT,SDFLG)=0,SDDV="" F  S SDDV=$O(^TMP("SDAMCD",$J,SDDV)) Q:SDDV=""!(SDSTOP)  D CHK D
"RTN","SDAMOCP1",26,0)
 .S SDDVNM=$P($G(^DG(40.8,SDDV,0)),U) W !,SDDVNM
"RTN","SDAMOCP1",27,0)
 .S SDCR="" F  S SDCR=$O(^TMP("SDAMCD",$J,SDDV,SDCR)) Q:SDCR=""!($D(DIRUT))  S SDTOT(SDCR)=0 D  W !!,"SUBTOTAL:",$J(SDTOT(SDCR),4),!
"RTN","SDAMOCP1",28,0)
 ..S SDCL="" F  S SDCL=$O(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL)) Q:SDCL=""!($D(DIRUT))  D 
"RTN","SDAMOCP1",29,0)
 ...S SDDATE="" F  S SDDATE=$O(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL,SDDATE)) Q:SDDATE=""!($D(DIRUT))  D
"RTN","SDAMOCP1",30,0)
 ....S SDDFN="" F  S SDDFN=$O(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL,SDDATE,SDDFN)) Q:SDDFN=""!($D(DIRUT))  D
"RTN","SDAMOCP1",31,0)
 .....S SDDATA=$G(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL,SDDATE,SDDFN))
"RTN","SDAMOCP1",32,0)
 .....S Y=$P(SDDATA,";",2) D DD^%DT S SDAPDT=Y
"RTN","SDAMOCP1",33,0)
 .....D GETS^DIQ(2,SDDFN_",",".01;.09",,"SDRES","SDMES") S SDNM=$E($G(SDRES(2,SDDFN_",",.01)),1,20),SDSSN=$E($G(SDRES(2,SDDFN_",",.09)),6,9)
"RTN","SDAMOCP1",34,0)
 .....S Y=$P(SDDATA,U,14) D DD^%DT S SDCDT=Y S SDUSER=$P(SDDATA,U,12)
"RTN","SDAMOCP1",35,0)
 .....S SDUSERNM=$$GET1^DIQ(200,SDUSER_",",.01,,"SDRES","SDMES")
"RTN","SDAMOCP1",36,0)
 .....S SDCLNM=$$GET1^DIQ(44,SDCL_",",.01,,"SDRES","SDMES")
"RTN","SDAMOCP1",37,0)
 .....W !,SDCR,?8,$E(SDNM,1,22),?30,SDSSN,?39,SDAPDT,?61,$E(SDCLNM,1,18),?81,SDCDT,?106,$E(SDUSERNM,1,26)
"RTN","SDAMOCP1",38,0)
 .....D CHK I $D(DIRUT) Q 
"RTN","SDAMOCP1",39,0)
 .....S SDTOT(SDCR)=$G(SDTOT(SDCR))+1,SDTOTT=SDTOTT+1
"RTN","SDAMOCP1",40,0)
 W !!,"TOTAL CANCELLATIONS:",$J(SDTOTT,14)
"RTN","SDAMOCP1",41,0)
 W !!,"End of Report!"
"RTN","SDAMOCP1",42,0)
 K SDUSERNM,SDSSN,SDAPDT,SDCLNM,SDRES,SDNM,SDCR,SDDDATE,SDDFN,SDDATA,SDDVNM,SDCLNM
"RTN","SDAMOCP1",43,0)
 I IOST["P-" S DIRUT=1
"RTN","SDAMOCP1",44,0)
BLDQ Q
"RTN","SDAMOCP1",45,0)
 ;
"RTN","SDAMOCP1",46,0)
MCTOT ;
"RTN","SDAMOCP1",47,0)
 N SDFLG,SDDV,SDNXT
"RTN","SDAMOCP1",48,0)
 S SDFLG=1,SDDV="" D HDR F  S SDDV=$O(^TMP("SDAMS",$J,SDDV)) Q:SDDV=""  D  Q:SDSTOP
"RTN","SDAMOCP1",49,0)
 .W !,$P($G(^DG(40.8,SDDV,0)),U)
"RTN","SDAMOCP1",50,0)
 .K SDTOT,SDCNT D TOTAL
"RTN","SDAMOCP1",51,0)
 .W ?124,$J(SDTOT,8)
"RTN","SDAMOCP1",52,0)
 .D CHK Q:SDSTOP
"RTN","SDAMOCP1",53,0)
 .S SDNXT=$O(^TMP("SDAMS",$J,SDDV)) W:SDNXT'="" !,SDASH
"RTN","SDAMOCP1",54,0)
 .K SDTOT,SDCNT
"RTN","SDAMOCP1",55,0)
 W !,SDTDASH,!,"TOTAL" F SDI=1:1:11 S SDCNT(SDI)=+$G(SDAT("SDAMS",$J,SDI)),SDTOT=$G(SDTOT)+$G(SDCNT(SDI))
"RTN","SDAMOCP1",56,0)
 D CNT
"RTN","SDAMOCP1",57,0)
 W ?124,$J(SDTOT,8) K SDTOT,SDCNT D CHK I SDSTOP G MCTOTQ
"RTN","SDAMOCP1",58,0)
 W !! D LEGEND
"RTN","SDAMOCP1",59,0)
MCTOTQ Q
"RTN","SDAMOCP1",60,0)
CNT ;Place no-show/no-show auto rebook & cancel/cancel auto-rebook together
"RTN","SDAMOCP1",61,0)
 S SDCNT(4)=+$G(SDCNT(4))+(+$G(SDCNT(6))),SDCNT(13)=+$G(SDCI(+SDCL,4))+(+$G(SDCI(+SDCL,6)))
"RTN","SDAMOCP1",62,0)
 S SDCNT(5)=+$G(SDCNT(5))+(+$G(SDCNT(7))),SDCNT(14)=+$G(SDCI(+SDCL,5))+(+$G(SDCI(+SDCL,7)))
"RTN","SDAMOCP1",63,0)
 F SDI=1,2,3,4,13,6,5,14,7,8 D
"RTN","SDAMOCP1",64,0)
 .W ?$$COL(SDI),$J($S($D(SDCNT(SDI)):SDCNT(SDI),1:0),$$LEN(SDI))
"RTN","SDAMOCP1",65,0)
 Q
"RTN","SDAMOCP1",66,0)
 ;
"RTN","SDAMOCP1",67,0)
CHK ;Check to pause on screen
"RTN","SDAMOCP1",68,0)
 N SDY
"RTN","SDAMOCP1",69,0)
 I $E(IOST,1,2)="C-",($Y+8)>IOSL D PAUSE^VALM1 S SDY=Y D:SDY HDR1 I 'SDY S SDSTOP=1 Q
"RTN","SDAMOCP1",70,0)
 I ($Y+8)>IOSL D HDR1
"RTN","SDAMOCP1",71,0)
 Q
"RTN","SDAMOCP1",72,0)
TOTAL ;Totals
"RTN","SDAMOCP1",73,0)
 F SDI=1:1:11 S SDCNT(SDI)=+$G(SDCL("SDAMS",$J,SDDV,SDI)),SDTOT=$G(SDTOT)+$G(SDCNT(SDI))
"RTN","SDAMOCP1",74,0)
 D CNT
"RTN","SDAMOCP1",75,0)
 K SDCNT
"RTN","SDAMOCP1",76,0)
 Q
"RTN","SDAMOCP1",77,0)
 ;
"RTN","SDAMOCP1",78,0)
LEGEND ;Legend on bottom of output
"RTN","SDAMOCP1",79,0)
 ;
"RTN","SDAMOCP1",80,0)
 W !,?5,"o CI=Checked In ; RB=Rebooked"
"RTN","SDAMOCP1",81,0)
 W !,?5,"o 'Cancelled' appointments only reflect appointments cancelled using 'Cancel Clinic Availability'."
"RTN","SDAMOCP1",82,0)
 W !,?5,"o 'Checked-In' does not include no-shows or cancelled appointments that have been checked in."
"RTN","SDAMOCP1",83,0)
 Q
"RTN","SDAMOCP1",84,0)
 ;
"RTN","SDAMOCP1",85,0)
COL(SDI) ;Column placement of appt. status
"RTN","SDAMOCP1",86,0)
 ;
"RTN","SDAMOCP1",87,0)
 ;input - SDI (appt. type)
"RTN","SDAMOCP1",88,0)
 ;output - column placement
"RTN","SDAMOCP1",89,0)
 Q $S(SDI=1:34,SDI=2:48,SDI=3:63,SDI=4:81,SDI=5:97,SDI=6:92,SDI=7:108,SDI=8:114,SDI=13:87,SDI=14:103)
"RTN","SDAMOCP1",90,0)
 ;
"RTN","SDAMOCP1",91,0)
LEN(SDI) ;Length of column
"RTN","SDAMOCP1",92,0)
 ;
"RTN","SDAMOCP1",93,0)
 ;input - SDI (appt. type)
"RTN","SDAMOCP1",94,0)
 ;output - length of column
"RTN","SDAMOCP1",95,0)
 Q $S(SDI=1:10,SDI=2:11,SDI=3:15,SDI=4:5,SDI=6:4,SDI=5:5,SDI=7:4,SDI=8:9,SDI=13:4,SDI=14:4)
"RTN","SDAMOCP1",96,0)
 ;
"RTN","SDC")
0^8^B24948807^B24772235
"RTN","SDC",1,0)
SDC ;MAN/GRR,ALB/LDB - CANCEL A CLINIC'S AVAILABILITY ; 3/2/05 2:11pm
"RTN","SDC",2,0)
 ;;5.3;Scheduling;**15,32,79,132,167,478,487**;Aug 13, 1993
"RTN","SDC",3,0)
 N SDATA,SDCNHDL ; for evt dvr
"RTN","SDC",4,0)
SDC1 K SDLT,SDCP S NOAP="" D LO^DGUTL
"RTN","SDC",5,0)
 S DIC=44,DIC(0)="MEQA",DIC("S")="I $P(^(0),""^"",3)=""C"",'$G(^(""OOS""))",DIC("A")="Select CLINIC NAME: " D ^DIC K DIC("S"),DIC("A") G:'$D(^SC(+Y,"SL")) END^SDC0
"RTN","SDC",6,0)
 S SC=+Y,SL=^("SL"),%DT="AEXF",%DT("A")="CANCEL '"_$P(Y,U,2)_"' FOR WHAT DATE: " D ^%DT K %DT G:Y<0 END^SDC0 ;NAKED REFERNCE - ^SC(IFN,"SL")
"RTN","SDC",7,0)
 S (SD,CDATE)=Y,%=$P(SL,U,6),SI=$S(%="":4,%<3:4,%:%,1:4),%=$P(SL,U,3),STARTDAY=$S($L(%):%,1:8) D NOW^%DTC S SDTIME=%
"RTN","SDC",8,0)
 K SDRE,SDIN,SDRE1 I $D(^SC(SC,"I")) S SDIN=+^("I"),SDRE=+$P(^("I"),"^",2),Y=SDRE D:Y DTS^SDUTL S SDRE1=$S(SDRE:" to "_Y,1:"")
"RTN","SDC",9,0)
 I $S('$D(SDIN):0,SDIN'>0!(SDIN>SD):0,SDRE'>SD&(SDRE):0,1:1) W !,*7,"Clinic is inactive ",$S('SDRE:"as of ",1:"from ") S Y=SDIN D DTS^SDUTL W Y,SDRE1 G SDC1
"RTN","SDC",10,0)
 I '$D(^SC(SC,"ST",SD,1)) S DH="" D B S ^SC(SC,"ST",SD,1)=$P("SU^MO^TU^WE^TH^FR^SA",U,DOW+1)_" "_$E(SD,6,7)_$J("",SI+SI-6)_DH,^(0)=SD G N
"RTN","SDC",11,0)
 I ^(1)["CANCELLED" W !,"APPOINTMENTS HAVE ALREADY BEEN CANCELLED",!,*7 S ANS="N",SDTIME="*",SDV1=$S($P(^SC(SC,0),"^",15):$P(^(0),"^",15),1:+$O(^DG(40.8,0))) K SDX G ASKL^SDC0 ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDC",12,0)
N I '$F(^SC(SC,"ST",SD,1),"[") K:^(1)?2U.E ^SC(SC,"ST",SD) W !,*7,"CLINIC DOES NOT MEET ON THAT DAY" G SDC1 ; KILLs node if not holiday
"RTN","SDC",13,0)
 I $O(^SC(SC,"S",SD))\1-SD W *7,!?5,"NO APPOINTMENTS SCHEDULED" S NOAP=1 G W
"RTN","SDC",14,0)
 W !,"FIRST, I'LL LIST THE EXISTING APPOINTMENTS",!
"RTN","SDC",15,0)
 K DUOUT,DTOUT D ^SDC1 I $D(DUOUT)!$D(DTOUT) D END^SDC0 Q
"RTN","SDC",16,0)
 I ^SC(SC,"ST",SD,1)["X" G ^SDC2
"RTN","SDC",17,0)
W S DH=0,%="" W !,"WANT TO CANCEL THE WHOLE DAY" D YN^DICN I '% W !,"REPLY YES (Y) OR NO (N)" G W
"RTN","SDC",18,0)
 I %=1 G WP:$$COED^SDC4(SC,SD,SD+.2359,1),ALL
"RTN","SDC",19,0)
 Q:%<1
"RTN","SDC",20,0)
WP S %="" W !,"WANT TO CANCEL PART OF THE DAY" D YN^DICN I '% W !,"REPLY YES (Y) OR NO (N)" G WP
"RTN","SDC",21,0)
 Q:(%-1)
"RTN","SDC",22,0)
F R !,"STARTING TIME: ",X:DTIME Q:U[X  D TC^SDC2 G F:Y<0 S FR=Y,ST=%
"RTN","SDC",23,0)
T R !,"ENDING TIME: ",X:DTIME Q:U[X  D TC^SDC2 G T:Y<0 S SDHTO=X,TO=Y I TO'>FR W !,"Ending time must be greater than starting time",*7 G T
"RTN","SDC",24,0)
 I $$COED^SDC4(SC,FR,TO,1) K FR,SDHTO,TO,ST W ! G F
"RTN","SDC",25,0)
ROPT R !,"Reason for cancellation:  ",I:DTIME I I?1"?".E W !,"YOU MAY ENTER A MESSAGE CONCERNING THE CANCELLATION HERE" G ROPT
"RTN","SDC",26,0)
 N CANREM S CANREM=I
"RTN","SDC",27,0)
 Q:I["^"  I '$D(^SC(SC,"SDCAN",0)) S ^SC(SC,"SDCAN",0)="^44.05D^"_FR_"^1" G SKIP
"RTN","SDC",28,0)
 S A=^SC(SC,"SDCAN",0),SDCNT=$P(A,"^",4),^SC(SC,"SDCAN",0)=$P(A,"^",1,2)_"^"_FR_"^"_(SDCNT+1)
"RTN","SDC",29,0)
SKIP S ^SC(SC,"SDCAN",FR,0)=FR_"^"_SDHTO
"RTN","SDC",30,0)
 S NOAP=$S($O(^SC(SC,"S",(FR-.0001)))'>0:1,$O(^SC(SC,"S",(FR-.0001)))>TO:1,1:0) I 'NOAP S NOAP=$S($O(^SC(SC,"S",+$O(^SC(SC,"S",(FR-.0001))),0))="MES":1,1:0)
"RTN","SDC",31,0)
 S ^SC(SC,"S",FR,0)=FR,^("MES")="CANCELLED UNTIL "_X_$S(I?.P:"",1:" ("_I_")") D S S I=^(1),I=I_$J("",%-$L(I)),Y=""
"RTN","SDC",32,0)
 F X=0:2:% S DH=$E(I,X+SI+SI),P=$S(X<ST:DH_$E(I,X+1+SI+SI),X=%:$S(Y="[":Y,1:DH)_$E(I,X+1+SI+SI),1:$S(Y="["&(X=ST):"]",1:"X")_"X"),Y=$S(DH="]":"",DH="[":DH,1:Y),I=$E(I,1,X-1+SI+SI)_P_$E(I,X+2+SI+SI,999)
"RTN","SDC",33,0)
 S:'$F(I,"[") I5=$F(I,"X"),I=$E(I,1,(I5-2))_"["_$E(I,I5,999) K I5
"RTN","SDC",34,0)
 S DH=0,^(1)=I,FR=FR-.0001 G C ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDC",35,0)
S S ^("CAN")=^SC(SC,"ST",SD,1) Q
"RTN","SDC",36,0)
 ;
"RTN","SDC",37,0)
ALL N CANREM
"RTN","SDC",38,0)
 W !,"Reason for cancellation: " R CANREM:DTIME I $L(CANREM)>160!($L(CANREM)<3) W !,*7,"Reason must be between 3 to 160 characters long",! G ALL
"RTN","SDC",39,0)
 D S S ^(1)="   "_$E(SD,6,7)_"    **CANCELLED**",FR=SD,TO=SD+.9 ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDC",40,0)
C S FR=$O(^SC(SC,"S",FR)) I FR<1!(FR'<TO) W !!,"CANCELLED!  " K SDX G CHKEND^SDC0
"RTN","SDC",41,0)
 N TDH,TMPD,DIE,DR
"RTN","SDC",42,0)
 F I=0:0 S I=$O(^SC(SC,"S",FR,1,I)) Q:I'>0  D
"RTN","SDC",43,0)
 .S DFN=+^SC(SC,"S",FR,1,I,0),SDCNHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDC",44,0)
 .D BEFORE^SDAMEVT(.SDATA,DFN,FR,SC,I,SDCNHDL)
"RTN","SDC",45,0)
 .S $P(^SC(SC,"S",FR,1,I,0),"^",9)="C"
"RTN","SDC",46,0)
 .S ^DPT("ASDCN",SC,FR,DFN)=""
"RTN","SDC",47,0)
 .S SDSC=SC,SDTTM=FR,SDPL=I,TDH=DH,TMPD=CANREM D CANCEL^SDCNSLT S DH=TDH ;SD/478
"RTN","SDC",48,0)
 .I $D(^DPT(DFN,"S",FR,0)),$P(^(0),"^",2)'["C" S $P(^(0),"^",2)="C",$P(^(0),"^",12)=DUZ,$P(^(0),"^",14)=SDTIME,DH=DH+1,TDH=DH,DIE="^DPT(DFN,"_"""S"""_",",DR="17///^S X=CANREM",DA=FR D ^DIE S DH=TDH D MORE
"RTN","SDC",49,0)
 G C
"RTN","SDC",50,0)
 ;
"RTN","SDC",51,0)
B S X=SD D DOW^SDM0 S DOW=Y,SS=+$O(^SC(SC,"T"_Y,X)) I $D(^(SS,1)),^(1)]"" S DH=^(1),DO=X+1,DA(1)=SC
"RTN","SDC",52,0)
 Q
"RTN","SDC",53,0)
MORE I $D(^SC("ARAD",SC,FR,DFN)) S ^(DFN)="N"
"RTN","SDC",54,0)
 S SDIV=$S($P(^SC(SC,0),"^",15)]"":$P(^(0),"^",15),1:" 1"),SDV1=$S(SDIV:SDIV,1:+$O(^DG(40.8,0))) I $D(^DPT("ASDPSD","C",SDIV,SC,FR,DFN)) K ^(DFN)
"RTN","SDC",55,0)
 S SDH=DH,SDTTM=FR,SDSC=SC,SDPL=I,SDRT="D" D RT^SDUTL
"RTN","SDC",56,0)
 S DH=SDH K SDH D CK1,EVT
"RTN","SDC",57,0)
 K SD1,SDIV,SDPL,SDRT,SDSC,SDTTM,SDX Q
"RTN","SDC",58,0)
CK1 S SDX=0 F SD1=FR\1:0 S SD1=$O(^DPT(DFN,"S",SD1)) Q:'SD1!((SD1\1)'=(FR\1))  I $P(^(SD1,0),"^",2)'["C",$P(^(0),"^",2)'["N" S SDX=1 Q
"RTN","SDC",59,0)
 Q:SDX  F SD1=2,4 I $D(^SC("AAS",SD1,FR\1,DFN)) S SDX=1 Q
"RTN","SDC",60,0)
 Q:SDX  IF $D(^SCE(+$$EXAE^SDOE(DFN,FR\1,FR\1),0)) S SDX=1
"RTN","SDC",61,0)
 Q:SDX  K ^DPT("ASDPSD","B",SDIV,FR\1,DFN) Q
"RTN","SDC",62,0)
 ;
"RTN","SDC",63,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDC",64,0)
 ; -- cancel event
"RTN","SDC",65,0)
 N FR,I,SDTIME,DH,SC
"RTN","SDC",66,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SDTTM,SDSC,SDPL,0,SDCNHDL) K SDATA,SDCNHDL
"RTN","SDC",67,0)
 Q
"RTN","SDCAN")
0^9^B837101^B837101
"RTN","SDCAN",1,0)
SDCAN ;ALB/LDB - CREATE INDIVIDUALLY CANCELLED APPT. NODES ;25-NOV-88@14:00
"RTN","SDCAN",2,0)
 ;;5.3;Scheduling;**487**;Aug 13, 1993
"RTN","SDCAN",3,0)
 K Q8 F Q7=0:0 S Q7=$O(^SC($P(^DPT(DA(1),"S",DA,0),"^"),"S",DA,1,Q7)) Q:Q7'>0  I $P(^(Q7,0),"^")=DA(1),$P(^(0),"^",9)["C" S Q8="" Q
"RTN","SDCAN",4,0)
 I '$D(Q8) S ^DPT("ASDCN",$P(^DPT(DA(1),"S",DA,0),"^"),DA,DA(1))=$S($P(^DPT(DA(1),"S",DA,0),"^",2)["P":1,1:"")
"RTN","SDCAN",5,0)
 K Q7,Q8 Q
"VER")
8.0^22.0
"BLD",6770,6)
^393
**END**
**END**
