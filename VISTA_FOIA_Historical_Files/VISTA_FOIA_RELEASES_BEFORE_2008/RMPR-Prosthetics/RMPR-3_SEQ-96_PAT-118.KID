Released RMPR*3*118 SEQ #96
Extracted from mail message
**KIDS**:RMPR*3.0*118^

**INSTALL NAME**
RMPR*3.0*118
"BLD",5865,0)
RMPR*3.0*118^PROSTHETICS^0^3060418^y
"BLD",5865,1,0)
^^9^9^3051128^^
"BLD",5865,1,1,0)
1. When using the option 'RMPR WH DISPLAY' and the DELIVER TO field is 
"BLD",5865,1,2,0)
   'other' print "Deliver To Attention" on 2nd line.
"BLD",5865,1,3,0)
 
"BLD",5865,1,4,0)
2. When using the option  RECONCILE/CLOSE OUT PURCHASE C  RMPR4 CLOSE 
"BLD",5865,1,5,0)
   OUT     [Reconcile/Close Out Purchase Card Transaction] Shipment Date 
"BLD",5865,1,6,0)
   will occur for date query for each item on the Purchase Card.
"BLD",5865,1,7,0)
 
"BLD",5865,1,8,0)
3. Prosthetics location prompt is case sensitive when using option [UP  
"BLD",5865,1,9,0)
   Reconcile Item Balance].
"BLD",5865,4,0)
^9.64PA^^
"BLD",5865,6.3)
4
"BLD",5865,"ABPKG")
n
"BLD",5865,"KRN",0)
^9.67PA^8989.52^19
"BLD",5865,"KRN",.4,0)
.4
"BLD",5865,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",5865,"KRN",.4,"NM",1,0)
RMPR WH DISPLAY    FILE #664^664^0
"BLD",5865,"KRN",.4,"NM","B","RMPR WH DISPLAY    FILE #664",1)

"BLD",5865,"KRN",.401,0)
.401
"BLD",5865,"KRN",.402,0)
.402
"BLD",5865,"KRN",.403,0)
.403
"BLD",5865,"KRN",.5,0)
.5
"BLD",5865,"KRN",.84,0)
.84
"BLD",5865,"KRN",3.6,0)
3.6
"BLD",5865,"KRN",3.8,0)
3.8
"BLD",5865,"KRN",9.2,0)
9.2
"BLD",5865,"KRN",9.8,0)
9.8
"BLD",5865,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5865,"KRN",9.8,"NM",1,0)
RMPR4E21^^0^60190666
"BLD",5865,"KRN",9.8,"NM",2,0)
RMPR4E23^^0^4674920
"BLD",5865,"KRN",9.8,"NM",3,0)
RMPRPIY7^^0^54160791
"BLD",5865,"KRN",9.8,"NM","B","RMPR4E21",1)

"BLD",5865,"KRN",9.8,"NM","B","RMPR4E23",2)

"BLD",5865,"KRN",9.8,"NM","B","RMPRPIY7",3)

"BLD",5865,"KRN",19,0)
19
"BLD",5865,"KRN",19.1,0)
19.1
"BLD",5865,"KRN",101,0)
101
"BLD",5865,"KRN",409.61,0)
409.61
"BLD",5865,"KRN",771,0)
771
"BLD",5865,"KRN",870,0)
870
"BLD",5865,"KRN",8989.51,0)
8989.51
"BLD",5865,"KRN",8989.52,0)
8989.52
"BLD",5865,"KRN",8994,0)
8994
"BLD",5865,"KRN","B",.4,.4)

"BLD",5865,"KRN","B",.401,.401)

"BLD",5865,"KRN","B",.402,.402)

"BLD",5865,"KRN","B",.403,.403)

"BLD",5865,"KRN","B",.5,.5)

"BLD",5865,"KRN","B",.84,.84)

"BLD",5865,"KRN","B",3.6,3.6)

"BLD",5865,"KRN","B",3.8,3.8)

"BLD",5865,"KRN","B",9.2,9.2)

"BLD",5865,"KRN","B",9.8,9.8)

"BLD",5865,"KRN","B",19,19)

"BLD",5865,"KRN","B",19.1,19.1)

"BLD",5865,"KRN","B",101,101)

"BLD",5865,"KRN","B",409.61,409.61)

"BLD",5865,"KRN","B",771,771)

"BLD",5865,"KRN","B",870,870)

"BLD",5865,"KRN","B",8989.51,8989.51)

"BLD",5865,"KRN","B",8989.52,8989.52)

"BLD",5865,"KRN","B",8994,8994)

"BLD",5865,"QUES",0)
^9.62^^
"BLD",5865,"REQB",0)
^9.611^2^2
"BLD",5865,"REQB",1,0)
RMPR*3.0*61^2
"BLD",5865,"REQB",2,0)
RMPR*3.0*114^2
"BLD",5865,"REQB","B","RMPR*3.0*114",2)

"BLD",5865,"REQB","B","RMPR*3.0*61",1)

"KRN",.4,2463,-1)
0^1
"KRN",.4,2463,0)
RMPR WH DISPLAY^3051128.1308^@^664^^@^3060202
"KRN",.4,2463,"DXS",1,9.2)
S DIP(2)=$S($D(^RMPR(664,D0,3)):^(3),1:"") S X="Deliver To Attention: ",DIP(1)=$G(X) S X=$P(DIP(2),U,4)'="",DIP(3)=$G(X) S X=$P(DIP(2),U,4),DIP(4)=$G(X) S X=1
"KRN",.4,2463,"F",1)
S DIP(1)=$S($D(^RMPR(664,D0,3)):^(3),1:"") S X="Deliver To: "_$P(DIP(1),U,1) W X K DIP;S1;X;Z;""Deliver To: "_DELIVER TO"~
"KRN",.4,2463,"F",2)
S DIP(1)=$S($D(^RMPR(664,D0,4)):^(4),1:"") S X="     IFCAP Order: "_$P($G(^PRC(442,+$P(DIP(1),U,6),0)),U) W X K DIP;X;Z;""     IFCAP Order: "_IFCAP ORDER"~
"KRN",.4,2463,"F",3)
X DXS(1,9.2) S DIP(5)=$G(X) S X="N/A",X=$S(DIP(3):DIP(4),DIP(5):X) S Y=X,X=DIP(1),X=X_Y W X K DIP;S1;X;Z;""Deliver To Attention: "_$S(DELIVER TO ATTENTION'="":DELIVER TO ATTENTION,1:"N/A")"~
"KRN",.4,2463,"F",4)
S DIP(1)=$S($D(^RMPR(664,D0,0)):^(0),1:"") S X="Vendor: "_$P($G(^PRC(440,+$P(DIP(1),U,4),0)),U) W X K DIP;S1;X;Z;""Vendor: "_VENDOR"~
"KRN",.4,2463,"F",5)
S DIP(1)=$S($D(^RMPR(664,D0,0)):^(0),1:"") S X="Initiator: "_$P($G(^VA(200,+$P(DIP(1),U,9),0)),U) W X K DIP;S1;X;Z;""Initiator: "_INITI"~
"KRN",.4,2463,"F",6)
S DIP(1)=$S($D(^RMPR(664,D0,0)):^(0),1:"") S X="Station Name: "_$P($G(^DIC(4,+$P(DIP(1),U,14),0)),U) W X K DIP;S1;X;Z;""Station Name: "_STATION NAME"~
"KRN",.4,2463,"F",7)
2,S DIP(1)=$S($D(^RMPR(664,D0,1,D1,0)):^(0),1:"") S X="Item: "_$$EXTERNAL^DIDU(664.02,.01,"",$P(DIP(1),U,1)) W X K DIP;S1;X;Z;""Item: "_BILLING IT"~
"KRN",.4,2463,"F",8)
2,S DIP(1)=$S($D(^RMPR(664,D0,1,D1,0)):^(0),1:"") S X="Brief Description: "_$P(DIP(1),U,2) W X K DIP;S1;X;Z;""Brief Description: "_BRIEF DES"~
"KRN",.4,2463,"F",9)
2,S DIP(1)=$S($D(^RMPR(664,D0,1,D1,0)):^(0),1:"") S X="Unit Cost: "_$P(DIP(1),U,3) W X K DIP;S1;X;Z;""Unit Cost: "_UNIT COST"~
"KRN",.4,2463,"F",10)
2,S DIP(1)=$S($D(^RMPR(664,D0,1,D1,0)):^(0),1:"") S X="     Qty: "_$P(DIP(1),U,4) W X K DIP;X;Z;""     Qty: "_QTY"~
"KRN",.4,2463,"F",11)
2,S DIP(1)=$S($D(^RMPR(664,D0,1,D1,0)):^(0),1:"") S X="     Unit of Issue: "_$P($G(^PRCD(420.5,+$P(DIP(1),U,5),0)),U) W X K DIP;X;Z;""     Unit of Issue: "_UNIT OF"~
"KRN",.4,2463,"F",12)
2,14,.01;S1;X;m;w~
"KRN",.4,2463,"H")
Prosthetics Display
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
118^3060418
"PKG",101,22,1,"PAH",1,1,0)
^^9^9^3060418
"PKG",101,22,1,"PAH",1,1,1,0)
1. When using the option 'RMPR WH DISPLAY' and the DELIVER TO field is 
"PKG",101,22,1,"PAH",1,1,2,0)
   'other' print "Deliver To Attention" on 2nd line.
"PKG",101,22,1,"PAH",1,1,3,0)
 
"PKG",101,22,1,"PAH",1,1,4,0)
2. When using the option  RECONCILE/CLOSE OUT PURCHASE C  RMPR4 CLOSE 
"PKG",101,22,1,"PAH",1,1,5,0)
   OUT     [Reconcile/Close Out Purchase Card Transaction] Shipment Date 
"PKG",101,22,1,"PAH",1,1,6,0)
   will occur for date query for each item on the Purchase Card.
"PKG",101,22,1,"PAH",1,1,7,0)
 
"PKG",101,22,1,"PAH",1,1,8,0)
3. Prosthetics location prompt is case sensitive when using option [UP  
"PKG",101,22,1,"PAH",1,1,9,0)
   Reconcile Item Balance].
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RMPR4E21")
0^1^B60190666^B59934185
"RTN","RMPR4E21",1,0)
RMPR4E21 ;PHX/HNC - CLOSE OUT PURCHASE CARD TRANSACTION ;3/1/1996
"RTN","RMPR4E21",2,0)
 ;;3.0;PROSTHETICS;**3,12,26,28,30,34,41,45,62,111,78,114,118**;Feb 09, 1996
"RTN","RMPR4E21",3,0)
 ;TH  Patch #78 - 08/04/03 - Add shipment date. Call routine ^RMPR4E23
"RTN","RMPR4E21",4,0)
 ;RVD patch #62 - PCE processing and link to suspense
"RTN","RMPR4E21",5,0)
 ;
"RTN","RMPR4E21",6,0)
 ;I '$D(^PRC(440.5,"H",DUZ)) W !!,"You are not an authorized Purchase Card User, CONTACT FISCAL!" Q
"RTN","RMPR4E21",7,0)
START I '$D(RMPR) D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPR4E21",8,0)
CL K ^TMP($J,"RMPRPCE")
"RTN","RMPR4E21",9,0)
 K DIC S DIC="664",DIC(0)="AEQM",DIC("W")="D EN2^RMPR4D1",DIC("A")="Select PATIENT: "
"RTN","RMPR4E21",10,0)
 S DIC("S")="I $D(^(4)) I ('$P(^(0),U,8)&'$P(^(0),U,5)),($P(^(0),U,14)=RMPR(""STA""))"
"RTN","RMPR4E21",11,0)
 W !!,"You may also make a selection by Purchase Card Transaction"
"RTN","RMPR4E21",12,0)
 W !,"(Example, PO number), or Bank Authorization Number (6 digit number).",!
"RTN","RMPR4E21",13,0)
 D ^DIC S (DA,RMPRA)=+Y I Y=-1 G EXIT
"RTN","RMPR4E21",14,0)
 K DIC G:$P(^RMPR(664,RMPRA,0),U,8) M4 G:$P(^(0),U,5) M6
"RTN","RMPR4E21",15,0)
 L +^RMPR(664,RMPRA,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPR4E21",16,0)
 ;get amis grouper number RGRP1
"RTN","RMPR4E21",17,0)
 S RGRP=0,RGRP1=""
"RTN","RMPR4E21",18,0)
 S RGRP=$O(^RMPR(664,RMPRA,1,RGRP)) G:'RGRP BRK S RGRPP=$P($G(^RMPR(664,RMPRA,1,RGRP,0)),U,13) I 'RGRPP W !!,$C(7),"ERROR** This transaction was not posted to 2319, please contact your IRM..",!! S DIR(0)="E" D ^DIR G EXIT
"RTN","RMPR4E21",19,0)
 S RGRP1=$P($G(^RMPR(660,RGRPP,"AMS")),U,1)
"RTN","RMPR4E21",20,0)
 S (RMPRDFN,DFN)=$P(^RMPR(664,RMPRA,0),U,2),RMPRWO=$P(^(0),U,15),RMPRDA=$P(^(0),U,17)
"RTN","RMPR4E21",21,0)
 D DEM^VADPT S RMPRSSNE=VA("PID"),RMPRSSN=+VADM(2),RMPRNAM=VADM(1) K VADM
"RTN","RMPR4E21",22,0)
 ;set original value before close-out
"RTN","RMPR4E21",23,0)
 K ^TMP("RM",$J),RM(RMPRA),RHCED S RMPRF=2
"RTN","RMPR4E21",24,0)
 K %X,%Y S %X="^RMPR(664,RMPRA,",%Y="^TMP("_"""RM"""_",$J,RMPRA," D %XY^%RCR
"RTN","RMPR4E21",25,0)
 S RM(RMPRA,0)=$G(^RMPR(664,RMPRA,0)),RM(RMPRA,2)=$G(^(2)),RM(RMPRA,4)=$G(^(4))
"RTN","RMPR4E21",26,0)
 S RMPER=$P(RM(RMPRA,2),U,6),RMBAN=$P(RM(RMPRA,4),U,2),RMSHI=$P(RM(RMPRA,0),U,11),RMSHIEN=$P(RM(RMPRA,0),U,12)
"RTN","RMPR4E21",27,0)
 ;added by #62
"RTN","RMPR4E21",28,0)
 ;collect all items and previous linkage to suspense.
"RTN","RMPR4E21",29,0)
 I $G(RMSHIEN) S:'$D(^RMPR(660,RMSHIEN,10)) RM60LINK(RMSHIEN)=""
"RTN","RMPR4E21",30,0)
 D COL^RMPRPCEL
"RTN","RMPR4E21",31,0)
 ;
"RTN","RMPR4E21",32,0)
L ;**** ask for final posting *****************************************
"RTN","RMPR4E21",33,0)
 D ^RMPR4LI N DIR K RFLG
"RTN","RMPR4E21",34,0)
 S DIR("A")="Ready to Reconcile and Close-Out Transaction",DIR("B")="NO",DIR(0)="Y"
"RTN","RMPR4E21",35,0)
 S DIR("?")="You may now Close-out and Post this Transaction. Please answer Yes or No."
"RTN","RMPR4E21",36,0)
 D ^DIR I Y["^"!($D(DTOUT)) W !,"Transaction NOT Closed-Out!" S:$D(^TMP("RM",$J)) RFLG=1 G:$D(RFLG) POST1 G KTMP
"RTN","RMPR4E21",37,0)
 I Y=1 G POST1
"RTN","RMPR4E21",38,0)
 ;***add/edit transaction**********************************************
"RTN","RMPR4E21",39,0)
L1 K DIR S DIR(0)="FO",DIR("A")="Select ITEM"
"RTN","RMPR4E21",40,0)
 S DIR("?")="^S RFL=1 D ZDSP^RMPR421A"
"RTN","RMPR4E21",41,0)
 D ^DIR G:(Y="^")!(Y="") DS G:$D(DTOUT) L
"RTN","RMPR4E21",42,0)
 G:$D(DIRUT)&($D(^RMPR(664,RMPRA,1))) L
"RTN","RMPR4E21",43,0)
 S DIC=661,DIC(0)="ENMZ" D ^DIC I +Y'>0 W !,"** No Item selected.." G DS
"RTN","RMPR4E21",44,0)
 G:$D(DTOUT)!$D(DUOUT) L
"RTN","RMPR4E21",45,0)
 D PROC G L1
"RTN","RMPR4E21",46,0)
 ;***process items*******************************************************
"RTN","RMPR4E21",47,0)
PROC N NEW S HY=+Y I $D(^RMPR(664,RMPRA,1,"B",+Y)) S DA=$O(^RMPR(664,RMPRA,1,"B",+Y,0)) G CHK
"RTN","RMPR4E21",48,0)
FILE S Y=HY,NUM=$P(^RMPR(664,RMPRA,1,0),U,4)+1,$P(^(0),U,4)=NUM,$P(^(0),U,3)=$P(^(0),U,3)+1,^RMPR(664,RMPRA,1,NUM,0)=+Y,DA=NUM,^RMPR(664,RMPRA,1,"B",+Y,NUM)="" S NEW=1
"RTN","RMPR4E21",49,0)
ENT K DR,DQ S DA(1)=RMPRA,DIE="^RMPR(664,"_RMPRA_",1,"
"RTN","RMPR4E21",50,0)
 ;S DR=$S($D(NEW):"",1:".01;")
"RTN","RMPR4E21",51,0)
 I '$D(NEW),($P(^RMPR(664,RMPRA,1,DA,0),U,7)="") S $P(^(0),U,7)=$P(^(0),U,3)
"RTN","RMPR4E21",52,0)
 S:'$D(NEW) RMDACA=$P(^RMPR(664,RMPRA,1,DA,0),U,13)
"RTN","RMPR4E21",53,0)
 S R4DA=DA
"RTN","RMPR4E21",54,0)
 S DR="8;S RMTYPE=$P(^RMPR(664,RMPRA,1,R4DA,0),U,9);9;.01;"
"RTN","RMPR4E21",55,0)
 S DR=DR_"16R;1;14;17;15;3R;"
"RTN","RMPR4E21",56,0)
 I $D(NEW) S DR=DR_"2R~UNIT COST;"
"RTN","RMPR4E21",57,0)
 E  S DR=DR_"6R;",RHCNEW=$P($G(^RMPR(664,RMPRA,1,R4DA,0)),U,16)
"RTN","RMPR4E21",58,0)
 S DR=DR_"4R~UNIT OF ISSUE;7;11////C" D ^DIE
"RTN","RMPR4E21",59,0)
 I $D(NEW) S:$G(DA) ^TMP("RM",$J,"N",R4DA)=$G(^RMPR(664,RMPRA,1,R4DA,0))
"RTN","RMPR4E21",60,0)
 E  S:'$G(DA)&(RMDACA) ^TMP("RM",$J,"C",RMDACA)="" I $G(DA) S ^TMP("RM",$J,"E",DA)=$G(^RMPR(664,RMPRA,1,DA,0)),RHCOLD=$P(^RMPR(664,RMPRA,1,DA,0),U,16),RD660=$P(^(0),U,13) I RHCNEW'=RHCOLD D
"RTN","RMPR4E21",61,0)
 .S RHCED=1
"RTN","RMPR4E21",62,0)
 .I $D(RD660)&(RD660) S DIE="^RMPR(660,",DA=RD660,DR="4.5///^S X=$G(RHCOLD)" D ^DIE
"RTN","RMPR4E21",63,0)
 I $D(R4DA),$P($G(^RMPR(664,RMPRA,1,R4DA,0)),U,10)=4 S DA=R4DA,DR=10 D ^DIE
"RTN","RMPR4E21",64,0)
 ;check for Type of Transaction and update the cpt modifier.
"RTN","RMPR4E21",65,0)
 I $D(R4DA),$D(RMTYPE) S RDATA=RMTYPE_"^"_RMPRA_"^"_R4DA D CHKCPT^RMPR4UTL(RDATA)
"RTN","RMPR4E21",66,0)
 Q:$D(DTOUT)  K NUM,R4DA,DA,Y,DR,RD660,RHCOLD,RHCNEW,DIE,RDATA,RMTYPE Q
"RTN","RMPR4E21",67,0)
CHK ;ADD DUPLICATE LINE ITEM
"RTN","RMPR4E21",68,0)
 K DIR,Y S DIR(0)="S^Y:YES;N:NO",DIR("A")="DO YOU WANT TO ADD A DUPLICATE ITEM?",DIR("B")="NO" D ^DIR Q:$D(DIRUT)!($D(DTOUT))  I (X["Y")!(X["y") G FILE
"RTN","RMPR4E21",69,0)
 S RD=0 F RDA=0:0 S RDA=$O(^RMPR(664,RMPRA,1,"B",HY,RDA)) Q:RDA'>0  S RD=RD+1
"RTN","RMPR4E21",70,0)
LKP I RD>1 D  Q:$D(DIRUT)!$D(DTOUT)  I '$D(RD(+Y)) W $C(7) G LKP
"RTN","RMPR4E21",71,0)
 .F RDA=0:0 S RDA=$O(^RMPR(664,RMPRA,1,"B",HY,RDA)) Q:RDA'>0  S RD(RDA)=^RMPR(664,RMPRA,1,RDA,0) W !?5,RDA,?10,$P(^PRC(441,$P(^RMPR(661,$P(RD(RDA),U),0),U),0),U,2),"  $",$S($P(RD(RDA),U,7)'="":$P(RD(RDA),U,7),1:$P(RD(RDA),U,3))
"RTN","RMPR4E21",72,0)
 .K DIR,Y S DIR(0)="N" D ^DIR I +Y S DA=+Y
"RTN","RMPR4E21",73,0)
 G ENT
"RTN","RMPR4E21",74,0)
 ;
"RTN","RMPR4E21",75,0)
DS ;**** update shipping cost, % discount and bank authorization ********
"RTN","RMPR4E21",76,0)
 S (RMPERF,RMBANF,RMSHIF)=0
"RTN","RMPR4E21",77,0)
 I $P(^RMPR(664,RMPRA,0),U,11)="",$P(^(0),U,10) S $P(^(0),U,11)=$P(RM(RMPRA,0),U,10)
"RTN","RMPR4E21",78,0)
 S DA=RMPRA,DIE="^RMPR(664,",DR="12;17;26" D ^DIE
"RTN","RMPR4E21",79,0)
 I RMPER'=$P(^RMPR(664,RMPRA,2),U,6) S RMPERF=1
"RTN","RMPR4E21",80,0)
 I RMBAN'=$P(^RMPR(664,RMPRA,4),U,2) S RMBANF=1
"RTN","RMPR4E21",81,0)
 I RMSHI'=$P(^RMPR(664,RMPRA,0),U,11) S RMSHIF=1
"RTN","RMPR4E21",82,0)
 S:$P(^RMPR(664,RMPRA,0),U,11)="" $P(^(0),U,11)=0
"RTN","RMPR4E21",83,0)
CHK1 ;delete imcomplete items
"RTN","RMPR4E21",84,0)
 S DIK="^RMPR(664,"_RMPRA_",1,",DA(1)=RMPRA F I=0:0 S I=$O(^RMPR(664,RMPRA,1,I)) Q:I'>0  S RMPRI=$G(^(I,0)) I $P(RMPRI,U,3)=""!($P(RMPRI,U,4)="")!($P(RMPRI,U,5)="") S DA=I D ^DIK
"RTN","RMPR4E21",85,0)
 G L ;go back to select ITEM
"RTN","RMPR4E21",86,0)
 ;*************************************************************
"RTN","RMPR4E21",87,0)
POST1 ;SET AMOUNT FOR IFCAP AMENDMENT.
"RTN","RMPR4E21",88,0)
 S (R1,RMPR("AMT"),AMT,DCT,RMPRTO)=0
"RTN","RMPR4E21",89,0)
 I $D(^RMPR(664,RMPRA,2)),$P(^(2),U,6) S DCT=$P(^(2),U,6),DCT=DCT/100
"RTN","RMPR4E21",90,0)
 F RI=0:0 S RI=$O(^RMPR(664,RMPRA,1,RI)) Q:RI'>0  D
"RTN","RMPR4E21",91,0)
 .N RMACT
"RTN","RMPR4E21",92,0)
 .S RMX=$G(^RMPR(664,RMPRA,1,RI,0)),RMACT=$P(RMX,U,7),RMQTY=$P(RMX,U,4)
"RTN","RMPR4E21",93,0)
 .I DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT-$J(RMACT*DCT,0,2)*RMQTY,1:$P(RMX,U,3)-$J($P(RMX,U,3)*DCT,0,2)*RMQTY)
"RTN","RMPR4E21",94,0)
 .I 'DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT*RMQTY,1:$P(RMX,U,3)*RMQTY)
"RTN","RMPR4E21",95,0)
 .S RMPR("AMT")=RMPR("AMT")+RMTOT,RMPRTO=RMPR("AMT")
"RTN","RMPR4E21",96,0)
 S RMPRSH=$S($P(^RMPR(664,RMPRA,0),U,11)=0:0,$P(^RMPR(664,RMPRA,0),U,11):$P(^(0),U,11),$P(^RMPR(664,RMPRA,0),U,10):$P(^(0),U,10),1:"")
"RTN","RMPR4E21",97,0)
 D CHECK^RMPRCT I '$D(RMPRTO) W !,"***** NOT CLOSED-OUT !!!!" G KTMP
"RTN","RMPR4E21",98,0)
 ;**************************************************************
"RTN","RMPR4E21",99,0)
 ;check 4;3,2;8&2;9&4;6 call PRCH7C if needed
"RTN","RMPR4E21",100,0)
 ;if total amount has not changed, then don't need to call ammend
"RTN","RMPR4E21",101,0)
 ;if it is an early record with no ifcap order then don't call ammend
"RTN","RMPR4E21",102,0)
 ;set the reprint flag
"RTN","RMPR4E21",103,0)
 I $FN($P(^RMPR(664,RMPRA,4),U,3),"P",2)'=$FN(RMPRTO+RMPRSH,"P",2)&($P(^(2),U,9)="")!($P(^(2),U,9)'="")&($FN($P(^(2),U,9),"P",2)'=$FN(RMPRTO+RMPRSH,"P",2)) D  I (X=0)&'$D(^TMP("RM",$J)) W !!,"**** NOT CLOSED-OUT!! ****" G KTMP
"RTN","RMPR4E21",104,0)
 .;call IFCAP AMMEND
"RTN","RMPR4E21",105,0)
 .S RMPR442=$P(^RMPR(664,RMPRA,4),U,6) I RMPR442="" Q
"RTN","RMPR4E21",106,0)
 .D AMEND^PRCH7C(RMPR442,RMPRTO+RMPRSH)
"RTN","RMPR4E21",107,0)
 .I X=1 S $P(^RMPR(664,RMPRA,2),U,8)=DUZ,$P(^RMPR(664,RMPRA,2),U,9)=RMPRTO+RMPRSH,$P(^RMPR(664,RMPRA,2),U,10)=1
"RTN","RMPR4E21",108,0)
 .I X'=1 S $P(^RMPR(664,RMPRA,2),U,10)=""
"RTN","RMPR4E21",109,0)
 ;do posting to 660
"RTN","RMPR4E21",110,0)
 I $D(^TMP("RM",$J))!$G(RMSHIF)!$G(RMPERF)!$G(RMBANF) D POST2^RMPR4M
"RTN","RMPR4E21",111,0)
 I $D(RMPRWO),$D(^RMPR(664.2,+RMPRWO,0)) S $P(^("AM"),U,2)=1 S $P(^RMPR(664.2,+RMPRWO,0),U,7)=$P(^(0),U,7)+RMPRSH D DA0^RMPR29M(RMPRDA,RMPRA),POST^RMPR29U
"RTN","RMPR4E21",112,0)
 G:$D(RFLG) EXIT
"RTN","RMPR4E21",113,0)
 ;go to exit in above line if not close-out.
"RTN","RMPR4E21",114,0)
 ;close-out remarks
"RTN","RMPR4E21",115,0)
 W ! S DIE="^RMPR(664,",DA=RMPRA,DR="8.1" D ^DIE S RMPRCC=$P($G(^RMPR(664,RMPRA,2)),U,3)
"RTN","RMPR4E21",116,0)
 F  S R1=$O(^RMPR(664,RMPRA,1,R1)) Q:R1'>0  I $D(^(R1,0)) D
"RTN","RMPR4E21",117,0)
 .N RM660
"RTN","RMPR4E21",118,0)
 .S RM660=$P($G(^(0)),U,13) I RM660,$P($G(^RMPR(660,RM660,0)),U,18)'[RMPRCC S $P(^(0),U,18)=$P(^(0),U,18)_" "_RMPRCC
"RTN","RMPR4E21",119,0)
 ;
"RTN","RMPR4E21",120,0)
EX ;***reindex record in 664 here
"RTN","RMPR4E21",121,0)
 L -^RMPR(664,RMPRA,0)
"RTN","RMPR4E21",122,0)
 ;IFCAP final charge payment
"RTN","RMPR4E21",123,0)
 S RMPR442=$P(^RMPR(664,RMPRA,4),U,6) ;don't call recon if it is an early record, no ifcap order.
"RTN","RMPR4E21",124,0)
 D:RMPR442'="" RECON^PRCH7C(RMPR442,DUZ)
"RTN","RMPR4E21",125,0)
 I (X=0)&(RMPR442'="") W !!,"**** TRANSACTION NOT CLOSED-OUT!! ****" G EX1
"RTN","RMPR4E21",126,0)
 S $P(^RMPR(664,RMPRA,4),U,4)=RMPRTO+RMPRSH
"RTN","RMPR4E21",127,0)
 ;set close out date 
"RTN","RMPR4E21",128,0)
 D NOW^%DTC S $P(^RMPR(664,RMPRA,0),U,8)=%
"RTN","RMPR4E21",129,0)
 ;set closed by
"RTN","RMPR4E21",130,0)
 S $P(^RMPR(664,RMPRA,2),U,7)=DUZ,DA=$P(^RMPR(664,RMPRA,0),U,12)
"RTN","RMPR4E21",131,0)
 I DA'="" S $P(^RMPR(660,DA,0),U,12)=%,DIK="^RMPR(660," D IX1^DIK
"RTN","RMPR4E21",132,0)
 S RMPR660=0,DA="",DIK="^RMPR(660,"
"RTN","RMPR4E21",133,0)
 F  S RMPR660=$O(^RMPR(664,RMPRA,1,RMPR660)) Q:RMPR660'>0  D
"RTN","RMPR4E21",134,0)
 .;get pointer from item mult
"RTN","RMPR4E21",135,0)
 .S DA=$P(^RMPR(664,RMPRA,1,RMPR660,0),U,13)
"RTN","RMPR4E21",136,0)
 .;set delivery date
"RTN","RMPR4E21",137,0)
 .I DA'="" S $P(^RMPR(660,DA,0),U,12)=DT D IX1^DIK
"RTN","RMPR4E21",138,0)
 .;Patch #78 - Get IFCAP Transaction Date and prompt for Shipment Date
"RTN","RMPR4E21",139,0)
 .I DA'="" S SKPSHDT=1 D ^RMPR4E23 K SKPSHDT
"RTN","RMPR4E21",140,0)
EX1 ;
"RTN","RMPR4E21",141,0)
 ;added by #62
"RTN","RMPR4E21",142,0)
 D:RM68FG=1 AUTO^RMPRPCEL D:RM68FG>1 MAN^RMPRPCEL
"RTN","RMPR4E21",143,0)
 ;
"RTN","RMPR4E21",144,0)
 D EXIT
"RTN","RMPR4E21",145,0)
 W !!,"Enter Next Transaction to Close-out, or <RETURN> to continue."
"RTN","RMPR4E21",146,0)
 G CL
"RTN","RMPR4E21",147,0)
 ;
"RTN","RMPR4E21",148,0)
EXIT ;KILL VARIABLES AND EXIT ROUTINE
"RTN","RMPR4E21",149,0)
 L:$D(RMPRA) -^RMPR(664,RMPRA,0)
"RTN","RMPR4E21",150,0)
 K ^TMP($J),^TMP("RM")
"RTN","RMPR4E21",151,0)
 K RGRP,RGRP1,RGRPP,RMBAN,RMBANF
"RTN","RMPR4E21",152,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPR4E21",153,0)
 Q
"RTN","RMPR4E21",154,0)
 ;
"RTN","RMPR4E21",155,0)
KTMP S DIK="^RMPR(664,"_RMPRA_",1,",DA(1)=RMPRA F I=0:0 S I=$O(^TMP("RM",$J,"N",I)) Q:I'>0  S DA=I D ^DIK
"RTN","RMPR4E21",156,0)
 S %X="^TMP("_"""RM"""_",$J,RMPRA,",%Y="^RMPR(664,RMPRA," D %XY^%RCR G EX1
"RTN","RMPR4E21",157,0)
BRK W !,$C(7),"INCOMPLETE RECORD..file 664..entry..",RMPRA,"...PLEASE CONTACT YOUR IRM or CANCEL THIS ENTRY!!!" G EX1
"RTN","RMPR4E21",158,0)
UNK W !,$C(7),"UNKNOWN 2319 RECORD TO UPDATE, 2319 NOT UPDATED!" G EXIT
"RTN","RMPR4E21",159,0)
M4 W !,$C(7),"This Transaction has already been CLOSED!" G EXIT
"RTN","RMPR4E21",160,0)
M6 W !,$C(7),"This Transaction has been CANCELED!" G EXIT
"RTN","RMPR4E23")
0^2^B4674920^B3734591
"RTN","RMPR4E23",1,0)
RMPR4E23 ;HINES CIOFO/TH - PROMPT FOR SHIPMENT DATE ;08/05/03
"RTN","RMPR4E23",2,0)
 ;;3.0;PROSTHETICS;**78,114,118**;Feb 09, 1996
"RTN","RMPR4E23",3,0)
 ;
"RTN","RMPR4E23",4,0)
 ;TH 08/05/03 Patch #78 - Add shipment date.
"RTN","RMPR4E23",5,0)
 ;                      - DBIA #3427
"RTN","RMPR4E23",6,0)
 ;
"RTN","RMPR4E23",7,0)
 ; RMIFCAP = IFCAP Order
"RTN","RMPR4E23",8,0)
 ; RMPRTRDT = Transaction Date from file #440.6
"RTN","RMPR4E23",9,0)
 ; RMPRSHIP = Shipment Date
"RTN","RMPR4E23",10,0)
 ;
"RTN","RMPR4E23",11,0)
 S (RMIFCAP,RMPRTRDT,RMPRSHIP)=""
"RTN","RMPR4E23",12,0)
 ; Set default to today's date
"RTN","RMPR4E23",13,0)
 S RMPRTRDT=DT
"RTN","RMPR4E23",14,0)
 I $D(^RMPR(664,RMPRA)) D
"RTN","RMPR4E23",15,0)
 . Q:'$D(^RMPR(664,RMPRA,4))
"RTN","RMPR4E23",16,0)
 . S RMIFCAP=$P(^RMPR(664,RMPRA,4),U,6) Q:RMIFCAP=""
"RTN","RMPR4E23",17,0)
 . I $D(^PRCH(440.6,"PO",RMIFCAP)) D
"RTN","RMPR4E23",18,0)
 . . S D1="",D1=$O(^PRCH(440.6,"PO",RMIFCAP,D1),-1) Q:D1=""
"RTN","RMPR4E23",19,0)
 . . Q:'$D(^PRCH(440.6,D1,0))
"RTN","RMPR4E23",20,0)
 . . S RMPRTRDT=$$GET1^DIQ(440.6,D1,6,"I")
"RTN","RMPR4E23",21,0)
 S RMPRTRDT=$$FMTE^XLFDT(RMPRTRDT,"2D")
"RTN","RMPR4E23",22,0)
 D GETDT,BILL,EXIT
"RTN","RMPR4E23",23,0)
 Q
"RTN","RMPR4E23",24,0)
 ;
"RTN","RMPR4E23",25,0)
GETDT ; DIR call to obtain the shipment date
"RTN","RMPR4E23",26,0)
 Q:$G(DA)=""
"RTN","RMPR4E23",27,0)
 I $G(SKPSHDT)=1 D  G GETDT1  ;SKPSHDT set in RMPR4E21 to auto set ship date to trans date
"RTN","RMPR4E23",28,0)
 . S RMPRSHIP=DT
"RTN","RMPR4E23",29,0)
 . I RMPRTRDT'="" S X=RMPRTRDT K %DT D ^%DT S RMPRSHIP=Y
"RTN","RMPR4E23",30,0)
 K DIR,DIRUT
"RTN","RMPR4E23",31,0)
 S DIR(0)="D",DIR("A")="Shipment Date",DIR("B")=$G(RMPRTRDT)
"RTN","RMPR4E23",32,0)
 S DIR("?")="The date that the item shipped to the patient. The default"
"RTN","RMPR4E23",33,0)
 S DIR("?")=DIR("?")_" date would be the transaction date from IFCAP."
"RTN","RMPR4E23",34,0)
 D ^DIR
"RTN","RMPR4E23",35,0)
 S RMPRSHIP=Y
"RTN","RMPR4E23",36,0)
GETDT1 G:'$D(^RMPR(660,DA)) EXIT
"RTN","RMPR4E23",37,0)
 G:RMPRSHIP="" EXIT
"RTN","RMPR4E23",38,0)
 ; Shipment Date/Date of Service filed in file #660.
"RTN","RMPR4E23",39,0)
 I DA'="" S $P(^RMPR(660,DA,1),U,8)=RMPRSHIP
"RTN","RMPR4E23",40,0)
 Q
"RTN","RMPR4E23",41,0)
 ;
"RTN","RMPR4E23",42,0)
BILL ; File to #660.5 - ready to bill
"RTN","RMPR4E23",43,0)
 Q  ; taken out for phase II Billing Aware (WLC 02/26/04)
"RTN","RMPR4E23",44,0)
 N DIC,X,DLAYGO,DIR
"RTN","RMPR4E23",45,0)
 S DIC="^RMPR(660.5,"
"RTN","RMPR4E23",46,0)
 S DIC(0)="L",X="""N"""
"RTN","RMPR4E23",47,0)
 S DLAYGO=660.5 D ^DIC K DLAYGO Q:Y<1
"RTN","RMPR4E23",48,0)
 S RMPRO=+Y,DIE=DIC
"RTN","RMPR4E23",49,0)
 ;
"RTN","RMPR4E23",50,0)
 L +^RMPR(660.5,RMPRO)
"RTN","RMPR4E23",51,0)
 ; .01-Transaction Date; 2-Send Required; .02-Shipment Date
"RTN","RMPR4E23",52,0)
 ; 3-ProsFile(pointer to file #660)
"RTN","RMPR4E23",53,0)
 S DR=".01////^S X=DT;2////1;.02////^S X=RMPRSHIP;3////^S X=DA"
"RTN","RMPR4E23",54,0)
 D ^DIE
"RTN","RMPR4E23",55,0)
 L -^RMPR(660.5,RMPRO)
"RTN","RMPR4E23",56,0)
 Q
"RTN","RMPR4E23",57,0)
 ;
"RTN","RMPR4E23",58,0)
EXIT ; Exit
"RTN","RMPR4E23",59,0)
 K DA,DIC,DIE,DR,RMIFCAP,RMPRTRDT,RMPRSHIP
"RTN","RMPR4E23",60,0)
 Q
"RTN","RMPRPIY7")
0^3^B54160791^B53472701
"RTN","RMPRPIY7",1,0)
RMPRPIY7 ;HINCIO/ODJ - PIP EDIT - PROMPTS ;9/18/02  15:17
"RTN","RMPRPIY7",2,0)
 ;;3.0;PROSTHETICS;**61,118**;Feb 09, 1996
"RTN","RMPRPIY7",3,0)
 ;
"RTN","RMPRPIY7",4,0)
 ;DBIA # 800 - FILEMAN read of file #440.
"RTN","RMPRPIY7",5,0)
 Q
"RTN","RMPRPIY7",6,0)
 ; The following subroutines are a series of prompts called
"RTN","RMPRPIY7",7,0)
 ; by Edit LOCATION/HCPCS/ITEM option (EI^RMPRPIY6)
"RTN","RMPRPIY7",8,0)
 ;
"RTN","RMPRPIY7",9,0)
 ;***** LOCNM - Prompt for location
"RTN","RMPRPIY7",10,0)
 ;              must be in 661.5 and active
"RTN","RMPRPIY7",11,0)
LOCNM(RMPRSTN,RMPR5,RMPREXC) ;
"RTN","RMPRPIY7",12,0)
 N RMPRERR,DIR,X,Y,DA,DUOUT,DTOUT,DIROUT,RMPRYN,RMPRTDT
"RTN","RMPRPIY7",13,0)
 D NOW^%DTC S RMPRTDT=X ;today's date
"RTN","RMPRPIY7",14,0)
 S RMPREXC=""
"RTN","RMPRPIY7",15,0)
 S RMPRERR=0
"RTN","RMPRPIY7",16,0)
 S DIR(0)="FOA"
"RTN","RMPRPIY7",17,0)
 S DIR("A")="Enter Pros Location: "
"RTN","RMPRPIY7",18,0)
 I $G(RMPR5("NAME"))'="" S DIR("B")=RMPR5("NAME")
"RTN","RMPRPIY7",19,0)
 S DIR("?")="^D QM^RMPRPIYB"
"RTN","RMPRPIY7",20,0)
 S DIR("??")="^D QM2^RMPRPIYB"
"RTN","RMPRPIY7",21,0)
 S RMPR5("IEN")=""
"RTN","RMPRPIY7",22,0)
LOCNM1 D ^DIR
"RTN","RMPRPIY7",23,0)
 S X=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","RMPRPIY7",24,0)
 I $G(RMPR5("IEN"))'="" S RMPREXC="" G LOCNMX
"RTN","RMPRPIY7",25,0)
 I $D(DTOUT) S RMPREXC="T" G LOCNMX
"RTN","RMPRPIY7",26,0)
 I $D(DIROUT) S RMPREXC="P" G LOCNMX
"RTN","RMPRPIY7",27,0)
 I X=""!(X["^") S RMPREXC="^" G LOCNMX
"RTN","RMPRPIY7",28,0)
 K RMPR5
"RTN","RMPRPIY7",29,0)
 S RMPR5("STATION")=RMPRSTN
"RTN","RMPRPIY7",30,0)
 S RMPR5("STATION IEN")=RMPRSTN
"RTN","RMPRPIY7",31,0)
 D LIKE^RMPRPIYB(RMPRSTN,X,.RMPREXC,.RMPR5)
"RTN","RMPRPIY7",32,0)
 I RMPREXC'="" G LOCNM1
"RTN","RMPRPIY7",33,0)
 I $G(RMPR5("IEN"))="" D  G LOCNM1
"RTN","RMPRPIY7",34,0)
 . W !,"Please enter a valid Location"
"RTN","RMPRPIY7",35,0)
 . Q
"RTN","RMPRPIY7",36,0)
 ;
"RTN","RMPRPIY7",37,0)
 ; exit
"RTN","RMPRPIY7",38,0)
LOCNMX Q
"RTN","RMPRPIY7",39,0)
 ;
"RTN","RMPRPIY7",40,0)
 ;***** OK - Prompt for an OK
"RTN","RMPRPIY7",41,0)
OK(RMPRYN,RMPREXC) ;
"RTN","RMPRPIY7",42,0)
 N DIR,X,Y,DA,DUOUT,DTOUT,DIROUT,DIRUT
"RTN","RMPRPIY7",43,0)
 S RMPREXC=""
"RTN","RMPRPIY7",44,0)
 S RMPRYN="N"
"RTN","RMPRPIY7",45,0)
 S DIR("A")="         ...OK"
"RTN","RMPRPIY7",46,0)
 S DIR("B")="Yes"
"RTN","RMPRPIY7",47,0)
 S DIR(0)="Y"
"RTN","RMPRPIY7",48,0)
 D ^DIR
"RTN","RMPRPIY7",49,0)
 I $D(DTOUT) S RMPREXC="T" G OKX
"RTN","RMPRPIY7",50,0)
 I $D(DIROUT) S RMPREXC="P" G OKX
"RTN","RMPRPIY7",51,0)
 I X=""!(X["^") S RMPREXC="^" G OKX
"RTN","RMPRPIY7",52,0)
 S RMPRYN="N" S:Y RMPRYN="Y"
"RTN","RMPRPIY7",53,0)
OKX Q
"RTN","RMPRPIY7",54,0)
 ;
"RTN","RMPRPIY7",55,0)
 ;***** HCPCS - Prompt for HCPCS
"RTN","RMPRPIY7",56,0)
HCPCS(RMPRSTN,RMPRHPTX,RMPR1,RMPR11,RMPREXC) ;
"RTN","RMPRPIY7",57,0)
 N RMPRERR,DIR,X,Y,DUOUT,DTOUT,DIROUT,DIRUT,DIC,DA,RMPR1N,RMSTN
"RTN","RMPRPIY7",58,0)
 N RM6610
"RTN","RMPRPIY7",59,0)
 S DIR("A")="Select HCPCS: ",RMSTN=RMPRSTN
"RTN","RMPRPIY7",60,0)
 S DIR("S")="I $P(^RMPR(661.11,+Y,0),U,4)=RMSTN"
"RTN","RMPRPIY7",61,0)
 S RMPRERR=0
"RTN","RMPRPIY7",62,0)
 S RMPREXC=""
"RTN","RMPRPIY7",63,0)
 S RMPRHPTX=$G(RMPRHPTX)
"RTN","RMPRPIY7",64,0)
 I RMPRHPTX'="" S DIR("B")=RMPRHPTX
"RTN","RMPRPIY7",65,0)
 S DIR(0)="FOA"
"RTN","RMPRPIY7",66,0)
 S DIR("?")="^D QM2^RMPRPIYC"
"RTN","RMPRPIY7",67,0)
 S DIR("??")="^D QM2^RMPRPIYC"
"RTN","RMPRPIY7",68,0)
 S DIR("???")="^D QM2^RMPRPIYC"
"RTN","RMPRPIY7",69,0)
HCPCS1 K RMPR1N D ^DIR
"RTN","RMPRPIY7",70,0)
 I $G(RMPR1N("IEN"))'="" S RMPRHPTX=RMPR1N("HCPCS") G CHECK
"RTN","RMPRPIY7",71,0)
 I $D(DTOUT) S RMPREXC="T" G HCPCSX
"RTN","RMPRPIY7",72,0)
 I $D(DIROUT) S RMPREXC="P" G HCPCSX
"RTN","RMPRPIY7",73,0)
 I X=""!(X["^")!($D(DUOUT)) S RMPREXC="^" G HCPCSX
"RTN","RMPRPIY7",74,0)
 D LIKE^RMPRPIYC(RMPRSTN,X,.RMPREXC,.RMPR1N,.RMPR11)
"RTN","RMPRPIY7",75,0)
 I RMPREXC'="" G HCPCS1
"RTN","RMPRPIY7",76,0)
 I $G(RMPR1N("IEN"))'="",$G(RMPR1("REMOVE")) G HCPCSU
"RTN","RMPRPIY7",77,0)
CHECK I $G(RMPR1N("IEN")),$D(^RMPR(661.1,$G(RMPR1N("IEN")),0)),'($P(^RMPR(661.1,RMPR1N("IEN"),0),U,5)) W !,"** No HCPCS Selected or Unable to Select Inactive HCPCS..." G HCPCS1
"RTN","RMPRPIY7",78,0)
 I $G(RMPR1N("IEN"))'="" G HCPCSU
"RTN","RMPRPIY7",79,0)
 G HCPCS1
"RTN","RMPRPIY7",80,0)
HCPCSU K RMPR1 M RMPR1=RMPR1N
"RTN","RMPRPIY7",81,0)
HCPCSX Q
"RTN","RMPRPIY7",82,0)
 ;
"RTN","RMPRPIY7",83,0)
 ;***** ITEM - Prompt for Item - restrict choice to Location and HCPC
"RTN","RMPRPIY7",84,0)
ITEM(RMPRSTN,RMPRLCN,RMPRHCPC,RMPR11,RMPR4,RMPREXC) ;
"RTN","RMPRPIY7",85,0)
 N RMPRERR,DIR,X,Y,DUOUT,DTOUT,DIROUT,DA,RMPRSRC,RMPRYN
"RTN","RMPRPIY7",86,0)
 S RMPRERR=0
"RTN","RMPRPIY7",87,0)
 S RMPREXC=""
"RTN","RMPRPIY7",88,0)
 I $G(RMPRSTN)="" S RMPRERR=1 G ITEMX
"RTN","RMPRPIY7",89,0)
 I $G(RMPRLCN)="" S RMPRERR=2 G ITEMX
"RTN","RMPRPIY7",90,0)
 I $G(RMPRHCPC)="" S RMPRERR=3 G ITEMX
"RTN","RMPRPIY7",91,0)
 K RMPR11,RMPR4
"RTN","RMPRPIY7",92,0)
 S DIR(0)="FOA^1:50"
"RTN","RMPRPIY7",93,0)
 S DIR("A")="Enter PSAS Item to Edit: "
"RTN","RMPRPIY7",94,0)
 S DIR("?")="^D QM^RMPRPIY8"
"RTN","RMPRPIY7",95,0)
 S DIR("??")="^D QQM^RMPRPIY8"
"RTN","RMPRPIY7",96,0)
ITEMA1 D ^DIR
"RTN","RMPRPIY7",97,0)
 I $D(DTOUT) S RMPREXC="T" G ITEMX
"RTN","RMPRPIY7",98,0)
 I $D(DIROUT) S RMPREXC="P" G ITEMX
"RTN","RMPRPIY7",99,0)
 I X=""!(X["^")!$D(DUOUT) S RMPREXC="^" G ITEMX
"RTN","RMPRPIY7",100,0)
 D LIKE^RMPRPIY8(RMPRSTN,RMPRLCN,RMPRHCPC,X,.RMPREXC,.RMPR11,.RMPR4)
"RTN","RMPRPIY7",101,0)
 I RMPREXC="T" G ITEMX
"RTN","RMPRPIY7",102,0)
 I RMPREXC="P" G ITEMX
"RTN","RMPRPIY7",103,0)
 I RMPREXC="^" G ITEMA1
"RTN","RMPRPIY7",104,0)
 I RMPR4("IEN")="" D  G ITEMA1
"RTN","RMPRPIY7",105,0)
 . W !,"Cannot locate ITEM with this sequence NUMBER"
"RTN","RMPRPIY7",106,0)
 . Q
"RTN","RMPRPIY7",107,0)
 W "  ",RMPR11("HCPCS-ITEM"),"  ",RMPR11("DESCRIPTION")
"RTN","RMPRPIY7",108,0)
 D OK(.RMPRYN,.RMPREXC)
"RTN","RMPRPIY7",109,0)
 I RMPRYN'="Y" G ITEMA1
"RTN","RMPRPIY7",110,0)
 G ITEMX
"RTN","RMPRPIY7",111,0)
ITEMX Q RMPRERR
"RTN","RMPRPIY7",112,0)
 ;
"RTN","RMPRPIY7",113,0)
 ;***** QTY - Prompt for Quantity
"RTN","RMPRPIY7",114,0)
QTY(RMPRQTY,RMPREXC) ;
"RTN","RMPRPIY7",115,0)
 N RMPRERR,DIR,X,Y,DUOUT,DTOUT,DIROUT,DIRUT,DA
"RTN","RMPRPIY7",116,0)
 S RMPRQTY=$G(RMPRQTY)
"RTN","RMPRPIY7",117,0)
 S RMPRERR=0
"RTN","RMPRPIY7",118,0)
 S DIR(0)="NA^1:99999:0"
"RTN","RMPRPIY7",119,0)
 S DIR("A")="QUANTITY: "
"RTN","RMPRPIY7",120,0)
 S:RMPRQTY'="" DIR("B")=RMPRQTY
"RTN","RMPRPIY7",121,0)
 D ^DIR
"RTN","RMPRPIY7",122,0)
 I $D(DTOUT) S RMPREXC="T" G QTYX
"RTN","RMPRPIY7",123,0)
 I $D(DIROUT) S RMPREXC="P" G QTYX
"RTN","RMPRPIY7",124,0)
 I X=""!(X["^") S RMPREXC="^" G QTYX
"RTN","RMPRPIY7",125,0)
 S RMPRQTY=Y
"RTN","RMPRPIY7",126,0)
QTYX Q RMPRERR
"RTN","RMPRPIY7",127,0)
 ;
"RTN","RMPRPIY7",128,0)
 ;***** TVAL - Prompt for total $ value
"RTN","RMPRPIY7",129,0)
TVAL(RMPRTVAL,RMPREXC) ;
"RTN","RMPRPIY7",130,0)
 N RMPRERR,DIR,X,Y,DUOUT,DTOUT,DIROUT,DIRUT,DA
"RTN","RMPRPIY7",131,0)
 S RMPRTVAL=$G(RMPRTVAL)
"RTN","RMPRPIY7",132,0)
 S RMPRERR=0
"RTN","RMPRPIY7",133,0)
 S DIR(0)="NOA^0:999999:2"
"RTN","RMPRPIY7",134,0)
 S DIR("A")="TOTAL COST OF QUANTITY: "
"RTN","RMPRPIY7",135,0)
 S:RMPRTVAL'="" DIR("B")=RMPRTVAL
"RTN","RMPRPIY7",136,0)
 D ^DIR
"RTN","RMPRPIY7",137,0)
 I $D(DTOUT) S RMPREXC="T" G TVALX
"RTN","RMPRPIY7",138,0)
 I $D(DIROUT) S RMPREXC="P" G TVALX
"RTN","RMPRPIY7",139,0)
 I X["^" S RMPREXC="^" G TVALX
"RTN","RMPRPIY7",140,0)
 I X="" G TVALX
"RTN","RMPRPIY7",141,0)
 S RMPRTVAL=Y
"RTN","RMPRPIY7",142,0)
TVALX Q RMPRERR
"RTN","RMPRPIY7",143,0)
 ;
"RTN","RMPRPIY7",144,0)
 ;***** REO - Prompt for Re-Order Level
"RTN","RMPRPIY7",145,0)
REO(RMPRREO,RMPREXC) ;
"RTN","RMPRPIY7",146,0)
 N RMPRERR,DIR,X,Y,DUOUT,DTOUT,DIROUT,DIRUT,DA
"RTN","RMPRPIY7",147,0)
 S RMPRREO=$G(RMPRREO)
"RTN","RMPRPIY7",148,0)
 S RMPRERR=0
"RTN","RMPRPIY7",149,0)
 S DIR(0)="NOA^0::0"
"RTN","RMPRPIY7",150,0)
 S DIR("A")="RE-ORDER LEVEL: "
"RTN","RMPRPIY7",151,0)
 S:RMPRREO'="" DIR("B")=RMPRREO
"RTN","RMPRPIY7",152,0)
 D ^DIR
"RTN","RMPRPIY7",153,0)
 I $D(DTOUT) S RMPREXC="T" G REOX
"RTN","RMPRPIY7",154,0)
 I $D(DIROUT) S RMPREXC="P" G REOX
"RTN","RMPRPIY7",155,0)
 I X=""!(X["^")!$D(DUOUT) S RMPREXC="^" G REOX
"RTN","RMPRPIY7",156,0)
 S RMPRREO=Y
"RTN","RMPRPIY7",157,0)
REOX Q RMPRERR
"RTN","RMPRPIY7",158,0)
 ;
"RTN","RMPRPIY7",159,0)
 ;***** VEND - Prompt for Vendor
"RTN","RMPRPIY7",160,0)
VEND(RMPRVEND,RMPREXC) ;
"RTN","RMPRPIY7",161,0)
 N RMPRERR,DIR,X,Y,DUOUT,DTOUT,DIROUT,DIRUT,DA
"RTN","RMPRPIY7",162,0)
 S RMPRVEND=$G(RMPRVEND("IEN"))
"RTN","RMPRPIY7",163,0)
 S RMPRERR=0
"RTN","RMPRPIY7",164,0)
 S DIR(0)="P^440:EMZ"
"RTN","RMPRPIY7",165,0)
 S DIR("A")="VENDOR"
"RTN","RMPRPIY7",166,0)
 S:RMPRVEND'="" DIR("B")=RMPRVEND("NAME")
"RTN","RMPRPIY7",167,0)
 D ^DIR
"RTN","RMPRPIY7",168,0)
 I $D(DTOUT) S RMPREXC="T" G VENDX
"RTN","RMPRPIY7",169,0)
 I $D(DIROUT) S RMPREXC="P" G VENDX
"RTN","RMPRPIY7",170,0)
 I X=""!(X["^")!$D(DUOUT) S RMPREXC="^" G VENDX
"RTN","RMPRPIY7",171,0)
 S RMPRVEND("IEN")=$P(Y,"^",1)
"RTN","RMPRPIY7",172,0)
 S RMPRVEND("NAME")=$P(Y,"^",2)
"RTN","RMPRPIY7",173,0)
VENDX Q RMPRERR
"RTN","RMPRPIY7",174,0)
 ;
"RTN","RMPRPIY7",175,0)
 ;***** PVEN - Pick the current stock record to edit
"RTN","RMPRPIY7",176,0)
PVEN(RMPRSTN,RMPRLCN,RMPRHCPC,RMPRITM,RMPR6,RMPR7,RMPREXC) ;
"RTN","RMPRPIY7",177,0)
 N DIR,X,Y,DA,RMPRGBL,RMPRLIN,RMPRA,RMPRERR,RMPRX,RMPRY,RMPRB
"RTN","RMPRPIY7",178,0)
 N RMPR7I
"RTN","RMPRPIY7",179,0)
 S RMPREXC=""
"RTN","RMPRPIY7",180,0)
 S RMPRX="",RMPRY=0
"RTN","RMPRPIY7",181,0)
 S RMPRLIN=0
"RTN","RMPRPIY7",182,0)
 S RMPRGBL=$Q(^RMPR(661.7,"XSLHIDS",RMPRSTN,RMPRLCN,RMPRHCPC,RMPRITM))
"RTN","RMPRPIY7",183,0)
 G PVEN1A
"RTN","RMPRPIY7",184,0)
PVEN1 S RMPRGBL=$Q(@RMPRGBL)
"RTN","RMPRPIY7",185,0)
PVEN1A I $QS(RMPRGBL,1)'=661.7 G PVEN2
"RTN","RMPRPIY7",186,0)
 I $QS(RMPRGBL,2)'="XSLHIDS" G PVEN2
"RTN","RMPRPIY7",187,0)
 I $QS(RMPRGBL,3)'=RMPRSTN G PVEN2
"RTN","RMPRPIY7",188,0)
 I $QS(RMPRGBL,4)'=RMPRLCN G PVEN2
"RTN","RMPRPIY7",189,0)
 I $QS(RMPRGBL,5)'=RMPRHCPC G PVEN2
"RTN","RMPRPIY7",190,0)
 I $QS(RMPRGBL,6)'=RMPRITM G PVEN2
"RTN","RMPRPIY7",191,0)
 S RMPRLIN=RMPRLIN+1
"RTN","RMPRPIY7",192,0)
 S RMPRA(RMPRLIN)=$QS(RMPRGBL,9)
"RTN","RMPRPIY7",193,0)
 G PVEN1
"RTN","RMPRPIY7",194,0)
PVEN2 I RMPRLIN=0 G PVENX
"RTN","RMPRPIY7",195,0)
 I RMPRLIN=1 S X=1 G PVEN3
"RTN","RMPRPIY7",196,0)
 W !,"Select a current Stock Record to edit...",!
"RTN","RMPRPIY7",197,0)
 W !,?7,"Date",?21,"Quantity",?35,"Value",?42,"Vendor"
"RTN","RMPRPIY7",198,0)
 S RMPRX="",RMPRLIN=0
"RTN","RMPRPIY7",199,0)
 F  S RMPRX=$O(RMPRA(RMPRX)) Q:RMPRX=""  D
"RTN","RMPRPIY7",200,0)
 . S RMPRLIN=RMPRLIN+1
"RTN","RMPRPIY7",201,0)
 . K RMPR7
"RTN","RMPRPIY7",202,0)
 . S RMPR7("IEN")=RMPRA(RMPRX)
"RTN","RMPRPIY7",203,0)
 . S RMPRERR=$$GET^RMPRPIX7(.RMPR7)
"RTN","RMPRPIY7",204,0)
 . W !,?2,$J(RMPRLIN,2)
"RTN","RMPRPIY7",205,0)
 . W ?7,$P(RMPR7("DATE&TIME"),"@",1)
"RTN","RMPRPIY7",206,0)
 . W ?21,$J(RMPR7("QUANTITY"),8,0)
"RTN","RMPRPIY7",207,0)
 . W ?30,$J(RMPR7("VALUE"),10,2)
"RTN","RMPRPIY7",208,0)
 . K RMPR7I
"RTN","RMPRPIY7",209,0)
 . S RMPRERR=$$ETOI^RMPRPIX7(.RMPR7,.RMPR7I)
"RTN","RMPRPIY7",210,0)
 . K RMPR6
"RTN","RMPRPIY7",211,0)
 . S RMPR6("DATE&TIME")=RMPR7I("DATE&TIME")
"RTN","RMPRPIY7",212,0)
 . S RMPR6("HCPCS")=RMPRHCPC
"RTN","RMPRPIY7",213,0)
 . S RMPRERR=$$GET^RMPRPIX6(.RMPR6)
"RTN","RMPRPIY7",214,0)
 . W ?42,RMPR6("VENDOR")
"RTN","RMPRPIY7",215,0)
 . Q
"RTN","RMPRPIY7",216,0)
 K RMPR7,RMPR6
"RTN","RMPRPIY7",217,0)
 S DIR(0)="NAO^1:"_RMPRLIN_": "
"RTN","RMPRPIY7",218,0)
 S DIR("A")="CHOOSE 1-"_RMPRLIN_": "
"RTN","RMPRPIY7",219,0)
 D ^DIR
"RTN","RMPRPIY7",220,0)
 I $D(DTOUT) S RMPREXC="T" G PVENX
"RTN","RMPRPIY7",221,0)
 I $D(DIROUT) S RMPREXC="P" G PVENX
"RTN","RMPRPIY7",222,0)
 I X=""!(X["^")!$D(DUOUT) S RMPREXC="^" G PVENX
"RTN","RMPRPIY7",223,0)
PVEN3 S RMPR7("IEN")=RMPRA(X)
"RTN","RMPRPIY7",224,0)
 S RMPRERR=$$GET^RMPRPIX7(.RMPR7)
"RTN","RMPRPIY7",225,0)
 K RMPR7I
"RTN","RMPRPIY7",226,0)
 S RMPRERR=$$ETOI^RMPRPIX7(.RMPR7,.RMPR7I)
"RTN","RMPRPIY7",227,0)
 S RMPR6("DATE&TIME")=RMPR7I("DATE&TIME")
"RTN","RMPRPIY7",228,0)
 S RMPR6("HCPCS")=RMPRHCPC
"RTN","RMPRPIY7",229,0)
 S RMPRERR=$$GET^RMPRPIX6(.RMPR6)
"RTN","RMPRPIY7",230,0)
PVENX Q
"VER")
8.0^22.0
"BLD",5865,6)
^96
**END**
**END**
