Released DG*5.3*636 SEQ #578
Extracted from mail message
**KIDS**:DG*5.3*636^

**INSTALL NAME**
DG*5.3*636
"BLD",6056,0)
DG*5.3*636^REGISTRATION^0^3050727^y
"BLD",6056,1,0)
^^2^2^3050727^
"BLD",6056,1,1,0)
This patch corrects a problem when coding the 501 or MAS screen in
"BLD",6056,1,2,0)
  the Load/Edit PTF Data [DG PTF SCREEN] option.
"BLD",6056,4,0)
^9.64PA^^
"BLD",6056,"KRN",0)
^9.67PA^8989.52^19
"BLD",6056,"KRN",.4,0)
.4
"BLD",6056,"KRN",.401,0)
.401
"BLD",6056,"KRN",.402,0)
.402
"BLD",6056,"KRN",.403,0)
.403
"BLD",6056,"KRN",.5,0)
.5
"BLD",6056,"KRN",.84,0)
.84
"BLD",6056,"KRN",3.6,0)
3.6
"BLD",6056,"KRN",3.8,0)
3.8
"BLD",6056,"KRN",9.2,0)
9.2
"BLD",6056,"KRN",9.8,0)
9.8
"BLD",6056,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6056,"KRN",9.8,"NM",1,0)
DGPTFJC^^0^B46654954
"BLD",6056,"KRN",9.8,"NM",2,0)
DGPTR2^^0^B17037574
"BLD",6056,"KRN",9.8,"NM","B","DGPTFJC",1)

"BLD",6056,"KRN",9.8,"NM","B","DGPTR2",2)

"BLD",6056,"KRN",19,0)
19
"BLD",6056,"KRN",19.1,0)
19.1
"BLD",6056,"KRN",101,0)
101
"BLD",6056,"KRN",409.61,0)
409.61
"BLD",6056,"KRN",771,0)
771
"BLD",6056,"KRN",870,0)
870
"BLD",6056,"KRN",8989.51,0)
8989.51
"BLD",6056,"KRN",8989.52,0)
8989.52
"BLD",6056,"KRN",8994,0)
8994
"BLD",6056,"KRN","B",.4,.4)

"BLD",6056,"KRN","B",.401,.401)

"BLD",6056,"KRN","B",.402,.402)

"BLD",6056,"KRN","B",.403,.403)

"BLD",6056,"KRN","B",.5,.5)

"BLD",6056,"KRN","B",.84,.84)

"BLD",6056,"KRN","B",3.6,3.6)

"BLD",6056,"KRN","B",3.8,3.8)

"BLD",6056,"KRN","B",9.2,9.2)

"BLD",6056,"KRN","B",9.8,9.8)

"BLD",6056,"KRN","B",19,19)

"BLD",6056,"KRN","B",19.1,19.1)

"BLD",6056,"KRN","B",101,101)

"BLD",6056,"KRN","B",409.61,409.61)

"BLD",6056,"KRN","B",771,771)

"BLD",6056,"KRN","B",870,870)

"BLD",6056,"KRN","B",8989.51,8989.51)

"BLD",6056,"KRN","B",8989.52,8989.52)

"BLD",6056,"KRN","B",8994,8994)

"BLD",6056,"QUES",0)
^9.62^^
"BLD",6056,"REQB",0)
^9.611^2^2
"BLD",6056,"REQB",1,0)
DG*5.3*590^1
"BLD",6056,"REQB",2,0)
DG*5.3*510^1
"BLD",6056,"REQB","B","DG*5.3*510",2)

"BLD",6056,"REQB","B","DG*5.3*590",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
636^3050727
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3050727
"PKG",5,22,1,"PAH",1,1,1,0)
This patch corrects a problem when coding the 501 or MAS screen in
"PKG",5,22,1,"PAH",1,1,2,0)
  the Load/Edit PTF Data [DG PTF SCREEN] option.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DGPTFJC")
0^1^B46654954
"RTN","DGPTFJC",1,0)
DGPTFJC ;ALB/ADL - CLOSED PTF ; 6/3/05 6:22pm
"RTN","DGPTFJC",2,0)
 ;;5.3;Registration;**158,510,517,590,636**;Aug 13, 1993
"RTN","DGPTFJC",3,0)
 ;;ADL;;Update for CSV Project;;Mar 25, 2003
"RTN","DGPTFJC",4,0)
101 W !,"Enter '^N' for Screen N, RETURN for <MAS>,'^' to Abort: <MAS>//"
"RTN","DGPTFJC",5,0)
 D READ G Q^DGPTF:X=U,^DGPTFM:X="",^DGPTFJ:X?1"^".E D H G 101
"RTN","DGPTFJC",6,0)
 ;
"RTN","DGPTFJC",7,0)
H D HELP^DGPTFJ W ! Q
"RTN","DGPTFJC",8,0)
 ;
"RTN","DGPTFJC",9,0)
MAS W !!,"Enter '^N' for Screen N, RETURN for <",DGNUM,">,'^' to Abort: <",DGNUM,">//"
"RTN","DGPTFJC",10,0)
 D READ G Q^DGPTF:X=U,^DGPTFJ:X?1"^".E
"RTN","DGPTFJC",11,0)
 I X="" S (ST,ST1)=J+2 G @($S($D(DGZDIAG):"NDG",$D(DGZSER):"NSR",$D(DGZPRO):"NPR",$D(DGZSUR):"EN",+DGZPRF-1'=$P(DGZPRF,U,3):"NPS",1:"DONE")_"^DGPTFM")
"RTN","DGPTFJC",12,0)
 D H G MAS
"RTN","DGPTFJC",13,0)
 ;
"RTN","DGPTFJC",14,0)
401 S DGNUM=$S($D(S(DGZS0+1)):401_"-"_(DGZS0+1),1:"MAS")
"RTN","DGPTFJC",15,0)
 W !,"Enter '^N' for Screen N, RETURN for <",DGNUM,">,'^' to Abort: <",DGNUM,">//"
"RTN","DGPTFJC",16,0)
 D READ G Q^DGPTF:X=U,NEXM^DGPTFM5:X="",^DGPTFJ:X?1"^".E D H G 401
"RTN","DGPTFJC",17,0)
 ;
"RTN","DGPTFJC",18,0)
501 W !,"Enter '^N' for Screen N, RETURN for <",DGNUM,">,'^' to Abort: <",DGNUM,">//"
"RTN","DGPTFJC",19,0)
 D READ G Q^DGPTF:X=U,NEXM^DGPTFM4:X="",^DGPTFJ:X?1"^".E D H G 501
"RTN","DGPTFJC",20,0)
 ;
"RTN","DGPTFJC",21,0)
601 W !,"Enter '^N' for Screen N, RETURN for <",DGNUM,">,'^' to Abort: <",DGNUM,">//"
"RTN","DGPTFJC",22,0)
 D READ G Q^DGPTF:X=U,NEXP^DGPTFM6:X="",^DGPTFJ:X?1"^".E D H G 601
"RTN","DGPTFJC",23,0)
 ;
"RTN","DGPTFJC",24,0)
701 ;
"RTN","DGPTFJC",25,0)
 G ACT1^DGPTF41 ; new code
"RTN","DGPTFJC",26,0)
 ;
"RTN","DGPTFJC",27,0)
 ;Display screen prompt and process user response for 801 screen
"RTN","DGPTFJC",28,0)
801 W !,"Enter '^N' for Screen N, RETURN for <",DGNUM,">,'^' to Abort: <",DGNUM,">//"
"RTN","DGPTFJC",29,0)
 D READ G Q^DGPTF:X=U,NEXP^DGPTFM2:X="",^DGPTFJ:X?1"^".E D H G 801
"RTN","DGPTFJC",30,0)
READ ; -- read X
"RTN","DGPTFJC",31,0)
 R X:DTIME S:'$T X="^",DGPTOUT=""
"RTN","DGPTFJC",32,0)
 Q
"RTN","DGPTFJC",33,0)
 ;
"RTN","DGPTFJC",34,0)
EN ; DG*636
"RTN","DGPTFJC",35,0)
 ;;S K=$S($D(K):K,1:1),DGER=0 S DGPTDAT=$$GETDATE^ICDGTDRG(DA(1)),DGPTTMP=$$ICDDX^ICDCODE(+Y,DGPTDAT) I +DGPTTMP=-1!('$P(DGPTTMP,U,10)) S DGER=1 Q
"RTN","DGPTFJC",36,0)
 S K=$S($D(K):K,1:1),DGER=0 S DGPTDAT=$$GETDATE^ICDGTDRG(DA(1))
"RTN","DGPTFJC",37,0)
 ;if there is a disch and a previous movement, if disch
"RTN","DGPTFJC",38,0)
 ;is >Oct 1 (next FY) and movement <Oct 1, then use the movement date
"RTN","DGPTFJC",39,0)
 N DGPTMVDT I DGPTDAT=$P($G(^DGPT(DA(1),70)),U,1)&(DGPTDAT=$P($G(^DGPT(DA(1),"M",1,0)),U,10))&($D(M(DGZM0)))&($P($G(M(DGZM0)),U)'=1) S DGPTMVDT=$P($G(^DGPT(DA(1),"M",2,0)),U,10)
"RTN","DGPTFJC",40,0)
 ;next line is if using "Add a code" in MAS screen
"RTN","DGPTFJC",41,0)
 I '$G(DGPTMVDT)&($D(DGADD))&($G(DGMOV)'=1) S DGPTMVDT=$P($G(^DGPT(DA(1),"M",2,0)),U,10)
"RTN","DGPTFJC",42,0)
 I $G(DGPTMVDT) D
"RTN","DGPTFJC",43,0)
 .;if same calendar year
"RTN","DGPTFJC",44,0)
 .I $E(DGPTDAT,1,3)=$E(DGPTMVDT,1,3),$E(DGPTDAT,4,7)>0930,$E(DGPTMVDT,4,7)<1001 S DGPTDAT=DGPTMVDT Q
"RTN","DGPTFJC",45,0)
 .;if different calendar year
"RTN","DGPTFJC",46,0)
 .I ($E(DGPTDAT,1,3)-$E(DGPTMVDT,1,3))>1 S DGPTDAT=DGPTMVDT Q
"RTN","DGPTFJC",47,0)
 .I $E(DGPTMVDT,4,7)<1001 S DGPTDAT=DGPTMVDT Q
"RTN","DGPTFJC",48,0)
 .I $E(DGPTDAT,4,7)>0930 S DGPTDAT=DGPTMVDT Q
"RTN","DGPTFJC",49,0)
 S DGPTTMP=$$ICDDX^ICDCODE(+Y,DGPTDAT) I +DGPTTMP=-1!('$P(DGPTTMP,U,10)) S DGER=1 Q
"RTN","DGPTFJC",50,0)
 ;end DG*636
"RTN","DGPTFJC",51,0)
 ;===================================================================
"RTN","DGPTFJC",52,0)
 I $P(DGPTTMP,U,11)]""&($P(DGPTTMP,U,11)'=$S($D(^DPT(+^DGPT(DA(1),0),0)):$P(^(0),U,2),1:"M")) W:K<24 !,$P(DGPTTMP,U,2)," can only be used with ",$S($P(DGPTTMP,U,11)="F":"FEMALES",1:"MALES") S K=K+1,DGER=1 Q
"RTN","DGPTFJC",53,0)
 S %=$P(^DGPT(DA(1),"M",DA,0),U,DGI) I $D(^DGPT(DA(1),"M","AC",Y,DA)),%'=Y S DGER=1 Q
"RTN","DGPTFJC",54,0)
 F I=0:0 S I=$O(^ICD9(+Y,"N",I)) Q:I'>0  I $D(^DGPT(DA(1),"M","AC",I,DA)),%'=I W !,"Cannot use ",$S($D(^ICD9(+Y,0)):$P(^(0),U),1:""),"  with ",$S($D(^ICD9(I,0)):$P(^(0),U),1:"") S DGER=1 Q
"RTN","DGPTFJC",55,0)
 Q:DGER  S DG1=1 F I=0:0 S I=$O(^ICD9(+Y,"R",I)) Q:I'>0  S DG1=0 I $D(^DGPT(DA(1),"M","AC",I,DA)),%'=I S DG1=1 Q
"RTN","DGPTFJC",56,0)
 I 'DG1 W !,$S(+DGPTTMP>0&('$P(DGPTTMP,U,10)):$P(DGPTTMP,U,2),1:"")," requires additional code."
"RTN","DGPTFJC",57,0)
 Q
"RTN","DGPTFJC",58,0)
EN1 S K=$S($D(K):K,1:1),DGER=0,DGPTDAT=$$GETDATE^ICDGTDRG(DA(1)),DGICD0=$$ICDOP^ICDCODE(+Y,DGPTDAT) I +DGICD0,0!('$P(DGICD0,U,10)) S DGER=1 Q
"RTN","DGPTFJC",59,0)
 I $P(DGICD0,U,11)]""&($P(DGICD0,U,11)'=$S($D(^DPT(+^DGPT(DA(1),0),0)):$P(^(0),U,2),1:"M")) W:K<24 !,$P(DGICD0,U,2)," can only be used with ",$S($P(DGICD0,U,11)="F":"FEMALES",1:"MALES") S K=K+1,DGER=1 Q
"RTN","DGPTFJC",60,0)
 S %=$P(^DGPT(DA(1),DGSB,DA,0),U,DGI) I $D(^DGPT(DA(1),DGSB,DGCR,Y,DA)),%'=Y S DGER=1 W !,"Cannot enter the same code more than once within a ",$S(DGSB="S":"401",1:"601")," transaction" Q
"RTN","DGPTFJC",61,0)
 F I=0:0 S I=$O(^ICD0(+Y,"N",I)) Q:I'>0  I $D(^DGPT(DA(1),DGSB,DGCR,I,DA)),%'=I S DGPTTMP2=$$ICDOP^ICDCODE(I,DGPTDAT) W !,"Cannot use ",$P(DGICD0,U,2),"  with ",$S(+DGPTTMP2>0:$P(DGPTTMP2,U,2),1:"") S DGER=1 Q
"RTN","DGPTFJC",62,0)
 Q:DGER  S DG1=1 F I=0:0 S I=$O(^ICD0(+Y,"R",I)) Q:I'>0  S DG1=0 I $D(^DGPT(DA(1),DGSB,DGCR,I,DA)),%'=I S DG1=1 Q
"RTN","DGPTFJC",63,0)
 I 'DG1 W !,$P(DGICD0,U,2)," requires additional code."
"RTN","DGPTFJC",64,0)
 Q
"RTN","DGPTFJC",65,0)
EN2 S K=$S($D(K):K,1:1),DGER=0,DGPTTMP=$$ICDOP^ICDCODE(+Y,$$GETDATE^ICDGTDRG(DA)) I +DGPTTMP<0!('$P(DGPTTMP,U,10)) S DGER=1 Q
"RTN","DGPTFJC",66,0)
 I $P(DGPTTMP,U,11)]""&($P(DGPTTMP,U,11)'=$S($D(^DPT(+^DGPT(DA,0),0)):$P(^(0),U,2),1:"M")) W:K<24 !,$P(DGPTTMP,U,2)," can only be used with ",$S($P(DGPTTMP,U,11)="F":"FEMALES",1:"MALES") S K=K+1,DGER=1 Q
"RTN","DGPTFJC",67,0)
 S L=$P($S($D(^DGPT((DA),"401P")):^("401P"),1:0),U,1,5),%=$P(L,U,DGI),L=$P(L,U,1,DGI-1)_U_$P(L,U,DGI+1,5) I L[Y S DGER=1 Q
"RTN","DGPTFJC",68,0)
 Q
"RTN","DGPTFJC",69,0)
EN3 S K=$S($D(K):K,1:1),DGER=0,DGPTTMP=$$ICDDX^ICDCODE(+Y,$$GETDATE^ICDGTDRG(DA)) I +DGPTTMP<0!('$P(DGPTTMP,U,10)) S DGER=1 Q
"RTN","DGPTFJC",70,0)
 I DGI=1,$P(DGPTTMP,U,5) S DGER=1 Q
"RTN","DGPTFJC",71,0)
 I $P(DGPTTMP,U,11)]""&($P(DGPTTMP,U,11)'=$S($D(^DPT(+^DGPT(DA,0),0)):$P(^(0),U,2),1:"M")) W:K<24 !,$P(DGPTTMP,U,2)," can only be used with ",$S($P(DGPTTMP,U,11)="F":"FEMALES",1:"MALES") S K=K+1,DGER=1 Q
"RTN","DGPTFJC",72,0)
 S %=$S($D(^DGPT(DA,70)):^(70),1:""),%=U_$P(%,U,10)_U_$P(%,U,16,24)_U
"RTN","DGPTFJC",73,0)
 S:$G(^DGPT(DA,71))'="" %=%_^(71)_U S $P(%,U,DGI+1)=U I %[(U_+Y_U) S DGER=1 Q
"RTN","DGPTFJC",74,0)
 F I=0:0 S I=$O(^ICD9(+Y,"N",I)) Q:I'>0  I %[(U_I_U) S DGPTTMP2=$$ICDDX^ICDCODE(I,DGPTDAT) W !,"Cannot use ",$P($G(DGPTTMP),U,2),"  with ",$S(+DGPTTMP2>0:$P(DGPTTMP2,U,2),1:"") S DGER=1 Q
"RTN","DGPTFJC",75,0)
 Q:DGER  S DG1=1 F I=0:0 S I=$O(^ICD9(+Y,"R",I)) Q:I'>0  S DG1=0 I %[(U_I_U) S DG1=1 Q
"RTN","DGPTFJC",76,0)
 I 'DG1 W !,$S(+DGPTTMP>0:$P(DGPTTMP,U,2),1:"")," requires additional code."
"RTN","DGPTFJC",77,0)
 Q
"RTN","DGPTFJC",78,0)
EN4 S K=$S($D(K):K,1:1),DGER=0,N=$$ICDDX^ICDCODE(+Y,$$GETDATE^ICDGTDRG(DA)) I N<0!'$P(N,U,10) S DGER=1 Q
"RTN","DGPTFJC",79,0)
 I DGI=1,$P(N,U,5) S DGER=1 Q
"RTN","DGPTFJC",80,0)
 I $P(N,U,11)]""&($P(N,U,11)'=$S($D(^DPT(+^DGPT(DA(2),0),0)):$P(^(0),U,2),1:"M")) W:K<24 !,$P(N,U,2)," can only be used with ",$S($P(N,U,11)="F":"FEMALES",1:"MALES") S K=K+1,DGER=1 Q
"RTN","DGPTFJC",81,0)
 S %=$S($D(^DGPT(DA(2),"C",DA(1),"CPT",DA,0)):^(0),1:""),%=U_$P(%,U,4,7)_U,$P(%,U,DGI+1)=U I %[(U_+Y_U) S DGER=1 Q
"RTN","DGPTFJC",82,0)
 F I=0:0 S I=$O(^ICD9(+Y,"N",I)) Q:I'>0  I %[(U_I_U) W !,"Cannot use ",$S($D(^ICD9(+Y,0)):$P(^(0),U),1:""),"  with ",$S($D(^ICD9(I,0)):$P(^(0),U),1:"") S DGER=1 Q
"RTN","DGPTFJC",83,0)
 Q:DGER  S DG1=1 F I=0:0 S I=$O(^ICD9(+Y,"R",I)) Q:I'>0  S DG1=0 I %[(U_I_U) S DG1=1 Q
"RTN","DGPTFJC",84,0)
 I 'DG1 W !,$P(N,U,2)," requires additional code."       Q
"RTN","DGPTFJC",85,0)
 Q
"RTN","DGPTFJC",86,0)
EN5 S K=$S($D(K):K,1:1),DGER=0,DGPTTMP=$$ICDDX^ICDCODE(+Y,+DGZPRF(DGZP)) I +DGPTTMP<0!('$P(DGPTTMP,U,10)) S DGER=1 Q
"RTN","DGPTFJC",87,0)
 I $P(DGPTTMP,U,11)]""&($P(DGPTTMP,U,11)'=$S($D(^DPT(+^DGPT(PTF,0),0)):$P(^(0),U,2),1:"M")) W:K<24 !,$P(DGPTTMP,U,2)," can only be used with ",$S($P(DGPTTMP,U,11)="F":"FEMALES",1:"MALES") S K=K+1,DGER=1 Q
"RTN","DGPTFJC",88,0)
 S K=^DGCPT(46,DA,0) I $P(K,U,4,7)_U_$P(K,U,15,18)[Y S DGER=1 Q
"RTN","DGPTFJC",89,0)
 Q
"RTN","DGPTFJC",90,0)
EN6 I $P($G(^(0)),U,2)?.N S DGER=1 Q
"RTN","DGPTFJC",91,0)
 S DGER=0,N=$$CPT^ICPTCOD(+Y,$$GETDATE^ICDGTDRG(DA)) I N<0!'$P(N,"^",7) S DGER=1 Q
"RTN","DGPTFJC",92,0)
 S L=0 F  S L=$O(^DGCPT(46,L)) Q:L'>0  I +$G(^(L,1))=DGPRD,$P(^(1),U,3)=PTF,+^(0)=Y S DGER=1 Q
"RTN","DGPTFJC",93,0)
 K L Q
"RTN","DGPTR2")
0^2^B17037574
"RTN","DGPTR2",1,0)
DGPTR2 ;ALB/JDS/MJK/MTC/ADL - ALB/BOK  PTF TRANSMISSION ; 6/6/05 11:48am
"RTN","DGPTR2",2,0)
 ;;5.3;Registration;**183,338,423,510,636**;Aug 13, 1993
"RTN","DGPTR2",3,0)
 ;;ADL;Update for CSV Project;;Mar 27,2003
"RTN","DGPTR2",4,0)
501 ; -- setup 501 transactions
"RTN","DGPTR2",5,0)
 ; DG*636
"RTN","DGPTR2",6,0)
 N DGPTMVDT
"RTN","DGPTR2",7,0)
 K DGCMVT I T2'=9999999 S DGCMVT=$O(^DGPT(J,"M","AM",+$P(T2,".")_".2359")),DGCMVT=$S('DGCMVT:1,$O(^(DGCMVT,0)):$O(^(0)),1:1)
"RTN","DGPTR2",8,0)
 F I=0:0 S I=$O(^DGPT(J,"M",I)) G 535:I'>0 I $D(^(I,0)) D
"RTN","DGPTR2",9,0)
 . S DGM=^(0),DGSC=$P(DGM,U,18),DGAO=$P(DGM,U,26),DGIR=$P(DGM,U,27),DGEC=$P(DGM,U,28),DGMST=$P(DGM,U,29),DGHNC=$P(DGM,U,30),DGTD=$P(DGM,U,10),DGPTMVDT=$P(DGM,U,10)
"RTN","DGPTR2",10,0)
 . S:$D(DGCMVT) DGTD=$S(I=DGCMVT:$P(T2,".")_".2359",1:DGTD)
"RTN","DGPTR2",11,0)
 . I $P(DGM,U,17)'="n",DGTD,DGTD'<T1,DGTD'>T2 D MOV
"RTN","DGPTR2",12,0)
MOV S DGCDR=$P(DGM,U,16),DGM=$P(DGM,U,1,9)_U_$P(DGM,U,11,15),L=1 F Z=5:1:14 S:'$P(DGM,U,Z) DGM=$P(DGM,U,1,Z-1)_U_$P(DGM,U,Z+1,99) S:'$P(DGM,U,Z) Z=Z-1 S L=L+1 Q:L=10
"RTN","DGPTR2",13,0)
 S Y=$S(T1:"C",1:"N")_"501"_DGHEAD,X=$P(DGTD,".")_"       ",Y=Y_$E(X,4,5)_$E(X,6,7)_$E(X,2,3)_$E($P(DGTD,".",2)_"0000",1,4)
"RTN","DGPTR2",14,0)
 S Z=DGCDR D CDR
"RTN","DGPTR2",15,0)
 S L=2,X=DGM,Z=2 D ENTER0
"RTN","DGPTR2",16,0)
 ; convert pass, leave days >999 to 999
"RTN","DGPTR2",17,0)
 S L=3 F Z=3,4 S:$P(X,U,Z)>999 $P(X,U,Z)=999 D ENTER0
"RTN","DGPTR2",18,0)
 S L=1,X=DG57,Z=4 D ENTER S:I=1 DG502=Y
"RTN","DGPTR2",19,0)
 F Z=5:1:9 S DGPTTMP=$$ICDDX^ICDCODE($P(DGM,U,Z),$G(DGPTMVDT)) D
"RTN","DGPTR2",20,0)
 . S F=$S(+DGPTTMP>0&($P(DGPTTMP,U,10)):$P(DGPTTMP,U,2),1:"   ."),F=$P(F,".",1)_$E($P(F,".",2)_"    ",1,3),F=F_$E("      ",1,7-$L(F)),Y=Y_F
"RTN","DGPTR2",21,0)
 S Y=Y_"         "
"RTN","DGPTR2",22,0)
 S X=""
"RTN","DGPTR2",23,0)
 I 'T1 S Z=$S(I=1:+$O(^DGPT(J,535,"ADC",0)),1:+$O(^DGPT(J,535,"AM",DGTD-.0000001))) I $D(^DGPT(J,535,+$O(^(Z,0)),0)) S X=^(0)
"RTN","DGPTR2",24,0)
 I T1 S Z=+$O(^DGPT(J,535,"AM",DGTD-.0000001)) S:'Z Z=+$O(^DGPT(J,535,"ADC",0)) I $D(^DGPT(J,535,+$O(^(Z,0)),0)) S X=^(0)
"RTN","DGPTR2",25,0)
 S Z=$P(X,U,16) D CDR
"RTN","DGPTR2",26,0)
 S L=2,Z=2 D ENTER0
"RTN","DGPTR2",27,0)
 ; bed occupant
"RTN","DGPTR2",28,0)
 I T1 S Y=Y_$S(I=1:$E($P(DG70,U,14)_" "),$P(+DGTD,".")=$P(T2,"."):5,1:1)
"RTN","DGPTR2",29,0)
 I 'T1 S Y=Y_$S(I=1:$E($P(DG70,U,14)_" "),1:" ")
"RTN","DGPTR2",30,0)
 ;-- additional ptf questions
"RTN","DGPTR2",31,0)
 S DGAUX=$S($D(^DGPT(J,"M",I,300)):^(300),1:"")
"RTN","DGPTR2",32,0)
 D ADDQUES
"RTN","DGPTR2",33,0)
 ;-- sc related care
"RTN","DGPTR2",34,0)
 S Y=Y_$E(DGSC_" ")
"RTN","DGPTR2",35,0)
 ;-- ao related care
"RTN","DGPTR2",36,0)
 S Y=Y_$E(DGAO_" ")
"RTN","DGPTR2",37,0)
 ;-- ir related care
"RTN","DGPTR2",38,0)
 S Y=Y_$E(DGIR_" ")
"RTN","DGPTR2",39,0)
 ;-- ec related care
"RTN","DGPTR2",40,0)
 S Y=Y_$E(DGEC_" ")
"RTN","DGPTR2",41,0)
 ;-- mst related care
"RTN","DGPTR2",42,0)
 S Y=Y_$E(DGMST_" ")
"RTN","DGPTR2",43,0)
 ;-- Head/Neck CA related care
"RTN","DGPTR2",44,0)
 S Y=Y_$E(DGHNC_" ")
"RTN","DGPTR2",45,0)
 K DGAUX,DGDRUG,DGSC,DGAO,DGIR,DGEC,DGMST,DGHNC
"RTN","DGPTR2",46,0)
 D FILL^DGPTR2,SAVE
"RTN","DGPTR2",47,0)
 Q
"RTN","DGPTR2",48,0)
535 ; -- do 535's
"RTN","DGPTR2",49,0)
 D 535^DGPTR3
"RTN","DGPTR2",50,0)
 ;
"RTN","DGPTR2",51,0)
PROC ; -- setup 601 transactions
"RTN","DGPTR2",52,0)
 K ^UTILITY($J,"PROC") S I=0
"RTN","DGPTR2",53,0)
601 S I=$O(^DGPT(J,"P",I)) G 701:I'>0 S (X,DGPROC)=^(I,0) G 601:'DGPROC
"RTN","DGPTR2",54,0)
 G 601:DGPROC<T1!(DGPROC>T2) S DGPROCD=+^DGPT(J,"P",I,0),^UTILITY($J,"PROC",DGPROCD)=$S($D(^UTILITY($J,"PROC",DGPROCD)):^(DGPROCD),1:0)+1
"RTN","DGPTR2",55,0)
 I ^UTILITY($J,"PROC",DGPROCD)>1 W !,"More than one procedure record on same date/time" S DGERR=1 Q
"RTN","DGPTR2",56,0)
 S Y=$S('T1:"N",1:"C")_"60"_^(DGPROCD)_DGHEAD_$E(DGPROCD,4,7)_$E(DGPROCD,2,3)_$E($P(+X,".",2)_"0000",1,4) S L=2,Z=2 D ENTER0 S L=1,Z=3 D ENTER S L=3,Z=4 D ENTER0
"RTN","DGPTR2",57,0)
 S L=1 F K=5:1:9 S:'$P(DGPROC,U,K) DGPROC=$P(DGPROC,U,1,K-1)_U_$P(DGPROC,U,K+1,99),K=K-1 S L=L+1 Q:L=5
"RTN","DGPTR2",58,0)
 F K=5:1:9 S DGPTTMP=$$ICDOP^ICDCODE(+$P(DGPROC,U,K),$$GETDATE^ICDGTDRG(J)) D
"RTN","DGPTR2",59,0)
 . S Y=Y_$S(+DGPTTMP>0&($P(DGPTTMP,U,10)):$J($P($P(DGPTTMP,U,2),".",1),2)_$E($P($P(DGPTTMP,U,2),".",2)_"   ",1,3),1:"     ")_"  "
"RTN","DGPTR2",60,0)
 D FILL,SAVE G 601
"RTN","DGPTR2",61,0)
 Q
"RTN","DGPTR2",62,0)
 ;
"RTN","DGPTR2",63,0)
701 ; -- setup 701 transaction
"RTN","DGPTR2",64,0)
 D 701^DGPTR4 Q
"RTN","DGPTR2",65,0)
 ;
"RTN","DGPTR2",66,0)
ENTER S Y=Y_$J($P(X,U,Z),L)
"RTN","DGPTR2",67,0)
 Q
"RTN","DGPTR2",68,0)
 ;
"RTN","DGPTR2",69,0)
ENTER0 S Y=Y_$S($P(X,U,Z)]"":$E("00000",$L($P(X,U,Z))+1,L)_$P(X,U,Z),1:$J($P(X,U,Z),L))
"RTN","DGPTR2",70,0)
 Q
"RTN","DGPTR2",71,0)
 ;
"RTN","DGPTR2",72,0)
SAVE D START^DGPTR1 S:'DGERR ^XMB(3.9,DGXMZ,2,DGCNT,0)=Y,DGCNT=DGCNT+1
"RTN","DGPTR2",73,0)
 I DGERR'>0 S DGACNT=DGACNT+1,^TMP("AEDIT",$J,$E(Y,1,4),DGACNT)=Y
"RTN","DGPTR2",74,0)
Q Q
"RTN","DGPTR2",75,0)
 ;
"RTN","DGPTR2",76,0)
FILL F K=$L(Y):1:124 S Y=Y_" "
"RTN","DGPTR2",77,0)
 Q
"RTN","DGPTR2",78,0)
 ;
"RTN","DGPTR2",79,0)
CDR S Y=Y_$E($P(Z,".")_"0000",1,4)_$E($P(Z,".",2)_"00",1,2)
"RTN","DGPTR2",80,0)
 Q
"RTN","DGPTR2",81,0)
ADDQUES ;-- additional PTF questions load records for trans 501/701
"RTN","DGPTR2",82,0)
 S DGDRUG=$S($D(^DIC(45.61,+$P(DGAUX,U,4),0)):$P(^(0),U,2),1:"    ")
"RTN","DGPTR2",83,0)
 S Y=Y_$E($P(DGAUX,U,3)_" ")_$E($P(DGAUX,U,2)_" ")_$J($P(DGDRUG,U),4)
"RTN","DGPTR2",84,0)
 S Y=Y_$E($P(DGAUX,U,5)_" ")
"RTN","DGPTR2",85,0)
 S DGT=0,X=$P(DGAUX,U,6) I X]"" S DGT=1,Z=1,L=2 D ENTER0
"RTN","DGPTR2",86,0)
 I 'DGT S Y=Y_"  "
"RTN","DGPTR2",87,0)
 S DGT=0,X=$P(DGAUX,U,7) I X]"" S DGT=1,Z=1,L=2 D ENTER0
"RTN","DGPTR2",88,0)
 I 'DGT S Y=Y_"  "
"RTN","DGPTR2",89,0)
 Q
"VER")
8.0^22.0
"BLD",6056,6)
^SEQ #578
**END**
**END**
