Released EC*2*46 SEQ #44
Extracted from mail message
**KIDS**:EC*2.0*46^

**INSTALL NAME**
EC*2.0*46
"BLD",4457,0)
EC*2.0*46^EVENT CAPTURE^0^3030311^y
"BLD",4457,1,0)
^^1^1^3020318^^^^
"BLD",4457,1,1,0)
National Procedure Update (File #725).
"BLD",4457,4,0)
^9.64PA^^
"BLD",4457,"ABPKG")
n
"BLD",4457,"INID")
^
"BLD",4457,"INIT")

"BLD",4457,"KRN",0)
^9.67PA^8989.52^20
"BLD",4457,"KRN",.4,0)
.4
"BLD",4457,"KRN",.401,0)
.401
"BLD",4457,"KRN",.402,0)
.402
"BLD",4457,"KRN",.403,0)
.403
"BLD",4457,"KRN",.5,0)
.5
"BLD",4457,"KRN",.84,0)
.84
"BLD",4457,"KRN",3.6,0)
3.6
"BLD",4457,"KRN",3.8,0)
3.8
"BLD",4457,"KRN",9.2,0)
9.2
"BLD",4457,"KRN",9.8,0)
9.8
"BLD",4457,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4457,"KRN",9.8,"NM",1,0)
ECUERPC^^0^B48478010
"BLD",4457,"KRN",9.8,"NM",2,0)
ECUMRPC2^^0^B18572772
"BLD",4457,"KRN",9.8,"NM",3,0)
ECUERPC1^^0^B54155202
"BLD",4457,"KRN",9.8,"NM","B","ECUERPC",1)

"BLD",4457,"KRN",9.8,"NM","B","ECUERPC1",3)

"BLD",4457,"KRN",9.8,"NM","B","ECUMRPC2",2)

"BLD",4457,"KRN",19,0)
19
"BLD",4457,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",4457,"KRN",19,"NM",1,0)
EC GUI CONTEXT^^0
"BLD",4457,"KRN",19,"NM","B","EC GUI CONTEXT",1)

"BLD",4457,"KRN",19.1,0)
19.1
"BLD",4457,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4457,"KRN",101,0)
101
"BLD",4457,"KRN",101,"NM",0)
^9.68A^^
"BLD",4457,"KRN",409.61,0)
409.61
"BLD",4457,"KRN",771,0)
771
"BLD",4457,"KRN",869.2,0)
869.2
"BLD",4457,"KRN",870,0)
870
"BLD",4457,"KRN",8989.51,0)
8989.51
"BLD",4457,"KRN",8989.52,0)
8989.52
"BLD",4457,"KRN",8994,0)
8994
"BLD",4457,"KRN",8994,"NM",0)
^9.68A^2^2
"BLD",4457,"KRN",8994,"NM",1,0)
EC GETLOC^^0
"BLD",4457,"KRN",8994,"NM",2,0)
EC GETPATPROCS^^0
"BLD",4457,"KRN",8994,"NM","B","EC GETLOC",1)

"BLD",4457,"KRN",8994,"NM","B","EC GETPATPROCS",2)

"BLD",4457,"KRN","B",.4,.4)

"BLD",4457,"KRN","B",.401,.401)

"BLD",4457,"KRN","B",.402,.402)

"BLD",4457,"KRN","B",.403,.403)

"BLD",4457,"KRN","B",.5,.5)

"BLD",4457,"KRN","B",.84,.84)

"BLD",4457,"KRN","B",3.6,3.6)

"BLD",4457,"KRN","B",3.8,3.8)

"BLD",4457,"KRN","B",9.2,9.2)

"BLD",4457,"KRN","B",9.8,9.8)

"BLD",4457,"KRN","B",19,19)

"BLD",4457,"KRN","B",19.1,19.1)

"BLD",4457,"KRN","B",101,101)

"BLD",4457,"KRN","B",409.61,409.61)

"BLD",4457,"KRN","B",771,771)

"BLD",4457,"KRN","B",869.2,869.2)

"BLD",4457,"KRN","B",870,870)

"BLD",4457,"KRN","B",8989.51,8989.51)

"BLD",4457,"KRN","B",8989.52,8989.52)

"BLD",4457,"KRN","B",8994,8994)

"BLD",4457,"QUES",0)
^9.62^^
"BLD",4457,"REQB",0)
^9.611^1^1
"BLD",4457,"REQB",1,0)
EC*2.0*42^2
"BLD",4457,"REQB","B","EC*2.0*42",1)

"KRN",19,11187,-1)
0^1
"KRN",19,11187,0)
EC GUI CONTEXT^EC GUI Context^^B^^^^^^^^EVENT CAPTURE
"KRN",19,11187,1,0)
^19.06^1^1^3020424^^^^
"KRN",19,11187,1,1,0)
This is the Broker Client/Server type option for the Event Capture GUI option
"KRN",19,11187,99)
58583,58456
"KRN",19,11187,99.1)
58981,55862
"KRN",19,11187,"RPC",0)
^19.05P^51^51
"KRN",19,11187,"RPC",1,0)
EC DSSCATCHECK
"KRN",19,11187,"RPC",2,0)
EC FILER
"KRN",19,11187,"RPC",3,0)
EC GETBATPROCS
"KRN",19,11187,"RPC",4,0)
EC GETCAT
"KRN",19,11187,"RPC",5,0)
EC GETCPTLST
"KRN",19,11187,"RPC",6,0)
EC GETDSSECS
"KRN",19,11187,"RPC",7,0)
EC GETDSSUNIT
"KRN",19,11187,"RPC",8,0)
EC GETDSSUNITUSRS
"KRN",19,11187,"RPC",9,0)
EC GETECLOC
"KRN",19,11187,"RPC",10,0)
EC GETECSCATS
"KRN",19,11187,"RPC",11,0)
EC GETECSCREEN
"KRN",19,11187,"RPC",12,0)
EC GETECSDETAIL
"KRN",19,11187,"RPC",13,0)
EC GETECSPROCS
"KRN",19,11187,"RPC",14,0)
EC GETENCDXS
"KRN",19,11187,"RPC",15,0)
EC GETIEN
"KRN",19,11187,"RPC",16,0)
EC GETLIST
"KRN",19,11187,"RPC",17,0)
EC GETLOC
"KRN",19,11187,"RPC",18,0)
EC GETNATPX
"KRN",19,11187,"RPC",19,0)
EC GETPATCLASTAT
"KRN",19,11187,"RPC",20,0)
EC GETPATELIG
"KRN",19,11187,"RPC",21,0)
EC GETPATINFO
"KRN",19,11187,"RPC",22,0)
EC GETPATPROCS
"KRN",19,11187,"RPC",23,0)
EC GETPRODEFS
"KRN",19,11187,"RPC",24,0)
EC GETPROVIDER
"KRN",19,11187,"RPC",25,0)
EC GETPXLST
"KRN",19,11187,"RPC",26,0)
EC GETPXMODIFIER
"KRN",19,11187,"RPC",27,0)
EC GETPXREASON
"KRN",19,11187,"RPC",28,0)
EC GETSCNHELP
"KRN",19,11187,"RPC",29,0)
EC GETUSRDSSUNIT
"KRN",19,11187,"RPC",30,0)
EC REPORTS
"KRN",19,11187,"RPC",31,0)
EC VALIDATE SPREADSHEET DATA
"KRN",19,11187,"RPC",32,0)
ORWU USERINFO
"KRN",19,11187,"RPC",33,0)
ORWU HASKEY
"KRN",19,11187,"RPC",34,0)
ORWU DEVICE
"KRN",19,11187,"RPC",35,0)
SC PATIENT LOOKUP
"KRN",19,11187,"RPC",36,0)
ORWU NEWPERS
"KRN",19,11187,"RPC",37,0)
DDR GET DD HELP
"KRN",19,11187,"RPC",38,0)
DDR FINDER
"KRN",19,11187,"RPC",39,0)
DDR FIND1
"KRN",19,11187,"RPC",40,0)
DDR LISTER
"KRN",19,11187,"RPC",41,0)
EC GETDATE
"KRN",19,11187,"RPC",42,0)
EC CLASHELP
"KRN",19,11187,"RPC",43,0)
DDR GETS ENTRY DATA
"KRN",19,11187,"RPC",44,0)
DG CHK BS5 XREF Y/N
"KRN",19,11187,"RPC",45,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,11187,"RPC",46,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,11187,"RPC",47,0)
DG CHK PAT/DIV MEANS TEST
"KRN",19,11187,"RPC",48,0)
EC SPACEBAR
"KRN",19,11187,"RPC",49,0)
EC DIEDON
"KRN",19,11187,"RPC",50,0)
EC GETPATCH
"KRN",19,11187,"RPC",51,0)
EC GETVISITINFO
"KRN",19,11187,"U")
EC GUI CONTEXT
"KRN",8994,820,-1)
0^2
"KRN",8994,820,0)
EC GETPATPROCS^PATPROC^ECUERPC^4^R^^^1
"KRN",8994,820,1,0)
^8994.01^2^2^3030306^^^^
"KRN",8994,820,1,1,0)
Returns an array of patient entries from EVENT CAPTURE PATIENT FILE #721 that 
"KRN",8994,820,1,2,0)
matches a location, DSS unit, patient DFN, start date and end date.
"KRN",8994,820,2,0)
^8994.02A^1^1
"KRN",8994,820,2,1,0)
ECARY^1^^1
"KRN",8994,820,2,1,1,0)
^8994.021^6^6^3030306^^^^
"KRN",8994,820,2,1,1,1,0)
Input variable ECARY contains the following values separated by up-arrows:-
"KRN",8994,820,2,1,1,2,0)
  1.  ECLOC  - Location ien
"KRN",8994,820,2,1,1,3,0)
  2.  ECPAT  - Patient DFN ien
"KRN",8994,820,2,1,1,4,0)
  3.  ECUNT  - DSS unit ien
"KRN",8994,820,2,1,1,5,0)
  4.  ECSD   - Start Date
"KRN",8994,820,2,1,1,6,0)
  5.  ECED   - End Date
"KRN",8994,820,2,"B","ECARY",1)

"KRN",8994,820,3,0)
^8994.03^6^6^3030306^^^^
"KRN",8994,820,3,1,0)
Returns an array with Event Capture Patient entries with the following data:-
"KRN",8994,820,3,2,0)
  1. 721 IEN                              6. Provider
"KRN",8994,820,3,3,0)
  2. Procedure date and time              7. Ordering Section
"KRN",8994,820,3,4,0)
  3. Category                             8. Associated Clinic
"KRN",8994,820,3,5,0)
  4. Procedure                            9. Primary Diagnoses
"KRN",8994,820,3,6,0)
  5. Volume                              10. Provider IEN
"KRN",8994,845,-1)
0^1
"KRN",8994,845,0)
EC GETLOC^GLOC^ECUMRPC2^4^A^^^1
"KRN",8994,845,1,0)
^8994.01^2^2^3030205^^^^
"KRN",8994,845,1,1,0)
This broker entry point returns all active, inactive or both locations 
"KRN",8994,845,1,2,0)
from file #4.
"KRN",8994,845,2,0)
^8994.02A^1^1
"KRN",8994,845,2,1,0)
ECARY^1
"KRN",8994,845,2,1,1,0)
^8994.021^2^2^3030205^^^^
"KRN",8994,845,2,1,1,1,0)
Input variable ECARY contains the following values:-
"KRN",8994,845,2,1,1,2,0)
   STAT   - Active, inactive or both (optional)
"KRN",8994,845,2,"B","ECARY",1)

"KRN",8994,845,3,0)
^8994.03^7^7^3030205^^^^
"KRN",8994,845,3,1,0)
Results array contain the following values:-
"KRN",8994,845,3,2,0)
    1.  Location IEN
"KRN",8994,845,3,3,0)
    2.  Location description
"KRN",8994,845,3,4,0)
    3.  State
"KRN",8994,845,3,5,0)
    4.  Current Location Flag
"KRN",8994,845,3,6,0)
    5.  Facility Type
"KRN",8994,845,3,7,0)
    6.  Station Number
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",486,-1)
1^1
"PKG",486,0)
EVENT CAPTURE^EC^Event Capture Workload Capture System^
"PKG",486,20,0)
^9.402P^^
"PKG",486,22,0)
^9.49I^1^1
"PKG",486,22,1,0)
2.0^2960508^2981027^66481
"PKG",486,22,1,"PAH",1,0)
46^3030311
"PKG",486,22,1,"PAH",1,1,0)
^^1^1^3030311
"PKG",486,22,1,"PAH",1,1,1,0)
National Procedure Update (File #725).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ECUERPC")
0^1^B48478010
"RTN","ECUERPC",1,0)
ECUERPC ;ALB/JAM;Event Capture Data Entry Broker Utilities ;Aug 16, 2000
"RTN","ECUERPC",2,0)
 ;;2.0; EVENT CAPTURE ;**25,32,33,46**;8 May 96
"RTN","ECUERPC",3,0)
 ;
"RTN","ECUERPC",4,0)
USRUNT(RESULTS,ECARY) ;
"RTN","ECUERPC",5,0)
 ;
"RTN","ECUERPC",6,0)
 ;This broker call returns an array of DSS units for a user & location
"RTN","ECUERPC",7,0)
 ;        RPC: EC GETUSRDSSUNIT
"RTN","ECUERPC",8,0)
 ;INPUTS        ECARY  - Contains the following subscripted elements
"RTN","ECUERPC",9,0)
 ;               1. ECL   - Location IEN (if define gives User's DSS 
"RTN","ECUERPC",10,0)
 ;                          units for a location)
"RTN","ECUERPC",11,0)
 ;               2. ECDUZ - New Person IEN (if define gives list of 
"RTN","ECUERPC",12,0)
 ;                          DSS Units available to user)
"RTN","ECUERPC",13,0)
 ;
"RTN","ECUERPC",14,0)
 ;OUTPUTS        RESULTS - Array of DSS Units. Data pieces as follows:-
"RTN","ECUERPC",15,0)
 ;               PIECE - Description
"RTN","ECUERPC",16,0)
 ;                 1     IEN of file 724
"RTN","ECUERPC",17,0)
 ;                 2     Name of DSS Unit
"RTN","ECUERPC",18,0)
 ;                 3     Send to PCE Flag
"RTN","ECUERPC",19,0)
 N ECL,ECDUZ,CNT,STR,DPT,IEN
"RTN","ECUERPC",20,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",21,0)
 S ECL=$P(ECARY,U),ECDUZ=$P(ECARY,U,2) I ECL="",ECDUZ="" Q
"RTN","ECUERPC",22,0)
 ;S ECDUZ=$G(DUZ,U),ECL=$P(ECARY,U) I (ECDUZ="")!(ECL="") Q
"RTN","ECUERPC",23,0)
 K ^TMP($J,"ECUSRUNT") S (DPT,CNT)=0
"RTN","ECUERPC",24,0)
 I ECL'="",ECDUZ="" S ECDUZ=$G(DUZ,U) I ECDUZ="" Q
"RTN","ECUERPC",25,0)
 I $D(^XUSEC("ECALLU",ECDUZ)) S DPT="" D
"RTN","ECUERPC",26,0)
 .I ECL="" S ^TMP($J,"ECUSRUNT",CNT+1)="ALL^ALL" Q
"RTN","ECUERPC",27,0)
 .I ECL="ALL" S ECL=""
"RTN","ECUERPC",28,0)
 .F  S DPT=$O(^ECD("B",DPT))  Q:DPT=""  S IEN=0 D
"RTN","ECUERPC",29,0)
 ..F  S IEN=$O(^ECD("B",DPT,IEN)) Q:'IEN  D UNTCHK
"RTN","ECUERPC",30,0)
 E  D
"RTN","ECUERPC",31,0)
 .I ECL="ALL" S ECL=""
"RTN","ECUERPC",32,0)
 .F  S DPT=$O(^VA(200,ECDUZ,"EC",DPT)) Q:'DPT  S IEN=DPT D UNTCHK
"RTN","ECUERPC",33,0)
 S RESULTS=$NA(^TMP($J,"ECUSRUNT"))
"RTN","ECUERPC",34,0)
 Q
"RTN","ECUERPC",35,0)
UNTCHK ;Check if DSS unit exist as event code screen and if active
"RTN","ECUERPC",36,0)
 N DSSF
"RTN","ECUERPC",37,0)
 ;I '$D(^ECJ("AP",ECL,IEN))!($P($G(^ECD(IEN,0)),U,6)) Q
"RTN","ECUERPC",38,0)
 I ECL'="",'$D(^ECJ("AP",ECL,IEN)) Q
"RTN","ECUERPC",39,0)
 I ($P($G(^ECD(IEN,0)),U,6))!('$P($G(^ECD(IEN,0)),U,8)) Q
"RTN","ECUERPC",40,0)
 S DSSF=$P(^ECD(IEN,0),"^",14) S:DSSF="" DSSF="N"
"RTN","ECUERPC",41,0)
 S CNT=CNT+1,STR=IEN_"^"_$P(^ECD(IEN,0),"^")_U_DSSF
"RTN","ECUERPC",42,0)
 S ^TMP($J,"ECUSRUNT",CNT)=STR
"RTN","ECUERPC",43,0)
 Q
"RTN","ECUERPC",44,0)
CAT(RESULTS,ECARY) ;
"RTN","ECUERPC",45,0)
 ;
"RTN","ECUERPC",46,0)
 ;This broker entry point returns an array of categories for an Event 
"RTN","ECUERPC",47,0)
 ;Code screen based on location and DSS unit.
"RTN","ECUERPC",48,0)
 ;        RPC: EC GETECSCATS
"RTN","ECUERPC",49,0)
 ;INPUTS        ECARY  - Contains the following values separated by "^"
"RTN","ECUERPC",50,0)
 ;               ECL  - Location IEN
"RTN","ECUERPC",51,0)
 ;               ECD  - DSS Unit IEN
"RTN","ECUERPC",52,0)
 ;               ECCSTA-Active or inactive category
"RTN","ECUERPC",53,0)
 ;                      A-ctive (default), I-nactive, B-oth
"RTN","ECUERPC",54,0)
 ;
"RTN","ECUERPC",55,0)
 ;OUTPUTS        RESULTS - Array of categories. Data pieces as follows:-
"RTN","ECUERPC",56,0)
 ;               PIECE - Description
"RTN","ECUERPC",57,0)
 ;                 1  - Category IEN
"RTN","ECUERPC",58,0)
 ;                 2  - Category description
"RTN","ECUERPC",59,0)
 ;
"RTN","ECUERPC",60,0)
 N ECL,ECD,ECC,CNT,DATA,ECCSTA
"RTN","ECUERPC",61,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",62,0)
 S ECL=$P(ECARY,U),ECD=$P(ECARY,U,2) I (ECL="")!(ECD="") Q
"RTN","ECUERPC",63,0)
 S ECCSTA=$P(ECARY,U,3)
"RTN","ECUERPC",64,0)
 K ^TMP($J,"ECSCATS")
"RTN","ECUERPC",65,0)
 D CATS^ECHECK1
"RTN","ECUERPC",66,0)
 M ^TMP($J,"ECSCATS")=ECC
"RTN","ECUERPC",67,0)
 S RESULTS=$NA(^TMP($J,"ECSCATS"))
"RTN","ECUERPC",68,0)
 Q
"RTN","ECUERPC",69,0)
PROC(RESULTS,ECARY) ;
"RTN","ECUERPC",70,0)
 ;
"RTN","ECUERPC",71,0)
 ;This broker entry point returns an array of procedures for an Event 
"RTN","ECUERPC",72,0)
 ;Code screen (file #720.3) based on location, DSS unit, and Category
"RTN","ECUERPC",73,0)
 ;        RPC: EC GETECSPROCS
"RTN","ECUERPC",74,0)
 ;INPUTS        ECARY  - Contains the following values separated by "^"
"RTN","ECUERPC",75,0)
 ;               ECL  - Location IEN
"RTN","ECUERPC",76,0)
 ;               ECD  - DSS Unit IEN
"RTN","ECUERPC",77,0)
 ;               ECC  - Category IEN
"RTN","ECUERPC",78,0)
 ;
"RTN","ECUERPC",79,0)
 ;OUTPUTS        RESULTS - Array of procedures. Data pieces as follows:-
"RTN","ECUERPC",80,0)
 ;               PIECE - Description
"RTN","ECUERPC",81,0)
 ;                 1  - EC National Number SPACE Procedure Name SPACE
"RTN","ECUERPC",82,0)
 ;                   - [Synonym]
"RTN","ECUERPC",83,0)
 ;                 2  - Procedure Code
"RTN","ECUERPC",84,0)
 ;                 3  - CPT Code
"RTN","ECUERPC",85,0)
 ;                 4  - Default volume (1 if no default volume)
"RTN","ECUERPC",86,0)
 ;                 5  - Event code screen IEN
"RTN","ECUERPC",87,0)
 ;
"RTN","ECUERPC",88,0)
 N ECL,ECD,ECC,CNT,DATA,STR,ECCPT,PX
"RTN","ECUERPC",89,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",90,0)
 S ECL=$P(ECARY,U),ECD=$P(ECARY,U,2),ECC=$P(ECARY,U,3) S:ECC="" ECC=0
"RTN","ECUERPC",91,0)
 I (ECL="")!(ECD="") Q
"RTN","ECUERPC",92,0)
 K ^TMP($J,"ECPRO")
"RTN","ECUERPC",93,0)
 D PROS^ECHECK1
"RTN","ECUERPC",94,0)
 S CNT=0 F  S CNT=$O(^TMP("ECPRO",$J,CNT)) Q:'CNT  D
"RTN","ECUERPC",95,0)
 .S DATA=^TMP("ECPRO",$J,CNT),PX=$P(DATA,U)
"RTN","ECUERPC",96,0)
 .S ECCPT=$S(PX["EC":$P($G(^EC(725,+PX,0)),"^",5),1:+PX)
"RTN","ECUERPC",97,0)
 .S STR=$P(DATA,U,5)_" "_$P(DATA,U,4)_" ["_$P(DATA,U,3)_"]"_U_PX
"RTN","ECUERPC",98,0)
 .S STR=STR_U_ECCPT_U_$S($P(DATA,U,6):+$P(DATA,U,6),1:1)_U_$P(DATA,U,2)
"RTN","ECUERPC",99,0)
 .S ^TMP($J,"ECPRO",CNT)=STR
"RTN","ECUERPC",100,0)
 S RESULTS=$NA(^TMP($J,"ECPRO"))
"RTN","ECUERPC",101,0)
 K ^TMP("ECPRO",$J)
"RTN","ECUERPC",102,0)
 Q
"RTN","ECUERPC",103,0)
ECPXMOD(RESULTS,ECARY) ;
"RTN","ECUERPC",104,0)
 ;
"RTN","ECUERPC",105,0)
 ;Broker call returns modifier entries for a CPT Procedure
"RTN","ECUERPC",106,0)
 ;        RPC: EC GETPXMODIFIER
"RTN","ECUERPC",107,0)
 ;INPUTS   ECARY  - Contains the following values separated by "^"
"RTN","ECUERPC",108,0)
 ;          ECCPT - CPT code ien (file #81)
"RTN","ECUERPC",109,0)
 ;          ECDT  - Procedure date and time (fileman format)
"RTN","ECUERPC",110,0)
 ;
"RTN","ECUERPC",111,0)
 ;OUTPUTS  RESULTS - Array of procedure modifiers
"RTN","ECUERPC",112,0)
 ;          2-character modifier^modifer name^modifier ien #81.3
"RTN","ECUERPC",113,0)
 ;
"RTN","ECUERPC",114,0)
 N CNT,SUB,ECCPT,ECDT,DATA,ECMOD
"RTN","ECUERPC",115,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",116,0)
 S ECCPT=$P(ECARY,U),ECDT=$P(ECARY,U,2) I ECDT="" D NOW^%DTC S ECDT=%
"RTN","ECUERPC",117,0)
 I ECCPT="" Q
"RTN","ECUERPC",118,0)
 K ^TMP($J,"ECPXMODS") S (SUB,CNT)=0
"RTN","ECUERPC",119,0)
 S DATA=$$CODM^ICPTCOD(ECCPT,"ECMOD","",ECDT) I +DATA<0 Q
"RTN","ECUERPC",120,0)
 F  S SUB=$O(ECMOD(SUB)) Q:SUB=""  D
"RTN","ECUERPC",121,0)
 . S CNT=CNT+1,^TMP($J,"ECPXMODS",CNT)=SUB_U_ECMOD(SUB)
"RTN","ECUERPC",122,0)
 S RESULTS=$NA(^TMP($J,"ECPXMODS"))
"RTN","ECUERPC",123,0)
 Q
"RTN","ECUERPC",124,0)
PRVDER(RESULTS,ECARY) ;
"RTN","ECUERPC",125,0)
 ;remove this rpc before release;JAM 6/4/01
"RTN","ECUERPC",126,0)
 ;This broker entry point returns an array of valid providers
"RTN","ECUERPC",127,0)
 ;        RPC: EC GETPROVIDER
"RTN","ECUERPC",128,0)
 ;INPUTS        ECARY  - Contains the following subscripted elements
"RTN","ECUERPC",129,0)
 ;               ECDT  - Procedure date
"RTN","ECUERPC",130,0)
 ;
"RTN","ECUERPC",131,0)
 ;OUTPUTS        RESULTS - Array of providers. Data pieces as follows:-
"RTN","ECUERPC",132,0)
 ;               PIECE - Description
"RTN","ECUERPC",133,0)
 ;                IEN of file 200^Provider Name^occupation^speciality^
"RTN","ECUERPC",134,0)
 ;                subspeciality
"RTN","ECUERPC",135,0)
 ;
"RTN","ECUERPC",136,0)
 N IEN,CNT,ECUTN,KEY,USR
"RTN","ECUERPC",137,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",138,0)
 S ECDT=$P($G(ECARY),U),ECDT=$S(ECDT="":DT,1:ECDT)
"RTN","ECUERPC",139,0)
 K ^TMP($J,"ECPRVDRS") S CNT=0
"RTN","ECUERPC",140,0)
 F KEY="PROVIDER" S IEN=0 D
"RTN","ECUERPC",141,0)
 .F  S IEN=$O(^XUSEC(KEY,IEN)) Q:'IEN  S USR=$G(^VA(200,IEN,0)) D:USR'=""
"RTN","ECUERPC",142,0)
 ..S ECUTN=$$GET^XUA4A72(IEN,ECDT) I +ECUTN'>0 Q
"RTN","ECUERPC",143,0)
 ..S CNT=CNT+1,^TMP($J,"ECPRVDRS",CNT)=IEN_U_$P(USR,U)_U_$P(ECUTN,2,4)
"RTN","ECUERPC",144,0)
 S RESULTS=$NA(^TMP($J,"ECPRVDRS"))
"RTN","ECUERPC",145,0)
 Q
"RTN","ECUERPC",146,0)
 ;
"RTN","ECUERPC",147,0)
ELIG(RESULTS,ECARY) ;
"RTN","ECUERPC",148,0)
 ;
"RTN","ECUERPC",149,0)
 ;Broker call returns a list of patient eligibilities
"RTN","ECUERPC",150,0)
 ;        RPC: EC GETPATELIG
"RTN","ECUERPC",151,0)
 ;INPUTS   ECARY  - Contains the following subscripted elements
"RTN","ECUERPC",152,0)
 ;          DFN - Patient ien (file #2)
"RTN","ECUERPC",153,0)
 ;
"RTN","ECUERPC",154,0)
 ;OUTPUTS  RESULTS - Array of eligibilities
"RTN","ECUERPC",155,0)
 ;          primary/secondary elig flag^elig ien^elig description
"RTN","ECUERPC",156,0)
 ;
"RTN","ECUERPC",157,0)
 N CNT,SUB,DFN,VAEL
"RTN","ECUERPC",158,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",159,0)
 S DFN=$P(ECARY,U) I DFN="" Q
"RTN","ECUERPC",160,0)
 K ^TMP($J,"ECPATELIG")
"RTN","ECUERPC",161,0)
 D ELIG^VADPT I $G(VAEL(1))="" Q
"RTN","ECUERPC",162,0)
 S ^TMP($J,"ECPATELIG",1)="1^"_VAEL(1),SUB=0,CNT=1
"RTN","ECUERPC",163,0)
 F  S SUB=$O(VAEL(1,SUB)) Q:SUB=""  D
"RTN","ECUERPC",164,0)
 . S CNT=CNT+1,^TMP($J,"ECPATELIG",CNT)="0^"_VAEL(1,SUB)
"RTN","ECUERPC",165,0)
 S RESULTS=$NA(^TMP($J,"ECPATELIG"))
"RTN","ECUERPC",166,0)
 Q
"RTN","ECUERPC",167,0)
PRDEFS(RESULTS,ECARY) ;
"RTN","ECUERPC",168,0)
 ;
"RTN","ECUERPC",169,0)
 ;This broker entry point returns the defaults for procedure data entry
"RTN","ECUERPC",170,0)
 ;        RPC: EC GETPRODEFS
"RTN","ECUERPC",171,0)
 ;INPUTS        ECARY  - Contains the following values separated by "^"
"RTN","ECUERPC",172,0)
 ;               ECL  - Location IEN
"RTN","ECUERPC",173,0)
 ;               ECD  - DSS Unit IEN
"RTN","ECUERPC",174,0)
 ;               ECC  - Category IEN
"RTN","ECUERPC",175,0)
 ;
"RTN","ECUERPC",176,0)
 ;OUTPUTS        RESULTS - Data pieces as follows:-
"RTN","ECUERPC",177,0)
 ;               PIECE - Description
"RTN","ECUERPC",178,0)
 ;                 1  - Associated Clinic IEN
"RTN","ECUERPC",179,0)
 ;                 2  - Associated Clinic
"RTN","ECUERPC",180,0)
 ;                 3  - Medical Speciality IEN
"RTN","ECUERPC",181,0)
 ;                 4  - Medical Speciality
"RTN","ECUERPC",182,0)
 ;
"RTN","ECUERPC",183,0)
 N ECL,ECD,ECC,ECP,IEN,ASC,ASCNM,MEDSP,MEDSPNM,ECCH
"RTN","ECUERPC",184,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",185,0)
 S ECL=$P(ECARY,U),ECD=$P(ECARY,U,2),ECC=$P(ECARY,U,3),ECP=$P(ECARY,U,4)
"RTN","ECUERPC",186,0)
 S:ECC="" ECC=0 I (ECL="")!(ECD="") Q
"RTN","ECUERPC",187,0)
 S (ASCNM,MEDSPNM)="",ECCH=ECL_"-"_ECD_"-"_ECC_"-"_ECP
"RTN","ECUERPC",188,0)
 I '$D(^ECJ("B",ECCH)) Q
"RTN","ECUERPC",189,0)
 S IEN=$O(^ECJ("B",ECCH,0)) I IEN="" Q
"RTN","ECUERPC",190,0)
 S ASC=$P($G(^ECJ(IEN,"PRO")),U,4) I ASC D
"RTN","ECUERPC",191,0)
 .S ASCNM=$$GET1^DIQ(44,ASC,.01,"I")
"RTN","ECUERPC",192,0)
 S MEDSP=$P($G(^ECD(ECD,0)),U,3) I MEDSP D 
"RTN","ECUERPC",193,0)
 .S MEDSPNM=$$GET1^DIQ(723,MEDSP,.01,"I")
"RTN","ECUERPC",194,0)
 S RESULTS=ASC_U_ASCNM_U_MEDSP_U_MEDSPNM
"RTN","ECUERPC",195,0)
 Q
"RTN","ECUERPC",196,0)
PATPROC(RESULTS,ECARY) ;
"RTN","ECUERPC",197,0)
 ;
"RTN","ECUERPC",198,0)
 ;Broker call returns the entries from EVENT CAPTURE PATIENT FILE #721
"RTN","ECUERPC",199,0)
 ;        RPC: EC GETPATPROCS
"RTN","ECUERPC",200,0)
 ;INPUTS   ECARY - Contains the following values separated by "^"
"RTN","ECUERPC",201,0)
 ;          ECLOC - Location ien
"RTN","ECUERPC",202,0)
 ;          ECPAT - Patient DFN ien
"RTN","ECUERPC",203,0)
 ;          ECUNT - DSS unit ien
"RTN","ECUERPC",204,0)
 ;          ECSD  - Start Date
"RTN","ECUERPC",205,0)
 ;          ECED  - End Date
"RTN","ECUERPC",206,0)
 ;
"RTN","ECUERPC",207,0)
 ;OUTPUTS  RESULTS - Array of Event Capture Patient entries contain
"RTN","ECUERPC",208,0)
 ;          721 IEN^Procedure date and time^Category^Procedure^Volume^
"RTN","ECUERPC",209,0)
 ;          Provider^ordering section^associated clinic^primary diagnoses
"RTN","ECUERPC",210,0)
 ;          Provider IEN
"RTN","ECUERPC",211,0)
 ;
"RTN","ECUERPC",212,0)
 N IEN,CNT,ECV,ECLOC,ECUNT,ECPAT,PX,NODE,DATA,PDT,PDX,PND,PDXD,CAT,ECI
"RTN","ECUERPC",213,0)
 N ORS,PRV,PRO
"RTN","ECUERPC",214,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC",215,0)
 S ECV="ECLOC^ECPAT^ECUNT^ECSD^ECED"
"RTN","ECUERPC",216,0)
 D PARSE(ECV,ECARY) I (ECLOC="")!(ECPAT="")!(ECUNT="") Q
"RTN","ECUERPC",217,0)
 K ^TMP($J,"ECPATPX")
"RTN","ECUERPC",218,0)
 S ECSD=$G(ECSD,DT),ECED=$G(ECED,DT)
"RTN","ECUERPC",219,0)
 S %DT="X" F ECI="ECSD","ECED" S X=@ECI D ^%DT S @ECI=Y
"RTN","ECUERPC",220,0)
 K X,Y
"RTN","ECUERPC",221,0)
 S ECSD=$S(ECSD=-1:DT,1:ECSD)-.0001,ECED=$S(ECED=-1:DT,1:ECED)+.9999
"RTN","ECUERPC",222,0)
 Q:ECED'>ECSD  S PDT=ECSD,CNT=0
"RTN","ECUERPC",223,0)
 F  S PDT=$O(^ECH("ADT",ECLOC,ECPAT,ECUNT,PDT)) Q:'PDT!(PDT>ECED)  D
"RTN","ECUERPC",224,0)
 . S IEN=0 F  S IEN=$O(^ECH("ADT",ECLOC,ECPAT,ECUNT,PDT,IEN)) Q:'IEN  D
"RTN","ECUERPC",225,0)
 . . S NODE=$G(^ECH(IEN,0)),PND=$G(^ECH(IEN,"P")),PX=$P(NODE,U,9)
"RTN","ECUERPC",226,0)
 . . Q:NODE=""  S (PRV,CAT,ORS,ASC,PDXD)="",PDX=$P(PND,U,2)
"RTN","ECUERPC",227,0)
 . . I PX["EC" D
"RTN","ECUERPC",228,0)
 . . . S PRO=$G(^EC(725,$P(PX,";"),0)),PX=$P(PRO,U,2)_" "_$P(PRO,U)
"RTN","ECUERPC",229,0)
 . . E  S PRO=$$CPT^ICPTCOD($P(PX,";")) S PX=$P(PRO,U,2)_" "_$P(PRO,U,3)
"RTN","ECUERPC",230,0)
 . . S:$P(NODE,U,8) CAT=$$GET1^DIQ(726,$P(NODE,U,8),.01,"I")
"RTN","ECUERPC",231,0)
 . . S:$P(NODE,U,11) PRV=$$GET1^DIQ(200,$P(NODE,U,11),.01,"I")
"RTN","ECUERPC",232,0)
 . . S:$P(NODE,U,12) ORS=$$GET1^DIQ(723,$P(NODE,U,12),.01,"I")
"RTN","ECUERPC",233,0)
 . . S:$P(NODE,U,19) ASC=$$GET1^DIQ(44,$P(NODE,U,19),.01,"I")
"RTN","ECUERPC",234,0)
 . . S:PDX PDXD=$$GET1^DIQ(80,PDX,.01,"I")_" "_$$GET1^DIQ(80,PDX,3,"I")
"RTN","ECUERPC",235,0)
 . . S DATA=$P(NODE,U)_U_$$FMTE^XLFDT($P(NODE,U,3),"2F")_U_CAT_U_PX
"RTN","ECUERPC",236,0)
 . . S DATA=DATA_U_$P(NODE,U,10)_U_PRV_U_ORS_U_ASC_U_PDXD_U_$P(NODE,U,11)
"RTN","ECUERPC",237,0)
 . . S CNT=CNT+1,^TMP($J,"ECPATPX",CNT)=DATA
"RTN","ECUERPC",238,0)
 S RESULTS=$NA(^TMP($J,"ECPATPX"))
"RTN","ECUERPC",239,0)
 Q
"RTN","ECUERPC",240,0)
PARSE(ECV,ECARY) ;Parse Variable
"RTN","ECUERPC",241,0)
 N I
"RTN","ECUERPC",242,0)
 F I=1:1:$L(ECARY,U) S @$P(ECV,U,I)=$P(ECARY,U,I)
"RTN","ECUERPC",243,0)
 Q
"RTN","ECUERPC1")
0^3^B54155202
"RTN","ECUERPC1",1,0)
ECUERPC1 ;ALB/JAM;Event Capture Data Entry Broker Util ; 5/21/01 7:30pm
"RTN","ECUERPC1",2,0)
 ;;2.0; EVENT CAPTURE ;**25,33,42,46**;8 May 96
"RTN","ECUERPC1",3,0)
PATINF(RESULTS,ECARY) ;
"RTN","ECUERPC1",4,0)
 ;
"RTN","ECUERPC1",5,0)
 ;Broker entry point to get various types of data from EVENT CAPTURE 
"RTN","ECUERPC1",6,0)
 ;PATIENT FILE #721
"RTN","ECUERPC1",7,0)
 ;        RPC: EC GETPATINFO
"RTN","ECUERPC1",8,0)
 ;INPUTS   ECARY  - Contains the following subscripted elements
"RTN","ECUERPC1",9,0)
 ;          ECIEN - Event Capture Patient ien
"RTN","ECUERPC1",10,0)
 ;          ECTYP - Data type to return
"RTN","ECUERPC1",11,0)
 ;
"RTN","ECUERPC1",12,0)
 ;OUTPUTS  RESULTS - Array of Event Capture Patient data
"RTN","ECUERPC1",13,0)
 ;          
"RTN","ECUERPC1",14,0)
 ;
"RTN","ECUERPC1",15,0)
 N ECTYP,ECIEN
"RTN","ECUERPC1",16,0)
 S ECARY=$G(ECARY),ECIEN=$P(ECARY,U),ECTYP=$P(ECARY,U,2) I ECIEN="" Q
"RTN","ECUERPC1",17,0)
 I '$D(^ECH(ECIEN)) Q
"RTN","ECUERPC1",18,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC1",19,0)
 I ECTYP="DXS" D PATDXS(ECIEN) Q
"RTN","ECUERPC1",20,0)
 I ECTYP="MOD" D PATMOD(ECIEN) Q
"RTN","ECUERPC1",21,0)
 I ECTYP="CLASS" D PATCLASS(ECIEN) Q
"RTN","ECUERPC1",22,0)
 I ECTYP="OTH" D PATOTH(ECIEN) Q
"RTN","ECUERPC1",23,0)
 Q
"RTN","ECUERPC1",24,0)
PATDXS(ECIEN) ;
"RTN","ECUERPC1",25,0)
 ;
"RTN","ECUERPC1",26,0)
 ;Returns to broker a patient secondary DXs entries from EVENT 
"RTN","ECUERPC1",27,0)
 ;CAPTURE PATIENT FILE #721
"RTN","ECUERPC1",28,0)
 ;INPUTS   ECIEN - Event Capture Patient ien
"RTN","ECUERPC1",29,0)
 ;
"RTN","ECUERPC1",30,0)
 ;OUTPUTS  RESULTS - Array of Event Capture Patient file contains
"RTN","ECUERPC1",31,0)
 ;          721 IEN^secondary dx ien #80^secondary dx code^dx desription
"RTN","ECUERPC1",32,0)
 ;
"RTN","ECUERPC1",33,0)
 N DXS,DXSIEN,DXSD,CNT
"RTN","ECUERPC1",34,0)
 I '$D(^ECH(ECIEN,"DX")) Q
"RTN","ECUERPC1",35,0)
 K ^TMP($J,"ECDXS")
"RTN","ECUERPC1",36,0)
 S (CNT,DXS)=0 F  S DXS=$O(^ECH(ECIEN,"DX",DXS)) Q:'DXS  D
"RTN","ECUERPC1",37,0)
 . S DXSIEN=$G(^ECH(ECIEN,"DX",DXS,0)) I DXSIEN="" Q
"RTN","ECUERPC1",38,0)
 . S DXSD=$$GET1^DIQ(80,DXSIEN,.01,"I")_"   "_$$GET1^DIQ(80,DXSIEN,3,"I")
"RTN","ECUERPC1",39,0)
 . S CNT=CNT+1,^TMP($J,"ECDXS",CNT)=ECIEN_U_DXSIEN_U_DXSD
"RTN","ECUERPC1",40,0)
 S RESULTS=$NA(^TMP($J,"ECDXS"))
"RTN","ECUERPC1",41,0)
 Q
"RTN","ECUERPC1",42,0)
PATMOD(ECIEN) ;
"RTN","ECUERPC1",43,0)
 ;
"RTN","ECUERPC1",44,0)
 ;Returns to broker a patient procedure modifier from EVENT CAPTURE
"RTN","ECUERPC1",45,0)
 ;PATIENT FILE #721
"RTN","ECUERPC1",46,0)
 ;INPUTS   ECIEN - Event Capture Patient ien
"RTN","ECUERPC1",47,0)
 ;
"RTN","ECUERPC1",48,0)
 ;OUTPUTS  RESULTS - Array of procedure modifiers
"RTN","ECUERPC1",49,0)
 ;          721 IEN^modifier ien #81.3^modifier^modifier name
"RTN","ECUERPC1",50,0)
 ;
"RTN","ECUERPC1",51,0)
 N MOD,MODIEN,CNT,MODS
"RTN","ECUERPC1",52,0)
 I '$D(^ECH(ECIEN,"MOD")) Q
"RTN","ECUERPC1",53,0)
 K ^TMP($J,"ECMOD")
"RTN","ECUERPC1",54,0)
 S (CNT,MOD)=0 F  S MOD=$O(^ECH(ECIEN,"MOD",MOD)) Q:'MOD  D
"RTN","ECUERPC1",55,0)
 . S MODIEN=$G(^ECH(ECIEN,"MOD",MOD,0)) I MODIEN="" Q
"RTN","ECUERPC1",56,0)
 . S MODS=$$MOD^ICPTMOD(MODIEN,"I") I +MODS<0 Q
"RTN","ECUERPC1",57,0)
 . S CNT=CNT+1
"RTN","ECUERPC1",58,0)
 . S ^TMP($J,"ECMOD",CNT)=ECIEN_U_$P(MODS,U,1,2)_"  "_$P(MODS,U,3)
"RTN","ECUERPC1",59,0)
 S RESULTS=$NA(^TMP($J,"ECMOD"))
"RTN","ECUERPC1",60,0)
 Q
"RTN","ECUERPC1",61,0)
PATCLASS(ECIEN) ;
"RTN","ECUERPC1",62,0)
 ;
"RTN","ECUERPC1",63,0)
 ;Returns to broker a patient classification & eligibility data from 
"RTN","ECUERPC1",64,0)
 ;EVENT CAPTURE PATIENT FILE #721
"RTN","ECUERPC1",65,0)
 ;INPUTS   ECIEN - Event Capture Patient ien
"RTN","ECUERPC1",66,0)
 ;
"RTN","ECUERPC1",67,0)
 ;OUTPUTS  RESULTS - Array of procedure modifiers
"RTN","ECUERPC1",68,0)
 ;          721 IEN^agent orange^radiation exposure^service connected^
"RTN","ECUERPC1",69,0)
 ;          environmental contaminants^military sexual trauma^
"RTN","ECUERPC1",70,0)
 ;          eligibility code #8^eligibility description^Head/Neck Cancer
"RTN","ECUERPC1",71,0)
 ;
"RTN","ECUERPC1",72,0)
 N CLA,ELIG,ELCOD,CLA,ECAO,ECIR,ECEC,ECSC,ECMST,STR,ECHNC
"RTN","ECUERPC1",73,0)
 I '$D(^ECH(ECIEN,"P")),'$D(^ECH(ECIEN,"PCE")) Q
"RTN","ECUERPC1",74,0)
 K ^TMP($J,"ECLASS")
"RTN","ECUERPC1",75,0)
 S ELIG=$P($G(^ECH(ECIEN,"PCE")),"~",17),ELCOD=""
"RTN","ECUERPC1",76,0)
 S:ELIG'="" ELCOD=$P($G(^DIC(8,ELIG,0)),U)
"RTN","ECUERPC1",77,0)
 S CLA=$G(^ECH(ECIEN,"P")),ECAO=$P(CLA,U,3),ECIR=$P(CLA,U,4)
"RTN","ECUERPC1",78,0)
 S ECEC=$P(CLA,U,5),ECSC=$P(CLA,U,6),ECMST=$P(CLA,U,9),ECHNC=$P(CLA,U,10)
"RTN","ECUERPC1",79,0)
 S STR=ECIEN_U_ECAO_U_ECIR_U_ECSC_U_ECEC_U_ECMST_U_ELIG_U_ELCOD_U_ECHNC
"RTN","ECUERPC1",80,0)
 S ^TMP($J,"ECLASS",1)=STR,RESULTS=$NA(^TMP($J,"ECLASS"))
"RTN","ECUERPC1",81,0)
 Q
"RTN","ECUERPC1",82,0)
PATOTH(ECIEN) ;
"RTN","ECUERPC1",83,0)
 ;
"RTN","ECUERPC1",84,0)
 ;Returns to broker a patient remaining data from EVENT CAPTURE
"RTN","ECUERPC1",85,0)
 ;PATIENT FILE #721
"RTN","ECUERPC1",86,0)
 ;INPUTS   ECIEN - Event Capture Patient ien
"RTN","ECUERPC1",87,0)
 ;
"RTN","ECUERPC1",88,0)
 ;OUTPUTS  RESULTS - Array of procedure modifiers
"RTN","ECUERPC1",89,0)
 ;          721 IEN^procedure reason^provider #2^provider #3
"RTN","ECUERPC1",90,0)
 ;          ^provider #2 IEN^provider #3 IEN
"RTN","ECUERPC1",91,0)
 ;
"RTN","ECUERPC1",92,0)
 N REAS,PRV2,PRV3,ECX
"RTN","ECUERPC1",93,0)
 K ^TMP($J,"ECOTH")
"RTN","ECUERPC1",94,0)
 S ECX=^ECH(ECIEN,0)
"RTN","ECUERPC1",95,0)
 S REAS=$$GET1^DIQ(721,ECIEN,34,"E")
"RTN","ECUERPC1",96,0)
 S PRV2=$$GET1^DIQ(721,ECIEN,15,"E")
"RTN","ECUERPC1",97,0)
 S PRV3=$$GET1^DIQ(721,ECIEN,17,"E")
"RTN","ECUERPC1",98,0)
 S ^TMP($J,"ECOTH",1)=REAS_U_PRV2_U_PRV3_U_$P(ECX,U,15)_U_$P(ECX,U,17)
"RTN","ECUERPC1",99,0)
 S RESULTS=$NA(^TMP($J,"ECOTH"))
"RTN","ECUERPC1",100,0)
 Q
"RTN","ECUERPC1",101,0)
PATCLAST(RESULTS,ECARY) ;
"RTN","ECUERPC1",102,0)
 ;
"RTN","ECUERPC1",103,0)
 ;Returns to broker a patient status (in/out) and classification
"RTN","ECUERPC1",104,0)
 ;     RPC: EC GETPATCLASTAT
"RTN","ECUERPC1",105,0)
 ;INPUTS  ECARY  - Contains the following subscripted elements  
"RTN","ECUERPC1",106,0)
 ;         ECDFN - Patient ien (#2)
"RTN","ECUERPC1",107,0)
 ;         ECD   - DSS Unit ien (#724)
"RTN","ECUERPC1",108,0)
 ;         ECDT  - Procedure date and time (fileman format)
"RTN","ECUERPC1",109,0)
 ;
"RTN","ECUERPC1",110,0)
 ;OUTPUTS  RESULTS - Patient status and classifications delimited by (^)
"RTN","ECUERPC1",111,0)
 ;         Patient Status: I for inpatient or O for outpatient
"RTN","ECUERPC1",112,0)
 ;         Classification: 2- Agent Orange, 3- Ionizing Radiation
"RTN","ECUERPC1",113,0)
 ;                         4- SC Condition, 5- Environmental Contaminants
"RTN","ECUERPC1",114,0)
 ;                         6- Military Sexual Trauma
"RTN","ECUERPC1",115,0)
 ;                         7- Head/Neck Cancer
"RTN","ECUERPC1",116,0)
 ;         Data after the '~' refers to those class. that must be asked 
"RTN","ECUERPC1",117,0)
 ;         by Delphi appl. when the answer to SC=No.
"RTN","ECUERPC1",118,0)
 ;         Data after "~"  1- Agent Orange  2- Ionizing Radiation
"RTN","ECUERPC1",119,0)
 ;                         3- Environmental Contaminants
"RTN","ECUERPC1",120,0)
 N ECDFN,ECDT,ECX,I,ECCLARY,SCDAT,PATSTAT
"RTN","ECUERPC1",121,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC1",122,0)
 S ECDFN=$P(ECARY,U),ECD=$P(ECARY,U,2),ECDT=$P(ECARY,U,3)
"RTN","ECUERPC1",123,0)
 I ECDT="" D NOW^%DTC S ECDT=%
"RTN","ECUERPC1",124,0)
 Q:ECDFN=""  S (RESULTS,SCDAT)=""
"RTN","ECUERPC1",125,0)
 S PATSTAT=$$INOUTPT^ECUTL0(ECDFN,ECDT),RESULTS="^^^^^",SCDAT=";;;"
"RTN","ECUERPC1",126,0)
 I '$$CHKDSS^ECUTL0(+$G(ECD),PATSTAT) D  Q
"RTN","ECUERPC1",127,0)
 .S RESULTS=PATSTAT_"^"_RESULTS_$S(SCDAT'="":"~"_SCDAT,1:"")
"RTN","ECUERPC1",128,0)
 D CL^SDCO21(ECDFN,ECDT,"",.ECCLARY)
"RTN","ECUERPC1",129,0)
 F ECX=3,1,2,4,5,6 D
"RTN","ECUERPC1",130,0)
 .I ECX=1,$P($G(^DPT(ECDFN,.321)),"^",2)'="Y" Q
"RTN","ECUERPC1",131,0)
 .I ECX=2,$P($G(^DPT(ECDFN,.321)),"^",3)'="Y" Q
"RTN","ECUERPC1",132,0)
 .I ECX=4,$P($G(^DPT(ECDFN,.322)),"^",13)'="Y",'$$EC^SDCO22(ECDFN,"") Q
"RTN","ECUERPC1",133,0)
 .I ECX=3,$D(ECCLARY(ECX)) F I=1,2,4 S ECCLARY(I)="SC"
"RTN","ECUERPC1",134,0)
 .I '$D(ECCLARY(ECX)) Q
"RTN","ECUERPC1",135,0)
 .;Check SC, if answer to SC is NO then these questions will be asked
"RTN","ECUERPC1",136,0)
 .I ECCLARY(ECX)="SC" S $P(SCDAT,";",ECX)="E"
"RTN","ECUERPC1",137,0)
 .E  S $P(RESULTS,"^",ECX)="E"
"RTN","ECUERPC1",138,0)
 S RESULTS=PATSTAT_"^"_RESULTS_$S(SCDAT'="":"~"_SCDAT,1:"")
"RTN","ECUERPC1",139,0)
 Q
"RTN","ECUERPC1",140,0)
ENCDXS(RESULTS,ECARY) ;
"RTN","ECUERPC1",141,0)
 ;
"RTN","ECUERPC1",142,0)
 ;Broker call returns a patient encounter primary & secondary dx (#721)
"RTN","ECUERPC1",143,0)
 ;     RPC: EC GETENCDXS
"RTN","ECUERPC1",144,0)
 ;INPUTS   ECDFN - Patient ien (#2)
"RTN","ECUERPC1",145,0)
 ;         ECDT  - Procedure date and time (fileman format)
"RTN","ECUERPC1",146,0)
 ;         ECL   - Location ien
"RTN","ECUERPC1",147,0)
 ;         EC4   - Clinic ien
"RTN","ECUERPC1",148,0)
 ;
"RTN","ECUERPC1",149,0)
 ;OUTPUTS  RESULTS - array of patient encounter diagnosis
"RTN","ECUERPC1",150,0)
 ;         primary/secondary flag^DX ien^DX code  DX description.
"RTN","ECUERPC1",151,0)
 ;
"RTN","ECUERPC1",152,0)
 N ECDFN,ECDT,ECL,EC4,ECPDX,ECDX,ECDXN,ECDXS,CNT,STR,ECPDX,SDXCNT
"RTN","ECUERPC1",153,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC1",154,0)
 K ^TMP($J,"ECENCDXS")
"RTN","ECUERPC1",155,0)
 S ECDFN=$P(ECARY,U),ECDT=+$P(ECARY,U,2),ECL=$P(ECARY,U,3)
"RTN","ECUERPC1",156,0)
 S EC4=$P(ECARY,U,4) I ECDT="" D NOW^%DTC S ECDT=%
"RTN","ECUERPC1",157,0)
 I ECDFN=""!(ECL="")!(EC4="") Q
"RTN","ECUERPC1",158,0)
 S (ECDX,ECDXN)="",ECPDX=$$PDXCK^ECUTL2(ECDFN,ECDT,ECL,EC4) I ECDX="" Q
"RTN","ECUERPC1",159,0)
 S CNT=1,IEN=0,STR=1_U_ECDX_U_ECDXN_"   "_$$GET1^DIQ(80,ECDX,3,"I")
"RTN","ECUERPC1",160,0)
 S ^TMP($J,"ECENCDXS",CNT)=STR
"RTN","ECUERPC1",161,0)
 ;*ACS concat description to 2nd diag code, in the order entered by the user
"RTN","ECUERPC1",162,0)
 F  S IEN=$O(ECDXS(IEN)) Q:'IEN  D
"RTN","ECUERPC1",163,0)
 . S CNT=CNT+1,^TMP($J,"ECENCDXS",CNT)=0_U_ECDXS(IEN)_U_IEN_"   "_$$GET1^DIQ(80,ECDXS(IEN),3,"I")
"RTN","ECUERPC1",164,0)
 S RESULTS=$NA(^TMP($J,"ECENCDXS"))
"RTN","ECUERPC1",165,0)
 Q
"RTN","ECUERPC1",166,0)
 ;
"RTN","ECUERPC1",167,0)
PROCBAT(RESULTS,ECARY) ;
"RTN","ECUERPC1",168,0)
 ;
"RTN","ECUERPC1",169,0)
 ;Broker call returns the entries from EVENT CAPTURE PATIENT FILE #721
"RTN","ECUERPC1",170,0)
 ;for patients for a specific procedure
"RTN","ECUERPC1",171,0)
 ;        RPC: EC GETBATPROCS
"RTN","ECUERPC1",172,0)
 ;INPUTS   ECARY - Contains the following subscripted elements
"RTN","ECUERPC1",173,0)
 ;          ECLOC - Location ien
"RTN","ECUERPC1",174,0)
 ;          ECUNT - DSS unit ien
"RTN","ECUERPC1",175,0)
 ;          ECC   - Category ien
"RTN","ECUERPC1",176,0)
 ;          ECP   - Procedure ien
"RTN","ECUERPC1",177,0)
 ;          ECSD  - Start Date
"RTN","ECUERPC1",178,0)
 ;          ECED  - End Date
"RTN","ECUERPC1",179,0)
 ;
"RTN","ECUERPC1",180,0)
 ;OUTPUTS  RESULTS - Array of Event Capture Patient data containing:-
"RTN","ECUERPC1",181,0)
 ;          721 IEN^Patient name^Procedure Date/Time^Primary Dx
"RTN","ECUERPC1",182,0)
 ;          ^Ordering Section^Associated Clinic
"RTN","ECUERPC1",183,0)
 ;^SSN^DOB^Procedure Date and Time
"RTN","ECUERPC1",184,0)
 N IEN,CNT,ECLOC,ECUNT,NODE,DATA,PXDT,ECV,ECC,ECP,ECSD,ECED,DATE,DFN
"RTN","ECUERPC1",185,0)
 N CAT,ECI,VADM,ORC,ASC,ECDX
"RTN","ECUERPC1",186,0)
 S ECV="ECLOC^ECUNT^ECC^ECP^ECSD^ECED"
"RTN","ECUERPC1",187,0)
 D PARSE^ECUERPC(ECV,ECARY)
"RTN","ECUERPC1",188,0)
 I (ECLOC="")!(ECUNT="")!(ECC="")!(ECP="") Q
"RTN","ECUERPC1",189,0)
 D SETENV^ECUMRPC K ^TMP($J,"ECBATPX") S CNT=0
"RTN","ECUERPC1",190,0)
 S %DT="STX" F ECI="ECSD","ECED" S X=@ECI D ^%DT S @ECI=Y
"RTN","ECUERPC1",191,0)
 S ECSD=$S(ECSD=-1:DT,1:ECSD)-.0001,ECED=$S(ECED=-1:DT,1:ECED)+.9999
"RTN","ECUERPC1",192,0)
 Q:ECED'>ECSD  S DATE=ECSD
"RTN","ECUERPC1",193,0)
 F  S DATE=$O(^ECH("AC1",ECLOC,DATE)) Q:'DATE!(DATE>ECED)  S IEN=0 D
"RTN","ECUERPC1",194,0)
 . F  S IEN=$O(^ECH("AC1",ECLOC,DATE,IEN)) Q:'IEN  D
"RTN","ECUERPC1",195,0)
 . . S NODE=$G(^ECH(IEN,0))  Q:NODE=""  Q:$P(NODE,U,7)'=ECUNT
"RTN","ECUERPC1",196,0)
 . . Q:$P(NODE,U,8)'=ECC  Q:$P(NODE,U,9)'=ECP
"RTN","ECUERPC1",197,0)
 . . S ECDX=$P($G(^ECH(IEN,"P")),U,2) I ECDX'="" D
"RTN","ECUERPC1",198,0)
 . . . S ECDX=$$GET1^DIQ(80,ECDX,.01,"I")_"  "_$$GET1^DIQ(80,ECDX,3,"I")
"RTN","ECUERPC1",199,0)
 . . S ASC=$P(NODE,U,19) S:ASC'="" ASC=$$GET1^DIQ(44,ASC,.01,"I")
"RTN","ECUERPC1",200,0)
 . . S ORC=$P(NODE,U,12) S:ORC'="" ORC=$$GET1^DIQ(723,ORC,.01,"I")
"RTN","ECUERPC1",201,0)
 . . S Y=DATE X ^DD("DD") S PXDT=Y,DFN=$P(NODE,U,2) D DEM^VADPT
"RTN","ECUERPC1",202,0)
 . . S DATA=$E(VADM(1),1,30)_U_PXDT_U_ECDX_U_ORC_U_ASC
"RTN","ECUERPC1",203,0)
 . . S CNT=CNT+1,^TMP($J,"ECBATPX",CNT)=IEN_U_DATA
"RTN","ECUERPC1",204,0)
 S RESULTS=$NA(^TMP($J,"ECBATPX"))
"RTN","ECUERPC1",205,0)
 Q
"RTN","ECUERPC1",206,0)
 ;
"RTN","ECUERPC1",207,0)
CLHLP(RESULTS,ECARY) ;RPC Broker entry point for classification help
"RTN","ECUERPC1",208,0)
 ;        RPC: EC CLASHELP
"RTN","ECUERPC1",209,0)
 ;INPUTS   ECARY - Contains the following elements for report printing
"RTN","ECUERPC1",210,0)
 ;          ECDFN  - Patient DFN from file (#2)
"RTN","ECUERPC1",211,0)
 ;          ECKY   - Key to provide help on
"RTN","ECUERPC1",212,0)
 ;
"RTN","ECUERPC1",213,0)
 ;OUTPUTS  RESULTS - Array of help text for classification
"RTN","ECUERPC1",214,0)
 ;
"RTN","ECUERPC1",215,0)
 N ECFILER,ECERR,ECDIRY,ECUFILE,ECDFN,ECKY,ECHNDL
"RTN","ECUERPC1",216,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC1",217,0)
 K ^TMP("ECMSG",$J)
"RTN","ECUERPC1",218,0)
 S ECERR=0,ECDFN=$P(ECARY,U),ECKY=$P(ECARY,U,2) D  I ECERR D CLEND Q
"RTN","ECUERPC1",219,0)
 .I ECDFN="" S ECERR=1,^TMP("ECMSG",$J,1)="0^Patient IEN not defined" Q
"RTN","ECUERPC1",220,0)
 .I ECKY="" S ECERR=1,^TMP("ECMSG",$J,1)="0^Help Key not defined" Q
"RTN","ECUERPC1",221,0)
 .S DIC=2,DIC(0)="NMZX",X=ECDFN D ^DIC I Y<0 D
"RTN","ECUERPC1",222,0)
 ..S ECERR=1,^TMP("ECMSG",$J,1)="0^Patient IEN not found"
"RTN","ECUERPC1",223,0)
 S ECHNDL="ECLASHLP" D HFSOPEN^ECRRPC(ECHNDL) I ECERR D CLEND Q
"RTN","ECUERPC1",224,0)
 U IO
"RTN","ECUERPC1",225,0)
 I ECKY="SC" D SC^SDCO23(ECDFN)
"RTN","ECUERPC1",226,0)
 D HFSCLOSE^ECRRPC(ECFILER)
"RTN","ECUERPC1",227,0)
CLEND ;
"RTN","ECUERPC1",228,0)
 I $D(^TMP("ECMSG",$J)) S RESULTS=$NA(^TMP("ECMSG",$J)) Q
"RTN","ECUERPC1",229,0)
 S RESULTS=$NA(^TMP($J))
"RTN","ECUERPC1",230,0)
 Q
"RTN","ECUERPC1",231,0)
ECDEF(RESULTS,ECARY) ;RPC Broker entry point to get a default for space bar
"RTN","ECUERPC1",232,0)
 ;        RPC: EC SPACEBAR
"RTN","ECUERPC1",233,0)
 ;INPUTS   ECARY - Contains the following elements for report printing
"RTN","ECUERPC1",234,0)
 ;          ECFILE - File to obtain value from
"RTN","ECUERPC1",235,0)
 ;
"RTN","ECUERPC1",236,0)
 ;OUTPUTS  RESULTS - IEN^Description of Text
"RTN","ECUERPC1",237,0)
 ;
"RTN","ECUERPC1",238,0)
 N DIC,ECFILE,X,Y
"RTN","ECUERPC1",239,0)
 D SETENV^ECUMRPC
"RTN","ECUERPC1",240,0)
 S ECFILE=$P(ECARY,U)
"RTN","ECUERPC1",241,0)
 I ECFILE="" S ECERR=1,RESULTS="0^File not defined" Q
"RTN","ECUERPC1",242,0)
 S X=" ",DIC(0)="MZX",DIC=ECFILE D ^DIC I Y<0 D  I ECERR Q
"RTN","ECUERPC1",243,0)
 . S ECERR=1,RESULTS="0^Nothing found"
"RTN","ECUERPC1",244,0)
 S RESULTS=Y
"RTN","ECUERPC1",245,0)
 Q
"RTN","ECUMRPC2")
0^2^B18572772
"RTN","ECUMRPC2",1,0)
ECUMRPC2 ;ALB/JAM;Event Capture Management Broker Utils ; 10/4/00 4:58pm
"RTN","ECUMRPC2",2,0)
 ;;2.0; EVENT CAPTURE ;**25,30,42,46**;8 May 96
"RTN","ECUMRPC2",3,0)
GLOC(RESULTS,ECARY) ;
"RTN","ECUMRPC2",4,0)
 ;
"RTN","ECUMRPC2",5,0)
 ;This broker entry point returns all active Event Capture locations
"RTN","ECUMRPC2",6,0)
 ;        RPC: EC GETLOC
"RTN","ECUMRPC2",7,0)
 ;INPUTS         ECARY - Contains the following subscripted elements
"RTN","ECUMRPC2",8,0)
 ;               STAT   - Active or inactive locations (optional)
"RTN","ECUMRPC2",9,0)
 ;               A-ctive (default), I-nactive, B-oth
"RTN","ECUMRPC2",10,0)
 ;
"RTN","ECUMRPC2",11,0)
 ;OUTPUTS        RESULTS - The array of active Event Capture locations.
"RTN","ECUMRPC2",12,0)
 ;               PIECE - Description
"RTN","ECUMRPC2",13,0)
 ;                 1     Location IEN
"RTN","ECUMRPC2",14,0)
 ;                 2     LOC description
"RTN","ECUMRPC2",15,0)
 ;                 3     State Abbreviation
"RTN","ECUMRPC2",16,0)
 ;                 4     Current Location Flag
"RTN","ECUMRPC2",17,0)
 ;                 5     Facility Type
"RTN","ECUMRPC2",18,0)
 ;                 6     Station Number
"RTN","ECUMRPC2",19,0)
 N LOC,STAT,CNT,CLOC,ST,NODE,ACT,ECLOC,ELOC,ECFT,ECSN
"RTN","ECUMRPC2",20,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC2",21,0)
 K ^TMP($J,"ECLOCATION")
"RTN","ECUMRPC2",22,0)
 S STAT=$P($G(ECARY),U),(CNT,LOC)=0,ACT=0 S:STAT="" STAT="A"
"RTN","ECUMRPC2",23,0)
 D GETLOC^ECL(.ECLOC)
"RTN","ECUMRPC2",24,0)
 F  S LOC=$O(ECLOC(LOC)) Q:'LOC  S ELOC($P(ECLOC(LOC),U,2))=""
"RTN","ECUMRPC2",25,0)
 S LOC=0
"RTN","ECUMRPC2",26,0)
 F  S LOC=$O(^DIC(4,LOC)) Q:'LOC  S NODE=$G(^DIC(4,LOC,0)) I NODE'="" D
"RTN","ECUMRPC2",27,0)
 . I $P(NODE,U)="" Q
"RTN","ECUMRPC2",28,0)
 . I ($P(NODE,U,11)="I")!($P($G(^DIC(4,LOC,99)),U,4)) S ACT=1
"RTN","ECUMRPC2",29,0)
 . I $S(STAT="A"&(ACT):1,STAT="I"&('ACT):1,1:0) Q
"RTN","ECUMRPC2",30,0)
 . S CLOC=$D(ELOC(LOC)),CLOC=$S(CLOC:"YES",1:"")
"RTN","ECUMRPC2",31,0)
 . S CNT=CNT+1,ST=$P(NODE,U,2) S:ST'="" ST=$$GET1^DIQ(5,ST,1,"I")
"RTN","ECUMRPC2",32,0)
 . S ECFT=$P($G(^DIC(4.1,+$G(^DIC(4,LOC,3)),0)),U)
"RTN","ECUMRPC2",33,0)
 . S ECSN=$P($G(^DIC(4,LOC,99)),U)
"RTN","ECUMRPC2",34,0)
 . S ^TMP($J,"ECLOCATION",CNT)=LOC_U_$P(NODE,U)_U_ST_U_CLOC_U_ECFT_U_ECSN
"RTN","ECUMRPC2",35,0)
 S RESULTS=$NA(^TMP($J,"ECLOCATION"))
"RTN","ECUMRPC2",36,0)
 Q
"RTN","ECUMRPC2",37,0)
CPTFND(RESULTS,ECARY) ;
"RTN","ECUMRPC2",38,0)
 ;
"RTN","ECUMRPC2",39,0)
 ;This broker entry point does a search on a CPT string and returns
"RTN","ECUMRPC2",40,0)
 ;a list of matches from file #81
"RTN","ECUMRPC2",41,0)
 ;        RPC: EC GETCPTLST
"RTN","ECUMRPC2",42,0)
 ;INPUTS      ECARY   - Contains the following subscripted elements
"RTN","ECUMRPC2",43,0)
 ;             CPTSTR - CPT search string
"RTN","ECUMRPC2",44,0)
 ;
"RTN","ECUMRPC2",45,0)
 ;OUTPUTS     RESULTS - The array of cpt codes. Data pieces as follows:-
"RTN","ECUMRPC2",46,0)
 ;             CPT ien^CPT code^Name
"RTN","ECUMRPC2",47,0)
 ;
"RTN","ECUMRPC2",48,0)
 N CPTSTR,ECNT,DIC,ECTG,ECER
"RTN","ECUMRPC2",49,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC2",50,0)
 S CPTSTR=$P(ECARY,U),ECNT=0 I CPTSTR="" Q
"RTN","ECUMRPC2",51,0)
 K ^TMP($J,"ECPTSRCH"),^TMP("ECCPT",$J)
"RTN","ECUMRPC2",52,0)
 D CPTSRH(81,CPTSTR)
"RTN","ECUMRPC2",53,0)
 F  S ECNT=$O(^TMP("ECCPT",$J,"DILIST","ID",ECNT)) Q:'ECNT  D
"RTN","ECUMRPC2",54,0)
 .S ^TMP($J,"ECPTSRCH",ECNT)=$G(^TMP("ECCPT",$J,"DILIST",2,ECNT))_U_^TMP("ECCPT",$J,"DILIST","ID",ECNT,.01)_U_^TMP("ECCPT",$J,"DILIST","ID",ECNT,2)
"RTN","ECUMRPC2",55,0)
 K ^TMP("ECCPT",$J)
"RTN","ECUMRPC2",56,0)
 S RESULTS=$NA(^TMP($J,"ECPTSRCH"))
"RTN","ECUMRPC2",57,0)
 Q
"RTN","ECUMRPC2",58,0)
 ;
"RTN","ECUMRPC2",59,0)
PXFND(RESULTS,ECARY) ;
"RTN","ECUMRPC2",60,0)
 ;
"RTN","ECUMRPC2",61,0)
 ;This broker entry point does a search on a procedure string and returns
"RTN","ECUMRPC2",62,0)
 ;a list of matches from file #81 and/or #725
"RTN","ECUMRPC2",63,0)
 ;        RPC: EC GETPXLST
"RTN","ECUMRPC2",64,0)
 ;INPUTS      ECARY   - Contains the following subscripted elements
"RTN","ECUMRPC2",65,0)
 ;             PXSTR -  Procedure search string
"RTN","ECUMRPC2",66,0)
 ;
"RTN","ECUMRPC2",67,0)
 ;OUTPUTS     RESULTS - The array of procedures. Data pieces as follows:-
"RTN","ECUMRPC2",68,0)
 ;             Procedure ien^Procedure code  Procedure Name
"RTN","ECUMRPC2",69,0)
 ;
"RTN","ECUMRPC2",70,0)
 N CPTSTR,ECNT,DIC,ECX,CNT,ECTG,ECER,PXSTR,ECSTR
"RTN","ECUMRPC2",71,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC2",72,0)
 S PXSTR=$P(ECARY,U),ECNT=0 I PXSTR="" Q
"RTN","ECUMRPC2",73,0)
 K ^TMP($J,"ECPXSRCH"),^TMP("ECCPT",$J),^TMP("ECCPT1",$J)
"RTN","ECUMRPC2",74,0)
 D 
"RTN","ECUMRPC2",75,0)
 . I $P(PXSTR,".")="A" D CPTSRH(81,$P(PXSTR,".",2)) Q
"RTN","ECUMRPC2",76,0)
 . I $P(PXSTR,".")="B" D CPTSRH(725,$P(PXSTR,".",2)) Q
"RTN","ECUMRPC2",77,0)
 . F ECX=81,725 D CPTSRH(ECX,PXSTR)
"RTN","ECUMRPC2",78,0)
 F  S ECNT=$O(^TMP("ECCPT",$J,"DILIST","ID",ECNT)) Q:'ECNT  D
"RTN","ECUMRPC2",79,0)
 .S ECID=$G(^TMP("ECCPT",$J,"DILIST",2,ECNT))_";ICPT("
"RTN","ECUMRPC2",80,0)
 .S ECSTR=^TMP("ECCPT",$J,"DILIST","ID",ECNT,.01)_"  "_^(2)
"RTN","ECUMRPC2",81,0)
 .S ^TMP($J,"ECPXSRCH",ECNT)=ECID_U_ECSTR
"RTN","ECUMRPC2",82,0)
 S ECNT=0,CNT=+$O(^TMP($J,"ECPXSRCH","A"),-1)
"RTN","ECUMRPC2",83,0)
 F  S ECNT=$O(^TMP("ECCPT1",$J,"DILIST","ID",ECNT)) Q:'ECNT  D
"RTN","ECUMRPC2",84,0)
 .S CNT=CNT+1,ECID=$G(^TMP("ECCPT1",$J,"DILIST",2,ECNT))_";EC(725,"
"RTN","ECUMRPC2",85,0)
 .S ECSTR=^TMP("ECCPT1",$J,"DILIST","ID",ECNT,1)_"  "_^(.01)
"RTN","ECUMRPC2",86,0)
 .S ^TMP($J,"ECPXSRCH",CNT)=ECID_U_ECSTR  ;$G(^TMP("ECCPT1",$J,"DILIST",1,ECNT))
"RTN","ECUMRPC2",87,0)
 K ^TMP("ECCPT",$J),^TMP("ECCPT1",$J)
"RTN","ECUMRPC2",88,0)
 S RESULTS=$NA(^TMP($J,"ECPXSRCH"))
"RTN","ECUMRPC2",89,0)
 Q
"RTN","ECUMRPC2",90,0)
CPTSRH(FILE,CPTSTR) ;Searches either file 81 or 725 for a CPT string
"RTN","ECUMRPC2",91,0)
 I FILE=81 D
"RTN","ECUMRPC2",92,0)
 .D FINDIC(81,"",".01;2","M",CPTSTR,100,"","I '$P(^(0),""^"",4)","","^TMP(""ECCPT"",$J)")
"RTN","ECUMRPC2",93,0)
 I FILE=725 D
"RTN","ECUMRPC2",94,0)
 .D FINDIC(725,"",".01;1","M",CPTSTR,100,"","I '$P(^(0),""^"",3)","","^TMP(""ECCPT1"",$J)")
"RTN","ECUMRPC2",95,0)
 Q
"RTN","ECUMRPC2",96,0)
FINDIC(ECFL,ECIEN,ECFLD,ECFLG,ECVAL,ECN,ECINDX,ECSCN,ECID,ECTG,ECER) ;
"RTN","ECUMRPC2",97,0)
 ;Find records in a file base on search string
"RTN","ECUMRPC2",98,0)
 S ECER=$G(ECER)
"RTN","ECUMRPC2",99,0)
 D FIND^DIC(ECFL,ECIEN,ECFLD,ECFLG,ECVAL,ECN,ECINDX,ECSCN,ECID,ECTG,ECER)
"RTN","ECUMRPC2",100,0)
 K ECFL,ECIEN,ECFLD,ECFLG,ECVAL,ECN,ECINDX,ECSCN,ECID
"RTN","ECUMRPC2",101,0)
 Q
"RTN","ECUMRPC2",102,0)
PROV ;Return a set of providers from the NEW PERSON file
"RTN","ECUMRPC2",103,0)
 ;Input Variables:-
"RTN","ECUMRPC2",104,0)
 ;  FROM   - text to $O from
"RTN","ECUMRPC2",105,0)
 ;  DATE   - checks for an active person class on this date (optional)
"RTN","ECUMRPC2",106,0)
 ;  ECDIR  - $O direction
"RTN","ECUMRPC2",107,0)
 ;  KEY    - screen users by security key (optional)
"RTN","ECUMRPC2",108,0)
 ;
"RTN","ECUMRPC2",109,0)
 ;Output Variables:-
"RTN","ECUMRPC2",110,0)
 ;  ^TMP($J,"ECFIND",1..n - returned array
"RTN","ECUMRPC2",111,0)
 ;     IEN of file 200^Provider Name^occupation^speciality^subspeciality
"RTN","ECUMRPC2",112,0)
 ;
"RTN","ECUMRPC2",113,0)
 N I,IEN,CNT,FROM,DATE,ECUTN S I=0,CNT=44  ;KEY="PROVIDER"
"RTN","ECUMRPC2",114,0)
 S FROM=$P(ECSTR,"|"),DATE=$P(ECSTR,"|",2)
"RTN","ECUMRPC2",115,0)
 F  Q:I'<CNT  S FROM=$O(^VA(200,"B",FROM),ECDIR) Q:FROM=""  D
"RTN","ECUMRPC2",116,0)
 . S IEN="" F  S IEN=$O(^VA(200,"B",FROM,IEN),ECDIR) Q:'IEN  D 
"RTN","ECUMRPC2",117,0)
 . . ;I $L(KEY),'$D(^XUSEC(KEY,+IEN)) Q
"RTN","ECUMRPC2",118,0)
 . . ;I +$G(ALLUSERS)=0,'$$ACTIVE^XUSER(IEN) Q  ; terminated user
"RTN","ECUMRPC2",119,0)
 . . S ECUTN=$$GET^XUA4A72(IEN,DATE)
"RTN","ECUMRPC2",120,0)
 . . I DATE>0,ECUTN<1 Q
"RTN","ECUMRPC2",121,0)
 . . S I=I+1,^TMP($J,"ECFIND",I)=IEN_"^"_FROM_"^"_$P(ECUTN,"^",2,4)
"RTN","ECUMRPC2",122,0)
 Q
"VER")
8.0^22
**END**
**END**
