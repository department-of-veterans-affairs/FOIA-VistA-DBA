Released SD*5.3*358 SEQ #401
Extracted from mail message
**KIDS**:SD*5.3*358^

**INSTALL NAME**
SD*5.3*358
"BLD",5853,0)
SD*5.3*358^SCHEDULING^0^3051227^y
"BLD",5853,1,0)
^^3^3^3051227^^
"BLD",5853,1,1,0)
Options 'Veterans Without Activity Since A Specified Date' [SCRPW 
"BLD",5853,1,2,0)
VETS W/OUT ACTIVITY' and 'SC Veterans Awaiting Appointments' [SCRPW SC
"BLD",5853,1,3,0)
VETS AWAITING APPTS] have been modified to display a disclaimer.
"BLD",5853,4,0)
^9.64PA^^
"BLD",5853,6)
15^
"BLD",5853,"ABPKG")
n
"BLD",5853,"KRN",0)
^9.67PA^8989.52^19
"BLD",5853,"KRN",.4,0)
.4
"BLD",5853,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5853,"KRN",.401,0)
.401
"BLD",5853,"KRN",.402,0)
.402
"BLD",5853,"KRN",.403,0)
.403
"BLD",5853,"KRN",.5,0)
.5
"BLD",5853,"KRN",.84,0)
.84
"BLD",5853,"KRN",3.6,0)
3.6
"BLD",5853,"KRN",3.8,0)
3.8
"BLD",5853,"KRN",9.2,0)
9.2
"BLD",5853,"KRN",9.8,0)
9.8
"BLD",5853,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5853,"KRN",9.8,"NM",1,0)
SCRPW41^^0^B66016831
"BLD",5853,"KRN",9.8,"NM",2,0)
SCRPW62^^0^B30887240
"BLD",5853,"KRN",9.8,"NM","B","SCRPW41",1)

"BLD",5853,"KRN",9.8,"NM","B","SCRPW62",2)

"BLD",5853,"KRN",19,0)
19
"BLD",5853,"KRN",19.1,0)
19.1
"BLD",5853,"KRN",101,0)
101
"BLD",5853,"KRN",409.61,0)
409.61
"BLD",5853,"KRN",771,0)
771
"BLD",5853,"KRN",870,0)
870
"BLD",5853,"KRN",8989.51,0)
8989.51
"BLD",5853,"KRN",8989.52,0)
8989.52
"BLD",5853,"KRN",8994,0)
8994
"BLD",5853,"KRN","B",.4,.4)

"BLD",5853,"KRN","B",.401,.401)

"BLD",5853,"KRN","B",.402,.402)

"BLD",5853,"KRN","B",.403,.403)

"BLD",5853,"KRN","B",.5,.5)

"BLD",5853,"KRN","B",.84,.84)

"BLD",5853,"KRN","B",3.6,3.6)

"BLD",5853,"KRN","B",3.8,3.8)

"BLD",5853,"KRN","B",9.2,9.2)

"BLD",5853,"KRN","B",9.8,9.8)

"BLD",5853,"KRN","B",19,19)

"BLD",5853,"KRN","B",19.1,19.1)

"BLD",5853,"KRN","B",101,101)

"BLD",5853,"KRN","B",409.61,409.61)

"BLD",5853,"KRN","B",771,771)

"BLD",5853,"KRN","B",870,870)

"BLD",5853,"KRN","B",8989.51,8989.51)

"BLD",5853,"KRN","B",8989.52,8989.52)

"BLD",5853,"KRN","B",8994,8994)

"BLD",5853,"QUES",0)
^9.62^^
"BLD",5853,"REQB",0)
^9.611^5^2
"BLD",5853,"REQB",4,0)
SD*5.3*375^2
"BLD",5853,"REQB",5,0)
SD*5.3*269^2
"BLD",5853,"REQB","B","SD*5.3*269",5)

"BLD",5853,"REQB","B","SD*5.3*375",4)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930925
"PKG",16,22,1,"PAH",1,0)
358^3051227^22950
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3051227
"PKG",16,22,1,"PAH",1,1,1,0)
Options 'Veterans Without Activity Since A Specified Date' [SCRPW 
"PKG",16,22,1,"PAH",1,1,2,0)
VETS W/OUT ACTIVITY' and 'SC Veterans Awaiting Appointments' [SCRPW SC
"PKG",16,22,1,"PAH",1,1,3,0)
VETS AWAITING APPTS] have been modified to display a disclaimer.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","SCRPW41")
0^1^B66016831^B64634157
"RTN","SCRPW41",1,0)
SCRPW41 ;RENO/KEITH - Veterans Without Activity Since a Specified Date Range ; 5/25/2004
"RTN","SCRPW41",2,0)
 ;;5.3;Scheduling;**144,375,358**;AUG 13, 1993
"RTN","SCRPW41",3,0)
 N DIR,%DT K SD
"RTN","SCRPW41",4,0)
 D TITL^SCRPW50("Veterans Without Activity Since a Specified Date Range")
"RTN","SCRPW41",5,0)
 W !!,"This report will return a list of veterans that are not deceased who had",!,"activity during a date range specified by the user, and have not been seen"
"RTN","SCRPW41",6,0)
 W !,"since.  Activity is determined by an examination of Fee Basis, inpatient and",!,"outpatient care (including future appointments).  Once the scheduling"
"RTN","SCRPW41",7,0)
 W !,"replacement application has been implemented at your site, this report will",!,"no longer be accurate."
"RTN","SCRPW41",8,0)
 D SUBT^SCRPW50("**** Date Range Selection ****")
"RTN","SCRPW41",9,0)
 W ! S %DT="AEPX",%DT("A")="Beginning date: " D ^%DT G:Y<1 EXIT^SCRPW42 S SD("BDT")=Y X ^DD("DD") S SD("PBDT")=Y
"RTN","SCRPW41",10,0)
EDT S %DT("A")="   Ending date: " W ! D ^%DT G:Y<1 EXIT^SCRPW42
"RTN","SCRPW41",11,0)
 I Y<SD("BDT") W !!,$C(7),"End date cannot be before begin date!",! G EDT
"RTN","SCRPW41",12,0)
 S SD("EDT")=Y_.999999 X ^DD("DD") S SD("PEDT")=Y,(SDOUT,SDNUL)=0
"RTN","SCRPW41",13,0)
 D BLD^SCRPW21 S SDX="" D SUBT^SCRPW50("**** Output Sort Selection (optional) ****") S DIR("?")="Sort elements selected will determine the order of output.",(SD("PAGE"),SD("SORT"))=0
"RTN","SCRPW41",14,0)
 F SDI=1:1:6 S T="~",DIR("A")=$S(SDX="":"Specify data element to sort by",1:"Within "_SDX_", sort by") D ASK Q:SDOUT!SDNUL
"RTN","SCRPW41",15,0)
 G:SDOUT EXIT^SCRPW42 D SUBT^SCRPW50("**** Parameters Selected ****") W !!,"Veterans not seen since the date range: ",SD("PBDT")," to ",SD("PEDT"),!!,"Output sort elements: " D
"RTN","SCRPW41",16,0)
 .I SD("SORT")=0 W "(NONE SELECTED)" Q
"RTN","SCRPW41",17,0)
 .S SDI=0 F  S SDI=$O(SD("SORT",SDI)) Q:'SDI  S SDX=SD("SORT",SDI) W:SDI>1 ! W ?(19+(3*SDI)) S SDL=$S($P(SDX,U,3):(69-$X),1:(80-$X)) W $E($P(SDX,U,2),1,SDL)_$S($P(SDX,U,3):" <pagefeed>",1:"")
"RTN","SCRPW41",18,0)
 .Q
"RTN","SCRPW41",19,0)
 K DIR S DIR(0)="Y",DIR("A")="Ok",DIR("B")="YES",DIR("?")="Specify if the parameters are satisfactory as displayed." W ! D ^DIR G:$D(DTOUT)!$D(DUOUT) EXIT^SCRPW42 G:'Y EXIT^SCRPW42
"RTN","SCRPW41",20,0)
 N ZTSAVE S ZTSAVE("SD(")="" W !!,"This report requires 132 column output.",!
"RTN","SCRPW41",21,0)
 D EN^XUTMDEVQ("START^SCRPW41","Veterans Without Activity Since a Specified Date",.ZTSAVE) G EXIT^SCRPW42
"RTN","SCRPW41",22,0)
 ;
"RTN","SCRPW41",23,0)
ASK ;Ask for sort elements
"RTN","SCRPW41",24,0)
 N SDZ I $L(SDX) D SUBT^SCRPW50("**** Select "_$S(SDI=2:"second",SDI=3:"third",SDI=4:"fourth",SDI=5:"fifth",SDI=6:"sixth",1:"another")_" sort element (optional) ****")
"RTN","SCRPW41",25,0)
 K DIR(0) S S1=$$DIR^SCRPW23(.DIR,1,"","","O",2) Q:SDOUT!SDNUL
"RTN","SCRPW41",26,0)
 K DIR(0) S DIR("A")="Select "_$P(S1,U,2)_" data element",S2=$$DIR^SCRPW23(.DIR,2,"",$P(S1,U),"O",2,1) Q:SDOUT  I SDNUL S SDNUL=0 G ASK
"RTN","SCRPW41",27,0)
 S SDX=$P(S2,U,2),SD("SORT",SDI)=$P(S1,U)_$P(S2,U)_U_SDX_U_$$PF(),SD("SORT")=SD("SORT")+1 Q
"RTN","SCRPW41",28,0)
 ;
"RTN","SCRPW41",29,0)
PF() ;Prompt for page feed
"RTN","SCRPW41",30,0)
 N DIR S DIR(0)="Y",DIR("A")="Perform a pagefeed for each new "_SDX_" value",DIR("B")="NO",DIR("?")="Specify if you want a pagefeed between each sort value for this element." W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q 0
"RTN","SCRPW41",31,0)
 S:Y SD("PAGE")=SDI Q Y
"RTN","SCRPW41",32,0)
 ;
"RTN","SCRPW41",33,0)
START ;Print report
"RTN","SCRPW41",34,0)
 K ^TMP("SCRPW",$J) D BLD^SCRPW21 S (SDOUT,SDSTOP,DFN)=0 D NOW^%DTC S SDNOW=%,T="~"
"RTN","SCRPW41",35,0)
 S SDFEE=""
"RTN","SCRPW41",36,0)
 F  S DFN=$O(^DPT(DFN)) Q:'DFN  S SDSTOP=SDSTOP+1 D:SDSTOP#3000=0 STOP Q:SDOUT  I $$VET() S SDX=$$EVAL(SD("BDT"),SD("EDT")) D:$P(SDX,U)=2 SET
"RTN","SCRPW41",37,0)
 G:SDOUT EXIT^SCRPW42 D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDLINE="",$P(SDLINE,"-",133)="",SDPAGE=1,(SDTOT,SDPG)=0 G ^SCRPW42
"RTN","SCRPW41",38,0)
 ;
"RTN","SCRPW41",39,0)
VET() ;Vet?  Alive?  Eligible?
"RTN","SCRPW41",40,0)
 D DEM^VADPT Q:VADM(6) 0  ;deceased
"RTN","SCRPW41",41,0)
 D ELIG^VADPT Q:'VAEL(4) 0  ;veteran
"RTN","SCRPW41",42,0)
 Q VAEL(5)  ;eligible
"RTN","SCRPW41",43,0)
 ;
"RTN","SCRPW41",44,0)
EVAL(SDBD,SDED) ;Evaluate last activity
"RTN","SCRPW41",45,0)
 ;Required input: SDBD=begin date of date range
"RTN","SCRPW41",46,0)
 ;Required input: SDED=end date of date range
"RTN","SCRPW41",47,0)
 ;Output: code^last activity date^location, where 'code'=
"RTN","SCRPW41",48,0)
 ;        1=activity since date range
"RTN","SCRPW41",49,0)
 ;        2=activity during date range, none since
"RTN","SCRPW41",50,0)
 ;        3=no activity during or after date range
"RTN","SCRPW41",51,0)
 N SDDT,SDX,SDXX,SDY
"RTN","SCRPW41",52,0)
 S SDX=$O(^SCE("ADFN",DFN,9999999),-1) I SDX S SDY=$O(^SCE("ADFN",DFN,SDX,0)),SDY=$$GETOE^SDOE(SDY),SDY=$P($G(^SC(+$P(SDY,U,4),0)),U),SDDT(SDX)=SDY
"RTN","SCRPW41",53,0)
 S SDX=$O(^DPT(DFN,"S",9999999),-1) I SDX S SDY=+$G(^DPT(DFN,"S",SDX,0)),SDY=$P($G(^SC(+SDY,0)),U),SDDT(SDX)=SDY
"RTN","SCRPW41",54,0)
 S SDX=$O(^DPT(DFN,"DIS",0)) I SDX S SDDT(9999999-SDX)="REGISTRATION"
"RTN","SCRPW41",55,0)
 S SDX=$O(^SDV("ADT",DFN,9999999),-1) I SDX S SDDT(SDX)="ADD/EDIT"
"RTN","SCRPW41",56,0)
 ;S SDX=$O(^FBAAA(DFN,1,9999999),-1) I SDX S SDX=$P($G(^FBAAA(DFN,1,SDX,0)),U) I SDX S SDDT(SDX)="FEE BASIS"
"RTN","SCRPW41",57,0)
 S SDXX=$$AUTHL^FBUTL(DFN,,SDBD,"SDX") D
"RTN","SCRPW41",58,0)
 .I +SDXX=-1,$P(SDXX,"^",2)=110 S SDFEE="FEE BASIS SYSTEM NOT AVAILABLE"
"RTN","SCRPW41",59,0)
 .I SDXX>0 S SDDT($G(SDX(SDXX,"FDT")))="FEE BASIS"
"RTN","SCRPW41",60,0)
 S SDX=$O(^DGPM("APRD",DFN,9999999),-1) I SDX S SDY=$O(^DGPM("APRD",DFN,SDX,0)),SDY=$G(^DGPM(+SDY,0)) I $L(SDY) D
"RTN","SCRPW41",61,0)
 .I $P(SDY,U,2)=1 S SDDT(SDX)=$P($G(^DIC(42,+$P(SDY,U,6),0)),U) Q
"RTN","SCRPW41",62,0)
 .I $P(SDY,U,2)=3 N D0,X S D0=$O(^DGPM("APRD",DFN,SDX,0)) D WARD^DGPMUTL S SDDT(SDX)=X Q
"RTN","SCRPW41",63,0)
 .D WARD(SDX) Q
"RTN","SCRPW41",64,0)
 D WARD(SDNOW)
"RTN","SCRPW41",65,0)
 S SDX=$O(SDDT(9999999),-1),SDX=$S('$L(SDX):U_U,1:U_SDX_U_SDDT(SDX))
"RTN","SCRPW41",66,0)
 Q:$P(SDX,U,2)'<SDED 1_SDX  Q:$P(SDX,U,2)'<SDBD 2_SDX  Q 3_SDX
"RTN","SCRPW41",67,0)
 ;
"RTN","SCRPW41",68,0)
WARD(SDT) ;Get ward for date/time
"RTN","SCRPW41",69,0)
 ;Required input: SDT=date/time
"RTN","SCRPW41",70,0)
 N DGT,DG1,DGA1,DGXFR0 S DGT=SDT D ^DGPMSTAT I DG1 S SDDT(SDT)=$P($G(^DIC(42,DG1,0)),U)
"RTN","SCRPW41",71,0)
 Q
"RTN","SCRPW41",72,0)
 ;
"RTN","SCRPW41",73,0)
SET ;Set TMP global
"RTN","SCRPW41",74,0)
 S SD0=$G(^DPT(DFN,0)),SDSSN=$P(SD0,U,9),SDPNAM=$P(SD0,U) Q:'$L(SDPNAM)  S $P(SDX,U)=SDSSN
"RTN","SCRPW41",75,0)
 N SDS I SD("SORT") S SDI="" F  S SDI=$O(SD("SORT",SDI)) Q:'SDI  S SDS(SDI)=$$SORT($P(SD("SORT",SDI),U))
"RTN","SCRPW41",76,0)
 I 'SD("SORT") S ^TMP("SCRPW",$J,1,SDPNAM,DFN)=SDX Q
"RTN","SCRPW41",77,0)
 I SD("SORT")=1 S ^TMP("SCRPW",$J,1,SDS(1),SDPNAM,DFN)=SDX Q
"RTN","SCRPW41",78,0)
 I SD("SORT")=2 S ^TMP("SCRPW",$J,1,SDS(1),SDS(2),SDPNAM,DFN)=SDX Q
"RTN","SCRPW41",79,0)
 I SD("SORT")=3 S ^TMP("SCRPW",$J,1,SDS(1),SDS(2),SDS(3),SDPNAM,DFN)=SDX Q
"RTN","SCRPW41",80,0)
 S SDUI=$$DSV^SCRPW42(SDS(1),SDS(2),SDS(3),SDS(4))
"RTN","SCRPW41",81,0)
 I SD("SORT")=4 S ^TMP("SCRPW",$J,1,SDS(1),SDS(2),SDS(3),SDS(4))="",^TMP("SCRPW",$J,2,SDUI,SDPNAM,DFN)=SDX Q
"RTN","SCRPW41",82,0)
 I SD("SORT")=5 S ^TMP("SCRPW",$J,1,SDS(1),SDS(2),SDS(3),SDS(4))="",^TMP("SCRPW",$J,2,SDUI,SDS(5),SDPNAM,DFN)=SDX Q
"RTN","SCRPW41",83,0)
 I SD("SORT")=6 S ^TMP("SCRPW",$J,1,SDS(1),SDS(2),SDS(3),SDS(4))="",^TMP("SCRPW",$J,2,SDUI,SDS(5),SDS(6),SDPNAM,DFN)=SDX
"RTN","SCRPW41",84,0)
 Q
"RTN","SCRPW41",85,0)
 ;
"RTN","SCRPW41",86,0)
SORT(SDACR) ;Return sort value
"RTN","SCRPW41",87,0)
 ;Required input: SDACR=data element acronym
"RTN","SCRPW41",88,0)
 N SDACT,SDX,SDOE0
"RTN","SCRPW41",89,0)
 S SDOE0=U_DFN_U,SDACT=^TMP("SCRPW",$J,"ACT",SDACR) X $P(SDACT,T,7)
"RTN","SCRPW41",90,0)
 S SDX=$O(SDX("")) Q $P(SDX(SDX),U,2)
"RTN","SCRPW41",91,0)
 ;
"RTN","SCRPW41",92,0)
STOP ;Check for stop task request
"RTN","SCRPW41",93,0)
 S:$D(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW41",94,0)
 ;
"RTN","SCRPW41",95,0)
ASK1 ;Prompt for 'Means Test/Eligibility/Enrollment Report' parameters
"RTN","SCRPW41",96,0)
 N SD,SDDIV,%DT,X,Y,DIR,SDOUT,SDNUL S (SDOUT,SDNUL,SD("SORT"))=0
"RTN","SCRPW41",97,0)
 D TITL^SCRPW50("Means Test/Eligibility/Enrollment Report")
"RTN","SCRPW41",98,0)
 G:'$$DIVA^SCRPW17(.SDDIV) EXIT1^SCRPW42
"RTN","SCRPW41",99,0)
 D SUBT^SCRPW50("**** Date Range Selection ****")
"RTN","SCRPW41",100,0)
 W ! S %DT="AEPX",%DT(0)=2961001,%DT("A")="Beginning date: " D ^%DT G:Y<1 EXIT1^SCRPW42 S SD("BDT")=Y X ^DD("DD") S $P(SD("BDT"),U,2)=Y
"RTN","SCRPW41",101,0)
EDT1 S %DT("A")="   Ending date: " W ! D ^%DT G:Y<1 EXIT1^SCRPW42
"RTN","SCRPW41",102,0)
 I Y<SD("BDT") W !!,$C(7),"End date cannot be before begin date!",! G EDT1
"RTN","SCRPW41",103,0)
 S SD("EDT")=Y_.999999 X ^DD("DD") S $P(SD("EDT"),U,2)=Y
"RTN","SCRPW41",104,0)
 D SUBT^SCRPW50("**** Report Format Selection ****")
"RTN","SCRPW41",105,0)
 K DIR S DIR(0)="S^D:DETAILED;S:SUMMARY",DIR("A")="Select report format",DIR("?",1)="Specify the format of report you wish to print.  'Detailed' allows the printing",DIR("?")="of patient lists, 'summary' produces totals only."
"RTN","SCRPW41",106,0)
 S DIR("B")="SUMMARY" D ^DIR G:$D(DTOUT)!$D(DUOUT) EXIT1^SCRPW42 S SD("FMT",1)=Y_U_Y(0)  G:Y="S" STAT
"RTN","SCRPW41",107,0)
 D SUBT^SCRPW50("**** Detail Category Selection ****")
"RTN","SCRPW41",108,0)
 K DIR S DIR(0)="S^MT:MEANS TEST INDICATOR;EE:ENCOUNTER ELIGIBILITY;EP:ENROLLMENT PRIORITY",DIR("A")="Select category for detail",DIR("?")="This determines how output will be sorted."
"RTN","SCRPW41",109,0)
 D ^DIR G:$D(DTOUT)!$D(DUOUT) EXIT1^SCRPW42 S SD("FMT",2)=Y_U_Y(0) D SCAT^SCRPW43 G:'$D(SD("FMT",3))!SDOUT EXIT1^SCRPW42
"RTN","SCRPW41",110,0)
 S SDNUL=0 D BLD^SCRPW21 S SDX="" D SUBT^SCRPW50("**** Output Sort Selection (optional) ****") S DIR("?")="Sort elements selected will determine the order of output.",(SD("PAGE"),SD("SORT"))=0
"RTN","SCRPW41",111,0)
 F SDI=1:1:6 S T="~",DIR("A")=$S(SDX="":"Specify data element to sort by",1:"Within "_SDX_", sort by") D ASK^SCRPW41 Q:SDOUT!SDNUL
"RTN","SCRPW41",112,0)
STAT ;Prompt for encounter statuses to include
"RTN","SCRPW41",113,0)
 D SUBT^SCRPW50("**** Encounter Status Selection ****")
"RTN","SCRPW41",114,0)
 K SD("STAT") W !!,"Choose as many of the following statuses",!,"as you wish to include in the report:",!
"RTN","SCRPW41",115,0)
 W !?10,"CHECKED IN",!?10,"CHECKED OUT",!?10,"NO ACTION TAKEN",!?10,"INPATIENT APPOINTMENT",!?10,"NON-COUNT",!?10,"ACTION REQUIRED",! N DIC,I S DIC="^SD(409.63,",DIC(0)="AEMQ",DIC("B")="CHECKED OUT"
"RTN","SCRPW41",116,0)
 S DIC("S")="I Y<4!(Y=8!(Y=12!(Y=14)))",DIC("A")="Select encounter status: " F I=1:1 D ^DIC Q:$D(DTOUT)!$D(DUOUT)  S:Y>0 SD("STAT",$P(Y,U))=$P(Y,U,2) K DIC("B") Q:X=""&(I>1)
"RTN","SCRPW41",117,0)
 G:'$D(SD("STAT")) EXIT1^SCRPW42 D PDIS^SCRPW43 G:SDOUT EXIT1^SCRPW42
"RTN","SCRPW41",118,0)
 N ZTSAVE S ZTSAVE("SD(")="",ZTSAVE("SDDIV(")="",ZTSAVE("SDDIV")=""
"RTN","SCRPW41",119,0)
 W:$P(SD("FMT",1),U)="D" !!,"This report requires 132 column output." W ! D EN^XUTMDEVQ("START^SCRPW43","Means Test/Eligibility/Enrollment Report",.ZTSAVE),DISP0^SCRPW23 G EXIT1^SCRPW42
"RTN","SCRPW62")
0^2^B30887240^B29679989
"RTN","SCRPW62",1,0)
SCRPW62 ;BP-CIOFO/KEITH - SC veterans awaiting appointments ; 23 August 2002@20:23
"RTN","SCRPW62",2,0)
 ;;5.3;Scheduling;**267,269,358**;AUG 13, 1993
"RTN","SCRPW62",3,0)
 ;
"RTN","SCRPW62",4,0)
 ;Prompt for report parameters
"RTN","SCRPW62",5,0)
 ;
"RTN","SCRPW62",6,0)
 N SDOUT,DIR,DTOUT,DUOUT,SDFMT,SDATES,SDDIV,SDRPT,SDSCVT
"RTN","SCRPW62",7,0)
 N SDELIM,SDX,ZTSAVE,X,Y
"RTN","SCRPW62",8,0)
 S SDOUT=0
"RTN","SCRPW62",9,0)
 D TITL^SCRPW50("SC Veterans Awaiting Appointments")
"RTN","SCRPW62",10,0)
 W !,"Note: Once the scheduling replacement application has been implemented at your"
"RTN","SCRPW62",11,0)
 W !,"site, this report will no longer be accurate."
"RTN","SCRPW62",12,0)
RPT D SUBT^SCRPW50("**** Report Type Selection ****")
"RTN","SCRPW62",13,0)
 S DIR(0)="S^E:ENTERED WITH NO APPOINTMENT PROVIDED;A:APPOINTMENTS BEYOND DATE DESIRED",DIR("A")="Select report type"
"RTN","SCRPW62",14,0)
 S DIR("?",1)="Specify 'E' to return SC veterans entered but not yet provided an appointment,"
"RTN","SCRPW62",15,0)
 S DIR("?")="'A' to return SC veterans with appointments beyond the date desired."
"RTN","SCRPW62",16,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 G EXIT
"RTN","SCRPW62",17,0)
 K DIR S SDRPT=Y D ENT:SDRPT="E",APPT:SDRPT="A" G:SDOUT EXIT
"RTN","SCRPW62",18,0)
 D SUBT^SCRPW50("**** Patient Eligibility Selection ****")
"RTN","SCRPW62",19,0)
 S DIR(0)="S^1:50-100% SC Veterans;2:0-50% SC Veterans;3:All SC Veterans"
"RTN","SCRPW62",20,0)
 S DIR("A")="Select eligibility type"
"RTN","SCRPW62",21,0)
 S DIR("?")="Specify the eligibility of the patients you wish to include."
"RTN","SCRPW62",22,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 G EXIT
"RTN","SCRPW62",23,0)
 K DIR S SDSCVT=Y
"RTN","SCRPW62",24,0)
FMT D SUBT^SCRPW50("**** Report Format Selection ****")
"RTN","SCRPW62",25,0)
 S DIR(0)="S^D:DETAILED REPORT;S:STATISTICS ONLY"
"RTN","SCRPW62",26,0)
 S DIR("A")="Select report format"
"RTN","SCRPW62",27,0)
 S DIR("?")="Specify the report format desired."
"RTN","SCRPW62",28,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 G EXIT
"RTN","SCRPW62",29,0)
 K DIR S SDFMT=Y
"RTN","SCRPW62",30,0)
 I SDFMT="S" S SDELIM=0 G QUE
"RTN","SCRPW62",31,0)
 D SUBT^SCRPW50("**** Output Format Selection ****")
"RTN","SCRPW62",32,0)
 S DIR(0)="Y",DIR("A")="Return report output in delimited format"
"RTN","SCRPW62",33,0)
 S DIR("B")="NO"
"RTN","SCRPW62",34,0)
 S DIR("?",1)="Specify if you would like the report output to be in delimited format for"
"RTN","SCRPW62",35,0)
 S DIR("?",2)="transfer to a spreadsheet.  The delimited output will not include rated SC"
"RTN","SCRPW62",36,0)
 S DIR("?")="disabilities for 0-50% SC veterans (as included in the text formatted report)."
"RTN","SCRPW62",37,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 G EXIT
"RTN","SCRPW62",38,0)
 S SDELIM=Y
"RTN","SCRPW62",39,0)
 ;
"RTN","SCRPW62",40,0)
QUE ;Queue output
"RTN","SCRPW62",41,0)
 W !!,"This report requires ",$S(SDELIM:"greater than ",1:""),"132 columns for output!"
"RTN","SCRPW62",42,0)
 F SDX="SDELIM","SDRPT","SDSCVT","SDATES","SDDIV","SDDIV(","SDFMT" S ZTSAVE(SDX)=""
"RTN","SCRPW62",43,0)
 W ! D EN^XUTMDEVQ("START^SCRPW62","SC Veterans Awaiting Appointments",.ZTSAVE) D DISP0^SCRPW23
"RTN","SCRPW62",44,0)
 Q
"RTN","SCRPW62",45,0)
 ;
"RTN","SCRPW62",46,0)
ENT ;Date entered parameters
"RTN","SCRPW62",47,0)
 S SDATES=1 Q
"RTN","SCRPW62",48,0)
 ;
"RTN","SCRPW62",49,0)
 ;Following logic suppressed by request
"RTN","SCRPW62",50,0)
 D SUBT^SCRPW50("**** Report Time Frame ****")
"RTN","SCRPW62",51,0)
 S DIR(0)="S^1:THE PAST YEAR;2:THE PAST TWO YEARS;3:THE PAST 3 YEARS"
"RTN","SCRPW62",52,0)
 S DIR("A")="Include SC veterans entered during"
"RTN","SCRPW62",53,0)
 S DIR("?")="Specify the time frame in which these patients were entered in VistA."
"RTN","SCRPW62",54,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW62",55,0)
 S SDATES=Y
"RTN","SCRPW62",56,0)
 Q
"RTN","SCRPW62",57,0)
 ;
"RTN","SCRPW62",58,0)
APPT ;Appointment delay parameters
"RTN","SCRPW62",59,0)
 I '$$DIVA^SCRPW17(.SDDIV) S SDOUT=1 Q
"RTN","SCRPW62",60,0)
 S SDATES=30 Q
"RTN","SCRPW62",61,0)
 ;
"RTN","SCRPW62",62,0)
 ;Following logic suppressed by request
"RTN","SCRPW62",63,0)
 D SUBT^SCRPW50("**** Report Time Frame ****")
"RTN","SCRPW62",64,0)
 S DIR(0)="S^30:>30 DAYS BEYOND 'DESIRED DATE';60:>60 DAYS BEYOND 'DESIRED DATE;90:>90 DAYS BEYOND 'DESIRED DATE';180:>180 DAYS BEYOND 'DESIRED DATE'"
"RTN","SCRPW62",65,0)
 S DIR("A")="Include SC veterans with future appointments greater than"
"RTN","SCRPW62",66,0)
 S DIR("?")="Specify the difference between 'desired date' and the appointement date."
"RTN","SCRPW62",67,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDOUT=1 Q
"RTN","SCRPW62",68,0)
 S SDATES=Y
"RTN","SCRPW62",69,0)
 Q
"RTN","SCRPW62",70,0)
 ;
"RTN","SCRPW62",71,0)
START ;Gather report data
"RTN","SCRPW62",72,0)
 N SDSTOP,SDOUT,SDSTOP,SDPAGE,SDLINE,SDPNOW,SDT,SDX
"RTN","SCRPW62",73,0)
 I '$D(ZTQUEUED),$E(IOST)="C" D WAIT^DICD
"RTN","SCRPW62",74,0)
 K ^TMP("SCRPW",$J) S (SDSTOP,SDOUT)=0,SDPAGE=1,SDLINE=""
"RTN","SCRPW62",75,0)
 S $P(SDLINE,"-",(IOM+1))=""
"RTN","SCRPW62",76,0)
 S SDPNOW=$$FMTE^XLFDT($E($$NOW^XLFDT(),1,12))
"RTN","SCRPW62",77,0)
 S SDX=$S(SDSCVT=1:"SC 50-100% ",SDSCVT=2:"SC < 50% ",1:"")
"RTN","SCRPW62",78,0)
 S SDT(1)="<*>  SC VETERANS AWAITING APPOINTMENTS  <*>"
"RTN","SCRPW62",79,0)
 S SDT(2)=$S(SDRPT="E":SDX_"PATIENTS ENTERED IN THE PAST "_$S(SDATES=1:"YEAR",1:SDATES_" YEARS")_" WITHOUT AN APPOINTMENT",1:SDX_"PATIENTS WAITING > "_SDATES_" DAYS BEYOND APPOINTMENT 'DESIRED DATE'")
"RTN","SCRPW62",80,0)
 D @(SDRPT_"^SCRPW63") W !!
"RTN","SCRPW62",81,0)
 D EXIT
"RTN","SCRPW62",82,0)
 Q
"RTN","SCRPW62",83,0)
 ;
"RTN","SCRPW62",84,0)
SCEL(SDE,SDSCVT) ;Gather SC eligibility codes
"RTN","SCRPW62",85,0)
 ;Input: SDE=array to return list of codes in the format SDE(n) where
"RTN","SCRPW62",86,0)
 ;           'n' is the ifn in file #8 (pass by reference)
"RTN","SCRPW62",87,0)
 ;       SDSCVT=type of SC vets to include
"RTN","SCRPW62",88,0)
 N SDE81,SDX,SDI,SDII
"RTN","SCRPW62",89,0)
 S SDI=0 F  S SDI=$O(^DIC(8.1,SDI)) Q:'SDI  D
"RTN","SCRPW62",90,0)
 .S SDX=$G(^DIC(8.1,SDI,0))
"RTN","SCRPW62",91,0)
 .Q:$P(SDX,U,5)'="Y"  S SDX=$P(SDX,U,4)
"RTN","SCRPW62",92,0)
 .I SDSCVT=1,SDX'=1 Q  ;50-100% SC only
"RTN","SCRPW62",93,0)
 .I SDSCVT=2,SDX'=3 Q  ;0-50% SC only
"RTN","SCRPW62",94,0)
 .I SDSCVT=3,(SDX'=1&(SDX'=3)) Q  ;SC only
"RTN","SCRPW62",95,0)
 .S SDII=0 F  S SDII=$O(^DIC(8,"D",SDI,SDII)) Q:'SDII  D
"RTN","SCRPW62",96,0)
 ..S SDE(SDII)=SDX
"RTN","SCRPW62",97,0)
 ..Q
"RTN","SCRPW62",98,0)
 .Q
"RTN","SCRPW62",99,0)
 Q
"RTN","SCRPW62",100,0)
 ;
"RTN","SCRPW62",101,0)
EXIT K ZTQUEUED,ZTSTOP,SDATES,SDDIV,SDFMT,SDRPT,SDELIM
"RTN","SCRPW62",102,0)
 D END^SCRPW50 Q
"RTN","SCRPW62",103,0)
 ;
"RTN","SCRPW62",104,0)
HDR ;Print report header
"RTN","SCRPW62",105,0)
 N X
"RTN","SCRPW62",106,0)
 I SDELIM D HDRD Q
"RTN","SCRPW62",107,0)
 I $E(IOST)="C",SDPAGE>1 N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW62",108,0)
 D STOP^SCRPW63 Q:SDOUT
"RTN","SCRPW62",109,0)
 W:SDPAGE>1!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0)
"RTN","SCRPW62",110,0)
 W:$X $$XY^SCRPW50("",0,0) W SDLINE
"RTN","SCRPW62",111,0)
 S X=0 F  S X=$O(SDT(X)) Q:'X  W !?(IOM-$L(SDT(X))\2),SDT(X)
"RTN","SCRPW62",112,0)
 W !,SDLINE,!,"Date printed: ",SDPNOW,?((IOM-6)-$L(SDPAGE)),"Page: "
"RTN","SCRPW62",113,0)
 W SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1 Q
"RTN","SCRPW62",114,0)
 ;
"RTN","SCRPW62",115,0)
HDRD ;Header for delimited report
"RTN","SCRPW62",116,0)
 Q:SDPAGE>1
"RTN","SCRPW62",117,0)
 W !,SDLINE S X=0 F  S X=$O(SDT(X)) Q:'X  W !,SDT(X)
"RTN","SCRPW62",118,0)
 W !,"Date printed: ",SDPNOW,!,SDLINE
"RTN","SCRPW62",119,0)
 W !,"NAME^SSN^PRIM. ELIG.^DATE ENTERED INTO FILE^STREET ADDRESS^CITY^STATE^ZIP^PHONE NUMBER"
"RTN","SCRPW62",120,0)
 W:SDRPT="A" "^APPOINTMENT DATE^CLINIC^CREDIT PAIR^DIVISION^DATE APPT. ENTERED^DESIRED DATE^DIFFERENCE (DESIRED DATE - APPT. DATE)^DIFFERENCE (DATE APPT. ENTERED - DESIRED DATE)"
"RTN","SCRPW62",121,0)
 S SDPAGE=SDPAGE+1 Q
"VER")
8.0^22.0
"BLD",5853,6)
^401
**END**
**END**
