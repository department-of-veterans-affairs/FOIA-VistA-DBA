Released QAC*2*20 SEQ #18
Extracted from mail message
**KIDS**:QAC*2.0*20^

**INSTALL NAME**
QAC*2.0*20
"BLD",6886,0)
QAC*2.0*20^PATIENT REPRESENTATIVE^0^3061207^y
"BLD",6886,1,0)
^^5^5^3061102^
"BLD",6886,1,1,0)
Sites are seeing Contact Numbers that do not follow the
"BLD",6886,1,2,0)
proper format. The sites are not able to enter new contact
"BLD",6886,1,3,0)
numbers because of the incorrect contact numbers.
"BLD",6886,1,4,0)
This patch will correct the bad contact numbers when the
"BLD",6886,1,5,0)
post install routine is run.
"BLD",6886,4,0)
^9.64PA^^
"BLD",6886,6)
5^
"BLD",6886,6.3)
7
"BLD",6886,"ABPKG")
n
"BLD",6886,"INID")
n^n^n
"BLD",6886,"INIT")
EN^QAC20PST
"BLD",6886,"KRN",0)
^9.67PA^8989.52^19
"BLD",6886,"KRN",.4,0)
.4
"BLD",6886,"KRN",.401,0)
.401
"BLD",6886,"KRN",.402,0)
.402
"BLD",6886,"KRN",.403,0)
.403
"BLD",6886,"KRN",.5,0)
.5
"BLD",6886,"KRN",.84,0)
.84
"BLD",6886,"KRN",3.6,0)
3.6
"BLD",6886,"KRN",3.8,0)
3.8
"BLD",6886,"KRN",9.2,0)
9.2
"BLD",6886,"KRN",9.8,0)
9.8
"BLD",6886,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6886,"KRN",9.8,"NM",1,0)
QAC20PST^^0^B20695310
"BLD",6886,"KRN",9.8,"NM","B","QAC20PST",1)

"BLD",6886,"KRN",19,0)
19
"BLD",6886,"KRN",19.1,0)
19.1
"BLD",6886,"KRN",101,0)
101
"BLD",6886,"KRN",409.61,0)
409.61
"BLD",6886,"KRN",771,0)
771
"BLD",6886,"KRN",870,0)
870
"BLD",6886,"KRN",8989.51,0)
8989.51
"BLD",6886,"KRN",8989.52,0)
8989.52
"BLD",6886,"KRN",8994,0)
8994
"BLD",6886,"KRN","B",.4,.4)

"BLD",6886,"KRN","B",.401,.401)

"BLD",6886,"KRN","B",.402,.402)

"BLD",6886,"KRN","B",.403,.403)

"BLD",6886,"KRN","B",.5,.5)

"BLD",6886,"KRN","B",.84,.84)

"BLD",6886,"KRN","B",3.6,3.6)

"BLD",6886,"KRN","B",3.8,3.8)

"BLD",6886,"KRN","B",9.2,9.2)

"BLD",6886,"KRN","B",9.8,9.8)

"BLD",6886,"KRN","B",19,19)

"BLD",6886,"KRN","B",19.1,19.1)

"BLD",6886,"KRN","B",101,101)

"BLD",6886,"KRN","B",409.61,409.61)

"BLD",6886,"KRN","B",771,771)

"BLD",6886,"KRN","B",870,870)

"BLD",6886,"KRN","B",8989.51,8989.51)

"BLD",6886,"KRN","B",8989.52,8989.52)

"BLD",6886,"KRN","B",8994,8994)

"BLD",6886,"PRE")
QAC20PST
"BLD",6886,"QUES",0)
^9.62^^
"BLD",6886,"REQB",0)
^9.611^^
"INIT")
EN^QAC20PST
"MBREQ")
0
"PKG",380,-1)
1^1
"PKG",380,0)
PATIENT REPRESENTATIVE^QAC^PATIENT REPRESENTATIVE PACKAGE
"PKG",380,20,0)
^9.402P^^
"PKG",380,22,0)
^9.49I^1^1
"PKG",380,22,1,0)
2.0^2950725^2950914
"PKG",380,22,1,"PAH",1,0)
20^3061207^100850
"PKG",380,22,1,"PAH",1,1,0)
^^5^5^3061207
"PKG",380,22,1,"PAH",1,1,1,0)
Sites are seeing Contact Numbers that do not follow the
"PKG",380,22,1,"PAH",1,1,2,0)
proper format. The sites are not able to enter new contact
"PKG",380,22,1,"PAH",1,1,3,0)
numbers because of the incorrect contact numbers.
"PKG",380,22,1,"PAH",1,1,4,0)
This patch will correct the bad contact numbers when the
"PKG",380,22,1,"PAH",1,1,5,0)
post install routine is run.
"PRE")
QAC20PST
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","QAC20PST")
0^1^B20695310^n/a
"RTN","QAC20PST",1,0)
QAC20PST ;ALB/TKW,RRG - POST-INSTALL FOR PATCH QAC*2*20 Repair ROC numbers ;12/06/06  14:30
"RTN","QAC20PST",2,0)
 ;;2.0;Patient Representative;**20**;07/25/1995;Build 7
"RTN","QAC20PST",3,0)
 ;
"RTN","QAC20PST",4,0)
 ;
"RTN","QAC20PST",5,0)
ENV ; Environment Check
"RTN","QAC20PST",6,0)
 ;
"RTN","QAC20PST",7,0)
 Q:'$G(XPDENV)
"RTN","QAC20PST",8,0)
 W ! K %DT D NOW^%DTC S %DT="RAEX",%DT(0)=%,%DT("A")="Queue the Post-Install to run at what Date@Time: "
"RTN","QAC20PST",9,0)
 D ^%DT K %DT I $D(DTOUT)!(Y<0) W !!,"Cannot install the patch without queuing the post-install. Install aborted!",! S XPDABORT=2 Q
"RTN","QAC20PST",10,0)
 S @XPDGREF@("QAC20")=Y K DTOUT
"RTN","QAC20PST",11,0)
 Q
"RTN","QAC20PST",12,0)
 ;
"RTN","QAC20PST",13,0)
EN ;
"RTN","QAC20PST",14,0)
 S ZTDTH=@XPDGREF@("QAC20")
"RTN","QAC20PST",15,0)
 S ZTRTN="START^QAC20PST",ZTDESC="Background job to repair ROC numbers",ZTIO="" D ^%ZTLOAD K ZTDTH,ZTRTN,ZTIO,ZTDESC
"RTN","QAC20PST",16,0)
 I $D(ZTSK)&('$D(ZTQUEUED)) D BMES^XPDUTL("Task Queued!")
"RTN","QAC20PST",17,0)
 K ZTSK,ZTQUEUED
"RTN","QAC20PST",18,0)
 Q
"RTN","QAC20PST",19,0)
 ;
"RTN","QAC20PST",20,0)
START ;
"RTN","QAC20PST",21,0)
 N PARENT,ROCNO,NEWROC,IEN,QA0,YR,DIR,I,Y,TIME
"RTN","QAC20PST",22,0)
 K ^TMP("QACROCNO",$J)
"RTN","QAC20PST",23,0)
 ; Set up mailman message format
"RTN","QAC20PST",24,0)
 N LCNT,LINE,LINE2,MESS,MSG,MSG1
"RTN","QAC20PST",25,0)
 S LCNT=1,$P(LINE,"-",80)="",$P(LINE2,"=",80)=""
"RTN","QAC20PST",26,0)
 K ^TMP($J)
"RTN","QAC20PST",27,0)
 S MESS="Repair ROC numbers",MSG1=" beginning at "
"RTN","QAC20PST",28,0)
 D TIME
"RTN","QAC20PST",29,0)
 S ^TMP($J,"P20",LCNT)="",LCNT=LCNT+1
"RTN","QAC20PST",30,0)
 ;
"RTN","QAC20PST",31,0)
 ; Find parent station number from QUALITY ASSURANCE SITE PARAMETERS file
"RTN","QAC20PST",32,0)
 S PARENT=$P($G(^QA(740,1,0)),"^"),PARENT=$$STA^XUAF4(PARENT)
"RTN","QAC20PST",33,0)
 I PARENT="" S ^TMP($J,"P20",LCNT)="Cannot find Parent Institution",LCNT=LCNT+1 D XMT Q
"RTN","QAC20PST",34,0)
 ;
"RTN","QAC20PST",35,0)
 ; Build lists of ROCs with invalid numbers by year.
"RTN","QAC20PST",36,0)
 F I=0:0 S I=$O(^QA(745.1,I)) Q:'I  S QA0=$G(^(I,0)),ROCNO=$P(QA0,"^") D
"RTN","QAC20PST",37,0)
 . I ROCNO="" S ^TMP("QACROCNO",$J,I," ")="" Q
"RTN","QAC20PST",38,0)
 . S YR=$E($P(QA0,"^",2),1,3)
"RTN","QAC20PST",39,0)
 . I ($P(ROCNO,".")'=PARENT)!(ROCNO'?3N.AN1"."6N) D
"RTN","QAC20PST",40,0)
 .. S:YR YR(YR)=""
"RTN","QAC20PST",41,0)
 .. S ^TMP("QACROCNO",$J,I,ROCNO)=YR Q
"RTN","QAC20PST",42,0)
 . Q
"RTN","QAC20PST",43,0)
 I '$D(^TMP("QACROCNO",$J)) S ^TMP($J,"P20",LCNT)="No invalid ROC numbers were found.",LCNT=LCNT+1 D XMT Q
"RTN","QAC20PST",44,0)
 ;
"RTN","QAC20PST",45,0)
 ; Find default 'last sequential number' for ROCs in each year.
"RTN","QAC20PST",46,0)
 S YR=""
"RTN","QAC20PST",47,0)
 F  S YR=$O(YR(YR)) Q:YR=""  D
"RTN","QAC20PST",48,0)
 . S ROCNO=$O(^QA(745.1,"B",PARENT_"."_$E(YR,2,3)_"9999"),-1)
"RTN","QAC20PST",49,0)
 . I $P(ROCNO,".")=PARENT,$E($P(ROCNO,".",2),1,2)=$E(YR,2,3) S YR(YR)=+$E($P(ROCNO,".",2),3,6) Q
"RTN","QAC20PST",50,0)
 . S YR(YR)=0 Q
"RTN","QAC20PST",51,0)
 ;
"RTN","QAC20PST",52,0)
 ; Assign a suggested new number for each ROC
"RTN","QAC20PST",53,0)
 F IEN=0:0 S IEN=$O(^TMP("QACROCNO",$J,IEN)) Q:'IEN  D
"RTN","QAC20PST",54,0)
 . S ROCNO="" F  S ROCNO=$O(^TMP("QACROCNO",$J,IEN,ROCNO)) Q:ROCNO=""  D
"RTN","QAC20PST",55,0)
 .. S YR=^TMP("QACROCNO",$J,IEN,ROCNO) Q:YR=""  Q:'$D(YR(YR))
"RTN","QAC20PST",56,0)
 .. S I=YR(YR)+1,YR(YR)=I
"RTN","QAC20PST",57,0)
 .. S NEWROC=PARENT_"."_$E(YR,2,3)_$E("000",1,(4-$L(I)))_I
"RTN","QAC20PST",58,0)
 .. S $P(^TMP("QACROCNO",$J,IEN,ROCNO),"^",2)=NEWROC Q
"RTN","QAC20PST",59,0)
 . Q
"RTN","QAC20PST",60,0)
 ;
"RTN","QAC20PST",61,0)
 ;
"RTN","QAC20PST",62,0)
FIX ; Repair ROC numbers
"RTN","QAC20PST",63,0)
 N FDA,CNT
"RTN","QAC20PST",64,0)
 S CNT=0
"RTN","QAC20PST",65,0)
 F IEN=0:0 S IEN=$O(^TMP("QACROCNO",$J,IEN)) Q:'IEN  D
"RTN","QAC20PST",66,0)
 . S ROCNO="" F  S ROCNO=$O(^TMP("QACROCNO",$J,IEN,ROCNO)) Q:ROCNO=""  D:ROCNO'=" "
"RTN","QAC20PST",67,0)
 .. S NEWROC=$P(^TMP("QACROCNO",$J,IEN,ROCNO),"^",2) I NEWROC="" S ^TMP($J,"P20",LCNT)="ROC number "_ROCNO_" could not be changed. Please review manually for a missing Date of Contact.",LCNT=LCNT+1 Q
"RTN","QAC20PST",68,0)
 .. S ^TMP($J,"P20",LCNT)="ROC Number changed from "_ROCNO_" to "_NEWROC,LCNT=LCNT+1
"RTN","QAC20PST",69,0)
 .. K FDA S FDA(745.1,IEN_",",.01)=NEWROC
"RTN","QAC20PST",70,0)
 .. D FILE^DIE("","FDA")
"RTN","QAC20PST",71,0)
 .. S CNT=CNT+1
"RTN","QAC20PST",72,0)
 .. Q
"RTN","QAC20PST",73,0)
 . Q
"RTN","QAC20PST",74,0)
 S ^TMP($J,"P20",LCNT)=CNT_" ROC Numbers have been corrected.",LCNT=LCNT+1
"RTN","QAC20PST",75,0)
 D XMT
"RTN","QAC20PST",76,0)
 Q
"RTN","QAC20PST",77,0)
 ;
"RTN","QAC20PST",78,0)
ENRPT ; Setup to print report of invalid ROCs
"RTN","QAC20PST",79,0)
 N ZTSAVE
"RTN","QAC20PST",80,0)
 S ZTSAVE("PATSHDR")=""
"RTN","QAC20PST",81,0)
 D EN^XUTMDEVQ("DQRPT^QAC20PST","Report of Invalid ROCs",.ZTSAVE)
"RTN","QAC20PST",82,0)
 Q
"RTN","QAC20PST",83,0)
 ;
"RTN","QAC20PST",84,0)
DQRPT ; Print report of invalid ROCs
"RTN","QAC20PST",85,0)
 N PAGENO,LNCNT,ROCNO,IEN,NEWROC,HDDATE,%,%H,%I
"RTN","QAC20PST",86,0)
 S PAGENO=1,LNCNT=0
"RTN","QAC20PST",87,0)
 D NOW^%DTC S HDDATE=$$FMTE^XLFDT(%)
"RTN","QAC20PST",88,0)
 U IO D HDR
"RTN","QAC20PST",89,0)
 F IEN=0:0 S IEN=$O(^TMP("QACROCNO",$J,IEN)) Q:'IEN  D
"RTN","QAC20PST",90,0)
 . S ROCNO="" F  S ROCNO=$O(^TMP("QACROCNO",$J,IEN,ROCNO)) Q:ROCNO=""  D
"RTN","QAC20PST",91,0)
 .. D:LNCNT>55 HDR
"RTN","QAC20PST",92,0)
 .. S NEWROC=$P(^TMP("QACROCNO",$J,IEN,ROCNO),"^",2)
"RTN","QAC20PST",93,0)
 .. W !,IEN,?20,$S(ROCNO=" ":"Missing",1:ROCNO),?45,$S(NEWROC="":"Cannot be fixed",1:NEWROC)
"RTN","QAC20PST",94,0)
 .. S LNCNT=LNCNT+1 Q
"RTN","QAC20PST",95,0)
 . Q
"RTN","QAC20PST",96,0)
 Q
"RTN","QAC20PST",97,0)
 ;
"RTN","QAC20PST",98,0)
HDR W #,!,"Report of Invalid ROCs",?43,HDDATE,?68,"Page "_PAGENO,!
"RTN","QAC20PST",99,0)
 W "IEN",?20,"Old ROC Number",?45,"Suggested New ROC Number",!
"RTN","QAC20PST",100,0)
 N X S X="",$P(X,"-",78)=""
"RTN","QAC20PST",101,0)
 W X,!
"RTN","QAC20PST",102,0)
 S LNCNT=0,PAGENO=PAGENO+1 Q
"RTN","QAC20PST",103,0)
 ;
"RTN","QAC20PST",104,0)
TIME ;Get current time
"RTN","QAC20PST",105,0)
 D NOW^%DTC
"RTN","QAC20PST",106,0)
 S Y=%
"RTN","QAC20PST",107,0)
 D DD^%DT
"RTN","QAC20PST",108,0)
 S TIME=Y
"RTN","QAC20PST",109,0)
 Q
"RTN","QAC20PST",110,0)
 ;
"RTN","QAC20PST",111,0)
XMT ;Send report via mail message
"RTN","QAC20PST",112,0)
 I $D(^TMP($J,"P20")) D
"RTN","QAC20PST",113,0)
 . N DIFROM,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","QAC20PST",114,0)
 . S XMDUZ=.5
"RTN","QAC20PST",115,0)
 . S XMSUB="QAC*2*20 POST INSTALL RESULTS"
"RTN","QAC20PST",116,0)
 . S XMTEXT="^TMP($J,""P20"","
"RTN","QAC20PST",117,0)
 . S XMY(DUZ)=""
"RTN","QAC20PST",118,0)
 . D ^XMD
"RTN","QAC20PST",119,0)
 ;
"VER")
8.0^22.0
"BLD",6886,6)
^18
**END**
**END**
