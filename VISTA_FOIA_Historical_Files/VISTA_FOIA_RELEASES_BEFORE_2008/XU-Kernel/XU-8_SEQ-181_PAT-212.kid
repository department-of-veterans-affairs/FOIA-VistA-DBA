Released XU*8*212 SEQ #181
Extracted from mail message
**KIDS**:XU*8.0*212^

**INSTALL NAME**
XU*8.0*212
"BLD",1525,0)
XU*8.0*212^KERNEL^0^3011127^y
"BLD",1525,4,0)
^9.64PA^^
"BLD",1525,"ABNS",0)
^9.66A^^
"BLD",1525,"ABPKG")
y^n
"BLD",1525,"KRN",0)
^9.67PA^19^17
"BLD",1525,"KRN",.4,0)
.4
"BLD",1525,"KRN",.401,0)
.401
"BLD",1525,"KRN",.402,0)
.402
"BLD",1525,"KRN",.403,0)
.403
"BLD",1525,"KRN",.5,0)
.5
"BLD",1525,"KRN",.84,0)
.84
"BLD",1525,"KRN",3.6,0)
3.6
"BLD",1525,"KRN",3.8,0)
3.8
"BLD",1525,"KRN",9.2,0)
9.2
"BLD",1525,"KRN",9.8,0)
9.8
"BLD",1525,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",1525,"KRN",9.8,"NM",1,0)
XUMF4^^0^B70960607
"BLD",1525,"KRN",9.8,"NM",2,0)
XUMF4A^^0^B54725246
"BLD",1525,"KRN",9.8,"NM","B","XUMF4",1)

"BLD",1525,"KRN",9.8,"NM","B","XUMF4A",2)

"BLD",1525,"KRN",19,0)
19
"BLD",1525,"KRN",19.1,0)
19.1
"BLD",1525,"KRN",101,0)
101
"BLD",1525,"KRN",409.61,0)
409.61
"BLD",1525,"KRN",771,0)
771
"BLD",1525,"KRN",870,0)
870
"BLD",1525,"KRN",870,"NM",0)
^9.68A^1^1
"BLD",1525,"KRN",870,"NM",1,0)
XUMF TEST^^0
"BLD",1525,"KRN",870,"NM","B","XUMF TEST",1)

"BLD",1525,"KRN",8994,0)
8994
"BLD",1525,"KRN",8994,"NM",0)
^9.68A^^
"BLD",1525,"KRN","B",.4,.4)

"BLD",1525,"KRN","B",.401,.401)

"BLD",1525,"KRN","B",.402,.402)

"BLD",1525,"KRN","B",.403,.403)

"BLD",1525,"KRN","B",.5,.5)

"BLD",1525,"KRN","B",.84,.84)

"BLD",1525,"KRN","B",3.6,3.6)

"BLD",1525,"KRN","B",3.8,3.8)

"BLD",1525,"KRN","B",9.2,9.2)

"BLD",1525,"KRN","B",9.8,9.8)

"BLD",1525,"KRN","B",19,19)

"BLD",1525,"KRN","B",19.1,19.1)

"BLD",1525,"KRN","B",101,101)

"BLD",1525,"KRN","B",409.61,409.61)

"BLD",1525,"KRN","B",771,771)

"BLD",1525,"KRN","B",870,870)

"BLD",1525,"KRN","B",8994,8994)

"BLD",1525,"QUES",0)
^9.62^^
"BLD",1525,"REQB",0)
^9.611^^
"KRN",870,166,-1)
0^1
"KRN",870,166,0)
XUMF TEST^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,166,200)
^5^^^600^^^^^S
"KRN",870,166,400)
10.4.229.23^5000^C^^^
"MBREQ")
0
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;
"ORD",13,870,0)
HL LOGICAL LINK
"PKG",113,-1)
1^1
"PKG",113,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^XUDOCV7 NEW FEATURES
"PKG",113,20,0)
^9.402P^^
"PKG",113,22,0)
^9.49I^1^1
"PKG",113,22,1,0)
8.0^2950703^2960322^648
"PKG",113,22,1,"PAH",1,0)
212^3011127
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XUMF4")
0^1^B70960607
"RTN","XUMF4",1,0)
XUMF4 ;CIOFO-SF/RAM - Institution File Clean Up; 06/28/00
"RTN","XUMF4",2,0)
 ;;8.0;KERNEL;**206,209,212**;Jul 10, 1995
"RTN","XUMF4",3,0)
 ;
"RTN","XUMF4",4,0)
 ;
"RTN","XUMF4",5,0)
EN ; -- entry point
"RTN","XUMF4",6,0)
 ;
"RTN","XUMF4",7,0)
 K ^TMP("XUMF ARRAY",$J)
"RTN","XUMF4",8,0)
 ;
"RTN","XUMF4",9,0)
 N PARAM,XUMFLAG,ERROR,TEST
"RTN","XUMF4",10,0)
 ;
"RTN","XUMF4",11,0)
 S (ERROR,XUMFLAG,TEST)=0
"RTN","XUMF4",12,0)
 ;
"RTN","XUMF4",13,0)
 I $P($$PARAM^HLCS2,U,3)="T" S TEST=1
"RTN","XUMF4",14,0)
 ;
"RTN","XUMF4",15,0)
 L +^TMP("XUMF ARRAY",$J):0 D:'$T
"RTN","XUMF4",16,0)
 .S ERROR="1^another process is using the Master File Server"
"RTN","XUMF4",17,0)
 ;
"RTN","XUMF4",18,0)
 I ERROR D EXIT1 Q
"RTN","XUMF4",19,0)
 ;
"RTN","XUMF4",20,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D
"RTN","XUMF4",21,0)
 .W !!,"...connecting with master file server..."
"RTN","XUMF4",22,0)
 .D MFS0
"RTN","XUMF4",23,0)
 ;
"RTN","XUMF4",24,0)
 I ERROR D EXIT1 Q
"RTN","XUMF4",25,0)
 ;
"RTN","XUMF4",26,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D  D EXIT1 Q
"RTN","XUMF4",27,0)
 .S ERROR="Connection to master file server failed!"
"RTN","XUMF4",28,0)
 ;
"RTN","XUMF4",29,0)
 D FTCLEAN^XUMF4A I ERROR D EXIT1 Q
"RTN","XUMF4",30,0)
 ;
"RTN","XUMF4",31,0)
 K ^TMP("XUMF ARRAY",$J),^TMP("XUMF MFS",$J)
"RTN","XUMF4",32,0)
 ;
"RTN","XUMF4",33,0)
 W !!,"...connecting with master file server..."
"RTN","XUMF4",34,0)
 D MFS1
"RTN","XUMF4",35,0)
 ;
"RTN","XUMF4",36,0)
 I ERROR D EXIT1 Q
"RTN","XUMF4",37,0)
 ;
"RTN","XUMF4",38,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D  Q
"RTN","XUMF4",39,0)
 .S ERROR="Connection to master file server failed!"
"RTN","XUMF4",40,0)
 .D EXIT1
"RTN","XUMF4",41,0)
 ;
"RTN","XUMF4",42,0)
 D EN^VALM("XUMF NAME")
"RTN","XUMF4",43,0)
 ;
"RTN","XUMF4",44,0)
 D EXIT1
"RTN","XUMF4",45,0)
 ;
"RTN","XUMF4",46,0)
 Q
"RTN","XUMF4",47,0)
 ;
"RTN","XUMF4",48,0)
RDSN ; - resolve duplicate station number
"RTN","XUMF4",49,0)
 ;
"RTN","XUMF4",50,0)
 I '$O(@VALMAR@("INDEX",0)) D  Q
"RTN","XUMF4",51,0)
 .W !!,"No duplicates to select from!",!
"RTN","XUMF4",52,0)
 .S VALMBCK="R" H 2
"RTN","XUMF4",53,0)
 ;
"RTN","XUMF4",54,0)
 N ENTRY,VALMY,DA,DR,DIE,STA,MERGED,FROM
"RTN","XUMF4",55,0)
 ;
"RTN","XUMF4",56,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","XUMF4",57,0)
 Q:'$D(VALMY)  Q:'$D(VALMAR)
"RTN","XUMF4",58,0)
 ;
"RTN","XUMF4",59,0)
 S DA=@VALMAR@("INDEX",+$O(VALMY(0)))
"RTN","XUMF4",60,0)
 S DR="99///@",DIE=4
"RTN","XUMF4",61,0)
 I DA D
"RTN","XUMF4",62,0)
 .I $O(^HLCS(870,"C",DA,0)) D  Q
"RTN","XUMF4",63,0)
 ..W !!?20,"Pointed to by HL7 Logical Link"
"RTN","XUMF4",64,0)
 ..W !?22,"*select other entry*",!!
"RTN","XUMF4",65,0)
 .D ^DIE
"RTN","XUMF4",66,0)
 ;
"RTN","XUMF4",67,0)
 D @($E($P(VALMAR,"XUMF ",2),1,4)_"^XUMF4")
"RTN","XUMF4",68,0)
 S VALMBCK="R"
"RTN","XUMF4",69,0)
 ;
"RTN","XUMF4",70,0)
 Q
"RTN","XUMF4",71,0)
 ;
"RTN","XUMF4",72,0)
 ;
"RTN","XUMF4",73,0)
DSTA ; -- duplicate station #s
"RTN","XUMF4",74,0)
 ;
"RTN","XUMF4",75,0)
 K ^TMP("XUMF DSTA",$J),^TMP("XUMF TMP",$J)
"RTN","XUMF4",76,0)
 ;
"RTN","XUMF4",77,0)
 I 'XUMFLAG D LOCAL
"RTN","XUMF4",78,0)
 ;
"RTN","XUMF4",79,0)
 S STA="",IEN=0
"RTN","XUMF4",80,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",81,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",82,0)
 ..Q:'$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4",83,0)
 ..S ^TMP("XUMF TMP",$J,STA,IEN)=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4",84,0)
 ;
"RTN","XUMF4",85,0)
 S STA="",(VALMCNT,IEN)=0
"RTN","XUMF4",86,0)
 F  S STA=$O(^TMP("XUMF TMP",$J,STA)) Q:STA=""  D
"RTN","XUMF4",87,0)
 .Q:'$O(^TMP("XUMF TMP",$J,STA,+$O(^TMP("XUMF TMP",$J,STA,0))))
"RTN","XUMF4",88,0)
 .F  S IEN=$O(^TMP("XUMF TMP",$J,STA,IEN)) Q:'IEN  D
"RTN","XUMF4",89,0)
 ..S VALMCNT=VALMCNT+1
"RTN","XUMF4",90,0)
 ..S VAR="",NAME=$P(^TMP("XUMF TMP",$J,STA,IEN),U)
"RTN","XUMF4",91,0)
 ..S VAR=$$SETFLD^VALM1(VALMCNT,VAR,"ENTRY NUMBER")
"RTN","XUMF4",92,0)
 ..S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",93,0)
 ..S VAR=$$SETFLD^VALM1(NAME,VAR,"INSTITUTION NAME")
"RTN","XUMF4",94,0)
 ..S VAR=$$SETFLD^VALM1(IEN,VAR,"IEN")
"RTN","XUMF4",95,0)
 ..D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",96,0)
 ..S @VALMAR@("INDEX",VALMCNT)=IEN
"RTN","XUMF4",97,0)
 ;
"RTN","XUMF4",98,0)
 D:'VALMCNT
"RTN","XUMF4",99,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***No duplicates***",VAR,"INSTITUTION NAME")
"RTN","XUMF4",100,0)
 .S VALMCNT=1
"RTN","XUMF4",101,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",102,0)
 ;
"RTN","XUMF4",103,0)
 K ^TMP("XUMF TMP",$J)
"RTN","XUMF4",104,0)
 ;
"RTN","XUMF4",105,0)
 Q
"RTN","XUMF4",106,0)
 ;
"RTN","XUMF4",107,0)
LOCAL ; -- auto-delete local/duplicate station numbers
"RTN","XUMF4",108,0)
 ;
"RTN","XUMF4",109,0)
 W !!,"This action will auto-delete local/duplicate station numbers."
"RTN","XUMF4",110,0)
 N Y S DIR(0)="Y",DIR("B")="YES" W !
"RTN","XUMF4",111,0)
 S DIR("A")="Do you wish to proceed"
"RTN","XUMF4",112,0)
 D ^DIR K DIR I 'Y Q
"RTN","XUMF4",113,0)
 ;
"RTN","XUMF4",114,0)
 S XUMFLAG=1
"RTN","XUMF4",115,0)
 D DXRF
"RTN","XUMF4",116,0)
 ;
"RTN","XUMF4",117,0)
 N IEN,STA,STANUM,VAR,NAME,FLAG,CNT
"RTN","XUMF4",118,0)
 ;
"RTN","XUMF4",119,0)
 S STA="",(IEN,CNT)=0
"RTN","XUMF4",120,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",121,0)
 .Q:'$O(^DIC(4,"D",STA,+$O(^DIC(4,"D",STA,0))))
"RTN","XUMF4",122,0)
 .S FLAG=0
"RTN","XUMF4",123,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",124,0)
 ..S:$O(^HLCS(870,"C",IEN,0)) FLAG=1
"RTN","XUMF4",125,0)
 .Q:'FLAG
"RTN","XUMF4",126,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",127,0)
 ..Q:$O(^HLCS(870,"C",IEN,0))
"RTN","XUMF4",128,0)
 ..W !?5,"deleting duplicate station number ",STA," from IEN: ",IEN
"RTN","XUMF4",129,0)
 ..H 1
"RTN","XUMF4",130,0)
 ..S DR="99///@",DIE=4,DA=IEN,CNT=CNT+1
"RTN","XUMF4",131,0)
 ..N IEN,STA,FLAG D ^DIE
"RTN","XUMF4",132,0)
 I CNT D EOP S CNT=0
"RTN","XUMF4",133,0)
 ;
"RTN","XUMF4",134,0)
 S STA="",IEN=0
"RTN","XUMF4",135,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",136,0)
 .Q:$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4",137,0)
 .Q:'$D(^TMP("XUMF ARRAY",$J))
"RTN","XUMF4",138,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",139,0)
 ..S DR="99///@",DIE=4,DA=IEN,CNT=CNT+1
"RTN","XUMF4",140,0)
 ..W !?5,"deleting local station number ",STA," from IEN: ",IEN
"RTN","XUMF4",141,0)
 ..H 1
"RTN","XUMF4",142,0)
 ..N IEN,STA D ^DIE
"RTN","XUMF4",143,0)
 I CNT D EOP S CNT=0
"RTN","XUMF4",144,0)
 ;
"RTN","XUMF4",145,0)
 Q
"RTN","XUMF4",146,0)
 ;
"RTN","XUMF4",147,0)
 ;
"RTN","XUMF4",148,0)
DXRF ; -- re-index "D" cross-reference
"RTN","XUMF4",149,0)
 ;
"RTN","XUMF4",150,0)
 N DIK
"RTN","XUMF4",151,0)
 ;
"RTN","XUMF4",152,0)
 K ^DIC(4,"D")
"RTN","XUMF4",153,0)
 ;
"RTN","XUMF4",154,0)
 S DIK="^DIC(4,",DIK(1)="99^D" D ENALL^DIK
"RTN","XUMF4",155,0)
 ;
"RTN","XUMF4",156,0)
 Q
"RTN","XUMF4",157,0)
 ;
"RTN","XUMF4",158,0)
 ;
"RTN","XUMF4",159,0)
LLCL ; -- local data
"RTN","XUMF4",160,0)
 ;
"RTN","XUMF4",161,0)
 K ^TMP("XUMF LLCL",$J)
"RTN","XUMF4",162,0)
 ;
"RTN","XUMF4",163,0)
 N STA,IEN,STANUM,VAR,NAME,FTYP
"RTN","XUMF4",164,0)
 ;
"RTN","XUMF4",165,0)
 S STA="",VALMCNT=0
"RTN","XUMF4",166,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",167,0)
 .S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4",168,0)
 .S FTYP=$P($G(^DIC(4.1,+$G(^DIC(4,+IEN,3)),0)),U)
"RTN","XUMF4",169,0)
 .Q:$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4",170,0)
 .S VALMCNT=VALMCNT+1
"RTN","XUMF4",171,0)
 .S VAR="",NAME=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4",172,0)
 .S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",173,0)
 .S VAR=$$SETFLD^VALM1(NAME,VAR,"INSTITUTION NAME")
"RTN","XUMF4",174,0)
 .S VAR=$$SETFLD^VALM1(IEN,VAR,"IEN")
"RTN","XUMF4",175,0)
 .S VAR=$$SETFLD^VALM1(FTYP,VAR,"FACILITY TYPE")
"RTN","XUMF4",176,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",177,0)
 .S @VALMAR@("INDEX",VALMCNT)=IEN
"RTN","XUMF4",178,0)
 ;
"RTN","XUMF4",179,0)
 D:'VALMCNT
"RTN","XUMF4",180,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***None found***",VAR,"INSTITUTION NAME")
"RTN","XUMF4",181,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4",182,0)
 ;
"RTN","XUMF4",183,0)
 Q
"RTN","XUMF4",184,0)
 ;
"RTN","XUMF4",185,0)
 ;
"RTN","XUMF4",186,0)
NATL ; -- national data to merge
"RTN","XUMF4",187,0)
 ;
"RTN","XUMF4",188,0)
 K ^TMP("XUMF NATL",$J)
"RTN","XUMF4",189,0)
 ;
"RTN","XUMF4",190,0)
 N STA,VAR,NAME,TYPE,STATE
"RTN","XUMF4",191,0)
 ;
"RTN","XUMF4",192,0)
 S STA="",VALMCNT=0
"RTN","XUMF4",193,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4",194,0)
 .Q:$D(^DIC(4,"D",STA))
"RTN","XUMF4",195,0)
 .S VALMCNT=VALMCNT+1
"RTN","XUMF4",196,0)
 .S VAR="",NAME=$P(^TMP("XUMF ARRAY",$J,STA),U,2)
"RTN","XUMF4",197,0)
 .S TYPE=$P($P(^TMP("XUMF ARRAY",$J,STA),U,5),"~")
"RTN","XUMF4",198,0)
 .S STATE=$P(^TMP("XUMF ARRAY",$J,STA),U,8)
"RTN","XUMF4",199,0)
 .S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",200,0)
 .S VAR=$$SETFLD^VALM1(NAME,VAR,"NATIONAL NAME")
"RTN","XUMF4",201,0)
 .S VAR=$$SETFLD^VALM1(STATE,VAR,"STATE")
"RTN","XUMF4",202,0)
 .S VAR=$$SETFLD^VALM1(TYPE,VAR,"TYPE")
"RTN","XUMF4",203,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",204,0)
 ;
"RTN","XUMF4",205,0)
 D:'VALMCNT
"RTN","XUMF4",206,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***None found***",VAR,"NATIONAL NAME")
"RTN","XUMF4",207,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4",208,0)
 ;
"RTN","XUMF4",209,0)
 Q
"RTN","XUMF4",210,0)
 ;
"RTN","XUMF4",211,0)
 ;
"RTN","XUMF4",212,0)
NAME ; -- compare INSTITUTION name vs national name
"RTN","XUMF4",213,0)
 ;
"RTN","XUMF4",214,0)
 K ^TMP("XUMF NAME",$J),^TMP("XUMF TABLE",$J)
"RTN","XUMF4",215,0)
 ;
"RTN","XUMF4",216,0)
 N STA,IEN,NAME,GOLD,NAME,VAR,ARRAY
"RTN","XUMF4",217,0)
 ;
"RTN","XUMF4",218,0)
 D DXRF
"RTN","XUMF4",219,0)
 ;
"RTN","XUMF4",220,0)
 S STA="",(IEN,VALMCNT)=0
"RTN","XUMF4",221,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",222,0)
 .S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4",223,0)
 .S GOLD=$P($G(^TMP("XUMF ARRAY",$J,STA)),U,2)
"RTN","XUMF4",224,0)
 .S NAME=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4",225,0)
 .S ^TMP("XUMF TABLE",$J,STA,IEN)=NAME_U_GOLD
"RTN","XUMF4",226,0)
 ;
"RTN","XUMF4",227,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4",228,0)
 .Q:$D(^TMP("XUMF TABLE",$J,STA))
"RTN","XUMF4",229,0)
 .S NAME=$P(^TMP("XUMF ARRAY",$J,STA),U,2)
"RTN","XUMF4",230,0)
 .S ^TMP("XUMF TABLE",$J,STA,9999)="^"_NAME
"RTN","XUMF4",231,0)
 ;
"RTN","XUMF4",232,0)
 S (IEN,VALMCNT)=0
"RTN","XUMF4",233,0)
 F  S STA=$O(^TMP("XUMF TABLE",$J,STA)) Q:STA=""  D
"RTN","XUMF4",234,0)
 .F  S IEN=$O(^TMP("XUMF TABLE",$J,STA,IEN)) Q:'IEN  D
"RTN","XUMF4",235,0)
 ..S GOLD=$P(^TMP("XUMF TABLE",$J,STA,IEN),U,2)
"RTN","XUMF4",236,0)
 ..S NAME=$P(^TMP("XUMF TABLE",$J,STA,IEN),U)
"RTN","XUMF4",237,0)
 ..S VALMCNT=VALMCNT+1,VAR=""
"RTN","XUMF4",238,0)
 ..S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",239,0)
 ..S VAR=$$SETFLD^VALM1(NAME,VAR,"INSTITUTION NAME")
"RTN","XUMF4",240,0)
 ..S VAR=$$SETFLD^VALM1(GOLD,VAR,"GOLD NAME")
"RTN","XUMF4",241,0)
 ..D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",242,0)
 ;
"RTN","XUMF4",243,0)
 D:'VALMCNT
"RTN","XUMF4",244,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***None found***",VAR,"INSTITUTION NAME")
"RTN","XUMF4",245,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4",246,0)
 ;
"RTN","XUMF4",247,0)
 K ^TMP("XUMF TABLE",$J)
"RTN","XUMF4",248,0)
 ;
"RTN","XUMF4",249,0)
 Q
"RTN","XUMF4",250,0)
 ;
"RTN","XUMF4",251,0)
 ;
"RTN","XUMF4",252,0)
MFS0 ; -- get national facility type file from Master File Server
"RTN","XUMF4",253,0)
 ;
"RTN","XUMF4",254,0)
 D FACTYP^XUMF4A
"RTN","XUMF4",255,0)
 D STATE^XUMF4A
"RTN","XUMF4",256,0)
 ;
"RTN","XUMF4",257,0)
 S PARAM("LLNK")="XUMF MFR^XUMF "_$S('TEST:"FORUM",1:"TEST")
"RTN","XUMF4",258,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMF4",259,0)
 ;
"RTN","XUMF4",260,0)
 W !!,"...getting FACILITY TYPE file..."
"RTN","XUMF4",261,0)
 D MAIN^XUMFP(4.1,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",262,0)
 D MAIN^XUMFI(4.1,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",263,0)
 D MAIN^XUMFH
"RTN","XUMF4",264,0)
 ;
"RTN","XUMF4",265,0)
 Q
"RTN","XUMF4",266,0)
 ;
"RTN","XUMF4",267,0)
MFS1 ; -- get national facility type file from Master File Server
"RTN","XUMF4",268,0)
 ;
"RTN","XUMF4",269,0)
 S PARAM("LLNK")="XUMF MFR^XUMF "_$S('TEST:"FORUM",1:"TEST")
"RTN","XUMF4",270,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMF4",271,0)
 ;
"RTN","XUMF4",272,0)
 W !!,"...getting INSTITUTION file..."
"RTN","XUMF4",273,0)
 W !,"...please wait...(approx. 5 minutes)..."
"RTN","XUMF4",274,0)
 D MAIN^XUMFP(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",275,0)
 D MAIN^XUMFI(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",276,0)
 D MAIN^XUMFH
"RTN","XUMF4",277,0)
 ;
"RTN","XUMF4",278,0)
 Q
"RTN","XUMF4",279,0)
 ;
"RTN","XUMF4",280,0)
EXIT ; -- cleanup and quit
"RTN","XUMF4",281,0)
 ;
"RTN","XUMF4",282,0)
 K:$D(VALMAR) @VALMAR
"RTN","XUMF4",283,0)
 ;
"RTN","XUMF4",284,0)
 Q
"RTN","XUMF4",285,0)
 ;
"RTN","XUMF4",286,0)
EXIT1 ;
"RTN","XUMF4",287,0)
 ;
"RTN","XUMF4",288,0)
 K ^TMP("XUMF ARRAY",$J),^TMP("XUMF MFS",$J)
"RTN","XUMF4",289,0)
 K ^TMP("DIERR",$J)
"RTN","XUMF4",290,0)
 ;
"RTN","XUMF4",291,0)
 L -^TMP("XUMF ARRAY",$J)
"RTN","XUMF4",292,0)
 ;
"RTN","XUMF4",293,0)
 I ERROR D
"RTN","XUMF4",294,0)
 .D ERRB^XUMFH("IFR clean up",ERROR,"XUMF INSTITUTION",.ERR)
"RTN","XUMF4",295,0)
 .W !!,ERROR,!,$G(ERR),!
"RTN","XUMF4",296,0)
 ;
"RTN","XUMF4",297,0)
 Q
"RTN","XUMF4",298,0)
 ;
"RTN","XUMF4",299,0)
EOP ; -- End-of-Page
"RTN","XUMF4",300,0)
 ;
"RTN","XUMF4",301,0)
 S DIR(0)="E"
"RTN","XUMF4",302,0)
 D ^DIR,CLEAR^VALM1
"RTN","XUMF4",303,0)
 S VALMBCK="R"
"RTN","XUMF4",304,0)
 ;
"RTN","XUMF4",305,0)
 Q
"RTN","XUMF4",306,0)
 ;
"RTN","XUMF4A")
0^2^B54725246
"RTN","XUMF4A",1,0)
XUMF4A ;CIOFO-SF/RAM - Institution File Clean Up; 06/28/99
"RTN","XUMF4A",2,0)
 ;;8.0;KERNEL;**206,209,212**;Jul 10, 1995
"RTN","XUMF4A",3,0)
 ;
"RTN","XUMF4A",4,0)
 ;
"RTN","XUMF4A",5,0)
EN ; -- entry point
"RTN","XUMF4A",6,0)
 ;
"RTN","XUMF4A",7,0)
 I $$CDSN D  Q
"RTN","XUMF4A",8,0)
 .D MSG^VALM10("Duplicates sta #s exist! -- NOTHING UPDATED!!!")
"RTN","XUMF4A",9,0)
 .H 5
"RTN","XUMF4A",10,0)
 .S VALMBCK="R"
"RTN","XUMF4A",11,0)
 ;
"RTN","XUMF4A",12,0)
 W "...working",!
"RTN","XUMF4A",13,0)
 D DSN,CSN,GOLD,ASSC,HIST
"RTN","XUMF4A",14,0)
 ;
"RTN","XUMF4A",15,0)
 K ^TMP("XUMF NAME",$J)
"RTN","XUMF4A",16,0)
 D NAME^XUMF4
"RTN","XUMF4A",17,0)
 S VALMBG=1
"RTN","XUMF4A",18,0)
 S VALMBCK="R"
"RTN","XUMF4A",19,0)
 ;
"RTN","XUMF4A",20,0)
 Q
"RTN","XUMF4A",21,0)
 ;
"RTN","XUMF4A",22,0)
DSN ; -- clean out local station numbers
"RTN","XUMF4A",23,0)
 ;
"RTN","XUMF4A",24,0)
 N IEN,DIE,DR,DA,XUMF,DIK
"RTN","XUMF4A",25,0)
 ;
"RTN","XUMF4A",26,0)
 S XUMF=7
"RTN","XUMF4A",27,0)
 ;
"RTN","XUMF4A",28,0)
 S IEN=0
"RTN","XUMF4A",29,0)
 F  S IEN=$O(^DIC(4,IEN)) Q:'IEN  D
"RTN","XUMF4A",30,0)
 .S STA=$P($G(^DIC(4,+IEN,99)),U) Q:STA=""
"RTN","XUMF4A",31,0)
 .Q:$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4A",32,0)
 .S DR="99///@",DIE=4,DA=IEN
"RTN","XUMF4A",33,0)
 .D
"RTN","XUMF4A",34,0)
 ..N IEN D ^DIE
"RTN","XUMF4A",35,0)
 ;
"RTN","XUMF4A",36,0)
 S STA="",IEN=0
"RTN","XUMF4A",37,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4A",38,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4A",39,0)
 ..Q:$P($G(^DIC(4,+IEN,99)),U)=STA
"RTN","XUMF4A",40,0)
 ..K ^DIC(4,"D",STA,IEN)
"RTN","XUMF4A",41,0)
 ;
"RTN","XUMF4A",42,0)
 S DIK="^DIC(4,",DIK(1)="99^D" D ENALL^DIK
"RTN","XUMF4A",43,0)
 ;
"RTN","XUMF4A",44,0)
 Q
"RTN","XUMF4A",45,0)
 ;
"RTN","XUMF4A",46,0)
CSN ; -- check/update status
"RTN","XUMF4A",47,0)
 ;
"RTN","XUMF4A",48,0)
 N IEN,DIE,DR,DA,XUMF,STATUS,STA
"RTN","XUMF4A",49,0)
 ;
"RTN","XUMF4A",50,0)
 S XUMF=7
"RTN","XUMF4A",51,0)
 ;
"RTN","XUMF4A",52,0)
 S IEN=0
"RTN","XUMF4A",53,0)
 F  S IEN=$O(^DIC(4,IEN)) Q:'IEN  D
"RTN","XUMF4A",54,0)
 .S STA=$P($G(^DIC(4,+IEN,99)),U)
"RTN","XUMF4A",55,0)
 .I STA S DR="11///N",DIE=4,DA=IEN D  Q
"RTN","XUMF4A",56,0)
 ..N IEN D ^DIE
"RTN","XUMF4A",57,0)
 .S STATUS=$P(^DIC(4,IEN,0),U,11)
"RTN","XUMF4A",58,0)
 .I STATUS="I" S DR="101///I",DIE=4,DA=IEN D
"RTN","XUMF4A",59,0)
 ..N IEN D ^DIE
"RTN","XUMF4A",60,0)
 .S DR="11///L",DIE=4,DA=IEN D
"RTN","XUMF4A",61,0)
 ..N IEN D ^DIE
"RTN","XUMF4A",62,0)
 ;
"RTN","XUMF4A",63,0)
 Q
"RTN","XUMF4A",64,0)
 ;
"RTN","XUMF4A",65,0)
GOLD ; -- add missing national data from standard table
"RTN","XUMF4A",66,0)
 ;
"RTN","XUMF4A",67,0)
 N STA,NAME,FDA,ERROR,IEN,IENS,X,FLAG,CNT
"RTN","XUMF4A",68,0)
 N OLDNAME,OLDVANM,STATE,FACTYP,XUMF
"RTN","XUMF4A",69,0)
 ;
"RTN","XUMF4A",70,0)
 S XUMF=7
"RTN","XUMF4A",71,0)
 ;
"RTN","XUMF4A",72,0)
 S STA="",CNT=0
"RTN","XUMF4A",73,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",74,0)
 .S X=^TMP("XUMF ARRAY",$J,STA)
"RTN","XUMF4A",75,0)
 .S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4A",76,0)
 .S OLDNAME=$P($G(^DIC(4,+IEN,0)),U,1)
"RTN","XUMF4A",77,0)
 .S OLDVANM=$P($G(^DIC(4,+IEN,99)),U,3)
"RTN","XUMF4A",78,0)
 .S IENS=$S(IEN:IEN_",",1:"+1,")
"RTN","XUMF4A",79,0)
 .S NAME=$P(X,U,2)
"RTN","XUMF4A",80,0)
 .S FACTYP=$P(X,U,5)
"RTN","XUMF4A",81,0)
 .S VANAME=$P(X,U,6)
"RTN","XUMF4A",82,0)
 .S FLAG=$P(X,U,7)
"RTN","XUMF4A",83,0)
 .S STATE=$P(X,U,8)
"RTN","XUMF4A",84,0)
 .K FDA
"RTN","XUMF4A",85,0)
 .S FDA(4,IENS,.01)=NAME
"RTN","XUMF4A",86,0)
 .S FDA(4,IENS,.02)=STATE
"RTN","XUMF4A",87,0)
 .S FDA(4,IENS,99)=STA
"RTN","XUMF4A",88,0)
 .S FDA(4,IENS,11)="NATIONAL"
"RTN","XUMF4A",89,0)
 .S FDA(4,IENS,13)=$P(FACTYP,"~")
"RTN","XUMF4A",90,0)
 .S FDA(4,IENS,100)=VANAME
"RTN","XUMF4A",91,0)
 .S FDA(4,IENS,101)=FLAG
"RTN","XUMF4A",92,0)
 .D
"RTN","XUMF4A",93,0)
 ..N IEN,STA,NAME,VANAME,OLDNAME,OLDVANM
"RTN","XUMF4A",94,0)
 ..D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF4A",95,0)
 .I 'IEN S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4A",96,0)
 .Q:'IEN
"RTN","XUMF4A",97,0)
 .I OLDNAME="" Q
"RTN","XUMF4A",98,0)
 .I OLDNAME=NAME,VANAME=OLDVANM Q
"RTN","XUMF4A",99,0)
 .S IENS="?+"_DT_","_IEN_","
"RTN","XUMF4A",100,0)
 .K FDA
"RTN","XUMF4A",101,0)
 .S FDA(4.999,IENS,.01)=DT
"RTN","XUMF4A",102,0)
 .S:NAME'=OLDNAME FDA(4.999,IENS,.02)=OLDNAME
"RTN","XUMF4A",103,0)
 .S:VANAME'=OLDVANM FDA(4.999,IENS,.03)=OLDVANM
"RTN","XUMF4A",104,0)
 .D
"RTN","XUMF4A",105,0)
 ..N STA
"RTN","XUMF4A",106,0)
 ..D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF4A",107,0)
 ..S CNT=CNT+1 I '(CNT#10) W "."
"RTN","XUMF4A",108,0)
 ;
"RTN","XUMF4A",109,0)
 Q
"RTN","XUMF4A",110,0)
 ;
"RTN","XUMF4A",111,0)
ASSC ; -- populate associations (parent facility and VISN)
"RTN","XUMF4A",112,0)
 ;
"RTN","XUMF4A",113,0)
 N IEN,STA,VISN,PARENT,FDA,XUMF,CNT
"RTN","XUMF4A",114,0)
 ;
"RTN","XUMF4A",115,0)
 S XUMF=7
"RTN","XUMF4A",116,0)
 ;
"RTN","XUMF4A",117,0)
 S STA="",CNT=0
"RTN","XUMF4A",118,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",119,0)
 .S IEN=$O(^DIC(4,"D",STA,0)) Q:'IEN
"RTN","XUMF4A",120,0)
 .S VISN=$P(^TMP("XUMF ARRAY",$J,STA),U,9)
"RTN","XUMF4A",121,0)
 .I VISN'="" D
"RTN","XUMF4A",122,0)
 ..K FDA
"RTN","XUMF4A",123,0)
 ..S IENS="?+1,"_IEN_","
"RTN","XUMF4A",124,0)
 ..S FDA(4.014,IENS,.01)="VISN"
"RTN","XUMF4A",125,0)
 ..S FDA(4.014,IENS,1)=$P(VISN,"~")
"RTN","XUMF4A",126,0)
 ..D
"RTN","XUMF4A",127,0)
 ...N IEN,STA
"RTN","XUMF4A",128,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",129,0)
 .S PARENT=$P(^TMP("XUMF ARRAY",$J,STA),U,10)
"RTN","XUMF4A",130,0)
 .I PARENT'="" D
"RTN","XUMF4A",131,0)
 ..K FDA
"RTN","XUMF4A",132,0)
 ..S IENS="?+2,"_IEN_","
"RTN","XUMF4A",133,0)
 ..S FDA(4.014,IENS,.01)="PARENT FACILITY"
"RTN","XUMF4A",134,0)
 ..S FDA(4.014,IENS,1)=PARENT
"RTN","XUMF4A",135,0)
 ..D
"RTN","XUMF4A",136,0)
 ...N IEN,STA
"RTN","XUMF4A",137,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",138,0)
 ...S CNT=CNT+1 I '(CNT#10) W "."
"RTN","XUMF4A",139,0)
 ;
"RTN","XUMF4A",140,0)
 Q
"RTN","XUMF4A",141,0)
 ;
"RTN","XUMF4A",142,0)
HIST ; -- history
"RTN","XUMF4A",143,0)
 ;
"RTN","XUMF4A",144,0)
 N IEN,STA,EFFDT,FDA,XUMF,CNT
"RTN","XUMF4A",145,0)
 ;
"RTN","XUMF4A",146,0)
 S XUMF=7
"RTN","XUMF4A",147,0)
 ;
"RTN","XUMF4A",148,0)
 S STA="",CNT=0
"RTN","XUMF4A",149,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",150,0)
 .S IEN=$O(^DIC(4,"D",STA,0)) Q:'IEN
"RTN","XUMF4A",151,0)
 .S EFFDT=$P(^TMP("XUMF ARRAY",$J,STA),U,11)
"RTN","XUMF4A",152,0)
 .S EFFDT=$$FMDATE^HLFNC(+EFFDT)
"RTN","XUMF4A",153,0)
 .I EFFDT D
"RTN","XUMF4A",154,0)
 ..S IENS="?+"_EFFDT_","_IEN_","
"RTN","XUMF4A",155,0)
 ..K FDA
"RTN","XUMF4A",156,0)
 ..S FDA(4.999,IENS,.01)=EFFDT
"RTN","XUMF4A",157,0)
 ..S FDA(4.999,IENS,.06)=$P(^TMP("XUMF ARRAY",$J,STA),U,12)
"RTN","XUMF4A",158,0)
 ..D
"RTN","XUMF4A",159,0)
 ...N IEN,STA
"RTN","XUMF4A",160,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",161,0)
 .S EFFDT=$P(^TMP("XUMF ARRAY",$J,STA),U,13)
"RTN","XUMF4A",162,0)
 .S EFFDT=$$FMDATE^HLFNC(+EFFDT)
"RTN","XUMF4A",163,0)
 .I EFFDT D
"RTN","XUMF4A",164,0)
 ..S IENS="?+"_EFFDT_","_IEN_","
"RTN","XUMF4A",165,0)
 ..K FDA
"RTN","XUMF4A",166,0)
 ..S FDA(4.999,IENS,.01)=EFFDT
"RTN","XUMF4A",167,0)
 ..S FDA(4.999,IENS,.05)=$P(^TMP("XUMF ARRAY",$J,STA),U,14)
"RTN","XUMF4A",168,0)
 ..D
"RTN","XUMF4A",169,0)
 ...N IEN,STA
"RTN","XUMF4A",170,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",171,0)
 ...S CNT=CNT+1 I '(CNT#10) W "."
"RTN","XUMF4A",172,0)
 ;
"RTN","XUMF4A",173,0)
 Q
"RTN","XUMF4A",174,0)
 ;
"RTN","XUMF4A",175,0)
CDSN() ; -- check for duplicate sta # (true=duplicates, false=none)
"RTN","XUMF4A",176,0)
 ;
"RTN","XUMF4A",177,0)
 K ^TMP("XUMF TMP",$J)
"RTN","XUMF4A",178,0)
 ;
"RTN","XUMF4A",179,0)
 N IEN,STA,CNT
"RTN","XUMF4A",180,0)
 ;
"RTN","XUMF4A",181,0)
 S STA="",IEN=0
"RTN","XUMF4A",182,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4A",183,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4A",184,0)
 ..S ^TMP("XUMF TMP",$J,STA,IEN)=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4A",185,0)
 ;
"RTN","XUMF4A",186,0)
 S STA="",(CNT,IEN)=0
"RTN","XUMF4A",187,0)
 F  S STA=$O(^TMP("XUMF TMP",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",188,0)
 .Q:'$O(^TMP("XUMF TMP",$J,STA,+$O(^TMP("XUMF TMP",$J,STA,0))))
"RTN","XUMF4A",189,0)
 .F  S IEN=$O(^TMP("XUMF TMP",$J,STA,IEN)) Q:'IEN  D
"RTN","XUMF4A",190,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",191,0)
 ;
"RTN","XUMF4A",192,0)
 K ^TMP("XUMF TMP",$J)
"RTN","XUMF4A",193,0)
 ;
"RTN","XUMF4A",194,0)
 Q CNT
"RTN","XUMF4A",195,0)
 ;
"RTN","XUMF4A",196,0)
CMVD() ; -- check for missing national data
"RTN","XUMF4A",197,0)
 ;
"RTN","XUMF4A",198,0)
 N STA,CNT
"RTN","XUMF4A",199,0)
 ;
"RTN","XUMF4A",200,0)
 S CNT=0
"RTN","XUMF4A",201,0)
 ;
"RTN","XUMF4A",202,0)
 S STA=""
"RTN","XUMF4A",203,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",204,0)
 .Q:$D(^DIC(4,"D",STA))
"RTN","XUMF4A",205,0)
 .S CNT=CNT+1
"RTN","XUMF4A",206,0)
 ;
"RTN","XUMF4A",207,0)
 Q CNT
"RTN","XUMF4A",208,0)
 ;
"RTN","XUMF4A",209,0)
CHCK ; -- check if clean up is complete
"RTN","XUMF4A",210,0)
 ;
"RTN","XUMF4A",211,0)
 N VAR,FLD
"RTN","XUMF4A",212,0)
 ;
"RTN","XUMF4A",213,0)
 K ^TMP("XUMF CHCK",$J)
"RTN","XUMF4A",214,0)
 ;
"RTN","XUMF4A",215,0)
 S VALMCNT=0
"RTN","XUMF4A",216,0)
 ;
"RTN","XUMF4A",217,0)
 I $$CDSN D
"RTN","XUMF4A",218,0)
 .S VALMCNT=VALMCNT+1,VAR=""
"RTN","XUMF4A",219,0)
 .S FLD="Local/Duplicate station #s exist -- use DSTA"
"RTN","XUMF4A",220,0)
 .S VAR=$$SETFLD^VALM1(FLD,VAR,"MSG")
"RTN","XUMF4A",221,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4A",222,0)
 ;
"RTN","XUMF4A",223,0)
 I $$CMVD D
"RTN","XUMF4A",224,0)
 .S VALMCNT=VALMCNT+1,VAR=""
"RTN","XUMF4A",225,0)
 .S FLD="INSTITUTION file not updated with NATIONAL data -- use AUTO"
"RTN","XUMF4A",226,0)
 .S VAR=$$SETFLD^VALM1(FLD,VAR,"MSG")
"RTN","XUMF4A",227,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4A",228,0)
 ;
"RTN","XUMF4A",229,0)
 D:'VALMCNT
"RTN","XUMF4A",230,0)
 .S VAR="",FLD="CONGRATULATIONS!!!  Update complete!"
"RTN","XUMF4A",231,0)
 .S VAR=$$SETFLD^VALM1(FLD,VAR,"MSG")
"RTN","XUMF4A",232,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4A",233,0)
 ;
"RTN","XUMF4A",234,0)
 Q
"RTN","XUMF4A",235,0)
 ;
"RTN","XUMF4A",236,0)
FACTYP ;resolve duplicate facility types
"RTN","XUMF4A",237,0)
 ;
"RTN","XUMF4A",238,0)
 N FT,CNT,IEN,DA,DIE,DR
"RTN","XUMF4A",239,0)
 ;
"RTN","XUMF4A",240,0)
 S FT="",(CNT,IEN)=0
"RTN","XUMF4A",241,0)
 F  S FT=$O(^DIC(4.1,"B",FT)) Q:FT=""  D
"RTN","XUMF4A",242,0)
 .F  S IEN=$O(^DIC(4.1,"B",FT,IEN)) Q:'IEN  D
"RTN","XUMF4A",243,0)
 ..Q:$E(FT,1,2)="ZZ"
"RTN","XUMF4A",244,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",245,0)
 ..Q:CNT<2
"RTN","XUMF4A",246,0)
 ..S DA=IEN,DIE=4.1
"RTN","XUMF4A",247,0)
 ..S DR=".01///ZZ"_$P($G(^DIC(4.1,+IEN,0)),U)
"RTN","XUMF4A",248,0)
 ..D ^DIE
"RTN","XUMF4A",249,0)
 .S CNT=0
"RTN","XUMF4A",250,0)
 ;
"RTN","XUMF4A",251,0)
 Q
"RTN","XUMF4A",252,0)
 ;
"RTN","XUMF4A",253,0)
STATE ;resolve duplicate states
"RTN","XUMF4A",254,0)
 ;
"RTN","XUMF4A",255,0)
 N STATE,CNT,IEN,DA,DIE,DR
"RTN","XUMF4A",256,0)
 ;
"RTN","XUMF4A",257,0)
 ;name
"RTN","XUMF4A",258,0)
 S STATE="",(CNT,IEN)=0
"RTN","XUMF4A",259,0)
 F  S STATE=$O(^DIC(5,"B",STATE)) Q:STATE=""  D
"RTN","XUMF4A",260,0)
 .F  S IEN=$O(^DIC(5,"B",STATE,IEN)) Q:'IEN  D
"RTN","XUMF4A",261,0)
 ..Q:$E(STATE,1,2)="ZZ"
"RTN","XUMF4A",262,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",263,0)
 ..Q:CNT<2
"RTN","XUMF4A",264,0)
 ..S DA=IEN,DIE=5
"RTN","XUMF4A",265,0)
 ..S DR=".01///ZZ"_$P($G(^DIC(5,+IEN,0)),U)
"RTN","XUMF4A",266,0)
 ..D ^DIE
"RTN","XUMF4A",267,0)
 .S CNT=0
"RTN","XUMF4A",268,0)
 ;
"RTN","XUMF4A",269,0)
 ;abbreviation
"RTN","XUMF4A",270,0)
 S STATE="",(CNT,IEN)=0
"RTN","XUMF4A",271,0)
 F  S STATE=$O(^DIC(5,"C",STATE)) Q:STATE=""  Q:STATE  D
"RTN","XUMF4A",272,0)
 .F  S IEN=$O(^DIC(5,"C",STATE,IEN)) Q:'IEN  D
"RTN","XUMF4A",273,0)
 ..Q:$E(STATE,1,2)="ZZ"
"RTN","XUMF4A",274,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",275,0)
 ..Q:CNT<2
"RTN","XUMF4A",276,0)
 ..S DA=IEN,DIE=5
"RTN","XUMF4A",277,0)
 ..S DR="1///ZZ"_$P($G(^DIC(5,+IEN,0)),U,2)
"RTN","XUMF4A",278,0)
 ..D ^DIE
"RTN","XUMF4A",279,0)
 .S CNT=0
"RTN","XUMF4A",280,0)
 ;
"RTN","XUMF4A",281,0)
 Q
"RTN","XUMF4A",282,0)
 ;
"RTN","XUMF4A",283,0)
FTCLEAN ; -- add missing facility types
"RTN","XUMF4A",284,0)
 ;
"RTN","XUMF4A",285,0)
 N NAME,FULL,FDA
"RTN","XUMF4A",286,0)
 ;
"RTN","XUMF4A",287,0)
 S NAME=""
"RTN","XUMF4A",288,0)
 F  S NAME=$O(^TMP("XUMF ARRAY",$J,NAME)) Q:NAME=""  D
"RTN","XUMF4A",289,0)
 .S FULL=$P(^TMP("XUMF ARRAY",$J,NAME),U,3)
"RTN","XUMF4A",290,0)
 .D
"RTN","XUMF4A",291,0)
 ..K FDA
"RTN","XUMF4A",292,0)
 ..S FDA(4.1,"?+1,",.01)=NAME
"RTN","XUMF4A",293,0)
 ..S FDA(4.1,"?+1,",1)=FULL
"RTN","XUMF4A",294,0)
 ..S FDA(4.1,"?+1,",3)="N"
"RTN","XUMF4A",295,0)
 ..N NAME
"RTN","XUMF4A",296,0)
 ..D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF4A",297,0)
 ;
"RTN","XUMF4A",298,0)
 Q
"RTN","XUMF4A",299,0)
 ;
"VER")
8.0^22.0
**END**
**END**
