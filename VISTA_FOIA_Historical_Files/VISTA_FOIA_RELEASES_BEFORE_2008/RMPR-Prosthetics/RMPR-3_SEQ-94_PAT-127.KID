Released RMPR*3*127 SEQ #94
Extracted from mail message
**KIDS**:RMPR*3.0*127^

**INSTALL NAME**
RMPR*3.0*127
"BLD",6006,0)
RMPR*3.0*127^PROSTHETICS^0^3060329^y
"BLD",6006,1,0)
^^4^4^3060329^
"BLD",6006,1,1,0)
1. PIP roll-up does not match local Item Detail Report.
"BLD",6006,1,2,0)
 
"BLD",6006,1,3,0)
2.  Fix the ien for station number starting point in PIP Extract 
"BLD",6006,1,4,0)
    collection to begin at station ien 1 instead of 2.
"BLD",6006,4,0)
^9.64PA^^
"BLD",6006,6.3)
4
"BLD",6006,"ABPKG")
n
"BLD",6006,"KRN",0)
^9.67PA^8989.52^19
"BLD",6006,"KRN",.4,0)
.4
"BLD",6006,"KRN",.401,0)
.401
"BLD",6006,"KRN",.402,0)
.402
"BLD",6006,"KRN",.403,0)
.403
"BLD",6006,"KRN",.5,0)
.5
"BLD",6006,"KRN",.84,0)
.84
"BLD",6006,"KRN",3.6,0)
3.6
"BLD",6006,"KRN",3.8,0)
3.8
"BLD",6006,"KRN",9.2,0)
9.2
"BLD",6006,"KRN",9.8,0)
9.8
"BLD",6006,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6006,"KRN",9.8,"NM",1,0)
RMPR5HQ5^^0^40993674
"BLD",6006,"KRN",9.8,"NM",2,0)
RMPRPIQ5^^0^39222527
"BLD",6006,"KRN",9.8,"NM","B","RMPR5HQ5",1)

"BLD",6006,"KRN",9.8,"NM","B","RMPRPIQ5",2)

"BLD",6006,"KRN",19,0)
19
"BLD",6006,"KRN",19.1,0)
19.1
"BLD",6006,"KRN",101,0)
101
"BLD",6006,"KRN",409.61,0)
409.61
"BLD",6006,"KRN",771,0)
771
"BLD",6006,"KRN",870,0)
870
"BLD",6006,"KRN",8989.51,0)
8989.51
"BLD",6006,"KRN",8989.52,0)
8989.52
"BLD",6006,"KRN",8994,0)
8994
"BLD",6006,"KRN","B",.4,.4)

"BLD",6006,"KRN","B",.401,.401)

"BLD",6006,"KRN","B",.402,.402)

"BLD",6006,"KRN","B",.403,.403)

"BLD",6006,"KRN","B",.5,.5)

"BLD",6006,"KRN","B",.84,.84)

"BLD",6006,"KRN","B",3.6,3.6)

"BLD",6006,"KRN","B",3.8,3.8)

"BLD",6006,"KRN","B",9.2,9.2)

"BLD",6006,"KRN","B",9.8,9.8)

"BLD",6006,"KRN","B",19,19)

"BLD",6006,"KRN","B",19.1,19.1)

"BLD",6006,"KRN","B",101,101)

"BLD",6006,"KRN","B",409.61,409.61)

"BLD",6006,"KRN","B",771,771)

"BLD",6006,"KRN","B",870,870)

"BLD",6006,"KRN","B",8989.51,8989.51)

"BLD",6006,"KRN","B",8989.52,8989.52)

"BLD",6006,"KRN","B",8994,8994)

"BLD",6006,"QUES",0)
^9.62^^
"BLD",6006,"REQB",0)
^9.611^2^1
"BLD",6006,"REQB",2,0)
RMPR*3.0*61^2
"BLD",6006,"REQB","B","RMPR*3.0*61",2)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
127^3060329
"PKG",101,22,1,"PAH",1,1,0)
^^4^4^3060329
"PKG",101,22,1,"PAH",1,1,1,0)
1. PIP roll-up does not match local Item Detail Report.
"PKG",101,22,1,"PAH",1,1,2,0)
 
"PKG",101,22,1,"PAH",1,1,3,0)
2.  Fix the ien for station number starting point in PIP Extract 
"PKG",101,22,1,"PAH",1,1,4,0)
    collection to begin at station ien 1 instead of 2.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RMPR5HQ5")
0^1^B40993674^B40855688
"RTN","RMPR5HQ5",1,0)
RMPR5HQ5 ;HCIOFO/ODJ - INVENTORY REPORT - BUILD ^TMP SORT ARRAY ; 20 SEP 00
"RTN","RMPR5HQ5",2,0)
 ;;3.0;PROSTHETICS;**51,61,127**;Feb 09, 1996
"RTN","RMPR5HQ5",3,0)
 ;
"RTN","RMPR5HQ5",4,0)
 ;RVD -patch #61 - modified to read the new PIP files; 661.11, 661.6
"RTN","RMPR5HQ5",5,0)
 ;                 661.7, 661.9
"RTN","RMPR5HQ5",6,0)
 Q
"RTN","RMPR5HQ5",7,0)
 ;
"RTN","RMPR5HQ5",8,0)
 ; Start of Report build and print. Enter here after report params.
"RTN","RMPR5HQ5",9,0)
 ; entered by user (see RMPR5HQ4).
"RTN","RMPR5HQ5",10,0)
 ; Also called by TaskMan if report queued.
"RTN","RMPR5HQ5",11,0)
 ;
"RTN","RMPR5HQ5",12,0)
 ; Variables required
"RTN","RMPR5HQ5",13,0)
 ;
"RTN","RMPR5HQ5",14,0)
 ; RMPR("STA")
"RTN","RMPR5HQ5",15,0)
 ; RMPRSDT
"RTN","RMPR5HQ5",16,0)
 ; RMPREDT
"RTN","RMPR5HQ5",17,0)
 ; RMPRDET
"RTN","RMPR5HQ5",18,0)
 ; RMPRSEL
"RTN","RMPR5HQ5",19,0)
 ; {IO vars}
"RTN","RMPR5HQ5",20,0)
 ;
"RTN","RMPR5HQ5",21,0)
REPORT I $E(IOST)["C" W !!,"Processing report......."
"RTN","RMPR5HQ5",22,0)
 D GEN(RMPRSDT,RMPREDT,RMPRDET,.RMPRSEL,RMPR("STA")) ;generate ^TMP sort array
"RTN","RMPR5HQ5",23,0)
 D CALC^RMPR5HQ6 ;calculations
"RTN","RMPR5HQ5",24,0)
 U IO D ^RMPR5HQ2     ;print report
"RTN","RMPR5HQ5",25,0)
 D ^%ZISC
"RTN","RMPR5HQ5",26,0)
 ;K ^TMP($J,"RMPR5") ;make live after testing
"RTN","RMPR5HQ5",27,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPR5HQ5",28,0)
 Q
"RTN","RMPR5HQ5",29,0)
 ;
"RTN","RMPR5HQ5",30,0)
 ; Entry point for national roll-up
"RTN","RMPR5HQ5",31,0)
NATION N RMPRSEL,RMPRDET,RMPRSTN,RMPRSDT,RMPREDT,X,RSTN
"RTN","RMPR5HQ5",32,0)
 S RMPRSTN="*"
"RTN","RMPR5HQ5",33,0)
 S RMPRDET="H"
"RTN","RMPR5HQ5",34,0)
 ;D NOW^%DTC S RMPREDT=X S %H=%H-30 D YMD^%DTC S RMPRSDT=X
"RTN","RMPR5HQ5",35,0)
 S RMPRSDT=RMPRPIP1,RMPREDT=RMPRPIP2
"RTN","RMPR5HQ5",36,0)
 S RMPRSEL("*")=""
"RTN","RMPR5HQ5",37,0)
 D GEN(RMPRSDT,RMPREDT,RMPRDET,.RMPRSEL,RMPRSTN)
"RTN","RMPR5HQ5",38,0)
 D CALC^RMPR5HQ6 ;put calcs in TMP array
"RTN","RMPR5HQ5",39,0)
 D MAIL^RMPR5HQ7 ;build ^TMP($J,"RMPR5A" array for mailing
"RTN","RMPR5HQ5",40,0)
 Q
"RTN","RMPR5HQ5",41,0)
 ;
"RTN","RMPR5HQ5",42,0)
 ;
"RTN","RMPR5HQ5",43,0)
 ; Generate temporary index global ^TMP($J,"RMPR5"
"RTN","RMPR5HQ5",44,0)
 ; (as of 11/29/00 we use the 660 file, not 661.2)
"RTN","RMPR5HQ5",45,0)
 ;
"RTN","RMPR5HQ5",46,0)
GEN(STDT,ENDT,DETAIL,RMPRSEL,RMPRSTN) ;
"RTN","RMPR5HQ5",47,0)
 N TNAM,FROM,EOF,DAT,HCDAT,HCPCIEN,NPGRP,NPLIN,S,HCPC,HCPCITEM
"RTN","RMPR5HQ5",48,0)
 N OUPIEN,ITEM,ALLGRP,HCPCREF,SELECTED,STATION,QTY,STR,MULITEM
"RTN","RMPR5HQ5",49,0)
 N ITMIEN,INVDT,SOURCE,ISCOST,PATIENT,COST
"RTN","RMPR5HQ5",50,0)
 S TNAM="RMPR5" ;TMP global name
"RTN","RMPR5HQ5",51,0)
 K ^TMP($J,TNAM)
"RTN","RMPR5HQ5",52,0)
 D CURVAL(TNAM,RMPRSTN,.RMPRSEL,DETAIL)
"RTN","RMPR5HQ5",53,0)
 ;S FROM="" S:$G(STDT)'="*" FROM=STDT-1
"RTN","RMPR5HQ5",54,0)
 S RSTN=RMPRSTN
"RTN","RMPR5HQ5",55,0)
 S:RMPRSTN="*" RSTN=0
"RTN","RMPR5HQ5",56,0)
 S EOF=0,ENDT=ENDT+1
"RTN","RMPR5HQ5",57,0)
 F RSTN=RSTN:0 S RSTN=$O(^RMPR(661.6,"XSTD",RSTN)) Q:RSTN'>0  D
"RTN","RMPR5HQ5",58,0)
 .F RSDT=STDT:0 S RSDT=$O(^RMPR(661.6,"XSTD",RSTN,3,RSDT)) Q:(RSDT>ENDT)!(RSDT="")  D  Q:EOF
"RTN","RMPR5HQ5",59,0)
 .. S OUPIEN=0
"RTN","RMPR5HQ5",60,0)
 .. F  S OUPIEN=$O(^RMPR(661.6,"XSTD",RSTN,3,RSDT,OUPIEN)) Q:OUPIEN'>0  D
"RTN","RMPR5HQ5",61,0)
 ... S S=$G(^RMPR(661.6,OUPIEN,0))
"RTN","RMPR5HQ5",62,0)
 ... S PATIENT=$P(S,"^",2) Q:PATIENT=""
"RTN","RMPR5HQ5",63,0)
 ... S QTY=+$P(S,"^",5) Q:QTY<1
"RTN","RMPR5HQ5",64,0)
 ... S HCPC=$P(S,"^",1) Q:HCPC=""
"RTN","RMPR5HQ5",65,0)
 ... S HCPCIEN=$O(^RMPR(661.1,"B",HCPC,0)) Q:HCPCIEN=""
"RTN","RMPR5HQ5",66,0)
 ... S STATION=RSTN Q:STATION=""
"RTN","RMPR5HQ5",67,0)
 ... I RMPRSTN'="*",STATION'=RSTN Q
"RTN","RMPR5HQ5",68,0)
 ... Q:'$D(^TMP($J,TNAM,"Z",HCPCIEN))
"RTN","RMPR5HQ5",69,0)
 ... Q:$P(^TMP($J,TNAM,"Z",HCPCIEN),"^",3)=1
"RTN","RMPR5HQ5",70,0)
 ... S HCPCITEM=HCPC_"-"_$P(S,"^",11)
"RTN","RMPR5HQ5",71,0)
 ... S ITEM=$P(HCPCITEM,"-",2)
"RTN","RMPR5HQ5",72,0)
 ... S:ITEM="" ITEM="?"
"RTN","RMPR5HQ5",73,0)
 ... S ISCOST=$P(S,"^",6)
"RTN","RMPR5HQ5",74,0)
 ...; S COST=$$PRECOST(OUPIEN,HCPCIEN,HCPCITEM,STATION)
"RTN","RMPR5HQ5",75,0)
 ...; I COST'="" S ISCOST=COST-ISCOST
"RTN","RMPR5HQ5",76,0)
 ...; S:COST="" ISCOST=QTY*$P(S,"^",5)
"RTN","RMPR5HQ5",77,0)
 ... S R11=$O(^RMPR(661.11,"C",HCPCITEM,0))
"RTN","RMPR5HQ5",78,0)
 ... S R11DAT=$G(^RMPR(661.11,R11,0))
"RTN","RMPR5HQ5",79,0)
 ... S SOURCE=$P(R11DAT,"^",5)
"RTN","RMPR5HQ5",80,0)
 ... S STR=^TMP($J,TNAM,"Z",HCPCIEN)
"RTN","RMPR5HQ5",81,0)
 ... S NPGRP=$P(STR,"^",1)
"RTN","RMPR5HQ5",82,0)
 ... S NPLIN=$P(STR,"^",2)
"RTN","RMPR5HQ5",83,0)
 ... S HCPCREF=HCPC,$P(HCPCREF,"/",2)=HCPCIEN
"RTN","RMPR5HQ5",84,0)
 ... I '$D(^TMP($J,TNAM,STATION,NPGRP,NPLIN,HCPCREF,ITEM)) D  Q:'+QTY
"RTN","RMPR5HQ5",85,0)
 .... S:+QTY ^TMP($J,TNAM,STATION,NPGRP,NPLIN,HCPCREF,ITEM)=""
"RTN","RMPR5HQ5",86,0)
 .... Q
"RTN","RMPR5HQ5",87,0)
 ... S ^TMP($J,TNAM,STATION,NPGRP,NPLIN,HCPCREF,ITEM,OUPIEN)=QTY_"^"_ISCOST_"^"_SOURCE
"RTN","RMPR5HQ5",88,0)
 ... Q
"RTN","RMPR5HQ5",89,0)
 .. Q
"RTN","RMPR5HQ5",90,0)
 Q
"RTN","RMPR5HQ5",91,0)
 ;
"RTN","RMPR5HQ5",92,0)
 ; Get total cost of item just prior to current issue
"RTN","RMPR5HQ5",93,0)
PRECOST(INVIEN,HCPCIEN,HCPCITEM,STATION) ;
"RTN","RMPR5HQ5",94,0)
 N IEN,COST,STR,LOC
"RTN","RMPR5HQ5",95,0)
 S COST=""
"RTN","RMPR5HQ5",96,0)
 S IEN=INVIEN,RD=RMPRSDT
"RTN","RMPR5HQ5",97,0)
 S RD=$O(^RMPR(661.9,"ASHID",RSTN,HCPC,IEN,RD),-1)
"RTN","RMPR5HQ5",98,0)
 Q:'$G(RD) COST  S RIEN=$O(^RMPR(661.9,"ASHID",RSTN,HCPC,IEN,RD,0))
"RTN","RMPR5HQ5",99,0)
 S STR=^RMPR(661.9,RIEN,0)
"RTN","RMPR5HQ5",100,0)
 S COST=$P(STR,"^",9)
"RTN","RMPR5HQ5",101,0)
 Q COST
"RTN","RMPR5HQ5",102,0)
 ;
"RTN","RMPR5HQ5",103,0)
 ; Get QOH for HCPC
"RTN","RMPR5HQ5",104,0)
CURVAL(RMPRNAM,RMPRSTN,RMPRSEL,DETAIL) ;
"RTN","RMPR5HQ5",105,0)
 N INVIEN,STR,IEN1,IEN2,LOCN,HCPCIEN,HCDAT,NPLIN,NPGRP,ALLGRP,SELECTED
"RTN","RMPR5HQ5",106,0)
 N S,SOURCE,STATION,QOH,COST,HCPC,HCPCREF,ITEM,RSTN
"RTN","RMPR5HQ5",107,0)
 S ALLGRP=0 S:$O(RMPRSEL(""))="*" ALLGRP=1
"RTN","RMPR5HQ5",108,0)
 S RSTN=RMPRSTN
"RTN","RMPR5HQ5",109,0)
 S:RMPRSTN="*" RSTN=0
"RTN","RMPR5HQ5",110,0)
 F RSTN=RSTN:0 S RSTN=$O(^RMPR(661.9,"ASHID",RSTN)) Q:RSTN'>0  D
"RTN","RMPR5HQ5",111,0)
 .S RH=""
"RTN","RMPR5HQ5",112,0)
 .F  S RH=$O(^RMPR(661.9,"ASHID",RSTN,RH)) Q:RH=""  D
"RTN","RMPR5HQ5",113,0)
 .. S IEN1=0
"RTN","RMPR5HQ5",114,0)
 .. F  S IEN1=$O(^RMPR(661.9,"ASHID",RSTN,RH,IEN1)) Q:'+IEN1  D
"RTN","RMPR5HQ5",115,0)
 ... S HCPCIEN=$O(^RMPR(661.1,"B",RH,0)) Q:HCPCIEN=""
"RTN","RMPR5HQ5",116,0)
 ... I '$D(^TMP($J,RMPRNAM,"Z",HCPCIEN)) D
"RTN","RMPR5HQ5",117,0)
 .... S S=^RMPR(661.1,HCPCIEN,0)
"RTN","RMPR5HQ5",118,0)
 .... S NPLIN=$P(S,"^",7)
"RTN","RMPR5HQ5",119,0)
 .... S:NPLIN="" NPLIN="999 X"
"RTN","RMPR5HQ5",120,0)
 .... S NPGRP=$P(NPLIN," ",1) ;group num. is 1st set of digits of new line
"RTN","RMPR5HQ5",121,0)
 .... S STR=NPGRP
"RTN","RMPR5HQ5",122,0)
 .... S $P(STR,"^",2)=NPLIN
"RTN","RMPR5HQ5",123,0)
 .... S ^TMP($J,RMPRNAM,"Z",HCPCIEN)=STR
"RTN","RMPR5HQ5",124,0)
 .... Q
"RTN","RMPR5HQ5",125,0)
 ... E  D  Q:$P(S,"^",3)=1
"RTN","RMPR5HQ5",126,0)
 .... S S=^TMP($J,RMPRNAM,"Z",HCPCIEN)
"RTN","RMPR5HQ5",127,0)
 .... S NPGRP=$P(S,"^",1)
"RTN","RMPR5HQ5",128,0)
 .... S NPLIN=$P(S,"^",2)
"RTN","RMPR5HQ5",129,0)
 .... Q
"RTN","RMPR5HQ5",130,0)
 ... ;
"RTN","RMPR5HQ5",131,0)
 ... ; Test if record matches selection criteria
"RTN","RMPR5HQ5",132,0)
 ... ; (only needed if not all groups selected)
"RTN","RMPR5HQ5",133,0)
 ... I 'ALLGRP D  I 'SELECTED S $P(^TMP($J,RMPRNAM,"Z",HCPCIEN),"^",3)=1 Q
"RTN","RMPR5HQ5",134,0)
 .... S SELECTED=0
"RTN","RMPR5HQ5",135,0)
 .... I '$D(RMPRSEL(NPGRP)) Q
"RTN","RMPR5HQ5",136,0)
 .... I DETAIL="G" S SELECTED=1 Q
"RTN","RMPR5HQ5",137,0)
 .... I $O(RMPRSEL(NPGRP,""))="*" S SELECTED=1 Q
"RTN","RMPR5HQ5",138,0)
 .... I '$D(RMPRSEL(NPGRP,NPLIN)) Q
"RTN","RMPR5HQ5",139,0)
 .... I DETAIL="L" S SELECTED=1 Q
"RTN","RMPR5HQ5",140,0)
 .... I $O(RMPRSEL(NPGRP,NPLIN,""))="*" S SELECTED=1 Q
"RTN","RMPR5HQ5",141,0)
 .... I '$D(RMPRSEL(NPGRP,NPLIN,HCPCIEN)) Q
"RTN","RMPR5HQ5",142,0)
 .... S SELECTED=1
"RTN","RMPR5HQ5",143,0)
 .... Q
"RTN","RMPR5HQ5",144,0)
 ... S RD=ENDT+1
"RTN","RMPR5HQ5",145,0)
 ... S RD=$O(^RMPR(661.9,"ASHID",RSTN,RH,IEN1,RD),-1) Q:RD=""  S RIEN=$O(^RMPR(661.9,"ASHID",RSTN,RH,IEN1,RD,""),-1) D
"RTN","RMPR5HQ5",146,0)
 .... S HCPC=RH,S=^RMPR(661.9,RIEN,0)
"RTN","RMPR5HQ5",147,0)
 .... S QOH=+$P(S,"^",8) Q:'QOH
"RTN","RMPR5HQ5",148,0)
 .... S COST=$P(S,"^",9)
"RTN","RMPR5HQ5",149,0)
 .... S ITEM=IEN1
"RTN","RMPR5HQ5",150,0)
 .... S RS=$O(^RMPR(661.11,"C",HCPC_"-"_ITEM,0)) Q:RS=""
"RTN","RMPR5HQ5",151,0)
 .... S SOURCE=$P($G(^RMPR(661.11,RS,0)),U,5)
"RTN","RMPR5HQ5",152,0)
 .... S HCPCREF=HCPC,$P(HCPCREF,"/",2)=HCPCIEN
"RTN","RMPR5HQ5",153,0)
 .... S S=$G(^TMP($J,RMPRNAM,RSTN,NPGRP,NPLIN,HCPCREF,ITEM))
"RTN","RMPR5HQ5",154,0)
 .... I SOURCE="C" D
"RTN","RMPR5HQ5",155,0)
 ..... S $P(S,"^",9)=QOH+$P(S,"^",9)
"RTN","RMPR5HQ5",156,0)
 ..... S $P(S,"^",11)=COST+$P(S,"^",11)
"RTN","RMPR5HQ5",157,0)
 ..... Q
"RTN","RMPR5HQ5",158,0)
 .... E  D
"RTN","RMPR5HQ5",159,0)
 ..... S $P(S,"^",8)=QOH+$P(S,"^",8)
"RTN","RMPR5HQ5",160,0)
 ..... S $P(S,"^",10)=COST+$P(S,"^",10)
"RTN","RMPR5HQ5",161,0)
 ..... Q
"RTN","RMPR5HQ5",162,0)
 .... S ^TMP($J,RMPRNAM,RSTN,NPGRP,NPLIN,HCPCREF,ITEM)=S
"RTN","RMPR5HQ5",163,0)
 .... Q
"RTN","RMPR5HQ5",164,0)
 ... Q
"RTN","RMPR5HQ5",165,0)
 .. Q
"RTN","RMPR5HQ5",166,0)
 Q
"RTN","RMPR5HQ5",167,0)
 ;
"RTN","RMPR5HQ5",168,0)
 ; return item text string given HCPC and ITEM IENs to 661.11
"RTN","RMPR5HQ5",169,0)
 ; if null ITEMIEN passed the just return the HCPC short name text
"RTN","RMPR5HQ5",170,0)
GETITEM(HCPCIEN,ITEMIEN) ;
"RTN","RMPR5HQ5",171,0)
 N STR,ITEMTXT
"RTN","RMPR5HQ5",172,0)
 S ITEMTXT=""
"RTN","RMPR5HQ5",173,0)
 I ITEMIEN="" D  G GETITEMX
"RTN","RMPR5HQ5",174,0)
 . S STR=$G(^RMPR(661.1,HCPCIEN,0))
"RTN","RMPR5HQ5",175,0)
 . S ITEMTXT=$P(STR,"^",2)
"RTN","RMPR5HQ5",176,0)
 . Q
"RTN","RMPR5HQ5",177,0)
 S HCPC=$P($G(^RMPR(661.1,HCPCIEN,0)),U,1)
"RTN","RMPR5HQ5",178,0)
 S STR=$G(^RMPR(661.11,"C",HCPC_"-"_ITEMIEN,0))
"RTN","RMPR5HQ5",179,0)
 I STR="" D
"RTN","RMPR5HQ5",180,0)
 . S ITEMTXT=$P(^RMPR(661.1,HCPCIEN,0),"^",2)
"RTN","RMPR5HQ5",181,0)
 . Q
"RTN","RMPR5HQ5",182,0)
 E  D
"RTN","RMPR5HQ5",183,0)
 . S ITEMTXT=$P(STR,"^",1)
"RTN","RMPR5HQ5",184,0)
 . Q
"RTN","RMPR5HQ5",185,0)
 S:ITEMTXT="" ITEMTXT="ITEM "_ITEMIEN
"RTN","RMPR5HQ5",186,0)
GETITEMX Q ITEMTXT
"RTN","RMPR5HQ5",187,0)
 ;
"RTN","RMPR5HQ5",188,0)
 ; return NPPD line text from line code (New lines only)
"RTN","RMPR5HQ5",189,0)
NPLIN(CODE) ;
"RTN","RMPR5HQ5",190,0)
 N I,S,LINTXT
"RTN","RMPR5HQ5",191,0)
 S LINTXT=""
"RTN","RMPR5HQ5",192,0)
 F I=1:1 S S=$P($T(DES+I^RMPRN62),";;",2) Q:$E(S,1,3)="END"  D  Q:LINTXT'=""
"RTN","RMPR5HQ5",193,0)
 . I $P(S,";",1)=CODE S LINTXT=$P(S,";",2)
"RTN","RMPR5HQ5",194,0)
 . Q
"RTN","RMPR5HQ5",195,0)
 Q LINTXT
"RTN","RMPRPIQ5")
0^2^B39222527^B39122637
"RTN","RMPRPIQ5",1,0)
RMPRPIQ5 ;HCIOFO/ODJ - INVENTORY REPORT - BUILD ^TMP SORT ARRAY ; 12/30/02  11:35
"RTN","RMPRPIQ5",2,0)
 ;;3.0;PROSTHETICS;**61,127**;Feb 09, 1996
"RTN","RMPRPIQ5",3,0)
 ;
"RTN","RMPRPIQ5",4,0)
 ;RVD patch #61  modified to read the new PIP files; 661.11, 661.6
"RTN","RMPRPIQ5",5,0)
 ;               661.7, 661.9
"RTN","RMPRPIQ5",6,0)
 Q
"RTN","RMPRPIQ5",7,0)
 ;
"RTN","RMPRPIQ5",8,0)
 ; Start of Report build and print. Enter here after report params.
"RTN","RMPRPIQ5",9,0)
 ; entered by user (see RMPR5HQ4).
"RTN","RMPRPIQ5",10,0)
 ; Also called by TaskMan if report queued.
"RTN","RMPRPIQ5",11,0)
 ;
"RTN","RMPRPIQ5",12,0)
 ; Variables required
"RTN","RMPRPIQ5",13,0)
 ;
"RTN","RMPRPIQ5",14,0)
 ; RMPR("STA")
"RTN","RMPRPIQ5",15,0)
 ; RMPRSDT
"RTN","RMPRPIQ5",16,0)
 ; RMPREDT
"RTN","RMPRPIQ5",17,0)
 ; RMPRDET
"RTN","RMPRPIQ5",18,0)
 ; RMPRSEL
"RTN","RMPRPIQ5",19,0)
 ; {IO vars}
"RTN","RMPRPIQ5",20,0)
 ;
"RTN","RMPRPIQ5",21,0)
REPORT I $E(IOST)["C" W !!,"Processing report......."
"RTN","RMPRPIQ5",22,0)
 D GEN(RMPRSDT,RMPREDT,RMPRDET,.RMPRSEL,RMPR("STA")) ;generate ^TMP sort array
"RTN","RMPRPIQ5",23,0)
 D CALC^RMPR5HQ6 ;calculations
"RTN","RMPRPIQ5",24,0)
 U IO D ^RMPR5HQ2     ;print report
"RTN","RMPRPIQ5",25,0)
 D ^%ZISC
"RTN","RMPRPIQ5",26,0)
 ;K ^TMP($J,"RMPR5") ;make live after testing
"RTN","RMPRPIQ5",27,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPRPIQ5",28,0)
 Q
"RTN","RMPRPIQ5",29,0)
 ;
"RTN","RMPRPIQ5",30,0)
 ; Entry point for national roll-up
"RTN","RMPRPIQ5",31,0)
NATION N RMPRSEL,RMPRDET,RMPRSTN,RMPRSDT,RMPREDT,X
"RTN","RMPRPIQ5",32,0)
 S RMPRSTN="*"
"RTN","RMPRPIQ5",33,0)
 S RMPRDET="H"
"RTN","RMPRPIQ5",34,0)
 ;D NOW^%DTC S RMPREDT=X S %H=%H-30 D YMD^%DTC S RMPRSDT=X
"RTN","RMPRPIQ5",35,0)
 S RMPRSDT=RMPRPIP1,RMPREDT=RMPRPIP2
"RTN","RMPRPIQ5",36,0)
 S RMPRSEL("*")=""
"RTN","RMPRPIQ5",37,0)
 D GEN(RMPRSDT,RMPREDT,RMPRDET,.RMPRSEL,RMPRSTN)
"RTN","RMPRPIQ5",38,0)
 D CALC^RMPR5HQ6 ;put calcs in TMP array
"RTN","RMPRPIQ5",39,0)
 D MAIL^RMPR5HQ7 ;build ^TMP($J,"RMPR5A" array for mailing
"RTN","RMPRPIQ5",40,0)
 Q
"RTN","RMPRPIQ5",41,0)
 ;
"RTN","RMPRPIQ5",42,0)
 ;
"RTN","RMPRPIQ5",43,0)
 ; Generate temporary index global ^TMP($J,"RMPR5"
"RTN","RMPRPIQ5",44,0)
 ; (as of 11/29/00 we use the 660 file, not 661.2)
"RTN","RMPRPIQ5",45,0)
 ;
"RTN","RMPRPIQ5",46,0)
GEN(STDT,ENDT,DETAIL,RMPRSEL,RMPRSTN) ;
"RTN","RMPRPIQ5",47,0)
 N TNAM,FROM,EOF,DAT,HCDAT,HCPCIEN,NPGRP,NPLIN,S,HCPC,HCPCITEM
"RTN","RMPRPIQ5",48,0)
 N OUPIEN,ITEM,ALLGRP,HCPCREF,SELECTED,STATION,QTY,STR,MULITEM
"RTN","RMPRPIQ5",49,0)
 N ITMIEN,INVDT,SOURCE,ISCOST,PATIENT,COST
"RTN","RMPRPIQ5",50,0)
 S TNAM="RMPR5" ;TMP global name
"RTN","RMPRPIQ5",51,0)
 K ^TMP($J,TNAM)
"RTN","RMPRPIQ5",52,0)
 D CURVAL(TNAM,RMPRSTN,.RMPRSEL,DETAIL)
"RTN","RMPRPIQ5",53,0)
 ;S FROM="" S:$G(STDT)'="*" FROM=STDT-1
"RTN","RMPRPIQ5",54,0)
 S EOF=0,ENDT=ENDT+1
"RTN","RMPRPIQ5",55,0)
 F RSDT=STDT:0 S RSDT=$O(^RMPR(661.6,"XSTD",RMPRSTN,3,RSDT)) Q:(RSDT>ENDT)!(RSDT="")  D  Q:EOF
"RTN","RMPRPIQ5",56,0)
 .; I INVDT="" S EOF=1 Q
"RTN","RMPRPIQ5",57,0)
 .; I ENDT'="*",INVDT>ENDT S EOF=1 Q
"RTN","RMPRPIQ5",58,0)
 . S OUPIEN=0
"RTN","RMPRPIQ5",59,0)
 . F  S OUPIEN=$O(^RMPR(661.6,"XSTD",RMPRSTN,3,RSDT,OUPIEN)) Q:OUPIEN'>0  D
"RTN","RMPRPIQ5",60,0)
 .. S S=$G(^RMPR(661.6,OUPIEN,0))
"RTN","RMPRPIQ5",61,0)
 .. S PATIENT=$P(S,"^",2) Q:PATIENT=""
"RTN","RMPRPIQ5",62,0)
 .. S QTY=+$P(S,"^",5) Q:QTY<1
"RTN","RMPRPIQ5",63,0)
 .. S HCPC=$P(S,"^",1) Q:HCPC=""
"RTN","RMPRPIQ5",64,0)
 .. S HCPCIEN=$O(^RMPR(661.1,"B",HCPC,0)) Q:HCPCIEN=""
"RTN","RMPRPIQ5",65,0)
 .. S STATION=RMPRSTN Q:STATION=""
"RTN","RMPRPIQ5",66,0)
 .. I RMPRSTN'="*",STATION'=RMPRSTN Q
"RTN","RMPRPIQ5",67,0)
 .. Q:'$D(^TMP($J,TNAM,"Z",HCPCIEN))
"RTN","RMPRPIQ5",68,0)
 .. Q:$P(^TMP($J,TNAM,"Z",HCPCIEN),"^",3)=1
"RTN","RMPRPIQ5",69,0)
 .. S HCPCITEM=HCPC_"-"_$P(S,"^",11)
"RTN","RMPRPIQ5",70,0)
 .. S ITEM=$P(HCPCITEM,"-",2)
"RTN","RMPRPIQ5",71,0)
 .. S:ITEM="" ITEM="?"
"RTN","RMPRPIQ5",72,0)
 .. S ISCOST=$P(S,"^",6)
"RTN","RMPRPIQ5",73,0)
 ..; S COST=$$PRECOST(OUPIEN,HCPCIEN,HCPCITEM,STATION)
"RTN","RMPRPIQ5",74,0)
 ..; I COST'="" S ISCOST=COST-ISCOST
"RTN","RMPRPIQ5",75,0)
 ..; S:COST="" ISCOST=QTY*$P(S,"^",5)
"RTN","RMPRPIQ5",76,0)
 .. S R11=$O(^RMPR(661.11,"C",HCPCITEM,0))
"RTN","RMPRPIQ5",77,0)
 .. S R11DAT=$G(^RMPR(661.11,R11,0))
"RTN","RMPRPIQ5",78,0)
 .. S SOURCE=$P(R11DAT,"^",5)
"RTN","RMPRPIQ5",79,0)
 .. S STR=^TMP($J,TNAM,"Z",HCPCIEN)
"RTN","RMPRPIQ5",80,0)
 .. S NPGRP=$P(STR,"^",1)
"RTN","RMPRPIQ5",81,0)
 .. S NPLIN=$P(STR,"^",2)
"RTN","RMPRPIQ5",82,0)
 .. S HCPCREF=HCPC,$P(HCPCREF,"/",2)=HCPCIEN
"RTN","RMPRPIQ5",83,0)
 .. I '$D(^TMP($J,TNAM,STATION,NPGRP,NPLIN,HCPCREF,ITEM)) D  Q:'+QTY
"RTN","RMPRPIQ5",84,0)
 ... S:+QTY ^TMP($J,TNAM,STATION,NPGRP,NPLIN,HCPCREF,ITEM)=""
"RTN","RMPRPIQ5",85,0)
 ... Q
"RTN","RMPRPIQ5",86,0)
 .. S ^TMP($J,TNAM,STATION,NPGRP,NPLIN,HCPCREF,ITEM,OUPIEN)=QTY_"^"_ISCOST_"^"_SOURCE
"RTN","RMPRPIQ5",87,0)
 .. Q
"RTN","RMPRPIQ5",88,0)
 . Q
"RTN","RMPRPIQ5",89,0)
 Q
"RTN","RMPRPIQ5",90,0)
 ;
"RTN","RMPRPIQ5",91,0)
 ; Get total cost of item just prior to current issue
"RTN","RMPRPIQ5",92,0)
PRECOST(INVIEN,HCPCIEN,HCPCITEM,STATION) ;
"RTN","RMPRPIQ5",93,0)
 N IEN,COST,STR,LOC
"RTN","RMPRPIQ5",94,0)
 S COST=""
"RTN","RMPRPIQ5",95,0)
 S IEN=INVIEN,RD=RMPRSDT
"RTN","RMPRPIQ5",96,0)
 S RD=$O(^RMPR(661.9,"ASHID",RMPRSTN,HCPC,IEN,RD),-1)
"RTN","RMPRPIQ5",97,0)
 Q:'$G(RD)  S RIEN=$O(^RMPR(661.9,"ASHID",RMPRSTN,HCPC,IEN,RD,0))
"RTN","RMPRPIQ5",98,0)
 S STR=^RMPR(661.9,RIEN,0)
"RTN","RMPRPIQ5",99,0)
 S COST=$P(STR,"^",9)
"RTN","RMPRPIQ5",100,0)
 Q COST
"RTN","RMPRPIQ5",101,0)
 ;
"RTN","RMPRPIQ5",102,0)
 ; Get QOH for HCPC
"RTN","RMPRPIQ5",103,0)
CURVAL(RMPRNAM,RMPRSTN,RMPRSEL,DETAIL) ;
"RTN","RMPRPIQ5",104,0)
 N INVIEN,STR,IEN1,IEN2,LOCN,HCPCIEN,HCDAT,NPLIN,NPGRP,ALLGRP,SELECTED
"RTN","RMPRPIQ5",105,0)
 N S,SOURCE,STATION,QOH,COST,HCPC,HCPCREF,ITEM
"RTN","RMPRPIQ5",106,0)
 S ALLGRP=0 S:$O(RMPRSEL(""))="*" ALLGRP=1
"RTN","RMPRPIQ5",107,0)
 S RH=""
"RTN","RMPRPIQ5",108,0)
 F  S RH=$O(^RMPR(661.9,"ASHID",RMPRSTN,RH)) Q:RH=""  D
"RTN","RMPRPIQ5",109,0)
 . S IEN1=0
"RTN","RMPRPIQ5",110,0)
 . F  S IEN1=$O(^RMPR(661.9,"ASHID",RMPRSTN,RH,IEN1)) Q:'+IEN1  D
"RTN","RMPRPIQ5",111,0)
 .. S HCPCIEN=$O(^RMPR(661.1,"B",RH,0)) Q:HCPCIEN=""
"RTN","RMPRPIQ5",112,0)
 .. I '$D(^TMP($J,RMPRNAM,"Z",HCPCIEN)) D
"RTN","RMPRPIQ5",113,0)
 ... S S=^RMPR(661.1,HCPCIEN,0)
"RTN","RMPRPIQ5",114,0)
 ... S NPLIN=$P(S,"^",7)
"RTN","RMPRPIQ5",115,0)
 ... S:NPLIN="" NPLIN="999 X"
"RTN","RMPRPIQ5",116,0)
 ... S NPGRP=$P(NPLIN," ",1) ;group num. is 1st set of digits of new line
"RTN","RMPRPIQ5",117,0)
 ... S STR=NPGRP
"RTN","RMPRPIQ5",118,0)
 ... S $P(STR,"^",2)=NPLIN
"RTN","RMPRPIQ5",119,0)
 ... S ^TMP($J,RMPRNAM,"Z",HCPCIEN)=STR
"RTN","RMPRPIQ5",120,0)
 ... Q
"RTN","RMPRPIQ5",121,0)
 .. E  D  Q:$P(S,"^",3)=1
"RTN","RMPRPIQ5",122,0)
 ... S S=^TMP($J,RMPRNAM,"Z",HCPCIEN)
"RTN","RMPRPIQ5",123,0)
 ... S NPGRP=$P(S,"^",1)
"RTN","RMPRPIQ5",124,0)
 ... S NPLIN=$P(S,"^",2)
"RTN","RMPRPIQ5",125,0)
 ... Q
"RTN","RMPRPIQ5",126,0)
 .. ;
"RTN","RMPRPIQ5",127,0)
 .. ; Test if record matches selection criteria
"RTN","RMPRPIQ5",128,0)
 .. ; (only needed if not all groups selected)
"RTN","RMPRPIQ5",129,0)
 .. I 'ALLGRP D  I 'SELECTED S $P(^TMP($J,RMPRNAM,"Z",HCPCIEN),"^",3)=1 Q
"RTN","RMPRPIQ5",130,0)
 ... S SELECTED=0
"RTN","RMPRPIQ5",131,0)
 ... I '$D(RMPRSEL(NPGRP)) Q
"RTN","RMPRPIQ5",132,0)
 ... I DETAIL="G" S SELECTED=1 Q
"RTN","RMPRPIQ5",133,0)
 ... I $O(RMPRSEL(NPGRP,""))="*" S SELECTED=1 Q
"RTN","RMPRPIQ5",134,0)
 ... I '$D(RMPRSEL(NPGRP,NPLIN)) Q
"RTN","RMPRPIQ5",135,0)
 ... I DETAIL="L" S SELECTED=1 Q
"RTN","RMPRPIQ5",136,0)
 ... I $O(RMPRSEL(NPGRP,NPLIN,""))="*" S SELECTED=1 Q
"RTN","RMPRPIQ5",137,0)
 ... I '$D(RMPRSEL(NPGRP,NPLIN,HCPCIEN)) Q
"RTN","RMPRPIQ5",138,0)
 ... S SELECTED=1
"RTN","RMPRPIQ5",139,0)
 ... Q
"RTN","RMPRPIQ5",140,0)
 .. S RD=ENDT+1
"RTN","RMPRPIQ5",141,0)
 .. S RD=$O(^RMPR(661.9,"ASHID",RMPRSTN,RH,IEN1,RD),-1) Q:RD=""  S RIEN=$O(^RMPR(661.9,"ASHID",RMPRSTN,RH,IEN1,RD,""),-1) D
"RTN","RMPRPIQ5",142,0)
 ... Q:'$D(^RMPR(661.9,RIEN,0))
"RTN","RMPRPIQ5",143,0)
 ... S HCPC=RH,S=^RMPR(661.9,RIEN,0)
"RTN","RMPRPIQ5",144,0)
 ... S QOH=+$P(S,"^",8) Q:'QOH
"RTN","RMPRPIQ5",145,0)
 ... S COST=$P(S,"^",9)
"RTN","RMPRPIQ5",146,0)
 ... S ITEM=IEN1
"RTN","RMPRPIQ5",147,0)
 ... S RS=$O(^RMPR(661.11,"C",HCPC_"-"_ITEM,0)) Q:RS=""
"RTN","RMPRPIQ5",148,0)
 ... S SOURCE=$P($G(^RMPR(661.11,RS,0)),U,5)
"RTN","RMPRPIQ5",149,0)
 ... S HCPCREF=HCPC,$P(HCPCREF,"/",2)=HCPCIEN
"RTN","RMPRPIQ5",150,0)
 ... S S=$G(^TMP($J,RMPRNAM,RMPRSTN,NPGRP,NPLIN,HCPCREF,ITEM))
"RTN","RMPRPIQ5",151,0)
 ... I SOURCE="C" D
"RTN","RMPRPIQ5",152,0)
 .... S $P(S,"^",9)=QOH+$P(S,"^",9)
"RTN","RMPRPIQ5",153,0)
 .... S $P(S,"^",11)=COST+$P(S,"^",11)
"RTN","RMPRPIQ5",154,0)
 .... Q
"RTN","RMPRPIQ5",155,0)
 ... E  D
"RTN","RMPRPIQ5",156,0)
 .... S $P(S,"^",8)=QOH+$P(S,"^",8)
"RTN","RMPRPIQ5",157,0)
 .... S $P(S,"^",10)=COST+$P(S,"^",10)
"RTN","RMPRPIQ5",158,0)
 .... Q
"RTN","RMPRPIQ5",159,0)
 ... S ^TMP($J,RMPRNAM,RMPRSTN,NPGRP,NPLIN,HCPCREF,ITEM)=S
"RTN","RMPRPIQ5",160,0)
 ... Q
"RTN","RMPRPIQ5",161,0)
 .. Q
"RTN","RMPRPIQ5",162,0)
 . Q
"RTN","RMPRPIQ5",163,0)
 Q
"RTN","RMPRPIQ5",164,0)
 ;
"RTN","RMPRPIQ5",165,0)
 ; return item text string given HCPC and ITEM IENs to 661.11
"RTN","RMPRPIQ5",166,0)
 ; if null ITEMIEN passed the just return the HCPC short name text
"RTN","RMPRPIQ5",167,0)
GETITEM(HCPCIEN,ITEMIEN) ;
"RTN","RMPRPIQ5",168,0)
 N STR,ITEMTXT
"RTN","RMPRPIQ5",169,0)
 S ITEMTXT=""
"RTN","RMPRPIQ5",170,0)
 I ITEMIEN="" D  G GETITEMX
"RTN","RMPRPIQ5",171,0)
 . S STR=$G(^RMPR(661.1,HCPCIEN,0))
"RTN","RMPRPIQ5",172,0)
 . S ITEMTXT=$P(STR,"^",2)
"RTN","RMPRPIQ5",173,0)
 . Q
"RTN","RMPRPIQ5",174,0)
 S HCPC=$P($G(^RMPR(661.1,HCPCIEN,0)),U,1)
"RTN","RMPRPIQ5",175,0)
 S STR=$G(^RMPR(661.11,"C",HCPC_"-"_ITEMIEN,0))
"RTN","RMPRPIQ5",176,0)
 I STR="" D
"RTN","RMPRPIQ5",177,0)
 . S ITEMTXT=$P(^RMPR(661.1,HCPCIEN,0),"^",2)
"RTN","RMPRPIQ5",178,0)
 . Q
"RTN","RMPRPIQ5",179,0)
 E  D
"RTN","RMPRPIQ5",180,0)
 . S ITEMTXT=$P(STR,"^",1)
"RTN","RMPRPIQ5",181,0)
 . Q
"RTN","RMPRPIQ5",182,0)
 S:ITEMTXT="" ITEMTXT="ITEM "_ITEMIEN
"RTN","RMPRPIQ5",183,0)
GETITEMX Q ITEMTXT
"RTN","RMPRPIQ5",184,0)
 ;
"RTN","RMPRPIQ5",185,0)
 ; return NPPD line text from line code (New lines only)
"RTN","RMPRPIQ5",186,0)
NPLIN(CODE) ;
"RTN","RMPRPIQ5",187,0)
 N I,S,LINTXT
"RTN","RMPRPIQ5",188,0)
 S LINTXT=""
"RTN","RMPRPIQ5",189,0)
 F I=1:1 S S=$P($T(DES+I^RMPRN62),";;",2) Q:$E(S,1,3)="END"  D  Q:LINTXT'=""
"RTN","RMPRPIQ5",190,0)
 . I $P(S,";",1)=CODE S LINTXT=$P(S,";",2)
"RTN","RMPRPIQ5",191,0)
 . Q
"RTN","RMPRPIQ5",192,0)
 Q LINTXT
"VER")
8.0^22.0
"BLD",6006,6)
^94
**END**
**END**
