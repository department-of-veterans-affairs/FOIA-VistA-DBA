Released FH*5.5*11 SEQ #8
Extracted from mail message
**KIDS**:FH*5.5*11^

**INSTALL NAME**
FH*5.5*11
"BLD",6249,0)
FH*5.5*11^DIETETICS^0^3070222^y
"BLD",6249,1,0)
^^1^1^3061122^
"BLD",6249,1,1,0)
BAGGED MEALS SETTING/VARIABLE CLEANUP
"BLD",6249,4,0)
^9.64PA^^
"BLD",6249,6.3)
4
"BLD",6249,"KRN",0)
^9.67PA^8989.52^19
"BLD",6249,"KRN",.4,0)
.4
"BLD",6249,"KRN",.401,0)
.401
"BLD",6249,"KRN",.402,0)
.402
"BLD",6249,"KRN",.403,0)
.403
"BLD",6249,"KRN",.5,0)
.5
"BLD",6249,"KRN",.84,0)
.84
"BLD",6249,"KRN",3.6,0)
3.6
"BLD",6249,"KRN",3.8,0)
3.8
"BLD",6249,"KRN",9.2,0)
9.2
"BLD",6249,"KRN",9.8,0)
9.8
"BLD",6249,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6249,"KRN",9.8,"NM",1,0)
FHOMRE1^^0^B22216792
"BLD",6249,"KRN",9.8,"NM",2,0)
FHDSSAPI^^0^B23023370
"BLD",6249,"KRN",9.8,"NM",3,0)
FHOMSR1^^0^B29187569
"BLD",6249,"KRN",9.8,"NM","B","FHDSSAPI",2)

"BLD",6249,"KRN",9.8,"NM","B","FHOMRE1",1)

"BLD",6249,"KRN",9.8,"NM","B","FHOMSR1",3)

"BLD",6249,"KRN",19,0)
19
"BLD",6249,"KRN",19,"NM",0)
^9.68A^^
"BLD",6249,"KRN",19.1,0)
19.1
"BLD",6249,"KRN",101,0)
101
"BLD",6249,"KRN",409.61,0)
409.61
"BLD",6249,"KRN",771,0)
771
"BLD",6249,"KRN",870,0)
870
"BLD",6249,"KRN",8989.51,0)
8989.51
"BLD",6249,"KRN",8989.52,0)
8989.52
"BLD",6249,"KRN",8994,0)
8994
"BLD",6249,"KRN","B",.4,.4)

"BLD",6249,"KRN","B",.401,.401)

"BLD",6249,"KRN","B",.402,.402)

"BLD",6249,"KRN","B",.403,.403)

"BLD",6249,"KRN","B",.5,.5)

"BLD",6249,"KRN","B",.84,.84)

"BLD",6249,"KRN","B",3.6,3.6)

"BLD",6249,"KRN","B",3.8,3.8)

"BLD",6249,"KRN","B",9.2,9.2)

"BLD",6249,"KRN","B",9.8,9.8)

"BLD",6249,"KRN","B",19,19)

"BLD",6249,"KRN","B",19.1,19.1)

"BLD",6249,"KRN","B",101,101)

"BLD",6249,"KRN","B",409.61,409.61)

"BLD",6249,"KRN","B",771,771)

"BLD",6249,"KRN","B",870,870)

"BLD",6249,"KRN","B",8989.51,8989.51)

"BLD",6249,"KRN","B",8989.52,8989.52)

"BLD",6249,"KRN","B",8994,8994)

"BLD",6249,"QUES",0)
^9.62^^
"BLD",6249,"REQB",0)
^9.611^3^3
"BLD",6249,"REQB",1,0)
FH*5.5*2^1
"BLD",6249,"REQB",2,0)
FH*5.5*7^1
"BLD",6249,"REQB",3,0)
FH*5.5*5^1
"BLD",6249,"REQB","B","FH*5.5*2",1)

"BLD",6249,"REQB","B","FH*5.5*5",3)

"BLD",6249,"REQB","B","FH*5.5*7",2)

"MBREQ")
0
"PKG",29,-1)
1^1
"PKG",29,0)
DIETETICS^FH^Dietetics/Nutrition & Food Service System
"PKG",29,20,0)
^9.402P^^
"PKG",29,22,0)
^9.49I^1^1
"PKG",29,22,1,0)
5.5^3050202^3040621^4572
"PKG",29,22,1,"PAH",1,0)
11^3070222
"PKG",29,22,1,"PAH",1,1,0)
^^1^1^3070222
"PKG",29,22,1,"PAH",1,1,1,0)
BAGGED MEALS SETTING/VARIABLE CLEANUP
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","FHDSSAPI")
0^2^B23023370^B21032379
"RTN","FHDSSAPI",1,0)
FHDSSAPI ;Hines OIFO/RTK-DSS REQUESTED API's  ;3/08/06  10:15
"RTN","FHDSSAPI",2,0)
 ;;5.5;DIETETICS;**7,11**;Jan 28, 2005;Build 4
"RTN","FHDSSAPI",3,0)
 ;11/22/2006 KAM/BAY Remedy Call 168346 Add Variable Cleanup from *7
"RTN","FHDSSAPI",4,0)
 ;
"RTN","FHDSSAPI",5,0)
DATA(FHSDT,FHEDT) ;API for DSS extract of NFS data
"RTN","FHDSSAPI",6,0)
 ; INPUT: START DATE, END DATE
"RTN","FHDSSAPI",7,0)
 ; OUTPUT: ^TMP($J,"FH"
"RTN","FHDSSAPI",8,0)
 ; Get inpatient meals
"RTN","FHDSSAPI",9,0)
 I FHSDT>FHEDT W !!,"END DATE BEFORE START DATE!",! H 1 Q
"RTN","FHDSSAPI",10,0)
 K ^TMP($J,"FH") S FHEDT=FHEDT_.99
"RTN","FHDSSAPI",11,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT(FHDFN)) Q:FHDFN'>0  F FHADM=0:0 S FHADM=$O(^FHPT(FHDFN,"A",FHADM)) Q:FHADM'>0  F FHDATE=FHSDT:0 S FHDATE=$O(^FHPT(FHDFN,"A",FHADM,"AC",FHDATE)) Q:FHDATE'>0!(FHDATE>FHEDT)  D
"RTN","FHDSSAPI",12,0)
 .S FHDSEQ=$P($G(^FHPT(FHDFN,"A",FHADM,"AC",FHDATE,0)),U,2)
"RTN","FHDSSAPI",13,0)
 .S FHNODE=$G(^FHPT(FHDFN,"A",FHADM,"DI",FHDSEQ,0))
"RTN","FHDSSAPI",14,0)
 .S ^TMP($J,"FH",FHDATE,FHDFN,FHADM,"INP")=FHNODE I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",15,0)
 ; Get additional feedings for inpatient
"RTN","FHDSSAPI",16,0)
 F FHDFN=0:0 S FHDFN=$O(^FHPT(FHDFN)) Q:FHDFN'>0  F FHADM=0:0 S FHADM=$O(^FHPT(FHDFN,"A",FHADM)) Q:'FHADM  D
"RTN","FHDSSAPI",17,0)
 .F FHEL=FHSDT:0 S FHEL=$O(^FHPT(FHDFN,"A",FHADM,"EL",FHEL)) Q:FHEL'>0!(FHEL>FHEDT)  D
"RTN","FHDSSAPI",18,0)
 ..S FHNODE=$G(^FHPT(FHDFN,"A",FHADM,"EL",FHEL,0))
"RTN","FHDSSAPI",19,0)
 ..S ^TMP($J,"FH",FHEL,FHDFN,FHADM,"EL")=FHNODE I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",20,0)
 .F FHSF=0:0 S FHSF=$O(^FHPT(FHDFN,"A",FHADM,"SF",FHSF)) Q:FHSF'>0  D
"RTN","FHDSSAPI",21,0)
 ..S FHNODE=$G(^FHPT(FHDFN,"A",FHADM,"SF",FHSF,0)),FHSFDT=$P(FHNODE,U,2)
"RTN","FHDSSAPI",22,0)
 ..I FHSFDT<FHSDT!(FHSFDT>FHEDT) Q
"RTN","FHDSSAPI",23,0)
 ..S ^TMP($J,"FH",FHSFDT,FHDFN,FHADM,"SF")=FHNODE I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",24,0)
 .F FHSO=0:0 S FHSO=$O(^FHPT(FHDFN,"A",FHADM,"SP",FHSO)) Q:FHSO'>0  D
"RTN","FHDSSAPI",25,0)
 ..S FHNODE=$G(^FHPT(FHDFN,"A",FHADM,"SP",FHSO,0)),FHSODT=$P(FHNODE,U,4)
"RTN","FHDSSAPI",26,0)
 ..I FHSODT<FHSDT!(FHSODT>FHEDT) Q
"RTN","FHDSSAPI",27,0)
 ..S ^TMP($J,"FH",FHSODT,FHDFN,FHADM,"SO")=FHNODE I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",28,0)
 .F FHTF=0:0 S FHTF=$O(^FHPT(FHDFN,"A",FHADM,"TF",FHTF)) Q:FHTF'>0  D
"RTN","FHDSSAPI",29,0)
 ..S FHNODE=$G(^FHPT(FHDFN,"A",FHADM,"TF",FHTF,0)),FHTFDT=$P(FHNODE,U,1)
"RTN","FHDSSAPI",30,0)
 ..I FHTFDT<FHSDT!(FHTFDT>FHEDT) Q
"RTN","FHDSSAPI",31,0)
 ..S ^TMP($J,"FH",FHTFDT,FHDFN,FHADM,"TF")=FHNODE I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",32,0)
 ..F FHTFPR=0:0 S FHTFPR=$O(^FHPT(FHDFN,"A",FHADM,"TF",FHTF,"P",FHTFPR)) Q:FHTFPR'>0  D
"RTN","FHDSSAPI",33,0)
 ...S FHNODE=$G(^FHPT(FHDFN,"A",FHADM,"TF",FHTF,"P",FHTFPR,0))
"RTN","FHDSSAPI",34,0)
 ...S ^TMP($J,"FH",FHTFDT,FHDFN,FHADM,"TF",FHTFPR,"P")=FHNODE I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",35,0)
 ..Q
"RTN","FHDSSAPI",36,0)
 .Q
"RTN","FHDSSAPI",37,0)
 ; Get outpatient meals
"RTN","FHDSSAPI",38,0)
 S X1=FHSDT,X2=-1 D C^%DTC S FHSDTX1=X_.99
"RTN","FHDSSAPI",39,0)
 ; Get recurring meals
"RTN","FHDSSAPI",40,0)
 F FHOMDT=FHSDTX1:0 S FHOMDT=$O(^FHPT("RM",FHOMDT)) Q:FHOMDT=""!(FHOMDT'<FHEDT)  D
"RTN","FHDSSAPI",41,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHOMDT,FHDFN)) Q:FHDFN=""  D
"RTN","FHDSSAPI",42,0)
 ..F FHRNUM=0:0 S FHRNUM=$O(^FHPT("RM",FHOMDT,FHDFN,FHRNUM)) Q:FHRNUM=""  D
"RTN","FHDSSAPI",43,0)
 ...S FHNODE=$G(^FHPT(FHDFN,"OP",FHRNUM,0)) I $P(FHNODE,U,15)="C" Q
"RTN","FHDSSAPI",44,0)
 ...I $P($G(^FHPT(FHDFN,0)),U,3)="" Q
"RTN","FHDSSAPI",45,0)
 ...S ^TMP($J,"FH",FHOMDT,FHDFN,FHRNUM,"RM")=FHNODE I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",46,0)
 ...;
"RTN","FHDSSAPI",47,0)
 ...; SHOULD LET DSS KNOW DIETS COULD BE IN FIELDS DIET1-5 IF NONVA LOC
"RTN","FHDSSAPI",48,0)
 ...;
"RTN","FHDSSAPI",49,0)
 ...I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) D
"RTN","FHDSSAPI",50,0)
 ....S FHNODE2=$G(^FHPT(FHDFN,"OP",FHRNUM,2)) I $P(FHNODE2,U,6)="C" Q
"RTN","FHDSSAPI",51,0)
 ....I $P($G(^FHPT(FHDFN,0)),U,3)="" Q
"RTN","FHDSSAPI",52,0)
 ....S ^TMP($J,"FH",FHOMDT,FHDFN,FHRNUM,"RMEL")=FHNODE2 I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",53,0)
 ...I $D(^FHPT(FHDFN,"OP",FHRNUM,3)) D
"RTN","FHDSSAPI",54,0)
 ....S FHNODE3=$G(^FHPT(FHDFN,"OP",FHRNUM,3)) I $P(FHNODE3,U,5)="C" Q
"RTN","FHDSSAPI",55,0)
 ....I $P($G(^FHPT(FHDFN,0)),U,3)="" Q
"RTN","FHDSSAPI",56,0)
 ....S ^TMP($J,"FH",FHOMDT,FHDFN,FHRNUM,"RMTF")=FHNODE3 I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",57,0)
 ....F FHZ=0:0 S FHZ=$O(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHZ)) Q:FHZ'>0  D
"RTN","FHDSSAPI",58,0)
 .....S FHTUZN=$G(^FHPT(FHDFN,"OP",FHRNUM,"TF",FHZ,0))
"RTN","FHDSSAPI",59,0)
 .....S ^TMP($J,"FH",FHOMDT,FHDFN,FHRNUM,"RMTF",FHZ)=FHTUZN I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",60,0)
 ; Get special meals
"RTN","FHDSSAPI",61,0)
 F FHOMDT=FHSDTX1:0 S FHOMDT=$O(^FHPT("SM",FHOMDT)) Q:FHOMDT=""!(FHOMDT'<FHEDT)  D
"RTN","FHDSSAPI",62,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("SM",FHOMDT,FHDFN)) Q:FHDFN=""  D
"RTN","FHDSSAPI",63,0)
 ..S FHNODE=$G(^FHPT(FHDFN,"SM",FHOMDT,0)) I $P(FHNODE,U,2)'="A" Q
"RTN","FHDSSAPI",64,0)
 ..I $P($G(^FHPT(FHDFN,0)),U,3)="" Q
"RTN","FHDSSAPI",65,0)
 ..S ^TMP($J,"FH",FHOMDT,FHDFN,"SM")=FHNODE I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",66,0)
 ; Get guest meals
"RTN","FHDSSAPI",67,0)
 F FHOMDT=FHSDTX1:0 S FHOMDT=$O(^FHPT("GM",FHOMDT)) Q:FHOMDT=""!(FHOMDT'<FHEDT)  D
"RTN","FHDSSAPI",68,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHOMDT,FHDFN)) Q:FHDFN=""  D
"RTN","FHDSSAPI",69,0)
 ..S FHNODE=$G(^FHPT(FHDFN,"GM",FHOMDT,0)) I $P(FHNODE,U,9)="C" Q
"RTN","FHDSSAPI",70,0)
 ..I $P($G(^FHPT(FHDFN,0)),U,3)="" Q
"RTN","FHDSSAPI",71,0)
 ..S ^TMP($J,"FH",FHOMDT,FHDFN,"GM")=FHNODE I '$D(^TMP($J,"FH","ZN",FHDFN)) S ^TMP($J,"FH","ZN",FHDFN)=^FHPT(FHDFN,0)
"RTN","FHDSSAPI",72,0)
 K FHADM,FHDATE,FHDFN,FHDSEQ,FHEL,FHNODE,FHNODE2,FHNODE3,FHOMDT,FHRNUM
"RTN","FHDSSAPI",73,0)
 K FHSDTX1,FHSF,FHSFDT,FHSO,FHSODT,FHTF,FHTFDT,FHTFPR,FHTUZN,FHZ,X,X1,X2
"RTN","FHDSSAPI",74,0)
 Q
"RTN","FHOMRE1")
0^1^B22216792^B21010791
"RTN","FHOMRE1",1,0)
FHOMRE1 ;Hines OIFO/RTK-OUTPATIENT MEALS EARLY/LATE TRAY  ;5/20/03  08:35
"RTN","FHOMRE1",2,0)
 ;;5.5;DIETETICS;**2,11**;Jan 28, 2005;Build 4
"RTN","FHOMRE1",3,0)
 ;
"RTN","FHOMRE1",4,0)
 ;09/08/2006 KAM/BAY Remedy Call 149576 - Add check for provide bagged meal
"RTN","FHOMRE1",5,0)
 ;
"RTN","FHOMRE1",6,0)
 S FHMSG1="E" D EN1,END Q
"RTN","FHOMRE1",7,0)
EN1 D GETOPT^FHOMUTL I FHFIND=0 Q
"RTN","FHOMRE1",8,0)
 K NUM D DISP^FHOMRR1 I $G(NUM)="" Q
"RTN","FHOMRE1",9,0)
EL1 K DIR S DIR(0)="NAO^1:"_NUM,DIR("A")="Early/Late Tray For Which Order? "
"RTN","FHOMRE1",10,0)
 D ^DIR Q:$D(DIRUT)
"RTN","FHOMRE1",11,0)
 S FHRMSEL=Y,FHC=FHRMSEL,FHRNUM=$P(FHLIST(FHRMSEL),U,1)
"RTN","FHOMRE1",12,0)
 S FHRMDT=$P(FHLIST(FHRMSEL),U,2),Y=FHRMDT D DD^%DT W !,Y,!
"RTN","FHOMRE1",13,0)
 I $P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)="C" W !!?3,"The selected order has been cancelled!",! D EL1 Q
"RTN","FHOMRE1",14,0)
 I $D(^FHPT(FHDFN,"OP",FHRNUM,2)) W !,"Early/Late Tray already exists for this meal." K DIR S DIR(0)="YA",DIR("A")="Do you wish to overwrite? ",DIR("B")="N" D ^DIR Q:$D(DIRUT)  Q:Y'=1
"RTN","FHOMRE1",15,0)
 ; Only allow selection of one order at a time, rather than a range
"RTN","FHOMRE1",16,0)
 ; because they could be different meals which could have different
"RTN","FHOMRE1",17,0)
 ; allowable meal window times.
"RTN","FHOMRE1",18,0)
 K DIR S DIR(0)="SAO^E:EARLY;L:LATE",DIR("A")="Early or Late (E or L)? "
"RTN","FHOMRE1",19,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRE1",20,0)
 S FHEL=Y
"RTN","FHOMRE1",21,0)
ORD S FHLOC=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,3),FHORN="",FHMSG1="E"
"RTN","FHOMRE1",22,0)
 S FHDIET=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,2)
"RTN","FHOMRE1",23,0)
 S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8),FHCOMM1=$G(^FH(119.73,FHCOMM,1))
"RTN","FHOMRE1",24,0)
 S FHMEAL=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,4)
"RTN","FHOMRE1",25,0)
 S FH1=$S(FHMEAL="B":1,FHMEAL="N":7,1:13) I FHEL="L" S FH1=FH1+3
"RTN","FHOMRE1",26,0)
TIME S FH3=FH1+2,FHCNT=0 F FHT=FH1:1:FH3 D
"RTN","FHOMRE1",27,0)
 .I $P(FHCOMM1,U,FHT)="" Q
"RTN","FHOMRE1",28,0)
 .S FHCNT=FHCNT+1,FHTM(FHCNT)=$P(FHCOMM1,U,FHT)
"RTN","FHOMRE1",29,0)
 W !,"Select Time: ( " F J=1:1:FHCNT W J,"=",FHTM(J)," "
"RTN","FHOMRE1",30,0)
 R ") ",FHS:DTIME I FHS=""!(FHS["^") D EXMSG^FHOMUTL Q
"RTN","FHOMRE1",31,0)
 I (FHS'?1N)!(FHS<1)!(FHS>FHCNT) W !!,"Invalid time selection!" D TIME Q
"RTN","FHOMRE1",32,0)
 S FHTIME=FHTM(FHS),X=FHRMDT_"@"_FHTIME,%DT="XT" D ^%DT S FHDTM=Y
"RTN","FHOMRE1",33,0)
 D NOW^%DTC I FHDTM<% W !!,"Cannot order for a Date/Time before now!" D TIME Q
"RTN","FHOMRE1",34,0)
 ;09/08/2006 KAM/BAY Rem Call 149576 Check file 119.73 PROVIDE BAGGED MEAL
"RTN","FHOMRE1",35,0)
 ;
"RTN","FHOMRE1",36,0)
 S FHBAG="N" I $P($G(^FH(119.73,FHCOMM,2)),U,10)="Y" D
"RTN","FHOMRE1",37,0)
 . K DIR S DIR(0)="SAO^Y:Yes;N:No",DIR("A")="Bagged Meal? ",DIR("B")="N"
"RTN","FHOMRE1",38,0)
 . D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMRE1",39,0)
 . S FHBAG=Y
"RTN","FHOMRE1",40,0)
 D SET,UPD100,OKMSG^FHOMUTL,END Q
"RTN","FHOMRE1",41,0)
 ;
"RTN","FHOMRE1",42,0)
SET S DA=FHRNUM,DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""OP"","
"RTN","FHOMRE1",43,0)
 S FHORN=$S($G(FHORN)="":"",1:FHORN)
"RTN","FHOMRE1",44,0)
 D NOW^%DTC S FHTODAY=$E(%,1,12)
"RTN","FHOMRE1",45,0)
 S DR="14////^S X=FHTIME;15////^S X=FHBAG;16////^S X=DUZ;17////^S X=FHTODAY;17.5////^S X=FHORN;17.6////^S X=""@""" D ^DIE
"RTN","FHOMRE1",46,0)
 S FHACT="O",FHOPTY="E",FHAET=FHTIME D SETAET^FHOMRO2
"RTN","FHOMRE1",47,0)
 Q
"RTN","FHOMRE1",48,0)
END K A,FHFIND,FHCLST,FHC,FHCOMM,FH1,FH3,FHTEXT,NUM
"RTN","FHOMRE1",49,0)
 K FHSEL,FHT,FHCNT,FHCOMM1,FHS Q
"RTN","FHOMRE1",50,0)
 Q
"RTN","FHOMRE1",51,0)
HL7SET ;
"RTN","FHOMRE1",52,0)
 ; Entry point for E/L trays placed from CPRS/OERR
"RTN","FHOMRE1",53,0)
 S (FHRFLG,FHSFLG)=0,FHMEAL=$E(FHSVCP,1),FILL=""
"RTN","FHOMRE1",54,0)
 S FHEL=$E(FHSVCP,2),FHTM=$E(FHSVCP,3)
"RTN","FHOMRE1",55,0)
 I FHEL'?1"E",FHEL'?1"L" S TXT="Missing E/L" D GETOR^FHWOR,ERR^FHOMWOR Q
"RTN","FHOMRE1",56,0)
 I FHTM<1!(FHTM>3) S TXT="Invalid time" D GETOR^FHWOR,ERR^FHOMWOR Q
"RTN","FHOMRE1",57,0)
 S FHRMDT=STDT,ENDT=FHRMDT_.9999
"RTN","FHOMRE1",58,0)
 S FH1=$S(FHMEAL="B":1,FHMEAL="N":7,1:13) I FHEL="L" S FH1=FH1+3
"RTN","FHOMRE1",59,0)
 S FH1=FH1+FHTM-1
"RTN","FHOMRE1",60,0)
 S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8),FHCOMM1=$G(^FH(119.73,FHCOMM,1))
"RTN","FHOMRE1",61,0)
 S FHTIME=$P(FHCOMM1,U,FH1),X1=STDT,X2=-1 D C^%DTC S STDT1=X
"RTN","FHOMRE1",62,0)
RM ; Check recurring meals
"RTN","FHOMRE1",63,0)
 I '$D(^FHPT(FHDFN,"OP","B",FHRMDT)) D SM Q
"RTN","FHOMRE1",64,0)
 F FHRMDT=STDT1:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>ENDT)  F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  D
"RTN","FHOMRE1",65,0)
 .Q:$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,4)'=FHMEAL
"RTN","FHOMRE1",66,0)
 .Q:$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,15)="C"
"RTN","FHOMRE1",67,0)
 .S FHRNUM1=FHRNUM,FHRFLG=1 D SET Q
"RTN","FHOMRE1",68,0)
 S FILL="E;"_$G(FHRNUM1)
"RTN","FHOMRE1",69,0)
SM ; Check special meals
"RTN","FHOMRE1",70,0)
 F FHSMDT=STDT:0 S FHSMDT=$O(^FHPT(FHDFN,"SM",FHSMDT)) Q:FHSMDT'>0!(FHSMDT>ENDT)  D SETELSM
"RTN","FHOMRE1",71,0)
 ;
"RTN","FHOMRE1",72,0)
 I FHRFLG=0,FHSFLG=0 D REJECT Q
"RTN","FHOMRE1",73,0)
 I FILL="" D REJECT Q
"RTN","FHOMRE1",74,0)
 D SEND^FHWOR
"RTN","FHOMRE1",75,0)
 Q
"RTN","FHOMRE1",76,0)
SETELSM ; Set E/L for Special Meals
"RTN","FHOMRE1",77,0)
 Q:$P($G(^FHPT(FHDFN,"SM",FHSMDT,0)),U,9)'=FHMEAL
"RTN","FHOMRE1",78,0)
 S FHSFLG=1,DA=FHSMDT,DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMRE1",79,0)
 D NOW^%DTC S FHTODAY=$E(%,1,12)
"RTN","FHOMRE1",80,0)
 S FHORN=$S($G(FHORN)="":"",1:FHORN),FILL="G;"_FHSMDT
"RTN","FHOMRE1",81,0)
 S DR="8////^S X=FHTIME;9////^S X=FHBAG;10////^S X=DUZ;11////^S X=FHORN" D ^DIE
"RTN","FHOMRE1",82,0)
 S FHZN=$G(^FHPT(FHDFN,"SM",FHSMDT,0))
"RTN","FHOMRE1",83,0)
 S FHACT="O",FHOPTY="S",FHSTAT="",FHOPDT=FHTODAY D SETSM^FHOMRO2
"RTN","FHOMRE1",84,0)
 Q
"RTN","FHOMRE1",85,0)
REJECT ; Reject if no recurring or special meals found
"RTN","FHOMRE1",86,0)
 S TXT="No Recurring or Special Meal ordered for this date/meal"
"RTN","FHOMRE1",87,0)
 D GETOR^FHWOR,ERR^FHOMWOR Q
"RTN","FHOMRE1",88,0)
 Q
"RTN","FHOMRE1",89,0)
UPD100 ;Backdoor message to update file #100 with a new EL order
"RTN","FHOMRE1",90,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMRE1",91,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMRE1",92,0)
 S FILL="E;"_FHRNUM,FHODT=$$FMTHL7^XLFDT(FHRMDT)
"RTN","FHOMRE1",93,0)
 S FHOMELN=FHMEAL_FHEL_FHS,FHOBAG="" I FHBAG="Y" S FHOBAG="bagged"
"RTN","FHOMRE1",94,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"^"_FHODT_"||||||||"_FHTODAY
"RTN","FHOMRE1",95,0)
 S MSG(5)="ODT|"_$S(FHEL="E":"EARLY",1:"LATE")_"|^^^"_FHOMELN_"^^99FHD|"_FHOBAG
"RTN","FHOMRE1",96,0)
 D EVSEND^FHWOR
"RTN","FHOMRE1",97,0)
 Q
"RTN","FHOMSR1")
0^3^B29187569^B28707183
"RTN","FHOMSR1",1,0)
FHOMSR1 ;Hines OIFO/RTK SPECIAL MEALS REQUEST MEAL  ;4/02/03  15:05
"RTN","FHOMSR1",2,0)
 ;;5.5;DIETETICS;**2,5,11**;Jan 28, 2005;Build 4
"RTN","FHOMSR1",3,0)
 ;
"RTN","FHOMSR1",4,0)
 S (FHORN,FHDIET)="",FHKEY=0,FHMSG1="S"
"RTN","FHOMSR1",5,0)
 D ^FHOMDPA I FHDFN="" Q
"RTN","FHOMSR1",6,0)
 I '$D(^FHPT(FHDFN,0)) W !!,"UNKNOWN SELECTION !" Q
"RTN","FHOMSR1",7,0)
 D SMSTAT^FHOMUTL I FHSTAT="P" D MSG1 Q
"RTN","FHOMSR1",8,0)
 I $D(^XUSEC("FHAUTH",DUZ)) S FHKEY=1
"RTN","FHOMSR1",9,0)
LOC ;Prompt for outpatient location
"RTN","FHOMSR1",10,0)
 W ! D OUTLOC^FHOMUTL I FHLOC="" D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",11,0)
 W ! D RMBED^FHOMUTL
"RTN","FHOMSR1",12,0)
DIET ;Prompt for diet
"RTN","FHOMSR1",13,0)
 D DIETLST^FHOMUTL
"RTN","FHOMSR1",14,0)
 I FHDEF="" W !!,"NO DEFAULT OUTPATIENT DIET SET!!",! Q
"RTN","FHOMSR1",15,0)
 S FHDEF=$P($G(^FH(111,FHDEF,0)),U,1)
"RTN","FHOMSR1",16,0)
 K DIC S DIC="^FH(111,",DIC("A")="Select DIET NAME: ",DIC(0)="AEMQZ"
"RTN","FHOMSR1",17,0)
 S DIC("B")=FHDEF,DIC("S")="I $D(FHDIETS(+Y))" D ^DIC
"RTN","FHOMSR1",18,0)
 I $D(DUOUT) D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",19,0)
 I Y=-1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",20,0)
 S FHDIET=+Y
"RTN","FHOMSR1",21,0)
MEAL ;Prompt for meal
"RTN","FHOMSR1",22,0)
 K DIR,DIC S DIR("A")="Select Meal: "
"RTN","FHOMSR1",23,0)
 S DIR(0)="SAO^B:Breakfast;N:Noon;E:Evening"
"RTN","FHOMSR1",24,0)
 D ^DIR I $D(DIRUT) D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",25,0)
 I Y'=-1 S FHMEAL=Y
"RTN","FHOMSR1",26,0)
 D CHECKRM I FHRMYES=1 D MSG2 Q
"RTN","FHOMSR1",27,0)
 W ! K DIR S DIR("A")="Is this correct?: ",DIR(0)="YA",DIR("B")="Y"
"RTN","FHOMSR1",28,0)
 D ^DIR
"RTN","FHOMSR1",29,0)
 S CONT=Y I CONT'=1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",30,0)
 D NOW^%DTC S FHNOW=%,STDT=DT,FHLTFLG=0 D SMGM^FHOMRO2
"RTN","FHOMSR1",31,0)
 I SKIP=1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",32,0)
 S FHQEL=1 I FHLTFLG=1 S FHSM=FHNOW,FHEL="L",FHQEL=0 D LATE I FHQEL=1 D EXMSG^FHOMUTL Q
"RTN","FHOMSR1",33,0)
 S FHSTAT=$S(FHKEY=1:"A",1:"P") D SETNODE,UPD100
"RTN","FHOMSR1",34,0)
 I FHQEL=0 D UPDE100
"RTN","FHOMSR1",35,0)
 D OKMSG^FHOMUTL
"RTN","FHOMSR1",36,0)
 I FHKEY=1 D PRINT
"RTN","FHOMSR1",37,0)
 I FHKEY=0 D ALERT
"RTN","FHOMSR1",38,0)
 D END Q
"RTN","FHOMSR1",39,0)
PRINT ;If user has key allow printing without sending alert to authorizor(s)
"RTN","FHOMSR1",40,0)
 W ! S DIR(0)="YA",DIR("B")="Y",DIR("A")="Print Voucher? " D ^DIR
"RTN","FHOMSR1",41,0)
 Q:$D(DIRUT)  S PRINT=Y I PRINT'=1 Q
"RTN","FHOMSR1",42,0)
 S FHCDT=FHDFN_"^"_FHNOW,FHREQPR=1 D DEV^FHOMSP1 K FHREQPR Q
"RTN","FHOMSR1",43,0)
ALERT ;Send alert to 15 Authorizors set up in file #119.9 (fields 9-13,40-49)
"RTN","FHOMSR1",44,0)
 K XQA,FHAU15 S FHAU15=$P($G(^FH(119.9,1,0)),U,7,11)_"^"_$P($G(^FH(119.9,1,1)),U,11,20)
"RTN","FHOMSR1",45,0)
 F A=1:1:15 S AB=$P(FHAU15,U,A) I AB'="" S XQA(AB)=""
"RTN","FHOMSR1",46,0)
 I '$D(XQA) D
"RTN","FHOMSR1",47,0)
 .W !!?5,"NOTICE: No 'Authorizing Person(s)' defined in site "
"RTN","FHOMSR1",48,0)
 .W !!?5,"parameter (#119.9) file -- NO ALERT SENT",!! Q
"RTN","FHOMSR1",49,0)
 D PATNAME^FHOMUTL
"RTN","FHOMSR1",50,0)
 S XQAMSG=$E(FHPTNM,1,9)_" ("_$E(FHPTNM,1,1)_$P(FHSSN,"-",3)_"): "
"RTN","FHOMSR1",51,0)
 S XQAMSG=XQAMSG_"Special Meal needs authorizing" D SETUP^XQALERT
"RTN","FHOMSR1",52,0)
 Q
"RTN","FHOMSR1",53,0)
SETNODE ;
"RTN","FHOMSR1",54,0)
 S AUDUZ=$S(FHSTAT="A":DUZ,1:""),AUFHNOW=$S(FHSTAT="A":FHNOW,1:"")
"RTN","FHOMSR1",55,0)
 S (FHSMID,Y)=FHNOW K DIC,DO S DA(1)=FHDFN,DIC="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMSR1",56,0)
 S DIC(0)="L",DIC("P")=$P(^DD(115,17,0),U,2),X=+Y,DINUM=X
"RTN","FHOMSR1",57,0)
 D FILE^DICN I Y=-1 Q
"RTN","FHOMSR1",58,0)
 K DIE S DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMSR1",59,0)
 S DA=+Y,FHDA=DA
"RTN","FHOMSR1",60,0)
 S DR="1////^S X=FHSTAT;2////^S X=FHLOC;2.5////^S X=FHRMBD;3////^S X=FHDIET;3.5////^S X=FHMEAL;4////^S X=DUZ;5////^S X=AUDUZ;6////^S X=AUFHNOW;14////^S X=FHORN"
"RTN","FHOMSR1",61,0)
 D ^DIE
"RTN","FHOMSR1",62,0)
 I FHQEL=0 D ORDEL
"RTN","FHOMSR1",63,0)
 S FHZN=$G(^FHPT(FHDFN,"SM",FHDA,0))
"RTN","FHOMSR1",64,0)
 S FHACT="O",FHOPTY="S",FHOPDT=$P(FHNOW,".",1) D SETSM^FHOMRO2
"RTN","FHOMSR1",65,0)
 Q
"RTN","FHOMSR1",66,0)
MSG1 ;
"RTN","FHOMSR1",67,0)
 W !!,"This patient already has a pending Special Meal request for "
"RTN","FHOMSR1",68,0)
 S DTP=DT D DTP^FH W DTP," " Q
"RTN","FHOMSR1",69,0)
MSG2 ;
"RTN","FHOMSR1",70,0)
 W !!,"This patient already has a Recurring Meal ordered for "
"RTN","FHOMSR1",71,0)
 S DTP=DT D DTP^FH W DTP," "
"RTN","FHOMSR1",72,0)
 W $S(FHMEAL="B":"Breakfast",FHMEAL="N":"Noon",1:"Evening") Q
"RTN","FHOMSR1",73,0)
CHECKRM ; Check if the OP has an existing RM for this date/meal
"RTN","FHOMSR1",74,0)
 S FHRMYES=0
"RTN","FHOMSR1",75,0)
 F FHZ=0:0 S FHZ=$O(^FHPT(FHDFN,"OP","B",DT,FHZ)) Q:FHZ'>0!(FHZ>DT)  D
"RTN","FHOMSR1",76,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHZ,0)),U,4)'=FHMEAL Q
"RTN","FHOMSR1",77,0)
 .I $P($G(^FHPT(FHDFN,"OP",FHZ,0)),U,15)="C" Q
"RTN","FHOMSR1",78,0)
 .S FHRMYES=1
"RTN","FHOMSR1",79,0)
 Q
"RTN","FHOMSR1",80,0)
END ;Kill local variables before exiting
"RTN","FHOMSR1",81,0)
 K A,AA,AB,BAG,CCC,CONT,DIC,DIR,ENDL,ENDT,FHDFN,FHDAYS,FHDEF
"RTN","FHOMSR1",82,0)
 K FHDIET,FHDIETS,FHSTAT,FHZ,STDT,STDTIM Q
"RTN","FHOMSR1",83,0)
 ;
"RTN","FHOMSR1",84,0)
LATE ;
"RTN","FHOMSR1",85,0)
 S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8),FHCOMM1=$G(^FH(119.73,FHCOMM,1))
"RTN","FHOMSR1",86,0)
 S FH1=$S(FHMEAL="B":1,FHMEAL="N":7,1:13) I FHEL="L" S FH1=FH1+3
"RTN","FHOMSR1",87,0)
TIME S FH3=FH1+2,FHCNT=0 F FHT=FH1:1:FH3 D
"RTN","FHOMSR1",88,0)
 .I $P(FHCOMM1,U,FHT)="" Q
"RTN","FHOMSR1",89,0)
 .S FHCNT=FHCNT+1,FHTM(FHCNT)=$P(FHCOMM1,U,FHT)
"RTN","FHOMSR1",90,0)
 W !,"Select Time: ( " F J=1:1:FHCNT W J,"=",FHTM(J)," "
"RTN","FHOMSR1",91,0)
 R ") ",FHS:DTIME I FHS=""!(FHS["^") S FHQEL=1 Q
"RTN","FHOMSR1",92,0)
 I (FHS'?1N)!(FHS<1)!(FHS>FHCNT) W !!,"Invalid time selection!" D TIME Q
"RTN","FHOMSR1",93,0)
 S FHTIME=FHTM(FHS),X=$E(FHNOW,1,7)_"@"_FHTIME,%DT="XT" D ^%DT S FHTRAY=Y
"RTN","FHOMSR1",94,0)
 D NOW^%DTC I FHTRAY<% W !!,"Cannot order for a time before now!" D TIME Q
"RTN","FHOMSR1",95,0)
 S FHBAG="N" I $P($G(^FH(119.73,FHCOMM,2)),U,10)="Y" D
"RTN","FHOMSR1",96,0)
 . K DIR S DIR(0)="SAO^Y:Yes;N:No",DIR("A")="Bagged Meal? ",DIR("B")="N"
"RTN","FHOMSR1",97,0)
 . D ^DIR I $D(DIRUT) S FHQEL=1 Q
"RTN","FHOMSR1",98,0)
 . S FHBAG=Y
"RTN","FHOMSR1",99,0)
 Q
"RTN","FHOMSR1",100,0)
ORDEL ;
"RTN","FHOMSR1",101,0)
 S DA=FHSM,DA(1)=FHDFN,DIE="^FHPT("_DA(1)_",""SM"","
"RTN","FHOMSR1",102,0)
 S DR="8////^S X=FHTIME;9////^S X=FHBAG;10////^S X=DUZ" D ^DIE
"RTN","FHOMSR1",103,0)
 Q
"RTN","FHOMSR1",104,0)
UPD100 ;Backdoor message to update file #100 with a new SM order
"RTN","FHOMSR1",105,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMSR1",106,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMSR1",107,0)
 S FILL="S;"_FHNOW
"RTN","FHOMSR1",108,0)
 S FHOMEAL=$S(FHMEAL="B":1,FHMEAL="N":3,FHMEAL="E":5,1:"")
"RTN","FHOMSR1",109,0)
 S FHDIETNM=$P($G(^FH(111,FHDIET,0)),U,1),FHODT=$$FMTHL7^XLFDT(FHNOW)
"RTN","FHOMSR1",110,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHODT_"^"_FHODT_"||||||||"_FHODT
"RTN","FHOMSR1",111,0)
 S MSG(5)="ODS|S|"_FHOMEAL_"|^^^"_FHDIET_"^"_FHDIETNM_"^99FHD|"
"RTN","FHOMSR1",112,0)
 D EVSEND^FHWOR
"RTN","FHOMSR1",113,0)
 Q
"RTN","FHOMSR1",114,0)
UPDE100 ;Backdoor message to update file #100 with a new SM Late Tray order
"RTN","FHOMSR1",115,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*215")  ;must have CPRSv26 for O.M. backdoor
"RTN","FHOMSR1",116,0)
 Q:'DFN  K MSG D MSHOM^FHOMUTL  ;Sets MSG(1), MSG(2) & MSG(3) for OM
"RTN","FHOMSR1",117,0)
 S FILL="G;"_FHNOW,FHODT=$$FMTHL7^XLFDT(FHNOW)
"RTN","FHOMSR1",118,0)
 S FHTRAY=$$FMTHL7^XLFDT(FHTRAY)
"RTN","FHOMSR1",119,0)
 S FHOMELN=FHMEAL_"L"_FHS,FHOBAG="" I FHBAG="Y" S FHOBAG="bagged"
"RTN","FHOMSR1",120,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_FHTRAY_"^"_FHTRAY_"||||||||"_FHODT
"RTN","FHOMSR1",121,0)
 S MSG(5)="ODT|LATE|^^^"_FHOMELN_"^^99FHD|"_FHOBAG
"RTN","FHOMSR1",122,0)
 D EVSEND^FHWOR
"RTN","FHOMSR1",123,0)
 Q
"VER")
8.0^22.0
"BLD",6249,6)
^8
**END**
**END**
