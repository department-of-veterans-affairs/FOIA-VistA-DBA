Released FH*5*38 SEQ #37
Extracted from mail message
**KIDS**:FH*5.0*38^

**INSTALL NAME**
FH*5.0*38
"BLD",4069,0)
FH*5.0*38^DIETETICS^0^3030408^y
"BLD",4069,1,0)
^^1^1^3021030^^
"BLD",4069,1,1,0)
Dietetics Patch 38.
"BLD",4069,4,0)
^9.64PA^115^2
"BLD",4069,4,115,0)
115
"BLD",4069,4,115,2,0)
^9.641^115.06^2
"BLD",4069,4,115,2,115.04,0)
TUBEFEEDING  (sub-file)
"BLD",4069,4,115,2,115.04,1,0)
^9.6411^4^1
"BLD",4069,4,115,2,115.04,1,4,0)
COMMENT
"BLD",4069,4,115,2,115.06,0)
ADDITIONAL ORDERS  (sub-file)
"BLD",4069,4,115,2,115.06,1,0)
^9.6411^2^1
"BLD",4069,4,115,2,115.06,1,2,0)
ORDER
"BLD",4069,4,115,222)
y^y^p^^^^n
"BLD",4069,4,119.9,0)
119.9
"BLD",4069,4,119.9,2,0)
^9.641^119.93^1
"BLD",4069,4,119.9,2,119.93,0)
LABEL PRINTERS  (sub-file)
"BLD",4069,4,119.9,2,119.93,1,0)
^9.6411^1^1
"BLD",4069,4,119.9,2,119.93,1,1,0)
SIZE OF LABELS
"BLD",4069,4,119.9,222)
y^y^p^^^^n
"BLD",4069,4,"APDD",115,115.04)

"BLD",4069,4,"APDD",115,115.04,4)

"BLD",4069,4,"APDD",115,115.06)

"BLD",4069,4,"APDD",115,115.06,2)

"BLD",4069,4,"APDD",119.9,119.93)

"BLD",4069,4,"APDD",119.9,119.93,1)

"BLD",4069,4,"B",115,115)

"BLD",4069,4,"B",119.9,119.9)

"BLD",4069,"ABPKG")
n
"BLD",4069,"KRN",0)
^9.67PA^8989.52^19
"BLD",4069,"KRN",.4,0)
.4
"BLD",4069,"KRN",.401,0)
.401
"BLD",4069,"KRN",.402,0)
.402
"BLD",4069,"KRN",.403,0)
.403
"BLD",4069,"KRN",.5,0)
.5
"BLD",4069,"KRN",.84,0)
.84
"BLD",4069,"KRN",3.6,0)
3.6
"BLD",4069,"KRN",3.8,0)
3.8
"BLD",4069,"KRN",9.2,0)
9.2
"BLD",4069,"KRN",9.8,0)
9.8
"BLD",4069,"KRN",9.8,"NM",0)
^9.68A^17^17
"BLD",4069,"KRN",9.8,"NM",1,0)
FHLABEL^^0^B7340274
"BLD",4069,"KRN",9.8,"NM",2,0)
FHMTK1B^^0^B19967139
"BLD",4069,"KRN",9.8,"NM",3,0)
FHNO2^^0^B20718863
"BLD",4069,"KRN",9.8,"NM",4,0)
FHNO21^^0^B13127490
"BLD",4069,"KRN",9.8,"NM",5,0)
FHNO41^^0^B12722667
"BLD",4069,"KRN",9.8,"NM",6,0)
FHORD13^^0^B12106638
"BLD",4069,"KRN",9.8,"NM",7,0)
FHORE21^^0^B15605657
"BLD",4069,"KRN",9.8,"NM",8,0)
FHORT5D^^0^B9657327
"BLD",4069,"KRN",9.8,"NM",9,0)
FHORX1B^^0^B6022842
"BLD",4069,"KRN",9.8,"NM",10,0)
FHSP1^^0^B23090543
"BLD",4069,"KRN",9.8,"NM",11,0)
FHSP11^^0^B5075383
"BLD",4069,"KRN",9.8,"NM",12,0)
FHORD1^^0^B20836105
"BLD",4069,"KRN",9.8,"NM",13,0)
FHORT1^^0^B15207888
"BLD",4069,"KRN",9.8,"NM",14,0)
FHORO^^0^B5420303
"BLD",4069,"KRN",9.8,"NM",15,0)
FHWOR2^^0^B19233195
"BLD",4069,"KRN",9.8,"NM",16,0)
FHWOR1^^0^B3354714
"BLD",4069,"KRN",9.8,"NM",17,0)
FHWOR51^^0^B8838321
"BLD",4069,"KRN",9.8,"NM","B","FHLABEL",1)

"BLD",4069,"KRN",9.8,"NM","B","FHMTK1B",2)

"BLD",4069,"KRN",9.8,"NM","B","FHNO2",3)

"BLD",4069,"KRN",9.8,"NM","B","FHNO21",4)

"BLD",4069,"KRN",9.8,"NM","B","FHNO41",5)

"BLD",4069,"KRN",9.8,"NM","B","FHORD1",12)

"BLD",4069,"KRN",9.8,"NM","B","FHORD13",6)

"BLD",4069,"KRN",9.8,"NM","B","FHORE21",7)

"BLD",4069,"KRN",9.8,"NM","B","FHORO",14)

"BLD",4069,"KRN",9.8,"NM","B","FHORT1",13)

"BLD",4069,"KRN",9.8,"NM","B","FHORT5D",8)

"BLD",4069,"KRN",9.8,"NM","B","FHORX1B",9)

"BLD",4069,"KRN",9.8,"NM","B","FHSP1",10)

"BLD",4069,"KRN",9.8,"NM","B","FHSP11",11)

"BLD",4069,"KRN",9.8,"NM","B","FHWOR1",16)

"BLD",4069,"KRN",9.8,"NM","B","FHWOR2",15)

"BLD",4069,"KRN",9.8,"NM","B","FHWOR51",17)

"BLD",4069,"KRN",19,0)
19
"BLD",4069,"KRN",19.1,0)
19.1
"BLD",4069,"KRN",101,0)
101
"BLD",4069,"KRN",409.61,0)
409.61
"BLD",4069,"KRN",771,0)
771
"BLD",4069,"KRN",870,0)
870
"BLD",4069,"KRN",8989.51,0)
8989.51
"BLD",4069,"KRN",8989.52,0)
8989.52
"BLD",4069,"KRN",8994,0)
8994
"BLD",4069,"KRN","B",.4,.4)

"BLD",4069,"KRN","B",.401,.401)

"BLD",4069,"KRN","B",.402,.402)

"BLD",4069,"KRN","B",.403,.403)

"BLD",4069,"KRN","B",.5,.5)

"BLD",4069,"KRN","B",.84,.84)

"BLD",4069,"KRN","B",3.6,3.6)

"BLD",4069,"KRN","B",3.8,3.8)

"BLD",4069,"KRN","B",9.2,9.2)

"BLD",4069,"KRN","B",9.8,9.8)

"BLD",4069,"KRN","B",19,19)

"BLD",4069,"KRN","B",19.1,19.1)

"BLD",4069,"KRN","B",101,101)

"BLD",4069,"KRN","B",409.61,409.61)

"BLD",4069,"KRN","B",771,771)

"BLD",4069,"KRN","B",870,870)

"BLD",4069,"KRN","B",8989.51,8989.51)

"BLD",4069,"KRN","B",8989.52,8989.52)

"BLD",4069,"KRN","B",8994,8994)

"BLD",4069,"QUES",0)
^9.62^^
"BLD",4069,"REQB",0)
^9.611^1^1
"BLD",4069,"REQB",1,0)
FH*5.0*37^1
"BLD",4069,"REQB","B","FH*5.0*37",1)

"FIA",115)
DIETETICS PATIENT
"FIA",115,0)
^FHPT(
"FIA",115,0,0)
115
"FIA",115,0,1)
y^y^p^^^^n
"FIA",115,0,10)

"FIA",115,0,11)

"FIA",115,0,"RLRO")

"FIA",115,0,"VR")
5.0^FH
"FIA",115,115)
1
"FIA",115,115.04)
1
"FIA",115,115.04,4)

"FIA",115,115.06)
1
"FIA",115,115.06,2)

"FIA",119.9)
FH SITE PARAMETERS
"FIA",119.9,0)
^FH(119.9,
"FIA",119.9,0,0)
119.9
"FIA",119.9,0,1)
y^y^p^^^^n
"FIA",119.9,0,10)

"FIA",119.9,0,11)

"FIA",119.9,0,"RLRO")

"FIA",119.9,0,"VR")
5.0^FH
"FIA",119.9,119.9)
1
"FIA",119.9,119.93)
1
"FIA",119.9,119.93,1)

"MBREQ")
0
"PKG",29,-1)
1^1
"PKG",29,0)
DIETETICS^FH^Dietetics System
"PKG",29,20,0)
^9.402P^^
"PKG",29,22,0)
^9.49I^1^1
"PKG",29,22,1,0)
5.0^2951011^2951130
"PKG",29,22,1,"PAH",1,0)
38^3030408
"PKG",29,22,1,"PAH",1,1,0)
^^1^1^3030408
"PKG",29,22,1,"PAH",1,1,1,0)
Dietetics Patch 38.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
17
"RTN","FHLABEL")
0^1^B7340274
"RTN","FHLABEL",1,0)
FHLABEL ; HISC/RTK - Laser label sheet build and display;9/27/02  9:25
"RTN","FHLABEL",2,0)
 ;;5.0;Dietetics;**38**;Mar 25, 1996
"RTN","FHLABEL",3,0)
LAB ;
"RTN","FHLABEL",4,0)
 S FHTAB=$S(LAB=3:24,1:37)
"RTN","FHLABEL",5,0)
 S BIDX1=BID_$E("          ",1,12-$L(BID))_X1,BXLN=$L(BIDX1)
"RTN","FHLABEL",6,0)
 S N1=$E(N1,1,FHTAB-$L(W1)),DTP=$E(DTP,1,9) I LAB=3 S Y=$E(Y,1,15)
"RTN","FHLABEL",7,0)
 S LNA=N1_$J(W1,FHTAB+1-$L(N1)),LNB=BIDX1_$J(R1,FHTAB+1-$L(BIDX1))
"RTN","FHLABEL",8,0)
 S LNC=Y_$J(DTP,FHTAB+1-$L(Y))
"RTN","FHLABEL",9,0)
 I LAB=3 S (PCL1,PCL5,PCL6)="",PCL2=LNA,PCL3=LNB,PCL4=LNC D LL3 Q
"RTN","FHLABEL",10,0)
 I LAB=4 S (PCL1,PCL2,PCL7,PCL8)="",PCL3=LNA,PCL4=LNB,PCL5=$E(Y,1,38),PCL6=DTP D LL4 Q
"RTN","FHLABEL",11,0)
 Q
"RTN","FHLABEL",12,0)
LL3 ;LASER LABEL PRINT - AVERY 5160
"RTN","FHLABEL",13,0)
 S COUNT=COUNT+1 I COUNT>1,COUNT#3=1 S LINE=LINE+6
"RTN","FHLABEL",14,0)
 S ^TMP($J,"DL3",LINE)=$G(^TMP($J,"DL3",LINE))_PCL1_U
"RTN","FHLABEL",15,0)
 S ^TMP($J,"DL3",LINE+1)=$G(^TMP($J,"DL3",LINE+1))_PCL2_U
"RTN","FHLABEL",16,0)
 S ^TMP($J,"DL3",LINE+2)=$G(^TMP($J,"DL3",LINE+2))_PCL3_U
"RTN","FHLABEL",17,0)
 S ^TMP($J,"DL3",LINE+3)=$G(^TMP($J,"DL3",LINE+3))_PCL4_U
"RTN","FHLABEL",18,0)
 S ^TMP($J,"DL3",LINE+4)=$G(^TMP($J,"DL3",LINE+4))_PCL5_U
"RTN","FHLABEL",19,0)
 S ^TMP($J,"DL3",LINE+5)=$G(^TMP($J,"DL3",LINE+5))_PCL6_U
"RTN","FHLABEL",20,0)
 Q
"RTN","FHLABEL",21,0)
LL4 ;LASER LABEL PRINT - AVERY 5162
"RTN","FHLABEL",22,0)
 S COUNT=COUNT+1 I COUNT>1,COUNT#2=1 S LINE=LINE+8
"RTN","FHLABEL",23,0)
 S ^TMP($J,"DL4",LINE)=$G(^TMP($J,"DL4",LINE))_PCL1_U
"RTN","FHLABEL",24,0)
 S ^TMP($J,"DL4",LINE+1)=$G(^TMP($J,"DL4",LINE+1))_PCL2_U
"RTN","FHLABEL",25,0)
 S ^TMP($J,"DL4",LINE+2)=$G(^TMP($J,"DL4",LINE+2))_PCL3_U
"RTN","FHLABEL",26,0)
 S ^TMP($J,"DL4",LINE+3)=$G(^TMP($J,"DL4",LINE+3))_PCL4_U
"RTN","FHLABEL",27,0)
 S ^TMP($J,"DL4",LINE+4)=$G(^TMP($J,"DL4",LINE+4))_PCL5_U
"RTN","FHLABEL",28,0)
 S ^TMP($J,"DL4",LINE+5)=$G(^TMP($J,"DL4",LINE+5))_PCL6_U
"RTN","FHLABEL",29,0)
 S ^TMP($J,"DL4",LINE+6)=$G(^TMP($J,"DL4",LINE+6))_PCL7_U
"RTN","FHLABEL",30,0)
 S ^TMP($J,"DL4",LINE+7)=$G(^TMP($J,"DL4",LINE+7))_PCL8_U
"RTN","FHLABEL",31,0)
 Q
"RTN","FHLABEL",32,0)
DPLL ;
"RTN","FHLABEL",33,0)
 I LAB=3 D DPLL3 Q
"RTN","FHLABEL",34,0)
 I LAB=4 D DPLL4 Q
"RTN","FHLABEL",35,0)
 Q
"RTN","FHLABEL",36,0)
DPLL3 ;
"RTN","FHLABEL",37,0)
 S COUNT=0 W !! F FHLL=1:6 Q:'$D(^TMP($J,"DL3",FHLL))  D
"RTN","FHLABEL",38,0)
 .S COUNT=COUNT+1
"RTN","FHLABEL",39,0)
 .I COUNT=11 W @IOF,!! S COUNT=1
"RTN","FHLABEL",40,0)
 .S LINE1=^TMP($J,"DL3",FHLL),LINE2=^TMP($J,"DL3",FHLL+1)
"RTN","FHLABEL",41,0)
 .S LINE3=^TMP($J,"DL3",FHLL+2),LINE4=^TMP($J,"DL3",FHLL+3)
"RTN","FHLABEL",42,0)
 .S LINE5=^TMP($J,"DL3",FHLL+4),LINE6=^TMP($J,"DL3",FHLL+5)
"RTN","FHLABEL",43,0)
 .F L=LINE1,LINE2,LINE3,LINE4,LINE5,LINE6 D
"RTN","FHLABEL",44,0)
 ..W !,$P(L,U,1),?27,$P(L,U,2),?55,$P(L,U,3)
"RTN","FHLABEL",45,0)
 Q
"RTN","FHLABEL",46,0)
DPLL4 ;
"RTN","FHLABEL",47,0)
 S COUNT=0 W !!!! F FHLL=1:8 Q:'$D(^TMP($J,"DL4",FHLL))  D
"RTN","FHLABEL",48,0)
 .S COUNT=COUNT+1
"RTN","FHLABEL",49,0)
 .I COUNT=8 W @IOF,!!!! S COUNT=1
"RTN","FHLABEL",50,0)
 .S LINE1=^TMP($J,"DL4",FHLL),LINE2=^TMP($J,"DL4",FHLL+1)
"RTN","FHLABEL",51,0)
 .S LINE3=^TMP($J,"DL4",FHLL+2),LINE4=^TMP($J,"DL4",FHLL+3)
"RTN","FHLABEL",52,0)
 .S LINE5=^TMP($J,"DL4",FHLL+4),LINE6=^TMP($J,"DL4",FHLL+5)
"RTN","FHLABEL",53,0)
 .S LINE7=^TMP($J,"DL4",FHLL+6),LINE8=^TMP($J,"DL4",FHLL+7)
"RTN","FHLABEL",54,0)
 .F L=LINE1,LINE2,LINE3,LINE4,LINE5,LINE6,LINE7,LINE8 D
"RTN","FHLABEL",55,0)
 ..W !,$P(L,U,1),?42,$P(L,U,2)
"RTN","FHLABEL",56,0)
 Q
"RTN","FHMTK1B")
0^2^B19967139
"RTN","FHMTK1B",1,0)
FHMTK1B ; HISC/NCA - Tray Ticket Utilities ;2/23/00  09:53
"RTN","FHMTK1B",2,0)
 ;;5.0;Dietetics;**2,25,34,38**;Oct 11, 1995
"RTN","FHMTK1B",3,0)
Q1 ; Store Service Point, Bread/Beverage default, Food Preference,
"RTN","FHMTK1B",4,0)
 ; and Recipes of meal
"RTN","FHMTK1B",5,0)
 S LN=$S(IOST?1"C".E:IOSL-2,1:IOSL-6),SL=40 F SP=0:0 S SP=$O(^FH(119.72,SP)) Q:SP<1  S Z=$G(^(SP,0)),^TMP($J,"SRP",SP)=$P(Z,"^",1,4)
"RTN","FHMTK1B",6,0)
 I MEAL'="A" S M1=MEAL D GET Q
"RTN","FHMTK1B",7,0)
 F M1="B","N","E" S FHX1=$P(FHDA,"^",$F("BNE",M1)) D GET
"RTN","FHMTK1B",8,0)
 Q
"RTN","FHMTK1B",9,0)
GET S LS(M1)=40 F LL=0:0 S LL=$O(^FH(115.2,LL)) Q:LL<1  S L2=$G(^(LL,0)) D
"RTN","FHMTK1B",10,0)
 .I $P(L2,"^",2)="D" D  Q
"RTN","FHMTK1B",11,0)
 ..F KK=0:0 S KK=$O(^FH(115.2,LL,"X",KK)) Q:KK<1  S REC=$P($G(^(KK,0)),"^",1),^TMP($J,"X",M1,LL,KK)=+REC
"RTN","FHMTK1B",12,0)
 ..Q
"RTN","FHMTK1B",13,0)
 .S REC=$P(L2,"^",4) Q:'REC  S Y=$G(^FH(114,+REC,0)),NAM=$P(Y,"^",1),K3=$P(Y,"^",7) I $P(L2,"^",5),$P(L2,"^",6)[M1 D
"RTN","FHMTK1B",14,0)
 ..S:'$D(^TMP($J,"FHDEF",M1,+REC)) ^TMP($J,"FHDEF",M1,+REC)=K3_"^"_+REC_"^"_NAM
"RTN","FHMTK1B",15,0)
 ..Q
"RTN","FHMTK1B",16,0)
 .Q
"RTN","FHMTK1B",17,0)
 F LL=0:0 S LL=$O(^TMP($J,"X",M1,LL)) Q:LL<1  F KK=0:0 S KK=$O(^TMP($J,"X",M1,LL,KK)) Q:KK<1  S X1=+$G(^(KK)),X2=$O(^FH(116.1,FHX1,"RE","B",X1,0)) I X2<1 K ^TMP($J,"X",M1,LL,KK)
"RTN","FHMTK1B",18,0)
 F P1=0:0 S P1=$O(^FH(116.1,FHX1,"RE",P1)) Q:P1<1  S L1=$G(^(P1,0)),Y=$G(^FH(114,+L1,0)),NAM=$P(Y,"^",1) D
"RTN","FHMTK1B",19,0)
 .F CAT=0:0 S CAT=$O(^FH(116.1,FHX1,"RE",P1,"R",CAT)) Q:CAT<1  S MCA=$G(^(CAT,0)) D
"RTN","FHMTK1B",20,0)
 ..S FHPD=$P(MCA,"^",2),K3=+MCA S:'K3 K3=$P(Y,"^",7)
"RTN","FHMTK1B",21,0)
 ..S CODE=$P($G(^FH(114.1,+K3,0)),"^",2),ZZ1=CODE
"RTN","FHMTK1B",22,0)
 ..I $E(CODE,$L(CODE))="X" S K3=$O(^FH(114.1,"C",$E(CODE,1,$L(CODE)-1),0)) S:'K3 K3=$P(Y,"^",7)
"RTN","FHMTK1B",23,0)
 ..S K4=$P($G(^FH(114.1,+K3,0)),"^",3),K4=$S('K4:99,K4<10:"0"_K4,1:K4)
"RTN","FHMTK1B",24,0)
 ..F P2=1:1 S FHX2=$P(FHPD," ",P2) Q:FHX2=""  S PD=$P(FHX2,";",1),P4="~" I PD'="" D
"RTN","FHMTK1B",25,0)
 ...F SP=0:0 S SP=$O(^TMP($J,"SRP",SP)) Q:SP<1  S SRP=$G(^TMP($J,"SRP",SP)),Z1=$G(^FH(116.1,FHX1,"RE",P1,"D",SP,0)),Z1=$P(Z1,"^",2),Z1=$S(Z1="":1,1:Z1) D SRP^FHDCR1B
"RTN","FHMTK1B",26,0)
 ...D STOR Q
"RTN","FHMTK1B",27,0)
 ..Q
"RTN","FHMTK1B",28,0)
 .Q
"RTN","FHMTK1B",29,0)
 Q
"RTN","FHMTK1B",30,0)
STOR ; Store Alternate recipes and default recipes
"RTN","FHMTK1B",31,0)
 N CODE S DBX="",CODE=ZZ1 I $E(CODE,$L(CODE))?1"X" D
"RTN","FHMTK1B",32,0)
 .S CODE=$E(CODE,1,$L(CODE)-1),DBX="*** Omit ",LC=0
"RTN","FHMTK1B",33,0)
 .F NX=0:0 S NX=$O(^FH(114,+L1,"DBX",NX)) Q:NX<1  S Z3=^(NX,0),QTY=$S($P(Z3,"^",2):$P(Z3,"^",2),1:1),ZZ=QTY_" "_$P($G(^FH(114.1,+Z3,0)),"^",1)_", " D:$L(DBX)+$L(ZZ)>28 SET S DBX=DBX_ZZ
"RTN","FHMTK1B",34,0)
 .D SET Q
"RTN","FHMTK1B",35,0)
 I $E(CODE,$L(CODE))?1N,$E(CODE,$L(CODE))>1 S ^TMP($J,"ALT",M1,PD,CODE,+L1)=K4_"~"_K3_"~"_NAM_P4
"RTN","FHMTK1B",36,0)
 S ^TMP($J,M1,PD,K4_"~"_K3_"~"_NAM)=+L1_"^"_CODE_"^"_P4
"RTN","FHMTK1B",37,0)
 S:'$D(^TMP($J,"FHPO",NAM)) ^TMP($J,"FHPO",NAM)=K4_"~"_K3_"~"_NAM
"RTN","FHMTK1B",38,0)
 I $D(^TMP($J,"FHDEF",M1,+L1)) S ^TMP($J,"DEF",M1,PD,K3_"~"_NAM)=+L1_"~"_K3_"~"_NAM Q
"RTN","FHMTK1B",39,0)
 Q
"RTN","FHMTK1B",40,0)
SET I $L(DBX)>9 S LC=LC+1,^TMP($J,"DBX",M1,PD,+L1,LC)=$E(DBX,1,$L(DBX)-2),DBX="*** Omit "
"RTN","FHMTK1B",41,0)
 Q
"RTN","FHMTK1B",42,0)
ALT ; Exchange dislike recipe with an alternate recipe
"RTN","FHMTK1B",43,0)
 S R1=$P($G(^TMP($J,MEAL,PD,X8)),"^",2),R2=R1 Q:R1=""
"RTN","FHMTK1B",44,0)
 F  S R2=$O(^TMP($J,"ALT",MEAL,PD,R2)) Q:R2=""!($E(R1,1,$L(R1)-1)'=$E(R2,1,$L(R2)-1))  D A1 Q:X6
"RTN","FHMTK1B",45,0)
 I 'X6 D
"RTN","FHMTK1B",46,0)
 .I $E(R1,1,$L(R1)-1)="E" S MSG="  ** NO ENTREE **",EVT="M^O^^No Entree" D ^FHORX Q
"RTN","FHMTK1B",47,0)
 .S MSG="  ** NO "_$P($G(^FH(114.1,Z1,0)),"^",1)_" - FP" Q
"RTN","FHMTK1B",48,0)
 Q
"RTN","FHMTK1B",49,0)
A1 S R3=0
"RTN","FHMTK1B",50,0)
A2 S R3=$O(^TMP($J,"ALT",MEAL,PD,R2,R3)) Q:R3<1
"RTN","FHMTK1B",51,0)
 S Z=$G(^TMP($J,"ALT",MEAL,PD,R2,R3)),P4="~"_$P(Z,"~",4,$L(Z,"~")) I $F(P4,"~"_SP_"~"),'$D(FP(R3)) S X6=R3 Q
"RTN","FHMTK1B",52,0)
 G A2
"RTN","FHMTK1B",53,0)
DECOD ; Decode code string
"RTN","FHMTK1B",54,0)
 S M1=$S(MEAL="B":1,MEAL="N":2,1:3),STR=$P(STR,";",M1)
"RTN","FHMTK1B",55,0)
 F X4=1:1 Q:$P(STR," ",X4,99)=""  D
"RTN","FHMTK1B",56,0)
 .S X1=$P(STR," ",X4),NAM=$P($G(^FH(114.1,+X1,0)),"^",1),$P(X1,",",2)=$S($P(X1,",",2)'="":$P(X1,",",2),1:1)
"RTN","FHMTK1B",57,0)
 .S MP(+X1)=$P(X1,",",2) Q
"RTN","FHMTK1B",58,0)
 Q
"RTN","FHMTK1B",59,0)
CHK ; Check for Patient dislike on meal
"RTN","FHMTK1B",60,0)
 F LL=0:0 S LL=$O(^TMP($J,"X",MEAL,LL)) Q:LL<1  F KK=0:0 S KK=$O(^TMP($J,"X",MEAL,LL,KK)) Q:KK<1  S X1=+$G(^TMP($J,"X",MEAL,LL,KK)) D
"RTN","FHMTK1B",61,0)
 .S X6=$O(^FHPT(DFN,"P","B",LL,0)) Q:X6<1
"RTN","FHMTK1B",62,0)
 .S X2=$G(^FHPT(DFN,"P",X6,0)) Q:$P(X2,"^",2)'[MEAL
"RTN","FHMTK1B",63,0)
 .S FP(X1)=""
"RTN","FHMTK1B",64,0)
 .Q
"RTN","FHMTK1B",65,0)
 Q
"RTN","FHMTK1B",66,0)
SO ; Store Standing Orders
"RTN","FHMTK1B",67,0)
 K ALPHA,SONAME S INDX=1 F K=0:0 S K=$O(^FHPT("ASP",DFN,ADM,K)) Q:K<1  D
"RTN","FHMTK1B",68,0)
 .S X=$G(^FHPT(DFN,"A",ADM,"SP",K,0)),Z=$P(X,"^",2)
"RTN","FHMTK1B",69,0)
 .S SONAME=$P($G(^FH(118.3,+Z,0)),U,1)
"RTN","FHMTK1B",70,0)
 .I $D(ALPHA(SONAME)) S SONAME=SONAME_INDX,INDX=INDX+1
"RTN","FHMTK1B",71,0)
 .S ALPHA(SONAME)=K_"^"_Z
"RTN","FHMTK1B",72,0)
 .Q
"RTN","FHMTK1B",73,0)
 S SONAME="" F  S SONAME=$O(ALPHA(SONAME)) Q:SONAME=""  D
"RTN","FHMTK1B",74,0)
 .S K=$P(ALPHA(SONAME),U,1)
"RTN","FHMTK1B",75,0)
 .S X=$G(^FHPT(DFN,"A",ADM,"SP",K,0)),Z=$P(X,U,2),M=$P(X,U,3) Q:'Z
"RTN","FHMTK1B",76,0)
 .I M[MEAL S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=$S($P(X,"^",8):$P(X,"^",8),1:1)_"    "_$P(^FH(118.3,+Z,0),"^",1) Q
"RTN","FHMTK1B",77,0)
 Q
"RTN","FHMTK1B",78,0)
BRK ; Break the line if allergies' length > 35 chars
"RTN","FHMTK1B",79,0)
 I J>2 S S(NBR)=S(NBR)+1,MM(S(NBR),NBR)=$S($L(ALG)<36:ALG,1:$J("",8)_"OTHERS") Q
"RTN","FHMTK1B",80,0)
 I $L(ALG)<36 S S(NBR)=S(NBR)+1,J=J+1,MM(S(NBR),NBR)=ALG Q
"RTN","FHMTK1B",81,0)
 F L=37:-1:8 Q:$E(ALG,L-1,L)=", "
"RTN","FHMTK1B",82,0)
 I L=8 S L=35 S S(NBR)=S(NBR)+1,J=J+1,MM(S(NBR),NBR)=$E(ALG,1,35)
"RTN","FHMTK1B",83,0)
 E  S S(NBR)=S(NBR)+1,J=J+1,MM(S(NBR),NBR)=$E(ALG,1,L-1)
"RTN","FHMTK1B",84,0)
 S ALG=$J("",8)_$E(ALG,L+1,999)
"RTN","FHMTK1B",85,0)
 G BRK
"RTN","FHNO2")
0^3^B20718863
"RTN","FHNO2",1,0)
FHNO2 ; HISC/REL/NCA - Supplemental Feeding Labels ;8/26/94  12:01 
"RTN","FHNO2",2,0)
 ;;5.0;Dietetics;**38**;Oct 11, 1995
"RTN","FHNO2",3,0)
D0 R !!,"Select by S=SUPPLEMENTAL FEEDING SITE or W=WARD: ",XX:DTIME G:'$T!("^"[XX) KIL I "sw"[XX S X=XX D TR^FH S XX=X
"RTN","FHNO2",4,0)
 I XX'?1U!("SW"'[XX) W *7," Enter S or W" G D0
"RTN","FHNO2",5,0)
 I XX="S" S D1=$O(^FH(119.74,0)) I D1'<1,$O(^FH(119.74,D1))<1 G D3
"RTN","FHNO2",6,0)
 I XX="W" S WRD=$O(^FH(119.6,0)) I WRD'<1,$O(^FH(119.6,WRD))<1 G D3
"RTN","FHNO2",7,0)
 I XX="S" G D2
"RTN","FHNO2",8,0)
D1 R !!,"Select WARD: ",X:DTIME G:'$T!("^"[X) KIL
"RTN","FHNO2",9,0)
 K DIC S DIC="^FH(119.6,",DIC(0)="EMQ" D ^DIC G:Y<1 D1 S W1=+Y
"RTN","FHNO2",10,0)
 S D1=$P($G(^FH(119.6,W1,0)),"^",9) G D3
"RTN","FHNO2",11,0)
D2 R !!,"Select SUPPLEMENTAL FEEDING SITE: ",X:DTIME G:'$T!("^"[X) KIL
"RTN","FHNO2",12,0)
 K DIC S DIC="^FH(119.74,",DIC(0)="EMQ" D ^DIC G:Y<1 D2 S D1=+Y,W1=0
"RTN","FHNO2",13,0)
D3 R !!,"Select Supplemental Feeding Time (10,2,8,ALL): ",TIM:DTIME G KIL:'$T!(U[TIM) I TIM="all" S X=TIM D TR^FH S TIM=X
"RTN","FHNO2",14,0)
 I TIM'=2,TIM'=8,TIM'=10,TIM'="ALL" W *7," Enter a time, 10,2,8, or ALL" G D3
"RTN","FHNO2",15,0)
D4 R !!,"Do you want Ingredient list only? N// ",D3:DTIME G:'$T!(D3="^") KIL S:D3="" D3="N" S X=D3 D TR^FH S D3=X I $P("YES",D3,1)'="",$P("NO",D3,1)'="" W *7,"  Answer YES or NO" G D4
"RTN","FHNO2",16,0)
 S D3=$E(D3,1),D3=D3="Y" G:'D3 D6
"RTN","FHNO2",17,0)
D5 R !!,"Consolidated List only? Y// ",X:DTIME G:'$T!(X="^") KIL S:X="" X="Y" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Answer YES or NO" G D5
"RTN","FHNO2",18,0)
 S X=$E(X,1) S:X="Y" D3=D3+1
"RTN","FHNO2",19,0)
D6 I 'D3,'D1,XX="W" W !!,"No Supplemental Feeding Site associated with this ward." G KIL
"RTN","FHNO2",20,0)
 W:'D3 !!,"Place Labels in Printer"
"RTN","FHNO2",21,0)
PR K IOP S %ZIS="MQ",%ZIS("A")="Select "_$S('D3:"LABEL",1:"LIST")_" Printer: " W ! D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHNO2",22,0)
 I $D(IO("Q")) S FHPGM="Q1^FHNO2",FHLST="XX^TIM^W1^D1^D3" D EN2^FH G KIL
"RTN","FHNO2",23,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHNO2",24,0)
Q1 ; Process Printing Supplemental Feeding Labels
"RTN","FHNO2",25,0)
 D NOW^%DTC S NOW=%,DT=%\1 G:D3=2 SUM
"RTN","FHNO2",26,0)
 I 'D3 Q:'D1  S FHPAR=$G(^FH(119.74,D1,0)),LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1
"RTN","FHNO2",27,0)
 S COUNT=0,LINE=1 I TIM="ALL" S TIM=10 D Q2 S TIM=2 D Q2 S TIM=8
"RTN","FHNO2",28,0)
 D Q2
"RTN","FHNO2",29,0)
 I $G(LAB)>2 D DPLL^FHLABEL,KIL Q
"RTN","FHNO2",30,0)
 I 'D3 F L=1:1:18 W !
"RTN","FHNO2",31,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHNO2",32,0)
Q2 K ^TMP($J,"L"),^TMP($J,"I"),^TMP($J,"SF"),C S P1=$S(TIM=10:5,TIM=2:13,1:21),T0=$P(DT,".",1)_"."_$S(TIM=10:1,TIM=2:14,1:2),P3=7,N1=0
"RTN","FHNO2",33,0)
 I XX="W" S P0=$P($G(^FH(119.6,W1,0)),"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0) D F0
"RTN","FHNO2",34,0)
 I XX="S" F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  S X=^(W1,0),D2=$P(X,"^",9) I D1=D2 S P0=$P(X,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0) D F0
"RTN","FHNO2",35,0)
 G ^FHNO21:'D3,PRT
"RTN","FHNO2",36,0)
F0 S WRDN=$P(^FH(119.6,W1,0),"^",1),DFN=0
"RTN","FHNO2",37,0)
F1 S DFN=$O(^FHPT("AW",W1,DFN)) Q:DFN=""  S ADM=^(DFN) G:ADM<1 F1
"RTN","FHNO2",38,0)
 G:'$D(^FHPT(DFN,"A",ADM,0)) F1 S X1=^(0),NO=$P(X1,"^",7) G:'NO F1
"RTN","FHNO2",39,0)
 I 'D3 S IS=$P(X1,"^",10) I IS S IS=$P($G(^FH(119.4,IS,0)),"^",3) S:IS'="N" IS=""
"RTN","FHNO2",40,0)
 D CHK G:'NO F1
"RTN","FHNO2",41,0)
 S Y=$G(^FHPT(DFN,"A",ADM,"SF",NO,0))
"RTN","FHNO2",42,0)
 S Y=$P(Y,"^",P1,P1+7) G:Y?."^" F1 D:D3 CALC
"RTN","FHNO2",43,0)
 I 'D3 D
"RTN","FHNO2",44,0)
 .S $P(Y,"^",9)=IS
"RTN","FHNO2",45,0)
 .S LNOD=$S(XX="S":D2_"~"_$P($G(^FH(119.74,D2,0)),"^",1),1:P0_"~"_WRDN)
"RTN","FHNO2",46,0)
 .S RI=$G(^DPT(DFN,.108)) S RE=$S(RI:$O(^FH(119.6,"AR",+RI,W1,0)),1:"")
"RTN","FHNO2",47,0)
 .S R0=$S(RE:$P($G(^FH(119.6,W1,"R",+RE,0)),"^",2),1:"")
"RTN","FHNO2",48,0)
 .S R0=$S(R0<1:99,R0<10:"0"_R0,1:R0)
"RTN","FHNO2",49,0)
 .S RM=$G(^DPT(DFN,.101)),PNOD=P0_"~"_R0_RM_"~"_DFN,WRD=P0_$E(WRDN,1,27-$L(RM))_"/"_RM
"RTN","FHNO2",50,0)
 .S ^TMP($J,"L",LNOD,PNOD)=Y_"^"_WRD Q
"RTN","FHNO2",51,0)
 G F1
"RTN","FHNO2",52,0)
CHK S FHORD=$P(X1,"^",2),X1=$P(X1,"^",3) G:FHORD<1 C1
"RTN","FHNO2",53,0)
 I X1>1,X1'>T0 G C2
"RTN","FHNO2",54,0)
C0 I '$D(^FHPT(DFN,"A",ADM,"DI",FHORD,0)) G C2
"RTN","FHNO2",55,0)
 S X1=$P(^FHPT(DFN,"A",ADM,"DI",FHORD,0),"^",7) I X1'="",X1'="X" S NO=""
"RTN","FHNO2",56,0)
C1 K FHORD,A1,K,X1 Q
"RTN","FHNO2",57,0)
C2 S A1=0 F K=0:0 S K=$O(^FHPT(DFN,"A",ADM,"AC",K)) Q:K<1!(K>T0)  S A1=K
"RTN","FHNO2",58,0)
 G:'A1 C1 S FHORD=$P(^FHPT(DFN,"A",ADM,"AC",A1,0),"^",2) G:FHORD'<1 C0 K ^FHPT(DFN,"A",ADM,"AC",A1) G C2
"RTN","FHNO2",59,0)
SUM K C,^TMP($J,"SF") S P0=$S(TIM=2:13,TIM=8:21,1:5),P3=$S(TIM="ALL":23,1:7),N1=0
"RTN","FHNO2",60,0)
 I XX="W" S X=$G(^FH(119.6,W1,0)) D S0
"RTN","FHNO2",61,0)
 I XX="S" F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  S X=^(W1,0),D2=$P(X,"^",9) I D1=D2 D S0
"RTN","FHNO2",62,0)
 G PRT
"RTN","FHNO2",63,0)
S0 S WRDN=$P(^FH(119.6,W1,0),"^",1),DFN=0
"RTN","FHNO2",64,0)
S1 S DFN=$O(^FHPT("AW",W1,DFN)) Q:DFN=""  S ADM=^(DFN) G:ADM<1 S1
"RTN","FHNO2",65,0)
 G:'$D(^FHPT(DFN,"A",ADM,0)) S1 S X1=^(0),NO=$P(X1,"^",7) G:'NO S1
"RTN","FHNO2",66,0)
 S Y=$P(^FHPT(DFN,"A",ADM,"SF",NO,0),"^",P0,P0+P3) G:Y?."^" S1 D CALC
"RTN","FHNO2",67,0)
 G S1
"RTN","FHNO2",68,0)
PRT S DTP=DT D DTP^FH S DTE=DTP_" "_$S(TIM="ALL":"ALL",TIM=10:TIM_" AM",1:TIM_" PM")
"RTN","FHNO2",69,0)
 S Y=$S(XX="S":$P($G(^FH(119.74,D1,0)),"^",1),1:WRDN)
"RTN","FHNO2",70,0)
 W @IOF W:D3=2 !?5,"**** CONSOLIDATED ****" W !?3,"**** INGREDIENTS LIST ****",! W:D3=1 ! W ?(33-$L(Y)\2),Y,!?9,DTE,!!
"RTN","FHNO2",71,0)
 F L=0:0 S L=$O(^FH(118,L)) Q:L<1  S:$D(C(L)) ^TMP($J,"SF",$P($G(^FH(118,L,0)),"^",1),L)=""
"RTN","FHNO2",72,0)
 S A1="" F  S A1=$O(^TMP($J,"SF",A1)) Q:A1=""  F L=0:0 S L=$O(^TMP($J,"SF",A1,L)) Q:L<1  W !,$E(A1,1,26),?28,$J(C(L),5,0)
"RTN","FHNO2",73,0)
 W !!?4,"**** PATIENTS = ",N1," ****",! Q
"RTN","FHNO2",74,0)
CALC S N1=N1+1
"RTN","FHNO2",75,0)
 F L=1:2:P3 S Z=$P(Y,"^",L) I Z'="" S Q=$P(Y,"^",L+1) S:'Q Q=1 S:'$D(C(Z)) C(Z)=0 S C(Z)=C(Z)+Q
"RTN","FHNO2",76,0)
 Q
"RTN","FHNO21")
0^4^B13127490
"RTN","FHNO21",1,0)
FHNO21 ; HISC/REL/NCA - Print Feeding Labels ;8/26/94  12:01 
"RTN","FHNO21",2,0)
 ;;5.0;Dietetics;**38**;Oct 11, 1995
"RTN","FHNO21",3,0)
 S DTP=DT\1 D DTP^FH S DTE=DTP_" "_TIM_$S(TIM=10:"AM",1:"PM")
"RTN","FHNO21",4,0)
 S S1=$S(LAB=1:6,1:9),S2=LAB=2*5+33
"RTN","FHNO21",5,0)
 K N F L=0:0 S L=$O(^FH(118,L)) Q:L<1  S Y=^(L,0),N1=$P(Y,"^",1),^TMP($J,"I",$E(N1,1,26)_","_L)=L I '$D(^FH(118,L,"I")) S N(L)=$P(Y,"^",1,2)
"RTN","FHNO21",6,0)
 S LNOD="" F  S LNOD=$O(^TMP($J,"L",LNOD)) Q:LNOD=""  D P2
"RTN","FHNO21",7,0)
 Q
"RTN","FHNO21",8,0)
P2 S PNOD="",N1=0 K C F  S PNOD=$O(^TMP($J,"L",LNOD,PNOD)) Q:PNOD=""  S Y2=^(PNOD) D P3
"RTN","FHNO21",9,0)
 I LAB<3 D P5 Q
"RTN","FHNO21",10,0)
 Q
"RTN","FHNO21",11,0)
P3 S N1=N1+1
"RTN","FHNO21",12,0)
 S DFN=$P(PNOD,"~",3),WRD=$P(Y2,"^",10)
"RTN","FHNO21",13,0)
 S NAM=$P(^DPT(DFN,0),"^",1),IS=$P(Y2,"^",9) D PID^FHDPA
"RTN","FHNO21",14,0)
 I LAB>2 D LL Q
"RTN","FHNO21",15,0)
 I $P(FHPAR,"^",4)="Y" G P4
"RTN","FHNO21",16,0)
 W !,$E(NAM,1,S2-$L(WRD)),?(S2+2-$L(WRD)),$E(WRD,3,99),!?$S(LAB=1:3,1:0),BID W:IS'="" ?(S2-22),"*NURSE" W ?(S2-15),DTE S LN=2 I LAB=2 W !! S LN=4
"RTN","FHNO21",17,0)
 F L=1:2:7 S Z=$P(Y2,"^",L) I Z'="" D
"RTN","FHNO21",18,0)
 .S Q=$P(Y2,"^",L+1) S:'Q Q=1
"RTN","FHNO21",19,0)
 .W !,$J(Q,2)," "
"RTN","FHNO21",20,0)
 .W $S($D(N(Z)):$P(N(Z),"^",1),$D(^FH(118,+Z,0)):$P(^(0),"^",1),1:"")
"RTN","FHNO21",21,0)
 .S LN=LN+1 S:'$D(C(Z)) C(Z)=0 S C(Z)=C(Z)+Q
"RTN","FHNO21",22,0)
 .Q
"RTN","FHNO21",23,0)
 I LN<S1 F L=LN+1:1:S1 W !
"RTN","FHNO21",24,0)
 Q
"RTN","FHNO21",25,0)
P4 F L=1:2:7 S Z=$P(Y2,"^",L) I Z'="",$S($D(N(Z)):$P(N(Z),"^",2),$D(^FH(118,+Z,0)):$P(^(0),"^",2),1:"")'="N" D
"RTN","FHNO21",26,0)
 .S Q=$P(Y2,"^",L+1) S:'Q Q=1
"RTN","FHNO21",27,0)
 .W !,$E(NAM,1,S2-$L(WRD)),?(S2+2-$L(WRD)),$E(WRD,3,99),!,BID
"RTN","FHNO21",28,0)
 .W:IS'="" ?11,"*NURSE"
"RTN","FHNO21",29,0)
 .W ?(S2-15),DTE,!!,$J(Q,2)," "
"RTN","FHNO21",30,0)
 .W $S($D(N(Z)):$P(N(Z),"^",1),$D(^FH(118,+Z,0)):$P(^(0),"^",1),1:""),!!
"RTN","FHNO21",31,0)
 .W:LAB=2 !!!
"RTN","FHNO21",32,0)
 .S:'$D(C(Z)) C(Z)=0 S C(Z)=C(Z)+Q
"RTN","FHNO21",33,0)
 .Q
"RTN","FHNO21",34,0)
 Q
"RTN","FHNO21",35,0)
P5 S Y=$S(XX="S":$P($G(^FH(119.74,D1,0)),"^",1),1:$P($G(^FH(119.6,W1,0)),"^",1))
"RTN","FHNO21",36,0)
 W !?3,"**** INGREDIENTS LIST ****",!!?(33-$L(Y)\2),Y,!?9,DTE,!! S LN=6
"RTN","FHNO21",37,0)
 S A1="" F K=0:0 S A1=$O(^TMP($J,"I",A1)) Q:A1=""  S L=^(A1) I $D(C(L)),C(L) W !,$S($D(N(L)):$P(N(L),"^",1),$D(^FH(118,+L,0)):$P(^(0),"^",1),1:""),?28,$J(C(L),5,0) S LN=LN+1
"RTN","FHNO21",38,0)
P6 W !!?4,"**** PATIENTS = ",N1," ****",! S LN=LN+3
"RTN","FHNO21",39,0)
 S LN=LN#S1 I LN F L=LN+1:1:S1 W !
"RTN","FHNO21",40,0)
 Q
"RTN","FHNO21",41,0)
LL ;
"RTN","FHNO21",42,0)
 S FHTAB=$S(LAB=3:24,1:37)
"RTN","FHNO21",43,0)
 S NAM=$E(NAM,1,FHTAB-$L(WRD)),BIDIS=BID I IS="N" S BIDIS=BID_" *NURSE"
"RTN","FHNO21",44,0)
 S LNA=NAM_$J(WRD,FHTAB+1-$L(NAM)),LNB=BIDIS_$J(DTE,FHTAB+1-$L(BIDIS))
"RTN","FHNO21",45,0)
 I $P(FHPAR,"^",4)="Y" D LL2 Q
"RTN","FHNO21",46,0)
 S NUM=0 F XSF=1:2:7 I $P(Y2,U,XSF)'="" S NUM=NUM+1
"RTN","FHNO21",47,0)
 S INDX=0 F XSF=1:2:7 D
"RTN","FHNO21",48,0)
 .S SFPTR=$P(Y2,U,XSF) I SFPTR="" Q
"RTN","FHNO21",49,0)
 .S QTY=$P(Y2,U,XSF+1),SFNM=$P($G(^FH(118,SFPTR,0)),U,1)
"RTN","FHNO21",50,0)
 .S INDX=INDX+1,ZF(INDX)=$J(QTY,2)_" "_SFNM
"RTN","FHNO21",51,0)
 .Q
"RTN","FHNO21",52,0)
 I LAB=3 D
"RTN","FHNO21",53,0)
 .I NUM=1 S (PCL1,PCL2,PCL6)="",PCL3=LNA,PCL4=LNB,PCL5=ZF(1)
"RTN","FHNO21",54,0)
 .I NUM=2 S (PCL1,PCL6)="",PCL2=LNA,PCL3=LNB,PCL4=ZF(1),PCL5=ZF(2)
"RTN","FHNO21",55,0)
 .I NUM=3 S PCL1="",PCL2=LNA,PCL3=LNB,PCL4=ZF(1),PCL5=ZF(2),PCL6=ZF(3)
"RTN","FHNO21",56,0)
 .I NUM=4 S PCL1=LNA,PCL2=LNB,PCL3=ZF(1),PCL4=ZF(2),PCL5=ZF(3),PCL6=ZF(4)
"RTN","FHNO21",57,0)
 .D LL3^FHLABEL
"RTN","FHNO21",58,0)
 I LAB=4 D
"RTN","FHNO21",59,0)
 .I NUM=1 S (PCL1,PCL2,PCL3,PCL7,PCL8)="",PCL4=LNA,PCL5=LNB,PCL6=ZF(1)
"RTN","FHNO21",60,0)
 .I NUM=2 S (PCL1,PCL2,PCL7,PCL8)="",PCL3=LNA,PCL4=LNB,PCL5=ZF(1),PCL6=ZF(2)
"RTN","FHNO21",61,0)
 .I NUM=3 S (PCL1,PCL2,PCL8)="",PCL3=LNA,PCL4=LNB,PCL5=ZF(1),PCL6=ZF(2),PCL7=ZF(3)
"RTN","FHNO21",62,0)
 .I NUM=4 S (PCL1,PCL8)="",PCL2=LNA,PCL3=LNB,PCL4=ZF(1),PCL5=ZF(2),PCL6=ZF(3),PCL7=ZF(4)
"RTN","FHNO21",63,0)
 .D LL4^FHLABEL
"RTN","FHNO21",64,0)
 Q
"RTN","FHNO21",65,0)
LL2 ;
"RTN","FHNO21",66,0)
 F XSF=1:2:7 D
"RTN","FHNO21",67,0)
 .S SFPTR=$P(Y2,U,XSF) I SFPTR="" Q
"RTN","FHNO21",68,0)
 .S QTY=$P(Y2,U,XSF+1),SFNM=$P($G(^FH(118,SFPTR,0)),U,1)
"RTN","FHNO21",69,0)
 .S LNC=$J(QTY,2)_" "_SFNM
"RTN","FHNO21",70,0)
 .I LAB=3 S (PCL1,PCL4,PCL6)="",PCL2=LNA,PCL3=LNB,PCL5=LNC D LL3^FHLABEL
"RTN","FHNO21",71,0)
 .I LAB=4 S (PCL1,PCL2,PCL5,PCL7,PCL8)="",PCL3=LNA,PCL4=LNB,PCL6=LNC D LL4^FHLABEL
"RTN","FHNO21",72,0)
 Q
"RTN","FHNO41")
0^5^B12722667
"RTN","FHNO41",1,0)
FHNO41 ; HISC/REL - List Bulk Nourishments ;7/14/93  10:13
"RTN","FHNO41",2,0)
 ;;5.0;Dietetics;**38**;Oct 11, 1995
"RTN","FHNO41",3,0)
 S D1=$O(^FH(119.74,0)) I D1'<1,$O(^FH(119.74,D1))<1 G N3
"RTN","FHNO41",4,0)
N2 R !!,"Select SUPPLEMENTAL FEEDING SITE (or ALL): ",X:DTIME G:'$T!("^"[X) KIL I X="ALL" S D1=0 G N3
"RTN","FHNO41",5,0)
 K DIC S DIC="^FH(119.74,",DIC(0)="EMQ" D ^DIC G:Y<1 N2 S D1=+Y
"RTN","FHNO41",6,0)
N3 R !!,"Do you want Labels? N// ",X:DTIME G:'$T!(X["^") KIL S:X="" X="N" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Enter YES or NO" G N3
"RTN","FHNO41",7,0)
 S X=$E(X,1),LAB=X="Y"
"RTN","FHNO41",8,0)
 W ! K IOP,%ZIS S %ZIS("A")="Select "_$S(LAB:"LABEL",1:"LIST")_" Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHNO41",9,0)
 I $D(IO("Q")) S FHPGM="Q1^FHNO41",FHLST="D1^LAB" D EN2^FH G KIL
"RTN","FHNO41",10,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHNO41",11,0)
Q1 ; Process Printing Bulk Nourishments
"RTN","FHNO41",12,0)
 K ^TMP($J) D NOW^%DTC S DTP=% D DTP^FH
"RTN","FHNO41",13,0)
 I LAB S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1
"RTN","FHNO41",14,0)
 F K=0:0 S K=$O(^FH(119.6,K)) Q:K<1  S X=^(K,0),D2=$P(X,"^",9) I 'D1!(D1=D2),$O(^FH(119.6,K,"BN",0))>0 S P0=$P(X,"^",4) S:P0<1 P0=99 S ^TMP($J,P0,K)=""
"RTN","FHNO41",15,0)
 G:LAB L0
"RTN","FHNO41",16,0)
 S D3=$S('D1:"ALL SITES",1:$P(^FH(119.74,D1,0),"^",1)),PG=0 D HDR
"RTN","FHNO41",17,0)
 K D S C1=0 F P0=0:0 S P0=$O(^TMP($J,P0)) Q:P0<1  F K=0:0 S K=$O(^TMP($J,P0,K)) Q:K<1  D Q4
"RTN","FHNO41",18,0)
 D:$Y>(IOSL-8) HDR W !!?(45-$L(D3)\2),"***** ",D3," TOTAL *****"
"RTN","FHNO41",19,0)
 W !!,"   Qty  Item",?33,"Cost   Vehicle   Other   Total",!
"RTN","FHNO41",20,0)
 S (C(0),C(1))=0 F K=0:0 S K=$O(D(K)) Q:K<1  D:$Y>(IOSL-8) HDR S Y=^FH(118,K,0) D C3 S CT=$P(Y,"^",4)="Y",C(CT)=D(K)*C3+C(CT) W !,$J(D(K),6),"  ",$P(Y,"^",1),?31,$J(C3,6,2) W ?($S(CT:40,1:49)),$J(D(K)*C3,6,2),?57,$J(D(K)*C3,6,2)
"RTN","FHNO41",21,0)
 W !!?8,"Total",?39,$J(C(1),7,2),?48,$J(C(0),7,2),?56,$J(C(0)+C(1),7,2)
"RTN","FHNO41",22,0)
Q3 W ! Q
"RTN","FHNO41",23,0)
Q4 D:$Y>(IOSL-8) HDR W !!,"--- ",$P(^FH(119.6,K,0),"^",1)," ---",! S C1=C1+1
"RTN","FHNO41",24,0)
 F L=0:0 S L=$O(^FH(119.6,K,"BN",L)) Q:L<1  S X=^(L,0),X1=$P(X,"^",1),X2=$P(X,"^",2) I X1,$D(^FH(118,X1,0)) D:$Y>(IOSL-8) HDR W !,$J(X2,6),"  ",$P(^(0),"^",1) S:'$D(D(X1)) D(X1)=0 S D(X1)=D(X1)+X2
"RTN","FHNO41",25,0)
 Q
"RTN","FHNO41",26,0)
HDR ; Print Header
"RTN","FHNO41",27,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHNO41",28,0)
 S X="BULK NOURISHMENTS FOR: "_D3 W !?(80-$L(X)\2),X,?73,"Page ",PG,!!?32,DTP,! Q
"RTN","FHNO41",29,0)
L0 S S2=LAB=2*5+32,S1=$S(LAB=2:9,1:6),COUNT=0,LINE=1
"RTN","FHNO41",30,0)
 K D S C1=0
"RTN","FHNO41",31,0)
 F P0=0:0 S P0=$O(^TMP($J,P0)) Q:P0<1  F K=0:0 S K=$O(^TMP($J,P0,K)) Q:K<1  S WRD=$P(^FH(119.6,K,0),"^",1) F L=0:0 S L=$O(^FH(119.6,K,"BN",L)) Q:L<1  D L3
"RTN","FHNO41",32,0)
 I LAB>2 D DPLL^FHLABEL Q
"RTN","FHNO41",33,0)
 Q:'C1  S LN=6,X="BULK NOURISHMENTS PICK LIST" W !!?(S2-$L(X)\2),X
"RTN","FHNO41",34,0)
 S D3=$S('D1:"ALL SITES",1:$P(^FH(119.74,D1,0),"^",1)) W !!?(S2-$L(D3)\2),D3,!!
"RTN","FHNO41",35,0)
 F K=0:0 S K=$O(D(K)) Q:K<1  W !,$J(D(K),4),"  ",$P(^FH(118,K,0),"^",1) S LN=LN+1
"RTN","FHNO41",36,0)
 S LN=LN#S1 I LN F K=LN+1:1:S1 W !
"RTN","FHNO41",37,0)
 Q
"RTN","FHNO41",38,0)
L3 S X=^FH(119.6,K,"BN",L,0),X1=$P(X,"^",1),X2=$P(X,"^",2) Q:'X1!('$D(^FH(118,X1,0)))
"RTN","FHNO41",39,0)
 S:'$D(D(X1)) D(X1)=0 S D(X1)=D(X1)+X2,C1=C1+1
"RTN","FHNO41",40,0)
 S X1=^FH(118,X1,0),CHK=$P(X1,"^",2) Q:CHK="N"  S X1=$P(X1,"^",1)
"RTN","FHNO41",41,0)
 I LAB>2 D LL Q
"RTN","FHNO41",42,0)
 F C1=1:1:X2 W !!?(S2-$L(X1)\2),X1,!!,WRD,?(S2-$L(DTP)),DTP,!! W:LAB=2 !!!
"RTN","FHNO41",43,0)
 Q
"RTN","FHNO41",44,0)
C3 S C3=$P($G(^FH(114,+$P(Y,"^",7),0)),"^",13) Q
"RTN","FHNO41",45,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHNO41",46,0)
 Q
"RTN","FHNO41",47,0)
LL ;
"RTN","FHNO41",48,0)
 F C1=1:1:X2 D
"RTN","FHNO41",49,0)
 .S FHTAB=$S(LAB=3:24,1:37),SPC=$J(" ",70)
"RTN","FHNO41",50,0)
 .S LNA=$E(SPC,1,FHTAB-$L(X1)/2)_X1,LNB=WRD_$J(DTP,FHTAB+1-$L(WRD))
"RTN","FHNO41",51,0)
 .I LAB=3 S (PCL1,PCL2,PCL4,PCL6)="",PCL3=LNA,PCL5=LNB
"RTN","FHNO41",52,0)
 .I LAB=4 S (PCL1,PCL2,PCL3,PCL5,PCL7,PCL8)="",PCL4=LNA,PCL6=LNB
"RTN","FHNO41",53,0)
 .D:LAB=3 LL3^FHLABEL D:LAB=4 LL4^FHLABEL
"RTN","FHNO41",54,0)
 Q
"RTN","FHORD1")
0^12^B20836105
"RTN","FHORD1",1,0)
FHORD1 ; HISC/REL/NCA - Diet Order ;3/28/01  10:28
"RTN","FHORD1",2,0)
 ;;5.0;Dietetics;**6,15,27,37,38**;Oct 11, 1995
"RTN","FHORD1",3,0)
F0 S ALL=1 D ^FHDPA G:'DFN KIL
"RTN","FHORD1",4,0)
 I $G(ADM)="" W *7,!!," NOT CURRENTLY AN INPATIENT" D KIL Q
"RTN","FHORD1",5,0)
 D D0 G:'DFN KIL D PROC
"RTN","FHORD1",6,0)
 S DTE="" D ^FHORD1A I FHWF,DTE S (SDT,EDT)=DTE,WKD="",SERV="L" D EL^FHWOR3 D:$D(MSG) MSG^XQOR("FH EVSEND OR",.MSG) K MSG
"RTN","FHORD1",7,0)
 S TF=$P(^FHPT(DFN,"A",ADM,0),"^",4) I TF W !!,"An ACTIVE Tubefeeding Order Exists!" S FHD="Y" D DIS^FHORT2,ASK^FHORT2 D:FHD="Y" CAN^FHORT2
"RTN","FHORD1",8,0)
 G F0
"RTN","FHORD1",9,0)
D0 ; Process Diet Order
"RTN","FHORD1",10,0)
 D CUR^FHORD7 W !!,"Current Diet: ",$S(Y'="":Y,1:"No current order")
"RTN","FHORD1",11,0)
 I FHORD S COM=$G(^FHPT(DFN,"A",ADM,"DI",FHORD,1)) I COM'="" W !,"Comment: ",COM
"RTN","FHORD1",12,0)
 D NOW^%DTC S NOW=% K %,%H,%I D FUT
"RTN","FHORD1",13,0)
C0 I CT W *7 R !!,"A new order with no expiration date will CANCEL these diets.",!!,"Do you wish to CONTINUE? (Y/N): ",X:DTIME G:'$T!(X="^") AB S:X="" X="^" D TR^FH G:$P("NO",X,1)="" AB I $P("YES",X,1)'="" W *7,"  Answer YES or NO" G C0
"RTN","FHORD1",14,0)
F7 S WRD=$P($G(^FHPT(DFN,"A",ADM,0)),"^",8),SVC="" I WRD>0 S SVC=$P($G(^FH(119.6,WRD,0)),"^",10)
"RTN","FHORD1",15,0)
 S:SVC="" SVC="T" I $L(SVC)=1 S TYP=SVC G F8
"RTN","FHORD1",16,0)
 S N1=$P(^FHPT(DFN,"A",ADM,0),"^",5) S:SVC'[N1 N1=""
"RTN","FHORD1",17,0)
 S X="Tray^Cafeteria^Dining Room" W !!,$P(X,"^",$F("TCD",$E(SVC,1))-1),$S($L(SVC)=2:" or ",1:", "),$P(X,"^",$F("TCD",$E(SVC,2))-1)
"RTN","FHORD1",18,0)
 W:$L(SVC)=3 " or ",$P(X,"^",$F("TCD",$E(SVC,3))-1) W ": ",$S(N1="":$E(SVC,1),1:N1),"// "
"RTN","FHORD1",19,0)
 R X:DTIME G:'$T!(X="^") AB S:X="" X=$S(N1="":$E(SVC,1),1:N1) S X=$E(X,1) D TR^FH
"RTN","FHORD1",20,0)
 I SVC'[X W *7,!,"Enter one of the given type of services." G F7
"RTN","FHORD1",21,0)
 S TYP=X
"RTN","FHORD1",22,0)
 I 'FHORD!(N1="")!(N1=TYP) G F8
"RTN","FHORD1",23,0)
 S N1=^FHPT(DFN,"A",ADM,"DI",FHORD,0) I "^^^^"[$P(N1,"^",2,6) G F8
"RTN","FHORD1",24,0)
R1 R !!,"Retain Current Diet? N// ",Y:DTIME G:'$T!(Y="^") AB S:Y="" Y="N" S X=Y D TR^FH S Y=X I $P("YES",Y,1)'="",$P("NO",Y,1)'="" W *7,"  Answer YES or NO" G R1
"RTN","FHORD1",25,0)
 G:Y?1"N".E F8 S FHOR=$P(N1,"^",2,6),(D3,D4)=0,D2=$P(N1,"^",10)
"RTN","FHORD1",26,0)
 S D1=NOW G F10
"RTN","FHORD1",27,0)
F8 K DI S N1=0 G:FHWF=2 F1 R !!,"Order a REGULAR Diet? (Y/N) ",Y:DTIME G:'$T!(Y="^") AB S:Y="" Y="^" S X=Y D TR^FH S Y=X I $P("YES",Y,1)'="",$P("NO",Y,1)'="" W *7,"  Answer YES or NO" G F8
"RTN","FHORD1",28,0)
 G:Y'?1"Y".E F1 S Y(0)=^FH(111,1,0),PREC=$P(Y(0),U,4),DI(PREC)="1^"_Y(0),N1=1 G F5
"RTN","FHORD1",29,0)
F1 W ! K DIC S DIC="^FH(111,",DIC(0)="AEQMZ" S DIC("S")="I '$D(^(""I""))&(Y>1)" D ^DIC K DIC G AB:X[U!$D(DTOUT),F5:X="",F1:Y<1
"RTN","FHORD1",30,0)
 S PREC=$P(Y(0),U,4) I PREC,$D(DI(PREC)) W *7,!!,"This conflicts with ",$P(DI(PREC),"^",2),! G F1
"RTN","FHORD1",31,0)
 S N1=N1+1,DI(PREC)=+Y_"^"_Y(0) G F5:+Y=1,F1:N1<5 W *7,!!,"You have now selected the maximum of 5 Diet Modifications!"
"RTN","FHORD1",32,0)
F5 G:'N1 AB W !!,"You have selected the following Diet:",!
"RTN","FHORD1",33,0)
 S (D3,D4)=0 F D0=0:0 S D0=$O(DI(D0)) Q:D0=""  W !?5,$P(DI(D0),U,2) S:$P(DI(D0),U,4)="Y" D3=1 S:$P(DI(D0),U,7)="Y" D4=1
"RTN","FHORD1",34,0)
F9 G:FHWF=2 F6 R !!,"Is this Correct? Y// ",Y:DTIME G:'$T!(Y="^") AB S:Y="" Y="Y" S X=Y D TR^FH S Y=X
"RTN","FHORD1",35,0)
 I $P("YES",Y,1)'="",$P("NO",Y,1)'="" W *7,!,"  Answer YES to accept diet list; NO to select diets again" G F9
"RTN","FHORD1",36,0)
 I Y'?1"Y".E K DI S N1=0 W !!,"Select new diets ..." G F1
"RTN","FHORD1",37,0)
F6 S COM="" ;R !!,"Comment: ",COM:DTIME G:'$T!(COM["^") AB I COM'?.ANP W *7," ??" G F6
"RTN","FHORD1",38,0)
 I $L(COM)>80!(COM?1"?".E) W *7,!,"Enter any special instructions of up to 80 characters!" G F6
"RTN","FHORD1",39,0)
 D GETD^FHORD71 G:'D1 AB
"RTN","FHORD1",40,0)
 S FHOR="^^^^",FHEVTX="",N1=0 F D0=0:0 S D0=$O(DI(D0)) Q:D0=""  S N1=N1+1,$P(FHOR,U,N1)=+DI(D0),FHEVTX=FHEVTX_", "_$P(DI(D0),U,8)
"RTN","FHORD1",41,0)
 ; [SEE NOIS SDC-0402-62498] S FHDPATT=$O(^FH(111.1,"AB",FHOR,0)) I FHDPATT'="" I $G(^FH(111.1,FHDPATT,"I"))="Y" W !!,"  ** INACTIVE DIET PATTERN! **" G AB
"RTN","FHORD1",42,0)
 I '$O(^FH(111.1,"AB",FHOR,0)),$P($G(^FH(119.9,1,4)),"^",2)="Y" S EVT="M^O^^No Diet Pattern ("_$E(FHEVTX,3,999)_")" D ^FHORX
"RTN","FHORD1",43,0)
F10 S FHLD="" W:FHWF'=2 !!,"... Diet Order Accepted"
"RTN","FHORD1",44,0)
 Q
"RTN","FHORD1",45,0)
PROC ; Process & file order
"RTN","FHORD1",46,0)
 D STR^FHORD7,^FHORDR D:D4 POST^FHORD7 Q
"RTN","FHORD1",47,0)
AB W *7,!!,"Diet Order for this Patient is UNCHANGED -- No order entered!",! S DFN="" Q
"RTN","FHORD1",48,0)
KIL ; Final variable kill
"RTN","FHORD1",49,0)
 K %,%H,%I,%T,%DT,A1,A2,ADM,ALL,C,COM,CORD,CT,D0,D1,D2,D3,D4,DA,DFN,DTP,DI,DIC,FHDU,FHD,FHLD,FHOR,FHPAR,FHWF,FHPV,FLG,I,J,K,KK,N1,NOW,FHORD,FHSAV,FHSAV1,FHDAY
"RTN","FHORD1",50,0)
 K FHK,FHK1,FHOE,FHOLD,FHMSG,FHNEW,K1,K2,KK1,LC,M,PREC,SVC,TYP,X,X1,X2,Y,WRD,WARD,TF,QUA,STR,TUN,XMKK,Z Q
"RTN","FHORD1",51,0)
FUT ; List future diets
"RTN","FHORD1",52,0)
 S CT=0,CORD=FHORD F KK=NOW:0 S KK=$O(^FHPT(DFN,"A",ADM,"AC",KK)) Q:KK<1  S FHORD=$P(^(KK,0),"^",2) D T1
"RTN","FHORD1",53,0)
 S FHORD=CORD Q
"RTN","FHORD1",54,0)
T1 Q:'$D(^FHPT(DFN,"A",ADM,"DI",FHORD,0))  S DTP=KK D DTP^FH,C2^FHORD7
"RTN","FHORD1",55,0)
 I 'CT W !!,"Future Diet Orders:",!
"RTN","FHORD1",56,0)
 S CT=CT+1 W !?5,DTP,?25,Y Q
"RTN","FHORD13")
0^6^B12106638
"RTN","FHORD13",1,0)
FHORD13 ; HISC/REL/NCA - Reprint Diet Label ;2/26/96  11:57
"RTN","FHORD13",2,0)
 ;;5.0;Dietetics;**2,38**;Mar 25, 1996
"RTN","FHORD13",3,0)
 W @IOF,!!?21,"R E P R I N T   D I E T   L A B E L S"
"RTN","FHORD13",4,0)
F0 R !!,"Reprint by COMMUNICATION OFFICE, PATIENT, or WARD? PATIENT// ",X:DTIME G:'$T!(X["^") KIL S:X="" X="P" D TR^FH I $P("COMMUNICATION OFFICE",X,1)'="",$P("PATIENT",X,1)'="",$P("WARD",X,1)'="" W *7,!!,"  Answer with C, W, or P" G F0
"RTN","FHORD13",5,0)
 S FHPR=$E(X,1),ALL=0,(FHX1,FHX2)="" G P0:FHPR?1"P",D2:FHPR?1"C"
"RTN","FHORD13",6,0)
W0 K DIC S DIC("A")="Select WARD: ",DIC="^FH(119.6,",DIC(0)="AEQM" W ! D ^DIC K DIC G KIL:"^"[X!$D(DTOUT),W0:Y<1 S FHX1=-Y G P1
"RTN","FHORD13",7,0)
D2 K DIC S DIC("A")="Select COMMUNICATION OFFICE: ",DIC="^FH(119.73,",DIC(0)="AEMQ" W ! D ^DIC G KIL:"^"[X!$D(DTOUT),D2:Y<1 S FHX1=-Y G P1
"RTN","FHORD13",8,0)
P0 D ^FHDPA I DFN S FHX1=FHX1_DFN_"^",FHX2=FHX2_ADM_"^" I $L(FHX1)<231,$L(FHX2)<231 G P0
"RTN","FHORD13",9,0)
 G:FHX1="" KIL
"RTN","FHORD13",10,0)
P1 W ! K IOP,%ZIS S %ZIS("A")="Select LABEL Printer: ",%ZIS="MQ" D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHORD13",11,0)
 I $D(IO("Q")) S FHPGM="Q1^FHORD13",FHLST="FHX1^FHX2^FHPR" D EN2^FH G KIL
"RTN","FHORD13",12,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHORD13",13,0)
Q1 ; Reprint the Diet Labels
"RTN","FHORD13",14,0)
 S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1 S S2=LAB=2*5+36 D NOW^%DTC S NOW=%
"RTN","FHORD13",15,0)
 S COUNT=0,LINE=1
"RTN","FHORD13",16,0)
 S DTP=NOW D DTP^FH,^FHDEV G:FHX1>0 Q2
"RTN","FHORD13",17,0)
 S WRD=-FHX1 K ^TMP($J)
"RTN","FHORD13",18,0)
 F K1=0:0 S K1=$O(^FH(119.6,K1)) Q:K1<1  S X=^(K1,0) D F1
"RTN","FHORD13",19,0)
 S RM="" F  S RM=$O(^TMP($J,"DL",RM)) Q:RM=""  F DFN=0:0 S DFN=$O(^TMP($J,"DL",RM,DFN)) Q:DFN<1  S ADM=^(DFN) D:ADM LST
"RTN","FHORD13",20,0)
 I LAB>2 D DPLL^FHLABEL K ^TMP($J) Q
"RTN","FHORD13",21,0)
 K ^TMP($J) G Q3
"RTN","FHORD13",22,0)
F1 I FHPR="C" S KK=$P(X,"^",8) I WRD,KK'=WRD Q
"RTN","FHORD13",23,0)
 I FHPR="W" S KK=$P(X,"^",1) I WRD,K1'=WRD Q
"RTN","FHORD13",24,0)
 S P0=$P(X,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHORD13",25,0)
 F DFN=0:0 S DFN=$O(^FHPT("AW",K1,DFN)) Q:DFN<1  D
"RTN","FHORD13",26,0)
 .S ADM=^(DFN),RM=$G(^DPT(DFN,.101))
"RTN","FHORD13",27,0)
 .S:RM="" RM="***"
"RTN","FHORD13",28,0)
 .S RI=$G(^DPT(DFN,.108)) S RE=$S(RI:$O(^FH(119.6,"AR",+RI,K1,0)),1:"")
"RTN","FHORD13",29,0)
 .S R0=$S(RE:$P($G(^FH(119.6,K1,"R",+RE,0)),"^",2),1:"")
"RTN","FHORD13",30,0)
 .S R0=$S(R0<1:99,R0<10:"0"_R0,1:R0)
"RTN","FHORD13",31,0)
 .S ^TMP($J,"DL",P0_"~"_R0_"~"_RM,DFN)=ADM Q
"RTN","FHORD13",32,0)
 Q
"RTN","FHORD13",33,0)
Q2 F K7=1:1 S DFN=$P(FHX1,"^",K7) Q:DFN<1  S ADM=$P(FHX2,"^",K7) D LST
"RTN","FHORD13",34,0)
 I LAB>2 D DPLL^FHLABEL K ^TMP($J) Q
"RTN","FHORD13",35,0)
Q3 I LAB<3 F K7=1:1:18 W !
"RTN","FHORD13",36,0)
 Q
"RTN","FHORD13",37,0)
LST Q:'$D(^FHPT(DFN,"A",ADM,0))  S X0=^(0)
"RTN","FHORD13",38,0)
 S FHORD=$P(X0,"^",2),X1=$P(X0,"^",5) Q:FHORD<1
"RTN","FHORD13",39,0)
 S W1=$P(X0,"^",8),W1=$P($G(^FH(119.6,+W1,0)),"^",1),R1=$G(^DPT(DFN,.101))
"RTN","FHORD13",40,0)
 Q:'$D(^DPT(DFN,0))  S Y0=^(0) D PID^FHDPA
"RTN","FHORD13",41,0)
 S W1=$E(W1,1,15),N1=$E($P(Y0,"^",1),1,22)
"RTN","FHORD13",42,0)
 S X=$G(^FHPT(DFN,"A",ADM,"DI",FHORD,0))
"RTN","FHORD13",43,0)
 S (Y,X1)="" G:X="" L1 S FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7)
"RTN","FHORD13",44,0)
 I FHLD'="" S FHDU=";"_$P(^DD(115.02,6,0),"^",3),%=$F(FHDU,";"_FHLD_":") G:%<1 L1 S Y=$P($E(FHDU,%,999),";",1) G L1
"RTN","FHORD13",45,0)
 F A1=1:1:5 S D3=$P(FHOR,"^",A1) I D3 S:Y'="" Y=Y_", " S Y=Y_$P(^FH(111,D3,0),"^",7)
"RTN","FHORD13",46,0)
 S IS=$P(X0,"^",10),X1=$P(X,"^",8) I IS S IS=^FH(119.4,IS,0),X1=X1_"-"_$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHORD13",47,0)
L1 I LAB>2 D LL Q
"RTN","FHORD13",48,0)
 W !,$E(N1,1,S2-5-$L(W1)),?(S2-3-$L(W1)),W1,!,BID W @FHIO("EON") W ?(S2-3\2),X1 W @FHIO("EOF") W ?(S2-3-$L(R1)),R1 W @FHIO("EON") I $L(Y)<S2 W:LAB=2 ! W !!,Y,!!
"RTN","FHORD13",49,0)
 E  S L=$S($L($P(Y,",",1,3))<S2:3,1:2) W !!,$P(Y,",",1,L) W:LAB=2 ! W !,$E($P(Y,",",L+1,5),2,99),!
"RTN","FHORD13",50,0)
 W @FHIO("EOF") W:LAB=2 ?(S2-20),DTP,!! Q
"RTN","FHORD13",51,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHORD13",52,0)
 Q
"RTN","FHORD13",53,0)
LL D LAB^FHLABEL Q
"RTN","FHORE21")
0^7^B15605657
"RTN","FHORE21",1,0)
FHORE21 ; HISC/REL/NCA - List Early/Late Trays (cont) ;11/9/94  13:33 
"RTN","FHORE21",2,0)
 ;;5.0;Dietetics;**38**;Oct 11, 1995
"RTN","FHORE21",3,0)
 S D1=DTE,COUNT=0,LINE=1 K ^TMP($J) S ANS=""
"RTN","FHORE21",4,0)
F2 S D1=$O(^FHPT("ADLT",D1)) G:D1<1!(D1\1'=DTE) P0 S DFN=0
"RTN","FHORE21",5,0)
F3 S DFN=$O(^FHPT("ADLT",D1,DFN)) G:DFN<1 F2 S ADM=0
"RTN","FHORE21",6,0)
F4 S ADM=$O(^FHPT("ADLT",D1,DFN,ADM)) G:ADM<1 F3
"RTN","FHORE21",7,0)
 I $S($D(^DGPM(ADM,0)):$P(^(0),"^",17),1:1) G F7
"RTN","FHORE21",8,0)
 S Y(0)=$G(^FHPT(DFN,"A",ADM,"EL",D1,0)) G:Y(0)="" F7
"RTN","FHORE21",9,0)
 S X=$G(^FHPT(DFN,"A",ADM,0)),OLW=$P(X,"^",11),IS=$P(X,"^",10)
"RTN","FHORE21",10,0)
 S W1=$P(X,"^",8),X2=$G(^FH(119.6,+W1,0)),WARD=$P(X2,"^",1)
"RTN","FHORE21",11,0)
 G:WARD="" F4 S P0=$P(X2,"^",8) I FHP,P0'=FHP G F4
"RTN","FHORE21",12,0)
 S M1=$P(Y(0),"^",2) I MEAL'="A",M1'=MEAL G F4
"RTN","FHORE21",13,0)
 D CUR G:FHLD'="" F4 S O1=Y
"RTN","FHORE21",14,0)
 S ^TMP($J,"EL",D1_"-"_$P(Y(0),"^",6),DFN_"-"_ADM)=WARD_"^"_P0_"^"_OLW_"^"_IS_"^"_O1_"^"_$P(Y(0),"^",2,4) G F4
"RTN","FHORE21",15,0)
P0 D NOW^%DTC S DTP=% D DTP^FH S H1=DTP,DTP=DTE\1 D DTP^FH S L1=DTP
"RTN","FHORE21",16,0)
 I LAB S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1
"RTN","FHORE21",17,0)
 S S1=LAB=2*5+36
"RTN","FHORE21",18,0)
P1 S M2="Z",PG=0 D:'LAB HDR
"RTN","FHORE21",19,0)
 S N1="" F  S N1=$O(^TMP($J,"EL",N1)) Q:N1=""!(ANS="^")  S N2="" F  S N2=$O(^TMP($J,"EL",N1,N2)) Q:N2=""  S Y=^(N2) D P2 Q:ANS="^"
"RTN","FHORE21",20,0)
 I LAB>2 D DPLL^FHLABEL K ^TMP($J) Q
"RTN","FHORE21",21,0)
 I LAB<3 F K=1:1:$S('LAB:1,1:18) W !
"RTN","FHORE21",22,0)
 Q
"RTN","FHORE21",23,0)
P2 S DFN=+N2,WARD=$P(Y,"^",1),P0=$P(Y,"^",2),OLW=$P(Y,"^",3),IS=$P(Y,"^",4),O1=$P(Y,"^",5),M1=$P(Y,"^",6),TIM=$P(Y,"^",7),BAG=$P(Y,"^",8)
"RTN","FHORE21",24,0)
 I IS S IS=^FH(119.4,IS,0),IS=$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHORE21",25,0)
 S Y=^DPT(DFN,0),P1=$P(Y,"^",1) D PID^FHDPA
"RTN","FHORE21",26,0)
 S RM=$G(^DPT(DFN,.101)) I LAB>2 D LL Q
"RTN","FHORE21",27,0)
 G:LAB P3
"RTN","FHORE21",28,0)
 I $Y>(IOSL-10) D HDR Q:ANS="^"  W !!?59,$S(M1="B":"Break",M1="N":"Noon",1:"Even"),?65,$J(TIM,6),! S M2=M1_TIM
"RTN","FHORE21",29,0)
 S X=M1_TIM I X'=M2 W !!?59,$S(M1="B":"Break",M1="N":"Noon",1:"Even"),?65,$J(TIM,6),! S M2=X
"RTN","FHORE21",30,0)
 W !,$S(WARD'="":$E(WARD,1,10),1:"")_$S(RM'="":"/"_$E(RM,1,10),1:""),?24,$E(P1,1,22),?50,BID,?61,$S(IS'="":IS,1:""),?67,$S(BAG="Y":"YES",1:""),?73,O1
"RTN","FHORE21",31,0)
 Q
"RTN","FHORE21",32,0)
P3 S P1=$E(P1,1,22),WARD=$E(WARD,1,15),RM=$E(RM,1,10)
"RTN","FHORE21",33,0)
 W !,$S(M1="B":"Breakfast",M1="N":"  Noon ",1:" Evening"),?10,TIM,?(S1-12),L1 W:LAB=2 !
"RTN","FHORE21",34,0)
 W !,$E(P1,1,S1-5-$L(WARD)),?(S1-3-$L(WARD)),WARD
"RTN","FHORE21",35,0)
 W !,BID W:IS'="" ?(S1-3\2),IS W ?(S1-3-$L(RM)),RM W:LAB=2 !
"RTN","FHORE21",36,0)
 I $L(O1)<S1 W !,O1,!!
"RTN","FHORE21",37,0)
 E  S L=$S($L($P(O1,",",1,3))<S1:3,1:2) W !,$P(O1,",",1,L),!,$E($P(O1,",",L+1,5),2,99),!
"RTN","FHORE21",38,0)
 W:LAB=2 ! Q
"RTN","FHORE21",39,0)
F7 K ^FHPT("ADLT",D1,DFN,ADM) G F4
"RTN","FHORE21",40,0)
CUR S A1=0,(Y,FHLD,FHOR)="" F KK=0:0 S KK=$O(^FHPT(DFN,"A",ADM,"AC",KK)) Q:KK<1!(KK>D1)  S A1=KK
"RTN","FHORE21",41,0)
 Q:'A1  S FHORD=$P(^FHPT(DFN,"A",ADM,"AC",A1,0),"^",2),X=^FHPT(DFN,"A",ADM,"DI",FHORD,0),FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7)
"RTN","FHORE21",42,0)
 I FHLD'="" S FHDU=";"_$P(^DD(115.02,6,0),"^",3),%=$F(FHDU,";"_FHLD_":") Q:%<1  S Y=$P($E(FHDU,%,999),";",1) Q
"RTN","FHORE21",43,0)
 S Y="" F A1=1:1:5 S D3=$P(FHOR,"^",A1) I D3 S:Y'="" Y=Y_", " S Y=Y_$P(^FH(111,D3,0),"^",7)
"RTN","FHORE21",44,0)
 Q
"RTN","FHORE21",45,0)
DP K N S Y=$G(^FH(119.73,+P0,1))
"RTN","FHORE21",46,0)
 F KK=1,2,3,7,8,9,13,14,15 S X=$P(Y,"^",KK) I X'="" S N($S(KK<7:"B",KK<13:"N",1:"E"),X)=""
"RTN","FHORE21",47,0)
 Q
"RTN","FHORE21",48,0)
HDR ; Print Header
"RTN","FHORE21",49,0)
 I PG,IOST?1"C-".E R !!,"Press RETURN to continue or ""^"" to exit. ",ANS:DTIME S:'$T!(ANS["^") ANS="^" Q:ANS="^"  I "^"'[ANS W !,"Enter Return or ""^""." G HDR
"RTN","FHORE21",50,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHORE21",51,0)
 W !?50,"E A R L Y / L A T E   T R A Y S",?110,H1
"RTN","FHORE21",52,0)
 W !,$S('FHP:"Consolidated",1:$P(^FH(119.73,FHP,0),"^",1)),?61,L1,?121,"Page ",PG
"RTN","FHORE21",53,0)
 W !!,"Ward/Room",?24,"Patient",?50,"ID#",?61,"Iso   Bag   Current-Diet",! Q
"RTN","FHORE21",54,0)
LL ;
"RTN","FHORE21",55,0)
 S SL1=$S(LAB=3:25,1:38)
"RTN","FHORE21",56,0)
 S MEALTM=$S(M1="B":"Breakfast",M1="N":"Noon",1:"Evening")_"  "_TIM
"RTN","FHORE21",57,0)
 S BIDIS=BID_$E("        ",1,12-$L(BID))_IS
"RTN","FHORE21",58,0)
 S WARD=$E(WARD,1,15),WLN=$L(WARD),RM=$E(RM,1,10)
"RTN","FHORE21",59,0)
 I LAB=3 D
"RTN","FHORE21",60,0)
 .S P1=$E(P1,1,24-WLN)
"RTN","FHORE21",61,0)
 .S (PCL1,PCL6)="",PCL2=MEALTM_$J(L1,25-$L(MEALTM))
"RTN","FHORE21",62,0)
 .S PCL3=P1_$J(WARD,25-$L(P1)),PCL4=BIDIS_$J(RM,25-$L(BIDIS))
"RTN","FHORE21",63,0)
 .S PCL5=$E(O1,1,29) D LL3^FHLABEL
"RTN","FHORE21",64,0)
 I LAB=4 D
"RTN","FHORE21",65,0)
 .S P1=$E(P1,1,37-WLN)
"RTN","FHORE21",66,0)
 .S (PCL1,PCL2,PCL7,PCL8)="",PCL3=MEALTM_$J(L1,38-$L(MEALTM))
"RTN","FHORE21",67,0)
 .S PCL4=P1_$J(WARD,38-$L(P1)),PCL5=BIDIS_$J(RM,38-$L(BIDIS))
"RTN","FHORE21",68,0)
 .S PCL6=$E(O1,1,42) D LL4^FHLABEL
"RTN","FHORE21",69,0)
 Q
"RTN","FHORO")
0^14^B5420303
"RTN","FHORO",1,0)
FHORO ; HISC/REL - Additional Orders ;2/22/95  10:06 ;
"RTN","FHORO",2,0)
 ;;5.0;Dietetics;**6,38**;Oct 11, 1995
"RTN","FHORO",3,0)
EN1 ; Enter Order
"RTN","FHORO",4,0)
 S ALL=0 D ^FHDPA G:'DFN KIL D R1 G:'$D(DFN) KIL D ORD G:'FHWF A0
"RTN","FHORO",5,0)
 ; Set HL7
"RTN","FHORO",6,0)
 D AO^FHWOR1,KIL I $D(MSG) D MSG^XQOR("FH EVSEND OR",.MSG) K MSG
"RTN","FHORO",7,0)
A0 W "  ... done" Q
"RTN","FHORO",8,0)
R1 ; Process Order
"RTN","FHORO",9,0)
 D LIS
"RTN","FHORO",10,0)
R2 R !!,"Additional Order: ",COM:DTIME G:'$T!(COM="")!(COM["^") AB I COM'?.ANP W *7," ??" G R2
"RTN","FHORO",11,0)
 I COM?1."?" W *7,!,"Enter your dietetic request. Do not use ^ or ? in your response." G R2
"RTN","FHORO",12,0)
 I $L(COM)>160 W *7,!,"Order not accepted! - Enter 1-160 character order" G R2
"RTN","FHORO",13,0)
 Q:FHWF=2
"RTN","FHORO",14,0)
R3 R !,"Ok to Enter Request? Y// ",YN:DTIME G AB:'$T!(YN["^") S:YN="" YN="Y" S X=YN D TR^FH S YN=X I $P("YES",YN,1)'="",$P("NO",YN,1)'="" W *7," Answer YES or NO" G R3
"RTN","FHORO",15,0)
 G:YN'?1"Y".E AB Q
"RTN","FHORO",16,0)
ORD ; Set Order
"RTN","FHORO",17,0)
 L +^FHPT(DFN,"A",ADM,"OO",0) S:'$D(^FHPT(DFN,"A",ADM,"OO",0)) ^FHPT(DFN,"A",ADM,"OO",0)="^115.06^^"
"RTN","FHORO",18,0)
 S FHDR=$P(^FHPT(DFN,"A",ADM,"OO",0),"^",3)+1,$P(^(0),"^",3,4)=FHDR_"^"_FHDR L -^FHPT(DFN,"A",ADM,"OO",0)
"RTN","FHORO",19,0)
 D NOW^%DTC S NOW=%
"RTN","FHORO",20,0)
 S ^FHPT(DFN,"A",ADM,"OO",FHDR,0)=FHDR_"^"_NOW_"^"_COM_"^"_DUZ_"^A"
"RTN","FHORO",21,0)
 S ^FHPT("AOO",DFN,ADM,FHDR)="" S EVT="O^O^"_FHDR D ^FHORX Q
"RTN","FHORO",22,0)
AB W *7,!!,"Order entry is TERMINATED - No request entered!"
"RTN","FHORO",23,0)
KIL K %,%H,%I,%T,A,C,CT,ADM,ALL,COM,DA,DFN,DTP,FHDR,FHPV,FHWF,G,K,I,NOW,POP,WARD,X,X1,X2,Y,YN Q
"RTN","FHORO",24,0)
LIS D NOW^%DTC S X1=%,X2=-1 D C^%DTC S A=X
"RTN","FHORO",25,0)
 S CT=0 W !!,"Additional Orders Last 24 Hours:",!
"RTN","FHORO",26,0)
 F K=0:0 S K=$O(^FHPT(DFN,"A",ADM,"OO",K)) Q:K<1  S X=^(K,0) I $P(X,"^",2)'<A,$P(X,"^",5)'="X" D L1
"RTN","FHORO",27,0)
 W:'CT !?5,"None Entered." Q
"RTN","FHORO",28,0)
L1 S DTP=$P(X,"^",2),CT=1 D DTP^FH W !,DTP,?20,$P(X,"^",3) Q
"RTN","FHORT1")
0^13^B15207888
"RTN","FHORT1",1,0)
FHORT1 ; HISC/REL/NCA - Tubefeeding ;8/19/96  14:55 ;
"RTN","FHORT1",2,0)
 ;;5.0;Dietetics;**5,6,15,38**;Oct 11, 1995
"RTN","FHORT1",3,0)
 S ALL=0 D ^FHDPA G:'DFN KIL
"RTN","FHORT1",4,0)
 ; Set HL7
"RTN","FHORT1",5,0)
 D E0 G:'DFN KIL S TF=$P($G(^FHPT(DFN,"A",ADM,0)),"^",4) D:TF CAN^FHORT2 D ^FHORT11 G:'FHWF KIL
"RTN","FHORT1",6,0)
 D TF^FHWOR5 F FHTF=0:0 S FHTF=$O(TUN(FHTF)) Q:FHTF<1  S XX=$G(TUN(FHTF)) D TF1^FHWOR5
"RTN","FHORT1",7,0)
 D:$D(MSG) MSG^XQOR("FH EVSEND OR",.MSG) K MSG
"RTN","FHORT1",8,0)
 G KIL
"RTN","FHORT1",9,0)
E0 ; Process tubefeeding
"RTN","FHORT1",10,0)
 S (NO,T1,T2,T3,T4)=0,(PRO,TFCOM)="" K TUN
"RTN","FHORT1",11,0)
 S TF=$P(^FHPT(DFN,"A",ADM,0),"^",4) G:TF<1 E3
"RTN","FHORT1",12,0)
 W !!,"An ACTVE TUBEFEEDING ORDER exists!" D DIS^FHORT2
"RTN","FHORT1",13,0)
 R !!,"Do You Wish to Cancel the Existing Tubefeeding and Enter a New One? Y// ",ANS:DTIME I '$T!(ANS="^")  W *7,!!,"No order entered!" S DFN="" Q
"RTN","FHORT1",14,0)
 S:ANS="" ANS="Y" S X=ANS D TR^FH S ANS=X
"RTN","FHORT1",15,0)
 I $P("YES",ANS,1)'="",$P("NO",ANS,1)'="" W !!,"Answer YES to Cancel Existing Order and Enter a New One.",!,"Answer NO to Edit the Existing Tubefeeding Order.",!,"Enter ""^"" to Exit Completely." G E0
"RTN","FHORT1",16,0)
 I ANS?1"Y".E K TUN S TFCOM="",NO=0
"RTN","FHORT1",17,0)
 I ANS'?1"Y".E W *7,!!,"Edit the Existing Tubefeeding." S TFCOM=$P(T,"^",5)
"RTN","FHORT1",18,0)
 I NO=5 W !!,*7,"There are FIVE products already!",!,"You may edit them, or delete a product before adding any."
"RTN","FHORT1",19,0)
E3 D ^FHORT10 Q:'DFN
"RTN","FHORT1",20,0)
 I $O(TUN(0))="" W !!,"No Tubefeeding Products selected." G AB
"RTN","FHORT1",21,0)
 S (TC,TK)=0 W !
"RTN","FHORT1",22,0)
 F K=0:0 S K=$O(TUN(K)) Q:K<1  D
"RTN","FHORT1",23,0)
 .S TC=TC+$P(TUN(K),"^",4)+$P(TUN(K),"^",5)
"RTN","FHORT1",24,0)
 .S TK=TK+$P(TUN(K),"^",6),STR=$P(TUN(K),"^",2)
"RTN","FHORT1",25,0)
 .S PRO=$P(TUN(K),"^",1)
"RTN","FHORT1",26,0)
 .W !,"Product: ",$P($G(^FH(118.2,PRO,0)),"^",1),", "
"RTN","FHORT1",27,0)
 .W $S(STR=4:"Full",STR=2:"1/2",STR=1:"1/4",1:"3/4"),", "
"RTN","FHORT1",28,0)
 .W $P(TUN(K),"^",3)
"RTN","FHORT1",29,0)
 .Q
"RTN","FHORT1",30,0)
 W !!,"Total Kcal: ",TK,?36,"Total Quantity: ",TC
"RTN","FHORT1",31,0)
 I TC>5000 W *7,!!,"WARNING: Total amount exceeds 5000cc: ",TC," cc",!,"Please Edit the Tubefeeding and Modify." G E3
"RTN","FHORT1",32,0)
E31 R !!,"Is this Correct ? Y// ",X:DTIME G:'$T!(X="^") AB S:X="" X="Y" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Answer YES or NO" G E31
"RTN","FHORT1",33,0)
 G:X'?1"Y".E E3
"RTN","FHORT1",34,0)
 G:TC>5000 AB
"RTN","FHORT1",35,0)
E4 W !,"Comment: ",$S(TFCOM'="":TFCOM_"// ",1:"") R X:DTIME G:'$T!(X[U) AB I X'?.ANP W *7," ??" G E4
"RTN","FHORT1",36,0)
 I $L(X)>160!(X?1"?".E) W *7,!,"Enter a comment of up to 160 characters" G E4
"RTN","FHORT1",37,0)
 I X'="" S TFCOM=X
"RTN","FHORT1",38,0)
E5 R !,"Cancel all current or future tray orders? Y// ",YN:DTIME G:'$T!(YN["^") AB S:YN="" YN="Y" S X=YN D TR^FH S YN=X I $P("YES",YN,1)'="",$P("NO",YN,1)'="" W *7," Answer YES or NO" G E5
"RTN","FHORT1",39,0)
 S CAN=YN?1"Y".E
"RTN","FHORT1",40,0)
E6 Q:FHWF=2  R !,"Ok to Enter Order? Y// ",YN:DTIME G:'$T!(YN["^") AB S:YN="" YN="Y" S X=YN D TR^FH S YN=X I $P("YES",YN,1)'="",$P("NO",YN,1)'="" W *7," Answer YES or NO" G E6
"RTN","FHORT1",41,0)
 G:YN'?1"Y".E AB Q
"RTN","FHORT1",42,0)
KIL K %,%H,%I,A,A1,A2,A3,A4,ADM,ALL,ANS,C,CAN,COM,TFCOM,CS,D1,D2,D3,D4,DFN,DX,E,PID,BID,DIC,FHD,FHDR,FHORD,FLG,FLG1,FHLD,FHOR,FHPAR,FHWF,FHPV,FHTF,FHDU,I,K,NO,NOW,DTP,P,P1,P2,POP
"RTN","FHORT1",43,0)
 K OLDT,FHSAV,FHORN,MNUM,PR,PRO,NU,QUA,S1,S2,S3,STR,ST1,ST3,T,T1,T2,T3,T4,TC,TK,TF,TF2,TP,TT,TU,TUN,TW,TYP,UNT,WARD,WRD,X,X1,X2,XX,Y,Y0,Y2,YN,YY,Z,Z1,ZZ Q
"RTN","FHORT1",44,0)
AB W *7,!!,"Tubefeeding Order TERMINATED - No order entered!" S DFN="" Q
"RTN","FHORT5D")
0^8^B9657327
"RTN","FHORT5D",1,0)
FHORT5D ; HISC/REL/NCA - Tubefeeding Reports (cont) ;5/4/93  10:52 
"RTN","FHORT5D",2,0)
 ;;5.0;Dietetics;**38**;Oct 11, 1995
"RTN","FHORT5D",3,0)
CST ; Print Cost Report for Tubefeeding
"RTN","FHORT5D",4,0)
 S NAM="" F  S NAM=$O(^FH(118.2,"B",NAM)) Q:NAM=""  F LL=0:0 S LL=$O(^FH(118.2,"B",NAM,LL)) Q:LL<1  S ^TMP($J,"P",NAM_"~"_LL)=LL
"RTN","FHORT5D",5,0)
 I SUM S CNOD="0" D C2 Q
"RTN","FHORT5D",6,0)
 S CNOD="0" F  S CNOD=$O(^TMP($J,"C",CNOD)) Q:CNOD=""  D C2
"RTN","FHORT5D",7,0)
 Q
"RTN","FHORT5D",8,0)
C2 S D2=0,NAM="" D HD4 S X0=$G(^TMP($J,"C",CNOD,0))
"RTN","FHORT5D",9,0)
 F  S NAM=$O(^TMP($J,"P",NAM)) Q:NAM=""  S LL=^(NAM) I $D(^TMP($J,"C",CNOD,LL)) S X1=$G(^(LL,0)),TU=$P(X1,"^",1),TP=$P(X1,"^",2) D
"RTN","FHORT5D",10,0)
 .I $Y>(IOSL-8) D HD4
"RTN","FHORT5D",11,0)
 .S Y0=^FH(118.2,LL,0),TU=TU+.95\1,PR=$P($G(^FH(114,+$P(Y0,"^",7),0)),"^",13),D2=TU*PR+D2
"RTN","FHORT5D",12,0)
 .W !,$P(Y0,"^",1),?31,$J($S(TP:TP,1:0),5),?41,$P(Y0,"^",2),?53,$J(TU,5),?62,$J(PR,7,2),?72,$J(TU*PR,7,2) Q
"RTN","FHORT5D",13,0)
 W !!,"Total: ",?71,$J(D2,8,2),!!!,"No. of Patients on TF: ",?33,$J($P(X0,"^",1),6)
"RTN","FHORT5D",14,0)
 W !,"No. of Patients on TF and Tray: ",?33,$J($P(X0,"^",2),6),!,"No. of Patients on TF and SF: ",?33,$J($P(X0,"^",3),6)
"RTN","FHORT5D",15,0)
 W !,"No. of Patients on ALL Three: ",?33,$J($P(X0,"^",4),6),!,"Cost/Patient: ",?33 S X=$P(X0,"^",1) W $J($S(X:D2/X,1:""),6,2),! Q
"RTN","FHORT5D",16,0)
LAB ; Print Labels
"RTN","FHORT5D",17,0)
 S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1 S S1=$S(LAB=1:6,1:9),S2=LAB=2*5+33
"RTN","FHORT5D",18,0)
 S COUNT=0,LINE=1
"RTN","FHORT5D",19,0)
 S TNOD="" F  S TNOD=$O(^TMP($J,"T",TNOD)) Q:TNOD=""  D L1
"RTN","FHORT5D",20,0)
 I LAB>2 D DPLL^FHLABEL Q
"RTN","FHORT5D",21,0)
 W !!!!!!!!!!!!!!!!!! Q
"RTN","FHORT5D",22,0)
L1 S PNOD="" F  S PNOD=$O(^TMP($J,"T",TNOD,PNOD)) Q:PNOD=""  S X0=^(PNOD,0) D L2
"RTN","FHORT5D",23,0)
 Q
"RTN","FHORT5D",24,0)
L2 S NAM=$P(X0,"^",1),WARD=$P(X0,"^",3),RM=$P(X0,"^",4),X3=3
"RTN","FHORT5D",25,0)
 F TF2=0:0 S TF2=$O(^TMP($J,"T",TNOD,PNOD,TF2)) Q:'TF2  S X1=^(TF2,0),X3=X3+3 D L3
"RTN","FHORT5D",26,0)
 Q
"RTN","FHORT5D",27,0)
L3 S Y0=$P(X1,"^",1),STR=$P(X1,"^",7),Y1="" I STR<4 S Y1=$S(STR=1:"1/4",STR=2:"1/2",1:"3/4")_" Str, "
"RTN","FHORT5D",28,0)
 S Y1=Y1_$P(X1,"^",8),Y0=Y0_", "_$S('MUL:$P(X1,"^",6),1:1)_" "_$P(X1,"^",2) I 'MUL,$P(X1,"^",6)>1 S Y0=Y0_"S"
"RTN","FHORT5D",29,0)
 I LAB>2 D LL Q
"RTN","FHORT5D",30,0)
 I 'MUL D LHDR W !,Y0,!,Y1,! W:LAB=2 !!! Q
"RTN","FHORT5D",31,0)
 F X2=1:1:+$P(X1,"^",6) D LHDR W !,Y0,!,Y1,! W:LAB=2 !!!
"RTN","FHORT5D",32,0)
 Q
"RTN","FHORT5D",33,0)
LHDR ; Label Header
"RTN","FHORT5D",34,0)
 W !,NAM,?(S2-$L(WARD)),WARD,!,$P(X0,"^",2),?8,$E(DTP,1,9),?(S2-$L(RM)),RM,! Q
"RTN","FHORT5D",35,0)
HD4 ; Cost Report Header
"RTN","FHORT5D",36,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHORT5D",37,0)
 W !,$E(DTP,1,9),?17,"T U B E F E E D I N G   C O S T   R E P O R T",?73,"Page ",PG
"RTN","FHORT5D",38,0)
 S Y=$S(SUM:"CONSOLIDATED",1:$P(CNOD,"~",2)) W !!?(80-$L(Y)\2),Y
"RTN","FHORT5D",39,0)
 W !!,"Product",?30,"# Patient",?41,"Unit",?53,"# Units",?62,"Cost/Unit",?74,"Total",! Q
"RTN","FHORT5D",40,0)
 Q
"RTN","FHORT5D",41,0)
LL ;
"RTN","FHORT5D",42,0)
 S FHTAB=$S(LAB=3:24,1:37)
"RTN","FHORT5D",43,0)
 S NAM=$E(NAM,1,FHTAB-$L(WARD)),X02P=$P(X0,U,2),DTP=$E(DTP,1,9)
"RTN","FHORT5D",44,0)
 S X0DTP=X02P_$E("        ",1,8-$L(X02P))_DTP
"RTN","FHORT5D",45,0)
 S LNA=NAM_$J(WARD,FHTAB+1-$L(NAM))
"RTN","FHORT5D",46,0)
 S LNB=X0DTP_$J(RM,FHTAB+1-$L(X0DTP))
"RTN","FHORT5D",47,0)
 I 'MUL D LLB Q
"RTN","FHORT5D",48,0)
 I MUL F X2=1:1:+$P(X1,"^",6) D LLB
"RTN","FHORT5D",49,0)
 Q
"RTN","FHORT5D",50,0)
LLB I LAB=3 S (PCL1,PCL6)="",PCL2=LNA,PCL3=LNB,PCL4=Y0,PCL5=Y1
"RTN","FHORT5D",51,0)
 I LAB=4 S (PCL1,PCL2,PCL5,PCL8)="",PCL3=LNA,PCL4=LNB,PCL6=Y0,PCL7=Y1
"RTN","FHORT5D",52,0)
 D:LAB=3 LL3^FHLABEL D:LAB=4 LL4^FHLABEL
"RTN","FHORT5D",53,0)
 Q
"RTN","FHORX1B")
0^9^B6022842
"RTN","FHORX1B",1,0)
FHORX1B ; HISC/REL - Diet Activity Labels ;8/26/94  12:10
"RTN","FHORX1B",2,0)
 ;;5.0;Dietetics;**2,38**;Mar 25, 1996
"RTN","FHORX1B",3,0)
 S S2=LAB=2*5+36 I LAB<3 D LHD
"RTN","FHORX1B",4,0)
 S COUNT=0,LINE=1
"RTN","FHORX1B",5,0)
 S P0="",NN=0 F  S P0=$O(^TMP($J,"P",P0)) Q:P0=""  D LST
"RTN","FHORX1B",6,0)
 I LAB<3 F L=1:1:18 W !
"RTN","FHORX1B",7,0)
 S $P(^FH(119.73,FHP,0),"^",3)=NOW
"RTN","FHORX1B",8,0)
 I LAB>2 D DPLL^FHLABEL
"RTN","FHORX1B",9,0)
 Q
"RTN","FHORX1B",10,0)
LST K PP S NP=0,LOC=0 F DA=0:0 S DA=$O(^TMP($J,"P",P0,DA)) Q:DA<1  S Z=^(DA) D L1
"RTN","FHORX1B",11,0)
 Q:LOC
"RTN","FHORX1B",12,0)
 D:$D(PP) L2 Q
"RTN","FHORX1B",13,0)
L1 ; Process event
"RTN","FHORX1B",14,0)
 S ADM=$P(Z,"^",1),TYP=$P(Z,"^",2),ACT=$P(Z,"^",3),FHORD=$P(Z,"^",4),TXT=$P(Z,"^",5)
"RTN","FHORX1B",15,0)
 Q:"DIL"'[TYP  I 'FHORD S NN=NN+1,FHORD=NN
"RTN","FHORX1B",16,0)
 I "DI"[TYP D
"RTN","FHORX1B",17,0)
 .I $D(PP(TYP,ADM_"~"_FHORD)),ACT="C" K PP(TYP,ADM_"~"_FHORD) Q
"RTN","FHORX1B",18,0)
 .K PP(TYP) S PP(TYP,ADM_"~"_FHORD)=ACT_"^"_TXT Q
"RTN","FHORX1B",19,0)
 I TYP="L" D
"RTN","FHORX1B",20,0)
 .I ACT="D" S LOC=1 Q
"RTN","FHORX1B",21,0)
 .S PP(TYP,ADM_"~"_FHORD)=ACT_"^"_TXT S:ACT="A" NP=1 Q
"RTN","FHORX1B",22,0)
 Q
"RTN","FHORX1B",23,0)
L2 S W1=$P(P0,"~",2),R1=$P(P0,"~",4),DFN=$P(P0,"~",5),Y0=$G(^DPT(DFN,0))
"RTN","FHORX1B",24,0)
 S N1=$P(Y0,"^",1) D PID^FHDPA
"RTN","FHORX1B",25,0)
 S TC=$P($G(^FHPT(DFN,"A",ADM,0)),"^",5),IS=$P($G(^(0)),"^",10),FHORD=+$P($G(^(0)),"^",2) Q:'FHORD
"RTN","FHORX1B",26,0)
 I IS S IS=$G(^FH(119.4,IS,0)) I IS'="" S TC=TC_"-"_$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHORX1B",27,0)
 S X=$G(^FHPT(DFN,"A",ADM,"DI",FHORD,0)) D CUR
"RTN","FHORX1B",28,0)
 I LAB>2 D LL Q
"RTN","FHORX1B",29,0)
 W !,$E(N1,1,S2-5-$L(W1)),?(S2-3-$L(W1)),W1,!,BID W:NP " *"
"RTN","FHORX1B",30,0)
 W @FHIO("EON") W ?(S2-3\2),TC W @FHIO("EOF") W ?(S2-3-$L(R1)),R1 W @FHIO("EON") I $L(Y)<S2 W:LAB=2 ! W !!,Y,!!
"RTN","FHORX1B",31,0)
 E  S L=$S($L($P(Y,",",1,3))<S2:3,1:2) W !!,$P(Y,",",1,L) W:LAB=2 ! W !,$E($P(Y,",",L+1,5),2,99),!
"RTN","FHORX1B",32,0)
 W @FHIO("EOF") W:LAB=2 ?(S2-20),$P(H1," - ",2),!! Q
"RTN","FHORX1B",33,0)
LHD S A1=S2-30\2 W:LAB=2 ! W !?A1,"***************************",!?A1,"*",?(A1+26),"*",!?A1,"*",?(A1+5),$P(H1," - ",2),?(A1+26),"*"
"RTN","FHORX1B",34,0)
 W !?A1,"*",?(A1+26),"*",!?A1,"***************************",! W:LAB=2 !! Q
"RTN","FHORX1B",35,0)
CUR S Y="" Q:X=""  S FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7)
"RTN","FHORX1B",36,0)
 I FHLD'="" S FHDU=";"_$P(^DD(115.02,6,0),"^",3),%=$F(FHDU,";"_FHLD_":") Q:%<1  S Y=$P($E(FHDU,%,999),";",1) Q
"RTN","FHORX1B",37,0)
 F A1=1:1:5 S D3=$P(FHOR,"^",A1) I D3 S:Y'="" Y=Y_", " S Y=Y_$P(^FH(111,D3,0),"^",7)
"RTN","FHORX1B",38,0)
 Q
"RTN","FHORX1B",39,0)
LL ;
"RTN","FHORX1B",40,0)
 S X1=TC S:NP BID=BID_" *"
"RTN","FHORX1B",41,0)
 D LAB^FHLABEL Q
"RTN","FHSP1")
0^10^B23090543
"RTN","FHSP1",1,0)
FHSP1 ; HISC/NCA - Consolidated Standing Orders List ;7/28/94  12:59 
"RTN","FHSP1",2,0)
 ;;5.0;Dietetics;**38**;Oct 11, 1995
"RTN","FHSP1",3,0)
E1 ; Set Consolidated List flag
"RTN","FHSP1",4,0)
 S FHOPT=1 G E3
"RTN","FHSP1",5,0)
E2 ; Set Label flag
"RTN","FHSP1",6,0)
 S FHOPT=2
"RTN","FHSP1",7,0)
E3 S FHP=$O(^FH(119.72,0)) I FHP'<1,$O(^FH(119.72,FHP))<1 G D2
"RTN","FHSP1",8,0)
D0 R !!,"Select SERVICE POINT (or ALL): ",X:DTIME G:'$T!("^"[X) KIL D:X="all" TR^FH I X="ALL" S FHP=0
"RTN","FHSP1",9,0)
 E  K DIC S DIC="^FH(119.72,",DIC(0)="EMQ" D ^DIC G:Y<1 D0 S FHP=+Y
"RTN","FHSP1",10,0)
D2 R !!,"Select Meal (B,N,E,or ALL): ",MEAL:DTIME G:'$T!(U[MEAL) KIL S X=MEAL D TR^FH S MEAL=X S:$P("ALL",MEAL,1)="" MEAL="A"
"RTN","FHSP1",11,0)
 I "BNEA"'[MEAL!(MEAL'?1U) W *7,!,"Enter B for Breakfast, N for Noon, E for Evening or ALL for all meals" G D2
"RTN","FHSP1",12,0)
 S D3="" G:FHOPT=2 D5
"RTN","FHSP1",13,0)
D3 R !!,"Consolidated List Only? Y//",X:DTIME G:'$T!(X="^") KIL S:X="" X="Y" D TR^FH I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7,"  Answer YES or NO" G D3
"RTN","FHSP1",14,0)
 S X=$E(X,1),D3=1 S:X="Y" D3=D3+1
"RTN","FHSP1",15,0)
D5 W:'D3 !!,"Place Labels in Printer"
"RTN","FHSP1",16,0)
PR K IOP S %ZIS="MQ",%ZIS("A")="Select "_$S('D3:"LABEL",1:"LIST")_" Printer: " W ! D ^%ZIS K %ZIS,IOP G:POP KIL
"RTN","FHSP1",17,0)
 I $D(IO("Q")) S FHPGM="Q1^FHSP1",FHLST="D3^FHOPT^FHP^MEAL" D EN2^FH G KIL
"RTN","FHSP1",18,0)
 U IO D Q1 D ^%ZISC K %ZIS,IOP G KIL
"RTN","FHSP1",19,0)
Q1 ; Print Standing Orders List or Labels
"RTN","FHSP1",20,0)
 K ^TMP($J),C,D,N S (CHK,N1,PG)=0 D NOW^%DTC S NOW=%,DT=%\1
"RTN","FHSP1",21,0)
 S COUNT=0,LINE=1,DTP=NOW D DTP^FH S DTR=DTP
"RTN","FHSP1",22,0)
 I FHOPT=2 S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1
"RTN","FHSP1",23,0)
 I MEAL="A" S MEAL="B" D Q2 S MEAL="N" D Q2 S MEAL="E"
"RTN","FHSP1",24,0)
 D Q2
"RTN","FHSP1",25,0)
 I $G(LAB)>2 D DPLL^FHLABEL Q
"RTN","FHSP1",26,0)
 F L=1:1:$S('D3:18,1:1) W !
"RTN","FHSP1",27,0)
 Q
"RTN","FHSP1",28,0)
Q2 S T0=NOW\1_$S(MEAL="B":".07",MEAL="N":".11",1:".17"),TT=0
"RTN","FHSP1",29,0)
 F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  D DP I DP'="" D P0 F DFN=0:0 S DFN=$O(^FHPT("AW",W1,DFN)) Q:DFN<1  S ADM=^(DFN) D ADD
"RTN","FHSP1",30,0)
 G:FHOPT=2 ^FHSP11
"RTN","FHSP1",31,0)
 S DTP=DT D DTP^FH S DTE=DTP_" "_$S(MEAL="B":"Break",MEAL="N":"Noon",1:"Even")
"RTN","FHSP1",32,0)
 G:D3=2 CON
"RTN","FHSP1",33,0)
 K S F K=0:0 S K=$O(D(K)) Q:K=""  S X=$G(^FH(119.72,K,0)),N2=$P(X,"^",1),N3=$P(X,"^",4) S:N3="" N3=$E(N2,1,6) S S(N3,K)=$E(N3,1,6)
"RTN","FHSP1",34,0)
 S A1="" F  S A1=$O(S(A1)) Q:A1=""  F K=0:0 S K=$O(S(A1,K)) Q:K=""  S N2=$G(S(A1,K)) D LST
"RTN","FHSP1",35,0)
 K C,D,N Q
"RTN","FHSP1",36,0)
ADD Q:ADM<1
"RTN","FHSP1",37,0)
 D CHK I K2 F K2=0:0 S K2=$O(^FHPT("ASP",DFN,ADM,K2)) Q:K2<1  S Y=^FHPT(DFN,"A",ADM,"SP",K2,0) D A1
"RTN","FHSP1",38,0)
 Q
"RTN","FHSP1",39,0)
A1 S Y=$P(Y,"^",2,3)_"^"_$P(Y,"^",8) Q:Y?."^"  I FHOPT=2 S Y=Y_"^"_IS,RM=$G(^DPT(DFN,.101)),WRD=P0_$E(WRDN,1,27-$L(RM))_"/"_RM,^TMP($J,"SOL",SP,WRD,DFN,K2)=Y Q
"RTN","FHSP1",40,0)
 S FHORD=$P(Y,"^",1),M1=$P(Y,"^",2)
"RTN","FHSP1",41,0)
 I FHORD,M1[MEAL S:'$D(N(FHORD,SP)) N(FHORD,SP)=0 S Q=$P(Y,"^",3),N(FHORD,SP)=N(FHORD,SP)+$S(Q:Q,1:1) S:'$D(C(MEAL,SP)) C(MEAL,SP)=0 I TT'=DFN S C(MEAL,SP)=C(MEAL,SP)+1,TT=DFN
"RTN","FHSP1",42,0)
 Q
"RTN","FHSP1",43,0)
CHK S K2=0,X1=$G(^FHPT(DFN,"A",ADM,0)),FHORD=$P(X1,"^",2),IS=$P(X1,"^",10),X1=$P(X1,"^",3) G:FHORD<1 C1
"RTN","FHSP1",44,0)
 I IS S IS=$P($G(^FH(119.4,IS,0)),"^",3) S:IS'="N" IS=""
"RTN","FHSP1",45,0)
 I X1>1,X1'>T0 G C2
"RTN","FHSP1",46,0)
C0 I '$D(^FHPT(DFN,"A",ADM,"DI",FHORD,0)) G C2
"RTN","FHSP1",47,0)
 S X1=$P(^FHPT(DFN,"A",ADM,"DI",FHORD,0),"^",8) I X1="" G C1
"RTN","FHSP1",48,0)
 S:X1="D" X1="T" Q:'$D(S(X1))  S:DP[X1 K2=1 S:K2 SP=S(X1)
"RTN","FHSP1",49,0)
C1 K FHORD,A1,K,X1 Q
"RTN","FHSP1",50,0)
C2 S A1=0 F K=0:0 S K=$O(^FHPT(DFN,"A",ADM,"AC",K)) Q:K<1!(K>T0)  S A1=K
"RTN","FHSP1",51,0)
 G:'A1 C1 S FHORD=$P(^FHPT(DFN,"A",ADM,"AC",A1,0),"^",2) G:FHORD'<1 C0 K ^FHPT(DFN,"A",ADM,"AC",A1) G C2
"RTN","FHSP1",52,0)
DP K S S DP=""
"RTN","FHSP1",53,0)
 F L=5,6 S X=$P($G(^FH(119.6,W1,0)),"^",L) I X=FHP!('FHP) S:X S($E("TC",L-4))=X,D(X)="",DP=DP_$E("TC",L-4)
"RTN","FHSP1",54,0)
 Q
"RTN","FHSP1",55,0)
P0 S X=^FH(119.6,W1,0),P0=$P(X,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0),WRDN=$P(X,"^",1) Q
"RTN","FHSP1",56,0)
LST D HDR1 S NX="" F  S NX=$O(^FH(118.3,"B",NX)) Q:NX=""  F KK=0:0 S KK=$O(^FH(118.3,"B",NX,KK)) Q:KK<1  S Z=$G(N(KK,K)) D:$Y>(IOSL-6) HDR1 I Z W !?(80-30\2),$J(Z,6)," ",$P(^FH(118.3,KK,0),"^",1)
"RTN","FHSP1",57,0)
 S N1=N1+$G(C(MEAL,K))
"RTN","FHSP1",58,0)
 D PP S N1=0 Q
"RTN","FHSP1",59,0)
CON K S S L1=36
"RTN","FHSP1",60,0)
 F K=0:0 S K=$O(D(K)) Q:K=""  S X=^FH(119.72,K,0),N2=$P(X,"^",1),N3=$P(X,"^",4) S:N3="" N3=$E(N2,1,6) S S(N3,K)=$J(N3,8),L1=L1+8
"RTN","FHSP1",61,0)
 S:L1<80 L1=80 D HDR
"RTN","FHSP1",62,0)
 S NX="" F  S NX=$O(^FH(118.3,"B",NX)) Q:NX=""  F KK=0:0 S KK=$O(^FH(118.3,"B",NX,KK)) Q:KK<1  I $D(N(KK)) D SOR
"RTN","FHSP1",63,0)
 W !!,"# OF PATIENTS",?31
"RTN","FHSP1",64,0)
 S X="" F  S X=$O(S(X)) Q:X=""  F K=0:0 S K=$O(S(X,K)) Q:K=""  S Z=$G(C(MEAL,K)) W $S(Z:$J(Z,6),1:$J("",6)),"  " S N1=N1+Z
"RTN","FHSP1",65,0)
 W $S(N1:$J(N1,6),1:$J("",6))
"RTN","FHSP1",66,0)
 S N1=0 K C,D,N Q
"RTN","FHSP1",67,0)
SOR D:$Y>(IOSL-6) HDR
"RTN","FHSP1",68,0)
 W !,$P($G(^FH(118.3,KK,0)),"^",1),?31
"RTN","FHSP1",69,0)
 S Z1=0,X="" F  S X=$O(S(X)) Q:X=""  F K=0:0 S K=$O(S(X,K)) Q:K=""  S Z=$G(N(KK,K)) W $S(Z:$J(Z,6),1:$J("",6)),"  " S Z1=Z1+Z
"RTN","FHSP1",70,0)
 W $S(Z1:$J(Z1,6),1:$J("",6))
"RTN","FHSP1",71,0)
 Q
"RTN","FHSP1",72,0)
PP W !!?(80-21\2),"**** PATIENTS = ",N1," ****",! Q
"RTN","FHSP1",73,0)
HDR ; Header for Consolidated List
"RTN","FHSP1",74,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHSP1",75,0)
 W !,DTR,?(L1-11),"Page ",PG,!!?(L1-55\2),"C O N S O L I D A T E D   S T A N D I N G   O R D E R S",!!?(L1-$L(DTE)\2),DTE,!!?29
"RTN","FHSP1",76,0)
 S X="" F  S X=$O(S(X)) Q:X=""  F K=0:0 S K=$O(S(X,K)) Q:K=""  W S(X,K)
"RTN","FHSP1",77,0)
 W "   TOTAL",! Q
"RTN","FHSP1",78,0)
HDR1 ; Header for Standing Order List
"RTN","FHSP1",79,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1 W !,DTR,?69,"Page ",PG,!!?20,"S T A N D I N G   O R D E R S   L I S T"
"RTN","FHSP1",80,0)
 W !?(80-$L(N2)\2),N2,!?(80-$L(DTE)\2),DTE,! Q
"RTN","FHSP1",81,0)
KIL K ^TMP($J) G KILL^XUSCLEAN
"RTN","FHSP11")
0^11^B5075383
"RTN","FHSP11",1,0)
FHSP11 ; HISC/NCA,RTK - Print Standing Orders Labels ;2/26/96  09:59
"RTN","FHSP11",2,0)
 ;;5.0;Dietetics;**2,38**;Mar 25, 1996
"RTN","FHSP11",3,0)
 K ^TMP($J,"NAME") F NX=0:0 S NX=$O(^FH(118.3,NX)) Q:NX<1  S Y=^(NX,0),N1=$P(Y,"^",1) I '$D(^FH(118.3,NX,"I")) S ^TMP($J,"NAME",NX)=$P(Y,"^",1)
"RTN","FHSP11",4,0)
 D P1
"RTN","FHSP11",5,0)
 Q
"RTN","FHSP11",6,0)
P1 S DTP=DT D DTP^FH S DTE=DTP_" "_$S(MEAL="B":"BREAK",MEAL="N":"NOON",1:"EVEN"),S1=$S(LAB=1:6,1:9),S2=LAB=2*5+33
"RTN","FHSP11",7,0)
 F SP=0:0 S SP=$O(^TMP($J,"SOL",SP)) Q:SP<1  D P2
"RTN","FHSP11",8,0)
 Q
"RTN","FHSP11",9,0)
P2 S WRD="" F  S WRD=$O(^TMP($J,"SOL",SP,WRD)) Q:WRD=""  D P3
"RTN","FHSP11",10,0)
 Q
"RTN","FHSP11",11,0)
P3 F DFN=0:0 S DFN=$O(^TMP($J,"SOL",SP,WRD,DFN)) Q:DFN<1  D PID^FHDPA,P4
"RTN","FHSP11",12,0)
 Q
"RTN","FHSP11",13,0)
P4 F FHL=0:0 S FHL=$O(^TMP($J,"SOL",SP,WRD,DFN,FHL)) Q:FHL<1  D P5
"RTN","FHSP11",14,0)
 Q
"RTN","FHSP11",15,0)
P5 S Y=^(FHL)
"RTN","FHSP11",16,0)
 S IS=$P(Y,"^",4),FHORD=$P(Y,"^",1) Q:'FHORD  S M1=$P(Y,"^",2) Q:M1'[MEAL  S Q=$P(Y,"^",3) S:'Q Q=1
"RTN","FHSP11",17,0)
 Q:$P($G(^FH(118.3,+FHORD,0)),"^",2)'="Y"  S NAM=$P(^DPT(DFN,0),"^",1)
"RTN","FHSP11",18,0)
 I LAB>2 D LL Q
"RTN","FHSP11",19,0)
 W !,$E(NAM,1,S2-$L(WRD)),?(S2+2-$L(WRD)),$E(WRD,3,99),!?$S(LAB=1:3,1:0),BID W:IS'="" ?(S2-22),"*NURSE" W ?(S2-15),DTE S LN=2 I LAB=2 W !! S LN=4
"RTN","FHSP11",20,0)
 W !,$J(Q,2)," ",$S($D(^TMP($J,"NAME",FHORD)):$P(^TMP($J,"NAME",FHORD),"^",1),$D(^FH(118.3,+FHORD,0)):$P(^(0),"^",1),1:"") S LN=LN+1
"RTN","FHSP11",21,0)
 I LN<S1 F L=LN+1:1:S1 W !
"RTN","FHSP11",22,0)
 Q
"RTN","FHSP11",23,0)
LL ;
"RTN","FHSP11",24,0)
 S FHTAB=$S(LAB=3:24,1:37)
"RTN","FHSP11",25,0)
 S NAM=$E(NAM,1,FHTAB-$L(WRD)),BIDIS=BID I IS="N" S BIDIS=BID_" *NURSE"
"RTN","FHSP11",26,0)
 S LNA=NAM_$J(WRD,FHTAB+1-$L(NAM)),LNB=BIDIS_$J(DTE,FHTAB+1-$L(BIDIS))
"RTN","FHSP11",27,0)
 S LNC=$J(Q,2)_" "_$P($G(^FH(118.3,+FHORD,0)),U,1)
"RTN","FHSP11",28,0)
 I LAB=3 S (PCL1,PCL4,PCL6)="",PCL2=LNA,PCL3=LNB,PCL5=LNC
"RTN","FHSP11",29,0)
 I LAB=4 S (PCL1,PCL2,PCL5,PCL7,PCL8)="",PCL3=LNA,PCL4=LNB,PCL6=LNC
"RTN","FHSP11",30,0)
 D:LAB=3 LL3^FHLABEL D:LAB=4 LL4^FHLABEL
"RTN","FHSP11",31,0)
 Q
"RTN","FHWOR1")
0^16^B3354714
"RTN","FHWOR1",1,0)
FHWOR1 ; HISC/REL/NCA - HL7 Additional Orders ;10/10/00  14:55
"RTN","FHWOR1",2,0)
 ;;5.0;Dietetics;**6,28,38**;Oct 11, 1995
"RTN","FHWOR1",3,0)
ADD ; Add new Order
"RTN","FHWOR1",4,0)
 S COM=$E(COM,1,160) D ORD^FHORO S $P(^FHPT(DFN,"A",ADM,"OO",FHDR,0),"^",8)=+FHORN
"RTN","FHWOR1",5,0)
 S FILL="A"_";"_ADM_";"_FHDR_";"_COM K COM,FHDR
"RTN","FHWOR1",6,0)
 D SEND^FHWOR Q
"RTN","FHWOR1",7,0)
CAN ; Process Cancel/Discontinue Order from OE/RR
"RTN","FHWOR1",8,0)
 S FHDR=+$P(FILL,";",3) I 'FHDR S TXT="No Filler Number." D CERR^FHWOR Q
"RTN","FHWOR1",9,0)
 D GADM^FHWORR
"RTN","FHWOR1",10,0)
F0 I '$D(^FHPT(DFN,"A",+ADM,"OO",+FHDR,0)) S TXT="Additional Order not on file." D CERR^FHWOR Q
"RTN","FHWOR1",11,0)
 S Y=^FHPT(DFN,"A",ADM,"OO",FHDR,0)
"RTN","FHWOR1",12,0)
 I +FHORN'=$P(Y,"^",8) S TXT="Order Number Not Matching." D CERR^FHWOR Q
"RTN","FHWOR1",13,0)
 D NOW^%DTC S $P(^FHPT(DFN,"A",ADM,"OO",FHDR,0),"^",5,7)="X^"_%_"^"_DUZ
"RTN","FHWOR1",14,0)
 K ^FHPT("AOO",DFN,ADM,FHDR) S EVT="O^C^"_FHDR D ^FHORX K %,FHDR,Y
"RTN","FHWOR1",15,0)
 D CSEND^FHWOR Q
"RTN","FHWOR1",16,0)
AO ; Code Additional Orders
"RTN","FHWOR1",17,0)
 K MSG S FILL="A"_";"_ADM_";"_FHDR_";"_COM
"RTN","FHWOR1",18,0)
 S SDT=NOW D SET
"RTN","FHWOR1",19,0)
 ; Code MSH, PID, and PV1
"RTN","FHWOR1",20,0)
 D MSH^FHWOR
"RTN","FHWOR1",21,0)
 ; code ORC
"RTN","FHWOR1",22,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_SDT_"|||"_DUZ_"||"_DUZ_"|||"_NOW
"RTN","FHWOR1",23,0)
 ; Code ODS
"RTN","FHWOR1",24,0)
 S MSG(5)="ODS|D||^^^FH-6^Additional Order^99OTH|"_COM
"RTN","FHWOR1",25,0)
 K FILL,FHWRD,HOSP,RM,SITE,SDT
"RTN","FHWOR1",26,0)
 Q
"RTN","FHWOR1",27,0)
SET ; Set Date/Time in HL7 format
"RTN","FHWOR1",28,0)
 S:SDT SDT=$$FMTHL7^XLFDT(SDT)
"RTN","FHWOR1",29,0)
 S:NOW NOW=$$FMTHL7^XLFDT(NOW)
"RTN","FHWOR1",30,0)
 Q
"RTN","FHWOR1",31,0)
NA ; OE/RR Number Assign
"RTN","FHWOR1",32,0)
 S FHDR=+$P(FILL,";",3) G:'FHDR KIL S:ADM'=$P(FILL,";",2) ADM=$P(FILL,";",2)
"RTN","FHWOR1",33,0)
 G:'+FHORN KIL
"RTN","FHWOR1",34,0)
 S $P(^FHPT(DFN,"A",ADM,"OO",FHDR,0),"^",8)=+FHORN
"RTN","FHWOR1",35,0)
KIL K FHDR,MSG,FHORN Q
"RTN","FHWOR2")
0^15^B19233195
"RTN","FHWOR2",1,0)
FHWOR2 ; HISC/NCA - HL7 Diet Order ;11/22/00  11:05
"RTN","FHWOR2",2,0)
 ;;5.0;Dietetics;**6,28,27,35,38**;Oct 11, 1995
"RTN","FHWOR2",3,0)
 S (DATE,D1)=SDT I DATE="" S TXT="No Start Date." D ERR^FHWOR Q
"RTN","FHWOR2",4,0)
 D NOW^%DTC D CVT^FHWOR S D1=DATE
"RTN","FHWOR2",5,0)
 S (DATE,D2)=EDT
"RTN","FHWOR2",6,0)
 I DATE D CVT^FHWOR S D2=DATE
"RTN","FHWOR2",7,0)
 I D2,D1>D2 S TXT="Wrong Stop Date." D ERR^FHWOR Q
"RTN","FHWOR2",8,0)
 S DATE=NOW D CVT^FHWOR S NOW=DATE
"RTN","FHWOR2",9,0)
 S FHRDER=+FHORN
"RTN","FHWOR2",10,0)
 I D1<% S D1=%
"RTN","FHWOR2",11,0)
 K DI S N1=0 F K=5:1 S X=$G(FHMSG(K)) Q:X=""  D
"RTN","FHWOR2",12,0)
 .I $E(X,1,3)'="ODS" S TXT="Msg Error." Q
"RTN","FHWOR2",13,0)
 .S TYP=$E($P(X,"|",2),2) I TYP="" S TXT="No Type of Service." Q
"RTN","FHWOR2",14,0)
 .I "TCD"'[TYP S TXT="Wrong Type of Tray." Q
"RTN","FHWOR2",15,0)
 .S DIET=$P(X,"|",4),Y=$P(DIET,"^",4),FILE=$P(DIET,"^",6),COM=$E($P(X,"|",5),1,80)
"RTN","FHWOR2",16,0)
 .I $E(FILE,1,5)'="99FHD" S TXT="Msg Error." Q
"RTN","FHWOR2",17,0)
 .S PREC=$P($G(^FH(111,+Y,0)),"^",4) I $D(DI(PREC)) S TXT="Msg Error." Q
"RTN","FHWOR2",18,0)
 .S N1=N1+1,DI(PREC)=Y_"^"_$G(^FH(111,+Y,0)) Q
"RTN","FHWOR2",19,0)
 I TXT'="" D ERR^FHWOR Q
"RTN","FHWOR2",20,0)
 I N1>1 D  I CHK S TXT="Can not order REGULAR with another Diet." D ERR^FHWOR Q
"RTN","FHWOR2",21,0)
 .S CHK=0 F D0=0:0 S D0=$O(DI(D0)) Q:D0=""  I +DI(D0)=1 S CHK=1 Q
"RTN","FHWOR2",22,0)
 I N1>5 S TXT="Can not order more than 5 Diets." D ERR^FHWOR Q
"RTN","FHWOR2",23,0)
 S D4=0,FHOR="^^^^",FHEVTX="",N1=0 F D0=0:0 S D0=$O(DI(D0)) Q:D0<1  S N1=N1+1,$P(FHOR,"^",N1)=+DI(D0),FHEVTX=FHEVTX_", "_$P(DI(D0),"^",8) S:$P(DI(D0),"^",7)="Y" D4=1
"RTN","FHWOR2",24,0)
 S FHLD=""
"RTN","FHWOR2",25,0)
 I '$O(^FH(111.1,"AB",FHOR,0)),$P($G(^FH(119.9,1,4)),"^",2)="Y" S EVT="M^O^^No Diet Pattern ("_$E(FHEVTX,3,999)_")" D ^FHORX
"RTN","FHWOR2",26,0)
 ; Process PROC
"RTN","FHWOR2",27,0)
 D PROC^FHORD1
"RTN","FHWOR2",28,0)
 S CAN=$$CANCEL^ORCDFH(FHRDER)
"RTN","FHWOR2",29,0)
 I CAN S FHTF=$P($G(^FHPT(DFN,"A",ADM,0)),"^",4) D:FHTF ORCAN^FHWOR5 K FHRDER
"RTN","FHWOR2",30,0)
 K FHRDER G KIL
"RTN","FHWOR2",31,0)
CAN ; Process Cancel or Discontinue
"RTN","FHWOR2",32,0)
 S FHORD=$P(FILL,";",3) I 'FHORD D CSEND^FHWOR Q
"RTN","FHWOR2",33,0)
 D GADM^FHWORR
"RTN","FHWOR2",34,0)
 S FHREA=$P(DATA,"|",17),FHREA=$P(FHREA,"^",5) I FHREA="Discharge" D DIS^FHWOR4,CSEND^FHWOR K FHREA Q
"RTN","FHWOR2",35,0)
 D NC
"RTN","FHWOR2",36,0)
 D CSEND^FHWOR
"RTN","FHWOR2",37,0)
 D KIL^FHORD3 Q
"RTN","FHWOR2",38,0)
NC ; Cancel Diet Order
"RTN","FHWOR2",39,0)
 D NOW^%DTC S NOW=% S OLD=""
"RTN","FHWOR2",40,0)
 I '$D(^FHPT(DFN,"A",+ADM,"DI",+FHORD,0)) Q
"RTN","FHWOR2",41,0)
 I $P($G(^FHPT(DFN,"A",ADM,"DI",+FHORD,0)),"^",19)'="" Q
"RTN","FHWOR2",42,0)
 S NSTR=0 F KK=0:0 S KK=$O(^FHPT(DFN,"A",ADM,"AC",KK)) Q:KK<1!(KK'<NOW)  S NSTR=KK
"RTN","FHWOR2",43,0)
 F KK=NSTR-.000001:0 S KK=$O(^FHPT(DFN,"A",ADM,"AC",KK)) Q:KK<1  I $P(^(KK,0),"^",2)=FHORD G F1
"RTN","FHWOR2",44,0)
 Q
"RTN","FHWOR2",45,0)
F1 D T0^FHORD3
"RTN","FHWOR2",46,0)
 Q
"RTN","FHWOR2",47,0)
DO ; Code Diet Orders
"RTN","FHWOR2",48,0)
 K MSG S FILL=$G(FHNEW)
"RTN","FHWOR2",49,0)
 S SDT=D1,DATE1="" D SET
"RTN","FHWOR2",50,0)
 ; Code MSH, PID, and PV1
"RTN","FHWOR2",51,0)
 D MSH^FHWOR
"RTN","FHWOR2",52,0)
 ; code ORC
"RTN","FHWOR2",53,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^^^"_SDT_"^"_DATE1_"|||"_DUZ_"||"_DUZ_"|||"_DATE
"RTN","FHWOR2",54,0)
 ; Code ODS
"RTN","FHWOR2",55,0)
 F A1=5:1 S A2=$P(FHOR,"^",A1-4) Q:'A2  D
"RTN","FHWOR2",56,0)
 .;S MSG(A1)="ODS|ZT||^^^"_A2_"^"_$P($G(^FH(111,+A2,0)),"^",1)_"^99FHD" Q
"RTN","FHWOR2",57,0)
 .I $G(TYP)="" S TYP="T"
"RTN","FHWOR2",58,0)
 .S MSG(A1)="ODS|Z"_TYP_"||^^^"_A2_"^"_$P($G(^FH(111,+A2,0)),"^",1)_"^99FHD" Q
"RTN","FHWOR2",59,0)
 K DATE,DATE1,FILL,FHWRD,HOSP,RM,SITE,SDT,VAL
"RTN","FHWOR2",60,0)
 Q
"RTN","FHWOR2",61,0)
SET ; Set Date/Time in HL7 format
"RTN","FHWOR2",62,0)
 S:SDT SDT=$$FMTHL7^XLFDT(SDT)
"RTN","FHWOR2",63,0)
 S:NOW DATE=$$FMTHL7^XLFDT(NOW)
"RTN","FHWOR2",64,0)
 S:D2 DATE1=$$FMTHL7^XLFDT(D2) S:'DATE1 DATE1=""
"RTN","FHWOR2",65,0)
 Q
"RTN","FHWOR2",66,0)
KIL ; Kill
"RTN","FHWOR2",67,0)
 G KIL^FHORD1
"RTN","FHWOR2",68,0)
CODE ; Code Cancel/Discontinue Diet Order Status Change
"RTN","FHWOR2",69,0)
 K MSG N ACT,FILL S FILL=$G(FHMSG1) S ACT=$S(FHSTS=6:"IP",FHSTS=8:"SC",FHSTS=1:"DC",1:"") Q:ACT=""  D SITE^FH
"RTN","FHWOR2",70,0)
 ; code MSH
"RTN","FHWOR2",71,0)
 S MSG(1)="MSH|^~\&|DIETETICS|"_SITE(1)_"|||||"_$S($D(FHORR):"ORR",1:"ORM")
"RTN","FHWOR2",72,0)
 ; code PID
"RTN","FHWOR2",73,0)
 S MSG(2)="PID|||"_DFN_"||"_$P($G(^DPT(DFN,0)),"^",1)
"RTN","FHWOR2",74,0)
 ; code ORC
"RTN","FHWOR2",75,0)
 S DATE=$S(FHDAT'="":$P(FHDAT,"^",1),1:"")
"RTN","FHWOR2",76,0)
 I DATE S DATE=$$FMTHL7^XLFDT(DATE) S $P(FHDAT,"^",1)=DATE
"RTN","FHWOR2",77,0)
 S DATE=$S(FHDAT'="":$P(FHDAT,"^",2),1:"")
"RTN","FHWOR2",78,0)
 I DATE S DATE=$$FMTHL7^XLFDT(DATE) S $P(FHDAT,"^",2)=DATE
"RTN","FHWOR2",79,0)
 S MSG(3)="ORC|"_$S($D(FHORR):"SR",1:"SC")_"|"_FHORN_"^OR|"_FILL_"^FH||"_ACT
"RTN","FHWOR2",80,0)
 I FHDAT'="" S MSG(3)=MSG(3)_"||^^^"_FHDAT
"RTN","FHWOR2",81,0)
 I ACT="DC" S MSG(3)=MSG(3)_"|||"_$S($D(FHPV):FHPV,1:"")_"||"_$S($D(FHPV):FHPV,1:"")
"RTN","FHWOR2",82,0)
 K ACT,DATE,FHORR,FILL,SITE,WKDAYS Q
"RTN","FHWOR2",83,0)
NA ; OE/RR Number Assign
"RTN","FHWOR2",84,0)
 S FHORD=+$P(FILL,";",3) S:ADM'=$P(FILL,";",2) ADM=$P(FILL,";",2)
"RTN","FHWOR2",85,0)
 S $P(^FHPT(DFN,"A",ADM,"DI",FHORD,0),"^",14)=+FHORN Q
"RTN","FHWOR2",86,0)
EL ; Late Trays HL7 to OE/RR
"RTN","FHWOR2",87,0)
 K MSG S WKDAYS="",(EDT,SDT)=DTE
"RTN","FHWOR2",88,0)
 S ITVL="ONCE",WKD="",SERV="L"
"RTN","FHWOR2",89,0)
 S FILL="E"_";"_ADM_";;"_SDT_";"_EDT_";"_WKD_";"_MEAL_";"_TIM_";"_BAG
"RTN","FHWOR2",90,0)
 D SET^FHWOR3
"RTN","FHWOR2",91,0)
 ; Code MSH, PID, and PV1
"RTN","FHWOR2",92,0)
 D MSH^FHWOR
"RTN","FHWOR2",93,0)
 ; code ORC
"RTN","FHWOR2",94,0)
 S MSG(4)="ORC|SN||"_FILL_"^FH||||^"_ITVL_"^^"_SDT_"^"_EDT_"|||"_DUZ_"||"_DUZ_"|||"_NOW
"RTN","FHWOR2",95,0)
 ; code ODT
"RTN","FHWOR2",96,0)
 S MSG(5)="ODT|"_$S(SERV="E":"EARLY",1:"LATE")_"|^^^"_MEAL_SERV_NUM_"^^99FHS|"_$S(BAG="Y":"bagged",1:"")
"RTN","FHWOR2",97,0)
 K FHWARD,FILL,HOSP,ITVL,FHORN,RM,SITE,WARD,WKDAYS,Z
"RTN","FHWOR2",98,0)
 Q
"RTN","FHWOR51")
0^17^B8838321
"RTN","FHWOR51",1,0)
FHWOR51 ; HISC/NCA - HL7 Tubefeeding (Cont.) ;6/28/96  16:28
"RTN","FHWOR51",2,0)
 ;;5.0;Dietetics;**6,15,38**;Oct 11, 1995
"RTN","FHWOR51",3,0)
 I $E(DATA,1,3)'="ODS" S TXT="Message 5 not ODS as expected." Q
"RTN","FHWOR51",4,0)
 S TYP=$P(DATA,"|",2)
"RTN","FHWOR51",5,0)
 I TYP'="ZE" S TXT="Type of Diet Order not ZE as expected." Q
"RTN","FHWOR51",6,0)
 I $E(DATA1,1,3)'="ZQT" S TXT="Message not ZQT as expected." Q
"RTN","FHWOR51",7,0)
 S QUA=$P(DATA1,"|",3),A1=+QUA,A2=$E($P(QUA,"&",2),1),A3=$P(QUA,"^",2),FDG=$P(QUA,"^",3)
"RTN","FHWOR51",8,0)
 S (TC,TK,TP,TW)=0
"RTN","FHWOR51",9,0)
 S X=A1_A2_"/"_A3
"RTN","FHWOR51",10,0)
 I FDG'="","XH"'[$E(FDG,1) S FDG=""
"RTN","FHWOR51",11,0)
 S:'$E(FDG,2,99) FDG=""
"RTN","FHWOR51",12,0)
 I FDG'="" S X=X_$S($E(FDG,1)="H":"X"_$E(FDG,2,99),1:FDG_"F")
"RTN","FHWOR51",13,0)
 S QUA=X,A2=A2_"/"_$P(QUA,"/",2)
"RTN","FHWOR51",14,0)
 S DIET=$P(DATA,"|",4),DIET=$E(DIET,4,$L(DIET)),TFCOM=$E($P(DATA,"|",5),1,160)
"RTN","FHWOR51",15,0)
 S TT=+$P(DIET,"-",1) I 'TT S TXT="No internal entry number in coded identifier." Q
"RTN","FHWOR51",16,0)
 S STR=+$P(DIET,"-",2) I 'STR S TXT="No Tubefeeding Product Strength." Q
"RTN","FHWOR51",17,0)
 I $E($P(DIET,"^",3),1,5)'="99FHT" S TXT="No 99FHT code."
"RTN","FHWOR51",18,0)
 S T(0)=$G(^FH(118.2,+TT,0))
"RTN","FHWOR51",19,0)
 S A3=$P(A2,"/",2),A2=$P(A2,"/",1)
"RTN","FHWOR51",20,0)
 I $E($P(T(0),"^",3),$L($P(T(0),"^",3)))?1"G" S:$E(A2,1)'="G" A1=A1*+$P(T(0),"^",3),A2="GRAM"
"RTN","FHWOR51",21,0)
 F K=1:1:11 S S1=$P("KCAL CC ML OZ UNITS BOTTLES CANS PKG TBSP GMS GRAMS"," ",K) G:$P(S1,A2,1)="" F3
"RTN","FHWOR51",22,0)
 G ERR
"RTN","FHWOR51",23,0)
F3 S S1=$S(K=1:1,K<4:2,K=4:3,K=9:5,K>9:6,1:4),A2=$P(A3,"X",1),A3=$P(A3,"X",2)
"RTN","FHWOR51",24,0)
 G:A2'?1U.E ERR I $L(A2)=1,"DH"'[A2 G ERR
"RTN","FHWOR51",25,0)
 S S2=$F("DAY QD QH HOUR HR BID TID Q2H Q3H Q4H Q6H QID",A2) G:'S2 ERR S S2=$S(S2<8:1,S2<19:2,S2<23:3,S2<27:4,S2<31:5,S2<35:6,S2<39:7,1:8)
"RTN","FHWOR51",26,0)
 S QUA=A1_" "_$P("KCAL CC OZ UNITS TBSP GM"," ",S1),QUA=QUA_" "_$P($T(F6),";",S2+2)
"RTN","FHWOR51",27,0)
 S:A3'="" QUA=QUA_" X "_(+A3)_" "_$S(A3["F":"fdgs",1:"hrs")
"RTN","FHWOR51",28,0)
 I S1=1 S DX=$P(T(0),"^",4) G:'DX ERR  S TK=A1,TC=A1/DX*$S(STR=4:1,STR=3:1.333,STR=2:2,1:4)
"RTN","FHWOR51",29,0)
 I S1=4 S DX=+$P(T(0),"^",3) G:'DX ERR S TC=A1*DX*$S(STR=4:1,STR=3:1.333,STR=2:2,1:4)
"RTN","FHWOR51",30,0)
 S:S1=2 TC=A1 S:S1=3 TC=A1*29.5 S:S1=5 TC=A1*15 I S1=6 S TC=0,A3=0 G C1
"RTN","FHWOR51",31,0)
CC I 'A3 S A3=$P("1,24,2,3,12,8,6,4",",",S2) G C1
"RTN","FHWOR51",32,0)
 I A3'["F" S A3=$S(S2=1:1,S2=2:A3,S2=3:2,S2=4:3,S2=5:A3\2,S2=6:A3\3,S2=7:A3\4,1:A3\6)
"RTN","FHWOR51",33,0)
 E  S:S2=1 A3=1
"RTN","FHWOR51",34,0)
C1 S TC=$J(TC*A3,0,0)
"RTN","FHWOR51",35,0)
 I TC>5000 S TXT="WARNING: Total Amount should be between 0 to 5000 cc."  Q
"RTN","FHWOR51",36,0)
 S:TC'<1 TP=$S(STR=4:TC,STR=3:TC*.75,STR=2:TC/2,1:TC/4),TP=$J(TP,0,0),TW=TC-TP
"RTN","FHWOR51",37,0)
 I S1'=1!(S1'=6) S TK="",DX=$P(T(0),"^",4) I DX S TK=DX*TP,TK=$J(TK,0,0)
"RTN","FHWOR51",38,0)
 S $P(TUN(TT),"^",1,6)=TT_"^"_STR_"^"_QUA_"^"_TP_"^"_TW_"^"_TK,NO=NO+1
"RTN","FHWOR51",39,0)
 Q
"RTN","FHWOR51",40,0)
ERR S TXT="Wrong Interval/Duration." Q
"RTN","FHWOR51",41,0)
F6 ;;per Day;per Hour;Twice a Day;Three times a Day;Every 2 Hours;Every 3 Hours;Every 4 Hours;Every 6 Hours
"UP",115,115.04,-2)
115^A
"UP",115,115.04,-1)
115.01^TF
"UP",115,115.04,0)
115.04
"UP",115,115.06,-2)
115^A
"UP",115,115.06,-1)
115.01^OO
"UP",115,115.06,0)
115.06
"UP",119.9,119.93,-1)
119.9^D
"UP",119.9,119.93,0)
119.93
"VER")
8.0^22
"^DD",115,115.04,4,0)
COMMENT^F^^0;5^K:$L(X)>160!($L(X)<1) X
"^DD",115,115.04,4,3)
Answer must be 1-160 characters in length.
"^DD",115,115.04,4,21,0)
^.001^2^2^3021030^^^^
"^DD",115,115.04,4,21,1,0)
This field contains any free-text comment entered at time
"^DD",115,115.04,4,21,2,0)
of order entry.
"^DD",115,115.04,4,"DT")
3021029
"^DD",115,115.06,2,0)
ORDER^F^^0;3^K:$L(X)>160!($L(X)<1) X
"^DD",115,115.06,2,3)
Answer must be 1-160 characters in length.
"^DD",115,115.06,2,21,0)
^.001^1^1^3021030^^^
"^DD",115,115.06,2,21,1,0)
This is the text of the order.
"^DD",115,115.06,2,"DT")
3021030
"^DD",119.9,119.93,1,0)
SIZE OF LABELS^S^1:3-1/2 x 15/16 (Single strip labels);2:4 x 1-7/16 (Single strip labels);3:2-5/8 x 1 (Laser labels - 30 labels per sheet);4:4 x 1-1/3 (Laser labels - 14 labels per sheet);^0;2^Q
"^DD",119.9,119.93,1,21,0)
^.001^7^7^3030214^^^^
"^DD",119.9,119.93,1,21,1,0)
This field indicates the size and type of label stock on the printer.
"^DD",119.9,119.93,1,21,2,0)
You may choose from the following selections:
"^DD",119.9,119.93,1,21,3,0)

"^DD",119.9,119.93,1,21,4,0)
1)  3-1/2 x 15/16 - Single strip track-fed labels.
"^DD",119.9,119.93,1,21,5,0)
2)  4 x 1-7/16    - Single strip track-fed labels.
"^DD",119.9,119.93,1,21,6,0)
3)  2-5/8 x 1 - Laser label sheets, ie AVERY 5160, 30 labels per sheet.
"^DD",119.9,119.93,1,21,7,0)
4)  4 x 1-1/3 - Laser label sheets, ie AVERY 5162, 14 labels per sheet.
"^DD",119.9,119.93,1,"DT")
3020927
**END**
**END**
