$TXT Created by GINSBERG,ELIOT at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Wednesday, 05/18/05 at 10:55
=============================================================================
Run Date: JUL 28, 2005                     Designation: IVM*2*104
Package : IVM - INCOME VERIFICATION MATCH     Priority: Mandatory
Version : 2        SEQ #89                      Status: Released
                  Compliance Date: AUG 28, 2005
=============================================================================

Associated patches: (v)IVM*2*89    <<= must be installed BEFORE `IVM*2*104'
                    (v)IVM*2*97    <<= must be installed BEFORE `IVM*2*104'

Subject: FIX ZMT SEGMENT BUILDER FOR LTC TESTS

Category: 
  - Routine

Description:
============

 Problem:
  
 If you set up an LTC Copay Exemption Means test for a prior year
 (e.g. means test date of 02/01/2004 i.e. income year 2003)
 and  transmit that message to the HEC via a HL7 message,
 then the LTC Copay Exemption Means test is transmitted to
 the HEC and inserted into the IVM master client record (300.12) and the
 IVM client income record (300.13) for the wrong income year (in this case
 2004).  Because there is no future means test for an LTC Copay Means
 Exemption test, the module to figure out the income year just uses one 
 year prior to today's date.
  
 The problem appeared in one of two ways:
 1)      An LTC Copay Exemption Test was created for the income year,
         not the correct income year of the test and
 2)      You may or may not have a duplicate record.  One
         for the incorrect income year which is a copy of the one for the 
         correct income year.
  
  
 Resolution:
  
 When creating the HL7 transmission created for a Z07 message, don't 
 transmit to the HEC if the income year doesn't match.  In addition, make 
 sure the income year is calculated correctly for LTC Copay exemptions.
  
 There is no impact to the users for this patch, however, the data on the
 HEC side will be fixed by a patch to be released after this patch and 
 DG*5.3*630 are installed.  The cleanup patch will be IVMB*2*813.
  
 This patch addresses the following New Service Request (NSR):
 -------------------------------------------------------------
 There is no NSR associated with this patch
  
  
 This patch addresses the following NOIS/Remedy ticket(s):
 ---------------------------------------------------------
 There are no NOIS/Remedy tickets associated with this patch.
  
  
 Overview of NOIS Message(s):
 ---------------------------
 Not applicable
  
  
 Test Sites:
 -----------
 Manchester, NH (Small)
 Madison, WI (Medium)
 West LA (Integrated)
  
  
        ================INSTALLATION INSTRUCTIONS =================
  
 If installed during the normal workday, it is recommended that the 
 following selection(s) in the OPTION (#19) file, and all of their 
 descendants be disabled to prevent possible conflicts while running the 
 KIDS Install. Other VISTA users will not be affected.
  
 Means Test User Menu                    [DG MEANS TEST USER MENU]
 Add a New Means Test                    [DG MEANS TEST ADD]
 Complete a Required Means Test          [DG MEANS TEST COMPLETE]
 Edit an Existing Means Test             [DG MEANS TEST EDIT]
 Copay Exemption Test User Menu          [DG CO-PAY TEST USER MENU]    
 Add a Copay Exemption Test              [DG CO-PAY TEST ADD]
 Edit an Existing Copay Exemption Test   [DG CO-PAY TEST EDIT]
 IVM BACKGROUND JOB                      [IVM BACKGROUND JOB]
 LTC Copay Exemption Test Menu             [LTC COPAY EXEMPTION TEST MENU]
  
  
  
  
 Install Time - less than 5 minutes
  
  
        ************** PRE-INSTALLATION INSTRUCTIONS **************
  
 You may wish to stop the HL7 filers prior to the install to prevent 
 possible 'No Source Errors' from occurring. No transmissions will be lost 
 if the filers are not stopped first, they will be picked up once the 
 filers are restarted.
  
  
 ***********************************************************
        
  
   1.   LOAD TRANSPORT GLOBAL 
        ---------------------
        Choose the PackMan message containing this patch and invoke the 
        INSTALL/CHECK MESSAGE PackMan option.  
              
   2.   DISABLE ROUTINE MAPPING   (DSM for Open VMS sites only) 
        -----------------------
        Disable routine mapping on all systems for the routines listed in 
        step 3 below.  
       
 NOTE:  If the routines included in this patch are not currently in 
               your mapped routine set, please skip this step.
   
   3.   COMPONENTS SENT WITH PATCH
        --------------------------
        The following is a list of the routines included in this patch.  
        The second line of each of these routines now looks like: 
   
        ;;2.0;Income Verification Match;**[patch list]**;21-Oct-94 
   
  
                            CHECK^XTSUMBLD results
  Routine name      Before Patch          After Patch       Patch List
  ============      ============          ===========       ==========
  IVMCZMT               13939904             15466823       17,53,49,58,81
                                                               89,104
  
  IVMPTRN8              11970981             11701376       9,11,19,12,21
                                                           17,24,36,37,47
                                                           48,42,34,77,76
                                                           75,79,85,89,98
                                                              56,97,104
  
         Total number of routines - 2
   
   4.   START UP KIDS 
        -------------
        Start up the Kernel Installation and Distribution System Menu 
        [XPD MAIN]: 
    
             Edits and Distribution ...  
             Utilities ...  
             Installation ...  
    
   Select Kernel Installation & Distribution System Option: INStallation 
                                                            ---
             Load a Distribution 
             Print Transport Global 
             Compare Transport Global to Current System 
             Verify Checksums in Transport Global 
             Install Package(s) 
             Restart Install of Package(s) 
             Unload a Distribution 
             Backup a Transport Global 
    
   Select Installation Option: 
    
   5.   Select Installation Option: 
        ---------------------------
        NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
               NAME, enter IVM*2.0*104):
       
        a.  Backup a Transport Global - This option will create a backup
            message of any routines exported with this patch. It will not
            backup any other changes such as DD's or templates.
        b.  Compare Transport Global to Current System - This option will
            allow you to view all changes that will be made when this patch
            is installed.  It compares all components of this patch
            (routines, DD's, templates, etc.).
        c.  Verify Checksums in Transport Global - This option will allow
            you to ensure the integrity of the routines that are in the
            transport global.
      
   6.   Select Installation Option: Install Package(s) 
                                    ----------------
        **This is the step to start the installation of this KIDS patch: 
    
 a.      Choose the Install Package(s) option to start the patch install.
 b.      When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
         YES//' answer NO (unless otherwise indicated)
        c.  When prompted 'Want to DISABLE Scheduled Options, Menu 
     Options, and Protocols? YES//' answer YES (unless otherwise
     indicated)
  
        d.  When prompted 'Enter options you wish to mark as 'Out Of
            Order':'  Enter the following options:
   
 Means Test User Menu                    [DG MEANS TEST USER MENU]
 Add a New Means Test                    [DG MEANS TEST ADD]
 Complete a Required Means Test          [DG MEANS TEST COMPLETE]
 Edit an Existing Means Test             [DG MEANS TEST EDIT]
 Copay Exemption Test User Menu          [DG CO-PAY TEST USER MENU]    
 Add a Copay Exemption Test              [DG CO-PAY TEST ADD]
 Edit an Existing Copay Exemption Test   [DG CO-PAY TEST EDIT]
 IVM BACKGROUND JOB                      [IVM BACKGROUND JOB]
 LTC Copay Exemption Test Menu             [LTC COPAY EXEMPTION TEST MENU]
  
  
  
 e.      When prompted 'Enter protocols you wish to mark as 'Out Of 
 Order':'
       press <return>.
  
   7.   REBUILD MAPPED ROUTINE(S)  (DSM for Open VMS sites only)
       -------------------------
       Optional - Include the routines distributed with this patch
       in the mapped routine set.
      
       NOTE: This step is only necessary if you performed step 2 or 
             if you wish to include the routines in your mapped set.

Routine Information:
====================

Routine Name:
  - IVMCZMT

 Before:
  +12  EN(DFN,VAFSTR,VAFMTDT,VAFTYPE,SETID,DELETE,LIMIT) ; Entry point to 
 get ZMT segment
  
 After:
  +12  EN(DFN,VAFSTR,VAFMTDT,VAFTYPE,SETID,DELETE,LIMIT)       ; Entry 
 point to get ZMT segment
  
 Before:
  +83        S MTIEN=+$$FUT^DGMTU(DFN,"",$S($G(VAFTYPE):VAFTYPE,1:1))
  +84         
 I MTIEN S NODE=$G(^DGMT(408.31,MTIEN,0)),PRIM=$G(^("PRIM")),NODE2=$
 G(^DGMT(408.31,MTIEN,2))
  
 After:
  +83        S MTIEN=""
  +84        N EC S EC=0
  +85        I VAFTYPE'=4 D
  +86        . S MTIEN=+$$FUT^DGMTU(DFN,"",$S($G(VAFTYPE):VAFTYPE,1:1))
  +87        . I MTIEN D
  +88         
 . . S NODE=$G(^DGMT(408.31,MTIEN,0)),PRIM=$G(^("PRIM")),NODE2=$G(^D
 GMT(408.31,MTIEN,2))
  +89        . . ;the FUT API works off the a XREF that is not deleted if 
  +90        . . ;the test is no longer future.  As a result, you may
  +91        . . ;pick up the wrong income year as a return.  The check 
 $E(IVMIY,1,3)+1'=$E(+NODE,1,3) must be
  +92        . . ;performed here and after the current Primary income
 test section below
  +93        . . I ($G(LIMIT)=1),($E(IVMIY,1,3)+1)'=$E(+NODE,1,3) S EC=1
  +94        . . Q
  +95        . Q
  +96        I VAFTYPE'=4,EC S (NODE,NODE2,MTIEN,PRIM)="" Q 
 "ZMT"_HLFS_$G(VAFY)
  
 Before:
  +87        I ($G(LIMIT)=1),($E(IVMIY,1,3)+1)'=$E(+NODE,1,3) S 
 (NODE,NODE2,MTIEN,PRIM)=""
  +88        ;
  
  
  
 After:
  +99         
 I 'MTIEN S MTIEN=+$$LST^DGMTU(DFN,VAFMTDT,$S($G(VAFTYPE):VAFTYPE,1:1))
  +100        
 S:(NODE="") NODE=$G(^DGMT(408.31,MTIEN,0)),PRIM=$G(^("PRIM")),NODE2
 =$G(^DGMT(408.31,MTIEN,2))
  
 Before:
  +90         
 I 'MTIEN S MTIEN=+$$LST^DGMTU(DFN,VAFMTDT,$S($G(VAFTYPE):VAFTYPE,1:1))
  +91         
 S:(NODE="") NODE=$G(^DGMT(408.31,MTIEN,0)),PRIM=$G(^("PRIM")),NODE2
 =$G(^DGMT(408.31,MTIEN,2))
  
 After:
  +104       I ($G(LIMIT)=1),($E(IVMIY,1,3)+1)'=$E(+NODE,1,3) S 
 (NODE,NODE2,MTIEN,PRIM)="" Q "ZMT"_HLFS_$G(VAFY)
  
 Before:
  +151 QUIT  Q "ZMT"_HLFS_$G(VAFY)
  
 After:
  +165 QUIT     Q "ZMT"_HLFS_$G(VAFY)

Routine Checksum:

Routine Name:
  - IVMPTRN8

 Before:
   143)           I $P(^TMP("HLS",$J,IVMCT),"^",3)=HLQ S 
 $P(^TMP("HLS",$J,IVMCT),"^",3)=$$HLDATE^HLFNC($E(IVMMTDT,1,3)-1_"0000")
   144)           ;
  
 After:
   143)           ;use IVMIY not IVMMTDT. For LTC copay exemption, IVMMTDT 
 is not correct
   144)           S $P(^TMP("HLS",$J,IVMCT),"^",3)=$$HLDATE^HLFNC(IVMIY)
   145)           ;

Routine Checksum:

=============================================================================
User Information:
Entered By  : MULLER,RICHARD                Date Entered  : OCT 20, 2004
Completed By: RUDINGER,NANCY L.             Date Completed: JUL 28, 2005
Released By : GANUS,MAUNETTE                Date Released : JUL 28, 2005
=============================================================================


Packman Mail Message:
=====================

$END TXT
