Released DG*5.3*643 SEQ #570
Extracted from mail message
**KIDS**:DG*5.3*643^

**INSTALL NAME**
DG*5.3*643
"BLD",6047,0)
DG*5.3*643^REGISTRATION^0^3050411^y
"BLD",6047,1,0)
^^2^2^3050308^
"BLD",6047,1,1,0)
This patch is to modify the census routines to include care provided at 
"BLD",6047,1,2,0)
non-VA facilities.
"BLD",6047,4,0)
^9.64PA^^
"BLD",6047,"KRN",0)
^9.67PA^8989.52^19
"BLD",6047,"KRN",.4,0)
.4
"BLD",6047,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",6047,"KRN",.4,"NM",1,0)
DGPT FEE BASIS    FILE #45.85^45.85^0
"BLD",6047,"KRN",.4,"NM","B","DGPT FEE BASIS    FILE #45.85",1)

"BLD",6047,"KRN",.401,0)
.401
"BLD",6047,"KRN",.401,"NM",0)
^9.68A^1^1
"BLD",6047,"KRN",.401,"NM",1,0)
DGPT FEE BASIS    FILE #45.85^45.85^0
"BLD",6047,"KRN",.401,"NM","B","DGPT FEE BASIS    FILE #45.85",1)

"BLD",6047,"KRN",.402,0)
.402
"BLD",6047,"KRN",.403,0)
.403
"BLD",6047,"KRN",.5,0)
.5
"BLD",6047,"KRN",.84,0)
.84
"BLD",6047,"KRN",3.6,0)
3.6
"BLD",6047,"KRN",3.8,0)
3.8
"BLD",6047,"KRN",9.2,0)
9.2
"BLD",6047,"KRN",9.8,0)
9.8
"BLD",6047,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",6047,"KRN",9.8,"NM",1,0)
DGPTCR^^0^B39825200
"BLD",6047,"KRN",9.8,"NM",2,0)
DGPTC1^^0^B24771658
"BLD",6047,"KRN",9.8,"NM",3,0)
DGPTC2^^0^B10137147
"BLD",6047,"KRN",9.8,"NM",4,0)
DGPTF2^^0^B16520587
"BLD",6047,"KRN",9.8,"NM",5,0)
DGPTCO3^^0^B4303694
"BLD",6047,"KRN",9.8,"NM",6,0)
DGPTC^^0^B12346357
"BLD",6047,"KRN",9.8,"NM","B","DGPTC",6)

"BLD",6047,"KRN",9.8,"NM","B","DGPTC1",2)

"BLD",6047,"KRN",9.8,"NM","B","DGPTC2",3)

"BLD",6047,"KRN",9.8,"NM","B","DGPTCO3",5)

"BLD",6047,"KRN",9.8,"NM","B","DGPTCR",1)

"BLD",6047,"KRN",9.8,"NM","B","DGPTF2",4)

"BLD",6047,"KRN",19,0)
19
"BLD",6047,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",6047,"KRN",19,"NM",1,0)
DGPT FEE BASIS CENSUS STAT RPT^^0
"BLD",6047,"KRN",19,"NM",2,0)
DGPT CENSUS MENU^^2
"BLD",6047,"KRN",19,"NM","B","DGPT CENSUS MENU",2)

"BLD",6047,"KRN",19,"NM","B","DGPT FEE BASIS CENSUS STAT RPT",1)

"BLD",6047,"KRN",19.1,0)
19.1
"BLD",6047,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6047,"KRN",101,0)
101
"BLD",6047,"KRN",409.61,0)
409.61
"BLD",6047,"KRN",771,0)
771
"BLD",6047,"KRN",870,0)
870
"BLD",6047,"KRN",8989.51,0)
8989.51
"BLD",6047,"KRN",8989.52,0)
8989.52
"BLD",6047,"KRN",8994,0)
8994
"BLD",6047,"KRN","B",.4,.4)

"BLD",6047,"KRN","B",.401,.401)

"BLD",6047,"KRN","B",.402,.402)

"BLD",6047,"KRN","B",.403,.403)

"BLD",6047,"KRN","B",.5,.5)

"BLD",6047,"KRN","B",.84,.84)

"BLD",6047,"KRN","B",3.6,3.6)

"BLD",6047,"KRN","B",3.8,3.8)

"BLD",6047,"KRN","B",9.2,9.2)

"BLD",6047,"KRN","B",9.8,9.8)

"BLD",6047,"KRN","B",19,19)

"BLD",6047,"KRN","B",19.1,19.1)

"BLD",6047,"KRN","B",101,101)

"BLD",6047,"KRN","B",409.61,409.61)

"BLD",6047,"KRN","B",771,771)

"BLD",6047,"KRN","B",870,870)

"BLD",6047,"KRN","B",8989.51,8989.51)

"BLD",6047,"KRN","B",8989.52,8989.52)

"BLD",6047,"KRN","B",8994,8994)

"BLD",6047,"QUES",0)
^9.62^^
"BLD",6047,"REQB",0)
^9.611^4^4
"BLD",6047,"REQB",1,0)
DG*5.3*383^1
"BLD",6047,"REQB",2,0)
DG*5.3*189^1
"BLD",6047,"REQB",3,0)
DG*5.3*413^1
"BLD",6047,"REQB",4,0)
DG*5.3*342^1
"BLD",6047,"REQB","B","DG*5.3*189",2)

"BLD",6047,"REQB","B","DG*5.3*342",4)

"BLD",6047,"REQB","B","DG*5.3*383",1)

"BLD",6047,"REQB","B","DG*5.3*413",3)

"KRN",.4,2711,-1)
0^1
"KRN",.4,2711,0)
DGPT FEE BASIS^3050323.1514^^45.85^^^3050407
"KRN",.4,2711,"DCL","45.85^0")
!
"KRN",.4,2711,"DXS",1,9.2)
S I(0,0)=$G(D0),DIP(1)=$S($D(^DG(45.85,D0,0)):^(0),1:""),D0=$P(DIP(1),U,1) S:'D0!'$D(^DPT(+D0,0)) D0=-1 S DIP(101)=$S($D(^DPT(D0,0)):^(0),1:"") S X=$P(DIP(101),U,9)
"KRN",.4,2711,"F",1)
.01;L20;C1~
"KRN",.4,2711,"F",2)
X DXS(1,9.2) S DIP(102)=$G(X) S X=6,DIP(103)=$G(X) S X=10,X=$E(DIP(102),DIP(103),X) S D0=I(0,0) W X K DIP;"SSN";C25;L5;Z;"$E(NAME:SSN,6,10)"~
"KRN",.4,2711,"F",3)
S DIP(1)=$S($D(^DG(45.85,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2),X=$P(X,".",1) S Y=X D DT K DIP;L12;C32;"ADMISSION DATE";d;Z;"DATE(ADMISSION DATE)"~
"KRN",.4,2711,"F",4)
S DIP(1)=$S($D(^DG(45.85,D0,0)):^(0),1:"") S X=$P(DIP(1),U,12),X=X;C58;L6;"PTF NUMBER";Z;"INTERNAL(PTF NUMBER)";!~103;C66;"CENSUS NUMBER";L6~
"KRN",.4,2711,"F",5)
101;C74;L7~
"KRN",.4,2711,"H")
FEE BASIS CENSUS WORKFILE LIST
"KRN",.401,2062,-1)
0^1
"KRN",.401,2062,0)
DGPT FEE BASIS^3050324.1655^^45.85^^^3050407
"KRN",.401,2062,2,0)
^.4014^4^4
"KRN",.401,2062,2,1,0)
45.85^^CENSUS DATE:NUMBER^@"^^^^^^4
"KRN",.401,2062,2,1,"ASK")
1
"KRN",.401,2062,2,1,"CM")
S I(0,0)=$G(D0),Y(1)=$S($D(^DG(45.85,D0,0)):^(0),1:""),D0=$P(Y(1),U,4) S:'D0!'$D(^DG(45.86,+D0,0)) D0=-1 S X=$S('$D(D0):"",D0<0:"",1:D0) S D0=I(0,0) I D0>0 S DISX(1)=X
"KRN",.401,2062,2,1,"F")
43.999999^44
"KRN",.401,2062,2,1,"GET")
S I(0,0)=$G(D0),Y(1)=$S($D(^DG(45.85,D0,0)):^(0),1:""),D0=$P(Y(1),U,4) S:'D0!'$D(^DG(45.86,+D0,0)) D0=-1 S X=$S('$D(D0):"",D0<0:"",1:D0) S D0=I(0,0) I D0>0 S DISX(1)=X
"KRN",.401,2062,2,1,"QCON")
I DISX(1)=44
"KRN",.401,2062,2,1,"T")
44^44
"KRN",.401,2062,2,1,"TXT")
CENSUS DATE:NUMBER equals 44
"KRN",.401,2062,2,2,0)
45^4^FEE BASIS^"@^^^^^^3
"KRN",.401,2062,2,2,2,0)
^.401418^1^1
"KRN",.401,2062,2,2,2,1,0)
45.85^100^45^DGPT(^0
"KRN",.401,2062,2,2,2,1,"RCOD")
S I(0,0)=D0 S Y(1)=$S($D(^DG(45.85,D0,0)):^(0),1:"") S X=$P(Y(1),U,12),X=X S D(0)=+X
"KRN",.401,2062,2,2,2,"B",45.85,1)

"KRN",.401,2062,2,2,"F")
.999999^1^1 (FEE BASIS)
"KRN",.401,2062,2,2,"GET")
S DISX(2)=$P($G(^DGPT(D0,0)),U,4)
"KRN",.401,2062,2,2,"QCON")
I DISX(2)=1
"KRN",.401,2062,2,2,"T")
1^1^1 (FEE BASIS)
"KRN",.401,2062,2,2,"TXT")
FEE BASIS equals 1 (FEE BASIS)
"KRN",.401,2062,2,3,0)
45.85^101^CENSUS STATUS^@^^^^^^4
"KRN",.401,2062,2,3,"ASK")
1
"KRN",.401,2062,2,3,"F")
Transmittecz^Transmitted
"KRN",.401,2062,2,3,"GET")
D STATUS^DGPTCO1 S DISX(3)=X
"KRN",.401,2062,2,3,"QCON")
I DISX(3)="Transmitted"
"KRN",.401,2062,2,3,"SER")
1.0000^1.0000
"KRN",.401,2062,2,3,"T")
Transmitted^Transmitted
"KRN",.401,2062,2,3,"TXT")
CENSUS STATUS equals Transmitted
"KRN",.401,2062,2,4,0)
45.85^^NAME^".01^^^^^^4
"KRN",.401,2062,2,4,"CM")
S Y(1)=$S($D(^DG(45.85,D0,0)):^(0),1:"") S X=$P($G(^DPT(+$P(Y(1),U,1),0)),U) I D0>0 S DISX(4)=X
"KRN",.401,2062,2,4,"GET")
S Y(1)=$S($D(^DG(45.85,D0,0)):^(0),1:"") S X=$P($G(^DPT(+$P(Y(1),U,1),0)),U) I D0>0 S DISX(4)=X
"KRN",.401,2062,2,4,"IX")
^DG(45.85,"B",^DG(45.85,^2
"KRN",.401,2062,2,4,"PTRIX")
^DPT("B",
"KRN",.401,2062,2,4,"QCON")
I DISX(4)'=""
"KRN",.401,2062,2,4,"SER")
0.0000^0.0000
"KRN",.401,2062,2,4,"TXT")
NAME not null
"KRN",.401,2062,2,"B",45,2)

"KRN",.401,2062,2,"B",45.85,1)

"KRN",.401,2062,2,"B",45.85,3)

"KRN",.401,2062,2,"B",45.85,4)

"KRN",19,2263,-1)
2^2
"KRN",19,2263,0)
DGPT CENSUS MENU^Census Menu^^M^.5^^^^^^^5
"KRN",19,2263,10,0)
^19.01IP^17^12
"KRN",19,2263,10,17,0)
12355
"KRN",19,2263,10,17,"^")
DGPT FEE BASIS CENSUS STAT RPT
"KRN",19,2263,"U")
CENSUS MENU
"KRN",19,12355,-1)
0^1
"KRN",19,12355,0)
DGPT FEE BASIS CENSUS STAT RPT^Fee Basis Census Status Report^^R^^^^^^^^PTF/CENSUS
"KRN",19,12355,1,0)
^19.06^14^14^3050323^^^
"KRN",19,12355,1,1,0)
The report will indicate the status of the census record with a type of
"KRN",19,12355,1,2,0)
FEE BASIS for each admission.  This report uses the data stored in the
"KRN",19,12355,1,3,0)
CENSUS WORKFILE.  This workfile is an extract of data from the admission
"KRN",19,12355,1,4,0)
data for the patients who were inpatients (including FEE BASIS patients)
"KRN",19,12355,1,5,0)
as of 11:59 on the census date.  This workfile makes the printing of this
"KRN",19,12355,1,6,0)
report much faster than otherwise would be possible.  Without this
"KRN",19,12355,1,7,0)
workfile, it would be neccessary to scan all admissions prior to the
"KRN",19,12355,1,8,0)
census date to determine if the admission was still active on the census
"KRN",19,12355,1,9,0)
date. 
"KRN",19,12355,1,10,0)
 
"KRN",19,12355,1,11,0)
The report is sorted by: 
"KRN",19,12355,1,12,0)
   
"KRN",19,12355,1,13,0)
    1) Census Date
"KRN",19,12355,1,14,0)
    2) Census Status
"KRN",19,12355,25)
EN^DGPTCO3
"KRN",19,12355,"U")
FEE BASIS CENSUS STATUS REPORT
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
643^3050411
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3050411
"PKG",5,22,1,"PAH",1,1,1,0)
This patch is to modify the census routines to include care provided at 
"PKG",5,22,1,"PAH",1,1,2,0)
non-VA facilities.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","DGPTC")
0^6^B12346357
"RTN","DGPTC",1,0)
DGPTC ;ALB/MJK - Census Main Options; 15 APR 90 ; 5/11/01 1:15pm
"RTN","DGPTC",2,0)
 ;;5.3;Registration;**383,643**;Aug 13, 1993
"RTN","DGPTC",3,0)
 ;
"RTN","DGPTC",4,0)
 D DT^DICRW S X="DGPTC",DIK="^DOPT("""_X_""","
"RTN","DGPTC",5,0)
 G A:$D(^DOPT(X,10))
"RTN","DGPTC",6,0)
 S ^DOPT(X,0)="Census Main Options^1N^"
"RTN","DGPTC",7,0)
 F I=1:1 S Y=$T(@I) Q:Y=""  S ^DOPT(X,I,0)=$P(Y,";",3,99)
"RTN","DGPTC",8,0)
 D IXALL^DIK
"RTN","DGPTC",9,0)
 ;
"RTN","DGPTC",10,0)
A W !! S DIC="^DOPT(""DGPTC"",",DIC(0)="IQEAM"
"RTN","DGPTC",11,0)
 D ^DIC Q:Y<0  D @+Y G A
"RTN","DGPTC",12,0)
 ;
"RTN","DGPTC",13,0)
1 ;;Load/Edit PTF Record
"RTN","DGPTC",14,0)
 G ^DGPTF
"RTN","DGPTC",15,0)
 ;
"RTN","DGPTC",16,0)
2 ;;Release Closed Census Record
"RTN","DGPTC",17,0)
 S Y=2 D RTY^DGPTUTL,^DGPTFREL
"RTN","DGPTC",18,0)
 Q
"RTN","DGPTC",19,0)
 ;
"RTN","DGPTC",20,0)
3 ;;Open Closed Census Record
"RTN","DGPTC",21,0)
 S Y=2 D RTY^DGPTUTL,HEL^DGPTFDEL
"RTN","DGPTC",22,0)
 K DGADM,DGDOM,DGNHCU,MASD,MASDEV,PARA,DG,DGHEM Q
"RTN","DGPTC",23,0)
 ;
"RTN","DGPTC",24,0)
4 ;;Transmit Census Records
"RTN","DGPTC",25,0)
 D CLOSE G Q4:'Y
"RTN","DGPTC",26,0)
 S Y=2 D RTY^DGPTUTL,^DGPTFTR
"RTN","DGPTC",27,0)
Q4 K DGCN,DGCN0 Q
"RTN","DGPTC",28,0)
 ;
"RTN","DGPTC",29,0)
5 ;;Re-Open Released/Transmitted Records
"RTN","DGPTC",30,0)
 S Y=2 D RTY^DGPTUTL,DREL^DGPTFDEL
"RTN","DGPTC",31,0)
 Q
"RTN","DGPTC",32,0)
 ;
"RTN","DGPTC",33,0)
6 ;;Census Outputs
"RTN","DGPTC",34,0)
 G ^DGPTCO
"RTN","DGPTC",35,0)
 ;
"RTN","DGPTC",36,0)
7 ;;Census Date Parameters
"RTN","DGPTC",37,0)
 D CHKCUR^DGPTCO1
"RTN","DGPTC",38,0)
 K DGDASH W ! D DATE^DGPTCO1 S:Y]"" DIC("B")=Y
"RTN","DGPTC",39,0)
 S DIC="^DG(45.86,",DIC(0)="AELMQ" D ^DIC K DIC G Q7:Y<0
"RTN","DGPTC",40,0)
 S (D0,DGCN)=+Y D PAR
"RTN","DGPTC",41,0)
 S DA=DGCN,DIE="^DG(45.86,",DR="[DGPT CENSUS DATE]" D ^DIE K DIE,DR,DQ,DE
"RTN","DGPTC",42,0)
 I '$D(Y) S D0=DGCN D PAR W !!
"RTN","DGPTC",43,0)
Q7 K DGCN,D0,DA Q
"RTN","DGPTC",44,0)
 ;
"RTN","DGPTC",45,0)
8 ;;Regenerate Census WorkFile
"RTN","DGPTC",46,0)
 D GEN^DGPTCR
"RTN","DGPTC",47,0)
 Q
"RTN","DGPTC",48,0)
 ;
"RTN","DGPTC",49,0)
9 ;;Send 099 Transmission for Census Record
"RTN","DGPTC",50,0)
 D CLOSE G Q9:'Y
"RTN","DGPTC",51,0)
 S Y=2 D RTY^DGPTUTL,EN^DGPTF099
"RTN","DGPTC",52,0)
Q9 K DGCN,DGCN0 Q
"RTN","DGPTC",53,0)
 ;
"RTN","DGPTC",54,0)
10 ;;Close Census Reord
"RTN","DGPTC",55,0)
 W ! S DIC="^DGPT(",DIC(0)="AEMZQ",DIC("S")="I '$P(^(0),U,6),$P(^(0),U,11)=1"
"RTN","DGPTC",56,0)
 D ^DIC K DIC G Q10:Y<0
"RTN","DGPTC",57,0)
 S (DGPTF,PTF)=+Y,DFN=+Y(0) D PM^DGPTUTL,CEN^DGPTC1
"RTN","DGPTC",58,0)
 I '$D(DGCST) W !!,*7," >>>> Census transactions are not required for this PTF record." G 10
"RTN","DGPTC",59,0)
 I DGCST W !!,*7," >>>> This PTF record is already closed for census. (Census #",$S($D(DGCI):DGCI,1:""),")" G 10
"RTN","DGPTC",60,0)
 D UPDT^DGPTUTL:'$P(Y(0),U,4) S DGPTFE=$P(^DGPT(PTF,0),U,4)
"RTN","DGPTC",61,0)
 S Y=+$S($D(^DG(45.86,+DGCN,0)):+^(0),1:"") D FMT^DGPTUTL
"RTN","DGPTC",62,0)
 S Y=2 D RTY^DGPTUTL
"RTN","DGPTC",63,0)
 D CLS^DGPTC1
"RTN","DGPTC",64,0)
 I 'DGCST W !!," >>>> Not able to close for census.  Please use 'Load/Edit' option to edit PTF."
"RTN","DGPTC",65,0)
 D Q1^DGPTF G 10
"RTN","DGPTC",66,0)
Q10 K DG1,DGL,DGADM,DGPTFMT,DFN,PTF,DGPTFE,DGRTY,DGRTY0,DGPTF D KVAR^DGPTC1 Q
"RTN","DGPTC",67,0)
 ; 
"RTN","DGPTC",68,0)
CLOSE ; -- can we xmit?
"RTN","DGPTC",69,0)
 D CEN^DGPTUTL S Y=1
"RTN","DGPTC",70,0)
 I 'DGCN W !!?5,*7,"There is currently no active census being conducted." S Y=0 G CLOSEQ
"RTN","DGPTC",71,0)
 I DT>$P(DGCN0,U,2) S Y=$P(DGCN0,U,2) X ^DD("DD") W !!?5,*7,"Census Close date has passed (",Y,").",!?5,"No transmissions allowed." S Y=0 G CLOSEQ
"RTN","DGPTC",72,0)
CLOSEQ Q
"RTN","DGPTC",73,0)
 ;
"RTN","DGPTC",74,0)
PAR ; census date parameter profile
"RTN","DGPTC",75,0)
 ;  input: D0 := ifn of ^DG(45.86)
"RTN","DGPTC",76,0)
 S X="DGPTXCP" X ^%ZOSF("TEST") G PARQ:'$T
"RTN","DGPTC",77,0)
 K DGDASH,DXS S $P(DGDASH,"-",81)="",IOP="HOME" D ^%ZIS K IOP
"RTN","DGPTC",78,0)
 W @IOF,*13,$E(DGDASH,1,28)," Quick Parameter Profile ",$E(DGDASH,1,27)
"RTN","DGPTC",79,0)
 D ^DGPTXCP W !,DGDASH
"RTN","DGPTC",80,0)
PARQ K DGDASH,DXS Q
"RTN","DGPTC1")
0^2^B24771658
"RTN","DGPTC1",1,0)
DGPTC1 ;ALN/MJK - Census Record Processing; JAN 27, 2005
"RTN","DGPTC1",2,0)
 ;;5.3;Registration;**37,413,643**;Aug 13, 1993
"RTN","DGPTC1",3,0)
 ;
"RTN","DGPTC1",4,0)
CEN ; -- determine if PTF rec is current Census rec
"RTN","DGPTC1",5,0)
 ; input: PTF   := ptf rec #
"RTN","DGPTC1",6,0)
 ;     DGPMCA   := corres. adm           (non-fee)
"RTN","DGPTC1",7,0)
 ;     DGPMAN   := 0th node of corrs adm     "
"RTN","DGPTC1",8,0)
 ;output: DGCI  := census rec #
"RTN","DGPTC1",9,0)
 ;        DGCST := census rec status
"RTN","DGPTC1",10,0)
 ;        DGCN  := census date entry to 45.86
"RTN","DGPTC1",11,0)
 ;
"RTN","DGPTC1",12,0)
 K DGCST,DGCI,DGCN,DGCN0,DGFEE
"RTN","DGPTC1",13,0)
 S DGFEE=0
"RTN","DGPTC1",14,0)
 G CENQ:'$D(^DGPT(PTF,0)) N DFN S DGPTF0=^(0),DFN=+DGPTF0
"RTN","DGPTC1",15,0)
 ;G CENQ:$P(DGPTF0,U,4)
"RTN","DGPTC1",16,0)
 D CEN^DGPTUTL I DGCN0=""!(DT'>DGCN0) K DGCN G CENQ
"RTN","DGPTC1",17,0)
 I $P(DGPTF0,U,4) D FEE G CENQ
"RTN","DGPTC1",18,0)
 S DGT=$P(DGCN0,U)_".9" D WARD I 'Y K DGCN G CENQ
"RTN","DGPTC1",19,0)
 S DGCST=0,DGCI=""
"RTN","DGPTC1",20,0)
 F  S DGCI=$O(^DGPT("ACENSUS",PTF,DGCI)) Q:'DGCI  I $D(^DGPT(DGCI,0)),$P(^(0),U,13)=DGCN S DGCST=$P(^(0),U,6) Q:DGCST'=0  D  Q
"RTN","DGPTC1",21,0)
 .S DGCI=$$RDGCI(DGCI),DGCST=1
"RTN","DGPTC1",22,0)
CENQ K DGCN0,DGA1,DGT,X,DGPTF0,DGFEE Q
"RTN","DGPTC1",23,0)
 ;
"RTN","DGPTC1",24,0)
KVAR K DGCN,DGCI,DGCST Q
"RTN","DGPTC1",25,0)
 ;
"RTN","DGPTC1",26,0)
FEE ;
"RTN","DGPTC1",27,0)
 S DGCST=0,DGCI="",DGFEE=1
"RTN","DGPTC1",28,0)
 F  S DGCI=$O(^DGPT("ACENSUS",PTF,DGCI)) Q:'DGCI  I $D(^DGPT(DGCI,0)),$P(^(0),U,13)=DGCN S DGCST=$P(^(0),U,6) Q:DGCST'=0  D  Q
"RTN","DGPTC1",29,0)
 . S DGCI=$$RDGCI(DGCI),DGCST=+$P(^DGPT(DGCI,0),U,6)
"RTN","DGPTC1",30,0)
 Q
"RTN","DGPTC1",31,0)
ACT ; -- census actions with input of X
"RTN","DGPTC1",32,0)
 Q:'$D(X)
"RTN","DGPTC1",33,0)
 S Y=2 D RTY^DGPTUTL
"RTN","DGPTC1",34,0)
 I X="L" D CLS G ACTQ
"RTN","DGPTC1",35,0)
 I X="P" D OPEN G ACTQ
"RTN","DGPTC1",36,0)
 I X="E" S DGPTFLE=1,DGPTIFN=DGCI D EN^DGPTFREL K DGRTY,DGRTY0 G ^DGPTF
"RTN","DGPTC1",37,0)
ACTQ K DGRTY,DGRTY0 G EN1^DGPTF4
"RTN","DGPTC1",38,0)
 ;
"RTN","DGPTC1",39,0)
RDGCI(DGCI) ;-- eliminating 'OPEN' status census record and duplicates
"RTN","DGPTC1",40,0)
 S DGDL=DGCI,DGCIR="" D
"RTN","DGPTC1",41,0)
 .F  S DGCIR=$O(^DGPT("ACENSUS",PTF,DGCIR),-1) Q:DGCIR<DGDL  D
"RTN","DGPTC1",42,0)
 ..I $D(^DGPT(DGCIR,0)),$P(^(0),U,13)=DGCN S:DGCI=DGDL DGCI=DGCIR D
"RTN","DGPTC1",43,0)
 ...I DGCIR<DGCI S DGPTIFN=DGCIR,DGRTY=2 D KDGP^DGPTFDEL,KDGPT^DGPTFDEL
"RTN","DGPTC1",44,0)
 Q DGCI
"RTN","DGPTC1",45,0)
 ;
"RTN","DGPTC1",46,0)
CLS ;
"RTN","DGPTC1",47,0)
 S DGFEE=0
"RTN","DGPTC1",48,0)
 I $P(^DGPT(DGPTF,0),U,4)'=1 W !,"Updating TRANSFER DRGs..." S DGADM=$P(^DGPT(PTF,0),U,2) D SUDO1^DGPTSUDO
"RTN","DGPTC1",49,0)
 S J=PTF,DGERR=-1,T2=^DG(45.86,DGCN,0)+.9,T1=$P(^(0),U,5)
"RTN","DGPTC1",50,0)
 S DGPTFMTX=DGPTFMT S Y=T2 D FMT^DGPTUTL
"RTN","DGPTC1",51,0)
 W !,"Performing edit checks..."
"RTN","DGPTC1",52,0)
 ;-- init for Austin Edits
"RTN","DGPTC1",53,0)
 K ^TMP("AEDIT",$J),^TMP("AERROR",$J) S DGACNT=0
"RTN","DGPTC1",54,0)
 ;
"RTN","DGPTC1",55,0)
 D LOG^DGPTFTR1:DGPTFMT=1,LOG^DGPTR1:DGPTFMT=2,COM1^DGPTFTR
"RTN","DGPTC1",56,0)
 K DGLOGIC,T1,T2,DGCCO D LO^DGUTL
"RTN","DGPTC1",57,0)
 I DGERR>0 K DGERR D ^DGPTF2 G CLSQ
"RTN","DGPTC1",58,0)
 ;-- do austin edits
"RTN","DGPTC1",59,0)
 ;
"RTN","DGPTC1",60,0)
 D ^DGPTAE I DGERR>0 K DGERR D ^DGPTF2 G CLSQ
"RTN","DGPTC1",61,0)
 K DGERR,^TMP("AEDIT",$J),DGACNT
"RTN","DGPTC1",62,0)
 I $P(^DGPT(PTF,0),U,4) S DGFEE=1 D FEE1 G CLSQ:'DGCI
"RTN","DGPTC1",63,0)
 I $P(^DGPT(PTF,0),U,4)'=1 D CREATE G CLSQ:'DGCI
"RTN","DGPTC1",64,0)
 S DR="7////"_DUZ_";8///T",DA=DGCI,DIE="^DGPT(" D ^DIE K DIE,DR
"RTN","DGPTC1",65,0)
 S (X,DINUM)=DGCI,DIC(0)="L",DIC="^DGP(45.84,",DIC("DR")="2///NOW;3////"_DUZ
"RTN","DGPTC1",66,0)
 K DD,DO D FILE^DICN K DIC,DINUM
"RTN","DGPTC1",67,0)
 F I=0,.11,.52,.321,.32,57,.3 S:$D(^DPT(DFN,I)) ^DGP(45.84,DGCI,$S(I=0:10,1:I))=^DPT(DFN,I)
"RTN","DGPTC1",68,0)
 W !,"****** CENSUS CLOSED OUT ******" D HANG^DGPTUTL
"RTN","DGPTC1",69,0)
 S DGCST=1
"RTN","DGPTC1",70,0)
CLSQ S DGPTFMT=DGPTFMTX K DGPTFMTX,DGFEE Q
"RTN","DGPTC1",71,0)
 ;
"RTN","DGPTC1",72,0)
CREATE ; -- create census record
"RTN","DGPTC1",73,0)
 W !,"Creating Census Record..."
"RTN","DGPTC1",74,0)
 S Y=$P(^DGPT(PTF,0),U,2) D CREATE^DGPTFCR G CREATEQ:Y<0 S DGCI=+Y W "#",DGCI
"RTN","DGPTC1",75,0)
 S DGEND=+^DG(45.86,DGCN,0)_".2359",DGBEG=+$P(^(0),U,5)
"RTN","DGPTC1",76,0)
 S ^DGPT(DGCI,0)=$P(^DGPT(PTF,0),U,1,10)_"^2^"_PTF_"^"_DGCN,DGCSUF=$P(^(0),U,5)
"RTN","DGPTC1",77,0)
 ;S ^DGPT(DGCI,0)=$P(^DGPT(PTF,0),U,1,5)_"^1^"_$P(^DGPT(PTF,0),U,7,10)_"^2^"_PTF_"^"_DGCN,DGCSUF=$P(^(0),U,5)
"RTN","DGPTC1",78,0)
 S Y=DGEND D BS^DGPTC2 S X="",$P(X,U)=DGEND,$P(X,U,14)=Y
"RTN","DGPTC1",79,0)
 I $D(^DGPT(PTF,70)) S Y=^(70) F I=8,9,10 S $P(X,U,I)=$P(Y,U,I)
"RTN","DGPTC1",80,0)
 S ^DGPT(DGCI,70)=X D ASIH
"RTN","DGPTC1",81,0)
 I $D(^DGPT(PTF,101)) S ^DGPT(DGCI,101)=^DGPT(PTF,101)
"RTN","DGPTC1",82,0)
 F NODE="M","P","S",535 F I=0:0 S I=$O(^DGPT(PTF,NODE,I)) Q:'I  I $D(^DGPT(PTF,NODE,I,0)) S X=^(0) D @("SET"_NODE_"^DGPTC2")
"RTN","DGPTC1",83,0)
 K DA,DIKLM S DA=DGCI,DIK="^DGPT(" D IX1^DIK
"RTN","DGPTC1",84,0)
CREATEQ K X,Y,DGCSUF,DGBEG,DGEND Q
"RTN","DGPTC1",85,0)
 ;
"RTN","DGPTC1",86,0)
FEE1 ; -- create census record for fee record
"RTN","DGPTC1",87,0)
 W !,"Creating Census Record..."
"RTN","DGPTC1",88,0)
 S Y=$P(^DGPT(PTF,0),U,2) D CREATE^DGPTFCR G CREATEQ:Y<0 S DGCI=+Y W "#",DGCI
"RTN","DGPTC1",89,0)
 S DGEND=+^DG(45.86,DGCN,0)_".2359",DGBEG=+$P(^(0),U,5)
"RTN","DGPTC1",90,0)
 S ^DGPT(DGCI,0)=$P(^DGPT(PTF,0),U,1,10)_"^2^"_PTF_"^"_DGCN,DGCSUF=$P(^(0),U,5)
"RTN","DGPTC1",91,0)
 I $D(^DGPT(PTF,70)) S ^DGPT(DGCI,70)=^DGPT(PTF,70)
"RTN","DGPTC1",92,0)
 S $P(^DGPT(DGCI,70),U)=DGEND
"RTN","DGPTC1",93,0)
 I $D(^DGPT(PTF,101)) S ^DGPT(DGCI,101)=^DGPT(PTF,101)
"RTN","DGPTC1",94,0)
 F NODE="M","P","S",535 F I=0:0 S I=$O(^DGPT(PTF,NODE,I)) Q:'I  I $D(^DGPT(PTF,NODE,I,0)) S X=^(0) D @("SET"_NODE_"^DGPTC2")
"RTN","DGPTC1",95,0)
 K DA,DIKLM S DA=DGCI,DIK="^DGPT(" D IX1^DIK
"RTN","DGPTC1",96,0)
FEE1Q K X,Y,DGCSUF,DGBEG,DGEND Q
"RTN","DGPTC1",97,0)
OPEN ; -- re-open census rec by deleting
"RTN","DGPTC1",98,0)
 S DGPTIFN=DGCI D OPEN^DGPTFDEL S (DGCI,DGCST)=0
"RTN","DGPTC1",99,0)
 K DGPTIFN Q
"RTN","DGPTC1",100,0)
 ;
"RTN","DGPTC1",101,0)
WARD ; -- ward @ census d/t for an adm(even if nhcu/dom adm that is ASIH)
"RTN","DGPTC1",102,0)
 ;  input:  DGPMCA := corres adm
"RTN","DGPTC1",103,0)
 ;          DGPMAN := corres adm 0th node
"RTN","DGPTC1",104,0)
 ; output:       Y := ward ptr or null
"RTN","DGPTC1",105,0)
 ;
"RTN","DGPTC1",106,0)
 N MVT,M
"RTN","DGPTC1",107,0)
 S Y=""
"RTN","DGPTC1",108,0)
 I +DGPMAN>DGT Q
"RTN","DGPTC1",109,0)
 I $D(^DGPM(+$P(DGPMAN,U,17),0)),+^(0)<DGT Q
"RTN","DGPTC1",110,0)
 F %=(9999999.9999999-DGT):0 S %=$O(^DGPM("APMV",DFN,DGPMCA,%)) Q:'%  F MVT=0:0 S MVT=$O(^DGPM("APMV",DFN,DGPMCA,%,MVT)) Q:'MVT  I $D(^DGPM(MVT,0)) S M=^(0) I "^13^43^44^45^"'[(U_$P(M,U,18)_U),$D(^DIC(42,+$P(M,U,6),0)) S Y=+$P(M,U,6) G WARDQ
"RTN","DGPTC1",111,0)
WARDQ Q
"RTN","DGPTC1",112,0)
 ;
"RTN","DGPTC1",113,0)
ASIH ; -- calc asih days
"RTN","DGPTC1",114,0)
 N DGADM,DGREC,DGBDT,DGEDT,DGMVTP
"RTN","DGPTC1",115,0)
 S X1=DGBEG,X2=-1 D C^%DTC S DGBDT=X
"RTN","DGPTC1",116,0)
 S X1=$P(DGEND,"."),X2=1 D C^%DTC S DGEDT=X
"RTN","DGPTC1",117,0)
 S DGADM=$P(^DGPT(DGCI,0),U,2) D ASIH^DGUTL2
"RTN","DGPTC1",118,0)
 S $P(^DGPT(DGCI,70),U,8)=DGREC
"RTN","DGPTC1",119,0)
 Q
"RTN","DGPTC2")
0^3^B10137147
"RTN","DGPTC2",1,0)
DGPTC2 ;ALN/MJK - Census Record Processing; jAN 27,2005
"RTN","DGPTC2",2,0)
 ;;5.3;Registration;**58,189,643**;Aug 13, 1993
"RTN","DGPTC2",3,0)
 ;
"RTN","DGPTC2",4,0)
SETP ; -- P node processing
"RTN","DGPTC2",5,0)
 ;I DGCSUF="9AA"!(DGCSUF="BU") S I=999 G SETPQ
"RTN","DGPTC2",6,0)
 G SETPQ:X<DGBEG!(X>DGEND) S ^DGPT(DGCI,"P",I,0)=X
"RTN","DGPTC2",7,0)
 S:'$D(^DGPT(DGCI,"P",0)) ^(0)="^45.05D^^" S X=^(0),^(0)=$P(X,U,1,2)_"^"_I_"^"_($P(X,U,4)+1)
"RTN","DGPTC2",8,0)
SETPQ Q
"RTN","DGPTC2",9,0)
 ;
"RTN","DGPTC2",10,0)
SETS ; -- S node processing
"RTN","DGPTC2",11,0)
 D GETSUFF
"RTN","DGPTC2",12,0)
 I $G(DGSFLAG) S I=999 G SETSQ
"RTN","DGPTC2",13,0)
 G SETSQ:X<DGBEG!(X>DGEND) S ^DGPT(DGCI,"S",I,0)=X
"RTN","DGPTC2",14,0)
 S:'$D(^DGPT(DGCI,"S",0)) ^(0)="^45.01D^^" S X=^(0),^(0)=$P(X,U,1,2)_"^"_I_"^"_($P(X,U,4)+1)
"RTN","DGPTC2",15,0)
SETSQ K DGSFLAG Q
"RTN","DGPTC2",16,0)
 ;
"RTN","DGPTC2",17,0)
SET535 ; -- 535 node processing
"RTN","DGPTC2",18,0)
 D GETSUFF
"RTN","DGPTC2",19,0)
 I '$P(X,U,7),$G(DGSFLAG) G SET535Q
"RTN","DGPTC2",20,0)
 I $P(X,U,7) D CONE G SET535Q
"RTN","DGPTC2",21,0)
 G SET535Q:$P(X,U,10)<DGBEG!($P(X,U,10)>DGEND) S ^DGPT(DGCI,535,I,0)=X
"RTN","DGPTC2",22,0)
 S:'$D(^DGPT(DGCI,535,0)) ^(0)="^45.0535^^" S X=^(0),^(0)=$P(X,U,1,2)_"^"_I_"^"_($P(X,U,4)+1)
"RTN","DGPTC2",23,0)
SET535Q K DGSFLAG Q
"RTN","DGPTC2",24,0)
 ;
"RTN","DGPTC2",25,0)
SETM ; -- M node processing
"RTN","DGPTC2",26,0)
 D GETSUFF
"RTN","DGPTC2",27,0)
 I I'=1,$G(DGSFLAG) S I=999 G SETMQ
"RTN","DGPTC2",28,0)
 I I=1 D ONE G SETMQ
"RTN","DGPTC2",29,0)
 G SETMQ:($P(X,U,10)<DGBEG)!($P(X,U,10)>DGEND) S ^DGPT(DGCI,"M",I,0)=X
"RTN","DGPTC2",30,0)
 S:'$D(^DGPT(DGCI,"M",0)) ^(0)="^45.02AI^^" S X=^(0),^(0)=$P(X,U,1,2)_"^"_I_"^"_($P(X,U,4)+1)
"RTN","DGPTC2",31,0)
 S:$D(^DGPT(PTF,"M",I,"P")) ^DGPT(DGCI,"M",I,"P")=^("P")
"RTN","DGPTC2",32,0)
SETMQ K DGSFLAG Q
"RTN","DGPTC2",33,0)
 ;
"RTN","DGPTC2",34,0)
BSEC ; -- set bed sec in 1 mvt ; input X := one node of "M" ; output := same
"RTN","DGPTC2",35,0)
 N Y
"RTN","DGPTC2",36,0)
 S Y=+$O(^DGPM("ATS",DFN,DGPMCA,9999999.9999999-DGEND)),Y=+$O(^(Y,0))
"RTN","DGPTC2",37,0)
 S $P(X,U,2)=$S($D(^DIC(45.7,+Y,0)):$P(^(0),U,2),1:0)
"RTN","DGPTC2",38,0)
 Q
"RTN","DGPTC2",39,0)
 ;
"RTN","DGPTC2",40,0)
BS ; -- determine bed status on census date
"RTN","DGPTC2",41,0)
 S I=+$O(^DGPM("APMV",DFN,DGPMCA,9999999.9999999-Y)),I=+$O(^(I,0))
"RTN","DGPTC2",42,0)
 S I=$S($D(^DGPM(I,0)):$P(^(0),U,18),1:0),Y=1
"RTN","DGPTC2",43,0)
 I I S I=U_I_U,Y=$S("^43^44^13^45^"[I:4,"^1^"[I:2,"^2^3^"[I:3,1:1)
"RTN","DGPTC2",44,0)
 Q
"RTN","DGPTC2",45,0)
 ;
"RTN","DGPTC2",46,0)
CONE ;-- find last 535 before last census date
"RTN","DGPTC2",47,0)
 S DGX=$O(^DGPT(PTF,535,"AM",DGEND)) S DGX=+$S(DGX:$O(^(DGX,0)),1:$O(^DGPT(PTF,535,"ADC",1,0))) I $D(^DGPT(PTF,535,DGX,0)) S ^DGPT(DGCI,535,DGX,0)=^DGPT(PTF,535,DGX,0),$P(^DGPT(DGCI,535,DGX,0),U,10)=DGEND
"RTN","DGPTC2",48,0)
 S:'$D(^DGPT(DGCI,535,0)) ^(0)="^45.0535^^" S X=^(0),^(0)=$P(X,U,1,2)_"^"_I_"^"_($P(X,U,4)+1)
"RTN","DGPTC2",49,0)
 Q
"RTN","DGPTC2",50,0)
 ;
"RTN","DGPTC2",51,0)
ONE ; -- find last mvt before census date
"RTN","DGPTC2",52,0)
 S M=$O(^DGPT(PTF,"M","AM",DGEND)),M=$S('M:M,1:$O(^(M,0))),M=$S(M:M,1:1)
"RTN","DGPTC2",53,0)
 I M>1,$D(^DGPT(PTF,"M",M,0)) S X="1^"_$P(^(0),U,2,99)
"RTN","DGPTC2",54,0)
 I M=1,DGFEE=0 D BSEC
"RTN","DGPTC2",55,0)
 S $P(X,U,10)=DGEND,^DGPT(DGCI,"M",1,0)=X
"RTN","DGPTC2",56,0)
 S:'$D(^DGPT(DGCI,"M",0)) ^(0)="^45.02AI^^" S X=^(0),^(0)=$P(X,U,1,2)_"^1^"_($P(X,U,4)+1)
"RTN","DGPTC2",57,0)
 ;;Following code added to transmit GAF scores in Census Record
"RTN","DGPTC2",58,0)
 ;;Code added by EDS-GRR 6/4/1998
"RTN","DGPTC2",59,0)
 ;;
"RTN","DGPTC2",60,0)
 M ^DGPT(DGCI,"M",M,300)=^DGPT(PTF,"M",M,300)
"RTN","DGPTC2",61,0)
 ;;
"RTN","DGPTC2",62,0)
 ;;End of GAF enhancement
"RTN","DGPTC2",63,0)
 ;;
"RTN","DGPTC2",64,0)
 S:$D(^DGPT(PTF,"M",M,"P")) ^DGPT(DGCI,"M",1,"P")=^("P")
"RTN","DGPTC2",65,0)
 Q
"RTN","DGPTC2",66,0)
GETSUFF ; -- get suffix if from Va Domiciliary or VA Nursing home
"RTN","DGPTC2",67,0)
 F DGSTA=30,40 D
"RTN","DGPTC2",68,0)
 .D NUMACT^DGPTSUF(DGSTA)
"RTN","DGPTC2",69,0)
 .I DGANUM>0 D
"RTN","DGPTC2",70,0)
 ..F DGCTR=1:1:DGANUM I DGCSUF=DGSUFNAM(DGCTR) S DGSFLAG=1
"RTN","DGPTC2",71,0)
 .K DGANUM,DGCTR,DGSUFNAM
"RTN","DGPTC2",72,0)
 K DGSTA
"RTN","DGPTC2",73,0)
 Q
"RTN","DGPTCO3")
0^5^B4303694
"RTN","DGPTCO3",1,0)
DGPTCO3 ;ALB/MJK/DHH - Census Status Report ; 3/23/2005
"RTN","DGPTCO3",2,0)
 ;;5.3;Registration;**136,383,432,643**;Aug 13, 1993
"RTN","DGPTCO3",3,0)
 ;
"RTN","DGPTCO3",4,0)
EN D CHKCUR^DGPTCO1 W ! D DATE^DGPTCO1
"RTN","DGPTCO3",5,0)
 S DIC("A")="Generate PTF Census Status Report for Census date: ",DIC="^DG(45.86,",DIC(0)="AEMQ" S:Y]"" DIC("B")=Y
"RTN","DGPTCO3",6,0)
 D ^DIC K DIC G ENQ:Y<0
"RTN","DGPTCO3",7,0)
 S DGCN=+Y,DGCDT=+$P(Y,U,2)_".9" K DGCHOICE
"RTN","DGPTCO3",8,0)
 D STATUS^DGPTCO2 G ENQ:'$D(DGCHOICE("STATUS"))
"RTN","DGPTCO3",9,0)
 S %ZIS="NQ" D ^%ZIS K %ZIS G ENQ:POP D DOQ G ENQ:POP S DGIOP=ION_";"_IOM_";"_IOSL
"RTN","DGPTCO3",10,0)
 I 'DGQ D START G ENQ
"RTN","DGPTCO3",11,0)
 S ZTRTN="START^DGPTCO3",ZTIO=DGIOP,ZTDESC="Fee Basis Census Status Report"
"RTN","DGPTCO3",12,0)
 F X="DGCHOICE(","DGCDT","DGCN","DGIOP" S ZTSAVE(X)=""
"RTN","DGPTCO3",13,0)
 D ^%ZTLOAD D ^%ZISC
"RTN","DGPTCO3",14,0)
ENQ K DGQ,DHIT,DIOEND,DGC,DGCN,DGCDT,DGIOP,DGCHOICE,DIS
"RTN","DGPTCO3",15,0)
 Q
"RTN","DGPTCO3",16,0)
 ;
"RTN","DGPTCO3",17,0)
START ; -- produce report
"RTN","DGPTCO3",18,0)
 ;Lock global to prevent duplicate entries in Census Workfile
"RTN","DGPTCO3",19,0)
 L +^DG(45.85,"DGPT CENSUS REGEN WORKFILE"):5 I '$T D   Q
"RTN","DGPTCO3",20,0)
 .N DGPTMSG
"RTN","DGPTCO3",21,0)
 .D BLDMSG^DGPTCR
"RTN","DGPTCO3",22,0)
 .I $E(IOST,1,2)'="C-" D SNDMSG^DGPTCR,ENQ Q
"RTN","DGPTCO3",23,0)
 .N DGPTLINE
"RTN","DGPTCO3",24,0)
 .S DGPTLINE=0
"RTN","DGPTCO3",25,0)
 .F  S DGPTLINE=$O(DGPTMSG(DGPTLINE)) Q:'DGPTLINE  W !,?5,DGPTMSG(DGPTLINE,0)
"RTN","DGPTCO3",26,0)
 .Q
"RTN","DGPTCO3",27,0)
 I '$D(^DG(45.85,"ACENSUS",DGCN)) D REGEN^DGPTCR
"RTN","DGPTCO3",28,0)
 S DIC="^DG(45.85,",(BY,FLDS)="[DGPT FEE BASIS]",L=0,FR=DGCN_",,@",TO=DGCN_",,"
"RTN","DGPTCO3",29,0)
 I DGCHOICE("STATUS")'="All" S (FR,TO)=DGCN_",,"_DGCHOICE("STATUS")
"RTN","DGPTCO3",30,0)
 S Y=$P(DGCDT,".") X ^DD("DD") S DHD="Census Status Report for "_Y
"RTN","DGPTCO3",31,0)
 S IOP=DGIOP K DGC
"RTN","DGPTCO3",32,0)
 D EN1^DIP,ENQ
"RTN","DGPTCO3",33,0)
 L -^DG(45.85,"DGPT CENSUS REGEN WORKFILE")
"RTN","DGPTCO3",34,0)
END Q
"RTN","DGPTCO3",35,0)
 ;
"RTN","DGPTCO3",36,0)
DOQ ;-- check if output device is queued. if not ask 
"RTN","DGPTCO3",37,0)
 S DGQ=0
"RTN","DGPTCO3",38,0)
 I $D(IO("Q")) S DGQ=1 G DOQT
"RTN","DGPTCO3",39,0)
 I IO=IO(0) G DOQT
"RTN","DGPTCO3",40,0)
 S DIR(0)="Y",DIR("A")="DO YOU WANT YOUR OUTPUT QUEUED",DIR("B")="YES"
"RTN","DGPTCO3",41,0)
 D ^DIR
"RTN","DGPTCO3",42,0)
 I Y S DGQ=1
"RTN","DGPTCO3",43,0)
DOQT ;
"RTN","DGPTCO3",44,0)
 K Y,DIR
"RTN","DGPTCO3",45,0)
 Q
"RTN","DGPTCO3",46,0)
 ;
"RTN","DGPTCR")
0^1^B39825200
"RTN","DGPTCR",1,0)
DGPTCR ;ALB/MJK - Census Worklist Re-gen ; JAN 27, 2005
"RTN","DGPTCR",2,0)
 ;;5.3;Registration;**136,383,643**;Aug 13, 1993
"RTN","DGPTCR",3,0)
 ;
"RTN","DGPTCR",4,0)
GEN ; -- ask user regen ques
"RTN","DGPTCR",5,0)
 D CHKCUR^DGPTCO1
"RTN","DGPTCR",6,0)
 W ! D DATE^DGPTCO1
"RTN","DGPTCR",7,0)
 S DIC("A")="Generate CENSUS WORKFILE for Census date: ",DIC="^DG(45.86,",DIC(0)="AEMQ" S:Y]"" DIC("B")=Y
"RTN","DGPTCR",8,0)
 D ^DIC K DIC G GENQ:Y<0 S DGCN=+Y,DGCDT=+$P(Y,U,2)_".9"
"RTN","DGPTCR",9,0)
 ;
"RTN","DGPTCR",10,0)
GEN1 W !!,"Are you sure" S %=2 D YN^DICN
"RTN","DGPTCR",11,0)
 I %<0!(%=2) W "   (Ok, work file will remain the same.)" G GENQ
"RTN","DGPTCR",12,0)
 I '% W !?5,"Answer 'YES' if you want the system to re-calculate which",!?5,"admissions require Census records.",!?5,"Otherwise, answer 'NO'." G GEN1
"RTN","DGPTCR",13,0)
 S ZTRTN="REGEN^DGPTCR",ZTIO="",ZTDESC="Regenerating CENSUS WORKFILE"
"RTN","DGPTCR",14,0)
 S ZTSAVE("DGCN")="",ZTSAVE("DGCDT")="" W ! D ^%ZTLOAD
"RTN","DGPTCR",15,0)
GENQ K DGCN,%,Y Q
"RTN","DGPTCR",16,0)
 ;
"RTN","DGPTCR",17,0)
REGEN ; -- census workfile generation
"RTN","DGPTCR",18,0)
 ; -- kill off old values
"RTN","DGPTCR",19,0)
 ; input: DGCN    := ifn of census date file
"RTN","DGPTCR",20,0)
 ;        DGCDT   := date of census
"RTN","DGPTCR",21,0)
 ;        DGFIRST := flag(1/0) to send bulletin (option)
"RTN","DGPTCR",22,0)
 ;
"RTN","DGPTCR",23,0)
 ;Lock global to prevent duplicate entries in Census Workfile
"RTN","DGPTCR",24,0)
 L +^DG(45.85,"DGPT CENSUS REGEN WORKFILE"):5 I '$T N DGPTMSG D BLDMSG,SNDMSG Q
"RTN","DGPTCR",25,0)
 K ^UTILITY("DGPT REGEN",$J) S:'$D(XQM) XQM=0
"RTN","DGPTCR",26,0)
 S:'$D(DGFIRST) DGFIRST='$O(^DG(45.85,"ACENSUS",DGCN,0))
"RTN","DGPTCR",27,0)
 S DGOLD="^UTILITY(""DGPT REGEN"",$J,""OLD"")",DGNEW="^UTILITY(""DGPT REGEN"",$J,""NEW"")"
"RTN","DGPTCR",28,0)
 F DGI=0:0 S DGI=$O(^DG(45.85,"ACENSUS",DGCN,DGI)) Q:'DGI  D
"RTN","DGPTCR",29,0)
 . S DIK="^DG(45.85,",DA=DGI
"RTN","DGPTCR",30,0)
 . I $D(^DG(45.85,DA,0)) D
"RTN","DGPTCR",31,0)
 . . S DGPTF=$P(^DG(45.85,DA,0),U,12)
"RTN","DGPTCR",32,0)
 . . S @DGOLD@(+^DG(45.85,DA,0),+$P(^(0),U,3),+DGPTF)="" D ^DIK K DIK,DGPTF
"RTN","DGPTCR",33,0)
 ; -- scan and create new values
"RTN","DGPTCR",34,0)
 F DGDT=0:0 S DGDT=$O(^DGPM("ATT1",DGDT)) Q:'DGDT!(DGDT>DGCDT)  F DGAD=0:0 S DGAD=$O(^DGPM("ATT1",DGDT,DGAD)) Q:'DGAD  D CHK
"RTN","DGPTCR",35,0)
 D FEE
"RTN","DGPTCR",36,0)
 S DIE="^DG(45.86,",DA=DGCN,DR=".06///NOW" D ^DIE
"RTN","DGPTCR",37,0)
 L -^DG(45.85,"DGPT CENSUS REGEN WORKFILE")
"RTN","DGPTCR",38,0)
 D BULL
"RTN","DGPTCR",39,0)
Q K DGEW,DGOLD,DGI,DGMV,DGAD0,DGAD1,DGDT,DFN,DGFIRST,^UTILITY("DGPT REGEN",$J),DGOLD,DGNEW
"RTN","DGPTCR",40,0)
 Q
"RTN","DGPTCR",41,0)
 ;
"RTN","DGPTCR",42,0)
CHK ; -- determine if good adm then set work entry
"RTN","DGPTCR",43,0)
 G CHKQ:'$D(^DGPM(DGAD,0)) S DGPMCA=DGAD,(DGPMAN,DGAD0)=^(0)
"RTN","DGPTCR",44,0)
 S DFN=+$P(DGAD0,U,3) G CHKQ:'$D(^DPT(DFN,0))
"RTN","DGPTCR",45,0)
 S DGT=DGCDT D WARD^DGPTC1 G CHKQ:'Y S DGCWD=+Y
"RTN","DGPTCR",46,0)
 S DGPTF=+$P(DGAD0,U,16)
"RTN","DGPTCR",47,0)
 S DGAD1=$S($D(^DGPM(+$P(DGAD0,U,17),0)):^(0),1:"")
"RTN","DGPTCR",48,0)
 S:'$D(@DGOLD@(DFN,DGAD,+DGPTF)) @DGNEW@(DFN,DGAD,+DGPTF)="" K @DGOLD@(DFN,DGAD,+DGPTF)
"RTN","DGPTCR",49,0)
 S X=DFN,DIC="^DG(45.85,",DIC(0)="L",DIC("DR")="[DGPT STUFF ENTRY]"
"RTN","DGPTCR",50,0)
 K DD,DO D FILE^DICN K DIC
"RTN","DGPTCR",51,0)
CHKQ K DFN,DGT,DGPMCA,DGPMAN,DGCWD Q
"RTN","DGPTCR",52,0)
FEE ; --check for fee entries
"RTN","DGPTCR",53,0)
 F DFN=0:0 S DFN=$O(^DGPT("AFEE",DFN)) Q:'DFN  D
"RTN","DGPTCR",54,0)
 . F DGDT=0:0 S DGDT=$O(^DGPT("AFEE",DFN,DGDT)) Q:'DGDT  D
"RTN","DGPTCR",55,0)
 ..; -- dgds=discharge date
"RTN","DGPTCR",56,0)
 .. S PTFEE=$O(^DGPT("AFEE",DFN,DGDT,0))
"RTN","DGPTCR",57,0)
 .. Q:'$D(^DGPT(PTFEE,0))
"RTN","DGPTCR",58,0)
 .. Q:$P(^DGPT(PTFEE,0),U,11)=2
"RTN","DGPTCR",59,0)
 .. S DGDS="" I $D(^DGPT(PTFEE,70)) S DGDS=$P(^(70),"^")
"RTN","DGPTCR",60,0)
 .. I DGDS="" S DGDS=9999999
"RTN","DGPTCR",61,0)
 .. D FEECHK
"RTN","DGPTCR",62,0)
 Q
"RTN","DGPTCR",63,0)
FEECHK ; -- determine if good adm then set work entry
"RTN","DGPTCR",64,0)
 G FEECHKQ:'$D(^DGPT(PTFEE,0))
"RTN","DGPTCR",65,0)
 G FEECHKQ:'$D(^DPT(DFN,0))
"RTN","DGPTCR",66,0)
 I DGDT<DGCDT,DGDS>DGCDT D
"RTN","DGPTCR",67,0)
 . S DGAD0=DGDT,$P(DGAD0,U,16)=PTFEE
"RTN","DGPTCR",68,0)
 . S DGAD1=$S((DGDS=9999999):"",1:DGDS)
"RTN","DGPTCR",69,0)
 . S:'$D(@DGOLD@(DFN,0,+PTFEE)) @DGNEW@(DFN,0,+PTFEE)="" K @DGOLD@(DFN,0,+PTFEE)
"RTN","DGPTCR",70,0)
 . S X=DFN,DIC="^DG(45.85,",DIC(0)="L",DIC("DR")="[DGPT STUFF ENTRY]"
"RTN","DGPTCR",71,0)
 . K DD,DO D FILE^DICN K DIC
"RTN","DGPTCR",72,0)
FEECHKQ K PTFEE,DGDS Q
"RTN","DGPTCR",73,0)
 ;
"RTN","DGPTCR",74,0)
BULL ; -- bull to user re-generating
"RTN","DGPTCR",75,0)
 G BULLQ:DGFIRST K ^UTILITY("DGPT REGEN",$J,"TEXT")
"RTN","DGPTCR",76,0)
 K DGBLK S $P(DGBLK," ",100)="",Y=+^DG(45.86,DGCN,0) X ^DD("DD")
"RTN","DGPTCR",77,0)
 S XMSUB="Census Workfile Update (CENSUS DATE: "_Y_")",XMY(DUZ)="",XMTEXT="^UTILITY(""DGPT REGEN"",$J,""TEXT"",",DGLINE=0
"RTN","DGPTCR",78,0)
 D BLANK
"RTN","DGPTCR",79,0)
 S Y=$P(^DG(45.86,DGCN,0),U,6) X ^DD("DD") S DGL=" Census Work File Regeneration Finished:  "_Y D SET,BLANK
"RTN","DGPTCR",80,0)
 I $D(DGPTCV5) K @DGOLD,@DGNEW ;for v5 conversion only
"RTN","DGPTCR",81,0)
 I '$D(@DGOLD),'$D(@DGNEW) D BLANK S DGL="  **** Work File did NOT change as a result of update. ****" D SET G BULL1
"RTN","DGPTCR",82,0)
 S DGL="Changes resulting from regeneration of census work file:" D SET
"RTN","DGPTCR",83,0)
 D OLD:$D(@DGOLD),NEW:$D(@DGNEW)
"RTN","DGPTCR",84,0)
BULL1 D ^XMD
"RTN","DGPTCR",85,0)
BULLQ K DGBLK,DGI,DGX,DGL,DGLINE,XMY,XMSUB,XMTEXT Q
"RTN","DGPTCR",86,0)
 ;
"RTN","DGPTCR",87,0)
SET ; -- set line in xmtext array
"RTN","DGPTCR",88,0)
 S DGLINE=DGLINE+1
"RTN","DGPTCR",89,0)
 S ^UTILITY("DGPT REGEN",$J,"TEXT",DGLINE,0)=DGL
"RTN","DGPTCR",90,0)
 Q
"RTN","DGPTCR",91,0)
 ;
"RTN","DGPTCR",92,0)
BLANK S DGL=" " D SET Q
"RTN","DGPTCR",93,0)
 ;
"RTN","DGPTCR",94,0)
OLD ;
"RTN","DGPTCR",95,0)
 D BLANK
"RTN","DGPTCR",96,0)
 S DGL=">>> OLD ADMISSIONS no longer needing a Census Record <<< " D SET,HEAD
"RTN","DGPTCR",97,0)
 F DFN=0:0 S DFN=$O(@DGOLD@(DFN)) Q:'DFN  F DGAD=0:0 S DGAD=$O(@DGOLD@(DFN,DGAD)) Q:'DGAD  D AD
"RTN","DGPTCR",98,0)
 Q
"RTN","DGPTCR",99,0)
 ;
"RTN","DGPTCR",100,0)
NEW ;
"RTN","DGPTCR",101,0)
 D BLANK,BLANK
"RTN","DGPTCR",102,0)
 S DGL=">>> NEW ADMISSIONS added to workfile needing a Census Record <<< " D SET,HEAD
"RTN","DGPTCR",103,0)
 F DFN=0:0 S DFN=$O(@DGNEW@(DFN)) Q:'DFN  F DGAD=0:0 S DGAD=$O(@DGNEW@(DFN,DGAD)) Q:'DGAD  D AD
"RTN","DGPTCR",104,0)
 F DFN=0:0 S DFN=$O(@DGNEW@(DFN)) Q:'DFN  F PTFEE=0:0 S PTFEE=$O(@DGNEW@(DFN,0,+PTFEE)) Q:'PTFEE  D AD1
"RTN","DGPTCR",105,0)
 Q
"RTN","DGPTCR",106,0)
 ;
"RTN","DGPTCR",107,0)
HEAD ;
"RTN","DGPTCR",108,0)
 D BLANK
"RTN","DGPTCR",109,0)
 S DGL="Name                            Admission Date           PTF#      Census#" D SET
"RTN","DGPTCR",110,0)
 S DGL="----                            --------------           ----      -------" D SET
"RTN","DGPTCR",111,0)
 Q
"RTN","DGPTCR",112,0)
 ;
"RTN","DGPTCR",113,0)
AD G ADQ:'$D(^DGPM(DGAD,0)) S DGX=^(0),DGL=""
"RTN","DGPTCR",114,0)
 S DGL=$E($S($D(^DPT(DFN,0)):$P(^(0),U),1:"")_DGBLK,1,20)_" ("_$E($P(^(0),U,9),6,10)_")"
"RTN","DGPTCR",115,0)
 S Y=+DGX X ^DD("DD") S DGL=DGL_$E(DGBLK,1,5)_$E(Y_DGBLK,1,20)_$E(DGBLK,1,4)_$J($P(DGX,U,16),5)_$E(DGBLK,1,8)
"RTN","DGPTCR",116,0)
 F DGCI=0:0 S DGCI=$O(^DGPT("ACENSUS",+$P(DGX,U,16),DGCI)) Q:'DGCI  I $D(^DGPT(DGCI,0)),$P(^(0),U,13)=DGCN S DGL=DGL_$J(DGCI,5) Q
"RTN","DGPTCR",117,0)
 D SET
"RTN","DGPTCR",118,0)
ADQ K DGCI Q
"RTN","DGPTCR",119,0)
AD1 G AD1Q:'$D(^DGPT(PTFEE,0)) S DGX=^(0),DGL=""
"RTN","DGPTCR",120,0)
 S DGL=$E($S($D(^DPT(DFN,0)):$P(^(0),U),1:"")_DGBLK,1,20)_" ("_$E($P(^(0),U,9),6,10)_")"
"RTN","DGPTCR",121,0)
 S Y=$P(DGX,U,2) X ^DD("DD") S DGL=DGL_$E(DGBLK,1,5)_$E(Y_DGBLK,1,20)_$E(DGBLK,1,4)_$J(PTFEE,5)_$E(DGBLK,1,8)
"RTN","DGPTCR",122,0)
 F DGCI=0:0 S DGCI=$O(^DGPT("ACENSUS",PTFEE,DGCI)) Q:'DGCI  I $D(^DGPT(DGCI,0)),$P(^(0),U,13)=DGCN S DGL=DGL_$J(DGCI,5) Q
"RTN","DGPTCR",123,0)
 D SET
"RTN","DGPTCR",124,0)
AD1Q Q
"RTN","DGPTCR",125,0)
 ;
"RTN","DGPTCR",126,0)
BLDMSG ;Build message text if regen currently running
"RTN","DGPTCR",127,0)
 S DGPTMSG(1,0)="The Census Status Report or the Regenerate Census Workfile option was"
"RTN","DGPTCR",128,0)
 S DGPTMSG(2,0)="running at the time of your request.  If these options are scheduled"
"RTN","DGPTCR",129,0)
 S DGPTMSG(3,0)="simultaneously, duplicate census records may be created in"
"RTN","DGPTCR",130,0)
 S DGPTMSG(4,0)="the Census Workfile."
"RTN","DGPTCR",131,0)
 S DGPTMSG(5,0)=""
"RTN","DGPTCR",132,0)
 S DGPTMSG(6,0)="To prevent this possible duplication, these options may not be"
"RTN","DGPTCR",133,0)
 S DGPTMSG(7,0)="scheduled at the same time.  Please try again."
"RTN","DGPTCR",134,0)
 Q
"RTN","DGPTCR",135,0)
SNDMSG ;Generate mail message to user
"RTN","DGPTCR",136,0)
 N XMSUB,XMDUZ,XMY,XMTEXT
"RTN","DGPTCR",137,0)
 S XMSUB="Could not generate Census Workfile"
"RTN","DGPTCR",138,0)
 S XMDUZ="Census Workfile option"
"RTN","DGPTCR",139,0)
 S XMY(DUZ)=""
"RTN","DGPTCR",140,0)
 S XMTEXT="DGPTMSG("
"RTN","DGPTCR",141,0)
 D ^XMD
"RTN","DGPTCR",142,0)
 Q
"RTN","DGPTF2")
0^4^B16520587
"RTN","DGPTF2",1,0)
DGPTF2 ;ALB/JDS - PTF CORRECTIONS ; MAR 16, 2005
"RTN","DGPTF2",2,0)
 ;;5.3;Registration;**37,342,643**;Aug 13, 1993
"RTN","DGPTF2",3,0)
EN Q:'$D(^UTILITY("DG",$J))  S Q=0,DG2=""
"RTN","DGPTF2",4,0)
 F DG9=101,401,501,701,601,"HEADER" D @DG9 F I1=0:0 S I1=$O(^UTILITY("DG",$J,DG9,I1)) Q:I1'>0!(Q)  S DG45="",DGJ=^(I1) F J=2:1 S K=$P(DGJ,U,J) Q:'K  D SET Q:Q  I '$P(DGJ,U,J+1) D @($S(DG9=401!(DG9=501)!(DG9=601):"D5",1:"DO1")) Q:Q
"RTN","DGPTF2",5,0)
Q D DO:'Q K DG9,I1,DR,DG45,DG2,DGJ,Q,M,L,^UTILITY("DG",$J) Q
"RTN","DGPTF2",6,0)
SET S L=$P(DGL,U,K) I DGPTFE!('$P(L,"*",3)) S M="DG"_$P(L,"*",2) I @M'[($P(L,"*",1)_";") S @M=@M_$P(L,"*",1)_";"
"RTN","DGPTF2",7,0)
 Q
"RTN","DGPTF2",8,0)
 ; -- DGL sets
"RTN","DGPTF2",9,0)
101 I DGPTFMT<2 S DGL=".01*2^20*45^21.1;21.2*45^22*45^.526*2^.05*2^.02*2^.03*2^23*45^.32103;.32102;.3212*2^.115;.117;.1112*2^10*45"
"RTN","DGPTF2",10,0)
 I DGPTFMT>1 S DGL=".01*2^20*45^21.1;21.2*45^22*45^.526*2^.05*2^.02*2^.03*2^.323*2^.32101;.32103;.3212;.32102;.3213*2^.115;.117;.1112*2^10*45"
"RTN","DGPTF2",11,0)
 Q
"RTN","DGPTF2",12,0)
701 S DGL="70*45*1^71*45*1^72*45*1^73*45^74*45^75*45^76.1;76.2*45^77*45^.06*2^78*45^79*45"
"RTN","DGPTF2",13,0)
 Q
"RTN","DGPTF2",14,0)
401 S DGL=".01*45^3*45^4*45^5*45^6*45^7*45^8:12*45"
"RTN","DGPTF2",15,0)
 Q
"RTN","DGPTF2",16,0)
501 I DGPTFMT<2 S DGL="10*45*1^2*45*1^3*45^4*45^57.4*2^5:9*45^72.1*45*1"
"RTN","DGPTF2",17,0)
 I DGPTFMT>1 S DGL="10*45*1^2*45*1^2*45*1^3*45^4*45^57.4*2^5:9*45^^^^72.1*45*1"
"RTN","DGPTF2",18,0)
 Q
"RTN","DGPTF2",19,0)
601 S DGL=".01*45^1*45^^^4:9*45"
"RTN","DGPTF2",20,0)
 Q
"RTN","DGPTF2",21,0)
HEADER S DGL=".09*2^2*45*1^3*45*1"
"RTN","DGPTF2",22,0)
 Q
"RTN","DGPTF2",23,0)
 ;
"RTN","DGPTF2",24,0)
DO I DG2]"" W !!,"Editing patient information:" S DIE="^DPT(",DR=DG2,DA=+^DGPT(PTF,0) D ^DIE
"RTN","DGPTF2",25,0)
 W !!,"Exiting the correction process." H 2
"RTN","DGPTF2",26,0)
 Q
"RTN","DGPTF2",27,0)
DO1 I DG45]"" W !!,"Editing PTF information:" S DIE="^DGPT(",DR=DG45,DA=PTF D DIE
"RTN","DGPTF2",28,0)
 Q
"RTN","DGPTF2",29,0)
D5 G D5Q:DG45=""
"RTN","DGPTF2",30,0)
 S DIE="^DGPT(PTF,"_$S(DG9=601:"""P""",DG9=401:"""S""",1:"""M""")_",",DA(1)=PTF,DA=I1,DR=DG45
"RTN","DGPTF2",31,0)
 S Y=@(DIE_DA_",0)"),Y=$P(Y,U,$S(DG9=601!(DG9=401):1,1:10)) D D^DGPTUTL
"RTN","DGPTF2",32,0)
 W !!,"Editing ",$S(DG9=601:"Procedure",DG9=401:"Surgery",1:"Movement")," of ",Y D DIE
"RTN","DGPTF2",33,0)
D5Q Q
"RTN","DGPTF2",34,0)
 ;
"RTN","DGPTF2",35,0)
DIE D ^DIE
"RTN","DGPTF2",36,0)
D Q:'$D(Y)
"RTN","DGPTF2",37,0)
D1 K DR W !,"Do you want to stop correcting" S %=1 D YN^DICN
"RTN","DGPTF2",38,0)
 I %=1!(%=-1) S Q=1 Q
"RTN","DGPTF2",39,0)
 I %=0 W !?10,"Enter 'YES' or '^' to stop making corrections",!?10,"and   'NO'         to continue making corrections" G D1
"RTN","DGPTF2",40,0)
 Q
"RTN","DGPTF2",41,0)
PRINT W !,"Want to print error log " S %=2 D YN^DICN G PRINT:%'>0 Q:%=2
"RTN","DGPTF2",42,0)
 K IOP D ^%ZIS Q:IO']""  S Y=DT X ^DD("DD") W @IOF W !!,"Error log for PTF record ",PTF,"  "_$P(^DPT(DFN,0),U,1)_"  ",Y,!! S DGERR=-1,J=PTF D LOG^DGPTFTR D ^%ZISC
"RTN","DGPTF2",43,0)
 S IOP="" D ^%ZIS K IOP I $L(DGVO_DGVI)>4 S X=132 X ^%ZOSF("RM")
"RTN","DGPTF2",44,0)
 Q
"RTN","DGPTF2",45,0)
CLS I $D(^DGM("PT",DFN)) W !!,"Not all messages have been cleared up for this patient--cannot close.",*7,*7 S DGPTF=DFN,X="??" K DGALL D HELP^DGPTMSGD K DGPTF G EN1:'$D(DGALL) K DGALL
"RTN","DGPTF2",46,0)
 W !,"Performing edit checks..."
"RTN","DGPTF2",47,0)
 ;-- init for Austin Edits
"RTN","DGPTF2",48,0)
 K ^TMP("AEDIT",$J),^TMP("AERROR",$J) S DGACNT=0
"RTN","DGPTF2",49,0)
 ;
"RTN","DGPTF2",50,0)
 S Y=1 D RTY^DGPTUTL
"RTN","DGPTF2",51,0)
 S J=PTF,DGERR=-1 D LOG^DGPTFTR K DGLOGIC D LO^DGUTL K T1,T2 I DGERR>0 K DGERR H 4 D DGPTF2 G EN1
"RTN","DGPTF2",52,0)
 ;
"RTN","DGPTF2",53,0)
 ;-- new austin edit checks
"RTN","DGPTF2",54,0)
 D ^DGPTAE I DGERR>0 K DGERR D DGPTF2 G EN1
"RTN","DGPTF2",55,0)
 ;
"RTN","DGPTF2",56,0)
 K DGERR S DR=$S($P(^DGPT(PTF,0),U,7):"",1:";7////"_DUZ_";8///T"),DA=PTF,DIE="^DGPT(",DP=45 D ^DIE K DR
"RTN","DGPTF2",57,0)
 S DIC(0)="LN",(DINUM,X)=PTF,DIC="^DGP(45.84," K DD,DO D FILE^DICN K DINUM
"RTN","DGPTF2",58,0)
 I Y>0 S DA=+Y,DR="2///NOW;3////"_DUZ,DIE="^DGP(45.84," D ^DIE K DR
"RTN","DGPTF2",59,0)
 K DIE,DIC
"RTN","DGPTF2",60,0)
 I '$D(^DGP(45.84,PTF)) W !,"Cannot close without proper fileman access",*7 D HANG^DGPTUTL G EN1
"RTN","DGPTF2",61,0)
 F I=0,.11,.52,.321,.32,.36,57,.3 S:$D(^DPT(DFN,I)) ^DGP(45.84,PTF,$S(I=0:10,1:I))=^DPT(DFN,I)
"RTN","DGPTF2",62,0)
 S $P(^DGP(45.84,PTF,0),U,6)=DRG
"RTN","DGPTF2",63,0)
 W !,"****** PTF CLOSED OUT ******" D HANG^DGPTUTL
"RTN","DGPTF2",64,0)
 I DGREL S (DGN,DGST)=1 G EN1
"RTN","DGPTF2",65,0)
 K DGRTY,DGRTY0 G Q^DGPTF
"RTN","DGPTF2",66,0)
EN1 K DGRTY,DGRTY0 G EN1^DGPTF4
"VER")
8.0^22.0
**END**
**END**
