EMERGENCY Released PRCA*4.5*191 SEQ #172
Extracted from mail message
**KIDS**:PRCA*4.5*191^

**INSTALL NAME**
PRCA*4.5*191
"BLD",4899,0)
PRCA*4.5*191^ACCOUNTS RECEIVABLE^0^3030807^y
"BLD",4899,1,0)
^^2^2^3030718^^
"BLD",4899,1,1,0)
This patch contains all of the date changes to comply with the new End
"BLD",4899,1,2,0)
of Month EOAM for the ARDC, Bad Debt, and OIG reports.
"BLD",4899,4,0)
^9.64PA^^
"BLD",4899,"ABPKG")
n
"BLD",4899,"KRN",0)
^9.67PA^8989.52^19
"BLD",4899,"KRN",.4,0)
.4
"BLD",4899,"KRN",.401,0)
.401
"BLD",4899,"KRN",.402,0)
.402
"BLD",4899,"KRN",.403,0)
.403
"BLD",4899,"KRN",.5,0)
.5
"BLD",4899,"KRN",.84,0)
.84
"BLD",4899,"KRN",3.6,0)
3.6
"BLD",4899,"KRN",3.8,0)
3.8
"BLD",4899,"KRN",9.2,0)
9.2
"BLD",4899,"KRN",9.8,0)
9.8
"BLD",4899,"KRN",9.8,"NM",0)
^9.68A^11^11
"BLD",4899,"KRN",9.8,"NM",1,0)
RCRJR^^0^B19015855
"BLD",4899,"KRN",9.8,"NM",2,0)
RCRJRCO^^0^B52961813
"BLD",4899,"KRN",9.8,"NM",3,0)
RCRJRCOL^^0^B31058106
"BLD",4899,"KRN",9.8,"NM",4,0)
RCRJRBDR^^0^B71003798
"BLD",4899,"KRN",9.8,"NM",5,0)
RCRJRBDE^^0^B12051207
"BLD",4899,"KRN",9.8,"NM",6,0)
RCXFMSSV^^0^B45443336
"BLD",4899,"KRN",9.8,"NM",7,0)
RCRJRCOR^^0^B58736197
"BLD",4899,"KRN",9.8,"NM",8,0)
RCRJRCO2^^0^B27661034
"BLD",4899,"KRN",9.8,"NM",9,0)
RCRJRBDT^^0^B19950659
"BLD",4899,"KRN",9.8,"NM",10,0)
RCXFMSWR^^0^B16841638
"BLD",4899,"KRN",9.8,"NM",11,0)
RCXFMSTX^^0^B24394296
"BLD",4899,"KRN",9.8,"NM","B","RCRJR",1)

"BLD",4899,"KRN",9.8,"NM","B","RCRJRBDE",5)

"BLD",4899,"KRN",9.8,"NM","B","RCRJRBDR",4)

"BLD",4899,"KRN",9.8,"NM","B","RCRJRBDT",9)

"BLD",4899,"KRN",9.8,"NM","B","RCRJRCO",2)

"BLD",4899,"KRN",9.8,"NM","B","RCRJRCO2",8)

"BLD",4899,"KRN",9.8,"NM","B","RCRJRCOL",3)

"BLD",4899,"KRN",9.8,"NM","B","RCRJRCOR",7)

"BLD",4899,"KRN",9.8,"NM","B","RCXFMSSV",6)

"BLD",4899,"KRN",9.8,"NM","B","RCXFMSTX",11)

"BLD",4899,"KRN",9.8,"NM","B","RCXFMSWR",10)

"BLD",4899,"KRN",19,0)
19
"BLD",4899,"KRN",19.1,0)
19.1
"BLD",4899,"KRN",101,0)
101
"BLD",4899,"KRN",409.61,0)
409.61
"BLD",4899,"KRN",771,0)
771
"BLD",4899,"KRN",870,0)
870
"BLD",4899,"KRN",8989.51,0)
8989.51
"BLD",4899,"KRN",8989.52,0)
8989.52
"BLD",4899,"KRN",8994,0)
8994
"BLD",4899,"KRN","B",.4,.4)

"BLD",4899,"KRN","B",.401,.401)

"BLD",4899,"KRN","B",.402,.402)

"BLD",4899,"KRN","B",.403,.403)

"BLD",4899,"KRN","B",.5,.5)

"BLD",4899,"KRN","B",.84,.84)

"BLD",4899,"KRN","B",3.6,3.6)

"BLD",4899,"KRN","B",3.8,3.8)

"BLD",4899,"KRN","B",9.2,9.2)

"BLD",4899,"KRN","B",9.8,9.8)

"BLD",4899,"KRN","B",19,19)

"BLD",4899,"KRN","B",19.1,19.1)

"BLD",4899,"KRN","B",101,101)

"BLD",4899,"KRN","B",409.61,409.61)

"BLD",4899,"KRN","B",771,771)

"BLD",4899,"KRN","B",870,870)

"BLD",4899,"KRN","B",8989.51,8989.51)

"BLD",4899,"KRN","B",8989.52,8989.52)

"BLD",4899,"KRN","B",8994,8994)

"BLD",4899,"QUES",0)
^9.62^^
"BLD",4899,"REQB",0)
^9.611^7^7
"BLD",4899,"REQB",1,0)
PRCA*4.5*101^1
"BLD",4899,"REQB",2,0)
PRCA*4.5*153^1
"BLD",4899,"REQB",3,0)
PRCA*4.5*182^1
"BLD",4899,"REQB",4,0)
PRCA*4.5*176^1
"BLD",4899,"REQB",5,0)
PRCA*4.5*174^1
"BLD",4899,"REQB",6,0)
PRCA*4.5*170^1
"BLD",4899,"REQB",7,0)
PRCA*4.5*178^1
"BLD",4899,"REQB","B","PRCA*4.5*101",1)

"BLD",4899,"REQB","B","PRCA*4.5*153",2)

"BLD",4899,"REQB","B","PRCA*4.5*170",6)

"BLD",4899,"REQB","B","PRCA*4.5*174",5)

"BLD",4899,"REQB","B","PRCA*4.5*176",4)

"BLD",4899,"REQB","B","PRCA*4.5*178",7)

"BLD",4899,"REQB","B","PRCA*4.5*182",3)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
191^3030807^1258
"PKG",142,22,1,"PAH",1,1,0)
^^2^2^3030807
"PKG",142,22,1,"PAH",1,1,1,0)
This patch contains all of the date changes to comply with the new End
"PKG",142,22,1,"PAH",1,1,2,0)
of Month EOAM for the ARDC, Bad Debt, and OIG reports.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","RCRJR")
0^1^B19015855
"RTN","RCRJR",1,0)
RCRJR ;WISC/RFJ,TJK-nightly process, monthly data extractors ;1 Mar 98
"RTN","RCRJR",2,0)
 ;;4.5;Accounts Receivable;**101,103,78,153,191**;Mar 20, 1995
"RTN","RCRJR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJR",4,0)
 Q
"RTN","RCRJR",5,0)
 ;
"RTN","RCRJR",6,0)
 ;
"RTN","RCRJR",7,0)
START ;  start the nightly process
"RTN","RCRJR",8,0)
 ;  called by PRCABJ
"RTN","RCRJR",9,0)
 N X,Y
"RTN","RCRJR",10,0)
 ;
"RTN","RCRJR",11,0)
 ;  if the 15th of the month, warn user of deletion
"RTN","RCRJR",12,0)
 I $E(DT,6,7)=15 D CLEANXMB
"RTN","RCRJR",13,0)
 ;
"RTN","RCRJR",14,0)
 ;  clean up old mailman messages on day 1
"RTN","RCRJR",15,0)
 ;  monthly transmission of reports on day 1
"RTN","RCRJR",16,0)
 I +$E(DT,6,7)=$E($$LDATE(DT)+1,6,7) D
"RTN","RCRJR",17,0)
 .   ;  clean up old mailman messages
"RTN","RCRJR",18,0)
 .   D CLEANXMB
"RTN","RCRJR",19,0)
 .   ;  NDB and monthly FMS summary documents, bad debt report
"RTN","RCRJR",20,0)
 .   ;  oig extract (end of quarter)
"RTN","RCRJR",21,0)
 .   D QUEUE("AR Data Collector","DQ^RCRJRCO")
"RTN","RCRJR",22,0)
 ;
"RTN","RCRJR",23,0)
 ;  monthly transmission on the second to last workday
"RTN","RCRJR",24,0)
 I +$E(DT,6,7)=$E($$LDAY(DT),6,7) D
"RTN","RCRJR",25,0)
 .   ;  bad debt report sent to FMS
"RTN","RCRJR",26,0)
 .   D QUEUE("Bad Debt Report","BADDEBT^RCXFMSSV")
"RTN","RCRJR",27,0)
 ;
"RTN","RCRJR",28,0)
 ;  quarterly oig transaction report on 15th
"RTN","RCRJR",29,0)
 I $E(DT,4,5)#3=1,$E(DT,6,7)=15 D QUEUE("AR OIG Transaction Extract","EN2^RCNRIG")
"RTN","RCRJR",30,0)
 ;
"RTN","RCRJR",31,0)
 ;  reports sent on tuesday and thursdays (dmc)
"RTN","RCRJR",32,0)
 S X=DT D DW^%DTC
"RTN","RCRJR",33,0)
 I $E(X)="T" D
"RTN","RCRJR",34,0)
 .   ;  dmc 90 day reports
"RTN","RCRJR",35,0)
 .   N ZTSAVE
"RTN","RCRJR",36,0)
 .   I '$O(^RC(342,0)) Q
"RTN","RCRJR",37,0)
 .   ;  tUesday
"RTN","RCRJR",38,0)
 .   I $E(X,2)="U",$D(^RCD(340,"DMC")) D  Q
"RTN","RCRJR",39,0)
 .   .   S ZTSAVE("RCDOC")="W" D QUEUE("DMC 90 Day Reports","ENTER^RCDMC90")
"RTN","RCRJR",40,0)
 .   S X1=DT,X2=7 D C^%DTC I $E(DT,4,5)=$E(X,4,5) Q
"RTN","RCRJR",41,0)
 .   S ZTSAVE("RCDOC")="M" D QUEUE("DMC 90 Day Reports","ENTER^RCDMC90")
"RTN","RCRJR",42,0)
 Q
"RTN","RCRJR",43,0)
 ;
"RTN","RCRJR",44,0)
 ;
"RTN","RCRJR",45,0)
QUEUE(ZTDESC,ZTRTN) ;  create taskmanager task
"RTN","RCRJR",46,0)
 N %X,%Y,Y,ZTSK
"RTN","RCRJR",47,0)
 S ZTIO="",ZTDTH=$H
"RTN","RCRJR",48,0)
 D ^%ZTLOAD
"RTN","RCRJR",49,0)
 D ^%ZISC
"RTN","RCRJR",50,0)
 Q
"RTN","RCRJR",51,0)
 ;
"RTN","RCRJR",52,0)
 ;
"RTN","RCRJR",53,0)
CLEANXMB ;  clean up old mailman messages generated by AR
"RTN","RCRJR",54,0)
 N SUBJECT,VERIFY
"RTN","RCRJR",55,0)
 ;
"RTN","RCRJR",56,0)
 ;  delete the AR Data Collector Detail Report
"RTN","RCRJR",57,0)
 S SUBJECT="ARDC Detail Report For "
"RTN","RCRJR",58,0)
 S VERIFY="I $E(DATA,65)=""."",$E(DATA,76)=""."""
"RTN","RCRJR",59,0)
 D GETXMZ(SUBJECT,VERIFY)
"RTN","RCRJR",60,0)
 ;
"RTN","RCRJR",61,0)
 ;  delete the mccr ndb return reports
"RTN","RCRJR",62,0)
 S SUBJECT="MCCR NDB Site "
"RTN","RCRJR",63,0)
 S VERIFY="I $E(DATA,1,14)=""MCCR NDB Site """
"RTN","RCRJR",64,0)
 D GETXMZ(SUBJECT,VERIFY)
"RTN","RCRJR",65,0)
 ;
"RTN","RCRJR",66,0)
 ;  delete the nightly interest/admin/penalty messages
"RTN","RCRJR",67,0)
 S SUBJECT="AR Nightly Interest/Admin/Pen"
"RTN","RCRJR",68,0)
 S VERIFY="I $E(DATA,1,18)=""BILL      DATEPREP"""
"RTN","RCRJR",69,0)
 D GETXMZ(SUBJECT,VERIFY)
"RTN","RCRJR",70,0)
 Q
"RTN","RCRJR",71,0)
 ;
"RTN","RCRJR",72,0)
 ;
"RTN","RCRJR",73,0)
GETXMZ(RCSUBJCT,RCVERIFY) ;  find a message to delete
"RTN","RCRJR",74,0)
 ;  loop through a subject, execute a check on the message, kill it
"RTN","RCRJR",75,0)
 N DATA,RCSUBJ,RCXMZ
"RTN","RCRJR",76,0)
 S RCSUBJ=RCSUBJCT
"RTN","RCRJR",77,0)
 F  S RCSUBJ=$O(^XMB(3.9,"B",RCSUBJ)) Q:$E(RCSUBJ,1,$L(RCSUBJCT))'=RCSUBJCT  D
"RTN","RCRJR",78,0)
 .   S RCXMZ=0
"RTN","RCRJR",79,0)
 .   F  S RCXMZ=$O(^XMB(3.9,"B",RCSUBJ,RCXMZ)) Q:'RCXMZ  D
"RTN","RCRJR",80,0)
 .   .   S DATA=$G(^XMB(3.9,RCXMZ,2,1,0))
"RTN","RCRJR",81,0)
 .   .   X RCVERIFY
"RTN","RCRJR",82,0)
 .   .   ;  message found
"RTN","RCRJR",83,0)
 .   .   I $T D
"RTN","RCRJR",84,0)
 .   .   .   ;  if the current date is not the first, warn the user
"RTN","RCRJR",85,0)
 .   .   .   ;  if the current date is the first, kill the message
"RTN","RCRJR",86,0)
 .   .   .   I $E(DT,6,7)'=$E($$LDATE(DT)+1,6,7) D WARNKILL(RCXMZ) Q
"RTN","RCRJR",87,0)
 .   .   .   ;
"RTN","RCRJR",88,0)
 .   .   .   ;  only kill the message if it was created before the
"RTN","RCRJR",89,0)
 .   .   .   ;  15th day of the previous month (since no warning
"RTN","RCRJR",90,0)
 .   .   .   ;  message would of been generated).
"RTN","RCRJR",91,0)
 .   .   .   I $P($$ZNODE^XMXUTIL2(RCXMZ),"^",3)>($E($$FMDIFF^XLFDT(DT,-1),1,5)_19.999999) Q
"RTN","RCRJR",92,0)
 .   .   .   ;
"RTN","RCRJR",93,0)
 .   .   .   D KILLXMZ(RCXMZ)
"RTN","RCRJR",94,0)
 Q
"RTN","RCRJR",95,0)
 ;
"RTN","RCRJR",96,0)
 ;
"RTN","RCRJR",97,0)
KILLXMZ(XMZ) ;  kills a message and responses
"RTN","RCRJR",98,0)
 N K,X,XMABORT,XMKILL,Y
"RTN","RCRJR",99,0)
 S XMABORT=0,(XMKILL("MSG"),XMKILL("RESP"))=0
"RTN","RCRJR",100,0)
 D KILL^XMA32A(XMZ,.XMKILL,XMABORT)
"RTN","RCRJR",101,0)
 Q
"RTN","RCRJR",102,0)
 ;
"RTN","RCRJR",103,0)
 ;
"RTN","RCRJR",104,0)
WARNKILL(RCXMZ) ;  enter response to the message warning the user the message
"RTN","RCRJR",105,0)
 ;   will deleted on the first of the month
"RTN","RCRJR",106,0)
 N %,%H,%I,I,MESSAGE,XMZ2,Y
"RTN","RCRJR",107,0)
 ;
"RTN","RCRJR",108,0)
 ;  get the first of next month (add 30 days and reset day to 1)
"RTN","RCRJR",109,0)
 ;S Y=$E($$FMADD^XLFDT(DT,30),1,5)_"01" D DD^%DT
"RTN","RCRJR",110,0)
 S Y=$$LDATE(DT)+1 D DD^%DT
"RTN","RCRJR",111,0)
 ;  create response
"RTN","RCRJR",112,0)
 S MESSAGE(1)="WARNING, This message will be deleted on "_Y_".  Please save"
"RTN","RCRJR",113,0)
 S MESSAGE(2)="the data in this message to an excel spreadsheet or word document"
"RTN","RCRJR",114,0)
 S MESSAGE(3)="prior to "_Y_"."
"RTN","RCRJR",115,0)
 S %=$$ENT^XMA2R(RCXMZ,"Message Deletion",.MESSAGE,"","AR Package")
"RTN","RCRJR",116,0)
 Q
"RTN","RCRJR",117,0)
LDATE(X) ; DETERMINE CUT-OFF DATE FOR THE MONTH
"RTN","RCRJR",118,0)
 S X=$E(X,1,5)_$P("31^28^31^30^31^30^31^31^30^31^30^31","^",+$E(X,4,5))
"RTN","RCRJR",119,0)
 I +$E(X,6,7)=28,$E(X,2,3)#4=0 S $E(X,6,7)=29
"RTN","RCRJR",120,0)
 S X=$$WORKPLUS^XUWORKDY(X,-3)
"RTN","RCRJR",121,0)
 Q X
"RTN","RCRJR",122,0)
LDAY(X) ;SECOND LAST WORKDAY OF THE MONTH
"RTN","RCRJR",123,0)
 S X=$E(X,1,5)_$P("31^28^31^30^31^30^31^31^30^31^30^31","^",+$E(X,4,5))
"RTN","RCRJR",124,0)
 I +$E(X,6,7)=28,$E(X,2,3)#4=0 S $E(X,6,7)=29
"RTN","RCRJR",125,0)
 S X=$$WORKPLUS^XUWORKDY(X,-1)
"RTN","RCRJR",126,0)
 Q X
"RTN","RCRJRBDE")
0^5^B12051207
"RTN","RCRJRBDE",1,0)
RCRJRBDE ;WISC/RFJ,TJK-bad debt edit the report ;1 Feb 98
"RTN","RCRJRBDE",2,0)
 ;;4.5;Accounts Receivable;**101,191**;Mar 20, 1995
"RTN","RCRJRBDE",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRBDE",4,0)
 Q
"RTN","RCRJRBDE",5,0)
 ;
"RTN","RCRJRBDE",6,0)
 ;
"RTN","RCRJRBDE",7,0)
EDIT ;  over-ride values, called from menu option
"RTN","RCRJRBDE",8,0)
 W !!,"This option will allow you to over-ride the current month allowance"
"RTN","RCRJRBDE",9,0)
 W !,"estimate for the Bad Debt Report.  If you change the allowance estimate,"
"RTN","RCRJRBDE",10,0)
 W !,"it will change the value sent to FMS (on the last workday of the month).",!
"RTN","RCRJRBDE",11,0)
 ;
"RTN","RCRJRBDE",12,0)
 N DIR,X,Y
"RTN","RCRJRBDE",13,0)
 ;I $E(DT,6,7)'<$$WD3^RCRJRBD D  Q
"RTN","RCRJRBDE",14,0)
 I $E(DT,6,7)<$E($$LDATE^RCRJR(DT)+1,6,7)!($E(DT,6,7)'<$E($$LDAY^RCRJR(DT),6,7)) D  Q
"RTN","RCRJRBDE",15,0)
 .   W !,"The Bad Debt Report is submitted to FMS on the second last workday of the"
"RTN","RCRJRBDE",16,0)
 .   W !,"month.  You can only use this option to change the data from the day"
"RTN","RCRJRBDE",17,0)
 .   W !,"after the EOAM cut off date to the second last workday of the month."
"RTN","RCRJRBDE",18,0)
 .   ;  ask to print report
"RTN","RCRJRBDE",19,0)
 .   S DIR(0)="YO",DIR("B")="NO"
"RTN","RCRJRBDE",20,0)
 .   S DIR("A")="  Do you want to print the report for last month"
"RTN","RCRJRBDE",21,0)
 .   W ! D ^DIR
"RTN","RCRJRBDE",22,0)
 .   I Y=1 D PRINT^RCRJRBDR
"RTN","RCRJRBDE",23,0)
 ;
"RTN","RCRJRBDE",24,0)
 N CHANGED,D,D0,DA,DATA,DI,DIC,DIE,DQ,DR,RCRJALLO,RCRJFEND,X,Y
"RTN","RCRJRBDE",25,0)
 F  D  Q:$G(RCRJFEND)
"RTN","RCRJRBDE",26,0)
 .   ;  check to see if report is running
"RTN","RCRJRBDE",27,0)
 .   L +^RC(348.1):5
"RTN","RCRJRBDE",28,0)
 .   I '$T W !,"The Bad Debt Report is currently running or being edit by another user.",!,"Try again later." S RCRJFEND=1 Q
"RTN","RCRJRBDE",29,0)
 .   ;
"RTN","RCRJRBDE",30,0)
 .   S (DIC,DIE)="^RC(348.1,",DIC(0)="QEAM"
"RTN","RCRJRBDE",31,0)
 .   W ! D ^DIC
"RTN","RCRJRBDE",32,0)
 .   I Y<1 L -^RC(348.1) S RCRJFEND=1 Q
"RTN","RCRJRBDE",33,0)
 .   S DA=+Y
"RTN","RCRJRBDE",34,0)
 .   ;  store current estimate allowance and show report
"RTN","RCRJRBDE",35,0)
 .   S RCRJALLO=+$P(^RC(348.1,+Y,0),"^",8)
"RTN","RCRJRBDE",36,0)
 .   W !!?20,"This what the CURRENT report looks like:"
"RTN","RCRJRBDE",37,0)
 .   W !?20,"========================================"
"RTN","RCRJRBDE",38,0)
 .   D SHOW(DA)
"RTN","RCRJRBDE",39,0)
 .   W !!,"You now have the option to over-ride the estimated allowance:"
"RTN","RCRJRBDE",40,0)
 .   S DR=".08;" D ^DIE
"RTN","RCRJRBDE",41,0)
 .   L -^RC(348.1)
"RTN","RCRJRBDE",42,0)
 .   ;  no changes to data
"RTN","RCRJRBDE",43,0)
 .   I +$P(^RC(348.1,DA,0),"^",8)=RCRJALLO W "...No changes made." Q
"RTN","RCRJRBDE",44,0)
 .   ;  set flag to show changes made
"RTN","RCRJRBDE",45,0)
 .   S DR=".1////1;" D ^DIE
"RTN","RCRJRBDE",46,0)
 .   ;  show new report
"RTN","RCRJRBDE",47,0)
 .   W !!?20,"This is what the NEW report looks like:"
"RTN","RCRJRBDE",48,0)
 .   W !?20,"======================================="
"RTN","RCRJRBDE",49,0)
 .   D SHOW(DA)
"RTN","RCRJRBDE",50,0)
 Q
"RTN","RCRJRBDE",51,0)
 ;
"RTN","RCRJRBDE",52,0)
 ;
"RTN","RCRJRBDE",53,0)
SHOW(DA) ;  show the values for entry
"RTN","RCRJRBDE",54,0)
 S DATA=$G(^RC(348.1,DA,0))
"RTN","RCRJRBDE",55,0)
 W !!,"Allowance for Bad Debt - SGL ",$P(DATA,"^"),":"
"RTN","RCRJRBDE",56,0)
 W !,"----------------------------------------------------"
"RTN","RCRJRBDE",57,0)
 S CHANGED="  " I $P(DATA,"^",10) S CHANGED="**"
"RTN","RCRJRBDE",58,0)
 W !,"Allowance Estimate for Month",?35,":",$J($P(DATA,"^",8),16,2)," ",CHANGED," (Normally Credit Value)"
"RTN","RCRJRBDE",59,0)
 W !,"Bad Debt Write-Off FYTD (Plus)",?35,":",$J($P(DATA,"^",9),16,2),"    (Normally Debit Value )"
"RTN","RCRJRBDE",60,0)
 W !,"----------------------------------------------------"
"RTN","RCRJRBDE",61,0)
 W !,"Transmitted Amount to FMS for Month",?35,":",$J($P(DATA,"^",8)+$P(DATA,"^",9),16,2)," ",CHANGED," (Normally Credit Value)"
"RTN","RCRJRBDE",62,0)
 I $P(DATA,"^",10) W !?53,"**  Changed Locally"
"RTN","RCRJRBDE",63,0)
 Q
"RTN","RCRJRBDR")
0^4^B71003798
"RTN","RCRJRBDR",1,0)
RCRJRBDR ;WISC/RFJ,TJK-bad debt report generator ;1 Feb 98
"RTN","RCRJRBDR",2,0)
 ;;4.5;Accounts Receivable;**101,139,170,191**;Mar 20, 1995
"RTN","RCRJRBDR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRBDR",4,0)
 Q
"RTN","RCRJRBDR",5,0)
 ;
"RTN","RCRJRBDR",6,0)
 ;
"RTN","RCRJRBDR",7,0)
PRINT ;  print report on printer, called from menu option
"RTN","RCRJRBDR",8,0)
 N RCRJDATE
"RTN","RCRJRBDR",9,0)
 W !!,"This option will print the Bad Debt Report.  This report is automatically"
"RTN","RCRJRBDR",10,0)
 W !,"generated on the day after the EOAM.  The estimated value can be locally"
"RTN","RCRJRBDR",11,0)
 W !,"changed from the first work day after the EOAM to the second to last workday "
"RTN","RCRJRBDR",12,0)
 W !,"of the month."
"RTN","RCRJRBDR",13,0)
 W !,"On the last work day of the month, the report is transmitted to FMS.",!
"RTN","RCRJRBDR",14,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCRJRBDR",15,0)
 I $D(IO("Q")) D  Q
"RTN","RCRJRBDR",16,0)
 .   S ZTRTN="DQ^RCRJRBDR",ZTDESC="Bad Debt Report"
"RTN","RCRJRBDR",17,0)
 .   D ^%ZTLOAD
"RTN","RCRJRBDR",18,0)
 ;
"RTN","RCRJRBDR",19,0)
 W !,"please wait"
"RTN","RCRJRBDR",20,0)
 D DQ
"RTN","RCRJRBDR",21,0)
 Q
"RTN","RCRJRBDR",22,0)
 ;
"RTN","RCRJRBDR",23,0)
 ;
"RTN","RCRJRBDR",24,0)
DQ ;  generate the report
"RTN","RCRJRBDR",25,0)
 ;  rcrjfmm = flag to put in mail message (if $g(rcrjfmm)) (optional)
"RTN","RCRJRBDR",26,0)
 ;  rcrjdate = date month and year for report (optional)
"RTN","RCRJRBDR",27,0)
 ;  rcrjfxsv = fms document id number if sent to fms (optional)
"RTN","RCRJRBDR",28,0)
 ;             (newed and set by rcxfmssv, label Q)
"RTN","RCRJRBDR",29,0)
 ;
"RTN","RCRJRBDR",30,0)
 N %,%I,CHANGED,DATA,DATA1319,DATA1338,DATA1339,DATAHSIF,DATALTC,DATEREPT,ENDDATE,X
"RTN","RCRJRBDR",31,0)
 N LINE,RCRJFLAG,SCREEN,SPACE,Y
"RTN","RCRJRBDR",32,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRBDR",33,0)
 S SPACE="",$P(SPACE," ",81)=""
"RTN","RCRJRBDR",34,0)
 ;  the date of the report is for previous month if the DT is before the EOAM date of the current month,  it is for the current month if the date is after the EOAM cut-off date.
"RTN","RCRJRBDR",35,0)
 I $G(RCRJDATE) S RCRJDATE=$E($$LDATE^RCRJR(RCRJDATE),1,5)_"00"
"RTN","RCRJRBDR",36,0)
 I '$G(RCRJDATE) D
"RTN","RCRJRBDR",37,0)
 .I $E(DT,6,7)'>$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$$PREVMONT^RCRJRBD(DT)
"RTN","RCRJRBDR",38,0)
 .I $E(DT,6,7)>$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$E($$LDATE^RCRJR(DT),1,5)_"00"
"RTN","RCRJRBDR",39,0)
 S Y=$E(RCRJDATE,1,5)_"00" D DD^%DT S DATEREPT=Y
"RTN","RCRJRBDR",40,0)
 S LINE=0
"RTN","RCRJRBDR",41,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",42,0)
 D SETLINE($E(SPACE,1,32)_"Bad Debt Report")
"RTN","RCRJRBDR",43,0)
 D SETLINE($E(SPACE,1,13)_"Allowance for Bad Debt and Contract Adjustment Report")
"RTN","RCRJRBDR",44,0)
 D SETLINE($E(SPACE,1,27)_"for the month of "_DATEREPT)
"RTN","RCRJRBDR",45,0)
 I $D(RCRJFXSV) D
"RTN","RCRJRBDR",46,0)
 .   D SETLINE(" ")
"RTN","RCRJRBDR",47,0)
 .   I $E(RCRJFXSV,1,2)="SV" D SETLINE($E(SPACE,1,13)_"***** Report sent to FMS, doc id: "_RCRJFXSV_" *****") Q
"RTN","RCRJRBDR",48,0)
 .   ;  report errored out or did not get generated to fms
"RTN","RCRJRBDR",49,0)
 .   D SETLINE($E(SPACE,1,10)_"***** NOTICE:  Report was NOT sent to FMS, the message is *****")
"RTN","RCRJRBDR",50,0)
 .   D SETLINE($E(SPACE,1,10)_"***** "_RCRJFXSV_" *****")
"RTN","RCRJRBDR",51,0)
 ;
"RTN","RCRJRBDR",52,0)
 ;  show mccf
"RTN","RCRJRBDR",53,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",54,0)
 D SETLINE($E(SPACE,1,26)_"Medical Care Collection Fund")
"RTN","RCRJRBDR",55,0)
 D SETLINE($E(SPACE,1,33)_"Fund 36_5287")
"RTN","RCRJRBDR",56,0)
 D SETLINE($E(SPACE,1,26)_"----------------------------")
"RTN","RCRJRBDR",57,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",58,0)
 D SETLINE("Calculated           "_$J("            ",18)_$J(" Third Party",18))
"RTN","RCRJRBDR",59,0)
 D SETLINE("Percentages          "_$J(" First Party",18)_$J("Contract Adj",18)_$J("Tort Feasors",18))
"RTN","RCRJRBDR",60,0)
 D SETLINE("For                  "_$J("    SGL 1319",18)_$J("    SGL 1339",18)_$J("    SGL 1338",18))
"RTN","RCRJRBDR",61,0)
 D SETLINE("---------------------"_$J("------------",18)_$J("------------",18)_$J("------------",18))
"RTN","RCRJRBDR",62,0)
 S DATA1319=$G(^RC(348.1,+$O(^RC(348.1,"B",1319,0)),0))
"RTN","RCRJRBDR",63,0)
 S DATA1338=$G(^RC(348.1,+$O(^RC(348.1,"B",1338,0)),0))
"RTN","RCRJRBDR",64,0)
 S DATA1339=$G(^RC(348.1,+$O(^RC(348.1,"B",1339,0)),0))
"RTN","RCRJRBDR",65,0)
 D SETLINE("Collection          %"_$J($P(DATA1319,"^",2),18,2)_$J($P(DATA1339,"^",2),18,2)_$J($P(DATA1338,"^",2),18,2))
"RTN","RCRJRBDR",66,0)
 D SETLINE("Write-Off           %"_$J($P(DATA1319,"^",3),18,2)_$J($P(DATA1339,"^",3),18,2)_$J($P(DATA1338,"^",3),18,2))
"RTN","RCRJRBDR",67,0)
 D SETLINE("Contract Adjustment %"_$J($P(DATA1319,"^",4),18,2)_$J($P(DATA1339,"^",4),18,2)_$J($P(DATA1338,"^",4),18,2))
"RTN","RCRJRBDR",68,0)
 D SETLINE("---------------------"_$J("------------",18)_$J("------------",18)_$J("------------",18))
"RTN","RCRJRBDR",69,0)
 D SETLINE("TOTAL               %"_$J(100,18,2)_$J(100,18,2)_$J(100,18,2))
"RTN","RCRJRBDR",70,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",71,0)
 ;
"RTN","RCRJRBDR",72,0)
 ;  show hsif
"RTN","RCRJRBDR",73,0)
 D SETLINE($E(SPACE,1,26)_"Health Services Improvement Fund 5358.1")
"RTN","RCRJRBDR",74,0)
 D SETLINE($E(SPACE,1,26)_"   Extended (LTC) Care Fund 4032")
"RTN","RCRJRBDR",75,0)
 D SETLINE($E(SPACE,1,26)_"---------------------------------------")
"RTN","RCRJRBDR",76,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",77,0)
 D SETLINE("Calculated           "_$J(" Fund 5358.1",18)_$J("   Fund 4032",18))
"RTN","RCRJRBDR",78,0)
 D SETLINE("Percentages          "_$J(" First Party",18)_$J(" First Party",18))
"RTN","RCRJRBDR",79,0)
 D SETLINE("For                  "_$J("    SGL 1319",18)_$J("    SGL 1319",18))
"RTN","RCRJRBDR",80,0)
 D SETLINE("---------------------"_$J("------------",18)_$J("------------",18))
"RTN","RCRJRBDR",81,0)
 S DATAHSIF=$G(^RC(348.1,+$O(^RC(348.1,"B",1319.1,0)),0))
"RTN","RCRJRBDR",82,0)
 S DATALTC=$G(^RC(348.1,+$O(^RC(348.1,"B",1319.2,0)),0))
"RTN","RCRJRBDR",83,0)
 D SETLINE("Collection          %"_$J($P(DATAHSIF,"^",2),18,2)_$J($P(DATALTC,"^",2),18,2))
"RTN","RCRJRBDR",84,0)
 D SETLINE("Write-Off           %"_$J($P(DATAHSIF,"^",3),18,2)_$J($P(DATALTC,"^",3),18,2))
"RTN","RCRJRBDR",85,0)
 D SETLINE("Contract Adjustment %"_$J($P(DATAHSIF,"^",4),18,2)_$J($P(DATALTC,"^",4),18,2))
"RTN","RCRJRBDR",86,0)
 D SETLINE("---------------------"_$J("------------",18)_$J("------------",18))
"RTN","RCRJRBDR",87,0)
 D SETLINE("TOTAL               %"_$J(100,18,2)_$J(100,18,2))
"RTN","RCRJRBDR",88,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",89,0)
 ;
"RTN","RCRJRBDR",90,0)
 ;  show totals
"RTN","RCRJRBDR",91,0)
 ;  1319 mccf allowance
"RTN","RCRJRBDR",92,0)
 D SETLINE("Allowance for Bad Debt - First Party (SGL 1319 MCCF):")
"RTN","RCRJRBDR",93,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",94,0)
 S CHANGED="  " I $P(DATA1319,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",95,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATA1319,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",96,0)
 D SETLINE($E("Bad Debt Write-Off (Plus)  "_SPACE,1,35)_":"_$J($P(DATA1319,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",97,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",98,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATA1319,"^",8)+$P(DATA1319,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",99,0)
 I $P(DATA1319,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",100,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",101,0)
 ;
"RTN","RCRJRBDR",102,0)
 ;  1319 hsif allowance
"RTN","RCRJRBDR",103,0)
 D SETLINE("Allowance for Bad Debt - First Party (SGL 1319 HSIF 5358.1):")
"RTN","RCRJRBDR",104,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",105,0)
 S CHANGED="  " I $P(DATAHSIF,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",106,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATAHSIF,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",107,0)
 D SETLINE($E("Bad Debt Write-Off (Plus)  "_SPACE,1,35)_":"_$J($P(DATAHSIF,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",108,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",109,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATAHSIF,"^",8)+$P(DATAHSIF,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",110,0)
 I $P(DATAHSIF,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",111,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",112,0)
 ;
"RTN","RCRJRBDR",113,0)
 ;  1319 ltc allowance
"RTN","RCRJRBDR",114,0)
 D SETLINE("Allowance for Bad Debt - First Party (SGL 1319 LTC 4032):")
"RTN","RCRJRBDR",115,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",116,0)
 S CHANGED="  " I $P(DATALTC,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",117,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATALTC,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",118,0)
 D SETLINE($E("Bad Debt Write-Off (Plus)  "_SPACE,1,35)_":"_$J($P(DATALTC,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",119,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",120,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATALTC,"^",8)+$P(DATALTC,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",121,0)
 I $P(DATALTC,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",122,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",123,0)
 ;
"RTN","RCRJRBDR",124,0)
 ;  1339 allowance
"RTN","RCRJRBDR",125,0)
 D SETLINE("Allowance for Contract Adj - Third Party (SGL 1339):")
"RTN","RCRJRBDR",126,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",127,0)
 S CHANGED="  " I $P(DATA1339,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",128,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATA1339,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",129,0)
 D SETLINE($E("Bad Debt Contract Adj (Plus)  "_SPACE,1,35)_":"_$J($P(DATA1339,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",130,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",131,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATA1339,"^",8)+$P(DATA1339,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",132,0)
 I $P(DATA1339,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",133,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",134,0)
 ;
"RTN","RCRJRBDR",135,0)
 ;  1338 allowance
"RTN","RCRJRBDR",136,0)
 D SETLINE("Allowance for Bad Debt - Tort Feasors (SGL 1338):")
"RTN","RCRJRBDR",137,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",138,0)
 S CHANGED="  " I $P(DATA1338,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",139,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATA1338,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",140,0)
 D SETLINE($E("Bad Debt Write-Off (Plus)  "_SPACE,1,35)_":"_$J($P(DATA1338,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",141,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",142,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATA1338,"^",8)+$P(DATA1338,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",143,0)
 I $P(DATA1338,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",144,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",145,0)
 D SETLINE("Report Footnotes:")
"RTN","RCRJRBDR",146,0)
 D SETLINE("-----------------")
"RTN","RCRJRBDR",147,0)
 ;
"RTN","RCRJRBDR",148,0)
 D ENDOFREP^RCRJRBDT
"RTN","RCRJRBDR",149,0)
 ;
"RTN","RCRJRBDR",150,0)
 ;  put report in mailman
"RTN","RCRJRBDR",151,0)
 I $G(RCRJFMM) D  D Q Q
"RTN","RCRJRBDR",152,0)
 .   N XMY
"RTN","RCRJRBDR",153,0)
 .   S XMY("G.RC AR DATA COLLECTOR")=""
"RTN","RCRJRBDR",154,0)
 .   S %=$$SENDMSG^RCRJRCOR("BAD DEBT REPORT",.XMY)
"RTN","RCRJRBDR",155,0)
 ;
"RTN","RCRJRBDR",156,0)
 ;  print report
"RTN","RCRJRBDR",157,0)
 S SCREEN=0 I '$D(ZTQUEUED),IO=IO(0),$E(IOST)="C" S SCREEN=1
"RTN","RCRJRBDR",158,0)
 U IO W @IOF
"RTN","RCRJRBDR",159,0)
 S LINE=1 F  S LINE=$O(^TMP($J,"RCRJRCORMM",LINE)) Q:'LINE!($G(RCRJFLAG))  D
"RTN","RCRJRBDR",160,0)
 .   I $Y>(IOSL-5) D:SCREEN PAUSE^RCRJRTR1 Q:$G(RCRJFLAG)  W @IOF F %=2:1:5 W !,^TMP($J,"RCRJRCORMM",%)
"RTN","RCRJRBDR",161,0)
 .   W !,^TMP($J,"RCRJRCORMM",LINE)
"RTN","RCRJRBDR",162,0)
 I '$G(RCRJFLAG),SCREEN R !!,"<end of report, press return to continue>",X:DTIME
"RTN","RCRJRBDR",163,0)
 D ^%ZISC
"RTN","RCRJRBDR",164,0)
 ;
"RTN","RCRJRBDR",165,0)
Q K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRBDR",166,0)
 Q
"RTN","RCRJRBDR",167,0)
 ;
"RTN","RCRJRBDR",168,0)
 ;
"RTN","RCRJRBDR",169,0)
SETLINE(DATA) ;  build the line for the report
"RTN","RCRJRBDR",170,0)
 S LINE=LINE+1,^TMP($J,"RCRJRCORMM",LINE)=DATA
"RTN","RCRJRBDR",171,0)
 Q
"RTN","RCRJRBDT")
0^9^B19950659
"RTN","RCRJRBDT",1,0)
RCRJRBDT ;WISC/RFJ-bad debt retransmit ;1 Feb 98
"RTN","RCRJRBDT",2,0)
 ;;4.5;Accounts Receivable;**101,170,191**;Mar 20, 1995
"RTN","RCRJRBDT",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRBDT",4,0)
 ;
"RTN","RCRJRBDT",5,0)
 N DA347,DATEMOYR,FMSDOCNO,GECSDATA,RCRJFSV
"RTN","RCRJRBDT",6,0)
 ;  the date of the report is for previous month if the DT is before the EOAM date of the current month,  it is for the current month if the date is after the EOAM cut-off date.
"RTN","RCRJRBDT",7,0)
 I $E(DT,6,7)'>$E($$LDATE^RCRJR(DT),6,7) S DATEMOYR=$$PREVMONT^RCRJRBD(DT)
"RTN","RCRJRBDT",8,0)
 I $E(DT,6,7)>$E($$LDATE^RCRJR(DT),6,7) S DATEMOYR=$E($$LDATE^RCRJR(DT),1,5)_"00"
"RTN","RCRJRBDT",9,0)
 ;S DATEMOYR=$$PREVMONT^RCRJRBD(DT)
"RTN","RCRJRBDT",10,0)
 W !!,"This option will retransmit the Bad Debt documents to FMS (SV23, SV27, SV2B)."
"RTN","RCRJRBDT",11,0)
 ;
"RTN","RCRJRBDT",12,0)
 ;I +$E(DT,6,7)<$$WD3^RCRJRBD D  Q
"RTN","RCRJRBDT",13,0)
 I $E(DT,6,7)<$E($$LDATE^RCRJR(DT),6,7)!($E(DT,6,7)'<$E($$LDAY^RCRJR(DT),6,7)) D  Q
"RTN","RCRJRBDT",14,0)
 .  W !,"The FMS documents will be automatically sent to FMS on the second to last ",!,"workday of this month."
"RTN","RCRJRBDT",15,0)
 ;  try and find SV document to see if its accepted
"RTN","RCRJRBDT",16,0)
 S FMSDOCNO=""
"RTN","RCRJRBDT",17,0)
 K GECSDATA
"RTN","RCRJRBDT",18,0)
 S DA347=$O(^RC(347,"D","SV-"_$E(DATEMOYR,1,5)_"01",0))
"RTN","RCRJRBDT",19,0)
 I DA347 S FMSDOCNO=$P($G(^RC(347,DA347,0)),"^",9)
"RTN","RCRJRBDT",20,0)
 ;  if there is an entry, find the code sheet in gcs to rebuild
"RTN","RCRJRBDT",21,0)
 ;  gecsdata will be the ien for file 2100.1
"RTN","RCRJRBDT",22,0)
 I FMSDOCNO'="" D DATA^GECSSGET(FMSDOCNO,0)
"RTN","RCRJRBDT",23,0)
 I $G(GECSDATA) D
"RTN","RCRJRBDT",24,0)
 .   W !!,"The SV document has been transmitted to fms, document number: "_FMSDOCNO
"RTN","RCRJRBDT",25,0)
 .   I $E($G(GECSDATA(2100.1,GECSDATA,3,"E")))="A" D  Q
"RTN","RCRJRBDT",26,0)
 .   .   W !,"The SV document has been ACCEPTED in FMS and will not be resent."
"RTN","RCRJRBDT",27,0)
 .   .   S RCRJFSV=1
"RTN","RCRJRBDT",28,0)
 .   W !,"The SV document has NOT been ACCEPTED and will be RETRANSMITTED."
"RTN","RCRJRBDT",29,0)
 I $G(RCRJFSV) Q
"RTN","RCRJRBDT",30,0)
 ;
"RTN","RCRJRBDT",31,0)
 I $$ASKOKAY(DATEMOYR)'=1 Q
"RTN","RCRJRBDT",32,0)
 ;
"RTN","RCRJRBDT",33,0)
 W !!,"Re-sending the documents to FMS ..."
"RTN","RCRJRBDT",34,0)
 D BADDEBT^RCXFMSSV
"RTN","RCRJRBDT",35,0)
 W " Done.",!,"The Bad Debt Report will be sent to the G.FMS mail group."
"RTN","RCRJRBDT",36,0)
 Q
"RTN","RCRJRBDT",37,0)
 ;
"RTN","RCRJRBDT",38,0)
 ;
"RTN","RCRJRBDT",39,0)
ASKOKAY(DATEMOYR) ;  ask if its okay
"RTN","RCRJRBDT",40,0)
 ;  1 is yes, otherwise no
"RTN","RCRJRBDT",41,0)
 N DIR,DIQ2,DTOUT,DUOUT,X,Y
"RTN","RCRJRBDT",42,0)
 S Y=DATEMOYR D DD^%DT
"RTN","RCRJRBDT",43,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","RCRJRBDT",44,0)
 S DIR("A")="  Are you SURE you want to resend the Bad Debt Report for "_Y
"RTN","RCRJRBDT",45,0)
 W ! D ^DIR
"RTN","RCRJRBDT",46,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCRJRBDT",47,0)
 Q Y
"RTN","RCRJRBDT",48,0)
 ;
"RTN","RCRJRBDT",49,0)
 ;
"RTN","RCRJRBDT",50,0)
ENDOFREP ;  print end of bad debt report footnotes
"RTN","RCRJRBDT",51,0)
 ;  called from rcrjrbdr
"RTN","RCRJRBDT",52,0)
 ;
"RTN","RCRJRBDT",53,0)
 ;  print footnote
"RTN","RCRJRBDT",54,0)
 S Y=RCRJDATE D DD^%DT S ENDDATE=Y
"RTN","RCRJRBDT",55,0)
 F %=1:1 S DATA=$P($T(FOOTNOTE+%),";",3,99) Q:DATA=""  D
"RTN","RCRJRBDT",56,0)
 .   I DATA["DATEREPT" S DATA=$P(DATA,"DATEREPT")_DATEREPT_$P(DATA,"DATEREPT",2)
"RTN","RCRJRBDT",57,0)
 .   I DATA["ENDDATE" S DATA=$P(DATA,"ENDDATE")_ENDDATE_$P(DATA,"ENDDATE",2)
"RTN","RCRJRBDT",58,0)
 .   D SETLINE^RCRJRBDR(DATA)
"RTN","RCRJRBDT",59,0)
 Q
"RTN","RCRJRBDT",60,0)
 ;
"RTN","RCRJRBDT",61,0)
 ;
"RTN","RCRJRBDT",62,0)
FOOTNOTE ;  report footnotes (from rcrjrbdr)
"RTN","RCRJRBDT",63,0)
 ;;(1) The "Allowance Estimate for DATEREPT" is the dollar value estimated
"RTN","RCRJRBDT",64,0)
 ;;    as the Allowance for Bad Debt or Contract Adjustment for the month.
"RTN","RCRJRBDT",65,0)
 ;; 
"RTN","RCRJRBDT",66,0)
 ;;(2) The "Bad Debt Write-Off (Plus)" is the actual write-offs or contract
"RTN","RCRJRBDT",67,0)
 ;;    adjustments accomplished from FEB 1,1998 thru ENDDATE.
"RTN","RCRJRBDT",68,0)
 ;; 
"RTN","RCRJRBDT",69,0)
 ;;(3) The "Transmitted Amount to FMS for Month" is the sum of (1) and (2).
"RTN","RCRJRBDT",70,0)
 ;;    The transmitted dollar value is normally a credit value.
"RTN","RCRJRBDT",71,0)
 ;; 
"RTN","RCRJRBDT",72,0)
 ;;(4) Facilities are responsible for reporting monthly accrued unbilled
"RTN","RCRJRBDT",73,0)
 ;;    amounts.  When such amounts are identified and reported, a portion of
"RTN","RCRJRBDT",74,0)
 ;;    those dollars should be reported as uncollectable.  The estimated
"RTN","RCRJRBDT",75,0)
 ;;    uncollectable value of the unbilled amounts should be included as part
"RTN","RCRJRBDT",76,0)
 ;;    of the facility's monthly allowance for bad debt or contract adjustments.
"RTN","RCRJRBDT",77,0)
 ;;    The AR Override Option should be used to adjust the value provided to
"RTN","RCRJRBDT",78,0)
 ;;    report the estimated uncollectable accrued unbilled amounts for the
"RTN","RCRJRBDT",79,0)
 ;;    month.  Facilities may wish to consider using the allowance percentages
"RTN","RCRJRBDT",80,0)
 ;;    provided with this report, if no other means of determining the
"RTN","RCRJRBDT",81,0)
 ;;    estimated allowance for the accrued unbilled amount is acceptable.
"RTN","RCRJRBDT",82,0)
 ;; 
"RTN","RCRJRBDT",83,0)
 ;;(5) Only members in the facility's local RC AR DATA COLLECTOR mail group
"RTN","RCRJRBDT",84,0)
 ;;    will receive this report.
"RTN","RCRJRCO")
0^2^B52961813
"RTN","RCRJRCO",1,0)
RCRJRCO ;WISC/RFJ-control collection of monthly data ;1 Nov 97
"RTN","RCRJRCO",2,0)
 ;;4.5;Accounts Receivable;**96,106,101,103,147,156,169,170,174,191**;Mar 20, 1995
"RTN","RCRJRCO",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRCO",4,0)
 ;  called by menu option to regenerate monthly data
"RTN","RCRJRCO",5,0)
 N %,%DT,%X,%Y,DA347,DIQ2,DATEMOYR,FMSDOCNO,GECSDATA,LASTMONT,RCRJFAR1,RCRJFAR2,RCRJFBDR,RCRJFOIG,RCRJFSV,RCRJFTR,RCRJFWR,X,Y,ZTSK
"RTN","RCRJRCO",6,0)
 ;
"RTN","RCRJRCO",7,0)
 W !!,"This option will re-run the AR Data Collector, extracting data from"
"RTN","RCRJRCO",8,0)
 W !,"the AR database and sending the data to the National Database and FMS."
"RTN","RCRJRCO",9,0)
 W !,"It will also re-generate the Bad Debt Report and the OIG Extract."
"RTN","RCRJRCO",10,0)
 W !!,"This option will perform the following tasks:",!
"RTN","RCRJRCO",11,0)
 W !,"  1.  Re-send the data to the National Database.  The data will only be"
"RTN","RCRJRCO",12,0)
 W !,"      re-sent if you answer YES to the prompt.  The data will only be"
"RTN","RCRJRCO",13,0)
 W !,"      accepted in the NDB if the month-year has not been closed (in the NDB)."
"RTN","RCRJRCO",14,0)
 W !,"  2.  Re-send the data to FMS on the SV 21, SV 2A, WR 04, WR 06, and TR 33."
"RTN","RCRJRCO",15,0)
 W !,"      The data will only be re-sent if it has not been previously accepted"
"RTN","RCRJRCO",16,0)
 W !,"      by FMS."
"RTN","RCRJRCO",17,0)
 W !,"  3.  Re-generate the Bad Debt Report.  The data will only be re-generated"
"RTN","RCRJRCO",18,0)
 W !,"      if the current date is within day 1 and workday 2, the previous month is"
"RTN","RCRJRCO",19,0)
 W !,"      selected, and you answer YES to the prompt to re-generate the report."
"RTN","RCRJRCO",20,0)
 W !,"      To re-transmit the Bad Debt Report data to FMS, use the option 'Bad"
"RTN","RCRJRCO",21,0)
 W !,"      Debt Code Sheet Regen' which will create the SV 23, SV 27, and SV 2B"
"RTN","RCRJRCO",22,0)
 W !,"      documents."
"RTN","RCRJRCO",23,0)
 W !,"  4.  Re-send the OIG Extract.  If the selected month is the end of the"
"RTN","RCRJRCO",24,0)
 W !,"      quarter (December, March, June, or September), the OIG Extract can"
"RTN","RCRJRCO",25,0)
 W !,"      be re-generated."
"RTN","RCRJRCO",26,0)
 ;
"RTN","RCRJRCO",27,0)
 ;  do not allow dates in future to be selected
"RTN","RCRJRCO",28,0)
 ;S (LASTMONT,DATEMOYR)=$$PREVMONT^RCRJRBD(DT)
"RTN","RCRJRCO",29,0)
 I $E(DT,6,7)'>$E($$LDATE^RCRJR(DT),6,7) S (LASTMONT,DATEMOYR)=$$PREVMONT^RCRJRBD(DT)
"RTN","RCRJRCO",30,0)
 I $E(DT,6,7)>$E($$LDATE^RCRJR(DT),6,7) S (LASTMONT,DATEMOYR)=$E($$LDATE^RCRJR(DT),1,5)_"00"
"RTN","RCRJRCO",31,0)
 S %DT(0)=-LASTMONT
"RTN","RCRJRCO",32,0)
 S %DT("A")="Retransmit AR Data Collector data for Month/Year: "
"RTN","RCRJRCO",33,0)
 S %DT="AEMP"
"RTN","RCRJRCO",34,0)
 W ! D ^%DT
"RTN","RCRJRCO",35,0)
 I Y<1 Q
"RTN","RCRJRCO",36,0)
 ;
"RTN","RCRJRCO",37,0)
 S (DATEMOYR,Y)=$E(Y,1,5)_"00" D DD^%DT
"RTN","RCRJRCO",38,0)
 ;
"RTN","RCRJRCO",39,0)
 ;  try and find SV document to see if its accepted
"RTN","RCRJRCO",40,0)
 K GECSDATA
"RTN","RCRJRCO",41,0)
 D KEYLOOK^GECSSGET("SV-"_DATEMOYR,1)
"RTN","RCRJRCO",42,0)
 I $G(GECSDATA) D  Q:'$G(GECSDATA)
"RTN","RCRJRCO",43,0)
 .   W !!,"The SV document has been transmitted to fms, document number: "_GECSDATA("2100.1",GECSDATA,".01","E")
"RTN","RCRJRCO",44,0)
 .   I $E($G(GECSDATA(2100.1,GECSDATA,3,"E")))="A" D  Q
"RTN","RCRJRCO",45,0)
 .   .   W !,"The SV document has been ACCEPTED in FMS and will not be resent."
"RTN","RCRJRCO",46,0)
 .   .   S RCRJFSV=1
"RTN","RCRJRCO",47,0)
 .   I $E($G(GECSDATA(2100.1,GECSDATA,3,"E")))="R" D  Q
"RTN","RCRJRCO",48,0)
 .   .   W !,"The SV document has REJECTED and will be RETRANSMITTED."
"RTN","RCRJRCO",49,0)
 .   W !,"The SV document has NOT been ACCEPTED in FMS."
"RTN","RCRJRCO",50,0)
 .   S %=$$ASKTRANS I %<0 K GECSDATA Q
"RTN","RCRJRCO",51,0)
 .   I %'=1 S RCRJFSV=1  ;do not send document
"RTN","RCRJRCO",52,0)
 ;
"RTN","RCRJRCO",53,0)
 ;  try and find WR document to see if its accepted
"RTN","RCRJRCO",54,0)
 K GECSDATA
"RTN","RCRJRCO",55,0)
 D KEYLOOK^GECSSGET("WR-"_DATEMOYR,1)
"RTN","RCRJRCO",56,0)
 I $G(GECSDATA) D  Q:'$G(GECSDATA)
"RTN","RCRJRCO",57,0)
 .   W !!,"The WR document has been transmitted to fms, document number: "_GECSDATA("2100.1",GECSDATA,".01","E")
"RTN","RCRJRCO",58,0)
 .   I $E($G(GECSDATA(2100.1,GECSDATA,3,"E")))="A" D  Q
"RTN","RCRJRCO",59,0)
 .   .   W !,"The WR document has been ACCEPTED in FMS and will not be resent."
"RTN","RCRJRCO",60,0)
 .   .   S RCRJFWR=1
"RTN","RCRJRCO",61,0)
 .   I $E($G(GECSDATA(2100.1,GECSDATA,3,"E")))="R" D  Q
"RTN","RCRJRCO",62,0)
 .   .   W !,"The WR document has REJECTED and will be RETRANSMITTED."
"RTN","RCRJRCO",63,0)
 .   W !,"The WR document has NOT been ACCEPTED in FMS."
"RTN","RCRJRCO",64,0)
 .   S %=$$ASKTRANS I %<0 K GECSDATA Q
"RTN","RCRJRCO",65,0)
 .   I %'=1 S RCRJFWR=1  ;do not send document
"RTN","RCRJRCO",66,0)
 ;
"RTN","RCRJRCO",67,0)
 ;  try and find TR document to see if its accepted
"RTN","RCRJRCO",68,0)
 K GECSDATA
"RTN","RCRJRCO",69,0)
 D KEYLOOK^GECSSGET("TR-"_DATEMOYR,1)
"RTN","RCRJRCO",70,0)
 I $G(GECSDATA) D  Q:'$G(GECSDATA)
"RTN","RCRJRCO",71,0)
 .   W !!,"The TR document has been transmitted to fms, document number: "_GECSDATA("2100.1",GECSDATA,".01","E")
"RTN","RCRJRCO",72,0)
 .   I $E($G(GECSDATA(2100.1,GECSDATA,3,"E")))="A" D  Q
"RTN","RCRJRCO",73,0)
 .   .   W !,"The TR document has been ACCEPTED in FMS and will not be resent."
"RTN","RCRJRCO",74,0)
 .   .   S RCRJFTR=1
"RTN","RCRJRCO",75,0)
 .   I $E($G(GECSDATA(2100.1,GECSDATA,3,"E")))="R" D  Q
"RTN","RCRJRCO",76,0)
 .   .   W !,"The TR document has REJECTED and will be RETRANSMITTED."
"RTN","RCRJRCO",77,0)
 .   W !,"The TR document has NOT been ACCEPTED in FMS."
"RTN","RCRJRCO",78,0)
 .   S %=$$ASKTRANS I %<0 K GECSDATA Q
"RTN","RCRJRCO",79,0)
 .   I %'=1 S RCRJFTR=1  ;do not send document
"RTN","RCRJRCO",80,0)
 ;
"RTN","RCRJRCO",81,0)
 ;  ask to resend AR1 NDB data
"RTN","RCRJRCO",82,0)
 S %=$$ASKNDB("AR1") I %<0 Q
"RTN","RCRJRCO",83,0)
 I %'=1 S RCRJFAR1=1  ;do not send to ndb
"RTN","RCRJRCO",84,0)
 ;
"RTN","RCRJRCO",85,0)
 ;  ask to resend AR2 NDB data
"RTN","RCRJRCO",86,0)
 S %=$$ASKNDB("AR2") I %<0 Q
"RTN","RCRJRCO",87,0)
 I %'=1 S RCRJFAR2=1  ;do not send to ndb
"RTN","RCRJRCO",88,0)
 ;
"RTN","RCRJRCO",89,0)
 ;  ask to resend the OIG extract
"RTN","RCRJRCO",90,0)
 S RCRJFOIG=1  ;  resend the OIG extract
"RTN","RCRJRCO",91,0)
 D  I %<0 Q
"RTN","RCRJRCO",92,0)
 .   S %=$$ASKOIG I %<0 Q
"RTN","RCRJRCO",93,0)
 .   I %=1 S RCRJFOIG=0  ;re-send oig extract
"RTN","RCRJRCO",94,0)
 ;
"RTN","RCRJRCO",95,0)
 ;  recompute bad debt report if selected month (datemoyr) is equal
"RTN","RCRJRCO",96,0)
 ;  to last month AND today is less than the 1st workday of month
"RTN","RCRJRCO",97,0)
 ;  default is do not rebuild bad debt report
"RTN","RCRJRCO",98,0)
 S RCRJFBDR=1
"RTN","RCRJRCO",99,0)
 I DATEMOYR=LASTMONT&($E(DT,6,7)'<$E($$LDATE^RCRJR(DT),6,7)&($E(DT,6,7)<$E($$LDAY^RCRJR(DT),6,7))) S %=$$ASKBDR Q:%<0  S RCRJFBDR=$S(%=1:0,1:1)
"RTN","RCRJRCO",100,0)
 ;
"RTN","RCRJRCO",101,0)
 I $G(RCRJFAR1),$G(RCRJFAR2),$G(RCRJFSV),$G(RCRJFWR),$G(RCRJFTR),$G(RCRJFBDR),$G(RCRJFOIG) W !!,"No reports have been selected for retransmission." Q
"RTN","RCRJRCO",102,0)
 ;
"RTN","RCRJRCO",103,0)
 W !!,"This option will retransmit the following monthly reports:"
"RTN","RCRJRCO",104,0)
 I '$G(RCRJFAR1) W !,"  AR1 to the NDB."
"RTN","RCRJRCO",105,0)
 I '$G(RCRJFAR2) W !,"  AR2 to the NDB."
"RTN","RCRJRCO",106,0)
 I '$G(RCRJFSV) W !,"  SV document to FMS."
"RTN","RCRJRCO",107,0)
 I '$G(RCRJFWR) W !,"  WR document to FMS."
"RTN","RCRJRCO",108,0)
 I '$G(RCRJFTR) W !,"  TR document to FMS."
"RTN","RCRJRCO",109,0)
 I '$G(RCRJFBDR) W !,"  rebuild the Bad Debt Report."
"RTN","RCRJRCO",110,0)
 I '$G(RCRJFOIG) W !,"  resend the OIG Extract."
"RTN","RCRJRCO",111,0)
 ;
"RTN","RCRJRCO",112,0)
 I $$ASKOKAY(DATEMOYR)=1 D
"RTN","RCRJRCO",113,0)
 .   W !!,"This will be queued to run in the background.  When it completes,"
"RTN","RCRJRCO",114,0)
 .   W !,"a mail message will be sent to the mail group RC AR DATA COLLECTOR."
"RTN","RCRJRCO",115,0)
 .   S ZTDESC="AR Data Collector",ZTRTN="DQ^RCRJRCO",ZTDTH=$H,ZTIO=""
"RTN","RCRJRCO",116,0)
 .   S ZTSAVE("DATEMOYR")="",ZTSAVE("RCRJF*")="",ZTSAVE("ZTREQ")="@"
"RTN","RCRJRCO",117,0)
 .   D ^%ZTLOAD
"RTN","RCRJRCO",118,0)
 .   W !!,"Queued to run in task ",$G(ZTSK)
"RTN","RCRJRCO",119,0)
 Q
"RTN","RCRJRCO",120,0)
 ;
"RTN","RCRJRCO",121,0)
 ;
"RTN","RCRJRCO",122,0)
DQ ;  start collection of monthly data
"RTN","RCRJRCO",123,0)
 ;  datemoyr is for the month and year to run collector (ex 2971000)
"RTN","RCRJRCO",124,0)
 ;  rcrjfsv and rcrjfwr are flags to stop the sv and wr documents
"RTN","RCRJRCO",125,0)
 ;  rcrjfbdr is a flag to stop the rebuild of the bad debt report
"RTN","RCRJRCO",126,0)
 N %,DATEBEG,DATEEND,PRCASITE,X
"RTN","RCRJRCO",127,0)
 ;  get last month
"RTN","RCRJRCO",128,0)
 I $G(DATEMOYR) S DATEEND=$$LDATE^RCRJR(DATEMOYR)
"RTN","RCRJRCO",129,0)
 I '$G(DATEMOYR) S DATEEND=$$LDATE^RCRJR(DT),DATEMOYR=$E(DATEEND,1,5)_"00"
"RTN","RCRJRCO",130,0)
 ;
"RTN","RCRJRCO",131,0)
 ;S DATEBEG=$$LDATE^RCRJR($$PREVMONT^RCRJRBD(DATEEND))+1
"RTN","RCRJRCO",132,0)
 S DATEBEG=$S(+$E(DATEEND,2,5)=309:$E(DATEEND,1,5)_"01",1:$$LDATE^RCRJR($$PREVMONT^RCRJRBD(DATEEND))+1)
"RTN","RCRJRCO",133,0)
 ;S DATEEND=$P("31^28^31^30^31^30^31^31^30^31^30^31","^",+$E(DATEMOYR,4,5)) I DATEEND=28,((17+$E(DATEMOYR))_$E(DATEMOYR,2,3))#4=0 S DATEEND=29
"RTN","RCRJRCO",134,0)
 ;S DATEEND=$$LDATE^RCRJR(DT)
"RTN","RCRJRCO",135,0)
 ;S DATEEND=$E(DATEMOYR,1,5)_DATEEND
"RTN","RCRJRCO",136,0)
 ;
"RTN","RCRJRCO",137,0)
 S PRCASITE=$$SITE^RCMSITE
"RTN","RCRJRCO",138,0)
 ;
"RTN","RCRJRCO",139,0)
 ;  queue the AR2 data collector to run in the background
"RTN","RCRJRCO",140,0)
 I '$G(RCRJFAR2) D
"RTN","RCRJRCO",141,0)
 .   S ZTDESC="AR2 Data Collector",ZTRTN="DQ^RCRJRCO2",ZTDTH=$H,ZTIO=""
"RTN","RCRJRCO",142,0)
 .   S ZTSAVE("PRCASITE")="",ZTSAVE("DATEBEG")="",ZTSAVE("DATEEND")="",ZTSAVE("ZTREQ")="@"
"RTN","RCRJRCO",143,0)
 .   D ^%ZTLOAD
"RTN","RCRJRCO",144,0)
 ;
"RTN","RCRJRCO",145,0)
 ;  no point in running data collector, nothing being sent
"RTN","RCRJRCO",146,0)
 I $G(RCRJFAR1),$G(RCRJFSV),$G(RCRJFWR),$G(RCRJFTR),$G(RCRJFBDR),$G(RCRJFOIG) Q
"RTN","RCRJRCO",147,0)
 ;
"RTN","RCRJRCO",148,0)
 ;  run the AR1 data collector
"RTN","RCRJRCO",149,0)
 D START^RCRJRCOL(PRCASITE,DATEBEG,DATEEND)
"RTN","RCRJRCO",150,0)
 Q
"RTN","RCRJRCO",151,0)
 ;
"RTN","RCRJRCO",152,0)
 ;
"RTN","RCRJRCO",153,0)
ASKNDB(REPORT) ;  ask to resend to national database
"RTN","RCRJRCO",154,0)
 ;  report = AR1 or AR2
"RTN","RCRJRCO",155,0)
 ;  1 is yes, otherwise no
"RTN","RCRJRCO",156,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCRJRCO",157,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","RCRJRCO",158,0)
 S DIR("A")="  Do you want to resend the "_REPORT_" data to the National Database"
"RTN","RCRJRCO",159,0)
 W ! D ^DIR
"RTN","RCRJRCO",160,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCRJRCO",161,0)
 Q Y
"RTN","RCRJRCO",162,0)
 ;
"RTN","RCRJRCO",163,0)
 ;
"RTN","RCRJRCO",164,0)
ASKBDR() ;  ask to rebuild the bad debt report
"RTN","RCRJRCO",165,0)
 ;  1 is yes, otherwise no
"RTN","RCRJRCO",166,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCRJRCO",167,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","RCRJRCO",168,0)
 S DIR("A")="  Do you want to rebuild the Bad Debt Report"
"RTN","RCRJRCO",169,0)
 W ! D ^DIR
"RTN","RCRJRCO",170,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCRJRCO",171,0)
 Q Y
"RTN","RCRJRCO",172,0)
 ;
"RTN","RCRJRCO",173,0)
 ;
"RTN","RCRJRCO",174,0)
ASKOKAY(DATEMOYR) ;  ask if its okay
"RTN","RCRJRCO",175,0)
 ;  1 is yes, otherwise no
"RTN","RCRJRCO",176,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCRJRCO",177,0)
 S Y=DATEMOYR D DD^%DT
"RTN","RCRJRCO",178,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","RCRJRCO",179,0)
 S DIR("A")="  Are you SURE you want to regenerate the data for "_Y
"RTN","RCRJRCO",180,0)
 W ! D ^DIR
"RTN","RCRJRCO",181,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCRJRCO",182,0)
 Q Y
"RTN","RCRJRCO",183,0)
 ;
"RTN","RCRJRCO",184,0)
 ;
"RTN","RCRJRCO",185,0)
ASKTRANS() ;  ask if its okay to retransmit document to FMS
"RTN","RCRJRCO",186,0)
 ;  1 is yes, otherwise no
"RTN","RCRJRCO",187,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCRJRCO",188,0)
 S Y=DATEMOYR D DD^%DT
"RTN","RCRJRCO",189,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","RCRJRCO",190,0)
 S DIR("A")="  Do you want to regenerate and retransmit this document to FMS"
"RTN","RCRJRCO",191,0)
 D ^DIR
"RTN","RCRJRCO",192,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCRJRCO",193,0)
 Q Y
"RTN","RCRJRCO",194,0)
 ;
"RTN","RCRJRCO",195,0)
 ;
"RTN","RCRJRCO",196,0)
ASKOIG() ;  ask to resend to oig
"RTN","RCRJRCO",197,0)
 ;  1 is yes, otherwise no
"RTN","RCRJRCO",198,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCRJRCO",199,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","RCRJRCO",200,0)
 S DIR("A")="  Do you want to resend the data to the OIG"
"RTN","RCRJRCO",201,0)
 W ! D ^DIR
"RTN","RCRJRCO",202,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCRJRCO",203,0)
 Q Y
"RTN","RCRJRCO2")
0^8^B27661034
"RTN","RCRJRCO2",1,0)
RCRJRCO2 ;WISC/RFJ-start of the ar2 data collector ;3/7/00  12:17 PM
"RTN","RCRJRCO2",2,0)
 ;;4.5;Accounts Receivable;**96,152,156,174,191**;Mar 20, 1995
"RTN","RCRJRCO2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRCO2",4,0)
 Q
"RTN","RCRJRCO2",5,0)
 ;
"RTN","RCRJRCO2",6,0)
 ;
"RTN","RCRJRCO2",7,0)
DQ ;  start queued task from taskmanager here
"RTN","RCRJRCO2",8,0)
 D START(PRCASITE,DATEBEG,DATEEND)
"RTN","RCRJRCO2",9,0)
 Q
"RTN","RCRJRCO2",10,0)
 ;
"RTN","RCRJRCO2",11,0)
 ;
"RTN","RCRJRCO2",12,0)
START(PRCASITE,DATEBEG,DATEEND) ;  start ar2 collector
"RTN","RCRJRCO2",13,0)
 N %,BATCNAME,STRTTIME,TOTAL,X,Y
"RTN","RCRJRCO2",14,0)
 ;
"RTN","RCRJRCO2",15,0)
 ;  set start time
"RTN","RCRJRCO2",16,0)
 D NOW^%DTC S STRTTIME=%
"RTN","RCRJRCO2",17,0)
 ;
"RTN","RCRJRCO2",18,0)
 D STATEMNT,PAYDEP,IRS
"RTN","RCRJRCO2",19,0)
 ;
"RTN","RCRJRCO2",20,0)
 ;  ---------- send to ndb ----------
"RTN","RCRJRCO2",21,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCO2",22,0)
 ;  build the first two control lines in mail message
"RTN","RCRJRCO2",23,0)
 S Y=DATEBEG D DD^%DT
"RTN","RCRJRCO2",24,0)
 S BATCNAME="AR2-"_$E(Y,1,3)_$E(DATEBEG,6,7)_$TR($P(Y,",",2)," ")
"RTN","RCRJRCO2",25,0)
 S Y=DATEEND D DD^%DT
"RTN","RCRJRCO2",26,0)
 S BATCNAME=BATCNAME_"-"_$E(Y,1,3)_$E(DATEEND,6,7)_$TR($P(Y,",",2)," ")
"RTN","RCRJRCO2",27,0)
 S ^TMP($J,"RCRJRCORMM",1)="T$ "_PRCASITE_"$"_BATCNAME_"$$$$$*"
"RTN","RCRJRCO2",28,0)
 ;  get end time (in %)
"RTN","RCRJRCO2",29,0)
 D NOW^%DTC
"RTN","RCRJRCO2",30,0)
 S ^TMP($J,"RCRJRCORMM",2)="S$ "_STRTTIME_"^"_%_"$0$5"
"RTN","RCRJRCO2",31,0)
 S ^TMP($J,"RCRJRCORMM",3)="D$ :1/1/"_TOTAL(1)_":2/2/"_TOTAL(2)_":3/3/"_TOTAL(3)_":4/4/"_TOTAL(4)_":5/5/"_TOTAL(5)
"RTN","RCRJRCO2",32,0)
 ;
"RTN","RCRJRCO2",33,0)
 S XMY("S.PRQN DATA COLLECTION MONITOR@FO-ALBANY.MED.VA.GOV")=""
"RTN","RCRJRCO2",34,0)
 S %=$$SENDMSG^RCRJRCOR("AR2 "_$E(DATEEND,4,5)_"/"_$E(DATEEND,2,3)_" NDB DATA FOR SITE "_PRCASITE,.XMY)
"RTN","RCRJRCO2",35,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCO2",36,0)
 Q
"RTN","RCRJRCO2",37,0)
 ;
"RTN","RCRJRCO2",38,0)
 ;
"RTN","RCRJRCO2",39,0)
STATEMNT ;  count statements
"RTN","RCRJRCO2",40,0)
 N ADMIN,COUNT,DA,DATA,DATE,DATESTRT,DATESTOP,DEBTOR,INTEREST,PRINBAL
"RTN","RCRJRCO2",41,0)
 S DATESTRT=9999999-DATEEND,DATESTOP=9999999.999999-DATEBEG
"RTN","RCRJRCO2",42,0)
 ;
"RTN","RCRJRCO2",43,0)
 S (COUNT,PRINBAL,INTEREST,ADMIN)=0
"RTN","RCRJRCO2",44,0)
 S DEBTOR=0 F  S DEBTOR=$O(^RC(341,"AD",DEBTOR)) Q:'DEBTOR  D
"RTN","RCRJRCO2",45,0)
 .   S DATE=DATESTRT F  S DATE=$O(^RC(341,"AD",DEBTOR,2,DATE)) Q:'DATE!(DATE>DATESTOP)  D
"RTN","RCRJRCO2",46,0)
 .   .   S DA=0 F  S DA=$O(^RC(341,"AD",DEBTOR,2,DATE,DA)) Q:'DA  D
"RTN","RCRJRCO2",47,0)
 .   .   .   S DATA=$G(^RC(341,DA,1))
"RTN","RCRJRCO2",48,0)
 .   .   .   S COUNT=COUNT+1,PRINBAL=PRINBAL+$P(DATA,"^"),INTEREST=INTEREST+$P(DATA,"^",2),ADMIN=ADMIN+$P(DATA,"^",3)
"RTN","RCRJRCO2",49,0)
 ;
"RTN","RCRJRCO2",50,0)
 ;  1 is data collector index for statements
"RTN","RCRJRCO2",51,0)
 S TOTAL(1)=COUNT_"^"_PRINBAL_"^"_INTEREST_"^"_ADMIN
"RTN","RCRJRCO2",52,0)
 Q
"RTN","RCRJRCO2",53,0)
 ;
"RTN","RCRJRCO2",54,0)
 ;
"RTN","RCRJRCO2",55,0)
PAYDEP ;  process payments and deposits
"RTN","RCRJRCO2",56,0)
 N COUNT,DA,DATA0,DATECONF,DEPAMT,DEPCNT,DEPTICDA,TDATA0,TDATA1,TOTALAMT,TOTALDEP,TRANDA,TYPE
"RTN","RCRJRCO2",57,0)
 S (COUNT,TOTALAMT,DEPCNT,TOTALDEP)=0
"RTN","RCRJRCO2",58,0)
 S DA=0 F  S DA=$O(^RCY(344,DA)) Q:'DA  S DATA0=$G(^(DA,0)) I $P(DATA0,"^",8) D
"RTN","RCRJRCO2",59,0)
 .   S TYPE=$P($G(^RC(341.1,+$P(DATA0,"^",4),0)),"^")
"RTN","RCRJRCO2",60,0)
 .   I TYPE'["PAYMENT" Q
"RTN","RCRJRCO2",61,0)
 .   ;
"RTN","RCRJRCO2",62,0)
 .   ;  count payment transactions and amount
"RTN","RCRJRCO2",63,0)
 .   S DEPAMT=0
"RTN","RCRJRCO2",64,0)
 .   S TRANDA=0 F  S TRANDA=$O(^RCY(344,DA,1,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRCO2",65,0)
 .   .   S TDATA0=$G(^RCY(344,DA,1,TRANDA,0)),TDATA1=$G(^(1))
"RTN","RCRJRCO2",66,0)
 .   .   I $P(TDATA1,"^",2)'="" Q
"RTN","RCRJRCO2",67,0)
 .   .   S DEPAMT=DEPAMT+$P(TDATA0,"^",4)
"RTN","RCRJRCO2",68,0)
 .   .   I $P(TDATA0,"^",6)<DATEBEG!($P(TDATA0,"^",6)>DATEEND) Q
"RTN","RCRJRCO2",69,0)
 .   .   I $P(TDATA0,"^",4) S COUNT=COUNT+1,TOTALAMT=TOTALAMT+$P(TDATA0,"^",4)
"RTN","RCRJRCO2",70,0)
 .   ;
"RTN","RCRJRCO2",71,0)
 .   ;  count total deposits and amount
"RTN","RCRJRCO2",72,0)
 .   I 'DEPAMT Q
"RTN","RCRJRCO2",73,0)
 .   S DEPTICDA=$P(DATA0,"^",6) I 'DEPTICDA Q
"RTN","RCRJRCO2",74,0)
 .   S DATECONF=$P($P($G(^RCY(344.1,DEPTICDA,0)),U,11),".")
"RTN","RCRJRCO2",75,0)
 .   I DATECONF<DATEBEG!(DATECONF>DATEEND) Q
"RTN","RCRJRCO2",76,0)
 .   S TOTALDEP=TOTALDEP+DEPAMT
"RTN","RCRJRCO2",77,0)
 .   I '$D(DEPCNT(DATECONF)) S DEPCNT(DATECONF)="",DEPCNT=DEPCNT+1
"RTN","RCRJRCO2",78,0)
 ;
"RTN","RCRJRCO2",79,0)
 ;  2 is data collector index for deposits
"RTN","RCRJRCO2",80,0)
 ;  3 is data collector index for payment transactions
"RTN","RCRJRCO2",81,0)
 S TOTAL(2)=DEPCNT_"^"_TOTALDEP
"RTN","RCRJRCO2",82,0)
 S TOTAL(3)=COUNT_"^"_TOTALAMT
"RTN","RCRJRCO2",83,0)
 Q
"RTN","RCRJRCO2",84,0)
 ;
"RTN","RCRJRCO2",85,0)
 ;
"RTN","RCRJRCO2",86,0)
IRS ;  count of irs letters and amounts
"RTN","RCRJRCO2",87,0)
 ;  count of 1st party accounts and bills under $25 with total amt.
"RTN","RCRJRCO2",88,0)
 N AMOUNT,BILLDA,COUNT,COUNTED,DATA6,DEBTOR
"RTN","RCRJRCO2",89,0)
 N L25BCNT,L25ACNT,L25AMT,L25FLG,DEBAMT,DEBCNT,DATA7,P181DT
"RTN","RCRJRCO2",90,0)
 N BAMT,DATA0,I
"RTN","RCRJRCO2",91,0)
 S P181DT=$$FMADD^XLFDT(DATEEND,-181)
"RTN","RCRJRCO2",92,0)
 S (AMOUNT,COUNT,L25BCNT,L25ACNT,L25AMT)=0
"RTN","RCRJRCO2",93,0)
 S DEBTOR=0 F  S DEBTOR=$O(^PRCA(430,"C",DEBTOR)) Q:'DEBTOR  D
"RTN","RCRJRCO2",94,0)
 .   S (COUNTED,DEBAMT,DEBCNT,L25FLG)=0
"RTN","RCRJRCO2",95,0)
 .   S BILLDA=0 F  S BILLDA=$O(^PRCA(430,"C",DEBTOR,BILLDA)) Q:'BILLDA  D
"RTN","RCRJRCO2",96,0)
 .   .   S DATA6=$G(^PRCA(430,BILLDA,6))
"RTN","RCRJRCO2",97,0)
 .   .   ; if the first party account is still less than $25, get the
"RTN","RCRJRCO2",98,0)
 .   .   ; next active bill and add those dollars
"RTN","RCRJRCO2",99,0)
 .   .   D:'L25FLG
"RTN","RCRJRCO2",100,0)
 .   .   .   ; not a 1st party account
"RTN","RCRJRCO2",101,0)
 .   .   .   I $P($G(^RCD(340,DEBTOR,0)),U)'[";DPT(" S L25FLG=1 Q
"RTN","RCRJRCO2",102,0)
 .   .   .   ; bill not activated for more than 180 days
"RTN","RCRJRCO2",103,0)
 .   .   .   Q:$P(DATA6,U,21)>P181DT
"RTN","RCRJRCO2",104,0)
 .   .   .   S DATA0=$G(^PRCA(430,BILLDA,0))
"RTN","RCRJRCO2",105,0)
 .   .   .   ; bill not active or in suspended status
"RTN","RCRJRCO2",106,0)
 .   .   .   ; not necessary to check for open status because of age of
"RTN","RCRJRCO2",107,0)
 .   .   .   ; bill (should not be open for more than 30 days)
"RTN","RCRJRCO2",108,0)
 .   .   .   I $P(DATA0,"^",8)'=16,$P(DATA0,"^",8)'=40 Q
"RTN","RCRJRCO2",109,0)
 .   .   .   S DATA7=$G(^PRCA(430,BILLDA,7))
"RTN","RCRJRCO2",110,0)
 .   .   .   S BAMT=0 F I=1:1:5 S BAMT=BAMT+$P(DATA7,U,I)
"RTN","RCRJRCO2",111,0)
 .   .   .   ; no outstanding balance on the bill
"RTN","RCRJRCO2",112,0)
 .   .   .   Q:'BAMT
"RTN","RCRJRCO2",113,0)
 .   .   .   S DEBAMT=DEBAMT+BAMT
"RTN","RCRJRCO2",114,0)
 .   .   .   ; accounts is greater than $25, do not count it
"RTN","RCRJRCO2",115,0)
 .   .   .   I DEBAMT'<25 S L25FLG=1 Q
"RTN","RCRJRCO2",116,0)
 .   .   .   S DEBCNT=DEBCNT+1
"RTN","RCRJRCO2",117,0)
 .   .   .   Q
"RTN","RCRJRCO2",118,0)
 .   .   I $P(DATA6,"^",14)<DATEBEG!($P(DATA6,"^",14)>DATEEND) Q
"RTN","RCRJRCO2",119,0)
 .   .   I 'COUNTED S COUNT=COUNT+1,COUNTED=1
"RTN","RCRJRCO2",120,0)
 .   .   S AMOUNT=AMOUNT+$P(DATA6,"^",19)
"RTN","RCRJRCO2",121,0)
 .   .   Q
"RTN","RCRJRCO2",122,0)
 .   ;increment account less than 25 totals
"RTN","RCRJRCO2",123,0)
 .   I 'L25FLG,DEBAMT S L25ACNT=L25ACNT+1,L25AMT=L25AMT+DEBAMT,L25BCNT=L25BCNT+DEBCNT
"RTN","RCRJRCO2",124,0)
 .   Q
"RTN","RCRJRCO2",125,0)
 ;
"RTN","RCRJRCO2",126,0)
 ;  4 is data collector index for irs letters and amounts
"RTN","RCRJRCO2",127,0)
 S TOTAL(4)=COUNT_"^"_AMOUNT
"RTN","RCRJRCO2",128,0)
 ;
"RTN","RCRJRCO2",129,0)
 ;  5 is data collector index for accounts less than $25, total
"RTN","RCRJRCO2",130,0)
 ;  amount of accounts under $25, # of bills covered by those accounts
"RTN","RCRJRCO2",131,0)
 S TOTAL(5)=L25ACNT_"^"_L25AMT_"^"_L25BCNT
"RTN","RCRJRCO2",132,0)
 Q
"RTN","RCRJRCOL")
0^3^B31058106
"RTN","RCRJRCOL",1,0)
RCRJRCOL ;WISC/RFJ-start of the ar data collector ;1 Mar 97
"RTN","RCRJRCOL",2,0)
 ;;4.5;Accounts Receivable;**68,96,101,103,170,176,191**;Mar 20, 1995
"RTN","RCRJRCOL",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRCOL",4,0)
 Q
"RTN","RCRJRCOL",5,0)
 ;
"RTN","RCRJRCOL",6,0)
 ;
"RTN","RCRJRCOL",7,0)
START(PRCASITE,DATEBEG,DATEEND) ;  start ar1 collector and fms data collector
"RTN","RCRJRCOL",8,0)
 N %,ACTDATE,AYEAROLD,BILLDA,CLOSED,CRITERIA,DATA0,DATASTOR,DATE,IBCNS,PREVSTAT,STAT,STRTTIME
"RTN","RCRJRCOL",9,0)
 D KILLTMP
"RTN","RCRJRCOL",10,0)
 ;
"RTN","RCRJRCOL",11,0)
 ;  set start time
"RTN","RCRJRCOL",12,0)
 D NOW^%DTC S STRTTIME=%
"RTN","RCRJRCOL",13,0)
 ;
"RTN","RCRJRCOL",14,0)
 S DATASTOR="^TMP($J,""RCRJRCOLNDB"",CRITERIA)"
"RTN","RCRJRCOL",15,0)
 ;
"RTN","RCRJRCOL",16,0)
 ;  count new receivables
"RTN","RCRJRCOL",17,0)
 S %=$$GETNEW(DATEBEG,DATEEND,1)
"RTN","RCRJRCOL",18,0)
 ;
"RTN","RCRJRCOL",19,0)
 ;  used to determine future payments less than a year old
"RTN","RCRJRCOL",20,0)
 S AYEAROLD=$$FMADD^XLFDT(DATEEND,365)
"RTN","RCRJRCOL",21,0)
 ;
"RTN","RCRJRCOL",22,0)
 ;  count current receivables for period and decrease in debts
"RTN","RCRJRCOL",23,0)
 ;  do not look at bills not approved/finished (18,20,27,31)
"RTN","RCRJRCOL",24,0)
 S STAT=0 F  S STAT=$O(^PRCA(430,"ASDT",STAT)) Q:'STAT  I STAT'=18,STAT'=20,STAT'=27,STAT'=31 D
"RTN","RCRJRCOL",25,0)
 .   S DATE=0,CLOSED=0
"RTN","RCRJRCOL",26,0)
 .   ;  do not look at bills closed before begin date
"RTN","RCRJRCOL",27,0)
 .   ;  count decrease number of debts, must be closed in month
"RTN","RCRJRCOL",28,0)
 .   ;  stat 17 (in-active)       ; stat 22 (collected/closed)
"RTN","RCRJRCOL",29,0)
 .   ;  stat 23 (write-off)       ; stat 26 (cancelled)
"RTN","RCRJRCOL",30,0)
 .   ;  stat 39 (cancellation)    ; stat 41 (refunded)
"RTN","RCRJRCOL",31,0)
 .   I ",17,22,23,26,39,41,"[(","_STAT_",") S DATE=DATEBEG-1,CLOSED=1
"RTN","RCRJRCOL",32,0)
 .   F  S DATE=$O(^PRCA(430,"ASDT",STAT,DATE)) Q:'DATE  D
"RTN","RCRJRCOL",33,0)
 .   .   S BILLDA=0 F  S BILLDA=$O(^PRCA(430,"ASDT",STAT,DATE,BILLDA)) Q:'BILLDA  D
"RTN","RCRJRCOL",34,0)
 .   .   .   ;  do not count bills already skipped
"RTN","RCRJRCOL",35,0)
 .   .   .   I $D(^TMP($J,"RCRJRCOL","COUNT",BILLDA,0)) Q
"RTN","RCRJRCOL",36,0)
 .   .   .   S DATA0=$G(^PRCA(430,BILLDA,0))
"RTN","RCRJRCOL",37,0)
 .   .   .   I '$P(DATA0,"^",12) S ^TMP($J,"RCRJRCOL","COUNT",BILLDA,0)="" Q
"RTN","RCRJRCOL",38,0)
 .   .   .   ;  no original amount
"RTN","RCRJRCOL",39,0)
 .   .   .   I $P(DATA0,"^",3)="" S ^TMP($J,"RCRJRCOL","COUNT",BILLDA,0)="" Q
"RTN","RCRJRCOL",40,0)
 .   .   .   ;
"RTN","RCRJRCOL",41,0)
 .   .   .   ;  do not look at bills activated after end date
"RTN","RCRJRCOL",42,0)
 .   .   .   S ACTDATE=$P($P($G(^PRCA(430,BILLDA,6)),"^",21),".")
"RTN","RCRJRCOL",43,0)
 .   .   .   I 'ACTDATE!(ACTDATE>DATEEND) S ^TMP($J,"RCRJRCOL","COUNT",BILLDA,0)="" Q
"RTN","RCRJRCOL",44,0)
 .   .   .   ;
"RTN","RCRJRCOL",45,0)
 .   .   .   ;  bill is closed before end date, decrease debt
"RTN","RCRJRCOL",46,0)
 .   .   .   I CLOSED,DATE'>DATEEND D  Q
"RTN","RCRJRCOL",47,0)
 .   .   .   .   ;  if previous status was:
"RTN","RCRJRCOL",48,0)
 .   .   .   .   ;  18 (new bill), 27 (incomplete), 20 (pend approval)
"RTN","RCRJRCOL",49,0)
 .   .   .   .   ;  then the bill was never counted as a new receivable
"RTN","RCRJRCOL",50,0)
 .   .   .   .   ;  and should not be counted as a decrease in debts
"RTN","RCRJRCOL",51,0)
 .   .   .   .   S PREVSTAT=$P($G(^PRCA(430,BILLDA,9)),"^",6)
"RTN","RCRJRCOL",52,0)
 .   .   .   .   I PREVSTAT=18!(PREVSTAT=20)!(PREVSTAT=27) S ^TMP($J,"RCRJRCOL","COUNT",BILLDA,0)="" Q
"RTN","RCRJRCOL",53,0)
 .   .   .   .   D SETTOTAL^RCRJRCO1(17,0,0)
"RTN","RCRJRCOL",54,0)
 .   .   .   ;
"RTN","RCRJRCOL",55,0)
 .   .   .   D CURRENT^RCRJRCOB(BILLDA,DATEEND,AYEAROLD)
"RTN","RCRJRCOL",56,0)
 ;
"RTN","RCRJRCOL",57,0)
 ;  collect data from file 433
"RTN","RCRJRCOL",58,0)
 D START^RCRJRCO1
"RTN","RCRJRCOL",59,0)
 ;  send data to ndb and fms
"RTN","RCRJRCOL",60,0)
 D SEND^RCRJRCOR
"RTN","RCRJRCOL",61,0)
 ;  print summary report
"RTN","RCRJRCOL",62,0)
 D SUMMARY^RCRJRCOR
"RTN","RCRJRCOL",63,0)
 ;
"RTN","RCRJRCOL",64,0)
 ;  compile and print bad debt report
"RTN","RCRJRCOL",65,0)
 I '$G(RCRJFBDR) D START^RCRJRBD(DATEEND)
"RTN","RCRJRCOL",66,0)
 ;
"RTN","RCRJRCOL",67,0)
KILLTMP ;  kill tmp globals
"RTN","RCRJRCOL",68,0)
 K ^TMP($J,"RCRJRBD")        ;stores the bad debt report
"RTN","RCRJRCOL",69,0)
 K ^TMP($J,"RCRJRCOL")       ;used internally
"RTN","RCRJRCOL",70,0)
 K ^TMP($J,"RCRJRCOLNDB")    ;stores the ndb data
"RTN","RCRJRCOL",71,0)
 K ^TMP($J,"RCRJROIG")       ;stores the data for the oig extract
"RTN","RCRJRCOL",72,0)
 K ^TMP($J,"RCRJRCOLSV")     ;stores the fms sv code sheet
"RTN","RCRJRCOL",73,0)
 K ^TMP($J,"RCRJRCOLWR")     ;stores the fms wr code sheet
"RTN","RCRJRCOL",74,0)
 K ^TMP($J,"RCRJRCOLREPORT") ;stores the user report
"RTN","RCRJRCOL",75,0)
 K ^TMP($J,"RCBMILLDATA")    ;stores the mccf/hsif payment split for rx
"RTN","RCRJRCOL",76,0)
 Q
"RTN","RCRJRCOL",77,0)
 ;
"RTN","RCRJRCOL",78,0)
 ;
"RTN","RCRJRCOL",79,0)
GETNEW(DATEBEG,DATEEND,RCRJFSTO) ;  get new receivables between two dates
"RTN","RCRJRCOL",80,0)
 ;  rcrjfsto is a flag which is set to 1 for the ndb rollup and it
"RTN","RCRJRCOL",81,0)
 ;  will store the data in tmp.  If its not a 1, it will count the 
"RTN","RCRJRCOL",82,0)
 ;  new bills and just return the count ^ amount.
"RTN","RCRJRCOL",83,0)
 N COUNT,DATE,ORIGAMT,PRINBAL
"RTN","RCRJRCOL",84,0)
 S COUNT=0,PRINBAL=0
"RTN","RCRJRCOL",85,0)
 S DATE=DATEBEG-1
"RTN","RCRJRCOL",86,0)
 F  S DATE=$O(^PRCA(430,"ACTDT",DATE)) Q:'DATE!(DATE>DATEEND)  D
"RTN","RCRJRCOL",87,0)
 .   S BILLDA=0 F  S BILLDA=$O(^PRCA(430,"ACTDT",DATE,BILLDA)) Q:'BILLDA  D
"RTN","RCRJRCOL",88,0)
 .   .   S ORIGAMT=$$TESTNEW(BILLDA,DATEBEG,DATEEND)
"RTN","RCRJRCOL",89,0)
 .   .   ;  not a new receivable
"RTN","RCRJRCOL",90,0)
 .   .   I ORIGAMT="" S:RCRJFSTO ^TMP($J,"RCRJRCOL","COUNT",BILLDA,0)="" Q
"RTN","RCRJRCOL",91,0)
 .   .   ;  store for ndb
"RTN","RCRJRCOL",92,0)
 .   .   I RCRJFSTO D SETTOTAL^RCRJRCO1(13,ORIGAMT,0)
"RTN","RCRJRCOL",93,0)
 .   .   S COUNT=COUNT+1,PRINBAL=PRINBAL+ORIGAMT
"RTN","RCRJRCOL",94,0)
 ;
"RTN","RCRJRCOL",95,0)
 Q COUNT_"^"_PRINBAL
"RTN","RCRJRCOL",96,0)
 ;
"RTN","RCRJRCOL",97,0)
 ;
"RTN","RCRJRCOL",98,0)
TESTNEW(BILLDA,DATEBEG,DATEEND) ;  test to see if a bill is a new receivable
"RTN","RCRJRCOL",99,0)
 ;  returns the principal balance if a bill is new
"RTN","RCRJRCOL",100,0)
 N DATA0,STAT
"RTN","RCRJRCOL",101,0)
 S DATA0=$G(^PRCA(430,BILLDA,0))
"RTN","RCRJRCOL",102,0)
 ;  no site
"RTN","RCRJRCOL",103,0)
 I '$P(DATA0,"^",12) Q ""
"RTN","RCRJRCOL",104,0)
 ;  bill never had an original amount (prepayments would not be
"RTN","RCRJRCOL",105,0)
 ;  picked up here since they do not have an original amount)
"RTN","RCRJRCOL",106,0)
 I $P(DATA0,"^",3)="" Q ""
"RTN","RCRJRCOL",107,0)
 ;
"RTN","RCRJRCOL",108,0)
 S STAT=$P(DATA0,"^",8)
"RTN","RCRJRCOL",109,0)
 ;  no status
"RTN","RCRJRCOL",110,0)
 I 'STAT Q ""
"RTN","RCRJRCOL",111,0)
 ;  bill was cancelled the same month
"RTN","RCRJRCOL",112,0)
 ;I STAT=26,($E($P(DATA0,"^",14),1,5)=$E(DATEBEG,1,5)) Q ""
"RTN","RCRJRCOL",113,0)
 I STAT=26&($P(DATA0,"^",14)<DATEBEG!($P(DATA0,"^",14)>DATEEND)) Q ""
"RTN","RCRJRCOL",114,0)
 ;  bill incomplete
"RTN","RCRJRCOL",115,0)
 I STAT=27 Q ""
"RTN","RCRJRCOL",116,0)
 ;  bill new
"RTN","RCRJRCOL",117,0)
 I STAT=18 Q ""
"RTN","RCRJRCOL",118,0)
 ;  bill pending approval
"RTN","RCRJRCOL",119,0)
 I STAT=20 Q ""
"RTN","RCRJRCOL",120,0)
 ;  bill returned from AR (new)
"RTN","RCRJRCOL",121,0)
 I STAT=31 Q ""
"RTN","RCRJRCOL",122,0)
 ;
"RTN","RCRJRCOL",123,0)
 ;  yes, its a new receivable, return its original amount
"RTN","RCRJRCOL",124,0)
 Q +$P(DATA0,"^",3)
"RTN","RCRJRCOL",125,0)
 ;
"RTN","RCRJRCOL",126,0)
 ;
"RTN","RCRJRCOL",127,0)
CRITERIA(BILLDA) ;  find a bills criteria/category 1,3,4,5
"RTN","RCRJRCOL",128,0)
 ;  returns 1--3-4-5  where the number is the criteria number
"RTN","RCRJRCOL",129,0)
 ;  the second piece is set at settotal^rcrjrco1
"RTN","RCRJRCOL",130,0)
 ;
"RTN","RCRJRCOL",131,0)
 N %,CRITER1,CRITER35,DATA0,X
"RTN","RCRJRCOL",132,0)
 S DATA0=$G(^PRCA(430,BILLDA,0))
"RTN","RCRJRCOL",133,0)
 ;
"RTN","RCRJRCOL",134,0)
 ;  % = segment
"RTN","RCRJRCOL",135,0)
 S %=$P(DATA0,"^",21)
"RTN","RCRJRCOL",136,0)
 S CRITER1=$S(%=243:1,%=244:3,%=245:2,%=246:8,%=247:9,%=248:10,%=249:5,%=251:14,%=252:16,%=292:6,%=293:7,%=294:11,%=295:19,%=296:20,%=297:4,%=298:12,1:0)
"RTN","RCRJRCOL",137,0)
 ;
"RTN","RCRJRCOL",138,0)
 ;   acck = accrual
"RTN","RCRJRCOL",139,0)
 I CRITER1=8,'$$ACCK^PRCAACC(BILLDA) S CRITER1=18
"RTN","RCRJRCOL",140,0)
 ;
"RTN","RCRJRCOL",141,0)
 I 'CRITER1 D
"RTN","RCRJRCOL",142,0)
 . S %=$P($G(^PRCA(430.2,+$P(DATA0,"^",2),0)),"^",7)
"RTN","RCRJRCOL",143,0)
 . ; % = Category Number:
"RTN","RCRJRCOL",144,0)
 . ; 22 TORT FEASOR
"RTN","RCRJRCOL",145,0)
 . ; 18 SHARING AGREEMENTS
"RTN","RCRJRCOL",146,0)
 . ; 33 PREPAYMENT
"RTN","RCRJRCOL",147,0)
 . ; 40 ADULT DAY HEALTH CARE
"RTN","RCRJRCOL",148,0)
 . ; 41 DOMICILIARY
"RTN","RCRJRCOL",149,0)
 . ; 42 RESPITE CARE-INSTITUTIONAL
"RTN","RCRJRCOL",150,0)
 . ; 43 RESPITE CARE-NON-INSTITUTIONAL
"RTN","RCRJRCOL",151,0)
 . ; 44 GERIATRIC EVAL-INSTITUTIONAL
"RTN","RCRJRCOL",152,0)
 . ; 45 GERIATRIC EVAL-NON-INSTITUTION
"RTN","RCRJRCOL",153,0)
 . ; 46 NURSING HOME CARE-LTC
"RTN","RCRJRCOL",154,0)
 . S CRITER1=$S(%=22:15,%=18:17,%=33:13,%=40:1,%=41:20,%=42:20,%=43:1,%=44:20,%=45:1,%=46:20,1:18)
"RTN","RCRJRCOL",155,0)
 ;
"RTN","RCRJRCOL",156,0)
 ;  determine criteria 3,4,5
"RTN","RCRJRCOL",157,0)
 S CRITER35="0-0-0"
"RTN","RCRJRCOL",158,0)
 I CRITER1>3,CRITER1<8  D
"RTN","RCRJRCOL",159,0)
 .   S %=$TR($$CRIT^IBRFN2(BILLDA),"^","-") ;integration agreement 1182
"RTN","RCRJRCOL",160,0)
 .   I %=-1 S CRITER35="3-1-4" Q
"RTN","RCRJRCOL",161,0)
 .   I $P(%,"-")="" S $P(%,"-")=3
"RTN","RCRJRCOL",162,0)
 .   I $P(%,"-",2)="" S $P(%,"-",2)=1
"RTN","RCRJRCOL",163,0)
 .   I $P(%,"-",3)="" S $P(%,"-",3)=4
"RTN","RCRJRCOL",164,0)
 .   S CRITER35=%
"RTN","RCRJRCOL",165,0)
 ;
"RTN","RCRJRCOL",166,0)
 Q CRITER1_"--"_CRITER35
"RTN","RCRJRCOR")
0^7^B58736197
"RTN","RCRJRCOR",1,0)
RCRJRCOR ;WISC/RFJ-ar data collector summary report ;1 Mar 97
"RTN","RCRJRCOR",2,0)
 ;;4.5;Accounts Receivable;**68,96,139,103,156,170,174,191**;Mar 20, 1995
"RTN","RCRJRCOR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRCOR",4,0)
 Q
"RTN","RCRJRCOR",5,0)
 ;
"RTN","RCRJRCOR",6,0)
 ;
"RTN","RCRJRCOR",7,0)
SEND ;  send data to ndb and data to FMS
"RTN","RCRJRCOR",8,0)
 N %,AMOUNT,DATEMOYR,FUND,LINE,RSC,SPACE,TOTAL,TOTALFUN,TOTALTYP,TYPE,X,XMY,Y
"RTN","RCRJRCOR",9,0)
 ;
"RTN","RCRJRCOR",10,0)
 ;  ---------- send to ndb ----------
"RTN","RCRJRCOR",11,0)
 ;  data stored in tmp($j,rcrjrcolndb)
"RTN","RCRJRCOR",12,0)
 I '$G(RCRJFAR1) D NDB(PRCASITE,DATEBEG,DATEEND)
"RTN","RCRJRCOR",13,0)
 ;
"RTN","RCRJRCOR",14,0)
 ;
"RTN","RCRJRCOR",15,0)
 ;  ---------- send sv to fms ----------
"RTN","RCRJRCOR",16,0)
 ;  data stored in tmp($j,rcrjrcolsv)
"RTN","RCRJRCOR",17,0)
 ;  rcrjfsv is a flag set in the routine rcrjrco for retransmission
"RTN","RCRJRCOR",18,0)
 ;  to prevent accepted fms documents from being resent
"RTN","RCRJRCOR",19,0)
 I '$G(RCRJFSV) D STARTSV^RCXFMSSV(DATEEND)
"RTN","RCRJRCOR",20,0)
 ;
"RTN","RCRJRCOR",21,0)
 ;
"RTN","RCRJRCOR",22,0)
 ;  ---------- send wr to fms ----------
"RTN","RCRJRCOR",23,0)
 ;  data stored in tmp($j,rcrjrcolwr)
"RTN","RCRJRCOR",24,0)
 ;  rcrjfwr is a flag set in the routine rcrjrco for retransmission
"RTN","RCRJRCOR",25,0)
 ;  to prevent accepted fms documents from being resent
"RTN","RCRJRCOR",26,0)
 I '$G(RCRJFWR) D STARTWR^RCXFMSWR(DATEEND)
"RTN","RCRJRCOR",27,0)
 ;
"RTN","RCRJRCOR",28,0)
 ;  ---------- send tr to fms ----------
"RTN","RCRJRCOR",29,0)
 N RCTRANS
"RTN","RCRJRCOR",30,0)
 ;  this call returns rctrans array (see rcxfmstx for description)
"RTN","RCRJRCOR",31,0)
 ;  rcrjftr is a flag set in the routine rcrjrco for retransmission
"RTN","RCRJRCOR",32,0)
 ;  to prevent accepted fms documents from being resent
"RTN","RCRJRCOR",33,0)
 I '$G(RCRJFTR) D STARTTR^RCXFMSTX(DATEEND)
"RTN","RCRJRCOR",34,0)
 ;
"RTN","RCRJRCOR",35,0)
 ;  ---------- send oig extract ----------
"RTN","RCRJRCOR",36,0)
 ;  data stored in tmp(j,rcrjroig)
"RTN","RCRJRCOR",37,0)
 ;  get non-mccf bills for extract and user report
"RTN","RCRJRCOR",38,0)
 D NONMCCF^RCRJROIG(DATEEND)
"RTN","RCRJRCOR",39,0)
 ;  rcrjfoig is a flag set in the routine rcrjrco for retransmission
"RTN","RCRJRCOR",40,0)
 ;  to prevent the oig extract from being resent
"RTN","RCRJRCOR",41,0)
 I '$G(RCRJFOIG) D OIG^RCRJROIG(DATEEND)
"RTN","RCRJRCOR",42,0)
 ;
"RTN","RCRJRCOR",43,0)
 ;  generate a mailman message to the group showing the data
"RTN","RCRJRCOR",44,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCOR",45,0)
 S Y=$E(DATEEND,1,5)_"00" D DD^%DT S DATEMOYR=Y
"RTN","RCRJRCOR",46,0)
 S LINE=0,SPACE="",$P(SPACE," ",80)=""
"RTN","RCRJRCOR",47,0)
 D SET("Data has been collected for the month "_DATEMOYR_".  The data has been")
"RTN","RCRJRCOR",48,0)
 D SET("transmitted to the following systems:")
"RTN","RCRJRCOR",49,0)
 D SET(" ")
"RTN","RCRJRCOR",50,0)
 ;
"RTN","RCRJRCOR",51,0)
 I '$G(RCRJFAR1) D
"RTN","RCRJRCOR",52,0)
 .   D SET("NATIONAL DATABASE DATA")
"RTN","RCRJRCOR",53,0)
 .   D SET("----------------------")
"RTN","RCRJRCOR",54,0)
 .   D SET("The data has been sent to the National Database.  For a detail list")
"RTN","RCRJRCOR",55,0)
 .   D SET("of the data sent, please review the Return Reports which are sent")
"RTN","RCRJRCOR",56,0)
 .   D SET("from the National Database.")
"RTN","RCRJRCOR",57,0)
 .   D SET(" ")
"RTN","RCRJRCOR",58,0)
 ;
"RTN","RCRJRCOR",59,0)
 I '$G(RCRJFSV) D
"RTN","RCRJRCOR",60,0)
 .   D SET("FMS, STANDARD VOUCHER (SV) DOCUMENT")
"RTN","RCRJRCOR",61,0)
 .   D SET("-----------------------------------")
"RTN","RCRJRCOR",62,0)
 .   D SET("The following data has been transmitted to FMS in the SV document:")
"RTN","RCRJRCOR",63,0)
 .   D SET("  Revenue Source Code                                        Type       Amount")
"RTN","RCRJRCOR",64,0)
 .   D SET("  -------------------                                        ----       ------")
"RTN","RCRJRCOR",65,0)
 .   S TOTAL=0
"RTN","RCRJRCOR",66,0)
 .   S TYPE="" F  S TYPE=$O(^TMP($J,"RCRJRCOLSV",TYPE)) Q:TYPE=""  D
"RTN","RCRJRCOR",67,0)
 .   .   S TOTALTYP=0
"RTN","RCRJRCOR",68,0)
 .   .   S FUND="" F  S FUND=$O(^TMP($J,"RCRJRCOLSV",TYPE,FUND)) Q:FUND=""  D
"RTN","RCRJRCOR",69,0)
 .   .   .   S TOTALFUN=0
"RTN","RCRJRCOR",70,0)
 .   .   .   S RSC="" F  S RSC=$O(^TMP($J,"RCRJRCOLSV",TYPE,FUND,RSC)) Q:RSC=""  S AMOUNT=^(RSC) D
"RTN","RCRJRCOR",71,0)
 .   .   .   .   D SET("  "_RSC_" "_$E($$GETDESC^RCXFMSPR(RSC)_SPACE,1,54)_"  "_TYPE_$J(AMOUNT,13,2))
"RTN","RCRJRCOR",72,0)
 .   .   .   .   S TOTALFUN=TOTALFUN+AMOUNT
"RTN","RCRJRCOR",73,0)
 .   .   .   .   S TOTALTYP=TOTALTYP+AMOUNT
"RTN","RCRJRCOR",74,0)
 .   .   .   .   S TOTAL=TOTAL+AMOUNT
"RTN","RCRJRCOR",75,0)
 .   .   .   ;
"RTN","RCRJRCOR",76,0)
 .   .   .   I TYPE=21 D SET($E("            Sub-Total by Fund "_FUND_":"_SPACE,1,38)_$J(TOTALFUN,12,2))
"RTN","RCRJRCOR",77,0)
 .   .   ;
"RTN","RCRJRCOR",78,0)
 .   .   D SET("                                                                    ----------")
"RTN","RCRJRCOR",79,0)
 .   .   D SET("                                                    TOTAL TYPE "_TYPE_$J(TOTALTYP,13,2))
"RTN","RCRJRCOR",80,0)
 .   .   D SET(" ")
"RTN","RCRJRCOR",81,0)
 .   ;
"RTN","RCRJRCOR",82,0)
 .   D SET("                                                                    ----------")
"RTN","RCRJRCOR",83,0)
 .   D SET("                                                         TOTAL SV"_$J(TOTAL,13,2))
"RTN","RCRJRCOR",84,0)
 .   D SET(" ")
"RTN","RCRJRCOR",85,0)
 ;
"RTN","RCRJRCOR",86,0)
 I '$G(RCRJFWR) D
"RTN","RCRJRCOR",87,0)
 .   D SET("FMS, WRITEOFFS/CONTRACT ADJUSTMENTS (WR) DOCUMENT")
"RTN","RCRJRCOR",88,0)
 .   D SET("-------------------------------------------------")
"RTN","RCRJRCOR",89,0)
 .   D SET("The following data has been transmitted to FMS in the WR document:")
"RTN","RCRJRCOR",90,0)
 .   D SET("  Revenue Source Code                                        Type       Amount")
"RTN","RCRJRCOR",91,0)
 .   D SET("  -------------------                                        ----       ------")
"RTN","RCRJRCOR",92,0)
 .   S TOTAL=0
"RTN","RCRJRCOR",93,0)
 .   S TYPE="" F  S TYPE=$O(^TMP($J,"RCRJRCOLWR",TYPE)) Q:TYPE=""  D
"RTN","RCRJRCOR",94,0)
 .   .   S TOTALTYP=0
"RTN","RCRJRCOR",95,0)
 .   .   S FUND="" F  S FUND=$O(^TMP($J,"RCRJRCOLWR",TYPE,FUND)) Q:FUND=""  D
"RTN","RCRJRCOR",96,0)
 .   .   .   S TOTALFUN=0
"RTN","RCRJRCOR",97,0)
 .   .   .   S RSC="" F  S RSC=$O(^TMP($J,"RCRJRCOLWR",TYPE,FUND,RSC)) Q:RSC=""  S AMOUNT=^(RSC) D
"RTN","RCRJRCOR",98,0)
 .   .   .   .   D SET("  "_RSC_" "_$E($$GETDESC^RCXFMSPR(RSC)_SPACE,1,54)_"  "_TYPE_$J(AMOUNT,13,2))
"RTN","RCRJRCOR",99,0)
 .   .   .   .   S TOTALFUN=TOTALFUN+AMOUNT
"RTN","RCRJRCOR",100,0)
 .   .   .   .   S TOTALTYP=TOTALTYP+AMOUNT
"RTN","RCRJRCOR",101,0)
 .   .   .   .   S TOTAL=TOTAL+AMOUNT
"RTN","RCRJRCOR",102,0)
 .   .   .   ;
"RTN","RCRJRCOR",103,0)
 .   .   .   I TYPE="04" D SET($E("            Sub-Total by Fund "_FUND_":"_SPACE,1,38)_$J(TOTALFUN,12,2))
"RTN","RCRJRCOR",104,0)
 .   .   ;
"RTN","RCRJRCOR",105,0)
 .   .   D SET("                                                                    ----------")
"RTN","RCRJRCOR",106,0)
 .   .   D SET("                                                    TOTAL TYPE "_TYPE_$J(TOTALTYP,13,2))
"RTN","RCRJRCOR",107,0)
 .   .   D SET(" ")
"RTN","RCRJRCOR",108,0)
 .   D SET("                                                                    ----------")
"RTN","RCRJRCOR",109,0)
 .   D SET("                                                         TOTAL WR"_$J(TOTAL,13,2))
"RTN","RCRJRCOR",110,0)
 .   D SET(" ")
"RTN","RCRJRCOR",111,0)
 ;
"RTN","RCRJRCOR",112,0)
 I '$G(RCRJFTR) D
"RTN","RCRJRCOR",113,0)
 .   D SET("FMS, TRANSFER FROM MCCF TO HSIF (TR) DOCUMENT")
"RTN","RCRJRCOR",114,0)
 .   D SET("-------------------------------------------------")
"RTN","RCRJRCOR",115,0)
 .   D SET("The following data has been transmitted to FMS in the TR document:")
"RTN","RCRJRCOR",116,0)
 .   D SET("  From Fund    From RSC       To Fund    To RSC                         Amount")
"RTN","RCRJRCOR",117,0)
 .   D SET("  ---------    --------       -------    ------                     ----------")
"RTN","RCRJRCOR",118,0)
 .   I $O(RCTRANS(""))="" D SET("  No Dollars to Transfer.") Q
"RTN","RCRJRCOR",119,0)
 .   ;
"RTN","RCRJRCOR",120,0)
 .   S FUND="" F  S FUND=$O(RCTRANS(FUND)) Q:FUND=""  D
"RTN","RCRJRCOR",121,0)
 .   .   S RSC="" F  S RSC=$O(RCTRANS(FUND,RSC)) Q:RSC=""  D
"RTN","RCRJRCOR",122,0)
 .   .   .   ;  rctrans(fromfund,fromrsc) = tofund ^ torsc ^ amount
"RTN","RCRJRCOR",123,0)
 .   .   .   S AMOUNT=RCTRANS(FUND,RSC)
"RTN","RCRJRCOR",124,0)
 .   .   .   D SET($J(FUND,11)_$J(RSC,12)_$J($P(AMOUNT,"^"),14)_$J($P(AMOUNT,"^",2),10)_$J($P(AMOUNT,"^",3),31,2))
"RTN","RCRJRCOR",125,0)
 ;
"RTN","RCRJRCOR",126,0)
 S XMY("G.RC AR DATA COLLECTOR")=""
"RTN","RCRJRCOR",127,0)
 S %=$$SENDMSG("AR Data Collector for "_DATEMOYR_" Station "_PRCASITE,.XMY)
"RTN","RCRJRCOR",128,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCOR",129,0)
 ;
"RTN","RCRJRCOR",130,0)
 ;  send users detail report
"RTN","RCRJRCOR",131,0)
 D USERREPT^RCRJRCOU(DATEMOYR)
"RTN","RCRJRCOR",132,0)
 Q
"RTN","RCRJRCOR",133,0)
 ;
"RTN","RCRJRCOR",134,0)
 ;
"RTN","RCRJRCOR",135,0)
NDB(PRCASITE,DATEBEG,DATEEND) ;  send data to the national database
"RTN","RCRJRCOR",136,0)
 N %,BATCNAME,COUNT,CRITERIA,DATA,LINE,XMY,X,Y
"RTN","RCRJRCOR",137,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCOR",138,0)
 S LINE=2,DATA="D$ "
"RTN","RCRJRCOR",139,0)
 S CRITERIA="" F COUNT=1:1 S CRITERIA=$O(^TMP($J,"RCRJRCOLNDB",CRITERIA)) Q:CRITERIA=""  D
"RTN","RCRJRCOR",140,0)
 .   S DATA=DATA_":"_COUNT_"/"_CRITERIA_"/"_^TMP($J,"RCRJRCOLNDB",CRITERIA)
"RTN","RCRJRCOR",141,0)
 .   I $L(DATA)>200 D SET(DATA) S DATA="D$ "
"RTN","RCRJRCOR",142,0)
 I DATA'="D$ " D SET(DATA)
"RTN","RCRJRCOR",143,0)
 ;
"RTN","RCRJRCOR",144,0)
 ;  build the first two control lines in mail message
"RTN","RCRJRCOR",145,0)
 S Y=DATEBEG D DD^%DT
"RTN","RCRJRCOR",146,0)
 S BATCNAME="AR1-"_$E(Y,1,3)_$E(DATEBEG,6,7)_$TR($P(Y,",",2)," ")
"RTN","RCRJRCOR",147,0)
 S Y=DATEEND D DD^%DT
"RTN","RCRJRCOR",148,0)
 S BATCNAME=BATCNAME_"-"_$E(Y,1,3)_$E(DATEEND,6,7)_$TR($P(Y,",",2)," ")
"RTN","RCRJRCOR",149,0)
 S ^TMP($J,"RCRJRCORMM",1)="T$ "_PRCASITE_"$"_BATCNAME_"$$$$$*"
"RTN","RCRJRCOR",150,0)
 ;  get end time (in %)
"RTN","RCRJRCOR",151,0)
 D NOW^%DTC
"RTN","RCRJRCOR",152,0)
 S ^TMP($J,"RCRJRCORMM",2)="S$ "_STRTTIME_"^"_%_"$0$"_(COUNT-1)
"RTN","RCRJRCOR",153,0)
 ;
"RTN","RCRJRCOR",154,0)
 S XMY("S.PRQN DATA COLLECTION MONITOR@FO-ALBANY.MED.VA.GOV")=""
"RTN","RCRJRCOR",155,0)
 S %=$$SENDMSG("AR1 "_$E(DATEEND,4,5)_"/"_$E(DATEEND,2,3)_" NDB DATA FOR SITE "_PRCASITE,.XMY)
"RTN","RCRJRCOR",156,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCOR",157,0)
 Q
"RTN","RCRJRCOR",158,0)
 ;
"RTN","RCRJRCOR",159,0)
 ;
"RTN","RCRJRCOR",160,0)
SUMMARY ;  print summary report in mailman bulletin
"RTN","RCRJRCOR",161,0)
 N %,BILLDA,CRITER2,CRITERIA,DATA0,DFN,LINE,STAT,TOTAL,VA,XMY
"RTN","RCRJRCOR",162,0)
 K ^TMP($J,"RCRJRCOR")   ; used to identify test patients
"RTN","RCRJRCOR",163,0)
 K ^TMP($J,"RCRJRCORMM") ; used to build mailman message
"RTN","RCRJRCOR",164,0)
 ;
"RTN","RCRJRCOR",165,0)
 ;  print any test patient bills which have not been closed
"RTN","RCRJRCOR",166,0)
 S BILLDA=0 F  S BILLDA=$O(^TMP($J,"RCRJRCOL","CRIT2",1,BILLDA)) Q:'BILLDA  I $D(^(BILLDA,1)) D
"RTN","RCRJRCOR",167,0)
 .   S DATA0=$G(^PRCA(430,BILLDA,0)),STAT=$P(DATA0,"^",8)
"RTN","RCRJRCOR",168,0)
 .   I STAT'=16,STAT='42 Q  ; bill not currently open
"RTN","RCRJRCOR",169,0)
 .   S DFN=+$P(DATA0,"^",7) I 'DFN Q
"RTN","RCRJRCOR",170,0)
 .   D PID^VADPT
"RTN","RCRJRCOR",171,0)
 .   I $E($TR($G(VA("PID")),"-"),1,5)="00000" S ^TMP($J,"RCRJRCOR","TEST",BILLDA)=""
"RTN","RCRJRCOR",172,0)
 ;
"RTN","RCRJRCOR",173,0)
 I '$D(^TMP($J,"RCRJRCOR","TEST")) Q
"RTN","RCRJRCOR",174,0)
 ;
"RTN","RCRJRCOR",175,0)
 ;  print data
"RTN","RCRJRCOR",176,0)
 S LINE=0
"RTN","RCRJRCOR",177,0)
 D SET(" ")
"RTN","RCRJRCOR",178,0)
 D SET("The following bills are active and linked to test patients:")
"RTN","RCRJRCOR",179,0)
 S BILLDA=0 F  S BILLDA=$O(^TMP($J,"RCRJRCOR","TEST",BILLDA)) Q:'BILLDA  D SET("  "_$P($G(^PRCA(430,BILLDA,0)),"^")_" (#",BILLDA_")")
"RTN","RCRJRCOR",180,0)
 ;
"RTN","RCRJRCOR",181,0)
 S XMY("G.RC AR DATA COLLECTOR")=""
"RTN","RCRJRCOR",182,0)
 S %=$$SENDMSG("MCCR DATA COLLECTOR INFORMATION",.XMY)
"RTN","RCRJRCOR",183,0)
 K ^TMP($J,"RCRJRCOR")
"RTN","RCRJRCOR",184,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCOR",185,0)
 Q
"RTN","RCRJRCOR",186,0)
 ;
"RTN","RCRJRCOR",187,0)
 ;
"RTN","RCRJRCOR",188,0)
SET(DATA)          ;  store report
"RTN","RCRJRCOR",189,0)
 S LINE=LINE+1,^TMP($J,"RCRJRCORMM",LINE)=DATA
"RTN","RCRJRCOR",190,0)
 Q
"RTN","RCRJRCOR",191,0)
 ;
"RTN","RCRJRCOR",192,0)
 ;
"RTN","RCRJRCOR",193,0)
SENDMSG(XMSUB,XMY) ;  send message with subject and recipients
"RTN","RCRJRCOR",194,0)
 N %X,D0,D1,D2,DIC,DICR,DIW,X,XCNP,XMDISPI,XMDUN,XMDUZ,XMTEXT,XMZ,ZTPAR
"RTN","RCRJRCOR",195,0)
 S XMDUZ="AR PACKAGE",XMTEXT="^TMP($J,""RCRJRCORMM"","
"RTN","RCRJRCOR",196,0)
 D ^XMD
"RTN","RCRJRCOR",197,0)
 Q +$G(XMZ)
"RTN","RCXFMSSV")
0^6^B45443336
"RTN","RCXFMSSV",1,0)
RCXFMSSV ;WISC/RFJ-fms standard voucher (sv) code sheet generator ;1 Nov 97
"RTN","RCXFMSSV",2,0)
 ;;4.5;Accounts Receivable;**96,101,135,139,98,156,170,191**;Mar 20, 1995
"RTN","RCXFMSSV",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSSV",4,0)
 Q
"RTN","RCXFMSSV",5,0)
 ;
"RTN","RCXFMSSV",6,0)
 ;
"RTN","RCXFMSSV",7,0)
STARTSV(RCDATEND) ;  top entry point to generate a sv code sheet
"RTN","RCXFMSSV",8,0)
 ;
"RTN","RCXFMSSV",9,0)
 ;  rcdatend is the ending date of the period.
"RTN","RCXFMSSV",10,0)
 ;  This date is the 3rd work day from the end of the month.
"RTN","RCXFMSSV",11,0)
 ;  The utility $$LDATE^RCRJR is used to figure it out. It will
"RTN","RCXFMSSV",12,0)
 ;  change from month to month and figures in holidays also.
"RTN","RCXFMSSV",13,0)
 ;  For example,  if running the ARDC for the month of June 2003
"RTN","RCXFMSSV",14,0)
 ;  the EOAM will calculate out to be June 25, 2003.
"RTN","RCXFMSSV",15,0)
 ;  This is called by the background monthly data collector
"RTN","RCXFMSSV",16,0)
 ;
"RTN","RCXFMSSV",17,0)
 ;  data stored in tmp($j,rcrjrcolsv,type,fund,revsourcecode)
"RTN","RCXFMSSV",18,0)
 ;  this is called by the background monthly data collector
"RTN","RCXFMSSV",19,0)
 ;
"RTN","RCXFMSSV",20,0)
 N GECSDATA,RCTRANID,RESULT
"RTN","RCXFMSSV",21,0)
 ;  lookup fms document number to see if the monthly sv has been sent
"RTN","RCXFMSSV",22,0)
 ;  example rcdatend=3010531, lookup on 3010500
"RTN","RCXFMSSV",23,0)
 D KEYLOOK^GECSSGET("SV-"_$E(RCDATEND,1,5)_"00",1)
"RTN","RCXFMSSV",24,0)
 ;
"RTN","RCXFMSSV",25,0)
 ;  get the transacion id for the fms document
"RTN","RCXFMSSV",26,0)
 ;  if it is not sent, get the next number available
"RTN","RCXFMSSV",27,0)
 I $G(GECSDATA) S RCTRANID=$E($P(GECSDATA("2100.1",GECSDATA,".01","E"),"-",2),1,11)
"RTN","RCXFMSSV",28,0)
 I $G(RCTRANID)="" S RCTRANID=$$ENUM^RCMSNUM
"RTN","RCXFMSSV",29,0)
 I RCTRANID<0 Q  ;unable to retrieve the next number
"RTN","RCXFMSSV",30,0)
 ;  remove dash (example 460-K1A05HY)
"RTN","RCXFMSSV",31,0)
 S RCTRANID=$TR(RCTRANID,"-")
"RTN","RCXFMSSV",32,0)
 ;
"RTN","RCXFMSSV",33,0)
 ;  build and send the sv document to fms
"RTN","RCXFMSSV",34,0)
 S RESULT=$$BUILDSV(RCDATEND,+$G(GECSDATA),RCTRANID)
"RTN","RCXFMSSV",35,0)
 ;  error in building code sheet
"RTN","RCXFMSSV",36,0)
 I 'RESULT Q
"RTN","RCXFMSSV",37,0)
 ;
"RTN","RCXFMSSV",38,0)
 ;  add/update entry in file 347 for reports
"RTN","RCXFMSSV",39,0)
 N %DT,%X,D,D0,DA347,DI,DQ,DIC,ERROR
"RTN","RCXFMSSV",40,0)
 S DA347=$O(^RC(347,"C",$P(RESULT,"^",2),0))
"RTN","RCXFMSSV",41,0)
 ;  if not in the file, addit   fmsdocid   sv   id
"RTN","RCXFMSSV",42,0)
 I 'DA347 D OPEN^RCFMDRV1($P(RESULT,"^",2),4,"SV-"_$E(RCDATEND,1,5)_"00",.DA347,.ERROR)
"RTN","RCXFMSSV",43,0)
 I DA347 D SSTAT^RCFMFN02($P(RESULT,"^",2),1)
"RTN","RCXFMSSV",44,0)
 Q
"RTN","RCXFMSSV",45,0)
 ;
"RTN","RCXFMSSV",46,0)
 ;
"RTN","RCXFMSSV",47,0)
BUILDSV(RCDATEND,RCGECSDA,RCTRANID) ;  generate a wr code sheet for monthly data
"RTN","RCXFMSSV",48,0)
 ;  rcgecsda is the ien for the gcs stack file 2100.1 for rebuilds
"RTN","RCXFMSSV",49,0)
 ;  data stored in tmp($j,rcrjrcolsv)
"RTN","RCXFMSSV",50,0)
 ;
"RTN","RCXFMSSV",51,0)
 N AMOUNT,COUNT,DESCRIP,DOCTOTAL,FISCALYR,FMSLINE,FUND,FY,GECSFMS,MONTH,REVDATE,REVFY,REVMONTH,RSC,SV2,TYPE
"RTN","RCXFMSSV",52,0)
 ;
"RTN","RCXFMSSV",53,0)
 S FISCALYR=$$FY^RCFN01(RCDATEND)
"RTN","RCXFMSSV",54,0)
 ;
"RTN","RCXFMSSV",55,0)
 S COUNT=0,DOCTOTAL=0
"RTN","RCXFMSSV",56,0)
 S TYPE="" F  S TYPE=$O(^TMP($J,"RCRJRCOLSV",TYPE)) Q:TYPE=""  D
"RTN","RCXFMSSV",57,0)
 .   S FUND="" F  S FUND=$O(^TMP($J,"RCRJRCOLSV",TYPE,FUND)) Q:FUND=""  D
"RTN","RCXFMSSV",58,0)
 .   .   S RSC="" F  S RSC=$O(^TMP($J,"RCRJRCOLSV",TYPE,FUND,RSC)) Q:RSC=""  D
"RTN","RCXFMSSV",59,0)
 .   .   .   S AMOUNT=^TMP($J,"RCRJRCOLSV",TYPE,FUND,RSC),DOCTOTAL=DOCTOTAL+AMOUNT
"RTN","RCXFMSSV",60,0)
 .   .   .   I AMOUNT=0 Q
"RTN","RCXFMSSV",61,0)
 .   .   .   S COUNT=COUNT+1
"RTN","RCXFMSSV",62,0)
 .   .   .   S FMSLINE(COUNT)="LIN^~SVA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSSV",63,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",4)=TYPE
"RTN","RCXFMSSV",64,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",5)=FISCALYR          ;begin fy
"RTN","RCXFMSSV",65,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",7)=FUND
"RTN","RCXFMSSV",66,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",9)=$E(RCTRANID,1,3)  ;site number
"RTN","RCXFMSSV",67,0)
 .   .   .   ;  for transaction types 23,27,2B the RSC is 0, send null
"RTN","RCXFMSSV",68,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",14)=$S(RSC=0:"",1:RSC)
"RTN","RCXFMSSV",69,0)
 .   .   .   ;
"RTN","RCXFMSSV",70,0)
 .   .   .   ;  vendor id
"RTN","RCXFMSSV",71,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",18)="MCCFVALUE"
"RTN","RCXFMSSV",72,0)
 .   .   .   ;  for transaction type P2, send vendorid of PERSONOTH
"RTN","RCXFMSSV",73,0)
 .   .   .   I TYPE="P2" S $P(FMSLINE(COUNT),"^",18)="PERSONOTH"
"RTN","RCXFMSSV",74,0)
 .   .   .   ;  if it is hsif fund 5358.1, send vendorid of HSIFVALUE
"RTN","RCXFMSSV",75,0)
 .   .   .   I FUND=5358.1 S $P(FMSLINE(COUNT),"^",18)="HSIFVALUE"
"RTN","RCXFMSSV",76,0)
 .   .   .   ;  if it is ltc fund 4032, send vendorid of EXCFVALUE
"RTN","RCXFMSSV",77,0)
 .   .   .   I FUND=4032 S $P(FMSLINE(COUNT),"^",18)="EXCFVALUE"
"RTN","RCXFMSSV",78,0)
 .   .   .   ;
"RTN","RCXFMSSV",79,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",19)="~SVB"
"RTN","RCXFMSSV",80,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",20)=$J(AMOUNT,0,2)
"RTN","RCXFMSSV",81,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",21)="I"
"RTN","RCXFMSSV",82,0)
 .   .   .   ;  for transaction types 23,27,2B the RSC is 0, send G
"RTN","RCXFMSSV",83,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",23)=$S(RSC=0:"G",1:"R")
"RTN","RCXFMSSV",84,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",25)=$E(RCDATEND,2,3)
"RTN","RCXFMSSV",85,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",26)=$E(RCDATEND,4,5)
"RTN","RCXFMSSV",86,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",27)=$E(RCDATEND,6,7)
"RTN","RCXFMSSV",87,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",28)="~"
"RTN","RCXFMSSV",88,0)
 ;
"RTN","RCXFMSSV",89,0)
 ;  no code sheets to send
"RTN","RCXFMSSV",90,0)
 I COUNT=0 Q "0^No sv code sheets to send for this month"
"RTN","RCXFMSSV",91,0)
 ;
"RTN","RCXFMSSV",92,0)
 ;  calculate the accounting month and fy
"RTN","RCXFMSSV",93,0)
 S FY=$E(RCDATEND,2,3) I $E(RCDATEND,4,5)>9 S FY=FY+1 I FY=100 S FY="00"
"RTN","RCXFMSSV",94,0)
 I $L(FY)=1 S FY="0"_FY
"RTN","RCXFMSSV",95,0)
 S MONTH=$P("04^05^06^07^08^09^10^11^12^01^02^03","^",$E(RCDATEND,4,5))
"RTN","RCXFMSSV",96,0)
 ;  calculate the reversal month and fy (next month, add 1 day)
"RTN","RCXFMSSV",97,0)
 S REVDATE=$$FMADD^XLFDT(RCDATEND,7)
"RTN","RCXFMSSV",98,0)
 S REVFY=$E(REVDATE,2,3) I $E(REVDATE,4,5)>9 S REVFY=REVFY+1 I REVFY=100 S REVFY="00"
"RTN","RCXFMSSV",99,0)
 I $L(REVFY)=1 S REVFY="0"_REVFY
"RTN","RCXFMSSV",100,0)
 S REVMONTH=$P("04^05^06^07^08^09^10^11^12^01^02^03","^",$E(REVDATE,4,5))
"RTN","RCXFMSSV",101,0)
 ;
"RTN","RCXFMSSV",102,0)
 S SV2="SV2^"_$E(RCDATEND,2,3)_"^"_$E(RCDATEND,4,5)_"^"_$E(RCDATEND,6,7)
"RTN","RCXFMSSV",103,0)
 S $P(SV2,"^",5)=MONTH         ;accounting period month
"RTN","RCXFMSSV",104,0)
 S $P(SV2,"^",6)=FY            ;accounting period year
"RTN","RCXFMSSV",105,0)
 S $P(SV2,"^",7)="E"
"RTN","RCXFMSSV",106,0)
 S $P(SV2,"^",12)=REVFY        ;reversal period year
"RTN","RCXFMSSV",107,0)
 S $P(SV2,"^",13)=REVMONTH     ;reversal period month
"RTN","RCXFMSSV",108,0)
 S $P(SV2,"^",16)=$J(DOCTOTAL,0,2)_"^~"
"RTN","RCXFMSSV",109,0)
 ;
"RTN","RCXFMSSV",110,0)
 ;  put together document in gcs
"RTN","RCXFMSSV",111,0)
 N %DT,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCXFMSSV",112,0)
 S Y=$E(RCDATEND,1,5)_"00" D DD^%DT
"RTN","RCXFMSSV",113,0)
 S DESCRIP="Monthly Standard Voucher for "_Y
"RTN","RCXFMSSV",114,0)
 I 'RCGECSDA D CONTROL^GECSUFMS("A",$E(RCTRANID,1,3),RCTRANID,"SV",10,0,"",DESCRIP)
"RTN","RCXFMSSV",115,0)
 I RCGECSDA D REBUILD^GECSUFM1(RCGECSDA,"A",10,"","Rebuild "_DESCRIP) S GECSFMS("DA")=RCGECSDA
"RTN","RCXFMSSV",116,0)
 ;
"RTN","RCXFMSSV",117,0)
 ;  store document in gcs
"RTN","RCXFMSSV",118,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),SV2)
"RTN","RCXFMSSV",119,0)
 F COUNT=1:1 Q:'$D(FMSLINE(COUNT))  D SETCS^GECSSTAA(GECSFMS("DA"),FMSLINE(COUNT))
"RTN","RCXFMSSV",120,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","RCXFMSSV",121,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","RCXFMSSV",122,0)
 ;  set the key for lookup
"RTN","RCXFMSSV",123,0)
 D SETKEY^GECSSTAA(GECSFMS("DA"),"SV-"_$E(RCDATEND,1,5)_"00")
"RTN","RCXFMSSV",124,0)
 ;
"RTN","RCXFMSSV",125,0)
 ;  return 1 for success ^ fms document transaction number
"RTN","RCXFMSSV",126,0)
 Q "1^SV-"_$P(GECSFMS("CTL"),"^",9)
"RTN","RCXFMSSV",127,0)
 ;
"RTN","RCXFMSSV",128,0)
 ;
"RTN","RCXFMSSV",129,0)
BADDEBT ;  top entry point to generate a sv code sheet
"RTN","RCXFMSSV",130,0)
 ;  for the bad debt report, transaction types 23, 27 and 2B.
"RTN","RCXFMSSV",131,0)
 ;  The fms document number in file 347 is SV-$e(dateend,1,5)_"01"
"RTN","RCXFMSSV",132,0)
 ;
"RTN","RCXFMSSV",133,0)
 N DATA1319,DATA1338,DATA1339,DATA4032,DATAHSIF,GECSDATA,RCRJDATE,RESULT,RCRJFMM,RCRJFXSV,RCTRANID,X
"RTN","RCXFMSSV",134,0)
 ;
"RTN","RCXFMSSV",135,0)
 ;  lock cannot fail
"RTN","RCXFMSSV",136,0)
 L +^RC(348.1)
"RTN","RCXFMSSV",137,0)
 ;
"RTN","RCXFMSSV",138,0)
 ;  get the data from the bad debt allowance file 348.1
"RTN","RCXFMSSV",139,0)
 K ^TMP($J,"RCRJRCOLSV")
"RTN","RCXFMSSV",140,0)
 S DATA1319=$G(^RC(348.1,+$O(^RC(348.1,"B",1319,0)),0))
"RTN","RCXFMSSV",141,0)
 S DATA1338=$G(^RC(348.1,+$O(^RC(348.1,"B",1338,0)),0))
"RTN","RCXFMSSV",142,0)
 S DATA1339=$G(^RC(348.1,+$O(^RC(348.1,"B",1339,0)),0))
"RTN","RCXFMSSV",143,0)
 S DATAHSIF=$G(^RC(348.1,+$O(^RC(348.1,"B",1319.1,0)),0))
"RTN","RCXFMSSV",144,0)
 S DATA4032=$G(^RC(348.1,+$O(^RC(348.1,"B",1319.2,0)),0))
"RTN","RCXFMSSV",145,0)
 ;       the revenue source code  v is a 0
"RTN","RCXFMSSV",146,0)
 S ^TMP($J,"RCRJRCOLSV","23",5287,0)=$P(DATA1319,"^",8)+$P(DATA1319,"^",9)
"RTN","RCXFMSSV",147,0)
 S ^TMP($J,"RCRJRCOLSV","23",5358.1,0)=$P(DATAHSIF,"^",8)+$P(DATAHSIF,"^",9)
"RTN","RCXFMSSV",148,0)
 S ^TMP($J,"RCRJRCOLSV","23",4032,0)=$P(DATA4032,"^",8)+$P(DATA4032,"^",9)
"RTN","RCXFMSSV",149,0)
 S ^TMP($J,"RCRJRCOLSV","2B",5287,0)=$P(DATA1338,"^",8)+$P(DATA1338,"^",9)
"RTN","RCXFMSSV",150,0)
 S ^TMP($J,"RCRJRCOLSV","27",5287,0)=$P(DATA1339,"^",8)+$P(DATA1339,"^",9)
"RTN","RCXFMSSV",151,0)
 ;
"RTN","RCXFMSSV",152,0)
 ;  the date is for previous month
"RTN","RCXFMSSV",153,0)
 ;S RCRJDATE=$$PREVMONT^RCRJRBD(DT)
"RTN","RCXFMSSV",154,0)
 I $E(DT,6,7)<$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$$PREVMONT^RCRJRBD(DT)
"RTN","RCXFMSSV",155,0)
 ;I $E(DT,6,7)>$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$E($$LDATE^RCRJR(DT),1,5)_"00"
"RTN","RCXFMSSV",156,0)
 I $E(DT,6,7)>$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$$LDATE^RCRJR(DT)
"RTN","RCXFMSSV",157,0)
 ;  find the last day of the month for the end date
"RTN","RCXFMSSV",158,0)
 ;S RCRJDATE=$E(RCRJDATE,1,5)_$P("31^28^31^30^31^30^31^31^30^31^30^31","^",+$E(RCRJDATE,4,5))
"RTN","RCXFMSSV",159,0)
 ;I $E(RCRJDATE,6,7)=28,$E(RCRJDATE,2,3)#4=0 S RCRJDATE=$E(RCRJDATE,1,5)_"29"
"RTN","RCXFMSSV",160,0)
 ;
"RTN","RCXFMSSV",161,0)
 ;  lookup fms document number to see if the monthly sv has been sent
"RTN","RCXFMSSV",162,0)
 ;  example rcdatend=3010531, lookup on 3010501
"RTN","RCXFMSSV",163,0)
 D KEYLOOK^GECSSGET("SV-"_$E(RCRJDATE,1,5)_"01",1)
"RTN","RCXFMSSV",164,0)
 ;
"RTN","RCXFMSSV",165,0)
 ;  get the transacion id for the fms document
"RTN","RCXFMSSV",166,0)
 ;  if it is not sent, get the next number available
"RTN","RCXFMSSV",167,0)
 I $G(GECSDATA) S RCTRANID=$E($P(GECSDATA("2100.1",GECSDATA,".01","E"),"-",2),1,11)
"RTN","RCXFMSSV",168,0)
 I $G(RCTRANID)="" S RCTRANID=$$ENUM^RCMSNUM
"RTN","RCXFMSSV",169,0)
 I RCTRANID<0 Q  ;unable to retrieve the next number
"RTN","RCXFMSSV",170,0)
 ;  remove dash (example 460-K1A05HY)
"RTN","RCXFMSSV",171,0)
 S RCTRANID=$TR(RCTRANID,"-")
"RTN","RCXFMSSV",172,0)
 ;
"RTN","RCXFMSSV",173,0)
 ;  build and send the sv document to fms
"RTN","RCXFMSSV",174,0)
 S RESULT=$$BUILDSV(RCRJDATE,+$G(GECSDATA),RCTRANID)
"RTN","RCXFMSSV",175,0)
 K ^TMP($J,"RCRJRCOLSV")
"RTN","RCXFMSSV",176,0)
 ;  error in building code sheet
"RTN","RCXFMSSV",177,0)
 I 'RESULT D Q Q
"RTN","RCXFMSSV",178,0)
 ;
"RTN","RCXFMSSV",179,0)
 ;  add/update entry in file 347 for reports
"RTN","RCXFMSSV",180,0)
 N %DT,%X,D,D0,DA347,DI,DQ,DIC,ERROR
"RTN","RCXFMSSV",181,0)
 S DA347=$O(^RC(347,"D","SV-"_$E(RCRJDATE,1,5)_"01",0))
"RTN","RCXFMSSV",182,0)
 ;  if not in the file, addit   fmsdocid   sv   id
"RTN","RCXFMSSV",183,0)
 I 'DA347 D OPEN^RCFMDRV1($P(RESULT,"^",2),4,"SV-"_$E(RCRJDATE,1,5)_"01",.DA347,.ERROR)
"RTN","RCXFMSSV",184,0)
 I DA347 D SSTAT^RCFMFN02($P(RESULT,"^",2),1)
"RTN","RCXFMSSV",185,0)
 ;
"RTN","RCXFMSSV",186,0)
Q ;  jump here to finish
"RTN","RCXFMSSV",187,0)
 ;  generate bad debt report
"RTN","RCXFMSSV",188,0)
 S RCRJFXSV=$P(RESULT,"^",2),RCRJFMM=1 D DQ^RCRJRBDR
"RTN","RCXFMSSV",189,0)
 L -^RC(348.1)
"RTN","RCXFMSSV",190,0)
 Q
"RTN","RCXFMSTX")
0^11^B24394296
"RTN","RCXFMSTX",1,0)
RCXFMSTX ;WISC/RFJ-fms transfer (tr) code sheet generator ;1 Oct 97
"RTN","RCXFMSTX",2,0)
 ;;4.5;Accounts Receivable;**170,178,191**;Mar 20, 1995
"RTN","RCXFMSTX",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSTX",4,0)
 Q
"RTN","RCXFMSTX",5,0)
 ;
"RTN","RCXFMSTX",6,0)
 ;
"RTN","RCXFMSTX",7,0)
STARTTR(RCDATEND) ;  top entry point to generate a tr code sheet
"RTN","RCXFMSTX",8,0)
 ;  transferring dollars from mccf to hsif
"RTN","RCXFMSTX",9,0)
 ;
"RTN","RCXFMSTX",10,0)
 ;  rcdatend is the ending date of the period.
"RTN","RCXFMSTX",11,0)
 ;  This date is the 3rd work day from the end of the month.
"RTN","RCXFMSTX",12,0)
 ;  The utility $$LDATE^RCRJR is used to figure it out. It will
"RTN","RCXFMSTX",13,0)
 ;  change from month to month and figures in holidays also.
"RTN","RCXFMSTX",14,0)
 ;  For example,  if running the ARDC for the month of June 2003
"RTN","RCXFMSTX",15,0)
 ;  the EOAM will calculate out to be June 25, 2003.
"RTN","RCXFMSTX",16,0)
 ;  This is called by the background monthly data collector
"RTN","RCXFMSTX",17,0)
 ;
"RTN","RCXFMSTX",18,0)
 ;
"RTN","RCXFMSTX",19,0)
 N GECSDATA,RCTRANID,RESULT
"RTN","RCXFMSTX",20,0)
 ;
"RTN","RCXFMSTX",21,0)
 ;  build the data for the TR document.  this call returns the rctrans
"RTN","RCXFMSTX",22,0)
 ;  array in the format rctrans(fromfund,fromrsc) = tofund ^ torsc ^
"RTN","RCXFMSTX",23,0)
 ;  amount
"RTN","RCXFMSTX",24,0)
 ;    example:
"RTN","RCXFMSTX",25,0)
 ;      rctrans(5287,"8bzz")="5358.1^8gzz^123.45"
"RTN","RCXFMSTX",26,0)
 ;      will transfer 123.45 from 5287 to 5358.1
"RTN","RCXFMSTX",27,0)
 D GETPAY^RCBMILLT(RCDATEND)
"RTN","RCXFMSTX",28,0)
 ;
"RTN","RCXFMSTX",29,0)
 ;  no code sheets to send
"RTN","RCXFMSTX",30,0)
 I $O(RCTRANS(""))="" Q
"RTN","RCXFMSTX",31,0)
 ;
"RTN","RCXFMSTX",32,0)
 ;  lookup fms document number to see if the monthly tr has been sent
"RTN","RCXFMSTX",33,0)
 ;  example rcdatend=3010531, lookup on 3010500
"RTN","RCXFMSTX",34,0)
 D KEYLOOK^GECSSGET("TR-"_$E(RCDATEND,1,5)_"00",1)
"RTN","RCXFMSTX",35,0)
 ;
"RTN","RCXFMSTX",36,0)
 ;  get the transacion id for the fms document
"RTN","RCXFMSTX",37,0)
 ;  if it is not sent, get the next number available
"RTN","RCXFMSTX",38,0)
 I $G(GECSDATA) S RCTRANID=$E($P(GECSDATA("2100.1",GECSDATA,".01","E"),"-",2),1,11)
"RTN","RCXFMSTX",39,0)
 I $G(RCTRANID)="" S RCTRANID=$$ENUM^RCMSNUM
"RTN","RCXFMSTX",40,0)
 I RCTRANID<0 Q  ;unable to retrieve the next number
"RTN","RCXFMSTX",41,0)
 ;  remove dash (example 460-K1A05HY)
"RTN","RCXFMSTX",42,0)
 S RCTRANID=$TR(RCTRANID,"-")
"RTN","RCXFMSTX",43,0)
 ;
"RTN","RCXFMSTX",44,0)
 ;  build the tr document
"RTN","RCXFMSTX",45,0)
 S RESULT=$$BUILDTR(RCDATEND,.RCTRANS,+$G(GECSDATA),RCTRANID)
"RTN","RCXFMSTX",46,0)
 ;  error in building code sheet
"RTN","RCXFMSTX",47,0)
 I 'RESULT Q
"RTN","RCXFMSTX",48,0)
 ;
"RTN","RCXFMSTX",49,0)
 ;  set the 433 fields showing the dollars were transferred
"RTN","RCXFMSTX",50,0)
 D SETPAY^RCBMILLT(RCDATEND)
"RTN","RCXFMSTX",51,0)
 ;
"RTN","RCXFMSTX",52,0)
 ;  add/update entry in file 347 for reports
"RTN","RCXFMSTX",53,0)
 N %DT,%X,D,D0,DA347,DI,DQ,DIC,ERROR
"RTN","RCXFMSTX",54,0)
 S DA347=$O(^RC(347,"C",$P(RESULT,"^",2),0))
"RTN","RCXFMSTX",55,0)
 ;  if not in the file, addit   fmsdocid   sv   id
"RTN","RCXFMSTX",56,0)
 I 'DA347 D OPEN^RCFMDRV1($P(RESULT,"^",2),4,"TR-"_$E(RCDATEND,1,5)_"00",.DA347,.ERROR)
"RTN","RCXFMSTX",57,0)
 I DA347 D SSTAT^RCFMFN02($P(RESULT,"^",2),1)
"RTN","RCXFMSTX",58,0)
 Q
"RTN","RCXFMSTX",59,0)
 ;
"RTN","RCXFMSTX",60,0)
 ;        
"RTN","RCXFMSTX",61,0)
BUILDTR(RCDATEND,RCTRANS,RCGECSDA,RCTRANID) ;  generate a tr code sheet for
"RTN","RCXFMSTX",62,0)
 ;  transferring dollars from mccf to hsif
"RTN","RCXFMSTX",63,0)
 ;
"RTN","RCXFMSTX",64,0)
 ;  rcdatend is the last day of the month for the data
"RTN","RCXFMSTX",65,0)
 ;
"RTN","RCXFMSTX",66,0)
 ;  rctrans(fund,rsc) = data array passed
"RTN","RCXFMSTX",67,0)
 ;    fund=fund to transfer from
"RTN","RCXFMSTX",68,0)
 ;    rsc = rsc to transfer from
"RTN","RCXFMSTX",69,0)
 ;    data = fund to transfer to (piece 1)
"RTN","RCXFMSTX",70,0)
 ;           rsc  to transfer to (piece 2)
"RTN","RCXFMSTX",71,0)
 ;           dollars to transfer (piece 3)
"RTN","RCXFMSTX",72,0)
 ;
"RTN","RCXFMSTX",73,0)
 ;  rcgecsda is the ien for the gcs stack file 2100.1 for rebuilds
"RTN","RCXFMSTX",74,0)
 ;
"RTN","RCXFMSTX",75,0)
 ;  rctranid is the document identifier
"RTN","RCXFMSTX",76,0)
 ;
"RTN","RCXFMSTX",77,0)
 N COUNT,DATA,DESCRIP,FISCALYR,FUND,GECSFMS,LINE,REVSRCE,TR2,X,Y
"RTN","RCXFMSTX",78,0)
 ;
"RTN","RCXFMSTX",79,0)
 S FISCALYR=$$FY^RCFN01(RCDATEND)
"RTN","RCXFMSTX",80,0)
 ;
"RTN","RCXFMSTX",81,0)
 ;  build detail line
"RTN","RCXFMSTX",82,0)
 S COUNT=0
"RTN","RCXFMSTX",83,0)
 S FUND="" F  S FUND=$O(RCTRANS(FUND)) Q:FUND=""  D
"RTN","RCXFMSTX",84,0)
 .   S REVSRCE="" F  S REVSRCE=$O(RCTRANS(FUND,REVSRCE)) Q:'REVSRCE  D
"RTN","RCXFMSTX",85,0)
 .   .   S DATA=RCTRANS(FUND,REVSRCE)
"RTN","RCXFMSTX",86,0)
 .   .   ;  if no value, quit
"RTN","RCXFMSTX",87,0)
 .   .   I '$P(DATA,"^",3) Q
"RTN","RCXFMSTX",88,0)
 .   .   ;
"RTN","RCXFMSTX",89,0)
 .   .   ;  create line to transfer from (decrease)
"RTN","RCXFMSTX",90,0)
 .   .   S COUNT=COUNT+1
"RTN","RCXFMSTX",91,0)
 .   .   S LINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSTX",92,0)
 .   .   S $P(LINE(COUNT),"^",4)=FISCALYR
"RTN","RCXFMSTX",93,0)
 .   .   S $P(LINE(COUNT),"^",6)=FUND
"RTN","RCXFMSTX",94,0)
 .   .   S $P(LINE(COUNT),"^",7)=$E(RCTRANID,1,3) ; station #
"RTN","RCXFMSTX",95,0)
 .   .   S $P(LINE(COUNT),"^",10)=REVSRCE
"RTN","RCXFMSTX",96,0)
 .   .   ;
"RTN","RCXFMSTX",97,0)
 .   .   ;  vendor id
"RTN","RCXFMSTX",98,0)
 .   .   S $P(LINE(COUNT),"^",18)="MCCFVALUE"
"RTN","RCXFMSTX",99,0)
 .   .   I FUND=5358.1 S $P(LINE(COUNT),"^",18)="HSIFVALUE"
"RTN","RCXFMSTX",100,0)
 .   .   ;
"RTN","RCXFMSTX",101,0)
 .   .   S $P(LINE(COUNT),"^",20)=$J($P(DATA,"^",3),0,2)
"RTN","RCXFMSTX",102,0)
 .   .   S $P(LINE(COUNT),"^",21)="D"
"RTN","RCXFMSTX",103,0)
 .   .   S $P(LINE(COUNT),"^",23)=33
"RTN","RCXFMSTX",104,0)
 .   .   S $P(LINE(COUNT),"^",24)="~"
"RTN","RCXFMSTX",105,0)
 .   .   ;
"RTN","RCXFMSTX",106,0)
 .   .   ;  create line to transfer to (increase)
"RTN","RCXFMSTX",107,0)
 .   .   S COUNT=COUNT+1
"RTN","RCXFMSTX",108,0)
 .   .   S LINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSTX",109,0)
 .   .   S $P(LINE(COUNT),"^",4)=FISCALYR
"RTN","RCXFMSTX",110,0)
 .   .   S $P(LINE(COUNT),"^",6)=$P(DATA,"^")
"RTN","RCXFMSTX",111,0)
 .   .   S $P(LINE(COUNT),"^",7)=$E(RCTRANID,1,3) ; station #
"RTN","RCXFMSTX",112,0)
 .   .   S $P(LINE(COUNT),"^",10)=$P(DATA,"^",2)
"RTN","RCXFMSTX",113,0)
 .   .   ;
"RTN","RCXFMSTX",114,0)
 .   .   ;  vendor id
"RTN","RCXFMSTX",115,0)
 .   .   S $P(LINE(COUNT),"^",18)="MCCFVALUE"
"RTN","RCXFMSTX",116,0)
 .   .   I $P(DATA,"^")=5358.1 S $P(LINE(COUNT),"^",18)="HSIFVALUE"
"RTN","RCXFMSTX",117,0)
 .   .   ;
"RTN","RCXFMSTX",118,0)
 .   .   S $P(LINE(COUNT),"^",20)=$J($P(DATA,"^",3),0,2)
"RTN","RCXFMSTX",119,0)
 .   .   S $P(LINE(COUNT),"^",21)="I"
"RTN","RCXFMSTX",120,0)
 .   .   S $P(LINE(COUNT),"^",23)=33
"RTN","RCXFMSTX",121,0)
 .   .   S $P(LINE(COUNT),"^",24)="~"
"RTN","RCXFMSTX",122,0)
 ;
"RTN","RCXFMSTX",123,0)
 ;  build tr2
"RTN","RCXFMSTX",124,0)
 S TR2="CR2^"_$E(RCDATEND,2,3)_"^"_$E(RCDATEND,4,5)_"^"_$E(RCDATEND,6,7)_"^^^^^^E^^^"
"RTN","RCXFMSTX",125,0)
 ;  deposit number which is equal to the gcs id
"RTN","RCXFMSTX",126,0)
 ;  $j(0,0,2) is the document total which is zero
"RTN","RCXFMSTX",127,0)
 S TR2=TR2_$P(RCTRANID,"^")_"^^"_$J(0,0,2)_"^^"
"RTN","RCXFMSTX",128,0)
 ;  deposit/transfer date which is end date of prior month
"RTN","RCXFMSTX",129,0)
 S TR2=TR2_$E(RCDATEND,2,3)_"^"_$E(RCDATEND,4,5)_"^"_$E(RCDATEND,6,7)_"^~"
"RTN","RCXFMSTX",130,0)
 ;
"RTN","RCXFMSTX",131,0)
 ;  put together document in gcs
"RTN","RCXFMSTX",132,0)
 N %DT,D,D0,DA,DI,DIC,DIE,DIQ2,DQ,DR
"RTN","RCXFMSTX",133,0)
 S Y=$E(RCDATEND,1,5)_"00" D DD^%DT
"RTN","RCXFMSTX",134,0)
 S DESCRIP="Monthly Transfer MCCF to HSIF for "_Y
"RTN","RCXFMSTX",135,0)
 I 'RCGECSDA D CONTROL^GECSUFMS("A",$E(RCTRANID,1,3),RCTRANID,"TR",10,0,"",DESCRIP)
"RTN","RCXFMSTX",136,0)
 I RCGECSDA D REBUILD^GECSUFM1(RCGECSDA,"A",10,"N","Rebuild "_DESCRIP) S GECSFMS("DA")=RCGECSDA
"RTN","RCXFMSTX",137,0)
 ;
"RTN","RCXFMSTX",138,0)
 ;  store document in gcs
"RTN","RCXFMSTX",139,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),TR2)
"RTN","RCXFMSTX",140,0)
 F COUNT=1:1 Q:'$D(LINE(COUNT))  D SETCS^GECSSTAA(GECSFMS("DA"),LINE(COUNT))
"RTN","RCXFMSTX",141,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","RCXFMSTX",142,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","RCXFMSTX",143,0)
 ;  set the key for lookup
"RTN","RCXFMSTX",144,0)
 D SETKEY^GECSSTAA(GECSFMS("DA"),"TR-"_$E(RCDATEND,1,5)_"00")
"RTN","RCXFMSTX",145,0)
 ;
"RTN","RCXFMSTX",146,0)
 ;  return 1 for success ^ fms document id
"RTN","RCXFMSTX",147,0)
 Q 1_"^TR-"_$P(GECSFMS("CTL"),"^",9)
"RTN","RCXFMSWR")
0^10^B16841638
"RTN","RCXFMSWR",1,0)
RCXFMSWR ;WISC/RFJ-fms writeoff (wr) code sheet generator ;1 Nov 97
"RTN","RCXFMSWR",2,0)
 ;;4.5;Accounts Receivable;**96,135,98,156,170,191**;Mar 20, 1995
"RTN","RCXFMSWR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSWR",4,0)
 Q
"RTN","RCXFMSWR",5,0)
 ;
"RTN","RCXFMSWR",6,0)
 ;
"RTN","RCXFMSWR",7,0)
STARTWR(RCDATEND) ;  top entry point to generate a wr code sheet
"RTN","RCXFMSWR",8,0)
 ;
"RTN","RCXFMSWR",9,0)
 ;  rcdatend is the ending date of the period.
"RTN","RCXFMSWR",10,0)
 ;  This date is the 3rd work day from the end of the month.
"RTN","RCXFMSWR",11,0)
 ;  The utility $$LDATE^RCRJR is used to figure it out. It will
"RTN","RCXFMSWR",12,0)
 ;  change from month to month and figures in holidays also.
"RTN","RCXFMSWR",13,0)
 ;  For example,  if running the ARDC for the month of June 2003
"RTN","RCXFMSWR",14,0)
 ;  the EOAM will calculate out to be June 25, 2003.
"RTN","RCXFMSWR",15,0)
 ;  This is called by the background monthly data collector
"RTN","RCXFMSWR",16,0)
 ;
"RTN","RCXFMSWR",17,0)
 ;  data stored in tmp($j,rcrjrcolwr,type,revsourcecode)
"RTN","RCXFMSWR",18,0)
 ;  this is called by the background monthly data collector
"RTN","RCXFMSWR",19,0)
 ;
"RTN","RCXFMSWR",20,0)
 N GECSDATA,RCTRANID,RESULT
"RTN","RCXFMSWR",21,0)
 ;  lookup fms document number to see if the monthly sv has been sent
"RTN","RCXFMSWR",22,0)
 ;  example rcdatend=3010531, lookup on 3010500
"RTN","RCXFMSWR",23,0)
 D KEYLOOK^GECSSGET("WR-"_$E(RCDATEND,1,5)_"00",1)
"RTN","RCXFMSWR",24,0)
 ;
"RTN","RCXFMSWR",25,0)
 ;  get the transacion id for the fms document
"RTN","RCXFMSWR",26,0)
 ;  if it is not sent, get the next number available
"RTN","RCXFMSWR",27,0)
 I $G(GECSDATA) S RCTRANID=$E($P(GECSDATA("2100.1",GECSDATA,".01","E"),"-",2),1,11)
"RTN","RCXFMSWR",28,0)
 I $G(RCTRANID)="" S RCTRANID=$$ENUM^RCMSNUM
"RTN","RCXFMSWR",29,0)
 I RCTRANID<0 Q  ;unable to retrieve the next number
"RTN","RCXFMSWR",30,0)
 ;  remove dash (example 460-K1A05HY)
"RTN","RCXFMSWR",31,0)
 S RCTRANID=$TR(RCTRANID,"-")
"RTN","RCXFMSWR",32,0)
 ;
"RTN","RCXFMSWR",33,0)
 ;  build and send the sv document to fms
"RTN","RCXFMSWR",34,0)
 S RESULT=$$BUILDWR(RCDATEND,+$G(GECSDATA),RCTRANID)
"RTN","RCXFMSWR",35,0)
 ;  error in building code sheet
"RTN","RCXFMSWR",36,0)
 I 'RESULT Q
"RTN","RCXFMSWR",37,0)
 ;
"RTN","RCXFMSWR",38,0)
 ;  add/update entry in file 347 for reports
"RTN","RCXFMSWR",39,0)
 N %DT,%X,D,D0,DA347,DI,DQ,DIC,ERROR
"RTN","RCXFMSWR",40,0)
 S DA347=$O(^RC(347,"D","WR-"_$E(RCDATEND,1,5)_"00",0))
"RTN","RCXFMSWR",41,0)
 ;  if not in the file, addit   fmsdocid   wr   id
"RTN","RCXFMSWR",42,0)
 I 'DA347 D OPEN^RCFMDRV1($P(RESULT,"^",2),8,"WR-"_$E(RCDATEND,1,5)_"00",.DA347,.ERROR)
"RTN","RCXFMSWR",43,0)
 I DA347 D SSTAT^RCFMFN02($P(RESULT,"^",2),1)
"RTN","RCXFMSWR",44,0)
 Q
"RTN","RCXFMSWR",45,0)
 ;
"RTN","RCXFMSWR",46,0)
 ;
"RTN","RCXFMSWR",47,0)
BUILDWR(RCDATEND,RCGECSDA,RCTRANID) ;  generate a wr code sheet for monthly data
"RTN","RCXFMSWR",48,0)
 ;  rcgecsda is the ien for the gcs stack file 2100.1 for rebuilds
"RTN","RCXFMSWR",49,0)
 ;  data stored in tmp($j,rcrjrcolwr)
"RTN","RCXFMSWR",50,0)
 ;
"RTN","RCXFMSWR",51,0)
 N AMOUNT,COUNT,CR2,DESCRIP,DOCTOTAL,FISCALYR,FMSLINE,FUND,GECSFMS,RSC,TYPE
"RTN","RCXFMSWR",52,0)
 ;
"RTN","RCXFMSWR",53,0)
 S FISCALYR=$$FY^RCFN01(RCDATEND)
"RTN","RCXFMSWR",54,0)
 ;
"RTN","RCXFMSWR",55,0)
 S COUNT=0,DOCTOTAL=0
"RTN","RCXFMSWR",56,0)
 S TYPE="" F  S TYPE=$O(^TMP($J,"RCRJRCOLWR",TYPE)) Q:TYPE=""  D
"RTN","RCXFMSWR",57,0)
 .   S FUND="" F  S FUND=$O(^TMP($J,"RCRJRCOLWR",TYPE,FUND)) Q:FUND=""  D
"RTN","RCXFMSWR",58,0)
 .   .   S RSC="" F  S RSC=$O(^TMP($J,"RCRJRCOLWR",TYPE,FUND,RSC)) Q:RSC=""  D
"RTN","RCXFMSWR",59,0)
 .   .   .   S AMOUNT=^TMP($J,"RCRJRCOLWR",TYPE,FUND,RSC),DOCTOTAL=DOCTOTAL+AMOUNT
"RTN","RCXFMSWR",60,0)
 .   .   .   I AMOUNT=0 Q
"RTN","RCXFMSWR",61,0)
 .   .   .   S COUNT=COUNT+1
"RTN","RCXFMSWR",62,0)
 .   .   .   S FMSLINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSWR",63,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",4)=FISCALYR          ;begin fy
"RTN","RCXFMSWR",64,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",6)=FUND
"RTN","RCXFMSWR",65,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",7)=$E(RCTRANID,1,3)  ;site number
"RTN","RCXFMSWR",66,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",10)=RSC
"RTN","RCXFMSWR",67,0)
 .   .   .   ;
"RTN","RCXFMSWR",68,0)
 .   .   .   ;  vendor id
"RTN","RCXFMSWR",69,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",18)="MCCFVALUE"
"RTN","RCXFMSWR",70,0)
 .   .   .   I FUND=4032 S $P(FMSLINE(COUNT),"^",18)="EXCFVALUE"
"RTN","RCXFMSWR",71,0)
 .   .   .   ;  for transaction type P4, send vendorid of PERSONOTH
"RTN","RCXFMSWR",72,0)
 .   .   .   I TYPE="P4" S $P(FMSLINE(COUNT),"^",18)="PERSONOTH"
"RTN","RCXFMSWR",73,0)
 .   .   .   ;
"RTN","RCXFMSWR",74,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",20)=$J(AMOUNT,0,2)
"RTN","RCXFMSWR",75,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",21)="I"
"RTN","RCXFMSWR",76,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",23)=TYPE_"^~"
"RTN","RCXFMSWR",77,0)
 ;
"RTN","RCXFMSWR",78,0)
 ;  no code sheets to send
"RTN","RCXFMSWR",79,0)
 I COUNT=0 Q "0^No wr code sheets to send for this month"
"RTN","RCXFMSWR",80,0)
 ;
"RTN","RCXFMSWR",81,0)
 S CR2="CR2^"_$E(RCDATEND,2,3)_"^"_$E(RCDATEND,4,5)_"^"_$E(RCDATEND,6,7)
"RTN","RCXFMSWR",82,0)
 S $P(CR2,"^",10)="E"
"RTN","RCXFMSWR",83,0)
 S $P(CR2,"^",13)=999999999999
"RTN","RCXFMSWR",84,0)
 S $P(CR2,"^",15)=$J(DOCTOTAL,0,2)
"RTN","RCXFMSWR",85,0)
 S $P(CR2,"^",17)=$E(RCDATEND,2,3)
"RTN","RCXFMSWR",86,0)
 S $P(CR2,"^",18)=$E(RCDATEND,4,5)
"RTN","RCXFMSWR",87,0)
 S $P(CR2,"^",19)=$E(RCDATEND,6,7)_"^~"
"RTN","RCXFMSWR",88,0)
 ;
"RTN","RCXFMSWR",89,0)
 ;  put together document in gcs
"RTN","RCXFMSWR",90,0)
 N %DT,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCXFMSWR",91,0)
 S Y=$E(RCDATEND,1,5)_"00" D DD^%DT
"RTN","RCXFMSWR",92,0)
 S DESCRIP="Monthly Write Off for "_Y
"RTN","RCXFMSWR",93,0)
 I 'RCGECSDA D CONTROL^GECSUFMS("A",$E(RCTRANID,1,3),RCTRANID,"WR",10,0,"",DESCRIP)
"RTN","RCXFMSWR",94,0)
 I RCGECSDA D REBUILD^GECSUFM1(RCGECSDA,"A",10,"N","Rebuild "_DESCRIP) S GECSFMS("DA")=RCGECSDA
"RTN","RCXFMSWR",95,0)
 ;
"RTN","RCXFMSWR",96,0)
 ;  store document in gcs
"RTN","RCXFMSWR",97,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),CR2)
"RTN","RCXFMSWR",98,0)
 F COUNT=1:1 Q:'$D(FMSLINE(COUNT))  D SETCS^GECSSTAA(GECSFMS("DA"),FMSLINE(COUNT))
"RTN","RCXFMSWR",99,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","RCXFMSWR",100,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","RCXFMSWR",101,0)
 ;  set the key for lookup
"RTN","RCXFMSWR",102,0)
 D SETKEY^GECSSTAA(GECSFMS("DA"),"WR-"_$E(RCDATEND,1,5)_"00")
"RTN","RCXFMSWR",103,0)
 ;
"RTN","RCXFMSWR",104,0)
 ;  return 1 for success ^ fms document transaction number
"RTN","RCXFMSWR",105,0)
 Q "1^WR-"_$P(GECSFMS("CTL"),"^",9)
"VER")
8.0^22
**END**
**END**
