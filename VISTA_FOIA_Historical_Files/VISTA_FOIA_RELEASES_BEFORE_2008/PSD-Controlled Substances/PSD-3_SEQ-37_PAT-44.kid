Released PSD*3*44 SEQ #37
Extracted from mail message
**KIDS**:PSD*3.0*44^

**INSTALL NAME**
PSD*3.0*44
"BLD",4998,0)
PSD*3.0*44^CONTROLLED SUBSTANCES^0^3031112^y
"BLD",4998,1,0)
^^1^1^3031112^
"BLD",4998,1,1,0)
MODIFICATION OF 'DR' STRING IN ROUTINE PSDSTK FOR LIQUID USEAGE.
"BLD",4998,4,0)
^9.64PA^^
"BLD",4998,"ABPKG")
n
"BLD",4998,"KRN",0)
^9.67PA^8989.52^19
"BLD",4998,"KRN",.4,0)
.4
"BLD",4998,"KRN",.401,0)
.401
"BLD",4998,"KRN",.402,0)
.402
"BLD",4998,"KRN",.403,0)
.403
"BLD",4998,"KRN",.5,0)
.5
"BLD",4998,"KRN",.84,0)
.84
"BLD",4998,"KRN",3.6,0)
3.6
"BLD",4998,"KRN",3.8,0)
3.8
"BLD",4998,"KRN",9.2,0)
9.2
"BLD",4998,"KRN",9.8,0)
9.8
"BLD",4998,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4998,"KRN",9.8,"NM",1,0)
PSDSTK^^0^B18480618
"BLD",4998,"KRN",9.8,"NM","B","PSDSTK",1)

"BLD",4998,"KRN",19,0)
19
"BLD",4998,"KRN",19.1,0)
19.1
"BLD",4998,"KRN",101,0)
101
"BLD",4998,"KRN",409.61,0)
409.61
"BLD",4998,"KRN",771,0)
771
"BLD",4998,"KRN",870,0)
870
"BLD",4998,"KRN",8989.51,0)
8989.51
"BLD",4998,"KRN",8989.52,0)
8989.52
"BLD",4998,"KRN",8994,0)
8994
"BLD",4998,"KRN","B",.4,.4)

"BLD",4998,"KRN","B",.401,.401)

"BLD",4998,"KRN","B",.402,.402)

"BLD",4998,"KRN","B",.403,.403)

"BLD",4998,"KRN","B",.5,.5)

"BLD",4998,"KRN","B",.84,.84)

"BLD",4998,"KRN","B",3.6,3.6)

"BLD",4998,"KRN","B",3.8,3.8)

"BLD",4998,"KRN","B",9.2,9.2)

"BLD",4998,"KRN","B",9.8,9.8)

"BLD",4998,"KRN","B",19,19)

"BLD",4998,"KRN","B",19.1,19.1)

"BLD",4998,"KRN","B",101,101)

"BLD",4998,"KRN","B",409.61,409.61)

"BLD",4998,"KRN","B",771,771)

"BLD",4998,"KRN","B",870,870)

"BLD",4998,"KRN","B",8989.51,8989.51)

"BLD",4998,"KRN","B",8989.52,8989.52)

"BLD",4998,"KRN","B",8994,8994)

"BLD",4998,"QUES",0)
^9.62^^
"BLD",4998,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",499,-1)
1^1
"PKG",499,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",499,20,0)
^9.402P^^
"PKG",499,22,0)
^9.49I^1^1
"PKG",499,22,1,0)
3.0^2970213^2981028^66481
"PKG",499,22,1,"PAH",1,0)
44^3031112
"PKG",499,22,1,"PAH",1,1,0)
^^1^1^3031112
"PKG",499,22,1,"PAH",1,1,1,0)
MODIFICATION OF 'DR' STRING IN ROUTINE PSDSTK FOR LIQUID USEAGE.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSDSTK")
0^1^B18480618
"RTN","PSDSTK",1,0)
PSDSTK ;BIR/JPW-Stock Drugs Enter/Edit ; 8 Aug 94
"RTN","PSDSTK",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;**44**;13 Feb 97
"RTN","PSDSTK",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDSTK",4,0)
STOCK ;entry for  NAOU stocked drugs into file 58.8
"RTN","PSDSTK",5,0)
 W ! K DIC,DA S DIC=58.8,DIC(0)="QEAZ",DIC("A")="Select NAOU: ",DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$P(^(0),""^"",2)'=""P""" D ^DIC K DIC G:Y<0 END
"RTN","PSDSTK",6,0)
 S PSDA=+Y,PSDS=+$P(Y(0),"^",4),TYPE=$P(Y(0),"^",2) D DRUG
"RTN","PSDSTK",7,0)
 G:('PSDOUT)!(FLAG1) STOCK
"RTN","PSDSTK",8,0)
END K ADD,DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,FLAG,FLAG1,NAOU,NEW,OK,PSDA,PSDR,PSDRN,PSDRG,PSDOUT,PSDS,TYPE,SITE,X,Y
"RTN","PSDSTK",9,0)
 Q
"RTN","PSDSTK",10,0)
DRUG ;add drugs
"RTN","PSDSTK",11,0)
 S (FLAG,FLAG1,PSDOUT)=0
"RTN","PSDSTK",12,0)
 W !! K DA,DIR,DIRUT S DIR(0)="SOA^A:ADD;E:EDIT",DIR("A")="Do you wish to ADD or EDIT stock drugs? "
"RTN","PSDSTK",13,0)
 S DIR("?",1)="Answer 'ADD' to add new CS stock drugs, or",DIR("?")="answer 'EDIT' to edit existing stock drugs, or '^' to quit."
"RTN","PSDSTK",14,0)
 S DIR("B")="ADD" D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDSTK",15,0)
 S ADD=Y
"RTN","PSDSTK",16,0)
 I TYPE'="M",ADD="A" D VAULT Q:(PSDOUT)!(FLAG1)  G:FLAG DRUG G DIE
"RTN","PSDSTK",17,0)
 W ! K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDA,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***"""
"RTN","PSDSTK",18,0)
 I TYPE="M",ADD="A",'$D(^PSD(58.8,PSDA,1,0)) S ^(0)="^58.8001IP^^"
"RTN","PSDSTK",19,0)
 S DA(1)=+PSDA,DIC(0)=$S(ADD="E":"QEAMZ",1:"QEAMLZ"),DIC="^PSD(58.8,"_PSDA_",1,",DLAYGO=58.8 D ^DIC K DIC,DLAYGO Q:Y<0  S PSDR=+Y
"RTN","PSDSTK",20,0)
DIE ;Modified DIE DR string;teh/OIFO Bay Pines
"RTN","PSDSTK",21,0)
 D CHKID I OK D
"RTN","PSDSTK",22,0)
 .K DA,DIE,DR S DIE="^PSD(58.8,"_PSDA_",1,",DA(1)=+PSDA,DA=+PSDR D
"RTN","PSDSTK",23,0)
 ..I $P(^PSD(58.8,PSDA,0),U,2)'="N" D
"RTN","PSDSTK",24,0)
 ...S DR=16,DR(2,58.800116)=.01 D ^DIE
"RTN","PSDSTK",25,0)
 ...S DR=15,DR(2,58.800115)=.01 D ^DIE
"RTN","PSDSTK",26,0)
 ...K DR S DR="2;4;5" D ^DIE
"RTN","PSDSTK",27,0)
 ..I $P(^PSD(58.8,PSDA,0),U,2)="N" D
"RTN","PSDSTK",28,0)
 ...S DR="9;7;8;26;28;29;8.5;10;11" D ^DIE
"RTN","PSDSTK",29,0)
 K DA,DIE,DR
"RTN","PSDSTK",30,0)
 G DRUG
"RTN","PSDSTK",31,0)
 ;
"RTN","PSDSTK",32,0)
CHKID ;check for current inactivation date
"RTN","PSDSTK",33,0)
 I $P($G(^PSD(58.8,PSDA,1,PSDR,0)),"^",14)="" D CHKNP Q
"RTN","PSDSTK",34,0)
 D CHKNP Q:'OK
"RTN","PSDSTK",35,0)
 W $C(7),!!,?5,"This Drug is currently defined for this NAOU with an INACTIVATION DATE.",!!,?5,"If you want to add this Drug as a new standard Stock Drug for this NAOU",!,?5,"you must delete the INACTIVATION DATE.",!
"RTN","PSDSTK",36,0)
 K DA,DIE,DR S OK=1,DA(1)=PSDA,DA=PSDR,DIE="^PSD(58.8,"_PSDA_",1,",DR="13" D ^DIE K DIE S:$P($G(^PSD(58.8,PSDA,1,PSDR,0)),"^",14)]"" OK=0 W !
"RTN","PSDSTK",37,0)
 Q
"RTN","PSDSTK",38,0)
CHKNP ;check for non-CS entries in file 50
"RTN","PSDSTK",39,0)
 S OK=$S($P($G(^PSDRUG(PSDR,2)),"^",3)["N":1,1:0) Q:OK
"RTN","PSDSTK",40,0)
 I $P($G(^PSD(58.8,PSDA,1,PSDR,0)),"^",14)="" K DA,DIE,DR S DA(1)=PSDA,DA=PSDR,DIE="^PSD(58.8,"_PSDA_",1,",DR="13///"_DT_";14////O;14.5////NON-CS DRUG" D ^DIE K DIE
"RTN","PSDSTK",41,0)
 W $C(7),!!,?5,"This stocked drug is currently defined for this NAOU but appears to be",!,?5,"a non-CS drug.  It has been inactivated as of " S Y=$P($G(^PSD(58.8,PSDA,1,PSDR,0)),"^",14) X ^DD("DD") W Y,!
"RTN","PSDSTK",42,0)
 Q
"RTN","PSDSTK",43,0)
VAULT ;check for stock drugs in vault
"RTN","PSDSTK",44,0)
 I '$O(^PSD(58.8,PSDS,1,0)) W !!,"There are no CS stocked drugs for your dispensing vault.",!! S PSDOUT=1 Q
"RTN","PSDSTK",45,0)
 W !!,"You may select only CS drugs stocked in your dispensing vault.",!!
"RTN","PSDSTK",46,0)
 W ! K DA,DIC S DIC("W")="W:$P(^PSDRUG(Y,0),""^"",9) ""   N/F"" I $P(^PSD(58.8,PSDS,1,Y,0),""^"",14)]"""",$P(^(0),""^"",14)'>DT W $C(7),""   *** INACTIVE ***"""
"RTN","PSDSTK",47,0)
 S DA(1)=+PSDS,DIC(0)="QEAM",DIC="^PSD(58.8,"_PSDS_",1," D ^DIC K DIC I Y<0 S FLAG1=1 Q
"RTN","PSDSTK",48,0)
 S PSDR=+Y I $D(^PSD(58.8,PSDA,1,PSDR,0)) Q
"RTN","PSDSTK",49,0)
 S PSDRN=$P($G(^PSDRUG(PSDR,0)),"^")
"RTN","PSDSTK",50,0)
 S:'$D(^PSD(58.8,PSDA,1,0)) ^(0)="^58.8001IP^^"
"RTN","PSDSTK",51,0)
 S NEW=+$P(^PSD(58.8,PSDA,1,0),"^",4)+1
"RTN","PSDSTK",52,0)
 K DA,DIR,DIRUT,Y S DIR(0)="YO",DIR("A")="ARE YOU ADDING '"_PSDRN_"' AS A NEW DRUG (FOR THIS DRUG ACCOUNTABILITY STATS)",DIR("B")="Y"
"RTN","PSDSTK",53,0)
 D ^DIR K DIR I $D(DIRUT) S PSDOUT=1 Q
"RTN","PSDSTK",54,0)
 I 'Y S FLAG=1 Q
"RTN","PSDSTK",55,0)
 K DA,DIC,DD,DO S DA(1)=PSDA,DIC(0)="L",(X,DINUM)=PSDR,DIC="^PSD(58.8,"_PSDA_",1," D FILE^DICN K DIC I Y<0 S PSDOUT=1 Q
"RTN","PSDSTK",56,0)
 Q
"VER")
8.0^22
**END**
**END**
