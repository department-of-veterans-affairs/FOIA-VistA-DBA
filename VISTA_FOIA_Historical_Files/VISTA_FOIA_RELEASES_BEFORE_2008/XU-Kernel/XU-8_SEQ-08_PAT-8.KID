Released XU*8*8 SEQ #8
Extracted from mail message
**KIDS**:XU*8.0*8^

**INSTALL NAME**
XU*8.0*8
"BLD",6,0)
XU*8.0*8^KERNEL^0^2951010^n
"BLD",6,1,0)
^^36^36^2951108^
"BLD",6,1,1,0)
Occasional errors have been reported in which an undefined error is
"BLD",6,1,2,0)
generated while recording an error and others in which an undefined error
"BLD",6,1,3,0)
is generated while using the error reporter.  These resulted from attempts
"BLD",6,1,4,0)
to obtain the value of an entry in the ^TMP global with a final subscripts
"BLD",6,1,5,0)
of  0,0).  Similar code in both situations were related to the errors.
"BLD",6,1,6,0)
This patch modifies both %ZTER (as ZTER) to correct the error while
"BLD",6,1,7,0)
recording an error, and XTER1 to correct the error while displaying an
"BLD",6,1,8,0)
error.
"BLD",6,1,9,0)
 
"BLD",6,1,10,0)
                Before             After           Patch
"BLD",6,1,11,0)
 Routine       Checksum           Checksum       Indicator
"BLD",6,1,12,0)
 
"BLD",6,1,13,0)
 XTER1         19556308           19595199         **8**
"BLD",6,1,14,0)
 ZTER          18060298           18099209         **8**
"BLD",6,1,15,0)
 
"BLD",6,1,16,0)
========================================================================= 
"BLD",6,1,17,0)
 Installation: 
"BLD",6,1,18,0)
  
"BLD",6,1,19,0)
  1. Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This 
"BLD",6,1,20,0)
     option will load the KIDS package in this message onto your system.  
"BLD",6,1,21,0)
  2. Answer NO to the question: 
"BLD",6,1,22,0)
     'Shall I preserve what is on disk in a separate back-up message ?' 
"BLD",6,1,23,0)
  3. From the 'Installion Menu' of the KIDS menu, run the option 
"BLD",6,1,24,0)
     'Verify Checksums in Transport Global' and verify that all routines 
"BLD",6,1,25,0)
     have the correct checksum.  
"BLD",6,1,26,0)
  4. From the 'Installion Menu' of the KIDS menu, run the option
"BLD",6,1,27,0)
     'Install Package(s)' Select the package 'XU*8.0*8' and proceed with
"BLD",6,1,28,0)
     install.
"BLD",6,1,29,0)
  5. After the patch has been loaded, the routine ZTER should be copied to
"BLD",6,1,30,0)
     the manager account and saved as %ZTER.
"BLD",6,1,31,0)
  6. The routines %ZTER and XTER1 may be included as part of a mapped
"BLD",6,1,32,0)
     routine set.  If this is the case, the mapped versions of %ZTER and
"BLD",6,1,33,0)
     XTER1 should be disabled until the mapped routines are reloaded.
"BLD",6,1,34,0)
 
"BLD",6,1,35,0)
 
"BLD",6,1,36,0)
 =========================================================================
"BLD",6,4,0)
^9.64PA^^
"BLD",6,"KRN",0)
^9.67PA^8994^15
"BLD",6,"KRN",.4,0)
.4
"BLD",6,"KRN",.401,0)
.401
"BLD",6,"KRN",.402,0)
.402
"BLD",6,"KRN",.403,0)
.403
"BLD",6,"KRN",.5,0)
.5
"BLD",6,"KRN",.84,0)
.84
"BLD",6,"KRN",3.6,0)
3.6
"BLD",6,"KRN",9.2,0)
9.2
"BLD",6,"KRN",9.8,0)
9.8
"BLD",6,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6,"KRN",9.8,"NM",1,0)
XTER1^^0^B27014078
"BLD",6,"KRN",9.8,"NM",2,0)
ZTER^^0^B23871204
"BLD",6,"KRN",9.8,"NM","B","XTER1",1)

"BLD",6,"KRN",9.8,"NM","B","ZTER",2)

"BLD",6,"KRN",19,0)
19
"BLD",6,"KRN",19.1,0)
19.1
"BLD",6,"KRN",101,0)
101
"BLD",6,"KRN",409.61,0)
409.61
"BLD",6,"KRN",8994,0)
8994
"BLD",6,"KRN",8995,0)
8995
"BLD",6,"KRN","B",.4,.4)

"BLD",6,"KRN","B",.401,.401)

"BLD",6,"KRN","B",.402,.402)

"BLD",6,"KRN","B",.403,.403)

"BLD",6,"KRN","B",.5,.5)

"BLD",6,"KRN","B",.84,.84)

"BLD",6,"KRN","B",3.6,3.6)

"BLD",6,"KRN","B",9.2,9.2)

"BLD",6,"KRN","B",9.8,9.8)

"BLD",6,"KRN","B",19,19)

"BLD",6,"KRN","B",19.1,19.1)

"BLD",6,"KRN","B",101,101)

"BLD",6,"KRN","B",409.61,409.61)

"BLD",6,"KRN","B",8994,8994)

"BLD",6,"KRN","B",8995,8995)

"BLD",6,"QUES",0)
^9.62^^
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^XUDOCV7 NEW FEATURES
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2951018^4
"PKG",3,22,1,"PAH",1,0)
8^2951010^2
"PKG",3,22,1,"PAH",1,1,0)
^^36^36^2951108
"PKG",3,22,1,"PAH",1,1,1,0)
Occasional errors have been reported in which an undefined error is
"PKG",3,22,1,"PAH",1,1,2,0)
generated while recording an error and others in which an undefined error
"PKG",3,22,1,"PAH",1,1,3,0)
is generated while using the error reporter.  These resulted from attempts
"PKG",3,22,1,"PAH",1,1,4,0)
to obtain the value of an entry in the ^TMP global with a final subscripts
"PKG",3,22,1,"PAH",1,1,5,0)
of  0,0).  Similar code in both situations were related to the errors.
"PKG",3,22,1,"PAH",1,1,6,0)
This patch modifies both %ZTER (as ZTER) to correct the error while
"PKG",3,22,1,"PAH",1,1,7,0)
recording an error, and XTER1 to correct the error while displaying an
"PKG",3,22,1,"PAH",1,1,8,0)
error.
"PKG",3,22,1,"PAH",1,1,9,0)
 
"PKG",3,22,1,"PAH",1,1,10,0)
                Before             After           Patch
"PKG",3,22,1,"PAH",1,1,11,0)
 Routine       Checksum           Checksum       Indicator
"PKG",3,22,1,"PAH",1,1,12,0)
 
"PKG",3,22,1,"PAH",1,1,13,0)
 XTER1         19556308           19595199         **8**
"PKG",3,22,1,"PAH",1,1,14,0)
 ZTER          18060298           18099209         **8**
"PKG",3,22,1,"PAH",1,1,15,0)
 
"PKG",3,22,1,"PAH",1,1,16,0)
========================================================================= 
"PKG",3,22,1,"PAH",1,1,17,0)
 Installation: 
"PKG",3,22,1,"PAH",1,1,18,0)
  
"PKG",3,22,1,"PAH",1,1,19,0)
  1. Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This 
"PKG",3,22,1,"PAH",1,1,20,0)
     option will load the KIDS package in this message onto your system.  
"PKG",3,22,1,"PAH",1,1,21,0)
  2. Answer NO to the question: 
"PKG",3,22,1,"PAH",1,1,22,0)
     'Shall I preserve what is on disk in a separate back-up message ?' 
"PKG",3,22,1,"PAH",1,1,23,0)
  3. From the 'Installion Menu' of the KIDS menu, run the option 
"PKG",3,22,1,"PAH",1,1,24,0)
     'Verify Checksums in Transport Global' and verify that all routines 
"PKG",3,22,1,"PAH",1,1,25,0)
     have the correct checksum.  
"PKG",3,22,1,"PAH",1,1,26,0)
  4. From the 'Installion Menu' of the KIDS menu, run the option
"PKG",3,22,1,"PAH",1,1,27,0)
     'Install Package(s)' Select the package 'XU*8.0*8' and proceed with
"PKG",3,22,1,"PAH",1,1,28,0)
     install.
"PKG",3,22,1,"PAH",1,1,29,0)
  5. After the patch has been loaded, the routine ZTER should be copied to
"PKG",3,22,1,"PAH",1,1,30,0)
     the manager account and saved as %ZTER.
"PKG",3,22,1,"PAH",1,1,31,0)
  6. The routines %ZTER and XTER1 may be included as part of a mapped
"PKG",3,22,1,"PAH",1,1,32,0)
     routine set.  If this is the case, the mapped versions of %ZTER and
"PKG",3,22,1,"PAH",1,1,33,0)
     XTER1 should be disabled until the mapped routines are reloaded.
"PKG",3,22,1,"PAH",1,1,34,0)
 
"PKG",3,22,1,"PAH",1,1,35,0)
 
"PKG",3,22,1,"PAH",1,1,36,0)
 =========================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options and Options
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XTER1")
0^1^B27014078
"RTN","XTER1",1,0)
XTER1 ;ISC-SF.SEA/JLI - MODIFICATION OF %XTER FOR USE WITH VAX DSM ;11/6/95  16:36
"RTN","XTER1",2,0)
 ;;8.0;KERNEL;**8**;Jul 10, 1995
"RTN","XTER1",3,0)
 S XTDV1=0
"RTN","XTER1",4,0)
WRT S XTOUT=0 S:'$D(XTBLNK) $P(XTBLNK," ",133)=" " S:'$D(C) C=0 K:C=0 ^TMP($J,"XTER")
"RTN","XTER1",5,0)
 D DV I '$D(%XTZLIN) S %XTY=$P(%XTZE,","),%XTX=$P(%XTY,"^") S:%XTX[">" %XTX=$P(%XTX,">",2)
"RTN","XTER1",6,0)
 I '$D(%XTZLIN),%XTX'="" S X=$P($P(%XTY,"^",2),":") I X'="" X ^%ZOSF("TEST") I $T D
"RTN","XTER1",7,0)
 .S XCNP=0,DIF="^TMP($J,""XTER1""," X ^%ZOSF("LOAD") S %XTY=$P(%XTX,"+",1) D
"RTN","XTER1",8,0)
 ..I %XTY'="" F X=0:0 S X=$O(^TMP($J,"XTER1",X)) Q:X'>0  I $P(^(X,0)," ")=%XTY S X=X+$P(%XTX,"+",2),%XTZLIN=^TMP($J,"XTER1",X,0) Q
"RTN","XTER1",9,0)
 ..I %XTY="" S X=+$P(%XTX,"+",2) Q:X'>0  S %XTZLIN=^TMP($J,"XTER1",X,0)
"RTN","XTER1",10,0)
 S:'$D(%XTZLIN) %XTZLIN="" K ^TMP($J,"XTER1"),XCNP,DIF,%XTY,%XTX
"RTN","XTER1",11,0)
 I %XTZLIN'="" S C=C+1,^TMP($J,"XTER",C)="",C=C+1,^(C)=%XTZLIN
"RTN","XTER1",12,0)
 I '$D(^%ZTER(1,%XTZDAT,1,%XTZNUM,"ZV","B")) F XTI=0:0 S XTI=$O(^%ZTER(1,%XTZDAT,1,%XTZNUM,"ZV",XTI)) Q:XTI'>0  S XTSYM=^(XTI,0),^%ZTER(1,%XTZDAT,1,%XTZNUM,"ZV","B",XTSYM,XTI)=""
"RTN","XTER1",13,0)
 I IO'=IO(0) S XTDV1=0 D DV
"RTN","XTER1",14,0)
 S:%XTZGR'="" C=C+1,^TMP($J,"XTER",C)="",C=C+1,^(C)="Last Global Ref: "_%XTZGR D:'$G(XTMES)&'$G(XTPRNT) WRITER^XTER1A I IO'="",IO'=IO(0)!$G(XTPRNT) U IO W @IOF S X="^L" G WRTA
"RTN","XTER1",15,0)
 I $G(XTMES) S X="^L" G WRTA
"RTN","XTER1",16,0)
 K ^TMP($J,"XTER") S C=0 R !!,"Which symbol? > ",XTX:DTIME S:'$T!(XTX="") XTX="^" G XTERR^XTER:XTX>0!(XTX="^"),END^XTER:XTX="^Q"!(XTX="^q"),MESG^XTER1A:XTX="^M"!(XTX="^m"),PRNT^XTER1A:XTX="^P"!(XTX="^p") S X=XTX,XTX="",XTOUT=0
"RTN","XTER1",17,0)
 I X="^I"!(X="^i") D EN^XTER1B G WRT
"RTN","XTER1",18,0)
 I X["?" S XTF="1,2,10,7,13,14,15,8,9" D HELP^XTER G WRT
"RTN","XTER1",19,0)
 I X="$" S XTDV1=0 D DV G WRT
"RTN","XTER1",20,0)
 I X="^R"!(X="^r") G RESTOR^XTER2
"RTN","XTER1",21,0)
WRTA D WRT1 S:'$D(XTX) XTX="" Q:$G(XTMES)!$G(XTPRNT)  G:IO=IO(0)&(XTX'="^Q")&(XTX'="^q") WRT U IO(0) G END^XTER:XTX="^Q"!(XTX="^q"),XTERR^XTER
"RTN","XTER1",22,0)
 ;
"RTN","XTER1",23,0)
WRT1 S:'$D(IOSL) IOSL=24 S C=C+1,^TMP($J,"XTER",C)="",C=C+1,^(C)="" S XTSYM=$S(X="^L":"",X="^l":"",1:X),%XTYL=IOSL-4,XTI=0,XTC=1,X="",XTA=XTSYM,XTA=$S(XTA="":"",1:$E(XTA,1,$L(XTA)-1)_$C($A($E(XTA,$L(XTA)))-1)_"z")
"RTN","XTER1",24,0)
WF S:'%XTYL %XTYL=IOSL-4 S (XTA,XTA1)=$O(^%ZTER(1,%XTZDAT,1,%XTZNUM,"ZV","B",XTA)) S:XTA'="" XTI=$O(^(XTA,0)) I XTA=""!(XTSYM'=""&($E(XTA,1,$L(XTSYM))'=XTSYM)) S:XTSYM'=""&XTC C=C+1,^TMP($J,"XTER",C)="No such symbol" D:'$G(XTPRNT) MORE^XTER1A Q
"RTN","XTER1",25,0)
 S XTB=$S($D(^%ZTER(1,%XTZDAT,1,%XTZNUM,"ZV",XTI,"D")):^("D"),1:"***  WARNING: this value was NOT recorded due to an ERROR WITHIN the TRAP ***")
"RTN","XTER1",26,0)
 S XTC=0 S:'$G(XTMES)&'$G(XTPRNT) %XTYL=%XTYL-1 D:'%XTYL MORE^XTER1A Q:XTOUT  S:'%XTYL C=C+1,^TMP($J,"XTER",C)="" S XTA1=XTA1_"=" K XTC1 I XTB?.PUNL,XTB'["\" S XTA1=XTA1_XTB,XTC1=""
"RTN","XTER1",27,0)
 I '$D(XTC1) S XTC1="" I $P(XTA1," ",2)="" F XTK=1:1 S XTZ=$E(XTB,XTK) Q:XTZ=""  S XTC1=XTC1_$S(XTZ'?1C:XTZ,1:"\"_$E($A(XTZ)+1000,2,4)) I XTZ="\" S XTC1=XTC1_"\"
"RTN","XTER1",28,0)
SET I ($L(XTA1)+$L(XTC1))<246 S XTA1=XTA1_XTC1,XTC1="" S C=C+1,^TMP($J,"XTER",C)=XTA1 G WF
"RTN","XTER1",29,0)
 I $L(XTA1)>245 S C=C+1,^TMP($J,"XTER",C)=$E(XTA1,1,245) S XTA1=$E(XTA1,246,$L(XTA1)) G SET
"RTN","XTER1",30,0)
 I $L(XTA1)>0 S C=C+1,^TMP($J,"XTER",C)=XTA1_$E(XTC1,1,(245-$L(XTA1))) S XTC1=$E(XTC1,(245-$L(XTA1)+1),$L(XTC1)) G SET
"RTN","XTER1",31,0)
 S C=C+1,^TMP($J,"XTER",C)=$E(XTC1,1,245),XTC1=$E(XTC1,246,$L(XTC1)) G SET
"RTN","XTER1",32,0)
 G WF
"RTN","XTER1",33,0)
 ;
"RTN","XTER1",34,0)
DV I $D(XTDV1),XTDV1=1 G DV1
"RTN","XTER1",35,0)
 K %XTZLIN
"RTN","XTER1",36,0)
 S %XTZE=^%ZTER(1,%XTZDAT,1,%XTZNUM,"ZE"),%XTJOB=$G(^("J")),%XTIO=$G(^("I")),%XTZH=$G(^("ZH")),%XTZH1=$G(^("H")),%XTZGR=$G(^("GR")) S:$D(^("LINE")) %XTZLIN=^("LINE")
"RTN","XTER1",37,0)
 I %XTZH1>0 S %H=%XTZH1 D YMD^%DTC S Y=X_% D DD^%DT S $P(%XTZH1,"^",2)=$P(Y,"@",1)_" "_$P(Y,"@",2)
"RTN","XTER1",38,0)
 F %XTI=1:1:9 S %XTZH(%XTI)=$P(%XTZH,"^",%XTI)
"RTN","XTER1",39,0)
 S %XTZH(3)=$P(%XTZH1,U,2)
"RTN","XTER1",40,0)
 S %XTUCI=$P(%XTJOB,U,4)
"RTN","XTER1",41,0)
 S C=C+1,^TMP($J,"XTER",C)="",C=C+1,^(C)="",C=C+1,^(C)="Process ID:  "_$P(%XTJOB,U,5)_"  ("_$P(%XTJOB,U)_")"
"RTN","XTER1",42,0)
 S C=C+1,^TMP($J,"XTER",C)=$E(XTBLNK,1,79-$L(%XTZH(3)))_%XTZH(3)
"RTN","XTER1",43,0)
 S %XTZ="Username\Process Name\UCI/VOL\\$ZA\$ZB\Current $IO\Current $ZIO\CPU time\Page Faults\Direct I/O\Buffered I/O"
"RTN","XTER1",44,0)
 S %XTZ(1)=$P(%XTJOB,U,3),%XTZ(2)=$P(%XTJOB,U,2),%XTZ(3)=$S(%XTUCI]"":"["_%XTUCI_"]",1:""),%XTZ(4)="",%XTZ(5)=$J($P(%XTIO,U,2),3),%XTZ(6)=$J($P(%XTIO,U,3),3)
"RTN","XTER1",45,0)
 S %XTZ(7)=$P(%XTIO,U),%XTZ(8)=$P(%XTIO,U,4,99),%XTZ(9)=$J(%XTZH(1),6),%XTZ(10)=$J(%XTZH(4),10),%XTZ(11)=$J(%XTZH(7),10),%XTZ(12)=$J(%XTZH(8),10)
"RTN","XTER1",46,0)
 F %XTI=1:1:12 S:%XTI#2 C=C+1,^TMP($J,"XTER",C)="",X="" S X=X_$P(%XTZ,"\",%XTI)_": "_%XTZ(%XTI) S:%XTI#2 X=$E(X_$E(XTBLNK,1,40),1,40) S:'(%XTI#2) C=C+1,^TMP($J,"XTER",C)=X
"RTN","XTER1",47,0)
DV1 S XTDV1=1 S C=C+1,^TMP($J,"XTER",C)="",C=C+1,^(C)="$ZE= "_%XTZE
"RTN","XTER1",48,0)
 K X I $D(^%ZTER(1,%XTZDAT,1,%XTZNUM,"ZE2")) S X=^("ZE2")
"RTN","XTER1",49,0)
 I $D(X) S C=C+1,^TMP($J,"XTER",C)="",C=C+1,^(C)="An error also occurred while logging this error -- This MAY CAUSE SOME",C=C+1,^(C)="LOCAL VARIABLES TO BE LOST.     This error was",C=C+1,^(C)="$ZE(2)= "_X
"RTN","XTER1",50,0)
 Q
"RTN","XTER1",51,0)
 ;
"RTN","ZTER")
0^2^B23871204
"RTN","ZTER",1,0)
%ZTER ; ISC-SF.SEA/JLI - ERROR TRAP TO LOG ERRORS ;11/6/95  16:35
"RTN","ZTER",2,0)
 ;;8.0;KERNEL;**8**;JUL 10, 1995
"RTN","ZTER",3,0)
 I $ZE["-ALLOC,"!($ZE["<STORE>") D @$S('$D(^%ZOSF("OS")):"^%ET",^("OS")["DTM":"^%errlog",1:"^%ET") D H^XUS
"RTN","ZTER",4,0)
 S %ZT("^XUTL(""XQ"",$J)")="" S:'$D(%ZTERLGR) %ZTERLGR=$$LGR^%ZOSV()
"RTN","ZTER",5,0)
 S %ZTER11N=$S('$D(^%ZTER(1,+$H)):0,1:$P(^(+$H,0),"^",2))+1,^%ZTER(1,+$H,0)=(+$H)_"^"_%ZTER11N,^(1,0)="^3.0751^"_%ZTER11N_"^"_%ZTER11N
"RTN","ZTER",6,0)
 S ^%ZTER(1,+$H,1,%ZTER11N,0)=%ZTER11N,^("ZE")=$ZE S:$D(%ZTERLGR) ^("GR")=%ZTERLGR K %ZTERLGR I %ZTER11N=1 S ^%ZTER(1,0)=$P(^%ZTER(1,0),"^",1,2)_"^"_(+$H)_"^"_($P(^%ZTER(1,0),"^",4)+1)
"RTN","ZTER",7,0)
 S %ZTER11B="" F %ZTER11I=1:1:$L($ZB) S %ZTER11A=$E($ZB,%ZTER11I),%ZTER11B=%ZTER11B_$S(%ZTER11A?1C:$C($A(%ZTER11A)+32#128),1:%ZTER11A)
"RTN","ZTER",8,0)
 S %ZTER11I="" I $D(^%ZOSF("UCI")) K %ZTER11A S:$D(Y) %ZTER11A="" S:($D(Y)#2) %ZTER11A=Y X ^%ZOSF("UCI") S %ZTER11I=Y K:'$D(%ZTER11A) Y S:$D(%ZTER11A) Y=%ZTER11A
"RTN","ZTER",9,0)
 S ^%ZTER(1,+$H,1,%ZTER11N,"H")=$H,^("J")=$J_"^^^"_%ZTER11I_"^"_$J,^("I")=$I_"^"_$ZA_"^"_%ZTER11B_"^"_$S($D(IO("ZIO")):IO("ZIO"),1:""),%ZTER11C=0
"RTN","ZTER",10,0)
 S %ZTERROR=$S($ZE["%DSM-E":$P($P($ZE,"%DSM-E-",2),","),1:$P($P($ZE,"<",2),">"))
"RTN","ZTER",11,0)
 I $G(^%ZOSF("OS"))["VAX DSM" K %ZTER11A,%ZTER11B S:'$D(%ZTER11S) %ZTER11S=$STACK-1 D ^%ZTER1 I 1
"RTN","ZTER",12,0)
 E  S %ZTERVAR="%" D:$D(%) VAR:$D(%)#2,SUBS:$D(%)\10 F %ZTER11Z=0:0 S %ZTERVAR=$O(@%ZTERVAR) Q:%ZTERVAR=""  D VAR:$D(@%ZTERVAR)#2,SUBS:$D(@%ZTERVAR)\10
"RTN","ZTER",13,0)
 D GLOB S:%ZTER11C>0 ^%ZTER(1,+$H,1,%ZTER11N,"ZV",0)="^3.0752^"_%ZTER11C_"^"_%ZTER11C S:'$D(^%ZTER(1,"B",+$H)) ^(+$H,+$H)="" S ^%ZTER(1,+$H,1,"B",%ZTER11N,%ZTER11N)=""
"RTN","ZTER",14,0)
LIN ;
"RTN","ZTER",15,0)
 S %ZTY=$P($ZE,","),%ZTX=$P(%ZTY,"^") S:%ZTX[">" %ZTX=$P(%ZTX,">",2)
"RTN","ZTER",16,0)
 I %ZTX'="" S X=$P($P(%ZTY,"^",2),":") I X'="" X ^%ZOSF("TEST") I $T D
"RTN","ZTER",17,0)
 .S XCNP=0,DIF="^TMP($J,""XTER1""," X ^%ZOSF("LOAD") S %ZTY=$P(%ZTX,"+",1) D
"RTN","ZTER",18,0)
 ..I %ZTY'="" F X=0:0 S X=$O(^TMP($J,"XTER1",X)) Q:X'>0  I $P(^(X,0)," ")=%ZTY S X=X+$P(%ZTX,"+",2),%ZTZLIN=^TMP($J,"XTER1",X,0) Q
"RTN","ZTER",19,0)
 ..I %ZTY="" S X=+$P(%ZTX,"+",2) Q:X'>0  S %ZTZLIN=^TMP($J,"XTER1",X,0)
"RTN","ZTER",20,0)
 K ^TMP($J,"XTER1"),XCNP,DIF,%ZTY,%ZTX,X,Y
"RTN","ZTER",21,0)
 S:$D(%ZTZLIN) ^%ZTER(1,+$H,1,%ZTER11N,"LINE")=%ZTZLIN K %ZTZLIN
"RTN","ZTER",22,0)
 I %ZTERROR'="",$D(^%ZTER(2,"B",%ZTERROR)) S %ZTERROR=%ZTERROR_"^"_$P(^%ZTER(2,+$O(^(%ZTERROR,0)),0),"^",2)
"RTN","ZTER",23,0)
 K %ZTER11A,%ZTER11B,%ZTER11C,%ZTER11S,%ZTER11Z,%ZTERVAP,%ZTERVAR,%ZTERSUB,%ZTER11I,%ZTER11D,%ZTER11L,%ZTER11Q,%,%ZTER111,%ZTER112,%H,%ZTER11N
"RTN","ZTER",24,0)
 Q
"RTN","ZTER",25,0)
 ;
"RTN","ZTER",26,0)
VAR I ",%ZTERVAR,%ZTER11Z,%ZTER11A,%ZTER11B,%ZTER11C,%ZTER11N,%ZTER11I,%ZTER11L,%ZTER11S,%ZTERVAP,%ZTERSUB,"'[(","_%ZTERVAR_",") S %ZTER11C=%ZTER11C+1,^%ZTER(1,+$H,1,%ZTER11N,"ZV",%ZTER11C,0)=%ZTERVAR D
"RTN","ZTER",27,0)
 . I $L(@%ZTERVAR)'>255 S ^%ZTER(1,+$H,1,%ZTER11N,"ZV",%ZTER11C,"D")=@%ZTERVAR Q
"RTN","ZTER",28,0)
 . S ^%ZTER(1,+$H,1,%ZTER11N,"ZV",%ZTER11C,"D")=" **** VALUE IS GREATER THAN 255 CHARACTERS (SEE SUBNODES FOR DATA) *** "
"RTN","ZTER",29,0)
 . N %ZTER11,%ZTER12
"RTN","ZTER",30,0)
 . F %ZTER11=1:1 S %ZTER12=$E(@%ZTERVAR,1,245) Q:%ZTER12=""  S @%ZTERVAR=$E(@%ZTERVAR,246,$L(@%ZTERVAR)),^%ZTER(1,+$H,1,%ZTER11N,"ZV",%ZTER11C,"D",%ZTER11)=%ZTER12
"RTN","ZTER",31,0)
 . Q
"RTN","ZTER",32,0)
 Q
"RTN","ZTER",33,0)
 ;
"RTN","ZTER",34,0)
SUBS S %ZTER11S="" Q:"%ZT("=$E(%ZTERVAR,1,4)  Q:",%ZTER11S,%ZTER11L,"[(","_%ZTERVAR_",")  S %ZTERVAP=%ZTERVAR_"(",%ZTERSUB="%ZTER11S)"
"RTN","ZTER",35,0)
 ;
"RTN","ZTER",36,0)
DESC S %ZTER11I=%ZTER11I+1,%ZTER11S(%ZTER11I)=%ZTER11S,%ZTER11S="",%ZTER11L(%ZTER11I)=$L(%ZTERSUB)-9 F %ZTER11Z=0:0 S %ZTER11S=$O(@(%ZTERVAP_%ZTERSUB)) Q:%ZTER11S=""  D SUBX
"RTN","ZTER",37,0)
 S %ZTER11S=%ZTER11S(%ZTER11I) K %ZTER11S(%ZTER11I),%ZTER11L(%ZTER11I) S %ZTER11I=%ZTER11I-1
"RTN","ZTER",38,0)
 Q
"RTN","ZTER",39,0)
 ;
"RTN","ZTER",40,0)
SUBX I $D(@(%ZTERVAP_%ZTERSUB))#10 S %ZTER11C=%ZTER11C+1,^%ZTER(1,+$H,1,%ZTER11N,"ZV",%ZTER11C,0)=$P(%ZTERVAP_%ZTERSUB,"%ZTER11S",1)_""""_%ZTER11S_""""_$P(%ZTERVAP_%ZTERSUB,"%ZTER11S",2),^("D")=@(%ZTERVAP_%ZTERSUB)
"RTN","ZTER",41,0)
 I $D(@(%ZTERVAP_%ZTERSUB))\10 S %ZTERSUB=$E(%ZTERSUB,1,%ZTER11L(%ZTER11I))_""""_%ZTER11S_""""_",%ZTER11S)" D DESC S %ZTERSUB=$E(%ZTERSUB,1,%ZTER11L(%ZTER11I))_"%ZTER11S)"
"RTN","ZTER",42,0)
 Q
"RTN","ZTER",43,0)
 ;
"RTN","ZTER",44,0)
GLOB ;
"RTN","ZTER",45,0)
 S %ZTER11D="" F %ZTER11I=0:0 S %ZTER11D=$O(%ZT(%ZTER11D)) Q:%ZTER11D=""  S %ZTER11A=%ZTER11D S:%ZTER11A["$J" %ZTER11B=$J,%ZTER11A=$P(%ZTER11A,"$J",1)_%ZTER11B_$P(%ZTER11A,"$J",2,99) S %ZTER11B=$P(%ZTER11A,")",1) D LOOP
"RTN","ZTER",46,0)
 Q
"RTN","ZTER",47,0)
 ;
"RTN","ZTER",48,0)
LOOP ;
"RTN","ZTER",49,0)
 F %ZTER11I=0:0 S %ZTER11A=$ZO(@%ZTER11A) Q:%ZTER11A'[%ZTER11B  S %ZTER11C=%ZTER11C+1,^%ZTER(1,+$H,1,%ZTER11N,"ZV",%ZTER11C,0)=$P(%ZTER11D,")")_$P(%ZTER11A,%ZTER11B,2),^%ZTER(1,+$H,1,%ZTER11N,"ZV",%ZTER11C,"D")=@%ZTER11A
"RTN","ZTER",50,0)
 Q
"VER")
8.0^21.0
**END**
**END**
