KIDS Distribution saved on Nov 12, 2004@10:01:33
LA*5.2*64/LR*5.2*286
**KIDS**:LA*5.2*64^LR*5.2*286^

**INSTALL NAME**
LA*5.2*64
"BLD",15391,0)
LA*5.2*64^AUTOMATED LAB INSTRUMENTS^0^3041112^y
"BLD",15391,1,0)
520^9.61A^263^263^3041112^^^^
"BLD",15391,1,1,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LA*5.2*64 does not
"BLD",15391,1,2,0)
contain any changes to the VISTA BLOOD BANK Software as defined by VHA
"BLD",15391,1,3,0)
DIRECTIVE 99-053 titled VISTA BLOOD BANK SOFTWARE VERSION 5.2.
"BLD",15391,1,4,0)

"BLD",15391,1,5,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LA*5.2*64 does not
"BLD",15391,1,6,0)
alter or modify any software design safeguards or safety critical elements
"BLD",15391,1,7,0)
functions.
"BLD",15391,1,8,0)

"BLD",15391,1,9,0)
RISK ANALYSIS: Changes made by patch LA*5.2*64 have no effect on Blood Bank
"BLD",15391,1,10,0)
software functionality, therefore RISK is none.
"BLD",15391,1,11,0)

"BLD",15391,1,12,0)
VALIDATION REQUIREMENTS BY OPTION:  Because of the nature of the changes
"BLD",15391,1,13,0)
made, no specific validation requirements exist as a result of installation
"BLD",15391,1,14,0)
of this patch.
"BLD",15391,1,15,0)

"BLD",15391,1,16,0)
=======================================================================
"BLD",15391,1,17,0)
This patch adds support for sending/receiving Laboratory Electronic
"BLD",15391,1,18,0)
Data Interchange (LEDI) orders/results with Department of Defense (DoD)
"BLD",15391,1,19,0)
facilities and implements enhancements to general LEDI functionality.
"BLD",15391,1,20,0)
 
"BLD",15391,1,21,0)
 
"BLD",15391,1,22,0)
1. The process of building orders in the LAB PENDING ORDERS ENTRY file
"BLD",15391,1,23,0)
(#69.6) has been enhanced to use additional information from the HL7 Order
"BLD",15391,1,24,0)
(ORM) message. It will store the following information when available in the
"BLD",15391,1,25,0)
LAB PENDING ORDERS ENTRY file (#69.6):
"BLD",15391,1,26,0)
 - patient's race
"BLD",15391,1,27,0)
 - order comments
"BLD",15391,1,28,0)
 - test results that accompany an order 
"BLD",15391,1,29,0)

"BLD",15391,1,30,0)
2. The new option Start a Shipping Manifest [LA7S MANIFEST START] will
"BLD",15391,1,31,0)
allow a manifest to be started without performing a manifest build.
"BLD",15391,1,32,0)
Specimens can then be added manually, instead of automatically, using
"BLD",15391,1,33,0)
option Add/Remove a Shipping Manifest Test [LA7S MANIFEST TEST ADD/REMOVE].
"BLD",15391,1,34,0)

"BLD",15391,1,35,0)
3. The new option Edit Relevant Clinical Information [LA7S MANIFEST
"BLD",15391,1,36,0)
CLINICAL INFO] is used to enter relevant clinical information that
"BLD",15391,1,37,0)
should accompany a test order on a manifest.
"BLD",15391,1,38,0)
 
"BLD",15391,1,39,0)
4. Converted supported API calls $$FMDATE^HLFNC and $$HLDATE^HLFNC to
"BLD",15391,1,40,0)
recommended Kernel supported API's $$HL7TFM^XLFDT and $$FMTHL7^XLFDT
"BLD",15391,1,41,0)
respectively.
"BLD",15391,1,42,0)
 
"BLD",15391,1,43,0)
5. Routine LA7VHL changed to call HL7 supported API RSPINIT^HLFNC2 to
"BLD",15391,1,44,0)
obtain message delimiters that HL7 package will use when building MSH
"BLD",15391,1,45,0)
header of application acknowledgement message. Previous call to
"BLD",15391,1,46,0)
INIT^HLFNC would return incorrect headers under certain conditions.
"BLD",15391,1,47,0)
See patch HL*1.6*101 for additional information.
"BLD",15391,1,48,0)
 
"BLD",15391,1,49,0)
6. Routine LA7VMSG1 changed to check if $QUERY of ^TMP global has
"BLD",15391,1,50,0)
returned a null value. Under certain conditions an illegal function call
"BLD",15391,1,51,0)
error could be observed.
"BLD",15391,1,52,0)
 
"BLD",15391,1,53,0)
7. Changed routines LA7VLL, LA7VSTP, and LA7VSTP1 to setup LA7V* logical
"BLD",15391,1,54,0)
links without <space> between "LA7V" and station number. Allows HL7 package
"BLD",15391,1,55,0)
to display logical links for DoD sites which utilize DoD DMIS ID codes as
"BLD",15391,1,56,0)
facility identifiers similar to VA station numbers. HL7 package only
"BLD",15391,1,57,0)
displays first 8 characters of logical link name. Option LEDI Setup
"BLD",15391,1,58,0)
[LA7V SETUP] will only support creation of TCP logical links.
"BLD",15391,1,59,0)
 
"BLD",15391,1,60,0)
8. Routine LA7PURG is changed to purge shipping manifests from LAB
"BLD",15391,1,61,0)
SHIPPING MANIFEST file (#62.8) when all related accessions have been
"BLD",15391,1,62,0)
purged from ACCESSION file (#68) (E3R #18036). Orders in the LAB PENDING
"BLD",15391,1,63,0)
ORDERS ENTRY file (#69.6) are purged when the date completed is >365
"BLD",15391,1,64,0)
days, when the order transmitted date is >720 days or when the order
"BLD",15391,1,65,0)
transmitted date is >360 and the order status is Results/data Received.
"BLD",15391,1,66,0)
 
"BLD",15391,1,67,0)
9. When selecting a shipping manifest the list of entries to select
"BLD",15391,1,68,0)
from will list the manifests in inverse order with the most recent
"BLD",15391,1,69,0)
being displayed first. (E3R #18036)
"BLD",15391,1,70,0)
 
"BLD",15391,1,71,0)
10. Requesting provider's office phone, voice and digital pager numbers
"BLD",15391,1,72,0)
will be printed on working copies of shipping manifest. (E3R #17914)
"BLD",15391,1,73,0)
 
"BLD",15391,1,74,0)
11. Four new alerts/mail bulletins are generated when processing LEDI
"BLD",15391,1,75,0)
HL7 messages. These alerts and corresponding bulletins are addressed to
"BLD",15391,1,76,0)
the mail group designated to receive the NEW RESULTS alert specified
"BLD",15391,1,77,0)
by the site in LA7 MESSAGE PARAMETER file (#62.48) for LEDI type
"BLD",15391,1,78,0)
interfaces.
"BLD",15391,1,79,0)
 
"BLD",15391,1,80,0)
   a. Mail bulletin: LA7 ABNORMAL RESULTS RECEIVED
"BLD",15391,1,81,0)
   Mail bulletin created by Laboratory package when processing a LEDI
"BLD",15391,1,82,0)
   interface type HL7 result (ORU) message which contains laboratory
"BLD",15391,1,83,0)
   testing results that are flagged as critical or abnormal.  Values
"BLD",15391,1,84,0)
   that are critical will always trigger the alert and bulletin. Values
"BLD",15391,1,85,0)
   that are abnormal low or high will be triggered when site has flagged
"BLD",15391,1,86,0)
   the corresponding test in AUTO INSTRUMENT file (#62.4), NOTIFY ABNORMAL
"BLD",15391,1,87,0)
   FLAGS field (#22) within the CHEM TEST multiple (#30) for the interface.
"BLD",15391,1,88,0)
 
"BLD",15391,1,89,0)
   b. Mail bulletin: LA7 AMENDED RESULTS RECEIVED
"BLD",15391,1,90,0)
   Mail bulletin created by Laboratory package when processing a LEDI
"BLD",15391,1,91,0)
   interface type HL7 result (ORU) message which contains laboratory
"BLD",15391,1,92,0)
   testing results that are flagged as amended.
"BLD",15391,1,93,0)
 
"BLD",15391,1,94,0)
   c. Mail bulletin: LA7 UNITS/NORMALS CHANGED
"BLD",15391,1,95,0)
   Mail bulletin created by Laboratory package when processing a LEDI
"BLD",15391,1,96,0)
   interface type HL7 result (ORU) message which contains laboratory
"BLD",15391,1,97,0)
   test result units and/or normals different from values specified for
"BLD",15391,1,98,0)
   test in LABORATORY TEST file (#60) and which are flagged to be used
"BLD",15391,1,99,0)
   for reference testing purposes.
"BLD",15391,1,100,0)
 
"BLD",15391,1,101,0)
   d. Mail bulletin: LA7 ORDER STATUS CHANGED
"BLD",15391,1,102,0)
   Mail bulletin created by Laboratory package when processing a LEDI
"BLD",15391,1,103,0)
   interface type HL7 message.
"BLD",15391,1,104,0)

"BLD",15391,1,105,0)
   Bulletin will be generated for the following conditions:
"BLD",15391,1,106,0)
 
"BLD",15391,1,107,0)
   - When an order acknowledgment (ORR) message contains laboratory
"BLD",15391,1,108,0)
   test order status changes that indicate the order is not correct or
"BLD",15391,1,109,0)
   cannot be performed/completed. Currently only supported on LEDI
"BLD",15391,1,110,0)
   interfaces with DoD facilities.
"BLD",15391,1,111,0)
 
"BLD",15391,1,112,0)
   - When an order result (ORU) message indicates that a laboratory
"BLD",15391,1,113,0)
   test has been added by the reference laboratory to the original order.
"BLD",15391,1,114,0)
 
"BLD",15391,1,115,0)
12. Corrected a spelling error in set of codes for LAB SHIPPING
"BLD",15391,1,116,0)
CONFIGURATION file (#62.9), COLLECTING FACILITY'S SPEC ID field (#.05).
"BLD",15391,1,117,0)
 
"BLD",15391,1,118,0)
13. Internal review determined that the specimen container was not printing
"BLD",15391,1,119,0)
on working copies of shipping manifests. When printing working versions
"BLD",15391,1,120,0)
of a shipping manifest the specimen container will be printed.
"BLD",15391,1,121,0)
  
"BLD",15391,1,122,0)
14. A new error bulletin #47 has been added to LA7 MESSAGE LOG BULLETINS
"BLD",15391,1,123,0)
file (#62.485). When processing LEDI orders if any of the following are
"BLD",15391,1,124,0)
incomplete - local test, local urgency, local topography or local collection
"BLD",15391,1,125,0)
sample then the bulletin will be triggered. This is to insure that orders
"BLD",15391,1,126,0)
sent by the collecting facility are not missed when processed during LEDI
"BLD",15391,1,127,0)
Referral Patient Accessioning. If this bulletin is triggered it indicates
"BLD",15391,1,128,0)
that the host site's shipping configuration is not properly configured to
"BLD",15391,1,129,0)
process orders from it's collecting site.
"BLD",15391,1,130,0)
  
"BLD",15391,1,131,0)
  
"BLD",15391,1,132,0)
ASSOCIATED E3R
"BLD",15391,1,133,0)
--------------
"BLD",15391,1,134,0)
 E3R #17914, PROVIDER CONTACT NUMBERS ON MANIFEST
"BLD",15391,1,135,0)
 E3R #17904, LEDI BETWEEN VA AND DOD SITES
"BLD",15391,1,136,0)
 E3R #18036, UNABLE TO PURGE SHIPPING MANIFESTS
"BLD",15391,1,137,0)
 
"BLD",15391,1,138,0)
ASSOCIATED NOIS
"BLD",15391,1,139,0)
---------------
"BLD",15391,1,140,0)
 ISA-0398-10075 
"BLD",15391,1,141,0)
 
"BLD",15391,1,142,0)
 
"BLD",15391,1,143,0)
TEST SITES
"BLD",15391,1,144,0)
----------
"BLD",15391,1,145,0)
 Albuquerque VAMC - VMS/DSM and VMS/Cache
"BLD",15391,1,146,0)
 Boston HCS - VMS/DSM and VMS/Cache
"BLD",15391,1,147,0)
 El Paso HCS - NT/Cache and VMS/Cache
"BLD",15391,1,148,0)
 Hines VAMC - VMS/DSM and VMS/Cache
"BLD",15391,1,149,0)
 Honolulu VAMC - NT/Cache
"BLD",15391,1,150,0)
 Manchester VAMC - NT/Cache and VMS/Cache
"BLD",15391,1,151,0)
 Milwaukee VAMC - VMS/DSM
"BLD",15391,1,152,0)
 North Chicago VAMC - VMS/DSM
"BLD",15391,1,153,0)
 Salt Lake City VAMC - VMS/DSM
"BLD",15391,1,154,0)
 San Diego VAMC - VMS/DSM and VMS/Cache
"BLD",15391,1,155,0)
 Upstate New York HCS - VMS/DSM and VMS/Cache
"BLD",15391,1,156,0)

"BLD",15391,1,157,0)

"BLD",15391,1,158,0)
 INSTALLATION FILES:
"BLD",15391,1,159,0)
 ==================
"BLD",15391,1,160,0)
 The following software and documentation files are exported as part of
"BLD",15391,1,161,0)
 this patch:
"BLD",15391,1,162,0)
  
"BLD",15391,1,163,0)
    File Name             Contents                     Retrieval Format
"BLD",15391,1,164,0)
    ---------             --------                     ----------------
"BLD",15391,1,165,0)
               
"BLD",15391,1,166,0)
LAB_LEDI_III.KID        LA*5.2*64 KIDS build           ASCII
"BLD",15391,1,167,0)
                        LR*5.2*286 KIDS build
"BLD",15391,1,168,0)

"BLD",15391,1,169,0)

"BLD",15391,1,170,0)
LAB_LEDI_III_IG.PDF     LABORATORY ELECTRONIC DATA     BINARY
"BLD",15391,1,171,0)
                        INSTALLATION GUIDE     
"BLD",15391,1,172,0)

"BLD",15391,1,173,0)
LAB_LEDI_III_IMP_UG.PDF LABORATORY ELECTRONIC DATA     BINARY
"BLD",15391,1,174,0)
                        IMPLEMENTATION AND USER GUIDE  
"BLD",15391,1,175,0)

"BLD",15391,1,176,0)
 The files listed above may be obtained via FTP.  The preferred method is
"BLD",15391,1,177,0)
 to FTP the files from:
"BLD",15391,1,178,0)
 
"BLD",15391,1,179,0)
    download.vista.med.va.gov
"BLD",15391,1,180,0)
 
"BLD",15391,1,181,0)
 This transmits the files from the first available FTP server.  Sites may
"BLD",15391,1,182,0)
 also elect to retrieve software directly from a specific server as
"BLD",15391,1,183,0)
 follows:
"BLD",15391,1,184,0)
 
"BLD",15391,1,185,0)
    CIO FIELD OFFICE   FTP ADDRESS                 DIRECTORY
"BLD",15391,1,186,0)
    ----------------   -------------------------   --------------------
"BLD",15391,1,187,0)
    Albany             ftp.fo-albany.med.va.gov    [anonymous.software]
"BLD",15391,1,188,0)
    Hines              ftp.fo-hines.med.va.gov     [anonymous.software]
"BLD",15391,1,189,0)
    Salt Lake City     ftp.fo-slc.med.va.gov       [anonymous.software]
"BLD",15391,1,190,0)
  
"BLD",15391,1,191,0)
  
"BLD",15391,1,192,0)
ROUTINE SUMMARY
"BLD",15391,1,193,0)
===============
"BLD",15391,1,194,0)
  The following routines are included in this patch.  The second line
"BLD",15391,1,195,0)
  of each of these routines now looks like:
"BLD",15391,1,196,0)
  <tab> ;;5.2;AUTOMATED LAB INSTRUMENTS;<patchlist>;Sep 27, 1994
"BLD",15391,1,197,0)
 
"BLD",15391,1,198,0)
                    Checksum       Checksum
"BLD",15391,1,199,0)
   Routine Name     Before Patch   After Patch    Patch List
"BLD",15391,1,200,0)
   ------------     ------------   -----------    ------------
"BLD",15391,1,201,0)
   LA64             N/A            5936440        **64** (Deleted by KIDS)
"BLD",15391,1,202,0)
   LA7PURG          3834284        4599657        **27,64**
"BLD",15391,1,203,0)
   LA7SBCR1         4924406        5434157        **27,46,64**
"BLD",15391,1,204,0)
   LA7SBCR2         2564479        2593598        **27,46,64**
"BLD",15391,1,205,0)
   LA7SCE           11501726       13339015       **27,46,61,64**
"BLD",15391,1,206,0)
   LA7SM2           12143125       16026225       **46,64**
"BLD",15391,1,207,0)
   LA7SMB           14649107       12799432       **27,46,64**
"BLD",15391,1,208,0)
   LA7SMP           11746903       12373162       **27,45,46,64**
"BLD",15391,1,209,0)
   LA7SMP0          9303222        10961615       **46,64**
"BLD",15391,1,210,0)
   LA7SMPXL         3215234        4682314        **27,42,46,64**
"BLD",15391,1,211,0)
   LA7SMU           7104257        7255424        **27,46,64**
"BLD",15391,1,212,0)
   LA7SMU1          6300206        6311796        **27,46,65,64**
"BLD",15391,1,213,0)
   LA7SMU2          5290542        7549846        **46,64**
"BLD",15391,1,214,0)
   LA7SRR           6233015        7637904        **46,64**
"BLD",15391,1,215,0)
   LA7UTILA         10237097       10662046       **23,27,46,64**
"BLD",15391,1,216,0)
   LA7VHL           4568355        5811383        **27,46,62,64**
"BLD",15391,1,217,0)
   LA7VHLU          4487468        5914870        **46,62,64**
"BLD",15391,1,218,0)
   LA7VHLU1         2323481        3267492        **46,61,64**
"BLD",15391,1,219,0)
   LA7VHLU2         4100825        4356637        **46,61,64**
"BLD",15391,1,220,0)
   LA7VHLU3         2007360        2799232        **46,64**
"BLD",15391,1,221,0)
   LA7VHLU4         5424804        4836094        **46,64**
"BLD",15391,1,222,0)
   LA7VHLU5         5541950        7828952        **46,64**
"BLD",15391,1,223,0)
   LA7VIN1          5261630        5855016        **46,64**
"BLD",15391,1,224,0)
   LA7VIN1A         N/A            13987419       **64**
"BLD",15391,1,225,0)
   LA7VIN2          5808892        8339412        **46,64**
"BLD",15391,1,226,0)
   LA7VIN3          2061956        3081309        **46,64**
"BLD",15391,1,227,0)
   LA7VIN4          7936019        12162627       **46,64**
"BLD",15391,1,228,0)
   LA7VIN5          5205707        10570600       **46,64**
"BLD",15391,1,229,0)
   LA7VIN5A         5039195        8695039        **46,64**
"BLD",15391,1,230,0)
   LA7VLL           5170411        6390054        **27,51,55,64**
"BLD",15391,1,231,0)
   LA7VMSG          3253314        5080421        **27,50,56,46,64**
"BLD",15391,1,232,0)
   LA7VMSG1         8227296        8679432        **56,46,61,64**
"BLD",15391,1,233,0)
   LA7VOBR          2129056        2455598        **46,64**
"BLD",15391,1,234,0)
   LA7VOBRA         5326634        8044290        **46,64**
"BLD",15391,1,235,0)
   LA7VOBX          2088674        2633711        **46,64**
"BLD",15391,1,236,0)
   LA7VOBX1         4057776        4535705        **46,61,63,64**
"BLD",15391,1,237,0)
   LA7VOBX2         4350324        4309250        **46,64**
"BLD",15391,1,238,0)
   LA7VOBX3         5240738        6460347        **46,64**
"BLD",15391,1,239,0)
   LA7VOBXA         6416931        6372995        **46,70,64**
"BLD",15391,1,240,0)
   LA7VORC          1565653        1713732        **46,64**
"BLD",15391,1,241,0)
   LA7VORM          6471896        12116142       **27,42,46,64**
"BLD",15391,1,242,0)
   LA7VORM1         7594289        9199759        **27,51,46,61,64**
"BLD",15391,1,243,0)
   LA7VORM3         6787219        7257153        **46,64**
"BLD",15391,1,244,0)
   LA7VORU          6241961        8366274        **27,46,61,64**
"BLD",15391,1,245,0)
   LA7VORU1         4734718        4842743        **46,64**
"BLD",15391,1,246,0)
   LA7VORU2         1962290        2531397        **46,64**
"BLD",15391,1,247,0)
   LA7VORUA         2199285        2385822        **61,64**
"BLD",15391,1,248,0)
   LA7VPID          4123683        4823699        **46,64**
"BLD",15391,1,249,0)
   LA7VSET          15979413       14514051       **27,51,55,46,64**
"BLD",15391,1,250,0)
   LA7VSET1         9065449        7835525        **27,51,55,46,64**
"BLD",15391,1,251,0)
   LA7VSTP          6079680        4597827        **27,44,51,46,64**
"BLD",15391,1,252,0)
   LA7VSTP1         3317926        3042573        **27,46,64**
"BLD",15391,1,253,0)
   LAGEN            8522786        8715369        **1,17,22,27,47,46,64**
"BLD",15391,1,254,0)
 
"BLD",15391,1,255,0)
 List of preceding patches: 46, 61, 62, 63, 65, 70
"BLD",15391,1,256,0)
 Sites should use CHECK^XTSUMBLD to verify checksums.
"BLD",15391,1,257,0)
 
"BLD",15391,1,258,0)
 
"BLD",15391,1,259,0)
INSTALLATION INSTRUCTIONS
"BLD",15391,1,260,0)
=========================
"BLD",15391,1,261,0)
 
"BLD",15391,1,262,0)
See LABORATORY ELECTRONIC DATA INTERCHANGE III (LEDI III) INSTALLATION GUIDE
"BLD",15391,1,263,0)
    LA*5.2*64/LR*5.2*286
"BLD",15391,4,0)
^9.64PA^62.9^5
"BLD",15391,4,62.4,0)
62.4
"BLD",15391,4,62.4,2,0)
^9.641^62.41^1
"BLD",15391,4,62.4,2,62.41,0)
CHEM TESTS  (sub-file)
"BLD",15391,4,62.4,2,62.41,1,0)
^9.6411^22^1
"BLD",15391,4,62.4,2,62.41,1,22,0)
NOTIFY ABNORMAL FLAGS
"BLD",15391,4,62.4,222)
y^n^p^^^^n^^n
"BLD",15391,4,62.4,224)

"BLD",15391,4,62.485,0)
62.485
"BLD",15391,4,62.485,222)
n^n^f^^n^^y^o^n
"BLD",15391,4,62.485,224)
I Y=28!(Y=46)!(Y=47)!(Y=48)
"BLD",15391,4,62.49,0)
62.49
"BLD",15391,4,62.49,2,0)
^9.641^62.49^2
"BLD",15391,4,62.49,2,62.49,0)
LA7 MESSAGE QUEUE  (File-top level)
"BLD",15391,4,62.49,2,62.49,1,0)
^9.6411^700^1
"BLD",15391,4,62.49,2,62.49,1,700,0)
HL7 ENV
"BLD",15391,4,62.49,2,62.49162,0)
CH SUBSCRIPT  (sub-file)
"BLD",15391,4,62.49,2,62.49162,1,0)
^9.6411^.01^2
"BLD",15391,4,62.49,2,62.49162,1,.01,0)
CH SUBSCRIPT
"BLD",15391,4,62.49,2,62.49162,1,.02,0)
CORRECTED RESULTS
"BLD",15391,4,62.49,222)
y^n^p^^^^n
"BLD",15391,4,62.8,0)
62.8
"BLD",15391,4,62.8,2,0)
^9.641^62.8^2
"BLD",15391,4,62.8,2,62.8,0)
LAB SHIPPING MANIFEST  (File-top level)
"BLD",15391,4,62.8,2,62.8,1,0)
^9.6411^.01^2
"BLD",15391,4,62.8,2,62.8,1,.01,0)
INVOICE
"BLD",15391,4,62.8,2,62.8,1,.06,0)
SPECIMEN CODING SYSTEM
"BLD",15391,4,62.8,2,62.801,0)
SPECIMENS  (sub-file)
"BLD",15391,4,62.8,2,62.801,1,0)
^9.6411^5.9^10
"BLD",15391,4,62.8,2,62.801,1,.1,0)
RELEVANT CLINICAL INFORMATION
"BLD",15391,4,62.8,2,62.801,1,5.1,0)
NON-NLT TEST ORDER CODE
"BLD",15391,4,62.8,2,62.801,1,5.2,0)
NON-NLT TEST ORDER NAME
"BLD",15391,4,62.8,2,62.801,1,5.3,0)
NON-HL7 SPECIMEN CODE
"BLD",15391,4,62.8,2,62.801,1,5.4,0)
NON-HL7 SPECIMEN NAME
"BLD",15391,4,62.8,2,62.801,1,5.5,0)
NON-NLT TEST CODING SYSTEM
"BLD",15391,4,62.8,2,62.801,1,5.6,0)
NON-HL7 SPECIMEN CODING SYSTEM
"BLD",15391,4,62.8,2,62.801,1,5.7,0)
COLLECTION SAMPLE CODE
"BLD",15391,4,62.8,2,62.801,1,5.8,0)
COLLECTION SAMPLE NAME
"BLD",15391,4,62.8,2,62.801,1,5.9,0)
COLLECT SAMPLE SYSTEM
"BLD",15391,4,62.8,222)
y^n^p^^^^n
"BLD",15391,4,62.9,0)
62.9
"BLD",15391,4,62.9,2,0)
^9.641^62.9^2
"BLD",15391,4,62.9,2,62.9,0)
LAB SHIPPING CONFIGURATION  (File-top level)
"BLD",15391,4,62.9,2,62.9,1,0)
^9.6411^.11^3
"BLD",15391,4,62.9,2,62.9,1,.05,0)
COLLECTING FACILITY'S SPEC ID
"BLD",15391,4,62.9,2,62.9,1,.11,0)
OTHER SYSTEM IDENTIFIER
"BLD",15391,4,62.9,2,62.9,1,.15,0)
SPECIMEN CODING SYSTEM
"BLD",15391,4,62.9,2,62.9001,0)
TEST/PROFILE  (sub-file)
"BLD",15391,4,62.9,2,62.9001,1,0)
^9.6411^5.9^9
"BLD",15391,4,62.9,2,62.9001,1,5.1,0)
NON-NLT TEST ORDER CODE
"BLD",15391,4,62.9,2,62.9001,1,5.2,0)
NON-NLT TEST ORDER NAME
"BLD",15391,4,62.9,2,62.9001,1,5.3,0)
NON-HL7 SPECIMEN CODE
"BLD",15391,4,62.9,2,62.9001,1,5.4,0)
NON-HL7 SPECIMEN NAME
"BLD",15391,4,62.9,2,62.9001,1,5.5,0)
NON-NLT TEST CODING SYSTEM
"BLD",15391,4,62.9,2,62.9001,1,5.6,0)
NON-HL7 SPECIMEN CODING SYSTEM
"BLD",15391,4,62.9,2,62.9001,1,5.7,0)
COLLECTION SAMPLE CODE
"BLD",15391,4,62.9,2,62.9001,1,5.8,0)
COLLECTION SAMPLE NAME
"BLD",15391,4,62.9,2,62.9001,1,5.9,0)
COLLECT SAMPLE SYSTEM
"BLD",15391,4,62.9,222)
y^n^p^^^^n
"BLD",15391,4,"APDD",62.4,62.41)

"BLD",15391,4,"APDD",62.4,62.41,22)

"BLD",15391,4,"APDD",62.49,62.49)

"BLD",15391,4,"APDD",62.49,62.49,700)

"BLD",15391,4,"APDD",62.49,62.49162)

"BLD",15391,4,"APDD",62.49,62.49162,.01)

"BLD",15391,4,"APDD",62.49,62.49162,.02)

"BLD",15391,4,"APDD",62.8,62.8)

"BLD",15391,4,"APDD",62.8,62.8,.01)

"BLD",15391,4,"APDD",62.8,62.8,.06)

"BLD",15391,4,"APDD",62.8,62.801)

"BLD",15391,4,"APDD",62.8,62.801,.1)

"BLD",15391,4,"APDD",62.8,62.801,5.1)

"BLD",15391,4,"APDD",62.8,62.801,5.2)

"BLD",15391,4,"APDD",62.8,62.801,5.3)

"BLD",15391,4,"APDD",62.8,62.801,5.4)

"BLD",15391,4,"APDD",62.8,62.801,5.5)

"BLD",15391,4,"APDD",62.8,62.801,5.6)

"BLD",15391,4,"APDD",62.8,62.801,5.7)

"BLD",15391,4,"APDD",62.8,62.801,5.8)

"BLD",15391,4,"APDD",62.8,62.801,5.9)

"BLD",15391,4,"APDD",62.9,62.9)

"BLD",15391,4,"APDD",62.9,62.9,.05)

"BLD",15391,4,"APDD",62.9,62.9,.11)

"BLD",15391,4,"APDD",62.9,62.9,.15)

"BLD",15391,4,"APDD",62.9,62.9001)

"BLD",15391,4,"APDD",62.9,62.9001,5.1)

"BLD",15391,4,"APDD",62.9,62.9001,5.2)

"BLD",15391,4,"APDD",62.9,62.9001,5.3)

"BLD",15391,4,"APDD",62.9,62.9001,5.4)

"BLD",15391,4,"APDD",62.9,62.9001,5.5)

"BLD",15391,4,"APDD",62.9,62.9001,5.6)

"BLD",15391,4,"APDD",62.9,62.9001,5.7)

"BLD",15391,4,"APDD",62.9,62.9001,5.8)

"BLD",15391,4,"APDD",62.9,62.9001,5.9)

"BLD",15391,4,"B",62.4,62.4)

"BLD",15391,4,"B",62.485,62.485)

"BLD",15391,4,"B",62.49,62.49)

"BLD",15391,4,"B",62.8,62.8)

"BLD",15391,4,"B",62.9,62.9)

"BLD",15391,"ABPKG")
n
"BLD",15391,"INI")
PRE^LA64
"BLD",15391,"INID")
y
"BLD",15391,"INIT")
POST^LA64
"BLD",15391,"KRN",0)
^9.67PA^8989.52^19
"BLD",15391,"KRN",.4,0)
.4
"BLD",15391,"KRN",.4,"NM",0)
^9.68A^^
"BLD",15391,"KRN",.401,0)
.401
"BLD",15391,"KRN",.402,0)
.402
"BLD",15391,"KRN",.403,0)
.403
"BLD",15391,"KRN",.5,0)
.5
"BLD",15391,"KRN",.84,0)
.84
"BLD",15391,"KRN",3.6,0)
3.6
"BLD",15391,"KRN",3.6,"NM",0)
^9.68A^4^4
"BLD",15391,"KRN",3.6,"NM",1,0)
LA7 AMENDED RESULTS RECEIVED^^0
"BLD",15391,"KRN",3.6,"NM",2,0)
LA7 ORDER STATUS CHANGED^^0
"BLD",15391,"KRN",3.6,"NM",3,0)
LA7 UNITS/NORMALS CHANGED^^0
"BLD",15391,"KRN",3.6,"NM",4,0)
LA7 ABNORMAL RESULTS RECEIVED^^0
"BLD",15391,"KRN",3.6,"NM","B","LA7 ABNORMAL RESULTS RECEIVED",4)

"BLD",15391,"KRN",3.6,"NM","B","LA7 AMENDED RESULTS RECEIVED",1)

"BLD",15391,"KRN",3.6,"NM","B","LA7 ORDER STATUS CHANGED",2)

"BLD",15391,"KRN",3.6,"NM","B","LA7 UNITS/NORMALS CHANGED",3)

"BLD",15391,"KRN",3.8,0)
3.8
"BLD",15391,"KRN",9.2,0)
9.2
"BLD",15391,"KRN",9.8,0)
9.8
"BLD",15391,"KRN",9.8,"NM",0)
^9.68A^52^52
"BLD",15391,"KRN",9.8,"NM",1,0)
LA7SMP0^^0^B48779053
"BLD",15391,"KRN",9.8,"NM",2,0)
LA7SMP^^0^B61468752
"BLD",15391,"KRN",9.8,"NM",3,0)
LA7SMPXL^^0^B17436315
"BLD",15391,"KRN",9.8,"NM",4,0)
LA7SMU2^^0^B29210137
"BLD",15391,"KRN",9.8,"NM",5,0)
LA7UTILA^^0^B48089182
"BLD",15391,"KRN",9.8,"NM",6,0)
LA7VHLU2^^0^B19775199
"BLD",15391,"KRN",9.8,"NM",7,0)
LA7VHLU5^^0^B40473983
"BLD",15391,"KRN",9.8,"NM",8,0)
LA7VIN2^^0^B65721794
"BLD",15391,"KRN",9.8,"NM",9,0)
LA7VIN5^^0^B52231590
"BLD",15391,"KRN",9.8,"NM",10,0)
LA7VMSG^^0^B23236199
"BLD",15391,"KRN",9.8,"NM",11,0)
LA7VMSG1^^0^B51506932
"BLD",15391,"KRN",9.8,"NM",12,0)
LA7VOBRA^^0^B37451712
"BLD",15391,"KRN",9.8,"NM",13,0)
LA7VOBR^^0^B23749256
"BLD",15391,"KRN",9.8,"NM",14,0)
LA7VOBX^^0^B25091305
"BLD",15391,"KRN",9.8,"NM",15,0)
LA7VOBX1^^0^B15767833
"BLD",15391,"KRN",9.8,"NM",16,0)
LA7VOBX2^^0^B15453740
"BLD",15391,"KRN",9.8,"NM",17,0)
LA7VOBX3^^0^B33632644
"BLD",15391,"KRN",9.8,"NM",18,0)
LA7VORC^^0^B8007778
"BLD",15391,"KRN",9.8,"NM",19,0)
LA7VORM^^0^B68105004
"BLD",15391,"KRN",9.8,"NM",20,0)
LA7VORM1^^0^B52156055
"BLD",15391,"KRN",9.8,"NM",21,0)
LA7VORM3^^0^B19868669
"BLD",15391,"KRN",9.8,"NM",22,0)
LA7VORU^^0^B57638796
"BLD",15391,"KRN",9.8,"NM",23,0)
LA7VORU1^^0^B35283793
"BLD",15391,"KRN",9.8,"NM",24,0)
LA7VORU2^^0^B6677596
"BLD",15391,"KRN",9.8,"NM",25,0)
LA7VORUA^^0^B8112587
"BLD",15391,"KRN",9.8,"NM",26,0)
LA7SRR^^0^B27494992
"BLD",15391,"KRN",9.8,"NM",27,0)
LA7VSTP^^0^B33029654
"BLD",15391,"KRN",9.8,"NM",28,0)
LA7VSET^^0^B99076533
"BLD",15391,"KRN",9.8,"NM",29,0)
LA7VSET1^^0^B33313694
"BLD",15391,"KRN",9.8,"NM",30,0)
LA7VIN1^^0^B40551903
"BLD",15391,"KRN",9.8,"NM",31,0)
LA7SMB^^0^B76474433
"BLD",15391,"KRN",9.8,"NM",32,0)
LA7VIN5A^^0^B56260928
"BLD",15391,"KRN",9.8,"NM",33,0)
LA7VHLU^^0^B42350744
"BLD",15391,"KRN",9.8,"NM",34,0)
LA7VHLU3^^0^B15291257
"BLD",15391,"KRN",9.8,"NM",35,0)
LA7SMU^^0^B43475390
"BLD",15391,"KRN",9.8,"NM",36,0)
LA7VHL^^0^B24721166
"BLD",15391,"KRN",9.8,"NM",37,0)
LA7VIN4^^0^B71418151
"BLD",15391,"KRN",9.8,"NM",38,0)
LA7VPID^^0^B23557446
"BLD",15391,"KRN",9.8,"NM",39,0)
LA7VLL^^0^B25802019
"BLD",15391,"KRN",9.8,"NM",40,0)
LA7VSTP1^^0^B6778720
"BLD",15391,"KRN",9.8,"NM",41,0)
LA7SMU1^^0^B18357820
"BLD",15391,"KRN",9.8,"NM",42,0)
LA7VIN1A^^0^B57089766
"BLD",15391,"KRN",9.8,"NM",43,0)
LA7VHLU1^^0^B17496162
"BLD",15391,"KRN",9.8,"NM",44,0)
LA7SM2^^0^B71701384
"BLD",15391,"KRN",9.8,"NM",45,0)
LA7VHLU4^^0^B25336667
"BLD",15391,"KRN",9.8,"NM",46,0)
LA7SCE^^0^B59304536
"BLD",15391,"KRN",9.8,"NM",47,0)
LA7PURG^^0^B15026953
"BLD",15391,"KRN",9.8,"NM",48,0)
LA7VOBXA^^0^B31676928
"BLD",15391,"KRN",9.8,"NM",49,0)
LAGEN^^0^B37863247
"BLD",15391,"KRN",9.8,"NM",50,0)
LA7VIN3^^0^B9589401
"BLD",15391,"KRN",9.8,"NM",51,0)
LA7SBCR1^^0^B36886840
"BLD",15391,"KRN",9.8,"NM",52,0)
LA7SBCR2^^0^B11631994
"BLD",15391,"KRN",9.8,"NM","B","LA7PURG",47)

"BLD",15391,"KRN",9.8,"NM","B","LA7SBCR1",51)

"BLD",15391,"KRN",9.8,"NM","B","LA7SBCR2",52)

"BLD",15391,"KRN",9.8,"NM","B","LA7SCE",46)

"BLD",15391,"KRN",9.8,"NM","B","LA7SM2",44)

"BLD",15391,"KRN",9.8,"NM","B","LA7SMB",31)

"BLD",15391,"KRN",9.8,"NM","B","LA7SMP",2)

"BLD",15391,"KRN",9.8,"NM","B","LA7SMP0",1)

"BLD",15391,"KRN",9.8,"NM","B","LA7SMPXL",3)

"BLD",15391,"KRN",9.8,"NM","B","LA7SMU",35)

"BLD",15391,"KRN",9.8,"NM","B","LA7SMU1",41)

"BLD",15391,"KRN",9.8,"NM","B","LA7SMU2",4)

"BLD",15391,"KRN",9.8,"NM","B","LA7SRR",26)

"BLD",15391,"KRN",9.8,"NM","B","LA7UTILA",5)

"BLD",15391,"KRN",9.8,"NM","B","LA7VHL",36)

"BLD",15391,"KRN",9.8,"NM","B","LA7VHLU",33)

"BLD",15391,"KRN",9.8,"NM","B","LA7VHLU1",43)

"BLD",15391,"KRN",9.8,"NM","B","LA7VHLU2",6)

"BLD",15391,"KRN",9.8,"NM","B","LA7VHLU3",34)

"BLD",15391,"KRN",9.8,"NM","B","LA7VHLU4",45)

"BLD",15391,"KRN",9.8,"NM","B","LA7VHLU5",7)

"BLD",15391,"KRN",9.8,"NM","B","LA7VIN1",30)

"BLD",15391,"KRN",9.8,"NM","B","LA7VIN1A",42)

"BLD",15391,"KRN",9.8,"NM","B","LA7VIN2",8)

"BLD",15391,"KRN",9.8,"NM","B","LA7VIN3",50)

"BLD",15391,"KRN",9.8,"NM","B","LA7VIN4",37)

"BLD",15391,"KRN",9.8,"NM","B","LA7VIN5",9)

"BLD",15391,"KRN",9.8,"NM","B","LA7VIN5A",32)

"BLD",15391,"KRN",9.8,"NM","B","LA7VLL",39)

"BLD",15391,"KRN",9.8,"NM","B","LA7VMSG",10)

"BLD",15391,"KRN",9.8,"NM","B","LA7VMSG1",11)

"BLD",15391,"KRN",9.8,"NM","B","LA7VOBR",13)

"BLD",15391,"KRN",9.8,"NM","B","LA7VOBRA",12)

"BLD",15391,"KRN",9.8,"NM","B","LA7VOBX",14)

"BLD",15391,"KRN",9.8,"NM","B","LA7VOBX1",15)

"BLD",15391,"KRN",9.8,"NM","B","LA7VOBX2",16)

"BLD",15391,"KRN",9.8,"NM","B","LA7VOBX3",17)

"BLD",15391,"KRN",9.8,"NM","B","LA7VOBXA",48)

"BLD",15391,"KRN",9.8,"NM","B","LA7VORC",18)

"BLD",15391,"KRN",9.8,"NM","B","LA7VORM",19)

"BLD",15391,"KRN",9.8,"NM","B","LA7VORM1",20)

"BLD",15391,"KRN",9.8,"NM","B","LA7VORM3",21)

"BLD",15391,"KRN",9.8,"NM","B","LA7VORU",22)

"BLD",15391,"KRN",9.8,"NM","B","LA7VORU1",23)

"BLD",15391,"KRN",9.8,"NM","B","LA7VORU2",24)

"BLD",15391,"KRN",9.8,"NM","B","LA7VORUA",25)

"BLD",15391,"KRN",9.8,"NM","B","LA7VPID",38)

"BLD",15391,"KRN",9.8,"NM","B","LA7VSET",28)

"BLD",15391,"KRN",9.8,"NM","B","LA7VSET1",29)

"BLD",15391,"KRN",9.8,"NM","B","LA7VSTP",27)

"BLD",15391,"KRN",9.8,"NM","B","LA7VSTP1",40)

"BLD",15391,"KRN",9.8,"NM","B","LAGEN",49)

"BLD",15391,"KRN",19,0)
19
"BLD",15391,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",15391,"KRN",19,"NM",1,0)
LA7S MANIFEST START^^0
"BLD",15391,"KRN",19,"NM",2,0)
LA7S MAIN MENU^^2
"BLD",15391,"KRN",19,"NM",3,0)
LA7S MANIFEST CLINICAL INFO^^0
"BLD",15391,"KRN",19,"NM",4,0)
LA7TASK NIGHTY^^0
"BLD",15391,"KRN",19,"NM","B","LA7S MAIN MENU",2)

"BLD",15391,"KRN",19,"NM","B","LA7S MANIFEST CLINICAL INFO",3)

"BLD",15391,"KRN",19,"NM","B","LA7S MANIFEST START",1)

"BLD",15391,"KRN",19,"NM","B","LA7TASK NIGHTY",4)

"BLD",15391,"KRN",19.1,0)
19.1
"BLD",15391,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",15391,"KRN",101,0)
101
"BLD",15391,"KRN",409.61,0)
409.61
"BLD",15391,"KRN",771,0)
771
"BLD",15391,"KRN",870,0)
870
"BLD",15391,"KRN",8989.51,0)
8989.51
"BLD",15391,"KRN",8989.52,0)
8989.52
"BLD",15391,"KRN",8994,0)
8994
"BLD",15391,"KRN","B",.4,.4)

"BLD",15391,"KRN","B",.401,.401)

"BLD",15391,"KRN","B",.402,.402)

"BLD",15391,"KRN","B",.403,.403)

"BLD",15391,"KRN","B",.5,.5)

"BLD",15391,"KRN","B",.84,.84)

"BLD",15391,"KRN","B",3.6,3.6)

"BLD",15391,"KRN","B",3.8,3.8)

"BLD",15391,"KRN","B",9.2,9.2)

"BLD",15391,"KRN","B",9.8,9.8)

"BLD",15391,"KRN","B",19,19)

"BLD",15391,"KRN","B",19.1,19.1)

"BLD",15391,"KRN","B",101,101)

"BLD",15391,"KRN","B",409.61,409.61)

"BLD",15391,"KRN","B",771,771)

"BLD",15391,"KRN","B",870,870)

"BLD",15391,"KRN","B",8989.51,8989.51)

"BLD",15391,"KRN","B",8989.52,8989.52)

"BLD",15391,"KRN","B",8994,8994)

"BLD",15391,"PRE")
LA64
"BLD",15391,"QUES",0)
^9.62^^
"BLD",15391,"REQB",0)
^9.611^9^8
"BLD",15391,"REQB",2,0)
LA*5.2*63^2
"BLD",15391,"REQB",3,0)
HL*1.6*101^2
"BLD",15391,"REQB",4,0)
LA*5.2*65^2
"BLD",15391,"REQB",5,0)
LA*5.2*62^2
"BLD",15391,"REQB",6,0)
LA*5.2*61^2
"BLD",15391,"REQB",7,0)
XU*8.0*261^2
"BLD",15391,"REQB",8,0)
HL*1.6*108^2
"BLD",15391,"REQB",9,0)
LA*5.2*70^2
"BLD",15391,"REQB","B","HL*1.6*101",3)

"BLD",15391,"REQB","B","HL*1.6*108",8)

"BLD",15391,"REQB","B","LA*5.2*61",6)

"BLD",15391,"REQB","B","LA*5.2*62",5)

"BLD",15391,"REQB","B","LA*5.2*63",2)

"BLD",15391,"REQB","B","LA*5.2*65",4)

"BLD",15391,"REQB","B","LA*5.2*70",9)

"BLD",15391,"REQB","B","XU*8.0*261",7)

"DATA",62.485,28,0)
28^Msg # |1| encountered the following HL7 generation error: |2|.^1
"DATA",62.485,28,1)
S LA7TXT(1)=$G(LA7X(1)),LA7TXT(2)=$G(LA7X(2))
"DATA",62.485,46,0)
46^Msg # |1|, 'PID' segment was not found, message processing aborted.^1
"DATA",62.485,46,1)
S LA7TXT(1)=LA76249
"DATA",62.485,47,0)
47^Msg # |1| - the |2| order for |3| has |4|^1
"DATA",62.485,47,1)
S LA7TXT(1)=$G(LA76249),LA7TXT(2)=$G(LA7OTST),LA7TXT(3)=$G(LA7PNM),LA7TXT(4)=$G(LA7X)
"DATA",62.485,48,0)
48^Message #|1| was rejected because |2|^1
"DATA",62.485,48,1)
S LA7TXT(1)=LA76249,LA7TXT(2)=$G(LA7MSATM)
"FIA",62.4)
AUTO INSTRUMENT
"FIA",62.4,0)
^LAB(62.4,
"FIA",62.4,0,0)
62.4
"FIA",62.4,0,1)
y^n^p^^^^n^^n
"FIA",62.4,0,10)

"FIA",62.4,0,11)

"FIA",62.4,0,"RLRO")

"FIA",62.4,0,"VR")
5.2^LA
"FIA",62.4,62.4)
1
"FIA",62.4,62.41)
1
"FIA",62.4,62.41,22)

"FIA",62.485)
LA7 MESSAGE LOG BULLETINS
"FIA",62.485,0)
^LAHM(62.485,
"FIA",62.485,0,0)
62.485
"FIA",62.485,0,1)
n^n^f^^n^^y^o^n
"FIA",62.485,0,10)

"FIA",62.485,0,11)
I Y=28!(Y=46)!(Y=47)!(Y=48)
"FIA",62.485,0,"RLRO")

"FIA",62.485,0,"VR")
5.2^LA
"FIA",62.485,62.485)
0
"FIA",62.49)
LA7 MESSAGE QUEUE
"FIA",62.49,0)
^LAHM(62.49,
"FIA",62.49,0,0)
62.49
"FIA",62.49,0,1)
y^n^p^^^^n
"FIA",62.49,0,10)

"FIA",62.49,0,11)

"FIA",62.49,0,"RLRO")

"FIA",62.49,0,"VR")
5.2^LA
"FIA",62.49,62.49)
1
"FIA",62.49,62.49,162)

"FIA",62.49,62.49,700)

"FIA",62.49,62.49162)
1
"FIA",62.49,62.49162,.01)

"FIA",62.49,62.49162,.02)

"FIA",62.8)
LAB SHIPPING MANIFEST
"FIA",62.8,0)
^LAHM(62.8,
"FIA",62.8,0,0)
62.8A
"FIA",62.8,0,1)
y^n^p^^^^n
"FIA",62.8,0,10)

"FIA",62.8,0,11)

"FIA",62.8,0,"RLRO")

"FIA",62.8,0,"VR")
5.2^LA
"FIA",62.8,62.8)
1
"FIA",62.8,62.8,.01)

"FIA",62.8,62.8,.06)

"FIA",62.8,62.801)
1
"FIA",62.8,62.801,.1)

"FIA",62.8,62.801,5.1)

"FIA",62.8,62.801,5.2)

"FIA",62.8,62.801,5.3)

"FIA",62.8,62.801,5.4)

"FIA",62.8,62.801,5.5)

"FIA",62.8,62.801,5.6)

"FIA",62.8,62.801,5.7)

"FIA",62.8,62.801,5.8)

"FIA",62.8,62.801,5.9)

"FIA",62.9)
LAB SHIPPING CONFIGURATION
"FIA",62.9,0)
^LAHM(62.9,
"FIA",62.9,0,0)
62.9
"FIA",62.9,0,1)
y^n^p^^^^n
"FIA",62.9,0,10)

"FIA",62.9,0,11)

"FIA",62.9,0,"RLRO")

"FIA",62.9,0,"VR")
5.2^LA
"FIA",62.9,62.9)
1
"FIA",62.9,62.9,.05)

"FIA",62.9,62.9,.11)

"FIA",62.9,62.9,.15)

"FIA",62.9,62.9001)
1
"FIA",62.9,62.9001,5.1)

"FIA",62.9,62.9001,5.2)

"FIA",62.9,62.9001,5.3)

"FIA",62.9,62.9001,5.4)

"FIA",62.9,62.9001,5.5)

"FIA",62.9,62.9001,5.6)

"FIA",62.9,62.9001,5.7)

"FIA",62.9,62.9001,5.8)

"FIA",62.9,62.9001,5.9)

"INI")
PRE^LA64
"INIT")
POST^LA64
"IX",62.8,62.8,"C",0)
62.8^C^Reverse x-ref for shipping manifest invoice^R^^F^IR^I^62.8^^^^^LS
"IX",62.8,62.8,"C",1)
S ^LAHM(62.8,"C",$E(X,1,30),DA)=""
"IX",62.8,62.8,"C",2)
K ^LAHM(62.8,"C",$E(X,1,30),DA)
"IX",62.8,62.8,"C",2.5)
K ^LAHM(62.8,"C")
"IX",62.8,62.8,"C",11.1,0)
^.114IA^1^1
"IX",62.8,62.8,"C",11.1,1,0)
1^F^62.8^.01^30^1^B
"IX",62.8,62.8,"C",11.1,1,3)

"KRN",3.6,179,-1)
0^1
"KRN",3.6,179,0)
LA7 AMENDED RESULTS RECEIVED^LAB AMENDED RESULTS RECEIVED
"KRN",3.6,179,1,0)
^3.61A^28^28^3030725^^^^
"KRN",3.6,179,1,1,0)
Laboratory results on the following patient have been received via a HL7
"KRN",3.6,179,1,2,0)
interface that indicate the results have been amended. Please use the
"KRN",3.6,179,1,3,0)
appropriate laboratory option to amend these results on this system.
"KRN",3.6,179,1,4,0)
 
"KRN",3.6,179,1,5,0)
  
"KRN",3.6,179,1,6,0)
 Action: |14|
"KRN",3.6,179,1,7,0)
 
"KRN",3.6,179,1,8,0)
 
"KRN",3.6,179,1,9,0)
      Interface: |1|
"KRN",3.6,179,1,10,0)
    File #62.49: |2|
"KRN",3.6,179,1,11,0)
 
"KRN",3.6,179,1,12,0)
   Patient Name: |3|
"KRN",3.6,179,1,13,0)
     Patient ID: |4|
"KRN",3.6,179,1,14,0)
 
"KRN",3.6,179,1,15,0)
    Specimen ID: |5|
"KRN",3.6,179,1,16,0)
 Collection D/T: |6|
"KRN",3.6,179,1,17,0)
   Test/analyte: |7|
"KRN",3.6,179,1,18,0)
       Producer: |8|
"KRN",3.6,179,1,19,0)
  Producer's ID: |9|
"KRN",3.6,179,1,20,0)
                  
"KRN",3.6,179,1,21,0)
 
"KRN",3.6,179,1,22,0)
     Observation
"KRN",3.6,179,1,23,0)
     -----------
"KRN",3.6,179,1,24,0)
          Value: |10|
"KRN",3.6,179,1,25,0)
          Units: |11|
"KRN",3.6,179,1,26,0)
      Ref range: |12|
"KRN",3.6,179,1,27,0)
          Flags: |13|
"KRN",3.6,179,1,28,0)
 
"KRN",3.6,179,3,0)
^3.63^3^3^3030725^^^^
"KRN",3.6,179,3,1,0)
Mail bulletin created by Laboratory package when processing a LEDI
"KRN",3.6,179,3,2,0)
interface type HL7 result (ORU) message which contains laboratory
"KRN",3.6,179,3,3,0)
testing results that are flagged as amended.
"KRN",3.6,180,-1)
0^2
"KRN",3.6,180,0)
LA7 ORDER STATUS CHANGED^LAB ORDER STATUS CHANGED
"KRN",3.6,180,1,0)
^3.61A^20^20^3030725^^^^
"KRN",3.6,180,1,1,0)
An order status change has been received for a patient via a HL7 interface
"KRN",3.6,180,1,2,0)
that indicates the order has been changed. Please use the appropriate
"KRN",3.6,180,1,3,0)
laboratory option to update this order on this system.
"KRN",3.6,180,1,4,0)
 
"KRN",3.6,180,1,5,0)
  
"KRN",3.6,180,1,6,0)
 Action: |1|
"KRN",3.6,180,1,7,0)
 
"KRN",3.6,180,1,8,0)
 
"KRN",3.6,180,1,9,0)
      Interface: |2|
"KRN",3.6,180,1,10,0)
    File #62.49: |3|
"KRN",3.6,180,1,11,0)
 
"KRN",3.6,180,1,12,0)
   Patient Name: |4|
"KRN",3.6,180,1,13,0)
     Patient ID: |5|
"KRN",3.6,180,1,14,0)
 
"KRN",3.6,180,1,15,0)
    Specimen ID: |6|
"KRN",3.6,180,1,16,0)
 Collection D/T: |7|
"KRN",3.6,180,1,17,0)
   Test/analyte: |8|
"KRN",3.6,180,1,18,0)
  Producer's ID: |9|
"KRN",3.6,180,1,19,0)
       Manifest: |10|
"KRN",3.6,180,1,20,0)
                  
"KRN",3.6,180,3,0)
^3.63^9^9^3040322^^^^
"KRN",3.6,180,3,1,0)
Mail bulletin created by Laboratory package when processing a LEDI
"KRN",3.6,180,3,2,0)
interface type HL7 message.
"KRN",3.6,180,3,3,0)
 
"KRN",3.6,180,3,4,0)
If an order acknowledgment (ORR) message which contains laboratory test
"KRN",3.6,180,3,5,0)
order status changes that indicate the order is not correct or cannot
"KRN",3.6,180,3,6,0)
be performed/completed.
"KRN",3.6,180,3,7,0)
 
"KRN",3.6,180,3,8,0)
If an order result (ORU) message and it indicates that a laboratory
"KRN",3.6,180,3,9,0)
test has been added by the reference laboratory to the original order.
"KRN",3.6,185,-1)
0^3
"KRN",3.6,185,0)
LA7 UNITS/NORMALS CHANGED^REFERENCE LAB UNITS/NORMALS CHANGED
"KRN",3.6,185,1,0)
1^3.61A^24^24^3030725^^^^
"KRN",3.6,185,1,1,0)
Laboratory results on the following patient have been received via a HL7
"KRN",3.6,185,1,2,0)
interface that indicate the results have units and/or normals different
"KRN",3.6,185,1,3,0)
from those specified in the LABORATORY TEST file (#60). Please use the
"KRN",3.6,185,1,4,0)
appropriate laboratory option to review these units/normals on this system.
"KRN",3.6,185,1,5,0)
 
"KRN",3.6,185,1,6,0)
 
"KRN",3.6,185,1,7,0)
       Interface: |1|
"KRN",3.6,185,1,8,0)
     File #62.49: |2|
"KRN",3.6,185,1,9,0)
 
"KRN",3.6,185,1,10,0)
    Patient Name: |3|
"KRN",3.6,185,1,11,0)
      Patient ID: |4|
"KRN",3.6,185,1,12,0)
 
"KRN",3.6,185,1,13,0)
     Specimen ID: |5|
"KRN",3.6,185,1,14,0)
  Collection D/T: |6|
"KRN",3.6,185,1,15,0)
    Test/analyte: |7|
"KRN",3.6,185,1,16,0)
        Producer: |8|
"KRN",3.6,185,1,17,0)
   Producer's ID: |9|
"KRN",3.6,185,1,18,0)
        File #60: |10|
"KRN",3.6,185,1,19,0)
 
"KRN",3.6,185,1,20,0)
 
"KRN",3.6,185,1,21,0)
      Observation
"KRN",3.6,185,1,22,0)
      -----------
"KRN",3.6,185,1,23,0)
           Units: |11|
"KRN",3.6,185,1,24,0)
       Ref range: |12|
"KRN",3.6,185,3,0)
^3.63^5^5^3030725^^^^
"KRN",3.6,185,3,1,0)
Mail bulletin created by Laboratory package when processing a LEDI
"KRN",3.6,185,3,2,0)
interface type HL7 result (ORU) message which contains laboratory
"KRN",3.6,185,3,3,0)
test result units and/or normals different from values specified for
"KRN",3.6,185,3,4,0)
test in LABORATORY TEST file (#60) and which are flagged to be used
"KRN",3.6,185,3,5,0)
for reference testing purposes.
"KRN",3.6,185,4,0)
^3.64A^^0
"KRN",3.6,186,-1)
0^4
"KRN",3.6,186,0)
LA7 ABNORMAL RESULTS RECEIVED^LAB ABNORMAL/CRITICAL RESULTS RECEIVED
"KRN",3.6,186,1,0)
^3.61A^24^24^3030725^^^^
"KRN",3.6,186,1,1,0)
Laboratory results on the following patient have been received via a HL7
"KRN",3.6,186,1,2,0)
interface that indicate the results are critical or abnormal. Please use
"KRN",3.6,186,1,3,0)
the appropriate laboratory option to review these results on this system.
"KRN",3.6,186,1,4,0)
 
"KRN",3.6,186,1,5,0)
  
"KRN",3.6,186,1,6,0)
      Interface: |1|
"KRN",3.6,186,1,7,0)
    File #62.49: |2|
"KRN",3.6,186,1,8,0)
 
"KRN",3.6,186,1,9,0)
   Patient Name: |3|
"KRN",3.6,186,1,10,0)
     Patient ID: |4|
"KRN",3.6,186,1,11,0)
 
"KRN",3.6,186,1,12,0)
    Specimen ID: |5|
"KRN",3.6,186,1,13,0)
 Collection D/T: |6|
"KRN",3.6,186,1,14,0)
   Test/analyte: |7|
"KRN",3.6,186,1,15,0)
       Producer: |8|
"KRN",3.6,186,1,16,0)
  Producer's ID: |9|
"KRN",3.6,186,1,17,0)
                  
"KRN",3.6,186,1,18,0)
 
"KRN",3.6,186,1,19,0)
     Observation
"KRN",3.6,186,1,20,0)
     -----------
"KRN",3.6,186,1,21,0)
          Value: |10|
"KRN",3.6,186,1,22,0)
          Units: |11|
"KRN",3.6,186,1,23,0)
      Ref range: |12|
"KRN",3.6,186,1,24,0)
          Flags: |13|
"KRN",3.6,186,3,0)
^3.63^7^7^3040322^^^^
"KRN",3.6,186,3,1,0)
Mail bulletin created by Laboratory package when processing a LEDI
"KRN",3.6,186,3,2,0)
interface type HL7 result (ORU) message which contains laboratory
"KRN",3.6,186,3,3,0)
testing results that are flagged as critical or abnormal.  Values
"KRN",3.6,186,3,4,0)
that are critical will always trigger the alert and bulletin. Values
"KRN",3.6,186,3,5,0)
that are abnormal low or high will be triggered when site has flagged
"KRN",3.6,186,3,6,0)
the corresponding test in AUTO INSTRUMENT file (#62.4), NOTIFY ABNORMAL
"KRN",3.6,186,3,7,0)
FLAGS field (#22) within the CHEM TEST multiple (#30) for the interface.
"KRN",19,11527,-1)
2^2
"KRN",19,11527,0)
LA7S MAIN MENU^Lab Shipping Menu^^M^178^^^^^^^53
"KRN",19,11527,10,0)
^19.01IP^14^14
"KRN",19,11527,10,13,0)
2067643062^SSM^10
"KRN",19,11527,10,13,"^")
LA7S MANIFEST START
"KRN",19,11527,10,14,0)
2067643119^SMI^28
"KRN",19,11527,10,14,"^")
LA7S MANIFEST CLINICAL INFO
"KRN",19,11527,"U")
LAB SHIPPING MENU
"KRN",19,11530,-1)
0^4
"KRN",19,11530,0)
LA7TASK NIGHTY^Lab Messaging Nightly Cleanup^^R^^^^^^^^AUTOMATED LAB INSTRUMENTS
"KRN",19,11530,1,0)
^19.06^47^47^3040423^^^^
"KRN",19,11530,1,1,0)
This is a tasked option to check integrity of LA7 MESSAGE QUEUE file
"KRN",19,11530,1,2,0)
(#62.49) and purge messages that are eligible for purging. It also purges
"KRN",19,11530,1,3,0)
the following files related to LEDI - SHIPPING MANIFEST (#62.8), LAB
"KRN",19,11530,1,4,0)
SHIPPING EVENT (#62.85) and LAB PENDING ORDERS ENTRY (#69.6)
"KRN",19,11530,1,5,0)
 
"KRN",19,11530,1,6,0)
This option should be tasked daily, preferably during period when activity
"KRN",19,11530,1,7,0)
in the Lab Messaging (i.e. Universal Interface, LEDI) package is at a
"KRN",19,11530,1,8,0)
minimum.
"KRN",19,11530,1,9,0)
 
"KRN",19,11530,1,10,0)
Prior to the purge of LA7 MESSAGE QUEUE file (#62.49), an integrity check is
"KRN",19,11530,1,11,0)
performed. The integrity check can be run with a couple of switches.
"KRN",19,11530,1,12,0)
 
"KRN",19,11530,1,13,0)
   LA7FIX = 0 - do not fix errors
"KRN",19,11530,1,14,0)
            1 - do fix errors
"KRN",19,11530,1,15,0)
 
"KRN",19,11530,1,16,0)
   LA7LOG = 0 - do not log errors in XTMP global.
"KRN",19,11530,1,17,0)
            1 - do log errors in XTMP global
"KRN",19,11530,1,18,0)
 
"KRN",19,11530,1,19,0)
   LA7ION = name of device to print error report if set to
"KRN",19,11530,1,20,0)
            log errors (LA7LOG=1).
"KRN",19,11530,1,21,0)
 
"KRN",19,11530,1,22,0)
 
"KRN",19,11530,1,23,0)
These parameters can be setup by TaskMan if the site defines them when
"KRN",19,11530,1,24,0)
scheduling the task. 
"KRN",19,11530,1,25,0)

"KRN",19,11530,1,26,0)
An example is given below:
"KRN",19,11530,1,27,0)

"KRN",19,11530,1,28,0)
                        Edit Option Schedule
"KRN",19,11530,1,29,0)
    Option Name: LA7TASK NIGHTY
"KRN",19,11530,1,30,0)
    _____________________________________________________________________
"KRN",19,11530,1,31,0)
 
"KRN",19,11530,1,32,0)
 
"KRN",19,11530,1,33,0)
 
"KRN",19,11530,1,34,0)
 
"KRN",19,11530,1,35,0)
    VARIABLE NAME: LA7FIX                   VALUE: 0
"KRN",19,11530,1,36,0)
    VARIABLE NAME: LA7ION                   VALUE: "IRM DEVELOP LASER1"
"KRN",19,11530,1,37,0)
    VARIABLE NAME: LA7LOG                   VALUE: 1
"KRN",19,11530,1,38,0)
 
"KRN",19,11530,1,39,0)
 
"KRN",19,11530,1,40,0)
If errors are found, an alert is sent to members of the mail group
"KRN",19,11530,1,41,0)
"LAB MESSAGING" notifying them that errors were detected. If logging of
"KRN",19,11530,1,42,0)
errors occurred then alert recipients will be able to print/view error log
"KRN",19,11530,1,43,0)
from the alert system. Alternatively the error report can be printed using
"KRN",19,11530,1,44,0)
option Print Lab Messaging Integrity Check [LA7 PRINT INTEGRITY CHECK].
"KRN",19,11530,1,45,0)
 
"KRN",19,11530,1,46,0)
The integrity report can be run alone using option Lab Messaging File
"KRN",19,11530,1,47,0)
Integrity Checker [LA7 CHECK FILES].
"KRN",19,11530,2)
y
"KRN",19,11530,25)
EN^LA7PURG
"KRN",19,11530,200.9)
y
"KRN",19,11530,"U")
LAB MESSAGING NIGHTLY CLEANUP
"KRN",19,2067643062,-1)
0^1
"KRN",19,2067643062,0)
LA7S MANIFEST START^Start a Shipping Manifest^^R^^^^^^^^AUTOMATED LAB INSTRUMENTS
"KRN",19,2067643062,1,0)
^^2^2^3020903^
"KRN",19,2067643062,1,1,0)
Option to create or start a shipping manifest without performing the 
"KRN",19,2067643062,1,2,0)
building of the manifest.
"KRN",19,2067643062,25)
SMONLY^LA7SMB
"KRN",19,2067643062,"U")
START A SHIPPING MANIFEST
"KRN",19,2067643119,-1)
0^3
"KRN",19,2067643119,0)
LA7S MANIFEST CLINICAL INFO^Edit Relevant Clinical Information^^R^^^^^^^^AUTOMATED LAB INSTRUMENTS
"KRN",19,2067643119,1,0)
^19.06^7^7^3030122^^^^
"KRN",19,2067643119,1,1,0)
This option allows a user to enter/edit relevant clinical information
"KRN",19,2067643119,1,2,0)
that should be sent with a test when it is shipped.
"KRN",19,2067643119,1,3,0)

"KRN",19,2067643119,1,4,0)
Examples include reporting the amount of inspired carbon dioxide for
"KRN",19,2067643119,1,5,0)
blood gasses, the point in the menstrual cycle for cervical pap tests,
"KRN",19,2067643119,1,6,0)
and other conditions that influence test interpretations. Peak and
"KRN",19,2067643119,1,7,0)
trough times for antibiotic and therapeutic drug levels.
"KRN",19,2067643119,25)
RCI^LA7SM2
"KRN",19,2067643119,"U")
EDIT RELEVANT CLINICAL INFORMA
"MBREQ")
0
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",53,-1)
1^1
"PKG",53,0)
AUTOMATED LAB INSTRUMENTS^LA^Lab Auto-Instrument Package
"PKG",53,20,0)
^9.402P^^
"PKG",53,22,0)
^9.49I^1^1
"PKG",53,22,1,0)
5.2^2940927^2950125
"PKG",53,22,1,"PAH",1,0)
64^3041112^235
"PKG",53,22,1,"PAH",1,1,0)
^^263^263^3041112
"PKG",53,22,1,"PAH",1,1,1,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LA*5.2*64 does not
"PKG",53,22,1,"PAH",1,1,2,0)
contain any changes to the VISTA BLOOD BANK Software as defined by VHA
"PKG",53,22,1,"PAH",1,1,3,0)
DIRECTIVE 99-053 titled VISTA BLOOD BANK SOFTWARE VERSION 5.2.
"PKG",53,22,1,"PAH",1,1,4,0)

"PKG",53,22,1,"PAH",1,1,5,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LA*5.2*64 does not
"PKG",53,22,1,"PAH",1,1,6,0)
alter or modify any software design safeguards or safety critical elements
"PKG",53,22,1,"PAH",1,1,7,0)
functions.
"PKG",53,22,1,"PAH",1,1,8,0)

"PKG",53,22,1,"PAH",1,1,9,0)
RISK ANALYSIS: Changes made by patch LA*5.2*64 have no effect on Blood Bank
"PKG",53,22,1,"PAH",1,1,10,0)
software functionality, therefore RISK is none.
"PKG",53,22,1,"PAH",1,1,11,0)

"PKG",53,22,1,"PAH",1,1,12,0)
VALIDATION REQUIREMENTS BY OPTION:  Because of the nature of the changes
"PKG",53,22,1,"PAH",1,1,13,0)
made, no specific validation requirements exist as a result of installation
"PKG",53,22,1,"PAH",1,1,14,0)
of this patch.
"PKG",53,22,1,"PAH",1,1,15,0)

"PKG",53,22,1,"PAH",1,1,16,0)
=======================================================================
"PKG",53,22,1,"PAH",1,1,17,0)
This patch adds support for sending/receiving Laboratory Electronic
"PKG",53,22,1,"PAH",1,1,18,0)
Data Interchange (LEDI) orders/results with Department of Defense (DoD)
"PKG",53,22,1,"PAH",1,1,19,0)
facilities and implements enhancements to general LEDI functionality.
"PKG",53,22,1,"PAH",1,1,20,0)
 
"PKG",53,22,1,"PAH",1,1,21,0)
 
"PKG",53,22,1,"PAH",1,1,22,0)
1. The process of building orders in the LAB PENDING ORDERS ENTRY file
"PKG",53,22,1,"PAH",1,1,23,0)
(#69.6) has been enhanced to use additional information from the HL7 Order
"PKG",53,22,1,"PAH",1,1,24,0)
(ORM) message. It will store the following information when available in the
"PKG",53,22,1,"PAH",1,1,25,0)
LAB PENDING ORDERS ENTRY file (#69.6):
"PKG",53,22,1,"PAH",1,1,26,0)
 - patient's race
"PKG",53,22,1,"PAH",1,1,27,0)
 - order comments
"PKG",53,22,1,"PAH",1,1,28,0)
 - test results that accompany an order 
"PKG",53,22,1,"PAH",1,1,29,0)

"PKG",53,22,1,"PAH",1,1,30,0)
2. The new option Start a Shipping Manifest [LA7S MANIFEST START] will
"PKG",53,22,1,"PAH",1,1,31,0)
allow a manifest to be started without performing a manifest build.
"PKG",53,22,1,"PAH",1,1,32,0)
Specimens can then be added manually, instead of automatically, using
"PKG",53,22,1,"PAH",1,1,33,0)
option Add/Remove a Shipping Manifest Test [LA7S MANIFEST TEST ADD/REMOVE].
"PKG",53,22,1,"PAH",1,1,34,0)

"PKG",53,22,1,"PAH",1,1,35,0)
3. The new option Edit Relevant Clinical Information [LA7S MANIFEST
"PKG",53,22,1,"PAH",1,1,36,0)
CLINICAL INFO] is used to enter relevant clinical information that
"PKG",53,22,1,"PAH",1,1,37,0)
should accompany a test order on a manifest.
"PKG",53,22,1,"PAH",1,1,38,0)
 
"PKG",53,22,1,"PAH",1,1,39,0)
4. Converted supported API calls $$FMDATE^HLFNC and $$HLDATE^HLFNC to
"PKG",53,22,1,"PAH",1,1,40,0)
recommended Kernel supported API's $$HL7TFM^XLFDT and $$FMTHL7^XLFDT
"PKG",53,22,1,"PAH",1,1,41,0)
respectively.
"PKG",53,22,1,"PAH",1,1,42,0)
 
"PKG",53,22,1,"PAH",1,1,43,0)
5. Routine LA7VHL changed to call HL7 supported API RSPINIT^HLFNC2 to
"PKG",53,22,1,"PAH",1,1,44,0)
obtain message delimiters that HL7 package will use when building MSH
"PKG",53,22,1,"PAH",1,1,45,0)
header of application acknowledgement message. Previous call to
"PKG",53,22,1,"PAH",1,1,46,0)
INIT^HLFNC would return incorrect headers under certain conditions.
"PKG",53,22,1,"PAH",1,1,47,0)
See patch HL*1.6*101 for additional information.
"PKG",53,22,1,"PAH",1,1,48,0)
 
"PKG",53,22,1,"PAH",1,1,49,0)
6. Routine LA7VMSG1 changed to check if $QUERY of ^TMP global has
"PKG",53,22,1,"PAH",1,1,50,0)
returned a null value. Under certain conditions an illegal function call
"PKG",53,22,1,"PAH",1,1,51,0)
error could be observed.
"PKG",53,22,1,"PAH",1,1,52,0)
 
"PKG",53,22,1,"PAH",1,1,53,0)
7. Changed routines LA7VLL, LA7VSTP, and LA7VSTP1 to setup LA7V* logical
"PKG",53,22,1,"PAH",1,1,54,0)
links without <space> between "LA7V" and station number. Allows HL7 package
"PKG",53,22,1,"PAH",1,1,55,0)
to display logical links for DoD sites which utilize DoD DMIS ID codes as
"PKG",53,22,1,"PAH",1,1,56,0)
facility identifiers similar to VA station numbers. HL7 package only
"PKG",53,22,1,"PAH",1,1,57,0)
displays first 8 characters of logical link name. Option LEDI Setup
"PKG",53,22,1,"PAH",1,1,58,0)
[LA7V SETUP] will only support creation of TCP logical links.
"PKG",53,22,1,"PAH",1,1,59,0)
 
"PKG",53,22,1,"PAH",1,1,60,0)
8. Routine LA7PURG is changed to purge shipping manifests from LAB
"PKG",53,22,1,"PAH",1,1,61,0)
SHIPPING MANIFEST file (#62.8) when all related accessions have been
"PKG",53,22,1,"PAH",1,1,62,0)
purged from ACCESSION file (#68) (E3R #18036). Orders in the LAB PENDING
"PKG",53,22,1,"PAH",1,1,63,0)
ORDERS ENTRY file (#69.6) are purged when the date completed is >365
"PKG",53,22,1,"PAH",1,1,64,0)
days, when the order transmitted date is >720 days or when the order
"PKG",53,22,1,"PAH",1,1,65,0)
transmitted date is >360 and the order status is Results/data Received.
"PKG",53,22,1,"PAH",1,1,66,0)
 
"PKG",53,22,1,"PAH",1,1,67,0)
9. When selecting a shipping manifest the list of entries to select
"PKG",53,22,1,"PAH",1,1,68,0)
from will list the manifests in inverse order with the most recent
"PKG",53,22,1,"PAH",1,1,69,0)
being displayed first. (E3R #18036)
"PKG",53,22,1,"PAH",1,1,70,0)
 
"PKG",53,22,1,"PAH",1,1,71,0)
10. Requesting provider's office phone, voice and digital pager numbers
"PKG",53,22,1,"PAH",1,1,72,0)
will be printed on working copies of shipping manifest. (E3R #17914)
"PKG",53,22,1,"PAH",1,1,73,0)
 
"PKG",53,22,1,"PAH",1,1,74,0)
11. Four new alerts/mail bulletins are generated when processing LEDI
"PKG",53,22,1,"PAH",1,1,75,0)
HL7 messages. These alerts and corresponding bulletins are addressed to
"PKG",53,22,1,"PAH",1,1,76,0)
the mail group designated to receive the NEW RESULTS alert specified
"PKG",53,22,1,"PAH",1,1,77,0)
by the site in LA7 MESSAGE PARAMETER file (#62.48) for LEDI type
"PKG",53,22,1,"PAH",1,1,78,0)
interfaces.
"PKG",53,22,1,"PAH",1,1,79,0)
 
"PKG",53,22,1,"PAH",1,1,80,0)
   a. Mail bulletin: LA7 ABNORMAL RESULTS RECEIVED
"PKG",53,22,1,"PAH",1,1,81,0)
   Mail bulletin created by Laboratory package when processing a LEDI
"PKG",53,22,1,"PAH",1,1,82,0)
   interface type HL7 result (ORU) message which contains laboratory
"PKG",53,22,1,"PAH",1,1,83,0)
   testing results that are flagged as critical or abnormal.  Values
"PKG",53,22,1,"PAH",1,1,84,0)
   that are critical will always trigger the alert and bulletin. Values
"PKG",53,22,1,"PAH",1,1,85,0)
   that are abnormal low or high will be triggered when site has flagged
"PKG",53,22,1,"PAH",1,1,86,0)
   the corresponding test in AUTO INSTRUMENT file (#62.4), NOTIFY ABNORMAL
"PKG",53,22,1,"PAH",1,1,87,0)
   FLAGS field (#22) within the CHEM TEST multiple (#30) for the interface.
"PKG",53,22,1,"PAH",1,1,88,0)
 
"PKG",53,22,1,"PAH",1,1,89,0)
   b. Mail bulletin: LA7 AMENDED RESULTS RECEIVED
"PKG",53,22,1,"PAH",1,1,90,0)
   Mail bulletin created by Laboratory package when processing a LEDI
"PKG",53,22,1,"PAH",1,1,91,0)
   interface type HL7 result (ORU) message which contains laboratory
"PKG",53,22,1,"PAH",1,1,92,0)
   testing results that are flagged as amended.
"PKG",53,22,1,"PAH",1,1,93,0)
 
"PKG",53,22,1,"PAH",1,1,94,0)
   c. Mail bulletin: LA7 UNITS/NORMALS CHANGED
"PKG",53,22,1,"PAH",1,1,95,0)
   Mail bulletin created by Laboratory package when processing a LEDI
"PKG",53,22,1,"PAH",1,1,96,0)
   interface type HL7 result (ORU) message which contains laboratory
"PKG",53,22,1,"PAH",1,1,97,0)
   test result units and/or normals different from values specified for
"PKG",53,22,1,"PAH",1,1,98,0)
   test in LABORATORY TEST file (#60) and which are flagged to be used
"PKG",53,22,1,"PAH",1,1,99,0)
   for reference testing purposes.
"PKG",53,22,1,"PAH",1,1,100,0)
 
"PKG",53,22,1,"PAH",1,1,101,0)
   d. Mail bulletin: LA7 ORDER STATUS CHANGED
"PKG",53,22,1,"PAH",1,1,102,0)
   Mail bulletin created by Laboratory package when processing a LEDI
"PKG",53,22,1,"PAH",1,1,103,0)
   interface type HL7 message.
"PKG",53,22,1,"PAH",1,1,104,0)

"PKG",53,22,1,"PAH",1,1,105,0)
   Bulletin will be generated for the following conditions:
"PKG",53,22,1,"PAH",1,1,106,0)
 
"PKG",53,22,1,"PAH",1,1,107,0)
   - When an order acknowledgment (ORR) message contains laboratory
"PKG",53,22,1,"PAH",1,1,108,0)
   test order status changes that indicate the order is not correct or
"PKG",53,22,1,"PAH",1,1,109,0)
   cannot be performed/completed. Currently only supported on LEDI
"PKG",53,22,1,"PAH",1,1,110,0)
   interfaces with DoD facilities.
"PKG",53,22,1,"PAH",1,1,111,0)
 
"PKG",53,22,1,"PAH",1,1,112,0)
   - When an order result (ORU) message indicates that a laboratory
"PKG",53,22,1,"PAH",1,1,113,0)
   test has been added by the reference laboratory to the original order.
"PKG",53,22,1,"PAH",1,1,114,0)
 
"PKG",53,22,1,"PAH",1,1,115,0)
12. Corrected a spelling error in set of codes for LAB SHIPPING
"PKG",53,22,1,"PAH",1,1,116,0)
CONFIGURATION file (#62.9), COLLECTING FACILITY'S SPEC ID field (#.05).
"PKG",53,22,1,"PAH",1,1,117,0)
 
"PKG",53,22,1,"PAH",1,1,118,0)
13. Internal review determined that the specimen container was not printing
"PKG",53,22,1,"PAH",1,1,119,0)
on working copies of shipping manifests. When printing working versions
"PKG",53,22,1,"PAH",1,1,120,0)
of a shipping manifest the specimen container will be printed.
"PKG",53,22,1,"PAH",1,1,121,0)
  
"PKG",53,22,1,"PAH",1,1,122,0)
14. A new error bulletin #47 has been added to LA7 MESSAGE LOG BULLETINS
"PKG",53,22,1,"PAH",1,1,123,0)
file (#62.485). When processing LEDI orders if any of the following are
"PKG",53,22,1,"PAH",1,1,124,0)
incomplete - local test, local urgency, local topography or local collection
"PKG",53,22,1,"PAH",1,1,125,0)
sample then the bulletin will be triggered. This is to insure that orders
"PKG",53,22,1,"PAH",1,1,126,0)
sent by the collecting facility are not missed when processed during LEDI
"PKG",53,22,1,"PAH",1,1,127,0)
Referral Patient Accessioning. If this bulletin is triggered it indicates
"PKG",53,22,1,"PAH",1,1,128,0)
that the host site's shipping configuration is not properly configured to
"PKG",53,22,1,"PAH",1,1,129,0)
process orders from it's collecting site.
"PKG",53,22,1,"PAH",1,1,130,0)
  
"PKG",53,22,1,"PAH",1,1,131,0)
  
"PKG",53,22,1,"PAH",1,1,132,0)
ASSOCIATED E3R
"PKG",53,22,1,"PAH",1,1,133,0)
--------------
"PKG",53,22,1,"PAH",1,1,134,0)
 E3R #17914, PROVIDER CONTACT NUMBERS ON MANIFEST
"PKG",53,22,1,"PAH",1,1,135,0)
 E3R #17904, LEDI BETWEEN VA AND DOD SITES
"PKG",53,22,1,"PAH",1,1,136,0)
 E3R #18036, UNABLE TO PURGE SHIPPING MANIFESTS
"PKG",53,22,1,"PAH",1,1,137,0)
 
"PKG",53,22,1,"PAH",1,1,138,0)
ASSOCIATED NOIS
"PKG",53,22,1,"PAH",1,1,139,0)
---------------
"PKG",53,22,1,"PAH",1,1,140,0)
 ISA-0398-10075 
"PKG",53,22,1,"PAH",1,1,141,0)
 
"PKG",53,22,1,"PAH",1,1,142,0)
 
"PKG",53,22,1,"PAH",1,1,143,0)
TEST SITES
"PKG",53,22,1,"PAH",1,1,144,0)
----------
"PKG",53,22,1,"PAH",1,1,145,0)
 Albuquerque VAMC - VMS/DSM and VMS/Cache
"PKG",53,22,1,"PAH",1,1,146,0)
 Boston HCS - VMS/DSM and VMS/Cache
"PKG",53,22,1,"PAH",1,1,147,0)
 El Paso HCS - NT/Cache and VMS/Cache
"PKG",53,22,1,"PAH",1,1,148,0)
 Hines VAMC - VMS/DSM and VMS/Cache
"PKG",53,22,1,"PAH",1,1,149,0)
 Honolulu VAMC - NT/Cache
"PKG",53,22,1,"PAH",1,1,150,0)
 Manchester VAMC - NT/Cache and VMS/Cache
"PKG",53,22,1,"PAH",1,1,151,0)
 Milwaukee VAMC - VMS/DSM
"PKG",53,22,1,"PAH",1,1,152,0)
 North Chicago VAMC - VMS/DSM
"PKG",53,22,1,"PAH",1,1,153,0)
 Salt Lake City VAMC - VMS/DSM
"PKG",53,22,1,"PAH",1,1,154,0)
 San Diego VAMC - VMS/DSM and VMS/Cache
"PKG",53,22,1,"PAH",1,1,155,0)
 Upstate New York HCS - VMS/DSM and VMS/Cache
"PKG",53,22,1,"PAH",1,1,156,0)

"PKG",53,22,1,"PAH",1,1,157,0)

"PKG",53,22,1,"PAH",1,1,158,0)
 INSTALLATION FILES:
"PKG",53,22,1,"PAH",1,1,159,0)
 ==================
"PKG",53,22,1,"PAH",1,1,160,0)
 The following software and documentation files are exported as part of
"PKG",53,22,1,"PAH",1,1,161,0)
 this patch:
"PKG",53,22,1,"PAH",1,1,162,0)
  
"PKG",53,22,1,"PAH",1,1,163,0)
    File Name             Contents                     Retrieval Format
"PKG",53,22,1,"PAH",1,1,164,0)
    ---------             --------                     ----------------
"PKG",53,22,1,"PAH",1,1,165,0)
               
"PKG",53,22,1,"PAH",1,1,166,0)
LAB_LEDI_III.KID        LA*5.2*64 KIDS build           ASCII
"PKG",53,22,1,"PAH",1,1,167,0)
                        LR*5.2*286 KIDS build
"PKG",53,22,1,"PAH",1,1,168,0)

"PKG",53,22,1,"PAH",1,1,169,0)

"PKG",53,22,1,"PAH",1,1,170,0)
LAB_LEDI_III_IG.PDF     LABORATORY ELECTRONIC DATA     BINARY
"PKG",53,22,1,"PAH",1,1,171,0)
                        INSTALLATION GUIDE     
"PKG",53,22,1,"PAH",1,1,172,0)

"PKG",53,22,1,"PAH",1,1,173,0)
LAB_LEDI_III_IMP_UG.PDF LABORATORY ELECTRONIC DATA     BINARY
"PKG",53,22,1,"PAH",1,1,174,0)
                        IMPLEMENTATION AND USER GUIDE  
"PKG",53,22,1,"PAH",1,1,175,0)

"PKG",53,22,1,"PAH",1,1,176,0)
 The files listed above may be obtained via FTP.  The preferred method is
"PKG",53,22,1,"PAH",1,1,177,0)
 to FTP the files from:
"PKG",53,22,1,"PAH",1,1,178,0)
 
"PKG",53,22,1,"PAH",1,1,179,0)
    download.vista.med.va.gov
"PKG",53,22,1,"PAH",1,1,180,0)
 
"PKG",53,22,1,"PAH",1,1,181,0)
 This transmits the files from the first available FTP server.  Sites may
"PKG",53,22,1,"PAH",1,1,182,0)
 also elect to retrieve software directly from a specific server as
"PKG",53,22,1,"PAH",1,1,183,0)
 follows:
"PKG",53,22,1,"PAH",1,1,184,0)
 
"PKG",53,22,1,"PAH",1,1,185,0)
    CIO FIELD OFFICE   FTP ADDRESS                 DIRECTORY
"PKG",53,22,1,"PAH",1,1,186,0)
    ----------------   -------------------------   --------------------
"PKG",53,22,1,"PAH",1,1,187,0)
    Albany             ftp.fo-albany.med.va.gov    [anonymous.software]
"PKG",53,22,1,"PAH",1,1,188,0)
    Hines              ftp.fo-hines.med.va.gov     [anonymous.software]
"PKG",53,22,1,"PAH",1,1,189,0)
    Salt Lake City     ftp.fo-slc.med.va.gov       [anonymous.software]
"PKG",53,22,1,"PAH",1,1,190,0)
  
"PKG",53,22,1,"PAH",1,1,191,0)
  
"PKG",53,22,1,"PAH",1,1,192,0)
ROUTINE SUMMARY
"PKG",53,22,1,"PAH",1,1,193,0)
===============
"PKG",53,22,1,"PAH",1,1,194,0)
  The following routines are included in this patch.  The second line
"PKG",53,22,1,"PAH",1,1,195,0)
  of each of these routines now looks like:
"PKG",53,22,1,"PAH",1,1,196,0)
  <tab> ;;5.2;AUTOMATED LAB INSTRUMENTS;<patchlist>;Sep 27, 1994
"PKG",53,22,1,"PAH",1,1,197,0)
 
"PKG",53,22,1,"PAH",1,1,198,0)
                    Checksum       Checksum
"PKG",53,22,1,"PAH",1,1,199,0)
   Routine Name     Before Patch   After Patch    Patch List
"PKG",53,22,1,"PAH",1,1,200,0)
   ------------     ------------   -----------    ------------
"PKG",53,22,1,"PAH",1,1,201,0)
   LA64             N/A            5936440        **64** (Deleted by KIDS)
"PKG",53,22,1,"PAH",1,1,202,0)
   LA7PURG          3834284        4599657        **27,64**
"PKG",53,22,1,"PAH",1,1,203,0)
   LA7SBCR1         4924406        5434157        **27,46,64**
"PKG",53,22,1,"PAH",1,1,204,0)
   LA7SBCR2         2564479        2593598        **27,46,64**
"PKG",53,22,1,"PAH",1,1,205,0)
   LA7SCE           11501726       13339015       **27,46,61,64**
"PKG",53,22,1,"PAH",1,1,206,0)
   LA7SM2           12143125       16026225       **46,64**
"PKG",53,22,1,"PAH",1,1,207,0)
   LA7SMB           14649107       12799432       **27,46,64**
"PKG",53,22,1,"PAH",1,1,208,0)
   LA7SMP           11746903       12373162       **27,45,46,64**
"PKG",53,22,1,"PAH",1,1,209,0)
   LA7SMP0          9303222        10961615       **46,64**
"PKG",53,22,1,"PAH",1,1,210,0)
   LA7SMPXL         3215234        4682314        **27,42,46,64**
"PKG",53,22,1,"PAH",1,1,211,0)
   LA7SMU           7104257        7255424        **27,46,64**
"PKG",53,22,1,"PAH",1,1,212,0)
   LA7SMU1          6300206        6311796        **27,46,65,64**
"PKG",53,22,1,"PAH",1,1,213,0)
   LA7SMU2          5290542        7549846        **46,64**
"PKG",53,22,1,"PAH",1,1,214,0)
   LA7SRR           6233015        7637904        **46,64**
"PKG",53,22,1,"PAH",1,1,215,0)
   LA7UTILA         10237097       10662046       **23,27,46,64**
"PKG",53,22,1,"PAH",1,1,216,0)
   LA7VHL           4568355        5811383        **27,46,62,64**
"PKG",53,22,1,"PAH",1,1,217,0)
   LA7VHLU          4487468        5914870        **46,62,64**
"PKG",53,22,1,"PAH",1,1,218,0)
   LA7VHLU1         2323481        3267492        **46,61,64**
"PKG",53,22,1,"PAH",1,1,219,0)
   LA7VHLU2         4100825        4356637        **46,61,64**
"PKG",53,22,1,"PAH",1,1,220,0)
   LA7VHLU3         2007360        2799232        **46,64**
"PKG",53,22,1,"PAH",1,1,221,0)
   LA7VHLU4         5424804        4836094        **46,64**
"PKG",53,22,1,"PAH",1,1,222,0)
   LA7VHLU5         5541950        7828952        **46,64**
"PKG",53,22,1,"PAH",1,1,223,0)
   LA7VIN1          5261630        5855016        **46,64**
"PKG",53,22,1,"PAH",1,1,224,0)
   LA7VIN1A         N/A            13987419       **64**
"PKG",53,22,1,"PAH",1,1,225,0)
   LA7VIN2          5808892        8339412        **46,64**
"PKG",53,22,1,"PAH",1,1,226,0)
   LA7VIN3          2061956        3081309        **46,64**
"PKG",53,22,1,"PAH",1,1,227,0)
   LA7VIN4          7936019        12162627       **46,64**
"PKG",53,22,1,"PAH",1,1,228,0)
   LA7VIN5          5205707        10570600       **46,64**
"PKG",53,22,1,"PAH",1,1,229,0)
   LA7VIN5A         5039195        8695039        **46,64**
"PKG",53,22,1,"PAH",1,1,230,0)
   LA7VLL           5170411        6390054        **27,51,55,64**
"PKG",53,22,1,"PAH",1,1,231,0)
   LA7VMSG          3253314        5080421        **27,50,56,46,64**
"PKG",53,22,1,"PAH",1,1,232,0)
   LA7VMSG1         8227296        8679432        **56,46,61,64**
"PKG",53,22,1,"PAH",1,1,233,0)
   LA7VOBR          2129056        2455598        **46,64**
"PKG",53,22,1,"PAH",1,1,234,0)
   LA7VOBRA         5326634        8044290        **46,64**
"PKG",53,22,1,"PAH",1,1,235,0)
   LA7VOBX          2088674        2633711        **46,64**
"PKG",53,22,1,"PAH",1,1,236,0)
   LA7VOBX1         4057776        4535705        **46,61,63,64**
"PKG",53,22,1,"PAH",1,1,237,0)
   LA7VOBX2         4350324        4309250        **46,64**
"PKG",53,22,1,"PAH",1,1,238,0)
   LA7VOBX3         5240738        6460347        **46,64**
"PKG",53,22,1,"PAH",1,1,239,0)
   LA7VOBXA         6416931        6372995        **46,70,64**
"PKG",53,22,1,"PAH",1,1,240,0)
   LA7VORC          1565653        1713732        **46,64**
"PKG",53,22,1,"PAH",1,1,241,0)
   LA7VORM          6471896        12116142       **27,42,46,64**
"PKG",53,22,1,"PAH",1,1,242,0)
   LA7VORM1         7594289        9199759        **27,51,46,61,64**
"PKG",53,22,1,"PAH",1,1,243,0)
   LA7VORM3         6787219        7257153        **46,64**
"PKG",53,22,1,"PAH",1,1,244,0)
   LA7VORU          6241961        8366274        **27,46,61,64**
"PKG",53,22,1,"PAH",1,1,245,0)
   LA7VORU1         4734718        4842743        **46,64**
"PKG",53,22,1,"PAH",1,1,246,0)
   LA7VORU2         1962290        2531397        **46,64**
"PKG",53,22,1,"PAH",1,1,247,0)
   LA7VORUA         2199285        2385822        **61,64**
"PKG",53,22,1,"PAH",1,1,248,0)
   LA7VPID          4123683        4823699        **46,64**
"PKG",53,22,1,"PAH",1,1,249,0)
   LA7VSET          15979413       14514051       **27,51,55,46,64**
"PKG",53,22,1,"PAH",1,1,250,0)
   LA7VSET1         9065449        7835525        **27,51,55,46,64**
"PKG",53,22,1,"PAH",1,1,251,0)
   LA7VSTP          6079680        4597827        **27,44,51,46,64**
"PKG",53,22,1,"PAH",1,1,252,0)
   LA7VSTP1         3317926        3042573        **27,46,64**
"PKG",53,22,1,"PAH",1,1,253,0)
   LAGEN            8522786        8715369        **1,17,22,27,47,46,64**
"PKG",53,22,1,"PAH",1,1,254,0)
 
"PKG",53,22,1,"PAH",1,1,255,0)
 List of preceding patches: 46, 61, 62, 63, 65, 70
"PKG",53,22,1,"PAH",1,1,256,0)
 Sites should use CHECK^XTSUMBLD to verify checksums.
"PKG",53,22,1,"PAH",1,1,257,0)
 
"PKG",53,22,1,"PAH",1,1,258,0)
 
"PKG",53,22,1,"PAH",1,1,259,0)
INSTALLATION INSTRUCTIONS
"PKG",53,22,1,"PAH",1,1,260,0)
=========================
"PKG",53,22,1,"PAH",1,1,261,0)
 
"PKG",53,22,1,"PAH",1,1,262,0)
See LABORATORY ELECTRONIC DATA INTERCHANGE III (LEDI III) INSTALLATION GUIDE
"PKG",53,22,1,"PAH",1,1,263,0)
    LA*5.2*64/LR*5.2*286
"PRE")
LA64
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
53
"RTN","LA64")
0^^B13580518
"RTN","LA64",1,0)
LA64 ;DALOI/JMC - LA*5.2*64 PATCH ENVIRONMENT CHECK ROUTINE ;5/14/2002
"RTN","LA64",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**64**;Sep 27, 1994
"RTN","LA64",3,0)
EN ; Does not prevent loading of the transport global.
"RTN","LA64",4,0)
 ; Environment check is done only during the install.
"RTN","LA64",5,0)
 ;
"RTN","LA64",6,0)
 N XQA,XQAMSG
"RTN","LA64",7,0)
 ;
"RTN","LA64",8,0)
 I '$G(XPDENV) D  Q
"RTN","LA64",9,0)
 . S XQAMSG="Transport global for patch "_$G(XPDNM,"Unknown patch")_" loaded on "_$$HTE^XLFDT($H)
"RTN","LA64",10,0)
 . S XQA("G.LMI")=""
"RTN","LA64",11,0)
 . D SETUP^XQALERT
"RTN","LA64",12,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Sending transport global loaded alert to mail group G.LMI",80))
"RTN","LA64",13,0)
 ;
"RTN","LA64",14,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")_" started on "_$$HTE^XLFDT($H)
"RTN","LA64",15,0)
 S XQA("G.LMI")=""
"RTN","LA64",16,0)
 D SETUP^XQALERT
"RTN","LA64",17,0)
 ;
"RTN","LA64",18,0)
 D CHECK
"RTN","LA64",19,0)
 D EXIT
"RTN","LA64",20,0)
 Q
"RTN","LA64",21,0)
 ;
"RTN","LA64",22,0)
 ;
"RTN","LA64",23,0)
CHECK ; Perform environment check
"RTN","LA64",24,0)
 I $S('$G(IOM):1,'$G(IOSL):1,$G(U)'="^":1,1:0) D  Q
"RTN","LA64",25,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Terminal Device is not defined",80))
"RTN","LA64",26,0)
 . S XPDQUIT=2
"RTN","LA64",27,0)
 I $S('$G(DUZ):1,$D(DUZ)[0:1,$D(DUZ(0))[0:1,1:0) D  Q
"RTN","LA64",28,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Please log in to set local DUZ... variables",80))
"RTN","LA64",29,0)
 . S XPDQUIT=2
"RTN","LA64",30,0)
 I $P($$ACTIVE^XUSER(DUZ),"^")'=1 D  Q
"RTN","LA64",31,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("You are not a valid user on this system",80))
"RTN","LA64",32,0)
 . S XPDQUIT=2
"RTN","LA64",33,0)
 S XPDIQ("XPZ1","B")="NO"
"RTN","LA64",34,0)
 Q
"RTN","LA64",35,0)
 ;
"RTN","LA64",36,0)
 ;
"RTN","LA64",37,0)
EXIT ;
"RTN","LA64",38,0)
 I $G(XPDQUIT) D BMES^XPDUTL($$CJ^XLFSTR("--- Install Environment Check FAILED ---",80))
"RTN","LA64",39,0)
 I '$G(XPDQUIT) D BMES^XPDUTL($$CJ^XLFSTR("--- Environment Check is Ok ---",80))
"RTN","LA64",40,0)
 Q
"RTN","LA64",41,0)
 ;
"RTN","LA64",42,0)
 ;
"RTN","LA64",43,0)
PRE ; KIDS Pre install for LA*5.2*64
"RTN","LA64",44,0)
 ;
"RTN","LA64",45,0)
 N DA,DIK
"RTN","LA64",46,0)
 ;
"RTN","LA64",47,0)
 D BMES^XPDUTL($$CJ^XLFSTR("Sending install started alert to mail group G.LMI",80))
"RTN","LA64",48,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install started ***",80))
"RTN","LA64",49,0)
 D BMES^XPDUTL($$CJ^XLFSTR("--- No actions required for pre install ---",80))
"RTN","LA64",50,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install completed ***",80))
"RTN","LA64",51,0)
 ;
"RTN","LA64",52,0)
 Q
"RTN","LA64",53,0)
 ;
"RTN","LA64",54,0)
 ;
"RTN","LA64",55,0)
POST ; KIDS Post install for LA*5.2*64
"RTN","LA64",56,0)
 N DA,DIK,FDA,LA7X,LA7ERR,XQA,XQAMSG
"RTN","LA64",57,0)
 ;
"RTN","LA64",58,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install started ***",80))
"RTN","LA64",59,0)
 ;
"RTN","LA64",60,0)
 ; Set new "C" x-ref on .01 field of file #62.8
"RTN","LA64",61,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Starting reindexing of field #.01 of LAB SHIPPING MANIFEST file ***",80))
"RTN","LA64",62,0)
 S DIK="^LAHM(62.8,",DIK(1)=".01^C"
"RTN","LA64",63,0)
 D ENALL^DIK
"RTN","LA64",64,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Completed reindexing of field #.01 of LAB SHIPPING MANIFEST file ***",80))
"RTN","LA64",65,0)
 ;
"RTN","LA64",66,0)
 ; Update existing LA7V* file 62.48 entries with INTERFACE TYPE.
"RTN","LA64",67,0)
 S LA7X=0
"RTN","LA64",68,0)
 F  S LA7X=$O(^LAHM(62.48,LA7X)) Q:'LA7X  D
"RTN","LA64",69,0)
 . I $E(^LAHM(62.48,LA7X,0),1,4)'="LA7V" Q
"RTN","LA64",70,0)
 . S FDA(1,62.48,LA7X_",",11)=10
"RTN","LA64",71,0)
 . D FILE^DIE("E","FDA(1)","LA7ERR(1)")
"RTN","LA64",72,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Set INTERFACE TYPE for LA7V* entries in LA7 MESSAGE PARAMETER file ***",80))
"RTN","LA64",73,0)
 ;
"RTN","LA64",74,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install completed ***",80))
"RTN","LA64",75,0)
 D BMES^XPDUTL($$CJ^XLFSTR("Sending install completion alert to mail group G.LMI",80))
"RTN","LA64",76,0)
 ;
"RTN","LA64",77,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")_" completed on "_$$HTE^XLFDT($H)
"RTN","LA64",78,0)
 S XQA("G.LMI")=""
"RTN","LA64",79,0)
 D SETUP^XQALERT
"RTN","LA64",80,0)
 ;
"RTN","LA64",81,0)
 S XQAMSG="LIM: Review LEDI Install Guide and User Manual"
"RTN","LA64",82,0)
 S XQA("G.LMI")=""
"RTN","LA64",83,0)
 D SETUP^XQALERT
"RTN","LA64",84,0)
 ;
"RTN","LA64",85,0)
 Q
"RTN","LA7PURG")
0^47^B15026953
"RTN","LA7PURG",1,0)
LA7PURG ;DALOI/JMC - Purge Lab Messaging Interface Messages ; Nov 4, 2004
"RTN","LA7PURG",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,64**;Sep 27, 1994
"RTN","LA7PURG",3,0)
 ;
"RTN","LA7PURG",4,0)
 ; This routine purges messages and checks file intregrity for Lab Messaging.
"RTN","LA7PURG",5,0)
 Q
"RTN","LA7PURG",6,0)
 ;
"RTN","LA7PURG",7,0)
 ;
"RTN","LA7PURG",8,0)
EN ; Entry point from taskman
"RTN","LA7PURG",9,0)
 D IC^LA7CHKF
"RTN","LA7PURG",10,0)
 D PURGE,PSM,PLPO
"RTN","LA7PURG",11,0)
 S X=$$LACHK^LA7CHKF
"RTN","LA7PURG",12,0)
 Q
"RTN","LA7PURG",13,0)
 ;
"RTN","LA7PURG",14,0)
 ;
"RTN","LA7PURG",15,0)
PURGE ; purge messages previous to today
"RTN","LA7PURG",16,0)
 N DA,DIK,I,LA7CFG,LA7DA,LA7DAT,LA7ROOT,LA7Q,X,Y
"RTN","LA7PURG",17,0)
 ;
"RTN","LA7PURG",18,0)
 ; Get each configuration's grace period for messages.
"RTN","LA7PURG",19,0)
 ; Determine cut-off date for purging this configuration.
"RTN","LA7PURG",20,0)
 S I=0
"RTN","LA7PURG",21,0)
 F  S I=$O(^LAHM(62.48,I)) Q:'I  D
"RTN","LA7PURG",22,0)
 . S X=$P($G(^LAHM(62.48,I,0)),"^",6)
"RTN","LA7PURG",23,0)
 . I 'X S X=3 ; If missing, default to 3 days.
"RTN","LA7PURG",24,0)
 . S LA7DAT(I)=$$HTFM^XLFDT($$HADD^XLFDT($H,-X),1)
"RTN","LA7PURG",25,0)
 S LA7DAT=0
"RTN","LA7PURG",26,0)
 ;
"RTN","LA7PURG",27,0)
 F  S LA7DAT=$O(^LAHM(62.49,"AD",LA7DAT)) Q:'LA7DAT!(LA7DAT=DT)  D
"RTN","LA7PURG",28,0)
 . ; Set flag if "problem" messages for this date are purgeable --> have been removed from XTMP.
"RTN","LA7PURG",29,0)
 . S LA7DAT(0)=$G(^XTMP("LA7ERR^"_LA7DAT,0),0)
"RTN","LA7PURG",30,0)
 . S LA7DA=0
"RTN","LA7PURG",31,0)
 . F  S LA7DA=$O(^LAHM(62.49,"AD",LA7DAT,LA7DA)) Q:'LA7DA  D
"RTN","LA7PURG",32,0)
 . . L +^LAHM(62.49,LA7DA):1
"RTN","LA7PURG",33,0)
 . . I $T D
"RTN","LA7PURG",34,0)
 . . . I LA7DAT'=$P($P($G(^LAHM(62.49,LA7DA,0)),"^",5),".") D  Q
"RTN","LA7PURG",35,0)
 . . . . ; Date in cross-reference does not match field #4, remove x-ref.
"RTN","LA7PURG",36,0)
 . . . . K ^LAHM(62.49,"AD",LA7DAT,LA7DA)
"RTN","LA7PURG",37,0)
 . . . ; Don't purge if problem message and still in XTMP global.
"RTN","LA7PURG",38,0)
 . . . I LA7DAT(0),$P(^LAHM(62.49,LA7DA,0),"^",3)'="X" Q
"RTN","LA7PURG",39,0)
 . . . ; Get configuration for this message.
"RTN","LA7PURG",40,0)
 . . . S LA7CFG=+$G(^LAHM(62.49,LA7DA,.5))
"RTN","LA7PURG",41,0)
 . . . ; If message hasn't reached purge date --> skip.
"RTN","LA7PURG",42,0)
 . . . I LA7CFG,LA7DAT'<$G(LA7DAT(LA7CFG)) Q
"RTN","LA7PURG",43,0)
 . . . S DIK="^LAHM(62.49,",DA=LA7DA D ^DIK
"RTN","LA7PURG",44,0)
 . . L -^LAHM(62.49,LA7DA)
"RTN","LA7PURG",45,0)
 Q
"RTN","LA7PURG",46,0)
 ;
"RTN","LA7PURG",47,0)
 ;
"RTN","LA7PURG",48,0)
PSM ; Purge shipping manifests file (#62.8)
"RTN","LA7PURG",49,0)
 ;
"RTN","LA7PURG",50,0)
 ; Check each manifest to determine if accessions on manifest have all
"RTN","LA7PURG",51,0)
 ; been purged from file #68.
"RTN","LA7PURG",52,0)
 ;
"RTN","LA7PURG",53,0)
 ; If over 10000 entries purged from #62.85 then quit and pickup next
"RTN","LA7PURG",54,0)
 ; session. Avoid performance and journaling issues.
"RTN","LA7PURG",55,0)
 N DA,DIK,LA7628,LA7CNT
"RTN","LA7PURG",56,0)
 S (LA7628,LA7CNT)=0,DIK="^LAHM(62.8,"
"RTN","LA7PURG",57,0)
 F  S LA7628=$O(^LAHM(62.8,LA7628)) Q:'LA7628  D  Q:LA7CNT>10000
"RTN","LA7PURG",58,0)
 . I '$$CHK628(LA7628) Q
"RTN","LA7PURG",59,0)
 . D P6285
"RTN","LA7PURG",60,0)
 . S DA=LA7628 D ^DIK
"RTN","LA7PURG",61,0)
 Q
"RTN","LA7PURG",62,0)
 ;
"RTN","LA7PURG",63,0)
 ;
"RTN","LA7PURG",64,0)
PLPO ; Purge Lab Pending Orders file (#69.6)
"RTN","LA7PURG",65,0)
 ;
"RTN","LA7PURG",66,0)
 ; Check each order to determine if order can be purged.
"RTN","LA7PURG",67,0)
 ;
"RTN","LA7PURG",68,0)
 ; If over 5000 entries purged then quit and pickup next session.
"RTN","LA7PURG",69,0)
 ; Avoid performance and journaling issues.
"RTN","LA7PURG",70,0)
 ;
"RTN","LA7PURG",71,0)
 N DA,DIK,LA7696,LA7CNT,LA7COFF,LA7STAT
"RTN","LA7PURG",72,0)
 ;
"RTN","LA7PURG",73,0)
 S DIK="^LRO(69.6,",(LA7696,LA7CNT)=0
"RTN","LA7PURG",74,0)
 ; Cutoff dates
"RTN","LA7PURG",75,0)
 S LA7COFF(1)=$$FMADD^XLFDT(DT,-365),LA7COFF(2)=$$FMADD^XLFDT(DT,-730)
"RTN","LA7PURG",76,0)
 ; Results sent status ien
"RTN","LA7PURG",77,0)
 S LA7STAT=$$FIND1^DIC(64.061,"","OMX","Results/data Received","","I $P(^LAB(64.061,Y,0),U,7)=""U""")
"RTN","LA7PURG",78,0)
 F  S LA7696=$O(^LRO(69.6,LA7696)) Q:'LA7696  D  Q:LA7CNT>5000
"RTN","LA7PURG",79,0)
 . I '$$CHK696(LA7696,.LA7COFF,LA7STAT) Q
"RTN","LA7PURG",80,0)
 . S LA7CNT=LA7CNT+1,DA=LA7696 D ^DIK
"RTN","LA7PURG",81,0)
 Q
"RTN","LA7PURG",82,0)
 ;
"RTN","LA7PURG",83,0)
 ;
"RTN","LA7PURG",84,0)
CHK628(LA7628) ; If all accessions have been purged then safe to purge manifest
"RTN","LA7PURG",85,0)
 ; and associated events (#62.85)
"RTN","LA7PURG",86,0)
 ;
"RTN","LA7PURG",87,0)
 ; Call with LA7628 = ien of manifest in #62.8
"RTN","LA7PURG",88,0)
 ;
"RTN","LA7PURG",89,0)
 ; Returns OK = 1(yes)/ 0(no) to purge
"RTN","LA7PURG",90,0)
 ;
"RTN","LA7PURG",91,0)
 N LRUID,OK
"RTN","LA7PURG",92,0)
 S OK=1,LRUID=""
"RTN","LA7PURG",93,0)
 F  S LRUID=$O(^LAHM(62.8,LA7628,10,"UID",LRUID)) Q:LRUID=""  I $$CHECKUID^LRWU4(LRUID) S OK=0 Q
"RTN","LA7PURG",94,0)
 Q OK
"RTN","LA7PURG",95,0)
 ;
"RTN","LA7PURG",96,0)
 ;
"RTN","LA7PURG",97,0)
P6285 ; Purge related entries in shipping activity log (#62.85)
"RTN","LA7PURG",98,0)
 ;
"RTN","LA7PURG",99,0)
 N DA,DIK,LA7SM,LRUID
"RTN","LA7PURG",100,0)
 S LA7SM=$P(^LAHM(62.8,LA7628,0),"^"),LRUID="",DIK="^LAHM(62.85,"
"RTN","LA7PURG",101,0)
 ;
"RTN","LA7PURG",102,0)
 ; Purge entries in 62.85 relating to accessions (UID) on manifest
"RTN","LA7PURG",103,0)
 F  S LRUID=$O(^LAHM(62.8,LA7628,10,"UID",LRUID)) Q:LRUID=""  D
"RTN","LA7PURG",104,0)
 . S DA=0
"RTN","LA7PURG",105,0)
 . F  S DA=$O(^LAHM(62.85,"AM",LRUID,LA7SM,DA)) Q:'DA  D ^DIK S LA7CNT=LA7CNT+1
"RTN","LA7PURG",106,0)
 ;
"RTN","LA7PURG",107,0)
 ; Purge entries in 62.85 relating to manifest
"RTN","LA7PURG",108,0)
 S DA=0
"RTN","LA7PURG",109,0)
 F  S DA=$O(^LAHM(62.85,"B",LA7SM,DA)) Q:'DA  D ^DIK S LA7CNT=LA7CNT+1
"RTN","LA7PURG",110,0)
 Q
"RTN","LA7PURG",111,0)
 ;
"RTN","LA7PURG",112,0)
 ;
"RTN","LA7PURG",113,0)
CHK696(LA7696,LA7COFF,LA7SPST) ; Check if order safe to purge
"RTN","LA7PURG",114,0)
 ;
"RTN","LA7PURG",115,0)
 ; Call with LA7696 = ien of order in #69.6
"RTN","LA7PURG",116,0)
 ;          LA7COFF = array of cutoff FileMan dates.
"RTN","LA7PURG",117,0)
 ;          LA7SPST = ien of specimen status Results/data Received
"RTN","LA7PURG",118,0)
 ;
"RTN","LA7PURG",119,0)
 ; Returns OK = 1(yes)/ 0(no) to purge
"RTN","LA7PURG",120,0)
 ;
"RTN","LA7PURG",121,0)
 N LAX,OK
"RTN","LA7PURG",122,0)
 S OK=0,LAX=$G(^LRO(69.6,LA7696,1))
"RTN","LA7PURG",123,0)
 ;
"RTN","LA7PURG",124,0)
 ; Check date order completed
"RTN","LA7PURG",125,0)
 I $P(LAX,"^",7),$P(LAX,"^",7)<LA7COFF(1) S OK=1
"RTN","LA7PURG",126,0)
 ;
"RTN","LA7PURG",127,0)
 ; Check date order received/tranmsitted
"RTN","LA7PURG",128,0)
 I 'OK D
"RTN","LA7PURG",129,0)
 . I $P(LAX,"^",4),$P(LAX,"^",4)<LA7COFF(2) S OK=1 Q
"RTN","LA7PURG",130,0)
 . I $P(LAX,"^",5),$P(LAX,"^",5)<LA7COFF(2) S OK=1 Q
"RTN","LA7PURG",131,0)
 ;
"RTN","LA7PURG",132,0)
 ; Check date order received and specimen status
"RTN","LA7PURG",133,0)
 I 'OK,$P(LAX,"^",5),$P(LAX,"^",5)<LA7COFF(1) D
"RTN","LA7PURG",134,0)
 . S X=$P($G(^LRO(69.6,LA7696,0)),"^",10) ; specimen status
"RTN","LA7PURG",135,0)
 . I LA7SPST,X=LA7SPST S OK=1
"RTN","LA7PURG",136,0)
 ;
"RTN","LA7PURG",137,0)
 Q OK
"RTN","LA7SBCR1")
0^51^B36886840
"RTN","LA7SBCR1",1,0)
LA7SBCR1 ;DALOI/JMC - Shipping Barcode Reader Utility ; 23 Feb 2004
"RTN","LA7SBCR1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,46,64**;Sep 27, 1994
"RTN","LA7SBCR1",3,0)
 Q
"RTN","LA7SBCR1",4,0)
 ;
"RTN","LA7SBCR1",5,0)
PT(LA7,LA7PROM,LA7SCFG) ; Setup patient/ordering site info from barcode.
"RTN","LA7SBCR1",6,0)
 ; Input:
"RTN","LA7SBCR1",7,0)
 ;        LA7=array to return values
"RTN","LA7SBCR1",8,0)
 ;    LA7PROM=array of prompts to display to user
"RTN","LA7SBCR1",9,0)
 ;    LA7SCFG=array of shipping configuration info
"RTN","LA7SBCR1",10,0)
 ;
"RTN","LA7SBCR1",11,0)
 ; Returns array LA7()
"RTN","LA7SBCR1",12,0)
 ;  If successful DFN=ien of patient in #2, if DPF=2
"RTN","LA7SBCR1",13,0)
 ;                DOB=patient's date of birth
"RTN","LA7SBCR1",14,0)
 ;                DPF=source file (2, 67, or 537010)
"RTN","LA7SBCR1",15,0)
 ;                CDT=collection date/time
"RTN","LA7SBCR1",16,0)
 ;              ERROR=0
"RTN","LA7SBCR1",17,0)
 ;                PNM=patient name
"RTN","LA7SBCR1",18,0)
 ;              RSITE=sending site
"RTN","LA7SBCR1",19,0)
 ;               RUID=specimen unique identifier
"RTN","LA7SBCR1",20,0)
 ;                SEX=patient's sex
"RTN","LA7SBCR1",21,0)
 ;                SSN=patient's SSN
"RTN","LA7SBCR1",22,0)
 ;
"RTN","LA7SBCR1",23,0)
 ;   unsuccessful ERROR=>0
"RTN","LA7SBCR1",24,0)
 ;
"RTN","LA7SBCR1",25,0)
 N LA7BCS,LA7IEN,LA7X,LA7Y,LA7Z,Y
"RTN","LA7SBCR1",26,0)
 S LA7="",LA7BCS=0,LA7PNM=""
"RTN","LA7SBCR1",27,0)
 S LA7PROM=$G(LA7PROM,"Patient/Accession Info (PD)")
"RTN","LA7SBCR1",28,0)
 S Y=$$RD^LA7SBCR(.LA7PROM,1)
"RTN","LA7SBCR1",29,0)
 ;
"RTN","LA7SBCR1",30,0)
 I Y=0 D  Q
"RTN","LA7SBCR1",31,0)
 . S LA7("ERROR")="1^User timeout/abort"
"RTN","LA7SBCR1",32,0)
 ;
"RTN","LA7SBCR1",33,0)
 I Y<1 D  Q
"RTN","LA7SBCR1",34,0)
 . S LA7("ERROR")="2^Incorrect bar-code format"
"RTN","LA7SBCR1",35,0)
 ;
"RTN","LA7SBCR1",36,0)
 ; barcode info & longitudinal parity check
"RTN","LA7SBCR1",37,0)
 ; original style bar code
"RTN","LA7SBCR1",38,0)
 I $E(Y,1,9)="1^STX^PD^" D
"RTN","LA7SBCR1",39,0)
 . S LA7=$P(Y,"STX^PD^",2)
"RTN","LA7SBCR1",40,0)
 . S LA7=$P(LA7,"^ETX",1)
"RTN","LA7SBCR1",41,0)
 . S LA7("LPC")=$P(Y,"^ETX",2)
"RTN","LA7SBCR1",42,0)
 ; new style bar code
"RTN","LA7SBCR1",43,0)
 I $E(Y,1,5)="1^PD^" D
"RTN","LA7SBCR1",44,0)
 . S LA7=$P(Y,"^",3,6)
"RTN","LA7SBCR1",45,0)
 . S LA7("LPC")=$P(Y,"^",7)
"RTN","LA7SBCR1",46,0)
 . S LA7BCS=1
"RTN","LA7SBCR1",47,0)
 ;
"RTN","LA7SBCR1",48,0)
 I LA7="" D  Q
"RTN","LA7SBCR1",49,0)
 . S LA7("ERROR")="2^Incorrect bar-code format"
"RTN","LA7SBCR1",50,0)
 ;
"RTN","LA7SBCR1",51,0)
 I $G(LA7("LPC"))'=$G(LA7SCFG("LPC")) D  Q
"RTN","LA7SBCR1",52,0)
 . S LA7("ERROR")="9^Parity check does not match on (SM) and (PD) barcodes"
"RTN","LA7SBCR1",53,0)
 ;
"RTN","LA7SBCR1",54,0)
 S LA7("RSITE")=$P(LA7,"^",2)
"RTN","LA7SBCR1",55,0)
 I LA7("RSITE")'=$P(LA7SCFG("RSITE"),"^",3) D
"RTN","LA7SBCR1",56,0)
 . S LA7("ERROR")="31^Site in PD barcode does not match shipping configuration file"
"RTN","LA7SBCR1",57,0)
 ;
"RTN","LA7SBCR1",58,0)
 ; Remote specimen identifier
"RTN","LA7SBCR1",59,0)
 S LA7("RUID")=$P(LA7,"^",3)
"RTN","LA7SBCR1",60,0)
 ;
"RTN","LA7SBCR1",61,0)
 ; Specimen collection date, using either old or new style(LA7BCS=1) bar code
"RTN","LA7SBCR1",62,0)
 I 'LA7BCS,$P(LA7,"^",5) S LA7("CDT")=$$DT^LA7SBCR($P(LA7,"^",5))
"RTN","LA7SBCR1",63,0)
 I LA7BCS,$P(LA7,"^",4) S LA7("CDT")=$$DT^LA7SBCR($P(LA7,"^",4))
"RTN","LA7SBCR1",64,0)
 ;
"RTN","LA7SBCR1",65,0)
 ; Patient identifier
"RTN","LA7SBCR1",66,0)
 S LA7X=$P(LA7,"^") ; Patient's ID
"RTN","LA7SBCR1",67,0)
 ;
"RTN","LA7SBCR1",68,0)
 ; No SSN in first piece
"RTN","LA7SBCR1",69,0)
 I LA7X="" S LA7("ERROR")="3^No SSN in barcode" Q
"RTN","LA7SBCR1",70,0)
 S LA7("SSN")=LA7X
"RTN","LA7SBCR1",71,0)
 ;
"RTN","LA7SBCR1",72,0)
 ; Try LAB PENDING ORDERS file
"RTN","LA7SBCR1",73,0)
 D LPO(.LA7,LA7SCFG("SMID"))
"RTN","LA7SBCR1",74,0)
 ;
"RTN","LA7SBCR1",75,0)
 ; Check for patient in file #2.
"RTN","LA7SBCR1",76,0)
 I $G(LA7("ERROR")) D DPT(.LA7,LA7X)
"RTN","LA7SBCR1",77,0)
 ;
"RTN","LA7SBCR1",78,0)
 ; Else try Lab Referral file.
"RTN","LA7SBCR1",79,0)
 I $G(LA7("ERROR")) D LRT(.LA7,LA7X)
"RTN","LA7SBCR1",80,0)
 ;
"RTN","LA7SBCR1",81,0)
 ; Get additional info from PD1 bar code
"RTN","LA7SBCR1",82,0)
 I +$G(LA7("ERROR"))=4 D PD1
"RTN","LA7SBCR1",83,0)
 Q
"RTN","LA7SBCR1",84,0)
 ;
"RTN","LA7SBCR1",85,0)
 ;
"RTN","LA7SBCR1",86,0)
DPT(LA7,LA7X) ; Lookup in Patient file.
"RTN","LA7SBCR1",87,0)
 ; Check for patient in file #2.
"RTN","LA7SBCR1",88,0)
 S LA7Y=$O(^DPT("SSN",LA7X,0))
"RTN","LA7SBCR1",89,0)
 ; SSN not found.
"RTN","LA7SBCR1",90,0)
 I 'LA7Y S LA7("ERROR")="4^Unsuccessful SSN lookup" Q
"RTN","LA7SBCR1",91,0)
 S LA7Y(0)=$G(^DPT(LA7Y,0))
"RTN","LA7SBCR1",92,0)
 ; SSN not found.
"RTN","LA7SBCR1",93,0)
 I LA7Y(0)="" S LA7("ERROR")="4^Unsuccessful SSN lookup" Q
"RTN","LA7SBCR1",94,0)
 ;
"RTN","LA7SBCR1",95,0)
 D DPTSET(.LA7,LA7Y)
"RTN","LA7SBCR1",96,0)
 Q
"RTN","LA7SBCR1",97,0)
 ;
"RTN","LA7SBCR1",98,0)
 ;
"RTN","LA7SBCR1",99,0)
LRT(LA7,LA7X) ; Lookup in Lab Referral file.
"RTN","LA7SBCR1",100,0)
 ; Clear error flag.
"RTN","LA7SBCR1",101,0)
 S LA7("ERROR")=""
"RTN","LA7SBCR1",102,0)
 S LA7Y=$O(^LRT(67,"C",LA7X,0))
"RTN","LA7SBCR1",103,0)
 ; SSN not found.
"RTN","LA7SBCR1",104,0)
 I 'LA7Y S LA7("ERROR")="4^Unsuccessful SSN lookup" Q
"RTN","LA7SBCR1",105,0)
 S LA7Y(0)=$G(^LRT(67,LA7Y,0))
"RTN","LA7SBCR1",106,0)
 ; SSN not found.
"RTN","LA7SBCR1",107,0)
 I LA7Y(0)="" S LA7("ERROR")="4^Unsuccessful SSN lookup" Q
"RTN","LA7SBCR1",108,0)
 D LRTSET(.LA7,LA7Y)
"RTN","LA7SBCR1",109,0)
 Q
"RTN","LA7SBCR1",110,0)
 ;
"RTN","LA7SBCR1",111,0)
 ;
"RTN","LA7SBCR1",112,0)
LPO(LA7,LA7SM) ; Lookup in LAB PENDING ORDERS file #69.6
"RTN","LA7SBCR1",113,0)
 ;
"RTN","LA7SBCR1",114,0)
 N LA7696,LA7RUID
"RTN","LA7SBCR1",115,0)
 S LA7RUID=LA7("RUID"),LA7696=""
"RTN","LA7SBCR1",116,0)
 I LA7SM'="",LA7RUID'="" S LA7696=$O(^LRO(69.6,"AD",LA7SM,LA7RUID,0))
"RTN","LA7SBCR1",117,0)
 I 'LA7696 S LA7("ERROR")="4^Unsuccessful SSN lookup" Q
"RTN","LA7SBCR1",118,0)
 D LPOSET(.LA7,LA7696)
"RTN","LA7SBCR1",119,0)
 Q
"RTN","LA7SBCR1",120,0)
 ;
"RTN","LA7SBCR1",121,0)
 ;
"RTN","LA7SBCR1",122,0)
DPTSET(LA7,LA7Y) ; Setup array from Patient file.
"RTN","LA7SBCR1",123,0)
 ;
"RTN","LA7SBCR1",124,0)
 N RACE,LA7ERR
"RTN","LA7SBCR1",125,0)
 S LA7Y(0)=$G(^DPT(LA7Y,0))
"RTN","LA7SBCR1",126,0)
 ; Zeroth node not found.
"RTN","LA7SBCR1",127,0)
 I LA7Y(0)="" S LA7("ERROR")="6^No zeroth node in file" Q
"RTN","LA7SBCR1",128,0)
 S LA7("DFN")=LA7Y
"RTN","LA7SBCR1",129,0)
 S LA7("DOB")=$P(LA7Y(0),"^",3)
"RTN","LA7SBCR1",130,0)
 ; Source file
"RTN","LA7SBCR1",131,0)
 S:LA7Y LA7("DPF")=2_U_"DPT("
"RTN","LA7SBCR1",132,0)
 S LA7("PNM")=$P(LA7Y(0),"^")
"RTN","LA7SBCR1",133,0)
 S LA7("RIEN")=+$G(^DPT(LA7Y,"LRT"))
"RTN","LA7SBCR1",134,0)
 S LA7("SEX")=$P(LA7Y(0),"^",2)
"RTN","LA7SBCR1",135,0)
 S LA7("SSN")=$P(LA7Y(0),"^",9)
"RTN","LA7SBCR1",136,0)
 D GETS^DIQ(2,LA7Y_",","2*","I","RACE","LA7ERR")
"RTN","LA7SBCR1",137,0)
 I '$D(LA7ERR) D
"RTN","LA7SBCR1",138,0)
 . S X=$Q(RACE(2.02)) Q:X=""
"RTN","LA7SBCR1",139,0)
 . S LA7("RACE")=$P(@X,"^")
"RTN","LA7SBCR1",140,0)
 Q
"RTN","LA7SBCR1",141,0)
 ;
"RTN","LA7SBCR1",142,0)
 ;
"RTN","LA7SBCR1",143,0)
LRTSET(LA7,LA7Y) ; Setup array from Lab Referral file.
"RTN","LA7SBCR1",144,0)
 S LA7Y(0)=$G(^LRT(67,LA7Y,0))
"RTN","LA7SBCR1",145,0)
 ; Zeroth node not found.
"RTN","LA7SBCR1",146,0)
 I LA7Y(0)="" S LA7("ERROR")="6^No zeroth node in file" Q
"RTN","LA7SBCR1",147,0)
 S LA7("DFN")=LA7Y
"RTN","LA7SBCR1",148,0)
 S LA7("DOB")=$P(LA7Y(0),"^",3)
"RTN","LA7SBCR1",149,0)
 ;
"RTN","LA7SBCR1",150,0)
 ; Source file
"RTN","LA7SBCR1",151,0)
 S:LA7Y LA7("DPF")=67_U_"LRT(67,"
"RTN","LA7SBCR1",152,0)
 ;
"RTN","LA7SBCR1",153,0)
 S LA7("PNM")=$P(LA7Y(0),"^")
"RTN","LA7SBCR1",154,0)
 S LA7("RIEN")=LA7Y
"RTN","LA7SBCR1",155,0)
 S LA7("SEX")=$P(LA7Y(0),"^",2)
"RTN","LA7SBCR1",156,0)
 S LA7("SSN")=$P(LA7Y(0),"^",9)
"RTN","LA7SBCR1",157,0)
 Q
"RTN","LA7SBCR1",158,0)
 ;
"RTN","LA7SBCR1",159,0)
 ;
"RTN","LA7SBCR1",160,0)
LPOSET(LA7,LA7Y) ; Setup array from LAB PENDING ORDERS file #69.6
"RTN","LA7SBCR1",161,0)
 ;
"RTN","LA7SBCR1",162,0)
 N I
"RTN","LA7SBCR1",163,0)
 F I=0,.1 S LA7Y(I)=$G(^LRO(69.6,LA7Y,I))
"RTN","LA7SBCR1",164,0)
 ; Zeroth node not found.
"RTN","LA7SBCR1",165,0)
 I LA7Y(0)="" D  Q
"RTN","LA7SBCR1",166,0)
 . S LA7("ERROR")="6^No zeroth node in file"
"RTN","LA7SBCR1",167,0)
 ; Patient identifiers don't match
"RTN","LA7SBCR1",168,0)
 I LA7("SSN")'=$P(LA7Y(0),U,9) Q
"RTN","LA7SBCR1",169,0)
 ;
"RTN","LA7SBCR1",170,0)
 S LA7("PNM")=$P(LA7Y(0),U,1)
"RTN","LA7SBCR1",171,0)
 S LA7("DOB")=$P(LA7Y(0),U,3)
"RTN","LA7SBCR1",172,0)
 S LA7("SEX")=$P(LA7Y(0),U,2)
"RTN","LA7SBCR1",173,0)
 S LA7("DPF")="67^LRT(67,"
"RTN","LA7SBCR1",174,0)
 S LA7("RACE")=$P(LA7Y(.1),U)
"RTN","LA7SBCR1",175,0)
 S LA7("ERROR")=""
"RTN","LA7SBCR1",176,0)
 S LA7("RIEN")=$O(^LRT(67,"C",LA7("SSN"),0))
"RTN","LA7SBCR1",177,0)
 I $G(LA7("RIEN")),$G(^LRT(67,LA7("RIEN"),"LR")) D
"RTN","LA7SBCR1",178,0)
 . S LA7("LRDFN")=^LRT(67,LA7("RIEN"),"LR")
"RTN","LA7SBCR1",179,0)
 . S LA7("DFN")=LA7("RIEN")
"RTN","LA7SBCR1",180,0)
 Q
"RTN","LA7SBCR1",181,0)
 ;
"RTN","LA7SBCR1",182,0)
 ;
"RTN","LA7SBCR1",183,0)
PD1 ; Read PD1 bar code information
"RTN","LA7SBCR1",184,0)
 ;
"RTN","LA7SBCR1",185,0)
 N LA7PROM
"RTN","LA7SBCR1",186,0)
 ;
"RTN","LA7SBCR1",187,0)
 S LA7PROM="Scan Patient Name Barcode (PD1)"
"RTN","LA7SBCR1",188,0)
 S LA7PROM(1)="Patient Demographics not found"
"RTN","LA7SBCR1",189,0)
 S LA7("ERROR")="",LA7Z=""
"RTN","LA7SBCR1",190,0)
 S Y=$$RD^LA7SBCR(.LA7PROM,1)
"RTN","LA7SBCR1",191,0)
 I Y<1 D  Q
"RTN","LA7SBCR1",192,0)
 . S LA7("ERROR")="2^Incorrect bar-code format"
"RTN","LA7SBCR1",193,0)
 ;
"RTN","LA7SBCR1",194,0)
 ; barcode info & longitudinal parity check
"RTN","LA7SBCR1",195,0)
 ; original style bar code
"RTN","LA7SBCR1",196,0)
 I $E(Y,1,10)="1^STX^PD1^" D
"RTN","LA7SBCR1",197,0)
 . S LA7Z=$P(Y,"STX^PD1^",2)
"RTN","LA7SBCR1",198,0)
 . S LA7Z=$P(LA7Z,"^ETX")
"RTN","LA7SBCR1",199,0)
 . S LA7Z("LPC")=$P(Y,"^ETX",2)
"RTN","LA7SBCR1",200,0)
 ; new style bar code
"RTN","LA7SBCR1",201,0)
 I $E(Y,1,6)="1^PD1^" D
"RTN","LA7SBCR1",202,0)
 . S LA7Z=$P(Y,"^",3,6)
"RTN","LA7SBCR1",203,0)
 . S LA7Z("LPC")=$P(Y,"^",7)
"RTN","LA7SBCR1",204,0)
 ;
"RTN","LA7SBCR1",205,0)
 I LA7Z="" D  Q
"RTN","LA7SBCR1",206,0)
 . S LA7("ERROR")="2^Incorrect bar-code format"
"RTN","LA7SBCR1",207,0)
 ;
"RTN","LA7SBCR1",208,0)
 I $G(LA7Z("LPC"))'=$G(LA7SCFG("LPC")) D  Q
"RTN","LA7SBCR1",209,0)
 . S LA7("ERROR")="10^Parity check does not match on (SM) and (PD1) barcodes"
"RTN","LA7SBCR1",210,0)
 ;
"RTN","LA7SBCR1",211,0)
 ; Name not found.
"RTN","LA7SBCR1",212,0)
 I $L($P(LA7Z,U,2))<2 D  Q
"RTN","LA7SBCR1",213,0)
 . S LA7("ERROR")="21^Unsuccessful name scan"
"RTN","LA7SBCR1",214,0)
 ;
"RTN","LA7SBCR1",215,0)
 ; wrong patient scanned not found.
"RTN","LA7SBCR1",216,0)
 I $P(LA7Z,U)'=LA7("SSN") D  Q
"RTN","LA7SBCR1",217,0)
 . S LA7("ERROR")="22^SSN does not match PD barcode"
"RTN","LA7SBCR1",218,0)
 ;
"RTN","LA7SBCR1",219,0)
 ; Wrong DOB format.
"RTN","LA7SBCR1",220,0)
 I $P(LA7Z,U,3)'?7N D  Q
"RTN","LA7SBCR1",221,0)
 . S LA7("ERROR")="23^Incorrect DOB"
"RTN","LA7SBCR1",222,0)
 ;
"RTN","LA7SBCR1",223,0)
 S LA7("PNM")=$P(LA7Z,U,2)
"RTN","LA7SBCR1",224,0)
 S LA7("DOB")=$P(LA7Z,U,3)
"RTN","LA7SBCR1",225,0)
 S LA7("SEX")=$P(LA7Z,U,4)
"RTN","LA7SBCR1",226,0)
 S LA7("DPF")="67^LRT(67,"
"RTN","LA7SBCR1",227,0)
 S LA7("ERROR")=""
"RTN","LA7SBCR1",228,0)
 Q
"RTN","LA7SBCR2")
0^52^B11631994
"RTN","LA7SBCR2",1,0)
LA7SBCR2 ;DALOI/JMC - Shipping Barcode Reader Utility ; 16 Sept 2004
"RTN","LA7SBCR2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,46,64**;Sep 27, 1994
"RTN","LA7SBCR2",3,0)
 ;
"RTN","LA7SBCR2",4,0)
 Q
"RTN","LA7SBCR2",5,0)
 ;
"RTN","LA7SBCR2",6,0)
SITE(LA7,LA7PROM,LA7BAR) ; Setup remote site info.
"RTN","LA7SBCR2",7,0)
 ; Input:
"RTN","LA7SBCR2",8,0)
 ;                  LA7=array to return values
"RTN","LA7SBCR2",9,0)
 ;              LA7PROM=prompt to display to user
"RTN","LA7SBCR2",10,0)
 ;               LA7BAR=0/1 using barcode reader
"RTN","LA7SBCR2",11,0)
 ; Screen: Second piece of bar-code must = SITE
"RTN","LA7SBCR2",12,0)
 ; Returns array LA7()
"RTN","LA7SBCR2",13,0)
 ;
"RTN","LA7SBCR2",14,0)
 ;  If successful ERROR=0
"RTN","LA7SBCR2",15,0)
 ;               IDTYPE=source of UID
"RTN","LA7SBCR2",16,0)
 ;                  LPC=longitudinal parity check of SM barcode info
"RTN","LA7SBCR2",17,0)
 ;               RPSITE=primary sending site ien^name^station number
"RTN","LA7SBCR2",18,0)
 ;                RSITE=sending site ien^name^station number
"RTN","LA7SBCR2",19,0)
 ;                 SCFG=pointer to shipping configuration (file #62.9)^name
"RTN","LA7SBCR2",20,0)
 ;                  SDT=Shipping date/time
"RTN","LA7SBCR2",21,0)
 ;                 SMID=shipping manifest id
"RTN","LA7SBCR2",22,0)
 ;           
"RTN","LA7SBCR2",23,0)
 ;   unsuccessful ERROR=>0^error message
"RTN","LA7SBCR2",24,0)
 ;
"RTN","LA7SBCR2",25,0)
 N LA7X,X,Y
"RTN","LA7SBCR2",26,0)
 ; Initialize array.
"RTN","LA7SBCR2",27,0)
 F Y="ERROR","IDTYPE","LPC","RPSITE","RSITE","SCFG","SDT","SMID" S LA7(Y)=""
"RTN","LA7SBCR2",28,0)
 S LA7PROM=$G(LA7PROM,"Site")
"RTN","LA7SBCR2",29,0)
 I LA7BAR D BAR
"RTN","LA7SBCR2",30,0)
 ;
"RTN","LA7SBCR2",31,0)
 I 'LA7BAR D
"RTN","LA7SBCR2",32,0)
 . N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LA7SBCR2",33,0)
 . S DIR(0)="PO^62.9:EM",DIR("A")="Select Shipping Configuration"
"RTN","LA7SBCR2",34,0)
 . S DIR("S")="I $P(^LAHM(62.9,Y,0),U,3)=DUZ(2),$P(^LAHM(62.9,Y,0),U,4)"
"RTN","LA7SBCR2",35,0)
 . D ^DIR
"RTN","LA7SBCR2",36,0)
 . I Y<1 S LA7("ERROR")=1 Q
"RTN","LA7SBCR2",37,0)
 . S LA7("SCFG")=Y
"RTN","LA7SBCR2",38,0)
 ;
"RTN","LA7SBCR2",39,0)
 I 'LA7("ERROR") D
"RTN","LA7SBCR2",40,0)
 . I LA7("SCFG") D GETSITE Q
"RTN","LA7SBCR2",41,0)
 . I 'LA7("SCFG") S LA7("ERROR")=3 Q
"RTN","LA7SBCR2",42,0)
 ;
"RTN","LA7SBCR2",43,0)
 I LA7("ERROR") D
"RTN","LA7SBCR2",44,0)
 . S LA7("ERROR")=LA7("ERROR")_"^"_$P($T(ERROR+LA7("ERROR")),";;",2)
"RTN","LA7SBCR2",45,0)
 ;
"RTN","LA7SBCR2",46,0)
 Q
"RTN","LA7SBCR2",47,0)
 ;
"RTN","LA7SBCR2",48,0)
 ;
"RTN","LA7SBCR2",49,0)
GETSITE ; Retrieve site info from institution file for this shipping configuration.
"RTN","LA7SBCR2",50,0)
 ; Set ID type from shipping configuration.
"RTN","LA7SBCR2",51,0)
 N LRX,LRY,X,Y
"RTN","LA7SBCR2",52,0)
 S Y(0)=$G(^LAHM(62.9,+LA7("SCFG"),0))
"RTN","LA7SBCR2",53,0)
 S LA7("IDTYPE")=$P(Y(0),"^",5)
"RTN","LA7SBCR2",54,0)
 ;
"RTN","LA7SBCR2",55,0)
 ; *** Remove line when other id types supported. ***
"RTN","LA7SBCR2",56,0)
 I LA7("IDTYPE")>1 S LA7("ERROR")=4
"RTN","LA7SBCR2",57,0)
 ;
"RTN","LA7SBCR2",58,0)
 S LRX=$P(Y(0),"^",2)
"RTN","LA7SBCR2",59,0)
 S LRY=$$GET1^DIQ(4,LRX_",",.01)
"RTN","LA7SBCR2",60,0)
 I LRX,LRY'="" D
"RTN","LA7SBCR2",61,0)
 . S LRY(99)=$$RETFACID^LA7VHLU2(LRX,2,1)
"RTN","LA7SBCR2",62,0)
 . S LA7("RSITE")=LRX_"^"_LRY_"^"_LRY(99)
"RTN","LA7SBCR2",63,0)
 E  S LA7("ERROR")=5
"RTN","LA7SBCR2",64,0)
 ;
"RTN","LA7SBCR2",65,0)
 S LRX=$P(Y(0),"^",6)
"RTN","LA7SBCR2",66,0)
 S LRY=$$GET1^DIQ(4,LRX_",",.01)
"RTN","LA7SBCR2",67,0)
 I LRX,LRY'="" D
"RTN","LA7SBCR2",68,0)
 . S LRY(99)=$$RETFACID^LA7VHLU2(LRX,2,1)
"RTN","LA7SBCR2",69,0)
 . S LA7("RPSITE")=LRX_"^"_LRY_"^"_LRY(99)
"RTN","LA7SBCR2",70,0)
 E  S LA7("ERROR")=5
"RTN","LA7SBCR2",71,0)
 Q
"RTN","LA7SBCR2",72,0)
 ;
"RTN","LA7SBCR2",73,0)
 ;
"RTN","LA7SBCR2",74,0)
BAR ; Read SM bar code
"RTN","LA7SBCR2",75,0)
 ;
"RTN","LA7SBCR2",76,0)
 N LA7BCS,Y
"RTN","LA7SBCR2",77,0)
 ;
"RTN","LA7SBCR2",78,0)
 S Y=$$RD^LA7SBCR(.LA7PROM,1),LA7=""
"RTN","LA7SBCR2",79,0)
 I Y=0 S LA7("ERROR")=1 Q
"RTN","LA7SBCR2",80,0)
 I Y<1 S LA7("ERROR")=2 Q
"RTN","LA7SBCR2",81,0)
 ;
"RTN","LA7SBCR2",82,0)
 ; barcode info & longitudinal parity check
"RTN","LA7SBCR2",83,0)
 ; original bar code style
"RTN","LA7SBCR2",84,0)
 I $E(Y,1,11)="1^STX^SITE^" D
"RTN","LA7SBCR2",85,0)
 . S LA7=$P(Y,"STX^SITE^",2)
"RTN","LA7SBCR2",86,0)
 . S LA7=$P(LA7,"^ETX",1)
"RTN","LA7SBCR2",87,0)
 . S LA7("LPC")=$P(Y,"^ETX",2)
"RTN","LA7SBCR2",88,0)
 ; new bar code style
"RTN","LA7SBCR2",89,0)
 I $E(Y,1,7)="1^SITE^" D
"RTN","LA7SBCR2",90,0)
 . S LA7=$P(Y,"^",3,5)
"RTN","LA7SBCR2",91,0)
 . S LA7("LPC")=$P(Y,"^",6)
"RTN","LA7SBCR2",92,0)
 . S LA7BCS=1
"RTN","LA7SBCR2",93,0)
 ;
"RTN","LA7SBCR2",94,0)
 I LA7="" S LA7("ERROR")=2 Q
"RTN","LA7SBCR2",95,0)
 ;
"RTN","LA7SBCR2",96,0)
 I $P(LA7,"^")'="" D
"RTN","LA7SBCR2",97,0)
 . N X,Y,Z
"RTN","LA7SBCR2",98,0)
 . S Z=$$FINDSITE^LA7VHLU2($P(LA7,"^"),2,1)
"RTN","LA7SBCR2",99,0)
 . I Z="" S LA7("ERROR")=5 Q
"RTN","LA7SBCR2",100,0)
 . S (X,Y)=0
"RTN","LA7SBCR2",101,0)
 . F  S X=$O(^LAHM(62.9,"C",Z,X)) Q:'X  D  Q:Y
"RTN","LA7SBCR2",102,0)
 . . S X(0)=$G(^LAHM(62.9,X,0))
"RTN","LA7SBCR2",103,0)
 . . I $P(X(0),"^",3)=DUZ(2),$P(X(0),"^",4) S LA7("SCFG")=X_"^"_$P(X(0),"^"),Y=1
"RTN","LA7SBCR2",104,0)
 ;
"RTN","LA7SBCR2",105,0)
 ; shipping date/time
"RTN","LA7SBCR2",106,0)
 I $P(LA7,"^",2) S LA7("SDT")=$$DT^LA7SBCR($P(LA7,"^",2))
"RTN","LA7SBCR2",107,0)
 ;
"RTN","LA7SBCR2",108,0)
 ; shipping manifest id
"RTN","LA7SBCR2",109,0)
 I $P(LA7,"^",3)'="" S LA7("SMID")=$P(LA7,"^",3)
"RTN","LA7SBCR2",110,0)
 ;
"RTN","LA7SBCR2",111,0)
 Q
"RTN","LA7SBCR2",112,0)
 ;
"RTN","LA7SBCR2",113,0)
 ;
"RTN","LA7SBCR2",114,0)
ERROR ;; Code/Text of error messages
"RTN","LA7SBCR2",115,0)
1 ;;User timeout/abort;;
"RTN","LA7SBCR2",116,0)
2 ;;Incorrect barcode format;;
"RTN","LA7SBCR2",117,0)
3 ;;No Shipping Configuration identified in file #62.9;;
"RTN","LA7SBCR2",118,0)
4 ;;Sender's Specimen ID source not presently supported;;
"RTN","LA7SBCR2",119,0)
5 ;;No entry in INSTITUTION file #4;;
"RTN","LA7SCE")
0^46^B59304536
"RTN","LA7SCE",1,0)
LA7SCE ;DALOI/JMC - Shipping Configuration Utility ;5/5/97  14:44
"RTN","LA7SCE",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,46,61,64**;Sep 27, 1994
"RTN","LA7SCE",3,0)
 Q
"RTN","LA7SCE",4,0)
 ;
"RTN","LA7SCE",5,0)
SCFE ; Edit file #62.9, Shipping Configuration.
"RTN","LA7SCE",6,0)
 ;
"RTN","LA7SCE",7,0)
 N DA,DIE,DIC,DIR,DLAYGO,DIRUT,DR,DTOUT,DIROUT,X,Y
"RTN","LA7SCE",8,0)
 N LA7CHECK,LA7COPY,LA7NVAF,LA7SCFG,LA7SCFR,LA7TYPE,LA7VAF,LA7X,LR62,LRSS
"RTN","LA7SCE",9,0)
 ;
"RTN","LA7SCE",10,0)
 S DIC="^LAHM(62.9,",DIC(0)="AELMQZ",DIC("A")="Select SHIPPING CONFIGURATION: "
"RTN","LA7SCE",11,0)
 S DIC("DR")=".02;.03",DLAYGO=62.9
"RTN","LA7SCE",12,0)
 D ^DIC
"RTN","LA7SCE",13,0)
 K DA,DIC,DIE,DR
"RTN","LA7SCE",14,0)
 I Y<1 Q
"RTN","LA7SCE",15,0)
 ;
"RTN","LA7SCE",16,0)
 S LA7SCFG=+Y,LA7SCFG(0)=Y(0)
"RTN","LA7SCE",17,0)
 ;
"RTN","LA7SCE",18,0)
 L +^LAHM(62.9,LA7SCFG):5
"RTN","LA7SCE",19,0)
 I '$T D  Q
"RTN","LA7SCE",20,0)
 . D EN^DDIOL("Unable to obtain lock on entry "_$P(LA7SCFG(0),"^"),"","!?3")
"RTN","LA7SCE",21,0)
 ;
"RTN","LA7SCE",22,0)
 S DIR(0)="SO^1:Collecting facility;2:Host facility",DIR("A")="Are you editing this entry as the"
"RTN","LA7SCE",23,0)
 S DIR("?",1)="Is this entry used by the Collecting facility to ship specimens,"
"RTN","LA7SCE",24,0)
 S DIR("?",2)="or by the Host facility to accept a shipment."
"RTN","LA7SCE",25,0)
 S DIR("?")="This determines which fields are edited in the file."
"RTN","LA7SCE",26,0)
 D ^DIR
"RTN","LA7SCE",27,0)
 I $D(DIRUT) D UNL629 Q
"RTN","LA7SCE",28,0)
 S LA7TYPE=+Y
"RTN","LA7SCE",29,0)
 ;
"RTN","LA7SCE",30,0)
 ; Determine if other facility is non-VA.
"RTN","LA7SCE",31,0)
 ; When acting as collecting facility is host non-VA
"RTN","LA7SCE",32,0)
 ; When acting as host is collecting facility non-VA
"RTN","LA7SCE",33,0)
 S LA7VAF="",LA7NVAF=0
"RTN","LA7SCE",34,0)
 I $P(LA7SCFG(0),"^",2),$P(LA7SCFG(0),"^",3) D
"RTN","LA7SCE",35,0)
 . S LA7X=$S(LA7TYPE=1:$P(LA7SCFG(0),"^",3),1:$P(LA7SCFG(0),"^",2))
"RTN","LA7SCE",36,0)
 . S LA7VAF=$$GET1^DIQ(4,LA7X_",","AGENCY CODE","I")
"RTN","LA7SCE",37,0)
 . S LA7NVAF=$$NVAF^LA7VHLU2(LA7X)
"RTN","LA7SCE",38,0)
 I LA7VAF="" D  Q
"RTN","LA7SCE",39,0)
 . N LA7MSG
"RTN","LA7SCE",40,0)
 . S LA7MSG="Unable to proceed - institution "
"RTN","LA7SCE",41,0)
 . S LA7MSG=LA7MSG_$$GET1^DIQ(4,$S(LA7TYPE=1:$P(LA7SCFG(0),"^",3),1:$P(LA7SCFG(0),"^",2))_",",.01)
"RTN","LA7SCE",42,0)
 . S LA7MSG=LA7MSG_" missing AGENCY CODE field in INSITUTION file (#4)"
"RTN","LA7SCE",43,0)
 . D EN^DDIOL(LA7MSG,"","!!?3")
"RTN","LA7SCE",44,0)
 . D UNL629
"RTN","LA7SCE",45,0)
 ;
"RTN","LA7SCE",46,0)
 ; If acting as host ask if user wants to copy test config from another entry.
"RTN","LA7SCE",47,0)
 I LA7TYPE=2 D
"RTN","LA7SCE",48,0)
 . N DIC,Y
"RTN","LA7SCE",49,0)
 . S LA7COPY=$$ASKCOPY
"RTN","LA7SCE",50,0)
 . I LA7COPY<1 Q
"RTN","LA7SCE",51,0)
 . S LA7CHECK=$$CHECK(LA7SCFG)
"RTN","LA7SCE",52,0)
 . I LA7CHECK<1 S LA7COPY=LA7CHECK Q
"RTN","LA7SCE",53,0)
 . I LA7COPY<1 Q
"RTN","LA7SCE",54,0)
 . I LA7COPY=1 D  Q
"RTN","LA7SCE",55,0)
 . . S DIC="^LAHM(62.9,",DIC(0)="AEMQZ",DIC("A")="Select SHIPPING CONFIGURATION to COPY FROM: ",DIC("S")="I Y'=LA7SCFG"
"RTN","LA7SCE",56,0)
 . . D ^DIC K DIC("S")
"RTN","LA7SCE",57,0)
 . . I Y<1 Q
"RTN","LA7SCE",58,0)
 . . S LA7SCFR=+Y,LA7SCFR(0)=Y(0)
"RTN","LA7SCE",59,0)
 . . D CLRSCT(.LA7SCFG)
"RTN","LA7SCE",60,0)
 . . D COPYSC(.LA7SCFR,.LA7SCFG)
"RTN","LA7SCE",61,0)
 . I LA7COPY=2 D  Q
"RTN","LA7SCE",62,0)
 . . D CLRSCT(.LA7SCFG)
"RTN","LA7SCE",63,0)
 . . D COPY60(.LA7SCFG)
"RTN","LA7SCE",64,0)
 I LA7TYPE=2,LA7COPY<0 D UNL629 Q
"RTN","LA7SCE",65,0)
 K DA,DIE,DIC,DIR,DLAYGO,DIRUT,DR,DTOUT,DIROUT,X,Y
"RTN","LA7SCE",66,0)
 ;
"RTN","LA7SCE",67,0)
 ; Set up DR string when acting as collecting facility
"RTN","LA7SCE",68,0)
 I LA7TYPE=1 D
"RTN","LA7SCE",69,0)
 . S DR=".01;.02;.06;.03;.031;"
"RTN","LA7SCE",70,0)
 . I LA7NVAF>1 S DR=DR_".11;.12;.14;.15;"
"RTN","LA7SCE",71,0)
 . I LA7NVAF=1 S DR=DR_".14////1;.15////1;"
"RTN","LA7SCE",72,0)
 . S DR=DR_".04;.07;.08;.09;.1;.13;60"
"RTN","LA7SCE",73,0)
 . S DR(2,62.9001)=".01;.02;.025;.03;.04;.05;.06;.07"
"RTN","LA7SCE",74,0)
 ;
"RTN","LA7SCE",75,0)
 ; Set up DR string when acting as host facility
"RTN","LA7SCE",76,0)
 I LA7TYPE=2 D
"RTN","LA7SCE",77,0)
 . S DR=".01;.02;.06;.03;.031;"
"RTN","LA7SCE",78,0)
 . I LA7NVAF>1 S DR=DR_".11;.14;.15;"
"RTN","LA7SCE",79,0)
 . I LA7NVAF=1 S DR=DR_".14////0;.15////1;"
"RTN","LA7SCE",80,0)
 . S DR=DR_".04;.05;60"
"RTN","LA7SCE",81,0)
 . S DR(2,62.9001)=".01;S LRSS=$P(^LAB(60,X,0),U,4);.04;.09;S LR62=X I LRSS'=""MI"" S Y=""@2"";I LR62,$P(^LAB(62,LR62,0),U,2)'="""" S Y=""@2"";.03;5.7;@2"
"RTN","LA7SCE",82,0)
 ;
"RTN","LA7SCE",83,0)
 ; Determine if non-VA test codes/specimen fields should be asked
"RTN","LA7SCE",84,0)
 I LA7VAF'="V" D
"RTN","LA7SCE",85,0)
 . S DR(2,62.9001)=DR(2,62.9001)_";I $P(^LAHM(62.9,LA7SCFG,0),U,15)'=1 S Y=""@9"";5.1;5.2;5.5"
"RTN","LA7SCE",86,0)
 . I LA7TYPE=1,LA7NVAF=1 S DR(2,62.9001)=DR(2,62.9001)_"////99LST"
"RTN","LA7SCE",87,0)
 . S DR(2,62.9001)=DR(2,62.9001)_";@9"
"RTN","LA7SCE",88,0)
 . I LA7TYPE=1 D
"RTN","LA7SCE",89,0)
 . . S DR(2,62.9001)=DR(2,62.9001)_";I $P(^LAHM(62.9,LA7SCFG,0),U,16)'=1 S Y=""@10"";5.3;5.4;5.6"
"RTN","LA7SCE",90,0)
 . . I LA7NVAF=1 S DR(2,62.9001)=DR(2,62.9001)_"////99LRP;5.7;5.8;5.9////99LRS"
"RTN","LA7SCE",91,0)
 . . S DR(2,62.9001)=DR(2,62.9001)_";@10"
"RTN","LA7SCE",92,0)
 . I LA7TYPE=2 D
"RTN","LA7SCE",93,0)
 . . S DR(2,62.9001)=DR(2,62.9001)_";I $P(^LAHM(62.9,LA7SCFG,0),U,16)'=1 S Y=""@10"";5.3;5.4;5.6"
"RTN","LA7SCE",94,0)
 . . I LA7NVAF=1 S DR(2,62.9001)=DR(2,62.9001)_"////99LRP"
"RTN","LA7SCE",95,0)
 . . S DR(2,62.9001)=DR(2,62.9001)_";@10"
"RTN","LA7SCE",96,0)
 ;
"RTN","LA7SCE",97,0)
 I LA7TYPE=1 D
"RTN","LA7SCE",98,0)
 . N J,K
"RTN","LA7SCE",99,0)
 . S DR(2,62.9001)=DR(2,62.9001)_";"
"RTN","LA7SCE",100,0)
 . S X="1.1;I 'X S Y=1.2;1.15;1.16;1.2;I 'X S Y=2.1;1.25;1.26;2.1;I '+X S Y=2.3;2.15;2.16;2.3;I '+X S Y=2.2;2.35;2.36;2.2;I '+X S Y=""@12"";2.25;2.26;@12"
"RTN","LA7SCE",101,0)
 . I ($L(DR(2,62.9001))+$L(X))<246 S DR(2,62.9001)=DR(2,62.9001)_X Q
"RTN","LA7SCE",102,0)
 . S K=$L(X,";")
"RTN","LA7SCE",103,0)
 . F J=1:1:K D
"RTN","LA7SCE",104,0)
 . . I ($L(DR(2,62.9001))+$L($P(X,";")))>244 S J=K Q
"RTN","LA7SCE",105,0)
 . . S DR(2,62.9001)=DR(2,62.9001)_$P(X,";")_";",X=$P(X,";",2,K)
"RTN","LA7SCE",106,0)
 . I X'="" S DR(2,62.9001,1)=X
"RTN","LA7SCE",107,0)
 ;
"RTN","LA7SCE",108,0)
 S DA=LA7SCFG,DIE="^LAHM(62.9,"
"RTN","LA7SCE",109,0)
 D ^DIE,UNL629
"RTN","LA7SCE",110,0)
 Q
"RTN","LA7SCE",111,0)
 ;
"RTN","LA7SCE",112,0)
 ;
"RTN","LA7SCE",113,0)
 ; Unlock entry in 62.9
"RTN","LA7SCE",114,0)
UNL629 L -^LAHM(62.9,LA7SCFG)
"RTN","LA7SCE",115,0)
 ;
"RTN","LA7SCE",116,0)
 Q
"RTN","LA7SCE",117,0)
 ;
"RTN","LA7SCE",118,0)
 ;
"RTN","LA7SCE",119,0)
SCTE ; Edit file #62.91, Shipping Container.
"RTN","LA7SCE",120,0)
 N DA,DIE,DIC,DLAYGO,DR,X,Y
"RTN","LA7SCE",121,0)
 S DIC="^LAHM(62.91,",DIC(0)="AELMQZ",DIC("A")="Select SHIPPING CONTAINER: ",DLAYGO=62.91
"RTN","LA7SCE",122,0)
 D ^DIC
"RTN","LA7SCE",123,0)
 I Y<1 Q
"RTN","LA7SCE",124,0)
 S DA=+Y,DIE=DIC,DR=".01;.02"
"RTN","LA7SCE",125,0)
 D ^DIE
"RTN","LA7SCE",126,0)
 Q
"RTN","LA7SCE",127,0)
 ;
"RTN","LA7SCE",128,0)
 ;
"RTN","LA7SCE",129,0)
SCME ; Edit file #62.92, Shipping Method.
"RTN","LA7SCE",130,0)
 N DA,DIE,DIC,DLAYGO,DR,X,Y
"RTN","LA7SCE",131,0)
 S DIC="^LAHM(62.92,",DIC(0)="AELMQZ",DIC("A")="Select SHIPPING METHOD: ",DLAYGO=62.92
"RTN","LA7SCE",132,0)
 D ^DIC
"RTN","LA7SCE",133,0)
 I Y<1 Q
"RTN","LA7SCE",134,0)
 S DA=+Y,DIE=DIC,DR=".01;.02"
"RTN","LA7SCE",135,0)
 D ^DIE
"RTN","LA7SCE",136,0)
 Q
"RTN","LA7SCE",137,0)
 ;
"RTN","LA7SCE",138,0)
 ;
"RTN","LA7SCE",139,0)
SCDE ; Edit file #62.93, Shipping Condition.
"RTN","LA7SCE",140,0)
 N DA,DIE,DIC,DLAYGO,DR,X,Y
"RTN","LA7SCE",141,0)
 S DIC="^LAHM(62.93,",DIC(0)="AELMQZ",DIC("A")="Select SHIPPING CONDITION: ",DLAYGO=62.93
"RTN","LA7SCE",142,0)
 D ^DIC
"RTN","LA7SCE",143,0)
 I Y<1 Q
"RTN","LA7SCE",144,0)
 S DA=+Y,DIE=DIC,DR=".01;.02"
"RTN","LA7SCE",145,0)
 D ^DIE
"RTN","LA7SCE",146,0)
 Q
"RTN","LA7SCE",147,0)
 ;
"RTN","LA7SCE",148,0)
 ;
"RTN","LA7SCE",149,0)
ASKCOPY() ; Ask if user want to copy tests from file #60 or another configuration in file #62.9 LAB SHIPPING CONFIGURATION
"RTN","LA7SCE",150,0)
 ;  Returns LA7COPY = -1 user quit/aborted
"RTN","LA7SCE",151,0)
 ;                  = 0 do not copy
"RTN","LA7SCE",152,0)
 ;                  = 1 use file #60
"RTN","LA7SCE",153,0)
 ;                  = 2 use another entry in #62.49
"RTN","LA7SCE",154,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LA7SCE",155,0)
 S DIR(0)="SMO^0:Do NOT copy;1:Another Shipping Configuration;2:Test Catalog - LABORATORY TEST File #60"
"RTN","LA7SCE",156,0)
 S DIR("A")="Copy a test profile from",DIR("B")="Do NOT copy"
"RTN","LA7SCE",157,0)
 S DIR("?",1)="If you want to duplicate a shipping configuration using another configuration"
"RTN","LA7SCE",158,0)
 S DIR("?",2)="or build from the tests marked as catalog tests in the LABORATORY TEST file."
"RTN","LA7SCE",159,0)
 S DIR("?")="Select the appropiate option."
"RTN","LA7SCE",160,0)
 D ^DIR
"RTN","LA7SCE",161,0)
 I $D(DIRUT) S Y=-1
"RTN","LA7SCE",162,0)
 Q Y
"RTN","LA7SCE",163,0)
 ;
"RTN","LA7SCE",164,0)
 ;
"RTN","LA7SCE",165,0)
CHECK(LA7SCFG) ; Check if test exists for configuration and warn if overwriting
"RTN","LA7SCE",166,0)
 ; Call with LA7SCFG = shiping configuration ien
"RTN","LA7SCE",167,0)
 ;   Returns  -1 = user aborted/timeout
"RTN","LA7SCE",168,0)
 ;             0 = no - don't overwrite
"RTN","LA7SCE",169,0)
 ;             1 = yes - overwrite
"RTN","LA7SCE",170,0)
 I '$O(^LAHM(62.9,LA7SCFG,60,0)) Q 1
"RTN","LA7SCE",171,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LA7SCE",172,0)
 S DIR(0)="SBO^0:NO;1:YES"
"RTN","LA7SCE",173,0)
 S DIR("A",1)="Tests already exist for this configuration!",DIR("A")="Are you sure",DIR("B")="NO"
"RTN","LA7SCE",174,0)
 D ^DIR
"RTN","LA7SCE",175,0)
 I $D(DIRUT) S Y=-1
"RTN","LA7SCE",176,0)
 Q Y
"RTN","LA7SCE",177,0)
 ;
"RTN","LA7SCE",178,0)
 ;
"RTN","LA7SCE",179,0)
COPYSC(LA7FR,LA7TO) ; Copy one shipping configuration to another
"RTN","LA7SCE",180,0)
 ; Call with LA7FR = shipping configuration to copy FROM.
"RTN","LA7SCE",181,0)
 ;           LA7TO = shipping configuration ien to copy TO.
"RTN","LA7SCE",182,0)
 N LA760,LA762,LA6205,LA7X
"RTN","LA7SCE",183,0)
 W !!,"Copying tests from configuration: ",$P(LA7FR(0),"^")," to ",$P(LA7TO(0),"^"),!
"RTN","LA7SCE",184,0)
 S LA7X=0
"RTN","LA7SCE",185,0)
 F  S LA7X=$O(^LAHM(62.9,LA7FR,60,LA7X)) Q:'LA7X  D
"RTN","LA7SCE",186,0)
 . S LA760=$P($G(^LAHM(62.9,LA7FR,60,LA7X,0)),"^") ; file #60 laboratory test ien.
"RTN","LA7SCE",187,0)
 . S LA76205=$P($G(^LAHM(62.9,LA7FR,60,LA7X,0)),"^",4) ; file #62.05, urgency ien.
"RTN","LA7SCE",188,0)
 . S LA762=$P($G(^LAHM(62.9,LA7FR,60,LA7X,0)),"^",9) ; file #62, collection sample ien.
"RTN","LA7SCE",189,0)
 . I LA760 D FDA629(LA7TO,LA760,LA762,LA76205)
"RTN","LA7SCE",190,0)
 Q
"RTN","LA7SCE",191,0)
 ;
"RTN","LA7SCE",192,0)
 ;
"RTN","LA7SCE",193,0)
COPY60(LA7SCFG) ; Copy catalog tests from file #60 to shipping configuration.
"RTN","LA7SCE",194,0)
 ; Call with LA7SCFG = shipping configuration ien to add tests to from file #60
"RTN","LA7SCE",195,0)
 N LA760,LA762,LA7X
"RTN","LA7SCE",196,0)
 W !!,"Copying tests from file #60 LABORATORY TEST to ",$P(LA7SCFG(0),"^"),!
"RTN","LA7SCE",197,0)
 S LA760=0 ; file #60 pointer
"RTN","LA7SCE",198,0)
 I '$D(^LAHM(62.9,LA7SCFG,60,0)) S ^LAHM(62.9,LA7SCFG,60,0)="^62.9001P^0^0" ; set subfile zeroth node
"RTN","LA7SCE",199,0)
 F  S LA760=$O(^LAB(60,LA760)) Q:'LA760  D
"RTN","LA7SCE",200,0)
 . I '$P($G(^LAB(60,LA760,64)),"^",3) Q  ; Not a catalog item
"RTN","LA7SCE",201,0)
 . S LA7X=0
"RTN","LA7SCE",202,0)
 . F  S LA7X=$O(^LAB(60,LA760,3,LA7X)) Q:'LA7X  D
"RTN","LA7SCE",203,0)
 . . S LA762=+$G(^LAB(60,LA760,3,LA7X,0)) ; file #62 pointer (collection sample)
"RTN","LA7SCE",204,0)
 . . I LA762 D FDA629(LA7SCFG,LA760,LA762,"")
"RTN","LA7SCE",205,0)
 Q
"RTN","LA7SCE",206,0)
 ;
"RTN","LA7SCE",207,0)
 ;
"RTN","LA7SCE",208,0)
FDA629(LA7SCFG,LA760,LA762,LA76205) ; Add entry to TEST/PROFILE multiple
"RTN","LA7SCE",209,0)
 ; Call with  LA7SCFG = file #62.9, shipping configuration ien
"RTN","LA7SCE",210,0)
 ;              LA760 = file #60, lab test ien
"RTN","LA7SCE",211,0)
 ;              LA762 = file #62, collection sample ien
"RTN","LA7SCE",212,0)
 ;            LA76205 = file #62.05 , urgency ien
"RTN","LA7SCE",213,0)
 N FDA,LA7DIE,LA7629
"RTN","LA7SCE",214,0)
 S LA7629(1)=LA7SCFG
"RTN","LA7SCE",215,0)
 S FDA(629,62.9001,"+2,"_+LA7SCFG_",",.01)=LA760
"RTN","LA7SCE",216,0)
 I LA76205 S FDA(629,62.9001,"+2,"_+LA7SCFG_",",.04)=LA76205
"RTN","LA7SCE",217,0)
 I LA762 S FDA(629,62.9001,"+2,"_+LA7SCFG_",",.09)=LA762
"RTN","LA7SCE",218,0)
 W:$X>(IOM-2) ! W "#"
"RTN","LA7SCE",219,0)
 D UPDATE^DIE("","FDA(629)","LA7629","LA7DIE(629)") ; Add test to shipping configuration.
"RTN","LA7SCE",220,0)
 Q
"RTN","LA7SCE",221,0)
 ;
"RTN","LA7SCE",222,0)
 ;
"RTN","LA7SCE",223,0)
CLRSCT(LA7SCFG) ; Clear shipping configuration tests.
"RTN","LA7SCE",224,0)
 ; Call with LA7SCFG = file #62.9, shipping configuration ien
"RTN","LA7SCE",225,0)
 N DA,DIK,LA7X
"RTN","LA7SCE",226,0)
 W !!,"Clearing existing tests from configuration: ",$P(LA7SCFG(0),"^"),!
"RTN","LA7SCE",227,0)
 S DA(1)=+LA7SCFG,DIK="^LAHM(62.9,"_DA(1)_",60,"
"RTN","LA7SCE",228,0)
 S LA7X=0
"RTN","LA7SCE",229,0)
 F  S LA7X=$O(^LAHM(62.9,LA7SCFG,60,LA7X)) Q:'LA7X  D
"RTN","LA7SCE",230,0)
 . W:$X>(IOM-2) ! W "*"
"RTN","LA7SCE",231,0)
 . S DA=LA7X D ^DIK
"RTN","LA7SCE",232,0)
 Q
"RTN","LA7SM2")
0^44^B71701384
"RTN","LA7SM2",1,0)
LA7SM2 ;DALOI/JMC - Shipping Manifest Options ;5/5/97  14:39
"RTN","LA7SM2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7SM2",3,0)
 ;
"RTN","LA7SM2",4,0)
REQINFO ; Enter required information prior to shipping.
"RTN","LA7SM2",5,0)
 D INIT^LA7SM
"RTN","LA7SM2",6,0)
 I LA7QUIT D CLEANUP^LA7SM Q
"RTN","LA7SM2",7,0)
 S LA7SM=$$SELSM^LA7SMU(+LA7SCFG,"0,1,3")
"RTN","LA7SM2",8,0)
 I LA7SM<0 D  Q
"RTN","LA7SM2",9,0)
 . D EN^DDIOL($P(LA7SM,"^",2),"","!?5")
"RTN","LA7SM2",10,0)
 . D CLEANUP^LA7SM
"RTN","LA7SM2",11,0)
 D LOCKSM^LA7SM
"RTN","LA7SM2",12,0)
 I LA7QUIT D  Q
"RTN","LA7SM2",13,0)
 . D EN^DDIOL($P(LA7QUIT,"^",2),"","!?5")
"RTN","LA7SM2",14,0)
 . D UNLOCKSM^LA7SM,CLEANUP^LA7SM
"RTN","LA7SM2",15,0)
 S LA7SM(0)=$G(^LAHM(62.8,+LA7SM,0))
"RTN","LA7SM2",16,0)
 F  D INFOEE Q:LA7QUIT
"RTN","LA7SM2",17,0)
 D UNLOCKSM^LA7SM
"RTN","LA7SM2",18,0)
 I LA7QUIT,$L($P(LA7QUIT,"^",2)) D EN^DDIOL($P(LA7QUIT,"^",2),"","!?5")
"RTN","LA7SM2",19,0)
 E  D ASK^LA7SMP(LA7SM)
"RTN","LA7SM2",20,0)
 D CLEANUP^LA7SM
"RTN","LA7SM2",21,0)
 Q
"RTN","LA7SM2",22,0)
 ;
"RTN","LA7SM2",23,0)
INFOEE ; Required Info Enter/Edit
"RTN","LA7SM2",24,0)
 ;
"RTN","LA7SM2",25,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,LA7CDT,LA7I,LA7INFO,LA7J,LA7RINFO,LA7TCNT,LA7X,LA7Y,X,Y
"RTN","LA7SM2",26,0)
 ;
"RTN","LA7SM2",27,0)
 D SEL^LA7SM
"RTN","LA7SM2",28,0)
 I LA7QUIT Q
"RTN","LA7SM2",29,0)
 ;
"RTN","LA7SM2",30,0)
 S (LA7I,LA7TCNT)=0
"RTN","LA7SM2",31,0)
 F  S LA7I=$O(^LAHM(62.8,+LA7SM,10,"UID",LA7UID,LA7I)) Q:'LA7I  D
"RTN","LA7SM2",32,0)
 . F LA7J=0,1,2 S LA7I(LA7J)=$G(^LAHM(62.8,+LA7SM,10,LA7I,LA7J))
"RTN","LA7SM2",33,0)
 . I $P(LA7I(0),"^",8)=0 Q  ; Previously "removed".
"RTN","LA7SM2",34,0)
 . I $P(LA7I(0),"^",8),$P(LA7I(0),"^",8)'=1 S LA7QUIT="1^Accession not pending shipment" Q  ; Not pending shipment
"RTN","LA7SM2",35,0)
 . S LA7TCNT=LA7TCNT+1
"RTN","LA7SM2",36,0)
 . F LA7J=1,4 I $P(LA7I(1),"^",LA7J) D
"RTN","LA7SM2",37,0)
 . . I '$P(LA7I(1),"^",LA7J+2) Q  ; No units specified
"RTN","LA7SM2",38,0)
 . . S LA7X=$S(LA7J=1:1.11,LA7J=4:1.21,1:0)
"RTN","LA7SM2",39,0)
 . . S LA7RINFO(LA7X)=$P(LA7I(1),"^",LA7J+1) ; Value
"RTN","LA7SM2",40,0)
 . . S $P(LA7RINFO(LA7X),"^",2)=$P(LA7I(1),"^",LA7J+2) ; Units
"RTN","LA7SM2",41,0)
 . . S LA7RINFO(LA7X,LA7I)=LA7RINFO(LA7X)_"^"_$P(LA7I(0),"^",2)
"RTN","LA7SM2",42,0)
 . F LA7J=1,4,8 I $P(LA7I(2),"^",LA7J) D
"RTN","LA7SM2",43,0)
 . . I '($S(LA7J=4:$P(LA7I(2),"^",7),1:$P(LA7I(2),"^",LA7J+2))) Q  ; No units specified.
"RTN","LA7SM2",44,0)
 . . S LA7X=$S(LA7J=1:2.11,LA7J=4:2.21,LA7J=8:2.31,1:0)
"RTN","LA7SM2",45,0)
 . . S LA7RINFO(LA7X)=$P(LA7I(2),"^",LA7J+1) ; Value
"RTN","LA7SM2",46,0)
 . . S $P(LA7RINFO(LA7X),"^",2)=$S(LA7J=4:$P(LA7I(2),"^",7),1:$P(LA7I(2),"^",LA7J+2)) ; Units
"RTN","LA7SM2",47,0)
 . . S LA7RINFO(LA7X,LA7I)=LA7RINFO(LA7X)_"^"_$P(LA7I(0),"^",2)
"RTN","LA7SM2",48,0)
 ;
"RTN","LA7SM2",49,0)
 I 'LA7TCNT,'LA7QUIT S LA7QUIT="1^Accession is not on this shipping manifest"
"RTN","LA7SM2",50,0)
 I '$O(LA7RINFO(0)),'LA7QUIT S LA7QUIT="1^No test needs required information for shipping"
"RTN","LA7SM2",51,0)
 I LA7QUIT Q
"RTN","LA7SM2",52,0)
 ;
"RTN","LA7SM2",53,0)
 S LA7CDT=+$P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,3)),"^")
"RTN","LA7SM2",54,0)
 S LA7Y=0
"RTN","LA7SM2",55,0)
 F  S LA7Y=$O(LA7RINFO(LA7Y)) Q:'LA7Y  D  Q:LA7QUIT
"RTN","LA7SM2",56,0)
 . N DA,DIR,DIRUT
"RTN","LA7SM2",57,0)
 . S DIR(0)="62.801,"_LA7Y
"RTN","LA7SM2",58,0)
 . S DIR("A")=$$GET1^DID(62.801,LA7Y,"","LABEL")
"RTN","LA7SM2",59,0)
 . I LA7Y=2.21 D
"RTN","LA7SM2",60,0)
 . . S DIR("A",1)=" "
"RTN","LA7SM2",61,0)
 . . S DIR("A",2)="Specimen Collection Date/time: "_$$FMTE^XLFDT(LA7CDT,"M")
"RTN","LA7SM2",62,0)
 . . S $P(DIR(0),"^",3)="I Y<LA7CDT!(Y>$$NOW^XLFDT) K X" ; d/t after specimen collect d/t
"RTN","LA7SM2",63,0)
 . I LA7Y'=2.21 D
"RTN","LA7SM2",64,0)
 . . N LA7X
"RTN","LA7SM2",65,0)
 . . S LA7X=$$GET1^DIQ(64.061,$P(LA7RINFO(LA7Y),"^",2)_",",.01) ; Units
"RTN","LA7SM2",66,0)
 . . S DIR("A")=DIR("A")_" (in "_LA7X_")"
"RTN","LA7SM2",67,0)
 . I $L($P(LA7RINFO(LA7Y),"^")) D   ; Default value
"RTN","LA7SM2",68,0)
 . . I LA7Y=2.21 S DIR("B")=$$FMTE^XLFDT($P(LA7RINFO(LA7Y),"^"))
"RTN","LA7SM2",69,0)
 . . E  S DIR("B")=$P(LA7RINFO(LA7Y),"^")
"RTN","LA7SM2",70,0)
 . D ^DIR
"RTN","LA7SM2",71,0)
 . I $D(DTOUT)!$D(DUOUT) S LA7QUIT=1 Q
"RTN","LA7SM2",72,0)
 . S $P(LA7INFO(LA7Y),"^")=$P(Y,"^") ; New value
"RTN","LA7SM2",73,0)
 I LA7QUIT Q
"RTN","LA7SM2",74,0)
 ;
"RTN","LA7SM2",75,0)
 S LA7Y=0
"RTN","LA7SM2",76,0)
 F  S LA7Y=$O(LA7RINFO(LA7Y)) Q:'LA7Y  D
"RTN","LA7SM2",77,0)
 . S LA7I=0
"RTN","LA7SM2",78,0)
 . F  S LA7I=$O(LA7RINFO(LA7Y,LA7I)) Q:'LA7I  D
"RTN","LA7SM2",79,0)
 . . I $P(LA7INFO(LA7Y),"^")=$P(LA7RINFO(LA7Y,LA7I),"^") Q  ; Value unchanged
"RTN","LA7SM2",80,0)
 . . N FDA,LA7628,LA768,LA7DATA
"RTN","LA7SM2",81,0)
 . . S LA762801=LA7I_","_+LA7SM_","
"RTN","LA7SM2",82,0)
 . . I LA7Y=2.21 D
"RTN","LA7SM2",83,0)
 . . . N LA7DURT,LA7UID,LA7UNITS,LA7X
"RTN","LA7SM2",84,0)
 . . . S LA7UNITS=$$GET1^DIQ(64.061,+$P(LA7RINFO(LA7Y,LA7I),"^",2)_",",.01,"E")
"RTN","LA7SM2",85,0)
 . . . S LA7DURT=$$FMDIFF^XLFDT(LA7INFO(LA7Y),LA7CDT,2) ; Collection duration (in seconds)
"RTN","LA7SM2",86,0)
 . . . I LA7UNITS="min" S LA7DURT=$FN(LA7DURT/60,"",0) ; Convert to minutes, rounded to nearest minute.
"RTN","LA7SM2",87,0)
 . . . I LA7UNITS="hr" S LA7DURT=$FN(LA7DURT/3600,"",0) ; Convert to hours, rounded to nearest hour.
"RTN","LA7SM2",88,0)
 . . . S FDA(62.8,62.801,LA762801,2.22)=LA7DURT
"RTN","LA7SM2",89,0)
 . . S FDA(62.8,62.801,LA762801,LA7Y)=$P(LA7INFO(LA7Y),"^") ; New value
"RTN","LA7SM2",90,0)
 . . D FILE^DIE("","FDA(62.8)","LA7DIE(2)") ; Update required info
"RTN","LA7SM2",91,0)
 . . ; Update event file
"RTN","LA7SM2",92,0)
 . . S LA7DATA="SM40^"_$$NOW^XLFDT_"^"_$P(LA7RINFO(LA7Y,LA7I),"^",3)_"^"_$P(LA7SM,"^",2)
"RTN","LA7SM2",93,0)
 . . D SEUP^LA7SMU(LA7UID,2,LA7DATA)
"RTN","LA7SM2",94,0)
 Q
"RTN","LA7SM2",95,0)
 ;
"RTN","LA7SM2",96,0)
 ;
"RTN","LA7SM2",97,0)
CHKREQI(LA7628,LA762801) ; Check for required info/incomplete setup
"RTN","LA7SM2",98,0)
 ; Call with LA7628 = ien of entry in file #62.8
"RTN","LA7SM2",99,0)
 ;         LA762801 = ien of entry in file #62.8, TEST subfile
"RTN","LA7SM2",100,0)
 ;
"RTN","LA7SM2",101,0)
 ; If errors sets LA7ERR array with error messages and TMP(LA7ERR",$J)
"RTN","LA7SM2",102,0)
 ;    with specific tests.
"RTN","LA7SM2",103,0)
 ;
"RTN","LA7SM2",104,0)
 N LA7FILE,LA7FLD,LA7SCFG,LA7I,LA7J
"RTN","LA7SM2",105,0)
 ;
"RTN","LA7SM2",106,0)
 S LA7ERR=$G(LA7ERR,0)
"RTN","LA7SM2",107,0)
 S LA7628(0)=$G(^LAHM(62.8,LA7628,0))
"RTN","LA7SM2",108,0)
 S LA7SCFG=$P(LA7628(0),"^",2)
"RTN","LA7SM2",109,0)
 S LA7SCFG(0)=$G(^LAHM(62.9,LA7SCFG,0))
"RTN","LA7SM2",110,0)
 ;
"RTN","LA7SM2",111,0)
 F LA7J=0,1,2,5 S LA7I(LA7J)=$G(^LAHM(62.8,LA7628,10,LA762801,LA7J))
"RTN","LA7SM2",112,0)
 ;
"RTN","LA7SM2",113,0)
 S LA7FILE=62.801
"RTN","LA7SM2",114,0)
 ;
"RTN","LA7SM2",115,0)
 I $P(LA7I(1),"^") D
"RTN","LA7SM2",116,0)
 . F LA7J=2,3,7 I '$L($P(LA7I(1),"^",LA7J)) S LA7FLD=$S(LA7J=2:1.11,LA7J=3:1.13,1:1.14) D SETERR
"RTN","LA7SM2",117,0)
 ;
"RTN","LA7SM2",118,0)
 I $P(LA7I(1),"^",4) D
"RTN","LA7SM2",119,0)
 . F LA7J=5,6,8 I '$L($P(LA7I(1),"^",LA7J)) S LA7FLD=$S(LA7J=5:1.21,LA7J=6:1.23,1:1.24) D SETERR
"RTN","LA7SM2",120,0)
 ;
"RTN","LA7SM2",121,0)
 I $P(LA7I(2),"^") D
"RTN","LA7SM2",122,0)
 . F LA7J=2,3,11 I '$L($P(LA7I(2),"^",LA7J)) S LA7FLD=$S(LA7J=2:2.11,LA7J=3:2.13,1:2.14) D SETERR
"RTN","LA7SM2",123,0)
 ;
"RTN","LA7SM2",124,0)
 I $P(LA7I(2),"^",4) D
"RTN","LA7SM2",125,0)
 . F LA7J=5,6,7,12 I '$L($P(LA7I(2),"^",LA7J)) S LA7FLD=$S(LA7J=5:2.21,LA7J=6:2.22,LA7J=7:2.23,1:2.24) D SETERR
"RTN","LA7SM2",126,0)
 ;
"RTN","LA7SM2",127,0)
 I $P(LA7I(2),"^",8) D
"RTN","LA7SM2",128,0)
 . F LA7J=9,10,13 I '$L($P(LA7I(2),"^",LA7J)) S LA7FLD=$S(LA7J=9:2.31,LA7J=10:2.33,1:2.34) D SETERR
"RTN","LA7SM2",129,0)
 ;
"RTN","LA7SM2",130,0)
 ; Check if using non-VA codes
"RTN","LA7SM2",131,0)
 I $P(LA7628(0),"^",5) D
"RTN","LA7SM2",132,0)
 . F LA7J=1,2 I '$L($P(LA7I(5),"^",LA7J)) S LA7FLD=$S(LA7J=1:5.1,1:5.2) D SETERR
"RTN","LA7SM2",133,0)
 I '$$GET1^DIQ(60,+$P(LA7I(0),"^",2)_",",64,"I") S LA7FILE=60,LA7FLD=64 D SETERR
"RTN","LA7SM2",134,0)
 I 'LA7ERR,$O(LA7ERR(""))'="" S LA7ERR=1
"RTN","LA7SM2",135,0)
 ;
"RTN","LA7SM2",136,0)
 Q
"RTN","LA7SM2",137,0)
 ;
"RTN","LA7SM2",138,0)
 ;
"RTN","LA7SM2",139,0)
SETERR ; Set error log for entries missing values in 62.8
"RTN","LA7SM2",140,0)
 ; Called from above.
"RTN","LA7SM2",141,0)
 ;
"RTN","LA7SM2",142,0)
 S LA7ERR(LA7FILE_":"_LA7FLD)="Missing Required Info - "_$$GET1^DID(LA7FILE,LA7FLD,"","LABEL")
"RTN","LA7SM2",143,0)
 S ^TMP("LA7ERR",$J,LA7FILE_":"_LA7FLD,LA7628,$P(LA7I(0),"^",5),$P(LA7I(0),"^",2))=""
"RTN","LA7SM2",144,0)
 Q
"RTN","LA7SM2",145,0)
 ;
"RTN","LA7SM2",146,0)
 ;
"RTN","LA7SM2",147,0)
BUILDRI ; Build global with required info to print on manifest.
"RTN","LA7SM2",148,0)
 ; Called from LA7SMP
"RTN","LA7SM2",149,0)
 ;
"RTN","LA7SM2",150,0)
 N LA7I,LA7X
"RTN","LA7SM2",151,0)
 ;
"RTN","LA7SM2",152,0)
 ; No required info
"RTN","LA7SM2",153,0)
 I $G(LA762801(1))="",$G(LA762801(2))="" Q
"RTN","LA7SM2",154,0)
 ;
"RTN","LA7SM2",155,0)
 F LA7I=1,2 S LA7X(LA7I)=$G(^TMP("LA7SMRI",$J,+$P(LA762801(0),"^",7),+$P(LA762801(0),"^",9),$P(LA762801(0),"^",5),LA7I))
"RTN","LA7SM2",156,0)
 ;
"RTN","LA7SM2",157,0)
 ; Check for patient required info.
"RTN","LA7SM2",158,0)
 F LA7I=1,4 I $P($G(LA762801(1)),"^",LA7I) D
"RTN","LA7SM2",159,0)
 . S $P(LA7X(1),"^",LA7I)=$P(LA762801(1),"^",LA7I)
"RTN","LA7SM2",160,0)
 . I LA7I=1 S $P(LA7X(1),"^",2,3)=$P(LA762801(1),"^",2,3) Q
"RTN","LA7SM2",161,0)
 . I LA7I=4 S $P(LA7X(1),"^",5,6)=$P(LA762801(1),"^",5,6) Q
"RTN","LA7SM2",162,0)
 ;
"RTN","LA7SM2",163,0)
 ; Check for specimen required info.
"RTN","LA7SM2",164,0)
 F LA7I=1,4,8 I $P($G(LA762801(2)),"^",LA7I) D
"RTN","LA7SM2",165,0)
 . S $P(LA7X(2),"^",LA7I)=$P(LA762801(2),"^",LA7I)
"RTN","LA7SM2",166,0)
 . I LA7I=1 S $P(LA7X(2),"^",2,3)=$P(LA762801(2),"^",2,3) Q
"RTN","LA7SM2",167,0)
 . I LA7I=4 S $P(LA7X(2),"^",5,7)=$P(LA762801(2),"^",5,7) Q
"RTN","LA7SM2",168,0)
 . I LA7I=8 S $P(LA7X(2),"^",9,10)=$P(LA762801(2),"^",9,10) Q
"RTN","LA7SM2",169,0)
 ;
"RTN","LA7SM2",170,0)
 ; Store required info for printing
"RTN","LA7SM2",171,0)
 F LA7I=1,2 I $L($G(LA7X(LA7I))) S ^TMP("LA7SMRI",$J,+$P(LA762801(0),"^",7),+$P(LA762801(0),"^",9),$P(LA762801(0),"^",5),LA7I)=LA7X(LA7I)
"RTN","LA7SM2",172,0)
 ;
"RTN","LA7SM2",173,0)
 Q
"RTN","LA7SM2",174,0)
 ;
"RTN","LA7SM2",175,0)
 ;
"RTN","LA7SM2",176,0)
RCI ; Enter/edit relevant clinical information
"RTN","LA7SM2",177,0)
 N DA,FDA,LA7628,LA762801,LA7DIR,LA7QUIT,LA7TCNT,LA7Y
"RTN","LA7SM2",178,0)
 D INIT^LA7SM
"RTN","LA7SM2",179,0)
 I LA7QUIT D CLEANUP^LA7SM Q
"RTN","LA7SM2",180,0)
 S LA7SM=$$SELSM^LA7SMU(+LA7SCFG,"0,1,3")
"RTN","LA7SM2",181,0)
 I LA7SM<0 D  Q
"RTN","LA7SM2",182,0)
 . D EN^DDIOL($P(LA7SM,"^",2),"","!?5")
"RTN","LA7SM2",183,0)
 . D CLEANUP^LA7SM
"RTN","LA7SM2",184,0)
 D LOCKSM^LA7SM
"RTN","LA7SM2",185,0)
 I LA7QUIT D  Q
"RTN","LA7SM2",186,0)
 . D EN^DDIOL($P(LA7QUIT,"^",2),"","!?5")
"RTN","LA7SM2",187,0)
 . D UNLOCKSM^LA7SM,CLEANUP^LA7SM
"RTN","LA7SM2",188,0)
 S LA7SM(0)=$G(^LAHM(62.8,+LA7SM,0))
"RTN","LA7SM2",189,0)
 D SEL^LA7SM
"RTN","LA7SM2",190,0)
 I LA7QUIT D UNLOCKSM^LA7SM,CLEANUP^LA7SM Q
"RTN","LA7SM2",191,0)
 S (LA7I,LA7TCNT)=0
"RTN","LA7SM2",192,0)
 F  S LA7I=$O(^LAHM(62.8,+LA7SM,10,"UID",LA7UID,LA7I)) Q:'LA7I  D
"RTN","LA7SM2",193,0)
 . S LA7I(0)=$G(^LAHM(62.8,+LA7SM,10,LA7I,0))
"RTN","LA7SM2",194,0)
 . I $P(LA7I(0),"^",8)=0 Q  ; Previously "removed".
"RTN","LA7SM2",195,0)
 . I $P(LA7I(0),"^",8),$P(LA7I(0),"^",8)'=1 S LA7QUIT="1^Accession not pending shipment" Q
"RTN","LA7SM2",196,0)
 . S LA7TCNT=LA7TCNT+1,LA760(LA7TCNT)=LA7I_"^"_LA7I(0)
"RTN","LA7SM2",197,0)
 I 'LA7TCNT,'LA7QUIT S LA7QUIT="1^Accession is not on this shipping manifest"
"RTN","LA7SM2",198,0)
 I LA7QUIT D UNLOCKSM^LA7SM,CLEANUP^LA7SM Q
"RTN","LA7SM2",199,0)
 S LA7I=0
"RTN","LA7SM2",200,0)
 F  S LA7I=$O(LA760(LA7I)) Q:'LA7I  D EN^DDIOL(LA7I_" "_$P($G(^LAB(60,+$P(LA760(LA7I),"^",3),0)),"^"),"","!?5")
"RTN","LA7SM2",201,0)
 S DIR(0)="LO^1:"_LA7TCNT,DIR("A")="Select test(s) to edit clinical info"
"RTN","LA7SM2",202,0)
 D ^DIR
"RTN","LA7SM2",203,0)
 I $D(DIRUT) S LA7QUIT=1 D UNLOCKSM^LA7SM,CLEANUP^LA7SM Q
"RTN","LA7SM2",204,0)
 M LA7YARRY=Y
"RTN","LA7SM2",205,0)
 K DIR
"RTN","LA7SM2",206,0)
 D FIELD^DID(62.801,.1,,"DESCRIPTION;FIELD LENGTH;HELP-PROMPT","LA7DIR")
"RTN","LA7SM2",207,0)
 S LA7X=$P($G(^LAHM(62.9,+$P(LA7SM(0),"^",2),0)),"^",3)
"RTN","LA7SM2",208,0)
 I $$NVAF^LA7VHLU2(LA7X)=1 D
"RTN","LA7SM2",209,0)
 . S LA7DIR("FIELD LENGTH")=78
"RTN","LA7SM2",210,0)
 . S LA7DIR("HELP-PROMPT")="Answer must be 1-78 characters in length."
"RTN","LA7SM2",211,0)
 S DIR(0)="FAO^1:"_LA7DIR("FIELD LENGTH"),DIR("A")="Relevant clinical information: "
"RTN","LA7SM2",212,0)
 M DIR("?")=LA7DIR("DESCRIPTION"),DIR("?")=LA7DIR("HELP-PROMPT")
"RTN","LA7SM2",213,0)
 S LA7Y="",LA7628=+LA7SM,LA7QUIT=0
"RTN","LA7SM2",214,0)
 F  S LA7Y=$O(LA7YARRY(LA7Y)) Q:LA7Y=""  D  Q:LA7QUIT
"RTN","LA7SM2",215,0)
 . F LA7I=1:1 Q:'$P(LA7YARRY(LA7Y),",",LA7I)  D  Q:LA7QUIT
"RTN","LA7SM2",216,0)
 . . K DA,DIRUT,DUOUT,DTOUT,FDA,LA7DIE
"RTN","LA7SM2",217,0)
 . . S LA7X=$P(LA7YARRY(LA7Y),",",LA7I),DA=+LA760(LA7X)
"RTN","LA7SM2",218,0)
 . . S LA762801=DA_","_LA7628_","
"RTN","LA7SM2",219,0)
 . . W !,"For test: ",$$GET1^DIQ(62.801,LA762801,.02)
"RTN","LA7SM2",220,0)
 . . S DIR("B")=$$GET1^DIQ(62.801,LA762801,.1)
"RTN","LA7SM2",221,0)
 . . I DIR("B")="" K DIR("B")
"RTN","LA7SM2",222,0)
 . . D ^DIR
"RTN","LA7SM2",223,0)
 . . I $D(DIRUT),X'="@" S LA7QUIT=1 Q
"RTN","LA7SM2",224,0)
 . . I Y="",X="@" S Y="@"
"RTN","LA7SM2",225,0)
 . . S FDA(62.8,62.801,LA762801,.1)=Y
"RTN","LA7SM2",226,0)
 . . D FILE^DIE("","FDA(62.8)","LA7DIE(1)")
"RTN","LA7SM2",227,0)
 ;
"RTN","LA7SM2",228,0)
 D UNLOCKSM^LA7SM,CLEANUP^LA7SM
"RTN","LA7SM2",229,0)
 Q
"RTN","LA7SMB")
0^31^B76474433
"RTN","LA7SMB",1,0)
LA7SMB ;DALOI/JMC - Shipping Manifest Build ;11/25/96  14:39
"RTN","LA7SMB",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,46,64**;Sep 27, 1994
"RTN","LA7SMB",3,0)
EN ;
"RTN","LA7SMB",4,0)
 ;
"RTN","LA7SMB",5,0)
 D CLEANUP
"RTN","LA7SMB",6,0)
 S LA7QUIT=0
"RTN","LA7SMB",7,0)
 ;
"RTN","LA7SMB",8,0)
 ; Select shipping configuration
"RTN","LA7SMB",9,0)
 S LA7SCFG=$$SSCFG^LA7SUTL(1)
"RTN","LA7SMB",10,0)
 I LA7SCFG<1 D CLEANUP Q
"RTN","LA7SMB",11,0)
 ;
"RTN","LA7SMB",12,0)
 ; Determine if there's an active manifest.
"RTN","LA7SMB",13,0)
 S LA7SM=$$CHKSM^LA7SMU(+LA7SCFG)
"RTN","LA7SMB",14,0)
 I LA7SM<0 D  Q
"RTN","LA7SMB",15,0)
 . D EN^DDIOL($P(LA7SM,"^",2),"","!?5")
"RTN","LA7SMB",16,0)
 . D CLEANUP
"RTN","LA7SMB",17,0)
 ;
"RTN","LA7SMB",18,0)
 I LA7SM=0 D
"RTN","LA7SMB",19,0)
 . N DIR,DIRUT,DTOUT,X,Y
"RTN","LA7SMB",20,0)
 . S DIR(0)="YO",DIR("A",1)="There's no open shipping manifest for "_$P(LA7SCFG,"^",2)
"RTN","LA7SMB",21,0)
 . S DIR("A")="Do you want to start one",DIR("B")="NO"
"RTN","LA7SMB",22,0)
 . D ^DIR
"RTN","LA7SMB",23,0)
 . I Y'=1 S LA7QUIT=1 Q
"RTN","LA7SMB",24,0)
 . S LA7SM=$$CSM^LA7SMU(+LA7SCFG)
"RTN","LA7SMB",25,0)
 . I LA7SM<1 D EN^DDIOL($P(LA7SM,"^",2),"","!?5") S LA7QUIT=1
"RTN","LA7SMB",26,0)
 ;
"RTN","LA7SMB",27,0)
 ; Only starting a new manifest, no building
"RTN","LA7SMB",28,0)
 I $G(LA7SMON) Q
"RTN","LA7SMB",29,0)
 ;
"RTN","LA7SMB",30,0)
 I LA7QUIT=1 D CLEANUP Q
"RTN","LA7SMB",31,0)
 ;
"RTN","LA7SMB",32,0)
 D ADATE^LA7SMU1
"RTN","LA7SMB",33,0)
 I LA7QUIT=1 D CLEANUP Q
"RTN","LA7SMB",34,0)
 ;
"RTN","LA7SMB",35,0)
 ; Flag to exclude previously removed tests from building.
"RTN","LA7SMB",36,0)
 S LA7EXPRV=$$ASKPREV^LA7SMU1
"RTN","LA7SMB",37,0)
 I LA7EXPRV<0 S LA7QUIT=1
"RTN","LA7SMB",38,0)
 ;
"RTN","LA7SMB",39,0)
 I LA7QUIT=1 D CLEANUP Q
"RTN","LA7SMB",40,0)
 ;
"RTN","LA7SMB",41,0)
DQ ; Taskman entry point
"RTN","LA7SMB",42,0)
 ; Build list of tests and criteria for manifest.
"RTN","LA7SMB",43,0)
 S LA7SCFG(0)=$G(^LAHM(62.9,+LA7SCFG,0))
"RTN","LA7SMB",44,0)
 I '$D(ZTQUEUED) D EN^DDIOL("Using shipping manifest# "_$P(LA7SM,"^",2),"","!?5")
"RTN","LA7SMB",45,0)
 ;
"RTN","LA7SMB",46,0)
 ; Lock this shipping manifest
"RTN","LA7SMB",47,0)
 L +^LAHM(62.8,+LA7SM,0):5
"RTN","LA7SMB",48,0)
 I '$T D  Q
"RTN","LA7SMB",49,0)
 . I '$D(ZTQUEUED) D EN^DDIOL("Unable to obtain lock for shipping manifest "_$P(LA7SCFG,"^",2),"","!?5")
"RTN","LA7SMB",50,0)
 . D CLEANUP
"RTN","LA7SMB",51,0)
 ;
"RTN","LA7SMB",52,0)
 ; Update status
"RTN","LA7SMB",53,0)
 D SMSUP^LA7SMU(LA7SM,2,"SM03")
"RTN","LA7SMB",54,0)
 S LA7SMCNT=0
"RTN","LA7SMB",55,0)
 ;
"RTN","LA7SMB",56,0)
 ; Build TMP global with test profiles
"RTN","LA7SMB",57,0)
 D SCBLD^LA7SM1(+LA7SCFG)
"RTN","LA7SMB",58,0)
 S LA7AA=""
"RTN","LA7SMB",59,0)
 F  S LA7AA=$O(^TMP("LA7SMB",$J,LA7AA)) Q:LA7AA=""  D
"RTN","LA7SMB",60,0)
 . N LA7END,LRSS
"RTN","LA7SMB",61,0)
 . I '$D(ZTQUEUED) D EN^DDIOL("Searching accession area: "_$P($G(^LRO(68,LA7AA,0)),"^"),"","!?5")
"RTN","LA7SMB",62,0)
 . ; Use selected accession date else get current accession day for this acession area
"RTN","LA7SMB",63,0)
 . I $G(LA7AA(LA7AA)) S LA7AD=$P(LA7AA(LA7AA),"^")
"RTN","LA7SMB",64,0)
 . E  S LA7AD=$$AD^LA7SUTL(LA7AA)
"RTN","LA7SMB",65,0)
 . S LRSS=$P($G(^LRO(68,LA7AA,0)),"^",2)
"RTN","LA7SMB",66,0)
 . S LA7AN=+$P($G(LA7AA(LA7AA)),"^",2),LA7LAN=+$P($G(LA7AA(LA7AA)),"^",3),LA7END=0
"RTN","LA7SMB",67,0)
 . I LA7AN S LA7AN=LA7AN-1
"RTN","LA7SMB",68,0)
 . F  S LA7AN=$O(^LRO(68,LA7AA,1,LA7AD,1,LA7AN)) Q:'LA7AN!(LA7END)  D SCAN
"RTN","LA7SMB",69,0)
 ;
"RTN","LA7SMB",70,0)
 ; Update status
"RTN","LA7SMB",71,0)
 D SMSUP^LA7SMU(LA7SM,1,"SM02")
"RTN","LA7SMB",72,0)
 ;
"RTN","LA7SMB",73,0)
 ; Release lock on this shipping manifest
"RTN","LA7SMB",74,0)
 L -^LAHM(62.8,+LA7SM,0)
"RTN","LA7SMB",75,0)
 ;
"RTN","LA7SMB",76,0)
 I '$D(ZTQUEUED) D
"RTN","LA7SMB",77,0)
 . N DIR,DIRUT,DIROUT,DTOUT,X,Y
"RTN","LA7SMB",78,0)
 . D EN^DDIOL("There were "_$S(LA7SMCNT:LA7SMCNT,1:"NO")_" specimens added","","!?5")
"RTN","LA7SMB",79,0)
 . D ASK^LA7SMP(LA7SM)
"RTN","LA7SMB",80,0)
 D CLEANUP
"RTN","LA7SMB",81,0)
 Q
"RTN","LA7SMB",82,0)
 ;
"RTN","LA7SMB",83,0)
SMONLY ; Start a shipping manifest only, no building
"RTN","LA7SMB",84,0)
 ;
"RTN","LA7SMB",85,0)
 N LA7SMON
"RTN","LA7SMB",86,0)
 S LA7SMON=1
"RTN","LA7SMB",87,0)
 D EN
"RTN","LA7SMB",88,0)
 I $G(LA7SCFG),$G(LA7SM)>0 D EN^DDIOL("Shipping manifest# "_$P(LA7SM,"^",2)_" is available","","!?5")
"RTN","LA7SMB",89,0)
 D CLEANUP
"RTN","LA7SMB",90,0)
 Q
"RTN","LA7SMB",91,0)
 ;
"RTN","LA7SMB",92,0)
 ;
"RTN","LA7SMB",93,0)
SCAN ; Scan accession for tests to build
"RTN","LA7SMB",94,0)
 ;
"RTN","LA7SMB",95,0)
 N LA76805,LA7DIV,LA7END
"RTN","LA7SMB",96,0)
 ;
"RTN","LA7SMB",97,0)
 I LA7LAN,LA7AN>LA7LAN S LA7END=1 Q
"RTN","LA7SMB",98,0)
 ;
"RTN","LA7SMB",99,0)
 ; Don't build controls
"RTN","LA7SMB",100,0)
 I $P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,0)),"^",2)=62.3 Q
"RTN","LA7SMB",101,0)
 ;
"RTN","LA7SMB",102,0)
 ; Don't build uncollected specimens
"RTN","LA7SMB",103,0)
 I '$P(LA7SCFG(0),"^",14),'$P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,3)),"^",3) Q
"RTN","LA7SMB",104,0)
 ;
"RTN","LA7SMB",105,0)
 ; Get Specimen type - if no specimen then quit
"RTN","LA7SMB",106,0)
 ; Anatomic path does not store specimen type in #68.
"RTN","LA7SMB",107,0)
 S LA76805=""
"RTN","LA7SMB",108,0)
 I "CY^EM^SP"[LRSS S LA76805=0
"RTN","LA7SMB",109,0)
 E  D
"RTN","LA7SMB",110,0)
 . S X=+$O(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,5,0))
"RTN","LA7SMB",111,0)
 . I 'X Q
"RTN","LA7SMB",112,0)
 . S LA76805=+$G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,5,X,0))
"RTN","LA7SMB",113,0)
 I LA76805="" Q
"RTN","LA7SMB",114,0)
 ;
"RTN","LA7SMB",115,0)
 ; Accession's division
"RTN","LA7SMB",116,0)
 S LA7DIV=+$P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,.4)),"^")
"RTN","LA7SMB",117,0)
 ;
"RTN","LA7SMB",118,0)
 S LA760=0
"RTN","LA7SMB",119,0)
 F  S LA760=$O(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,LA760)) Q:'LA760  D
"RTN","LA7SMB",120,0)
 . ; Not looking for this test.
"RTN","LA7SMB",121,0)
 . I '$D(^TMP("LA7SMB",$J,LA7AA,LA760)) Q
"RTN","LA7SMB",122,0)
 . ; Set lock.
"RTN","LA7SMB",123,0)
 . D LOCK68
"RTN","LA7SMB",124,0)
 . ; NOTE *** Do NOT add any "QUIT" after this point unless releasing LOCK set above ***.
"RTN","LA7SMB",125,0)
 . ; Test's zeroth node.
"RTN","LA7SMB",126,0)
 . S LA760(0)=$G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,LA760,0))
"RTN","LA7SMB",127,0)
 . ; Test completed - skip
"RTN","LA7SMB",128,0)
 . I "CY^EM^SP"'[LRSS,$P(LA760(0),"^",5) D UNLOCK68 Q
"RTN","LA7SMB",129,0)
 . ; Test already on shipping manifest - skip
"RTN","LA7SMB",130,0)
 . I $P(LA760(0),"^",10) D UNLOCK68 Q
"RTN","LA7SMB",131,0)
 . ; Previously removed - skip
"RTN","LA7SMB",132,0)
 . I LA7EXPRV,$$PREV^LA7SMU1($P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,.3)),"^"),$P(LA760(0),"^")) D UNLOCK68 Q
"RTN","LA7SMB",133,0)
 . ; Test urgency
"RTN","LA7SMB",134,0)
 . S LA76205=+$P(LA760(0),"^",2)
"RTN","LA7SMB",135,0)
 . I LA76205>49 S LA76205=$S(LA76205=50:9,1:LA76205-50)
"RTN","LA7SMB",136,0)
 . ; Check if test is eligible for manifest
"RTN","LA7SMB",137,0)
 . D SCHK^LA7SM1
"RTN","LA7SMB",138,0)
 . I LA7FLAG S LA7FLAG=$$CKTEST(LA7AA,LA7AD,LA7AN,LA760)
"RTN","LA7SMB",139,0)
 . ; Add test to shipping manifest.
"RTN","LA7SMB",140,0)
 . I LA7FLAG D
"RTN","LA7SMB",141,0)
 . . S LA7I=0
"RTN","LA7SMB",142,0)
 . . F  S LA7I=$O(LA7X(LA7I)) Q:'LA7I  D ADD
"RTN","LA7SMB",143,0)
 . ; Release lock.
"RTN","LA7SMB",144,0)
 . D UNLOCK68
"RTN","LA7SMB",145,0)
 Q
"RTN","LA7SMB",146,0)
 ;
"RTN","LA7SMB",147,0)
ADD ; Add test to shipping manifest
"RTN","LA7SMB",148,0)
 ; Called from above, LA7SM
"RTN","LA7SMB",149,0)
 ; Lock on ^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,LA760) should be set before entering here.
"RTN","LA7SMB",150,0)
 ;
"RTN","LA7SMB",151,0)
 N FDA,IENS,LA7628,LA768,LA7DATA
"RTN","LA7SMB",152,0)
 ;
"RTN","LA7SMB",153,0)
 S LRDFN=+$G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,0))
"RTN","LA7SMB",154,0)
 S LA7UID=$P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,.3)),"^")
"RTN","LA7SMB",155,0)
 I LA7UID="" S LA7UID=$$LRUID^LRX(LA7AA,LA7AD,LA7AN)
"RTN","LA7SMB",156,0)
 S LA7SMCNT=$G(LA7SMCNT)+1
"RTN","LA7SMB",157,0)
 S ^TMP("LA7SMADD",$J,LA7SMCNT)=LRDFN_"^"_LA760_"^"_LA76805_"^"_LA76205_"^"_LA7UID
"RTN","LA7SMB",158,0)
 S LA7628(1)=+LA7SM,IENS="+2,"_LA7628(1)_","
"RTN","LA7SMB",159,0)
 S FDA(2,62.801,IENS,.01)=LRDFN
"RTN","LA7SMB",160,0)
 S FDA(2,62.801,IENS,.02)=LA760
"RTN","LA7SMB",161,0)
 I LA76805 S FDA(2,62.801,IENS,.03)=LA76805
"RTN","LA7SMB",162,0)
 S FDA(2,62.801,IENS,.04)=LA76205
"RTN","LA7SMB",163,0)
 S FDA(2,62.801,IENS,.05)=LA7UID
"RTN","LA7SMB",164,0)
 S FDA(2,62.801,IENS,.08)=1
"RTN","LA7SMB",165,0)
 I $D(LA7X(LA7I,0)) D
"RTN","LA7SMB",166,0)
 . I $P(LA7X(LA7I,0),"^",5) S FDA(2,62.801,IENS,.06)=$P(LA7X(LA7I,0),"^",5)
"RTN","LA7SMB",167,0)
 . I $P(LA7X(LA7I,0),"^",6) S FDA(2,62.801,IENS,.07)=$P(LA7X(LA7I,0),"^",6)
"RTN","LA7SMB",168,0)
 . I $P(LA7X(LA7I,0),"^",7) S FDA(2,62.801,IENS,.09)=$P(LA7X(LA7I,0),"^",7)
"RTN","LA7SMB",169,0)
 I $D(LA7X(LA7I,1)) D
"RTN","LA7SMB",170,0)
 . I $P(LA7X(LA7I,1),"^",1)]"" S FDA(2,62.801,IENS,1.1)=$P(LA7X(LA7I,1),"^",1)
"RTN","LA7SMB",171,0)
 . I $P(LA7X(LA7I,1),"^",2)]"" S FDA(2,62.801,IENS,1.13)=$P(LA7X(LA7I,1),"^",2)
"RTN","LA7SMB",172,0)
 . I $P(LA7X(LA7I,1),"^",5)]"" S FDA(2,62.801,IENS,1.14)=$P(LA7X(LA7I,1),"^",5)
"RTN","LA7SMB",173,0)
 . I $P(LA7X(LA7I,1),"^",3)]"" S FDA(2,62.801,IENS,1.2)=$P(LA7X(LA7I,1),"^",3)
"RTN","LA7SMB",174,0)
 . I $P(LA7X(LA7I,1),"^",4)]"" S FDA(2,62.801,IENS,1.23)=$P(LA7X(LA7I,1),"^",4)
"RTN","LA7SMB",175,0)
 . I $P(LA7X(LA7I,1),"^",6)]"" S FDA(2,62.801,IENS,1.24)=$P(LA7X(LA7I,1),"^",6)
"RTN","LA7SMB",176,0)
 I $D(LA7X(LA7I,2)) D
"RTN","LA7SMB",177,0)
 . I $P(LA7X(LA7I,2),"^",1)]"" S FDA(2,62.801,IENS,2.1)=$P(LA7X(LA7I,2),"^",1)
"RTN","LA7SMB",178,0)
 . I $P(LA7X(LA7I,2),"^",2)]"" S FDA(2,62.801,IENS,2.13)=$P(LA7X(LA7I,2),"^",2)
"RTN","LA7SMB",179,0)
 . I $P(LA7X(LA7I,2),"^",7)]"" S FDA(2,62.801,IENS,2.14)=$P(LA7X(LA7I,2),"^",7)
"RTN","LA7SMB",180,0)
 . I $P(LA7X(LA7I,2),"^",3)]"" S FDA(2,62.801,IENS,2.2)=$P(LA7X(LA7I,2),"^",3)
"RTN","LA7SMB",181,0)
 . I $P(LA7X(LA7I,2),"^",4)]"" S FDA(2,62.801,IENS,2.23)=$P(LA7X(LA7I,2),"^",4)
"RTN","LA7SMB",182,0)
 . I $P(LA7X(LA7I,2),"^",8)]"" S FDA(2,62.801,IENS,2.24)=$P(LA7X(LA7I,2),"^",8)
"RTN","LA7SMB",183,0)
 . I $P(LA7X(LA7I,2),"^",5)]"" S FDA(2,62.801,IENS,2.3)=$P(LA7X(LA7I,2),"^",5)
"RTN","LA7SMB",184,0)
 . I $P(LA7X(LA7I,2),"^",6)]"" S FDA(2,62.801,IENS,2.33)=$P(LA7X(LA7I,2),"^",6)
"RTN","LA7SMB",185,0)
 . I $P(LA7X(LA7I,2),"^",9)]"" S FDA(2,62.801,IENS,2.34)=$P(LA7X(LA7I,2),"^",9)
"RTN","LA7SMB",186,0)
 I $D(LA7X(LA7I,5)) D
"RTN","LA7SMB",187,0)
 . F I=1:1:9 I $P(LA7X(LA7I,5),"^",I)]"" S FDA(2,62.801,IENS,"5."_I)=$P(LA7X(LA7I,5),"^",I)
"RTN","LA7SMB",188,0)
 D UPDATE^DIE("","FDA(2)","LA7628","LA7DIE(2)")
"RTN","LA7SMB",189,0)
 ;
"RTN","LA7SMB",190,0)
 ; Update event file
"RTN","LA7SMB",191,0)
 S LA7DATA="SM50^"_$$NOW^XLFDT_"^"_LA760_"^"_$P(LA7SM,"^",2)
"RTN","LA7SMB",192,0)
 D SEUP^LA7SMU(LA7UID,2,LA7DATA)
"RTN","LA7SMB",193,0)
 ;
"RTN","LA7SMB",194,0)
 ; Update accession
"RTN","LA7SMB",195,0)
 D ACCSUP^LA7SMU(LA7UID,LA760,+LA7SM)
"RTN","LA7SMB",196,0)
 Q
"RTN","LA7SMB",197,0)
 ;
"RTN","LA7SMB",198,0)
 ;
"RTN","LA7SMB",199,0)
CKTEST(LA7AA,LA7AD,LA7AN,LA760) ; Check other tests on accession if test is part of another panel that
"RTN","LA7SMB",200,0)
 ; has been flagged for shipping.
"RTN","LA7SMB",201,0)
 ; Call with LA7AA = ien of accession area.
"RTN","LA7SMB",202,0)
 ;           LA7AD = accession date
"RTN","LA7SMB",203,0)
 ;           LA7AN = accession number
"RTN","LA7SMB",204,0)
 ;           LA760 = ien of lab test
"RTN","LA7SMB",205,0)
 ; Returns   LA7FLAG = 0 (part of another panel)
"RTN","LA7SMB",206,0)
 ;                   = 1 (not part of another panel)
"RTN","LA7SMB",207,0)
 ;
"RTN","LA7SMB",208,0)
 N LA7FLAG,LA7PCNT,LA7K,LA7J,X
"RTN","LA7SMB",209,0)
 ;
"RTN","LA7SMB",210,0)
 K ^TMP("LA7TREE",$J)
"RTN","LA7SMB",211,0)
 ;
"RTN","LA7SMB",212,0)
 S LA7FLAG=1
"RTN","LA7SMB",213,0)
 S LA7AD(LA7AD)=""
"RTN","LA7SMB",214,0)
 S LA7K=+$P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,0)),"^",3)
"RTN","LA7SMB",215,0)
 ;
"RTN","LA7SMB",216,0)
 I LA7K D
"RTN","LA7SMB",217,0)
 . ; Check original accession date.
"RTN","LA7SMB",218,0)
 . S LA7AD(LA7K)=""
"RTN","LA7SMB",219,0)
 . ; Check rollover accession
"RTN","LA7SMB",220,0)
 . I $P($G(^LRO(68,LA7AA,1,LA7K,1,LA7AN,9)),"^") S LA7AD($P($G(^LRO(68,LA7AA,1,LA7K,1,LA7AN,9)),"^"))=""
"RTN","LA7SMB",221,0)
 S LA7AD=0
"RTN","LA7SMB",222,0)
 F  S LA7AD=$O(LA7AD(LA7AD)) Q:'LA7AD  D
"RTN","LA7SMB",223,0)
 . S LA7J=0
"RTN","LA7SMB",224,0)
 . F  S LA7J=$O(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,LA7J)) Q:'LA7J  D
"RTN","LA7SMB",225,0)
 . . I LA7J=LA760 Q
"RTN","LA7SMB",226,0)
 . . ; Not on manifest
"RTN","LA7SMB",227,0)
 . . I '$P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,LA7J,0)),"^",10) Q
"RTN","LA7SMB",228,0)
 . . S LA7PCNT=0 D UNWIND(LA7J)
"RTN","LA7SMB",229,0)
 ;
"RTN","LA7SMB",230,0)
 ; Test is part of another test previously shipped.
"RTN","LA7SMB",231,0)
 I $D(^TMP("LA7TREE",$J,LA760)) S LA7FLAG=0
"RTN","LA7SMB",232,0)
 ;
"RTN","LA7SMB",233,0)
 K ^TMP("LA7TREE",$J)
"RTN","LA7SMB",234,0)
 ;
"RTN","LA7SMB",235,0)
 Q LA7FLAG
"RTN","LA7SMB",236,0)
 ;
"RTN","LA7SMB",237,0)
UNWIND(LA760) ; Unwind profile - set tests into global ^TMP("LA7TREE",$J).
"RTN","LA7SMB",238,0)
 ; Initialize variable LA7PCNT=0 before calling.
"RTN","LA7SMB",239,0)
 ; Kill ^TMP("LA7TREE",$J) before calling.
"RTN","LA7SMB",240,0)
 ;
"RTN","LA7SMB",241,0)
 N I,II
"RTN","LA7SMB",242,0)
 ;
"RTN","LA7SMB",243,0)
 ; Recursive panel, caught in a loop.
"RTN","LA7SMB",244,0)
 I $G(LA7PCNT)>50 Q
"RTN","LA7SMB",245,0)
 ; Test does not exist in file 60.
"RTN","LA7SMB",246,0)
 I '$D(^LAB(60,LA760,0)) Q
"RTN","LA7SMB",247,0)
 ; Bypass "workload" type tests.
"RTN","LA7SMB",248,0)
 I $P(^LAB(60,LA760,0),"^",4)="WK" Q
"RTN","LA7SMB",249,0)
 ; Atomic test
"RTN","LA7SMB",250,0)
 I $L($P(^LAB(60,LA760,0),"^",5)) S ^TMP("LA7TREE",$J,LA760)="" Q
"RTN","LA7SMB",251,0)
 ; Check panels
"RTN","LA7SMB",252,0)
 I $O(^LAB(60,LA760,2,0)) D
"RTN","LA7SMB",253,0)
 . ; Increment panel counter.
"RTN","LA7SMB",254,0)
 . S LA7PCNT=$G(LA7PCNT)+1
"RTN","LA7SMB",255,0)
 . S I=0
"RTN","LA7SMB",256,0)
 . ; Expand test on panel.
"RTN","LA7SMB",257,0)
 . F  S I=$O(^LAB(60,LA760,2,I)) Q:'I  D
"RTN","LA7SMB",258,0)
 . . ; IEN of test on panel.
"RTN","LA7SMB",259,0)
 . . S II=+$G(^LAB(60,LA760,2,I,0))
"RTN","LA7SMB",260,0)
 . . ; Recursive panel, panel calls itself.
"RTN","LA7SMB",261,0)
 . . I II,II=LA760 Q
"RTN","LA7SMB",262,0)
 . . I II S ^TMP("LA7TREE",$J,LA760)="" D UNWIND(II)
"RTN","LA7SMB",263,0)
 Q
"RTN","LA7SMB",264,0)
 ;
"RTN","LA7SMB",265,0)
LOCK68 ; Lock entry in file 68
"RTN","LA7SMB",266,0)
 ; Called from above, LA7SM
"RTN","LA7SMB",267,0)
 ;
"RTN","LA7SMB",268,0)
 L +^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,LA760):9999 ; Set lock.
"RTN","LA7SMB",269,0)
 ;
"RTN","LA7SMB",270,0)
 Q
"RTN","LA7SMB",271,0)
 ;
"RTN","LA7SMB",272,0)
UNLOCK68 ; Unlock entry in file 68
"RTN","LA7SMB",273,0)
 ; Called from above, LA7SM
"RTN","LA7SMB",274,0)
 ;
"RTN","LA7SMB",275,0)
 L -^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,LA760) ; Release lock.
"RTN","LA7SMB",276,0)
 ;
"RTN","LA7SMB",277,0)
 Q
"RTN","LA7SMB",278,0)
 ;
"RTN","LA7SMB",279,0)
CLEANUP ; Cleanup variables
"RTN","LA7SMB",280,0)
 ;
"RTN","LA7SMB",281,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","LA7SMB",282,0)
 ;
"RTN","LA7SMB",283,0)
 K ^TMP("LA7SMB",$J),^TMP("LA7SMADD",$J),^TMP("LA7TREE",$J)
"RTN","LA7SMB",284,0)
 ;
"RTN","LA7SMB",285,0)
 K LA760,LA76205,LA76805,LA7AA,LA7AD,LA7AN,LA7EXPRV,LA7FLAG,LA7LAN,LA7PCNT,LA7QUIT,LA7SCFG,LA7SM,LA7SMCNT,LA7UID,LA7X
"RTN","LA7SMB",286,0)
 K LRDFN
"RTN","LA7SMB",287,0)
 Q
"RTN","LA7SMP")
0^2^B61468752
"RTN","LA7SMP",1,0)
LA7SMP ;DALOI/JMC - Shipping Manifest Print ;11/25/96  14:39
"RTN","LA7SMP",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,45,46,64**;Sep 27, 1994
"RTN","LA7SMP",3,0)
EN ;
"RTN","LA7SMP",4,0)
 D EN^DDIOL("Print Shipping Manifest","","!!")
"RTN","LA7SMP",5,0)
 D KILL^LA7SMP0
"RTN","LA7SMP",6,0)
 D INIT^LA7SMP0
"RTN","LA7SMP",7,0)
 I LA7QUIT D KILL^LA7SMP0 Q
"RTN","LA7SMP",8,0)
 S LA7SM=$$SELSM^LA7SMU(+LA7SCFG)
"RTN","LA7SMP",9,0)
 I LA7SM<0 D  Q
"RTN","LA7SMP",10,0)
 . D EN^DDIOL($P(LA7SM,"^",2),"","!?5")
"RTN","LA7SMP",11,0)
 . D KILL^LA7SMP0
"RTN","LA7SMP",12,0)
 S LA7CHK=1 ; flag to check for missing info.
"RTN","LA7SMP",13,0)
 W !
"RTN","LA7SMP",14,0)
 D DEV
"RTN","LA7SMP",15,0)
 D END^LA7SMP0
"RTN","LA7SMP",16,0)
 Q
"RTN","LA7SMP",17,0)
 ;
"RTN","LA7SMP",18,0)
 ;
"RTN","LA7SMP",19,0)
DEV ; Alternate entry point when user has already selected a manifest.
"RTN","LA7SMP",20,0)
 ;
"RTN","LA7SMP",21,0)
 ; Determine if bar codes on manifest
"RTN","LA7SMP",22,0)
 S LA7SBC=$$GET1^DIQ(62.9,+LA7SCFG_",",.09,"I")
"RTN","LA7SMP",23,0)
 ; If not in shipping status then don't print, save paper
"RTN","LA7SMP",24,0)
 I $P($G(^LAHM(62.8,+LA7SM,0)),"^",3)<4 S LA7SBC=0
"RTN","LA7SMP",25,0)
 I LA7SBC,$P($G(^LAHM(62.8,+LA7SM,0)),"^",3)=4 D
"RTN","LA7SMP",26,0)
 . N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LA7SMP",27,0)
 . S DIR(0)="YO",DIR("A")="Print barcodes on manifest",DIR("B")="YES"
"RTN","LA7SMP",28,0)
 . D ^DIR
"RTN","LA7SMP",29,0)
 . I $D(DIRUT) S LA7EXIT=1
"RTN","LA7SMP",30,0)
 . I Y'=1 S LA7SBC=0
"RTN","LA7SMP",31,0)
 I $G(LA7EXIT) Q
"RTN","LA7SMP",32,0)
 ;
"RTN","LA7SMP",33,0)
 S %ZIS="MQ" D ^%ZIS
"RTN","LA7SMP",34,0)
 I POP D  Q
"RTN","LA7SMP",35,0)
 . D HOME^%ZIS
"RTN","LA7SMP",36,0)
 . S LA7EXIT=1
"RTN","LA7SMP",37,0)
 I $D(IO("Q")) D  Q
"RTN","LA7SMP",38,0)
 . N ZTDTH,ZTSK,ZTRTN,ZTIO,ZTSAVE
"RTN","LA7SMP",39,0)
 . S ZTRTN="DQ^LA7SMP",ZTSAVE("LA7*")="",ZTDESC="Lab Shipping Manifest Print"
"RTN","LA7SMP",40,0)
 . D ^%ZTLOAD,^%ZISC
"RTN","LA7SMP",41,0)
 . D EN^DDIOL("Request "_$S($G(ZTSK):"queued - Task #"_ZTSK,1:"NOT queued"),"","!")
"RTN","LA7SMP",42,0)
 . S LA7EXIT=1
"RTN","LA7SMP",43,0)
DQ ;
"RTN","LA7SMP",44,0)
 ;
"RTN","LA7SMP",45,0)
 U IO
"RTN","LA7SMP",46,0)
 ;
"RTN","LA7SMP",47,0)
 S LA7SM(0)=$G(^LAHM(62.8,+LA7SM,0))
"RTN","LA7SMP",48,0)
 S LA7SCFG=+$P(LA7SM(0),"^",2),LA7SCFG(0)=$G(^LAHM(62.9,LA7SCFG,0))
"RTN","LA7SMP",49,0)
 S (LA7DC,LA7EXIT,LA7END,LA7ITEM,LA7PAGE,LA7SMR,LA760,LA762801)=0
"RTN","LA7SMP",50,0)
 ;
"RTN","LA7SMP",51,0)
 ; Get collecting site's names and station numbers
"RTN","LA7SMP",52,0)
 D GETSITE^LA7SMP($P(LA7SCFG(0),"^",2),$P(LA7SCFG(0),"^",3),.LA7FSITE,.LA7TSITE)
"RTN","LA7SMP",53,0)
 ;
"RTN","LA7SMP",54,0)
 ; Flag - skip if accession deleted
"RTN","LA7SMP",55,0)
 S LA7SKIP=0
"RTN","LA7SMP",56,0)
 ; Check manifest for missing info.
"RTN","LA7SMP",57,0)
 I $G(LA7CHK)="" S LA7CHK=1
"RTN","LA7SMP",58,0)
 ;
"RTN","LA7SMP",59,0)
 S LA7NOW=$$HTE^XLFDT($H,"1M")
"RTN","LA7SMP",60,0)
 ; Manifest status
"RTN","LA7SMP",61,0)
 S LA7SMST=$P(LA7SM(0),"^",3)
"RTN","LA7SMP",62,0)
 I LA7SMST=4 D
"RTN","LA7SMP",63,0)
 . ; Get shipping date
"RTN","LA7SMP",64,0)
 . S LA7SDT=$$SMED^LA7SMU(LA7SM,"SM05")
"RTN","LA7SMP",65,0)
 . ; Flag to print receipt.
"RTN","LA7SMP",66,0)
 . I IOST["P-" S LA7SMR=$P(LA7SCFG(0),"^",10)
"RTN","LA7SMP",67,0)
 ;
"RTN","LA7SMP",68,0)
 ; Set barcode flag to "off"
"RTN","LA7SMP",69,0)
 I LA7SBC,IOST'["P-" S LA7SBC=0
"RTN","LA7SMP",70,0)
 ;
"RTN","LA7SMP",71,0)
 S $P(LA7SMST,"^",2)=$$EXTERNAL^DILFD(62.8,.03,"",LA7SMST)
"RTN","LA7SMP",72,0)
 S LA7LINE="",$P(LA7LINE,"-",IOM)=""
"RTN","LA7SMP",73,0)
 S LA7SVIA=$S($P(LA7SM(0),"^",4):$$GET1^DIQ(62.92,$P(LA7SM(0),"^",4)_",",.01),1:"None Specified")
"RTN","LA7SMP",74,0)
 ;
"RTN","LA7SMP",75,0)
 F  S LA762801=$O(^LAHM(62.8,+LA7SM,10,LA762801)) Q:'LA762801  D
"RTN","LA7SMP",76,0)
 . F I=0,1,2 S LA762801(I)=$G(^LAHM(62.8,+LA7SM,10,LA762801,I))
"RTN","LA7SMP",77,0)
 . I $P(LA762801(0),"^",8)=0 Q  ; Test previously "removed".
"RTN","LA7SMP",78,0)
 . S LA7SKIP=$$CHKTST^LA7SMU(+LA7SM,LA762801)
"RTN","LA7SMP",79,0)
 . I LA7SKIP,LA7SKIP<3 Q  ; Accession/test deleted
"RTN","LA7SMP",80,0)
 . I $G(LA7CHK) D CHKREQI^LA7SM2(+LA7SM,LA762801)
"RTN","LA7SMP",81,0)
 . S ^TMP("LA7SM",$J,+$P(LA762801(0),"^",7),+$P(LA762801(0),"^",9),$P(LA762801(0),"^",5),LA762801)=""
"RTN","LA7SMP",82,0)
 . D BUILDRI^LA7SM2
"RTN","LA7SMP",83,0)
 ;
"RTN","LA7SMP",84,0)
 S (LA7SCOND,LA7SCONT,LA7UID)=""
"RTN","LA7SMP",85,0)
 ;
"RTN","LA7SMP",86,0)
 I '$D(^TMP("LA7SM",$J)) D
"RTN","LA7SMP",87,0)
 . D HED^LA7SMP0
"RTN","LA7SMP",88,0)
 . W !!,$$CJ^XLFSTR("No entries to print",IOM)
"RTN","LA7SMP",89,0)
 ;
"RTN","LA7SMP",90,0)
 S LA7ROOT="^TMP(""LA7SM"",$J)"
"RTN","LA7SMP",91,0)
 F  S LA7ROOT=$Q(@LA7ROOT) Q:LA7ROOT=""  Q:$QS(LA7ROOT,1)'="LA7SM"!($QS(LA7ROOT,2)'=$J)  D  Q:LA7EXIT
"RTN","LA7SMP",92,0)
 . I LA7EXIT Q
"RTN","LA7SMP",93,0)
 . I $L(LA7UID),LA7UID'=$QS(LA7ROOT,5) W !,LA7LINE
"RTN","LA7SMP",94,0)
 . I LA7SCOND'=$QS(LA7ROOT,3)!(LA7SCONT'=$QS(LA7ROOT,4)) D  Q:LA7EXIT
"RTN","LA7SMP",95,0)
 . . I $L(LA7UID),LA7UID=$QS(LA7ROOT,5) W !,LA7LINE
"RTN","LA7SMP",96,0)
 . . I LA7PAGE,+LA7SMST'=4 W ! D WARN^LA7SMP0
"RTN","LA7SMP",97,0)
 . . S LA7SCOND=$QS(LA7ROOT,3),LA7SCONT=$QS(LA7ROOT,4)
"RTN","LA7SMP",98,0)
 . . D HED^LA7SMP0 S LA7UID=""
"RTN","LA7SMP",99,0)
 . S LA762801=$QS(LA7ROOT,6)
"RTN","LA7SMP",100,0)
 . F I=0,.1,2,5 S LA762801(I)=$G(^LAHM(62.8,+LA7SM,10,LA762801,I))
"RTN","LA7SMP",101,0)
 . S LA760=+$P(LA762801(0),"^",2) ; File #60 test ien
"RTN","LA7SMP",102,0)
 . I LA7UID'=$QS(LA7ROOT,5) D  Q:LA7EXIT
"RTN","LA7SMP",103,0)
 . . S LA7UID=$QS(LA7ROOT,5)
"RTN","LA7SMP",104,0)
 . . S LRDFN=+LA762801(0) D PTID^LA7SMP0
"RTN","LA7SMP",105,0)
 . . S X=$Q(^LRO(68,"C",LA7UID))
"RTN","LA7SMP",106,0)
 . . I LA7UID'=$QS(X,3) S LA7SKIP=1 ; Skip - UID missing.
"RTN","LA7SMP",107,0)
 . . S LA7AA=+$QS(X,4),LA7AD=+$QS(X,5),LA7AN=+$QS(X,6)
"RTN","LA7SMP",108,0)
 . . S LA7SKIP=$$CHKTST^LA7SMU(+LA7SM,LA762801)
"RTN","LA7SMP",109,0)
 . . I LA7SKIP,LA7SKIP<3 Q  ; Skip - accession/test deleted.
"RTN","LA7SMP",110,0)
 . . S LA7ACC=$P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,.2),"Accession not available"),"^")
"RTN","LA7SMP",111,0)
 . . S X=$P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,0),"Not available"),U,8)
"RTN","LA7SMP",112,0)
 . . S LA7PROV=$S(X>0:X,1:"")_"^"_$S(X>0:$$PRAC^LRX(X),1:X)
"RTN","LA7SMP",113,0)
 . . S LA7CDT=$P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,3),"Not available"),U,1)
"RTN","LA7SMP",114,0)
 . . S LA7SPEC=$G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,5,1,0),"Not available")
"RTN","LA7SMP",115,0)
 . . I LA7SPEC S LA7SPEC(0)=$G(^LAB(61,+LA7SPEC,0))
"RTN","LA7SMP",116,0)
 . . E  S LA7SPEC(0)="Specimen info not assigned"
"RTN","LA7SMP",117,0)
 . . S LA762=$P(LA7SPEC,"^",2)
"RTN","LA7SMP",118,0)
 . . I LA762 S LA762(0)=$G(^LAB(62,LA762,0))
"RTN","LA7SMP",119,0)
 . . E  S LA762(0)="Collection info not assigned"
"RTN","LA7SMP",120,0)
 . . S LA7ITEM=LA7ITEM+1
"RTN","LA7SMP",121,0)
 . . I ($Y+12)>IOSL D  Q:LA7EXIT
"RTN","LA7SMP",122,0)
 . . . W !
"RTN","LA7SMP",123,0)
 . . . I +LA7SMST'=4 D WARN^LA7SMP0
"RTN","LA7SMP",124,0)
 . . . D HED^LA7SMP0
"RTN","LA7SMP",125,0)
 . . D SH^LA7SMP0
"RTN","LA7SMP",126,0)
 . I LA7SKIP,LA7SKIP<3 Q  ; Skip - accession/test deleted.
"RTN","LA7SMP",127,0)
 . I ($Y+6)>IOSL D  Q:LA7EXIT
"RTN","LA7SMP",128,0)
 . . W !,LA7LINE
"RTN","LA7SMP",129,0)
 . . I +LA7SMST'=4 W ! D WARN^LA7SMP0
"RTN","LA7SMP",130,0)
 . . D HED^LA7SMP0 Q:LA7EXIT
"RTN","LA7SMP",131,0)
 . . S LA7DC=1 D SH^LA7SMP0
"RTN","LA7SMP",132,0)
 . W !,?11,$E(LA7LINE,1,41)
"RTN","LA7SMP",133,0)
 . W !,?11,$P(^LAB(60,LA760,0),"^",1),?43,$P(LA7SPEC(0),"^")
"RTN","LA7SMP",134,0)
 . I +LA7SMST'=4 D
"RTN","LA7SMP",135,0)
 . . N LA7TCOST
"RTN","LA7SMP",136,0)
 . . S LA7TCOST=$$GET1^DIQ(60,LA760_",",1,"E") Q:'$L(LA7TCOST)
"RTN","LA7SMP",137,0)
 . . W:$X>(IOM-15) ! W ?(IOM-15)," Cost: $",$FN(LA7TCOST,",",2)
"RTN","LA7SMP",138,0)
 . I LA762801(.1)'="" D
"RTN","LA7SMP",139,0)
 . . K ^UTILITY($J),LA7CMT
"RTN","LA7SMP",140,0)
 . . S DIWL=1,DIWR=IOM-13,DIWF=""
"RTN","LA7SMP",141,0)
 . . S X="Relevant clinical information: "_LA762801(.1) D ^DIWP
"RTN","LA7SMP",142,0)
 . . M LA7CMT=^UTILITY($J,"W",DIWL)
"RTN","LA7SMP",143,0)
 . . W ! D CMT^LA7SMP0 W !
"RTN","LA7SMP",144,0)
 . W !,?13,"VA NLT Code [Name]: "
"RTN","LA7SMP",145,0)
 . S LA7NLT=$$GET1^DIQ(64,+$$GET1^DIQ(60,LA760_",",64,"I")_",",1) ; NLT code.
"RTN","LA7SMP",146,0)
 . W $S($L(LA7NLT):LA7NLT,1:"*** None specified ***")
"RTN","LA7SMP",147,0)
 . S LA7NLTN=""
"RTN","LA7SMP",148,0)
 . I $L(LA7NLT) S LA7NLTN=$$GET1^DIQ(64,+$$GET1^DIQ(60,LA760_",",64,"I")_",",.01) ; NLT code test name.
"RTN","LA7SMP",149,0)
 . I $L(LA7NLTN) W:($X+$L(LA7NLTN)+3)>IOM !,?32 W " [",LA7NLTN,"]"
"RTN","LA7SMP",150,0)
 . I $P(LA7SM(0),"^",5) D  ; Print non-VA test code info
"RTN","LA7SMP",151,0)
 . . N LA7X,LA7Y,LA7Z
"RTN","LA7SMP",152,0)
 . . S LA7X=$P($G(^DIC(4,+$P(LA7SCFG(0),"^",3),0),"UNKNOWN"),"^",1)_" Order Code [Name]: "
"RTN","LA7SMP",153,0)
 . . W !,?11,LA7X,$S($L($P(LA762801(5),"^")):$P(LA762801(5),"^"),1:"*** None specified ***")," "
"RTN","LA7SMP",154,0)
 . . S LA7Y="["_$S($L($P(LA762801(5),"^",2)):$P(LA762801(5),"^",2),1:"*** None specified ***")_"]"
"RTN","LA7SMP",155,0)
 . . I $L(LA7Y)<(IOM-$X) W LA7Y Q
"RTN","LA7SMP",156,0)
 . . S LA7X=IOM-$X W $E(LA7Y,1,LA7X)
"RTN","LA7SMP",157,0)
 . . S LA7Y=$E(LA7Y,LA7X+1,$L(LA7Y)),LA7Z=IOM-11
"RTN","LA7SMP",158,0)
 . . F  S LA7X=$E(LA7Y,1,LA7Z) Q:LA7X=""  W !,?11,LA7X S LA7Y=$E(LA7Y,LA7Z+1,$L(LA7Y))
"RTN","LA7SMP",159,0)
 ;
"RTN","LA7SMP",160,0)
 I LA7EXIT Q
"RTN","LA7SMP",161,0)
 ;
"RTN","LA7SMP",162,0)
 W !,LA7LINE,!!,"End of Shipping Manifest"
"RTN","LA7SMP",163,0)
 ;
"RTN","LA7SMP",164,0)
 I +LA7SMST'=4 D
"RTN","LA7SMP",165,0)
 . I IOM<131 W !
"RTN","LA7SMP",166,0)
 . D WARN^LA7SMP0
"RTN","LA7SMP",167,0)
 ;
"RTN","LA7SMP",168,0)
 ; Print shipping manifest receipt.
"RTN","LA7SMP",169,0)
 I LA7SMR D
"RTN","LA7SMP",170,0)
 . ; Flag that we're now printing receipt
"RTN","LA7SMP",171,0)
 . S $P(LA7SMR,"^",2)=1
"RTN","LA7SMP",172,0)
 . D HED^LA7SMP0
"RTN","LA7SMP",173,0)
 . W !!,"Number of specimens: ",LA7ITEM
"RTN","LA7SMP",174,0)
 . W !!,"Receipted by: ",$$REPEAT^XLFSTR("_",40)
"RTN","LA7SMP",175,0)
 . W !!,"   Date/time: ",$$REPEAT^XLFSTR("_",20)
"RTN","LA7SMP",176,0)
 ;
"RTN","LA7SMP",177,0)
 ; Print error listing if any.
"RTN","LA7SMP",178,0)
 I $O(LA7ERR(""))'="" D
"RTN","LA7SMP",179,0)
 . S $P(LA7SMR,"^",2)=2 ; Flag printing of error listing
"RTN","LA7SMP",180,0)
 . D HED^LA7SMP0
"RTN","LA7SMP",181,0)
 . S LA7I=0
"RTN","LA7SMP",182,0)
 . F  S LA7I=$O(LA7ERR(LA7I)) Q:LA7I=""  D  Q:LA7EXIT
"RTN","LA7SMP",183,0)
 . . I ($Y+6)>IOSL D HED^LA7SMP0 Q:LA7EXIT
"RTN","LA7SMP",184,0)
 . . W LA7ERR(LA7I)
"RTN","LA7SMP",185,0)
 . . S LA7ROOT="^TMP(""LA7ERR"",$J,LA7I,$P(LA7SM,""^""))"
"RTN","LA7SMP",186,0)
 . . F  S LA7ROOT=$Q(@LA7ROOT) Q:$QS(LA7ROOT,1)'="LA7ERR"!($QS(LA7ROOT,2)'=$J)!($QS(LA7ROOT,3)'=LA7I)!($QS(LA7ROOT,4)'=$P(LA7SM,"^"))  D  Q:LA7EXIT
"RTN","LA7SMP",187,0)
 . . . I ($Y+6)>IOSL D HED^LA7SMP0 Q:LA7EXIT  W LA7ERR(LA7I)," (Cont'd)"
"RTN","LA7SMP",188,0)
 . . . W !,?10,"UID: ",$QS(LA7ROOT,5),"  Test: ",$$GET1^DIQ(60,$QS(LA7ROOT,6)_",",.01)
"RTN","LA7SMP",189,0)
 . . W !!
"RTN","LA7SMP",190,0)
 ;
"RTN","LA7SMP",191,0)
 I $D(ZTQUEUED) D END^LA7SMP0
"RTN","LA7SMP",192,0)
 ;
"RTN","LA7SMP",193,0)
 Q
"RTN","LA7SMP",194,0)
 ;
"RTN","LA7SMP",195,0)
 ;
"RTN","LA7SMP",196,0)
GETSITE(LA7X,LA7Y,LA7FS,LA7TS) ; Setup variables for ordering and host sites
"RTN","LA7SMP",197,0)
 ;
"RTN","LA7SMP",198,0)
 ; Call with  LA7X = File #4 ordering site ien
"RTN","LA7SMP",199,0)
 ;            LA7Y = File #4 host site ien
"RTN","LA7SMP",200,0)
 ;            LA7FS = array to return collecting site info
"RTN","LA7SMP",201,0)
 ;            LA7TS = array to return host site info
"RTN","LA7SMP",202,0)
 ;
"RTN","LA7SMP",203,0)
 ; Get ordering site's names and station numbers
"RTN","LA7SMP",204,0)
 S LA7FS=$$GET1^DIQ(4,LA7X_",",.01)
"RTN","LA7SMP",205,0)
 I LA7FS="" S LA7FS="UNKNOWN:Entry #"_+LA7X
"RTN","LA7SMP",206,0)
 S LA7FS(99)=$$RETFACID^LA7VHLU2(LA7X,2,1)
"RTN","LA7SMP",207,0)
 I LA7FS(99)="" S LA7FS(99)="UNK: #"_+LA7X
"RTN","LA7SMP",208,0)
 ;
"RTN","LA7SMP",209,0)
 ; Get host site's names and station numbers
"RTN","LA7SMP",210,0)
 S LA7TS=$$GET1^DIQ(4,LA7Y_",",.01)
"RTN","LA7SMP",211,0)
 I LA7TS="" S LA7TS="UNKNOWN:Entry #"_+LA7Y
"RTN","LA7SMP",212,0)
 S LA7TS(99)=$$RETFACID^LA7VHLU2(LA7X,1,1)
"RTN","LA7SMP",213,0)
 I LA7TS(99)="" S LA7TS(99)="UNK: #"_+LA7Y
"RTN","LA7SMP",214,0)
 Q
"RTN","LA7SMP",215,0)
 ;
"RTN","LA7SMP",216,0)
 ;
"RTN","LA7SMP",217,0)
ASK(LA7SM) ; Ask it user wants to print manifest.
"RTN","LA7SMP",218,0)
 ;  Call with array LA7SM = ien of 62.8^.01 field of #62.8
"RTN","LA7SMP",219,0)
 ;
"RTN","LA7SMP",220,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LA7SMP",221,0)
 ;
"RTN","LA7SMP",222,0)
 S DIR(0)="YO",DIR("A")="Print Shipping Manifest",DIR("B")="NO"
"RTN","LA7SMP",223,0)
 D ^DIR Q:$D(DIRUT)
"RTN","LA7SMP",224,0)
 I Y=1 D DEV,END^LA7SMP0
"RTN","LA7SMP",225,0)
 ;
"RTN","LA7SMP",226,0)
 Q
"RTN","LA7SMP0")
0^1^B48779053
"RTN","LA7SMP0",1,0)
LA7SMP0 ;DALOI/JMC - Shipping Manifest Print (Cont'd);11/25/96  14:39
"RTN","LA7SMP0",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7SMP0",3,0)
 ;
"RTN","LA7SMP0",4,0)
HED ; Header
"RTN","LA7SMP0",5,0)
 I $E(IOST,1,2)="C-" D TERM Q:$G(LA7EXIT)
"RTN","LA7SMP0",6,0)
 I LA7PAGE W @IOF S $X=0
"RTN","LA7SMP0",7,0)
 S LA7PAGE=LA7PAGE+1
"RTN","LA7SMP0",8,0)
 I +LA7SMST'=4,IOM<132 D WARN
"RTN","LA7SMP0",9,0)
 ;
"RTN","LA7SMP0",10,0)
 W !,?1,"Shipping Manifest: ",$P(LA7SM,"^",2)
"RTN","LA7SMP0",11,0)
 I +LA7SMST'=4,IOM'<132 D WARN
"RTN","LA7SMP0",12,0)
 ;
"RTN","LA7SMP0",13,0)
 W ?IOM-37," Page: ",LA7PAGE
"RTN","LA7SMP0",14,0)
 W !,?11,"to Site: ",LA7TSITE
"RTN","LA7SMP0",15,0)
 W ?IOM-40," Printed: ",LA7NOW
"RTN","LA7SMP0",16,0)
 W !,?9,"from Site: ",LA7FSITE
"RTN","LA7SMP0",17,0)
 ;
"RTN","LA7SMP0",18,0)
 I +LA7SMST=4 W !,?6,"Date Shipped: ",$P(LA7SDT,"^",2)
"RTN","LA7SMP0",19,0)
 E  W !,?12,"Status: ",$P(LA7SMST,"^",2)
"RTN","LA7SMP0",20,0)
 W ?IOM-41," Ship via: ",LA7SVIA
"RTN","LA7SMP0",21,0)
 ;
"RTN","LA7SMP0",22,0)
 ; Check if task has been asked to stop.
"RTN","LA7SMP0",23,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD D  Q
"RTN","LA7SMP0",24,0)
 . S (LA7EXIT,ZTSTOP)=1
"RTN","LA7SMP0",25,0)
 . W !!,"*** Report requested to stop by TaskMan ***"
"RTN","LA7SMP0",26,0)
 . W !,"*** Task #",$G(ZTQUEUED,"UNKNOWN")," stopped at ",$$HTE^XLFDT($H)," ***"
"RTN","LA7SMP0",27,0)
 ;
"RTN","LA7SMP0",28,0)
 ; Print shipping receipt
"RTN","LA7SMP0",29,0)
 I $P(LA7SMR,"^",2) D  Q
"RTN","LA7SMP0",30,0)
 . W !,LA7LINE
"RTN","LA7SMP0",31,0)
 . I $P(LA7SMR,"^",2)=2 W !!,"Following Required Information and/or Test Codes Missing",!!
"RTN","LA7SMP0",32,0)
 ;
"RTN","LA7SMP0",33,0)
 W !,"Shipping Condition: ",$S(LA7SCOND:$$GET1^DIQ(62.93,LA7SCOND_",",.01),1:"None Specified")
"RTN","LA7SMP0",34,0)
 W ?(IOM-42)," Container: ",$S(LA7SCONT:$$GET1^DIQ(62.91,LA7SCONT_",",.01),1:"None Specified")
"RTN","LA7SMP0",35,0)
 ;
"RTN","LA7SMP0",36,0)
 I $L($P(LA7SCFG(0),"^",13)) W !,?4,"Account Number: ",$P(LA7SCFG(0),"^",13)
"RTN","LA7SMP0",37,0)
 ;
"RTN","LA7SMP0",38,0)
 I LA7SBC D SBC1
"RTN","LA7SMP0",39,0)
 W !!,?11,"Patient Name",?41,"Patient ID",?64,"Accession"
"RTN","LA7SMP0",40,0)
 I IOM>131 W ?86,"Requested By"
"RTN","LA7SMP0",41,0)
 W !,?11,"Date of Birth",?41,"Sex",?64,"Specimen UID"
"RTN","LA7SMP0",42,0)
 I IOM>131 W ?86,"Collect Date/Time"
"RTN","LA7SMP0",43,0)
 I IOM'>131 W !,?11,"Requested By",?41,"Collect Date/Time"
"RTN","LA7SMP0",44,0)
 W !,LA7LINE
"RTN","LA7SMP0",45,0)
 Q
"RTN","LA7SMP0",46,0)
 ;
"RTN","LA7SMP0",47,0)
 ;
"RTN","LA7SMP0",48,0)
SH ; Subheader
"RTN","LA7SMP0",49,0)
 W !,"Item: ",LA7ITEM
"RTN","LA7SMP0",50,0)
 W ?11,PNM
"RTN","LA7SMP0",51,0)
 ;I LRDPF=2,LA7ICN W ?41,LA7ICN
"RTN","LA7SMP0",52,0)
 ;E  W ?41,$S(LRDPF=2:SSN,1:SSN(2))
"RTN","LA7SMP0",53,0)
 W ?41,$S(LRDPF=2:SSN,1:SSN(2))
"RTN","LA7SMP0",54,0)
 W ?64,LA7ACC
"RTN","LA7SMP0",55,0)
 I IOM>131 W ?86,$P(LA7PROV,"^",2)
"RTN","LA7SMP0",56,0)
 W !
"RTN","LA7SMP0",57,0)
 I LA7DC W "Cont'd"
"RTN","LA7SMP0",58,0)
 W ?11,$$FMTE^XLFDT(DOB),?41,$S(SEX="M":"Male",SEX="F":"Female",SEX="":"Unknown",1:SEX),?64,LA7UID
"RTN","LA7SMP0",59,0)
 I IOM'>131 W !,?11,$E($P(LA7PROV,"^",2),1,28),?41,$S(LA7CDT:$$FMTE^XLFDT(LA7CDT,"1M"),1:LA7CDT)
"RTN","LA7SMP0",60,0)
 I IOM>131 W ?86,$S(LA7CDT:$$FMTE^XLFDT(LA7CDT,"1M"),1:LA7CDT)
"RTN","LA7SMP0",61,0)
 W !
"RTN","LA7SMP0",62,0)
 I +LA7SMST'=4 D
"RTN","LA7SMP0",63,0)
 . D PROV(+LA7PROV)
"RTN","LA7SMP0",64,0)
 . I $P($G(LA762801(0)),"^",6) D
"RTN","LA7SMP0",65,0)
 . . S X=$$GET1^DIQ(62.91,$P(LA762801(0),"^",6),.01)
"RTN","LA7SMP0",66,0)
 . . W !,?11,"Specimen Container: ",X
"RTN","LA7SMP0",67,0)
 ;
"RTN","LA7SMP0",68,0)
 ; Print collection sample if micro
"RTN","LA7SMP0",69,0)
 I $G(LA7AA),$P($G(^LRO(68,LA7AA,0)),"^",2)="MI" W !,?11,"Collection sample: ",$P(LA762(0),"^")
"RTN","LA7SMP0",70,0)
 ;
"RTN","LA7SMP0",71,0)
 S LA7X=$G(^TMP("LA7SMRI",$J,LA7SCOND,LA7SCONT,LA7UID,1))
"RTN","LA7SMP0",72,0)
 I $P(LA7X,"^") D
"RTN","LA7SMP0",73,0)
 . W !,?11,"Patient Height: ",$P(LA7X,"^",2)," ",$$GET1^DIQ(64.061,+$P(LA7X,"^",3)_",",.01)
"RTN","LA7SMP0",74,0)
 I $P(LA7X,"^",4) D
"RTN","LA7SMP0",75,0)
 . I $P(LA7X,"^") W ?40
"RTN","LA7SMP0",76,0)
 . E  W !,?11
"RTN","LA7SMP0",77,0)
 . W "Patient Weight: ",$P(LA7X,"^",5)," ",$$GET1^DIQ(64.061,+$P(LA7X,"^",6)_",",.01)
"RTN","LA7SMP0",78,0)
 ;
"RTN","LA7SMP0",79,0)
 S LA7X=$G(^TMP("LA7SMRI",$J,LA7SCOND,LA7SCONT,LA7UID,2))
"RTN","LA7SMP0",80,0)
 I $P(LA7X,"^") D
"RTN","LA7SMP0",81,0)
 . W !,?11,"Collection Volume: ",$P(LA7X,"^",2)," ",$$GET1^DIQ(64.061,+$P(LA7X,"^",3)_",",.01)
"RTN","LA7SMP0",82,0)
 I $P(LA7X,"^",8) D
"RTN","LA7SMP0",83,0)
 . I $P(LA7X,"^") W ?40
"RTN","LA7SMP0",84,0)
 . E  W !,?11
"RTN","LA7SMP0",85,0)
 . W "Collection Weight: ",$P(LA7X,"^",9)," ",$$GET1^DIQ(64.061,+$P(LA7X,"^",10)_",",.01)
"RTN","LA7SMP0",86,0)
 I $P(LA7X,"^",4) D
"RTN","LA7SMP0",87,0)
 . W !,?11,"Collection End Date/Time: ",$$FMTE^XLFDT($P(LA7X,"^",5),"1M")
"RTN","LA7SMP0",88,0)
 . W "  (Duration: ",$P(LA7X,"^",6)," ",$$GET1^DIQ(64.061,+$P(LA7X,"^",7)_",",.01),")"
"RTN","LA7SMP0",89,0)
 ;
"RTN","LA7SMP0",90,0)
 I LA7SBC D SBC2
"RTN","LA7SMP0",91,0)
 S LA7DC=0
"RTN","LA7SMP0",92,0)
 Q
"RTN","LA7SMP0",93,0)
 ;
"RTN","LA7SMP0",94,0)
 ;
"RTN","LA7SMP0",95,0)
WARN ; Write warning for work copy.
"RTN","LA7SMP0",96,0)
 W ?$S(IOM<131:5,1:40),"*** DO NOT USE FOR SHIPPING DOCUMENT - WORK COPY ONLY ***"
"RTN","LA7SMP0",97,0)
 Q
"RTN","LA7SMP0",98,0)
 ;
"RTN","LA7SMP0",99,0)
 ;
"RTN","LA7SMP0",100,0)
SBC1 ; Site bar codes
"RTN","LA7SMP0",101,0)
 ;
"RTN","LA7SMP0",102,0)
 ; Print "SM" bar code
"RTN","LA7SMP0",103,0)
 ; Calculate/append LPC to barcode. 
"RTN","LA7SMP0",104,0)
 I $G(LA7SM("BARCODE"))="" D
"RTN","LA7SMP0",105,0)
 . N LA7X,X,Y
"RTN","LA7SMP0",106,0)
 . I LA7SBC=1 D
"RTN","LA7SMP0",107,0)
 . . S LA7X="STX^SITE^"_LA7FSITE(99)_"^"_$P($G(LA7SDT),"^")_"^"_$P(LA7SM,"^",2)_"^ETX"
"RTN","LA7SMP0",108,0)
 . I LA7SBC=2 D
"RTN","LA7SMP0",109,0)
 . .S LA7X="SITE^"_LA7FSITE(99)_"^"_$P($G(LA7SDT),"^")_"^"_$P(LA7SM,"^",2)_"^"
"RTN","LA7SMP0",110,0)
 . S X=LA7X X ^%ZOSF("LPC") S LA7SM("LPC")=Y,LA7SM("BARCODE")=LA7X_Y
"RTN","LA7SMP0",111,0)
 ;
"RTN","LA7SMP0",112,0)
 W !,?18,"SM: ",$$BC128^LA7SBC(LA7SM("BARCODE"),1,60,"","",2),!
"RTN","LA7SMP0",113,0)
 ;
"RTN","LA7SMP0",114,0)
 Q
"RTN","LA7SMP0",115,0)
 ;
"RTN","LA7SMP0",116,0)
 ;
"RTN","LA7SMP0",117,0)
SBC2 ; Patient bar codes
"RTN","LA7SMP0",118,0)
 ;
"RTN","LA7SMP0",119,0)
 N LA7SDATA
"RTN","LA7SMP0",120,0)
 ;
"RTN","LA7SMP0",121,0)
 ; Print "PD" bar code
"RTN","LA7SMP0",122,0)
 I LA7SBC=1 D
"RTN","LA7SMP0",123,0)
 . S LA7SDATA="STX^PD^"_SSN(2)_"^"_LA7FSITE(99)_"^"_LA7UID_"^"_$G(SEX)_"^"_LA7CDT_"^ETX"_$G(LA7SM("LPC"))
"RTN","LA7SMP0",124,0)
 ;
"RTN","LA7SMP0",125,0)
 I LA7SBC=2 D
"RTN","LA7SMP0",126,0)
 . S LA7SDATA="PD^"_SSN(2)_"^"_LA7FSITE(99)_"^"_LA7UID_"^"_LA7CDT_"^"_$G(LA7SM("LPC"))
"RTN","LA7SMP0",127,0)
 ;
"RTN","LA7SMP0",128,0)
 W !!,?18,"PD: ",$$BC128^LA7SBC(LA7SDATA,1,60,"","",2),!
"RTN","LA7SMP0",129,0)
 W !,?11,$E(LA7LINE,1,69)
"RTN","LA7SMP0",130,0)
 ;
"RTN","LA7SMP0",131,0)
 ; Print "PD1" bar code
"RTN","LA7SMP0",132,0)
 I LA7SBC=1 D
"RTN","LA7SMP0",133,0)
 . S LA7SDATA="STX^PD1^"_SSN(2)_"^"_PNM_"^"_DOB_"^ETX"_$G(LA7SM("LPC"))
"RTN","LA7SMP0",134,0)
 I LA7SBC=2 D
"RTN","LA7SMP0",135,0)
 . S LA7SDATA="PD1^"_SSN(2)_"^"_PNM_"^"_DOB_"^"_SEX_"^"_$G(LA7SM("LPC"))
"RTN","LA7SMP0",136,0)
 ;
"RTN","LA7SMP0",137,0)
 W !,?$S(IOM<131:18,1:50),"PD1: ",$$BC128^LA7SBC(LA7SDATA,1,60,"","",2),!
"RTN","LA7SMP0",138,0)
 ;
"RTN","LA7SMP0",139,0)
 Q
"RTN","LA7SMP0",140,0)
 ;
"RTN","LA7SMP0",141,0)
 ;
"RTN","LA7SMP0",142,0)
CMT ; Print comments on manifest
"RTN","LA7SMP0",143,0)
 ;
"RTN","LA7SMP0",144,0)
 N LA7I
"RTN","LA7SMP0",145,0)
 F LA7I=1:1:LA7CMT D  Q:LA7EXIT
"RTN","LA7SMP0",146,0)
 . I ($Y+4)>IOSL D  Q:LA7EXIT
"RTN","LA7SMP0",147,0)
 . . I LA7PAGE W ! D WARN
"RTN","LA7SMP0",148,0)
 . . D HED
"RTN","LA7SMP0",149,0)
 . W !,?11,LA7CMT(LA7I,0)
"RTN","LA7SMP0",150,0)
 Q
"RTN","LA7SMP0",151,0)
 ;
"RTN","LA7SMP0",152,0)
 ;
"RTN","LA7SMP0",153,0)
PTID ; Get/setup patient identifier information
"RTN","LA7SMP0",154,0)
 ;
"RTN","LA7SMP0",155,0)
 S DFN=+$P(^LR(LRDFN,0),U,3),LRDPF=+$P(^(0),U,2) D PT^LRX
"RTN","LA7SMP0",156,0)
 ;
"RTN","LA7SMP0",157,0)
 ; Integration control number (ICN) from MPI
"RTN","LA7SMP0",158,0)
 S LA7ICN=""
"RTN","LA7SMP0",159,0)
 S X="MPIF001" X ^%ZOSF("TEST")
"RTN","LA7SMP0",160,0)
 I $T,LRDPF=2 D
"RTN","LA7SMP0",161,0)
 . S LA7ICN=$$GETICN^MPIF001(DFN)
"RTN","LA7SMP0",162,0)
 . I LA7ICN<1 S LA7ICN=""
"RTN","LA7SMP0",163,0)
 Q
"RTN","LA7SMP0",164,0)
 ;
"RTN","LA7SMP0",165,0)
 ;
"RTN","LA7SMP0",166,0)
PROV(LA7OP) ; Print ordering provider contact on working copy
"RTN","LA7SMP0",167,0)
 ; Call with LA7OP = provider's file #200 ien
"RTN","LA7SMP0",168,0)
 ;
"RTN","LA7SMP0",169,0)
 N LRERR,X,Y
"RTN","LA7SMP0",170,0)
 I LA7OP D GETS^DIQ(200,LA7OP_",",".132;.137;.138","E","LA7OP(LA7OP)","LRERR")
"RTN","LA7SMP0",171,0)
 I '$D(LA7OP(LA7OP)) Q
"RTN","LA7SMP0",172,0)
 S X="Requestor's "
"RTN","LA7SMP0",173,0)
 I LA7OP(LA7OP,200,LA7OP_",",.132,"E")'="" D
"RTN","LA7SMP0",174,0)
 . W !,?11,X,"Phone: ",LA7OP(LA7OP,200,LA7OP_",",.132,"E")
"RTN","LA7SMP0",175,0)
 . S X=""
"RTN","LA7SMP0",176,0)
 I LA7OP(LA7OP,200,LA7OP_",",.137,"E")'="" D
"RTN","LA7SMP0",177,0)
 . S Y=0
"RTN","LA7SMP0",178,0)
 . I X="" S Y=$L(LA7OP(LA7OP,200,LA7OP_",",.137,"E"))+$X+16
"RTN","LA7SMP0",179,0)
 . I Y>IOM!(X'="") W !,?11
"RTN","LA7SMP0",180,0)
 . E  S X="  "_X
"RTN","LA7SMP0",181,0)
 . W X,"Voice Pager: ",LA7OP(LA7OP,200,LA7OP_",",.137,"E")
"RTN","LA7SMP0",182,0)
 . S X=""
"RTN","LA7SMP0",183,0)
 I LA7OP(LA7OP,200,LA7OP_",",.138,"E")'="" D
"RTN","LA7SMP0",184,0)
 . S Y=0
"RTN","LA7SMP0",185,0)
 . I X="" S Y=$L(LA7OP(LA7OP,200,LA7OP_",",.138,"E"))+$X+18
"RTN","LA7SMP0",186,0)
 . I Y>IOM!(X'="") W !,?11
"RTN","LA7SMP0",187,0)
 . E  S X="  "_X
"RTN","LA7SMP0",188,0)
 . W X,"Digital Pager: ",LA7OP(LA7OP,200,LA7OP_",",.138,"E")
"RTN","LA7SMP0",189,0)
 . S X=""
"RTN","LA7SMP0",190,0)
 ;
"RTN","LA7SMP0",191,0)
 I X="" W !
"RTN","LA7SMP0",192,0)
 Q
"RTN","LA7SMP0",193,0)
 ;
"RTN","LA7SMP0",194,0)
 ;
"RTN","LA7SMP0",195,0)
TERM ;
"RTN","LA7SMP0",196,0)
 I 'LA7PAGE W @IOF S $X=0 Q
"RTN","LA7SMP0",197,0)
 ;
"RTN","LA7SMP0",198,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LA7SMP0",199,0)
 S DIR(0)="E" D ^DIR S:$D(DIRUT) LA7EXIT=1
"RTN","LA7SMP0",200,0)
 Q
"RTN","LA7SMP0",201,0)
 ;
"RTN","LA7SMP0",202,0)
 ;
"RTN","LA7SMP0",203,0)
INIT ; Initialize variables
"RTN","LA7SMP0",204,0)
 ;
"RTN","LA7SMP0",205,0)
 S DT=$$DT^XLFDT
"RTN","LA7SMP0",206,0)
 S LA7QUIT=0
"RTN","LA7SMP0",207,0)
 ;
"RTN","LA7SMP0",208,0)
 ; Select shipping configuration
"RTN","LA7SMP0",209,0)
 S LA7SCFG=$$SSCFG^LA7SUTL(0)
"RTN","LA7SMP0",210,0)
 I LA7SCFG<1 S LA7QUIT=1 Q
"RTN","LA7SMP0",211,0)
 S LA7SCFG(0)=$G(^LAHM(62.9,+LA7SCFG,0))
"RTN","LA7SMP0",212,0)
 Q
"RTN","LA7SMP0",213,0)
 ;
"RTN","LA7SMP0",214,0)
END ;
"RTN","LA7SMP0",215,0)
 I $E(IOST,1,2)="C-",'$G(LA7EXIT) D TERM
"RTN","LA7SMP0",216,0)
 I $E(IOST,1,2)="P-" W @IOF S IONOFF=""
"RTN","LA7SMP0",217,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","LA7SMP0",218,0)
 ;
"RTN","LA7SMP0",219,0)
KILL ; Cleanup variables
"RTN","LA7SMP0",220,0)
 K %,%DT,%ZIS,A,IO("Q"),AGE,DA,DFN,DIC,DIB,DIR,DIRUT,DTOUT,DUOUT,I,J,K,LAST,PNM,SEX,SSN,X,Y,Z
"RTN","LA7SMP0",221,0)
 K LA7AA,LA7ACC,LA7AD,LA7AN,LA7CDT,LA7CHK,LA7CMT,LA7DC,LA7END,LA7ERR,LA7EV,LA7EXIT,LA7FSITE,LA7I,LA7ICN,LA7ITEM,LA7LINE,LA7NLT,LA7NLTN,LA7NOW,LA7PAGE,LA7PROV
"RTN","LA7SMP0",222,0)
 K LA7QUIT,LA7ROOT,LA7SBC,LA7SCFG,LA7SCOND,LA7SCONT,LA7SDT,LA7SKIP,LA7SM,LA7SMR,LA7SMST,LA7SPEC,LA7SVIA,LA7TSITE,LA7UID,LA7X
"RTN","LA7SMP0",223,0)
 K LA760,LA762801
"RTN","LA7SMP0",224,0)
 K LRDFN,LRDPF,LRPRAC
"RTN","LA7SMP0",225,0)
 K ^TMP("LA7ERR",$J),^TMP("LA7SM",$J),^TMP("LA7SMRI",$J)
"RTN","LA7SMP0",226,0)
 D KVAR^LRX
"RTN","LA7SMP0",227,0)
 ;
"RTN","LA7SMP0",228,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","LA7SMP0",229,0)
 Q
"RTN","LA7SMPXL")
0^3^B17436315
"RTN","LA7SMPXL",1,0)
LA7SMPXL ;DALOI/JMC - PRINT SHIPPING MANIFEST FROM PENDING ORDERS FILE ; 12/3/1997
"RTN","LA7SMPXL",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,42,46,64**;Sep 27, 1994
"RTN","LA7SMPXL",3,0)
EN ;
"RTN","LA7SMPXL",4,0)
 ;
"RTN","LA7SMPXL",5,0)
 N D,DIC,LA7SM,X,Y,%ZIS
"RTN","LA7SMPXL",6,0)
 ;
"RTN","LA7SMPXL",7,0)
 S DIC=69.6,DIC(0)="AQEZNM",DIC("A")="Select Shipping Manifest: ",D="D"
"RTN","LA7SMPXL",8,0)
 S DIC("S")="I $L($P(^(0),U,14))"
"RTN","LA7SMPXL",9,0)
 D MIX^DIC1 K DIC("S")
"RTN","LA7SMPXL",10,0)
 I Y<1 D END Q
"RTN","LA7SMPXL",11,0)
 ;
"RTN","LA7SMPXL",12,0)
 S LA7SMAN=$P(Y(0),U,14)
"RTN","LA7SMPXL",13,0)
 ;
"RTN","LA7SMPXL",14,0)
 S %ZIS="MQ"
"RTN","LA7SMPXL",15,0)
 D ^%ZIS
"RTN","LA7SMPXL",16,0)
 I POP D  Q
"RTN","LA7SMPXL",17,0)
 . D HOME^%ZIS
"RTN","LA7SMPXL",18,0)
 . D END
"RTN","LA7SMPXL",19,0)
 ;
"RTN","LA7SMPXL",20,0)
 I $D(IO("Q")) D  Q
"RTN","LA7SMPXL",21,0)
 . S ZTRTN="DQ^LA7SMPXL",ZTDESC="Shipping Manifest Reprint",ZTSAVE("LA7*")=""
"RTN","LA7SMPXL",22,0)
 . D ^%ZTLOAD,HOME^%ZIS
"RTN","LA7SMPXL",23,0)
 . D EN^DDIOL("Request "_$S($G(ZTSK):"queued - Task #"_ZTSK,1:"NOT queued"),"","!")
"RTN","LA7SMPXL",24,0)
 . D END
"RTN","LA7SMPXL",25,0)
 ;
"RTN","LA7SMPXL",26,0)
DQ ; Tasked entry point
"RTN","LA7SMPXL",27,0)
 ;
"RTN","LA7SMPXL",28,0)
 U IO
"RTN","LA7SMPXL",29,0)
 ;
"RTN","LA7SMPXL",30,0)
 S DT=$$DT^XLFDT
"RTN","LA7SMPXL",31,0)
 S LRDPF=69.6,LA7NOW=$$HTE^XLFDT($H,"1M")
"RTN","LA7SMPXL",32,0)
 S (LA7DC,LA7EXIT,LA7PAGE,LA7SCOND,LA7SCONT)=0
"RTN","LA7SMPXL",33,0)
 S LA7SCFG=0,LA7SCFG(0)=""
"RTN","LA7SMPXL",34,0)
 S LA7LINE="",$P(LA7LINE,"-",IOM)="",LA7SVIA="Electronic manifest"
"RTN","LA7SMPXL",35,0)
 ;
"RTN","LA7SMPXL",36,0)
 ; Check manifest for missing info.
"RTN","LA7SMPXL",37,0)
 S LA7CHK=0
"RTN","LA7SMPXL",38,0)
 ; Flag to print receipt.
"RTN","LA7SMPXL",39,0)
 S LA7SMR="0^0"
"RTN","LA7SMPXL",40,0)
 ; Set barcode flag
"RTN","LA7SMPXL",41,0)
 S LA7SBC=0
"RTN","LA7SMPXL",42,0)
 I IOST["P-" S LA7SBC=2
"RTN","LA7SMPXL",43,0)
 ; Shipping status flag
"RTN","LA7SMPXL",44,0)
 S LA7SMST="0^Electronic Manifest"
"RTN","LA7SMPXL",45,0)
 ;
"RTN","LA7SMPXL",46,0)
 S (LA7696,LA7QUIT)=0,LA7UID=""
"RTN","LA7SMPXL",47,0)
 S LA7SM="^"_LA7SMAN
"RTN","LA7SMPXL",48,0)
 S LA7ROOT="^LRO(69.6,""AD"",LA7SMAN)"
"RTN","LA7SMPXL",49,0)
 F LA7ITEM=1:1 S LA7ROOT=$Q(@LA7ROOT) D  Q:LA7EXIT
"RTN","LA7SMPXL",50,0)
 . I $QS(LA7ROOT,3)'=LA7SMAN S LA7EXIT=1
"RTN","LA7SMPXL",51,0)
 . I LA7EXIT Q
"RTN","LA7SMPXL",52,0)
 . I LA7UID'="",LA7UID'=$QS(LA7ROOT,4) W !,LA7LINE
"RTN","LA7SMPXL",53,0)
 . S LA7696=$QS(LA7ROOT,5)
"RTN","LA7SMPXL",54,0)
 . D SETUP
"RTN","LA7SMPXL",55,0)
 . I ($Y+12)>IOSL!('LA7PAGE) D  Q:LA7EXIT
"RTN","LA7SMPXL",56,0)
 . . I LA7PAGE W ! D WARN^LA7SMP0
"RTN","LA7SMPXL",57,0)
 . . D HED^LA7SMP0
"RTN","LA7SMPXL",58,0)
 . D SH^LA7SMP0
"RTN","LA7SMPXL",59,0)
 . I $D(LA7CMT) D CMT^LA7SMP0
"RTN","LA7SMPXL",60,0)
 . W !,?18,$E(LA7LINE,1,31)
"RTN","LA7SMPXL",61,0)
 . S LA76964=0
"RTN","LA7SMPXL",62,0)
 . F  S LA76964=$O(^LRO(69.6,LA7696,2,LA76964)) Q:LA76964<1  D
"RTN","LA7SMPXL",63,0)
 . . S LA76964(0)=$G(^LRO(69.6,LA7696,2,LA76964,0))
"RTN","LA7SMPXL",64,0)
 . . W !?18,$P(LA76964(0),"^",3),?50,$P(LA7SPEC(0),"^")
"RTN","LA7SMPXL",65,0)
 . . W !,?20,"VA NLT code [Name]: "
"RTN","LA7SMPXL",66,0)
 . . S LA7NLT=$P(LA76964(0),"^",2)
"RTN","LA7SMPXL",67,0)
 . . W $S($L(LA7NLT):LA7NLT,1:"*** None specified ***")
"RTN","LA7SMPXL",68,0)
 . . S LA7NLTN=$P(LA76964(0),"^")
"RTN","LA7SMPXL",69,0)
 . . I LA7NLTN'="" W:($X+$L($P(LA76964(0),"^",2))+3)>IOM !,?39 W " [",LA7NLTN,"]"
"RTN","LA7SMPXL",70,0)
 . . I $P(LA76964(0),"^",9)'="" W !,?20,"Host site UID: ",$P(LA76964(0),"^",9)
"RTN","LA7SMPXL",71,0)
 ;
"RTN","LA7SMPXL",72,0)
 D END
"RTN","LA7SMPXL",73,0)
 Q
"RTN","LA7SMPXL",74,0)
 ;
"RTN","LA7SMPXL",75,0)
 ;
"RTN","LA7SMPXL",76,0)
SETUP ; Setup variables for this order
"RTN","LA7SMPXL",77,0)
 ;
"RTN","LA7SMPXL",78,0)
 N I,X
"RTN","LA7SMPXL",79,0)
 ;
"RTN","LA7SMPXL",80,0)
 F I=0,1 S LA7696(I)=$G(^LRO(69.6,LA7696,I))
"RTN","LA7SMPXL",81,0)
 ;
"RTN","LA7SMPXL",82,0)
 S PNM=$P(LA7696(0),U),SEX=$P(LA7696(0),U,2),DOB=$P(LA7696(0),U,3)
"RTN","LA7SMPXL",83,0)
 S (SSN,SSN(2))=$P(LA7696(0),U,9)
"RTN","LA7SMPXL",84,0)
 ;
"RTN","LA7SMPXL",85,0)
 S LA7ACC=$P(LA7696(0),"^",12)
"RTN","LA7SMPXL",86,0)
 S LA7UID=$P(LA7696(0),"^",6)
"RTN","LA7SMPXL",87,0)
 S LA7SPEC=+$P(LA7696(0),"^",7),LA7SPEC(0)=$G(^LAB(61,LA7SPEC,0))
"RTN","LA7SMPXL",88,0)
 S LA7CDT=$P(LA7696(1),U,2)
"RTN","LA7SMPXL",89,0)
 S LA7SDT=$P(LA7696(1),U,5)
"RTN","LA7SMPXL",90,0)
 ;
"RTN","LA7SMPXL",91,0)
 ; Get collecting site and host site info
"RTN","LA7SMPXL",92,0)
 D GETSITE^LA7SMP($P(LA7696(0),U,5),DUZ(2),.LA7FSITE,.LA7TSITE)
"RTN","LA7SMPXL",93,0)
 ;
"RTN","LA7SMPXL",94,0)
 ; Ordering provider
"RTN","LA7SMPXL",95,0)
 S I=0,LA7PROV=""
"RTN","LA7SMPXL",96,0)
 F  S I=$O(^LRO(69.6,LA7696,2,I)) Q:'I  D  Q:LA7PROV'=""
"RTN","LA7SMPXL",97,0)
 . S X=$P($G(^LRO(69.6,LA7696,2,I,1)),"^")
"RTN","LA7SMPXL",98,0)
 . I X'="" S $P(LA7PROV,"^",2)=$P(X,"[")
"RTN","LA7SMPXL",99,0)
 I LA7PROV="" S LA7PROV="^REF:"_LA7FSITE(99)
"RTN","LA7SMPXL",100,0)
 ;
"RTN","LA7SMPXL",101,0)
 ; Get shipping date
"RTN","LA7SMPXL",102,0)
 S LA7SDT=$$FMTE^XLFDT($P(LA7696(1),"^",3),"")
"RTN","LA7SMPXL",103,0)
 ;
"RTN","LA7SMPXL",104,0)
 ; Check for comments
"RTN","LA7SMPXL",105,0)
 K LA7CMT
"RTN","LA7SMPXL",106,0)
 I $D(^LRO(69.6,LA7696,99,0)) D
"RTN","LA7SMPXL",107,0)
 . N DIWF,DIWL,DIWR,LA7ERR,X
"RTN","LA7SMPXL",108,0)
 . S LA7CMT=$$GET1^DIQ(69.6,LA7696_",",99,"","LA7CMT","LA7ERR(2)")
"RTN","LA7SMPXL",109,0)
 . K ^UTILITY($J,"W")
"RTN","LA7SMPXL",110,0)
 . S DIWL=1,DIWR=IOM-13,DIWF=""
"RTN","LA7SMPXL",111,0)
 . I $$GET1^DID(+$$GET1^DID(69.6,99,"","SPECIFIER","LA7ERR(1)"),.01,"","SPECIFIER","LA7ERR(3)")["L" S DIWF="N"
"RTN","LA7SMPXL",112,0)
 . S LA7I=$O(LA7CMT(0)),LA7CMT(LA7I)="COMMENTS: "_LA7CMT(LA7I),LA7I=0
"RTN","LA7SMPXL",113,0)
 . F  S LA7I=$O(LA7CMT(LA7I)) Q:'LA7I  S X=LA7CMT(LA7I) D ^DIWP
"RTN","LA7SMPXL",114,0)
 . K LA7CMT
"RTN","LA7SMPXL",115,0)
 . M LA7CMT=^UTILITY($J,"W",DIWL)
"RTN","LA7SMPXL",116,0)
 . K ^UTILITY($J,"W")
"RTN","LA7SMPXL",117,0)
 ;
"RTN","LA7SMPXL",118,0)
 ; Add local (host) status info
"RTN","LA7SMPXL",119,0)
 S LA7CMT=$G(LA7CMT)+1
"RTN","LA7SMPXL",120,0)
 I LA7CMT>1 S LA7CMT(LA7CMT,0)=" ",LA7CMT=LA7CMT+1
"RTN","LA7SMPXL",121,0)
 S LA7CMT(LA7CMT,0)="Host test status: "_$$GET1^DIQ(69.6,LA7696_",",6,"",,"LA7ERR(4)")
"RTN","LA7SMPXL",122,0)
 Q
"RTN","LA7SMPXL",123,0)
 ;
"RTN","LA7SMPXL",124,0)
 ;
"RTN","LA7SMPXL",125,0)
END ;
"RTN","LA7SMPXL",126,0)
 S LA7EXIT=1
"RTN","LA7SMPXL",127,0)
 D END^LA7SMP0
"RTN","LA7SMPXL",128,0)
 K LA7696,LA76964,LA7CMT,LA7SMAN
"RTN","LA7SMPXL",129,0)
 ;
"RTN","LA7SMPXL",130,0)
 Q
"RTN","LA7SMU")
0^35^B43475390
"RTN","LA7SMU",1,0)
LA7SMU ;DALOI/JMC - Shipping Manifest Utility ;5/5/97 14:44;
"RTN","LA7SMU",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,46,64**;Sep 27, 1994
"RTN","LA7SMU",3,0)
 Q
"RTN","LA7SMU",4,0)
 ;
"RTN","LA7SMU",5,0)
CHKSM(X) ; Shipping manifest status check
"RTN","LA7SMU",6,0)
 ; Call with X = ien of file #62.9 LAB SHIPPING CONFIGURATION
"RTN","LA7SMU",7,0)
 ; Returns -1 = error^reason
"RTN","LA7SMU",8,0)
 ;          0 = no active shipping manifest exists
"RTN","LA7SMU",9,0)
 ;         >0 = ien of active shipping manifest in file #62.8, LAB SHIPPING MANIFEST
"RTN","LA7SMU",10,0)
 ;
"RTN","LA7SMU",11,0)
 ; No value passed
"RTN","LA7SMU",12,0)
 I '$G(X) Q "-1^No configuration passed"
"RTN","LA7SMU",13,0)
 ; Bad pointer passed
"RTN","LA7SMU",14,0)
 I '$D(^LAHM(62.9,X,0)) Q "-1^Bad configuration pointer"
"RTN","LA7SMU",15,0)
 ; Get ien of active shipping manifest.
"RTN","LA7SMU",16,0)
 S Y=+$O(^LAHM(62.8,"AC1",X,0))
"RTN","LA7SMU",17,0)
 I Y S Y=Y_"^"_$P(^LAHM(62.8,Y,0),"^")
"RTN","LA7SMU",18,0)
 Q Y
"RTN","LA7SMU",19,0)
 ;
"RTN","LA7SMU",20,0)
 ;
"RTN","LA7SMU",21,0)
CSM(LA7SCFG) ; Creates a new shipping manifest
"RTN","LA7SMU",22,0)
 ; Call with X = ien of file #62.9 LAB SHIPPING CONFIGURATION
"RTN","LA7SMU",23,0)
 ; Returns -1 = error^reason
"RTN","LA7SMU",24,0)
 ;          0 = no active shipping manifest exists
"RTN","LA7SMU",25,0)
 ;         >0 = ien of active shipping manifest in file #62.8, LAB SHIPPING MANIFEST
"RTN","LA7SMU",26,0)
 ;
"RTN","LA7SMU",27,0)
 N DATA,FDA,I,LA7CF,LA7DIE,LA7DT,LA7IEN,LA7SM,X,X4
"RTN","LA7SMU",28,0)
 ;
"RTN","LA7SMU",29,0)
 ; No value passed
"RTN","LA7SMU",30,0)
 I '$G(LA7SCFG) Q "-1^No configuration passed"
"RTN","LA7SMU",31,0)
 ;
"RTN","LA7SMU",32,0)
 ; Bad pointer passed
"RTN","LA7SMU",33,0)
 I '$D(^LAHM(62.9,LA7SCFG,0)) Q "-1^Bad configuration pointer"
"RTN","LA7SMU",34,0)
 ;
"RTN","LA7SMU",35,0)
 S LA7SCFG(0)=$G(^LAHM(62.9,LA7SCFG,0))
"RTN","LA7SMU",36,0)
 ; ien of collecting facility
"RTN","LA7SMU",37,0)
 S LA7CF=$P(LA7SCFG(0),"^",2)
"RTN","LA7SMU",38,0)
 ; file #4 INSTITUTION information
"RTN","LA7SMU",39,0)
 F I=.01,.05,99 S X4(I)=$$GET1^DIQ(4,LA7CF_",",I)
"RTN","LA7SMU",40,0)
 ;
"RTN","LA7SMU",41,0)
 ; Get station number else use short name
"RTN","LA7SMU",42,0)
 S LA7SM=""
"RTN","LA7SMU",43,0)
 I $L(X4(99)) S LA7SM=X4(99)
"RTN","LA7SMU",44,0)
 E  S LA7SM=X4(.05)
"RTN","LA7SMU",45,0)
 ; Failsafe value
"RTN","LA7SMU",46,0)
 I LA7SM="" S LA7SM="INST:"_LA7CF
"RTN","LA7SMU",47,0)
 S DT=$$DT^XLFDT,LA7DT=$E($$FMTHL7^XLFDT(DT),1,8)
"RTN","LA7SMU",48,0)
 S LA7SM=LA7SM_"-"_LA7DT_"-"
"RTN","LA7SMU",49,0)
 ;
"RTN","LA7SMU",50,0)
 L +^LAHM(62.8,0):5 ; Set lock
"RTN","LA7SMU",51,0)
 I '$T Q "-1^Unable to obtain lock on file LAB SHIPPING MANIFEST #62.8"
"RTN","LA7SMU",52,0)
 S X=0
"RTN","LA7SMU",53,0)
 F  S X=X+1 Q:'$D(^LAHM(62.8,"B",LA7SM_X))
"RTN","LA7SMU",54,0)
 S LA7SM=LA7SM_X
"RTN","LA7SMU",55,0)
 ;
"RTN","LA7SMU",56,0)
 S FDA(1,62.8,"+1,",.01)=LA7SM
"RTN","LA7SMU",57,0)
 S FDA(1,62.8,"+1,",.02)=LA7SCFG
"RTN","LA7SMU",58,0)
 S FDA(1,62.8,"+1,",.03)=1
"RTN","LA7SMU",59,0)
 I $P(LA7SCFG(0),"^",8) S FDA(1,62.8,"+1,",.04)=$P(LA7SCFG(0),"^",8)
"RTN","LA7SMU",60,0)
 S FDA(1,62.8,"+1,",.05)=+$P(LA7SCFG(0),"^",15)
"RTN","LA7SMU",61,0)
 S FDA(1,62.8,"+1,",.06)=+$P(LA7SCFG(0),"^",16)
"RTN","LA7SMU",62,0)
 D UPDATE^DIE("","FDA(1)","LA7IEN","LA7DIE(1)")
"RTN","LA7SMU",63,0)
 D RECALL^DILFD(62.8,LA7IEN(1)_",",DUZ)
"RTN","LA7SMU",64,0)
 ;
"RTN","LA7SMU",65,0)
 S DATA="SM01^"_$$NOW^XLFDT
"RTN","LA7SMU",66,0)
 D SEUP(LA7SM,1,DATA)
"RTN","LA7SMU",67,0)
 ;
"RTN","LA7SMU",68,0)
 S DATA="SM02^"_$$NOW^XLFDT
"RTN","LA7SMU",69,0)
 D SEUP(LA7SM,1,DATA)
"RTN","LA7SMU",70,0)
 ;
"RTN","LA7SMU",71,0)
 ; Release lock
"RTN","LA7SMU",72,0)
 L -^LAHM(62.8,0)
"RTN","LA7SMU",73,0)
 Q LA7IEN(1)_"^"_LA7SM
"RTN","LA7SMU",74,0)
 ;
"RTN","LA7SMU",75,0)
 ;
"RTN","LA7SMU",76,0)
SMSUP(LA7SM,LA7ST,LA7EVNC) ; Shipping manifest status update.
"RTN","LA7SMU",77,0)
 ; Call with LA7SM = ien of entry in file #62.8 LAB SHIPPING MAINFEST^.01 field
"RTN","LA7SMU",78,0)
 ;           LA7ST = status to update
"RTN","LA7SMU",79,0)
 ;         LA7EVNC = event code^event date/time (default=NOW)
"RTN","LA7SMU",80,0)
 ;
"RTN","LA7SMU",81,0)
 N DATA,FDA,LA7IEN
"RTN","LA7SMU",82,0)
 ;
"RTN","LA7SMU",83,0)
 S LA7IEN(1)=+LA7SM
"RTN","LA7SMU",84,0)
 S FDA(2,62.8,+LA7SM_",",.03)=LA7ST
"RTN","LA7SMU",85,0)
 D UPDATE^DIE("","FDA(2)","LA7IEN","LA7DIE(2)")
"RTN","LA7SMU",86,0)
 S DATA=$P(LA7EVNC,"^")_"^"_$S($P(LA7EVNC,"^",2):$P(LA7EVNC,"^",2),1:$$NOW^XLFDT)
"RTN","LA7SMU",87,0)
 D SEUP($P(LA7SM,"^",2),1,DATA)
"RTN","LA7SMU",88,0)
 Q
"RTN","LA7SMU",89,0)
 ;
"RTN","LA7SMU",90,0)
 ;
"RTN","LA7SMU",91,0)
STSUP(LA7SM,LA762801,LA7DATA) ; Shipping test status update
"RTN","LA7SMU",92,0)
 ; Call with    LA7SM = ien of shipping manifest (#62.8)
"RTN","LA7SMU",93,0)
 ;           LA762801 = ien of test entry on shipping manifest
"RTN","LA7SMU",94,0)
 ;            LA7DATA = data to be filed
"RTN","LA7SMU",95,0)
 N FDA
"RTN","LA7SMU",96,0)
 S LA762801=LA762801_","_+LA7SM_","
"RTN","LA7SMU",97,0)
 S FDA(62.8,62.801,LA762801,.08)=LA7DATA
"RTN","LA7SMU",98,0)
 D FILE^DIE("","FDA(62.8)","LA7DIE(2)")
"RTN","LA7SMU",99,0)
 Q
"RTN","LA7SMU",100,0)
 ;
"RTN","LA7SMU",101,0)
 ;
"RTN","LA7SMU",102,0)
SEUP(LA7ID,LA7EVN,LA7DATA) ; Shipping event update
"RTN","LA7SMU",103,0)
 ; Call with LA7ID = shipping identifier (manifest invoice # or UID)
"RTN","LA7SMU",104,0)
 ;           LA7EVN = event type (1=shipping manifest/2=test)
"RTN","LA7SMU",105,0)
 ;           LA7DATA = data to be filed
"RTN","LA7SMU",106,0)
 N FDA,I,LA7IEN,X
"RTN","LA7SMU",107,0)
 L +^LAHM(62.85,0) ; Set lock
"RTN","LA7SMU",108,0)
 S FDA(3,62.85,"+1,",.01)=LA7ID
"RTN","LA7SMU",109,0)
 S FDA(3,62.85,"+1,",.02)=$S($G(DUZ)>0:DUZ,1:.5)
"RTN","LA7SMU",110,0)
 S FDA(3,62.85,"+1,",.03)=$$NOW^XLFDT
"RTN","LA7SMU",111,0)
 S FDA(3,62.85,"+1,",.04)=LA7EVN
"RTN","LA7SMU",112,0)
 I $L($P(LA7DATA,"^")) D
"RTN","LA7SMU",113,0)
 . S X=$$EVNC($P(LA7DATA,"^"))
"RTN","LA7SMU",114,0)
 . I X S FDA(3,62.85,"+1,",.05)=+X
"RTN","LA7SMU",115,0)
 F I=2:1:4 I $L($P(LA7DATA,"^",I)) S FDA(3,62.85,"+1,",$P("^.07^.08^.09","^",I))=$P(LA7DATA,"^",I)
"RTN","LA7SMU",116,0)
 ;
"RTN","LA7SMU",117,0)
 ; Add event to lab shipping event.
"RTN","LA7SMU",118,0)
 D UPDATE^DIE("","FDA(3)","LA7IEN","LA7DIE(3)")
"RTN","LA7SMU",119,0)
 ; Release lock
"RTN","LA7SMU",120,0)
 L -^LAHM(62.85,0)
"RTN","LA7SMU",121,0)
 ;
"RTN","LA7SMU",122,0)
 Q
"RTN","LA7SMU",123,0)
 ;
"RTN","LA7SMU",124,0)
 ;
"RTN","LA7SMU",125,0)
ACCSUP(LA7UID,LA760,LA7DATA) ; Accession status update
"RTN","LA7SMU",126,0)
 ; Call with LA7UID = UID of accession to update
"RTN","LA7SMU",127,0)
 ;          LA7DATA = value to update (pointer to file #62.8, LAB SHIPPING MANIFEST or "@" to delete
"RTN","LA7SMU",128,0)
 ;
"RTN","LA7SMU",129,0)
 N FDA,LA7AA,LA7AD,LA7AN,LA7CAD,LA768,X
"RTN","LA7SMU",130,0)
 S X=$Q(^LRO(68,"C",LA7UID))
"RTN","LA7SMU",131,0)
 S LA7AA=$QS(X,4),LA7AD=$QS(X,5),LA7AN=$QS(X,6)
"RTN","LA7SMU",132,0)
 S LA7CAD=$$AD^LA7SUTL(LA7AA) ; Get current accession date for this accession area.
"RTN","LA7SMU",133,0)
 S LA7AD=LA7AD-.000000001
"RTN","LA7SMU",134,0)
 F  S LA7AD=$O(^LRO(68,LA7AA,1,LA7AD)) Q:'LA7AD!(LA7AD>LA7CAD)  D
"RTN","LA7SMU",135,0)
 . I '$D(^LRO(68,LA7AA,1,LA7AD,1,LA7AN)) Q
"RTN","LA7SMU",136,0)
 . I $P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,.3)),"^")'=LA7UID Q
"RTN","LA7SMU",137,0)
 . I '$D(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,LA760)) Q  ; Test not on accession.
"RTN","LA7SMU",138,0)
 . S LA768=LA760_","_LA7AN_","_LA7AD_","_LA7AA_","
"RTN","LA7SMU",139,0)
 . S FDA(68,68.04,LA768,9)=LA7DATA
"RTN","LA7SMU",140,0)
 . D FILE^DIE("","FDA(68)","LA7DIE(68)")
"RTN","LA7SMU",141,0)
 Q
"RTN","LA7SMU",142,0)
 ;
"RTN","LA7SMU",143,0)
 ;
"RTN","LA7SMU",144,0)
SELSM(LA7SCFG,LA7SCR) ; Select shipping manifest
"RTN","LA7SMU",145,0)
 ; Call with LA7SCFG = ien of file #62.9 LAB SHIPPING CONFIGURATION
"RTN","LA7SMU",146,0)
 ;            LA7SCR = comma delimited list of status screen - only allow selection of manifests with matching status
"RTN","LA7SMU",147,0)
 ;      Returns LA7Y = pointer to shipping manifest or error
"RTN","LA7SMU",148,0)
 N D,DIC,DTOUT,DUOUT,LA7Y,X,Y
"RTN","LA7SMU",149,0)
 S DIC="^LAHM(62.8,",DIC(0)="AEQ",DIC("A")="Select Shipping Manifest: "
"RTN","LA7SMU",150,0)
 S DIC("S")="I $P(^LAHM(62.8,Y,0),U,2)=LA7SCFG"
"RTN","LA7SMU",151,0)
 S DIC("W")="D SMW^LA7SMU1(Y)"
"RTN","LA7SMU",152,0)
 I $G(LA7SCR)'="" S DIC("S")=DIC("S")_","""_LA7SCR_"""[$P(^LAHM(62.8,Y,0),U,3)"
"RTN","LA7SMU",153,0)
 S D="C"
"RTN","LA7SMU",154,0)
 D MIX^DIC1
"RTN","LA7SMU",155,0)
 I Y<1 S LA7Y="-1^"
"RTN","LA7SMU",156,0)
 E  S LA7Y=Y
"RTN","LA7SMU",157,0)
 Q LA7Y
"RTN","LA7SMU",158,0)
 ;
"RTN","LA7SMU",159,0)
 ;
"RTN","LA7SMU",160,0)
SMED(LA7SM,LA7EVC) ; Determine shipping manifest's event date
"RTN","LA7SMU",161,0)
 ; Call with LA7SM = ien of entry in file #62.8 LAB SHIPPING MANIFEST
"RTN","LA7SMU",162,0)
 ;          LA7EVC = event type code
"RTN","LA7SMU",163,0)
 ;   Returns LA7Y = internal event date^external event date
"RTN","LA7SMU",164,0)
 N LA7I,LA7X,LA7Y
"RTN","LA7SMU",165,0)
 I '$G(LA7SM) Q "-1^No shipping manifest passed"
"RTN","LA7SMU",166,0)
 S LA7SM(0)=$G(^LAHM(62.8,+LA7SM,0))
"RTN","LA7SMU",167,0)
 S LA7EV=+$$EVNC(LA7EVC)
"RTN","LA7SMU",168,0)
 I LA7EVC="SM05",$P(LA7SM(0),"^",3)'>2 Q "0^Shipping manifest has not been shipped"
"RTN","LA7SMU",169,0)
 S LA7I=0,LA7Y=""
"RTN","LA7SMU",170,0)
 F  S LA7I=$O(^LAHM(62.85,"B",$P(LA7SM(0),"^"),LA7I)) Q:'LA7I  D  Q:$L(LA7Y)
"RTN","LA7SMU",171,0)
 . I $P($G(^LAHM(62.85,LA7I,0)),"^",5)'=LA7EV Q
"RTN","LA7SMU",172,0)
 . S LA7Y=$P(^LAHM(62.85,LA7I,0),"^",7)_"^"_$$FMTE^XLFDT($P(^LAHM(62.85,LA7I,0),"^",7),"M") ; Event date/time
"RTN","LA7SMU",173,0)
 I $G(LA7Y)="" S LA7Y="-2^No event date found"
"RTN","LA7SMU",174,0)
 Q LA7Y
"RTN","LA7SMU",175,0)
 ;
"RTN","LA7SMU",176,0)
 ;
"RTN","LA7SMU",177,0)
EVNC(LA7EVC) ; Resolve an event code to it's pointer/text(.01) value
"RTN","LA7SMU",178,0)
 ; Call with LA7EVC = Code to lookup, i.e. SM01, SM50
"RTN","LA7SMU",179,0)
 ;        Returns Y = ien of code in file #64.061, LAB ELECTRONIC CODES.
"RTN","LA7SMU",180,0)
 N X,Y
"RTN","LA7SMU",181,0)
 S (X,Y)=0
"RTN","LA7SMU",182,0)
 F  S X=$O(^LAB(64.061,"F",LA7EVC,X)) Q:'X  D  Q:Y
"RTN","LA7SMU",183,0)
 . S X(0)=$G(^LAB(64.061,X,0))
"RTN","LA7SMU",184,0)
 . I $P(X(0),"^",7)="E" S Y=X_"^"_$P(X(0),"^")
"RTN","LA7SMU",185,0)
 I 'Y S Y="0^Code not on file"
"RTN","LA7SMU",186,0)
 Q Y
"RTN","LA7SMU",187,0)
 ;
"RTN","LA7SMU",188,0)
 ;
"RTN","LA7SMU",189,0)
CHKTST(LA7SM,LA762801) ; Check and update if test is still valid.
"RTN","LA7SMU",190,0)
 ; Call with LA7SM = ien of shipping manifest in file #62.8
"RTN","LA7SMU",191,0)
 ;        LA762801 = ien of entry on test multiple in file #62.8
"RTN","LA7SMU",192,0)
 ;
"RTN","LA7SMU",193,0)
 ; Returns LA7SKIP = 0 (Test still on accession).
"RTN","LA7SMU",194,0)
 ;                   1 (Test not on accession).
"RTN","LA7SMU",195,0)
 ;                   2 (Accession deleted/purged).
"RTN","LA7SMU",196,0)
 ;                   3 (Test not on accession - already shipped)
"RTN","LA7SMU",197,0)
 ;                   4 (Accession deleted/purged - already shipped)
"RTN","LA7SMU",198,0)
 ;
"RTN","LA7SMU",199,0)
 N LA7AA,LA7AD,LA7AN,LA7DATA,LA7SKIP,LA7UID,X,Y
"RTN","LA7SMU",200,0)
 S LA7SKIP=0
"RTN","LA7SMU",201,0)
 S LA7SM(0)=$G(^LAHM(62.8,+LA7SM,0))
"RTN","LA7SMU",202,0)
 S LA762801(0)=$G(^LAHM(62.8,+LA7SM,10,+LA762801,0))
"RTN","LA7SMU",203,0)
 S LA7UID=$P(LA762801(0),"^",5)
"RTN","LA7SMU",204,0)
 S X=$Q(^LRO(68,"C",LA7UID))
"RTN","LA7SMU",205,0)
 S LA7AA=+$QS(X,4),LA7AD=+$QS(X,5),LA7AN=+$QS(X,6)
"RTN","LA7SMU",206,0)
 ;
"RTN","LA7SMU",207,0)
 ; Test found.
"RTN","LA7SMU",208,0)
 I $D(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,+$P(LA762801(0),"^",2),0)) Q LA7SKIP
"RTN","LA7SMU",209,0)
 ; Accession missing.
"RTN","LA7SMU",210,0)
 I '$D(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,0)) D
"RTN","LA7SMU",211,0)
 . ; Already shipped
"RTN","LA7SMU",212,0)
 . I $P(LA7SM(0),"^",3)>4 S LA7SKIP=4 Q
"RTN","LA7SMU",213,0)
 . S LA7SKIP=2,LA7DATA="SM62"
"RTN","LA7SMU",214,0)
 ;
"RTN","LA7SMU",215,0)
 ; Test missing.
"RTN","LA7SMU",216,0)
 I 'LA7SKIP,'$D(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,+$P(LA762801(0),"^",2),0)) D
"RTN","LA7SMU",217,0)
 . ; Already shipped
"RTN","LA7SMU",218,0)
 . I $P(LA7SM(0),"^",3)>4 S LA7SKIP=3 Q
"RTN","LA7SMU",219,0)
 . S LA7SKIP=1,LA7DATA="SM61"
"RTN","LA7SMU",220,0)
 ;
"RTN","LA7SMU",221,0)
 ; Update manifest/event file if test has not shipped.
"RTN","LA7SMU",222,0)
 I LA7SKIP,LA7SKIP<3 D
"RTN","LA7SMU",223,0)
 . ; Update test on manifest
"RTN","LA7SMU",224,0)
 . D STSUP^LA7SMU(+LA7SM,LA762801,0)
"RTN","LA7SMU",225,0)
 . ; Update event file
"RTN","LA7SMU",226,0)
 . S LA7DATA=LA7DATA_"^"_$$NOW^XLFDT_"^"_$P(LA762801(0),"^",2)_"^"_$P(LA7SM(0),"^")
"RTN","LA7SMU",227,0)
 . D SEUP^LA7SMU(LA7UID,2,LA7DATA)
"RTN","LA7SMU",228,0)
 Q LA7SKIP
"RTN","LA7SMU1")
0^41^B18357820
"RTN","LA7SMU1",1,0)
LA7SMU1 ;DALOI/JMC - Shipping Manifest Utility (Cont'd);5/5/97 14:44
"RTN","LA7SMU1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,46,65,64**;Sep 27, 1994
"RTN","LA7SMU1",3,0)
 ;
"RTN","LA7SMU1",4,0)
 Q
"RTN","LA7SMU1",5,0)
 ;
"RTN","LA7SMU1",6,0)
SMW(LA7SM) ; "Write" additional information on DIC lookup of #62.48.
"RTN","LA7SMU1",7,0)
 ; Called by DIC("W")
"RTN","LA7SMU1",8,0)
 ; Call with LA7SM = ien of entry in file #62.8
"RTN","LA7SMU1",9,0)
 ;
"RTN","LA7SMU1",10,0)
 N LA7X,LA7Y,LA7EVC
"RTN","LA7SMU1",11,0)
 ;
"RTN","LA7SMU1",12,0)
 S LA7SM(0)=$G(^LAHM(62.8,LA7SM,0))
"RTN","LA7SMU1",13,0)
 ; Shipping configuration
"RTN","LA7SMU1",14,0)
 S LA7X=" "_$P($G(^LAHM(62.9,$P(LA7SM(0),"^",2),0)),"^")
"RTN","LA7SMU1",15,0)
 S LA7X=LA7X_" Status: "_$$EXTERNAL^DILFD(62.8,.03,"",$P(LA7SM(0),"^",3))
"RTN","LA7SMU1",16,0)
 S LA7EVC="SM"_$S($P(LA7SM(0),"^",3)=0:"00",1:$P("02^03^04^05^07","^",+$P(LA7SM(0),"^",3)))
"RTN","LA7SMU1",17,0)
 S LA7Y=$$SMED^LA7SMU(LA7SM,LA7EVC)
"RTN","LA7SMU1",18,0)
 S LA7X=LA7X_" as of "_$P(LA7Y,"^",2)
"RTN","LA7SMU1",19,0)
 D EN^DDIOL(LA7X,"","?18")
"RTN","LA7SMU1",20,0)
 Q
"RTN","LA7SMU1",21,0)
 ;
"RTN","LA7SMU1",22,0)
 ;
"RTN","LA7SMU1",23,0)
ADATE ; Select accession dates if specified
"RTN","LA7SMU1",24,0)
 ;
"RTN","LA7SMU1",25,0)
 N DIR,DIRUT,DTOUT,LRAA,X,Y
"RTN","LA7SMU1",26,0)
 ;
"RTN","LA7SMU1",27,0)
 S DIR(0)="YO",DIR("A")="Use default accession dates",DIR("B")="YES"
"RTN","LA7SMU1",28,0)
 S DIR("?",1)="Enter ""YES"" to use the current accession date for each accession area utilized by this shipping configuration."
"RTN","LA7SMU1",29,0)
 S DIR("?",2)=" "
"RTN","LA7SMU1",30,0)
 S DIR("?")="If you select ""NO"" then you will be asked to specify a specific accession date and starting and ending accession numbers for each accession area."
"RTN","LA7SMU1",31,0)
 D ^DIR
"RTN","LA7SMU1",32,0)
 ; User aborted
"RTN","LA7SMU1",33,0)
 I $D(DIRUT) S LA7QUIT=1 Q
"RTN","LA7SMU1",34,0)
 ; Use default accession dates
"RTN","LA7SMU1",35,0)
 I Y=1 Q
"RTN","LA7SMU1",36,0)
 ;
"RTN","LA7SMU1",37,0)
 S X=0
"RTN","LA7SMU1",38,0)
 F  S X=$O(^LAHM(62.9,+LA7SCFG,60,X)) Q:'X  D
"RTN","LA7SMU1",39,0)
 . S X(0)=$G(^LAHM(62.9,+LA7SCFG,60,X,0))
"RTN","LA7SMU1",40,0)
 . I $P(X(0),"^",2),'$D(LA7AA($P(X(0),"^",2))) S LA7AA($P(X(0),"^",2))=""
"RTN","LA7SMU1",41,0)
 ;
"RTN","LA7SMU1",42,0)
 S LA7AA=0
"RTN","LA7SMU1",43,0)
 F  S LA7AA=$O(LA7AA(LA7AA)) Q:'LA7AA  D  Q:LA7QUIT
"RTN","LA7SMU1",44,0)
 . N %DT,DTOUT,LRAA,LRAD,LREND,LRFAN,LRLAN
"RTN","LA7SMU1",45,0)
 . D EN^DDIOL("For Accession Area: "_$P($G(^LRO(68,LA7AA,0)),"^"),"","!!?2")
"RTN","LA7SMU1",46,0)
 . S LRAA=LA7AA D ADATE^LRWU3
"RTN","LA7SMU1",47,0)
 . I Y<1!($G(DTOUT)) S LA7QUIT=1 Q
"RTN","LA7SMU1",48,0)
 . S LA7AA(LA7AA)=$G(LRAD)
"RTN","LA7SMU1",49,0)
 . D LRAN^LRWU3
"RTN","LA7SMU1",50,0)
 . I LREND S LA7QUIT=1 Q
"RTN","LA7SMU1",51,0)
 . S LA7AA(LA7AA)=$G(LRAD)_"^"_$G(LRFAN)_"^"_$G(LRLAN)
"RTN","LA7SMU1",52,0)
 Q
"RTN","LA7SMU1",53,0)
 ;
"RTN","LA7SMU1",54,0)
 ;
"RTN","LA7SMU1",55,0)
ASKPREV() ; Ask if build should exclude tests from building that have previously
"RTN","LA7SMU1",56,0)
 ; been removed from a manifest. Allows user to control if tests rebuild
"RTN","LA7SMU1",57,0)
 ; onto the same or different manifest.
"RTN","LA7SMU1",58,0)
 ;
"RTN","LA7SMU1",59,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LA7SMU1",60,0)
 ;
"RTN","LA7SMU1",61,0)
 S DIR(0)="YO"
"RTN","LA7SMU1",62,0)
 S DIR("A")="Exclude previously removed tests from building"
"RTN","LA7SMU1",63,0)
 S DIR("B")="YES"
"RTN","LA7SMU1",64,0)
 S DIR("?",1)="Answer 'YES' if you do NOT want tests previously removed"
"RTN","LA7SMU1",65,0)
 S DIR("?",2)="from a manifest to be added to this manifest."
"RTN","LA7SMU1",66,0)
 S DIR("?",3)=" "
"RTN","LA7SMU1",67,0)
 S DIR("?",4)="Answer 'NO' if you WANT tests to be added to this manifest"
"RTN","LA7SMU1",68,0)
 S DIR("?",5)="that were previously removed from a manifest and are"
"RTN","LA7SMU1",69,0)
 S DIR("?")="otherwise eligible to be added."
"RTN","LA7SMU1",70,0)
 D ^DIR
"RTN","LA7SMU1",71,0)
 Q $S($D(DIRUT):-1,1:+Y)
"RTN","LA7SMU1",72,0)
 ;
"RTN","LA7SMU1",73,0)
 ;
"RTN","LA7SMU1",74,0)
PREV(LA7UID,LA760) ; Determine if test previously removed from a manifest.
"RTN","LA7SMU1",75,0)
 ; Checks all manifests for accession/test combination.
"RTN","LA7SMU1",76,0)
 ; Call with LA7UID = accession's uid
"RTN","LA7SMU1",77,0)
 ;            LA760 = file #60 test ien 
"RTN","LA7SMU1",78,0)
 ;
"RTN","LA7SMU1",79,0)
 ; Returns 0 = not previously removed from a manifest
"RTN","LA7SMU1",80,0)
 ;         1 = previously removed from a manifest
"RTN","LA7SMU1",81,0)
 ;
"RTN","LA7SMU1",82,0)
 ; Called by LA7SMB
"RTN","LA7SMU1",83,0)
 ;
"RTN","LA7SMU1",84,0)
 N LA7628,LA762801,LA7FLAG,LA7ROOT,LA7X
"RTN","LA7SMU1",85,0)
 ;
"RTN","LA7SMU1",86,0)
 S LA7FLAG=0
"RTN","LA7SMU1",87,0)
 I '$L($G(LA7UID))!'(+$G(LA760)) Q LA7FLAG
"RTN","LA7SMU1",88,0)
 S LA7ROOT="^LAHM(62.8,""UID"",LA7UID)"
"RTN","LA7SMU1",89,0)
 F  S LA7ROOT=$Q(@LA7ROOT) Q:$QS(LA7ROOT,3)'=LA7UID  D  Q:LA7FLAG
"RTN","LA7SMU1",90,0)
 . ; Manifest and specimen ien
"RTN","LA7SMU1",91,0)
 . S LA7628=$QS(LA7ROOT,4),LA762801=$QS(LA7ROOT,5)
"RTN","LA7SMU1",92,0)
 . S LA7X=$G(^LAHM(62.8,LA7628,10,LA762801,0))
"RTN","LA7SMU1",93,0)
 . ; Found previous test removal
"RTN","LA7SMU1",94,0)
 . I $P(LA7X,"^",2)=LA760,$P(LA7X,"^",8)=0 S LA7FLAG=1
"RTN","LA7SMU1",95,0)
 Q LA7FLAG
"RTN","LA7SMU1",96,0)
 ;
"RTN","LA7SMU1",97,0)
 ;
"RTN","LA7SMU1",98,0)
DOT(LA7CODE,LA7NCS,LA7UID,LA7628) ; Determine ordered tests
"RTN","LA7SMU1",99,0)
 ; 
"RTN","LA7SMU1",100,0)
 ; Call with LA7CODE = Test code to look up
"RTN","LA7SMU1",101,0)
 ;            LA7NCS = name of coding system
"RTN","LA7SMU1",102,0)
 ;            LA7UID = accession's UID
"RTN","LA7SMU1",103,0)
 ;            LA7628 = ien of shipping manifest in #62.8
"RTN","LA7SMU1",104,0)
 ;
"RTN","LA7SMU1",105,0)
 ; Returns     LA760 = ien of test entry in file #60 if found
"RTN","LA7SMU1",106,0)
 ;
"RTN","LA7SMU1",107,0)
 ; Given a test code, accession and a shipping manifest finds the
"RTN","LA7SMU1",108,0)
 ; file #60 test which is associated with the test code on the manifest.
"RTN","LA7SMU1",109,0)
 ;
"RTN","LA7SMU1",110,0)
 ; Called from LA7VIN4 to determine ordered test and update shipping event.
"RTN","LA7SMU1",111,0)
 N LA760,LA764,LA7I,LA7X,LA7Y
"RTN","LA7SMU1",112,0)
 ;
"RTN","LA7SMU1",113,0)
 S (LA760,LA764)=0
"RTN","LA7SMU1",114,0)
 ; Quit if no code, UID or configuration passed.
"RTN","LA7SMU1",115,0)
 I $G(LA7CODE)=""!($G(LA7UID)="")!($G(LA7628)="") Q LA760
"RTN","LA7SMU1",116,0)
 ;
"RTN","LA7SMU1",117,0)
 ; Using NLT codes
"RTN","LA7SMU1",118,0)
 I $G(LA7NCS)="99VA64" S LA764=+$O(^LAM("E",LA7CODE,0))
"RTN","LA7SMU1",119,0)
 ;
"RTN","LA7SMU1",120,0)
 ; Try NLT in case other system is returning NLT codes but not saying so
"RTN","LA7SMU1",121,0)
 I 'LA764,$D(^LAM("E",LA7CODE)) S LA764=+$O(^LAM("E",LA7CODE,0))
"RTN","LA7SMU1",122,0)
 ;
"RTN","LA7SMU1",123,0)
 S LA7I=0
"RTN","LA7SMU1",124,0)
 F  S LA7I=$O(^LAHM(62.8,LA7628,10,"UID",LA7UID,LA7I)) Q:'LA7I  D  Q:LA760
"RTN","LA7SMU1",125,0)
 . S LA7X=$G(^LAHM(62.8,LA7628,10,LA7I,0))
"RTN","LA7SMU1",126,0)
 . S LA7Y=$P(LA7X,"^",2)
"RTN","LA7SMU1",127,0)
 . ; Found match on NLT code
"RTN","LA7SMU1",128,0)
 . I LA7Y,+$P(^LAB(60,LA7Y,64),"^")=LA764 S LA760=LA7Y Q
"RTN","LA7SMU1",129,0)
 . ; Found match on non-VA code
"RTN","LA7SMU1",130,0)
 . I LA7CODE=$P($G(^LAHM(62.8,LA7628,10,LA7I,5)),"^") S LA760=LA7Y
"RTN","LA7SMU1",131,0)
 ;
"RTN","LA7SMU1",132,0)
 Q LA760
"RTN","LA7SMU2")
0^4^B29210137
"RTN","LA7SMU2",1,0)
LA7SMU2 ;DALOI/JMC - Shipping Manifest Utility (Cont'd);5/5/97 14:44
"RTN","LA7SMU2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7SMU2",3,0)
 Q
"RTN","LA7SMU2",4,0)
 ;
"RTN","LA7SMU2",5,0)
DTTO(LA7SCFG,LA7VNLT,LA7HLSC,LA764NCS,LA761NCS,LA7HLPRI,LA7CSC) ; Determine test to order
"RTN","LA7SMU2",6,0)
 ; Call with LA7SCFG = ien of Shipping Configuration file #62.9
"RTN","LA7SMU2",7,0)
 ;           LA7VNLT = NLT code or non-VA test code
"RTN","LA7SMU2",8,0)
 ;           LA7HLSC = HL7 Specimen Code
"RTN","LA7SMU2",9,0)
 ;          LA764NCS = HL7 Name of Test Coding System
"RTN","LA7SMU2",10,0)
 ;          LA761NCS = HL7 Name of Specimen Coding System
"RTN","LA7SMU2",11,0)
 ;          LA7HLPRI = HL7 Priority Code
"RTN","LA7SMU2",12,0)
 ;            LA7CSC = collection sample code^name^coding system
"RTN","LA7SMU2",13,0)
 ;
"RTN","LA7SMU2",14,0)
 ; Returns      LA7X = 0^0^0^0^^^ (if unsuccessful)
"RTN","LA7SMU2",15,0)
 ;                     LABORATORY TEST (ien file #60)^TOPOGRAPHY (ien file #61)^COLLECTION SAMPLE (ien file #62)^URGENCY (ien file #62.05)^NLT TEST CODE^NLT TEST NAME
"RTN","LA7SMU2",16,0)
 ;
"RTN","LA7SMU2",17,0)
 N LA760,LA7V64,LA7X,X,Y,Z
"RTN","LA7SMU2",18,0)
 ;
"RTN","LA7SMU2",19,0)
 ; Make sure variables initialized.
"RTN","LA7SMU2",20,0)
 S LA7X="0^0^0^0^^^"
"RTN","LA7SMU2",21,0)
 I LA7VNLT="" Q LA7X
"RTN","LA7SMU2",22,0)
 S LA7SCFG=+$G(LA7SCFG)
"RTN","LA7SMU2",23,0)
 I LA7HLPRI="" S LA7HLPRI="R"
"RTN","LA7SMU2",24,0)
 I LA7HLSC="" S LA7HLSC="XXX"
"RTN","LA7SMU2",25,0)
 ; 
"RTN","LA7SMU2",26,0)
 ; If coding systems not defined then assume
"RTN","LA7SMU2",27,0)
 ; HL7 Table 0070 and VA NLT file
"RTN","LA7SMU2",28,0)
 I LA761NCS="0070" S LA761NCS="HL70070"
"RTN","LA7SMU2",29,0)
 I LA761NCS="" S LA761NCS="HL70070"
"RTN","LA7SMU2",30,0)
 I LA764NCS="" S LA764NCS="99VA64"
"RTN","LA7SMU2",31,0)
 I LA764NCS="L",$P(^LAHM(62.9,LA7SCFG,0),"^",15)=0 S LA764NCS="99VA64"
"RTN","LA7SMU2",32,0)
 ;
"RTN","LA7SMU2",33,0)
 ; Build index of tests if not previously done for this session.
"RTN","LA7SMU2",34,0)
 I '$D(^TMP("LA7TC",$J,LA7SCFG)) D BINDX
"RTN","LA7SMU2",35,0)
 ;
"RTN","LA7SMU2",36,0)
 ; Found test info with priority
"RTN","LA7SMU2",37,0)
 I LA7HLPRI]"" D
"RTN","LA7SMU2",38,0)
 . I $P(LA7CSC,"^")'="" D  Q:LA7X
"RTN","LA7SMU2",39,0)
 . . S X=$G(^TMP("LA7TC",$J,LA7SCFG,LA7VNLT,LA7HLSC,LA7HLPRI,$P(LA7CSC,"^")))
"RTN","LA7SMU2",40,0)
 . . I X S LA7X=X
"RTN","LA7SMU2",41,0)
 . S X=$G(^TMP("LA7TC",$J,LA7SCFG,LA7VNLT,LA7HLSC,LA7HLPRI))
"RTN","LA7SMU2",42,0)
 . I X S LA7X=X Q
"RTN","LA7SMU2",43,0)
 . S X=$G(^TMP("LA7TC",$J,LA7SCFG,LA7VNLT,"XXX",LA7HLPRI))
"RTN","LA7SMU2",44,0)
 . I X,"MISPCYEM"[$P(^LAB(60,+X,0),"^",4) S LA7X=X
"RTN","LA7SMU2",45,0)
 ;
"RTN","LA7SMU2",46,0)
 ; Found test info with no priority specified
"RTN","LA7SMU2",47,0)
 I 'LA7X D
"RTN","LA7SMU2",48,0)
 . I $P(LA7CSC,"^")'="" D  Q:LA7X
"RTN","LA7SMU2",49,0)
 . . S X=$G(^TMP("LA7TC",$J,LA7SCFG,LA7VNLT,LA7HLSC,0,$P(LA7CSC,"^")))
"RTN","LA7SMU2",50,0)
 . . I X S LA7X=X
"RTN","LA7SMU2",51,0)
 . S X=$G(^TMP("LA7TC",$J,LA7SCFG,LA7VNLT,LA7HLSC))
"RTN","LA7SMU2",52,0)
 . I X S LA7X=X Q
"RTN","LA7SMU2",53,0)
 . S X=$G(^TMP("LA7TC",$J,LA7SCFG,LA7VNLT,"XXX"))
"RTN","LA7SMU2",54,0)
 . I X,"MISPCYEM"[$P(^LAB(60,+X,0),"^",4) S LA7X=X
"RTN","LA7SMU2",55,0)
 ;
"RTN","LA7SMU2",56,0)
 ; Otherwise get values from files #60 LABORATORY TEST and #61, TOPOGRAPHY
"RTN","LA7SMU2",57,0)
 ; Lookup test using NLT code and get first lab test in "AC" for this
"RTN","LA7SMU2",58,0)
 ; NLT code that's type (I)nput or (B)oth.
"RTN","LA7SMU2",59,0)
 I 'LA7X,LA764NCS="99VA64" D
"RTN","LA7SMU2",60,0)
 . S LA7V64=$O(^LAM("E",LA7VNLT,0)),Y=0 Q:'LA7V64
"RTN","LA7SMU2",61,0)
 . F  S Y=$O(^LAB(60,"AC",LA7V64,Y)) Q:'Y  Q:"BI"[$P(^LAB(60,Y,0),"^",3)
"RTN","LA7SMU2",62,0)
 . I Y S $P(LA7X,"^")=Y
"RTN","LA7SMU2",63,0)
 ;
"RTN","LA7SMU2",64,0)
 ; Get default topography and collection sample for HL7 specimen type.
"RTN","LA7SMU2",65,0)
 ; Check file #60 collection samples first, then check first entry in file #61 for match
"RTN","LA7SMU2",66,0)
 ; If non-table 0070 then look for "XXX" in table 0070
"RTN","LA7SMU2",67,0)
 I $P(LA7X,"^"),'$P(LA7X,"^",2),LA761NCS="HL70070" D
"RTN","LA7SMU2",68,0)
 . S (X,Y)=0,LA760=$P(LA7X,"^")
"RTN","LA7SMU2",69,0)
 . F  S X=$O(^LAB(60,LA760,3,"B",X)) Q:'X  D  Q:Y
"RTN","LA7SMU2",70,0)
 . . S Z=$P(^LAB(62,X,0),"^",2)
"RTN","LA7SMU2",71,0)
 . . I Z,$D(^LAB(61,"HL7",LA7HLSC,Z)) S Y=Z_"^"_X
"RTN","LA7SMU2",72,0)
 . I Y S $P(LA7X,"^",2,3)=Y
"RTN","LA7SMU2",73,0)
 I '$P(LA7X,"^",2),LA761NCS="HL70070" D
"RTN","LA7SMU2",74,0)
 . S X=$O(^LAB(61,"HL7",LA7HLSC,0)) Q:'X
"RTN","LA7SMU2",75,0)
 . S $P(LA7X,"^",2)=X
"RTN","LA7SMU2",76,0)
 . I '$P(LA7X,"^",3) S $P(LA7X,"^",3)=$P(^LAB(61,X,0),"^",6)
"RTN","LA7SMU2",77,0)
 I $P(LA7X,"^"),'$P(LA7X,"^",2),LA761NCS'="HL70070","MISPCYEM"[$P(^LAB(60,$P(LA7X,"^"),0),"^",4) D
"RTN","LA7SMU2",78,0)
 . S X=$O(^LAB(61,"HL7","XXX",0))
"RTN","LA7SMU2",79,0)
 . I X S $P(LA7X,"^",2)=X
"RTN","LA7SMU2",80,0)
 ;
"RTN","LA7SMU2",81,0)
 ; No urgency mapping, get last using this HL7 code or site's default urgency from #69.9
"RTN","LA7SMU2",82,0)
 ; Find highest non-workload urgency using this priority code else use site's default
"RTN","LA7SMU2",83,0)
 I '$P(LA7X,"^",4) D
"RTN","LA7SMU2",84,0)
 . S X=$O(^LAB(62.05,"HL7",LA7HLPRI,50),-1)
"RTN","LA7SMU2",85,0)
 . I X S $P(LA7X,"^",4)=X
"RTN","LA7SMU2",86,0)
 . E  S $P(LA7X,"^",4)=+$P($G(^LAB(69.9,1,3)),"^",2)
"RTN","LA7SMU2",87,0)
 ;
"RTN","LA7SMU2",88,0)
 ; Check file #60 forced and highest urgency.
"RTN","LA7SMU2",89,0)
 I $P(LA7X,"^"),$P(LA7X,"^",4) D
"RTN","LA7SMU2",90,0)
 . S X=$G(^LAB(60,$P(LA7X,"^"),0))
"RTN","LA7SMU2",91,0)
 . I $P(X,"^",18) S $P(LA7X,"^",4)=$P(X,"^",18)
"RTN","LA7SMU2",92,0)
 . I $P(X,"^",16),$P(LA7X,"^",4)<$P(X,"^",16) S $P(LA7X,"^",4)=$P(X,"^",16)
"RTN","LA7SMU2",93,0)
 ;
"RTN","LA7SMU2",94,0)
 Q LA7X
"RTN","LA7SMU2",95,0)
 ;
"RTN","LA7SMU2",96,0)
 ;
"RTN","LA7SMU2",97,0)
BINDX ; Build index of tests for a shipping configuration.
"RTN","LA7SMU2",98,0)
 ; Called from above.
"RTN","LA7SMU2",99,0)
 ;
"RTN","LA7SMU2",100,0)
 I '$D(^LAHM(62.9,LA7SCFG,0)) Q
"RTN","LA7SMU2",101,0)
 N LA760,LA761,LA762,LA76205,LA764,LA7HL,LA7NLT,LA7NLTN,LA7TC,LA7X
"RTN","LA7SMU2",102,0)
 S LA7X=0
"RTN","LA7SMU2",103,0)
 F  S LA7X=$O(^LAHM(62.9,LA7SCFG,60,LA7X)) Q:'LA7X  D BLD
"RTN","LA7SMU2",104,0)
 Q
"RTN","LA7SMU2",105,0)
 ;
"RTN","LA7SMU2",106,0)
 ;
"RTN","LA7SMU2",107,0)
BLD ; Build TMP global for a test
"RTN","LA7SMU2",108,0)
 ; Called from above
"RTN","LA7SMU2",109,0)
 ;
"RTN","LA7SMU2",110,0)
 S LA7X(0)=$G(^LAHM(62.9,LA7SCFG,60,LA7X,0))
"RTN","LA7SMU2",111,0)
 S LA7X(5)=$G(^LAHM(62.9,LA7SCFG,60,LA7X,5))
"RTN","LA7SMU2",112,0)
 ;
"RTN","LA7SMU2",113,0)
 ; Laboratory test/collection sample.
"RTN","LA7SMU2",114,0)
 S LA760=$P(LA7X(0),"^"),LA762=$P(LA7X(0),"^",9)
"RTN","LA7SMU2",115,0)
 ; Incomplete entry.
"RTN","LA7SMU2",116,0)
 I 'LA760!('LA762) Q
"RTN","LA7SMU2",117,0)
 ;
"RTN","LA7SMU2",118,0)
 ; Test urgency/HL7 priority code.
"RTN","LA7SMU2",119,0)
 S LA76205=$P(LA7X(0),"^",4),LA76205("HL")=""
"RTN","LA7SMU2",120,0)
 I LA76205 S LA76205("HL")=$$GET1^DIQ(62.05,LA76205_",","LEDI HL7:HL7 ABBR")
"RTN","LA7SMU2",121,0)
 ;
"RTN","LA7SMU2",122,0)
 ; Topography
"RTN","LA7SMU2",123,0)
 S LA761=$$GET1^DIQ(62,LA762_",",2,"I")
"RTN","LA7SMU2",124,0)
 I 'LA761,"BBCH"[$P(^LAB(60,LA760,0),"^",4) Q  ; Incomplete entry.
"RTN","LA7SMU2",125,0)
 ; Handle MI with no topography associated with collection sample.
"RTN","LA7SMU2",126,0)
 I 'LA761,$P(^LAB(60,LA760,0),"^",4)="MI"  S LA761=+$P(LA7X(0),"^",3)
"RTN","LA7SMU2",127,0)
 ;
"RTN","LA7SMU2",128,0)
 ; Use HL7 specimen code if using table 0070 else use mapping in 62.9
"RTN","LA7SMU2",129,0)
 S LA7HL=""
"RTN","LA7SMU2",130,0)
 I LA761NCS="HL70070" S LA7HL=$$GET1^DIQ(61,LA761_",","LEDI HL7:HL7 ABBR")
"RTN","LA7SMU2",131,0)
 I LA7HL="" S LA7HL=$P(LA7X(5),"^",3)
"RTN","LA7SMU2",132,0)
 ;
"RTN","LA7SMU2",133,0)
 ; File #64 ien/NLT code/NLT code test name.
"RTN","LA7SMU2",134,0)
 ; Use NLT code if using VA coding else use non-VA test order code.
"RTN","LA7SMU2",135,0)
 S LA764=+$$GET1^DIQ(60,LA760_",",64,"I")
"RTN","LA7SMU2",136,0)
 S LA7NLT=$$GET1^DIQ(64,LA764_",",1)
"RTN","LA7SMU2",137,0)
 S LA7NLTN=$$GET1^DIQ(64,LA764_",",.01)
"RTN","LA7SMU2",138,0)
 I LA764NCS="99VA64" S LA7TC=LA7NLT
"RTN","LA7SMU2",139,0)
 E  S LA7TC=$P(LA7X(5),"^")
"RTN","LA7SMU2",140,0)
 ;
"RTN","LA7SMU2",141,0)
 ; Set TMP global with information
"RTN","LA7SMU2",142,0)
 I LA7HL'="",LA7TC'="" D
"RTN","LA7SMU2",143,0)
 . I "MISPCYEM"[$P(^LAB(60,LA760,0),"^",4),$P(LA7X(5),"^",7)'="" D
"RTN","LA7SMU2",144,0)
 . . S ^TMP("LA7TC",$J,LA7SCFG,LA7TC,LA7HL,0,$P(LA7X(5),"^",7))=LA760_"^"_LA761_"^"_LA762_"^^"_LA7NLT_"^"_LA7NLTN
"RTN","LA7SMU2",145,0)
 . E  S ^TMP("LA7TC",$J,LA7SCFG,LA7TC,LA7HL)=LA760_"^"_LA761_"^"_LA762_"^^"_LA7NLT_"^"_LA7NLTN
"RTN","LA7SMU2",146,0)
 . I LA76205("HL")'="" D
"RTN","LA7SMU2",147,0)
 . . I "MISPCYEM"[$P(^LAB(60,LA760,0),"^",4),$P(LA7X(5),"^",7)'="" D
"RTN","LA7SMU2",148,0)
 . . . S ^TMP("LA7TC",$J,LA7SCFG,LA7TC,LA7HL,LA76205("HL"),$P(LA7X(5),"^",7))=LA760_"^"_LA761_"^"_LA762_"^"_LA76205_"^"_LA7NLT_"^"_LA7NLTN
"RTN","LA7SMU2",149,0)
 . . E  S ^TMP("LA7TC",$J,LA7SCFG,LA7TC,LA7HL,LA76205("HL"))=LA760_"^"_LA761_"^"_LA762_"^"_LA76205_"^"_LA7NLT_"^"_LA7NLTN
"RTN","LA7SMU2",150,0)
 ;
"RTN","LA7SMU2",151,0)
 ; Set TMP global when collection sample does not have a topography.
"RTN","LA7SMU2",152,0)
 ; Used for "MISPCYEM" subscripts which can have collection sample with no tpopgraphy.
"RTN","LA7SMU2",153,0)
 I LA7TC'="",'LA761,"MISPCYEM"[$P(^LAB(60,LA760,0),"^",4) D
"RTN","LA7SMU2",154,0)
 . S ^TMP("LA7TC",$J,LA7SCFG,LA7TC,"XXX")=LA760_"^"_LA761_"^"_LA762_"^^"_LA7NLT_"^"_LA7NLTN
"RTN","LA7SMU2",155,0)
 . I LA76205("HL")'="" S ^TMP("LA7TC",$J,LA7SCFG,LA7TC,"XXX",LA76205("HL"))=LA760_"^"_LA761_"^"_LA762_"^"_LA76205_"^"_LA7NLT_"^"_LA7NLTN
"RTN","LA7SMU2",156,0)
 ;
"RTN","LA7SMU2",157,0)
 Q
"RTN","LA7SRR")
0^26^B27494992
"RTN","LA7SRR",1,0)
LA7SRR ;DALOI/JMC - Select Accessions for Resending LEDI Results ; 11/21/01
"RTN","LA7SRR",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7SRR",3,0)
 ;
"RTN","LA7SRR",4,0)
EN ; Select Accessions to resend.
"RTN","LA7SRR",5,0)
 ;
"RTN","LA7SRR",6,0)
 ; Housekeeping before we start.
"RTN","LA7SRR",7,0)
 D EXIT
"RTN","LA7SRR",8,0)
 ;
"RTN","LA7SRR",9,0)
 S (LA7CNT,LA7QUIT)=0
"RTN","LA7SRR",10,0)
 ;
"RTN","LA7SRR",11,0)
 S DIR(0)="SO^1:Range of Accessions;2:Selected Accessions"
"RTN","LA7SRR",12,0)
 S DIR("A")="Selection Method",DIR("B")=1
"RTN","LA7SRR",13,0)
 D ^DIR
"RTN","LA7SRR",14,0)
 I $D(DIRUT) D EXIT Q
"RTN","LA7SRR",15,0)
 S LA7TYPE=+Y
"RTN","LA7SRR",16,0)
 ;
"RTN","LA7SRR",17,0)
 ; Get list of accession numbers, set flags used by LRWU4.
"RTN","LA7SRR",18,0)
 S LRACC=1,LREXMPT=1
"RTN","LA7SRR",19,0)
 I LA7TYPE=1 D
"RTN","LA7SRR",20,0)
 . D ^LRWU4
"RTN","LA7SRR",21,0)
 . I LRAN<1 S LA7QUIT=1 Q
"RTN","LA7SRR",22,0)
 . S FIRST=LRAN,X=$O(^LRO(68,LRAA,1,LRAD,1,":"),-1)
"RTN","LA7SRR",23,0)
 . S DIR(0)="NO^"_LRAN_":"_X_":0",DIR("B")=LRAN
"RTN","LA7SRR",24,0)
 . S DIR("A",1)="",DIR("A")="Download from "_LRAN_" to"
"RTN","LA7SRR",25,0)
 . D ^DIR K DIR
"RTN","LA7SRR",26,0)
 . I $D(DIRUT) S LA7QUIT=1 Q
"RTN","LA7SRR",27,0)
 . S LRAN=FIRST-1,LAST=Y
"RTN","LA7SRR",28,0)
 . F  S LRAN=$O(^LRO(68,LRAA,1,LRAD,1,LRAN)) Q:'LRAN!(LRAN>LAST)  D SETTMP
"RTN","LA7SRR",29,0)
 I LA7TYPE=2 F  D  Q:LA7QUIT!(LRAN<1)
"RTN","LA7SRR",30,0)
 . D ^LRWU4
"RTN","LA7SRR",31,0)
 . I $D(DTOUT)!($D(DUOUT)) S LA7QUIT=1 Q
"RTN","LA7SRR",32,0)
 . I LRAN<1 S:'$D(^TMP("LA7S-RTM",$J)) LA7QUIT=1 Q
"RTN","LA7SRR",33,0)
 . D SETTMP
"RTN","LA7SRR",34,0)
 I LA7QUIT D EXIT Q
"RTN","LA7SRR",35,0)
 ;
"RTN","LA7SRR",36,0)
 I '$D(^TMP("LA7S-RTM",$J)) D  Q
"RTN","LA7SRR",37,0)
 . S DIR("A",1)="No accessions found to retransmit."
"RTN","LA7SRR",38,0)
 . S DIR("A")="Enter RETURN to continue or '^' to exit"
"RTN","LA7SRR",39,0)
 . S DIR(0)="E"
"RTN","LA7SRR",40,0)
 . D ^DIR,EXIT
"RTN","LA7SRR",41,0)
 ;
"RTN","LA7SRR",42,0)
 S DIR("A")="Ready to retransmit"
"RTN","LA7SRR",43,0)
 S DIR("A",1)="Found "_LA7CNT_" accessions that can be retransmitted."
"RTN","LA7SRR",44,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","LA7SRR",45,0)
 D ^DIR K DIR
"RTN","LA7SRR",46,0)
 I Y'=1 D EXIT Q
"RTN","LA7SRR",47,0)
 D EN^DDIOL("Working","","!")
"RTN","LA7SRR",48,0)
 S LA7CNT=0,LA7UID=""
"RTN","LA7SRR",49,0)
 F  S LA7UID=$O(^TMP("LA7S-RTM",$J,LA7UID)) Q:LA7UID=""  D
"RTN","LA7SRR",50,0)
 . K LA7X
"RTN","LA7SRR",51,0)
 . S LA7X=^TMP("LA7S-RTM",$J,LA7UID)
"RTN","LA7SRR",52,0)
 . S LA7NLT="",LA7CNT=LA7CNT+1
"RTN","LA7SRR",53,0)
 . F  S LA7NLT=$O(^TMP("LA7S-RTM",$J,LA7UID,LA7NLT)) Q:LA7NLT=""  D
"RTN","LA7SRR",54,0)
 . . S LA764=$$FIND1^DIC(64,"","MX",LA7NLT,"C")
"RTN","LA7SRR",55,0)
 . . I 'LA764 Q
"RTN","LA7SRR",56,0)
 . . S LA7NLTN=$$GET1^DIQ(64,LA764_",",.01)
"RTN","LA7SRR",57,0)
 . . K LA7Y
"RTN","LA7SRR",58,0)
 . . M LA7Y=^TMP("LA7S-RTM",$J,LA7UID,LA7NLT)
"RTN","LA7SRR",59,0)
 . . D SET^LA7VMSG($P(LA7X,"^"),$P(LA7X,"^",2),$P(LA7X,"^",3),$P(LA7X,"^",4),LA7NLTN,LA7NLT,$P(LA7X,"^",5),$P(LA7X,"^",6),$P(LA7X,"^",7),$P(LA7X,"^",8),.LA7Y,"ORU")
"RTN","LA7SRR",60,0)
 ;
"RTN","LA7SRR",61,0)
 ; Task background job to create messages
"RTN","LA7SRR",62,0)
 S ZTIO="",ZTRTN="ORU^LA7VMSG",ZTDTH=$H
"RTN","LA7SRR",63,0)
 S ZTDESC="Resend Lab LEDI HL7 Result Message"
"RTN","LA7SRR",64,0)
 D ^%ZTLOAD
"RTN","LA7SRR",65,0)
 ;
"RTN","LA7SRR",66,0)
 K LA7X
"RTN","LA7SRR",67,0)
 S LA7X(1)="...Done",LA7X(1,"F")=""
"RTN","LA7SRR",68,0)
 I $G(ZTSK) D
"RTN","LA7SRR",69,0)
 . S LA7X(2)=LA7CNT_" accession"_$S(LA7CNT>1:"s",1:"")_" scheduled for retransmitting of results!"
"RTN","LA7SRR",70,0)
 . S LA7X(3)="Task# "_ZTSK_" queued for processing"
"RTN","LA7SRR",71,0)
 E  S LA7X(2)="*** Tasking of retransmission failed ***"
"RTN","LA7SRR",72,0)
 D EN^DDIOL(.LA7X),EXIT
"RTN","LA7SRR",73,0)
 ;
"RTN","LA7SRR",74,0)
 Q
"RTN","LA7SRR",75,0)
 ;
"RTN","LA7SRR",76,0)
 ;
"RTN","LA7SRR",77,0)
SETTMP ; Setup TMP global with accession to resend.
"RTN","LA7SRR",78,0)
 ;
"RTN","LA7SRR",79,0)
 N LA763,LA768,LA7I,LA7X,LA7Y,LR60,LR61,LRDFN,LRIDT,LRODT,LRSB,LRSS
"RTN","LA7SRR",80,0)
 ;
"RTN","LA7SRR",81,0)
 S LRSS=$P(^LRO(68,LRAA,0),"^",2)
"RTN","LA7SRR",82,0)
 F LA7I=0,.2,.3,3 S LA768(LA7I)=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,LA7I))
"RTN","LA7SRR",83,0)
 S LA7UID=$P(LA768(.3),"^")
"RTN","LA7SRR",84,0)
 ;
"RTN","LA7SRR",85,0)
 ; Not a LEDI specimen
"RTN","LA7SRR",86,0)
 I '$P(LA768(.3),"^",2),'$P(LA768(.3),"^",3) D  Q
"RTN","LA7SRR",87,0)
 . N LA7X
"RTN","LA7SRR",88,0)
 . S LA7X="Not a LEDI specimen - Accession "_$P(LA768(.2),"^")_" ("_LA7UID_") skipped"
"RTN","LA7SRR",89,0)
 . D EN^DDIOL(LA7X,"","!")
"RTN","LA7SRR",90,0)
 ;
"RTN","LA7SRR",91,0)
 I "CHMICYEMSP"'[LRSS!(LRSS="") D
"RTN","LA7SRR",92,0)
 . N LA7X
"RTN","LA7SRR",93,0)
 . S LA7X(1)=$$GET1^DIQ(68,LRAA_",",.02)_" subscript NOT supported at this time"
"RTN","LA7SRR",94,0)
 . S LA7X(2)="Accession "_$P(LA768(.2),"^")_" ("_LA7UID_") skipped"
"RTN","LA7SRR",95,0)
 . D EN^DDIOL(.LA7X)
"RTN","LA7SRR",96,0)
 ;
"RTN","LA7SRR",97,0)
 ; Check file #63 for order codes and results
"RTN","LA7SRR",98,0)
 ; If no order NLT code found then use default NLT
"RTN","LA7SRR",99,0)
 ; Check if test has been added to order then report results using NLT
"RTN","LA7SRR",100,0)
 ; code of the added test.
"RTN","LA7SRR",101,0)
 S LRDFN=$P(LA768(0),"^"),LRODT=$P(LA768(0),"^",4),LRIDT=$P(LA768(3),"^",5)
"RTN","LA7SRR",102,0)
 ; Check for date report completed.
"RTN","LA7SRR",103,0)
 I '$P(^LR(LRDFN,LRSS,LRIDT,0),"^",3) D  Q
"RTN","LA7SRR",104,0)
 . N LA7X
"RTN","LA7SRR",105,0)
 . S LA7X="No date report completed - Accession "_$P(LA768(.2),"^")_" ("_LA7UID_") skipped"
"RTN","LA7SRR",106,0)
 . D EN^DDIOL(LA7X,"","!")
"RTN","LA7SRR",107,0)
 ;
"RTN","LA7SRR",108,0)
 I LRSS="CH" D
"RTN","LA7SRR",109,0)
 . S LRSB=1
"RTN","LA7SRR",110,0)
 . F  S LRSB=$O(^LR(LRDFN,LRSS,LRIDT,LRSB)) Q:'LRSB  D
"RTN","LA7SRR",111,0)
 . . S X=^LR(LRDFN,LRSS,LRIDT,LRSB)
"RTN","LA7SRR",112,0)
 . . S LA7NLT=$P($P(X,"^",3),"!")
"RTN","LA7SRR",113,0)
 . . I LA7NLT'="" S LA7Y(LA7NLT,LRSB)="" Q
"RTN","LA7SRR",114,0)
 . . S LR61=+$P(^LR(LRDFN,LRSS,LRIDT,0),"^",5)
"RTN","LA7SRR",115,0)
 . . S LA7NLT=$P($$DEFCODE^LA7VHLU5(LRSS,LRSB,$P(X,"^",3),LR61),"!")
"RTN","LA7SRR",116,0)
 . . I LA7NLT'="" S LA7Y(LA7NLT,LRSB)=""
"RTN","LA7SRR",117,0)
 ;
"RTN","LA7SRR",118,0)
 I LRSS="MI" D
"RTN","LA7SRR",119,0)
 . S LR60=0
"RTN","LA7SRR",120,0)
 . F  S LR60=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LR60)) Q:'LR60  D
"RTN","LA7SRR",121,0)
 . . S LA764=$P($G(^LAB(60,LR60,64)),"^")
"RTN","LA7SRR",122,0)
 . . S LA7NLT=$$GET1^DIQ(64,LA764_",",1)
"RTN","LA7SRR",123,0)
 . . I LA7NLT'="" S LA7Y(LA7NLT)=""
"RTN","LA7SRR",124,0)
 ;
"RTN","LA7SRR",125,0)
 I LRSS="SP" S LA7Y("88515.0000")=""
"RTN","LA7SRR",126,0)
 I LRSS="CY" S LA7Y("88593.0000")=""
"RTN","LA7SRR",127,0)
 I LRSS="EM" S LA7Y("88597.0000")=""
"RTN","LA7SRR",128,0)
 I LRSS="AU" S LA7Y("88533.0000")=""
"RTN","LA7SRR",129,0)
 ;
"RTN","LA7SRR",130,0)
 I LA7UID'="",$D(LA7Y) D
"RTN","LA7SRR",131,0)
 . S LA7CNT=LA7CNT+1
"RTN","LA7SRR",132,0)
 . S X=$P(LA768(.3),"^",1)_"^"_$P(LA768(.3),"^",2)_"^"_$P(LA768(.3),"^",5)_"^"_$P(LA768(.3),"^",3)_"^"_LRIDT_"^"_LRSS_"^"_LRDFN_"^"_LRODT
"RTN","LA7SRR",133,0)
 . S ^TMP("LA7S-RTM",$J,LA7UID)=X
"RTN","LA7SRR",134,0)
 . S LA7I=""
"RTN","LA7SRR",135,0)
 . F  S LA7I=$O(LA7Y(LA7I)) Q:LA7I=""  M ^TMP("LA7S-RTM",$J,LA7UID,LA7I)=LA7Y(LA7I)
"RTN","LA7SRR",136,0)
 Q
"RTN","LA7SRR",137,0)
 ;
"RTN","LA7SRR",138,0)
 ;
"RTN","LA7SRR",139,0)
EXIT ; Housekeeping - clean up.
"RTN","LA7SRR",140,0)
 K ^TMP("LA7S-RTM",$J)
"RTN","LA7SRR",141,0)
 K LA764,LA7CNT,LA7NLT,LA7NLTN,LA7QUIT,LA7TYPE,LA7UID,LA7X,LA7Y
"RTN","LA7SRR",142,0)
 K LRAA,LRACC,LRAD,LRAN,LREXMPT,LRIDIV,LRSS,LRX
"RTN","LA7SRR",143,0)
 K %DT,DA,DIC,DIR,DIRUT,DTOUT,DUOUT,FIRST,LAST,X,Y
"RTN","LA7SRR",144,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","LA7SRR",145,0)
 Q
"RTN","LA7UTILA")
0^5^B48089182
"RTN","LA7UTILA",1,0)
LA7UTILA ;DALOI/JMC - Browse UI message ; 6/19/96 09:00
"RTN","LA7UTILA",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**23,27,46,64**;Sep 27, 1994
"RTN","LA7UTILA",3,0)
 ;
"RTN","LA7UTILA",4,0)
EN ; Select a Universal Interface message to browse.
"RTN","LA7UTILA",5,0)
 D EXIT ; Housekeeping before we start.
"RTN","LA7UTILA",6,0)
 S DIC="^LAHM(62.49,",DIC("W")="W ""   "",$P(^(0),U,6)"
"RTN","LA7UTILA",7,0)
 S VAUTVB="LA7LIST",VAUTSTR="Message",VAUTNI=2,VAUTNALL=1
"RTN","LA7UTILA",8,0)
 D FIRST^VAUTOMA
"RTN","LA7UTILA",9,0)
 I Y<1!('$O(LA7LIST(0))) D EXIT Q
"RTN","LA7UTILA",10,0)
 ;
"RTN","LA7UTILA",11,0)
DEV ; Called from LA7UXQA - when viewing message via alert system.
"RTN","LA7UTILA",12,0)
 S DIR(0)="YO",DIR("A")="Parse message fields based on HL7 segments",DIR("B")="NO"
"RTN","LA7UTILA",13,0)
 D ^DIR K DIR
"RTN","LA7UTILA",14,0)
 I $D(DIRUT) D EXIT Q
"RTN","LA7UTILA",15,0)
 S LA7PARS=+Y ; Save flag to parse message.
"RTN","LA7UTILA",16,0)
 I LA7PARS D  I $D(DIRUT) D EXIT Q
"RTN","LA7UTILA",17,0)
 . S DIR(0)="YO",DIR("A")="Suppress blank segments",DIR("B")="YES"
"RTN","LA7UTILA",18,0)
 . D ^DIR K DIR Q:$D(DIRUT)
"RTN","LA7UTILA",19,0)
 . S $P(LA7PARS,"^",2)=+Y
"RTN","LA7UTILA",20,0)
 ; Ask device and task if requested.
"RTN","LA7UTILA",21,0)
 S %ZIS="Q" D ^%ZIS K %ZIS
"RTN","LA7UTILA",22,0)
 I POP D EXIT Q
"RTN","LA7UTILA",23,0)
 I $D(IO("Q")) D  G EXIT
"RTN","LA7UTILA",24,0)
 . S LA7TEST=0 ; Tasked - not a CRT.
"RTN","LA7UTILA",25,0)
 . S ZTRTN="DQ^LA7UTILA",ZTDESC="Print LA7 UI Messages",ZTSAVE("LA7*")=""
"RTN","LA7UTILA",26,0)
 . D ^%ZTLOAD
"RTN","LA7UTILA",27,0)
 . W !,"Request ",$S($D(ZTSK):"",1:"NOT "),"Queued"
"RTN","LA7UTILA",28,0)
 . K IO("Q")
"RTN","LA7UTILA",29,0)
 U IO(0)
"RTN","LA7UTILA",30,0)
 ;
"RTN","LA7UTILA",31,0)
 ; Flag to determine if okay to use browser (default=true).
"RTN","LA7UTILA",32,0)
 S LA7TEST=1
"RTN","LA7UTILA",33,0)
 ;
"RTN","LA7UTILA",34,0)
 ; Home device not current device or using non-CRT terminal type.
"RTN","LA7UTILA",35,0)
 I IO'=IO(0)!($E(IOST,1,2)'="C-") S LA7TEST=0
"RTN","LA7UTILA",36,0)
 ;
"RTN","LA7UTILA",37,0)
 ; If not queued and home device then test for browser
"RTN","LA7UTILA",38,0)
 I LA7TEST,'$$TEST^DDBRT D
"RTN","LA7UTILA",39,0)
 . S LA7TEST=0 ; Unable to use browser.
"RTN","LA7UTILA",40,0)
 . W !,$C(7),"This terminal does not support the needed functionality to use the Browser!"
"RTN","LA7UTILA",41,0)
 . W !,"Will use standard FileMan Data Display.",!
"RTN","LA7UTILA",42,0)
 I LA7TEST D
"RTN","LA7UTILA",43,0)
 . N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LA7UTILA",44,0)
 . S DIR(0)="YO",DIR("A")="Use Browser to display message(s)",DIR("B")="YES"
"RTN","LA7UTILA",45,0)
 . D ^DIR
"RTN","LA7UTILA",46,0)
 . I $D(DIRUT) S LA7TEST=-1 Q
"RTN","LA7UTILA",47,0)
 . S LA7TEST=+Y
"RTN","LA7UTILA",48,0)
 I LA7TEST<0 D EXIT Q
"RTN","LA7UTILA",49,0)
 D WAIT^DICD
"RTN","LA7UTILA",50,0)
 ;
"RTN","LA7UTILA",51,0)
DQ ; Dequeue entry point.
"RTN","LA7UTILA",52,0)
 U IO
"RTN","LA7UTILA",53,0)
 K ^TMP($J),^TMP("DDB",$J)
"RTN","LA7UTILA",54,0)
 S LA7IEN=0
"RTN","LA7UTILA",55,0)
 F  S LA7IEN=$O(LA7LIST(LA7IEN)) Q:'LA7IEN  S LA7J=1 D BRO("LA7 UI Message Display",LA7IEN,LA7IEN)
"RTN","LA7UTILA",56,0)
 I LA7TEST D  Q  ; Display using browser.
"RTN","LA7UTILA",57,0)
 . D DOCLIST^DDBR("^TMP($J,""LIST"")","R")
"RTN","LA7UTILA",58,0)
 . D EXIT
"RTN","LA7UTILA",59,0)
 S (LA7IEN,LA7QUIT)=0
"RTN","LA7UTILA",60,0)
 S HDR=""
"RTN","LA7UTILA",61,0)
 F  S HDR=$O(^TMP($J,"LIST",HDR)) Q:HDR=""  D  Q:LA7QUIT
"RTN","LA7UTILA",62,0)
 . I IOST["C-" W @IOF
"RTN","LA7UTILA",63,0)
 . W $$CJ^XLFSTR(HDR,IOM," "),!
"RTN","LA7UTILA",64,0)
 . S LA7ROOT=^TMP($J,"LIST",HDR),LA7ROOT=$E(LA7ROOT,1,$L(LA7ROOT)-1)
"RTN","LA7UTILA",65,0)
 . S LA7CONT=0 ; Flag to determine if line has been continue on followng line.
"RTN","LA7UTILA",66,0)
 . S I=0
"RTN","LA7UTILA",67,0)
 . F  S I=$O(@(LA7ROOT_","_I_")"))  Q:'I  D  Q:LA7QUIT
"RTN","LA7UTILA",68,0)
 . . S LA7X=^(I)
"RTN","LA7UTILA",69,0)
 . . I LA7X="" W ! Q  ; Print blank separator line
"RTN","LA7UTILA",70,0)
 . . F  S LA7Y=$E(LA7X,1,IOM-1) Q:LA7Y=""  D  Q:LA7QUIT
"RTN","LA7UTILA",71,0)
 . . . S LA7X=$E(LA7X,IOM,$L(LA7X))
"RTN","LA7UTILA",72,0)
 . . . I $L(LA7X) S LA7CONT=1,LA7X="--->"_LA7X
"RTN","LA7UTILA",73,0)
 . . . W !,LA7Y
"RTN","LA7UTILA",74,0)
 . . . I $Y+7>IOSL D EOP W @IOF Q:LA7QUIT
"RTN","LA7UTILA",75,0)
 . I 'LA7QUIT D EOP
"RTN","LA7UTILA",76,0)
 . W !!
"RTN","LA7UTILA",77,0)
 D EXIT
"RTN","LA7UTILA",78,0)
 Q
"RTN","LA7UTILA",79,0)
 ;
"RTN","LA7UTILA",80,0)
BRO(LA7HDR,LA7DOC,LA7IEN,LA7J) ; Setup text for browser.
"RTN","LA7UTILA",81,0)
 ; Called from above.
"RTN","LA7UTILA",82,0)
 N LA7,LA7DT,LA7X,I,J,K,X,Y
"RTN","LA7UTILA",83,0)
 D GETS^DIQ(62.49,LA7IEN,".01:149;160;161","ENR","LA7") ; Retrieve data from file 62.49
"RTN","LA7UTILA",84,0)
 S J=$G(LA7J,1)
"RTN","LA7UTILA",85,0)
 S ^TMP("DDB",$J,LA7DOC,J)=" ["_$$CJ^XLFSTR(" Message Statistics ",IOM-4,"*")_"]"
"RTN","LA7UTILA",86,0)
 S J=J+1,^TMP("DDB",$J,LA7DOC,J)=" "
"RTN","LA7UTILA",87,0)
 S I="LA7(62.49)",K=0,J(0)=J
"RTN","LA7UTILA",88,0)
 F  S I=$Q(@I) Q:I=""  Q:$QS(I,1)'=62.49  D
"RTN","LA7UTILA",89,0)
 . S X=$QS(I,3)_": "_@I
"RTN","LA7UTILA",90,0)
 . I K=0,$L(X)>((IOM\2)-1) S K=1,Y=""
"RTN","LA7UTILA",91,0)
 . I K=0 S K=1,Y=$$LJ^XLFSTR(X,(IOM\2)+2)
"RTN","LA7UTILA",92,0)
 . E  S K=0,J=J+1,^TMP("DDB",$J,LA7DOC,J)=Y_$QS(I,3)_": "_@I
"RTN","LA7UTILA",93,0)
 I K=1 S J=J+1,^TMP("DDB",$J,LA7DOC,J)=Y
"RTN","LA7UTILA",94,0)
 I J(0)=J S J=J+1,^TMP("DDB",$J,LA7DOC,J)=$$CJ^XLFSTR(" [None Found]",IOM-1)
"RTN","LA7UTILA",95,0)
 S LA7X=$G(^LAHM(62.49,LA7IEN,0))
"RTN","LA7UTILA",96,0)
 S LA7DT=$P(LA7X,"^",5) ; Date/time message received
"RTN","LA7UTILA",97,0)
 S LA7DT(0)=LA7DT\1 ; Date message received.
"RTN","LA7UTILA",98,0)
 S LA7DT(1)=LA7DT#1 ; Time message received.
"RTN","LA7UTILA",99,0)
 S K="LA7ERR^"_(LA7DT(0)-.1)
"RTN","LA7UTILA",100,0)
 S J=J+1,^TMP("DDB",$J,LA7DOC,J)=" "
"RTN","LA7UTILA",101,0)
 S J=J+1,^TMP("DDB",$J,LA7DOC,J)=" ["_$$CJ^XLFSTR(" Error Message ",IOM-4,"*")_"]"
"RTN","LA7UTILA",102,0)
 S J=J+1,^TMP("DDB",$J,LA7DOC,J)=" "
"RTN","LA7UTILA",103,0)
 S J(0)=J ; Save value of "J", determine if any error message found.
"RTN","LA7UTILA",104,0)
 F  S K=$O(^XTMP(K)) Q:K=""!($P(K,"^")'="LA7ERR")  D
"RTN","LA7UTILA",105,0)
 . I LA7DT(0)=$P(K,"^",2) S I=LA7DT(1)-.00000001 ; Start looking after date/time of message.
"RTN","LA7UTILA",106,0)
 . E  S I=0
"RTN","LA7UTILA",107,0)
 . F  S I=$O(^XTMP(K,I)) Q:'I  D
"RTN","LA7UTILA",108,0)
 . . S X=^XTMP(K,I)
"RTN","LA7UTILA",109,0)
 . . I $P(X,"^",2)=LA7IEN D
"RTN","LA7UTILA",110,0)
 . . . S J=J+1,^TMP("DDB",$J,LA7DOC,J)="Date: "_$$FMTE^XLFDT($P(K,"^",2)+I,1)
"RTN","LA7UTILA",111,0)
 . . . S J=J+1,^TMP("DDB",$J,LA7DOC,J)="Text: "_$P(X,"^",4) ; Get error message.
"RTN","LA7UTILA",112,0)
 . . . S J=J+1,^TMP("DDB",$J,LA7DOC,J)=" "
"RTN","LA7UTILA",113,0)
 I J(0)=J S J=J+1,^TMP("DDB",$J,LA7DOC,J)=$$CJ^XLFSTR("[None Found]",IOM-1)
"RTN","LA7UTILA",114,0)
 S J=J+1,^TMP("DDB",$J,LA7DOC,J)=" "
"RTN","LA7UTILA",115,0)
 S J=J+1,^TMP("DDB",$J,LA7DOC,J)=" ["_$$CJ^XLFSTR(" Text of Message ",IOM-4,"*")_"]"
"RTN","LA7UTILA",116,0)
 S J=J+1,^TMP("DDB",$J,LA7DOC,J)=" "
"RTN","LA7UTILA",117,0)
 ;
"RTN","LA7UTILA",118,0)
 ; Retrieve text of message from 62.49.
"RTN","LA7UTILA",119,0)
 S I=0,J(0)=J
"RTN","LA7UTILA",120,0)
 F  S I=$O(^LAHM(62.49,LA7IEN,150,I)) Q:'I  D
"RTN","LA7UTILA",121,0)
 . S J=J+1
"RTN","LA7UTILA",122,0)
 . S ^TMP("DDB",$J,LA7DOC,J)=$G(^LAHM(62.49,LA7IEN,150,I,0))
"RTN","LA7UTILA",123,0)
 . ; Parse each message segment.
"RTN","LA7UTILA",124,0)
 . I '$G(LA7PARS) Q
"RTN","LA7UTILA",125,0)
 . S X=$G(^LAHM(62.49,LA7IEN,150,I,0))
"RTN","LA7UTILA",126,0)
 . ; Obtain field separator and encoding characters.
"RTN","LA7UTILA",127,0)
 . I $E(X,1,3)="MSH" S HLFS=$E(X,4),HLECH=$E(X,5,8)
"RTN","LA7UTILA",128,0)
 . ; Segement ID code.
"RTN","LA7UTILA",129,0)
 . S Y=$P(X,HLFS)
"RTN","LA7UTILA",130,0)
 . ; Parse fields.
"RTN","LA7UTILA",131,0)
 . D PF
"RTN","LA7UTILA",132,0)
 ;
"RTN","LA7UTILA",133,0)
 I J(0)=J S J=J+1,^TMP("DDB",$J,LA7DOC,J)=$$CJ^XLFSTR("[None Found]",IOM-1)
"RTN","LA7UTILA",134,0)
 ;
"RTN","LA7UTILA",135,0)
 ; If linked to another entry go pasrse that entry also
"RTN","LA7UTILA",136,0)
 I $P(LA7X,"^",7) D BRO("LA7 UI Message Display",LA7DOC,$P(LA7X,"^",7),J)
"RTN","LA7UTILA",137,0)
 ;
"RTN","LA7UTILA",138,0)
 ; Setup document list.
"RTN","LA7UTILA",139,0)
 S LA7HDR=LA7HDR_" Msg #"_LA7DOC_" - "_$P(^LAHM(62.49,LA7DOC,0),"^",6)
"RTN","LA7UTILA",140,0)
 S ^TMP($J,"LIST",LA7HDR)="^TMP(""DDB"",$J,"_LA7DOC_")"
"RTN","LA7UTILA",141,0)
 Q
"RTN","LA7UTILA",142,0)
 ;
"RTN","LA7UTILA",143,0)
PF ; Parse message fields
"RTN","LA7UTILA",144,0)
 ;
"RTN","LA7UTILA",145,0)
 F K=$S(Y="MSH":1,1:2):1:$L(X,HLFS) D
"RTN","LA7UTILA",146,0)
 . S Z=$P(X,HLFS,K)
"RTN","LA7UTILA",147,0)
 . ; Don't display blank segments.
"RTN","LA7UTILA",148,0)
 . I $P(LA7PARS,"^",2),Z="" Q
"RTN","LA7UTILA",149,0)
 . S J=J+1
"RTN","LA7UTILA",150,0)
 . I Y="MSH" S V=Y_"-"_K_" = "_$S(K=1:HLFS,1:$P(X,HLFS,K))
"RTN","LA7UTILA",151,0)
 . E  S V=Y_"-"_(K-1)_" = "_$P(X,HLFS,K)
"RTN","LA7UTILA",152,0)
 . S ^TMP("DDB",$J,LA7DOC,J)=V
"RTN","LA7UTILA",153,0)
 . I Z="" Q  ; Don't parse blank segments.
"RTN","LA7UTILA",154,0)
 . I Y="MSH",K<3 Q  ; Don't parse MSH-1/2.
"RTN","LA7UTILA",155,0)
 . ; Parse components.
"RTN","LA7UTILA",156,0)
 . D PC
"RTN","LA7UTILA",157,0)
 ; Separate segments with blank line.
"RTN","LA7UTILA",158,0)
 S J=J+1,^TMP("DDB",$J,LA7DOC,J)=" "
"RTN","LA7UTILA",159,0)
 Q
"RTN","LA7UTILA",160,0)
 ;
"RTN","LA7UTILA",161,0)
PC ; Parse field components
"RTN","LA7UTILA",162,0)
 ;
"RTN","LA7UTILA",163,0)
 F L=1:1:$L(Z,$E(HLECH,1)) D
"RTN","LA7UTILA",164,0)
 . S V=$P(Z,$E(HLECH,1),L) Q:V=""
"RTN","LA7UTILA",165,0)
 . I Z[$E(HLECH,1) D
"RTN","LA7UTILA",166,0)
 . . S J=J+1
"RTN","LA7UTILA",167,0)
 . . S ^TMP("DDB",$J,LA7DOC,J)=Y_"-"_($S(Y="MSH":K,1:K-1))_"-"_L_" = "_V
"RTN","LA7UTILA",168,0)
 . I V'[$E(HLECH,2) Q
"RTN","LA7UTILA",169,0)
 . ; Parse repetition of components.
"RTN","LA7UTILA",170,0)
 . F M=1:1:$L(V,$E(HLECH,2)) D
"RTN","LA7UTILA",171,0)
 . . S J=J+1
"RTN","LA7UTILA",172,0)
 . . S ^TMP("DDB",$J,LA7DOC,J)=Y_"-"_($S(Y="MSH":K,1:K-1))_"-"_L_"-"_M_" = "_$P(V,$E(HLECH,2),M)
"RTN","LA7UTILA",173,0)
 Q
"RTN","LA7UTILA",174,0)
 ;
"RTN","LA7UTILA",175,0)
EOP ; End of page.
"RTN","LA7UTILA",176,0)
 I LA7CONT W !!,"NOTE: '--->' indicates continuation of previous line." S LA7CONT=0
"RTN","LA7UTILA",177,0)
 I $D(ZTQUEUED)!(IOST'["C-") Q
"RTN","LA7UTILA",178,0)
 S DIR(0)="E" D ^DIR K DIR S:Y'=1 LA7QUIT=1
"RTN","LA7UTILA",179,0)
 Q
"RTN","LA7UTILA",180,0)
 ;
"RTN","LA7UTILA",181,0)
EXIT ; Clean up.
"RTN","LA7UTILA",182,0)
 W @IOF
"RTN","LA7UTILA",183,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","LA7UTILA",184,0)
 E  D ^%ZISC
"RTN","LA7UTILA",185,0)
 K ^TMP($J),^TMP("DDB",$J)
"RTN","LA7UTILA",186,0)
 K LA7CONT,LA7IEN,LA7J,LA7LIST,LA7PARS,LA7QUIT,LA7ROOT,LA7TEST,LA7X,LA7Y
"RTN","LA7UTILA",187,0)
 K DIC,DIR,HDR,HLECH,HLFS,I,J,K,L,M,V,X,Y,Z
"RTN","LA7UTILA",188,0)
 K VAUTVB,VAUTNI,VAUTSTR,VAUTNALL
"RTN","LA7UTILA",189,0)
 Q
"RTN","LA7UTILA",190,0)
 ;
"RTN","LA7UTILA",191,0)
 ;
"RTN","LA7UTILA",192,0)
FMT(LA76249) ; Perform test to determine storage format, each segment on one
"RTN","LA7UTILA",193,0)
 ;  node or segment has continuation nodes separated with null "" nodes.
"RTN","LA7UTILA",194,0)
 ; Call with LA76249 = ien of entry in file #62.49
"RTN","LA7UTILA",195,0)
 ;      Returns LA7Y = 0-old format, 1-new format
"RTN","LA7UTILA",196,0)
 ;
"RTN","LA7UTILA",197,0)
 N LA7END,LA7Y,LA7ROOT
"RTN","LA7UTILA",198,0)
 S (LA7END,LA7Y)=0,LA7ROOT="^LAHM(62.49,LA76249,150,0)"
"RTN","LA7UTILA",199,0)
 F  S LA7ROOT=$Q(@LA7ROOT) Q:LA7END  D
"RTN","LA7UTILA",200,0)
 . I $QS(LA7ROOT,1)'="62.49"!($QS(LA7ROOT,2)'=LA76249)!($QS(LA7ROOT,3)'=150) S LA7END=1 Q
"RTN","LA7UTILA",201,0)
 . I @LA7ROOT="" S (LA7Y,LA7END)=1
"RTN","LA7UTILA",202,0)
 Q LA7Y
"RTN","LA7VHL")
0^36^B24721166
"RTN","LA7VHL",1,0)
LA7VHL ;DALOI/DLR - Main Driver for incoming HL7 V1.6 messages ; 12/3/1997
"RTN","LA7VHL",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,46,62,64**;Sep 27, 1994
"RTN","LA7VHL",3,0)
 ; This routine is not meant to be invoked by name
"RTN","LA7VHL",4,0)
 ;
"RTN","LA7VHL",5,0)
 QUIT
"RTN","LA7VHL",6,0)
 ;
"RTN","LA7VHL",7,0)
 ; This routine is called by the HL7 package V1.6 to process
"RTN","LA7VHL",8,0)
 ; incoming HL7 messages.  Expected variables are those
"RTN","LA7VHL",9,0)
 ; documented in the HL7 package documentation.  The line
"RTN","LA7VHL",10,0)
 ; tag is called if it is entered into the PROCESSING ROUTINE
"RTN","LA7VHL",11,0)
 ; field for the server protocol.
"RTN","LA7VHL",12,0)
 ;
"RTN","LA7VHL",13,0)
ORR ; Process incoming ORR messages
"RTN","LA7VHL",14,0)
ACK ; Process incoming ACK messages
"RTN","LA7VHL",15,0)
ORM ; Process incoming ORM messages
"RTN","LA7VHL",16,0)
ORU ; Process incoming ORU messages
"RTN","LA7VHL",17,0)
 ;
"RTN","LA7VHL",18,0)
 N HLA,HLP
"RTN","LA7VHL",19,0)
 N LA76248,LA76249,LA7AAT,LA7AERR,LA7CS,LA7DT,LA7ECH,LA7FS,LA7HLS,LA7HLSA,LA7INTYP,LA7MEDT,LA7MTYP,LA7RAP,LA7PRID,LA7RSITE,LA7SAP,LA7SEQ,LA7SSITE,LA7TYPE,LA7VER,LA7VI
"RTN","LA7VHL",20,0)
 N X,Y
"RTN","LA7VHL",21,0)
 ;
"RTN","LA7VHL",22,0)
 S DT=$$DT^XLFDT
"RTN","LA7VHL",23,0)
 K ^TMP("HLA",$J)
"RTN","LA7VHL",24,0)
 ;
"RTN","LA7VHL",25,0)
 ; Set up LA7HLS with HL variables to build ACK message.
"RTN","LA7VHL",26,0)
 ; Handle situation when systems use different encoding characters.
"RTN","LA7VHL",27,0)
 D RSPINIT^HLFNC2(HL("EIDS"),.LA7HLS)
"RTN","LA7VHL",28,0)
 ;
"RTN","LA7VHL",29,0)
 S (LA76248,LA76249,LA7INTYP,LA7SEQ)=0
"RTN","LA7VHL",30,0)
 ;
"RTN","LA7VHL",31,0)
 ; Move message from HL7 global to Lab global
"RTN","LA7VHL",32,0)
 F LA7VI=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","LA7VHL",33,0)
 . N LA7SEG,LA7VJ
"RTN","LA7VHL",34,0)
 . S LA7SEG(0)=HLNODE
"RTN","LA7VHL",35,0)
 . S LA7VJ=0
"RTN","LA7VHL",36,0)
 . F  S LA7VJ=$O(HLNODE(LA7VJ)) Q:'LA7VJ  S LA7SEG(LA7VJ)=HLNODE(LA7VJ)
"RTN","LA7VHL",37,0)
 . I '$L(LA7SEG(0)) Q
"RTN","LA7VHL",38,0)
 . I $E(LA7SEG(0),1,3)="MSH" D MSH
"RTN","LA7VHL",39,0)
 . I LA7SEQ<1 D REJECT("no MSH segment found") Q
"RTN","LA7VHL",40,0)
 . D FILE6249^LA7VHLU(LA76249,.LA7SEG)
"RTN","LA7VHL",41,0)
 ;
"RTN","LA7VHL",42,0)
 I $G(LA76249)>0 D
"RTN","LA7VHL",43,0)
 . ; Update entry in 62.49
"RTN","LA7VHL",44,0)
 . ; Change status to (Q)ueued for processing from (B)uilding
"RTN","LA7VHL",45,0)
 . N FDA,LA7ERR
"RTN","LA7VHL",46,0)
 . S FDA(1,62.49,LA76249_",",2)="Q"
"RTN","LA7VHL",47,0)
 . D FILE^DIE("","FDA(1)","LA7ERR(1)")
"RTN","LA7VHL",48,0)
 . ; Release lock on file #62.49 entry (tells LA7VIN message is stored).
"RTN","LA7VHL",49,0)
 . L -^LAHM(62.49,LA76249)
"RTN","LA7VHL",50,0)
 ;
"RTN","LA7VHL",51,0)
 ; Run processing routine
"RTN","LA7VHL",52,0)
 I '$D(^LAHM(62.48,LA76248,1)) D CREATE^LA7LOG(5)
"RTN","LA7VHL",53,0)
 I $D(^LAHM(62.48,LA76248,1)) X ^(1)
"RTN","LA7VHL",54,0)
 ;
"RTN","LA7VHL",55,0)
 ; Don't (ACK)nowledge ACK or ORR messages
"RTN","LA7VHL",56,0)
 I $G(LA7MTYP)="ACK"!($G(LA7MTYP)="ORR") Q
"RTN","LA7VHL",57,0)
 ;
"RTN","LA7VHL",58,0)
 ; No application acknowledgement
"RTN","LA7VHL",59,0)
 I $G(LA7AAT(1))="NE" Q
"RTN","LA7VHL",60,0)
 ;
"RTN","LA7VHL",61,0)
 ; Other system only wants ACK on successful completion condition and we found an error.
"RTN","LA7VHL",62,0)
 I $G(LA7AERR)'="",$G(LA7AAT(1))="SU" Q
"RTN","LA7VHL",63,0)
 ;
"RTN","LA7VHL",64,0)
 ; Other system only wants ACK on error/reject condition
"RTN","LA7VHL",65,0)
 I $G(LA7AERR)="",$G(LA7AAT(1))="ER" Q
"RTN","LA7VHL",66,0)
 ;
"RTN","LA7VHL",67,0)
 ; If POC interface and no error then quit - send application ack after
"RTN","LA7VHL",68,0)
 ; processing message.
"RTN","LA7VHL",69,0)
 I $G(LA7AERR)="",LA7INTYP>19,LA7INTYP<30 S X=$$DONTPURG^HLUTIL() Q
"RTN","LA7VHL",70,0)
 ;
"RTN","LA7VHL",71,0)
 ; HL7 returns this as ACK if no errors found
"RTN","LA7VHL",72,0)
 I $G(LA7AERR)="" S HLA("HLA",1)="MSA"_LA7HLS("RFS")_"AA"_LA7HLS("RFS")_HL("MID")
"RTN","LA7VHL",73,0)
 ;
"RTN","LA7VHL",74,0)
 ; Send ACK message
"RTN","LA7VHL",75,0)
 I $D(HLA("HLA")) D
"RTN","LA7VHL",76,0)
 . S HLP("NAMESPACE")="LA"
"RTN","LA7VHL",77,0)
 . D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"LM",1,.LA7HLSA,"",.HLP)
"RTN","LA7VHL",78,0)
 ;
"RTN","LA7VHL",79,0)
 I $D(^TMP("HLA",$J)) D
"RTN","LA7VHL",80,0)
 . S HLP("NAMESPACE")="LA"
"RTN","LA7VHL",81,0)
 . D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"GM",1,.LA7HLSA,"",.HLP)
"RTN","LA7VHL",82,0)
 ;
"RTN","LA7VHL",83,0)
 Q
"RTN","LA7VHL",84,0)
 ;
"RTN","LA7VHL",85,0)
 ;
"RTN","LA7VHL",86,0)
MSH ;;MSH
"RTN","LA7VHL",87,0)
 ;
"RTN","LA7VHL",88,0)
 N LA7CFIG,LA7MID,LA7NOW,X
"RTN","LA7VHL",89,0)
 ;
"RTN","LA7VHL",90,0)
 S LA7SEQ=1
"RTN","LA7VHL",91,0)
 S LA7FS=$E(LA7SEG(0),4)
"RTN","LA7VHL",92,0)
 S LA7ECH=$E(LA7SEG(0),5,8)
"RTN","LA7VHL",93,0)
 S LA7CS=$E(LA7ECH,1)
"RTN","LA7VHL",94,0)
 ; Sending application
"RTN","LA7VHL",95,0)
 S LA7SAP=$P($$P^LA7VHLU(.LA7SEG,3,LA7FS),LA7CS)
"RTN","LA7VHL",96,0)
 ; Sending facility
"RTN","LA7VHL",97,0)
 S LA7SSITE=$P($$P^LA7VHLU(.LA7SEG,4,LA7FS),LA7CS)
"RTN","LA7VHL",98,0)
 ; Receiving application
"RTN","LA7VHL",99,0)
 S LA7RAP=$P($$P^LA7VHLU(.LA7SEG,5,LA7FS),LA7CS)
"RTN","LA7VHL",100,0)
 ; Receiving facility
"RTN","LA7VHL",101,0)
 S LA7RSITE=$P($$P^LA7VHLU(.LA7SEG,6,LA7FS),LA7CS)
"RTN","LA7VHL",102,0)
 ; Date/time of message
"RTN","LA7VHL",103,0)
 S LA7MEDT=$$P^LA7VHLU(.LA7SEG,7,LA7FS)
"RTN","LA7VHL",104,0)
 ; Message type/trigger event/message structure
"RTN","LA7VHL",105,0)
 S X=$$P^LA7VHLU(.LA7SEG,9,LA7FS)
"RTN","LA7VHL",106,0)
 S LA7MTYP=$P(X,LA7CS),LA7MTYP("EVN")=$P(X,LA7CS,2),LA7MTYP("MSGSTR")=$P(X,LA7CS,3)
"RTN","LA7VHL",107,0)
 ; Message Control ID
"RTN","LA7VHL",108,0)
 S LA7MID=$$P^LA7VHLU(.LA7SEG,10,LA7FS)
"RTN","LA7VHL",109,0)
 ; Processing ID
"RTN","LA7VHL",110,0)
 S LA7PRID=$$P^LA7VHLU(.LA7SEG,11,LA7FS)
"RTN","LA7VHL",111,0)
 ; Version ID
"RTN","LA7VHL",112,0)
 S LA7VER=$$P^LA7VHLU(.LA7SEG,12,LA7FS)
"RTN","LA7VHL",113,0)
 ; Accept acknowledgement type
"RTN","LA7VHL",114,0)
 S LA7AAT(0)=$$P^LA7VHLU(.LA7SEG,15,LA7FS)
"RTN","LA7VHL",115,0)
 ; Application acknowledgement type
"RTN","LA7VHL",116,0)
 S LA7AAT(1)=$$P^LA7VHLU(.LA7SEG,16,LA7FS)
"RTN","LA7VHL",117,0)
 ;
"RTN","LA7VHL",118,0)
 S LA7CFIG=LA7SAP_LA7SSITE_LA7RAP_LA7RSITE
"RTN","LA7VHL",119,0)
 S X=LA7CFIG X ^%ZOSF("LPC")
"RTN","LA7VHL",120,0)
 S LA76248=+$O(^LAHM(62.48,"C",$E(LA7CFIG,1,27)_Y,0))
"RTN","LA7VHL",121,0)
 I 'LA76248 S LA76248=+$O(^LAHM(62.48,"B",LA7SAP,0))
"RTN","LA7VHL",122,0)
 I 'LA76248,$E(LA7SAP,1,11)="LA7V REMOTE" S LA76248=+$O(^LAHM(62.48,"B","LA7V COLLECTION "_$P(LA7SAP," ",3),0))
"RTN","LA7VHL",123,0)
 I 'LA76248 D  Q
"RTN","LA7VHL",124,0)
 . D CREATE^LA7LOG(1)
"RTN","LA7VHL",125,0)
 . D REJECT("no config in 62.48")
"RTN","LA7VHL",126,0)
 ;
"RTN","LA7VHL",127,0)
 ; Determine interface type
"RTN","LA7VHL",128,0)
 S LA7INTYP=+$P(^LAHM(62.48,LA76248,0),"^",9)
"RTN","LA7VHL",129,0)
 ;
"RTN","LA7VHL",130,0)
 I '$P($G(^LAHM(62.48,LA76248,0)),"^",3) D  Q
"RTN","LA7VHL",131,0)
 . D CREATE^LA7LOG(3)
"RTN","LA7VHL",132,0)
 . D REJECT("config is inactive")
"RTN","LA7VHL",133,0)
 ;
"RTN","LA7VHL",134,0)
 ; store incoming message in ^LAHM(62.49)
"RTN","LA7VHL",135,0)
 S LA76249=$$INIT6249^LA7VHLU
"RTN","LA7VHL",136,0)
 I LA76249<1 Q
"RTN","LA7VHL",137,0)
 ;
"RTN","LA7VHL",138,0)
 ; update entry in 62.49
"RTN","LA7VHL",139,0)
 N FDA,LA7ERR
"RTN","LA7VHL",140,0)
 I $G(LA76248) S FDA(1,62.49,LA76249_",",.5)=LA76248
"RTN","LA7VHL",141,0)
 S FDA(1,62.49,LA76249_",",1)="I"
"RTN","LA7VHL",142,0)
 S FDA(1,62.49,LA76249_",",3)=3
"RTN","LA7VHL",143,0)
 S FDA(1,62.49,LA76249_",",102)=LA7SAP
"RTN","LA7VHL",144,0)
 S FDA(1,62.49,LA76249_",",103)=LA7SSITE
"RTN","LA7VHL",145,0)
 S FDA(1,62.49,LA76249_",",104)=LA7RAP
"RTN","LA7VHL",146,0)
 S FDA(1,62.49,LA76249_",",105)=LA7RSITE
"RTN","LA7VHL",147,0)
 S FDA(1,62.49,LA76249_",",106)=LA7MEDT
"RTN","LA7VHL",148,0)
 S FDA(1,62.49,LA76249_",",108)=LA7MTYP
"RTN","LA7VHL",149,0)
 S FDA(1,62.49,LA76249_",",109)=LA7MID
"RTN","LA7VHL",150,0)
 S FDA(1,62.49,LA76249_",",110)=LA7PRID
"RTN","LA7VHL",151,0)
 S FDA(1,62.49,LA76249_",",111)=LA7VER
"RTN","LA7VHL",152,0)
 S FDA(1,62.49,LA76249_",",700)=HL("EID")_";"_HLMTIENS_";"_HL("EIDS")
"RTN","LA7VHL",153,0)
 D FILE^DIE("","FDA(1)","LA7ERR(1)")
"RTN","LA7VHL",154,0)
 ;
"RTN","LA7VHL",155,0)
 Q
"RTN","LA7VHL",156,0)
 ;
"RTN","LA7VHL",157,0)
 ;
"RTN","LA7VHL",158,0)
REJECT(LA7AR) ; Build a reject segment if the incoming message could not be processed.
"RTN","LA7VHL",159,0)
 ; Setting HLA("HLA",1) conforms to HL7 package rules for acknowledgements
"RTN","LA7VHL",160,0)
 ; LA7AR is a free text string that is included in the reject
"RTN","LA7VHL",161,0)
 ; message for debugging purposes.
"RTN","LA7VHL",162,0)
 ;
"RTN","LA7VHL",163,0)
 S HLA("HLA",1)="MSA"_LA7HLS("RFS")_"AR"_LA7HLS("RFS")_HL("MID")_LA7HLS("RFS")_LA7AR
"RTN","LA7VHL",164,0)
 S LA7AERR=LA7AR
"RTN","LA7VHL",165,0)
 Q
"RTN","LA7VHLU")
0^33^B42350744
"RTN","LA7VHLU",1,0)
LA7VHLU ;DALOI/JMC - HL7 segment builder utility ; 11-25-1998
"RTN","LA7VHLU",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,62,64**;Sep 27, 1994
"RTN","LA7VHLU",3,0)
 ;
"RTN","LA7VHLU",4,0)
 ; Reference to PROTOCOL file (#101) supported by DBIA #872
"RTN","LA7VHLU",5,0)
 ;
"RTN","LA7VHLU",6,0)
STARTMSG(LA7EVNT,LA76249) ; Create/initialize HL message
"RTN","LA7VHLU",7,0)
 ;
"RTN","LA7VHLU",8,0)
 ; Call with LA7EVNT = Lab event protocol in file (#101)
"RTN","LA7VHLU",9,0)
 ;           LA76249 = if entry already exists, do not create new entry
"RTN","LA7VHLU",10,0)
 ;
"RTN","LA7VHLU",11,0)
 N LA7MSH,X
"RTN","LA7VHLU",12,0)
 ;
"RTN","LA7VHLU",13,0)
 S LA76249=+$G(LA76249)
"RTN","LA7VHLU",14,0)
 D INITHL(LA7EVNT)
"RTN","LA7VHLU",15,0)
 I LA76249<1 S LA76249=$$INIT6249^LA7VHLU
"RTN","LA7VHLU",16,0)
 I $G(HL) D  Q
"RTN","LA7VHLU",17,0)
 . N LA7X
"RTN","LA7VHLU",18,0)
 . S LA7X(1)=LA76249,LA7X(2)=$TR(HL,"^","-")
"RTN","LA7VHLU",19,0)
 . D CREATE^LA7LOG(28)
"RTN","LA7VHLU",20,0)
 S X="MSH"_LA7FS_LA7ECH_LA7FS_HL("SAN")_LA7FS_HL("SAF")_LA7FS
"RTN","LA7VHLU",21,0)
 S $P(X,LA7FS,9)=HL("MTN")_$E(LA7ECH,1)_HL("ETN")
"RTN","LA7VHLU",22,0)
 S $P(X,LA7FS,11)=HL("PID")
"RTN","LA7VHLU",23,0)
 S $P(X,LA7FS,12)=HL("VER")
"RTN","LA7VHLU",24,0)
 S:$D(HL("ACAT")) $P(X,LA7FS,15)=HL("ACAT")
"RTN","LA7VHLU",25,0)
 S:$D(HL("APAT")) $P(X,LA7FS,16)=HL("APAT")
"RTN","LA7VHLU",26,0)
 S LA7MSH(0)=X
"RTN","LA7VHLU",27,0)
 D FILE6249^LA7VHLU(LA76249,.LA7MSH)
"RTN","LA7VHLU",28,0)
 ;
"RTN","LA7VHLU",29,0)
 Q
"RTN","LA7VHLU",30,0)
 ;
"RTN","LA7VHLU",31,0)
INITHL(LA7EVNT) ; Initialize HL environment
"RTN","LA7VHLU",32,0)
 ;
"RTN","LA7VHLU",33,0)
 ; Call with LA7EVNT = Lab event protocol in file (#101)
"RTN","LA7VHLU",34,0)
 ; HL7 v1.6 interface
"RTN","LA7VHLU",35,0)
 ; LA7101 - IEN of event protocol
"RTN","LA7VHLU",36,0)
 ; HL  - array of output parameters
"RTN","LA7VHLU",37,0)
 ; INT - DHCP-to-DHCP only
"RTN","LA7VHLU",38,0)
 ;
"RTN","LA7VHLU",39,0)
 K ^TMP("HLS",$J)
"RTN","LA7VHLU",40,0)
 K HL,HLCOMP,HLSUB,HLFS,HLERR,HLMID
"RTN","LA7VHLU",41,0)
 ;
"RTN","LA7VHLU",42,0)
 S LA7101=$O(^ORD(101,"B",LA7EVNT,0))
"RTN","LA7VHLU",43,0)
 D INIT^HLFNC2(LA7101,.HL,0)
"RTN","LA7VHLU",44,0)
 S (LA7FS,HLFS)=$G(HL("FS"))
"RTN","LA7VHLU",45,0)
 S (LA7ECH,HLECH)=$G(HL("ECH"))
"RTN","LA7VHLU",46,0)
 S HLCOMP=$E($G(HL("ECH")),1)
"RTN","LA7VHLU",47,0)
 S HLSUB=$E($G(HL("ECH")),4)
"RTN","LA7VHLU",48,0)
 Q
"RTN","LA7VHLU",49,0)
 ;
"RTN","LA7VHLU",50,0)
 ;
"RTN","LA7VHLU",51,0)
GEN ; Generate HL7 v1.6 message
"RTN","LA7VHLU",52,0)
 ; LA7101 - IEN of event protocol
"RTN","LA7VHLU",53,0)
 ; HLARYTYP - array type
"RTN","LA7VHLU",54,0)
 ; HLFORMAT - HLMA formatted/not formatted
"RTN","LA7VHLU",55,0)
 ; HLMTIEN - IEN in 772 (batch messages)
"RTN","LA7VHLU",56,0)
 ; HLRESLT = message ID^error code^error description
"RTN","LA7VHLU",57,0)
 ; HLP("CONTPTR") - continuation pointer field value
"RTN","LA7VHLU",58,0)
 ; HLP("PRIORITY") - priority field value
"RTN","LA7VHLU",59,0)
 ; HLP("NAMESPACE") - package namespace
"RTN","LA7VHLU",60,0)
 ; 
"RTN","LA7VHLU",61,0)
 N HLEID,HLARYTYP,HLFORMAT,HLMTIEN,HLRESLT,I
"RTN","LA7VHLU",62,0)
 S HLEID=LA7101,HLARYTYP="GM",HLFORMAT=1,HLMTIEN="",HLRESLT=""
"RTN","LA7VHLU",63,0)
 S HLP("NAMESPACE")="LA"
"RTN","LA7VHLU",64,0)
 D GENERATE^HLMA(HLEID,HLARYTYP,HLFORMAT,.HLRESLT,HLMTIEN,.HLP)
"RTN","LA7VHLU",65,0)
 K LA7MID M LA7MID=HLRESLT
"RTN","LA7VHLU",66,0)
 I $P(HLRESLT,"^",2)'="" D CREATE^LA7LOG(23)
"RTN","LA7VHLU",67,0)
 I $O(LA7MID(0)) D
"RTN","LA7VHLU",68,0)
 . S I=0
"RTN","LA7VHLU",69,0)
 . F  S I=$O(LA7MID(I)) Q:'I  I $L($P(LA7MID,"^",2)) S HLRESLT=LA7MID(I) D CREATE^LA7LOG(23)
"RTN","LA7VHLU",70,0)
 K HLP
"RTN","LA7VHLU",71,0)
 Q
"RTN","LA7VHLU",72,0)
 ;
"RTN","LA7VHLU",73,0)
 ;
"RTN","LA7VHLU",74,0)
BUILDSEG(LA7ARRAY,LA7DATA,LA7FS) ; Build HL segment
"RTN","LA7VHLU",75,0)
 ; Call with LA7ARRAY = array containing fields to build into a segment,
"RTN","LA7VHLU",76,0)
 ;                      passed by reference.
"RTN","LA7VHLU",77,0)
 ;            LA7DATA = array used to build segment, pass by reference
"RTN","LA7VHLU",78,0)
 ;                      used to return built segment.
"RTN","LA7VHLU",79,0)
 ;              LA7FS = HL field separator
"RTN","LA7VHLU",80,0)
 ;
"RTN","LA7VHLU",81,0)
 ; Returns         LA7DATA = array with segment built
"RTN","LA7VHLU",82,0)
 ;              LA7DATA(0) = if everything fits on one node
"RTN","LA7VHLU",83,0)
 ;         LA7DATA(0,1...) = multiple elements if >245 characters
"RTN","LA7VHLU",84,0)
 ;
"RTN","LA7VHLU",85,0)
 N LA7I,LA7J,LA7LAST,LA7SUB
"RTN","LA7VHLU",86,0)
 ;
"RTN","LA7VHLU",87,0)
 K LA7DATA
"RTN","LA7VHLU",88,0)
 ;
"RTN","LA7VHLU",89,0)
 S LA7FS=$G(LA7FS)
"RTN","LA7VHLU",90,0)
 ;
"RTN","LA7VHLU",91,0)
 ; Node to store data in array
"RTN","LA7VHLU",92,0)
 S LA7SUB=0
"RTN","LA7VHLU",93,0)
 ;
"RTN","LA7VHLU",94,0)
 ; Last element in array
"RTN","LA7VHLU",95,0)
 S LA7LAST=$O(LA7ARRAY(""),-1)
"RTN","LA7VHLU",96,0)
 ;
"RTN","LA7VHLU",97,0)
 F LA7I=0:1:LA7LAST D
"RTN","LA7VHLU",98,0)
 . I ($L($G(LA7DATA(LA7SUB)))+$L($G(LA7ARRAY(LA7I))))>245 S LA7SUB=LA7SUB+1
"RTN","LA7VHLU",99,0)
 . I $O(LA7ARRAY(LA7I,""))'="" D
"RTN","LA7VHLU",100,0)
 . . S LA7J=""
"RTN","LA7VHLU",101,0)
 . . F  S LA7J=$O(LA7ARRAY(LA7I,LA7J)) Q:LA7J=""  D
"RTN","LA7VHLU",102,0)
 . . . I ($L($G(LA7DATA(LA7SUB)))+$L($G(LA7ARRAY(LA7I,LA7J))))>245 S LA7SUB=LA7SUB+1
"RTN","LA7VHLU",103,0)
 . . . S LA7DATA(LA7SUB)=$G(LA7DATA(LA7SUB))_$G(LA7ARRAY(LA7I,LA7J))
"RTN","LA7VHLU",104,0)
 . S LA7DATA(LA7SUB)=$G(LA7DATA(LA7SUB))_$G(LA7ARRAY(LA7I))_LA7FS
"RTN","LA7VHLU",105,0)
 Q 
"RTN","LA7VHLU",106,0)
 ;
"RTN","LA7VHLU",107,0)
 ;
"RTN","LA7VHLU",108,0)
FILESEG(LA7ROOT,LA7DATA) ; File HL segment in global
"RTN","LA7VHLU",109,0)
 ; Call with  LA7ROOT = global root used to store HL segment
"RTN","LA7VHLU",110,0)
 ;            LA7DATA = array with data to file (pass by reference)
"RTN","LA7VHLU",111,0)
 ;
"RTN","LA7VHLU",112,0)
 N LA7HLSN,LA7I
"RTN","LA7VHLU",113,0)
 I $G(LA7ROOT)="" Q  ; no global root passed.
"RTN","LA7VHLU",114,0)
 ;
"RTN","LA7VHLU",115,0)
 ; get next subscript number
"RTN","LA7VHLU",116,0)
 S LA7HLSN=($O(@(LA7ROOT)@(""),-1))+1
"RTN","LA7VHLU",117,0)
 ;
"RTN","LA7VHLU",118,0)
 ; store first 245 characters of segment
"RTN","LA7VHLU",119,0)
 S @LA7ROOT@(LA7HLSN)=$G(LA7DATA(0))
"RTN","LA7VHLU",120,0)
 ;
"RTN","LA7VHLU",121,0)
 ; if segment >245 characters then store rest of message
"RTN","LA7VHLU",122,0)
 S LA7I=0
"RTN","LA7VHLU",123,0)
 F  S LA7I=$O(LA7DATA(LA7I)) Q:LA7I=""  S @LA7ROOT@(LA7HLSN,LA7I)=LA7DATA(LA7I)
"RTN","LA7VHLU",124,0)
 ;
"RTN","LA7VHLU",125,0)
 Q
"RTN","LA7VHLU",126,0)
 ;
"RTN","LA7VHLU",127,0)
 ;
"RTN","LA7VHLU",128,0)
INIT6249() ; Create stub entry in file #62.49
"RTN","LA7VHLU",129,0)
 ; Returns ien of entry in #62.49 that was created
"RTN","LA7VHLU",130,0)
 ; NOTE: set lock on entry in #62.49, does not release it.
"RTN","LA7VHLU",131,0)
 ;       calling process should release lock
"RTN","LA7VHLU",132,0)
 ;
"RTN","LA7VHLU",133,0)
 N LA7ERR,LA7FDA,LA7IEN,X,Y
"RTN","LA7VHLU",134,0)
 ;
"RTN","LA7VHLU",135,0)
 ; Lock zeroth node of file.
"RTN","LA7VHLU",136,0)
 L +^LAHM(62.49,0):99999
"RTN","LA7VHLU",137,0)
 I '$T Q -1
"RTN","LA7VHLU",138,0)
 ;
"RTN","LA7VHLU",139,0)
 F LA76249=$P(^LAHM(62.49,0),"^",3):1 Q:'$D(^LAHM(62.49,LA76249))
"RTN","LA7VHLU",140,0)
 ; Lock entry in file 62.49 - Calling process is responsible for releasing
"RTN","LA7VHLU",141,0)
 ; lock when no longer needed.
"RTN","LA7VHLU",142,0)
 L +^LAHM(62.49,LA76249):99999
"RTN","LA7VHLU",143,0)
 I '$T Q -1
"RTN","LA7VHLU",144,0)
 ;
"RTN","LA7VHLU",145,0)
 S LA7DT=$$NOW^XLFDT
"RTN","LA7VHLU",146,0)
 S LA7FDA(1,62.49,"+1,",.01)=LA76249 ; message number
"RTN","LA7VHLU",147,0)
 S LA7FDA(1,62.49,"+1,",2)="B" ; status =(B)uilding
"RTN","LA7VHLU",148,0)
 S LA7FDA(1,62.49,"+1,",4)=LA7DT ; Date/time entered
"RTN","LA7VHLU",149,0)
 S LA7IEN(1)=LA76249
"RTN","LA7VHLU",150,0)
 D UPDATE^DIE("S","LA7FDA(1)","LA7IEN","LA7ERR")
"RTN","LA7VHLU",151,0)
 I $D(LA7ERR) S LA76249=-1
"RTN","LA7VHLU",152,0)
 ;
"RTN","LA7VHLU",153,0)
 ; Unlock zero node
"RTN","LA7VHLU",154,0)
 L -^LAHM(62.49,0)
"RTN","LA7VHLU",155,0)
 Q LA76249
"RTN","LA7VHLU",156,0)
 ;
"RTN","LA7VHLU",157,0)
 ;
"RTN","LA7VHLU",158,0)
FILE6249(LA76249,LA7DATA) ; File HL segment in LAHM(62.49) global
"RTN","LA7VHLU",159,0)
 ; Call with  LA76249 = ien of entry in file # 62.49
"RTN","LA7VHLU",160,0)
 ;            LA7DATA = array with data to file (pass by reference)
"RTN","LA7VHLU",161,0)
 ;
"RTN","LA7VHLU",162,0)
 N LA7I,LA7J,LA7WP
"RTN","LA7VHLU",163,0)
 I '$G(LA76249) Q  ; no entry passed.
"RTN","LA7VHLU",164,0)
 ;
"RTN","LA7VHLU",165,0)
 ; move data in positive number subscripts
"RTN","LA7VHLU",166,0)
 S LA7I="",LA7J=0
"RTN","LA7VHLU",167,0)
 F  S LA7I=$O(LA7DATA(LA7I)) Q:LA7I=""  D
"RTN","LA7VHLU",168,0)
 . S LA7J=LA7J+1
"RTN","LA7VHLU",169,0)
 . S LA7WP(LA7J)=LA7DATA(LA7I)
"RTN","LA7VHLU",170,0)
 ;
"RTN","LA7VHLU",171,0)
 ; set blank line which separates each segment
"RTN","LA7VHLU",172,0)
 S LA7WP(LA7J+1)=""
"RTN","LA7VHLU",173,0)
 ;
"RTN","LA7VHLU",174,0)
 ; file data
"RTN","LA7VHLU",175,0)
 D WP^DIE(62.49,LA76249_",",150,"A","LA7WP")
"RTN","LA7VHLU",176,0)
 Q
"RTN","LA7VHLU",177,0)
 ;
"RTN","LA7VHLU",178,0)
 ;
"RTN","LA7VHLU",179,0)
P(LA7X,LA7P,LA7EC) ; get field LA7P from array (passed by ref.)
"RTN","LA7VHLU",180,0)
 ; Call with  LA7X = array to extract data from, pass by reference.
"RTN","LA7VHLU",181,0)
 ;            LA7P = field to extract
"RTN","LA7VHLU",182,0)
 ;           LA7EC = encoding character separator
"RTN","LA7VHLU",183,0)
 ;
"RTN","LA7VHLU",184,0)
 ; Returns LA7Y = value of requested piece
"RTN","LA7VHLU",185,0)
 ;
"RTN","LA7VHLU",186,0)
 N I,L,LA7Y,L1,Y
"RTN","LA7VHLU",187,0)
 S L=0,Y=1,LA7Y=""
"RTN","LA7VHLU",188,0)
 ;Y=begining piece of each node, L1=number of pieces in each node
"RTN","LA7VHLU",189,0)
 ;L=last piece in each node, quit when last piece is greater than LA7P
"RTN","LA7VHLU",190,0)
 F I=0:1 Q:'$D(LA7X(I))  S L1=$L(LA7X(I),LA7EC),L=L1+Y-1 D  Q:Y>LA7P
"RTN","LA7VHLU",191,0)
 . ;if LA7P is less than last piece, this node has field you want
"RTN","LA7VHLU",192,0)
 . S:LA7P'>L LA7Y=LA7Y_$P(LA7X(I),LA7EC,(LA7P-Y+1))
"RTN","LA7VHLU",193,0)
 . S Y=L
"RTN","LA7VHLU",194,0)
 Q LA7Y
"RTN","LA7VHLU",195,0)
 ;
"RTN","LA7VHLU",196,0)
 ;
"RTN","LA7VHLU",197,0)
PA(LA7X,LA7P,LA7EC,LA7Y) ; get field LA7P from array (passed by ref.)
"RTN","LA7VHLU",198,0)
 ; Call with  LA7X = array to extract data from, pass by reference.
"RTN","LA7VHLU",199,0)
 ;            LA7P = field to extract
"RTN","LA7VHLU",200,0)
 ;           LA7EC = encoding character separator
"RTN","LA7VHLU",201,0)
 ;
"RTN","LA7VHLU",202,0)
 ; Returns LA7Y = array value of requested piece (returned by reference)
"RTN","LA7VHLU",203,0)
 ;
"RTN","LA7VHLU",204,0)
 N I,L,L1,X,Y
"RTN","LA7VHLU",205,0)
 S (L,LA7Y)=0,Y=1
"RTN","LA7VHLU",206,0)
 ;Y=begining piece of each node, L1=number of pieces in each node
"RTN","LA7VHLU",207,0)
 ;L=last piece in each node, quit when last piece is greater than LA7P
"RTN","LA7VHLU",208,0)
 F I=0:1 Q:'$D(LA7X(I))  S L1=$L(LA7X(I),LA7EC),L=L1+Y-1 D  Q:Y>LA7P
"RTN","LA7VHLU",209,0)
 . ;if LA7P is less than last piece, this node has field you want
"RTN","LA7VHLU",210,0)
 . I LA7P'>L S X=$P(LA7X(I),LA7EC,(LA7P-Y+1)) S:X]"" LA7Y=LA7Y+1,LA7Y(LA7Y)=X
"RTN","LA7VHLU",211,0)
 . S Y=L
"RTN","LA7VHLU",212,0)
 Q
"RTN","LA7VHLU",213,0)
 ;
"RTN","LA7VHLU",214,0)
 ;
"RTN","LA7VHLU",215,0)
BLG(LA7ACTN,LA7CHGTY,LA7FS,LA7ECH) ; Build BLG segment -  billing information
"RTN","LA7VHLU",216,0)
 ; Call with  LA7ACTN = billing account Number
"RTN","LA7VHLU",217,0)
 ;           LA7CHGTY = charge type
"RTN","LA7VHLU",218,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VHLU",219,0)
 ;
"RTN","LA7VHLU",220,0)
 ; Returns LA7Y
"RTN","LA7VHLU",221,0)
 ;
"RTN","LA7VHLU",222,0)
 ; Default to CO (contract) for charge type - table 0122
"RTN","LA7VHLU",223,0)
 S LA7CHGTY=$G(LA7CHGTY,"CO")
"RTN","LA7VHLU",224,0)
 S LA7Y="BLG"_LA7FS_LA7FS_LA7CHGTY_LA7FS_$$M11^HLFNC(LA7ACTN,LA7ECH)_LA7FS
"RTN","LA7VHLU",225,0)
 Q LA7Y
"RTN","LA7VHLU",226,0)
 ;
"RTN","LA7VHLU",227,0)
 ;
"RTN","LA7VHLU",228,0)
PTEXTID(LA74,LA7UID,LA7Y) ; Retrieve patient's id that was transmitted by other system.
"RTN","LA7VHLU",229,0)
 ; Used to build PID-2 when returning results to placer.
"RTN","LA7VHLU",230,0)
 ; Looks in file LAB PENDING ORDERS (#69.6) for info pertaining to placer's order.
"RTN","LA7VHLU",231,0)
 ; Call with  LA74 = ien of placer in INSTITUTION file (#4)
"RTN","LA7VHLU",232,0)
 ;          LA7UID = placer's specimen identifier (UID, etc.)
"RTN","LA7VHLU",233,0)
 ;
"RTN","LA7VHLU",234,0)
 ; Returns array LA7Y by reference
"RTN","LA7VHLU",235,0)
 ;               LA7Y("FS")  - original field separator
"RTN","LA7VHLU",236,0)
 ;               LA7Y("ECH") - original encoding characters used
"RTN","LA7VHLU",237,0)
 ;             LA7Y("PID-2") - original PID-2 sequence
"RTN","LA7VHLU",238,0)
 ;             LA7Y("PID-4") - original PID-4 sequence
"RTN","LA7VHLU",239,0)
 ;
"RTN","LA7VHLU",240,0)
 N LA7696,LA7X
"RTN","LA7VHLU",241,0)
 ;
"RTN","LA7VHLU",242,0)
 S LA74=$G(LA74),LA7UID=$G(LA7UID),LA7Y=""
"RTN","LA7VHLU",243,0)
 ;
"RTN","LA7VHLU",244,0)
 ; Return null if no values passed
"RTN","LA7VHLU",245,0)
 I LA74<1!(LA7UID="") Q
"RTN","LA7VHLU",246,0)
 ;
"RTN","LA7VHLU",247,0)
 S LA7696=$O(^LRO(69.6,"RST",LA74,LA7UID,0))
"RTN","LA7VHLU",248,0)
 I LA7696 D
"RTN","LA7VHLU",249,0)
 . S LA7X=$G(^LRO(69.6,LA7696,700))
"RTN","LA7VHLU",250,0)
 . S LA7Y("FS")=$E(LA7X,1)
"RTN","LA7VHLU",251,0)
 . S LA7Y("ECH")=$E(LA7X,2,5)
"RTN","LA7VHLU",252,0)
 . S LA7Y("PID-2")=$G(^LRO(69.6,LA7696,700.02))
"RTN","LA7VHLU",253,0)
 . S LA7Y("PID-4")=$G(^LRO(69.6,LA7696,700.04))
"RTN","LA7VHLU",254,0)
 Q
"RTN","LA7VHLU",255,0)
 ;
"RTN","LA7VHLU",256,0)
 ;
"RTN","LA7VHLU",257,0)
RETOBR(LA74,LA7UID,LA7NLT,LA7Y) ; Retrieve placer's various OBR's that were transmitted by other system.
"RTN","LA7VHLU",258,0)
 ; Used to build OBR-4/17/18 when returning results to placer.
"RTN","LA7VHLU",259,0)
 ; Looks in file LAB PENDING ORDERS (#69.6) for info pertaining to placer's order.
"RTN","LA7VHLU",260,0)
 ;
"RTN","LA7VHLU",261,0)
 ; Call with   LA74 = ien of placer in INSTITUTION file (#4)
"RTN","LA7VHLU",262,0)
 ;           LA7UID = placer's specimen identifier (UID, accession number, etc.)
"RTN","LA7VHLU",263,0)
 ;           LA7NLT = ordered NLT test code
"RTN","LA7VHLU",264,0)
 ;
"RTN","LA7VHLU",265,0)
 ; Returns array LA7Y by reference
"RTN","LA7VHLU",266,0)
 ;               LA7Y("FS")     - original field separator
"RTN","LA7VHLU",267,0)
 ;               LA7Y("ECH")    - original encoding characters used
"RTN","LA7VHLU",268,0)
 ;               LA7Y("OBR-4")  - original OBR-4 sequence
"RTN","LA7VHLU",269,0)
 ;               LA7Y("OBR-18") - original OBR-18 sequence
"RTN","LA7VHLU",270,0)
 ;               LA7Y("OBR-19") - original OBR-19 sequence
"RTN","LA7VHLU",271,0)
 ;
"RTN","LA7VHLU",272,0)
 N LA7696,LA76964,LA7X
"RTN","LA7VHLU",273,0)
 ;
"RTN","LA7VHLU",274,0)
 S LA74=$G(LA74),LA7UID=$G(LA7UID),LA7Y=""
"RTN","LA7VHLU",275,0)
 ;
"RTN","LA7VHLU",276,0)
 ; Return null if no values passed
"RTN","LA7VHLU",277,0)
 I LA74<1!(LA7UID="")!(LA7NLT="") Q
"RTN","LA7VHLU",278,0)
 ;
"RTN","LA7VHLU",279,0)
 S LA7696=$O(^LRO(69.6,"RST",LA74,LA7UID,0))
"RTN","LA7VHLU",280,0)
 I LA7696<1 Q
"RTN","LA7VHLU",281,0)
 ;
"RTN","LA7VHLU",282,0)
 S LA7X=$G(^LRO(69.6,LA7696,700))
"RTN","LA7VHLU",283,0)
 S LA7Y("FS")=$E(LA7X,1)
"RTN","LA7VHLU",284,0)
 S LA7Y("ECH")=$E(LA7X,2,5)
"RTN","LA7VHLU",285,0)
 ;
"RTN","LA7VHLU",286,0)
 S LA76964=$O(^LRO(69.6,LA7696,2,"C",LA7NLT,0))
"RTN","LA7VHLU",287,0)
 I LA76964<1 Q
"RTN","LA7VHLU",288,0)
 ;
"RTN","LA7VHLU",289,0)
 S LA7Y("OBR-4")=$G(^LRO(69.6,LA7696,2,LA76964,700.04))
"RTN","LA7VHLU",290,0)
 S LA7Y("OBR-18")=$G(^LRO(69.6,LA7696,2,LA76964,700.18))
"RTN","LA7VHLU",291,0)
 S LA7Y("OBR-19")=$G(^LRO(69.6,LA7696,2,LA76964,700.19))
"RTN","LA7VHLU",292,0)
 ;
"RTN","LA7VHLU",293,0)
 Q
"RTN","LA7VHLU1")
0^43^B17496162
"RTN","LA7VHLU1",1,0)
LA7VHLU1 ;DALOI/JMC - HL7 segment builder utility ; 11-25-1998
"RTN","LA7VHLU1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,61,64**;Sep 27, 1994
"RTN","LA7VHLU1",3,0)
 ;
"RTN","LA7VHLU1",4,0)
 ;
"RTN","LA7VHLU1",5,0)
SETID(LA76249,LA7ID,LA7X) ; Setup identifier's in TMP global for later storing.
"RTN","LA7VHLU1",6,0)
 ; Call with LA76249 = ien of message in #62.49
"RTN","LA7VHLU1",7,0)
 ;             LA7ID = root of identifier
"RTN","LA7VHLU1",8,0)
 ;              LA7X = value to add to identifier
"RTN","LA7VHLU1",9,0)
 N Y
"RTN","LA7VHLU1",10,0)
 S Y=$O(^TMP("LA7-ID",$J,LA76249,""),-1) ; get last entry
"RTN","LA7VHLU1",11,0)
 S Y=Y+1
"RTN","LA7VHLU1",12,0)
 S ^TMP("LA7-ID",$J,LA76249,Y)=LA7ID_LA7X
"RTN","LA7VHLU1",13,0)
 Q
"RTN","LA7VHLU1",14,0)
 ;
"RTN","LA7VHLU1",15,0)
 ;
"RTN","LA7VHLU1",16,0)
UTS(LA7628,LA7UID,LA760) ; Update test status on manifest
"RTN","LA7VHLU1",17,0)
 ; Call with LA7628 = ien of shipping manifest in #62.8
"RTN","LA7VHLU1",18,0)
 ;           LA7UID = accession's UID
"RTN","LA7VHLU1",19,0)
 ;            LA760 = file # 60 ien of ordered test 
"RTN","LA7VHLU1",20,0)
 ;
"RTN","LA7VHLU1",21,0)
 ; Sets to status 4 (partial). Will deal with 5 (completed) at later time
"RTN","LA7VHLU1",22,0)
 ; when lab package has capability of designating an accession as completed.
"RTN","LA7VHLU1",23,0)
 ;
"RTN","LA7VHLU1",24,0)
 N LA762801,LA7X
"RTN","LA7VHLU1",25,0)
 ;
"RTN","LA7VHLU1",26,0)
 S LA762801=0
"RTN","LA7VHLU1",27,0)
 F  S LA762801=$O(^LAHM(62.8,LA7628,10,"UID",LA7UID,LA762801)) Q:'LA762801  D
"RTN","LA7VHLU1",28,0)
 . S LA7X=$G(^LAHM(62.8,LA7628,10,LA762801,0))
"RTN","LA7VHLU1",29,0)
 . I $P(LA7X,"^",2)'=LA760 Q  ; Not the test we're looking for.
"RTN","LA7VHLU1",30,0)
 . I $P(LA7X,"^",8)>2,$P(LA7X,"^",8)<5 D STSUP^LA7SMU(LA7628,LA762801,4)
"RTN","LA7VHLU1",31,0)
 Q
"RTN","LA7VHLU1",32,0)
 ;
"RTN","LA7VHLU1",33,0)
 ;
"RTN","LA7VHLU1",34,0)
UPID(LA76249) ; Update identifier's associated with the message in #62.49
"RTN","LA7VHLU1",35,0)
 ; Call with LA76249 = ien of message in #62.49
"RTN","LA7VHLU1",36,0)
 ;
"RTN","LA7VHLU1",37,0)
 N FDA,LA7CNT,LA7ERR,LA7I,LA7X
"RTN","LA7VHLU1",38,0)
 ;
"RTN","LA7VHLU1",39,0)
 S (LA7CNT,LA7I)=0
"RTN","LA7VHLU1",40,0)
 F  S LA7I=$O(^TMP("LA7-ID",$J,LA76249,LA7I)) Q:'LA7I  D
"RTN","LA7VHLU1",41,0)
 . S LA7CNT=LA7CNT+1
"RTN","LA7VHLU1",42,0)
 . S LA7X=^TMP("LA7-ID",$J,LA76249,LA7I)
"RTN","LA7VHLU1",43,0)
 . I LA7CNT=1 S FDA(1,62.49,LA76249_",",5)=LA7X
"RTN","LA7VHLU1",44,0)
 . ; Add code to store additional identifiers in new multiple field in #62.49
"RTN","LA7VHLU1",45,0)
 I $D(FDA(1)) D FILE^DIE("","FDA(1)","LA7ERR(1)")
"RTN","LA7VHLU1",46,0)
 ;
"RTN","LA7VHLU1",47,0)
 ; Clean up
"RTN","LA7VHLU1",48,0)
 K ^TMP("LA7-ID",$J,LA76249)
"RTN","LA7VHLU1",49,0)
 Q
"RTN","LA7VHLU1",50,0)
 ;
"RTN","LA7VHLU1",51,0)
 ;
"RTN","LA7VHLU1",52,0)
CHKDT(LA7X) ; Check validity of date/time
"RTN","LA7VHLU1",53,0)
 ; Adjust invalid times to closest valid time - correct for lab problem
"RTN","LA7VHLU1",54,0)
 ; that generated invalid FileMan date/times.
"RTN","LA7VHLU1",55,0)
 ; If hours>24 then set to 24 with no minutes/seconds
"RTN","LA7VHLU1",56,0)
 ; If minutes greater than 59 then set to 59
"RTN","LA7VHLU1",57,0)
 ; If seconds greater than 59 then set to 59
"RTN","LA7VHLU1",58,0)
 ;
"RTN","LA7VHLU1",59,0)
 N I,LA7Y,X
"RTN","LA7VHLU1",60,0)
 ;
"RTN","LA7VHLU1",61,0)
 S LA7Y=$P(LA7X,".",2)
"RTN","LA7VHLU1",62,0)
 ;
"RTN","LA7VHLU1",63,0)
 ; If time present then check otherwise skip and return input.
"RTN","LA7VHLU1",64,0)
 I $L(LA7Y) D
"RTN","LA7VHLU1",65,0)
 . F I=1:2:5 D
"RTN","LA7VHLU1",66,0)
 . . S LA7Y(I)=$E(LA7Y,I,I+1)
"RTN","LA7VHLU1",67,0)
 . . I $L(LA7Y(I))=1 S LA7Y(I)=LA7Y(I)_"0"
"RTN","LA7VHLU1",68,0)
 . . I LA7Y(I)>$S(I=1:24,1:59) S LA7Y(I)=$S(I=1:24,1:59)
"RTN","LA7VHLU1",69,0)
 . . I I=1,LA7Y(1)=24 S LA7Y=24
"RTN","LA7VHLU1",70,0)
 . S X="."_LA7Y(1)_LA7Y(3)_LA7Y(5),X=+X
"RTN","LA7VHLU1",71,0)
 . S $P(LA7X,".",2)=$P(X,".",2)
"RTN","LA7VHLU1",72,0)
 ;
"RTN","LA7VHLU1",73,0)
 Q LA7X
"RTN","LA7VHLU1",74,0)
 ;
"RTN","LA7VHLU1",75,0)
 ;
"RTN","LA7VHLU1",76,0)
REFUNIT(LA7SB,LA761) ; Find reference ranges/units from file #60
"RTN","LA7VHLU1",77,0)
 ; Call with LA7SB = dataname from "CH" subscript
"RTN","LA7VHLU1",78,0)
 ;           LA761 = pointer to topography file #61
"RTN","LA7VHLU1",79,0)
 ;
"RTN","LA7VHLU1",80,0)
 ;   Returns  LA7Y = reference low^reference high^units^critcal low^critcal high^therapeutic low^therapeutic high
"RTN","LA7VHLU1",81,0)
 ;
"RTN","LA7VHLU1",82,0)
 ; Finds first entry in file #60 that is associated with this dataname.
"RTN","LA7VHLU1",83,0)
 N LA760,LA7X,LA7Y
"RTN","LA7VHLU1",84,0)
 ;
"RTN","LA7VHLU1",85,0)
 S LA7Y=""
"RTN","LA7VHLU1",86,0)
 S LA760=+$O(^LAB(60,"C","CH;"_LA7SB_";1",0))
"RTN","LA7VHLU1",87,0)
 S LA7X=$G(^LAB(60,LA760,1,LA761,0))
"RTN","LA7VHLU1",88,0)
 S $P(LA7Y,"^")=$P(LA7X,"^",2)
"RTN","LA7VHLU1",89,0)
 S $P(LA7Y,"^",2)=$P(LA7X,"^",3)
"RTN","LA7VHLU1",90,0)
 S $P(LA7Y,"^",3)=$P(LA7X,"^",7)
"RTN","LA7VHLU1",91,0)
 S $P(LA7Y,"^",4)=$P(LA7X,"^",4)
"RTN","LA7VHLU1",92,0)
 S $P(LA7Y,"^",5)=$P(LA7X,"^",5)
"RTN","LA7VHLU1",93,0)
 S $P(LA7Y,"^",6)=$P(LA7X,"^",11)
"RTN","LA7VHLU1",94,0)
 S $P(LA7Y,"^",7)=$P(LA7X,"^",12)
"RTN","LA7VHLU1",95,0)
 ;
"RTN","LA7VHLU1",96,0)
 Q LA7Y
"RTN","LA7VHLU1",97,0)
 ;
"RTN","LA7VHLU1",98,0)
 ;
"RTN","LA7VHLU1",99,0)
OKTOSND(LRSS,LRSB,LA760) ; Check if test ok to send - is (O)utput or (B)oth
"RTN","LA7VHLU1",100,0)
 ; Call with LRSS = file #63 subscript
"RTN","LA7VHLU1",101,0)
 ;           LRSB = file #63 data name or field reference
"RTN","LA7VHLU1",102,0)
 ;          LA760 = file #60 ien
"RTN","LA7VHLU1",103,0)
 ;
"RTN","LA7VHLU1",104,0)
 ; Returns   LA7Y = 0-do not send, 1-yes-ok (default)
"RTN","LA7VHLU1",105,0)
 ;
"RTN","LA7VHLU1",106,0)
 N LA760,LA7X,LA7Y
"RTN","LA7VHLU1",107,0)
 S LA7Y=1
"RTN","LA7VHLU1",108,0)
 ;
"RTN","LA7VHLU1",109,0)
 ; If "CH" subscript check file #60 test's type that use this dataname
"RTN","LA7VHLU1",110,0)
 ; and if find one that is type "O" or "B" then set to yes.
"RTN","LA7VHLU1",111,0)
 I LRSS="CH" D
"RTN","LA7VHLU1",112,0)
 . I $G(LA760) D  Q
"RTN","LA7VHLU1",113,0)
 . . I "BO"'[$P(^LAB(60,LA760,0),"^",3) S LA7Y=0
"RTN","LA7VHLU1",114,0)
 . S (LA760,LA7X)=0
"RTN","LA7VHLU1",115,0)
 . F  S LA760=$O(^LAB(60,"C","CH;"_LRSB_";1",LA760)) Q:'LA760  D
"RTN","LA7VHLU1",116,0)
 . . I "BO"[$P(^LAB(60,LA760,0),"^",3) S LA7X=1
"RTN","LA7VHLU1",117,0)
 . S LA7Y=LA7X
"RTN","LA7VHLU1",118,0)
 ;
"RTN","LA7VHLU1",119,0)
 Q LA7Y
"RTN","LA7VHLU1",120,0)
 ;
"RTN","LA7VHLU1",121,0)
 ;
"RTN","LA7VHLU1",122,0)
FAMG(LA76248,LA7TYP) ; Find alert mail group for this alert type
"RTN","LA7VHLU1",123,0)
 ; Call with LA76248 = ien of entry in file #62.48
"RTN","LA7VHLU1",124,0)
 ;            LA7TYP = type of alert
"RTN","LA7VHLU1",125,0)
 ;                     (1-new results)
"RTN","LA7VHLU1",126,0)
 ;                     (2-error on message)
"RTN","LA7VHLU1",127,0)
 ;                     (3-orders received)
"RTN","LA7VHLU1",128,0)
 ;
"RTN","LA7VHLU1",129,0)
 ; Returns LA7MG = name of mail group
"RTN","LA7VHLU1",130,0)
 ;
"RTN","LA7VHLU1",131,0)
 N LA7MG,X,Y
"RTN","LA7VHLU1",132,0)
 S (LA7MG,X)=""
"RTN","LA7VHLU1",133,0)
 F  S X=$O(^LAHM(62.48,+$G(LA76248),20,"B",LA7TYP,X)) Q:'X  D
"RTN","LA7VHLU1",134,0)
 . S Y=$G(^LAHM(62.48,LA76248,20,X,0))
"RTN","LA7VHLU1",135,0)
 . I $P(Y,"^",2)'="" S LA7MG=$P(Y,"^",2) ; Send to mail group.
"RTN","LA7VHLU1",136,0)
 ;
"RTN","LA7VHLU1",137,0)
 ; Fail safe mail group when no mail group specified
"RTN","LA7VHLU1",138,0)
 I LA7MG="" S LA7MG="LAB MESSAGING"
"RTN","LA7VHLU1",139,0)
 ;
"RTN","LA7VHLU1",140,0)
 Q LA7MG
"RTN","LA7VHLU1",141,0)
 ;
"RTN","LA7VHLU1",142,0)
 ;
"RTN","LA7VHLU1",143,0)
ABFLAGS ;; HL7 Table 0078 Abnormal flags
"RTN","LA7VHLU1",144,0)
 ;;Below low normal;;
"RTN","LA7VHLU1",145,0)
 ;;Above high normal;;
"RTN","LA7VHLU1",146,0)
 ;;Below lower panic limits;;
"RTN","LA7VHLU1",147,0)
 ;;Above upper panic limits;;
"RTN","LA7VHLU1",148,0)
 ;;Below absolute low-off instrument scale;;
"RTN","LA7VHLU1",149,0)
 ;;Above absolute high-off instrument scale;;
"RTN","LA7VHLU1",150,0)
 ;;Normal;;
"RTN","LA7VHLU1",151,0)
 ;;Abnormal;;
"RTN","LA7VHLU1",152,0)
 ;;Very abnormal;;
"RTN","LA7VHLU1",153,0)
 ;;Significant change up;;
"RTN","LA7VHLU1",154,0)
 ;;Significant change down;;
"RTN","LA7VHLU1",155,0)
 ;;Better;;
"RTN","LA7VHLU1",156,0)
 ;;Worse;;
"RTN","LA7VHLU1",157,0)
 ;;Susceptible;;
"RTN","LA7VHLU1",158,0)
 ;;Resistant;;
"RTN","LA7VHLU1",159,0)
 ;;Intermediate;;
"RTN","LA7VHLU1",160,0)
 ;;Moderately susceptible;;
"RTN","LA7VHLU1",161,0)
 ;;Very susceptible;;
"RTN","LA7VHLU2")
0^6^B19775199
"RTN","LA7VHLU2",1,0)
LA7VHLU2 ;DALOI/JMC - HL7 Segment Utility ;01/19/99  13:48
"RTN","LA7VHLU2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,61,64**;Sep 27, 1994
"RTN","LA7VHLU2",3,0)
 ;
"RTN","LA7VHLU2",4,0)
 Q
"RTN","LA7VHLU2",5,0)
 ;
"RTN","LA7VHLU2",6,0)
GETSEG(LA76249,LA7NODE,LA7ARR) ; Returns the next segment from file 62.49
"RTN","LA7VHLU2",7,0)
 ;   during processing of an inbound message. The following variables
"RTN","LA7VHLU2",8,0)
 ;   are used for the processing.
"RTN","LA7VHLU2",9,0)
 ;
"RTN","LA7VHLU2",10,0)
 ; Call with  LA76249 - Entry in 62.49 where message is
"RTN","LA7VHLU2",11,0)
 ;            LA7NODE - Curent ien of "150" wp field
"RTN","LA7VHLU2",12,0)
 ;
"RTN","LA7VHLU2",13,0)
 ; Returns     LA7ARR - Data is returned in LA7ARR(0) and
"RTN","LA7VHLU2",14,0)
 ;                      LA7ARR(n) if segmemt is greater than 245 chars.
"RTN","LA7VHLU2",15,0)
 ;             LA7END - flag that end of message has been reached
"RTN","LA7VHLU2",16,0)
 ;
"RTN","LA7VHLU2",17,0)
 N LA7I,LA7END,LA7QUIT
"RTN","LA7VHLU2",18,0)
 K LA7ARR
"RTN","LA7VHLU2",19,0)
 S LA76249=+$G(LA76249),LA7NODE=$G(LA7NODE,0),(LA7END,LA7QUIT)=0
"RTN","LA7VHLU2",20,0)
 ;
"RTN","LA7VHLU2",21,0)
 S LA7NODE=$O(^LAHM(62.49,LA76249,150,LA7NODE))
"RTN","LA7VHLU2",22,0)
 I 'LA7NODE S LA7END=1
"RTN","LA7VHLU2",23,0)
 E  D
"RTN","LA7VHLU2",24,0)
 . S LA7ARR(0)=$G(^LAHM(62.49,LA76249,150,LA7NODE,0)),LA7I=0
"RTN","LA7VHLU2",25,0)
 . F  S LA7NODE=$O(^LAHM(62.49,LA76249,150,LA7NODE)) Q:'LA7NODE  D  Q:LA7QUIT
"RTN","LA7VHLU2",26,0)
 . . I $G(^LAHM(62.49,LA76249,150,LA7NODE,0))="" S LA7QUIT=1 Q
"RTN","LA7VHLU2",27,0)
 . . S LA7I=LA7I+1,LA7ARR(LA7I)=$G(^LAHM(62.49,LA76249,150,LA7NODE,0))
"RTN","LA7VHLU2",28,0)
 ;
"RTN","LA7VHLU2",29,0)
 Q LA7END
"RTN","LA7VHLU2",30,0)
 ;
"RTN","LA7VHLU2",31,0)
 ;
"RTN","LA7VHLU2",32,0)
FINDSITE(LA7Z,LA7TYPE,LA7SEM) ; Look up an institution in file #4
"RTN","LA7VHLU2",33,0)
 ;
"RTN","LA7VHLU2",34,0)
 ; Call with LA7Z = value to lookup 
"RTN","LA7VHLU2",35,0)
 ;                  VA: "VA"(optional) followed by 3-5 character VA site number
"RTN","LA7VHLU2",36,0)
 ;                  Non-VA uses 3-5 character site assigned identifier
"RTN","LA7VHLU2",37,0)
 ;          LA7TYPE = 1 (host facility)
"RTN","LA7VHLU2",38,0)
 ;                    2 (collection facility)
"RTN","LA7VHLU2",39,0)
 ;
"RTN","LA7VHLU2",40,0)
 ;           LA7SEM = 0 (log error message)
"RTN","LA7VHLU2",41,0)
 ;                    1 (suppress error message)
"RTN","LA7VHLU2",42,0)
 ;
"RTN","LA7VHLU2",43,0)
 ; Returns     LA7Y = ien of entry in INSTITUTION file (#4).
"RTN","LA7VHLU2",44,0)
 ;
"RTN","LA7VHLU2",45,0)
 N LA7X,LA7Y
"RTN","LA7VHLU2",46,0)
 ;
"RTN","LA7VHLU2",47,0)
 S LA7TYPE=$G(LA7TYPE),LA7Z=$G(LA7Z),LA7Y="",LA7SEM=$G(LA7SEM,1)
"RTN","LA7VHLU2",48,0)
 ;
"RTN","LA7VHLU2",49,0)
 ; If VA facility then strip off "VA" before lookup
"RTN","LA7VHLU2",50,0)
 I $E(LA7Z,1,2)="VA" S LA7X=$E(LA7Z,3,$L(LA7Z))
"RTN","LA7VHLU2",51,0)
 E  S LA7X=LA7Z
"RTN","LA7VHLU2",52,0)
 ;
"RTN","LA7VHLU2",53,0)
 ; Lookup in INSTITUTION file (#4)
"RTN","LA7VHLU2",54,0)
 ; If appears to be a VA station number
"RTN","LA7VHLU2",55,0)
 I LA7Z?1(3N,3.4N2U,3N1U1N) S LA7Y=$$IDX^XUAF4("VASTANUM",LA7Z)
"RTN","LA7VHLU2",56,0)
 ; If appears to be a DoD DMIS number
"RTN","LA7VHLU2",57,0)
 I LA7Z?4N S LA7Y=$$IDX^XUAF4("DMIS",LA7Z)
"RTN","LA7VHLU2",58,0)
 ; Else try anything
"RTN","LA7VHLU2",59,0)
 I 'LA7Y S LA7Y=$$FIND1^DIC(4,"","OMX",LA7X)
"RTN","LA7VHLU2",60,0)
 ;
"RTN","LA7VHLU2",61,0)
 ; If unable to find in INSTITUTION file (#4) then try looking in
"RTN","LA7VHLU2",62,0)
 ; SHIPPING CONFIGURATION file (#62.9) using non-VA identifier.
"RTN","LA7VHLU2",63,0)
 ; Check that entry is not a VA facility
"RTN","LA7VHLU2",64,0)
 I LA7Y'>0,LA7X]"" D
"RTN","LA7VHLU2",65,0)
 . N LA7J,LA7K
"RTN","LA7VHLU2",66,0)
 . S LA7J=0
"RTN","LA7VHLU2",67,0)
 . F  S LA7J=$O(^LAHM(62.9,LA7J)) Q:'LA7J  D  Q:LA7Y
"RTN","LA7VHLU2",68,0)
 . . S LA7J(0)=$G(^LAHM(62.9,LA7J,0))
"RTN","LA7VHLU2",69,0)
 . . I $P(LA7J(0),"^",4)'=1 Q  ; Not active
"RTN","LA7VHLU2",70,0)
 . . I $P(LA7J(0),"^",12)'=LA7X Q
"RTN","LA7VHLU2",71,0)
 . . S LA7K=$S(LA7TYPE=1:$P(LA7J(0),"^",3),LA7TYPE=2:$P(LA7J(0),"^",2),1:"")
"RTN","LA7VHLU2",72,0)
 . . I LA7K,$$NVAF(LA7K) S LA7Y=LA7K
"RTN","LA7VHLU2",73,0)
 ;
"RTN","LA7VHLU2",74,0)
 ; No entry found
"RTN","LA7VHLU2",75,0)
 I 'LA7SEM,LA7Y'>0 D
"RTN","LA7VHLU2",76,0)
 . N LA7SITE
"RTN","LA7VHLU2",77,0)
 . S LA7SITE=$S(LA7TYPE=1:"Host",LA7TYPE=2:"Collection",1:"type")_" site: "_$S(LA7Z]"":LA7Z,1:"Blank-no value")
"RTN","LA7VHLU2",78,0)
 . N LA7X,LA7Y,LA7Z
"RTN","LA7VHLU2",79,0)
 . D CREATE^LA7LOG(25)
"RTN","LA7VHLU2",80,0)
 ;
"RTN","LA7VHLU2",81,0)
 Q LA7Y
"RTN","LA7VHLU2",82,0)
 ;
"RTN","LA7VHLU2",83,0)
 ;
"RTN","LA7VHLU2",84,0)
RETFACID(LA7Z,LA7TYPE,LA7SEM) ; (RET)urn (FAC)ility (ID)entifier
"RTN","LA7VHLU2",85,0)
 ;
"RTN","LA7VHLU2",86,0)
 ; Call with LA7Z = ien of entry in INSTITUTION file (#4).
"RTN","LA7VHLU2",87,0)
 ;
"RTN","LA7VHLU2",88,0)
 ;          LA7TYPE = 1 (host facility)
"RTN","LA7VHLU2",89,0)
 ;                    2 (collecting facility)
"RTN","LA7VHLU2",90,0)
 ;
"RTN","LA7VHLU2",91,0)
 ;           LA7SEM = 0 (log error message)
"RTN","LA7VHLU2",92,0)
 ;                    1 (suppress error message)
"RTN","LA7VHLU2",93,0)
 ;
"RTN","LA7VHLU2",94,0)
 ; Returns     LA7Y = VA site number
"RTN","LA7VHLU2",95,0)
 ;                    non-VA site identifier
"RTN","LA7VHLU2",96,0)
 ;
"RTN","LA7VHLU2",97,0)
 N I,LA7NVAF,LA7X,LA7Y
"RTN","LA7VHLU2",98,0)
 S LA7Y="",LA7SEM=$G(LA7SEM,1)
"RTN","LA7VHLU2",99,0)
 ;
"RTN","LA7VHLU2",100,0)
 ; Check identifiers on file.
"RTN","LA7VHLU2",101,0)
 ; If DoD use DMIS code since some DoD also have VA station number.
"RTN","LA7VHLU2",102,0)
 S LA7NVAF=$$NVAF(LA7Z)
"RTN","LA7VHLU2",103,0)
 I LA7NVAF=0 S LA7Y=$$ID^XUAF4("VASTANUM",LA7Z)
"RTN","LA7VHLU2",104,0)
 I LA7NVAF=1 S LA7Y=$$ID^XUAF4("DMIS",LA7Z)
"RTN","LA7VHLU2",105,0)
 ;
"RTN","LA7VHLU2",106,0)
 ; If unable to find in INSTITUTION file (#4) then try looking in
"RTN","LA7VHLU2",107,0)
 ; SHIPPING CONFIGURATION file (#62.9) using non-VA identifier.
"RTN","LA7VHLU2",108,0)
 I LA7Y="" D
"RTN","LA7VHLU2",109,0)
 . N LA7J
"RTN","LA7VHLU2",110,0)
 . S LA7J=0
"RTN","LA7VHLU2",111,0)
 . F  S LA7J=$O(^LAHM(62.9,LA7J)) Q:'LA7J  D
"RTN","LA7VHLU2",112,0)
 . . S LA7J(0)=$G(^LAHM(62.9,LA7J,0))
"RTN","LA7VHLU2",113,0)
 . . I $P(LA7J(0),"^",4)'=1 Q  ; Not active
"RTN","LA7VHLU2",114,0)
 . . I LA7TYPE=1,LA7Z=$P(LA7J(0),"^",3) S LA7Y=$P(LA7J(0),"^",12)
"RTN","LA7VHLU2",115,0)
 . . I LA7TYPE=2,LA7Z=$P(LA7J(0),"^",2) S LA7Y=$P(LA7J(0),"^",12)
"RTN","LA7VHLU2",116,0)
 . I LA7Y'="" S LA7Y=$$UP^XLFSTR(LA7Y)
"RTN","LA7VHLU2",117,0)
 ;
"RTN","LA7VHLU2",118,0)
 ; No entry found
"RTN","LA7VHLU2",119,0)
 I 'LA7SEM,LA7Y="" D
"RTN","LA7VHLU2",120,0)
 . N LA7SITE
"RTN","LA7VHLU2",121,0)
 . S LA7SITE=$S(LA7TYPE=1:"Host",LA7TYPE=2:"Collection",1:"type")_" site: "_$$GET1^DIQ(4,LA7Z_",",.01)
"RTN","LA7VHLU2",122,0)
 . N LA7X,LA7Y
"RTN","LA7VHLU2",123,0)
 . D CREATE^LA7LOG(25)
"RTN","LA7VHLU2",124,0)
 ;
"RTN","LA7VHLU2",125,0)
 Q LA7Y
"RTN","LA7VHLU2",126,0)
 ;
"RTN","LA7VHLU2",127,0)
 ;
"RTN","LA7VHLU2",128,0)
FNDOLOC(LRUID) ; Find ordering location
"RTN","LA7VHLU2",129,0)
 ; Call with LRUID = Accession's UID
"RTN","LA7VHLU2",130,0)
 ; Returns    LA7Y = ordering location^ordering institution
"RTN","LA7VHLU2",131,0)
 ;
"RTN","LA7VHLU2",132,0)
 N LRAA,LRAD,LRAN,LA7X,LA7Y,X,Y
"RTN","LA7VHLU2",133,0)
 ;
"RTN","LA7VHLU2",134,0)
 S LA7Y=""
"RTN","LA7VHLU2",135,0)
 S X=$Q(^LRO(68,"C",LRUID))
"RTN","LA7VHLU2",136,0)
 I $QS(X,3)'=LRUID Q LA7Y
"RTN","LA7VHLU2",137,0)
 S LA7X=$P($G(^LRO(68,$QS(X,4),1,$QS(X,5),1,$QS(X,6),0)),"^",13)
"RTN","LA7VHLU2",138,0)
 I 'LA7X Q LA7Y
"RTN","LA7VHLU2",139,0)
 D GETS^DIQ(44,LA7X_",",".01;3","EI","LA7Y")
"RTN","LA7VHLU2",140,0)
 S LA7Y=LA7X_"^"_LA7Y(44,LA7X_",",.01,"E")_"^"_LA7Y(44,LA7X_",",3,"I")_"^"_LA7Y(44,LA7X_",",3,"E")
"RTN","LA7VHLU2",141,0)
 Q LA7Y
"RTN","LA7VHLU2",142,0)
 ;
"RTN","LA7VHLU2",143,0)
 ;
"RTN","LA7VHLU2",144,0)
CHKICN(LA7X) ; Lookup patient using ICN
"RTN","LA7VHLU2",145,0)
 ; Call with LA7X = patient's ICN
"RTN","LA7VHLU2",146,0)
 ; Returns   LA7Y = patient's DFN^full ICN
"RTN","LA7VHLU2",147,0)
 ;                  -1^error message
"RTN","LA7VHLU2",148,0)
 ;
"RTN","LA7VHLU2",149,0)
 ; Note - until MPI can handle full ICN (number,"V" and checksum) as lookup value
"RTN","LA7VHLU2",150,0)
 ; then confirm if full ICN passed in with full ICN from MPI.
"RTN","LA7VHLU2",151,0)
 ;
"RTN","LA7VHLU2",152,0)
 N LA7Y,LA7Z
"RTN","LA7VHLU2",153,0)
 ;
"RTN","LA7VHLU2",154,0)
 S (LA7Y,LA7Z)=""
"RTN","LA7VHLU2",155,0)
 S LA7X(1)=$P(LA7X,"V")
"RTN","LA7VHLU2",156,0)
 S LA7X(2)=$P(LA7X,"V",2)
"RTN","LA7VHLU2",157,0)
 I LA7X(2)="" S LA7Y=$$GETDFN^MPIF001(LA7X(1))
"RTN","LA7VHLU2",158,0)
 E  D
"RTN","LA7VHLU2",159,0)
 . S LA7Y=$$GETDFN^MPIF001(LA7X(1))
"RTN","LA7VHLU2",160,0)
 . S LA7Z=$$GETICN^MPIF001(LA7Y)
"RTN","LA7VHLU2",161,0)
 . I LA7X'=LA7Z S LA7Y="-1^Not a valid ICN"
"RTN","LA7VHLU2",162,0)
 ;
"RTN","LA7VHLU2",163,0)
 Q LA7Y_"^"_LA7Z
"RTN","LA7VHLU2",164,0)
 ;
"RTN","LA7VHLU2",165,0)
 ;
"RTN","LA7VHLU2",166,0)
NVAF(LA7X) ; Set flag sending to non-VA facility.
"RTN","LA7VHLU2",167,0)
 ; Used to code certain segments for other systems, i.e. CHCS-DOD.
"RTN","LA7VHLU2",168,0)
 ; Call with LA7X = ien of institution in file #4
"RTN","LA7VHLU2",169,0)
 ; Returns   LA7Y = 0 (VA facility)
"RTN","LA7VHLU2",170,0)
 ;                  1 (DoD facility - Army, Navy, Air Force)
"RTN","LA7VHLU2",171,0)
 ;                  2 (Indian Health Service)
"RTN","LA7VHLU2",172,0)
 ;                  3 (Other - non US Government)
"RTN","LA7VHLU2",173,0)
 ;
"RTN","LA7VHLU2",174,0)
 N LA7Y
"RTN","LA7VHLU2",175,0)
 S LA7Y=""
"RTN","LA7VHLU2",176,0)
 I LA7X S LA7Y=$$GET1^DIQ(4,LA7X_",",95,"I")
"RTN","LA7VHLU2",177,0)
 S LA7Y=$S(LA7Y="N":1,LA7Y="AF":1,LA7Y="ARMY":1,LA7Y="I":2,LA7Y="O":3,1:0)
"RTN","LA7VHLU2",178,0)
 Q LA7Y
"RTN","LA7VHLU3")
0^34^B15291257
"RTN","LA7VHLU3",1,0)
LA7VHLU3 ;DALOI/JMC - HL7 Segment Utility ;01/19/99  13:48
"RTN","LA7VHLU3",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VHLU3",3,0)
 ;
"RTN","LA7VHLU3",4,0)
 Q
"RTN","LA7VHLU3",5,0)
 ;
"RTN","LA7VHLU3",6,0)
NTE(LA7TXT,LA7TYP,LA7FS,LA7ECH,LA7NTESN) ; Build NTE segment -  notes and comments
"RTN","LA7VHLU3",7,0)
 ; Call with  LA7TXT = text to send
"RTN","LA7VHLU3",8,0)
 ;            LA7TYP = source of comment - HL table 0105
"RTN","LA7VHLU3",9,0)
 ;                     Default to L (ancilliary/filler)
"RTN","LA7VHLU3",10,0)
 ;             LA7FS = HL field separator
"RTN","LA7VHLU3",11,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VHLU3",12,0)
 ;          LA7NTESN = segment SET ID (pass by reference)
"RTN","LA7VHLU3",13,0)
 ;
"RTN","LA7VHLU3",14,0)
 ; Returns LA7Y - built segment
"RTN","LA7VHLU3",15,0)
 ;
"RTN","LA7VHLU3",16,0)
 N LA7Y
"RTN","LA7VHLU3",17,0)
 ;
"RTN","LA7VHLU3",18,0)
 S LA7FS=$G(LA7FS),LA7TXT=$G(LA7TXT)
"RTN","LA7VHLU3",19,0)
 ; Remove leading "~" from comments
"RTN","LA7VHLU3",20,0)
 I $E(LA7TXT,1)="~" S LA7TXT=$$TRIM^XLFSTR(LA7TXT,"L","~")
"RTN","LA7VHLU3",21,0)
 S LA7TXT=$$CHKDATA^LA7VHLU3(LA7TXT,LA7FS_LA7ECH)
"RTN","LA7VHLU3",22,0)
 ;
"RTN","LA7VHLU3",23,0)
 ; Update segment SET ID
"RTN","LA7VHLU3",24,0)
 S LA7NTESN=$G(LA7NTESN)+1
"RTN","LA7VHLU3",25,0)
 ;
"RTN","LA7VHLU3",26,0)
 ; Default source of comment if undefined
"RTN","LA7VHLU3",27,0)
 I $G(LA7TYP)="" S LA7TYP="L"
"RTN","LA7VHLU3",28,0)
 ;
"RTN","LA7VHLU3",29,0)
 S LA7Y="NTE"_LA7FS_LA7NTESN_LA7FS_LA7TYP_LA7FS_LA7TXT_LA7FS
"RTN","LA7VHLU3",30,0)
 ;
"RTN","LA7VHLU3",31,0)
 Q LA7Y
"RTN","LA7VHLU3",32,0)
 ;
"RTN","LA7VHLU3",33,0)
 ;
"RTN","LA7VHLU3",34,0)
CHKDATA(LA7IN,LA7CH) ; Check data to be built into an HL7 field for characters that
"RTN","LA7VHLU3",35,0)
 ; conflict with encoding characters. Convert conflicting character using HL7 escape encoding.
"RTN","LA7VHLU3",36,0)
 ;
"RTN","LA7VHLU3",37,0)
 ; Call with LA7IN = data to be checked
"RTN","LA7VHLU3",38,0)
 ;           LA7CH = HL7 delimiters to check for
"RTN","LA7VHLU3",39,0)
 ;
"RTN","LA7VHLU3",40,0)
 ; Returns LA7OUT - checked data, converted if appropriate
"RTN","LA7VHLU3",41,0)
 ;
"RTN","LA7VHLU3",42,0)
 N J,LA7DLIM,LA7ESC,LA7LEN,LA7OUT,X
"RTN","LA7VHLU3",43,0)
 ;
"RTN","LA7VHLU3",44,0)
 S LA7IN=$G(LA7IN),LA7CH=$G(LA7CH)
"RTN","LA7VHLU3",45,0)
 S LA7OUT=""
"RTN","LA7VHLU3",46,0)
 ;
"RTN","LA7VHLU3",47,0)
 I LA7IN=""!(LA7CH="") Q LA7OUT
"RTN","LA7VHLU3",48,0)
 ;
"RTN","LA7VHLU3",49,0)
 ; Build array of encoding characters to check
"RTN","LA7VHLU3",50,0)
 S LA7LEN=$L(LA7CH)
"RTN","LA7VHLU3",51,0)
 S LA7DLIM=$S(LA7LEN=5:"FSRET",1:"SRET")
"RTN","LA7VHLU3",52,0)
 S LA7ESC=$E(LA7CH,LA7LEN-1)
"RTN","LA7VHLU3",53,0)
 F J=1:1:LA7LEN S LA7CH($E(LA7CH,J))=$E(LA7DLIM,J)
"RTN","LA7VHLU3",54,0)
 ;
"RTN","LA7VHLU3",55,0)
 ; Check each character and convert if appropiate
"RTN","LA7VHLU3",56,0)
 F J=1:1:$L(LA7IN) D
"RTN","LA7VHLU3",57,0)
 . S X=$E(LA7IN,J)
"RTN","LA7VHLU3",58,0)
 . I $D(LA7CH(X)) S X=$$ENESC(LA7CH(X),LA7ESC)
"RTN","LA7VHLU3",59,0)
 . S LA7OUT=LA7OUT_X
"RTN","LA7VHLU3",60,0)
 ;
"RTN","LA7VHLU3",61,0)
 Q LA7OUT
"RTN","LA7VHLU3",62,0)
 ;
"RTN","LA7VHLU3",63,0)
 ;
"RTN","LA7VHLU3",64,0)
CNVFLD(LA7IN,LA7ECH1,LA7ECH2) ; Convert an encoded HL7 segment/field from one encoding scheme to another
"RTN","LA7VHLU3",65,0)
 ; Call with   LA7IN = data to be converted
"RTN","LA7VHLU3",66,0)
 ;           LA7ECH1 = delimiters of input
"RTN","LA7VHLU3",67,0)
 ;           LA7ECH2 = delimiters of output
"RTN","LA7VHLU3",68,0)
 ;
"RTN","LA7VHLU3",69,0)
 ; Returns LA7OUT - segment/field converted to new encoding scheme
"RTN","LA7VHLU3",70,0)
 ;
"RTN","LA7VHLU3",71,0)
 N J,LA7DLIM,LA7ECH,LA7ESC,LA7LEN,LA7OUT,X
"RTN","LA7VHLU3",72,0)
 ;
"RTN","LA7VHLU3",73,0)
 S LA7IN=$G(LA7IN),LA7ECH1=$G(LA7ECH1),LA7ECH2=$G(LA7ECH2)
"RTN","LA7VHLU3",74,0)
 S LA7OUT=""
"RTN","LA7VHLU3",75,0)
 ;
"RTN","LA7VHLU3",76,0)
 I LA7IN=""!(LA7ECH1="")!(LA7ECH2="") Q LA7OUT
"RTN","LA7VHLU3",77,0)
 ;
"RTN","LA7VHLU3",78,0)
 ; Abort if encoding schemes not equal length
"RTN","LA7VHLU3",79,0)
 I $L(LA7ECH1)'=$L(LA7ECH2) Q LA7OUT
"RTN","LA7VHLU3",80,0)
 ;
"RTN","LA7VHLU3",81,0)
 ; If same then return input as output
"RTN","LA7VHLU3",82,0)
 I LA7ECH1=LA7ECH2 Q LA7IN
"RTN","LA7VHLU3",83,0)
 ;
"RTN","LA7VHLU3",84,0)
 ; Determine position of HL7 ESCAPE encoding character
"RTN","LA7VHLU3",85,0)
 ; 4th position if field separator and encoding characters passed
"RTN","LA7VHLU3",86,0)
 ; 3rd position if only encoding characters passed
"RTN","LA7VHLU3",87,0)
 ; Based on length of input encoding character variable
"RTN","LA7VHLU3",88,0)
 S LA7LEN=$L(LA7ECH1)
"RTN","LA7VHLU3",89,0)
 S LA7DLIM=$S(LA7LEN=5:"FSRET",1:"SRET")
"RTN","LA7VHLU3",90,0)
 S LA7ESC=$E(LA7DLIM,LA7LEN-1)
"RTN","LA7VHLU3",91,0)
 ;
"RTN","LA7VHLU3",92,0)
 ; Build array to convert source encoding to target encoding
"RTN","LA7VHLU3",93,0)
 F J=1:1:$L(LA7ECH1) S LA7ECH($E(LA7ECH1,J))=$E(LA7ECH2,J)
"RTN","LA7VHLU3",94,0)
 ;
"RTN","LA7VHLU3",95,0)
 ; Check each character and convert if appropiate
"RTN","LA7VHLU3",96,0)
 ; If source conflicts with target encoding character
"RTN","LA7VHLU3",97,0)
 ;    then convert to escape encoding
"RTN","LA7VHLU3",98,0)
 ; If match on source encoding character - convert to new encoding
"RTN","LA7VHLU3",99,0)
 F J=1:1:$L(LA7IN) D
"RTN","LA7VHLU3",100,0)
 . S X=$E(LA7IN,J)
"RTN","LA7VHLU3",101,0)
 . I '$D(LA7ECH(X)),LA7ECH2[X S X=$$ENESC($E(LA7DLIM,($F(LA7ECH2,X)-1)),LA7ESC)
"RTN","LA7VHLU3",102,0)
 . I $D(LA7ECH(X)) S X=LA7ECH(X)
"RTN","LA7VHLU3",103,0)
 . S LA7OUT=LA7OUT_X
"RTN","LA7VHLU3",104,0)
 ;
"RTN","LA7VHLU3",105,0)
 Q LA7OUT
"RTN","LA7VHLU3",106,0)
 ;
"RTN","LA7VHLU3",107,0)
 ;
"RTN","LA7VHLU3",108,0)
ENESC(LA7X,LA7ESC) ; Encode data using HL7 escape encoding
"RTN","LA7VHLU3",109,0)
 ; Call with   LA7X = character to encode
"RTN","LA7VHLU3",110,0)
 ;           LA7ESC = HL7 escape encoding character
"RTN","LA7VHLU3",111,0)
 ;
"RTN","LA7VHLU3",112,0)
 ; Returns string of escape encoded data.
"RTN","LA7VHLU3",113,0)
 ;
"RTN","LA7VHLU3",114,0)
 N LA7Y
"RTN","LA7VHLU3",115,0)
 ;
"RTN","LA7VHLU3",116,0)
 S LA7Y=""
"RTN","LA7VHLU3",117,0)
 S LA7Y=LA7ESC_LA7X_LA7ESC
"RTN","LA7VHLU3",118,0)
 ;
"RTN","LA7VHLU3",119,0)
 Q LA7Y
"RTN","LA7VHLU3",120,0)
 ;
"RTN","LA7VHLU3",121,0)
 ;
"RTN","LA7VHLU3",122,0)
UNESC(LA7X,LA7CH) ; Unescape data using HL7 escape encoding
"RTN","LA7VHLU3",123,0)
 ; Call with  LA7X = string to decode
"RTN","LA7VHLU3",124,0)
 ;           LA7CH = HL7 delimiters (both field separator & encoding characters)
"RTN","LA7VHLU3",125,0)
 ;
"RTN","LA7VHLU3",126,0)
 ; Returns string of unencoded data.
"RTN","LA7VHLU3",127,0)
 ;
"RTN","LA7VHLU3",128,0)
 N J,LA7ESC,LA7DLIM,LA7LEN
"RTN","LA7VHLU3",129,0)
 ;
"RTN","LA7VHLU3",130,0)
 ; If data does not contain escape encoding then return input string as output
"RTN","LA7VHLU3",131,0)
 S LA7LEN=$L(LA7CH),LA7ESC=$E(LA7CH,LA7LEN-1)
"RTN","LA7VHLU3",132,0)
 I LA7X'[LA7ESC Q LA7X
"RTN","LA7VHLU3",133,0)
 ;
"RTN","LA7VHLU3",134,0)
 ; Build array of encoding characters to replace
"RTN","LA7VHLU3",135,0)
 S LA7DLIM=$S(LA7LEN=5:"FSRET",1:"SRET")
"RTN","LA7VHLU3",136,0)
 F J=1:1:LA7LEN S LA7CH(LA7ESC_$E(LA7DLIM,J)_LA7ESC)=$E(LA7CH,J)
"RTN","LA7VHLU3",137,0)
 ;
"RTN","LA7VHLU3",138,0)
 Q $$REPLACE^XLFSTR(LA7X,.LA7CH)
"RTN","LA7VHLU3",139,0)
 ;
"RTN","LA7VHLU3",140,0)
 ;
"RTN","LA7VHLU3",141,0)
UNESCFT(LA7X,LA7CH,LA7Y) ; Unescape formatted text data using HL7 escape encoding
"RTN","LA7VHLU3",142,0)
 ; Call with  LA7X = array to decode (pass by reference)
"RTN","LA7VHLU3",143,0)
 ;           LA7CH = HL7 delimiters (both field separator & encoding characters)
"RTN","LA7VHLU3",144,0)
 ;
"RTN","LA7VHLU3",145,0)
 ; Returns    LA7Y =  array of unencoded data.
"RTN","LA7VHLU3",146,0)
 ;
"RTN","LA7VHLU3",147,0)
 N J,K,LA7ESC,LA7I,LA7Z,SAVX,SAVY,Z
"RTN","LA7VHLU3",148,0)
 ;
"RTN","LA7VHLU3",149,0)
 S J=0,LA7ESC=$E(LA7CH,$L(LA7CH)-1),(LA7I,SAVX,SAVY)=""
"RTN","LA7VHLU3",150,0)
 F  S LA7I=$O(LA7X(LA7I)) Q:LA7I=""  D
"RTN","LA7VHLU3",151,0)
 . S J=J+1
"RTN","LA7VHLU3",152,0)
 . I LA7X(LA7I)'[LA7ESC,SAVY="" S LA7Y(J,0)=LA7X(LA7I) Q
"RTN","LA7VHLU3",153,0)
 . F K=1:1:$L(LA7X(LA7I)) D
"RTN","LA7VHLU3",154,0)
 . . S Z=$E(LA7X(LA7I),K)
"RTN","LA7VHLU3",155,0)
 . . I Z=LA7ESC D  Q
"RTN","LA7VHLU3",156,0)
 . . . I SAVY="" S SAVY=Z Q
"RTN","LA7VHLU3",157,0)
 . . . S SAVY=SAVY_Z
"RTN","LA7VHLU3",158,0)
 . . . I $P(SAVY,LA7ESC,2)=".br" S LA7Y(J,0)=$S(SAVX]"":SAVX,1:" "),SAVX="",J=J+1
"RTN","LA7VHLU3",159,0)
 . . . I $E(SAVY,2)'="." S SAVX=SAVX_$$UNESC(SAVY,LA7CH)
"RTN","LA7VHLU3",160,0)
 . . . S SAVY=""
"RTN","LA7VHLU3",161,0)
 . . I SAVY]"" S SAVY=SAVY_Z Q
"RTN","LA7VHLU3",162,0)
 . . S SAVX=SAVX_Z
"RTN","LA7VHLU3",163,0)
 . S LA7Y(J,0)=SAVX,SAVX=""
"RTN","LA7VHLU3",164,0)
 S LA7Y=J
"RTN","LA7VHLU3",165,0)
 ;
"RTN","LA7VHLU3",166,0)
 Q
"RTN","LA7VHLU4")
0^45^B25336667
"RTN","LA7VHLU4",1,0)
LA7VHLU4 ;DALOI/JMC - HL7 segment builder utility ; 11-25-1998
"RTN","LA7VHLU4",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VHLU4",3,0)
 ;
"RTN","LA7VHLU4",4,0)
 ; Reference to ^XMB global supported by DBIA #10091
"RTN","LA7VHLU4",5,0)
 ;
"RTN","LA7VHLU4",6,0)
INST(LA74,LA7FS,LA7ECH) ; Build institution field
"RTN","LA7VHLU4",7,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VHLU4",8,0)
 ;                    if null/undefined then use Kernel Site file.
"RTN","LA7VHLU4",9,0)
 ;            LA7FS = HL field separator
"RTN","LA7VHLU4",10,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VHLU4",11,0)
 ;
"RTN","LA7VHLU4",12,0)
 ; Returns facility that performed the testing (ID^text^99VA4)
"RTN","LA7VHLU4",13,0)
 ;
"RTN","LA7VHLU4",14,0)
 N LA7NVAF,LA7X,LA7Y,LA7Z
"RTN","LA7VHLU4",15,0)
 ;
"RTN","LA7VHLU4",16,0)
 S LA74=$G(LA74),LA7ECH=$G(LA7ECH),LA7Y=""
"RTN","LA7VHLU4",17,0)
 ;
"RTN","LA7VHLU4",18,0)
 ; If no institution, use Kernel Site default
"RTN","LA7VHLU4",19,0)
 I LA74="" S LA74=+$P($G(^XMB(1,1,"XUS")),U,17)
"RTN","LA7VHLU4",20,0)
 ;
"RTN","LA7VHLU4",21,0)
 ; Value passed not a pointer - only build 2nd component
"RTN","LA7VHLU4",22,0)
 I LA74'="",LA74'=+LA74 D
"RTN","LA7VHLU4",23,0)
 . S $P(LA7Y,$E(LA7ECH,1),2)=$$CHKDATA^LA7VHLU3(LA74,LA7FS_LA7ECH)
"RTN","LA7VHLU4",24,0)
 ;
"RTN","LA7VHLU4",25,0)
 I LA74>0,LA74=+LA74 D
"RTN","LA7VHLU4",26,0)
 . S LA7NVAF=$$NVAF^LA7VHLU2(LA74)
"RTN","LA7VHLU4",27,0)
 . ; Build id - VA station #/DMIS code
"RTN","LA7VHLU4",28,0)
 . I LA7NVAF<2 S LA7Y=$$ID^XUAF4($S(LA7NVAF=1:"DMIS",1:"VASTANUM"),LA74)
"RTN","LA7VHLU4",29,0)
 . ; Build name using field #100, otherwise #.01
"RTN","LA7VHLU4",30,0)
 . S LA7Z=$$NAME^XUAF4(LA74)
"RTN","LA7VHLU4",31,0)
 . S $P(LA7Y,$E(LA7ECH,1),2)=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VHLU4",32,0)
 . ;
"RTN","LA7VHLU4",33,0)
 . S $P(LA7Y,$E(LA7ECH,1),3)="99VA4"
"RTN","LA7VHLU4",34,0)
 ;
"RTN","LA7VHLU4",35,0)
 Q LA7Y
"RTN","LA7VHLU4",36,0)
 ;
"RTN","LA7VHLU4",37,0)
XCN(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build composite ID and name for person
"RTN","LA7VHLU4",38,0)
 ; Call with   LA7DUZ = DUZ of person 
"RTN","LA7VHLU4",39,0)
 ;                      If not pointer to #200, then use as literal
"RTN","LA7VHLU4",40,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VHLU4",41,0)
 ;              LA7FS = HL field separator
"RTN","LA7VHLU4",42,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VHLU4",43,0)
 ;           
"RTN","LA7VHLU4",44,0)
 ;
"RTN","LA7VHLU4",45,0)
 N LA7SITE,LA7VAF,LA7X,LA7Y,LA7Z,NAME
"RTN","LA7VHLU4",46,0)
 ;
"RTN","LA7VHLU4",47,0)
 S LA7Z=""
"RTN","LA7VHLU4",48,0)
 ;
"RTN","LA7VHLU4",49,0)
 ; Build from file #200
"RTN","LA7VHLU4",50,0)
 I LA7DUZ>0,LA7DUZ?1.N D
"RTN","LA7VHLU4",51,0)
 . S NAME("FILE")=200,NAME("FIELD")=.01,NAME("IENS")=LA7DUZ
"RTN","LA7VHLU4",52,0)
 . S LA7Z=$$HLNAME^XLFNAME(.NAME,"S",$E(LA7ECH))
"RTN","LA7VHLU4",53,0)
 . ; Commented out following lines, trying standardized name API above
"RTN","LA7VHLU4",54,0)
 . ;S LA7X=$$GET1^DIQ(200,LA7DUZ_",",.01)
"RTN","LA7VHLU4",55,0)
 . ;S LA7X=$$CHKDATA^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VHLU4",56,0)
 . ;S LA7Z=$$HLNAME^HLFNC(LA7X,LA7ECH)
"RTN","LA7VHLU4",57,0)
 . ; If no institution, use Kernel Site default
"RTN","LA7VHLU4",58,0)
 . I LA7DIV="" S LA7DIV=+$P($G(^XMB(1,1,"XUS")),U,17)
"RTN","LA7VHLU4",59,0)
 . S LA7SITE=$$RETFACID^LA7VHLU2(LA7DIV,0,1)
"RTN","LA7VHLU4",60,0)
 . I $L(LA7SITE) D
"RTN","LA7VHLU4",61,0)
 . . S LA7VAF=$$GET1^DIQ(4,LA7DIV_",","AGENCY CODE","I")
"RTN","LA7VHLU4",62,0)
 . . I LA7VAF="V" S LA7SITE="VA"_LA7SITE
"RTN","LA7VHLU4",63,0)
 . . S LA7DUZ=LA7DUZ_"-"_LA7SITE
"RTN","LA7VHLU4",64,0)
 . S $P(LA7Y,$E(LA7ECH))=LA7DUZ
"RTN","LA7VHLU4",65,0)
 ;
"RTN","LA7VHLU4",66,0)
 ; If only name passed
"RTN","LA7VHLU4",67,0)
 I 'LA7DUZ D
"RTN","LA7VHLU4",68,0)
 . S LA7DUZ=$$CHKDATA^LA7VHLU3(LA7DUZ,LA7FS_LA7ECH)
"RTN","LA7VHLU4",69,0)
 . S LA7Z=$$HLNAME^HLFNC(LA7DUZ,LA7ECH)
"RTN","LA7VHLU4",70,0)
 ;
"RTN","LA7VHLU4",71,0)
 S $P(LA7Y,$E(LA7ECH),2,7)=LA7Z
"RTN","LA7VHLU4",72,0)
 ;
"RTN","LA7VHLU4",73,0)
 Q LA7Y
"RTN","LA7VHLU4",74,0)
 ;
"RTN","LA7VHLU4",75,0)
 ;
"RTN","LA7VHLU4",76,0)
XAD(LA7FN,LA7DA,LA7DT,LA7FS,LA7ECH) ; Build extended address
"RTN","LA7VHLU4",77,0)
 ; Call with LA7FN = Source File number
"RTN","LA7VHLU4",78,0)
 ;                   Presently file #2 (PATIENT), #4 (INSTITUTION) or #200 (NEW PERSON)
"RTN","LA7VHLU4",79,0)
 ;           LA7DA = Entry in source file
"RTN","LA7VHLU4",80,0)
 ;           LA7DT = As of date in FileMan format
"RTN","LA7VHLU4",81,0)
 ;           LA7FS = HL field separator
"RTN","LA7VHLU4",82,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VHLU4",83,0)
 ;
"RTN","LA7VHLU4",84,0)
 ; Returns extended address
"RTN","LA7VHLU4",85,0)
 ;
"RTN","LA7VHLU4",86,0)
 N LA7X,LA7Y,LA7Z
"RTN","LA7VHLU4",87,0)
 ;
"RTN","LA7VHLU4",88,0)
 S LA7Y=""
"RTN","LA7VHLU4",89,0)
 ;
"RTN","LA7VHLU4",90,0)
 ; Build from file #2
"RTN","LA7VHLU4",91,0)
 I LA7FN=2,LA7DA D
"RTN","LA7VHLU4",92,0)
 . N DFN,VAHOW,VAPA,VAERR,VAROOT,VATEST
"RTN","LA7VHLU4",93,0)
 . S DFN=LA7DA
"RTN","LA7VHLU4",94,0)
 . I LA7DT S (VATEST("ADD",9),VATEST("ADD",10))=LA7DT
"RTN","LA7VHLU4",95,0)
 . D ADD^VADPT
"RTN","LA7VHLU4",96,0)
 . I VAERR Q
"RTN","LA7VHLU4",97,0)
 . S $P(LA7Y,$E(LA7ECH),1)=$$CHKDATA^LA7VHLU3(VAPA(1),LA7FS_LA7ECH)
"RTN","LA7VHLU4",98,0)
 . S $P(LA7Y,$E(LA7ECH),2)=$$CHKDATA^LA7VHLU3(VAPA(2),LA7FS_LA7ECH)
"RTN","LA7VHLU4",99,0)
 . S $P(LA7Y,$E(LA7ECH),3)=$$CHKDATA^LA7VHLU3(VAPA(4),LA7FS_LA7ECH)
"RTN","LA7VHLU4",100,0)
 . S $P(LA7Y,$E(LA7ECH),4)=$$CHKDATA^LA7VHLU3($P(VAPA(5),"^",2),LA7FS_LA7ECH)
"RTN","LA7VHLU4",101,0)
 . S $P(LA7Y,$E(LA7ECH),5)=$$CHKDATA^LA7VHLU3(VAPA(11),LA7FS_LA7ECH)
"RTN","LA7VHLU4",102,0)
 . I VAPA(9) S $P(LA7Y,$E(LA7ECH),7)="C"
"RTN","LA7VHLU4",103,0)
 . E  S $P(LA7Y,$E(LA7ECH),7)="P"
"RTN","LA7VHLU4",104,0)
 . S $P(LA7Y,$E(LA7ECH),9)=$$CHKDATA^LA7VHLU3($P(VAPA(7),"^",2),LA7FS_LA7ECH)
"RTN","LA7VHLU4",105,0)
 ;
"RTN","LA7VHLU4",106,0)
 I LA7FN=4,LA7DA D
"RTN","LA7VHLU4",107,0)
 . Q
"RTN","LA7VHLU4",108,0)
 ;
"RTN","LA7VHLU4",109,0)
 I LA7FN=200,LA7DA D
"RTN","LA7VHLU4",110,0)
 . Q
"RTN","LA7VHLU4",111,0)
 ;
"RTN","LA7VHLU4",112,0)
 Q LA7Y
"RTN","LA7VHLU4",113,0)
 ;
"RTN","LA7VHLU4",114,0)
 ;
"RTN","LA7VHLU4",115,0)
XON(LA7FN,LA7DA,LA7FS,LA7ECH) ; Build extended composite name/id for organization
"RTN","LA7VHLU4",116,0)
 ; Call with LA7FN = Source File number
"RTN","LA7VHLU4",117,0)
 ;                   Presently #4 (INSTITUTION)
"RTN","LA7VHLU4",118,0)
 ;           LA7DA = Entry in source file
"RTN","LA7VHLU4",119,0)
 ;           LA7FS = HL field separator
"RTN","LA7VHLU4",120,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VHLU4",121,0)
 ;           
"RTN","LA7VHLU4",122,0)
 ;
"RTN","LA7VHLU4",123,0)
 N LA7X,LA7Y,LA7Z
"RTN","LA7VHLU4",124,0)
 ;
"RTN","LA7VHLU4",125,0)
 S LA7Y=""
"RTN","LA7VHLU4",126,0)
 ;
"RTN","LA7VHLU4",127,0)
 I LA7FN=4,LA7DA D
"RTN","LA7VHLU4",128,0)
 . Q
"RTN","LA7VHLU4",129,0)
 ;
"RTN","LA7VHLU4",130,0)
 Q LA7Y
"RTN","LA7VHLU4",131,0)
 ;
"RTN","LA7VHLU4",132,0)
 ;
"RTN","LA7VHLU4",133,0)
XTN(LA7FN,LA7DA,LA7FS,LA7ECH) ; Build extended telecommunication number
"RTN","LA7VHLU4",134,0)
 ; Call with LA7FN = Source File number
"RTN","LA7VHLU4",135,0)
 ;                   Presently #4 (INSTITUTION)
"RTN","LA7VHLU4",136,0)
 ;           LA7DA = Entry in source file
"RTN","LA7VHLU4",137,0)
 ;           LA7FS = HL field separator
"RTN","LA7VHLU4",138,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VHLU4",139,0)
 ;           
"RTN","LA7VHLU4",140,0)
 ;
"RTN","LA7VHLU4",141,0)
 N LA7X,LA7Y,LA7Z
"RTN","LA7VHLU4",142,0)
 ;
"RTN","LA7VHLU4",143,0)
 S LA7Y=""
"RTN","LA7VHLU4",144,0)
 ;
"RTN","LA7VHLU4",145,0)
 I LA7FN=4,LA7DA D
"RTN","LA7VHLU4",146,0)
 . Q
"RTN","LA7VHLU4",147,0)
 ;
"RTN","LA7VHLU4",148,0)
 Q LA7Y
"RTN","LA7VHLU4",149,0)
 ;
"RTN","LA7VHLU4",150,0)
 ;
"RTN","LA7VHLU4",151,0)
XCNTFM(LA7X,LA7ECH) ; Resolve XCN data type to FileMan (last name, first name, mi [id])
"RTN","LA7VHLU4",152,0)
 ; Call with LA7X = HL7 field containing name
"RTN","LA7VHLU4",153,0)
 ;         LA7ECH = HL7 encoding characters
"RTN","LA7VHLU4",154,0)
 ;
"RTN","LA7VHLU4",155,0)
 ; Returns   LA7Y = ID code^DUZ^FileMan name (DUZ=0 if name not found on local system).
"RTN","LA7VHLU4",156,0)
 ;
"RTN","LA7VHLU4",157,0)
 N LA7DUZ,LA7IDC,LA7Y,LA7Z,X
"RTN","LA7VHLU4",158,0)
 ;
"RTN","LA7VHLU4",159,0)
 ; Check for coding that indicates DUZ from a VA facility
"RTN","LA7VHLU4",160,0)
 S LA7DUZ=0
"RTN","LA7VHLU4",161,0)
 S (LA7IDC,LA7Z)=$P(LA7X,$E(LA7ECH))
"RTN","LA7VHLU4",162,0)
 I LA7Z?.(1.N1"-VA"3N,1.N1"-VA"3N2U) D
"RTN","LA7VHLU4",163,0)
 . N LA7J,LA7K
"RTN","LA7VHLU4",164,0)
 . S LA7Z(1)=$P(LA7Z,"-"),LA7Z(2)=$P(LA7Z,"-",2)
"RTN","LA7VHLU4",165,0)
 . S LA7K=$$FINDSITE^LA7VHLU2(LA7Z(2),1,1)
"RTN","LA7VHLU4",166,0)
 . S LA7J=$$DIV4^XUSER(.LA7J,LA7Z(1))
"RTN","LA7VHLU4",167,0)
 . I LA7K,$D(LA7J(LA7K)) S LA7DUZ=LA7Z(1)
"RTN","LA7VHLU4",168,0)
 ;
"RTN","LA7VHLU4",169,0)
 ; Check if code resolves to a valid user.
"RTN","LA7VHLU4",170,0)
 I 'LA7DUZ,LA7Z=+LA7Z D
"RTN","LA7VHLU4",171,0)
 . S X=$$ACTIVE^XUSER(LA7Z)
"RTN","LA7VHLU4",172,0)
 . I X,$P(X,"^",2)'="" S LA7DUZ=LA7Z
"RTN","LA7VHLU4",173,0)
 ;
"RTN","LA7VHLU4",174,0)
 S LA7Y=$$FMNAME^HLFNC($P(LA7X,$E(LA7ECH),2,6),LA7ECH)
"RTN","LA7VHLU4",175,0)
 ; HL function sometimes returns trailing "," on name
"RTN","LA7VHLU4",176,0)
 S LA7Y=$$TRIM^XLFSTR(LA7Y,"R",",")
"RTN","LA7VHLU4",177,0)
 ;
"RTN","LA7VHLU4",178,0)
 ; Put identifying code at end of name in "[]".
"RTN","LA7VHLU4",179,0)
 I $P(LA7X,$E(LA7ECH))'="",LA7Y'="" S LA7Y=LA7Y_" ["_$P(LA7X,$E(LA7ECH))_"]"
"RTN","LA7VHLU4",180,0)
 ;
"RTN","LA7VHLU4",181,0)
 Q LA7IDC_"^"_LA7DUZ_"^"_LA7Y
"RTN","LA7VHLU4",182,0)
 ;
"RTN","LA7VHLU4",183,0)
 ;
"RTN","LA7VHLU4",184,0)
PLTFM(LA7PL,LA7ECH) ; Resolve location from PL (person location) data type.
"RTN","LA7VHLU4",185,0)
 ; Call with LA7PL = HL7 field containing person location
"RTN","LA7VHLU4",186,0)
 ;          LA7ECH = HL7 encoding characters
"RTN","LA7VHLU4",187,0)
 ;
"RTN","LA7VHLU4",188,0)
 ; Returns    LA7Y = file #44 ien^name field (#.01)^division(institution)
"RTN","LA7VHLU4",189,0)
 ;
"RTN","LA7VHLU4",190,0)
 N LA7X,LA7Y,X,Y
"RTN","LA7VHLU4",191,0)
 S LA7X=$P(LA7PL,$E(LA7ECH)),(LA7Y,Y)=""
"RTN","LA7VHLU4",192,0)
 I LA7X?1.N S Y=$$GET1^DIQ(44,LA7X_",",.01)
"RTN","LA7VHLU4",193,0)
 ; If not ien try as name
"RTN","LA7VHLU4",194,0)
 I Y="" D
"RTN","LA7VHLU4",195,0)
 . S X=$$FIND1^DIC(44,"","X",LA7X,"B")
"RTN","LA7VHLU4",196,0)
 . I X S Y=LA7X,LA7X=X
"RTN","LA7VHLU4",197,0)
 I Y'="" S LA7Y=LA7X_"^"_Y
"RTN","LA7VHLU4",198,0)
 E  I $P(LA7PL,$E(LA7ECH),2)'="" S LA7Y="^"_$P(LA7PL,$E(LA7ECH),2)
"RTN","LA7VHLU4",199,0)
 ; 
"RTN","LA7VHLU4",200,0)
 ; Process division (institution)
"RTN","LA7VHLU4",201,0)
 S LA7X=$P(LA7PL,$E(LA7ECH),4),Y=""
"RTN","LA7VHLU4",202,0)
 I LA7X'="" S Y=$$FINDSITE^LA7VHLU2(LA7X,1,1)
"RTN","LA7VHLU4",203,0)
 S $P(LA7Y,"^",3)=Y
"RTN","LA7VHLU4",204,0)
 ;
"RTN","LA7VHLU4",205,0)
 Q LA7Y
"RTN","LA7VHLU5")
0^7^B40473983
"RTN","LA7VHLU5",1,0)
LA7VHLU5 ;DALOI/JMC - HL7 segment builder utility ; 11-1-2000
"RTN","LA7VHLU5",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VHLU5",3,0)
 ;
"RTN","LA7VHLU5",4,0)
 ;
"RTN","LA7VHLU5",5,0)
DEFCODE(LRSS,LRSB,LA7CODE,LA761) ; Determine default codes when data is not mapped
"RTN","LA7VHLU5",6,0)
 ;
"RTN","LA7VHLU5",7,0)
 ; Call with  LRSS = file #63 subscript
"RTN","LA7VHLU5",8,0)
 ;            LRSB = file #63 dataname/location
"RTN","LA7VHLU5",9,0)
 ;         LA7CODE = current codes stored with data (order nlt!result nlt!loinc code!method suffix)
"RTN","LA7VHLU5",10,0)
 ;           LA761 = specimen, pointer to file #61
"RTN","LA7VHLU5",11,0)
 ;
"RTN","LA7VHLU5",12,0)
 N I,LA7DFCDE,LA7MISS
"RTN","LA7VHLU5",13,0)
 ;
"RTN","LA7VHLU5",14,0)
 I LA7CODE="" S LA7CODE="!!!"
"RTN","LA7VHLU5",15,0)
 ;
"RTN","LA7VHLU5",16,0)
 ; Replace any missing codes with defaults
"RTN","LA7VHLU5",17,0)
 ; If no missing codes then return codes passed in.
"RTN","LA7VHLU5",18,0)
 S LA7MISS=""
"RTN","LA7VHLU5",19,0)
 F I=1:1:3 I $P(LA7CODE,"!",I)="" S $P(LA7MISS,"^",I)=I
"RTN","LA7VHLU5",20,0)
 ;
"RTN","LA7VHLU5",21,0)
 I LA7MISS'="" D
"RTN","LA7VHLU5",22,0)
 . I LRSS="CH" D CHSUB Q
"RTN","LA7VHLU5",23,0)
 . I LRSS="MI" D MISUB Q
"RTN","LA7VHLU5",24,0)
 . I LRSS="SP" D SPSUB Q
"RTN","LA7VHLU5",25,0)
 . I LRSS="CY" D CYSUB Q
"RTN","LA7VHLU5",26,0)
 . I LRSS="EM" D EMSUB Q
"RTN","LA7VHLU5",27,0)
 ;
"RTN","LA7VHLU5",28,0)
 Q LA7CODE
"RTN","LA7VHLU5",29,0)
 ;
"RTN","LA7VHLU5",30,0)
 ;
"RTN","LA7VHLU5",31,0)
CHSUB ; Determine codes for CH subscript.
"RTN","LA7VHLU5",32,0)
 ;
"RTN","LA7VHLU5",33,0)
 N LA760,LA7NLT,LA7X,LA7Y
"RTN","LA7VHLU5",34,0)
 ;
"RTN","LA7VHLU5",35,0)
 ; Find a file #60 test which uses this dataname. Since there can be
"RTN","LA7VHLU5",36,0)
 ; multiple tests check each until an order and result NLT code is found.
"RTN","LA7VHLU5",37,0)
 S LA760=0
"RTN","LA7VHLU5",38,0)
 F  S LA760=$O(^LAB(60,"C",LRSS_";"_LRSB_";1",LA760)) Q:'LA760  D
"RTN","LA7VHLU5",39,0)
 . ; Default order NLT
"RTN","LA7VHLU5",40,0)
 . I $P(LA7MISS,"^") D
"RTN","LA7VHLU5",41,0)
 . . S LA7X=$$NLT^LRVER1(LA760)
"RTN","LA7VHLU5",42,0)
 . . I LA7X'="" S $P(LA7CODE,"!")=LA7X,$P(LA7MISS,"^")=""
"RTN","LA7VHLU5",43,0)
 . ; Default result NLT
"RTN","LA7VHLU5",44,0)
 . I $P(LA7MISS,"^",2) D
"RTN","LA7VHLU5",45,0)
 . . S LA7X=+$P($G(^LAB(60,LA760,64)),"^",2),LA7Y=""
"RTN","LA7VHLU5",46,0)
 . . I LA7X S LA7Y=$$GET1^DIQ(64,LA7X_",",1)
"RTN","LA7VHLU5",47,0)
 . . I LA7Y'="" S $P(LA7CODE,"!",2)=LA7Y,$P(LA7MISS,"^",2)=""
"RTN","LA7VHLU5",48,0)
 ;
"RTN","LA7VHLU5",49,0)
 ; If no result NLT code then use order NLT as default
"RTN","LA7VHLU5",50,0)
 I $P(LA7CODE,"!",2)="" S $P(LA7CODE,"!",2)=$P(LA7CODE,"!")
"RTN","LA7VHLU5",51,0)
 ;
"RTN","LA7VHLU5",52,0)
 ; If no order NLT code found on file #60 entries then use this default
"RTN","LA7VHLU5",53,0)
 I $P(LA7CODE,"!")="" S $P(LA7CODE,"!")="81323.0000"
"RTN","LA7VHLU5",54,0)
 ;
"RTN","LA7VHLU5",55,0)
 ; Default result LOINC code based on result NLT code
"RTN","LA7VHLU5",56,0)
 ; If none on NLT result code then try order NLT code
"RTN","LA7VHLU5",57,0)
 I $P(LA7MISS,"^",3) D
"RTN","LA7VHLU5",58,0)
 . S LA7NLT=$P(LA7CODE,"!",2),LA7X=""
"RTN","LA7VHLU5",59,0)
 . I LA7NLT'="" S LA7X=$$LNC^LRVER1(LA7NLT,$P(LA7CODE,"!",4),LA761)
"RTN","LA7VHLU5",60,0)
 . I LA7X S $P(LA7CODE,"!",3)=LA7X Q
"RTN","LA7VHLU5",61,0)
 . S LA7NLT=$P(LA7CODE,"!"),LA7X=""
"RTN","LA7VHLU5",62,0)
 . I LA7NLT'="" S LA7X=$$LNC^LRVER1(LA7NLT,$P(LA7CODE,"!",4),LA761)
"RTN","LA7VHLU5",63,0)
 . I LA7X S $P(LA7CODE,"!",3)=LA7X
"RTN","LA7VHLU5",64,0)
 ;
"RTN","LA7VHLU5",65,0)
 Q
"RTN","LA7VHLU5",66,0)
 ;
"RTN","LA7VHLU5",67,0)
 ;
"RTN","LA7VHLU5",68,0)
MISUB ; Determine codes for MI subscript
"RTN","LA7VHLU5",69,0)
 ;
"RTN","LA7VHLU5",70,0)
 ; Bacteriology report
"RTN","LA7VHLU5",71,0)
 I LRSB=11 S LA7DFCDE="87993.0000^^" D DEFAULT Q
"RTN","LA7VHLU5",72,0)
 ;
"RTN","LA7VHLU5",73,0)
 ; Gram stain
"RTN","LA7VHLU5",74,0)
 I LRSB=11.6 S LA7DFCDE="87993.0000^87754.0000^664" D DEFAULT Q
"RTN","LA7VHLU5",75,0)
 ;
"RTN","LA7VHLU5",76,0)
 ; Bacteriology organism
"RTN","LA7VHLU5",77,0)
 I LRSB=12 S LA7DFCDE="87993.0000^87570.0000^11475" D DEFAULT Q
"RTN","LA7VHLU5",78,0)
 ;
"RTN","LA7VHLU5",79,0)
 ; Bacteria colony count
"RTN","LA7VHLU5",80,0)
 I +LRSB=12,$P(LRSB,",",2)=1 S LA7DFCDE="^87719.0000^564" D DEFAULT Q
"RTN","LA7VHLU5",81,0)
 ;
"RTN","LA7VHLU5",82,0)
 ; Parasite report
"RTN","LA7VHLU5",83,0)
 I LRSB=14 S LA7DFCDE="87505.0000^^" D DEFAULT Q
"RTN","LA7VHLU5",84,0)
 ;
"RTN","LA7VHLU5",85,0)
 ; Parasite organism 
"RTN","LA7VHLU5",86,0)
 I LRSB=16 S LA7DFCDE="87505.0000^87576.0000^17784" D DEFAULT Q
"RTN","LA7VHLU5",87,0)
 ;
"RTN","LA7VHLU5",88,0)
 ; Mycology report
"RTN","LA7VHLU5",89,0)
 I LRSB=18 S LA7DFCDE="87994.0000^^" D DEFAULT Q
"RTN","LA7VHLU5",90,0)
 ;
"RTN","LA7VHLU5",91,0)
 ; Fungal organism
"RTN","LA7VHLU5",92,0)
 I LRSB=20 S LA7DFCDE="87994.0000^87578.0000^580" D DEFAULT Q
"RTN","LA7VHLU5",93,0)
 ;
"RTN","LA7VHLU5",94,0)
 ; Fungal colony count
"RTN","LA7VHLU5",95,0)
 I +LRSB=20,$P(LRSB,",",2)=1 S LA7DFCDE="87994.0000^87723.0000^19101" D DEFAULT Q
"RTN","LA7VHLU5",96,0)
 ;
"RTN","LA7VHLU5",97,0)
 ; Mycobacterium report
"RTN","LA7VHLU5",98,0)
 I LRSB=22 S LA7DFCDE="87995.0000^^" D DEFAULT Q
"RTN","LA7VHLU5",99,0)
 ;
"RTN","LA7VHLU5",100,0)
 ; Acid Fast stain
"RTN","LA7VHLU5",101,0)
 I LRSB=24 S LA7DFCDE="87995.0000^87756.0000^11545" D DEFAULT Q
"RTN","LA7VHLU5",102,0)
 ;
"RTN","LA7VHLU5",103,0)
 ; Acid Fast stain quantity
"RTN","LA7VHLU5",104,0)
 I LRSB=25 S LA7DFCDE="87995.0000^87583.0000^11545" D DEFAULT Q
"RTN","LA7VHLU5",105,0)
 ;
"RTN","LA7VHLU5",106,0)
 ; Mycobacterium organism
"RTN","LA7VHLU5",107,0)
 I +LRSB=26,'$P(LRSB,",",2) S LA7DFCDE="87995.0000^87589.0000^543" D DEFAULT Q
"RTN","LA7VHLU5",108,0)
 ;
"RTN","LA7VHLU5",109,0)
 ; Bact or TB organism's susceptibilities
"RTN","LA7VHLU5",110,0)
 I $P(LRSB,",",2)>2,$P(LRSB,",",2)<2.999 D  Q
"RTN","LA7VHLU5",111,0)
 . I +LRSB'=12,+LRSB'=26 Q
"RTN","LA7VHLU5",112,0)
 . S LA7X=$O(^LAB(62.06,"AD",$P(LRSB,",",2),0)) Q:'LA7X
"RTN","LA7VHLU5",113,0)
 . I $P(LA7MISS,"^",2) S $P(LA7CODE,"!",2)=$$GET1^DIQ(62.06,LA7X_",","64:1")
"RTN","LA7VHLU5",114,0)
 . I $P(LA7MISS,"^",3) S $P(LA7CODE,"!",3)=$$GET1^DIQ(62.06,LA7X_",","64:25")
"RTN","LA7VHLU5",115,0)
 ;
"RTN","LA7VHLU5",116,0)
 ; Virology report
"RTN","LA7VHLU5",117,0)
 I LRSB=33 S LA7DFCDE="87996.0000^^" D DEFAULT Q
"RTN","LA7VHLU5",118,0)
 ;
"RTN","LA7VHLU5",119,0)
 ; Viral agent
"RTN","LA7VHLU5",120,0)
 I $P(LRSB,",")=36 S LA7DFCDE="87996.0000^87590.0000^6584" D DEFAULT Q
"RTN","LA7VHLU5",121,0)
 ;
"RTN","LA7VHLU5",122,0)
 Q
"RTN","LA7VHLU5",123,0)
 ;
"RTN","LA7VHLU5",124,0)
 ;
"RTN","LA7VHLU5",125,0)
SPSUB ; Determine codes for SP subscript
"RTN","LA7VHLU5",126,0)
 ;
"RTN","LA7VHLU5",127,0)
 ; specimens
"RTN","LA7VHLU5",128,0)
 I LRSB=.012!(LRSB=10) S LA7DFCDE="88515.0000^88539.0000^22633" D DEFAULT Q
"RTN","LA7VHLU5",129,0)
 ;
"RTN","LA7VHLU5",130,0)
 ; brief clinical history
"RTN","LA7VHLU5",131,0)
 I LRSB=.013 S LA7DFCDE="88515.0000^88542.0000^22636" D DEFAULT Q
"RTN","LA7VHLU5",132,0)
 ;
"RTN","LA7VHLU5",133,0)
 ; preoperative diagnosis
"RTN","LA7VHLU5",134,0)
 I LRSB=.014 S LA7DFCDE="88515.0000^88544.0000^10219" D DEFAULT Q
"RTN","LA7VHLU5",135,0)
 ;
"RTN","LA7VHLU5",136,0)
 ; operative findings
"RTN","LA7VHLU5",137,0)
 I LRSB=.015 S LA7DFCDE="88515.0000^88546.0000^10215" D DEFAULT Q
"RTN","LA7VHLU5",138,0)
 ;
"RTN","LA7VHLU5",139,0)
 ; postoperative diagnosis
"RTN","LA7VHLU5",140,0)
 I LRSB=.016 S LA7DFCDE="88515.0000^88547.0000^10218" D DEFAULT Q
"RTN","LA7VHLU5",141,0)
 ;
"RTN","LA7VHLU5",142,0)
 ; gross description
"RTN","LA7VHLU5",143,0)
 I LRSB=1 S LA7DFCDE="88515.0000^88549.0000^22634" D DEFAULT Q
"RTN","LA7VHLU5",144,0)
 ;
"RTN","LA7VHLU5",145,0)
 ; microscopic description
"RTN","LA7VHLU5",146,0)
 I LRSB=1.1 S LA7DFCDE="88515.0000^88563.0000^22635" D DEFAULT Q
"RTN","LA7VHLU5",147,0)
 ;
"RTN","LA7VHLU5",148,0)
 ; frozen section
"RTN","LA7VHLU5",149,0)
 I LRSB=1.3 S LA7DFCDE="88515.0000^88569.0000^322635" D DEFAULT Q
"RTN","LA7VHLU5",150,0)
 ;
"RTN","LA7VHLU5",151,0)
 ; surgical path diagnosis
"RTN","LA7VHLU5",152,0)
 I LRSB=1.4 S LA7DFCDE="88515.0000^88571.0000^22637" D DEFAULT Q
"RTN","LA7VHLU5",153,0)
 ;
"RTN","LA7VHLU5",154,0)
 ; supplementary report
"RTN","LA7VHLU5",155,0)
 I LRSB=1.2!(LRSB="10,5") S LA7DFCDE="88515.0000^88589.0000^22639" D DEFAULT Q
"RTN","LA7VHLU5",156,0)
 ;
"RTN","LA7VHLU5",157,0)
 ; specimen weight
"RTN","LA7VHLU5",158,0)
 I LRSB="10,2" S LA7DFCDE="88515.0000^81233.0000^3154" D DEFAULT Q
"RTN","LA7VHLU5",159,0)
 ;
"RTN","LA7VHLU5",160,0)
 Q
"RTN","LA7VHLU5",161,0)
 ;
"RTN","LA7VHLU5",162,0)
 ;
"RTN","LA7VHLU5",163,0)
CYSUB ;  Determine codes for CY subscript
"RTN","LA7VHLU5",164,0)
 ;
"RTN","LA7VHLU5",165,0)
 ; specimens
"RTN","LA7VHLU5",166,0)
 I LRSB=.012 S LA7DFCDE="88593.0000^88539.0000^22633" D DEFAULT Q
"RTN","LA7VHLU5",167,0)
 ;
"RTN","LA7VHLU5",168,0)
 ; brief clinical history
"RTN","LA7VHLU5",169,0)
 I LRSB=.013 S LA7DFCDE="88593.0000^88542.0000^22636" D DEFAULT Q
"RTN","LA7VHLU5",170,0)
 ;
"RTN","LA7VHLU5",171,0)
 ; preoperative diagnosis
"RTN","LA7VHLU5",172,0)
 I LRSB=.014 S LA7DFCDE="88593.0000^88544.0000^10219" D DEFAULT Q
"RTN","LA7VHLU5",173,0)
 ;
"RTN","LA7VHLU5",174,0)
 ; operative findings
"RTN","LA7VHLU5",175,0)
 I LRSB=.015 S LA7DFCDE="88593.0000^88542.0000^10215" D DEFAULT Q
"RTN","LA7VHLU5",176,0)
 ;
"RTN","LA7VHLU5",177,0)
 ; postoperative diagnosis
"RTN","LA7VHLU5",178,0)
 I LRSB=.016 S LA7DFCDE="88593.0000^88547.0000^10218" D DEFAULT Q
"RTN","LA7VHLU5",179,0)
 ;
"RTN","LA7VHLU5",180,0)
 ; gross description
"RTN","LA7VHLU5",181,0)
 I LRSB=1!(LRSB=20) S LA7DFCDE="88593.0000^88549.0000^22634" D DEFAULT Q
"RTN","LA7VHLU5",182,0)
 ;
"RTN","LA7VHLU5",183,0)
 ; microscopic examination
"RTN","LA7VHLU5",184,0)
 I LRSB=1.1 S LA7DFCDE="88593.0000^88563.0000^22635" D DEFAULT Q
"RTN","LA7VHLU5",185,0)
 ;
"RTN","LA7VHLU5",186,0)
 ; supplementary report
"RTN","LA7VHLU5",187,0)
 I LRSB=1.2 S LA7DFCDE="88593.0000^88589.0000^22639" D DEFAULT Q
"RTN","LA7VHLU5",188,0)
 ;
"RTN","LA7VHLU5",189,0)
 ; cytopatholgy diagnosis
"RTN","LA7VHLU5",190,0)
 I LRSB=1.4 S LA7DFCDE="88593.0000^88571.0000^22637" D DEFAULT Q
"RTN","LA7VHLU5",191,0)
 ;
"RTN","LA7VHLU5",192,0)
 Q
"RTN","LA7VHLU5",193,0)
 ;
"RTN","LA7VHLU5",194,0)
 ;
"RTN","LA7VHLU5",195,0)
EMSUB ;  Determine codes for EM subscript
"RTN","LA7VHLU5",196,0)
 ;
"RTN","LA7VHLU5",197,0)
 ; specimens
"RTN","LA7VHLU5",198,0)
 I LRSB=.012 S LA7DFCDE="88597.0000^88057.0000^22633" D DEFAULT Q
"RTN","LA7VHLU5",199,0)
 ;
"RTN","LA7VHLU5",200,0)
 ; brief clinical history
"RTN","LA7VHLU5",201,0)
 I LRSB=.013 S LA7DFCDE="88597.0000^88542.0000^22636" D DEFAULT Q
"RTN","LA7VHLU5",202,0)
 ;
"RTN","LA7VHLU5",203,0)
 ; preoperative diagnosis
"RTN","LA7VHLU5",204,0)
 I LRSB=.014 S LA7DFCDE="88597.0000^88544.0000^10219" D DEFAULT Q
"RTN","LA7VHLU5",205,0)
 ;
"RTN","LA7VHLU5",206,0)
 ; operative findings
"RTN","LA7VHLU5",207,0)
 I LRSB=.015 S LA7DFCDE="88597.0000^88542.0000^10215" D DEFAULT Q
"RTN","LA7VHLU5",208,0)
 ;
"RTN","LA7VHLU5",209,0)
 ; postoperative diagnosis
"RTN","LA7VHLU5",210,0)
 I LRSB=.016 S LA7DFCDE="88597.0000^88547.0000^10218" D DEFAULT Q
"RTN","LA7VHLU5",211,0)
 ;
"RTN","LA7VHLU5",212,0)
 ; gross description
"RTN","LA7VHLU5",213,0)
 I LRSB=1!(LRSB=20) S LA7DFCDE="88597.0000^88549.0000^22634" D DEFAULT Q
"RTN","LA7VHLU5",214,0)
 ;
"RTN","LA7VHLU5",215,0)
 ; microscopic examination
"RTN","LA7VHLU5",216,0)
 I LRSB=1.1 S LA7DFCDE="88597.0000^88563.0000^22635" D DEFAULT Q
"RTN","LA7VHLU5",217,0)
 ;
"RTN","LA7VHLU5",218,0)
 ; supplementary report
"RTN","LA7VHLU5",219,0)
 I LRSB=1.2 S LA7DFCDE="88597.0000^88589.0000^22639" D DEFAULT Q
"RTN","LA7VHLU5",220,0)
 ;
"RTN","LA7VHLU5",221,0)
 ; em diagnosis
"RTN","LA7VHLU5",222,0)
 I LRSB=1.4 S LA7DFCDE="88597.0000^88571.0000^22637" D DEFAULT Q
"RTN","LA7VHLU5",223,0)
 ;
"RTN","LA7VHLU5",224,0)
 Q
"RTN","LA7VHLU5",225,0)
 ;
"RTN","LA7VHLU5",226,0)
 ;
"RTN","LA7VHLU5",227,0)
DEFAULT ; Resolve codes and set defaults as needed
"RTN","LA7VHLU5",228,0)
 ;
"RTN","LA7VHLU5",229,0)
 ; Expects LA7DFCDE=default order NLT^default result NLT^default LOINC code
"RTN","LA7VHLU5",230,0)
 ;
"RTN","LA7VHLU5",231,0)
 I $P(LA7MISS,"^") S $P(LA7CODE,"!")=$P(LA7DFCDE,"^")
"RTN","LA7VHLU5",232,0)
 I $P(LA7MISS,"^",2) S $P(LA7CODE,"!",2)=$P(LA7DFCDE,"^",2)
"RTN","LA7VHLU5",233,0)
 I $P(LA7MISS,"^",3) D
"RTN","LA7VHLU5",234,0)
 . S $P(LA7CODE,"!",3)=$$LNC^LRVER1($P(LA7CODE,"!",2),$P(LA7CODE,"!",4),LA761)
"RTN","LA7VHLU5",235,0)
 . I '$P(LA7CODE,"!",3) S $P(LA7CODE,"!",3)=$P(LA7DFCDE,"^",3)
"RTN","LA7VHLU5",236,0)
 Q
"RTN","LA7VIN1")
0^30^B40551903
"RTN","LA7VIN1",1,0)
LA7VIN1 ;DALOI/JMC - Process Incoming UI Msgs, continued ; 01/14/99
"RTN","LA7VIN1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VIN1",3,0)
 ; This routine is a continuation of LA7VIN and is only called from there.
"RTN","LA7VIN1",4,0)
 ; It is called with each message found in the incoming queue.  
"RTN","LA7VIN1",5,0)
 Q
"RTN","LA7VIN1",6,0)
 ;
"RTN","LA7VIN1",7,0)
NXTMSG ;
"RTN","LA7VIN1",8,0)
 N FDA,LA7ABORT,LA7CNT,LA7END,LA7ERR
"RTN","LA7VIN1",9,0)
 N LA7INDX,LA7QUIT,LA7SEG,LA7STYP
"RTN","LA7VIN1",10,0)
 ;
"RTN","LA7VIN1",11,0)
 S LA7ERR=""
"RTN","LA7VIN1",12,0)
 S (LA7ABORT,LA7CNT,LA7END,LA7INDX,LA7QUIT,LA7SEQ)=0
"RTN","LA7VIN1",13,0)
 S DT=$$DT^XLFDT
"RTN","LA7VIN1",14,0)
 S LA7ID="UNKNOWN-I-"
"RTN","LA7VIN1",15,0)
 ;
"RTN","LA7VIN1",16,0)
 ; Message built but no text.
"RTN","LA7VIN1",17,0)
 I '$O(^LAHM(62.49,LA76249,150,0)) D  Q
"RTN","LA7VIN1",18,0)
 . S (LA7ABORT,LA7ERR)=6
"RTN","LA7VIN1",19,0)
 . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN1",20,0)
 . D SETID^LA7VHLU1(LA76249,LA7ID,"UNKNOWN")
"RTN","LA7VIN1",21,0)
 ;
"RTN","LA7VIN1",22,0)
 ; Process message segments
"RTN","LA7VIN1",23,0)
 ; Lab currently does not accept segments beginning with the letter "Z"
"RTN","LA7VIN1",24,0)
 ; which are reserved for locally-defined messages. "Z" segments will be
"RTN","LA7VIN1",25,0)
 ; ignored by this software.
"RTN","LA7VIN1",26,0)
 F  S LA7END=$$GETSEG^LA7VHLU2(LA76249,.LA7INDX,.LA7SEG) Q:LA7END!(LA7ABORT)  D
"RTN","LA7VIN1",27,0)
 . S LA7STYP=$E(LA7SEG(0),1,3) ; Segment type
"RTN","LA7VIN1",28,0)
 . I $E(LA7STYP,1)="Z" Q
"RTN","LA7VIN1",29,0)
 . ; Not a valid segment type
"RTN","LA7VIN1",30,0)
 . I LA7STYP'?2U1UN D  Q
"RTN","LA7VIN1",31,0)
 . . S LA7ERR=34
"RTN","LA7VIN1",32,0)
 . . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN1",33,0)
 . ; Segment encoded wrong - field separator does not match
"RTN","LA7VIN1",34,0)
 . I "MSH^FSH^BHS^"'[(LA7STYP_"^"),$E(LA7SEG(0),4)'=LA7FS D  Q
"RTN","LA7VIN1",35,0)
 . . S LA7ERR=35
"RTN","LA7VIN1",36,0)
 . . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN1",37,0)
 . I $T(@LA7STYP)="" Q  ; No processing logic for this segment type
"RTN","LA7VIN1",38,0)
 . D @LA7STYP
"RTN","LA7VIN1",39,0)
 ;
"RTN","LA7VIN1",40,0)
 ; Set id if only MSH segment received.
"RTN","LA7VIN1",41,0)
 I LA7SEQ<5 D
"RTN","LA7VIN1",42,0)
 . D SETID^LA7VHLU1(LA76249,LA7ID,"UNKNOWN")
"RTN","LA7VIN1",43,0)
 ;
"RTN","LA7VIN1",44,0)
 ; Set status to purgeable if no errors.
"RTN","LA7VIN1",45,0)
 I $P($G(^LAHM(62.49,LA76249,0)),"^",3)'="E" D
"RTN","LA7VIN1",46,0)
 . S FDA(1,62.49,LA76249_",",2)="X"
"RTN","LA7VIN1",47,0)
 . D FILE^DIE("","FDA(1)","LA7ERR(1)")
"RTN","LA7VIN1",48,0)
 ;
"RTN","LA7VIN1",49,0)
 ; Store identifier's found in message.
"RTN","LA7VIN1",50,0)
 D UPID^LA7VHLU1(LA76249)
"RTN","LA7VIN1",51,0)
 ;
"RTN","LA7VIN1",52,0)
 ; Send new result alert for ORU messages if turned on.
"RTN","LA7VIN1",53,0)
 ; Currently only on LEDI (10) type interfaces.
"RTN","LA7VIN1",54,0)
 I $G(LA7MTYP)="ORU",$D(^LAHM(62.48,+$G(LA76248),20,"B",1)) D
"RTN","LA7VIN1",55,0)
 . I LA7INTYP=10,$D(^TMP("LA7-ORU",$J,LA76248)) D XQA^LA7UXQA(1,LA76248)
"RTN","LA7VIN1",56,0)
 ;
"RTN","LA7VIN1",57,0)
 ; Send new order alert for ORM messages if turned on.
"RTN","LA7VIN1",58,0)
 I $G(LA7MTYP)="ORM",$D(^LAHM(62.48,+$G(LA76248),20,"B",3)) D
"RTN","LA7VIN1",59,0)
 . N LA7ROOT
"RTN","LA7VIN1",60,0)
 . S LA7ROOT="^TMP(""LA7-ORM"",$J)"
"RTN","LA7VIN1",61,0)
 . F  S LA7ROOT=$Q(@LA7ROOT) Q:$QS(LA7ROOT,1)'="LA7-ORM"!($QS(LA7ROOT,2)'=$J)  D
"RTN","LA7VIN1",62,0)
 . . D XQA^LA7UXQA(3,$QS(LA7ROOT,3),"",$QS(LA7ROOT,4),"",$QS(LA7ROOT,5))
"RTN","LA7VIN1",63,0)
 ;
"RTN","LA7VIN1",64,0)
 ; Cleanup shipping config test info used to process orders
"RTN","LA7VIN1",65,0)
 I $G(LA7MTYP)="ORM" K ^TMP("LA7TC",$J)
"RTN","LA7VIN1",66,0)
 ;
"RTN","LA7VIN1",67,0)
 ; If amended results received then send bulletins
"RTN","LA7VIN1",68,0)
 I $D(^TMP("LA7 AMENDED RESULTS",$J)) D SENDARB^LA7VIN1A
"RTN","LA7VIN1",69,0)
 ;
"RTN","LA7VIN1",70,0)
 ; If cancelled orders received then send bulletins
"RTN","LA7VIN1",71,0)
 I $D(^TMP("LA7 ORDER STATUS",$J)) D SENDOSB^LA7VIN1A
"RTN","LA7VIN1",72,0)
 ;
"RTN","LA7VIN1",73,0)
 ; If units/normals changed then send bulletins
"RTN","LA7VIN1",74,0)
 I $D(^TMP("LA7 UNITS/NORMALS CHANGED",$J)) D SENDUNCB^LA7VIN1A
"RTN","LA7VIN1",75,0)
 ;
"RTN","LA7VIN1",76,0)
 ; If abnormal/critical results then send bulletins
"RTN","LA7VIN1",77,0)
 I $D(^TMP("LA7 ABNORMAL RESULTS",$J)) D SENDACB^LA7VIN1A
"RTN","LA7VIN1",78,0)
 ;
"RTN","LA7VIN1",79,0)
 D KILLMSH
"RTN","LA7VIN1",80,0)
 ;
"RTN","LA7VIN1",81,0)
 Q
"RTN","LA7VIN1",82,0)
 ;
"RTN","LA7VIN1",83,0)
 ;
"RTN","LA7VIN1",84,0)
MSA ;; Process MSA segment
"RTN","LA7VIN1",85,0)
 ;
"RTN","LA7VIN1",86,0)
 D KILLMSA
"RTN","LA7VIN1",87,0)
 ;
"RTN","LA7VIN1",88,0)
 D MSA^LA7VIN3
"RTN","LA7VIN1",89,0)
 ;
"RTN","LA7VIN1",90,0)
 ; Set sequence flag
"RTN","LA7VIN1",91,0)
 S LA7SEQ=5
"RTN","LA7VIN1",92,0)
 Q
"RTN","LA7VIN1",93,0)
 ;
"RTN","LA7VIN1",94,0)
 ;
"RTN","LA7VIN1",95,0)
BSH ;; Process various HL7 header segments
"RTN","LA7VIN1",96,0)
FSH ;;
"RTN","LA7VIN1",97,0)
MSH ;;
"RTN","LA7VIN1",98,0)
 D KILLMSH
"RTN","LA7VIN1",99,0)
 ;
"RTN","LA7VIN1",100,0)
 D MSH^LA7VIN2
"RTN","LA7VIN1",101,0)
 ;
"RTN","LA7VIN1",102,0)
 ; Set sequence flag
"RTN","LA7VIN1",103,0)
 S LA7SEQ=1
"RTN","LA7VIN1",104,0)
 Q
"RTN","LA7VIN1",105,0)
 ;
"RTN","LA7VIN1",106,0)
 ;
"RTN","LA7VIN1",107,0)
NTE ;; Process NTE segment
"RTN","LA7VIN1",108,0)
 ;
"RTN","LA7VIN1",109,0)
 I LA7SEQ<30 D  Q
"RTN","LA7VIN1",110,0)
 . ; Put code to log error - no OBR/OBX segment
"RTN","LA7VIN1",111,0)
 ;
"RTN","LA7VIN1",112,0)
 ; Flag set that there was problem with OBR segment,
"RTN","LA7VIN1",113,0)
 ; skip associated NTE segments that follow OBR/OBX segments
"RTN","LA7VIN1",114,0)
 I LA7QUIT=2 Q
"RTN","LA7VIN1",115,0)
 ;
"RTN","LA7VIN1",116,0)
 I LA7MTYP="ORU" D NTE^LA7VIN2
"RTN","LA7VIN1",117,0)
 I LA7MTYP="ORM" D NTE^LA7VIN2
"RTN","LA7VIN1",118,0)
 I LA7MTYP="ORR" D NTE^LA7VIN2
"RTN","LA7VIN1",119,0)
 ;
"RTN","LA7VIN1",120,0)
 Q
"RTN","LA7VIN1",121,0)
 ;
"RTN","LA7VIN1",122,0)
 ;
"RTN","LA7VIN1",123,0)
OBR ;; Process OBR segment
"RTN","LA7VIN1",124,0)
 ;
"RTN","LA7VIN1",125,0)
 D KILLOBR
"RTN","LA7VIN1",126,0)
 ;
"RTN","LA7VIN1",127,0)
 ; Clear flag to process this segment
"RTN","LA7VIN1",128,0)
 I LA7QUIT=2 S LA7QUIT=0
"RTN","LA7VIN1",129,0)
 ;
"RTN","LA7VIN1",130,0)
 ; If not UI interface and no PID segment
"RTN","LA7VIN1",131,0)
 I LA7INTYP'=1,LA7SEQ<10 D  Q
"RTN","LA7VIN1",132,0)
 . S (LA7ABORT,LA7ERR)=46
"RTN","LA7VIN1",133,0)
 . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN1",134,0)
 ;
"RTN","LA7VIN1",135,0)
 I LA7MTYP="ORR" D OBR^LA7VIN4
"RTN","LA7VIN1",136,0)
 I LA7MTYP="ORU" D OBR^LA7VIN4
"RTN","LA7VIN1",137,0)
 I LA7MTYP="ORM" D OBR^LA7VORM
"RTN","LA7VIN1",138,0)
 ;
"RTN","LA7VIN1",139,0)
 ; Set sequence flag
"RTN","LA7VIN1",140,0)
 S LA7SEQ=30
"RTN","LA7VIN1",141,0)
 Q
"RTN","LA7VIN1",142,0)
 ;
"RTN","LA7VIN1",143,0)
 ;
"RTN","LA7VIN1",144,0)
OBX ;; Process OBX segment
"RTN","LA7VIN1",145,0)
 ;
"RTN","LA7VIN1",146,0)
 D KILLOBX
"RTN","LA7VIN1",147,0)
 ;
"RTN","LA7VIN1",148,0)
 ; No OBR segment, can't process OBX
"RTN","LA7VIN1",149,0)
 I LA7SEQ<30 D  Q
"RTN","LA7VIN1",150,0)
 . S (LA7ABORT,LA7ERR)=9
"RTN","LA7VIN1",151,0)
 . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN1",152,0)
 ;
"RTN","LA7VIN1",153,0)
 ; Flag set that there was problem with OBR segment,
"RTN","LA7VIN1",154,0)
 ; skip associated OBX segments that follow OBR segment
"RTN","LA7VIN1",155,0)
 I LA7QUIT=2 Q
"RTN","LA7VIN1",156,0)
 ;
"RTN","LA7VIN1",157,0)
 ; Process result messages (ORU).
"RTN","LA7VIN1",158,0)
 I LA7MTYP="ORU" D
"RTN","LA7VIN1",159,0)
 . ; Process "CH" subscript results.
"RTN","LA7VIN1",160,0)
 . I $G(LA7SS)="CH" D
"RTN","LA7VIN1",161,0)
 . . I '$G(LA7ISQN) Q  ; No place to store results
"RTN","LA7VIN1",162,0)
 . . D OBX^LA7VIN5
"RTN","LA7VIN1",163,0)
 . ;
"RTN","LA7VIN1",164,0)
 . ; Process "AP" subscript results.
"RTN","LA7VIN1",165,0)
 . ;I $G(LA7SS)="AP",$L($T(OBX^LA7VIN6)) D OBX^LA7VIN6
"RTN","LA7VIN1",166,0)
 . ;
"RTN","LA7VIN1",167,0)
 . ; Process "MI" subscript results.
"RTN","LA7VIN1",168,0)
 . ;I $G(LA7SS)="MI" D OBX^LA7VIN7
"RTN","LA7VIN1",169,0)
 . ;
"RTN","LA7VIN1",170,0)
 . ; Process "BB" subscript results.
"RTN","LA7VIN1",171,0)
 . ;I $G(LA7SS)="BB",$L($T(OBX^LA7VIN8)) D OBX^LA7VIN8
"RTN","LA7VIN1",172,0)
 . ;
"RTN","LA7VIN1",173,0)
 . ; Update test status on manifest
"RTN","LA7VIN1",174,0)
 . I $G(LA7628),LA7UID'="",$G(LA7OTST) D UTS^LA7VHLU1(LA7628,LA7UID,LA7OTST)
"RTN","LA7VIN1",175,0)
 ;
"RTN","LA7VIN1",176,0)
 ; Process results that accompany orders
"RTN","LA7VIN1",177,0)
 I LA7MTYP="ORM" D OBX^LA7VIN5
"RTN","LA7VIN1",178,0)
 ;
"RTN","LA7VIN1",179,0)
 ; Set sequence flag
"RTN","LA7VIN1",180,0)
 S LA7SEQ=40
"RTN","LA7VIN1",181,0)
 Q
"RTN","LA7VIN1",182,0)
 ;
"RTN","LA7VIN1",183,0)
 ;
"RTN","LA7VIN1",184,0)
ORC ;; Process ORC segment
"RTN","LA7VIN1",185,0)
 ;
"RTN","LA7VIN1",186,0)
 D KILLORC
"RTN","LA7VIN1",187,0)
 ;
"RTN","LA7VIN1",188,0)
 ; If not UI interface and no PID segment
"RTN","LA7VIN1",189,0)
 I LA7INTYP'=1,LA7SEQ<10 D  Q
"RTN","LA7VIN1",190,0)
 . S (LA7ABORT,LA7ERR)=46
"RTN","LA7VIN1",191,0)
 . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN1",192,0)
 ;
"RTN","LA7VIN1",193,0)
 D ORC^LA7VIN2
"RTN","LA7VIN1",194,0)
 ;
"RTN","LA7VIN1",195,0)
 ; Set sequence flag
"RTN","LA7VIN1",196,0)
 S LA7SEQ=20
"RTN","LA7VIN1",197,0)
 Q
"RTN","LA7VIN1",198,0)
 ;
"RTN","LA7VIN1",199,0)
 ;
"RTN","LA7VIN1",200,0)
PID ;; Process PID segment
"RTN","LA7VIN1",201,0)
 ;
"RTN","LA7VIN1",202,0)
 D KILLPID
"RTN","LA7VIN1",203,0)
 ;
"RTN","LA7VIN1",204,0)
 ; no MSH segment
"RTN","LA7VIN1",205,0)
 I LA7SEQ<1 D  Q
"RTN","LA7VIN1",206,0)
 . S (LA7ABORT,LA7ERR)=7
"RTN","LA7VIN1",207,0)
 . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN1",208,0)
 ;
"RTN","LA7VIN1",209,0)
 ; Clear flag to process this segment
"RTN","LA7VIN1",210,0)
 I LA7QUIT=1 S LA7QUIT=0
"RTN","LA7VIN1",211,0)
 ;
"RTN","LA7VIN1",212,0)
 D PID^LA7VIN2
"RTN","LA7VIN1",213,0)
 ;
"RTN","LA7VIN1",214,0)
 ; Set sequence flag
"RTN","LA7VIN1",215,0)
 S LA7SEQ=10
"RTN","LA7VIN1",216,0)
 Q
"RTN","LA7VIN1",217,0)
 ;
"RTN","LA7VIN1",218,0)
 ;
"RTN","LA7VIN1",219,0)
PV1 ;; Process PV1 segment
"RTN","LA7VIN1",220,0)
 ;
"RTN","LA7VIN1",221,0)
 D KILLPV1
"RTN","LA7VIN1",222,0)
 ;
"RTN","LA7VIN1",223,0)
 ; no PID segment
"RTN","LA7VIN1",224,0)
 I LA7SEQ<10 D  Q
"RTN","LA7VIN1",225,0)
 . S (LA7ABORT,LA7ERR)=46
"RTN","LA7VIN1",226,0)
 . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN1",227,0)
 ;
"RTN","LA7VIN1",228,0)
 D PV1^LA7VIN2
"RTN","LA7VIN1",229,0)
 ;
"RTN","LA7VIN1",230,0)
 ; Set sequence flag
"RTN","LA7VIN1",231,0)
 S LA7SEQ=11
"RTN","LA7VIN1",232,0)
 Q
"RTN","LA7VIN1",233,0)
 ;
"RTN","LA7VIN1",234,0)
 ;
"RTN","LA7VIN1",235,0)
 ; The section below is designed to clean up variables that are created
"RTN","LA7VIN1",236,0)
 ; during the processing of a segment type and any created by processing
"RTN","LA7VIN1",237,0)
 ; of segments that are within the message definition.
"RTN","LA7VIN1",238,0)
 ;
"RTN","LA7VIN1",239,0)
KILLMSH ; Clean up variables used by MSH and following segments
"RTN","LA7VIN1",240,0)
 K LA7CSITE,LA7CS,LA7ECH,LA7FS,LA7HLV,LA7MEDT,LA7MID,LA7MTYP
"RTN","LA7VIN1",241,0)
 K LA7RAP,LA7RFAC,LA7SAP,LA7SEQ,LA7SFAC
"RTN","LA7VIN1",242,0)
 K ^TMP("LA7-ID",$J),^TMP("LA7-ORM",$J),^TMP("LA7-ORU",$J)
"RTN","LA7VIN1",243,0)
 ;
"RTN","LA7VIN1",244,0)
KILLMSA ; Clean up variables used by MSA and following segments
"RTN","LA7VIN1",245,0)
 K LA7MSATM
"RTN","LA7VIN1",246,0)
 ;
"RTN","LA7VIN1",247,0)
KILLPID ; Clean up variables used by PID and following segments
"RTN","LA7VIN1",248,0)
 K DFN
"RTN","LA7VIN1",249,0)
 K LA7DOB,LA7ICN,LA7PNM,LA7PRACE,LA7PTID2,LA7PTID3,LA7PTID4
"RTN","LA7VIN1",250,0)
 K LA7SEX,LA7SPID,LA7SSN
"RTN","LA7VIN1",251,0)
 K LRDFN,LRTDFN
"RTN","LA7VIN1",252,0)
 ;
"RTN","LA7VIN1",253,0)
KILLPV1 ; Clean up variables used by PV1 and following segments
"RTN","LA7VIN1",254,0)
 K LA7LOC,LA7SPV1
"RTN","LA7VIN1",255,0)
 ;
"RTN","LA7VIN1",256,0)
KILLORC ; Clean up variables used by ORC and following segments
"RTN","LA7VIN1",257,0)
 K LA7628,LA7629
"RTN","LA7VIN1",258,0)
 K LA7CSITE,LA7DUR,LA7DURU,LA7ODUR,LA7ODURU,LA7EOL,LA7OCR,LA7ORDT
"RTN","LA7VIN1",259,0)
 K LA7OTYPE,LA7OUR,LA7PEB,LA7PON,LA7POP,LA7PVB,LA7SM
"RTN","LA7VIN1",260,0)
 ;
"RTN","LA7VIN1",261,0)
KILLOBR ; Clean up variables used by OBR and following segments
"RTN","LA7VIN1",262,0)
 K LA70070,LA760,LA761,LA762,LA7624,LA7696
"RTN","LA7VIN1",263,0)
 K LA7AA,LA7AD,LA7ACC,LA7AN,LA7CDT,LA7FID,LA7ISQN,LA7LWL,LA7ONLT,LA7OTST
"RTN","LA7VIN1",264,0)
 K LA7POC,LA7SAC,LA7SID,LA7SOBR,LA7SPEC,LA7SPTY,LA7SS,LA7UID,LA7UR
"RTN","LA7VIN1",265,0)
 ;
"RTN","LA7VIN1",266,0)
KILLOBX ; Clean up variables used by OBX and following segments
"RTN","LA7VIN1",267,0)
 K LA7ORS,LA7RLNC,LA7RMK,LA7RNLT,LA7RO,LA7SOBX
"RTN","LA7VIN1",268,0)
 ;
"RTN","LA7VIN1",269,0)
KILLBLG ;Clean up variables used by BLG and following segments
"RTN","LA7VIN1",270,0)
 ;
"RTN","LA7VIN1",271,0)
 Q
"RTN","LA7VIN1A")
0^42^B57089766
"RTN","LA7VIN1A",1,0)
LA7VIN1A ;DALOI/JMC - Process Incoming UI Msgs, continued ; 01/14/99
"RTN","LA7VIN1A",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**64**;Sep 27, 1994
"RTN","LA7VIN1A",3,0)
 ; This routine is a continuation of LA7VIN1.
"RTN","LA7VIN1A",4,0)
 ; It performs generation of any mail bulletins needed.
"RTN","LA7VIN1A",5,0)
 ;
"RTN","LA7VIN1A",6,0)
 ; Reference to DUZ^XUP supported by DBIA #4129
"RTN","LA7VIN1A",7,0)
 Q
"RTN","LA7VIN1A",8,0)
 ;
"RTN","LA7VIN1A",9,0)
 ;
"RTN","LA7VIN1A",10,0)
SENDARB ; Send amended report bulletin
"RTN","LA7VIN1A",11,0)
 N LA76304,LA7BODY,LA7I,LA7IQSN,LA7TSK,LA7X,LWL
"RTN","LA7VIN1A",12,0)
 N XMBODY,XMDUZ,XMBNAME,XMINSTR,XMPARM,XMTO,X,Y
"RTN","LA7VIN1A",13,0)
 N XQA,XQAID,XQADATA,XQAFLAG,XQAMSG,XQAOPT,XQAROU
"RTN","LA7VIN1A",14,0)
 ;
"RTN","LA7VIN1A",15,0)
 I '$G(DUZ) D DUZ^XUP(.5)
"RTN","LA7VIN1A",16,0)
 S XMBNAME="LA7 AMENDED RESULTS RECEIVED"
"RTN","LA7VIN1A",17,0)
 S LA7I=0
"RTN","LA7VIN1A",18,0)
 F  S LA7I=$O(^TMP("LA7 AMENDED RESULTS",$J,LA7I)) Q:'LA7I  D
"RTN","LA7VIN1A",19,0)
 . S LA7I(0)=^TMP("LA7 AMENDED RESULTS",$J,LA7I)
"RTN","LA7VIN1A",20,0)
 . S LWL=$P(LA7I(0),"^",1),LA7ISQN=$P(LA7I(0),"^",2),LA76304=$P(LA7I(0),"^",3)
"RTN","LA7VIN1A",21,0)
 . S XMPARM(1)=$$GET1^DIQ(62.48,$P(LA7I(0),"^",4)_",",.01)
"RTN","LA7VIN1A",22,0)
 . S XMPARM(2)=$P(LA7I(0),"^",5)
"RTN","LA7VIN1A",23,0)
 . S XMPARM(3)=$G(^LAH(LWL,1,LA7ISQN,.1,"PID","PNM"))
"RTN","LA7VIN1A",24,0)
 . S XMPARM(4)=$G(^LAH(LWL,1,LA7ISQN,.1,"PID","SSN"))
"RTN","LA7VIN1A",25,0)
 . S XMPARM(5)=$G(^LAH(LWL,1,LA7ISQN,.1,"OBR","SID"))
"RTN","LA7VIN1A",26,0)
 . S XMPARM(6)=$$FMTE^XLFDT($G(^LAH(LWL,1,LA7ISQN,.1,"OBR","ORCDT")),"MZ")
"RTN","LA7VIN1A",27,0)
  .S XMPARM(7)=$P(LA7I(0),"^",8)_" ["_$P(LA7I(0),"^",7)_"]"
"RTN","LA7VIN1A",28,0)
 . S X=$G(^LAH(LWL,1,LA7ISQN,LA76304)),X(5)=$P(X,"^",5)
"RTN","LA7VIN1A",29,0)
 . S XMPARM(8)=$$GET1^DIQ(4,$P(X,"^",9)_",",.01)
"RTN","LA7VIN1A",30,0)
 . S XMPARM(9)=$G(^LAH(LWL,1,LA7ISQN,.1,"OBR","FID"))
"RTN","LA7VIN1A",31,0)
 . S XMPARM(10)=$P(X,"^")
"RTN","LA7VIN1A",32,0)
 . S XMPARM(11)=$P(X(5),"!",7)
"RTN","LA7VIN1A",33,0)
 . S XMPARM(12)=$P(X(5),"!",2)_$S($P(X(5),"!",3)'="":"-"_$P(X(5),"!",3),1:"")
"RTN","LA7VIN1A",34,0)
 . S LA7X=$P(LA7I(0),"^",9),X=" L^ H^LL^HH^ <^ >^ N^ A^AA^ U^ D^ B^ W^ S^ R^ I^MS^VS"
"RTN","LA7VIN1A",35,0)
 . S I=$F(X,LA7X)\3 S:I LA7X=$P($T(ABFLAGS+I^LA7VHLU1),";;",2)
"RTN","LA7VIN1A",36,0)
 . S XMPARM(13)=LA7X
"RTN","LA7VIN1A",37,0)
 . S X="UNKNOWN"
"RTN","LA7VIN1A",38,0)
 . I $P(LA7I(0),"^",6)="C" S X="Record coming over is a correction and thus replaces a final result"
"RTN","LA7VIN1A",39,0)
 . I $P(LA7I(0),"^",6)="D" S X="Deletes the OBX record"
"RTN","LA7VIN1A",40,0)
 . I $P(LA7I(0),"^",6)="W" S X="Post original as wrong, e.g., transmitted for wrong patient"
"RTN","LA7VIN1A",41,0)
 . S XMPARM(14)=X
"RTN","LA7VIN1A",42,0)
 . S LA7BODY(1)=" ",LA7BODY(2)="Comments:"
"RTN","LA7VIN1A",43,0)
 . S I=0
"RTN","LA7VIN1A",44,0)
 . F  S I=$O(^LAH(LWL,1,LA7ISQN,1,I)) Q:'I  S LA7BODY(I+2)=$P(^(I),"^")
"RTN","LA7VIN1A",45,0)
 . D SMB
"RTN","LA7VIN1A",46,0)
 . S XQAMSG="Lab Messaging - Amended results received from "_XMPARM(1),XQAID="LA7-AMENDED-"_XMPARM(1)
"RTN","LA7VIN1A",47,0)
 . D SA
"RTN","LA7VIN1A",48,0)
 ;
"RTN","LA7VIN1A",49,0)
 K ^TMP("LA7 AMENDED RESULTS",$J)
"RTN","LA7VIN1A",50,0)
 ;
"RTN","LA7VIN1A",51,0)
 Q
"RTN","LA7VIN1A",52,0)
 ;
"RTN","LA7VIN1A",53,0)
 ;
"RTN","LA7VIN1A",54,0)
SENDOSB ; Send order status bulletin when status not OK.
"RTN","LA7VIN1A",55,0)
 ;
"RTN","LA7VIN1A",56,0)
 N I,J,K,LA76248,LA7BODY,LA7I,LA7IQSN,LA7ONLT,LA7TSK,LA7X,LWL
"RTN","LA7VIN1A",57,0)
 N X,XMDUZ,XMBNAME,XMINSTR,XMPARM,XMBODY,XMTO
"RTN","LA7VIN1A",58,0)
 I '$G(DUZ) D DUZ^XUP(.5)
"RTN","LA7VIN1A",59,0)
 ;
"RTN","LA7VIN1A",60,0)
 S XMBNAME="LA7 ORDER STATUS CHANGED"
"RTN","LA7VIN1A",61,0)
 S LA7I=0
"RTN","LA7VIN1A",62,0)
 F  S LA7I=$O(^TMP("LA7 ORDER STATUS",$J,LA7I)) Q:'LA7I  D
"RTN","LA7VIN1A",63,0)
 . S LA7I(0)=^TMP("LA7 ORDER STATUS",$J,LA7I)
"RTN","LA7VIN1A",64,0)
 . S LWL=$P(LA7I(0),"^",1),LA7ISQN=$P(LA7I(0),"^",2),LA7ONLT=$P(LA7I(0),"^",3),LA76248=$P(LA7I(0),"^",5)
"RTN","LA7VIN1A",65,0)
 . S X="UNKNOWN"
"RTN","LA7VIN1A",66,0)
 . I $P(LA7I(0),"^",7)="UA" S X="Unable to accept order/service"
"RTN","LA7VIN1A",67,0)
 . I $P(LA7I(0),"^",7)="OC" S X="Order/service cancel"
"RTN","LA7VIN1A",68,0)
 . I $P(LA7I(0),"^",7)="CR" S X="Canceled as requested"
"RTN","LA7VIN1A",69,0)
 . I $P(LA7I(0),"^",8)="A" S X="Add ordered tests to the existing specimen"
"RTN","LA7VIN1A",70,0)
 . I $P(LA7I(0),"^",8)="G" S X="Generated order; reflex order"
"RTN","LA7VIN1A",71,0)
 . I $P(LA7I(0),"^",8)?1(1"A",1"G") Q:'$$CHKOK(LA7I)
"RTN","LA7VIN1A",72,0)
 . S XMPARM(1)=X
"RTN","LA7VIN1A",73,0)
 . S XMPARM(2)=$$GET1^DIQ(62.48,LA76248_",",.01)
"RTN","LA7VIN1A",74,0)
 . S XMPARM(3)=$P(LA7I(0),"^",6)
"RTN","LA7VIN1A",75,0)
 . S XMPARM(4)=$G(^LAH(LWL,1,LA7ISQN,.1,"PID","PNM"))
"RTN","LA7VIN1A",76,0)
 . S XMPARM(5)=$G(^LAH(LWL,1,LA7ISQN,.1,"PID","SSN"))
"RTN","LA7VIN1A",77,0)
 . S XMPARM(6)=$G(^LAH(LWL,1,LA7ISQN,.1,"OBR","SID"))
"RTN","LA7VIN1A",78,0)
 . S XMPARM(7)=$$FMTE^XLFDT($G(^LAH(LWL,1,LA7ISQN,.1,"OBR","ORCDT")),"MZ")
"RTN","LA7VIN1A",79,0)
 . S XMPARM(8)=$P(LA7I(0),"^",4)_" ["_$P(LA7I(0),"^",3)_"]"
"RTN","LA7VIN1A",80,0)
 . S XMPARM(9)=$G(^LAH(LWL,1,LA7ISQN,.1,"OBR","FID"))
"RTN","LA7VIN1A",81,0)
 . S XMPARM(10)=$P(LA7I(0),"^",9)
"RTN","LA7VIN1A",82,0)
 . S J=2,LA7BODY(1)=" ",LA7BODY(2)="Comments:"
"RTN","LA7VIN1A",83,0)
 . F K="MSA","OCR" D
"RTN","LA7VIN1A",84,0)
 . . S X=$G(^TMP("LA7 ORDER STATUS",$J,LA7I,K))
"RTN","LA7VIN1A",85,0)
 . . I X'="" S J=J+1,LA7BODY(J)=X
"RTN","LA7VIN1A",86,0)
 . S I=0
"RTN","LA7VIN1A",87,0)
 . F  S I=$O(^LAH(LWL,1,LA7ISQN,1,I)) Q:'I  S J=J+1,LA7BODY(J)=$P(^(I),"^")
"RTN","LA7VIN1A",88,0)
 . D SMB
"RTN","LA7VIN1A",89,0)
 . S XQAMSG="Lab Messaging - Order status change received from "_XMPARM(2),XQAID="LA7-ORDER STATUS-"_XMPARM(2)
"RTN","LA7VIN1A",90,0)
 . D SA
"RTN","LA7VIN1A",91,0)
 ;
"RTN","LA7VIN1A",92,0)
 K ^TMP("LA7 ORDER STATUS",$J)
"RTN","LA7VIN1A",93,0)
 ;
"RTN","LA7VIN1A",94,0)
 Q
"RTN","LA7VIN1A",95,0)
 ;
"RTN","LA7VIN1A",96,0)
 ;
"RTN","LA7VIN1A",97,0)
SENDUNCB ; Send units/normals changed bulletin
"RTN","LA7VIN1A",98,0)
 ;
"RTN","LA7VIN1A",99,0)
 N LA76248,LA76304,LA7BODY,LA7I,LA7IQSN,LA7TSK,LA7X,LWL
"RTN","LA7VIN1A",100,0)
 N XMBODY,XMDUZ,XMBNAME,XMINSTR,XMPARM,XMTO,X,Y
"RTN","LA7VIN1A",101,0)
 N XQA,XQAID,XQADATA,XQAFLAG,XQAMSG,XQAOPT,XQAROU
"RTN","LA7VIN1A",102,0)
 ;
"RTN","LA7VIN1A",103,0)
 I '$G(DUZ) D DUZ^XUP(.5)
"RTN","LA7VIN1A",104,0)
 S XMBNAME="LA7 UNITS/NORMALS CHANGED"
"RTN","LA7VIN1A",105,0)
 S LA7I=0
"RTN","LA7VIN1A",106,0)
 F  S LA7I=$O(^TMP("LA7 UNITS/NORMALS CHANGED",$J,LA7I)) Q:'LA7I  D
"RTN","LA7VIN1A",107,0)
 . S LA7I(0)=^TMP("LA7 UNITS/NORMALS CHANGED",$J,LA7I)
"RTN","LA7VIN1A",108,0)
 . S LWL=$P(LA7I(0),"^",1),LA7ISQN=$P(LA7I(0),"^",2),LA76304=$P(LA7I(0),"^",3),LA76248=$P(LA7I(0),"^",4)
"RTN","LA7VIN1A",109,0)
 . S XMPARM(1)=$$GET1^DIQ(62.48,LA76248_",",.01)
"RTN","LA7VIN1A",110,0)
 . S XMPARM(2)=$P(LA7I(0),"^",5)
"RTN","LA7VIN1A",111,0)
 . S XMPARM(3)=$G(^LAH(LWL,1,LA7ISQN,.1,"PID","PNM"))
"RTN","LA7VIN1A",112,0)
 . S XMPARM(4)=$G(^LAH(LWL,1,LA7ISQN,.1,"PID","SSN"))
"RTN","LA7VIN1A",113,0)
 . S XMPARM(5)=$G(^LAH(LWL,1,LA7ISQN,.1,"OBR","SID"))
"RTN","LA7VIN1A",114,0)
 . S XMPARM(6)=$$FMTE^XLFDT($G(^LAH(LWL,1,LA7ISQN,.1,"OBR","ORCDT")),"MZ")
"RTN","LA7VIN1A",115,0)
  .S XMPARM(7)=$P(LA7I(0),"^",8)_" ["_$P(LA7I(0),"^",7)_"]"
"RTN","LA7VIN1A",116,0)
 . S X=$G(^LAH(LWL,1,LA7ISQN,LA76304)),X(5)=$P(X,"^",5)
"RTN","LA7VIN1A",117,0)
 . S XMPARM(8)=$$GET1^DIQ(4,$P(X,"^",9)_",",.01)
"RTN","LA7VIN1A",118,0)
 . S XMPARM(9)=$G(^LAH(LWL,1,LA7ISQN,.1,"OBR","FID"))
"RTN","LA7VIN1A",119,0)
 . S XMPARM(10)=$$GET1^DIQ(60,$P(LA7I(0),"^",10)_",",.01)
"RTN","LA7VIN1A",120,0)
 . S XMPARM(11)=$P(X(5),"!",7)
"RTN","LA7VIN1A",121,0)
 . S XMPARM(12)=$P(X(5),"!",2)_$S($P(X(5),"!",3)'="":"-"_$P(X(5),"!",3),1:"")
"RTN","LA7VIN1A",122,0)
 . S XMTO("G."_$$FAMG^LA7VHLU1(LA76248,2))=""
"RTN","LA7VIN1A",123,0)
 . D SMB
"RTN","LA7VIN1A",124,0)
 . S XQAMSG="Lab Messaging - Reference Lab Units/Normals Change received from "_XMPARM(1),XQAID="LA7-UNITS/NORMALS-CHANGED-"_XMPARM(1)
"RTN","LA7VIN1A",125,0)
 . D SA
"RTN","LA7VIN1A",126,0)
 ;
"RTN","LA7VIN1A",127,0)
 K ^TMP("LA7 UNITS/NORMALS CHANGED",$J)
"RTN","LA7VIN1A",128,0)
 ;
"RTN","LA7VIN1A",129,0)
 Q
"RTN","LA7VIN1A",130,0)
 ;
"RTN","LA7VIN1A",131,0)
 ;
"RTN","LA7VIN1A",132,0)
SENDACB ; Send abnormal/critical bulletin
"RTN","LA7VIN1A",133,0)
 ;
"RTN","LA7VIN1A",134,0)
 N LA76248,LA76304,LA7BODY,LA7I,LA7IQSN,LA7TSK,LA7X,LWL
"RTN","LA7VIN1A",135,0)
 N XMBODY,XMDUZ,XMBNAME,XMINSTR,XMPARM,XMTO,X,Y
"RTN","LA7VIN1A",136,0)
 N XQA,XQAID,XQADATA,XQAFLAG,XQAMSG,XQAOPT,XQAROU
"RTN","LA7VIN1A",137,0)
 ;
"RTN","LA7VIN1A",138,0)
 I '$G(DUZ) D DUZ^XUP(.5)
"RTN","LA7VIN1A",139,0)
 S XMBNAME="LA7 ABNORMAL RESULTS RECEIVED"
"RTN","LA7VIN1A",140,0)
 S LA7I=0
"RTN","LA7VIN1A",141,0)
 F  S LA7I=$O(^TMP("LA7 ABNORMAL RESULTS",$J,LA7I)) Q:'LA7I  D
"RTN","LA7VIN1A",142,0)
 . S LA7I(0)=^TMP("LA7 ABNORMAL RESULTS",$J,LA7I)
"RTN","LA7VIN1A",143,0)
 . S LWL=$P(LA7I(0),"^",1),LA7ISQN=$P(LA7I(0),"^",2),LA76304=$P(LA7I(0),"^",3),LA76248=$P(LA7I(0),"^",4)
"RTN","LA7VIN1A",144,0)
 . S XMPARM(1)=$$GET1^DIQ(62.48,LA76248_",",.01)
"RTN","LA7VIN1A",145,0)
 . S XMPARM(2)=$P(LA7I(0),"^",5)
"RTN","LA7VIN1A",146,0)
 . S XMPARM(3)=$G(^LAH(LWL,1,LA7ISQN,.1,"PID","PNM"))
"RTN","LA7VIN1A",147,0)
 . S XMPARM(4)=$G(^LAH(LWL,1,LA7ISQN,.1,"PID","SSN"))
"RTN","LA7VIN1A",148,0)
 . S XMPARM(5)=$G(^LAH(LWL,1,LA7ISQN,.1,"OBR","SID"))
"RTN","LA7VIN1A",149,0)
 . S XMPARM(6)=$$FMTE^XLFDT($G(^LAH(LWL,1,LA7ISQN,.1,"OBR","ORCDT")),"MZ")
"RTN","LA7VIN1A",150,0)
  .S XMPARM(7)=$P(LA7I(0),"^",8)_" ["_$P(LA7I(0),"^",7)_"]"
"RTN","LA7VIN1A",151,0)
 . S X=$G(^LAH(LWL,1,LA7ISQN,LA76304)),X(5)=$P(X,"^",5)
"RTN","LA7VIN1A",152,0)
 . S XMPARM(8)=$$GET1^DIQ(4,$P(X,"^",9)_",",.01)
"RTN","LA7VIN1A",153,0)
 . S XMPARM(9)=$G(^LAH(LWL,1,LA7ISQN,.1,"OBR","FID"))
"RTN","LA7VIN1A",154,0)
 . S XMPARM(10)=$P(X,"^")
"RTN","LA7VIN1A",155,0)
 . S XMPARM(11)=$P(X(5),"!",7)
"RTN","LA7VIN1A",156,0)
 . S XMPARM(12)=$P(X(5),"!",2)_$S($P(X(5),"!",3)'="":"-"_$P(X(5),"!",3),1:"")
"RTN","LA7VIN1A",157,0)
 . S LA7X=$P(LA7I(0),"^",9),X=" L^ H^LL^HH^ <^ >^ N^ A^AA^ U^ D^ B^ W^ S^ R^ I^MS^VS"
"RTN","LA7VIN1A",158,0)
 . S I=$F(X,LA7X)\3 S:I LA7X=$P($T(ABFLAGS+I^LA7VHLU1),";;",2)
"RTN","LA7VIN1A",159,0)
 . S XMPARM(13)=LA7X
"RTN","LA7VIN1A",160,0)
 . D SMB
"RTN","LA7VIN1A",161,0)
 . S XQAMSG="Lab Messaging - Reference Lab Abnormal Results received from "_XMPARM(1),XQAID="LA7-ABNORMAL-RESULTS-"_XMPARM(1)
"RTN","LA7VIN1A",162,0)
 . D SA
"RTN","LA7VIN1A",163,0)
 ;
"RTN","LA7VIN1A",164,0)
 K ^TMP("LA7 ABNORMAL RESULTS",$J)
"RTN","LA7VIN1A",165,0)
 ;
"RTN","LA7VIN1A",166,0)
 Q
"RTN","LA7VIN1A",167,0)
 ;
"RTN","LA7VIN1A",168,0)
 ;
"RTN","LA7VIN1A",169,0)
SMB ; Send mail bulletin
"RTN","LA7VIN1A",170,0)
 ; Ignore any restrictions (domain closed or protected by security key)
"RTN","LA7VIN1A",171,0)
 ;
"RTN","LA7VIN1A",172,0)
 S XMINSTR("ADDR FLAGS")="R"
"RTN","LA7VIN1A",173,0)
 S XMINSTR("FROM")="LAB PACKAGE"
"RTN","LA7VIN1A",174,0)
 S XMTO("G."_$$FAMG^LA7VHLU1(LA76248,1))=""
"RTN","LA7VIN1A",175,0)
 D SENDBULL^XMXAPI(DUZ,XMBNAME,.XMPARM,$S($D(LA7BODY):"LA7BODY",1:""),.XMTO,.XMINSTR,.LA7TSK,"")
"RTN","LA7VIN1A",176,0)
 ;
"RTN","LA7VIN1A",177,0)
 Q
"RTN","LA7VIN1A",178,0)
 ;
"RTN","LA7VIN1A",179,0)
 ;
"RTN","LA7VIN1A",180,0)
SA ; Send alert
"RTN","LA7VIN1A",181,0)
 ;
"RTN","LA7VIN1A",182,0)
 M XQA=XMTO
"RTN","LA7VIN1A",183,0)
 D DEL^LA7UXQA(XQAID)
"RTN","LA7VIN1A",184,0)
 D SETUP^XQALERT
"RTN","LA7VIN1A",185,0)
 ;
"RTN","LA7VIN1A",186,0)
 Q
"RTN","LA7VIN1A",187,0)
 ;
"RTN","LA7VIN1A",188,0)
 ;
"RTN","LA7VIN1A",189,0)
CHKOK(LA7INDX) ; Check if ok to send bulletin on added/reflexed tests order change
"RTN","LA7VIN1A",190,0)
 ; Returns OK = 1 if results associated with added/reflex test are not
"RTN","LA7VIN1A",191,0)
 ;               on the accession.
"RTN","LA7VIN1A",192,0)
 ;         OK = 0 if accession already has tests on accession.
"RTN","LA7VIN1A",193,0)
 ;
"RTN","LA7VIN1A",194,0)
 N LA760,LA7AA,LA7AD,LA7AN,LA7I,LA7TREEN,LRUID,OK,X
"RTN","LA7VIN1A",195,0)
 S OK=1,LRUID=$P($G(^LAH(LWL,1,LA7ISQN,.1,"OBR","SID")),"^")
"RTN","LA7VIN1A",196,0)
 ;
"RTN","LA7VIN1A",197,0)
 ; Store all tests accessioned in ^TMP
"RTN","LA7VIN1A",198,0)
 S X=$Q(^LRO(68,"C",LRUID))
"RTN","LA7VIN1A",199,0)
 I X'="",$QS(X,3)=LRUID D
"RTN","LA7VIN1A",200,0)
 . K ^TMP("LA7TREE",$J)
"RTN","LA7VIN1A",201,0)
 . S LA7AA=$QS(X,4),LA7AD=$QS(X,5),LA7AN=$QS(X,6),LA7I=0
"RTN","LA7VIN1A",202,0)
 . F  S LA7I=$O(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,LA7I)) Q:'LA7I  D UNWIND^LA7UTIL(LA7I)
"RTN","LA7VIN1A",203,0)
 . S (LA7I,OK)=0
"RTN","LA7VIN1A",204,0)
 . F  S LA7I=$O(^TMP("LA7 ORDER STATUS",$J,LA7INDX,LA7I)) Q:'LA7I  D  Q:OK
"RTN","LA7VIN1A",205,0)
 . . I '$D(^TMP("LA7TREE",$J,LA7I)) S OK=1 ;wasn't ordered
"RTN","LA7VIN1A",206,0)
 . K ^TMP("LA7TREE",$J)
"RTN","LA7VIN1A",207,0)
 Q OK
"RTN","LA7VIN2")
0^8^B65721794
"RTN","LA7VIN2",1,0)
LA7VIN2 ;DALOI/JMC - Process Incoming UI Msgs, continued ; 01/14/99
"RTN","LA7VIN2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VIN2",3,0)
 ;This routine is a continuation of LA7VIN1 and is only called from there.
"RTN","LA7VIN2",4,0)
 Q
"RTN","LA7VIN2",5,0)
 ;
"RTN","LA7VIN2",6,0)
MSH ; Process MSH segment
"RTN","LA7VIN2",7,0)
 N LA7X
"RTN","LA7VIN2",8,0)
 ;
"RTN","LA7VIN2",9,0)
 I $E(LA7SEG(0),1,3)'="MSH" D  Q
"RTN","LA7VIN2",10,0)
 . S (LA7ABORT,LA7ERR)=7
"RTN","LA7VIN2",11,0)
 . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN2",12,0)
 ;
"RTN","LA7VIN2",13,0)
 ; Encoding characters
"RTN","LA7VIN2",14,0)
 S LA7FS=$E(LA7SEG(0),4)
"RTN","LA7VIN2",15,0)
 S LA7CS=$E(LA7SEG(0),5)
"RTN","LA7VIN2",16,0)
 S LA7ECH=$E(LA7SEG(0),5,8)
"RTN","LA7VIN2",17,0)
 ; No field or component seperator
"RTN","LA7VIN2",18,0)
 I LA7FS=""!(LA7CS="") D
"RTN","LA7VIN2",19,0)
 . S (LA7ABORT,LA7ERR)=8
"RTN","LA7VIN2",20,0)
 . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN2",21,0)
 ;
"RTN","LA7VIN2",22,0)
 ; Sending application
"RTN","LA7VIN2",23,0)
 S LA7SAP=$$P^LA7VHLU(.LA7SEG,3,LA7FS)
"RTN","LA7VIN2",24,0)
 S LA7ID=LA7SAP_"-I-"
"RTN","LA7VIN2",25,0)
 ;
"RTN","LA7VIN2",26,0)
 ; Sending facility
"RTN","LA7VIN2",27,0)
 S LA7SFAC=$$P^LA7VHLU(.LA7SEG,4,LA7FS)
"RTN","LA7VIN2",28,0)
 ;
"RTN","LA7VIN2",29,0)
 ; Receiving application
"RTN","LA7VIN2",30,0)
 S LA7RAP=$$P^LA7VHLU(.LA7SEG,5,LA7FS)
"RTN","LA7VIN2",31,0)
 ;
"RTN","LA7VIN2",32,0)
 ; Receiving facility
"RTN","LA7VIN2",33,0)
 S LA7RFAC=$$P^LA7VHLU(.LA7SEG,6,LA7FS)
"RTN","LA7VIN2",34,0)
 ;
"RTN","LA7VIN2",35,0)
 ; Message date/time from first component
"RTN","LA7VIN2",36,0)
 S LA7MEDT=$$HL7TFM^XLFDT($P($$P^LA7VHLU(.LA7SEG,7,LA7FS),LA7CS),"L")
"RTN","LA7VIN2",37,0)
 ;
"RTN","LA7VIN2",38,0)
 ; Message type
"RTN","LA7VIN2",39,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,9,LA7FS)
"RTN","LA7VIN2",40,0)
 S LA7MTYP=$P(LA7X,LA7CS,1)
"RTN","LA7VIN2",41,0)
 ;
"RTN","LA7VIN2",42,0)
 ; Message Control ID
"RTN","LA7VIN2",43,0)
 S LA7MID=$$P^LA7VHLU(.LA7SEG,10,LA7FS)
"RTN","LA7VIN2",44,0)
 ;
"RTN","LA7VIN2",45,0)
 ; HL7 version
"RTN","LA7VIN2",46,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,12,LA7FS)
"RTN","LA7VIN2",47,0)
 S LA7HLV=$P(LA7X,LA7CS,1)
"RTN","LA7VIN2",48,0)
 Q
"RTN","LA7VIN2",49,0)
 ;
"RTN","LA7VIN2",50,0)
 ;
"RTN","LA7VIN2",51,0)
ORC ; Process ORC segment
"RTN","LA7VIN2",52,0)
 N LA7X,LA7Y
"RTN","LA7VIN2",53,0)
 ;
"RTN","LA7VIN2",54,0)
 ; Order control
"RTN","LA7VIN2",55,0)
 S LA7OTYPE=$$P^LA7VHLU(.LA7SEG,2,LA7FS)
"RTN","LA7VIN2",56,0)
 ;
"RTN","LA7VIN2",57,0)
 ; Place order number
"RTN","LA7VIN2",58,0)
 S LA7PON=$$P^LA7VHLU(.LA7SEG,3,LA7FS)
"RTN","LA7VIN2",59,0)
 ;
"RTN","LA7VIN2",60,0)
 ; Setup shipping manifest variable
"RTN","LA7VIN2",61,0)
 S LA7Y=0
"RTN","LA7VIN2",62,0)
 S LA7X=$P($$P^LA7VHLU(.LA7SEG,5,LA7FS),LA7CS)
"RTN","LA7VIN2",63,0)
 I LA7X'="" S LA7Y=$O(^LAHM(62.8,"B",LA7X,0))
"RTN","LA7VIN2",64,0)
 I LA7Y S LA7628=LA7Y
"RTN","LA7VIN2",65,0)
 S LA7SM=LA7Y_"^"_LA7X
"RTN","LA7VIN2",66,0)
 ;
"RTN","LA7VIN2",67,0)
 ; Setup shipping configuration variable
"RTN","LA7VIN2",68,0)
 I $P(LA7SM,"^") S LA7629=+$P($G(^LAHM(62.8,$P(LA7SM,"^"),0)),"^",2)
"RTN","LA7VIN2",69,0)
 E  S LA7629=0
"RTN","LA7VIN2",70,0)
 ;
"RTN","LA7VIN2",71,0)
 ; Set new order/shipping mainfest received alert/identifiers
"RTN","LA7VIN2",72,0)
 I LA7MTYP="ORM",$L($P(LA7SM,"^",2)) D
"RTN","LA7VIN2",73,0)
 . S ^TMP("LA7-ORM",$J,LA76248,LA76249,$P(LA7SM,"^",2))=""
"RTN","LA7VIN2",74,0)
 . D SETID^LA7VHLU1(LA76249,LA7ID,$P(LA7SM,"^",2))
"RTN","LA7VIN2",75,0)
 ;
"RTN","LA7VIN2",76,0)
 ; Order quantity/timing (duration, units, urgency)
"RTN","LA7VIN2",77,0)
 S LA7ODUR=$P($$P^LA7VHLU(.LA7SEG,8,LA7FS),LA7CS,3)
"RTN","LA7VIN2",78,0)
 S LA7ODURU=$P($$P^LA7VHLU(.LA7SEG,8,LA7FS),LA7CS,4)
"RTN","LA7VIN2",79,0)
 S LA7OUR=$P($$P^LA7VHLU(.LA7SEG,8,LA7FS),LA7CS,6)
"RTN","LA7VIN2",80,0)
 ;
"RTN","LA7VIN2",81,0)
 ; Date/time of transaction
"RTN","LA7VIN2",82,0)
 S LA7ORDT=$$HL7TFM^XLFDT($P($$P^LA7VHLU(.LA7SEG,10,LA7FS),LA7CS),"L")
"RTN","LA7VIN2",83,0)
 ;
"RTN","LA7VIN2",84,0)
 ; Placer's entered by (id^duz^last name, first name, mi [id])
"RTN","LA7VIN2",85,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,11,LA7FS)
"RTN","LA7VIN2",86,0)
 S LA7PEB=$$XCNTFM^LA7VHLU4(LA7X,LA7ECH)
"RTN","LA7VIN2",87,0)
 I LA7PEB="^^" S LA7PEB=""
"RTN","LA7VIN2",88,0)
 ;
"RTN","LA7VIN2",89,0)
 ; Placer's verified by (id^duz^last name, first name, mi [id])
"RTN","LA7VIN2",90,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,12,LA7FS)
"RTN","LA7VIN2",91,0)
 S LA7PVB=$$XCNTFM^LA7VHLU4(LA7X,LA7ECH)
"RTN","LA7VIN2",92,0)
 I LA7PVB="^^" S LA7PVB=""
"RTN","LA7VIN2",93,0)
 ;
"RTN","LA7VIN2",94,0)
 ; Placer's ordering provider (id^duz^last name, first name, mi [id])
"RTN","LA7VIN2",95,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,13,LA7FS)
"RTN","LA7VIN2",96,0)
 S LA7POP=$$XCNTFM^LA7VHLU4(LA7X,LA7ECH)
"RTN","LA7VIN2",97,0)
 I LA7POP="^^" S LA7POP=""
"RTN","LA7VIN2",98,0)
 ;
"RTN","LA7VIN2",99,0)
 ; Enterer's ordering location
"RTN","LA7VIN2",100,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,14,LA7FS)
"RTN","LA7VIN2",101,0)
 S LA7Y=$$PLTFM^LA7VHLU4(LA7X,LA7ECH)
"RTN","LA7VIN2",102,0)
 S LA7EOL=$P(LA7Y,"^",1,3)
"RTN","LA7VIN2",103,0)
 I LA7EOL="^^" S LA7EOL=""
"RTN","LA7VIN2",104,0)
 ;
"RTN","LA7VIN2",105,0)
 ; Order control code reason
"RTN","LA7VIN2",106,0)
 S LA7OCR=$$P^LA7VHLU(.LA7SEG,17,LA7FS)
"RTN","LA7VIN2",107,0)
 ;
"RTN","LA7VIN2",108,0)
 ;
"RTN","LA7VIN2",109,0)
 ; If ORM order message, determine specimen collecting site from ORC
"RTN","LA7VIN2",110,0)
 ; segment, if none use MSH sending facility value
"RTN","LA7VIN2",111,0)
 S LA7CSITE=""
"RTN","LA7VIN2",112,0)
 I LA7MTYP="ORM" D
"RTN","LA7VIN2",113,0)
 . S LA7X=$P($$P^LA7VHLU(.LA7SEG,18,LA7FS),LA7CS)
"RTN","LA7VIN2",114,0)
 . S LA7CSITE=$$FINDSITE^LA7VHLU2(LA7X,2,1)
"RTN","LA7VIN2",115,0)
 . I LA7CSITE'>0 S LA7CSITE=$$FINDSITE^LA7VHLU2(LA7SFAC,2,0)
"RTN","LA7VIN2",116,0)
 ;
"RTN","LA7VIN2",117,0)
 Q
"RTN","LA7VIN2",118,0)
 ;
"RTN","LA7VIN2",119,0)
 ;
"RTN","LA7VIN2",120,0)
NTE ; Process NTE segment
"RTN","LA7VIN2",121,0)
 ; NTE segments contain comments from instruments or other facilities.
"RTN","LA7VIN2",122,0)
 ; NTE segments following OBR's contain comments which refer to the entire test battery.
"RTN","LA7VIN2",123,0)
 ; NTE segments following OBX's contain comments which are test specific.
"RTN","LA7VIN2",124,0)
 ;
"RTN","LA7VIN2",125,0)
 ; For comments in ORU messages:
"RTN","LA7VIN2",126,0)
 ;  Test specific comments can be prefaced with a site defined prefix -
"RTN","LA7VIN2",127,0)
 ;  see field REMARK PREFIX (#19) in CHEM TEST multiple of AUTOMATED INSTRUMENT (#62.4 file.
"RTN","LA7VIN2",128,0)
 ;  There can be more than one NTE, each will be stored as a comment in ^LAH.
"RTN","LA7VIN2",129,0)
 ;
"RTN","LA7VIN2",130,0)
 N LA7,LA7I,LA7NTE,LA7SOC
"RTN","LA7VIN2",131,0)
 ;
"RTN","LA7VIN2",132,0)
 S LA7SOC=$$P^LA7VHLU(.LA7SEG,3,LA7FS)
"RTN","LA7VIN2",133,0)
 S LA7NTE=$$P^LA7VHLU(.LA7SEG,4,LA7FS)
"RTN","LA7VIN2",134,0)
 ;
"RTN","LA7VIN2",135,0)
 ; Trim trailing spaces.
"RTN","LA7VIN2",136,0)
 I LA7NTE'="" S LA7NTE=$$TRIM^XLFSTR(LA7NTE,"R"," ")
"RTN","LA7VIN2",137,0)
 I LA7NTE="" S LA7NTE=" "
"RTN","LA7VIN2",138,0)
 ;
"RTN","LA7VIN2",139,0)
 I LA7MTYP="ORM" D OCOM Q
"RTN","LA7VIN2",140,0)
 ;
"RTN","LA7VIN2",141,0)
 ; Check for repeating comments in NTE segment and process
"RTN","LA7VIN2",142,0)
 ; If "^" in remark then translate to "~" to store.
"RTN","LA7VIN2",143,0)
 F LA7I=1:1:$L(LA7NTE,$E(LA7ECH,2)) D
"RTN","LA7VIN2",144,0)
 . S LA7RMK=$P(LA7NTE,$E(LA7ECH,2),LA7I)
"RTN","LA7VIN2",145,0)
 . I LA7RMK="" Q
"RTN","LA7VIN2",146,0)
 . S LA7RMK=$$UNESC^LA7VHLU3(LA7RMK,LA7FS_LA7ECH)
"RTN","LA7VIN2",147,0)
 . I LA7RMK["^" S LA7RMK=$TR(LA7RMK,"^","~")
"RTN","LA7VIN2",148,0)
 . I LA7MTYP="ORU" D RCOM Q
"RTN","LA7VIN2",149,0)
 . I LA7MTYP="ORR",$G(LA7OTYPE)="UA" D RCOM Q
"RTN","LA7VIN2",150,0)
 ;
"RTN","LA7VIN2",151,0)
 Q
"RTN","LA7VIN2",152,0)
 ;
"RTN","LA7VIN2",153,0)
 ;
"RTN","LA7VIN2",154,0)
PID ; Process PID segment
"RTN","LA7VIN2",155,0)
 N LA7X,LA7Y,X,Y
"RTN","LA7VIN2",156,0)
 ;
"RTN","LA7VIN2",157,0)
 S (DFN,LA7DOB,LA7ICN,LA7PRACE,LA7PNM,LA7PTID2,LA7PTID3,LA7PTID4,LA7SEX,LA7SSN,LRDFN,LRTDFN)=""
"RTN","LA7VIN2",158,0)
 ;
"RTN","LA7VIN2",159,0)
 ; PID Set ID
"RTN","LA7VIN2",160,0)
 S LA7SPID=$$P^LA7VHLU(.LA7SEG,2,LA7FS)
"RTN","LA7VIN2",161,0)
 ;
"RTN","LA7VIN2",162,0)
 ; Extract patient identifiers
"RTN","LA7VIN2",163,0)
 S LA7PTID2=$$P^LA7VHLU(.LA7SEG,3,LA7FS)
"RTN","LA7VIN2",164,0)
 S LA7PTID3=$$P^LA7VHLU(.LA7SEG,4,LA7FS)
"RTN","LA7VIN2",165,0)
 S LA7PTID4=$$P^LA7VHLU(.LA7SEG,5,LA7FS)
"RTN","LA7VIN2",166,0)
 ; Resolve ICN if identifier is from MPI
"RTN","LA7VIN2",167,0)
 ; Assume SSN is identifier is "SS" or blank
"RTN","LA7VIN2",168,0)
 F I=1:1:$L(LA7PTID3,$E(LA7ECH,2)) D
"RTN","LA7VIN2",169,0)
 . N J,LA7X,LA7ID
"RTN","LA7VIN2",170,0)
 . S X=$P(LA7PTID3,$E(LA7ECH,2),I) Q:'$L(X)
"RTN","LA7VIN2",171,0)
 . S LA7PTID3(I)=X,LA7ID=$P(LA7PTID3(I),$E(LA7ECH),5)
"RTN","LA7VIN2",172,0)
 . I LA7ID'="","NI^PI"[LA7ID D  Q
"RTN","LA7VIN2",173,0)
 . . S Y=$P(LA7PTID3(I),$E(LA7ECH))
"RTN","LA7VIN2",174,0)
 . . I Y?10N1"V"6N S LA7Y=Y
"RTN","LA7VIN2",175,0)
 . . E  S LA7Y=Y_"V"_$P(LA7PTID3(I),$E(LA7ECH),2)
"RTN","LA7VIN2",176,0)
 . . S LA7X=$$CHKICN^LA7VHLU2(LA7Y)
"RTN","LA7VIN2",177,0)
 . . I LA7X>0 S DFN=$P(LA7X,"^"),LA7ICN=$P(LA7X,"^",2)
"RTN","LA7VIN2",178,0)
 . I LA7ID="SS"!(LA7ID="") D  Q
"RTN","LA7VIN2",179,0)
 . . F J=1:1:3 S LA7X(J)=$P(LA7PTID3(I),$E(LA7ECH),J)
"RTN","LA7VIN2",180,0)
 . . I LA7X(1)'?9N.1A Q
"RTN","LA7VIN2",181,0)
 . . I LA7X(3)="M11",LA7X(2)'=$P($$M11^HLFNC(LA7X(1),LA7ECH),$E(LA7ECH),2) Q
"RTN","LA7VIN2",182,0)
 . . S LA7SSN=LA7X(1),DFN=$O(^DPT("SSN",LA7SSN,0))
"RTN","LA7VIN2",183,0)
 ;
"RTN","LA7VIN2",184,0)
 ; Check PID-2 (alternate patient id) if PID-3 did not yield SSN/ICN
"RTN","LA7VIN2",185,0)
 F I=1:1:$L(LA7PTID2,$E(LA7ECH,2)) D
"RTN","LA7VIN2",186,0)
 . N J,LA7X,LA7ID
"RTN","LA7VIN2",187,0)
 . S X=$P(LA7PTID2,$E(LA7ECH,2),I) Q:'$L(X)
"RTN","LA7VIN2",188,0)
 . S LA7PTID2(I)=X,LA7ID=$P(LA7PTID2(I),$E(LA7ECH),5)
"RTN","LA7VIN2",189,0)
 . I LA7ICN="",LA7ID'="","NI^PI"[LA7ID D  Q
"RTN","LA7VIN2",190,0)
 . . S Y=$P(LA7PTID2(I),$E(LA7ECH))
"RTN","LA7VIN2",191,0)
 . . I Y?10N1"V"6N S LA7Y=Y
"RTN","LA7VIN2",192,0)
 . . E  S LA7Y=Y_"V"_$P(LA7PTID2(I),$E(LA7ECH),2)
"RTN","LA7VIN2",193,0)
 . . S LA7X=$$CHKICN^LA7VHLU2(LA7Y)
"RTN","LA7VIN2",194,0)
 . . I LA7X>0 S DFN=$P(LA7X,"^"),LA7ICN=$P(LA7X,"^",2)
"RTN","LA7VIN2",195,0)
 . I LA7SSN="",LA7ID="SS"!(LA7ID="") D  Q
"RTN","LA7VIN2",196,0)
 . . F J=1:1:3 S LA7X(J)=$P(LA7PTID2(I),$E(LA7ECH),J)
"RTN","LA7VIN2",197,0)
 . . I LA7X(1)'?9N.1A Q
"RTN","LA7VIN2",198,0)
 . . I LA7X(3)="M11",LA7X(2)'=$P($$M11^HLFNC(LA7X(1),LA7ECH),$E(LA7ECH),2) Q
"RTN","LA7VIN2",199,0)
 . . S LA7SSN=LA7X(1),DFN=$O(^DPT("SSN",LA7SSN,0))
"RTN","LA7VIN2",200,0)
 ;
"RTN","LA7VIN2",201,0)
 ; Extract patient name
"RTN","LA7VIN2",202,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,6,LA7FS)
"RTN","LA7VIN2",203,0)
 I LA7X'="" S LA7PNM=$$FMNAME^HLFNC(LA7X,LA7ECH)
"RTN","LA7VIN2",204,0)
 ;
"RTN","LA7VIN2",205,0)
 ; Extract date of birth
"RTN","LA7VIN2",206,0)
 ; Check for degree of precision in 2nd component to provide backward compatibility with HL7 <v2.3
"RTN","LA7VIN2",207,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,8,LA7FS)
"RTN","LA7VIN2",208,0)
 I LA7X D
"RTN","LA7VIN2",209,0)
 . S LA7Y=$P(LA7X,LA7CS,2),LA7X=$P(LA7X,LA7CS,1)
"RTN","LA7VIN2",210,0)
 . I (LA7Y=""!(LA7Y="D")),$E(LA7X,9,12)="0000" S LA7X=$E(LA7X,1,8)
"RTN","LA7VIN2",211,0)
 . S LA7DOB=$$HL7TFM^XLFDT(LA7X)
"RTN","LA7VIN2",212,0)
 . I LA7DOB<1 S LA7DOB=""
"RTN","LA7VIN2",213,0)
 . I LA7Y="L" S LA7DOB=$E(LA7DOB,1,5)_"00"
"RTN","LA7VIN2",214,0)
 . I LA7Y="Y" S LA7DOB=$E(LA7DOB,1,3)_"0000"
"RTN","LA7VIN2",215,0)
 ;
"RTN","LA7VIN2",216,0)
 ; Extract patient's sex
"RTN","LA7VIN2",217,0)
 S LA7SEX=$$P^LA7VHLU(.LA7SEG,9,LA7FS)
"RTN","LA7VIN2",218,0)
 ;
"RTN","LA7VIN2",219,0)
 ; Extract patient's race
"RTN","LA7VIN2",220,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,11,LA7FS)
"RTN","LA7VIN2",221,0)
 I $P(LA7X,LA7CS)'="" D
"RTN","LA7VIN2",222,0)
 . I $P(LA7X,LA7CS,3)="0005" S $P(LA7X,LA7CS,3)="HL70005"
"RTN","LA7VIN2",223,0)
 . S LA7PRACE=$P(LA7X,LA7CS)_":"_$P(LA7X,LA7CS,2)_$S($P(LA7X,LA7CS,3)'="":":"_$P(LA7X,LA7CS,3),1:"")
"RTN","LA7VIN2",224,0)
 ;
"RTN","LA7VIN2",225,0)
 ; Extract patient's SSN and determine DFN
"RTN","LA7VIN2",226,0)
 ; If SSN determined previously from PID-3 then compare SSN's
"RTN","LA7VIN2",227,0)
 ; If DFN determined previously from ICN then check DFN based on SSN.
"RTN","LA7VIN2",228,0)
 S LA7X=$P($$P^LA7VHLU(.LA7SEG,20,LA7FS),LA7CS)
"RTN","LA7VIN2",229,0)
 S LA7X=$TR(LA7X,"-","") ; remove "-" if any
"RTN","LA7VIN2",230,0)
 I LA7X?9N.1A D
"RTN","LA7VIN2",231,0)
 . I LA7SSN'="",LA7X'=LA7SSN Q
"RTN","LA7VIN2",232,0)
 . S LA7SSN=LA7X
"RTN","LA7VIN2",233,0)
 . I DFN,DFN'=$O(^DPT("SSN",LA7SSN,0)) Q
"RTN","LA7VIN2",234,0)
 . S DFN=$O(^DPT("SSN",LA7SSN,0))
"RTN","LA7VIN2",235,0)
 I DFN D
"RTN","LA7VIN2",236,0)
 . S LRDFN=$P($G(^DPT(DFN,"LR")),"^")
"RTN","LA7VIN2",237,0)
 . S LRTDFN=$P($G(^DPT(DFN,"LRT")),"^")
"RTN","LA7VIN2",238,0)
 ;
"RTN","LA7VIN2",239,0)
 Q
"RTN","LA7VIN2",240,0)
 ;
"RTN","LA7VIN2",241,0)
 ;
"RTN","LA7VIN2",242,0)
PV1 ; Process PV1 segment
"RTN","LA7VIN2",243,0)
 ;
"RTN","LA7VIN2",244,0)
 ; PV1 Set ID
"RTN","LA7VIN2",245,0)
 S LA7SPV1=$$P^LA7VHLU(.LA7SEG,2,LA7FS)
"RTN","LA7VIN2",246,0)
 ;
"RTN","LA7VIN2",247,0)
 ; Extract ordering location
"RTN","LA7VIN2",248,0)
 S LA7LOC=$P($$P^LA7VHLU(.LA7SEG,4,LA7FS),LA7CS)
"RTN","LA7VIN2",249,0)
 Q
"RTN","LA7VIN2",250,0)
 ;
"RTN","LA7VIN2",251,0)
 ;
"RTN","LA7VIN2",252,0)
RCOM ; Store result comments in ORU messages
"RTN","LA7VIN2",253,0)
 ;
"RTN","LA7VIN2",254,0)
 ; Don't store remark if same as specimen comment (without "~").
"RTN","LA7VIN2",255,0)
 I $G(LA7AA),$G(LA7AD),$G(LA7AN),LA7RMK=$TR($P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,3)),"^",6),"~") Q
"RTN","LA7VIN2",256,0)
 ; Or patient info (#.091 in file 63) - info previously downloaded
"RTN","LA7VIN2",257,0)
 I $G(LA7AA),$G(LA7AD),$G(LA7AN),LA7RMK=$G(^LR(+$G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,0)),.091)) Q
"RTN","LA7VIN2",258,0)
 ;
"RTN","LA7VIN2",259,0)
 ; If test specific, store comment prefix with comments (see LA7VIN5)
"RTN","LA7VIN2",260,0)
 I $O(LA7RMK(0,0)) D  Q
"RTN","LA7VIN2",261,0)
 . N LA7I
"RTN","LA7VIN2",262,0)
 . S LA7I=0
"RTN","LA7VIN2",263,0)
 . F  S LA7I=$O(LA7RMK(0,LA7I)) Q:'LA7I  D
"RTN","LA7VIN2",264,0)
 . . I '$P(LA7RMK(0,LA7I),"^") Q
"RTN","LA7VIN2",265,0)
 . . ; Don't store if status not "FINAL"
"RTN","LA7VIN2",266,0)
 . . I $P(LA7RMK(0,LA7I),"^")=2,"CFU"'[$G(LA7ORS) Q
"RTN","LA7VIN2",267,0)
 . . D RMKSET^LASET(LA7LWL,LA7ISQN,LA7RMK,$P(LA7RMK(0,LA7I),"^",2))
"RTN","LA7VIN2",268,0)
 ;
"RTN","LA7VIN2",269,0)
 ; Store comment in 1 node of ^LAH global
"RTN","LA7VIN2",270,0)
 I $P(LA7624(0),"^",17) D RMKSET^LASET(LA7LWL,LA7ISQN,LA7RMK,"")
"RTN","LA7VIN2",271,0)
 K LA7RMK
"RTN","LA7VIN2",272,0)
 Q
"RTN","LA7VIN2",273,0)
 ;
"RTN","LA7VIN2",274,0)
 ;
"RTN","LA7VIN2",275,0)
OCOM ; Store order comments from ORM messages in file #69.6
"RTN","LA7VIN2",276,0)
 ; Check for repeating comments in NTE segment and process
"RTN","LA7VIN2",277,0)
 ; If "^" in remark then translate to "~" to store.
"RTN","LA7VIN2",278,0)
 ;
"RTN","LA7VIN2",279,0)
 ; If source of comment (LA7SOC) is "RQ" then comment is from CHCS which
"RTN","LA7VIN2",280,0)
 ; uses a composite data type for NTE-3. VistA only extracts component #9
"RTN","LA7VIN2",281,0)
 ; which contains the external value of the comment.
"RTN","LA7VIN2",282,0)
 ;
"RTN","LA7VIN2",283,0)
 N LA7DIE,LA7RMK,LA7WP,X
"RTN","LA7VIN2",284,0)
 I $G(LA7696)<1 Q
"RTN","LA7VIN2",285,0)
 F LA7I=1:1:$L(LA7NTE,$E(LA7ECH,2)) D
"RTN","LA7VIN2",286,0)
 . S LA7RMK=$P(LA7NTE,$E(LA7ECH,2),LA7I)
"RTN","LA7VIN2",287,0)
 . I LA7SOC="RQ" D
"RTN","LA7VIN2",288,0)
 . . S X=$P(LA7RMK,$E(LA7ECH),9)
"RTN","LA7VIN2",289,0)
 . . I X'="" S LA7RMK=X
"RTN","LA7VIN2",290,0)
 . I LA7RMK="" Q
"RTN","LA7VIN2",291,0)
 . S LA7RMK=$$UNESC^LA7VHLU3(LA7RMK,LA7FS_LA7ECH)
"RTN","LA7VIN2",292,0)
 . I LA7RMK["^" S LA7RMK=$TR(LA7RMK,"^","~")
"RTN","LA7VIN2",293,0)
 . S LA7WP(LA7I,0)=LA7RMK
"RTN","LA7VIN2",294,0)
 D WP^DIE(69.6,LA7696_",",99,"A","LA7WP","LA7DIE(99)")
"RTN","LA7VIN2",295,0)
 Q
"RTN","LA7VIN3")
0^50^B9589401
"RTN","LA7VIN3",1,0)
LA7VIN3 ;DALOI/JMC - Process Incoming UI Msgs, continued ; 01/14/99
"RTN","LA7VIN3",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VIN3",3,0)
 ;This routine is a continuation of LA7VIN1 and is only called from there.
"RTN","LA7VIN3",4,0)
 Q
"RTN","LA7VIN3",5,0)
 ;
"RTN","LA7VIN3",6,0)
MSA ; Process MSA segment
"RTN","LA7VIN3",7,0)
 ; The incoming MSA is used to update the status of the message
"RTN","LA7VIN3",8,0)
 ; in the LA7 MESSAGE QUEUE (#62.49)
"RTN","LA7VIN3",9,0)
 ;
"RTN","LA7VIN3",10,0)
 ; and
"RTN","LA7VIN3",11,0)
 ;
"RTN","LA7VIN3",12,0)
 ; if acknowledging ORU message - the ORDERS PENDING (#69.6) file
"RTN","LA7VIN3",13,0)
 ; if acknowledging ORM message - the SHIPPING MANIFEST (#62.8) file
"RTN","LA7VIN3",14,0)
 ;
"RTN","LA7VIN3",15,0)
 N LA7696,LA76964,LA7I,LA7MSAID,LA7MSTAT,LA7ORT,LA7RUID,LA7ST,LA7SITE,LA7X,LA7Y
"RTN","LA7VIN3",16,0)
 S LA7MSTAT=$$P^LA7VHLU(.LA7SEG,2,LA7FS)
"RTN","LA7VIN3",17,0)
 S LA7MSAID=$$P^LA7VHLU(.LA7SEG,3,LA7FS)
"RTN","LA7VIN3",18,0)
 ;
"RTN","LA7VIN3",19,0)
 ; Extract text message from MSA-3
"RTN","LA7VIN3",20,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,4,LA7FS)
"RTN","LA7VIN3",21,0)
 S LA7MSATM=$$UNESC^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VIN3",22,0)
 ;
"RTN","LA7VIN3",23,0)
 ; Extract error condition from MSA-6
"RTN","LA7VIN3",24,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,7,LA7FS)
"RTN","LA7VIN3",25,0)
 I LA7X'="" D
"RTN","LA7VIN3",26,0)
 . S LA7Y=""
"RTN","LA7VIN3",27,0)
 . I $P(LA7X,$E(LA7ECH),2)'="" S LA7Y=$$UNESC^LA7VHLU3($P(LA7X,$E(LA7ECH),2),LA7FS_LA7ECH)
"RTN","LA7VIN3",28,0)
 . I $P(LA7X,$E(LA7ECH))'="" D
"RTN","LA7VIN3",29,0)
 . . I LA7Y="" S LA7Y=$$UNESC^LA7VHLU3($P(LA7X,$E(LA7ECH)),LA7FS_LA7ECH) Q
"RTN","LA7VIN3",30,0)
 . . S LA7Y="["_$P(LA7X,$E(LA7ECH))_"] "_LA7Y
"RTN","LA7VIN3",31,0)
 . S LA7MSATM=$S(LA7MSATM'="":LA7MSATM_" ",1:"")_LA7Y
"RTN","LA7VIN3",32,0)
 I LA7MSAID="" Q
"RTN","LA7VIN3",33,0)
 ;
"RTN","LA7VIN3",34,0)
 D SETID^LA7VHLU1(LA76249,LA7ID,"ACK-"_LA7MSAID)
"RTN","LA7VIN3",35,0)
 ;
"RTN","LA7VIN3",36,0)
 S LA7ST=$$FIND1^DIC(64.061,"","MX","Results/data Received","","I $P(^(0),U,7)=""U""")
"RTN","LA7VIN3",37,0)
 ;
"RTN","LA7VIN3",38,0)
 ; Only look for messages id's that are outgoing messages, those that
"RTN","LA7VIN3",39,0)
 ; originated from this system. Other systems (incoming) messages can
"RTN","LA7VIN3",40,0)
 ; use a message id that is the same as a Vista message.
"RTN","LA7VIN3",41,0)
 ;
"RTN","LA7VIN3",42,0)
 N LA76249
"RTN","LA7VIN3",43,0)
 S LA76249=0
"RTN","LA7VIN3",44,0)
 F  S LA76249=$O(^LAHM(62.49,"ID",LA7MSAID,LA76249)) Q:'LA76249  D
"RTN","LA7VIN3",45,0)
 . I $P($G(^LAHM(62.49,LA76249,0)),"^",2)'="O" Q
"RTN","LA7VIN3",46,0)
 . D UPDF
"RTN","LA7VIN3",47,0)
 ;
"RTN","LA7VIN3",48,0)
 Q
"RTN","LA7VIN3",49,0)
 ;
"RTN","LA7VIN3",50,0)
UPDF ; Update respective files
"RTN","LA7VIN3",51,0)
 ;
"RTN","LA7VIN3",52,0)
 N FDA,I,LA7ERR,LA7MTYPE,X
"RTN","LA7VIN3",53,0)
 ;
"RTN","LA7VIN3",54,0)
 F I=63,100 S LA76249(I)=$G(^LAHM(62.49,LA76249,I))
"RTN","LA7VIN3",55,0)
 ;
"RTN","LA7VIN3",56,0)
 ; Update original message in #62.49
"RTN","LA7VIN3",57,0)
 S FDA(1,62.49,LA76249_",",2)="X"
"RTN","LA7VIN3",58,0)
 I LA7MSTAT'="AA",LA7MSTAT'="CA" D
"RTN","LA7VIN3",59,0)
 . S FDA(1,62.49,LA76249_",",2)="E"
"RTN","LA7VIN3",60,0)
 . S FDA(1,62.49,LA76249_",",160)=LA7MSTAT
"RTN","LA7VIN3",61,0)
 . I LA7MSATM'="" S FDA(1,62.49,LA76249_",",161)=LA7MSATM
"RTN","LA7VIN3",62,0)
 D FILE^DIE("","FDA(1)","LA7ERR(1)")
"RTN","LA7VIN3",63,0)
 ;
"RTN","LA7VIN3",64,0)
 ; Send alert that original message had error.
"RTN","LA7VIN3",65,0)
 I LA7MSTAT'="AA",LA7MSTAT'="CA" D
"RTN","LA7VIN3",66,0)
 . D CREATE^LA7LOG(48)
"RTN","LA7VIN3",67,0)
 ;
"RTN","LA7VIN3",68,0)
 ; Retrieve original message's type.
"RTN","LA7VIN3",69,0)
 S LA7MTYPE=$P(LA76249(100),"^",9)
"RTN","LA7VIN3",70,0)
 ;
"RTN","LA7VIN3",71,0)
 ; If original message was an ORM, then update collecting facility's shipping manifest.
"RTN","LA7VIN3",72,0)
 I LA7MTYPE="ORM" D  Q
"RTN","LA7VIN3",73,0)
 . ; Need to code this section - JMC 1/12/00
"RTN","LA7VIN3",74,0)
 . ; Need to figure out the shipping manifest which is being acknowledged
"RTN","LA7VIN3",75,0)
 . Q
"RTN","LA7VIN3",76,0)
 ;
"RTN","LA7VIN3",77,0)
 I LA7MTYPE'="ORU" Q
"RTN","LA7VIN3",78,0)
 ; Rest of this deals with updating order/test status in LAB PENDING ORDER file
"RTN","LA7VIN3",79,0)
 ; at host lab when collection facility is acknowledging receipt of ORU message.
"RTN","LA7VIN3",80,0)
 ;
"RTN","LA7VIN3",81,0)
 I LA76249(63)="" Q
"RTN","LA7VIN3",82,0)
 S LA7SITE=$P(LA76249(63),U,2),LA7RUID=$P(LA76249(63),U,3)
"RTN","LA7VIN3",83,0)
 S LA7696=$O(^LRO(69.6,"RST",LA7SITE,LA7RUID,0))
"RTN","LA7VIN3",84,0)
 I LA7696="" Q
"RTN","LA7VIN3",85,0)
 ;
"RTN","LA7VIN3",86,0)
 ; Update order status in 69.6
"RTN","LA7VIN3",87,0)
 S FDA(2,69.6,LA7696_",",6)=LA7ST
"RTN","LA7VIN3",88,0)
 D FILE^DIE("","FDA(2)","LA7ERR(2)")
"RTN","LA7VIN3",89,0)
 ;
"RTN","LA7VIN3",90,0)
 S LA7ORT=$P(LA76249(63),U,4),LA76964=0
"RTN","LA7VIN3",91,0)
 I LA7ORT'="" S LA76964=$O(^LRO(69.6,LA7696,2,"B",LA7ORT,0))
"RTN","LA7VIN3",92,0)
 I 'LA76964 D
"RTN","LA7VIN3",93,0)
 . S LA7ORT=$P(LA76249(63),U,5)
"RTN","LA7VIN3",94,0)
 . I LA7ORT'="" S LA76964=$O(^LRO(69.6,LA7696,2,"C",LA7ORT,0))
"RTN","LA7VIN3",95,0)
 I LA76964<1 Q
"RTN","LA7VIN3",96,0)
 ;
"RTN","LA7VIN3",97,0)
 ; Update test status in 69.6
"RTN","LA7VIN3",98,0)
 S FDA(3,69.64,LA76964_","_LA7696_",",5)=LA7ST
"RTN","LA7VIN3",99,0)
 D FILE^DIE("","FDA(3)","LA7ERR(3)")
"RTN","LA7VIN3",100,0)
 ;
"RTN","LA7VIN3",101,0)
 Q
"RTN","LA7VIN4")
0^37^B71418151
"RTN","LA7VIN4",1,0)
LA7VIN4 ;DALOI/JMC - Process Incoming UI Msgs, continued ; 01/14/99
"RTN","LA7VIN4",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VIN4",3,0)
 ;This routine is a continuation of LA7VIN1 and is only called from there.
"RTN","LA7VIN4",4,0)
 Q
"RTN","LA7VIN4",5,0)
 ;
"RTN","LA7VIN4",6,0)
OBR ; Process OBR segments
"RTN","LA7VIN4",7,0)
 N I,LA7CUP,LA7ENTRY,LA7IDE,LA7INST,LA7PDUZ,LA7TRAY,LA7X,LA7Y
"RTN","LA7VIN4",8,0)
 ;
"RTN","LA7VIN4",9,0)
 ; OBR Set ID
"RTN","LA7VIN4",10,0)
 S LA7SOBR=$$P^LA7VHLU(.LA7SEG,2,LA7FS)
"RTN","LA7VIN4",11,0)
 ;
"RTN","LA7VIN4",12,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,19,LA7FS)
"RTN","LA7VIN4",13,0)
 S LA7X=$$UNESC^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VIN4",14,0)
 S LA7624=0,LA7INST=$P(LA7X,"^") ; extracting 1st piece
"RTN","LA7VIN4",15,0)
 ; Look up #62.4 entry from instrument name.
"RTN","LA7VIN4",16,0)
 I LA7INST'="" S LA7624=+$O(^LAB(62.4,"B",LA7INST,0))
"RTN","LA7VIN4",17,0)
 ;
"RTN","LA7VIN4",18,0)
 ; If none then use sending application name to look up #62.4 entry.
"RTN","LA7VIN4",19,0)
 I 'LA7624 S LA7624=+$O(^LAB(62.4,"B",LA7SAP,0))
"RTN","LA7VIN4",20,0)
 ;
"RTN","LA7VIN4",21,0)
 ; Instrument name not found in xref
"RTN","LA7VIN4",22,0)
 I 'LA7624 D  Q
"RTN","LA7VIN4",23,0)
 . I LA7INST="" D  Q
"RTN","LA7VIN4",24,0)
 . . S LA7ERR=10,LA7QUIT=2
"RTN","LA7VIN4",25,0)
 . . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN4",26,0)
 . S LA7ERR=11,LA7QUIT=2
"RTN","LA7VIN4",27,0)
 . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN4",28,0)
 S LA7624(0)=$G(^LAB(62.4,LA7624,0))
"RTN","LA7VIN4",29,0)
 S LA7ID=$P(LA7624(0),"^")_"-I-"
"RTN","LA7VIN4",30,0)
 ;
"RTN","LA7VIN4",31,0)
 S LA7LWL=+$P(LA7624(0),"^",4) ;  Load/Work List
"RTN","LA7VIN4",32,0)
 S LA7ENTRY=$P(LA7624(0),"^",6) ;LOG,LLIST,IDENT or SEQN
"RTN","LA7VIN4",33,0)
 S:LA7ENTRY="" LA7ENTRY="LOG"
"RTN","LA7VIN4",34,0)
 ;
"RTN","LA7VIN4",35,0)
 ; Placer(sender)/filler order numbers
"RTN","LA7VIN4",36,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,3,LA7FS)
"RTN","LA7VIN4",37,0)
 S LA7SID=$P(LA7X,$E(LA7ECH)) F I=2:1:4 S LA7SID(I)=$P(LA7X,$E(LA7ECH),I)
"RTN","LA7VIN4",38,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,4,LA7FS)
"RTN","LA7VIN4",39,0)
 S LA7FID=$P(LA7X,$E(LA7ECH)) F I=2:1:4 S LA7FID(I)=$P(LA7X,$E(LA7ECH),I)
"RTN","LA7VIN4",40,0)
 ;
"RTN","LA7VIN4",41,0)
 ; Test order code - find order NLT code
"RTN","LA7VIN4",42,0)
 ; If POC interface then see if NLT is used for ordering code
"RTN","LA7VIN4",43,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,5,LA7FS),LA7ONLT=""
"RTN","LA7VIN4",44,0)
 F I=1,4 D  Q:LA7ONLT'=""
"RTN","LA7VIN4",45,0)
 . I $P(LA7X,LA7CS,I)'?5N1"."4N Q
"RTN","LA7VIN4",46,0)
 . I $P(LA7X,LA7CS,I+2)="99VA64" S LA7ONLT=$P(LA7X,LA7CS,I),LA7ONLT(0)=$P(LA7X,LA7CS,I+1) Q
"RTN","LA7VIN4",47,0)
 . I LA7INTYP>19,LA7INTYP<30,$P(LA7X,LA7CS,I+2)="" S LA7ONLT=$P(LA7X,LA7CS,I),LA7ONLT(0)=$P(LA7X,LA7CS,I+1) Q
"RTN","LA7VIN4",48,0)
 ;
"RTN","LA7VIN4",49,0)
 ; Specimen collection date/time
"RTN","LA7VIN4",50,0)
 S LA7CDT=$$HL7TFM^XLFDT($P($$P^LA7VHLU(.LA7SEG,8,LA7FS),LA7CS),"L")
"RTN","LA7VIN4",51,0)
 ;
"RTN","LA7VIN4",52,0)
 ; Pull info from placer field #2 (OBR-19)
"RTN","LA7VIN4",53,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,20,LA7FS)
"RTN","LA7VIN4",54,0)
 S LA7X=$$UNESC^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VIN4",55,0)
 S LA7TRAY=+$P(LA7X,"^",1) ;Tray
"RTN","LA7VIN4",56,0)
 S LA7CUP=+$P(LA7X,"^",2) ; Cup
"RTN","LA7VIN4",57,0)
 ; If POC interface set cup to file #62.49 ien
"RTN","LA7VIN4",58,0)
 I LA7INTYP>19,LA7INTYP<30 S LA7CUP=LA76249
"RTN","LA7VIN4",59,0)
 S LA7AA=$P(LA7X,"^",3) ;  Accession Area
"RTN","LA7VIN4",60,0)
 S LA7AD=$P(LA7X,"^",4) ;  Accession Date
"RTN","LA7VIN4",61,0)
 S LA7AN=$P(LA7X,"^",5) ;  Accession Entry
"RTN","LA7VIN4",62,0)
 S LA7ACC=$P(LA7X,"^",6) ;  Accession
"RTN","LA7VIN4",63,0)
 S LA7UID=$P(LA7X,"^",7) ;  Unique ID
"RTN","LA7VIN4",64,0)
 I LA7UID'?1(10UN,15UN) S LA7UID=""
"RTN","LA7VIN4",65,0)
 ;
"RTN","LA7VIN4",66,0)
 ; Sequence Number
"RTN","LA7VIN4",67,0)
 ; If point of care interface (20-29) then use file #62.49 ien as IDE
"RTN","LA7VIN4",68,0)
 S LA7IDE=$P(LA7X,LA7CS,8)
"RTN","LA7VIN4",69,0)
 I LA7INTYP>19,LA7INTYP<30 S LA7IDE=LA76249
"RTN","LA7VIN4",70,0)
 ;
"RTN","LA7VIN4",71,0)
 ; UID might come as Sample ID
"RTN","LA7VIN4",72,0)
 I LA7UID="",LA7SID?1(10UN,15UN) S LA7UID=LA7SID
"RTN","LA7VIN4",73,0)
 ;
"RTN","LA7VIN4",74,0)
 ; Try to figure out LA7AA LA7AD LA7AN by using the unique ID (UID)
"RTN","LA7VIN4",75,0)
 ; accession may have rolled over, use UID to get current accession info.
"RTN","LA7VIN4",76,0)
 I LA7UID]"" D
"RTN","LA7VIN4",77,0)
 . N X
"RTN","LA7VIN4",78,0)
 . S X=$Q(^LRO(68,"C",LA7UID))
"RTN","LA7VIN4",79,0)
 . I $QS(X,3)'=LA7UID S LA7UID="" Q  ; UID not on file.
"RTN","LA7VIN4",80,0)
 . S LA7AA=+$QS(X,4),LA7AD=+$QS(X,5),LA7AN=+$QS(X,6)
"RTN","LA7VIN4",81,0)
 . D SETID^LA7VHLU1(LA76249,LA7ID,LA7UID)
"RTN","LA7VIN4",82,0)
 ;
"RTN","LA7VIN4",83,0)
 ; If still not known, compute from default accession date and area.
"RTN","LA7VIN4",84,0)
 ; Calculate accession date based on accession transform.
"RTN","LA7VIN4",85,0)
 I LA7AA<1!(LA7AD<1)!(LA7AN<1) D
"RTN","LA7VIN4",86,0)
 . N X
"RTN","LA7VIN4",87,0)
 . S LA7AA=+$P(LA7624(0),"^",11)
"RTN","LA7VIN4",88,0)
 . S X=$P($G(^LRO(68,LA7AA,0)),U,3)
"RTN","LA7VIN4",89,0)
 . S LA7AD=$S(X="D":DT,X="M":$E(DT,1,5)_"00",X="Y":$E(DT,1,3)_"0000",X="Q":$E(DT,1,3)_"0000"+(($E(DT,4,5)-1)\3*300+100),1:DT)
"RTN","LA7VIN4",90,0)
 . S LA7AN=+LA7SID
"RTN","LA7VIN4",91,0)
 . I LA7AN>0 D SETID^LA7VHLU1(LA76249,LA7ID,LA7AN)
"RTN","LA7VIN4",92,0)
 . E  D SETID^LA7VHLU1(LA76249,LA7ID,$S(LA7PNM]"":LA7PNM,LA7SSN]"":LA7SSN,1:"NO ID"))
"RTN","LA7VIN4",93,0)
 ;
"RTN","LA7VIN4",94,0)
 ; Zeroth node of acession area.
"RTN","LA7VIN4",95,0)
 S LA7AA(0)=$G(^LRO(68,+LA7AA,0))
"RTN","LA7VIN4",96,0)
 ; Accession's subscript
"RTN","LA7VIN4",97,0)
 S LA7SS=$P(LA7AA(0),"^",2)
"RTN","LA7VIN4",98,0)
 ;
"RTN","LA7VIN4",99,0)
 ; Specimen action code
"RTN","LA7VIN4",100,0)
 S LA7SAC=$$P^LA7VHLU(.LA7SEG,12,LA7FS)
"RTN","LA7VIN4",101,0)
 ;
"RTN","LA7VIN4",102,0)
 ; Specimen(topography), collection sample, HL7 specimen source
"RTN","LA7VIN4",103,0)
 S (LA761,LA762,LA70070,LA7SPEC)=""
"RTN","LA7VIN4",104,0)
 S LA7SPTY=$$P^LA7VHLU(.LA7SEG,16,LA7FS)
"RTN","LA7VIN4",105,0)
 ;
"RTN","LA7VIN4",106,0)
 ; Check if using HL7 table 0070
"RTN","LA7VIN4",107,0)
 S LA7X=$P($P(LA7SPTY,LA7CS),$E(LA7ECH,4),3)
"RTN","LA7VIN4",108,0)
 I LA7X=""!(LA7X="HL70070") S LA7SPEC=$P($P(LA7SPTY,LA7CS),$E(LA7ECH,4))
"RTN","LA7VIN4",109,0)
 ;
"RTN","LA7VIN4",110,0)
 I $O(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,5,0)) D
"RTN","LA7VIN4",111,0)
 . N X
"RTN","LA7VIN4",112,0)
 . S X=$O(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,5,0))
"RTN","LA7VIN4",113,0)
 . ; specimen^collection sample
"RTN","LA7VIN4",114,0)
 . S X(0)=$G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,5,X,0))
"RTN","LA7VIN4",115,0)
 . S LA761=$P(X(0),"^") ; specimen
"RTN","LA7VIN4",116,0)
 . S LA762=$P(X(0),"^",2) ; collection sample
"RTN","LA7VIN4",117,0)
 . ; HL7 code
"RTN","LA7VIN4",118,0)
 . I LA761 S LA70070=$$GET1^DIQ(61,LA761_",","LEDI HL7:HL7 ABBR")
"RTN","LA7VIN4",119,0)
 ;
"RTN","LA7VIN4",120,0)
 ; Log error when specimen source does not match accession's specimen
"RTN","LA7VIN4",121,0)
 I LA70070'="",LA7SPEC'="",LA70070'=LA7SPEC D
"RTN","LA7VIN4",122,0)
 . N LA7OBR
"RTN","LA7VIN4",123,0)
 . S LA7OBR(15)=LA7SPEC ; backward compatible with old code
"RTN","LA7VIN4",124,0)
 . S LA7ERR=22,LA7QUIT=2
"RTN","LA7VIN4",125,0)
 . D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VIN4",126,0)
 ;
"RTN","LA7VIN4",127,0)
 ; Don't continue if flag set to skip this segment
"RTN","LA7VIN4",128,0)
 I LA7QUIT Q
"RTN","LA7VIN4",129,0)
 ;
"RTN","LA7VIN4",130,0)
 ; Placer's ordering provider (id^duz^last name, first name, mi [id])
"RTN","LA7VIN4",131,0)
 I $G(LA7POP)="" D
"RTN","LA7VIN4",132,0)
 . S LA7POP="",LA7X=$$P^LA7VHLU(.LA7SEG,17,LA7FS)
"RTN","LA7VIN4",133,0)
 . I LA7X="" Q
"RTN","LA7VIN4",134,0)
 . S LA7POP=$$XCNTFM^LA7VHLU4(LA7X,LA7ECH)
"RTN","LA7VIN4",135,0)
 . I LA7POP="^^" S LA7POP=""
"RTN","LA7VIN4",136,0)
 ;
"RTN","LA7VIN4",137,0)
 ; Create entry in LAH for supported subscripts.
"RTN","LA7VIN4",138,0)
 I LA7MTYP="ORR",$G(LA7OTYPE)'="OK","CHMI"[LA7SS D
"RTN","LA7VIN4",139,0)
 . D LAGEN
"RTN","LA7VIN4",140,0)
 . I $G(LA7ISQN)="" D CREATE^LA7LOG(14) Q
"RTN","LA7VIN4",141,0)
 . S LA7I=$O(^TMP("LA7 ORDER STATUS",$J,""),-1),LA7I=LA7I+1
"RTN","LA7VIN4",142,0)
 . I LA7ONLT="" S X=$$P^LA7VHLU(.LA7SEG,5,LA7FS),LA7X=$P(X,LA7CS),LA7X(0)=$P(X,LA7CS,2)
"RTN","LA7VIN4",143,0)
 . E  S LA7X=LA7ONLT,LA7X(0)=LA7ONLT(0)
"RTN","LA7VIN4",144,0)
 . S X=LA7LWL_"^"_LA7ISQN_"^"_LA7X_"^"_LA7X(0)_"^"_LA76248_"^"_LA76249_"^"_LA7OTYPE_"^^"_$P($G(LA7SM),"^",2)
"RTN","LA7VIN4",145,0)
 . S ^TMP("LA7 ORDER STATUS",$J,LA7I)=X
"RTN","LA7VIN4",146,0)
 . I $G(LA7OCR)'="" S ^TMP("LA7 ORDER STATUS",$J,LA7I,"OCR")=$TR(LA7OCR,LA7CS,"^")
"RTN","LA7VIN4",147,0)
 . I $G(LA7MSATM)'="" S ^TMP("LA7 ORDER STATUS",$J,LA7I,"MSA")=LA7MSATM
"RTN","LA7VIN4",148,0)
 ;
"RTN","LA7VIN4",149,0)
 I LA7MTYP="ORU","CHMI"[LA7SS D
"RTN","LA7VIN4",150,0)
 . D LAGEN
"RTN","LA7VIN4",151,0)
 . I $G(LA7ISQN)<1 D CREATE^LA7LOG(14) Q
"RTN","LA7VIN4",152,0)
 . I LA7INTYP=10,LA7SAC?1(1"A",1"G") D
"RTN","LA7VIN4",153,0)
 . . S LA7I=$O(^TMP("LA7 ORDER STATUS",$J,""),-1),LA7I=LA7I+1,LA7SAC(0)=LA7I
"RTN","LA7VIN4",154,0)
 . . I LA7ONLT="" S X=$$P^LA7VHLU(.LA7SEG,5,LA7FS),LA7X=$P(X,LA7CS),LA7X(0)=$P(X,LA7CS,2)
"RTN","LA7VIN4",155,0)
 . . E  S LA7X=LA7ONLT,LA7X(0)=LA7ONLT(0)
"RTN","LA7VIN4",156,0)
 . . S X=LA7LWL_"^"_LA7ISQN_"^"_LA7X_"^"_LA7X(0)_"^"_LA76248_"^"_LA76249_"^"_LA7OTYPE_"^"_LA7SAC_"^"_$P($G(LA7SM),"^",2)
"RTN","LA7VIN4",157,0)
 . . S ^TMP("LA7 ORDER STATUS",$J,LA7I)=X
"RTN","LA7VIN4",158,0)
 ;
"RTN","LA7VIN4",159,0)
 I LA7INTYP=10,$G(LA7SM)'="",$G(LA7UID)'="" D SMUPDT
"RTN","LA7VIN4",160,0)
 Q
"RTN","LA7VIN4",161,0)
 ;
"RTN","LA7VIN4",162,0)
 ;
"RTN","LA7VIN4",163,0)
LAGEN ; Sets up variables for call to ^LAGEN,  build entry in LAH
"RTN","LA7VIN4",164,0)
 ; requires LA7INST,LA7TRAY,LA7CUP,LA7AA,LA7AD,LA7AN,LA7LWL
"RTN","LA7VIN4",165,0)
 ; returns LA7ISQN=subscript to store results in ^LAH global
"RTN","LA7VIN4",166,0)
 ;
"RTN","LA7VIN4",167,0)
 I LA7ENTRY="LOG" D
"RTN","LA7VIN4",168,0)
 . I LA7INTYP>19,LA7INTYP<30 Q
"RTN","LA7VIN4",169,0)
 . I '$D(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,0)) D CREATE^LA7LOG(13)
"RTN","LA7VIN4",170,0)
 I LA7ENTRY="LLIST" S:'LA7CUP LA7CUP=LA7IDE ;cup=sequence number
"RTN","LA7VIN4",171,0)
 ;
"RTN","LA7VIN4",172,0)
 K LA7ISQN,LADT,LAGEN
"RTN","LA7VIN4",173,0)
 K TRAY,CUP,LWL,WL,LROVER,METH,LOG,IDENT,ISQN
"RTN","LA7VIN4",174,0)
 ;
"RTN","LA7VIN4",175,0)
 S LA7ISQN=""
"RTN","LA7VIN4",176,0)
 S TRAY=+$G(LA7TRAY) S:'TRAY TRAY=1
"RTN","LA7VIN4",177,0)
 S CUP=+$G(LA7CUP) S:'CUP CUP=1
"RTN","LA7VIN4",178,0)
 ;
"RTN","LA7VIN4",179,0)
 S LWL=LA7LWL
"RTN","LA7VIN4",180,0)
 I '$D(^LRO(68.2,+LWL,0)) D  Q
"RTN","LA7VIN4",181,0)
 . D CREATE^LA7LOG(19)
"RTN","LA7VIN4",182,0)
 ;
"RTN","LA7VIN4",183,0)
 ; Set accession area to area of specimen, allow multiple areas on same instrument.
"RTN","LA7VIN4",184,0)
 S WL=LA7AA
"RTN","LA7VIN4",185,0)
 I '$D(^LRO(68,+WL,0)) D  Q
"RTN","LA7VIN4",186,0)
 . D CREATE^LA7LOG(20)
"RTN","LA7VIN4",187,0)
 S LROVER=$P(LA7624(0),"^",12)
"RTN","LA7VIN4",188,0)
 S METH=$P(LA7624(0),"^",10)
"RTN","LA7VIN4",189,0)
 S LOG=LA7AN
"RTN","LA7VIN4",190,0)
 S IDENT=$P($G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,0)),"^",6) ;identity field
"RTN","LA7VIN4",191,0)
 S IDE=+LA7IDE
"RTN","LA7VIN4",192,0)
 S LADT=LA7AD
"RTN","LA7VIN4",193,0)
 ;
"RTN","LA7VIN4",194,0)
 ; If POC interface call special entry point
"RTN","LA7VIN4",195,0)
 D
"RTN","LA7VIN4",196,0)
 . N LRDFN ; Protect LRDFN - call into LAGEN can set to 0
"RTN","LA7VIN4",197,0)
 . I LA7INTYP>19,LA7INTYP<30 S IDE=LA76249 D POC^LAGEN Q
"RTN","LA7VIN4",198,0)
 . D @(LA7ENTRY_"^LAGEN") ;this disregards the CROSS LINK field in 62.4
"RTN","LA7VIN4",199,0)
 S LA7ISQN=$G(ISQN)
"RTN","LA7VIN4",200,0)
 ;
"RTN","LA7VIN4",201,0)
 I LA7ISQN<1 Q
"RTN","LA7VIN4",202,0)
 ;
"RTN","LA7VIN4",203,0)
 ; Build/store patient demographics array
"RTN","LA7VIN4",204,0)
 N I,J,LA7OBRA,LA7PIDA,X,Y
"RTN","LA7VIN4",205,0)
 S J="DFN^DOB^ICN^LOC^LRDFN^LRTDFN^PNM^SEX^SSN"
"RTN","LA7VIN4",206,0)
 S J(0)="DFN^LA7DOB^LA7ICN^LA7LOC^LRDFN^LRTDFN^LA7PNM^LA7SEX^LA7SSN"
"RTN","LA7VIN4",207,0)
 F I=1:1 S X=$P(J,"^",I) Q:X=""  D
"RTN","LA7VIN4",208,0)
 . S Y=$P(J(0),"^",I)
"RTN","LA7VIN4",209,0)
 . I $G(@Y)'="" S LA7PIDA(X)=@Y
"RTN","LA7VIN4",210,0)
 I $D(LA7PIDA) D POI^LAGEN(LA7LWL,LA7ISQN,"PID",.LA7PIDA)
"RTN","LA7VIN4",211,0)
 ;
"RTN","LA7VIN4",212,0)
 ; Build/store order info array
"RTN","LA7VIN4",213,0)
 N LA7ONLTS
"RTN","LA7VIN4",214,0)
 I LA7POP'="" S LA7POP=$P(LA7POP," [")
"RTN","LA7VIN4",215,0)
 S X=$G(^LAH(LA7LWL,1,LA7ISQN,.1,"OBR","ORDNLT"))
"RTN","LA7VIN4",216,0)
 I X'="",LA7ONLT'="",X'[LA7ONLT S LA7ONLTS=X_"^"_LA7ONLT
"RTN","LA7VIN4",217,0)
 E  S LA7ONLTS=LA7ONLT
"RTN","LA7VIN4",218,0)
 S J="EOL^FID^ORCDT^ORDNLT^ORDP^ORDSPEC^PON^SID^PEB^PVB"
"RTN","LA7VIN4",219,0)
 S J(0)="LA7EOL^LA7FID^LA7CDT^LA7ONLTS^LA7POP^LA7SPEC^LA7PON^LA7SID^LA7PEB^LA7PVB"
"RTN","LA7VIN4",220,0)
 F I=1:1 S X=$P(J,"^",I) Q:X=""  D
"RTN","LA7VIN4",221,0)
 . S Y=$P(J(0),"^",I)
"RTN","LA7VIN4",222,0)
 . I $G(@Y)'="" S LA7OBRA(X)=@Y
"RTN","LA7VIN4",223,0)
 I $D(LA7OBRA) D POI^LAGEN(LA7LWL,LA7ISQN,"OBR",.LA7OBRA)
"RTN","LA7VIN4",224,0)
 ;
"RTN","LA7VIN4",225,0)
 ; Store interface type with results
"RTN","LA7VIN4",226,0)
 D LATYP^LAGEN(LA7LWL,LA7ISQN,LA7INTYP)
"RTN","LA7VIN4",227,0)
 ; 
"RTN","LA7VIN4",228,0)
 ; Store #62.49 ien with results
"RTN","LA7VIN4",229,0)
 D LAMSGID^LAGEN(LA7LWL,LA7ISQN,LA76249)
"RTN","LA7VIN4",230,0)
 ;
"RTN","LA7VIN4",231,0)
 ; Store method name with LAH entry
"RTN","LA7VIN4",232,0)
 D METH^LAGEN(LA7LWL,LA7ISQN,METH)
"RTN","LA7VIN4",233,0)
 ;
"RTN","LA7VIN4",234,0)
 ; Set flag if POC interface to start POC processing routine when
"RTN","LA7VIN4",235,0)
 ; finished - tasked by LA7VIN before shutdown
"RTN","LA7VIN4",236,0)
 I LA7INTYP>19,LA7INTYP<30 S LA7INTYP("LWL",LA7LWL)=""
"RTN","LA7VIN4",237,0)
 ;
"RTN","LA7VIN4",238,0)
 Q
"RTN","LA7VIN4",239,0)
 ;
"RTN","LA7VIN4",240,0)
 ;
"RTN","LA7VIN4",241,0)
SMUPDT ; Update shipping manifest in shipping event file #62.85
"RTN","LA7VIN4",242,0)
 N LA7DATA,LA7NCS,LA7TST,LA7USID
"RTN","LA7VIN4",243,0)
 ;
"RTN","LA7VIN4",244,0)
 S LA7USID=$$P^LA7VHLU(.LA7SEG,5,LA7FS) ; Universal Service ID (OBR-4)
"RTN","LA7VIN4",245,0)
 S LA7TST=$P(LA7USID,LA7CS,1) ; Test code
"RTN","LA7VIN4",246,0)
 S LA7NCS=$P(LA7USID,LA7CS,3) ; Name of coding system
"RTN","LA7VIN4",247,0)
 S LA7TST(2)=$P(LA7USID,LA7CS,4) ; Alternate test code
"RTN","LA7VIN4",248,0)
 S LA7NCS(2)=$P(LA7USID,LA7CS,6) ; Alternate coding system
"RTN","LA7VIN4",249,0)
 ;
"RTN","LA7VIN4",250,0)
 ; Determine ordered test, check primary and alternate
"RTN","LA7VIN4",251,0)
 S LA7OTST=$$DOT^LA7SMU1(LA7TST,LA7NCS,LA7UID,$P(LA7SM,"^"))
"RTN","LA7VIN4",252,0)
 I 'LA7OTST,LA7TST(2)'="" S LA7OTST=$$DOT^LA7SMU1(LA7TST(2),LA7NCS(2),LA7UID,$P(LA7SM,"^"))
"RTN","LA7VIN4",253,0)
 ;
"RTN","LA7VIN4",254,0)
 ; Flag the Results Received Event in #62.85
"RTN","LA7VIN4",255,0)
 I LA7MTYP="ORU" D
"RTN","LA7VIN4",256,0)
 . S LA7DATA="SM70"_"^"_LA7MEDT_"^"_$G(LA7OTST)_"^"_$P(LA7SM,"^",2)
"RTN","LA7VIN4",257,0)
 . D SEUP^LA7SMU(LA7UID,"2",LA7DATA)
"RTN","LA7VIN4",258,0)
 ;
"RTN","LA7VIN4",259,0)
 ; Flag the Test Received Event in #62.85
"RTN","LA7VIN4",260,0)
 I LA7MTYP="ORR" D
"RTN","LA7VIN4",261,0)
 . S LA7DATA="SM55"_"^"_LA7MEDT_"^"_$G(LA7OTST)_"^"_$P(LA7SM,"^",2)
"RTN","LA7VIN4",262,0)
 . D SEUP^LA7SMU(LA7UID,"2",LA7DATA)
"RTN","LA7VIN4",263,0)
 Q
"RTN","LA7VIN5")
0^9^B52231590
"RTN","LA7VIN5",1,0)
LA7VIN5 ;DALOI/JMC - Process Incoming UI Msgs, continued ; 01/14/99
"RTN","LA7VIN5",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VIN5",3,0)
 ; This routine is a continuation of LA7VIN1 and is only called from there.
"RTN","LA7VIN5",4,0)
 ; It is called to process OBX segments for "CH" subscript tests.
"RTN","LA7VIN5",5,0)
 Q
"RTN","LA7VIN5",6,0)
 ;
"RTN","LA7VIN5",7,0)
OBX ;
"RTN","LA7VIN5",8,0)
 ;
"RTN","LA7VIN5",9,0)
 N LA76241,LA76304,LA7EII,LA7I,LA7LIMIT,LA7OBM,LA7SUBFL,LA7TEST,LA7TREEN,LA7UNITS,LA7VAL,LA7VTYP,LA7X,LA7XFORM,LA7Y
"RTN","LA7VIN5",10,0)
 ;
"RTN","LA7VIN5",11,0)
 K LA7RMK,^TMP("LA7TREE",$J)
"RTN","LA7VIN5",12,0)
 ;
"RTN","LA7VIN5",13,0)
 S LA7SUBFL=63.04
"RTN","LA7VIN5",14,0)
 ;
"RTN","LA7VIN5",15,0)
 ; OBX Set ID
"RTN","LA7VIN5",16,0)
 S LA7SOBX=$$P^LA7VHLU(.LA7SEG,2,LA7FS)
"RTN","LA7VIN5",17,0)
 ;
"RTN","LA7VIN5",18,0)
 ; Value type - type of data from Table 0125
"RTN","LA7VIN5",19,0)
 S LA7VTYP=$P($$P^LA7VHLU(.LA7SEG,3,LA7FS),LA7CS)
"RTN","LA7VIN5",20,0)
 ;
"RTN","LA7VIN5",21,0)
 ; Determine test result codes - check for primary and alternate codes
"RTN","LA7VIN5",22,0)
 ; For DoD/CHCS interface - do NOT process test codes using 99LRT as coding system per DoD/July 2002.
"RTN","LA7VIN5",23,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,4,LA7FS),(LA7RNLT,LA7RLNC)=""
"RTN","LA7VIN5",24,0)
 S LA7TEST=$P(LA7X,LA7CS)
"RTN","LA7VIN5",25,0)
 S LA7TEST(0)=$$UNESC^LA7VHLU3($P(LA7X,LA7CS,2),LA7FS_LA7ECH)
"RTN","LA7VIN5",26,0)
 I LA7TEST(0)["^" S LA7TEST(0)=$TR(LA7TEST(0),"^","~")
"RTN","LA7VIN5",27,0)
 S LA7TEST(0,1)=$P(LA7X,LA7CS,3)
"RTN","LA7VIN5",28,0)
 S LA7TEST(2)=$P(LA7X,LA7CS,4)
"RTN","LA7VIN5",29,0)
 S LA7TEST(2,0)=$$UNESC^LA7VHLU3($P(LA7X,LA7CS,5),LA7FS_LA7ECH)
"RTN","LA7VIN5",30,0)
 I LA7TEST(2,0)["^" S LA7TEST(2,0)=$TR(LA7TEST(2,0),"^","~")
"RTN","LA7VIN5",31,0)
 S LA7TEST(2,1)=$P(LA7X,LA7CS,6)
"RTN","LA7VIN5",32,0)
 F I=3,6 D
"RTN","LA7VIN5",33,0)
 . S LA7Y=$P(LA7X,LA7CS,I-2)
"RTN","LA7VIN5",34,0)
 . I $P(LA7X,LA7CS,I)="LN" D  Q
"RTN","LA7VIN5",35,0)
 . . I $$GET1^DIQ(95.3,+LA7Y_",",.01)=LA7Y S LA7RLNC=+LA7Y
"RTN","LA7VIN5",36,0)
 . I $P(LA7X,LA7CS,I)="99VA64" D  Q
"RTN","LA7VIN5",37,0)
 . . I $$FIND1^DIC(64,"","OMX",LA7Y) S LA7RNLT=LA7Y
"RTN","LA7VIN5",38,0)
 . I $P(LA7X,LA7CS,I)="99LRT" D  Q
"RTN","LA7VIN5",39,0)
 . . I LA7TEST(0)="",LA7TEST(2,0)'="" S LA7TEST(0)=LA7TEST(2,0)
"RTN","LA7VIN5",40,0)
 . . I LA7TEST(2,0)="",LA7TEST(0)'="" S LA7TEST(2,0)=LA7TEST(0)
"RTN","LA7VIN5",41,0)
 . . I I=3 S (LA7TEST,LA7TEST(0),LA7TEST(0,1))="" Q
"RTN","LA7VIN5",42,0)
 . . I I=6 S (LA7TEST(2),LA7TEST(2,0),LA7TEST(2,1))="" Q
"RTN","LA7VIN5",43,0)
 I LA7TEST="",LA7TEST(2)'="" D
"RTN","LA7VIN5",44,0)
 . S LA7TEST=LA7TEST(2),LA7TEST(0)=LA7TEST(2,0),LA7TEST(0,1)=LA7TEST(2,1)
"RTN","LA7VIN5",45,0)
 . S (LA7TEST(2),LA7TEST(2,0),LA7TEST(2,1))=""
"RTN","LA7VIN5",46,0)
 ;
"RTN","LA7VIN5",47,0)
 ; No test code in message
"RTN","LA7VIN5",48,0)
 I LA7TEST="",LA7TEST(2)="" D  Q
"RTN","LA7VIN5",49,0)
 . N LA7OBX
"RTN","LA7VIN5",50,0)
 . S LA7OBX=LA7SEG(0)
"RTN","LA7VIN5",51,0)
 . D CREATE^LA7LOG(15)
"RTN","LA7VIN5",52,0)
 ;
"RTN","LA7VIN5",53,0)
 ; Test code not found in auto inst file, also check alternate codes,
"RTN","LA7VIN5",54,0)
 ; and log error if none found.
"RTN","LA7VIN5",55,0)
 I LA7MTYP="ORU" D  Q:LA7TEST=""
"RTN","LA7VIN5",56,0)
 . I LA7TEST'="",$D(^LAB(62.4,LA7624,3,"AC",LA7TEST)) Q
"RTN","LA7VIN5",57,0)
 . I LA7TEST(2)'="",$D(^LAB(62.4,LA7624,3,"AC",LA7TEST(2))) D  Q
"RTN","LA7VIN5",58,0)
 . . S LA7TEST=LA7TEST(2),LA7TEST(0)=LA7TEST(2,0),LA7TEST(0,1)=LA7TEST(2,1)
"RTN","LA7VIN5",59,0)
 . D CREATE^LA7LOG(16) S LA7TEST=""
"RTN","LA7VIN5",60,0)
 ;
"RTN","LA7VIN5",61,0)
 ; Units - trim leading/trailing spaces
"RTN","LA7VIN5",62,0)
 S LA7UNITS=$$P^LA7VHLU(.LA7SEG,7,LA7FS)
"RTN","LA7VIN5",63,0)
 I LA7UNITS]"" S LA7UNITS=$$TRIM^XLFSTR(LA7UNITS,"LR"," ")
"RTN","LA7VIN5",64,0)
 ;
"RTN","LA7VIN5",65,0)
 ; Observation result status - Table 0085
"RTN","LA7VIN5",66,0)
 S LA7ORS=$$P^LA7VHLU(.LA7SEG,12,LA7FS)
"RTN","LA7VIN5",67,0)
 ;
"RTN","LA7VIN5",68,0)
 ; Responsible observer
"RTN","LA7VIN5",69,0)
 S LA7RO=$$XCNTFM^LA7VHLU4($$P^LA7VHLU(.LA7SEG,17,LA7FS),LA7ECH)
"RTN","LA7VIN5",70,0)
 ;
"RTN","LA7VIN5",71,0)
 ; Observation method
"RTN","LA7VIN5",72,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,18,LA7FS),LA7OBM=""
"RTN","LA7VIN5",73,0)
 I $P(LA7X,LA7CS,3)="99VA64_2" S LA7OBM=$P($P(LA7X,LA7CS,1),".",2)
"RTN","LA7VIN5",74,0)
 ;
"RTN","LA7VIN5",75,0)
 ; Equipment instance identifier
"RTN","LA7VIN5",76,0)
 S LA7EII=$$P^LA7VHLU(.LA7SEG,19,LA7FS)
"RTN","LA7VIN5",77,0)
 I LA7EII'="" D
"RTN","LA7VIN5",78,0)
 . S LA7EII=$$UNESC^LA7VHLU3(LA7EII,LA7FS_LA7ECH)
"RTN","LA7VIN5",79,0)
 . S LA7EII=$TR(LA7EII,"^",";")
"RTN","LA7VIN5",80,0)
 ;
"RTN","LA7VIN5",81,0)
 ; Process ORU message results for all tests which use this test code.
"RTN","LA7VIN5",82,0)
 I LA7MTYP="ORU" D  Q
"RTN","LA7VIN5",83,0)
 . S LA76241=0
"RTN","LA7VIN5",84,0)
 . F  S LA76241=$O(^LAB(62.4,LA7624,3,"AC",LA7TEST,LA76241)) Q:'LA76241  D PROCESS
"RTN","LA7VIN5",85,0)
 ;
"RTN","LA7VIN5",86,0)
 I LA7MTYP="ORM",$G(LA7696)>0 D ORESULTS^LA7VIN5A
"RTN","LA7VIN5",87,0)
 ;
"RTN","LA7VIN5",88,0)
 Q
"RTN","LA7VIN5",89,0)
 ;
"RTN","LA7VIN5",90,0)
 ;
"RTN","LA7VIN5",91,0)
PROCESS ; Process results for a given test code
"RTN","LA7VIN5",92,0)
 S LA7VAL=$$P^LA7VHLU(.LA7SEG,6,LA7FS)
"RTN","LA7VIN5",93,0)
 I LA7VTYP="CE",$P(LA7VAL,LA7CS,2)'="" S LA7VAL=$P(LA7VAL,LA7CS,2)
"RTN","LA7VIN5",94,0)
 E  S LA7VAL=$P(LA7VAL,LA7CS)
"RTN","LA7VIN5",95,0)
 ;
"RTN","LA7VIN5",96,0)
 F LA7I=0,1,2 S LA76241(LA7I)=$G(^LAB(62.4,LA7624,3,LA76241,LA7I))
"RTN","LA7VIN5",97,0)
 ;
"RTN","LA7VIN5",98,0)
 ; Chem test fields incorrect
"RTN","LA7VIN5",99,0)
 I (LA76241(0)="")!(LA76241(1)="") D  Q
"RTN","LA7VIN5",100,0)
 . D CREATE^LA7LOG(18)
"RTN","LA7VIN5",101,0)
 ;
"RTN","LA7VIN5",102,0)
 ; Setup LA7RMK(0) variable in case comments (NTE) sent with test results.
"RTN","LA7VIN5",103,0)
 S LA7RMK(0,+LA76241(0))=+$P(LA76241(2),"^",7)_"^"_$P(LA76241(2),"^",8)
"RTN","LA7VIN5",104,0)
 ;
"RTN","LA7VIN5",105,0)
 S LA76304=+$P(LA76241(1),"(",2) ;lab data field
"RTN","LA7VIN5",106,0)
 ; No dataname for this result
"RTN","LA7VIN5",107,0)
 I LA76304'>1 D  Q
"RTN","LA7VIN5",108,0)
 . D CREATE^LA7LOG(18)
"RTN","LA7VIN5",109,0)
 ;
"RTN","LA7VIN5",110,0)
 ; Set flag for new results alert
"RTN","LA7VIN5",111,0)
 I "CDW"'[LA7ORS S ^TMP("LA7-ORU",$J,LA76248,LA76249)=""
"RTN","LA7VIN5",112,0)
 ;
"RTN","LA7VIN5",113,0)
 ; Set flag to send amended results bulletin
"RTN","LA7VIN5",114,0)
 I "CDW"[LA7ORS D
"RTN","LA7VIN5",115,0)
 . S LA7I=$O(^TMP("LA7 AMENDED RESULTS",$J,""),-1),LA7I=LA7I+1
"RTN","LA7VIN5",116,0)
 . S X=LA7LWL_"^"_LA7ISQN_"^"_LA76304_"^"_LA76248_"^"_LA76249_"^"_LA7ORS_"^"_LA7TEST_"^"_$S(LA7TEST(0)'="":LA7TEST(0),1:LA7TEST(2,0))_"^"_$$P^LA7VHLU(.LA7SEG,9,LA7FS)
"RTN","LA7VIN5",117,0)
 . S ^TMP("LA7 AMENDED RESULTS",$J,LA7I)=X
"RTN","LA7VIN5",118,0)
 . I LA7UID'="" S ^LAH("LA7 AMENDED RESULTS",LA7UID,LA76304,LA7LWL,LA7ISQN)=X
"RTN","LA7VIN5",119,0)
 ;
"RTN","LA7VIN5",120,0)
 ; NOTE - this array can be set from inside PARAM 1
"RTN","LA7VIN5",121,0)
 K LA7XFORM
"RTN","LA7VIN5",122,0)
 ; execute PARAM 1 if not a LEDI interface
"RTN","LA7VIN5",123,0)
 I LA7INTYP'=10 X $P(LA76241(0),"^",2)
"RTN","LA7VIN5",124,0)
 I $P(LA76241(2),"^",3)=0 Q
"RTN","LA7VIN5",125,0)
 I $P(LA76241(2),"^",3)=2,"CFUX"'[LA7ORS Q
"RTN","LA7VIN5",126,0)
 ;
"RTN","LA7VIN5",127,0)
 ; No value found
"RTN","LA7VIN5",128,0)
 I LA7VAL="" D  Q
"RTN","LA7VIN5",129,0)
 . D CREATE^LA7LOG(17)
"RTN","LA7VIN5",130,0)
 ;
"RTN","LA7VIN5",131,0)
 ; Transform result based on fields in file 62.4
"RTN","LA7VIN5",132,0)
 D XFORM^LA7VIN5A
"RTN","LA7VIN5",133,0)
 Q:LA7VAL=""
"RTN","LA7VIN5",134,0)
 ;
"RTN","LA7VIN5",135,0)
 ; Check if result passes input transform on data name
"RTN","LA7VIN5",136,0)
 D CHKDIE^LA7VIN5A
"RTN","LA7VIN5",137,0)
 Q:LA7VAL=""
"RTN","LA7VIN5",138,0)
 ;
"RTN","LA7VIN5",139,0)
 ; Set flag to not store comments if it wasn't explicitly ordered.
"RTN","LA7VIN5",140,0)
 I $G(LA7LIMIT)=1 D
"RTN","LA7VIN5",141,0)
 . N LA76804
"RTN","LA7VIN5",142,0)
 . K LA7LIMIT,LA7TREEN,^TMP("LA7TREE",$J)
"RTN","LA7VIN5",143,0)
 . ; Store all tests accessioned in ^TMP
"RTN","LA7VIN5",144,0)
 . S LA76804=0
"RTN","LA7VIN5",145,0)
 . F  S LA76804=$O(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,4,LA76804)) Q:'LA76804  D UNWIND^LA7UTIL(LA76804)
"RTN","LA7VIN5",146,0)
 . I '$D(^TMP("LA7TREE",$J,+LA76241(0))) S LA7LIMIT=1 ;wasn't ordered
"RTN","LA7VIN5",147,0)
 I $G(LA7LIMIT) D  Q
"RTN","LA7VIN5",148,0)
 . S $P(LA7RMK(0,+LA76241(0)),"^",1)=0
"RTN","LA7VIN5",149,0)
 . K LA7LIMIT,^TMP("LA7TREE",$J)
"RTN","LA7VIN5",150,0)
 K ^TMP("LA7TREE",$J)
"RTN","LA7VIN5",151,0)
 ;
"RTN","LA7VIN5",152,0)
 ; Check point of care interface for matching specimen type
"RTN","LA7VIN5",153,0)
 ; for this test in #62.4
"RTN","LA7VIN5",154,0)
 I LA7INTYP>19,LA7INTYP<30 D  Q:'LA761
"RTN","LA7VIN5",155,0)
 . N LA70070
"RTN","LA7VIN5",156,0)
 . S LA761="",LA7X=$P(LA76241(2),"^",13) Q:'LA7X
"RTN","LA7VIN5",157,0)
 . S LA70070=$$GET1^DIQ(61,LA7X_",","LEDI HL7:HL7 ABBR")
"RTN","LA7VIN5",158,0)
 . I LA70070=LA7SPEC S LA761=LA7X
"RTN","LA7VIN5",159,0)
 ;
"RTN","LA7VIN5",160,0)
 ; Set data node=test value
"RTN","LA7VIN5",161,0)
 S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^")=LA7VAL
"RTN","LA7VIN5",162,0)
 ;
"RTN","LA7VIN5",163,0)
 ; Store reference ranges
"RTN","LA7VIN5",164,0)
 D REFRNG^LA7VIN5A($$P^LA7VHLU(.LA7SEG,8,LA7FS))
"RTN","LA7VIN5",165,0)
 ;
"RTN","LA7VIN5",166,0)
 ; Store order/result codes/observation method
"RTN","LA7VIN5",167,0)
 S LA7X=$P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",3)
"RTN","LA7VIN5",168,0)
 I LA7ONLT S $P(LA7X,"!",1)=LA7ONLT
"RTN","LA7VIN5",169,0)
 I LA7RNLT S $P(LA7X,"!",2)=LA7RNLT
"RTN","LA7VIN5",170,0)
 I LA7RLNC S $P(LA7X,"!",3)=LA7RLNC
"RTN","LA7VIN5",171,0)
 I LA7OBM S $P(LA7X,"!",4)=LA7OBM
"RTN","LA7VIN5",172,0)
 S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",3)=LA7X
"RTN","LA7VIN5",173,0)
 ; 
"RTN","LA7VIN5",174,0)
 ; Store abnormal flags
"RTN","LA7VIN5",175,0)
 D ABFLAG^LA7VIN5A($$P^LA7VHLU(.LA7SEG,9,LA7FS))
"RTN","LA7VIN5",176,0)
 ;
"RTN","LA7VIN5",177,0)
 ; Store units
"RTN","LA7VIN5",178,0)
 I LA7UNITS'="" D
"RTN","LA7VIN5",179,0)
 . S LA7X=$P($G(^LAH(LA7LWL,1,LA7ISQN,LA76304)),"^",5)
"RTN","LA7VIN5",180,0)
 . S $P(LA7X,"!",7)=LA7UNITS
"RTN","LA7VIN5",181,0)
 . S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",5)=LA7X
"RTN","LA7VIN5",182,0)
 ;
"RTN","LA7VIN5",183,0)
 ; Store responsible observer on POC interfaces
"RTN","LA7VIN5",184,0)
 I LA7RO'="",LA7INTYP>19,LA7INTYP<30 D
"RTN","LA7VIN5",185,0)
 . I $P(LA7RO,"^",2) S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",4)=$P(LA7RO,"^",2)
"RTN","LA7VIN5",186,0)
 ;
"RTN","LA7VIN5",187,0)
 ; Store specimen type
"RTN","LA7VIN5",188,0)
 I $G(LA761) D
"RTN","LA7VIN5",189,0)
 . S X=$P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",5)
"RTN","LA7VIN5",190,0)
 . S $P(X,"!")=LA761
"RTN","LA7VIN5",191,0)
 . S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",5)=X
"RTN","LA7VIN5",192,0)
 ;
"RTN","LA7VIN5",193,0)
 ; Store where test was performed.
"RTN","LA7VIN5",194,0)
 D PRDID^LA7VIN5A($$P^LA7VHLU(.LA7SEG,16,LA7FS),LA7SFAC,LA7CS)
"RTN","LA7VIN5",195,0)
 ;
"RTN","LA7VIN5",196,0)
 ; Store equipment instance identifier
"RTN","LA7VIN5",197,0)
 I LA7EII'="" D EII^LA7VIN5A
"RTN","LA7VIN5",198,0)
 ;
"RTN","LA7VIN5",199,0)
 ; If results for LEDI interface (LA7INTYP=10) and site keeps file #60
"RTN","LA7VIN5",200,0)
 ; in sync with reference lab then compare message's units and normals
"RTN","LA7VIN5",201,0)
 ; with site's to detect changes(LA7FLAG=1) and notify site.
"RTN","LA7VIN5",202,0)
 I LA7INTYP=10,$G(LA761),$G(^LAB(60,+$P(LA76241(0),"^"),1,LA761,.1)) D
"RTN","LA7VIN5",203,0)
 . N LA760,LA7FLAG,LA7I,LA7Y,LA7X
"RTN","LA7VIN5",204,0)
 . S LA760=+$P(LA76241(0),"^"),LA7Y=^LAB(60,LA760,1,LA761,0),LA7FLAG=0
"RTN","LA7VIN5",205,0)
 . S LA7X=$P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",5)
"RTN","LA7VIN5",206,0)
 . I $P(LA7Y,"^",7)'=$P(LA7X,"!",7) S LA7FLAG=1
"RTN","LA7VIN5",207,0)
 . I 'LA7FLAG,$P(LA7Y,"^",2)=$P(LA7X,"!",2),$P(LA7Y,"^",3)=$P(LA7X,"!",3) Q
"RTN","LA7VIN5",208,0)
 . I 'LA7FLAG D
"RTN","LA7VIN5",209,0)
 . . N AGE,DOB,PNM,SEX
"RTN","LA7VIN5",210,0)
 . . N LRDPF,LRNG,LRNGS,LRNG2,LRNG3,LRNG4,LRNG5,LRTREA,LRWRD,LRX,LRY
"RTN","LA7VIN5",211,0)
 . . I $G(LRDFN) D DEM^LRX,KVAR^VADPT
"RTN","LA7VIN5",212,0)
 . . S LRNG=LA7Y D NORM^LRVER5
"RTN","LA7VIN5",213,0)
 . . S LA7Y=$TR(LRNG,$C(34),""),LA7X=$TR(LA7X,$C(34),"")
"RTN","LA7VIN5",214,0)
 . . I $P(LA7Y,"^",2)=$P(LA7X,"!",2),$P(LA7Y,"^",3)=$P(LA7X,"!",3) Q
"RTN","LA7VIN5",215,0)
 . . S LA7FLAG=1
"RTN","LA7VIN5",216,0)
 . I 'LA7FLAG Q
"RTN","LA7VIN5",217,0)
 . S LA7I=$O(^TMP("LA7 UNITS/NORMALS CHANGED",$J,""),-1),LA7I=LA7I+1
"RTN","LA7VIN5",218,0)
 . S X=LA7LWL_"^"_LA7ISQN_"^"_LA76304_"^"_LA76248_"^"_LA76249_"^"_LA7ORS_"^"_LA7TEST_"^"_$S(LA7TEST(0)'="":LA7TEST(0),1:LA7TEST(2,0))_"^"_$$P^LA7VHLU(.LA7SEG,9,LA7FS)_"^"_LA760
"RTN","LA7VIN5",219,0)
 . S ^TMP("LA7 UNITS/NORMALS CHANGED",$J,LA7I)=X
"RTN","LA7VIN5",220,0)
 ;
"RTN","LA7VIN5",221,0)
 ; If LEDI interface and order status change store which results
"RTN","LA7VIN5",222,0)
 ; associated with ordered test. Used to determine if order status
"RTN","LA7VIN5",223,0)
 ; changed bulletin needs to be generated.
"RTN","LA7VIN5",224,0)
 I LA7INTYP=10,LA7SAC?1(1"A",1"G") D
"RTN","LA7VIN5",225,0)
 . S LA7I=$G(LA7SAC(0)) Q:'LA7I
"RTN","LA7VIN5",226,0)
 . S ^TMP("LA7 ORDER STATUS",$J,LA7I,+LA76241(0))=""
"RTN","LA7VIN5",227,0)
 Q
"RTN","LA7VIN5A")
0^32^B56260928
"RTN","LA7VIN5A",1,0)
LA7VIN5A ;DALOI/JMC - Process Incoming UI Msgs, continued ; 01/14/99
"RTN","LA7VIN5A",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VIN5A",3,0)
 ; This routine is a continuation of LA7VIN5.
"RTN","LA7VIN5A",4,0)
 ; It is performs processing of fields in OBX segments.
"RTN","LA7VIN5A",5,0)
 Q
"RTN","LA7VIN5A",6,0)
 ;
"RTN","LA7VIN5A",7,0)
XFORM ; Transform the result based on fields 12,13,14,16,17 in the Chem Test
"RTN","LA7VIN5A",8,0)
 ; multiple in the Auto Instrument file (62.4), or set on the fly
"RTN","LA7VIN5A",9,0)
 ; from PARAM 1
"RTN","LA7VIN5A",10,0)
 N LA7I
"RTN","LA7VIN5A",11,0)
 S LA7XFORM=LA76241(2)
"RTN","LA7VIN5A",12,0)
 ;
"RTN","LA7VIN5A",13,0)
 ; get PARAM 1 overides
"RTN","LA7VIN5A",14,0)
 I $D(LA7XFORM(1)),LA7XFORM(1)?1.N S $P(LA7XFORM,"^")=LA7XFORM(1)
"RTN","LA7VIN5A",15,0)
 F LA7I=2,3,5,6 I $D(LA7XFORM(LA7I)) S $P(LA7XFORM,"^",LA7I)=LA7XFORM(LA7I)
"RTN","LA7VIN5A",16,0)
 ; set up defaults if field was not answered
"RTN","LA7VIN5A",17,0)
 ; accept results,yes
"RTN","LA7VIN5A",18,0)
 I $P(LA7XFORM,"^",3)="" S $P(LA7XFORM,"^",3)=1
"RTN","LA7VIN5A",19,0)
 ; strip spaces,no
"RTN","LA7VIN5A",20,0)
 I $P(LA7XFORM,"^",6)="" S $P(LA7XFORM,"^",6)=0
"RTN","LA7VIN5A",21,0)
 ; now transform
"RTN","LA7VIN5A",22,0)
 ;
"RTN","LA7VIN5A",23,0)
 ; Don't accept results
"RTN","LA7VIN5A",24,0)
 I '$P(LA7XFORM,"^",3) S LA7VAL="" Q
"RTN","LA7VIN5A",25,0)
 ;
"RTN","LA7VIN5A",26,0)
 ; Only accept "FINAL" type results
"RTN","LA7VIN5A",27,0)
 I $P(LA7XFORM,"^",3)=2,"CFU"'[LA7ORS S LA7VAL="" Q
"RTN","LA7VIN5A",28,0)
 ;
"RTN","LA7VIN5A",29,0)
 ; Accept ordered tests only
"RTN","LA7VIN5A",30,0)
 ; If LEDI interface (10) and message indicates a reflex ("G") or add-on
"RTN","LA7VIN5A",31,0)
 ; test ("A") then process anyway in case it has not been added to
"RTN","LA7VIN5A",32,0)
 ; accession.
"RTN","LA7VIN5A",33,0)
 I $P(LA7XFORM,"^",5) D
"RTN","LA7VIN5A",34,0)
 . I LA7INTYP=10,LA7SAC?1(1"A",1"G") Q
"RTN","LA7VIN5A",35,0)
 . S LA7LIMIT=1
"RTN","LA7VIN5A",36,0)
 ;
"RTN","LA7VIN5A",37,0)
 ; Decimal places if number of places defined
"RTN","LA7VIN5A",38,0)
 I $P(LA7XFORM,"^")?1.N D JUSTDEC
"RTN","LA7VIN5A",39,0)
 ;
"RTN","LA7VIN5A",40,0)
 ; Strip spaces
"RTN","LA7VIN5A",41,0)
 I $P(LA7XFORM,"^",6) S LA7VAL=$TR(LA7VAL," ","")
"RTN","LA7VIN5A",42,0)
 ;
"RTN","LA7VIN5A",43,0)
 ; Make result a comment
"RTN","LA7VIN5A",44,0)
 ; Set value to null after making into remark, don't store twice.
"RTN","LA7VIN5A",45,0)
 I $P(LA7XFORM,"^",2) D
"RTN","LA7VIN5A",46,0)
 . N LA7Y
"RTN","LA7VIN5A",47,0)
 . ; Store comment in ^LAH global
"RTN","LA7VIN5A",48,0)
 . S LA7Y=$P(LA7RMK(0,+LA76241(0)),"^",2)
"RTN","LA7VIN5A",49,0)
 . D RMKSET^LASET(LA7LWL,LA7ISQN,LA7VAL,LA7Y)
"RTN","LA7VIN5A",50,0)
 . S LA7VAL=""
"RTN","LA7VIN5A",51,0)
 Q
"RTN","LA7VIN5A",52,0)
 ;
"RTN","LA7VIN5A",53,0)
 ;
"RTN","LA7VIN5A",54,0)
CHKDIE ; Check if value to be stored passes input transform of field in DD
"RTN","LA7VIN5A",55,0)
 N LA7ERR,LA7Y
"RTN","LA7VIN5A",56,0)
 ;
"RTN","LA7VIN5A",57,0)
 ; If result is on a LEDI interface (type=10) then don't check result
"RTN","LA7VIN5A",58,0)
 ; against FileMan input tranform.
"RTN","LA7VIN5A",59,0)
 ; VistA sends "canc" as test result when test is cancelled.
"RTN","LA7VIN5A",60,0)
 ; DoD sends "PL Canceled" --> change to "canc" for VistA storage.
"RTN","LA7VIN5A",61,0)
 I LA7INTYP=10 D  Q
"RTN","LA7VIN5A",62,0)
 . I LA7VAL="PL Cancelled" S LA7VAL="canc"
"RTN","LA7VIN5A",63,0)
 . I LA7VAL="PL Canceled" S LA7VAL="canc"
"RTN","LA7VIN5A",64,0)
 . I LA7VAL="PLCanceled" S LA7VAL="canc"
"RTN","LA7VIN5A",65,0)
 ;
"RTN","LA7VIN5A",66,0)
 ; If value fails data checker then log error and suppress result.
"RTN","LA7VIN5A",67,0)
 D CHK^DIE(LA7SUBFL,LA76304,"H",LA7VAL,.LA7Y,"LA7ERR")
"RTN","LA7VIN5A",68,0)
 I LA7Y="^" D
"RTN","LA7VIN5A",69,0)
 . N LA7X
"RTN","LA7VIN5A",70,0)
 . S LA7X=$G(LA7ERR("DIERR",1,"TEXT",1))
"RTN","LA7VIN5A",71,0)
 . D CREATE^LA7LOG(37)
"RTN","LA7VIN5A",72,0)
 . S LA7VAL=""
"RTN","LA7VIN5A",73,0)
 Q
"RTN","LA7VIN5A",74,0)
 ;
"RTN","LA7VIN5A",75,0)
 ;
"RTN","LA7VIN5A",76,0)
JUSTDEC ; Justify to number of places specified
"RTN","LA7VIN5A",77,0)
 ;
"RTN","LA7VIN5A",78,0)
 N LA7DDTYP,LA7FMT,LA7I,LA7PRFIX,LA7X
"RTN","LA7VIN5A",79,0)
 ;
"RTN","LA7VIN5A",80,0)
 ; If LEDI interface (type=10) then skip decimal adjustment
"RTN","LA7VIN5A",81,0)
 I LA7INTYP=10 Q
"RTN","LA7VIN5A",82,0)
 ;
"RTN","LA7VIN5A",83,0)
 ; Get data name field type from DD
"RTN","LA7VIN5A",84,0)
 ; Only justify if Vista field is numeric or free text.
"RTN","LA7VIN5A",85,0)
 S LA7DDTYP=$$GET1^DID(LA7SUBFL,LA76304,"","TYPE")
"RTN","LA7VIN5A",86,0)
 I "NUMERIC^FREE TEXT"'[LA7DDTYP D  Q
"RTN","LA7VIN5A",87,0)
 . N LA7FLDNM
"RTN","LA7VIN5A",88,0)
 . S LA7FLDNM=$$GET1^DID(63.04,LA76304,"","LABEL")
"RTN","LA7VIN5A",89,0)
 . D CREATE^LA7LOG(38)
"RTN","LA7VIN5A",90,0)
 ;
"RTN","LA7VIN5A",91,0)
 S LA7X=LA7VAL,(LA7FMT,LA7PRFIX)=""
"RTN","LA7VIN5A",92,0)
 ;
"RTN","LA7VIN5A",93,0)
 ; If comma formatted, strip comma and set flag to add back in.
"RTN","LA7VIN5A",94,0)
 S LA7X=$TR(LA7X,",","")
"RTN","LA7VIN5A",95,0)
 I LA7X'=LA7VAL S LA7FMT="P"
"RTN","LA7VIN5A",96,0)
 ;
"RTN","LA7VIN5A",97,0)
 ; If "<>=" formatted, strip and save to add back in.
"RTN","LA7VIN5A",98,0)
 F LA7I=1:1:$L(LA7X) Q:$E(LA7X,LA7I)'?1(1"<",1">",1"=")
"RTN","LA7VIN5A",99,0)
 I LA7I>1 D
"RTN","LA7VIN5A",100,0)
 . S LA7PRFIX=$E(LA7X,1,LA7I-1)
"RTN","LA7VIN5A",101,0)
 . S LA7X=$E(LA7X,LA7I,$L(LA7X))
"RTN","LA7VIN5A",102,0)
 ;
"RTN","LA7VIN5A",103,0)
 ; Format if starts with number or decimal point, skip other results.
"RTN","LA7VIN5A",104,0)
 I LA7X?1(1.N,.N1"."1.N) D
"RTN","LA7VIN5A",105,0)
 . S LA7X=$FN(LA7X,LA7FMT,+LA7XFORM)
"RTN","LA7VIN5A",106,0)
 . S LA7VAL=LA7PRFIX_LA7X
"RTN","LA7VIN5A",107,0)
 Q
"RTN","LA7VIN5A",108,0)
 ;
"RTN","LA7VIN5A",109,0)
 ;
"RTN","LA7VIN5A",110,0)
PRDID(LA7PRDID,LA7SFAC,LA7CS) ; Process/Store Producer's ID
"RTN","LA7VIN5A",111,0)
 ; Store where test was performed.
"RTN","LA7VIN5A",112,0)
 ; Call with LA7PRDID = Producer's ID field
"RTN","LA7VIN5A",113,0)
 ;            LA7SFAC = sending facility
"RTN","LA7VIN5A",114,0)
 ;              LA7CS = component encoding character
"RTN","LA7VIN5A",115,0)
 ;
"RTN","LA7VIN5A",116,0)
 N LA74,LA7X,LA7Y
"RTN","LA7VIN5A",117,0)
 ;
"RTN","LA7VIN5A",118,0)
 S LA7X=$P(LA7PRDID,LA7CS,2),LA74=""
"RTN","LA7VIN5A",119,0)
 ;
"RTN","LA7VIN5A",120,0)
 I $P(LA7PRDID,LA7CS,3)="99VA4" S LA74=$$FIND1^DIC(4,"","OMX",$P(LA7PRDID,LA7CS))
"RTN","LA7VIN5A",121,0)
 I 'LA74 S LA74=$$FINDSITE^LA7VHLU2($P(LA7PRDID,LA7CS),1,1)
"RTN","LA7VIN5A",122,0)
 I 'LA74 S LA74=$$FINDSITE^LA7VHLU2($P(LA7SFAC,LA7CS),1,1)
"RTN","LA7VIN5A",123,0)
 ;
"RTN","LA7VIN5A",124,0)
 ; Store producer's id in LAH global with results.
"RTN","LA7VIN5A",125,0)
 I LA74 S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",9)=LA74
"RTN","LA7VIN5A",126,0)
 ;
"RTN","LA7VIN5A",127,0)
 Q
"RTN","LA7VIN5A",128,0)
 ;
"RTN","LA7VIN5A",129,0)
 ;
"RTN","LA7VIN5A",130,0)
REFRNG(LA7X) ; Process/Store References Range.
"RTN","LA7VIN5A",131,0)
 ; Call with LA7X = reference range to store.
"RTN","LA7VIN5A",132,0)
 ;
"RTN","LA7VIN5A",133,0)
 N LA7Y,X,Y
"RTN","LA7VIN5A",134,0)
 ;
"RTN","LA7VIN5A",135,0)
 ; Remove leading and trailing quotes from reference range.
"RTN","LA7VIN5A",136,0)
 S LA7X=$$TRIM^XLFSTR($G(LA7X),"RL","""")
"RTN","LA7VIN5A",137,0)
 I LA7X="" Q
"RTN","LA7VIN5A",138,0)
 ;
"RTN","LA7VIN5A",139,0)
 S X=$P($G(^LAH(LA7LWL,1,LA7ISQN,LA76304)),"^",5)
"RTN","LA7VIN5A",140,0)
 ;
"RTN","LA7VIN5A",141,0)
 ; >lower limit (no upper limit e.g. >10) - store as low value
"RTN","LA7VIN5A",142,0)
 I LA7X?1">".N.1".".N S $P(X,"!",2)=$TR(LA7X,">",""),LA7X=""
"RTN","LA7VIN5A",143,0)
 ;
"RTN","LA7VIN5A",144,0)
 ; <upper limit (no lower limit e.g. <15) - store as high value
"RTN","LA7VIN5A",145,0)
 I LA7X?1"<".N.1".".N S $P(X,"!",3)=$TR(LA7X,"<",""),LA7X=""
"RTN","LA7VIN5A",146,0)
 ;
"RTN","LA7VIN5A",147,0)
 ; Alphabetic reference with hyphen
"RTN","LA7VIN5A",148,0)
 I LA7X?1.A1"-"1.A S $P(X,"!",2)=$C(34)_LA7X_$C(34),LA7X=""
"RTN","LA7VIN5A",149,0)
 ;
"RTN","LA7VIN5A",150,0)
 ; Lower limit value
"RTN","LA7VIN5A",151,0)
 S Y=$P(LA7X,"-")
"RTN","LA7VIN5A",152,0)
 I Y'="" D
"RTN","LA7VIN5A",153,0)
 . I Y?.N.1".".N S $P(X,"!",2)=Y
"RTN","LA7VIN5A",154,0)
 . E  S $P(X,"!",2)=$C(34)_$$UNESC^LA7VHLU3(Y,LA7FS_LA7ECH)_$C(34)
"RTN","LA7VIN5A",155,0)
 ;
"RTN","LA7VIN5A",156,0)
 ; Upper limit value
"RTN","LA7VIN5A",157,0)
 S Y=$P(LA7X,"-",2)
"RTN","LA7VIN5A",158,0)
 I Y'="" D
"RTN","LA7VIN5A",159,0)
 . I Y?.N.1".".N S $P(X,"!",3)=Y
"RTN","LA7VIN5A",160,0)
 . E  S $P(X,"!",3)=$C(34)_$$UNESC^LA7VHLU3(Y,LA7FS_LA7ECH)_$C(34)
"RTN","LA7VIN5A",161,0)
 ;
"RTN","LA7VIN5A",162,0)
 ; Store reference range in LAH global with results.
"RTN","LA7VIN5A",163,0)
 S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",5)=X
"RTN","LA7VIN5A",164,0)
 ;
"RTN","LA7VIN5A",165,0)
 Q
"RTN","LA7VIN5A",166,0)
 ;
"RTN","LA7VIN5A",167,0)
 ;
"RTN","LA7VIN5A",168,0)
ABFLAG(LA7X) ; Process/Store Abnormal Flags.
"RTN","LA7VIN5A",169,0)
 ; Call with LA7X = abnormal flags to store.
"RTN","LA7VIN5A",170,0)
 ; Converts flag to interpretation based on HL7 Table 0078.
"RTN","LA7VIN5A",171,0)
 ; If no match store code instead of interpretation
"RTN","LA7VIN5A",172,0)
 ;
"RTN","LA7VIN5A",173,0)
 N LA7I,LA7Y,X
"RTN","LA7VIN5A",174,0)
 ;
"RTN","LA7VIN5A",175,0)
 ; Store abnormal flags in LAH global with results.
"RTN","LA7VIN5A",176,0)
 ; Currently only storing high/low and critical flags
"RTN","LA7VIN5A",177,0)
 S LA7Y=$S(LA7X="L":"L",LA7X="H":"H",LA7X="LL":"L*",LA7X="HH":"H*",1:"")
"RTN","LA7VIN5A",178,0)
 S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",2)=LA7Y
"RTN","LA7VIN5A",179,0)
 ;
"RTN","LA7VIN5A",180,0)
 ; Critical or designated abnormal tests generate bulletin/alert
"RTN","LA7VIN5A",181,0)
 ; on LEDI (type=10) interfaces.
"RTN","LA7VIN5A",182,0)
 I LA7INTYP=10,LA7Y'="" D
"RTN","LA7VIN5A",183,0)
 . I $E(LA7Y,2)'="*",'$P(LA76241(2),"^",11) Q
"RTN","LA7VIN5A",184,0)
 . S LA7I=$O(^TMP("LA7 ABNORMAL RESULTS",$J,""),-1),LA7I=LA7I+1
"RTN","LA7VIN5A",185,0)
 . S X=LA7LWL_"^"_LA7ISQN_"^"_LA76304_"^"_LA76248_"^"_LA76249_"^"_LA7ORS_"^"_LA7TEST_"^"_$S(LA7TEST(0)'="":LA7TEST(0),1:LA7TEST(2,0))_"^"_$$P^LA7VHLU(.LA7SEG,9,LA7FS)
"RTN","LA7VIN5A",186,0)
 . S ^TMP("LA7 ABNORMAL RESULTS",$J,LA7I)=X
"RTN","LA7VIN5A",187,0)
 ;
"RTN","LA7VIN5A",188,0)
 Q
"RTN","LA7VIN5A",189,0)
 ;
"RTN","LA7VIN5A",190,0)
 ;
"RTN","LA7VIN5A",191,0)
EII ; Store equipment instance identifier in LAH global with results.
"RTN","LA7VIN5A",192,0)
 ;
"RTN","LA7VIN5A",193,0)
 N I,LA7X,X
"RTN","LA7VIN5A",194,0)
 ;
"RTN","LA7VIN5A",195,0)
 S LA7X=""
"RTN","LA7VIN5A",196,0)
 F I=1:1:4 D
"RTN","LA7VIN5A",197,0)
 . S X=$P(LA7EII,LA7CS,I)
"RTN","LA7VIN5A",198,0)
 . I X="" Q
"RTN","LA7VIN5A",199,0)
 . S $P(LA7X,"!",I)=$TR(X,"!","~")
"RTN","LA7VIN5A",200,0)
 I LA7X]"" S $P(^LAH(LA7LWL,1,LA7ISQN,LA76304),"^",11)=LA7X
"RTN","LA7VIN5A",201,0)
 Q
"RTN","LA7VIN5A",202,0)
 ;
"RTN","LA7VIN5A",203,0)
 ;
"RTN","LA7VIN5A",204,0)
ORESULTS ; Process results that accompany order (ORM) messages
"RTN","LA7VIN5A",205,0)
 ;
"RTN","LA7VIN5A",206,0)
 N I,LA764,LA7DIE,LA7ERR,LA7I,LA7WP,LA7X,LA7Y,X
"RTN","LA7VIN5A",207,0)
 S LA7WP(1,0)=" ",LA7I=2,X=""
"RTN","LA7VIN5A",208,0)
 I LA7RLNC S X="[LOINC "_$$GET1^DIQ(95.3,LA7RLNC_",",.01)_"] "_$$GET1^DIQ(95.3,LA7RLNC_",",80)
"RTN","LA7VIN5A",209,0)
 I 'LA7RLNC,LA7RNLT D
"RTN","LA7VIN5A",210,0)
 . S LA764=$$FIND1^DIC(64,"","X",LA7RNLT,"E","","LA7ERR")
"RTN","LA7VIN5A",211,0)
 . I 'LA764 S LA7RNLT="" Q
"RTN","LA7VIN5A",212,0)
 . S X="[NLT "_$$GET1^DIQ(64,LA764_",",1)_"] "_$$GET1^DIQ(64,LA764_",",.01,"I")
"RTN","LA7VIN5A",213,0)
 I 'LA7RLNC,'LA7RNLT D
"RTN","LA7VIN5A",214,0)
 . I LA7TEST(0)]""!(LA7TEST]"") S X="["_LA7TEST(0,1)_" "_LA7TEST_"] "_LA7TEST(0) Q
"RTN","LA7VIN5A",215,0)
 . S X="["_LA7TEST(2,1)_" "_LA7TEST(2)_"] "_LA7TEST(2,0)
"RTN","LA7VIN5A",216,0)
 S LA7WP(LA7I,0)="Test result: "_X
"RTN","LA7VIN5A",217,0)
 ; Date value
"RTN","LA7VIN5A",218,0)
 I LA7VTYP="DT" D
"RTN","LA7VIN5A",219,0)
 . S LA7X=$$P^LA7VHLU(.LA7SEG,6,LA7FS)
"RTN","LA7VIN5A",220,0)
 . S LA7X=$$HL7TFM^XLFDT(LA7X,"L")
"RTN","LA7VIN5A",221,0)
 . S LA7I=LA7I+1,LA7WP(LA7I,0)=" Test value: "_LA7X
"RTN","LA7VIN5A",222,0)
 ; Coded entry
"RTN","LA7VIN5A",223,0)
 I "CECM"[LA7VTYP D
"RTN","LA7VIN5A",224,0)
 . S LA7X=$P($$P^LA7VHLU(.LA7SEG,6,LA7FS),LA7CS,2)
"RTN","LA7VIN5A",225,0)
 . S LA7X=$$UNESC^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VIN5A",226,0)
 . S LA7I=LA7I+1,LA7WP(LA7I,0)=" Test value: "_LA7X_$S(LA7UNITS]"":" "_LA7UNITS,1:"")
"RTN","LA7VIN5A",227,0)
 ; Numeric/ Structured Numeric value
"RTN","LA7VIN5A",228,0)
 I "NMSN"[LA7VTYP D
"RTN","LA7VIN5A",229,0)
 . S LA7X=$$P^LA7VHLU(.LA7SEG,6,LA7FS)
"RTN","LA7VIN5A",230,0)
 . S LA7X=$$UNESC^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VIN5A",231,0)
 . S LA7I=LA7I+1,LA7WP(LA7I,0)=" Test value: "_LA7X_$S(LA7UNITS]"":" "_LA7UNITS,1:"")
"RTN","LA7VIN5A",232,0)
 ; String Data/ Formatted Text/ Text Data
"RTN","LA7VIN5A",233,0)
 I "FTSTX"[LA7VTYP D
"RTN","LA7VIN5A",234,0)
 . D PA^LA7VHLU(.LA7SEG,6,LA7FS,.LA7X)
"RTN","LA7VIN5A",235,0)
 . D UNESCFT^LA7VHLU3(.LA7X,LA7FS_LA7ECH,.LA7Y)
"RTN","LA7VIN5A",236,0)
 . I LA7Y=1,(($L(LA7Y(1,0))+$L(LA7UNITS))<225) S LA7I=LA7I+1,LA7WP(LA7I,0)=" Test value: "_LA7Y(1,0)_$S(LA7UNITS]"":" "_LA7UNITS,1:"") Q
"RTN","LA7VIN5A",237,0)
 . S LA7I=LA7I+1,LA7WP(LA7I,0)=" Test value:"
"RTN","LA7VIN5A",238,0)
 . F I=1:1:LA7Y S LA7I=LA7I+1,LA7WP(LA7I,0)=LA7Y(I,0)
"RTN","LA7VIN5A",239,0)
 . I LA7UNITS]"" S LA7I=LA7I+1,LA7WP(LA7I,0)=" Test units: "_LA7UNITS
"RTN","LA7VIN5A",240,0)
 ; Normals/ Reference range
"RTN","LA7VIN5A",241,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,8,LA7FS)
"RTN","LA7VIN5A",242,0)
 I LA7X]"" S LA7I=LA7I+1,LA7WP(LA7I,0)=" Test normals: "_LA7X
"RTN","LA7VIN5A",243,0)
 ; Normalcy status
"RTN","LA7VIN5A",244,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,9,LA7FS)
"RTN","LA7VIN5A",245,0)
 I LA7X]"" D
"RTN","LA7VIN5A",246,0)
 . S X=" L^ H^LL^HH^ <^ >^ N^ A^AA^ U^ D^ B^ W^ S^ R^ I^MS^VS"
"RTN","LA7VIN5A",247,0)
 . S I=$F(X,LA7X)\3,LA7X=$P($T(ABFLAGS+I^LA7VHLU1),";;",2)
"RTN","LA7VIN5A",248,0)
 . I LA7X]"" S LA7I=LA7I+1,LA7WP(LA7I,0)=" Test normalcy status: "_LA7X
"RTN","LA7VIN5A",249,0)
 I $D(LA7WP) D WP^DIE(69.6,LA7696_",",99,"A","LA7WP","LA7DIE(99)")
"RTN","LA7VIN5A",250,0)
 Q
"RTN","LA7VLL")
0^39^B25802019
"RTN","LA7VLL",1,0)
LA7VLL ;DALOI\JMC - Setup HL7 v1.6 Logical Link for Consolidation ; 12/3/1997
"RTN","LA7VLL",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,51,55,64**;Sep 27, 1994
"RTN","LA7VLL",3,0)
 ;
"RTN","LA7VLL",4,0)
 ; Reference to HL LOGICAL LINK file (#870) supported by DBIA #1495, 1496, 2063
"RTN","LA7VLL",5,0)
 ; Reference to PROTOCOL file (#101) supported by DBIA #872
"RTN","LA7VLL",6,0)
 ; Reference to MAIL GROUP file (#3.8) supported by DBIA #2061
"RTN","LA7VLL",7,0)
 ;
"RTN","LA7VLL",8,0)
MAIL(LRI) ;
"RTN","LA7VLL",9,0)
 ;
"RTN","LA7VLL",10,0)
 Q:LRI=""
"RTN","LA7VLL",11,0)
 ;
"RTN","LA7VLL",12,0)
 N DA,DIC,DIE,DLAYGO,DR,FDA,LA7DIE,LA7IENS,LA7LINK,LA7VMGP,LA7VX,LA7X,LA7Y,X
"RTN","LA7VLL",13,0)
 ;
"RTN","LA7VLL",14,0)
 S LA7VMGP="LA7V "_$P(LRI,"^") D MAILGRP
"RTN","LA7VLL",15,0)
 ;
"RTN","LA7VLL",16,0)
 W !!,"Updating HL LOGICAL LINK file (#870)."
"RTN","LA7VLL",17,0)
 S LA7X="LA7V"_$P(LRI,"^"),LA7Y=+$$FIND1^DIC(870,"","OX",LA7X)
"RTN","LA7VLL",18,0)
 I LA7Y S LA7LINK(LA7Y)=LA7X
"RTN","LA7VLL",19,0)
 ; Check for old spelling using 'space' in name
"RTN","LA7VLL",20,0)
 I LA7Y<1 D
"RTN","LA7VLL",21,0)
 . S LA7Y=+$$FIND1^DIC(870,"","OX","LA7V "_$P(LRI,U))
"RTN","LA7VLL",22,0)
 . I LA7Y>0 S LA7LINK(LA7Y)=LA7X,FDA(1,870,LA7Y_",",.01)=LA7X
"RTN","LA7VLL",23,0)
 I LA7Y<1 D
"RTN","LA7VLL",24,0)
 . W !,?5,"Adding LA7V"_$P(LRI,"^")
"RTN","LA7VLL",25,0)
 . S X="LA7V"_$P(LRI,"^"),DIC="^HLCS(870,",DIC(0)="L",DLAYGO=870
"RTN","LA7VLL",26,0)
 . D ^DIC
"RTN","LA7VLL",27,0)
 . I Y>0 S LA7Y=+Y,LA7LINK(LA7Y)=$P(Y,U,2)
"RTN","LA7VLL",28,0)
 I LA7Y<1 D  Q
"RTN","LA7VLL",29,0)
 . W !!,"Failure LA7V"_$P(LRI,"^")_" was not created in file #870."
"RTN","LA7VLL",30,0)
 S LA7IENS=LA7Y_","
"RTN","LA7VLL",31,0)
 S FDA(1,870,LA7IENS,2)="MAILMAN"
"RTN","LA7VLL",32,0)
 S FDA(1,870,LA7IENS,100.01)=LA7VMGP
"RTN","LA7VLL",33,0)
 D FILE^DIE("E","FDA(1)","LA7DIE(1)")
"RTN","LA7VLL",34,0)
 D CLEAN^DILF
"RTN","LA7VLL",35,0)
 D LL
"RTN","LA7VLL",36,0)
 ;
"RTN","LA7VLL",37,0)
 Q
"RTN","LA7VLL",38,0)
 ;
"RTN","LA7VLL",39,0)
MAILGRP ; Create mail group for HL7 protocol logical link
"RTN","LA7VLL",40,0)
 ;
"RTN","LA7VLL",41,0)
 N DA,DIC,DLAYGO,DOMAIN,LA738,LA7VDESC,LA7VXMY
"RTN","LA7VLL",42,0)
 ;
"RTN","LA7VLL",43,0)
 W !!,"Creating mail group "_LA7VMGP_" for use by the"
"RTN","LA7VLL",44,0)
 W !,"HL7 v1.6 Logical Link "_LA7VMGP_"."
"RTN","LA7VLL",45,0)
 ;
"RTN","LA7VLL",46,0)
 S LA7VXMY=""
"RTN","LA7VLL",47,0)
 S LA7VDESC(1)="This mail group is used by the HL7 Logical Link file for "
"RTN","LA7VLL",48,0)
 S LA7VDESC(2)="transmitting Lab data to site "_$P(LRI,"^",2)_"."
"RTN","LA7VLL",49,0)
 S LA738=$$MG^XMBGRP(LA7VMGP,0,DUZ,1,.LA7VXMY,.LA7VDESC,1)
"RTN","LA7VLL",50,0)
 I LA738<0 D  Q
"RTN","LA7VLL",51,0)
 . W !!,"Failure: mail group ",LA7VMGP," was not created in file #3.8."
"RTN","LA7VLL",52,0)
 ;
"RTN","LA7VLL",53,0)
 S DOMAIN=$$GET1^DIQ(4,+$P(LRI,"^",4)_",",60)
"RTN","LA7VLL",54,0)
 I $G(DOMAIN)="" D ERROR Q
"RTN","LA7VLL",55,0)
 ;
"RTN","LA7VLL",56,0)
 ; Add remote member to mail group
"RTN","LA7VLL",57,0)
 S DA(1)=LA738,DIC("P")=$P(^DD(3.8,12,0),U,2),DIC="^XMB(3.8,"_DA(1)_",6,",DIC(0)="L",DLAYGO=3.812
"RTN","LA7VLL",58,0)
 S X="S.HL V16 SERVER@"_DOMAIN
"RTN","LA7VLL",59,0)
 D ^DIC
"RTN","LA7VLL",60,0)
 Q
"RTN","LA7VLL",61,0)
 ;
"RTN","LA7VLL",62,0)
ERROR ; Error creating domain
"RTN","LA7VLL",63,0)
 ;
"RTN","LA7VLL",64,0)
 W !!,"The INSTITUTION file (#4) entry for "_$P(LRI,"^",2)_" does not contain a domain."
"RTN","LA7VLL",65,0)
 W !,"Unable to create the COLLECTION system link for mail group ",$G(LA7VMGP),"."
"RTN","LA7VLL",66,0)
 W !,"The REMOTE MEMBER, S.HL V16 SERVER@domain name will need to be manually"
"RTN","LA7VLL",67,0)
 W !,"added to the mail group "_$G(LA7VMGP),"."
"RTN","LA7VLL",68,0)
 Q
"RTN","LA7VLL",69,0)
 ;
"RTN","LA7VLL",70,0)
 ;
"RTN","LA7VLL",71,0)
TCP(LRI,PRIMARY) ;
"RTN","LA7VLL",72,0)
 ;
"RTN","LA7VLL",73,0)
 N DIC,DA,DIE,DR,DLAYGO,FDA,LA7DIE,LA7IENS,LA7LINK,LA7P,LA7VX,LA7X,LA7Y,X
"RTN","LA7VLL",74,0)
 ;
"RTN","LA7VLL",75,0)
 Q:LRI=""!PRIMARY=""
"RTN","LA7VLL",76,0)
 ;
"RTN","LA7VLL",77,0)
 ; Setup client logical link if one not associated with this institution
"RTN","LA7VLL",78,0)
 D LINK^HLUTIL3($P(LRI,"^",4),.LA7LINK,"")
"RTN","LA7VLL",79,0)
 I '$O(LA7LINK(0)) D
"RTN","LA7VLL",80,0)
 . W !!,"Updating HL LOGICAL LINK file (#870)."
"RTN","LA7VLL",81,0)
 . S LA7X="LA7V"_$P(LRI,U),LA7Y=+$$FIND1^DIC(870,"","OX",LA7X)
"RTN","LA7VLL",82,0)
 . I LA7Y>0 S LA7LINK(LA7Y)=LA7X
"RTN","LA7VLL",83,0)
 . ; Check for old spelling using 'space' in name
"RTN","LA7VLL",84,0)
 . I LA7Y<1 D
"RTN","LA7VLL",85,0)
 . . S LA7Y=+$$FIND1^DIC(870,"","OX","LA7V "_$P(LRI,U))
"RTN","LA7VLL",86,0)
 . . I LA7Y>0 S LA7LINK(LA7Y)=LA7X,FDA(1,870,LA7Y_",",.01)=LA7X
"RTN","LA7VLL",87,0)
 . I LA7Y<1 D
"RTN","LA7VLL",88,0)
 . . W !,?5,"Adding "_LA7X
"RTN","LA7VLL",89,0)
 . . S X=LA7X,DIC="^HLCS(870,",DIC(0)="L",DLAYGO=870
"RTN","LA7VLL",90,0)
 . . D ^DIC
"RTN","LA7VLL",91,0)
 . . I Y>0 S LA7Y=+Y,LA7LINK(LA7Y)=$P(Y,U,2)
"RTN","LA7VLL",92,0)
 . I LA7Y<1 D  Q
"RTN","LA7VLL",93,0)
 . . W !!,"Failure "_LA7X_" was not created in file #870."
"RTN","LA7VLL",94,0)
 . S LA7IENS=LA7Y_","
"RTN","LA7VLL",95,0)
 . S FDA(1,870,LA7IENS,2)="TCP"
"RTN","LA7VLL",96,0)
 . S FDA(1,870,LA7IENS,100.01)="@"
"RTN","LA7VLL",97,0)
 . D FILE^DIE("E","FDA(1)","LA7DIE(1)")
"RTN","LA7VLL",98,0)
 . D CLEAN^DILF
"RTN","LA7VLL",99,0)
 ;
"RTN","LA7VLL",100,0)
 ; Setup server logical link if one not associated with this institution
"RTN","LA7VLL",101,0)
 D LINK^HLUTIL3($P(PRIMARY,"^"),.LA7P,"")
"RTN","LA7VLL",102,0)
 I '$O(LA7P(0)) D
"RTN","LA7VLL",103,0)
 . S LA7X="LA7V"_$P(PRIMARY,U,3),LA7Y=+$$FIND1^DIC(870,"","OX",LA7X)
"RTN","LA7VLL",104,0)
 . ; Check for old spelling using 'space' in name
"RTN","LA7VLL",105,0)
 . I LA7Y<1 D
"RTN","LA7VLL",106,0)
 . . S LA7Y=+$$FIND1^DIC(870,"","OX","LA7V "_$P(PRIMARY,U,3))
"RTN","LA7VLL",107,0)
 . . I LA7Y>0 S FDA(2,870,LA7Y_",",.01)=LA7X
"RTN","LA7VLL",108,0)
 . I LA7Y<1 D
"RTN","LA7VLL",109,0)
 . . W !,?5,"Adding "_LA7X
"RTN","LA7VLL",110,0)
 . . S X=LA7X,DIC="^HLCS(870,",DIC(0)="L",DLAYGO=870
"RTN","LA7VLL",111,0)
 . . D ^DIC
"RTN","LA7VLL",112,0)
 . . I Y>0 S LA7Y=+Y
"RTN","LA7VLL",113,0)
 . I LA7Y<1 D  Q
"RTN","LA7VLL",114,0)
 . . W !!,"Failure "_LA7X_" was not created in file #870."
"RTN","LA7VLL",115,0)
 . K LA7IENS
"RTN","LA7VLL",116,0)
 . S LA7IENS=LA7Y_","
"RTN","LA7VLL",117,0)
 . S FDA(2,870,LA7IENS,2)="TCP"
"RTN","LA7VLL",118,0)
 . S FDA(2,870,LA7IENS,100.01)="@"
"RTN","LA7VLL",119,0)
 . D FILE^DIE("E","FDA(2)","LA7DIE(2)")
"RTN","LA7VLL",120,0)
 . D CLEAN^DILF
"RTN","LA7VLL",121,0)
 ;
"RTN","LA7VLL",122,0)
 D LL
"RTN","LA7VLL",123,0)
 Q
"RTN","LA7VLL",124,0)
 ;
"RTN","LA7VLL",125,0)
 ;
"RTN","LA7VLL",126,0)
LL ;
"RTN","LA7VLL",127,0)
 N DIR,DIRUT,DIROUT,DUOUT,DTOUT,LA7X,LINK,X
"RTN","LA7VLL",128,0)
 W !,"Updating the PROTOCOL file (#101)."
"RTN","LA7VLL",129,0)
 ;
"RTN","LA7VLL",130,0)
 S X=$O(LA7LINK(0)),LINK=LA7LINK(X)
"RTN","LA7VLL",131,0)
 I $O(HOST(0)) D
"RTN","LA7VLL",132,0)
 . S LA7X="LA7V Process Results from "_$P(LRI,"^")
"RTN","LA7VLL",133,0)
 . D SETPRO(LA7X,"770.7///"_LINK)
"RTN","LA7VLL",134,0)
 . S LA7X="LA7V Send Order to "_$P(LRI,"^")
"RTN","LA7VLL",135,0)
 . D SETPRO(LA7X,"770.7///"_LINK)
"RTN","LA7VLL",136,0)
 ;
"RTN","LA7VLL",137,0)
 I $O(REMOTE(0)) D
"RTN","LA7VLL",138,0)
 . S LA7X="LA7V Send Results to "_$P(LRI,"^")
"RTN","LA7VLL",139,0)
 . D SETPRO(LA7X,"770.7///"_LINK)
"RTN","LA7VLL",140,0)
 . S LA7X="LA7V Process Order from "_$P(LRI,"^")
"RTN","LA7VLL",141,0)
 . D SETPRO(LA7X,"770.7///"_LINK)
"RTN","LA7VLL",142,0)
 ;
"RTN","LA7VLL",143,0)
 S DIR(0)="E" D ^DIR
"RTN","LA7VLL",144,0)
 Q
"RTN","LA7VLL",145,0)
 ;
"RTN","LA7VLL",146,0)
 ;
"RTN","LA7VLL",147,0)
SETPRO(LA7X,LA7FLDS) ;
"RTN","LA7VLL",148,0)
 ;
"RTN","LA7VLL",149,0)
 N DA,DIC,DIE,DLAYGO,DR,D0,X,Y
"RTN","LA7VLL",150,0)
 ;
"RTN","LA7VLL",151,0)
 S X=$G(LA7X),DIC="^ORD(101,",DLAYGO=101,DIC(0)="LM"
"RTN","LA7VLL",152,0)
 D ^DIC
"RTN","LA7VLL",153,0)
 I +Y<1 Q
"RTN","LA7VLL",154,0)
 ;
"RTN","LA7VLL",155,0)
 S DA=+Y,DR=LA7FLDS,DIE=DIC
"RTN","LA7VLL",156,0)
 D ^DIE
"RTN","LA7VLL",157,0)
 ;
"RTN","LA7VLL",158,0)
 Q
"RTN","LA7VMSG")
0^10^B23236199
"RTN","LA7VMSG",1,0)
LA7VMSG ;DALOI/JMC - LAB ORU (Observation Result) message builder ; 12-12-96
"RTN","LA7VMSG",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,50,56,46,64**;Sep 27, 1994
"RTN","LA7VMSG",3,0)
 ;
"RTN","LA7VMSG",4,0)
ORU ; Bleed the ORU (Observation Result) message queue
"RTN","LA7VMSG",5,0)
 ; Tasked by LRCAPV2
"RTN","LA7VMSG",6,0)
 ;
"RTN","LA7VMSG",7,0)
 N LA7MTYP
"RTN","LA7VMSG",8,0)
 S LA7MTYP="ORU"
"RTN","LA7VMSG",9,0)
 D START^LA7VMSG1
"RTN","LA7VMSG",10,0)
 ;
"RTN","LA7VMSG",11,0)
 Q
"RTN","LA7VMSG",12,0)
 ;
"RTN","LA7VMSG",13,0)
ORR ; Bleed the ORR (Order Response) message queue
"RTN","LA7VMSG",14,0)
 ; Called by LRWLST12
"RTN","LA7VMSG",15,0)
 ;
"RTN","LA7VMSG",16,0)
 N LA7MTYP
"RTN","LA7VMSG",17,0)
 S LA7MTYP="ORR"
"RTN","LA7VMSG",18,0)
 ;D START^LA7VMSG1
"RTN","LA7VMSG",19,0)
 ;
"RTN","LA7VMSG",20,0)
 Q
"RTN","LA7VMSG",21,0)
 ;
"RTN","LA7VMSG",22,0)
 ;
"RTN","LA7VMSG",23,0)
SET(LRUID,SITE,RUID,SITEN,ORD,LRNLT,LRIDT,LRSS,LRDFN,ORDT,LA7VCH,LA7MTYP) ; adds entries to LA7V QUEUE file
"RTN","LA7VMSG",24,0)
 ; Called by LA7SRR, LRVER3, LRWLST12
"RTN","LA7VMSG",25,0)
 ; variable list
"RTN","LA7VMSG",26,0)
 ; LRUID - Host Unique ID from the local ACCESSION file (#68)
"RTN","LA7VMSG",27,0)
 ; SITE  - remote sites IEN in INSTITUTION file (#4)
"RTN","LA7VMSG",28,0)
 ; RUID  - Remote sites Unique ID from ACCESSION file (#68)
"RTN","LA7VMSG",29,0)
 ; SITEN - Primary site number of remote site ($$SITE^VASITE)
"RTN","LA7VMSG",30,0)
 ; ORD   - Free text ordered test name from WKLD CODE file (#64)
"RTN","LA7VMSG",31,0)
 ; LRNLT - National Laboratory test code from WKLD CODE file (#64)
"RTN","LA7VMSG",32,0)
 ; LRIDT - Inverse date/time (accession date/time)
"RTN","LA7VMSG",33,0)
 ; LRSS  - test subscript defined in LABORATORY TEST file (#60)
"RTN","LA7VMSG",34,0)
 ; LRDFN - IEN in LAB DATA file (#63)
"RTN","LA7VMSG",35,0)
 ; ORDT  - Order date
"RTN","LA7VMSG",36,0)
 ; LA7VCH (Optional) - array of Chemistry results
"RTN","LA7VMSG",37,0)
 ;                     ex. glucose LA7VCH(2)=LR NODE
"RTN","LA7VMSG",38,0)
 ;                                 LA7VCH(2,1)="C" (corrected results)
"RTN","LA7VMSG",39,0)
 ; LA7MTYP (Optional) - Message Type (ORU or ORR) defaults to ORU
"RTN","LA7VMSG",40,0)
 ;
"RTN","LA7VMSG",41,0)
 N FDA,LA76248,LA76249,LA7DT,LA7FACID,LA7ERR,LA7RSITE,LA7Y,PORD,PORT,RSITE
"RTN","LA7VMSG",42,0)
 ;
"RTN","LA7VMSG",43,0)
 S LA7ERR=0
"RTN","LA7VMSG",44,0)
 I $G(LA7MTYP)="" S LA7MTYP="ORU"
"RTN","LA7VMSG",45,0)
 ; Currently not building ORR when accessioning - JMC/7/11/00
"RTN","LA7VMSG",46,0)
 I LA7MTYP="ORR" Q
"RTN","LA7VMSG",47,0)
 ;
"RTN","LA7VMSG",48,0)
 ; Retrieve facility id (VA=station number, DoD=DMIS code, other=local site assigned id)
"RTN","LA7VMSG",49,0)
 S LA7FACID=$$RETFACID^LA7VHLU2(SITEN,2,1),LA76248=0
"RTN","LA7VMSG",50,0)
 S LA7RSITE="LA7V COLLECTION "_LA7FACID
"RTN","LA7VMSG",51,0)
 S LA76248=$O(^LAHM(62.48,"B",LA7RSITE,0))
"RTN","LA7VMSG",52,0)
 ; No entry in 62.48 - *** Need to add error logging ****
"RTN","LA7VMSG",53,0)
 I 'LA76248 Q
"RTN","LA7VMSG",54,0)
 I '$P(^LAHM(62.48,LA76248,0),"^",3) Q  ; not active
"RTN","LA7VMSG",55,0)
 ;
"RTN","LA7VMSG",56,0)
 ; Create new outgoing entry in 62.49
"RTN","LA7VMSG",57,0)
 S LA76249=$$INIT6249^LA7VHLU
"RTN","LA7VMSG",58,0)
 I LA76249<1 D  Q
"RTN","LA7VMSG",59,0)
 . ; Log entry creation error
"RTN","LA7VMSG",60,0)
 ;
"RTN","LA7VMSG",61,0)
 ; Check/validate parameters before storing
"RTN","LA7VMSG",62,0)
 ; If error store but flag entry with error status.
"RTN","LA7VMSG",63,0)
 D CHKACC
"RTN","LA7VMSG",64,0)
 ;
"RTN","LA7VMSG",65,0)
 ; File data
"RTN","LA7VMSG",66,0)
 S FDA(1,62.49,LA76249_",",1)="O"
"RTN","LA7VMSG",67,0)
 S FDA(1,62.49,LA76249_",",.5)=LA76248
"RTN","LA7VMSG",68,0)
 S FDA(1,62.49,LA76249_",",2)=$S(LA7ERR:"E",1:"P")
"RTN","LA7VMSG",69,0)
 S FDA(1,62.49,LA76249_",",5)=LA7RSITE_"-O-"_RUID
"RTN","LA7VMSG",70,0)
 S FDA(1,62.49,LA76249_",",108)=LA7MTYP
"RTN","LA7VMSG",71,0)
 S FDA(1,62.49,LA76249_",",151)=LRUID
"RTN","LA7VMSG",72,0)
 S FDA(1,62.49,LA76249_",",152)=SITEN
"RTN","LA7VMSG",73,0)
 S FDA(1,62.49,LA76249_",",153)=RUID
"RTN","LA7VMSG",74,0)
 S FDA(1,62.49,LA76249_",",154)=ORD
"RTN","LA7VMSG",75,0)
 S FDA(1,62.49,LA76249_",",155)=LRNLT
"RTN","LA7VMSG",76,0)
 S FDA(1,62.49,LA76249_",",156)=LRIDT
"RTN","LA7VMSG",77,0)
 S FDA(1,62.49,LA76249_",",157)=LRSS
"RTN","LA7VMSG",78,0)
 S FDA(1,62.49,LA76249_",",158)=LRDFN
"RTN","LA7VMSG",79,0)
 S FDA(1,62.49,LA76249_",",159)=ORDT
"RTN","LA7VMSG",80,0)
 ;
"RTN","LA7VMSG",81,0)
 D FILE^DIE("","FDA(1)","LA7ERR(1)")
"RTN","LA7VMSG",82,0)
 D CLEAN^DILF
"RTN","LA7VMSG",83,0)
 ;
"RTN","LA7VMSG",84,0)
 ; Add test to order
"RTN","LA7VMSG",85,0)
 S LA7Y=0
"RTN","LA7VMSG",86,0)
 F  S LA7Y=$O(LA7VCH(LA7Y)) Q:'LA7Y  D
"RTN","LA7VMSG",87,0)
 . N FDAIEN
"RTN","LA7VMSG",88,0)
 . S FDA(2,62.49162,"+2,"_LA76249_",",.01)=LA7Y
"RTN","LA7VMSG",89,0)
 . I $G(LA7VCH(LA7Y,1))="C" S FDA(2,62.49162,"+2,"_LA76249_",",.02)="C"
"RTN","LA7VMSG",90,0)
 . S FDAIEN(1)=LA76249
"RTN","LA7VMSG",91,0)
 . D UPDATE^DIE("","FDA(2)","FDAIEN","LA7ERR(2)")
"RTN","LA7VMSG",92,0)
 . D CLEAN^DILF
"RTN","LA7VMSG",93,0)
 ;
"RTN","LA7VMSG",94,0)
 ; Release lock on entry.
"RTN","LA7VMSG",95,0)
 L -^LAHM(62.49,LA76249)
"RTN","LA7VMSG",96,0)
 Q
"RTN","LA7VMSG",97,0)
 ;
"RTN","LA7VMSG",98,0)
 ;
"RTN","LA7VMSG",99,0)
CHKACC ; Check/validate parameters passed in before storing in file #62.49
"RTN","LA7VMSG",100,0)
 ;
"RTN","LA7VMSG",101,0)
 N I,LA763,LA768,LA7AA,LA7AD,LA7AN
"RTN","LA7VMSG",102,0)
 ;
"RTN","LA7VMSG",103,0)
 I $G(LRUID)="",$G(RUID)="" Q
"RTN","LA7VMSG",104,0)
 I LRUID'="",'$D(^LRO(68,"C",LRUID)) D
"RTN","LA7VMSG",105,0)
 . S LRUID=$G(RUID)
"RTN","LA7VMSG",106,0)
 . I LRUID'="",'$D(^LRO(68,"C",LRUID)) S LRUID=""
"RTN","LA7VMSG",107,0)
 I LRUID="" Q
"RTN","LA7VMSG",108,0)
 ;
"RTN","LA7VMSG",109,0)
 S I=$Q(^LRO(68,"C",LRUID)),(LA7AA,LA7AD,LA7AN)=0
"RTN","LA7VMSG",110,0)
 I I'="",$QS(I,3)=LRUID S LA7AA=$QS(I,4),LA7AD=$QS(I,5),LA7AN=$QS(I,6)
"RTN","LA7VMSG",111,0)
 F I=0,.2,.3,3 S LA768(I)=$G(^LRO(68,LA7AA,1,LA7AD,1,LA7AN,I))
"RTN","LA7VMSG",112,0)
 ;
"RTN","LA7VMSG",113,0)
 F I=0,"ORU" S LA763(I)=$G(^LR(LRDFN,LRSS,LRIDT,I))
"RTN","LA7VMSG",114,0)
 ;
"RTN","LA7VMSG",115,0)
 ; Mismatch on subscript with file #68
"RTN","LA7VMSG",116,0)
 I LRSS'=$P(^LRO(68,LA7AA,0),"^",2) S LA7ERR=40 D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VMSG",117,0)
 ;
"RTN","LA7VMSG",118,0)
 ; Mismatch on LRDFN with file #68
"RTN","LA7VMSG",119,0)
 I LRDFN'=$P(LA768(0),"^") S LA7ERR=41 D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VMSG",120,0)
 ;
"RTN","LA7VMSG",121,0)
 ; Mismatch on specimen inverse d/t with file #68
"RTN","LA7VMSG",122,0)
 I LRIDT'=$P(LA768(3),"^",5) S LA7ERR=42 D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VMSG",123,0)
 ;
"RTN","LA7VMSG",124,0)
 ; Mismatch on remote UID with file #68
"RTN","LA7VMSG",125,0)
 I $G(RUID)'="",RUID'=$P(LA768(.3),"^",5) S LA7ERR=43 D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VMSG",126,0)
 ;
"RTN","LA7VMSG",127,0)
 ; Mismatch on remote UID with file #63
"RTN","LA7VMSG",128,0)
 I $G(RUID)'="",$P(LA763("ORU"),"^",5)'="",RUID'=$P(LA763("ORU"),"^",5) S LA7ERR=44 D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VMSG",129,0)
 ;
"RTN","LA7VMSG",130,0)
 ; Mismatch on UID between file #63 and file #68
"RTN","LA7VMSG",131,0)
 I $P(LA768(.3),"^")'="",$P(LA763("ORU"),"^")'="",$P(LA768(.3),"^")'=$P(LA763("ORU"),"^") S LA7ERR=45 D CREATE^LA7LOG(LA7ERR)
"RTN","LA7VMSG",132,0)
 ;
"RTN","LA7VMSG",133,0)
 Q
"RTN","LA7VMSG",134,0)
 ;
"RTN","LA7VMSG",135,0)
 ;
"RTN","LA7VMSG",136,0)
ACK ; ACKnowledgment message processor
"RTN","LA7VMSG",137,0)
 ;
"RTN","LA7VMSG",138,0)
 G ACK^LA7VHL
"RTN","LA7VMSG",139,0)
 Q
"RTN","LA7VMSG",140,0)
 ;
"RTN","LA7VMSG",141,0)
 ;
"RTN","LA7VMSG",142,0)
TRIGGER(LRAA,LRAD,LRAN,LRTS) ; Call with LRTS by reference
"RTN","LA7VMSG",143,0)
 ; LRTS array contains a list of verified test.
"RTN","LA7VMSG",144,0)
 ; Sets the queue for out going messages. ^LAHM(62.49
"RTN","LA7VMSG",145,0)
 ;
"RTN","LA7VMSG",146,0)
 N ERR,LRDFN,LREND,LRIDT,LRNIEN,LRNLT,LRNLTN,LRODT,LRSS,LRTSX
"RTN","LA7VMSG",147,0)
 N LRORU3,LRX
"RTN","LA7VMSG",148,0)
 S LRDFN=+$G(^LRO(68,LRAA,1,LRAD,1,LRAN,0)),LRODT=+$P(^(0),U,4)
"RTN","LA7VMSG",149,0)
 S LRIDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5)
"RTN","LA7VMSG",150,0)
 S LRSS=$P($G(^LRO(68,LRAA,0)),U,2)
"RTN","LA7VMSG",151,0)
 S LRORU3=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3))
"RTN","LA7VMSG",152,0)
 Q:'$P($G(LRORU3),U,2)!('LRIDT)
"RTN","LA7VMSG",153,0)
 Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))#2
"RTN","LA7VMSG",154,0)
 ;
"RTN","LA7VMSG",155,0)
 S LRX=0 F  S LRX=$O(LRTS(LRX)) Q:'LRX  D
"RTN","LA7VMSG",156,0)
 . S LRNLT=+$G(^LAB(60,+LRTS(LRX),64)) Q:'LRNLT
"RTN","LA7VMSG",157,0)
 . Q:'$D(^LAM(LRNLT,0))#2
"RTN","LA7VMSG",158,0)
 . S LRNLTN=$P(^LAM(LRNLT,0),U),LRNLT=$P(^(0),U,2)
"RTN","LA7VMSG",159,0)
 . Q:'LRNLT
"RTN","LA7VMSG",160,0)
 . D SET($P(LRORU3,U,4),$P(LRORU3,U,2),$P(LRORU3,U,5),$P(LRORU3,U,3),LRNLTN,LRNLT,LRIDT,LRSS,LRDFN,LRODT,"","ORU")
"RTN","LA7VMSG",161,0)
 Q
"RTN","LA7VMSG1")
0^11^B51506932
"RTN","LA7VMSG1",1,0)
LA7VMSG1 ;DALOI/JMC - LAB ORU (Observation Result) message builder cont'd; 4-10-00
"RTN","LA7VMSG1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**56,46,61,64**;Sep 27, 1994
"RTN","LA7VMSG1",3,0)
 ;
"RTN","LA7VMSG1",4,0)
START ; Process entries in queue
"RTN","LA7VMSG1",5,0)
 ; Called from LA7VMSG
"RTN","LA7VMSG1",6,0)
 ;
"RTN","LA7VMSG1",7,0)
 N LA,LAER,LA7VER
"RTN","LA7VMSG1",8,0)
 N EID,HLEID,HLMTIEN,HLRESLT,HLARYTYP,HLECH,HLFS,HLCOMP,HLFORMAT
"RTN","LA7VMSG1",9,0)
 N GBL,LA7MID,LA7V,LA7VS,LA7V0N,LA7VIEN,RSITE,LRNT
"RTN","LA7VMSG1",10,0)
 N LA76248,LA76249,LA76249P,LA7DT,LA7ECH,LA7END,LA7FS,LA7NVAF,LA7ROOT,LA7X,LRDFN,LRUID
"RTN","LA7VMSG1",11,0)
 ;
"RTN","LA7VMSG1",12,0)
 ; variable list
"RTN","LA7VMSG1",13,0)
 ; LA("LRUID") - Host Unique ID from the local ACCESSION file (#68)
"RTN","LA7VMSG1",14,0)
 ; LA("SITE")  - Primary site number of remote site ($$SITE^VASITE)
"RTN","LA7VMSG1",15,0)
 ; LA("RUID")  - Remote sites Unique ID from ACCESSION file (#68)
"RTN","LA7VMSG1",16,0)
 ; LA("ORD")   - Free text ordered test name from WKLD CODE file (#64)
"RTN","LA7VMSG1",17,0)
 ; LA("LRNLT") - National Laboratory test code from WKLD CODE file (#64)
"RTN","LA7VMSG1",18,0)
 ; LA("LRIDT") - Inverse date/time (accession date/time)
"RTN","LA7VMSG1",19,0)
 ; LA("LRSS")  - test subscript defined in LABORATORY TEST file (#60)
"RTN","LA7VMSG1",20,0)
 ; LA("LRDFN") - IEN in LAB DATA file (#63)
"RTN","LA7VMSG1",21,0)
 ; LA("ORDT")  - Order date
"RTN","LA7VMSG1",22,0)
 ; LA(62.49)   - entry in #62.49 which contains pointer to results to build
"RTN","LA7VMSG1",23,0)
 ;
"RTN","LA7VMSG1",24,0)
 L +^LAHM(62.49,"HL7 PROCESS",LA7MTYP):0 Q:'$T
"RTN","LA7VMSG1",25,0)
 ;
"RTN","LA7VMSG1",26,0)
 S GBL="^TMP(""HLS"","_$J_")"
"RTN","LA7VMSG1",27,0)
 ;
"RTN","LA7VMSG1",28,0)
 D SORTPAT
"RTN","LA7VMSG1",29,0)
 I $D(^TMP("LA76248",$J)) D PROCESS
"RTN","LA7VMSG1",30,0)
 D KVAR^LRX
"RTN","LA7VMSG1",31,0)
 ;
"RTN","LA7VMSG1",32,0)
 ; Release lock
"RTN","LA7VMSG1",33,0)
 L -^LAHM(62.49,"HL7 PROCESS",LA7MTYP)
"RTN","LA7VMSG1",34,0)
 ;
"RTN","LA7VMSG1",35,0)
 K ^TMP("LA76248",$J),^TMP("LA7VS",$J),^TMP("HLS",$J)
"RTN","LA7VMSG1",36,0)
 ;
"RTN","LA7VMSG1",37,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","LA7VMSG1",38,0)
 ;
"RTN","LA7VMSG1",39,0)
 Q
"RTN","LA7VMSG1",40,0)
 ;
"RTN","LA7VMSG1",41,0)
 ;
"RTN","LA7VMSG1",42,0)
SORTPAT ; Sort all results for tranmsission
"RTN","LA7VMSG1",43,0)
 ;
"RTN","LA7VMSG1",44,0)
 N LA76248,LA76249,LA7END,LA7ROOT,LRDFN,LRUID
"RTN","LA7VMSG1",45,0)
 ;
"RTN","LA7VMSG1",46,0)
 K ^TMP("LA76248",$J)
"RTN","LA7VMSG1",47,0)
 ; Flag to indicate end of global.
"RTN","LA7VMSG1",48,0)
 S LA7END=0
"RTN","LA7VMSG1",49,0)
 ;
"RTN","LA7VMSG1",50,0)
 ; Sort by configuration (LA76248), patient (LRDFN), UID (LRUID), file #62.49 ien (LA76249)
"RTN","LA7VMSG1",51,0)
 S LA7ROOT="^LAHM(62.49,""AC"",LA7MTYP,""P"")"
"RTN","LA7VMSG1",52,0)
 F  S LA7ROOT=$Q(@LA7ROOT) Q:LA7END  D
"RTN","LA7VMSG1",53,0)
 . I $QS(LA7ROOT,3)'=LA7MTYP!($QS(LA7ROOT,6)<1) S LA7END=1 Q
"RTN","LA7VMSG1",54,0)
 . S LA76248=$QS(LA7ROOT,5),LA76249=$QS(LA7ROOT,6)
"RTN","LA7VMSG1",55,0)
 . L +^LAHM(62.49,LA76249):5 Q:'$T
"RTN","LA7VMSG1",56,0)
 . S LRDFN=$P($G(^LAHM(62.49,LA76249,63)),"^",8)
"RTN","LA7VMSG1",57,0)
 . S LRUID=$P($G(^LAHM(62.49,LA76249,63)),"^",1)
"RTN","LA7VMSG1",58,0)
 . I LRDFN,LRUID]"" S ^TMP("LA76248",$J,LA76248,LRDFN,LRUID,LA76249)=""
"RTN","LA7VMSG1",59,0)
 . L -^LAHM(62.49,LA76249)
"RTN","LA7VMSG1",60,0)
 ;
"RTN","LA7VMSG1",61,0)
 Q
"RTN","LA7VMSG1",62,0)
 ;
"RTN","LA7VMSG1",63,0)
 ;
"RTN","LA7VMSG1",64,0)
PROCESS ; Process and build messages to be sent
"RTN","LA7VMSG1",65,0)
 ;
"RTN","LA7VMSG1",66,0)
 N LA7101,LA76248,LA76249,LA76249P,LA7NTESN,LA7OBRSN,LA7OBXSN,LA7PIDSN,LA7SMSG,LA7VS,LRDFN
"RTN","LA7VMSG1",67,0)
 ;
"RTN","LA7VMSG1",68,0)
 ; Cleanup
"RTN","LA7VMSG1",69,0)
 K ^TMP("LA7VS",$J),^TMP("HLS",$J)
"RTN","LA7VMSG1",70,0)
 ; Initialize variables
"RTN","LA7VMSG1",71,0)
 S (LA76248,LA76249,LA76249P,LA7END,LRDFN)=0,LRUID=""
"RTN","LA7VMSG1",72,0)
 ;
"RTN","LA7VMSG1",73,0)
 ; Process sorted list of results to transmit.
"RTN","LA7VMSG1",74,0)
 S LA7ROOT="^TMP(""LA76248"",$J)"
"RTN","LA7VMSG1",75,0)
 F  S LA7ROOT=$Q(@LA7ROOT) Q:LA7ROOT=""  D  Q:LA7END
"RTN","LA7VMSG1",76,0)
 . I $QS(LA7ROOT,1)'="LA76248"!($QS(LA7ROOT,2)'=$J) S LA7END=1 Q
"RTN","LA7VMSG1",77,0)
 . I LA76248'=$QS(LA7ROOT,3) D CONFIG
"RTN","LA7VMSG1",78,0)
 . I '$P(LA76248(0),"^",3) Q
"RTN","LA7VMSG1",79,0)
 . S (LA76249,LA(62.49))=$QS(LA7ROOT,6)
"RTN","LA7VMSG1",80,0)
 . S LA7X=$G(^LAHM(62.49,LA76249,63))
"RTN","LA7VMSG1",81,0)
 . S LA("HUID")=$P(LA7X,U),LA("SITE")=$P(LA7X,U,2),LA("RUID")=$P(LA7X,U,3),LA("ORD")=$P(LA7X,U,4),LA("NLT")=$P(LA7X,U,5),LA("LRIDT")=$P(LA7X,U,6),LA("SUB")=$P(LA7X,U,7),LA("LRDFN")=$P(LA7X,U,8),LA("ORDT")=$P(LA7X,U,9)
"RTN","LA7VMSG1",82,0)
 . S LA7NVAF=$$NVAF^LA7VHLU2(+LA("SITE"))
"RTN","LA7VMSG1",83,0)
 . I LRUID'=$QS(LA7ROOT,5),LA7SMSG=2 D PAT Q:LA7END
"RTN","LA7VMSG1",84,0)
 . I LRDFN'=$QS(LA7ROOT,4) D PAT Q:LA7END
"RTN","LA7VMSG1",85,0)
 . S LRUID=$QS(LA7ROOT,5)
"RTN","LA7VMSG1",86,0)
 . S ^TMP("LA7VS",$J,LA76249)=LA76249P
"RTN","LA7VMSG1",87,0)
 . N LA76249
"RTN","LA7VMSG1",88,0)
 . S LA76249=LA76249P
"RTN","LA7VMSG1",89,0)
 . I LA7MTYP="ORU" D EN^LA7VORU(.LA)
"RTN","LA7VMSG1",90,0)
 . I LA7MTYP="ORR" D EN^LA7VORR1(.LA)
"RTN","LA7VMSG1",91,0)
 ;
"RTN","LA7VMSG1",92,0)
 I LA76249P D SENDMSG
"RTN","LA7VMSG1",93,0)
 ;
"RTN","LA7VMSG1",94,0)
 Q
"RTN","LA7VMSG1",95,0)
 ;
"RTN","LA7VMSG1",96,0)
 ;
"RTN","LA7VMSG1",97,0)
STARTMSG ; Initialize a HL7 message and variables
"RTN","LA7VMSG1",98,0)
 ;
"RTN","LA7VMSG1",99,0)
 N LA7EVNT,SITE
"RTN","LA7VMSG1",100,0)
 ;
"RTN","LA7VMSG1",101,0)
 K ^TMP("LA7VS",$J),@GBL
"RTN","LA7VMSG1",102,0)
 ;
"RTN","LA7VMSG1",103,0)
 S LA76249P=LA76249
"RTN","LA7VMSG1",104,0)
 S SITE=$$RETFACID^LA7VHLU2(LA("SITE"),2,1)
"RTN","LA7VMSG1",105,0)
 ;
"RTN","LA7VMSG1",106,0)
 I LA7MTYP="ORU" S LA7EVNT="LA7V Results Reporting to "_SITE
"RTN","LA7VMSG1",107,0)
 I LA7MTYP="ORR" S LA7EVNT="LA7V Order Response to "_SITE
"RTN","LA7VMSG1",108,0)
 D STARTMSG^LA7VHLU(LA7EVNT,LA76249P)
"RTN","LA7VMSG1",109,0)
 I $G(HL) S LA7END=1
"RTN","LA7VMSG1",110,0)
 ;
"RTN","LA7VMSG1",111,0)
 Q
"RTN","LA7VMSG1",112,0)
 ;
"RTN","LA7VMSG1",113,0)
 ;
"RTN","LA7VMSG1",114,0)
SENDMSG ; File HL7 message with HL and LAB packages
"RTN","LA7VMSG1",115,0)
 ;
"RTN","LA7VMSG1",116,0)
 ; No data to send
"RTN","LA7VMSG1",117,0)
 I '$D(^TMP("HLS",$J)) Q
"RTN","LA7VMSG1",118,0)
 ;
"RTN","LA7VMSG1",119,0)
 D GEN^LA7VHLU
"RTN","LA7VMSG1",120,0)
 I $P(LA7MID,U)=0 D
"RTN","LA7VMSG1",121,0)
 . N LA7X
"RTN","LA7VMSG1",122,0)
 . S LA7X(1)=LA76249P,LA7X(2)=$TR($P(HLMID,"^",2,3),"^","-")
"RTN","LA7VMSG1",123,0)
 . D CREATE^LA7LOG(28)
"RTN","LA7VMSG1",124,0)
 ;
"RTN","LA7VMSG1",125,0)
 D UPDT6249
"RTN","LA7VMSG1",126,0)
 D UPDLPD
"RTN","LA7VMSG1",127,0)
 ;
"RTN","LA7VMSG1",128,0)
 S (LA76249P,LA7PIDSN,LA7OBRSN,LA7OBXSN,LA7NTESN)=0
"RTN","LA7VMSG1",129,0)
 ;
"RTN","LA7VMSG1",130,0)
 Q
"RTN","LA7VMSG1",131,0)
 ;
"RTN","LA7VMSG1",132,0)
 ;
"RTN","LA7VMSG1",133,0)
CONFIG ; Setup for this configuration
"RTN","LA7VMSG1",134,0)
 ;
"RTN","LA7VMSG1",135,0)
 ; Send a building message
"RTN","LA7VMSG1",136,0)
 I LA76249P D SENDMSG
"RTN","LA7VMSG1",137,0)
 ;
"RTN","LA7VMSG1",138,0)
 ; Retrieve configuration information from #62.48
"RTN","LA7VMSG1",139,0)
 S LA76248=$QS(LA7ROOT,3)
"RTN","LA7VMSG1",140,0)
 S LA76248(0)=$G(^LAHM(62.48,LA76248,0))
"RTN","LA7VMSG1",141,0)
 ;
"RTN","LA7VMSG1",142,0)
 ; Flag to control message building; 1-one patient/msg, 2-one order/msg
"RTN","LA7VMSG1",143,0)
 S LA7SMSG=+$P(LA76248(0),"^",8)
"RTN","LA7VMSG1",144,0)
 ;
"RTN","LA7VMSG1",145,0)
 ; Initialize variables
"RTN","LA7VMSG1",146,0)
 S (LA76249,LA76249P,LRDFN)=0
"RTN","LA7VMSG1",147,0)
 S LRUID=""
"RTN","LA7VMSG1",148,0)
 ;
"RTN","LA7VMSG1",149,0)
 Q
"RTN","LA7VMSG1",150,0)
 ;
"RTN","LA7VMSG1",151,0)
 ;
"RTN","LA7VMSG1",152,0)
PAT ; Build patient information
"RTN","LA7VMSG1",153,0)
 ;
"RTN","LA7VMSG1",154,0)
 N LA7ALTID,LA7EXTID,LA7PID,LA7PV1
"RTN","LA7VMSG1",155,0)
 ;
"RTN","LA7VMSG1",156,0)
 ; If one patient/msg or one order/msg and message building then send it.
"RTN","LA7VMSG1",157,0)
 I LA7SMSG>0,LA76249P D SENDMSG
"RTN","LA7VMSG1",158,0)
 ;
"RTN","LA7VMSG1",159,0)
 ; If no message building then start one.
"RTN","LA7VMSG1",160,0)
 I 'LA76249P S LA7PIDSN=0 D STARTMSG Q:LA7END
"RTN","LA7VMSG1",161,0)
 ;
"RTN","LA7VMSG1",162,0)
 ; Setup PID and PV1 segments.
"RTN","LA7VMSG1",163,0)
 S LRDFN=$QS(LA7ROOT,4)
"RTN","LA7VMSG1",164,0)
 S LRDPF=$P(^LR(LRDFN,0),"^",2),DFN=$P(^(0),"^",3)
"RTN","LA7VMSG1",165,0)
 D DEM^LRX
"RTN","LA7VMSG1",166,0)
 ;
"RTN","LA7VMSG1",167,0)
 ; Send placer's patient id (PID-3), return in PID-2, return PID-4 with alternate id
"RTN","LA7VMSG1",168,0)
 S (LA7ALTID,LA7EXTID)=""
"RTN","LA7VMSG1",169,0)
 D PTEXTID^LA7VHLU(LA("SITE"),LA("RUID"),.LA7EXTID)
"RTN","LA7VMSG1",170,0)
 I $L($G(LA7EXTID("PID-2"))) S LA7EXTID=$$CNVFLD^LA7VHLU3(LA7EXTID("PID-2"),LA7EXTID("ECH"),LA7ECH)
"RTN","LA7VMSG1",171,0)
 I $L($G(LA7EXTID("PID-4"))) S LA7ALTID=$$CNVFLD^LA7VHLU3(LA7EXTID("PID-4"),LA7EXTID("ECH"),LA7ECH)
"RTN","LA7VMSG1",172,0)
 ;
"RTN","LA7VMSG1",173,0)
 ; Build PID segment
"RTN","LA7VMSG1",174,0)
 D PID^LA7VPID(LRDFN,LA7EXTID,.LA7PID,.LA7PIDSN,.HL,LA7ALTID)
"RTN","LA7VMSG1",175,0)
 D FILESEG^LA7VHLU(GBL,.LA7PID)
"RTN","LA7VMSG1",176,0)
 D FILE6249^LA7VHLU(LA76249P,.LA7PID)
"RTN","LA7VMSG1",177,0)
 ;
"RTN","LA7VMSG1",178,0)
 ; Build PV1 segment
"RTN","LA7VMSG1",179,0)
 ; Not built when sending to DoD facility - not used by CHCS
"RTN","LA7VMSG1",180,0)
 I LA7NVAF'=1 D
"RTN","LA7VMSG1",181,0)
 . D PV1^LA7VPID(LRDFN,.LA7PV1,LA7FS,LA7ECH)
"RTN","LA7VMSG1",182,0)
 . D FILESEG^LA7VHLU(GBL,.LA7PV1)
"RTN","LA7VMSG1",183,0)
 . D FILE6249^LA7VHLU(LA76249P,.LA7PV1)
"RTN","LA7VMSG1",184,0)
 ;
"RTN","LA7VMSG1",185,0)
 S LRUID="",(LA7OBRSN,LA7OBXSN,LA7NTESN)=0
"RTN","LA7VMSG1",186,0)
 ;
"RTN","LA7VMSG1",187,0)
 Q
"RTN","LA7VMSG1",188,0)
 ;
"RTN","LA7VMSG1",189,0)
 ;
"RTN","LA7VMSG1",190,0)
UPDT6249 ; Update entries in file #62.49
"RTN","LA7VMSG1",191,0)
 ;
"RTN","LA7VMSG1",192,0)
 N LA7ERR,LA76249,LA76249P
"RTN","LA7VMSG1",193,0)
 ;
"RTN","LA7VMSG1",194,0)
 S LA76249=0
"RTN","LA7VMSG1",195,0)
 F  S LA76249=$O(^TMP("LA7VS",$J,LA76249)) Q:'LA76249  D
"RTN","LA7VMSG1",196,0)
 . N FDA,LA7ERR
"RTN","LA7VMSG1",197,0)
 . S LA76249P=+$G(^TMP("LA7VS",$J,LA76249))
"RTN","LA7VMSG1",198,0)
 . ; Set pointer to parent on child entry.
"RTN","LA7VMSG1",199,0)
 . I LA76249'=LA76249P S FDA(1,62.49,LA76249_",",6)=LA76249P
"RTN","LA7VMSG1",200,0)
 . I $G(HL("APAT"))="AL"!($G(HL("APAT"))="") S FDA(1,62.49,LA76249_",",2)="A"
"RTN","LA7VMSG1",201,0)
 . E  S FDA(1,62.49,LA76249_",",2)="X"
"RTN","LA7VMSG1",202,0)
 . S FDA(1,62.49,LA76249_",",102)=HL("SAN")
"RTN","LA7VMSG1",203,0)
 . S FDA(1,62.49,LA76249_",",103)=HL("SAF")
"RTN","LA7VMSG1",204,0)
 . S FDA(1,62.49,LA76249_",",108)=HL("MTN")
"RTN","LA7VMSG1",205,0)
 . S FDA(1,62.49,LA76249_",",110)=HL("PID")
"RTN","LA7VMSG1",206,0)
 . S FDA(1,62.49,LA76249_",",111)=HL("VER")
"RTN","LA7VMSG1",207,0)
 . I $P($G(LA7MID),"^")'="" S FDA(1,62.49,LA76249_",",109)=$P(LA7MID,"^")
"RTN","LA7VMSG1",208,0)
 . I $P($G(LA7MID),"^",2) D
"RTN","LA7VMSG1",209,0)
 . . S FDA(1,62.49,LA76249_",",160)=$P(LA7MID,"^",2)
"RTN","LA7VMSG1",210,0)
 . . S FDA(1,62.49,LA76249_",",161)=$P(LA7MID,"^",3)
"RTN","LA7VMSG1",211,0)
 . D FILE^DIE("","FDA(1)","LA7ERR(1)")
"RTN","LA7VMSG1",212,0)
 . D CLEAN^DILF
"RTN","LA7VMSG1",213,0)
 ;
"RTN","LA7VMSG1",214,0)
 Q
"RTN","LA7VMSG1",215,0)
 ;
"RTN","LA7VMSG1",216,0)
 ;
"RTN","LA7VMSG1",217,0)
UPDLPD ; Update lab pending orders (#69.6) for each entry in #62.49
"RTN","LA7VMSG1",218,0)
 ;
"RTN","LA7VMSG1",219,0)
 N LA76249
"RTN","LA7VMSG1",220,0)
 ;
"RTN","LA7VMSG1",221,0)
 S LA76249=0
"RTN","LA7VMSG1",222,0)
 F  S LA76249=$O(^TMP("LA7VS",$J,LA76249)) Q:'LA76249  D UPD696
"RTN","LA7VMSG1",223,0)
 Q
"RTN","LA7VMSG1",224,0)
 ;
"RTN","LA7VMSG1",225,0)
 ;
"RTN","LA7VMSG1",226,0)
UPD696 ; Update LAB PENDING ORDERS file #69.6
"RTN","LA7VMSG1",227,0)
 ;
"RTN","LA7VMSG1",228,0)
 N LA74,LA7696,LA76964,LA7ERR,LA7ORDT,LA7STAT,LA7X
"RTN","LA7VMSG1",229,0)
 ;
"RTN","LA7VMSG1",230,0)
 ; Find "Results Available" status in #64.061
"RTN","LA7VMSG1",231,0)
 S LA7STAT=$$FIND1^DIC(64.061,"","OMX","Results Available","","I $P(^LAB(64.061,Y,0),U,7)=""U""")
"RTN","LA7VMSG1",232,0)
 ;
"RTN","LA7VMSG1",233,0)
 S LA7X=$G(^LAHM(62.49,LA76249,63))
"RTN","LA7VMSG1",234,0)
 ;
"RTN","LA7VMSG1",235,0)
 ; Ordering institution - pointer to file #4
"RTN","LA7VMSG1",236,0)
 S LA74=$P(LA7X,"^",2)
"RTN","LA7VMSG1",237,0)
 I LA74="" Q
"RTN","LA7VMSG1",238,0)
 ;
"RTN","LA7VMSG1",239,0)
 ; Ordered test
"RTN","LA7VMSG1",240,0)
 S LA7ORDT=$P(LA7X,"^",4)
"RTN","LA7VMSG1",241,0)
 I LA7ORDT="" Q
"RTN","LA7VMSG1",242,0)
 ;
"RTN","LA7VMSG1",243,0)
 ; File #69.6 ien and ordered test multiple ien
"RTN","LA7VMSG1",244,0)
 S LA7696=0
"RTN","LA7VMSG1",245,0)
 F  S LA7696=$O(^LRO(69.6,"RST",LA74,LA("RUID"),LA7696)) Q:'LA7696  D
"RTN","LA7VMSG1",246,0)
 . N FDA
"RTN","LA7VMSG1",247,0)
 . S LA76964=$O(^LRO(69.6,LA7696,2,"B",LA7ORDT,0))
"RTN","LA7VMSG1",248,0)
 . I LA76964<1 Q
"RTN","LA7VMSG1",249,0)
 . ;
"RTN","LA7VMSG1",250,0)
 . L +^LRO(69.6,LA7696):99999
"RTN","LA7VMSG1",251,0)
 . ; Cannot get lock on ENTRY in 69.6
"RTN","LA7VMSG1",252,0)
 . I '$T D CREATE^LA7LOG(33) Q
"RTN","LA7VMSG1",253,0)
 . ;
"RTN","LA7VMSG1",254,0)
 . ; Store outgoing HL7 message ID
"RTN","LA7VMSG1",255,0)
 . S FDA(1,69.64,LA76964_","_LA7696_",",7)=$P(LA7MID,U)
"RTN","LA7VMSG1",256,0)
 . ; Set to Results Available.
"RTN","LA7VMSG1",257,0)
 . S FDA(1,69.64,LA76964_","_LA7696_",",5)=LA7STAT
"RTN","LA7VMSG1",258,0)
 . D FILE^DIE("","FDA(1)","LA7ERR(1)")
"RTN","LA7VMSG1",259,0)
 . D CLEAN^DILF
"RTN","LA7VMSG1",260,0)
 . ;
"RTN","LA7VMSG1",261,0)
 . L -^LRO(69.6,LA7696)
"RTN","LA7VMSG1",262,0)
 ;
"RTN","LA7VMSG1",263,0)
 Q
"RTN","LA7VOBR")
0^13^B23749256
"RTN","LA7VOBR",1,0)
LA7VOBR ;DALOI/JMC - LAB OBR segment builder ; 11-17-98
"RTN","LA7VOBR",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VOBR",3,0)
 ;
"RTN","LA7VOBR",4,0)
 Q
"RTN","LA7VOBR",5,0)
 ;
"RTN","LA7VOBR",6,0)
 ;
"RTN","LA7VOBR",7,0)
OBR1(LA7OBRSN) ; Build OBR-1 sequence - set segment id
"RTN","LA7VOBR",8,0)
 ; Call with LA7OBRSN = segment id (pass by reference)
"RTN","LA7VOBR",9,0)
 ;
"RTN","LA7VOBR",10,0)
 S LA7OBRSN=$G(LA7OBRSN)+1
"RTN","LA7VOBR",11,0)
 ;
"RTN","LA7VOBR",12,0)
 Q LA7OBRSN
"RTN","LA7VOBR",13,0)
 ;
"RTN","LA7VOBR",14,0)
OBR2(LA7ID,LA7FS,LA7ECH) ; Build OBR-2 sequence - placer's specimen id
"RTN","LA7VOBR",15,0)
 ; Call with LA7ID = placer's specimen id (accn number/UID)
"RTN","LA7VOBR",16,0)
 ;           LA7FS = HL7 field separator
"RTN","LA7VOBR",17,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VOBR",18,0)
 ;
"RTN","LA7VOBR",19,0)
 N LA7Y
"RTN","LA7VOBR",20,0)
 ;
"RTN","LA7VOBR",21,0)
 S LA7ID=$$CHKDATA^LA7VHLU3(LA7ID,LA7FS_LA7ECH)
"RTN","LA7VOBR",22,0)
 S $P(LA7Y,$E(LA7ECH,1),1)=LA7ID
"RTN","LA7VOBR",23,0)
 ;
"RTN","LA7VOBR",24,0)
 Q LA7Y
"RTN","LA7VOBR",25,0)
 ;
"RTN","LA7VOBR",26,0)
 ;
"RTN","LA7VOBR",27,0)
OBR3(LA7ID,LA7FS,LA7ECH) ; Build OBR-3 sequence - filler's specimen id
"RTN","LA7VOBR",28,0)
 ; Call with LA7ID = filler's specimen id (accn number/UID)
"RTN","LA7VOBR",29,0)
 ;           LA7FS = HL7 field separator
"RTN","LA7VOBR",30,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VOBR",31,0)
 ;
"RTN","LA7VOBR",32,0)
 N LA7Y
"RTN","LA7VOBR",33,0)
 ;
"RTN","LA7VOBR",34,0)
 S LA7ID=$$CHKDATA^LA7VHLU3(LA7ID,LA7FS_LA7ECH)
"RTN","LA7VOBR",35,0)
 S $P(LA7Y,$E(LA7ECH,1),1)=LA7ID
"RTN","LA7VOBR",36,0)
 ;
"RTN","LA7VOBR",37,0)
 Q LA7Y
"RTN","LA7VOBR",38,0)
 ;
"RTN","LA7VOBR",39,0)
 ;
"RTN","LA7VOBR",40,0)
OBR4(LA7NLT,LA760,LA7ALT,LA7FS,LA7ECH) ; Build OBR-4 sequence - Universal service ID
"RTN","LA7VOBR",41,0)
 ; Call with LA7NLT = NLT test code
"RTN","LA7VOBR",42,0)
 ;            LA760 = file #60 ien if known
"RTN","LA7VOBR",43,0)
 ;           LA7ALT = alternate order code and system in form 
"RTN","LA7VOBR",44,0)
 ;                     test code^test name^coding system
"RTN","LA7VOBR",45,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",46,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBR",47,0)
 ;
"RTN","LA7VOBR",48,0)
 ; Returns     LA7Y = OBR-4 sequence
"RTN","LA7VOBR",49,0)
 ;
"RTN","LA7VOBR",50,0)
 N LA764,LA7COMP,LA7ERR,LA7TN,LA7X,LA7Y,LA7Z
"RTN","LA7VOBR",51,0)
 ;
"RTN","LA7VOBR",52,0)
 D OBR4^LA7VOBRA
"RTN","LA7VOBR",53,0)
 ;
"RTN","LA7VOBR",54,0)
 Q LA7Y
"RTN","LA7VOBR",55,0)
 ;
"RTN","LA7VOBR",56,0)
 ;
"RTN","LA7VOBR",57,0)
OBR7(LA7DT) ; Build OBR-7 sequence - collection date/time
"RTN","LA7VOBR",58,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBR",59,0)
 ; Returns OBR-7 sequence
"RTN","LA7VOBR",60,0)
 ;
"RTN","LA7VOBR",61,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBR",62,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBR",63,0)
 ;
"RTN","LA7VOBR",64,0)
 ;
"RTN","LA7VOBR",65,0)
OBR8(LA7DT) ; Build OBR-8 sequence - collection end date/time
"RTN","LA7VOBR",66,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBR",67,0)
 ; Returns OBR-8 sequence
"RTN","LA7VOBR",68,0)
 ;
"RTN","LA7VOBR",69,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBR",70,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBR",71,0)
 ;
"RTN","LA7VOBR",72,0)
 ;
"RTN","LA7VOBR",73,0)
OBR9(LA7VOL,LA764061,LA7FS,LA7ECH) ; Build OBR-9 sequence - collection volume
"RTN","LA7VOBR",74,0)
 ; Call with    LA7VOL = collection volume
"RTN","LA7VOBR",75,0)
 ;            LA764061 = units (pointer to #64.061)
"RTN","LA7VOBR",76,0)
 ;               LA7FS = HL7 field separator
"RTN","LA7VOBR",77,0)
 ;              LA7ECH = HL encoding characters
"RTN","LA7VOBR",78,0)
 ; Returns OBR-9 sequence
"RTN","LA7VOBR",79,0)
 ;
"RTN","LA7VOBR",80,0)
 N LA7IENS,LA7X,LA7Y
"RTN","LA7VOBR",81,0)
 ;
"RTN","LA7VOBR",82,0)
 D OBR9^LA7VOBRA
"RTN","LA7VOBR",83,0)
 ;
"RTN","LA7VOBR",84,0)
 Q LA7Y
"RTN","LA7VOBR",85,0)
 ;
"RTN","LA7VOBR",86,0)
 ;
"RTN","LA7VOBR",87,0)
OBR11(LA7X) ; Build OBR-11 sequence - speciman action code
"RTN","LA7VOBR",88,0)
 ; Call with LA7X = HL7 Table 0065 entry
"RTN","LA7VOBR",89,0)
 ; Returns OBR-11 sequence
"RTN","LA7VOBR",90,0)
 ;
"RTN","LA7VOBR",91,0)
 ; JMC-12/09/99 Need to expand this function to determine based on collection status
"RTN","LA7VOBR",92,0)
 ;
"RTN","LA7VOBR",93,0)
 Q LA7X
"RTN","LA7VOBR",94,0)
 ;
"RTN","LA7VOBR",95,0)
 ;
"RTN","LA7VOBR",96,0)
OBR12(LRDFN,LA7FS,LA7ECH) ; Build OBR-12 sequence - patient info
"RTN","LA7VOBR",97,0)
 ; Call with  LRDFN = ien of patient in #63
"RTN","LA7VOBR",98,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",99,0)
 ;           LA7ECH = HL7 encoding characters
"RTN","LA7VOBR",100,0)
 ; Returns OBR-12 sequence
"RTN","LA7VOBR",101,0)
 ;
"RTN","LA7VOBR",102,0)
 N LA7X
"RTN","LA7VOBR",103,0)
 ;
"RTN","LA7VOBR",104,0)
 S LRDFN=$G(LRDFN),LA7ECH=$G(LA7ECH)
"RTN","LA7VOBR",105,0)
 ; Infection Warning
"RTN","LA7VOBR",106,0)
 S LA7X=$P($G(^LR(LRDFN,.091)),U)
"RTN","LA7VOBR",107,0)
 S LA7X=$$CHKDATA^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VOBR",108,0)
 ;
"RTN","LA7VOBR",109,0)
 Q $E(LA7ECH,1)_LA7X
"RTN","LA7VOBR",110,0)
 ;
"RTN","LA7VOBR",111,0)
 ;
"RTN","LA7VOBR",112,0)
OBR13(LA7TXT,LA7FS,LA7ECH) ; Build OBR-13 sequence - revelant clinical info
"RTN","LA7VOBR",113,0)
 ; Call with LA7TXT = text to place into OBR-13
"RTN","LA7VOBR",114,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",115,0)
 ;           LA7ECH = HL7 encoding characters
"RTN","LA7VOBR",116,0)
 ; Returns OBR-12 sequence
"RTN","LA7VOBR",117,0)
 ;
"RTN","LA7VOBR",118,0)
 N LA7X
"RTN","LA7VOBR",119,0)
 ;
"RTN","LA7VOBR",120,0)
 S LA7X=$$CHKDATA^LA7VHLU3(LA7TXT,LA7FS_LA7ECH)
"RTN","LA7VOBR",121,0)
 ;
"RTN","LA7VOBR",122,0)
 Q LA7X
"RTN","LA7VOBR",123,0)
 ;
"RTN","LA7VOBR",124,0)
 ;
"RTN","LA7VOBR",125,0)
OBR14(LA7DT) ; Build OBR-14 sequence - speciman arrival date/time
"RTN","LA7VOBR",126,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBR",127,0)
 ; Returns OBR-14 sequence
"RTN","LA7VOBR",128,0)
 ;
"RTN","LA7VOBR",129,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBR",130,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBR",131,0)
 ;
"RTN","LA7VOBR",132,0)
 ;
"RTN","LA7VOBR",133,0)
OBR15(LA761,LA762,LA7ALT,LA7FS,LA7ECH,LA7CM) ; Build OBR-15 sequence - specimen source
"RTN","LA7VOBR",134,0)
 ; Call with LA761 = ien of topography file #61
"RTN","LA7VOBR",135,0)
 ;           LA762 = ien of collection sample in file #62
"RTN","LA7VOBR",136,0)
 ;          LA7ALT = alternate non-HL7 codes/text/coding system in form -
"RTN","LA7VOBR",137,0)
 ;                   specimen code^specimen text^specimen system^CONTROL^collection sample code^collection sample^collection system.
"RTN","LA7VOBR",138,0)
 ;                   "CONTROL" only present when specimen is a lab control from file #62.3.
"RTN","LA7VOBR",139,0)
 ;                   presence of these will override standard HL7 tables
"RTN","LA7VOBR",140,0)
 ;           LA7FS = HL7 field separator
"RTN","LA7VOBR",141,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VOBR",142,0)
 ;           LA7CM = ien of shipping condition file #62.93 (collection method)
"RTN","LA7VOBR",143,0)
 ; Returns OBR-15 sequence in LA7Y
"RTN","LA7VOBR",144,0)
 ;
"RTN","LA7VOBR",145,0)
 N LA764061,LA7COMP,LA7ERR,LA7X,LA7Y,LA7Z,X,Y
"RTN","LA7VOBR",146,0)
 ;
"RTN","LA7VOBR",147,0)
 D OBR15^LA7VOBRA
"RTN","LA7VOBR",148,0)
 ;
"RTN","LA7VOBR",149,0)
 Q LA7Y
"RTN","LA7VOBR",150,0)
 ;
"RTN","LA7VOBR",151,0)
 ;
"RTN","LA7VOBR",152,0)
OBR18(LA7X,LA7FS,LA7ECH) ; Build OBR-18 sequence - Placer's field #1
"RTN","LA7VOBR",153,0)
 ; Call with   LA7X = array containing components to store, pass by reference.
"RTN","LA7VOBR",154,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",155,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBR",156,0)
 ;
"RTN","LA7VOBR",157,0)
 ; Returns OBR-18 sequence
"RTN","LA7VOBR",158,0)
 ;
"RTN","LA7VOBR",159,0)
 N LA7I,LA7Y,LA7Z
"RTN","LA7VOBR",160,0)
 ;
"RTN","LA7VOBR",161,0)
 D OBRPF^LA7VOBRA
"RTN","LA7VOBR",162,0)
 ;
"RTN","LA7VOBR",163,0)
 Q LA7Y
"RTN","LA7VOBR",164,0)
 ;
"RTN","LA7VOBR",165,0)
 ;
"RTN","LA7VOBR",166,0)
OBR19(LA7X,LA7FS,LA7ECH) ; Build OBR-19 sequence - Placer's field #2
"RTN","LA7VOBR",167,0)
 ; Call with LA7X() = array containing components to store, pass by reference.
"RTN","LA7VOBR",168,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",169,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBR",170,0)
 ;
"RTN","LA7VOBR",171,0)
 ; Returns OBR-19 sequence
"RTN","LA7VOBR",172,0)
 ;
"RTN","LA7VOBR",173,0)
 N LA7I,LA7Y,LA7Z
"RTN","LA7VOBR",174,0)
 ;
"RTN","LA7VOBR",175,0)
 D OBRPF^LA7VOBRA
"RTN","LA7VOBR",176,0)
 ;
"RTN","LA7VOBR",177,0)
 Q LA7Y
"RTN","LA7VOBR",178,0)
 ;
"RTN","LA7VOBR",179,0)
 ;
"RTN","LA7VOBR",180,0)
OBR20(LA7X,LA7FS,LA7ECH) ; Build OBR-20 sequence - Filler's field #1
"RTN","LA7VOBR",181,0)
 ; Call with   LA7X = array containing components to store, pass by reference.
"RTN","LA7VOBR",182,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",183,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBR",184,0)
 ;
"RTN","LA7VOBR",185,0)
 ; Returns OBR-20 sequence
"RTN","LA7VOBR",186,0)
 ;
"RTN","LA7VOBR",187,0)
 N LA7I,LA7Y,LA7Z
"RTN","LA7VOBR",188,0)
 ;
"RTN","LA7VOBR",189,0)
 D OBRPF^LA7VOBRA
"RTN","LA7VOBR",190,0)
 ;
"RTN","LA7VOBR",191,0)
 Q LA7Y
"RTN","LA7VOBR",192,0)
 ;
"RTN","LA7VOBR",193,0)
 ;
"RTN","LA7VOBR",194,0)
OBR21(LA7X,LA7FS,LA7ECH) ; Build OBR-21 sequence - Filler's field #2
"RTN","LA7VOBR",195,0)
 ; Call with LA7X() = array containing components to store, pass by reference.
"RTN","LA7VOBR",196,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",197,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBR",198,0)
 ;
"RTN","LA7VOBR",199,0)
 ; Returns OBR-21 sequence
"RTN","LA7VOBR",200,0)
 ;
"RTN","LA7VOBR",201,0)
 N LA7I,LA7Y,LA7Z
"RTN","LA7VOBR",202,0)
 ;
"RTN","LA7VOBR",203,0)
 D OBRPF^LA7VOBRA
"RTN","LA7VOBR",204,0)
 ;
"RTN","LA7VOBR",205,0)
 Q LA7Y
"RTN","LA7VOBR",206,0)
 ;
"RTN","LA7VOBR",207,0)
 ;
"RTN","LA7VOBR",208,0)
OBR22(LA7DT) ; Build OBR-22 sequence - date report completed
"RTN","LA7VOBR",209,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBR",210,0)
 ;
"RTN","LA7VOBR",211,0)
 ; Returns OBR-22 sequence
"RTN","LA7VOBR",212,0)
 ;
"RTN","LA7VOBR",213,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBR",214,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBR",215,0)
 ;
"RTN","LA7VOBR",216,0)
 ;
"RTN","LA7VOBR",217,0)
OBR24(LA7SS) ; Build OBR-24 sequence - diagnostice service id
"RTN","LA7VOBR",218,0)
 ; Call with LA7SS = File #63 subscript^section within subscript
"RTN","LA7VOBR",219,0)
 ;
"RTN","LA7VOBR",220,0)
 ; Returns OBR-24 sequence
"RTN","LA7VOBR",221,0)
 ;
"RTN","LA7VOBR",222,0)
 N LA7Y,LA7X
"RTN","LA7VOBR",223,0)
 ;
"RTN","LA7VOBR",224,0)
 D OBR24^LA7VOBRA
"RTN","LA7VOBR",225,0)
 ;
"RTN","LA7VOBR",226,0)
 Q LA7Y
"RTN","LA7VOBR",227,0)
 ;
"RTN","LA7VOBR",228,0)
 ;
"RTN","LA7VOBR",229,0)
OBR26(LA7OBX3,LA7OBX4,LA7OBX5,LA7FS,LA7ECH)     ; Build OBR-26 sequence - Parent result
"RTN","LA7VOBR",230,0)
 ; Call with LA7OBX3 = OBX-3 observation id of parent result
"RTN","LA7VOBR",231,0)
 ;           LA7OBX4 = OBX-4 sub-id of parent result
"RTN","LA7VOBR",232,0)
 ;           LA7OBX5 = OBX-5 parent result
"RTN","LA7VOBR",233,0)
 ;             LA7FS = HL7 Field separator
"RTN","LA7VOBR",234,0)
 ;            LA7ECH = HL7 encoding characters
"RTN","LA7VOBR",235,0)
 ;
"RTN","LA7VOBR",236,0)
 N LA7C,LA7SC,LA7Y,LA7Z
"RTN","LA7VOBR",237,0)
 ;
"RTN","LA7VOBR",238,0)
 D OBR26^LA7VOBRA
"RTN","LA7VOBR",239,0)
 ;
"RTN","LA7VOBR",240,0)
 Q LA7Y
"RTN","LA7VOBR",241,0)
 ;
"RTN","LA7VOBR",242,0)
 ;
"RTN","LA7VOBR",243,0)
OBR27(LA7DUR,LA7DURU,LA76205,LA7FS,LA7ECH) ; Build OBR-27 sequence - Quantity/Timing
"RTN","LA7VOBR",244,0)
 ; Call with  LA7DUR = collection duration
"RTN","LA7VOBR",245,0)
 ;           LA7DURU = duration units (pointer to #64.061)
"RTN","LA7VOBR",246,0)
 ;           LA76205 = test urgency
"RTN","LA7VOBR",247,0)
 ;             LA7FS = HL7 field separator
"RTN","LA7VOBR",248,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBR",249,0)
 ;
"RTN","LA7VOBR",250,0)
 ; Returns OBR-27 sequence
"RTN","LA7VOBR",251,0)
 ;
"RTN","LA7VOBR",252,0)
 ; Since field is same as ORC-7, use builder for ORC-7 field.
"RTN","LA7VOBR",253,0)
 ;
"RTN","LA7VOBR",254,0)
 ;
"RTN","LA7VOBR",255,0)
 Q $$ORC7^LA7VORC(LA7DUR,LA7DURU,LA76205,LA7FS,LA7ECH)
"RTN","LA7VOBR",256,0)
 ;
"RTN","LA7VOBR",257,0)
 ;
"RTN","LA7VOBR",258,0)
OBR29(LA7PON,LA7FON,LA7FS,LA7ECH)       ; Build OBR-29 sequence - Parent
"RTN","LA7VOBR",259,0)
 ; Call with LA7PON = parent's placer order number
"RTN","LA7VOBR",260,0)
 ;           LA7FON = parent's filler order nubmer
"RTN","LA7VOBR",261,0)
 ;            LA7FS = HL7 field separator
"RTN","LA7VOBR",262,0)
 ;           LA7ECH = HL7 encoding characters
"RTN","LA7VOBR",263,0)
 ;
"RTN","LA7VOBR",264,0)
 N LA7Y,LA7Z
"RTN","LA7VOBR",265,0)
 ;
"RTN","LA7VOBR",266,0)
 D OBR29^LA7VOBRA
"RTN","LA7VOBR",267,0)
 ;
"RTN","LA7VOBR",268,0)
 Q LA7Y
"RTN","LA7VOBR",269,0)
 ;
"RTN","LA7VOBR",270,0)
 ;
"RTN","LA7VOBR",271,0)
OBR32(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build OBR-32 sequence - Principle Result Interpreter field
"RTN","LA7VOBR",272,0)
 ; Call with   LA7DUZ = DUZ of verifying user
"RTN","LA7VOBR",273,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VOBR",274,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBR",275,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBR",276,0)
 ;           
"RTN","LA7VOBR",277,0)
 ; Returns OBR-32 sequence
"RTN","LA7VOBR",278,0)
 ;
"RTN","LA7VOBR",279,0)
 Q $$XCN^LA7VHLU4(LA7DUZ,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBR",280,0)
 ;
"RTN","LA7VOBR",281,0)
 ;
"RTN","LA7VOBR",282,0)
OBR33(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build OBR-32 sequence - Assistant Result Interpreter field
"RTN","LA7VOBR",283,0)
 ; Call with   LA7DUZ = DUZ of assistant interpreter
"RTN","LA7VOBR",284,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VOBR",285,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBR",286,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBR",287,0)
 ;           
"RTN","LA7VOBR",288,0)
 ; Returns OBR-33 sequence
"RTN","LA7VOBR",289,0)
 ;
"RTN","LA7VOBR",290,0)
 Q $$XCN^LA7VHLU4(LA7DUZ,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBR",291,0)
 ;
"RTN","LA7VOBR",292,0)
 ;
"RTN","LA7VOBR",293,0)
OBR34(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build OBR-34 sequence - Technician field
"RTN","LA7VOBR",294,0)
 ; Call with   LA7DUZ = DUZ of techician
"RTN","LA7VOBR",295,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VOBR",296,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBR",297,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBR",298,0)
 ;           
"RTN","LA7VOBR",299,0)
 ; Returns OBR-34 sequence
"RTN","LA7VOBR",300,0)
 ;
"RTN","LA7VOBR",301,0)
 Q $$XCN^LA7VHLU4(LA7DUZ,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBR",302,0)
 ;
"RTN","LA7VOBR",303,0)
 ;
"RTN","LA7VOBR",304,0)
OBR35(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build OBR-35 sequence - Transcriptionist field
"RTN","LA7VOBR",305,0)
 ; Call with   LA7DUZ = DUZ of transcriptionist
"RTN","LA7VOBR",306,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VOBR",307,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBR",308,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBR",309,0)
 ;           
"RTN","LA7VOBR",310,0)
 ; Returns OBR-35 sequence
"RTN","LA7VOBR",311,0)
 ;
"RTN","LA7VOBR",312,0)
 Q $$XCN^LA7VHLU4(LA7DUZ,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBRA")
0^12^B37451712
"RTN","LA7VOBRA",1,0)
LA7VOBRA ;DALOI/JMC - LAB OBR segment builder (cont'd); 11-14-01
"RTN","LA7VOBRA",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VOBRA",3,0)
 ;
"RTN","LA7VOBRA",4,0)
 Q
"RTN","LA7VOBRA",5,0)
 ;
"RTN","LA7VOBRA",6,0)
 ;
"RTN","LA7VOBRA",7,0)
OBR4 ; Build OBR-4 sequence - Universal service ID
"RTN","LA7VOBRA",8,0)
 ;
"RTN","LA7VOBRA",9,0)
 S LA764=0,LA7Y=""
"RTN","LA7VOBRA",10,0)
 ; specify component position - primary/alternate
"RTN","LA7VOBRA",11,0)
 S LA7COMP=0
"RTN","LA7VOBRA",12,0)
 ;
"RTN","LA7VOBRA",13,0)
 ; Send non-VA test codes as first coding system
"RTN","LA7VOBRA",14,0)
 I LA7ALT'="" D
"RTN","LA7VOBRA",15,0)
 . N I
"RTN","LA7VOBRA",16,0)
 . F I=1:1:3 S $P(LA7Y,$E(LA7ECH),LA7COMP+I)=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",I),LA7FS_LA7ECH)
"RTN","LA7VOBRA",17,0)
 . S LA7COMP=LA7COMP+I
"RTN","LA7VOBRA",18,0)
 ;
"RTN","LA7VOBRA",19,0)
 ; Send NLT test codes as primary unless non-VA codes then send as alternate code
"RTN","LA7VOBRA",20,0)
 I LA7NLT'="" D
"RTN","LA7VOBRA",21,0)
 . S LA764=$O(^LAM("E",LA7NLT,0)),LA7Z=""
"RTN","LA7VOBRA",22,0)
 . I LA764 S LA7Z=$$GET1^DIQ(64,LA764_",",.01,"I")
"RTN","LA7VOBRA",23,0)
 . I LA7Z="" D
"RTN","LA7VOBRA",24,0)
 . . N LA7642
"RTN","LA7VOBRA",25,0)
 . . S LA764=$O(^LAM("E",$P(LA7NLT,".")_".0000",0))
"RTN","LA7VOBRA",26,0)
 . . I LA764 S LA7Z=$$GET1^DIQ(64,LA764_",",.01,"I")
"RTN","LA7VOBRA",27,0)
 . . S LA7642=$O(^LAB(64.2,"C","."_$P(LA7NLT,".",2),0))
"RTN","LA7VOBRA",28,0)
 . . I LA764,LA7642 S LA7Z=LA7Z_"~"_$$GET1^DIQ(64.2,LA7624_",",.01,"I")
"RTN","LA7VOBRA",29,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+1)=$$CHKDATA^LA7VHLU3(LA7NLT,LA7FS_LA7ECH)
"RTN","LA7VOBRA",30,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+2)=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBRA",31,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+3)="99VA64"
"RTN","LA7VOBRA",32,0)
 . S LA7COMP=LA7COMP+3
"RTN","LA7VOBRA",33,0)
 ;
"RTN","LA7VOBRA",34,0)
 ; Send file #60 test name if available and no alternate
"RTN","LA7VOBRA",35,0)
 I LA7COMP<4,LA760 D
"RTN","LA7VOBRA",36,0)
 . S LA7TN=$$GET1^DIQ(60,LA760_",",.01)
"RTN","LA7VOBRA",37,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+1)=LA760
"RTN","LA7VOBRA",38,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+2)=$$CHKDATA^LA7VHLU3(LA7TN,LA7FS_LA7ECH)
"RTN","LA7VOBRA",39,0)
 . S $P(LA7Y,$E(LA7ECH),LA7COMP+3)="99VA60"
"RTN","LA7VOBRA",40,0)
 ;
"RTN","LA7VOBRA",41,0)
 Q
"RTN","LA7VOBRA",42,0)
 ;
"RTN","LA7VOBRA",43,0)
 ;
"RTN","LA7VOBRA",44,0)
OBR9 ; Build OBR-9 sequence - collection volume
"RTN","LA7VOBRA",45,0)
 ;
"RTN","LA7VOBRA",46,0)
 ; Collection volume
"RTN","LA7VOBRA",47,0)
 S $P(LA7Y,$E(LA7ECH,1))=LA7VOL
"RTN","LA7VOBRA",48,0)
 ;
"RTN","LA7VOBRA",49,0)
 I LA764061 D
"RTN","LA7VOBRA",50,0)
 . S LA7IENS=LA764061_","
"RTN","LA7VOBRA",51,0)
 . D GETS^DIQ(64.061,LA7IENS,".01;1","E","LA7Y")
"RTN","LA7VOBRA",52,0)
 . ; Collection Volume units code
"RTN","LA7VOBRA",53,0)
 . S $P(LA7X,$E(LA7ECH,4),1)=$G(LA7Y(64.061,LA7IENS,.01,"E"))
"RTN","LA7VOBRA",54,0)
 . ; Collection Volume units text
"RTN","LA7VOBRA",55,0)
 . S $P(LA7X,$E(LA7ECH,4),2)=$$CHKDATA^LA7VHLU3($G(LA7Y(64.061,LA7IENS,1,"E")),LA7FS_LA7ECH)
"RTN","LA7VOBRA",56,0)
 . ; LOINC coding system
"RTN","LA7VOBRA",57,0)
 . S $P(LA7X,$E(LA7ECH,4),3)="LN"
"RTN","LA7VOBRA",58,0)
 . S $P(LA7Y,$E(LA7ECH,1),2)=LA7X
"RTN","LA7VOBRA",59,0)
 ;
"RTN","LA7VOBRA",60,0)
 Q
"RTN","LA7VOBRA",61,0)
 ;
"RTN","LA7VOBRA",62,0)
 ;
"RTN","LA7VOBRA",63,0)
OBR15 ; Build OBR-15 sequence - specimen source
"RTN","LA7VOBRA",64,0)
 ;
"RTN","LA7VOBRA",65,0)
 S LA764061=0
"RTN","LA7VOBRA",66,0)
 S LA7COMP=0 ; specify subcomponent position - primary/alternate
"RTN","LA7VOBRA",67,0)
 S LA7Y=""
"RTN","LA7VOBRA",68,0)
 ;
"RTN","LA7VOBRA",69,0)
 ; Get entry in #64.061 for this Topography file #61 entry.
"RTN","LA7VOBRA",70,0)
 I LA761>0 S LA764061=$$GET1^DIQ(61,LA761_",",.09,"I","LA7ERR")
"RTN","LA7VOBRA",71,0)
 ;
"RTN","LA7VOBRA",72,0)
 ; If no specimen code then default to HL7 0070 entry "XXX"
"RTN","LA7VOBRA",73,0)
 I LA764061<1 D
"RTN","LA7VOBRA",74,0)
 . N LA7SCR
"RTN","LA7VOBRA",75,0)
 . S LA7SCR="I $P(^LAB(64.061,Y,0),U,5)=""0070"",$P(^LAB(64.061,Y,0),U,7)=""S"""
"RTN","LA7VOBRA",76,0)
 . S LA764061=$$FIND1^DIC(64.061,,"X","XXX","D",LA7SCR,"LA7ERR")
"RTN","LA7VOBRA",77,0)
 ;
"RTN","LA7VOBRA",78,0)
 I LA764061<1 Q LA7Y
"RTN","LA7VOBRA",79,0)
 ;
"RTN","LA7VOBRA",80,0)
 D GETS^DIQ(64.061,LA764061_",",".01;1;2;3;5","","LA7Z","LA7ERR")
"RTN","LA7VOBRA",81,0)
 I '$D(LA7Z) Q LA7Y
"RTN","LA7VOBRA",82,0)
 ;
"RTN","LA7VOBRA",83,0)
 ; Send non-standard local code as primary
"RTN","LA7VOBRA",84,0)
 I $P(LA7ALT,"^")'=""!($P(LA7ALT,"^",2)'="") D
"RTN","LA7VOBRA",85,0)
 . S LA7X=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^"),LA7FS_LA7ECH)
"RTN","LA7VOBRA",86,0)
 . S $P(LA7Y,$E(LA7ECH,4),1)=LA7X
"RTN","LA7VOBRA",87,0)
 . S LA7X=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",2),LA7FS_LA7ECH)
"RTN","LA7VOBRA",88,0)
 . S $P(LA7Y,$E(LA7ECH,4),2)=LA7X
"RTN","LA7VOBRA",89,0)
 . S $P(LA7Y,$E(LA7ECH,4),3)=$P(LA7ALT,"^",3)
"RTN","LA7VOBRA",90,0)
 . S LA7COMP=LA7COMP+3
"RTN","LA7VOBRA",91,0)
 ;
"RTN","LA7VOBRA",92,0)
 ; Send HL7 Table 0070 coding as primary code
"RTN","LA7VOBRA",93,0)
 I LA7Z(64.061,LA764061_",",2)'="",LA7COMP<6 D
"RTN","LA7VOBRA",94,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7Z(64.061,LA764061_",",2),LA7FS_LA7ECH)
"RTN","LA7VOBRA",95,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+1)=LA7X
"RTN","LA7VOBRA",96,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7Z(64.061,LA764061_",",.01),LA7FS_LA7ECH)
"RTN","LA7VOBRA",97,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+2)=LA7X
"RTN","LA7VOBRA",98,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+3)="HL7"_LA7Z(64.061,LA764061_",",5)
"RTN","LA7VOBRA",99,0)
 . S LA7COMP=LA7COMP+3
"RTN","LA7VOBRA",100,0)
 ;
"RTN","LA7VOBRA",101,0)
 ; Send LOINC code as primary unless HL7 code then send as alternate code
"RTN","LA7VOBRA",102,0)
 I LA7Z(64.061,LA764061_",",1)'="",LA7COMP<6 D
"RTN","LA7VOBRA",103,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7Z(64.061,LA764061_",",1),LA7FS_LA7ECH)
"RTN","LA7VOBRA",104,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+1)=LA7X
"RTN","LA7VOBRA",105,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7Z(64.061,LA764061_",",.01),LA7FS_LA7ECH)
"RTN","LA7VOBRA",106,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+2)=LA7X
"RTN","LA7VOBRA",107,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+3)="LN"
"RTN","LA7VOBRA",108,0)
 . S LA7COMP=LA7COMP+3
"RTN","LA7VOBRA",109,0)
 ;
"RTN","LA7VOBRA",110,0)
 ; If VA code and not HL7 and/or LOINC
"RTN","LA7VOBRA",111,0)
 I LA7Z(64.061,LA764061_",",3)'="",LA7COMP<6 D
"RTN","LA7VOBRA",112,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7Z(64.061,LA764061_",",3),LA7FS_LA7ECH)
"RTN","LA7VOBRA",113,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+1)=LA7X
"RTN","LA7VOBRA",114,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7Z(64.061,LA764061_",",.01),LA7FS_LA7ECH)
"RTN","LA7VOBRA",115,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+2)=LA7X
"RTN","LA7VOBRA",116,0)
 . S $P(LA7Y,$E(LA7ECH,4),LA7COMP+3)="99VA64.061"
"RTN","LA7VOBRA",117,0)
 ;
"RTN","LA7VOBRA",118,0)
 ; LA7ALT should contain "CONTROL" in 4th piece if from file #62.3
"RTN","LA7VOBRA",119,0)
 I $P(LA7ALT,"^",4)'="" D
"RTN","LA7VOBRA",120,0)
 . N LA7TXT
"RTN","LA7VOBRA",121,0)
 . S LA7TXT=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",4),LA7FS_LA7ECH)
"RTN","LA7VOBRA",122,0)
 . S $P(LA7Y,$E(LA7ECH,1),3)=LA7TXT
"RTN","LA7VOBRA",123,0)
 ;
"RTN","LA7VOBRA",124,0)
 ;
"RTN","LA7VOBRA",125,0)
 ; Get entry in #62 for this collection sample entry.
"RTN","LA7VOBRA",126,0)
 I LA762,$P(LA7ALT,"^",5)="",$P(LA7ALT,"^",6)="" D
"RTN","LA7VOBRA",127,0)
 . S LA7X=$$GET1^DIQ(62,LA762_",",.01,"","LA7ERR")
"RTN","LA7VOBRA",128,0)
 . S LA7X=$$TRIM^XLFSTR(LA7X,"LR"," ")
"RTN","LA7VOBRA",129,0)
 . S LA7X=$$CHKDATA^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VOBRA",130,0)
 . S LA7X=LA762_$E(LA7ECH,4)_LA7X_$E(LA7ECH,4)_"99VA62"
"RTN","LA7VOBRA",131,0)
 . S $P(LA7Y,$E(LA7ECH,1),4)=LA7X
"RTN","LA7VOBRA",132,0)
 ;
"RTN","LA7VOBRA",133,0)
 ; Send collection sample code for DoD.
"RTN","LA7VOBRA",134,0)
 I $P(LA7ALT,"^",5)'=""!($P(LA7ALT,"^",6)'="") D
"RTN","LA7VOBRA",135,0)
 . S X=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",5),LA7FS_LA7ECH)
"RTN","LA7VOBRA",136,0)
 . S Y=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",6),LA7FS_LA7ECH)
"RTN","LA7VOBRA",137,0)
 . S LA7X=X_$E(LA7ECH,4)_Y_$E(LA7ECH,4)_$P(LA7ALT,"^",7)
"RTN","LA7VOBRA",138,0)
 . S $P(LA7Y,$E(LA7ECH,1),4)=LA7X
"RTN","LA7VOBRA",139,0)
 ;
"RTN","LA7VOBRA",140,0)
 ; Send specimen shipping condition - collection method
"RTN","LA7VOBRA",141,0)
 I $G(LA7CM) D
"RTN","LA7VOBRA",142,0)
 . S X=$$GET1^DIQ(62.93,LA7CM_",",.01)
"RTN","LA7VOBRA",143,0)
 . I X'="" S X=$$CHKDATA^LA7VHLU3(X,LA7FS_LA7ECH)
"RTN","LA7VOBRA",144,0)
 . S Y=$$GET1^DIQ(62.93,LA7CM_",",.02)
"RTN","LA7VOBRA",145,0)
 . I Y'="" S Y=$$CHKDATA^LA7VHLU3(Y,LA7FS_LA7ECH)
"RTN","LA7VOBRA",146,0)
 . S LA7X=Y_$E(LA7ECH,4)_X_$E(LA7ECH,4)_"99VA62.93"
"RTN","LA7VOBRA",147,0)
 . S $P(LA7Y,$E(LA7ECH,1),6)=LA7X
"RTN","LA7VOBRA",148,0)
 Q
"RTN","LA7VOBRA",149,0)
 ;
"RTN","LA7VOBRA",150,0)
 ;
"RTN","LA7VOBRA",151,0)
OBR24 ; Build OBR-24 sequence - diagnostic service id
"RTN","LA7VOBRA",152,0)
 ;
"RTN","LA7VOBRA",153,0)
 ; Code non-MI subscripts
"RTN","LA7VOBRA",154,0)
 I $P(LA7SS,"^")'="MI" D  Q
"RTN","LA7VOBRA",155,0)
 . S LA7X=$P(LA7SS,"^")
"RTN","LA7VOBRA",156,0)
 . S LA7Y=$S(LA7X="CH":"CH",LA7X="SP":"SP",LA7X="CY":"CP",LA7X="EM":"PAT",LA7X="AU":"PAT",LA7X="BB":"BLB",1:"LAB")
"RTN","LA7VOBRA",157,0)
 ;
"RTN","LA7VOBRA",158,0)
 ; Code MI subscripts
"RTN","LA7VOBRA",159,0)
 S LA7X=$P(LA7SS,"^",2)
"RTN","LA7VOBRA",160,0)
 S LA7Y=$S(LA7X=11:"MB",LA7X=14:"PAR",LA7X=18:"MYC",LA7X=22:"MCB",LA7X=33:"VR",1:"MB")
"RTN","LA7VOBRA",161,0)
 ;
"RTN","LA7VOBRA",162,0)
 Q
"RTN","LA7VOBRA",163,0)
 ;
"RTN","LA7VOBRA",164,0)
 ;
"RTN","LA7VOBRA",165,0)
OBR26 ; Build OBR-26 sequence - Parent result
"RTN","LA7VOBRA",166,0)
 ;
"RTN","LA7VOBRA",167,0)
 S LA7Y=""
"RTN","LA7VOBRA",168,0)
 ;
"RTN","LA7VOBRA",169,0)
 ; Move component into sub-component position
"RTN","LA7VOBRA",170,0)
 ; Translate component character to sub-component character
"RTN","LA7VOBRA",171,0)
 S LA7C=$E(LA7ECH,1),LA7SC=$E(LA7ECH,4)
"RTN","LA7VOBRA",172,0)
 ;
"RTN","LA7VOBRA",173,0)
 ; Parent result observation identifier in 1st component
"RTN","LA7VOBRA",174,0)
 I LA7OBX3'="" S $P(LA7Y,$E(LA7ECH,1),1)=$TR(LA7OBX3,LA7C,LA7SC)
"RTN","LA7VOBRA",175,0)
 ;
"RTN","LA7VOBRA",176,0)
 ; Parent sub-id in 2nd component
"RTN","LA7VOBRA",177,0)
 I LA7OBX4'="" S $P(LA7Y,$E(LA7ECH,1),2)=$TR(LA7OBX4,LA7C,LA7SC)
"RTN","LA7VOBRA",178,0)
 ;
"RTN","LA7VOBRA",179,0)
 ; Parent test result in 3rd component
"RTN","LA7VOBRA",180,0)
 I LA7OBX5'="" S $P(LA7Y,$E(LA7ECH,1),3)=$TR(LA7OBX5,LA7C,LA7SC)
"RTN","LA7VOBRA",181,0)
 ;
"RTN","LA7VOBRA",182,0)
 Q
"RTN","LA7VOBRA",183,0)
 ;
"RTN","LA7VOBRA",184,0)
 ;
"RTN","LA7VOBRA",185,0)
OBR29 ; Build OBR-29 sequence - Parent
"RTN","LA7VOBRA",186,0)
 ;
"RTN","LA7VOBRA",187,0)
 S LA7Y=""
"RTN","LA7VOBRA",188,0)
 ;
"RTN","LA7VOBRA",189,0)
 I $G(LA7PON)'="" D
"RTN","LA7VOBRA",190,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7PON,LA7FS_LA7ECH)
"RTN","LA7VOBRA",191,0)
 . S $P(LA7Y,$E(LA7ECH,1),1)=LA7Z
"RTN","LA7VOBRA",192,0)
 ;
"RTN","LA7VOBRA",193,0)
 I $G(LA7FON)'="" D
"RTN","LA7VOBRA",194,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7FON,LA7FS_LA7ECH)
"RTN","LA7VOBRA",195,0)
 . S $P(LA7Y,$E(LA7ECH,2),1)=LA7Z
"RTN","LA7VOBRA",196,0)
 ;
"RTN","LA7VOBRA",197,0)
 Q
"RTN","LA7VOBRA",198,0)
 ;
"RTN","LA7VOBRA",199,0)
 ;
"RTN","LA7VOBRA",200,0)
OBRPF ; Build OBR-18,19,20,21 Placer/Filler #1/#2
"RTN","LA7VOBRA",201,0)
 ;
"RTN","LA7VOBRA",202,0)
 S (LA7Y,LA7Z)="",LA7I=0
"RTN","LA7VOBRA",203,0)
 F  S LA7I=$O(LA7X(LA7I)) Q:'LA7I  S $P(LA7Z,"^",LA7I)=LA7X(LA7I)
"RTN","LA7VOBRA",204,0)
 S LA7Y=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBRA",205,0)
 Q
"RTN","LA7VOBX")
0^14^B25091305
"RTN","LA7VOBX",1,0)
LA7VOBX ;DALOI/JMC - LAB OBX Segment message builder ; Feb 19, 2004
"RTN","LA7VOBX",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VOBX",3,0)
 ;
"RTN","LA7VOBX",4,0)
OBX(LRDFN,LRSS,LRIDT,LRSB,LA7ARRAY,LA7OBXSN,LA7FS,LA7ECH,LA7NVAF) ; Observation/Result segment for Lab Results.
"RTN","LA7VOBX",5,0)
 ; Call with    LRDFN = ien of entry in file #63
"RTN","LA7VOBX",6,0)
 ;               LRSS = file #63 subscript
"RTN","LA7VOBX",7,0)
 ;              LRIDT = inverse date/time of specimen
"RTN","LA7VOBX",8,0)
 ;               LRSB = ien of dataname if "CH" subscript or global subscript for others
"RTN","LA7VOBX",9,0)
 ;           LA7ARRAY = array to return OBX segment, pass by reference
"RTN","LA7VOBX",10,0)
 ;           LA7OBXSN = OBX segment sequence number, pass by reference
"RTN","LA7VOBX",11,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBX",12,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBX",13,0)
 ;            LA7NVAF = flag indicating type of receiving facility (see NVAF^LA7VHLU2)
"RTN","LA7VOBX",14,0)
 ;
"RTN","LA7VOBX",15,0)
 ; Returns LA7OBXSN = current OBX segment sequence number 
"RTN","LA7VOBX",16,0)
 ;         LA7ARRAY = array containing OBX segment
"RTN","LA7VOBX",17,0)
 ;
"RTN","LA7VOBX",18,0)
 N LA7OBX,LA7VAL,LA7X
"RTN","LA7VOBX",19,0)
 ;
"RTN","LA7VOBX",20,0)
 ; No subscript/patient/specimen
"RTN","LA7VOBX",21,0)
 I $G(LRSS)=""!('$G(LRDFN))!('$G(LRIDT)) Q
"RTN","LA7VOBX",22,0)
 ;
"RTN","LA7VOBX",23,0)
 S LA7NVAF=$G(LA7NVAF)
"RTN","LA7VOBX",24,0)
 ;
"RTN","LA7VOBX",25,0)
 ; "CH" subscript
"RTN","LA7VOBX",26,0)
 I LRSS="CH" D CH^LA7VOBX1 Q
"RTN","LA7VOBX",27,0)
 ;
"RTN","LA7VOBX",28,0)
 ; "MI" subscript
"RTN","LA7VOBX",29,0)
 I LRSS="MI" D MI^LA7VOBX3 Q
"RTN","LA7VOBX",30,0)
 ;
"RTN","LA7VOBX",31,0)
 ; "SP" subscrpt
"RTN","LA7VOBX",32,0)
 I LRSS="SP" D AP^LA7VOBX2 Q
"RTN","LA7VOBX",33,0)
 ;
"RTN","LA7VOBX",34,0)
 ; "CY" subscrpt
"RTN","LA7VOBX",35,0)
 I LRSS="CY" D AP^LA7VOBX2 Q
"RTN","LA7VOBX",36,0)
 ;
"RTN","LA7VOBX",37,0)
 ; "EM" subscrpt
"RTN","LA7VOBX",38,0)
 I LRSS="EM" D AP^LA7VOBX2 Q
"RTN","LA7VOBX",39,0)
 ;
"RTN","LA7VOBX",40,0)
 Q
"RTN","LA7VOBX",41,0)
 ;
"RTN","LA7VOBX",42,0)
 ;
"RTN","LA7VOBX",43,0)
OBX1(LA7OBXSN) ; Build OBX-1 sequence - Set ID (sequence number)
"RTN","LA7VOBX",44,0)
 ; Call with LA7OBXSN = sequence number (pass by reference)
"RTN","LA7VOBX",45,0)
 ;
"RTN","LA7VOBX",46,0)
 N LA7Y
"RTN","LA7VOBX",47,0)
 ;
"RTN","LA7VOBX",48,0)
 ; increment sequence number
"RTN","LA7VOBX",49,0)
 S (LA7OBXSN,LA7Y)=$G(LA7OBXSN)+1
"RTN","LA7VOBX",50,0)
 ;
"RTN","LA7VOBX",51,0)
 Q LA7Y
"RTN","LA7VOBX",52,0)
 ;
"RTN","LA7VOBX",53,0)
 ;
"RTN","LA7VOBX",54,0)
OBX2(LA7FILE,LA7FIELD) ; Build OBX-2 sequence - Value type
"RTN","LA7VOBX",55,0)
 ; Call with   LA7FILE = FileMan DD file/subfield number
"RTN","LA7VOBX",56,0)
 ;            LA7FIELD = Fileman DD field number
"RTN","LA7VOBX",57,0)
 ;
"RTN","LA7VOBX",58,0)
 ; Returns      LA7VAL = value type  (HL7 table 0125)
"RTN","LA7VOBX",59,0)
 ;
"RTN","LA7VOBX",60,0)
 N LA7ERR,LA7TYP,LA7VAL
"RTN","LA7VOBX",61,0)
 ;
"RTN","LA7VOBX",62,0)
 D OBX2^LA7VOBXA
"RTN","LA7VOBX",63,0)
 ;
"RTN","LA7VOBX",64,0)
 Q LA7VAL
"RTN","LA7VOBX",65,0)
 ;
"RTN","LA7VOBX",66,0)
 ;
"RTN","LA7VOBX",67,0)
OBX3(LA7NLT,LA7953,LA7ALT,LA7FS,LA7ECH) ; Build OBX-3 sequence - Observation identifier field
"RTN","LA7VOBX",68,0)
 ; Call with  LA7NLT = NLT code.
"RTN","LA7VOBX",69,0)
 ;            LA7953 = LOINC code
"RTN","LA7VOBX",70,0)
 ;            LA7ALT = alternate code - local/non-VA (code^text^system)
"RTN","LA7VOBX",71,0)
 ;             LA7FS = HL field separator
"RTN","LA7VOBX",72,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBX",73,0)
 ;
"RTN","LA7VOBX",74,0)
 N LA764,LA7J,LA7LN,LA7X,LA7Y
"RTN","LA7VOBX",75,0)
 ;
"RTN","LA7VOBX",76,0)
 D OBX3^LA7VOBXA
"RTN","LA7VOBX",77,0)
 ;
"RTN","LA7VOBX",78,0)
 Q LA7Y
"RTN","LA7VOBX",79,0)
 ;
"RTN","LA7VOBX",80,0)
 ;
"RTN","LA7VOBX",81,0)
OBX4(LA7VAL,LA7FS,LA7ECH) ; Build OBX-4 sequence - Observation sub-ID
"RTN","LA7VOBX",82,0)
 ; Call with  LA7VAL = value of the observation
"RTN","LA7VOBX",83,0)
 ;             LA7FS = HL field separator
"RTN","LA7VOBX",84,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBX",85,0)
 ;
"RTN","LA7VOBX",86,0)
 ; Returns LA7Y = Observation sub-ID checked for escape encoding
"RTN","LA7VOBX",87,0)
 ;
"RTN","LA7VOBX",88,0)
 N LA7Y
"RTN","LA7VOBX",89,0)
 ;
"RTN","LA7VOBX",90,0)
 S LA7Y=$$CHKDATA^LA7VHLU3(LA7VAL,LA7FS_LA7ECH)
"RTN","LA7VOBX",91,0)
 ;
"RTN","LA7VOBX",92,0)
 Q LA7Y
"RTN","LA7VOBX",93,0)
 ;
"RTN","LA7VOBX",94,0)
 ;
"RTN","LA7VOBX",95,0)
OBX5(LA7VAL,LA7OBX2,LA7FS,LA7ECH) ; Build OBX-5 sequence - Observation value
"RTN","LA7VOBX",96,0)
 ; Call with  LA7VAL = value of the observation
"RTN","LA7VOBX",97,0)
 ;           LA7OBX2 = value type
"RTN","LA7VOBX",98,0)
 ;             LA7FS = HL field separator
"RTN","LA7VOBX",99,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBX",100,0)
 ;
"RTN","LA7VOBX",101,0)
 N LA7Y
"RTN","LA7VOBX",102,0)
 ;
"RTN","LA7VOBX",103,0)
 D OBX5^LA7VOBXA
"RTN","LA7VOBX",104,0)
 ;
"RTN","LA7VOBX",105,0)
 Q LA7Y
"RTN","LA7VOBX",106,0)
 ;
"RTN","LA7VOBX",107,0)
 ;
"RTN","LA7VOBX",108,0)
OBX5M(LA7FN,LA7IENS,LA7FLD,LA7WP,LA7FS,LA7ECH) ; Build OBX-5 sequence - Observation value - multi-line textual result
"RTN","LA7VOBX",109,0)
 ; Call with LA7FN = File number or subfile
"RTN","LA7VOBX",110,0)
 ;         LA7IENS = Standard FileMan IENS indicating internal entry numbers
"RTN","LA7VOBX",111,0)
 ;          LA7FLD = Field number
"RTN","LA7VOBX",112,0)
 ;           LA7WP = array passed by reference to return text
"RTN","LA7VOBX",113,0)
 ;           LA7FS = HL field separator
"RTN","LA7VOBX",114,0)
 ;          LA7ECH = HL encoding characters
"RTN","LA7VOBX",115,0)
 ;
"RTN","LA7VOBX",116,0)
 ; Returns   LA7WP = subscripted array containing text of results
"RTN","LA7VOBX",117,0)
 ;                   LA7WP(0), LA7WP(1), LA7WP(2),...
"RTN","LA7VOBX",118,0)
 ;
"RTN","LA7VOBX",119,0)
 N LA7ERR,LA7I,LA7J,LA7TYPE,LA7X,LA7Y
"RTN","LA7VOBX",120,0)
 ;
"RTN","LA7VOBX",121,0)
 D OBX5M^LA7VOBXA
"RTN","LA7VOBX",122,0)
 ;
"RTN","LA7VOBX",123,0)
 Q
"RTN","LA7VOBX",124,0)
 ;
"RTN","LA7VOBX",125,0)
 ;
"RTN","LA7VOBX",126,0)
OBX5R(LA7VAL,LA7OBX2,LA7FS,LA7ECH) ; Build OBX-5 sequence with repetition - Observation value
"RTN","LA7VOBX",127,0)
 ; Call with  LA7VAL = array passed by reference
"RTN","LA7VOBX",128,0)
 ;           LA7OBX2 = value type
"RTN","LA7VOBX",129,0)
 ;             LA7FS = HL field separator
"RTN","LA7VOBX",130,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBX",131,0)
 ;
"RTN","LA7VOBX",132,0)
 N LA7I,LA7Y
"RTN","LA7VOBX",133,0)
 ;
"RTN","LA7VOBX",134,0)
 D OBX5R^LA7VOBXA
"RTN","LA7VOBX",135,0)
 ;
"RTN","LA7VOBX",136,0)
 Q LA7Y
"RTN","LA7VOBX",137,0)
 ;
"RTN","LA7VOBX",138,0)
 ;
"RTN","LA7VOBX",139,0)
OBX6(LA7VAL,LA764061,LA7FS,LA7ECH) ; Build OBX-6 sequence - Units
"RTN","LA7VOBX",140,0)
 ; Call with   LA7VAL = Units if in external format
"RTN","LA7VOBX",141,0)
 ;           LA764061 = ien of units in #64.061
"RTN","LA7VOBX",142,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBX",143,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBX",144,0)
 ; Returns units
"RTN","LA7VOBX",145,0)
 ;
"RTN","LA7VOBX",146,0)
 N LA7Y
"RTN","LA7VOBX",147,0)
 ;
"RTN","LA7VOBX",148,0)
 D OBX6^LA7VOBXA
"RTN","LA7VOBX",149,0)
 ;
"RTN","LA7VOBX",150,0)
 Q LA7Y
"RTN","LA7VOBX",151,0)
 ;
"RTN","LA7VOBX",152,0)
 ;
"RTN","LA7VOBX",153,0)
OBX7(LA7LOW,LA7HIGH,LA7FS,LA7ECH) ; Build OBX-7 sequence - Reference range
"RTN","LA7VOBX",154,0)
 ; Call with  LA7LOW = lower limit
"RTN","LA7VOBX",155,0)
 ;           LA7HIGH = upper limit
"RTN","LA7VOBX",156,0)
 ;             LA7FS = HL field separator
"RTN","LA7VOBX",157,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VOBX",158,0)
 ; Returns reference range
"RTN","LA7VOBX",159,0)
 ;
"RTN","LA7VOBX",160,0)
 N LA7Y
"RTN","LA7VOBX",161,0)
 ;
"RTN","LA7VOBX",162,0)
 D OBX7^LA7VOBXA
"RTN","LA7VOBX",163,0)
 ;
"RTN","LA7VOBX",164,0)
 Q LA7Y
"RTN","LA7VOBX",165,0)
 ;
"RTN","LA7VOBX",166,0)
 ;
"RTN","LA7VOBX",167,0)
OBX8(LA7FLAG) ; Build OBX-8 sequence - Abnormal flags
"RTN","LA7VOBX",168,0)
 ; Call with LA7FLAG = DHCP Lab normalcy flag
"RTN","LA7VOBX",169,0)
 ; Returns abnormal flags based on HL7 table 0078
"RTN","LA7VOBX",170,0)
 ;
"RTN","LA7VOBX",171,0)
 N LA7Y
"RTN","LA7VOBX",172,0)
 ;
"RTN","LA7VOBX",173,0)
 S LA7Y=$TR(LA7FLAG,"*",$E(LA7FLAG,1)) ; abnormal flag
"RTN","LA7VOBX",174,0)
 Q LA7Y
"RTN","LA7VOBX",175,0)
 ;
"RTN","LA7VOBX",176,0)
 ;
"RTN","LA7VOBX",177,0)
OBX11(LA7FLAG) ; Build OBX-11 sequence - Observation result status
"RTN","LA7VOBX",178,0)
 ; Call with LA7FLAG = DHCP Lab status flag
"RTN","LA7VOBX",179,0)
 ; Returns result status based on HL7 table 0085
"RTN","LA7VOBX",180,0)
 ;
"RTN","LA7VOBX",181,0)
 N LA7Y
"RTN","LA7VOBX",182,0)
 ;
"RTN","LA7VOBX",183,0)
 S LA7Y=""
"RTN","LA7VOBX",184,0)
 ;
"RTN","LA7VOBX",185,0)
 I LA7FLAG="canc" S LA7Y="X"
"RTN","LA7VOBX",186,0)
 I LA7FLAG="comment" S LA7Y="F"
"RTN","LA7VOBX",187,0)
 I LA7FLAG="pending" S LA7Y="I"
"RTN","LA7VOBX",188,0)
 I LA7FLAG="F" S LA7Y="F"
"RTN","LA7VOBX",189,0)
 I LA7FLAG="P" S LA7Y="P"
"RTN","LA7VOBX",190,0)
 I LA7FLAG="A" S LA7Y="C"
"RTN","LA7VOBX",191,0)
 I LA7FLAG="C" S LA7Y="C"
"RTN","LA7VOBX",192,0)
 ;
"RTN","LA7VOBX",193,0)
 Q LA7Y
"RTN","LA7VOBX",194,0)
 ;
"RTN","LA7VOBX",195,0)
 ;
"RTN","LA7VOBX",196,0)
OBX13(LA7VAL,LA7SRC,LA7FS,LA7ECH) ; Build OBX-13 sequence - User defined access checks
"RTN","LA7VOBX",197,0)
 ; Call with LA7VAL = access screen to expand
"RTN","LA7VOBX",198,0)
 ;           LA7SRC = source of access screen
"RTN","LA7VOBX",199,0)
 ;            LA7FS = HL field separator
"RTN","LA7VOBX",200,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBX",201,0)
 ;
"RTN","LA7VOBX",202,0)
 ; Returns     LA7Y = access screen text
"RTN","LA7VOBX",203,0)
 ;
"RTN","LA7VOBX",204,0)
 N LA7Y
"RTN","LA7VOBX",205,0)
 S LA7Y=""
"RTN","LA7VOBX",206,0)
 ;
"RTN","LA7VOBX",207,0)
 ; Expanding antibiotic susceptibility display screen
"RTN","LA7VOBX",208,0)
 I LA7SRC="MIS" D
"RTN","LA7VOBX",209,0)
 . S LA7Y=$S(LA7VAL="A":"ALWAYS DISPLAY",LA7VAL="N":"NEVER DISPLAY",LA7VAL="R":"RESTRICT DISPLAY",1:"")
"RTN","LA7VOBX",210,0)
 ;
"RTN","LA7VOBX",211,0)
 S LA7Y=$$CHKDATA^LA7VHLU3(LA7Y,LA7FS_LA7ECH)
"RTN","LA7VOBX",212,0)
 ;
"RTN","LA7VOBX",213,0)
 Q LA7Y
"RTN","LA7VOBX",214,0)
 ;
"RTN","LA7VOBX",215,0)
 ;
"RTN","LA7VOBX",216,0)
OBX14(LA7DT) ; Build OBX-14 sequence - date/time of observation
"RTN","LA7VOBX",217,0)
 ; Call with LA7DT = FileMan date/time
"RTN","LA7VOBX",218,0)
 ; Returns OBX-14 sequence
"RTN","LA7VOBX",219,0)
 ;
"RTN","LA7VOBX",220,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VOBX",221,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VOBX",222,0)
 ;
"RTN","LA7VOBX",223,0)
 ;
"RTN","LA7VOBX",224,0)
OBX15(LA74,LA7FS,LA7ECH) ; Build OBX-15 sequence - Producer's ID field
"RTN","LA7VOBX",225,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VOBX",226,0)
 ;                    if null/undefined then use Kernel Site file.
"RTN","LA7VOBX",227,0)
 ;            LA7FS = HL field separator
"RTN","LA7VOBX",228,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VOBX",229,0)
 ;
"RTN","LA7VOBX",230,0)
 ; Returns facility that performed the testing (ID^text^99VA4)
"RTN","LA7VOBX",231,0)
 ;
"RTN","LA7VOBX",232,0)
 Q $$INST^LA7VHLU4(LA74,LA7FS,LA7ECH)
"RTN","LA7VOBX",233,0)
 ;
"RTN","LA7VOBX",234,0)
 ;
"RTN","LA7VOBX",235,0)
OBX16(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build OBX-16 sequence - Responsible observer field
"RTN","LA7VOBX",236,0)
 ; Call with   LA7DUZ = DUZ of verifying user
"RTN","LA7VOBX",237,0)
 ;             LA7DIV = Institution of user
"RTN","LA7VOBX",238,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBX",239,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBX",240,0)
 ;           
"RTN","LA7VOBX",241,0)
 ; Returns OBX-16 sequence
"RTN","LA7VOBX",242,0)
 ;
"RTN","LA7VOBX",243,0)
 Q $$XCN^LA7VHLU4(LA7DUZ,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX",244,0)
 ;
"RTN","LA7VOBX",245,0)
 ;
"RTN","LA7VOBX",246,0)
OBX17(LA7VAL,LA7FS,LA7ECH) ; Build OBX-17 sequence - Observation method field
"RTN","LA7VOBX",247,0)
 ; Call with   LA7VAL = WKLD SUFFIX CODES #64.2 with leading decimal
"RTN","LA7VOBX",248,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBX",249,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBX",250,0)
 ;           
"RTN","LA7VOBX",251,0)
 ; Returns       LA7Y = OBX-17 sequence
"RTN","LA7VOBX",252,0)
 ;
"RTN","LA7VOBX",253,0)
 N LA7X,LA7Y
"RTN","LA7VOBX",254,0)
 ;
"RTN","LA7VOBX",255,0)
 ; method suffix code maybe stored without leading decimal,
"RTN","LA7VOBX",256,0)
 ;  add "." back for lookup, also add trailing space for lookup in x-ref.
"RTN","LA7VOBX",257,0)
 I LA7VAL>1 S LA7VAL="."_LA7VAL
"RTN","LA7VOBX",258,0)
 S LA7X=$O(^LAB(64.2,"C",LA7VAL_" ",0)),LA7Y=""
"RTN","LA7VOBX",259,0)
 I LA7X D
"RTN","LA7VOBX",260,0)
 . S LA7X(.01)=$$GET1^DIQ(64.2,LA7X_",",.01)
"RTN","LA7VOBX",261,0)
 . S LA7X(.01)=$$CHKDATA^LA7VHLU3(LA7X(.01),LA7FS_LA7ECH)
"RTN","LA7VOBX",262,0)
 . S LA7Y=LA7VAL_$E(LA7ECH)_LA7X(.01)_$E(LA7ECH)_"99VA64_2"
"RTN","LA7VOBX",263,0)
 ;
"RTN","LA7VOBX",264,0)
 Q LA7Y
"RTN","LA7VOBX",265,0)
 ;
"RTN","LA7VOBX",266,0)
 ;
"RTN","LA7VOBX",267,0)
OBX18(LA7VAL,LA7FS,LA7ECH) ; Build OBX-18 sequence - Equipment entity identifier field
"RTN","LA7VOBX",268,0)
 ; Call with   LA7VAL = Equipment entity identifier
"RTN","LA7VOBX",269,0)
 ;              LA7FS = HL field separator
"RTN","LA7VOBX",270,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VOBX",271,0)
 ;           
"RTN","LA7VOBX",272,0)
 ; Returns       LA7X = OBX-18 sequence
"RTN","LA7VOBX",273,0)
 ;
"RTN","LA7VOBX",274,0)
 N LA7I,LA7J,LA7X,LA7Y
"RTN","LA7VOBX",275,0)
 ;
"RTN","LA7VOBX",276,0)
 S LA7X="",LA7J=$L(LA7VAL,"!")
"RTN","LA7VOBX",277,0)
 F LA7I=1:1:LA7J D
"RTN","LA7VOBX",278,0)
 . S LA7Y=$P(LA7VAL,"!",LA7I)
"RTN","LA7VOBX",279,0)
 . I LA7Y="" Q
"RTN","LA7VOBX",280,0)
 . S $P(LA7X,$E(LA7ECH,1),LA7I)=$$CHKDATA^LA7VHLU3(LA7Y,LA7FS_LA7ECH)
"RTN","LA7VOBX",281,0)
 ;
"RTN","LA7VOBX",282,0)
 Q LA7X
"RTN","LA7VOBX1")
0^15^B15767833
"RTN","LA7VOBX1",1,0)
LA7VOBX1 ;DALOI/JMC - LAB OBX Segment message builder (CH subscript) cont'd; 5/25/00
"RTN","LA7VOBX1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,61,63,64**;Sep 27, 1994
"RTN","LA7VOBX1",3,0)
 ;
"RTN","LA7VOBX1",4,0)
CH ; Observation/Result segment for "CH" subscript results.
"RTN","LA7VOBX1",5,0)
 ; Called by LA7VOBX
"RTN","LA7VOBX1",6,0)
 ;
"RTN","LA7VOBX1",7,0)
 N LA76304,LA7ALT,LA7DIV,LA7I,LA7RS,LA7X,LA7Y,X
"RTN","LA7VOBX1",8,0)
 ;
"RTN","LA7VOBX1",9,0)
 ; "CH" subscript requires a dataname
"RTN","LA7VOBX1",10,0)
 I '$G(LRSB) Q
"RTN","LA7VOBX1",11,0)
 ;
"RTN","LA7VOBX1",12,0)
 ; get result node from LR global.
"RTN","LA7VOBX1",13,0)
 S LA76304(0)=$G(^LR(LRDFN,LRSS,LRIDT,0))
"RTN","LA7VOBX1",14,0)
 S LA7RS=$P(LRSB,"^",2),LRSB=$P(LRSB,"^")
"RTN","LA7VOBX1",15,0)
 S LA7VAL=$G(^LR(LRDFN,LRSS,LRIDT,LRSB))
"RTN","LA7VOBX1",16,0)
 ; If previous results have been corrected then send corrected status
"RTN","LA7VOBX1",17,0)
 I LA7RS="",$P(LA7VAL,"^",10)=2 S LA7RS="C"
"RTN","LA7VOBX1",18,0)
 ;
"RTN","LA7VOBX1",19,0)
 ; Check if test is OK to send - (O)utput or (B)oth
"RTN","LA7VOBX1",20,0)
 S LA7X=$P(LA7VAL,"^",12)
"RTN","LA7VOBX1",21,0)
 I LA7X]"","BO"'[LA7X Q
"RTN","LA7VOBX1",22,0)
 I LA7X="",'$$OKTOSND^LA7VHLU1(LRSS,LRSB,+$P($P(LA7VAL,"^",3),"!",7)) Q
"RTN","LA7VOBX1",23,0)
 ;
"RTN","LA7VOBX1",24,0)
 ; If no result NLT or LOINC try to determine from file #60
"RTN","LA7VOBX1",25,0)
 S LA7X=$P(LA7VAL,"^",3)
"RTN","LA7VOBX1",26,0)
 I $P(LA7X,"!",2)=""!($P(LA7X,"!",3)="") S $P(LA7VAL,"^",3)=$$DEFCODE^LA7VHLU5(LRSS,LRSB,LA7X,$P(LA76304(0),"^",5))
"RTN","LA7VOBX1",27,0)
 ; No result NLT code - log error
"RTN","LA7VOBX1",28,0)
 I $P($P(LA7VAL,"^",3),"!",2)="" D
"RTN","LA7VOBX1",29,0)
 . N LA7X
"RTN","LA7VOBX1",30,0)
 . S LA7X="["_LRSB_"]"_$$GET1^DID(63.04,LRSB,"","LABEL")
"RTN","LA7VOBX1",31,0)
 . D CREATE^LA7LOG(36)
"RTN","LA7VOBX1",32,0)
 ;
"RTN","LA7VOBX1",33,0)
 ; something missing - No NLT code, etc.
"RTN","LA7VOBX1",34,0)
 I LA7VAL="" Q
"RTN","LA7VOBX1",35,0)
 ;
"RTN","LA7VOBX1",36,0)
 ; Check for missing units/reference ranges
"RTN","LA7VOBX1",37,0)
 S LA7X=$P(LA7VAL,"^",5)
"RTN","LA7VOBX1",38,0)
 ;
"RTN","LA7VOBX1",39,0)
 ; Results missing units, lookup in file #60
"RTN","LA7VOBX1",40,0)
 I $P(LA7X,"!",7)="" S $P(LA7X,"!",7)=$P($$REFUNIT^LA7VHLU1(LRSB,$P(LA76304(0),"^",5)),"^",3)
"RTN","LA7VOBX1",41,0)
 ;
"RTN","LA7VOBX1",42,0)
 ; If results missing reference ranges, use values from file #60.
"RTN","LA7VOBX1",43,0)
 I $P(LA7X,"!",2)="",$P(LA7X,"!",3)="",$P(LA7X,"!",11)="",$P(LA7X,"!",12)="" D
"RTN","LA7VOBX1",44,0)
 . S LA7Y=$$REFUNIT^LA7VHLU1(LRSB,$P(LA76304(0),"^",5))
"RTN","LA7VOBX1",45,0)
 . S $P(LA7X,"!",2)=$P(LA7Y,"^")
"RTN","LA7VOBX1",46,0)
 . S $P(LA7X,"!",3)=$P(LA7Y,"^",2)
"RTN","LA7VOBX1",47,0)
 . S $P(LA7X,"!",11)=$P(LA7Y,"^",6)
"RTN","LA7VOBX1",48,0)
 . S $P(LA7X,"!",12)=$P(LA7Y,"^",7)
"RTN","LA7VOBX1",49,0)
 ; Use therapeutic low/high if low/high missing.
"RTN","LA7VOBX1",50,0)
 I $P(LA7X,"!",2)="",$P(LA7X,"!",3)="" D
"RTN","LA7VOBX1",51,0)
 . S $P(LA7X,"!",2)=$P(LA7X,"!",11)
"RTN","LA7VOBX1",52,0)
 . S $P(LA7X,"!",3)=$P(LA7X,"!",12)
"RTN","LA7VOBX1",53,0)
 ;
"RTN","LA7VOBX1",54,0)
 ; Evaluate low/high reference ranges in case M code in these fields.
"RTN","LA7VOBX1",55,0)
 S:$G(SEX)="" SEX="M" S:$G(AGE)="" AGE=99
"RTN","LA7VOBX1",56,0)
 F LA7I=2,3 I $E($P(LA7X,"!",LA7I),1,3)="$S(" D
"RTN","LA7VOBX1",57,0)
 . S @("X="_$P(LA7X,"!",LA7I))
"RTN","LA7VOBX1",58,0)
 . S $P(LA7X,"!",LA7I)=X
"RTN","LA7VOBX1",59,0)
 ;
"RTN","LA7VOBX1",60,0)
 ; Put units/reference ranges back in variable LA7VAL
"RTN","LA7VOBX1",61,0)
 S $P(LA7VAL,"^",5)=LA7X
"RTN","LA7VOBX1",62,0)
 ;
"RTN","LA7VOBX1",63,0)
 ; Initialize OBX segment
"RTN","LA7VOBX1",64,0)
 S LA7OBX(0)="OBX"
"RTN","LA7VOBX1",65,0)
 S LA7OBX(1)=$$OBX1^LA7VOBX(.LA7OBXSN)
"RTN","LA7VOBX1",66,0)
 ;
"RTN","LA7VOBX1",67,0)
 ; Value type
"RTN","LA7VOBX1",68,0)
 ; If result is "cancel" or "comment" then data type is ST - string data
"RTN","LA7VOBX1",69,0)
 S LA7X=$S("canccomment"[$P(LA7VAL,"^"):1,1:0)
"RTN","LA7VOBX1",70,0)
 I LA7X S LA7OBX(2)="ST"
"RTN","LA7VOBX1",71,0)
 E  S LA7OBX(2)=$$OBX2^LA7VOBX(63.04,LRSB)
"RTN","LA7VOBX1",72,0)
 ;
"RTN","LA7VOBX1",73,0)
 ; Observation identifer
"RTN","LA7VOBX1",74,0)
 ; build alternate code based on dataname from file #63 in case it's needed
"RTN","LA7VOBX1",75,0)
 S LA7X=$P(LA7VAL,"^",3)
"RTN","LA7VOBX1",76,0)
 S LA7ALT="CH"_LRSB_"^"_$$GET1^DID(63.04,LRSB,"","LABEL")_"^"_"99VA63"
"RTN","LA7VOBX1",77,0)
 S LA7OBX(3)=$$OBX3^LA7VOBX($P(LA7X,"!",2),$P(LA7X,"!",3),LA7ALT,LA7FS,LA7ECH)
"RTN","LA7VOBX1",78,0)
 ;
"RTN","LA7VOBX1",79,0)
 ; Test value
"RTN","LA7VOBX1",80,0)
 ; If DoD and "canc" then report "PL Cancelled" per Lab Interop ICD.
"RTN","LA7VOBX1",81,0)
 I $P(LA7VAL,"^")="pending" S LA7OBX(5)=""
"RTN","LA7VOBX1",82,0)
 E  D
"RTN","LA7VOBX1",83,0)
 . S LA7X=$P(LA7VAL,"^")
"RTN","LA7VOBX1",84,0)
 . I LA7X'="canc",$$GET1^DID(63.04,LRSB,"","TYPE","","LA7ERR")="SET" D
"RTN","LA7VOBX1",85,0)
 . . S LA7X=$$EXTERNAL^DILFD(63.04,LRSB,"",LA7X)
"RTN","LA7VOBX1",86,0)
 . . I LA7X="" S LA7X=$P(LA7VAL,"^")
"RTN","LA7VOBX1",87,0)
 . I $G(LA7NVAF)=1,LA7X="canc" S LA7X="PL Cancelled"
"RTN","LA7VOBX1",88,0)
 . S LA7OBX(5)=$$OBX5^LA7VOBX(LA7X,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX1",89,0)
 ;
"RTN","LA7VOBX1",90,0)
 ; Units
"RTN","LA7VOBX1",91,0)
 S LA7X=$P(LA7VAL,"^",5)
"RTN","LA7VOBX1",92,0)
 S LA7OBX(6)=$$OBX6^LA7VOBX($P(LA7X,"!",7),"",LA7FS,LA7ECH)
"RTN","LA7VOBX1",93,0)
 ;
"RTN","LA7VOBX1",94,0)
 ; Reference range
"RTN","LA7VOBX1",95,0)
 S LA7OBX(7)=$$OBX7^LA7VOBX($P(LA7X,"!",2),$P(LA7X,"!",3),LA7FS,LA7ECH)
"RTN","LA7VOBX1",96,0)
 ;
"RTN","LA7VOBX1",97,0)
 ; Abnormal flags
"RTN","LA7VOBX1",98,0)
 S LA7OBX(8)=$$OBX8^LA7VOBX($P(LA7VAL,"^",2))
"RTN","LA7VOBX1",99,0)
 ;
"RTN","LA7VOBX1",100,0)
 ; "P"artial or "F"inal results
"RTN","LA7VOBX1",101,0)
 S LA7X=$S("canccommentpending"[$P(LA7VAL,"^"):$P(LA7VAL,"^"),1:"F")
"RTN","LA7VOBX1",102,0)
 I LA7RS="C" S LA7X=LA7RS
"RTN","LA7VOBX1",103,0)
 S LA7OBX(11)=$$OBX11^LA7VOBX(LA7X)
"RTN","LA7VOBX1",104,0)
 ;
"RTN","LA7VOBX1",105,0)
 ; Observation date/time - collection date/time per HL7 standard
"RTN","LA7VOBX1",106,0)
 I $P(LA76304(0),"^") S LA7OBX(14)=$$OBX14^LA7VOBX($P(LA76304(0),"^"))
"RTN","LA7VOBX1",107,0)
 ;
"RTN","LA7VOBX1",108,0)
 S LA7DIV=$P(LA7VAL,"^",9)
"RTN","LA7VOBX1",109,0)
 I LA7DIV="",$$DIV4^XUSER(.LA7DIV,$P(LA7VAL,"^",4)) S LA7DIV=$O(LA7DIV(0))
"RTN","LA7VOBX1",110,0)
 ;
"RTN","LA7VOBX1",111,0)
 ; Facility that performed the testing
"RTN","LA7VOBX1",112,0)
 S LA7OBX(15)=$$OBX15^LA7VOBX(LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX1",113,0)
 ;
"RTN","LA7VOBX1",114,0)
 ; Person that verified the test
"RTN","LA7VOBX1",115,0)
 S LA7OBX(16)=$$OBX16^LA7VOBX($P(LA7VAL,"^",4),LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX1",116,0)
 ;
"RTN","LA7VOBX1",117,0)
 ; Observation method
"RTN","LA7VOBX1",118,0)
 S LA7X=$P($P(LA7VAL,"^",3),"!",4)
"RTN","LA7VOBX1",119,0)
 I LA7X S LA7OBX(17)=$$OBX17^LA7VOBX(LA7X,LA7FS,LA7ECH)
"RTN","LA7VOBX1",120,0)
 ;
"RTN","LA7VOBX1",121,0)
 ; Equipment entity identifier
"RTN","LA7VOBX1",122,0)
 I $L($P(LA7VAL,"^",11)) S LA7OBX(18)=$$OBX18^LA7VOBX($P(LA7VAL,"^",11),LA7FS,LA7ECH)
"RTN","LA7VOBX1",123,0)
 ;
"RTN","LA7VOBX1",124,0)
 D BUILDSEG^LA7VHLU(.LA7OBX,.LA7ARRAY,LA7FS)
"RTN","LA7VOBX1",125,0)
 ;
"RTN","LA7VOBX1",126,0)
 Q
"RTN","LA7VOBX2")
0^16^B15453740
"RTN","LA7VOBX2",1,0)
LA7VOBX2 ;DALOI/JMC - LAB OBX Segment message builder (AP subscripts) cont'd ; 05/26/00
"RTN","LA7VOBX2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VOBX2",3,0)
 ;
"RTN","LA7VOBX2",4,0)
AP ; Build OBX segments for resultss that are anatomic/surgical pathology subscripts
"RTN","LA7VOBX2",5,0)
 ; Called by LA7VOBX
"RTN","LA7VOBX2",6,0)
 ;
"RTN","LA7VOBX2",7,0)
 N LA7953,LA7ACODE,LA7CODE,LA7DIV,LA7IENS,LA7OBX5,LA7OBX5M,LA7SUB,LA7SUBFL,LA7VP,LA7WP,LA7X,LA7Y
"RTN","LA7VOBX2",8,0)
 ;
"RTN","LA7VOBX2",9,0)
 S (LA7953,LA7DIV,LA7VP)=""
"RTN","LA7VOBX2",10,0)
 ;
"RTN","LA7VOBX2",11,0)
 ; Surgical pathology subscript
"RTN","LA7VOBX2",12,0)
 I LRSS="SP" S LA7SUBFL=63.08
"RTN","LA7VOBX2",13,0)
 ;
"RTN","LA7VOBX2",14,0)
 ; Cytology subscript
"RTN","LA7VOBX2",15,0)
 I LRSS="CY" S LA7SUBFL=63.09
"RTN","LA7VOBX2",16,0)
 ;
"RTN","LA7VOBX2",17,0)
 ; Electron microscopy subscript
"RTN","LA7VOBX2",18,0)
 I LRSS="EM" S LA7SUBFL=63.02
"RTN","LA7VOBX2",19,0)
 ;
"RTN","LA7VOBX2",20,0)
 S LA7IENS=""
"RTN","LA7VOBX2",21,0)
 F I=3:-1:1 I $P(LRIDT,",",I) S LRIDT(I)=$P(LRIDT,",",I),LA7IENS=LA7IENS_LRIDT(I)_","
"RTN","LA7VOBX2",22,0)
 S LA7IENS=LA7IENS_LRDFN_","
"RTN","LA7VOBX2",23,0)
 S LRIDT=$P(LRIDT,",")
"RTN","LA7VOBX2",24,0)
 S LA7SUB(0)=$G(^LR(LRDFN,LRSS,LRIDT,0))
"RTN","LA7VOBX2",25,0)
 ;
"RTN","LA7VOBX2",26,0)
 ; Get default codes
"RTN","LA7VOBX2",27,0)
 S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,"","")
"RTN","LA7VOBX2",28,0)
 ;
"RTN","LA7VOBX2",29,0)
 ; Initialize OBX segment
"RTN","LA7VOBX2",30,0)
 S LA7OBX(0)="OBX"
"RTN","LA7VOBX2",31,0)
 ;
"RTN","LA7VOBX2",32,0)
 ; Value type
"RTN","LA7VOBX2",33,0)
 S LA7X=LA7SUBFL,LA7Y=LRSB
"RTN","LA7VOBX2",34,0)
 I LRSS="SP" D
"RTN","LA7VOBX2",35,0)
 . I LRSB=1.2 S LA7X=63.817,LA7Y=1
"RTN","LA7VOBX2",36,0)
 . I LRSB="10,1.5" S LA7X=63.82,LA7Y=.01
"RTN","LA7VOBX2",37,0)
 . I LRSB="10,2" S LA7X=63.12,LA7Y=2
"RTN","LA7VOBX2",38,0)
 . I LRSB="10,5" S LA7X=63.819,LA7Y=1
"RTN","LA7VOBX2",39,0)
 S LA7OBX(2)=$$OBX2^LA7VOBX(LA7X,LA7Y)
"RTN","LA7VOBX2",40,0)
 ;
"RTN","LA7VOBX2",41,0)
 ; Observation identifier
"RTN","LA7VOBX2",42,0)
 S LA7OBX(3)=$$OBX3^LA7VOBX($P(LA7CODE,"!",2),$P(LA7CODE,"!",3),"",LA7FS,LA7ECH)
"RTN","LA7VOBX2",43,0)
 ;
"RTN","LA7VOBX2",44,0)
 ; Observation sub-ID
"RTN","LA7VOBX2",45,0)
 ; Create sub-ID for supplementary reports and special studies
"RTN","LA7VOBX2",46,0)
 I LRSS="SP" D SUBID
"RTN","LA7VOBX2",47,0)
 ;
"RTN","LA7VOBX2",48,0)
 ; Build result field
"RTN","LA7VOBX2",49,0)
 I LRSB=.012 D
"RTN","LA7VOBX2",50,0)
 . N LA7I,LA7X,LA7Y
"RTN","LA7VOBX2",51,0)
 . S LA7I=0
"RTN","LA7VOBX2",52,0)
 . F  S LA7I=$O(^LR(LRDFN,LRSS,LRIDT,.1,LA7I)) Q:'LA7I  D
"RTN","LA7VOBX2",53,0)
 . . S LA7X=$G(^LR(LRDFN,LRSS,LRIDT,.1,LA7I,0))
"RTN","LA7VOBX2",54,0)
 . . S LA7Y(LA7I)=$P(LA7X,"^")
"RTN","LA7VOBX2",55,0)
 . S LA7OBX(5)=$$OBX5R^LA7VOBX(.LA7Y,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX2",56,0)
 ;
"RTN","LA7VOBX2",57,0)
 I LRSB'=.012 D
"RTN","LA7VOBX2",58,0)
 . I LRSS="SP",$P(LRSB,",")=10,LRSB'="10,5" Q
"RTN","LA7VOBX2",59,0)
 . I LA7NVAF=1 D DOD Q
"RTN","LA7VOBX2",60,0)
 . I LRSS="SP",LRSB=1.2 N LRSB S LA7SUBFL=63.817,LRSB=1
"RTN","LA7VOBX2",61,0)
 . I LRSS="SP",LRSB="10,5" N LRSB S LA7SUBFL=63.819,LRSB=1
"RTN","LA7VOBX2",62,0)
 . D OBX5M^LA7VOBX(LA7SUBFL,LA7IENS,LRSB,.LA7WP,LA7FS,LA7ECH)
"RTN","LA7VOBX2",63,0)
 . D BUILDSEG^LA7VHLU(.LA7WP,.LA7OBX5M,"")
"RTN","LA7VOBX2",64,0)
 . M LA7OBX(5)=LA7OBX5M
"RTN","LA7VOBX2",65,0)
 ;
"RTN","LA7VOBX2",66,0)
 I LRSS="SP",$P(LRSB,",")=10 D
"RTN","LA7VOBX2",67,0)
 . N LA7VAL,X
"RTN","LA7VOBX2",68,0)
 . I LRSB=10 D
"RTN","LA7VOBX2",69,0)
 . . S LA7VAL=$$GET1^DIQ(63.12,LA7IENS,.01)
"RTN","LA7VOBX2",70,0)
 . . S X=$$GET1^DIQ(63.12,LA7IENS,".01:2")
"RTN","LA7VOBX2",71,0)
 . . I $L(X) S LA7VAL=$S($E(X,1,2)="T-":"",1:"T-")_X_"^"_LA7VAL_"^SNM"
"RTN","LA7VOBX2",72,0)
 . . S LA7OBX(5)=$$OBX5^LA7VOBX(LA7VAL,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX2",73,0)
 . I LRSB="10,2" D
"RTN","LA7VOBX2",74,0)
 . . S LA7VAL=$$GET1^DIQ(63.12,LA7IENS,2)
"RTN","LA7VOBX2",75,0)
 . . S LA7OBX(5)=$$OBX5^LA7VOBX(LA7VAL,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX2",76,0)
 . . S LA7OBX(6)=$$OBX6^LA7VOBX("g","",LA7FS,LA7ECH)
"RTN","LA7VOBX2",77,0)
 ;
"RTN","LA7VOBX2",78,0)
 ; Don't build this segment if no results/value to send
"RTN","LA7VOBX2",79,0)
 I $G(LA7OBX(5,0))="",$G(LA7OBX(5))="" Q
"RTN","LA7VOBX2",80,0)
 ;
"RTN","LA7VOBX2",81,0)
 ; Build sequence id
"RTN","LA7VOBX2",82,0)
 S LA7OBX(1)=$$OBX1^LA7VOBX(.LA7OBXSN)
"RTN","LA7VOBX2",83,0)
 ;
"RTN","LA7VOBX2",84,0)
 ; "P"artial, "F"inal , "A"mended results
"RTN","LA7VOBX2",85,0)
 ; If not release date then pending
"RTN","LA7VOBX2",86,0)
 I '$P(LA7SUB(0),"^",11) S LA7OBX(11)="P"
"RTN","LA7VOBX2",87,0)
 ;
"RTN","LA7VOBX2",88,0)
 ; If release date then check for changes
"RTN","LA7VOBX2",89,0)
 I $P(LA7SUB(0),"^",11) D
"RTN","LA7VOBX2",90,0)
 . I $P(LA7SUB(0),"^",15) S LA7OBX(11)="C"
"RTN","LA7VOBX2",91,0)
 . E  S LA7OBX(11)="F"
"RTN","LA7VOBX2",92,0)
 ;
"RTN","LA7VOBX2",93,0)
 I $P(LA7SUB(0),"^",13),$$DIV4^XUSER(.LA7DIV,$P(LA7SUB(0),"^",2)) S LA7DIV=$O(LA7DIV(0))
"RTN","LA7VOBX2",94,0)
 ;
"RTN","LA7VOBX2",95,0)
 ; Facility that performed the testing
"RTN","LA7VOBX2",96,0)
 S LA7OBX(15)=$$OBX15^LA7VOBX(LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX2",97,0)
 ;
"RTN","LA7VOBX2",98,0)
 ; Person that verified the test
"RTN","LA7VOBX2",99,0)
 S LA7VP=$P(LA7SUB(0),"^",13)
"RTN","LA7VOBX2",100,0)
 I LA7VP S LA7OBX(16)=$$OBX16^LA7VOBX(LA7VP,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX2",101,0)
 ;
"RTN","LA7VOBX2",102,0)
 D BUILDSEG^LA7VHLU(.LA7OBX,.LA7ARRAY,LA7FS)
"RTN","LA7VOBX2",103,0)
 ;
"RTN","LA7VOBX2",104,0)
 Q
"RTN","LA7VOBX2",105,0)
 ;
"RTN","LA7VOBX2",106,0)
 ;
"RTN","LA7VOBX2",107,0)
SUBID ; Build sub-id for "SP" subscript
"RTN","LA7VOBX2",108,0)
 ; Used to identify supplementary reports, specimens and related special
"RTN","LA7VOBX2",109,0)
 ; studies performed on thoese specimens.
"RTN","LA7VOBX2",110,0)
 ;
"RTN","LA7VOBX2",111,0)
 N LA7SUBID
"RTN","LA7VOBX2",112,0)
 ;
"RTN","LA7VOBX2",113,0)
 S LA7SUBID=""
"RTN","LA7VOBX2",114,0)
 ;
"RTN","LA7VOBX2",115,0)
 ; Sub-id's for supplementary reports
"RTN","LA7VOBX2",116,0)
 I LRSB=1.2 S LA7SUBID="1."_$P(LA7IENS,",")
"RTN","LA7VOBX2",117,0)
 ;
"RTN","LA7VOBX2",118,0)
 ; Sub-id's for specimens and special studies
"RTN","LA7VOBX2",119,0)
 I LRSB=10!(LRSB="10,2") S LA7SUBID="10."_$P(LA7IENS,",")
"RTN","LA7VOBX2",120,0)
 I LRSB="10,1.5"!(LRSB="10,5") S LA7SUBID="10."_$P(LA7IENS,",",2)_"."_$P(LA7IENS,",")
"RTN","LA7VOBX2",121,0)
 ;
"RTN","LA7VOBX2",122,0)
 I $L(LA7SUBID) S LA7OBX(4)=$$OBX4^LA7VOBX(LA7SUBID,LA7FS,LA7ECH)
"RTN","LA7VOBX2",123,0)
 ;
"RTN","LA7VOBX2",124,0)
 Q
"RTN","LA7VOBX2",125,0)
 ;
"RTN","LA7VOBX2",126,0)
 ;
"RTN","LA7VOBX2",127,0)
DOD ; Build OBX segment's to special DoD specifications.
"RTN","LA7VOBX2",128,0)
 ; Send word-processing fields as series of OBX's for DoD.
"RTN","LA7VOBX2",129,0)
 ; DoD cannot handle formatted text (FT) data type.
"RTN","LA7VOBX2",130,0)
 ;
"RTN","LA7VOBX2",131,0)
 S LA7OBX(2)="ST"
"RTN","LA7VOBX2",132,0)
 S LA7VAL=$G(^LR(LRDFN,LRSS,$P(LA7IDT,","),LA7SB,$P(LA7IDT,",",2),0))
"RTN","LA7VOBX2",133,0)
 I LA7VAL="" S LA7VAL=" "
"RTN","LA7VOBX2",134,0)
 S LA7OBX(5)=$$OBX5^LA7VOBX(LA7VAL,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX2",135,0)
 Q
"RTN","LA7VOBX3")
0^17^B33632644
"RTN","LA7VOBX3",1,0)
LA7VOBX3 ;DALOI/JMC - LAB OBX Segment message builder (MI subscripts) cont'd ; 5/26/00
"RTN","LA7VOBX3",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VOBX3",3,0)
 ;
"RTN","LA7VOBX3",4,0)
MI ; Build OBX segments for results that are microbiology subscript.
"RTN","LA7VOBX3",5,0)
 ; Called by LA7VOBX
"RTN","LA7VOBX3",6,0)
 ;
"RTN","LA7VOBX3",7,0)
 N I,LA761,LA76305,LA7ALT,LA7ALTCS,LA7CODE,LA7DIV,LA7IENS,LA7LOINC,LA7NLT,LA7OBX,LA7ORS,LA7PARNT,LA7SAVID,LA7SUBFL,LA7VAL,LA7VERP
"RTN","LA7VOBX3",8,0)
 ;
"RTN","LA7VOBX3",9,0)
 I $P(LRIDT,",",2) S LRIDT(2)=$P(LRIDT,",",2),LRIDT(3)=$P(LRIDT,",",3),LRIDT=$P(LRIDT,",")
"RTN","LA7VOBX3",10,0)
 ;
"RTN","LA7VOBX3",11,0)
 I '$D(^LR(LRDFN,LRSS,LRIDT)) Q
"RTN","LA7VOBX3",12,0)
 ;
"RTN","LA7VOBX3",13,0)
 F I=0,1,5,8,11,16 S LA76305(I)=$G(^LR(LRDFN,LRSS,LRIDT,I))
"RTN","LA7VOBX3",14,0)
 ;
"RTN","LA7VOBX3",15,0)
 S (LA7ALT,LA7ALTCS,LA7CODE,LA7ID,LA7LOINC,LA7NLT,LA7ORS,LA7SAVID,LA7SUBFL,LA7VAL,LA7VERP)=""
"RTN","LA7VOBX3",16,0)
 ;
"RTN","LA7VOBX3",17,0)
 ; Specimen topography
"RTN","LA7VOBX3",18,0)
 S LA761=$P(LA76305(0),"^",5)
"RTN","LA7VOBX3",19,0)
 ; Default codes
"RTN","LA7VOBX3",20,0)
 S LA7CODE=$$DEFCODE^LA7VHLU5(LRSS,LRSB,LA7CODE,LA761)
"RTN","LA7VOBX3",21,0)
 ;
"RTN","LA7VOBX3",22,0)
 ; Gram stain
"RTN","LA7VOBX3",23,0)
 I LRSB=11.6 D
"RTN","LA7VOBX3",24,0)
 . N LA7ERR
"RTN","LA7VOBX3",25,0)
 . S LA7VERP=$P(LA76305(1),"^",3)
"RTN","LA7VOBX3",26,0)
 . S LA7ORS=$P(LA76305(1),"^",2)
"RTN","LA7VOBX3",27,0)
 . S LA7OBX(2)=$$OBX2^LA7VOBX(63.05,11.6)
"RTN","LA7VOBX3",28,0)
 . S LA7IENS=LRIDT(2)_","_LRIDT_","_LRDFN_","
"RTN","LA7VOBX3",29,0)
 . S LA7VAL=$$GET1^DIQ(63.29,LA7IENS,.01,"","LA7ERR")
"RTN","LA7VOBX3",30,0)
 . ; Setup DoD special coding system
"RTN","LA7VOBX3",31,0)
 . I LA7NVAF=1,$P(LA7CODE,"!",2) S LA7ALTCS="99VA64MG"
"RTN","LA7VOBX3",32,0)
 ;
"RTN","LA7VOBX3",33,0)
 ; Micro organism
"RTN","LA7VOBX3",34,0)
 I $P(LRSB,",")=12 D
"RTN","LA7VOBX3",35,0)
 . S LA7VERP=$P(LA76305(1),"^",3)
"RTN","LA7VOBX3",36,0)
 . S LA7ORS=$P(LA76305(1),"^",2)
"RTN","LA7VOBX3",37,0)
 . S LA7SUBFL=63.3
"RTN","LA7VOBX3",38,0)
 . ; Working on colony count
"RTN","LA7VOBX3",39,0)
 . I $P(LRSB,",",2)=1 D CC Q
"RTN","LA7VOBX3",40,0)
 . ; Working on organism
"RTN","LA7VOBX3",41,0)
 . I $G(LRIDT(3))="" D ORG Q
"RTN","LA7VOBX3",42,0)
 . ; Working on susceptibilities
"RTN","LA7VOBX3",43,0)
 . I $P(LA76305(1),"^",4) S LA7VERP=$P(LA76305(1),"^",4)
"RTN","LA7VOBX3",44,0)
 . D MIC
"RTN","LA7VOBX3",45,0)
 ;
"RTN","LA7VOBX3",46,0)
 ; Parasite organism
"RTN","LA7VOBX3",47,0)
 I $P(LRSB,",")=16 D
"RTN","LA7VOBX3",48,0)
 . S LA7ORS=$P(LA76305(5),"^",2)
"RTN","LA7VOBX3",49,0)
 . S LA7VERP=$P(LA76305(5),"^",3)
"RTN","LA7VOBX3",50,0)
 . ; Working on organism
"RTN","LA7VOBX3",51,0)
 . S LA7SUBFL=63.34 D ORG
"RTN","LA7VOBX3",52,0)
 ;
"RTN","LA7VOBX3",53,0)
 ; Mycology organism
"RTN","LA7VOBX3",54,0)
 I $P(LRSB,",")=20 D
"RTN","LA7VOBX3",55,0)
 . S LA7ORS=$P(LA76305(8),"^",2)
"RTN","LA7VOBX3",56,0)
 . S LA7VERP=$P(LA76305(8),"^",3)
"RTN","LA7VOBX3",57,0)
 . S LA7SUBFL=63.37
"RTN","LA7VOBX3",58,0)
 . ; Working on colony count
"RTN","LA7VOBX3",59,0)
 . I $P(LRSB,",",2)=1 D CC Q
"RTN","LA7VOBX3",60,0)
 . ; Working on organism
"RTN","LA7VOBX3",61,0)
 . D ORG
"RTN","LA7VOBX3",62,0)
 ;
"RTN","LA7VOBX3",63,0)
 ; Acid Fast stain
"RTN","LA7VOBX3",64,0)
 I LRSB=24 D
"RTN","LA7VOBX3",65,0)
 . N LA7ERR
"RTN","LA7VOBX3",66,0)
 . S LA7VERP=$P(LA76305(11),"^",3)
"RTN","LA7VOBX3",67,0)
 . S LA7ORS=$P(LA76305(11),"^",2)
"RTN","LA7VOBX3",68,0)
 . S LA7OBX(2)=$$OBX2^LA7VOBX(63.05,24)
"RTN","LA7VOBX3",69,0)
 . S LA7IENS=LRIDT_","_LRDFN_","
"RTN","LA7VOBX3",70,0)
 . S LA7VAL=$$GET1^DIQ(63.05,LA7IENS,24,"","LA7ERR")
"RTN","LA7VOBX3",71,0)
 ;
"RTN","LA7VOBX3",72,0)
 ; Acid Fast stain quantity
"RTN","LA7VOBX3",73,0)
 I LRSB=25 D
"RTN","LA7VOBX3",74,0)
 . N LA7ERR
"RTN","LA7VOBX3",75,0)
 . S LA7VERP=$P(LA76305(11),"^",3)
"RTN","LA7VOBX3",76,0)
 . S LA7ORS=$P(LA76305(11),"^",2)
"RTN","LA7VOBX3",77,0)
 . S LA7OBX(2)=$$OBX2^LA7VOBX(63.05,25)
"RTN","LA7VOBX3",78,0)
 . S LA7IENS=LRIDT_","_LRDFN_","
"RTN","LA7VOBX3",79,0)
 . S LA7VAL=$$GET1^DIQ(63.05,LA7IENS,25,"","LA7ERR")
"RTN","LA7VOBX3",80,0)
 ;
"RTN","LA7VOBX3",81,0)
 ; TB organism
"RTN","LA7VOBX3",82,0)
 I $P(LRSB,",")=26 D
"RTN","LA7VOBX3",83,0)
 . S LA7ORS=$P(LA76305(11),"^",2)
"RTN","LA7VOBX3",84,0)
 . S LA7VERP=$P(LA76305(11),"^",5)
"RTN","LA7VOBX3",85,0)
 . S LA7SUBFL=63.39
"RTN","LA7VOBX3",86,0)
 . ; Working on organism
"RTN","LA7VOBX3",87,0)
 . I $G(LRIDT(3))="" D ORG Q
"RTN","LA7VOBX3",88,0)
 . ; Working on susceptibilities
"RTN","LA7VOBX3",89,0)
 . D MIC
"RTN","LA7VOBX3",90,0)
 ;
"RTN","LA7VOBX3",91,0)
 ; Virology virus
"RTN","LA7VOBX3",92,0)
 I $P(LRSB,",")=36 D
"RTN","LA7VOBX3",93,0)
 . S LA7ORS=$P(LA76305(16),"^",2)
"RTN","LA7VOBX3",94,0)
 . S LA7VERP=$P(LA76305(16),"^",3)
"RTN","LA7VOBX3",95,0)
 . ; Working on virus
"RTN","LA7VOBX3",96,0)
 . S LA7SUBFL=63.43
"RTN","LA7VOBX3",97,0)
 . D ORG
"RTN","LA7VOBX3",98,0)
 ;
"RTN","LA7VOBX3",99,0)
 D GEN
"RTN","LA7VOBX3",100,0)
 ;
"RTN","LA7VOBX3",101,0)
 Q
"RTN","LA7VOBX3",102,0)
 ;
"RTN","LA7VOBX3",103,0)
 ;
"RTN","LA7VOBX3",104,0)
CC ; Organism's Colony count
"RTN","LA7VOBX3",105,0)
 ; If "CFU/ml" found then move units to OBX-6 (Units).
"RTN","LA7VOBX3",106,0)
 N LA7X
"RTN","LA7VOBX3",107,0)
 ;
"RTN","LA7VOBX3",108,0)
 S LA7ID=$P(LRSB,",")_"-"_LRIDT(2)
"RTN","LA7VOBX3",109,0)
 S LA7IENS=LRIDT(2)_","_LRIDT_","_LRDFN_","
"RTN","LA7VOBX3",110,0)
 S LA7OBX(2)=$$OBX2^LA7VOBX(LA7SUBFL,1)
"RTN","LA7VOBX3",111,0)
 S LA7VAL=$$GET1^DIQ(LA7SUBFL,LA7IENS,1)
"RTN","LA7VOBX3",112,0)
 S LA7X=$$UP^XLFSTR(LA7VAL)
"RTN","LA7VOBX3",113,0)
 I LA7X["CFU/ML" D
"RTN","LA7VOBX3",114,0)
 . S LA7OBX(6)="CFU/ml"
"RTN","LA7VOBX3",115,0)
 . S LA7X("CFU/ml")="",LA7X("CFU/ML")=""
"RTN","LA7VOBX3",116,0)
 . S LA7VAL=$$REPLACE^XLFSTR(LA7VAL,.LA7X)
"RTN","LA7VOBX3",117,0)
 ;
"RTN","LA7VOBX3",118,0)
 ; Setup DoD special coding system
"RTN","LA7VOBX3",119,0)
 I LA7NVAF=1,$P(LA7CODE,"!",2) S LA7ALTCS="99VA64MC"
"RTN","LA7VOBX3",120,0)
 ;
"RTN","LA7VOBX3",121,0)
 Q
"RTN","LA7VOBX3",122,0)
 ;
"RTN","LA7VOBX3",123,0)
 ;
"RTN","LA7VOBX3",124,0)
ORG ; Organism
"RTN","LA7VOBX3",125,0)
 ;
"RTN","LA7VOBX3",126,0)
 S LA7ID=LRSB_"-"_LRIDT(2)
"RTN","LA7VOBX3",127,0)
 S LA7OBX(2)=$$OBX2^LA7VOBX(LA7SUBFL,.01)
"RTN","LA7VOBX3",128,0)
 S LA7IENS=LRIDT(2)_","_LRIDT_","_LRDFN_","
"RTN","LA7VOBX3",129,0)
 S LA7VAL=$$GET1^DIQ(LA7SUBFL,LA7IENS,.01)
"RTN","LA7VOBX3",130,0)
 ;
"RTN","LA7VOBX3",131,0)
 ; Check for Snomed coding
"RTN","LA7VOBX3",132,0)
 S X=$$GET1^DIQ(LA7SUBFL,LA7IENS,".01:2")
"RTN","LA7VOBX3",133,0)
 I X'="" S LA7VAL=X_"^"_LA7VAL_"^SNM"
"RTN","LA7VOBX3",134,0)
 ;
"RTN","LA7VOBX3",135,0)
 S LA7OBX(8)=$$OBX8^LA7VOBX("A")
"RTN","LA7VOBX3",136,0)
 ;
"RTN","LA7VOBX3",137,0)
 ; Setup DoD special coding system
"RTN","LA7VOBX3",138,0)
 I LA7NVAF=1,$P(LA7CODE,"!",2) S LA7ALTCS="99VA64MO"
"RTN","LA7VOBX3",139,0)
 ;
"RTN","LA7VOBX3",140,0)
 ; Set flag to save sub-id for parent-child relationship
"RTN","LA7VOBX3",141,0)
 S LA7SAVID=1
"RTN","LA7VOBX3",142,0)
 Q
"RTN","LA7VOBX3",143,0)
 ;
"RTN","LA7VOBX3",144,0)
 ;
"RTN","LA7VOBX3",145,0)
MIC ; Organism's susceptibilities
"RTN","LA7VOBX3",146,0)
 ;
"RTN","LA7VOBX3",147,0)
 N LA7IENS,LA7SUB
"RTN","LA7VOBX3",148,0)
 ;
"RTN","LA7VOBX3",149,0)
 ; Bact or TB organism
"RTN","LA7VOBX3",150,0)
 S LA7SUB=$S($P(LRSB,",")=12:3,1:12)
"RTN","LA7VOBX3",151,0)
 ;
"RTN","LA7VOBX3",152,0)
 ;S LA7X=$O(^LAB(62.06,"AD",LRIDT(3),0)) Q:'LA7X
"RTN","LA7VOBX3",153,0)
 S LA7OBX(2)=$$OBX2^LA7VOBX(62.06,.01)
"RTN","LA7VOBX3",154,0)
 ;
"RTN","LA7VOBX3",155,0)
 S LA7X=$G(^LR(LRDFN,"MI",LRIDT,LA7SUB,LRIDT(2),LRIDT(3)))
"RTN","LA7VOBX3",156,0)
 S LA7VAL=$P(LA7X,"^")
"RTN","LA7VOBX3",157,0)
 I LA7VAL'="" D
"RTN","LA7VOBX3",158,0)
 . I "SIR"[$E(LA7VAL) S LA7OBX(8)=$$OBX8^LA7VOBX($E(LA7VAL)) Q
"RTN","LA7VOBX3",159,0)
 . I "SIR"[$E($P(LA7X,"^",2)) S LA7OBX(8)=$$OBX8^LA7VOBX($E($P(LA7X,"^",2))) Q
"RTN","LA7VOBX3",160,0)
 ;
"RTN","LA7VOBX3",161,0)
 ; Determine access screen for this susceptibility
"RTN","LA7VOBX3",162,0)
 I $P(LA7X,"^",3)="" S $P(LA7X,"^",3)="A"
"RTN","LA7VOBX3",163,0)
 S LA7OBX(13)=$$OBX13^LA7VOBX($P(LA7X,"^",3),"MIS",LA7FS,LA7ECH)
"RTN","LA7VOBX3",164,0)
 ;
"RTN","LA7VOBX3",165,0)
 ; Setup DoD special coding system
"RTN","LA7VOBX3",166,0)
 I LA7NVAF=1,$P(LA7CODE,"!",2) S LA7ALTCS="99VA64MS"
"RTN","LA7VOBX3",167,0)
 ;
"RTN","LA7VOBX3",168,0)
 Q
"RTN","LA7VOBX3",169,0)
 ;
"RTN","LA7VOBX3",170,0)
 ;
"RTN","LA7VOBX3",171,0)
GEN ; Fields common to all MI OBX segments.
"RTN","LA7VOBX3",172,0)
 ;
"RTN","LA7VOBX3",173,0)
 ; Initialize OBX segment
"RTN","LA7VOBX3",174,0)
 S LA7OBX(0)="OBX"
"RTN","LA7VOBX3",175,0)
 S LA7OBX(1)=$$OBX1^LA7VOBX(.LA7OBXSN)
"RTN","LA7VOBX3",176,0)
 ;
"RTN","LA7VOBX3",177,0)
 S LA7OBX(3)=$$OBX3^LA7VOBX($P(LA7CODE,"!",2),$P(LA7CODE,"!",3),LA7ALT,LA7FS,LA7ECH)
"RTN","LA7VOBX3",178,0)
 ;
"RTN","LA7VOBX3",179,0)
 ; Change normal coding system for DoD special
"RTN","LA7VOBX3",180,0)
 I LA7NVAF=1,LA7ALTCS'="" D
"RTN","LA7VOBX3",181,0)
 . F I=3,6 I $P(LA7OBX(3),$E(LA7ECH,1),I)="99VA64" S $P(LA7OBX(3),$E(LA7ECH,1),I)=LA7ALTCS Q
"RTN","LA7VOBX3",182,0)
 ;
"RTN","LA7VOBX3",183,0)
 ; Test value
"RTN","LA7VOBX3",184,0)
 S LA7OBX(5)=$$OBX5^LA7VOBX(LA7VAL,LA7OBX(2),LA7FS,LA7ECH)
"RTN","LA7VOBX3",185,0)
 ;
"RTN","LA7VOBX3",186,0)
 ; Set sub-id and save for constructing parents
"RTN","LA7VOBX3",187,0)
 I LA7ID'="" D
"RTN","LA7VOBX3",188,0)
 . S LA7OBX(4)=$$OBX4^LA7VOBX(LA7ID,LA7FS,LA7ECH)
"RTN","LA7VOBX3",189,0)
 . I LA7SAVID F I=1:1:3 S LA7ID(LA7ID,I)=LA7OBX(I+2)
"RTN","LA7VOBX3",190,0)
 ;
"RTN","LA7VOBX3",191,0)
 ; Order result status - "P"artial, "F"inal , "A"mended results
"RTN","LA7VOBX3",192,0)
 ; If no status from individual components then use status from zeroth node.
"RTN","LA7VOBX3",193,0)
 ; If no release date then pending else final
"RTN","LA7VOBX3",194,0)
 ; If amended, overrides all other status
"RTN","LA7VOBX3",195,0)
 I LA7ORS="" S LA7ORS=$S('$P(LA76305(0),"^",3):"P",1:"F")
"RTN","LA7VOBX3",196,0)
 I $P(LA76305(0),"^",9) S LA7ORS="A"
"RTN","LA7VOBX3",197,0)
 S LA7OBX(11)=$$OBX11^LA7VOBX(LA7ORS)
"RTN","LA7VOBX3",198,0)
 ;
"RTN","LA7VOBX3",199,0)
 S LA7DIV=""
"RTN","LA7VOBX3",200,0)
 I $$DIV4^XUSER(.LA7DIV,$P(LA76305(0),"^",4)) S LA7DIV=$O(LA7DIV(0))
"RTN","LA7VOBX3",201,0)
 ;
"RTN","LA7VOBX3",202,0)
 ; Observation date/time - collection date/time per HL7 standard
"RTN","LA7VOBX3",203,0)
 I $P(LA76305(0),"^") S LA7OBX(14)=$$OBX14^LA7VOBX($P(LA76305(0),"^"))
"RTN","LA7VOBX3",204,0)
 ;
"RTN","LA7VOBX3",205,0)
 ; Facility that performed the testing
"RTN","LA7VOBX3",206,0)
 S LA7OBX(15)=$$OBX15^LA7VOBX(LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX3",207,0)
 ;
"RTN","LA7VOBX3",208,0)
 ; Person that verified the test
"RTN","LA7VOBX3",209,0)
 I $P(LA76305(0),"^",4) S LA7VERP=$P(LA76305(0),"^",4)
"RTN","LA7VOBX3",210,0)
 I LA7VERP S LA7OBX(16)=$$OBX16^LA7VOBX(LA7VERP,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VOBX3",211,0)
 ;
"RTN","LA7VOBX3",212,0)
 D BUILDSEG^LA7VHLU(.LA7OBX,.LA7ARRAY,LA7FS)
"RTN","LA7VOBX3",213,0)
 ;
"RTN","LA7VOBX3",214,0)
 Q
"RTN","LA7VOBXA")
0^48^B31676928
"RTN","LA7VOBXA",1,0)
LA7VOBXA ;DALOI/JMC - LAB OBX Segment message builder (cont'd) ; 5 June 2003
"RTN","LA7VOBXA",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,70,64**;Sep 27, 1994
"RTN","LA7VOBXA",3,0)
 ;
"RTN","LA7VOBXA",4,0)
 Q
"RTN","LA7VOBXA",5,0)
 ;
"RTN","LA7VOBXA",6,0)
OBX2 ; Build OBX-2 sequence - Value type
"RTN","LA7VOBXA",7,0)
 ;
"RTN","LA7VOBXA",8,0)
 ; default value - string data
"RTN","LA7VOBXA",9,0)
 S LA7VAL="ST"
"RTN","LA7VOBXA",10,0)
 S LA7TYP="",LA7FILE=$G(LA7FILE),LA7FIELD=$G(LA7FIELD)
"RTN","LA7VOBXA",11,0)
 ;
"RTN","LA7VOBXA",12,0)
 I LA7FILE,LA7FIELD S LA7TYP=$$GET1^DID(LA7FILE,LA7FIELD,"","TYPE","","LA7ERR")
"RTN","LA7VOBXA",13,0)
 ;
"RTN","LA7VOBXA",14,0)
 I LA7TYP="DATE/TIME" S LA7VAL="TS"
"RTN","LA7VOBXA",15,0)
 I LA7TYP="FREE TEXT" S LA7VAL="ST"
"RTN","LA7VOBXA",16,0)
 I LA7TYP="WORD-PROCESSING" S LA7VAL="FT"
"RTN","LA7VOBXA",17,0)
 I LA7TYP="NUMERIC" S LA7VAL="NM"
"RTN","LA7VOBXA",18,0)
 I LA7TYP="SET" S LA7VAL="ST"
"RTN","LA7VOBXA",19,0)
 I LA7TYP="POINTER" S LA7VAL="CE"
"RTN","LA7VOBXA",20,0)
 ;
"RTN","LA7VOBXA",21,0)
 Q
"RTN","LA7VOBXA",22,0)
 ;
"RTN","LA7VOBXA",23,0)
 ;
"RTN","LA7VOBXA",24,0)
OBX3 ; Build OBX-3 sequence - Observation identifier field
"RTN","LA7VOBXA",25,0)
 ;
"RTN","LA7VOBXA",26,0)
 ; Initialize variables 
"RTN","LA7VOBXA",27,0)
 S LA7J=1,LA7Y=""
"RTN","LA7VOBXA",28,0)
 ;
"RTN","LA7VOBXA",29,0)
 ; Build sequence using LOINC codes only
"RTN","LA7VOBXA",30,0)
 ; LOINC code/code name/"LN"
"RTN","LA7VOBXA",31,0)
 I LA7953'="" D
"RTN","LA7VOBXA",32,0)
 . N LA7IENS,LA7Z
"RTN","LA7VOBXA",33,0)
 . S LA7953=$P(LA7953,"-"),LA7IENS=LA7953_","
"RTN","LA7VOBXA",34,0)
 . D GETS^DIQ(95.3,LA7IENS,".01;80","E","LA7X")
"RTN","LA7VOBXA",35,0)
 . ; Invalid code???
"RTN","LA7VOBXA",36,0)
 . I $G(LA7X(95.3,LA7IENS,.01,"E"))="" Q
"RTN","LA7VOBXA",37,0)
 . S LA7Z=LA7X(95.3,LA7IENS,.01,"E")
"RTN","LA7VOBXA",38,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",39,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J)=LA7Z
"RTN","LA7VOBXA",40,0)
 . S LA7Z=$G(LA7X(95.3,LA7IENS,80,"E")),LA7Z=$TR(LA7Z,"~","^")
"RTN","LA7VOBXA",41,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",42,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+1)=LA7Z
"RTN","LA7VOBXA",43,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+2)="LN"
"RTN","LA7VOBXA",44,0)
 . S LA7J=4
"RTN","LA7VOBXA",45,0)
 ;
"RTN","LA7VOBXA",46,0)
 ; Build sequence using NLT codes
"RTN","LA7VOBXA",47,0)
 ; File #64 NLT code/NLT code name/"99VA64"
"RTN","LA7VOBXA",48,0)
 ; If LOINC is primary make NLT alternate, otherwise NLT primary.
"RTN","LA7VOBXA",49,0)
 I LA7NLT'="" D
"RTN","LA7VOBXA",50,0)
 . N LA7642,LA7Z
"RTN","LA7VOBXA",51,0)
 . S LA764=$O(^LAM("E",LA7NLT,0)),LA7Z=""
"RTN","LA7VOBXA",52,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J)=LA7NLT
"RTN","LA7VOBXA",53,0)
 . I LA764 S LA7Z=$$GET1^DIQ(64,LA764_",",.01,"I")
"RTN","LA7VOBXA",54,0)
 . I LA7Z="" D
"RTN","LA7VOBXA",55,0)
 . . S LA764=$O(^LAM("E",$P(LA7NLT,".")_".0000",0))
"RTN","LA7VOBXA",56,0)
 . . I LA764 S LA7Z=$$GET1^DIQ(64,LA764_",",.01,"I")
"RTN","LA7VOBXA",57,0)
 . . S LA7642=$O(^LAB(64.2,"C","."_$P(LA7NLT,".",2),0))
"RTN","LA7VOBXA",58,0)
 . . I LA764,LA7642 S LA7Z=LA7Z_"~"_$$GET1^DIQ(64.2,LA7642_",",.01,"I")
"RTN","LA7VOBXA",59,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",60,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+1)=LA7Z
"RTN","LA7VOBXA",61,0)
 . S $P(LA7Y,$E(LA7ECH,1),LA7J+2)="99VA64"
"RTN","LA7VOBXA",62,0)
 . S LA7J=LA7J+3
"RTN","LA7VOBXA",63,0)
 ;
"RTN","LA7VOBXA",64,0)
 ; Non-standard/non-VA code
"RTN","LA7VOBXA",65,0)
 ; Don't use alternate code when it's "99VA63" and we've already encoded
"RTN","LA7VOBXA",66,0)
 ; a primary and alternate. If alternate is a non-VA code then use as
"RTN","LA7VOBXA",67,0)
 ; alternate code.
"RTN","LA7VOBXA",68,0)
 ; If primary and alternate are not 99VA63 then code 3rd triplet with
"RTN","LA7VOBXA",69,0)
 ; 99VA63 per Julius Chou for Clinical Case Registry (JMC/May 13, 2004)
"RTN","LA7VOBXA",70,0)
 I LA7ALT="" Q
"RTN","LA7VOBXA",71,0)
 I $P(LA7ALT,"^",3)'="99VA63",LA7J>4 S LA7J=4
"RTN","LA7VOBXA",72,0)
 I $P(LA7ALT,"^",3)="99VA63" D  Q:LA7J=0
"RTN","LA7VOBXA",73,0)
 . I $P(LA7Y,$E(LA7ECH,1),3)="99VA63" S LA7J=0 Q
"RTN","LA7VOBXA",74,0)
 . I LA7J>4,$P(LA7Y,$E(LA7ECH,1),6)="99VA63" S LA7J=0 Q
"RTN","LA7VOBXA",75,0)
 . I LA7J>4 S LA7J=7
"RTN","LA7VOBXA",76,0)
 S $P(LA7Y,$E(LA7ECH,1),LA7J)=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^"),LA7FS_LA7ECH)
"RTN","LA7VOBXA",77,0)
 S $P(LA7Y,$E(LA7ECH,1),LA7J+1)=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",2),LA7FS_LA7ECH)
"RTN","LA7VOBXA",78,0)
 S $P(LA7Y,$E(LA7ECH,1),LA7J+2)=$$CHKDATA^LA7VHLU3($P(LA7ALT,"^",3),LA7FS_LA7ECH)
"RTN","LA7VOBXA",79,0)
 ;
"RTN","LA7VOBXA",80,0)
 Q
"RTN","LA7VOBXA",81,0)
 ;
"RTN","LA7VOBXA",82,0)
 ;
"RTN","LA7VOBXA",83,0)
OBX5 ; Build OBX-5 sequence - Observation value
"RTN","LA7VOBXA",84,0)
 ; Removes trailing spaces on string and text results.
"RTN","LA7VOBXA",85,0)
 ; Removes leading & trailing spaces on numeric results.
"RTN","LA7VOBXA",86,0)
 ;
"RTN","LA7VOBXA",87,0)
 S LA7Y=""
"RTN","LA7VOBXA",88,0)
 ;
"RTN","LA7VOBXA",89,0)
 I $G(LA7OBX2)="" S LA7OBX2="ST" ; default value type
"RTN","LA7VOBXA",90,0)
 I LA7OBX2="ST"!(LA7OBX2="TX") D
"RTN","LA7VOBXA",91,0)
 . S LA7VAL=$$TRIM^XLFSTR(LA7VAL,"R"," ")
"RTN","LA7VOBXA",92,0)
 . S LA7Y=$$CHKDATA^LA7VHLU3(LA7VAL,LA7FS_LA7ECH)
"RTN","LA7VOBXA",93,0)
 I LA7OBX2="NM" S LA7Y=$$TRIM^XLFSTR(LA7VAL,"RL"," ")
"RTN","LA7VOBXA",94,0)
 I LA7OBX2="TS" D
"RTN","LA7VOBXA",95,0)
 . S LA7VAL=$$CHKDT^LA7VHLU1(LA7VAL)
"RTN","LA7VOBXA",96,0)
 . S LA7Y=$$FMTHL7^XLFDT(LA7VAL)
"RTN","LA7VOBXA",97,0)
 I LA7OBX2="CE" D
"RTN","LA7VOBXA",98,0)
 . N I,X
"RTN","LA7VOBXA",99,0)
 . F I=1:1:6 D
"RTN","LA7VOBXA",100,0)
 . . I '$L($P(LA7VAL,"^",I)) Q
"RTN","LA7VOBXA",101,0)
 . . S X=$$CHKDATA^LA7VHLU3($P(LA7VAL,"^",I),LA7FS_LA7ECH)
"RTN","LA7VOBXA",102,0)
 . . S $P(LA7Y,$E(LA7ECH),I)=X
"RTN","LA7VOBXA",103,0)
 ;
"RTN","LA7VOBXA",104,0)
 Q
"RTN","LA7VOBXA",105,0)
 ;
"RTN","LA7VOBXA",106,0)
 ;
"RTN","LA7VOBXA",107,0)
OBX5M ; Build OBX-5 sequence - Observation value - multi-line textual result
"RTN","LA7VOBXA",108,0)
 ;
"RTN","LA7VOBXA",109,0)
 K LA7WP
"RTN","LA7VOBXA",110,0)
 ;
"RTN","LA7VOBXA",111,0)
 S LA7WP=""
"RTN","LA7VOBXA",112,0)
 S LA7TYPE=$$GET1^DID(LA7FN,LA7FLD,"","TYPE","LA7ERR(1)")
"RTN","LA7VOBXA",113,0)
 ;
"RTN","LA7VOBXA",114,0)
 ; Process word-processing type field.
"RTN","LA7VOBXA",115,0)
 ; Check and encode data
"RTN","LA7VOBXA",116,0)
 I LA7TYPE="WORD-PROCESSING" D  Q
"RTN","LA7VOBXA",117,0)
 . N DIWF,DIWL,DIWR,X
"RTN","LA7VOBXA",118,0)
 . S LA7WP=$$GET1^DIQ(LA7FN,LA7IENS,LA7FLD,"","LA7WP","LA7ERR(2)")
"RTN","LA7VOBXA",119,0)
 . K ^UTILITY($J,"W")
"RTN","LA7VOBXA",120,0)
 . S DIWL=1,DIWR=245,DIWF="",LA7I=0
"RTN","LA7VOBXA",121,0)
 . I $$GET1^DID(+$$GET1^DID(LA7FN,LA7FLD,"","SPECIFIER","LA7ERR(1)"),.01,"","SPECIFIER","LA7ERR(3)")["L" S DIWF="N"
"RTN","LA7VOBXA",122,0)
 . F  S LA7I=$O(LA7WP(LA7I)) Q:'LA7I  S X=LA7WP(LA7I) D ^DIWP
"RTN","LA7VOBXA",123,0)
 . K LA7WP
"RTN","LA7VOBXA",124,0)
 . S LA7I=0
"RTN","LA7VOBXA",125,0)
 . F  S LA7I=$O(^UTILITY($J,"W",DIWL,LA7I)) Q:'LA7I  D
"RTN","LA7VOBXA",126,0)
 . . S LA7WP(LA7I)=$$CHKDATA^LA7VHLU3(^UTILITY($J,"W",DIWL,LA7I,0),LA7FS_LA7ECH)
"RTN","LA7VOBXA",127,0)
 . . I LA7I>1 S LA7WP(LA7I)=$E(LA7ECH,3)_".br"_$E(LA7ECH,3)_LA7WP(LA7I)
"RTN","LA7VOBXA",128,0)
 . K ^UTILITY($J,"W")
"RTN","LA7VOBXA",129,0)
 ;
"RTN","LA7VOBXA",130,0)
 ; Free text, assumes multiple valued
"RTN","LA7VOBXA",131,0)
 I LA7TYPE="FREE TEXT" D
"RTN","LA7VOBXA",132,0)
 . D GETS^DIQ(LA7FN,LA7IENS,LA7FLD_"*","","LA7WP","LA7ERR")
"RTN","LA7VOBXA",133,0)
 ;
"RTN","LA7VOBXA",134,0)
 Q
"RTN","LA7VOBXA",135,0)
 ;
"RTN","LA7VOBXA",136,0)
 ;
"RTN","LA7VOBXA",137,0)
OBX5R ; Build OBX-5 sequence with repetition - Observation value
"RTN","LA7VOBXA",138,0)
 ;
"RTN","LA7VOBXA",139,0)
 S (LA7I,LA7Y)=""
"RTN","LA7VOBXA",140,0)
 F  S LA7I=$O(LA7VAL(LA7I)) Q:'LA7I  D
"RTN","LA7VOBXA",141,0)
 . S LA7Y=LA7Y_$$OBX5^LA7VOBX(LA7VAL(LA7I),LA7OBX2,LA7FS,LA7ECH)_$E(LA7ECH,2)
"RTN","LA7VOBXA",142,0)
 ;
"RTN","LA7VOBXA",143,0)
 Q
"RTN","LA7VOBXA",144,0)
 ;
"RTN","LA7VOBXA",145,0)
 ;
"RTN","LA7VOBXA",146,0)
OBX6 ; Build OBX-6 sequence - Units
"RTN","LA7VOBXA",147,0)
 ;
"RTN","LA7VOBXA",148,0)
 S LA7ECH=$G(LA7ECH),LA7Y=""
"RTN","LA7VOBXA",149,0)
 ;
"RTN","LA7VOBXA",150,0)
 ; Units - remove leading and trailing spaces
"RTN","LA7VOBXA",151,0)
 I $G(LA7VAL)'="" S LA7Y=$$TRIM^XLFSTR(LA7VAL,"LR"," ")
"RTN","LA7VOBXA",152,0)
 ;
"RTN","LA7VOBXA",153,0)
 ; Build sequence using LOINC codes only
"RTN","LA7VOBXA",154,0)
 ; LOINC code/code name/"LN"
"RTN","LA7VOBXA",155,0)
 I $G(LA764061) D
"RTN","LA7VOBXA",156,0)
 . N LA7IENS,LA7X,LA7Z
"RTN","LA7VOBXA",157,0)
 . S LA7IENS=LA764061_","
"RTN","LA7VOBXA",158,0)
 . D GETS^DIQ(64.061,LA7IENS,".01;1","E","LA7X")
"RTN","LA7VOBXA",159,0)
 . ; LOINC code
"RTN","LA7VOBXA",160,0)
 . S LA7Z=$G(LA7X(64.061,LA7IENS,.01,"E"))
"RTN","LA7VOBXA",161,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",162,0)
 . S $P(LA7Y,$E(LA7ECH,1),1)=LA7Z
"RTN","LA7VOBXA",163,0)
 . ; LOINC code name
"RTN","LA7VOBXA",164,0)
 . S LA7Z=$G(LA7X(64.061,LA7IENS,1,"E"))
"RTN","LA7VOBXA",165,0)
 . S LA7Z=$$CHKDATA^LA7VHLU3(LA7Z,LA7FS_LA7ECH)
"RTN","LA7VOBXA",166,0)
 . S $P(LA7Y,$E(LA7ECH,1),2)=LA7Z
"RTN","LA7VOBXA",167,0)
 . S $P(LA7Y,$E(LA7ECH,1),3)="LN"
"RTN","LA7VOBXA",168,0)
 ;
"RTN","LA7VOBXA",169,0)
 Q
"RTN","LA7VOBXA",170,0)
 ;
"RTN","LA7VOBXA",171,0)
 ;
"RTN","LA7VOBXA",172,0)
OBX7 ; Build OBX-7 sequence - Reference range
"RTN","LA7VOBXA",173,0)
 ; Removes leading and trailing quote marks ("").
"RTN","LA7VOBXA",174,0)
 ;
"RTN","LA7VOBXA",175,0)
 S LA7Y=""
"RTN","LA7VOBXA",176,0)
 ;
"RTN","LA7VOBXA",177,0)
 I $G(LA7LOW)'="" D
"RTN","LA7VOBXA",178,0)
 . S LA7LOW=$$TRIM^XLFSTR(LA7LOW,"RL","""")
"RTN","LA7VOBXA",179,0)
 . I LA7LOW?1A.E S LA7Y=LA7Y_LA7LOW Q  ; alphabetic value
"RTN","LA7VOBXA",180,0)
 . I $G(LA7HIGH)="",$E(LA7LOW)'=">" S LA7Y=">"
"RTN","LA7VOBXA",181,0)
 . S LA7Y=LA7Y_LA7LOW
"RTN","LA7VOBXA",182,0)
 ;
"RTN","LA7VOBXA",183,0)
 I $G(LA7HIGH)'="" D
"RTN","LA7VOBXA",184,0)
 . S LA7HIGH=$$TRIM^XLFSTR(LA7HIGH,"RL","""")
"RTN","LA7VOBXA",185,0)
 . I LA7HIGH?1A.E S LA7Y=LA7Y_LA7HIGH Q  ; alphabetic value
"RTN","LA7VOBXA",186,0)
 . I $G(LA7LOW)="" D  Q
"RTN","LA7VOBXA",187,0)
 . . I $E(LA7HIGH)'="<" S LA7Y="<"
"RTN","LA7VOBXA",188,0)
 . . S LA7Y=LA7Y_LA7HIGH
"RTN","LA7VOBXA",189,0)
 . S LA7Y=LA7Y_"-"_LA7HIGH
"RTN","LA7VOBXA",190,0)
 ;
"RTN","LA7VOBXA",191,0)
 S LA7Y=$$CHKDATA^LA7VHLU3(LA7Y,LA7FS_LA7ECH)
"RTN","LA7VOBXA",192,0)
 ;
"RTN","LA7VOBXA",193,0)
 Q
"RTN","LA7VORC")
0^18^B8007778
"RTN","LA7VORC",1,0)
LA7VORC ;DALOI/JMC - LAB ORC Segment message builder ; 11-17-98
"RTN","LA7VORC",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VORC",3,0)
 ;
"RTN","LA7VORC",4,0)
 Q
"RTN","LA7VORC",5,0)
 ;
"RTN","LA7VORC",6,0)
ORC1(LA7TYP) ; Build ORC-1 sequence - Order control
"RTN","LA7VORC",7,0)
 ; Call with LA7TYP = order type from table 0119
"RTN","LA7VORC",8,0)
 ;
"RTN","LA7VORC",9,0)
 Q LA7TYP
"RTN","LA7VORC",10,0)
 ;
"RTN","LA7VORC",11,0)
 ;
"RTN","LA7VORC",12,0)
ORC2(LA7VAL,LA7FS,LA7ECH) ; Build ORC-2 sequence - Placer order number
"RTN","LA7VORC",13,0)
 ; Call with  LA7VAL = accession number/UID
"RTN","LA7VORC",14,0)
 ;             LA7FS = HL field separator
"RTN","LA7VORC",15,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VORC",16,0)
 N LA7Y
"RTN","LA7VORC",17,0)
 ;
"RTN","LA7VORC",18,0)
 S $P(LA7Y,$E(LA7ECH),1)=$$CHKDATA^LA7VHLU3(LA7VAL,LA7FS_LA7ECH)
"RTN","LA7VORC",19,0)
 ;
"RTN","LA7VORC",20,0)
 Q LA7Y
"RTN","LA7VORC",21,0)
 ;
"RTN","LA7VORC",22,0)
 ;
"RTN","LA7VORC",23,0)
ORC3(LA7VAL,LA7FS,LA7ECH) ; Build ORC-3 sequence - Filler order number
"RTN","LA7VORC",24,0)
 ; Call with  LA7VAL = accession number/UID
"RTN","LA7VORC",25,0)
 ;             LA7FS = HL field separator
"RTN","LA7VORC",26,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VORC",27,0)
 N LA7Y
"RTN","LA7VORC",28,0)
 ;
"RTN","LA7VORC",29,0)
 S $P(LA7Y,$E(LA7ECH),1)=$$CHKDATA^LA7VHLU3(LA7VAL,LA7FS_LA7ECH)
"RTN","LA7VORC",30,0)
 ;
"RTN","LA7VORC",31,0)
 Q LA7Y
"RTN","LA7VORC",32,0)
 ;
"RTN","LA7VORC",33,0)
 ;
"RTN","LA7VORC",34,0)
ORC4(LA7VAL,LA7FS,LA7ECH) ; Build ORC-4 sequence - Placer group number
"RTN","LA7VORC",35,0)
 ; Call with  LA7VAL = LEDI - shipping manifest number
"RTN","LA7VORC",36,0)
 ;             LA7FS = HL field separator
"RTN","LA7VORC",37,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VORC",38,0)
 ; Returns ORD-4 sequence
"RTN","LA7VORC",39,0)
 ;
"RTN","LA7VORC",40,0)
 N LA7Y
"RTN","LA7VORC",41,0)
 ;
"RTN","LA7VORC",42,0)
 S $P(LA7Y,$E(LA7ECH),1)=$$CHKDATA^LA7VHLU3(LA7VAL,LA7FS_LA7ECH)
"RTN","LA7VORC",43,0)
 ;
"RTN","LA7VORC",44,0)
 Q LA7Y
"RTN","LA7VORC",45,0)
 ;
"RTN","LA7VORC",46,0)
 ;
"RTN","LA7VORC",47,0)
ORC5(LA7VAL,LA7FS,LA7ECH) ; Build ORC-5 sequence - Order status
"RTN","LA7VORC",48,0)
 ; Call with  LA7VAL = order status
"RTN","LA7VORC",49,0)
 ;             LA7FS = HL field separator
"RTN","LA7VORC",50,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VORC",51,0)
 ; Returns ORC-5 sequence
"RTN","LA7VORC",52,0)
 ;
"RTN","LA7VORC",53,0)
 N LA7Y
"RTN","LA7VORC",54,0)
 ;
"RTN","LA7VORC",55,0)
 I LA7VAL="CM" S LA7Y="CM"
"RTN","LA7VORC",56,0)
 ;
"RTN","LA7VORC",57,0)
 Q LA7Y
"RTN","LA7VORC",58,0)
 ;
"RTN","LA7VORC",59,0)
 ;
"RTN","LA7VORC",60,0)
ORC7(LA7DUR,LA7DURU,LA76205,LA7FS,LA7ECH) ; Build ORC-7 sequence - Quantity/Timing
"RTN","LA7VORC",61,0)
 ; Call with  LA7DUR = collection duration
"RTN","LA7VORC",62,0)
 ;           LA7DURU = duration units (pointer to #64.061)
"RTN","LA7VORC",63,0)
 ;           LA76205 = test urgency
"RTN","LA7VORC",64,0)
 ;             LA7FS = HL field separator
"RTN","LA7VORC",65,0)
 ;            LA7ECH = HL encoding characters
"RTN","LA7VORC",66,0)
 ;
"RTN","LA7VORC",67,0)
 ; Returns ORC-7 sequence
"RTN","LA7VORC",68,0)
 ;
"RTN","LA7VORC",69,0)
 N LA7X,LA7Y
"RTN","LA7VORC",70,0)
 ;
"RTN","LA7VORC",71,0)
 I LA7DUR'="",LA7DURU D
"RTN","LA7VORC",72,0)
 . S LA7X=$$GET1^DIQ(64.061,LA7DURU_",",2) ; duration units
"RTN","LA7VORC",73,0)
 . S $P(LA7Y,$E(LA7ECH,1),3)=$$CHKDATA^LA7VHLU3(LA7X_LA7DUR,LA7FS_LA7ECH)
"RTN","LA7VORC",74,0)
 ;
"RTN","LA7VORC",75,0)
 I LA76205 D
"RTN","LA7VORC",76,0)
 . S LA7X=$$GET1^DIQ(64.061,+$$GET1^DIQ(62.05,LA76205_",",4,"I")_",",2) ; Urgency
"RTN","LA7VORC",77,0)
 . S $P(LA7Y,$E(LA7ECH,1),6)=$$CHKDATA^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VORC",78,0)
 ;
"RTN","LA7VORC",79,0)
 Q LA7Y
"RTN","LA7VORC",80,0)
 ;
"RTN","LA7VORC",81,0)
 ;
"RTN","LA7VORC",82,0)
ORC9(LA7DT) ; Build ORC-9 sequence - date/time of transaction
"RTN","LA7VORC",83,0)
 ; Call with LA7DT = order date/time
"RTN","LA7VORC",84,0)
 ;
"RTN","LA7VORC",85,0)
 ; Returns ORC-9 sequence
"RTN","LA7VORC",86,0)
 ;
"RTN","LA7VORC",87,0)
 S LA7DT=$$CHKDT^LA7VHLU1(LA7DT)
"RTN","LA7VORC",88,0)
 Q $$FMTHL7^XLFDT(LA7DT)
"RTN","LA7VORC",89,0)
 ;
"RTN","LA7VORC",90,0)
 ;
"RTN","LA7VORC",91,0)
ORC12(LA7DUZ,LA7DIV,LA7FS,LA7ECH) ; Build ORC-12 sequence - Ordering provider
"RTN","LA7VORC",92,0)
 ; Call with   LA7DUZ = DUZ of ordering provider
"RTN","LA7VORC",93,0)
 ;             LA7DIV = Facility (division) of provider
"RTN","LA7VORC",94,0)
 ;             LA7FS = HL field separator
"RTN","LA7VORC",95,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VORC",96,0)
 ;           
"RTN","LA7VORC",97,0)
 ; Returns ORC-12 sequence
"RTN","LA7VORC",98,0)
 ; Also used to build OBR-16 sequence
"RTN","LA7VORC",99,0)
 ;
"RTN","LA7VORC",100,0)
 Q $$XCN^LA7VHLU4(LA7DUZ,LA7DIV,LA7FS,LA7ECH)
"RTN","LA7VORC",101,0)
 ;
"RTN","LA7VORC",102,0)
 ;
"RTN","LA7VORC",103,0)
ORC17(LA74,LA7FS,LA7ECH) ; Build ORC-17 sequence - Entering organization
"RTN","LA7VORC",104,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VORC",105,0)
 ;                    if null/undefined then use Kernel Site file.
"RTN","LA7VORC",106,0)
 ;            LA7FS = HL field separator
"RTN","LA7VORC",107,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VORC",108,0)
 ;
"RTN","LA7VORC",109,0)
 ; Returns ORC-17 sequence (ID^text^99VA4)
"RTN","LA7VORC",110,0)
 ;
"RTN","LA7VORC",111,0)
 Q $$INST^LA7VHLU4(LA74,LA7FS,LA7ECH)
"RTN","LA7VORC",112,0)
 ;
"RTN","LA7VORC",113,0)
 ;
"RTN","LA7VORC",114,0)
ORC21(LA74,LA7FS,LA7ECH) ; Build ORC-21 sequence - Ordering facility name
"RTN","LA7VORC",115,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VORC",116,0)
 ;                    if null/undefined then use Kernel Site file.
"RTN","LA7VORC",117,0)
 ;            LA7FS = HL field separator
"RTN","LA7VORC",118,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VORC",119,0)
 ;
"RTN","LA7VORC",120,0)
 ; Returns ORC-21 sequence
"RTN","LA7VORC",121,0)
 ;
"RTN","LA7VORC",122,0)
 N LA7X,LA7Y
"RTN","LA7VORC",123,0)
 ;
"RTN","LA7VORC",124,0)
 I $G(LA74)<1 S LA74=0
"RTN","LA7VORC",125,0)
 S LA7X=$$NAME^XUAF4(LA74)
"RTN","LA7VORC",126,0)
 S LA7Y=""
"RTN","LA7VORC",127,0)
 ;
"RTN","LA7VORC",128,0)
 Q LA7Y
"RTN","LA7VORC",129,0)
 ;
"RTN","LA7VORC",130,0)
 ;
"RTN","LA7VORC",131,0)
ORC22(LA74,LA7DT,LA7FS,LA7ECH) ; Build ORC-22 sequence - Ordering facility address
"RTN","LA7VORC",132,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VORC",133,0)
 ;                    if null/undefined then use Kernel Site file.
"RTN","LA7VORC",134,0)
 ;            LA7DT = "as of" date in FileMan format
"RTN","LA7VORC",135,0)
 ;            LA7FS = HL field separator
"RTN","LA7VORC",136,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VORC",137,0)
 ;
"RTN","LA7VORC",138,0)
 ; Returns ORC-22 sequence
"RTN","LA7VORC",139,0)
 ;
"RTN","LA7VORC",140,0)
 N LA7X,LA7Y
"RTN","LA7VORC",141,0)
 ;
"RTN","LA7VORC",142,0)
 S LA7X=$$PADD^XUAF4(LA74)
"RTN","LA7VORC",143,0)
 S LA7Y=""
"RTN","LA7VORC",144,0)
 ;
"RTN","LA7VORC",145,0)
 Q LA7Y
"RTN","LA7VORC",146,0)
 ;
"RTN","LA7VORC",147,0)
 ;
"RTN","LA7VORC",148,0)
ORC23(LA74,LA7DT,LA7FS,LA7ECH) ; Build ORC-23 sequence - Ordering facility phone number
"RTN","LA7VORC",149,0)
 ; Call with   LA74 = ien of institution in file #4
"RTN","LA7VORC",150,0)
 ;                    if null/undefined then use Kernel Site file.
"RTN","LA7VORC",151,0)
 ;            LA7DT = "as of" date in FileMan format
"RTN","LA7VORC",152,0)
 ;            LA7FS = HL field separator
"RTN","LA7VORC",153,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VORC",154,0)
 ;
"RTN","LA7VORC",155,0)
 ; Returns ORC-23 sequence
"RTN","LA7VORC",156,0)
 ;
"RTN","LA7VORC",157,0)
 N LA7Y
"RTN","LA7VORC",158,0)
 ;
"RTN","LA7VORC",159,0)
 S LA7Y=""
"RTN","LA7VORC",160,0)
 ;
"RTN","LA7VORC",161,0)
 Q LA7Y
"RTN","LA7VORC",162,0)
 ;
"RTN","LA7VORC",163,0)
 ;
"RTN","LA7VORC",164,0)
ORC24(LA7200,LA7DT,LA7FS,LA7ECH) ; Build ORC-24 sequence - Ordering provider address
"RTN","LA7VORC",165,0)
 ; Call with LA7200 = ien of provider in file #200
"RTN","LA7VORC",166,0)
 ;            LA7DT = "as of" date in FileMan format
"RTN","LA7VORC",167,0)
 ;            LA7FS = HL field separator
"RTN","LA7VORC",168,0)
 ;           LA7ECH = HL encoding characters
"RTN","LA7VORC",169,0)
 ;
"RTN","LA7VORC",170,0)
 ; Returns ORC-24 sequence
"RTN","LA7VORC",171,0)
 ;
"RTN","LA7VORC",172,0)
 N LA7Y
"RTN","LA7VORC",173,0)
 ;
"RTN","LA7VORC",174,0)
 S LA7Y=""
"RTN","LA7VORC",175,0)
 ;
"RTN","LA7VORC",176,0)
 Q LA7Y
"RTN","LA7VORM")
0^19^B68105004
"RTN","LA7VORM",1,0)
LA7VORM ;DALOI/DLR - LAB ORM (Order) message PROCESSOR ; April 13, 2004
"RTN","LA7VORM",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,42,46,64**;Sep 27, 1994
"RTN","LA7VORM",3,0)
IN ;
"RTN","LA7VORM",4,0)
 D ORM^LA7VHL
"RTN","LA7VORM",5,0)
 Q
"RTN","LA7VORM",6,0)
 ;
"RTN","LA7VORM",7,0)
OBR ;;OBR
"RTN","LA7VORM",8,0)
 N LA760,LA76205,LA7629,LA7ACC,LA7CEDT,LA7CSCS,LA7CSNM,LA7CSTY,LA7DCODE,LA7HSITE,LA7I,LA7NCS,LA7OTST,LA7OTSTN,LA7PF1,LA7PF2,LA7RCI,LA7SPCS,LA7SPNM,LA7SPTY,LA7USID,LA7X,LA7Y,RTST,RTSTN
"RTN","LA7VORM",9,0)
 ;
"RTN","LA7VORM",10,0)
 ; OBR Set ID
"RTN","LA7VORM",11,0)
 S LA7SOBR=$$P^LA7VHLU(.LA7SEG,2,LA7FS)
"RTN","LA7VORM",12,0)
 ;
"RTN","LA7VORM",13,0)
 ; Placer order number
"RTN","LA7VORM",14,0)
 S LA7SID=$$P^LA7VHLU(.LA7SEG,3,LA7FS)
"RTN","LA7VORM",15,0)
 ;
"RTN","LA7VORM",16,0)
 ; Universal service ID
"RTN","LA7VORM",17,0)
 S LA7USID=$$P^LA7VHLU(.LA7SEG,5,LA7FS)
"RTN","LA7VORM",18,0)
 S LA7OTSTN=$P(LA7USID,LA7CS)
"RTN","LA7VORM",19,0)
 I LA7OTSTN="" D  Q
"RTN","LA7VORM",20,0)
 . N LA7X
"RTN","LA7VORM",21,0)
 . S LA7X="PID-"_LA7SPID_"/OBR-"_LA7SOBR
"RTN","LA7VORM",22,0)
 . D CREATE^LA7LOG(26)
"RTN","LA7VORM",23,0)
 ;
"RTN","LA7VORM",24,0)
 S LA7OTST=$$UNESC^LA7VHLU3($P(LA7USID,LA7CS,2),LA7FS_LA7ECH)
"RTN","LA7VORM",25,0)
 S LA7NCS=$P(LA7USID,LA7CS,3) ; Name of coding system
"RTN","LA7VORM",26,0)
 S RTSTN=$P(LA7USID,LA7CS,4)
"RTN","LA7VORM",27,0)
 S RTST=$$UNESC^LA7VHLU3($P(LA7USID,LA7CS,5),LA7FS_LA7ECH)
"RTN","LA7VORM",28,0)
 ;
"RTN","LA7VORM",29,0)
 ; No ORC segment
"RTN","LA7VORM",30,0)
 I LA7SEQ<20 D  Q
"RTN","LA7VORM",31,0)
 . D CREATE^LA7LOG(29)
"RTN","LA7VORM",32,0)
 ;
"RTN","LA7VORM",33,0)
 ; Missing patient name
"RTN","LA7VORM",34,0)
 I $G(LA7PNM)="" D  Q
"RTN","LA7VORM",35,0)
 . D CREATE^LA7LOG(30)
"RTN","LA7VORM",36,0)
 ;
"RTN","LA7VORM",37,0)
 ; Non-VA system, not using NLT codes/file #60 tests
"RTN","LA7VORM",38,0)
 I LA7NCS'="99VA64" D
"RTN","LA7VORM",39,0)
 . I RTSTN="" S RTSTN=LA7OTST
"RTN","LA7VORM",40,0)
 . I RTST="" S RTST=LA7OTSTN
"RTN","LA7VORM",41,0)
 ;
"RTN","LA7VORM",42,0)
 ; Specimen collection date/time
"RTN","LA7VORM",43,0)
 S LA7CDT=$$HL7TFM^XLFDT($P($$P^LA7VHLU(.LA7SEG,8,LA7FS),LA7CS),"L")
"RTN","LA7VORM",44,0)
 ;
"RTN","LA7VORM",45,0)
 ; Specimen end collection date/time (timed collection)
"RTN","LA7VORM",46,0)
 S LA7CEDT=$$HL7TFM^XLFDT($P($$P^LA7VHLU(.LA7SEG,9,LA7FS),LA7CS),"L")
"RTN","LA7VORM",47,0)
 ;
"RTN","LA7VORM",48,0)
 ; Collection volume
"RTN","LA7VORM",49,0)
 S LA7VOL=""
"RTN","LA7VORM",50,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,10,LA7FS)
"RTN","LA7VORM",51,0)
 I $L($P(LA7X,LA7CS)) D
"RTN","LA7VORM",52,0)
 . S $P(LA7VOL,"^")=$P(LA7X,LA7CS) ; volume
"RTN","LA7VORM",53,0)
 . S $P(LA7VOL,"^",2)=$P(LA7X,LA7CS,2) ; volume units
"RTN","LA7VORM",54,0)
 . S $P(LA7VOL,"^",3)=$P(LA7X,LA7CS,3) ; volume coding system
"RTN","LA7VORM",55,0)
 ;
"RTN","LA7VORM",56,0)
 ; Specimen action code
"RTN","LA7VORM",57,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,12,LA7FS),LA7SAC=""
"RTN","LA7VORM",58,0)
 I LA7X="A" S LA7SAC="Add ordered tests to the existing specimen"
"RTN","LA7VORM",59,0)
 I LA7X="G" S LA7SAC="Generated order; reflex order"
"RTN","LA7VORM",60,0)
 ;
"RTN","LA7VORM",61,0)
 ; Danger code
"RTN","LA7VORM",62,0)
 S LA7X=$P($$P^LA7VHLU(.LA7SEG,13,LA7FS),LA7CS,2)
"RTN","LA7VORM",63,0)
 S LA7DCODE=$$UNESC^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VORM",64,0)
 I LA7DCODE]"" D
"RTN","LA7VORM",65,0)
 . S LA7DCODE=$$TRIM^XLFSTR(LA7DCODE,"RL"," ")
"RTN","LA7VORM",66,0)
 . S LA7DCODE="Danger Code - "_LA7DCODE
"RTN","LA7VORM",67,0)
 ;
"RTN","LA7VORM",68,0)
 ; Relevant clinical information
"RTN","LA7VORM",69,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,14,LA7FS)
"RTN","LA7VORM",70,0)
 S LA7RCI=$$UNESC^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VORM",71,0)
 I LA7RCI]"" D
"RTN","LA7VORM",72,0)
 . S LA7RCI=$$TRIM^XLFSTR(LA7RCI,"RL"," ")
"RTN","LA7VORM",73,0)
 . S LA7RCI="Relevant clinical information - "_LA7RCI
"RTN","LA7VORM",74,0)
 ;
"RTN","LA7VORM",75,0)
 ; Specimen source -  specimen code - name of specimen coding system
"RTN","LA7VORM",76,0)
 ; If no primary then try alternate
"RTN","LA7VORM",77,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,16,LA7FS)
"RTN","LA7VORM",78,0)
 S LA7SPTY=$P($P(LA7X,LA7CS),$E(LA7ECH,4))
"RTN","LA7VORM",79,0)
 S LA7SPNM=$P($P(LA7X,LA7CS),$E(LA7ECH,4),2)
"RTN","LA7VORM",80,0)
 S LA7SPCS=$P($P(LA7X,LA7CS),$E(LA7ECH,4),3)
"RTN","LA7VORM",81,0)
 I LA7SPTY="" D
"RTN","LA7VORM",82,0)
 . S LA7SPTY=$P($P(LA7X,LA7CS),$E(LA7ECH,4),4)
"RTN","LA7VORM",83,0)
 . S LA7SPNM=$P($P(LA7X,LA7CS),$E(LA7ECH,4),5)
"RTN","LA7VORM",84,0)
 . S LA7SPCS=$P($P(LA7X,LA7CS),$E(LA7ECH,4),6)
"RTN","LA7VORM",85,0)
 ;
"RTN","LA7VORM",86,0)
 ; Collection sample from body site
"RTN","LA7VORM",87,0)
 S LA7CSTY=$P($P(LA7X,LA7CS,4),$E(LA7ECH,4))
"RTN","LA7VORM",88,0)
 S LA7CSNM=$P($P(LA7X,LA7CS,4),$E(LA7ECH,4),2)
"RTN","LA7VORM",89,0)
 S LA7CSCS=$P($P(LA7X,LA7CS,4),$E(LA7ECH,4),3)
"RTN","LA7VORM",90,0)
 ;
"RTN","LA7VORM",91,0)
 ; Placer's ordering provider (last name, first name, mi [id])
"RTN","LA7VORM",92,0)
 ; Only process if LA7POP from ORC-12 is blank.
"RTN","LA7VORM",93,0)
 I LA7POP="" D
"RTN","LA7VORM",94,0)
 . S LA7X=$$P^LA7VHLU(.LA7SEG,17,LA7FS)
"RTN","LA7VORM",95,0)
 . S LA7POP=$$XCNTFM^LA7VHLU4(LA7X,LA7ECH)
"RTN","LA7VORM",96,0)
 . I LA7POP="^^" S LA7POP=""
"RTN","LA7VORM",97,0)
 ;
"RTN","LA7VORM",98,0)
 ; Specimen urgency
"RTN","LA7VORM",99,0)
 S LA7UR=$P($$P^LA7VHLU(.LA7SEG,28,LA7FS),LA7CS,6)
"RTN","LA7VORM",100,0)
 ; If no urgency see if it came in ORC-7
"RTN","LA7VORM",101,0)
 I LA7UR="" S LA7UR=$G(LA7OUR)
"RTN","LA7VORM",102,0)
 ;
"RTN","LA7VORM",103,0)
 ; Look for receiving facility in OBR, then use receiving facility from MSH
"RTN","LA7VORM",104,0)
 S LA7X=$P($$P^LA7VHLU(.LA7SEG,35,LA7FS),LA7CS,7)
"RTN","LA7VORM",105,0)
 S LA7HSITE=$$FINDSITE^LA7VHLU2(LA7X,1,1)
"RTN","LA7VORM",106,0)
 I LA7HSITE'>0 S LA7HSITE=$$FINDSITE^LA7VHLU2(LA7RFAC,1,0)
"RTN","LA7VORM",107,0)
 ;
"RTN","LA7VORM",108,0)
 ; Find an "active" shipping configuration for this pair.
"RTN","LA7VORM",109,0)
 S LA7629=0
"RTN","LA7VORM",110,0)
 I LA7CSITE,LA7HSITE D
"RTN","LA7VORM",111,0)
 . N LA7X
"RTN","LA7VORM",112,0)
 . S LA7X=0
"RTN","LA7VORM",113,0)
 . F  S LA7X=$O(^LAHM(62.9,"CH",LA7CSITE,LA7HSITE,LA7X)) Q:'LA7X  I $P($G(^LAHM(62.9,LA7X,0)),"^",4) S LA7629=LA7X Q
"RTN","LA7VORM",114,0)
 ; Log error and quit if no active shipping configuration identified
"RTN","LA7VORM",115,0)
 I 'LA7629 D  Q
"RTN","LA7VORM",116,0)
 . D CREATE^LA7LOG(39)
"RTN","LA7VORM",117,0)
 ;
"RTN","LA7VORM",118,0)
 S LA7Y=$$DTTO^LA7SMU2(LA7629,LA7OTSTN,LA7SPTY,LA7NCS,LA7SPCS,LA7UR,LA7CSTY_"^"_LA7CSNM_"^"_LA7CSCS)
"RTN","LA7VORM",119,0)
 S LA760=$P(LA7Y,"^"),LA761=$P(LA7Y,"^",2),LA762=$P(LA7Y,"^",3),LA76205=$P(LA7Y,"^",4)
"RTN","LA7VORM",120,0)
 I $P(LA7Y,"^",5)'="" S LA7OTSTN=$P(LA7Y,"^",5),LA7OTST=$P(LA7Y,"^",6)
"RTN","LA7VORM",121,0)
 F LA7I=1:1:4 I '$P(LA7Y,"^",LA7I) D
"RTN","LA7VORM",122,0)
 . I LA7I=3,LA760,"MISPCYEM"[$P(^LAB(60,LA760,0),"^",4) Q
"RTN","LA7VORM",123,0)
 . S LA7X="No local "_$P("lab test^topography^collection sample^urgency","^",LA7I)_" mapped."
"RTN","LA7VORM",124,0)
 . N LA7I,LA7Y
"RTN","LA7VORM",125,0)
 . D CREATE^LA7LOG(47)
"RTN","LA7VORM",126,0)
 ;
"RTN","LA7VORM",127,0)
 ; Placer fields 1 & 2
"RTN","LA7VORM",128,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,19,LA7FS)
"RTN","LA7VORM",129,0)
 I LA7X'="",LA7X[LA7CS S LA7X=$TR(LA7X,LA7CS,"^")
"RTN","LA7VORM",130,0)
 S LA7PF1=$$UNESC^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VORM",131,0)
 S LA7X=$$P^LA7VHLU(.LA7SEG,20,LA7FS)
"RTN","LA7VORM",132,0)
 I LA7X'="",LA7X[LA7CS S LA7X=$TR(LA7X,LA7CS,"^")
"RTN","LA7VORM",133,0)
 S LA7PF2=$$UNESC^LA7VHLU3(LA7X,LA7FS_LA7ECH)
"RTN","LA7VORM",134,0)
 S LA7ACC=$P(LA7PF2,"^",6)
"RTN","LA7VORM",135,0)
 ;
"RTN","LA7VORM",136,0)
 ; New order - add to LAB PENDING ORDERS file #69.6
"RTN","LA7VORM",137,0)
 I LA7OTYPE="NW" D NW
"RTN","LA7VORM",138,0)
 ;
"RTN","LA7VORM",139,0)
 Q
"RTN","LA7VORM",140,0)
 ;
"RTN","LA7VORM",141,0)
NW ; Create new order in LAB PENDING ORDERS file #69.6
"RTN","LA7VORM",142,0)
 ;
"RTN","LA7VORM",143,0)
 N FDA,I,LA76964,LA7DIE,LA7I,LA7IEN,LA7PATID,LA7SSITE,LA7STAT,LA7WP
"RTN","LA7VORM",144,0)
 ;
"RTN","LA7VORM",145,0)
 ; Get lock on 69.6
"RTN","LA7VORM",146,0)
 L +^LRO(69.6,0):99999
"RTN","LA7VORM",147,0)
 I '$T D  Q
"RTN","LA7VORM",148,0)
 . D CREATE^LA7LOG(31)
"RTN","LA7VORM",149,0)
 ;
"RTN","LA7VORM",150,0)
 S LA7696=$O(^LRO(69.6,"AD",$S($P(LA7SM,"^",2)'="":$P(LA7SM,"^",2),1:0),LA7SID,0))
"RTN","LA7VORM",151,0)
 ;
"RTN","LA7VORM",152,0)
 ; Find "In-Transit" status in #64.061
"RTN","LA7VORM",153,0)
 S LA7STAT=$$FIND1^DIC(64.061,"","OMX","In-Transit","","I $P(^LAB(64.061,Y,0),U,7)=""U""")
"RTN","LA7VORM",154,0)
 ;
"RTN","LA7VORM",155,0)
 ; Create entry in LAB PENDING ORDER ENTRY file, log error if not added
"RTN","LA7VORM",156,0)
 I $G(LA7696)'>0 D
"RTN","LA7VORM",157,0)
 . S FDA(1,69.6,"+1,",.01)=LA7PNM
"RTN","LA7VORM",158,0)
 . S FDA(1,69.6,"+1,",6)=LA7STAT
"RTN","LA7VORM",159,0)
 . D UPDATE^DIE("","FDA(1)","LA7IEN","LA7DIE(1)")
"RTN","LA7VORM",160,0)
 . S LA7696=LA7IEN(1)
"RTN","LA7VORM",161,0)
 . I LA7696<1 D CREATE^LA7LOG(32)
"RTN","LA7VORM",162,0)
 ;
"RTN","LA7VORM",163,0)
 L -^LRO(69.6,0)
"RTN","LA7VORM",164,0)
 I LA7696<1 Q
"RTN","LA7VORM",165,0)
 ;
"RTN","LA7VORM",166,0)
 L +^LRO(69.6,LA7696):99999
"RTN","LA7VORM",167,0)
 I '$T D  Q  ;cannot get lock on ENTRY in 69.6
"RTN","LA7VORM",168,0)
 . D CREATE^LA7LOG(33)
"RTN","LA7VORM",169,0)
 ;
"RTN","LA7VORM",170,0)
 ; Prevent duplication of tests
"RTN","LA7VORM",171,0)
 I $D(^LRO(69.6,LA7696,2,"C",LA7OTSTN)) D UNLOCK Q
"RTN","LA7VORM",172,0)
 ;
"RTN","LA7VORM",173,0)
 ; Determine entry in INSTITUTION file (#4) that's the sending site.
"RTN","LA7VORM",174,0)
 S LA7SSITE=$$FINDSITE^LA7VHLU2(LA7SFAC,2,0)
"RTN","LA7VORM",175,0)
 ;
"RTN","LA7VORM",176,0)
 ; Patient id to store with order
"RTN","LA7VORM",177,0)
 S LA7PATID=LA7SSN
"RTN","LA7VORM",178,0)
 I LA7PATID="" D
"RTN","LA7VORM",179,0)
 . S LA7PATID=$P($G(LA7PTID3(1)),$E(LA7ECH))
"RTN","LA7VORM",180,0)
 . I LA7PATID'="" Q
"RTN","LA7VORM",181,0)
 . I LA7PTID4'="" S LA7PATID=$P($P(LA7PTID4,$E(LA7ECH,2)),$E(LA7ECH))
"RTN","LA7VORM",182,0)
 . I LA7PATID'="" Q
"RTN","LA7VORM",183,0)
 . I LA7PTID2'="" S LA7PATID=$P(LA7PTID2,$E(LA7ECH))
"RTN","LA7VORM",184,0)
 ;
"RTN","LA7VORM",185,0)
 S FDA(2,69.6,LA7696_",",.01)=LA7PNM
"RTN","LA7VORM",186,0)
 S FDA(2,69.6,LA7696_",",.02)=LA7SEX
"RTN","LA7VORM",187,0)
 S FDA(2,69.6,LA7696_",",.03)=LA7DOB
"RTN","LA7VORM",188,0)
 I $G(LA7PRACE)'="" S FDA(2,69.6,LA7696_",",.06)=LA7PRACE
"RTN","LA7VORM",189,0)
 S FDA(2,69.6,LA7696_",",.09)=LA7PATID
"RTN","LA7VORM",190,0)
 S FDA(2,69.6,LA7696_",",1)=LA7SSITE
"RTN","LA7VORM",191,0)
 S FDA(2,69.6,LA7696_",",2)=LA7CSITE
"RTN","LA7VORM",192,0)
 S FDA(2,69.6,LA7696_",",3)=LA7SID
"RTN","LA7VORM",193,0)
 S FDA(2,69.6,LA7696_",",3.2)=LA7ACC
"RTN","LA7VORM",194,0)
 I LA761 S FDA(2,69.6,LA7696_",",4)=LA761
"RTN","LA7VORM",195,0)
 I LA762 S FDA(2,69.6,LA7696_",",5)=LA762
"RTN","LA7VORM",196,0)
 S FDA(2,69.6,LA7696_",",10)=LA7ORDT
"RTN","LA7VORM",197,0)
 S FDA(2,69.6,LA7696_",",11)=LA7CDT
"RTN","LA7VORM",198,0)
 S FDA(2,69.6,LA7696_",",11.1)=LA7CEDT
"RTN","LA7VORM",199,0)
 S FDA(2,69.6,LA7696_",",14)=LA7MEDT
"RTN","LA7VORM",200,0)
 S FDA(2,69.6,LA7696_",",17)=LA7MID
"RTN","LA7VORM",201,0)
 I $P(LA7SM,"^",2)'="" S LA7X=$P(LA7SM,"^",2)
"RTN","LA7VORM",202,0)
 E  S LA7X=LA7SFAC_"-"_$E($$FMTHL7^XLFDT(LA7MEDT),1,8)
"RTN","LA7VORM",203,0)
 S FDA(2,69.6,LA7696_",",18)=LA7X
"RTN","LA7VORM",204,0)
 S FDA(2,69.6,LA7696_",",700)=LA7FS_LA7ECH
"RTN","LA7VORM",205,0)
 I LA7PTID3'="" S FDA(2,69.6,LA7696_",",700.02)=LA7PTID3
"RTN","LA7VORM",206,0)
 I LA7PTID4'="" S FDA(2,69.6,LA7696_",",700.04)=LA7PTID4
"RTN","LA7VORM",207,0)
 D FILE^DIE("","FDA(2)","LA7DIE(2)")
"RTN","LA7VORM",208,0)
 ;
"RTN","LA7VORM",209,0)
 ; Add test to order
"RTN","LA7VORM",210,0)
 S FDA(3,69.64,"+2,"_LA7696_",",.01)=LA7OTST
"RTN","LA7VORM",211,0)
 S FDA(3,69.64,"+2,"_LA7696_",",1)=LA7OTSTN
"RTN","LA7VORM",212,0)
 S FDA(3,69.64,"+2,"_LA7696_",",2)=RTST
"RTN","LA7VORM",213,0)
 S FDA(3,69.64,"+2,"_LA7696_",",3)=RTSTN
"RTN","LA7VORM",214,0)
 S FDA(3,69.64,"+2,"_LA7696_",",4)=LA7UR
"RTN","LA7VORM",215,0)
 I LA760 S FDA(3,69.64,"+2,"_LA7696_",",11)=LA760
"RTN","LA7VORM",216,0)
 I LA76205 S FDA(3,69.64,"+2,"_LA7696_",",12)=LA76205
"RTN","LA7VORM",217,0)
 I $P(LA7POP,"^",3)'="" S FDA(3,69.64,"+2,"_LA7696_",",13)=$P(LA7POP,"^",3)
"RTN","LA7VORM",218,0)
 I LA7USID'="" S FDA(3,69.64,"+2,"_LA7696_",",700.04)=LA7USID
"RTN","LA7VORM",219,0)
 I LA7PF1'="" S FDA(3,69.64,"+2,"_LA7696_",",700.18)=LA7PF1
"RTN","LA7VORM",220,0)
 I LA7PF2'="" S FDA(3,69.64,"+2,"_LA7696_",",700.19)=LA7PF2
"RTN","LA7VORM",221,0)
 D UPDATE^DIE("","FDA(3)","LA76964","LA7DIE(3)")
"RTN","LA7VORM",222,0)
 ;
"RTN","LA7VORM",223,0)
 ; If no test status - set to In-transit.
"RTN","LA7VORM",224,0)
 I $G(LA76964(2)),$P($G(^LRO(69.6,LA7696,2,LA76964(2),0)),"^",6)="" D
"RTN","LA7VORM",225,0)
 . S FDA(4,69.64,LA76964(2)_","_LA7696_",",5)=LA7STAT
"RTN","LA7VORM",226,0)
 . D FILE^DIE("","FDA(4)","LA7DIE(4)")
"RTN","LA7VORM",227,0)
 ;
"RTN","LA7VORM",228,0)
 ; Check for comments to store with order.
"RTN","LA7VORM",229,0)
 ; Begin sections with <space> to avoid FM word wrap.
"RTN","LA7VORM",230,0)
 S LA7I=1
"RTN","LA7VORM",231,0)
 I 'LA760 S LA7WP(LA7I,0)="For test "_LA7OTST
"RTN","LA7VORM",232,0)
 E  S LA7WP(LA7I,0)="For test "_$$GET1^DIQ(60,LA760_",",.01)
"RTN","LA7VORM",233,0)
 ;
"RTN","LA7VORM",234,0)
 I LA7SAC'="" S LA7I=LA7I+1,LA7WP(LA7I,0)=" "_LA7SAC
"RTN","LA7VORM",235,0)
 ;
"RTN","LA7VORM",236,0)
 I LA7DCODE'="" F I=1:250:$L(LA7DCODE) S LA7I=LA7I+1,LA7WP(LA7I,0)=$S(I=1:" ",1:"")_$E(LA7DCODE,I,I+249)
"RTN","LA7VORM",237,0)
 ;
"RTN","LA7VORM",238,0)
 I LA7RCI'="" F I=1:250:$L(LA7RCI) S LA7I=LA7I+1,LA7WP(LA7I,0)=$S(I=1:" ",1:"")_$E(LA7RCI,I,I+249)
"RTN","LA7VORM",239,0)
 ;
"RTN","LA7VORM",240,0)
 I LA760,"MISPCYEM"[$P(^LAB(60,LA760,0),"^",4) D
"RTN","LA7VORM",241,0)
 . S LA7I=LA7I+1,LA7WP(LA7I,0)=" Specimen source: "_LA7SPNM_" ["_LA7SPCS_": "_LA7SPTY_"]"
"RTN","LA7VORM",242,0)
 . S LA7I=LA7I+1,LA7WP(LA7I,0)=" Collection sample: "_LA7CSNM_" ["_LA7CSCS_": "_LA7CSTY_"]"
"RTN","LA7VORM",243,0)
 ;
"RTN","LA7VORM",244,0)
 I $O(LA7WP(1)) D WP^DIE(69.6,LA7696_",",99,"A","LA7WP","LA7DIE(99)")
"RTN","LA7VORM",245,0)
 ;
"RTN","LA7VORM",246,0)
 D CLEAN^DILF
"RTN","LA7VORM",247,0)
 D UNLOCK
"RTN","LA7VORM",248,0)
 Q
"RTN","LA7VORM",249,0)
 ;
"RTN","LA7VORM",250,0)
UNLOCK ; unlock entry in file #69.6
"RTN","LA7VORM",251,0)
 L -^LRO(69.6,LA7696)
"RTN","LA7VORM",252,0)
 Q
"RTN","LA7VORM1")
0^20^B52156055
"RTN","LA7VORM1",1,0)
LA7VORM1 ;DALOI/DLR - LAB ORM (Order) message builder ; 12-12-96
"RTN","LA7VORM1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,51,46,61,64**;Sep 27, 1994
"RTN","LA7VORM1",3,0)
 ;
"RTN","LA7VORM1",4,0)
BUILD(LA7628) ;
"RTN","LA7VORM1",5,0)
 ; Call with LA7628 = ien of entry in file #62.8 Shipping Manifest
"RTN","LA7VORM1",6,0)
 ;
"RTN","LA7VORM1",7,0)
 N LA7101,LA762801,LA7629,LA7NVAF,LA7PIDSN,LA7X,ECNT,GBL,SHP,SHPC,SITE,ORUID,NTST
"RTN","LA7VORM1",8,0)
 ;
"RTN","LA7VORM1",9,0)
 I $G(LA7628)<1!('$D(^LAHM(62.8,+$G(LA7628),0))) D  Q
"RTN","LA7VORM1",10,0)
 . ; Need to add error logging for manifest not found.
"RTN","LA7VORM1",11,0)
 . D EXIT
"RTN","LA7VORM1",12,0)
 ;
"RTN","LA7VORM1",13,0)
 S GBL="^TMP(""HLS"","_$J_")",ECNT=1
"RTN","LA7VORM1",14,0)
 S LA7628(0)=$G(^LAHM(62.8,LA7628,0))
"RTN","LA7VORM1",15,0)
 S LA7629=$P(LA7628(0),U,2)
"RTN","LA7VORM1",16,0)
 S LA7629(0)=$G(^LAHM(62.9,LA7629,0))
"RTN","LA7VORM1",17,0)
 S LA76248=+$P(LA7629(0),"^",7)
"RTN","LA7VORM1",18,0)
 S LA76248(0)=$G(^LAHM(62.48,LA76248,0))
"RTN","LA7VORM1",19,0)
 I '$P(LA76248(0),"^",3) D EXIT Q  ; not active
"RTN","LA7VORM1",20,0)
 ;
"RTN","LA7VORM1",21,0)
 S LA7V("INST")=$P(LA7629(0),U,11)
"RTN","LA7VORM1",22,0)
 Q:LA7V("INST")=$P(LA7629(0),U,6)  ;Same system shipment
"RTN","LA7VORM1",23,0)
 ;
"RTN","LA7VORM1",24,0)
 S LA7NVAF=$$NVAF^LA7VHLU2(+LA7V("INST")),SITE=""
"RTN","LA7VORM1",25,0)
 I LA7NVAF=0 S SITE=$$GET1^DIQ(4,+$P(LA7629(0),U,11)_",",99)
"RTN","LA7VORM1",26,0)
 I LA7NVAF=1 S SITE=$$ID^XUAF4("DMIS",+$P(LA7629(0),U,11))
"RTN","LA7VORM1",27,0)
 S LA7V("NON")=$P(LA7629(0),U,12)
"RTN","LA7VORM1",28,0)
 I LA7V("NON")'="" S SITE=LA7V("NON")
"RTN","LA7VORM1",29,0)
 ;
"RTN","LA7VORM1",30,0)
 S LA7X=$$NVAF^LA7VHLU2(+$P(LA7629(0),U,2))
"RTN","LA7VORM1",31,0)
 I LA7X=0 S LA7V("CLNT")=$$GET1^DIQ(4,+$P(LA7629(0),U,2)_",",99)
"RTN","LA7VORM1",32,0)
 I LA7X=1 S LA7V("CLNT")=$$ID^XUAF4("DMIS",+$P(LA7629(0),U,2))
"RTN","LA7VORM1",33,0)
 S $P(LA7V("CLNT"),U,2)=$$GET1^DIQ(4,+$P(LA7629(0),U,2)_",",.01)
"RTN","LA7VORM1",34,0)
 ;
"RTN","LA7VORM1",35,0)
 S LA7X=$$NVAF^LA7VHLU2(+$P(LA7629(0),U,3))
"RTN","LA7VORM1",36,0)
 I LA7X=0 S LA7V("HOST")=$$GET1^DIQ(4,+$P(LA7629(0),U,3)_",",99)
"RTN","LA7VORM1",37,0)
 I LA7X=1 S LA7V("HOST")=$$ID^XUAF4("DMIS",+$P(LA7629(0),U,3))
"RTN","LA7VORM1",38,0)
 S $P(LA7V("HOST"),U,2)=$$GET1^DIQ(4,+$P(LA7629(0),U,3)_",",.01)
"RTN","LA7VORM1",39,0)
 ;
"RTN","LA7VORM1",40,0)
 ; Assuming the receiving institution is the primary site (site with the computer system)
"RTN","LA7VORM1",41,0)
 ;
"RTN","LA7VORM1",42,0)
 ; Sort tests by patient,UID,test - only need to build one PID, PV1 per patient
"RTN","LA7VORM1",43,0)
 ; ^TMP("LA7628",$J, LRDFN, accession UID, ien of shipping manifest specimen entry)
"RTN","LA7VORM1",44,0)
 K ^TMP("LA7628",$J)
"RTN","LA7VORM1",45,0)
 S LA762801=0
"RTN","LA7VORM1",46,0)
 F  S LA762801=$O(^LAHM(62.8,LA7628,10,LA762801)) Q:'LA762801  D
"RTN","LA7VORM1",47,0)
 . S X(0)=$G(^LAHM(62.8,LA7628,10,LA762801,0))
"RTN","LA7VORM1",48,0)
 . I $P(X(0),"^",8)=0 Q  ; Removed from manifest
"RTN","LA7VORM1",49,0)
 . I $P(X(0),"^"),$L($P(X(0),"^",5)) S ^TMP("LA7628",$J,+$P(X(0),"^"),$P(X(0),"^",5),LA762801)=""
"RTN","LA7VORM1",50,0)
 K LA762801
"RTN","LA7VORM1",51,0)
 ;
"RTN","LA7VORM1",52,0)
 ; Nothing to send
"RTN","LA7VORM1",53,0)
 I '$D(^TMP("LA7628",$J)) D EXIT Q
"RTN","LA7VORM1",54,0)
 ;
"RTN","LA7VORM1",55,0)
 ; Set flag = 0 (multiple PID's/message - build one message)
"RTN","LA7VORM1",56,0)
 ;            1 (one PID/message - build multiple messages)
"RTN","LA7VORM1",57,0)
 ;            2 (one ORC/message - build multiple messages)
"RTN","LA7VORM1",58,0)
 S LA7SMSG=+$P(LA76248(0),"^",8)
"RTN","LA7VORM1",59,0)
 ;
"RTN","LA7VORM1",60,0)
 I LA7SMSG=0 D  Q:$G(HL)
"RTN","LA7VORM1",61,0)
 . D STARTMSG
"RTN","LA7VORM1",62,0)
 . I $G(HL) D EXIT
"RTN","LA7VORM1",63,0)
 ;
"RTN","LA7VORM1",64,0)
 S (LRDFN,LRI,LA7PIDSN)=0
"RTN","LA7VORM1",65,0)
 F  S LRDFN=$O(^TMP("LA7628",$J,LRDFN)) Q:'LRDFN  D  Q:$G(HL)
"RTN","LA7VORM1",66,0)
 . N LA7PID,LA7PV1
"RTN","LA7VORM1",67,0)
 . I LA7SMSG=1 D STARTMSG Q:$G(HL)
"RTN","LA7VORM1",68,0)
 . I LA7SMSG<2 D PID,PV1
"RTN","LA7VORM1",69,0)
 . S LA7UID=""
"RTN","LA7VORM1",70,0)
 . F  S LA7UID=$O(^TMP("LA7628",$J,LRDFN,LA7UID)) Q:LA7UID=""  D
"RTN","LA7VORM1",71,0)
 . . N LA76802,LA7ORC,X
"RTN","LA7VORM1",72,0)
 . . S X=$Q(^LRO(68,"C",LA7UID))
"RTN","LA7VORM1",73,0)
 . . I $QS(X,3)'=LA7UID Q
"RTN","LA7VORM1",74,0)
 . . S LRAA=$QS(X,4),LRAD=$QS(X,5),LRAN=$QS(X,6)
"RTN","LA7VORM1",75,0)
 . . F I=0,.3,3 S LA76802(I)=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,I))
"RTN","LA7VORM1",76,0)
 . . S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,5,0))
"RTN","LA7VORM1",77,0)
 . . S LA76802(5)=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,5,I,0))
"RTN","LA7VORM1",78,0)
 . . I LA7SMSG=2 D STARTMSG Q:$G(HL)  D PID,PV1
"RTN","LA7VORM1",79,0)
 . . S (LA7OBRSN,LA762801)=0
"RTN","LA7VORM1",80,0)
 . . F  S LA762801=$O(^TMP("LA7628",$J,LRDFN,LA7UID,LA762801)) Q:'LA762801  D
"RTN","LA7VORM1",81,0)
 . . . N LA7OBR,I
"RTN","LA7VORM1",82,0)
 . . . F I=0,.1,1,2,5 S LA762801(I)=$G(^LAHM(62.8,LA7628,10,LA762801,I))
"RTN","LA7VORM1",83,0)
 . . . I $$CHKTST^LA7SMU(LA7628,LA762801)'=0 Q  ;deleted accession
"RTN","LA7VORM1",84,0)
 . . . D ORC,OBR^LA7VORM3,OBX^LA7VORM3
"RTN","LA7VORM1",85,0)
 . . I LA7SMSG=2 D BLG,SENDMSG
"RTN","LA7VORM1",86,0)
 . I LA7SMSG<2 D BLG
"RTN","LA7VORM1",87,0)
 . I LA7SMSG=1 D SENDMSG
"RTN","LA7VORM1",88,0)
 ;
"RTN","LA7VORM1",89,0)
 I LA7SMSG=0 D SENDMSG
"RTN","LA7VORM1",90,0)
 ;
"RTN","LA7VORM1",91,0)
 ;
"RTN","LA7VORM1",92,0)
EXIT ;
"RTN","LA7VORM1",93,0)
 K @GBL,^TMP("LA7628",$J)
"RTN","LA7VORM1",94,0)
 K DIC,DFN,EID,HL,HLCOMP,HLFS,HLQ,HLSUB,INT
"RTN","LA7VORM1",95,0)
 K LA760,LA7628,LA762801,LA7629
"RTN","LA7VORM1",96,0)
 K LA7ECH,LA7FS,LA7MID,LA7V,LA7HDR,LA7OBRSN,LA7OBXSN,LA7VIEN,LAEVNT
"RTN","LA7VORM1",97,0)
 K LRAA,LRACC,LRAD,LRAN,LRDFN,LRI
"RTN","LA7VORM1",98,0)
 K LTST,NLT,NLTIEN,PCNT,RUID,SNIEN,TIEN,X,Y,LA
"RTN","LA7VORM1",99,0)
 D KVAR^LRX
"RTN","LA7VORM1",100,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","LA7VORM1",101,0)
 Q
"RTN","LA7VORM1",102,0)
 ;
"RTN","LA7VORM1",103,0)
 ;
"RTN","LA7VORM1",104,0)
STARTMSG ; Create/initialize HL message
"RTN","LA7VORM1",105,0)
 ;
"RTN","LA7VORM1",106,0)
 K @GBL
"RTN","LA7VORM1",107,0)
 S (LA76249,LA7PIDSN)=0
"RTN","LA7VORM1",108,0)
 D STARTMSG^LA7VHLU("LA7V Order to "_SITE,.LA76249)
"RTN","LA7VORM1",109,0)
 Q
"RTN","LA7VORM1",110,0)
 ;
"RTN","LA7VORM1",111,0)
 ;
"RTN","LA7VORM1",112,0)
SENDMSG ; File HL7 message with HL and LAB packages.
"RTN","LA7VORM1",113,0)
 ;
"RTN","LA7VORM1",114,0)
 N LA7DATA,LA7ID
"RTN","LA7VORM1",115,0)
 S LA7ID="LA7V HOST "_SITE_"-O-"_$P($G(LA7628(0)),"^")
"RTN","LA7VORM1",116,0)
 ; If no message to send then quit
"RTN","LA7VORM1",117,0)
 I '$D(^TMP("HLS",$J)) D  Q
"RTN","LA7VORM1",118,0)
 . N FDA,LA7ER
"RTN","LA7VORM1",119,0)
 . I $G(LA76248) S FDA(1,62.49,LA76249_",",.5)=LA76248
"RTN","LA7VORM1",120,0)
 . S FDA(1,62.49,LA76249_",",1)="O"
"RTN","LA7VORM1",121,0)
 . S FDA(1,62.49,LA76249_",",2)="E"
"RTN","LA7VORM1",122,0)
 . S FDA(1,62.49,LA76249_",",5)=LA7ID
"RTN","LA7VORM1",123,0)
 . D FILE^DIE("","FDA(1)","LA7ER(1)")
"RTN","LA7VORM1",124,0)
 . D CLEAN^DILF
"RTN","LA7VORM1",125,0)
 . L -^LAHM(62.49,LA76249)
"RTN","LA7VORM1",126,0)
 ;
"RTN","LA7VORM1",127,0)
 D GEN^LA7VHLU
"RTN","LA7VORM1",128,0)
 S LA7DATA="SM06"_"^"_$$NOW^XLFDT
"RTN","LA7VORM1",129,0)
 D SEUP^LA7SMU($P(LA7628(0),"^"),"1",LA7DATA)
"RTN","LA7VORM1",130,0)
 D UPDT6249
"RTN","LA7VORM1",131,0)
 ; Unlock entry
"RTN","LA7VORM1",132,0)
 L -^LAHM(62.49,LA76249)
"RTN","LA7VORM1",133,0)
 Q
"RTN","LA7VORM1",134,0)
 ;
"RTN","LA7VORM1",135,0)
 ;
"RTN","LA7VORM1",136,0)
UPDT6249 ; update entry in 62.49
"RTN","LA7VORM1",137,0)
 ;
"RTN","LA7VORM1",138,0)
 N FDA,LA7ER
"RTN","LA7VORM1",139,0)
 ;
"RTN","LA7VORM1",140,0)
 I $G(LA76248) S FDA(1,62.49,LA76249_",",.5)=LA76248
"RTN","LA7VORM1",141,0)
 S FDA(1,62.49,LA76249_",",1)="O"
"RTN","LA7VORM1",142,0)
 I $P(^LAHM(62.49,LA76249,0),"^",3)'="E" D
"RTN","LA7VORM1",143,0)
 . I $G(HL("APAT"))="AL" S FDA(1,62.49,LA76249_",",2)="A"
"RTN","LA7VORM1",144,0)
 . E  S FDA(1,62.49,LA76249_",",2)="X"
"RTN","LA7VORM1",145,0)
 . I $G(LA7ERR) S FDA(1,62.49,LA76249_",",2)="E"
"RTN","LA7VORM1",146,0)
 S FDA(1,62.49,LA76249_",",5)=LA7ID
"RTN","LA7VORM1",147,0)
 I $G(HL("SAN"))'="" S FDA(1,62.49,LA76249_",",102)=HL("SAN")
"RTN","LA7VORM1",148,0)
 I $G(HL("SAF"))'="" S FDA(1,62.49,LA76249_",",103)=HL("SAF")
"RTN","LA7VORM1",149,0)
 I $G(HL("MTN"))'="" S FDA(1,62.49,LA76249_",",108)=HL("MTN")
"RTN","LA7VORM1",150,0)
 I $G(HL("PID"))'="" S FDA(1,62.49,LA76249_",",110)=HL("PID")
"RTN","LA7VORM1",151,0)
 I $G(HL("VER"))'="" S FDA(1,62.49,LA76249_",",111)=HL("VER")
"RTN","LA7VORM1",152,0)
 I $P($G(LA7MID),"^")'="" S FDA(1,62.49,LA76249_",",109)=$P(LA7MID,"^")
"RTN","LA7VORM1",153,0)
 I $P($G(LA7MID),"^",2) D
"RTN","LA7VORM1",154,0)
 . S FDA(1,62.49,LA76249_",",160)=$P(LA7MID,"^",2)
"RTN","LA7VORM1",155,0)
 . S FDA(1,62.49,LA76249_",",161)=$P(LA7MID,"^",3)
"RTN","LA7VORM1",156,0)
 D FILE^DIE("","FDA(1)","LA7ER(1)")
"RTN","LA7VORM1",157,0)
 D CLEAN^DILF
"RTN","LA7VORM1",158,0)
 Q
"RTN","LA7VORM1",159,0)
 ;
"RTN","LA7VORM1",160,0)
 ;
"RTN","LA7VORM1",161,0)
PID ; Patient identification
"RTN","LA7VORM1",162,0)
 S LRDPF=$P(^LR(LRDFN,0),"^",2),DFN=$P(^(0),"^",3)
"RTN","LA7VORM1",163,0)
 D DEM^LRX
"RTN","LA7VORM1",164,0)
 D PID^LA7VPID(LRDFN,"",.LA7PID,.LA7PIDSN,.HL,"")
"RTN","LA7VORM1",165,0)
 ; DoD/CHCS facilities only use 1st repetition of PID-3.
"RTN","LA7VORM1",166,0)
 I LA7NVAF=1 D
"RTN","LA7VORM1",167,0)
 . S X=$P(LA7PID(0),LA7FS,4),X=$P(X,$E(LA7ECH,2))
"RTN","LA7VORM1",168,0)
 . S $P(LA7PID(0),LA7FS,4)=X
"RTN","LA7VORM1",169,0)
 D FILESEG^LA7VHLU(GBL,.LA7PID)
"RTN","LA7VORM1",170,0)
 D FILE6249^LA7VHLU(LA76249,.LA7PID)
"RTN","LA7VORM1",171,0)
 Q
"RTN","LA7VORM1",172,0)
 ;
"RTN","LA7VORM1",173,0)
 ;
"RTN","LA7VORM1",174,0)
PV1 ; Location information
"RTN","LA7VORM1",175,0)
 ; DoD/CHCS facilities do not use PV1 segment
"RTN","LA7VORM1",176,0)
 I LA7NVAF=1 Q
"RTN","LA7VORM1",177,0)
 ;
"RTN","LA7VORM1",178,0)
 D PV1^LA7VPID(LRDFN,.LA7PV1,LA7FS,LA7ECH)
"RTN","LA7VORM1",179,0)
 D FILESEG^LA7VHLU(GBL,.LA7PV1)
"RTN","LA7VORM1",180,0)
 D FILE6249^LA7VHLU(LA76249,.LA7PV1)
"RTN","LA7VORM1",181,0)
 Q
"RTN","LA7VORM1",182,0)
 ;
"RTN","LA7VORM1",183,0)
 ;
"RTN","LA7VORM1",184,0)
ORC ;Order Control
"RTN","LA7VORM1",185,0)
 ;
"RTN","LA7VORM1",186,0)
 N ORC,LA7DATA,LA7DUR,LA7DURU,LA76205,LA762801,LA7X
"RTN","LA7VORM1",187,0)
 ;
"RTN","LA7VORM1",188,0)
 S ORC(0)="ORC"
"RTN","LA7VORM1",189,0)
 S ORC(1)=$$ORC1^LA7VORC("NW")
"RTN","LA7VORM1",190,0)
 ;
"RTN","LA7VORM1",191,0)
 ; Place order number - accession UID
"RTN","LA7VORM1",192,0)
 S ORC(2)=$$ORC2^LA7VORC($P(LA76802(.3),"^"),LA7FS,LA7ECH)
"RTN","LA7VORM1",193,0)
 ;
"RTN","LA7VORM1",194,0)
 ; Placer group number - shipping manifest invoice #
"RTN","LA7VORM1",195,0)
 S ORC(4)=$$ORC4^LA7VORC($P(LA7628(0),"^"),LA7FS,LA7ECH)
"RTN","LA7VORM1",196,0)
 ;
"RTN","LA7VORM1",197,0)
 ; Quantity/Timing
"RTN","LA7VORM1",198,0)
 S (LA76205,LA7DUR,LA7DURU)=""
"RTN","LA7VORM1",199,0)
 S LA762801=0
"RTN","LA7VORM1",200,0)
 F  S LA762801=$O(^TMP("LA7628",$J,LRDFN,LA7UID,LA762801)) Q:'LA762801  D
"RTN","LA7VORM1",201,0)
 . N I,LA760
"RTN","LA7VORM1",202,0)
 . ; Test duration
"RTN","LA7VORM1",203,0)
 . F I=0,2 S LA762801(I)=$G(^LAHM(62.8,LA7628,10,LA762801,I))
"RTN","LA7VORM1",204,0)
 . I $P(LA762801(2),"^",4) D
"RTN","LA7VORM1",205,0)
 . . S LA7DUR=$P(LA762801(2),"^",6) ; collection duration
"RTN","LA7VORM1",206,0)
 . . S LA7DURU=$P(LA762801(2),"^",7) ; duration units
"RTN","LA7VORM1",207,0)
 . ; Test urgency - find highest urgency on accession
"RTN","LA7VORM1",208,0)
 . S LA760=+$P(LA762801(0),"^",2)
"RTN","LA7VORM1",209,0)
 . S X=+$$GET1^DIQ(68.04,LA760_","_LRAN_","_LRAD_","_LRAA_",",1,"I")
"RTN","LA7VORM1",210,0)
 . I 'LA76205 S LA76205=X
"RTN","LA7VORM1",211,0)
 . I LA76205,X<LA76205 S LA76205=X
"RTN","LA7VORM1",212,0)
 S ORC(7)=$$ORC7^LA7VORC(LA7DUR,LA7DURU,LA76205,LA7FS,LA7ECH)
"RTN","LA7VORM1",213,0)
 ;
"RTN","LA7VORM1",214,0)
 ; Order Date/Time - if no order date/time then try draw time
"RTN","LA7VORM1",215,0)
 I $P(LA76802(0),"^",4) S ORC(9)=$$ORC9^LA7VORC($P(LA76802(0),"^",4))
"RTN","LA7VORM1",216,0)
 I '$P(LA76802(0),"^",4),$P(LA76802(3),"^") S ORC(9)=$$ORC9^LA7VORC($P(LA76802(3),"^"))
"RTN","LA7VORM1",217,0)
 ;
"RTN","LA7VORM1",218,0)
 ; Ordering provider
"RTN","LA7VORM1",219,0)
 S LA7X=$$FNDOLOC^LA7VHLU2(LA7UID)
"RTN","LA7VORM1",220,0)
 S ORC(12)=$$ORC12^LA7VORC($P(LA76802(0),"^",8),$P(LA7X,"^",3),LA7FS,LA7ECH)
"RTN","LA7VORM1",221,0)
 ;
"RTN","LA7VORM1",222,0)
 ; Entering organization - VA facility
"RTN","LA7VORM1",223,0)
 S ORC(17)=$$ORC17^LA7VORC($P($G(LA7629(0)),U,2),LA7FS,LA7ECH)
"RTN","LA7VORM1",224,0)
 ;
"RTN","LA7VORM1",225,0)
 D BUILDSEG^LA7VHLU(.ORC,.LA7DATA,LA7FS)
"RTN","LA7VORM1",226,0)
 D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORM1",227,0)
 D FILE6249^LA7VHLU(LA76249,.LA7DATA)
"RTN","LA7VORM1",228,0)
 Q
"RTN","LA7VORM1",229,0)
 ;
"RTN","LA7VORM1",230,0)
 ;
"RTN","LA7VORM1",231,0)
BLG ; Billing segment
"RTN","LA7VORM1",232,0)
 ;
"RTN","LA7VORM1",233,0)
 N LA7BLG
"RTN","LA7VORM1",234,0)
 ;
"RTN","LA7VORM1",235,0)
 I $P(LA7629(0),U,13)="" Q
"RTN","LA7VORM1",236,0)
 S LA7BLG(0)=$$BLG^LA7VHLU($P(LA7629(0),"^",13),"CO",LA7FS,LA7ECH)
"RTN","LA7VORM1",237,0)
 D FILESEG^LA7VHLU(GBL,.LA7BLG)
"RTN","LA7VORM1",238,0)
 D FILE6249^LA7VHLU(LA76249,.LA7BLG)
"RTN","LA7VORM1",239,0)
 Q
"RTN","LA7VORM3")
0^21^B19868669
"RTN","LA7VORM3",1,0)
LA7VORM3 ;DALOI/JMC - LAB ORM (Order) message builder cont'd ; 11-21-986
"RTN","LA7VORM3",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VORM3",3,0)
 ;
"RTN","LA7VORM3",4,0)
 ;
"RTN","LA7VORM3",5,0)
OBR ;Observation Request segment for Lab Order
"RTN","LA7VORM3",6,0)
 N LA760,LA764,LA7ALT,LA7DATA,LA7DUR,LA7DURU,LA7NLT,LA7X,LA7Y,LRACC,OBR,SPC
"RTN","LA7VORM3",7,0)
 ;
"RTN","LA7VORM3",8,0)
 S LA760=+$P(LA762801(0),"^",2)
"RTN","LA7VORM3",9,0)
 S LA764=+$P($G(^LAB(60,LA760,64)),"^")
"RTN","LA7VORM3",10,0)
 S LA7NLT=$P($G(^LAM(LA764,0)),"^",2)
"RTN","LA7VORM3",11,0)
 ;
"RTN","LA7VORM3",12,0)
 S OBR(0)="OBR"
"RTN","LA7VORM3",13,0)
 S OBR(1)=$$OBR1^LA7VOBR(.LA7OBRSN) ;initialize OBR segment
"RTN","LA7VORM3",14,0)
 ;
"RTN","LA7VORM3",15,0)
 ; Remote UID
"RTN","LA7VORM3",16,0)
 S OBR(2)=$$OBR2^LA7VOBR(LA7UID,LA7FS,LA7ECH)
"RTN","LA7VORM3",17,0)
 ;
"RTN","LA7VORM3",18,0)
 ; Universal service ID - check for non-VA code system
"RTN","LA7VORM3",19,0)
 S LA7X=""
"RTN","LA7VORM3",20,0)
 I $P(LA762801(5),"^")]"" S LA7X=$P(LA762801(5),"^",1)_"^"_$P(LA762801(5),"^",2)_"^"_$P(LA762801(5),"^",5)
"RTN","LA7VORM3",21,0)
 S OBR(4)=$$OBR4^LA7VOBR(LA7NLT,LA760,LA7X,LA7FS,LA7ECH)
"RTN","LA7VORM3",22,0)
 ;
"RTN","LA7VORM3",23,0)
 ; Collection date/time
"RTN","LA7VORM3",24,0)
 S OBR(7)=$$OBR7^LA7VOBR($P(LA76802(3),"^"))
"RTN","LA7VORM3",25,0)
 ;
"RTN","LA7VORM3",26,0)
 ; Collection end date/time
"RTN","LA7VORM3",27,0)
 I $P(LA762801(2),U,4)=1 D
"RTN","LA7VORM3",28,0)
 . S OBR(8)=$$OBR8^LA7VOBR($P(LA762801(2),U,5))
"RTN","LA7VORM3",29,0)
 ;
"RTN","LA7VORM3",30,0)
 ; Collection volume
"RTN","LA7VORM3",31,0)
 I $P(LA762801(2),U)=1 D
"RTN","LA7VORM3",32,0)
 . S OBR(9)=$$OBR9^LA7VOBR($P(LA762801(2),"^",2),$P(LA762801(2),"^",3),LA7FS,LA7ECH)
"RTN","LA7VORM3",33,0)
 ;
"RTN","LA7VORM3",34,0)
 ; Specimen action code
"RTN","LA7VORM3",35,0)
 S OBR(11)=$$OBR11^LA7VOBR("P")
"RTN","LA7VORM3",36,0)
 ;
"RTN","LA7VORM3",37,0)
 ; Infection warning - patient info
"RTN","LA7VORM3",38,0)
 S OBR(12)=$$OBR12^LA7VOBR(LRDFN,LA7FS,LA7ECH)
"RTN","LA7VORM3",39,0)
 ;
"RTN","LA7VORM3",40,0)
 ; Revelant clinical information
"RTN","LA7VORM3",41,0)
 I LA762801(.1)'="" S OBR(13)=$$OBR13^LA7VOBR(LA762801(.1),LA7FS,LA7ECH)
"RTN","LA7VORM3",42,0)
 ;
"RTN","LA7VORM3",43,0)
 ; Lab Arrival Time
"RTN","LA7VORM3",44,0)
 S OBR(14)=$$OBR14^LA7VOBR($P(LA76802(3),"^",3))
"RTN","LA7VORM3",45,0)
 ;
"RTN","LA7VORM3",46,0)
 ; Specimen source - handle non-HL7 coding system
"RTN","LA7VORM3",47,0)
 S LA7X=""
"RTN","LA7VORM3",48,0)
 I $P(LA762801(5),"^",3)'="" D
"RTN","LA7VORM3",49,0)
 . F I=3,4 S $P(LA7X,"^",I-2)=$P(LA762801(5),"^",I)
"RTN","LA7VORM3",50,0)
 . S $P(LA7X,"^",3)=$P(LA762801(5),"^",6)
"RTN","LA7VORM3",51,0)
 I $P(LA762801(5),"^",7)'="" F I=7,8,9 S $P(LA7X,"^",I-2)=$P(LA762801(5),"^",I)
"RTN","LA7VORM3",52,0)
 S OBR(15)=$$OBR15^LA7VOBR(+$P(LA762801(0),"^",3),+$P(LA76802(5),"^",2),LA7X,LA7FS,LA7ECH,$P(LA762801(0),"^",7))
"RTN","LA7VORM3",53,0)
 ;
"RTN","LA7VORM3",54,0)
 ; Ordering provider
"RTN","LA7VORM3",55,0)
 K LA7X
"RTN","LA7VORM3",56,0)
 S LA7X=$$FNDOLOC^LA7VHLU2(LA7UID)
"RTN","LA7VORM3",57,0)
 S OBR(16)=$$ORC12^LA7VORC($P(LA76802(0),"^",8),$P(LA7X,"^",3),LA7FS,LA7ECH)
"RTN","LA7VORM3",58,0)
 ;
"RTN","LA7VORM3",59,0)
 ; Placer's field #1 (HOST site)
"RTN","LA7VORM3",60,0)
 S OBR(18)="LA7V HOST "_SITE
"RTN","LA7VORM3",61,0)
 ;
"RTN","LA7VORM3",62,0)
 ; Placer's field #2
"RTN","LA7VORM3",63,0)
 K LA7X
"RTN","LA7VORM3",64,0)
 S LA7X(3)=LRAA,LA7X(4)=LRAD,LA7X(5)=LRAN,LA7X(6)=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,.2),U),LA7X(7)=LA7UID
"RTN","LA7VORM3",65,0)
 S OBR(19)=$$OBR19^LA7VOBR(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORM3",66,0)
 ;
"RTN","LA7VORM3",67,0)
 ; Test duration
"RTN","LA7VORM3",68,0)
 S (LA7DUR,LA7DURU)=""
"RTN","LA7VORM3",69,0)
 I $P(LA762801(2),"^",4) D
"RTN","LA7VORM3",70,0)
 . S LA7DUR=$P(LA762801(2),"^",6) ; collection duration
"RTN","LA7VORM3",71,0)
 . S LA7DURU=$P(LA762801(2),"^",7) ; duration units
"RTN","LA7VORM3",72,0)
 ;
"RTN","LA7VORM3",73,0)
 ; Test urgency
"RTN","LA7VORM3",74,0)
 S LA76205=+$$GET1^DIQ(68.04,LA760_","_LRAN_","_LRAD_","_LRAA_",",1,"I")
"RTN","LA7VORM3",75,0)
 S OBR(27)=$$OBR27^LA7VOBR(LA7DUR,LA7DURU,LA76205,LA7FS,LA7ECH)
"RTN","LA7VORM3",76,0)
 ;
"RTN","LA7VORM3",77,0)
 ; If sending to another VA then build OBR-34
"RTN","LA7VORM3",78,0)
 I 'LA7NVAF S $P(OBR(34),HLCOMP,7)=$P($G(LA7V("HOST")),U)
"RTN","LA7VORM3",79,0)
 ;
"RTN","LA7VORM3",80,0)
 D BUILDSEG^LA7VHLU(.OBR,.LA7DATA,LA7FS)
"RTN","LA7VORM3",81,0)
 D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORM3",82,0)
 D FILE6249^LA7VHLU(LA76249,.LA7DATA)
"RTN","LA7VORM3",83,0)
 Q
"RTN","LA7VORM3",84,0)
 ;
"RTN","LA7VORM3",85,0)
OBX ; Build OBX segments with required info if any.
"RTN","LA7VORM3",86,0)
 ;
"RTN","LA7VORM3",87,0)
 N LA74,LA7DUR,LA7DURU
"RTN","LA7VORM3",88,0)
 ;
"RTN","LA7VORM3",89,0)
 ; Collecting facility
"RTN","LA7VORM3",90,0)
 S LA74=$P(LA7629(0),"^",2)
"RTN","LA7VORM3",91,0)
 S LA7OBXSN=0
"RTN","LA7VORM3",92,0)
 ;
"RTN","LA7VORM3",93,0)
 ; Patient height
"RTN","LA7VORM3",94,0)
 I $P(LA762801(1),"^") D PTHT^LA7VORM2($P(LA762801(1),"^",2),$P(LA762801(1),"^",3),$P(LA762801(1),"^",7),LA74,.LA7OBXSN,.LRI,LA7FS,LA7ECH,LA76249)
"RTN","LA7VORM3",95,0)
 ;
"RTN","LA7VORM3",96,0)
 ; Patient weight
"RTN","LA7VORM3",97,0)
 I $P(LA762801(1),"^",4) D PTWT^LA7VORM2($P(LA762801(1),"^",5),$P(LA762801(1),"^",6),$P(LA762801(1),"^",8),LA74,.LA7OBXSN,.LRI,LA7FS,LA7ECH,LA76249)
"RTN","LA7VORM3",98,0)
 ;
"RTN","LA7VORM3",99,0)
 ; Collection duration
"RTN","LA7VORM3",100,0)
 S (LA7DUR,LA7DURU)=""
"RTN","LA7VORM3",101,0)
 I $P(LA762801(2),"^",4) D
"RTN","LA7VORM3",102,0)
 . S LA7DUR=$P(LA762801(2),"^",6) ; collection duration
"RTN","LA7VORM3",103,0)
 . S LA7DURU=$P(LA762801(2),"^",7) ; duration units
"RTN","LA7VORM3",104,0)
 . D SPDUR^LA7VORM2($P(LA762801(2),"^",6),$P(LA762801(2),"^",7),$P(LA762801(2),"^",12),LA74,.LA7OBXSN,.LRI,LA7FS,LA7ECH,LA76249)
"RTN","LA7VORM3",105,0)
 ;
"RTN","LA7VORM3",106,0)
 ; Collection volume
"RTN","LA7VORM3",107,0)
 I $P(LA762801(2),"^",2) D
"RTN","LA7VORM3",108,0)
 . D SPCV^LA7VORM2($P(LA762801(2),"^",2),$P(LA762801(2),"^",3),$P(LA762801(2),"^",11),LA74,.LA7OBXSN,.LRI,LA7FS,LA7ECH,LA76249)
"RTN","LA7VORM3",109,0)
 ;
"RTN","LA7VORM3",110,0)
 ; Specimen weight
"RTN","LA7VORM3",111,0)
 I $P(LA762801(2),"^",8) D SPWT^LA7VORM2($P(LA762801(2),"^",9),$P(LA762801(2),"^",10),LA7DUR_LA7DURU,$P(LA762801(2),"^",13),LA74,.LA7OBXSN,.LRI,LA7FS,LA7ECH,LA76249)
"RTN","LA7VORM3",112,0)
 ;
"RTN","LA7VORM3",113,0)
 ; Check for anatomic/surigal path subscripts
"RTN","LA7VORM3",114,0)
 I "SP^CY^AU^EM"[$P($G(^LRO(68,LRAA,0)),"^",2) D AP
"RTN","LA7VORM3",115,0)
 ;
"RTN","LA7VORM3",116,0)
 Q
"RTN","LA7VORM3",117,0)
 ;
"RTN","LA7VORM3",118,0)
 ;
"RTN","LA7VORM3",119,0)
AP ; Observation/Result segment for Lab AP Results sent with Order Message
"RTN","LA7VORM3",120,0)
 ;
"RTN","LA7VORM3",121,0)
 N LA7DATA,LA7IDT,LRIDT,LRSB,LRSS
"RTN","LA7VORM3",122,0)
 ;
"RTN","LA7VORM3",123,0)
 S LRSS=$P($G(^LRO(68,LRAA,0)),"^",2)
"RTN","LA7VORM3",124,0)
 S (LA7IDT,LRIDT)=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),"^",5)
"RTN","LA7VORM3",125,0)
 D APORM^LA7VORU2
"RTN","LA7VORM3",126,0)
 Q
"RTN","LA7VORU")
0^22^B57638796
"RTN","LA7VORU",1,0)
LA7VORU ;DALOI/JMC - Builder of HL7 Lab Results OBR/OBX/NTE ; 12/3/1997
"RTN","LA7VORU",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,46,61,64**;Sep 27, 1994
"RTN","LA7VORU",3,0)
 ;
"RTN","LA7VORU",4,0)
EN(LA) ; called from IN^LA7VMSG(...)
"RTN","LA7VORU",5,0)
 ; variables
"RTN","LA7VORU",6,0)
 ; LA("HUID") - Host Unique ID from the local ACCESSION file (#68)
"RTN","LA7VORU",7,0)
 ; LA("SITE") - Ordering site IEN in the INSTITUTION file (#4)
"RTN","LA7VORU",8,0)
 ; LA("RUID") - Remote sites Unique ID from ACCESSION file (#68)
"RTN","LA7VORU",9,0)
 ; LA("ORD") - Free text ordered test name from WKLD CODE file (#64)
"RTN","LA7VORU",10,0)
 ; LA("NLT") - National Laboratory test code from WKLD CODE file (#64)
"RTN","LA7VORU",11,0)
 ; LA("LRIDT") - Inverse date/time the lab arrival time (accession date/time)
"RTN","LA7VORU",12,0)
 ; LA("SUB") - test subscript defined in LABORATORY TEST file (#60)
"RTN","LA7VORU",13,0)
 ; LA("LRDFN") - IEN in LAB DATA file (#63)
"RTN","LA7VORU",14,0)
 ; LA("ORD"), LA("NLT"), and LA("SUB") are sent for specific lab results.
"RTN","LA7VORU",15,0)
 ; LA("AUTO-INST") - Auto-Instrument
"RTN","LA7VORU",16,0)
 ;
"RTN","LA7VORU",17,0)
 N LA763,LA7NLT,LA7NVAF,LA7X,PRIMARY
"RTN","LA7VORU",18,0)
 ;
"RTN","LA7VORU",19,0)
 S PRIMARY=$$PRIM^VASITE(DT),LA("AUTO-INST")=""
"RTN","LA7VORU",20,0)
 I $G(PRIMARY)'="" D
"RTN","LA7VORU",21,0)
 . S PRIMARY=$$SITE^VASITE(DT,PRIMARY)
"RTN","LA7VORU",22,0)
 . S PRIMARY=$P(PRIMARY,U,3)
"RTN","LA7VORU",23,0)
 . S LA("AUTO-INST")="LA7V HOST "_PRIMARY
"RTN","LA7VORU",24,0)
 ;
"RTN","LA7VORU",25,0)
 I '$O(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),0)) D  Q
"RTN","LA7VORU",26,0)
 . ; need to add error logging when no entry in 63.
"RTN","LA7VORU",27,0)
 ;
"RTN","LA7VORU",28,0)
 ; Get zeroth node of entry in #63.
"RTN","LA7VORU",29,0)
 S LA763(0)=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),0))
"RTN","LA7VORU",30,0)
 S LA7NLT=$G(LA("NLT"))
"RTN","LA7VORU",31,0)
 ;
"RTN","LA7VORU",32,0)
 S LA7NVAF=$$NVAF^LA7VHLU2(+LA("SITE"))
"RTN","LA7VORU",33,0)
 S LA7NTESN=0
"RTN","LA7VORU",34,0)
 D ORC
"RTN","LA7VORU",35,0)
 ;
"RTN","LA7VORU",36,0)
 I $G(LA("SUB"))="CH" D CH
"RTN","LA7VORU",37,0)
 I $G(LA("SUB"))="MI" D MI^LA7VORU1
"RTN","LA7VORU",38,0)
 I "SPCYEM"[$G(LA("SUB")) D AP^LA7VORU2
"RTN","LA7VORU",39,0)
 Q
"RTN","LA7VORU",40,0)
 ;
"RTN","LA7VORU",41,0)
 ;
"RTN","LA7VORU",42,0)
CH ; Build segments for "CH" subscript
"RTN","LA7VORU",43,0)
 ;
"RTN","LA7VORU",44,0)
 D OBR
"RTN","LA7VORU",45,0)
 D NTE
"RTN","LA7VORU",46,0)
 S LA7OBXSN=0
"RTN","LA7VORU",47,0)
 D OBX
"RTN","LA7VORU",48,0)
 ;
"RTN","LA7VORU",49,0)
 Q
"RTN","LA7VORU",50,0)
 ;
"RTN","LA7VORU",51,0)
 ;
"RTN","LA7VORU",52,0)
ORC ; Build ORC segment
"RTN","LA7VORU",53,0)
 ;
"RTN","LA7VORU",54,0)
 N LA763,LA7696,LA7DATA,LA7SM,LA7X,LA7Y,ORC
"RTN","LA7VORU",55,0)
 ;
"RTN","LA7VORU",56,0)
 S LA763(0)=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),0))
"RTN","LA7VORU",57,0)
 ;
"RTN","LA7VORU",58,0)
 S ORC(0)="ORC"
"RTN","LA7VORU",59,0)
 ;
"RTN","LA7VORU",60,0)
 ; Order control
"RTN","LA7VORU",61,0)
 S ORC(1)=$$ORC1^LA7VORC("RE")
"RTN","LA7VORU",62,0)
 ;
"RTN","LA7VORU",63,0)
 ; Remote UID
"RTN","LA7VORU",64,0)
 S ORC(2)=$$ORC2^LA7VORC(LA("RUID"),LA7FS,LA7ECH)
"RTN","LA7VORU",65,0)
 ;
"RTN","LA7VORU",66,0)
 ; Host UID
"RTN","LA7VORU",67,0)
 S ORC(3)=$$ORC3^LA7VORC(LA("HUID"),LA7FS,LA7ECH)
"RTN","LA7VORU",68,0)
 ;
"RTN","LA7VORU",69,0)
 ; Return shipping manifest if found
"RTN","LA7VORU",70,0)
 S LA7SM="",LA7696=0
"RTN","LA7VORU",71,0)
 I LA("SITE")'="",LA("RUID")'="" S LA7696=$O(^LRO(69.6,"RST",LA("SITE"),LA("RUID"),0))
"RTN","LA7VORU",72,0)
 I LA7696 S LA7SM=$P($G(^LRO(69.6,LA7696,0)),U,14)
"RTN","LA7VORU",73,0)
 I LA7SM'="" S ORC(4)=$$ORC4^LA7VORC(LA7SM,LA7FS,LA7ECH)
"RTN","LA7VORU",74,0)
 ;
"RTN","LA7VORU",75,0)
 ; Order status
"RTN","LA7VORU",76,0)
 ; DoD/CHCS rquires ORC-5 valued otherwise will not process message
"RTN","LA7VORU",77,0)
 I LA7NVAF=1 S ORC(5)=$$ORC5^LA7VORC("CM",LA7FS,LA7ECH)
"RTN","LA7VORU",78,0)
 ;
"RTN","LA7VORU",79,0)
 ; Ordering provider
"RTN","LA7VORU",80,0)
 S (LA7X,LA7Y)=""
"RTN","LA7VORU",81,0)
 ; "CH" subscript stores requesting provider and requesting div/location.
"RTN","LA7VORU",82,0)
 I LA("SUB")="CH" D
"RTN","LA7VORU",83,0)
 . N LA7J
"RTN","LA7VORU",84,0)
 . S LA7J=$P(LA763(0),"^",13)
"RTN","LA7VORU",85,0)
 . I $P(LA7J,";",2)="SC(" S LA7Y=$$GET1^DIQ(44,$P(LA7J,";")_",",3,"I")
"RTN","LA7VORU",86,0)
 . I $P(LA7J,";",2)="DIC(4," S LA7Y=$P(LA7J,";")
"RTN","LA7VORU",87,0)
 . S LA7X=$P(LA763(0),"^",10)
"RTN","LA7VORU",88,0)
 ;
"RTN","LA7VORU",89,0)
 ; Other subscripts only store requesting provider
"RTN","LA7VORU",90,0)
 I "CYEMMISP"[LA("SUB") S LA7X=$P(LA763(0),"^",7)
"RTN","LA7VORU",91,0)
 ; Get default institution from MailMan Site Parameters file
"RTN","LA7VORU",92,0)
 I LA7Y="" S LA7Y=$$GET1^DIQ(4.3,"1,",217,"I")
"RTN","LA7VORU",93,0)
 S ORC(12)=$$ORC12^LA7VORC(LA7X,LA7Y,LA7FS,LA7ECH)
"RTN","LA7VORU",94,0)
 ;
"RTN","LA7VORU",95,0)
 ; Entering organization
"RTN","LA7VORU",96,0)
 S ORC(17)=$$ORC17^LA7VORC(LA7Y,LA7FS,LA7ECH)
"RTN","LA7VORU",97,0)
 ;
"RTN","LA7VORU",98,0)
 D BUILDSEG^LA7VHLU(.ORC,.LA7DATA,LA7FS)
"RTN","LA7VORU",99,0)
 D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORU",100,0)
 ;
"RTN","LA7VORU",101,0)
 ; Check for flag to only build message but do not file
"RTN","LA7VORU",102,0)
 I '$G(LA7NOMSG) D FILE6249^LA7VHLU(LA76249P,.LA7DATA)
"RTN","LA7VORU",103,0)
 ;
"RTN","LA7VORU",104,0)
 Q
"RTN","LA7VORU",105,0)
 ;
"RTN","LA7VORU",106,0)
 ;
"RTN","LA7VORU",107,0)
OBR ;Observation Request segment for Lab Order
"RTN","LA7VORU",108,0)
 ;
"RTN","LA7VORU",109,0)
 N LA761,LA762,LA7DATA,LA7PLOBR,LA7X,LA7Y,OBR
"RTN","LA7VORU",110,0)
 ;
"RTN","LA7VORU",111,0)
 ; Retrieve placer's OBR information stored in #69.6
"RTN","LA7VORU",112,0)
 D RETOBR^LA7VHLU(LA("SITE"),LA("RUID"),LA("NLT"),.LA7PLOBR)
"RTN","LA7VORU",113,0)
 ;
"RTN","LA7VORU",114,0)
 ; Initialize OBR segment
"RTN","LA7VORU",115,0)
 S OBR(0)="OBR"
"RTN","LA7VORU",116,0)
 S OBR(1)=$$OBR1^LA7VOBR(.LA7OBRSN)
"RTN","LA7VORU",117,0)
 ;
"RTN","LA7VORU",118,0)
 ; Remote UID
"RTN","LA7VORU",119,0)
 S OBR(2)=$$OBR2^LA7VOBR(LA("RUID"),LA7FS,LA7ECH)
"RTN","LA7VORU",120,0)
 ;
"RTN","LA7VORU",121,0)
 ; Host UID
"RTN","LA7VORU",122,0)
 S OBR(3)=$$OBR3^LA7VOBR(LA("HUID"),LA7FS,LA7ECH)
"RTN","LA7VORU",123,0)
 ;
"RTN","LA7VORU",124,0)
 ; Universal service ID, build from info stored in #69.6
"RTN","LA7VORU",125,0)
 S LA7X=""
"RTN","LA7VORU",126,0)
 I $G(LA7PLOBR("OBR-4"))'="" S OBR(4)=$$CNVFLD^LA7VHLU3(LA7PLOBR("OBR-4"),LA7PLOBR("ECH"),LA7ECH)
"RTN","LA7VORU",127,0)
 E  S OBR(4)=$$OBR4^LA7VOBR(LA7NLT,"",LA7X,LA7FS,LA7ECH)
"RTN","LA7VORU",128,0)
 ;
"RTN","LA7VORU",129,0)
 ; Collection D/T
"RTN","LA7VORU",130,0)
 S OBR(7)=$$OBR7^LA7VOBR($P(LA763(0),U))
"RTN","LA7VORU",131,0)
 ;
"RTN","LA7VORU",132,0)
 ; Specimen action code
"RTN","LA7VORU",133,0)
 ; If no OBR from PENDING ORDER file (#69.6) then assume added test.
"RTN","LA7VORU",134,0)
 I $G(LA7PLOBR("OBR-4"))="" S OBR(11)=$$OBR11^LA7VOBR("A")
"RTN","LA7VORU",135,0)
 ;
"RTN","LA7VORU",136,0)
 ; Infection Warning
"RTN","LA7VORU",137,0)
 S OBR(12)=$$OBR12^LA7VOBR(LRDFN,LA7FS,LA7ECH)
"RTN","LA7VORU",138,0)
 ;
"RTN","LA7VORU",139,0)
 ; Lab Arrival Time
"RTN","LA7VORU",140,0)
 ; "CH" subscript does not store lab arrival time, use collection time.
"RTN","LA7VORU",141,0)
 ; Other subscripts do store lab arrival time (date/time received).
"RTN","LA7VORU",142,0)
 I "CYEMMISP"[LA("SUB") S OBR(14)=$$OBR14^LA7VOBR($P(LA763(0),"^",10))
"RTN","LA7VORU",143,0)
 I LA("SUB")="CH" S OBR(14)=$$OBR14^LA7VOBR($P(LA763(0),"^"))
"RTN","LA7VORU",144,0)
 ;
"RTN","LA7VORU",145,0)
 ; Specimen source 
"RTN","LA7VORU",146,0)
 S (LA761,LA762)=""
"RTN","LA7VORU",147,0)
 I "CHMI"[LA("SUB") D
"RTN","LA7VORU",148,0)
 . S LA761=$P(LA763(0),U,5)
"RTN","LA7VORU",149,0)
 . I LA761="" D CREATE^LA7LOG(27)
"RTN","LA7VORU",150,0)
 . I LA("SUB")="MI" S LA762=$P(LA763(0),U,11)
"RTN","LA7VORU",151,0)
 S OBR(15)=$$OBR15^LA7VOBR(LA761,LA762,"",LA7FS,LA7ECH)
"RTN","LA7VORU",152,0)
 ;
"RTN","LA7VORU",153,0)
 ; Ordering provider
"RTN","LA7VORU",154,0)
 S (LA7X,LA7Y)=""
"RTN","LA7VORU",155,0)
 ; "CH" subscript stores requesting provider and requesting div/location.
"RTN","LA7VORU",156,0)
 I LA("SUB")="CH" D
"RTN","LA7VORU",157,0)
 . N LA7J
"RTN","LA7VORU",158,0)
 . S LA7J=$P(LA763(0),"^",13)
"RTN","LA7VORU",159,0)
 . I $P(LA7J,";",2)="SC(" S LA7Y=$$GET1^DIQ(44,$P(LA7J,";")_",",3,"I")
"RTN","LA7VORU",160,0)
 . I $P(LA7J,";",2)="DIC(4," S LA7Y=$P(LA7J,";")
"RTN","LA7VORU",161,0)
 . S LA7X=$P(LA763(0),"^",10)
"RTN","LA7VORU",162,0)
 ;
"RTN","LA7VORU",163,0)
 ; Other subscripts only store requesting provider
"RTN","LA7VORU",164,0)
 I "CYEMMISP"[LA("SUB") S LA7X=$P(LA763(0),"^",7)
"RTN","LA7VORU",165,0)
 ; Get default institution from MailMan Site Parameters file
"RTN","LA7VORU",166,0)
 I LA7Y="" S LA7Y=$$GET1^DIQ(4.3,"1,",217,"I")
"RTN","LA7VORU",167,0)
 S OBR(16)=$$ORC12^LA7VORC(LA7X,LA7Y,LA7FS,LA7ECH)
"RTN","LA7VORU",168,0)
 ;
"RTN","LA7VORU",169,0)
 ; Placer Field #1 (remote auto-inst)
"RTN","LA7VORU",170,0)
 ; Build from info stored in #69.6
"RTN","LA7VORU",171,0)
 I $G(LA7PLOBR("OBR-18"))'="" D
"RTN","LA7VORU",172,0)
 . S OBR(18)=$$CHKDATA^LA7VHLU3(LA7PLOBR("OBR-18"),LA7FS_LA7ECH)
"RTN","LA7VORU",173,0)
 ; Else build "auto instrument" if sending to VA facility
"RTN","LA7VORU",174,0)
 I $G(LA7PLOBR("OBR-18"))="",'LA7NVAF D
"RTN","LA7VORU",175,0)
 . N LA7X
"RTN","LA7VORU",176,0)
 . S LA7X(1)=LA("AUTO-INST")
"RTN","LA7VORU",177,0)
 . S OBR(18)=$$OBR18^LA7VOBR(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORU",178,0)
 ;
"RTN","LA7VORU",179,0)
 ; Placer Field #2
"RTN","LA7VORU",180,0)
 I $G(LA7PLOBR("OBR-19"))'="" D
"RTN","LA7VORU",181,0)
 . S OBR(19)=$$CHKDATA^LA7VHLU3(LA7PLOBR("OBR-19"),LA7FS_LA7ECH)
"RTN","LA7VORU",182,0)
 ; Else build collecting UID if sending to VA facility
"RTN","LA7VORU",183,0)
 I $G(LA7PLOBR("OBR-19"))="",'LA7NVAF,LA("RUID")'="" D
"RTN","LA7VORU",184,0)
 . K LA7X
"RTN","LA7VORU",185,0)
 . S LA7X(7)=LA("RUID")
"RTN","LA7VORU",186,0)
 . S OBR(19)=$$OBR19^LA7VOBR(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORU",187,0)
 ;
"RTN","LA7VORU",188,0)
 ; Filler Field #1
"RTN","LA7VORU",189,0)
 ; Send file #63 ien info - used by HDR to track patient/specimen
"RTN","LA7VORU",190,0)
 K LA7X
"RTN","LA7VORU",191,0)
 S LA7X(1)=LA("LRDFN")
"RTN","LA7VORU",192,0)
 S LA7X(2)=LA("SUB")
"RTN","LA7VORU",193,0)
 S LA7X(3)=LA("LRIDT")
"RTN","LA7VORU",194,0)
 S OBR(20)=$$OBR20^LA7VOBR(.LA7X,LA7FS,LA7ECH)
"RTN","LA7VORU",195,0)
 ;
"RTN","LA7VORU",196,0)
 ; Date Report Completed
"RTN","LA7VORU",197,0)
 I $P(LA763(0),"^",3) S OBR(22)=$$OBR22^LA7VOBR($P(LA763(0),"^",3))
"RTN","LA7VORU",198,0)
 ;
"RTN","LA7VORU",199,0)
 ; Diagnostic sevice id
"RTN","LA7VORU",200,0)
 S OBR(24)=$$OBR24^LA7VOBR(LA("SUB")_"^"_$G(LRSB))
"RTN","LA7VORU",201,0)
 ;
"RTN","LA7VORU",202,0)
 ; Parent Result and Parent
"RTN","LA7VORU",203,0)
 I $D(LA7PARNT) D
"RTN","LA7VORU",204,0)
 . S OBR(26)=$$OBR26^LA7VOBR(LA7PARNT(1),LA7PARNT(2),LA7PARNT(3),LA7FS,LA7ECH)
"RTN","LA7VORU",205,0)
 . S OBR(29)=$$OBR29^LA7VOBR(LA("RUID"),LA("HUID"),LA7FS,LA7ECH)
"RTN","LA7VORU",206,0)
 ;
"RTN","LA7VORU",207,0)
 ; Principle result interpreter
"RTN","LA7VORU",208,0)
 ; Get default institution from MailMan Site Parameters file
"RTN","LA7VORU",209,0)
 I "CYEMMISP"[LA("SUB") D
"RTN","LA7VORU",210,0)
 . I LA("SUB")="MI" S LA7X=$P(LA763(0),"^",4)
"RTN","LA7VORU",211,0)
 . E  S LA7X=$P(LA763(0),"^",2)
"RTN","LA7VORU",212,0)
 . S LA7Y=$$GET1^DIQ(4.3,"1,",217,"I")
"RTN","LA7VORU",213,0)
 . S OBR(32)=$$OBR32^LA7VOBR(LA7X,LA7Y,LA7FS,LA7ECH)
"RTN","LA7VORU",214,0)
 ; 
"RTN","LA7VORU",215,0)
 ; Assistant result interpreter
"RTN","LA7VORU",216,0)
 ; Get default institution from MailMan Site Parameters file
"RTN","LA7VORU",217,0)
 I "EMSP"[LA("SUB") D
"RTN","LA7VORU",218,0)
 . S LA7X=$P(LA763(0),"^",4),LA7Y=$$GET1^DIQ(4.3,"1,",217,"I")
"RTN","LA7VORU",219,0)
 . S OBR(33)=$$OBR33^LA7VOBR(LA7X,LA7Y,LA7FS,LA7ECH)
"RTN","LA7VORU",220,0)
 ; 
"RTN","LA7VORU",221,0)
 ; Technician
"RTN","LA7VORU",222,0)
 ; Get default institution from MailMan Site Parameters file
"RTN","LA7VORU",223,0)
 I "CYEM"[LA("SUB") D
"RTN","LA7VORU",224,0)
 . S LA7X=$P(LA763(0),"^",4),LA7Y=$$GET1^DIQ(4.3,"1,",217,"I")
"RTN","LA7VORU",225,0)
 . S OBR(34)=$$OBR34^LA7VOBR(LA7X,LA7Y,LA7FS,LA7ECH)
"RTN","LA7VORU",226,0)
 ; 
"RTN","LA7VORU",227,0)
 ; Typist - VistA stores as free text
"RTN","LA7VORU",228,0)
 ; Get default institution from MailMan Site Parameters file
"RTN","LA7VORU",229,0)
 I "CYEMSP"[LA("SUB") D
"RTN","LA7VORU",230,0)
 . S LA7X=$P(LA763(0),"^",9),LA7Y=$$GET1^DIQ(4.3,"1,",217,"I")
"RTN","LA7VORU",231,0)
 . S OBR(35)=$$OBR35^LA7VOBR(LA7X,LA7Y,LA7FS,LA7ECH)
"RTN","LA7VORU",232,0)
 ; 
"RTN","LA7VORU",233,0)
 D BUILDSEG^LA7VHLU(.OBR,.LA7DATA,LA7FS)
"RTN","LA7VORU",234,0)
 D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORU",235,0)
 ;
"RTN","LA7VORU",236,0)
 ; Check for flag to only build message but do not file
"RTN","LA7VORU",237,0)
 I '$G(LA7NOMSG) D FILE6249^LA7VHLU(LA76249,.LA7DATA)
"RTN","LA7VORU",238,0)
 ;
"RTN","LA7VORU",239,0)
 Q
"RTN","LA7VORU",240,0)
 ;
"RTN","LA7VORU",241,0)
 ;
"RTN","LA7VORU",242,0)
OBX ;Observation/Result segment for Lab Results
"RTN","LA7VORU",243,0)
 ;
"RTN","LA7VORU",244,0)
 N LA7953,LA7DATA,LA7VT,LA7VTIEN,LR,LRNLT,TSTIEN
"RTN","LA7VORU",245,0)
 ;
"RTN","LA7VORU",246,0)
 S LA7VTIEN=0
"RTN","LA7VORU",247,0)
 F  S LA7VTIEN=$O(^LAHM(62.49,LA(62.49),1,LA7VTIEN)) Q:'LA7VTIEN  D
"RTN","LA7VORU",248,0)
 . S LA7VT=$P(^LAHM(62.49,LA(62.49),1,LA7VTIEN,0),"^",1,2)
"RTN","LA7VORU",249,0)
 . ; Build OBX segment
"RTN","LA7VORU",250,0)
 . K LA7DATA
"RTN","LA7VORU",251,0)
 . D OBX^LA7VOBX(LA("LRDFN"),LA("SUB"),LA("LRIDT"),$P(LA7VT,"^",1,2),.LA7DATA,.LA7OBXSN,LA7FS,LA7ECH,$G(LA7NVAF))
"RTN","LA7VORU",252,0)
 . ; If OBX failed to build then don't store
"RTN","LA7VORU",253,0)
 . I '$D(LA7DATA) Q
"RTN","LA7VORU",254,0)
 . ;
"RTN","LA7VORU",255,0)
 . D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORU",256,0)
 . I '$G(LA7NOMSG) D FILE6249^LA7VHLU(LA76249,.LA7DATA)
"RTN","LA7VORU",257,0)
 . ;
"RTN","LA7VORU",258,0)
 . ; Send performing lab comment and interpretation from file #60
"RTN","LA7VORU",259,0)
 . S LA7NTESN=0
"RTN","LA7VORU",260,0)
 . I LA7NVAF=1 D PLC^LA7VORUA
"RTN","LA7VORU",261,0)
 . D INTRP^LA7VORUA
"RTN","LA7VORU",262,0)
 . ;
"RTN","LA7VORU",263,0)
 . ; Mark result as sent - set to 1, if corrected results set to 2
"RTN","LA7VORU",264,0)
 . I LA("SUB")="CH" S $P(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),$P(LA7VT,"^")),"^",10)=$S($P(LA7VT,"^",2)="C":2,1:1)
"RTN","LA7VORU",265,0)
 ;
"RTN","LA7VORU",266,0)
 Q
"RTN","LA7VORU",267,0)
 ;
"RTN","LA7VORU",268,0)
 ;
"RTN","LA7VORU",269,0)
NTE ; Build NTE segment
"RTN","LA7VORU",270,0)
 ;
"RTN","LA7VORU",271,0)
 D NTE^LA7VORUA
"RTN","LA7VORU",272,0)
 Q
"RTN","LA7VORU1")
0^23^B35283793
"RTN","LA7VORU1",1,0)
LA7VORU1 ;DALOI/JMC - Builder of HL7 Lab Results Microbiology OBR/OBX/NTE ; 05/26/00
"RTN","LA7VORU1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VORU1",3,0)
 Q
"RTN","LA7VORU1",4,0)
 ;
"RTN","LA7VORU1",5,0)
 ;
"RTN","LA7VORU1",6,0)
MI ; Build segments for "MI" subscript
"RTN","LA7VORU1",7,0)
 ;
"RTN","LA7VORU1",8,0)
 N LA7ID,LA7IDT,LA7IENS,LA7NLT,LRDFN,LRIDT,LRSB,LRSS
"RTN","LA7VORU1",9,0)
 ;
"RTN","LA7VORU1",10,0)
 S LRDFN=LA("LRDFN"),LRSS=LA("SUB"),(LA7IENS,LRIDT)=LA("LRIDT")
"RTN","LA7VORU1",11,0)
 ;
"RTN","LA7VORU1",12,0)
 ; Bacteriology Report
"RTN","LA7VORU1",13,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,1)) D
"RTN","LA7VORU1",14,0)
 . S LRSB=11,LA7NLT="87993.0000"
"RTN","LA7VORU1",15,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",16,0)
 . D NTE^LA7VORU
"RTN","LA7VORU1",17,0)
 . F LRSB=1,1.5,11 D RPTNTE
"RTN","LA7VORU1",18,0)
 . N LRSB
"RTN","LA7VORU1",19,0)
 . S LA7OBXSN=0
"RTN","LA7VORU1",20,0)
 . ; Report gram stain
"RTN","LA7VORU1",21,0)
 . I $D(^LR(LRDFN,LRSS,LRIDT,2)) D GS
"RTN","LA7VORU1",22,0)
 . ; Check for organism id
"RTN","LA7VORU1",23,0)
 . I '$D(^LR(LRDFN,LRSS,LRIDT,3)) Q
"RTN","LA7VORU1",24,0)
 . S LRSB=12
"RTN","LA7VORU1",25,0)
 . D ORG
"RTN","LA7VORU1",26,0)
 . D MIC
"RTN","LA7VORU1",27,0)
 ;
"RTN","LA7VORU1",28,0)
 ; Parasite report
"RTN","LA7VORU1",29,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,5)) D
"RTN","LA7VORU1",30,0)
 . S LRSB=14,LA7NLT="87505.0000"
"RTN","LA7VORU1",31,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",32,0)
 . D NTE^LA7VORU
"RTN","LA7VORU1",33,0)
 . F LRSB=16.5,16.4,14 D RPTNTE
"RTN","LA7VORU1",34,0)
 . ; Check for organism id
"RTN","LA7VORU1",35,0)
 . I '$D(^LR(LRDFN,LRSS,LRIDT,6)) Q
"RTN","LA7VORU1",36,0)
 . N LRSB
"RTN","LA7VORU1",37,0)
 . S LA7OBXSN=0,LA7IDT=LRIDT,LRSB=16
"RTN","LA7VORU1",38,0)
 . D ORG
"RTN","LA7VORU1",39,0)
 ;
"RTN","LA7VORU1",40,0)
 ; Mycology report
"RTN","LA7VORU1",41,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,8)) D
"RTN","LA7VORU1",42,0)
 . S LRSB=18,LA7NLT="87994.0000"
"RTN","LA7VORU1",43,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",44,0)
 . D NTE^LA7VORU
"RTN","LA7VORU1",45,0)
 . F LRSB=20.5,20.4,18 D RPTNTE
"RTN","LA7VORU1",46,0)
 . ; Check for organism id
"RTN","LA7VORU1",47,0)
 . I '$D(^LR(LRDFN,LRSS,LRIDT,9)) Q
"RTN","LA7VORU1",48,0)
 . N LRSB
"RTN","LA7VORU1",49,0)
 . S LA7OBXSN=0,LA7IDT=LRIDT,LRSB=20
"RTN","LA7VORU1",50,0)
 . D ORG
"RTN","LA7VORU1",51,0)
 ;
"RTN","LA7VORU1",52,0)
 ; Mycobacterium report
"RTN","LA7VORU1",53,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,11)) D
"RTN","LA7VORU1",54,0)
 . S LRSB=22,LA7NLT="87995.0000"
"RTN","LA7VORU1",55,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",56,0)
 . D NTE^LA7VORU
"RTN","LA7VORU1",57,0)
 . F LRSB=26.5,26.4,22 D RPTNTE
"RTN","LA7VORU1",58,0)
 . N LRSB
"RTN","LA7VORU1",59,0)
 . S LA7OBXSN=0,LA7IDT=LRIDT
"RTN","LA7VORU1",60,0)
 . ; Report acid fast stain
"RTN","LA7VORU1",61,0)
 . I $L($P(^LR(LRDFN,LRSS,LRIDT,11),"^",3)) D
"RTN","LA7VORU1",62,0)
 . . S LRSB=24 D OBX
"RTN","LA7VORU1",63,0)
 . . S LRSB=25 D OBX
"RTN","LA7VORU1",64,0)
 . ; Check for organism id
"RTN","LA7VORU1",65,0)
 . I '$D(^LR(LRDFN,LRSS,LRIDT,12)) Q
"RTN","LA7VORU1",66,0)
 . S LRSB=26
"RTN","LA7VORU1",67,0)
 . D ORG
"RTN","LA7VORU1",68,0)
 . D MIC
"RTN","LA7VORU1",69,0)
 ;
"RTN","LA7VORU1",70,0)
 ; Virology report
"RTN","LA7VORU1",71,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,16)) D
"RTN","LA7VORU1",72,0)
 . S LRSB=33,LA7NLT="87996.0000"
"RTN","LA7VORU1",73,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",74,0)
 . D NTE^LA7VORU
"RTN","LA7VORU1",75,0)
 . F LRSB=36.5,36.4,33 D RPTNTE
"RTN","LA7VORU1",76,0)
 . ; Check for virus id
"RTN","LA7VORU1",77,0)
 . I '$D(^LR(LRDFN,LRSS,LRIDT,17)) Q
"RTN","LA7VORU1",78,0)
 . N LRSB
"RTN","LA7VORU1",79,0)
 . S LA7OBXSN=0,LA7IDT=LRIDT,LRSB=36
"RTN","LA7VORU1",80,0)
 . D ORG
"RTN","LA7VORU1",81,0)
 ;
"RTN","LA7VORU1",82,0)
 Q
"RTN","LA7VORU1",83,0)
 ;
"RTN","LA7VORU1",84,0)
 ;
"RTN","LA7VORU1",85,0)
GS ; Report Gram stain
"RTN","LA7VORU1",86,0)
 ;
"RTN","LA7VORU1",87,0)
 N LA7GS
"RTN","LA7VORU1",88,0)
 ;
"RTN","LA7VORU1",89,0)
 S LRSB=11.6,LA7GS=0
"RTN","LA7VORU1",90,0)
 F  S LA7GS=$O(^LR(LRDFN,LRSS,LRIDT,2,LA7GS)) Q:'LA7GS  D
"RTN","LA7VORU1",91,0)
 . S LA7IDT=LRIDT_","_LA7GS
"RTN","LA7VORU1",92,0)
 . D OBX
"RTN","LA7VORU1",93,0)
 Q
"RTN","LA7VORU1",94,0)
 ;
"RTN","LA7VORU1",95,0)
 ;
"RTN","LA7VORU1",96,0)
RPTNTE ; Send report comments
"RTN","LA7VORU1",97,0)
 ;
"RTN","LA7VORU1",98,0)
 N LA7J,LA7ND,LA7SOC,LA7TXT
"RTN","LA7VORU1",99,0)
 ;
"RTN","LA7VORU1",100,0)
 ; Source of comment - handle special codes for other systems, i,e. DOD-CHCS
"RTN","LA7VORU1",101,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"AC",1:"L")
"RTN","LA7VORU1",102,0)
 ;
"RTN","LA7VORU1",103,0)
 ; Bacterial preliminary/report/tests remark
"RTN","LA7VORU1",104,0)
 I LRSB=11 S LA7ND=4
"RTN","LA7VORU1",105,0)
 I LRSB=1 S LA7ND=19
"RTN","LA7VORU1",106,0)
 I LRSB=1.5 S LA7ND=26
"RTN","LA7VORU1",107,0)
 ; Parasite preliminary/report/tests remark
"RTN","LA7VORU1",108,0)
 I LRSB=14 S LA7ND=7
"RTN","LA7VORU1",109,0)
 I LRSB=16.5 S LA7ND=21
"RTN","LA7VORU1",110,0)
 I LRSB=16.4 S LA7ND=27
"RTN","LA7VORU1",111,0)
 ; Fungal preliminary/report/tests remark
"RTN","LA7VORU1",112,0)
 I LRSB=18 S LA7ND=10
"RTN","LA7VORU1",113,0)
 I LRSB=20.5 S LA7ND=22
"RTN","LA7VORU1",114,0)
 I LRSB=20.4 S LA7ND=28
"RTN","LA7VORU1",115,0)
 ; Mycobacteria preliminary/report/tests remark
"RTN","LA7VORU1",116,0)
 I LRSB=22 S LA7ND=13
"RTN","LA7VORU1",117,0)
 I LRSB=26.5 S LA7ND=23
"RTN","LA7VORU1",118,0)
 I LRSB=26.4 S LA7ND=29
"RTN","LA7VORU1",119,0)
 ; Viral preliminary/report/tests remark
"RTN","LA7VORU1",120,0)
 I LRSB=33 S LA7ND=18
"RTN","LA7VORU1",121,0)
 I LRSB=36.5 S LA7ND=20
"RTN","LA7VORU1",122,0)
 I LRSB=36.4 S LA7ND=30
"RTN","LA7VORU1",123,0)
 ;
"RTN","LA7VORU1",124,0)
 S LA7J=0
"RTN","LA7VORU1",125,0)
 F  S LA7J=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7J)) Q:'LA7J  D
"RTN","LA7VORU1",126,0)
 . S LA7TXT=$G(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7J,0))
"RTN","LA7VORU1",127,0)
 . D NTE
"RTN","LA7VORU1",128,0)
 Q
"RTN","LA7VORU1",129,0)
 ;
"RTN","LA7VORU1",130,0)
 ;
"RTN","LA7VORU1",131,0)
ORG ; Build OBR/OBX segments for MI subscript organism id
"RTN","LA7VORU1",132,0)
 ;
"RTN","LA7VORU1",133,0)
 N LA7ND,LA7ORG
"RTN","LA7VORU1",134,0)
 ;
"RTN","LA7VORU1",135,0)
 ; Bacterial organism
"RTN","LA7VORU1",136,0)
 I LRSB=12 S LA7ND=3
"RTN","LA7VORU1",137,0)
 ; Parasite organism
"RTN","LA7VORU1",138,0)
 I LRSB=16 S LA7ND=6
"RTN","LA7VORU1",139,0)
 ; Fungal organism
"RTN","LA7VORU1",140,0)
 I LRSB=20 S LA7ND=9
"RTN","LA7VORU1",141,0)
 ; Mycobacteria organism
"RTN","LA7VORU1",142,0)
 I LRSB=26 S LA7ND=12
"RTN","LA7VORU1",143,0)
 ; Viral agent
"RTN","LA7VORU1",144,0)
 I LRSB=36 S LA7ND=17
"RTN","LA7VORU1",145,0)
 ;
"RTN","LA7VORU1",146,0)
 S LA7ORG=0
"RTN","LA7VORU1",147,0)
 F  S LA7ORG=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG)) Q:'LA7ORG  D
"RTN","LA7VORU1",148,0)
 . S LA7IDT=LRIDT_","_LA7ORG_","
"RTN","LA7VORU1",149,0)
 . D OBX
"RTN","LA7VORU1",150,0)
 . I $L($P($G(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG,0)),"^",2)) D CC
"RTN","LA7VORU1",151,0)
 . I LA7ND=17 Q
"RTN","LA7VORU1",152,0)
 . D ORGNTE
"RTN","LA7VORU1",153,0)
 Q
"RTN","LA7VORU1",154,0)
 ;
"RTN","LA7VORU1",155,0)
 ;
"RTN","LA7VORU1",156,0)
CC ; Send colony count (quantity)
"RTN","LA7VORU1",157,0)
 ;
"RTN","LA7VORU1",158,0)
 N LRSB
"RTN","LA7VORU1",159,0)
 ;
"RTN","LA7VORU1",160,0)
 I LA7ND=3 S LRSB="12,1"
"RTN","LA7VORU1",161,0)
 I LA7ND=9 S LRSB="20,1"
"RTN","LA7VORU1",162,0)
 I LA7ND=12 S LRSB="26,1"
"RTN","LA7VORU1",163,0)
 ;
"RTN","LA7VORU1",164,0)
 D OBX
"RTN","LA7VORU1",165,0)
 ;
"RTN","LA7VORU1",166,0)
 Q
"RTN","LA7VORU1",167,0)
 ;
"RTN","LA7VORU1",168,0)
 ;
"RTN","LA7VORU1",169,0)
ORGNTE ; Send comments on organisms.
"RTN","LA7VORU1",170,0)
 ;
"RTN","LA7VORU1",171,0)
 N LA7J,LA7SOC,LA7NTESN,LA7TXT
"RTN","LA7VORU1",172,0)
 ;
"RTN","LA7VORU1",173,0)
 ; Source of comment - handle special codes for other systems, i,e. DOD-CHCS
"RTN","LA7VORU1",174,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"RC",1:"L")
"RTN","LA7VORU1",175,0)
 ;
"RTN","LA7VORU1",176,0)
 S (LA7J,LA7NTESN)=0
"RTN","LA7VORU1",177,0)
 F  S LA7J=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG,1,LA7J)) Q:'LA7J  D
"RTN","LA7VORU1",178,0)
 . S LA7TXT=$G(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG,1,LA7J,0))
"RTN","LA7VORU1",179,0)
 . D NTE
"RTN","LA7VORU1",180,0)
 Q
"RTN","LA7VORU1",181,0)
 ;
"RTN","LA7VORU1",182,0)
 ;
"RTN","LA7VORU1",183,0)
MIC ; Build OBR/OBX segments for MI subscript susceptibilities(MIC)
"RTN","LA7VORU1",184,0)
 ;
"RTN","LA7VORU1",185,0)
 N LA7ORG,LA7ND,LA7NLT,LA7SB,LA7SB1,LA7SOC
"RTN","LA7VORU1",186,0)
 ;
"RTN","LA7VORU1",187,0)
 ; Source of comment - handle special codes for other systems, i,e. DOD-CHCS
"RTN","LA7VORU1",188,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"RC",1:"L")
"RTN","LA7VORU1",189,0)
 ;
"RTN","LA7VORU1",190,0)
 S (LA7NLT,LA7NLT(1))=""
"RTN","LA7VORU1",191,0)
 I LRSB=12 S LA7ND=3,LA7NLT="87565.0000",LA7NLT(1)="87993.0000"
"RTN","LA7VORU1",192,0)
 I LRSB=26 S LA7ND=12,LA7NLT="87899.0000",LA7NLT(1)="87525.0000"
"RTN","LA7VORU1",193,0)
 ;
"RTN","LA7VORU1",194,0)
 S LA7ORG=0,LA7SB=LRSB
"RTN","LA7VORU1",195,0)
 F  S LA7ORG=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG)) Q:'LA7ORG  D
"RTN","LA7VORU1",196,0)
 . N LA7NTESN,LA7PARNT
"RTN","LA7VORU1",197,0)
 . ; Check for susceptibiliites for this organism
"RTN","LA7VORU1",198,0)
 . S X=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG,2))
"RTN","LA7VORU1",199,0)
 . I X<2!(X>2.99) Q
"RTN","LA7VORU1",200,0)
 . S LA7PARNT=LA7SB_"-"_LA7ORG
"RTN","LA7VORU1",201,0)
 . M LA7PARNT=LA7ID(LA7PARNT)
"RTN","LA7VORU1",202,0)
 . D OBR^LA7VORU
"RTN","LA7VORU1",203,0)
 . S LA7OBXSN=0,LA7SB1=2
"RTN","LA7VORU1",204,0)
 . F  S LA7SB1=$O(^LR(LRDFN,LRSS,LRIDT,LA7ND,LA7ORG,LA7SB1)) Q:'LA7SB1  D
"RTN","LA7VORU1",205,0)
 . . N LRSB
"RTN","LA7VORU1",206,0)
 . . S LA7IDT=LRIDT_","_LA7ORG_","_LA7SB1,LRSB=LA7SB_","_LA7SB1
"RTN","LA7VORU1",207,0)
 . . D OBX
"RTN","LA7VORU1",208,0)
 . . S X=$O(^LAB(62.06,"AD",LA7SB1,0)) Q:'X
"RTN","LA7VORU1",209,0)
 . . S LA7TXT=$P($G(^LAB(62.06,X,0)),"^",3)
"RTN","LA7VORU1",210,0)
 . . I LA7TXT'="" S LA7NTESN=0 D NTE
"RTN","LA7VORU1",211,0)
 Q
"RTN","LA7VORU1",212,0)
 ;
"RTN","LA7VORU1",213,0)
 ;
"RTN","LA7VORU1",214,0)
OBX ; Build OBX segments for MI subscript
"RTN","LA7VORU1",215,0)
 ; Also called by AP^LA7VORU2 to build AP OBX segments.
"RTN","LA7VORU1",216,0)
 ;
"RTN","LA7VORU1",217,0)
 N LA7DATA
"RTN","LA7VORU1",218,0)
 D OBX^LA7VOBX(LRDFN,LRSS,LA7IDT,LRSB,.LA7DATA,.LA7OBXSN,LA7FS,LA7ECH,LA7NVAF)
"RTN","LA7VORU1",219,0)
 ;
"RTN","LA7VORU1",220,0)
 ; If OBX failed to build then don't store
"RTN","LA7VORU1",221,0)
 I '$D(LA7DATA) Q
"RTN","LA7VORU1",222,0)
 ;
"RTN","LA7VORU1",223,0)
 D FILESEG^LA7VHLU(GBL,.LA7DATA)
"RTN","LA7VORU1",224,0)
 ;
"RTN","LA7VORU1",225,0)
 ; Check for flag to only build meesage but do not file
"RTN","LA7VORU1",226,0)
 I '$G(LA7NOMSG) D FILE6249^LA7VHLU(LA76249,.LA7DATA)
"RTN","LA7VORU1",227,0)
 Q
"RTN","LA7VORU1",228,0)
 ;
"RTN","LA7VORU1",229,0)
 ;
"RTN","LA7VORU1",230,0)
NTE ; Build NTE segment with comment
"RTN","LA7VORU1",231,0)
 ;
"RTN","LA7VORU1",232,0)
 N LA7NTE
"RTN","LA7VORU1",233,0)
 ;
"RTN","LA7VORU1",234,0)
 S LA7NTE(0)=$$NTE^LA7VHLU3(LA7TXT,$G(LA7SOC),LA7FS,LA7ECH,.LA7NTESN)
"RTN","LA7VORU1",235,0)
 D FILESEG^LA7VHLU(GBL,.LA7NTE)
"RTN","LA7VORU1",236,0)
 ;
"RTN","LA7VORU1",237,0)
 ; Check for flag to only build meesage but do not file
"RTN","LA7VORU1",238,0)
 I '$G(LA7NOMSG) D FILE6249^LA7VHLU(LA76249,.LA7NTE)
"RTN","LA7VORU1",239,0)
 ;
"RTN","LA7VORU1",240,0)
 Q
"RTN","LA7VORU2")
0^24^B6677596
"RTN","LA7VORU2",1,0)
LA7VORU2 ;DALOI/JMC - LAB ORU (Result) message builder cont'd ; 11-21-986
"RTN","LA7VORU2",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VORU2",3,0)
 ;
"RTN","LA7VORU2",4,0)
AP ; Observation/Result segment for Lab AP Results
"RTN","LA7VORU2",5,0)
 ;
"RTN","LA7VORU2",6,0)
 N LA7DATA,LA7IDT,LRSB,LRSS
"RTN","LA7VORU2",7,0)
 ;
"RTN","LA7VORU2",8,0)
 S LRDFN=LA("LRDFN"),LRSS=LA("SUB"),(LA7IDT,LRIDT)=LA("LRIDT")
"RTN","LA7VORU2",9,0)
 ;
"RTN","LA7VORU2",10,0)
 S (LA7NLT,LA("NLT"))=$P($$DEFCODE^LA7VHLU5(LRSS,.012,"",""),"!")
"RTN","LA7VORU2",11,0)
 D OBR^LA7VORU
"RTN","LA7VORU2",12,0)
 D NTE^LA7VORU
"RTN","LA7VORU2",13,0)
 ;
"RTN","LA7VORU2",14,0)
APORM ; Entry point when building OBX segments for ORM message
"RTN","LA7VORU2",15,0)
 S LA7OBXSN=0
"RTN","LA7VORU2",16,0)
 ;
"RTN","LA7VORU2",17,0)
 ; Surgical pathology (SP) subscript reports
"RTN","LA7VORU2",18,0)
 I LRSS="SP" D SP
"RTN","LA7VORU2",19,0)
 ;
"RTN","LA7VORU2",20,0)
 ; Cytology (CY) subscript reports
"RTN","LA7VORU2",21,0)
 I LRSS="CY" F LRSB=.012,.013,.014,.015,.016,1,1.1,1.2,1.4 D OBX^LA7VORU1
"RTN","LA7VORU2",22,0)
 ;
"RTN","LA7VORU2",23,0)
 ; Cytology (EM) subscript reports
"RTN","LA7VORU2",24,0)
 I LRSS="EM" F LRSB=.012,.013,.014,.015,.016,1.1,1.2,1.4 D OBX^LA7VORU1
"RTN","LA7VORU2",25,0)
 ;
"RTN","LA7VORU2",26,0)
 Q
"RTN","LA7VORU2",27,0)
 ;
"RTN","LA7VORU2",28,0)
 ;
"RTN","LA7VORU2",29,0)
SP ; Process "SP" subscript
"RTN","LA7VORU2",30,0)
 N LA7ORG,LA7P,LA7SR,LA7SS
"RTN","LA7VORU2",31,0)
 ;
"RTN","LA7VORU2",32,0)
 ; Process main report
"RTN","LA7VORU2",33,0)
 I LA7NVAF'=1 F LRSB=.012,.013,.014,.015,.016,1,1.1,1.3,1.4 D OBX^LA7VORU1
"RTN","LA7VORU2",34,0)
 I LA7NVAF=1 D SPDOD
"RTN","LA7VORU2",35,0)
 ;
"RTN","LA7VORU2",36,0)
 ; Process supplementary reports
"RTN","LA7VORU2",37,0)
 S LRSB=1.2,LA7SR=0
"RTN","LA7VORU2",38,0)
 F  S LA7SR=$O(^LR(LRDFN,LRSS,LRIDT,1.2,LA7SR)) Q:'LA7SR  D
"RTN","LA7VORU2",39,0)
 . N LA7IDT
"RTN","LA7VORU2",40,0)
 . ; If don't release this report then skip.
"RTN","LA7VORU2",41,0)
 . I $P($G(^LR(LRDFN,LRSS,LRIDT,1.2,LA7SR,0)),"^",2)'=1 Q
"RTN","LA7VORU2",42,0)
 . S LA7IDT=LRIDT_","_LA7SR D OBX^LA7VORU1
"RTN","LA7VORU2",43,0)
 ;
"RTN","LA7VORU2",44,0)
 ; Process organ/tissue subfile
"RTN","LA7VORU2",45,0)
 S LA7ORG=0
"RTN","LA7VORU2",46,0)
 F  S LA7ORG=$O(^LR(LRDFN,LRSS,LRIDT,2,LA7ORG)) Q:'LA7ORG  D
"RTN","LA7VORU2",47,0)
 . N LA7IDT
"RTN","LA7VORU2",48,0)
 . S LRSB=10,LA7IDT=LRIDT_","_LA7ORG D OBX^LA7VORU1
"RTN","LA7VORU2",49,0)
 . S LRSB="10,2",LA7IDT=LRIDT_","_LA7ORG D OBX^LA7VORU1
"RTN","LA7VORU2",50,0)
 . ; Procedures
"RTN","LA7VORU2",51,0)
 . S LA7P=0,LRSB="10,1.5"
"RTN","LA7VORU2",52,0)
 . F  S LA7P=$O(^LR(LRDFN,LRSS,LRIDT,2,LA7ORG,4,LA7P)) Q:'LA7P  D
"RTN","LA7VORU2",53,0)
 . . S LA7IDT=LRIDT_","_LA7ORG_","_LA7P D OBX^LA7VORU1
"RTN","LA7VORU2",54,0)
 . ; Special studies
"RTN","LA7VORU2",55,0)
 . S LA7SS=0,LRSB="10,5"
"RTN","LA7VORU2",56,0)
 . F  S LA7SS=$O(^LR(LRDFN,LRSS,LRIDT,2,LA7ORG,5,LA7SS)) Q:'LA7SS  D
"RTN","LA7VORU2",57,0)
 . . S LA7IDT=LRIDT_","_LA7ORG_","_LA7SS D OBX^LA7VORU1
"RTN","LA7VORU2",58,0)
 ;
"RTN","LA7VORU2",59,0)
 Q
"RTN","LA7VORU2",60,0)
 ;
"RTN","LA7VORU2",61,0)
 ;
"RTN","LA7VORU2",62,0)
SPDOD ; Build OBX segment's to special DoD specifications.
"RTN","LA7VORU2",63,0)
 ;
"RTN","LA7VORU2",64,0)
 N LA7DA
"RTN","LA7VORU2",65,0)
 ;
"RTN","LA7VORU2",66,0)
 S LRSB=.012 D OBX^LA7VORU1
"RTN","LA7VORU2",67,0)
 ;
"RTN","LA7VORU2",68,0)
 ; Send word-processing fields as series of OBX's for DoD.
"RTN","LA7VORU2",69,0)
 ; DoD cannot handle formatted text (FT) data type.
"RTN","LA7VORU2",70,0)
 F LRSB=.012,.013,.014,.015,.016,1,1.1,1.3,1.4 D
"RTN","LA7VORU2",71,0)
 . N LA7IDT,LA7SB
"RTN","LA7VORU2",72,0)
 . S LA7DA=0,LA7SB=$S(LRSB=.013:.2,LRSB=.014:.3,LRSB=.015:.4,LRSB=.016:.5,1:LRSB)
"RTN","LA7VORU2",73,0)
 . F  S LA7DA=$O(^LR(LRDFN,LRSS,LRIDT,LA7SB,LA7DA)) Q:'LA7DA  D
"RTN","LA7VORU2",74,0)
 . . S LA7IDT=LRIDT_","_LA7DA D OBX^LA7VORU1
"RTN","LA7VORU2",75,0)
 ;
"RTN","LA7VORU2",76,0)
 Q
"RTN","LA7VORUA")
0^25^B8112587
"RTN","LA7VORUA",1,0)
LA7VORUA ;DALOI/JMC - Builder of HL7 Lab Results NTE ; 4/10/2002
"RTN","LA7VORUA",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**61,64**;Sep 27, 1994
"RTN","LA7VORUA",3,0)
 ;
"RTN","LA7VORUA",4,0)
 ;
"RTN","LA7VORUA",5,0)
NTE ; Build NTE segment
"RTN","LA7VORUA",6,0)
 ;
"RTN","LA7VORUA",7,0)
 N LA7NTE,LA7SOC,LA7TXT,LA7X,X
"RTN","LA7VORUA",8,0)
 ;
"RTN","LA7VORUA",9,0)
 ; Initialize segment set id
"RTN","LA7VORUA",10,0)
 S LA7NTESN=0
"RTN","LA7VORUA",11,0)
 ; Source of comment - handle other system's special codes, i.e. DOD-CHCS
"RTN","LA7VORUA",12,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"AC",1:"L")
"RTN","LA7VORUA",13,0)
 ;
"RTN","LA7VORUA",14,0)
 ; Send "MI" specimen's comments
"RTN","LA7VORUA",15,0)
 I LA("SUB")="MI" D
"RTN","LA7VORUA",16,0)
 . K LA7NTE
"RTN","LA7VORUA",17,0)
 . S LA7TXT=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),99))
"RTN","LA7VORUA",18,0)
 . S LA7TXT=$$TRIM^XLFSTR(LA7TXT,"R"," ")
"RTN","LA7VORUA",19,0)
 . I LA7TXT="" Q
"RTN","LA7VORUA",20,0)
 . D NTE^LA7VORU1
"RTN","LA7VORUA",21,0)
 ;
"RTN","LA7VORUA",22,0)
 ; Send "CH" specimen's comments
"RTN","LA7VORUA",23,0)
 I LA("SUB")="CH" D
"RTN","LA7VORUA",24,0)
 . S LA7X=0
"RTN","LA7VORUA",25,0)
 . F  S LA7X=$O(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),1,LA7X)) Q:'LA7X  D
"RTN","LA7VORUA",26,0)
 . . K LA7NTE
"RTN","LA7VORUA",27,0)
 . . S LA7TXT=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),1,LA7X,0))
"RTN","LA7VORUA",28,0)
 . . D BNTE
"RTN","LA7VORUA",29,0)
 Q
"RTN","LA7VORUA",30,0)
 ;
"RTN","LA7VORUA",31,0)
 ;
"RTN","LA7VORUA",32,0)
PLC ; Performing lab comment
"RTN","LA7VORUA",33,0)
 N LA74,LA7DIV,LA7NTE,LA7RNLT,LA7SOC,LA7TSTN,LA7TXT,LA7X,X
"RTN","LA7VORUA",34,0)
 S (LA74,LA7DIV,LA7RNLT,LA7TSTN)=""
"RTN","LA7VORUA",35,0)
 ;
"RTN","LA7VORUA",36,0)
 ; Source of comment - handle other system's special codes, i.e. DOD-CHCS
"RTN","LA7VORUA",37,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"DS",1:"L")
"RTN","LA7VORUA",38,0)
 ;
"RTN","LA7VORUA",39,0)
 ; Find reporting facility (division).
"RTN","LA7VORUA",40,0)
 I LA("SUB")="CH" D
"RTN","LA7VORUA",41,0)
 . S LA7X=$G(^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),$P(LA7VT,"^")))
"RTN","LA7VORUA",42,0)
 . S LA74=$P(LA7X,"^",9)
"RTN","LA7VORUA",43,0)
 . S LA7RNLT=$P($P(LA7X,"^",3),"!",2)
"RTN","LA7VORUA",44,0)
 I LA74="" S LA74=+$P($G(^XMB(1,1,"XUS")),"^",17)
"RTN","LA7VORUA",45,0)
 I LA74 S LA7DIV=$$NAME^XUAF4(LA74)
"RTN","LA7VORUA",46,0)
 ;
"RTN","LA7VORUA",47,0)
 ; Build result test name
"RTN","LA7VORUA",48,0)
 I LA7RNLT="" D
"RTN","LA7VORUA",49,0)
 . I $G(LA("NLT"))'="" S LA7RNLT=LA("NLT") Q
"RTN","LA7VORUA",50,0)
 . S LA7RNLT=$G(LA7NLT)
"RTN","LA7VORUA",51,0)
 I LA7RNLT D
"RTN","LA7VORUA",52,0)
 . S LA7X=$O(^LAM("E",LA7RNLT,0))
"RTN","LA7VORUA",53,0)
 . I LA7X S LA7TSTN=$$GET1^DIQ(64,LA7X_",",.01,"I")
"RTN","LA7VORUA",54,0)
 ;
"RTN","LA7VORUA",55,0)
 S LA7TXT=LA7TSTN_" results from "_LA7DIV_"."
"RTN","LA7VORUA",56,0)
 D NTE^LA7VORU1
"RTN","LA7VORUA",57,0)
 S X=$$PADD^XUAF4(LA74)
"RTN","LA7VORUA",58,0)
 S LA7TXT=$P(X,U)_" "_$P(X,U,2)_", "_$P(X,U,3)_" "_$P(X,U,4)
"RTN","LA7VORUA",59,0)
 D NTE^LA7VORU1
"RTN","LA7VORUA",60,0)
 Q
"RTN","LA7VORUA",61,0)
 ;
"RTN","LA7VORUA",62,0)
 ;
"RTN","LA7VORUA",63,0)
INTRP ; Send test interpretation
"RTN","LA7VORUA",64,0)
 ; Send "CH" subscript file #60 site/specimen's interpretation field (#5.5)
"RTN","LA7VORUA",65,0)
 ;
"RTN","LA7VORUA",66,0)
 N LA760,LA761,LA7NTE,LA7SOC,LA7TXT,LA7X,LA7Y,LRSB
"RTN","LA7VORUA",67,0)
 ;
"RTN","LA7VORUA",68,0)
 S LRSB=$P(LA7VT,"^"),LA7Y=0
"RTN","LA7VORUA",69,0)
 S LA761=+$P(LA763(0),"^",5)
"RTN","LA7VORUA",70,0)
 S LA7X=^LR(LA("LRDFN"),LA("SUB"),LA("LRIDT"),LRSB)
"RTN","LA7VORUA",71,0)
 S LA760=+$P($P(LA7X,"^",3),"!",5)
"RTN","LA7VORUA",72,0)
 I LA760,$D(^LAB(60,LA760,1,LA761,1)) S LA7Y=1
"RTN","LA7VORUA",73,0)
 I 'LA760 D
"RTN","LA7VORUA",74,0)
 . S LA760=0
"RTN","LA7VORUA",75,0)
 . F  S LA760=$O(^LAB(60,"C","CH;"_LRSB_";1",LA760)) Q:'LA760  D  Q:LA7Y
"RTN","LA7VORUA",76,0)
 . . I $D(^LAB(60,LA760,1,LA761,1)) S LA7Y=1
"RTN","LA7VORUA",77,0)
 ;
"RTN","LA7VORUA",78,0)
 I 'LA7Y Q
"RTN","LA7VORUA",79,0)
 ;
"RTN","LA7VORUA",80,0)
 ; Source of comment - handle other system's special codes, i.e. DOD-CHCS
"RTN","LA7VORUA",81,0)
 S LA7SOC=$S($G(LA7NVAF)=1:"RI",1:"L")
"RTN","LA7VORUA",82,0)
 ;
"RTN","LA7VORUA",83,0)
 ; Build each line of interpretation as a NTE segment.
"RTN","LA7VORUA",84,0)
 S LA7X=0
"RTN","LA7VORUA",85,0)
 F  S LA7X=$O(^LAB(60,LA760,1,LA761,1,LA7X)) Q:'LA7X  D
"RTN","LA7VORUA",86,0)
 . S LA7TXT=$G(^LAB(60,LA760,1,LA761,1,LA7X,0))
"RTN","LA7VORUA",87,0)
 . D BNTE
"RTN","LA7VORUA",88,0)
 ;
"RTN","LA7VORUA",89,0)
 Q
"RTN","LA7VORUA",90,0)
 ;
"RTN","LA7VORUA",91,0)
 ;
"RTN","LA7VORUA",92,0)
BNTE ; Build NTE segment
"RTN","LA7VORUA",93,0)
 ;
"RTN","LA7VORUA",94,0)
 I $E(LA7TXT,1)="~" S LA7TXT=$$TRIM^XLFSTR(LA7TXT,"L","~")
"RTN","LA7VORUA",95,0)
 S LA7TXT=$$TRIM^XLFSTR(LA7TXT,"R"," ")
"RTN","LA7VORUA",96,0)
 I LA7TXT="" S LA7TXT=" "
"RTN","LA7VORUA",97,0)
 D NTE^LA7VORU1
"RTN","LA7VORUA",98,0)
 Q
"RTN","LA7VPID")
0^38^B23557446
"RTN","LA7VPID",1,0)
LA7VPID ;DALOI/JMC - HL7 PID/PV1 segment builder utility ; 11-25-1998
"RTN","LA7VPID",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**46,64**;Sep 27, 1994
"RTN","LA7VPID",3,0)
 ;
"RTN","LA7VPID",4,0)
 ; Reference to routine $$EN^VAFHLPID supported by DBIA# 263
"RTN","LA7VPID",5,0)
 ;
"RTN","LA7VPID",6,0)
PID(LRDFN,LA7EXTID,LA7ARRAY,LA7PIDSN,HL,LA7ALTID) ; Build PID segment
"RTN","LA7VPID",7,0)
 ; Call with     LRDFN = Lab DFN, passed by value
"RTN","LA7VPID",8,0)
 ;            LA7EXTID = to return as external patient id, id used by non-VA systems (optional)
"RTN","LA7VPID",9,0)
 ;            LA7ARRAY = array to return PID array, pass by reference
"RTN","LA7VPID",10,0)
 ;            LA7PIDSN = PID id counter, passsed by value
"RTN","LA7VPID",11,0)
 ;                  HL = HL7 variable array, pass by reference
"RTN","LA7VPID",12,0)
 ;            LA7ALTID = return alternate patient id, id used by non-va systems (optional)
"RTN","LA7VPID",13,0)
 ;
"RTN","LA7VPID",14,0)
 ; Returns LA7ARRAY
"RTN","LA7VPID",15,0)
 ;
"RTN","LA7VPID",16,0)
 N DFN,HLQ,LA763,LA7Y,LRDPF,VAFPID
"RTN","LA7VPID",17,0)
 ;
"RTN","LA7VPID",18,0)
 ; Change HLQ - VAFHLPID puts delete indicator when Vista has no value for field - not according to standard.
"RTN","LA7VPID",19,0)
 S HLQ=""
"RTN","LA7VPID",20,0)
 ;
"RTN","LA7VPID",21,0)
 I $G(LRDFN)=""!($G(HL("FS"))="") Q
"RTN","LA7VPID",22,0)
 I '$D(^LR(LRDFN,0)) Q
"RTN","LA7VPID",23,0)
 ;
"RTN","LA7VPID",24,0)
 S LA7EXTID=$G(LA7EXTID),LA7ALTID=$G(LA7ALTID),LA7PIDSN=$G(LA7PIDSN)+1
"RTN","LA7VPID",25,0)
 S LA763(0)=$G(^LR(LRDFN,0))
"RTN","LA7VPID",26,0)
 S LRDPF=$P(LA763(0),"^",2),DFN=$P(LA763(0),"^",3)
"RTN","LA7VPID",27,0)
 ;
"RTN","LA7VPID",28,0)
 ; REFERRAL file (#67) with PATIENT file (#2) link, use info from PATIENT file.
"RTN","LA7VPID",29,0)
 I LRDPF=67,$P($G(^LRT(67,DFN,"DPT")),"^") D
"RTN","LA7VPID",30,0)
  .S LRDPF=2
"RTN","LA7VPID",31,0)
 . S DFN=$P($G(^LRT(67,DFN,"DPT")),"^")
"RTN","LA7VPID",32,0)
 ;
"RTN","LA7VPID",33,0)
 ; Patient file - use VAF call
"RTN","LA7VPID",34,0)
 I LRDPF=2 D F2PID
"RTN","LA7VPID",35,0)
 ;
"RTN","LA7VPID",36,0)
 ; Non-patient file 
"RTN","LA7VPID",37,0)
 I LRDPF'=2 D NF2PID
"RTN","LA7VPID",38,0)
 K AGE,PNM,SEX,DOB,SSN,VA200,LRWRD,LRRB,LRTREA,VA
"RTN","LA7VPID",39,0)
 Q
"RTN","LA7VPID",40,0)
 ;
"RTN","LA7VPID",41,0)
 ;
"RTN","LA7VPID",42,0)
PV1(LRDFN,LA7ARRAY,LA7FS,LA7ECH) ; Build PV1 segment
"RTN","LA7VPID",43,0)
 ; Call with    LRDFN = ien of entry in File #63
"RTN","LA7VPID",44,0)
 ;           LA7ARRAY = array to return PV1 array, pass by reference
"RTN","LA7VPID",45,0)
 ;              LA7FS = HL field separator
"RTN","LA7VPID",46,0)
 ;             LA7ECH = HL encoding characters
"RTN","LA7VPID",47,0)
 ;
"RTN","LA7VPID",48,0)
 ;
"RTN","LA7VPID",49,0)
 N DFN,LA763,LA7LOC,LRDPF,LA7Y
"RTN","LA7VPID",50,0)
 S LA763(0)=$G(^LR(LRDFN,0))
"RTN","LA7VPID",51,0)
 S LRDPF=$P(LA763(0),"^",2),DFN=$P(LA763(0),"^",3),LA7LOC=""
"RTN","LA7VPID",52,0)
 ;
"RTN","LA7VPID",53,0)
 S LA7Y(0)="PV1"
"RTN","LA7VPID",54,0)
 S LA7Y(1)=1
"RTN","LA7VPID",55,0)
 ;
"RTN","LA7VPID",56,0)
 ; Referral file with Patient file link.
"RTN","LA7VPID",57,0)
 I LRDPF=67,$P($G(^LRT(67,DFN,"DPT")),"^") D
"RTN","LA7VPID",58,0)
 . S LRDPF=2
"RTN","LA7VPID",59,0)
 . S DFN=$P($G(^LRT(67,DFN,"DPT")),"^")
"RTN","LA7VPID",60,0)
 ;
"RTN","LA7VPID",61,0)
 ; Determine patient class
"RTN","LA7VPID",62,0)
 ; Current inpatient location
"RTN","LA7VPID",63,0)
 I LRDPF=2 S LA7LOC=$G(^DPT(DFN,.1))
"RTN","LA7VPID",64,0)
 I $L(LA7LOC) S LA7Y(2)="I" ; Inpatient
"RTN","LA7VPID",65,0)
 ;
"RTN","LA7VPID",66,0)
 ; Otherwise from lab files
"RTN","LA7VPID",67,0)
 I $G(LA7LOC)="" D
"RTN","LA7VPID",68,0)
 . S LA7LOC=$G(^LR(LRDFN,.1))
"RTN","LA7VPID",69,0)
 . S LA7Y(2)="O" ; Default to outpatient
"RTN","LA7VPID",70,0)
 ;
"RTN","LA7VPID",71,0)
 ; Patient location
"RTN","LA7VPID",72,0)
 S LA7LOC=$$CHKDATA^LA7VHLU3(LA7LOC,LA7FS_LA7ECH)
"RTN","LA7VPID",73,0)
 S LA7Y(3)=LA7LOC
"RTN","LA7VPID",74,0)
 ;
"RTN","LA7VPID",75,0)
 D BUILDSEG^LA7VHLU(.LA7Y,.LA7ARRAY,LA7FS)
"RTN","LA7VPID",76,0)
 Q
"RTN","LA7VPID",77,0)
 ;
"RTN","LA7VPID",78,0)
 ;
"RTN","LA7VPID",79,0)
F2PID ; Build patient identifier field on file #2 patient
"RTN","LA7VPID",80,0)
 ;
"RTN","LA7VPID",81,0)
 N I,ICN,LA7X,X
"RTN","LA7VPID",82,0)
 S LA7ARRAY(0)=$$EN^VAFHLPID(DFN,"1,5,6,7,8,10NTB,16,19",LA7PIDSN)
"RTN","LA7VPID",83,0)
 ;
"RTN","LA7VPID",84,0)
 ; Return external identifer in PID-2 sequence, backward compatibility to V2.2
"RTN","LA7VPID",85,0)
 I $L(LA7EXTID) D
"RTN","LA7VPID",86,0)
 . I '(LA7EXTID?1N.N) S $P(LA7ARRAY(0),HL("FS"),3)=LA7EXTID
"RTN","LA7VPID",87,0)
 . E  S $P(LA7ARRAY(0),HLFS,3)=$$M11^HLFNC(LA7EXTID,HL("ECH"))
"RTN","LA7VPID",88,0)
 ;
"RTN","LA7VPID",89,0)
 ; Send SSN as patient identifier
"RTN","LA7VPID",90,0)
 S X=$$M11^HLFNC($P(LA7ARRAY(0),HLFS,20),HL("ECH"))
"RTN","LA7VPID",91,0)
 S $P(X,$E(HL("ECH")),5)="SS"
"RTN","LA7VPID",92,0)
 S $P(LA7ARRAY(0),HLFS,4)=X
"RTN","LA7VPID",93,0)
 ;
"RTN","LA7VPID",94,0)
 ; Send DFN as patient identifier
"RTN","LA7VPID",95,0)
 S X=$$M11^HLFNC(DFN,HL("ECH"))
"RTN","LA7VPID",96,0)
 S $P(X,$E(HL("ECH")),5)="PI"
"RTN","LA7VPID",97,0)
 S $P(X,$E(HL("ECH")),6)=$$GET1^DIQ(4,+$P($G(^XMB(1,1,"XUS")),"^",17),99)_$E(HL("ECH"),4)_$G(^XMB("NETNAME"))_$E(HL("ECH"),4)_"DNS"
"RTN","LA7VPID",98,0)
 S $P(LA7ARRAY(0),HLFS,4)=$P(LA7ARRAY(0),HL("FS"),4)_$E(HL("ECH"),2)_X
"RTN","LA7VPID",99,0)
 ;
"RTN","LA7VPID",100,0)
 ; Send ICN from MPI as patient identifier
"RTN","LA7VPID",101,0)
 S ICN=$$ICN(DFN,HL("ECH"))
"RTN","LA7VPID",102,0)
 I ICN>0 S $P(LA7ARRAY(0),HLFS,4)=$P(LA7ARRAY(0),HL("FS"),4)_$E(HL("ECH"),2)_ICN
"RTN","LA7VPID",103,0)
 ;
"RTN","LA7VPID",104,0)
 ; Send alternate patient id if passed
"RTN","LA7VPID",105,0)
 I LA7ALTID'="" S $P(LA7ARRAY(0),HL("FS"),5)=LA7ALTID
"RTN","LA7VPID",106,0)
 I $P(LA7ARRAY(0),HLFS,5)?1N.N S $P(LA7ARRAY(0),HL("FS"),5)=$$M11^HLFNC($P(LA7ARRAY(0),HL("FS"),5),HL("ECH"))
"RTN","LA7VPID",107,0)
 ;
"RTN","LA7VPID",108,0)
 ; Check for overflow (>245)
"RTN","LA7VPID",109,0)
 I $O(VAFPID(0)) D
"RTN","LA7VPID",110,0)
 . S I=0
"RTN","LA7VPID",111,0)
 . F  S I=$O(VAFPID(I)) Q:'I  S LA7ARRAY(I)=VAFPID(I)
"RTN","LA7VPID",112,0)
 ;
"RTN","LA7VPID",113,0)
 Q
"RTN","LA7VPID",114,0)
 ;
"RTN","LA7VPID",115,0)
 ;
"RTN","LA7VPID",116,0)
NF2PID ; Build patient identifier field on non-file #2 patient
"RTN","LA7VPID",117,0)
 ;
"RTN","LA7VPID",118,0)
 D PT^LRX
"RTN","LA7VPID",119,0)
 S LA7Y(0)="PID"
"RTN","LA7VPID",120,0)
 S LA7Y(1)=LA7PIDSN
"RTN","LA7VPID",121,0)
 ;
"RTN","LA7VPID",122,0)
 ; Return external identifer in PID-2 sequence, backward compatibility to V2.2
"RTN","LA7VPID",123,0)
 I LA7EXTID'="" D
"RTN","LA7VPID",124,0)
 . I '(LA7EXTID?1N.N) S LA7Y(2)=LA7EXTID
"RTN","LA7VPID",125,0)
 . E  S LA7Y(2)=$$M11^HLFNC(LA7EXTID,HL("ECH"))
"RTN","LA7VPID",126,0)
 S LA7Y(3)=$$M11^HLFNC(SSN(2),HL("ECH"))
"RTN","LA7VPID",127,0)
 I LRDPF=67.1 S $P(LA7Y(3),$E(HL("ECH"),1),5)="L2"
"RTN","LA7VPID",128,0)
 ;
"RTN","LA7VPID",129,0)
 ; Send LRDFN as alternate patient ID, unless alternate id passed
"RTN","LA7VPID",130,0)
 I LA7ALTID'="" S LA7Y(4)=LA7ALTID
"RTN","LA7VPID",131,0)
 E  S LA7Y(4)=LRDFN
"RTN","LA7VPID",132,0)
 I LA7Y(4)?1N.N S LA7Y(4)=$$M11^HLFNC(LA7Y(4),HL("ECH"))
"RTN","LA7VPID",133,0)
 ;
"RTN","LA7VPID",134,0)
 S LA7Y(5)=$$HLNAME^HLFNC($G(PNM),HL("ECH"))
"RTN","LA7VPID",135,0)
 ;
"RTN","LA7VPID",136,0)
 I $G(DOB)'="" D
"RTN","LA7VPID",137,0)
 . S DOB=$$CHKDT^LA7VHLU1(DOB)
"RTN","LA7VPID",138,0)
 . S LA7Y(7)=$$FMTHL7^XLFDT(DOB)
"RTN","LA7VPID",139,0)
 ;
"RTN","LA7VPID",140,0)
 S LA7Y(8)=$S($G(SEX)'="":SEX,1:"U")
"RTN","LA7VPID",141,0)
 ;
"RTN","LA7VPID",142,0)
 ; Race - if from REFERRAL PATIENT file (#67) then check RACE field.
"RTN","LA7VPID",143,0)
 S LA7Y(10)=""
"RTN","LA7VPID",144,0)
 I LRDPF=67 D
"RTN","LA7VPID",145,0)
 . S LA7X=$$GET1^DIQ(67,DFN_",",.06,"I")
"RTN","LA7VPID",146,0)
 . I LA7X<1 Q
"RTN","LA7VPID",147,0)
 . S LA7Y(10)=$$PTR2CODE^DGUTL4(LA7X,1,2)
"RTN","LA7VPID",148,0)
 . S $P(LA7Y(10),$E(HL("ECH"),1),2)=$$PTR2TEXT^DGUTL4(LA7X,1)
"RTN","LA7VPID",149,0)
 . S $P(LA7Y(10),$E(HL("ECH"),1),3)="HL70005"
"RTN","LA7VPID",150,0)
 ;
"RTN","LA7VPID",151,0)
 ; SSN from referral file if 9N - DoD uses PID-19 to validate
"RTN","LA7VPID",152,0)
 S LA7Y(19)=""
"RTN","LA7VPID",153,0)
 I LRDPF=67 D
"RTN","LA7VPID",154,0)
 . S LA7X=$$GET1^DIQ(67,DFN_",",.09,"I")
"RTN","LA7VPID",155,0)
 . I LA7X?9N S LA7Y(19)=LA7X
"RTN","LA7VPID",156,0)
 ;
"RTN","LA7VPID",157,0)
 D BUILDSEG^LA7VHLU(.LA7Y,.LA7ARRAY,HL("FS"))
"RTN","LA7VPID",158,0)
 Q
"RTN","LA7VPID",159,0)
 ;
"RTN","LA7VPID",160,0)
 ;
"RTN","LA7VPID",161,0)
ICN(DFN,LA7ECH) ; Send ICN from MPI
"RTN","LA7VPID",162,0)
 ; Call with DFN = internal entry number of patient in PATIENT #2 file.
"RTN","LA7VPID",163,0)
 ;        LA7ECH = HL7 encoding characters.
"RTN","LA7VPID",164,0)
 ;
"RTN","LA7VPID",165,0)
 N ICN,LA7ICN
"RTN","LA7VPID",166,0)
 ;
"RTN","LA7VPID",167,0)
 S ICN=""
"RTN","LA7VPID",168,0)
 ;
"RTN","LA7VPID",169,0)
 S X="MPIF001" X ^%ZOSF("TEST")
"RTN","LA7VPID",170,0)
 I $T D
"RTN","LA7VPID",171,0)
 . S LA7ICN=$$GETICN^MPIF001(DFN)
"RTN","LA7VPID",172,0)
 . I LA7ICN<1 Q
"RTN","LA7VPID",173,0)
 . S ICN=LA7ICN
"RTN","LA7VPID",174,0)
 . S $P(ICN,$E(LA7ECH,1),4)="USVHA"_$E(LA7ECH,4)_$E(LA7ECH,4)_"HL70363"
"RTN","LA7VPID",175,0)
 . S $P(ICN,$E(LA7ECH,1),5)="NI"
"RTN","LA7VPID",176,0)
 . S $P(ICN,$E(LA7ECH,1),6)="VA FACILITY ID"_$E(LA7ECH,4)_$P($$SITE^VASITE,"^",3)_$E(LA7ECH,4)_"L"
"RTN","LA7VPID",177,0)
 ;
"RTN","LA7VPID",178,0)
 Q ICN
"RTN","LA7VSET")
0^28^B99076533
"RTN","LA7VSET",1,0)
LA7VSET ;DALOI/JMC - MENU TO SETUP VISN LABS ; 12/3/1997
"RTN","LA7VSET",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,51,55,46,64**;Sep 27, 1994
"RTN","LA7VSET",3,0)
 ;
"RTN","LA7VSET",4,0)
 ; Reference to HL LOGICAL LINK file (#870) supported by DBIA #1495, 1496, 2063
"RTN","LA7VSET",5,0)
 ; Reference to PROTOCOL file (#101) supported by DBIA #872
"RTN","LA7VSET",6,0)
 ; Reference to MAIL GROUP file (#3.8) supported by DBIA #2061
"RTN","LA7VSET",7,0)
 ;
"RTN","LA7VSET",8,0)
 D CONV
"RTN","LA7VSET",9,0)
 ;
"RTN","LA7VSET",10,0)
 N LA76248,LA7629,LA7VNVC,PRIMARY,PRSITE,HDR,LAB,HOST,REMOTE,LRY,LRX,LA7VS,NAME
"RTN","LA7VSET",11,0)
 ;
"RTN","LA7VSET",12,0)
 S LA7VS=$$PRIM^VASITE(DT)
"RTN","LA7VSET",13,0)
 I $G(LA7VS)'="" D
"RTN","LA7VSET",14,0)
 . S LA7VS=$$SITE^VASITE(DT,LA7VS)
"RTN","LA7VSET",15,0)
 . S PRIMARY=$P(LA7VS,U,3),PRSITE=$P(LA7VS,U,2)
"RTN","LA7VSET",16,0)
 ;
"RTN","LA7VSET",17,0)
 I $G(PRIMARY)="" W !!,"No Primary Site is defined!!!!",!! R !,"Press RETURN to continue: ",X:DTIME Q
"RTN","LA7VSET",18,0)
 ;
"RTN","LA7VSET",19,0)
 S HDR="LEDI Setup"
"RTN","LA7VSET",20,0)
 S HDR(1)="Add/Edit HOST Lab",HDR(2)="Add/Edit COLLECTION Lab"
"RTN","LA7VSET",21,0)
 F  S LAB=$$MAIN Q:LAB=""  D @LAB
"RTN","LA7VSET",22,0)
 ;
"RTN","LA7VSET",23,0)
 K DIE,DA,DR,DO,DIC
"RTN","LA7VSET",24,0)
 ;
"RTN","LA7VSET",25,0)
 Q
"RTN","LA7VSET",26,0)
 ;
"RTN","LA7VSET",27,0)
MAIN() ; Display the main LEDI setup screen
"RTN","LA7VSET",28,0)
 N HDRCNT,HDRA
"RTN","LA7VSET",29,0)
 W @IOF,! F X=1:1:79 W "-"
"RTN","LA7VSET",30,0)
 W !,?((80-$L(HDR))/2),HDR
"RTN","LA7VSET",31,0)
 W ! F X=1:1:79 W "-"
"RTN","LA7VSET",32,0)
 W !
"RTN","LA7VSET",33,0)
 W !,"COLLECTION Labs:  Use option #1 to setup HOST labs."
"RTN","LA7VSET",34,0)
 W !,"  HOST Labs    :  Use option #2 to setup COLLECTION labs."
"RTN","LA7VSET",35,0)
 W !!
"RTN","LA7VSET",36,0)
 S HDRCNT=0
"RTN","LA7VSET",37,0)
 F  S HDRCNT=$O(HDR(HDRCNT)) Q:'HDRCNT  W !,HDRCNT,".",?5,HDR(HDRCNT)
"RTN","LA7VSET",38,0)
 D KDIR
"RTN","LA7VSET",39,0)
 W !!
"RTN","LA7VSET",40,0)
 S DIR(0)="NO^1:2"
"RTN","LA7VSET",41,0)
 D MHLP,^DIR
"RTN","LA7VSET",42,0)
 S HDRA=$S(Y=1:"HOST",Y=2:"REMOTE",1:"")
"RTN","LA7VSET",43,0)
 D KDIR
"RTN","LA7VSET",44,0)
 Q HDRA
"RTN","LA7VSET",45,0)
 ;
"RTN","LA7VSET",46,0)
 ;
"RTN","LA7VSET",47,0)
KDIR ; kill all DIR variables
"RTN","LA7VSET",48,0)
 K DIR,DIRUT,DUOUT,DTOUT,DIROUT,X,Y
"RTN","LA7VSET",49,0)
 Q
"RTN","LA7VSET",50,0)
 ;
"RTN","LA7VSET",51,0)
 ;
"RTN","LA7VSET",52,0)
HOST ; HOST Lab Setup Menu
"RTN","LA7VSET",53,0)
 ;
"RTN","LA7VSET",54,0)
 N LA7CNT,LA7,LA7P,SNUM,SNAME,HOST,LA7A
"RTN","LA7VSET",55,0)
 ;
"RTN","LA7VSET",56,0)
 F  D  Q:'LA7A
"RTN","LA7VSET",57,0)
 . D HOSTBLD,HSTHDR,HOSTLST,KDIR
"RTN","LA7VSET",58,0)
 . W !! S DIR(0)="NO^1:"_LA7CNT
"RTN","LA7VSET",59,0)
 . D H1HLP,^DIR
"RTN","LA7VSET",60,0)
 . I $D(DIRUT) S LA7A=0 Q
"RTN","LA7VSET",61,0)
 . S LA7A=Y D AEHOST
"RTN","LA7VSET",62,0)
 K SNAME
"RTN","LA7VSET",63,0)
 Q
"RTN","LA7VSET",64,0)
 ;
"RTN","LA7VSET",65,0)
 ;
"RTN","LA7VSET",66,0)
HOSTBLD ; Build list of host facilities.
"RTN","LA7VSET",67,0)
 ; Identify all HOST labs using LA7 MESSAGE PARAMETER file (#62.48)
"RTN","LA7VSET",68,0)
 ;
"RTN","LA7VSET",69,0)
 N LA7,LA74,LA76248,LA7629,SNAME,SNUM
"RTN","LA7VSET",70,0)
 ;
"RTN","LA7VSET",71,0)
 K HOST
"RTN","LA7VSET",72,0)
 S LA7CNT=1,(LA7,LA7P)="LA7V HOST "
"RTN","LA7VSET",73,0)
 F  S LA7=$O(^LAHM(62.48,"B",LA7)) Q:LA7=""!(LA7'[LA7P)  D
"RTN","LA7VSET",74,0)
 . S SNUM=$P(LA7,"HOST ",2)
"RTN","LA7VSET",75,0)
 . S LA74=$$FINDSITE^LA7VHLU2(SNUM,1,1) Q:LA74'>0
"RTN","LA7VSET",76,0)
 . S SNAME=$P($$NS^XUAF4(LA74),"^")
"RTN","LA7VSET",77,0)
 . S HOST(LA7CNT)=SNUM_U_SNAME_U_LA7_U_LA74,LA7CNT=LA7CNT+1
"RTN","LA7VSET",78,0)
 S HOST(LA7CNT)=""
"RTN","LA7VSET",79,0)
 ;
"RTN","LA7VSET",80,0)
 Q
"RTN","LA7VSET",81,0)
 ;
"RTN","LA7VSET",82,0)
 ;
"RTN","LA7VSET",83,0)
HSTHDR ; HOST setup header
"RTN","LA7VSET",84,0)
 S HOST="HOST Lab(s)"
"RTN","LA7VSET",85,0)
 W @IOF,! F X=1:1:79 W "-"
"RTN","LA7VSET",86,0)
 W !,?((80-$L(HOST))/2),HOST
"RTN","LA7VSET",87,0)
 W ! F X=1:1:79 W "-"
"RTN","LA7VSET",88,0)
 W !!
"RTN","LA7VSET",89,0)
 Q
"RTN","LA7VSET",90,0)
 ;
"RTN","LA7VSET",91,0)
 ;
"RTN","LA7VSET",92,0)
HOSTLST ;
"RTN","LA7VSET",93,0)
 S LA7CNT=1,LA7=0
"RTN","LA7VSET",94,0)
 F  S LA7=$O(HOST(LA7)) Q:'LA7  I HOST(LA7)'="" W !,LA7,".",?5,$P(HOST(LA7),U,2)_"  ("_$P(HOST(LA7),U,3)_")" S LA7CNT=LA7CNT+1
"RTN","LA7VSET",95,0)
 W !,LA7CNT,".",?5,"Add HOST Lab"
"RTN","LA7VSET",96,0)
 Q
"RTN","LA7VSET",97,0)
 ;
"RTN","LA7VSET",98,0)
AEHOST ;
"RTN","LA7VSET",99,0)
 N CHA,UI
"RTN","LA7VSET",100,0)
 F  S HOST="HOST Lab Setup" D HSTHDR,HSTHDR2,KDIR W !! S DIR(0)="NO^1:"_LA7CNT D H2HLP D ^DIR S CHA=Y D:CHA>0  Q:+CHA'>0
"RTN","LA7VSET",101,0)
 . I CHA=1 D HLAB($P(HOST(LA7A),U))
"RTN","LA7VSET",102,0)
 . I CHA=2 D HLL
"RTN","LA7VSET",103,0)
 . I CHA=3 D LMC
"RTN","LA7VSET",104,0)
 . I CHA=4 D CHTST
"RTN","LA7VSET",105,0)
 D KDIR
"RTN","LA7VSET",106,0)
 Q
"RTN","LA7VSET",107,0)
 ;
"RTN","LA7VSET",108,0)
 ;
"RTN","LA7VSET",109,0)
HSTHDR2 ;
"RTN","LA7VSET",110,0)
 N LA7624,LA76248,LA7870,LA7X
"RTN","LA7VSET",111,0)
 ;
"RTN","LA7VSET",112,0)
 S LA7CNT=1
"RTN","LA7VSET",113,0)
 W !!,"1. HOST Lab: ",?15,$P(HOST(LA7A),U,2)
"RTN","LA7VSET",114,0)
 W:$P(HOST(LA7A),U,2)'="" "  (Uneditable)"
"RTN","LA7VSET",115,0)
 ;
"RTN","LA7VSET",116,0)
 I $P(HOST(LA7A),U,2)="" Q
"RTN","LA7VSET",117,0)
 ;
"RTN","LA7VSET",118,0)
 D LINK^HLUTIL3($P(HOST(LA7A),"^",4),.LA7X,"")
"RTN","LA7VSET",119,0)
 S LA7870=+$O(LA7X(0))
"RTN","LA7VSET",120,0)
 I 'LA7870 D
"RTN","LA7VSET",121,0)
 . S LA7870=+$$FIND1^DIC(870,"","OX","LA7V"_$P(HOST(LA7A),U))
"RTN","LA7VSET",122,0)
 . I 'LA7870 S LA7870=+$$FIND1^DIC(870,"","OX","LA7V "_$P(HOST(LA7A),U))
"RTN","LA7VSET",123,0)
 . I LA7870 S LA7X(LA7870)=$$GET1^DIQ(870,LA7870_",",.01)
"RTN","LA7VSET",124,0)
 S LA7CNT=2
"RTN","LA7VSET",125,0)
 W !,"2. Logical Link: ",$G(LA7X(LA7870))
"RTN","LA7VSET",126,0)
 ;
"RTN","LA7VSET",127,0)
 S LA76248=$$FIND1^DIC(62.48,"","OX","LA7V HOST "_$P(HOST(LA7A),U)),LA7CNT=3
"RTN","LA7VSET",128,0)
 W !,"3. Message Configuration: ",$$GET1^DIQ(62.48,LA76248_",",.01)
"RTN","LA7VSET",129,0)
 ;
"RTN","LA7VSET",130,0)
 S LA7624=$$FIND1^DIC(62.4,"","OX","LA7V HOST "_$P(HOST(LA7A),U)),LA7CNT=4
"RTN","LA7VSET",131,0)
 W !,"4. Auto Instrument: ",$$GET1^DIQ(62.4,LA7624_",",.01)
"RTN","LA7VSET",132,0)
 ;
"RTN","LA7VSET",133,0)
 Q
"RTN","LA7VSET",134,0)
 ;
"RTN","LA7VSET",135,0)
 ;
"RTN","LA7VSET",136,0)
LMC ; Edit lab message configuration file.
"RTN","LA7VSET",137,0)
 ;
"RTN","LA7VSET",138,0)
 N DIC,DA,DR,DIE
"RTN","LA7VSET",139,0)
 ;
"RTN","LA7VSET",140,0)
 S X="LA7V HOST "_$P(@LAB@(LA7A),U),DIC(0)="EMX",DIC="^LAHM(62.48,"
"RTN","LA7VSET",141,0)
 D ^DIC
"RTN","LA7VSET",142,0)
 I +Y<0 W !,"You have not entered a "_LAB_" lab." Q
"RTN","LA7VSET",143,0)
 ;
"RTN","LA7VSET",144,0)
 S DA=+Y,DIE="^LAHM(62.48,",DR="3;4;10;11////10;@20;20;I X'="""" S Y=""@20"""
"RTN","LA7VSET",145,0)
 D ^DIE
"RTN","LA7VSET",146,0)
 ;
"RTN","LA7VSET",147,0)
 Q
"RTN","LA7VSET",148,0)
 ;
"RTN","LA7VSET",149,0)
 ;
"RTN","LA7VSET",150,0)
HLAB(LRI) ;Add Host LAB
"RTN","LA7VSET",151,0)
 ;
"RTN","LA7VSET",152,0)
 N INST,LA7VNVC,LA7629,LA7VER,LA7X
"RTN","LA7VSET",153,0)
 ;
"RTN","LA7VSET",154,0)
 I $P(HOST(LA7A),U)'="" D KDIR S DIR("A")="Are you sure you want to update the "_$P(HOST(LA7A),U,2)_" interface",DIR(0)="Y0" D ^DIR Q:+Y'>0
"RTN","LA7VSET",155,0)
 ;
"RTN","LA7VSET",156,0)
 I $P(HOST(LA7A),U)="" D
"RTN","LA7VSET",157,0)
 . N DIC,DA,DO
"RTN","LA7VSET",158,0)
 . S DIC="^DIC(4,",DIC(0)="AEMQZ"
"RTN","LA7VSET",159,0)
 . S DIC("S")="N LA7X S LA7X=$G(^(99)) I ($L($P(LA7X,U))&$P(LA7X,U,5)=""VA"")!($P(LA7X,U)=""""&$P(LA7X,U,5)'=""VA"")"
"RTN","LA7VSET",160,0)
 . D ^DIC Q:Y<1
"RTN","LA7VSET",161,0)
 . S INST=+Y
"RTN","LA7VSET",162,0)
 . I PRIMARY=INST!(INST=DUZ(2)) D  Q
"RTN","LA7VSET",163,0)
 . . W !,"To add your Hospital as a HOST site just add COLLECTION sites."
"RTN","LA7VSET",164,0)
 . S HOST(LA7A+1)=HOST(LA7A)
"RTN","LA7VSET",165,0)
 . S HOST(LA7A)=$$RETFACID^LA7VHLU2(INST,1,1)_U_$P($$NS^XUAF4(INST),"^")_"^^"_INST
"RTN","LA7VSET",166,0)
 ;
"RTN","LA7VSET",167,0)
 I $P(HOST(LA7A),U)="" S $P(HOST(LA7A),U,2)="" Q
"RTN","LA7VSET",168,0)
 ;
"RTN","LA7VSET",169,0)
 I PRIMARY'=$P(HOST(LA7A),U) D
"RTN","LA7VSET",170,0)
 . S LA7VER=2.3
"RTN","LA7VSET",171,0)
 . I $$NVAF^LA7VHLU2($P(HOST(LA7A),"^",4))=1 S LA7VER=2.2
"RTN","LA7VSET",172,0)
 . D HOST^LA7VSTP(PRIMARY,PRSITE,$P(HOST(LA7A),U),$P(HOST(LA7A),U,2),LA7VER)
"RTN","LA7VSET",173,0)
 ;
"RTN","LA7VSET",174,0)
 Q
"RTN","LA7VSET",175,0)
 ;
"RTN","LA7VSET",176,0)
 ;
"RTN","LA7VSET",177,0)
HLL ;add/edit logical link
"RTN","LA7VSET",178,0)
 ;
"RTN","LA7VSET",179,0)
 N HDR,PR,LA7LL
"RTN","LA7VSET",180,0)
 S HDR="Logical Link for transmissions to/from "_$P(HOST(LA7A),U,2)
"RTN","LA7VSET",181,0)
 W @IOF,! F X=1:1:79 W "-"
"RTN","LA7VSET",182,0)
 W !,?((80-$L(HDR))/2),HDR
"RTN","LA7VSET",183,0)
 W ! F X=1:1:79 W "-"
"RTN","LA7VSET",184,0)
 W !,?3,"Protocol",?40,"Logical Link",!,?3,"----------",?40,"---------------"
"RTN","LA7VSET",185,0)
 W !!
"RTN","LA7VSET",186,0)
 S PR=$O(^ORD(101,"B","LA7V Process Results from "_$P(HOST(LA7A),U),0))
"RTN","LA7VSET",187,0)
 I PR D GETLL(PR)
"RTN","LA7VSET",188,0)
 ;
"RTN","LA7VSET",189,0)
 S PR=$O(^ORD(101,"B","LA7V Send Order to "_$P(HOST(LA7A),U),0))
"RTN","LA7VSET",190,0)
 I PR D GETLL(PR)
"RTN","LA7VSET",191,0)
 ;
"RTN","LA7VSET",192,0)
 W !!
"RTN","LA7VSET",193,0)
 D KDIR
"RTN","LA7VSET",194,0)
 S DIR("A")="Setup/update Logical Link",DIR(0)="YO"
"RTN","LA7VSET",195,0)
 D ^DIR
"RTN","LA7VSET",196,0)
 I $D(DIRUT) Q
"RTN","LA7VSET",197,0)
 I Y=1 D TCP^LA7VLL(HOST(LA7A),LA7VS)
"RTN","LA7VSET",198,0)
 ;
"RTN","LA7VSET",199,0)
 Q
"RTN","LA7VSET",200,0)
 ;
"RTN","LA7VSET",201,0)
 ;
"RTN","LA7VSET",202,0)
CHTST ;Enter CHEM Test into the AUTO INSTRUMENT file (#62.4)
"RTN","LA7VSET",203,0)
 ;
"RTN","LA7VSET",204,0)
 N DA,DIC,DIE,DR,AI,LA7624
"RTN","LA7VSET",205,0)
 ;
"RTN","LA7VSET",206,0)
 S (AI,X)="LA7V HOST "_$P(HOST(LA7A),U)
"RTN","LA7VSET",207,0)
 S DIC(0)="QEM",DIC="^LAB(62.4," D ^DIC
"RTN","LA7VSET",208,0)
 I +Y<1 Q
"RTN","LA7VSET",209,0)
 S LA7624=+Y
"RTN","LA7VSET",210,0)
 ;
"RTN","LA7VSET",211,0)
 W !!,"AUTOMATED INSTRUMENT: ",$P(^LAB(62.4,LA7624,0),U)
"RTN","LA7VSET",212,0)
 ;
"RTN","LA7VSET",213,0)
 L +^LAB(62.4,LA7624):1
"RTN","LA7VSET",214,0)
 I '$T W !,?5,"Another user is editing this entry." Q
"RTN","LA7VSET",215,0)
 ;
"RTN","LA7VSET",216,0)
 S DA=LA7624,DIE=DIC,DR="3;10;11;12;18;107"
"RTN","LA7VSET",217,0)
 D ^DIE
"RTN","LA7VSET",218,0)
 W !,"Add Chem Tests to the "_AI_" Automated Instrument for "_$P(HOST(LA7A),U,2)_".",!!
"RTN","LA7VSET",219,0)
 D CHSET
"RTN","LA7VSET",220,0)
 ;
"RTN","LA7VSET",221,0)
 L -^LAB(62.4,LA7624)
"RTN","LA7VSET",222,0)
 ;
"RTN","LA7VSET",223,0)
 Q
"RTN","LA7VSET",224,0)
 ;
"RTN","LA7VSET",225,0)
 ;
"RTN","LA7VSET",226,0)
CHSET ; Edit chem test multiple for selected fields
"RTN","LA7VSET",227,0)
 ; Entry locked from above.
"RTN","LA7VSET",228,0)
 N DA,DO,DIC,DIE,DLAYGO,DR,LA7NLT,LA7Y
"RTN","LA7VSET",229,0)
 ;
"RTN","LA7VSET",230,0)
 S DA(1)=LA7624,DLAYGO=62.4
"RTN","LA7VSET",231,0)
 S DIC="^LAB(62.4,"_DA(1)_",3,",DIC(0)="AELMQZ",DIC("DR")=".01",DIC("P")=$P(^DD(62.4,30,0),U,2)
"RTN","LA7VSET",232,0)
 F  D  Q:LA7Y<1
"RTN","LA7VSET",233,0)
 . D ^DIC S LA7Y=Y Q:LA7Y<1
"RTN","LA7VSET",234,0)
 . S DIE=DIC
"RTN","LA7VSET",235,0)
 . N DA,DIC,DLAYGO ; Protect variables in case changed in DIE call.
"RTN","LA7VSET",236,0)
 . S LA7NLT=$$GET1^DIQ(64,+$P($G(^LAB(60,$P(LA7Y,U,2),64)),U,2)_",",1)
"RTN","LA7VSET",237,0)
 . S DA=+LA7Y,DA(1)=LA7624
"RTN","LA7VSET",238,0)
 . S DR=".01;2;6//"_LA7NLT_";14;16;18//YES;19;22//NO"
"RTN","LA7VSET",239,0)
 . D ^DIE
"RTN","LA7VSET",240,0)
 . W !
"RTN","LA7VSET",241,0)
 Q
"RTN","LA7VSET",242,0)
 ;
"RTN","LA7VSET",243,0)
 ;
"RTN","LA7VSET",244,0)
REMOTE ;COLLECTION Lab Setup Menu
"RTN","LA7VSET",245,0)
 ;
"RTN","LA7VSET",246,0)
 D COLLECT^LA7VSET1
"RTN","LA7VSET",247,0)
 Q
"RTN","LA7VSET",248,0)
 ;
"RTN","LA7VSET",249,0)
 ;
"RTN","LA7VSET",250,0)
MHLP ;Main help
"RTN","LA7VSET",251,0)
 S DIR("?")=" "
"RTN","LA7VSET",252,0)
 S DIR("?",1)="Option #1 will setup HOST site auto-instruments, HOST site message"
"RTN","LA7VSET",253,0)
 S DIR("?",2)="configuration, and HOST and COLLECTION sites HL7 environment."
"RTN","LA7VSET",254,0)
 S DIR("?",3)=" "
"RTN","LA7VSET",255,0)
 S DIR("?",4)="Option #2 will setup COLLECTION site auto-instruments, COLLECTION site message"
"RTN","LA7VSET",256,0)
 S DIR("?",5)="configuration, and COLLECTION and HOST sites HL7 environment."
"RTN","LA7VSET",257,0)
 S DIR("?",6)=" "
"RTN","LA7VSET",258,0)
 S DIR("?",7)="Option #1 and #2 SHOULD be used by sites that are both a HOST"
"RTN","LA7VSET",259,0)
 S DIR("?",8)="and a COLLECTION site."
"RTN","LA7VSET",260,0)
 Q
"RTN","LA7VSET",261,0)
 ;
"RTN","LA7VSET",262,0)
 ;
"RTN","LA7VSET",263,0)
H1HLP ;HOST Lab(s) help
"RTN","LA7VSET",264,0)
 S DIR("?")="Enter a number between 1 and "_LA7CNT_"."
"RTN","LA7VSET",265,0)
 S DIR("?",1)="Enter a '"_LA7CNT_"' to create a new HOST lab."
"RTN","LA7VSET",266,0)
 Q
"RTN","LA7VSET",267,0)
 ;
"RTN","LA7VSET",268,0)
 ;
"RTN","LA7VSET",269,0)
H2HLP ;HOST Lab Setup help
"RTN","LA7VSET",270,0)
 S DIR("?")=" "
"RTN","LA7VSET",271,0)
 S DIR("?",1)="Enter a '1' to create the HL7 environment along with the Auto-Instrument"
"RTN","LA7VSET",272,0)
 S DIR("?",2)="and LA7 Message Configuration."
"RTN","LA7VSET",273,0)
 S DIR("?",3)="Enter a '2' to create the link between the HOST and COLLECTION labs."
"RTN","LA7VSET",274,0)
 S DIR("?",5)="Enter a '3' to configure the LA7 MESSAGE PARAMETER file."
"RTN","LA7VSET",275,0)
 S DIR("?",4)="Enter a '4' to identify the list of test you expect back from the HOST lab."
"RTN","LA7VSET",276,0)
 Q
"RTN","LA7VSET",277,0)
 ;
"RTN","LA7VSET",278,0)
 ;
"RTN","LA7VSET",279,0)
CONV ;Convert #62.4 and #62.48 from REMOTE to COLLECTION (File #771 will remain REMOTE).
"RTN","LA7VSET",280,0)
 N RMT,RMT1,UPDT,IEN
"RTN","LA7VSET",281,0)
 K DA,DR,DIE
"RTN","LA7VSET",282,0)
 S DIE="^LAB(62.4,"
"RTN","LA7VSET",283,0)
 S RMT1="LA7V REMOTE ",RMT=RMT1
"RTN","LA7VSET",284,0)
 F  S RMT=$O(^LAB(62.4,"B",RMT)) Q:RMT=""!(RMT'[RMT1)  D
"RTN","LA7VSET",285,0)
 . S IEN=$O(^LAB(62.4,"B",RMT,0))
"RTN","LA7VSET",286,0)
 . S NAME="LA7V COLLECTION"_$P($P(^LAB(62.4,IEN,0),U),"REMOTE",2)
"RTN","LA7VSET",287,0)
 . S DA=IEN,DR=".01///"_NAME
"RTN","LA7VSET",288,0)
 . W !,"Renaming Auto-Instrument "_$P(^LAB(62.4,IEN,0),U)_" to "_NAME
"RTN","LA7VSET",289,0)
 . D ^DIE
"RTN","LA7VSET",290,0)
 . S UPDT=1
"RTN","LA7VSET",291,0)
 K DA,DR,DIE
"RTN","LA7VSET",292,0)
 S DIE="^LAHM(62.48,"
"RTN","LA7VSET",293,0)
 S RMT1="LA7V REMOTE ",RMT=RMT1
"RTN","LA7VSET",294,0)
 F  S RMT=$O(^LAHM(62.48,"B",RMT)) Q:RMT=""!(RMT'[RMT1)  D
"RTN","LA7VSET",295,0)
 . S IEN=$O(^LAHM(62.48,"B",RMT,0))
"RTN","LA7VSET",296,0)
 . S NAME="LA7V COLLECTION"_$P($P(^LAHM(62.48,IEN,0),U),"REMOTE",2)
"RTN","LA7VSET",297,0)
 . S DA=IEN,DR=".01///"_NAME
"RTN","LA7VSET",298,0)
 . W !,"Renaming LA7 Message Configuration "_$P(^LAHM(62.48,IEN,0),U)_" to "_NAME
"RTN","LA7VSET",299,0)
 . D ^DIE
"RTN","LA7VSET",300,0)
 . S UPDT=1
"RTN","LA7VSET",301,0)
 I $G(UPDT)=1 D
"RTN","LA7VSET",302,0)
 . N DIR,DIRUT
"RTN","LA7VSET",303,0)
 . W !!,"For consistency and clarity the above Auto-Instrument names"
"RTN","LA7VSET",304,0)
 . W !,"and Message Configurations have been changed from REMOTE to COLLECTION."
"RTN","LA7VSET",305,0)
 . S DIR(0)="E" D ^DIR
"RTN","LA7VSET",306,0)
 Q
"RTN","LA7VSET",307,0)
 ;
"RTN","LA7VSET",308,0)
 ;
"RTN","LA7VSET",309,0)
GETLL(LA7X) ; Get Lower Level Protocol information for displaying
"RTN","LA7VSET",310,0)
 ; Call with LA7X = ien of file #101 protocol
"RTN","LA7VSET",311,0)
 ;
"RTN","LA7VSET",312,0)
 ; Called from above and LA7VSET1
"RTN","LA7VSET",313,0)
 ;
"RTN","LA7VSET",314,0)
 N LA7Y
"RTN","LA7VSET",315,0)
 ;
"RTN","LA7VSET",316,0)
 D GETS^DIQ(101,LA7X_",",".01;770.7","IE","LA7Y")
"RTN","LA7VSET",317,0)
 ;
"RTN","LA7VSET",318,0)
 W !,?3,$G(LA7Y(101,LA7X_",",.01,"E"))
"RTN","LA7VSET",319,0)
 W ?40,$G(LA7Y(101,LA7X_",",770.7,"E"))
"RTN","LA7VSET",320,0)
 I $G(LA7Y(101,LA7X_",",770.7,"I")) W " ("_$$GET1^DIQ(870,+LA7Y(101,LA7X_",",770.7,"I")_",",2)_")"
"RTN","LA7VSET",321,0)
 ;
"RTN","LA7VSET",322,0)
 Q
"RTN","LA7VSET1")
0^29^B33313694
"RTN","LA7VSET1",1,0)
LA7VSET1 ;DALOI/JMC - MENU TO SETUP VISN LABS ; 12/3/1997
"RTN","LA7VSET1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,51,55,46,64**;Sep 27, 1994
"RTN","LA7VSET1",3,0)
 ;
"RTN","LA7VSET1",4,0)
 ; Reference to HL LOGICAL LINK file (#870) supported by DBIA #1495, 1496, 2063
"RTN","LA7VSET1",5,0)
 ; Reference to PROTOCOL file (#101) supported by DBIA #872
"RTN","LA7VSET1",6,0)
 ; Reference to MAIL GROUP file (#3.8) supported by DBIA #2061
"RTN","LA7VSET1",7,0)
 ;
"RTN","LA7VSET1",8,0)
COLLECT ; Collection Lab Setup Menu
"RTN","LA7VSET1",9,0)
 ;
"RTN","LA7VSET1",10,0)
 N LA7CNT,LA7,LA7P,LA7A,REMOTE
"RTN","LA7VSET1",11,0)
 ;
"RTN","LA7VSET1",12,0)
 ;
"RTN","LA7VSET1",13,0)
 F  D  Q:'LA7A
"RTN","LA7VSET1",14,0)
 . S REMOTE="COLLECTION Lab(s)"
"RTN","LA7VSET1",15,0)
 . D RMTBLD,RMTHDR,RMTLST,KDIR
"RTN","LA7VSET1",16,0)
 . W !! S DIR(0)="NO^1:"_LA7CNT
"RTN","LA7VSET1",17,0)
 . D R1HLP
"RTN","LA7VSET1",18,0)
 . D ^DIR
"RTN","LA7VSET1",19,0)
 . I $D(DIRUT) S LA7A=0 Q
"RTN","LA7VSET1",20,0)
 . S LA7A=Y D AEREMT
"RTN","LA7VSET1",21,0)
 Q
"RTN","LA7VSET1",22,0)
 ;
"RTN","LA7VSET1",23,0)
 ;
"RTN","LA7VSET1",24,0)
RMTBLD ; Identify all COLLECTION labs using LA7 MESSAGE PARAMETER file (#62.48)
"RTN","LA7VSET1",25,0)
 ;
"RTN","LA7VSET1",26,0)
 N LA7,LA74,SNAME,SNUM
"RTN","LA7VSET1",27,0)
 S LA7CNT=1,(LA7,LA7P)="LA7V COLLECTION "
"RTN","LA7VSET1",28,0)
 F  S LA7=$O(^LAHM(62.48,"B",LA7)) Q:LA7=""!(LA7'[LA7P)  D
"RTN","LA7VSET1",29,0)
 . S SNUM=$P(LA7,"COLLECTION ",2)
"RTN","LA7VSET1",30,0)
 . S LA74=$$FINDSITE^LA7VHLU2(SNUM,2,1) Q:LA74'>0
"RTN","LA7VSET1",31,0)
 . S SNAME=$P($$NS^XUAF4(LA74),"^")
"RTN","LA7VSET1",32,0)
 . S REMOTE(LA7CNT)=SNUM_U_SNAME_U_LA7_U_LA74,LA7CNT=LA7CNT+1
"RTN","LA7VSET1",33,0)
 S REMOTE(LA7CNT)=""
"RTN","LA7VSET1",34,0)
 Q
"RTN","LA7VSET1",35,0)
 ;
"RTN","LA7VSET1",36,0)
 ;
"RTN","LA7VSET1",37,0)
RMTHDR ; Collection setup header
"RTN","LA7VSET1",38,0)
 ;
"RTN","LA7VSET1",39,0)
 W @IOF,! F X=1:1:79 W "-"
"RTN","LA7VSET1",40,0)
 W !,?((80-$L(REMOTE))/2),REMOTE
"RTN","LA7VSET1",41,0)
 W ! F X=1:1:79 W "-"
"RTN","LA7VSET1",42,0)
 W !!
"RTN","LA7VSET1",43,0)
 ;
"RTN","LA7VSET1",44,0)
 Q
"RTN","LA7VSET1",45,0)
 ;
"RTN","LA7VSET1",46,0)
 ;
"RTN","LA7VSET1",47,0)
RMTLST ;
"RTN","LA7VSET1",48,0)
 S LA7CNT=1,LA7=0
"RTN","LA7VSET1",49,0)
 F  S LA7=$O(REMOTE(LA7)) Q:'LA7  D
"RTN","LA7VSET1",50,0)
 . I REMOTE(LA7)="" Q
"RTN","LA7VSET1",51,0)
 . W !,LA7,".",?5,$P(REMOTE(LA7),U,2)_"  ("_$P(REMOTE(LA7),U,3)_")"
"RTN","LA7VSET1",52,0)
 . S LA7CNT=LA7CNT+1
"RTN","LA7VSET1",53,0)
 ;
"RTN","LA7VSET1",54,0)
 W !,LA7CNT,".",?5,"Add COLLECTION Lab"
"RTN","LA7VSET1",55,0)
 ;
"RTN","LA7VSET1",56,0)
 Q
"RTN","LA7VSET1",57,0)
 ;
"RTN","LA7VSET1",58,0)
 ;
"RTN","LA7VSET1",59,0)
RMTHDR2 ;
"RTN","LA7VSET1",60,0)
 N LA7624,LA76248,LA7870,LA7X
"RTN","LA7VSET1",61,0)
 ;
"RTN","LA7VSET1",62,0)
 S LA7CNT=1
"RTN","LA7VSET1",63,0)
 W !!,"1. COLLECTION Lab: ",?15,$P(REMOTE(LA7A),U,2)
"RTN","LA7VSET1",64,0)
 W:$P(REMOTE(LA7A),U,2)'="" "  (Uneditable)"
"RTN","LA7VSET1",65,0)
 ;
"RTN","LA7VSET1",66,0)
 I $P(REMOTE(LA7A),U,2)="" Q
"RTN","LA7VSET1",67,0)
 ;
"RTN","LA7VSET1",68,0)
 D LINK^HLUTIL3($P(REMOTE(LA7A),"^",4),.LA7X,"")
"RTN","LA7VSET1",69,0)
 S LA7870=+$O(LA7X(0))
"RTN","LA7VSET1",70,0)
 I 'LA7870 D
"RTN","LA7VSET1",71,0)
 . S LA7870=+$$FIND1^DIC(870,"","OX","LA7V"_$P(REMOTE(LA7A),U))
"RTN","LA7VSET1",72,0)
 . I 'LA7870 S LA7870=+$$FIND1^DIC(870,"","OX","LA7V "_$P(REMOTE(LA7A),U))
"RTN","LA7VSET1",73,0)
 . I LA7870 S LA7X(LA7870)=$$GET1^DIQ(870,LA7870_",",.01)
"RTN","LA7VSET1",74,0)
 S LA7CNT=2
"RTN","LA7VSET1",75,0)
 W !,"2. Logical Link (TCP/IP): ",$G(LA7X(LA7870))
"RTN","LA7VSET1",76,0)
 ;
"RTN","LA7VSET1",77,0)
 S LA76248=$$FIND1^DIC(62.48,"","OX","LA7V COLLECTION "_$P(REMOTE(LA7A),U)),LA7CNT=3
"RTN","LA7VSET1",78,0)
 W !,"3. Message Configuration: ",$$GET1^DIQ(62.48,LA76248_",",.01)
"RTN","LA7VSET1",79,0)
 Q
"RTN","LA7VSET1",80,0)
 ;
"RTN","LA7VSET1",81,0)
 ;
"RTN","LA7VSET1",82,0)
AEREMT ;
"RTN","LA7VSET1",83,0)
 ;
"RTN","LA7VSET1",84,0)
 N CHA
"RTN","LA7VSET1",85,0)
 ;
"RTN","LA7VSET1",86,0)
 F  S REMOTE="COLLECTION Lab Setup" D RMTHDR,RMTHDR2,KDIR W !! S DIR(0)="NO^1:"_LA7CNT D R2HLP D ^DIR S CHA=Y D:CHA>0   Q:+CHA'>0
"RTN","LA7VSET1",87,0)
 . I CHA=1 D RLAB($P(REMOTE(LA7A),U))
"RTN","LA7VSET1",88,0)
 . I CHA=2 D RLL
"RTN","LA7VSET1",89,0)
 . I CHA=3 D LMC
"RTN","LA7VSET1",90,0)
 Q
"RTN","LA7VSET1",91,0)
 ;
"RTN","LA7VSET1",92,0)
 ;
"RTN","LA7VSET1",93,0)
LMC ; Edit Lab message configuration file
"RTN","LA7VSET1",94,0)
 ;
"RTN","LA7VSET1",95,0)
 N DIC,DA,DR,DIE,LA76248
"RTN","LA7VSET1",96,0)
 ;
"RTN","LA7VSET1",97,0)
 S LA76248=$$FIND1^DIC(62.48,"","OX","LA7V COLLECTION "_$P(REMOTE(LA7A),U))
"RTN","LA7VSET1",98,0)
 I LA76248<0 W !,"You have not entered a "_LAB_" lab." Q
"RTN","LA7VSET1",99,0)
 S DA=LA76248,DIE="^LAHM(62.48,",DR="3;4;10;@20;20;I X'="""" S Y=""@20"""
"RTN","LA7VSET1",100,0)
 D ^DIE
"RTN","LA7VSET1",101,0)
 Q
"RTN","LA7VSET1",102,0)
 ;
"RTN","LA7VSET1",103,0)
 ;
"RTN","LA7VSET1",104,0)
RLAB(LRI) ;Add REMOTE LAB
"RTN","LA7VSET1",105,0)
 ;
"RTN","LA7VSET1",106,0)
 N INST,LA7VER
"RTN","LA7VSET1",107,0)
 ;
"RTN","LA7VSET1",108,0)
 I $P(REMOTE(LA7A),U)'="" D KDIR S DIR("A")="Are you sure you want to update the "_$P(REMOTE(LA7A),U,2)_" interface",DIR(0)="Y0" D ^DIR Q:+Y'>0
"RTN","LA7VSET1",109,0)
 ;
"RTN","LA7VSET1",110,0)
 I $P(REMOTE(LA7A),U)="" D
"RTN","LA7VSET1",111,0)
 . N DIC,DA,DO
"RTN","LA7VSET1",112,0)
 . S DIC="^DIC(4,",DIC(0)="AEMQZ"
"RTN","LA7VSET1",113,0)
 . S DIC("S")="N LA7X S LA7X=$G(^(99)) I ($L($P(LA7X,U))&$P(LA7X,U,5)=""VA"")!($P(LA7X,U)=""""&$P(LA7X,U,5)'=""VA"")"
"RTN","LA7VSET1",114,0)
 . D ^DIC Q:Y<1
"RTN","LA7VSET1",115,0)
 . S INST=+Y
"RTN","LA7VSET1",116,0)
 . I PRIMARY=INST!(INST=DUZ(2)) D  Q
"RTN","LA7VSET1",117,0)
 . . W !,"To add your Hospital as a COLLECTION site just add HOST sites."
"RTN","LA7VSET1",118,0)
 . S REMOTE(LA7A+1)=REMOTE(LA7A)
"RTN","LA7VSET1",119,0)
 . S REMOTE(LA7A)=$$RETFACID^LA7VHLU2(INST,2,1)_U_$P($$NS^XUAF4(INST),"^")_"^^"_INST
"RTN","LA7VSET1",120,0)
 ;
"RTN","LA7VSET1",121,0)
 I $P(REMOTE(LA7A),U)="" S $P(REMOTE(LA7A),U,2)="" Q
"RTN","LA7VSET1",122,0)
 ;
"RTN","LA7VSET1",123,0)
 I PRIMARY'=$P(REMOTE(LA7A),U) D
"RTN","LA7VSET1",124,0)
 . S LA7VER=2.3
"RTN","LA7VSET1",125,0)
 . I $$NVAF^LA7VHLU2($P(REMOTE(LA7A),"^",4))=1 S LA7VER=2.2
"RTN","LA7VSET1",126,0)
 . D REMOTE^LA7VSTP(PRIMARY,PRSITE,$P(REMOTE(LA7A),U),$P(REMOTE(LA7A),U,2),LA7VER)
"RTN","LA7VSET1",127,0)
 ;
"RTN","LA7VSET1",128,0)
 Q
"RTN","LA7VSET1",129,0)
 ;
"RTN","LA7VSET1",130,0)
 ;
"RTN","LA7VSET1",131,0)
 ;
"RTN","LA7VSET1",132,0)
RLL ; add/edit logical link
"RTN","LA7VSET1",133,0)
 ;
"RTN","LA7VSET1",134,0)
 N HDR,PR,LA7LL
"RTN","LA7VSET1",135,0)
 ;
"RTN","LA7VSET1",136,0)
 S HDR="Logical Link for transmissions to/from "_$P(REMOTE(LA7A),U,2)
"RTN","LA7VSET1",137,0)
 W @IOF,! F X=1:1:79 W "-"
"RTN","LA7VSET1",138,0)
 W !,?((80-$L(HDR))/2),HDR
"RTN","LA7VSET1",139,0)
 W ! F X=1:1:79 W "-"
"RTN","LA7VSET1",140,0)
 W !,?3,"Protocol",?40,"Logical Link",!,?3,"----------",?40,"---------------",!!
"RTN","LA7VSET1",141,0)
 ;
"RTN","LA7VSET1",142,0)
 S PR=$O(^ORD(101,"B","LA7V Process Order from "_$P(REMOTE(LA7A),U),0))
"RTN","LA7VSET1",143,0)
 I PR D GETLL^LA7VSET(PR)
"RTN","LA7VSET1",144,0)
 ;
"RTN","LA7VSET1",145,0)
 S PR=$O(^ORD(101,"B","LA7V Send Results to "_$P(REMOTE(LA7A),U),0))
"RTN","LA7VSET1",146,0)
 I PR D GETLL^LA7VSET(PR)
"RTN","LA7VSET1",147,0)
 ;
"RTN","LA7VSET1",148,0)
 W !!
"RTN","LA7VSET1",149,0)
 D KDIR
"RTN","LA7VSET1",150,0)
 S DIR("A")="Setup/update Logical Link",DIR(0)="YO"
"RTN","LA7VSET1",151,0)
 D ^DIR
"RTN","LA7VSET1",152,0)
 I $D(DIRUT) Q
"RTN","LA7VSET1",153,0)
 I Y=1 D TCP^LA7VLL(REMOTE(LA7A),LA7VS)
"RTN","LA7VSET1",154,0)
 ;
"RTN","LA7VSET1",155,0)
 Q
"RTN","LA7VSET1",156,0)
 ;
"RTN","LA7VSET1",157,0)
 ;
"RTN","LA7VSET1",158,0)
R1HLP ; HOST Lab(s) help
"RTN","LA7VSET1",159,0)
 S DIR("?")="Enter a number between 1 and "_LA7CNT_"."
"RTN","LA7VSET1",160,0)
 S DIR("?",1)="Enter a '"_LA7CNT_"' to create a new COLLECTION lab."
"RTN","LA7VSET1",161,0)
 Q
"RTN","LA7VSET1",162,0)
 ;
"RTN","LA7VSET1",163,0)
 ;
"RTN","LA7VSET1",164,0)
R2HLP ; HOST Lab Setup help
"RTN","LA7VSET1",165,0)
 S DIR("?")="Enter a number between 1 and "_LA7CNT_".  For new entries begin with '1.  HOST Lab:'"
"RTN","LA7VSET1",166,0)
 S DIR("?",1)="Enter a '1' to create the HL7 environment along with the Auto-Instrument"
"RTN","LA7VSET1",167,0)
 S DIR("?",2)="and LA7 Message Configuration."
"RTN","LA7VSET1",168,0)
 S DIR("?",3)="Enter a '2' to create the link between the COLLECTION and HOST labs."
"RTN","LA7VSET1",169,0)
 S DIR("?",4)="Enter a '3' to configure the LA7 MESSAGE PARAMETER file."
"RTN","LA7VSET1",170,0)
 Q
"RTN","LA7VSET1",171,0)
 ;
"RTN","LA7VSET1",172,0)
KDIR ;
"RTN","LA7VSET1",173,0)
 K DIR,DIRUT,DUOUT,DTOUT,DIROUT,X,Y
"RTN","LA7VSET1",174,0)
 Q
"RTN","LA7VSTP")
0^27^B33029654
"RTN","LA7VSTP",1,0)
LA7VSTP ;DALOI/JMC - HL7 environment setup routine ; 12/3/1997
"RTN","LA7VSTP",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,44,51,46,64**;Sep 27, 1994
"RTN","LA7VSTP",3,0)
 ; This routine will create LEDI and UNIVERSAL INTERFACE HL7 v1.6 file setups.
"RTN","LA7VSTP",4,0)
 ;
"RTN","LA7VSTP",5,0)
 ; Reference to PROTOCOL file (#101) supported by DBIA #872
"RTN","LA7VSTP",6,0)
 ;
"RTN","LA7VSTP",7,0)
HOST(PRIMARY,PRSITE,LRI,SITE,LA7VER) ;
"RTN","LA7VSTP",8,0)
 ;
"RTN","LA7VSTP",9,0)
 N LA7Y,LAREMOTE,LAHOST,LASERV,LACLNT,LRS,PROT,ORU
"RTN","LA7VSTP",10,0)
 ;
"RTN","LA7VSTP",11,0)
 I $G(LRI)="" D EXIT Q
"RTN","LA7VSTP",12,0)
 ;
"RTN","LA7VSTP",13,0)
 W !,"Setting up the following Host Labs for "_PRSITE
"RTN","LA7VSTP",14,0)
 W !,"  Updating HL7 APPLICATION PARAMETER file (#771)."
"RTN","LA7VSTP",15,0)
 ;
"RTN","LA7VSTP",16,0)
 S LA7VER=$S($G(LA7VER)]"":LA7VER,1:2.3)
"RTN","LA7VSTP",17,0)
 S LAREMOTE="LA7V REMOTE "_PRIMARY
"RTN","LA7VSTP",18,0)
 S $P(LAREMOTE,"^",2)=$$SETAPP(LAREMOTE,PRIMARY)
"RTN","LA7VSTP",19,0)
 ;
"RTN","LA7VSTP",20,0)
 S LAHOST="LA7V HOST "_LRI
"RTN","LA7VSTP",21,0)
 S $P(LAHOST,"^",2)=$$SETAPP(LAHOST,LRI)
"RTN","LA7VSTP",22,0)
 ;
"RTN","LA7VSTP",23,0)
 W !,"  Updating PROTOCOL file (#101)."
"RTN","LA7VSTP",24,0)
 ;
"RTN","LA7VSTP",25,0)
 ; Setup protocols to receive and process result (ORU) messages.
"RTN","LA7VSTP",26,0)
 ; Create event & subscriber protocols.
"RTN","LA7VSTP",27,0)
 K LASERV
"RTN","LA7VSTP",28,0)
 S LASERV="LA7V Receive Results from "_LRI
"RTN","LA7VSTP",29,0)
 S LASERV(4)="E"
"RTN","LA7VSTP",30,0)
 S LASERV(770.1)=$P(LAHOST,"^")
"RTN","LA7VSTP",31,0)
 S LASERV(770.3)="ORU"
"RTN","LA7VSTP",32,0)
 S LASERV(770.4)="R01"
"RTN","LA7VSTP",33,0)
 S LASERV(770.95)=LA7VER
"RTN","LA7VSTP",34,0)
 D SETPRO(.LASERV)
"RTN","LA7VSTP",35,0)
 ;
"RTN","LA7VSTP",36,0)
 K LACLNT
"RTN","LA7VSTP",37,0)
 S LACLNT="LA7V Process Results from "_LRI
"RTN","LA7VSTP",38,0)
 S LACLNT(4)="S"
"RTN","LA7VSTP",39,0)
 S LACLNT(770.2)=$P(LAREMOTE,"^")
"RTN","LA7VSTP",40,0)
 S LACLNT(770.3)="@"
"RTN","LA7VSTP",41,0)
 S LACLNT(770.4)="R01"
"RTN","LA7VSTP",42,0)
 S LACLNT(770.11)="ACK"
"RTN","LA7VSTP",43,0)
 S LACLNT(770.95)=LA7VER
"RTN","LA7VSTP",44,0)
 S LACLNT(771)="D ORU^LA7VHL"
"RTN","LA7VSTP",45,0)
 F I=773.1,773.2,773.4 S LACLNT(I)=1
"RTN","LA7VSTP",46,0)
 D SETPRO(.LACLNT)
"RTN","LA7VSTP",47,0)
 ;
"RTN","LA7VSTP",48,0)
 ; Add subscriber to event.
"RTN","LA7VSTP",49,0)
 D ADDSUB(LASERV,LACLNT)
"RTN","LA7VSTP",50,0)
 ;
"RTN","LA7VSTP",51,0)
 ; Setup protocols to build and send order (ORM) messages.
"RTN","LA7VSTP",52,0)
 ; Create event & subscriber protocols.
"RTN","LA7VSTP",53,0)
 K LASERV
"RTN","LA7VSTP",54,0)
 S LASERV="LA7V Order to "_LRI
"RTN","LA7VSTP",55,0)
 S LASERV(4)="E"
"RTN","LA7VSTP",56,0)
 S LASERV(770.1)=$P(LAREMOTE,"^")
"RTN","LA7VSTP",57,0)
 S LASERV(770.3)="ORM"
"RTN","LA7VSTP",58,0)
 S LASERV(770.4)="O01"
"RTN","LA7VSTP",59,0)
 F I=770.2,770.11 S LASERV(I)="@"
"RTN","LA7VSTP",60,0)
 F I=770.8,770.9 S LASERV(I)="AL"
"RTN","LA7VSTP",61,0)
 S LASERV(770.95)=LA7VER
"RTN","LA7VSTP",62,0)
 S LASERV(772)="D ORR^LA7VHL"
"RTN","LA7VSTP",63,0)
 D SETPRO(.LASERV)
"RTN","LA7VSTP",64,0)
 ;
"RTN","LA7VSTP",65,0)
 K LACLNT
"RTN","LA7VSTP",66,0)
 S LACLNT="LA7V Send Order to "_LRI
"RTN","LA7VSTP",67,0)
 S LACLNT(4)="S"
"RTN","LA7VSTP",68,0)
 S LACLNT(770.2)=$P(LAHOST,"^")
"RTN","LA7VSTP",69,0)
 S LACLNT(770.4)="O02"
"RTN","LA7VSTP",70,0)
 S LACLNT(770.11)="ORR"
"RTN","LA7VSTP",71,0)
 S LACLNT(770.95)=LA7VER
"RTN","LA7VSTP",72,0)
 F I=770.1,770.3 S LACLNT(I)="@"
"RTN","LA7VSTP",73,0)
 F I=773.1,773.2,773.4 S LACLNT(I)=1
"RTN","LA7VSTP",74,0)
 D SETPRO(.LACLNT)
"RTN","LA7VSTP",75,0)
 ;
"RTN","LA7VSTP",76,0)
 ; Add subscriber to event.
"RTN","LA7VSTP",77,0)
 D ADDSUB(LASERV,LACLNT)
"RTN","LA7VSTP",78,0)
 ;
"RTN","LA7VSTP",79,0)
 D HOST^LA7VSTP1
"RTN","LA7VSTP",80,0)
 D EXIT
"RTN","LA7VSTP",81,0)
 ;
"RTN","LA7VSTP",82,0)
 Q
"RTN","LA7VSTP",83,0)
 ;
"RTN","LA7VSTP",84,0)
 ;
"RTN","LA7VSTP",85,0)
REMOTE(PRIMARY,PRSITE,LRI,SITE,LA7VER) ;
"RTN","LA7VSTP",86,0)
 N LA7Y,LAREMOTE,LAHOST,LASERV,LACLNT,LRS,PROT,ORU
"RTN","LA7VSTP",87,0)
 ;
"RTN","LA7VSTP",88,0)
 I $G(LRI)="" D EXIT Q
"RTN","LA7VSTP",89,0)
 ;
"RTN","LA7VSTP",90,0)
 W !,"Setting up the REMOTE Lab, "_SITE_" and HOST Lab "_PRSITE
"RTN","LA7VSTP",91,0)
 W !,"   Updating HL7 APPLICATION PARAMETER file (#771)."
"RTN","LA7VSTP",92,0)
 ;
"RTN","LA7VSTP",93,0)
 S LA7VER=$S($G(LA7VER)]"":LA7VER,1:2.3)
"RTN","LA7VSTP",94,0)
 S LAHOST="LA7V HOST "_PRIMARY
"RTN","LA7VSTP",95,0)
 S $P(LAHOST,"^",2)=$$SETAPP(LAHOST,PRIMARY)
"RTN","LA7VSTP",96,0)
 ;
"RTN","LA7VSTP",97,0)
 S LAREMOTE="LA7V REMOTE "_LRI
"RTN","LA7VSTP",98,0)
 S $P(LAREMOTE,"^",2)=$$SETAPP(LAREMOTE,LRI)
"RTN","LA7VSTP",99,0)
 ;
"RTN","LA7VSTP",100,0)
 W !,"  Updating PROTOCOL file (#101)."
"RTN","LA7VSTP",101,0)
 ;
"RTN","LA7VSTP",102,0)
 ; Setup protocols to build and send results (ORU) message back.
"RTN","LA7VSTP",103,0)
 ; Create event & subscriber protocols.
"RTN","LA7VSTP",104,0)
 K LASERV
"RTN","LA7VSTP",105,0)
 S LASERV="LA7V Results Reporting to "_LRI
"RTN","LA7VSTP",106,0)
 S LASERV(4)="E"
"RTN","LA7VSTP",107,0)
 S LASERV(770.1)=$P(LAHOST,"^")
"RTN","LA7VSTP",108,0)
 S LASERV(770.3)="ORU"
"RTN","LA7VSTP",109,0)
 S LASERV(770.4)="R01"
"RTN","LA7VSTP",110,0)
 S LASERV(770.95)=LA7VER
"RTN","LA7VSTP",111,0)
 F I=770.8,770.9 S LASERV(I)="AL"
"RTN","LA7VSTP",112,0)
 S LASERV(772)="D ACK^LA7VHL"
"RTN","LA7VSTP",113,0)
 D SETPRO(.LASERV)
"RTN","LA7VSTP",114,0)
 ;
"RTN","LA7VSTP",115,0)
 K LACLNT
"RTN","LA7VSTP",116,0)
 S LACLNT="LA7V Send Results to "_LRI
"RTN","LA7VSTP",117,0)
 S LACLNT(4)="S"
"RTN","LA7VSTP",118,0)
 S LACLNT(770.2)=$P(LAREMOTE,"^")
"RTN","LA7VSTP",119,0)
 S LACLNT(770.3)="@"
"RTN","LA7VSTP",120,0)
 S LACLNT(770.4)="R01"
"RTN","LA7VSTP",121,0)
 S LACLNT(770.11)="ACK"
"RTN","LA7VSTP",122,0)
 S LACLNT(770.95)=LA7VER
"RTN","LA7VSTP",123,0)
 F I=773.1,773.2,773.4 S LACLNT(I)=1
"RTN","LA7VSTP",124,0)
 D SETPRO(.LACLNT)
"RTN","LA7VSTP",125,0)
 ;
"RTN","LA7VSTP",126,0)
 ; Add subscriber to event.
"RTN","LA7VSTP",127,0)
 D ADDSUB(LASERV,LACLNT)
"RTN","LA7VSTP",128,0)
 ;
"RTN","LA7VSTP",129,0)
 ; Setup protocols to receive and process order (ORM) messages.
"RTN","LA7VSTP",130,0)
 ; Create event & subscriber protocols.
"RTN","LA7VSTP",131,0)
 K LASERV
"RTN","LA7VSTP",132,0)
 S LASERV="LA7V Receive Order from "_LRI
"RTN","LA7VSTP",133,0)
 S LASERV(4)="E"
"RTN","LA7VSTP",134,0)
 S LASERV(770.1)=$P(LAREMOTE,"^")
"RTN","LA7VSTP",135,0)
 S LASERV(770.3)="ORM"
"RTN","LA7VSTP",136,0)
 S LASERV(770.4)="O01"
"RTN","LA7VSTP",137,0)
 S LASERV(770.95)=LA7VER
"RTN","LA7VSTP",138,0)
 F I=770.2,770.11 S LASERV(I)="@"
"RTN","LA7VSTP",139,0)
 D SETPRO(.LASERV)
"RTN","LA7VSTP",140,0)
 ;
"RTN","LA7VSTP",141,0)
 K LACLNT
"RTN","LA7VSTP",142,0)
 S LACLNT="LA7V Process Order from "_LRI
"RTN","LA7VSTP",143,0)
 S LACLNT(4)="S"
"RTN","LA7VSTP",144,0)
 S LACLNT(770.2)=$P(LAHOST,"^")
"RTN","LA7VSTP",145,0)
 S LACLNT(770.4)="O02"
"RTN","LA7VSTP",146,0)
 S LACLNT(770.11)="ORR"
"RTN","LA7VSTP",147,0)
 F I=770.1,770.3 S LACLNT(I)="@"
"RTN","LA7VSTP",148,0)
 F I=773.1,773.2,773.4 S LACLNT(I)=1
"RTN","LA7VSTP",149,0)
 S LACLNT(770.95)=LA7VER
"RTN","LA7VSTP",150,0)
 S LACLNT(771)="D IN^LA7VORM"
"RTN","LA7VSTP",151,0)
 D SETPRO(.LACLNT)
"RTN","LA7VSTP",152,0)
 ;
"RTN","LA7VSTP",153,0)
 ; Add subscriber to event.
"RTN","LA7VSTP",154,0)
 D ADDSUB(LASERV,LACLNT)
"RTN","LA7VSTP",155,0)
 ;
"RTN","LA7VSTP",156,0)
 D REMOTE^LA7VSTP1
"RTN","LA7VSTP",157,0)
 D EXIT
"RTN","LA7VSTP",158,0)
 ;
"RTN","LA7VSTP",159,0)
 Q
"RTN","LA7VSTP",160,0)
 ;
"RTN","LA7VSTP",161,0)
 ;
"RTN","LA7VSTP",162,0)
EXIT ; Exit with message
"RTN","LA7VSTP",163,0)
 W !!,"HL7 v1.6 Environment setup is complete!!"
"RTN","LA7VSTP",164,0)
 S LASERV(770.95)=LA7VER
"RTN","LA7VSTP",165,0)
 K DIR
"RTN","LA7VSTP",166,0)
 S DIR(0)="E" D ^DIR
"RTN","LA7VSTP",167,0)
 Q
"RTN","LA7VSTP",168,0)
 ;
"RTN","LA7VSTP",169,0)
 ;
"RTN","LA7VSTP",170,0)
SETAPP(LA7X,LA7FAC) ;sets up the HL7 APPLICATION PARAMETER file #771
"RTN","LA7VSTP",171,0)
 ;
"RTN","LA7VSTP",172,0)
 ; Call with LA7X = value of .01 field to add to file #771
"RTN","LA7VSTP",173,0)
 ;           LA7FAC = facility name
"RTN","LA7VSTP",174,0)
 ;
"RTN","LA7VSTP",175,0)
 N DIC,DIE,DLAYGO,DR,LA7Y
"RTN","LA7VSTP",176,0)
 ;
"RTN","LA7VSTP",177,0)
 S X=LA7X
"RTN","LA7VSTP",178,0)
 S DIC="^HL(771,",DLAYGO=771,DIC(0)="L"
"RTN","LA7VSTP",179,0)
 D ^DIC
"RTN","LA7VSTP",180,0)
 S LA7Y=Y
"RTN","LA7VSTP",181,0)
 W:$P(LA7Y,"^",3) !,"     Adding "_LA7X
"RTN","LA7VSTP",182,0)
 I +LA7Y<1 Q
"RTN","LA7VSTP",183,0)
 ;
"RTN","LA7VSTP",184,0)
 S DA=+LA7Y,DIE="^HL(771,",DR="2////a;3////"_LA7FAC
"RTN","LA7VSTP",185,0)
 D ^DIE
"RTN","LA7VSTP",186,0)
 Q $P(LA7Y,"^")
"RTN","LA7VSTP",187,0)
 ;
"RTN","LA7VSTP",188,0)
 ;
"RTN","LA7VSTP",189,0)
SETPRO(FIELDS) ;sets up the PROTOCOL file #101
"RTN","LA7VSTP",190,0)
 ; Call with   LA7X = Protocol name
"RTN","LA7VSTP",191,0)
 ;           FIELDS = FileMan fields array
"RTN","LA7VSTP",192,0)
 ;
"RTN","LA7VSTP",193,0)
 N DA,DIC,FDA,I,LA7DIE,LA7IENS
"RTN","LA7VSTP",194,0)
 ;
"RTN","LA7VSTP",195,0)
 S X=FIELDS,DIC="^ORD(101,",DIC(0)="L",DLAYGO=101
"RTN","LA7VSTP",196,0)
 D ^DIC
"RTN","LA7VSTP",197,0)
 I '$G(LA7QUIET) W !,FIELDS W:$P(Y,U,3) !,"     Adding "_X
"RTN","LA7VSTP",198,0)
 S DA=+Y
"RTN","LA7VSTP",199,0)
 I DA<0 Q
"RTN","LA7VSTP",200,0)
 ;
"RTN","LA7VSTP",201,0)
 S I=0,LA7IENS=DA_","
"RTN","LA7VSTP",202,0)
 F  S I=$O(FIELDS(I)) Q:'I  S FDA(1,101,LA7IENS,I)=FIELDS(I)
"RTN","LA7VSTP",203,0)
 S FDA(1,101,LA7IENS,770.6)="@"
"RTN","LA7VSTP",204,0)
 D FILE^DIE("E","FDA(1)","LA7DIE(1)")
"RTN","LA7VSTP",205,0)
 S FDA(2,101,LA7IENS,5)=DUZ
"RTN","LA7VSTP",206,0)
 D FILE^DIE("","FDA(2)","LA7DIE(2)")
"RTN","LA7VSTP",207,0)
 D CLEAN^DILF
"RTN","LA7VSTP",208,0)
 Q
"RTN","LA7VSTP",209,0)
 ;
"RTN","LA7VSTP",210,0)
 ;
"RTN","LA7VSTP",211,0)
ADDSUB(LA7EVNT,LA7SUB) ; Add subscriber to event protocol
"RTN","LA7VSTP",212,0)
 ; Call with LA7EVNT = name of event protocol
"RTN","LA7VSTP",213,0)
 ;            LA7SUB = name of subscriber protocol
"RTN","LA7VSTP",214,0)
 ;
"RTN","LA7VSTP",215,0)
 N DIC,DA,DR,D0,DLAYGO,LA7101E,LA7101S,X,Y
"RTN","LA7VSTP",216,0)
 ;
"RTN","LA7VSTP",217,0)
 I '$D(^ORD(101,"B",LA7SUB)) Q
"RTN","LA7VSTP",218,0)
 I '$D(^ORD(101,"B",LA7EVNT)) Q
"RTN","LA7VSTP",219,0)
 ;
"RTN","LA7VSTP",220,0)
 ; Get ien for event and subscriber protocols
"RTN","LA7VSTP",221,0)
 S LA7101E=$O(^ORD(101,"B",LA7EVNT,0))
"RTN","LA7VSTP",222,0)
 S LA7101S=$O(^ORD(101,"B",LA7SUB,0))
"RTN","LA7VSTP",223,0)
 ;
"RTN","LA7VSTP",224,0)
 ; Already listed as a subscriber to this event
"RTN","LA7VSTP",225,0)
 I $D(^ORD(101,LA7101E,775,"B",LA7101S)) Q
"RTN","LA7VSTP",226,0)
 ;
"RTN","LA7VSTP",227,0)
 S X=LA7SUB,DA(1)=LA7101E,DIC="^ORD(101,"_DA(1)_",775,"
"RTN","LA7VSTP",228,0)
 S DLAYGO=101.01,DIC(0)="QEL",DIC("P")=$P(^DD(101,775,0),U,2)
"RTN","LA7VSTP",229,0)
 D ^DIC
"RTN","LA7VSTP",230,0)
 ;
"RTN","LA7VSTP",231,0)
 Q
"RTN","LA7VSTP1")
0^40^B6778720
"RTN","LA7VSTP1",1,0)
LA7VSTP1 ;DALOI/JMC - CONT. from LA7VSTP ; 12/3/1997
"RTN","LA7VSTP1",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**27,46,64**;Sep 27, 1994
"RTN","LA7VSTP1",3,0)
 ;
"RTN","LA7VSTP1",4,0)
HOST ; Hosts setup for Remote site
"RTN","LA7VSTP1",5,0)
 ; changing remote site to collection site but not in File 771 (1-15 char)
"RTN","LA7VSTP1",6,0)
 ;
"RTN","LA7VSTP1",7,0)
 N LAREMOTE,LA7VAI
"RTN","LA7VSTP1",8,0)
 S LAREMOTE="LA7V COLLECTION "_PRIMARY
"RTN","LA7VSTP1",9,0)
 ;
"RTN","LA7VSTP1",10,0)
 W !,"Updating LA7 MESSAGE PARAMETER file (#62.48) for the HOST Lab "_SITE_"."
"RTN","LA7VSTP1",11,0)
 W !,?5,"Adding "_$P(LAHOST,"^")
"RTN","LA7VSTP1",12,0)
 ;
"RTN","LA7VSTP1",13,0)
 K DIC
"RTN","LA7VSTP1",14,0)
 S X=$P(LAHOST,"^"),DLAYGO=62.48,DIC="^LAHM(62.48,",DIC(0)="LQ"
"RTN","LA7VSTP1",15,0)
 D ^DIC K DA
"RTN","LA7VSTP1",16,0)
 I Y>0 D
"RTN","LA7VSTP1",17,0)
 . S DIE=DIC,DA=+Y,DR="1///HL7;2///ACTIVE;4///ON;11///LEDI"
"RTN","LA7VSTP1",18,0)
 . D ^DIE
"RTN","LA7VSTP1",19,0)
 . S (LA7VAI,DA(1))=DA,DIC="^LAHM(62.48,"_DA(1)_",90,",DLAYGO=62.483,DIC(0)="QEML",DIC("P")=$P(^DD(62.48,90,0),U,2)
"RTN","LA7VSTP1",20,0)
 . S X=$P(LAHOST,"^")_LRI_"LA7V REMOTE "_PRIMARY_PRIMARY
"RTN","LA7VSTP1",21,0)
 . D ^DIC
"RTN","LA7VSTP1",22,0)
 . S:$P(^LAHM(62.48,LA7VAI,0),U)=$P(LAHOST,"^") ^(1)="D QUE^LA7VIN"
"RTN","LA7VSTP1",23,0)
 . D F629(+$P(HOST(LA7A),"^",4),LA7VAI)
"RTN","LA7VSTP1",24,0)
 K DIC,DIE,DA,DR,DLAYGO
"RTN","LA7VSTP1",25,0)
 ;
"RTN","LA7VSTP1",26,0)
 ;
"RTN","LA7VSTP1",27,0)
HF624 ;
"RTN","LA7VSTP1",28,0)
 K LA7VAI
"RTN","LA7VSTP1",29,0)
 W !,"Updating LAB AUTO INSTRUMENT file (#62.4) for HOST Lab "_SITE_"."
"RTN","LA7VSTP1",30,0)
 W !,?5,"Adding "_$P(LAHOST,"^")
"RTN","LA7VSTP1",31,0)
 K DIC
"RTN","LA7VSTP1",32,0)
 S X=$P(LAHOST,"^"),DIC="^LAB(62.4,",DIC(0)="L",DLAYGO=62.4
"RTN","LA7VSTP1",33,0)
 S DIC("DR")="5///LOG;6///ID;8///"_$P(LAHOST,"^")_";18///1" D ^DIC
"RTN","LA7VSTP1",34,0)
 S LA7VAI=+Y
"RTN","LA7VSTP1",35,0)
 K DIC,DA,DO,DLAYGO
"RTN","LA7VSTP1",36,0)
 Q
"RTN","LA7VSTP1",37,0)
 ;
"RTN","LA7VSTP1",38,0)
 ;
"RTN","LA7VSTP1",39,0)
REMOTE ;Remote setup for Host site
"RTN","LA7VSTP1",40,0)
RF6248 ;
"RTN","LA7VSTP1",41,0)
 ;changing remote site to collection site but not in File 771 (1-15 char)
"RTN","LA7VSTP1",42,0)
 ;
"RTN","LA7VSTP1",43,0)
 N DIC,DIE,DA,DR,DLAYGO,LAREMOTE,LA7VAI
"RTN","LA7VSTP1",44,0)
 S LAREMOTE="LA7V COLLECTION "_LRI
"RTN","LA7VSTP1",45,0)
 ;
"RTN","LA7VSTP1",46,0)
 W !,"Updating LA7 MESSAGE PARAMETER file (#62.48) for the REMOTE Lab "_SITE_"."
"RTN","LA7VSTP1",47,0)
 W !,?5,"Adding "_LAREMOTE
"RTN","LA7VSTP1",48,0)
 ;
"RTN","LA7VSTP1",49,0)
 S X=LAREMOTE,DIC="^LAHM(62.48,",DIC(0)="LQ",DLAYGO=62.48
"RTN","LA7VSTP1",50,0)
 D ^DIC
"RTN","LA7VSTP1",51,0)
 I Y>0 D
"RTN","LA7VSTP1",52,0)
 . S DIE=DIC,DA=+Y,DR="1///HL7;2///ACTIVE;4///ON;11///LEDI"
"RTN","LA7VSTP1",53,0)
 . D ^DIE
"RTN","LA7VSTP1",54,0)
 . S (LA7VAI,DA(1))=DA,DIC="^LAHM(62.48,"_DA(1)_",90,",DIC(0)="QEML",DLAYGO=62.483,DIC("P")=$P(^DD(62.48,90,0),U,2)
"RTN","LA7VSTP1",55,0)
 . S X="LA7V REMOTE "_LRI_LRI_LAHOST_PRIMARY
"RTN","LA7VSTP1",56,0)
 . D ^DIC
"RTN","LA7VSTP1",57,0)
 . S:$P(^LAHM(62.48,LA7VAI,0),U)=LAREMOTE ^(1)="D QUE^LA7VIN"
"RTN","LA7VSTP1",58,0)
 ;
"RTN","LA7VSTP1",59,0)
 Q
"RTN","LA7VSTP1",60,0)
 ;
"RTN","LA7VSTP1",61,0)
 ;
"RTN","LA7VSTP1",62,0)
F629(LA74,LA76248) ; Update entries in #62.9 that use this message configuration (#62.48).
"RTN","LA7VSTP1",63,0)
 ; Check each shipping configuration that has this site as a host site's computer system.
"RTN","LA7VSTP1",64,0)
 ; Call with    LA74 = ien of entry in INSTITUTION file (#4)
"RTN","LA7VSTP1",65,0)
 ;           LA76248 = ien of entry in LA7 MESSAGE PARAMETER (#62.48)
"RTN","LA7VSTP1",66,0)
 ;
"RTN","LA7VSTP1",67,0)
 N FDA,LA7629,LA7DIE
"RTN","LA7VSTP1",68,0)
 ;
"RTN","LA7VSTP1",69,0)
 S LA7629=0
"RTN","LA7VSTP1",70,0)
 F  S LA7629=$O(^LAHM(62.9,"E",LA74,LA7629)) Q:'LA7629  D
"RTN","LA7VSTP1",71,0)
 . K FDA,LA7DIE
"RTN","LA7VSTP1",72,0)
 . S FDA(2,62.9,LA7629_",",.07)=LA76248
"RTN","LA7VSTP1",73,0)
 . D FILE^DIE("","FDA(2)","LA7DIE(2)")
"RTN","LA7VSTP1",74,0)
 Q
"RTN","LAGEN")
0^49^B37863247
"RTN","LAGEN",1,0)
LAGEN ;DALOI/CJS - LAB AUTOMATED DATA ;7/20/90  08:28
"RTN","LAGEN",2,0)
 ;;5.2;AUTOMATED LAB INSTRUMENTS;**1,17,22,27,47,46,64**;Sep 27, 1994
"RTN","LAGEN",3,0)
 Q
"RTN","LAGEN",4,0)
 ;
"RTN","LAGEN",5,0)
LOG ; Run by accession number.
"RTN","LAGEN",6,0)
 S LINK="",LRDFN=0,DPF=2
"RTN","LAGEN",7,0)
 I $G(LOG)<1 G LG2
"RTN","LAGEN",8,0)
 ; If overlay data -> find if accession exists in LAH
"RTN","LAGEN",9,0)
 I LROVER D  Q:ISQN>0
"RTN","LAGEN",10,0)
 . N I,X
"RTN","LAGEN",11,0)
 . S (ISQN,I)=0
"RTN","LAGEN",12,0)
 . F  S I=$O(^LAH(LWL,1,"C",LOG,I)) Q:I<1  D  Q:ISQN
"RTN","LAGEN",13,0)
 . . S X=$G(^LAH(LWL,1,I,0))
"RTN","LAGEN",14,0)
 . . ; Quit if different accession area.
"RTN","LAGEN",15,0)
 . . I $P(X,"^",3),$P(X,"^",3)'=WL Q
"RTN","LAGEN",16,0)
 . . ; Quit if different accession date and not a rollover accession (same original accession date).
"RTN","LAGEN",17,0)
 . . I $P(X,"^",4),$P(X,"^",4)'=LADT,$P($G(^LRO(68,WL,1,LADT,1,LOG,0)),"^",3)'=$P($G(^LRO(68,WL,1,$P(X,"^",4),1,LOG,0)),"^",3) Q
"RTN","LAGEN",18,0)
 . . S ISQN=I
"RTN","LAGEN",19,0)
 . . D UPDT(LWL,ISQN)
"RTN","LAGEN",20,0)
 I '$D(^LRO(68,WL,1,LADT,1,LOG,0)) S LINK="^^"_+LOG G LG2
"RTN","LAGEN",21,0)
 S X=^LRO(68,WL,1,LADT,1,LOG,0),LINK=WL_U_LADT_U_LOG,LRDFN=+X,DPF=$P(X,U,2)
"RTN","LAGEN",22,0)
LG2 D ISQN
"RTN","LAGEN",23,0)
 I $G(LOG)>0 S ^LAH(LWL,1,"C",LOG,ISQN)="",$P(^LAH(LWL,1,ISQN,0),U,3,5)=LINK
"RTN","LAGEN",24,0)
 I $G(CENUM)>0 S $P(^LAH(LWL,1,ISQN,0),U,6)=CENUM,^LAH(LWL,1,"D",+CENUM,ISQN)=""
"RTN","LAGEN",25,0)
 I $D(^LRO(68.2,LWL,1,+TRAY,1,+CUP,0)) S ^(4,ISQN)=""
"RTN","LAGEN",26,0)
 Q
"RTN","LAGEN",27,0)
 ;
"RTN","LAGEN",28,0)
 ;
"RTN","LAGEN",29,0)
ISQN ;
"RTN","LAGEN",30,0)
 L +^LAH(LWL):99999
"RTN","LAGEN",31,0)
 ;
"RTN","LAGEN",32,0)
 F  S (^LAH(LWL),ISQN)=1+$G(^LAH(LWL)) Q:'$D(^LAH(LWL,1,ISQN))
"RTN","LAGEN",33,0)
 ;
"RTN","LAGEN",34,0)
 S:CUP="" TRAY=1,CUP=ISQN
"RTN","LAGEN",35,0)
 S ^LAH(LWL,1,ISQN,0)=TRAY_U_CUP_"^^^^^"_METH_"^"_+$G(IDE)
"RTN","LAGEN",36,0)
 ;
"RTN","LAGEN",37,0)
 D UPDT(LWL,ISQN)
"RTN","LAGEN",38,0)
 ;
"RTN","LAGEN",39,0)
 S ^LAH(LWL,1,"B",(+TRAY)_";"_(+CUP),ISQN)=""
"RTN","LAGEN",40,0)
 ;
"RTN","LAGEN",41,0)
 ; IDE xref added to enable correct identifier for CX4/CX5 instruments
"RTN","LAGEN",42,0)
 S ^LAH(LWL,1,"E",+$G(IDE),ISQN)=""
"RTN","LAGEN",43,0)
 ;
"RTN","LAGEN",44,0)
 ; Set UID xref and .3 node, used to verify by unique identifier (UID).
"RTN","LAGEN",45,0)
 I $G(LA7UID)'="" D UID(LWL,ISQN,LA7UID)
"RTN","LAGEN",46,0)
 ;
"RTN","LAGEN",47,0)
 L -^LAH(LWL)
"RTN","LAGEN",48,0)
 Q
"RTN","LAGEN",49,0)
 ;
"RTN","LAGEN",50,0)
 ;
"RTN","LAGEN",51,0)
LLIST ;
"RTN","LAGEN",52,0)
 S LRDFN=0,DPF=2
"RTN","LAGEN",53,0)
 ;
"RTN","LAGEN",54,0)
 I LROVER D  Q:ISQN>0
"RTN","LAGEN",55,0)
 . S ISQN=+$O(^LAH(LWL,1,"B",(+TRAY)_";"_(+CUP),0))
"RTN","LAGEN",56,0)
 . I ISQN D UPDT(LWL,ISQN)
"RTN","LAGEN",57,0)
 ;
"RTN","LAGEN",58,0)
 ; Run by load/work list number sent.
"RTN","LAGEN",59,0)
 D ISQN S LINK="^^"
"RTN","LAGEN",60,0)
 ;
"RTN","LAGEN",61,0)
 I $D(^LRO(68.2,LWL,1,TRAY,1,CUP,0)) S LINK=$P(^(0),"^",1,3),^(4,ISQN)=""
"RTN","LAGEN",62,0)
 ;
"RTN","LAGEN",63,0)
 S $P(^LAH(LWL,1,ISQN,0),U,3,5)=LINK
"RTN","LAGEN",64,0)
 ;
"RTN","LAGEN",65,0)
 S DPF=2
"RTN","LAGEN",66,0)
 Q:LINK="^^"
"RTN","LAGEN",67,0)
 S WL=+$P(LINK,"^",1),WDT=+$P(LINK,"^",2),LOG=+$P(LINK,"^",3),^LAH(LWL,1,"C",LOG,ISQN)=""
"RTN","LAGEN",68,0)
 S X=$S($D(^LRO(68,WL,1,WDT,1,LOG,0)):^(0),1:"0^2"),DPF=+$P(X,U,2),LRDFN=+X
"RTN","LAGEN",69,0)
 ;
"RTN","LAGEN",70,0)
 Q
"RTN","LAGEN",71,0)
 ;
"RTN","LAGEN",72,0)
 ;
"RTN","LAGEN",73,0)
SEQN ;
"RTN","LAGEN",74,0)
 ; Run by the order data received
"RTN","LAGEN",75,0)
 S CUP=""
"RTN","LAGEN",76,0)
 D LLIST
"RTN","LAGEN",77,0)
 Q
"RTN","LAGEN",78,0)
 ;
"RTN","LAGEN",79,0)
 ;
"RTN","LAGEN",80,0)
CENUM ;
"RTN","LAGEN",81,0)
 S DPF=2,LRDFN=0,LOG=$O(^LRO(68,WL,1,DT,1,"D",+CENUM,0))
"RTN","LAGEN",82,0)
 G LOG:LOG>0 ;for martinez only
"RTN","LAGEN",83,0)
 ;IF CENUM?1A.ANP S Y=CENUM D CEPACK I Y?.ANP S DFN=$O(^LAB(62.3,"B",Y,0)) I DFN S DPF=62.3
"RTN","LAGEN",84,0)
 ;
"RTN","LAGEN",85,0)
 D ISQN
"RTN","LAGEN",86,0)
 ;
"RTN","LAGEN",87,0)
 S ^LAH(LWL,1,"C",LOG,ISQN)="",^LAH(LWL,1,"D",+CENUM,ISQN)="",$P(^LAH(LWL,1,ISQN,0),U,6)=CENUM
"RTN","LAGEN",88,0)
 ;
"RTN","LAGEN",89,0)
 I $D(^LRO(68.2,LWL,1,TRAY,1,CUP,0)) S ^(4,ISQN)=""
"RTN","LAGEN",90,0)
 Q
"RTN","LAGEN",91,0)
 ;
"RTN","LAGEN",92,0)
 ;
"RTN","LAGEN",93,0)
IDENT ;
"RTN","LAGEN",94,0)
 S DPF=2,LRDFN=0,LOG=$O(^LRO(68,WL,1,DT,1,"C",IDENT,0))
"RTN","LAGEN",95,0)
 I LOG>0 D LOG Q
"RTN","LAGEN",96,0)
 D ISQN
"RTN","LAGEN",97,0)
 Q
"RTN","LAGEN",98,0)
 ;
"RTN","LAGEN",99,0)
 ;
"RTN","LAGEN",100,0)
POC ; Entry point for POC interfaces to setup LAH using "E" x-ref
"RTN","LAGEN",101,0)
 ; IDE xref used to identify for POC specimen
"RTN","LAGEN",102,0)
 I $G(IDE)'="" D  Q:ISQN
"RTN","LAGEN",103,0)
 . S ISQN=$O(^LAH(LWL,1,"E",IDE,0))
"RTN","LAGEN",104,0)
 . I ISQN D UPDT(LWL,ISQN) Q
"RTN","LAGEN",105,0)
 D LOG
"RTN","LAGEN",106,0)
 Q
"RTN","LAGEN",107,0)
 ;
"RTN","LAGEN",108,0)
 ;
"RTN","LAGEN",109,0)
CONTROL ; Verify control's
"RTN","LAGEN",110,0)
 ;
"RTN","LAGEN",111,0)
 Q:'$D(^LRO(68,WL,1,DT,1,LOG,0))  Q:$P(^(0),U,2)'=62.3
"RTN","LAGEN",112,0)
 ;
"RTN","LAGEN",113,0)
 S LRDFN=+^LRO(68,WL,1,DT,1,LOG,0)
"RTN","LAGEN",114,0)
 S IDT=+$P($G(^LRO(68,WL,1,DT,1,LOG,3)),"^",3)
"RTN","LAGEN",115,0)
 I IDT<1 Q
"RTN","LAGEN",116,0)
 I '$D(^LR(LRDFN,"CH",IDT,0)) Q
"RTN","LAGEN",117,0)
 S $P(^LRO(68,WL,1,DT,1,LOG,3),U,4)=NOW
"RTN","LAGEN",118,0)
 S $P(^LR(LRDFN,"CH",IDT,0),U,3)=NOW
"RTN","LAGEN",119,0)
 ;
"RTN","LAGEN",120,0)
 F I=1:0 S I=$O(^LAH(LWL,1,ISQN,I)) Q:I<1  S ^LR(LRDFN,"CH",IDT,I)=^LAH(LWL,1,ISQN,I)
"RTN","LAGEN",121,0)
 ;
"RTN","LAGEN",122,0)
 S:'$D(LRTEC) LRTEC=$P(^VA(200,DUZ,0),U,2)
"RTN","LAGEN",123,0)
 ;
"RTN","LAGEN",124,0)
 F I=0:0 S I=$O(^LRO(68,WL,1,DT,1,LOG,4,I)) Q:I<1  I +$P(^(I,0),U,3)[LWL,'$P(^(0),U,5) S $P(^(0),U,5)=NOW,$P(^(0),U,4)=LRTEC,^LRO(68,WL,1,DT,1,"AC",NOW,LOG)="",^LRO(68,WL,1,DT,1,"AD",NOW\1,LOG)=""
"RTN","LAGEN",125,0)
 D CONTXREF
"RTN","LAGEN",126,0)
 K:$G(LOG) ^LAH(LWL,1,"C",+LOG)
"RTN","LAGEN",127,0)
 K ^LAH(LWL,1,"B",(+TRAY)_";"_(+CUP)),^LAH(LWL,1,ISQN)
"RTN","LAGEN",128,0)
 ;
"RTN","LAGEN",129,0)
 Q
"RTN","LAGEN",130,0)
 ;
"RTN","LAGEN",131,0)
 ;
"RTN","LAGEN",132,0)
CEPACK S Y=$P(Y,"\",1),YY="" F I=1:1:$L(Y) S:$A(Y,I)>32 YY=YY_$E(Y,I)
"RTN","LAGEN",133,0)
 S Y=YY
"RTN","LAGEN",134,0)
 K YY
"RTN","LAGEN",135,0)
 Q
"RTN","LAGEN",136,0)
 ;
"RTN","LAGEN",137,0)
 ;
"RTN","LAGEN",138,0)
CONTXREF ; Set up verification X-Ref for controls
"RTN","LAGEN",139,0)
 ;
"RTN","LAGEN",140,0)
 N DA,LRTEST,LRTN,I,LRGTN,X1,X,S1,J,J1
"RTN","LAGEN",141,0)
 ;
"RTN","LAGEN",142,0)
 S LRTEST=""
"RTN","LAGEN",143,0)
 F LRTN=0:0 S LRTN=$O(^LRO(68,WL,1,DT,1,LOG,4,LRTN)) Q:LRTN<1  I $D(^(LRTN,0)),+$P(^(0),U,3)[LWL,+$P(^(0),U,5) S:LRTEST'="" LRTEST=LRTEST_"^"_LRTN S:LRTEST="" LRTEST=LRTN
"RTN","LAGEN",144,0)
AC ;
"RTN","LAGEN",145,0)
 K ^TMP("LR",$J,"T")
"RTN","LAGEN",146,0)
 D ^LREXPD
"RTN","LAGEN",147,0)
 F X=0:0 S X=$O(^TMP("LR",$J,"T",X)) Q:X<1  S X1=$P(^(X),";",2) I X1,$D(^LR(LRDFN,"CH",IDT,X1)) S:'$D(^LRO(68,"AC",LRDFN,IDT,X1)) ^(X1)=""
"RTN","LAGEN",148,0)
 K ^TMP("LR",$J,"T")
"RTN","LAGEN",149,0)
 Q
"RTN","LAGEN",150,0)
 ;
"RTN","LAGEN",151,0)
 ;
"RTN","LAGEN",152,0)
UPDT(LWL,ISQN) ; Set/update date/time this entry in LAH has data added.
"RTN","LAGEN",153,0)
 ; Used by clear instrument data option to allow selective clearing based on date/time criteria.
"RTN","LAGEN",154,0)
 ; Call with LWL = ien of load/list in LAH
"RTN","LAGEN",155,0)
 ;          ISQN = ien of sequence
"RTN","LAGEN",156,0)
 N LANOW,LAX
"RTN","LAGEN",157,0)
 ;
"RTN","LAGEN",158,0)
 S LANOW=$$NOW^XLFDT
"RTN","LAGEN",159,0)
 S LAX=$P($G(^LAH(LWL,1,ISQN,0)),"^",10,11)
"RTN","LAGEN",160,0)
 ;
"RTN","LAGEN",161,0)
 ; Created date/time_"^"_update date/time.
"RTN","LAGEN",162,0)
 S LAX=$S($P(LAX,"^",1):$P(LAX,"^",1),1:LANOW)_"^"_LANOW
"RTN","LAGEN",163,0)
 S $P(^LAH(LWL,1,ISQN,0),"^",10,11)=LAX
"RTN","LAGEN",164,0)
 Q
"RTN","LAGEN",165,0)
 ;
"RTN","LAGEN",166,0)
 ;
"RTN","LAGEN",167,0)
UID(LWL,ISQN,UID) ; Set .3 node and "U" xref with accession's UID.
"RTN","LAGEN",168,0)
 ; Used to verify by unique identifier (UID).
"RTN","LAGEN",169,0)
 ; Call with LWL = ien of load/list in LAH
"RTN","LAGEN",170,0)
 ;          ISQN = ien of sequence
"RTN","LAGEN",171,0)
 ;           UID = accession's UID
"RTN","LAGEN",172,0)
 ; Called from above, LRVR1, LRVRW
"RTN","LAGEN",173,0)
 ;
"RTN","LAGEN",174,0)
 N X
"RTN","LAGEN",175,0)
 ;
"RTN","LAGEN",176,0)
 S X=$P($G(^LAH(LWL,1,ISQN,.3)),"^")
"RTN","LAGEN",177,0)
 ; Kill x-ref if existing value different than new value.
"RTN","LAGEN",178,0)
 I X]"",X'=UID K ^LAH(LWL,1,"U",X,ISQN)
"RTN","LAGEN",179,0)
 ;
"RTN","LAGEN",180,0)
 S $P(^LAH(LWL,1,ISQN,.3),"^")=UID
"RTN","LAGEN",181,0)
 S ^LAH(LWL,1,"U",UID,ISQN)=""
"RTN","LAGEN",182,0)
 Q
"RTN","LAGEN",183,0)
 ;
"RTN","LAGEN",184,0)
 ;
"RTN","LAGEN",185,0)
POI(LWL,ISQN,NODE,LAID) ; Set .1 node with patient/order info
"RTN","LAGEN",186,0)
 ; Call with LWL = ien of load/list in LAH
"RTN","LAGEN",187,0)
 ;          ISQN = ien of sequence
"RTN","LAGEN",188,0)
 ;          NODE = node to store data on (PID, OBR)
"RTN","LAGEN",189,0)
 ;          LAID = array containing values
"RTN","LAGEN",190,0)
 ;                 PID - "DFN","DOB","ICN","LRDFN","LRTDFN","PNM","SEX","SSN"
"RTN","LAGEN",191,0)
 ;                 OBR - "EOL","FID","ORCDT","ORDNLT","ORDP","PON","SID","PEB","PVB"
"RTN","LAGEN",192,0)
 ;
"RTN","LAGEN",193,0)
 ; ^LAH(LWL,1,ISQN,.1,"OBR","EOL") = enterer's ordering location
"RTN","LAGEN",194,0)
 ; ^LAH(LWL,1,ISQN,.1,"OBR","FID") = filler specimen id
"RTN","LAGEN",195,0)
 ; ^LAH(LWL,1,ISQN,.1,"OBR","ORCDT") = order date/time (FileMan d/t)
"RTN","LAGEN",196,0)
 ; ^LAH(LWL,1,ISQN,.1,"OBR","ORDNLT") = order NLT (multiple separated by "^")
"RTN","LAGEN",197,0)
 ; ^LAH(LWL,1,ISQN,.1,"OBR","ORDP") = ordering provider (DUZ or id^last name, first name, mi [id])
"RTN","LAGEN",198,0)
 ; ^LAH(LWL,1,ISQN,.1,"OBR","PEB") = placer entered by (DUZ or id^last name, first name, mi [id])
"RTN","LAGEN",199,0)
 ; ^LAH(LWL,1,ISQN,.1,"OBR","PON") = placer order number
"RTN","LAGEN",200,0)
 ; ^LAH(LWL,1,ISQN,.1,"OBR","PVB") = placer verified by (DUZ or id^last name, first name, mi [id])
"RTN","LAGEN",201,0)
 ; ^LAH(LWL,1,ISQN,.1,"OBR","SID") = placer specimen id
"RTN","LAGEN",202,0)
 ; ^LAH(LWL,1,ISQN,.1,"PID","DFN") = patient's DFN in file #2
"RTN","LAGEN",203,0)
 ; ^LAH(LWL,1,ISQN,.1,"PID","DOB") = date of birth (FileMan d/t)
"RTN","LAGEN",204,0)
 ; ^LAH(LWL,1,ISQN,.1,"PID","ICN") = patient's ICN
"RTN","LAGEN",205,0)
 ; ^LAH(LWL,1,ISQN,.1,"PID","LRDFN") = patient's LRDFN in file #63
"RTN","LAGEN",206,0)
 ; ^LAH(LWL,1,ISQN,.1,"PID","LRTDFN") = patient's LRTDFN in file #67
"RTN","LAGEN",207,0)
 ; ^LAH(LWL,1,ISQN,.1,"PID","PNM") = patient's name
"RTN","LAGEN",208,0)
 ; ^LAH(LWL,1,ISQN,.1,"PID","SEX") = patient's sex
"RTN","LAGEN",209,0)
 ; ^LAH(LWL,1,ISQN,.1,"PID","SSN") = patient's SSN
"RTN","LAGEN",210,0)
 ;
"RTN","LAGEN",211,0)
 N LAX,LAY,LAZ
"RTN","LAGEN",212,0)
 ;
"RTN","LAGEN",213,0)
 S LAX=""
"RTN","LAGEN",214,0)
 F  S LAX=$O(LAID(LAX)) Q:LAX=""  D
"RTN","LAGEN",215,0)
 . S LAY=LAID(LAX)
"RTN","LAGEN",216,0)
 . I LAY="" Q
"RTN","LAGEN",217,0)
 . S LAZ=$G(^LAH(LWL,1,ISQN,.1,NODE,LAX))
"RTN","LAGEN",218,0)
 . I LAY=LAZ Q
"RTN","LAGEN",219,0)
 . ; Remove old data and cross-references.
"RTN","LAGEN",220,0)
 . I LAZ'="" D
"RTN","LAGEN",221,0)
 . . K ^LAH(LWL,1,ISQN,.1,NODE,LAX)
"RTN","LAGEN",222,0)
 . . I $P(LAZ,"^")]"" K ^LAH(LWL,1,"A"_LAX,$P(LAZ,"^"),ISQN)
"RTN","LAGEN",223,0)
 . ; Set new values and cross-references.
"RTN","LAGEN",224,0)
 . S ^LAH(LWL,1,ISQN,.1,NODE,LAX)=LAY
"RTN","LAGEN",225,0)
 . I $P(LAY,"^")'="" S ^LAH(LWL,1,"A"_LAX,$P(LAY,"^"),ISQN)=""
"RTN","LAGEN",226,0)
 ;
"RTN","LAGEN",227,0)
 Q
"RTN","LAGEN",228,0)
 ;
"RTN","LAGEN",229,0)
 ;
"RTN","LAGEN",230,0)
LATYP(LWL,ISQN,LAX) ; Set type of interface for this entry
"RTN","LAGEN",231,0)
 ; Call with LWL = ien of load/list in LAH
"RTN","LAGEN",232,0)
 ;          ISQN = ien of sequence
"RTN","LAGEN",233,0)
 ;           LAX = type of interface
"RTN","LAGEN",234,0)
 ; 
"RTN","LAGEN",235,0)
 S $P(^LAH(LWL,1,ISQN,0),"^",12)=LAX
"RTN","LAGEN",236,0)
 Q
"RTN","LAGEN",237,0)
 ;
"RTN","LAGEN",238,0)
 ;
"RTN","LAGEN",239,0)
LAMSGID(LWL,ISQN,LAX) ; Set pointer to file #62.49 for this entry.
"RTN","LAGEN",240,0)
 ; Call with LWL = ien of load/list in LAH
"RTN","LAGEN",241,0)
 ;          ISQN = ien of sequence
"RTN","LAGEN",242,0)
 ;           LAX = ien of entry in file #62.49 that is source of these results
"RTN","LAGEN",243,0)
 ; 
"RTN","LAGEN",244,0)
 S $P(^LAH(LWL,1,ISQN,0),"^",13)=LAX
"RTN","LAGEN",245,0)
 S ^LAH(LWL,1,ISQN,.01,LAX)=""
"RTN","LAGEN",246,0)
 Q
"RTN","LAGEN",247,0)
 ;
"RTN","LAGEN",248,0)
 ;
"RTN","LAGEN",249,0)
METH(LWL,ISQN,LAX) ; Save instrument name/method for this entry
"RTN","LAGEN",250,0)
 ; Call with LWL = ien of load/list in LAH
"RTN","LAGEN",251,0)
 ;          ISQN = ien of sequence
"RTN","LAGEN",252,0)
 ;           LAX = method text
"RTN","LAGEN",253,0)
 ;
"RTN","LAGEN",254,0)
 N X
"RTN","LAGEN",255,0)
 S X=$P(^LAH(LWL,1,ISQN,0),"^",7)
"RTN","LAGEN",256,0)
 I X'[LAX S X=LAX_";"_X,$P(^LAH(LWL,1,ISQN,0),"^",7)=X
"RTN","LAGEN",257,0)
 Q
"UP",62.4,62.41,-1)
62.4^3
"UP",62.4,62.41,0)
62.41
"UP",62.49,62.49162,-1)
62.49^1
"UP",62.49,62.49162,0)
62.49162
"UP",62.8,62.801,-1)
62.8^10
"UP",62.8,62.801,0)
62.801
"UP",62.9,62.9001,-1)
62.9^60
"UP",62.9,62.9001,0)
62.9001
"VER")
8.0^22.0
"^DD",62.4,62.41,22,0)
NOTIFY ABNORMAL FLAGS^S^0:NO;1:YES;^2;11^Q
"^DD",62.4,62.41,22,3)
Send alert/bulletin when results are abnormal.
"^DD",62.4,62.41,22,10)
Field OBX-8 Abnormal Flags in HL7 ORU result message
"^DD",62.4,62.41,22,21,0)
^^4^4^3030722^^
"^DD",62.4,62.41,22,21,1,0)
Used to determine if an alert and bulletin should be created when
"^DD",62.4,62.41,22,21,2,0)
results are processed with an associated abnormal flag. Generated
"^DD",62.4,62.41,22,21,3,0)
from the value of field OBX-8 Abnormal Flags from the HL7 ORU result
"^DD",62.4,62.41,22,21,4,0)
message. 
"^DD",62.4,62.41,22,"DT")
3030722
"^DD",62.485,62.485,0)
FIELD^^2^4
"^DD",62.485,62.485,0,"DDA")
N
"^DD",62.485,62.485,0,"DT")
2970205
"^DD",62.485,62.485,0,"IX","B",62.485,.01)

"^DD",62.485,62.485,0,"NM","LA7 MESSAGE LOG BULLETINS")

"^DD",62.485,62.485,0,"VRPK")
LA
"^DD",62.485,62.485,.01,0)
CODE^RNJ7,0X^^0;1^K:+X'=X!(X>9999999)!(X<$S($D(DIFROM):1,1:1000))!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",62.485,62.485,.01,1,0)
^.1
"^DD",62.485,62.485,.01,1,1,0)
62.485^B
"^DD",62.485,62.485,.01,1,1,1)
S ^LAHM(62.485,"B",$E(X,1,30),DA)=""
"^DD",62.485,62.485,.01,1,1,2)
K ^LAHM(62.485,"B",$E(X,1,30),DA)
"^DD",62.485,62.485,.01,3)
Type a Number between 1000 and 9999999, 0 Decimal Digits.
"^DD",62.485,62.485,.01,21,0)
^^3^3^2970612^^
"^DD",62.485,62.485,.01,21,1,0)
This field contains a number between 1 and 9999999 that uniquely
"^DD",62.485,62.485,.01,21,2,0)
identifies an error or exceptional condition.  Numbers below 999 are
"^DD",62.485,62.485,.01,21,3,0)
reserved for package use only.
"^DD",62.485,62.485,.01,"DT")
2950122
"^DD",62.485,62.485,1,0)
TEXT^RF^^0;2^K:$L(X)>160!($L(X)<1) X
"^DD",62.485,62.485,1,3)
Answer must be 1-160 characters in length.
"^DD",62.485,62.485,1,21,0)
^^3^3^2970612^
"^DD",62.485,62.485,1,21,1,0)
This field holds the text description of the error or exceptional
"^DD",62.485,62.485,1,21,2,0)
condition.  This field is used to create an error or exceptional condition
"^DD",62.485,62.485,1,21,3,0)
display in the ^XTMP global.
"^DD",62.485,62.485,1,23,0)
^^9^9^2970612^
"^DD",62.485,62.485,1,23,1,0)
This field is used to create error or exceptional condition displays in
"^DD",62.485,62.485,1,23,2,0)
the ^XTMP global.  The text description should contain useful information
"^DD",62.485,62.485,1,23,3,0)
about the message in the LA7 MESSAGE QUEUE file (#62.49).  The information
"^DD",62.485,62.485,1,23,4,0)
can be added to the text by using the "|" character and the LA7TXT()
"^DD",62.485,62.485,1,23,5,0)
array.
"^DD",62.485,62.485,1,23,6,0)
 
"^DD",62.485,62.485,1,23,7,0)
Example Text: Message # |1| did not contain a PID segment.
"^DD",62.485,62.485,1,23,8,0)
Array value: LA7TXT(1)=123
"^DD",62.485,62.485,1,23,9,0)
^XTMP: Message # 123 did not contain a PID segment.
"^DD",62.485,62.485,1,"DT")
2940427
"^DD",62.485,62.485,1.3,0)
SEND ALERT^S^0:NO;1:YES;^0;3^Q
"^DD",62.485,62.485,1.3,3)
Determines if alert is sent when a message is processed with this error. Alerts must also be turned on and mail group designated in file #62.48.
"^DD",62.485,62.485,1.3,21,0)
^^4^4^2970612^
"^DD",62.485,62.485,1.3,21,1,0)
This field is used to flag those errors which can generate an alert to a
"^DD",62.485,62.485,1.3,21,2,0)
site selectable mail group whenever this error occurs. The site needs to
"^DD",62.485,62.485,1.3,21,3,0)
designate a mail group in the LA7 MESSAGE PARAMETER file (#62.48) under
"^DD",62.485,62.485,1.3,21,4,0)
the ALERT CONDITION field (#20).
"^DD",62.485,62.485,1.3,"DT")
2970205
"^DD",62.485,62.485,2,0)
BUILD LOGIC^K^^1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",62.485,62.485,2,3)
This is Standard MUMPS code.
"^DD",62.485,62.485,2,9)
@
"^DD",62.485,62.485,2,21,0)
^^8^8^2970612^
"^DD",62.485,62.485,2,21,1,0)
This is standard MUMPS code that is executed to log the text
"^DD",62.485,62.485,2,21,2,0)
description error into the ^XTMP global.  The MUMPS code should set the
"^DD",62.485,62.485,2,21,3,0)
LA7TXT() array to feel in the fields in the text description.
"^DD",62.485,62.485,2,21,4,0)
 
"^DD",62.485,62.485,2,21,5,0)
 Example MUMPS code: S LA7TXT(1)=LA76249
"^DD",62.485,62.485,2,21,6,0)
 Variable value: LA76249=123
"^DD",62.485,62.485,2,21,7,0)
 Text description: Message # |1| did not contain a PID segment.
"^DD",62.485,62.485,2,21,8,0)
 ^XTMP: Message # 123 did not contain a PID segment.
"^DD",62.485,62.485,2,"DT")
2940427
"^DD",62.49,62.49,162,0)
CH SUBSCRIPT^62.49162A^^1;0
"^DD",62.49,62.49,162,21,0)
^^2^2^2970612^^
"^DD",62.49,62.49,162,21,1,0)
This multiple contains the "CH" subscript nodes where the results are
"^DD",62.49,62.49,162,21,2,0)
stored in the LAB DATA file (#63).
"^DD",62.49,62.49,700,0)
HL7 ENV^F^^700;1^K:$L(X)>245!($L(X)<1) X
"^DD",62.49,62.49,700,3)
Answer must be 1-245 characters in length
"^DD",62.49,62.49,700,21,0)
^^1^1^3030418^
"^DD",62.49,62.49,700,21,1,0)
Stores HL7 environment relating to incoming HL7 message for later use in generating an HL7 application acknowledgement.
"^DD",62.49,62.49,700,"DT")
3030418
"^DD",62.49,62.49162,0)
CH SUBSCRIPT SUB-FIELD^^.02^2
"^DD",62.49,62.49162,0,"NM","CH SUBSCRIPT")

"^DD",62.49,62.49162,.01,0)
CH SUBSCRIPT^F^^0;1^K:$L(X)>10!($L(X)<1) X
"^DD",62.49,62.49162,.01,1,0)
^.1
"^DD",62.49,62.49162,.01,1,1,0)
62.49162^B
"^DD",62.49,62.49162,.01,1,1,1)
S ^LAHM(62.49,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",62.49,62.49162,.01,1,1,2)
K ^LAHM(62.49,DA(1),1,"B",$E(X,1,30),DA)
"^DD",62.49,62.49162,.01,3)
Answer must be 1-10 characters in length.
"^DD",62.49,62.49162,.01,21,0)
^^3^3^3030107^^^
"^DD",62.49,62.49162,.01,21,1,0)
This multiple contains the "CH" subscript node where the results are
"^DD",62.49,62.49162,.01,21,2,0)
stored in the LAB DATA file (#63).  The field is used in the processing
"^DD",62.49,62.49162,.01,21,3,0)
and transmission of HL7 result messages.
"^DD",62.49,62.49162,.01,"DT")
3030107
"^DD",62.49,62.49162,.02,0)
CORRECTED RESULTS^S^C:CORRECTED;^0;2^Q
"^DD",62.49,62.49162,.02,3)
Indicate if these results are a correction to a previous report.
"^DD",62.49,62.49162,.02,21,0)
^^3^3^3030107^^
"^DD",62.49,62.49162,.02,21,1,0)
Indicates if the results being transmitted are a correction
"^DD",62.49,62.49162,.02,21,2,0)
to a previous report. The HL7 message will indicate this
"^DD",62.49,62.49162,.02,21,3,0)
status when transmitting these results.
"^DD",62.49,62.49162,.02,"DT")
3030107
"^DD",62.8,62.8,.01,0)
INVOICE^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",62.8,62.8,.01,1,0)
^.1
"^DD",62.8,62.8,.01,1,1,0)
62.8^B
"^DD",62.8,62.8,.01,1,1,1)
S ^LAHM(62.8,"B",$E(X,1,30),DA)=""
"^DD",62.8,62.8,.01,1,1,2)
K ^LAHM(62.8,"B",$E(X,1,30),DA)
"^DD",62.8,62.8,.01,3)
Answer must be 3-30 characters in length.
"^DD",62.8,62.8,.01,21,0)
^^5^5^3041105^^^^
"^DD",62.8,62.8,.01,21,1,0)
This field contains a uniquely generated invoice number. The number is
"^DD",62.8,62.8,.01,21,2,0)
derived as follows: site number-date-number
"^DD",62.8,62.8,.01,21,3,0)
   Site number - field #99 of Institution file
"^DD",62.8,62.8,.01,21,4,0)
          Date - date shipping manifest created in form YYYYMMDD
"^DD",62.8,62.8,.01,21,5,0)
        Number - sequential number starting at 1 for a given site/date.
"^DD",62.8,62.8,.01,"DT")
3041105
"^DD",62.8,62.8,.06,0)
SPECIMEN CODING SYSTEM^S^0:HL7 TABLE 0070;1:LOCAL-NON HL7;^0;6^Q
"^DD",62.8,62.8,.06,3)
Answer with type of coding system to use for this configuration.
"^DD",62.8,62.8,.06,21,0)
^^3^3^3020814^
"^DD",62.8,62.8,.06,21,1,0)
If orders are sent to a non-VA facility and the facility
"^DD",62.8,62.8,.06,21,2,0)
can not receive HL7 specimen codes from HL7 table 0070
"^DD",62.8,62.8,.06,21,3,0)
then answer with the type of coding system "LOCAL".
"^DD",62.8,62.8,.06,"DT")
3020814
"^DD",62.8,62.801,.1,0)
RELEVANT CLINICAL INFORMATION^F^^.1;1^K:$L(X)>250!($L(X)<1) X
"^DD",62.8,62.801,.1,3)
Answer must be 1-250 characters in length.
"^DD",62.8,62.801,.1,21,0)
^^4^4^3040123^^
"^DD",62.8,62.801,.1,21,1,0)
This field contains additional clinical information about the
"^DD",62.8,62.801,.1,21,2,0)
patient or specimen. It is used to report the suspected
"^DD",62.8,62.801,.1,21,3,0)
diagnosis and clinical findings on requests for interpreted
"^DD",62.8,62.801,.1,21,4,0)
diagnostic studies. 
"^DD",62.8,62.801,.1,"DT")
3040123
"^DD",62.8,62.801,5.1,0)
NON-NLT TEST ORDER CODE^F^^5;1^K:$L(X)>20!($L(X)<1) X
"^DD",62.8,62.801,5.1,3)
Answer must be 1-20 characters in length.
"^DD",62.8,62.801,5.1,21,0)
^.001^5^5^3040624^^^^
"^DD",62.8,62.801,5.1,21,1,0)
If sending test orders to a non-VistA facility this
"^DD",62.8,62.801,5.1,21,2,0)
field is used to store the test order codes used by
"^DD",62.8,62.801,5.1,21,3,0)
the non-VistA system. It is valued by VistA from the
"^DD",62.8,62.801,5.1,21,4,0)
corresponding field in LAB SHIPPING CONFIGURATION file
"^DD",62.8,62.801,5.1,21,5,0)
(#62.9) during shipping manifest building.
"^DD",62.8,62.801,5.1,"DT")
3040624
"^DD",62.8,62.801,5.2,0)
NON-NLT TEST ORDER NAME^F^^5;2^K:$L(X)>50!($L(X)<1) X
"^DD",62.8,62.801,5.2,3)
Answer must be 1-50 characters in length.
"^DD",62.8,62.801,5.2,21,0)
^.001^5^5^3040624^^
"^DD",62.8,62.801,5.2,21,1,0)
If sending test orders to a non-VistA system this
"^DD",62.8,62.801,5.2,21,2,0)
field is used to store the test order name used by
"^DD",62.8,62.801,5.2,21,3,0)
the non-VistA system. It is valued VistA from the
"^DD",62.8,62.801,5.2,21,4,0)
corresponding field in LAB SHIPPING CONFIGURATION
"^DD",62.8,62.801,5.2,21,5,0)
file (#62.9) during shipping manifest building.
"^DD",62.8,62.801,5.2,"DT")
3040624
"^DD",62.8,62.801,5.3,0)
NON-HL7 SPECIMEN CODE^F^^5;3^K:$L(X)>10!($L(X)<1) X
"^DD",62.8,62.801,5.3,3)
Answer must be 1-10 characters in length
"^DD",62.8,62.801,5.3,21,0)
^.001^8^8^3041105^^^^
"^DD",62.8,62.801,5.3,21,1,0)
If sending test orders to a non-VistA system
"^DD",62.8,62.801,5.3,21,2,0)
that does not use HL7 Table 0070 Specimen
"^DD",62.8,62.801,5.3,21,3,0)
Source, use this field to store the specimen
"^DD",62.8,62.801,5.3,21,4,0)
code used by the non-VistA system. It is only used
"^DD",62.8,62.801,5.3,21,5,0)
when the value of field SPECIMEN CODING SYSTEM
"^DD",62.8,62.801,5.3,21,6,0)
(#.06) is LOCAL-NON HL7.  It provides a means
"^DD",62.8,62.801,5.3,21,7,0)
for a collecting facility to map non standard
"^DD",62.8,62.801,5.3,21,8,0)
specimen codes to the host site.
"^DD",62.8,62.801,5.3,"DT")
3041105
"^DD",62.8,62.801,5.4,0)
NON-HL7 SPECIMEN NAME^F^^5;4^K:$L(X)>30!($L(X)<1) X
"^DD",62.8,62.801,5.4,3)
Answer must be 1-30 characters in length
"^DD",62.8,62.801,5.4,21,0)
^.001^9^9^3041105^^^^
"^DD",62.8,62.801,5.4,21,1,0)
If sending test orders to a non-VistA system
"^DD",62.8,62.801,5.4,21,2,0)
that does not use HL7 Table 0070 Specimen
"^DD",62.8,62.801,5.4,21,3,0)
Source, use this field to store the specimen
"^DD",62.8,62.801,5.4,21,4,0)
name used by the non-VA system. It is only used
"^DD",62.8,62.801,5.4,21,5,0)
when the value of field SPECIMEN CODING SYSTEM
"^DD",62.8,62.801,5.4,21,6,0)
(#.06) is LOCAL-NON HL7.  It provides a means
"^DD",62.8,62.801,5.4,21,7,0)
for a collecting facility to map non standard
"^DD",62.8,62.801,5.4,21,8,0)
specimen names to the site's TOPOGRAPHY FIELD
"^DD",62.8,62.801,5.4,21,9,0)
file (#61). 
"^DD",62.8,62.801,5.4,"DT")
3041105
"^DD",62.8,62.801,5.5,0)
NON-NLT TEST CODING SYSTEM^F^^5;5^K:$L(X)>10!($L(X)<1) X
"^DD",62.8,62.801,5.5,3)
Answer must be 1-10 characters in length
"^DD",62.8,62.801,5.5,21,0)
^.001^6^6^3041105^^^^
"^DD",62.8,62.801,5.5,21,1,0)
If sending test orders to a non-VistA system use this
"^DD",62.8,62.801,5.5,21,2,0)
field to store the name of the coding system used by
"^DD",62.8,62.801,5.5,21,3,0)
the non-VistA system. It will be used when the TEST
"^DD",62.8,62.801,5.5,21,4,0)
CODING SYSTEM field (#.05) is set to "NON-VA".
"^DD",62.8,62.801,5.5,21,5,0)
Name usually begins with "99" to indicate a local
"^DD",62.8,62.801,5.5,21,6,0)
coding system in the HL7 Standard. 
"^DD",62.8,62.801,5.5,"DT")
3041105
"^DD",62.8,62.801,5.6,0)
NON-HL7 SPECIMEN CODING SYSTEM^F^^5;6^K:$L(X)>10!($L(X)<1) X
"^DD",62.8,62.801,5.6,3)
Answer must be 1-10 characters in length
"^DD",62.8,62.801,5.6,21,0)
^.001^7^7^3041105^^^
"^DD",62.8,62.801,5.6,21,1,0)
If sending test orders to a non-VistA system that does
"^DD",62.8,62.801,5.6,21,2,0)
not use HL7 Table 0070 Specimen Source, use this field
"^DD",62.8,62.801,5.6,21,3,0)
to store the name of the coding system used by the
"^DD",62.8,62.801,5.6,21,4,0)
non-VistA system. It will be used when the value of field
"^DD",62.8,62.801,5.6,21,5,0)
SPECIMEN CODING SYSTEM (#.06) is LOCAL-NON HL7. Name
"^DD",62.8,62.801,5.6,21,6,0)
usually begins with "99" to indicate a local coding
"^DD",62.8,62.801,5.6,21,7,0)
system in the HL7 Standard. 
"^DD",62.8,62.801,5.6,"DT")
3041105
"^DD",62.8,62.801,5.7,0)
COLLECTION SAMPLE CODE^F^^5;7^K:$L(X)>10!($L(X)<1) X
"^DD",62.8,62.801,5.7,3)
Answer must be 1-10 characters in length
"^DD",62.8,62.801,5.7,21,0)
^^4^4^3041105^^^^
"^DD",62.8,62.801,5.7,21,1,0)
If sending test orders to a non-VA facility that also requires
"^DD",62.8,62.801,5.7,21,2,0)
a collection sample code use this field to store the collection
"^DD",62.8,62.801,5.7,21,3,0)
sample code used by the non-VA system. It is only used when the
"^DD",62.8,62.801,5.7,21,4,0)
value of field SPECIMEN CODING SYSTEM (#.06) is LOCAL-NON HL7.
"^DD",62.8,62.801,5.7,"DT")
3041105
"^DD",62.8,62.801,5.8,0)
COLLECTION SAMPLE NAME^F^^5;8^K:$L(X)>30!($L(X)<1) X
"^DD",62.8,62.801,5.8,3)
Answer must be 1-30 characters in length
"^DD",62.8,62.801,5.8,21,0)
^^4^4^3041105^^^^
"^DD",62.8,62.801,5.8,21,1,0)
If sending test orders to a non-VA facility that also requires
"^DD",62.8,62.801,5.8,21,2,0)
a collection sample name use this field to store the collection
"^DD",62.8,62.801,5.8,21,3,0)
sample name used by the non-VA system. It is only used when the
"^DD",62.8,62.801,5.8,21,4,0)
value of field SPECIMEN CODING SYSTEM (#.06) is LOCAL-NON HL7.
"^DD",62.8,62.801,5.8,"DT")
3041105
"^DD",62.8,62.801,5.9,0)
COLLECT SAMPLE SYSTEM^F^^5;9^K:$L(X)>10!($L(X)<1) X
"^DD",62.8,62.801,5.9,3)
Answer must be 1-10 characters in length
"^DD",62.8,62.801,5.9,21,0)
^^5^5^3041105^^^
"^DD",62.8,62.801,5.9,21,1,0)
If sending collection sample codes/names to a non-VA facility
"^DD",62.8,62.801,5.9,21,2,0)
use this field to store the name of the coding system used by
"^DD",62.8,62.801,5.9,21,3,0)
the non-VA system. It will be used when the TEST CODING SYSTEM
"^DD",62.8,62.801,5.9,21,4,0)
field (#.05) is set to "NON-VA".  Name usually begins with
"^DD",62.8,62.801,5.9,21,5,0)
"99" to indicate a local coding system in the HL7 Standard.
"^DD",62.8,62.801,5.9,"DT")
3041105
"^DD",62.9,62.9,.05,0)
COLLECTING FACILITY'S SPEC ID^RS^0:COLLECTING FACILITY;1:HOST FACILITY;3:SAME SYSTEM;^0;5^Q
"^DD",62.9,62.9,.05,.1)
COLLECTING FACILITY'S SPECIMEN ID SOURCE
"^DD",62.9,62.9,.05,3)
Select the source of the specimen id provided by the collector.
"^DD",62.9,62.9,.05,21,0)
^^8^8^3040218^
"^DD",62.9,62.9,.05,21,1,0)
This field is used to determine the source of the specimen id (Lab UID) 
"^DD",62.9,62.9,.05,21,2,0)
used to identify a specimen. It is used by the Host facility when
"^DD",62.9,62.9,.05,21,3,0)
accessioning tests requests from Collecting facilities to determine 
"^DD",62.9,62.9,.05,21,4,0)
if the Host facility needs to generate a new specimen id/label or use
"^DD",62.9,62.9,.05,21,5,0)
the specimen id/label from the Collecting facility.
"^DD",62.9,62.9,.05,21,6,0)
 
"^DD",62.9,62.9,.05,21,7,0)
If both the Collecting and Host facilities on operating on the same
"^DD",62.9,62.9,.05,21,8,0)
computer system then select #3 - SAME SYSTEM.
"^DD",62.9,62.9,.05,"DT")
3040331
"^DD",62.9,62.9,.11,0)
OTHER SYSTEM IDENTIFIER^F^^0;12^K:$L(X)>3!($L(X)<2)!'(X?2.3A) X
"^DD",62.9,62.9,.11,1,0)
^.1^^0
"^DD",62.9,62.9,.11,3)
Answer must be 2-3 alpha characters in length.
"^DD",62.9,62.9,.11,21,0)
^.001^11^11^3040624^^^
"^DD",62.9,62.9,.11,21,1,0)
If this entry is used to communicate with a non-VA, non-DoD system,
"^DD",62.9,62.9,.11,21,2,0)
enter the 2-3 alpha character identifier used to uniquely identify
"^DD",62.9,62.9,.11,21,3,0)
this system.
"^DD",62.9,62.9,.11,21,4,0)
 
"^DD",62.9,62.9,.11,21,5,0)
This identifier is used in constructing the HL7 application name and
"^DD",62.9,62.9,.11,21,6,0)
facility and resolving identification of institutions during HL7
"^DD",62.9,62.9,.11,21,7,0)
message building and processing.
"^DD",62.9,62.9,.11,21,8,0)
 
"^DD",62.9,62.9,.11,21,9,0)
This field is not used when VistA is communicating with a VA or
"^DD",62.9,62.9,.11,21,10,0)
DoD facility. These facilities are identified by their VA station
"^DD",62.9,62.9,.11,21,11,0)
number or DoD DMIS ID respectively.
"^DD",62.9,62.9,.11,"DT")
3040624
"^DD",62.9,62.9,.15,0)
SPECIMEN CODING SYSTEM^S^0:HL7 TABLE 0070;1:LOCAL-NON HL7;^0;16^Q
"^DD",62.9,62.9,.15,3)
Answer with type of specimen coding system to use for this configuration.
"^DD",62.9,62.9,.15,21,0)
^^11^11^3030107^^^
"^DD",62.9,62.9,.15,21,1,0)
Collecting facility:
"^DD",62.9,62.9,.15,21,2,0)
If orders are sent to a non-VA facility and the
"^DD",62.9,62.9,.15,21,3,0)
facility can not receive HL7 specimen codes from HL7
"^DD",62.9,62.9,.15,21,4,0)
table 0070 then answer with the type of coding system
"^DD",62.9,62.9,.15,21,5,0)
"LOCAL".
"^DD",62.9,62.9,.15,21,6,0)

"^DD",62.9,62.9,.15,21,7,0)
Host facility:
"^DD",62.9,62.9,.15,21,8,0)
If orders are received from a non-VA facility and the
"^DD",62.9,62.9,.15,21,9,0)
facility can not transmit HL7 specimen codes from HL7
"^DD",62.9,62.9,.15,21,10,0)
table 0070 then answer with the type of coding system
"^DD",62.9,62.9,.15,21,11,0)
"LOCAL".
"^DD",62.9,62.9,.15,"DT")
3030107
"^DD",62.9,62.9001,5.1,0)
NON-NLT TEST ORDER CODE^F^^5;1^K:$L(X)>20!($L(X)<1) X
"^DD",62.9,62.9001,5.1,3)
Answer must be 1-20 characters in length.
"^DD",62.9,62.9001,5.1,21,0)
^.001^15^15^3040624^^^^
"^DD",62.9,62.9001,5.1,21,1,0)
Collecting facilities:
"^DD",62.9,62.9001,5.1,21,2,0)

"^DD",62.9,62.9001,5.1,21,3,0)
If sending test orders to a non-VistA system use
"^DD",62.9,62.9001,5.1,21,4,0)
this field to store the test order codes used
"^DD",62.9,62.9001,5.1,21,5,0)
by the non-VistA system. It will be used when the
"^DD",62.9,62.9001,5.1,21,6,0)
TEST CODING SYSTEM field (#.14) is set to "NON-VA".
"^DD",62.9,62.9001,5.1,21,7,0)
 
"^DD",62.9,62.9001,5.1,21,8,0)
 
"^DD",62.9,62.9001,5.1,21,9,0)
Host facilities:
"^DD",62.9,62.9001,5.1,21,10,0)
 
"^DD",62.9,62.9001,5.1,21,11,0)
If receiving test orders from a non-VistA system
"^DD",62.9,62.9001,5.1,21,12,0)
that does not use VA National Laboratory Test (NLT)
"^DD",62.9,62.9001,5.1,21,13,0)
codes use this field to map the collecting system's
"^DD",62.9,62.9001,5.1,21,14,0)
test order codes to the corresponding VistA laboratory
"^DD",62.9,62.9001,5.1,21,15,0)
test.
"^DD",62.9,62.9001,5.1,"DT")
3040624
"^DD",62.9,62.9001,5.2,0)
NON-NLT TEST ORDER NAME^F^^5;2^K:$L(X)>100!($L(X)<1) X
"^DD",62.9,62.9001,5.2,3)
Answer must be 1-100 characters in length.
"^DD",62.9,62.9001,5.2,21,0)
^.001^15^15^3041105^^^^
"^DD",62.9,62.9001,5.2,21,1,0)
Collecting facility:
"^DD",62.9,62.9001,5.2,21,2,0)

"^DD",62.9,62.9001,5.2,21,3,0)
If sending test orders to a non-VistA system use
"^DD",62.9,62.9001,5.2,21,4,0)
this field to store the test order name used
"^DD",62.9,62.9001,5.2,21,5,0)
by the non-VistA system. VistA uses this test name
"^DD",62.9,62.9001,5.2,21,6,0)
to identify to the non-VistA system the ordered
"^DD",62.9,62.9001,5.2,21,7,0)
test when orders are transmitted electronically.
"^DD",62.9,62.9001,5.2,21,8,0)
It will be used when the TEST CODING SYSTEM field
"^DD",62.9,62.9001,5.2,21,9,0)
(#.14) is set to "NON-VA". 
"^DD",62.9,62.9001,5.2,21,10,0)
 
"^DD",62.9,62.9001,5.2,21,11,0)
Host facility: 
"^DD",62.9,62.9001,5.2,21,12,0)

"^DD",62.9,62.9001,5.2,21,13,0)
Not used - mapping of non-VA tests coding systems
"^DD",62.9,62.9001,5.2,21,14,0)
for test order codes is via NON-NLT TEST ORDER CODE
"^DD",62.9,62.9001,5.2,21,15,0)
field (#5.1).
"^DD",62.9,62.9001,5.2,"DT")
3041105
"^DD",62.9,62.9001,5.3,0)
NON-HL7 SPECIMEN CODE^F^^5;3^K:$L(X)>10!($L(X)<1) X
"^DD",62.9,62.9001,5.3,3)
Answer must be 1-10 characters in length
"^DD",62.9,62.9001,5.3,21,0)
^.001^22^22^3041105^^^^
"^DD",62.9,62.9001,5.3,21,1,0)
Collecting facilities:
"^DD",62.9,62.9001,5.3,21,2,0)

"^DD",62.9,62.9001,5.3,21,3,0)
If sending test orders to a non-VistA system that
"^DD",62.9,62.9001,5.3,21,4,0)
does not use HL7 Table 0070 Specimen Source, use this
"^DD",62.9,62.9001,5.3,21,5,0)
field to store the specimen code used by the non-VistA
"^DD",62.9,62.9001,5.3,21,6,0)
system. It is only used when the value of field
"^DD",62.9,62.9001,5.3,21,7,0)
SPECIMEN CODING SYSTEM (#.15) is LOCAL-NON HL7.
"^DD",62.9,62.9001,5.3,21,8,0)
It provides a means for a collecting facility to map
"^DD",62.9,62.9001,5.3,21,9,0)
non standard specimen codes to the site's TOPOGRAPHY
"^DD",62.9,62.9001,5.3,21,10,0)
FILED file (#61).
"^DD",62.9,62.9001,5.3,21,11,0)
 
"^DD",62.9,62.9001,5.3,21,12,0)
 
"^DD",62.9,62.9001,5.3,21,13,0)
Host facilities:
"^DD",62.9,62.9001,5.3,21,14,0)
 
"^DD",62.9,62.9001,5.3,21,15,0)
If receiving test orders from a non-VistA system that
"^DD",62.9,62.9001,5.3,21,16,0)
does not use HL7 Table 0070 Specimen Source, use this
"^DD",62.9,62.9001,5.3,21,17,0)
field to store the specimen code used by the non-VistA
"^DD",62.9,62.9001,5.3,21,18,0)
system. It is only used when the value of field
"^DD",62.9,62.9001,5.3,21,19,0)
SPECIMEN CODING SYSTEM (#.15) is LOCAL-NON HL7.
"^DD",62.9,62.9001,5.3,21,20,0)
It provides a means for a host facility to map non
"^DD",62.9,62.9001,5.3,21,21,0)
standard specimen codes to the site's TOPOGRAPHY
"^DD",62.9,62.9001,5.3,21,22,0)
FIELD file (#61).
"^DD",62.9,62.9001,5.3,"DT")
3041105
"^DD",62.9,62.9001,5.4,0)
NON-HL7 SPECIMEN NAME^F^^5;4^K:$L(X)>30!($L(X)<1) X
"^DD",62.9,62.9001,5.4,3)
Answer must be 1-30 characters in length
"^DD",62.9,62.9001,5.4,21,0)
^.001^22^22^3041105^^^^
"^DD",62.9,62.9001,5.4,21,1,0)
Collecting facilities:
"^DD",62.9,62.9001,5.4,21,2,0)
 
"^DD",62.9,62.9001,5.4,21,3,0)
If sending test orders to a non-VistA system that
"^DD",62.9,62.9001,5.4,21,4,0)
does not use HL7 Table 0070 Specimen Source, use this
"^DD",62.9,62.9001,5.4,21,5,0)
field to store the specimen name used by the non-VistA
"^DD",62.9,62.9001,5.4,21,6,0)
system. It is only used when the value of field
"^DD",62.9,62.9001,5.4,21,7,0)
SPECIMEN CODING SYSTEM (#.15) is LOCAL-NON HL7.
"^DD",62.9,62.9001,5.4,21,8,0)
It provides a means for a collecting facility to map
"^DD",62.9,62.9001,5.4,21,9,0)
non standard specimen names to the site's TOPOGRAPHY
"^DD",62.9,62.9001,5.4,21,10,0)
FIELD file (#61).
"^DD",62.9,62.9001,5.4,21,11,0)
 
"^DD",62.9,62.9001,5.4,21,12,0)

"^DD",62.9,62.9001,5.4,21,13,0)
Host facilities:
"^DD",62.9,62.9001,5.4,21,14,0)

"^DD",62.9,62.9001,5.4,21,15,0)
If receiving test orders from a non-VistA system that
"^DD",62.9,62.9001,5.4,21,16,0)
does not use HL7 Table 0070 Specimen Source, use this
"^DD",62.9,62.9001,5.4,21,17,0)
field to store the specimen name used by the non-VistA
"^DD",62.9,62.9001,5.4,21,18,0)
system. It is only used when the value of field
"^DD",62.9,62.9001,5.4,21,19,0)
SPECIMEN CODING SYSTEM (#.15) is LOCAL-NON HL7.
"^DD",62.9,62.9001,5.4,21,20,0)
It provides a means for a host facility to map non
"^DD",62.9,62.9001,5.4,21,21,0)
standard specimen names to the site's TOPOGRAPHY
"^DD",62.9,62.9001,5.4,21,22,0)
FIELD file (#61).
"^DD",62.9,62.9001,5.4,"DT")
3041105
"^DD",62.9,62.9001,5.5,0)
NON-NLT TEST CODING SYSTEM^F^^5;5^K:$L(X)>10!($L(X)<1) X
"^DD",62.9,62.9001,5.5,3)
Answer must be 1-10 characters in length
"^DD",62.9,62.9001,5.5,21,0)
^.001^25^25^3040624^^^^
"^DD",62.9,62.9001,5.5,21,1,0)
Collecting facilities:
"^DD",62.9,62.9001,5.5,21,2,0)
 
"^DD",62.9,62.9001,5.5,21,3,0)
If sending test orders to a non-VA system that does
"^DD",62.9,62.9001,5.5,21,4,0)
not use VA National Laboratory Test (NLT) codes use
"^DD",62.9,62.9001,5.5,21,5,0)
this field to store the name of the coding system
"^DD",62.9,62.9001,5.5,21,6,0)
used by the non-VA system. It will be used when the
"^DD",62.9,62.9001,5.5,21,7,0)
TEST CODING SYSTEM field (#.14) is set to "NON-VA".
"^DD",62.9,62.9001,5.5,21,8,0)
Name usually begins with "99" to indicate a local
"^DD",62.9,62.9001,5.5,21,9,0)
coding system in the HL7 Standard.
"^DD",62.9,62.9001,5.5,21,10,0)
 
"^DD",62.9,62.9001,5.5,21,11,0)
 
"^DD",62.9,62.9001,5.5,21,12,0)
Host facilities:
"^DD",62.9,62.9001,5.5,21,13,0)
 
"^DD",62.9,62.9001,5.5,21,14,0)
If receiving test orders from a non-VA collecting
"^DD",62.9,62.9001,5.5,21,15,0)
facility that does not use VA NLT codes use this 
"^DD",62.9,62.9001,5.5,21,16,0)
field to store the name of the coding system
"^DD",62.9,62.9001,5.5,21,17,0)
used by the non-VA system. It will be used when the
"^DD",62.9,62.9001,5.5,21,18,0)
TEST CODING SYSTEM field (#.14) is set to "NON-VA".
"^DD",62.9,62.9001,5.5,21,19,0)
Name usually begins with "99" to indicate a local
"^DD",62.9,62.9001,5.5,21,20,0)
coding system in the HL7 Standard.
"^DD",62.9,62.9001,5.5,21,21,0)
 
"^DD",62.9,62.9001,5.5,21,22,0)
 
"^DD",62.9,62.9001,5.5,21,23,0)
NLT test codes are standard test codes used within
"^DD",62.9,62.9001,5.5,21,24,0)
the VA system to identify orderable and reportable
"^DD",62.9,62.9001,5.5,21,25,0)
laboratory tests.
"^DD",62.9,62.9001,5.5,"DT")
3040624
"^DD",62.9,62.9001,5.6,0)
NON-HL7 SPECIMEN CODING SYSTEM^F^^5;6^K:$L(X)>10!($L(X)<1) X
"^DD",62.9,62.9001,5.6,3)
Answer must be 1-10 characters in length
"^DD",62.9,62.9001,5.6,21,0)
^.001^21^21^3040624^^^
"^DD",62.9,62.9001,5.6,21,1,0)
Collecting facilities:
"^DD",62.9,62.9001,5.6,21,2,0)
 
"^DD",62.9,62.9001,5.6,21,3,0)
If sending test orders to a non-VistA system
"^DD",62.9,62.9001,5.6,21,4,0)
that does not use HL7 Table 0070 Specimen
"^DD",62.9,62.9001,5.6,21,5,0)
Source, use this field to store the name of the
"^DD",62.9,62.9001,5.6,21,6,0)
coding system used by the non-VistA system. It will
"^DD",62.9,62.9001,5.6,21,7,0)
be used when the value of field SPECIMEN CODING
"^DD",62.9,62.9001,5.6,21,8,0)
SYSTEM (#.15) is LOCAL-NON HL7. Name usually
"^DD",62.9,62.9001,5.6,21,9,0)
begins with "99" to indicate a local coding
"^DD",62.9,62.9001,5.6,21,10,0)
system in the HL7 Standard.
"^DD",62.9,62.9001,5.6,21,11,0)

"^DD",62.9,62.9001,5.6,21,12,0)
 
"^DD",62.9,62.9001,5.6,21,13,0)
Host facilities:
"^DD",62.9,62.9001,5.6,21,14,0)
 
"^DD",62.9,62.9001,5.6,21,15,0)
If receiving test orders from a non-VistA system
"^DD",62.9,62.9001,5.6,21,16,0)
that does not use HL7 Table 0070 Specimen Source,
"^DD",62.9,62.9001,5.6,21,17,0)
use this field to store the name of the coding
"^DD",62.9,62.9001,5.6,21,18,0)
system used by the non-VistA system. It will be used
"^DD",62.9,62.9001,5.6,21,19,0)
when the TEST CODING SYSTEM field (#.14) is set to
"^DD",62.9,62.9001,5.6,21,20,0)
"NON-VA". Name usually begins with "99" to indicate
"^DD",62.9,62.9001,5.6,21,21,0)
a local coding system in the HL7 Standard.
"^DD",62.9,62.9001,5.6,"DT")
3040624
"^DD",62.9,62.9001,5.7,0)
COLLECTION SAMPLE CODE^F^^5;7^K:$L(X)>10!($L(X)<1) X
"^DD",62.9,62.9001,5.7,3)
Answer must be 1-10 characters in length
"^DD",62.9,62.9001,5.7,21,0)
^^9^9^3040426^^
"^DD",62.9,62.9001,5.7,21,1,0)
Collecting facilities:
"^DD",62.9,62.9001,5.7,21,2,0)
 
"^DD",62.9,62.9001,5.7,21,3,0)
If sending test orders to a non-VA facility that also requires
"^DD",62.9,62.9001,5.7,21,4,0)
a collection sample code use this field to store the collection
"^DD",62.9,62.9001,5.7,21,5,0)
sample code used by the non-VA system. It is only used when the
"^DD",62.9,62.9001,5.7,21,6,0)
value of field SPECIMEN CODING SYSTEM (#.15) is LOCAL-NON HL7.
"^DD",62.9,62.9001,5.7,21,7,0)
 
"^DD",62.9,62.9001,5.7,21,8,0)
Host facilities: used to map collecting facility's "MI" subcript
"^DD",62.9,62.9001,5.7,21,9,0)
test's collection sample to host site's collection sample.
"^DD",62.9,62.9001,5.7,"DT")
3040426
"^DD",62.9,62.9001,5.8,0)
COLLECTION SAMPLE NAME^F^^5;8^K:$L(X)>30!($L(X)<1) X
"^DD",62.9,62.9001,5.8,3)
Answer must be 1-30 characters in length
"^DD",62.9,62.9001,5.8,21,0)
^^9^9^3040426^^
"^DD",62.9,62.9001,5.8,21,1,0)
Collecting facilities:
"^DD",62.9,62.9001,5.8,21,2,0)
 
"^DD",62.9,62.9001,5.8,21,3,0)
If sending test orders to a non-VA facility that also requires
"^DD",62.9,62.9001,5.8,21,4,0)
a collection sample name use this field to store the collection
"^DD",62.9,62.9001,5.8,21,5,0)
sample name used by the non-VA system. It is only used when the
"^DD",62.9,62.9001,5.8,21,6,0)
value of field SPECIMEN CODING SYSTEM (#.15) is LOCAL-NON HL7.
"^DD",62.9,62.9001,5.8,21,7,0)
 
"^DD",62.9,62.9001,5.8,21,8,0)
Host facilities: used to map collecting facility's "MI" subcript
"^DD",62.9,62.9001,5.8,21,9,0)
test's collection sample to host site's collection sample.
"^DD",62.9,62.9001,5.8,"DT")
3040426
"^DD",62.9,62.9001,5.9,0)
COLLECT SAMPLE SYSTEM^F^^5;9^K:$L(X)>10!($L(X)<1) X
"^DD",62.9,62.9001,5.9,3)
Answer must be 1-10 characters in length
"^DD",62.9,62.9001,5.9,21,0)
^^11^11^3040426^^
"^DD",62.9,62.9001,5.9,21,1,0)
Collecting facilities:
"^DD",62.9,62.9001,5.9,21,2,0)
 
"^DD",62.9,62.9001,5.9,21,3,0)
If sending collection sample codes/names to a non-VA facility
"^DD",62.9,62.9001,5.9,21,4,0)
use this field to store the name of the coding system used by
"^DD",62.9,62.9001,5.9,21,5,0)
the non-VA system. It will be used when the TEST CODING SYSTEM
"^DD",62.9,62.9001,5.9,21,6,0)
field (#.14) is set to "NON-VA".  Name usually begins with
"^DD",62.9,62.9001,5.9,21,7,0)
"99" to indicate a local coding system in the HL7 Standard.
"^DD",62.9,62.9001,5.9,21,8,0)
 
"^DD",62.9,62.9001,5.9,21,9,0)
 
"^DD",62.9,62.9001,5.9,21,10,0)
Host facilities: used to map collecting facility's "MI" subcript
"^DD",62.9,62.9001,5.9,21,11,0)
test's collection sample to host site's collection sample.
"^DD",62.9,62.9001,5.9,"DT")
3040426
"^DIC",62.485,62.485,0)
LA7 MESSAGE LOG BULLETINS^62.485
"^DIC",62.485,62.485,0,"GL")
^LAHM(62.485,
"^DIC",62.485,62.485,"%D",0)
^^8^8^2970612^
"^DIC",62.485,62.485,"%D",1,0)
This file stores canned text for logging errors or exceptional 
"^DIC",62.485,62.485,"%D",2,0)
conditions during message processing.
"^DIC",62.485,62.485,"%D",3,0)
 
"^DIC",62.485,62.485,"%D",4,0)
This file should not be edited locally by the site, but if a local
"^DIC",62.485,62.485,"%D",5,0)
messaging system is developed, and entries must be added, the site
"^DIC",62.485,62.485,"%D",6,0)
should add new entries at entry numbers higher than 999. It is preferred
"^DIC",62.485,62.485,"%D",7,0)
that the local codes be preceded with the three digit primary site number
"^DIC",62.485,62.485,"%D",8,0)
which would result in a seven digit number, site #_xxxx.
"^DIC",62.485,"B","LA7 MESSAGE LOG BULLETINS",62.485)

**INSTALL NAME**
LR*5.2*286
"BLD",15449,0)
LR*5.2*286^LAB SERVICE^0^3041112^y
"BLD",15449,1,0)
^9.61A^427^427^3041112^^^^
"BLD",15449,1,1,0)
VISTA Laboratory Package patch LR*5.2*286 contains changes to software
"BLD",15449,1,2,0)
controlled by VHA DIRECTIVE 99-053, titled VISTA BLOOD BANK SOFTWARE
"BLD",15449,1,3,0)
VERSION 5.2.  Change includes:
"BLD",15449,1,4,0)
   The addition of the "USE FOR REFERENCE TESTING" field (#13) to the
"BLD",15449,1,5,0)
   "SITE/SPECIMEN SUB-FIELD" (#60.01) of the LABORATORY TEST file (#60).
"BLD",15449,1,6,0)
   The addition of the "USE FOR REFERENCE TESTING" field to the "LR ATOMIC
"BLD",15449,1,7,0)
    TESTS" Input Template.
"BLD",15449,1,8,0)

"BLD",15449,1,9,0)
The above change has been reviewed by the VISTA Blood Bank Developer and
"BLD",15449,1,10,0)
found to have no impact on the VISTA BLOOD BANK SOFTWARE version 5.2
"BLD",15449,1,11,0)
control functions.
"BLD",15449,1,12,0)

"BLD",15449,1,13,0)
RISK ANALYSIS:   Changes made by patch LR*5.2*286 have no effect on Blood
"BLD",15449,1,14,0)
Bank software functionality, therefore RISK is none.
"BLD",15449,1,15,0)

"BLD",15449,1,16,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS:  Patch LR*5.2*286 does not
"BLD",15449,1,17,0)
alter or modify any software design safeguards or safety critical elements
"BLD",15449,1,18,0)
functions.
"BLD",15449,1,19,0)

"BLD",15449,1,20,0)
POTENTIAL IMPACT ON SITES:  This patch contains changes to a Data
"BLD",15449,1,21,0)
Dictionary identified in Veterans Health Administration (VHA) Directive
"BLD",15449,1,22,0)
99-053. The changes have no effect in Blood Bank functionality or medical
"BLD",15449,1,23,0)
device control functions. There is no adverse potential to sites.
"BLD",15449,1,24,0)
 
"BLD",15449,1,25,0)
VALIDATION REQUIREMENTS BY OPTION:  There are no required validation
"BLD",15449,1,26,0)
scenarios to be completed by sites after installing LR*5.2*286.
"BLD",15449,1,27,0)
  
"BLD",15449,1,28,0)
========================================
"BLD",15449,1,29,0)
 
"BLD",15449,1,30,0)
Patch LR*5.2*286 VA/DOD LAB INTEROPERABILITY will be distributed and
"BLD",15449,1,31,0)
installed with patch LA*5.2*64 VA/DOD LAB INTEROPERABILITY
"BLD",15449,1,32,0)
 
"BLD",15449,1,33,0)
This patch adds support for sending/receiving Laboratory Electronic
"BLD",15449,1,34,0)
Data Interchange (LEDI) orders/results with Department of Defense (DoD)
"BLD",15449,1,35,0)
facilities.
"BLD",15449,1,36,0)
 
"BLD",15449,1,37,0)
Laboratory result verification has been enhanced to allow the designation
"BLD",15449,1,38,0)
of a performing laboratory and the use of the performing laboratory's
"BLD",15449,1,39,0)
units, normals, and normalcy status in results reporting.
"BLD",15449,1,40,0)

"BLD",15449,1,41,0)
1. User during the verification process is able to specify the performing
"BLD",15449,1,42,0)
laboratory. The performing laboratory is selected from the list of
"BLD",15449,1,43,0)
available entries in the site's INSTITUTION file (#4). The selection of
"BLD",15449,1,44,0)
entries is screened as follows:
"BLD",15449,1,45,0)
   a. User can select the division they are logged on.
"BLD",15449,1,46,0)
   b. User can select an institution that is configured in the LAB
"BLD",15449,1,47,0)
      SHIPPING CONFIGURATION file (#62.9) as a host facility with their
"BLD",15449,1,48,0)
      division as the collecting facility.
"BLD",15449,1,49,0)
 
"BLD",15449,1,50,0)
2. During acceptance and verification of results received from a reference
"BLD",15449,1,51,0)
laboratory via an HL7 interface (LEDI), the performing laboratory, results,
"BLD",15449,1,52,0)
units, normals and normalcy status contained in the HL7 message are stored
"BLD",15449,1,53,0)
"as is".
"BLD",15449,1,54,0)

"BLD",15449,1,55,0)
3. Receipt of amended reports from a reference laboratory will generate a
"BLD",15449,1,56,0)
MailMan bulletin containing the particulars of the amended report. This
"BLD",15449,1,57,0)
bulletin is sent to the members of the mail group specified for
"BLD",15449,1,58,0)
"New Result" alerts in LA7 MESSAGE PARAMETER file (#62.48) for the interface.
"BLD",15449,1,59,0)
 
"BLD",15449,1,60,0)
4. Amended reports received via a LEDI HL7 interface can be processed
"BLD",15449,1,61,0)
via the Enter/verify/modify data (manual) option [LRENTER].
"BLD",15449,1,62,0)
 
"BLD",15449,1,63,0)
5. Users using the Enter/verify/modify data (manual) option [LRENTER] to
"BLD",15449,1,64,0)
enter results manually from a reference laboratory can use the units and
"BLD",15449,1,65,0)
normals specified in LABORATORY TEST file (#60) by configuring USE FOR
"BLD",15449,1,66,0)
REFERENCE TESTING field (#13) within the SITE/SPECIMEN subfile (#100).
"BLD",15449,1,67,0)
If this field is not enabled for reference laboratory result data entry,
"BLD",15449,1,68,0)
then the user is prompted for units, normals, high and low reference ranges
"BLD",15449,1,69,0)
to store with the results. The Edit atomic tests option [LRDIEATOMIC]
"BLD",15449,1,70,0)
allows Labortory Information Manager (LIM) to designate this functionality
"BLD",15449,1,71,0)
for affected tests.
"BLD",15449,1,72,0)
 
"BLD",15449,1,73,0)
6. NOIS DEN-1299-52099, NYH-0700-11942, PHI-0803-21507, TAM-0400-31033, and
"BLD",15449,1,74,0)
WPB-0900-32221 reported the defect of normalcy status (low/high/critical
"BLD",15449,1,75,0)
low/critical high) being incorrectly evaluated when the test result is
"BLD",15449,1,76,0)
zero (0). Evaluation of normalcy status will properly deal with test
"BLD",15449,1,77,0)
results of zero (0).
"BLD",15449,1,78,0)
 
"BLD",15449,1,79,0)
7. Changing normalcy status and units will trigger the generation of audit
"BLD",15449,1,80,0)
trail comments.
"BLD",15449,1,81,0)
 
"BLD",15449,1,82,0)
8. During verification, the ordering provider's phone and pager information
"BLD",15449,1,83,0)
is displayed.
"BLD",15449,1,84,0)
 
"BLD",15449,1,85,0)
9. Display of lab results in the Computerized Patient Record System
"BLD",15449,1,86,0)
Graphical User Interface (CPRS GUI) and Laboratory Interim Reports has
"BLD",15449,1,87,0)
been modified to display units and normals associated with results at time
"BLD",15449,1,88,0)
of verification. Results that are derived from a Set of Codes will be
"BLD",15449,1,89,0)
reported using the external form of the code.
"BLD",15449,1,90,0)
 
"BLD",15449,1,91,0)
10. Display of performing laboratory has been added to CPRS GUI display of
"BLD",15449,1,92,0)
results.
"BLD",15449,1,93,0)

"BLD",15449,1,94,0)
11. NOIS DAY-0303-40775 reported a defect in display of lab results with
"BLD",15449,1,95,0)
embedded spaces. When lab results contained embedded spaces these spaces
"BLD",15449,1,96,0)
were being removed prior to the display of the lab result. The removal of
"BLD",15449,1,97,0)
theses spaces resulted in corruption of the result. Routines LR7OB63 and
"BLD",15449,1,98,0)
LR7OR2 have been corrected to trim leading and trailing spaces but leave
"BLD",15449,1,99,0)
embedded spaces.
"BLD",15449,1,100,0)
 
"BLD",15449,1,101,0)
12. Enter/verify data (auto instrument) [LRVR] and Enter/verify/modify
"BLD",15449,1,102,0)
data (manual) [LRENTER] options will display patient information from
"BLD",15449,1,103,0)
PAT. INFO. field (#.091) in LAB DATA file (#63) during result verification.
"BLD",15449,1,104,0)
(E3R #13408)
"BLD",15449,1,105,0)
 
"BLD",15449,1,106,0)
13. Alignment of test results during verification process has been adjusted
"BLD",15449,1,107,0)
to avoid display of previous and current test results together. Results
"BLD",15449,1,108,0)
will be displayed right-justified under the date/time of each specimen.  
"BLD",15449,1,109,0)
  
"BLD",15449,1,110,0)
14. NOIS ALB-0100-50284, FAV-1103-70892 reported a failure of UID creation
"BLD",15449,1,111,0)
and storage when creating a non-daily accession that is in common with
"BLD",15449,1,112,0)
another accession area. The failure occurs on the creation of the first
"BLD",15449,1,113,0)
accession for a given accession area and date. After the first accession
"BLD",15449,1,114,0)
for an accession date is created and stored in ACCESSION file (#68)
"BLD",15449,1,115,0)
subsequent accessions have the UID stored properly. Failure was due to
"BLD",15449,1,116,0)
missing subfile zeroth nodes for the ACCESSION DATE multiple (#68.01) and
"BLD",15449,1,117,0)
ACCESSION NUMBER multiple (#68.02) of the ACCESSION file (#68) when calling
"BLD",15449,1,118,0)
FileMan to store the UID. Routine LRWLST1 will now check and set the
"BLD",15449,1,119,0)
subfile's zeroth nodes before calling FileMan.
"BLD",15449,1,120,0)
 
"BLD",15449,1,121,0)
  FileMan calls have been converted from classic FileMan DIE calls to
"BLD",15449,1,122,0)
FileMan Database Server calls (DBS). When an error condition is
"BLD",15449,1,123,0)
encountered during a FileMan DBS call, the Laboratory package will
"BLD",15449,1,124,0)
generate a mail message with the subject "FileMan DBS call failed during
"BLD",15449,1,125,0)
accessioning in routine LRWLST1". This message will be sent to the local
"BLD",15449,1,126,0)
mail group "LMI". It will contain debugging information to assist site
"BLD",15449,1,127,0)
and National VistA Support in resolving the condition that produced the
"BLD",15449,1,128,0)
error.
"BLD",15449,1,129,0)
  
"BLD",15449,1,130,0)
15. NOIS BON-0196-71728 reported a problem with storing the appropriate
"BLD",15449,1,131,0)
treating specialty associated with an accession. A bad or incorrect
"BLD",15449,1,132,0)
pointer to FACILITY TREATING SPECIALTY file (#45.7) could be stored in
"BLD",15449,1,133,0)
the TREATING SPECIALTY (#6.6) field within the ACCESSION NUMBER field
"BLD",15449,1,134,0)
(#68.02) multiple within the ACCESSION DATE field (#68.01) multiple of
"BLD",15449,1,135,0)
the ACCESSION file (#68). When a specimen is accessioned for a
"BLD",15449,1,136,0)
non-inpatient and the user selects an inpatient ordering location the
"BLD",15449,1,137,0)
software would use the specialty from SPECIALITY file (#42.4) that
"BLD",15449,1,138,0)
is associated with the WARD LOCATION file (#42) entry linked to the
"BLD",15449,1,139,0)
HOSPITAL LOCATION file (#44).
"BLD",15449,1,140,0)
 
"BLD",15449,1,141,0)
   Routine LRWLST1 will determine treating specialty based on the
"BLD",15449,1,142,0)
associated TREATING SPECIALTY field (#9.5) in the HOSPITAL LOCATION file
"BLD",15449,1,143,0)
(#44) when the patient is not an inpatient. When a patient is an inpatient
"BLD",15449,1,144,0)
then treating specialty will be determined from the PATIENT file (#2),
"BLD",15449,1,145,0)
TREATING SPECIALTY field (.103). Treating specialty will only be stored
"BLD",15449,1,146,0)
in ACCESSION file (#68) when the patient is from PATIENT file (#2).
"BLD",15449,1,147,0)
 
"BLD",15449,1,148,0)
16. The following defects were identified during the software review as
"BLD",15449,1,149,0)
part of patch development.
"BLD",15449,1,150,0)
 
"BLD",15449,1,151,0)
  a. Ordering location and ordering provider will not be stored on
"BLD",15449,1,152,0)
accessions that are related to LAB CONTROL NAME file (#62.3) entries.
"BLD",15449,1,153,0)
 
"BLD",15449,1,154,0)
  b. During accessioning if accession area is locked by another process,
"BLD",15449,1,155,0)
the message displayed to user was "Accession area is locked by another
"BLD",15449,1,156,0)
user." Message will now include the name of the accession area that
"BLD",15449,1,157,0)
the software is waiting on lock.
"BLD",15449,1,158,0)

"BLD",15449,1,159,0)
  c. Interim report options and displays will display month portion of
"BLD",15449,1,160,0)
date/times using the three letter abbreviation instead of the two number
"BLD",15449,1,161,0)
designation to eliminate potential confusion with day portion of dates.
"BLD",15449,1,162,0)
Time is displayed using 24 hour time format.
"BLD",15449,1,163,0)
 
"BLD",15449,1,164,0)
  d. Interim report could display the wrong ordering and collecting site
"BLD",15449,1,165,0)
when the specimen was received from an integrated facility. Report will
"BLD",15449,1,166,0)
display the correct ordering and collecting site.
"BLD",15449,1,167,0)
 
"BLD",15449,1,168,0)
  e. Referral Patient Multi-purpose Accession option [LR LEDI] was
"BLD",15449,1,169,0)
prompting the user for CPRS Nature of Order which is not used during
"BLD",15449,1,170,0)
accessioning of non-PATIENT file (#2) patients. Routine LROW3 is
"BLD",15449,1,171,0)
modified to only prompt the user for CPRS Nature of Order when
"BLD",15449,1,172,0)
accessioning a patient from the PATIENT file (#2).
"BLD",15449,1,173,0)
  
"BLD",15449,1,174,0)
  f. Previous test versions of previous LEDI versions may have installed 
"BLD",15449,1,175,0)
two versions of the "D" cross reference in LAB PENDING ORDERS ENTRY file
"BLD",15449,1,176,0)
(#69.6). The post-install will delete and reindex the "D" cross reference
"BLD",15449,1,177,0)
on file #69.6.
"BLD",15449,1,178,0)
 
"BLD",15449,1,179,0)
  g. Entering of accession number during lab results verification will 
"BLD",15449,1,180,0)
check for invalid values or numbers out of range (1-999999).
"BLD",15449,1,181,0)
  
"BLD",15449,1,182,0)
17. Referral Patient Multi-purpose Accession option [LR LEDI] will check
"BLD",15449,1,183,0)
for pending orders when performing accessioning without a bar code scanner.
"BLD",15449,1,184,0)
It will display to the user and store order comments that accompanies
"BLD",15449,1,185,0)
electronic orders with order in LAB ORDER ENTRY file (#69).
"BLD",15449,1,186,0)
 
"BLD",15449,1,187,0)
18. When using the Enter/verify/modify data (manual) option [LRENTER] to
"BLD",15449,1,188,0)
amend previously released results user can now enter their verifying
"BLD",15449,1,189,0)
initials in mixed case. 
"BLD",15449,1,190,0)
 
"BLD",15449,1,191,0)
19. NOIS CHS-0303-40534 reported a defect which prevented results for
"BLD",15449,1,192,0)
reflex tests added to a LEDI order at the host laboratory being returned
"BLD",15449,1,193,0)
electronically to the collecting laboratory. Routine LRWLST11 was storing
"BLD",15449,1,194,0)
the collecting site as both the collecting site and ordering site in the
"BLD",15449,1,195,0)
order created in LAB ORDER ENTRY file (#69). When a collecting site is a
"BLD",15449,1,196,0)
member of an integrated facility the collecting site is the site collecting
"BLD",15449,1,197,0)
the specimen and the ordering site is the primary facility of the
"BLD",15449,1,198,0)
integrated institution. Reflex test added by the host site would have the
"BLD",15449,1,199,0)
incorrect ordering site assigned which prevents the LEDI software from
"BLD",15449,1,200,0)
returning the results of the reflex test to the collecting facility. Defect
"BLD",15449,1,201,0)
has been corrected to store the correct ordering and collecting sites on
"BLD",15449,1,202,0)
LEDI accessions.
"BLD",15449,1,203,0)
 
"BLD",15449,1,204,0)
20. NOIS BRK-0499-10720, MAR-0603-21152 reported a defect during lab
"BLD",15449,1,205,0)
result verification using option Enter/verify/modify data (manual)
"BLD",15449,1,206,0)
[LRENTER] which caused the previous patient demographics to be displayed
"BLD",15449,1,207,0)
when entering results on an accession. If the previous selected accession
"BLD",15449,1,208,0)
was in an uncollected state, the option was skipping the uncollected
"BLD",15449,1,209,0)
accession and incrementing the default accession number to the next
"BLD",15449,1,210,0)
available accession. If the user selects this or another accession, the
"BLD",15449,1,211,0)
patient demographics of the selected accession were not being displayed.
"BLD",15449,1,212,0)
Instead, the patient demographics of the uncollected accession were
"BLD",15449,1,213,0)
displayed. Routine LRVER will now display the patient demographics of the
"BLD",15449,1,214,0)
currently selected accession.
"BLD",15449,1,215,0)

"BLD",15449,1,216,0)
21. NOIS SFC-1103-60132 reported a defect during display of lab results
"BLD",15449,1,217,0)
in the CPRS GUI. When a critical flag becomes part of the data for a
"BLD",15449,1,218,0)
patient in CPRS, the line of data containing the flag becomes split
"BLD",15449,1,219,0)
after the * following the high or low flag, and the units along with
"BLD",15449,1,220,0)
the reference range gets bumped to the next line down. Routine LR7OGMP
"BLD",15449,1,221,0)
increases the space allocated to display this information from 37 to 38
"BLD",15449,1,222,0)
characters to display units/normals on same line.
"BLD",15449,1,223,0)
 
"BLD",15449,1,224,0)
22. When displaying results that are a Set of Codes data type, the result
"BLD",15449,1,225,0)
will be displayed using the external value for the set of codes.
"BLD",15449,1,226,0)
 
"BLD",15449,1,227,0)
23. NOIS NYH-0700-11942 reported a defect with critical value flag not
"BLD",15449,1,228,0)
being triggered when entering a value of 0. Value of 0 will be evaluated
"BLD",15449,1,229,0)
when performing high/low/critical value checks.
"BLD",15449,1,230,0)
 
"BLD",15449,1,231,0)
24. When verifying results from a reference laboratory using Enter/verify
"BLD",15449,1,232,0)
data (auto instrument) option [LRVR], any test results that have not
"BLD",15449,1,233,0)
been verified will be displayed to the user after verification. The display
"BLD",15449,1,234,0)
will list the test names, results, abnormal flags and units if available. 
"BLD",15449,1,235,0)
This display will list the test(s) as not reviewed. This may indicate that
"BLD",15449,1,236,0)
additional or reflex testing has been added by the reference laboratory.
"BLD",15449,1,237,0)
These additional tests may need to be added to the accession to process
"BLD",15449,1,238,0)
these results.
"BLD",15449,1,239,0)
 
"BLD",15449,1,240,0)
25. During verification of laboratory results, comments for a previous
"BLD",15449,1,241,0)
result are displayed along with the previous result when entering
"BLD",15449,1,242,0)
results manually or by automated instrument for user selected tests
"BLD",15449,1,243,0)
(E3R #18490). Users can indicate which tests should have previous
"BLD",15449,1,244,0)
test comments displayed during verification by flagging the test using
"BLD",15449,1,245,0)
General Lab User Parameters option [LR USER PARAM] located on the
"BLD",15449,1,246,0)
Information-help menu [LRHELP].
"BLD",15449,1,247,0)

"BLD",15449,1,248,0)
26. NOIS SDC-0904-61304  Reported a defect with the display of text
"BLD",15449,1,249,0)
results in CPRS when using the Laboratory Results-All Test By Date and
"BLD",15449,1,250,0)
Laboratory Results-Selected Tests By Date. When a text result was
"BLD",15449,1,251,0)
displayed that exceeded 10 characters and the test has no units or
"BLD",15449,1,252,0)
normals specified, the display of the result was corrupted with <spaces>
"BLD",15449,1,253,0)
inserted into the text. Test results will be displayed without corruption.
"BLD",15449,1,254,0)
Units, reference ranges, and site codes will be displayed on the following
"BLD",15449,1,255,0)
line when test results print in area usually reserved for these parameters.
"BLD",15449,1,256,0)
 
"BLD",15449,1,257,0)
27. NOIS IND-0498-42538 reported a defect in display of test comments during
"BLD",15449,1,258,0)
lab test result verification when encountering an 'end-of-page' condition.
"BLD",15449,1,259,0)
All test comments will now be displayed.
"BLD",15449,1,260,0)
 
"BLD",15449,1,261,0)

"BLD",15449,1,262,0)
 PATIENT SAFETY ISSUES RESOLVED IN THIS PATCH:
"BLD",15449,1,263,0)
 ============================================
"BLD",15449,1,264,0)
 
"BLD",15449,1,265,0)
 PSI-040260/NOIS HVH-0604-10572 - "Not Performed test Resulted
"BLD",15449,1,266,0)
 - No Alert Generated"
"BLD",15449,1,267,0)
  
"BLD",15449,1,268,0)
This patch corrects defects in software used to set laboratory tests
"BLD",15449,1,269,0)
to a Not-Performed (NP) state. The NP state was introduced by patch
"BLD",15449,1,270,0)
LR*5.2*221 in 1999.  The functionality introduced by this patch replaced
"BLD",15449,1,271,0)
the "delete-a-test" functionality. Instead of deleting tests, tests are
"BLD",15449,1,272,0)
now set to a not-performed state.
"BLD",15449,1,273,0)
 
"BLD",15449,1,274,0)
However, tests in the NP state could still be edited such that the NP
"BLD",15449,1,275,0)
state is replaced with an actual result. Results entered into NP tests
"BLD",15449,1,276,0)
were not treated in the same manner as results entered through the normal
"BLD",15449,1,277,0)
results entry pathways. File updates to ACCESSION file (#68), LAB ORDER
"BLD",15449,1,278,0)
ENTRY file (#69), and ORDER file (#100) as well as alerts were not
"BLD",15449,1,279,0)
generated. This situation was documented in NOIS HVH-0604-10572
"BLD",15449,1,280,0)
- "Not Performed test Resulted - No Alert Generated". This was identified
"BLD",15449,1,281,0)
as a potential patient safety risk. With concurrence from the Pathology
"BLD",15449,1,282,0)
& Laboratory Medicine Program Office, the appropriate mechanism for
"BLD",15449,1,283,0)
handling the situation is to disable editing of NP tests. If the test is
"BLD",15449,1,284,0)
designated as NP and the user wants to edit the test result, they will
"BLD",15449,1,285,0)
now have to order the test(s) in a new accession.
"BLD",15449,1,286,0)
 
"BLD",15449,1,287,0)
  
"BLD",15449,1,288,0)
ASSOCIATED E3R
"BLD",15449,1,289,0)
--------------
"BLD",15449,1,290,0)
 E3R #13408, ADDING INFECTION WARNING TO PROCESS DATA OPTIONS
"BLD",15449,1,291,0)
 E3R #16060, CORRECT ALIGNMENT PROBLEM
"BLD",15449,1,292,0)
 E3R #17904, LEDI BETWEEN VA AND DOD SITES
"BLD",15449,1,293,0)
 E3R #18490, COMMENTS DISPLAY FORPRVIOUS RESULTS
"BLD",15449,1,294,0)
 
"BLD",15449,1,295,0)
 
"BLD",15449,1,296,0)
ASSOCIATED NOIS
"BLD",15449,1,297,0)
---------------
"BLD",15449,1,298,0)
 ALB-0100-50284
"BLD",15449,1,299,0)
 BRK-0499-10720
"BLD",15449,1,300,0)
 BON-0196-71728
"BLD",15449,1,301,0)
 CHS-0303-40534
"BLD",15449,1,302,0)
 DAY-0303-40775
"BLD",15449,1,303,0)
 DEN-1299-52099
"BLD",15449,1,304,0)
 FAV-1103-70892
"BLD",15449,1,305,0)
 HVH-0604-10572
"BLD",15449,1,306,0)
 IND-0498-42538
"BLD",15449,1,307,0)
 MAR-0603-21152
"BLD",15449,1,308,0)
 NYH-0700-11942
"BLD",15449,1,309,0)
 PHI-0803-21507
"BLD",15449,1,310,0)
 SDC-0904-61304
"BLD",15449,1,311,0)
 SFC-1103-60132
"BLD",15449,1,312,0)
 TAM-0400-31033
"BLD",15449,1,313,0)
 WPB-0900-32221
"BLD",15449,1,314,0)
 
"BLD",15449,1,315,0)

"BLD",15449,1,316,0)
TEST SITES
"BLD",15449,1,317,0)
----------
"BLD",15449,1,318,0)
 Albuquerque VAMC - VMS/DSM and VMS/Cache
"BLD",15449,1,319,0)
 Boston HCS - VMS/DSM and VMS/Cache
"BLD",15449,1,320,0)
 El Paso HCS - NT/Cache and VMS/Cache
"BLD",15449,1,321,0)
 Hines VAMC - VMS/DSM and VMS/Cache
"BLD",15449,1,322,0)
 Honolulu VAMC -  NT/Cache
"BLD",15449,1,323,0)
 Manchester VAMC - NT/Cache NT and VMS/Cache
"BLD",15449,1,324,0)
 Milwaukee VAMC - VMS/DSM
"BLD",15449,1,325,0)
 North Chicago VAMC - VMS/DSM
"BLD",15449,1,326,0)
 Salt Lake City VAMC - VMS/DSM
"BLD",15449,1,327,0)
 San Diego VAMC - VMS/DSM and VMS/Cache
"BLD",15449,1,328,0)
 Upstate New York HCS - VMS/DSM and VMS/Cache
"BLD",15449,1,329,0)
 
"BLD",15449,1,330,0)
 
"BLD",15449,1,331,0)
 INSTALLATION FILES:
"BLD",15449,1,332,0)
 ==================
"BLD",15449,1,333,0)
 The following software and documentation files are exported as part of
"BLD",15449,1,334,0)
 this patch:
"BLD",15449,1,335,0)
 
"BLD",15449,1,336,0)
    File Name             Contents                     Retrieval Format
"BLD",15449,1,337,0)
    ---------             --------                     ----------------
"BLD",15449,1,338,0)
 
"BLD",15449,1,339,0)
LAB_LEDI_III.KID        LA*5.2*64 KIDS build           ASCII
"BLD",15449,1,340,0)
                        LR*5.2*286 KIDS build
"BLD",15449,1,341,0)
 
"BLD",15449,1,342,0)
 
"BLD",15449,1,343,0)
LAB_LEDI_III_IG.PDF     LABORATORY ELECTRONIC DATA     BINARY
"BLD",15449,1,344,0)
                        INSTALLATION GUIDE
"BLD",15449,1,345,0)
 
"BLD",15449,1,346,0)
LAB_LEDI_III_IMP_UG.PDF LABORATORY ELECTRONIC DATA     BINARY
"BLD",15449,1,347,0)
                        IMPLEMENTATION AND USER GUIDE
"BLD",15449,1,348,0)
 
"BLD",15449,1,349,0)
 The files listed above may be obtained via FTP.  The preferred method is
"BLD",15449,1,350,0)
 to FTP the files from:
"BLD",15449,1,351,0)
 
"BLD",15449,1,352,0)
    download.vista.med.va.gov
"BLD",15449,1,353,0)
 
"BLD",15449,1,354,0)
 This transmits the files from the first available FTP server.  Sites may
"BLD",15449,1,355,0)
 also elect to retrieve software directly from a specific server as
"BLD",15449,1,356,0)
 follows:
"BLD",15449,1,357,0)
 
"BLD",15449,1,358,0)
    CIO FIELD OFFICE   FTP ADDRESS                 DIRECTORY
"BLD",15449,1,359,0)
    ----------------   -------------------------   --------------------
"BLD",15449,1,360,0)
    Albany             ftp.fo-albany.med.va.gov    [anonymous.software]
"BLD",15449,1,361,0)
    Hines              ftp.fo-hines.med.va.gov     [anonymous.software]
"BLD",15449,1,362,0)
    Salt Lake City     ftp.fo-slc.med.va.gov       [anonymous.software] 
"BLD",15449,1,363,0)
 
"BLD",15449,1,364,0)
  
"BLD",15449,1,365,0)
ROUTINE SUMMARY
"BLD",15449,1,366,0)
===============
"BLD",15449,1,367,0)
  The following routines are included in this patch.  The second line
"BLD",15449,1,368,0)
  of each of these routines now looks like:
"BLD",15449,1,369,0)
  <tab> ;;5.2;LAB SERVICE;<patchlist>;Sep 27, 1994
"BLD",15449,1,370,0)
 
"BLD",15449,1,371,0)
                    Checksum       Checksum
"BLD",15449,1,372,0)
   Routine Name     Before Patch   After Patch    Patch List
"BLD",15449,1,373,0)
   ------------     ------------   -----------    ------------
"BLD",15449,1,374,0)
   LR286            N/A            5465218        **286** (Deleted by KIDS)
"BLD",15449,1,375,0)
   LR7OB63          9973912        9132350        **121,187,286**
"BLD",15449,1,376,0)
   LR7OGM           8016197        8279122        **187,220,312,286**
"BLD",15449,1,377,0)
   LR7OGMC          5100174        5463477        **187,230,312,286**
"BLD",15449,1,378,0)
   LR7OGMG          3593445        3973477        **187,230,286**
"BLD",15449,1,379,0)
   LR7OGMP          5548341        6065382        **187,246,282,286**
"BLD",15449,1,380,0)
   LR7OR2           9125008        8919494        **121,187,219,285,286**
"BLD",15449,1,381,0)
   LR7OSUM1         12883059       12868699       **121,187,256,286**
"BLD",15449,1,382,0)
   LR7OSUM6         7911216        5450631        **121,201,187,286**
"BLD",15449,1,383,0)
   LRAFUNC          5202410        5809534        **286**
"BLD",15449,1,384,0)
   LRDIDLE0         5463932        6544739        **140,171,153,286**
"BLD",15449,1,385,0)
   LRDPAREF         5111405        7469302        **153,222,286**
"BLD",15449,1,386,0)
   LRDPAREX         7190033        6456580        **153,286**
"BLD",15449,1,387,0)
   LREVENT          3678954        2907416        **153,286**
"BLD",15449,1,388,0)
   LRFAST           19691126       18799737       **100,121,201,286**
"BLD",15449,1,389,0)
   LRFASTS          6423167        6524547        **30,95,121,271,286**
"BLD",15449,1,390,0)
   LRGP1            3988622        4165501        **112,269,286**
"BLD",15449,1,391,0)
   LROE             14550901       11534796       **100,121,201,221,263,286**
"BLD",15449,1,392,0)
   LRORD            12009917       12806626       **100,121,153,286**
"BLD",15449,1,393,0)
   LRORD1           9848796        9190513        **1,8,121,153,201,286**
"BLD",15449,1,394,0)
   LRORDB           3782224        7231598        **153,222,286**
"BLD",15449,1,395,0)
   LROW3            7497722        6459972        **33,121,286**
"BLD",15449,1,396,0)
   LRRP             11838355       9427993        **195,221,283,286**
"BLD",15449,1,397,0)
   LRRP1            8015031        6556852        **153,221,283,286**
"BLD",15449,1,398,0)
   LRRPU            N/A            3220194        **286**
"BLD",15449,1,399,0)
   LRSTUF1          13209134       11668378       **153,286**
"BLD",15449,1,400,0)
   LRVER            17228890       15441873       **153,286**
"BLD",15449,1,401,0)
   LRVER1           8587449        7330679        **42,153,201,215,239,240,
"BLD",15449,1,402,0)
                                                  263,232,286**
"BLD",15449,1,403,0)
   LRVER3           14311842       13055299       **42,100,121,140,171,153,
"BLD",15449,1,404,0)
                                                  221,286**
"BLD",15449,1,405,0)
   LRVER4           19639169       14489554       **14,42,112,121,140,171,
"BLD",15449,1,406,0)
                                                  153,188,279,283,286**
"BLD",15449,1,407,0)
   LRVER5           14564045       14854455       **42,153,283,286**
"BLD",15449,1,408,0)
   LRVERA           690805         5764794        **153,271,286**
"BLD",15449,1,409,0)
   LRVR             13316120       11130012       **42,153,263,286**
"BLD",15449,1,410,0)
   LRVR1            11269859       11667912       **42,153,221,286**
"BLD",15449,1,411,0)
   LRVR3            10486080       11176919       **42,121,153,286**
"BLD",15449,1,412,0)
   LRVR4            8885642        9645653        **14,42,121,153,221,263,
"BLD",15449,1,413,0)
                                                  279,283,287,286**
"BLD",15449,1,414,0)
   LRVR5            11950773       4666781        **1,42,153,263,283,286**
"BLD",15449,1,415,0)
   LRWLST1          18457202       12664045       **48,65,121,153,261,286**
"BLD",15449,1,416,0)
   LRWLST11         21393713       16883055       **121,128,153,202,286**
"BLD",15449,1,417,0)
 
"BLD",15449,1,418,0)
 List of preceding patches: 187, 202, 222, 230, 232, 256, 261, 269, 271
"BLD",15449,1,419,0)
 282, 283, 285, 287, 312
"BLD",15449,1,420,0)
 Sites should use CHECK^XTSUMBLD to verify checksums.
"BLD",15449,1,421,0)
 
"BLD",15449,1,422,0)
 
"BLD",15449,1,423,0)
INSTALLATION INSTRUCTIONS
"BLD",15449,1,424,0)
=========================
"BLD",15449,1,425,0)
 
"BLD",15449,1,426,0)
See LABORATORY ELECTRONIC DATA INTERCHANGE III (LEDI III) INSTALLATION GUIDE
"BLD",15449,1,427,0)
    LA*5.2*64/LR*5.2*286
"BLD",15449,4,0)
^9.64PA^61^4
"BLD",15449,4,60,0)
60
"BLD",15449,4,60,2,0)
^9.641^60.01^1
"BLD",15449,4,60,2,60.01,0)
SITE/SPECIMEN  (sub-file)
"BLD",15449,4,60,2,60.01,1,0)
^9.6411^13^1
"BLD",15449,4,60,2,60.01,1,13,0)
USE FOR REFERENCE TESTING
"BLD",15449,4,60,222)
y^n^p^^^^n^^n
"BLD",15449,4,60,224)

"BLD",15449,4,61,0)
61
"BLD",15449,4,61,2,0)
^9.641^61^1
"BLD",15449,4,61,2,61,0)
TOPOGRAPHY FIELD  (File-top level)
"BLD",15449,4,61,2,61,1,0)
^9.6411^.09^1
"BLD",15449,4,61,2,61,1,.09,0)
LEDI HL7
"BLD",15449,4,61,222)
y^n^p^^^^n^^n
"BLD",15449,4,61,224)

"BLD",15449,4,68.2,0)
68.2
"BLD",15449,4,68.2,2,0)
^9.641^68.23^1
"BLD",15449,4,68.2,2,68.23,0)
PROFILE  (sub-file)
"BLD",15449,4,68.2,2,68.23,1,0)
^9.6411^2.3^1
"BLD",15449,4,68.2,2,68.23,1,2.3,0)
DEFAULT REFERENCE LABORATORY
"BLD",15449,4,68.2,222)
y^n^p^^^^n^^n
"BLD",15449,4,68.2,224)

"BLD",15449,4,69.6,0)
69.6
"BLD",15449,4,69.6,222)
y^n^f^^^^n
"BLD",15449,4,"APDD",60,60.01)

"BLD",15449,4,"APDD",60,60.01,13)

"BLD",15449,4,"APDD",61,61)

"BLD",15449,4,"APDD",61,61,.09)

"BLD",15449,4,"APDD",68.2,68.23)

"BLD",15449,4,"APDD",68.2,68.23,2.3)

"BLD",15449,4,"B",60,60)

"BLD",15449,4,"B",61,61)

"BLD",15449,4,"B",68.2,68.2)

"BLD",15449,4,"B",69.6,69.6)

"BLD",15449,"INI")
PRE^LR286
"BLD",15449,"INID")
y
"BLD",15449,"INIT")
POST^LR286
"BLD",15449,"KRN",0)
^9.67PA^8989.52^19
"BLD",15449,"KRN",.4,0)
.4
"BLD",15449,"KRN",.401,0)
.401
"BLD",15449,"KRN",.402,0)
.402
"BLD",15449,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",15449,"KRN",.402,"NM",1,0)
LR ATOMIC TESTS    FILE #60^60^0
"BLD",15449,"KRN",.402,"NM",2,0)
LRLLDFT    FILE #68.2^68.2^0
"BLD",15449,"KRN",.402,"NM","B","LR ATOMIC TESTS    FILE #60",1)

"BLD",15449,"KRN",.402,"NM","B","LRLLDFT    FILE #68.2",2)

"BLD",15449,"KRN",.403,0)
.403
"BLD",15449,"KRN",.5,0)
.5
"BLD",15449,"KRN",.84,0)
.84
"BLD",15449,"KRN",3.6,0)
3.6
"BLD",15449,"KRN",3.8,0)
3.8
"BLD",15449,"KRN",9.2,0)
9.2
"BLD",15449,"KRN",9.8,0)
9.8
"BLD",15449,"KRN",9.8,"NM",0)
^9.68A^49^38
"BLD",15449,"KRN",9.8,"NM",1,0)
LRVER^^0^B42247710
"BLD",15449,"KRN",9.8,"NM",8,0)
LRWLST1^^0^B73104899
"BLD",15449,"KRN",9.8,"NM",10,0)
LRDPAREF^^0^B35243910
"BLD",15449,"KRN",9.8,"NM",15,0)
LRVER3^^0^B48071171
"BLD",15449,"KRN",9.8,"NM",16,0)
LROE^^0^B30204534
"BLD",15449,"KRN",9.8,"NM",17,0)
LRRP^^0^B18090876
"BLD",15449,"KRN",9.8,"NM",18,0)
LRRP1^^0^B21441496
"BLD",15449,"KRN",9.8,"NM",19,0)
LRRPU^^0^B9809057
"BLD",15449,"KRN",9.8,"NM",20,0)
LRVR^^0^B29572000
"BLD",15449,"KRN",9.8,"NM",21,0)
LRVR1^^0^B35974824
"BLD",15449,"KRN",9.8,"NM",22,0)
LRVR3^^0^B36944972
"BLD",15449,"KRN",9.8,"NM",23,0)
LRVR4^^0^B49098381
"BLD",15449,"KRN",9.8,"NM",24,0)
LRVR5^^0^B12201851
"BLD",15449,"KRN",9.8,"NM",25,0)
LRVER4^^0^B81796487
"BLD",15449,"KRN",9.8,"NM",26,0)
LRVER5^^0^B82061816
"BLD",15449,"KRN",9.8,"NM",27,0)
LRVERA^^0^B22675696
"BLD",15449,"KRN",9.8,"NM",28,0)
LRWLST11^^0^B52415321
"BLD",15449,"KRN",9.8,"NM",29,0)
LRDIDLE0^^0^B15196179
"BLD",15449,"KRN",9.8,"NM",30,0)
LR7OR2^^0^B17139954
"BLD",15449,"KRN",9.8,"NM",31,0)
LR7OB63^^0^B23872851
"BLD",15449,"KRN",9.8,"NM",32,0)
LR7OGMC^^0^B9576583
"BLD",15449,"KRN",9.8,"NM",33,0)
LR7OGMG^^0^B6340321
"BLD",15449,"KRN",9.8,"NM",34,0)
LR7OGMP^^0^B12834483
"BLD",15449,"KRN",9.8,"NM",35,0)
LR7OSUM1^^0^B40180103
"BLD",15449,"KRN",9.8,"NM",36,0)
LR7OSUM6^^0^B12942824
"BLD",15449,"KRN",9.8,"NM",37,0)
LR7OGM^^0^B29928467
"BLD",15449,"KRN",9.8,"NM",38,0)
LRGP1^^0^B17796634
"BLD",15449,"KRN",9.8,"NM",39,0)
LRSTUF1^^0^B16472498
"BLD",15449,"KRN",9.8,"NM",40,0)
LRORD^^0^B25739403
"BLD",15449,"KRN",9.8,"NM",41,0)
LRORDB^^0^B38948502
"BLD",15449,"KRN",9.8,"NM",42,0)
LRFAST^^0^B27602884
"BLD",15449,"KRN",9.8,"NM",43,0)
LRFASTS^^0^B12956856
"BLD",15449,"KRN",9.8,"NM",44,0)
LRVER1^^0^B30450805
"BLD",15449,"KRN",9.8,"NM",45,0)
LRORD1^^0^B21032923
"BLD",15449,"KRN",9.8,"NM",46,0)
LRDPAREX^^0^B22694113
"BLD",15449,"KRN",9.8,"NM",47,0)
LREVENT^^0^B8007359
"BLD",15449,"KRN",9.8,"NM",48,0)
LROW3^^0^B12243120
"BLD",15449,"KRN",9.8,"NM",49,0)
LRAFUNC^^0^B15534938
"BLD",15449,"KRN",9.8,"NM","B","LR7OB63",31)

"BLD",15449,"KRN",9.8,"NM","B","LR7OGM",37)

"BLD",15449,"KRN",9.8,"NM","B","LR7OGMC",32)

"BLD",15449,"KRN",9.8,"NM","B","LR7OGMG",33)

"BLD",15449,"KRN",9.8,"NM","B","LR7OGMP",34)

"BLD",15449,"KRN",9.8,"NM","B","LR7OR2",30)

"BLD",15449,"KRN",9.8,"NM","B","LR7OSUM1",35)

"BLD",15449,"KRN",9.8,"NM","B","LR7OSUM6",36)

"BLD",15449,"KRN",9.8,"NM","B","LRAFUNC",49)

"BLD",15449,"KRN",9.8,"NM","B","LRDIDLE0",29)

"BLD",15449,"KRN",9.8,"NM","B","LRDPAREF",10)

"BLD",15449,"KRN",9.8,"NM","B","LRDPAREX",46)

"BLD",15449,"KRN",9.8,"NM","B","LREVENT",47)

"BLD",15449,"KRN",9.8,"NM","B","LRFAST",42)

"BLD",15449,"KRN",9.8,"NM","B","LRFASTS",43)

"BLD",15449,"KRN",9.8,"NM","B","LRGP1",38)

"BLD",15449,"KRN",9.8,"NM","B","LROE",16)

"BLD",15449,"KRN",9.8,"NM","B","LRORD",40)

"BLD",15449,"KRN",9.8,"NM","B","LRORD1",45)

"BLD",15449,"KRN",9.8,"NM","B","LRORDB",41)

"BLD",15449,"KRN",9.8,"NM","B","LROW3",48)

"BLD",15449,"KRN",9.8,"NM","B","LRRP",17)

"BLD",15449,"KRN",9.8,"NM","B","LRRP1",18)

"BLD",15449,"KRN",9.8,"NM","B","LRRPU",19)

"BLD",15449,"KRN",9.8,"NM","B","LRSTUF1",39)

"BLD",15449,"KRN",9.8,"NM","B","LRVER",1)

"BLD",15449,"KRN",9.8,"NM","B","LRVER1",44)

"BLD",15449,"KRN",9.8,"NM","B","LRVER3",15)

"BLD",15449,"KRN",9.8,"NM","B","LRVER4",25)

"BLD",15449,"KRN",9.8,"NM","B","LRVER5",26)

"BLD",15449,"KRN",9.8,"NM","B","LRVERA",27)

"BLD",15449,"KRN",9.8,"NM","B","LRVR",20)

"BLD",15449,"KRN",9.8,"NM","B","LRVR1",21)

"BLD",15449,"KRN",9.8,"NM","B","LRVR3",22)

"BLD",15449,"KRN",9.8,"NM","B","LRVR4",23)

"BLD",15449,"KRN",9.8,"NM","B","LRVR5",24)

"BLD",15449,"KRN",9.8,"NM","B","LRWLST1",8)

"BLD",15449,"KRN",9.8,"NM","B","LRWLST11",28)

"BLD",15449,"KRN",19,0)
19
"BLD",15449,"KRN",19,"NM",0)
^9.68A^33^33
"BLD",15449,"KRN",19,"NM",1,0)
LRENTER^^5^
"BLD",15449,"KRN",19,"NM",2,0)
LRVR^^5^
"BLD",15449,"KRN",19,"NM",3,0)
LRVRW^^5^
"BLD",15449,"KRN",19,"NM",4,0)
LRVRW2^^5^
"BLD",15449,"KRN",19,"NM",5,0)
LRDIEATOMIC^^5^
"BLD",15449,"KRN",19,"NM",6,0)
LRGV^^5^
"BLD",15449,"KRN",19,"NM",7,0)
LRGVP^^5^
"BLD",15449,"KRN",19,"NM",8,0)
LRSTUF^^5^
"BLD",15449,"KRN",19,"NM",9,0)
LRFAST^^5^
"BLD",15449,"KRN",19,"NM",10,0)
LRFASTS^^5^
"BLD",15449,"KRN",19,"NM",11,0)
LR ACC THEN DATA^^5^
"BLD",15449,"KRN",19,"NM",12,0)
LROE^^5^
"BLD",15449,"KRN",19,"NM",13,0)
LRMICROLOGIN^^5^
"BLD",15449,"KRN",19,"NM",14,0)
LRADD TO ACC^^5^
"BLD",15449,"KRN",19,"NM",15,0)
LRADD TO ORDER^^5^
"BLD",15449,"KRN",19,"NM",16,0)
LRCENDEL^^5^
"BLD",15449,"KRN",19,"NM",17,0)
LRTSTOUT^^5^
"BLD",15449,"KRN",19,"NM",18,0)
LROW IMMED COLLECT^^5^
"BLD",15449,"KRN",19,"NM",19,0)
LROW ROUTINE^^5^
"BLD",15449,"KRN",19,"NM",20,0)
LROW SEND PAT^^5^
"BLD",15449,"KRN",19,"NM",21,0)
LROW WARD COL^^5^
"BLD",15449,"KRN",19,"NM",22,0)
LRPHITEM^^5^
"BLD",15449,"KRN",19,"NM",23,0)
LRADDTST^^5^
"BLD",15449,"KRN",19,"NM",24,0)
LROW^^5^
"BLD",15449,"KRN",19,"NM",25,0)
LRQCLOG^^5^
"BLD",15449,"KRN",19,"NM",26,0)
LRACC MERGE^^5^
"BLD",15449,"KRN",19,"NM",27,0)
LRQUICK^^5^
"BLD",15449,"KRN",19,"NM",28,0)
LRPHEXCPT^^5^
"BLD",15449,"KRN",19,"NM",29,0)
LRLEDI^^5^
"BLD",15449,"KRN",19,"NM",30,0)
LRDELOG^^5^
"BLD",15449,"KRN",19,"NM",31,0)
LRNONCOM^^5^
"BLD",15449,"KRN",19,"NM",32,0)
LR USER PARAM^^0
"BLD",15449,"KRN",19,"NM",33,0)
LRHELP^^2
"BLD",15449,"KRN",19,"NM","B","LR ACC THEN DATA",11)

"BLD",15449,"KRN",19,"NM","B","LR USER PARAM",32)

"BLD",15449,"KRN",19,"NM","B","LRACC MERGE",26)

"BLD",15449,"KRN",19,"NM","B","LRADD TO ACC",14)

"BLD",15449,"KRN",19,"NM","B","LRADD TO ORDER",15)

"BLD",15449,"KRN",19,"NM","B","LRADDTST",23)

"BLD",15449,"KRN",19,"NM","B","LRCENDEL",16)

"BLD",15449,"KRN",19,"NM","B","LRDELOG",30)

"BLD",15449,"KRN",19,"NM","B","LRDIEATOMIC",5)

"BLD",15449,"KRN",19,"NM","B","LRENTER",1)

"BLD",15449,"KRN",19,"NM","B","LRFAST",9)

"BLD",15449,"KRN",19,"NM","B","LRFASTS",10)

"BLD",15449,"KRN",19,"NM","B","LRGV",6)

"BLD",15449,"KRN",19,"NM","B","LRGVP",7)

"BLD",15449,"KRN",19,"NM","B","LRHELP",33)

"BLD",15449,"KRN",19,"NM","B","LRLEDI",29)

"BLD",15449,"KRN",19,"NM","B","LRMICROLOGIN",13)

"BLD",15449,"KRN",19,"NM","B","LRNONCOM",31)

"BLD",15449,"KRN",19,"NM","B","LROE",12)

"BLD",15449,"KRN",19,"NM","B","LROW",24)

"BLD",15449,"KRN",19,"NM","B","LROW IMMED COLLECT",18)

"BLD",15449,"KRN",19,"NM","B","LROW ROUTINE",19)

"BLD",15449,"KRN",19,"NM","B","LROW SEND PAT",20)

"BLD",15449,"KRN",19,"NM","B","LROW WARD COL",21)

"BLD",15449,"KRN",19,"NM","B","LRPHEXCPT",28)

"BLD",15449,"KRN",19,"NM","B","LRPHITEM",22)

"BLD",15449,"KRN",19,"NM","B","LRQCLOG",25)

"BLD",15449,"KRN",19,"NM","B","LRQUICK",27)

"BLD",15449,"KRN",19,"NM","B","LRSTUF",8)

"BLD",15449,"KRN",19,"NM","B","LRTSTOUT",17)

"BLD",15449,"KRN",19,"NM","B","LRVR",2)

"BLD",15449,"KRN",19,"NM","B","LRVRW",3)

"BLD",15449,"KRN",19,"NM","B","LRVRW2",4)

"BLD",15449,"KRN",19.1,0)
19.1
"BLD",15449,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",15449,"KRN",101,0)
101
"BLD",15449,"KRN",409.61,0)
409.61
"BLD",15449,"KRN",771,0)
771
"BLD",15449,"KRN",870,0)
870
"BLD",15449,"KRN",8989.51,0)
8989.51
"BLD",15449,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",15449,"KRN",8989.51,"NM",1,0)
LR VER DISPLAY PREV COMMENT^^0
"BLD",15449,"KRN",8989.51,"NM","B","LR VER DISPLAY PREV COMMENT",1)

"BLD",15449,"KRN",8989.52,0)
8989.52
"BLD",15449,"KRN",8989.52,"NM",0)
^9.68A^1^1
"BLD",15449,"KRN",8989.52,"NM",1,0)
LR USER^^0
"BLD",15449,"KRN",8989.52,"NM","B","LR USER",1)

"BLD",15449,"KRN",8994,0)
8994
"BLD",15449,"KRN","B",.4,.4)

"BLD",15449,"KRN","B",.401,.401)

"BLD",15449,"KRN","B",.402,.402)

"BLD",15449,"KRN","B",.403,.403)

"BLD",15449,"KRN","B",.5,.5)

"BLD",15449,"KRN","B",.84,.84)

"BLD",15449,"KRN","B",3.6,3.6)

"BLD",15449,"KRN","B",3.8,3.8)

"BLD",15449,"KRN","B",9.2,9.2)

"BLD",15449,"KRN","B",9.8,9.8)

"BLD",15449,"KRN","B",19,19)

"BLD",15449,"KRN","B",19.1,19.1)

"BLD",15449,"KRN","B",101,101)

"BLD",15449,"KRN","B",409.61,409.61)

"BLD",15449,"KRN","B",771,771)

"BLD",15449,"KRN","B",870,870)

"BLD",15449,"KRN","B",8989.51,8989.51)

"BLD",15449,"KRN","B",8989.52,8989.52)

"BLD",15449,"KRN","B",8994,8994)

"BLD",15449,"PRE")
LR286
"BLD",15449,"QUES",0)
^9.62^^
"BLD",15449,"REQB",0)
^9.611^15^15
"BLD",15449,"REQB",1,0)
LR*5.2*187^2
"BLD",15449,"REQB",2,0)
LR*5.2*202^2
"BLD",15449,"REQB",3,0)
LR*5.2*220^2
"BLD",15449,"REQB",4,0)
LR*5.2*222^2
"BLD",15449,"REQB",5,0)
LR*5.2*230^2
"BLD",15449,"REQB",6,0)
LR*5.2*256^2
"BLD",15449,"REQB",7,0)
LR*5.2*232^2
"BLD",15449,"REQB",8,0)
LR*5.2*271^2
"BLD",15449,"REQB",9,0)
LR*5.2*282^2
"BLD",15449,"REQB",10,0)
LR*5.2*283^2
"BLD",15449,"REQB",11,0)
LR*5.2*261^2
"BLD",15449,"REQB",12,0)
LR*5.2*269^2
"BLD",15449,"REQB",13,0)
LR*5.2*285^2
"BLD",15449,"REQB",14,0)
LR*5.2*287^2
"BLD",15449,"REQB",15,0)
LR*5.2*312^2
"BLD",15449,"REQB","B","LR*5.2*187",1)

"BLD",15449,"REQB","B","LR*5.2*202",2)

"BLD",15449,"REQB","B","LR*5.2*220",3)

"BLD",15449,"REQB","B","LR*5.2*222",4)

"BLD",15449,"REQB","B","LR*5.2*230",5)

"BLD",15449,"REQB","B","LR*5.2*232",7)

"BLD",15449,"REQB","B","LR*5.2*256",6)

"BLD",15449,"REQB","B","LR*5.2*261",11)

"BLD",15449,"REQB","B","LR*5.2*269",12)

"BLD",15449,"REQB","B","LR*5.2*271",8)

"BLD",15449,"REQB","B","LR*5.2*282",9)

"BLD",15449,"REQB","B","LR*5.2*283",10)

"BLD",15449,"REQB","B","LR*5.2*285",13)

"BLD",15449,"REQB","B","LR*5.2*287",14)

"BLD",15449,"REQB","B","LR*5.2*312",15)

"FIA",60)
LABORATORY TEST
"FIA",60,0)
^LAB(60,
"FIA",60,0,0)
60I
"FIA",60,0,1)
y^n^p^^^^n^^n
"FIA",60,0,10)

"FIA",60,0,11)

"FIA",60,0,"RLRO")

"FIA",60,0,"VR")
5.2^LR
"FIA",60,60)
1
"FIA",60,60.01)
1
"FIA",60,60.01,13)

"FIA",61)
TOPOGRAPHY FIELD
"FIA",61,0)
^LAB(61,
"FIA",61,0,0)
61I
"FIA",61,0,1)
y^n^p^^^^n^^n
"FIA",61,0,10)

"FIA",61,0,11)

"FIA",61,0,"RLRO")

"FIA",61,0,"VR")
5.2^LR
"FIA",61,61)
1
"FIA",61,61,.09)

"FIA",68.2)
LOAD/WORK LIST
"FIA",68.2,0)
^LRO(68.2,
"FIA",68.2,0,0)
68.2
"FIA",68.2,0,1)
y^n^p^^^^n^^n
"FIA",68.2,0,10)

"FIA",68.2,0,11)

"FIA",68.2,0,"RLRO")

"FIA",68.2,0,"VR")
5.2^LR
"FIA",68.2,68.2)
1
"FIA",68.2,68.23)
1
"FIA",68.2,68.23,2.3)

"FIA",69.6)
LAB PENDING ORDERS ENTRY
"FIA",69.6,0)
^LRO(69.6,
"FIA",69.6,0,0)
69.6I
"FIA",69.6,0,1)
y^n^f^^^^n
"FIA",69.6,0,10)

"FIA",69.6,0,11)

"FIA",69.6,0,"RLRO")

"FIA",69.6,0,"VR")
5.2^LR
"FIA",69.6,69.6)
0
"FIA",69.6,69.64)
0
"FIA",69.6,69.699)
0
"INI")
PRE^LR286
"INIT")
POST^LR286
"KRN",.402,112,-1)
0^1
"KRN",.402,112,0)
LR ATOMIC TESTS^3030512.1142^^60^^^3041027
"KRN",.402,112,"DIAB",1,1,60.1,0)
ALL
"KRN",.402,112,"DIAB",1,1,60.12,0)
ALL
"KRN",.402,112,"DIAB",1,1,60.13,0)
ALL
"KRN",.402,112,"DR",1,60)
.01;2;3;4;400;100;500.1;500;
"KRN",.402,112,"DR",2,60.01)
.01:9;13;
"KRN",.402,112,"DR",2,60.1)
.01
"KRN",.402,112,"DR",2,60.12)
.01:3
"KRN",.402,112,"DR",2,60.13)
.01;2
"KRN",.402,112,"DR",3,60.07)
.01
"KRN",.402,127,-1)
0^2
"KRN",.402,127,0)
LRLLDFT^3030812.1133^^68.2^^^3041015
"KRN",.402,127,"DR",1,68.2)
.02;.03;.04;.05;.06;.07;.08;.09;.1;.11;.14;50;
"KRN",.402,127,"DR",2,68.23)
2;2.1;2.2;2.3;
"KRN",19,599,-1)
5^27
"KRN",19,599,0)
LRQUICK
"KRN",19,600,-1)
5^1
"KRN",19,600,0)
LRENTER
"KRN",19,606,-1)
5^7
"KRN",19,606,0)
LRGVP
"KRN",19,611,-1)
5^9
"KRN",19,611,0)
LRFAST
"KRN",19,614,-1)
5^12
"KRN",19,614,0)
LROE
"KRN",19,615,-1)
5^24
"KRN",19,615,0)
LROW
"KRN",19,620,-1)
5^25
"KRN",19,620,0)
LRQCLOG
"KRN",19,621,-1)
5^17
"KRN",19,621,0)
LRTSTOUT
"KRN",19,622,-1)
5^30
"KRN",19,622,0)
LRDELOG
"KRN",19,650,-1)
5^28
"KRN",19,650,0)
LRPHEXCPT
"KRN",19,651,-1)
5^31
"KRN",19,651,0)
LRNONCOM
"KRN",19,661,-1)
5^6
"KRN",19,661,0)
LRGV
"KRN",19,664,-1)
5^2
"KRN",19,664,0)
LRVR
"KRN",19,672,-1)
5^23
"KRN",19,672,0)
LRADDTST
"KRN",19,673,-1)
5^16
"KRN",19,673,0)
LRCENDEL
"KRN",19,684,-1)
5^8
"KRN",19,684,0)
LRSTUF
"KRN",19,692,-1)
5^19
"KRN",19,692,0)
LROW ROUTINE
"KRN",19,693,-1)
5^5
"KRN",19,693,0)
LRDIEATOMIC
"KRN",19,717,-1)
5^14
"KRN",19,717,0)
LRADD TO ACC
"KRN",19,718,-1)
5^15
"KRN",19,718,0)
LRADD TO ORDER
"KRN",19,724,-1)
5^13
"KRN",19,724,0)
LRMICROLOGIN
"KRN",19,727,-1)
5^3
"KRN",19,727,0)
LRVRW
"KRN",19,728,-1)
5^4
"KRN",19,728,0)
LRVRW2
"KRN",19,733,-1)
2^33
"KRN",19,733,0)
LRHELP^Information-help menu^^M^.5^^^^^^^26
"KRN",19,733,10,0)
^19.01IP^7^7
"KRN",19,733,10,7,0)
2067643518^PP
"KRN",19,733,10,7,"^")
LR USER PARAM
"KRN",19,733,"U")
INFORMATION-HELP MENU
"KRN",19,744,-1)
5^20
"KRN",19,744,0)
LROW SEND PAT
"KRN",19,785,-1)
5^22
"KRN",19,785,0)
LRPHITEM
"KRN",19,794,-1)
5^21
"KRN",19,794,0)
LROW WARD COL
"KRN",19,1041,-1)
5^11
"KRN",19,1041,0)
LR ACC THEN DATA
"KRN",19,8003,-1)
5^10
"KRN",19,8003,0)
LRFASTS
"KRN",19,8009,-1)
5^18
"KRN",19,8009,0)
LROW IMMED COLLECT
"KRN",19,10686,-1)
5^26
"KRN",19,10686,0)
LRACC MERGE
"KRN",19,11548,-1)
5^29
"KRN",19,11548,0)
LRLEDI
"KRN",19,2067643518,-1)
0^32
"KRN",19,2067643518,0)
LR USER PARAM^General Lab User Parameters^^A^^^^^^^^LAB SERVICE^^1
"KRN",19,2067643518,1,0)
^19.06^2^2^3040706^^^^
"KRN",19,2067643518,1,1,0)
This option allows a user to modify various user selectable parameters
"KRN",19,2067643518,1,2,0)
used with the laboratory package.
"KRN",19,2067643518,20)
D TED^XPAREDIT("LR USER","B",DUZ_";VA(200,")
"KRN",19,2067643518,"U")
GENERAL LAB USER PARAMETERS
"KRN",8989.51,330,-1)
0^1
"KRN",8989.51,330,0)
LR VER DISPLAY PREV COMMENT^Display previous comments for test^1^Laboratory Test^Display previous result's comments^0
"KRN",8989.51,330,1)
Y^^Answer with yes/no to display previous result's comments during verification.
"KRN",8989.51,330,6)
P^60
"KRN",8989.51,330,8)
I $P(^(0),"^",4)="CH"
"KRN",8989.51,330,20,0)
^8989.512^2^2^3040707^^^^
"KRN",8989.51,330,20,1,0)
Select whether the user wants comments associated with previous results to
"KRN",8989.51,330,20,2,0)
display with those results during lab verification process.
"KRN",8989.51,330,30,0)
^8989.513I^1^1
"KRN",8989.51,330,30,1,0)
1^200
"KRN",8989.52,103,-1)
0^1
"KRN",8989.52,103,0)
LR USER^Lab User Level Parameters^200
"KRN",8989.52,103,10,0)
^8989.521IA^1^1
"KRN",8989.52,103,10,1,0)
100^LR VER DISPLAY PREV COMMENT
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"ORD",21,8989.52)
8989.52;21;1;;PAR2E1^XPDTA2;PAR2F1^XPDIA3;PAR2E1^XPDIA3;PAR2F2^XPDIA3;;PAR2DEL^XPDIA3(%)
"ORD",21,8989.52,0)
PARAMETER TEMPLATE
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2941128
"PKG",26,22,1,"PAH",1,0)
286^3041112^235
"PKG",26,22,1,"PAH",1,1,0)
^^427^427^3041112
"PKG",26,22,1,"PAH",1,1,1,0)
VISTA Laboratory Package patch LR*5.2*286 contains changes to software
"PKG",26,22,1,"PAH",1,1,2,0)
controlled by VHA DIRECTIVE 99-053, titled VISTA BLOOD BANK SOFTWARE
"PKG",26,22,1,"PAH",1,1,3,0)
VERSION 5.2.  Change includes:
"PKG",26,22,1,"PAH",1,1,4,0)
   The addition of the "USE FOR REFERENCE TESTING" field (#13) to the
"PKG",26,22,1,"PAH",1,1,5,0)
   "SITE/SPECIMEN SUB-FIELD" (#60.01) of the LABORATORY TEST file (#60).
"PKG",26,22,1,"PAH",1,1,6,0)
   The addition of the "USE FOR REFERENCE TESTING" field to the "LR ATOMIC
"PKG",26,22,1,"PAH",1,1,7,0)
    TESTS" Input Template.
"PKG",26,22,1,"PAH",1,1,8,0)

"PKG",26,22,1,"PAH",1,1,9,0)
The above change has been reviewed by the VISTA Blood Bank Developer and
"PKG",26,22,1,"PAH",1,1,10,0)
found to have no impact on the VISTA BLOOD BANK SOFTWARE version 5.2
"PKG",26,22,1,"PAH",1,1,11,0)
control functions.
"PKG",26,22,1,"PAH",1,1,12,0)

"PKG",26,22,1,"PAH",1,1,13,0)
RISK ANALYSIS:   Changes made by patch LR*5.2*286 have no effect on Blood
"PKG",26,22,1,"PAH",1,1,14,0)
Bank software functionality, therefore RISK is none.
"PKG",26,22,1,"PAH",1,1,15,0)

"PKG",26,22,1,"PAH",1,1,16,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS:  Patch LR*5.2*286 does not
"PKG",26,22,1,"PAH",1,1,17,0)
alter or modify any software design safeguards or safety critical elements
"PKG",26,22,1,"PAH",1,1,18,0)
functions.
"PKG",26,22,1,"PAH",1,1,19,0)

"PKG",26,22,1,"PAH",1,1,20,0)
POTENTIAL IMPACT ON SITES:  This patch contains changes to a Data
"PKG",26,22,1,"PAH",1,1,21,0)
Dictionary identified in Veterans Health Administration (VHA) Directive
"PKG",26,22,1,"PAH",1,1,22,0)
99-053. The changes have no effect in Blood Bank functionality or medical
"PKG",26,22,1,"PAH",1,1,23,0)
device control functions. There is no adverse potential to sites.
"PKG",26,22,1,"PAH",1,1,24,0)
 
"PKG",26,22,1,"PAH",1,1,25,0)
VALIDATION REQUIREMENTS BY OPTION:  There are no required validation
"PKG",26,22,1,"PAH",1,1,26,0)
scenarios to be completed by sites after installing LR*5.2*286.
"PKG",26,22,1,"PAH",1,1,27,0)
  
"PKG",26,22,1,"PAH",1,1,28,0)
========================================
"PKG",26,22,1,"PAH",1,1,29,0)
 
"PKG",26,22,1,"PAH",1,1,30,0)
Patch LR*5.2*286 VA/DOD LAB INTEROPERABILITY will be distributed and
"PKG",26,22,1,"PAH",1,1,31,0)
installed with patch LA*5.2*64 VA/DOD LAB INTEROPERABILITY
"PKG",26,22,1,"PAH",1,1,32,0)
 
"PKG",26,22,1,"PAH",1,1,33,0)
This patch adds support for sending/receiving Laboratory Electronic
"PKG",26,22,1,"PAH",1,1,34,0)
Data Interchange (LEDI) orders/results with Department of Defense (DoD)
"PKG",26,22,1,"PAH",1,1,35,0)
facilities.
"PKG",26,22,1,"PAH",1,1,36,0)
 
"PKG",26,22,1,"PAH",1,1,37,0)
Laboratory result verification has been enhanced to allow the designation
"PKG",26,22,1,"PAH",1,1,38,0)
of a performing laboratory and the use of the performing laboratory's
"PKG",26,22,1,"PAH",1,1,39,0)
units, normals, and normalcy status in results reporting.
"PKG",26,22,1,"PAH",1,1,40,0)

"PKG",26,22,1,"PAH",1,1,41,0)
1. User during the verification process is able to specify the performing
"PKG",26,22,1,"PAH",1,1,42,0)
laboratory. The performing laboratory is selected from the list of
"PKG",26,22,1,"PAH",1,1,43,0)
available entries in the site's INSTITUTION file (#4). The selection of
"PKG",26,22,1,"PAH",1,1,44,0)
entries is screened as follows:
"PKG",26,22,1,"PAH",1,1,45,0)
   a. User can select the division they are logged on.
"PKG",26,22,1,"PAH",1,1,46,0)
   b. User can select an institution that is configured in the LAB
"PKG",26,22,1,"PAH",1,1,47,0)
      SHIPPING CONFIGURATION file (#62.9) as a host facility with their
"PKG",26,22,1,"PAH",1,1,48,0)
      division as the collecting facility.
"PKG",26,22,1,"PAH",1,1,49,0)
 
"PKG",26,22,1,"PAH",1,1,50,0)
2. During acceptance and verification of results received from a reference
"PKG",26,22,1,"PAH",1,1,51,0)
laboratory via an HL7 interface (LEDI), the performing laboratory, results,
"PKG",26,22,1,"PAH",1,1,52,0)
units, normals and normalcy status contained in the HL7 message are stored
"PKG",26,22,1,"PAH",1,1,53,0)
"as is".
"PKG",26,22,1,"PAH",1,1,54,0)

"PKG",26,22,1,"PAH",1,1,55,0)
3. Receipt of amended reports from a reference laboratory will generate a
"PKG",26,22,1,"PAH",1,1,56,0)
MailMan bulletin containing the particulars of the amended report. This
"PKG",26,22,1,"PAH",1,1,57,0)
bulletin is sent to the members of the mail group specified for
"PKG",26,22,1,"PAH",1,1,58,0)
"New Result" alerts in LA7 MESSAGE PARAMETER file (#62.48) for the interface.
"PKG",26,22,1,"PAH",1,1,59,0)
 
"PKG",26,22,1,"PAH",1,1,60,0)
4. Amended reports received via a LEDI HL7 interface can be processed
"PKG",26,22,1,"PAH",1,1,61,0)
via the Enter/verify/modify data (manual) option [LRENTER].
"PKG",26,22,1,"PAH",1,1,62,0)
 
"PKG",26,22,1,"PAH",1,1,63,0)
5. Users using the Enter/verify/modify data (manual) option [LRENTER] to
"PKG",26,22,1,"PAH",1,1,64,0)
enter results manually from a reference laboratory can use the units and
"PKG",26,22,1,"PAH",1,1,65,0)
normals specified in LABORATORY TEST file (#60) by configuring USE FOR
"PKG",26,22,1,"PAH",1,1,66,0)
REFERENCE TESTING field (#13) within the SITE/SPECIMEN subfile (#100).
"PKG",26,22,1,"PAH",1,1,67,0)
If this field is not enabled for reference laboratory result data entry,
"PKG",26,22,1,"PAH",1,1,68,0)
then the user is prompted for units, normals, high and low reference ranges
"PKG",26,22,1,"PAH",1,1,69,0)
to store with the results. The Edit atomic tests option [LRDIEATOMIC]
"PKG",26,22,1,"PAH",1,1,70,0)
allows Labortory Information Manager (LIM) to designate this functionality
"PKG",26,22,1,"PAH",1,1,71,0)
for affected tests.
"PKG",26,22,1,"PAH",1,1,72,0)
 
"PKG",26,22,1,"PAH",1,1,73,0)
6. NOIS DEN-1299-52099, NYH-0700-11942, PHI-0803-21507, TAM-0400-31033, and
"PKG",26,22,1,"PAH",1,1,74,0)
WPB-0900-32221 reported the defect of normalcy status (low/high/critical
"PKG",26,22,1,"PAH",1,1,75,0)
low/critical high) being incorrectly evaluated when the test result is
"PKG",26,22,1,"PAH",1,1,76,0)
zero (0). Evaluation of normalcy status will properly deal with test
"PKG",26,22,1,"PAH",1,1,77,0)
results of zero (0).
"PKG",26,22,1,"PAH",1,1,78,0)
 
"PKG",26,22,1,"PAH",1,1,79,0)
7. Changing normalcy status and units will trigger the generation of audit
"PKG",26,22,1,"PAH",1,1,80,0)
trail comments.
"PKG",26,22,1,"PAH",1,1,81,0)
 
"PKG",26,22,1,"PAH",1,1,82,0)
8. During verification, the ordering provider's phone and pager information
"PKG",26,22,1,"PAH",1,1,83,0)
is displayed.
"PKG",26,22,1,"PAH",1,1,84,0)
 
"PKG",26,22,1,"PAH",1,1,85,0)
9. Display of lab results in the Computerized Patient Record System
"PKG",26,22,1,"PAH",1,1,86,0)
Graphical User Interface (CPRS GUI) and Laboratory Interim Reports has
"PKG",26,22,1,"PAH",1,1,87,0)
been modified to display units and normals associated with results at time
"PKG",26,22,1,"PAH",1,1,88,0)
of verification. Results that are derived from a Set of Codes will be
"PKG",26,22,1,"PAH",1,1,89,0)
reported using the external form of the code.
"PKG",26,22,1,"PAH",1,1,90,0)
 
"PKG",26,22,1,"PAH",1,1,91,0)
10. Display of performing laboratory has been added to CPRS GUI display of
"PKG",26,22,1,"PAH",1,1,92,0)
results.
"PKG",26,22,1,"PAH",1,1,93,0)

"PKG",26,22,1,"PAH",1,1,94,0)
11. NOIS DAY-0303-40775 reported a defect in display of lab results with
"PKG",26,22,1,"PAH",1,1,95,0)
embedded spaces. When lab results contained embedded spaces these spaces
"PKG",26,22,1,"PAH",1,1,96,0)
were being removed prior to the display of the lab result. The removal of
"PKG",26,22,1,"PAH",1,1,97,0)
theses spaces resulted in corruption of the result. Routines LR7OB63 and
"PKG",26,22,1,"PAH",1,1,98,0)
LR7OR2 have been corrected to trim leading and trailing spaces but leave
"PKG",26,22,1,"PAH",1,1,99,0)
embedded spaces.
"PKG",26,22,1,"PAH",1,1,100,0)
 
"PKG",26,22,1,"PAH",1,1,101,0)
12. Enter/verify data (auto instrument) [LRVR] and Enter/verify/modify
"PKG",26,22,1,"PAH",1,1,102,0)
data (manual) [LRENTER] options will display patient information from
"PKG",26,22,1,"PAH",1,1,103,0)
PAT. INFO. field (#.091) in LAB DATA file (#63) during result verification.
"PKG",26,22,1,"PAH",1,1,104,0)
(E3R #13408)
"PKG",26,22,1,"PAH",1,1,105,0)
 
"PKG",26,22,1,"PAH",1,1,106,0)
13. Alignment of test results during verification process has been adjusted
"PKG",26,22,1,"PAH",1,1,107,0)
to avoid display of previous and current test results together. Results
"PKG",26,22,1,"PAH",1,1,108,0)
will be displayed right-justified under the date/time of each specimen.  
"PKG",26,22,1,"PAH",1,1,109,0)
  
"PKG",26,22,1,"PAH",1,1,110,0)
14. NOIS ALB-0100-50284, FAV-1103-70892 reported a failure of UID creation
"PKG",26,22,1,"PAH",1,1,111,0)
and storage when creating a non-daily accession that is in common with
"PKG",26,22,1,"PAH",1,1,112,0)
another accession area. The failure occurs on the creation of the first
"PKG",26,22,1,"PAH",1,1,113,0)
accession for a given accession area and date. After the first accession
"PKG",26,22,1,"PAH",1,1,114,0)
for an accession date is created and stored in ACCESSION file (#68)
"PKG",26,22,1,"PAH",1,1,115,0)
subsequent accessions have the UID stored properly. Failure was due to
"PKG",26,22,1,"PAH",1,1,116,0)
missing subfile zeroth nodes for the ACCESSION DATE multiple (#68.01) and
"PKG",26,22,1,"PAH",1,1,117,0)
ACCESSION NUMBER multiple (#68.02) of the ACCESSION file (#68) when calling
"PKG",26,22,1,"PAH",1,1,118,0)
FileMan to store the UID. Routine LRWLST1 will now check and set the
"PKG",26,22,1,"PAH",1,1,119,0)
subfile's zeroth nodes before calling FileMan.
"PKG",26,22,1,"PAH",1,1,120,0)
 
"PKG",26,22,1,"PAH",1,1,121,0)
  FileMan calls have been converted from classic FileMan DIE calls to
"PKG",26,22,1,"PAH",1,1,122,0)
FileMan Database Server calls (DBS). When an error condition is
"PKG",26,22,1,"PAH",1,1,123,0)
encountered during a FileMan DBS call, the Laboratory package will
"PKG",26,22,1,"PAH",1,1,124,0)
generate a mail message with the subject "FileMan DBS call failed during
"PKG",26,22,1,"PAH",1,1,125,0)
accessioning in routine LRWLST1". This message will be sent to the local
"PKG",26,22,1,"PAH",1,1,126,0)
mail group "LMI". It will contain debugging information to assist site
"PKG",26,22,1,"PAH",1,1,127,0)
and National VistA Support in resolving the condition that produced the
"PKG",26,22,1,"PAH",1,1,128,0)
error.
"PKG",26,22,1,"PAH",1,1,129,0)
  
"PKG",26,22,1,"PAH",1,1,130,0)
15. NOIS BON-0196-71728 reported a problem with storing the appropriate
"PKG",26,22,1,"PAH",1,1,131,0)
treating specialty associated with an accession. A bad or incorrect
"PKG",26,22,1,"PAH",1,1,132,0)
pointer to FACILITY TREATING SPECIALTY file (#45.7) could be stored in
"PKG",26,22,1,"PAH",1,1,133,0)
the TREATING SPECIALTY (#6.6) field within the ACCESSION NUMBER field
"PKG",26,22,1,"PAH",1,1,134,0)
(#68.02) multiple within the ACCESSION DATE field (#68.01) multiple of
"PKG",26,22,1,"PAH",1,1,135,0)
the ACCESSION file (#68). When a specimen is accessioned for a
"PKG",26,22,1,"PAH",1,1,136,0)
non-inpatient and the user selects an inpatient ordering location the
"PKG",26,22,1,"PAH",1,1,137,0)
software would use the specialty from SPECIALITY file (#42.4) that
"PKG",26,22,1,"PAH",1,1,138,0)
is associated with the WARD LOCATION file (#42) entry linked to the
"PKG",26,22,1,"PAH",1,1,139,0)
HOSPITAL LOCATION file (#44).
"PKG",26,22,1,"PAH",1,1,140,0)
 
"PKG",26,22,1,"PAH",1,1,141,0)
   Routine LRWLST1 will determine treating specialty based on the
"PKG",26,22,1,"PAH",1,1,142,0)
associated TREATING SPECIALTY field (#9.5) in the HOSPITAL LOCATION file
"PKG",26,22,1,"PAH",1,1,143,0)
(#44) when the patient is not an inpatient. When a patient is an inpatient
"PKG",26,22,1,"PAH",1,1,144,0)
then treating specialty will be determined from the PATIENT file (#2),
"PKG",26,22,1,"PAH",1,1,145,0)
TREATING SPECIALTY field (.103). Treating specialty will only be stored
"PKG",26,22,1,"PAH",1,1,146,0)
in ACCESSION file (#68) when the patient is from PATIENT file (#2).
"PKG",26,22,1,"PAH",1,1,147,0)
 
"PKG",26,22,1,"PAH",1,1,148,0)
16. The following defects were identified during the software review as
"PKG",26,22,1,"PAH",1,1,149,0)
part of patch development.
"PKG",26,22,1,"PAH",1,1,150,0)
 
"PKG",26,22,1,"PAH",1,1,151,0)
  a. Ordering location and ordering provider will not be stored on
"PKG",26,22,1,"PAH",1,1,152,0)
accessions that are related to LAB CONTROL NAME file (#62.3) entries.
"PKG",26,22,1,"PAH",1,1,153,0)
 
"PKG",26,22,1,"PAH",1,1,154,0)
  b. During accessioning if accession area is locked by another process,
"PKG",26,22,1,"PAH",1,1,155,0)
the message displayed to user was "Accession area is locked by another
"PKG",26,22,1,"PAH",1,1,156,0)
user." Message will now include the name of the accession area that
"PKG",26,22,1,"PAH",1,1,157,0)
the software is waiting on lock.
"PKG",26,22,1,"PAH",1,1,158,0)

"PKG",26,22,1,"PAH",1,1,159,0)
  c. Interim report options and displays will display month portion of
"PKG",26,22,1,"PAH",1,1,160,0)
date/times using the three letter abbreviation instead of the two number
"PKG",26,22,1,"PAH",1,1,161,0)
designation to eliminate potential confusion with day portion of dates.
"PKG",26,22,1,"PAH",1,1,162,0)
Time is displayed using 24 hour time format.
"PKG",26,22,1,"PAH",1,1,163,0)
 
"PKG",26,22,1,"PAH",1,1,164,0)
  d. Interim report could display the wrong ordering and collecting site
"PKG",26,22,1,"PAH",1,1,165,0)
when the specimen was received from an integrated facility. Report will
"PKG",26,22,1,"PAH",1,1,166,0)
display the correct ordering and collecting site.
"PKG",26,22,1,"PAH",1,1,167,0)
 
"PKG",26,22,1,"PAH",1,1,168,0)
  e. Referral Patient Multi-purpose Accession option [LR LEDI] was
"PKG",26,22,1,"PAH",1,1,169,0)
prompting the user for CPRS Nature of Order which is not used during
"PKG",26,22,1,"PAH",1,1,170,0)
accessioning of non-PATIENT file (#2) patients. Routine LROW3 is
"PKG",26,22,1,"PAH",1,1,171,0)
modified to only prompt the user for CPRS Nature of Order when
"PKG",26,22,1,"PAH",1,1,172,0)
accessioning a patient from the PATIENT file (#2).
"PKG",26,22,1,"PAH",1,1,173,0)
  
"PKG",26,22,1,"PAH",1,1,174,0)
  f. Previous test versions of previous LEDI versions may have installed 
"PKG",26,22,1,"PAH",1,1,175,0)
two versions of the "D" cross reference in LAB PENDING ORDERS ENTRY file
"PKG",26,22,1,"PAH",1,1,176,0)
(#69.6). The post-install will delete and reindex the "D" cross reference
"PKG",26,22,1,"PAH",1,1,177,0)
on file #69.6.
"PKG",26,22,1,"PAH",1,1,178,0)
 
"PKG",26,22,1,"PAH",1,1,179,0)
  g. Entering of accession number during lab results verification will 
"PKG",26,22,1,"PAH",1,1,180,0)
check for invalid values or numbers out of range (1-999999).
"PKG",26,22,1,"PAH",1,1,181,0)
  
"PKG",26,22,1,"PAH",1,1,182,0)
17. Referral Patient Multi-purpose Accession option [LR LEDI] will check
"PKG",26,22,1,"PAH",1,1,183,0)
for pending orders when performing accessioning without a bar code scanner.
"PKG",26,22,1,"PAH",1,1,184,0)
It will display to the user and store order comments that accompanies
"PKG",26,22,1,"PAH",1,1,185,0)
electronic orders with order in LAB ORDER ENTRY file (#69).
"PKG",26,22,1,"PAH",1,1,186,0)
 
"PKG",26,22,1,"PAH",1,1,187,0)
18. When using the Enter/verify/modify data (manual) option [LRENTER] to
"PKG",26,22,1,"PAH",1,1,188,0)
amend previously released results user can now enter their verifying
"PKG",26,22,1,"PAH",1,1,189,0)
initials in mixed case. 
"PKG",26,22,1,"PAH",1,1,190,0)
 
"PKG",26,22,1,"PAH",1,1,191,0)
19. NOIS CHS-0303-40534 reported a defect which prevented results for
"PKG",26,22,1,"PAH",1,1,192,0)
reflex tests added to a LEDI order at the host laboratory being returned
"PKG",26,22,1,"PAH",1,1,193,0)
electronically to the collecting laboratory. Routine LRWLST11 was storing
"PKG",26,22,1,"PAH",1,1,194,0)
the collecting site as both the collecting site and ordering site in the
"PKG",26,22,1,"PAH",1,1,195,0)
order created in LAB ORDER ENTRY file (#69). When a collecting site is a
"PKG",26,22,1,"PAH",1,1,196,0)
member of an integrated facility the collecting site is the site collecting
"PKG",26,22,1,"PAH",1,1,197,0)
the specimen and the ordering site is the primary facility of the
"PKG",26,22,1,"PAH",1,1,198,0)
integrated institution. Reflex test added by the host site would have the
"PKG",26,22,1,"PAH",1,1,199,0)
incorrect ordering site assigned which prevents the LEDI software from
"PKG",26,22,1,"PAH",1,1,200,0)
returning the results of the reflex test to the collecting facility. Defect
"PKG",26,22,1,"PAH",1,1,201,0)
has been corrected to store the correct ordering and collecting sites on
"PKG",26,22,1,"PAH",1,1,202,0)
LEDI accessions.
"PKG",26,22,1,"PAH",1,1,203,0)
 
"PKG",26,22,1,"PAH",1,1,204,0)
20. NOIS BRK-0499-10720, MAR-0603-21152 reported a defect during lab
"PKG",26,22,1,"PAH",1,1,205,0)
result verification using option Enter/verify/modify data (manual)
"PKG",26,22,1,"PAH",1,1,206,0)
[LRENTER] which caused the previous patient demographics to be displayed
"PKG",26,22,1,"PAH",1,1,207,0)
when entering results on an accession. If the previous selected accession
"PKG",26,22,1,"PAH",1,1,208,0)
was in an uncollected state, the option was skipping the uncollected
"PKG",26,22,1,"PAH",1,1,209,0)
accession and incrementing the default accession number to the next
"PKG",26,22,1,"PAH",1,1,210,0)
available accession. If the user selects this or another accession, the
"PKG",26,22,1,"PAH",1,1,211,0)
patient demographics of the selected accession were not being displayed.
"PKG",26,22,1,"PAH",1,1,212,0)
Instead, the patient demographics of the uncollected accession were
"PKG",26,22,1,"PAH",1,1,213,0)
displayed. Routine LRVER will now display the patient demographics of the
"PKG",26,22,1,"PAH",1,1,214,0)
currently selected accession.
"PKG",26,22,1,"PAH",1,1,215,0)

"PKG",26,22,1,"PAH",1,1,216,0)
21. NOIS SFC-1103-60132 reported a defect during display of lab results
"PKG",26,22,1,"PAH",1,1,217,0)
in the CPRS GUI. When a critical flag becomes part of the data for a
"PKG",26,22,1,"PAH",1,1,218,0)
patient in CPRS, the line of data containing the flag becomes split
"PKG",26,22,1,"PAH",1,1,219,0)
after the * following the high or low flag, and the units along with
"PKG",26,22,1,"PAH",1,1,220,0)
the reference range gets bumped to the next line down. Routine LR7OGMP
"PKG",26,22,1,"PAH",1,1,221,0)
increases the space allocated to display this information from 37 to 38
"PKG",26,22,1,"PAH",1,1,222,0)
characters to display units/normals on same line.
"PKG",26,22,1,"PAH",1,1,223,0)
 
"PKG",26,22,1,"PAH",1,1,224,0)
22. When displaying results that are a Set of Codes data type, the result
"PKG",26,22,1,"PAH",1,1,225,0)
will be displayed using the external value for the set of codes.
"PKG",26,22,1,"PAH",1,1,226,0)
 
"PKG",26,22,1,"PAH",1,1,227,0)
23. NOIS NYH-0700-11942 reported a defect with critical value flag not
"PKG",26,22,1,"PAH",1,1,228,0)
being triggered when entering a value of 0. Value of 0 will be evaluated
"PKG",26,22,1,"PAH",1,1,229,0)
when performing high/low/critical value checks.
"PKG",26,22,1,"PAH",1,1,230,0)
 
"PKG",26,22,1,"PAH",1,1,231,0)
24. When verifying results from a reference laboratory using Enter/verify
"PKG",26,22,1,"PAH",1,1,232,0)
data (auto instrument) option [LRVR], any test results that have not
"PKG",26,22,1,"PAH",1,1,233,0)
been verified will be displayed to the user after verification. The display
"PKG",26,22,1,"PAH",1,1,234,0)
will list the test names, results, abnormal flags and units if available. 
"PKG",26,22,1,"PAH",1,1,235,0)
This display will list the test(s) as not reviewed. This may indicate that
"PKG",26,22,1,"PAH",1,1,236,0)
additional or reflex testing has been added by the reference laboratory.
"PKG",26,22,1,"PAH",1,1,237,0)
These additional tests may need to be added to the accession to process
"PKG",26,22,1,"PAH",1,1,238,0)
these results.
"PKG",26,22,1,"PAH",1,1,239,0)
 
"PKG",26,22,1,"PAH",1,1,240,0)
25. During verification of laboratory results, comments for a previous
"PKG",26,22,1,"PAH",1,1,241,0)
result are displayed along with the previous result when entering
"PKG",26,22,1,"PAH",1,1,242,0)
results manually or by automated instrument for user selected tests
"PKG",26,22,1,"PAH",1,1,243,0)
(E3R #18490). Users can indicate which tests should have previous
"PKG",26,22,1,"PAH",1,1,244,0)
test comments displayed during verification by flagging the test using
"PKG",26,22,1,"PAH",1,1,245,0)
General Lab User Parameters option [LR USER PARAM] located on the
"PKG",26,22,1,"PAH",1,1,246,0)
Information-help menu [LRHELP].
"PKG",26,22,1,"PAH",1,1,247,0)

"PKG",26,22,1,"PAH",1,1,248,0)
26. NOIS SDC-0904-61304  Reported a defect with the display of text
"PKG",26,22,1,"PAH",1,1,249,0)
results in CPRS when using the Laboratory Results-All Test By Date and
"PKG",26,22,1,"PAH",1,1,250,0)
Laboratory Results-Selected Tests By Date. When a text result was
"PKG",26,22,1,"PAH",1,1,251,0)
displayed that exceeded 10 characters and the test has no units or
"PKG",26,22,1,"PAH",1,1,252,0)
normals specified, the display of the result was corrupted with <spaces>
"PKG",26,22,1,"PAH",1,1,253,0)
inserted into the text. Test results will be displayed without corruption.
"PKG",26,22,1,"PAH",1,1,254,0)
Units, reference ranges, and site codes will be displayed on the following
"PKG",26,22,1,"PAH",1,1,255,0)
line when test results print in area usually reserved for these parameters.
"PKG",26,22,1,"PAH",1,1,256,0)
 
"PKG",26,22,1,"PAH",1,1,257,0)
27. NOIS IND-0498-42538 reported a defect in display of test comments during
"PKG",26,22,1,"PAH",1,1,258,0)
lab test result verification when encountering an 'end-of-page' condition.
"PKG",26,22,1,"PAH",1,1,259,0)
All test comments will now be displayed.
"PKG",26,22,1,"PAH",1,1,260,0)
 
"PKG",26,22,1,"PAH",1,1,261,0)

"PKG",26,22,1,"PAH",1,1,262,0)
 PATIENT SAFETY ISSUES RESOLVED IN THIS PATCH:
"PKG",26,22,1,"PAH",1,1,263,0)
 ============================================
"PKG",26,22,1,"PAH",1,1,264,0)
 
"PKG",26,22,1,"PAH",1,1,265,0)
 PSI-040260/NOIS HVH-0604-10572 - "Not Performed test Resulted
"PKG",26,22,1,"PAH",1,1,266,0)
 - No Alert Generated"
"PKG",26,22,1,"PAH",1,1,267,0)
  
"PKG",26,22,1,"PAH",1,1,268,0)
This patch corrects defects in software used to set laboratory tests
"PKG",26,22,1,"PAH",1,1,269,0)
to a Not-Performed (NP) state. The NP state was introduced by patch
"PKG",26,22,1,"PAH",1,1,270,0)
LR*5.2*221 in 1999.  The functionality introduced by this patch replaced
"PKG",26,22,1,"PAH",1,1,271,0)
the "delete-a-test" functionality. Instead of deleting tests, tests are
"PKG",26,22,1,"PAH",1,1,272,0)
now set to a not-performed state.
"PKG",26,22,1,"PAH",1,1,273,0)
 
"PKG",26,22,1,"PAH",1,1,274,0)
However, tests in the NP state could still be edited such that the NP
"PKG",26,22,1,"PAH",1,1,275,0)
state is replaced with an actual result. Results entered into NP tests
"PKG",26,22,1,"PAH",1,1,276,0)
were not treated in the same manner as results entered through the normal
"PKG",26,22,1,"PAH",1,1,277,0)
results entry pathways. File updates to ACCESSION file (#68), LAB ORDER
"PKG",26,22,1,"PAH",1,1,278,0)
ENTRY file (#69), and ORDER file (#100) as well as alerts were not
"PKG",26,22,1,"PAH",1,1,279,0)
generated. This situation was documented in NOIS HVH-0604-10572
"PKG",26,22,1,"PAH",1,1,280,0)
- "Not Performed test Resulted - No Alert Generated". This was identified
"PKG",26,22,1,"PAH",1,1,281,0)
as a potential patient safety risk. With concurrence from the Pathology
"PKG",26,22,1,"PAH",1,1,282,0)
& Laboratory Medicine Program Office, the appropriate mechanism for
"PKG",26,22,1,"PAH",1,1,283,0)
handling the situation is to disable editing of NP tests. If the test is
"PKG",26,22,1,"PAH",1,1,284,0)
designated as NP and the user wants to edit the test result, they will
"PKG",26,22,1,"PAH",1,1,285,0)
now have to order the test(s) in a new accession.
"PKG",26,22,1,"PAH",1,1,286,0)
 
"PKG",26,22,1,"PAH",1,1,287,0)
  
"PKG",26,22,1,"PAH",1,1,288,0)
ASSOCIATED E3R
"PKG",26,22,1,"PAH",1,1,289,0)
--------------
"PKG",26,22,1,"PAH",1,1,290,0)
 E3R #13408, ADDING INFECTION WARNING TO PROCESS DATA OPTIONS
"PKG",26,22,1,"PAH",1,1,291,0)
 E3R #16060, CORRECT ALIGNMENT PROBLEM
"PKG",26,22,1,"PAH",1,1,292,0)
 E3R #17904, LEDI BETWEEN VA AND DOD SITES
"PKG",26,22,1,"PAH",1,1,293,0)
 E3R #18490, COMMENTS DISPLAY FORPRVIOUS RESULTS
"PKG",26,22,1,"PAH",1,1,294,0)
 
"PKG",26,22,1,"PAH",1,1,295,0)
 
"PKG",26,22,1,"PAH",1,1,296,0)
ASSOCIATED NOIS
"PKG",26,22,1,"PAH",1,1,297,0)
---------------
"PKG",26,22,1,"PAH",1,1,298,0)
 ALB-0100-50284
"PKG",26,22,1,"PAH",1,1,299,0)
 BRK-0499-10720
"PKG",26,22,1,"PAH",1,1,300,0)
 BON-0196-71728
"PKG",26,22,1,"PAH",1,1,301,0)
 CHS-0303-40534
"PKG",26,22,1,"PAH",1,1,302,0)
 DAY-0303-40775
"PKG",26,22,1,"PAH",1,1,303,0)
 DEN-1299-52099
"PKG",26,22,1,"PAH",1,1,304,0)
 FAV-1103-70892
"PKG",26,22,1,"PAH",1,1,305,0)
 HVH-0604-10572
"PKG",26,22,1,"PAH",1,1,306,0)
 IND-0498-42538
"PKG",26,22,1,"PAH",1,1,307,0)
 MAR-0603-21152
"PKG",26,22,1,"PAH",1,1,308,0)
 NYH-0700-11942
"PKG",26,22,1,"PAH",1,1,309,0)
 PHI-0803-21507
"PKG",26,22,1,"PAH",1,1,310,0)
 SDC-0904-61304
"PKG",26,22,1,"PAH",1,1,311,0)
 SFC-1103-60132
"PKG",26,22,1,"PAH",1,1,312,0)
 TAM-0400-31033
"PKG",26,22,1,"PAH",1,1,313,0)
 WPB-0900-32221
"PKG",26,22,1,"PAH",1,1,314,0)
 
"PKG",26,22,1,"PAH",1,1,315,0)

"PKG",26,22,1,"PAH",1,1,316,0)
TEST SITES
"PKG",26,22,1,"PAH",1,1,317,0)
----------
"PKG",26,22,1,"PAH",1,1,318,0)
 Albuquerque VAMC - VMS/DSM and VMS/Cache
"PKG",26,22,1,"PAH",1,1,319,0)
 Boston HCS - VMS/DSM and VMS/Cache
"PKG",26,22,1,"PAH",1,1,320,0)
 El Paso HCS - NT/Cache and VMS/Cache
"PKG",26,22,1,"PAH",1,1,321,0)
 Hines VAMC - VMS/DSM and VMS/Cache
"PKG",26,22,1,"PAH",1,1,322,0)
 Honolulu VAMC -  NT/Cache
"PKG",26,22,1,"PAH",1,1,323,0)
 Manchester VAMC - NT/Cache NT and VMS/Cache
"PKG",26,22,1,"PAH",1,1,324,0)
 Milwaukee VAMC - VMS/DSM
"PKG",26,22,1,"PAH",1,1,325,0)
 North Chicago VAMC - VMS/DSM
"PKG",26,22,1,"PAH",1,1,326,0)
 Salt Lake City VAMC - VMS/DSM
"PKG",26,22,1,"PAH",1,1,327,0)
 San Diego VAMC - VMS/DSM and VMS/Cache
"PKG",26,22,1,"PAH",1,1,328,0)
 Upstate New York HCS - VMS/DSM and VMS/Cache
"PKG",26,22,1,"PAH",1,1,329,0)
 
"PKG",26,22,1,"PAH",1,1,330,0)
 
"PKG",26,22,1,"PAH",1,1,331,0)
 INSTALLATION FILES:
"PKG",26,22,1,"PAH",1,1,332,0)
 ==================
"PKG",26,22,1,"PAH",1,1,333,0)
 The following software and documentation files are exported as part of
"PKG",26,22,1,"PAH",1,1,334,0)
 this patch:
"PKG",26,22,1,"PAH",1,1,335,0)
 
"PKG",26,22,1,"PAH",1,1,336,0)
    File Name             Contents                     Retrieval Format
"PKG",26,22,1,"PAH",1,1,337,0)
    ---------             --------                     ----------------
"PKG",26,22,1,"PAH",1,1,338,0)
 
"PKG",26,22,1,"PAH",1,1,339,0)
LAB_LEDI_III.KID        LA*5.2*64 KIDS build           ASCII
"PKG",26,22,1,"PAH",1,1,340,0)
                        LR*5.2*286 KIDS build
"PKG",26,22,1,"PAH",1,1,341,0)
 
"PKG",26,22,1,"PAH",1,1,342,0)
 
"PKG",26,22,1,"PAH",1,1,343,0)
LAB_LEDI_III_IG.PDF     LABORATORY ELECTRONIC DATA     BINARY
"PKG",26,22,1,"PAH",1,1,344,0)
                        INSTALLATION GUIDE
"PKG",26,22,1,"PAH",1,1,345,0)
 
"PKG",26,22,1,"PAH",1,1,346,0)
LAB_LEDI_III_IMP_UG.PDF LABORATORY ELECTRONIC DATA     BINARY
"PKG",26,22,1,"PAH",1,1,347,0)
                        IMPLEMENTATION AND USER GUIDE
"PKG",26,22,1,"PAH",1,1,348,0)
 
"PKG",26,22,1,"PAH",1,1,349,0)
 The files listed above may be obtained via FTP.  The preferred method is
"PKG",26,22,1,"PAH",1,1,350,0)
 to FTP the files from:
"PKG",26,22,1,"PAH",1,1,351,0)
 
"PKG",26,22,1,"PAH",1,1,352,0)
    download.vista.med.va.gov
"PKG",26,22,1,"PAH",1,1,353,0)
 
"PKG",26,22,1,"PAH",1,1,354,0)
 This transmits the files from the first available FTP server.  Sites may
"PKG",26,22,1,"PAH",1,1,355,0)
 also elect to retrieve software directly from a specific server as
"PKG",26,22,1,"PAH",1,1,356,0)
 follows:
"PKG",26,22,1,"PAH",1,1,357,0)
 
"PKG",26,22,1,"PAH",1,1,358,0)
    CIO FIELD OFFICE   FTP ADDRESS                 DIRECTORY
"PKG",26,22,1,"PAH",1,1,359,0)
    ----------------   -------------------------   --------------------
"PKG",26,22,1,"PAH",1,1,360,0)
    Albany             ftp.fo-albany.med.va.gov    [anonymous.software]
"PKG",26,22,1,"PAH",1,1,361,0)
    Hines              ftp.fo-hines.med.va.gov     [anonymous.software]
"PKG",26,22,1,"PAH",1,1,362,0)
    Salt Lake City     ftp.fo-slc.med.va.gov       [anonymous.software] 
"PKG",26,22,1,"PAH",1,1,363,0)
 
"PKG",26,22,1,"PAH",1,1,364,0)
  
"PKG",26,22,1,"PAH",1,1,365,0)
ROUTINE SUMMARY
"PKG",26,22,1,"PAH",1,1,366,0)
===============
"PKG",26,22,1,"PAH",1,1,367,0)
  The following routines are included in this patch.  The second line
"PKG",26,22,1,"PAH",1,1,368,0)
  of each of these routines now looks like:
"PKG",26,22,1,"PAH",1,1,369,0)
  <tab> ;;5.2;LAB SERVICE;<patchlist>;Sep 27, 1994
"PKG",26,22,1,"PAH",1,1,370,0)
 
"PKG",26,22,1,"PAH",1,1,371,0)
                    Checksum       Checksum
"PKG",26,22,1,"PAH",1,1,372,0)
   Routine Name     Before Patch   After Patch    Patch List
"PKG",26,22,1,"PAH",1,1,373,0)
   ------------     ------------   -----------    ------------
"PKG",26,22,1,"PAH",1,1,374,0)
   LR286            N/A            5465218        **286** (Deleted by KIDS)
"PKG",26,22,1,"PAH",1,1,375,0)
   LR7OB63          9973912        9132350        **121,187,286**
"PKG",26,22,1,"PAH",1,1,376,0)
   LR7OGM           8016197        8279122        **187,220,312,286**
"PKG",26,22,1,"PAH",1,1,377,0)
   LR7OGMC          5100174        5463477        **187,230,312,286**
"PKG",26,22,1,"PAH",1,1,378,0)
   LR7OGMG          3593445        3973477        **187,230,286**
"PKG",26,22,1,"PAH",1,1,379,0)
   LR7OGMP          5548341        6065382        **187,246,282,286**
"PKG",26,22,1,"PAH",1,1,380,0)
   LR7OR2           9125008        8919494        **121,187,219,285,286**
"PKG",26,22,1,"PAH",1,1,381,0)
   LR7OSUM1         12883059       12868699       **121,187,256,286**
"PKG",26,22,1,"PAH",1,1,382,0)
   LR7OSUM6         7911216        5450631        **121,201,187,286**
"PKG",26,22,1,"PAH",1,1,383,0)
   LRAFUNC          5202410        5809534        **286**
"PKG",26,22,1,"PAH",1,1,384,0)
   LRDIDLE0         5463932        6544739        **140,171,153,286**
"PKG",26,22,1,"PAH",1,1,385,0)
   LRDPAREF         5111405        7469302        **153,222,286**
"PKG",26,22,1,"PAH",1,1,386,0)
   LRDPAREX         7190033        6456580        **153,286**
"PKG",26,22,1,"PAH",1,1,387,0)
   LREVENT          3678954        2907416        **153,286**
"PKG",26,22,1,"PAH",1,1,388,0)
   LRFAST           19691126       18799737       **100,121,201,286**
"PKG",26,22,1,"PAH",1,1,389,0)
   LRFASTS          6423167        6524547        **30,95,121,271,286**
"PKG",26,22,1,"PAH",1,1,390,0)
   LRGP1            3988622        4165501        **112,269,286**
"PKG",26,22,1,"PAH",1,1,391,0)
   LROE             14550901       11534796       **100,121,201,221,263,286**
"PKG",26,22,1,"PAH",1,1,392,0)
   LRORD            12009917       12806626       **100,121,153,286**
"PKG",26,22,1,"PAH",1,1,393,0)
   LRORD1           9848796        9190513        **1,8,121,153,201,286**
"PKG",26,22,1,"PAH",1,1,394,0)
   LRORDB           3782224        7231598        **153,222,286**
"PKG",26,22,1,"PAH",1,1,395,0)
   LROW3            7497722        6459972        **33,121,286**
"PKG",26,22,1,"PAH",1,1,396,0)
   LRRP             11838355       9427993        **195,221,283,286**
"PKG",26,22,1,"PAH",1,1,397,0)
   LRRP1            8015031        6556852        **153,221,283,286**
"PKG",26,22,1,"PAH",1,1,398,0)
   LRRPU            N/A            3220194        **286**
"PKG",26,22,1,"PAH",1,1,399,0)
   LRSTUF1          13209134       11668378       **153,286**
"PKG",26,22,1,"PAH",1,1,400,0)
   LRVER            17228890       15441873       **153,286**
"PKG",26,22,1,"PAH",1,1,401,0)
   LRVER1           8587449        7330679        **42,153,201,215,239,240,
"PKG",26,22,1,"PAH",1,1,402,0)
                                                  263,232,286**
"PKG",26,22,1,"PAH",1,1,403,0)
   LRVER3           14311842       13055299       **42,100,121,140,171,153,
"PKG",26,22,1,"PAH",1,1,404,0)
                                                  221,286**
"PKG",26,22,1,"PAH",1,1,405,0)
   LRVER4           19639169       14489554       **14,42,112,121,140,171,
"PKG",26,22,1,"PAH",1,1,406,0)
                                                  153,188,279,283,286**
"PKG",26,22,1,"PAH",1,1,407,0)
   LRVER5           14564045       14854455       **42,153,283,286**
"PKG",26,22,1,"PAH",1,1,408,0)
   LRVERA           690805         5764794        **153,271,286**
"PKG",26,22,1,"PAH",1,1,409,0)
   LRVR             13316120       11130012       **42,153,263,286**
"PKG",26,22,1,"PAH",1,1,410,0)
   LRVR1            11269859       11667912       **42,153,221,286**
"PKG",26,22,1,"PAH",1,1,411,0)
   LRVR3            10486080       11176919       **42,121,153,286**
"PKG",26,22,1,"PAH",1,1,412,0)
   LRVR4            8885642        9645653        **14,42,121,153,221,263,
"PKG",26,22,1,"PAH",1,1,413,0)
                                                  279,283,287,286**
"PKG",26,22,1,"PAH",1,1,414,0)
   LRVR5            11950773       4666781        **1,42,153,263,283,286**
"PKG",26,22,1,"PAH",1,1,415,0)
   LRWLST1          18457202       12664045       **48,65,121,153,261,286**
"PKG",26,22,1,"PAH",1,1,416,0)
   LRWLST11         21393713       16883055       **121,128,153,202,286**
"PKG",26,22,1,"PAH",1,1,417,0)
 
"PKG",26,22,1,"PAH",1,1,418,0)
 List of preceding patches: 187, 202, 222, 230, 232, 256, 261, 269, 271
"PKG",26,22,1,"PAH",1,1,419,0)
 282, 283, 285, 287, 312
"PKG",26,22,1,"PAH",1,1,420,0)
 Sites should use CHECK^XTSUMBLD to verify checksums.
"PKG",26,22,1,"PAH",1,1,421,0)
 
"PKG",26,22,1,"PAH",1,1,422,0)
 
"PKG",26,22,1,"PAH",1,1,423,0)
INSTALLATION INSTRUCTIONS
"PKG",26,22,1,"PAH",1,1,424,0)
=========================
"PKG",26,22,1,"PAH",1,1,425,0)
 
"PKG",26,22,1,"PAH",1,1,426,0)
See LABORATORY ELECTRONIC DATA INTERCHANGE III (LEDI III) INSTALLATION GUIDE
"PKG",26,22,1,"PAH",1,1,427,0)
    LA*5.2*64/LR*5.2*286
"PRE")
LR286
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
39
"RTN","LR286")
0^^B11589678
"RTN","LR286",1,0)
LR286 ;DALOI/JMC - LR*5.2*286 PATCH ENVIRONMENT CHECK ROUTINE ;12/18/2001
"RTN","LR286",2,0)
 ;;5.2;LAB SERVICE;**286**;Sep 27, 1994
"RTN","LR286",3,0)
EN ; Does not prevent loading of the transport global.
"RTN","LR286",4,0)
 ; Environment check is done only during the install.
"RTN","LR286",5,0)
 ;
"RTN","LR286",6,0)
 N XQA,XQAMSG
"RTN","LR286",7,0)
 ;
"RTN","LR286",8,0)
 I '$G(XPDENV) D  Q
"RTN","LR286",9,0)
 . S XQAMSG="Transport global for patch "_$G(XPDNM,"Unknown patch")_" loaded on "_$$HTE^XLFDT($H)
"RTN","LR286",10,0)
 . S XQA("G.LMI")=""
"RTN","LR286",11,0)
 . D SETUP^XQALERT
"RTN","LR286",12,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Sending transport global loaded alert to mail group G.LMI",80))
"RTN","LR286",13,0)
 ;
"RTN","LR286",14,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")_" started on "_$$HTE^XLFDT($H)
"RTN","LR286",15,0)
 S XQA("G.LMI")=""
"RTN","LR286",16,0)
 D SETUP^XQALERT
"RTN","LR286",17,0)
 D BMES^XPDUTL($$CJ^XLFSTR("Sending install started alert to mail group G.LMI",80))
"RTN","LR286",18,0)
 ;
"RTN","LR286",19,0)
 D CHECK
"RTN","LR286",20,0)
 D EXIT
"RTN","LR286",21,0)
 Q
"RTN","LR286",22,0)
 ;
"RTN","LR286",23,0)
CHECK ; Perform environment check
"RTN","LR286",24,0)
 I $S('$G(IOM):1,'$G(IOSL):1,$G(U)'="^":1,1:0) D  Q
"RTN","LR286",25,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Terminal Device is not defined",80))
"RTN","LR286",26,0)
 . S XPDQUIT=2
"RTN","LR286",27,0)
 I $S('$G(DUZ):1,$D(DUZ)[0:1,$D(DUZ(0))[0:1,1:0) D  Q
"RTN","LR286",28,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Please log in to set local DUZ... variables",80))
"RTN","LR286",29,0)
 . S XPDQUIT=2
"RTN","LR286",30,0)
 I $P($$ACTIVE^XUSER(DUZ),"^")'=1 D  Q
"RTN","LR286",31,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("You are not a valid user on this system",80))
"RTN","LR286",32,0)
 . S XPDQUIT=2
"RTN","LR286",33,0)
 S XPDIQ("XPZ1","B")="NO"
"RTN","LR286",34,0)
 Q
"RTN","LR286",35,0)
 ;
"RTN","LR286",36,0)
 ;
"RTN","LR286",37,0)
EXIT ;
"RTN","LR286",38,0)
 I $G(XPDQUIT) D BMES^XPDUTL($$CJ^XLFSTR("--- Install Environment Check FAILED ---",80))
"RTN","LR286",39,0)
 I '$G(XPDQUIT) D BMES^XPDUTL($$CJ^XLFSTR("--- Environment Check is Ok ---",80))
"RTN","LR286",40,0)
 Q
"RTN","LR286",41,0)
 ;
"RTN","LR286",42,0)
 ;
"RTN","LR286",43,0)
PRE ; KIDS Pre install
"RTN","LR286",44,0)
 N DIU
"RTN","LR286",45,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install started ***",80))
"RTN","LR286",46,0)
 ;
"RTN","LR286",47,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Deleting Data Dictionary for LAB PENDING ORDERS ENTRY file (#69.6) ***",80))
"RTN","LR286",48,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Will be reinstalled by this KIDS build ***",80))
"RTN","LR286",49,0)
 S DIU="^LRO(69.6,",DIU(0)="" D EN^DIU2
"RTN","LR286",50,0)
 ;
"RTN","LR286",51,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install completed ***",80))
"RTN","LR286",52,0)
 Q
"RTN","LR286",53,0)
 ;
"RTN","LR286",54,0)
 ;
"RTN","LR286",55,0)
POST ; KIDS Post install
"RTN","LR286",56,0)
 N DIK,XQA,XQAMSG,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","LR286",57,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install started ***",80))
"RTN","LR286",58,0)
 ;
"RTN","LR286",59,0)
 ; Reindex "D" x-ref on field #18 of file #69.6.
"RTN","LR286",60,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Tasking reindexing of field #18 of LAB PENDING ORDERS ENTRY file ***",80))
"RTN","LR286",61,0)
 K ^LRO(69.6,"D")
"RTN","LR286",62,0)
 S DIK="^LRO(69.6,",DIK(1)="18^D"
"RTN","LR286",63,0)
 S ZTSAVE("DIK*")="",ZTIO="",ZTDTH=$H
"RTN","LR286",64,0)
 S ZTDESC="Reindex of 'D' index file 69.6 (LR*5.2*286)"
"RTN","LR286",65,0)
 S ZTRTN="ENALL^DIK"
"RTN","LR286",66,0)
 D ^%ZTLOAD
"RTN","LR286",67,0)
 ;
"RTN","LR286",68,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install completed ***",80))
"RTN","LR286",69,0)
 D BMES^XPDUTL($$CJ^XLFSTR("Sending install completion alert to mail group G.LMI",80))
"RTN","LR286",70,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")_" completed on "_$$HTE^XLFDT($H)
"RTN","LR286",71,0)
 S XQA("G.LMI")=""
"RTN","LR286",72,0)
 D SETUP^XQALERT
"RTN","LR286",73,0)
 Q
"RTN","LR7OB63")
0^31^B23872851
"RTN","LR7OB63",1,0)
LR7OB63 ; DALOI/dcm - Get Lab data from 63 ;8/11/97
"RTN","LR7OB63",2,0)
 ;;5.2;LAB SERVICE;**121,187,286**;Sep 27, 1994
"RTN","LR7OB63",3,0)
 ;
"RTN","LR7OB63",4,0)
63(CTR,LRDFN,SS,IVDT,CORRECT) ;Get data from file 63
"RTN","LR7OB63",5,0)
 ;CTR=Counter
"RTN","LR7OB63",6,0)
 ;LRDFN=Patient ID
"RTN","LR7OB63",7,0)
 ;SS=Subscript for results 'CH'-Chem Tox 'MI'-Microbiology, etc.
"RTN","LR7OB63",8,0)
 ;IVDT=Inverse D/T verified
"RTN","LR7OB63",9,0)
 ;CORRECT=1 if a corrected result, 0 if not
"RTN","LR7OB63",10,0)
 ;See ^LR7OB69 for description of LRX array
"RTN","LR7OB63",11,0)
 I $G(CONTROL)="ZC" Q
"RTN","LR7OB63",12,0)
 N IFN
"RTN","LR7OB63",13,0)
 I $L(SS),$L($T(@SS)) G @SS
"RTN","LR7OB63",14,0)
 Q
"RTN","LR7OB63",15,0)
 ;
"RTN","LR7OB63",16,0)
 ;
"RTN","LR7OB63",17,0)
CH ;Chem, Hem, Tox, Ria, Ser, etc.
"RTN","LR7OB63",18,0)
 N LRX,X0,Y1,Y2,Y3,Y4,Y5,Y6,Y12,Y14,Y15,Y16,Y17,Y18
"RTN","LR7OB63",19,0)
 Q:'$D(^LR(LRDFN,"CH",+$G(IVDT),0))  S X0=^(0)
"RTN","LR7OB63",20,0)
 S Y6=$S(+$G(CORRECT):"C",$P(X0,"^",3):"F",1:"")
"RTN","LR7OB63",21,0)
 S Y16=$P(X0,"^",6)
"RTN","LR7OB63",22,0)
 S Y17=$$ORD^LR7OR2(LRDFN,IVDT),Y18=";CH;"_IVDT
"RTN","LR7OB63",23,0)
 ;
"RTN","LR7OB63",24,0)
 I '$D(SEX) N SEX S SEX=$P($G(@("^"_$P(LRDPF,"^",2)_+DFN_",0)")),"^",2)
"RTN","LR7OB63",25,0)
 ;
"RTN","LR7OB63",26,0)
 I '$D(DOB)!'$D(AGE) N AGE,DOB D
"RTN","LR7OB63",27,0)
 . S DOB=$P($G(@("^"_$P(LRDPF,"^",2)_+DFN_",0)")),"^",3)
"RTN","LR7OB63",28,0)
 . S AGE=$S($D(DT)&(DOB?7N):DT-DOB\10000,1:"??")
"RTN","LR7OB63",29,0)
 ;
"RTN","LR7OB63",30,0)
 S IFN=1
"RTN","LR7OB63",31,0)
 F  S IFN=$O(^LR(LRDFN,"CH",IVDT,IFN)) Q:IFN<1  S X=^(IFN) I $D(TSTY(IFN))!($D(BYPASS)),$S('$D(LRSB):1,$D(LRSB(IFN)):1,1:0) D
"RTN","LR7OB63",32,0)
 . I $D(LRSB(IFN)),$D(LRSA(IFN)),'$D(LRSA(IFN,2)) Q  ;Only re-transmit changed results
"RTN","LR7OB63",33,0)
 . S Y1=IFN,Y1=$O(^LAB(60,"C","CH;"_Y1_";1",0)),Y2=$P(X,"^"),Y3=$P(X,"^",2),Y12=$P(X,"^",4)
"RTN","LR7OB63",34,0)
 . S:Y2="pending" Y6="P" ;Set result status to P for pending results
"RTN","LR7OB63",35,0)
 . Q:"IN"[$P(^LAB(60,Y1,0),"^",3)  S Y15=$P($G(^LAB(60,Y1,.1)),"^")
"RTN","LR7OB63",36,0)
 . S (Y9,Y10,Y11,Y14)=""
"RTN","LR7OB63",37,0)
 . I $P($G(^LAB(60,Y1,64)),"^") S Y9=$P(^(64),"^"),Y9=$P(^LAM(Y9,0),"^",2),Y10=$P(^(0),"^"),Y11="99NLT"
"RTN","LR7OB63",38,0)
 . ;D UNIT(Y1,$P(X0,"^",5),SEX,DOB,AGE)
"RTN","LR7OB63",39,0)
 . S LRX=$$TSTRES^LRRPU(LRDFN,"CH",IVDT,IFN,Y1)
"RTN","LR7OB63",40,0)
 . S Y2=$P(LRX,"^"),Y3=$P(LRX,"^",2),Y4=$P(LRX,"^",5),Y5=$P(LRX,"^",3)_$S($P(LRX,"^",4)'="":"-"_$P(LRX,"^",4),1:"")
"RTN","LR7OB63",41,0)
 . I $P(LRX,"^",7) S Y14="T"
"RTN","LR7OB63",42,0)
 . S Y2=$$TRIM^XLFSTR($$RESULT(Y1,Y2),"LR"," ")
"RTN","LR7OB63",43,0)
 . S ^TMP("LRX",$J,69,CTR,63,IFN)=Y1_"^"_Y2_"^"_Y3_"^"_Y4_"^"_Y5_"^"_Y6_"^^^"_Y9_"^"_Y10_"^"_Y11_"^"_Y12_"^^"_Y14_"^"_Y15_"^"_Y16_"^"_Y17_"^"_Y18
"RTN","LR7OB63",44,0)
 ;
"RTN","LR7OB63",45,0)
 I $D(GOTCOM(LRDFN,"CH",IVDT)) Q
"RTN","LR7OB63",46,0)
 S GOTCOM(LRDFN,"CH",IVDT)="",IFN=0
"RTN","LR7OB63",47,0)
 F  S IFN=$O(^LR(LRDFN,"CH",IVDT,1,IFN)) Q:IFN<1  S ^TMP("LRX",$J,69,CTR,63,"N",IFN)=$P(^LR(LRDFN,"CH",IVDT,1,IFN,0),"^")
"RTN","LR7OB63",48,0)
 ;
"RTN","LR7OB63",49,0)
 Q
"RTN","LR7OB63",50,0)
 ;
"RTN","LR7OB63",51,0)
 ;
"RTN","LR7OB63",52,0)
MI ;Microbiology
"RTN","LR7OB63",53,0)
 D MI^LR7OB63A()
"RTN","LR7OB63",54,0)
 Q
"RTN","LR7OB63",55,0)
 ;
"RTN","LR7OB63",56,0)
 ;
"RTN","LR7OB63",57,0)
BB ;Blood bank
"RTN","LR7OB63",58,0)
 D BB1()
"RTN","LR7OB63",59,0)
 Q
"RTN","LR7OB63",60,0)
 ;
"RTN","LR7OB63",61,0)
 ;
"RTN","LR7OB63",62,0)
BB1(SPECMEN) ;Blood bank
"RTN","LR7OB63",63,0)
 ;SPECMEN=ptr to 61, to specify specimen (optional)
"RTN","LR7OB63",64,0)
 N X0,Y1,Y2,Y3,Y4,Y5,Y6,Y15,Y18,Y19,CTR1
"RTN","LR7OB63",65,0)
 Q:'$D(^LR(LRDFN,"BB",+$G(IVDT),0))  S X0=^(0),Y6=$S(+$G(CORRECT):"C",$P(X0,"^",3):"F",1:""),Y19=$P(X0,"^",5),CTR1=0,Y18=";BB;"_IVDT
"RTN","LR7OB63",66,0)
 ;There are other multiples for blood bank in file 63 that also need to be processed, this is just a start.
"RTN","LR7OB63",67,0)
 I $G(SPECMEN),Y19'=SPECMEN Q
"RTN","LR7OB63",68,0)
 S IFN=1 F  S IFN=$O(^LR(LRDFN,"BB",IVDT,IFN)) Q:IFN<1  I $D(^(IFN))#2 S XNODE=^(IFN) F IFN1=1:1:$L(XNODE,"^") S X1=$P(XNODE,"^",IFN1) I $L(X1) D
"RTN","LR7OB63",69,0)
 . S X=$$NODEPIK(63.01,IFN,IFN1,X1) ;X=field^data
"RTN","LR7OB63",70,0)
 . I $L($P(X,"^")) S CTR1=CTR1+1,^TMP("LRX",$J,69,CTR,63,CTR1)=X_"^^^^"_Y6_"^^^^^^^^^"_X_"^^^"_Y18_"^"_Y19
"RTN","LR7OB63",71,0)
 I $D(^LR(LRDFN,"BB",IVDT,99)) S Y1="Specimen Comment: " S IFN=0 F  S IFN=$O(^LR(LRDFN,"BB",IVDT,99,IFN)) Q:IFN<1  S Y2=^(IFN,0),^TMP("LRX",$J,69,CTR,63,"N",IFN)=Y1_"^"_Y2
"RTN","LR7OB63",72,0)
 Q
"RTN","LR7OB63",73,0)
 ;
"RTN","LR7OB63",74,0)
 ;
"RTN","LR7OB63",75,0)
EM ;Electron Microscopy
"RTN","LR7OB63",76,0)
 D SS^LR7OB63C("EM")
"RTN","LR7OB63",77,0)
 Q
"RTN","LR7OB63",78,0)
 ;
"RTN","LR7OB63",79,0)
 ;
"RTN","LR7OB63",80,0)
SP ;Surgical Pathology
"RTN","LR7OB63",81,0)
 D SS^LR7OB63C("SP")
"RTN","LR7OB63",82,0)
 Q
"RTN","LR7OB63",83,0)
 ;
"RTN","LR7OB63",84,0)
 ;
"RTN","LR7OB63",85,0)
CY ;Cytology
"RTN","LR7OB63",86,0)
 D SS^LR7OB63C("CY")
"RTN","LR7OB63",87,0)
 Q
"RTN","LR7OB63",88,0)
 ;
"RTN","LR7OB63",89,0)
 ;
"RTN","LR7OB63",90,0)
AU ;Autopsy
"RTN","LR7OB63",91,0)
 D AU^LR7OB63D
"RTN","LR7OB63",92,0)
 Q
"RTN","LR7OB63",93,0)
 ;
"RTN","LR7OB63",94,0)
 ;
"RTN","LR7OB63",95,0)
NODEPIK(FILE,NODE,PIECE,DATA) ;Set field name and data into X
"RTN","LR7OB63",96,0)
 N Z,Y,Y1,Y2
"RTN","LR7OB63",97,0)
 S Z=$O(^DD(FILE,"GL",NODE,PIECE,0)),X=""
"RTN","LR7OB63",98,0)
 I Z S Y=^DD(FILE,Z,0),Y1=$P(Y,"^"),Y2=DATA S:$P(Y,"^",2)["S" Y2=$$SET(FILE,Z,Y2) S:$P(Y,"^",2)["P"!($P(Y,"^",2)["V") Y2=$$POINTER(FILE,Z,Y2) S X=Y1_"^"_Y2
"RTN","LR7OB63",99,0)
 Q X
"RTN","LR7OB63",100,0)
 ;
"RTN","LR7OB63",101,0)
 ;
"RTN","LR7OB63",102,0)
UNIT(X,SPEC,SEX,DOB,AGE) ;Find units and ref range
"RTN","LR7OB63",103,0)
 ;X=Result
"RTN","LR7OB63",104,0)
 ;SPEC=Specimen ptr
"RTN","LR7OB63",105,0)
 ;SEX=Patient sex
"RTN","LR7OB63",106,0)
 ;DOB=Patient Date of birth
"RTN","LR7OB63",107,0)
 ;AGE=Patient age
"RTN","LR7OB63",108,0)
 ;Output: Y4=Units, Y5=Ref Range, Y14=T or "" (If T, range is theraputic)
"RTN","LR7OB63",109,0)
 N LO,HI
"RTN","LR7OB63",110,0)
 S (Y4,Y5,Y14)=""
"RTN","LR7OB63",111,0)
 Q:'$D(^LAB(60,+X,1,+SPEC,0))  S X=^(0) ;No units/ranges defined
"RTN","LR7OB63",112,0)
 S Y4=$P(X,"^",7)
"RTN","LR7OB63",113,0)
 S @("LO="_$S($L($P(X,"^",2)):$P(X,"^",2),$L($P(X,"^",11)):$P(X,"^",11),1:""""""))
"RTN","LR7OB63",114,0)
 S @("HI="_$S($L($P(X,"^",3)):$P(X,"^",3),$L($P(X,"^",12)):$P(X,"^",12),1:""""""))
"RTN","LR7OB63",115,0)
 S Y5=$S($L(HI):LO_"-"_HI,1:LO)
"RTN","LR7OB63",116,0)
 S Y14=$S('$L($P(X,"^",2))&$L($P(X,"^",11)):"T",1:"")
"RTN","LR7OB63",117,0)
 Q
"RTN","LR7OB63",118,0)
 ;
"RTN","LR7OB63",119,0)
 ;
"RTN","LR7OB63",120,0)
RESULT(TEST,RESULT) ;Convert result to external format
"RTN","LR7OB63",121,0)
 ;TEST=Test ptr to file 60
"RTN","LR7OB63",122,0)
 ;RESULT=Test result
"RTN","LR7OB63",123,0)
 N X,X1,LRCW
"RTN","LR7OB63",124,0)
 S LRCW="",X1=$P($G(^LAB(60,TEST,.1)),"^",3),X1=$S($L(X1):X1,1:"$J(X,8)"),X=RESULT,@("X="_X1)
"RTN","LR7OB63",125,0)
 Q X
"RTN","LR7OB63",126,0)
 ;
"RTN","LR7OB63",127,0)
 ;
"RTN","LR7OB63",128,0)
STRIP(TEXT) ;Strips white space from text
"RTN","LR7OB63",129,0)
 N I,X
"RTN","LR7OB63",130,0)
 S X="" F I=1:1:$L(TEXT," ") S:$A($P(TEXT," ",I))>0 X=X_$P(TEXT," ",I)
"RTN","LR7OB63",131,0)
 Q X
"RTN","LR7OB63",132,0)
 ;
"RTN","LR7OB63",133,0)
 ;
"RTN","LR7OB63",134,0)
SET(FILE,FIELD,RESULT) ;Interpret set of codes
"RTN","LR7OB63",135,0)
 S X=$P(^DD(FILE,FIELD,0),"^",3),X=$P($P(";"_X,";"_RESULT_":",2),";")
"RTN","LR7OB63",136,0)
 Q X
"RTN","LR7OB63",137,0)
 ;
"RTN","LR7OB63",138,0)
 ;
"RTN","LR7OB63",139,0)
POINTER(FILE,FIELD,RESULT) ;Interpret pointer values
"RTN","LR7OB63",140,0)
 N X
"RTN","LR7OB63",141,0)
 S X=$P(^DD(FILE,FIELD,0),"^",2)
"RTN","LR7OB63",142,0)
 I X["V" S X1=@("^"_$P(RESULT,";",2)_+RESULT_",0)")
"RTN","LR7OB63",143,0)
 I X'["V" S X1=$P(@("^"_$P(^DD(FILE,FIELD,0),"^",3)_RESULT_",0)"),"^")
"RTN","LR7OB63",144,0)
 Q X1
"RTN","LR7OGM")
0^37^B29928467
"RTN","LR7OGM",1,0)
LR7OGM ;DALOI/STAFF- Interim report rpc memo ;Aug 16, 2004
"RTN","LR7OGM",2,0)
 ;;5.2;LAB SERVICE;**187,220,312,286**;Sep 27, 1994
"RTN","LR7OGM",3,0)
 ;
"RTN","LR7OGM",4,0)
TEST ; test use only
"RTN","LR7OGM",5,0)
 N TESTS,I K TESTS,^TMP("LR7OGX",$J)
"RTN","LR7OGM",6,0)
 ;S TESTS(548)=548
"RTN","LR7OGM",7,0)
 ;F I=1:1:10 I $D(^LAB(60,I,0)) S TESTS(I)=I
"RTN","LR7OGM",8,0)
 D SELECT(2,2970202,2920202,.TESTS,0,-1)
"RTN","LR7OGM",9,0)
 S I=0 F  S I=$O(^TMP("LR7OGX",$J,"OUTPUT",I)) Q:I<1  W !,^(I)
"RTN","LR7OGM",10,0)
 K ^TMP("LR7OGX",$J)
"RTN","LR7OGM",11,0)
 Q
"RTN","LR7OGM",12,0)
 ;
"RTN","LR7OGM",13,0)
INTERIM(ROOT,DFN,SDATE,EDATE) ; from ORWLRR
"RTN","LR7OGM",14,0)
 N FORMAT,MICROCHK,TESTS K TESTS
"RTN","LR7OGM",15,0)
 S (FORMAT,MICROCHK)=""
"RTN","LR7OGM",16,0)
 S ROOT=$NA(^TMP("LR7OGX",$J,"OUTPUT"))
"RTN","LR7OGM",17,0)
 D SELECT(DFN,SDATE,EDATE,.TESTS,FORMAT,MICROCHK) ;
"RTN","LR7OGM",18,0)
 Q
"RTN","LR7OGM",19,0)
 ;
"RTN","LR7OGM",20,0)
INTERIMG(ROOT,DFN,SDATE,DIR,FORMAT) ; from ORWLRR
"RTN","LR7OGM",21,0)
 N MICROCHK,TESTS K TESTS
"RTN","LR7OGM",22,0)
 S MICROCHK=1,FORMAT=$G(FORMAT,1)
"RTN","LR7OGM",23,0)
 S ROOT=$NA(^TMP("LR7OGX",$J,"OUTPUT"))
"RTN","LR7OGM",24,0)
 D SELECT(DFN,SDATE,DIR,.TESTS,FORMAT,MICROCHK) ;
"RTN","LR7OGM",25,0)
 Q
"RTN","LR7OGM",26,0)
 ;
"RTN","LR7OGM",27,0)
INTERIMS(ROOT,DFN,SDATE,EDATE,TESTLIST) ; from ORWLRR
"RTN","LR7OGM",28,0)
 N FORMAT,MICROCHK,NUM,TESTS K TESTS
"RTN","LR7OGM",29,0)
 S (FORMAT,MICROCHK)=""
"RTN","LR7OGM",30,0)
 S NUM=0 F  S NUM=$O(TESTLIST(NUM)) Q:NUM<1  S TESTS(+TESTLIST(NUM))=""
"RTN","LR7OGM",31,0)
 S ROOT=$NA(^TMP("LR7OGX",$J,"OUTPUT"))
"RTN","LR7OGM",32,0)
 D SELECT(DFN,SDATE,EDATE,.TESTS,FORMAT,MICROCHK) ;
"RTN","LR7OGM",33,0)
 Q
"RTN","LR7OGM",34,0)
 ;
"RTN","LR7OGM",35,0)
MICRO(ROOT,DFN,SDATE,EDATE) ; from ORWLRR
"RTN","LR7OGM",36,0)
 N FORMAT,MICROCHK,TESTS K TESTS
"RTN","LR7OGM",37,0)
 S FORMAT="",MICROCHK=-1
"RTN","LR7OGM",38,0)
 S ROOT=$NA(^TMP("LR7OGX",$J,"OUTPUT"))
"RTN","LR7OGM",39,0)
 D SELECT(DFN,SDATE,EDATE,.TESTS,FORMAT,MICROCHK) ;
"RTN","LR7OGM",40,0)
 Q
"RTN","LR7OGM",41,0)
 ;
"RTN","LR7OGM",42,0)
SELECT(DFN,SDATE,EDATE,TESTS,FORMAT,MICROCHK) ;
"RTN","LR7OGM",43,0)
 ; get patient info, and expand tests
"RTN","LR7OGM",44,0)
 ; route setup chem and/or micro data
"RTN","LR7OGM",45,0)
 ; 9th piece of output indicates format (2: CH of CH/MI exact date/time, 3: MI of CH/MI, else 1 or "")
"RTN","LR7OGM",46,0)
 N AGE,ALL,ASK,AVAIL,CNIDT,DIRECT,DONE,EDT,FOK,I,IDT,LRDFN,MICROSUB,MNIDT,OUTCNT,PNM,ROUTE,SEX,SDT K MICROSUB
"RTN","LR7OGM",47,0)
 K ^TMP("LR7OG",$J),^TMP("LR7OGX",$J,"OUTPUT"),^TMP("LRPLS",$J)
"RTN","LR7OGM",48,0)
 S OUTCNT=1,DONE=0
"RTN","LR7OGM",49,0)
 D DEMO^LR7OGU(DFN,.LRDFN,.PNM,.AGE,.SEX)
"RTN","LR7OGM",50,0)
 I '$G(LRDFN) Q
"RTN","LR7OGM",51,0)
 S ^TMP("LR7OG",$J,"G")=DFN_U_PNM_U_LRDFN_U_AGE_U_SEX_"^8"
"RTN","LR7OGM",52,0)
 S ALL=$S($O(TESTS(0)):0,1:1)
"RTN","LR7OGM",53,0)
 I 'ALL D TESTSGET^LR7OGU(.TESTS,.MICROSUB)
"RTN","LR7OGM",54,0)
 S DIRECT=1
"RTN","LR7OGM",55,0)
 I FORMAT S DIRECT=EDATE,EDATE=2700101
"RTN","LR7OGM",56,0)
 S EDATE=EDATE\1
"RTN","LR7OGM",57,0)
 S (IDT,SDT)=9999999-SDATE,EDT=9999999-EDATE
"RTN","LR7OGM",58,0)
 I FORMAT>1 S FOK=0 D  I FOK Q
"RTN","LR7OGM",59,0)
 . I DIRECT=1 D  Q
"RTN","LR7OGM",60,0)
 .. I FORMAT=2 D  Q
"RTN","LR7OGM",61,0)
 ... D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE)
"RTN","LR7OGM",62,0)
 ... S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=3
"RTN","LR7OGM",63,0)
 ... S FOK=1
"RTN","LR7OGM",64,0)
 .. I FORMAT=3 D  Q
"RTN","LR7OGM",65,0)
 ... S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=1
"RTN","LR7OGM",66,0)
 . I DIRECT=-1 D  Q
"RTN","LR7OGM",67,0)
 .. I FORMAT=2 D  Q
"RTN","LR7OGM",68,0)
 ... S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=1
"RTN","LR7OGM",69,0)
 .. I FORMAT=3 D  Q
"RTN","LR7OGM",70,0)
 ... D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE)
"RTN","LR7OGM",71,0)
 ... S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=2
"RTN","LR7OGM",72,0)
 ... S FOK=1
"RTN","LR7OGM",73,0)
 I ALL S ASK="BOTH"
"RTN","LR7OGM",74,0)
 E  I $O(MICROSUB(0)) D
"RTN","LR7OGM",75,0)
 . S ASK="MI" I $O(^TMP("LR7OG",$J,"TMP",0)) S ASK="BOTH"
"RTN","LR7OGM",76,0)
 E  S ASK="CH"
"RTN","LR7OGM",77,0)
 S I=IDT,CNIDT=0 F  S I=$O(^LR(LRDFN,"CH",I),DIRECT) Q:'I  I $P($G(^(I,0)),"^",3) S CNIDT=I Q
"RTN","LR7OGM",78,0)
 S I=IDT,MNIDT=0 F  S I=$O(^LR(LRDFN,"MI",I),DIRECT) Q:'I  S MNIDT=I Q
"RTN","LR7OGM",79,0)
 S AVAIL="NONE"
"RTN","LR7OGM",80,0)
 I CNIDT,CNIDT'>EDT D
"RTN","LR7OGM",81,0)
 . S AVAIL="CH" I MNIDT,MNIDT'>EDT S AVAIL="BOTH"
"RTN","LR7OGM",82,0)
 E  I MNIDT,MNIDT'>EDT S AVAIL="MI"
"RTN","LR7OGM",83,0)
 I DIRECT=-1 S AVAIL="BOTH"
"RTN","LR7OGM",84,0)
 S ROUTE="NONE"
"RTN","LR7OGM",85,0)
 I ASK="BOTH" S ROUTE=AVAIL
"RTN","LR7OGM",86,0)
 I ASK="CH",AVAIL="CH"!(AVAIL="BOTH") S ROUTE="CH"
"RTN","LR7OGM",87,0)
 I ASK="MI",AVAIL="MI"!(AVAIL="BOTH") S ROUTE="MI"
"RTN","LR7OGM",88,0)
 I MICROCHK=-1 S ROUTE="MI"
"RTN","LR7OGM",89,0)
 I ROUTE="NONE" D  Q
"RTN","LR7OGM",90,0)
 . K ^TMP("LR7OG",$J)
"RTN","LR7OGM",91,0)
 ;
"RTN","LR7OGM",92,0)
 I ROUTE="CH" D  Q
"RTN","LR7OGM",93,0)
 . F  S IDT=$O(^LR(LRDFN,"CH",IDT),DIRECT) Q:IDT<1  Q:IDT>EDT  D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE) Q:DONE
"RTN","LR7OGM",94,0)
 . I 'FORMAT,$D(^TMP("LRPLS",$J)) D PLS^LR7OGMP
"RTN","LR7OGM",95,0)
 . K ^TMP("LR7OG",$J),^TMP("LRPLS",$J)
"RTN","LR7OGM",96,0)
 ;
"RTN","LR7OGM",97,0)
 I ROUTE="MI" D  Q
"RTN","LR7OGM",98,0)
 . F  S IDT=$O(^LR(LRDFN,"MI",IDT),DIRECT) Q:IDT<1  Q:IDT>EDT  D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE) Q:DONE
"RTN","LR7OGM",99,0)
 . K ^TMP("LR7OG",$J)
"RTN","LR7OGM",100,0)
 F  D  Q:DONE
"RTN","LR7OGM",101,0)
 . S I=IDT,CNIDT=0 F  S I=$O(^LR(LRDFN,"CH",I),DIRECT) Q:'I  I $P($G(^(I,0)),"^",3) S CNIDT=I Q
"RTN","LR7OGM",102,0)
 . S I=IDT,MNIDT=0 F  S I=$O(^LR(LRDFN,"MI",I),DIRECT) Q:'I  S MNIDT=I Q
"RTN","LR7OGM",103,0)
 . I 'CNIDT,'MNIDT S DONE=1 Q
"RTN","LR7OGM",104,0)
 . D  I IDT>EDT S DONE=1 Q
"RTN","LR7OGM",105,0)
 .. I CNIDT=MNIDT D  Q  ; both chem and micro at this date/time
"RTN","LR7OGM",106,0)
 ... S IDT=CNIDT
"RTN","LR7OGM",107,0)
 ... I IDT'>EDT D
"RTN","LR7OGM",108,0)
 .... I FORMAT D  Q
"RTN","LR7OGM",109,0)
 ..... I SDT=(9999999-2700101)!(DIRECT=-1) D  Q
"RTN","LR7OGM",110,0)
 ...... D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE)
"RTN","LR7OGM",111,0)
 ...... S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=3
"RTN","LR7OGM",112,0)
 ..... D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE)
"RTN","LR7OGM",113,0)
 ..... S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,9)=2
"RTN","LR7OGM",114,0)
 .... I MICROCHK'=1 D  Q:DONE
"RTN","LR7OGM",115,0)
 ..... D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE)
"RTN","LR7OGM",116,0)
 ..... I FORMAT S MICROCHK=1
"RTN","LR7OGM",117,0)
 .... D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE)
"RTN","LR7OGM",118,0)
 .. I 'MNIDT D  Q  ; no micro since this date/time, only chem at this date/time
"RTN","LR7OGM",119,0)
 ... S IDT=CNIDT
"RTN","LR7OGM",120,0)
 ... I IDT'>EDT D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE)
"RTN","LR7OGM",121,0)
 .. I 'CNIDT D  Q  ; no chem since this date/time, only micro at this date/time
"RTN","LR7OGM",122,0)
 ... S IDT=MNIDT
"RTN","LR7OGM",123,0)
 ... I IDT'>EDT D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE)
"RTN","LR7OGM",124,0)
 .. I (DIRECT=1&(CNIDT<MNIDT))!(DIRECT=-1&(CNIDT>MNIDT)) D  Q  ;chem and micro data, chem is more recent
"RTN","LR7OGM",125,0)
 ... S IDT=CNIDT
"RTN","LR7OGM",126,0)
 ... I IDT'>EDT D CH^LR7OGMC(LRDFN,IDT,ALL,.OUTCNT,FORMAT,.DONE)
"RTN","LR7OGM",127,0)
 .. S IDT=MNIDT
"RTN","LR7OGM",128,0)
 .. I IDT'>EDT D MI^LR7OGMM(LRDFN,IDT,.MICROSUB,ALL,.OUTCNT,FORMAT,.DONE)
"RTN","LR7OGM",129,0)
 ;
"RTN","LR7OGM",130,0)
 I 'FORMAT,$D(^TMP("LRPLS",$J)) D PLS^LR7OGMP
"RTN","LR7OGM",131,0)
 ;
"RTN","LR7OGM",132,0)
 K ^TMP("LR7OG",$J),^TMP("LRPLS",$J)
"RTN","LR7OGM",133,0)
 Q
"RTN","LR7OGMC")
0^32^B9576583
"RTN","LR7OGMC",1,0)
LR7OGMC ;DALOI/STAFF- Interim report rpc memo chem ; Aug 16, 2004
"RTN","LR7OGMC",2,0)
 ;;5.2;LAB SERVICE;**187,230,312,286**;Sep 27, 1994
"RTN","LR7OGMC",3,0)
 ;
"RTN","LR7OGMC",4,0)
 ; sets lab data into ^TMP("LR7OG",$J,"TP"
"RTN","LR7OGMC",5,0)
 ; ^TMP("LR7OG",$J,"G")=dfn^pnm^lrdfn^age^sex^lrcw
"RTN","LR7OGMC",6,0)
 ; ^TMP("LR7OG",$J,"TMP",test subscript in data)=zero node of test
"RTN","LR7OGMC",7,0)
 ; ^TMP("LR7OG",$J,"TP",collect date/time)=zero node from data
"RTN","LR7OGMC",8,0)
 ; ^TMP("LR7OG",$J,"TP",collect date/time,printorder)=test#^name^printname^^printcode^dataname^result^flag^units^range^performing site
"RTN","LR7OGMC",9,0)
 ; ^TMP("LR7OG",$J,"TP",collect date/time,printorder,#)=interpretation
"RTN","LR7OGMC",10,0)
 ; ^TMP("LR7OG",$J,"TP",collect date/time,"C",#)=comment
"RTN","LR7OGMC",11,0)
 ;
"RTN","LR7OGMC",12,0)
 ;
"RTN","LR7OGMC",13,0)
CH(LRDFN,IDT,ALL,OUTCNT,FORMAT,DONE) ; from LR7OGM
"RTN","LR7OGMC",14,0)
 N CDT,CHSUB,CMNT,INTP,LABSUB,PNODE,PORDER,SPEC,TCNT,TESTNUM,TESTSUB,ZERO
"RTN","LR7OGMC",15,0)
 S ZERO=$G(^LR(LRDFN,"CH",IDT,0))
"RTN","LR7OGMC",16,0)
 I '$P(ZERO,U,3) Q
"RTN","LR7OGMC",17,0)
 S CDT=+ZERO,LABSUB="CH",TCNT=0,SPEC=$P(ZERO,U,5)
"RTN","LR7OGMC",18,0)
 S CHSUB=1
"RTN","LR7OGMC",19,0)
 F  S CHSUB=$O(^LR(LRDFN,"CH",IDT,CHSUB)) Q:CHSUB=""  I ALL!$D(^TMP("LR7OG",$J,"TMP",CHSUB)) D  Q
"RTN","LR7OGMC",20,0)
 . I FORMAT D
"RTN","LR7OGMC",21,0)
 .. S ^TMP("LR7OGX",$J,"OUTPUT",OUTCNT)="0^CH^"_(9999999-IDT)
"RTN","LR7OGMC",22,0)
 .. S OUTCNT=OUTCNT+1
"RTN","LR7OGMC",23,0)
 .. S DONE=1
"RTN","LR7OGMC",24,0)
 . K ^TMP("LR7OG",$J,"TP")
"RTN","LR7OGMC",25,0)
 . I ALL S TESTSUB=1 F  S TESTSUB=$O(^LR(LRDFN,"CH",IDT,TESTSUB)) Q:TESTSUB<1  S TESTNUM=$O(^LAB(60,"C","CH;"_TESTSUB_";1",0)) D CHSETUP
"RTN","LR7OGMC",26,0)
 . I 'ALL S TESTSUB=1 F  S TESTSUB=$O(^TMP("LR7OG",$J,"TMP",TESTSUB)) Q:TESTSUB<1  S TESTNUM=+^(TESTSUB) D CHSETUP
"RTN","LR7OGMC",27,0)
 . I TCNT D
"RTN","LR7OGMC",28,0)
 .. S ^TMP("LR7OG",$J,"TP",CDT)=ZERO,CMNT=0
"RTN","LR7OGMC",29,0)
 .. F  S CMNT=+$O(^LR(LRDFN,LABSUB,IDT,1,CMNT)) Q:CMNT<1  S ^TMP("LR7OG",$J,"TP",CDT,"C",CMNT)=^(CMNT,0) S TCNT=TCNT+1
"RTN","LR7OGMC",30,0)
 . I FORMAT D GRID^LR7OGMG(.OUTCNT)
"RTN","LR7OGMC",31,0)
 . I 'FORMAT D PRINT^LR7OGMP(.OUTCNT)
"RTN","LR7OGMC",32,0)
 . K ^TMP("LR7OG",$J,"TP")
"RTN","LR7OGMC",33,0)
 Q
"RTN","LR7OGMC",34,0)
 ;
"RTN","LR7OGMC",35,0)
 ;
"RTN","LR7OGMC",36,0)
CHSETUP ; within scope of CH
"RTN","LR7OGMC",37,0)
 ;
"RTN","LR7OGMC",38,0)
 N LRX
"RTN","LR7OGMC",39,0)
 I 'TESTNUM Q
"RTN","LR7OGMC",40,0)
 Q:'$D(^LAB(60,TESTNUM,.1))  S PNODE=^(.1) I '("BO"[$P($G(^(0)),U,3)) Q
"RTN","LR7OGMC",41,0)
 Q:'$D(^LR(LRDFN,LABSUB,IDT,TESTSUB))  Q:'$L($P(^(TESTSUB),U))
"RTN","LR7OGMC",42,0)
 ;
"RTN","LR7OGMC",43,0)
 S PORDER=$P(PNODE,U,6),PORDER=$S(PORDER:PORDER,1:TESTSUB/1000000)
"RTN","LR7OGMC",44,0)
 F  Q:'$D(^TMP("LR7OG",$J,"TP",CDT,PORDER))  Q:TESTNUM=+^(PORDER)  S PORDER=PORDER+1
"RTN","LR7OGMC",45,0)
 ;
"RTN","LR7OGMC",46,0)
 I $D(^TMP("LR7OG",$J,"TP",CDT,PORDER)) Q
"RTN","LR7OGMC",47,0)
 ;
"RTN","LR7OGMC",48,0)
 S LRX=$$TSTRES^LRRPU(LRDFN,LABSUB,IDT,TESTSUB,TESTNUM)
"RTN","LR7OGMC",49,0)
 S ^TMP("LR7OG",$J,"TP",CDT,PORDER)=TESTNUM_U_$P(^LAB(60,TESTNUM,0),U)_U_$P(PNODE,U)_U_$P(PNODE,U,2)_U_$P(PNODE,U,3)_U_$P(^(0),U,5)_U_$P(LRX,U)_U_$P(LRX,U,2)_U_$P(LRX,U,5)_U_$P(LRX,U,3)_$S($P(LRX,U,4)="":"",1:" - "_$P(LRX,U,4))_U_$P(LRX,U,6)
"RTN","LR7OGMC",50,0)
 ;
"RTN","LR7OGMC",51,0)
 ; Save performing lab ien in list
"RTN","LR7OGMC",52,0)
 I $P(LRX,U,6) S ^TMP("LRPLS",$J,$P(LRX,U,6))=""
"RTN","LR7OGMC",53,0)
 ;
"RTN","LR7OGMC",54,0)
 S TCNT=TCNT+1
"RTN","LR7OGMC",55,0)
 I $D(^LAB(60,TESTNUM,1,SPEC,1,0)) D
"RTN","LR7OGMC",56,0)
 . S INTP=0
"RTN","LR7OGMC",57,0)
 . F  S INTP=+$O(^LAB(60,TESTNUM,1,SPEC,1,INTP)) Q:INTP<1  D
"RTN","LR7OGMC",58,0)
 . . S ^TMP("LR7OG",$J,"TP",CDT,PORDER,INTP)=^(INTP,0)
"RTN","LR7OGMC",59,0)
 . . S TCNT=TCNT+1
"RTN","LR7OGMC",60,0)
 Q
"RTN","LR7OGMG")
0^33^B6340321
"RTN","LR7OGMG",1,0)
LR7OGMG ;DALOI/STAFF- Interim report rpc memo grid ; Mar 10, 2003
"RTN","LR7OGMG",2,0)
 ;;5.2;LAB SERVICE;**187,230,286**;Sep 27, 1994
"RTN","LR7OGMG",3,0)
 ;
"RTN","LR7OGMG",4,0)
GRID(OUTCNT) ; from LR7OGMC
"RTN","LR7OGMG",5,0)
 N ACC,AGE,CDT,CMNT,DATA,DOC,FLAG,IDT,INTP,LINE,LRCW,LRX,PORDER,PRNTCODE,RANGE,SEX,SPEC,SUB,TCNT,TESTNAME,TESTNUM
"RTN","LR7OGMG",6,0)
 N UNITS,VALUE,X,ZERO
"RTN","LR7OGMG",7,0)
 ; the variables AGE, SEX, LRCW, and X are used withing the lab's print codes and ref ranges
"RTN","LR7OGMG",8,0)
 S AGE=$P(^TMP("LR7OG",$J,"G"),U,4),SEX=$P(^("G"),U,5),LRCW=$P(^("G"),U,6)
"RTN","LR7OGMG",9,0)
 S CDT=+$O(^TMP("LR7OG",$J,"TP",0)) Q:'CDT
"RTN","LR7OGMG",10,0)
 S IDT=9999999-CDT
"RTN","LR7OGMG",11,0)
 S ZERO=$S($D(^TMP("LR7OG",$J,"TP",CDT))#2:^(CDT),1:"")
"RTN","LR7OGMG",12,0)
 I '$P(ZERO,U,3) Q
"RTN","LR7OGMG",13,0)
 S SPEC=+$P(ZERO,U,5)
"RTN","LR7OGMG",14,0)
 S DOC=$$NAME^LR7OGMP(+$P(ZERO,U,10))
"RTN","LR7OGMG",15,0)
 S ACC=$P(ZERO,U,6)
"RTN","LR7OGMG",16,0)
 S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U,4,6)=SPEC_U_$P($G(^LAB(61,SPEC,0)),U)_U_ACC_U_DOC
"RTN","LR7OGMG",17,0)
 S TCNT=0
"RTN","LR7OGMG",18,0)
 S PORDER=0 F  S PORDER=$O(^TMP("LR7OG",$J,"TP",CDT,PORDER)) Q:PORDER'>0  S DATA=^(PORDER) D
"RTN","LR7OGMG",19,0)
 . I $P(DATA,U,7)="" Q
"RTN","LR7OGMG",20,0)
 . S TCNT=TCNT+1
"RTN","LR7OGMG",21,0)
 . S TESTNUM=+DATA,TESTNAME=$P(DATA,U,2),PRNTCODE=$P(DATA,U,5),SUB=$P(DATA,U,6),FLAG=$P(DATA,U,8),X=$P(DATA,U,7),UNITS=$P(DATA,U,9),RANGE=$P(DATA,U,10)
"RTN","LR7OGMG",22,0)
 . I PRNTCODE="" S VALUE=$J(X,8)
"RTN","LR7OGMG",23,0)
 . E  S @("VALUE="_PRNTCODE)
"RTN","LR7OGMG",24,0)
 . ;D URANGE^LR7OGU(TESTNUM,SPEC,AGE,SEX,.UNITS,.RANGE)
"RTN","LR7OGMG",25,0)
 . S ^TMP("LR7OGX",$J,"OUTPUT",OUTCNT)=TESTNUM_U_TESTNAME_U_VALUE_U_FLAG_U_UNITS_U_RANGE
"RTN","LR7OGMG",26,0)
 . S OUTCNT=OUTCNT+1
"RTN","LR7OGMG",27,0)
 S $P(^TMP("LR7OGX",$J,"OUTPUT",1),U)=TCNT
"RTN","LR7OGMG",28,0)
 S PORDER=0 F  S PORDER=$O(^TMP("LR7OG",$J,"TP",CDT,PORDER)) Q:PORDER'>0  S DATA=^(PORDER) D
"RTN","LR7OGMG",29,0)
 .I $O(^TMP("LR7OG",$J,"TP",CDT,PORDER,0))>0 D
"RTN","LR7OGMG",30,0)
 ..S TESTNAME=$P(DATA,U,3)
"RTN","LR7OGMG",31,0)
 ..S INTP=0 F  S INTP=+$O(^TMP("LR7OG",$J,"TP",CDT,PORDER,INTP)) Q:INTP<1  S LINE=TESTNAME_" Eval: "_^(INTP) D
"RTN","LR7OGMG",32,0)
 ...S ^TMP("LR7OGX",$J,"OUTPUT",OUTCNT)=LINE
"RTN","LR7OGMG",33,0)
 ...S OUTCNT=OUTCNT+1
"RTN","LR7OGMG",34,0)
 I $D(^TMP("LR7OG",$J,"TP",CDT,"C")) D
"RTN","LR7OGMG",35,0)
 .S ^TMP("LR7OGX",$J,"OUTPUT",OUTCNT)="Comment: "
"RTN","LR7OGMG",36,0)
 .S OUTCNT=OUTCNT+1
"RTN","LR7OGMG",37,0)
 .S CMNT=0 F  S CMNT=+$O(^TMP("LR7OG",$J,"TP",CDT,"C",CMNT)) Q:CMNT<1  S LINE=^(CMNT) D
"RTN","LR7OGMG",38,0)
 ..S ^TMP("LR7OGX",$J,"OUTPUT",OUTCNT)="   "_LINE
"RTN","LR7OGMG",39,0)
 ..S OUTCNT=OUTCNT+1
"RTN","LR7OGMG",40,0)
 Q
"RTN","LR7OGMP")
0^34^B12834483
"RTN","LR7OGMP",1,0)
LR7OGMP ;DALOI/STAFF- Interim report rpc memo print ; Mar 10, 2003
"RTN","LR7OGMP",2,0)
 ;;5.2;LAB SERVICE;**187,246,282,286**;Sep 27, 1994
"RTN","LR7OGMP",3,0)
 ;
"RTN","LR7OGMP",4,0)
PRINT(OUTCNT) ; from LR7OGMC
"RTN","LR7OGMP",5,0)
 N ACC,AGE,CDT,CMNT,DATA,DOC,FLAG,HIGH,IDT,INTP,LINE,LOW,LRCW,LRX,PORDER,PRNTCODE,RANGE,REFHIGH,REFLOW,SEX,SITE,SPEC,SUB,TESTNUM
"RTN","LR7OGMP",6,0)
 N TESTSPEC,THER,THERHIGH,THERLOW,UNITS,VALUE,X,ZERO
"RTN","LR7OGMP",7,0)
 ; the variables AGE, SEX, LRCW, and X are used withing the lab's print codes and ref ranges
"RTN","LR7OGMP",8,0)
 S AGE=$P(^TMP("LR7OG",$J,"G"),U,4),SEX=$P(^("G"),U,5),LRCW=$P(^("G"),U,6)
"RTN","LR7OGMP",9,0)
 S CDT=0
"RTN","LR7OGMP",10,0)
 F  S CDT=$O(^TMP("LR7OG",$J,"TP",CDT)) Q:CDT=""  D
"RTN","LR7OGMP",11,0)
 . S IDT=9999999-CDT
"RTN","LR7OGMP",12,0)
 . S ZERO=$S($D(^TMP("LR7OG",$J,"TP",CDT))#2:^(CDT),1:"")
"RTN","LR7OGMP",13,0)
 . I '$P(ZERO,U,3) Q
"RTN","LR7OGMP",14,0)
 . S SPEC=+$P(ZERO,U,5)
"RTN","LR7OGMP",15,0)
 . S DOC=$$NAME(+$P(ZERO,U,10))
"RTN","LR7OGMP",16,0)
 . D SETLINE("",.OUTCNT)
"RTN","LR7OGMP",17,0)
 . D SETLINE("Provider : "_DOC,.OUTCNT)
"RTN","LR7OGMP",18,0)
 . S LINE="  Specimen: "_$P(^LAB(61,SPEC,0),U)_"."
"RTN","LR7OGMP",19,0)
 . S ACC=$P(ZERO,U,6)
"RTN","LR7OGMP",20,0)
 . S LINE=$$SETSTR^VALM1(" "_ACC,LINE,30,1+$L(ACC))
"RTN","LR7OGMP",21,0)
 . D SETLINE(LINE,.OUTCNT)
"RTN","LR7OGMP",22,0)
 . D SETLINE("                              "_$$DD(CDT),.OUTCNT)
"RTN","LR7OGMP",23,0)
 . D SETLINE("     Test name                Result    units      Ref.   range   Site Code",.OUTCNT)
"RTN","LR7OGMP",24,0)
 . S PORDER=0
"RTN","LR7OGMP",25,0)
 . F  S PORDER=$O(^TMP("LR7OG",$J,"TP",CDT,PORDER)) Q:PORDER'>0  S DATA=^(PORDER) D
"RTN","LR7OGMP",26,0)
 .. I $P(DATA,U,7)="" Q
"RTN","LR7OGMP",27,0)
 .. S TESTNUM=+DATA,PRNTCODE=$P(DATA,U,5),SUB=$P(DATA,U,6),FLAG=$P(DATA,U,8),X=$P(DATA,U,7),UNITS=$P(DATA,U,9),RANGE=$P(DATA,U,10),SITE=$P(DATA,U,11)
"RTN","LR7OGMP",28,0)
 .. S LOW=$P(RANGE,"-"),HIGH=$P(RANGE,"-",2),THER=$P(DATA,U,12)
"RTN","LR7OGMP",29,0)
 .. S LINE="     "_$S($L($P(DATA,U,2))>20:$P(DATA,U,3),1:$P(DATA,U,2))
"RTN","LR7OGMP",30,0)
 .. S LINE=$$SETSTR^VALM1("",LINE,28,0)
"RTN","LR7OGMP",31,0)
 .. I PRNTCODE="" S LINE=LINE_$J(X,8)
"RTN","LR7OGMP",32,0)
 .. E  S @("VALUE="_PRNTCODE),LINE=LINE_VALUE
"RTN","LR7OGMP",33,0)
 .. S LINE=LINE_" "_FLAG
"RTN","LR7OGMP",34,0)
 .. I $L(LINE)>38 D SETLINE(LINE,.OUTCNT) S LINE=""
"RTN","LR7OGMP",35,0)
 .. I UNITS'="" S LINE=$$SETSTR^VALM1("  "_UNITS,LINE,39,2+$L(UNITS))
"RTN","LR7OGMP",36,0)
 .. S LRX=$J(LOW,4)_$S(HIGH'="":" - "_$J(HIGH,4),1:"")
"RTN","LR7OGMP",37,0)
 .. I LRX'="" S LINE=$$SETSTR^VALM1(LRX,LINE,52,$L(LRX))
"RTN","LR7OGMP",38,0)
 .. I $L(LINE)>67,SITE D SETLINE(LINE,.OUTCNT) S LINE=""
"RTN","LR7OGMP",39,0)
 .. I SITE S LINE=$$SETSTR^VALM1(" ["_SITE_"]",LINE,68,3+$L(SITE))
"RTN","LR7OGMP",40,0)
 .. I LINE'="" D SETLINE(LINE,.OUTCNT)
"RTN","LR7OGMP",41,0)
 .. I $O(^TMP("LR7OG",$J,"TP",CDT,PORDER,0))>0 D
"RTN","LR7OGMP",42,0)
 ... S INTP=0
"RTN","LR7OGMP",43,0)
 ... F  S INTP=+$O(^TMP("LR7OG",$J,"TP",CDT,PORDER,INTP)) Q:INTP<1  D SETLINE("      Eval: "_^(INTP),.OUTCNT)
"RTN","LR7OGMP",44,0)
 . I $D(^TMP("LR7OG",$J,"TP",CDT,"C")) D
"RTN","LR7OGMP",45,0)
 .. S LINE="Comment: "
"RTN","LR7OGMP",46,0)
 .. S CMNT=0
"RTN","LR7OGMP",47,0)
 .. F  S CMNT=+$O(^TMP("LR7OG",$J,"TP",CDT,"C",CMNT)) Q:CMNT<1  S LINE=LINE_^(CMNT) D
"RTN","LR7OGMP",48,0)
 ... D SETLINE(LINE,.OUTCNT)
"RTN","LR7OGMP",49,0)
 ... I $O(^TMP("LR7OG",$J,"TP",CDT,"C",CMNT)) S LINE="        "
"RTN","LR7OGMP",50,0)
 . D SETLINE("===============================================================================",.OUTCNT)
"RTN","LR7OGMP",51,0)
 Q
"RTN","LR7OGMP",52,0)
 ;
"RTN","LR7OGMP",53,0)
 ;
"RTN","LR7OGMP",54,0)
SETLINE(LINE,CNT) ;
"RTN","LR7OGMP",55,0)
 S ^TMP("LR7OGX",$J,"OUTPUT",CNT)=LINE
"RTN","LR7OGMP",56,0)
 S CNT=CNT+1
"RTN","LR7OGMP",57,0)
 Q
"RTN","LR7OGMP",58,0)
 ;
"RTN","LR7OGMP",59,0)
 ;
"RTN","LR7OGMP",60,0)
NAME(X) ; $$(#) -> name
"RTN","LR7OGMP",61,0)
 N LRDOC
"RTN","LR7OGMP",62,0)
 D DOC^LRX
"RTN","LR7OGMP",63,0)
 Q LRDOC
"RTN","LR7OGMP",64,0)
 ;
"RTN","LR7OGMP",65,0)
 ;
"RTN","LR7OGMP",66,0)
DD(Y) ; $$(date/time) -> date/time format
"RTN","LR7OGMP",67,0)
 D DD^LRX
"RTN","LR7OGMP",68,0)
 Q Y
"RTN","LR7OGMP",69,0)
 ;
"RTN","LR7OGMP",70,0)
 ;
"RTN","LR7OGMP",71,0)
PLS ; List performing laboratories
"RTN","LR7OGMP",72,0)
 ;
"RTN","LR7OGMP",73,0)
 N LINE,LRPLS,X
"RTN","LR7OGMP",74,0)
 D SETLINE("Performing Lab Sites",.OUTCNT)
"RTN","LR7OGMP",75,0)
 S LRPLS=0
"RTN","LR7OGMP",76,0)
 F  S LRPLS=$O(^TMP("LRPLS",$J,LRPLS)) Q:LRPLS<1  D
"RTN","LR7OGMP",77,0)
 . S LINE=$$LJ^XLFSTR("["_LRPLS_"] ",8)_$$NAME^XUAF4(LRPLS)
"RTN","LR7OGMP",78,0)
 . D SETLINE(LINE,.OUTCNT)
"RTN","LR7OGMP",79,0)
 . S X=$$PADD^XUAF4(LRPLS)
"RTN","LR7OGMP",80,0)
 . S LINE=$$REPEAT^XLFSTR(" ",8)_$P(X,U)_"  "_$P(X,U,2)_", "_$P(X,U,3)_" "_$P(X,U,4)
"RTN","LR7OGMP",81,0)
 . D SETLINE(LINE,.OUTCNT)
"RTN","LR7OGMP",82,0)
 ;
"RTN","LR7OGMP",83,0)
 D SETLINE("===============================================================================",.OUTCNT)
"RTN","LR7OGMP",84,0)
 ;
"RTN","LR7OGMP",85,0)
 K ^TMP("LRPLS",$J)
"RTN","LR7OGMP",86,0)
 Q
"RTN","LR7OR2")
0^30^B17139954
"RTN","LR7OR2",1,0)
LR7OR2 ;DALOI/dcm - Get Lab results (cont.) ;8/11/97
"RTN","LR7OR2",2,0)
 ;;5.2;LAB SERVICE;**121,187,219,285,286**;Sep 27, 1994
"RTN","LR7OR2",3,0)
 ;
"RTN","LR7OR2",4,0)
 ;
"RTN","LR7OR2",5,0)
CH(SDATE,EDATE,TEST,COUNT,SPEC,UNVER) ;Get CH subscript data
"RTN","LR7OR2",6,0)
 Q:'$D(SDATE)  Q:'$D(EDATE)  Q:'$D(COUNT)  Q:'$D(CT1)
"RTN","LR7OR2",7,0)
 N GOTIT,IVDT,ITST,IST,TSTY,X,X0,ORD,Y6,Y12,Y16,Y19
"RTN","LR7OR2",8,0)
 I $G(TEST) Q:'$D(^LAB(60,TEST,0))  S X=^(0) Q:$P(X,"^",4)'="CH"  D
"RTN","LR7OR2",9,0)
 . I $L($P(X,"^",5)) S TSTY($P($P(X,"^",5),";",2))=TEST
"RTN","LR7OR2",10,0)
 . I '$L($P(X,"^",5)) D EN^LR7OU1(TEST)
"RTN","LR7OR2",11,0)
 S IVDT=SDATE
"RTN","LR7OR2",12,0)
 F  S IVDT=$O(^LR(LRDFN,"CH",IVDT)) Q:IVDT<1!(IVDT>EDATE)!(CT1>COUNT)  D
"RTN","LR7OR2",13,0)
 . S X0=^LR(LRDFN,"CH",IVDT,0),Y6=$S($P(X0,"^",3):"F",1:"P"),Y12=$P(X0,"^",4),Y19=$P(X0,"^",5),Y16=$P(X0,"^",6),ORD=$$ORD(LRDFN,IVDT)
"RTN","LR7OR2",14,0)
 . S GOTIT=0
"RTN","LR7OR2",15,0)
 . I '$G(UNVER),Y6="P" Q  ;Unverified data not requested
"RTN","LR7OR2",16,0)
 . I $G(SPEC),Y19'=SPEC Q  ;Specimen specified
"RTN","LR7OR2",17,0)
 . I '$D(TSTY) S ITST=1 F  S ITST=$O(^LR(LRDFN,"CH",IVDT,ITST)) Q:ITST<1  S X=^(ITST) D SETTST(ITST,X)
"RTN","LR7OR2",18,0)
 . S IST=0 F  S IST=$O(TSTY(IST)) Q:IST<1  I $D(^LR(LRDFN,"CH",IVDT,IST)) S X=^(IST) D SETTST(IST,X)
"RTN","LR7OR2",19,0)
 . I $O(^TMP("LRRR",$J,DFN,"CH",IVDT,0)) D NOTE(LRDFN,IVDT)
"RTN","LR7OR2",20,0)
 . I GOTIT S CT1=CT1+1
"RTN","LR7OR2",21,0)
 Q
"RTN","LR7OR2",22,0)
 ;
"RTN","LR7OR2",23,0)
 ;
"RTN","LR7OR2",24,0)
SETTST(ISUB,ZERO) ;Set test data in ^TMP
"RTN","LR7OR2",25,0)
 ;ISUB= test subscript
"RTN","LR7OR2",26,0)
 ;ZERO= 0th node at ^LR(LRDFN,"CH",IVDT,TST)
"RTN","LR7OR2",27,0)
 N LRX,X,Y,Y1,Y2,Y3,Y4,Y5,Y9,Y10,Y11,Y14
"RTN","LR7OR2",28,0)
 S X=ZERO,Y1=ISUB,Y1=$O(^LAB(60,"C","CH;"_Y1_";1",0)),Y2=$P(X,"^"),Y3=$P(X,"^",2)
"RTN","LR7OR2",29,0)
 Q:'Y1  Q:"IN"[$P(^LAB(60,Y1,0),"^",3)  S Y15=$P($G(^LAB(60,Y1,.1)),"^")
"RTN","LR7OR2",30,0)
 S (Y9,Y10,Y11,Y14)=""
"RTN","LR7OR2",31,0)
 I $P($G(^LAB(60,Y1,64)),"^") S Y9=$P(^(64),"^"),Y9=$P(^LAM(Y9,0),"^",2),Y10=$P(^(0),"^"),Y11="99NLT"
"RTN","LR7OR2",32,0)
 ;D UNIT^LR7OB63(Y1,$P(X0,"^",5),SEX,DOB,AGE)
"RTN","LR7OR2",33,0)
 S LRX=$$TSTRES^LRRPU(LRDFN,"CH",IVDT,ISUB,Y1)
"RTN","LR7OR2",34,0)
 S Y2=$P(LRX,"^"),Y3=$P(LRX,"^",2),Y4=$P(LRX,"^",5),Y5=$P(LRX,"^",3)_$S($P(LRX,"^",4)'="":"-"_$P(LRX,"^",4),1:"")
"RTN","LR7OR2",35,0)
 I $P(LRX,"^",7) S Y14="T"
"RTN","LR7OR2",36,0)
 S Y2=$$TRIM^XLFSTR($$RESULT^LR7OB63(Y1,Y2),"RL"," ")
"RTN","LR7OR2",37,0)
 S ^TMP("LRRR",$J,DFN,"CH",IVDT,ISUB)=Y1_"^"_Y2_"^"_Y3_"^"_Y4_"^"_Y5_"^"_Y6_"^^^"_Y9_"^"_Y10_"^"_Y11_"^"_Y12_"^^"_Y14_"^"_Y15_"^"_Y16_"^"_$G(ORD)_"^^"_Y19
"RTN","LR7OR2",38,0)
 S GOTIT=1
"RTN","LR7OR2",39,0)
 Q
"RTN","LR7OR2",40,0)
 ;
"RTN","LR7OR2",41,0)
 ;
"RTN","LR7OR2",42,0)
NOTE(LRDFN,IVDT) ;Get comments
"RTN","LR7OR2",43,0)
 N IFN
"RTN","LR7OR2",44,0)
 S IFN=0 F  S IFN=$O(^LR(LRDFN,"CH",IVDT,1,IFN)) Q:IFN<1  S X=^(IFN,0),^TMP("LRRR",$J,DFN,"CH",IVDT,"N",IFN)=X
"RTN","LR7OR2",45,0)
 Q
"RTN","LR7OR2",46,0)
 ;
"RTN","LR7OR2",47,0)
 ;
"RTN","LR7OR2",48,0)
TEST(Y,DFN,ORD,SDATE,EDATE,SUB,TEST,FLAG,COUNT) ;Test network calls
"RTN","LR7OR2",49,0)
 ;Called from TIU
"RTN","LR7OR2",50,0)
 ;COUNT = count of results to send, results with the same date/time
"RTN","LR7OR2",51,0)
 ;   count as 1
"RTN","LR7OR2",52,0)
 N IVDT,SSUB,SEQ,CTR
"RTN","LR7OR2",53,0)
 Q:'$G(DFN)
"RTN","LR7OR2",54,0)
 D RR^LR7OR1(DFN,$G(ORD),$G(SDATE),$G(EDATE),$G(SUB),$G(TEST),$G(FLAG),$G(COUNT))
"RTN","LR7OR2",55,0)
 I '$D(^TMP("LRRR",$J)) S Y(1)="No Lab Data" Q
"RTN","LR7OR2",56,0)
 S CTR=0,SSUB="",COUNT=$S($G(COUNT):COUNT,1:9999999)
"RTN","LR7OR2",57,0)
 F  S SSUB=$O(^TMP("LRRR",$J,DFN,SSUB)) Q:SSUB=""  S IVDT=0 F  S IVDT=$O(^TMP("LRRR",$J,DFN,SSUB,IVDT)) Q:IVDT<1  S SEQ=0 F  S SEQ=$O(^TMP("LRRR",$J,DFN,SSUB,IVDT,SEQ)) Q:SEQ<1  D
"RTN","LR7OR2",58,0)
 . S CTR=CTR+1,^TMP("LRAPI",$J,CTR)=9999999-IVDT_"^"_SSUB_"^"_^TMP("LRRR",$J,DFN,SSUB,IVDT,SEQ)
"RTN","LR7OR2",59,0)
 S Y=$NA(^TMP("LRAPI",$J))
"RTN","LR7OR2",60,0)
 Q
"RTN","LR7OR2",61,0)
 ;
"RTN","LR7OR2",62,0)
 ;
"RTN","LR7OR2",63,0)
T60(Y,IFN) ;Get tests from file 60
"RTN","LR7OR2",64,0)
 ;If IFN is not passed then the whole file is sent.
"RTN","LR7OR2",65,0)
 N CTR S CTR=0
"RTN","LR7OR2",66,0)
 I $D(IFN) Q:'$D(^LAB(60,IFN,0))  S Y(1)=IFN_"^"_$P(^LAB(60,IFN,0),"^") Q
"RTN","LR7OR2",67,0)
 S NAME="" F  S NAME=$O(^LAB(60,"B",NAME)) Q:NAME=""  S IFN=0 F  S IFN=$O(^LAB(60,"B",NAME,IFN)) Q:IFN<1  I $D(^LAB(60,IFN,0)) S CTR=CTR+1,Y(CTR)=IFN_"^"_NAME
"RTN","LR7OR2",68,0)
 Q
"RTN","LR7OR2",69,0)
 ;
"RTN","LR7OR2",70,0)
 ;
"RTN","LR7OR2",71,0)
T64(Y,IFN) ;Get tests from file 64
"RTN","LR7OR2",72,0)
 ;If IFN is not passed then the whole file is sent, if entry has a link to file 60
"RTN","LR7OR2",73,0)
 N CTR S CTR=0
"RTN","LR7OR2",74,0)
 I $D(IFN) Q:'$D(^LAM(IFN,0))  Q:'$D(^LAB(60,"AC",IFN))  S Y(1)=IFN_"^"_$P(^LAM(IFN,0),"^") Q
"RTN","LR7OR2",75,0)
 S NAME="" F  S NAME=$O(^LAM("B",NAME)) Q:NAME=""  S IFN=0 F  S IFN=$O(^LAM("B",NAME,IFN)) Q:IFN<1  I $D(^LAM(IFN,0)),$D(^LAB(60,"AC",IFN)) S CTR=CTR+1,Y(CTR)=IFN_"^"_NAME
"RTN","LR7OR2",76,0)
 Q
"RTN","LR7OR2",77,0)
 ;
"RTN","LR7OR2",78,0)
 ;
"RTN","LR7OR2",79,0)
ORD(LRDFN,IVDT) ;Get order # for entry in file 63
"RTN","LR7OR2",80,0)
 ;LRDFN=Lab Patient #
"RTN","LR7OR2",81,0)
 ;IVDT=Inverse Date/time in 63 (^LR(LRDFN,"CH",IVDT))
"RTN","LR7OR2",82,0)
 Q:'$G(LRDFN)  Q:'$G(IVDT)
"RTN","LR7OR2",83,0)
 N X0,X6,X,AC,ACD,ACN
"RTN","LR7OR2",84,0)
 S X0=$G(^LR(LRDFN,"CH",IVDT,0)),X6=$P(X0,"^",6) I '$L(X6) Q ""
"RTN","LR7OR2",85,0)
 S X=$P(X6," "),X=$O(^LRO(68,"B",X,0)) I 'X Q ""
"RTN","LR7OR2",86,0)
 S AC=X,ACD=+$P(X0,"."),ACN=$P(X6," ",3) I '$D(^LRO(68,AC,1,ACD,1,ACN,0)) Q ""
"RTN","LR7OR2",87,0)
 S X=$P($G(^LRO(68,AC,1,ACD,1,ACN,.1)),"^")
"RTN","LR7OR2",88,0)
 Q X
"RTN","LR7OSUM1")
0^35^B40180103
"RTN","LR7OSUM1",1,0)
LR7OSUM1 ;DALOI/dcm - Silent Patient cum cont. ; Mar 11, 2003
"RTN","LR7OSUM1",2,0)
 ;;5.2;LAB SERVICE;**121,187,256,286**;Sep 27, 1994
"RTN","LR7OSUM1",3,0)
 ;
"RTN","LR7OSUM1",4,0)
LRIDT ; from LR7OSUM
"RTN","LR7OSUM1",5,0)
 F  S LRIDT=$O(^LR(LRDFN,"CH",LRIDT)) Q:LRIDT<1!(LRIDT>LROUT)!(CT1>COUNT)  I $D(^(LRIDT,0)) S X=^(0),CT1=CT1+1 D LRIIDT
"RTN","LR7OSUM1",6,0)
 Q
"RTN","LR7OSUM1",7,0)
 ;
"RTN","LR7OSUM1",8,0)
LRIIDT ;
"RTN","LR7OSUM1",9,0)
 S (LRIIDT,LRVIDT)=$P(X,U,1),LRSUB=1,LRTNN=1,LRSPM=$P(X,U,5),LRTLOC=$E($P(X,U,11),1,7),LRVDT=$P(X,U,3),LRAN=$P(X,U,6)
"RTN","LR7OSUM1",10,0)
 Q:'$L(LRVDT)
"RTN","LR7OSUM1",11,0)
 D LRSUB
"RTN","LR7OSUM1",12,0)
 Q
"RTN","LR7OSUM1",13,0)
 ;
"RTN","LR7OSUM1",14,0)
 ;
"RTN","LR7OSUM1",15,0)
LRSUB ;
"RTN","LR7OSUM1",16,0)
 N LRTRES
"RTN","LR7OSUM1",17,0)
 S LRSUB=1
"RTN","LR7OSUM1",18,0)
 F  S LRSUB=$O(^LR(LRDFN,"CH",LRIDT,LRSUB)) Q:LRSUB<1  D
"RTN","LR7OSUM1",19,0)
 . S X=^LR(LRDFN,"CH",LRIDT,LRSUB)
"RTN","LR7OSUM1",20,0)
 . S LRTRES=$$TSTRES^LRRPU(LRDFN,"CH",LRIDT,LRSUB,"")
"RTN","LR7OSUM1",21,0)
 . D SUB1
"RTN","LR7OSUM1",22,0)
 Q
"RTN","LR7OSUM1",23,0)
SUB1 ;
"RTN","LR7OSUM1",24,0)
 S LRTSTVAL=$P(X,U,1),X1=$P(X,U,2)
"RTN","LR7OSUM1",25,0)
 S LRNOFL="",LRTST=$O(^LAB(60,"C","CH;"_LRSUB_";"_1,0))
"RTN","LR7OSUM1",26,0)
 Q:LRTST=""
"RTN","LR7OSUM1",27,0)
 Q:"IN"[$P(^LAB(60,LRTST,0),U,3)
"RTN","LR7OSUM1",28,0)
 I '$D(^LAB(64.5,"AC",LRSUB)) D MISC Q
"RTN","LR7OSUM1",29,0)
 K LRNON
"RTN","LR7OSUM1",30,0)
 D LRMH
"RTN","LR7OSUM1",31,0)
 I '$D(LRNON) D MISC
"RTN","LR7OSUM1",32,0)
 Q
"RTN","LR7OSUM1",33,0)
 ;
"RTN","LR7OSUM1",34,0)
LRMH ;
"RTN","LR7OSUM1",35,0)
 S LRMH=0
"RTN","LR7OSUM1",36,0)
 F  S LRMH=$O(^LAB(64.5,"AC",LRSUB,1,LRMH)) Q:LRMH<1  D LRSH
"RTN","LR7OSUM1",37,0)
 Q
"RTN","LR7OSUM1",38,0)
 ;
"RTN","LR7OSUM1",39,0)
LRSH ;
"RTN","LR7OSUM1",40,0)
 S LRSH=0
"RTN","LR7OSUM1",41,0)
 F  S LRSH=$O(^LAB(64.5,"AC",LRSUB,1,LRMH,LRSH)) Q:LRSH<1  D TST
"RTN","LR7OSUM1",42,0)
 Q
"RTN","LR7OSUM1",43,0)
 ;
"RTN","LR7OSUM1",44,0)
TST ;
"RTN","LR7OSUM1",45,0)
 S LRTSTS=0
"RTN","LR7OSUM1",46,0)
 F  S LRTSTS=$O(^LAB(64.5,"AC",LRSUB,1,LRMH,LRSH,LRTSTS)) Q:'LRTSTS  S LRSPM1=^(LRTSTS) D TST1
"RTN","LR7OSUM1",47,0)
 Q
"RTN","LR7OSUM1",48,0)
 ;
"RTN","LR7OSUM1",49,0)
 ;
"RTN","LR7OSUM1",50,0)
TST1 ;
"RTN","LR7OSUM1",51,0)
 Q:LRSPM'=LRSPM1
"RTN","LR7OSUM1",52,0)
SBSET ;
"RTN","LR7OSUM1",53,0)
 S LRMHN=$P(^LAB(64.5,1,1,LRMH,0),U,1),LRTF=^(1,LRSH,0),$P(LRTF,U,4)=$P(LRTF,U,3),$P(LRTF,U,3)=$P(^(1,0),U,4),LRNON=1
"RTN","LR7OSUM1",54,0)
 Q:$S('$D(SUBHEAD):0,1:'$D(SUBHEAD($P(LRTF,"^"))))
"RTN","LR7OSUM1",55,0)
 ;
"RTN","LR7OSUM1",56,0)
 ;**  LRTE=Total minor headings
"RTN","LR7OSUM1",57,0)
 ;** LRMHN=Major heading name^TE^Lab performing tests
"RTN","LR7OSUM1",58,0)
 ;**  LRTF=Minor header^Profile specimen^Total tests^Type of display
"RTN","LR7OSUM1",59,0)
 ;
"RTN","LR7OSUM1",60,0)
 S LRIIDT=LRVIDT
"RTN","LR7OSUM1",61,0)
 S:'$D(^TMP($J,LRDFN,LRMH)) ^(LRMH)=LRMHN
"RTN","LR7OSUM1",62,0)
 S:'$D(^TMP($J,LRDFN,LRMH,LRSH))!($D(^(LRSH))=10) ^(LRSH)=LRTF_U
"RTN","LR7OSUM1",63,0)
 S:'$D(^TMP($J,LRDFN,LRMH,LRSH,LRIDT,0)) ^(0)=LRTLOC_U_LRVIDT_U_LRVDT_U_LRAN_U_LRIDT
"RTN","LR7OSUM1",64,0)
 ;
"RTN","LR7OSUM1",65,0)
LRTSTVAL ;
"RTN","LR7OSUM1",66,0)
 ;
"RTN","LR7OSUM1",67,0)
 S ^TMP($J,LRDFN,LRMH,LRSH,LRIDT,LRTSTS)=$P(LRTRES,"^")_"^"_$P(LRTRES,"^",2)
"RTN","LR7OSUM1",68,0)
 S X=$P($G(^LAB(64.5,1,1,LRMH,1,LRSH,1,LRTSTS,0)),"^",3)
"RTN","LR7OSUM1",69,0)
 I $L(X) S ^TMP("LRT",$J,X)=$P(LRTF,"^")
"RTN","LR7OSUM1",70,0)
 I $D(^LR(LRDFN,"CH",LRIDT,1,0)),'$D(^TMP($J,LRDFN,LRMH,LRSH,LRIDT,"TX",0)) D TEXT
"RTN","LR7OSUM1",71,0)
 D CHKUN
"RTN","LR7OSUM1",72,0)
 I $O(^LAB(60,LRTST,1,LRSPM,1,0)),'$D(^TMP($J,"EVAL",LRTST,LRSPM)) D
"RTN","LR7OSUM1",73,0)
 . S ^TMP($J,"EVAL",LRTST,LRSPM)=""
"RTN","LR7OSUM1",74,0)
 . N I,L,X,TST
"RTN","LR7OSUM1",75,0)
 . S I=0,TST=$S($L($P($G(^LAB(60,LRTST,.1)),"^")):$P(^(.1),"^"),1:$P(^LAB(60,LRTST,0),"^"))
"RTN","LR7OSUM1",76,0)
 . S L=+$O(^TMP($J,LRDFN,LRMH,LRSH,LRIDT,"TX",9999999),-1),L=L+1,^TMP($J,LRDFN,LRMH,LRSH,LRIDT,"TX",L,0)="Evaluation for "_TST_":"
"RTN","LR7OSUM1",77,0)
 . F  S I=$O(^LAB(60,LRTST,1,LRSPM,1,I)) Q:'I  S X=^(I,0) S L=L+1,^TMP($J,LRDFN,LRMH,LRSH,LRIDT,"TX",L,0)=X
"RTN","LR7OSUM1",78,0)
 Q
"RTN","LR7OSUM1",79,0)
 ;
"RTN","LR7OSUM1",80,0)
 ;
"RTN","LR7OSUM1",81,0)
MISC ;
"RTN","LR7OSUM1",82,0)
 Q:$S('$D(SUBHEAD):0,1:'$D(SUBHEAD("MISCELLANEOUS TESTS")))
"RTN","LR7OSUM1",83,0)
 S LRTST=$O(^LAB(60,"C","CH;"_LRSUB_";"_1,0))
"RTN","LR7OSUM1",84,0)
 Q:LRTST=""
"RTN","LR7OSUM1",85,0)
 Q:"IN"[$P(^LAB(60,LRTST,0),U,3)
"RTN","LR7OSUM1",86,0)
 S LRTOP=LRSPM
"RTN","LR7OSUM1",87,0)
 ;
"RTN","LR7OSUM1",88,0)
 S:'$D(^TMP($J,LRDFN,"MISC",LRIDT,0)) ^(0)=LRIDT_U_LRVIDT_U_LRVDT_U_LRAN_U_LRSPM
"RTN","LR7OSUM1",89,0)
 ;S ^TMP($J,LRDFN,"MISC",LRIDT,LRTNN)=LRTSTVAL_U_LRSPM_U_LRTST_U_X1_U_LRSUB
"RTN","LR7OSUM1",90,0)
 S ^TMP($J,LRDFN,"MISC",LRIDT,LRTNN)=$P(LRTRES,"^")_U_LRSPM_U_LRTST_U_$P(LRTRES,"^",2)_U_LRSUB_U_$P(LRTRES,"^",3,6)
"RTN","LR7OSUM1",91,0)
 ;
"RTN","LR7OSUM1",92,0)
 S X=$S($D(^LAB(60,LRTST,.1)):$P(^(.1),"^"),1:$P(^LAB(60,LRTST,0),"^")),^TMP("LRT",$J,X)="MISCELLANEOUS TESTS"
"RTN","LR7OSUM1",93,0)
 ;
"RTN","LR7OSUM1",94,0)
 ; Grab specimen comments
"RTN","LR7OSUM1",95,0)
 I $D(^LR(LRDFN,"CH",LRIDT,1,0)),'$D(^TMP($J,LRDFN,"MISC",LRIDT,"TX",0)) D
"RTN","LR7OSUM1",96,0)
 . S ^TMP($J,LRDFN,"MISC",LRIDT,"TX",0)="",L=0
"RTN","LR7OSUM1",97,0)
 . F  S L=$O(^LR(LRDFN,"CH",LRIDT,1,L)) Q:L<1  S ^TMP($J,LRDFN,"MISC",LRIDT,"TX",L,0)=^LR(LRDFN,"CH",LRIDT,1,L,0)
"RTN","LR7OSUM1",98,0)
 ;
"RTN","LR7OSUM1",99,0)
 ; Grab test interpretation
"RTN","LR7OSUM1",100,0)
 I $O(^LAB(60,LRTST,1,LRSPM,1,0)) D
"RTN","LR7OSUM1",101,0)
 . N I,L,X,TST
"RTN","LR7OSUM1",102,0)
 . S I=0,TST=$S($L($P($G(^LAB(60,LRTST,.1)),"^")):$P(^(.1),"^"),1:$P(^LAB(60,LRTST,0),"^"))
"RTN","LR7OSUM1",103,0)
 . S:'$D(^TMP($J,LRDFN,"MISC",LRIDT,"TX",0)) ^TMP($J,LRDFN,"MISC",LRIDT,"TX",0)=""
"RTN","LR7OSUM1",104,0)
 . S L=+$O(^TMP($J,LRDFN,"MISC",LRIDT,"TX",9999999),-1),L=L+1
"RTN","LR7OSUM1",105,0)
 . S ^TMP($J,LRDFN,"MISC",LRIDT,"TX",L,0)="Evaluation for "_TST_":"
"RTN","LR7OSUM1",106,0)
 . F  S I=$O(^LAB(60,LRTST,1,LRSPM,1,I)) Q:'I  S X=^(I,0) S L=L+1,^TMP($J,LRDFN,"MISC",LRIDT,"TX",L,0)=X
"RTN","LR7OSUM1",107,0)
 ;
"RTN","LR7OSUM1",108,0)
 S LRTNN=LRTNN+1
"RTN","LR7OSUM1",109,0)
 Q
"RTN","LR7OSUM1",110,0)
 ;
"RTN","LR7OSUM1",111,0)
 ;
"RTN","LR7OSUM1",112,0)
TEXT ;
"RTN","LR7OSUM1",113,0)
 S LRYESCOM=0
"RTN","LR7OSUM1",114,0)
 S M=0
"RTN","LR7OSUM1",115,0)
 F  S M=$O(^LR(LRDFN,"CH",LRIDT,1,M)) Q:M<1!(LRYESCOM)  F N=1:1:$L(^LR(LRDFN,"CH",LRIDT,1,M,0)) Q:LRYESCOM  S:$E(^(0),N)'[$C(32) LRYESCOM=1
"RTN","LR7OSUM1",116,0)
 Q:'LRYESCOM
"RTN","LR7OSUM1",117,0)
 S L=0
"RTN","LR7OSUM1",118,0)
 F  S L=$O(^LR(LRDFN,"CH",LRIDT,1,L)) Q:L<1  S ^TMP($J,LRDFN,LRMH,LRSH,LRIDT,"TX",L,0)=^LR(LRDFN,"CH",LRIDT,1,L,0)
"RTN","LR7OSUM1",119,0)
 Q
"RTN","LR7OSUM1",120,0)
 ;
"RTN","LR7OSUM1",121,0)
 ;
"RTN","LR7OSUM1",122,0)
MICRO ;from LR7OSUM
"RTN","LR7OSUM1",123,0)
 Q:'$D(^LR(LRDFN,"MI"))
"RTN","LR7OSUM1",124,0)
 N MICROCNT
"RTN","LR7OSUM1",125,0)
 S:'$D(LRUNKNOW) LRUNKNOW=$P(^LAB(69.9,1,1),U,5)
"RTN","LR7OSUM1",126,0)
 S (LRONESPC,LRONETST)="",LREND=0,MICROCNT=GCNT+1
"RTN","LR7OSUM1",127,0)
 I $O(^LR(LRDFN,"MI",0)) S ^TMP("LRH",$J,"MICROBIOLOGY")=MICROCNT
"RTN","LR7OSUM1",128,0)
 S LRWRDVEW="",LRSB=0,LRIDT=LRIN
"RTN","LR7OSUM1",129,0)
 F  S LRIDT=$O(^LR(LRDFN,"MI",LRIDT)) Q:LRIDT<1!(LRIDT>LROUT)!(CT1>COUNT)  S LRNLOC=LRLLOC,CT1=CT1+1 D EN1^LR7OSMZ0 S LRLLOC=LRNLOC
"RTN","LR7OSUM1",130,0)
 I GCNT'>MICROCNT K ^TMP("LRH",$J,"MICROBIOLOGY")
"RTN","LR7OSUM1",131,0)
 K %,A,A1,AGE,B,B1,DFN,DOB,DZ,I,J,LR2ORMOR,LRAA,LRACC,LRACN,LRAD,LRADM,LRADX,LRAFS,LRAX,LRBUG,LRCMNT,LRCS,LRDCOM,LREF,LREND,LRIFN,LRLLT,LRMD,LRNLOC,LRNS,LROK,LRONESPC,LRONETST,LRORG,LRPRE,LRPRINT
"RTN","LR7OSUM1",132,0)
 Q
"RTN","LR7OSUM1",133,0)
 ;
"RTN","LR7OSUM1",134,0)
 ;
"RTN","LR7OSUM1",135,0)
CHKUN ; Check units and normals with cumulative report values
"RTN","LR7OSUM1",136,0)
 ; Add comment if these differ from file #64.5 values
"RTN","LR7OSUM1",137,0)
 ;
"RTN","LR7OSUM1",138,0)
 N I,L,LRFLAG,LRHI,LRLO,LRLOHI,LRX,LRY,TST
"RTN","LR7OSUM1",139,0)
 S LRX=$G(^LAB(64.5,"A",1,LRMH,LRSH,LRTSTS)),LRFLAG=0
"RTN","LR7OSUM1",140,0)
 S TST=$P($G(^LAB(64.5,1,1,LRMH,1,LRSH,1,LRTSTS,0)),"^",3)
"RTN","LR7OSUM1",141,0)
 S LRY="*** For test "_TST
"RTN","LR7OSUM1",142,0)
 ; Check units - if different generate comment
"RTN","LR7OSUM1",143,0)
 I $$UP^XLFSTR($P(LRX,"^",7))'=$$UP^XLFSTR($P(LRTRES,"^",5)) S LRY=LRY_" Units: "_$P(LRTRES,"^",5),LRFLAG=1
"RTN","LR7OSUM1",144,0)
 ;
"RTN","LR7OSUM1",145,0)
 ; Check normals - if different generate comment
"RTN","LR7OSUM1",146,0)
 S @("LRLO="_$S($P(LRX,"^",2)'="":$P(LRX,"^",2),$P(LRX,"^",11)'="":$P(LRX,"^",11),1:""""""))
"RTN","LR7OSUM1",147,0)
 ;
"RTN","LR7OSUM1",148,0)
 S @("LRHI="_$S($P(LRX,"^",3)'="":$P(LRX,"^",3),$P(LRX,"^",12)'="":$P(LRX,"^",12),1:""""""))
"RTN","LR7OSUM1",149,0)
 I LRLO'=$P(LRTRES,"^",3)!(LRHI'=$P(LRTRES,"^",4)) D
"RTN","LR7OSUM1",150,0)
 . I LRFLAG S LRY=LRY_" and"
"RTN","LR7OSUM1",151,0)
 . S LRY=LRY_" Normals: "_$P(LRTRES,"^",3)_"-"_$P(LRTRES,"^",4),LRFLAG=1
"RTN","LR7OSUM1",152,0)
 ;
"RTN","LR7OSUM1",153,0)
 I 'LRFLAG Q
"RTN","LR7OSUM1",154,0)
 ;
"RTN","LR7OSUM1",155,0)
 S L=+$O(^TMP($J,LRDFN,LRMH,LRSH,LRIDT,"TX",9999999),-1),L=L+1
"RTN","LR7OSUM1",156,0)
 S LRY=LRY_" ***",^TMP($J,LRDFN,LRMH,LRSH,LRIDT,"TX",L,0)=LRY
"RTN","LR7OSUM1",157,0)
 Q
"RTN","LR7OSUM6")
0^36^B12942824
"RTN","LR7OSUM6",1,0)
LR7OSUM6 ;DALOI/dcm - Silent Patient cum cont. ;Mar 11, 2003
"RTN","LR7OSUM6",2,0)
 ;;5.2;LAB SERVICE;**121,201,187,286**;Sep 27, 1994
"RTN","LR7OSUM6",3,0)
 ;
"RTN","LR7OSUM6",4,0)
LRUDT(X) ;Get output date/time
"RTN","LR7OSUM6",5,0)
 N LRTIM,I
"RTN","LR7OSUM6",6,0)
 S LRTIM=$E(X,9,12) F I=0:0 Q:$L(LRTIM)=4  S LRTIM=LRTIM_0
"RTN","LR7OSUM6",7,0)
 S LRTIM=$S(LRTIM?4"0":"     ",1:$E(LRTIM,1,2)_":"_$E(LRTIM,3,4)),LRUDT=$$FMTE^XLFDT($P(X,"."),"5Z")_" "_$J(LRTIM,5)_" "
"RTN","LR7OSUM6",8,0)
 Q LRUDT
"RTN","LR7OSUM6",9,0)
 ;
"RTN","LR7OSUM6",10,0)
 ;
"RTN","LR7OSUM6",11,0)
HEAD ;from LR7OSUM3, LR7OSUM4, LR7OSUM5
"RTN","LR7OSUM6",12,0)
 D LRBOT,TOP
"RTN","LR7OSUM6",13,0)
 Q
"RTN","LR7OSUM6",14,0)
 ;
"RTN","LR7OSUM6",15,0)
 ;
"RTN","LR7OSUM6",16,0)
LRBOT ;from LR7OSUM3
"RTN","LR7OSUM6",17,0)
 N L1 D LINE^LR7OSUM4
"RTN","LR7OSUM6",18,0)
Y D LINE^LR7OSUM4
"RTN","LR7OSUM6",19,0)
 Q
"RTN","LR7OSUM6",20,0)
 ;
"RTN","LR7OSUM6",21,0)
 ;
"RTN","LR7OSUM6",22,0)
TOP ;from LR7OSUM3
"RTN","LR7OSUM6",23,0)
 S LRAG=0
"RTN","LR7OSUM6",24,0)
 Q
"RTN","LR7OSUM6",25,0)
 ;
"RTN","LR7OSUM6",26,0)
 ;
"RTN","LR7OSUM6",27,0)
KILL D HEAD Q
"RTN","LR7OSUM6",28,0)
 Q
"RTN","LR7OSUM6",29,0)
 ;
"RTN","LR7OSUM6",30,0)
 ;
"RTN","LR7OSUM6",31,0)
LRMISC S LRFDT=0,LRPG=1 D TOP
"RTN","LR7OSUM6",32,0)
 ;
"RTN","LR7OSUM6",33,0)
MHI S LRMHN=$P(^TMP($J,LRDFN,LRMH),U,1),LRCNT=12 D WR
"RTN","LR7OSUM6",34,0)
 ;
"RTN","LR7OSUM6",35,0)
MDT S LRFDT=$O(^TMP($J,LRDFN,"MISC",LRFDT)) G:LRFDT<1 END
"RTN","LR7OSUM6",36,0)
 S LRUDT=$$LRUDT(9999999-LRFDT) D LRCNT S LRMIT=0
"RTN","LR7OSUM6",37,0)
 ;
"RTN","LR7OSUM6",38,0)
LRMIT S LRMIT=$O(^TMP($J,LRDFN,"MISC",LRFDT,LRMIT)) G:LRMIT="TX" TXT G:LRMIT="" MDT S X=^(LRMIT) G:LRMIT=.1 MSG
"RTN","LR7OSUM6",39,0)
 ;
"RTN","LR7OSUM6",40,0)
 S LRVAL=$P(X,U,1),LRSPE=$P(X,U,2),LRTEST=$P(X,U,3),X1=$P(X,U,4)
"RTN","LR7OSUM6",41,0)
 ;S LRLO="",LRHI=","LRUNT=""
"RTN","LR7OSUM6",42,0)
 S LRLO=$P(X,"^",6),LRHI=$P(X,"^",7),LRUNT=$P(X,"^",8)
"RTN","LR7OSUM6",43,0)
 S LRSPEM=$S($L(LRSPE):$P(^LAB(61,LRSPE,0),U,1),1:"")
"RTN","LR7OSUM6",44,0)
 G:'LRTEST COMM
"RTN","LR7OSUM6",45,0)
 S LRNAME=$P(^LAB(60,LRTEST,.1),U,1)
"RTN","LR7OSUM6",46,0)
 ;S:$L(LRSPE)&($D(^LAB(60,LRTEST,1,LRSPE,0))) X=^(0),@("LRLO="_$S($L($P(X,U,2)):$P(X,U,2),1:"""""")),@("LRHI="_$S($L($P(X,U,3)):$P(X,U,3),1:"""""")),LRUNT=$P(X,U,7)
"RTN","LR7OSUM6",47,0)
 ;
"RTN","LR7OSUM6",48,0)
WR1 D LINE^LR7OSUM4
"RTN","LR7OSUM6",49,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,LRUDT)_$$S^LR7OS(19,CCNT,$E(LRSPEM,1,16))_$$S^LR7OS(37,CCNT,LRNAME_":")_$$S^LR7OS(50,CCNT,LRVAL_" "_X1_"  "_LRUNT)_$$S^LR7OS(67,CCNT,$S($L(LRLO):LRLO_"-"_LRHI,1:""))
"RTN","LR7OSUM6",50,0)
 S:'$P($G(^TMP("LRT",$J,LRNAME)),"^",2) $P(^(LRNAME),"^",2)=GCNT
"RTN","LR7OSUM6",51,0)
 G LRMIT
"RTN","LR7OSUM6",52,0)
 ;
"RTN","LR7OSUM6",53,0)
 ;
"RTN","LR7OSUM6",54,0)
MSG D LINE^LR7OSUM4,LINE^LR7OSUM4
"RTN","LR7OSUM6",55,0)
 X X ;Need to see what is in X
"RTN","LR7OSUM6",56,0)
 G LRMIT
"RTN","LR7OSUM6",57,0)
 ;
"RTN","LR7OSUM6",58,0)
 ;
"RTN","LR7OSUM6",59,0)
COMM D LN
"RTN","LR7OSUM6",60,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"COMMENT: "_LRVAL)
"RTN","LR7OSUM6",61,0)
 G LRMIT
"RTN","LR7OSUM6",62,0)
 ;
"RTN","LR7OSUM6",63,0)
 ;
"RTN","LR7OSUM6",64,0)
WR ;
"RTN","LR7OSUM6",65,0)
 D LINE^LR7OSUM4
"RTN","LR7OSUM6",66,0)
 S X=GIOM/2-($L(LRMHN)/2+5)
"RTN","LR7OSUM6",67,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(X,CCNT,"---- "_LRMHN_" ----"),^TMP("LRH",$J,LRMHN)=GCNT
"RTN","LR7OSUM6",68,0)
 D LINE^LR7OSUM4
"RTN","LR7OSUM6",69,0)
 D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(4,CCNT,"DATE    TIME   SPECIMEN")_$$S^LR7OS(37,CCNT,"TEST")_$$S^LR7OS(50,CCNT,"VALUE")_$$S^LR7OS(64,CCNT,"Ref ranges")
"RTN","LR7OSUM6",70,0)
 D LN S X="",$P(X,"-",GIOM)="",^TMP("LRC",$J,GCNT,0)=X
"RTN","LR7OSUM6",71,0)
 Q
"RTN","LR7OSUM6",72,0)
 ;
"RTN","LR7OSUM6",73,0)
 ;
"RTN","LR7OSUM6",74,0)
TXT S I=0
"RTN","LR7OSUM6",75,0)
 F  S I=$O(^TMP($J,LRDFN,"MISC",LRFDT,"TX",I)) Q:I<1  S GCNT=GCNT+1,^TMP("LRC",$J,GCNT,0)=^(I,0)
"RTN","LR7OSUM6",76,0)
 G LRMIT
"RTN","LR7OSUM6",77,0)
 ;
"RTN","LR7OSUM6",78,0)
 ;
"RTN","LR7OSUM6",79,0)
END S X="",$P(X,"=",GIOM)="",GCNT=GCNT+1,^TMP("LRC",$J,GCNT,0)=X
"RTN","LR7OSUM6",80,0)
 D LRBOT S LRLO=""
"RTN","LR7OSUM6",81,0)
 K LRSB,LRMISC
"RTN","LR7OSUM6",82,0)
 Q
"RTN","LR7OSUM6",83,0)
 ;
"RTN","LR7OSUM6",84,0)
 ;
"RTN","LR7OSUM6",85,0)
PRE ;from LR7OSUM3
"RTN","LR7OSUM6",86,0)
 Q:$D(^TMP($J,LRDFN,"MISC"))'=11
"RTN","LR7OSUM6",87,0)
 S LRMISC=1,LRPG=0,LRMH="MISC"
"RTN","LR7OSUM6",88,0)
 G LRMISC
"RTN","LR7OSUM6",89,0)
 ;
"RTN","LR7OSUM6",90,0)
 ;
"RTN","LR7OSUM6",91,0)
LRCNT ;
"RTN","LR7OSUM6",92,0)
 S LRCNT=0,I=0
"RTN","LR7OSUM6",93,0)
 F  S I=$O(^TMP($J,LRDFN,LRMH,LRFDT,I)) Q:I<1  S LRCNT=LRCNT+1
"RTN","LR7OSUM6",94,0)
 S LRCTN=0
"RTN","LR7OSUM6",95,0)
 I $D(^TMP($J,LRDFN,LRMH,LRFDT,"TX")) D
"RTN","LR7OSUM6",96,0)
 . S J=0
"RTN","LR7OSUM6",97,0)
 . F  S J=$O(^TMP($J,LRDFN,LRMH,LRFDT,"TX",J)) Q:J<1  S LRCTN=LRCTN+1
"RTN","LR7OSUM6",98,0)
 S LRCNT=LRCNT*2+5+LRCTN
"RTN","LR7OSUM6",99,0)
 Q
"RTN","LR7OSUM6",100,0)
 ;
"RTN","LR7OSUM6",101,0)
 ;
"RTN","LR7OSUM6",102,0)
LN ;
"RTN","LR7OSUM6",103,0)
 S CCNT=1,GCNT=GCNT+1
"RTN","LR7OSUM6",104,0)
 Q
"RTN","LRAFUNC")
0^49^B15534938
"RTN","LRAFUNC",1,0)
LRAFUNC ;SLC/MRH/FHS - FUNCTION CALLS A5AFUNC
"RTN","LRAFUNC",2,0)
 ;;5.2;LAB SERVICE;**286**;Sep 27, 1994
"RTN","LRAFUNC",3,0)
 ;
"RTN","LRAFUNC",4,0)
 N I,X
"RTN","LRAFUNC",5,0)
 W !!,"Routine: "_$T(+0),! F I=8:1 S X=$T(LRAFUNC+I) Q:'$L(X)  I X[";;" W !,X
"RTN","LRAFUNC",6,0)
 W !!
"RTN","LRAFUNC",7,0)
 Q
"RTN","LRAFUNC",8,0)
 ;;
"RTN","LRAFUNC",9,0)
UPCASE(X) ;; $$UPCASE(X)
"RTN","LRAFUNC",10,0)
 ;; Call by value
"RTN","LRAFUNC",11,0)
 ;; X in lowercase
"RTN","LRAFUNC",12,0)
 ;; Returns uppercase
"RTN","LRAFUNC",13,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","LRAFUNC",14,0)
 ;;
"RTN","LRAFUNC",15,0)
LOWCASE(X) ;; $$LOWCASE(X)
"RTN","LRAFUNC",16,0)
 ;; Call by value
"RTN","LRAFUNC",17,0)
 ;; X in uppercase 
"RTN","LRAFUNC",18,0)
 ;; Returns lowercase
"RTN","LRAFUNC",19,0)
 Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","LRAFUNC",20,0)
 ;;
"RTN","LRAFUNC",21,0)
STRIP(X,Y) ;; Strips all instances of character 'Y' in string 'X'
"RTN","LRAFUNC",22,0)
 ;; Call by value
"RTN","LRAFUNC",23,0)
 ;; X contains string on which to perform the strip operation
"RTN","LRAFUNC",24,0)
 ;; Y contains character(s) to strip
"RTN","LRAFUNC",25,0)
 Q $TR($G(X),$G(Y),"")
"RTN","LRAFUNC",26,0)
 ;;
"RTN","LRAFUNC",27,0)
REPLACE(STR,X,Y) ;; Performs a character in 'Y' for character
"RTN","LRAFUNC",28,0)
 ;; in 'X' replace within string 'STR'.
"RTN","LRAFUNC",29,0)
 ;; Call by value
"RTN","LRAFUNC",30,0)
 ;; STR is the string on which to perform the replace operation
"RTN","LRAFUNC",31,0)
 ;; X is the characters to replace
"RTN","LRAFUNC",32,0)
 ;; Y is the translated characters
"RTN","LRAFUNC",33,0)
 ;; ** NOTE ** X AND Y MUST BE IN THE EXACT SAME ORDER ****
"RTN","LRAFUNC",34,0)
 ;; X="ABC" Y="XYZ" all occurances of A will be replaced with X
"RTN","LRAFUNC",35,0)
 ;; B with Y and C with Z
"RTN","LRAFUNC",36,0)
 ;; X="AKZ" Y="Z" every occurance of A will be replaced with Z
"RTN","LRAFUNC",37,0)
 ;; and K and Z will be replaced by "" (NULL)
"RTN","LRAFUNC",38,0)
 Q $TR($G(STR),$G(X),$G(Y))
"RTN","LRAFUNC",39,0)
 ;;
"RTN","LRAFUNC",40,0)
REPEAT(X,Y) ;;
"RTN","LRAFUNC",41,0)
 ;; Call by value
"RTN","LRAFUNC",42,0)
 ;; X is the character that you wish repeated
"RTN","LRAFUNC",43,0)
 ;; Y is the number of repetitions
"RTN","LRAFUNC",44,0)
 ;;** NOTE ** $L(X)*Y must not be greater than 254
"RTN","LRAFUNC",45,0)
 ;; eg. S X=$$REPEAT("-",10)  returns "----------"
"RTN","LRAFUNC",46,0)
 N LRPER
"RTN","LRAFUNC",47,0)
 I $L($G(X))*$G(Y)>254 Q ""
"RTN","LRAFUNC",48,0)
 S LRPER="",$P(LRPER,$G(X),+$G(Y)+1)=""
"RTN","LRAFUNC",49,0)
 Q LRPER
"RTN","LRAFUNC",50,0)
 ;;
"RTN","LRAFUNC",51,0)
INVERT(X) ;;
"RTN","LRAFUNC",52,0)
 ;; Call by value
"RTN","LRAFUNC",53,0)
 ;; Returns String in X in inverted order ABC => CBA
"RTN","LRAFUNC",54,0)
 N I,Y
"RTN","LRAFUNC",55,0)
 I $L($G(X))>254 Q ""
"RTN","LRAFUNC",56,0)
 S Y=""
"RTN","LRAFUNC",57,0)
 F I=$L(X):-1:0 S Y=Y_$E(X,I)
"RTN","LRAFUNC",58,0)
 Q Y
"RTN","LRAFUNC",59,0)
 ;;
"RTN","LRAFUNC",60,0)
GLBR(LRR) ;;
"RTN","LRAFUNC",61,0)
 ;; Call by value
"RTN","LRAFUNC",62,0)
 ;; Returns the global root with extended systax if the global
"RTN","LRAFUNC",63,0)
 ;;  is translated. Useful when using $Q on MSM systems
"RTN","LRAFUNC",64,0)
 N LRC,LRF,LRG,LRI,LRR1,LRR2,LRZ
"RTN","LRAFUNC",65,0)
 S LRR1=$P(LRR,"(")_"(" I $E(LRR1)="^" S LRR2=$P($Q(@(LRR1_""""")")),"(")_"(" S:$P(LRR2,"(")]"" LRR1=LRR2
"RTN","LRAFUNC",66,0)
 S LRR2=$P($E(LRR,1,($L(LRR)-($E(LRR,$L(LRR))=")"))),"(",2,99)
"RTN","LRAFUNC",67,0)
 S LRC=$L(LRR2,","),LRF=1 F LRI=1:1:LRC S LRG=$P(LRR2,",",LRF,LRI) Q:LRG=""  D
"RTN","LRAFUNC",68,0)
 . I ($L(LRG,"(")=$L(LRG,")")&($L(LRG,"""")#2))!(($L(LRG,"""")#2)&($E(LRG)="""")&($E(LRG,$L(LRG))="""")) S LRG=$$S(LRG),$P(LRR2,",",LRF,LRI)=LRG,LRF=LRF+$L(LRG,","),LRI=LRF-1
"RTN","LRAFUNC",69,0)
 Q LRR1_LRR2
"RTN","LRAFUNC",70,0)
S(LRZ) ;
"RTN","LRAFUNC",71,0)
 I $G(LRZ)']"" Q ""
"RTN","LRAFUNC",72,0)
 I $E(LRZ)'="""",$L(LRZ,"E")=2,+$P(LRZ,"E")=$P(LRZ,"E"),+$P(LRZ,"E",2)=$P(LRZ,"E",2) Q +LRZ
"RTN","LRAFUNC",73,0)
 I +LRZ=LRZ Q LRZ
"RTN","LRAFUNC",74,0)
 I LRZ="""""" Q ""
"RTN","LRAFUNC",75,0)
 I $E(LRZ)'?1A,"LR$+@"'[$E(LRZ) Q LRZ
"RTN","LRAFUNC",76,0)
 I "+$"[$E(LRZ) X "S LRZ="_LRZ Q $$Q(LRZ)
"RTN","LRAFUNC",77,0)
 I $D(@LRZ) Q $$Q(@LRZ)
"RTN","LRAFUNC",78,0)
 Q LRZ
"RTN","LRAFUNC",79,0)
Q(LRZ) ;
"RTN","LRAFUNC",80,0)
 S LRZ(LRZ)="",LRZ=$Q(LRZ("")) Q $E(LRZ,4,$L(LRZ)-1)
"RTN","LRAFUNC",81,0)
 ;;
"RTN","LRAFUNC",82,0)
 ;;
"RTN","LRAFUNC",83,0)
 Q
"RTN","LRAFUNC",84,0)
LRPNM(X) ;;Call by value
"RTN","LRAFUNC",85,0)
 ;; change value to upper case string
"RTN","LRAFUNC",86,0)
 ;; removes spaces after comma
"RTN","LRAFUNC",87,0)
 ;; removes double spaces and spaces at the end of the string
"RTN","LRAFUNC",88,0)
 ;; generally used to format patient names
"RTN","LRAFUNC",89,0)
 N Y,I
"RTN","LRAFUNC",90,0)
 S X=$$UPCASE(X)
"RTN","LRAFUNC",91,0)
 ; -- no space after comma and no double spaces
"RTN","LRAFUNC",92,0)
 F Y=", ","  " F  Q:'$F(X,Y)  S X=$E(X,1,($F(X,Y)-2))_$E(X,$F(X,Y),$L(X))
"RTN","LRAFUNC",93,0)
 ; -- no space at the end
"RTN","LRAFUNC",94,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,$L(X)-1)
"RTN","LRAFUNC",95,0)
 Q X
"RTN","LRDIDLE0")
0^29^B15196179
"RTN","LRDIDLE0",1,0)
LRDIDLE0 ;DALOI/JMC; Create audit trail of changed values ;Feb 21, 2003
"RTN","LRDIDLE0",2,0)
 ;;5.2;LAB SERVICE;**140,171,153,286**;Sep 27, 1994
"RTN","LRDIDLE0",3,0)
 ; Called by LRVER3
"RTN","LRDIDLE0",4,0)
 ;
"RTN","LRDIDLE0",5,0)
INIT ;
"RTN","LRDIDLE0",6,0)
 ; This code controls the automatic audit trail entries for CH subscripted
"RTN","LRDIDLE0",7,0)
 ; tests which are reported and subsequently changed. Modification of this
"RTN","LRDIDLE0",8,0)
 ; code by local stations may have Medical/Legal ramifications. Local
"RTN","LRDIDLE0",9,0)
 ; stations are STRONGLY advised to NOT make changes.
"RTN","LRDIDLE0",10,0)
 ;
"RTN","LRDIDLE0",11,0)
 N LRCHDT7,LRI,LRJ,LRNEW,LROLD,LRSQ9,LRTXT,LRUSER
"RTN","LRDIDLE0",12,0)
 ;
"RTN","LRDIDLE0",13,0)
 S LRJ=0,LROK=1,LRCHDT7=$$FMTE^XLFDT(LRNOW7,"MZ"),LRUSER=$$USERID(.DUZ)
"RTN","LRDIDLE0",14,0)
 ;
"RTN","LRDIDLE0",15,0)
EVAL ;
"RTN","LRDIDLE0",16,0)
 ;
"RTN","LRDIDLE0",17,0)
 ; Result changed
"RTN","LRDIDLE0",18,0)
 I $P($G(LRSA(LRSB,2)),"^") D
"RTN","LRDIDLE0",19,0)
 . S LRNEW=$P(LRSB(LRSB),"^") S:LRNEW="" LRNEW="<no value>" ; new value
"RTN","LRDIDLE0",20,0)
 . S LROLD=$P(LRSA(LRSB),"^") S:LROLD="" LROLD="<no value>" ; old value
"RTN","LRDIDLE0",21,0)
 . S LRSQ9=LROLD_" by ["_$$USERID($P(LRSA(LRSB),"^",4))_"]" ; old result
"RTN","LRDIDLE0",22,0)
 . S LRJ=LRJ+1,LRTXT(LRJ)=LRSA(LRSB,1)_" reported incorrectly as "_LRSQ9_"."
"RTN","LRDIDLE0",23,0)
 . S LRJ=LRJ+1,LRTXT(LRJ)="Changed to "_LRNEW_" on "_LRCHDT7_" by ["_LRUSER_"]."
"RTN","LRDIDLE0",24,0)
 ;
"RTN","LRDIDLE0",25,0)
 ; Normalcy flag changed
"RTN","LRDIDLE0",26,0)
 I $P($G(LRSA(LRSB,2)),"^",2) D
"RTN","LRDIDLE0",27,0)
 . S LRNEW=$P(LRSB(LRSB),"^",2) S:LRNEW="" LRNEW="normal" ; new value
"RTN","LRDIDLE0",28,0)
 . S LROLD=$P(LRSA(LRSB),"^",2) S:LROLD="" LROLD="normal" ; old value
"RTN","LRDIDLE0",29,0)
 . S LRSQ9=LROLD_" by ["_$$USERID($P(LRSA(LRSB),"^",4))_"]" ; old result
"RTN","LRDIDLE0",30,0)
 . S LRJ=LRJ+1,LRTXT(LRJ)=LRSA(LRSB,1)_" normalcy reported incorrectly as "_LRSQ9_"."
"RTN","LRDIDLE0",31,0)
 . S LRJ=LRJ+1,LRTXT(LRJ)="Changed to "_LRNEW_" on "_LRCHDT7_" by ["_LRUSER_"]."
"RTN","LRDIDLE0",32,0)
 ;
"RTN","LRDIDLE0",33,0)
 ; Check normal ranges
"RTN","LRDIDLE0",34,0)
 I $P($G(LRSA(LRSB,2)),"^",5) D
"RTN","LRDIDLE0",35,0)
 . N LRI,LRX,LRY,LRZ
"RTN","LRDIDLE0",36,0)
 . S LRX=$P(LRSB(LRSB),"^",5),LRY=$P(LRSA(LRSB),"^",5)
"RTN","LRDIDLE0",37,0)
 . ; Units changed
"RTN","LRDIDLE0",38,0)
 . I $P(LRX,"!",7)'=$P(LRY,"!",7) D
"RTN","LRDIDLE0",39,0)
 . . S LRNEW=$P(LRX,"!",7) S:LRNEW="" LRNEW="<no value>" ; new value
"RTN","LRDIDLE0",40,0)
 . . S LROLD=$P(LRY,"!",7) S:LROLD="" LROLD="<no value>" ; old value
"RTN","LRDIDLE0",41,0)
 . . S LRSQ9=LROLD_" by ["_$$USERID($P(LRSA(LRSB),"^",4))_"]" ; old value
"RTN","LRDIDLE0",42,0)
 . . S LRJ=LRJ+1,LRTXT(LRJ)=LRSA(LRSB,1)_" units reported incorrectly as "_LRSQ9_"."
"RTN","LRDIDLE0",43,0)
 . . S LRJ=LRJ+1,LRTXT(LRJ)="Changed to "_LRNEW_" on "_LRCHDT7_" by ["_LRUSER_"]."
"RTN","LRDIDLE0",44,0)
 . ; Reference ranges changed
"RTN","LRDIDLE0",45,0)
 . S LRZ(0)="^reference low^reference high^critical low^critical high^^^^^^therapeutic low^therapeutic high^"
"RTN","LRDIDLE0",46,0)
 . F LRI=2,3,4,5,11,12 I $P(LRX,"!",LRI)'=$P(LRY,"!",LRI) D
"RTN","LRDIDLE0",47,0)
 . . S LRNEW=$P(LRX,"!",LRI) S:LRNEW="" LRNEW="<no value>" ; new value
"RTN","LRDIDLE0",48,0)
 . . S LROLD=$P(LRY,"!",LRI) S:LROLD="" LROLD="<no value>" ; old value
"RTN","LRDIDLE0",49,0)
 . . S LRZ=$P(LRZ(0),"^",LRI)
"RTN","LRDIDLE0",50,0)
 . . S LRSQ9=LROLD_" by ["_$$USERID($P(LRSA(LRSB),"^",4))_"]" ; old value
"RTN","LRDIDLE0",51,0)
 . . S LRJ=LRJ+1,LRTXT(LRJ)=LRSA(LRSB,1)_" "_LRZ_" reported incorrectly as "_LRSQ9_"."
"RTN","LRDIDLE0",52,0)
 . . S LRJ=LRJ+1,LRTXT(LRJ)="Changed to "_LRNEW_" on "_LRCHDT7_" by ["_LRUSER_"]."
"RTN","LRDIDLE0",53,0)
 ;
"RTN","LRDIDLE0",54,0)
 I LRJ D STORE
"RTN","LRDIDLE0",55,0)
 Q
"RTN","LRDIDLE0",56,0)
 ;
"RTN","LRDIDLE0",57,0)
 ;
"RTN","LRDIDLE0",58,0)
STORE ; Store comments in file #63, field #99 COMMENTS
"RTN","LRDIDLE0",59,0)
 ;
"RTN","LRDIDLE0",60,0)
 N DIWF,DIWL,DIWR,LRI,LRJ,LRK,LRX,X
"RTN","LRDIDLE0",61,0)
 ;
"RTN","LRDIDLE0",62,0)
 ; Check comment lengths and if greater than 68 break line
"RTN","LRDIDLE0",63,0)
 S LRI=0
"RTN","LRDIDLE0",64,0)
 F  S LRI=$O(LRTXT(LRI)) Q:'LRI  D
"RTN","LRDIDLE0",65,0)
 . I $L(LRTXT(LRI))<69 Q
"RTN","LRDIDLE0",66,0)
 . S X=LRTXT(LRI),DIWL=1,DIWR=68,DIWF="",LRJ=0
"RTN","LRDIDLE0",67,0)
 . K ^UTILITY($J,"W"),LRTXT(LRI)
"RTN","LRDIDLE0",68,0)
 . D ^DIWP
"RTN","LRDIDLE0",69,0)
 . F  S LRJ=$O(^UTILITY($J,"W",DIWL,LRJ)) Q:'LRJ  D
"RTN","LRDIDLE0",70,0)
 . . S LRK=LRI+(LRJ/100),LRTXT(LRK)=^UTILITY($J,"W",DIWL,LRJ,0)
"RTN","LRDIDLE0",71,0)
 . . I $L(LRTXT(LRK))<68 Q
"RTN","LRDIDLE0",72,0)
 . . F J=69:68:$L(LRTXT(LRK)) S LRTXT(LRK+(J/10000))=$E(LRTXT(LRK),J,J+68)
"RTN","LRDIDLE0",73,0)
 . . S LRTXT(LRK)=$E(LRTXT(LRK),1,68)
"RTN","LRDIDLE0",74,0)
 . K ^UTILITY($J,"W")
"RTN","LRDIDLE0",75,0)
 ;
"RTN","LRDIDLE0",76,0)
 S LRI=0
"RTN","LRDIDLE0",77,0)
 F  S LRI=$O(LRTXT(LRI)) Q:'LRI  D
"RTN","LRDIDLE0",78,0)
 . S LRX=LRTXT(LRI)
"RTN","LRDIDLE0",79,0)
 . D FILECOM^LRVR4(LRDFN,LRIDT,LRX)
"RTN","LRDIDLE0",80,0)
 . W !,LRX
"RTN","LRDIDLE0",81,0)
 ;
"RTN","LRDIDLE0",82,0)
 Q
"RTN","LRDIDLE0",83,0)
 ;
"RTN","LRDIDLE0",84,0)
 ;
"RTN","LRDIDLE0",85,0)
USERID(LRDUZ) ;  Create user id for comment text
"RTN","LRDIDLE0",86,0)
 ;
"RTN","LRDIDLE0",87,0)
 ; Call with DUZ array by reference
"RTN","LRDIDLE0",88,0)
 ;
"RTN","LRDIDLE0",89,0)
 ; Returns   LRY = formatted user id (DUZ-VAxxx) where xxx = VA station #
"RTN","LRDIDLE0",90,0)
 ;
"RTN","LRDIDLE0",91,0)
 N LRY
"RTN","LRDIDLE0",92,0)
 S LRY=LRDUZ
"RTN","LRDIDLE0",93,0)
 ; If agency or facility not passed assumed agency/facility of current user
"RTN","LRDIDLE0",94,0)
 I $G(LRDUZ("AG"))="" S LRDUZ("AG")=DUZ("AG")
"RTN","LRDIDLE0",95,0)
 I '$G(LRDUZ(2)) S LRDUZ(2)=DUZ(2)
"RTN","LRDIDLE0",96,0)
 ;
"RTN","LRDIDLE0",97,0)
 I LRDUZ("AG")="V" S LRY=LRY_"-VA"_$$GET1^DIQ(4,LRDUZ(2)_",",99)
"RTN","LRDIDLE0",98,0)
 Q LRY
"RTN","LRDPAREF")
0^10^B35243910
"RTN","LRDPAREF",1,0)
LRDPAREF ;DALOI/FHS - PENDING ORDER FILE PATIENT LOOKUP ; 12/3/1997
"RTN","LRDPAREF",2,0)
 ;;5.2;LAB SERVICE;**153,222,286**;Sep 27, 1994
"RTN","LRDPAREF",3,0)
 ; Special patient lookup of Lab Orders Pending File
"RTN","LRDPAREF",4,0)
 ;
"RTN","LRDPAREF",5,0)
EN ; From ^LRDPA
"RTN","LRDPAREF",6,0)
 ; Initialize array LRSD.
"RTN","LRDPAREF",7,0)
 ;  CDT=collection date/time
"RTN","LRDPAREF",8,0)
 ;  DFN=ien of patient in selected file
"RTN","LRDPAREF",9,0)
 ;  DOB=patient's date of birth
"RTN","LRDPAREF",10,0)
 ;  DPF=source file (2, or 67)
"RTN","LRDPAREF",11,0)
 ;  ERROR=0
"RTN","LRDPAREF",12,0)
 ;  LPC=longitudinal parity check
"RTN","LRDPAREF",13,0)
 ;  PNM=patient name
"RTN","LRDPAREF",14,0)
 ;  RIEN=IEN of ^LRT(67
"RTN","LRDPAREF",15,0)
 ;  RPSITE=primary sending site
"RTN","LRDPAREF",16,0)
 ;  RSITE=sending site
"RTN","LRDPAREF",17,0)
 ;  RSITEN=sending site name
"RTN","LRDPAREF",18,0)
 ;  RUID=specimen unique identifier
"RTN","LRDPAREF",19,0)
 ;  SEX=patient's sex
"RTN","LRDPAREF",20,0)
 ;  SSN=patient's SSN
"RTN","LRDPAREF",21,0)
 ;  LA7PNM=Patient Bar code read if lookup fails
"RTN","LRDPAREF",22,0)
 ;  On exit LRDPF set to '67^LRT(67, DFN=RIEN
"RTN","LRDPAREF",23,0)
 ;
"RTN","LRDPAREF",24,0)
 N DA,DIC,DIE,DIR,DIRUT,DTOUT,DUOUT
"RTN","LRDPAREF",25,0)
 ;
"RTN","LRDPAREF",26,0)
 K LRSD,LA7PNM
"RTN","LRDPAREF",27,0)
 ;
"RTN","LRDPAREF",28,0)
 F Y="CDT","DFN","DOB","DPF","ERROR","LPC","PNM","RIEN","RPSITE","RSITE","RUID","SEX","SSN" S LRSD(Y)=""
"RTN","LRDPAREF",29,0)
 S LREND=0
"RTN","LRDPAREF",30,0)
 D:'$D(LRLABKY) LABKEY^LRPARAM
"RTN","LRDPAREF",31,0)
 I $G(LRREFBAR) D  Q:$G(LREND)
"RTN","LRDPAREF",32,0)
 . D BAR K LA7PNM
"RTN","LRDPAREF",33,0)
 . I LRSD("ERROR") D
"RTN","LRDPAREF",34,0)
 . . D ERRMSG(LRSD("ERROR"),"Barcode error #")
"RTN","LRDPAREF",35,0)
 . . I +LRSD("ERROR")=1 D CLEAN
"RTN","LRDPAREF",36,0)
 I '$G(LRREFBAR)!(LRSD("ERROR")) D MAN
"RTN","LRDPAREF",37,0)
 I $G(LREND) D CLEAN Q
"RTN","LRDPAREF",38,0)
 I LRSD("ERROR") D  Q
"RTN","LRDPAREF",39,0)
 . I LRSD("ERROR") D ERRMSG(LRSD("ERROR"),"Error #")
"RTN","LRDPAREF",40,0)
 . D CLEAN
"RTN","LRDPAREF",41,0)
 S LRSD("RPSITE")=LRRSITE("RPSITE")
"RTN","LRDPAREF",42,0)
CK ;S PNM=LRSD("PNM"),SSN=LRSD("SSN"),DOB=LRSD("DOB"),SEX=LRSD("SEX"),LRXDPF=LRSD("DPF"),LRXDFN=LRSD("DFN")
"RTN","LRDPAREF",43,0)
 D ^LRDPAREX
"RTN","LRDPAREF",44,0)
 I $G(LREND)!($G(LRSD("ERROR"))) D  G CLEAN
"RTN","LRDPAREF",45,0)
 . S LRSD("ERROR",1)="12^Validation Failure "
"RTN","LRDPAREF",46,0)
 . W !,$C(7),$P(LRSD("ERROR"),"^",2),!
"RTN","LRDPAREF",47,0)
OK ;
"RTN","LRDPAREF",48,0)
 S:'$G(DFN) DFN=-1 S Y=DFN
"RTN","LRDPAREF",49,0)
 I DFN=-1 S LRDFN=-1 K DIC S VA200="" Q
"RTN","LRDPAREF",50,0)
 S X="^"_$P(LRDPF,"^",2)_Y_",""LR"")",LRDFN=+$S($D(@X):@X,1:-1) G E3:LRDFN>0
"RTN","LRDPAREF",51,0)
 L +^LR(0):999999
"RTN","LRDPAREF",52,0)
 S LRDFN=$P(^LR(0),U,3) S:LRDFN<1 LRDFN=1
"RTN","LRDPAREF",53,0)
 F LRDFN=LRDFN:1 Q:'$D(^LR(LRDFN,0))#2
"RTN","LRDPAREF",54,0)
 S ^LR(0)=$P(^LR(0),"^",1,2)_"^"_LRDFN_"^"_(1+$P(^(0),"^",4))
"RTN","LRDPAREF",55,0)
E2 L +^LR(LRDFN):999999
"RTN","LRDPAREF",56,0)
 S ^LR(LRDFN,0)=LRDFN_"^"_+LRDPF_"^"_DFN
"RTN","LRDPAREF",57,0)
 S ^LR("B",LRDFN,LRDFN)=""
"RTN","LRDPAREF",58,0)
 S @X=LRDFN,^LRT(67,LRSD("RIEN"),"LR")=LRDFN
"RTN","LRDPAREF",59,0)
 L -(^LR(0),^LR(LRDFN))
"RTN","LRDPAREF",60,0)
E3 I '$D(^LR(LRDFN,0))#2 D  Q
"RTN","LRDPAREF",61,0)
 . W !!,"Internal patient ID incorrect in ^LR( for ",PNM,"."
"RTN","LRDPAREF",62,0)
 . W !,"Contact Lab Coordinator.",$C(7)
"RTN","LRDPAREF",63,0)
 . S LRDFN=-1
"RTN","LRDPAREF",64,0)
 I LRDFN>0,$P(^LR(LRDFN,0),"^",2)'=+LRDPF!($P(^(0),"^",3)'=DFN) D  Q
"RTN","LRDPAREF",65,0)
 . W !,$C(7),"Internal patient ID incorrect for ",PNM,"."
"RTN","LRDPAREF",66,0)
 . W !,"Contact Lab Coordinator."
"RTN","LRDPAREF",67,0)
 . S LRDFN=-1
"RTN","LRDPAREF",68,0)
 D INF^LRX,PT^LRX
"RTN","LRDPAREF",69,0)
RUID ;
"RTN","LRDPAREF",70,0)
 I LRSD("RUID")="" D
"RTN","LRDPAREF",71,0)
 . N DIR,DIRUT,DTOUT,X,Y
"RTN","LRDPAREF",72,0)
 . ; If VA facility, require 10 character UID.
"RTN","LRDPAREF",73,0)
 . I LRRSITE("RSITE"),$$GET1^DIQ(4,+LRRSITE("RSITE")_",",95,"I")="V" D
"RTN","LRDPAREF",74,0)
 . . S DIR(0)="F^10:10^K:X'?1(10N,1U9N,2U8N,1N1U8N) X"
"RTN","LRDPAREF",75,0)
 . . S DIR("?")="Enter the sending facility's ten character UID for this specimen"
"RTN","LRDPAREF",76,0)
 . E  S DIR(0)="F^1:30",DIR("?")="Enter sending facility's specimen ID, 1-30 characters"
"RTN","LRDPAREF",77,0)
 . S DIR("A")="Enter Remote UID"
"RTN","LRDPAREF",78,0)
 . D ^DIR
"RTN","LRDPAREF",79,0)
 . I $D(DIRUT) D CLEAN Q
"RTN","LRDPAREF",80,0)
 . S LRSD("RUID")=Y
"RTN","LRDPAREF",81,0)
 ;
"RTN","LRDPAREF",82,0)
 Q
"RTN","LRDPAREF",83,0)
DUP W !?5,"There are duplicate SSNs in the Referral File <abort>",!,$C(7)
"RTN","LRDPAREF",84,0)
ERR ;
"RTN","LRDPAREF",85,0)
 S LRDFN=-1 W !,"ERROR",!
"RTN","LRDPAREF",86,0)
 Q
"RTN","LRDPAREF",87,0)
 ;
"RTN","LRDPAREF",88,0)
ERR1 ;
"RTN","LRDPAREF",89,0)
 S LRDFN=-1 W !,"ERROR1",!
"RTN","LRDPAREF",90,0)
 Q
"RTN","LRDPAREF",91,0)
 ;
"RTN","LRDPAREF",92,0)
CLEAN ;
"RTN","LRDPAREF",93,0)
 S LRDFN=-1,LREND=1
"RTN","LRDPAREF",94,0)
 Q
"RTN","LRDPAREF",95,0)
 ;
"RTN","LRDPAREF",96,0)
 ;
"RTN","LRDPAREF",97,0)
BAR ; Scan PD bar code for patient/specimen info
"RTN","LRDPAREF",98,0)
 ;
"RTN","LRDPAREF",99,0)
 N DA,DIC,DIR,DIRUT,DR,DTOUT,DUOUT
"RTN","LRDPAREF",100,0)
 ;
"RTN","LRDPAREF",101,0)
 D PT^LA7SBCR1(.LRSD,"Scan Patient/Accession Barcode (PD)",.LRRSITE)
"RTN","LRDPAREF",102,0)
 I LRSD("ERROR") Q
"RTN","LRDPAREF",103,0)
 D DIQ
"RTN","LRDPAREF",104,0)
 Q
"RTN","LRDPAREF",105,0)
 ;
"RTN","LRDPAREF",106,0)
 ;
"RTN","LRDPAREF",107,0)
MAN ; Manual referral patient lookup
"RTN","LRDPAREF",108,0)
 ;
"RTN","LRDPAREF",109,0)
 N DIR,DIC,DA,X,Y
"RTN","LRDPAREF",110,0)
 K ^DISV(DUZ,"^DPT("),^("^LRT(67,")
"RTN","LRDPAREF",111,0)
 ;
"RTN","LRDPAREF",112,0)
 ; Lookup using file #69.6 if manifest exists and not using bar code scanner
"RTN","LRDPAREF",113,0)
 I '$G(LRREFBAR),$G(LRRSITE("SMID-OK")),LRRSITE("SMID")'="",$D(^LRO(69.6,"D",LRRSITE("SMID"))) D MF696 Q
"RTN","LRDPAREF",114,0)
 ;
"RTN","LRDPAREF",115,0)
 ; Ask user for information
"RTN","LRDPAREF",116,0)
 S LRSD("ERROR")=""
"RTN","LRDPAREF",117,0)
 S DIR(0)="67,3",DIR("A")="Select Patient Name -'^M' To enter New Name "
"RTN","LRDPAREF",118,0)
 D ^DIR
"RTN","LRDPAREF",119,0)
 I $D(DIRUT) S LRSD("ERROR")="1^User timeout/abort or Up-arrow entered"
"RTN","LRDPAREF",120,0)
 I Y["DPT(" D DPTSET^LA7SBCR1(.LRSD,+Y)
"RTN","LRDPAREF",121,0)
 I Y["LRT(" D LRTSET^LA7SBCR1(.LRSD,+Y)
"RTN","LRDPAREF",122,0)
 I $E(X,1,2)="^M" D  Q
"RTN","LRDPAREF",123,0)
 . K DIRUT,DIR
"RTN","LRDPAREF",124,0)
 . D KEYIN^LRDPAREX
"RTN","LRDPAREF",125,0)
 . S:$G(LREND) LRSD("ERROR")="15^Manual Patient entry not complete"
"RTN","LRDPAREF",126,0)
 I LRSD("ERROR") Q
"RTN","LRDPAREF",127,0)
 D DIQ K DIR
"RTN","LRDPAREF",128,0)
 S DIR(0)="Y",DIR("A")="Is this the correct patient" D ^DIR
"RTN","LRDPAREF",129,0)
 I Y'=1 S LRSD("ERROR")="5^Unsuccessful patient lookup" D CLEAN
"RTN","LRDPAREF",130,0)
 Q
"RTN","LRDPAREF",131,0)
 ;
"RTN","LRDPAREF",132,0)
 ;
"RTN","LRDPAREF",133,0)
MF696 ; Manual lookup of file #69.6
"RTN","LRDPAREF",134,0)
 N DIR,DIC,LAIEN,LRSCN696,X,Y
"RTN","LRDPAREF",135,0)
 S Y=$$FIND1^DIC(64.061,"","OMX","In-Transit","","I $P(^LAB(64.061,Y,0),U,7)=""U""")
"RTN","LRDPAREF",136,0)
 I Y>0 S LRSCN696=+Y
"RTN","LRDPAREF",137,0)
 E  S LRSCN696=""
"RTN","LRDPAREF",138,0)
 S DIR(0)="PO^69.6:NEMQZ"
"RTN","LRDPAREF",139,0)
 S DIR("S")="I $P(^(0),U,10)="_LRSCN696_",$D(^LRO(69.6,""D"",LRRSITE(""SMID""),Y))"
"RTN","LRDPAREF",140,0)
 S DIR("A")="Enter UID of specimen"
"RTN","LRDPAREF",141,0)
 D ^DIR
"RTN","LRDPAREF",142,0)
 I $D(DIRUT) S LREND=1 Q
"RTN","LRDPAREF",143,0)
 S LAIEN=Y,(LA7Y(0),LAIEN(0))=Y(0)
"RTN","LRDPAREF",144,0)
 D GETS^DIQ(69.6,+LAIEN_",","*","IE","LAIEN")
"RTN","LRDPAREF",145,0)
 S LRSD("DPF")="67^LRT(67,"
"RTN","LRDPAREF",146,0)
 S LRSD("PNM")=LAIEN(69.6,+LAIEN_",",.01,"I")
"RTN","LRDPAREF",147,0)
 S LRSD("DOB")=LAIEN(69.6,+LAIEN_",",.03,"I")
"RTN","LRDPAREF",148,0)
 S LRSD("SEX")=LAIEN(69.6,+LAIEN_",",.02,"I")
"RTN","LRDPAREF",149,0)
 S LRSD("RACE")=LAIEN(69.6,+LAIEN_",",.06,"I")
"RTN","LRDPAREF",150,0)
 S LRSD("SSN")=LAIEN(69.6,+LAIEN_",",.09,"I")
"RTN","LRDPAREF",151,0)
 S LRSD("CDT")=LAIEN(69.6,+LAIEN_",",11,"I")
"RTN","LRDPAREF",152,0)
 S (LRRSITE("RPSITE"),LRSD("RPSITE"))=LAIEN(69.6,+LAIEN_",",1,"I")
"RTN","LRDPAREF",153,0)
 S LRSD("RSITE")=LAIEN(69.6,+LAIEN_",",2,"I")
"RTN","LRDPAREF",154,0)
 S LRSD("RSITEN")=$E(LAIEN(69.6,+LAIEN_",",2,"E"),1,19)
"RTN","LRDPAREF",155,0)
 S LRSD("RUID")=LAIEN(69.6,+LAIEN_",",3,"I")
"RTN","LRDPAREF",156,0)
 S LRSD("SMID")=LRRSITE("SMID")
"RTN","LRDPAREF",157,0)
 I LRSD("SSN")="" S LRSD("SSN")=LAIEN(69.6,+LAIEN_",",700.04,"I")
"RTN","LRDPAREF",158,0)
 I LRSD("SSN")="" S LRSD("ERROR")="2^Patient Identifier Absent" Q
"RTN","LRDPAREF",159,0)
 S LRSD("RIEN")=$O(^LRT(67,"C",LRSD("SSN"),0))
"RTN","LRDPAREF",160,0)
 I $G(LRSD("RIEN")),$G(^LRT(67,LRSD("RIEN"),"LR")) S LRSD("LRDFN")=^("LR"),LRSD("DFN")=LRSD("RIEN")
"RTN","LRDPAREF",161,0)
 Q
"RTN","LRDPAREF",162,0)
 ;
"RTN","LRDPAREF",163,0)
 ;
"RTN","LRDPAREF",164,0)
DIQ ; Display patient info
"RTN","LRDPAREF",165,0)
 Q:'$G(LRSD("DFN"))
"RTN","LRDPAREF",166,0)
 N DA,DIC,DX,S
"RTN","LRDPAREF",167,0)
 S DIC=$S(+LRSD("DPF")=2:"^DPT(",+LRSD("DPF")=67:"^LRT(67,",1:"")
"RTN","LRDPAREF",168,0)
 I DIC="" Q
"RTN","LRDPAREF",169,0)
 S DA=LRSD("DFN"),DR=0,S=0
"RTN","LRDPAREF",170,0)
 W @IOF
"RTN","LRDPAREF",171,0)
 D EN^LRDIQ
"RTN","LRDPAREF",172,0)
 Q
"RTN","LRDPAREF",173,0)
 ;
"RTN","LRDPAREF",174,0)
ERRMSG(X,Y) ; Display error message to user
"RTN","LRDPAREF",175,0)
 ; Call with X=error message code^error message text
"RTN","LRDPAREF",176,0)
 ;           Y=message prefix
"RTN","LRDPAREF",177,0)
 S X=Y_$P(LRSD("ERROR"),"^")_" - "_$P(LRSD("ERROR"),"^",2)
"RTN","LRDPAREF",178,0)
 D EN^DDIOL(X,"","!?5")
"RTN","LRDPAREF",179,0)
 Q
"RTN","LRDPAREX")
0^46^B22694113
"RTN","LRDPAREX",1,0)
LRDPAREX ;DALOI/FHS -VALIDATE PENDING ORDER FILE PATIENT LOOKUP ; Feb 18, 2004
"RTN","LRDPAREX",2,0)
 ;;5.2;LAB SERVICE;**153,286**;Sep 27, 1994
"RTN","LRDPAREX",3,0)
 ; Special patient lookup of Lab Orders Pending File
"RTN","LRDPAREX",4,0)
 ; From ^LRDPAREF after patient selection
"RTN","LRDPAREX",5,0)
 ; Initialize array.
"RTN","LRDPAREX",6,0)
 ;  CDT=collection date/time
"RTN","LRDPAREX",7,0)
 ;  DFN=ien of patient in selected file
"RTN","LRDPAREX",8,0)
 ;  DOB=patient's date of birth
"RTN","LRDPAREX",9,0)
 ;  DPF=67^LRT(67,
"RTN","LRDPAREX",10,0)
 ;  LRXDPF=source file (2,67)
"RTN","LRDPAREX",11,0)
 ;  ERROR=0
"RTN","LRDPAREX",12,0)
 ;  PNM=patient name
"RTN","LRDPAREX",13,0)
 ;  RIEN=IEN of ^LRT(67
"RTN","LRDPAREX",14,0)
 ;  RPSITE=primary sending site
"RTN","LRDPAREX",15,0)
 ;  RSITE=sending site
"RTN","LRDPAREX",16,0)
 ;  RSITEN=sending site name
"RTN","LRDPAREX",17,0)
 ;  RUID=specimen unique identifier
"RTN","LRDPAREX",18,0)
 ;  SEX=patient's sex
"RTN","LRDPAREX",19,0)
 ;  SSN=patient's SSN
"RTN","LRDPAREX",20,0)
EN ;
"RTN","LRDPAREX",21,0)
 N DA,DIC,DIE,DIR,DIRUT,DR,DTOUT,DUOUT,DLAYGO
"RTN","LRDPAREX",22,0)
 S PNM=LRSD("PNM"),SSN=LRSD("SSN"),DOB=LRSD("DOB"),SEX=LRSD("SEX")
"RTN","LRDPAREX",23,0)
 ;
"RTN","LRDPAREX",24,0)
 S LRXDPF=LRSD("DPF"),LRXDFN=LRSD("DFN"),LRDPF="67^LRT(67,"
"RTN","LRDPAREX",25,0)
 ;
"RTN","LRDPAREX",26,0)
 I +LRXDPF=67,$G(LRXDFN) D  Q
"RTN","LRDPAREX",27,0)
 . S DFN=LRXDFN
"RTN","LRDPAREX",28,0)
 . D UPDATE
"RTN","LRDPAREX",29,0)
 ;
"RTN","LRDPAREX",30,0)
 I LRSD("RIEN"),'$D(^LRT(67,+LRSD("RIEN"),0))#2 S LRSD("ERROR")="16^Missing pointed to LRT(67,"_LRSD("RIEN")_",0)" Q
"RTN","LRDPAREX",31,0)
 ;
"RTN","LRDPAREX",32,0)
 I LRSD("RIEN") D  Q
"RTN","LRDPAREX",33,0)
 . I +LRXDPF=2,LRXDFN'=$G(^LRT(67,LRSD("RIEN"),"DPT")) S LREND=1,LRSD("ERROR")="10^Database Degrade "
"RTN","LRDPAREX",34,0)
 . I '$G(LREND) D UPDATE
"RTN","LRDPAREX",35,0)
 ;
"RTN","LRDPAREX",36,0)
 I 'LRSD("RIEN") S LRSD("RIEN")=$O(^LRT(67,"C",SSN,0)) I LRSD("RIEN"),$O(^(LRSD("RIEN"))) D DUP Q
"RTN","LRDPAREX",37,0)
 ;
"RTN","LRDPAREX",38,0)
 I LRSD("RIEN") D  Q
"RTN","LRDPAREX",39,0)
 . I '$D(^LRT(67,LRSD("RIEN"),0)) D  Q
"RTN","LRDPAREX",40,0)
 . . K ^LRT(67,"C",SSN,LRSD("RIEN"))
"RTN","LRDPAREX",41,0)
 . . S LRSD("ERROR")="13^Missing Zero Node for "_LRSD("RIEN")_" SSN X Ref Entry Removed"
"RTN","LRDPAREX",42,0)
 . D LINK Q:$G(LREND)
"RTN","LRDPAREX",43,0)
 . I +LRXDPF=2 S X="^"_$P(LRXDPF,"^",2)_LRXDFN_",""LRT"")",@X=LRSD("RIEN")
"RTN","LRDPAREX",44,0)
 ;
"RTN","LRDPAREX",45,0)
 I 'LRSD("RIEN") D SET G ERR:LREND
"RTN","LRDPAREX",46,0)
 S DFN=LRSD("RIEN"),LRDPF="67^LRT(67,"
"RTN","LRDPAREX",47,0)
END ;
"RTN","LRDPAREX",48,0)
 Q
"RTN","LRDPAREX",49,0)
 ;
"RTN","LRDPAREX",50,0)
 ;
"RTN","LRDPAREX",51,0)
SET ;Create new entry in ^LRT(67
"RTN","LRDPAREX",52,0)
 I +$G(LRXDPF)'=67,LRXDFN<1 D  Q
"RTN","LRDPAREX",53,0)
 . S LREND=1,LRSD("ERROR")="14^No LRXDFN defined"
"RTN","LRDPAREX",54,0)
 ;
"RTN","LRDPAREX",55,0)
SET1 N DIC,DIE,DA,Y
"RTN","LRDPAREX",56,0)
 L +^LRT(67,0):999
"RTN","LRDPAREX",57,0)
 S DIC(0)="L",DLAYGO=67
"RTN","LRDPAREX",58,0)
 S X=PNM,DIC="^LRT(67,"
"RTN","LRDPAREX",59,0)
 S DIC("DR")=".01////"_PNM_";.02////"_SEX_";.03////"_DOB_";.09////"_SSN
"RTN","LRDPAREX",60,0)
 I $G(LRSD("RACE"))'="" D RACE
"RTN","LRDPAREX",61,0)
 S:+LRXDPF=2 DIC("DR")=DIC("DR")_";2////"_LRXDFN
"RTN","LRDPAREX",62,0)
 K DD,DO
"RTN","LRDPAREX",63,0)
 D FILE^DICN K DLAYGO
"RTN","LRDPAREX",64,0)
 L -^LRT(67,0)
"RTN","LRDPAREX",65,0)
 I Y<1 S LREND=1,LRSB("ERROR")="11^Failure attempting to add patient to LRT(67)",LRDFN=-1 Q
"RTN","LRDPAREX",66,0)
 S LRSD("RIEN")=+Y S:+LRXDPF=2 ^DPT(LRXDFN,"LRT")=LRSD("RIEN")
"RTN","LRDPAREX",67,0)
 S (DFN,LRSD("RIEN"))=+Y S LRSD("ERROR")=""
"RTN","LRDPAREX",68,0)
 Q
"RTN","LRDPAREX",69,0)
 ;
"RTN","LRDPAREX",70,0)
 ;
"RTN","LRDPAREX",71,0)
LINK ; Create back pointer for existing LRT(67 entries
"RTN","LRDPAREX",72,0)
 N DA,DIC,DIE,DR
"RTN","LRDPAREX",73,0)
 S (DFN,DA)=LRSD("RIEN") L +^LRT(67,DA)
"RTN","LRDPAREX",74,0)
 S DIC(0)="LMN",DIE="^LRT(67,"
"RTN","LRDPAREX",75,0)
 S DR=".01////"_PNM_";.02////"_SEX_";.03////"_DOB_";.09////"_SSN
"RTN","LRDPAREX",76,0)
 I $G(LRSD("RACE"))'="" D RACE
"RTN","LRDPAREX",77,0)
 S:+LRXDPF=2 DR=DR_";2////"_LRXDFN
"RTN","LRDPAREX",78,0)
 S DIC=DIE D ^DIE S LREND=+$G(Y) L -^LRT(67,LRSD("RIEN"))
"RTN","LRDPAREX",79,0)
 I LREND S DFN=-1,LRSD("ERROR")="17^ Unable to link "_LRSD("RIEN") Q
"RTN","LRDPAREX",80,0)
 Q
"RTN","LRDPAREX",81,0)
 ;
"RTN","LRDPAREX",82,0)
 ;
"RTN","LRDPAREX",83,0)
UPDATE ; Store updated demographics
"RTN","LRDPAREX",84,0)
 N DA,DR,DIE,DIC,RACE
"RTN","LRDPAREX",85,0)
 S (DFN,DA)=LRSD("RIEN")
"RTN","LRDPAREX",86,0)
 S DIE="^LRT(67,"
"RTN","LRDPAREX",87,0)
 S DR=".01////"_PNM_";.02////"_SEX_";.03////"_DOB_";.09////"_SSN
"RTN","LRDPAREX",88,0)
 I $G(LRSD("RACE"))'="" D RACE
"RTN","LRDPAREX",89,0)
 D ^DIE S LREND=+$G(Y)
"RTN","LRDPAREX",90,0)
 I LREND S DFN=-1,LRSD("ERROR")="18^Unable to update demographics" Q
"RTN","LRDPAREX",91,0)
 Q
"RTN","LRDPAREX",92,0)
 ;
"RTN","LRDPAREX",93,0)
 ;
"RTN","LRDPAREX",94,0)
ERR1 W !?5,"Error1 ",!
"RTN","LRDPAREX",95,0)
 Q
"RTN","LRDPAREX",96,0)
 ;
"RTN","LRDPAREX",97,0)
ERR W !?5,"Error ",!
"RTN","LRDPAREX",98,0)
 Q
"RTN","LRDPAREX",99,0)
 ;
"RTN","LRDPAREX",100,0)
 ;
"RTN","LRDPAREX",101,0)
DUP ;
"RTN","LRDPAREX",102,0)
 S LRSD("ERROR")="15^Duplicate "_SSN_" SSN nunbers in LRT(67 ",LREND=1
"RTN","LRDPAREX",103,0)
 W !?5,$P(LRSD("ERROR"),U,2)
"RTN","LRDPAREX",104,0)
 Q
"RTN","LRDPAREX",105,0)
 ;
"RTN","LRDPAREX",106,0)
 ;
"RTN","LRDPAREX",107,0)
KEYIN ;
"RTN","LRDPAREX",108,0)
 S LRSD("ERROR")="16^Error During Manual Patient Entry"
"RTN","LRDPAREX",109,0)
 W !!?30,"Manual Referral Patient Entry",!!
"RTN","LRDPAREX",110,0)
 K DIR
"RTN","LRDPAREX",111,0)
 S DIR(0)="F^9:12^K:X?1""-""!(X'?1N.N)!(X?1"" "") X I $D(X),$D(^LRT(67,""C"",X)) W !!?15,X,""  Already Exist"" K X"
"RTN","LRDPAREX",112,0)
 S DIR("A")="Patient ID (SSN)",DIR("?")="Enter New Patient ID Nunber "
"RTN","LRDPAREX",113,0)
 S DIR("?",1)="9-12 Number string '-' character or duplicates are Not allowed"
"RTN","LRDPAREX",114,0)
 D RDDIR Q:LREND
"RTN","LRDPAREX",115,0)
 S (LRSD("SSN"),SSN)=Y,Y=0
"RTN","LRDPAREX",116,0)
 K DIR S DIR(0)="67,.01",DIR("A")="Patient Name"
"RTN","LRDPAREX",117,0)
 D RDDIR Q:LREND  S (LRSD("PNM"),PNM)=Y
"RTN","LRDPAREX",118,0)
 ;
"RTN","LRDPAREX",119,0)
 K DIR S DIR(0)="67,.02" D RDDIR Q:LREND  S (LRSD("SEX"),SEX)=Y
"RTN","LRDPAREX",120,0)
 K DIR S DIR(0)="67,.03" D RDDIR Q:LREND  S (LRSD("DOB"),DOB)=Y
"RTN","LRDPAREX",121,0)
 S (LRXDPF,LRSD("LRXDPF"))="67^LRT(67," D SET1
"RTN","LRDPAREX",122,0)
 Q
"RTN","LRDPAREX",123,0)
 ;
"RTN","LRDPAREX",124,0)
 ;
"RTN","LRDPAREX",125,0)
RDDIR ;
"RTN","LRDPAREX",126,0)
 S LREND=0
"RTN","LRDPAREX",127,0)
 D ^DIR
"RTN","LRDPAREX",128,0)
 S:$D(DUOUT)!($D(DTOUT)) LREND=1 K DIR
"RTN","LRDPAREX",129,0)
 S:Y="" LREND=1
"RTN","LRDPAREX",130,0)
 Q
"RTN","LRDPAREX",131,0)
 ;
"RTN","LRDPAREX",132,0)
 ;
"RTN","LRDPAREX",133,0)
RACE ; Resolve race pointer
"RTN","LRDPAREX",134,0)
 N RACE
"RTN","LRDPAREX",135,0)
 S RACE=""
"RTN","LRDPAREX",136,0)
 I $P(LRSD("RACE"),":",3)="" S RACE=$$CODE2PTR^DGUTL4(+LRSD("RACE"),1,1)
"RTN","LRDPAREX",137,0)
 I $P(LRSD("RACE"),":",3)="HL70005" S RACE=$$CODE2PTR^DGUTL4($P($P(LRSD("RACE"),":"),"-",1,2),1,2)
"RTN","LRDPAREX",138,0)
 I RACE>0 D
"RTN","LRDPAREX",139,0)
 . I $D(DR) S DR=DR_";.06////"_RACE Q
"RTN","LRDPAREX",140,0)
 . I $D(DIC("DR")) S DIC("DR")=DIC("DR")_";.06////"_RACE
"RTN","LRDPAREX",141,0)
 Q
"RTN","LREVENT")
0^47^B8007359
"RTN","LREVENT",1,0)
LREVENT ;DALIO/JMC - Shipping Event X-ref Utility ; [ 05/21/97  2:26 PM ]
"RTN","LREVENT",2,0)
 ;;5.2;LAB SERVICE;**153,286**;Sep 27, 1994
"RTN","LREVENT",3,0)
 Q
"RTN","LREVENT",4,0)
 ;
"RTN","LREVENT",5,0)
ADT ; set logic for ADT x-ref in file 62.85
"RTN","LREVENT",6,0)
 N LRMAN S LRMAN=$P(^LAHM(62.85,DA,0),"^") Q:'$O(^LAHM(62.8,"B",LRMAN,0))
"RTN","LREVENT",7,0)
 S ^LAHM(62.85,"ADT",LRMAN,9999999-X,DA)=""
"RTN","LREVENT",8,0)
 Q
"RTN","LREVENT",9,0)
 ;
"RTN","LREVENT",10,0)
 ;
"RTN","LREVENT",11,0)
KADT ; kill logic for ADT x-ref in file 62.85
"RTN","LREVENT",12,0)
 K ^LAHM(62.85,"ADT",$P(^LAHM(62.85,DA,0),"^"),9999999-X,DA)
"RTN","LREVENT",13,0)
 Q
"RTN","LREVENT",14,0)
 ;
"RTN","LREVENT",15,0)
 ;
"RTN","LREVENT",16,0)
ATST ; set logic for ATST x-ref in file 62.85
"RTN","LREVENT",17,0)
 N LREVDT,LRUID S LREVDT=$P($G(^LAHM(62.85,DA,0)),"^",7) Q:'LREVDT
"RTN","LREVENT",18,0)
 S LRUID=$P(^LAHM(62.85,DA,0),"^") I $D(^LAHM(62.8,LRUID,0)) Q
"RTN","LREVENT",19,0)
 I X S ^LAHM(62.85,"ATST",LRUID,X,9999999-LREVDT,DA)=""
"RTN","LREVENT",20,0)
 Q
"RTN","LREVENT",21,0)
 ;
"RTN","LREVENT",22,0)
 ;
"RTN","LREVENT",23,0)
KATST ; kill logic for ATST x-ref in file 62.85
"RTN","LREVENT",24,0)
 N LREVDT S LREVDT=$P($G(^LAHM(62.85,DA,0)),"^",7) Q:'LREVDT
"RTN","LREVENT",25,0)
 I X K ^LAHM(62.85,"ATST",$P(^LAHM(62.85,DA,0),"^"),X,9999999-LREVDT,DA)
"RTN","LREVENT",26,0)
 Q
"RTN","LREVENT",27,0)
 ;
"RTN","LREVENT",28,0)
 ;
"RTN","LREVENT",29,0)
ATST1 ; set logic for ATST1 x-ref in file 62.85
"RTN","LREVENT",30,0)
 N LRTST,LRUID S LRTST=$P($G(^LAHM(62.85,DA,0)),"^",8) Q:'LRTST
"RTN","LREVENT",31,0)
 S LRUID=$P(^LAHM(62.85,DA,0),"^") I $D(^LAHM(62.8,LRUID,0)) Q
"RTN","LREVENT",32,0)
 S ^LAHM(62.85,"ATST",LRUID,LRTST,9999999-X,DA)=""
"RTN","LREVENT",33,0)
 Q
"RTN","LREVENT",34,0)
 ;
"RTN","LREVENT",35,0)
 ;
"RTN","LREVENT",36,0)
KATST1 ; kill logic for ATST1 x-ref in file 62.85
"RTN","LREVENT",37,0)
 N LRTST S LRTST=$P($G(^LAHM(62.85,DA,0)),"^",8) Q:'LRTST
"RTN","LREVENT",38,0)
 K ^LAHM(62.85,"ATST",$P(^LAHM(62.85,DA,0),"^"),LRTST,9999999-X,DA)
"RTN","LREVENT",39,0)
 Q
"RTN","LREVENT",40,0)
 ;
"RTN","LREVENT",41,0)
 ;
"RTN","LREVENT",42,0)
STATUS(LRUID,LRTSTN,LRMAN) ; return status of referral test
"RTN","LREVENT",43,0)
 ; Call with LRUID = accession's unique identifier (UID)
"RTN","LREVENT",44,0)
 ;          LRTSTN = file #60 test ien
"RTN","LREVENT",45,0)
 ;           LRMAN = manifest shipping #
"RTN","LREVENT",46,0)
 ;
"RTN","LREVENT",47,0)
 ; Returns LREVNT = status of referral testing.
"RTN","LREVENT",48,0)
 ;
"RTN","LREVENT",49,0)
 N LRAA,LRAD,LRAN,LRDA,LREVNT,LRIEN,LRINVDT,X
"RTN","LREVENT",50,0)
 ;
"RTN","LREVENT",51,0)
 S LREVNT=""
"RTN","LREVENT",52,0)
 I LRUID="" Q ""
"RTN","LREVENT",53,0)
 I LRMAN="" D
"RTN","LREVENT",54,0)
 . S X=$Q(^LRO(68,"C",LRUID)) Q:X=""
"RTN","LREVENT",55,0)
 . I $QS(X,3)'=LRUID Q
"RTN","LREVENT",56,0)
 . S LRAA=$QS(X,4),LRAD=$QS(X,5),LRAN=$QS(X,6)
"RTN","LREVENT",57,0)
 . S LRDA=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,"B",LRTSTN,0)) Q:'LRDA
"RTN","LREVENT",58,0)
 . S X=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRDA,0),"^",10) Q:'X
"RTN","LREVENT",59,0)
 . S LRMAN=$P($G(^LAHM(62.8,X,0),"Manifest missing in file #62.8 with ien "_X),"^")
"RTN","LREVENT",60,0)
 ;
"RTN","LREVENT",61,0)
 S LRINVDT=$O(^LAHM(62.85,"ATST",LRUID,LRTSTN,0))
"RTN","LREVENT",62,0)
 I LRINVDT D
"RTN","LREVENT",63,0)
 . S LRIEN=$O(^LAHM(62.85,"ATST",LRUID,LRTSTN,LRINVDT,0))
"RTN","LREVENT",64,0)
 . I 'LRIEN Q
"RTN","LREVENT",65,0)
 . I LRMAN="" S LRMAN=$P(^LAHM(62.85,LRIEN,0),"^",9)
"RTN","LREVENT",66,0)
 . D EVENT
"RTN","LREVENT",67,0)
 ;
"RTN","LREVENT",68,0)
 I 'LRINVDT,LRMAN'="" D
"RTN","LREVENT",69,0)
 . S LRINVDT=$O(^LAHM(62.85,"ADT",LRMAN,0))
"RTN","LREVENT",70,0)
 . I 'LRINVDT Q
"RTN","LREVENT",71,0)
 . S LRIEN=$O(^LAHM(62.85,"ADT",LRMAN,LRINVDT,0))
"RTN","LREVENT",72,0)
 . I LRIEN D EVENT
"RTN","LREVENT",73,0)
 ;
"RTN","LREVENT",74,0)
 Q LREVNT
"RTN","LREVENT",75,0)
 ;
"RTN","LREVENT",76,0)
 ;
"RTN","LREVENT",77,0)
EVENT ;
"RTN","LREVENT",78,0)
 N LRX
"RTN","LREVENT",79,0)
 S LRX=$P(^LAHM(62.85,LRIEN,0),"^",5)
"RTN","LREVENT",80,0)
 I LRX S $P(LREVNT,"^")=$$GET1^DIQ(62.85,LRIEN_",",.05)
"RTN","LREVENT",81,0)
 S LRX=$P(^LAHM(62.85,LRIEN,0),"^",7)
"RTN","LREVENT",82,0)
 I LRX S $P(LREVNT,"^",2)=$$FMTE^XLFDT(LRX,"MZ")
"RTN","LREVENT",83,0)
 S $P(LREVNT,"^",3)=LRMAN
"RTN","LREVENT",84,0)
 Q
"RTN","LRFAST")
0^42^B27602884
"RTN","LRFAST",1,0)
LRFAST ;DALOI/CJS - FAST ENTRY ; Jun 3, 2003
"RTN","LRFAST",2,0)
 ;;5.2;LAB SERVICE;**100,121,201,286**;Sep 27, 1994
"RTN","LRFAST",3,0)
 K LRLONG,LRNATURE
"RTN","LRFAST",4,0)
 S LRLONG=""
"RTN","LRFAST",5,0)
 D ^LRPARAM
"RTN","LRFAST",6,0)
SHORT S LRPANEL=0,LROUTINE=$P(^LAB(69.9,1,3),U,2),LRPTP=-1 I '$D(LRLONG) W !,"BYPASSING ORDER ENTRY!!",$C(7)
"RTN","LRFAST",7,0)
 I $D(^LAB(69.9,1,"RO")),+$H'=^("RO") W $C(7),!,"ROLLOVER ",$S($P(^("RO"),U,2):"IS RUNNING.",1:"HAS NOT RUN.")," ACCESSIONING SHOULDN'T BE DONE NOW.",$C(7),!,"  Are you sure you want to continue"
"RTN","LRFAST",8,0)
 I $T S %=2 D YN^DICN W:%=0 !,"Not sure?" I %'=1 W !,"OK, try later." Q
"RTN","LRFAST",9,0)
 S X=$$SELPL^LRVERA(DUZ(2))
"RTN","LRFAST",10,0)
 I X<1 D QUIT Q
"RTN","LRFAST",11,0)
 I X'=DUZ(2) N LRPL S LRPL=X
"RTN","LRFAST",12,0)
 ;
"RTN","LRFAST",13,0)
SH W !,"Do you want to enter draw times" S %=2 D YN^DICN S LRADT=(%=1) Q:%=-1
"RTN","LRFAST",14,0)
 I %=0 W !,"If you answer 'yes', you will be asked for the approximate time the specimen",!,"was taken from the patient.  Otherwise, the current time will be assumed." G SH
"RTN","LRFAST",15,0)
AMIS ;
"RTN","LRFAST",16,0)
 S U="^",(Y,LRNT)=$$NOW^XLFDT,LRODT=DT,LRAD=DT,LRIDT=9999999-Y,LRCDT=Y_"^1",LRSAMP="" K DFN,DIC S DIC(0)="EMQ"_$S($P(LRPARAM,U,6):"L",1:"") D ^LRDPA G:(LRDFN=-1)!$D(DUOUT)!$D(DTOUT) QUIT
"RTN","LRFAST",17,0)
 S:'$D(^LRO(69,LRODT,0)) ^(0)=$P(^LRO(69,0),U,1,2)_U_LRODT_U_(1+$P(^(0),U,4)),^LRO(69,LRODT,0)=LRODT,^LRO(69,"B",LRODT,LRODT)="" S %H=$H-60 D YMD^LRX S LRTM60=9999999-X
"RTN","LRFAST",18,0)
QSN1 D PT^LRX G:$G(LREND) QUIT K DR S LRLLOC=$S($L(LRWRD):LRWRD,$D(^LR(LRDFN,.1)):^(.1),1:"UNKNOWN") D:$L(LRWRD) DPT^LRWU
"RTN","LRFAST",19,0)
Q12 I $D(LRLONG) D LOC^LRWU G QUIT:LREND
"RTN","LRFAST",20,0)
Q11 D COLTY^LRWU G QUIT:LREND S LRPRAC="" I $D(LRLONG) D PRAC^LRWU1 I LREND W !!,$C(7),"ORDER CANCELED",!! G QUIT
"RTN","LRFAST",21,0)
URG ;
"RTN","LRFAST",22,0)
 S DIC="^LAB(62.05,",DIC(0)="AQE",DIC("S")="I '$P(^(0),U,3)",DIC("B")=$P($G(^LAB(62.05,LROUTINE,0)),U) D ^DIC S LRURG=$S(+Y<1:LROUTINE,1:+Y)
"RTN","LRFAST",23,0)
 S LRNN=1 D ^LROW1 G QUIT:'$D(X3) S S9=LRSPEC
"RTN","LRFAST",24,0)
QSN2 IF LRADT S %DT("A")="DRAW DATE/TIME: ",%DT(0)="-N",%DT="EATPX" D ^%DT K %DT G:Y<0 QUIT S LRCDT=Y_U,LRIDT=9999999-Y G QSN2:Y<1
"RTN","LRFAST",25,0)
 D NEW^LROR6() I $G(LRNATURE)=-1 W !!,$C(7),"...process aborted" S %="^" K LRNATURE Q
"RTN","LRFAST",26,0)
 S LRSNO=LRDFN_U_DUZ_U_LRSAMP_U_LRLWC_U_+LRCDT_U_LRPRAC_U_LRLLOC
"RTN","LRFAST",27,0)
 S LRNCWL=1 D REST^LROW2 K LRNCWL S ^LRO(69,LRODT,1,LRSN,1)=+LRCDT_"^^"_DUZ_"^C^^^^"_DUZ(2),^LRO(69,"AA",+$G(^(.1)),LRODT_"|"_LRSN)=""
"RTN","LRFAST",28,0)
 S LRSPEC=S9,LRTSTS=0,LRNOLABL=1 D ^LRWLST K LRNOLABL Q:'$D(LRAN)
"RTN","LRFAST",29,0)
LROE ;from LROE1
"RTN","LRFAST",30,0)
 S LRLLOC=$P(^LRO(69,LRODT,1,LRSN,0),U,7) S:'$L(LRLLOC) LRLLOC=0 K LROE
"RTN","LRFAST",31,0)
 S I1=0 F  S I1=$O(^LRO(69,LRODT,1,LRSN,2,I1)) Q:I1<1!($G(LREND))  S X=^(I1,0) I $P(X,U,4) S LRAA=$P(X,U,4),LRAN=$P(X,U,5),LRAD=$P(X,U,3) I '$D(LROE(LRAD_LRAA_LRAN)) S LROE(LRAD_LRAA_LRAN)="" D LROE1
"RTN","LRFAST",32,0)
 G QUIT
"RTN","LRFAST",33,0)
 ;
"RTN","LRFAST",34,0)
 ;
"RTN","LRFAST",35,0)
LROE1 S LRX=$G(^LRO(68,LRAA,0))
"RTN","LRFAST",36,0)
 S LRIDIV=$S($L($P(LRX,U,19)):$P(LRX,U,19),1:"CP")
"RTN","LRFAST",37,0)
 D:$P(LRPARAM,U,14)&($P($G(^LRO(68,LRAA,0)),U,16)) ^LRCAPV
"RTN","LRFAST",38,0)
 I $G(LREND) Q
"RTN","LRFAST",39,0)
 ; Check for different performing lab.
"RTN","LRFAST",40,0)
 I $G(LRPL) N LRDUZ S LRDUZ(2)=LRPL
"RTN","LRFAST",41,0)
 ;
"RTN","LRFAST",42,0)
 S LRUID=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,.3),"^")
"RTN","LRFAST",43,0)
 I $P(LRX,U,2)="CH" D ^LRVER1
"RTN","LRFAST",44,0)
 I $P(LRX,U,2)="MI" D
"RTN","LRFAST",45,0)
 . S LRPTP=-1,LRMIDEF=$P(^LAB(69.9,1,1),U,10),LRMIOTH=$P(^(0),U,11)
"RTN","LRFAST",46,0)
 . D PAT1^LRMIEDZ2
"RTN","LRFAST",47,0)
 . K LRMIDEF,LRMIOTH
"RTN","LRFAST",48,0)
 K LRX
"RTN","LRFAST",49,0)
 Q
"RTN","LRFAST",50,0)
 ;
"RTN","LRFAST",51,0)
 ;
"RTN","LRFAST",52,0)
QUIT K ^TMP("LR",$J,"TMP"),%,A,AGE,D1,D2,DFN,DIE,DL,DLAYGO,DOB,DQ,DR,DX,H8,I,J,K,LRAA,LRACC,LRAD,LRADT,LRAN,LRAP,LRCDT,LRCW,LRNATURE,I1
"RTN","LRFAST",53,0)
 K LRCWDT,LRD,LRDAT,LRDEL,LRDFN,LRDPF,LRDV,LRDVF,LREAL,LREDIT,LREND,LRFFLG,LRFP,LRIDT,LRIN,LRINI,LRIX,DIC,LRORD,LRSB
"RTN","LRFAST",54,0)
 K LRLBLBP,LRLCT,LRLDT,LRLLOC,LRLONG,LRMETH,LRNAME,LRNG,LRNG2,LRNG3,LRNG4,LRNG5,LRNP,LRNT,LRNTN,LRNX,LRODT,LROUT,LROUTINE,LROWDT,LROWLE,LRPR,LRPRAC,LRRB,LRPTP,LRSAMP,LRSN,LRSPEC,LRSS,LRSSP,LRST,LRSUB,LRSUM,LRTB,LRTD,LRTEST
"RTN","LRFAST",55,0)
 K LRTN,LRTS,LRTX,LRUNQ,LRURG,LRUSI,LRUSNM,^TMP("LR",$J,"VTO"),LRWL0,LRWLC,LRWRD,LRXD,LRXDH,LRXDP,LRYR,PNM,S,S9,SEX,SSN,T,X,X1,Y,Z,LRACD,LRADDTST,LRAOD,LRBED,LRCSS,LRDTO,LREXEC,LRFLOG,LRGCOM,LRGVP,LRIOZERO,LRNIDT,LROCN,LROID,LROLRDFN
"RTN","LRFAST",56,0)
 K LRCCOM,LRCFL,LRCS,LRCSN,LRCSP,LRCSX,LREXP,LRLWC,LRM,LRMAX,LRNN,LRSNO,LRTSTN,LRTY,LRVF,LRVRM,LRXS,I5,S2,S5,T1,POP,X2,X3,X9,LRORDER,LRORDR,LRORDTIM,LRORIFN,LROSN,LRPER,LRPHSET,LRPLOC,LRSPCDSC,LRSSQ,LRSSX,LRSVSN,LRTEC,LRTJ,LRTP,LRTSTNM
"RTN","LRFAST",57,0)
 K LRTCOM,LRALERT,LROE,LRUR,LRVOL,LRWPC,PNM,LROLLOC,LRTREA,LRMAX2,LRMX,LRCAPLOC,LRCOM,LRXST,LRY,LRJ,LRMA,LRMAX1,LRNOW,LRODTSV,LRPANEL,LRSNSV,LRTNSV,LRCDEF0X,LRDAX,LRNOCODE
"RTN","LRFAST",58,0)
 K LRSUF0
"RTN","LRFAST",59,0)
 D END^LRMIEDZ,^LRORDK ;LROEND^LRORDK
"RTN","LRFAST",60,0)
 D ^LRPARAM Q
"RTN","LRFAST",61,0)
EN D QUIT,^LRORDK,LROEND^LRORDK D ^LRPARAM S LRLONG="" G SHORT
"RTN","LRFAST",62,0)
% R %:DTIME Q:%=""!(%["N")!(%["Y")  W !,"Answer 'Y' or 'N': " G %
"RTN","LRFASTS")
0^43^B12956856
"RTN","LRFASTS",1,0)
LRFASTS ;DALOI/FHS - ENHANCED LRFAST RTN ACCESSION/VERIFY PROCESS ; Jun 3, 2003
"RTN","LRFASTS",2,0)
 ;;5.2;LAB SERVICE;**30,95,121,271,286**;Sep 27, 1994
"RTN","LRFASTS",3,0)
EN ;
"RTN","LRFASTS",4,0)
 N DIC,DIR,DIRUT,DTOUT,DUOUT,LRPER,X,Y
"RTN","LRFASTS",5,0)
 D ^LRPARAM
"RTN","LRFASTS",6,0)
 S LRFASTS=""
"RTN","LRFASTS",7,0)
 I '$D(LRLABKY) W !!?10,"Not authorized to use this option " Q
"RTN","LRFASTS",8,0)
 S LRCW=8,LREND=0,LRPANEL=0
"RTN","LRFASTS",9,0)
 S DIR(0)="YO",DIR("A")="Do you want to review the data before and after you edit",DIR("B")="YES"
"RTN","LRFASTS",10,0)
 D ^DIR
"RTN","LRFASTS",11,0)
 I $D(DIRUT) D QUIT Q
"RTN","LRFASTS",12,0)
 I Y=0 S LRPER=""
"RTN","LRFASTS",13,0)
 S X=$$SELPL^LRVERA(DUZ(2))
"RTN","LRFASTS",14,0)
 I X<1 D QUIT Q
"RTN","LRFASTS",15,0)
 I X'=DUZ(2) N LRPL S LRPL=X
"RTN","LRFASTS",16,0)
 ;
"RTN","LRFASTS",17,0)
 K LRCDEF0,LRCDEF
"RTN","LRFASTS",18,0)
 D ^LRORD
"RTN","LRFASTS",19,0)
 ;
"RTN","LRFASTS",20,0)
QUIT ;
"RTN","LRFASTS",21,0)
 I $D(LRCSQ),'$O(^TMP("LRCAP",LRCSQ,DUZ,0)) K ^TMP("LRCAP",LRCSQ,DUZ),LRCSQ
"RTN","LRFASTS",22,0)
 I $D(LRCSQ),$P(LRPARAM,U,14) D STD^LRCAPV K LRIDIV
"RTN","LRFASTS",23,0)
 ;
"RTN","LRFASTS",24,0)
 K I12,LRCDEF,LRCDEF0,LRCDEF0X,LRCSQ,LRCW,LRFASTS,LRNTN,LRNX,LRPANEL,LRSSCX,LRDUF0,LRTEC,LRVF,LRXDP,X9,%,L1,LRAD,LREND,LRSN,QUOUT
"RTN","LRFASTS",25,0)
 K LRAL,LRALL,LRCAPMS,LRMA,SEX,S2,T1,AGE,N,D0,D1,DOB,I,LRFASTS,LRSLOW,DIR,X3,LRORDXS,LRADXS,LRSNXS,LRWP,LRWPC
"RTN","LRFASTS",26,0)
 K LRALERT,LRCSQQ,LRT,LRNOW,LRODTSV,LRSNSV,LRSUF0,LRTSNV,NOW,LRI,LRTNSV
"RTN","LRFASTS",27,0)
 ; ORVP,ORIFN Killed for OE/RR 2.5
"RTN","LRFASTS",28,0)
 K ORVP,ORIFN
"RTN","LRFASTS",29,0)
 ;
"RTN","LRFASTS",30,0)
 D SLOWK,^%ZISC
"RTN","LRFASTS",31,0)
 ;
"RTN","LRFASTS",32,0)
 Q
"RTN","LRFASTS",33,0)
 ;
"RTN","LRFASTS",34,0)
 ;
"RTN","LRFASTS",35,0)
LRWU4 ;
"RTN","LRFASTS",36,0)
 N L,LRI,LRADXS,LRSNXS
"RTN","LRFASTS",37,0)
 Q:'$G(LRORD)
"RTN","LRFASTS",38,0)
 S LRORDXS=LRORD,LRADXS=0
"RTN","LRFASTS",39,0)
 F  S LRADXS=$O(^LRO(69,"C",LRORDXS,LRADXS)) Q:LRADXS<1  D
"RTN","LRFASTS",40,0)
 . S LRSNXS=0
"RTN","LRFASTS",41,0)
 . F  S LRSNXS=$O(^LRO(69,"C",LRORDXS,LRADXS,LRSNXS)) Q:LRSNXS<1  D
"RTN","LRFASTS",42,0)
 . . K LRSLOW
"RTN","LRFASTS",43,0)
 . . S LRSN=+LRSNXS,LRAD=+LRADXS,LRORD=+LRORDXS
"RTN","LRFASTS",44,0)
 . . Q:'LRSN!('LRAD)!('$O(^LRO(69,LRAD,1,LRSN,2,0)))
"RTN","LRFASTS",45,0)
 . . S LRI=0
"RTN","LRFASTS",46,0)
 . . F  S LRI=$O(^LRO(69,LRAD,1,LRSN,2,LRI)) Q:LRI<1  D
"RTN","LRFASTS",47,0)
 . . . S L=$G(^LRO(69,LRAD,1,LRSN,2,LRI,0))
"RTN","LRFASTS",48,0)
 . . . I $P(L,U,3),$P(L,U,4),$P(L,U,5) S LRSLOW($P(L,U,3,5))=""
"RTN","LRFASTS",49,0)
 . . S LRI=""
"RTN","LRFASTS",50,0)
 . . F  S LRI=$O(LRSLOW(LRI)) Q:LRI=""  D GO
"RTN","LRFASTS",51,0)
 ;
"RTN","LRFASTS",52,0)
 D SLOWK
"RTN","LRFASTS",53,0)
 Q
"RTN","LRFASTS",54,0)
 ;
"RTN","LRFASTS",55,0)
 ;
"RTN","LRFASTS",56,0)
GO ;
"RTN","LRFASTS",57,0)
 ; Protect variables
"RTN","LRFASTS",58,0)
 N LRAA,LRAD,LRAN,LRADXS,LRSNXS
"RTN","LRFASTS",59,0)
 S LRAD=$P(LRI,U,1),LRAA=$P(LRI,U,2),LRAN=$P(LRI,U,3)
"RTN","LRFASTS",60,0)
 ;
"RTN","LRFASTS",61,0)
 ; Protect subscript variable
"RTN","LRFASTS",62,0)
 N LRI
"RTN","LRFASTS",63,0)
 ;
"RTN","LRFASTS",64,0)
 I $P(LRPARAM,U,14),$P($G(^LRO(68,LRAA,0)),U,16) D ^LRCAPV Q:$G(LREND)
"RTN","LRFASTS",65,0)
 ;
"RTN","LRFASTS",66,0)
 ; Check for different performing lab.
"RTN","LRFASTS",67,0)
 I $G(LRPL) N LRDUZ S LRDUZ(2)=LRPL
"RTN","LRFASTS",68,0)
 ;
"RTN","LRFASTS",69,0)
 D SLOW^LRVER
"RTN","LRFASTS",70,0)
 Q
"RTN","LRFASTS",71,0)
 ;
"RTN","LRFASTS",72,0)
 ;
"RTN","LRFASTS",73,0)
SLOWK ;
"RTN","LRFASTS",74,0)
 K I5,LRCSN,LRORIFN,LRWPC,X4
"RTN","LRFASTS",75,0)
 K K,LRACN,LRACN0,LRDAX,LRDOC,LRCDEF,LRCDEF0
"RTN","LRFASTS",76,0)
 K LRLBL,LRLBLBP,LRLL,LRLWC,LRMACH,LROD0,LROD1,LROD3,LROOS,LRORD,LROSD,LRYR
"RTN","LRFASTS",77,0)
 K LRAA,LRACD,LRAN,LRAOD,LRCAPLOC,LRAOD,LRCDT,LRCFL,LRCODEN,LRCS,LRDAT,LRDEL,LRDFN,LRDPF,LRDV,LRDVF,LREAL,LREDO,LRFFLG,LRFP,LRIDIV,LRIDT,LRIX,LRJ,LRK,LRBLBP,LRLCT,LRLDT,LRLLOC,LRM,LRMAX1
"RTN","LRFASTS",78,0)
 K LRMAX2,LRMAXX,LRMETH,LRMX,LRNAME,LRNOCODE,LROLLOC,LROT,LRPR,LRPRAC,LRRB,LRSAMP,LRSAVE,LRSPN,LRSS,LRSSX,LRST,LRSUB,LRSUM,LRSX,LRSXN,LRTEST,LRTN,LRTREA,LRTS,LRTX,LRTY,LRVRM,LRWL0,LRWLC,LRWRD,LRX,LRXD,LRWRD,SSN
"RTN","LRFASTS",79,0)
 K DR,GLB,H8,L,S5,T,TT
"RTN","LRFASTS",80,0)
 Q
"RTN","LRGP1")
0^38^B17796634
"RTN","LRGP1",1,0)
LRGP1 ;DALOI/CJS/RWF - COMMON PARTS TO INSTRUMENT GROUP VERIFY/CHECK ;5/13/03  13:21
"RTN","LRGP1",2,0)
 ;;5.2;LAB SERVICE;**112,269,286**;Sep 27, 1994
"RTN","LRGP1",3,0)
 ;
"RTN","LRGP1",4,0)
 N %DT,%ZIS,DIC,I,J
"RTN","LRGP1",5,0)
 ;
"RTN","LRGP1",6,0)
 S LRWT="",LREND=0
"RTN","LRGP1",7,0)
 S LRTM60=9999999-$$HTFM^XLFDT($H-$P($G(^LAB(69.9,1,0)),U,7),1)
"RTN","LRGP1",8,0)
 ;
"RTN","LRGP1",9,0)
 S DIC="^LRO(68.2,",DIC(0)="AEMZQ" D ^DIC
"RTN","LRGP1",10,0)
 I Y<1 D LREND Q
"RTN","LRGP1",11,0)
 S LRLL=+Y,LRWT=$P(Y(0),U,8),LRMAXCUP=$P(Y(0),U,4)
"RTN","LRGP1",12,0)
 ;
"RTN","LRGP1",13,0)
 S LRPROF=$O(^LRO(68.2,LRLL,10,0))
"RTN","LRGP1",14,0)
 I LRPROF<1 W !,"No profile defined." D LREND Q
"RTN","LRGP1",15,0)
 ; If multiple profile then ask which profile
"RTN","LRGP1",16,0)
 S B=$O(^LRO(68.2,LRLL,10,LRPROF))
"RTN","LRGP1",17,0)
 I B>0 S DIC="^LRO(68.2,"_LRLL_",10," D ^DIC G LREND:Y<1 S LRPROF=+Y
"RTN","LRGP1",18,0)
 S LRPANEL=$P(^LRO(68.2,LRLL,10,LRPROF,0),U,1),LRLIST=$O(^LRO(68.2,LRLL,1,LRPROF,1,0))
"RTN","LRGP1",19,0)
 ;
"RTN","LRGP1",20,0)
 W !
"RTN","LRGP1",21,0)
 ;
"RTN","LRGP1",22,0)
 ; Select performing laboratory to use
"RTN","LRGP1",23,0)
 I '$D(LRGVP) D
"RTN","LRGP1",24,0)
 . N X,LRX
"RTN","LRGP1",25,0)
 . S X=$P(^LRO(68.2,LRLL,10,LRPROF,0),"^",5)
"RTN","LRGP1",26,0)
 . S LRX=$$SELPL^LRVERA($S(X:X,1:DUZ(2)))
"RTN","LRGP1",27,0)
 . I LRX<1 D LREND Q
"RTN","LRGP1",28,0)
 . I LRX,LRX'=DUZ(2) S LRDUZ(2)=LRX
"RTN","LRGP1",29,0)
 ;
"RTN","LRGP1",30,0)
 D EXPLODE
"RTN","LRGP1",31,0)
 I $O(LRVTS(0))<1 D LREND Q
"RTN","LRGP1",32,0)
 ;
"RTN","LRGP1",33,0)
 S I=0
"RTN","LRGP1",34,0)
 F  S I=$O(LRORD(I)) Q:I<1  S J=LRORD(I),X=$P(^LAB(60,J,0),U,5),LRORD(I)=$P(X,";",2)
"RTN","LRGP1",35,0)
 ;
"RTN","LRGP1",36,0)
 K LRAA
"RTN","LRGP1",37,0)
 I $L($P(^LRO(68.2,LRLL,10,LRPROF,0),U,2)) S LRAA=$P(^(0),U,2),LRNAME=$P(^LRO(68,LRAA,0),U,1)
"RTN","LRGP1",38,0)
 ;
"RTN","LRGP1",39,0)
 I '$D(LRAA) D  Q:LRAA<1
"RTN","LRGP1",40,0)
 . S DIC="^LRO(68,",DIC(0)="AEMOQ"
"RTN","LRGP1",41,0)
 . D ^DIC
"RTN","LRGP1",42,0)
 . S LRAA=+Y,LRNAME=$P(Y,U,2)
"RTN","LRGP1",43,0)
 . I LRAA<1 D LREND
"RTN","LRGP1",44,0)
 I $P(LRPARAM,U,14),$P($G(^LRO(68,LRAA,0)),U,16) D AUTO^LRCAPV
"RTN","LRGP1",45,0)
 I LREND Q
"RTN","LRGP1",46,0)
 ;
"RTN","LRGP1",47,0)
 ; If "VERIFY BY" field empty then ask user
"RTN","LRGP1",48,0)
 I LRWT="" D  Q:LREND
"RTN","LRGP1",49,0)
 . N DA,DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRGP1",50,0)
 . S DIR(0)="68.2,.08"
"RTN","LRGP1",51,0)
 . D ^DIR
"RTN","LRGP1",52,0)
 . I $D(DIRUT) D LREND Q
"RTN","LRGP1",53,0)
 . S LRWT=Y
"RTN","LRGP1",54,0)
 ;
"RTN","LRGP1",55,0)
 D ACC:LRWT="A",TRAY:LRWT="T",MACHSQ:LRWT="M",WRKLST:LRWT="W"
"RTN","LRGP1",56,0)
 Q
"RTN","LRGP1",57,0)
 ;
"RTN","LRGP1",58,0)
 ;
"RTN","LRGP1",59,0)
LREND ;
"RTN","LRGP1",60,0)
 S LREND=1
"RTN","LRGP1",61,0)
 Q
"RTN","LRGP1",62,0)
 ;
"RTN","LRGP1",63,0)
 ;
"RTN","LRGP1",64,0)
ACC ; Select accession date to verify
"RTN","LRGP1",65,0)
 ;
"RTN","LRGP1",66,0)
 N %DT,LRLAN
"RTN","LRGP1",67,0)
 ;
"RTN","LRGP1",68,0)
 S LRVBY=1
"RTN","LRGP1",69,0)
 ; Only ask if verifying, not group printing (LRGP)
"RTN","LRGP1",70,0)
 I '$D(LRGVP) D
"RTN","LRGP1",71,0)
 . S LRVBY=$$SELBY^LRWU4("Verify by")
"RTN","LRGP1",72,0)
 . I LRVBY=0 D LREND
"RTN","LRGP1",73,0)
 I LREND Q
"RTN","LRGP1",74,0)
 I LRVBY=2 Q
"RTN","LRGP1",75,0)
 ;
"RTN","LRGP1",76,0)
 ; Select accession date
"RTN","LRGP1",77,0)
 D ADATE^LRWU
"RTN","LRGP1",78,0)
 I LREND Q
"RTN","LRGP1",79,0)
 ;
"RTN","LRGP1",80,0)
 ; Select starting and ending accession numbers
"RTN","LRGP1",81,0)
 D LRAN^LRWU3
"RTN","LRGP1",82,0)
 I LREND Q
"RTN","LRGP1",83,0)
 S LRFAN=LRFAN-1,LRLIX=LRLAN
"RTN","LRGP1",84,0)
 Q
"RTN","LRGP1",85,0)
 ;
"RTN","LRGP1",86,0)
 ;
"RTN","LRGP1",87,0)
TRAY ; Select starting and ending tray/cup
"RTN","LRGP1",88,0)
 ;
"RTN","LRGP1",89,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRGP1",90,0)
 ;
"RTN","LRGP1",91,0)
 ; Find existing first and last trays on loadlist
"RTN","LRGP1",92,0)
 S LRFTRAY=$O(^LRO(68.2,LRLL,1,0))
"RTN","LRGP1",93,0)
 I 'LRFTRAY S LRFTRAY=1
"RTN","LRGP1",94,0)
 S LRLTRAY=$O(^LRO(68.2,LRLL,1,""),-1)
"RTN","LRGP1",95,0)
 I 'LRLTRAY S LRLTRAY=LRFTRAY
"RTN","LRGP1",96,0)
 ;
"RTN","LRGP1",97,0)
 ; Find existing first and last cups on loadlist
"RTN","LRGP1",98,0)
 S LRFCUP=$O(^LRO(68.2,LRLL,1,LRFTRAY,1,0))
"RTN","LRGP1",99,0)
 I 'LRFCUP S LRFCUP=1
"RTN","LRGP1",100,0)
 S LRLCUP=$O(^LRO(68.2,LRLL,1,LRLTRAY,1,""),-1)
"RTN","LRGP1",101,0)
 I 'LRLCUP S LRLCUP=LRMAXCUP
"RTN","LRGP1",102,0)
 ;
"RTN","LRGP1",103,0)
 S DIR(0)="NO^1:9999999:0",DIR("A")="Starting tray",DIR("B")=1
"RTN","LRGP1",104,0)
 D ^DIR
"RTN","LRGP1",105,0)
 I $D(DIRUT) D LREND Q
"RTN","LRGP1",106,0)
 S LRFTRAY=Y
"RTN","LRGP1",107,0)
 ;
"RTN","LRGP1",108,0)
 S DIR(0)="NO^1:9999999:0",DIR("A")="Starting cup",DIR("B")=1
"RTN","LRGP1",109,0)
 D ^DIR
"RTN","LRGP1",110,0)
 I $D(DIRUT) D LREND Q
"RTN","LRGP1",111,0)
 S LRFCUP=Y
"RTN","LRGP1",112,0)
 ;
"RTN","LRGP1",113,0)
 S DIR(0)="NO^"_LRFTRAY_":"_LRLTRAY_":0",DIR("A")="Ending tray",DIR("B")=LRLTRAY
"RTN","LRGP1",114,0)
 D ^DIR
"RTN","LRGP1",115,0)
 I $D(DIRUT) D LREND Q
"RTN","LRGP1",116,0)
 S LRLTRAY=Y
"RTN","LRGP1",117,0)
 ;
"RTN","LRGP1",118,0)
 S DIR(0)="NO^"_LRFCUP_":"_LRLCUP_":0",DIR("A")="Ending cup",DIR("B")=LRLCUP
"RTN","LRGP1",119,0)
 D ^DIR
"RTN","LRGP1",120,0)
 I $D(DIRUT) D LREND Q
"RTN","LRGP1",121,0)
 S LRLCUP=Y
"RTN","LRGP1",122,0)
 ;
"RTN","LRGP1",123,0)
 Q
"RTN","LRGP1",124,0)
 ;
"RTN","LRGP1",125,0)
 ;
"RTN","LRGP1",126,0)
MACHSQ ; Select starting and ending machine sequence
"RTN","LRGP1",127,0)
 ;
"RTN","LRGP1",128,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRGP1",129,0)
 ;
"RTN","LRGP1",130,0)
 S DIR(0)="NO^1:9999999:0",DIR("A")="Starting sequence number",DIR("B")=1
"RTN","LRGP1",131,0)
 D ^DIR
"RTN","LRGP1",132,0)
 I $D(DIRUT) D LREND Q
"RTN","LRGP1",133,0)
 S LRSQ=Y
"RTN","LRGP1",134,0)
 ;
"RTN","LRGP1",135,0)
 S DIR(0)="NO^1:9999999:0",DIR("A")="Ending sequence number",DIR("B")=9999999
"RTN","LRGP1",136,0)
 D ^DIR
"RTN","LRGP1",137,0)
 I $D(DIRUT) D LREND Q
"RTN","LRGP1",138,0)
 S LRESEQ=Y
"RTN","LRGP1",139,0)
 Q
"RTN","LRGP1",140,0)
 ;
"RTN","LRGP1",141,0)
 ;
"RTN","LRGP1",142,0)
WRKLST ; Select starting and ending worklist numbers
"RTN","LRGP1",143,0)
 ;
"RTN","LRGP1",144,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRGP1",145,0)
 ;
"RTN","LRGP1",146,0)
 S DIR(0)="NO^1:9999999:0",DIR("A")="Starting worklist number",DIR("B")=1
"RTN","LRGP1",147,0)
 D ^DIR
"RTN","LRGP1",148,0)
 I $D(DIRUT) D LREND Q
"RTN","LRGP1",149,0)
 S LRCUP=Y
"RTN","LRGP1",150,0)
 ;
"RTN","LRGP1",151,0)
 S DIR(0)="NO^1:9999999:0",DIR("A")="Ending worklist number",DIR("B")=9999999
"RTN","LRGP1",152,0)
 D ^DIR
"RTN","LRGP1",153,0)
 I $D(DIRUT) D LREND Q
"RTN","LRGP1",154,0)
 S LRECUP=Y
"RTN","LRGP1",155,0)
 Q
"RTN","LRGP1",156,0)
 ;
"RTN","LRGP1",157,0)
 ;
"RTN","LRGP1",158,0)
EXPLODE ;
"RTN","LRGP1",159,0)
 K LRORD
"RTN","LRGP1",160,0)
 D EXPLODE^LRGP2
"RTN","LRGP1",161,0)
 Q
"RTN","LROE")
0^16^B30204534
"RTN","LROE",1,0)
LROE ;DALOI/CJS/FHS-LAB ORDER ENTRY AND ACCESSION ;8/11/97
"RTN","LROE",2,0)
 ;;5.2;LAB SERVICE;**100,121,201,221,263,286**;Sep 27, 1994
"RTN","LROE",3,0)
 K LRORIFN,LRNATURE,LREND,LRORDRR
"RTN","LROE",4,0)
 S LRLWC="WC"
"RTN","LROE",5,0)
 D ^LRPARAM
"RTN","LROE",6,0)
 I $G(LREND) S LREND=0 Q
"RTN","LROE",7,0)
L5 ;
"RTN","LROE",8,0)
NEXT ;from LROE1
"RTN","LROE",9,0)
 K DIR
"RTN","LROE",10,0)
 I $D(LROESTAT) D:$P(LRPARAM,U,14) ^LRCAPV I $G(LREND) K LRLONG,LRPANEL Q
"RTN","LROE",11,0)
 S (LRODT,X,DT)=$$DT^XLFDT(),LRODT0=$$FMTE^XLFDT(DT,5)
"RTN","LROE",12,0)
 I '$D(^LRO(69,DT,1,0)) S ^LRO(69,DT,0)=DT,^LRO(69,DT,1,0)="^69.01PA^^",^LRO(69,"B",DT,DT)=""
"RTN","LROE",13,0)
 I $D(^LAB(69.9,1,"RO")),+$H'=+$P(^("RO"),U) D
"RTN","LROE",14,0)
 . W $C(7),!,"ROLLOVER ",$S($P(^("RO"),U,2):"IS RUNNING.",1:"HAS NOT RUN.")," ACCESSIONING SHOULDN'T BE DONE NOW.",$C(7),!
"RTN","LROE",15,0)
 . S DIR("A")="  Are you sure you want to continue",DIR(0)="Y",DIR("B")="No"
"RTN","LROE",16,0)
 I $T D ^DIR G END:$D(DIRUT) I Y'=1 W !,"OK, try later." Q
"RTN","LROE",17,0)
 S X="T-7",%DT="" D ^%DT S LRTM7=+Y
"RTN","LROE",18,0)
 ;W @IOF
"RTN","LROE",19,0)
 K DIC,LRSND,LRSN
"RTN","LROE",20,0)
 W !!,"Select Order number: " R LRORD:DTIME Q:LRORD["^"!(LRORD[".")!($D(LRLONG)&(LRORD=""))
"RTN","LROE",21,0)
 W @IOF S M9=0 G QUICK^LROE1:LRORD=""
"RTN","LROE",22,0)
 S:LRORD?.N LRORD=+LRORD IF LRORD'?.N D QMSG G NEXT
"RTN","LROE",23,0)
 I '$D(^LRO(69,"C",LRORD)) W !!?10,"No order exist with that number ",$C(7),! G NEXT
"RTN","LROE",24,0)
 S (LRCHK,LRNONE)=1,(M9,LRODT)=0
"RTN","LROE",25,0)
 F  S LRODT=+$O(^LRO(69,"C",LRORD,LRODT)) Q:LRODT<1  D
"RTN","LROE",26,0)
 . S DA=0 F  S DA=$O(^LRO(69,"C",LRORD,LRODT,DA)) Q:DA<1  S LRCHK=LRCHK-1 S:LRNONE'=2 LRNONE=0 D LROE2
"RTN","LROE",27,0)
 I LRNONE=2 W !,"The order has already been",$S(LRCHK<1:" partially",1:"")," accessioned." H 1
"RTN","LROE",28,0)
 I LRNONE=1 W !,"No order exists with that number." H 1 G NEXT
"RTN","LROE",29,0)
 I '$$GOT(LRORD,LRODT) G NEXT ;W !!,"All tests for this order have been canceled.",!,"Are you sure you want to accession it" S %=1 D YN^DICN I %'=1 G NEXT
"RTN","LROE",30,0)
 K DIR S DIR("A")="Is this the correct order",DIR(0)="Y"
"RTN","LROE",31,0)
 S DIR("B")="Yes"
"RTN","LROE",32,0)
 D ^DIR K DIR
"RTN","LROE",33,0)
 I $D(DIRUT)!(Y'=1) K LRSN G NEXT
"RTN","LROE",34,0)
 L +^LRO(69,"C",LRORD):1
"RTN","LROE",35,0)
 I '$T W !?5,"Someone else is editing this Order",!!,$C(7) G NEXT
"RTN","LROE",36,0)
 K %DT
"RTN","LROE",37,0)
 S LRSTATUS="C",%DT("B")=""
"RTN","LROE",38,0)
 D TIME K %DT
"RTN","LROE",39,0)
 D:$G(LRCDT)<1 UNL69 G NEXT:LRCDT<1
"RTN","LROE",40,0)
 S LRTIM=+LRCDT
"RTN","LROE",41,0)
 ;S:'$P(^LRO(69,LRODT,1,LRSN,0),U,8) $P(^(0),U,8)=LRTIM
"RTN","LROE",42,0)
 S LRUN=$P(LRCDT,U,2) K LRCDT,LRSN
"RTN","LROE",43,0)
MORE I M9>1 K DIR S DIR("A")="Do you have the entire order",DIR(0)="Y" D ^DIR K DIR S:Y=1 M9=0
"RTN","LROE",44,0)
 I $D(DIRUT) D UNL69 G NEXT
"RTN","LROE",45,0)
 S (LRODT,LRSND)=0
"RTN","LROE",46,0)
 F  S LRODT=$O(^LRO(69,"C",LRORD,LRODT)) Q:LRODT<1  D
"RTN","LROE",47,0)
 . S LRSND=0
"RTN","LROE",48,0)
 . F  S LRSND=$O(^LRO(69,"C",LRORD,LRODT,LRSND)) Q:LRSND<1  D
"RTN","LROE",49,0)
 . . S LRSN(LRSND)=LRSND,LRSN=LRSND
"RTN","LROE",50,0)
 . . K LRAA D Q15^LROE2 K LRSN
"RTN","LROE",51,0)
 D TASK,UNL69
"RTN","LROE",52,0)
 G NEXT
"RTN","LROE",53,0)
 ;
"RTN","LROE",54,0)
 ;
"RTN","LROE",55,0)
LROE2 ;
"RTN","LROE",56,0)
 I $D(^LRO(69,LRODT,1,DA,1)),$P(^(1),U,4)="C" S LRNONE=2,LRCHK=LRCHK+1
"RTN","LROE",57,0)
 K LRSN
"RTN","LROE",58,0)
 S (LRSN,LRSN(DA))=+DA
"RTN","LROE",59,0)
 I '$D(^LRO(69,LRODT,1,LRSN,0)) Q
"RTN","LROE",60,0)
 S M9=$G(M9)+1,LRZX=^LRO(69,LRODT,1,LRSN,0),LRDFN=+LRZX,LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3) D PT^LRX W !,PNM,?30,SSN S LRWRDS=LRWRD
"RTN","LROE",61,0)
 W ?45,"Requesting location: ",$P(LRZX,U,7) S Y=$P(LRZX,U,5) D DD^LRX W !,"Date/Time Ordered: ",Y,?45,"By: ",$S($D(^VA(200,+$P(LRZX,U,2),0)):$P(^(0),U),1:"")
"RTN","LROE",62,0)
 S LRSVSN=LRSN D ORDER^LROS S LRSN=LRSVSN
"RTN","LROE",63,0)
 Q
"RTN","LROE",64,0)
 ;
"RTN","LROE",65,0)
 ;
"RTN","LROE",66,0)
QMSG W !,"Enter the order entry number assigned when the test was ordered."
"RTN","LROE",67,0)
 W:'$D(LRLONG) !,"If the test has not been ordered, type the RETURN key to order the test."
"RTN","LROE",68,0)
 W !,"To exit, type the ""^"" key and RETURN key."
"RTN","LROE",69,0)
 Q
"RTN","LROE",70,0)
 ;
"RTN","LROE",71,0)
 ;
"RTN","LROE",72,0)
YN R X:DTIME S:'$T DTOUT=1 Q:X=""!(X["N")!(X["Y")
"RTN","LROE",73,0)
 W !,"Answer 'Y' or 'N': " G YN
"RTN","LROE",74,0)
 ;
"RTN","LROE",75,0)
 ;
"RTN","LROE",76,0)
EN ;
"RTN","LROE",77,0)
LROEN S LRNCWL=1
"RTN","LROE",78,0)
 D LROE,END K LRNCWL
"RTN","LROE",79,0)
 Q
"RTN","LROE",80,0)
 ;
"RTN","LROE",81,0)
 ;
"RTN","LROE",82,0)
EN01 ; ENTER ORDER # THEN ENTER DATA
"RTN","LROE",83,0)
STAT ;
"RTN","LROE",84,0)
 D ^LRPARAM
"RTN","LROE",85,0)
 I '$D(LRLABKY) W !!?10,"You do not have the proper security Keys",! Q
"RTN","LROE",86,0)
 ;
"RTN","LROE",87,0)
 ; Select peforming laboratory
"RTN","LROE",88,0)
 S X=$$SELPL^LRVERA(DUZ(2))
"RTN","LROE",89,0)
 I X<1 D END Q
"RTN","LROE",90,0)
 I X'=DUZ(2) N LRPL S LRPL=X
"RTN","LROE",91,0)
 ;
"RTN","LROE",92,0)
 S LRLONG="",LRPANEL=0,LROESTAT=""
"RTN","LROE",93,0)
 S %H=$H-60 D YMD^LRX S LRTM60=9999999-X
"RTN","LROE",94,0)
 D LROE K LRTM60,LRLONG,LREND,LROESTAT
"RTN","LROE",95,0)
 D END
"RTN","LROE",96,0)
 Q
"RTN","LROE",97,0)
 ;
"RTN","LROE",98,0)
 ;
"RTN","LROE",99,0)
TIME ;from LROE1, LRORD1
"RTN","LROE",100,0)
 S %DT="SET" W !,"Collection Date@Time: ",$S($D(%DT("B")):%DT("B"),1:"NOW"),"//" R X:DTIME I '$T!(X="^") S LRCDT=-1 Q
"RTN","LROE",101,0)
 S:X="" X=$S($D(%DT("B")):%DT("B"),1:"N")
"RTN","LROE",102,0)
 W:X["?" !!,"You may enter ""T@U"" or just ""U"", for Today at Unknown time",!!
"RTN","LROE",103,0)
 I X["@U",$P(X,"@U",2)="" S X=$P(X,"@U",1) D ^%DT G TIME:Y<1 S LRCDT=+Y_"^1" Q
"RTN","LROE",104,0)
 S:X="U" LRCDT=DT_"^1"
"RTN","LROE",105,0)
 I X'="U" D ^%DT D:X'["?" TIME1 G TIME:X["?" S LRCDT=+Y_"^" G TIME:Y'["."
"RTN","LROE",106,0)
 Q
"RTN","LROE",107,0)
 ;
"RTN","LROE",108,0)
TIME1 S X1=X,Y1=Y D TIME2 S X=X1,Y=Y1 K X1,Y1
"RTN","LROE",109,0)
 Q
"RTN","LROE",110,0)
 ;
"RTN","LROE",111,0)
TIME2 S X="N",%DT="ST" D ^%DT Q:Y1'>Y  F  W !,"You have specified a collection time in the future.  Are you sure" S %=2 D YN^DICN Q:%  W !,"Answer 'Y'es or 'N'o."
"RTN","LROE",112,0)
 S:%'=1 X="?" S X1=X
"RTN","LROE",113,0)
 Q
"RTN","LROE",114,0)
 ;
"RTN","LROE",115,0)
 ;
"RTN","LROE",116,0)
TASK ;
"RTN","LROE",117,0)
 I $D(LRLABLIO),$D(LRLBL) S ZTRTN="ENT^LRLABLD",ZTDTH=$H,ZTDESC="LAB LABELS",ZTIO=LRLABLIO,ZTSAVE("LRLBL(")="" D ^%ZTLOAD
"RTN","LROE",118,0)
 K LRLBL
"RTN","LROE",119,0)
 I $D(LRCSQ),'$O(^XTMP("LRCAP",LRCSQ,DUZ,0)) K ^XTMP("LRCAP",LRCSQ,DUZ),LRCSQ
"RTN","LROE",120,0)
 I $D(LRCSQ),$P($G(^LRO(68,+LRAA,0)),U,16) D STD^LRCAPV
"RTN","LROE",121,0)
 D STOP^LRCAPV K LRCOM,LRSPCDSC,LRCCOM,LRTCOM
"RTN","LROE",122,0)
 Q
"RTN","LROE",123,0)
 ;
"RTN","LROE",124,0)
 ;
"RTN","LROE",125,0)
END K DIR,DIRUT,GOT
"RTN","LROE",126,0)
 D ^LRORDK,LROEND^LRORDK,STOP^LRCAPV
"RTN","LROE",127,0)
 Q
"RTN","LROE",128,0)
 ;
"RTN","LROE",129,0)
 ;
"RTN","LROE",130,0)
GOT(ORD,ODT) ;See if all tests have been canceled
"RTN","LROE",131,0)
 N I,SN,ODT
"RTN","LROE",132,0)
 S (GOT,ODT,SN)=0
"RTN","LROE",133,0)
 F  S ODT=$O(^LRO(69,"C",ORD,ODT)) Q:ODT<1  D
"RTN","LROE",134,0)
 . S SN=0 F  S SN=$O(^LRO(69,"C",ORD,ODT,SN)) Q:SN<1!(GOT)  D
"RTN","LROE",135,0)
 . . Q:'$D(^LRO(69,ODT,1,SN,0))
"RTN","LROE",136,0)
 . . S I=0 F  S I=$O(^LRO(69,ODT,1,SN,2,I)) Q:I<1  I $D(^(I,0)),'$P(^(0),"^",11) S GOT=1 Q
"RTN","LROE",137,0)
 Q GOT
"RTN","LROE",138,0)
 ;
"RTN","LROE",139,0)
 ;
"RTN","LROE",140,0)
UNL69 ;
"RTN","LROE",141,0)
 L -^LRO(69,"C",+$G(LRORD))
"RTN","LROE",142,0)
 Q
"RTN","LRORD")
0^40^B25739403
"RTN","LRORD",1,0)
LRORD ;DALOI/CJS - LAZY ACCESSION LOGGING ;2/6/91  12:54 ;
"RTN","LRORD",2,0)
 ;;5.2;LAB SERVICE;**100,121,153,286**;Sep 27, 1994
"RTN","LRORD",3,0)
EN ;;
"RTN","LRORD",4,0)
 I $D(^LAB(69.9,1,"RO")),+$H'=+^("RO") W $C(7),!,"ROLLOVER ",$S($P(^("RO"),U,2):"IS RUNNING.",1:"HAS NOT RUN.")," ACCESSIONING SHOULDN'T BE DONE NOW.",$C(7),!,"  Are you sure you want to continue"
"RTN","LRORD",5,0)
 I $T S %=2 D YN^DICN W:%=0 !,"If you continue to accession, you may block accessions from yesterday from",!,"rolling over." G LRORD:%=0 I %'=1 W !,"OK, try later." Q
"RTN","LRORD",6,0)
EN1 ;;from LROR4
"RTN","LRORD",7,0)
 D ^LRPARAM
"RTN","LRORD",8,0)
 K ^TMP("LRSTIK",$J),DIC,LRURG,LRSAME,LRCOM,LRNATURE,LRTCOM
"RTN","LRORD",9,0)
 S LRORDTIM="" S:'$D(LRORDR) LRORDR="" D DT^LRX
"RTN","LRORD",10,0)
 I $D(LRADDTST) Q:LRADDTST=""
"RTN","LRORD",11,0)
 S LRFIRST=1,LRODT=DT,U="^",LRECT=0,LROUTINE=$P(^LAB(69.9,1,3),U,2)
"RTN","LRORD",12,0)
 S:$G(LRORDRR)="R" LRECT=1,LRFIRST=0
"RTN","LRORD",13,0)
 I '$G(LRECT),LRORDR="" W !!,"WANT TO ENTER COLLECTION TIMES? Y//" D % S LRECT='(%["N") G KILL:$E(%)="^"
"RTN","LRORD",14,0)
 I LRORDR="LC" W !!," Ordering for ROUTINE LAB COLLECT ONLY",$C(7),! S LRLWC="LC",LRLLOC=".",LREND=0 D NEXTCOL^LROW5 G KILL:LREND
"RTN","LRORD",15,0)
 I LRORDR="SP" W !!," Ordering for SEND PATIENT ONLY",$C(7),! S LRLWC="SP"
"RTN","LRORD",16,0)
 I LRORDR="WC" W !!,"Ordering for WARD COLLECT & DELIVER ONLY",$C(7),! S LRLWC="WC"
"RTN","LRORD",17,0)
 I LRORDR="I" D ^LRORDIM G KILL:'$D(LRCDT)
"RTN","LRORD",18,0)
L5 I LRORDR]"",LRORDR'="LC",LRORDR'="I" S %DT="AET",%DT("A")=$S(LRORDR="WC":"COLLECTION",LRORDR="SP":"PATIENT VISIT",1:"")_" DATE: "
"RTN","LRORD",19,0)
 I $T D DATE^LRWU G KILL:Y<1 S LRORDTIM=$P(Y,".",2),LRODT=$P(Y,".",1),X1=Y,X2=DT D ^%DTC IF X>370 W !,"Can't order more than 12 months ahead!!" G L5
"RTN","LRORD",20,0)
 I $D(LRODT),$P(LRODT,".")?7N,'+$E($P(LRODT,"."),6,7) W !!?7,$C(7),"Please enter a date, ie. 4/1/90",!! G L5
"RTN","LRORD",21,0)
 I $D(LRODT),$P(LRODT,".")<DT W !,$C(7),"Cannot order in the Past.",! G L5
"RTN","LRORD",22,0)
 I $D(LRFLOG) S Y=LRFLOG G G0:LRFLOG>0
"RTN","LRORD",23,0)
 S DIC="^LAB(62.6,",DIC(0)="AEQMZ"
"RTN","LRORD",24,0)
 S DIC("S")=$S($D(LRLABKY):"I '(LRORDR=""LC""&'$P(^(0),U,4))",1:"I '(LRORDR=""LC""&'$P(^(0),U,4))&'$P(^(0),U,3)")
"RTN","LRORD",25,0)
 D ^DIC K DIC G KILL:$D(DUOUT)!$D(DTOUT),G1:Y<1 S LRFLOG=Y
"RTN","LRORD",26,0)
G0 S $P(LRFLOG,U,3)=$P(^LAB(62.2,+$P(^LAB(62.6,+LRFLOG,0),U,2),0),U,2)
"RTN","LRORD",27,0)
 S LRFLOG(0)=^LAB(62.6,+LRFLOG,0)
"RTN","LRORD",28,0)
 S (LRWP,I)=0
"RTN","LRORD",29,0)
 F  S I=$O(^LAB(62.6,+Y,1,I)) Q:I<1  D
"RTN","LRORD",30,0)
 . S Y(0)=$G(^LAB(62.6,+Y,1,I,0)),LRWP=LRWP+1
"RTN","LRORD",31,0)
 . S ^TMP("LRSTIK",$J,$S($P(LRFLOG(0),"^",5):I,1:LRWP))=Y(0)
"RTN","LRORD",32,0)
 . ; Lookup by number user enters.
"RTN","LRORD",33,0)
 . S ^TMP("LRSTIK",$J,"B",LRWP)=$S($P(LRFLOG(0),"^",5):I,1:LRWP)
"RTN","LRORD",34,0)
 . ; Lookup by test - used by LEDI (LRORDB) when user creates list "on-the-fly"
"RTN","LRORD",35,0)
 . S ^TMP("LRSTIK",$J,"C",+Y(0),$S($P(LRFLOG(0),"^",5):I,1:LRWP))=""
"RTN","LRORD",36,0)
 I LRWP>40 S LRFIRST=0 ; Don't automatically display "long" test lists.
"RTN","LRORD",37,0)
 G G5
"RTN","LRORD",38,0)
G1 S LRWP=0 W !,"Select one or more tests from which you will be generating your entries."
"RTN","LRORD",39,0)
GET D Q15^LRORD2
"RTN","LRORD",40,0)
 D ^DIC K DIC("S") G:Y<1 G5
"RTN","LRORD",41,0)
 S LRWP=LRWP+1,LRY=Y
"RTN","LRORD",42,0)
 S ^TMP("LRSTIK",$J,LRWP)=$P(LRY,U,1,2)
"RTN","LRORD",43,0)
 ; "B" Used to lookup by number user enters.
"RTN","LRORD",44,0)
 S ^TMP("LRSTIK",$J,"B",LRWP)=LRWP
"RTN","LRORD",45,0)
 ; "C" Used by LEDI (LRORDB)
"RTN","LRORD",46,0)
 S ^TMP("LRSTIK",$J,"C",+LRY,LRWP)=""
"RTN","LRORD",47,0)
 S LRTSTS=+^TMP("LRSTIK",$J,LRWP) D GS^LRORD3
"RTN","LRORD",48,0)
 S:+LRSAMP=-1&(LRSPEC=-1) LRWP=LRWP-1
"RTN","LRORD",49,0)
 G GET:+LRSAMP=-1&(LRSPEC=-1)
"RTN","LRORD",50,0)
 S ^TMP("LRSTIK",$J,LRWP)=^TMP("LRSTIK",$J,LRWP)_U_LRSAMP_U_U_LRSPEC
"RTN","LRORD",51,0)
 G GET
"RTN","LRORD",52,0)
 ;
"RTN","LRORD",53,0)
G5 G KILL:LRWP<1
"RTN","LRORD",54,0)
 S:'$D(^LRO(69,LRODT,0)) ^(0)=$P(^LRO(69,0),U,1,2)_U_LRODT_U_(1+$P(^(0),U,4)),^LRO(69,LRODT,0)=LRODT,^LRO(69,"B",LRODT,LRODT)=""
"RTN","LRORD",55,0)
 S LRURG="",LRAD=DT,LRWPD=LRWP\2+(LRWP#2) D ^LRORD1
"RTN","LRORD",56,0)
KILL D ^LRORDK,HOME^%ZIS Q
"RTN","LRORD",57,0)
% R %:DTIME Q:%=""!(%["N")!(%["Y")!($E(%)="^")  W !,"Answer 'Y' or 'N': " G %
"RTN","LRORD",58,0)
EN01 ;LAB COLLECT ORDER ENTRY
"RTN","LRORD",59,0)
ORDER S %=2 W !,"Do you want copies of the orders" D YN^DICN Q:%=-1  S:%=1 LRSLIP="" I %=0 D QUIZ G ORDER
"RTN","LRORD",60,0)
 S LRORDR="LC",LRLWCURG=$S($P(^LAB(69.9,1,3),U,2)'="":$P(^(3),U,2),1:9) G LRORD
"RTN","LRORD",61,0)
EN02 ;SEND PATIENT ORDER ENTRY
"RTN","LRORD",62,0)
SENDPAT S %=2 W !,"Do you want copies of the orders" D YN^DICN Q:%=-1  S:%=1 LRSLIP="" I %=0 D QUIZ G SENDPAT
"RTN","LRORD",63,0)
 S LRORDR="SP" G LRORD
"RTN","LRORD",64,0)
IMMCOL ;IMMEDIATE LAB COLLECTION
"RTN","LRORD",65,0)
 I '$P($G(^LAB(69.9,1,7,DUZ(2),0)),U,6) W !!?5," This option is not available at the time ",!!,$C(7) Q
"RTN","LRORD",66,0)
 S LRORDR="I" K LRODT G LRORD
"RTN","LRORD",67,0)
 ;
"RTN","LRORD",68,0)
EN03 ;WARD COLLECT ORDER ENTRY
"RTN","LRORD",69,0)
WARDCOL ;
"RTN","LRORD",70,0)
 S %=2
"RTN","LRORD",71,0)
 W !,"Do you want copies of the orders" D YN^DICN Q:%=-1  S:%=1 LRSLIP="" I %=0 D QUIZ G WARDCOL
"RTN","LRORD",72,0)
 S LRORDR="WC" D LRORD
"RTN","LRORD",73,0)
 Q
"RTN","LRORD",74,0)
 ;
"RTN","LRORD",75,0)
 ;
"RTN","LRORD",76,0)
LEDI ; Laboratory Electronic Data Exchange
"RTN","LRORD",77,0)
 ; This entry point is used to select patients from ^LRT(67, file
"RTN","LRORD",78,0)
 ; Routine LRDPAREF controls patient selection, patients must already
"RTN","LRORD",79,0)
 ; exist in ^DPT in order to be selected.
"RTN","LRORD",80,0)
 D ^LRPARAM
"RTN","LRORD",81,0)
 I $G(LREND) D ^LRORDK Q
"RTN","LRORD",82,0)
 N CONTROL,LA7,LA7SCFG,LA7X,LA7Y,LR64,LR696,LRLABLIO,LRRSTAT,LRRSITE,LRSD,LRTSN
"RTN","LRORD",83,0)
 S LRREFBAR=$$BAR^LA7SBCR
"RTN","LRORD",84,0)
 I LRREFBAR<0 D ^LRORDK Q
"RTN","LRORD",85,0)
 S LRRSTAT="I"
"RTN","LRORD",86,0)
 S LRRSTAT(0)=$$FIND1^DIC(64.061,"","OMX","Specimen in process","","I $P(^LAB(64.061,Y,0),U,7)=""U""")
"RTN","LRORD",87,0)
 D SITE^LA7SBCR2(.LRRSITE,"Scan Remote Site Barcode (SM)",LRREFBAR)
"RTN","LRORD",88,0)
 I LRRSITE("ERROR") D  Q
"RTN","LRORD",89,0)
 . W !!,$C(7),"ERROR -- ",$P(LRRSITE("ERROR"),"^",2),!
"RTN","LRORD",90,0)
 . D ^LRORDK
"RTN","LRORD",91,0)
 ;
"RTN","LRORD",92,0)
 ; Get shipping manifest ID manual input
"RTN","LRORD",93,0)
 I $G(LRRSITE("SMID"))="" D
"RTN","LRORD",94,0)
 . F  D SMID^LRORDB Q:LREND!($G(LRRSITE("SMID"))'="")
"RTN","LRORD",95,0)
 I $G(LREND) D ^LRORDK Q
"RTN","LRORD",96,0)
 ;
"RTN","LRORD",97,0)
 ; LRORDRR="R" variable indicates host accessioning of remote orders
"RTN","LRORD",98,0)
 S LRORDRR="R",LRORDR="" K LRODT
"RTN","LRORD",99,0)
 D LRORD,^LRORDK
"RTN","LRORD",100,0)
 Q
"RTN","LRORD",101,0)
 ;
"RTN","LRORD",102,0)
 ;
"RTN","LRORD",103,0)
 ; LRORDRR =TYPE OF ORDER, LRECT =ASK COLECTION TIME
"RTN","LRORD",104,0)
 ; LRFLOG =ACCESSION TEST GROUP, IF DEFINED ON ENTRY, PRESELECTS GROUP
"RTN","LRORD",105,0)
 ;
"RTN","LRORD",106,0)
QUIZ W !,"The order copy is automatically sent to the CLOSEST PRINTER,"
"RTN","LRORD",107,0)
 W !,"if a closest printer is defined for the device you are using."
"RTN","LRORD",108,0)
 W !,"Otherwise, you will be prompted with ORDER COPY DEVICE.",!
"RTN","LRORD",109,0)
 Q
"RTN","LRORD1")
0^45^B21032923
"RTN","LRORD1",1,0)
LRORD1 ;DALOI/RWF - LAZY ACCESSION LOGGING ; Feb 20, 2004
"RTN","LRORD1",2,0)
 ;;5.2;LAB SERVICE;**1,8,121,153,201,286**;Sep 27, 1994
"RTN","LRORD1",3,0)
L2 Q:$G(LREND)
"RTN","LRORD1",4,0)
 K LROT,LRSAME,LRKIL,LRGCOM,LRCCOM,LR696IEN,LRNATURE
"RTN","LRORD1",5,0)
 S LRWPC=LRWP G:$D(LROR) LRFIRST
"RTN","LRORD1",6,0)
 I '$D(LRADDTST) K DFN,DIC S PNM="",DIC(0)="EMQ"_$S($P(LRPARAM,U,6)&$D(LRLABKY):"L",1:"") W ! D ^LRDPA I (LRDFN=-1)!$D(DUOUT)!$D(DTOUT) Q
"RTN","LRORD1",7,0)
 I $D(LRADDTST),LRADDTST="" Q
"RTN","LRORD1",8,0)
 S:'$D(LREND) LREND=0 I LRORDR="" D COLTY^LRWU G DROP:LREND
"RTN","LRORD1",9,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3)
"RTN","LRORD1",10,0)
Q12 D LOC^LRWU G DROP:LREND
"RTN","LRORD1",11,0)
Q11 D PRAC^LRWU1 G DROP:LREND
"RTN","LRORD1",12,0)
 K T,TT,LRDMAX,LRDTST,LRTMAX
"RTN","LRORD1",13,0)
 S DA=0
"RTN","LRORD1",14,0)
 F  S DA=$O(^LRO(69,LRODT,1,"AA",LRDFN,DA)) Q:DA<1  I $S($D(^LRO(69,LRODT,1,DA,1)):$P(^(1),U,4)'="U",1:1) S S=$S($D(^LRO(69,LRODT,1,DA,4,1,0)):+^(0),1:0) D
"RTN","LRORD1",15,0)
 . S I=0 F  S I=$O(^LRO(69,LRODT,1,DA,2,I)) Q:I<1  I $D(^(I,0)) S T(+^(0),DA)=S,X=+^(0) S:'$D(TT(X,S)) TT(X,S)=0 S TT(X,S)=TT(X,S)+1
"RTN","LRORD1",16,0)
 K DIC
"RTN","LRORD1",17,0)
 I $D(LRADDTST) S LRORD=+LRADDTST,LRADDTST="" G LRFIRST
"RTN","LRORD1",18,0)
 D ORDER^LROW2
"RTN","LRORD1",19,0)
 I $D(LRFLOG),$P(LRFLOG,U,3)="MI",$G(LRORDRR)'="R" K DUOUT D MICRO G L2:$D(DUOUT)!$D(DTOUT)
"RTN","LRORD1",20,0)
 ;
"RTN","LRORD1",21,0)
LRFIRST S LRSX=1 G Q13:'LRFIRST!(LRWP<2)
"RTN","LRORD1",22,0)
 W !,"Choose one (or more, separated by commas)  ('*' AFTER NUMBER TO CHANGE URGENCY) "
"RTN","LRORD1",23,0)
 F I=1:1:LRWPD D
"RTN","LRORD1",24,0)
 . N X
"RTN","LRORD1",25,0)
 . S X=^TMP("LRSTIK",$J,"B",I)
"RTN","LRORD1",26,0)
 . W !,X,?4,$P(^TMP("LRSTIK",$J,X),U,2)
"RTN","LRORD1",27,0)
 . S X=$G(^TMP("LRSTIK",$J,"B",I+LRWPD))
"RTN","LRORD1",28,0)
 . I X W ?39," ",X,?44,$P(^TMP("LRSTIK",$J,X),U,2)
"RTN","LRORD1",29,0)
Q13 S LREDO=0
"RTN","LRORD1",30,0)
LEDI ;
"RTN","LRORD1",31,0)
 ;
"RTN","LRORD1",32,0)
 ; If LEDI accessioning then check for pending orders in file #69.6
"RTN","LRORD1",33,0)
 I $G(LRRSTAT)="I",$G(LRRSITE("SMID"))'="",$G(LRSD("RUID"))'="" D  I $O(LROT(0)) G BAR
"RTN","LRORD1",34,0)
 . D EN^LRORDB(LRSD("RUID"),LRRSITE("SMID"))
"RTN","LRORD1",35,0)
 G:LRWP'>1 Q13A
"RTN","LRORD1",36,0)
 W ! W:'LRFIRST "'?' for list,  " S LRFIRST=0
"RTN","LRORD1",37,0)
 R "TEST number(s): ",LRSX:DTIME S:LRSX["?" LRFIRST=1 G LRFIRST:LRFIRST
"RTN","LRORD1",38,0)
 I LRSX=""!(LRSX["^") G BAR
"RTN","LRORD1",39,0)
 F I=1:1:$L(LRSX,",") D  Q:LREDO
"RTN","LRORD1",40,0)
 . S LRSSX=$P(LRSX,",",I)
"RTN","LRORD1",41,0)
 . I LRSSX'?1.3N.1"*" S LREDO=1 Q
"RTN","LRORD1",42,0)
 . S LRSSX=$P(LRSSX,"*")
"RTN","LRORD1",43,0)
 . I '$D(^TMP("LRSTIK",$J,LRSSX)) S LREDO=1
"RTN","LRORD1",44,0)
Q13A I LREDO W !,"Something was mistyped, try again." G Q13
"RTN","LRORD1",45,0)
 F LRK=1:1 S LRSSX=$P(LRSX,",",LRK) Q:LRSSX=""  D
"RTN","LRORD1",46,0)
 . N X
"RTN","LRORD1",47,0)
 . S LRST=$S(LRSSX["*":1,1:0),LRSSX=+LRSSX
"RTN","LRORD1",48,0)
 . S X=^TMP("LRSTIK",$J,LRSSX)
"RTN","LRORD1",49,0)
 . S LRSAMP=$P(X,U,3),LRSPEC=$P(X,U,5),LRTSTS=+X
"RTN","LRORD1",50,0)
 . D Q20^LRORDD
"RTN","LRORD1",51,0)
BAR S LRM=LRWPC+1,K=0 W !,"Other tests? N//" D % G Q14:'(%["Y")
"RTN","LRORD1",52,0)
LRM D MORE^LRORD2
"RTN","LRORD1",53,0)
Q14 D:$P(LRPARAM,U,17) ^LRORDD D ^LRORD2A D ENSTIK^LROW3 G LRM:'$D(%)&($D(LROT)'=11),DROP:$O(LROT(-1))="",LRM:'$D(%),DROP:%[U K DIC G DROP:'$D(LROT)!(%["N")
"RTN","LRORD1",54,0)
 W !!,"LAB Order number: ",LRORD,!!
"RTN","LRORD1",55,0)
 I LRECT D  G DROP:LRCDT<1
"RTN","LRORD1",56,0)
 . I $G(LRORDRR)="R",$G(LRSD("CDT")) D  Q
"RTN","LRORD1",57,0)
 . . S LRCDT=LRSD("CDT")_"^"
"RTN","LRORD1",58,0)
 . . S LRORDTIM=$P(LRSD("CDT"),".",2)
"RTN","LRORD1",59,0)
 . . I 'LRORDTIM S $P(LRCDT,"^",2)=1
"RTN","LRORD1",60,0)
 . D TIME^LROE
"RTN","LRORD1",61,0)
 . I LRCDT<1 Q
"RTN","LRORD1",62,0)
 . S LRORDTIM=$P(Y,".",2)
"RTN","LRORD1",63,0)
 D NOW^%DTC S LRNT=% S:'LRECT LRCDT=LRNT_"^1"
"RTN","LRORD1",64,0)
 S LRIDT=9999999-LRCDT
"RTN","LRORD1",65,0)
 D ^LRORDST Q:$D(LROR)
"RTN","LRORD1",66,0)
 I $D(LRFASTS) D LRWU4^LRFASTS
"RTN","LRORD1",67,0)
 Q:$G(LRKIK)  G L2
"RTN","LRORD1",68,0)
% R %:DTIME Q:%=""!(%["N")!(%["Y")  W !,"Answer 'Y' or 'N': " G %
"RTN","LRORD1",69,0)
 ;
"RTN","LRORD1",70,0)
Q20A ;from LRORD2
"RTN","LRORD1",71,0)
MAX ; CHECK FOR MAXIUM ORDER FREQUENCY
"RTN","LRORD1",72,0)
 I $D(TT(LRTSTS,LRSPEC)),$D(^LAB(60,LRTSTS,3,"B",LRCS(LRCSN))) D EN2^LRORDD I %'["Y" Q
"RTN","LRORD1",73,0)
 S I7=0 F I9=0:0 S I9=$O(T(LRTSTS,I9)) Q:I9=""  I $D(^LAB(60,LRTSTS,3,+$O(^LAB(60,LRTSTS,3,"B",LRSAMP,0)),0)),+$P(^(0),U,5),LRSPEC=T(LRTSTS,I9) S I7=1
"RTN","LRORD1",74,0)
 I I7 W $C(7),!!,"You have a duplicate: " S LRSN=0 F  S LRSN=$O(T(LRTSTS,LRSN)) Q:LRSN<1  W "  for ",$P(^LAB(60,LRTSTS,0),U) S LRZT=LRTSTS D ORDER^LROS S LRTSTS=LRZT
"RTN","LRORD1",75,0)
 I I7 W !,"You already have that test, do you really want another? N//" D %
"RTN","LRORD1",76,0)
 Q
"RTN","LRORD1",77,0)
 ;
"RTN","LRORD1",78,0)
URGG W !,"For ",$P(^TMP("LRSTIK",$J,LRSSX),U,2)
"RTN","LRORD1",79,0)
 D URG^LRORD2
"RTN","LRORD1",80,0)
 Q
"RTN","LRORD1",81,0)
 ;
"RTN","LRORD1",82,0)
 ;
"RTN","LRORD1",83,0)
DROP W !!,"ORDER CANCELED",$C(7),!! Q:$D(LROR)  G L2 ; !($G(LREND))  G L2
"RTN","LRORD1",84,0)
 ;
"RTN","LRORD1",85,0)
 ;
"RTN","LRORD1",86,0)
MICRO W !,"Is there one sample for this patient's order"
"RTN","LRORD1",87,0)
 S %=1 D YN^DICN
"RTN","LRORD1",88,0)
 I %=2!(%=-1) S:%=-1 DUOUT=1 Q
"RTN","LRORD1",89,0)
 I %=0 W !,"The collection sample and site/specimen will be used for all tests ordered",!,"at this time for this patient." G MICRO
"RTN","LRORD1",90,0)
 D GSNO^LRORD3 Q:$D(DUOUT)!$D(DTOUT)
"RTN","LRORD1",91,0)
 I +LRSAMP=-1&(LRSPEC=-1) W !,"Incompletely defined." G MICRO
"RTN","LRORD1",92,0)
 S LRSAME=LRSAMP_U_LRSPEC
"RTN","LRORD1",93,0)
 S LRECOM=0 D GCOM^LRORD2
"RTN","LRORD1",94,0)
 Q
"RTN","LRORD1",95,0)
 ;
"RTN","LRORD1",96,0)
 ;
"RTN","LRORD1",97,0)
PRAC ;from LRFAST
"RTN","LRORD1",98,0)
 S X=$S(+DIC("B"):$P(^VA(200,+DIC("B"),0),U),1:"")
"RTN","LRORD1",99,0)
 W !,"PRACTITIONER: ",X,$S($L(X):"//",1:"")
"RTN","LRORD1",100,0)
 R X:DTIME
"RTN","LRORD1",101,0)
 I DIC("B"),X="" S Y=DIC("B") Q
"RTN","LRORD1",102,0)
 D ^DIC K DIC
"RTN","LRORD1",103,0)
 Q
"RTN","LRORDB")
0^41^B38948502
"RTN","LRORDB",1,0)
LRORDB ;DALOI/FHS - ORDER LEDI TEST USING BARCODE FROM 69.6 ; 12/3/1997
"RTN","LRORDB",2,0)
 ;;5.2;LAB SERVICE;**153,222,286**;Sep 27, 1994
"RTN","LRORDB",3,0)
 ;
"RTN","LRORDB",4,0)
EN(LRRUID,LRSSMP) ;
"RTN","LRORDB",5,0)
 ;
"RTN","LRORDB",6,0)
 N I,LRSTATUS,LRX
"RTN","LRORDB",7,0)
 ;
"RTN","LRORDB",8,0)
 K LROT
"RTN","LRORDB",9,0)
 ;
"RTN","LRORDB",10,0)
 S (LROT,LRSTATUS)=""
"RTN","LRORDB",11,0)
 ;
"RTN","LRORDB",12,0)
 Q:'$L($G(LRRUID))!('$L($G(LRSSMP)))
"RTN","LRORDB",13,0)
 S LR696=$O(^LRO(69.6,"AD",LRSSMP,LRRUID,0)) Q:'LR696
"RTN","LRORDB",14,0)
 Q:'$D(^LRO(69.6,LR696,0))#2
"RTN","LRORDB",15,0)
 ;
"RTN","LRORDB",16,0)
 S LRX=+$P(^LRO(69.6,LR696,0),U,10)
"RTN","LRORDB",17,0)
 I LRX S LRSTATUS=$$GET1^DIQ(64.061,LRX_",",.01)
"RTN","LRORDB",18,0)
 I LRSTATUS'="",LRSTATUS'="In-Transit" D
"RTN","LRORDB",19,0)
 . S I=0
"RTN","LRORDB",20,0)
 . F  S I=$O(^LRO(69.6,LR696,2,I)) Q:'I  D  Q:LRSTATUS="In-Transit"
"RTN","LRORDB",21,0)
 . . S X=$P(^LRO(69.6,LR696,2,I,0),"^",6) Q:'X
"RTN","LRORDB",22,0)
 . . I $$GET1^DIQ(64.061,X_",",.01)="In-Transit" S LRSTATUS="In-Transit"
"RTN","LRORDB",23,0)
 ;
"RTN","LRORDB",24,0)
 I LRSTATUS'="",LRSTATUS'="In-Transit" D  Q
"RTN","LRORDB",25,0)
 . N DIR
"RTN","LRORDB",26,0)
 . S DIR("A",1)="This order has a status of [ "_LRSTATUS_" ]"
"RTN","LRORDB",27,0)
 . S DIR("A",2)="No test selected."
"RTN","LRORDB",28,0)
 . D DISPLO
"RTN","LRORDB",29,0)
 ;
"RTN","LRORDB",30,0)
 ; Display any comments that accompanied order
"RTN","LRORDB",31,0)
 I $D(^LRO(69.6,LR696,99)) D
"RTN","LRORDB",32,0)
 . N LRWP
"RTN","LRORDB",33,0)
 . S LRWP=$$GET1^DIQ(69.6,LR696_",",99,"","LRWP")
"RTN","LRORDB",34,0)
 . S LRWP(.5)="Collecting site order comments:",LRWP(.5,"F")="!!"
"RTN","LRORDB",35,0)
 . D EN^DDIOL(.LRWP)
"RTN","LRORDB",36,0)
 ;
"RTN","LRORDB",37,0)
 D LROT(LR696)
"RTN","LRORDB",38,0)
 ;
"RTN","LRORDB",39,0)
 I $O(LROT(0)) D LL3^LROW3
"RTN","LRORDB",40,0)
 I '$O(LROT(0)) D  Q
"RTN","LRORDB",41,0)
 . N DIR
"RTN","LRORDB",42,0)
 . S DIR("A",1)="NO tests found on Shipping Manifest "_$G(LRRSITE("SMID"))
"RTN","LRORDB",43,0)
 . S DIR("A",2)="For UID "_$G(LRRUID)
"RTN","LRORDB",44,0)
 . D DISPLO
"RTN","LRORDB",45,0)
 ;
"RTN","LRORDB",46,0)
 S $P(^LRO(69.6,LR696,0),U,11)=$G(LRSD("RIEN"))
"RTN","LRORDB",47,0)
 Q
"RTN","LRORDB",48,0)
 ;
"RTN","LRORDB",49,0)
 ;
"RTN","LRORDB",50,0)
LROT(LR696) ;
"RTN","LRORDB",51,0)
 ;
"RTN","LRORDB",52,0)
 N LR60,LR6205,LR6964,LRATG,LRMICHK,LRNLT,LRX,LRY,X
"RTN","LRORDB",53,0)
 ;
"RTN","LRORDB",54,0)
 K LROT
"RTN","LRORDB",55,0)
 ;
"RTN","LRORDB",56,0)
 S LR696(0)=$G(^LRO(69.6,LR696,0))
"RTN","LRORDB",57,0)
 S LRSPEC=+$P(LR696(0),U,7),LRSAMP=+$P(LR696(0),U,8)
"RTN","LRORDB",58,0)
 ;Q:'LRSPEC!('$D(^LAB(61,LRSPEC,0)))
"RTN","LRORDB",59,0)
 S (LR6964,LRMICHK)=0
"RTN","LRORDB",60,0)
 F  S LR6964=+$O(^LRO(69.6,LR696,2,LR6964)) Q:LR6964<1  D
"RTN","LRORDB",61,0)
 . S LR6964(0)=$G(^LRO(69.6,LR696,2,LR6964,0))
"RTN","LRORDB",62,0)
 . I LR6964(0)="" Q
"RTN","LRORDB",63,0)
 . I $P(LR6964(0),"^",6),$$GET1^DIQ(64.061,$P(LR6964(0),"^",6)_",",.01)'="In-Transit" Q
"RTN","LRORDB",64,0)
 . S LR60=$P(LR6964(0),U,11) ; Lab test to order
"RTN","LRORDB",65,0)
 . S LR6205=$P(LR6964(0),U,12) ; Urgency
"RTN","LRORDB",66,0)
 . I 'LRMICHK,LR60>0,$P(^LAB(60,LR60,0),U,4)="MI" D MICHECK
"RTN","LRORDB",67,0)
 . S LRATG=0
"RTN","LRORDB",68,0)
 . ; If have everything, then don't check accession test group.
"RTN","LRORDB",69,0)
 . I LR60,LRSPEC,LRSAMP,LR6205 D  Q:LRATG
"RTN","LRORDB",70,0)
 . . S LR64=+$G(^LAB(60,LR60,64))
"RTN","LRORDB",71,0)
 . . I 'LR64 Q
"RTN","LRORDB",72,0)
 . . S LRNLT=$P($G(^LAM(LR64,0)),U,2),LRNLT(2)=$P($G(^LAM(LR64,0)),U)
"RTN","LRORDB",73,0)
 . . ; Find available spot.
"RTN","LRORDB",74,0)
 . . F LRATG=LRWPC+1:1 I '$D(LROT(LRSAMP,LRSPEC,LRATG)) S LRWPC=LRATG Q
"RTN","LRORDB",75,0)
 . . D CHKURG,SETLROT
"RTN","LRORDB",76,0)
 . S LRNLT=$P(LR6964(0),U,2) Q:'LRNLT
"RTN","LRORDB",77,0)
 . S LRNLT(1)=+$O(^LAM("C",LRNLT_" ",0))
"RTN","LRORDB",78,0)
 . I 'LRNLT(1)!('$D(^LAM(LRNLT(1),0))) Q
"RTN","LRORDB",79,0)
 . S LRNLT(2)=$P(^LAM(LRNLT(1),0),U),LR60=0
"RTN","LRORDB",80,0)
 . F  S LR60=+$O(^LAB(60,"AC",LRNLT(1),LR60)) Q:'LR60  D
"RTN","LRORDB",81,0)
 . . S LRATG=+$O(^TMP("LRSTIK",$J,"C",LR60,0)) Q:LRATG<1
"RTN","LRORDB",82,0)
 . . S LRATG(1)=$G(^TMP("LRSTIK",$J,LRATG)) Q:'LRATG(1)!('$P(LRATG(1),U,3))
"RTN","LRORDB",83,0)
 . . S:'$G(LRSAMP) LRSAMP=$P(LRATG(1),U,3)
"RTN","LRORDB",84,0)
 . . D CHKURG
"RTN","LRORDB",85,0)
 . . I LR60,LRSPEC,LRSAMP,LR6205 D SETLROT
"RTN","LRORDB",86,0)
 Q
"RTN","LRORDB",87,0)
 ;
"RTN","LRORDB",88,0)
 ;
"RTN","LRORDB",89,0)
SETLROT ; Setup LROT array
"RTN","LRORDB",90,0)
 ;
"RTN","LRORDB",91,0)
 S LROT(LRSAMP,LRSPEC,LRATG)=LR60
"RTN","LRORDB",92,0)
 S LROT(LRSAMP,LRSPEC,LRATG,1)=LR6205
"RTN","LRORDB",93,0)
 S LROT(LRSAMP,LRSPEC,LRATG,"B",LR60)=LR6964_U_LRNLT_U_LRNLT(2)
"RTN","LRORDB",94,0)
 ;
"RTN","LRORDB",95,0)
 ; Required comment
"RTN","LRORDB",96,0)
 S:$P($G(^LAB(60,LR60,0)),U,19) LROT(LRSAMP,LRSPEC,LRATG,2)=$P(^(0),U,19)
"RTN","LRORDB",97,0)
 ;
"RTN","LRORDB",98,0)
 Q
"RTN","LRORDB",99,0)
 ;
"RTN","LRORDB",100,0)
 ;
"RTN","LRORDB",101,0)
CHKURG ; Check for forced, highest allowed and missing urgency on this test
"RTN","LRORDB",102,0)
 ;
"RTN","LRORDB",103,0)
 N X
"RTN","LRORDB",104,0)
 ;
"RTN","LRORDB",105,0)
 ; Forced urgency
"RTN","LRORDB",106,0)
 I +$P(^LAB(60,LR60,0),U,18) S LR6205=+$P(^LAB(60,LR60,0),U,18)
"RTN","LRORDB",107,0)
 ;
"RTN","LRORDB",108,0)
 ; If missing urgency then look above workload urgencies for last urgency
"RTN","LRORDB",109,0)
 ; that matches on HL7 urgency othewise use site's default for routine.
"RTN","LRORDB",110,0)
 I 'LR6205 D
"RTN","LRORDB",111,0)
 . S X=$P(LR6964(0),U,5)
"RTN","LRORDB",112,0)
 . I $L(X) S LR6205=+$O(^LAB(62.05,"HL7",X,50),-1)
"RTN","LRORDB",113,0)
 . S LR6205=$S(LR6205>0:LR6205,1:LROUTINE)
"RTN","LRORDB",114,0)
 ;
"RTN","LRORDB",115,0)
 ; Highest urgency allowed, reset if higher than highest allowed.
"RTN","LRORDB",116,0)
 S X=+$P(^LAB(60,LR60,0),U,16)
"RTN","LRORDB",117,0)
 I LR6205<X S LR6205=X
"RTN","LRORDB",118,0)
 ;
"RTN","LRORDB",119,0)
 Q
"RTN","LRORDB",120,0)
 ;
"RTN","LRORDB",121,0)
 ;
"RTN","LRORDB",122,0)
MICHECK ; Check "MI" subscript test for missing topography and collection sample
"RTN","LRORDB",123,0)
 ;
"RTN","LRORDB",124,0)
 N DA,DIE,DR,X,Y
"RTN","LRORDB",125,0)
 S DA=LR696,DIE=69.6,DR="",LRMICHK=1
"RTN","LRORDB",126,0)
 I LRSPEC'>0 S DR=4_";"
"RTN","LRORDB",127,0)
 I LRSAMP'>0 S DR=DR_5
"RTN","LRORDB",128,0)
 I LRSPEC D
"RTN","LRORDB",129,0)
 . S LRX=$$GET1^DIQ(61,LRSPEC_",",".09:2")
"RTN","LRORDB",130,0)
 . I LRX="XXX"!(LRX="ORH") S DR="4;5"
"RTN","LRORDB",131,0)
 I DR="" Q
"RTN","LRORDB",132,0)
 D EN^DDIOL("Update missing order information for:",,"!!")
"RTN","LRORDB",133,0)
 D EN^DDIOL("",,"!")
"RTN","LRORDB",134,0)
 D ^DIE
"RTN","LRORDB",135,0)
 S LR696(0)=$G(^LRO(69.6,LR696,0))
"RTN","LRORDB",136,0)
 S LRSPEC=+$P(LR696(0),U,7),LRSAMP=+$P(LR696(0),U,8)
"RTN","LRORDB",137,0)
 ;
"RTN","LRORDB",138,0)
 Q
"RTN","LRORDB",139,0)
 ;
"RTN","LRORDB",140,0)
 ;
"RTN","LRORDB",141,0)
SMID ; Call to get shipping manifest ID (manual selection)
"RTN","LRORDB",142,0)
 N CNT,DA,DIR,LRSMID,LRY,X,Y
"RTN","LRORDB",143,0)
 S LREND=0,LRSMID=""
"RTN","LRORDB",144,0)
 S DIR(0)="69.6,18" D ^DIR
"RTN","LRORDB",145,0)
 I $D(DTOUT)!($D(DUOUT)) S LREND=1 Q
"RTN","LRORDB",146,0)
 I $D(DIRUT) Q
"RTN","LRORDB",147,0)
 S LRY=Y
"RTN","LRORDB",148,0)
 I LRY'="",$D(^LRO(69.6,"D",LRY)) S LRSMID=LRY
"RTN","LRORDB",149,0)
 I LRSMID="" D
"RTN","LRORDB",150,0)
 . D SHOW
"RTN","LRORDB",151,0)
 . K ^TMP("LR",$J,"SMID")
"RTN","LRORDB",152,0)
 ;
"RTN","LRORDB",153,0)
 I LRSMID="" D  Q
"RTN","LRORDB",154,0)
 . N DIR
"RTN","LRORDB",155,0)
 . S DIR(0)="YO",DIR("A")="Use manifest '"_LRY_"' anyway",DIR("B")="NO"
"RTN","LRORDB",156,0)
 . W ! D ^DIR
"RTN","LRORDB",157,0)
 . I Y S LRRSITE("SMID")=LRY
"RTN","LRORDB",158,0)
 ;
"RTN","LRORDB",159,0)
 S LRRSITE("SMID")=LRSMID
"RTN","LRORDB",160,0)
 S LRY=$O(^LRO(69.6,"D",LRSMID,0))
"RTN","LRORDB",161,0)
 I LRY S LRRSITE("SDT")=$$GET1^DIQ(69.6,LRY_",",14,"I")
"RTN","LRORDB",162,0)
 K DIR
"RTN","LRORDB",163,0)
 ;
"RTN","LRORDB",164,0)
 ; Flag to determine if this shipping manfiest should be used to
"RTN","LRORDB",165,0)
 ; look up orders when manually accessioning.
"RTN","LRORDB",166,0)
 S DIR(0)="YO",DIR("A")="Lookup orders using this manifest",DIR("B")="YES"
"RTN","LRORDB",167,0)
 D ^DIR
"RTN","LRORDB",168,0)
 I $D(DIRUT) S LREND=1 Q
"RTN","LRORDB",169,0)
 S LRRSITE("SMID-OK")=Y
"RTN","LRORDB",170,0)
 Q
"RTN","LRORDB",171,0)
 ;
"RTN","LRORDB",172,0)
 ;
"RTN","LRORDB",173,0)
SHOW ; Gather a list of possible SMID to select from
"RTN","LRORDB",174,0)
 N CNT,DIR,IEN,LEN,SMID,VAL
"RTN","LRORDB",175,0)
 K ^TMP("LR",$J,"SMID")
"RTN","LRORDB",176,0)
 S SMID=LRY,LEN=$L(LRY),CNT=0
"RTN","LRORDB",177,0)
 I SMID?1.N S SMID=SMID_" "
"RTN","LRORDB",178,0)
 F  S SMID=$O(^LRO(69.6,"D",SMID)) Q:$E(SMID,1,LEN)'=LRY  D
"RTN","LRORDB",179,0)
 . S IEN=+$O(^LRO(69.6,"D",SMID,0))
"RTN","LRORDB",180,0)
 . I $P($G(^LRO(69.6,IEN,0)),"^",5)'=+$G(LRRSITE("RSITE")) Q
"RTN","LRORDB",181,0)
 . S CNT=CNT+1
"RTN","LRORDB",182,0)
 . S ^TMP("LR",$J,"SMID",CNT)=SMID
"RTN","LRORDB",183,0)
 I 'CNT W !,"No manifest '",LRY,"' found on file." Q
"RTN","LRORDB",184,0)
 I CNT=1 S LRSMID=^TMP("LR",$J,"SMID",CNT) Q
"RTN","LRORDB",185,0)
 ;
"RTN","LRORDB",186,0)
 ; Select SMID from List
"RTN","LRORDB",187,0)
 D DISPL
"RTN","LRORDB",188,0)
 S DIR(0)="NO^1:"_CNT,DIR("A")="Select Manifest Number"
"RTN","LRORDB",189,0)
 D ^DIR
"RTN","LRORDB",190,0)
 I $D(DIRUT) W !,"No manifest selected." Q
"RTN","LRORDB",191,0)
 S LRSMID=$G(^TMP("LR",$J,"SMID",Y))
"RTN","LRORDB",192,0)
 Q
"RTN","LRORDB",193,0)
 ;
"RTN","LRORDB",194,0)
 ;
"RTN","LRORDB",195,0)
DISPL ;
"RTN","LRORDB",196,0)
 N CNT,DIR,DIRUT
"RTN","LRORDB",197,0)
 W @IOF
"RTN","LRORDB",198,0)
 S CNT=0
"RTN","LRORDB",199,0)
 F  S CNT=$O(^TMP("LR",$J,"SMID",CNT)) Q:'CNT  D  Q:$D(DIRUT)
"RTN","LRORDB",200,0)
 . I CNT#3=1 D  Q:$D(DIRUT)
"RTN","LRORDB",201,0)
 . . I '(CNT#(IOSL-3)) S DIR(0)="E" D ^DIR Q:$D(DIRUT)
"RTN","LRORDB",202,0)
 . . W !
"RTN","LRORDB",203,0)
 . W $$LJ^XLFSTR(CNT_". "_^TMP("LR",$J,"SMID",CNT),26)
"RTN","LRORDB",204,0)
 Q
"RTN","LRORDB",205,0)
 ;
"RTN","LRORDB",206,0)
 ;
"RTN","LRORDB",207,0)
DISPLO ; Display the order from #69.6
"RTN","LRORDB",208,0)
 N DA,DIC,DIRUT,DTOUT,DUOUT,DX,S,X,Y
"RTN","LRORDB",209,0)
 S DIR("A")="Would you like a display of the Order"
"RTN","LRORDB",210,0)
 S DIR(0)="Y" D ^DIR K DIR
"RTN","LRORDB",211,0)
 I $D(DIROUT)!(Y'=1) W ! Q
"RTN","LRORDB",212,0)
 S DA=LR696,DIC="^LRO(69.6,",S=0 W @IOF D EN^DIQ W !
"RTN","LRORDB",213,0)
 Q
"RTN","LROW3")
0^48^B12243120
"RTN","LROW3",1,0)
LROW3 ;DALOI/CJS - LIST THE TESTS ORDERED AND ALLOW EDITING ;Mar 23, 2004
"RTN","LROW3",2,0)
 ;;5.2;LAB SERVICE;**33,121,286**;Sep 27, 1994
"RTN","LROW3",3,0)
L ;
"RTN","LROW3",4,0)
 ; Only ask nature of order for CPRS - file #2 patients.
"RTN","LROW3",5,0)
 I $G(LRDPF,2)=2 D  Q:'$D(LRNATURE)
"RTN","LROW3",6,0)
 . D NATURE
"RTN","LROW3",7,0)
 . I $G(LRNATURE)=-1 W !!,$C(7),"...process aborted" S %="^" K LRNATURE
"RTN","LROW3",8,0)
 D L3
"RTN","LROW3",9,0)
 W !!,"All satisfactory" S %=1 D YN^DICN D:%=0 HELP G:%=0 L Q:%'=2
"RTN","LROW3",10,0)
L1 W !,"Delete test entry no.: " R X:DTIME W:X["?" !,"Select entry number to be deleted." W:X'?.N !,"Select one entry at a time." D L3:X["?" G L1:X["?"!(X'?.N)
"RTN","LROW3",11,0)
 I X'="",'$D(J(+X)) W !!?5,$C(7),"( "_X_" ) Is not a valid entry number " G LROW3
"RTN","LROW3",12,0)
 I X'="" S X=+X S LRSAMP=$P(J(X),U),LRTEST=$P(J(X),U,2) D X3 G L1
"RTN","LROW3",13,0)
L1A W !!,"Add more tests" S %=2 D YN^DICN D:%=0 HELP G:%=0 L1A I %=1 D L2^LROW1
"RTN","LROW3",14,0)
 G LROW3
"RTN","LROW3",15,0)
 ;
"RTN","LROW3",16,0)
 ;
"RTN","LROW3",17,0)
L2 S LRSAMP=$S($D(^LAB(62,I,0)):$P(^(0),U),1:"")
"RTN","LROW3",18,0)
 S K=0
"RTN","LROW3",19,0)
 F  S K=$O(LRXST(I,K)) Q:K<1  S J=K,J(K)=I_U_K D L4 W !,?5,K,?15,$P(^LAB(60,+LRTEST(K),0),U)," ",?45,LRSAMP W:LRSAMP'=LRSPEC "  ",LRSPEC
"RTN","LROW3",20,0)
 Q
"RTN","LROW3",21,0)
 ;
"RTN","LROW3",22,0)
 ;
"RTN","LROW3",23,0)
L3 ;
"RTN","LROW3",24,0)
 K J S J=0,I=0
"RTN","LROW3",25,0)
 W !!,"You have just selected the following tests for ",PNM,"  ",SSN
"RTN","LROW3",26,0)
 I $G(LRLWC)="LC" W:$G(LRORDTIM) !," for Collection on: ",$$FMTE^XLFDT(LRODT_"."_LRORDTIM,"M")
"RTN","LROW3",27,0)
 W !,?5,"entry no.",?15,"Test",?45,"Sample"
"RTN","LROW3",28,0)
 S I=0 F  S I=$O(LRXST(I)) Q:I<1  D L2
"RTN","LROW3",29,0)
 Q
"RTN","LROW3",30,0)
 ;
"RTN","LROW3",31,0)
 ;
"RTN","LROW3",32,0)
L4 S LRSPEC=$S(I>0:$S($D(^LAB(61,LRXST(I,K),0)):$P(^(0),U),1:""),1:$P(^LAB(61,$P(LRXST(0,K),U,2),0),U))
"RTN","LROW3",33,0)
 Q
"RTN","LROW3",34,0)
 ;
"RTN","LROW3",35,0)
 ;
"RTN","LROW3",36,0)
ENSTIK ;from LRMIBL, LRORD1
"RTN","LROW3",37,0)
 ; Only ask nature of order for CPRS - file #2 patients.
"RTN","LROW3",38,0)
 I $G(LRDPF,2)=2 D  Q:'$D(LRNATURE)
"RTN","LROW3",39,0)
 . D NATURE
"RTN","LROW3",40,0)
 . I $G(LRNATURE)=-1 W !!,$C(7),"...process aborted" S %="^" K LRNATURE
"RTN","LROW3",41,0)
 ;
"RTN","LROW3",42,0)
 D LL3
"RTN","LROW3",43,0)
LL W !!,"All satisfactory" S %=1 D YN^DICN D:%=0 HELP G:%=0 LL Q:%'=2
"RTN","LROW3",44,0)
 ;
"RTN","LROW3",45,0)
LL1 W !,"Delete test entry no.: " R X:DTIME W:X["?" !,"Select entry number to be deleted." W:X'?.N !,"Select one entry at a time." D LL3:X["?" G LL1:X["?"!(X'?.N)
"RTN","LROW3",46,0)
 I '(+X'=X!(X>J)!(X<1)) S LRSAMP=$P(J(X),U),LRSPEC=$P(J(X),U,2),LRTEST=$P(J(X),U,3) K LROT(LRSAMP,LRSPEC,LRTEST) G LL1
"RTN","LROW3",47,0)
 ;
"RTN","LROW3",48,0)
LL1A W !!,"Add more tests" S %=2 D YN^DICN D:%=0 HELP G:%=0 LL1A G ENSTIK:%'=1 K % Q
"RTN","LROW3",49,0)
 ;
"RTN","LROW3",50,0)
 ;
"RTN","LROW3",51,0)
LL2 ;
"RTN","LROW3",52,0)
 S LRSAMP=$P($G(^LAB(62,+I,0)),U)
"RTN","LROW3",53,0)
 S LRSPEC=$P($G(^LAB(61,+L,0)),U)
"RTN","LROW3",54,0)
 S K=0
"RTN","LROW3",55,0)
 F  S K=$O(LROT(I,L,K)) Q:K<1  D
"RTN","LROW3",56,0)
 . S J=J+1,J(J)=I_U_L_U_K
"RTN","LROW3",57,0)
 . W !,?5,J,?15,$P(^LAB(60,+LROT(I,L,K),0),U)," ",?45,LRSAMP
"RTN","LROW3",58,0)
 . W:LRSAMP'=LRSPEC "  ",LRSPEC
"RTN","LROW3",59,0)
 Q
"RTN","LROW3",60,0)
 ;
"RTN","LROW3",61,0)
 ;
"RTN","LROW3",62,0)
LL3 ;
"RTN","LROW3",63,0)
 K J
"RTN","LROW3",64,0)
 S J=0 W !!,"You have just selected the following tests for ",PNM,"  ",SSN
"RTN","LROW3",65,0)
 I LRORDR="LC" W !," for Collection on: ",$$FMTE^XLFDT(LRODT_"."_LRORDTIM,"M")
"RTN","LROW3",66,0)
 W !,?5,"entry no.",?15,"Test",?45,"Sample"
"RTN","LROW3",67,0)
 F I=-1:0 S I=$O(LROT(I)) Q:I=""  D
"RTN","LROW3",68,0)
 . F L=-1:0 S L=$O(LROT(I,L)) Q:L=""  D LL2
"RTN","LROW3",69,0)
 Q
"RTN","LROW3",70,0)
 ;
"RTN","LROW3",71,0)
 ;
"RTN","LROW3",72,0)
HELP W !!,"Answer 'Yes' or 'No' ('^' to cancel)"
"RTN","LROW3",73,0)
 Q
"RTN","LROW3",74,0)
 ;
"RTN","LROW3",75,0)
 ;
"RTN","LROW3",76,0)
X3 K X3(+LRTEST(X),+LRSAMP,+LRXST(LRSAMP,X))
"RTN","LROW3",77,0)
 K LRTEST(X),J(X),LRXST(LRSAMP,X),LRSAMP(X)
"RTN","LROW3",78,0)
 Q
"RTN","LROW3",79,0)
 ;
"RTN","LROW3",80,0)
 ;
"RTN","LROW3",81,0)
NATURE ;Get Nature of order
"RTN","LROW3",82,0)
 I '$D(LRPHSET) D NEW^LROR6()
"RTN","LROW3",83,0)
 Q
"RTN","LRRP")
0^17^B18090876
"RTN","LRRP",1,0)
LRRP ;DALOI/RWF/BA - PROCESS DATA FOR INTERIM REPORTS ; 11/10/88  08:48
"RTN","LRRP",2,0)
 ;;5.2;LAB SERVICE;**195,221,283,286**;Sep 27, 1994
"RTN","LRRP",3,0)
 ;
"RTN","LRRP",4,0)
SET ;from LRRSP, LRRS, LRRD - call with LRORDER=ORDERS, LRODT=DATE, LRDFN
"RTN","LRRP",5,0)
 K ^TMP("LR",$J,"TP"),LRORD
"RTN","LRRP",6,0)
 S:'$D(LRTSCRN) LRTSCRN=0
"RTN","LRRP",7,0)
 S LRLAB=$S($D(LRLABKY):1,1:0),LRHF=1,LRFOOT=0,LRCW=8 Q:'$D(LRODT)
"RTN","LRRP",8,0)
 F LROP=1:1 S LRORD(1)=$P(LRORDER,U,LROP) D TEST Q:LRSTOP!LREND!(LRORD(1)="")
"RTN","LRRP",9,0)
 I 'LREND,'LRSTOP,LRFOOT D FOOT^LRRP1
"RTN","LRRP",10,0)
 K ^TMP("LR",$J,"TP"),LRORD
"RTN","LRRP",11,0)
 Q
"RTN","LRRP",12,0)
 ;
"RTN","LRRP",13,0)
 ;
"RTN","LRRP",14,0)
TEST ;
"RTN","LRRP",15,0)
 I LRORD(1)="" K ^TMP("LR",$J,"TP") Q
"RTN","LRRP",16,0)
 S LRFOUND=1,LRORD=$S($D(^LRO(69,LRODT,1,LRORD(1),0))#2:^(0),1:"") Q:LRORD=""!(+LRORD'=LRDFN)
"RTN","LRRP",17,0)
 K S,LRAAO S LRTEST=0
"RTN","LRRP",18,0)
 F  S LRTEST=+$O(^LRO(69,LRODT,1,LRORD(1),2,LRTEST)) Q:LRTEST<1  S X=^(LRTEST,0) I LRTSCRN=0!(LRTSCRN=+X) D DATA K S
"RTN","LRRP",19,0)
 K S Q:'$D(LRAAO)  Q:LRAAO<.1
"RTN","LRRP",20,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3) D PT^LRX
"RTN","LRRP",21,0)
 S LROC=$S($D(^LR(LRDFN,.1)):^(.1),LRDPF=2&$D(^DPT(DFN,.1)):^(.1),1:"FILE ROOM")
"RTN","LRRP",22,0)
 D ^LRRP1
"RTN","LRRP",23,0)
 Q
"RTN","LRRP",24,0)
 ;
"RTN","LRRP",25,0)
 ;
"RTN","LRRP",26,0)
DATA S LRTSTS=+X,LRAD=$P(X,U,3),LRAA=+$P(X,U,4),LRAN=$P(X,U,5)
"RTN","LRRP",27,0)
 S LRAAO=$S($D(^LRO(68,LRAA,0)):$P(^(0),U,8),1:0)
"RTN","LRRP",28,0)
 I LRAAO<.1 Q:'LRAA  D  Q
"RTN","LRRP",29,0)
 . W !?2,$C(7),$P(^LRO(68,LRAA,0),"^")_" accession area is missing a print order!",!?2,$P(^LAB(60,LRTSTS,0),"^")_" results will not be displayed until this is corrected.",!?2,"Please contact IRM or the Lab ADPAC."
"RTN","LRRP",30,0)
 S LRSS=$P(^LRO(68,LRAA,0),U,2)
"RTN","LRRP",31,0)
 Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))  Q:'$D(^(3))
"RTN","LRRP",32,0)
 S ^TMP("LR",$J,"TP",LRAAO)=LRAA_U_LRSS
"RTN","LRRP",33,0)
 S LRCDT=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),U)
"RTN","LRRP",34,0)
 S LRIDT=+$P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),U,5)
"RTN","LRRP",35,0)
 I 'LRIDT S LRIDT=9999999-LRCDT
"RTN","LRRP",36,0)
 S ^TMP("LR",$J,"TP",LRAAO,LRCDT,-1)=$S($D(^TMP("LR",$J,"TP",LRAAO,-1)):^(-1),1:"")_LRTSTS_U
"RTN","LRRP",37,0)
 S ^TMP("LR",$J,"TP",LRAAO,LRCDT,-2)=LRIDT
"RTN","LRRP",38,0)
 Q:LRSS="MI"
"RTN","LRRP",39,0)
 S (S,J)=0
"RTN","LRRP",40,0)
 F  S J=+$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,J)) Q:J<1  S:^(J,0)>0 S=S+1,S(S)=+^(0)
"RTN","LRRP",41,0)
 S LR0=$S($D(^LR(LRDFN,LRSS,LRIDT,0)):^(0),1:""),LRSPEC=+$P(LR0,U,5),(LRTC,LRLLT)=0
"RTN","LRRP",42,0)
 F  S LRLLT=+$O(S(LRLLT)) Q:LRLLT<1  S LRTSTS=+S(LRLLT) D XPND
"RTN","LRRP",43,0)
 D CMNT
"RTN","LRRP",44,0)
 Q
"RTN","LRRP",45,0)
 ;
"RTN","LRRP",46,0)
 ;
"RTN","LRRP",47,0)
XPND Q:'$D(^LAB(60,LRTSTS,.1))  S LRDN=$P($P(^(0),U,5),";",2)
"RTN","LRRP",48,0)
 I '$L(LRDN) S LRJJ=0 F  S LRJJ=+$O(^LAB(60,LRTSTS,2,LRJJ)) Q:LRJJ<1  S S=S+1,S(S)=+^(LRJJ,0)
"RTN","LRRP",49,0)
 D:$L(LRDN) SETUP
"RTN","LRRP",50,0)
 Q
"RTN","LRRP",51,0)
 ;
"RTN","LRRP",52,0)
 ;
"RTN","LRRP",53,0)
SETUP Q:'LRTSTS  Q:'$D(^LAB(60,LRTSTS,.1))  S X=^(.1)
"RTN","LRRP",54,0)
 I 'LRLAB,"BO"'[$P(^LAB(60,LRTSTS,0),U,3) Q
"RTN","LRRP",55,0)
 Q:'$D(^LR(LRDFN,LRSS,LRIDT,LRDN))  Q:'$L($P(^(LRDN),U))
"RTN","LRRP",56,0)
 S LRPO=$P(X,U,6),LRPO=$S(LRPO:LRPO,1:LRDN/1000000)
"RTN","LRRP",57,0)
 F  Q:'$D(^TMP("LR",$J,"TP",LRAAO,LRCDT,LRPO))  Q:LRTSTS=+^(LRPO)  S LRPO=LRPO+1
"RTN","LRRP",58,0)
 Q:$D(^TMP("LR",$J,"TP",LRAAO,LRCDT,LRPO))
"RTN","LRRP",59,0)
 S ^TMP("LR",$J,"TP",LRAAO,LRCDT,LRPO)=LRTSTS_U_$P(^LAB(60,LRTSTS,0),U)_U_$P(X,U)_U_$P(X,U,2)_U_$P(X,U,3)_U_$P(^(0),U,5)_U_$P(^LR(LRDFN,LRSS,LRIDT,LRDN),U)_U_$P(^(LRDN),U,2)_U_$P(^(LRDN),U,9)_U_LRDN,LRTC=LRTC+1
"RTN","LRRP",60,0)
 ;
"RTN","LRRP",61,0)
 I $D(^LAB(60,LRTSTS,1,LRSPEC,1,0)) D
"RTN","LRRP",62,0)
 . S LRINTP=0
"RTN","LRRP",63,0)
 . F  S LRINTP=+$O(^LAB(60,LRTSTS,1,LRSPEC,1,LRINTP)) Q:LRINTP<1  S ^TMP("LR",$J,"TP",LRAAO,LRCDT,LRPO,LRINTP)=^(LRINTP,0) S LRTC=LRTC+1
"RTN","LRRP",64,0)
 Q
"RTN","LRRP",65,0)
 ;
"RTN","LRRP",66,0)
 ;
"RTN","LRRP",67,0)
CMNT ;
"RTN","LRRP",68,0)
 S ^TMP("LR",$J,"TP",LRAAO)=LRAA_U_LRSS,^(LRAAO,LRCDT)=LR0,^(LRCDT,-1)=""
"RTN","LRRP",69,0)
 S ^TMP("LR",$J,"TP",LRAAO,LRCDT,-2)=LRIDT
"RTN","LRRP",70,0)
 ;
"RTN","LRRP",71,0)
 S LRCMNT=0 F I=0:0 S LRCMNT=+$O(^LR(LRDFN,LRSS,LRIDT,1,LRCMNT)) Q:LRCMNT<1  S ^TMP("LR",$J,"TP",LRAAO,LRCDT,"C",LRCMNT)=^(LRCMNT,0) S LRTC=LRTC+1
"RTN","LRRP",72,0)
 S $P(^TMP("LR",$J,"TP",LRAAO,LRCDT),U,12)=LRTC
"RTN","LRRP",73,0)
 Q
"RTN","LRRP",74,0)
 ;
"RTN","LRRP",75,0)
 ;
"RTN","LRRP",76,0)
CH ;from LRRP2
"RTN","LRRP",77,0)
 S LRDN=1
"RTN","LRRP",78,0)
 F  S LRDN=$O(^LR(LRDFN,"CH",LRIDT,LRDN)) Q:LRDN<1  S LRTSTS=$O(^LAB(60,"C","CH;"_LRDN_";1",0)) D SETUP
"RTN","LRRP",79,0)
 D CMNT,^LRRP1
"RTN","LRRP",80,0)
 Q
"RTN","LRRP",81,0)
 ;
"RTN","LRRP",82,0)
 ;
"RTN","LRRP",83,0)
GO ;from LRRP3
"RTN","LRRP",84,0)
 S LRLAB=$S($D(LRLABKY):1,1:0),LRDN=1
"RTN","LRRP",85,0)
 F  S LRDN=$O(^TMP("LR",$J,"TMP",LRDN)) Q:LRDN<1  S LRTSTS=+^(LRDN) D SETUP
"RTN","LRRP",86,0)
 D CMNT,^LRRP1
"RTN","LRRP",87,0)
 Q
"RTN","LRRP1")
0^18^B21441496
"RTN","LRRP1",1,0)
LRRP1 ;DALOI/RWF/BA-PRINT THE DATA FOR INTERIM REPORTS ;11/9/88  17:31
"RTN","LRRP1",2,0)
 ;;5.2;LAB SERVICE;**153,221,283,286**;Sep 27, 1994
"RTN","LRRP1",3,0)
 ;from LRRP, LRRP2, LRRP3
"RTN","LRRP1",4,0)
 ;
"RTN","LRRP1",5,0)
PRINT S:'$L($G(SEX)) SEX="M" S:'$L($G(DOB)) DOB="UNKNOWN"
"RTN","LRRP1",6,0)
 S LRAAO=0 F  S LRAAO=$O(^TMP("LR",$J,"TP",LRAAO)) Q:LRAAO<1  D ORDER Q:LRSTOP
"RTN","LRRP1",7,0)
 K ^TMP("LR",$J,"TP")
"RTN","LRRP1",8,0)
 Q
"RTN","LRRP1",9,0)
 ;
"RTN","LRRP1",10,0)
 ;
"RTN","LRRP1",11,0)
ORDER N LRCAN
"RTN","LRRP1",12,0)
 S LRCDT=0
"RTN","LRRP1",13,0)
 F  S LRCDT=$O(^TMP("LR",$J,"TP",LRAAO,LRCDT)) Q:LRCDT<1  D
"RTN","LRRP1",14,0)
 . S LRCAN=0
"RTN","LRRP1",15,0)
 . I LRSS="CH" D
"RTN","LRRP1",16,0)
 . . S LRIDT=+^TMP("LR",$J,"TP",LRAAO,LRCDT,-2)
"RTN","LRRP1",17,0)
 . . F  S LRCAN=+$O(^LR(LRDFN,"CH",LRIDT,1,LRCAN)) Q:LRCAN<1  Q:$E($G(^(LRCAN,0)))="*"
"RTN","LRRP1",18,0)
 . D TEST Q:LRSTOP
"RTN","LRRP1",19,0)
 Q
"RTN","LRRP1",20,0)
 ;
"RTN","LRRP1",21,0)
 ;
"RTN","LRRP1",22,0)
TEST ;
"RTN","LRRP1",23,0)
 S LRIDT=+^TMP("LR",$J,"TP",LRAAO,LRCDT,-2)
"RTN","LRRP1",24,0)
 S LRSS=$P(^TMP("LR",$J,"TP",LRAAO),U,2)
"RTN","LRRP1",25,0)
 S LR0=$S($D(^(LRAAO,LRCDT))#2:^(LRCDT),1:""),LRTC=$P(LR0,U,12)
"RTN","LRRP1",26,0)
 I LRSS="MI" D  Q
"RTN","LRRP1",27,0)
 . S LRH=1 D:LRFOOT FOOT Q:LRSTOP
"RTN","LRRP1",28,0)
 . D EN1^LRMIPC
"RTN","LRRP1",29,0)
 . S LRHF=1,LRFOOT=0
"RTN","LRRP1",30,0)
 . K A,Z,LRH
"RTN","LRRP1",31,0)
 . S:LREND LREND=0,LRSTOP=1
"RTN","LRRP1",32,0)
 ;
"RTN","LRRP1",33,0)
 Q:'$G(LRCAN)&('$P(LR0,U,3))  D @$S(LRHF:"HDR",1:"CHECK") Q:LRSTOP
"RTN","LRRP1",34,0)
 S LRSPEC=+$P(LR0,U,5),X=$P(LR0,U,10) D DOC^LRX
"RTN","LRRP1",35,0)
 ;
"RTN","LRRP1",36,0)
 W !!,?7,"Provider: ",LRDOC
"RTN","LRRP1",37,0)
 W !,?7,"Specimen: ",$P(^LAB(61,LRSPEC,0),U)
"RTN","LRRP1",38,0)
 D ORU
"RTN","LRRP1",39,0)
 W !!,?30,"Specimen Collection Date: ",$$FMTE^XLFDT(LRCDT,"M")
"RTN","LRRP1",40,0)
 W !?5,"Test name",?30,"Result    units",?51,"Ref.   range",?66,"Site Code"
"RTN","LRRP1",41,0)
 S LRPO=0
"RTN","LRRP1",42,0)
 F  S LRPO=$O(^TMP("LR",$J,"TP",LRAAO,LRCDT,LRPO)) Q:LRPO'>0  S LRDATA=^(LRPO) D DATA Q:LRSTOP
"RTN","LRRP1",43,0)
 Q:LRSTOP
"RTN","LRRP1",44,0)
 ;
"RTN","LRRP1",45,0)
 I $D(^TMP("LR",$J,"TP",LRAAO,LRCDT,"C")) D
"RTN","LRRP1",46,0)
 . W !,"Comment: " S LRCMNT=0
"RTN","LRRP1",47,0)
 . F  S LRCMNT=+$O(^TMP("LR",$J,"TP",LRAAO,LRCDT,"C",LRCMNT)) Q:LRCMNT<1  D  Q:LRSTOP
"RTN","LRRP1",48,0)
 . . W ^TMP("LR",$J,"TP",LRAAO,LRCDT,"C",LRCMNT)
"RTN","LRRP1",49,0)
 . . D CONT Q:LRSTOP
"RTN","LRRP1",50,0)
 . . W:$O(^TMP("LR",$J,"TP",LRAAO,LRCDT,"C",LRCMNT)) !?9
"RTN","LRRP1",51,0)
 Q:LRSTOP  D EQUALS^LRX
"RTN","LRRP1",52,0)
 W !?7,"KEY: ""L""=Abnormal low, ""H""=Abnormal high, ""*""=Critical value"
"RTN","LRRP1",53,0)
 S LRFOOT=1
"RTN","LRRP1",54,0)
 Q
"RTN","LRRP1",55,0)
 ;
"RTN","LRRP1",56,0)
 ;
"RTN","LRRP1",57,0)
DATA ;
"RTN","LRRP1",58,0)
 N LR63DATA
"RTN","LRRP1",59,0)
 ;
"RTN","LRRP1",60,0)
 S LRTSTS=+LRDATA,LRPC=$P(LRDATA,U,5),LRSUB=$P(LRDATA,U,6)
"RTN","LRRP1",61,0)
 S X=$P(LRDATA,U,7) Q:X=""
"RTN","LRRP1",62,0)
 S LR63DATA=$$TSTRES^LRRPU(LRDFN,LRSS,LRIDT,$P(LRDATA,U,10),LRTSTS)
"RTN","LRRP1",63,0)
 S LRLO=$P(LR63DATA,"^",3),LRHI=$P(LR63DATA,"^",4),LRPLS=$P(LR63DATA,"^",6),LRTHER=$P(LR63DATA,"^",7)
"RTN","LRRP1",64,0)
 I LRPLS S LRPLS(LRPLS)=LRPLS
"RTN","LRRP1",65,0)
 ;
"RTN","LRRP1",66,0)
 W !?5,$S($L($P(LRDATA,U,2))>20:$P(LRDATA,U,3),1:$P(LRDATA,U,2))
"RTN","LRRP1",67,0)
 S X=$P(LR63DATA,"^")
"RTN","LRRP1",68,0)
 W ?27,@$S(LRPC="":"$J(X,LRCW)",1:LRPC)," ",$P(LR63DATA,"^",2)
"RTN","LRRP1",69,0)
 I $X>39 W !
"RTN","LRRP1",70,0)
 W ?40,$P(LR63DATA,U,5)
"RTN","LRRP1",71,0)
 I $X>50 W !
"RTN","LRRP1",72,0)
 W ?51,$J(LRLO,4),$S(LRHI'="":" - "_$J(LRHI,4),1:"")
"RTN","LRRP1",73,0)
 ;
"RTN","LRRP1",74,0)
 I LRPLS'="" D
"RTN","LRRP1",75,0)
 . I $X>67 W !
"RTN","LRRP1",76,0)
 . W ?68,"[",LRPLS,"]"
"RTN","LRRP1",77,0)
 D CONT Q:LRSTOP
"RTN","LRRP1",78,0)
 ;
"RTN","LRRP1",79,0)
 I $O(^TMP("LR",$J,"TP",LRAAO,LRCDT,LRPO,0))>0 D  Q:LRSTOP
"RTN","LRRP1",80,0)
 . S LRINTP=0
"RTN","LRRP1",81,0)
 . F  S LRINTP=+$O(^TMP("LR",$J,"TP",LRAAO,LRCDT,LRPO,LRINTP)) Q:LRINTP<1  W !?7,"Eval: ",^(LRINTP) D CONT Q:LRSTOP
"RTN","LRRP1",82,0)
 ;
"RTN","LRRP1",83,0)
 Q
"RTN","LRRP1",84,0)
 ;
"RTN","LRRP1",85,0)
 ;
"RTN","LRRP1",86,0)
CHECK I LRTC+11>(IOSL-$Y) D FOOT Q:LRSTOP  D HDR
"RTN","LRRP1",87,0)
 Q
"RTN","LRRP1",88,0)
 ;
"RTN","LRRP1",89,0)
 ;
"RTN","LRRP1",90,0)
CONT I $Y+5>IOSL D FOOT Q:LRSTOP  D HDR W !?20,">> CONTINUATION OF ",$P(LR0,U,6)," <<",!
"RTN","LRRP1",91,0)
 Q
"RTN","LRRP1",92,0)
FOOT ;from LRRP, LRRP2, LRRP3
"RTN","LRRP1",93,0)
 Q:LRSTOP  F I=$Y:1:IOSL-4 W !
"RTN","LRRP1",94,0)
 I $E(IOST,1,2)'="C-" W !,PNM,?40,"  ",SSN,"  ",$$HTE^XLFDT($H,"M"),! Q
"RTN","LRRP1",95,0)
 W !,PNM,?25,"  ",SSN,"  ",$$HTE^XLFDT($H,"MP"),?59," PRESS '^' TO STOP "
"RTN","LRRP1",96,0)
 R X:DTIME S:X="" X=1 S:(".^"[X)!('$T) LRSTOP=1
"RTN","LRRP1",97,0)
 Q
"RTN","LRRP1",98,0)
 ;
"RTN","LRRP1",99,0)
 ;
"RTN","LRRP1",100,0)
HDR ; Add Printed at, page #, change age to dob 7/2002 cka
"RTN","LRRP1",101,0)
 W:($G(LRJ02))!($G(LRJ0))!($E(IOST,1,2)="C-") @IOF
"RTN","LRRP1",102,0)
 S LRHF=0,LRJ02=1
"RTN","LRRP1",103,0)
 I '$D(LRPG) S LRPG=0
"RTN","LRRP1",104,0)
 S LRPG=LRPG+1
"RTN","LRRP1",105,0)
 I $E(IOST,1)="P" D
"RTN","LRRP1",106,0)
 .W !!!!
"RTN","LRRP1",107,0)
 .S X="CLINICAL LABORATORY REPORT"
"RTN","LRRP1",108,0)
 .W ?(80-$L(X)\2),X,!
"RTN","LRRP1",109,0)
 I $D(DUZ("AG")),$L(DUZ("AG")),"ARMYAFN"[DUZ("AG") D ^LRAIPRIV W !
"RTN","LRRP1",110,0)
 W "Printed at: ",?65,"page ",LRPG
"RTN","LRRP1",111,0)
 W !,$$NAME^XUAF4(DUZ(2))," (",DUZ(2),")"
"RTN","LRRP1",112,0)
 S X=$$PADD^XUAF4(DUZ(2))
"RTN","LRRP1",113,0)
 W !,$P(X,U)," ",$P(X,U,2),", ",$P(X,U,3)," ",$P(X,U,4)
"RTN","LRRP1",114,0)
 W !!,PNM,?44,"Report date: ",$$HTE^XLFDT($H,"M")
"RTN","LRRP1",115,0)
 W !?5,"SSN: ",SSN,"    SEX: ",SEX,"    DOB: ",$$FMTE^XLFDT(DOB),"    LOC: ",LROC
"RTN","LRRP1",116,0)
 Q
"RTN","LRRP1",117,0)
 ;
"RTN","LRRP1",118,0)
ORU ; Display remote ordering info if available
"RTN","LRRP1",119,0)
 N LRX,IENS
"RTN","LRRP1",120,0)
 S LRX=$G(^LR(LRDFN,"CH",LRIDT,"ORU")),IENS=LRIDT_","_LRDFN_","
"RTN","LRRP1",121,0)
 D EN^DDIOL("Accession [UID]: "_$P(LR0,"^",6)_" ["_$P(LRX,"^")_"]","","!")
"RTN","LRRP1",122,0)
 I $P(LRX,"^",3) D
"RTN","LRRP1",123,0)
 . D EN^DDIOL("Ordering Site: "_$$GET1^DIQ(63.04,IENS,.33,""),"","!?2")
"RTN","LRRP1",124,0)
 . D EN^DDIOL(" Ordering Site UID: "_$P(LRX,"^",5),"","?43")
"RTN","LRRP1",125,0)
 I $P(LRX,"^",2) D EN^DDIOL("Collecting Site: "_$$GET1^DIQ(63.04,IENS,.32,""),"","!")
"RTN","LRRP1",126,0)
 Q
"RTN","LRRPU")
0^19^B9809057
"RTN","LRRPU",1,0)
LRRPU ;DALOI/JMC - Interim Report Results Utility ; May 10, 2004 0900
"RTN","LRRPU",2,0)
 ;;5.2;LAB SERVICE;**286**;Sep 27, 1994
"RTN","LRRPU",3,0)
 ;
"RTN","LRRPU",4,0)
 ;
"RTN","LRRPU",5,0)
TSTRES(LRDFN,LRSS,LRIDT,LRDN,LR60,LRCODE) ; Test results and parameters
"RTN","LRRPU",6,0)
 ; Call with LRDFN = ien of entry in file #63
"RTN","LRRPU",7,0)
 ;            LRSS = subscript in file #63, currently only "CH" supported
"RTN","LRRPU",8,0)
 ;           LRIDT = inverse date/time of result
"RTN","LRRPU",9,0)
 ;            LRDN = ien of data name in "CH" subscript
"RTN","LRRPU",10,0)
 ;            LR60 = pointer to file 60 test related to this dataname (optional)
"RTN","LRRPU",11,0)
 ;          LRCODE = 1 - return NLT/LOINC codes (optional)
"RTN","LRRPU",12,0)
 ;
"RTN","LRRPU",13,0)
 ; Returns
"RTN","LRRPU",14,0)
 ;  LRY = result^normalcy flag^reference low^reference high^units^performing lab (file #4 ien)^therapeutic normal used (0=no/1=yes)^NLT order code;NLT name!NLT result code;NLT name!LOINC result code;LOINC name^performing user (DUZ)^EII
"RTN","LRRPU",15,0)
 ;
"RTN","LRRPU",16,0)
 N LRFLAG,LRNR,LRX,LRY,X,Y
"RTN","LRRPU",17,0)
 S LRX=$G(^LR(LRDFN,LRSS,LRIDT,LRDN))
"RTN","LRRPU",18,0)
 S LRY=$P(LRX,"^",1,2),$P(LRY,"^",7)=0
"RTN","LRRPU",19,0)
 I LRSS="CH",$$GET1^DID(63.04,LRDN,"","TYPE")="SET" D
"RTN","LRRPU",20,0)
 . S X=$$EXTERNAL^DILFD(63.04,LRDN,"",$P(LRY,"^"))
"RTN","LRRPU",21,0)
 . I X'="" S $P(LRY,"^")=X
"RTN","LRRPU",22,0)
 ;
"RTN","LRRPU",23,0)
 ; Check for units/ranges stored in file #63
"RTN","LRRPU",24,0)
 ; If flag (NPC>1) indicates units/ranges are stored but pieces 5-12
"RTN","LRRPU",25,0)
 ; are null then use values from file #60 - some class III software
"RTN","LRRPU",26,0)
 ; still does not store this info in file #63 when NPC>1.
"RTN","LRRPU",27,0)
 S LRFLAG=0,LRNR=$TR($P(LRX,"^",5),"!","^")
"RTN","LRRPU",28,0)
 I $G(^LR(LRDFN,LRSS,LRIDT,"NPC"))>1,$P(LRX,"^",5,12)'="" S LRFLAG=1
"RTN","LRRPU",29,0)
 ;
"RTN","LRRPU",30,0)
 I LRFLAG D
"RTN","LRRPU",31,0)
 . I $P(LRNR,"^",11)="",$P(LRNR,"^",12)="" S $P(LRY,"^",3,4)=$P(LRNR,"^",2,3)
"RTN","LRRPU",32,0)
 . E  S $P(LRY,"^",3,4)=$P(LRNR,"^",11,12),$P(LRY,"^",7)=1
"RTN","LRRPU",33,0)
 . S $P(LRY,"^",5)=$P(LRNR,"^",7)
"RTN","LRRPU",34,0)
 ;
"RTN","LRRPU",35,0)
 ; If no units/ranges (LRFLAG=0) then use file 60
"RTN","LRRPU",36,0)
 ; values to determine reference ranges
"RTN","LRRPU",37,0)
 ; If no therapeutic normals then return reference normals
"RTN","LRRPU",38,0)
 ; Need to handle age and sex in normals from file #60
"RTN","LRRPU",39,0)
 I 'LRFLAG D
"RTN","LRRPU",40,0)
 . N AGE,DOB,LR61,LRCDT,LRDPF,LRLO,LRHI,LRTLO,LRTHI,SEX,X
"RTN","LRRPU",41,0)
 . S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3)
"RTN","LRRPU",42,0)
 . S X=$G(^LR(LRDFN,LRSS,LRIDT,0)),LRCDT=$P(X,"^"),LR61=+$P(X,"^",5)
"RTN","LRRPU",43,0)
 . S X=$$ROOT^DILFD(+LRDPF)
"RTN","LRRPU",44,0)
 . S SEX=$P($G(@(X_+DFN_",0)")),"^",2),DOB=$P($G(@(X_+DFN_",0)")),"^",3)
"RTN","LRRPU",45,0)
 . S AGE=$$CALCAGE(DOB,LRCDT)
"RTN","LRRPU",46,0)
 . I '$G(LR60) S LR60=+$O(^LAB(60,"C","CH;"_LRDN_";1",0))
"RTN","LRRPU",47,0)
 . S X=$G(^LAB(60,LR60,1,LR61,0)) Q:X=""
"RTN","LRRPU",48,0)
 . S $P(LRY,"^",5)=$P(X,"^",7)
"RTN","LRRPU",49,0)
 . S LRLO=$P(X,U,2),LRHI=$P(X,U,3),LRTLO=$P(X,U,11),LRTHI=$P(X,U,12)
"RTN","LRRPU",50,0)
 . I LRTLO="",LRTHI="" D  Q
"RTN","LRRPU",51,0)
 . . I LRLO'="" S @("LRLO="_LRLO)
"RTN","LRRPU",52,0)
 . . I LRHI'="" S @("LRHI="_LRHI)
"RTN","LRRPU",53,0)
 . . S $P(LRY,"^",3)=LRLO,$P(LRY,"^",4)=LRHI
"RTN","LRRPU",54,0)
 . I LRTLO'="" S @("LRTLO="_LRTLO)
"RTN","LRRPU",55,0)
 . I LRTHI'="" S @("LRTHI="_LRTHI)
"RTN","LRRPU",56,0)
 . S $P(LRY,"^",3)=LRTLO,$P(LRY,"^",4)=LRTHI,$P(LRY,"^",7)=1
"RTN","LRRPU",57,0)
 ;
"RTN","LRRPU",58,0)
 ; Remove leading/trailing quotes from normals.
"RTN","LRRPU",59,0)
 I $P(LRY,"^",3)[$C(34) S $P(LRY,"^",3)=$$TRIM^XLFSTR($P(LRY,"^",3),"LR",$C(34))
"RTN","LRRPU",60,0)
 I $P(LRY,"^",4)[$C(34) S $P(LRY,"^",4)=$$TRIM^XLFSTR($P(LRY,"^",4),"LR",$C(34))
"RTN","LRRPU",61,0)
 ; Performing laboratory
"RTN","LRRPU",62,0)
 S $P(LRY,"^",6)=$P(LRX,"^",9)
"RTN","LRRPU",63,0)
 ;
"RTN","LRRPU",64,0)
 ; Return NLT/LOINC codes
"RTN","LRRPU",65,0)
 I $G(LRCODE)=1 D
"RTN","LRRPU",66,0)
 . N LR64
"RTN","LRRPU",67,0)
 . S X=$P($P(LRX,"^",3),"!",1,3)
"RTN","LRRPU",68,0)
 . F I=1,2 I $P(X,"!",I)'="" D
"RTN","LRRPU",69,0)
 . . S LR64=$O(^LAM("E",$P(X,"!",I),0)),Y=""
"RTN","LRRPU",70,0)
 . . I LR64 S Y=$$GET1^DIQ(64,LR64_",",.01,"I")
"RTN","LRRPU",71,0)
 . . I Y'="",Y["!" S Y=$TR(Y,"!","*")
"RTN","LRRPU",72,0)
 . . S $P(X,"!",I)=$P(X,"!",I)_";"_Y
"RTN","LRRPU",73,0)
 . I $P(X,"!",3)'="" D
"RTN","LRRPU",74,0)
 . . S Y=$$GET1^DIQ(95.3,$P(X,"!",3)_",",.01)
"RTN","LRRPU",75,0)
 . . S Y(0)=$$GET1^DIQ(95.3,$P(X,"!",3)_",",80)
"RTN","LRRPU",76,0)
 . . I Y(0)["!" S Y(0)=$TR(Y(0),"!","*")
"RTN","LRRPU",77,0)
 . . S $P(X,"!",3)=Y_";"_Y(0)
"RTN","LRRPU",78,0)
 . S $P(LRY,"^",8)=X
"RTN","LRRPU",79,0)
 ;
"RTN","LRRPU",80,0)
 ; Performing user
"RTN","LRRPU",81,0)
 S $P(LRY,"^",9)=$P(LRX,"^",4)
"RTN","LRRPU",82,0)
 ; EII - Equipment instance Identifier
"RTN","LRRPU",83,0)
 S $P(LRY,"^",10)=$P(LRX,"^",11)
"RTN","LRRPU",84,0)
 ;
"RTN","LRRPU",85,0)
 Q LRY
"RTN","LRRPU",86,0)
 ;
"RTN","LRRPU",87,0)
 ;
"RTN","LRRPU",88,0)
CALCAGE(DOB,LRCDT) ; Calculate age based on difference between DOB and collection date.
"RTN","LRRPU",89,0)
 ;
"RTN","LRRPU",90,0)
 ; Call with DOB = patient date of birth
"RTN","LRRPU",91,0)
 ;         LRCDT = specimen collection date
"RTN","LRRPU",92,0)
 ;
"RTN","LRRPU",93,0)
 ; Returns   AGE = patient's age in years at time of specimen collection
"RTN","LRRPU",94,0)
 ;
"RTN","LRRPU",95,0)
 I $T(DATE^LRDAGE)'="" Q $$DATE^LRDAGE(DOB,LRCDT)
"RTN","LRRPU",96,0)
 ;
"RTN","LRRPU",97,0)
 S AGE=99
"RTN","LRRPU",98,0)
 I DOB>2000000,LRCDT>2000000,DOB'>LRCDT S X=$$FMDIFF^XLFDT(LRCDT,DOB,1),AGE=X\365.25
"RTN","LRRPU",99,0)
 Q AGE
"RTN","LRSTUF1")
0^39^B16472498
"RTN","LRSTUF1",1,0)
LRSTUF1 ;DALOI/CJS - MASS DATA ENTRY INTO FILE 63.04 ;5/13/03 1300
"RTN","LRSTUF1",2,0)
 ;;5.2;LAB SERVICE;**153,286**;Sep 27, 1994
"RTN","LRSTUF1",3,0)
 K ^TMP("LR",$J,"VTO"),M,LRSB,^TMP("LR",$J,"TMP")
"RTN","LRSTUF1",4,0)
 S DIC=68,DIC(0)="AEZMOQ" D ^DIC Q:Y<1  S LRAA=+Y
"RTN","LRSTUF1",5,0)
 S X=$$SELPL^LRVERA(DUZ(2))
"RTN","LRSTUF1",6,0)
 I X<1 Q
"RTN","LRSTUF1",7,0)
 I X'=DUZ(2) N LRDUZ S LRDUZ(2)=X
"RTN","LRSTUF1",8,0)
 I $P(LRPARAM,U,14),$P($G(^LRO(68,LRAA,0)),U,16) D ^LRCAPV Q:$G(LREND)
"RTN","LRSTUF1",9,0)
DAT D ADATE^LRWU Q:Y<1
"RTN","LRSTUF1",10,0)
TEST S DIC="^LAB(60,",DIC("A")="Select ORDERED TEST: ",DIC(0)="AEZOQ"
"RTN","LRSTUF1",11,0)
 D ^DIC Q:Y<1
"RTN","LRSTUF1",12,0)
 S LRTEST=+Y,^TMP("LR",$J,"VTO",+Y)=$P($P(Y(0),U,5),";",2)
"RTN","LRSTUF1",13,0)
 ;
"RTN","LRSTUF1",14,0)
 K ^TMP("LR",$J,"T"),LRORD,LRTSTS
"RTN","LRSTUF1",15,0)
 D ^LREXPD
"RTN","LRSTUF1",16,0)
 K A
"RTN","LRSTUF1",17,0)
 S (A1,I)=0 F  S I=$O(^TMP("LR",$J,"T",I)) Q:I<1  S X=^(I),A(+$P($P(X,"^",12),",",2))=I,A1=A1+1 S:$P(X,U,17) M($P($P(X,U,5),";",2))=I
"RTN","LRSTUF1",18,0)
 S LRTESTSV=LRTEST,LRFFLG="" I A1=1 S LRFLD=+$O(A(0)) G L2
"RTN","LRSTUF1",19,0)
 I A1<1 W !,"No way to put data in for that test." Q
"RTN","LRSTUF1",20,0)
 S I=0
"RTN","LRSTUF1",21,0)
 F  S I=$O(A(I)) Q:I<1  W !,I,?5," ",$P(^DD(63.04,I,0),"^")
"RTN","LRSTUF1",22,0)
 ;
"RTN","LRSTUF1",23,0)
L1 S DIC("A")="Enter the field to edit: ",DIC(0)="AE",DIC("S")="I $D(A(+Y))",DIC="^DD(63.04," D ^DIC K DIC G LREND:Y=-1 S LRFLD=+Y
"RTN","LRSTUF1",24,0)
L2 W !,"1  Automatically enter your entry.",!,"2  Prompt with your entry.",!,"3  Just Prompt."
"RTN","LRSTUF1",25,0)
 R !,"Choice: ",X:DTIME Q:X=""!(X["^")  I +X'=X!(X>3)!(X<1)!(X?.E1"."1N.N) W !,"Enter a number between 1 and 3." G L2
"RTN","LRSTUF1",26,0)
L3 S LRA=X K LRSTUFF,DIC I X<3 W !,"What do you want entered?: " R LRSTUFF:DTIME I LRSTUFF="?" W !,"    What you enter will go through the input transform to be stored in the",!,"    field you have specified." G L3
"RTN","LRSTUF1",27,0)
 W !,"I will ",$S(X=1:"automatically stuff ",1:"prompt "),$P(^DD(63.04,LRFLD,0),U) W:$D(LRSTUFF) !,"with ",LRSTUFF W !,"   ...OK" S %=1 D YN^DICN G TEST:%=-1,L3:%'=1
"RTN","LRSTUF1",28,0)
 S DR=LRFLD_$S(X=1:"///"_LRSTUFF,X=2:"//"_LRSTUFF,1:"")_";S LRVX=X;.03///N;S LRNOW=X;.04////"_DUZ,^TMP("LR",$J,"VTO",A(LRFLD))=LRFLD
"RTN","LRSTUF1",29,0)
 K LRAC W !,"Enter the accessions you wish to edit."
"RTN","LRSTUF1",30,0)
 W !,"Enter a string of numbers separated with , . ^ or space,",!,"or a range of numbers, e.g. 50-75.  You may enter more than one line."
"RTN","LRSTUF1",31,0)
LOOP R !,"Enter your selection(s) > ",X:DTIME I X="?" W !,"Enter a string of numbers separated with , . ^ or space,",!,"or a range of numbers, e.g. 50-75.  You may enter more than one line." G LOOP
"RTN","LRSTUF1",32,0)
 S D=$S(X[",":",",X[".":".",X["^":"^",1:" ") F I=1:1 S LRAC=$P(X,D,I) D:LRAC["-" RANGE^LRSTUF2 Q:LRAC=""  S LRAC(+LRAC)=""
"RTN","LRSTUF1",33,0)
 G LOOP:'(X=""!(X="^"))
"RTN","LRSTUF1",34,0)
 I $O(LRAC(0))>0 W !,"Editing the following:" S LRAC=0 F  S LRAC=$O(LRAC(LRAC)) Q:LRAC<1  I $D(^LRO(68,LRAA,1,LRAD,1,LRAC,0)) S LRDFN=+^(0),LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3) D PT^LRX W !,"Acc #: ",LRAC,?15,PNM,?45,SSN
"RTN","LRSTUF1",35,0)
 K ^TMP("LR",$J,"T"),A,LRTSTS,LRORD
"RTN","LRSTUF1",36,0)
 S X=DUZ D DUZ^LRX
"RTN","LRSTUF1",37,0)
 R !,"If everything is OK, enter your initials: ",LRINI:DTIME I LRINI'=LRUSI!'$L(LRUSI) W !,"NOT APPROVED" G LREND
"RTN","LRSTUF1",38,0)
 S LRTN=1,LRSS="CH",LROUTINE=$P(^LAB(69.9,1,3),U,2) S I=0 F  S I=$O(M(I)) Q:I<1  S ^TMP("LR",$J,"TMP",LRSS,I)=1
"RTN","LRSTUF1",39,0)
 S %DT="T",X="N",LRTEC=LRUSI D ^%DT S LRNOW=+Y,LREND=0,LRAN=0
"RTN","LRSTUF1",40,0)
 F  S LRAN=$O(LRAC(LRAN)) Q:LRAN<1  D LRSTUFF^LRSTUF2 Q:LREND
"RTN","LRSTUF1",41,0)
 G LREND
"RTN","LRSTUF1",42,0)
LREND Q
"RTN","LRVER")
0^1^B42247710
"RTN","LRVER",1,0)
LRVER ;DALOI/CJS/FHS - LAB ROUTINE DATA VERIFICATION ; Nov 4, 2004;
"RTN","LRVER",2,0)
 ;;5.2;LAB SERVICE;**153,286**;Sep 27, 1994
"RTN","LRVER",3,0)
 D ^LRPARAM
"RTN","LRVER",4,0)
 S LRCW=8,LREND=0,LRPANEL=0,LRUID=""
"RTN","LRVER",5,0)
 K DIC,LRPER,DUOUT
"RTN","LRVER",6,0)
 D REV
"RTN","LRVER",7,0)
 I LREND D QUIT Q
"RTN","LRVER",8,0)
 D VERDIS
"RTN","LRVER",9,0)
 I LREND D QUIT Q
"RTN","LRVER",10,0)
 D CMTDSP^LRVERA
"RTN","LRVER",11,0)
 S (LRAA,LRAD,LRAN)=0
"RTN","LRVER",12,0)
 N LRVBY S LRVBY=$$SELBY^LRWU4("Verify by")
"RTN","LRVER",13,0)
 D:LRVBY=1 ^LRVERA D:LRVBY=2 UID^LRVERA
"RTN","LRVER",14,0)
 I 'LRVBY!(LRAA<1) D QUIT Q
"RTN","LRVER",15,0)
 S X=$$SELPL^LRVERA(DUZ(2))
"RTN","LRVER",16,0)
 I X<1 D QUIT Q
"RTN","LRVER",17,0)
 I X'=DUZ(2) N LRDUZ S LRDUZ(2)=X
"RTN","LRVER",18,0)
 I $P(LRPARAM,U,14),$P($G(^LRO(68,LRAA,0)),U,16) D ^LRCAPV G QUIT:$G(LREND)
"RTN","LRVER",19,0)
SLOW S LRSS=$P(^LRO(68,LRAA,0),U,2)
"RTN","LRVER",20,0)
 ;
"RTN","LRVER",21,0)
 I LRSS="MI" D  Q
"RTN","LRVER",22,0)
 . S X=DUZ D DUZ^LRX S LRTEC=LRUSI
"RTN","LRVER",23,0)
 . S LRPTP=-1,LRMIDEF=$P(^LAB(69.9,1,1),U,10),LRMIOTH=$P(^(1),U,11)
"RTN","LRVER",24,0)
 . D ^LRMIEDZ2,END^LRMIEDZ,QUIT
"RTN","LRVER",25,0)
 ;
"RTN","LRVER",26,0)
 I LRSS'="CH" G QUIT
"RTN","LRVER",27,0)
 ;
"RTN","LRVER",28,0)
 ; The rest of the code only works on the "CH" area.
"RTN","LRVER",29,0)
DAT I LRAD<1 D ADATE^LRWU
"RTN","LRVER",30,0)
 Q:LRAD<1
"RTN","LRVER",31,0)
 S %H=$H-$P(^LAB(69.9,1,0),U,7) D YMD^%DTC S LRTM60=9999999-X
"RTN","LRVER",32,0)
 I LRAN>0 D WLN1 G QUIT:$G(LREND) G L11
"RTN","LRVER",33,0)
 I $P(^LRO(68,LRAA,0),U,3)="D" S I=0 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,I)) Q:I<1  I $D(^LRO(68,LRAA,1,LRAD,1,I,3)),'$P(^(3),U,4) S LRAN=I Q
"RTN","LRVER",34,0)
 S:$D(^LRO(68,LRAA,1,LRAD,2))&(LRAN<1) LRAN=$P(^(2),U,4)
"RTN","LRVER",35,0)
 ;
"RTN","LRVER",36,0)
L10 K LRTEST,LRSET,LRLDT,DIC,LRNAME,LRNG,LRDEL,T,LRTX,LRFP,LRAB,LRVERVER,Y,Z
"RTN","LRVER",37,0)
 G QUIT:$G(LREND) D WLN G QUIT:$G(LREND)
"RTN","LRVER",38,0)
 ;
"RTN","LRVER",39,0)
L11 I $D(LRFASTS) D ^LRVER1,SLOWK^LRFASTS Q
"RTN","LRVER",40,0)
 D ^LRVER1,NEXT
"RTN","LRVER",41,0)
 G L10
"RTN","LRVER",42,0)
 ;
"RTN","LRVER",43,0)
YN S DUOUT=0 S:'$D(%) %=1 D YN^DICN S:%<0 DUOUT=1 W:%=0 !,"Answer with a YES or NO or '^' to exit" Q:%  G YN
"RTN","LRVER",44,0)
 ;
"RTN","LRVER",45,0)
WLN I LRVBY=2 S:LRAN<1 LRUID="" S:$L(LRAN) LRUID=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3)),"^") D UID^LRVERA G LREND:LRUID="" G WLN1
"RTN","LRVER",46,0)
 ;
"RTN","LRVER",47,0)
 S:LRAN<1 LRAN=""
"RTN","LRVER",48,0)
 K DIR,DIRUT,DTOUT,DUOUT
"RTN","LRVER",49,0)
 S DIR(0)="NAO^1:999999:0"
"RTN","LRVER",50,0)
 S DIR("A")="Accession NUMBER: ",DIR("?")="^D LW^LRVR"
"RTN","LRVER",51,0)
 I LRAN'="" S DIR("B")=LRAN
"RTN","LRVER",52,0)
 D ^DIR K DIR
"RTN","LRVER",53,0)
 I $D(DIRUT) G LREND
"RTN","LRVER",54,0)
 S LRAN=Y
"RTN","LRVER",55,0)
 G WLN:LRAN=""
"RTN","LRVER",56,0)
WLN1 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0)) W !,"Accession does not exist." D NEXT G WLN
"RTN","LRVER",57,0)
 S LRDFN=+^LRO(68,LRAA,1,LRAD,1,LRAN,0),LRORD=$S($D(^(.1)):^(.1),1:0),LRODT=+$S($P(^(0),U,4):$P(^(0),U,4),1:$P(^(0),U,3)),LRSN=+$P(^(0),U,5)
"RTN","LRVER",58,0)
 S LRUID=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3)),"^")
"RTN","LRVER",59,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3) D PT^LRX
"RTN","LRVER",60,0)
 W !,PNM,?30,SSN
"RTN","LRVER",61,0)
 W:LRDPF=2 "   LOC:",$S($L(LRWRD):LRWRD,1:$S($L($P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,7)):$P(^(0),U,7),1:"??"))
"RTN","LRVER",62,0)
 W !
"RTN","LRVER",63,0)
 S LRCDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U)
"RTN","LRVER",64,0)
 ; If no lab arrival time then have user update order/accession
"RTN","LRVER",65,0)
 I '$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,3) D
"RTN","LRVER",66,0)
 . N %DT,LRA1,LRA2,LRA3
"RTN","LRVER",67,0)
 . S %DT("B")=$$FMTE^XLFDT(LRCDT,"1")
"RTN","LRVER",68,0)
 . S LRSTATUS="C",LRA1=LRAA,LRA2=LRAD,LRA3=LRAN
"RTN","LRVER",69,0)
 . D P15^LROE1
"RTN","LRVER",70,0)
 . S LRAA=LRA1,LRAD=LRA2,LRAN=LRA3
"RTN","LRVER",71,0)
 . Q:LRCDT<1
"RTN","LRVER",72,0)
 . I '$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,3) S $P(^(3),U,3)=$$NOW^XLFDT
"RTN","LRVER",73,0)
 ; If user did not update then go to next accession
"RTN","LRVER",74,0)
 I '$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,3) D NEXT G WLN
"RTN","LRVER",75,0)
 S LRCDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U)
"RTN","LRVER",76,0)
 I $G(LRCDT)<1 S LRCDT=1 D NEXT G WLN
"RTN","LRVER",77,0)
 ; Check for valid pointer to file #63 and entry in file #63.
"RTN","LRVER",78,0)
 S LRIDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5)
"RTN","LRVER",79,0)
 I LRIDT<1 D  G WLN
"RTN","LRVER",80,0)
 . W !,">>>>ERROR - NO POINTER TO FILE #63 - PLEASE NOTIFY SYSTEM MANAGER<<<<<",!
"RTN","LRVER",81,0)
 . D NEXT
"RTN","LRVER",82,0)
 I '$D(^LR(LRDFN,"CH",LRIDT,0)) D  G WLN
"RTN","LRVER",83,0)
 . W !,">>>>ERROR - NO ENTRY IN FILE #63 - PLEASE NOTIFY SYSTEM MANAGER<<<<<",!
"RTN","LRVER",84,0)
 . D NEXT
"RTN","LRVER",85,0)
 I $D(^LRO(69,LRODT,1,LRSN)),'$D(^(LRSN,1)) W !,"This Order # has not been collected",$C(7) D NEXT G WLN
"RTN","LRVER",86,0)
 I $D(^LRO(69,LRODT,1,LRSN,1)),$P(^LRO(69,LRODT,1,LRSN,1),U,4)'="C" W !,"You cannot verify an accession which has not been collected.",$C(7) D NEXT G WLN
"RTN","LRVER",87,0)
 Q
"RTN","LRVER",88,0)
 ;
"RTN","LRVER",89,0)
 ;
"RTN","LRVER",90,0)
LREND I $D(^LRO(68,LRAA,1,LRAD,0)) S:'$D(^(2)) ^(2)="^^" S ^(2)=$P(^(2),U,1,3)_U_LRAN_U_$P(^(2),U,5,99)
"RTN","LRVER",91,0)
 S LREND=1 K ^TMP("LR",$J,"TMP"),LRORD,LRM
"RTN","LRVER",92,0)
 Q
"RTN","LRVER",93,0)
 ;
"RTN","LRVER",94,0)
 ;
"RTN","LRVER",95,0)
NEXT ;
"RTN","LRVER",96,0)
 S LRAN=$O(^LRO(68,LRAA,1,LRAD,1,LRAN))
"RTN","LRVER",97,0)
 I LRAN<1 W !,"LAST IN WORK LIST" S LRAN="",LREND=1
"RTN","LRVER",98,0)
 Q
"RTN","LRVER",99,0)
 ;
"RTN","LRVER",100,0)
 ;
"RTN","LRVER",101,0)
QUIT ;
"RTN","LRVER",102,0)
 I $D(LRCSQ),'$O(^XTMP("LRCAP",LRCSQ,DUZ,0)) K ^XTMP("LRCAP",LRCSQ,DUZ),LRCSQ
"RTN","LRVER",103,0)
 I $D(LRCSQ),$D(LRAA),$P($G(^LRO(68,+LRAA,0)),U,16) D STD^LRCAPV
"RTN","LRVER",104,0)
 ;
"RTN","LRVER",105,0)
SLOQ ;
"RTN","LRVER",106,0)
 D STOP^LRCAPV,^LRCAPV2
"RTN","LRVER",107,0)
 K %,A,AGE,D1,DFN,DIC,DIE,DIR,DL,DLAYGO,DOB,DQ,DR,DX,I,J,LRACC,LRVF,LRCDT,LRCW,LRDAT,LRDFN,LRDPF,LRDV,LRDVF,LREAL,LREDIT,LREND,LRFLG,LRIDT,LRINI,LRLCT,LRLLOC,LRMETH,LRNG2,LRNG3,LRAD,LRAN,LRSPEC,LRPER,LRALL
"RTN","LRVER",108,0)
 K LRNG4,LRNG5,LRNT,LRNTN,LRNX,LRODT,LROUTINE,LROWLE,LRSAMP,LRSN,LRSS,LRSSP,LRSUB,LRTEC,LRTN,LRTS,LRUSI,LRUSNM,LRWRD,LRXD,LRXDP,PNM,S,SEX,SSN,X,X1,X2,X3,Y,Z,VA("BID"),VA("PID")
"RTN","LRVER",109,0)
 K %DT,%H,%X,%Y,B,C,D,DA,DR,G,G1,G2,G4,LRACD,LRAOD,LREDT,LREXEC,LRGVP,LRIOZERO,LRM,LRMA,LRNAME,LRORD,LRPLOC,LRSA,LRSB,LRSDT,LRSSQ,LRTK,LRTX,LRURG,LRVOL,LRVRM,LRWDTL,LRXDH,N,POP,T1,X9,Z1,Z2,^TMP("LR",$J)
"RTN","LRVER",110,0)
 K LRT,LRCFL,D0,GLB,LRAA,LRCNT,LRCODE,LRCODEN,LRCMTDSP,LRCWT,LRI,LRNOW,LRP,LRPN,LRQC,LRSSC,LRSSCX,LRSTD,NODE,NODE0,NOW,S2,ZTSK,Y,LRTIME,LRMAX2,LRMAXX,LRMX,LRODTSV,LRSNSV,LRSPN,LRTNSV,LRTY
"RTN","LRVER",111,0)
 K W,Y,Z,Z1,Z2,I1,LRALERT,LRDIYCNT,LRNOCODE,LRREP,LRSTATUS,LRUN,LRX,LRTIM,LRAL,LRPANEL,LRTM60,LRNDISP
"RTN","LRVER",112,0)
 D KVA^VADPT K LRIDIV,LROLLOC,LRORIFN,LRPRAC,LRRB,LRSD,LRTREA,LRTT,LRUID
"RTN","LRVER",113,0)
 K NAME,LRSUFO,LRCSQQ
"RTN","LRVER",114,0)
 Q
"RTN","LRVER",115,0)
 ;
"RTN","LRVER",116,0)
 ;
"RTN","LRVER",117,0)
REV ; Ask if user wants to review data before and after editing
"RTN","LRVER",118,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRVER",119,0)
 S DIR(0)="YO",DIR("B")="YES"
"RTN","LRVER",120,0)
 S DIR("A")="Do you want to review the data before and after you edit"
"RTN","LRVER",121,0)
 S DIR("?",1)="Answer YES, and the data will be displayed in its entirety as a panel before"
"RTN","LRVER",122,0)
 S DIR("?",2)="you edit if data already exists, and will be displayed after you edit."
"RTN","LRVER",123,0)
 S DIR("?")="NO, will skip the extra displays."
"RTN","LRVER",124,0)
 D ^DIR
"RTN","LRVER",125,0)
 I $D(DIRUT) S LREND=1
"RTN","LRVER",126,0)
 I Y=0 S LRPER=""
"RTN","LRVER",127,0)
 Q
"RTN","LRVER",128,0)
 ;
"RTN","LRVER",129,0)
 ;
"RTN","LRVER",130,0)
VERDIS ; Prevent test not selected by the user with verified data
"RTN","LRVER",131,0)
 ; entered from being displayed on the editing screens.
"RTN","LRVER",132,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRVER",133,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","LRVER",134,0)
 S DIR("A")="Do you wish to see all previously verified results"
"RTN","LRVER",135,0)
 S DIR("?",1)="Do you want to see every test that has results entered"
"RTN","LRVER",136,0)
 S DIR("?",2)="or only the test(s) you select to edit "
"RTN","LRVER",137,0)
 S DIR("?")="Answer with YES or NO"
"RTN","LRVER",138,0)
 D ^DIR
"RTN","LRVER",139,0)
 I $D(DIRUT) S LREND=1
"RTN","LRVER",140,0)
 I Y=0 S LRNDISP=1
"RTN","LRVER",141,0)
 Q
"RTN","LRVER1")
0^44^B30450805
"RTN","LRVER1",1,0)
LRVER1 ;DALOI/FHS-LAB ROUTINE DATA VERIFICATION ;9/10/04  15:19
"RTN","LRVER1",2,0)
 ;;5.2;LAB SERVICE;**42,153,201,215,239,240,263,232,286**;Sep 27, 1994
"RTN","LRVER1",3,0)
 ;
"RTN","LRVER1",4,0)
VER ; from LRGVP
"RTN","LRVER1",5,0)
 S LRLLOC=0,LRCW=8,LROUTINE=$P(^LAB(69.9,1,3),U,2) I $D(^LRO(69,LRODT,1,LRSN,0)) S LRLLOC=$P(^(0),U,7) S:'$L(LRLLOC) LRLLOC=0 W !,$P(^LRO(69,LRODT,1,LRSN,1),U,6)
"RTN","LRVER1",6,0)
 S LRCDT=$S($D(^LRO(68,LRAA,1,LRAD,1,LRAN,3)):$P(^(3),U,1,2),1:$P(^(0),U,3)_U),LREAL=$P(LRCDT,U,2)
"RTN","LRVER1",7,0)
 S LRCDT=+LRCDT,LRSAMP=$S($D(^LRO(69,LRODT,1,LRSN,0)):$P(^(0),U,3),1:"")
"RTN","LRVER1",8,0)
 S LRIDT=$S($P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5):$P(^(3),U,5),1:"")
"RTN","LRVER1",9,0)
 S:'LRIDT LRIDT=9999999-LRCDT
"RTN","LRVER1",10,0)
 D EXP
"RTN","LRVER1",11,0)
LD S LRSS="CH" ;ONLY WORKS FOR 'CH'
"RTN","LRVER1",12,0)
 S LRMETH=LRSS IF $D(^LR(LRDFN,LRSS,LRIDT,0)) S LRMETH=$P($P(^(0),U,8),";",1)
"RTN","LRVER1",13,0)
 W:$D(^LAB(62,+LRSAMP,0)) !,"Sample: ",$P(^(0),U)
"RTN","LRVER1",14,0)
 K ^TMP("LR",$J,"TMP"),LRORD,LRM
"RTN","LRVER1",15,0)
 D ^LRVER2
"RTN","LRVER1",16,0)
 K LRDL
"RTN","LRVER1",17,0)
 Q
"RTN","LRVER1",18,0)
 ;
"RTN","LRVER1",19,0)
 ;
"RTN","LRVER1",20,0)
EXP ; Get the list of tests for this ACC. from LRGVG1
"RTN","LRVER1",21,0)
 ; Do not process tests which have been "NP" (not performed).
"RTN","LRVER1",22,0)
 N I,N,IX,LRNLT,T1,X
"RTN","LRVER1",23,0)
 K LRTEST,LRNAME,LRSM60
"RTN","LRVER1",24,0)
 S LRALERT=LROUTINE,N=0,I=0,IX=+$G(^LRO(68,LRAA,1,LRAD,1,LRAN,5,1,0))
"RTN","LRVER1",25,0)
 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<.5  D
"RTN","LRVER1",26,0)
 . S X=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I,0))
"RTN","LRVER1",27,0)
 . I 'X Q
"RTN","LRVER1",28,0)
 . I $P(X,"^",6)="*Not Performed" Q
"RTN","LRVER1",29,0)
 . S N=N+1,LRTEST(N)=I,LRNLT=$S($P(X,"^",2)>50:$P(X,U,9),1:$P(X,"^"))
"RTN","LRVER1",30,0)
 . S LRTEST(N,"P")=LRNLT_U_$$NLT(LRNLT)
"RTN","LRVER1",31,0)
 . S LRAL=$P(X,U,2)#50
"RTN","LRVER1",32,0)
 . I LRAL S LRALERT=$S(LRAL<LRALERT:LRAL,1:LRALERT)
"RTN","LRVER1",33,0)
 ;
"RTN","LRVER1",34,0)
 S LRNTN=N
"RTN","LRVER1",35,0)
 F T1=1:1:N I $D(^LAB(60,+LRTEST(T1),0)) D
"RTN","LRVER1",36,0)
 . S LRTEST(T1)=LRTEST(T1)_U_^(0)
"RTN","LRVER1",37,0)
 . S LRNAME(T1)=$P(LRTEST(T1),U,2),LRNAME(T1,+LRTEST(T1))=""
"RTN","LRVER1",38,0)
 . S:$G(^(1,IX,3)) LRSM60(+$P(LRTEST(T1),";",2))=^(3)
"RTN","LRVER1",39,0)
 . D EX1
"RTN","LRVER1",40,0)
 K IX
"RTN","LRVER1",41,0)
 N X1,X
"RTN","LRVER1",42,0)
 S X=$P($H,","),X(1)=$P($H,",",2),I=0
"RTN","LRVER1",43,0)
 F  S I=$O(LRSM60(I)) Q:'I  S X1=X-LRSM60(I)_","_X(1),LRSM60(I)=9999999-$$HTFM^XLFDT(X1)
"RTN","LRVER1",44,0)
 Q
"RTN","LRVER1",45,0)
 ;
"RTN","LRVER1",46,0)
 ;
"RTN","LRVER1",47,0)
EX1 ; Expand the list of tests to edit.
"RTN","LRVER1",48,0)
 Q:'$D(LRTEST(T1))
"RTN","LRVER1",49,0)
 S X=LRTEST(T1),^TMP("LR",$J,"VTO",+X)=$P($P(X,U,6),";",2)
"RTN","LRVER1",50,0)
 S ^TMP("LR",$J,"VTO",+X,"P")=LRTEST(T1,"P"),S1=0,J=0
"RTN","LRVER1",51,0)
 D EX2
"RTN","LRVER1",52,0)
 K S1,J
"RTN","LRVER1",53,0)
 Q
"RTN","LRVER1",54,0)
 ;
"RTN","LRVER1",55,0)
EX2 ;
"RTN","LRVER1",56,0)
 S:'$D(LRCFL) LRCFL=""
"RTN","LRVER1",57,0)
 S LRSUB=$P(X,U,6)
"RTN","LRVER1",58,0)
 I $D(^LAB(60,+X,4)),$P(^(4),"^",2) S LRCFL=LRCFL_$P(^(4),"^",2)_U
"RTN","LRVER1",59,0)
 ;
"RTN","LRVER1",60,0)
 ; If atomic test then setup and quit
"RTN","LRVER1",61,0)
 I LRSUB'="" D  Q
"RTN","LRVER1",62,0)
 . S S2=$P(LRSUB,";",2)
"RTN","LRVER1",63,0)
 . D:'$D(^TMP("LR",$J,"TMP",S2)) ORD
"RTN","LRVER1",64,0)
 ;
"RTN","LRVER1",65,0)
 ; Explode panel tests
"RTN","LRVER1",66,0)
 ; Do not process tests which have been "NP" (not performed).
"RTN","LRVER1",67,0)
 S S1=S1+1,S1(S1)=X,S1(S1,1)=J
"RTN","LRVER1",68,0)
 S J=0
"RTN","LRVER1",69,0)
 F  S J=$O(^LAB(60,+S1(S1),2,J)) Q:J<1  D
"RTN","LRVER1",70,0)
 . S Y=+^(J,0),X=Y_U_^LAB(60,Y,0)
"RTN","LRVER1",71,0)
 . I $P($G(^LRO(68,+$G(LRAA),1,+$G(LRAD),1,+$G(LRAN),4,Y,0)),"^",6)="*Not Performed" Q
"RTN","LRVER1",72,0)
 . D EX2
"RTN","LRVER1",73,0)
 S X=S1(S1),J=S1(S1,1),S1=S1-1
"RTN","LRVER1",74,0)
 Q
"RTN","LRVER1",75,0)
 ;
"RTN","LRVER1",76,0)
 ;
"RTN","LRVER1",77,0)
ORD ;
"RTN","LRVER1",78,0)
 ; LRNX is set by caller
"RTN","LRVER1",79,0)
 S LRNX=+$G(LRNX)+1,LRORD(LRNX)=S2
"RTN","LRVER1",80,0)
 S ^TMP("LR",$J,"TMP",S2)=+X
"RTN","LRVER1",81,0)
 ; If panel being exploded then set parent("P" node)
"RTN","LRVER1",82,0)
 ;  to file #60 test being exploded
"RTN","LRVER1",83,0)
 I $G(LRTEST(T1,"P")) D
"RTN","LRVER1",84,0)
 . I +LRTEST(T1)=+LRTEST(T1,"P") S ^TMP("LR",$J,"TMP",S2,"P")=LRTEST(T1,"P")_"!"_$$RNLT(+X)
"RTN","LRVER1",85,0)
 . E  S ^TMP("LR",$J,"TMP",S2,"P")=+LRTEST(T1)_U_$$NLT(+LRTEST(T1))_"!"_$$RNLT(+X)
"RTN","LRVER1",86,0)
 ;
"RTN","LRVER1",87,0)
 I $P(X,U,18) D
"RTN","LRVER1",88,0)
 . S LRM(S2)=+X
"RTN","LRVER1",89,0)
 . S LRM(S2,"P")=$G(^TMP("LR",$J,"TMP",S2,"P"))
"RTN","LRVER1",90,0)
 . S LRMX(+X)=""
"RTN","LRVER1",91,0)
 Q
"RTN","LRVER1",92,0)
 ;
"RTN","LRVER1",93,0)
 ;
"RTN","LRVER1",94,0)
NLT(X) ;
"RTN","LRVER1",95,0)
 N Y
"RTN","LRVER1",96,0)
 S Y=$S($P($G(^LAM(+$G(^LAB(60,+X,64)),0)),U,2):$P(^(0),U,2),1:"")
"RTN","LRVER1",97,0)
 Q Y
"RTN","LRVER1",98,0)
 ;
"RTN","LRVER1",99,0)
 ;
"RTN","LRVER1",100,0)
RNLT(X) ;
"RTN","LRVER1",101,0)
 I 'X Q ""
"RTN","LRVER1",102,0)
 N Y
"RTN","LRVER1",103,0)
 S Y(1)=+$P($G(^LAB(60,X,64)),U,2)
"RTN","LRVER1",104,0)
 S Y=$S($P($G(^LAM(Y(1),0)),U,2):$P(^(0),U,2),1:"")
"RTN","LRVER1",105,0)
 I Y S $P(Y,"!",2)=$$LNC(Y,$G(LRCDEF),$G(LRSPEC))
"RTN","LRVER1",106,0)
 S $P(Y,"!",3)=$G(LRCDEF),$P(Y,"!",6)=X
"RTN","LRVER1",107,0)
 Q Y
"RTN","LRVER1",108,0)
 ;
"RTN","LRVER1",109,0)
 ;
"RTN","LRVER1",110,0)
LNC(LRNLT,LRCDEF,LRSPEC) ;reture the LOINC code for WKLD Code/Specimen
"RTN","LRVER1",111,0)
 ; Call with (nlt code,method suffix,test specimen)
"RTN","LRVER1",112,0)
 ; TA = Time Aspect
"RTN","LRVER1",113,0)
 N X,N,Y,LRSPECN,VAL,ERR,TA S X=""
"RTN","LRVER1",114,0)
 Q:'LRNLT X
"RTN","LRVER1",115,0)
 K LRMSGM
"RTN","LRVER1",116,0)
 S:$G(LRCDEF)="" LRCDEF="0000"
"RTN","LRVER1",117,0)
 I $P(LRCDEF,".",2) S LRCDEF=$P(LRCDEF,".",2)
"RTN","LRVER1",118,0)
 S LRCDEF=$S($P(LRNLT,".",2):$P(LRNLT,".",2),1:LRCDEF)
"RTN","LRVER1",119,0)
 I $L(LRCDEF)'=4 S LRCDEF=LRCDEF_$E("0000",$L(LRCDEF),($L(LRCDEF-4)))
"RTN","LRVER1",120,0)
 S LRCDEF=LRCDEF_" "
"RTN","LRVER1",121,0)
 S LRSPEC=+LRSPEC
"RTN","LRVER1",122,0)
 ;Get time aspect from 61
"RTN","LRVER1",123,0)
 S TA=$$GET1^DIQ(61,LRSPEC_",",.0961,"I")
"RTN","LRVER1",124,0)
 S LRSPECN=$S($D(^LAB(61,LRSPEC,0))#2:$$GET1^DIQ(61,LRSPEC_",",.01),1:"Unknown")
"RTN","LRVER1",125,0)
 S LRNLT=$P(LRNLT,".")_"."
"RTN","LRVER1",126,0)
 ;Check for WKLD CODE_LOAD/WORK LIST method suffix
"RTN","LRVER1",127,0)
 S VAL(1)=LRNLT_LRCDEF
"RTN","LRVER1",128,0)
 S N=$$FIND1^DIC(64,"","X",.VAL,"C","","ERR")
"RTN","LRVER1",129,0)
 ;Looking for specimen specific LOINC
"RTN","LRVER1",130,0)
 I N,LRSPEC D  I X D MSG(1) Q X
"RTN","LRVER1",131,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",132,0)
 . S TA=$O(^LAM(N,5,LRSPEC,1,0)) ; get time aspect
"RTN","LRVER1",133,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",134,0)
 ;Looking LOINC default
"RTN","LRVER1",135,0)
 I N S X=$$LDEF(N) I X D MSG(2) Q X
"RTN","LRVER1",136,0)
 I LRCDEF="0000 " Q ""
"RTN","LRVER1",137,0)
 ;Looking for WKLD CODE_GENERIC suffix
"RTN","LRVER1",138,0)
 K VAL
"RTN","LRVER1",139,0)
 S VAL(1)=LRNLT_"0000 "
"RTN","LRVER1",140,0)
 S N=$$FIND1^DIC(64,"","X",.VAL,"C","","ERR")
"RTN","LRVER1",141,0)
 I 'N Q ""
"RTN","LRVER1",142,0)
 ;Looking for WKLD CODE_GENERIC specimen specific LOINC
"RTN","LRVER1",143,0)
 I LRSPEC D  I X D MSG(3) Q X
"RTN","LRVER1",144,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",145,0)
 . S TA=$O(^LAM(N,5,LRSPEC,1,0)) ; get time aspect
"RTN","LRVER1",146,0)
 . I TA S X=$$GET1^DIQ(64.02,TA_","_LRSPEC_","_N_",",4,"I") Q:X
"RTN","LRVER1",147,0)
 ;Looking for WKLD CODE_GENERIC default LOINC
"RTN","LRVER1",148,0)
 I 'X,N S X=$$LDEF(N) I X D MSG(4)
"RTN","LRVER1",149,0)
 I 'X S X=""
"RTN","LRVER1",150,0)
 Q X
"RTN","LRVER1",151,0)
 ;
"RTN","LRVER1",152,0)
 ;
"RTN","LRVER1",153,0)
LDEF(Y) ;Find the default LOINC code for WKLD CODE
"RTN","LRVER1",154,0)
 I 'Y Q ""
"RTN","LRVER1",155,0)
 S X=$$GET1^DIQ(64,Y_",",25,"I")
"RTN","LRVER1",156,0)
 I 'X S X=""
"RTN","LRVER1",157,0)
 Q X
"RTN","LRVER1",158,0)
 ;
"RTN","LRVER1",159,0)
 ;
"RTN","LRVER1",160,0)
TMPSB(LRSB) ; Get LOINC code from ^TMP("LR",$J,"TMP",LRSB,"P")
"RTN","LRVER1",161,0)
 S NODE=$G(^TMP("LR",$J,"TMP",LRSB,"P"))
"RTN","LRVER1",162,0)
 I 'NODE Q ""
"RTN","LRVER1",163,0)
 S $P(NODE,"!",3)=$$LNC($P(NODE,"!",2),$G(LRCDEF),$G(LRSPEC))
"RTN","LRVER1",164,0)
 S $P(NODE,"!",4)=$G(LRCDEF)
"RTN","LRVER1",165,0)
 Q $P(NODE,U,2)
"RTN","LRVER1",166,0)
 ;
"RTN","LRVER1",167,0)
 ;
"RTN","LRVER1",168,0)
MSG(VAL) ;Set output message
"RTN","LRVER1",169,0)
 Q:'$G(LRMSG)
"RTN","LRVER1",170,0)
 S LRMSGM="0-No LOINC Code Defined for "_LRNLT_LRCDEF
"RTN","LRVER1",171,0)
 N TANAME
"RTN","LRVER1",172,0)
 I $G(TA) S TANAME=$$GET1^DIQ(64.061,TA_",",.01,"E") ;TA Name
"RTN","LRVER1",173,0)
 I VAL=1 S LRMSGM="1-"_LRNLT_$E(LRCDEF,1,4)_" - "_LRSPECN
"RTN","LRVER1",174,0)
 I VAL=2 S LRMSGM="2-"_LRNLT_$E(LRCDEF,1,4)_" - Default LOINC"
"RTN","LRVER1",175,0)
 I VAL=3 S LRMSGM="3-"_LRNLT_"0000 - "_LRSPECN
"RTN","LRVER1",176,0)
 I VAL=4 S LRMSGM="4-"_LRNLT_"0000 - Default LOINC"
"RTN","LRVER1",177,0)
 I $G(TA) S LRMSGM=LRMSGM_" Time Aspect "_TANAME
"RTN","LRVER1",178,0)
 W:$G(LRDBUG) !,LRMSGM,!
"RTN","LRVER1",179,0)
 Q
"RTN","LRVER3")
0^15^B48071171
"RTN","LRVER3",1,0)
LRVER3 ;DALOI/CJS/FHS-DATA VERIFICATION ;Nov 4, 2004
"RTN","LRVER3",2,0)
 ;;5.2;LAB SERVICE;**42,100,121,140,171,153,221,286**;Sep 27, 1994
"RTN","LRVER3",3,0)
 ;
"RTN","LRVER3",4,0)
 D V1
"RTN","LRVER3",5,0)
 I $D(LRLOCKER)#2 L -@(LRLOCKER) K LRLOCKER
"RTN","LRVER3",6,0)
 Q
"RTN","LRVER3",7,0)
 ;
"RTN","LRVER3",8,0)
 ;
"RTN","LRVER3",9,0)
V1 I $D(LRLOCKER)#2 L -@(LRLOCKER)
"RTN","LRVER3",10,0)
 S LRLOCKER="^LR("_LRDFN_","""_LRSS_""","_LRIDT_")"
"RTN","LRVER3",11,0)
 L +@(LRLOCKER):1
"RTN","LRVER3",12,0)
 I '$T W !," This entry is being edited by someone else." Q
"RTN","LRVER3",13,0)
 I $D(LRGVP) S X="1-"_LRNTN D RANGE^LRWU2 G L10
"RTN","LRVER3",14,0)
 S LRALL="",LRALERT=LROUTINE,LRLCT=6
"RTN","LRVER3",15,0)
 ;
"RTN","LRVER3",16,0)
 ; List any not performed tests.
"RTN","LRVER3",17,0)
 S I=0
"RTN","LRVER3",18,0)
 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<1  D
"RTN","LRVER3",19,0)
 . S LRX=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I,0))
"RTN","LRVER3",20,0)
 . I $P(LRX,"^",6)'="*Not Performed" Q
"RTN","LRVER3",21,0)
 . W !,?3,$P(^LAB(60,I,0),"^"),?25," ",$P(LRX,"^",6)
"RTN","LRVER3",22,0)
 . S LRLCT=LRLCT+1 D:LRLCT>22 WT^LRVER4
"RTN","LRVER3",23,0)
 ;
"RTN","LRVER3",24,0)
 ; No tests to edit
"RTN","LRVER3",25,0)
 I LRNTN=0 D COM^LRVR4 G EXIT
"RTN","LRVER3",26,0)
 ;
"RTN","LRVER3",27,0)
 F I=1:1:LRNTN I $D(LRNAME(I)) D
"RTN","LRVER3",28,0)
 . S LRALL=LRALL_","_I W !,I,"  ",LRNAME(I)
"RTN","LRVER3",29,0)
 . I $D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,$O(LRNAME(I,0)),0))#2 D
"RTN","LRVER3",30,0)
 . . S LRX=^LRO(68,LRAA,1,LRAD,1,LRAN,4,$O(LRNAME(I,0)),0)
"RTN","LRVER3",31,0)
 . . S LRAL=$P(LRX,U,2)#50
"RTN","LRVER3",32,0)
 . . I $P(LRX,U,5) W ?25,$S($P(LRX,U,6)'="":$P(LRX,U,6),1:" verified")
"RTN","LRVER3",33,0)
 . . I LRAL S LRALERT=$S(LRAL<LRALERT:LRAL,1:LRALERT)
"RTN","LRVER3",34,0)
 . S LRLCT=LRLCT+1 D:LRLCT>22 WT^LRVER4
"RTN","LRVER3",35,0)
 ;
"RTN","LRVER3",36,0)
 I $D(LRALERT),LRALERT<($P(LRPARAM,U,20)+1) D
"RTN","LRVER3",37,0)
 . W !?15 W:IOST["C-" @LRVIDO
"RTN","LRVER3",38,0)
 . W "Test ordered "_$P($G(^LAB(62.05,+LRALERT,0)),U)
"RTN","LRVER3",39,0)
 . W:IOST["C-" @LRVIDOF W !,$C(7)
"RTN","LRVER3",40,0)
 ;
"RTN","LRVER3",41,0)
 S X9="" I LRNTN=1 S T1=1 G L10
"RTN","LRVER3",42,0)
V9 S LRALL=$P(LRALL,",",2,99)
"RTN","LRVER3",43,0)
 R !!,"TEST #(s) (or ""ALL""): ",X:DTIME S:'$T X=U S:X["A" X=LRALL
"RTN","LRVER3",44,0)
 I X["?" W !,"Enter for example 1,2,5-9." G V9
"RTN","LRVER3",45,0)
 Q:X[U!(X="")  D RANGE^LRWU2 G EXIT:X9="" X (X9_"S:'$D(LRNAME(T1)) X=0") G EXIT:X=0
"RTN","LRVER3",46,0)
L10 ;
"RTN","LRVER3",47,0)
 N LRCORECT S LRCORECT=0
"RTN","LRVER3",48,0)
 S LRNX=0 X (X9_"D EX1^LRVER1")
"RTN","LRVER3",49,0)
 D V7^LRVER2
"RTN","LRVER3",50,0)
 S LRCMTDSP=$$CHKCDSP^LRVERA
"RTN","LRVER3",51,0)
 K LRSA,LRSB,LRORU3
"RTN","LRVER3",52,0)
 F LRSB=1:0 S LRSB=$O(^LR(LRDFN,LRSS,LRIDT,LRSB)) Q:LRSB<1  D
"RTN","LRVER3",53,0)
 . S LRSB(LRSB)=^(LRSB),LRSB(LRSB,"P")=$P(LRSB(LRSB),U,3)
"RTN","LRVER3",54,0)
 . I $D(LRNOVER) S LRNOVER(LRSB)=""
"RTN","LRVER3",55,0)
 S LREDIT=1
"RTN","LRVER3",56,0)
 D ^LRVER4
"RTN","LRVER3",57,0)
 ;
"RTN","LRVER3",58,0)
 ; If group data review then quit before updating results
"RTN","LRVER3",59,0)
 I $D(LRGVP) G EXIT
"RTN","LRVER3",60,0)
 ;
"RTN","LRVER3",61,0)
 I '$O(LRORD(0)) G EXIT
"RTN","LRVER3",62,0)
 I '$G(LRCHG),'LRVF F LRSB=1:0 S LRSB=$O(LRSB(LRSB)) Q:LRSB<1  S:LRSB(LRSB)'="" ^LR(LRDFN,LRSS,LRIDT,LRSB)=LRSB(LRSB)
"RTN","LRVER3",63,0)
 I $G(LRCHG) D CHG K LRCHG,LRUP I $G(LREND) S LREND=0 G EXIT
"RTN","LRVER3",64,0)
 ;
"RTN","LRVER3",65,0)
 I $D(LRSA),$D(LRF) K LRF S X=$P(^LR(LRDFN,LRSS,LRIDT,0),U,9) S:$L(X)&($E(X)'["-") $P(^(0),U,9)="-"_X G V11
"RTN","LRVER3",66,0)
 G EXIT:$D(LRGVP),V11:LRVF&$D(LRSA),V1:LRVF&(LRNTN>1),EXIT:LRVF
"RTN","LRVER3",67,0)
 ;
"RTN","LRVER3",68,0)
NOVER I $O(LRNOVER(0)) D  G EXIT
"RTN","LRVER3",69,0)
 . F I=0:0 S I=+$O(LRNOVER(I)) Q:I<2  W !,"Test Not Reviewed: ",$P(^DD(63.04,I,0),U) W:$D(LRSB(I))#2 " = "_$P(LRSB(I),U)_" "_$P(LRSB(I),U,2)
"RTN","LRVER3",70,0)
 . W !,$$CJ^XLFSTR("The above test(s) have results already entered,",80)
"RTN","LRVER3",71,0)
 . W !,$$CJ^XLFSTR("but you did not select them for review.",80)
"RTN","LRVER3",72,0)
 . W !,$$CJ^XLFSTR(" Accession NOT approved. ",80),$C(7)
"RTN","LRVER3",73,0)
 . W !,$$CJ^XLFSTR("You must review all results before ANY can be released.",80),!!
"RTN","LRVER3",74,0)
 . W:$E(IOST,1,2)="C-" @LRVIDO W $$CJ^XLFSTR("Suggest you select 'ALL' tests for verification/review. ",80) W:$E(IOST,1,2)="C-" @LRVIDOF W !,$C(7)
"RTN","LRVER3",75,0)
 I $O(LRNOVER(0)) W !,"Has not been reviewed and has data.  Not approved.",! G EXIT
"RTN","LRVER3",76,0)
 I '$P($G(LRLABKY),U) W !,$C(7),"ENTERED BUT NOT APPROVED",! G EXIT
"RTN","LRVER3",77,0)
 I '$O(LRSB(0)) W !?5,"Nothing verified ",$C(7),! G EXIT
"RTN","LRVER3",78,0)
 N CNT S CNT=1
"RTN","LRVER3",79,0)
AGAIN ;
"RTN","LRVER3",80,0)
 R !,"Approve for release by entering your initials: ",LRINI:DTIME
"RTN","LRVER3",81,0)
 I $E(LRINI)="^" W !!?5,$C(7),"Nothing verified!" D READ G EXIT
"RTN","LRVER3",82,0)
 I LRINI'=LRUSI,$$UP^XLFSTR(LRINI)=$$UP^XLFSTR(LRUSI) S LRINI=LRUSI
"RTN","LRVER3",83,0)
 I $S($E(LRINI)="?":1,LRINI'=LRUSI&(CNT<2):1,1:0) W !,$C(7),"Please enter your correct initials" S:$E(LRINI)="?" CNT=0 S CNT=CNT+1 G AGAIN
"RTN","LRVER3",84,0)
 I LRINI'=LRUSI W !!?5,$C(7),"Nothing verified!" D READ G EXIT
"RTN","LRVER3",85,0)
V11 I $D(XRTL) D T0^%ZOSV ; START RESPONSE TIME LOGGING
"RTN","LRVER3",86,0)
 D VER^LRVER3A
"RTN","LRVER3",87,0)
 I $P(LRPARAM,U,14),$P($G(^LRO(68,LRAA,0)),U,16) D LOOK^LRCAPV1
"RTN","LRVER3",88,0)
 N LRX
"RTN","LRVER3",89,0)
 S LRX=0
"RTN","LRVER3",90,0)
 F  S LRX=$O(^TMP("LR",$J,"TMP",LRX)) Q:LRX<1  S:'$D(^LRO(68,"AC",LRDFN,LRIDT,LRX)) ^(LRX)="" I LRVF S ^(LRX)=""
"RTN","LRVER3",91,0)
 I $P($G(LRORU3),U,3),$O(LRSB(0)) D LRORU3
"RTN","LRVER3",92,0)
 I $D(XRT0) S XRTN="V11^LRVER3" D T1^%ZOSV ; STOP RESPONSE TIME LOGGING
"RTN","LRVER3",93,0)
 S LRVF=1
"RTN","LRVER3",94,0)
 Q
"RTN","LRVER3",95,0)
 ;
"RTN","LRVER3",96,0)
 ;
"RTN","LRVER3",97,0)
EXIT Q
"RTN","LRVER3",98,0)
 ;
"RTN","LRVER3",99,0)
 ;
"RTN","LRVER3",100,0)
READ ;
"RTN","LRVER3",101,0)
 N X W !!,"Press ENTER or RETURN to continue: " R X:DTIME
"RTN","LRVER3",102,0)
 Q
"RTN","LRVER3",103,0)
 ;
"RTN","LRVER3",104,0)
 ;
"RTN","LRVER3",105,0)
CHG ; Check for changes, save results and create audit trail
"RTN","LRVER3",106,0)
 S LRUP=""
"RTN","LRVER3",107,0)
 F  S LRCHG=$O(LRSB(LRCHG)) Q:LRCHG<1  D
"RTN","LRVER3",108,0)
 . I '$D(LRSA(LRCHG)) S LRUP=1 Q
"RTN","LRVER3",109,0)
 . I $P(LRSA(LRCHG),"^")=""!($P(LRSA(LRCHG),"^")="pending") S LRUP=1 Q
"RTN","LRVER3",110,0)
 . I $P(LRSA(LRCHG),"^")'=$P(LRSB(LRCHG),"^") S LRUP=1,$P(LRSA(LRCHG,2),"^")=1 ; results changed
"RTN","LRVER3",111,0)
 . I $P(LRSA(LRCHG),"^",2)'=$P(LRSB(LRCHG),"^",2) S LRUP=1,$P(LRSA(LRCHG,2),"^",2)=1 ; normalcy flag changed
"RTN","LRVER3",112,0)
 . I $P(LRSA(LRCHG),"^",5)'=$P(LRSB(LRCHG),"^",5) D  ; units/normals changed
"RTN","LRVER3",113,0)
 . . N LRX,LRY
"RTN","LRVER3",114,0)
 . . S LRX=$$UP^XLFSTR($P(LRSA(LRCHG),"^",5)),LRX=$TR(LRX,"""")
"RTN","LRVER3",115,0)
 . . S LRY=$$UP^XLFSTR($P(LRSB(LRCHG),"^",5)),LRY=$TR(LRY,"""")
"RTN","LRVER3",116,0)
 . . I LRX'=LRY S LRUP=1,$P(LRSA(LRCHG,2),"^",5)=1
"RTN","LRVER3",117,0)
 I 'LRUP S LREND=1 Q
"RTN","LRVER3",118,0)
 S LREND=0
"RTN","LRVER3",119,0)
 W !! W:IOST["C-" @LRVIDO W "Approve update of data by entering your initials: " W:IOST["C-" @LRVIDOF
"RTN","LRVER3",120,0)
 R LRINI:DTIME
"RTN","LRVER3",121,0)
 I '$T S LREND=1
"RTN","LRVER3",122,0)
 I 'LREND,LRINI'=LRUSI,$$UP^XLFSTR(LRINI)=$$UP^XLFSTR(LRUSI) S LRINI=LRUSI
"RTN","LRVER3",123,0)
 I LRINI'=LRUSI S LREND=1
"RTN","LRVER3",124,0)
 I LREND W !,$C(7),"No updating occurred ",! Q
"RTN","LRVER3",125,0)
 ;
"RTN","LRVER3",126,0)
 F LRSB=1:0 S LRSB=$O(LRSB(LRSB)) Q:LRSB<1  D
"RTN","LRVER3",127,0)
 . K:'$D(^LR(LRDFN,LRSS,LRIDT,LRSB)) LRSA(LRSB)
"RTN","LRVER3",128,0)
 . S ^LR(LRDFN,LRSS,LRIDT,LRSB)=LRSB(LRSB)
"RTN","LRVER3",129,0)
 . I $D(LRSA(LRSB,1)),$D(LRSA(LRSB,2)) D DIDLE
"RTN","LRVER3",130,0)
 W !!
"RTN","LRVER3",131,0)
 Q
"RTN","LRVER3",132,0)
 ;
"RTN","LRVER3",133,0)
 ;
"RTN","LRVER3",134,0)
DIDLE ;
"RTN","LRVER3",135,0)
 ; Check if no previous result or pending result - no audit trail needed
"RTN","LRVER3",136,0)
 I $P(LRSA(LRSB),"^")=""!($P(LRSA(LRSB),"^")="pending") Q
"RTN","LRVER3",137,0)
 ;
"RTN","LRVER3",138,0)
 S LRF=1
"RTN","LRVER3",139,0)
 L +^LR(LRDFN,LRSS,LRIDT):999
"RTN","LRVER3",140,0)
NOW S LRNOW7=$$NOW^XLFDT
"RTN","LRVER3",141,0)
 W !
"RTN","LRVER3",142,0)
 D ^LRDIDLE0
"RTN","LRVER3",143,0)
 I 'LROK K LRSA
"RTN","LRVER3",144,0)
 L -^LR(LRDFN,LRSS,LRIDT)
"RTN","LRVER3",145,0)
 S LRCORECT=1
"RTN","LRVER3",146,0)
 Q
"RTN","LRVER3",147,0)
 ;
"RTN","LRVER3",148,0)
 ;
"RTN","LRVER3",149,0)
RONLT ; (R)esolve (O)rder NLT code from file #68 original ordered test or
"RTN","LRVER3",150,0)
 ; use default when not specified for file #60 test.
"RTN","LRVER3",151,0)
 ;
"RTN","LRVER3",152,0)
 N LR60,LRX,LRY,X
"RTN","LRVER3",153,0)
 S LR60=+LRTS,LRY=$P(LRSB(LRSB),U,3)
"RTN","LRVER3",154,0)
 ;
"RTN","LRVER3",155,0)
 ; Try to determine order NLT from original ordered test
"RTN","LRVER3",156,0)
 F  Q:'LR60  D
"RTN","LRVER3",157,0)
 . S LRX=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LR60,0)),LR60=+$P(LRX,"^",9)
"RTN","LRVER3",158,0)
 . I LR60,LR60'=$P(LRX,"^") D
"RTN","LRVER3",159,0)
 . . S X=$$NLT^LRVER1(LR60)
"RTN","LRVER3",160,0)
 . . I X'="" S $P(LRY,"!")=X
"RTN","LRVER3",161,0)
 . I LR60=$P(LRX,"^") S LR60=0
"RTN","LRVER3",162,0)
 ;
"RTN","LRVER3",163,0)
 ; Otherwise use default for lab package
"RTN","LRVER3",164,0)
 I $P(LRY,"!")="" S $P(LRY,"!")=$P($$DEFCODE^LA7VHLU5(LRSS,LRSB,LRY,+LRSPEC),"!")
"RTN","LRVER3",165,0)
 ;
"RTN","LRVER3",166,0)
 S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRVER3",167,0)
 ;
"RTN","LRVER3",168,0)
 Q
"RTN","LRVER3",169,0)
 ;
"RTN","LRVER3",170,0)
 ;
"RTN","LRVER3",171,0)
LRORU3 ;
"RTN","LRVER3",172,0)
SET ;
"RTN","LRVER3",173,0)
 N LR64,LR7V,LRDN,LROTA,LRT,LRTPN,LRTPNN,LRTYPE,X
"RTN","LRVER3",174,0)
 ;
"RTN","LRVER3",175,0)
 ; Go through LRSB array and sort results by order NLT code
"RTN","LRVER3",176,0)
 ; and put into ordered test array (LROTA).
"RTN","LRVER3",177,0)
 S LRDN=0
"RTN","LRVER3",178,0)
 F  S LRDN=$O(LRSB(LRDN)) Q:'LRDN  D
"RTN","LRVER3",179,0)
 . I $P(LRSB(LRDN),"^")="" Q
"RTN","LRVER3",180,0)
 . S LRTPNN=$P($P(LRSB(LRDN),U,3),"!"),LRT=+$G(^TMP("LR",$J,"TMP",LRDN))
"RTN","LRVER3",181,0)
 . I LRTPNN="" Q
"RTN","LRVER3",182,0)
 . S LRTYPE=$P($G(^LAB(60,LRT,0)),U,3)
"RTN","LRVER3",183,0)
 . I LRTYPE=""!("OB"'[LRTYPE) Q
"RTN","LRVER3",184,0)
 . S LROTA(LRTPNN,LRDN)=LRT
"RTN","LRVER3",185,0)
 . I $D(LRSA(LRDN,2)) S LROTA(LRTPNN,LRDN,1)="C"
"RTN","LRVER3",186,0)
 ;
"RTN","LRVER3",187,0)
 ; For each order NLT code setup call to put results into #62.49 queue
"RTN","LRVER3",188,0)
 S LRTPNN=""
"RTN","LRVER3",189,0)
 F  S LRTPNN=$O(LROTA(LRTPNN)) Q:LRTPNN=""  D
"RTN","LRVER3",190,0)
 . S LR64=+$O(^LAM("C",LRTPNN_" ",0)),LRTPN=$$GET1^DIQ(64,LR64_",",.01)
"RTN","LRVER3",191,0)
 . K LR7V
"RTN","LRVER3",192,0)
 . M LR7V=LROTA(LRTPNN)
"RTN","LRVER3",193,0)
 . D SET^LA7VMSG($P(LRORU3,U,4),$P(LRORU3,U,2),$P(LRORU3,U,5),$P(LRORU3,U,3),LRTPN,LRTPNN,LRIDT,LRSS,LRDFN,LRODT,.LR7V)
"RTN","LRVER3",194,0)
 Q
"RTN","LRVER4")
0^25^B81796487
"RTN","LRVER4",1,0)
LRVER4 ;DALOI/CJS/DALOI/FHS - LAB ROUTINE DATA VERIFICATION ;8/11/97
"RTN","LRVER4",2,0)
 ;;5.2;LAB SERVICE;**14,42,112,121,140,171,153,188,279,283,286**;Sep 27, 1994
"RTN","LRVER4",3,0)
 ;
"RTN","LRVER4",4,0)
 N LRAMEND,LRRFLAG
"RTN","LRVER4",5,0)
 ;
"RTN","LRVER4",6,0)
LOOP ;
"RTN","LRVER4",7,0)
 S LRLCT=0
"RTN","LRVER4",8,0)
 I '$D(LRGVP) D
"RTN","LRVER4",9,0)
 . S:$D(LRWRDS) LRWRD=LRWRDS
"RTN","LRVER4",10,0)
 . W !!,PNM,"  SSN: ",SSN,"   " S LRLCT=LRLCT+1
"RTN","LRVER4",11,0)
 . I LRDPF=2 W "   LOC: ",$S(LRWRD'="":LRWRD,1:$S($L($P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,7)):$P(^(0),U,7),1:"??"))
"RTN","LRVER4",12,0)
 ;
"RTN","LRVER4",13,0)
 W !,"Pat Info: ",$P($G(^LR(LRDFN,.091)),U)
"RTN","LRVER4",14,0)
 W ?34," Sex: ",$S(SEX="M":"MALE",SEX="F":"FEMALE",1:SEX)
"RTN","LRVER4",15,0)
 W ?48," Age: ",$$CALCAGE^LRRPU(DOB,LRCDT)," as of ",$$FMTE^XLFDT(LRCDT,"1D")
"RTN","LRVER4",16,0)
 S LRPRAC=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,8)
"RTN","LRVER4",17,0)
 I LRPRAC>0,LRPRAC=+LRPRAC D GETS^DIQ(200,LRPRAC_",",".01;.132;.137;.138","E","LRPRAC(LRPRAC)","LRERR")
"RTN","LRVER4",18,0)
 W !,"Provider: "
"RTN","LRVER4",19,0)
 S LRLCT=LRLCT+2
"RTN","LRVER4",20,0)
 I LRPRAC'="",'$D(LRPRAC(LRPRAC,200)) W LRPRAC
"RTN","LRVER4",21,0)
 I LRPRAC,$D(LRPRAC(LRPRAC,200)) D
"RTN","LRVER4",22,0)
 . W LRPRAC(LRPRAC,200,LRPRAC_",",.01,"E"),?40," Voice pager: ",LRPRAC(LRPRAC,200,LRPRAC_",",.137,"E")
"RTN","LRVER4",23,0)
 . W !,"   Phone: ",LRPRAC(LRPRAC,200,LRPRAC_",",.132,"E"),?38," Digital pager: ",LRPRAC(LRPRAC,200,LRPRAC_",",.138,"E")
"RTN","LRVER4",24,0)
 . S LRLCT=LRLCT+1
"RTN","LRVER4",25,0)
 ;
"RTN","LRVER4",26,0)
 N PRAC,PR
"RTN","LRVER4",27,0)
 D PRAC^LR7OMERG(LRAA,LRAD,LRAN,.PRAC)
"RTN","LRVER4",28,0)
 I $O(PRAC(0)) D
"RTN","LRVER4",29,0)
 . S PR=0
"RTN","LRVER4",30,0)
 . F  S PR=$O(PRAC(PR)) Q:PR<1  I $D(^VA(200,PR,0)) W !?14,$P(^(0),"^") S LRLCT=LRLCT+1
"RTN","LRVER4",31,0)
 W ! S LRLCT=LRLCT+1
"RTN","LRVER4",32,0)
 S LRNX=0,LRVRM=2,T=""
"RTN","LRVER4",33,0)
 I $P(^LR(LRDFN,LRSS,LRIDT,0),U,7)'="" D
"RTN","LRVER4",34,0)
 . W !,"VOLUME: ",$P(^(0),U,7)
"RTN","LRVER4",35,0)
 . S LRLCT=LRLCT+1
"RTN","LRVER4",36,0)
 S LRACC=$P(Z1,U,6)
"RTN","LRVER4",37,0)
 W !,"ACCESSION:",?30,$P(Z2,U,6),?44," ",LRACC
"RTN","LRVER4",38,0)
 W !,?30,LRDAT(2) W ?44," ",LRDAT
"RTN","LRVER4",39,0)
 S LRLCT=LRLCT+2
"RTN","LRVER4",40,0)
 I $D(LRALERT),LRALERT<($P(LRPARAM,U,20)+1) D
"RTN","LRVER4",41,0)
 . W !?15 W:$E(IOST,1,2)="C-" @LRVIDO
"RTN","LRVER4",42,0)
 . W "Test ordered "_$P($G(^LAB(62.05,+LRALERT,0)),U)
"RTN","LRVER4",43,0)
 . W:$E(IOST,1,2)="C-" @LRVIDOF,$C(7)
"RTN","LRVER4",44,0)
 . S LRLCT=LRLCT+1
"RTN","LRVER4",45,0)
 ;
"RTN","LRVER4",46,0)
 I '$O(LRORD(0)) W !!?7,$C(7),"This is not a verifiable test/accession ",! Q
"RTN","LRVER4",47,0)
V I $D(LRGVP) D V20 Q
"RTN","LRVER4",48,0)
 G EDIT:($O(^LR(LRDFN,LRSS,LRIDT,1))=""!('LRVF&$D(LRPER)))&'$D(LRNUF)
"RTN","LRVER4",49,0)
 K LRNUF
"RTN","LRVER4",50,0)
 D V20,ND G V37:LRVF&'$D(X)#2,EDIT:LREDIT
"RTN","LRVER4",51,0)
 S LRTEC=$S($D(^LRO(68,LRAA,1,LRAD,2)):$P(^(2),U),1:$S($D(LRUSI):LRUSI,1:"")),LREDIT=0
"RTN","LRVER4",52,0)
V36 ;
"RTN","LRVER4",53,0)
 Q:$D(LRGVP)
"RTN","LRVER4",54,0)
 K DIR
"RTN","LRVER4",55,0)
 S DIR(0)="SAO^E:Edit;C:Comments;W:Workload"
"RTN","LRVER4",56,0)
 S DIR("A")="SELECT ('E' to Edit, 'C' for Comments, 'W' Workload): "
"RTN","LRVER4",57,0)
 D ^DIR
"RTN","LRVER4",58,0)
 I $D(DIRUT) S X="^" G V37
"RTN","LRVER4",59,0)
 S X=Y
"RTN","LRVER4",60,0)
 S:$E(X)="E" LREDIT=1,X=""
"RTN","LRVER4",61,0)
 K LRNC
"RTN","LRVER4",62,0)
 I $E(X)="C" S LRNC=1 D COM K LRNC G V36
"RTN","LRVER4",63,0)
 I $E(X)="W" D  G LOOP
"RTN","LRVER4",64,0)
 . I $P(LRPARAM,U,14),$P($G(^LRO(68,LRAA,0)),U,16) D STD^LRCAPV,EN^LRCAPV S LREND=0 Q
"RTN","LRVER4",65,0)
 . W !?10," Workload is not activated."
"RTN","LRVER4",66,0)
 S X=$S(X="@":"",X="":LRTEC,1:X),LRTEC=X
"RTN","LRVER4",67,0)
 S:'$D(^LRO(68,LRAA,1,LRAD,2)) ^(2)="" S ^(2)=X_U_$P(^(2),U,2,99)
"RTN","LRVER4",68,0)
 G EDIT:LREDIT
"RTN","LRVER4",69,0)
V37 Q  ;LEAVE LRVER4, BACK TO LRVER3
"RTN","LRVER4",70,0)
 ;
"RTN","LRVER4",71,0)
 ;
"RTN","LRVER4",72,0)
V20 ;
"RTN","LRVER4",73,0)
 I $G(LRCHG) D V21,DCOM^LRVERA Q
"RTN","LRVER4",74,0)
 S LRNX=$O(LRORD(LRNX)) G V35:LRNX<1 D SUBS
"RTN","LRVER4",75,0)
 G:'$G(LRTS) V20
"RTN","LRVER4",76,0)
 I '$D(LRSB(LRSB)),'$D(^LR(LRDFN,LRSS,LRIDT,LRSB)) G V20
"RTN","LRVER4",77,0)
 D V25^LRVER5
"RTN","LRVER4",78,0)
 ;
"RTN","LRVER4",79,0)
 D:$D(LRGVP) PG Q:$D(LRGVP)&($D(DTOUT)!$D(DUOUT))
"RTN","LRVER4",80,0)
 ;
"RTN","LRVER4",81,0)
 W !,$P(^LAB(60,+LRTS,0),U)
"RTN","LRVER4",82,0)
 S X1=""
"RTN","LRVER4",83,0)
 I $D(^LR(LRDFN,LRSS,+LRLDT,LRSB)) D
"RTN","LRVER4",84,0)
 . S X1=$P(^(LRSB),U),X=X1
"RTN","LRVER4",85,0)
 . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRVER4",86,0)
 . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",X1)
"RTN","LRVER4",87,0)
 . . I X="" S X=X1
"RTN","LRVER4",88,0)
 . W:X'="" ?30,@LRFP
"RTN","LRVER4",89,0)
 S (X,LRFLG)=""
"RTN","LRVER4",90,0)
 I $D(LRSB(LRSB)) D
"RTN","LRVER4",91,0)
 . N LRX
"RTN","LRVER4",92,0)
 . K LRNOVER(LRSB)
"RTN","LRVER4",93,0)
 . S (LRDL,LRX,X)=$P(LRSB(LRSB),U)
"RTN","LRVER4",94,0)
 . S LREDIT=0,LRFLG=$P(LRSB(LRSB),U,2)
"RTN","LRVER4",95,0)
 . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRVER4",96,0)
 . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",LRX)
"RTN","LRVER4",97,0)
 . . I X="" S X=LRX
"RTN","LRVER4",98,0)
 . W ?44," ",@LRFP," ",LRFLG,?56," ",$P($P(LRSB(LRSB),U,5),"!",7) ;$P(LRNG,U,7)
"RTN","LRVER4",99,0)
 . S X=LRX
"RTN","LRVER4",100,0)
 . I X=""!(X="canc")!(X="comment")!(X="pending") Q
"RTN","LRVER4",101,0)
 . S Y=0
"RTN","LRVER4",102,0)
 . I LRDEL'="" S LRQ=1 X LRDEL K LRQ
"RTN","LRVER4",103,0)
 . W "  "
"RTN","LRVER4",104,0)
 . I '$D(LRQ),$E(LRFLG,2)="*" D DISPFLG^LRVER4
"RTN","LRVER4",105,0)
 ;
"RTN","LRVER4",106,0)
 S:$P(X,U)="" $P(LRSB(LRSB),U)=""
"RTN","LRVER4",107,0)
 I $P(X,U)'="" D
"RTN","LRVER4",108,0)
 . N I,LRX,LRY
"RTN","LRVER4",109,0)
 . S $P(LRSB(LRSB),U)=X,$P(LRSB(LRSB),U,2)=LRFLG
"RTN","LRVER4",110,0)
 . S LRX=$$TMPSB^LRVER1(LRSB),LRY=$P(LRSB(LRSB),U,3)
"RTN","LRVER4",111,0)
 . F I=1:1:$L(LRX,"!") I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,"!",I)
"RTN","LRVER4",112,0)
 . S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRVER4",113,0)
 . I $P($P(LRSB(LRSB),U,3),"!")="" D RONLT^LRVER3
"RTN","LRVER4",114,0)
 . D
"RTN","LRVER4",115,0)
 . . I $P(LRSB(LRSB),U,4)!($P(LRSB(LRSB),U)="pending") Q
"RTN","LRVER4",116,0)
 . . I '$D(LRSA(LRSB))#2 S $P(LRSB(LRSB),U,4)=$S($G(LRDUZ):LRDUZ,1:$G(DUZ)),$P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),$G(DUZ(2)):DUZ(2),1:"") Q
"RTN","LRVER4",117,0)
 . . I $P(LRSB(LRSB),U)=$P(LRSA(LRSB),U) S:$P(LRSA(LRSB),U,4) $P(LRSB(LRSB),U,4)=$P(LRSA(LRSB),U,4) S $P(LRSA(LRSB),U,3)=$P(LRSB(LRSB),U,3) Q
"RTN","LRVER4",118,0)
 . . S:'$P(LRSB(LRSB),U,4) $P(LRSB(LRSB),U,4)=$S($G(LRDUZ):LRDUZ,1:$G(DUZ)),$P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),$G(DUZ(2)):DUZ(2),1:"")
"RTN","LRVER4",119,0)
 . S $P(LRSB(LRSB),U,5)=$TR(LRNGS,U,"!")
"RTN","LRVER4",120,0)
 I '$D(LRNUF) S LRLCT=LRLCT+1 S:$X>80 LRLCT=LRLCT+1 D:LRLCT>22 WT G:$G(Y)'="^" V20
"RTN","LRVER4",121,0)
 ;
"RTN","LRVER4",122,0)
V35 ;
"RTN","LRVER4",123,0)
 D LRCFL:LRCFL]""
"RTN","LRVER4",124,0)
 D DCOM^LRVERA K LRNUF
"RTN","LRVER4",125,0)
 Q
"RTN","LRVER4",126,0)
 ;
"RTN","LRVER4",127,0)
 ;
"RTN","LRVER4",128,0)
LRCFL ;
"RTN","LRVER4",129,0)
 S LREXEC=LRCFL D ^LREXEC:LRCFL[""
"RTN","LRVER4",130,0)
 D:LRLCT>22 WT
"RTN","LRVER4",131,0)
 Q
"RTN","LRVER4",132,0)
 ;
"RTN","LRVER4",133,0)
 ;
"RTN","LRVER4",134,0)
EDIT ;
"RTN","LRVER4",135,0)
 K LROUT
"RTN","LRVER4",136,0)
 D ^LRVER5 S LRVRM=2 G:$G(LRCHG) LOOP G LRCFL:$D(LROUT)!$D(LRPER)
"RTN","LRVER4",137,0)
 G LOOP
"RTN","LRVER4",138,0)
 ;
"RTN","LRVER4",139,0)
 ;
"RTN","LRVER4",140,0)
RANGE ;
"RTN","LRVER4",141,0)
 N LRI,LRFIND
"RTN","LRVER4",142,0)
 S Y=X
"RTN","LRVER4",143,0)
 I X=""!(X="canc")!(X="comment")!(X="pending") Q
"RTN","LRVER4",144,0)
 W "  "
"RTN","LRVER4",145,0)
 F LRI=1:1:$L(X) S LRFIND=$E(X,LRI) Q:LRFIND?1(1N,1A,1".",1"-",1"<",1">")
"RTN","LRVER4",146,0)
 S X=$E(X,LRI,999)
"RTN","LRVER4",147,0)
 ;
"RTN","LRVER4",148,0)
 ; User has indicated specific normality to set - used when entering
"RTN","LRVER4",149,0)
 ; reference lab results and all the info to calculate is not available.
"RTN","LRVER4",150,0)
 I $G(LRRFLAG(LRSB)) S LRFLG=$P("L^L*^H^H*","^",LRRFLAG(LRSB))
"RTN","LRVER4",151,0)
 ;
"RTN","LRVER4",152,0)
 E  D RANGECHK
"RTN","LRVER4",153,0)
 I '$D(LRQ),$E(LRFLG,2)="*" D DISPFLG^LRVER4
"RTN","LRVER4",154,0)
RQ S X=Y
"RTN","LRVER4",155,0)
 Q
"RTN","LRVER4",156,0)
 ;
"RTN","LRVER4",157,0)
 ;
"RTN","LRVER4",158,0)
RANGECHK ; Check result against reference ranges and set flag
"RTN","LRVER4",159,0)
 ;
"RTN","LRVER4",160,0)
 ;
"RTN","LRVER4",161,0)
 ; Check for numeric abnormal results
"RTN","LRVER4",162,0)
 I X?.1"-".N.1".".N D  Q
"RTN","LRVER4",163,0)
 . I LRNG4'="",LRNG4?.1"-".N.1".".N,X<LRNG4 S LRFLG="L*" Q
"RTN","LRVER4",164,0)
 . I LRNG5'="",LRNG5?.1"-".N.1".".N,X>LRNG5 S LRFLG="H*" Q
"RTN","LRVER4",165,0)
 . I LRNG2'="",LRNG2?.1"-".N.1".".N,X<LRNG2 S LRFLG="L" Q
"RTN","LRVER4",166,0)
 . I LRNG3'="",LRNG3?.1"-".N.1".".N,X>LRNG3 S LRFLG="H" Q
"RTN","LRVER4",167,0)
 ;
"RTN","LRVER4",168,0)
 ; Check for <> abnormal results
"RTN","LRVER4",169,0)
 ; "<" results checked against low values
"RTN","LRVER4",170,0)
 ; ">" results checked against high values
"RTN","LRVER4",171,0)
 I X?1(1"<",1">").N.1".".N D  Q
"RTN","LRVER4",172,0)
 . N LRX
"RTN","LRVER4",173,0)
 . S LRX=$E(X,2,$L(X))
"RTN","LRVER4",174,0)
 . I $E(X)="<" D  Q
"RTN","LRVER4",175,0)
 . . I LRNG4'="",LRNG4?.N.1".".N,LRX<LRNG4 S LRFLG="L*" Q
"RTN","LRVER4",176,0)
 . . I LRNG4'="",LRNG4?.N.1".".N,LRX=LRNG4 S LRFLG="L*" Q
"RTN","LRVER4",177,0)
 . . I LRNG2'="",LRNG2?.N.1".".N,LRX<LRNG2 S LRFLG="L" Q
"RTN","LRVER4",178,0)
 . . I LRNG2'="",LRNG2?.N.1".".N,LRX=LRNG2 S LRFLG="L" Q
"RTN","LRVER4",179,0)
 . I $E(X)=">" D  Q
"RTN","LRVER4",180,0)
 . . I LRNG5'="",LRNG5?.N.1".".N,LRX>LRNG5 S LRFLG="H*" Q
"RTN","LRVER4",181,0)
 . . I LRNG5'="",LRNG5?.N.1".".N,LRX=LRNG5 S LRFLG="H*" Q
"RTN","LRVER4",182,0)
 . . I LRNG3'="",LRNG3?.N.1".".N,LRX>LRNG3 S LRFLG="H" Q
"RTN","LRVER4",183,0)
 . . I LRNG3'="",LRNG3?.N.1".".N,LRX=LRNG3 S LRFLG="H" Q
"RTN","LRVER4",184,0)
 ;
"RTN","LRVER4",185,0)
 ; Check for ranges, i.e. 0-5, 6-10.
"RTN","LRVER4",186,0)
 ; Compare first value to abnormal value
"RTN","LRVER4",187,0)
 I X?1.N1"-"1.N D  Q
"RTN","LRVER4",188,0)
 . I LRNG4'="",LRNG4?.N.1".".N,+X<LRNG4 S LRFLG="L*" Q
"RTN","LRVER4",189,0)
 . I LRNG5'="",LRNG5?.N.1".".N,+X>LRNG5 S LRFLG="H*" Q
"RTN","LRVER4",190,0)
 . I LRNG2'="",LRNG2?.N.1".".N,+X<LRNG2 S LRFLG="L" Q
"RTN","LRVER4",191,0)
 . I LRNG3'="",LRNG3?.N.1".".N,+X>LRNG3 S LRFLG="H" Q
"RTN","LRVER4",192,0)
 ;
"RTN","LRVER4",193,0)
 Q
"RTN","LRVER4",194,0)
 ;
"RTN","LRVER4",195,0)
 ;
"RTN","LRVER4",196,0)
DISPFLG ; Display critical flags
"RTN","LRVER4",197,0)
 ;
"RTN","LRVER4",198,0)
 I $E(IOST,1,2)="C-" W $C(7),@LRVIDO
"RTN","LRVER4",199,0)
 W "CRITICAL ",$S($E(LRFLG,1)="L":"LOW",$E(LRFLG,1)="H":"HIGH",1:""),"!!"
"RTN","LRVER4",200,0)
 I $E(IOST,1,2)="C-" W @LRVIDOF,$C(7),$C(7)
"RTN","LRVER4",201,0)
 Q
"RTN","LRVER4",202,0)
 ;
"RTN","LRVER4",203,0)
 ;
"RTN","LRVER4",204,0)
SUBS ;
"RTN","LRVER4",205,0)
 S LRSB=LRORD(LRNX),LRTS=$S($D(^TMP("LR",$J,"TMP",LRSB)):^(LRSB),1:0)
"RTN","LRVER4",206,0)
 Q
"RTN","LRVER4",207,0)
 ;
"RTN","LRVER4",208,0)
 ;
"RTN","LRVER4",209,0)
ND ;
"RTN","LRVER4",210,0)
 K X,DIR
"RTN","LRVER4",211,0)
 Q:'LRVF
"RTN","LRVER4",212,0)
 I '$P($G(LRLABKY),U) D  Q
"RTN","LRVER4",213,0)
 . W !,"You're not authorized to edit verified data."
"RTN","LRVER4",214,0)
 . S LREDIT=0
"RTN","LRVER4",215,0)
 S DIR(0)="FO"
"RTN","LRVER4",216,0)
 S DIR("A")="If you need to change something, enter your initials"
"RTN","LRVER4",217,0)
 S DIR("?")="To change verified results, enter your initials."
"RTN","LRVER4",218,0)
 D ^DIR
"RTN","LRVER4",219,0)
 S X=Y K DIR
"RTN","LRVER4",220,0)
 I $$UP^XLFSTR(X)'=$$UP^XLFSTR(LRUSI) S LREDIT=0 K X QUIT
"RTN","LRVER4",221,0)
 I $D(X)#2,'$G(LRCHG) W ! D  S LRCHG=1
"RTN","LRVER4",222,0)
 . K LRSA S LRSA=1
"RTN","LRVER4",223,0)
 . F  S LRSA=$O(^LR(LRDFN,"CH",LRIDT,LRSA)) Q:'LRSA  S LRSA(LRSA)=^(LRSA)
"RTN","LRVER4",224,0)
 Q
"RTN","LRVER4",225,0)
 ;
"RTN","LRVER4",226,0)
 ;
"RTN","LRVER4",227,0)
WT S LRLCT=0 Q:$D(LRGVP)
"RTN","LRVER4",228,0)
 W !,"PRESS ANY KEY TO CONTINUE, '^' TO STOP " R Y:DTIME S:'$T Y="^"
"RTN","LRVER4",229,0)
 Q
"RTN","LRVER4",230,0)
 ;
"RTN","LRVER4",231,0)
 ;
"RTN","LRVER4",232,0)
COM ;from LRVER5
"RTN","LRVER4",233,0)
 Q:$D(LRGVP)
"RTN","LRVER4",234,0)
 K DR
"RTN","LRVER4",235,0)
 S DIE="^LR("_LRDFN_",""CH"",",DA=LRIDT,DA(1)=LRDFN,DR=.99
"RTN","LRVER4",236,0)
 D ^DIE,COM1:$D(LRNC)
"RTN","LRVER4",237,0)
 L +^LR(LRDFN,LRSS,LRIDT):5
"RTN","LRVER4",238,0)
 I $O(^LR(LRDFN,"CH",LRIDT,1,0))="" K ^LR(LRDFN,"CH",LRIDT,1)
"RTN","LRVER4",239,0)
 L -^LR(LRDFN,LRSS,LRIDT)
"RTN","LRVER4",240,0)
 Q
"RTN","LRVER4",241,0)
 ;
"RTN","LRVER4",242,0)
 ;
"RTN","LRVER4",243,0)
VOL ;
"RTN","LRVER4",244,0)
 W !,"VOLUME: ",$P(^LR(LRDFN,LRSS,LRIDT,0),U,7),"//" R X:DTIME
"RTN","LRVER4",245,0)
 G VOL:X["?" S:X'=""&(X'[U) ^(0)=$P(^(0),U,1,6)_U_X_U_$P(^(0),U,8,10)
"RTN","LRVER4",246,0)
 G COM
"RTN","LRVER4",247,0)
 ;
"RTN","LRVER4",248,0)
 ;
"RTN","LRVER4",249,0)
COM1 ;
"RTN","LRVER4",250,0)
 N LRX Q:'$P(^LR(LRDFN,LRSS,LRIDT,0),U,3)
"RTN","LRVER4",251,0)
 D XREF^LRVER3A
"RTN","LRVER4",252,0)
 S LRX=0 F  S LRX=$O(^TMP("LR",$J,"TMP",LRX)) Q:LRX<1  S ^LRO(68,"AC",LRDFN,LRIDT,LRX)=""
"RTN","LRVER4",253,0)
 I $L($P(^LR(LRDFN,LRSS,LRIDT,0),U,9)),$E($P(^(0),U,9))'="-" S $P(^(0),U,9)="-"_$P(^(0),U,9)
"RTN","LRVER4",254,0)
 Q
"RTN","LRVER4",255,0)
 ;
"RTN","LRVER4",256,0)
 ;
"RTN","LRVER4",257,0)
PG Q:$Y<(IOSL+5)
"RTN","LRVER4",258,0)
 I $E(IOST,1,2)'="C-" W @IOF Q
"RTN","LRVER4",259,0)
 D PG^LRGVP
"RTN","LRVER4",260,0)
 Q
"RTN","LRVER4",261,0)
 ;
"RTN","LRVER4",262,0)
V21 ;
"RTN","LRVER4",263,0)
 N Y,LREND
"RTN","LRVER4",264,0)
 S LRSB=1,LRLCT=1
"RTN","LRVER4",265,0)
 F  S LRSB=+$O(LRSB(LRSB)) Q:'LRSB!($G(LREND))  D
"RTN","LRVER4",266,0)
 . N LRX
"RTN","LRVER4",267,0)
 . S LRTS=$O(^LAB(60,"C","CH;"_LRSB_";1",0)) Q:'LRTS
"RTN","LRVER4",268,0)
 . D V25^LRVER5
"RTN","LRVER4",269,0)
 . W !,$P(^LAB(60,LRTS,0),U) S X1=""
"RTN","LRVER4",270,0)
 . I $D(^LR(LRDFN,LRSS,+LRLDT,LRSB)) D
"RTN","LRVER4",271,0)
 . . S X1=$P(^(LRSB),U),(LRDL,X)=X1
"RTN","LRVER4",272,0)
 . . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRVER4",273,0)
 . . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",X1)
"RTN","LRVER4",274,0)
 . . . I X="" S X=X1
"RTN","LRVER4",275,0)
 . . W:X'="" ?30,@LRFP
"RTN","LRVER4",276,0)
 . S (LRDL,LRX,X)=$P(LRSB(LRSB),U)
"RTN","LRVER4",277,0)
 . S LREDIT=0,LRFLG=$P(LRSB(LRSB),U,2)
"RTN","LRVER4",278,0)
 . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRVER4",279,0)
 . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",LRX)
"RTN","LRVER4",280,0)
 . . I X="" S X=LRX
"RTN","LRVER4",281,0)
 . W ?44," ",@LRFP," ",LRFLG,?56," ",$P(LRNG,U,7)
"RTN","LRVER4",282,0)
 . S X=LRX
"RTN","LRVER4",283,0)
 . I X=""!(X="canc")!(X="comment")!(X="pending") Q
"RTN","LRVER4",284,0)
 . S Y=0
"RTN","LRVER4",285,0)
 . I LRDEL'="" S LRQ=1 X LRDEL K LRQ
"RTN","LRVER4",286,0)
 . W "  "
"RTN","LRVER4",287,0)
 . I '$D(LRQ),$E(LRFLG,2)="*" D DISPFLG^LRVER4
"RTN","LRVER4",288,0)
 . I '$D(LRNUF) S LRLCT=LRLCT+1 S:$X>80 LRLCT=LRLCT+1 D:LRLCT>15 WT S:$E($G(Y))="^" LREND=1
"RTN","LRVER4",289,0)
 Q
"RTN","LRVER5")
0^26^B82061816
"RTN","LRVER5",1,0)
LRVER5 ;DALOI/CJS/DALOI/FHS - LAB ROUTINE DATA VERIFICATION ;2/7/91  12:04
"RTN","LRVER5",2,0)
 ;;5.2;LAB SERVICE;**42,153,283,286**;Sep 27, 1994
"RTN","LRVER5",3,0)
 ;
"RTN","LRVER5",4,0)
 I $G(LRNDISP) D
"RTN","LRVER5",5,0)
 . S LRNX=0
"RTN","LRVER5",6,0)
 . N LRX F  S LRNX=$O(LRORD(LRNX)) Q:LRNX<1  S LRX(LRORD(LRNX))=""
"RTN","LRVER5",7,0)
 . S LRX=0 F  S LRX=$O(LRSB(LRX)) Q:LRX<1  K:'$D(LRX(LRX)) LRSB(LRX),LRSA(LRX)
"RTN","LRVER5",8,0)
 ;
"RTN","LRVER5",9,0)
 ; Check for amended results that have arrived via an HL7 interface.
"RTN","LRVER5",10,0)
 ; Only allow amended results to be verified during this session.
"RTN","LRVER5",11,0)
 I $D(^LAH("LA7 AMENDED RESULTS",LRUID)) D
"RTN","LRVER5",12,0)
 . S LRNX=0
"RTN","LRVER5",13,0)
 . F  S LRNX=$O(LRORD(LRNX)) Q:'LRNX  I '$D(^LAH("LA7 AMENDED RESULTS",LRUID,LRORD(LRNX))) K LRORD(LRNX)
"RTN","LRVER5",14,0)
 . S LRNX=0
"RTN","LRVER5",15,0)
 . F  S LRNX=$O(LRSB(LRNX)) Q:'LRNX  I '$D(^LAH("LA7 AMENDED RESULTS",LRUID,LRNX)) K LRSB(LRNX),LRSA(LRNX)
"RTN","LRVER5",16,0)
 ;
"RTN","LRVER5",17,0)
 S LRNX=0,LRVRM=12
"RTN","LRVER5",18,0)
 ;
"RTN","LRVER5",19,0)
V40 S LRNX=$O(LRORD(LRNX)) G V44:LRNX<1 D LRSUBS
"RTN","LRVER5",20,0)
 ;
"RTN","LRVER5",21,0)
 ; Check if changing performing lab.
"RTN","LRVER5",22,0)
 I $P($G(LRSB(LRSB)),"^",9),'$$PLOK^LRVERA($P(LRSB(LRSB),"^",9),$G(LRDUZ(2)),DUZ(2),LRTS) G V40
"RTN","LRVER5",23,0)
 ;
"RTN","LRVER5",24,0)
 D V25
"RTN","LRVER5",25,0)
 ;
"RTN","LRVER5",26,0)
V42 ;
"RTN","LRVER5",27,0)
 ;
"RTN","LRVER5",28,0)
 S (LRDL,SX,X)=$P($G(LRSB(LRSB)),U),LRDVF=0,LREDIT=0
"RTN","LRVER5",29,0)
 S:X=""&(LRDV'="") X=LRDV,LRDVF=1 ; default value
"RTN","LRVER5",30,0)
 S LRTEST=$P(^LAB(60,LRTS,0),U)
"RTN","LRVER5",31,0)
 K LRNOVER(LRSB)
"RTN","LRVER5",32,0)
 ;
"RTN","LRVER5",33,0)
Q42 ;
"RTN","LRVER5",34,0)
 ;
"RTN","LRVER5",35,0)
 ; Check for amended results that have arrived via an HL7 interface.
"RTN","LRVER5",36,0)
 I $D(^LAH("LA7 AMENDED RESULTS",LRUID,LRSB)) D  G:SX'=X!($G(LRAMEND(LRSB))) V45
"RTN","LRVER5",37,0)
 . W !,LRTEST," " W:X'="" @LRFP
"RTN","LRVER5",38,0)
 . D AMEND Q:$G(LRAMEND(LRSB))
"RTN","LRVER5",39,0)
 . I SX=X W !,LRTEST," " W:X'="" @LRFP
"RTN","LRVER5",40,0)
 ;
"RTN","LRVER5",41,0)
 ; If entering results from a reference lab and not using normal/units
"RTN","LRVER5",42,0)
 ; from file #60 then ask user for these values otherwise display
"RTN","LRVER5",43,0)
 ; current file #60 values.
"RTN","LRVER5",44,0)
 I $G(LRDUZ(2)),LRDUZ(2)'=DUZ(2) D
"RTN","LRVER5",45,0)
 . I $G(^LAB(60,+LRTS,1,+$G(LRSPEC),.1)) D  Q
"RTN","LRVER5",46,0)
 . . D V25
"RTN","LRVER5",47,0)
 . . W !!,"Current Ref Range: ",LRNG2,"-",LRNG3," Units: ",$P(LRNG,"^",7)
"RTN","LRVER5",48,0)
 . . I LRNG4="",LRNG5="" Q
"RTN","LRVER5",49,0)
 . . W !,"     Critical Low: ",LRNG4," Critical High: ",LRNG5
"RTN","LRVER5",50,0)
 . N LRX,LRY
"RTN","LRVER5",51,0)
 . D ASKPLNR,NORM
"RTN","LRVER5",52,0)
 . S LRX=$P(LRNGS,"^",2,5),LRX=$TR(LRX,"^","!")
"RTN","LRVER5",53,0)
 . S LRY=$P($G(LRSB(LRSB)),"^",5),$P(LRY,"!",2,5)=LRX
"RTN","LRVER5",54,0)
 . S $P(LRSB(LRSB),"^",5)=LRY
"RTN","LRVER5",55,0)
 ;
"RTN","LRVER5",56,0)
 W !,LRTEST," " W:X'="" @LRFP
"RTN","LRVER5",57,0)
 R "//",X:DTIME
"RTN","LRVER5",58,0)
 I X'?.ANP W $C(7)," No Control Characters allowed." G V42
"RTN","LRVER5",59,0)
 S:$L($G(SX))&(X="") X=SX,LRDVF=1
"RTN","LRVER5",60,0)
 S LRDL=X I X=""&LRDVF S (LRD,X)=LRDV G V45
"RTN","LRVER5",61,0)
Q43 G V40:X="",V45:X'["^",V44:X="^",LROUT:X="^^"
"RTN","LRVER5",62,0)
 ;
"RTN","LRVER5",63,0)
V43 S X=$P(X,U,2),DIC="^LAB(60,",DIC(0)="EOQZ" D ^DIC G:Y<1 Q42
"RTN","LRVER5",64,0)
 S LRPLOC=$P(Y(0),U,5),LRSSQ=$P(LRPLOC,";",1),LRSB=$P(LRPLOC,";",2),LRTS=+Y
"RTN","LRVER5",65,0)
 I LRSSQ="" W !,"Not in this group" G LROUT
"RTN","LRVER5",66,0)
 I LRSS'=LRSSQ!'$D(^TMP("LR",$J,"TMP",LRSB)) W !,"Not in this group" G LROUT
"RTN","LRVER5",67,0)
 S LRNX=0
"RTN","LRVER5",68,0)
 F  S LRNX=$O(LRORD(LRNX)) Q:LRNX<1  Q:LRSB=LRORD(LRNX)
"RTN","LRVER5",69,0)
 I LRNX,LRSB=LRORD(LRNX) D LRSUBS,V25 G V42
"RTN","LRVER5",70,0)
 ;
"RTN","LRVER5",71,0)
V44 K SX
"RTN","LRVER5",72,0)
 D COM^LRVER4
"RTN","LRVER5",73,0)
 S LRNUF=1 S:LRVF LRSA=1
"RTN","LRVER5",74,0)
 Q
"RTN","LRVER5",75,0)
 ;
"RTN","LRVER5",76,0)
V45 ;
"RTN","LRVER5",77,0)
 K LRSKIP
"RTN","LRVER5",78,0)
 I X="@" D  G V46
"RTN","LRVER5",79,0)
 . K:'$G(LRVF) ^LR(LRDFN,LRSS,LRIDT,LRSB)
"RTN","LRVER5",80,0)
 . S X=$S($G(LRVF)&($D(LRSB(LRSB)))&('$D(LRM(LRSB))):"comment",$D(LRM(LRSB)):"pending",$D(LRSA(LRSB)):"canc",1:"")
"RTN","LRVER5",81,0)
 . S $P(LRSB(LRSB),"^")=X,$P(LRSB(LRSB),"^",2)=""
"RTN","LRVER5",82,0)
 ;
"RTN","LRVER5",83,0)
 S LRXD=U_$P(^LAB(60,LRTS,0),U,12),LRXDP=LRXD_"0)",LRXDP=@LRXDP
"RTN","LRVER5",84,0)
 X:'(X="*"!($E(X)="?")!(X="C")!(X="#")!(X="canc")!(X="pending")) $P(LRXDP,U,5,99)
"RTN","LRVER5",85,0)
 I '$D(X)#2 D HELP G V42
"RTN","LRVER5",86,0)
 I $D(X)#2,X["?" D HELP G:'($P(LRXDP,U,2)["S") V42
"RTN","LRVER5",87,0)
 I $D(X)#2,$P(LRXDP,U,2)["S",X'="*",X'="#",X'="canc",X'="pending" D LRSET G:'$D(X)#2 V42
"RTN","LRVER5",88,0)
 I $D(X)#2,X="C",$P(LRXDP,U,2)'["S" D COMP G V42
"RTN","LRVER5",89,0)
 ;
"RTN","LRVER5",90,0)
V46 ;
"RTN","LRVER5",91,0)
 G V42:'$D(X)#2
"RTN","LRVER5",92,0)
 I LRVF,$D(LRSB(LRSB)),$D(LRSA(LRSB)) S LRSA(LRSB,1)=LRTEST
"RTN","LRVER5",93,0)
 S X1=$S($D(^LR(LRDFN,LRSS,+LRLDT,LRSB)):$P(^(LRSB),U),1:"")
"RTN","LRVER5",94,0)
 S:X="*" X="canc" S:X="#" X="comment"
"RTN","LRVER5",95,0)
 ;
"RTN","LRVER5",96,0)
 I '$G(LRAMEND(LRSB)) S LRFLG=""
"RTN","LRVER5",97,0)
 S Y=0 X:LRDEL'="" LRDEL
"RTN","LRVER5",98,0)
 I '$G(LRAMEND(LRSB)) D RANGE^LRVER4
"RTN","LRVER5",99,0)
 ;
"RTN","LRVER5",100,0)
 S:$P(X,U)="" $P(LRSB(LRSB),U)=""
"RTN","LRVER5",101,0)
 I $P(X,U)'="" D
"RTN","LRVER5",102,0)
 . S $P(LRSB(LRSB),U)=X,$P(LRSB(LRSB),U,2)=LRFLG
"RTN","LRVER5",103,0)
 . S LRX=$$TMPSB^LRVER1(LRSB),LRY=$P(LRSB(LRSB),U,3)
"RTN","LRVER5",104,0)
 . F I=1:1:$L(LRX,"!") I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,"!",I)
"RTN","LRVER5",105,0)
 . S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRVER5",106,0)
 . I $P($P(LRSB(LRSB),U,3),"!")="" D RONLT^LRVER3
"RTN","LRVER5",107,0)
 . D
"RTN","LRVER5",108,0)
 . . I '$D(LRSA(LRSB))#2 D  Q
"RTN","LRVER5",109,0)
 . . . S $P(LRSB(LRSB),U,4)=$S($G(LRDUZ):LRDUZ,1:$G(DUZ))
"RTN","LRVER5",110,0)
 . . . S $P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),1:$G(DUZ(2)))
"RTN","LRVER5",111,0)
 . . S:'$P(LRSB(LRSB),U,4) $P(LRSB(LRSB),U,4)=$S($G(LRDUZ):LRDUZ,1:$G(DUZ))
"RTN","LRVER5",112,0)
 . S $P(LRSB(LRSB),U,5)=$TR(LRNGS,U,"!")
"RTN","LRVER5",113,0)
 . S $P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),1:$G(DUZ(2)))
"RTN","LRVER5",114,0)
 G:$D(LRNUF) V44 K LRNUF G V40:'$D(LRSKIP) S X=LRSKIP G Q43:X["^",V40
"RTN","LRVER5",115,0)
 ;
"RTN","LRVER5",116,0)
 ;
"RTN","LRVER5",117,0)
RANGE ;
"RTN","LRVER5",118,0)
 S $P(LRSB(LRSB),"^")=X
"RTN","LRVER5",119,0)
 ; If previous results from another laboratory then use normals and units
"RTN","LRVER5",120,0)
 ; associated with those results.
"RTN","LRVER5",121,0)
 D
"RTN","LRVER5",122,0)
 . I $G(LRDUZ(2)),DUZ(2)'=LRDUZ(2) D PLNR^LRVR4 Q
"RTN","LRVER5",123,0)
 . I $P(LRSB(LRSB),"^",9),DUZ(2)'=$P(LRSB(LRSB),"^",9) D PLNR^LRVR4
"RTN","LRVER5",124,0)
 D RANGE^LRVER4
"RTN","LRVER5",125,0)
 Q
"RTN","LRVER5",126,0)
 ;
"RTN","LRVER5",127,0)
 ;
"RTN","LRVER5",128,0)
LRSUBS ; From LRVR5
"RTN","LRVER5",129,0)
 S LRSB=LRORD(LRNX),LRTS=$S($D(^TMP("LR",$J,"TMP",LRSB))#2:^(LRSB),1:0)
"RTN","LRVER5",130,0)
 Q
"RTN","LRVER5",131,0)
 ;
"RTN","LRVER5",132,0)
 ;
"RTN","LRVER5",133,0)
LRSET ; from above and LRVR5
"RTN","LRVER5",134,0)
 ;
"RTN","LRVER5",135,0)
 N I,LRERR,RESULT
"RTN","LRVER5",136,0)
 D CHK^DIE(63.04,LRSB,"EH",X,.RESULT,"LRERR")
"RTN","LRVER5",137,0)
 ;
"RTN","LRVER5",138,0)
 I RESULT'="^" S X=RESULT W "  ",RESULT(0)
"RTN","LRVER5",139,0)
 ;
"RTN","LRVER5",140,0)
 I RESULT="^" D
"RTN","LRVER5",141,0)
 . F I=1:1:LRERR("DIHELP") W !,LRERR("DIHELP",I)
"RTN","LRVER5",142,0)
 . K X
"RTN","LRVER5",143,0)
 ;
"RTN","LRVER5",144,0)
 Q
"RTN","LRVER5",145,0)
 ;
"RTN","LRVER5",146,0)
 ;
"RTN","LRVER5",147,0)
COMP ; from LRVR5
"RTN","LRVER5",148,0)
 S X="^%ET",@^%ZOSF("TRAP")
"RTN","LRVER5",149,0)
 R !,"Enter your computation: ",C:DTIME
"RTN","LRVER5",150,0)
 Q:"^"[C  G CH:C="?"!(C["""") S C=$P(C," ",1)
"RTN","LRVER5",151,0)
 S X="TRAP^LRVER5",@^%ZOSF("TRAP") D ^DIM S X="W "_C
"RTN","LRVER5",152,0)
 I '$D(X)#2 W !,"Something's wrong with the syntax." G CH
"RTN","LRVER5",153,0)
 F I=1:1:$L(C) I $E(C,I)?1A S I=.9 Q
"RTN","LRVER5",154,0)
 G CH:I=.9,CH:C["/0",CH:C["\0" W !," equals ",@C G COMP
"RTN","LRVER5",155,0)
TRAP ;
"RTN","LRVER5",156,0)
 W !!,"Error in your mathematical formular ",!
"RTN","LRVER5",157,0)
CH W !,"Enter for example: 5*2/4+1 and 3.5 will be returned [i.e. ((5*2)/4)+1=3.5]"
"RTN","LRVER5",158,0)
 G COMP
"RTN","LRVER5",159,0)
 ;
"RTN","LRVER5",160,0)
 ;
"RTN","LRVER5",161,0)
V25 ; From LRVER4
"RTN","LRVER5",162,0)
 N LRTX,LRX
"RTN","LRVER5",163,0)
 S (LRDV,LRNG,LRDEL,LRNGS)=""
"RTN","LRVER5",164,0)
 I '$D(^LAB(60,+LRTS,0))#2 Q
"RTN","LRVER5",165,0)
 S LRX=+$P($P(^LAB(60,+LRTS,0),U,5),";",2)
"RTN","LRVER5",166,0)
 S LRTX=$S($L($P(^LAB(60,+LRTS,0),U,5)):$O(^LAB(60,"C",$P(^LAB(60,+LRTS,0),U,5),0)),1:+LRTS)
"RTN","LRVER5",167,0)
 S LRFP=$P(^LAB(60,LRTX,.1),U,3)
"RTN","LRVER5",168,0)
 I LRFP="" S LRFP="$J(X,8)"
"RTN","LRVER5",169,0)
 ;
"RTN","LRVER5",170,0)
 ; Normal ranges, units, delta checks and default value
"RTN","LRVER5",171,0)
 I $D(^LAB(60,LRTX,1,+$G(LRSPEC),0)) D
"RTN","LRVER5",172,0)
 . S LRNG=^LAB(60,LRTX,1,+$G(LRSPEC),0)
"RTN","LRVER5",173,0)
 . S LRDEL=$G(^LAB(62.1,+$P(LRNG,U,8),1))
"RTN","LRVER5",174,0)
 . S LRDEL(1)=$G(^LAB(62.1,+$P(LRNG,U,8),2),"Q")
"RTN","LRVER5",175,0)
 . S X2=$P(LRNG,U,9)
"RTN","LRVER5",176,0)
 . S LRDV=$S('$D(LRSB(LRX)):$P(LRNG,U,10),1:"")
"RTN","LRVER5",177,0)
 ;
"RTN","LRVER5",178,0)
 ; When entering results from a reference lab check if flag to use normals/units from file 60.
"RTN","LRVER5",179,0)
 I $G(LRDUZ(2)),LRDUZ(2)'=DUZ(2),'$G(^LAB(60,LRTX,1,+$G(LRSPEC),.1)) D PLNR^LRVR4
"RTN","LRVER5",180,0)
 ;
"RTN","LRVER5",181,0)
NORM ;
"RTN","LRVER5",182,0)
 I $G(SEX)="" S SEX="M"
"RTN","LRVER5",183,0)
 I $G(AGE)="" S AGE=99
"RTN","LRVER5",184,0)
 S LRNGS=LRNG
"RTN","LRVER5",185,0)
 F LRX=2:1:5 D
"RTN","LRVER5",186,0)
 . N LRY
"RTN","LRVER5",187,0)
 . S LRY=$P(LRNG,"^",LRX)
"RTN","LRVER5",188,0)
 . ; enclose in quotes if text or structured numeric
"RTN","LRVER5",189,0)
 . I LRY'="",$E(LRY)?.(1A,1"<",1">") S LRY=$C(34)_LRY_$C(34)
"RTN","LRVER5",190,0)
 . I LRY'="",$E(LRY)'=$C(34),LRY'?.N.1".".N S @("LRY"_"="_LRY)
"RTN","LRVER5",191,0)
 . S $P(LRNG,"^",LRX)=LRY,$P(LRNGS,"^",LRX)=LRY,@("LRNG"_LRX)=LRY
"RTN","LRVER5",192,0)
 Q
"RTN","LRVER5",193,0)
 ;
"RTN","LRVER5",194,0)
 ;
"RTN","LRVER5",195,0)
LROUT ;
"RTN","LRVER5",196,0)
 K SX
"RTN","LRVER5",197,0)
 S LROUT=1
"RTN","LRVER5",198,0)
 Q
"RTN","LRVER5",199,0)
 ;
"RTN","LRVER5",200,0)
 ;
"RTN","LRVER5",201,0)
HELP W !," ??",$C(7) S LRXDH=LRXD_"3)"
"RTN","LRVER5",202,0)
 W:$D(@LRXDH) " ",@LRXDH
"RTN","LRVER5",203,0)
 W !,"Enter * to report ""canc"" for canceled."
"RTN","LRVER5",204,0)
 W !,"Enter # to report ""comment""."
"RTN","LRVER5",205,0)
 W:'($P(LRXDP,U,2)["S") !,"Enter C to enter calculate mode."
"RTN","LRVER5",206,0)
 Q
"RTN","LRVER5",207,0)
 ;
"RTN","LRVER5",208,0)
 ;
"RTN","LRVER5",209,0)
AMEND ; Process amended results and prompt user
"RTN","LRVER5",210,0)
 N LRANS,LRLL,LRSQ,LRROOT,LRX
"RTN","LRVER5",211,0)
 ; flag to indicate if amended results have been extracted from LAH
"RTN","LRVER5",212,0)
 S LRAMEND=0
"RTN","LRVER5",213,0)
 ; save current value of X
"RTN","LRVER5",214,0)
 S LRX=X
"RTN","LRVER5",215,0)
 S LRROOT=$Q(^LAH("LA7 AMENDED RESULTS",LRUID,LRSB))
"RTN","LRVER5",216,0)
 I LRROOT="" Q
"RTN","LRVER5",217,0)
 I $QS(LRROOT,1)'="LA7 AMENDED RESULTS"!($QS(LRROOT,2)'=LRUID)!($QS(LRROOT,3)'=LRSB) Q
"RTN","LRVER5",218,0)
 S LRLL=$QS(LRROOT,4),LRSQ=$QS(LRROOT,5)
"RTN","LRVER5",219,0)
 I $D(^LAH(LRLL,1,LRSQ,LRSB)) D
"RTN","LRVER5",220,0)
 . N DIR,DIRUT,DTOUT,DUOUT,LRJ,LRY,X,Y
"RTN","LRVER5",221,0)
 . S LRY=^LAH(LRLL,1,LRSQ,LRSB)
"RTN","LRVER5",222,0)
 . S DIR(0)="SOA^0:No;1:Yes;2:Keep but do not process",DIR("B")="Yes"
"RTN","LRVER5",223,0)
 . S DIR("A",1)=" ",DIR("A",2)="Amended result: "_$P(LRY,"^")
"RTN","LRVER5",224,0)
 . S DIR("A",2)=DIR("A",2)_"    flag: "_$S($P(LRY,"^",2)'="":$P(LRY,"^",2),1:"None")
"RTN","LRVER5",225,0)
 . S DIR("A",2)=DIR("A",2)_"    units: "_$P($P(LRY,"^",5),"!",7)
"RTN","LRVER5",226,0)
 . S DIR("A")="Accept amended results: "
"RTN","LRVER5",227,0)
 . S DIR("?",1)="Answer with 0-No to not accept amended result and delete.",DIR("?",2)="1-Yes to process amended result.",DIR("?")="or 2-Keep which skips processing but leaves result for future processing."
"RTN","LRVER5",228,0)
 . D ^DIR
"RTN","LRVER5",229,0)
 . I $D(DIRUT) Q
"RTN","LRVER5",230,0)
 . S LRANS=Y
"RTN","LRVER5",231,0)
 . I LRANS=2 Q
"RTN","LRVER5",232,0)
 . I LRANS=1 D
"RTN","LRVER5",233,0)
 . . S LRX=$P(LRY,"^"),LRFLG=$P(LRY,"^",2),LRSB(LRSB)=LRY,LRJ=$P(LRY,"^",5)
"RTN","LRVER5",234,0)
 . . F LRI=1,2,3,4,5,7,11,12 S $P(LRNG,"^",LRI)=$P(LRJ,"!",LRI)
"RTN","LRVER5",235,0)
 . . S LRNGS=LRNG,(LRAMEND,LRAMEND(LRSB))=1
"RTN","LRVER5",236,0)
 . . D LRSBCOM^LRVR4 ; also process any comments
"RTN","LRVER5",237,0)
 . K ^LAH(LRLL,1,LRSQ,LRSB)
"RTN","LRVER5",238,0)
 . K ^LAH("LA7 AMENDED RESULTS",LRUID,LRSB,LRLL,LRSQ)
"RTN","LRVER5",239,0)
 . I +$O(^LAH(LRLL,1,LRSQ,1))<1 D ZAPALL^LRVR3(LRLL,LRSQ)
"RTN","LRVER5",240,0)
 S X=LRX
"RTN","LRVER5",241,0)
 Q
"RTN","LRVER5",242,0)
 ;
"RTN","LRVER5",243,0)
 ;
"RTN","LRVER5",244,0)
ASKPLNR ; Ask user for performing lab normal ranges and units when entering
"RTN","LRVER5",245,0)
 ; manually and not using values from file #60.
"RTN","LRVER5",246,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,LRI,LRJ,LRX,LRY,Y,X,Y
"RTN","LRVER5",247,0)
 ;
"RTN","LRVER5",248,0)
 S LRX=$P($G(LRSB(LRSB)),"^",5)
"RTN","LRVER5",249,0)
 ;
"RTN","LRVER5",250,0)
 W !!,"For test ",LRTEST
"RTN","LRVER5",251,0)
 S DIR(0)="60.01,6"
"RTN","LRVER5",252,0)
 I $P(LRX,"!",7)'="" S DIR("B")=$P(LRX,"!",7)
"RTN","LRVER5",253,0)
 D ^DIR
"RTN","LRVER5",254,0)
 I $D(DTOUT)!($D(DUOUT)) Q
"RTN","LRVER5",255,0)
 ; Set units into component 7 of piece 5
"RTN","LRVER5",256,0)
 S $P(LRX,"!",7)=Y,$P(LRSB(LRSB),"^",5)=LRX
"RTN","LRVER5",257,0)
 ;
"RTN","LRVER5",258,0)
 ; Ask normals - high/low and critical
"RTN","LRVER5",259,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRVER5",260,0)
 F LRJ=1,2,3,4 D  Q:$D(DTOUT)!($D(DUOUT))
"RTN","LRVER5",261,0)
 . K DIR
"RTN","LRVER5",262,0)
 . S DIR(0)="60.01,"_LRJ,LRI=LRJ+1
"RTN","LRVER5",263,0)
 . I $P(LRX,"!",LRI)'="" D
"RTN","LRVER5",264,0)
 . . S DIR("B")=$P(LRX,"!",LRI)
"RTN","LRVER5",265,0)
 . . I $E(DIR("B"))=$C(34) Q
"RTN","LRVER5",266,0)
 . . I DIR("B")'?.N.1".".N S DIR("B")=$C(34)_DIR("B")_$C(34) ; enclose in quotes if text
"RTN","LRVER5",267,0)
 . D ^DIR
"RTN","LRVER5",268,0)
 . I $D(DTOUT)!($D(DUOUT)) Q
"RTN","LRVER5",269,0)
 . S $P(LRX,"!",LRI)=Y
"RTN","LRVER5",270,0)
 ;
"RTN","LRVER5",271,0)
 ; Ask user for normality in case user does not know high/low/critical.
"RTN","LRVER5",272,0)
 S LRRFLAG(LRSB)=$$RFLAG^LRVERA($P($G(LRSB(LRSB)),"^",2))
"RTN","LRVER5",273,0)
 ;
"RTN","LRVER5",274,0)
 ; Update normal variable LRNG
"RTN","LRVER5",275,0)
 I $P(LRX,"!")="" S $P(LRX,"!")=LRSPEC
"RTN","LRVER5",276,0)
 F LRI=1,2,3,4,5,7 S $P(LRNG,"^",LRI)=$P(LRX,"!",LRI)
"RTN","LRVER5",277,0)
 ;
"RTN","LRVER5",278,0)
 Q
"RTN","LRVERA")
0^27^B22675696
"RTN","LRVERA",1,0)
LRVERA ;DALOI/JMC - READ ACCESSION/UID ;2/7/91  14:49
"RTN","LRVERA",2,0)
 ;;5.2;LAB SERVICE;**153,271,286**;Sep 27, 1994
"RTN","LRVERA",3,0)
 ;
"RTN","LRVERA",4,0)
 ;
"RTN","LRVERA",5,0)
ACC ; Prompt for accession selection
"RTN","LRVERA",6,0)
 D EN^LRWU4
"RTN","LRVERA",7,0)
 Q
"RTN","LRVERA",8,0)
 ;
"RTN","LRVERA",9,0)
 ;
"RTN","LRVERA",10,0)
UID ; Prompt for UID selection
"RTN","LRVERA",11,0)
 ;
"RTN","LRVERA",12,0)
 N LRQUIT,LRX,LRY
"RTN","LRVERA",13,0)
 ;
"RTN","LRVERA",14,0)
 W !
"RTN","LRVERA",15,0)
 S (LRQUIT,LRY)=0
"RTN","LRVERA",16,0)
 F  D  Q:LRQUIT
"RTN","LRVERA",17,0)
 . S LRX=$$UID^LRWU4("Unique Identifier",$G(LRUID))
"RTN","LRVERA",18,0)
 . I LRX=0 S LRUID="",(LRAA,LRAD,LRAN)=-1,LRQUIT=1 Q
"RTN","LRVERA",19,0)
 . S LRY=$$CHECKUID^LRWU4(LRX)
"RTN","LRVERA",20,0)
 . I LRY S LRQUIT=1 Q
"RTN","LRVERA",21,0)
 . W !,"No accession on file for this UID."
"RTN","LRVERA",22,0)
 . S LRUID=""
"RTN","LRVERA",23,0)
 ;
"RTN","LRVERA",24,0)
 ; If good UID then update variables if user selected a different UID
"RTN","LRVERA",25,0)
 ; Display accession.
"RTN","LRVERA",26,0)
 I LRY D
"RTN","LRVERA",27,0)
 . I $G(LRUID)'=LRX S LRUID=LRX,LRAA=$P(LRY,"^",2),LRAD=$P(LRY,"^",3),LRAN=$P(LRY,"^",4)
"RTN","LRVERA",28,0)
 . W "   (",$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.2)),"^"),")"
"RTN","LRVERA",29,0)
 Q
"RTN","LRVERA",30,0)
 ;
"RTN","LRVERA",31,0)
 ;
"RTN","LRVERA",32,0)
SELPL(LR4) ; Select the performing laboratory to store with test results.
"RTN","LRVERA",33,0)
 ; Call with LR4 = default institution, usually value of DUZ(2)
"RTN","LRVERA",34,0)
 ;
"RTN","LRVERA",35,0)
 ; Returns LR4 = ien of file #4 institution selected
"RTN","LRVERA",36,0)
 ;
"RTN","LRVERA",37,0)
 N DIC,DTOUT,DUOUT,X,Y
"RTN","LRVERA",38,0)
 S DIC="^DIC(4,",DIC(0)="AEMOQ"
"RTN","LRVERA",39,0)
 S DIC("A")="Select Performing Laboratory: "
"RTN","LRVERA",40,0)
 I $G(LR4)>0 S DIC("B")=$$GET1^DIQ(4,LR4_",",.01)
"RTN","LRVERA",41,0)
 S DIC("S")="I $$SCRNPL^LRVERA"
"RTN","LRVERA",42,0)
 D ^DIC
"RTN","LRVERA",43,0)
 I Y<1 S LR4=0
"RTN","LRVERA",44,0)
 E  S LR4=$P(Y,"^")
"RTN","LRVERA",45,0)
 ;
"RTN","LRVERA",46,0)
 Q LR4
"RTN","LRVERA",47,0)
 ;
"RTN","LRVERA",48,0)
 ;
"RTN","LRVERA",49,0)
SCRNPL() ; Screen performing laboratory
"RTN","LRVERA",50,0)
 ; Called by DIC("S") lookup above when selecting performing laboratory
"RTN","LRVERA",51,0)
 N OK,LRX
"RTN","LRVERA",52,0)
 S OK=0
"RTN","LRVERA",53,0)
 I Y=DUZ(2) S OK=1
"RTN","LRVERA",54,0)
 E  I $D(^LAHM(62.9,"CH",DUZ(2),Y)) S OK=1
"RTN","LRVERA",55,0)
 Q OK
"RTN","LRVERA",56,0)
 ;
"RTN","LRVERA",57,0)
 ;
"RTN","LRVERA",58,0)
PLOK(LRX,LRY,LRZ,LR60) ; Check if user is editing results that appear to have
"RTN","LRVERA",59,0)
 ; been performed by a lab different from the one they selected and.
"RTN","LRVERA",60,0)
 ; ask if changing performing lab is ok.
"RTN","LRVERA",61,0)
 ;
"RTN","LRVERA",62,0)
 ; Call with LRX = file #4 ien of performing lab on record
"RTN","LRVERA",63,0)
 ;           LRY = file #4 ien of performing lab user selected
"RTN","LRVERA",64,0)
 ;           LRZ = user's current division - DUZ(2)
"RTN","LRVERA",65,0)
 ;          LR60 = file #60 ien of test selected
"RTN","LRVERA",66,0)
 ;
"RTN","LRVERA",67,0)
 ; Returns 1=YES, 0=NO
"RTN","LRVERA",68,0)
 ;
"RTN","LRVERA",69,0)
 N DIR,DIRUT,DTOUT,DUOUT,OK,X,Y
"RTN","LRVERA",70,0)
 S OK=1
"RTN","LRVERA",71,0)
 I LRX D
"RTN","LRVERA",72,0)
 . I LRY,LRX=LRY Q
"RTN","LRVERA",73,0)
 . I LRX=LRZ Q
"RTN","LRVERA",74,0)
 . S DIR("A",1)="The performing lab recorded for test "_$$GET1^DIQ(60,LR60_",",.01)_" is: "_$$GET1^DIQ(4,LRX_",",.01)
"RTN","LRVERA",75,0)
 . S DIR("A",2)="You indicated the performing lab is: "_$$GET1^DIQ(4,$S(LRY:LRY,1:LRZ)_",",.01)
"RTN","LRVERA",76,0)
 . S DIR("A")="Do you want to continue",DIR("B")="NO"
"RTN","LRVERA",77,0)
 . S DIR(0)="YO",OK=0
"RTN","LRVERA",78,0)
 . W ! D ^DIR
"RTN","LRVERA",79,0)
 . I Y=1 S OK=1
"RTN","LRVERA",80,0)
 Q OK
"RTN","LRVERA",81,0)
 ;
"RTN","LRVERA",82,0)
 ;
"RTN","LRVERA",83,0)
RFLAG(FLAG) ; Ask user for referral high/low/critical flag in case they
"RTN","LRVERA",84,0)
 ; don't have values to calculate.
"RTN","LRVERA",85,0)
 ; Call with FLAG = current abnormal flag if any
"RTN","LRVERA",86,0)
 ;
"RTN","LRVERA",87,0)
 ; Returns NULL=no selection  0=Calculate from entered values
"RTN","LRVERA",88,0)
 ;            1=Abnormal Low  2=Critical Low
"RTN","LRVERA",89,0)
 ;            3=Abnormal High 4=Critical High
"RTN","LRVERA",90,0)
 ;
"RTN","LRVERA",91,0)
 N DIR,DIROUT,DIRUT,DTOUT,X,Y
"RTN","LRVERA",92,0)
 S DIR(0)="SOA^0:Calculate from entered values;1:Abnormal Low;2:Critical Low;3:Abnormal High;4:Critical High"
"RTN","LRVERA",93,0)
 S DIR("A")="Result's Abnormality: "
"RTN","LRVERA",94,0)
 S DIR("B")="Calculate from entered values"
"RTN","LRVERA",95,0)
 I $G(FLAG)'="" S DIR("B")=$S(FLAG="L":"Abnormal Low",FLAG="L*":"Critical Low",FLAG="H":"Abnormal High",FLAG="H*":"Critical High",1:DIR("B"))
"RTN","LRVERA",96,0)
 S DIR("?")="Select the abnormality if it cannot be calculated from reference values."
"RTN","LRVERA",97,0)
 D ^DIR
"RTN","LRVERA",98,0)
 I $D(DIRUT) S Y=""
"RTN","LRVERA",99,0)
 Q Y
"RTN","LRVERA",100,0)
 ;
"RTN","LRVERA",101,0)
 ;
"RTN","LRVERA",102,0)
DCOM ; From above and LRVR4 - display comments
"RTN","LRVERA",103,0)
 ;
"RTN","LRVERA",104,0)
 ; Quit if no current or previous comments
"RTN","LRVERA",105,0)
 I '$O(^LR(LRDFN,LRSS,LRIDT,1,0)),'$O(^LR(LRDFN,LRSS,+$G(LRLDT),1,0)) Q
"RTN","LRVERA",106,0)
 ;
"RTN","LRVERA",107,0)
 N DA
"RTN","LRVERA",108,0)
 ;
"RTN","LRVERA",109,0)
 ; Display previous comments.
"RTN","LRVERA",110,0)
 I $G(LRCMTDSP),$G(LRLDT)>0,$O(^LR(LRDFN,LRSS,LRLDT,1,0)) D
"RTN","LRVERA",111,0)
 . W !,"*** Comments for Previous Accession "_$P($G(Z2),"^",6)_" ***"
"RTN","LRVERA",112,0)
 . S DA=LRLDT D DSPCMT
"RTN","LRVERA",113,0)
 ;
"RTN","LRVERA",114,0)
 ; Display current comments
"RTN","LRVERA",115,0)
 I $O(^LR(LRDFN,LRSS,LRIDT,1,0)) D
"RTN","LRVERA",116,0)
 . I $G(LRCMTDSP),$G(LRLDT)>0,$O(^LR(LRDFN,LRSS,LRLDT,1,0)) D
"RTN","LRVERA",117,0)
 . . W !,"*** Comments for Current Accession "_$G(LRACC)_" ***"
"RTN","LRVERA",118,0)
 . . S LRLCT=LRLCT+1
"RTN","LRVERA",119,0)
 . S DA=LRIDT D DSPCMT
"RTN","LRVERA",120,0)
 Q
"RTN","LRVERA",121,0)
 ;
"RTN","LRVERA",122,0)
 ;
"RTN","LRVERA",123,0)
CMTDSP ; Determine if display of previous results should include associated comments.
"RTN","LRVERA",124,0)
 ;
"RTN","LRVERA",125,0)
 N ERR,I
"RTN","LRVERA",126,0)
 ;
"RTN","LRVERA",127,0)
 ; Get stored list of tests from parameter tool
"RTN","LRVERA",128,0)
 K ^TMP("LRXPAR",$J),^TMP("LR",$J,"DCMT")
"RTN","LRVERA",129,0)
 D GETLST^XPAR("^TMP(""LRXPAR"",$J)","USR","LR VER DISPLAY PREV COMMENT","Q",.ERR,1)
"RTN","LRVERA",130,0)
 I '$G(^TMP("LRXPAR",$J)) Q
"RTN","LRVERA",131,0)
 ; Create list based in file #60 ien - makes checking easier
"RTN","LRVERA",132,0)
 S I=0
"RTN","LRVERA",133,0)
 F  S I=$O(^TMP("LRXPAR",$J,I)) Q:'I  I $P(^(I),"^",2) S ^TMP("LR",$J,"DCMT",+^TMP("LRXPAR",$J,I))=""
"RTN","LRVERA",134,0)
 K ^TMP("LRXPAR",$J)
"RTN","LRVERA",135,0)
 Q
"RTN","LRVERA",136,0)
 ;
"RTN","LRVERA",137,0)
 ;
"RTN","LRVERA",138,0)
CHKCDSP() ; Check if previous comment should display when test on user's list 
"RTN","LRVERA",139,0)
 ; is present on test profile selected for this accession.
"RTN","LRVERA",140,0)
 ;
"RTN","LRVERA",141,0)
 N I,OK
"RTN","LRVERA",142,0)
 S OK=0
"RTN","LRVERA",143,0)
 I $G(LRLDT)>0,$D(^TMP("LR",$J,"DCMT")) D
"RTN","LRVERA",144,0)
 . S I=0
"RTN","LRVERA",145,0)
 . F  S I=$O(LRM(I)) Q:'I  D  Q:OK
"RTN","LRVERA",146,0)
 . . I $D(^TMP("LR",$J,"DCMT",+LRM(I))) S OK=1 Q
"RTN","LRVERA",147,0)
 . . I $G(LRM(I,"P")),$D(^TMP("LR",$J,"DCMT",+LRM(I,"P"))) S OK=1 Q
"RTN","LRVERA",148,0)
 Q OK
"RTN","LRVERA",149,0)
 ;
"RTN","LRVERA",150,0)
 ;
"RTN","LRVERA",151,0)
DSPCMT ; Display comments stored in file #63
"RTN","LRVERA",152,0)
 N DIR,DIRUT,DTOUT,DUOUT,I,X,Y
"RTN","LRVERA",153,0)
 S I=0
"RTN","LRVERA",154,0)
 F  S I=$O(^LR(LRDFN,LRSS,DA,1,I)) Q:'I  D  Q:$D(DIRUT)
"RTN","LRVERA",155,0)
 . S LRLCT=LRLCT+1
"RTN","LRVERA",156,0)
 . W !,"COMMENTS: ",$P(^LR(LRDFN,LRSS,DA,1,I,0),"^")
"RTN","LRVERA",157,0)
 . I LRLCT>21,$E(IOST,1,2)="C-" D  Q:$D(DIRUT)
"RTN","LRVERA",158,0)
 . . S DIR(0)="E" D ^DIR
"RTN","LRVERA",159,0)
 . . S LRLCT=0
"RTN","LRVERA",160,0)
 W ! S LRLCT=LRLCT+1
"RTN","LRVERA",161,0)
 Q
"RTN","LRVR")
0^20^B29572000
"RTN","LRVR",1,0)
LRVR ;DALOI/CJS/DALOI/FHS - LAB ROUTINE DATA VERIFICATION ;3/28/90  17:06
"RTN","LRVR",2,0)
 ;;5.2;LAB SERVICE;**42,153,263,286**;Sep 27, 1994
"RTN","LRVR",3,0)
 N LRDUZ,LRVBY
"RTN","LRVR",4,0)
 D INIT G QUIT:$G(LREND)
"RTN","LRVR",5,0)
 S LRVBY=$$SELBY^LRWU4("Verify by")
"RTN","LRVR",6,0)
 I LRVBY=0 D QUIT Q
"RTN","LRVR",7,0)
 I LRVBY=2 D ^LRVRA,QUIT Q
"RTN","LRVR",8,0)
DAT D ADATE^LRWU G:LRAD<1 QUIT
"RTN","LRVR",9,0)
 I $P(^LRO(68,LRAA,0),U,3)="D" F I=0:0 S I=$O(^LRO(68,LRAA,1,LRAD,1,I)) Q:I<1  I $D(^LRO(68,LRAA,1,LRAD,1,I,3)),'$P(^(3),U,4) S LRAN=I Q
"RTN","LRVR",10,0)
 S:$D(^LRO(68,LRAA,1,LRAD,2))&'LRAN LRAN=$P(^(2),U,4)
"RTN","LRVR",11,0)
 D
"RTN","LRVR",12,0)
 . N X
"RTN","LRVR",13,0)
 . S X=$S(+$P($G(^LAB(69.9,1,0)),U,7):+$P(^(0),U,7),1:1)
"RTN","LRVR",14,0)
 . S LRTM60=9999999-$$FMADD^XLFDT(DT,-X)
"RTN","LRVR",15,0)
L10 S LRCFL="",EAMODE=1
"RTN","LRVR",16,0)
 K LRTEST,C5,LRSET,LRLDT,DIC,LRNM,LRNG,LRDL,LRDEL,T,LRFP,LRAB,LRVER,Y,Z
"RTN","LRVR",17,0)
 D WLN G QUIT:LREND
"RTN","LRVR",18,0)
 D ^LRVR1,NEXT
"RTN","LRVR",19,0)
 G L10
"RTN","LRVR",20,0)
 ;
"RTN","LRVR",21,0)
 ;
"RTN","LRVR",22,0)
YN R X:DTIME Q:X=""!(X["N")!(X["Y")  W !,"Answer 'Y' or 'N': " G YN
"RTN","LRVR",23,0)
 ;
"RTN","LRVR",24,0)
WLN ;
"RTN","LRVR",25,0)
 S LRNOP=0
"RTN","LRVR",26,0)
 K DIR,DIRUT,DTOUT,DUOUT
"RTN","LRVR",27,0)
 S DIR(0)="NAO^1:999999:0"
"RTN","LRVR",28,0)
 S DIR("A")="Accession NUMBER: ",DIR("?")="^D LW^LRVR"
"RTN","LRVR",29,0)
 I LRAN'="" S DIR("B")=LRAN
"RTN","LRVR",30,0)
 D ^DIR K DIR
"RTN","LRVR",31,0)
 I $D(DIRUT) G STOP
"RTN","LRVR",32,0)
 S LRAN=Y
"RTN","LRVR",33,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0)) W !,"NOT ON FILE" S LRNOP=1
"RTN","LRVR",34,0)
 I '$G(LRNOP) D
"RTN","LRVR",35,0)
 . S LRDFN=+^LRO(68,LRAA,1,LRAD,1,LRAN,0),LRCEN=$S($D(^(.1)):^(.1),1:0),LRODT=$S($P(^(0),U,4):$P(^(0),U,4),1:$P(^(0),U,3)),LRSN=$P(^(0),U,5)
"RTN","LRVR",36,0)
 . S LRORU3=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3))
"RTN","LRVR",37,0)
 I '$G(LRNOP),$P(LRORU3,U)="" W !?10,"No UID number for this accession",! S LRNOP=1
"RTN","LRVR",38,0)
 I '$G(LRNOP) S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3) D PT^LRX W !,PNM,?30,SSN W:LRCEN !,"ORDER #: ",LRCEN
"RTN","LRVR",39,0)
 S LRCDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U)
"RTN","LRVR",40,0)
 I '$G(LRNOP),'$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),"^",3) D
"RTN","LRVR",41,0)
 . N %DT,LRA1,LRA2,LRA3
"RTN","LRVR",42,0)
 . S %DT("B")=$$FMTE^XLFDT(LRCDT,"1")
"RTN","LRVR",43,0)
 . S LRSTATUS="C",LRA1=LRAA,LRA2=LRAD,LRA3=LRAN
"RTN","LRVR",44,0)
 . D P15^LROE1
"RTN","LRVR",45,0)
 . S LRAA=LRA1,LRAD=LRA2,LRAN=LRA3
"RTN","LRVR",46,0)
 . I LRCDT<1 S LRNOP=1 Q
"RTN","LRVR",47,0)
 . I '$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,3) S $P(^(3),U,3)=$$NOW^XLFDT
"RTN","LRVR",48,0)
 ; If user did not update then go to next accession
"RTN","LRVR",49,0)
 I '$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,3) S LRNOP=1
"RTN","LRVR",50,0)
 S LRCDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U)
"RTN","LRVR",51,0)
 I $G(LRCDT)<1 S (LRCDT,LRNOP)=1
"RTN","LRVR",52,0)
 ;
"RTN","LRVR",53,0)
 S LRSS=$P(^LRO(68,LRAA,0),U,2)
"RTN","LRVR",54,0)
 I '$G(LRNOP),LRSS'="CH" S LRNOP=1
"RTN","LRVR",55,0)
 ; Check for valid pointer to file #63 and entry in file #63.
"RTN","LRVR",56,0)
 S LRIDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5)
"RTN","LRVR",57,0)
 I '$G(LRNOP),LRIDT<1 W !,">>>>ERROR - NO POINTER TO FILE #63 - PLEASE NOTIFY SYSTEM MANAGER^ <<<<<",! S LRNOP=1
"RTN","LRVR",58,0)
 I '$G(LRNOP),'$D(^LR(LRDFN,LRSS,LRIDT,0)) W !,">>>>ERROR - NO ENTRY IN FILE #63 - PLEASE NOTIFY SYSTEM MANAGER<<^ <<<",! S LRNOP=1
"RTN","LRVR",59,0)
 ;
"RTN","LRVR",60,0)
 I '$G(LRNOP),$D(^LRO(69,LRODT,1,LRSN)),'$D(^(LRSN,1)) W !,"This Order # has not been collected",$C(7) S LRNOP=1
"RTN","LRVR",61,0)
 I '$G(LRNOP),$D(^LRO(69,LRODT,1,LRSN,1)),$P(^LRO(69,LRODT,1,LRSN,1),U,4)'="C" W !,"You cannot verify an accession which has not been collected.",$C(7) S LRNOP=1
"RTN","LRVR",62,0)
 I $G(LRNOP) D NEXT G WLN
"RTN","LRVR",63,0)
 Q
"RTN","LRVR",64,0)
 ;
"RTN","LRVR",65,0)
 ;
"RTN","LRVR",66,0)
LW ;
"RTN","LRVR",67,0)
 N S
"RTN","LRVR",68,0)
 W !,"Enter range of accession numbers which might apply."
"RTN","LRVR",69,0)
 D LRAN^LRWU3 Q:LREND
"RTN","LRVR",70,0)
 S LRDT=$$FMTE^XLFDT($$DT^XLFDT,"5F")
"RTN","LRVR",71,0)
 S S("LRAA")=LRAA,S("LRAD")=LRAD,S("LRAN")=LRAN
"RTN","LRVR",72,0)
 D W^LRWRKLST
"RTN","LRVR",73,0)
 S LREND=0,LRAA=S("LRAA"),LRAD=S("LRAD"),LRAN=S("LRAN")
"RTN","LRVR",74,0)
 Q
"RTN","LRVR",75,0)
 ;
"RTN","LRVR",76,0)
 ;
"RTN","LRVR",77,0)
QUIT I $G(LRAN),$G(LRAA),$G(LRAD) S LREND=1 I $D(^LRO(68,LRAA,1,LRAD,0)) S:'$D(^(2)) ^(2)="^^" S ^(2)=$P(^(2),U,1,3)_U_LRAN_U_$P(^(2),U,5,99),LREND=1
"RTN","LRVR",78,0)
 ;
"RTN","LRVR",79,0)
CLEAN ;
"RTN","LRVR",80,0)
 I $D(LRCSQ),'$O(^XTMP("LRCAP",LRCSQ,DUZ,0)) K ^XTMP("LRCAP",LRCSQ,DUZ)
"RTN","LRVR",81,0)
 E  I $D(LRAA) D:$P(LRPARAM,U,14)&($P($G(^LRO(68,+LRAA,0)),U,16)) STD^LRCAPV K LRIDIV
"RTN","LRVR",82,0)
 K DIR,LRCMTDSP,LRNOP,XP
"RTN","LRVR",83,0)
 D ^LRVRKIL
"RTN","LRVR",84,0)
 S ZTIO="",ZTRTN="LRCAPV2",ZTDTH=$H,ZTDESC="LAB LRCAPV2 ROUTINE"
"RTN","LRVR",85,0)
 D ^%ZTLOAD K ZTSK
"RTN","LRVR",86,0)
 Q
"RTN","LRVR",87,0)
 ;
"RTN","LRVR",88,0)
 ;
"RTN","LRVR",89,0)
NEXT S LRAN=$O(^LRO(68,LRAA,1,LRAD,1,LRAN)) I LRAN'>0 W !,"LAST IN WORK LIST" S LRAN="^"
"RTN","LRVR",90,0)
 S LREND=0
"RTN","LRVR",91,0)
 Q
"RTN","LRVR",92,0)
 ;
"RTN","LRVR",93,0)
 ;
"RTN","LRVR",94,0)
LIST W " the following tests: " F I=0:0 S I=$O(LRTST(I)) Q:I<1  W !,?10,$P(LRTST(I),"^",1)
"RTN","LRVR",95,0)
 Q
"RTN","LRVR",96,0)
 ;
"RTN","LRVR",97,0)
 ;
"RTN","LRVR",98,0)
EXPAND D EXPLODE^LRGP2
"RTN","LRVR",99,0)
SKPEX Q:$O(LRVTS(0))  ; READY TO GO
"RTN","LRVR",100,0)
STOP S LREND=1
"RTN","LRVR",101,0)
 Q
"RTN","LRVR",102,0)
 ;
"RTN","LRVR",103,0)
 ;
"RTN","LRVR",104,0)
INIT ;from LRVRW
"RTN","LRVR",105,0)
 N DIC,LRX
"RTN","LRVR",106,0)
 D ^LRPARAM Q:$G(LREND)  S LREND=0,LRAN=0 K LRORD,LRDUZ
"RTN","LRVR",107,0)
 S DIC="^LRO(68.2,",DIC(0)="AEMZ",DIC("S")="S LRX=$P(^(0),U,12) Q:'$L(LRX)  I $D(^XUSEC($P($G(^DIC(19.1,LRX,0)),U),DUZ))"
"RTN","LRVR",108,0)
 D ^DIC K DIC("S") G STOP:Y<1 S LRLL=+Y,LRTYPE=$P(Y(0),U,3)
"RTN","LRVR",109,0)
 S LRPROF=$O(^LRO(68.2,LRLL,10,0))
"RTN","LRVR",110,0)
 I LRPROF<1 S LREND=1 W !,"No profile defined." Q
"RTN","LRVR",111,0)
 S B=$O(^LRO(68.2,LRLL,10,LRPROF))
"RTN","LRVR",112,0)
 I B>0 S DIC="^LRO(68.2,"_LRLL_",10," D ^DIC G STOP:Y<1 S LRPROF=+Y
"RTN","LRVR",113,0)
 S X=^LRO(68.2,LRLL,10,LRPROF,0),LRAA=$P(X,U,2),LRPANEL=$P(X,U) I '$D(^LRO(68,LRAA,0))#2 W !?10,$C(7),"Error in your DATABASE. There is not an accession area # ",LRAA,!! Q
"RTN","LRVR",114,0)
 ;
"RTN","LRVR",115,0)
 ; Select performing laboratory to use
"RTN","LRVR",116,0)
 S LRX=$$SELPL^LRVERA($S($P(X,"^",5):$P(X,"^",5),1:DUZ(2)))
"RTN","LRVR",117,0)
 I LRX<1 S LREND=1 Q
"RTN","LRVR",118,0)
 I LRX,LRX'=DUZ(2) S LRDUZ(2)=LRX
"RTN","LRVR",119,0)
 ;
"RTN","LRVR",120,0)
 D:$P(LRPARAM,U,14)&($P($G(^LRO(68,LRAA,0)),U,16)) AUTO^LRCAPV Q:LREND
"RTN","LRVR",121,0)
 I $P(^LRO(68,LRAA,0),U,2)="MI" D ^LRMIEDZ S LREND=1 Q
"RTN","LRVR",122,0)
 G STOP:$P(^LRO(68,LRAA,0),U,2)'="CH"
"RTN","LRVR",123,0)
 S LREND=0 D EXPAND G STOP:LREND!($O(LRVTS(0))<0)
"RTN","LRVR",124,0)
 F I=0:0 S I=$O(LRORD(I)) Q:I<1  S J=LRORD(I),X=$P(^LAB(60,J,0),U,5),LRORD(I)=$P(X,";",2)
"RTN","LRVR",125,0)
 S Y=^LRO(68,LRAA,0),LRTSE=-1
"RTN","LRVR",126,0)
 ;
"RTN","LRVR",127,0)
 D CMTDSP^LRVERA
"RTN","LRVR",128,0)
 ;
"RTN","LRVR",129,0)
REV ;
"RTN","LRVR",130,0)
 K LRPER
"RTN","LRVR",131,0)
 D REV^LRVER
"RTN","LRVR",132,0)
 Q
"RTN","LRVR1")
0^21^B35974824
"RTN","LRVR1",1,0)
LRVR1 ;DALOI/CJS/FHS-LAB ROUTINE DATA VERIFICATION ;3/28/90  17:14
"RTN","LRVR1",2,0)
 ;;5.2;LAB SERVICE;**42,153,221,286**;Sep 27, 1994
"RTN","LRVR1",3,0)
 N LRI,LRN
"RTN","LRVR1",4,0)
 S (LRI,LRN)=0
"RTN","LRVR1",5,0)
 F  S LRI=$O(^LAH(LRLL,1,"C",LRAN,LRI)) Q:LRI<1  D
"RTN","LRVR1",6,0)
 . N LRX
"RTN","LRVR1",7,0)
 . S LRX=$G(^LAH(LRLL,1,LRI,0))
"RTN","LRVR1",8,0)
 . ; Quit if different accession area.
"RTN","LRVR1",9,0)
 . I $P(LRX,"^",3),$P(LRX,"^",3)'=LRAA Q
"RTN","LRVR1",10,0)
 . ; Quit if different accession date and not a rollover accession (same original accession date).
"RTN","LRVR1",11,0)
 . I $P(LRX,"^",4),$P(LRX,"^",4)'=LRAD,$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,0)),"^",3)'=$P($G(^LRO(68,LRAA,1,$P(LRX,"^",4),1,LRAN,0)),"^",3) Q
"RTN","LRVR1",12,0)
 . I LRN W !
"RTN","LRVR1",13,0)
 . S LRN=LRN+1,LRSQ=LRI
"RTN","LRVR1",14,0)
 . W !,?2,"Seq #: ",LRI,?13," Accession: ",$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.2)),"^")
"RTN","LRVR1",15,0)
 . I $P(LRX,"^",10) W ?40," Results received: ",$$FMTE^XLFDT($P(LRX,"^",10),"1M")
"RTN","LRVR1",16,0)
 . W !,?20,"UID: ",$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3),"UNKNOWN"),"^")
"RTN","LRVR1",17,0)
 . I $P(LRX,"^",11) W ?44," Last updated: ",$$FMTE^XLFDT($P(LRX,"^",11),"1M")
"RTN","LRVR1",18,0)
 G VER:LRN=1,T3:LRN>1
"RTN","LRVR1",19,0)
 ;
"RTN","LRVR1",20,0)
 ; If attempting to verify reference lab results and no entry in LAH
"RTN","LRVR1",21,0)
 ; associated with this accession then quit - do not allow manual entry
"RTN","LRVR1",22,0)
 ; of ref lab results via this option. Will not store units/normals.
"RTN","LRVR1",23,0)
 I $G(LRDUZ(2)),DUZ(2)'=LRDUZ(2) W !,"No data there" Q
"RTN","LRVR1",24,0)
 ;
"RTN","LRVR1",25,0)
T1 R !,"What tray: ",X:DTIME Q:X["^"!'$T  I X["?"!(X'?.N) W !,"Enter a number" G T1
"RTN","LRVR1",26,0)
 I X'="" S LRTRAY=X G T2
"RTN","LRVR1",27,0)
 I $D(^LRO(68.2,"AS",LRLL)) W !,"Can't MANUALLY add to a SEQUENCE instrument data file." G QUIT
"RTN","LRVR1",28,0)
 W !,"Enter manually" S %=1 D YN^DICN G QUIT:%<1,T1:%=2 S LRSQ=-1 G VER
"RTN","LRVR1",29,0)
 G VER
"RTN","LRVR1",30,0)
T2 R !,"What cup: ",X:DTIME Q:X["^"!'$T  I X["?"!(X'?.N) W !,"Enter a number" G T2
"RTN","LRVR1",31,0)
 Q:X=""  S LRTRCP=LRTRAY_";"_X
"RTN","LRVR1",32,0)
 K LRPRGSQ
"RTN","LRVR1",33,0)
 S LRN=0 F LRI=0:0 S LRI=$O(^LAH(LRLL,1,"B",LRTRCP,LRI)) Q:LRI<1  S LRN=LRN+1,LRSQ=LRI,LRPRGSQ(LRI)="" W !,?5,LRI
"RTN","LRVR1",34,0)
T3 I LRN=0 W !,"No data for that tray & cup" Q
"RTN","LRVR1",35,0)
 I LRN>1 R !,"Choose sequence number: ",X:DTIME Q:'$T  I X["?"!(X'?.N) W !,"Enter a number" G T3
"RTN","LRVR1",36,0)
 I X["^"!(X="") K LRPRGSQ Q
"RTN","LRVR1",37,0)
 S:LRN'=1 LRSQ=X I '$D(^LAH(LRLL,1,LRSQ,0)) W !,"No data there" G T3
"RTN","LRVR1",38,0)
 ;
"RTN","LRVR1",39,0)
VER ; from LRFLAG, LRGP, LRVRW
"RTN","LRVR1",40,0)
 N LRROOT
"RTN","LRVR1",41,0)
 K LRTEST,LRNM,^TMP("LR",$J,"TMP")
"RTN","LRVR1",42,0)
 S LRUID=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3)),"^")
"RTN","LRVR1",43,0)
 ;
"RTN","LRVR1",44,0)
 ; Determine if there are amended results to process via "EM"
"RTN","LRVR1",45,0)
 S LRROOT=$Q(^LAH("LA7 AMENDED RESULTS",LRUID,1,LRLL))
"RTN","LRVR1",46,0)
 I LRROOT'="",$QS(LRROOT,1)="LA7 AMENDED RESULTS",$QS(LRROOT,2)=LRUID,$QS(LRROOT,4)=LRLL D  Q
"RTN","LRVR1",47,0)
 . W !!,"Amended results exist for this accession. Please process these"
"RTN","LRVR1",48,0)
 . W !,"first using option Enter/verify/modify data (manual) [LRENTER]"
"RTN","LRVR1",49,0)
 ;
"RTN","LRVR1",50,0)
 D TEST
"RTN","LRVR1",51,0)
 I $O(^TMP("LR",$J,"TMP",0))="" W !,"No tests in editing profile" Q
"RTN","LRVR1",52,0)
 S X=DUZ D DUZ^LRX
"RTN","LRVR1",53,0)
 G V2:LRSQ>0
"RTN","LRVR1",54,0)
 L +^LAH(LRLL)
"RTN","LRVR1",55,0)
 S (^LAH(LRLL),LRSQ)=1+$G(^LAH(LRLL))
"RTN","LRVR1",56,0)
 S ^LAH(LRLL,1,LRSQ,0)="^^"_LRAA_"^"_LRAD_"^"_LRAN_"^^MANUAL"
"RTN","LRVR1",57,0)
 D UID^LAGEN(LRLL,LRSQ,LRUID)
"RTN","LRVR1",58,0)
 D UPDT^LAGEN(LRLL,LRSQ)
"RTN","LRVR1",59,0)
 S ^LAH(LRLL,1,"C",LRAN,LRSQ)=""
"RTN","LRVR1",60,0)
 L -^LAH(LRLL)
"RTN","LRVR1",61,0)
V2 K LRPRGSQ(LRSQ)
"RTN","LRVR1",62,0)
 S LRLLOC=0,LROUTINE=$P(^LAB(69.9,1,3),U,2)
"RTN","LRVR1",63,0)
 I $D(^LRO(69,LRODT,1,LRSN,0)) S LRLLOC=$P(^(0),U,7) S:'$L(LRLLOC) LRLLOC=0 W !,$P(^LRO(69,LRODT,1,LRSN,1),U,6)
"RTN","LRVR1",64,0)
 S LRCDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U)
"RTN","LRVR1",65,0)
 I '$P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),"^",3) D
"RTN","LRVR1",66,0)
 . N %DT,LRA1,LRA2,LRA3
"RTN","LRVR1",67,0)
 . S %DT("B")=$$FMTE^XLFDT(LRCDT,"1")
"RTN","LRVR1",68,0)
 . S LRSTATUS="C",LRA1=LRAA,LRA2=LRAD,LRA3=LRAN
"RTN","LRVR1",69,0)
 . D P15^LROE1
"RTN","LRVR1",70,0)
 . S LRAA=LRA1,LRAD=LRA2,LRAN=LRA3
"RTN","LRVR1",71,0)
 . I LRCDT<1 Q
"RTN","LRVR1",72,0)
 . I '$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,3) S $P(^(3),U,3)=$$NOW^XLFDT
"RTN","LRVR1",73,0)
 ; If user did not update then go to next
"RTN","LRVR1",74,0)
 I '$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,3) Q
"RTN","LRVR1",75,0)
 S LRCDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U)
"RTN","LRVR1",76,0)
 I LRCDT<1 Q
"RTN","LRVR1",77,0)
 S LREAL=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,2),LRALERT=LROUTINE
"RTN","LRVR1",78,0)
 S I=0
"RTN","LRVR1",79,0)
 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<.5  I $G(^(I,0)) S LRAL=$P($G(^(0)),U,2) D
"RTN","LRVR1",80,0)
 . I $G(LRAL) S LRALERT=$S(LRAL<50&(LRAL<LRALERT):LRAL,LRAL>50&(LRAL-50<LRALERT):LRAL-50,1:LRALERT)
"RTN","LRVR1",81,0)
 S LRSAMP=$P($G(^LRO(69,LRODT,1,LRSN,0)),U,3)
"RTN","LRVR1",82,0)
 ;
"RTN","LRVR1",83,0)
 S LRSS=$P(^LRO(68,LRAA,0),U,2)
"RTN","LRVR1",84,0)
 I LRSS'="CH" Q
"RTN","LRVR1",85,0)
 ; Check for valid pointer to file #63 and entry in file #63.
"RTN","LRVR1",86,0)
 S LRIDT=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),U,5)
"RTN","LRVR1",87,0)
 I LRIDT<1 W !,">>>>ERROR - NO POINTER TO FILE #63 - PLEASE NOTIFY SYSTEM MANAGER^ <<<<<",! Q
"RTN","LRVR1",88,0)
 I '$D(^LR(LRDFN,LRSS,LRIDT,0)) W !,">>>>ERROR - NO ENTRY IN FILE #63 - PLEASE NOTIFY SYSTEM MANAGER<<^ <<<",! Q
"RTN","LRVR1",89,0)
 ;
"RTN","LRVR1",90,0)
 S LRCW=8
"RTN","LRVR1",91,0)
LD S LRSS="CH"
"RTN","LRVR1",92,0)
 I '$D(^LAH(LRLL,1,LRSQ,0))#2 W !!?5,"No Data for this Accession ",!! K ^LAH(LRLL,1,LRSQ),^LAH(LRLL,1,"C",LRAN,LRSQ) K LRPRGSQ Q
"RTN","LRVR1",93,0)
 ;
"RTN","LRVR1",94,0)
 ; Store any new methods with existing methods on file.
"RTN","LRVR1",95,0)
 S LRMETH=$P(^LAH(LRLL,1,LRSQ,0),U,7) S:$D(LRGVP) LRMETH=LRMETH_"(GV)"
"RTN","LRVR1",96,0)
 I $P($G(^LR(LRDFN,LRSS,LRIDT,0)),U,8)'="" D
"RTN","LRVR1",97,0)
 . N I,X
"RTN","LRVR1",98,0)
 . S X=$P(^LR(LRDFN,LRSS,LRIDT,0),U,8)
"RTN","LRVR1",99,0)
 . F I=1:1:$L(X,";") I $P(X,";",I)'="",LRMETH'[$P(X,";",I) S LRMETH=LRMETH_";"_$P(X,";",I)
"RTN","LRVR1",100,0)
 I LRMETH'="" S $P(^LR(LRDFN,LRSS,LRIDT,0),U,8)=LRMETH
"RTN","LRVR1",101,0)
 ;
"RTN","LRVR1",102,0)
 W:$D(^LAB(62,+LRSAMP,0)) !,"Sample: ",$P(^(0),U)
"RTN","LRVR1",103,0)
 ;
"RTN","LRVR1",104,0)
 D ^LRVR2
"RTN","LRVR1",105,0)
 K LRDL,LRPRGSQ
"RTN","LRVR1",106,0)
 Q  ; leave LRVR1, back to LRVR
"RTN","LRVR1",107,0)
 ;
"RTN","LRVR1",108,0)
 ;
"RTN","LRVR1",109,0)
TEST ; from LRGV1
"RTN","LRVR1",110,0)
 N LRI,LRX
"RTN","LRVR1",111,0)
 S LRI=0
"RTN","LRVR1",112,0)
 F  S LRI=$O(^TMP("LR",$J,"VTO",LRI)) Q:LRI<1  K ^(LRI,"P")
"RTN","LRVR1",113,0)
 S (LRI,LRNT)=0
"RTN","LRVR1",114,0)
 F  S LRI=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRI)) Q:LRI<.5  I $D(^(LRI,0)),'$L($P(^(0),U,6)) S X=^(0) I $D(^TMP("LR",$J,"VTO",+X)) D
"RTN","LRVR1",115,0)
 . S LRNT=LRNT+1,LRTEST(LRNT)=+X,LRX=$S($P(X,"^",2)>50:$P(X,"^",9),1:$P(X,"^"))
"RTN","LRVR1",116,0)
 . S LRTEST(LRNT,"P")=LRX_U_$$NLT^LRVER1(LRX)_"!"
"RTN","LRVR1",117,0)
 . S ^TMP("LR",$J,"VTO",+X,"P")=$P(LRTEST(LRNT,"P"),"!")
"RTN","LRVR1",118,0)
 ;
"RTN","LRVR1",119,0)
TEST1 ; from LRFLAG
"RTN","LRVR1",120,0)
 ;
"RTN","LRVR1",121,0)
 N LRI
"RTN","LRVR1",122,0)
 F LRI=1:1:LRNT S:$D(^LAB(60,+LRTEST(LRI),0)) LRTEST(LRI)=LRTEST(LRI)_U_^(0)
"RTN","LRVR1",123,0)
 I $G(LRORDR)'="P" K ^TMP("LR",$J,"TMP")
"RTN","LRVR1",124,0)
 S LRNX=0
"RTN","LRVR1",125,0)
 K LRM
"RTN","LRVR1",126,0)
 F I=1:1 Q:'$D(LRTEST(I))  D
"RTN","LRVR1",127,0)
 . S X=LRTEST(I),XP=$G(LRTEST(I,"P"))
"RTN","LRVR1",128,0)
 . K LRTEST(I)
"RTN","LRVR1",129,0)
 . D EX2
"RTN","LRVR1",130,0)
 K LRTEST
"RTN","LRVR1",131,0)
 Q
"RTN","LRVR1",132,0)
 ;
"RTN","LRVR1",133,0)
 ;
"RTN","LRVR1",134,0)
EX2 ;
"RTN","LRVR1",135,0)
 ; If dataname then process and quit
"RTN","LRVR1",136,0)
 S LRSUB=$P(X,U,6)
"RTN","LRVR1",137,0)
 I LRSUB'="" D  Q
"RTN","LRVR1",138,0)
 . S LRSB=$P(LRSUB,";",2)
"RTN","LRVR1",139,0)
 . Q:'$D(LRVTS(LRSB))
"RTN","LRVR1",140,0)
 . I $D(^TMP("LR",$J,"TMP",LRSB)) S ^(LRSB,"P")=XP
"RTN","LRVR1",141,0)
 . Q:$D(^TMP("LR",$J,"TMP",LRSB))
"RTN","LRVR1",142,0)
 . S ^TMP("LR",$J,"TMP",LRSB)=+X
"RTN","LRVR1",143,0)
 . S XP=XP_$$RNLT^LRVER1(+X)
"RTN","LRVR1",144,0)
 . S ^TMP("LR",$J,"TMP",LRSB,"P")=XP
"RTN","LRVR1",145,0)
 . S:$P(X,U,18) LRM(LRSB)=+X,LRM(LRSB,"P")=XP
"RTN","LRVR1",146,0)
 ;
"RTN","LRVR1",147,0)
 I $D(^LAB(60,+X,4)),$P(^(4),"^",2) S LRCFL=LRCFL_$P(^(4),"^",2)_U
"RTN","LRVR1",148,0)
 ;
"RTN","LRVR1",149,0)
 ; If panel then explode components of panel and
"RTN","LRVR1",150,0)
 ;  set parent("P" node) to file #60 test being exploded
"RTN","LRVR1",151,0)
 S J=0
"RTN","LRVR1",152,0)
 F  S J=$O(^LAB(60,+X,2,J)) Q:J<1  I $D(^(J,0))#2 D
"RTN","LRVR1",153,0)
 . S LRNT=LRNT+1,Y=^LAB(60,+X,2,J,0)
"RTN","LRVR1",154,0)
 . S LRTEST(LRNT)=+Y_U_^LAB(60,+Y,0)
"RTN","LRVR1",155,0)
 . S LRTEST(LRNT,"P")=+XP_U_$$NLT^LRVER1(+XP)_"!"
"RTN","LRVR1",156,0)
 Q
"RTN","LRVR1",157,0)
 ;
"RTN","LRVR1",158,0)
 ;
"RTN","LRVR1",159,0)
QUIT Q
"RTN","LRVR1",160,0)
 ;
"RTN","LRVR1",161,0)
WAIT W !,"Type ""^"" to skip "
"RTN","LRVR1",162,0)
WAIT1 R X:10 G LRVR1:X[U,WAIT1:$O(^LAH(LRLL,1,"C",LRAN,0))<1 G LRVR1
"RTN","LRVR3")
0^22^B36944972
"RTN","LRVR3",1,0)
LRVR3 ;DALOI/CJS - LAB ROUTINE DATA VERIFICATION ;8/11/97
"RTN","LRVR3",2,0)
 ;;5.2;LAB SERVICE;**42,121,153,286**;Sep 27, 1994
"RTN","LRVR3",3,0)
 D V1
"RTN","LRVR3",4,0)
 I $D(LRLOCKER)#2 L -@(LRLOCKER) K LRLOCKER
"RTN","LRVR3",5,0)
 K LRSA,LRSB,LRNOVER,LRSBCOM,LRLKOK
"RTN","LRVR3",6,0)
 Q  ;Leave LRVR3, back to LRVR2
"RTN","LRVR3",7,0)
 ;
"RTN","LRVR3",8,0)
 ;
"RTN","LRVR3",9,0)
V1 S LRTN=1
"RTN","LRVR3",10,0)
 I $D(LRLOCKER)#2 L -@(LRLOCKER)
"RTN","LRVR3",11,0)
 S LRLOCKER="^LR("_LRDFN_","""_LRSS_""","_LRIDT_")"
"RTN","LRVR3",12,0)
 L +@(LRLOCKER):1
"RTN","LRVR3",13,0)
 I '$T W !," This entry is being edited by someone else." Q
"RTN","LRVR3",14,0)
 ;LRNOVER set in LRVR2
"RTN","LRVR3",15,0)
 K LRLKOK D LINK Q:'$D(LRLKOK)  K LRLKOK D LKCHK Q:'$D(LRLKOK)
"RTN","LRVR3",16,0)
 K LRSA,LRSB,LRSBCOM
"RTN","LRVR3",17,0)
 ;
"RTN","LRVR3",18,0)
 S LRCMTDSP=$$CHKCDSP^LRVERA
"RTN","LRVR3",19,0)
 N LRX
"RTN","LRVR3",20,0)
 S LRX=1
"RTN","LRVR3",21,0)
 F  S LRX=$O(^LAH(LRLL,1,LRSQ,LRX)) Q:LRX<1  D
"RTN","LRVR3",22,0)
 . S LRSB(LRX)=^LAH(LRLL,1,LRSQ,LRX)
"RTN","LRVR3",23,0)
 . I $D(LRNOVER),$D(LRVTS(LRX)),$D(^TMP("LR",$J,"TMP",LRX)) S LRNOVER(LRX)=""
"RTN","LRVR3",24,0)
 ; Copy comments from LAH
"RTN","LRVR3",25,0)
 S LRX=0
"RTN","LRVR3",26,0)
 F  S LRX=$O(^LAH(LRLL,1,LRSQ,1,LRX)) Q:LRX=""  S LRSBCOM(LRX)=^(LRX)
"RTN","LRVR3",27,0)
 ;
"RTN","LRVR3",28,0)
EDIT I $D(^LAH(LRLL,1,LRSQ,0)) D
"RTN","LRVR3",29,0)
 . N X
"RTN","LRVR3",30,0)
 . S LREDIT=1
"RTN","LRVR3",31,0)
 . F LRX=0,.1,.3 M X(LRX)=^LAH(LRLL,1,LRSQ,LRX)
"RTN","LRVR3",32,0)
 . K ^LAH(LRLL,1,LRSQ),LRNUF
"RTN","LRVR3",33,0)
 . F LRX=0,.1,.3 M ^LAH(LRLL,1,LRSQ,LRX)=X(LRX) K X(LRX)
"RTN","LRVR3",34,0)
 . D ^LRVR4
"RTN","LRVR3",35,0)
 . F LRX=1:0 S LRX=$O(LRSB(LRX)) Q:LRX<1  S ^LAH(LRLL,1,LRSQ,LRX)=LRSB(LRX)
"RTN","LRVR3",36,0)
 I $O(^LAH(LRLL,1,LRSQ,1))<1 W !,"NO DATA TO APPROVE" Q
"RTN","LRVR3",37,0)
 Q:$D(LRGVP)
"RTN","LRVR3",38,0)
 F I=0:0 S I=$O(LRNOVER(I)) Q:I=""  W !,$P(^DD(63.04,I,0),U)
"RTN","LRVR3",39,0)
 I $O(LRNOVER(0)) W !,"Have not been reviewed and have data.  Not approved." QUIT
"RTN","LRVR3",40,0)
 I '$P($G(LRLABKY),U) W !,$C(7),"ENTERED BUT NOT APPROVED" QUIT
"RTN","LRVR3",41,0)
 N CNT S CNT=1
"RTN","LRVR3",42,0)
AGAIN ;
"RTN","LRVR3",43,0)
 R !,"Approve for release by entering your initials: ",LRINI:DTIME
"RTN","LRVR3",44,0)
 I $E(LRINI)="^" W !!?5,$C(7),"Nothing verified!" D READ Q
"RTN","LRVR3",45,0)
 I LRINI'=LRUSI,$$UP^XLFSTR(LRINI)=$$UP^XLFSTR(LRUSI) S LRINI=LRUSI
"RTN","LRVR3",46,0)
 I $S($E(LRINI)="?":1,LRINI'=LRUSI&(CNT<2):1,1:0) W !,$C(7),"Please enter your correct initials" S:$E(LRINI)="?" CNT=0 S CNT=CNT+1 G AGAIN
"RTN","LRVR3",47,0)
 I LRINI'=LRUSI W !!?5,$C(7),"Nothing verified!" D READ Q
"RTN","LRVR3",48,0)
 ;
"RTN","LRVR3",49,0)
V11 ;Still locked from V1 L ^LR(LRDFN,LRSS,LRIDT)
"RTN","LRVR3",50,0)
 N LRCORECT S LRCORECT=0
"RTN","LRVR3",51,0)
 N LRX
"RTN","LRVR3",52,0)
 S LRX=0
"RTN","LRVR3",53,0)
 F  S LRX=$O(^TMP("LR",$J,"TMP",LRX)) Q:LRX<1  I $D(LRVTS(LRX)),$D(LRSB(LRX)),$D(^(LRX)) D
"RTN","LRVR3",54,0)
 . K ^LAH(LRLL,1,LRSQ,LRX)
"RTN","LRVR3",55,0)
 . I LRSB(LRX)'="" S ^LR(LRDFN,LRSS,LRIDT,LRX)=LRSB(LRX) S:'$D(^LRO(68,"AC",LRDFN,LRIDT,LRX)) ^(LRX)="" I LRVF S ^(LRX)=""
"RTN","LRVR3",56,0)
 ;
"RTN","LRVR3",57,0)
 I $P($G(LRORU3),U,3),$O(LRSB(0)) D LRORU3^LRVER3
"RTN","LRVR3",58,0)
 ;
"RTN","LRVR3",59,0)
A3 D VER^LRVER3A ;unlocked in LRVER
"RTN","LRVR3",60,0)
 K LRSBCOM
"RTN","LRVR3",61,0)
 D:$P(LRPARAM,U,14)&($P($G(^LRO(68,LRAA,0)),U,16)) LOOK^LRCAPV1
"RTN","LRVR3",62,0)
 ; Check for LEDI tests not reviewed
"RTN","LRVR3",63,0)
 I $G(LRDUZ(2)),LRDUZ(2)'=DUZ(2),LRSS="CH",'$D(ZTQUEUED) D TNR
"RTN","LRVR3",64,0)
 ;
"RTN","LRVR3",65,0)
 I +$O(^LAH(LRLL,1,LRSQ,1))<1 D ZAPALL(LRLL,LRSQ)
"RTN","LRVR3",66,0)
 I $D(LRPRGSQ),'$D(ZTQUEUED) D
"RTN","LRVR3",67,0)
 . W !,"Purge data from sequence number(s): "
"RTN","LRVR3",68,0)
 . F I=0:0 S I=$O(LRPRGSQ(I)) Q:I<1  W " ",I
"RTN","LRVR3",69,0)
 . S %=1 D YN^DICN Q:%'=1
"RTN","LRVR3",70,0)
 . N LAIEN
"RTN","LRVR3",71,0)
 . S LAIEN=0
"RTN","LRVR3",72,0)
 . F  S LAIEN=$O(LRPRGSQ(LAIEN)) Q:LAIEN<1  D ZAPALL(LRLL,LAIEN)
"RTN","LRVR3",73,0)
 Q
"RTN","LRVR3",74,0)
 ;
"RTN","LRVR3",75,0)
 ;
"RTN","LRVR3",76,0)
ZAP ; from LRLLS3
"RTN","LRVR3",77,0)
 D ZAPALL(LRLL,I)
"RTN","LRVR3",78,0)
 Q
"RTN","LRVR3",79,0)
 ;
"RTN","LRVR3",80,0)
 ;
"RTN","LRVR3",81,0)
LINK ; Check and save link
"RTN","LRVR3",82,0)
 D LKCHK Q:$D(LRLKOK)  S X=$S($D(^LRO(68,+$P(LRLK,U,3),1,+$P(LRLK,U,4),1,+$P(LRLK,U,5),0)):+^(0),1:"") G LINKOK:+X=LRDFN
"RTN","LRVR3",83,0)
 S S1=PNM,S2=SSN,S3=LRDPF W !,$C(7),"WARNING - NO MATCHING ACCESSION WAS FOUND.",!,"You may need to Clear instrument/worklist data,",!,"or correctly identify the sample to the system."
"RTN","LRVR3",84,0)
 I X S LRDPF=$P(^LR(X,0),U,2),DFN=$P(^(0),U,3) D PT^LRX W !,PNM,?30,SSN,!,$C(7) S PNM=S1,SSN=S2,LRDPF=S3
"RTN","LRVR3",85,0)
 K S1,S2,S3 Q:$D(LRGVP)  W !,"ARE YOU SURE THIS IS THE CORRECT DATA" S %=2 D YN^DICN Q:%'=1
"RTN","LRVR3",86,0)
LINKOK K:$P(LRLK,U,5) ^LAH(LRLL,1,"C",+$P(LRLK,U,5),LRSQ)
"RTN","LRVR3",87,0)
 S ^LAH(LRLL,1,"C",LRAN,LRSQ)="",$P(^LAH(LRLL,1,LRSQ,0),U,3,5)=LRAA_U_LRAD_U_LRAN,LRLKOK=1
"RTN","LRVR3",88,0)
 Q
"RTN","LRVR3",89,0)
 ;
"RTN","LRVR3",90,0)
LKCHK S LRLK=$S($D(^LAH(LRLL,1,LRSQ,0)):^(0),1:"") I $P(LRLK,U,3)=LRAA&($P(LRLK,U,4)=LRAD)&($P(LRLK,U,5)=LRAN) S LRLKOK=1
"RTN","LRVR3",91,0)
 Q
"RTN","LRVR3",92,0)
 ;
"RTN","LRVR3",93,0)
 ;
"RTN","LRVR3",94,0)
ZAP2 ;Clear ^LAH(
"RTN","LRVR3",95,0)
 D ZAPALL(LRLL,I)
"RTN","LRVR3",96,0)
 Q
"RTN","LRVR3",97,0)
 ;
"RTN","LRVR3",98,0)
 ;
"RTN","LRVR3",99,0)
ZAPALL(LRLL,LAIEN) ;Clean up
"RTN","LRVR3",100,0)
 N I,NODE,SEG,SUB
"RTN","LRVR3",101,0)
 Q:'$G(LRLL)!('$G(LAIEN))
"RTN","LRVR3",102,0)
 ;
"RTN","LRVR3",103,0)
 S NODE=$G(^LAH(LRLL,1,LAIEN,0))
"RTN","LRVR3",104,0)
 K ^LAH(LRLL,1,"B",+$P(NODE,U)_";"_+$P(NODE,U,2),LAIEN)
"RTN","LRVR3",105,0)
 K ^LAH(LRLL,1,"C",+$P(NODE,U,5),LAIEN)
"RTN","LRVR3",106,0)
 K ^LAH(LRLL,1,"D",+$P(NODE,U,6),LAIEN)
"RTN","LRVR3",107,0)
 K ^LAH(LRLL,1,"E",+$P(NODE,U,8),LAIEN)
"RTN","LRVR3",108,0)
 ;
"RTN","LRVR3",109,0)
 S NODE("U")=$P($G(^LAH(LRLL,1,LAIEN,.3)),U)
"RTN","LRVR3",110,0)
 I NODE("U")'="" D
"RTN","LRVR3",111,0)
 . K ^LAH(LRLL,1,"U",NODE("U"),LAIEN)
"RTN","LRVR3",112,0)
 . S I=0
"RTN","LRVR3",113,0)
 . F  S I=$O(^LAH("LA7 AMENDED RESULTS",NODE("U"),I)) Q:'I  D
"RTN","LRVR3",114,0)
 . . K ^LAH("LA7 AMENDED RESULTS",NODE("U"),I,LRLL,LAIEN)
"RTN","LRVR3",115,0)
 ;
"RTN","LRVR3",116,0)
 S SEG=""
"RTN","LRVR3",117,0)
 F  S SEG=$O(^LAH(LRLL,1,LAIEN,.1,SEG)) Q:SEG=""  D
"RTN","LRVR3",118,0)
 . S SEGID=""
"RTN","LRVR3",119,0)
 . F  S SEGID=$O(^LAH(LRLL,1,LAIEN,.1,SEG,SEGID)) Q:SEGID=""  D
"RTN","LRVR3",120,0)
 . . S SUB=$P($G(^LAH(LRLL,1,LAIEN,.1,SEG,SEGID)),U)
"RTN","LRVR3",121,0)
 . . I SUB'="" K ^LAH(LRLL,1,"A"_SEGID,SUB,LAIEN)
"RTN","LRVR3",122,0)
 ;
"RTN","LRVR3",123,0)
 K ^LAH(LRLL,1,LAIEN)
"RTN","LRVR3",124,0)
 ;
"RTN","LRVR3",125,0)
 ; Reset counter if loadlist is clear.
"RTN","LRVR3",126,0)
 I '$O(^LAH(LRLL,1,0)) D
"RTN","LRVR3",127,0)
 . L +^LAH(LRLL):1 Q:'$T
"RTN","LRVR3",128,0)
 . S ^LAH(LRLL)=0
"RTN","LRVR3",129,0)
 . L -^LAH(LRLL)
"RTN","LRVR3",130,0)
 ;
"RTN","LRVR3",131,0)
 Q
"RTN","LRVR3",132,0)
 ;
"RTN","LRVR3",133,0)
 ;
"RTN","LRVR3",134,0)
TNR ; List tests not reviewed and ask if user wants to delete.
"RTN","LRVR3",135,0)
 ;
"RTN","LRVR3",136,0)
 N DIR,DIROUT,DIRUT,DUOUT,LR60,I,X,Y
"RTN","LRVR3",137,0)
 ;
"RTN","LRVR3",138,0)
 ; Check if these results have already been verified
"RTN","LRVR3",139,0)
 S I=1
"RTN","LRVR3",140,0)
 F  S I=$O(^LAH(LRLL,1,LRSQ,I)) Q:'I  D
"RTN","LRVR3",141,0)
 . S X=^LAH(LRLL,1,LRSQ,I)
"RTN","LRVR3",142,0)
 . I $P(X,"^")=$P($G(^LR(LRDFN,LRSS,LRIDT,I)),"^") K ^LAH(LRLL,1,LRSQ,I)
"RTN","LRVR3",143,0)
 ;
"RTN","LRVR3",144,0)
 ; Quit if no unreviewed results
"RTN","LRVR3",145,0)
 I +$O(^LAH(LRLL,1,LRSQ,1))'>1 Q
"RTN","LRVR3",146,0)
 ;
"RTN","LRVR3",147,0)
 W !,"Test(s) Not Reviewed:",!
"RTN","LRVR3",148,0)
 S I=1
"RTN","LRVR3",149,0)
 F  S I=$O(^LAH(LRLL,1,LRSQ,I)) Q:'I  D
"RTN","LRVR3",150,0)
 . S X=^LAH(LRLL,1,LRSQ,I)
"RTN","LRVR3",151,0)
 . S LR60=+$O(^LAB(60,"C","CH;"_I_";1",0))
"RTN","LRVR3",152,0)
 . I LR60 W $$GET1^DIQ(60,LR60_",",.01)
"RTN","LRVR3",153,0)
 . E  W $$GET1^DID(63.04,I,"","LABEL")
"RTN","LRVR3",154,0)
 . W " = "_$P(X,"^")_" "_$P(X,"^",2)_"  "_$P($P(X,"^",5),"!",7),!
"RTN","LRVR3",155,0)
 ;
"RTN","LRVR3",156,0)
 S DIR(0)="Y",DIR("A")="Purge these test results",DIR("B")="NO"
"RTN","LRVR3",157,0)
 S DIR("?",1)="Answer 'NO' if you want to keep these results for later verification."
"RTN","LRVR3",158,0)
 S DIR("?",2)="You may need to add these tests to the loadlist profile your using"
"RTN","LRVR3",159,0)
 S DIR("?")="and/or add these tests to the accession your verifying."
"RTN","LRVR3",160,0)
 D ^DIR Q:$D(DIRUT)
"RTN","LRVR3",161,0)
 ;
"RTN","LRVR3",162,0)
 I Y=1 D ZAPALL(LRLL,LRSQ)
"RTN","LRVR3",163,0)
 Q
"RTN","LRVR3",164,0)
 ;
"RTN","LRVR3",165,0)
 ;
"RTN","LRVR3",166,0)
READ ;
"RTN","LRVR3",167,0)
 N X W !!,"Press ENTER or RETURN to continue: " R X:DTIME
"RTN","LRVR3",168,0)
 Q
"RTN","LRVR4")
0^23^B49098381
"RTN","LRVR4",1,0)
LRVR4 ;DALOI/CJS/DALOI/FHS - LAB ROUTINE DATA VERIFICATION ;8/11/97
"RTN","LRVR4",2,0)
 ;;5.2;LAB SERVICE;**14,42,121,153,221,263,279,283,287,286**;Sep 27, 1994
"RTN","LRVR4",3,0)
 I $D(LRSBCOM) D
"RTN","LRVR4",4,0)
 . N LRX
"RTN","LRVR4",5,0)
 . S LRX=0
"RTN","LRVR4",6,0)
 . F  S LRX=$O(LRSBCOM(LRX)) Q:LRX=""  S ^LAH(LRLL,1,LRSQ,1,LRX)=LRSBCOM(LRX)
"RTN","LRVR4",7,0)
 K %,LRSBCOM
"RTN","LRVR4",8,0)
 D LOOP
"RTN","LRVR4",9,0)
 Q
"RTN","LRVR4",10,0)
 ;
"RTN","LRVR4",11,0)
 ;
"RTN","LRVR4",12,0)
LOOP ;
"RTN","LRVR4",13,0)
 S LRLCT=0
"RTN","LRVR4",14,0)
 W !!,PNM,"   SSN: ",SSN,"   "
"RTN","LRVR4",15,0)
 I LRDPF=2 W "   LOC: ",$S(LRWRD'="":LRWRD,1:$S($L($P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,7)):$P(^(0),U,7),1:"??"))
"RTN","LRVR4",16,0)
 W !,"Pat Info: ",$P($G(^LR(LRDFN,.091)),U)
"RTN","LRVR4",17,0)
 W ?34," Sex: ",$S(SEX="M":"MALE",SEX="F":"FEMALE",1:SEX)
"RTN","LRVR4",18,0)
 W ?48," Age: ",$$CALCAGE^LRRPU(DOB,LRCDT)," as of ",$$FMTE^XLFDT(LRCDT,"1D")
"RTN","LRVR4",19,0)
 S LRPRAC=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,8)
"RTN","LRVR4",20,0)
 I LRPRAC>0,LRPRAC=+LRPRAC D GETS^DIQ(200,LRPRAC_",",".01;.132;.137;.138","E","LRPRAC(LRPRAC)","LRERR")
"RTN","LRVR4",21,0)
 W !,"Provider: "
"RTN","LRVR4",22,0)
 S LRLCT=LRLCT+3
"RTN","LRVR4",23,0)
 I LRPRAC'="",'$D(LRPRAC(LRPRAC,200)) W LRPRAC
"RTN","LRVR4",24,0)
 I LRPRAC,$D(LRPRAC(LRPRAC,200)) D
"RTN","LRVR4",25,0)
 . W LRPRAC(LRPRAC,200,LRPRAC_",",.01,"E"),?40," Voice pager: ",LRPRAC(LRPRAC,200,LRPRAC_",",.137,"E")
"RTN","LRVR4",26,0)
 . W !,"   Phone: ",LRPRAC(LRPRAC,200,LRPRAC_",",.132,"E"),?38," Digital pager: ",LRPRAC(LRPRAC,200,LRPRAC_",",.138,"E")
"RTN","LRVR4",27,0)
 . S LRLCT=LRLCT+1
"RTN","LRVR4",28,0)
 ;
"RTN","LRVR4",29,0)
 N PRAC,PR
"RTN","LRVR4",30,0)
 D PRAC^LR7OMERG(LRAA,LRAD,LRAN,.PRAC)
"RTN","LRVR4",31,0)
 I $O(PRAC(0)) D
"RTN","LRVR4",32,0)
 . S PR=0
"RTN","LRVR4",33,0)
 . F  S PR=$O(PRAC(PR)) Q:PR<1  I $D(^VA(200,PR,0)) W !?14,$P(^(0),"^") S LRLCT=LRLCT+1
"RTN","LRVR4",34,0)
 ;
"RTN","LRVR4",35,0)
 W ! S LRNX=0,LRVRM=1,Z=LRCDT,LRLCT=LRLCT+1
"RTN","LRVR4",36,0)
 I $P(Z1,U,7)'="" W !,"VOLUME: ",$P(Z1,U,7) S LRLCT=LRLCT+1
"RTN","LRVR4",37,0)
 S LRACC=$P(Z1,U,6)
"RTN","LRVR4",38,0)
 W !,"ACCESSION:",?30,$P(Z2,U,6),?44," ",LRACC
"RTN","LRVR4",39,0)
 W !,LRPANEL,?30,LRDAT(2),?44," ",LRDAT
"RTN","LRVR4",40,0)
 S LRLCT=LRLCT+2
"RTN","LRVR4",41,0)
 I $D(LRALERT),LRALERT<($P(LRPARAM,U,20)+1) D
"RTN","LRVR4",42,0)
 . W !?15 W:$E(IOST,1,2)="C-" @LRVIDO
"RTN","LRVR4",43,0)
 . W "Test ordered "_$P($G(^LAB(62.05,+LRALERT,0)),U)
"RTN","LRVR4",44,0)
 . W:$E(IOST,1,2)="C-" @LRVIDOF,$C(7)
"RTN","LRVR4",45,0)
 . S LRLCT=LRLCT+1
"RTN","LRVR4",46,0)
 I $D(LRGVP) D V20 Q
"RTN","LRVR4",47,0)
 I ($O(LRSB(0))<1!$D(LRPER))&'$D(LRNUF) D LRSBCOM G EDIT
"RTN","LRVR4",48,0)
 K LRNUF
"RTN","LRVR4",49,0)
 D V20:'$D(LRPER) Q:$O(LRSB(1))<1  G:LREDIT EDIT
"RTN","LRVR4",50,0)
V36 ;
"RTN","LRVR4",51,0)
 S LRTEC=$S($D(^LRO(68,LRAA,1,LRAD,2)):$P(^(2),U),1:$S($D(LRUSI):LRUSI,1:"")),LREDIT=0
"RTN","LRVR4",52,0)
 ;
"RTN","LRVR4",53,0)
V3 ;
"RTN","LRVR4",54,0)
 D LRSBCOM,DCOM^LRVERA
"RTN","LRVR4",55,0)
 ;
"RTN","LRVR4",56,0)
 ; If entering reference lab results only allow editing comments/workload
"RTN","LRVR4",57,0)
 K DIR
"RTN","LRVR4",58,0)
 S LRLCT=0
"RTN","LRVR4",59,0)
 I $G(LRDUZ(2)),DUZ(2)'=LRDUZ(2) D
"RTN","LRVR4",60,0)
 . S DIR(0)="SAO^C:Comments;W:Workload"
"RTN","LRVR4",61,0)
 . S DIR("A")="SELECT ('C' for Comments, 'W' Workload): "
"RTN","LRVR4",62,0)
 E  D
"RTN","LRVR4",63,0)
 . S DIR(0)="SAO^E:Edit;C:Comments;W:Workload"
"RTN","LRVR4",64,0)
 . S DIR("A")="SELECT ('E' to Edit, 'C' for Comments, 'W' Workload): "
"RTN","LRVR4",65,0)
 D ^DIR
"RTN","LRVR4",66,0)
 I $D(DIRUT) S X="^" G V37
"RTN","LRVR4",67,0)
 S X=Y
"RTN","LRVR4",68,0)
 S:$E(X)="E" LREDIT=1,X=""
"RTN","LRVR4",69,0)
 I X="C" D COM G LOOP
"RTN","LRVR4",70,0)
 ;
"RTN","LRVR4",71,0)
 I $E(X)="W" D  G LOOP
"RTN","LRVR4",72,0)
 . I $P(LRPARAM,U,14),$P($G(^LRO(68,LRAA,0)),U,16) D STD^LRCAPV,EN^LRCAPV S LREND=0 Q
"RTN","LRVR4",73,0)
 . W !?10,"Workload is not activated. "
"RTN","LRVR4",74,0)
 ;
"RTN","LRVR4",75,0)
 S X=$S(X="@":"",X="":LRTEC,1:X),LRTEC=X
"RTN","LRVR4",76,0)
 S:'$D(^LRO(68,LRAA,1,LRAD,2)) ^(2)="" S ^(2)=X_U_$P(^(2),U,2,99)
"RTN","LRVR4",77,0)
 G EDIT:LREDIT
"RTN","LRVR4",78,0)
V37 Q  ;LEAVE LRVR4, BACK TO LRVR3
"RTN","LRVR4",79,0)
 ;
"RTN","LRVR4",80,0)
 ;
"RTN","LRVR4",81,0)
V25 ;
"RTN","LRVR4",82,0)
 I LRVF K LRSB(LRSB),LRM(LRSB) Q
"RTN","LRVR4",83,0)
 I '$D(LRSB(LRSB)) S LRSB(LRSB)=^LR(LRDFN,LRSS,LRIDT,LRSB) Q
"RTN","LRVR4",84,0)
 Q
"RTN","LRVR4",85,0)
 ;
"RTN","LRVR4",86,0)
 ;
"RTN","LRVR4",87,0)
V20 S LRNX=$O(LRORD(LRNX)) G V35:LRNX<1 D SUBS G V20:'LRTS
"RTN","LRVR4",88,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,LRSB)),^(LRSB)'["pending" D V25 G:LRVF V20
"RTN","LRVR4",89,0)
 I "CH"'=LRSS G V20
"RTN","LRVR4",90,0)
 D V25^LRVR5
"RTN","LRVR4",91,0)
 W !,$P(^LAB(60,+LRTS,0),U)
"RTN","LRVR4",92,0)
 S X1=""
"RTN","LRVR4",93,0)
 I $D(^LR(LRDFN,LRSS,LRLDT,LRSB)) D
"RTN","LRVR4",94,0)
 . S X1=$P(^(LRSB),U),(LRDL,X)=X1
"RTN","LRVR4",95,0)
 . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRVR4",96,0)
 . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",X1)
"RTN","LRVR4",97,0)
 . . I X="" S X=X1
"RTN","LRVR4",98,0)
 . W:X'="" ?30,@LRFP
"RTN","LRVR4",99,0)
 S X="",LRFLG=""
"RTN","LRVR4",100,0)
 I $D(LRSB(LRSB)),$P(LRSB(LRSB),U)'="" D
"RTN","LRVR4",101,0)
 . N LRX
"RTN","LRVR4",102,0)
 . K LRNOVER(LRSB)
"RTN","LRVR4",103,0)
 . S (LRDL,LRX,X)=$P(LRSB(LRSB),U)
"RTN","LRVR4",104,0)
 . I $$GET1^DID(63.04,LRSB,"","TYPE","","LRERR")="SET" D
"RTN","LRVR4",105,0)
 . . S X=$$EXTERNAL^DILFD(63.04,LRSB,"",LRX)
"RTN","LRVR4",106,0)
 . . I X="" S X=LRX
"RTN","LRVR4",107,0)
 . W ?44," ",@LRFP," "
"RTN","LRVR4",108,0)
 . S X=LRX
"RTN","LRVR4",109,0)
 . I X=""!(X="canc")!(X="comment")!(X="pending") Q
"RTN","LRVR4",110,0)
 . K LRQ
"RTN","LRVR4",111,0)
 . S Y=0 I LRDEL'="" S LRQ=1,LRVRM=11 X LRDEL S LRVRM=1 K LRQ
"RTN","LRVR4",112,0)
 . D RANGE
"RTN","LRVR4",113,0)
 . W LRFLG,?56," ",$P(LRNG,U,7) S:X'="" LREDIT=0
"RTN","LRVR4",114,0)
 I '$D(LRNUF) S LRLCT=LRLCT+1 S:$X>80 LRLCT=LRLCT+1 D:LRLCT>22 WT G:$G(Y)'="^" V20
"RTN","LRVR4",115,0)
 ;
"RTN","LRVR4",116,0)
V35 ;
"RTN","LRVR4",117,0)
 D LRCFL:LRCFL]""
"RTN","LRVR4",118,0)
 K LRNUF
"RTN","LRVR4",119,0)
 Q
"RTN","LRVR4",120,0)
 ;
"RTN","LRVR4",121,0)
 ;
"RTN","LRVR4",122,0)
LRCFL ;
"RTN","LRVR4",123,0)
 S LREXEC=LRCFL D ^LREXEC:LRCFL[""
"RTN","LRVR4",124,0)
 D:LRLCT>22 WT
"RTN","LRVR4",125,0)
 Q
"RTN","LRVR4",126,0)
 ;
"RTN","LRVR4",127,0)
 ;
"RTN","LRVR4",128,0)
EDIT ;
"RTN","LRVR4",129,0)
 S LROUT=1 D ^LRVR5
"RTN","LRVR4",130,0)
 S LRVRM=1,LREDIT=0
"RTN","LRVR4",131,0)
 G LRCFL:LROUT!$D(LRPER),LOOP
"RTN","LRVR4",132,0)
 ;
"RTN","LRVR4",133,0)
 ;
"RTN","LRVR4",134,0)
RANGE ;
"RTN","LRVR4",135,0)
 ; If results from another system, use flags returned with results
"RTN","LRVR4",136,0)
 ; and set LRNG,LRNGS with normals from message.
"RTN","LRVR4",137,0)
 ; Check for LRDUZ(2) set for performing lab or performing lab set (piece 9) in LRSB(LRSB) array.
"RTN","LRVR4",138,0)
 I $G(LRDUZ(2)),DUZ(2)'=LRDUZ(2) S Y=X D PLNR,CKPLNR,RQ Q
"RTN","LRVR4",139,0)
 I $P(LRSB(LRSB),"^",9),DUZ(2)'=$P(LRSB(LRSB),"^",9) S Y=X D PLNR,CKPLNR,RQ Q
"RTN","LRVR4",140,0)
 ;
"RTN","LRVR4",141,0)
 D RANGE^LRVER4,RQ
"RTN","LRVR4",142,0)
 Q
"RTN","LRVR4",143,0)
 ;
"RTN","LRVR4",144,0)
 ;
"RTN","LRVR4",145,0)
RQ S X=Y
"RTN","LRVR4",146,0)
NR I $D(LRSB(LRSB))#2 D
"RTN","LRVR4",147,0)
 . N I,LRX,LRY
"RTN","LRVR4",148,0)
 . I $P(X,U)="" S LRSB(LRSB)="" Q
"RTN","LRVR4",149,0)
 . S $P(LRSB(LRSB),U)=X
"RTN","LRVR4",150,0)
 . S $P(LRSB(LRSB),U,2)=LRFLG
"RTN","LRVR4",151,0)
 . S $P(LRSB(LRSB),U,4)=$S($G(LRDUZ):LRDUZ,1:$G(DUZ))
"RTN","LRVR4",152,0)
 . I $P(LRSB(LRSB),U,9)="" S $P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),$G(DUZ(2)):DUZ(2),1:"")
"RTN","LRVR4",153,0)
 . S LRX=$$TMPSB^LRVER1(LRSB),LRY=$P(LRSB(LRSB),U,3)
"RTN","LRVR4",154,0)
 . F I=1:1:$L(LRX,"!") I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,"!",I)
"RTN","LRVR4",155,0)
 . S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRVR4",156,0)
 . I $P($P(LRSB(LRSB),U,3),"!")="" D RONLT^LRVER3
"RTN","LRVR4",157,0)
 . S LRX=LRNGS,LRY=$P(LRSB(LRSB),U,5)
"RTN","LRVR4",158,0)
 . F I=1:1:$L(LRX,U) I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,U,I)
"RTN","LRVR4",159,0)
 . S $P(LRSB(LRSB),U,5)=LRY
"RTN","LRVR4",160,0)
 Q
"RTN","LRVR4",161,0)
 ;
"RTN","LRVR4",162,0)
 ;
"RTN","LRVR4",163,0)
PLNR ; Performing lab normal ranges, use instead of current local ranges
"RTN","LRVR4",164,0)
 ; Retrieve from results when "NPC" node = 2 or greater
"RTN","LRVR4",165,0)
 ; and set LRNG and LRNGS with normals from HL7 message/interface.
"RTN","LRVR4",166,0)
 N I,LRY
"RTN","LRVR4",167,0)
 I +$G(^LR(LRDFN,LRSS,LRIDT,"NPC"))<2 Q
"RTN","LRVR4",168,0)
 S LRY=$P($G(LRSB(LRSB)),"^",5)
"RTN","LRVR4",169,0)
 S $P(LRNGS,"^")=$P(LRY,"!")
"RTN","LRVR4",170,0)
 F I=2:1:5,11,12 S $P(LRNGS,"^",I)=$P(LRY,"!",I),$P(LRNG,"^",I)=$P(LRY,"!",I),@("LRNG"_I)=$P(LRY,"!",I)
"RTN","LRVR4",171,0)
 S $P(LRNG,"^",7)=$P(LRY,"!",7),$P(LRNGS,"^",7)=$P(LRY,"!",7)
"RTN","LRVR4",172,0)
 Q
"RTN","LRVR4",173,0)
 ;
"RTN","LRVR4",174,0)
 ;
"RTN","LRVR4",175,0)
CKPLNR ; Check performing lab normal ranges and set abnormal flag
"RTN","LRVR4",176,0)
 ; based on HL7 messages/interface.
"RTN","LRVR4",177,0)
 S LRFLG=$P(LRSB(LRSB),"^",2)
"RTN","LRVR4",178,0)
 I '$D(LRQ),$E(LRFLG,2)="*" D DISPFLG^LRVER4
"RTN","LRVR4",179,0)
 Q
"RTN","LRVR4",180,0)
 ;
"RTN","LRVR4",181,0)
 ;
"RTN","LRVR4",182,0)
SUBS D SUBS^LRVER4
"RTN","LRVR4",183,0)
 Q
"RTN","LRVR4",184,0)
 ;
"RTN","LRVR4",185,0)
 ;
"RTN","LRVR4",186,0)
WT D WT^LRVER4
"RTN","LRVR4",187,0)
 Q
"RTN","LRVR4",188,0)
 ;
"RTN","LRVR4",189,0)
 ;
"RTN","LRVR4",190,0)
COM ;from LRVR5
"RTN","LRVR4",191,0)
 Q:$D(LRGVP)!('$D(LRLABKY))
"RTN","LRVR4",192,0)
 D DCOM^LRVERA
"RTN","LRVR4",193,0)
 K DR,DA,DIE
"RTN","LRVR4",194,0)
 S DIE="^LR("_LRDFN_",""CH"",",DA=LRIDT,DA(1)=LRDFN,DR=.99 D ^DIE
"RTN","LRVR4",195,0)
 Q
"RTN","LRVR4",196,0)
 ;
"RTN","LRVR4",197,0)
 ;
"RTN","LRVR4",198,0)
LRSBCOM ;Display/store comments from the instrument
"RTN","LRVR4",199,0)
 N LRSBCOM,LRI
"RTN","LRVR4",200,0)
 S LRI=0
"RTN","LRVR4",201,0)
 F  S LRI=$O(^LAH(LRLL,1,LRSQ,1,LRI)) Q:LRI=""  D
"RTN","LRVR4",202,0)
 . S LRSBCOM=^LAH(LRLL,1,LRSQ,1,LRI)
"RTN","LRVR4",203,0)
 . I $P(LRSBCOM,"^",2) Q  ; Already been processed
"RTN","LRVR4",204,0)
 . D LRSBCOM1
"RTN","LRVR4",205,0)
 . S $P(^LAH(LRLL,1,LRSQ,1,LRI),U,2)=1 ; Mark as processed
"RTN","LRVR4",206,0)
 I $G(LRQUIET) Q
"RTN","LRVR4",207,0)
 W !
"RTN","LRVR4",208,0)
 S LRLCT=$G(LRLCT)+1 D:LRLCT>22 WT
"RTN","LRVR4",209,0)
 Q
"RTN","LRVR4",210,0)
 ;
"RTN","LRVR4",211,0)
 ;
"RTN","LRVR4",212,0)
LRSBCOM1 ; Store instrument comments in file #63
"RTN","LRVR4",213,0)
 ; Check for duplicate comments in ^LAH and ^LR globals
"RTN","LRVR4",214,0)
 N LRDUP,LRERR,LRI,LRNOECHO,LRNOEXPD,LRX,LRY
"RTN","LRVR4",215,0)
 ;
"RTN","LRVR4",216,0)
 ; Don't echo comments/don't expand comment using lab description file.
"RTN","LRVR4",217,0)
 ; Used by LRNUM - called from input transform of #.01 field.
"RTN","LRVR4",218,0)
 S LRNOECHO=0,LRNOEXPD=1
"RTN","LRVR4",219,0)
 ;
"RTN","LRVR4",220,0)
 ; Check for duplicates - comment stripped if spaces, force to upper case unless
"RTN","LRVR4",221,0)
 ; flag set to store duplicates (Field #2.2 of PROFILE multiple in file #68.2)
"RTN","LRVR4",222,0)
 S LRDUP=0
"RTN","LRVR4",223,0)
 I '$P($G(^LRO(68.2,LRLL,10,+$G(LRPROF),0)),U,4) D
"RTN","LRVR4",224,0)
 . S LRI=0,LRY=$TR(LRSBCOM," ",""),LRY=$$UP^XLFSTR(LRY)
"RTN","LRVR4",225,0)
 . F  S LRI=$O(^LR(LRDFN,"CH",LRIDT,1,LRI)) Q:'LRI  D  Q:LRDUP
"RTN","LRVR4",226,0)
 . . S LRX=$P($G(^LR(LRDFN,"CH",LRIDT,1,LRI,0)),U)
"RTN","LRVR4",227,0)
 . . S LRX=$TR(LRX," ",""),LRX=$$UP^XLFSTR(LRX)
"RTN","LRVR4",228,0)
 . . I LRX=LRY S LRDUP=1
"RTN","LRVR4",229,0)
 I LRDUP=1 Q  ; Duplicate comment
"RTN","LRVR4",230,0)
 D FILECOM(LRDFN,LRIDT,LRSBCOM)
"RTN","LRVR4",231,0)
 I $G(LRQUIET) Q
"RTN","LRVR4",232,0)
 W !,"Inst Comments: "_LRSBCOM
"RTN","LRVR4",233,0)
 S LRLCT=$G(LRLCT)+1 D:LRLCT>10 WT
"RTN","LRVR4",234,0)
 Q
"RTN","LRVR4",235,0)
 ;
"RTN","LRVR4",236,0)
 ;
"RTN","LRVR4",237,0)
FILECOM(LRDFN,LRIDT,LRCMT) ; File comment in field #99
"RTN","LRVR4",238,0)
 ; Call with LRDFN = ien of patient in file #63
"RTN","LRVR4",239,0)
 ;           LRIDT = ien of specimen date/time
"RTN","LRVR4",240,0)
 ;           LRCMT = comment to store
"RTN","LRVR4",241,0)
 ;
"RTN","LRVR4",242,0)
 N LRFDA,LRERR
"RTN","LRVR4",243,0)
 S LRFDA(2,63.041,"+2,"_LRIDT_","_LRDFN_",",.01)=LRCMT
"RTN","LRVR4",244,0)
 D UPDATE^DIE("","LRFDA(2)","","LRERR(2)")
"RTN","LRVR4",245,0)
 Q
"RTN","LRVR5")
0^24^B12201851
"RTN","LRVR5",1,0)
LRVR5 ;DALOI/CJS/DALOI/FHS - LAB ROUTINE DATA VERIFICATION ;4/20/89  18:02
"RTN","LRVR5",2,0)
 ;;5.2;LAB SERVICE;**1,42,153,263,283,286**;Sep 27, 1994
"RTN","LRVR5",3,0)
 ;
"RTN","LRVR5",4,0)
 S LRNX=0,LRVRM=11
"RTN","LRVR5",5,0)
V40 ;
"RTN","LRVR5",6,0)
 S LRNX=$O(LRORD(LRNX))
"RTN","LRVR5",7,0)
 G V44:LRNX<1 D SUBS G V40:'LRTS,V40:'$D(LRVTS(LRSB))
"RTN","LRVR5",8,0)
 ;
"RTN","LRVR5",9,0)
 ; Only allow verifying reference lab results which exist in LAH, no
"RTN","LRVR5",10,0)
 ; entering results "on the fly" - use EM options (^LRVER)
"RTN","LRVR5",11,0)
 I $G(LRDUZ(2)),LRDUZ(2)'=DUZ(2),'$D(^LAH(LRLL,1,LRSQ,LRSB)) K LRSB(LRSB) G V40
"RTN","LRVR5",12,0)
 ;
"RTN","LRVR5",13,0)
 I $D(^LR(LRDFN,LRSS,LRIDT,LRSB)),^(LRSB)'["pending" D V25^LRVR4 G:LRVF V40
"RTN","LRVR5",14,0)
V42 D V25
"RTN","LRVR5",15,0)
 S X=$S($D(LRSB(LRSB)):$P(LRSB(LRSB),U),1:""),LREDIT=0
"RTN","LRVR5",16,0)
 I X="",LRDV'="" S $P(LRSB(LRSB),"^")=LRDV,X=LRDV
"RTN","LRVR5",17,0)
 S LRTEST=$P(^LAB(60,+LRTS,0),U),LROUT=0 K LRNOVER(LRSB)
"RTN","LRVR5",18,0)
Q42 W !,LRTEST," " W:X'="" @LRFP R "//",X:DTIME I X'?.ANP W $C(7)," No Control Characters Allowed." G V42
"RTN","LRVR5",19,0)
 I X=""&$D(LRSB(LRSB)) S X=$P(LRSB(LRSB),U)
"RTN","LRVR5",20,0)
Q43 S LRDL=X G V40:X="",V45:X'["^",V44:X="^",OUT:X="^^"
"RTN","LRVR5",21,0)
V43 S X=$P(X,U,2),DIC="^LAB(60,",DIC(0)="EOQZ" D ^DIC G:Y<1 Q42
"RTN","LRVR5",22,0)
 S LRPLOC=$P(Y(0),U,5),LRSSQ=$P(LRPLOC,";",1),LRSB=$P(LRPLOC,";",2),LRTS=+Y
"RTN","LRVR5",23,0)
 I LRSSQ="" W !,"Not in this group" G OUT
"RTN","LRVR5",24,0)
 I LRSS'=LRSSQ!'$D(^TMP("LR",$J,"TMP",LRSB)) W !,"Not in this group" G OUT
"RTN","LRVR5",25,0)
 F LRNX=0:0 S LRNX=$O(LRORD(LRNX)) Q:LRNX<1  G V42:LRSB=LRORD(LRNX)
"RTN","LRVR5",26,0)
V44 D COM^LRVR4
"RTN","LRVR5",27,0)
 S LRNUF=1
"RTN","LRVR5",28,0)
 Q
"RTN","LRVR5",29,0)
 ;
"RTN","LRVR5",30,0)
 ;
"RTN","LRVR5",31,0)
V45 ;
"RTN","LRVR5",32,0)
 K LRSKIP
"RTN","LRVR5",33,0)
 S LRDL=X
"RTN","LRVR5",34,0)
 I X="@" D  G V46
"RTN","LRVR5",35,0)
 . S X=$S($D(LRM(LRSB)):"pending",1:"")
"RTN","LRVR5",36,0)
 . S $P(LRSB(LRSB),"^")=X,$P(LRSB(LRSB),"^",2)=""
"RTN","LRVR5",37,0)
 ;
"RTN","LRVR5",38,0)
 S X7=U_$P(^LAB(60,+LRTS,0),U,12),X6=X7_"0)"
"RTN","LRVR5",39,0)
 X:'(X="*"!($E(X)="?")!(X="C")!(X="#")!(X="canc")!(X="pending")) $P(@X6,U,5,99)
"RTN","LRVR5",40,0)
 I '$D(X)#2 D HELP G V42
"RTN","LRVR5",41,0)
 I $D(X)#2,X["?" D HELP G:'($P(@X6,U,2)["S") V42
"RTN","LRVR5",42,0)
 I $D(X)#2,$P(@X6,U,2)["S",X'="*",X'="#",X'="canc",X'="pending" D SET G:'$D(X)#2 V42
"RTN","LRVR5",43,0)
 I $D(X)#2,X="C",$P(@X6,U,2)'["S" D COMP^LRVER5 G V42
"RTN","LRVR5",44,0)
 ;
"RTN","LRVR5",45,0)
V46 G V44:'$D(X)#2
"RTN","LRVR5",46,0)
 S X1=$S($D(^LR(LRDFN,LRSS,LRLDT,LRSB)):$P(^(LRSB),U),1:""),LRFLG=""
"RTN","LRVR5",47,0)
 S:X="*" X="canc" S:X="#" X="comment"
"RTN","LRVR5",48,0)
 K LRQ S Y=0
"RTN","LRVR5",49,0)
 I LRDEL'="" S LRQ=1 X LRDEL K LRQ
"RTN","LRVR5",50,0)
 D RANGE
"RTN","LRVR5",51,0)
 G:$D(LRNUF) V44
"RTN","LRVR5",52,0)
 K LRNUF
"RTN","LRVR5",53,0)
 G V40:'$D(LRSKIP)
"RTN","LRVR5",54,0)
 S X=LRSKIP
"RTN","LRVR5",55,0)
 G Q43:X["^",V40
"RTN","LRVR5",56,0)
 G RANGE
"RTN","LRVR5",57,0)
 ;
"RTN","LRVR5",58,0)
 ;
"RTN","LRVR5",59,0)
RANGE D RANGE^LRVER5
"RTN","LRVR5",60,0)
RQ S X=Y
"RTN","LRVR5",61,0)
NR ;
"RTN","LRVR5",62,0)
 S:$P(X,U)="" LRSB(LRSB)="" Q:$D(LRQ)
"RTN","LRVR5",63,0)
 I $P(X,U)'="" D
"RTN","LRVR5",64,0)
 . N I,LRX,LRY
"RTN","LRVR5",65,0)
 . S $P(LRSB(LRSB),U,1,2)=X_U_LRFLG
"RTN","LRVR5",66,0)
 . S $P(LRSB(LRSB),U,4)=$G(DUZ)
"RTN","LRVR5",67,0)
 . I $P(LRSB(LRSB),U,9)="" S $P(LRSB(LRSB),U,9)=$S($G(LRDUZ(2)):LRDUZ(2),$G(DUZ(2)):DUZ(2),1:"")
"RTN","LRVR5",68,0)
 . S LRX=$$TMPSB^LRVER1(LRSB),LRY=$P(LRSB(LRSB),U,3)
"RTN","LRVR5",69,0)
 . F I=1:1:$L(LRX,"!") I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,"!",I)
"RTN","LRVR5",70,0)
 . S $P(LRSB(LRSB),U,3)=LRY
"RTN","LRVR5",71,0)
 . S LRX=LRNGS,LRY=$P(LRSB(LRSB),U,5)
"RTN","LRVR5",72,0)
 . F I=1:1:$L(LRX,U) I $P(LRY,"!",I)="" S $P(LRY,"!",I)=$P(LRX,U,I)
"RTN","LRVR5",73,0)
 . S $P(LRSB(LRSB),U,5)=LRY
"RTN","LRVR5",74,0)
 Q
"RTN","LRVR5",75,0)
 ;
"RTN","LRVR5",76,0)
 ;
"RTN","LRVR5",77,0)
SUBS ;
"RTN","LRVR5",78,0)
 D LRSUBS^LRVER5
"RTN","LRVR5",79,0)
 Q
"RTN","LRVR5",80,0)
 ;
"RTN","LRVR5",81,0)
 ;
"RTN","LRVR5",82,0)
SET ;
"RTN","LRVR5",83,0)
 D LRSET^LRVER5
"RTN","LRVR5",84,0)
 Q
"RTN","LRVR5",85,0)
 ;
"RTN","LRVR5",86,0)
 ;
"RTN","LRVR5",87,0)
HUH W !,"CHOOSE:" F I=1:1 S LRSUBS=$P(LRSET,";",I) Q:LRSUBS=""  W !,$P(LRSUBS,":")," FOR ",$P(LRSUBS,":",2)
"RTN","LRVR5",88,0)
 K X
"RTN","LRVR5",89,0)
 Q
"RTN","LRVR5",90,0)
 ;
"RTN","LRVR5",91,0)
 ;
"RTN","LRVR5",92,0)
V25 ; From LRVR4
"RTN","LRVR5",93,0)
 D V25^LRVER5
"RTN","LRVR5",94,0)
 Q
"RTN","LRVR5",95,0)
 ;
"RTN","LRVR5",96,0)
 ;
"RTN","LRVR5",97,0)
OUT S LROUT=1
"RTN","LRVR5",98,0)
 Q
"RTN","LRVR5",99,0)
 ;
"RTN","LRVR5",100,0)
 ;
"RTN","LRVR5",101,0)
HELP ;
"RTN","LRVR5",102,0)
 W !," ??",$C(7)
"RTN","LRVR5",103,0)
 S X5=X7_"3)"
"RTN","LRVR5",104,0)
 W:$D(@X5) " ",@X5
"RTN","LRVR5",105,0)
 W !,"Enter * to report ""canc"" for canceled."
"RTN","LRVR5",106,0)
 W !,"Enter # to report ""comment""."
"RTN","LRVR5",107,0)
 W:'($P(@X6,U,2)["S") !,"Enter C to enter calculate mode."
"RTN","LRVR5",108,0)
 Q
"RTN","LRWLST1")
0^8^B73104899
"RTN","LRWLST1",1,0)
LRWLST1 ;DALOI/CJS/RWF/FHS - ACCESSION SETUP ;2/7/91  12:21
"RTN","LRWLST1",2,0)
 ;;5.2;LAB SERVICE;**48,65,121,153,261,286**;Sep 27, 1994
"RTN","LRWLST1",3,0)
 ;
"RTN","LRWLST1",4,0)
 ; Reference to ^DIC(42 supported by IA #10039
"RTN","LRWLST1",5,0)
 ; Reference to ^SC( supported by IA #10040
"RTN","LRWLST1",6,0)
 ;
"RTN","LRWLST1",7,0)
 S LRWLC=0
"RTN","LRWLST1",8,0)
 F  S LRWLC=$O(LRTSTS(LRWLC)) Q:LRWLC<1  S LRAD=DT D SPLIT
"RTN","LRWLST1",9,0)
 ;
"RTN","LRWLST1",10,0)
 ; If LEDI and comments came with order then copy to order in #69
"RTN","LRWLST1",11,0)
 I $G(LRORDRR)="R",$G(LR696),$D(^LRO(69.6,LR696,99)) D
"RTN","LRWLST1",12,0)
 . N LRDIE
"RTN","LRWLST1",13,0)
 . D WP^DIE(69.01,LRSN_","_LRODT_",",16,"A","^LRO(69.6,LR696,99)","LRDIE(16)")
"RTN","LRWLST1",14,0)
 ;
"RTN","LRWLST1",15,0)
 K DIC,DLAYGO,DR,DA,DIE,LRIXX
"RTN","LRWLST1",16,0)
 Q:$G(LRORDR)="P"
"RTN","LRWLST1",17,0)
 K LRNM,LRTSTS
"RTN","LRWLST1",18,0)
 K ^TMP("LR",$J,"TMP")
"RTN","LRWLST1",19,0)
 Q
"RTN","LRWLST1",20,0)
 ;
"RTN","LRWLST1",21,0)
SPLIT ;
"RTN","LRWLST1",22,0)
 N LRAA
"RTN","LRWLST1",23,0)
 S LRUNQ=0,LREND=0
"RTN","LRWLST1",24,0)
 I $D(LRTSTS(LRWLC,0)) D
"RTN","LRWLST1",25,0)
 . D GTWLN
"RTN","LRWLST1",26,0)
 . I LREND Q
"RTN","LRWLST1",27,0)
 . S LRAA=0
"RTN","LRWLST1",28,0)
 . F  S LRAA=$O(LRTSTS(LRWLC,0,LRAA)) Q:LRAA<1  D
"RTN","LRWLST1",29,0)
 . . S LRSS=LRTSTS(LRWLC,0,LRAA)
"RTN","LRWLST1",30,0)
 . . D STWLN,ST2,^LRWLST11,EN^LA7ADL(LRUID)
"RTN","LRWLST1",31,0)
 ;
"RTN","LRWLST1",32,0)
 S LRUNQ=1,LRAA=0
"RTN","LRWLST1",33,0)
 F  S LRAA=$O(LRTSTS(LRWLC,1,LRAA)) Q:LRAA<1  D
"RTN","LRWLST1",34,0)
 . S LRSS=LRTSTS(LRWLC,1,LRAA)
"RTN","LRWLST1",35,0)
 . F  D GTWLN Q:LREND  D STWLN,ST2,^LRWLST11,EN^LA7ADL(LRUID) Q:$O(LRTSTS(LRWLC,1,LRAA,0))<1
"RTN","LRWLST1",36,0)
 Q
"RTN","LRWLST1",37,0)
 ;
"RTN","LRWLST1",38,0)
 ;
"RTN","LRWLST1",39,0)
STWLN ; Set accession number
"RTN","LRWLST1",40,0)
 ;
"RTN","LRWLST1",41,0)
 D GETLOCK(LRAA,LRAD)
"RTN","LRWLST1",42,0)
 D CHECK68(LRAA,LRAD)
"RTN","LRWLST1",43,0)
 ;
"RTN","LRWLST1",44,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3)
"RTN","LRWLST1",45,0)
 ;
"RTN","LRWLST1",46,0)
 ; Handle "in common area" that was not setup in GTWLN call.
"RTN","LRWLST1",47,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN)) D SETAN(LRAA,LRAD,LRAN)
"RTN","LRWLST1",48,0)
 ;
"RTN","LRWLST1",49,0)
 S LREND=0,LRLBLBP=1-$P(LRSS,U,2),LRSS=$P(LRSS,U)
"RTN","LRWLST1",50,0)
 S LRACC=$P(^LRO(68,LRAA,0),U,11)_" "_$S(LRAD["0000":$E(LRAD,2,3),1:$E(LRAD,4,7))_" "_LRAN
"RTN","LRWLST1",51,0)
 ;
"RTN","LRWLST1",52,0)
 S LRPRAC=""
"RTN","LRWLST1",53,0)
 I $D(^LRO(69,LRODT,1,LRSN,0)) S LRPRAC=$P(^(0),U,6) S:$D(LRNT) ^(3)=LRNT
"RTN","LRWLST1",54,0)
 ;
"RTN","LRWLST1",55,0)
 ; Location type
"RTN","LRWLST1",56,0)
 S LRCAPLOC=$P($G(^SC(+LROLLOC,0)),U,3)
"RTN","LRWLST1",57,0)
 I LRCAPLOC="" S LRCAPLOC="Z"
"RTN","LRWLST1",58,0)
 ;
"RTN","LRWLST1",59,0)
 ; File information in file #68 for this accession
"RTN","LRWLST1",60,0)
 N FDA,LR6802,LRDIE
"RTN","LRWLST1",61,0)
 S LR6802=LRAN_","_LRAD_","_LRAA_","
"RTN","LRWLST1",62,0)
 S FDA(1,68.02,LR6802,.01)=LRDFN
"RTN","LRWLST1",63,0)
 S FDA(1,68.02,LR6802,1)=LRDPF
"RTN","LRWLST1",64,0)
 S FDA(1,68.02,LR6802,2)=LRAD
"RTN","LRWLST1",65,0)
 S FDA(1,68.02,LR6802,3)=LRODT
"RTN","LRWLST1",66,0)
 S FDA(1,68.02,LR6802,4)=LRSN
"RTN","LRWLST1",67,0)
 S FDA(1,68.02,LR6802,6)=LRLLOC
"RTN","LRWLST1",68,0)
 ;
"RTN","LRWLST1",69,0)
 ; No ordering provider/location on controls
"RTN","LRWLST1",70,0)
 I LRDPF'=62.3 D
"RTN","LRWLST1",71,0)
 . S FDA(1,68.02,LR6802,6.5)=LRPRAC
"RTN","LRWLST1",72,0)
 . S FDA(1,68.02,LR6802,94)=LROLLOC
"RTN","LRWLST1",73,0)
 ;
"RTN","LRWLST1",74,0)
 ; Only store treating specialty on file #2 patients
"RTN","LRWLST1",75,0)
 ; If no treating specialty then use specialty from file #44 location
"RTN","LRWLST1",76,0)
 I LRDPF=2 D
"RTN","LRWLST1",77,0)
 . S LRTREA=$P($G(^DPT(DFN,.103)),U)
"RTN","LRWLST1",78,0)
 . I 'LRTREA S LRTREA=$P($G(^SC(+LROLLOC,0)),U,20)
"RTN","LRWLST1",79,0)
 . I LRTREA S FDA(1,68.02,LR6802,6.6)=LRTREA
"RTN","LRWLST1",80,0)
 ;
"RTN","LRWLST1",81,0)
 S FDA(1,68.02,LR6802,6.7)=DUZ
"RTN","LRWLST1",82,0)
 S FDA(1,68.02,LR6802,15)=LRACC
"RTN","LRWLST1",83,0)
 S FDA(1,68.02,LR6802,26)=DUZ(2)
"RTN","LRWLST1",84,0)
 S FDA(1,68.02,LR6802,92)=LRCAPLOC
"RTN","LRWLST1",85,0)
 ;
"RTN","LRWLST1",86,0)
 D FILE^DIE("","FDA(1)","LRDIE(1)")
"RTN","LRWLST1",87,0)
 I $D(LRDIE(1)) D MAILALRT
"RTN","LRWLST1",88,0)
 ;
"RTN","LRWLST1",89,0)
 ; If specimen defined then set nodes, force to ien=1 since many lab
"RTN","LRWLST1",90,0)
 ; routines expect the specimen to be record number 1.
"RTN","LRWLST1",91,0)
 I $G(LRSPEC) D
"RTN","LRWLST1",92,0)
 . N FDAIEN
"RTN","LRWLST1",93,0)
 . S FDAIEN(1)=1
"RTN","LRWLST1",94,0)
 . S FDA(2,68.05,"+1,"_LR6802,.01)=LRSPEC
"RTN","LRWLST1",95,0)
 . S FDA(2,68.05,"+1,"_LR6802,1)=$P(LRSAMP,";",1)
"RTN","LRWLST1",96,0)
 . D UPDATE^DIE("","FDA(2)","FDAIEN","LRDIE(2)")
"RTN","LRWLST1",97,0)
 . I $D(LRDIE(2)) D MAILALRT
"RTN","LRWLST1",98,0)
 ;
"RTN","LRWLST1",99,0)
 ; If no specimen defined then use specimen values from file #69.
"RTN","LRWLST1",100,0)
 I $G(LRSPEC)="",$D(^LRO(69,LRODT,1,LRSN,4,0)) D
"RTN","LRWLST1",101,0)
 . N FDA,FDAIEN,LRI,LRX
"RTN","LRWLST1",102,0)
 . S LRI=0
"RTN","LRWLST1",103,0)
 . F  S LRI=$O(^LRO(69,LRODT,1,LRSN,4,LRI)) Q:'LRI  D
"RTN","LRWLST1",104,0)
 . . S FDAIEN(1)=LRI,LRX=$G(^LRO(69,LRODT,1,LRSN,4,LRI,0))
"RTN","LRWLST1",105,0)
 . . S FDA(LRI,68.05,"+1,"_LR6802,.01)=$P(LRX,"^")
"RTN","LRWLST1",106,0)
 . . D UPDATE^DIE("","FDA(LRI)","FDAIEN","LRDIE(LRI)")
"RTN","LRWLST1",107,0)
 . . I $D(LRDIE(LRI)) D MAILALRT
"RTN","LRWLST1",108,0)
 ;
"RTN","LRWLST1",109,0)
 ; Create UID.
"RTN","LRWLST1",110,0)
 S LRUID=$$LRUID^LRX(LRAA,LRAD,LRAN)
"RTN","LRWLST1",111,0)
 ;
"RTN","LRWLST1",112,0)
 I '$D(LRPHSET),('$G(LRQUIET)) W !!,"ACCESSION:  ",LRACC,"  <",LRUID,">"
"RTN","LRWLST1",113,0)
 ;
"RTN","LRWLST1",114,0)
 D UPD696
"RTN","LRWLST1",115,0)
 ;
"RTN","LRWLST1",116,0)
 L -^LRO(68,LRAA,1,LRAD,1,0)
"RTN","LRWLST1",117,0)
 Q
"RTN","LRWLST1",118,0)
 ;
"RTN","LRWLST1",119,0)
 ;
"RTN","LRWLST1",120,0)
UPD696 ; Update file #69.6 if LEDI referral patient and no existing entry
"RTN","LRWLST1",121,0)
 K LR696IEN
"RTN","LRWLST1",122,0)
 I $G(LRORDRR)="R" D
"RTN","LRWLST1",123,0)
 . S LR696IEN=0
"RTN","LRWLST1",124,0)
 . I $G(LRRSITE("SMID"))'="",$G(LRSD("RUID"))'="" S LR696IEN=+$O(^LRO(69.6,"AD",LRRSITE("SMID"),LRSD("RUID"),0))
"RTN","LRWLST1",125,0)
 . I LR696IEN Q
"RTN","LRWLST1",126,0)
 . I '$G(LRRSTAT(0)) S LRRSTAT(0)=$$FIND1^DIC(64.061,"","OMX","Specimen in process","","I $P(^LAB(64.061,Y,0),U,7)=""U""")
"RTN","LRWLST1",127,0)
 . D PSET^LRPEND(SSN(2),+LRRSITE("RSITE"),LRSD("RUID"),+LRSD("RPSITE"),LRSPEC,LRSAMP,LRRSTAT(0),LRODT,$P(LRCDT,U),LRRSITE("SDT"),LRNT,.LROT)
"RTN","LRWLST1",128,0)
 Q
"RTN","LRWLST1",129,0)
 ;
"RTN","LRWLST1",130,0)
 ;
"RTN","LRWLST1",131,0)
ST2 ; Find next available node in LR global
"RTN","LRWLST1",132,0)
 ;
"RTN","LRWLST1",133,0)
 N FDA,FDAIEN,LRDIE,LRX,LRXIDT
"RTN","LRWLST1",134,0)
 ;
"RTN","LRWLST1",135,0)
 ; Autopsy ("AU") is not a mulitple - do not attempt to set in ^LR global
"RTN","LRWLST1",136,0)
 I LRSS="AU" S LRIDT=0 Q
"RTN","LRWLST1",137,0)
 ;
"RTN","LRWLST1",138,0)
 S LRIDT=0
"RTN","LRWLST1",139,0)
 F  D  Q:LRIDT
"RTN","LRWLST1",140,0)
 . S LRXIDT=9999999-LRCDT
"RTN","LRWLST1",141,0)
 . L +^LR(LRDFN,LRSS,LRXIDT,0):5
"RTN","LRWLST1",142,0)
 . I '$T S LRCDT=$$FMADD^XLFDT(LRCDT,0,0,0,1) Q
"RTN","LRWLST1",143,0)
 . I '$D(^LR(LRDFN,LRSS,LRXIDT,0)) S LRIDT=LRXIDT Q
"RTN","LRWLST1",144,0)
 . L -^LR(LRDFN,LRSS,LRXIDT,0)
"RTN","LRWLST1",145,0)
 . S LRCDT=$$FMADD^XLFDT(LRCDT,0,0,0,1)
"RTN","LRWLST1",146,0)
 ;
"RTN","LRWLST1",147,0)
 ; Create entry in appropriate subscript in LAB DATA file (#63).
"RTN","LRWLST1",148,0)
 S LRX=$S(LRSS="CH":63.04,LRSS="MI":63.05,LRSS="BB":63.01,LRSS="SP":63.08,LRSS="CY":63.09,LRSS="EM":63.02,1:0)
"RTN","LRWLST1",149,0)
 S FDAIEN(1)=LRIDT
"RTN","LRWLST1",150,0)
 S FDA(63,LRX,"+1,"_LRDFN_",",.01)=LRCDT
"RTN","LRWLST1",151,0)
 S FDA(63,LRX,"+1,"_LRDFN_",",.06)=LRACC
"RTN","LRWLST1",152,0)
 I LRSS'="CH" S FDA(63,LRX,"+1,"_LRDFN_",",.1)=LRNT
"RTN","LRWLST1",153,0)
 I LRSS="CH" S FDA(63,LRX,"+1,"_LRDFN_",",.12)=3
"RTN","LRWLST1",154,0)
 I LRSS="MI" S FDA(63,LRX,"+1,"_LRDFN_",",38)=3
"RTN","LRWLST1",155,0)
 I LRX D UPDATE^DIE("","FDA(63)","FDAIEN","LRDIE(63)")
"RTN","LRWLST1",156,0)
 I $D(LRDIE(63)) D MAILALRT
"RTN","LRWLST1",157,0)
 ;
"RTN","LRWLST1",158,0)
 ; Uncomment following code when new field .9 in"MI" subscript is released
"RTN","LRWLST1",159,0)
 ;I LRSS="MI" D
"RTN","LRWLST1",160,0)
 ;. N LRN,ERR,IENS
"RTN","LRWLST1",161,0)
 ;. S IENS=LRIDT_","_LRDFN_",",LRN=0
"RTN","LRWLST1",162,0)
 ;. F  S LRN=$O(^LRO(69,LRODT,1,LRSN,2,LRN)) Q:LRN<1  D
"RTN","LRWLST1",163,0)
 ;. . I '$D(^LRO(69,LRODT,1,LRSN,2,LRN,1,0)) Q
"RTN","LRWLST1",164,0)
 ;. . D WP^DIE(63.05,IENS,.9,"A","^LRO(69,"_LRODT_",1,"_LRSN_",2,"_LRN_",1)","ERR")
"RTN","LRWLST1",165,0)
 ;
"RTN","LRWLST1",166,0)
 L -^LR(LRDFN,LRSS,LRIDT,0)
"RTN","LRWLST1",167,0)
 ;
"RTN","LRWLST1",168,0)
 Q
"RTN","LRWLST1",169,0)
 ;
"RTN","LRWLST1",170,0)
 ;
"RTN","LRWLST1",171,0)
GTWLN ;
"RTN","LRWLST1",172,0)
 N X
"RTN","LRWLST1",173,0)
 ;
"RTN","LRWLST1",174,0)
 ; Execute accession transform for this area.
"RTN","LRWLST1",175,0)
 S LRAN=0
"RTN","LRWLST1",176,0)
 S X=$G(^LRO(68,LRWLC,.1)) X:$L(X) X
"RTN","LRWLST1",177,0)
 ;
"RTN","LRWLST1",178,0)
 D GETLOCK(LRWLC,LRAD)
"RTN","LRWLST1",179,0)
 D CHECK68(LRWLC,LRAD)
"RTN","LRWLST1",180,0)
 ;
"RTN","LRWLST1",181,0)
 S:'LRAN LRAN=1+$P($G(^LRO(68,LRWLC,1,LRAD,1,0)),U,3)
"RTN","LRWLST1",182,0)
 ;
"RTN","LRWLST1",183,0)
 I "CYEMSP"'[LRSS F  Q:'$D(^LRO(68,LRWLC,1,LRAD,1,LRAN))  S LRAN=LRAN+1
"RTN","LRWLST1",184,0)
 ;
"RTN","LRWLST1",185,0)
 ; check for AP Accessions
"RTN","LRWLST1",186,0)
 I "CYEMSP"[LRSS F  Q:'$D(^LRO(68,LRWLC,1,LRAD,1,LRAN))&'$D(^LR("A"_LRSS_"A",$E(LRAD,1,3),LRAN))  S LRAN=LRAN+1
"RTN","LRWLST1",187,0)
 ;
"RTN","LRWLST1",188,0)
 I '$D(LRPHSET),$D(LRNCWL)!$P(^LAB(69.9,1,0),U,8) D ASK Q:LREND
"RTN","LRWLST1",189,0)
 ;
"RTN","LRWLST1",190,0)
 D SETAN(LRWLC,LRAD,LRAN)
"RTN","LRWLST1",191,0)
 ;
"RTN","LRWLST1",192,0)
 L -^LRO(68,LRWLC,1,LRAD,1,0)
"RTN","LRWLST1",193,0)
 Q
"RTN","LRWLST1",194,0)
 ;
"RTN","LRWLST1",195,0)
 ;
"RTN","LRWLST1",196,0)
ASK ;
"RTN","LRWLST1",197,0)
 ; Don't ask if tasked or a "silent" call
"RTN","LRWLST1",198,0)
 I $D(ZTQUEUED)!($G(LRQUIET)) Q
"RTN","LRWLST1",199,0)
 ;
"RTN","LRWLST1",200,0)
 K LRDFNX
"RTN","LRWLST1",201,0)
 S LRSAN=LRAN
"RTN","LRWLST1",202,0)
 W !,"force to: ",LRAN,"//" R X:DTIME
"RTN","LRWLST1",203,0)
 S:X="" X=LRAN G:X="^"!'$T END
"RTN","LRWLST1",204,0)
 S:+X'=X!(X>99999)!(X<1)!(X>LRAN&'$P(LRLABKY,U,2)&(LRDFN'<1)) X=""
"RTN","LRWLST1",205,0)
 S:X'="" LRAN=X
"RTN","LRWLST1",206,0)
 I X="" W !,"Must be a number between 1 and ",$S($P(LRLABKY,U,2):99999,1:LRAN),", inclusive.  ""^"" EXITS" G ASK
"RTN","LRWLST1",207,0)
 ;
"RTN","LRWLST1",208,0)
 N PNM,SSN
"RTN","LRWLST1",209,0)
 I $D(^LRO(68,LRWLC,1,LRAD,1,LRAN,0)) S LRDFNX=LRDFN,LRDFN=+^(0),LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^LR(LRDFN,0),U,3) D PT^LRX W !,"THIS NUMBER BELONGS TO ",!,PNM,"     SSN: ",SSN D INF^LRX G:LRDFN=LRDFNX SURE S LRDFN=LRDFNX,LRAN=LRSAN G ASK
"RTN","LRWLST1",210,0)
 ;
"RTN","LRWLST1",211,0)
WN1A I LRAN<+$P(^LRO(68,LRWLC,1,LRAD,1,0),U,3) D
"RTN","LRWLST1",212,0)
 . W !,"This accession number may be already assigned either in this "
"RTN","LRWLST1",213,0)
 . W !,"area or a common accession area."
"RTN","LRWLST1",214,0)
 ;
"RTN","LRWLST1",215,0)
SURE W !,"Are you sure" S %=2 D YN^DICN G:%=-1 END I %'=1 S LRAN=LRSAN G ASK
"RTN","LRWLST1",216,0)
 K LRSAN
"RTN","LRWLST1",217,0)
 Q
"RTN","LRWLST1",218,0)
 ;
"RTN","LRWLST1",219,0)
 ;
"RTN","LRWLST1",220,0)
CHECK68(LRAA,LRAD) ; Check for/set header node of ^LRO(68) 68.01 subfile.
"RTN","LRWLST1",221,0)
 ;
"RTN","LRWLST1",222,0)
 ; Call with LRAA = ien of entry in file #68
"RTN","LRWLST1",223,0)
 ;           LRAD = accession date in fileman format
"RTN","LRWLST1",224,0)
 ;
"RTN","LRWLST1",225,0)
 ; Set accession date in file #68 for this acession.
"RTN","LRWLST1",226,0)
 ; Check for existence of accession number multiple but not accession date multiple,
"RTN","LRWLST1",227,0)
 ; FileMan DBS call fail when accession numbers multiple exist but accession date multiple does not.
"RTN","LRWLST1",228,0)
 ; If this condition found then set missing node directly and quit.
"RTN","LRWLST1",229,0)
 ;
"RTN","LRWLST1",230,0)
 I '$D(^LRO(68,LRAA,1,LRAD,0)) D
"RTN","LRWLST1",231,0)
 . N FDA,FDAIEN,LRDIE
"RTN","LRWLST1",232,0)
 . I $D(^LRO(68,LRAA,1,LRAD,1)) S $P(^LRO(68,LRAA,1,LRAD,0),"^")=LRAD Q
"RTN","LRWLST1",233,0)
 . S (FDAIEN(1),FDA(1,68.01,"+1,"_LRAA_",",.01))=LRAD
"RTN","LRWLST1",234,0)
 . D UPDATE^DIE("","FDA(1)","FDAIEN","LRDIE(1)")
"RTN","LRWLST1",235,0)
 . I $D(LRDIE(1)) D MAILALRT
"RTN","LRWLST1",236,0)
 ;
"RTN","LRWLST1",237,0)
 Q
"RTN","LRWLST1",238,0)
 ;
"RTN","LRWLST1",239,0)
 ;
"RTN","LRWLST1",240,0)
GETLOCK(LRAA,LRAD) ; Obtain lock on zeroth node of this accession date
"RTN","LRWLST1",241,0)
 ; Call with LRAA = ien of entry in file #68
"RTN","LRWLST1",242,0)
 ;           LRAD = accession date in fileman format
"RTN","LRWLST1",243,0)
 ;
"RTN","LRWLST1",244,0)
 F  L +^LRO(68,LRAA,1,LRAD,1,0):10 Q:$T  D
"RTN","LRWLST1",245,0)
 . I $D(ZTQUEUED)!($G(LRQUIET)) Q
"RTN","LRWLST1",246,0)
 . W !!?5,"Accession area ",$P(^LRO(68,LRAA,0),"^")," is locked by another user.",!,$C(7)
"RTN","LRWLST1",247,0)
 Q
"RTN","LRWLST1",248,0)
 ;
"RTN","LRWLST1",249,0)
 ;
"RTN","LRWLST1",250,0)
SETAN(LRAA,LRAD,LRAN) ; Create stub entry in file #68 for this acession.
"RTN","LRWLST1",251,0)
 ;
"RTN","LRWLST1",252,0)
 ; Call with LRAA = ien of entry in file #68
"RTN","LRWLST1",253,0)
 ;           LRAD = accession date in fileman format
"RTN","LRWLST1",254,0)
 ;           LRAN = accession number
"RTN","LRWLST1",255,0)
 ;
"RTN","LRWLST1",256,0)
 N FDA,FDAIEN,LR6802,LRDIE
"RTN","LRWLST1",257,0)
 ;
"RTN","LRWLST1",258,0)
 S LR6802=LRAD_","_LRAA_","
"RTN","LRWLST1",259,0)
 S FDAIEN(1)=LRAN
"RTN","LRWLST1",260,0)
 S FDA(2,68.02,"+1,"_LR6802,.01)=LRDFN
"RTN","LRWLST1",261,0)
 D UPDATE^DIE("","FDA(2)","FDAIEN","LRDIE(2)")
"RTN","LRWLST1",262,0)
 I $D(LRDIE(2)) D MAILALRT
"RTN","LRWLST1",263,0)
 Q
"RTN","LRWLST1",264,0)
 ;
"RTN","LRWLST1",265,0)
 ;
"RTN","LRWLST1",266,0)
MAILALRT ; Send mail message alert when FileMan DBS errors returned
"RTN","LRWLST1",267,0)
 ;
"RTN","LRWLST1",268,0)
 N J,LR68,LRCNT,LRMTXT,X,XMINSTR,XMSUB,XMTO
"RTN","LRWLST1",269,0)
 ;
"RTN","LRWLST1",270,0)
 I $D(^LRO(68,LRAA,1,LRAD,1,LRAN)) M LR68=^LRO(68,LRAA,1,LRAD,1,LRAN)
"RTN","LRWLST1",271,0)
 ;
"RTN","LRWLST1",272,0)
 S LRMTXT(1)="The following debugging information is provided to assist"
"RTN","LRWLST1",273,0)
 S LRMTXT(2)="support staff in resolving error during accessioning."
"RTN","LRWLST1",274,0)
 S LRMTXT(3)=" "
"RTN","LRWLST1",275,0)
 S LRCNT=3
"RTN","LRWLST1",276,0)
 ;
"RTN","LRWLST1",277,0)
 F J="FDA","FDAIEN","LR68","LRAA","LRAD","LRAN","LRDFN","LRDIE","LRSS","LRTSTS","LRUNQ","LRWLC" D
"RTN","LRWLST1",278,0)
 . S X=$G(@J)
"RTN","LRWLST1",279,0)
 . I $L(X) S LRCNT=LRCNT+1,LRMTXT(LRCNT)=J_"="_X
"RTN","LRWLST1",280,0)
 . F  S J=$Q(@J) Q:J=""  S LRCNT=LRCNT+1,LRMTXT(LRCNT)=J_"="_@J
"RTN","LRWLST1",281,0)
 ;
"RTN","LRWLST1",282,0)
 S XMSUB="FileMan DBS call failed during accessioning in routine LRWLST1"
"RTN","LRWLST1",283,0)
 S XMTO("G.LMI")=""
"RTN","LRWLST1",284,0)
 S XMINSTR("FROM")=.5
"RTN","LRWLST1",285,0)
 S XMINSTR("ADDR FLAGS")="R"
"RTN","LRWLST1",286,0)
 D SENDMSG^XMXAPI(DUZ,XMSUB,"LRMTXT",.XMTO,.XMINSTR)
"RTN","LRWLST1",287,0)
 Q
"RTN","LRWLST1",288,0)
 ;
"RTN","LRWLST1",289,0)
 ;
"RTN","LRWLST1",290,0)
END ;
"RTN","LRWLST1",291,0)
 K LRSAN
"RTN","LRWLST1",292,0)
 S LREND=1
"RTN","LRWLST1",293,0)
 ; unlock
"RTN","LRWLST1",294,0)
 L -^LRO(68,LRWLC,1,LRAD,1,0)
"RTN","LRWLST1",295,0)
 Q
"RTN","LRWLST11")
0^28^B52415321
"RTN","LRWLST11",1,0)
LRWLST11 ;DALOI/CJS,RWF/FHS - ACCESSION SETUP ;2/7/91  13:34
"RTN","LRWLST11",2,0)
 ;;5.2;LAB SERVICE;**121,128,153,202,286**;Sep 27, 1994
"RTN","LRWLST11",3,0)
 ;
"RTN","LRWLST11",4,0)
ST21 I $D(^LRO(69,LRODT,1,LRSN,.1)) S X=^(.1),^LRO(68,LRAA,1,LRAD,1,LRAN,.1)=X,^LRO(68,LRAA,1,LRAD,1,"D",+X,LRAN)=""
"RTN","LRWLST11",5,0)
 S LRTS="",LRIX=0
"RTN","LRWLST11",6,0)
 F  S LRIX=$O(LRTSTS(LRWLC,LRUNQ,LRAA,LRIX)) Q:LRIX<1  D SET Q:LRUNQ
"RTN","LRWLST11",7,0)
 S LRNT=$$NOW^XLFDT
"RTN","LRWLST11",8,0)
 S ^LRO(68,LRAA,1,LRAD,1,LRAN,3)=LRCDT_U_LREAL_U_$S($D(LRPHSET):"",1:LRNT)_"^^"_LRIDT
"RTN","LRWLST11",9,0)
 I '$D(LRPHSET) S:$L(LRNT) ^LRO(68,LRAA,1,LRAD,1,"E",LRNT,LRAN)=""
"RTN","LRWLST11",10,0)
 D SLRSS
"RTN","LRWLST11",11,0)
 ;
"RTN","LRWLST11",12,0)
COMMON I +LRWLC,+LRWLC'=+LRAA,$G(^LRO(68,LRWLC,1,LRAD,1,LRAN,0))=$G(LRDFN) D
"RTN","LRWLST11",13,0)
 . Q:$G(^LRO(68,LRWLC,1,LRAD,1,LRAN,.1))
"RTN","LRWLST11",14,0)
 . N LRACCX,LRAAX,LRORU3,LREND,LRTJ
"RTN","LRWLST11",15,0)
 . N LRCOMMON,LRIDT,LRNODE3,LRPHSETX,LRQUIET,X,Y
"RTN","LRWLST11",16,0)
 . S LRAAX=LRAA,LRACCX=LRACC,LRPHSETX=$D(LRPHSET),X=LRSS
"RTN","LRWLST11",17,0)
 . N LRAA,LRACC,LRUID,LRPHSET,LRORDRR,LRSS
"RTN","LRWLST11",18,0)
 . S (LRQUIET,LRCOMMON)=1,LRAA=+LRWLC,LRORDRR="",LRSS=X_U_(1+$G(LRLBLBP))
"RTN","LRWLST11",19,0)
 . D STWLN^LRWLST1 Q:$G(LREND)
"RTN","LRWLST11",20,0)
 . D ST2^LRWLST1 Q:$G(LREND)
"RTN","LRWLST11",21,0)
 . S LRNODE3=$G(^LRO(68,LRAAX,1,LRAD,1,LRAN,3))
"RTN","LRWLST11",22,0)
 . S $P(LRNODE3,U)=LRCDT,$P(LRNODE3,U,5)=LRIDT
"RTN","LRWLST11",23,0)
 . S LRPHSET=1
"RTN","LRWLST11",24,0)
 . I $D(^LRO(69,LRODT,1,LRSN,.1)) S X=^(.1),^LRO(68,LRAA,1,LRAD,1,LRAN,.1)=X,^LRO(68,LRAA,1,LRAD,1,"D",+X,LRAN)=""
"RTN","LRWLST11",25,0)
 . S ^LRO(68,LRAA,1,LRAD,1,LRAN,3)=LRNODE3
"RTN","LRWLST11",26,0)
 . S ^LRO(68,LRAA,1,LRAD,1,LRAN,"AD")=LRACCX
"RTN","LRWLST11",27,0)
 . I 'LRPHSETX,$L($G(LRNT)) S ^LRO(68,LRAA,1,LRAD,1,"E",LRNT,LRAN)=""
"RTN","LRWLST11",28,0)
 . D SLRSS
"RTN","LRWLST11",29,0)
 ;
"RTN","LRWLST11",30,0)
 Q
"RTN","LRWLST11",31,0)
 ;
"RTN","LRWLST11",32,0)
 ;
"RTN","LRWLST11",33,0)
SLRSS ;
"RTN","LRWLST11",34,0)
 ;
"RTN","LRWLST11",35,0)
 S X=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,5,1,0)) ; change for AP
"RTN","LRWLST11",36,0)
 S H8=$S($D(LRSPEC):LRSPEC,1:X)_U_$S("CYEMSPAU"[LRSS:LRACC,1:LRACC)_U_$S(LRSS="MI":LRPRAC,1:"")_U_$S(LRSS="MI":LRLLOC,1:"")_"^^"_$S(LRSS="CH":LRPRAC,1:"")_"^"_$S(LRSS="MI":$P(LRSAMP,";",1),LRSS="CH":LRLLOC,1:"")
"RTN","LRWLST11",37,0)
 ;
"RTN","LRWLST11",38,0)
 I $S(LRSS="CH":1,LRSS="MI":1,1:0) D
"RTN","LRWLST11",39,0)
 . I $G(LRORDRR)="R",+$G(LRRSITE("RSITE")) S $P(H8,U,9)=+LRRSITE("RSITE")_";DIC(4,"
"RTN","LRWLST11",40,0)
 . I $G(LROLLOC),$G(LRORDRR)'="R" S $P(H8,U,9)=LROLLOC_";SC("
"RTN","LRWLST11",41,0)
 . S $P(H8,U,10)=$S($G(LRDUZ(2)):LRDUZ(2),1:$G(DUZ(2)))
"RTN","LRWLST11",42,0)
 ;
"RTN","LRWLST11",43,0)
 S ^LR(LRDFN,LRSS,LRIDT,0)=LRCDT_U_LREAL_"^^^"_H8
"RTN","LRWLST11",44,0)
 I $G(LRORU3)'="" S ^LR(LRDFN,LRSS,LRIDT,"ORU")=LRORU3
"RTN","LRWLST11",45,0)
 ;
"RTN","LRWLST11",46,0)
ST3 D ST4:(LRSS="MI"),LRCCOM
"RTN","LRWLST11",47,0)
 ;
"RTN","LRWLST11",48,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3),LRPR=1
"RTN","LRWLST11",49,0)
 S LRRB=0
"RTN","LRWLST11",50,0)
 I LRDPF=2 S LRRB=$$GET1^DIQ(2,DFN_",",.101),LRRB=$S(LRRB'="":LRRB,1:0)
"RTN","LRWLST11",51,0)
 ;
"RTN","LRWLST11",52,0)
 Q:$G(LRORDR)="P"
"RTN","LRWLST11",53,0)
 ;
"RTN","LRWLST11",54,0)
 I '$D(LRTJ) D  Q
"RTN","LRWLST11",55,0)
 . I $G(LRORDRR)="R",LRSS="CH",$G(LRORU3)'="",$P(LRORU3,"^")'=$P(LRORU3,"^",4) Q  ; Don't print, use label from sending facility.
"RTN","LRWLST11",56,0)
 . I LRLBLBP,'$G(LRCOMMON) S LRLBL(LRAA,LRAN)=LRSN_U_LRAD_U_LRODT_U_LRRB_U_LRLLOC_U_LRACC_U_$S($D(LRORD):LRORD,1:"")
"RTN","LRWLST11",57,0)
 S I=0
"RTN","LRWLST11",58,0)
 F  S I=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,I)) Q:I<.5  S LRTS=^(I,0) D Z
"RTN","LRWLST11",59,0)
 Q
"RTN","LRWLST11",60,0)
 ;
"RTN","LRWLST11",61,0)
 ;
"RTN","LRWLST11",62,0)
ST4 ;
"RTN","LRWLST11",63,0)
 S $P(^LR(LRDFN,LRSS,LRIDT,0),U,10)=$S($D(LRNT):LRNT,1:""),$P(^(0),U,8)=LRLLOC
"RTN","LRWLST11",64,0)
 ; Used to be LRSPCDSC,63.05,.9 (Word Processing field) replaces 63.05,.99
"RTN","LRWLST11",65,0)
 S:$D(LRCCOM) ^LR(LRDFN,LRSS,LRIDT,99)=LRCCOM
"RTN","LRWLST11",66,0)
 I '$D(LRPHSET) D
"RTN","LRWLST11",67,0)
 . N DA,DIE,DR
"RTN","LRWLST11",68,0)
 . S DIE="^LR("_LRDFN_",""MI"",",DA=LRIDT,DA(1)=LRDFN
"RTN","LRWLST11",69,0)
 . ;S DR=.9
"RTN","LRWLST11",70,0)
 . ;I '$G(LRQUIET) W:DR'=.9 !!,"Order comment:"
"RTN","LRWLST11",71,0)
 . S DR=.99_$S($L($G(LRGCOM)):"///"_LRGCOM,$L($G(LRCCOM)):"//"_LRCCOM,1:"")
"RTN","LRWLST11",72,0)
 . I '$G(LRQUIET) W:DR'=.99 !!,"Order comment:"
"RTN","LRWLST11",73,0)
 . D ^DIE
"RTN","LRWLST11",74,0)
 I '$G(LRQUIET),'$D(LRPHSET),'$D(LRGCOM) W !,"Description OK? Y//" D % G ST4:%["N"
"RTN","LRWLST11",75,0)
 K DR,DIC,DIE
"RTN","LRWLST11",76,0)
 Q
"RTN","LRWLST11",77,0)
 ;
"RTN","LRWLST11",78,0)
 ;
"RTN","LRWLST11",79,0)
ST5 S I("SUBSC")=$S(I("EDIT")[11.5:26,I("EDIT")[15:27,I("EDIT")[19:28,I("EDIT")[23:29,I("EDIT")[34:30,1:-1) Q:I("SUBSC")=-1
"RTN","LRWLST11",80,0)
 S I("PNTR")=$S(I("EDIT")[11.5:"^63.061A^",I("EDIT")[15:"^63.361A^",I("EDIT")[19:"^63.111A^",I("EDIT")[23:"^63.181A^",1:"^63.432A^")
"RTN","LRWLST11",81,0)
 S I("N")=1+$S($D(^LR(LRDFN,"MI",LRIDT,I("SUBSC"),0)):$P(^(0),U,4),1:0),^(0)=I("PNTR")_I("N")_U_I("N"),^(I("N"),0)=I("TEST")
"RTN","LRWLST11",82,0)
 Q
"RTN","LRWLST11",83,0)
 ;
"RTN","LRWLST11",84,0)
 ;
"RTN","LRWLST11",85,0)
SET S LRTS=LRTSTS(LRWLC,LRUNQ,LRAA,LRIX),LRIN=$P(LRTS,U,3),LRORIFN=$P(LRTS,U,4),LRTSORU=+$P(LRTS,U,6),LRTS=$P(LRTS,U,1,2),LRBACK=$P(LRTS,U,5)
"RTN","LRWLST11",86,0)
 ;
"RTN","LRWLST11",87,0)
 I '$G(LRQUIET),'$D(LRPHSET) D
"RTN","LRWLST11",88,0)
 . W !,$P(^LAB(60,+LRTS,0),U)
"RTN","LRWLST11",89,0)
 . I $D(LRSPEC),LRSPEC D
"RTN","LRWLST11",90,0)
 . . S I=$S($D(^LAB(61,+LRSPEC,0)):$P(^(0),U),1:""),J=$S($D(^LAB(62,+LRSAMP,0)):$P(^(0),U),1:"")
"RTN","LRWLST11",91,0)
 . . W ?30,J W:I'=J "  ",I
"RTN","LRWLST11",92,0)
 ;
"RTN","LRWLST11",93,0)
 I '$G(LRQUIET),'$D(LRPHSET),+LRTS,$O(^LAB(60,+LRTS,7,0))>0 D
"RTN","LRWLST11",94,0)
 . N S
"RTN","LRWLST11",95,0)
 . S DIC="^LAB(60,",DA=+LRTS,DR=7
"RTN","LRWLST11",96,0)
 . D EN^DIQ H 3
"RTN","LRWLST11",97,0)
 I '$G(LRQUIET),'$D(LRPHSET),+LRTS D
"RTN","LRWLST11",98,0)
 . N S
"RTN","LRWLST11",99,0)
 . S DIC="^LAB(60,"_(+LRTS)_",3,"
"RTN","LRWLST11",100,0)
 . S DA=+$O(^LAB(60,+LRTS,3,"B",+LRSAMP,0)),DR=2
"RTN","LRWLST11",101,0)
 . I DA>0,$O(^LAB(60,+LRTS,3,DA,2,0))>0 D EN^DIQ H 3
"RTN","LRWLST11",102,0)
 ;
"RTN","LRWLST11",103,0)
 D ORUT
"RTN","LRWLST11",104,0)
 D CAP^LRWLST12
"RTN","LRWLST11",105,0)
 K LRTSTS(LRWLC,LRUNQ,LRAA,LRIX)
"RTN","LRWLST11",106,0)
 ;
"RTN","LRWLST11",107,0)
 S ^LRO(69,LRODT,1,LRSN,2,LRIN,0)=LRTS_U_LRAD_U_LRAA_U_LRAN_"^^"_LRORIFN_"^^IP^L^^^^"_LRBACK
"RTN","LRWLST11",108,0)
 S ^LRO(69,LRODT,1,LRSN,2,"B",+LRTS,LRIN)=""
"RTN","LRWLST11",109,0)
 ;
"RTN","LRWLST11",110,0)
 ; When file 63 is enhanced to accept comments per test comments should
"RTN","LRWLST11",111,0)
 ; be put there instead of field 99.
"RTN","LRWLST11",112,0)
 I $O(^LRO(69,LRODT,1,LRSN,2,LRIN,1,0)) D
"RTN","LRWLST11",113,0)
 . I LRSS'="CH"!($D(^LR(LRDFN,LRSS,LRIDT,0))[0) Q
"RTN","LRWLST11",114,0)
 . S X=$S($D(^LR(LRDFN,LRSS,LRIDT,1,0)):$P(^(0),"^",3),1:0),I=0
"RTN","LRWLST11",115,0)
 . F  S I=$O(^LRO(69,LRODT,1,LRSN,2,LRIN,1,I)) Q:I<1  S II=^(I,0) S X=X+1,^LR(LRDFN,LRSS,LRIDT,1,X,0)=II
"RTN","LRWLST11",116,0)
 . S:X ^LR(LRDFN,LRSS,LRIDT,1,0)="^63.041^"_X_U_X
"RTN","LRWLST11",117,0)
 ;
"RTN","LRWLST11",118,0)
RUID I $G(LRORU3)'="" D
"RTN","LRWLST11",119,0)
 . N DA,DIE,DIC,DLAYGO,DR,X,Y
"RTN","LRWLST11",120,0)
 . S DLAYGO=69
"RTN","LRWLST11",121,0)
 . S DA=LRIN,DA(1)=LRSN,DA(2)=LRODT,DIC="^LRO(69,"_DA(2)_",1,"_DA(1)_",2,"
"RTN","LRWLST11",122,0)
 . S DIE=DIC,DR="13////"_$P(LRORU3,U)_";14////"_$P(LRORU3,U,2)_";15////"_$P(LRORU3,U,3)_";16////"_$P(LRORU3,U,4)_";17////"_$P(LRORU3,U,5)
"RTN","LRWLST11",123,0)
 . D ^DIE
"RTN","LRWLST11",124,0)
 Q
"RTN","LRWLST11",125,0)
 ;
"RTN","LRWLST11",126,0)
 ;
"RTN","LRWLST11",127,0)
% R %:DTIME Q:%=""!(%["N")!(%["Y")  W !,"Answer 'Y' or 'N': " G %
"RTN","LRWLST11",128,0)
 ;
"RTN","LRWLST11",129,0)
 ;
"RTN","LRWLST11",130,0)
LRCCOM ;
"RTN","LRWLST11",131,0)
 N I,LRCCOM,LRTN,X
"RTN","LRWLST11",132,0)
 S (I,LRTN,LRCCOM)=0 Q:LRSS'="CH"!($D(^LR(LRDFN,LRSS,LRIDT,0))[0)
"RTN","LRWLST11",133,0)
 F  S I=$O(^LRO(69,LRODT,1,LRSN,6,I)) Q:I<1  I $D(^(I,0)) S X=^(0),LRCCOM=LRCCOM+1,^LR(LRDFN,LRSS,LRIDT,1,LRCCOM,0)=X
"RTN","LRWLST11",134,0)
 F  S LRTN=$O(^LRO(69,LRODT,1,LRSN,2,LRTN)) Q:'LRTN  I $D(^(LRTN,0)) S X=^(0) I $P(X,"^",8),'$P(X,"^",3),$O(^(1,0)) D  ;Get comments for expanded panels
"RTN","LRWLST11",135,0)
 . S I=0 F  S I=$O(^LRO(69,LRODT,1,LRSN,2,LRTN,1,I)) Q:'I  I $D(^(I,0)) S X=^(0),LRCCOM=LRCCOM+1,^LR(LRDFN,LRSS,LRIDT,1,LRCCOM,0)=X
"RTN","LRWLST11",136,0)
 S:LRCCOM ^LR(LRDFN,LRSS,LRIDT,1,0)="^63.041^"_LRCCOM_U_LRCCOM
"RTN","LRWLST11",137,0)
 Q
"RTN","LRWLST11",138,0)
 ;
"RTN","LRWLST11",139,0)
 ;
"RTN","LRWLST11",140,0)
Z L +^LRO(69.1,LRTE)
"RTN","LRWLST11",141,0)
 S LRZ3=$S($D(^LRO(69.1,LRTE,1,0)):$P(^(0),U,3),1:0)
"RTN","LRWLST11",142,0)
Z1 S LRZ3=LRZ3+1 G:$D(^LRO(69.1,LRTE,1,LRZ3)) Z1
"RTN","LRWLST11",143,0)
 S LRZO="^LRO(69.1,"_LRTE_",1,",LRZ1="69.11P",LRZB=+LRTS,LRIFN=LRZ3
"RTN","LRWLST11",144,0)
 D Z^LRWU
"RTN","LRWLST11",145,0)
 S ^LRO(69.1,LRTE,1,LRIFN,0)=+LRTS_"^"_LRLLOC_"^"_LRRB_"^"_LRDFN_"^"_LRSN_"^"_LRTJ_"^"_LRAD_"^"_LRAA_"^"_LRAN_"^"_+LROLLOC
"RTN","LRWLST11",146,0)
 S ^LRO(69.1,"LRPH",LRTE,LRLLOC,LRRB,LRDFN,LRSN)=LRTJ_"^"_LRAD_"^"_LRIFN,^(LRSN,LRAA,LRAN,+LRTS)=+LRTS
"RTN","LRWLST11",147,0)
 L -^LRO(69.1,LRTE)
"RTN","LRWLST11",148,0)
 Q
"RTN","LRWLST11",149,0)
 ;
"RTN","LRWLST11",150,0)
 ;
"RTN","LRWLST11",151,0)
ORUT Q:'$G(LRTSORU)!($G(LRSS)'="CH")
"RTN","LRWLST11",152,0)
 N LRTT,DLAYGO,DIC,DIE,DR,LRTST,DA,LRURG
"RTN","LRWLST11",153,0)
 S DA=LRIDT,DA(1)=LRDFN
"RTN","LRWLST11",154,0)
 S LRNLT=$$NLT^LRVER1(+LRTSORU) Q:+LRNLT<1  Q:$D(^LR(DA(1),LRSS,DA,"ORUT","B",LRNLT))
"RTN","LRWLST11",155,0)
 S DR=".35///^S X=LRNLT",DR(1)=".35"
"RTN","LRWLST11",156,0)
 S DR(1,63.04)=".35///^S X=LRNLT"
"RTN","LRWLST11",157,0)
 S DR(1,63.07)=".01///^S X=LRNLT"
"RTN","LRWLST11",158,0)
 S DIC="^LR("_DA(1)_","""_LRSS_""","
"RTN","LRWLST11",159,0)
 S DIC(0)="MNL",DIE=DIC W:$G(LRDBUG) !,LRNLT
"RTN","LRWLST11",160,0)
 D ^DIE
"RTN","LRWLST11",161,0)
 ;
"RTN","LRWLST11",162,0)
ORUT2 S LRTST=$P($G(^LAM($O(^LAM("E",LRNLT,0)),0)),U) Q:LRTST=""!('$G(LR696IEN))
"RTN","LRWLST11",163,0)
 Q:'$D(^LRO(69.6,LR696IEN,0))#2!($D(^LRO(69.6,LR696IEN,2,"C",LRNLT)))
"RTN","LRWLST11",164,0)
 S:'$D(^LRO(69.6,LR696IEN,2,0)) ^(0)="^69.64A^"
"RTN","LRWLST11",165,0)
 S DLAYGO=69.6
"RTN","LRWLST11",166,0)
 K DIC,DIE,DA,DR,DA
"RTN","LRWLST11",167,0)
 S DA=LR696IEN
"RTN","LRWLST11",168,0)
 S LRURG="R",LRURG=$S($L($P($G(^LAB(62.05,+$P(LRTS,U,2),0)),U,4)):$P(^(0),U,4),1:LRURG)
"RTN","LRWLST11",169,0)
 S (DIE,DIC)="^LRO(69.6,",DIC(0)="LM"
"RTN","LRWLST11",170,0)
 S DR=20_"///"_LRTST_";",DR(1,69.6)="20///"_LRTST_";"
"RTN","LRWLST11",171,0)
 S DR(2,69.64)=".01///"_LRTST_";1///"_LRNLT_";4///"_LRURG_";5////160;8///"_LRNT_";9///"_LRUID
"RTN","LRWLST11",172,0)
 D ^DIE
"RTN","LRWLST11",173,0)
 Q
"UP",60,60.01,-1)
60^1
"UP",60,60.01,0)
60.01
"UP",68.2,68.23,-1)
68.2^10
"UP",68.2,68.23,0)
68.23
"VER")
8.0^22.0
"^DD",60,60.01,13,0)
USE FOR REFERENCE TESTING^S^0:NO;1:YES;^.1;1^Q
"^DD",60,60.01,13,3)
Should reference values/units for this specimen type also be used for reference lab results.
"^DD",60,60.01,13,21,0)
^.001^3^3^3030212^^
"^DD",60,60.01,13,21,1,0)
Indicates if the reference ranges and units associated with this
"^DD",60,60.01,13,21,2,0)
specimen type can be used when manually entering results of testing
"^DD",60,60.01,13,21,3,0)
performed at another laboratory.
"^DD",60,60.01,13,"DT")
3030211
"^DD",61,61,.09,0)
LEDI HL7^*P64.061'^LAB(64.061,^0;9^S DIC("S")="I $P(^(0),U,7)=""S"",$P(^(0),U,5)=""0070"",$P(^(0),U,3)'=""""" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",61,61,.09,1,0)
^.1
"^DD",61,61,.09,1,1,0)
61^HL7^MUMPS
"^DD",61,61,.09,1,1,1)
I $P(^LAB(64.061,X,0),U,3)'="" S:X'="" ^LAB(61,"HL7",$P(^LAB(64.061,X,0),U,3),DA)=""
"^DD",61,61,.09,1,1,2)
I $P(^LAB(64.061,X,0),U,3)'="" K:X'="" ^LAB(61,"HL7",$P(^LAB(64.061,X,0),U,3),DA)
"^DD",61,61,.09,1,1,"%D",0)
^^7^7^2981211^^
"^DD",61,61,.09,1,1,"%D",1,0)
This cross reference is used to map incoming HL7 specimen codes to an
"^DD",61,61,.09,1,1,"%D",2,0)
entry in the LAB ELECTRONIC CODES file (#64.061).  The cross reference is
"^DD",61,61,.09,1,1,"%D",3,0)
set with the following format:
"^DD",61,61,.09,1,1,"%D",4,0)
 
"^DD",61,61,.09,1,1,"%D",5,0)
 S ^LAB(61,"HL7",HL7 ABBR,DA)=""
"^DD",61,61,.09,1,1,"%D",6,0)
 
"^DD",61,61,.09,1,1,"%D",7,0)
HL7 ABBR is Field (#2) in the LAB ELECTRONIC CODES file (#64.061).
"^DD",61,61,.09,1,1,"DT")
2981211
"^DD",61,61,.09,3)
This field contains the standard HL7 specimen type code.
"^DD",61,61,.09,12)
Limits the selection of only Specimen type codes with approved HL7 specimen codes.
"^DD",61,61,.09,12.1)
S DIC("S")="I $P(^(0),U,7)=""S"",$P(^(0),U,5)=""0070"",$P(^(0),U,3)'="""""
"^DD",61,61,.09,21,0)
^^1^1^2970721^^^
"^DD",61,61,.09,21,1,0)
This field contains the HL7 standard specimen type code.
"^DD",61,61,.09,"DT")
3030603
"^DD",68.2,68.23,2.3,0)
DEFAULT REFERENCE LABORATORY^P4'^DIC(4,^0;5^Q
"^DD",68.2,68.23,2.3,3)
Specify the default performing laboratory for this profile.
"^DD",68.2,68.23,2.3,21,0)
^^3^3^3040423^^
"^DD",68.2,68.23,2.3,21,1,0)
The performing laboratory that is commonly associated with this profile.
"^DD",68.2,68.23,2.3,21,2,0)
It will be presented as the default performing laboratory when a user
"^DD",68.2,68.23,2.3,21,3,0)
is setting up a verifying session using this profile.
"^DD",68.2,68.23,2.3,"DT")
3040423
"^DD",69.6,69.6,0)
FIELD^^.06^29
"^DD",69.6,69.6,0,"DDA")
N
"^DD",69.6,69.6,0,"DT")
3040224
"^DD",69.6,69.6,0,"ID","W1")
N LRX S LRX=^(0) D EN^DDIOL("Pat ID: "_$P(LRX,U,9)_"  DOB: "_$$FMTE^XLFDT($P(LRX,U,3),1)_"  Sex: "_$$EXTERNAL^DILFD(69.6,.02,"",$P(LRX,U,2)),,"!")
"^DD",69.6,69.6,0,"ID","W2")
N LRX S LRX=^(0) D EN^DDIOL("Spec ID: "_$P(LRX,U,6)_"  Manifest: "_$P(LRX,U,14)_"  Site: "_$$EXTERNAL^DILFD(69.6,1,"",$P(LRX,U,4)),,"!")
"^DD",69.6,69.6,0,"IX","AC",69.6,2)

"^DD",69.6,69.6,0,"IX","AD",69.6,18)

"^DD",69.6,69.6,0,"IX","AE",69.6,2)

"^DD",69.6,69.6,0,"IX","AF",69.6,3)

"^DD",69.6,69.6,0,"IX","B",69.6,.01)

"^DD",69.6,69.6,0,"IX","C",69.6,.09)

"^DD",69.6,69.6,0,"IX","D",69.6,18)

"^DD",69.6,69.6,0,"IX","E",69.6,3)

"^DD",69.6,69.6,0,"IX","RST",69.6,1)

"^DD",69.6,69.6,0,"IX","RST1",69.6,3)

"^DD",69.6,69.6,0,"NM","LAB PENDING ORDERS ENTRY")

"^DD",69.6,69.6,0,"VRPK")
LR
"^DD",69.6,69.6,.01,0)
NAME^RF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<3)!(X?1P.E)!(X'?1U.ANP)!(X'[",") X I $D(X) S X=$$LRPNM^LRAFUNC(X) K:$L(X)>30!($L(X)>30) X
"^DD",69.6,69.6,.01,1,0)
^.1
"^DD",69.6,69.6,.01,1,1,0)
69.6^B
"^DD",69.6,69.6,.01,1,1,1)
S ^LRO(69.6,"B",$E(X,1,30),DA)=""
"^DD",69.6,69.6,.01,1,1,2)
K ^LRO(69.6,"B",$E(X,1,30),DA)
"^DD",69.6,69.6,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",69.6,69.6,.02,0)
SEX^S^M:MALE;F:FEMALE;U:UNKNOWN;^0;2^Q
"^DD",69.6,69.6,.02,3)

"^DD",69.6,69.6,.02,"DT")
2970209
"^DD",69.6,69.6,.03,0)
DOB^D^^0;3^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",69.6,69.6,.03,"DT")
2961113
"^DD",69.6,69.6,.06,0)
RACE^F^^.1;1^K:$L(X)>60!($L(X)<1) X
"^DD",69.6,69.6,.06,3)
Answer must be 1-60 characters in length.
"^DD",69.6,69.6,.06,21,0)
^^1^1^3040224^
"^DD",69.6,69.6,.06,21,1,0)
Stores the patient's race using HL7 code and text.
"^DD",69.6,69.6,.06,"DT")
3040224
"^DD",69.6,69.6,.09,0)
PAT ID^F^^0;9^K:$L(X)>30!($L(X)<5) X
"^DD",69.6,69.6,.09,1,0)
^.1
"^DD",69.6,69.6,.09,1,1,0)
69.6^C
"^DD",69.6,69.6,.09,1,1,1)
S ^LRO(69.6,"C",$E(X,1,30),DA)=""
"^DD",69.6,69.6,.09,1,1,2)
K ^LRO(69.6,"C",$E(X,1,30),DA)
"^DD",69.6,69.6,.09,1,1,"DT")
2961125
"^DD",69.6,69.6,.09,3)
Answer must be 5-30 characters in length.
"^DD",69.6,69.6,.09,"DT")
2991208
"^DD",69.6,69.6,1,0)
ORDERING SITE^P4'^DIC(4,^0;4^Q
"^DD",69.6,69.6,1,1,0)
^.1
"^DD",69.6,69.6,1,1,1,0)
69.6^RST^MUMPS
"^DD",69.6,69.6,1,1,1,1)
S:($P(^LRO(69.6,DA,0),U,4)'="")&($P(^(0),U,6)'="") ^LRO(69.6,"RST",$P(^(0),U,4),$P(^(0),U,6),DA)=""
"^DD",69.6,69.6,1,1,1,2)
K:$P(^LRO(69.6,DA,0),U,6)'="" ^LRO(69.6,"RST",X,$P(^(0),U,6),DA)
"^DD",69.6,69.6,1,1,1,"%D",0)
^^6^6^2970602^
"^DD",69.6,69.6,1,1,1,"%D",1,0)
The format is as follows:
"^DD",69.6,69.6,1,1,1,"%D",2,0)
^LRO(69.6,"RST",ORDERING SITE,ORDERING SITE UID,DA)=""
"^DD",69.6,69.6,1,1,1,"%D",3,0)
 
"^DD",69.6,69.6,1,1,1,"%D",4,0)
This cross reference is used to identify unique id's by ordering site. The
"^DD",69.6,69.6,1,1,1,"%D",5,0)
cross reference is useful for packaging multiple results for a site into
"^DD",69.6,69.6,1,1,1,"%D",6,0)
one message.
"^DD",69.6,69.6,1,1,1,"DT")
2970520
"^DD",69.6,69.6,1,"DT")
2970520
"^DD",69.6,69.6,2,0)
COLLECTING SITE^P4'^DIC(4,^0;5^Q
"^DD",69.6,69.6,2,1,0)
^.1
"^DD",69.6,69.6,2,1,1,0)
69.6^AC^MUMPS
"^DD",69.6,69.6,2,1,1,1)
S ^LRO(69.6,"AC",$P(^LRO(69.6,DA,0),U,4),$P(^(0),U,5),DA)=""
"^DD",69.6,69.6,2,1,1,2)
K ^LRO(69.6,"AC",$P(^LRO(69.6,DA,0),U,4),$P(^(0),U,5),DA)
"^DD",69.6,69.6,2,1,1,"%D",0)
^^4^4^2970616^
"^DD",69.6,69.6,2,1,1,"%D",1,0)
This MUMPS cross reference is used to sort pending orders for an ordering
"^DD",69.6,69.6,2,1,1,"%D",2,0)
site by collecting site.  The format is shown below.
"^DD",69.6,69.6,2,1,1,"%D",3,0)
 
"^DD",69.6,69.6,2,1,1,"%D",4,0)
 ^LRO(69.6,"AC",ORDERING SITE (pointer),COLLECTING SITE (pointer),IEN) = ""
"^DD",69.6,69.6,2,1,1,"DT")
2961125
"^DD",69.6,69.6,2,1,2,0)
69.6^AE^MUMPS
"^DD",69.6,69.6,2,1,2,1)
S ^LRO(69.6,"AE",$P(^LRO(69.6,DA,0),U,5),DA)=""
"^DD",69.6,69.6,2,1,2,2)
K ^LRO(69.6,"AE",$P(^LRO(69.6,DA,0),U,5),DA)
"^DD",69.6,69.6,2,1,2,"%D",0)
^^4^4^2970616^
"^DD",69.6,69.6,2,1,2,"%D",1,0)
This MUMPS cross reference is used to sort pending orders by collecting
"^DD",69.6,69.6,2,1,2,"%D",2,0)
site.  The format is shown below.
"^DD",69.6,69.6,2,1,2,"%D",3,0)
 
"^DD",69.6,69.6,2,1,2,"%D",4,0)
   ^LRO(69.6,"AE",COLLECTING SITE (pointer),IEN) = ""
"^DD",69.6,69.6,2,1,2,"DT")
2970215
"^DD",69.6,69.6,2,3)

"^DD",69.6,69.6,2,"DT")
2970226
"^DD",69.6,69.6,3,0)
ORDERING SITE UID^F^^0;6^K:$L(X)>30!($L(X)<1) X
"^DD",69.6,69.6,3,1,0)
^.1
"^DD",69.6,69.6,3,1,1,0)
69.6^E
"^DD",69.6,69.6,3,1,1,1)
S ^LRO(69.6,"E",$E(X,1,30),DA)=""
"^DD",69.6,69.6,3,1,1,2)
K ^LRO(69.6,"E",$E(X,1,30),DA)
"^DD",69.6,69.6,3,1,1,"DT")
3020412
"^DD",69.6,69.6,3,1,2,0)
69.6^RST1^MUMPS
"^DD",69.6,69.6,3,1,2,1)
S:($P(^LRO(69.6,DA,0),U,4)'="")&($P(^(0),U,6)'="") ^LRO(69.6,"RST",$P(^(0),U,4),$P(^(0),U,6),DA)=""
"^DD",69.6,69.6,3,1,2,2)
K:$P(^LRO(69.6,DA,0),U,4)'="" ^LRO(69.6,"RST",$P(^(0),U,4),X,DA)
"^DD",69.6,69.6,3,1,2,"%D",0)
^^6^6^2970602^
"^DD",69.6,69.6,3,1,2,"%D",1,0)
The format is as follows:
"^DD",69.6,69.6,3,1,2,"%D",2,0)
^LRO(69.6,"RST",ORDERING SITE,ORDERING SITE UID,DA)=""
"^DD",69.6,69.6,3,1,2,"%D",3,0)
 
"^DD",69.6,69.6,3,1,2,"%D",4,0)
This cross reference is used to identify unique id's by ordering site.
"^DD",69.6,69.6,3,1,2,"%D",5,0)
The cross reference is useful for packaging multiple results for a site
"^DD",69.6,69.6,3,1,2,"%D",6,0)
into one message.
"^DD",69.6,69.6,3,1,2,"DT")
2970520
"^DD",69.6,69.6,3,1,3,0)
69.6^AF^MUMPS
"^DD",69.6,69.6,3,1,3,1)
S LRX=$P(^LRO(69.6,DA,0),U,14) I $L(LRX) S ^LRO(69.6,"AD",LRX,X,DA)=""
"^DD",69.6,69.6,3,1,3,2)
S LRX=$P(^LRO(69.6,DA,0),U,14) I $L(LRX) K ^LRO(69.6,"AD",LRX,X,DA)
"^DD",69.6,69.6,3,1,3,"%D",0)
^^4^4^2970616^
"^DD",69.6,69.6,3,1,3,"%D",1,0)
This MUMPS cross reference is used to sort pending orders for a shipping
"^DD",69.6,69.6,3,1,3,"%D",2,0)
manifest by ordering site UID.  The format is shown below.
"^DD",69.6,69.6,3,1,3,"%D",3,0)
 
"^DD",69.6,69.6,3,1,3,"%D",4,0)
   ^LRO(69.6,"AD",SHIPPING MANIFEST,ORDERING SITE UID,IEN) = ""
"^DD",69.6,69.6,3,1,3,"DT")
2970520
"^DD",69.6,69.6,3,3)
Answer must be 1-30 characters in length.
"^DD",69.6,69.6,3,"DT")
3020412
"^DD",69.6,69.6,3.2,0)
ORDERING SITE ACC #^F^^0;12^K:$L(X)>20!($L(X)<1) X
"^DD",69.6,69.6,3.2,3)
Answer must be 1-20 characters in length.
"^DD",69.6,69.6,3.2,"DT")
2991208
"^DD",69.6,69.6,4,0)
SPECIMEN^P61'^LAB(61,^0;7^Q
"^DD",69.6,69.6,4,"DT")
2961113
"^DD",69.6,69.6,5,0)
COLLECTION SAMPLE^P62'^LAB(62,^0;8^Q
"^DD",69.6,69.6,5,"DT")
2961113
"^DD",69.6,69.6,6,0)
SPECIMEN STATUS^*P64.061'^LAB(64.061,^0;10^S DIC("S")="I $P(^(0),U,7)=""U""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",69.6,69.6,6,3)

"^DD",69.6,69.6,6,12)
ALLOWS ONLY THE SELECTION OF A STATUS
"^DD",69.6,69.6,6,12.1)
S DIC("S")="I $P(^(0),U,7)=""U"""
"^DD",69.6,69.6,6,"DT")
2970529
"^DD",69.6,69.6,7,0)
FILE REF^P67'^LRT(67,^0;11^Q
"^DD",69.6,69.6,7,"DT")
2970227
"^DD",69.6,69.6,9,0)
VISIT NUMBER^NJ8,0^^0;13^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",69.6,69.6,9,3)
Type a Number between 1 and 99999999, 0 Decimal Digits
"^DD",69.6,69.6,9,"DT")
2961126
"^DD",69.6,69.6,10,0)
ORDERED DATE/TIME^D^^1;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",69.6,69.6,10,"DT")
2961114
"^DD",69.6,69.6,11,0)
COLLECTED DATE/TIME^D^^1;2^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",69.6,69.6,11,"DT")
2961114
"^DD",69.6,69.6,11.1,0)
COLLECTION END DATE/TIME^D^^1;9^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",69.6,69.6,11.1,3)
Enter the date/time that the specimen collection ended.
"^DD",69.6,69.6,11.1,21,0)
^^3^3^3010425^
"^DD",69.6,69.6,11.1,21,1,0)
Used to record the collection end date/time of specimen collection
"^DD",69.6,69.6,11.1,21,2,0)
when the specimen has a timed collection, i.e. 24 hour urine,
"^DD",69.6,69.6,11.1,21,3,0)
72 hour stool, etc.
"^DD",69.6,69.6,11.1,"DT")
3010425
"^DD",69.6,69.6,12,0)
SHIPPED DATE/TIME^D^^1;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",69.6,69.6,12,"DT")
2961114
"^DD",69.6,69.6,13,0)
RECD DATE/TIME^D^^1;4^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",69.6,69.6,13,"DT")
2961114
"^DD",69.6,69.6,14,0)
TRANS DATE/TIME^D^^1;5^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",69.6,69.6,14,"DT")
2961114
"^DD",69.6,69.6,15,0)
DATA ACCEPT DATE/TIME^D^^1;6^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",69.6,69.6,15,"DT")
2961114
"^DD",69.6,69.6,16,0)
COMPLETE DATE/TIME^D^^1;7^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",69.6,69.6,16,"DT")
2961114
"^DD",69.6,69.6,17,0)
INCOMING MESS #^F^^1;8^K:$L(X)>15!($L(X)<1) X
"^DD",69.6,69.6,17,3)
Answer must be 1-15 characters in length.
"^DD",69.6,69.6,17,"DT")
2961125
"^DD",69.6,69.6,18,0)
SHIPPING MANIFEST^F^^0;14^K:$L(X)>30!($L(X)<3) X
"^DD",69.6,69.6,18,1,0)
^.1
"^DD",69.6,69.6,18,1,1,0)
69.6^AD^MUMPS
"^DD",69.6,69.6,18,1,1,1)
S LRX=$P(^LRO(69.6,DA,0),U,6) I $L(LRX) S ^LRO(69.6,"AD",X,LRX,DA)=""
"^DD",69.6,69.6,18,1,1,2)
S LRX=$P(^LRO(69.6,DA,0),U,6) I $L(LRX) K ^LRO(69.6,"AD",X,LRX,DA)
"^DD",69.6,69.6,18,1,1,"%D",0)
^^4^4^2970616^
"^DD",69.6,69.6,18,1,1,"%D",1,0)
This MUMPS cross reference is used to sort pending orders for a shipping
"^DD",69.6,69.6,18,1,1,"%D",2,0)
manifest by ordering site UID.  The format is shown below.
"^DD",69.6,69.6,18,1,1,"%D",3,0)
 
"^DD",69.6,69.6,18,1,1,"%D",4,0)
   ^LRO(69.6,"AD",SHIPPING MANIFEST,ORDERING SITE UID,IEN) = ""
"^DD",69.6,69.6,18,1,1,"DT")
2970517
"^DD",69.6,69.6,18,1,2,0)
69.6^D
"^DD",69.6,69.6,18,1,2,1)
S ^LRO(69.6,"D",$E(X,1,30),DA)=""
"^DD",69.6,69.6,18,1,2,2)
K ^LRO(69.6,"D",$E(X,1,30),DA)
"^DD",69.6,69.6,18,1,2,"%D",0)
^^1^1^2970821^
"^DD",69.6,69.6,18,1,2,"%D",1,0)
 This X-Ref is used to allow FileMan lookup on shipping manifest numbers.
"^DD",69.6,69.6,18,1,2,"DT")
2970821
"^DD",69.6,69.6,18,3)
Enter in the 3-30 character invoice number of the shipped specimen.
"^DD",69.6,69.6,18,21,0)
^^2^2^2970502^
"^DD",69.6,69.6,18,21,1,0)
This field should contain the invoice number from the collection labs
"^DD",69.6,69.6,18,21,2,0)
SHIPPING MANIFEST file.
"^DD",69.6,69.6,18,"DT")
2970821
"^DD",69.6,69.6,20,0)
ORDERED TESTS^69.64A^^2;0
"^DD",69.6,69.6,99,0)
COMMENTS^69.699^^99;0
"^DD",69.6,69.6,700,0)
HL ENCODING CHARACTERS^F^^700;E1,5^K:$L(X)>5!($L(X)<1) X
"^DD",69.6,69.6,700,3)
Answer must be 1-5 characters in length
"^DD",69.6,69.6,700,10)
HL7 ORM order message
"^DD",69.6,69.6,700,21,0)
^^4^4^3010904^^^
"^DD",69.6,69.6,700,21,1,0)
Stores the HL7 field separator and encoding characters from the
"^DD",69.6,69.6,700,21,2,0)
HL7 message used to create this pending order entry. This allows
"^DD",69.6,69.6,700,21,3,0)
the HL7 data that is saved from the message to be processed and
"^DD",69.6,69.6,700,21,4,0)
returned to the placer.
"^DD",69.6,69.6,700,"DT")
3010904
"^DD",69.6,69.6,700.02,0)
HL PID-2^F^^700.02;E1,250^K:$L(X)>250!($L(X)<1) X
"^DD",69.6,69.6,700.02,3)
Answer must be 1-250 characters in length
"^DD",69.6,69.6,700.02,10)
HL7 ORM order message
"^DD",69.6,69.6,700.02,21,0)
^^2^2^3010904^^^
"^DD",69.6,69.6,700.02,21,1,0)
Stores the placer's patient identification information from PID-2
"^DD",69.6,69.6,700.02,21,2,0)
for transmittal back to the placer when the order is completed.
"^DD",69.6,69.6,700.02,"DT")
3030221
"^DD",69.6,69.6,700.04,0)
HL PID-4^F^^700.04;E1,250^K:$L(X)>250!($L(X)<1) X
"^DD",69.6,69.6,700.04,3)
Answer must be 1-250 characters in length
"^DD",69.6,69.6,700.04,10)
HL7 ORM order message
"^DD",69.6,69.6,700.04,21,0)
^^2^2^3010831^^
"^DD",69.6,69.6,700.04,21,1,0)
Stores the placer's patient identification information from PID-4
"^DD",69.6,69.6,700.04,21,2,0)
for transmittal back to the placer when the order is completed. 
"^DD",69.6,69.6,700.04,"DT")
3030221
"^DD",69.6,69.64,0)
ORDERED TESTS SUB-FIELD^^700.19^16
"^DD",69.6,69.64,0,"DT")
3020503
"^DD",69.6,69.64,0,"IX","B",69.64,.01)

"^DD",69.6,69.64,0,"IX","C",69.64,1)

"^DD",69.6,69.64,0,"NM","ORDERED TESTS")

"^DD",69.6,69.64,0,"UP")
69.6
"^DD",69.6,69.64,.01,0)
NLT TEST^F^^0;1^K:$L(X)>60!($L(X)<1) X
"^DD",69.6,69.64,.01,1,0)
^.1
"^DD",69.6,69.64,.01,1,1,0)
69.64^B
"^DD",69.6,69.64,.01,1,1,1)
S ^LRO(69.6,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",69.6,69.64,.01,1,1,2)
K ^LRO(69.6,DA(1),2,"B",$E(X,1,30),DA)
"^DD",69.6,69.64,.01,3)
Answer must be 1-60 characters in length.
"^DD",69.6,69.64,.01,"DT")
2970523
"^DD",69.6,69.64,1,0)
NLT CODE^F^^0;2^K:$L(X)>15!($L(X)<5) X
"^DD",69.6,69.64,1,1,0)
^.1
"^DD",69.6,69.64,1,1,1,0)
69.64^C
"^DD",69.6,69.64,1,1,1,1)
S ^LRO(69.6,DA(1),2,"C",$E(X,1,30),DA)=""
"^DD",69.6,69.64,1,1,1,2)
K ^LRO(69.6,DA(1),2,"C",$E(X,1,30),DA)
"^DD",69.6,69.64,1,1,1,"DT")
2970218
"^DD",69.6,69.64,1,3)
Answer must be 5-15 characters in length.
"^DD",69.6,69.64,1,"DT")
2970218
"^DD",69.6,69.64,2,0)
REMOTE TEST NAME^F^^0;3^K:$L(X)>50!($L(X)<2) X
"^DD",69.6,69.64,2,3)
Answer must be 2-50 characters in length.
"^DD",69.6,69.64,2,"DT")
2970218
"^DD",69.6,69.64,3,0)
REMOTE TEST #^F^^0;4^K:$L(X)>10!($L(X)<1) X
"^DD",69.6,69.64,3,3)
Answer must be 1-10 characters in length.
"^DD",69.6,69.64,3,"DT")
2970218
"^DD",69.6,69.64,4,0)
REMOTE URGENCY^F^^0;5^K:$L(X)>10!($L(X)<1) X
"^DD",69.6,69.64,4,3)
Answer must be 1-10 characters in length.
"^DD",69.6,69.64,4,10)
HL7 ORM order message
"^DD",69.6,69.64,4,21,0)
^^1^1^3010831^
"^DD",69.6,69.64,4,21,1,0)
Stores the HL7 test urgency from the placer's order message.
"^DD",69.6,69.64,4,"DT")
3010904
"^DD",69.6,69.64,5,0)
TEST STATUS^*P64.061'^LAB(64.061,^0;6^S DIC("S")="I $P(^(0),U,7)=""U""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",69.6,69.64,5,3)

"^DD",69.6,69.64,5,12)
ALLOWS ONLY THE SELECTION OF STATUS
"^DD",69.6,69.64,5,12.1)
S DIC("S")="I $P(^(0),U,7)=""U"""
"^DD",69.6,69.64,5,"DT")
2970529
"^DD",69.6,69.64,7,0)
OUT GOING MESS #^F^^0;8^K:$L(X)>20!($L(X)<1) X
"^DD",69.6,69.64,7,3)
Answer must be 1-20 characters in length.
"^DD",69.6,69.64,7,"DT")
2970218
"^DD",69.6,69.64,8,0)
ACCESSION D/T^D^^0;7^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",69.6,69.64,8,"DT")
2970518
"^DD",69.6,69.64,9,0)
HOST UID^F^^0;9^K:$L(X)>15!($L(X)<5) X
"^DD",69.6,69.64,9,3)
Answer must be 5-15 characters in length.
"^DD",69.6,69.64,9,"DT")
2970518
"^DD",69.6,69.64,10,0)
COMPLETE D/T^D^^0;10^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",69.6,69.64,10,"DT")
2970519
"^DD",69.6,69.64,11,0)
HOST TEST^P60'^LAB(60,^0;11^Q
"^DD",69.6,69.64,11,3)
Enter the host's laboratory test which corresponds to the remote's ordered test.
"^DD",69.6,69.64,11,21,0)
^^6^6^3010904^^^
"^DD",69.6,69.64,11,21,1,0)
This field stores the host's file 60 test which should be ordered
"^DD",69.6,69.64,11,21,2,0)
when processing referral lab orders. It's built by the LEDI software
"^DD",69.6,69.64,11,21,3,0)
when processing the HL7 ORM order message. Based on the test code
"^DD",69.6,69.64,11,21,4,0)
from the message and the corresponding shipping configuration 
"^DD",69.6,69.64,11,21,5,0)
associated with the placer, the appropriate host test is selected
"^DD",69.6,69.64,11,21,6,0)
and stored in this field.
"^DD",69.6,69.64,11,"DT")
3010904
"^DD",69.6,69.64,12,0)
HOST URGENCY^*P62.05'^LAB(62.05,^0;12^S DIC("S")="I Y<50" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",69.6,69.64,12,3)
Enter the urgency to order this test at the host site.
"^DD",69.6,69.64,12,12)
Only non-workload urgencies can be selected.
"^DD",69.6,69.64,12,12.1)
S DIC("S")="I Y<50"
"^DD",69.6,69.64,12,21,0)
^^5^5^3010904^^^^
"^DD",69.6,69.64,12,21,1,0)
This field stores the host's local urgency which should be used 
"^DD",69.6,69.64,12,21,2,0)
when processing referral lab orders. It's built by the LEDI software
"^DD",69.6,69.64,12,21,3,0)
when processing the HL7 ORM order message. Based on the HL7 urgency
"^DD",69.6,69.64,12,21,4,0)
from the message and the corresponding shipping configuration the
"^DD",69.6,69.64,12,21,5,0)
appropriate host urgency for the order is determined.
"^DD",69.6,69.64,12,"DT")
3010904
"^DD",69.6,69.64,13,0)
ORDERING PROVIDER^F^^1;1^K:$L(X)>40!($L(X)<1) X
"^DD",69.6,69.64,13,3)
Answer must be 1-40 characters in length.
"^DD",69.6,69.64,13,10)
HL7 ORM order message
"^DD",69.6,69.64,13,21,0)
^^3^3^3010904^^^
"^DD",69.6,69.64,13,21,1,0)
The name of the provider ordering this test. It is derived from
"^DD",69.6,69.64,13,21,2,0)
the HL7 ORM order message and contains the human readable name
"^DD",69.6,69.64,13,21,3,0)
of the ordering provider.
"^DD",69.6,69.64,13,"DT")
3010904
"^DD",69.6,69.64,700.04,0)
HL OBR-4^F^^700.04;E1,200^K:$L(X)>200!($L(X)<1) X
"^DD",69.6,69.64,700.04,.1)
UNIVERSAL SERVICE ID
"^DD",69.6,69.64,700.04,3)
Answer must be 1-200 characters in length
"^DD",69.6,69.64,700.04,10)
HL7 ORM order message
"^DD",69.6,69.64,700.04,21,0)
^^1^1^3010904^^^
"^DD",69.6,69.64,700.04,21,1,0)
The placer's specimen identifier from the HL7 ORM order message.
"^DD",69.6,69.64,700.04,"DT")
3010904
"^DD",69.6,69.64,700.18,0)
HL OBR-18^F^^700.18;E1,60^K:$L(X)>60!($L(X)<1) X
"^DD",69.6,69.64,700.18,.1)
PLACER FIELD 1
"^DD",69.6,69.64,700.18,3)
Answer must be 1-60 characters in length
"^DD",69.6,69.64,700.18,10)
HL7 ORM order message
"^DD",69.6,69.64,700.18,21,0)
^^5^5^3010904^^
"^DD",69.6,69.64,700.18,21,1,0)
Stores the placer's field #1 from the OBR segment of the HL7
"^DD",69.6,69.64,700.18,21,2,0)
ORM order message. This field is returned to the placer when
"^DD",69.6,69.64,700.18,21,3,0)
the HL7 ORU result message is created and transmitted to
"^DD",69.6,69.64,700.18,21,4,0)
the placer. The HL7 standard requires that the filler of an
"^DD",69.6,69.64,700.18,21,5,0)
order return to the placer the value of this field.
"^DD",69.6,69.64,700.18,"DT")
3010904
"^DD",69.6,69.64,700.19,0)
HL OBR-19^F^^700.19;E1,60^K:$L(X)>60!($L(X)<1) X
"^DD",69.6,69.64,700.19,.1)
PLACER FIELD 2
"^DD",69.6,69.64,700.19,3)
Answer must be 1-60 characters in length
"^DD",69.6,69.64,700.19,10)
HL7 ORM order message
"^DD",69.6,69.64,700.19,21,0)
^^5^5^3010904^^
"^DD",69.6,69.64,700.19,21,1,0)
Stores the placer's field #2 from the OBR segment of the HL7
"^DD",69.6,69.64,700.19,21,2,0)
ORM order message. This field is returned to the placer when
"^DD",69.6,69.64,700.19,21,3,0)
the HL7 ORU result message is created and transmitted to
"^DD",69.6,69.64,700.19,21,4,0)
the placer. The HL7 standard requires that the filler of an
"^DD",69.6,69.64,700.19,21,5,0)
order return to the placer the value of this field.
"^DD",69.6,69.64,700.19,"DT")
3010904
"^DD",69.6,69.699,0)
COMMENTS SUB-FIELD^^.01^1
"^DD",69.6,69.699,0,"NM","COMMENTS")

"^DD",69.6,69.699,0,"UP")
69.6
"^DD",69.6,69.699,.01,0)
COMMENTS^W^^0;1^Q
"^DD",69.6,69.699,.01,"DT")
2961125
"^DIC",69.6,69.6,0)
LAB PENDING ORDERS ENTRY^69.6I
"^DIC",69.6,69.6,0,"GL")
^LRO(69.6,
"^DIC",69.6,69.6,"%D",0)
^1.001^15^15^3020514^^
"^DIC",69.6,69.6,"%D",1,0)
Lab Orders Pending file serves as a temporary storage locations for
"^DIC",69.6,69.6,"%D",2,0)
electronic laboratory test orders. LEDI software populates and manages the
"^DIC",69.6,69.6,"%D",3,0)
contents of this file.
"^DIC",69.6,69.6,"%D",4,0)
 
"^DIC",69.6,69.6,"%D",5,0)
Electronic test orders from VA collecting sites are stored in this file
"^DIC",69.6,69.6,"%D",6,0)
until ordered test results have been returned. Electronic orders are
"^DIC",69.6,69.6,"%D",7,0)
matched with physically shipped specimen during accessioning process.
"^DIC",69.6,69.6,"%D",8,0)
Specimen processing status update information is also stored in this file
"^DIC",69.6,69.6,"%D",9,0)
to assist in the management of workload.
"^DIC",69.6,69.6,"%D",10,0)
 
"^DIC",69.6,69.6,"%D",11,0)
When the results have been stored in the collecting site's patient
"^DIC",69.6,69.6,"%D",12,0)
clinical record, entries will be purged from this file.
"^DIC",69.6,69.6,"%D",13,0)
 
"^DIC",69.6,69.6,"%D",14,0)
NOTE: The user should not directly edit this file via FileMan. Appropriate
"^DIC",69.6,69.6,"%D",15,0)
options are provided to manage the data in this file.
"^DIC",69.6,"B","LAB PENDING ORDERS ENTRY",69.6)

**END**
**END**
