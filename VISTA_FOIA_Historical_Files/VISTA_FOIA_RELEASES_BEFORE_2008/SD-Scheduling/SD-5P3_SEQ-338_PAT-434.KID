EMERGENCY Released SD*5.3*434 SEQ #338
Extracted from mail message
**KIDS**:SD*5.3*434^

**INSTALL NAME**
SD*5.3*434
"BLD",6096,0)
SD*5.3*434^SCHEDULING^0^3050325^y
"BLD",6096,1,0)
^^2^2^3050325^
"BLD",6096,1,1,0)
Appointment availability not being restored properly on cancelled 
"BLD",6096,1,2,0)
appointments.
"BLD",6096,4,0)
^9.64PA^^
"BLD",6096,"ABPKG")
n
"BLD",6096,"INID")
n^y
"BLD",6096,"INIT")
CHK^SD53P434
"BLD",6096,"KRN",0)
^9.67PA^8989.52^19
"BLD",6096,"KRN",.4,0)
.4
"BLD",6096,"KRN",.401,0)
.401
"BLD",6096,"KRN",.402,0)
.402
"BLD",6096,"KRN",.403,0)
.403
"BLD",6096,"KRN",.5,0)
.5
"BLD",6096,"KRN",.84,0)
.84
"BLD",6096,"KRN",3.6,0)
3.6
"BLD",6096,"KRN",3.8,0)
3.8
"BLD",6096,"KRN",9.2,0)
9.2
"BLD",6096,"KRN",9.8,0)
9.8
"BLD",6096,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6096,"KRN",9.8,"NM",1,0)
SDM2^^0^B19001975
"BLD",6096,"KRN",9.8,"NM",2,0)
SD53P434^^0^B4313410
"BLD",6096,"KRN",9.8,"NM","B","SD53P434",2)

"BLD",6096,"KRN",9.8,"NM","B","SDM2",1)

"BLD",6096,"KRN",19,0)
19
"BLD",6096,"KRN",19.1,0)
19.1
"BLD",6096,"KRN",101,0)
101
"BLD",6096,"KRN",409.61,0)
409.61
"BLD",6096,"KRN",771,0)
771
"BLD",6096,"KRN",870,0)
870
"BLD",6096,"KRN",8989.51,0)
8989.51
"BLD",6096,"KRN",8989.52,0)
8989.52
"BLD",6096,"KRN",8994,0)
8994
"BLD",6096,"KRN","B",.4,.4)

"BLD",6096,"KRN","B",.401,.401)

"BLD",6096,"KRN","B",.402,.402)

"BLD",6096,"KRN","B",.403,.403)

"BLD",6096,"KRN","B",.5,.5)

"BLD",6096,"KRN","B",.84,.84)

"BLD",6096,"KRN","B",3.6,3.6)

"BLD",6096,"KRN","B",3.8,3.8)

"BLD",6096,"KRN","B",9.2,9.2)

"BLD",6096,"KRN","B",9.8,9.8)

"BLD",6096,"KRN","B",19,19)

"BLD",6096,"KRN","B",19.1,19.1)

"BLD",6096,"KRN","B",101,101)

"BLD",6096,"KRN","B",409.61,409.61)

"BLD",6096,"KRN","B",771,771)

"BLD",6096,"KRN","B",870,870)

"BLD",6096,"KRN","B",8989.51,8989.51)

"BLD",6096,"KRN","B",8989.52,8989.52)

"BLD",6096,"KRN","B",8994,8994)

"BLD",6096,"QUES",0)
^9.62^^
"BLD",6096,"REQB",0)
^9.611^1^1
"BLD",6096,"REQB",1,0)
SD*5.3*356^2
"BLD",6096,"REQB","B","SD*5.3*356",1)

"INIT")
CHK^SD53P434
"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
434^3050325
"PKG",16,22,1,"PAH",1,1,0)
^^2^2^3050325
"PKG",16,22,1,"PAH",1,1,1,0)
Appointment availability not being restored properly on cancelled 
"PKG",16,22,1,"PAH",1,1,2,0)
appointments.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","SD53P434")
0^2^B4313410
"RTN","SD53P434",1,0)
SD53P434 ; 
"RTN","SD53P434",2,0)
 ;;5.3;SCHEDULING;**434**;MAR 25,2005
"RTN","SD53P434",3,0)
 ;
"RTN","SD53P434",4,0)
 ;
"RTN","SD53P434",5,0)
 Q
"RTN","SD53P434",6,0)
CHK ;
"RTN","SD53P434",7,0)
 N SC,DPTDFN,DPTSC,SDSCDTE,SDAPCNT,STR,I,S,SD,SDCR,SDPRG,SL1
"RTN","SD53P434",8,0)
 N SS,ST,X,Y,%,X1,X2
"RTN","SD53P434",9,0)
 S SC=0,DPTDFN="",DPTSC=""
"RTN","SD53P434",10,0)
 F  S SC=$O(^SC(SC)) Q:+SC=0  D
"RTN","SD53P434",11,0)
 .S SDSCDTE=3050222 F  S SDSCDTE=$O(^SC(SC,"S",SDSCDTE)) Q:SDSCDTE=""  D
"RTN","SD53P434",12,0)
 ..S SDAPCNT=0 F  S SDAPCNT=$O(^SC(SC,"S",SDSCDTE,1,SDAPCNT)) Q:SDAPCNT=""  D
"RTN","SD53P434",13,0)
 ...S DPTDFN=$P($G(^SC(SC,"S",SDSCDTE,1,SDAPCNT,0)),"^",1)
"RTN","SD53P434",14,0)
 ...I $G(DPTDFN)'="" D
"RTN","SD53P434",15,0)
 ....S DPTSC=$P($G(^DPT(DPTDFN,"S",SDSCDTE,0)),"^",1)
"RTN","SD53P434",16,0)
 ....I $G(DPTSC)'=SC D DEL Q
"RTN","SD53P434",17,0)
 Q
"RTN","SD53P434",18,0)
DEL ;
"RTN","SD53P434",19,0)
 ;This section of code was taken from SDM2 with some modifications.
"RTN","SD53P434",20,0)
 S STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz"
"RTN","SD53P434",21,0)
 S I=SC
"RTN","SD53P434",22,0)
 S (S,SD)=SDSCDTE
"RTN","SD53P434",23,0)
 S SL1=$P(^SC(I,"S",S,1,SDAPCNT,0),"^",2)
"RTN","SD53P434",24,0)
 K ^SC(I,"S",S,1,SDAPCNT)
"RTN","SD53P434",25,0)
 I '$D(^SC(I,"ST",$P(SD,"."),1)) Q
"RTN","SD53P434",26,0)
 S SD1(1)=^SC(I,"SL"),SD1=$P(SD1(1),"^",3),SB1=$S(SD1:SD1,1:8)-1/100
"RTN","SD53P434",27,0)
 S SD1=$P(SD1(1),"^",6),HSI1=$S(SD1:SD1,1:4)
"RTN","SD53P434",28,0)
 S SI1=$S(SD1="":4,SD1<3:4,SD1:SD1,1:4),SDDIF1=$S(HSI1<3:8/HSI1,1:2)
"RTN","SD53P434",29,0)
 K SD1
"RTN","SD53P434",30,0)
 S S=^SC(I,"ST",$P(SD,"."),1),SDQ=SD#1-SB1*100
"RTN","SD53P434",31,0)
 S ST=SDQ#1*SI1\.6+($P(SDQ,".")*SI1),SS=SL1*HSI1/60
"RTN","SD53P434",32,0)
 I SDQ'<1 F I=ST+ST:SDDIF1 S SDQ=$E(STR,$F(STR,$E(S,I+1))) Q:SDQ=""  S S=$E(S,1,I)_SDQ_$E(S,I+2,999),SS=SS-1 Q:SS'>0
"RTN","SD53P434",33,0)
 S ^SC(SC,"ST",$P(SDSCDTE,"."),1)=S K SL1,SB1,SDDIF1,HSI1,SI1,SDQ
"RTN","SD53P434",34,0)
 D NOW^%DTC S (SDCR,X1)=%,X2=120 D C^%DTC S SDPRG=X
"RTN","SD53P434",35,0)
 S ^XTMP("SD53P434",0)=SDPRG_"^"_SDCR
"RTN","SD53P434",36,0)
 S ^XTMP("SD53P434",SC,SDSCDTE,DPTDFN)=""
"RTN","SD53P434",37,0)
 S Y=SDSCDTE D DD^%DT
"RTN","SD53P434",38,0)
 W !,"Availablility fixed for "_$P($G(^SC(SC,0)),"^")_" on "_Y
"RTN","SD53P434",39,0)
 Q
"RTN","SDM2")
0^1^B19001975
"RTN","SDM2",1,0)
SDM2 ;SF/GFT - MAKE APPOINTMENT ; 07 Jan 2000  6:30 PM
"RTN","SDM2",2,0)
 ;;5.3;Scheduling;**32,132,168,356,434**;Aug 13, 1993
"RTN","SDM2",3,0)
 W *7,!,"PATIENT ALREADY HAS APPOINTMENT "
"RTN","SDM2",4,0)
 N SDATA,SDCMHDL ; for evt dvr
"RTN","SDM2",5,0)
 I $D(^DPT(DFN,"S",SD,0)),$P(^(0),"^",2)'["C" S S=SD,I=+^(0) D FLEN W "(",APL," MINUTES) THEN" D IN,PROT G:$D(SDPROT) ^SDM1 R ".",!,"  DO YOU WANT TO CANCEL IT? ",X:DTIME S X=$$UP^XLFSTR(X) D:X?1"Y".A STAT G CAN:X?1"Y".A W "??",*7 G ^SDM1
"RTN","SDM2",6,0)
SDAY S %=1 W "ON THE SAME DAY (" D AT,IN W ") ...OK" D YN^DICN I '% W !,"RESPOND YES OR NO",!,"PATIENT ALREADY HAS APPOINTMENT " G SDAY
"RTN","SDM2",7,0)
 G ^SDM1:(%-1),PRECAN^SDM1
"RTN","SDM2",8,0)
 ;
"RTN","SDM2",9,0)
CAN Q:'$D(^SC(I,"SL"))  S SCI=I,DIV=$S($P(^SC(I,0),"^",15)]"":" "_$P(^(0),"^",15),1:" 1") I $D(^DPT("ASDPSD","C",DIV,I,S,DFN)) K ^(DFN)
"RTN","SDM2",10,0)
 S SD17=$P(^DPT(DFN,"S",S,0),"^") K ^SC("ARAD",I,S,DFN) S (DA,SDSY)=0 F SDSX=0:0 S SDSX=$O(^SC(I,"S",S,1,SDSX)) Q:'SDSX  Q:'$D(^(SDSX,0))  D C Q:SDSY&(DA)
"RTN","SDM2",11,0)
 I $D(^DPT("ASDPSD","B",DIV,$P(S,"."),DFN)) D CK1
"RTN","SDM2",12,0)
 G OUT:'SDSY S SL1=$P(^SC(I,"S",S,1,SDSY,0),U,2) I DA,'$D(^("OB")) K ^SC(I,"S",S,1,DA,"OB")
"RTN","SDM2",13,0)
 S SDRT="D",SDTTM=SD,SDPL=SDSY,SDSC=I D RT^SDUTL
"RTN","SDM2",14,0)
 I I'=SC D
"RTN","SDM2",15,0)
 .W !
"RTN","SDM2",16,0)
 .I $$BADADR^DGUTL3(DFN)>0 D  Q
"RTN","SDM2",17,0)
 ..W !!,"**BAD ADDRESS INDICATOR FOR THIS PATIENT. NO LETTER WILL BE PRINTED.**",!!
"RTN","SDM2",18,0)
 .S DIR("A")="DO YOU WISH TO PRINT LETTERS FOR THE CANCELLED APPOINTMENT"
"RTN","SDM2",19,0)
 .S DIR("A",1)="THIS IS THE ONLY OPPORTUNITY.",DIR("B")="YES"
"RTN","SDM2",20,0)
 .S DIR(0)="Y" D ^DIR W ! K DIR
"RTN","SDM2",21,0)
 .Q:(Y'=1)
"RTN","SDM2",22,0)
 .N SDWH,A,SC,SDCL S SDWH="P",A=+DFN,SDCL(1)=I_"^"_S N DFN
"RTN","SDM2",23,0)
 .S %ZIS("A")="Device for cancellation letter: ",%ZIS("B")=""
"RTN","SDM2",24,0)
 .N I,S,SDHX,SDP
"RTN","SDM2",25,0)
 .D ^%ZIS Q:POP  U IO
"RTN","SDM2",26,0)
 .D SDLET^SDCNP1A
"RTN","SDM2",27,0)
 .D ^%ZISC
"RTN","SDM2",28,0)
 K ^SC(I,"S",S,1,SDSY)
"RTN","SDM2",29,0)
 I '$D(^SC(I,"ST",$P(SD,"."),1)) G OUT
"RTN","SDM2",30,0)
 S SD1(1)=^SC(I,"SL"),SD1=$P(SD1(1),"^",3),SB1=$S(SD1:SD1,1:8)-1/100,SD1=$P(SD1(1),"^",6),HSI1=$S(SD1:SD1,1:4),SI1=$S(SD1="":4,SD1<3:4,SD1:SD1,1:4),SDDIF1=$S(HSI1<3:8/HSI1,1:2) K SD1
"RTN","SDM2",31,0)
 S S=^SC(I,"ST",$P(SD,"."),1),SDQ=SD#1-SB1*100,ST=SDQ#1*SI1\.6+($P(SDQ,".")*SI1),SS=SL1*HSI1/60
"RTN","SDM2",32,0)
 I SDQ'<1 F I=ST+ST:SDDIF1 S SDQ=$E(STR,$F(STR,$E(S,I+1))) Q:SDQ=""  S S=$E(S,1,I)_SDQ_$E(S,I+2,999),SS=SS-1 Q:SS'>0
"RTN","SDM2",33,0)
 S ^(1)=S K SL1,SB1,SDDIF1,HSI1,SI1,SDQ ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDM2",34,0)
OUT D EVT Q:$D(SDNSF)  W *7,!,"APPOINTMENT IN ",$P(^SC(SCI,0),"^",1)," CANCELLED!" S X=SD D DOW^SDM1 W !,"APPOINTMENT NOW BEING MADE IN ",$P(^SC(SC,0),"^",1) K SCI G S^SDM1
"RTN","SDM2",35,0)
 ;
"RTN","SDM2",36,0)
C I +^SC(I,"S",S,1,SDSX,0)=DFN,$P(^(0),"^",9)'["C" S SDSY=SDSX Q
"RTN","SDM2",37,0)
 Q:'$D(^("OB"))!DA  S:^("OB")?1"O".E DA=SDSX Q  ;NAKED REFERENCE - ^SC(IFN,"S",Date,1,SDSX,"OB")
"RTN","SDM2",38,0)
 ;
"RTN","SDM2",39,0)
AT W "AT ",$E(S_0,9,10),":",$E(S_"000",11,12) Q
"RTN","SDM2",40,0)
IN W:SC-I&$D(^SC(I,0)) " IN ",$P(^(0),U,1) Q
"RTN","SDM2",41,0)
PROT K SDPROT
"RTN","SDM2",42,0)
 I $D(^SC(I,"SDPROT")),$P(^("SDPROT"),U)="Y",'$D(^SC(I,"SDPRIV",DUZ)) D  Q
"RTN","SDM2",43,0)
 .W !!,*7,">>> Access to ",$$CNAM(I)," is prohibited!"
"RTN","SDM2",44,0)
 .W !,"    Only users with a special code may access this clinic.",!
"RTN","SDM2",45,0)
 .S SDPROT=""
"RTN","SDM2",46,0)
 ;
"RTN","SDM2",47,0)
 I $$CODT^SDCOU(DFN,SD,I) D  Q
"RTN","SDM2",48,0)
 .W !?5,*7,">>> A check out date has been entered for this appointment!"
"RTN","SDM2",49,0)
 .W !?5,"    Please enter another date and time.   Thank you.",!
"RTN","SDM2",50,0)
 .S SDPROT=""
"RTN","SDM2",51,0)
 Q
"RTN","SDM2",52,0)
 ;
"RTN","SDM2",53,0)
CNAM(SDCL) ;Return clinic name
"RTN","SDM2",54,0)
 ;Input: SDCL=clinic ien
"RTN","SDM2",55,0)
 N SDX
"RTN","SDM2",56,0)
 S SDX=$P($G(^SC(+SDCL,0)),U)
"RTN","SDM2",57,0)
 Q $S($L(SDX):SDX,1:"this clinic")
"RTN","SDM2",58,0)
 ;
"RTN","SDM2",59,0)
FLEN S APL="" I $D(^SC(I,"S",SD)) F ZL=0:0 S ZL=$O(^SC(I,"S",SD,1,ZL)) Q:ZL=""  I +^(ZL,0)=DFN S APL=$P(^SC(I,"S",SD,1,ZL,0),"^",2)
"RTN","SDM2",60,0)
 Q
"RTN","SDM2",61,0)
 ;
"RTN","SDM2",62,0)
DISP G ^SDM1 ; LINE TAG IS NO LONGER USED
"RTN","SDM2",63,0)
 ;W !?4 K S F SDQ=Y:0 S SDQ=$N(^SC(SC,"S",SDQ)) Q:Y+1<SDQ!(SDQ<0)  F I=0:0 S I=$N(^SC(SC,"S",SDQ,1,I)) Q:I'>0  Q:'$D(^(I,0))  S ST=$S($P(^(0),U,4)="":"BLANK",1:"'"_$E($P(^(0),U,4),1,28)_"'"),S(ST)=$S($D(S(ST)):S(ST)+1,1:1)
"RTN","SDM2",64,0)
 ;I '$D(S) W "NO APPNT'S SCHEDULED YET" G ^SDM1
"RTN","SDM2",65,0)
 ;W "'OTHER' TYPES ALREADY SCHEDULED:   ",!
"RTN","SDM2",66,0)
 ;S S=0 F I=0:1 S S=$N(S(S)) G ^SDM1:S=-1 W:$X+$L(S)>72 ! W S,": ",S(S),"     "
"RTN","SDM2",67,0)
CK1 S SDZ=0 F SD1=$P(S,"."):0 S SD1=$O(^DPT(DFN,"S",SD1)) Q:'SD1!((SD1\1)'=(S\1))  I $P(^(SD1,0),"^",2)'["C",$P(^(0),"^",2)'["N" S SDZ=1 Q
"RTN","SDM2",68,0)
 Q:SDZ  F SD1=2,4 I $D(^SC("AAS",SD1,$P(S,"."),DFN)) S SDZ=1 Q
"RTN","SDM2",69,0)
 Q:SDZ  IF $D(^SCE(+$$EXAE^SDOE(DFN,S\1,S\1),0)) S SDX=1
"RTN","SDM2",70,0)
 Q:SDZ  K ^DPT("ASDPSD","B",DIV,$P(S,"."),DFN) Q
"RTN","SDM2",71,0)
STAT N X S SDCMHDL=$$HANDLE^SDAMEVT(1) D BEFORE^SDAMEVT(.SDATA,DFN,SD,I,"",SDCMHDL),NOW^%DTC
"RTN","SDM2",72,0)
 S $P(^DPT(DFN,"S",SD,0),"^",2)="C",$P(^(0),"^",14)=$E(%,1,12) S:$D(DUZ) $P(^(0),"^",12)=DUZ S ^DPT("ASDCN",+^(0),SD,DFN)="" Q
"RTN","SDM2",73,0)
 ;
"RTN","SDM2",74,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDM2",75,0)
 ; -- cancel event
"RTN","SDM2",76,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SDTTM,SDSC,SDPL,0,SDCMHDL)
"RTN","SDM2",77,0)
 Q
"VER")
8.0^22.0
**END**
**END**
