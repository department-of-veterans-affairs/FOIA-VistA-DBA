Released GMRA*4*12 SEQ #12
Extracted from mail message
**KIDS**:GMRA*4.0*12^

**INSTALL NAME**
GMRA*4.0*12
"BLD",1312,0)
GMRA*4.0*12^ADVERSE REACTION TRACKING^0^2980915^y
"BLD",1312,1,0)
^^4^4^2980915^
"BLD",1312,1,1,0)
Allergies entered via CPRS were being entered into the ART database as
"BLD",1312,1,2,0)
unverified even if they met the criteria to be auto-verified in the ART
"BLD",1312,1,3,0)
site parameters. This patch will auto-verify those allergies entered via
"BLD",1312,1,4,0)
CPRS that meet the criteria as defined at the site.
"BLD",1312,4,0)
^9.64PA^^
"BLD",1312,"ABPKG")
n
"BLD",1312,"KRN",0)
^9.67PA^19^18
"BLD",1312,"KRN",.4,0)
.4
"BLD",1312,"KRN",.401,0)
.401
"BLD",1312,"KRN",.402,0)
.402
"BLD",1312,"KRN",.403,0)
.403
"BLD",1312,"KRN",.5,0)
.5
"BLD",1312,"KRN",.84,0)
.84
"BLD",1312,"KRN",3.6,0)
3.6
"BLD",1312,"KRN",3.8,0)
3.8
"BLD",1312,"KRN",9.2,0)
9.2
"BLD",1312,"KRN",9.8,0)
9.8
"BLD",1312,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1312,"KRN",9.8,"NM",1,0)
GMRAOR5^^0^B22015914
"BLD",1312,"KRN",9.8,"NM","B","GMRAOR5",1)

"BLD",1312,"KRN",19,0)
19
"BLD",1312,"KRN",19.1,0)
19.1
"BLD",1312,"KRN",101,0)
101
"BLD",1312,"KRN",409.61,0)
409.61
"BLD",1312,"KRN",771,0)
771
"BLD",1312,"KRN",869.2,0)
869.2
"BLD",1312,"KRN",870,0)
870
"BLD",1312,"KRN",8994,0)
8994
"BLD",1312,"KRN","B",.4,.4)

"BLD",1312,"KRN","B",.401,.401)

"BLD",1312,"KRN","B",.402,.402)

"BLD",1312,"KRN","B",.403,.403)

"BLD",1312,"KRN","B",.5,.5)

"BLD",1312,"KRN","B",.84,.84)

"BLD",1312,"KRN","B",3.6,3.6)

"BLD",1312,"KRN","B",3.8,3.8)

"BLD",1312,"KRN","B",9.2,9.2)

"BLD",1312,"KRN","B",9.8,9.8)

"BLD",1312,"KRN","B",19,19)

"BLD",1312,"KRN","B",19.1,19.1)

"BLD",1312,"KRN","B",101,101)

"BLD",1312,"KRN","B",409.61,409.61)

"BLD",1312,"KRN","B",771,771)

"BLD",1312,"KRN","B",869.2,869.2)

"BLD",1312,"KRN","B",870,870)

"BLD",1312,"KRN","B",8994,8994)

"BLD",1312,"QUES",0)
^9.62^^
"BLD",1312,"REQB",0)
^9.611^1^1
"BLD",1312,"REQB",1,0)
GMRA*4.0*4^2
"BLD",1312,"REQB","B","GMRA*4.0*4",1)

"PKG",140,-1)
1^1
"PKG",140,0)
ADVERSE REACTION TRACKING^GMRA^Allergy Tracking System
"PKG",140,20,0)
^9.402P^^
"PKG",140,22,0)
^9.49I^1^1
"PKG",140,22,1,0)
4.0^2960328^2960506^10
"PKG",140,22,1,"PAH",1,0)
12^2980915
"PKG",140,22,1,"PAH",1,1,0)
^^4^4^2980915
"PKG",140,22,1,"PAH",1,1,1,0)
Allergies entered via CPRS were being entered into the ART database as
"PKG",140,22,1,"PAH",1,1,2,0)
unverified even if they met the criteria to be auto-verified in the ART
"PKG",140,22,1,"PAH",1,1,3,0)
site parameters. This patch will auto-verify those allergies entered via
"PKG",140,22,1,"PAH",1,1,4,0)
CPRS that meet the criteria as defined at the site.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","GMRAOR5")
0^1^B22015914
"RTN","GMRAOR5",1,0)
GMRAOR5 ;HIRMFO/WAA,FPT-OERR HL7 UTILITY ;7/8/97  10:25
"RTN","GMRAOR5",2,0)
 ;;4.0;Adverse Reaction Tracking;**4,12**;Mar 29, 1996
"RTN","GMRAOR5",3,0)
 ;MSG = HL7 Message array
"RTN","GMRAOR5",4,0)
 ;GMRANODE = IEN of MSG array
"RTN","GMRAOR5",5,0)
 ;GMRAND = Date from MSG(GMRANODE)
"RTN","GMRAOR5",6,0)
 ;GMRAMTP = Message type
"RTN","GMRAOR5",7,0)
 ;Allergy Loader
"RTN","GMRAOR5",8,0)
 ;building GMRAL Array to be used to stuff only new data
"RTN","GMRAOR5",9,0)
 ;GMRAID=sequence number of allergy
"RTN","GMRAOR5",10,0)
 ;~=continuation
"RTN","GMRAOR5",11,0)
 ;GMRAIDO = Sequence # OBSERVED
"RTN","GMRAOR5",12,0)
 ;GMRAIDS = Sequence # SIGN
"RTN","GMRAOR5",13,0)
 ;GMRAIDN = Sequence # NOTES
"RTN","GMRAOR5",14,0)
 ;   GMRADFN=DFN of patient in ^DPT(DFN) Patient (2) file
"RTN","GMRAOR5",15,0)
 ;   GMRAL(GMRAID)=type^file ien^VA Free text drug^file^OERR entry date
"RTN","GMRAOR5",16,0)
 ;                 ^NKA Status^Originator Pt to 200^Observed/Historical
"RTN","GMRAOR5",17,0)
 ;   GMRAL(GMRAID,"O",GMRAIDO)=Observed date^Severity^Observer's DUZ
"RTN","GMRAOR5",18,0)
 ;   GMRAL(GMRAID,"S",GMRAIDS)=IEN of file^Free Text of entry^File of SS
"RTN","GMRAOR5",19,0)
 ;                             ^Date/Time of the SS
"RTN","GMRAOR5",20,0)
 ;   GMRAL(GMRAID,"N",GMRAIDN)=Source of comments(Originator always)
"RTN","GMRAOR5",21,0)
 ;----------------------------------------------------------------------
"RTN","GMRAOR5",22,0)
 ;             Example of data
"RTN","GMRAOR5",23,0)
 ;   GMRADFN=270
"RTN","GMRAOR5",24,0)
 ;   GMRAL(1)="D^5^SHELL FISH^99ALL^2940415.06^n^1270^o"
"RTN","GMRAOR5",25,0)
 ;   GMRAL(1,"O",1)="2940401.1^3^1234"
"RTN","GMRAOR5",26,0)
 ;   GMRAL(1,"S",1)="32^SEVERE RASH^99ALS^2951211.1120"
"RTN","GMRAOR5",27,0)
 ;   GMRAL(1,"N",1)="n"
"RTN","GMRAOR5",28,0)
 ;   GMRAL(1,"N",1,1)=FREE TEXT
"RTN","GMRAOR5",29,0)
 ;******************************************************************
"RTN","GMRAOR5",30,0)
EN1 ;Main entry point to file data
"RTN","GMRAOR5",31,0)
 N %,GMRADUP,GMRAFDN,GMRANKA,GNRAY,X,Y
"RTN","GMRAOR5",32,0)
 Q:'$G(GMRADFN)
"RTN","GMRAOR5",33,0)
 S GMRAL=0
"RTN","GMRAOR5",34,0)
 S GMRAPA=0,GMRADUP=0
"RTN","GMRAOR5",35,0)
 ; See if the patient has been ask about allergies
"RTN","GMRAOR5",36,0)
 S (GMRAYN,GMRANKA)=0,GMRAYN=$P($G(^GMR(120.86,GMRADFN,0)),U,2)
"RTN","GMRAOR5",37,0)
 ;Loop through for each allergy
"RTN","GMRAOR5",38,0)
 F  S GMRAL=$O(GMRAL(GMRAL)) Q:GMRAL<1  D
"RTN","GMRAOR5",39,0)
 .;If GMRANKA="" add the entry into the file
"RTN","GMRAOR5",40,0)
 .I '$D(^GMR(120.86,GMRADFN,0)) K DD,DO,DIC,DINUM,DLAYGO S DIC="^GMR(120.86,",DLAYGO=120.86,DIC(0)="L",(DINUM,X)=GMRADFN D FILE^DICN K DD,DO,DIC,DINUM,DLAYGO D
"RTN","GMRAOR5",41,0)
 ..Q:Y=-1
"RTN","GMRAOR5",42,0)
 ..S GMRAYN=$S($P(GMRAL(GMRAL),U,6)="y":1,1:0)
"RTN","GMRAOR5",43,0)
 ..S $P(^GMR(120.86,GMRADFN,0),U,2,4)=GMRAYN_U_$P(GMRAL(GMRAL),U,7)_U_$P(GMRAL(GMRAL),U,5)
"RTN","GMRAOR5",44,0)
 ..Q
"RTN","GMRAOR5",45,0)
 .N GMRALL,GMRAFN,%
"RTN","GMRAOR5",46,0)
 .S GMRALL=$P(GMRAL(GMRAL),U,3)
"RTN","GMRAOR5",47,0)
 .I $P(GMRAL(GMRAL),U,6)="n" D  Q:GMRALL'=""
"RTN","GMRAOR5",48,0)
 ..; Change to no for allergies
"RTN","GMRAOR5",49,0)
 ..Q:GMRAYN="1"!$D(^GMR(120.86,GMRADFN,0))
"RTN","GMRAOR5",50,0)
 ..S $P(^GMR(120.86,GMRADFN,0),U,2,4)="0"_U_$P(GMRAL(GMRAL),U,7)_U_$P(GMRAL(GMRAL),U,5)
"RTN","GMRAOR5",51,0)
 ..S:'$D(^GMR(120.86,"B",GMRADFN,GMRADFN)) ^(GMRADFN)=""
"RTN","GMRAOR5",52,0)
 ..Q
"RTN","GMRAOR5",53,0)
 .I GMRAYN="0",$P(GMRAL(GMRAL),U,6)="n" Q
"RTN","GMRAOR5",54,0)
 .; see If the entry needs to be added
"RTN","GMRAOR5",55,0)
 .; If the entry is an allergy set 120.86 to "y"
"RTN","GMRAOR5",56,0)
 .I GMRALL'="",$D(^GMR(120.86,GMRADFN,0)) S GMRAYN=1 D
"RTN","GMRAOR5",57,0)
 ..; Change to yes for allergies
"RTN","GMRAOR5",58,0)
 ..S $P(^GMR(120.86,GMRADFN,0),U,2,4)=GMRAYN_U_$P(GMRAL(GMRAL),U,7)_U_$P(GMRAL(GMRAL),U,5)
"RTN","GMRAOR5",59,0)
 ..S:'$D(^GMR(120.86,"B",GMRADFN,GMRADFN)) ^(GMRADFN)=""
"RTN","GMRAOR5",60,0)
 ..Q
"RTN","GMRAOR5",61,0)
 .; Quit if the reaction is a Dup
"RTN","GMRAOR5",62,0)
 .Q:$$DUPCHK^GMRAOR0(GMRADFN,GMRALL)>0
"RTN","GMRAOR5",63,0)
 .S GMRAPA=0
"RTN","GMRAOR5",64,0)
 .K DD,DO,DIC,DINUM,DLAYGO S DIC="^GMR(120.8,",DLAYGO=120.8,DIC(0)="L",X=GMRADFN D FILE^DICN
"RTN","GMRAOR5",65,0)
 .K DD,DO,DIC,DINUM,DLAYGO
"RTN","GMRAOR5",66,0)
 .Q:Y=-1  S GMRAPA=+Y
"RTN","GMRAOR5",67,0)
 .Q:$G(^GMR(120.8,GMRAPA,0))=""
"RTN","GMRAOR5",68,0)
 .F  Q:$$LOCK^GMRAUTL(120.8,GMRAPA)
"RTN","GMRAOR5",69,0)
 .N GMRALN,GMRAVR
"RTN","GMRAOR5",70,0)
 .S GMRALN=$G(^GMR(120.8,GMRAPA,0))
"RTN","GMRAOR5",71,0)
 .S $P(GMRALN,U,4)=$P(GMRAL(GMRAL),U,5) ; Orig. DT
"RTN","GMRAOR5",72,0)
 .S $P(GMRALN,U,5)=$P(GMRAL(GMRAL),U,7) ; Originator
"RTN","GMRAOR5",73,0)
 .S %=$P(GMRAL(GMRAL),U,4),%=$S(%="99ALL"!(%="99OTH"):"GMRD(120.82,",%="99NDF":"PSNDF(",%="99PSC":"PS(50.605,",1:"") Q:%=""  ;Bad entry
"RTN","GMRAOR5",74,0)
 .S:$P(GMRAL(GMRAL),U,2)="NOS" $P(GMRAL(GMRAL),U,2)=$S($O(^GMRD(120.82,"B","OTHER ALLERGY/ADVERSE REACTION",0))>0:$O(^GMRD(120.82,"B","OTHER ALLERGY/ADVERSE REACTION",0)),1:1)
"RTN","GMRAOR5",75,0)
 .S GMRAAR=$P(GMRAL(GMRAL),U,2)_";"_%,$P(GMRALN,U,3)=GMRAAR ;File Ptr
"RTN","GMRAOR5",76,0)
 .I $P(GMRAL(GMRAL),U,3)'="" S $P(GMRALN,U,2)=$P(GMRAL(GMRAL),U,3) ;Free text
"RTN","GMRAOR5",77,0)
 .E  D  ; This code will resolve the free text pointer for the reaction
"RTN","GMRAOR5",78,0)
 ..N GMRALOC,GMRADATA
"RTN","GMRAOR5",79,0)
 ..S GMRALOC="^"_$P($P(GMRALN,U,3),";",2)_+$P(GMRALN,U,3)_",0)"
"RTN","GMRAOR5",80,0)
 ..S GMRADATA=@GMRALOC
"RTN","GMRAOR5",81,0)
 ..S $P(GMRALN,U,2)=$P(GMRADATA,U)
"RTN","GMRAOR5",82,0)
 ..Q
"RTN","GMRAOR5",83,0)
 .S $P(GMRALN,U,20)=$P(GMRAL(GMRAL),U) ;Type of reaction
"RTN","GMRAOR5",84,0)
 .S $P(GMRALN,U,6)=$P(GMRAL(GMRAL),U,8) ;Obs/Hist
"RTN","GMRAOR5",85,0)
 .S $P(GMRALN,U,14)="U" ;Mechanism
"RTN","GMRAOR5",86,0)
 .S $P(GMRALN,U,12)=1 ;Sign-off the reaction
"RTN","GMRAOR5",87,0)
 .; auto-verify?
"RTN","GMRAOR5",88,0)
 .S GMRAVR="",GMRAVR(0)=GMRALN
"RTN","GMRAOR5",89,0)
 .S $P(GMRALN,U,16)=$$VFY^GMRASIGN(.GMRAVR)
"RTN","GMRAOR5",90,0)
 .I $P(GMRALN,U,16) S $P(GMRALN,U,17)=$$NOW^XLFDT
"RTN","GMRAOR5",91,0)
 .; save
"RTN","GMRAOR5",92,0)
 .S ^GMR(120.8,GMRAPA,0)=GMRALN
"RTN","GMRAOR5",93,0)
 .I $D(GMRAL(GMRAL,"S",1)) D SIGN^GMRAOR6(120.8,GMRAPA,.GMRAL) ; S/S
"RTN","GMRAOR5",94,0)
 .; Comments
"RTN","GMRAOR5",95,0)
 .I $D(GMRAL(GMRAL,"N",1)) D COMM^GMRAOR8(GMRAPA,.GMRAL) ; Add comments
"RTN","GMRAOR5",96,0)
 .D EN1^GMRAOR9 K GMRAAR ;stuff ingredients & classes
"RTN","GMRAOR5",97,0)
 .;Re-Index Whole file entry
"RTN","GMRAOR5",98,0)
 .K DIK,DA S DIK="^GMR(120.8,",DA=GMRAPA D IX^DIK K DIK,DA
"RTN","GMRAOR5",99,0)
 .D UNLOCK^GMRAUTL(120.8,GMRAPA)
"RTN","GMRAOR5",100,0)
 .Q:($P(GMRAL(GMRAL),U,1)'["D"!($P(GMRAL(GMRAL),U,8)'["o"))  ;quit if not an observed drug reaction
"RTN","GMRAOR5",101,0)
 .; add Adverse Reaction report.
"RTN","GMRAOR5",102,0)
 .I $G(GMRAL(GMRAL,"O",1))'="" D ADVERSE^GMRAOR7(GMRAPA,.GMRAL)
"RTN","GMRAOR5",103,0)
 .Q
"RTN","GMRAOR5",104,0)
 Q
"VER")
8.0^21.0
**END**
**END**
