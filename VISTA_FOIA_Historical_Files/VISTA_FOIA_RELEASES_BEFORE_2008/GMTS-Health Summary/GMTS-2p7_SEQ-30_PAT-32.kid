Released GMTS*2.7*32 SEQ #30
Extracted from mail message
**KIDS**:GMTS*2.7*32^

**INSTALL NAME**
GMTS*2.7*32
"BLD",1584,0)
GMTS*2.7*32^HEALTH SUMMARY^0^2990927^y
"BLD",1584,1,0)
^^2^2^2990813^^
"BLD",1584,1,1,0)
The description of this patch may be found on the National Patch Module 
"BLD",1584,1,2,0)
under GMTS*2.7*32.
"BLD",1584,4,0)
^9.64PA^^
"BLD",1584,"ABPKG")
n
"BLD",1584,"INID")
^y
"BLD",1584,"INIT")
GMTSP32
"BLD",1584,"KRN",0)
^9.67PA^19^18
"BLD",1584,"KRN",.4,0)
.4
"BLD",1584,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",1584,"KRN",.401,0)
.401
"BLD",1584,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",1584,"KRN",.402,0)
.402
"BLD",1584,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",1584,"KRN",.403,0)
.403
"BLD",1584,"KRN",.5,0)
.5
"BLD",1584,"KRN",.5,"NM",0)
^9.68A^^0
"BLD",1584,"KRN",.84,0)
.84
"BLD",1584,"KRN",3.6,0)
3.6
"BLD",1584,"KRN",3.8,0)
3.8
"BLD",1584,"KRN",9.2,0)
9.2
"BLD",1584,"KRN",9.8,0)
9.8
"BLD",1584,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",1584,"KRN",9.8,"NM",1,0)
GMTSUIX^^0^B17040932
"BLD",1584,"KRN",9.8,"NM",2,0)
GMTSULT2^^0^B35558506
"BLD",1584,"KRN",9.8,"NM",3,0)
GMTSULT3^^0^B22116878
"BLD",1584,"KRN",9.8,"NM",4,0)
GMTSULT4^^0^B31846865
"BLD",1584,"KRN",9.8,"NM",5,0)
GMTSULT6^^0^B25882100
"BLD",1584,"KRN",9.8,"NM","B","GMTSUIX",1)

"BLD",1584,"KRN",9.8,"NM","B","GMTSULT2",2)

"BLD",1584,"KRN",9.8,"NM","B","GMTSULT3",3)

"BLD",1584,"KRN",9.8,"NM","B","GMTSULT4",4)

"BLD",1584,"KRN",9.8,"NM","B","GMTSULT6",5)

"BLD",1584,"KRN",19,0)
19
"BLD",1584,"KRN",19,"NM",0)
^9.68A^^0
"BLD",1584,"KRN",19.1,0)
19.1
"BLD",1584,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",1584,"KRN",101,0)
101
"BLD",1584,"KRN",101,"NM",0)
^9.68A^^0
"BLD",1584,"KRN",409.61,0)
409.61
"BLD",1584,"KRN",771,0)
771
"BLD",1584,"KRN",869.2,0)
869.2
"BLD",1584,"KRN",870,0)
870
"BLD",1584,"KRN",8994,0)
8994
"BLD",1584,"KRN","B",.4,.4)

"BLD",1584,"KRN","B",.401,.401)

"BLD",1584,"KRN","B",.402,.402)

"BLD",1584,"KRN","B",.403,.403)

"BLD",1584,"KRN","B",.5,.5)

"BLD",1584,"KRN","B",.84,.84)

"BLD",1584,"KRN","B",3.6,3.6)

"BLD",1584,"KRN","B",3.8,3.8)

"BLD",1584,"KRN","B",9.2,9.2)

"BLD",1584,"KRN","B",9.8,9.8)

"BLD",1584,"KRN","B",19,19)

"BLD",1584,"KRN","B",19.1,19.1)

"BLD",1584,"KRN","B",101,101)

"BLD",1584,"KRN","B",409.61,409.61)

"BLD",1584,"KRN","B",771,771)

"BLD",1584,"KRN","B",869.2,869.2)

"BLD",1584,"KRN","B",870,870)

"BLD",1584,"KRN","B",8994,8994)

"BLD",1584,"QUES",0)
^9.62^^
"BLD",1584,"REQB",0)
^9.611^2^2
"BLD",1584,"REQB",1,0)
GMTS*2.7*30^2
"BLD",1584,"REQB",2,0)
VA FILEMAN 22.0^2
"BLD",1584,"REQB","B","GMTS*2.7*30",1)

"BLD",1584,"REQB","B","VA FILEMAN 22.0",2)

"INIT")
GMTSP32
"MBREQ")
0
"PKG",187,-1)
1^1
"PKG",187,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",187,20,0)
^9.402P^^
"PKG",187,22,0)
^9.49I^1^1
"PKG",187,22,1,0)
2.7^2951020^2960308
"PKG",187,22,1,"PAH",1,0)
32^2990927^1118
"PKG",187,22,1,"PAH",1,1,0)
^^2^2^2990927
"PKG",187,22,1,"PAH",1,1,1,0)
The description of this patch may be found on the National Patch Module 
"PKG",187,22,1,"PAH",1,1,2,0)
under GMTS*2.7*32.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","GMTSP32")
0^^B865081
"RTN","GMTSP32",1,0)
GMTSP32 ;SLC/KER - GMTS*2.7*32 Post Install                ; 08/26/1999
"RTN","GMTSP32",2,0)
 ;;2.7;Health Summary;**32**;Apr 19, 1999
"RTN","GMTSP32",3,0)
 Q
"RTN","GMTSP32",4,0)
PST ; Post Install Health Summary v 2.7, Patch 32
"RTN","GMTSP32",5,0)
 N DA,X,Y S X=" Reindexing Health Summary Type file, #142"
"RTN","GMTSP32",6,0)
 W:'$D(XPDNM) !!,X D:$D(XPDNM) BMES^XPDUTL(X)
"RTN","GMTSP32",7,0)
 N DA,DIC,DIK S DA=$O(^GMT(142,"!"),-1),(DIC,DIK)="^GMT(142,"
"RTN","GMTSP32",8,0)
 F  S DA=$O(^GMT(142,DA)) Q:DA=""  K:$L(DA)&(+DA=0)&('$L($G(^GMT(142,DA)))) ^GMT(142,DA)
"RTN","GMTSP32",9,0)
 S DA=0 F  S DA=$O(^GMT(142,DA)) Q:+DA=0  D IX1^DIK W "."
"RTN","GMTSP32",10,0)
 S X=" " W:'$D(XPDNM) ! D:$D(XPDNM) MES^XPDUTL(X)
"RTN","GMTSP32",11,0)
 Q
"RTN","GMTSUIX")
0^1^B17040932
"RTN","GMTSUIX",1,0)
GMTSUIX ; SLC/KER - Health Summary Set/Kill Indexes        ; 08/26/1999
"RTN","GMTSUIX",2,0)
 ;;2.7;Health Summary;**30,32**;Oct 20, 1995
"RTN","GMTSUIX",3,0)
 ;;
"RTN","GMTSUIX",4,0)
 Q
"RTN","GMTSUIX",5,0)
STNT ; Set word indexes for Health Summary Type NAME and TITLE
"RTN","GMTSUIX",6,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD S GMTSTR=$G(X) Q:'$L(GMTSTR)  S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",7,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",8,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",9,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",10,0)
 . . . S @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")=""
"RTN","GMTSUIX",11,0)
 Q
"RTN","GMTSUIX",12,0)
KTNT ; Kill word indexes for Health Summary Type NAME and TITLE
"RTN","GMTSUIX",13,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD S GMTSTR=$G(X) Q:'$L(GMTSTR)  S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",14,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",15,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",16,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",17,0)
 . . . K @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")
"RTN","GMTSUIX",18,0)
 Q
"RTN","GMTSUIX",19,0)
STO ; Set word indexes for Health Summary Type OWNER
"RTN","GMTSUIX",20,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD
"RTN","GMTSUIX",21,0)
 S GMTSTR=+($G(X)) Q:GMTSTR'>0  Q:GMTSTR>0&(GMTSTR<1)  S GMTSTR=$P($G(^VA(200,+GMTSTR,0)),U,1) Q:'$L(GMTSTR)  S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",22,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",23,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",24,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",25,0)
 . . . S @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")=""
"RTN","GMTSUIX",26,0)
 Q
"RTN","GMTSUIX",27,0)
KTO ; Kill word indexes for Health Summary Type OWNER
"RTN","GMTSUIX",28,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD
"RTN","GMTSUIX",29,0)
 S GMTSTR=+($G(X)) Q:GMTSTR'>0  Q:GMTSTR>0&(GMTSTR<1)  S GMTSTR=$P($G(^VA(200,+GMTSTR,0)),U,1) Q:'$L(GMTSTR)  S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",30,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",31,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",32,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",33,0)
 . . . K @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")
"RTN","GMTSUIX",34,0)
 Q
"RTN","GMTSUIX",35,0)
STL ; Set word indexes for Health Summary Type LOCATION
"RTN","GMTSUIX",36,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD,GMTSIEN1,GMTSIEN2 S GMTSTR=$P($G(^SC(+($G(X)),0)),U,1) Q:'$L(GMTSTR)  S GMTSIEN1=+($G(DA(1))) Q:+GMTSIEN1=0  S GMTSIEN2=+($G(DA)) Q:+GMTSIEN2=0
"RTN","GMTSUIX",37,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",38,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",39,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",40,0)
 . . .S @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN1_","_GMTSIEN2_")")=""
"RTN","GMTSUIX",41,0)
 Q
"RTN","GMTSUIX",42,0)
KTL ; Kill word indexes for Health Summary Type LOCATION
"RTN","GMTSUIX",43,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD,GMTSIEN1,GMTSIEN2 S GMTSTR=$P($G(^SC(+($G(X)),0)),U,1) Q:'$L(GMTSTR)  S GMTSIEN1=+($G(DA(1))) Q:+GMTSIEN1=0  S GMTSIEN2=+($G(DA)) Q:+GMTSIEN2=0
"RTN","GMTSUIX",44,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",45,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",46,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",47,0)
 . . . K @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN1_","_GMTSIEN2_")")
"RTN","GMTSUIX",48,0)
 Q
"RTN","GMTSUIX",49,0)
RXT ; Re-index Health Summary Type file #142
"RTN","GMTSUIX",50,0)
 W !,"Re-indexing Health Summary Type file #142"
"RTN","GMTSUIX",51,0)
 N DIK,DA,IX S DA=0 F  S DA=$O(^GMT(142,DA)) Q:+DA=0  D
"RTN","GMTSUIX",52,0)
 . S IX="~" F  S IX=$O(^GMT(142,DA,1,IX),-1) Q:+IX>0!(IX="")  I IX="0" K:$E(IX,1)?1U!($E(IX,1)?1L) ^GMT(142,DA,1,IX)
"RTN","GMTSUIX",53,0)
 . S IX="~" F  S IX=$O(^GMT(142,DA,20,IX),-1) Q:+IX>0!(IX="")  I IX="0" K:$E(IX,1)?1U!($E(IX,1)?1L) ^GMT(142,DA,20,IX)
"RTN","GMTSUIX",54,0)
 S IX="~" F  S IX=$O(^GMT(142,IX),-1) Q:+IX>0!(IX="")  I IX'="0" K:$E(IX,1)?1U!($E(IX,1)?1L) ^GMT(142,IX)
"RTN","GMTSUIX",55,0)
 W ! S DA=0 F  S DA=$O(^GMT(142,DA)) Q:+DA=0  S DIK="^GMT(142," D IX1^DIK W "."
"RTN","GMTSUIX",56,0)
 Q
"RTN","GMTSUIX",57,0)
UP(X) ; Uppercase
"RTN","GMTSUIX",58,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSUIX",59,0)
TRIM(X) ; Trim Spaces
"RTN","GMTSUIX",60,0)
 S X=$G(X) Q:X="" X F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSUIX",61,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSUIX",62,0)
 F  Q:X'["  "  S X=$P(X,"  ",1)_" "_$P(X,"  ",2,229)
"RTN","GMTSUIX",63,0)
 Q X
"RTN","GMTSULT2")
0^2^B35558506
"RTN","GMTSULT2",1,0)
GMTSULT2 ; SLC/KER - HS Type Lookup (Search/List)   ; 08/26/1999
"RTN","GMTSULT2",2,0)
 ;;2.7;Health Summary;**30,32**;Oct 20, 1995
"RTN","GMTSULT2",3,0)
 ;
"RTN","GMTSULT2",4,0)
 Q
"RTN","GMTSULT2",5,0)
LIST(X) ; Get global array of Health Summary Types
"RTN","GMTSULT2",6,0)
 ;                      
"RTN","GMTSULT2",7,0)
 ;  LIST^GMTSULT2(<search string>)
"RTN","GMTSULT2",8,0)
 ;                      
"RTN","GMTSULT2",9,0)
 ;  ^TMP("GMTSULT",$J,#)
"RTN","GMTSULT2",10,0)
 ;                    
"RTN","GMTSULT2",11,0)
 ;     Piece 1 =  Internal Entry Number (IEN) in file 142
"RTN","GMTSULT2",12,0)
 ;     Piece 2 =  Health Summary Type Name
"RTN","GMTSULT2",13,0)
 ;     Piece 3 =  Health Summary Type Title
"RTN","GMTSULT2",14,0)
 ;     Piece 4 =  Health Summary Type Owner
"RTN","GMTSULT2",15,0)
 ;     Piece 5 =  Location Using Health Summary Type
"RTN","GMTSULT2",16,0)
 ;     Piece 6 =  Number of Components in Summary Type
"RTN","GMTSULT2",17,0)
 ;     Piece 7 =  Recommended Display Text (for 
"RTN","GMTSULT2",18,0)
 ;                selection or list box)
"RTN","GMTSULT2",19,0)
 ;                      
"RTN","GMTSULT2",20,0)
 ;  List Builder can use variable DIC("S") and DIC(0)
"RTN","GMTSULT2",21,0)
 ;                      
"RTN","GMTSULT2",22,0)
 ;     DIC("S") Screen out entries for selection/list
"RTN","GMTSULT2",23,0)
 ;                      
"RTN","GMTSULT2",24,0)
 ;     Processes DIC(0) N, OE (combination),X or B
"RTN","GMTSULT2",25,0)
 ;                      
"RTN","GMTSULT2",26,0)
 ;     Does not process DIC(0) components C or M.  Cross
"RTN","GMTSULT2",27,0)
 ;     reference suppression (C) is automatic in a multi-
"RTN","GMTSULT2",28,0)
 ;     term lookup, and the use of multiple indexes is
"RTN","GMTSULT2",29,0)
 ;     implied in the lookup and DD file structure.
"RTN","GMTSULT2",30,0)
 ;                      
"RTN","GMTSULT2",31,0)
 D CLR^GMTSULT N GMTSEO,GMTSEQ,GMTSIF,GMTSBI,GMTSIEN,GMTSWRDS,GMTSDS,GMTSD0
"RTN","GMTSULT2",32,0)
 S GMTSEO=+($$EMO),GMTSEQ=+($$EMQ),GMTSIF=+($$IF($G(X))),GMTSBI=+($$BI)
"RTN","GMTSULT2",33,0)
 S:$L($G(DIC("S")))&('$L($G(GMTSDICS))) GMTSDICS=$G(DIC("S")),GMTSDS=1
"RTN","GMTSULT2",34,0)
 S:$L($G(DIC(0)))&('$L($G(GMTSDIC0))) GMTSDIC0=$G(DIC(0)),GMTSD0=1
"RTN","GMTSULT2",35,0)
 I GMTSIF S GMTSIEN=$$IENF(X) I +GMTSIEN>0 D IENS(GMTSIEN) G:$D(^TMP("GMTSULT",$J,1)) LQ
"RTN","GMTSULT2",36,0)
 I GMTSBI D B^GMTSULT7 G LQ
"RTN","GMTSULT2",37,0)
 D PAR,FND,REO^GMTSULT3 Q
"RTN","GMTSULT2",38,0)
LQ ; Quit List
"RTN","GMTSULT2",39,0)
 K:+($G(GMTSDS))>0 GMTSDICS K:+($G(GMTSD0))>0 GMTSDIC0
"RTN","GMTSULT2",40,0)
 Q
"RTN","GMTSULT2",41,0)
 ;                      
"RTN","GMTSULT2",42,0)
FND ; Find Health Summary Types (word search)
"RTN","GMTSULT2",43,0)
 N GMTSB,GMTSC,GMTSCTL,GMTSFND,GMTSI,GMTSI1,GMTSI2,GMTSI3,GMTSDS,GMTSD0,GMTSLEX,GMTSLEXM,GMTSASM,GMTSCMP,GMTSLOC,GMTSNAM,GMTSOK,GMTSRC,GMTSOW,GMTSTMP,GMTSTTL,GMTSWDS,GMTSRD,GMTSWRD,Y
"RTN","GMTSULT2",44,0)
 ;   Echo             E or broker
"RTN","GMTSULT2",45,0)
 S GMTSTMP=+($G(GMTSE)),GMTSIF=0 S:'$D(GMTSE) GMTSTMP=$$ECHO^GMTSULT N GMTSE S GMTSE=GMTSTMP,U="^"
"RTN","GMTSULT2",46,0)
 ;   Exact Match      X
"RTN","GMTSULT2",47,0)
 S GMTSLEX=$$EM(X) D:$G(GMTSDIC0)["X"&(GMTSLEX'>0) CLR^GMTSULT G:$G(GMTSDIC0)["X"&(GMTSLEX'>0) FNDQ
"RTN","GMTSULT2",48,0)
 S:+GMTSLEX>0 ^TMP("GMTSULT2",$J,"EM")=+GMTSLEX,^TMP("GMTSULT2",$J,"IEN",+GMTSLEX)=""
"RTN","GMTSULT2",49,0)
 ;   One Exact Match  OE
"RTN","GMTSULT2",50,0)
 S GMTSLEXM=0 S:$G(GMTSDIC0)["O"&($G(GMTSDIC0)["E") GMTSLEXM=1
"RTN","GMTSULT2",51,0)
 ;   Word Search
"RTN","GMTSULT2",52,0)
 S GMTSWDS=$O(GMTSWRDS(" "),-1) S GMTSWRD=$G(GMTSWRDS(1)) G:'$L(GMTSWRD) FNDQ S GMTSCTL=GMTSWRD,GMTSWRD=$E(GMTSWRD,1,($L(GMTSWRD)-1))_$C($A($E(GMTSWRD,$L(GMTSWRD)))-1)_"~"
"RTN","GMTSULT2",53,0)
 F  S GMTSWRD=$O(^GMT(142,"AW",GMTSWRD)) Q:GMTSWRD=""!($E(GMTSWRD,1,$L(GMTSCTL))'=GMTSCTL)  D
"RTN","GMTSULT2",54,0)
 . S (GMTSC,GMTSI1)=0 F  S GMTSI1=$O(^GMT(142,"AW",GMTSWRD,GMTSI1)) Q:+GMTSI1=0  D
"RTN","GMTSULT2",55,0)
 . . N GMTSIEN,GMTSKWRD S GMTSIEN=GMTSI1,GMTSKWRD=GMTSWRD D SM^GMTSULT3
"RTN","GMTSULT2",56,0)
 ;   Check for exact match in results
"RTN","GMTSULT2",57,0)
 S GMTSI=+($G(^TMP("GMTSULT2",$J,"EMI"))),GMTSB=$G(^TMP("GMTSULT2",$J,"EMB")) I GMTSI>0,$L(GMTSB)>0 D
"RTN","GMTSULT2",58,0)
 . S ^TMP("GMTSULT2",$J,"E")=$G(^TMP("GMTSULT2",$J,GMTSI)) K ^TMP("GMTSULT2",$J,GMTSI),^TMP("GMTSULT2",$J,"B",GMTSB),^TMP("GMTSULT2",$J,"EMB"),^TMP("GMTSULT2",$J,"EMI"),^TMP("GMTSULT2",$J,"EM")
"RTN","GMTSULT2",59,0)
FNDQ ; Find Quit
"RTN","GMTSULT2",60,0)
 K:+($G(GMTSDS))>0 GMTSDICS K:+($G(GMTSD0))>0 GMTSDIC0
"RTN","GMTSULT2",61,0)
 Q
"RTN","GMTSULT2",62,0)
 ;                      
"RTN","GMTSULT2",63,0)
PAR ; Parse User Input
"RTN","GMTSULT2",64,0)
 K GMTSWRDS N GMTSC,GMTSCT,GMTSPSN,GMTSTR,GMTSWRD
"RTN","GMTSULT2",65,0)
 S U="^",GMTSTR=$G(X) Q:'$L(GMTSTR)  S GMTSC=1,GMTSCT=0 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSULT2",66,0)
 . S GMTSWRD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWRD D
"RTN","GMTSULT2",67,0)
 . . S GMTSWRD=$TR($E($E(GMTSTR,GMTSC,GMTSPSN-1),1,30),"""",""),GMTSC=GMTSPSN+1
"RTN","GMTSULT2",68,0)
 . . I $L(GMTSWRD)>0 S GMTSCT=GMTSCT+1,GMTSWRDS(GMTSCT)=$$UP(GMTSWRD)
"RTN","GMTSULT2",69,0)
 Q
"RTN","GMTSULT2",70,0)
IENF(X) ; Internal Entry Number Find
"RTN","GMTSULT2",71,0)
 N GMTS0,GMTSI S GMTSI=$G(X),X=$G(X),GMTS0=$G(DIC(0)) S:$E(X,1)="`" GMTSI=$E(GMTSI,2,$L(GMTSI)) S GMTSI=+GMTSI
"RTN","GMTSULT2",72,0)
 I GMTS0["N",+GMTSI>0,$D(^GMT(142,+GMTSI,0)) S X=+GMTSI Q X
"RTN","GMTSULT2",73,0)
 I $E(X,1)="`",+GMTSI>0,$D(^GMT(142,+GMTSI,0)) S X=+GMTSI Q X
"RTN","GMTSULT2",74,0)
 Q -1
"RTN","GMTSULT2",75,0)
IENS(X) ; Internal Entry Number Save
"RTN","GMTSULT2",76,0)
 N GMTSI1,GMTSI2,GMTSI3,GMTSIEN S (GMTSIEN,GMTSI1)=+X Q:+GMTSI1=0  Q:'$D(^GMT(142,+GMTSI1,0))
"RTN","GMTSULT2",77,0)
 D SM^GMTSULT3,REO^GMTSULT3
"RTN","GMTSULT2",78,0)
 Q
"RTN","GMTSULT2",79,0)
CM(X) ; Get Number of Components
"RTN","GMTSULT2",80,0)
 S X=+($G(X)) Q:X=0 "No components" Q:'$D(^GMT(142,+X,1)) "No components"
"RTN","GMTSULT2",81,0)
 N GMTSI,GMTSC S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,+X,1,GMTSI)) Q:+GMTSI=0  S GMTSC=GMTSC+1
"RTN","GMTSULT2",82,0)
 S X=$S(+GMTSC>1:(+GMTSC_" components"),+GMTSC=1:(+GMTSC_" component"),1:"No components")
"RTN","GMTSULT2",83,0)
 Q X
"RTN","GMTSULT2",84,0)
EM(X) ; Exact Match when DIC(0) contains X
"RTN","GMTSULT2",85,0)
 S X=$G(X) Q:'$L(X) -1 N GMTSC,GMTSI,GMTSM,GMTSN,GMTSO,GMTSU S U="^"
"RTN","GMTSULT2",86,0)
 S GMTSU=$$UP(X),(GMTSC,GMTSO)=$$UP($E(X,1,30)),GMTSM=0,GMTSO=$E(GMTSO,1,($L(GMTSO)-1))_$C($A($E(GMTSO,$L(GMTSO)))-1)_"~",GMTSM=0
"RTN","GMTSULT2",87,0)
 F  S GMTSO=$O(^GMT(142,"AB",GMTSO)) Q:GMTSO=""!(GMTSO'[GMTSC)  D  Q:+GMTSM>0
"RTN","GMTSULT2",88,0)
 . S GMTSI=0 F  S GMTSI=$O(^GMT(142,"AB",GMTSO,GMTSI)) Q:+GMTSI=0  D  Q:+GMTSM>0
"RTN","GMTSULT2",89,0)
 . . S GMTSN=$P($G(^GMT(142,+GMTSI,0)),U,1) S:$$UP(GMTSN)=GMTSU GMTSM=GMTSI_U_GMTSN
"RTN","GMTSULT2",90,0)
 S:+GMTSM=0 GMTSM=-1 S X=GMTSM D Y^GMTSULT6(+GMTSM)
"RTN","GMTSULT2",91,0)
 Q X
"RTN","GMTSULT2",92,0)
 ;                      
"RTN","GMTSULT2",93,0)
DICS(S,X,DA) ; Check DIC("S") Screen
"RTN","GMTSULT2",94,0)
 ;   LAYGO allowed (no screen)
"RTN","GMTSULT2",95,0)
 I +($G(GMTSLGO))=142,$G(GMTSDIC0)["L" Q 1
"RTN","GMTSULT2",96,0)
 ;   LAYGO not allowed (screen)
"RTN","GMTSULT2",97,0)
 N Y,GMTST,GMTSOX,GMTSDICS S GMTSDICS=$G(S),GMTSOX=$G(X) S X=GMTSDICS Q:'$L(GMTSDICS) 1
"RTN","GMTSULT2",98,0)
 D ^DIM Q:'$L($G(X)) 1
"RTN","GMTSULT2",99,0)
 S (Y,DA)=+($G(DA)),GMTST=$G(^GMT(142,+Y,0)),X=GMTSOX X GMTSDICS S X=$T Q X
"RTN","GMTSULT2",100,0)
 ;                      
"RTN","GMTSULT2",101,0)
 ; Processing flags
"RTN","GMTSULT2",102,0)
EMQ(X) ;   Exact match flag
"RTN","GMTSULT2",103,0)
 N GMTS0 S X=0,GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",104,0)
 S:$G(GMTS0)["X" X=1 Q X
"RTN","GMTSULT2",105,0)
EMO(X) ;   Exact match flag, only one
"RTN","GMTSULT2",106,0)
 N GMTS0 S X=0 S GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",107,0)
 S:$G(GMTS0)["O"&($G(GMTS0)["E") X=1 Q X
"RTN","GMTSULT2",108,0)
BI(X) ;   Use the B Index flag
"RTN","GMTSULT2",109,0)
 N GMTS0 S X=0 S GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",110,0)
 S:$G(GMTS0)["B" X=1 Q X
"RTN","GMTSULT2",111,0)
IF(X) ;   Internal Entry Number Flag
"RTN","GMTSULT2",112,0)
 N GMTS0,GMTSI S GMTSI=0,GMTS0=$G(DIC(0)) Q:'$L($G(X)) 0
"RTN","GMTSULT2",113,0)
 I $E(X,1)="`",$L($G(^GMT(142,+($E(X,2,$L(X))),0))) S GMTSI=1
"RTN","GMTSULT2",114,0)
 I +X>0,$L($G(^GMT(142,+X,0))),GMTS0["N" S GMTSI=1
"RTN","GMTSULT2",115,0)
 S X=GMTSI Q X
"RTN","GMTSULT2",116,0)
 ;                      
"RTN","GMTSULT2",117,0)
 ; TMP Global
"RTN","GMTSULT2",118,0)
TMP ;   Show first ^TMP Global
"RTN","GMTSULT2",119,0)
 N GMTSND,GMTSNC,GMTSNQ,GMTSC,GMTSTMP
"RTN","GMTSULT2",120,0)
 S GMTSC=0,GMTSTMP="",GMTSNQ="^TMP(""GMTSULT2"","_$J_")",GMTSNC="^TMP(""GMTSULT2"","_$J_","
"RTN","GMTSULT2",121,0)
 F  S GMTSNQ=$Q(@GMTSNQ) Q:GMTSNQ=""!(GMTSNQ'[GMTSNC)  D
"RTN","GMTSULT2",122,0)
 . S GMTSC=GMTSC+1 W:GMTSC=1 ! S GMTSND=@GMTSNQ W !,GMTSNQ,"=",GMTSND
"RTN","GMTSULT2",123,0)
 W:GMTSC>0 !
"RTN","GMTSULT2",124,0)
TMP2 ;   Show second ^TMP Global
"RTN","GMTSULT2",125,0)
 S GMTSC=0,GMTSNQ="^TMP(""GMTSULT"","_$J_")",GMTSNC="^TMP(""GMTSULT"","_$J_","
"RTN","GMTSULT2",126,0)
 F  S GMTSNQ=$Q(@GMTSNQ) Q:GMTSNQ=""!(GMTSNQ'[GMTSNC)  D
"RTN","GMTSULT2",127,0)
 . S GMTSC=GMTSC+1 W:'$D(GMTSTMP)&(GMTSC=1) ! S GMTSND=@GMTSNQ W !,GMTSNQ,"=",GMTSND
"RTN","GMTSULT2",128,0)
 W:GMTSC>0 !
"RTN","GMTSULT2",129,0)
 Q
"RTN","GMTSULT2",130,0)
 ; Miscellaneous
"RTN","GMTSULT2",131,0)
UP(X) ;   Uppercase
"RTN","GMTSULT2",132,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSULT2",133,0)
OW(X) ;   Mix Case (owner name)
"RTN","GMTSULT2",134,0)
 Q:$G(X)'["," $$EN^GMTSUMX($G(X))
"RTN","GMTSULT2",135,0)
 Q $$EN^GMTSUMX(($P($G(X),",",1)_", "_$P($G(X),",",2)))
"RTN","GMTSULT2",136,0)
MX(X) ;   Mix Case
"RTN","GMTSULT2",137,0)
 Q $$EN^GMTSUMX(X)
"RTN","GMTSULT3")
0^3^B22116878
"RTN","GMTSULT3",1,0)
GMTSULT3 ; SLC/KER - HS Type Lookup (Save)          ; 08/26/1999
"RTN","GMTSULT3",2,0)
 ;;2.7;Health Summary;**30,32**;Oct 20, 1995
"RTN","GMTSULT3",3,0)
 ;
"RTN","GMTSULT3",4,0)
 Q
"RTN","GMTSULT3",5,0)
SM ; Save match
"RTN","GMTSULT3",6,0)
 ;                      
"RTN","GMTSULT3",7,0)
 ;   GMTSIEN    Type Internal Entry Number
"RTN","GMTSULT3",8,0)
 ;   GMTSKWRD   Keyword from AW index
"RTN","GMTSULT3",9,0)
 ;   GMTSWRDS   Parsed word array
"RTN","GMTSULT3",10,0)
 ;   GMTSEO     Exact Match (One)      OE
"RTN","GMTSULT3",11,0)
 ;   GMTSEQ     Exact Match Required   X
"RTN","GMTSULT3",12,0)
 ;   GMTSIF     Interal Entry Number   N
"RTN","GMTSULT3",13,0)
 ;                      
"RTN","GMTSULT3",14,0)
 S GMTSIEN=+($G(GMTSIEN)),GMTSKWRD=$G(GMTSKWRD),GMTSEO=+($G(GMTSEO)),GMTSEQ=+($G(GMTSEQ)),GMTSIF=+($G(GMTSIF)),U="^"
"RTN","GMTSULT3",15,0)
 N GMTSCOMP,GMTSCF,GMTSWRD,GMTSWDS,GMTSEQ,GMTSLOK,GMTSOK,GMTSLT,GMTSLI,GMTSASM,GMTSI1,GMTSI2,GMTSI3,GMTSNAM,GMTSTTL,GMTSOW,GMTSLOC,GMTSCMP,GMTSRC
"RTN","GMTSULT3",16,0)
 S (GMTSNAM,GMTSTTL,GMTSOW,GMTSLOC,GMTSCMP,GMTSRC)="",GMTSLOK=0,GMTSRC="Name",GMTSWRD=$G(GMTSWRDS(1)),GMTSWDS=+($O(GMTSWRDS(" "),-1))
"RTN","GMTSULT3",17,0)
 ; Get Internal Entry Number (IEN)
"RTN","GMTSULT3",18,0)
 S GMTSI1=+($G(GMTSIEN)) Q:'$D(^GMT(142,GMTSI1,0))
"RTN","GMTSULT3",19,0)
 ; Check Screen - DIC("S")
"RTN","GMTSULT3",20,0)
 S GMTSOK=1 I $L($G(GMTSDICS)) S GMTSOK=$$DICS^GMTSULT2(GMTSDICS,X,GMTSI1) Q:'GMTSOK
"RTN","GMTSULT3",21,0)
 ; Get Health Summary Type
"RTN","GMTSULT3",22,0)
 ;   Components
"RTN","GMTSULT3",23,0)
 S GMTSCMP=$$CM^GMTSULT2(+GMTSI1)
"RTN","GMTSULT3",24,0)
 ;   Name
"RTN","GMTSULT3",25,0)
 S GMTSNAM=$P($G(^GMT(142,+GMTSI1,0)),U,1)
"RTN","GMTSULT3",26,0)
 ;   Title
"RTN","GMTSULT3",27,0)
 S GMTSTTL=$P($G(^GMT(142,+GMTSI1,"T")),U,1)
"RTN","GMTSULT3",28,0)
 S:$L(GMTSTTL) GMTSRC="Title"
"RTN","GMTSULT3",29,0)
 ;   Owner
"RTN","GMTSULT3",30,0)
 S GMTSOW=+($P($G(^GMT(142,+GMTSI1,0)),U,3)) S:GMTSOW<1 GMTSOW="" S:+GMTSOW>0 GMTSOW=$P($G(^VA(200,+GMTSOW,0)),U,1)
"RTN","GMTSULT3",31,0)
 I $L($G(GMTSKWRD)) S:$L(GMTSOW)&(GMTSOW[GMTSKWRD) GMTSRC="Title/Owner"
"RTN","GMTSULT3",32,0)
 ;   Name/Title
"RTN","GMTSULT3",33,0)
 D NT^GMTSULT4
"RTN","GMTSULT3",34,0)
 ;   Location
"RTN","GMTSULT3",35,0)
 D LC^GMTSULT4
"RTN","GMTSULT3",36,0)
 S:'$L($G(GMTSLT("C")))&($L($G(GMTSLI("C")))) GMTSLOC=$G(GMTSLI("C"))
"RTN","GMTSULT3",37,0)
 ; Get Composite String
"RTN","GMTSULT3",38,0)
 D CMA^GMTSULT4
"RTN","GMTSULT3",39,0)
 ; Find words in string
"RTN","GMTSULT3",40,0)
 S (GMTSCF,GMTSFND)=0 I GMTSWDS>0 F GMTSI=1:1:GMTSWDS D
"RTN","GMTSULT3",41,0)
 . Q:'$L(GMTSWRDS(GMTSI))
"RTN","GMTSULT3",42,0)
 . S GMTSCF=+($$CHKW^GMTSULT4(GMTSWRDS(GMTSI)))
"RTN","GMTSULT3",43,0)
 . S:GMTSCF GMTSFND=GMTSFND+1
"RTN","GMTSULT3",44,0)
 . S:$L(GMTSOW)&(GMTSOW[$$UP^GMTSULT2(GMTSWRDS(GMTSI))) GMTSRC="Title/Owner"
"RTN","GMTSULT3",45,0)
 ;
"RTN","GMTSULT3",46,0)
 ; If input is not an Internal Entry Number    +GMTSIF=0
"RTN","GMTSULT3",47,0)
 ; and not all of the words were found          GMTSFND'=GMTSWDS
"RTN","GMTSULT3",48,0)
 ; then quit
"RTN","GMTSULT3",49,0)
 ;
"RTN","GMTSULT3",50,0)
 Q:'(+($G(GMTSIF)))&(GMTSFND'=GMTSWDS)
"RTN","GMTSULT3",51,0)
 ;                      
"RTN","GMTSULT3",52,0)
 ; Save Health Summary Type
"RTN","GMTSULT3",53,0)
 ;   Exact match only        DIC(0)["O" & DIC(0)["E"
"RTN","GMTSULT3",54,0)
 I '(+($G(GMTSIF))),+($G(GMTSEO)),($$UP^GMTSULT2(GMTSNAM)'=$$UP^GMTSULT2(X)&($$UP^GMTSULT2(GMTSLOC)'=$$UP^GMTSULT2(X))) Q
"RTN","GMTSULT3",55,0)
 S:$L(GMTSLOC) GMTSRC="Location"
"RTN","GMTSULT3",56,0)
 ;   Quit if Health Summary is already saved
"RTN","GMTSULT3",57,0)
 Q:$D(^TMP("GMTSULT2",$J,"IEN",+GMTSI1))&(+($G(^TMP("GMTSULT2",$J,"EM")))'=+GMTSI1)
"RTN","GMTSULT3",58,0)
 ;                      
"RTN","GMTSULT3",59,0)
 ;   Assemble string and store in TMP Global
"RTN","GMTSULT3",60,0)
 ;      IEN^Name^Title^Owner^Location^Components^Source
"RTN","GMTSULT3",61,0)
 S GMTSC=+($O(^TMP("GMTSULT2",$J," "),-1))+1
"RTN","GMTSULT3",62,0)
 S GMTSASM=GMTSI1_U_GMTSNAM_U_GMTSTTL_U_GMTSOW_U_GMTSLOC_U_GMTSCMP_U_GMTSRC
"RTN","GMTSULT3",63,0)
 S ^TMP("GMTSULT2",$J,"IEN",+GMTSI1)="",^TMP("GMTSULT2",$J,GMTSC)=GMTSASM,^TMP("GMTSULT2",$J,"B",(GMTSNAM_" "),GMTSC)=""
"RTN","GMTSULT3",64,0)
 S:+($G(^TMP("GMTSULT2",$J,"EM")))=GMTSI1 ^TMP("GMTSULT2",$J,"EMI")=GMTSC,^TMP("GMTSULT2",$J,"EMB")=GMTSNAM_" "
"RTN","GMTSULT3",65,0)
 Q
"RTN","GMTSULT3",66,0)
 ;                      
"RTN","GMTSULT3",67,0)
REO ; Reorder List
"RTN","GMTSULT3",68,0)
 S GMTSEO=+($G(GMTSEO)),GMTSEQ=+($G(GMTSEQ)),GMTSIF=+($G(GMTSIF))
"RTN","GMTSULT3",69,0)
 N GMTSC,GMTSFND,GMTSG,GMTSI,GMTSIEN,GMTSKEY,GMTSL,GMTSCMP,GMTSOW,GMTSTTL,GMTSLOC,GMTSMN,GMTSNM
"RTN","GMTSULT3",70,0)
 S GMTSI=0,GMTSFND=""
"RTN","GMTSULT3",71,0)
 ;   Add exact match to the top of the selection list
"RTN","GMTSULT3",72,0)
 I '$D(^TMP("GMTSULT2",$J,"E")),+($G(GMTSEO)) K ^TMP("GMTSULT2",$J)
"RTN","GMTSULT3",73,0)
 I $D(^TMP("GMTSULT2",$J,"E")) D
"RTN","GMTSULT3",74,0)
 . S GMTSI=0,GMTSC="E" D ADD
"RTN","GMTSULT3",75,0)
 . S ^TMP("GMTSULT",$J,0)=GMTSI
"RTN","GMTSULT3",76,0)
 . K ^TMP("GMTSULT2",$J,"E")
"RTN","GMTSULT3",77,0)
 . ;   Kill global (quit) if Exact Match is found
"RTN","GMTSULT3",78,0)
 . ;     and DIR(0) either contains OE or X
"RTN","GMTSULT3",79,0)
 . K:+($G(GMTSEQ)) ^TMP("GMTSULT2",$J) K:+($G(GMTSEO)) ^TMP("GMTSULT2",$J)
"RTN","GMTSULT3",80,0)
 ;   Kill global (quit) if Exact Match is not
"RTN","GMTSULT3",81,0)
 ;     found and DIR(0)["OE"
"RTN","GMTSULT3",82,0)
 I '$D(^TMP("GMTSULT2",$J,"E")),+($G(GMTSEO)) K ^TMP("GMTSULT2",$J)
"RTN","GMTSULT3",83,0)
 ;   Add remaining entries in Alphabetical Order
"RTN","GMTSULT3",84,0)
 F  S GMTSFND=$O(^TMP("GMTSULT2",$J,"B",GMTSFND)) Q:GMTSFND=""  D
"RTN","GMTSULT3",85,0)
 . S GMTSC=0 F  S GMTSC=$O(^TMP("GMTSULT2",$J,"B",GMTSFND,GMTSC)) Q:+GMTSC=0  D
"RTN","GMTSULT3",86,0)
 . . D ADD
"RTN","GMTSULT3",87,0)
 D CLEAN^GMTSULT
"RTN","GMTSULT3",88,0)
 Q
"RTN","GMTSULT3",89,0)
 ;                      
"RTN","GMTSULT3",90,0)
ADD ; Add to list in appropriate order
"RTN","GMTSULT3",91,0)
 N GMTS0,GMTS1,GMTS2,GMTS3,GMTS4,GMTS5,GMTS6,GMTS7
"RTN","GMTSULT3",92,0)
 S GMTSI=+($G(GMTSI))+1,GMTS0=$G(^TMP("GMTSULT2",$J,GMTSC))
"RTN","GMTSULT3",93,0)
 ;                      
"RTN","GMTSULT3",94,0)
 ;   Piece    Data Element
"RTN","GMTSULT3",95,0)
 ;                      
"RTN","GMTSULT3",96,0)
 ;     1      Internal Entry Number
"RTN","GMTSULT3",97,0)
 S (GMTS1,GMTSIEN)=+($P(GMTS0,U,1))
"RTN","GMTSULT3",98,0)
 ;     2      Health Summary Name
"RTN","GMTSULT3",99,0)
 S (GMTSG,GMTSMN,GMTS2)=$$MX^GMTSULT2($P(GMTS0,U,2))
"RTN","GMTSULT3",100,0)
 S GMTSNM=$$UP^GMTSULT2(GMTSMN)
"RTN","GMTSULT3",101,0)
 ;     3      Health Summary Title
"RTN","GMTSULT3",102,0)
 S (GMTS3,GMTSTTL)=$$MX^GMTSULT2($P(GMTS0,U,3)),GMTSTTL=GMTSTTL_")"
"RTN","GMTSULT3",103,0)
 ;     4      Health Summary Owner
"RTN","GMTSULT3",104,0)
 S (GMTS4,GMTSOW)=$$MX^GMTSULT2($P(GMTS0,U,4)),GMTSOW=GMTSOW_")"
"RTN","GMTSULT3",105,0)
 ;     5      Health Summary Location
"RTN","GMTSULT3",106,0)
 S (GMTS5,GMTSLOC)=$$MX^GMTSULT2($P(GMTS0,U,5)),GMTSLOC=GMTSLOC_")"
"RTN","GMTSULT3",107,0)
 ;     6      Health Summary Components
"RTN","GMTSULT3",108,0)
 S (GMTS6,GMTSCMP)=$P(GMTS0,U,6)
"RTN","GMTSULT3",109,0)
 S GMTSL=$P(GMTS0,U,4)
"RTN","GMTSULT3",110,0)
 ;     7      Recommended Display Text
"RTN","GMTSULT3",111,0)
 S GMTSKEY=$$UP^GMTSULT2($P(GMTS0,U,7))
"RTN","GMTSULT3",112,0)
 ;   Recommended Display Text
"RTN","GMTSULT3",113,0)
 D RDT^GMTSULT4
"RTN","GMTSULT3",114,0)
 ;   Assemble string and store in TMP Global
"RTN","GMTSULT3",115,0)
 ;      IEN^Name^Title^Owner^Location^Components^Display Text
"RTN","GMTSULT3",116,0)
 S:$L(GMTSG)&(GMTSG'[")")&(GMTSG'["(")&(+GMTS6=0)&($L(GMTS6)) GMTSG=GMTSG_" ("_GMTS6_")" S GMTS7=GMTSG
"RTN","GMTSULT3",117,0)
 S ^TMP("GMTSULT",$J,GMTSI)=GMTS1_U_GMTS2_U_GMTS3_U_GMTS4_U_GMTS5_U_GMTS6_U_GMTS7
"RTN","GMTSULT3",118,0)
 S ^TMP("GMTSULT",$J,0)=GMTSI
"RTN","GMTSULT3",119,0)
 Q
"RTN","GMTSULT4")
0^4^B31846865
"RTN","GMTSULT4",1,0)
GMTSULT4 ; SLC/KER - HS Type Lookup (Array)         ; 08.26/1999
"RTN","GMTSULT4",2,0)
 ;;2.7;Health Summary;**30,32**;Oct 20, 1995
"RTN","GMTSULT4",3,0)
 ;
"RTN","GMTSULT4",4,0)
 Q
"RTN","GMTSULT4",5,0)
NT ; In Name/Title Array
"RTN","GMTSULT4",6,0)
 Q:$D(GMTSINPT)  Q:+GMTSWDS'>0  K GMTSLT D CMN
"RTN","GMTSULT4",7,0)
 S GMTSFND=0,GMTSLT("W")=+($G(GMTSWDS))
"RTN","GMTSULT4",8,0)
 N GMTSNT F GMTSI=1:1:GMTSWDS D
"RTN","GMTSULT4",9,0)
 . Q:'$L(GMTSWRDS(GMTSI))
"RTN","GMTSULT4",10,0)
 . S GMTSNT=+($$CHKW(GMTSWRDS(GMTSI)))
"RTN","GMTSULT4",11,0)
 . S:GMTSNT GMTSFND=GMTSFND+1,GMTSLT(GMTSI1)=(+($G(GMTSLT(GMTSI1)))+1)
"RTN","GMTSULT4",12,0)
 I GMTSFND>0,GMTSFND=GMTSWDS,'$D(GMTSLT(GMTSI1)) S GMTSLT(0)=+($G(GMTSLT(0)))+1
"RTN","GMTSULT4",13,0)
 ; Reorder
"RTN","GMTSULT4",14,0)
 S GMTSFND=0 F  S GMTSFND=$O(GMTSLT(GMTSFND)) Q:+GMTSFND=0  D
"RTN","GMTSULT4",15,0)
 . S:+($G(GMTSLT(GMTSFND)))>0&(+($G(GMTSLT(GMTSFND)))=+($G(GMTSLT("W")))) GMTSLT("B",+GMTSFND)=""
"RTN","GMTSULT4",16,0)
 . K:+($G(GMTSLT(GMTSFND)))>0&(+($G(GMTSLT(GMTSFND)))'=+($G(GMTSLT("W")))) GMTSLT(+GMTSFND)
"RTN","GMTSULT4",17,0)
 K GMTSLT("W") K:'$D(GMTSLT("B")) GMTSLT
"RTN","GMTSULT4",18,0)
 S:$D(GMTSLT("B")) GMTSLT("C")=$$MX($P($G(^GMT(142,+($G(GMTSIEN)),0)),"^",1))
"RTN","GMTSULT4",19,0)
 Q
"RTN","GMTSULT4",20,0)
LC ; Location Array  (Needs either GMTSIEN or GMTSI1)
"RTN","GMTSULT4",21,0)
 Q:$D(GMTSINPT)  Q:+GMTSWDS'>0
"RTN","GMTSULT4",22,0)
 I '$D(GMTSI1),$D(GMTSIEN),$D(^GMT(142,+($G(GMTSIEN)),0)) N GMTSI1 S GMTSI1=+($G(GMTSIEN))
"RTN","GMTSULT4",23,0)
 Q:'$D(GMTSI1)
"RTN","GMTSULT4",24,0)
 N GMTSF,GMTSI,GMTSI2,GMTSI3,GMTSL,GMTSLC K GMTSLI
"RTN","GMTSULT4",25,0)
 S GMTSI2=0  F  S GMTSI2=$O(^GMT(142,GMTSI1,20,GMTSI2)) Q:+GMTSI2=0  D
"RTN","GMTSULT4",26,0)
 . S GMTSI3=+($G(^GMT(142,GMTSI1,20,GMTSI2,0)))
"RTN","GMTSULT4",27,0)
 . S GMTSL=$P($G(^SC(+GMTSI3,0)),"^",1)
"RTN","GMTSULT4",28,0)
 . S GMTSF=0 I GMTSWDS>0 S GMTSLI("W")=+($G(GMTSWDS))
"RTN","GMTSULT4",29,0)
 . F GMTSI=1:1:GMTSWDS D
"RTN","GMTSULT4",30,0)
 . . Q:'$L(GMTSWRDS(GMTSI))
"RTN","GMTSULT4",31,0)
 . . S:$$UP(GMTSL)[$$UP(GMTSWRDS(GMTSI)) GMTSF=GMTSF+1
"RTN","GMTSULT4",32,0)
 . I GMTSF=GMTSWDS D
"RTN","GMTSULT4",33,0)
 . . S:'$D(GMTSLI(GMTSI1,GMTSI2)) GMTSLI(0)=+($G(GMTSLI(0)))+1
"RTN","GMTSULT4",34,0)
 . . S GMTSLI(GMTSI2)=GMTSF_"^"_GMTSL
"RTN","GMTSULT4",35,0)
 . . S GMTSLI("I")=GMTSI1
"RTN","GMTSULT4",36,0)
 S GMTSF=0 F  S GMTSF=$O(GMTSLI(GMTSF)) Q:+GMTSF=0  D
"RTN","GMTSULT4",37,0)
 . S:+($G(GMTSLI(GMTSF)))>0&(+($G(GMTSLI(GMTSF)))=+($G(GMTSLI("W")))) GMTSLI("B",+GMTSF)=""
"RTN","GMTSULT4",38,0)
 . K:+($G(GMTSLI(GMTSF)))>0&(+($G(GMTSLI(GMTSF)))'=+($G(GMTSLI("W")))) GMTSLI(+GMTSF)
"RTN","GMTSULT4",39,0)
 K:'$D(GMTSLI("B")) GMTSLI
"RTN","GMTSULT4",40,0)
 I $D(GMTSLI("B"))  D
"RTN","GMTSULT4",41,0)
 . N GMTSI,GMTSC,GMTST,GMTSE S (GMTSE,GMTSC)=0,GMTST=+($G(GMTSLI(0))) Q:GMTST=0
"RTN","GMTSULT4",42,0)
 . S GMTSI="",GMTSF=0 F  S GMTSF=$O(GMTSLI(GMTSF)) Q:GMTSE  Q:+GMTSF=0  D  Q:GMTSE
"RTN","GMTSULT4",43,0)
 . . I ($L($G(GMTSI))+$L($P($G(GMTSLI(GMTSF)),"^",2)))>60 S GMTSI="",GMTSE=1 Q
"RTN","GMTSULT4",44,0)
 . . S GMTSC=GMTSC+1
"RTN","GMTSULT4",45,0)
 . . S:GMTSI'=""&(GMTSC>1)&(GMTSC'=GMTST) GMTSI=GMTSI_", "_$$MX($P(GMTSLI(GMTSF),"^",2))
"RTN","GMTSULT4",46,0)
 . . S:GMTSI'=""&(GMTSC>1)&(GMTSC=GMTST) GMTSI=GMTSI_" and "_$$MX($P(GMTSLI(GMTSF),"^",2))
"RTN","GMTSULT4",47,0)
 . . S:GMTSI="" GMTSI=$$MX($P(GMTSLI(GMTSF),"^",2))
"RTN","GMTSULT4",48,0)
 . S:$L(GMTSI) GMTSLI("C")=GMTSI
"RTN","GMTSULT4",49,0)
 K:'$D(GMTSLI("C")) GMTSLI K GMTSLI("W")
"RTN","GMTSULT4",50,0)
 Q
"RTN","GMTSULT4",51,0)
CHKW(X) ; Check Words
"RTN","GMTSULT4",52,0)
 S X=$$UP($G(X)) Q:'$L(X) 0
"RTN","GMTSULT4",53,0)
 N I,OK S OK=0,I=0 F  S I=$O(GMTSCOMP(I)) Q:+I=0  S:$$UP($G(GMTSCOMP(I)))[X OK=1 Q:OK
"RTN","GMTSULT4",54,0)
 S X=+($G(OK)) Q X
"RTN","GMTSULT4",55,0)
 ;                             
"RTN","GMTSULT4",56,0)
CM ; Composite Array 
"RTN","GMTSULT4",57,0)
 K GMTSCOMP S GMTSIEN=+($G(GMTSIEN)) G:GMTSIEN=0 CMQ
"RTN","GMTSULT4",58,0)
 N GMTSWL,GMTSL,GMTS2
"RTN","GMTSULT4",59,0)
 D:$D(GMTSNAM) CMP($$UP($$UP(GMTSNAM))) D:'$D(GMTSNAM) CMP($$UP($P($G(^GMT(142,+GMTSIEN,0)),"^",1)))
"RTN","GMTSULT4",60,0)
 D:$D(GMTSTTL) CMP($$UP($G(GMTSTTL))) D:'$D(GMTSTTL) CMP($$UP($P($G(^GMT(142,+GMTSIEN,"T")),"^",1)))
"RTN","GMTSULT4",61,0)
 D:$D(GMTSOW) CMP($$UP($G(GMTSOW))) I '$D(GMTSOW),+($P($G(^GMT(142,+GMTSIEN,0)),"^",3))>1 D CMP($$UP($P($G(^VA(200,+($P($G(^GMT(142,+GMTSIEN,0)),"^",3)),0)),"^",1)))
"RTN","GMTSULT4",62,0)
 G:$D(GMTSNO) CMQ
"RTN","GMTSULT4",63,0)
 S GMTS2=0  F  S GMTS2=$O(^GMT(142,GMTSIEN,20,GMTS2)) Q:+GMTS2=0  D
"RTN","GMTSULT4",64,0)
 . S GMTSL=+($G(^GMT(142,GMTSIEN,20,GMTS2,0)))
"RTN","GMTSULT4",65,0)
 . S GMTSL=$P($G(^SC(+GMTSL,0)),"^",1) D CMP($$UP(GMTSL))
"RTN","GMTSULT4",66,0)
CMQ ;   Composite Array Quit
"RTN","GMTSULT4",67,0)
 D CMC Q
"RTN","GMTSULT4",68,0)
CMA ;   Composite Array (name only)
"RTN","GMTSULT4",69,0)
 N GMTSNO D CM Q
"RTN","GMTSULT4",70,0)
CMN ;   Composite Array (name only)
"RTN","GMTSULT4",71,0)
 N GMTSNO S GMTSNO="" D CM Q
"RTN","GMTSULT4",72,0)
CMP(X) ;   Composite Array Word Parse
"RTN","GMTSULT4",73,0)
 N GMTSX,GMTSP,GMTSC,GMTSW S GMTSX=$G(X) Q:'$L(GMTSX)
"RTN","GMTSULT4",74,0)
 S GMTSC=1 F GMTSP=1:1:$L(GMTSX)+1 D
"RTN","GMTSULT4",75,0)
 . S GMTSW=$E(GMTSX,GMTSP) I "(,.?! '-/&:;)"[GMTSW D
"RTN","GMTSULT4",76,0)
 . . S GMTSW=$E($E(GMTSX,GMTSC,GMTSP-1),1,30),GMTSC=GMTSP+1 I $L(GMTSW)>0 D
"RTN","GMTSULT4",77,0)
 . . . S:$L(GMTSW) GMTSWL(GMTSW)=""
"RTN","GMTSULT4",78,0)
 Q
"RTN","GMTSULT4",79,0)
CMC ;   Composite Array Compile
"RTN","GMTSULT4",80,0)
 S GMTSCOMP("B")="" N GMTSW,GMTSLI S GMTSW=""
"RTN","GMTSULT4",81,0)
 F  S GMTSW=$O(GMTSWL(GMTSW)) Q:GMTSW=""  D
"RTN","GMTSULT4",82,0)
 . I $L(GMTSCOMP("B")_" "_GMTSW)>200 D CMCA S GMTSCOMP("B")=GMTSCOMP("B")_" "_$$UP(GMTSW) K GMTSWL(GMTSW) Q
"RTN","GMTSULT4",83,0)
 . S GMTSCOMP("B")=GMTSCOMP("B")_" "_$$UP(GMTSW) K GMTSWL(GMTSW) Q
"RTN","GMTSULT4",84,0)
 F  Q:$E(GMTSCOMP("B"),1)'=" "  S GMTSCOMP("B")=$E(GMTSCOMP("B"),2,$L(GMTSCOMP("B")))
"RTN","GMTSULT4",85,0)
 S GMTSLI=+($O(GMTSCOMP(" "),-1)) I $D(GMTSCOMP("B")) S GMTSCOMP((GMTSLI+1))=GMTSCOMP("B") K GMTSCOMP("B")
"RTN","GMTSULT4",86,0)
 Q
"RTN","GMTSULT4",87,0)
CMCA ;   Composite Array Compile (Add String)
"RTN","GMTSULT4",88,0)
 N I S I=+($O(GMTSCOMP(" "),-1))+1 S GMTSCOMP(I)=GMTSCOMP("B"),GMTSCOMP("B")=""
"RTN","GMTSULT4",89,0)
 F  Q:$E(GMTSCOMP(I),1)'=" "  S GMTSCOMP(I)=$E(GMTSCOMP(I),2,$L(GMTSCOMP(I)))
"RTN","GMTSULT4",90,0)
 Q
"RTN","GMTSULT4",91,0)
 ;                                   
"RTN","GMTSULT4",92,0)
RDT ;   Recommended Display Text
"RTN","GMTSULT4",93,0)
 ;     Name (used by Location)
"RTN","GMTSULT4",94,0)
 I GMTSKEY["LOC" D
"RTN","GMTSULT4",95,0)
 . Q:'$L(GMTS5)
"RTN","GMTSULT4",96,0)
 . S:$$UP(GMTS2)'=$$UP(GMTS5) GMTSG=GMTSMN_" (used by "_GMTSLOC
"RTN","GMTSULT4",97,0)
 . S:$$UP(GMTSMN)=$$UP(GMTSLOC) GMTSG=GMTSMN
"RTN","GMTSULT4",98,0)
 ;     Name (Title)
"RTN","GMTSULT4",99,0)
 I GMTSKEY["TITL",GMTSKEY'["OWN" D
"RTN","GMTSULT4",100,0)
 . Q:'$L(GMTS3)
"RTN","GMTSULT4",101,0)
 . I $$UP(GMTS3)=$$UP(GMTS2) S GMTSG=GMTS2 Q
"RTN","GMTSULT4",102,0)
 . S:GMTSKEY["TITL"&($$UP(GMTSMN)'=$$UP(GMTSL)) GMTSG=GMTSMN_" ("_$$MX(GMTS3)_")"
"RTN","GMTSULT4",103,0)
 . S:GMTSKEY["TITL"&($$UP(GMTSMN)=$$UP(GMTSL)) GMTSG=GMTSMN
"RTN","GMTSULT4",104,0)
 I GMTSKEY["TITL",GMTSKEY["OWN" D
"RTN","GMTSULT4",105,0)
 . Q:'$L(GMTS3)
"RTN","GMTSULT4",106,0)
 . ;     Name (Title, Owner) if Title'=Name and Owner
"RTN","GMTSULT4",107,0)
 . S:$$UP(GMTSMN)'=$$UP(GMTS3)&($L(GMTS4)) GMTSG=GMTSMN_" ("_$$MX(GMTS3)_", HS Owner "_$$OW(GMTSOW)
"RTN","GMTSULT4",108,0)
 . ;     Name (Title) if Title'=Name and no Owner
"RTN","GMTSULT4",109,0)
 . S:$$UP(GMTSMN)'=$$UP(GMTS3)&('$L(GMTS4)) GMTSG=GMTSMN_" ("_$$MX(GMTSTTL)
"RTN","GMTSULT4",110,0)
 . ;     Name (Owner) if Title=Name and Owner
"RTN","GMTSULT4",111,0)
 . S:$$UP(GMTSMN)=$$UP(GMTS3)&($L(GMTS4)) GMTSG=GMTSMN_" (HS Owner "_$$OW(GMTSOW)
"RTN","GMTSULT4",112,0)
 . S:$$UP(GMTSMN)=$$UP(GMTS3)&('$L(GMTS4)) GMTSG=GMTSMN
"RTN","GMTSULT4",113,0)
 ;                      
"RTN","GMTSULT4",114,0)
 ;   Assemble string and store in TMP Global
"RTN","GMTSULT4",115,0)
 ;      IEN^Name^Title^Owner^Location^Components^Display Text
"RTN","GMTSULT4",116,0)
 S:$L(GMTSG)&(GMTSG'[")")&(GMTSG'["(")&(+GMTS6=0)&($L(GMTS6)) GMTSG=GMTSG_" ("_GMTS6_")" S GMTS7=GMTSG
"RTN","GMTSULT4",117,0)
 S ^TMP("GMTSULT",$J,GMTSI)=GMTS1_U_GMTS2_U_GMTS3_U_GMTS4_U_GMTS5_U_GMTS6_U_GMTS7
"RTN","GMTSULT4",118,0)
 S ^TMP("GMTSULT",$J,0)=GMTSI
"RTN","GMTSULT4",119,0)
 Q
"RTN","GMTSULT4",120,0)
 ;                      
"RTN","GMTSULT4",121,0)
 ; Miscellaneous
"RTN","GMTSULT4",122,0)
UP(X) ;   Uppercase
"RTN","GMTSULT4",123,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSULT4",124,0)
OW(X) ;   Mix Case (owner name)
"RTN","GMTSULT4",125,0)
 Q:$G(X)'["," $$EN^GMTSUMX($G(X))
"RTN","GMTSULT4",126,0)
 Q $$EN^GMTSUMX(($P($G(X),",",1)_", "_$P($G(X),",",2)))
"RTN","GMTSULT4",127,0)
MX(X) ;   Mix Case
"RTN","GMTSULT4",128,0)
 Q $$EN^GMTSUMX(X)
"RTN","GMTSULT6")
0^5^B25882100
"RTN","GMTSULT6",1,0)
GMTSULT6 ; SLC/KER - HS Type Lookup (Select)     ; 08/26/1999
"RTN","GMTSULT6",2,0)
 ;;2.7;Health Summary;**30,32**;Oct 20, 1995
"RTN","GMTSULT6",3,0)
 ;;
"RTN","GMTSULT6",4,0)
 Q
"RTN","GMTSULT6",5,0)
 ;                          
"RTN","GMTSULT6",6,0)
MULTI ; Selection when Multiple Entries are found
"RTN","GMTSULT6",7,0)
 I $L($G(GMTSDICB)),GMTSDEF=1 D DEF Q
"RTN","GMTSULT6",8,0)
 S GMTSDICW=$$DICW($G(GMTSDICW)) K:'$L(GMTSDICW) GMTSDICW
"RTN","GMTSULT6",9,0)
 N GMTSIEN,GMTSE,GMTSO,GMTST,GMTSTOT,GMTSM S GMTSTOT=^TMP("GMTSULT",$J,0) Q:+GMTSTOT=0  I +GMTSTOT=1 D ONE Q
"RTN","GMTSULT6",10,0)
 W ! W:+GMTSTOT>1 !,GMTSTOT," Health Summary Types found"
"RTN","GMTSULT6",11,0)
 N GMTSI,GMTSS,GMTSEX,X,GMTSTR,GMTSTR2,GMTSTR3,GMTSLEN S GMTSLEN=75,GMTSS=0,GMTSEX=0
"RTN","GMTSULT6",12,0)
 ;   List 5 at a time
"RTN","GMTSULT6",13,0)
 F GMTSI=1:1:^TMP("GMTSULT",$J,0) Q:((GMTSS>0)&(GMTSS<GMTSI+1))  Q:GMTSEX  D  Q:GMTSEX
"RTN","GMTSULT6",14,0)
 . S GMTSE=$G(^TMP("GMTSULT",$J,GMTSI))
"RTN","GMTSULT6",15,0)
 . S GMTSM=GMTSI W:GMTSI#5=1 ! W !,$J(GMTSI,4),".  "
"RTN","GMTSULT6",16,0)
 . S GMTSIEN=+GMTSE,(GMTST,GMTSTR)=$P(GMTSE,U,7),GMTSO=$P(GMTSE,U,2)
"RTN","GMTSULT6",17,0)
 . S:'$L(GMTSTR)&($L(GMTSO)) GMTSTR=GMTSO
"RTN","GMTSULT6",18,0)
 . D WRM1
"RTN","GMTSULT6",19,0)
 . W:GMTSI#5=0 ! S:GMTSI#5=0 GMTSS=$$SEL(GMTSM) S:GMTSS["^" GMTSEX=1
"RTN","GMTSULT6",20,0)
 I GMTSI#5'=0,+GMTSS=0 W ! S GMTSS=$$SEL(GMTSM) S:GMTSS["^" GMTSEX=1
"RTN","GMTSULT6",21,0)
 I 'GMTSEX,+GMTSS>0 D  Q
"RTN","GMTSULT6",22,0)
 . N GMTSNAM K Y S Y=+($G(^TMP("GMTSULT",$J,+GMTSS)))
"RTN","GMTSULT6",23,0)
 . S GMTSNAM=$P($G(^GMT(142,+Y,0)),"^",1) I '$L(GMTSNAM) K Y S Y=-1 Q
"RTN","GMTSULT6",24,0)
 . D Y(+Y)
"RTN","GMTSULT6",25,0)
 K Y S Y=-1
"RTN","GMTSULT6",26,0)
 Q
"RTN","GMTSULT6",27,0)
WRM1 ;   Write one entry of muli selection
"RTN","GMTSULT6",28,0)
 N Y,GMTS S Y=+GMTSIEN,GMTS=$G(^GMT(142,+Y,0))
"RTN","GMTSULT6",29,0)
 I '$D(GMTSDICW) W:$L(GMTSTR)'>GMTSLEN GMTSTR D:$L(GMTSTR)>GMTSLEN LONG Q
"RTN","GMTSULT6",30,0)
 I $D(GMTSDICW),$G(GMTSDIC0)'["S" W $P(GMTS,"^",1),"  " X GMTSDICW Q
"RTN","GMTSULT6",31,0)
 I $D(GMTSDICW),$G(GMTSDIC0)["S" X GMTSDICW Q
"RTN","GMTSULT6",32,0)
 Q
"RTN","GMTSULT6",33,0)
SEL(X) ;   Select multiple
"RTN","GMTSULT6",34,0)
 N Y,GMTSM,DTOUT,DUOUT,DIRUT,DIROUT S GMTSM=+($G(X)) Q:GMTSM=0 -1
"RTN","GMTSULT6",35,0)
 S:+($O(^TMP("GMTSULT",$J,+($G(GMTSI)))))>0 DIR("A")="Press <RETURN> for more, '^' to exit, or Select 1-"_GMTSM_":  "
"RTN","GMTSULT6",36,0)
 S:+($O(^TMP("GMTSULT",$J,+($G(GMTSI)))))'>0 DIR("A")="Select 1-"_GMTSM_":  "
"RTN","GMTSULT6",37,0)
 S (DIR("?"),DIR("??"))="Answer must be from 1 to "_GMTSM_", or <Return> to continue  "
"RTN","GMTSULT6",38,0)
 S DIR(0)="NAO^1:"_GMTSM_":0" D ^DIR S:$D(DTOUT)!(X[U) X=U K DIR Q X
"RTN","GMTSULT6",39,0)
 Q
"RTN","GMTSULT6",40,0)
 ;                          
"RTN","GMTSULT6",41,0)
ONE ; One entry on the selection list
"RTN","GMTSULT6",42,0)
 I $L($G(GMTSDICB)),GMTSDEF=1 D DEF Q
"RTN","GMTSULT6",43,0)
 N GMTSEX,GMTSIEN,GMTSTR,GMTSTR2,GMTSY,GMTSX,GMTSLEN,DIR,X
"RTN","GMTSULT6",44,0)
 S GMTSLEN=75,Y=0 S:GMTSQ!($G(GMTSDIC0)["E") GMTSQ=1,Y=1
"RTN","GMTSULT6",45,0)
 S GMTSEX=0
"RTN","GMTSULT6",46,0)
 ;   No Echo or if Ask
"RTN","GMTSULT6",47,0)
 S GMTSIEN=+($G(^TMP("GMTSULT",$J,1)))
"RTN","GMTSULT6",48,0)
 I 'GMTSQ!($G(GMTSDIC0)["A") D
"RTN","GMTSULT6",49,0)
 . N X S GMTSTR=$P($G(^TMP("GMTSULT",$J,1)),U,7)
"RTN","GMTSULT6",50,0)
 . S:'$L(GMTSTR) GMTSTR=$P($G(^TMP("GMTSULT",$J,1)),U,2)
"RTN","GMTSULT6",51,0)
 . D WRO1 S Y=$$OK S:Y["^" GMTSEX=1
"RTN","GMTSULT6",52,0)
 I 'GMTSEX,+Y>0 D  Q
"RTN","GMTSULT6",53,0)
 . N GMTSNAM K Y S Y=+($G(^TMP("GMTSULT",$J,1)))
"RTN","GMTSULT6",54,0)
 . S GMTSNAM=$P($G(^GMT(142,+Y,0)),"^",1) I '$L(GMTSNAM) K Y S Y=-1 Q
"RTN","GMTSULT6",55,0)
 . D Y(+Y)
"RTN","GMTSULT6",56,0)
 K Y S Y=-1
"RTN","GMTSULT6",57,0)
 Q
"RTN","GMTSULT6",58,0)
WRO1 ;   Write one entry of single selection
"RTN","GMTSULT6",59,0)
 W !!,"  " N Y,GMTS S Y=+GMTSIEN,GMTS=$G(^GMT(142,+Y,0))
"RTN","GMTSULT6",60,0)
 I '$D(GMTSDICW) W:$L(GMTSTR)'>GMTSLEN GMTSTR D:$L(GMTSTR)>GMTSLEN LONG W ! Q
"RTN","GMTSULT6",61,0)
 I $D(GMTSDICW),$G(GMTSDIC0)'["S" W $P(GMTS,"^",1),"  " X GMTSDICW W ! Q
"RTN","GMTSULT6",62,0)
 I $D(GMTSDICW),$G(GMTSDIC0)["S" X GMTSDICW W ! Q
"RTN","GMTSULT6",63,0)
 Q
"RTN","GMTSULT6",64,0)
OK(X) ;   Select one if DIC(0)["A" Ask OK
"RTN","GMTSULT6",65,0)
 N DIR,DTOUT,DUOUT,DIROUT S DIR(0)="YAO",DIR("B")="YES"
"RTN","GMTSULT6",66,0)
 S DIR("A")="  OK?  " D ^DIR S:X'["^" X=+Y S:$D(DTOUT)!($D(DUOUT)) X="^" S:X["^" X="^" Q X
"RTN","GMTSULT6",67,0)
 ;                          
"RTN","GMTSULT6",68,0)
DEF ; Select Default Entry
"RTN","GMTSULT6",69,0)
 N GMTSNAM K Y S Y=+($G(^TMP("GMTSULT",$J,1)))
"RTN","GMTSULT6",70,0)
 S GMTSNAM=$P($G(^GMT(142,+Y,0)),"^",1) I '$L(GMTSNAM) K Y S Y=-1 Q
"RTN","GMTSULT6",71,0)
 D Y(+Y)
"RTN","GMTSULT6",72,0)
 Q
"RTN","GMTSULT6",73,0)
 ;                       
"RTN","GMTSULT6",74,0)
 ; Display
"RTN","GMTSULT6",75,0)
LONG ;   Handle a long string
"RTN","GMTSULT6",76,0)
 N GMTSP,GMTSOK,GMTSCHR,GMTSPSN,GMTSTO,GMTSREM,GMTSLN,GMTSOLD S GMTSLN=0,GMTSOLD=GMTSTR,GMTSP=5
"RTN","GMTSULT6",77,0)
 F  Q:$L(GMTSTR)<(GMTSLEN+1)  D PARSE Q:$L(GMTSTR)<(GMTSLEN+1)
"RTN","GMTSULT6",78,0)
 S GMTSLN=GMTSLN+1 W:GMTSLN>1 ! W ?GMTSP,GMTSTR
"RTN","GMTSULT6",79,0)
 Q
"RTN","GMTSULT6",80,0)
PARSE ;   Parse a long string to screen length
"RTN","GMTSULT6",81,0)
 S GMTSOK=0,GMTSCHR="" F GMTSPSN=GMTSLEN:-1:0 Q:+GMTSOK=1  D  Q:+GMTSOK=1
"RTN","GMTSULT6",82,0)
 . I $E(GMTSTR,GMTSPSN)=" " S GMTSCHR=" ",GMTSOK=1 Q
"RTN","GMTSULT6",83,0)
 . I $E(GMTSTR,GMTSPSN)="," S GMTSCHR=",",GMTSOK=1 Q
"RTN","GMTSULT6",84,0)
 . I $E(GMTSTR,GMTSPSN)="/" S GMTSCHR="/",GMTSOK=1 Q
"RTN","GMTSULT6",85,0)
 . I $E(GMTSTR,GMTSPSN)="-" S GMTSCHR="-",GMTSOK=1 Q
"RTN","GMTSULT6",86,0)
 I GMTSCHR=" " S GMTSTO=$E(GMTSTR,1,GMTSPSN-1),GMTSREM=$E(GMTSTR,GMTSPSN+1,$L(GMTSTR))
"RTN","GMTSULT6",87,0)
 I GMTSCHR="," S GMTSTO=$E(GMTSTR,1,GMTSPSN),GMTSREM=$E(GMTSTR,(GMTSPSN+1),$L(GMTSTR)) S:$E(GMTSREM,1)=" " GMTSREM=$E(GMTSREM,2,$L(GMTSREM))
"RTN","GMTSULT6",88,0)
 I GMTSCHR="/" S GMTSTO=$E(GMTSTR,1,GMTSPSN),GMTSREM=$E(GMTSTR,(GMTSPSN+1),$L(GMTSTR)) S:$E(GMTSREM,1)=" " GMTSREM=$E(GMTSREM,2,$L(GMTSREM))
"RTN","GMTSULT6",89,0)
 I GMTSCHR="-" S GMTSTO=$E(GMTSTR,1,GMTSPSN),GMTSREM=$E(GMTSTR,(GMTSPSN+1),$L(GMTSTR)) S:$E(GMTSREM,1)=" " GMTSREM=$E(GMTSREM,2,$L(GMTSREM))
"RTN","GMTSULT6",90,0)
 S GMTSTR=GMTSREM,GMTSLN=GMTSLN+1 W:GMTSLN>1 ! W ?GMTSP,GMTSTO
"RTN","GMTSULT6",91,0)
 Q
"RTN","GMTSULT6",92,0)
DICW(X) ;   Check for valid DIC("W")
"RTN","GMTSULT6",93,0)
 S X=$G(X) Q:'$L(X) ""
"RTN","GMTSULT6",94,0)
 D ^DIM I '$D(X) Q ""
"RTN","GMTSULT6",95,0)
 Q X
"RTN","GMTSULT6",96,0)
 ;                       
"RTN","GMTSULT6",97,0)
 ; Post Selection
"RTN","GMTSULT6",98,0)
Y(X) ;   Set Y
"RTN","GMTSULT6",99,0)
 K Y S X=+($G(X))
"RTN","GMTSULT6",100,0)
 S:X'>0!('$D(^GMT(142,+X,0))) Y=-1 Q:X'>0!('$D(^GMT(142,+X,0)))
"RTN","GMTSULT6",101,0)
 S Y=+X_"^"_$P($G(^GMT(142,+X,0)),"^",1)
"RTN","GMTSULT6",102,0)
 S:$G(GMTSDIC0)["Z"!($G(DIC(0))["Z") Y(0)=$G(^GMT(142,+X,0)),Y(0,0)=$P($G(^GMT(142,+X,0)),"^",1),Y(0,1)=$$MX(Y(0,0))
"RTN","GMTSULT6",103,0)
 I +($G(GMTSWY))=0 W:$G(GMTSDIC0)["E"!($G(DIC(0))["E") "  ",$P($G(^GMT(142,+X,0)),"^",1) S GMTSWY=1
"RTN","GMTSULT6",104,0)
 D:$G(GMTSDIC0)'["F"&($G(DIC(0))'["F") SDISV
"RTN","GMTSULT6",105,0)
 Q
"RTN","GMTSULT6",106,0)
SDISV ;   Save Default Value (Spacebar-Return)
"RTN","GMTSULT6",107,0)
 Q:$G(GMTSDIC0)["F"  Q:+($G(DUZ))=0  Q:'$L($P($G(^VA(200,+($G(DUZ)),0)),"^",1))  Q:+($G(Y))=0  Q:'$D(^GMT(142,+($G(Y)),0))
"RTN","GMTSULT6",108,0)
 S ^DISV(+($G(DUZ)),"^GMT(142,")=+($G(Y))
"RTN","GMTSULT6",109,0)
 Q
"RTN","GMTSULT6",110,0)
MX(X) ; Mix Case
"RTN","GMTSULT6",111,0)
 Q $$EN^GMTSUMX(X)
"VER")
8.0^22.0
**END**
**END**
