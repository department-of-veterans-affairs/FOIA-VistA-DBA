$TXT Created by MOORE,JIM at NXT.KERNEL.FO-OAKLAND.MED.VA.GOV  (KIDS) on Wednesday, 09/13/06 at 11:31
=============================================================================
Run Date: SEP 20, 2006                     Designation: HL*1.6*133
Package : HL - HEALTH LEVEL SEVEN             Priority: Mandatory
Version : 1.6       SEQ #105                    Status: Released
                  Compliance Date: OCT 21, 2006
=============================================================================

Associated patches: (v)HL*1.6*120  <<= must be installed BEFORE `HL*1.6*133'
                    (v)HL*1.6*131  <<= must be installed BEFORE `HL*1.6*133'

Subject: PROTECT HLRESLT

Category: 
  - Routine
  - Data Dictionary

Description:
============

 This patch provides several minor enhancements and bug fixes to the HL7
 software.  A description of each change is listed below:
  
 1.  Adds a new input parameter to the DIRECT^HLMA API.
  
   A new optional input parameter is being added to the DIRECT^HLMA API
   (the Direct Connect) so that applications may specify the maximum time that
   its users must wait for a connection to be established via TCP/IP.
   
   The new parameter is optional, but if provided it sets the maximum
   number of seconds to attempt opening a TCP/IP connection.  It must be
   an integer between 1 and 120.  It is specified as the "OPEN TIMEOUT"
   subscript within the sixth parameter, which must be passed by reference.
   
   DIRECT^HLMA(HLEID,HLARYTYP,HLFORMAT,HLRESLT,HLMTIENO,HLP)
      Description: This API is used to generate synchronous messages via a TCP
                   Logical Link.
      Input:
         The same as GENERATE^HLMA, with one additional subscript to the
         HLP array:
        
         HLP("OPEN TIMEOUT") (optional, pass by reference) A number between 
            1 and 120 that specifies how many seconds the DIRECT CONNECT should
            try to open a connection before failing.  It is left undefined up
            exiting.
   
 2. Fixes a bug whereby the HLRESLT and HLRESLTA variables were not being
  initialized, which could occasionally result in an error message status.
   
 3. Fixes a bug causing extraneous text to occasionally be returned over an
    open TCP connection along with the application acknowledgment. 
  
   The cause is that at the point the receiving application processes a
   received message, if the TCP connection is still open then the 
   application has the opportunity to write extraneous text back over the
   open TCP connection.  This patch fixes the problem by setting the current 
   device to the NULL device before calling the receiving application to
   process the message.
  
  
 4. Adds the CLOSE BEFORE RE-TRANSMISSION (#200.022) field to the HL Logical
    Link (#870) file. 
  
   If set to YES, the HL7 client will always close an open TCP connection and
   re-open it before attempting to re-transmit a message.  Sites should not
   set this field for an exsitng link unless advised to do so.  A situation
   that might warrant setting this new field is where the link seems to
   experience synchronization problems with the remote system related to the
   re-transmission of messages over the same open TCP connection.  
  
 5. Allow application developers to use MOVEMSG^HLOAPI to build HLO
    acknowledgment messages in the traditional way.
  
      
     This item applies to application developers using the HL7 Optimized
     software (HLO). Applications can now build application acknowledgment 
     messages in the 'old' way as an array and use the MOVEMSG^HLOAPI to pass
     the message to the HLO software.   The MOVEMSG^HLOAPI was previously
     released, but did not work with application acknowledgment messages.   
  
  
 6.  Corrected the checking for encoding characters to treat escape and
     sub-component characters as optional for incoming message.
  
  
 7. Fixed bugs of the escape character for APIs, ESCAPE^HLCSHDR1 and
    DEESCAPE^HLTPCK2A.
  
 8. Adds the new $$PROCNOW^HLOAPI3 API to the HLO software that applications
    may use to re-process a message immediately.  This differs from the
    existing $$REPROC^HLOAPI3 API which also re-processes a message, but does
    so by placing the message on a queue for the HLO in-filer process.
  
       $$PROCNOW^HLOAPI3(MSGIEN,PURGE,ERROR) 
       Description: This message will re-process an incoming message immediately.
          
       Input:
             MSGIEN - the ien (file #778) of the message that is to be processed
       Output:
             Function returns 1 on success, 0 on failure
             PURGE (optional) a date/time to purge the message
             ERROR (pass by reference, optional) - on failure, will contain
                    an error message
  
 
  
  Test Sites:
  ===========
  CMOP-NAT
  Palo Alto
  San Francisco
  Montana 
   
  REMEDY:  
  =====
  HD0000000114407
  HD0000000143627
  
  
  ROUTINE SUMMARY:
  ================
  The following is a list of the routine(s) included in this patch.  The
  second line of each of these routine(s) will look like:
     
      <tab>;;1.6;HEALTH LEVEL SEVEN;**[patch list]**;Oct 13, 1995;Build 3
     
                           CHECK^XTSUMBLD results
  Routine name    Before Patch        After Patch         Patch List
  ============    ============        ===========         ==========
 
  HLCSHDR1            10719055           11202914       19,57,59,72,80
                                                          93,120,133
  HLCSTCP              5743704            5992339       19,43,49,57,58
                                                         64,84,109,133
  HLCSTCP1             5982461            6536198       19,43,57,64,71
                                                              133
  HLCSTCP2            11459523           12853094       19,43,49,57,63
                                                        64,66,67,76,77
                                                          87,109,133
  HLCSTCP3             2092970            2382311          76,77,133
  HLMA                 9362505           10219277       19,43,58,63,66
                                                       82,91,109,115,133
  HLMA1                3854162            3836520      19,43,91,109,108
                                                              133
  HLOAPI               9935117            9945563           126,133
  HLOAPI2             10130956           10902941         126,131,133
  HLOAPI3              8603274           11545400           126,133
  HLOCLNT2             9216283            9043934       126,130,131,133
  HLOPRS               8512943            8645215         118,126,133
  HLOPRS1              7271475            7276258         118,131,133
  HLOSRVR1             15627547          15639975       126,130,131,133
  HLTP                 4283999            4300621          14,43,133
  HLTP1                4286011            4292501        34,47,91,133
  HLTP3               16315620           16378017       19,43,57,58,59
                                                       66,69,109,115,108
                                                      116,117,125,120,133
  HLTPCK1              8421534            9001222       8,36,59,120,133
  HLTPCK2              7531833            8095648        19,59,120,133
  HLTPCK2A             8315888            8673535       19,57,59,66,108
                                                            120,133
  HLTPCK2B            14866240           15355890           120,133    
  
  Number of Routines = 21
    
 INSTALLATION INSTRUCTIONS
  =========================
  
   1.  Users are allowed to be on the system during the installation.
  
    2.  Disable the HL7 TCPIP services for the multi-listeners running on 
        all nodes in the cluster, for example:
          ISC6A1> TCPIP
          TCPIP> DISABLE SERVICE HLS5000CACHE  
  
  
    3.  Shutdown all Logical Links, incoming and outgoing filers using
        the Filer and Link Management options listed below:
  
          Stop All Messaging Background Processes [HL STOP ALL]
  
    4.  Use the STOP HLO action of the HLO System Monitor option to
        temporarily stop the transmission of HLO messages.  
   
    5.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
        option will load the KIDS package onto your system.
  
    6.  This patch is now loaded into a transport global on your system.
        The next step is to use KIDS to install the Transport global.  On
        the KIDS menu, under the 'Installation' menu, use the following
        options:
  
           Verify Checksums in Transport Global
           Print Transport Global 
           Compare Transport Global to Current System 
           Backup a Transport Global
           Install Package(s) 
  
        When using the Install Package(s) menu option to install the 
        patch build, you will be asked several questions.  The questions,
        and the answers you should supply, are shown below.
  
        INSTALL NAME: <HL*1.6*133>
        Want KIDS to INHIBIT LOGONS during the install?  <NO>
        Want to DISABLE Scheduled Options, Menu Options,
          and Protocols?  <NO>
  
    7.  Start up all Logical Links and incoming and outgoing filers using
        the Filer and Link Management Option's 'Restart/Start All Links
        and Filers [HL TASK RESTART]' menu option.
  
        (Note those links that do not have "autostart" enabled will need
        to be restarted manually.)
  
    8. Enable the HL7 TCPIP services for the multi-listeners, for example:
          ISC6A1> TCPIP
          TCPIP> ENABLE SERVICE HLS5000CACHE 
 
    9. Use the START HLO action of the HLO System Monitor option to 
        resume transmission of HLO messages.
 

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: HLCSHDR1
    Before: B53997699  After: B57541761  **19,57,59,72,80,93,120,133**
Routine Name: HLCSTCP
    Before: B32053075  After: B33765852  **19,43,49,57,58,64,84,109,133**
Routine Name: HLCSTCP1
    Before: B29359116  After: B31809732  **19,43,57,64,71,133**
Routine Name: HLCSTCP2
    Before: B55298525  After: B63043745  **19,43,49,57,63,64,66,67,76,
                                          77,87,109,133**
Routine Name: HLCSTCP3
    Before:  B3590592  After:  B4549114  **76,77,133**
Routine Name: HLMA
    Before: B36491876  After: B41676692  **19,43,58,63,66,82,91,109,115,133**
Routine Name: HLMA1
    Before:  B8481428  After:  B8748290  **19,43,91,109,108,133**
Routine Name: HLOAPI
    Before: B35456611  After: B35965894  **126,133**
Routine Name: HLOAPI2
    Before: B36169512  After: B37578775  **126,131,133**
Routine Name: HLOAPI3
    Before: B30983602  After: B43853464  **126,133**
Routine Name: HLOCLNT2
    Before: B30513205  After: B29898713  **126,130,131,133**
Routine Name: HLOPRS
    Before: B30060156  After: B30775930  **118,126,133**
Routine Name: HLOPRS1
    Before: B19358044  After: B19727557  **118,131,133**
Routine Name: HLOSRVR1
    Before: B63396021  After: B60360938  **126,130,131,133**
Routine Name: HLTP
    Before:  B7725388  After:  B8013244  **14,43,133**
Routine Name: HLTP1
    Before:  B7810520  After:  B8076588  **34,47,91,133**
Routine Name: HLTP3
    Before: B72235579  After: B73884339  **19,43,57,58,59,66,69,109,115,
                                          108,116,117,125,120,133**
Routine Name: HLTPCK1
    Before: B31754890  After: B37602285  **8,36,59,120,133**
Routine Name: HLTPCK2
    Before: B34416614  After: B40614402  **19,59,120,133**
Routine Name: HLTPCK2A
    Before: B27212258  After: B28058257  **19,57,59,66,108,120,133**
Routine Name: HLTPCK2B
    Before: B63390233  After: B64470063  **120,133**

=============================================================================
User Information:
Entered By  : MOORE,CHARLES J               Date Entered  : JUN 26, 2006
Completed By: ALDERMAN,MATT S               Date Completed: SEP 19, 2006
Released By : GAYFIELD,LISA                 Date Released : SEP 20, 2006
=============================================================================


Packman Mail Message:
=====================

$END TXT
