Released DG*5.3*544 SEQ #483
Extracted from mail message
**KIDS**:DG*5.3*544^

**INSTALL NAME**
DG*5.3*544
"BLD",4928,0)
DG*5.3*544^REGISTRATION^0^3031021^y
"BLD",4928,1,0)
^^1^1^3030814^^^^
"BLD",4928,1,1,0)
Fixes for NOISes TAM-0303-31335, ISA1098-12507, DAN-0700-40870, NOL-0998-70264, SFC-1202-61040.
"BLD",4928,4,0)
^9.64PA^^
"BLD",4928,"KRN",0)
^9.67PA^8989.52^19
"BLD",4928,"KRN",.4,0)
.4
"BLD",4928,"KRN",.401,0)
.401
"BLD",4928,"KRN",.402,0)
.402
"BLD",4928,"KRN",.403,0)
.403
"BLD",4928,"KRN",.5,0)
.5
"BLD",4928,"KRN",.84,0)
.84
"BLD",4928,"KRN",3.6,0)
3.6
"BLD",4928,"KRN",3.8,0)
3.8
"BLD",4928,"KRN",9.2,0)
9.2
"BLD",4928,"KRN",9.8,0)
9.8
"BLD",4928,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",4928,"KRN",9.8,"NM",1,0)
DGPTFVC1^^0^B36491274
"BLD",4928,"KRN",9.8,"NM",2,0)
DGPMRBA^^0^B20288653
"BLD",4928,"KRN",9.8,"NM",3,0)
DGPMRBA1^^0^B18200586
"BLD",4928,"KRN",9.8,"NM",4,0)
DGPMV33^^0^B13807523
"BLD",4928,"KRN",9.8,"NM",5,0)
DGOINPT1^^0^B24737842
"BLD",4928,"KRN",9.8,"NM",6,0)
DGPTUTL^^0^B21993815
"BLD",4928,"KRN",9.8,"NM","B","DGOINPT1",5)

"BLD",4928,"KRN",9.8,"NM","B","DGPMRBA",2)

"BLD",4928,"KRN",9.8,"NM","B","DGPMRBA1",3)

"BLD",4928,"KRN",9.8,"NM","B","DGPMV33",4)

"BLD",4928,"KRN",9.8,"NM","B","DGPTFVC1",1)

"BLD",4928,"KRN",9.8,"NM","B","DGPTUTL",6)

"BLD",4928,"KRN",19,0)
19
"BLD",4928,"KRN",19.1,0)
19.1
"BLD",4928,"KRN",101,0)
101
"BLD",4928,"KRN",409.61,0)
409.61
"BLD",4928,"KRN",771,0)
771
"BLD",4928,"KRN",870,0)
870
"BLD",4928,"KRN",8989.51,0)
8989.51
"BLD",4928,"KRN",8989.52,0)
8989.52
"BLD",4928,"KRN",8994,0)
8994
"BLD",4928,"KRN","B",.4,.4)

"BLD",4928,"KRN","B",.401,.401)

"BLD",4928,"KRN","B",.402,.402)

"BLD",4928,"KRN","B",.403,.403)

"BLD",4928,"KRN","B",.5,.5)

"BLD",4928,"KRN","B",.84,.84)

"BLD",4928,"KRN","B",3.6,3.6)

"BLD",4928,"KRN","B",3.8,3.8)

"BLD",4928,"KRN","B",9.2,9.2)

"BLD",4928,"KRN","B",9.8,9.8)

"BLD",4928,"KRN","B",19,19)

"BLD",4928,"KRN","B",19.1,19.1)

"BLD",4928,"KRN","B",101,101)

"BLD",4928,"KRN","B",409.61,409.61)

"BLD",4928,"KRN","B",771,771)

"BLD",4928,"KRN","B",870,870)

"BLD",4928,"KRN","B",8989.51,8989.51)

"BLD",4928,"KRN","B",8989.52,8989.52)

"BLD",4928,"KRN","B",8994,8994)

"BLD",4928,"QUES",0)
^9.62^^
"BLD",4928,"REQB",0)
^9.611^6^4
"BLD",4928,"REQB",2,0)
DG*5.3*204^2
"BLD",4928,"REQB",3,0)
DG*5.3*498^2
"BLD",4928,"REQB",5,0)
DG*5.3*466^2
"BLD",4928,"REQB",6,0)
DG*5.3*510^1
"BLD",4928,"REQB","B","DG*5.3*204",2)

"BLD",4928,"REQB","B","DG*5.3*466",5)

"BLD",4928,"REQB","B","DG*5.3*498",3)

"BLD",4928,"REQB","B","DG*5.3*510",6)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
544^3031021
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3031021
"PKG",5,22,1,"PAH",1,1,1,0)
Fixes for NOISes TAM-0303-31335, ISA1098-12507, DAN-0700-40870, NOL-0998-70264, SFC-1202-61040.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","DGOINPT1")
0^5^B24737842
"RTN","DGOINPT1",1,0)
DGOINPT1 ;ALB/REW - BUILDS,PRINTS INPATIENT ROSTER ; 8/8/03 11:45am
"RTN","DGOINPT1",2,0)
 ;;5.3;Registration;**162,498,544**;Aug 13, 1993
"RTN","DGOINPT1",3,0)
 ;
"RTN","DGOINPT1",4,0)
 ;
"RTN","DGOINPT1",5,0)
 ; DGS1 IS USED FOR SORTING PRINT
"RTN","DGOINPT1",6,0)
 ; DGS2 IS USED FOR X-REF LOOKUP
"RTN","DGOINPT1",7,0)
ROSTER ;
"RTN","DGOINPT1",8,0)
 S X=132 X ^%ZOSF("RM")
"RTN","DGOINPT1",9,0)
 D NOW^%DTC S Y=$E(%,1,12),DGADMT=$$FMTE^XLFDT(Y,1)
"RTN","DGOINPT1",10,0)
 S TOT=0,DGS="",DGS1=""
"RTN","DGOINPT1",11,0)
 I DGHOW="W" S DGXREF="CN" D ROST
"RTN","DGOINPT1",12,0)
 I DGHOW="P","EP"[DGPVAR S DGXREF="APR" D ROST
"RTN","DGOINPT1",13,0)
 I DGHOW="P","EA"[DGPVAR S DGXREF="AAP" D ROST
"RTN","DGOINPT1",14,0)
 I DGHOW="P",DGPVAR="E" D FIXTOT
"RTN","DGOINPT1",15,0)
 D DOLIST
"RTN","DGOINPT1",16,0)
QUIT W !
"RTN","DGOINPT1",17,0)
 K ^TMP($J),DGLIST,DGS,ROOMB,CPS,DFN,DGADMT,DGADM,DGCPYS,DGDAYS,DGDS,DGDV,DGI,DGJ,DGPGM,DGPMDD("DA"),DGVAR,DGWD,DGX,I,J,K,NM,TOT,VAUTD,VAUTW,WD,X,Y
"RTN","DGOINPT1",18,0)
 K DGHOW,DGPVAR,DGS1,DGSUBS,DGTM,DGUTV,DIC,X1,XMDT,XMM,DGXREF,ZZ,DGPMIFN,DGS2,VADAT,VADATE,VADM,VAEL,VAIN,Z,DGTMPV,DGFL,DIR,DGBID
"RTN","DGOINPT1",19,0)
 D KVAR^VADPT,KVAR^VADATE,CLOSE^DGUTQ,ENDREP^DGUTL
"RTN","DGOINPT1",20,0)
 Q
"RTN","DGOINPT1",21,0)
FIXTOT ;
"RTN","DGOINPT1",22,0)
 S DGS=""
"RTN","DGOINPT1",23,0)
 F DGI=0:0 S DGS=$O(^TMP($J,"DGLIST",DGS)) Q:DGS=""  D
"RTN","DGOINPT1",24,0)
 .S DGUTV="^TMP("_$J_","""_DGS_""")"
"RTN","DGOINPT1",25,0)
 .F ZZ=0:1 S DGUTV=$Q(@DGUTV) Q:DGUTV=""!($TR(DGUTV,"""")'[($J_","_DGS_","))
"RTN","DGOINPT1",26,0)
 .S ^TMP($J,"DGLIST",DGS)=ZZ
"RTN","DGOINPT1",27,0)
 Q
"RTN","DGOINPT1",28,0)
ROST ;
"RTN","DGOINPT1",29,0)
 F DGI=0:0 S:DGS]""&TOT ^TMP($J,"DGLIST",DGS1)=TOT S TOT=0,DGS=$S((VAUTW):$O(^DPT(DGXREF,DGS)),1:$O(VAUTW(DGS))) Q:DGS=""  D CHECK I DGFL S DFN="" F DGJ=0:0 S DFN=$O(^DPT(DGXREF,DGS2,DFN)) Q:DFN=""  D ADMDT
"RTN","DGOINPT1",30,0)
 Q
"RTN","DGOINPT1",31,0)
ADMDT ;
"RTN","DGOINPT1",32,0)
 N DGVAIN7,VAL
"RTN","DGOINPT1",33,0)
 D QKVADPT Q:'VAIN(7)  S DGBID=VA("BID") S TOT=TOT+1,X=+VAIN(7),DGVAIN7="" I X S X=$$FMTE^XLFDT(X,"5DF"),X=$TR(X," ","0"),X=$TR(X,"/","-"),DGVAIN7=X
"RTN","DGOINPT1",34,0)
 S DGPMIFN=VAIN(1) D ^DGPMLOS S DGDAYS=$P(X,"^",5)
"RTN","DGOINPT1",35,0)
 S VAL=VADM(1)_U_DGBID_U_VADM(4)_U_DGVAIN7_U_DGDAYS_U_VAIN(4)_U_VAIN(5)_U_$P(VAIN(2),U,2)
"RTN","DGOINPT1",36,0)
 S VAL=VAL_U_$P(VAIN(11),U,2)_U_$P(VAIN(3),U,2)_U_$P(VAEL(9),U,1)_U_$P(VAIP(19,1),U,1)
"RTN","DGOINPT1",37,0)
 S ^TMP($J,DGS1,$S(DGSUBS="R":+$$RM(VAIN(5)),1:VADM(1)),+DGBID)=VAL
"RTN","DGOINPT1",38,0)
 Q
"RTN","DGOINPT1",39,0)
CHECK ;
"RTN","DGOINPT1",40,0)
 S DGFL=1
"RTN","DGOINPT1",41,0)
 I DGHOW="P",VAUTW S DGS1=$S($D(^VA(200,DGS,0)):$P($G(^VA(200,DGS,0)),U,1),1:DGS),DGS2=DGS Q
"RTN","DGOINPT1",42,0)
 I DGHOW="P",'VAUTW S DGS1=DGS,DGS2=VAUTW(DGS) Q
"RTN","DGOINPT1",43,0)
 S DGWD=$O(^DIC(42,"B",DGS,0)) I DGWD S DGDV=$S('$D(^DIC(42,DGWD,0)):0,+$P(^(0),"^",11):$P(^(0),"^",11),1:$O(^DG(40.8,0)))
"RTN","DGOINPT1",44,0)
 I 'VAUTD,'$D(VAUTD(DGDV)) S DGFL=0
"RTN","DGOINPT1",45,0)
 S (DGS1,DGS2)=DGS
"RTN","DGOINPT1",46,0)
 Q
"RTN","DGOINPT1",47,0)
WAIT I $E(IOST)="C" S DIR(0)="E" D ^DIR S:'Y DGX=1
"RTN","DGOINPT1",48,0)
 Q
"RTN","DGOINPT1",49,0)
DOLIST ;
"RTN","DGOINPT1",50,0)
 S DGX=0
"RTN","DGOINPT1",51,0)
 F CPS=1:1:DGCPYS S DGS="" F I=0:0 S DGS=$O(^TMP($J,"DGLIST",DGS)) Q:DGS=""  D HEAD,OUT G QTDOL:DGX D WAIT G QTDOL:DGX
"RTN","DGOINPT1",52,0)
QTDOL Q
"RTN","DGOINPT1",53,0)
HEAD S X=$S(DGHOW="W":"WARD",DGPVAR="E":"PROVIDER",DGPVAR="P":"PRIMARY PHYSICIAN",1:"ATTENDING PHYSICIAN")_": "_DGS_"   "_^TMP($J,"DGLIST",DGS)_" PATIENTS"
"RTN","DGOINPT1",54,0)
 W:IOF]"" @IOF W !!?4,"INPATIENT ROSTER",?(61-($L(X)/2)),X,?99 W DGADMT
"RTN","DGOINPT1",55,0)
 W !!?33,"ADMISSION",?78,"PRIMARY",?95,"ATTENDING",?112,"TREATING",?126,"MEANS"
"RTN","DGOINPT1",56,0)
 W !,"PATIENT NAME",?21,"ID",?28,"AGE",?33,"DATE",?46,"DAYS",?52,"WARD",?67,"ROOM-BED",?78,"PHYSICIAN",?95,"PHYSICIAN",?112,"SPECIALTY",?126,"TEST" K X S $P(X,"-",133)="" W !,X,! Q
"RTN","DGOINPT1",57,0)
OUT ;
"RTN","DGOINPT1",58,0)
 S DGUTV="^TMP("_$J_","""_DGS_""")"
"RTN","DGOINPT1",59,0)
 F ZZ=0:1 S DGUTV=$Q(@DGUTV) Q:DGUTV=""!($TR(DGUTV,"""")'[($J_","_DGS_","))  S DGADM=@DGUTV D PRINT I $Y>(IOSL-6),($TR($Q(@DGUTV),"""")[($J_","_DGS_",")) D LEGEND,WAIT G QTOUT:DGX D HEAD
"RTN","DGOINPT1",60,0)
 I $Y<(IOSL-5) D LEGEND
"RTN","DGOINPT1",61,0)
QTOUT Q
"RTN","DGOINPT1",62,0)
PRINT ;
"RTN","DGOINPT1",63,0)
 W !,$S($P(DGADM,U,12):"!",1:""),$E($P(DGADM,U,1),1,19),?21,$P(DGADM,U,2),?28,$J($P(DGADM,U,3),3)
"RTN","DGOINPT1",64,0)
 W ?33,$P(DGADM,U,4),?46,$J($P(DGADM,U,5),4),?52,$E($P(DGADM,U,6),1,14),?67,$E($P(DGADM,U,7),1,9),?78,$E($P(DGADM,U,8),1,15)
"RTN","DGOINPT1",65,0)
 W ?95,$E($P(DGADM,U,9),1,15),?112,$E($P(DGADM,U,10),1,13),?128,$P(DGADM,U,11) W:DGDS !
"RTN","DGOINPT1",66,0)
 Q
"RTN","DGOINPT1",67,0)
RM(ROOMB) ;
"RTN","DGOINPT1",68,0)
 ;IGNORES CHARACTERS BEFORE THE FIRST NON-ZERO NUMBER
"RTN","DGOINPT1",69,0)
 ;RETURNS NUMBERS IN ROOM-BED BEFORE THE FIRST '-' OR '/' THE REMAINING
"RTN","DGOINPT1",70,0)
 ;NUMBERS ARE DIVIDED BY 100,000 AND ADDED TO THE FIRST PART
"RTN","DGOINPT1",71,0)
 ; E.G.        'A-12E-A103C'
"RTN","DGOINPT1",72,0)
 ;WILL RETURN:  12.000103
"RTN","DGOINPT1",73,0)
 ;
"RTN","DGOINPT1",74,0)
 NEW ROOM1,BEG
"RTN","DGOINPT1",75,0)
 S ROOM1=$TR(ROOMB,"123456789","111111111")
"RTN","DGOINPT1",76,0)
 S BEG=$F(ROOM1,1)-1
"RTN","DGOINPT1",77,0)
 S ROOMB=$TR($E(ROOMB,BEG,99),"-/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz ~!@#$%^&*()_+=`|\{}[]:"";'<>?,.","..")
"RTN","DGOINPT1",78,0)
 S:$L(ROOMB,".")>1 ROOMB=$P(ROOMB,".",1)+(($TR(($P(ROOMB,".",2,99)),"."))/1000000)
"RTN","DGOINPT1",79,0)
 Q +ROOMB
"RTN","DGOINPT1",80,0)
QKVADPT ;QUICK SUBSTITUTE FOR VADPT:REQUIRES DFN
"RTN","DGOINPT1",81,0)
 NEW K,I,DGX
"RTN","DGOINPT1",82,0)
 S K=0
"RTN","DGOINPT1",83,0)
 F I=.105,.104,.103,.1,.101 S K=K+1,VAIN(K)=$G(^DPT(DFN,I))
"RTN","DGOINPT1",84,0)
 S VAIN(11)=$G(^DPT(DFN,.1041))
"RTN","DGOINPT1",85,0)
 S VAIN(7)=+$G(^DGPM(+VAIN(1),0))
"RTN","DGOINPT1",86,0)
 F I=2,11 S:$D(^VA(200,+VAIN(I),0)) VAIN(I)=VAIN(I)_U_$P(^(0),U,1)
"RTN","DGOINPT1",87,0)
 S:$D(^DIC(45.7,+VAIN(3),0)) VAIN(3)=VAIN(3)_U_$P(^(0),U,1)
"RTN","DGOINPT1",88,0)
DEM S VADM(1)=$P($G(^DPT(DFN,0)),U,1)
"RTN","DGOINPT1",89,0)
 S VAIP(19,1)=$P($G(^DGPM(+VAIN(1),"DIR")),"^",1)
"RTN","DGOINPT1",90,0)
 S:VAIP(19,1)="" VAIP(19,1)=1
"RTN","DGOINPT1",91,0)
 S DGX=$P($G(^DPT(DFN,0)),U,3)
"RTN","DGOINPT1",92,0)
 S VADM(4)=$E(DT,1,3)-$E(DGX,1,3)-($E(DT,4,7)<$E(DGX,4,7))
"RTN","DGOINPT1",93,0)
 D PID^VADPT6
"RTN","DGOINPT1",94,0)
MT S VAEL(9)=$P($$MTS^DGMTU(DFN),U,2)
"RTN","DGOINPT1",95,0)
 Q
"RTN","DGOINPT1",96,0)
LEGEND F  Q:($Y>(IOSL-5))  W !
"RTN","DGOINPT1",97,0)
 W !,"'!' Before the Patient name indicates the patient chose not to be listed in the Facility Directory"
"RTN","DGOINPT1",98,0)
 Q
"RTN","DGPMRBA")
0^2^B20288653
"RTN","DGPMRBA",1,0)
DGPMRBA ;ALB/MIR - ROOM-BED AVAILABILITY; 9 JAN 89 ; 10/21/03 8:50am
"RTN","DGPMRBA",2,0)
 ;;5.3;Registration;**544**;Aug 13, 1993
"RTN","DGPMRBA",3,0)
OPT ;called from BED AVAILABILITY OPTION
"RTN","DGPMRBA",4,0)
 ;
"RTN","DGPMRBA",5,0)
 W !!,"(A)bbreviated or (E)xpanded Bed Availability Listing?  A//" R X:DTIME G:'$T!(X["^") Q I X="" S X="A" W X
"RTN","DGPMRBA",6,0)
 S Z="^ABBREVIATED^EXPANDED" D IN^DGHELP I %<0 W !!,"ENTER:",!?5,"'A' to see bed availability for a single ward, or",!?5,"'E' for bed availability for multiple wards, by service or",!?9,"a list of all available beds" G OPT
"RTN","DGPMRBA",7,0)
 I X="A" S DGOPT=X D ABB,Q Q
"RTN","DGPMRBA",8,0)
 D ASK2^SDDIV G Q:Y<0 ;get OMA division(s)
"RTN","DGPMRBA",9,0)
WS W !,"Sort by (W)ARD, (S)ERVICE, or (B)EDS:  W//" R X:DTIME G Q:'$T!(X["^") I X="" S X="W" W X
"RTN","DGPMRBA",10,0)
 S Z="^WARD^SERVICE^BEDS" D IN^DGHELP I %<0 D   G WS
"RTN","DGPMRBA",11,0)
 .W !,"ENTER:",!?5,"'W' to see available beds for one, many, or all wards, or",!?5,"'S' to see available beds for one, many, or all services, or",!?5,"'B' to see all available beds and wards which can assign them."
"RTN","DGPMRBA",12,0)
 S DGOPT=X
"RTN","DGPMRBA",13,0)
 I DGOPT="W"!(DGOPT="B") S VAUTNI=1 D WARD^VAUTOMA G Q:Y<0
"RTN","DGPMRBA",14,0)
 G:DGOPT="W" SAD G:DGOPT="B" LDG
"RTN","DGPMRBA",15,0)
 S DIR("A")="Select SERVICE: ",(DIR(0),DGSTR)="SA^A:ALL;M:MEDICINE;S:SURGERY;P:PSYCHIATRY;NH:NHCU;NE:NEUROLOGY;I:INTERMEDIATE MED;R:REHAB MEDICINE;SCI:SPINAL CORD INJURY;D:DOMICILLARY;B:BLIND REHAB;NC:NON-COUNT",DIR("B")="ALL"
"RTN","DGPMRBA",16,0)
 S DIR("?")="Enter desired service for which you would like to see bed availability."
"RTN","DGPMRBA",17,0)
 S DIR("?",1)="CHOOSE FROM:"
"RTN","DGPMRBA",18,0)
 S DIR("?",2)="   A FOR ALL",DIR("?",3)="   M FOR MEDICINE",DIR("?",4)="   S FOR SURGERY",DIR("?",5)="   P FOR PSYCHIATRY",DIR("?",6)="   NH FOR NHCU",DIR("?",7)="   NE FOR NEUROLOGY"
"RTN","DGPMRBA",19,0)
 S DIR("?",8)="   I FOR INTERMEDIATE MED",DIR("?",9)="   R FOR REHAB MEDICINE",DIR("?",10)="   SCI FOR SPINAL CORD INJURY",DIR("?",11)="   D FOR DOMICILLARY",DIR("?",12)="   B FOR BLIND REHAB",DIR("?",13)="   NC FOR NON-COUNT" D ^DIR
"RTN","DGPMRBA",20,0)
 I $D(DTOUT)!$D(DUOUT) K DTOUT,DUOUT G Q
"RTN","DGPMRBA",21,0)
 I Y="A" S DGSV=1 G SAD
"RTN","DGPMRBA",22,0)
 S DGSV=0,DGSV(Y)="",$P(DIR(0),"^",1)=$P(DIR(0),"^",1)_"O",$P(DIR(0),"^",2)=$E($P(DIR(0),"^",2),7,999) K DIR("B")
"RTN","DGPMRBA",23,0)
 F I=2:1:12 S DIR("?",I)=DIR("?",I+1)
"RTN","DGPMRBA",24,0)
 K DIR("?",13) S DIR("A")="Select another SERVICE: "
"RTN","DGPMRBA",25,0)
ASK D ^DIR I $D(DUOUT)!$D(DTOUT) K DUOUT,DTOUT G Q
"RTN","DGPMRBA",26,0)
 I X]"" S DGSV(Y)="" G ASK
"RTN","DGPMRBA",27,0)
SAD W !,"Do you want to display scheduled admissions" S %=1 D YN^DICN G Q:%<0 I '% W !?5,"Respond 'Y'es to display scheduled admissions to the ward.",!?8,"Otherwise, respond 'N'o." G SAD
"RTN","DGPMRBA",28,0)
 S DGSA='(%-1)
"RTN","DGPMRBA",29,0)
LDG W !,"Do you want to display lodgers" S %=1 D YN^DICN G Q:%<0 I '% W !?5,"Respond 'Y'es to display lodgers to the ward.",!?8,"Otherwise, respond 'N'o." G LDG
"RTN","DGPMRBA",30,0)
 S DGLD='(%-1)
"RTN","DGPMRBA",31,0)
 D DESC I %<0 G Q
"RTN","DGPMRBA",32,0)
CONT S DGVARS="DGOPT^VAUTD#^VAUTW#^DGDESC^DGLD^DGSV#^DGSTR",DGPGM="PR^DGPMRBA1" D ZIS^DGUTQ I 'POP D PR^DGPMRBA1
"RTN","DGPMRBA",33,0)
Q K ^UTILITY("DGPMLD",$J),^TMP("DGPMBD",$J),%,DFN,DGA,DGDESC,DGDT,DGFL,DGHOW,DGI,DGJ,DGL,DGLD,DGND,DGNM,DGNOW,DGONE,DGPG,DGPGM,DGOPT,DGR,DGSA,DGSTR,DGSV,DGU,DGVARS,DIC,DIR,I,I1,J,J1,M,POP,W,X,Y,VA,VAUTD,VAUTW,Y,Z W ! D CLOSE^DGUTQ Q
"RTN","DGPMRBA",34,0)
 ;
"RTN","DGPMRBA",35,0)
 ;
"RTN","DGPMRBA",36,0)
ABB ;abbreviated bed availability (single ward only)
"RTN","DGPMRBA",37,0)
 W ! S DIC="^DIC(42,",DIC(0)="AEQMZ" D ^DIC I Y'>0 Q
"RTN","DGPMRBA",38,0)
 D DESC I %<0 G Q
"RTN","DGPMRBA",39,0)
 D NOW^%DTC S DGDT=%
"RTN","DGPMRBA",40,0)
 S W=+Y,(DGA,DGFL,DGL,DGLD)=0,DGSA=1,DGNM=$P(Y(0),"^",1) D ABB^DGPMRBA1
"RTN","DGPMRBA",41,0)
 G ABB
"RTN","DGPMRBA",42,0)
 ;
"RTN","DGPMRBA",43,0)
DESC ;ask to show room-bed descriptions
"RTN","DGPMRBA",44,0)
 W !,"Do you want to display room-bed descriptions" S %=2 D YN^DICN I %<0 Q
"RTN","DGPMRBA",45,0)
 I '% W !?5,"Enter 'Yes' to display the description for vacant beds, otherwise 'No'" G DESC
"RTN","DGPMRBA",46,0)
 S DGDESC=%#2
"RTN","DGPMRBA",47,0)
 Q
"RTN","DGPMRBA1")
0^3^B18200586
"RTN","DGPMRBA1",1,0)
DGPMRBA1 ;ALB/MIR - PRINT FROM BED AVAILABILITY ; 10/21/03 8:48am
"RTN","DGPMRBA1",2,0)
 ;;5.3;Registration;**544**;Aug 13, 1993
"RTN","DGPMRBA1",3,0)
PR D NOW^%DTC S DGDT=%,(DGPG,DGFL,DGI)=0,Y=DGDT X ^DD("DD") S DGNOW=Y G:DGOPT="S" SV I 'VAUTW F I1=0:0 S DGI=$O(VAUTW(DGI)) Q:DGI=""  S W=VAUTW(DGI) D PRINT Q:DGFL
"RTN","DGPMRBA1",4,0)
 I VAUTW F I1=0:0 S DGI=$O(^DIC(42,"B",DGI)) Q:DGI=""  S J=$O(^(DGI,0)) S W=J D PRINT Q:DGFL
"RTN","DGPMRBA1",5,0)
 I DGOPT="B" D BEDSPR
"RTN","DGPMRBA1",6,0)
 Q
"RTN","DGPMRBA1",7,0)
SV I 'DGSV F I1=0:0 S DGI=$O(DGSV(DGI)) Q:DGI=""!DGFL  D HEAD F DGJ=0:0 S DGJ=$O(^DIC(42,"D",DGI,DGJ)) Q:'DGJ  S W=DGJ D PRINT Q:DGFL
"RTN","DGPMRBA1",8,0)
 I DGSV F I1=0:0 S DGI=$O(^DIC(42,"D",DGI)) Q:DGI=""!DGFL  D HEAD F DGJ=0:0 S DGJ=$O(^DIC(42,"D",DGI,DGJ)) Q:'DGJ  S W=DGJ D PRINT Q:DGFL
"RTN","DGPMRBA1",9,0)
 Q
"RTN","DGPMRBA1",10,0)
PRINT I $S('$D(^DIC(42,+W,0)):1,VAUTD:0,'$P(^(0),"^",11)&$D(VAUTD(+$O(^DG(40.8,0)))):0,$D(VAUTD(+$P(^DIC(42,+W,0),"^",11))):0,1:1) Q
"RTN","DGPMRBA1",11,0)
 S D0=W D WIN^DGPMDDCF I X Q
"RTN","DGPMRBA1",12,0)
 S (DGA,DGL)=0,DGNM=$P(^DIC(42,+W,0),"^",1) I 'DGPG!($Y>(IOSL-8)) D:DGOPT'="B" HEAD Q:DGFL
"RTN","DGPMRBA1",13,0)
ABB ;call in here for abbreviated (single ward) bed availability
"RTN","DGPMRBA1",14,0)
ABBREV ;abbreviated bed availability
"RTN","DGPMRBA1",15,0)
 W:DGOPT'="B" !!,DGNM,":  "
"RTN","DGPMRBA1",16,0)
EN F I=0:0 S I=$O(^DG(405.4,"W",W,I)) Q:I'>0!(DGFL)  I $D(^DG(405.4,+I,0)) S J=^(0),J=$P($P(J,"^",1,3)_"^^^","^",1,3),DGR=$P(J,"^",1) D ACT I 'DGU D:DGOPT'="B" DIS I DGOPT="B" D BEDS
"RTN","DGPMRBA1",17,0)
 I DGOPT="B" Q
"RTN","DGPMRBA1",18,0)
 I 'DGA W ?21,"There are no available beds on this ward."
"RTN","DGPMRBA1",19,0)
 G LD:'$O(^DGS(41.1,"ARSV",W,0))!'DGSA S DGONE=0
"RTN","DGPMRBA1",20,0)
 F I=0:0 S I=$O(^DGS(41.1,"ARSV",W,I)) Q:'I  I $D(^DGS(41.1,I,0)) S J=^(0) I '$P(J,"^",13),($P(J,"^",2)'<DT),'$P(J,"^",17) W:'DGONE !?3,"Future Scheduled Admissions:" S DGONE=1 D SA
"RTN","DGPMRBA1",21,0)
LD I '$D(^UTILITY("DGPMLD",$J))!'DGLD Q
"RTN","DGPMRBA1",22,0)
 W !?3,"Lodgers occupy the following beds:"
"RTN","DGPMRBA1",23,0)
 S DGL=1,DGR=0 F J1=0:0 S DGR=$O(^UTILITY("DGPMLD",$J,DGR)) Q:DGR=""  S J=^(DGR) D LOD
"RTN","DGPMRBA1",24,0)
 K ^UTILITY("DGPMLD",$J) Q
"RTN","DGPMRBA1",25,0)
 ;
"RTN","DGPMRBA1",26,0)
ACT S M=$O(^DGPM("ARM",I,0)) I M S DGU=1 Q:'^(M)  D LDGER Q
"RTN","DGPMRBA1",27,0)
 S DGU=0,X=$O(^DG(405.4,I,"I","AINV",0)),X=$O(^(+X,0)) I $D(^DG(405.4,I,"I",+X,0)) S DGND=^(0) D AVAIL
"RTN","DGPMRBA1",28,0)
 I DGU Q
"RTN","DGPMRBA1",29,0)
 S DGA=DGA+1 Q
"RTN","DGPMRBA1",30,0)
 ;
"RTN","DGPMRBA1",31,0)
AVAIL I +DGND'>DGDT,$S('$P(DGND,"^",4):1,$P(DGND,"^",4)>DGDT:1,1:0) S DGU=1
"RTN","DGPMRBA1",32,0)
 Q
"RTN","DGPMRBA1",33,0)
 ;
"RTN","DGPMRBA1",34,0)
DIS ;display available room-beds with/without descriptions
"RTN","DGPMRBA1",35,0)
 I 'DGDESC W:DGA=1 !?3 S $P(J,"^",1)=$E($P(J,"^",1)_"                    ",1,18) W:$X+$L($P(J,"^",1))>79 !?3 W $P(J,"^",1) Q
"RTN","DGPMRBA1",36,0)
 W:DGA#2 !?3 I '(DGA#2) W ?40
"RTN","DGPMRBA1",37,0)
 W $E($P(J,"^",1),1,18) I $D(^DG(405.6,+$P(J,"^",2),0)) W "   (",$E($P(^(0),"^",1),1,15),")"
"RTN","DGPMRBA1",38,0)
 Q
"RTN","DGPMRBA1",39,0)
LOD W !?5,DGR," is occupied by ",$P(J,"^",4)," - PT ID: ",$S($P(J,"^",5)]"":$P(J,"^",5),1:"UNKNOWN")
"RTN","DGPMRBA1",40,0)
 Q
"RTN","DGPMRBA1",41,0)
LDGER ;create UTILITY for lodgers
"RTN","DGPMRBA1",42,0)
 ;J=ROOM-BED NAME^DESCRIPTION^T.S
"RTN","DGPMRBA1",43,0)
 S J=$S($D(^DGPM(+M,0)):$P(^(0),"^",3),1:"")
"RTN","DGPMRBA1",44,0)
 Q:'$D(^DPT("LD",DGNM,+J))!'$D(^DPT(+J,0))  ;if lodger not on this ward
"RTN","DGPMRBA1",45,0)
 S ^UTILITY("DGPMLD",$J,DGR)=J_"^^^"_$P(^DPT(+J,0),"^",1)
"RTN","DGPMRBA1",46,0)
 N DFN S DFN=J D PID^VADPT6 S ^(DGR)=^UTILITY("DGPMLD",$J,DGR)_"^"_VA("PID")
"RTN","DGPMRBA1",47,0)
 Q
"RTN","DGPMRBA1",48,0)
HEAD I DGPG,($E(IOST)="C") K DIR S DIR(0)="E" D ^DIR S DGFL='Y Q:DGFL
"RTN","DGPMRBA1",49,0)
 S DGPG=DGPG+1 W @IOF,!,"BED AVAILABILITY FOR ",DGNOW,?70,"PAGE:",$J(DGPG,5),! K X S $P(X,"-",81)="" W X,!
"RTN","DGPMRBA1",50,0)
 I DGOPT="S" W !?25,"SERVICE:  ",$P($P(DGSTR,";"_DGI_":",2),";",1)
"RTN","DGPMRBA1",51,0)
 Q
"RTN","DGPMRBA1",52,0)
SA W !?5 W:$D(^DPT(+J,0)) $P(^(0),"^",1)," -- " S DFN=+J D PID^VADPT6 W VA("PID") S Y=$P(J,"^",2) I J W " on " D DT^DIQ
"RTN","DGPMRBA1",53,0)
 Q
"RTN","DGPMRBA1",54,0)
BEDS ;create TMP for beds - DG*5.3*544
"RTN","DGPMRBA1",55,0)
 I DGDESC,'($D(^TMP("DGPMBD",$J,$P(J,U)))#2) S ^TMP("DGPMBD",$J,$P(J,U))=$P($G(^DG(405.6,+$P(J,U,2),0)),U)
"RTN","DGPMRBA1",56,0)
 I '$D(^TMP("DGPMBD",$J,$P(J,U),DGNM)) S ^(DGNM)=""
"RTN","DGPMRBA1",57,0)
 Q
"RTN","DGPMRBA1",58,0)
 ;
"RTN","DGPMRBA1",59,0)
BEDSPR ;print report by beds - DG*5.3*544
"RTN","DGPMRBA1",60,0)
 N DGBDNM,DGBCNT,DGBDESC,DGWCNT,DGBDNM,DGWRD
"RTN","DGPMRBA1",61,0)
 D HEAD
"RTN","DGPMRBA1",62,0)
 S DGBCNT=0,DGBDNM="" F  S DGBDNM=$O(^TMP("DGPMBD",$J,DGBDNM)) Q:DGBDNM=""  Q:DGFL  S:DGDESC DGBDESC=^(DGBDNM) D  S DGBCNT=DGBCNT+1 W !
"RTN","DGPMRBA1",63,0)
 . I $Y>(IOSL-8) D HEAD Q:DGFL
"RTN","DGPMRBA1",64,0)
 . W $E(DGBDNM,1,18) W:DGDESC "  ("_$E(DGBDESC,1,15)_")"
"RTN","DGPMRBA1",65,0)
 . W:DGDESC ?40 W:'DGDESC ?20 W "WARDS: "
"RTN","DGPMRBA1",66,0)
 . S DGWRD="",DGWCNT=0 F  S DGWRD=$O(^TMP("DGPMBD",$J,DGBDNM,DGWRD)) Q:DGWRD=""  W:DGWCNT>0 ", " W:($X+$L(DGWRD))>80 !?5 W DGWRD S DGWCNT=DGWCNT+1
"RTN","DGPMRBA1",67,0)
 Q:DGFL
"RTN","DGPMRBA1",68,0)
 W !!?3,$S(DGBCNT:"There are a total of "_DGBCNT_" beds available.",1:"There are no available beds."),!
"RTN","DGPMRBA1",69,0)
 I $D(^UTILITY("DGPMLD",$J)) D HEAD Q:DGFL  D LD
"RTN","DGPMRBA1",70,0)
 K ^TMP("DGPMBD",$J)
"RTN","DGPMRBA1",71,0)
 Q
"RTN","DGPMV33")
0^4^B13807523
"RTN","DGPMV33",1,0)
DGPMV33 ;ALB/MIR - DISCHARGE A PATIENT, CONTINUED ; 8/4/03 1:13pm
"RTN","DGPMV33",2,0)
 ;;5.3;Registration;**204,544**;Aug 13, 1993
"RTN","DGPMV33",3,0)
 ;
"RTN","DGPMV33",4,0)
 I '$P(DGPMA,"^",4)!$S($P(DGPMA,"^",18)'=10:0,'$P(DGPMA,"^",5):1,1:0) W !,"Incomplete Discharge" S DIK="^DGPM(",DA=DGPMDA D ^DIK W "   deleted" S DGPMA="" D  G Q
"RTN","DGPMV33",5,0)
 .S ^UTILITY("DGPM",$J,3,DA,"A")=$G(^("P"))
"RTN","DGPMV33",6,0)
 .I $G(DGPMVI(13)) I $D(^UTILITY("DGPM",$J,1,+DGPMVI(13),"A")) S $P(^("A"),U,17)=$P($G(^("P")),U,17)
"RTN","DGPMV33",7,0)
 S DGPMPTF=$P(DGPMAN,"^",16) G DQ:'DGPMPTF
"RTN","DGPMV33",8,0)
 S X=$S($D(^DG(405.2,+$P(DGPMA,"^",18),0)):$P(^(0),"^",8),1:""),DR=$S(+DGPMA:"70////"_+DGPMA_";",1:"")_$S(X:"72////"_X,1:""),DIE="^DGPT(",DA=DGPMPTF K DQ,DG D ^DIE
"RTN","DGPMV33",9,0)
 I +DGPMP=+DGPMA G Q
"RTN","DGPMV33",10,0)
DQ S DGPMER=0 I $P(DGPMAN,"^",18)=40 D SET^DGPMV32 I DGPMAB S X1=+DGPMAB,X2=30 D C^%DTC I X'<+DGPMA D ASIH^DGPMV331
"RTN","DGPMV33",11,0)
 ;I 'DGPMER,$D(^DGPM(+DGPMDA,0)) D ADM
"RTN","DGPMV33",12,0)
 I DGPMN D DIS^DGPMVODS
"RTN","DGPMV33",13,0)
 W !,"Patient Discharge",$S('$D(^DGPM(+DGPMDA,0)):" Deleted",DGPMA=DGPMP:"",'DGPMP:"d",1:" Updated")
"RTN","DGPMV33",14,0)
Q Q
"RTN","DGPMV33",15,0)
DICS ;input transform on discharge type
"RTN","DGPMV33",16,0)
 S DGX1=$P(^DG(405.1,+Y,0),"^",3),DGSV=$S($D(^DIC(42,+$P(DGPM0,"^",6),0)):$P(^(0),"^",3),1:"")
"RTN","DGPMV33",17,0)
 I DGX1=33,$S(DGSV="":1,DGSV'="D":1,1:0) S DGER=1 Q
"RTN","DGPMV33",18,0)
 I DGX1=35,$S(DGSV="":1,DGSV'="NH":1,1:0) S DGER=1 Q
"RTN","DGPMV33",19,0)
 I $S(DGX1=31:1,DGX1=32:1,1:0),$S(DGSV="":0,"NHD"[DGSV:1,1:0) S DGER=1 Q
"RTN","DGPMV33",20,0)
 I DGX1=34,$S(DGSV="":1,DGSV="NH":1,1:0) S DGER=1 Q
"RTN","DGPMV33",21,0)
 ;I "^21^47^48^49^"[("^"_DGX1_"^") S DGER=1 Q
"RTN","DGPMV33",22,0)
 I DGX1=42,'$O(^DGPM("ATID2",+$P(^DGPM(DA,0),"^",3),9999999.9999999-^(0))) S DGER=1 Q
"RTN","DGPMV33",23,0)
 S DGX=+$P(DGPMP,"^",18) I DGX,"^41^46^"[("^"_DGX_"^"),(DGX1'=DGX) S DGER=1 Q
"RTN","DGPMV33",24,0)
 I "^42^47^"[("^"_DGX1_"^"),(DGX1'=$P(^DGPM(DA,0),"^",18)) S DGER=1 Q
"RTN","DGPMV33",25,0)
 I "^42^47^"[("^"_DGX_"^"),(DGX1'=$P(^DGPM(DA,0),"^",18)) S DGER=1 Q
"RTN","DGPMV33",26,0)
 I DGX,"^41^42^46^47^"'[("^"_DGX_"^"),("^41^42^46^47^"[("^"_DGX1_"^")) S DGER=1 Q
"RTN","DGPMV33",27,0)
 I $P(DGPMAN,"^",18)=40,("^42^47^"[("^"_DGX1_"^")) S DGER=1 Q  ;if admission type is TO ASIH and d/c type is WHILE ASIH
"RTN","DGPMV33",28,0)
 I $P(DGPMAN,"^",18)'=40,("^41^46^"[("^"_DGX1_"^")) S DGER=1 Q  ;if adm type not TO ASIH and d/c type FROM ASIH or CONTINUED ASIH (O.F.)
"RTN","DGPMV33",29,0)
 I $P(DGPMAN,"^",18)'=40 S DGER=0 Q
"RTN","DGPMV33",30,0)
 I "^41^46^"'[("^"_DGX1_"^") S DGER=0 Q
"RTN","DGPMV33",31,0)
 D SET^DGPMV32 S X1=+DGPMAB,X2=30,DGHX=X D C^%DTC I ^DGPM(DA,0)>X S DGER=1,X=DGHX K DGHX Q
"RTN","DGPMV33",32,0)
 S X=DGHX,DGER=0 K DGHX
"RTN","DGPMV33",33,0)
 I $D(^DGPM(+$P(DGPMAN,"^",21),0)),$D(^DGPM(+$P(^(0),"^",14),0)),$D(^DGPM(+$P(^(0),"^",17),0)),($P(^(0),"^",18)=47) S DGER=1 Q  ;if discharge from NHCU/DOM is type 47
"RTN","DGPMV33",34,0)
 S DGER=0 Q
"RTN","DGPMV33",35,0)
SI Q:"^25^26^"[("^"_$P(DGPMA,"^",18)_"^")
"RTN","DGPMV33",36,0)
 I $S('$D(^DPT(DFN,.1)):1,^(.1)="":1,1:0)&($D(^("DAC"))) S DR="401.3///@",DIE="^DPT(",DA=DFN K DQ,DG D ^DIE:$P(^("DAC"),"^",1)="S" K DR,DIC Q
"RTN","DGPMV33",37,0)
 Q:'$D(^DPT(DFN,.1))  S W=^(.1) Q:W']""  S W=$O(^DIC(42,"B",W,0)),W=$S($D(^DIC(42,+W,0)):^(0),1:""),T="SERIOUSLY ILL" Q:W=""
"RTN","DGPMV33",38,0)
 I $P(W,"^",14),($P(DGPMA,"^",18)>3) D  Q
"RTN","DGPMV33",39,0)
 .S DR="401.3//"_$S("^22^23^24^"[("^"_$P(DGPMA,"^",18)_"^"):$S('$D(^DPT(DFN,"DAC")):"",$L($P(^("DAC"),"^",1)):T,1:""),DGPMN:T,1:"")
"RTN","DGPMV33",40,0)
 .I $P(DR,"//",2)=T S DR=$S("^1^2^"[("^"_DGPMT_"^")&+DGPMA:DR_";S:X'=""S"" Y=0;401.4////"_$P(DGPMA,"."),1:DR)
"RTN","DGPMV33",41,0)
 .S DIE="^DPT(",DA=DFN K DQ,DG D ^DIE K DIE,T,W
"RTN","DGPMV33",42,0)
 I $D(^DPT(DFN,"DAC")) I $L($P(^("DAC"),"^",1)) S DA=DFN,DR=401.3,DIE="^DPT(" K DQ,DG D ^DIE
"RTN","DGPMV33",43,0)
 K DIE,T,W Q
"RTN","DGPMV33",44,0)
ADM ;update admission or check-in mvt with discharge/check-out mvt pointer
"RTN","DGPMV33",45,0)
 Q
"RTN","DGPMV33",46,0)
 Q:$S('DGPMN:1,'$D(^DGPM(+DGPMCA,0)):1,1:0)
"RTN","DGPMV33",47,0)
 S ^UTILITY("DGPM",$J,1,+DGPMCA,"P")=DGPMAN,^UTILITY("DGPM",$J,1,+DGPMCA,"A")=$G(^DGPM(+DGPMCA,0))
"RTN","DGPMV33",48,0)
 Q
"RTN","DGPTFVC1")
0^1^B36491274
"RTN","DGPTFVC1",1,0)
DGPTFVC1 ;ALB/AS/ADL - Expanded PTF Close-Out Edits ; 10/1/03 7:15pm
"RTN","DGPTFVC1",2,0)
 ;;5.3;Registration;**52,58,79,114,164,400,342,466,415,493,512,510,544**;Aug 13, 1993
"RTN","DGPTFVC1",3,0)
 ;;ADL;Updated for CSV Project;;Mar 26, 2003
"RTN","DGPTFVC1",4,0)
 ;Called from Q+2^DGPTFTR. Variable must be passed in: PTF
"RTN","DGPTFVC1",5,0)
 ;Variable returned: DGERR.   DGERR <-- 1 if record fails to pass a check; DGERR <-- "" if record passes all checks
"RTN","DGPTFVC1",6,0)
 ;
"RTN","DGPTFVC1",7,0)
 Q:'$D(PTF)
"RTN","DGPTFVC1",8,0)
 S DGERR="",DGV(701)=$S($D(^DGPT(PTF,70)):^(70),1:""),DGV(101)=^(0),DGSUFFIX=$P(DGV(101),"^",5),DGV("FEE")=$P(DGV(101),"^",4),DFN=$P(DGV(101),"^",1)
"RTN","DGPTFVC1",9,0)
 ;
"RTN","DGPTFVC1",10,0)
 I $P(DGV(101),"^",2)>2820700 D AO
"RTN","DGPTFVC1",11,0)
 ;
"RTN","DGPTFVC1",12,0)
 I DGRTY=1,DGV("FEE") D MT
"RTN","DGPTFVC1",13,0)
 ;
"RTN","DGPTFVC1",14,0)
 ; DG*512, sck/Remove 101-Means Test indocator = 'U' xmit block
"RTN","DGPTFVC1",15,0)
 ;I 'DGV("FEE"),$P(DGV(101),"^",10)="U",'DGV(701)!(+DGV(701)>2890700) S DGERR=1 W !,"101 MEANS TEST",?23," value 'U' - not valid for discharges as of 7/1/1989",!?42,"per MAS VACO policy"
"RTN","DGPTFVC1",16,0)
 ;
"RTN","DGPTFVC1",17,0)
 I $D(^DPT(DFN,57)),$P(^(57),"^",4)>0 S S0=$P(^(57),"^",4),DGDX=$S(S0=1!(S0=3):"344.1",1:"344.0"),DGSCI="" F DGX=0:0 S DGX=$O(^DGPT(PTF,"M",DGX)) Q:DGX'>0  S DGNODE=^(DGX,0),DGSCI="" D SCI
"RTN","DGPTFVC1",18,0)
 ;
"RTN","DGPTFVC1",19,0)
 S DGDP="",DGDISPO=$P(DGV(701),"^",6),DGRECSUF=$P(DGV(701),"^",13)
"RTN","DGPTFVC1",20,0)
 I DGRTY=1 D
"RTN","DGPTFVC1",21,0)
 .S DGSTATYP=$S(DGDISPO=12!(DGDISPO=13):30,DGDISPO=10:42,DGDISPO=8:40,1:"")
"RTN","DGPTFVC1",22,0)
 .I DGSTATYP]"" D
"RTN","DGPTFVC1",23,0)
 ..D NUMACT^DGPTSUF(DGSTATYP)
"RTN","DGPTFVC1",24,0)
 ..I DGANUM>0 F I=1:1:DGANUM I DGSUFFIX=DGSUFNAM(I) D
"RTN","DGPTFVC1",25,0)
 ...I DGDISPO'=8 I DGRECSUF=DGSUFNAM(DGANUM) S DGDP=5 D DP
"RTN","DGPTFVC1",26,0)
 ...I DGDISPO=8 N DGANUM,DGSUFNAM D NUMACT^DGPTSUF(42) I DGRECSUF=DGSUFNAM(DGANUM) S DGDP=5 D DP
"RTN","DGPTFVC1",27,0)
 .K DGANUM,DGSTATYP,DGSUFNAM,I
"RTN","DGPTFVC1",28,0)
 ;
"RTN","DGPTFVC1",29,0)
 I DGRTY=1 S %=$P(DGV(701),"^",3) I %=4!(%=6)!(%=7) S DGDP="" D OP I $P(DGV(701),"^",5)=1 S DGERR=1 W !,"701 VA AUSPICES",?23," value inconsistent for discharge"
"RTN","DGPTFVC1",30,0)
 ;
"RTN","DGPTFVC1",31,0)
 ;I 'DGV("FEE") S %=$P(^DPT(DFN,0),"^",6),%=$S($D(^DIC(10,+%,0)):$P(^(0),"^",2),1:"") I '%!(%>7) S DGERR=1 W !,"701 RACE",?23," value " W:%']"" "blank" I %]"" W %," (invalid code)"
"RTN","DGPTFVC1",32,0)
 ;
"RTN","DGPTFVC1",33,0)
 ;If PRRTP treating specialty, must have valid PRRTP suffix
"RTN","DGPTFVC1",34,0)
 ;Fee records would not contain PRRTP specialties
"RTN","DGPTFVC1",35,0)
 I 'DGV("FEE"),"^25^26^27^28^29^38^39^"[(U_$P(DGV(701),U,2)_U) D
"RTN","DGPTFVC1",36,0)
 .I DGSUFFIX'="PA",(DGSUFFIX'="PB"),(DGSUFFIX'="PC"),(DGSUFFIX'="PD") D
"RTN","DGPTFVC1",37,0)
 ..S DGERR=1
"RTN","DGPTFVC1",38,0)
 ..W !,"101 SUFFIX",?23,"value must be set to a valid PRRTP suffix."
"RTN","DGPTFVC1",39,0)
 ;
"RTN","DGPTFVC1",40,0)
 D RACETHNC
"RTN","DGPTFVC1",41,0)
 K DGDISPO,DGRECSUF,DGV,DGDP,DGDX,DGSCI,DGSUFFIX,DGNODE,DGX,%,S0,I,X
"RTN","DGPTFVC1",42,0)
 I DGERR H 4
"RTN","DGPTFVC1",43,0)
 Q
"RTN","DGPTFVC1",44,0)
 ;
"RTN","DGPTFVC1",45,0)
SCI F X=5:1:15 I X#10 S DGPTTMP=$$ICDDX^ICDCODE(+$P(DGNODE,"^",X),$$GETDATE^ICDGTDRG(PTF)) I +DGPTTMP>0&($P(DGPTTMP,U,10)) S:$E($P(DGPTTMP,"^",2),1,5)=DGDX DGSCI=1 Q:DGSCI
"RTN","DGPTFVC1",46,0)
 I 'DGSCI S DGERR=1,%=$P(DGNODE,"^",10),X=$TR($$FMTE^XLFDT(%,"5DF")," ","0") W !,"501 ",X," SCI of ",S0,?23," requires an ICD Diagnosis code beginning with",!?12," or equal to ",DGDX
"RTN","DGPTFVC1",47,0)
 Q
"RTN","DGPTFVC1",48,0)
 ;
"RTN","DGPTFVC1",49,0)
MT S DGVMT=$P(DGV(101),"^",10),DGX=999 G DGX:DGVMT']"" I +$P(DGV(101),"^",2)<2860700!(DGSUFFIX="BU") S DGX="X" G DGX
"RTN","DGPTFVC1",50,0)
 ;S DGZEC=$S($D(^DPT(DFN,.36)):$P(^(.36),U,1),1:""),DGZEC=$S($D(^DIC(8,+DGZEC,0)):^(0),1:"") I $P(DGZEC,U,5)="N" S DGX="N" G DGX
"RTN","DGPTFVC1",51,0)
 S DGZEC=$P($G(^DGPT(PTF,101)),U,8),DGZEC=$S($D(^DIC(8,+DGZEC,0)):^(0),1:"") I $P(DGZEC,U,5)="N" S DGX="N" G DGX
"RTN","DGPTFVC1",52,0)
 S DGT=$P(DGV(701),".") G AS:'$O(^DGMT(408.31,"AD",1,DFN,0)) S DGZ1=$$LST^DGMTU(DFN,DGT) K:DGZ1']"" DGZ1
"RTN","DGPTFVC1",53,0)
 I DGVMT="X" K DGX,DGVMT Q
"RTN","DGPTFVC1",54,0)
 S DGX=$S('$D(DGZ1):"U",1:$P(DGZ1,U,4))
"RTN","DGPTFVC1",55,0)
 ; Determine if the Pending Adjudication is for MT(C) or GMT(G)
"RTN","DGPTFVC1",56,0)
 I DGX="P" D  G DGX
"RTN","DGPTFVC1",57,0)
 . I '+$P($G(DGZ1),U) S DGX="U" Q
"RTN","DGPTFVC1",58,0)
 . S DGX=$$PA^DGMTUTL($P(DGZ1,U)),DGX=$S('$D(DGX):"U",DGX="MT":"C",DGX="GMT":"G",1:"U")
"RTN","DGPTFVC1",59,0)
 ; sc < 50%, 0% non-comp, sc movements - DG*5.3*544
"RTN","DGPTFVC1",60,0)
 I DGX="A",$P(DGZEC,U,4)=3,$$SC^DGMTR(DFN),$$ANYSC^DGPTSCAN(PTF) S DGX="AS" G DGX
"RTN","DGPTFVC1",61,0)
 ;-- sc, >0%  - DG*5.3*544
"RTN","DGPTFVC1",62,0)
 I DGX="A","^1^3^"[("^"_$P(DGZEC,U,4)_"^"),$P($G(^DPT(DFN,.3)),U,2)>0 S DGX="AS" G DGX
"RTN","DGPTFVC1",63,0)
 S DGX=$S(DGX="A":"AN","BCGN"[DGX:DGX,1:"U") G DGX:DGX'="N"
"RTN","DGPTFVC1",64,0)
AS S DGZ=$S($D(^DPT(DFN,.321)):^(.321),1:0) I $P(DGZ,U,2)="Y"!($P(DGZ,U,3)="Y") S DGX="AS" G DGX
"RTN","DGPTFVC1",65,0)
 S DGZ=$S($D(^DPT(DFN,.322)):^(.322),1:0) I $P(DGZ,U,13)="Y" S DGX="AS" G DGX
"RTN","DGPTFVC1",66,0)
 N DGNTARR S DGZ=$S($$GETCUR^DGNTAPI(DFN,"DGNTARR")>0:DGNTARR("NTR"),1:"") I $P(DGZ,U)="Y" S DGX="AS" G DGX
"RTN","DGPTFVC1",67,0)
 S DGZ=$$GETSTAT^DGMSTAPI(DFN) I $P(DGZ,U,2)="Y" S DGX="AS" G DGX
"RTN","DGPTFVC1",68,0)
 I $P(DGZEC,U,5)="Y",$P(DGZEC,U,4)<4,"^2^15^"'[(U_$P(DGZEC,U,9)_U) S DGX="AS" G DGX
"RTN","DGPTFVC1",69,0)
 S DGX="AN"
"RTN","DGPTFVC1",70,0)
DGX I DGVMT'=DGX S DGERR=1 W !,"101 ","MEANS TEST",?23," value ",DGVMT,$S(DGVMT']"":"blank",DGVMT="X":" only for admissions prior to 7/1/86 or domicilliary use",1:" inconsistent with eligibility data")
"RTN","DGPTFVC1",71,0)
 K DGZEC,DGZ,DGZ1,DGT,DGX,DGVMT Q
"RTN","DGPTFVC1",72,0)
 ;
"RTN","DGPTFVC1",73,0)
DP I $P(DGV(701),"^",3)'=5 S DGERR=1 W !,"701 ",$E("TYPE OF DISPOSITION",1,18),?23," value inconsistent for discharge"
"RTN","DGPTFVC1",74,0)
OP I $P(DGV(701),"^",4)=1 S DGERR=1 W !,"701 ",$E("OUTPATIENT TREATMENT",1,18),?23," value inconsistent for discharge" Q:DGDP=""
"RTN","DGPTFVC1",75,0)
 I $P(DGV(701),"^",5)=2 S DGERR=1 W !,"701 VA AUSPICES",?23," value inconsistent for discharge"
"RTN","DGPTFVC1",76,0)
 Q
"RTN","DGPTFVC1",77,0)
 ;
"RTN","DGPTFVC1",78,0)
AO I DGPTFMT<2 D  Q
"RTN","DGPTFVC1",79,0)
 .S %=$S($D(^DGPT(PTF,101)):$P(^(101),"^",4),1:"")
"RTN","DGPTFVC1",80,0)
 .S %=$S($D(^DIC(45.82,+%,0)):$P(^(0),"^",1),1:"")
"RTN","DGPTFVC1",81,0)
 .S I=$S($D(^DPT(DFN,.321)):^(.321),1:"")
"RTN","DGPTFVC1",82,0)
 .S:$P(I,"^",2)="Y"&(%'=6) DGERR=1,DGV("E")=1
"RTN","DGPTFVC1",83,0)
 .W:$D(DGV("E")) !,"101 AGENT ORANGE",?23," value ",$S(DGV("E"):"can only be used with COB of '6'",1:"is inconsistent with Vietnam Service and/or COB")
"RTN","DGPTFVC1",84,0)
 ;
"RTN","DGPTFVC1",85,0)
 N AO,AOL,TMP
"RTN","DGPTFVC1",86,0)
 S TMP=$G(^DPT(DFN,.321))
"RTN","DGPTFVC1",87,0)
 S AO=$S($P(TMP,"^",2)="Y":1,1:0)
"RTN","DGPTFVC1",88,0)
 S AOL=$P(TMP,"^",13)
"RTN","DGPTFVC1",89,0)
 Q:('AO)
"RTN","DGPTFVC1",90,0)
 Q:(AOL'="")
"RTN","DGPTFVC1",91,0)
 S DGERR=1,DGV("E")=1
"RTN","DGPTFVC1",92,0)
 W !,"101 AGENT ORANGE LOCATION",?23,"value required if exposure to Agent Orange claimed"
"RTN","DGPTFVC1",93,0)
 Q
"RTN","DGPTFVC1",94,0)
RACETHNC        ;Race and ethnicity check
"RTN","DGPTFVC1",95,0)
 ;Ensure that a value for ethnicity and at least one race is on file.
"RTN","DGPTFVC1",96,0)
 ;Ensure all active race/ethnicity values have a valid PTF value and an
"RTN","DGPTFVC1",97,0)
 ;associated collection method.  Ensure all collection methods have a
"RTN","DGPTFVC1",98,0)
 ;valid PTF value.  Ignore race/ethicity entries that are inactive or
"RTN","DGPTFVC1",99,0)
 ;invalid pointers.  Note: PTF sends first active ethnicity and first
"RTN","DGPTFVC1",100,0)
 ;six active races.
"RTN","DGPTFVC1",101,0)
 N REF,IEN,TYPE,TEXT,PTRVAL,PTRMTHD,NUM,MAX
"RTN","DGPTFVC1",102,0)
 N VALIDVAL,VALIDMTH,VALUE,VADM
"RTN","DGPTFVC1",103,0)
 D DEM^VADPT
"RTN","DGPTFVC1",104,0)
 F REF=11,12 D
"RTN","DGPTFVC1",105,0)
 .I REF=12 D
"RTN","DGPTFVC1",106,0)
 ..S MAX=6
"RTN","DGPTFVC1",107,0)
 ..S TYPE=1
"RTN","DGPTFVC1",108,0)
 ..S VALIDVAL=",3,8,9,A,B,C,D,"
"RTN","DGPTFVC1",109,0)
 ..S VALIDMTH=",S,P,O,U,"
"RTN","DGPTFVC1",110,0)
 ..S TEXT="RACE"
"RTN","DGPTFVC1",111,0)
 .I REF=11 D
"RTN","DGPTFVC1",112,0)
 ..S MAX=1
"RTN","DGPTFVC1",113,0)
 ..S TYPE=2
"RTN","DGPTFVC1",114,0)
 ..S TEXT="ETHNICITY"
"RTN","DGPTFVC1",115,0)
 ..S VALIDVAL=",H,N,D,U,"
"RTN","DGPTFVC1",116,0)
 ..S VALIDMTH=",S,P,O,U,"
"RTN","DGPTFVC1",117,0)
 .S NUM=1
"RTN","DGPTFVC1",118,0)
 .S IEN=0
"RTN","DGPTFVC1",119,0)
 .F  S IEN=+$O(VADM(REF,IEN)) Q:'IEN  D  Q:NUM>MAX
"RTN","DGPTFVC1",120,0)
 ..S PTRVAL=+VADM(REF,IEN)
"RTN","DGPTFVC1",121,0)
 ..S PTRMTHD=+$G(VADM(REF,IEN,1))
"RTN","DGPTFVC1",122,0)
 ..Q:'PTRVAL
"RTN","DGPTFVC1",123,0)
 ..Q:$$INACTIVE^DGUTL4(PTRVAL,TYPE)
"RTN","DGPTFVC1",124,0)
 ..S NUM=NUM+1
"RTN","DGPTFVC1",125,0)
 ..S VALUE=$$PTR2CODE^DGUTL4(PTRVAL,TYPE,4)
"RTN","DGPTFVC1",126,0)
 ..I (VALUE="")!(VALIDVAL'[VALUE) D  Q
"RTN","DGPTFVC1",127,0)
 ...W !,"701 ",TEXT,?23,"missing/invalid xmit value"
"RTN","DGPTFVC1",128,0)
 ...S DGERR=1
"RTN","DGPTFVC1",129,0)
 ..I ('PTRMTHD) D  Q
"RTN","DGPTFVC1",130,0)
 ...W !,"701 ",TEXT,?23,"method of collection missing/invalid"
"RTN","DGPTFVC1",131,0)
 ...S DGERR=1
"RTN","DGPTFVC1",132,0)
 ..S VALUE=$$PTR2CODE^DGUTL4(PTRMTHD,3,4)
"RTN","DGPTFVC1",133,0)
 ..I (VALUE="")!(VALIDMTH'[VALUE) D  Q
"RTN","DGPTFVC1",134,0)
 ...W !,"701 ",TEXT,?23,"missing/invalid xmit value for method of collection"
"RTN","DGPTFVC1",135,0)
 ...S DGERR=1
"RTN","DGPTFVC1",136,0)
 Q
"RTN","DGPTUTL")
0^6^B21993815
"RTN","DGPTUTL",1,0)
DGPTUTL ;ALB/AS - PTF UTILITY ROUTINE ; 8/14/03 11:35am
"RTN","DGPTUTL",2,0)
 ;;5.3;Registration;**26,114,234,466,544**;Aug 13, 1993
"RTN","DGPTUTL",3,0)
D I $L(Y)'<7 S %=$E(Y,4,5)*3,Y=$E("JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC",%-2,%)_" "_$S($E(Y,6,7):$J(+$E(Y,6,7),2)_",",1:"")_($E(Y,1,3)+1700)_$S(Y[".":" "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),1:"") Q
"RTN","DGPTUTL",4,0)
 S Y="" Q
"RTN","DGPTUTL",5,0)
PM ;sets variables from ^DGPM global
"RTN","DGPTUTL",6,0)
 S DGPMCA=$O(^DGPM("APTF",PTF,0)),DGPMAN=$S($D(^DGPM(+DGPMCA,0)):^(0),1:"") Q
"RTN","DGPTUTL",7,0)
MT ;Determine and store Means Test Indicator
"RTN","DGPTUTL",8,0)
 ;S DGZEC=$S($D(^DPT(DFN,.36)):$P(^(.36),U,1),1:""),DGZEC=$S($D(^DIC(8,+DGZEC,0)):^(0),1:"") I $P(DGZEC,U,5)="N" S DGX="N" G DIE
"RTN","DGPTUTL",9,0)
 ;-- get eligibility code
"RTN","DGPTUTL",10,0)
 S DGZEC=$P($G(^DGPT(PTF,101)),U,8),DGZEC=$S($D(^DIC(8,+DGZEC,0)):^(0),1:"") I $P(DGZEC,U,5)="N" S DGX="N" G DIE
"RTN","DGPTUTL",11,0)
 ;-- admit prior to 7/1/86 is an X
"RTN","DGPTUTL",12,0)
 I DGADM<2860701 S DGX="X" G DIE
"RTN","DGPTUTL",13,0)
 ;--
"RTN","DGPTUTL",14,0)
 I $D(^DGPT(PTF,101)),$D(^DIC(45.1,+^(101),0)),$P(^(0),"^",4) S DGX="X" G DIE
"RTN","DGPTUTL",15,0)
 I $P(^DG(43,1,0),U,21),DGADM]"",$D(^DIC(42,+$P(DGPMAN,U,6),0)),$P(^(0),U,3)="D" S DGX="X" G DIE
"RTN","DGPTUTL",16,0)
 S DGT=$P($G(^DGPT(PTF,70)),"."),DGZ1=$$LST^DGMTU(DFN,DGT) G AS:'DGZ1
"RTN","DGPTUTL",17,0)
 ;-- sc < 50 %, %O non comp, movements are sc
"RTN","DGPTUTL",18,0)
 I $P(DGZEC,U,4)=3,$$SC^DGMTR(DFN),$$ANYSC^DGPTSCAN(PTF) S DGX="AS" G DIE
"RTN","DGPTUTL",19,0)
 ;-- sc <50 %, %0 non-comp, no movement sc, mt =a
"RTN","DGPTUTL",20,0)
 I $P(DGZEC,U,4)=3,$$SC^DGMTR(DFN),'$$ANYSC^DGPTSCAN(PTF),$P(DGZ1,U,4)="A" S DGX="AN" G DIE
"RTN","DGPTUTL",21,0)
 ;-- sc, >0%  - DG*5.3*544
"RTN","DGPTUTL",22,0)
 I "^1^3^"[("^"_$P(DGZEC,U,4)_"^"),$P($G(^DPT(DFN,.3)),U,2)>0,$P(DGZ1,U,4)="A" S DGX="AS" G DIE
"RTN","DGPTUTL",23,0)
 ;
"RTN","DGPTUTL",24,0)
 S DGX=$S('$D(DGZ1):"U",1:$P(DGZ1,U,4))
"RTN","DGPTUTL",25,0)
 ; Determine if the Pending Adjudication is for MT(C) GMT(G)
"RTN","DGPTUTL",26,0)
 I DGX="P" D  G DIE
"RTN","DGPTUTL",27,0)
 . I '+$P($G(DGZ1),U) S DGX="U" Q
"RTN","DGPTUTL",28,0)
 . S DGX=$$PA^DGMTUTL($P(DGZ1,U)),DGX=$S('$D(DGX):"U",DGX="MT":"C",DGX="GMT":"G",1:"U")
"RTN","DGPTUTL",29,0)
 S DGX=$S(DGX="A":"AN","BCGN"[DGX:DGX,1:"U") G DIE:DGX'="N"
"RTN","DGPTUTL",30,0)
 ;-- AO or IR
"RTN","DGPTUTL",31,0)
AS S DGZ=$S($D(^DPT(DFN,.321)):^(.321),1:0) I $P(DGZ,U,2)="Y"!($P(DGZ,U,3)="Y") S DGX="AS" G DIE
"RTN","DGPTUTL",32,0)
 ;-- EC
"RTN","DGPTUTL",33,0)
 S DGZ=$S($D(^DPT(DFN,.322)):^(.322),1:0) I $P(DGZ,U,13)="Y" S DGX="AS" G DIE
"RTN","DGPTUTL",34,0)
 ;-- NTR
"RTN","DGPTUTL",35,0)
 N DGNTARR S DGZ=$S($$GETCUR^DGNTAPI(DFN,"DGNTARR")>0:DGNTARR("NTR"),1:"") I $P(DGZ,U)="Y" S DGX="AS" G DIE
"RTN","DGPTUTL",36,0)
 ;-- MST
"RTN","DGPTUTL",37,0)
 S DGZ=$$GETSTAT^DGMSTAPI(DFN) I $P(DGZ,U,2)="Y" S DGX="AS" G DIE
"RTN","DGPTUTL",38,0)
 ;-- if veteran and AA or Housebound
"RTN","DGPTUTL",39,0)
 I $P(DGZEC,U,5)="Y",$P(DGZEC,U,4)<4,"^2^15^"'[(U_$P(DGZEC,U,9)_U) S DGX="AS" G DIE
"RTN","DGPTUTL",40,0)
 ;
"RTN","DGPTUTL",41,0)
 I DGZEC]"" S DGX="AN" G DIE
"RTN","DGPTUTL",42,0)
 ;
"RTN","DGPTUTL",43,0)
 S DGX="U" I '$D(DGLN) W !,"===> this patient has a blank Eligibility Code"
"RTN","DGPTUTL",44,0)
DIE I '$D(DGBGJ) S DA=PTF,DR="10///"_DGX_$S('$P(^DGPT(PTF,0),U,3):";3///`"_$P($$SITE^VASITE,U),1:""),DIE="^DGPT(" D ^DIE K DGZEC,DGZ,DGZ1,DG1,DGX,DR,DGT,DA,DIE Q
"RTN","DGPTUTL",45,0)
 I DGX'=$P(^DGPT(PTF,0),"^",10) S DA=PTF,DR="10///"_DGX,DIE="^DGPT(" D ^DIE
"RTN","DGPTUTL",46,0)
 K DGZEC,DGZ,DGZ1,DG1,DGX,DGT,DR,DA,DIE Q
"RTN","DGPTUTL",47,0)
 ;
"RTN","DGPTUTL",48,0)
RTY ; -- set rec type variables
"RTN","DGPTUTL",49,0)
 ;  input:      Y := rec type #
"RTN","DGPTUTL",50,0)
 ; output:  DGRTY := rec type #
"RTN","DGPTUTL",51,0)
 ;         DGRTY0 := name of type (in future, may expand to 0th node)
"RTN","DGPTUTL",52,0)
 ;
"RTN","DGPTUTL",53,0)
 I Y=1 S DGRTY=1,DGRTY0="PTF"
"RTN","DGPTUTL",54,0)
 I Y=2 S DGRTY=2,DGRTY0="CENSUS"
"RTN","DGPTUTL",55,0)
 Q
"RTN","DGPTUTL",56,0)
 ;
"RTN","DGPTUTL",57,0)
HANG ;
"RTN","DGPTUTL",58,0)
 R DGPTHANG:4 K DGPTHANG Q
"RTN","DGPTUTL",59,0)
 ;
"RTN","DGPTUTL",60,0)
CEN ; -- find current active census ; return ifn and 0th node
"RTN","DGPTUTL",61,0)
 S DGCN=$O(^DG(45.86,"AC",1,0)),DGCN0=$S($D(^DG(45.86,+DGCN,0)):^(0),1:"")
"RTN","DGPTUTL",62,0)
 Q
"RTN","DGPTUTL",63,0)
 ;
"RTN","DGPTUTL",64,0)
FMT ; -- determime PTF record format
"RTN","DGPTUTL",65,0)
 ;
"RTN","DGPTUTL",66,0)
 S Z=$S(Y:Y,1:DT)
"RTN","DGPTUTL",67,0)
 S DGPTFMT=1 D FDT
"RTN","DGPTUTL",68,0)
 I Z>Y S DGPTFMT=2
"RTN","DGPTUTL",69,0)
 K Z
"RTN","DGPTUTL",70,0)
 Q
"RTN","DGPTUTL",71,0)
 ;
"RTN","DGPTUTL",72,0)
FDT ; -- set new format date for testing
"RTN","DGPTUTL",73,0)
 S Y=2901000 Q
"RTN","DGPTUTL",74,0)
 ;
"RTN","DGPTUTL",75,0)
UPDT ; -- update PTF record w/PTF and DFN defined
"RTN","DGPTUTL",76,0)
 I '$D(^DGPT(PTF,0)) W:'$D(ZTQUEUED) !!,*7,">>> PTF record #",PTF," does not exist." G UPDTQ
"RTN","DGPTUTL",77,0)
 S X=^(0)
"RTN","DGPTUTL",78,0)
 I $P(X,U,11)>1 W:'$D(ZTQUEUED) !!,*7,">>> Record #",PTF," is not a PTF record." G UPDTQ
"RTN","DGPTUTL",79,0)
 S DGPTFE=$P(X,U,4),(DGADM,AD)=+$P(X,U,2),DGST=$D(^DGP(45.84,PTF))>0
"RTN","DGPTUTL",80,0)
 I DGST W:'$D(ZTQUEUED) !!,*7,">>> PTF record #",PTF," is closed out. No updating allowed." G UPDTQ
"RTN","DGPTUTL",81,0)
 I DGPTFE W:'$D(ZTQUEUED) !!,*7,">>> PTF record #",PTF," is a fee PTF record. No updating is possible." G UPDTQ
"RTN","DGPTUTL",82,0)
 N DGPMCA,DGPMAN D PM
"RTN","DGPTUTL",83,0)
 I DGPMCA D:'$P(^DGPT(PTF,0),U,5) SUF^DGPTF D LE^DGPTTS,DC^DGPTF
"RTN","DGPTUTL",84,0)
 ;
"RTN","DGPTUTL",85,0)
UPDTQ K AGE,D0,D1,DA,DGADM,DGLAST,DGP,DGTY,DIC,DIE,DR,DIV,DIU,DISYS,DIK,DIKLM,DIG,DIH,DI,DIW,DIWL,DIWR,DIWT,DN,DOB,DQ,DG,DRG,SEX,TY,L,P1,DIS2,DGPTFE,DGST,DGX,DFN1,DFN2,PR,I1,TDD,AD
"RTN","DGPTUTL",86,0)
 Q
"RTN","DGPTUTL",87,0)
 ;
"RTN","DGPTUTL",88,0)
EXPL ; -- explode string A(input) to DGA(output)
"RTN","DGPTUTL",89,0)
 N J,L S DGA=$E(A,2,999)
"RTN","DGPTUTL",90,0)
 I DGA["-" S X=DGA,DGA="" F J=1:1 S L=$P(X,",",J) Q:'L  D EXPL1:L["-" S:L]"" DGA=DGA_L_"," Q:$P(X,",",J+1,999)=""
"RTN","DGPTUTL",91,0)
 Q
"RTN","DGPTUTL",92,0)
 ;
"RTN","DGPTUTL",93,0)
EXPL1 ; -- explode string 'L' of form "1-12" ; input and output is 'L'
"RTN","DGPTUTL",94,0)
 N I,X
"RTN","DGPTUTL",95,0)
 I $P(L,"-")'?1N.N!($P(L,"-",2,999)'?1N.N) S L="" G EXPL1Q
"RTN","DGPTUTL",96,0)
 I +L>$P(L,"-",2) S L="" G EXPL1Q
"RTN","DGPTUTL",97,0)
 I +L=+$P(L,"-",2) S L=+L G EXPL1Q
"RTN","DGPTUTL",98,0)
 S X="" F I=+L:1:+$P(L,"-",2) Q:($L(X)+$L(I)+1)>240  S X=X_I_","
"RTN","DGPTUTL",99,0)
 S L=$E(X,1,$L(X)-1)
"RTN","DGPTUTL",100,0)
EXPL1Q Q
"RTN","DGPTUTL",101,0)
 ;
"RTN","DGPTUTL",102,0)
CKPOS(ADEL,DEFAULT) ;-- This function will check the admitting eligibility
"RTN","DGPTUTL",103,0)
 ; and the POS to make sure for Non-Vet eligibilities that a
"RTN","DGPTUTL",104,0)
 ; 9 - Other or None POS is present.
"RTN","DGPTUTL",105,0)
 ;
"RTN","DGPTUTL",106,0)
 ;  INPUT - ADEL : Admitting Eligibility (Pointer to file 8)
"RTN","DGPTUTL",107,0)
 ;       DEFAULT : Default POS (optional) (Pointer to file 21)
"RTN","DGPTUTL",108,0)
 ;  OUTPUT- POS : POS Code. 0 - Error
"RTN","DGPTUTL",109,0)
 ;
"RTN","DGPTUTL",110,0)
 N RESULT,X,Y
"RTN","DGPTUTL",111,0)
 ;If DFN is not needed here, kill DFN to avoid VADPT error out.
"RTN","DGPTUTL",112,0)
 I $G(DFN)="" N DFN S DFN=$G(DGSDFN) I $G(DFN)="" K DFN
"RTN","DGPTUTL",113,0)
 D ELIG^VADPT
"RTN","DGPTUTL",114,0)
 I $D(VAEL(1))=1 S RESULT=$G(DEFAULT) G CKPOSQ
"RTN","DGPTUTL",115,0)
 S RESULT=0,Y=$G(DEFAULT)
"RTN","DGPTUTL",116,0)
 I '$D(^DIC(8,+ADEL,0)) G CKPOSQ
"RTN","DGPTUTL",117,0)
 S X=$G(^DIC(8.1,$P($G(^DIC(8,+ADEL,0)),U,9),0))
"RTN","DGPTUTL",118,0)
 ;-- if non vet set POS to Other
"RTN","DGPTUTL",119,0)
 I $P(X,U,5)="N" S RESULT=9
"RTN","DGPTUTL",120,0)
 ;-- if vet then use default
"RTN","DGPTUTL",121,0)
 I $P(X,U,5)="Y",Y'="" S RESULT=Y
"RTN","DGPTUTL",122,0)
CKPOSQ ;
"RTN","DGPTUTL",123,0)
 Q RESULT
"RTN","DGPTUTL",124,0)
 ;
"VER")
8.0^22
**END**
**END**
