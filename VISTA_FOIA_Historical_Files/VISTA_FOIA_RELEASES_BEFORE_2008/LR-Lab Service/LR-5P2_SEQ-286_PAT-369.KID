Released LR*5.2*369 SEQ #286
Extracted from mail message
**KIDS**:LR*5.2*369^

**INSTALL NAME**
LR*5.2*369
"BLD",7188,0)
LR*5.2*369^LAB SERVICE^0^3070410^y
"BLD",7188,1,0)
^^2^2^3070301^^^
"BLD",7188,1,1,0)
This patch addresses several issues in the Lab Service
"BLD",7188,1,2,0)
package.
"BLD",7188,4,0)
^9.64PA^^
"BLD",7188,6)
1^
"BLD",7188,6.3)
2
"BLD",7188,"ABPKG")
n
"BLD",7188,"KRN",0)
^9.67PA^8989.52^19
"BLD",7188,"KRN",.4,0)
.4
"BLD",7188,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7188,"KRN",.401,0)
.401
"BLD",7188,"KRN",.402,0)
.402
"BLD",7188,"KRN",.403,0)
.403
"BLD",7188,"KRN",.5,0)
.5
"BLD",7188,"KRN",.84,0)
.84
"BLD",7188,"KRN",3.6,0)
3.6
"BLD",7188,"KRN",3.8,0)
3.8
"BLD",7188,"KRN",9.2,0)
9.2
"BLD",7188,"KRN",9.8,0)
9.8
"BLD",7188,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",7188,"KRN",9.8,"NM",1,0)
LRCAP64S^^0^B10776643
"BLD",7188,"KRN",9.8,"NM",2,0)
LRDRAW^^0^B13380662
"BLD",7188,"KRN",9.8,"NM",3,0)
LRAPRES1^^0^B43595923
"BLD",7188,"KRN",9.8,"NM",4,0)
LRSORA^^0^B28201937
"BLD",7188,"KRN",9.8,"NM",5,0)
LRSORA2^^0^B18844521
"BLD",7188,"KRN",9.8,"NM","B","LRAPRES1",3)

"BLD",7188,"KRN",9.8,"NM","B","LRCAP64S",1)

"BLD",7188,"KRN",9.8,"NM","B","LRDRAW",2)

"BLD",7188,"KRN",9.8,"NM","B","LRSORA",4)

"BLD",7188,"KRN",9.8,"NM","B","LRSORA2",5)

"BLD",7188,"KRN",19,0)
19
"BLD",7188,"KRN",19.1,0)
19.1
"BLD",7188,"KRN",101,0)
101
"BLD",7188,"KRN",409.61,0)
409.61
"BLD",7188,"KRN",771,0)
771
"BLD",7188,"KRN",870,0)
870
"BLD",7188,"KRN",8989.51,0)
8989.51
"BLD",7188,"KRN",8989.52,0)
8989.52
"BLD",7188,"KRN",8994,0)
8994
"BLD",7188,"KRN","B",.4,.4)

"BLD",7188,"KRN","B",.401,.401)

"BLD",7188,"KRN","B",.402,.402)

"BLD",7188,"KRN","B",.403,.403)

"BLD",7188,"KRN","B",.5,.5)

"BLD",7188,"KRN","B",.84,.84)

"BLD",7188,"KRN","B",3.6,3.6)

"BLD",7188,"KRN","B",3.8,3.8)

"BLD",7188,"KRN","B",9.2,9.2)

"BLD",7188,"KRN","B",9.8,9.8)

"BLD",7188,"KRN","B",19,19)

"BLD",7188,"KRN","B",19.1,19.1)

"BLD",7188,"KRN","B",101,101)

"BLD",7188,"KRN","B",409.61,409.61)

"BLD",7188,"KRN","B",771,771)

"BLD",7188,"KRN","B",870,870)

"BLD",7188,"KRN","B",8989.51,8989.51)

"BLD",7188,"KRN","B",8989.52,8989.52)

"BLD",7188,"KRN","B",8994,8994)

"BLD",7188,"QUES",0)
^9.62^^
"BLD",7188,"REQB",0)
^9.611^4^4
"BLD",7188,"REQB",1,0)
LR*5.2*258^2
"BLD",7188,"REQB",2,0)
LR*5.2*272^2
"BLD",7188,"REQB",3,0)
LR*5.2*336^2
"BLD",7188,"REQB",4,0)
LR*5.2*357^2
"BLD",7188,"REQB","B","LR*5.2*258",1)

"BLD",7188,"REQB","B","LR*5.2*272",2)

"BLD",7188,"REQB","B","LR*5.2*336",3)

"BLD",7188,"REQB","B","LR*5.2*357",4)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)
 
"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2981028^66481
"PKG",26,22,1,"PAH",1,0)
369^3070410^123457157
"PKG",26,22,1,"PAH",1,1,0)
^^2^2^3070410
"PKG",26,22,1,"PAH",1,1,1,0)
This patch addresses several issues in the Lab Service
"PKG",26,22,1,"PAH",1,1,2,0)
package.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","LRAPRES1")
0^3^B43595923^B41479483
"RTN","LRAPRES1",1,0)
LRAPRES1 ;DALOI/WTY/KLL - AP ESIG RELEASE REPORT/ALERT;11/13/01
"RTN","LRAPRES1",2,0)
 ;;5.2;LAB SERVICE;**259,336,369**;Sep 27, 1994;Build 2
"RTN","LRAPRES1",3,0)
 ;
"RTN","LRAPRES1",4,0)
 ;Reference  to FILE^TIUSRVP supported by IA #3540
"RTN","LRAPRES1",5,0)
 ;Reference  to ^TIULQ supported by IA #2693 
"RTN","LRAPRES1",6,0)
 ;
"RTN","LRAPRES1",7,0)
MAIN(LRDFN,LRSS,LRI,LRSF,LRP,LRAC) ;Main subroutine
"RTN","LRAPRES1",8,0)
 Q:'$D(LRDFN)!('$D(LRSS))!('$D(LRP))!('$D(LRAC))
"RTN","LRAPRES1",9,0)
 N LRDOCS,LRMSG,XQA,LRC,LRDOCSN,LRNUM,LRADL,LRMORE,LRQUIT
"RTN","LRAPRES1",10,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y,DIC,XQA,XQAMSG
"RTN","LRAPRES1",11,0)
 S LRQUIT=0
"RTN","LRAPRES1",12,0)
 D ASK
"RTN","LRAPRES1",13,0)
 Q:LRQUIT
"RTN","LRAPRES1",14,0)
 D MORE
"RTN","LRAPRES1",15,0)
 Q:LRQUIT
"RTN","LRAPRES1",16,0)
 D:LRMORE LOOKUP
"RTN","LRAPRES1",17,0)
 D ALERT
"RTN","LRAPRES1",18,0)
 Q
"RTN","LRAPRES1",19,0)
ASK ;Ask if alert is to be sent
"RTN","LRAPRES1",20,0)
 W !
"RTN","LRAPRES1",21,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPRES1",22,0)
 S DIR("A")="Do you wish to send an alert"
"RTN","LRAPRES1",23,0)
 S DIR("??")="^D AHELP^LRAPRES1"
"RTN","LRAPRES1",24,0)
 D ^DIR
"RTN","LRAPRES1",25,0)
 I 'Y S LRQUIT=1 Q
"RTN","LRAPRES1",26,0)
 S:$G(LRSF)="" LRSF=63
"RTN","LRAPRES1",27,0)
 D GETDOCS^LRAPUTL(.LRDOCS,LRDFN,LRSS,$G(LRI),LRSF)
"RTN","LRAPRES1",28,0)
 S:LRDOCS(1)=LRDOCS(2) LRDOCS(2)=0
"RTN","LRAPRES1",29,0)
 S LRQUIT=1
"RTN","LRAPRES1",30,0)
 F LRC=1:1:2 D
"RTN","LRAPRES1",31,0)
 .I LRDOCS(LRC) D
"RTN","LRAPRES1",32,0)
 ..S LRQUIT=0
"RTN","LRAPRES1",33,0)
 ..S X=LRDOCS(LRC) D D^LRUA S LRDOCSN(LRC)=X
"RTN","LRAPRES1",34,0)
 ..I LRDOCSN(LRC)'="" S XQA(LRDOCS(LRC))=""
"RTN","LRAPRES1",35,0)
 ;Q:LRQUIT
"RTN","LRAPRES1",36,0)
 S LRNUM=1
"RTN","LRAPRES1",37,0)
 K LRMSG
"RTN","LRAPRES1",38,0)
 I 'LRQUIT D
"RTN","LRAPRES1",39,0)
 .S LRMSG(LRNUM)="Alert will be sent to:",LRMSG(LRNUM,"F")="!!"
"RTN","LRAPRES1",40,0)
 .I LRDOCS(1) D
"RTN","LRAPRES1",41,0)
 ..S LRNUM=LRNUM+1,LRMSG(LRNUM)=LRDOCSN(1),LRMSG(LRNUM,"F")="?24"
"RTN","LRAPRES1",42,0)
 .I LRDOCS(2) D
"RTN","LRAPRES1",43,0)
 ..S LRNUM=LRNUM+1,LRMSG(LRNUM)=LRDOCSN(2)
"RTN","LRAPRES1",44,0)
 ..S LRMSG(LRNUM,"F")=$S(LRDOCS(1):"!",1:"")_"?24"
"RTN","LRAPRES1",45,0)
 I LRQUIT D
"RTN","LRAPRES1",46,0)
 .S LRMSG(LRNUM)="No Physician or PCP selected for alert"
"RTN","LRAPRES1",47,0)
 .S LRMSG(LRNUM,"F")="!!"
"RTN","LRAPRES1",48,0)
 .S LRQUIT=0
"RTN","LRAPRES1",49,0)
 D EN^DDIOL(.LRMSG)
"RTN","LRAPRES1",50,0)
 Q
"RTN","LRAPRES1",51,0)
MORE ;Add names or mail groups to the lookup list?
"RTN","LRAPRES1",52,0)
 W !
"RTN","LRAPRES1",53,0)
 S LRMORE=1
"RTN","LRAPRES1",54,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPRES1",55,0)
 S DIR("A")="Send the alert to additional names or mail groups"
"RTN","LRAPRES1",56,0)
 D ^DIR
"RTN","LRAPRES1",57,0)
 I Y=0 S LRMORE=0 Q
"RTN","LRAPRES1",58,0)
 I $D(DUOUT)!($D(DTOUT)) S LRQUIT=1
"RTN","LRAPRES1",59,0)
 Q
"RTN","LRAPRES1",60,0)
LOOKUP ;Add additional names or mail groups to alert list.
"RTN","LRAPRES1",61,0)
 F  D  Q:LRQUIT
"RTN","LRAPRES1",62,0)
 .W !
"RTN","LRAPRES1",63,0)
 .K DIR
"RTN","LRAPRES1",64,0)
 .;S DIR(0)="F^3:30^I X'?1""U."".E&(X'?1""G."".E) K X"
"RTN","LRAPRES1",65,0)
 .S DIR(0)="F^3:30^I X["".""&(X'?1""G."".E) K X"
"RTN","LRAPRES1",66,0)
 .S DIR("A")="Enter name or mail group"
"RTN","LRAPRES1",67,0)
 .S DIR("?")="Enter lastname,firstname OR G.mailgroup OR ^ to exit"
"RTN","LRAPRES1",68,0)
 .D ^DIR
"RTN","LRAPRES1",69,0)
 .I $D(DUOUT)!($D(DTOUT)) S LRQUIT=1 Q
"RTN","LRAPRES1",70,0)
 .S X=Y,LRADL=""
"RTN","LRAPRES1",71,0)
 .I Y["." S LRADL=$P(Y,"."),X=$P(Y,".",2)
"RTN","LRAPRES1",72,0)
 .K DIC
"RTN","LRAPRES1",73,0)
 .S DIC(0)="QEZ"
"RTN","LRAPRES1",74,0)
 .S DIC=$S(LRADL="G":3.8,1:200)
"RTN","LRAPRES1",75,0)
 .D ^DIC
"RTN","LRAPRES1",76,0)
 .Q:Y=-1
"RTN","LRAPRES1",77,0)
 .S:LRADL="" XQA($P(Y,"^"))=""
"RTN","LRAPRES1",78,0)
 .S:LRADL="G" XQA("G."_$P(Y,"^",2))=""
"RTN","LRAPRES1",79,0)
 .K LRMSG
"RTN","LRAPRES1",80,0)
 .S LRMSG=$S(LRADL="G":"Mail group ",1:"User ")_$P(Y,"^",2)
"RTN","LRAPRES1",81,0)
 .S LRMSG=LRMSG_" added to alert list."
"RTN","LRAPRES1",82,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",83,0)
 Q
"RTN","LRAPRES1",84,0)
ALERT ;Send the alert
"RTN","LRAPRES1",85,0)
 S XQAMSG="Pathology report signed for "_LRAC_" - "_$E(LRP,1,30)
"RTN","LRAPRES1",86,0)
 D SETUP^XQALERT
"RTN","LRAPRES1",87,0)
 S LRMSG="Alerts have been sent."
"RTN","LRAPRES1",88,0)
 D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",89,0)
 K LRMSG
"RTN","LRAPRES1",90,0)
 Q
"RTN","LRAPRES1",91,0)
AHELP ;Help Frame
"RTN","LRAPRES1",92,0)
 K LRMSG
"RTN","LRAPRES1",93,0)
 S LRMSG(1)="If answered 'Yes', the alert will notify the primary care"
"RTN","LRAPRES1",94,0)
 S LRMSG(1,"F")="!"
"RTN","LRAPRES1",95,0)
 S LRMSG(2)="provider  and  the surgeon/physician that this report has"
"RTN","LRAPRES1",96,0)
 S LRMSG(3)="been  electronically  signed  and  is  now  available for"
"RTN","LRAPRES1",97,0)
 S LRMSG(4)="viewing.   You will also have the opportunity to send the"
"RTN","LRAPRES1",98,0)
 S LRMSG(5)="alert to additional names or mail groups."
"RTN","LRAPRES1",99,0)
 D EN^DDIOL(.LRMSG)
"RTN","LRAPRES1",100,0)
 Q
"RTN","LRAPRES1",101,0)
RETRACT(LRDFN,LRSS,LRI,LRTIUPTR) ;
"RTN","LRAPRES1",102,0)
 ;Change prior TIU versions of report to RETRACTED status
"RTN","LRAPRES1",103,0)
 N LRROOT,LRIENS,LRFILE,LRTIUP,LRTIUAR,LRERR,LRSTAT,LRTIUX,LREXRR
"RTN","LRAPRES1",104,0)
 I LRSS=""!("AUSPEMCY"'[LRSS) S LRPTR=0 Q
"RTN","LRAPRES1",105,0)
 I LRSS="AU" D
"RTN","LRAPRES1",106,0)
 .S LRROOT="^LR(LRDFN,101,""C""",LRIENS=LRDFN_","
"RTN","LRAPRES1",107,0)
 .S LRFILE=63.101
"RTN","LRAPRES1",108,0)
 I LRSS'="AU" D
"RTN","LRAPRES1",109,0)
 .S LRROOT="^LR(LRDFN,LRSS,LRI,.05,""C"""
"RTN","LRAPRES1",110,0)
 .S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPRES1",111,0)
 .S LRFILE=$S(LRSS="SP":63.19,LRSS="CY":63.47,LRSS="EM":63.49,1:"")
"RTN","LRAPRES1",112,0)
 Q:'$D(@(LRROOT_")"))
"RTN","LRAPRES1",113,0)
 S LRTIUP=0,LRTIUX(.05)=15
"RTN","LRAPRES1",114,0)
 F  S LRTIUP=$O(@(LRROOT_",LRTIUP)"))  Q:LRTIUP'>0!(LRTIUP=LRTIUPTR)  D
"RTN","LRAPRES1",115,0)
 .K LRTIUAR S (LRSTAT,LRERR)=0
"RTN","LRAPRES1",116,0)
 .D EXTRACT^TIULQ(LRTIUP,"LRTIUAR",.LRERR,".05",,,"I")
"RTN","LRAPRES1",117,0)
 .Q:+LRERR
"RTN","LRAPRES1",118,0)
 .M LRSTAT=LRTIUAR(LRTIUP,.05,"I")
"RTN","LRAPRES1",119,0)
 .Q:LRSTAT'=7  ;Quit if current status is not COMPLETED
"RTN","LRAPRES1",120,0)
 .D FILE^TIUSRVP(.LREXRR,LRTIUP,.LRTIUX)
"RTN","LRAPRES1",121,0)
 .;Update new TIU version of report with previous TIU pointer value
"RTN","LRAPRES1",122,0)
 .N LREXRR,LRTIUX
"RTN","LRAPRES1",123,0)
 .S LRTIUX(1406)=LRTIUP
"RTN","LRAPRES1",124,0)
 .D FILE^TIUSRVP(.LREXRR,LRTIUPTR,.LRTIUX)
"RTN","LRAPRES1",125,0)
 Q
"RTN","LRAPRES1",126,0)
CLSSCHK(DUZ,LREND) ;Determine if user has the proper class settings and
"RTN","LRAPRES1",127,0)
 ;PROVIDER key
"RTN","LRAPRES1",128,0)
 N LRMSG,LRPRCLSS,LRPCEXP,LRVCDE,LRPCSTR,LRMTCH
"RTN","LRAPRES1",129,0)
 ;First, check for PROVIDER key
"RTN","LRAPRES1",130,0)
 I '$D(^XUSEC("PROVIDER",DUZ)) D  Q
"RTN","LRAPRES1",131,0)
 .K LRMSG S LRMSG=$C(7)_"Electronic signature not authorized.  Missing "
"RTN","LRAPRES1",132,0)
 .S LRMSG=LRMSG_"PROVIDER key."
"RTN","LRAPRES1",133,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",134,0)
 .K LRMSG S LREND=1
"RTN","LRAPRES1",135,0)
 ;Next, check the provider class
"RTN","LRAPRES1",136,0)
 S LRPRCLSS=$$GET1^DIQ(200,DUZ_",",53.5)
"RTN","LRAPRES1",137,0)
 ;PROVIDER CL MUST CONTAIN PHYSICIAN, OR CYTOTECH ONLY FOR CY SECTION
"RTN","LRAPRES1",138,0)
 ;OR DENTIST FOR ORAL AND MAXILLOFACIAL PATHOLOGY
"RTN","LRAPRES1",139,0)
 S LRMTCH=0
"RTN","LRAPRES1",140,0)
 I LRPRCLSS'["PHYSICIAN",LRPRCLSS'["DENTIST" D
"RTN","LRAPRES1",141,0)
 .I LRPRCLSS'["CYTOTECH" S LRMTCH=1
"RTN","LRAPRES1",142,0)
 .I LRSS'="CY" S LRMTCH=1
"RTN","LRAPRES1",143,0)
 I LRMTCH=1 D  Q
"RTN","LRAPRES1",144,0)
 .K LRMSG
"RTN","LRAPRES1",145,0)
 .S LRMSG(1)=$C(7)_"You are not authorized to electronically sign "
"RTN","LRAPRES1",146,0)
 .S LRMSG(1)=LRMSG(1)_"reports."
"RTN","LRAPRES1",147,0)
 .S LRMSG(1,"F")="!!"
"RTN","LRAPRES1",148,0)
 .S LRMSG(2)="PROVIDER CLASS must include PHYSICIAN,"
"RTN","LRAPRES1",149,0)
 .S LRMSG(2,"F")="!"
"RTN","LRAPRES1",150,0)
 .S LRMSG(3)="  OR CYTOTECHNOLOGIST FOR CY SECTIONS ONLY,"
"RTN","LRAPRES1",151,0)
 .S LRMSG(3,"F")="!"
"RTN","LRAPRES1",152,0)
 .S LRMSG(4)=" OR DENTIST FOR ORAL AND MAXILLOFACIAL PATHOLOGY."
"RTN","LRAPRES1",153,0)
 .S LRMSG(4,"F")="!"
"RTN","LRAPRES1",154,0)
 .D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPRES1",155,0)
 .S LREND=1
"RTN","LRAPRES1",156,0)
 ;Finally, check the person class
"RTN","LRAPRES1",157,0)
 S LRPCSTR=$$GET^XUA4A72(DUZ)   ;Supported reference #1625
"RTN","LRAPRES1",158,0)
 I LRPCSTR<0 D  Q
"RTN","LRAPRES1",159,0)
 .K LRMSG
"RTN","LRAPRES1",160,0)
 .S LRMSG="PERSON CLASS is inactive or undefined.  Electronic signature"
"RTN","LRAPRES1",161,0)
 .S LRMSG=LRMSG_" is not authorized."
"RTN","LRAPRES1",162,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",163,0)
 .K LRMSG
"RTN","LRAPRES1",164,0)
 .S LREND=1
"RTN","LRAPRES1",165,0)
 S LRPCEXP=+$P(LRPCSTR,"^",6)
"RTN","LRAPRES1",166,0)
 I LRPCEXP D  Q
"RTN","LRAPRES1",167,0)
 .K LRMSG
"RTN","LRAPRES1",168,0)
 .S LRMSG="PERSON CLASS has expired.  Electronic signature"
"RTN","LRAPRES1",169,0)
 .S LRMSG=LRMSG_" is not authorized."
"RTN","LRAPRES1",170,0)
 .D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES1",171,0)
 .S LREND=1
"RTN","LRAPRES1",172,0)
 S LRVCDE=$P(LRPCSTR,"^",7),LRMTCH=0
"RTN","LRAPRES1",173,0)
 ;CORRECT PERSON CLASS SHOULD MATCH PROVIDER CLASS
"RTN","LRAPRES1",174,0)
 I LRPRCLSS["PHYSICIAN" D
"RTN","LRAPRES1",175,0)
 .I $E(LRVCDE,1,6)="V11370","123568"[+$E(LRVCDE,7) S LRMTCH=1
"RTN","LRAPRES1",176,0)
 .I $E(LRVCDE,1,6)="V11371","03"[+$E(LRVCDE,7) S LRMTCH=1
"RTN","LRAPRES1",177,0)
 .I $E(LRVCDE,1,6)="V18240","124579"[+$E(LRVCDE,7) S LRMTCH=1
"RTN","LRAPRES1",178,0)
 .I LRVCDE="V182413" S LRMTCH=1
"RTN","LRAPRES1",179,0)
 I LRPRCLSS["CYTOTECH" D
"RTN","LRAPRES1",180,0)
 .I LRVCDE="V150113" S LRMTCH=1
"RTN","LRAPRES1",181,0)
 I LRPRCLSS["DENTIST" D
"RTN","LRAPRES1",182,0)
 .I LRVCDE="V030503" S LRMTCH=1
"RTN","LRAPRES1",183,0)
 I 'LRMTCH D
"RTN","LRAPRES1",184,0)
 .K LRMSG
"RTN","LRAPRES1",185,0)
 .S LRMSG="Invalid PERSON CLASS.  Electronic Signature is not "
"RTN","LRAPRES1",186,0)
 .S LRMSG=LRMSG_"authorized."
"RTN","LRAPRES1",187,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",188,0)
 .K LRMSG
"RTN","LRAPRES1",189,0)
 .S LREND=1
"RTN","LRAPRES1",190,0)
 Q
"RTN","LRCAP64S")
0^1^B10776643^B10561887
"RTN","LRCAP64S",1,0)
LRCAP64S ;DALISC/FHS - SEARCH 64 FOR CODES
"RTN","LRCAP64S",2,0)
 ;;5.2;LAB SERVICE;**258,369**;Sep 27, 1994;Build 2
"RTN","LRCAP64S",3,0)
EN ;
"RTN","LRCAP64S",4,0)
 K DA,DIR,LRCPT,LRAN,LRANS,LRCODE,LRN,Y,X,LRX,LRIEN,%ZIS
"RTN","LRCAP64S",5,0)
 K ^TMP("LROUT",$J)
"RTN","LRCAP64S",6,0)
 S DIR("A")="Select the code type"
"RTN","LRCAP64S",7,0)
 S DIR("?",1)="Indicate what code you want to find in the"
"RTN","LRCAP64S",8,0)
 S DIR("?")="CODE field of the WKLD CODE file."
"RTN","LRCAP64S",9,0)
 S DIR(0)="SO^1:CPT;2:SNOMED;3:ICD9;4:LOINC"
"RTN","LRCAP64S",10,0)
 D ^DIR
"RTN","LRCAP64S",11,0)
 G END:$G(Y)<1
"RTN","LRCAP64S",12,0)
 S LRAN=Y,LRAN(0)=Y(0)
"RTN","LRCAP64S",13,0)
 K LRCODE S LRCODE=""
"RTN","LRCAP64S",14,0)
 S LRANS=$S(Y=1:" CPT",Y=2:" SNOMED,",Y=3:" ICD9",1:" LOINC")
"RTN","LRCAP64S",15,0)
 K DIR S DIR("A")="Select "_Y(0)_" Code"
"RTN","LRCAP64S",16,0)
 S LRGLB=$S(Y=1:";ICPT(",Y=2:";LAB(61.1,",Y=3:";ICD9(",1:"")
"RTN","LRCAP64S",17,0)
 S DIR(0)="PO^"_$S(Y=1:"81",Y=2:"61.1",Y=3:"80",1:"95.3")_":ENMZQ"
"RTN","LRCAP64S",18,0)
 F  D ^DIR Q:Y<1  D
"RTN","LRCAP64S",19,0)
 . I LRAN'=4 S LRCODE(+Y_LRGLB_"-"_LRANS)=" ["_$S(LRAN=3:$P(Y(0),U,3),1:$P(Y(0),U,2))_"]",DIR("A")=" Select another "_LRAN(0)_" code "
"RTN","LRCAP64S",20,0)
 . I LRAN=4 S LRCODE(+Y_"-"_LRANS)=" ["_$G(^LAB(95.3,+Y,80))_"]"
"RTN","LRCAP64S",21,0)
 G:$D(DTOUT)!($D(DUOUT)) END
"RTN","LRCAP64S",22,0)
 I $O(LRCODE(0))="" W !?5,"Nothing Selected ",!!,$C(7) G END
"RTN","LRCAP64S",23,0)
DEV ;SELECT DEVICE
"RTN","LRCAP64S",24,0)
 K %ZIS S %ZIS="Q" D ^%ZIS G:POP!($D(DUOUT))!($D(DTOUT)) END
"RTN","LRCAP64S",25,0)
 I $D(IO("Q")) G QUE
"RTN","LRCAP64S",26,0)
 U IO
"RTN","LRCAP64S",27,0)
DEQUE ;
"RTN","LRCAP64S",28,0)
 S LREND=0 W:$E(IOST,1,2)="C-" @IOF
"RTN","LRCAP64S",29,0)
 I $D(ZTDEQUED) S ZTREQ="@"
"RTN","LRCAP64S",30,0)
 S LRHD=LRANS_" Listing   "_$$FMTE^XLFDT($$NOW^XLFDT,"1P")
"RTN","LRCAP64S",31,0)
 S LRPG=0 D HD
"RTN","LRCAP64S",32,0)
 S LRN="" F  S LRN=$O(LRCODE(LRN)) Q:LRN=""!($G(LREND))  D
"RTN","LRCAP64S",33,0)
 . K ^TMP("LROUT",$J) D FIND^DIC(64,"","@;.01;1;IX",$S(LRAN=4:"XQ",1:"QM"),$P(LRN,"-"),"",$S(LRAN=4:"AH^AI",1:"AB"),"","","^TMP(""LROUT"",$J)")
"RTN","LRCAP64S",34,0)
 . I '$O(^TMP("LROUT",$J,"DILIST",0)) D  Q
"RTN","LRCAP64S",35,0)
 . . D TOP Q:$G(LREND)
"RTN","LRCAP64S",36,0)
 . . W !!?2,$TR(LRN,";(-","  ")_$P(LRCODE(LRN),U),!?5," [ IS NOT LINKED ]"
"RTN","LRCAP64S",37,0)
 . I $O(^TMP("LROUT",$J,"DILIST",0)) D
"RTN","LRCAP64S",38,0)
 . . D TOP Q:$G(LREND)
"RTN","LRCAP64S",39,0)
 . . W !!?2,$TR(LRN,";(","  ")_$P(LRCODE(LRN),U)_" linked to:"
"RTN","LRCAP64S",40,0)
 . . S LRX=0 F  S LRX=$O(^TMP("LROUT",$J,"DILIST",2,LRX)) Q:LRX<1  Q:LREND  D
"RTN","LRCAP64S",41,0)
 . . . S LRIEN=^TMP("LROUT",$J,"DILIST",2,LRX)
"RTN","LRCAP64S",42,0)
 . . . S LRANOUT=^TMP("LROUT",$J,"DILIST","ID",LRX,1)_" "_^TMP("LROUT",$J,"DILIST","ID",LRX,.01)
"RTN","LRCAP64S",43,0)
 . . . D TOP Q:$G(LREND)  W !?4,LRIEN,?15,$E(LRANOUT,1,64)
"RTN","LRCAP64S",44,0)
 G:$D(DTOUT)!($D(DUOUT)) END
"RTN","LRCAP64S",45,0)
 W !?10,"Finished"
"RTN","LRCAP64S",46,0)
END ;
"RTN","LRCAP64S",47,0)
 W ! I $E(IOST,1,2)="P-" W @IOF
"RTN","LRCAP64S",48,0)
 D ^%ZISC
"RTN","LRCAP64S",49,0)
 Q:$G(LRDEBUG)
"RTN","LRCAP64S",50,0)
 K DA,DIR,DIRUT,DTOUT,DUOUT,LRAN,LRANOUT,LRANS,LRCODE,LRCPT,LREND
"RTN","LRCAP64S",51,0)
 K LRGLB,LRHD,LRIEN,LRN,LRPG,LRX,POP,X,Y
"RTN","LRCAP64S",52,0)
 K ZTDEQUED,ZTREQ,ZTSK,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSTOP
"RTN","LRCAP64S",53,0)
 K ^TMP("LROUT",$J) D CLEAN^DILF
"RTN","LRCAP64S",54,0)
 Q
"RTN","LRCAP64S",55,0)
TOP ;
"RTN","LRCAP64S",56,0)
 I $$S^%ZTLOAD("Report Stopped") S (ZTSTOP,LREND)=1 Q
"RTN","LRCAP64S",57,0)
 N DIR
"RTN","LRCAP64S",58,0)
 Q:$Y<(IOSL-4)
"RTN","LRCAP64S",59,0)
 I $E(IOST,1,2)="P-" G HD
"RTN","LRCAP64S",60,0)
 N DIR
"RTN","LRCAP64S",61,0)
 S DIR(0)="E" D ^DIR
"RTN","LRCAP64S",62,0)
 S:$D(DTOUT)!($D(DUOUT)) LREND=1
"RTN","LRCAP64S",63,0)
 I $G(LREND) W !! Q
"RTN","LRCAP64S",64,0)
HD ;
"RTN","LRCAP64S",65,0)
 S LRPG=$G(LRPG)+1
"RTN","LRCAP64S",66,0)
 W:$G(LRN)'="" @IOF
"RTN","LRCAP64S",67,0)
 W !!,$$CJ^XLFSTR(LRHD_" Page: "_LRPG,IOM)
"RTN","LRCAP64S",68,0)
 I $G(LRN)'="" W !?2,$TR(LRN,";(","  ")_$P(LRCODE(LRN),U)_" linked to:"
"RTN","LRCAP64S",69,0)
 Q
"RTN","LRCAP64S",70,0)
QUE ;
"RTN","LRCAP64S",71,0)
 K ZTDTH
"RTN","LRCAP64S",72,0)
 S ZTRTN="DEQUE^LRCAP64S",ZTSAVE("LR*")=""
"RTN","LRCAP64S",73,0)
 S ZTDESC="Lab List of codes from LAM"
"RTN","LRCAP64S",74,0)
 S ZTIO=ION D ^%ZTLOAD
"RTN","LRCAP64S",75,0)
 I $G(ZTSK) W !,$$CJ^XLFSTR("Queued to "_ION,80)
"RTN","LRCAP64S",76,0)
 G END
"RTN","LRCAP64S",77,0)
 Q
"RTN","LRDRAW")
0^2^B13380662^B13018094
"RTN","LRDRAW",1,0)
LRDRAW ;DALOI/CJS/RLM-WARD COLLECTION SUMMARY ;8/11/97
"RTN","LRDRAW",2,0)
 ;;5.2;LAB SERVICE;**121,190,272,369**;Sep 27, 1994;Build 2
"RTN","LRDRAW",3,0)
 ; Reference to ^%DT supported by DBIA #10003
"RTN","LRDRAW",4,0)
 ; Reference to $$FMTE^XLFDT supported by IA #10103
"RTN","LRDRAW",5,0)
 ; Reference to $$NOW^XLFDT supported by IA #10103
"RTN","LRDRAW",6,0)
 ; Reference to ^DIC supported by IA #10007
"RTN","LRDRAW",7,0)
 ; Reference to ^SC( supported by DBIA #908
"RTN","LRDRAW",8,0)
 ; Reference to ^VA(200 supported by DBIA #10060
"RTN","LRDRAW",9,0)
BEGIN S %DT="AE" D ^%DT Q:Y<1  S U="^",%ZIS="Q",LRODT=+Y D FNDLOC Q:LRLLOC[U  S ZTRTN="GO^LRDRAW" D IO^LRWU
"RTN","LRDRAW",10,0)
END K DIC,%ZIS,LRODT,LRLLOC,LRPGM,LRIO,LRTIME,LRDC,LRDFN,LRDPF,LRIOZERO,LRLWC,LRSN,PNM,SSN,Z
"RTN","LRDRAW",11,0)
 Q
"RTN","LRDRAW",12,0)
GO S:$D(ZTQUEUED) ZTREQ="@" U IO S LRDC=0 W @IOF,!,"List of Patients with Lab Orders",?40,"Order Date: "_$$FMTE^XLFDT(LRODT,""),!
"RTN","LRDRAW",13,0)
 W ?2,"Date/Time Printed: "_$$FMTE^XLFDT($$NOW^XLFDT,""),!
"RTN","LRDRAW",14,0)
 I LRLLOC="" F I=0:0 S LRLLOC=$O(^LRO(69,LRODT,1,"AC",LRLLOC)) Q:LRLLOC=""  D ORD
"RTN","LRDRAW",15,0)
 I LRLLOC'="" D ORD
"RTN","LRDRAW",16,0)
 I 'LRDC W !!,"REPORT EMPTY."
"RTN","LRDRAW",17,0)
 W !,"Report Completed",!
"RTN","LRDRAW",18,0)
 Q
"RTN","LRDRAW",19,0)
ORD S LRSN=0 F  S LRSN=$O(^LRO(69,LRODT,1,"AC",LRLLOC,LRSN)) Q:LRSN<1  D:'$D(^LRO(69,LRODT,1,LRSN,1))&$D(^LRO(69,LRODT,1,LRSN,0)) PRNT
"RTN","LRDRAW",20,0)
 Q
"RTN","LRDRAW",21,0)
PRNT S LRDFN=+^LRO(69,LRODT,1,LRSN,0),LRLWC=$P(^(0),U,4),LRDC=1
"RTN","LRDRAW",22,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3) D PT^LRX
"RTN","LRDRAW",23,0)
 W !!,PNM,?30,SSN,?50,"ORDER NUMBER: ",$S($D(^LRO(69,LRODT,1,LRSN,.1)):+^(.1),1:"?"),!,"LOCATION: ",LRLLOC,?50,$S(LRLWC="SP":"SEND PATIENT",LRLWC="WC":"WARD COLLECT",LRLWC="LC":"LAB COLLECT",1:"")
"RTN","LRDRAW",24,0)
 W !,"TESTS: " S I=0 F  S I=$O(^LRO(69,LRODT,1,LRSN,2,I)) Q:I<1  S X=^(I,0) W ?9,$P(^LAB(60,+X,0),U,1) W:$P(X,"^",11) ?30," Canceled by: "_$P(^VA(200,$P(X,"^",11),0),"^") W !
"RTN","LRDRAW",25,0)
 Q
"RTN","LRDRAW",26,0)
FNDLOC ;return a location from ^LRO(69,LRODT,1,"AC",LRLLOC,LRSN), from LRNODRQW, LRPHEXPT, LRPHITEM
"RTN","LRDRAW",27,0)
LOOP S LRLLOC="" W !,$S($D(DIC("A")):DIC("A"),1:"Select PATIENT LOCATION: ")
"RTN","LRDRAW",28,0)
 R "ALL// ",X:DTIME G:'$T LEND S:X="" X="ALL" S:X="ALL"!(X="all") X="" S LRLLOC=X Q:X=""  I $L(X) G LEND:X["^",LALL:X["?"!(X'?.ANP)
"RTN","LRDRAW",29,0)
 I $L(X)<2!($L(X)>30) W "  Enter 2 - 30 alpha-numeric name" G LOOP
"RTN","LRDRAW",30,0)
 I $D(^LRO(69,LRODT,1,"AC",X)) S LRLLOC=X K %,X,Y Q
"RTN","LRDRAW",31,0)
 S DIC=44,DIC(0)="EMOZ",DIC("S")="I $L($P(^(0),U,2)),$D(^LRO(69,LRODT,1,""AC"",$P(^(0),U,2)))" D ^DIC K DIC
"RTN","LRDRAW",32,0)
 I $D(DTOUT)!$D(DUOUT) K DTOUT,DUOUT G LOOP
"RTN","LRDRAW",33,0)
 I Y>0 S LRLLOC=$P(Y(0),U,2) I $D(^LRO(69,LRODT,1,"AC",LRLLOC)) K %,X,Y Q
"RTN","LRDRAW",34,0)
 I '$D(^LRO(69,LRODT,1,"AC",LRLLOC)) W !,"["_LRLLOC_"] is not a valid entry",$C(7),! G LOOP
"RTN","LRDRAW",35,0)
SOME S Y=$O(^LRO(69,LRODT,1,"AC",X)) G LALL:Y=""!($E(Y,1,$L(LRLLOC))'=LRLLOC)
"RTN","LRDRAW",36,0)
 S %=$O(^LRO(69,LRODT,1,"AC",Y)) I $E(%,1,$L(LRLLOC))'=LRLLOC W $E(Y,$L(LRLLOC)+1,$L(Y)) S LRLLOC=Y K %,Y,X Q
"RTN","LRDRAW",37,0)
 K % S Y=X F %=1:1 S Y=$O(^LRO(69,LRODT,1,"AC",Y)) Q:Y=""!($E(Y,1,$L(LRLLOC))'=LRLLOC)  S %(%)=Y W !,?5,%,?9,Y I '(%#10) R !,"Press ""^"" to quit ",X:DTIME S:'$T X="^" Q:X["^"
"RTN","LRDRAW",38,0)
 S %=%-1 W !,"CHOOSE 1-",%,": " R X:DTIME G:'$T LOOP G LALL:X["?" G LOOP:X["^"!(X="")
"RTN","LRDRAW",39,0)
 I X\1'=+X!(X<1)!(X>%) W " ??",$C(7),! G LOOP
"RTN","LRDRAW",40,0)
 S LRLLOC=%(X) K %,X,Y Q
"RTN","LRDRAW",41,0)
LALL S X="?",DIC=44,DIC(0)="EMOQ",DIC("S")="I $L($P(^(0),U,2)),$D(^LRO(69,LRODT,1,""AC"",$P(^(0),U,2)))" D ^DIC K DIC
"RTN","LRDRAW",42,0)
 S Y="" W !,"YOU MAY ALSO CHOOSE FROM:" F %=1:1 S Y=$O(^LRO(69,LRODT,1,"AC",Y)) Q:Y=""  D
"RTN","LRDRAW",43,0)
 . I '$D(^SC("C",Y)) W !,?3,Y I '(%#10) R !,"Press ""^"" to quit ",X:DTIME S:'$T X="^" Q:X["^"
"RTN","LRDRAW",44,0)
 G LOOP
"RTN","LRDRAW",45,0)
LEND K %,X,Y S LRLLOC="^" Q
"RTN","LRSORA")
0^4^B28201937^B27384582
"RTN","LRSORA",1,0)
LRSORA ;DRH/DALISC - HIGH/LOW VALUE REPORT ;2/19/91  11:42 ;
"RTN","LRSORA",2,0)
 ;;5.2;LAB SERVICE;**344,357,369**;Sep 27, 1994;Build 2
"RTN","LRSORA",3,0)
MAIN D INIT,GDT,GAA:'LREND,GLRT:'LREND,GLOG:'LREND,SORTBY^LRSORA1:'LREND
"RTN","LRSORA",4,0)
 D PATS^LRSORA1:'LREND,LOCS^LRSORA1:'LREND,GDV:'LREND,RUN:'LREND
"RTN","LRSORA",5,0)
 D STOP
"RTN","LRSORA",6,0)
 Q
"RTN","LRSORA",7,0)
RUN ;
"RTN","LRSORA",8,0)
 K ^TMP("LR",$J)
"RTN","LRSORA",9,0)
 S:$D(ZTQUEUED) ZTREQ="@" U IO
"RTN","LRSORA",10,0)
 S (LRPAG,LREND)=0,$P(LRDASH,"-",IOM)="-"
"RTN","LRSORA",11,0)
 K %DT S X=$P(LRSDT,"."),%DT="X" D ^%DT,DD^LRX S LRSDAT=Y
"RTN","LRSORA",12,0)
 K %DT S X=LREDT,%DT="X" D ^%DT,DD^LRX S LREDAT=Y
"RTN","LRSORA",13,0)
 S LRHDR2="For date range: "_LREDAT_" to "_LRSDAT
"RTN","LRSORA",14,0)
 D:'LREND START^LRSORA2
"RTN","LRSORA",15,0)
 D:$D(ZTQUEUED) STOP
"RTN","LRSORA",16,0)
 Q
"RTN","LRSORA",17,0)
STOP ;
"RTN","LRSORA",18,0)
 D STOP^LRSORA0
"RTN","LRSORA",19,0)
 Q
"RTN","LRSORA",20,0)
GAA ;
"RTN","LRSORA",21,0)
 D GAA^LRSORA0
"RTN","LRSORA",22,0)
 Q
"RTN","LRSORA",23,0)
GLRT ;
"RTN","LRSORA",24,0)
 W ! K LRTST S LRTST=1
"RTN","LRSORA",25,0)
 F I=0:0 D GTSC Q:'$D(LRTST(LRTST,1))  W ! S LRTST=LRTST+1
"RTN","LRSORA",26,0)
 K LRTST(LRTST) S LRTST=LRTST-1 Q
"RTN","LRSORA",27,0)
GTSC ;
"RTN","LRSORA",28,0)
 S LRA=1
"RTN","LRSORA",29,0)
 F I=0:0 D @$S(LRA=2:"SPEC",LRA=3:"CND",LRA=4:"GV",1:"TST") Q:LRA=0
"RTN","LRSORA",30,0)
 Q
"RTN","LRSORA",31,0)
TST ;
"RTN","LRSORA",32,0)
 K DIC S DIC="^LAB(60,",DIC(0)="AEMOQ"
"RTN","LRSORA",33,0)
 S DIC("S")="I $P(^(0),U,5)[""CH"",""BO""[$P(^(0),U,3)" D ^DIC
"RTN","LRSORA",34,0)
 S LRA=$S(Y>0:2,1:0)
"RTN","LRSORA",35,0)
 S:X["^" LREND=1
"RTN","LRSORA",36,0)
 I Y>0 S $P(LRTST(LRTST,3),"^",1)=$P($P(^LAB(60,+Y,0),U,5),";",2)
"RTN","LRSORA",37,0)
 I  S $P(LRTST(LRTST,2),"^",1)=$P(Y,"^",2)
"RTN","LRSORA",38,0)
 Q
"RTN","LRSORA",39,0)
SPEC ;
"RTN","LRSORA",40,0)
 S LRCNT=LRCNT+1
"RTN","LRSORA",41,0)
 K DIC S DIC="^LAB(61,",DIC(0)="AEMOQ"
"RTN","LRSORA",42,0)
 S DIC("A")="Select SPECIMEN/SITE: ANY// " D ^DIC
"RTN","LRSORA",43,0)
 S:Y<1 $P(LRTST(LRTST,3),"^",2)="",$P(LRTST(LRTST,2),"^",2)=""
"RTN","LRSORA",44,0)
 S LRA=$S(X["^":1,1:3)
"RTN","LRSORA",45,0)
 I Y>0 S $P(LRTST(LRTST,3),"^",2)=+Y,$P(LRTST(LRTST,2),"^",2)=$P(Y,"^",2)
"RTN","LRSORA",46,0)
 Q
"RTN","LRSORA",47,0)
CND ;
"RTN","LRSORA",48,0)
 W !,"Select CONDITION: " R X:DTIME S:'$T X="^"
"RTN","LRSORA",49,0)
 D @$S(X?1.N1":"1.N:"RNG",1:"GC") Q
"RTN","LRSORA",50,0)
RNG ;
"RTN","LRSORA",51,0)
 N Y
"RTN","LRSORA",52,0)
 S LRV=+$P(X,":",1),LRV2=+$P(X,":",2),LRA=0
"RTN","LRSORA",53,0)
 S:LRV>LRV2 X=LRV,LRV=LRV2,LRV2=X
"RTN","LRSORA",54,0)
 S $P(LRTST(LRTST,2),U,3)="BETWEEN "_LRV_" AND "_LRV2
"RTN","LRSORA",55,0)
 S X=$P(LRTST(LRTST,3),U,1)
"RTN","LRSORA",56,0)
 S Y="I $D(^("_X
"RTN","LRSORA",57,0)
 S Y=Y_")) S LRVX=$P(^("_X
"RTN","LRSORA",58,0)
 S Y=Y_"),U),LRVX=$S(LRVX?1A.E:LRVX,"
"RTN","LRSORA",59,0)
 S Y=Y_"""<>""[$E(LRVX):$E(LRVX,2,$L(LRVX)),1:LRVX)"
"RTN","LRSORA",60,0)
 S LRTST(LRTST,1)=Y_" I LRVX>"_LRV_",LRVX<"_LRV2
"RTN","LRSORA",61,0)
 D ASPC Q
"RTN","LRSORA",62,0)
GC ;
"RTN","LRSORA",63,0)
 S DIC="^DOPT(""DIS"",",DIC(0)="EMQZ",DIC("S")="I $L($P(^(0),U,2))"
"RTN","LRSORA",64,0)
 D ^DIC K DIC
"RTN","LRSORA",65,0)
 S LRA=$S(X["^":2,Y<0:3,1:4) D:X["?" HLP1 W:'$L(X) " ??" Q:Y<0
"RTN","LRSORA",66,0)
GV ;
"RTN","LRSORA",67,0)
 N LY,ALPHA,DEC,II,TT
"RTN","LRSORA",68,0)
 W !,"Enter VALUE: "
"RTN","LRSORA",69,0)
 R X:DTIME S:'$T X="^"
"RTN","LRSORA",70,0)
 S LRA=$S(X["^":3,"?"[X:4,1:0)
"RTN","LRSORA",71,0)
 W:X="" " ??" D:X["?" HLP2 Q:LRA
"RTN","LRSORA",72,0)
 S:"<>"[$P(Y(0),U,2) X=+X
"RTN","LRSORA",73,0)
 S $P(LRTST(LRTST,2),"^",3)=$P(Y(0),"^",1)_" "_X
"RTN","LRSORA",74,0)
 ;
"RTN","LRSORA",75,0)
 ; determine if entered value is alphanumeric
"RTN","LRSORA",76,0)
 S (ALPHA,DEC)=0
"RTN","LRSORA",77,0)
 F II=1:1 S TT=$E(X,II) Q:TT=""  D  Q:ALPHA
"RTN","LRSORA",78,0)
 . I TT?1N Q
"RTN","LRSORA",79,0)
 . I TT?1"." S DEC=DEC+1 S:DEC>1 ALPHA=1 Q
"RTN","LRSORA",80,0)
 . S ALPHA=1
"RTN","LRSORA",81,0)
 I X="""""" S ALPHA=0 ;ADDED FOR LR*5.2*357
"RTN","LRSORA",82,0)
 ;
"RTN","LRSORA",83,0)
 S LY="I $D(^("_$P(LRTST(LRTST,3),U)
"RTN","LRSORA",84,0)
 S LY=LY_")) S LRVX=$P(^("
"RTN","LRSORA",85,0)
 S LY=LY_$P(LRTST(LRTST,3),U)
"RTN","LRSORA",86,0)
 S LY=LY_"),U),LRVX=$S(LRVX?1A.E:LRVX,"
"RTN","LRSORA",87,0)
 S LY=LY_"""<>""[$E(LRVX):$E(LRVX,2,$L(LRVX)),1:LRVX) I LRVX"
"RTN","LRSORA",88,0)
 S LRTST(LRTST,1)=LY_$P(Y(0),U,2)_$S(ALPHA:""""_X_"""",1:X) D ASPC Q
"RTN","LRSORA",89,0)
ASPC ;
"RTN","LRSORA",90,0)
 S:$L($P(LRTST(LRTST,3),U,2)) LRTST(LRTST,1)=LRTST(LRTST,1)_",$P(^(0),U,5)="_$P(LRTST(LRTST,3),U,2) Q
"RTN","LRSORA",91,0)
INIT ;
"RTN","LRSORA",92,0)
 S LRCNT=0
"RTN","LRSORA",93,0)
 S U="^"
"RTN","LRSORA",94,0)
 S LREND=0
"RTN","LRSORA",95,0)
 S LRLONG=0
"RTN","LRSORA",96,0)
 S LRSDT="TODAY"
"RTN","LRSORA",97,0)
 S LREDT="T-1"
"RTN","LRSORA",98,0)
 S LRTW=.00001
"RTN","LRSORA",99,0)
 S:'$D(DTIME) DTIME=300
"RTN","LRSORA",100,0)
 W !,"SPECIAL REPORT - Search for high/low values" Q
"RTN","LRSORA",101,0)
GDT ;
"RTN","LRSORA",102,0)
 F W=0:0 D SDF,GSD Q:LREND  S LRSDT=Y D GED I Y>0 S LREDT=Y S:LREDT>LRSDT X=LREDT,LREDT=LRSDT,LRSDT=X D CXR W:Y'>0 !!,"No data for the year selected.",! Q:Y>0
"RTN","LRSORA",103,0)
 K %DT S X=$P(LRSDT,"."),%DT="X" D ^%DT,DD^LRX S LRSDAT=Y
"RTN","LRSORA",104,0)
 K %DT S X=$P(LREDT,"."),%DT="X" D ^%DT,DD^LRX S LREDAT=Y
"RTN","LRSORA",105,0)
 S LRHDR2="For date range: "_LREDAT_" to "_LRSDAT
"RTN","LRSORA",106,0)
 K LRSDAT,LREDAT,%DT Q
"RTN","LRSORA",107,0)
GSD ;
"RTN","LRSORA",108,0)
 S %DT("A")="Enter START date: ",%DT("B")=LRSDT,%DT="AET"
"RTN","LRSORA",109,0)
 D ^%DT S LREND=Y<1 Q
"RTN","LRSORA",110,0)
GED ;
"RTN","LRSORA",111,0)
 S %DT("A")="Enter END date: ",%DT("B")=LREDT D ^%DT Q
"RTN","LRSORA",112,0)
CXR ;
"RTN","LRSORA",113,0)
 S Y=$E(LREDT,1,3)_"0000" F I=0:0 S Y=$O(^LRO(69,Y)) Q:Y=""!($D(^LRO(69,+Y,1,"AN")))
"RTN","LRSORA",114,0)
 I Y>LREDT D DD^LRX W !,"The earliest date in the X-ref is ",Y,".  Long search required.",! D CXR1
"RTN","LRSORA",115,0)
 Q
"RTN","LRSORA",116,0)
CXR1 ;
"RTN","LRSORA",117,0)
 F I=0:0 S %=2 W "  OK to continue" D YN^DICN S:%=2!(%<0) LREND=1 S:%=1 LRLONG=1 Q:%  W !,"Enter 'YES' for the long search, 'NO' to exit.",!
"RTN","LRSORA",118,0)
 Q
"RTN","LRSORA",119,0)
SDF ;
"RTN","LRSORA",120,0)
 I LRSDT?1.7N S Y=LRSDT D DD^LRX S LRSDT=Y
"RTN","LRSORA",121,0)
 I LREDT?1.7N S Y=LREDT D DD^LRX S LREDT=Y
"RTN","LRSORA",122,0)
 Q
"RTN","LRSORA",123,0)
GLOG ;
"RTN","LRSORA",124,0)
 S:LRTST=1 LRTST(0)="A" D:LRTST>1 EN^LRSORA1 S:LRTST<1 LREND=1 Q
"RTN","LRSORA",125,0)
GDV ;
"RTN","LRSORA",126,0)
 S %ZIS="Q" D ^%ZIS K %ZIS I POP S LREND=1 Q
"RTN","LRSORA",127,0)
 I $D(IO("Q")) K IO("Q") S (LRQUE,LREND)=1,ZTRTN="RUN^LRSORA",ZTDESC="Lab Special Report",ZTSAVE("LR*")="" D ^%ZTLOAD
"RTN","LRSORA",128,0)
 Q
"RTN","LRSORA",129,0)
HLP1 ;
"RTN","LRSORA",130,0)
 W !,"A VALUE RANGE may also be entered (value:value).",!,"  For Example, 100:200 will search for values between 100 and 200.",!
"RTN","LRSORA",131,0)
 Q
"RTN","LRSORA",132,0)
HLP2 ;
"RTN","LRSORA",133,0)
 W !,"Enter a value for the comparison:  "
"RTN","LRSORA",134,0)
 W $P(LRTST(LRTST,2),U,1)," ",$P(Y(0),U,1)_" _____."
"RTN","LRSORA",135,0)
 Q
"RTN","LRSORA",136,0)
XX ;
"RTN","LRSORA",137,0)
WAIT K DIR S DIR(0)="E" D ^DIR S:($D(DUOUT))!($D(DTOUT)) LREND=1
"RTN","LRSORA",138,0)
 Q
"RTN","LRSORA2")
0^5^B18844521^B18842054
"RTN","LRSORA2",1,0)
LRSORA2 ;DALOI/KCM/DRH/RLM-SEARCH LAB DATA AND PRINT REPORT ;8/28/89  12:07
"RTN","LRSORA2",2,0)
 ;;5.2;LAB SERVICE;**2,62,201,272,369**;Sep 27, 1994;Build 2
"RTN","LRSORA2",3,0)
 ; Reference to $$FMTE^XLFDT supported by IA #10103
"RTN","LRSORA2",4,0)
 ; Reference to DD^%DT supported by IA #10003
"RTN","LRSORA2",5,0)
 ; Reference to ^DIR supported by IA #10026
"RTN","LRSORA2",6,0)
 ; Reference to $$FMTE^XLFDT supported by IA #10103
"RTN","LRSORA2",7,0)
 ; Reference to $$NOW^XLFDT supported by IA #10103
"RTN","LRSORA2",8,0)
START ;
"RTN","LRSORA2",9,0)
 D BUILD^LRSORA3
"RTN","LRSORA2",10,0)
 S (LRTSTCK,LRSPCK,LRPATCK)="",NEWPG=1
"RTN","LRSORA2",11,0)
 W:$E(IOST,1,2)="C-" @IOF
"RTN","LRSORA2",12,0)
 D MAINLOOP I LREND=1 D END QUIT
"RTN","LRSORA2",13,0)
 D:'LREND SUMMARY
"RTN","LRSORA2",14,0)
 D END
"RTN","LRSORA2",15,0)
 Q
"RTN","LRSORA2",16,0)
MAINLOOP ;
"RTN","LRSORA2",17,0)
 S (LROLD,LRTOP,LRSPCK,REFCK,LRTSTCK)=""
"RTN","LRSORA2",18,0)
 S LRSORTI="^TMP(""LR"","_$J_")"
"RTN","LRSORA2",19,0)
 F  S LRSORTI=$Q(@LRSORTI) Q:LRSORTI'[$J!(LREND=1)  D
"RTN","LRSORA2",20,0)
 . D SET Q:LREND=1
"RTN","LRSORA2",21,0)
 . D PRTCONT Q:LREND=1
"RTN","LRSORA2",22,0)
 Q
"RTN","LRSORA2",23,0)
END ;
"RTN","LRSORA2",24,0)
 K DIR
"RTN","LRSORA2",25,0)
 K LROLD,LRTOP,LRSPCK,REFCK,LRTSTK,LRCOMX,LRSORTI
"RTN","LRSORA2",26,0)
 K LRPREC,PNM,LRCHNG,LRLO,LRHI,LRAN,LRMRK,LRWRD,LRVAL
"RTN","LRSORA2",27,0)
 K LRTEST,LRPREC,LRCDT,LRUNITS,LRCOUNT,NEWPG
"RTN","LRSORA2",28,0)
 Q
"RTN","LRSORA2",29,0)
SET ;
"RTN","LRSORA2",30,0)
 S LRCOMX=0
"RTN","LRSORA2",31,0)
 I LRSORTI["""COM""" W "     COMMENT: ",@LRSORTI,! S LRCOMX=1 QUIT
"RTN","LRSORA2",32,0)
 S LRPREC=@LRSORTI
"RTN","LRSORA2",33,0)
 S PNM=$P(LRPREC,U),SSN=$P(LRPREC,U,2),LRLOC=$P(LRPREC,U,3)
"RTN","LRSORA2",34,0)
 S LRSPEC=$P(LRPREC,U,5)
"RTN","LRSORA2",35,0)
 S LRCHNG=LRSPEC D CHNCASE S LRSPEC=LRCHNG
"RTN","LRSORA2",36,0)
 S LRLO=$P(LRPREC,U,7),LRHI=$P(LRPREC,U,8),LRVAL=$P(LRPREC,U,9)
"RTN","LRSORA2",37,0)
 S LRMRK=$P(LRPREC,U,10),LRTHER=$P(LRPREC,U,11)
"RTN","LRSORA2",38,0)
 S LRAN=$P(LRPREC,U,13),LRCDT=$P(LRPREC,U,14)
"RTN","LRSORA2",39,0)
 S LRWRD=$P($G(LRPREC),U,12)
"RTN","LRSORA2",40,0)
 S LRWRD=$S(""[LRWRD:"**No Entry**",1:LRWRD)
"RTN","LRSORA2",41,0)
 S LRTEST=$P(LRPREC,U,15)
"RTN","LRSORA2",42,0)
 S:SSN'=LROLD LROLD=SSN,LRTOP=1
"RTN","LRSORA2",43,0)
 S LRUNITS=$P(LRPREC,U,16)
"RTN","LRSORA2",44,0)
 S Y=LRCDT D DD^%DT S LRCDT=$E(Y,1,18)
"RTN","LRSORA2",45,0)
 Q
"RTN","LRSORA2",46,0)
PRTCONT ;
"RTN","LRSORA2",47,0)
 Q:$G(LREND)
"RTN","LRSORA2",48,0)
 S LRCOUNT=0
"RTN","LRSORA2",49,0)
 D CHKPG Q:LREND=1
"RTN","LRSORA2",50,0)
 I NEWPG=1 D COND1 Q
"RTN","LRSORA2",51,0)
 I LRPATCK'=SSN D COND2 Q
"RTN","LRSORA2",52,0)
 I LRSPCK'=LRSPEC D COND3 Q
"RTN","LRSORA2",53,0)
 I LRTSTCK'=LRTEST D COND3 Q
"RTN","LRSORA2",54,0)
 I LRTSTCK=LRTEST D COND4 Q
"RTN","LRSORA2",55,0)
 Q
"RTN","LRSORA2",56,0)
COND1 ;
"RTN","LRSORA2",57,0)
 D PAGE S NEWPG=""
"RTN","LRSORA2",58,0)
 D NEWPAT
"RTN","LRSORA2",59,0)
 D NEWSPEC
"RTN","LRSORA2",60,0)
 D NEWTST S LRCOUNT=1
"RTN","LRSORA2",61,0)
 Q
"RTN","LRSORA2",62,0)
COND2 ;
"RTN","LRSORA2",63,0)
 D NEWPAT
"RTN","LRSORA2",64,0)
 D NEWSPEC
"RTN","LRSORA2",65,0)
 D NEWTST S LRCOUNT=1
"RTN","LRSORA2",66,0)
 Q
"RTN","LRSORA2",67,0)
COND3 ;
"RTN","LRSORA2",68,0)
 D NEWSPEC
"RTN","LRSORA2",69,0)
 D NEWTST S LRCOUNT=1
"RTN","LRSORA2",70,0)
 Q
"RTN","LRSORA2",71,0)
COND4 ;
"RTN","LRSORA2",72,0)
 D NEWTST S LRCOUNT=1
"RTN","LRSORA2",73,0)
 Q
"RTN","LRSORA2",74,0)
PAGE ;
"RTN","LRSORA2",75,0)
 W:$E(IOST,1,2)="C-" @IOF
"RTN","LRSORA2",76,0)
 D HDR1 S LRTOP=1
"RTN","LRSORA2",77,0)
 Q
"RTN","LRSORA2",78,0)
NEWPAT ;
"RTN","LRSORA2",79,0)
 D HDR2 S LRPATCK=SSN
"RTN","LRSORA2",80,0)
 Q
"RTN","LRSORA2",81,0)
NEWSPEC ;
"RTN","LRSORA2",82,0)
 D PRSPEC S LRSPCK=LRSPEC
"RTN","LRSORA2",83,0)
 Q
"RTN","LRSORA2",84,0)
NEWTST ;
"RTN","LRSORA2",85,0)
 D PRTEST S LRTSTCK=LRTEST
"RTN","LRSORA2",86,0)
 Q
"RTN","LRSORA2",87,0)
SAMETST ;
"RTN","LRSORA2",88,0)
 D PRTEST
"RTN","LRSORA2",89,0)
 Q
"RTN","LRSORA2",90,0)
CHKPG ;
"RTN","LRSORA2",91,0)
 S:LRCNT<1 LRCNT=1
"RTN","LRSORA2",92,0)
 Q:$G(LREND)
"RTN","LRSORA2",93,0)
 I $Y>(IOSL-7-LRCNT) S NEWPG=1 D
"RTN","LRSORA2",94,0)
 .  D LEGEND W:$E(IOST,1,2)'="C-" @IOF
"RTN","LRSORA2",95,0)
 .  D:$E(IOST,1,2)="C-" WAIT Q:LREND  S LRTOP=1
"RTN","LRSORA2",96,0)
 Q
"RTN","LRSORA2",97,0)
PRSPEC ;
"RTN","LRSORA2",98,0)
 W ?2,$E(LRSPEC,1,10)
"RTN","LRSORA2",99,0)
 W ?14,$S(LRTHER:"Th. Range ",1:"Ref. Range:   "),LRLO
"RTN","LRSORA2",100,0)
 W "-",LRHI," ",LRUNITS,!
"RTN","LRSORA2",101,0)
 Q
"RTN","LRSORA2",102,0)
PRTEST ;
"RTN","LRSORA2",103,0)
 Q:$G(LRCOMX)
"RTN","LRSORA2",104,0)
 Q:$G(LREND)
"RTN","LRSORA2",105,0)
 S LRCOMX=0
"RTN","LRSORA2",106,0)
 W ?4,$E(LRTEST,1,12),?14,LRAN,?30,$J(LRVAL,4)
"RTN","LRSORA2",107,0)
 W ?33,LRMRK,?40,$E(LRCDT,1,6)_" "_$E($P(LRCDT,",",2),2,5)
"RTN","LRSORA2",108,0)
 W " at ",$P(LRCDT,"@",2)
"RTN","LRSORA2",109,0)
 W ?64,LRLOC,!
"RTN","LRSORA2",110,0)
 Q:$G(LREND)!(LRTOP)
"RTN","LRSORA2",111,0)
 Q
"RTN","LRSORA2",112,0)
COM ;Print comments on specimen
"RTN","LRSORA2",113,0)
 Q:$G(LREND)  W !," COMMENT(S): "
"RTN","LRSORA2",114,0)
 S C=""
"RTN","LRSORA2",115,0)
 F  S C=$O(^TMP("LR",$J,LRSUB1,LRSUB2,LRSUB3,LRAN,"COM",C)) Q:(C="")!(LREND)  D
"RTN","LRSORA2",116,0)
 .I $Y+7>IOSL D
"RTN","LRSORA2",117,0)
 ..D:$E(IOST,1,2)="C-" WAIT Q:LREND=1  D CHKPG
"RTN","LRSORA2",118,0)
 ..W !,"COMMENT(S): "
"RTN","LRSORA2",119,0)
 .Q:LREND
"RTN","LRSORA2",120,0)
 Q
"RTN","LRSORA2",121,0)
SUMMARY ;
"RTN","LRSORA2",122,0)
 I ($Y>(IOSL-7-LRCNT)) D:$E(IOST,1,2)="C-" WAIT Q:LREND=1  D CHKPG
"RTN","LRSORA2",123,0)
 D LEGEND
"RTN","LRSORA2",124,0)
 F I=$Y:1:(IOSL-6) W !
"RTN","LRSORA2",125,0)
 W !,?20,"END OF SPECIAL REPORT" QUIT
"RTN","LRSORA2",126,0)
 Q
"RTN","LRSORA2",127,0)
HDR1 ;
"RTN","LRSORA2",128,0)
 S LRTST(0)=$E(LRTST(0),1,30)
"RTN","LRSORA2",129,0)
 S %=32-$L(LRTST(0))\2+15
"RTN","LRSORA2",130,0)
 S LRPAG=LRPAG+1
"RTN","LRSORA2",131,0)
 W "SPECIAL REPORT",?31
"RTN","LRSORA2",132,0)
 W "Report Date:   "
"RTN","LRSORA2",133,0)
 W $$FMTE^XLFDT($$NOW^XLFDT,"")
"RTN","LRSORA2",134,0)
 W !,LRHDR2,?71,"Pg ",$J(LRPAG,3)
"RTN","LRSORA2",135,0)
 W ! D LRGLIN^LRX
"RTN","LRSORA2",136,0)
 S LRTOP=""
"RTN","LRSORA2",137,0)
 S LRCHKSP=0
"RTN","LRSORA2",138,0)
 Q
"RTN","LRSORA2",139,0)
HDR2 ;
"RTN","LRSORA2",140,0)
 W !,PNM,?28,SSN,?61,$E(LRWRD,1,16),!
"RTN","LRSORA2",141,0)
 Q
"RTN","LRSORA2",142,0)
WAIT W ! K DIR S DIR(0)="E" D ^DIR S:($D(DUOUT))!($D(DTOUT)) LREND=1
"RTN","LRSORA2",143,0)
 Q
"RTN","LRSORA2",144,0)
CHNCASE ;
"RTN","LRSORA2",145,0)
 S LRCHNG=$E(LRCHNG)_$$LOWCASE^LRAFUNC($E(LRCHNG,2,$L(LRCHNG)))
"RTN","LRSORA2",146,0)
 Q
"RTN","LRSORA2",147,0)
LEGEND ;
"RTN","LRSORA2",148,0)
 D LRGLIN^LRX
"RTN","LRSORA2",149,0)
 W !,"Search Criteria:"
"RTN","LRSORA2",150,0)
 F %=1:1:LRTST D
"RTN","LRSORA2",151,0)
 . W !,%,") " S LRCHNG=$E($P(LRTST(%,2),U,1),1,10) D CHNCASE
"RTN","LRSORA2",152,0)
 . W LRCHNG," "
"RTN","LRSORA2",153,0)
 . W $P(LRTST(%,2),U,3),"  Specimen: "
"RTN","LRSORA2",154,0)
 . W $S($P(LRTST(%,2),U,2)'="":$E($P(LRTST(%,2),U,2),1,79-$X),1:"Any")
"RTN","LRSORA2",155,0)
 Q
"VER")
8.0^22.0
"BLD",7188,6)
^286
**END**
**END**
