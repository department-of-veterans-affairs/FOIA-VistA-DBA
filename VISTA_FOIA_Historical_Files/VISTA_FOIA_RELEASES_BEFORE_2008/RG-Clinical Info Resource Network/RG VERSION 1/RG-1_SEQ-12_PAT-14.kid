Released RG*1*14 SEQ #12
Extracted from mail message
**KIDS**:RG*1.0*14^

**INSTALL NAME**
RG*1.0*14
"BLD",1200,0)
RG*1.0*14^CLINICAL INFO RESOURCE NETWORK^0^3010215^y
"BLD",1200,1,0)
^^3^3^3010215^
"BLD",1200,1,1,0)
MPI/PD-CPRS REMOTE DATA VIEWS CORRECTION
"BLD",1200,1,2,0)
Refer to patch RG*1.0*14 in the FORUM Patch Module for a complete
"BLD",1200,1,3,0)
description.
"BLD",1200,4,0)
^9.64PA^991.8^1
"BLD",1200,4,991.8,0)
991.8
"BLD",1200,4,991.8,2,0)
^9.641^991.8^1
"BLD",1200,4,991.8,2,991.8,0)
CIRN SITE PARAMETER  (File-top level)
"BLD",1200,4,991.8,2,991.8,1,0)
^9.6411^13^1
"BLD",1200,4,991.8,2,991.8,1,13,0)
MPI/PD DATA COMPARE COMP DATE
"BLD",1200,4,991.8,222)
y^y^p^^^^n
"BLD",1200,4,"APDD",991.8,991.8)

"BLD",1200,4,"APDD",991.8,991.8,13)

"BLD",1200,4,"B",991.8,991.8)

"BLD",1200,"ABNS",0)
^9.66A^^
"BLD",1200,"ABPKG")
^^
"BLD",1200,"INIT")

"BLD",1200,"KRN",0)
^9.67PA^19^17
"BLD",1200,"KRN",.4,0)
.4
"BLD",1200,"KRN",.401,0)
.401
"BLD",1200,"KRN",.402,0)
.402
"BLD",1200,"KRN",.403,0)
.403
"BLD",1200,"KRN",.5,0)
.5
"BLD",1200,"KRN",.84,0)
.84
"BLD",1200,"KRN",3.6,0)
3.6
"BLD",1200,"KRN",3.8,0)
3.8
"BLD",1200,"KRN",9.2,0)
9.2
"BLD",1200,"KRN",9.8,0)
9.8
"BLD",1200,"KRN",9.8,"NM",0)
^9.68A^3^2
"BLD",1200,"KRN",9.8,"NM",2,0)
RGADT1^^0^B25419221
"BLD",1200,"KRN",9.8,"NM",3,0)
RGADT^^0^B11019837
"BLD",1200,"KRN",9.8,"NM","B","RGADT",3)

"BLD",1200,"KRN",9.8,"NM","B","RGADT1",2)

"BLD",1200,"KRN",19,0)
19
"BLD",1200,"KRN",19.1,0)
19.1
"BLD",1200,"KRN",101,0)
101
"BLD",1200,"KRN",409.61,0)
409.61
"BLD",1200,"KRN",771,0)
771
"BLD",1200,"KRN",870,0)
870
"BLD",1200,"KRN",8994,0)
8994
"BLD",1200,"KRN","B",.4,.4)

"BLD",1200,"KRN","B",.401,.401)

"BLD",1200,"KRN","B",.402,.402)

"BLD",1200,"KRN","B",.403,.403)

"BLD",1200,"KRN","B",.5,.5)

"BLD",1200,"KRN","B",.84,.84)

"BLD",1200,"KRN","B",3.6,3.6)

"BLD",1200,"KRN","B",3.8,3.8)

"BLD",1200,"KRN","B",9.2,9.2)

"BLD",1200,"KRN","B",9.8,9.8)

"BLD",1200,"KRN","B",19,19)

"BLD",1200,"KRN","B",19.1,19.1)

"BLD",1200,"KRN","B",101,101)

"BLD",1200,"KRN","B",409.61,409.61)

"BLD",1200,"KRN","B",771,771)

"BLD",1200,"KRN","B",870,870)

"BLD",1200,"KRN","B",8994,8994)

"BLD",1200,"QUES",0)
^9.62^^
"BLD",1200,"REQB",0)
^9.611^3^3
"BLD",1200,"REQB",1,0)
RG*1.0*4^2
"BLD",1200,"REQB",2,0)
RG*1.0*8^2
"BLD",1200,"REQB",3,0)
MPIF*1.0*8^2
"BLD",1200,"REQB","B","MPIF*1.0*8",3)

"BLD",1200,"REQB","B","RG*1.0*4",1)

"BLD",1200,"REQB","B","RG*1.0*8",2)

"FIA",991.8)
CIRN SITE PARAMETER
"FIA",991.8,0)
^RGSITE(991.8,
"FIA",991.8,0,0)
991.8
"FIA",991.8,0,1)
y^y^p^^^^n
"FIA",991.8,0,10)

"FIA",991.8,0,11)

"FIA",991.8,0,"RLRO")

"FIA",991.8,0,"VR")
1.0^RG
"FIA",991.8,991.8)
1
"FIA",991.8,991.8,13)

"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
14^3010215
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3010215
"PKG",272,22,1,"PAH",1,1,1,0)
MPI/PD-CPRS REMOTE DATA VIEWS CORRECTION
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1.0*14 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RGADT")
0^3^B11019837
"RTN","RGADT",1,0)
RGADT ;HIRMFO/GJC-ADT MESSAGE PROCESSING/ROUTING ;09/21/99
"RTN","RGADT",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**4,8,14**;30 Apr 99
"RTN","RGADT",3,0)
 Q  ; quit if called from the top
"RTN","RGADT",4,0)
 ;
"RTN","RGADT",5,0)
EN ;entry point to process local ADT messages.
"RTN","RGADT",6,0)
 ;
"RTN","RGADT",7,0)
 ;This is call by the following clients:
"RTN","RGADT",8,0)
 ; RG ADT-A01 CLIENT & RG ADT-A03 CLIENT (Generate/Process
"RTN","RGADT",9,0)
 ; Routine(771) & Routing Logic(774) field definitions
"RTN","RGADT",10,0)
 ;
"RTN","RGADT",11,0)
 ; Integration Agreements (IAs) utilized in this application:
"RTN","RGADT",12,0)
 ; #2988-IAs for VAFCTFU utilities
"RTN","RGADT",13,0)
 ; #3037-ADT/HL7 EVENT REASON (#391.72) file access
"RTN","RGADT",14,0)
 ;
"RTN","RGADT",15,0)
 Q:$G(HL("MTN"))="ACK"  ; quit if a ACK message type is passed here
"RTN","RGADT",16,0)
 K RGDC,RGDCDFN,RGDCERR,RGDCEVN,RGDCEVN1,RGDCPID,RGDCSFN,RGDCV
"RTN","RGADT",17,0)
 S U="^" D INITIZE^RGRSUTIL ; copy HL7 message into local RGDC array
"RTN","RGADT",18,0)
 S RGDCV=$$EN^RGRSMSH() ;return: dt rec'd^event dt^sending fac.(xternal)
"RTN","RGADT",19,0)
 ; note: the above dates are in FileMan internal format
"RTN","RGADT",20,0)
 S RGDCPID=$$SEG1^RGRSUTIL("PID",1,"PID")
"RTN","RGADT",21,0)
 S RGDCSFN=$$LKUP^XUAF4(+$P(RGDCV,U,3)) ; obtain TF ien from station #
"RTN","RGADT",22,0)
 S RGDCEVN=$P($$SEG1^RGRSUTIL("EVN",1,"EVN"),U,5) ; event reason code
"RTN","RGADT",23,0)
 S RGDCEVN=$$FIND1^DIC(391.72,"","AXM",RGDCEVN) ; event reason(internal)
"RTN","RGADT",24,0)
 S RGDCEVN1=$P($$SEG1^RGRSUTIL("EVN",1,"EVN"),U,2) ; event type
"RTN","RGADT",25,0)
 S RGDCDFN=$$GETDFN^MPIF001(+$P(RGDCPID,HL("FS"),3))
"RTN","RGADT",26,0)
 ; Note: $P(RGDCPID,HL("FS"),3) is: ICN_"V"_ICN checksum
"RTN","RGADT",27,0)
 ;S RGDCERR=$$ERR()
"RTN","RGADT",28,0)
 ;
"RTN","RGADT",29,0)
 ; input variables to FILE^VAFCTFU
"RTN","RGADT",30,0)
 ; RGDCDFN - patient ien ; RGDCSFN - treating facility
"RTN","RGADT",31,0)
 ; $P(RGDCV,U,2) - date last treated ; RGDCEVN - event reason
"RTN","RGADT",32,0)
 D FILE^VAFCTFU(RGDCDFN,RGDCSFN_U_$P(RGDCV,U,2)_U_RGDCEVN,1)
"RTN","RGADT",33,0)
 ; call to the TFL utility routine VAFCTFU.  Centrally located code
"RTN","RGADT",34,0)
 ; to add or edit to the TFL file.
"RTN","RGADT",35,0)
 ;
"RTN","RGADT",36,0)
 D GENACK ; generate the 'ack' message
"RTN","RGADT",37,0)
KILL ; kill and exit
"RTN","RGADT",38,0)
 K HLINKP,HLINKX,HLL,RGDC,RGDCDFN,RGDCERR,RGDCEVN,RGDCEVN1,RGDCPID,RGDCSFN,RGDCV
"RTN","RGADT",39,0)
 Q
"RTN","RGADT",40,0)
ERR() ; return the error string (if applicable)
"RTN","RGADT",41,0)
 S:$$FIND1^DIC(391.72,"","AXM",RGDCEVN)="" RGDCERR="could not resolve ADT/HL7 EVENT REASON file pointer"
"RTN","RGADT",42,0)
 S:$$GET1^DIQ(2,RGDCDFN,.01)="" RGDCERR="could not resolve PATIENT file pointer"
"RTN","RGADT",43,0)
 S:$$GET1^DIQ(4,+RGDCSFN_",",.01)="" RGDCERR="could not resolve INSTITUTION file pointer"
"RTN","RGADT",44,0)
 I $G(RGDCERR)="" D
"RTN","RGADT",45,0)
 .D DT^DILF("EXT",$P(RGDCV,"^",2),.RGDCERR)
"RTN","RGADT",46,0)
 .S:RGDCERR=-1 RGDCERR="invalid DATE LAST TREATED date/time value"
"RTN","RGADT",47,0)
 .S:RGDCERR'=-1 RGDCERR="" ; no date/time error
"RTN","RGADT",48,0)
 .Q
"RTN","RGADT",49,0)
 Q $G(RGDCERR)
"RTN","RGADT",50,0)
 ;
"RTN","RGADT",51,0)
DYNROU(RGDCEVT) ; dynamic message routing, but first need to update the
"RTN","RGADT",52,0)
 ; TREATING FACILITY LIST (TFL-391.91) file at the local site
"RTN","RGADT",53,0)
 ; input-{RGDCEVT=event type
"RTN","RGADT",54,0)
 K RGDCEDT,RGDCEVTR,RGDCSITE
"RTN","RGADT",55,0)
 S RGDCSITE=$$KSP^XUPARAM("INST"),U="^"
"RTN","RGADT",56,0)
 S RGDCEDT=$$FMDATE^HLFNC($P($$EVN(),U,3)) ; determine event date/time
"RTN","RGADT",57,0)
 S RGDCEVTR=$$FIND1^DIC(391.72,"","AXM",$P($$EVN(),U,5)) ; event reason
"RTN","RGADT",58,0)
 ;
"RTN","RGADT",59,0)
 ; input variables to FILE^VAFCTFU
"RTN","RGADT",60,0)
 ; DFN - patient ien ; RGDCSITE - treating facility
"RTN","RGADT",61,0)
 ; RGDCEDT - date last treated ; RGDCEVTR - event reason
"RTN","RGADT",62,0)
 D FILE^VAFCTFU(DFN,RGDCSITE_U_RGDCEDT_U_RGDCEVTR,1)
"RTN","RGADT",63,0)
 ; call to the TFL utility routine VAFCTFU.  Centrally located code
"RTN","RGADT",64,0)
 ; to add or edit to the TFL file.
"RTN","RGADT",65,0)
 ;
"RTN","RGADT",66,0)
 ; route the message
"RTN","RGADT",67,0)
 D EN^RGRSDYN("RG ADT-"_RGDCEVT_" CLIENT",0)
"RTN","RGADT",68,0)
 K RGDCEDT,RGDCEVTR,RGDCSITE
"RTN","RGADT",69,0)
 Q
"RTN","RGADT",70,0)
EVN() ; pass back the EVN segment.
"RTN","RGADT",71,0)
 N I,X S I=0
"RTN","RGADT",72,0)
 F  S I=$O(HLA("HLS",I)) Q:I'>0  D  Q:$D(X)
"RTN","RGADT",73,0)
 . S:$P(HLA("HLS",I),U)="EVN" X=$G(HLA("HLS",I))
"RTN","RGADT",74,0)
 . Q
"RTN","RGADT",75,0)
 Q $G(X)
"RTN","RGADT",76,0)
GENACK ; Compile the 'ACK' segment, generate the 'ACK' message.
"RTN","RGADT",77,0)
 S HLA("HLA",1)="MSA"_HL("FS")_$S($G(RGDCERR)]"":"AE",1:"AA")_HL("FS")_HL("MID")_$S($G(RGDCERR)]"":HL("FS")_$G(RGDCERR),1:"")
"RTN","RGADT",78,0)
 S HLEID=HL("EID"),HLEIDS=HL("EIDS"),HLARYTYP="LM",HLFORMAT=1
"RTN","RGADT",79,0)
 D GENACK^HLMA1(HLEID,HLMTIENS,HLEIDS,HLARYTYP,HLFORMAT,.HLRESTLA)
"RTN","RGADT",80,0)
 Q
"RTN","RGADT1")
0^2^B25419221
"RTN","RGADT1",1,0)
RGADT1 ;HIRMFO/GJC-BUILD ADT MESSAGES (A01/A03) ;09/21/99
"RTN","RGADT1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**4,14**;30 Apr 99
"RTN","RGADT1",3,0)
 Q  ; quit if called from the top
"RTN","RGADT1",4,0)
 ;
"RTN","RGADT1",5,0)
EN ; entry point to build/transmit ADT messages
"RTN","RGADT1",6,0)
 ; Messages built by this software are fired off by server protocols:
"RTN","RGADT1",7,0)
 ; RG ADT-A01 SERVER -or- RG ADT-A03 SERVER
"RTN","RGADT1",8,0)
 ;
"RTN","RGADT1",9,0)
 ; This code is called from the RG ADT ENCOUNTER DRIVER protocol
"RTN","RGADT1",10,0)
 ; entry action field.  RG ADT ENCOUNTER DRIVER is an item protocol
"RTN","RGADT1",11,0)
 ; under the SDAM APPOINTMENTS EVENTS & DGPM MOVEMENT EVENTS event
"RTN","RGADT1",12,0)
 ; protocols.  RG ADT ENCOUNTER DRIVER hangs off of SDAM APPOINTMENTS
"RTN","RGADT1",13,0)
 ; EVENTS because of DBIA: 1320, & DGPM MOVEMENT EVENTS because of
"RTN","RGADT1",14,0)
 ; DBIA: 1181.
"RTN","RGADT1",15,0)
 ;
"RTN","RGADT1",16,0)
 ; Integration Agreements (IAs) utilized in this application:
"RTN","RGADT1",17,0)
 ; #1320-subscribers for the SDAM APPOINTMENT EVENTS event driver
"RTN","RGADT1",18,0)
 ; #3015-PID segment generation (CIRN PD)
"RTN","RGADT1",19,0)
 ; #3016-EVN segment generation (CIRN PD)
"RTN","RGADT1",20,0)
 ; #3017-PD1 segment generator (CIRN PD)
"RTN","RGADT1",21,0)
 ; #3018-PV1 segment generator (CIRN PD)
"RTN","RGADT1",22,0)
 ;
"RTN","RGADT1",23,0)
 ; I DGPMP="" and DGPMA'="" it means we're adding a new ADMISSION,
"RTN","RGADT1",24,0)
 ; TRANSFER, DISCHARGE, or SPECIALTY TRANSFER to the Patient Movement
"RTN","RGADT1",25,0)
 ; File.  If RGTYPE=1 then we have an ADMISSION, if RGTYPE=3 then we
"RTN","RGADT1",26,0)
 ; have a DISCHARGE.
"RTN","RGADT1",27,0)
 ;
"RTN","RGADT1",28,0)
 ; Note: DFN is a supported variable in the case of admissions and
"RTN","RGADT1",29,0)
 ; discharges within the Registration package. (part of the discovery
"RTN","RGADT1",30,0)
 ; in the development of RG*1.0*14)
"RTN","RGADT1",31,0)
 ;
"RTN","RGADT1",32,0)
 ; first check if HL7 2.3 messaging has been disabled.  DBIA: 2624
"RTN","RGADT1",33,0)
 I '$P($$SEND^VAFHUTL(),"^",2) Q
"RTN","RGADT1",34,0)
 I $D(DGPMA) D  ; is this an inpatient admission/discharge?
"RTN","RGADT1",35,0)
 . S RGOK=0
"RTN","RGADT1",36,0)
 . I $G(DFN)'=+$G(DFN) Q  ; DFN must be valid
"RTN","RGADT1",37,0)
 . Q:'$P($G(^DPT(DFN,"MPI")),"^")  ; IA 2070, must have a national icn
"RTN","RGADT1",38,0)
 . Q:$$IFLOCAL^MPIF001(DFN)  ; IA 2701, patient has local icn, quit
"RTN","RGADT1",39,0)
 . I ($G(DGPMP)'=""!($G(DGPMA)="")) Q
"RTN","RGADT1",40,0)
 . N %,VAERR,VAIP
"RTN","RGADT1",41,0)
 . S VAIP("D")="LAST" D IN5^VADPT ; dfn should be defined at this point
"RTN","RGADT1",42,0)
 . S RGTYPE=+VAIP(2),RGDATE=+VAIP(3),RGMOV=$G(VAIP(1))
"RTN","RGADT1",43,0)
 . ; RGTYPE=movement type, RGDATE=movement date/time, RGMOV=ien #405
"RTN","RGADT1",44,0)
 . I ($G(RGTYPE)'=1&($G(RGTYPE)'=3)) Q
"RTN","RGADT1",45,0)
 . S RGOK=1,RGENVR=$S(RGTYPE=1:"A1",1:"A2") ; A1=admission, A2=discharge
"RTN","RGADT1",46,0)
 . Q
"RTN","RGADT1",47,0)
 ;
"RTN","RGADT1",48,0)
 ; Check SDAMEVT for values between five and nine inclusive.  See if
"RTN","RGADT1",49,0)
 ; this particular outpatient encounter has a status of CHECKED OUT.
"RTN","RGADT1",50,0)
 ; gjc@Hines OI for patch 14
"RTN","RGADT1",51,0)
 ;
"RTN","RGADT1",52,0)
 ; Note: DFN is not a supported variable in the case of clinic
"RTN","RGADT1",53,0)
 ; appointments and workload crediting for count clinics within the
"RTN","RGADT1",54,0)
 ; Scheduling package. (part of the discovery in the development of
"RTN","RGADT1",55,0)
 ; RG*1.0*14)
"RTN","RGADT1",56,0)
 ;
"RTN","RGADT1",57,0)
 ; check-out, stop code add/edit, disp add/edit?
"RTN","RGADT1",58,0)
 I '+$G(RGOK),($D(SDAMEVT)) N DFN D
"RTN","RGADT1",59,0)
 . ; DFN is unstable; it's up to us to define it...
"RTN","RGADT1",60,0)
 . S RGOK=0
"RTN","RGADT1",61,0)
 . ;chk-out, stop code add, stop code change, disp add & disp change
"RTN","RGADT1",62,0)
 . I $G(SDAMEVT)<5!($G(SDAMEVT)>9) Q
"RTN","RGADT1",63,0)
 . S RGTYPE=SDAMEVT,RGENVR="A3"
"RTN","RGADT1",64,0)
 . N RGSDOE,RGPARSE,RGPROC S RGPROC=0
"RTN","RGADT1",65,0)
 . F  S RGPROC=$O(^TMP("SDEVT",$J,SDHDL,RGPROC)) Q:'RGPROC  D
"RTN","RGADT1",66,0)
 .. S RGSDOE=0
"RTN","RGADT1",67,0)
 .. F  S RGSDOE=$O(^TMP("SDEVT",$J,SDHDL,RGPROC,"SDOE",RGSDOE)) Q:'RGSDOE  D
"RTN","RGADT1",68,0)
 ... S RGSDOE(0)=$G(^TMP("SDEVT",$J,SDHDL,RGPROC,"SDOE",RGSDOE,0,"AFTER"))
"RTN","RGADT1",69,0)
 ... ; Note: RGSDOE(0)=zero node of 409.68, DFN is the second piece 
"RTN","RGADT1",70,0)
 ... S DFN=$P(RGSDOE(0),"^",2) Q:'DFN  ; DFN must exist
"RTN","RGADT1",71,0)
 ... ; ignore current inpatients
"RTN","RGADT1",72,0)
 ... Q:$L($G(^DPT(DFN,.1)))  ; ward location check IA: 10035
"RTN","RGADT1",73,0)
 ... Q:'$P($G(^DPT(DFN,"MPI")),"^")  ; IA 2070, must have a national icn
"RTN","RGADT1",74,0)
 ... Q:$$IFLOCAL^MPIF001(DFN)  ; IA 2701, patient has local icn, quit
"RTN","RGADT1",75,0)
 ... D PARSE^SDOE(.RGSDOE,"EXTERNAL","RGPARSE")
"RTN","RGADT1",76,0)
 ... S:$G(RGPARSE(.12))="CHECKED OUT" RGDATE=$P(RGSDOE(0),U)
"RTN","RGADT1",77,0)
 ... Q
"RTN","RGADT1",78,0)
 .. Q
"RTN","RGADT1",79,0)
 . S:$G(RGDATE)]"" RGOK=1
"RTN","RGADT1",80,0)
 . Q
"RTN","RGADT1",81,0)
 ; S ^TMP("RGTRACE",$J)=1
"RTN","RGADT1",82,0)
 I 'RGOK K RGTYPE,RGMOV,RGDATE,RGENVR,RGOK Q  ; quit if not A01 or A03
"RTN","RGADT1",83,0)
 I '($G(DGQUIET)) S:$D(^TMP("RGTRACE",$J)) RGTRACE=1
"RTN","RGADT1",84,0)
 I $D(RGTRACE) D EVENT,EXIT Q
"RTN","RGADT1",85,0)
 N ZTDESC,ZTRTN,ZTSAVE,ZTIO,ZTDTH
"RTN","RGADT1",86,0)
 S ZTDESC="CIRN HL7 ADT-"_$S(RGTYPE=1:"A01",1:"A03")_" Messaging"
"RTN","RGADT1",87,0)
 S ZTRTN="EVENT^RGADT1",ZTIO="",ZTDTH=$H
"RTN","RGADT1",88,0)
 F I="DFN","RGDATE","RGTYPE","RGENVR" S ZTSAVE(I)=""
"RTN","RGADT1",89,0)
 S:$D(RGMOV) ZTSAVE("RGMOV")="" ; defined for admissions & discharges
"RTN","RGADT1",90,0)
 S:$D(SDOE) ZTSAVE("SDOE")="" ; file ien: 409.68, clinic check out
"RTN","RGADT1",91,0)
 D ^%ZTLOAD,EXIT
"RTN","RGADT1",92,0)
 Q
"RTN","RGADT1",93,0)
 ;
"RTN","RGADT1",94,0)
EVENT ; build the HL7 message
"RTN","RGADT1",95,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGADT1",96,0)
 S RGEVT=$S(RGTYPE=1:"A01",1:"A03") K HL
"RTN","RGADT1",97,0)
 D INIT^HLFNC2("RG ADT-"_RGEVT_" SERVER",.HL)
"RTN","RGADT1",98,0)
 I $G(HL) Q  ; error
"RTN","RGADT1",99,0)
 I RGTYPE=1!(RGTYPE=3) D  ; admission -or- discharge
"RTN","RGADT1",100,0)
 . D IN Q
"RTN","RGADT1",101,0)
 ;
"RTN","RGADT1",102,0)
 E  D OUT ; chkout, stop code add/edit, disp add/edit
"RTN","RGADT1",103,0)
 D GENERATE^HLMA("RG ADT-"_RGEVT_" SERVER","LM",1,.RGRSLT,"",.HL)
"RTN","RGADT1",104,0)
 D KILL^HLTRANS K HLA("HLS")
"RTN","RGADT1",105,0)
 Q
"RTN","RGADT1",106,0)
EXIT ; kill and quit
"RTN","RGADT1",107,0)
 K ^TMP("RGTRACE",$J),RGDATE,RGENVR,RGEVT,RGOK,RGMOV,RGPAT,RGRSLT,RGFSTR
"RTN","RGADT1",108,0)
 K RGTRACE,RGTYPE
"RTN","RGADT1",109,0)
 Q
"RTN","RGADT1",110,0)
IN ; build the ADT message for admission/discharges (registration)
"RTN","RGADT1",111,0)
 ; EVN segment
"RTN","RGADT1",112,0)
 S HLA("HLS",1)=$$EVN^VAFHLEVN(RGEVT,RGENVR)
"RTN","RGADT1",113,0)
 S $P(HLA("HLS",1),HL("FS"),3)=$$HLDATE^HLFNC(RGDATE,"TS")
"RTN","RGADT1",114,0)
 ; PID segment
"RTN","RGADT1",115,0)
 S RGFSTR=$$COMMANUM(1,30)
"RTN","RGADT1",116,0)
 S HLA("HLS",2)=$$EN^VAFCPID(DFN,RGFSTR,1)
"RTN","RGADT1",117,0)
 ; PD1 segment
"RTN","RGADT1",118,0)
 S RGFSTR=$$COMMANUM(1,12)
"RTN","RGADT1",119,0)
 S HLA("HLS",3)=$$EN^VAFHLPD1(DFN,RGFSTR)
"RTN","RGADT1",120,0)
 ; PV1 segment
"RTN","RGADT1",121,0)
 S RGFSTR="2,3,4,5,"_$$COMMANUM(7,45)
"RTN","RGADT1",122,0)
 S HLA("HLS",4)=$$IN^VAFHLPV1(DFN,RGDATE,RGFSTR,RGMOV,"","")
"RTN","RGADT1",123,0)
 Q
"RTN","RGADT1",124,0)
OUT ; build the ADT message for scheduling events: checkout
"RTN","RGADT1",125,0)
 ; EVN segment
"RTN","RGADT1",126,0)
 S HLA("HLS",1)=$$EVN^VAFHLEVN(RGEVT,RGENVR)
"RTN","RGADT1",127,0)
 S $P(HLA("HLS",1),HL("FS"),3)=$$HLDATE^HLFNC(RGDATE,"TS")
"RTN","RGADT1",128,0)
 ; PID segment
"RTN","RGADT1",129,0)
 S RGFSTR=$$COMMANUM(1,30)
"RTN","RGADT1",130,0)
 S HLA("HLS",2)=$$EN^VAFCPID(DFN,RGFSTR,1)
"RTN","RGADT1",131,0)
 ; PD1 segment
"RTN","RGADT1",132,0)
 S RGFSTR=$$COMMANUM(1,12)
"RTN","RGADT1",133,0)
 S HLA("HLS",3)=$$EN^VAFHLPD1(DFN,RGFSTR)
"RTN","RGADT1",134,0)
 ; PV1 segment
"RTN","RGADT1",135,0)
 S RGFSTR="2,3,4,5,"_$$COMMANUM(7,45)
"RTN","RGADT1",136,0)
 S HLA("HLS",4)=$$EN^VAFHLPV1("",,RGFSTR,,HL("Q"),HL("FS"))
"RTN","RGADT1",137,0)
 Q
"RTN","RGADT1",138,0)
COMMANUM(FROM,TO) ;Build comma seperated list of numbers
"RTN","RGADT1",139,0)
 ;Input  : FROM - Starting number (default = 1)
"RTN","RGADT1",140,0)
 ;         TO - Ending number (default = FROM)
"RTN","RGADT1",141,0)
 ;Output : Comma seperated list of numbers between FROM and TO
"RTN","RGADT1",142,0)
 ;         (Ex: 1,2,3)
"RTN","RGADT1",143,0)
 ;Notes  : Call assumes FROM <= TO
"RTN","RGADT1",144,0)
 ;         copied from COMMANUM^VAFCADT2
"RTN","RGADT1",145,0)
 ;
"RTN","RGADT1",146,0)
 S FROM=$G(FROM) S:(FROM="") FROM=1
"RTN","RGADT1",147,0)
 S TO=$G(TO) S:(TO="") TO=FROM
"RTN","RGADT1",148,0)
 N OUTPUT,X
"RTN","RGADT1",149,0)
 S OUTPUT=FROM
"RTN","RGADT1",150,0)
 F X=(FROM+1):1:TO S OUTPUT=(OUTPUT_","_X)
"RTN","RGADT1",151,0)
 Q OUTPUT
"VER")
8.0^22.0
"^DD",991.8,991.8,13,0)
MPI/PD DATA COMPARE COMP DATE^D^^1;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",991.8,991.8,13,3)
Enter the date/time the MPI/PD data comparison process completed.
"^DD",991.8,991.8,13,21,0)
^^4^4^3010118^
"^DD",991.8,991.8,13,21,1,0)
This field, 'MPI/PD DATA COMPARE COMP DATE', is used to track the
"^DD",991.8,991.8,13,21,2,0)
date/time our data comparison process completed.  This field is used to
"^DD",991.8,991.8,13,21,3,0)
ensure that the data comparison process is run once and only once at a
"^DD",991.8,991.8,13,21,4,0)
facility. If a date is present, our data comparison process terminates.
"^DD",991.8,991.8,13,23,0)
^^7^7^3010118^
"^DD",991.8,991.8,13,23,1,0)
This field, 'MPI/PD DATA COMPARE COMP DATE', is used to track the
"^DD",991.8,991.8,13,23,2,0)
date/time our data compare process completed.  This field is used to
"^DD",991.8,991.8,13,23,3,0)
ensure that the data compare process is run once and only once at a
"^DD",991.8,991.8,13,23,4,0)
facility.  If a date is present, our data comparison process terminates.
"^DD",991.8,991.8,13,23,5,0)
 
"^DD",991.8,991.8,13,23,6,0)
This field was added as part of the RG*1.0*14 / RG*1.0*15
"^DD",991.8,991.8,13,23,7,0)
multi-build bundle.  (CIRN-CPRS REMOTE PATIENT DATA VIEWS)
"^DD",991.8,991.8,13,"DT")
3010117
**END**
**END**
