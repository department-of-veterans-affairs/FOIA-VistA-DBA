Released PRC*5.1*100 SEQ #84
Extracted from mail message
**KIDS**:PRC*5.1*100^

**INSTALL NAME**
PRC*5.1*100
"BLD",4973,0)
PRC*5.1*100^IFCAP^0^3060705^y
"BLD",4973,1,0)
^^2^2^3060515^
"BLD",4973,1,1,0)
This patch addresses issues with the new functionality introduced by the 
"BLD",4973,1,2,0)
patch PRC*5.1*79 and reported via the Remedy system.
"BLD",4973,4,0)
^9.64PA^^
"BLD",4973,"ABPKG")
n
"BLD",4973,"KRN",0)
^9.67PA^8989.52^19
"BLD",4973,"KRN",.4,0)
.4
"BLD",4973,"KRN",.401,0)
.401
"BLD",4973,"KRN",.402,0)
.402
"BLD",4973,"KRN",.402,"NM",0)
^9.68A^8^8
"BLD",4973,"KRN",.402,"NM",1,0)
PRCH DELIVERY ORDER    FILE #442^442^0
"BLD",4973,"KRN",.402,"NM",2,0)
PRCH DELIVERY ORDER AMEND    FILE #443.6^443.6^0
"BLD",4973,"KRN",.402,"NM",3,0)
PRCH DETAILED PURCHASE CARD    FILE #442^442^0
"BLD",4973,"KRN",.402,"NM",4,0)
PRCH PC DIRECT DELIVERY    FILE #442^442^0
"BLD",4973,"KRN",.402,"NM",5,0)
PRCH PURCHASE CARD AMEND    FILE #443.6^443.6^0
"BLD",4973,"KRN",.402,"NM",6,0)
PRCHLINE    FILE #443.6^443.6^0
"BLD",4973,"KRN",.402,"NM",7,0)
PRCHQ RFQ REQUEST    FILE #444^444^0
"BLD",4973,"KRN",.402,"NM",8,0)
PRCH2138    FILE #442^442^0
"BLD",4973,"KRN",.402,"NM","B","PRCH DELIVERY ORDER    FILE #442",1)

"BLD",4973,"KRN",.402,"NM","B","PRCH DELIVERY ORDER AMEND    FILE #443.6",2)

"BLD",4973,"KRN",.402,"NM","B","PRCH DETAILED PURCHASE CARD    FILE #442",3)

"BLD",4973,"KRN",.402,"NM","B","PRCH PC DIRECT DELIVERY    FILE #442",4)

"BLD",4973,"KRN",.402,"NM","B","PRCH PURCHASE CARD AMEND    FILE #443.6",5)

"BLD",4973,"KRN",.402,"NM","B","PRCH2138    FILE #442",8)

"BLD",4973,"KRN",.402,"NM","B","PRCHLINE    FILE #443.6",6)

"BLD",4973,"KRN",.402,"NM","B","PRCHQ RFQ REQUEST    FILE #444",7)

"BLD",4973,"KRN",.403,0)
.403
"BLD",4973,"KRN",.5,0)
.5
"BLD",4973,"KRN",.84,0)
.84
"BLD",4973,"KRN",3.6,0)
3.6
"BLD",4973,"KRN",3.8,0)
3.8
"BLD",4973,"KRN",9.2,0)
9.2
"BLD",4973,"KRN",9.8,0)
9.8
"BLD",4973,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",4973,"KRN",9.8,"NM",1,0)
PRCHAAC4^^0^B963460
"BLD",4973,"KRN",9.8,"NM",2,0)
PRCHNPO1^^0^B54452339
"BLD",4973,"KRN",9.8,"NM",3,0)
PRCHFPDE^^0^B31116983
"BLD",4973,"KRN",9.8,"NM",4,0)
PRCHFPD2^^0^B14180601
"BLD",4973,"KRN",9.8,"NM",5,0)
PRCHAMYB^^0^B25029264
"BLD",4973,"KRN",9.8,"NM",6,0)
PRCHNPO7^^0^B63147574
"BLD",4973,"KRN",9.8,"NM",7,0)
PRCHMA^^0^B77180458
"BLD",4973,"KRN",9.8,"NM","B","PRCHAAC4",1)

"BLD",4973,"KRN",9.8,"NM","B","PRCHAMYB",5)

"BLD",4973,"KRN",9.8,"NM","B","PRCHFPD2",4)

"BLD",4973,"KRN",9.8,"NM","B","PRCHFPDE",3)

"BLD",4973,"KRN",9.8,"NM","B","PRCHMA",7)

"BLD",4973,"KRN",9.8,"NM","B","PRCHNPO1",2)

"BLD",4973,"KRN",9.8,"NM","B","PRCHNPO7",6)

"BLD",4973,"KRN",19,0)
19
"BLD",4973,"KRN",19.1,0)
19.1
"BLD",4973,"KRN",101,0)
101
"BLD",4973,"KRN",409.61,0)
409.61
"BLD",4973,"KRN",771,0)
771
"BLD",4973,"KRN",870,0)
870
"BLD",4973,"KRN",8989.51,0)
8989.51
"BLD",4973,"KRN",8989.52,0)
8989.52
"BLD",4973,"KRN",8994,0)
8994
"BLD",4973,"KRN","B",.4,.4)

"BLD",4973,"KRN","B",.401,.401)

"BLD",4973,"KRN","B",.402,.402)

"BLD",4973,"KRN","B",.403,.403)

"BLD",4973,"KRN","B",.5,.5)

"BLD",4973,"KRN","B",.84,.84)

"BLD",4973,"KRN","B",3.6,3.6)

"BLD",4973,"KRN","B",3.8,3.8)

"BLD",4973,"KRN","B",9.2,9.2)

"BLD",4973,"KRN","B",9.8,9.8)

"BLD",4973,"KRN","B",19,19)

"BLD",4973,"KRN","B",19.1,19.1)

"BLD",4973,"KRN","B",101,101)

"BLD",4973,"KRN","B",409.61,409.61)

"BLD",4973,"KRN","B",771,771)

"BLD",4973,"KRN","B",870,870)

"BLD",4973,"KRN","B",8989.51,8989.51)

"BLD",4973,"KRN","B",8989.52,8989.52)

"BLD",4973,"KRN","B",8994,8994)

"BLD",4973,"QUES",0)
^9.62^^
"BLD",4973,"REQB",0)
^9.611^^
"KRN",.402,2456,-1)
0^8
"KRN",.402,2456,0)
PRCH2138^3060705.0821^^442^^^3060705
"KRN",.402,2456,"DIAB",1,0,442,11)
VENDOR:
"KRN",.402,2456,"DIAB",1,1,442.01,22)
PURCHASE ORDER NUMBER:DELIVERY SCHEDULE (ORDER):
"KRN",.402,2456,"DIAB",1,1,442.12,0)
ALL
"KRN",.402,2456,"DIAB",2,0,442,4)
SUBSTATION;REQ
"KRN",.402,2456,"DIAB",7,1,442.01,9)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2456,"DR",1,442)
Q:'$D(PRC("SITE"));S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="";S PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19);S PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:"");S PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2456,"DR",1,442,1)
S PRCHNVF="",PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;D EN2^PRCHNPO6;
"KRN",.402,2456,"DR",1,442,2)
S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);S PRCHN("MP")=$S($D(^PRCD(442.5,+$P(^PRC(442,DA,0),U,2),0)):$P(^(0),U,3),1:"");S PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")'="":PRCHN("INV"),1:"FMS");
"KRN",.402,2456,"DR",1,442,3)
S PRCHCTPO=$S(PRCHN("MP")=2:"Y",1:"N");S X=$P($G(^PRC(442,DA,1)),U) I X>0,$P($G(^PRC(440,X,3)),U,2)="Y" S PRCHEDI="";I '$D(^PRC(411,"UP",PRC("SITE"))) S Y=.1;S OSUB=$P($G(^PRC(442,DA,23)),U,7);
"KRN",.402,2456,"DR",1,442,4)
I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($G(^(0)),U,10) I +X=OSUB W !,"SUBSTATION: ",$P(^PRC(411,$P(^PRC(442,DA,23),U,7),0),U) S Y=.1;31R~;
"KRN",.402,2456,"DR",1,442,5)
I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)),X'=OSUB W !,?5,"Sub-station cannot be changed because the attached 2237",!,?5,"would then have a different sub-station.",!;
"KRN",.402,2456,"DR",1,442,6)
S PRCX=$O(^PRC(411,X,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,X,1,PRCX,0)),U) K PRCX;Q;.1//TODAY;.02//^S X="INVOICE/RECEIVING REPORT";
"KRN",.402,2456,"DR",1,442,7)
S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")]"":PRCHN("INV"),1:"FMS");S:PRCHN("MP")'=25 Y=.08;D LOOK^PRCSPC;I (X="")!(X["^") S ERRFLG=38,Y=0;
"KRN",.402,2456,"DR",1,442,8)
I $G(PRCHXXX)="" S ERRFLG=38,Y=0;46////^S X=$G(PRCHXXX);56////^S X=DUZ;I PRCHXXX]"" S PRCPO=^PRC(440.5,PRCHXXX,0),PRCHHLDR=$P(PRCPO,U,8);61////^S X=PRCHHLDR;K PRCPO,PRCHHLDR,PRCHXXX;
"KRN",.402,2456,"DR",1,442,9)
.08//^S X=$S(PRCHN("MP")=2:"Y",PRCHN("MP")=12:"Y",1:"N");.04//^S X=PRCHN("INV");5;I $P(PRCHNVF,"^",3)=1 S Y="@20";S PRCHOV3=$G(^PRC(440,+^PRC(442,D0,1),3)) S:$P(PRCHOV3,"^",12)="P" Y="@20";S:$P(PRCHOV3,"^",6)="N" Y="@20";
"KRN",.402,2456,"DR",1,442,10)
S FLAG=0 I $P(PRCHOV3,"^",4)]""!(($P(PRCHOV3,"^",9)]"")&($P(PRCHOV3,"^",8)]"")) S FLAG=1;D EN9^PRCHNPO7;W:0 "The jump Y=@20 is set in routine EN9^PRCHNPO7";
"KRN",.402,2456,"DR",1,442,11)
^440^PRC(440,^^S I(0,0)=D0 S Y(1)=$S($D(^PRC(442,D0,1)):^(1),1:"") S X=$P(Y(1),U,1),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");@20;I '$D(PRCHEDI) S:$D(^PRC(442,DA,12)) $P(^(12),U,13,14)="^" S Y="@10";18.6//^S X="N";
"KRN",.402,2456,"DR",1,442,12)
I X'="Y" S:$D(^PRC(442,DA,12)) $P(^(12),U,14)="" S Y="@10";18.7;@10;8//^S X=PRCHN("SC");I "29"'[X K:0 DIC("DR") D ^PRCHNPO3 S Y="@1";.25;D ^PRCHNPO3;@1;
"KRN",.402,2456,"DR",1,442,13)
I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($P(^(0),U,1),"-",4) I +X=+$P(^PRC(442,DA,0),U,3) W !,"FCP: ",$P(^(0),U,3) S Y="@2";1;S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19);@2;
"KRN",.402,2456,"DR",1,442,14)
I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));26///^S X=PRC("BBFY");D EN2^PRCHNPO3;2//^S X=PRCHN("CC");@88;5.2//^S X=PRCHN("SVC");I $P(^PRC(442,DA,0),U,2)=25 S Y="@89";S Y="@90";@89;
"KRN",.402,2456,"DR",1,442,15)
54;@90;S:PRCHN("MP")=2 Y="@3" I $D(^PRC(442,DA,1)),$P(^(1),U,18)]"" S Y="@3";.3//^S X="E";@3;S:PRCHN("MP")=4 Y=5.3;
"KRN",.402,2456,"DR",1,442,16)
I '$P(^PRC(442,DA,0),U,19)&(PRCHN("MP")'=2) W !,"Enter the word 'PATIENT' in the 'DELIVERY LOCATION' field for a direct delivery",!,"to a patient.";5.6;
"KRN",.402,2456,"DR",1,442,17)
I X="PATIENT",$P(^PRC(442,DA,0),U,19) I $P(^(0),U,19)!(PRCHN("MP")=2) W *7,!,"  PATIENT DELIVERY not valid for this type of order!" S Y=5.6;I X="PATIENT" W "   Direct Delivery to Patient" S Y=5.3;5.4//^S X=$G(PRCY);
"KRN",.402,2456,"DR",1,442,18)
I $P(^PRC(442,DA,1),U,12)'="" W *7,!,"Delete the Direct Delivery patient name if you wish the 'Ship to' address",!,"to print on the P.O.",!;S:(PRCHN("MP")'=4)&($P(^(1),U,12)="") Y=6;5.3;K DIC("DR");6//NO;S:X'="Y" Y=6.4;6.2;
"KRN",.402,2456,"DR",1,442,19)
6.4//DESTINATION;S PRCHN("FOB")=X;Q;7//TODAY+10;8.2//^S X="N/A";8.3;13;S PRCHSHP=+X;S:X']"" Y="@99";I $P(^PRC(442,DA,0),U,19)'=2 S Y="@98";S PRCHSBOC=$P($G(^PRCD(420.2,2299,0)),U);13.05////^S X=PRCHSBOC;S Y="@100";@98;13.05;@100;
"KRN",.402,2456,"DR",1,442,20)
S:'$D(PRCHSHP) PRCHSHP=$P(^PRC(442,DA,0),U,13) I '(PRCHN("FOB")="O"&((PRCHSHP>250)!(PRCHSHP=0))) S Y="@99";13.2;13.4;13.3;@99;97//^S X="A";16//^S X=$S($D(PRCHDUZ):PRCHDUZ,1:"");
"KRN",.402,2456,"DR",1,442,21)
S PRCHDUZ1=X I $P(^PRC(442,DA,0),U,2)=25,'$D(^PRC(440.5,"H",X)) W *7,!,"This user is not a purchase card user." S Y=16;K PRCHDUZ,PRCHDUZ1;40;24;20;501//^S X=$G(PRCHCTPO);K PRCHANS,PRCHTPO,PRCHSEEN,PRCHMORE,PRCHQTY,PRCSAVE;
"KRN",.402,2456,"DR",2,440)
I FLAG S Y=17.3;38;I X]"" S Y=39;W !!,"This VENDOR needs a TAX IDENTIFICATION NUMBER or a SOCIAL SECURITY NUMBER.",!,"Please enter one if you have it or get one from the VENDOR.",!;39;I X]"" S Y=17.3;
"KRN",.402,2456,"DR",2,440,1)
W !!,"Please tell me whether the TAX ID/SSN field is a TAX NUMBER or a SSN NUMBER.",!;17.3;17.4;17.7;17.8;17.9;I $P(PRCHOV3,U,11)]"" S Y="@10";41;@10;I $P(PRCHOV3,U,14)]"" S Y="@11";44;@11;I $P(PRCHOV3,U,13)]"" S Y="";
"KRN",.402,2456,"DR",2,442.01)
S PRCHREC=DA,PRCHQUAN="",Z="",PRCHTOT=0;S PRCHINUM=DA;.01;K PRCSAVE;S PRCHOLD=$P($G(^PRC(442,PRCHIEN,2,PRCHINUM,0)),U,2);1.5;I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";
"KRN",.402,2456,"DR",2,442.01,1)
I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;1;
"KRN",.402,2456,"DR",2,442.01,2)
I '$D(^PRC(442,DA(1),2,DA,1)) W $C(7),!,"Description is Required!!" S Y=1;I $D(^PRC(442,DA(1),1)) S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),2,+^PRC(442,DA(1),1),0)):^(0),1:"");
"KRN",.402,2456,"DR",2,442.01,3)
I Z'="" W:$P(Z,U,12)'="" !,"    Minimum Order Qty.: ",$P(Z,U,12) W:$P(Z,U,9) !,"    Maximum Order Qty.: ",$P(Z,U,9) W:$P(Z,U,11) !,"    Required Order Multiple: ",$P(Z,U,11) S PRCHQUAN=Z K Z;
"KRN",.402,2456,"DR",2,442.01,4)
2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");I X<PRCHOLD N I F I=0:0 S I=$O(^PRC(442.8,"AC",PRCHPONO,PRCHINUM,I)) Q:'I  S PRCHTOT=PRCHTOT+$P($G(^PRC(442.8,I,0)),U,5);
"KRN",.402,2456,"DR",2,442.01,5)
I $G(PRCHTOT)>X W !!!!!,$C(7),"****Delivery schedule total for this item (",PRCHTOT,") EXCEEDS order quantity (",X,").",!,"Edit delivery schedule(s).",!! S PRCHFLG=1,PRCHQTY=X S Y="@16";@44;
"KRN",.402,2456,"DR",2,442.01,6)
I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than the Minimum Order Quantity of ",$P(PRCHQUAN,U,12),$C(7) S Y=2;
"KRN",.402,2456,"DR",2,442.01,7)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than the Maximum Order Quantity of ",$P(PRCHQUAN,U,9),$C(7) S Y=2;
"KRN",.402,2456,"DR",2,442.01,8)
I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value of ",$P(PRCHQUAN,U,11),$C(7) S Y=2;3;5;I $D(^PRC(442,DA(1),1)),$P(^(1),U,20)="Y" S Y="@6";D TSTREQ1^PRCHNPO9;3.1;9.4;S:X']"" Y=9;
"KRN",.402,2456,"DR",2,442.01,9)
S DIE("NO^")="A";9.7;K DIE("NO^");9;9.5;@6;8T~;I $G(PRCSAVE)'="^" D EN10^PRCHNPO7;
"KRN",.402,2456,"DR",2,442.01,10)
S PRCHFCP=+$P(^PRC(442,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:$E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)=11 Y=41 S:(PRCHN("COM")'=1)&($E($P($G(^(0)),U,18),1,2)'=11) Y=4;S:PRCHN("MP")=2 Y=4;
"KRN",.402,2456,"DR",2,442.01,11)
9.3;D TSTREQ2^PRCHNPO9;40;S Y=4;41//^S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),3)):^(3),1:""),X=$P(Z,U,7);42;4;I PRCHN("SFC")=2 S $P(^PRC(442,DA(1),2,DA,0),U,4)=$$SUPBOC^PRCHNPO7(-1) S Y="@87";
"KRN",.402,2456,"DR",2,442.01,12)
3.5//^S X=$$SUPBOC^PRCHNPO7(-1);@87;S:'$D(PRCHEDI) Y="@5";36.3;36.6;@5;S PRCHTOT=0,PRCHSCN="" F I=0:0 S PRCHSCN=$O(^PRC(442.8,"B",PRCHPONO,PRCHSCN)) Q:PRCHSCN=""  I $P(^PRC(442.8,PRCHSCN,0),U,2)=DA S PRCHTOT=PRCHTOT+$P(^(0),U,5);
"KRN",.402,2456,"DR",2,442.01,13)
S PRCHQTY=$P(^PRC(442,DA(1),2,DA,0),U,2);I PRCHTOT>PRCHQTY S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(442,DA(1),2,PRCHREC,0),U) W !,"Line Item # = ",PRCHLINO,!,"Quantity Ordered: "_$P(^PRC(442,DA(1),2,PRCHREC,0),U,2),! S Y="@555";
"KRN",.402,2456,"DR",2,442.01,14)
W !!,"Enter/Edit Delivery Schedule for this Item?  NO// " R X:DTIME S:'$T X="^" S:X="" X="N" S:X["?" Y="@5" S:"Yy?"'[$E(X) Y="@56" W "  "_$S("Yy"[$E(X):"(YES)","Nn"[$E(X):"(NO)",1:"");@16;
"KRN",.402,2456,"DR",2,442.01,15)
S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(442,DA(1),2,PRCHREC,0),U) W !,"Line Item #=",PRCHLINO,!,"Quantity Ordered: "_$P(^PRC(442,DA(1),2,PRCHREC,0),U,2),!;
"KRN",.402,2456,"DR",2,442.01,16)
I PRCHTOT=PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," equals order quantity of ",PRCHQTY,".",!,"You may edit delivery schedule(s), but cannot add a new schedule.",!;@555;
"KRN",.402,2456,"DR",2,442.01,17)
I PRCHTOT>PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," EXCEEDS order quantity of ",PRCHQTY,".  You must edit",!,"one or more schedules so that the total equals no more than ",PRCHQTY,".",!! S Y="@55";
"KRN",.402,2456,"DR",2,442.01,18)
S:$D(PRCHSEEN) Y="@55";S PRCHSEEN=1 W !!,"To delete a schedule, zero out the quantity to be delivered. To add a new",!,"delivery schedule do the following:",!!;
"KRN",.402,2456,"DR",2,442.01,19)
W "a. If there is no delivery schedule already in file answer 'Yes' when asked if     you are adding a new delivery schedule.";
"KRN",.402,2456,"DR",2,442.01,20)
W !,"b. If there is only one delivery schedule already in the file you will see         'OK? YES//' answer 'No' and then answer 'Yes' when asked if you are adding a    new delivery schedule.";
"KRN",.402,2456,"DR",2,442.01,21)
W !,"c. If there is more than one delivery schedule in the file, hit <return> key at    'CHOOSE' prompt and answer 'Yes' when asked if you are adding a new delivery    schedule.",!!;@55;
"KRN",.402,2456,"DR",2,442.01,22)
^442.8^PRC(442.8,^^X DR(99,1,9.2) S Y(101)=$S($D(^PRC(442.8,D0,0)):^(0),1:"") S X=$P(Y(101),U,1),Y(102)=$G(X) S X=$P(Y(101),U,1) S D0=I(0,0) S D1=I(1,0) S X=$S(D(0)>0:D(0),1:"");
"KRN",.402,2456,"DR",2,442.01,23)
S:$G(PRCHDA) PRCHINUM=PRCHDA S PRCHQTY=$P(^PRC(442,PRCHIEN,2,PRCHINUM,0),U,2);
"KRN",.402,2456,"DR",2,442.01,24)
I $G(PRCHFLG),PRCHTOT>PRCHQTY W !!,"Delivery schedule total of ",PRCHTOT," EXCEEDS ordered quantity.",!,"of ",PRCHQTY,".  Adjust delivery schedule(s).",!! S Y="@16";
"KRN",.402,2456,"DR",2,442.01,25)
I $G(PRCHFLG) S PRCHFLG=0 W !!!!,"****Returning to Item Multiple edit session.",!! S Y="@44";I PRCHTOT>PRCHQTY S Y="@555";
"KRN",.402,2456,"DR",2,442.01,26)
W !!,"Enter/Edit Another Delivery Schedule for this Item? NO// " R X:DTIME S:'$T X="^" S:X="" X="N" S:X["?" Y="@5" S:"Yy?"[$E(X) Y="@16";@56;K DIE("NO^"),PRCHTOT,PRCHSCN,PRCHSEEN;
"KRN",.402,2456,"DR",2,442.12)
.01
"KRN",.402,2456,"DR",2,442.15)
.01;
"KRN",.402,2456,"DR",3,442.8)
1///^S X=PRCHDA;S DIE("NO^")="";2;3;@6;4;K DIE("NO^");S PRCHTOT=0,PRCHSCN="" F I=0:0 S PRCHSCN=$O(^PRC(442.8,"B",PRCHPONO,PRCHSCN)) Q:PRCHSCN=""  I $P(^PRC(442.8,PRCHSCN,0),U,2)=PRCHDA S PRCHTOT=PRCHTOT+$P(^(0),U,5);
"KRN",.402,2456,"DR",3,442.8,1)
S PRCHQTY=$P(^PRC(442,PRCHIEN,2,PRCHDA,0),U,2);S PRCHMORE=$P(^PRC(442.8,DA,0),U,5),PRCHMOR2=(PRCHQTY-PRCHTOT+PRCHMORE);
"KRN",.402,2456,"DR",3,442.8,2)
I PRCHTOT>PRCHQTY I PRCHMORE'=0 W *7,!,"Del. sched. total of ",PRCHTOT," for item ",PRCHDA," EXCEEDS the purchase",!,"order quantity of ",PRCHQTY,".",!,"Max. quantity here is ",$S(PRCHMOR2>0:PRCHMOR2,1:0),".",!! S Y="@6";
"KRN",.402,2456,"DR",3,442.8,3)
I PRCHTOT<PRCHQTY W !,"Delivery schedule total of ",PRCHTOT," for item ",PRCHDA," is less than purchase",!,"order quantity.",!!;I X>0 S Y="@445";W *7,!,"Delivery Schedule DELETED",!;.01////@;@445;
"KRN",.402,2456,"DR",99,1,9.2)
S I(1,0)=$G(D1),I(0,0)=$G(D0),Y(1)=$S($D(^PRC(442,D0,0)):^(0),1:"") S X=$P(Y(1),U,1) K DIC S DIC="^PRC(442.8,",DIC(0)="MFLE" D ^DIC S (D,D0,D(0))=+Y
"KRN",.402,2647,-1)
0^6
"KRN",.402,2647,0)
PRCHLINE^3060630.1115^^443.6^^^3060705
"KRN",.402,2647,"DIAB",1,1,443.61,24)
PURCHASE ORDER NUMBER:AMENDMENTS TO DELIVERY SCHEDULES:
"KRN",.402,2647,"DIAB",14,1,443.61,9)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2647,"DR",1,443.6)
S PRCHPONO=$P(^PRC(443.6,PRCHPO,0),U);40///^S X=PRCHI1;K DIE("NO^"),PRCHSEEN,PRCHMORE,PRCHQTY,PRCHTOT,PRCHSCN,PRCHDSCH,PRCHDSFL,PRCHANS,PRCSAVE;
"KRN",.402,2647,"DR",2,443.61)
S (D0,PRCHIEN)=DA(1),PRCHINUM=DA,PRCHREC=DA;K PRCSAVE;1.5;I X=""&($L($P($G(^PRC(443.6,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";I X=""&($L($P($G(^PRC(443.6,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";
"KRN",.402,2647,"DR",2,443.61,1)
I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;1;I '$D(^PRC(443.6,DA(1),2,DA,1)) W $C(7),?3,!,"Description is Required!!" S Y=1;
"KRN",.402,2647,"DR",2,443.61,2)
S PRCHOLD=$P($G(^PRC(443.6,PRCHIEN,2,PRCHINUM,0)),U,2);S (PRCHQUAN,PRCHZ)="" I $D(^PRC(443.6,DA(1),1)) S PRCHZ=$S($D(^PRC(441,+$P(^PRC(443.6,DA(1),2,DA,0),U,5),2,+^PRC(443.6,DA(1),1),0)):^(0),1:"");
"KRN",.402,2647,"DR",2,443.61,3)
I PRCHZ'="" W:$P(PRCHZ,U,12)'="" !,*7,"    Minimum Order Qty.: ",$P(PRCHZ,U,12) W:$P(PRCHZ,U,9) !,*7,"    Maximum Order Qty.: ",$P(PRCHZ,U,9) W:$P(PRCHZ,U,11) !,*7,"    Required Order Multiple: ",$P(PRCHZ,U,11) S PRCHQUAN=PRCHZ;
"KRN",.402,2647,"DR",2,443.61,4)
S PRCHQPR=$P($G(^PRC(443.6,DA(1),2,DA,2)),U,8);@2;2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");S PRCHQTY=X,PRCHDSFL=0;
"KRN",.402,2647,"DR",2,443.61,5)
I PRCHQTY<$G(PRCHOLD) N I F I=0:0 S I=$O(^PRC(441.7,"AG",PRCHPONO,PRCHINUM,I)) Q:'I  S PRCHTOT=$G(PRCHTOT)+$P($G(^PRC(441.7,I,0)),U,5) I 'PRCHDSFL S PRCHDSFL=1;
"KRN",.402,2647,"DR",2,443.61,6)
I $G(PRCHTOT)>PRCHQTY,PRCHDSFL W !!!,$C(7),"****Delivery Schedule total for this item (",PRCHTOT,") EXCEEDS order quantity (",PRCHQTY,").",!,"Edit delivery schedule(s) now.",! S PRCHFLG=1 S Y="@16";@44;S DA=PRCHINUM;
"KRN",.402,2647,"DR",2,443.61,7)
I PRCHQPR>0 I X<PRCHQPR W !,"QUANTITY is less than Quantity Previously Received.",$C(7) S Y="@2";I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than Minimum Order Quantity.",$C(7) S Y="@2";
"KRN",.402,2647,"DR",2,443.61,8)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than Maximum Order Quantity.",$C(7) S Y="@2";I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value.",$C(7) S Y="@2";
"KRN",.402,2647,"DR",2,443.61,9)
3;5;I $D(^PRC(443.6,DA(1),1)),$P(^(1),U,20)="Y" S Y="@66";3.1;9.4;S:X']"" Y=9;S DIE("NO^")="A";9.7;K DIE("NO^");9;9.5;@66;S PRCHN("MP")=$S($D(^PRCD(442.5,+$P(^PRC(443.6,DA(1),0),U,2),0)):$P(^(0),U,3),1:"");8T~;
"KRN",.402,2647,"DR",2,443.61,10)
I $G(PRCSAVE)'="^" D EN100^PRCHNPO7;
"KRN",.402,2647,"DR",2,443.61,11)
S PRCHFCP=+$P(^PRC(443.6,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:$E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)=11 Y=41 S:(PRCHN("COM")'=1)&($E($P($G(^(0)),U,18),1,2)'=11) Y=4;
"KRN",.402,2647,"DR",2,443.61,12)
S:PRCHN("MP")=2 Y=4;9.3;40//^S X="D";S Y="@4";41//^S Z=$S($D(^PRC(441,+$P(^PRC(443.6,DA(1),2,DA,0),U,5),3)):^(3),1:""),X=$P(Z,U,7);42;@4;4;S PRCHN("SFC")=+$P(^PRC(443.6,DA(1),0),U,19);
"KRN",.402,2647,"DR",2,443.61,13)
I PRCHN("SFC")=2 S $P(^PRC(443.6,DA(1),2,DA,0),U,4)=$$SUPBOC^PRCHMA0(-1) S Y="@87";3.5//^S X=$$SUPBOC^PRCHMA0(-1);@87;S:$G(PRCHEDI)']"" Y="@5";36.3;36.6;@5;
"KRN",.402,2647,"DR",2,443.61,14)
S PRCHTOT=0,PRCHSCN="" F I=0:0 S PRCHSCN=$O(^PRC(441.7,"B",PRCHPONO,PRCHSCN)) Q:PRCHSCN=""  I $P(^PRC(441.7,PRCHSCN,0),U,2)=PRCHINUM S PRCHTOT=PRCHTOT+$P(^(0),U,5);S PRCHQTY=$P(^PRC(443.6,PRCHIEN,2,PRCHINUM,0),U,2);
"KRN",.402,2647,"DR",2,443.61,15)
I PRCHTOT>PRCHQTY S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(443.6,PRCHIEN,2,PRCHINUM,0),U) W !,"Line Item # = ",PRCHLINO,!,"Quantity Ordered: ",$P(^PRC(443.6,PRCHIEN,2,PRCHINUM,0),U,2),! S Y="@555";
"KRN",.402,2647,"DR",2,443.61,16)
W !!,"Enter/Edit Delivery Schedule for this Item?  NO// " R XX:DTIME S:'$T XX="^" S:XX="" XX="N" S:XX["?" Y="@5" S:"Yy?"'[$E(XX) Y="" W "  "_$S("Yy"[$E(XX):"(YES)","Nn"[$E(XX):"(NO)",1:"");@16;
"KRN",.402,2647,"DR",2,443.61,17)
S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(443.6,PRCHIEN,2,PRCHINUM,0),U) W !,"Line Item # = ",PRCHLINO,!,"Quantity Ordered: ",$P(^PRC(443.6,PRCHIEN,2,PRCHINUM,0),U,2),!;
"KRN",.402,2647,"DR",2,443.61,18)
I PRCHTOT=PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," equals order quantity of ",PRCHQTY,".",!,"You may edit delivery schedule(s), but cannot add a new schedule.",!!;@555;
"KRN",.402,2647,"DR",2,443.61,19)
I PRCHTOT>PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," EXCEEDS order quantity of ",PRCHQTY,". You must edit",!,"one or more schedules so that the total equals no more than ",PRCHQTY,".",!! S Y="@55";
"KRN",.402,2647,"DR",2,443.61,20)
S:$D(PRCHSEEN) Y="@55";S PRCHSEEN=1 W !!,"To delete a schedule, zero out the quantity to be delivered. To add a new",!,"delivery schedule do the following:",!!;
"KRN",.402,2647,"DR",2,443.61,21)
W "a. If there is no delivery schedule already in file answer 'Yes' when asked if     you are adding a new delivery schedule.";
"KRN",.402,2647,"DR",2,443.61,22)
W !,"b. If there is only one delivery schedule already in the file you will see         'OK? YES//' answer 'No' and then answer 'Yes' when asked if you are adding a    new delivery schedule.";
"KRN",.402,2647,"DR",2,443.61,23)
W !,"c. If there is more than one delivery schedule in the file, hit <return> key at    'CHOOSE' prompt and answer 'Yes' when asked if you are adding a new delivery    schedule.",!!;@55;
"KRN",.402,2647,"DR",2,443.61,24)
^441.7^PRC(441.7,^^X DR(99,1,9.2) S Y(101)=$S($D(^PRC(441.7,D0,0)):^(0),1:"") S X=$P(Y(101),U,1) S D0=I(0,0) S D1=I(1,0) S X=$S(D(0)>0:D(0),1:"");S PRCHNORE=1;S (DA,D1)=PRCHDA,(D0,DA(1))=PRCHDA1;
"KRN",.402,2647,"DR",2,443.61,25)
S PRCHQTY=$P(^PRC(443.6,PRCHIEN,2,PRCHINUM,0),U,2);I $G(PRCHTOT)>$G(PRCHQTY) W !!,"Delivery schedule total of ",PRCHTOT," EXCEEDS ordered quantity",!,"of ",PRCHQTY,".  Adjust delivery schedule(s).",! S Y="@16";
"KRN",.402,2647,"DR",2,443.61,26)
I $G(PRCHFLG)=1 W !!!,"****Returning to Item Multiple session.",!! S Y="@44" S PRCHFLG=0;W !!,"Enter/Edit Another Delivery Schedule for this Item? NO// " R X:DTIME S:'$T S="^" S:X="" X="N" S:X["?" Y="@5" S:"Yy?"[$E(X) Y="@16";
"KRN",.402,2647,"DR",3,441.7)
S PRCHAA=$P($G(^PRC(441.7,D0,0)),U),PRCHAB=+$P($G(^PRC(441.7,D0,0)),U,7),PRCHYY=D0_"^"_PRCHAA_"^"_$S(PRCHAB=0:1,1:"");1///^S X=PRCHDA;S DIE("NO^")="";2;3;@6;4;K DIE("NO^");
"KRN",.402,2647,"DR",3,441.7,1)
S PRCHTOT=0,PRCHSCN="" F I=0:0 S PRCHSCN=$O(^PRC(441.7,"B",PRCHPONO,PRCHSCN)) Q:PRCHSCN=""  I $P(^PRC(441.7,PRCHSCN,0),U,2)=PRCHINUM S PRCHTOT=PRCHTOT+$P(^PRC(441.7,PRCHSCN,0),U,5);
"KRN",.402,2647,"DR",3,441.7,2)
S PRCHQTY=$P(^PRC(443.6,PRCHIEN,2,PRCHINUM,0),U,2);S PRCHMORE=$P(^PRC(441.7,DA,0),U,5) S PRCHMOR2=(PRCHQTY-PRCHTOT+PRCHMORE);S PRCHDSCH=DA;
"KRN",.402,2647,"DR",3,441.7,3)
I PRCHTOT>PRCHQTY I PRCHMORE'=0 W *7,!,"Delivery sched. total of ",PRCHTOT," for item ",PRCHINUM," EXCEEDS the purchase",!,"order quantity of ",PRCHQTY,".",!,"Max. quantity here is ",($S(PRCHMOR2>0:PRCHMOR2,1:0)),".",!! S Y="@6";
"KRN",.402,2647,"DR",3,441.7,4)
I PRCHTOT<PRCHQTY,PRCHTOT>0 W !!,"Delivery schedule total of ",PRCHTOT," for item ",PRCHINUM," is less than the purchase",!,"order quantity.",!!;S DA(1)=PRCHDA1 S:X>0 Y="@17",$P(^PRC(441.7,PRCHDSCH,0),U,6)="";
"KRN",.402,2647,"DR",3,441.7,5)
I $P($G(^PRC(441.7,PRCHDSCH,0)),U,7)]"" S Y="@117";W *7,!!,"Delivery Schedule DELETED!",!!;K PRCHNORE;.01////@;S Y="@17";@117;5////^S X="D";W *7,!!,"Delivery Schedule DELETED at the time of the obligation of this P.0.",!!;@17;
"KRN",.402,2647,"DR",99,1)
X DR(99,1,9.2) S Y(101)=$S($D(^PRC(441.7,D0,0)):^(0),1:"") S X=$P(Y(101),U,1) S D0=I(0,0) S D1=I(1,0)
"KRN",.402,2647,"DR",99,1,9.2)
S I(1,0)=$G(D1),I(0,0)=$G(D0),Y(1)=$S($D(^PRC(443.6,D0,0)):^(0),1:"") S X=$P(Y(1),U,1) K DIC S DIC="^PRC(441.7,",DIC(0)="MF" D ^DIC S (D,D0,D(0))=+Y
"KRN",.402,2663,-1)
0^3
"KRN",.402,2663,0)
PRCH DETAILED PURCHASE CARD^3060509.1504^^442^^^3060530
"KRN",.402,2663,"DIAB",1,0,442,6)
P.O. DATE//TODAY
"KRN",.402,2663,"DIAB",3,0,442,7)
PCDO VENDOR;REQ
"KRN",.402,2663,"DIAB",6,0,442,10)
DELIVERY DATE//TODAY+10
"KRN",.402,2663,"DIAB",7,0,442,2)
SUBSTATION;REQ
"KRN",.402,2663,"DIAB",10,1,442.01,8)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2663,"DR",1,442)
Q:'$D(PRC("SITE"))  S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="",PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19),PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:""),PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2663,"DR",1,442,1)
S PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;D EN2^PRCHNPO6;S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);
"KRN",.402,2663,"DR",1,442,2)
16////^S X=DUZ;56////^S X=DUZ;.02///^S X=25;48///^S X="P";63///^S X=1;I '$D(^PRC(411,"UP",PRC("SITE"))) S Y="@46";31R~;S SUB=X;I $D(SUB) S PRCX=$O(^PRC(411,SUB,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,SUB,1,PRCX,0)),U) K PRCX;@46;
"KRN",.402,2663,"DR",1,442,3)
S PRCHCDNO=$P($G(^PRC(442,DA,23)),U,8);S PRCHNN=0 F PRCHII=1:1 S PRCHNN=$O(^PRC(440.5,"C",DUZ,PRCHNN)) Q:'PRCHNN  S PRCHCDF=$P(^PRC(440.5,PRCHNN,0),U);S PRCHCDFT="" I PRCHII=2 S PRCHCDFT=PRCHCDF;D LOOK^PRCSPC;
"KRN",.402,2663,"DR",1,442,4)
I (X="")!(X["^") S ERRFLG=2,Y=0;I $G(PRCHXXX)="" S ERRFLG=2,Y=0;46////^S X=$G(PRCHXXX);I PRCHCDNO'="",X'=PRCHCDNO W !,?5,"Please verify the accounting information for the new Purchase Card.",!;
"KRN",.402,2663,"DR",1,442,5)
I X]"" S PRCHP0=^PRC(440.5,X,0),PRCHFCP=$P(PRCHP0,U,2),PRCHCC=$P(PRCHP0,U,3),PRCHBOC1=$P(PRCHP0,U,4),PRCHDLOC=$P(PRCHP0,U,7),PRCHCD=$P(PRCHP0,U),PRCHCDNO=+X,PRCHHLDR=$P(PRCHP0,U,8);61////^S X=PRCHHLDR;55///^S X=PRCHCD;Q;
"KRN",.402,2663,"DR",1,442,6)
.1//^S X=DT;I +X<DT W $C(7),!!,"Enter TODAY or a future date only. Contact Fiscal or A&MM Service for ",!,"assistance with PO requiring prior date since an ET is required.",! S $P(^PRC(442,DA,1),U,15)="",Y=.1;
"KRN",.402,2663,"DR",1,442,7)
S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("INV")]"":PRCHN("INV"),1:"FMS");.08//^S X="N";53R~;I $G(PRCFLAG)=1 S $P(^PRC(442,DA,23),U,14)="" K X S Y=53;S PRCHVEN=+X;5////^S X=PRCHVEN;8//^S X="B";
"KRN",.402,2663,"DR",1,442,8)
S PRCHN("MP")=$P(^PRC(442,DA,0),U,2);1//^S X=PRCHFCP;S PRC("CP")=X;S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19);@2;I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));26///^S X=PRC("BBFY");
"KRN",.402,2663,"DR",1,442,9)
D EN2^PRCHNPO3;2//^S X=PRCHCC;5.2;52;@88;54;I X["N" S Y=6.4;5.6//^S X=PRCHDLOC;I X="PATIENT",$P(^PRC(442,DA,0),U,19) I $P(^(0),U,19)!(PRCHN("MP")=2) W *7,!,"  PATIENT DELIVERY not valid for this type of order!" S Y=5.6;
"KRN",.402,2663,"DR",1,442,10)
5.4//^S X=$G(PRCY);K DIC("DR");6.4//DESTINATION;S PRCHN("FOB")=X;Q;7//^S X=DT S X=X,X1=X,X2=+10,X="" D C^%DTC:X1;8.2//^S X="N/A";13;S PRCHSHP=+X;S:X']"" Y="@99";I $P(^PRC(442,DA,0),U,19)'=2 S Y="@98";
"KRN",.402,2663,"DR",1,442,11)
S PRCHSBOC=$P($G(^PRCD(420.2,2299,0)),U);13.05////^S X=PRCHSBOC;S Y="@100";@98;13.05;@100;I '(PRCHN("FOB")="O"&((PRCHSHP>250)!(PRCHSHP=0))) S Y="@99";13.2;13.4;13.3;@99;K PRCHDUZ;40;20;
"KRN",.402,2663,"DR",2,442.01)
S PRCHREC=DA;.01;K PRCSAVE;S PRCHINUM=DA,PRCHOLD=$P($G(^PRC(442,PRCHIEN,2,PRCHINUM,0)),U,2);1.5;I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";
"KRN",.402,2663,"DR",2,442.01,1)
I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;
"KRN",.402,2663,"DR",2,442.01,2)
I X'="",$G(PRCHN("SFC"))'=2 S PRCHMAND=$P($G(^PRC(441,X,0)),U,8) I $G(PRCHMAND),PRCHMAND'=$P($G(^PRC(442,DA(1),1)),U) W !,"This item can only be purchased from "_$P($G(^PRC(440,PRCHMAND,0)),U) S Y=1.5;1;
"KRN",.402,2663,"DR",2,442.01,3)
I '$D(^PRC(442,DA(1),2,DA,1)) W $C(7),!,"Description is Required!!" S Y=1;S (PRCHQUAN,Z)="" I $D(^PRC(442,DA(1),1)) S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),2,+^PRC(442,DA(1),1),0)):^(0),1:"");
"KRN",.402,2663,"DR",2,442.01,4)
I Z'="" W:$P(Z,U,12)'="" !,"    Minimum Order Qty.: ",$P(Z,U,12) W:$P(Z,U,9) !,"    Maximum Order Qty.: ",$P(Z,U,9) W:$P(Z,U,11) !,"    Required Order Multiple: ",$P(Z,U,11) S PRCHQUAN=Z K Z;
"KRN",.402,2663,"DR",2,442.01,5)
2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");
"KRN",.402,2663,"DR",2,442.01,6)
I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than the Minimum Order Quantity of ",$P(PRCHQUAN,U,12),$C(7) S Y=2;
"KRN",.402,2663,"DR",2,442.01,7)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than the Maximum Order Quantity of ",$P(PRCHQUAN,U,9),$C(7) S Y=2;
"KRN",.402,2663,"DR",2,442.01,8)
I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value of ",$P(PRCHQUAN,U,11),$C(7) S Y=2;3;5;D TSTREQ1^PRCHNPO9;3.1;S DIE("NO^")="A";9.7;K DIE("NO^");9;8T~;
"KRN",.402,2663,"DR",2,442.01,9)
I $G(PRCSAVE)'="^" D EN10^PRCHNPO7;S PRCHFCP=+$P(^PRC(442,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:(PRCHN("COM")'=1)&($E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)'=11) Y=4;4;
"KRN",.402,2663,"DR",2,442.01,10)
S PRCHIDA=+$P(^PRC(442,DA(1),2,DA,0),U,5);K PRCHBOCC;I PRCHN("SFC")=2 S ACCT=$$ACCT^PRCPUX1($E($$NSN^PRCPUX1(PRCHIDA),1,4)) S PRCHBOCC=$S(ACCT=1:2697,ACCT=2:2698,ACCT=3:2699,ACCT=6:2699,ACCT=8:2696,1:2699);
"KRN",.402,2663,"DR",2,442.01,11)
I '$G(PRCHBOCC) S Y="@87";S PRCHBOCC=$P($G(^PRCD(420.2,PRCHBOCC,0)),U);3.5////^S X=PRCHBOCC;S Y="@89";@87;3.5;@89;K PRCHBOCC,PRCHANS,PRCSAVE;
"KRN",.402,2664,-1)
0^1
"KRN",.402,2664,0)
PRCH DELIVERY ORDER^3060512.1103^^442^^^3060705
"KRN",.402,2664,"DIAB",3,0,442,6)
PCDO VENDOR;REQ
"KRN",.402,2664,"DIAB",4,0,442,3)
SUBSTATION;REQ
"KRN",.402,2664,"DIAB",4,0,442,4)
P.O. DATE//TODAY
"KRN",.402,2664,"DIAB",5,0,442,10)
DELIVERY DATE//TODAY+10
"KRN",.402,2664,"DIAB",8,1,442.01,10)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2664,"DR",1,442)
Q:'$D(PRC("SITE"))  S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="",PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19),PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:""),PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2664,"DR",1,442,1)
S PRCHNVF="",PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;D EN2^PRCHNPO6;
"KRN",.402,2664,"DR",1,442,2)
S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);S PRCHN("MP")=$S($D(^PRCD(442.5,+$P(^PRC(442,DA,0),U,2),0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")'="":PRCHN("INV"),1:"FMS");48///^S X="D";
"KRN",.402,2664,"DR",1,442,3)
I '$D(^PRC(411,"UP",PRC("SITE"))) S Y=.1;S OSUB=$P($G(^PRC(442,DA,23)),U,7);I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($G(^(0)),U,10) I +X=OSUB W !,"SUBSTATION: ",$P(^PRC(411,$P(^PRC(442,DA,23),U,7),0),U) S Y=.1;31R~;
"KRN",.402,2664,"DR",1,442,4)
S SUB=X;I $D(SUB) S PRCX=$O(^PRC(411,SUB,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,SUB,1,PRCX,0)),U) K PRCX;Q;.1//^S X=DT;.02//^S X="INVOICE/RECEIVING REPORT";
"KRN",.402,2664,"DR",1,442,5)
S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("MP")=2:"FISCAL",PRCHN("MP")=12:"",PRCHN("INV")]"":PRCHN("INV"),1:"FMS");S PRCHCTPO=$S(PRCHN("MP")=2:"Y",1:"N");
"KRN",.402,2664,"DR",1,442,6)
.08//^S X=$S(PRCHN("MP")=2:"Y",PRCHN("MP")=12:"Y",1:"N");.04//^S X=PRCHN("INV");53R~;S PRCHVEN=+X;5////^S X=PRCHVEN;8///^S X=6;K DIC("DR");@1;1;S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19);@2;
"KRN",.402,2664,"DR",1,442,7)
I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));26///^S X=PRC("BBFY");D EN2^PRCHNPO3;2//^S X=PRCHN("CC");@88;S:PRCHN("MP")=2 Y="@3" I $D(^PRC(442,DA,1)),$P(^(1),U,18)]"" S Y="@3";@3;
"KRN",.402,2664,"DR",1,442,8)
S:PRCHN("MP")=4 Y=5.3;I '$P(^PRC(442,DA,0),U,19)&(PRCHN("MP")'=2) W !,"Enter the word 'PATIENT' in the 'DELIVERY LOCATION' field for a direct delivery",!,"to a patient.";5.6;
"KRN",.402,2664,"DR",1,442,9)
I X="PATIENT",$P(^PRC(442,DA,0),U,19) I $P(^(0),U,19)!(PRCHN("MP")=2) W *7,!,"  PATIENT DELIVERY not valid for this type of order!" S Y=5.6;5.4//^S X=$G(PRCY);
"KRN",.402,2664,"DR",1,442,10)
I $P(^PRC(442,DA,1),U,12)'="" W *7,!,"Delete the Direct Delivery patient name if you wish the 'Ship to' address",!,"to print on the P.O.",!;6.4//DESTINATION;S PRCHN("FOB")=X;Q;7//^S X=DT S X=X,X1=X,X2=+10,X="" D C^%DTC:X1;
"KRN",.402,2664,"DR",1,442,11)
8.2//^S X="N/A";13;S PRCHSHP=+X;S:X']"" Y="@99";I $P(^PRC(442,DA,0),U,19)'=2 S Y="@98";S PRCHSBOC=$P($G(^PRCD(420.2,2299,0)),U);13.05////^S X=PRCHSBOC;S Y="@100";@98;13.05;@100;
"KRN",.402,2664,"DR",1,442,12)
I '(PRCHN("FOB")="O"&((PRCHSHP>250)!(PRCHSHP=0))) S Y="@99";13.2;13.4;13.3;@99;16////^S X=DUZ;K PRCHDUZ;40;20;
"KRN",.402,2664,"DR",2,442.01)
S PRCHREC=DA;.01;K PRCSAVE;S PRCHINUM=DA,PRCHOLD=$P($G(^PRC(442,PRCHIEN,2,PRCHINUM,0)),U,2);1.5;I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";
"KRN",.402,2664,"DR",2,442.01,1)
I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;
"KRN",.402,2664,"DR",2,442.01,2)
I X'="",$P($G(^PRC(441,X,2,PRCHVEN,0)),U,3)="",$G(PRCSAVE)="" W !,"This is not a contract item." S Y=1.5;
"KRN",.402,2664,"DR",2,442.01,3)
I X'="" S PRCHMAND=$P($G(^PRC(441,X,0)),U,8) I $G(PRCHMAND),PRCHMAND'=$P($G(^PRC(442,DA(1),1)),U) W !,"This item can only be purchased from "_$P($G(^PRC(440,PRCHMAND,0)),U) S Y=1.5;1;
"KRN",.402,2664,"DR",2,442.01,4)
I '$D(^PRC(442,DA(1),2,DA,1)) W $C(7),!,"Description is Required!!" S Y=1;S (PRCHQUAN,Z)="" I $D(^PRC(442,DA(1),1)) S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),2,+^PRC(442,DA(1),1),0)):^(0),1:"");
"KRN",.402,2664,"DR",2,442.01,5)
I Z'="" W:$P(Z,U,12)'="" !,"    Minimum Order Qty.: ",$P(Z,U,12) W:$P(Z,U,9) !,"    Maximum Order Qty.: ",$P(Z,U,9) W:$P(Z,U,11) !,"    Required Order Multiple: ",$P(Z,U,11) S PRCHQUAN=Z K Z;
"KRN",.402,2664,"DR",2,442.01,6)
2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");S PRCHTOT=0 I X<PRCHOLD N I F I=0:0 S I=$O(^PRC(442.8,"AC",PRCHPONO,PRCHINUM,I)) Q:'I  S PRCHTOT=PRCHTOT+$P($G(^PRC(442.8,I,0)),U,5);
"KRN",.402,2664,"DR",2,442.01,7)
I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than the Minimum Order Quantity of ",$P(PRCHQUAN,U,12),$C(7) S Y=2;
"KRN",.402,2664,"DR",2,442.01,8)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than the Maximum Order Quantity of ",$P(PRCHQUAN,U,9),$C(7) S Y=2;
"KRN",.402,2664,"DR",2,442.01,9)
I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value of ",$P(PRCHQUAN,U,11),$C(7) S Y=2;3;5;I $D(^PRC(442,DA(1),1)),$P(^(1),U,20)="Y" S Y="@6";D TSTREQ1^PRCHNPO9;3.1;
"KRN",.402,2664,"DR",2,442.01,10)
S DIE("NO^")="A";9.7;K DIE("NO^");9;9.5;@6;S:PRCHN("MP")=2 Y=4;8T~;I $G(PRCSAVE)'="^" D EN10^PRCHNPO7;
"KRN",.402,2664,"DR",2,442.01,11)
S PRCHFCP=+$P(^PRC(442,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:$E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)=11 Y=41 S:(PRCHN("COM")'=1)&($E($P($G(^(0)),U,18),1,2)'=11) Y=4;9.3;
"KRN",.402,2664,"DR",2,442.01,12)
D TSTREQ2^PRCHNPO9;40;S Y=4;41//^S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),3)):^(3),1:""),X=$P(Z,U,7);4;S PRCHIDA=+$P(^PRC(442,DA(1),2,DA,0),U,5);K PRCHBOCC;
"KRN",.402,2664,"DR",2,442.01,13)
S:PRCHN("SFC")=2 ACCT=$$ACCT^PRCPUX1($E($$NSN^PRCPUX1(PRCHIDA),1,4)),PRCHBOCC=$P($G(^PRCD(420.2,$S(ACCT=1:2697,ACCT=2:2698,ACCT=3:2699,ACCT=6:2699,ACCT=8:2696,1:2699),0)),U);I $G(PRCHBOCC) S Y="@87";3.5//^S X=$G(PRCHBOCC);
"KRN",.402,2664,"DR",2,442.01,14)
S Y="@89";@87;3.5////^S X=PRCHBOCC;S Y="@89";@87;3.5;@89;K PRCHBOCC,PRCHANS,PRCSAVE;S:'$D(PRCHEDI) Y="@5";36.3;36.6;@5;
"KRN",.402,2665,-1)
0^5
"KRN",.402,2665,0)
PRCH PURCHASE CARD AMEND^3060505.1009^^443.6^^^3060629
"KRN",.402,2665,"DIAB",12,1,443.61,7)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2665,"DR",1,443.6)
40///^S X=PRCHI1;
"KRN",.402,2665,"DR",2,443.61)
K PRCSAVE;1.5;I X=""&($L($P($G(^PRC(443.6,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";I X=""&($L($P($G(^PRC(443.6,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";
"KRN",.402,2665,"DR",2,443.61,1)
I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;1;I '$D(^PRC(443.6,DA(1),2,DA,1)) W $C(7),!,"Description is Required!!" S Y=1;
"KRN",.402,2665,"DR",2,443.61,2)
S (PRCHQUAN,PRCHZ)="" I $D(^PRC(443.6,DA(1),1)) S PRCHZ=$S($D(^PRC(441,+$P(^PRC(443.6,DA(1),2,DA,0),U,5),2,+^PRC(443.6,DA(1),1),0)):^(0),1:"");
"KRN",.402,2665,"DR",2,443.61,3)
I PRCHZ'="" W:$P(PRCHZ,U,12)'="" !,*7,"    Minimum Order Qty.: ",$P(PRCHZ,U,12) W:$P(PRCHZ,U,9) !,*7,"    Maximum Order Qty.: ",$P(PRCHZ,U,9) W:$P(PRCHZ,U,11) !,*7,"    Required Order Multiple: ",$P(PRCHZ,U,11) S PRCHQUAN=PRCHZ;
"KRN",.402,2665,"DR",2,443.61,4)
S PRCHQPR=$P($G(^PRC(443.6,DA(1),2,DA,2)),U,8);@2;2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");
"KRN",.402,2665,"DR",2,443.61,5)
I PRCHQPR>0 I X<PRCHQPR W !,"QUANTITY is less than Quantity Previously Received.",$C(7) S Y="@2";I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than Minimum Order Quantity.",$C(7) S Y="@2";
"KRN",.402,2665,"DR",2,443.61,6)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than Maximum Order Quantity.",$C(7) S Y="@2";I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value.",$C(7) S Y="@2";
"KRN",.402,2665,"DR",2,443.61,7)
3;5;I $D(^PRC(443.6,DA(1),1)),$P(^(1),U,20)="Y" S Y="@6";D TSTREQ1^PRCHNPO9;3.1;S DIE("NO^")="A";9.7;K DIE("NO^");9;@6;S PRCHN("MP")=$S($D(^PRCD(442.5,+$P(^PRC(443.6,DA(1),0),U,2),0)):$P(^(0),U,3),1:"");8T~;
"KRN",.402,2665,"DR",2,443.61,8)
I $G(PRCSAVE)'="^" D EN100^PRCHNPO7;
"KRN",.402,2665,"DR",2,443.61,9)
S PRCHFCP=+$P(^PRC(443.6,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:$E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)=11 Y=41 S:(PRCHN("COM")'=1)&($E($P($G(^(0)),U,18),1,2)'=11) Y=4;@4;4;
"KRN",.402,2665,"DR",2,443.61,10)
S PRCHIDA=+$P(^PRC(443.6,DA(1),2,DA,0),U,5),PRCHN("SFC")=+$P(^PRC(443.6,DA(1),0),U,19);
"KRN",.402,2665,"DR",2,443.61,11)
I PRCHN("SFC")=2 S ACCT=$$ACCT^PRCPUX1($E($$NSN^PRCPUX1(PRCHIDA),1,4)) S PRCHBOCC=$S(ACCT=1:2697,ACCT=2:2698,ACCT=3:2699,ACCT=6:2699,ACCT=8:2696,1:2699);I '$G(PRCHBOCC) S Y="@87";S PRCHBOCC=$P($G(^PRCD(420.2,PRCHBOCC,0)),U);
"KRN",.402,2665,"DR",2,443.61,12)
3.5////^S X=PRCHBOCC;S Y="@89";@87;3.5;@89;K PRCHBOCC,PRCHANS,PRCSAVE;
"KRN",.402,2666,-1)
0^2
"KRN",.402,2666,0)
PRCH DELIVERY ORDER AMEND^3060512.1112^^443.6^^^3060705
"KRN",.402,2666,"DIAB",14,1,443.61,8)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2666,"DR",1,443.6)
40///^S X=PRCHI1;
"KRN",.402,2666,"DR",2,443.61)
K PRCSAVE;1.5;I X=""&($L($P($G(^PRC(443.6,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";I X=""&($L($P($G(^PRC(443.6,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";
"KRN",.402,2666,"DR",2,443.61,1)
I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;S PRCHVEN=$P(^PRC(443.6,PRCHPO,1),U);
"KRN",.402,2666,"DR",2,443.61,2)
I X'="",$P($G(^PRC(441,X,2,PRCHVEN,0)),U,3)="",$G(PRCSAVE)="" W !,"This is not a contract item." S Y=1.5;1;I '$D(^PRC(443.6,DA(1),2,DA,1)) W $C(7),?3,!,"Description is Required!!" S Y=1;
"KRN",.402,2666,"DR",2,443.61,3)
S (PRCHQUAN,PRCHZ)="" I $D(^PRC(443.6,DA(1),1)) S PRCHZ=$S($D(^PRC(441,+$P(^PRC(443.6,DA(1),2,DA,0),U,5),2,+^PRC(443.6,DA(1),1),0)):^(0),1:"");
"KRN",.402,2666,"DR",2,443.61,4)
I PRCHZ'="" W:$P(PRCHZ,U,12)'="" !,*7,"    Minimum Order Qty.: ",$P(PRCHZ,U,12) W:$P(PRCHZ,U,9) !,*7,"    Maximum Order Qty.: ",$P(PRCHZ,U,9) W:$P(PRCHZ,U,11) !,*7,"    Required Order Multiple: ",$P(PRCHZ,U,11) S PRCHQUAN=PRCHZ;
"KRN",.402,2666,"DR",2,443.61,5)
S PRCHQPR=$P($G(^PRC(443.6,DA(1),2,DA,2)),U,8);@2;2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");
"KRN",.402,2666,"DR",2,443.61,6)
I PRCHQPR>0 I X<PRCHQPR W !,"QUANTITY is less than Quantity Previously Received.",$C(7) S Y="@2";I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than Minimum Order Quantity.",$C(7) S Y="@2";
"KRN",.402,2666,"DR",2,443.61,7)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than Maximum Order Quantity.",$C(7) S Y="@2";I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value.",$C(7) S Y="@2";
"KRN",.402,2666,"DR",2,443.61,8)
3;5;I $D(^PRC(443.6,DA(1),1)),$P(^(1),U,20)="Y" S Y="@6";D TSTREQ1^PRCHNPO9;3.1;S DIE("NO^")="A";9.7;K DIE("NO^");9;9.5;@6;S PRCHN("MP")=$S($D(^PRCD(442.5,+$P(^PRC(443.6,DA(1),0),U,2),0)):$P(^(0),U,3),1:"");S:PRCHN("MP")=2 Y=4;8T~;
"KRN",.402,2666,"DR",2,443.61,9)
I $G(PRCSAVE)'="^" D EN100^PRCHNPO7;
"KRN",.402,2666,"DR",2,443.61,10)
S PRCHFCP=+$P(^PRC(443.6,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:$E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)=11 Y=41 S:(PRCHN("COM")'=1)&($E($P($G(^(0)),U,18),1,2)'=11) Y=4;9.3;
"KRN",.402,2666,"DR",2,443.61,11)
D TSTREQ2^PRCHNPO9;40;S Y="@4";41//^S Z=$S($D(^PRC(441,+$P(^PRC(443.6,DA(1),2,DA,0),U,5),3)):^(3),1:""),X=$P(Z,U,7);@4;4;S PRCHIDA=+$P(^PRC(443.6,DA(1),2,DA,0),U,5),PRCHN("SFC")=+$P(^PRC(443.6,DA(1),0),U,19);
"KRN",.402,2666,"DR",2,443.61,12)
I PRCHN("SFC")=2 S ACCT=$$ACCT^PRCPUX1($E($$NSN^PRCPUX1(PRCHIDA),1,4)) S PRCHBOCC=$S(ACCT=1:2697,ACCT=2:2698,ACCT=3:2699,ACCT=6:2699,ACCT=8:2696,1:2699);I '$G(PRCHBOCC) S Y="@87";S PRCHBOCC=$P($G(^PRCD(420.2,PRCHBOCC,0)),U);
"KRN",.402,2666,"DR",2,443.61,13)
3.5////^S X=PRCHBOCC;S Y="@89";@87;3.5;@89;K PRCHBOCC,PRCHANS,PRCSAVE;S:'$D(PRCHEDI) Y="@5";36.3;36.6;@5;
"KRN",.402,2669,-1)
0^7
"KRN",.402,2669,0)
PRCHQ RFQ REQUEST^3060509.0853^@^444^^@^3060509
"KRN",.402,2669,"DIAB",3,1,444.019,2)
FEDERAL SUPPLY CLASSIFICATION;T;REQ
"KRN",.402,2669,"DIAB",4,0,444,1)
TRANSMIT TO 'PUBLIC';REQ
"KRN",.402,2669,"DIAB",5,0,444,0)
REFERENCE DATE//TODAY;REQ
"KRN",.402,2669,"DIAB",7,0,444,0)
REQD DELIVERY DATE;REQ
"KRN",.402,2669,"DIAB",8,1,444.019,1)
DESCRIPTION;REQ
"KRN",.402,2669,"DIAB",9,0,444,0)
QUOTE DUE DATE/TIME;REQ
"KRN",.402,2669,"DIAB",9,1,444.019,2)
BOC;REQ
"KRN",.402,2669,"DIAB",11,1,444.019,1)
SIC CODE;REQ
"KRN",.402,2669,"DIAB",12,0,444,0)
PRIORITY OF REQUEST;REQ
"KRN",.402,2669,"DIAB",13,0,444,0)
SHIP TO;REQ
"KRN",.402,2669,"DIAB",14,0,444,0)
DELIVER TO;REQ
"KRN",.402,2669,"DIAB",15,0,444,0)
FOB;REQ
"KRN",.402,2669,"DR",1,444)
S:'$D(PRCDA) PRCDA=D0;S PRCRD=$P($G(^PRC(444,PRCDA,0)),U,2);S PRCRQD=$P($G(^PRC(444,PRCDA,1)),U,2);Q;1R~//^S X=DT;S PRCRD=X;13R~;S PRCRQD=X;2R~;S Y=$$QUOTEDUE^PRCHQ1C(X,PRCRD,PRCRQD) S:Y="" Y="@1";@1;5R~;14R~;15R~;12R~;17.5;3;
"KRN",.402,2669,"DR",1,444,1)
I $P($G(^VA(200,X,.13)),U,5)="" W !,"Contracting Officer lacks Commercial Phone #" S Y=3;19;20;20.5R~;16;S:$$ADMCERT^PRCHQ1C(PRCDA)]"" Y=0;17;
"KRN",.402,2669,"DR",2,444.01)
.01;S PRCVEN=X;1;I $G(X)'="" S Y=$$METHOD^PRCHQ1C(X,PRCVEN) S:Y="" Y="@4";@4;
"KRN",.402,2669,"DR",2,444.019)
S PRCDA2=D1;S PRCITMO=$P($G(^PRC(444,PRCDA,2,PRCDA2,0)),U,4);.01;K PRCSAVE;1;I X=""&($L($P($G(^PRC(444,PRCDA,2,PRCDA2,0)),U,5))=4) S PRCSAVE="G",Y="@5";I X=""&($L($P($G(^PRC(444,PRCDA,2,PRCDA2,0)),U,5))=5) S PRCSAVE="S",Y="@5";
"KRN",.402,2669,"DR",2,444.019,1)
I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@5;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;S PRCIEN=X;D:PRCIEN'=PRCITMO STUFFITM^PRCHQ1C(X,PRCDA,PRCDA2);S PRCITMO=PRCIEN;1.6;1.5R~;3;2;6R~;7;5;
"KRN",.402,2669,"DR",2,444.019,2)
S Y=$$NSN^PRCHQ1C(X) S:Y="" Y="@3";@3;4R~T~;I $G(PRCSAVE)'="^" D EN101^PRCHNPO7;8;9;10;12;12.5R~;K PRCHANS,PRCSAVE;20;S Y=$$DELTOTAL^PRCHQ1C(PRCDA,PRCDA2) S:Y="" Y="@2";@2;
"KRN",.402,2669,"DR",3,444.039)
.01;1;2;3;
"KRN",.402,2673,-1)
0^4
"KRN",.402,2673,0)
PRCH PC DIRECT DELIVERY^3060515.0902^^442^^^3060515
"KRN",.402,2673,"DIAB",3,0,442,3)
SUBSTATION;REQ
"KRN",.402,2673,"DIAB",6,0,442,8)
PCDO VENDOR;REQ
"KRN",.402,2673,"DIAB",7,1,442.01,9)
FEDERAL SUPPLY CLASSIFICATION;T
"KRN",.402,2673,"DR",1,442)
Q:'$D(PRC("SITE"));S (PRCHN("SVC"),PRCHN("CC"),PRCHN("SC"),PRCHN("INV"))="",PRCHN("SFC")=+$P(^PRC(442,DA,0),U,19),PRCHN("FOB")=$S($D(^(1)):$P(^(1),U,6),1:""),PRCHN(12)=$S($D(^PRC(442,DA,12)):^(12),1:"");
"KRN",.402,2673,"DR",1,442,1)
S PRCHNVF="",PRCHPONO=$P(^PRC(442,DA,0),U,1),PRCHSTN=$P(PRCHPONO,"-") S PRCHIEN=DA;S PRCX=$O(^PRC(411,PRC("SITE"),1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,PRC("SITE"),1,PRCX,0)),U) K PRCX;D EN2^PRCHNPO6;
"KRN",.402,2673,"DR",1,442,2)
S PRCHDUZ=$P(^VA(200,DUZ,0),U,1);16////^S X=DUZ;56////^S X=DUZ;.02///^S X=25;48///^S X="P";63///^S X=1;S X=$P($G(^PRC(442,DA,1)),U) I X>0,$P($G(^PRC(440,X,3)),U,2)="Y" S PRCHEDI="";I '$D(^PRC(411,"UP",PRC("SITE"))) S Y=.1;
"KRN",.402,2673,"DR",1,442,3)
S OSUB=$P($G(^PRC(442,DA,23)),U,7);I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($G(^(0)),U,10) I +X=OSUB W !,"SUBSTATION: ",$P(^PRC(411,$P(^PRC(442,DA,23),U,7),0),U) S Y=.1;31R~;
"KRN",.402,2673,"DR",1,442,4)
I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) I X'=OSUB W !,?5,"Sub-station cannot be changed because the attached 2237",!,?5,"would then have a different sub-station.",! S $P(^PRC(442,DA,23),U,7)=OSUB S Y=31;
"KRN",.402,2673,"DR",1,442,5)
S PRCX=$O(^PRC(411,X,1,0)) S:$G(PRCX)]"" PRCY=$P($G(^PRC(411,X,1,PRCX,0)),U) K PRCX;Q;.1//TODAY;S PRCHN("MP")=$S($D(^PRCD(442.5,+X,0)):$P(^(0),U,3),1:""),PRCHN("INV")=$S(PRCHN("INV")]"":PRCHN("INV"),1:"FMS");
"KRN",.402,2673,"DR",1,442,6)
S PRCHCDNO=$P($G(^PRC(442,DA,23)),U,8);D LOOK^PRCSPC;I (X="")!(X["^") S ERRFLG=3,Y=0;I $G(PRCHXXX)="" S ERRFLG=3,Y=0;46////^S X=$G(PRCHXXX);
"KRN",.402,2673,"DR",1,442,7)
I PRCHCDNO'="",X'=PRCHCDNO W !,?5,"Please verify the accounting information for the new purchase card.",!;
"KRN",.402,2673,"DR",1,442,8)
I X]"" S PRCHP0=^PRC(440.5,X,0),PRCHFCP=$P(PRCHP0,U,2),PRCHCC=$P(PRCHP0,U,3),PRCHBOC1=$P(PRCHP0,U,4),PRCHCD=$P(PRCHP0,U),PRCHCDNO=+X,PRCHHLDR=$P(PRCHP0,U,8);55///^S X=PRCHCD;.08//^S X="N";.04//^S X=PRCHN("INV");@33;53R~;
"KRN",.402,2673,"DR",1,442,9)
I $P($G(^PRC(440,($P(^PRC(442,D0,23),U,14)),2)),U,11)'="Y" W !,?5,"This vendor is not a guarenteed delivery vendor." S $P(^PRC(442,DA,23),U,14)="" K X S Y="@33";
"KRN",.402,2673,"DR",1,442,10)
S PRCHOV3=$G(^PRC(440,+^PRC(442,D0,1),3)) S:$P(PRCHOV3,"^",12)="P" Y="@20";I $G(PRCFLAG)=1 S $P(^PRC(442,DA,23),U,14)="" K X S Y=53;S PRCHVEN=+X;5////^S X=PRCHVEN;@20;18.6//^S X="N";I X="N" S Y="@10";18.7;@10;8//^S X=PRCHN("SC");
"KRN",.402,2673,"DR",1,442,11)
I "46910"'[X K:0 DIC("DR") D ^PRCHNPO3 S Y="@1";.25;D ^PRCHNPO3;@1;1//^S X=PRCHFCP;I $D(^PRCS(410,+$P(^PRC(442,DA,0),"^",12),0)) S X=$P($P(^(0),U,1),"-",4) I +X=+$P(^PRC(442,DA,0),U,3) W !,"FCP: ",$P(^(0),U,3) S Y="@2";S X=PRCHFCP;
"KRN",.402,2673,"DR",1,442,12)
S PRCHN("SFC")=$P(^PRC(442,DA,0),U,19) I PRCHN("SFC")'="" W !,"You cannot use a special control point for this type of order." S Y="@1";S PRC("CP")=$P(^PRC(442,DA,0),U,3);@2;
"KRN",.402,2673,"DR",1,442,13)
I $G(PRC("BBFY"))="" S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(^PRC(442,DA,0),U,3));26///^S X=PRC("BBFY");D EN2^PRCHNPO3;2//^S X=PRCHCC;@88;5.2//^S X=PRCHN("SVC");I $D(^PRC(442,DA,1)),$P(^(1),U,18)]"" S Y="@3";
"KRN",.402,2673,"DR",1,442,14)
.3//^S X="E";@3;52;5.3;5.6////^S X="PATIENT";5.4;6.2;6.4;S PRCHN("FOB")=X;Q;7//TODAY+10;8.2//^S X="N/A";8.3;13;S PRCHSHP=+X;I $P(^PRC(442,DA,0),U,19)'=2 S Y="@98";S PRCHSBOC=$P($G(^PRCD(420.2,2299,0)),U);13.05////^S X=PRCHSBOC;
"KRN",.402,2673,"DR",1,442,15)
S Y="@100";@98;13.05;@100;S:'$D(PRCHSHP) PRCHSHP=$P(^PRC(442,DA,0),U,13) I '(PRCHN("FOB")="O"&((PRCHSHP>250)!(PRCHSHP=0))) S Y="@99";13.2;13.4;13.3;@99;97//^S X="A";16//^S X=$S($D(PRCHDUZ):PRCHDUZ,1:"");
"KRN",.402,2673,"DR",1,442,16)
S PRCHDUZ1=X I $P(^PRC(442,DA,0),U,2)=25,'$D(^PRC(440.5,"H",X)) W *7,!,"This user is not a purchase card user." S Y=16;61////^S X=PRCHDUZ1;@25;K PRCHDUZ,PRCHDUZ1;40;24;20;K PRCHANS,PRCHTPO,PRCHSEEN,PRCHMORE,PRCHQTY,PRCSAVE;
"KRN",.402,2673,"DR",2,442.01)
S PRCHREC=DA,PRCHQUAN="",Z="",PRCHTOT=0;.01;K PRCSAVE;S PRCHINUM=DA,PRCHOLD=$P($G(^PRC(442,PRCHIEN,2,PRCHINUM,0)),U,2);1.5;I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=4) S PRCSAVE="G",Y="@101";
"KRN",.402,2673,"DR",2,442.01,1)
I X=""&($L($P($G(^PRC(442,DA(1),2,DA,2)),U,3))=5) S PRCSAVE="S",Y="@101";I X=""&($G(PRCSAVE)="") D ^PRCHAAC4 I $D(PRCHANS) S PRCSAVE=PRCHANS;@101;I $G(PRCSAVE)="^" K PRCHANS,PRCSAVE S Y=0;1;
"KRN",.402,2673,"DR",2,442.01,2)
I '$D(^PRC(442,DA(1),2,DA,1)) W $C(7),!,"Description is Required!!" S Y=1;I $D(^PRC(442,DA(1),1)) S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),2,+^PRC(442,DA(1),1),0)):^(0),1:"");
"KRN",.402,2673,"DR",2,442.01,3)
I Z'="" W:$P(Z,U,12)'="" !,"    Minimum Order Qty.: ",$P(Z,U,12) W:$P(Z,U,9) !,"    Maximum Order Qty.: ",$P(Z,U,9) W:$P(Z,U,11) !,"    Required Order Multiple: ",$P(Z,U,11) S PRCHQUAN=Z K Z;
"KRN",.402,2673,"DR",2,442.01,4)
2//^S X=$S($P(PRCHQUAN,U,12)'="":$P(PRCHQUAN,U,12),$P(PRCHQUAN,U,11)'="":$P(PRCHQUAN,U,11),1:"");I X<PRCHOLD N I F I=0:0 S I=$O(^PRC(442.8,"AC",PRCHPONO,PRCHINUM,I)) Q:'I  S PRCHTOT=PRCHTOT+$P($G(^PRC(442.8,I,0)),U,5);
"KRN",.402,2673,"DR",2,442.01,5)
I $G(PRCHTOT)>X W !!!!!,$C(7),"****Delivery schedule total for this item (",PRCHTOT,") EXCEEDS order quantity (",X,").",!,"Edit delivery schedule(s) now." S PRCHFLG=1,PRCHQTY=X S Y="@16";@44;
"KRN",.402,2673,"DR",2,442.01,6)
I $P(PRCHQUAN,U,12)'="" I X<$P(PRCHQUAN,U,12) W !,"QUANTITY is less than the Minimum Order Quantity of ",$P(PRCHQUAN,U,12),$C(7) S Y=2;
"KRN",.402,2673,"DR",2,442.01,7)
I $P(PRCHQUAN,U,9)'="" I X>$P(PRCHQUAN,U,9) W !,"QUANTITY is more than the Maximum Order Quantity of ",$P(PRCHQUAN,U,9),$C(7) S Y=2;
"KRN",.402,2673,"DR",2,442.01,8)
I $P(PRCHQUAN,U,11)'="" I X#$P(PRCHQUAN,U,11)'=0 W !,"QUANTITY is not a Required Order Multiple value of ",$P(PRCHQUAN,U,11),$C(7) S Y=2;3;5;I $D(^PRC(442,DA(1),1)),$P(^(1),U,20)="Y" S Y="@6";D TSTREQ1^PRCHNPO9;3.1;9.4;S:X']"" Y=9;
"KRN",.402,2673,"DR",2,442.01,9)
S DIE("NO^")="A";9.7;K DIE("NO^");9;9.5;@6;8T~;I $G(PRCSAVE)'="^" D EN10^PRCHNPO7;
"KRN",.402,2673,"DR",2,442.01,10)
S PRCHFCP=+$P(^PRC(442,DA(1),0),U,3),PRCHN("COM")=$S($D(^PRC(441.2,+X,0)):$P(^(0),U,4),1:"") S:$E($P($G(^PRC(420,PRCHSTN,1,PRCHFCP,0)),U,18),1,2)=11 Y=41 S:(PRCHN("COM")'=1)&($E($P($G(^(0)),U,18),1,2)'=11) Y=4;9.3;
"KRN",.402,2673,"DR",2,442.01,11)
D TSTREQ2^PRCHNPO9;40;41//^S Z=$S($D(^PRC(441,+$P(^PRC(442,DA(1),2,DA,0),U,5),3)):^(3),1:""),X=$P(Z,U,7);42;4;@87;36.3;36.6;@5;
"KRN",.402,2673,"DR",2,442.01,12)
S PRCHTOT=0,PRCHSCN="" F I=0:0 S PRCHSCN=$O(^PRC(442.8,"B",PRCHPONO,PRCHSCN)) Q:PRCHSCN=""  I $P(^PRC(442.8,PRCHSCN,0),U,2)=DA S PRCHTOT=PRCHTOT+$P(^(0),U,5);S PRCHQTY=$P(^PRC(442,DA(1),2,DA,0),U,2);
"KRN",.402,2673,"DR",2,442.01,13)
I PRCHTOT>PRCHQTY S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(442,DA(1),2,PRCHREC,0),U) W !,"Line Item # = ",PRCHLINO,!,"Orig. Quantity Ordered: "_$P(^PRC(442,DA(1),2,PRCHREC,0),U,2),! S Y="@555";
"KRN",.402,2673,"DR",2,442.01,14)
W !!,"Enter/Edit Delivery Schedule for this Item?  NO// " R X:DTIME S:'$T X="^" S:X="" X="N" S:X["?" Y="@5" S:"Yy?"'[$E(X) Y="@56" W "  "_$S("Yy"[$E(X):"(YES)","Nn"[$E(X):"(NO)",1:"");@16;
"KRN",.402,2673,"DR",2,442.01,15)
S PRCHDA1=DA(1),PRCHDA=DA,PRCHLINO=$P(^PRC(442,DA(1),2,PRCHREC,0),U) W !,"Line Item #=",PRCHLINO,!,"Orig. Quantity Ordered: "_$P(^PRC(442,DA(1),2,PRCHREC,0),U,2),!;
"KRN",.402,2673,"DR",2,442.01,16)
I PRCHTOT=PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," equals order quantity of ",PRCHQTY,".",!,"You may edit delivery schedule(s), but cannot add a new schedule.",!;@555;
"KRN",.402,2673,"DR",2,442.01,17)
I PRCHTOT>PRCHQTY W !,"Delivery schedule quantity of ",PRCHTOT," EXCEEDS order quantity of ",PRCHQTY,".  You must edit",!,"one or more schedules so that the total equals no more than ",PRCHQTY,".",! S Y="@55";
"KRN",.402,2673,"DR",2,442.01,18)
S:$D(PRCHSEEN) Y="@55";S PRCHSEEN=1 W !!,"To delete a schedule, zero out the quantity to be delivered. To add a new",!,"delivery schedule do the following:",!!;
"KRN",.402,2673,"DR",2,442.01,19)
W "a. If there is no delivery schedule already in file answer 'Yes' when asked if     you are adding a new delivery schedule.";
"KRN",.402,2673,"DR",2,442.01,20)
W !,"b. If there is only one delivery schedule already in the file you will see         'OK? YES//' answer 'No' and then answer 'Yes' when asked if you are adding a    new delivery schedule.";
"KRN",.402,2673,"DR",2,442.01,21)
W !,"c. If there is more than one delivery schedule in the file, hit <return> key at    'CHOOSE' prompt and answer 'Yes' when asked if you are adding a new delivery    schedule.";@55;
"KRN",.402,2673,"DR",2,442.01,22)
S:$G(PRCHDA) PRCHINUM=PRCHDA S PRCHQTY=$P(^PRC(442,PRCHIEN,2,PRCHINUM,0),U,2);
"KRN",.402,2673,"DR",2,442.01,23)
I $G(PRCHFLG),PRCHTOT>PRCHQTY W !!,"Delivery schedule total of ",PRCHTOT," EXCEEDS ordered quantity.",!,"of ",PRCHQTY,".  Adjust delivery schedule(s)." S Y="@16";
"KRN",.402,2673,"DR",2,442.01,24)
I $G(PRCHFLG) S PRCHFLG=0 W !!!!,"****Returning to Item Multiple edit session." S Y="@44";I PRCHTOT>PRCHQTY S Y="@555";
"KRN",.402,2673,"DR",2,442.01,25)
W !!,"Enter/Edit Another Delivery Schedule for this Item? NO// " R X:DTIME S:'$T X="^" S:X="" X="N" S:X["?" Y="@5" S:"Yy?"[$E(X) Y="@16";@56;K PRCHTOT,PRCHSCN;3.5;
"KRN",.402,2673,"DR",2,442.12)
.01;
"KRN",.402,2673,"DR",2,442.15)
.01;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
100^3060705
"PKG",455,22,1,"PAH",1,1,0)
^^2^2^3060705
"PKG",455,22,1,"PAH",1,1,1,0)
This patch addresses issues with the new functionality introduced by the 
"PKG",455,22,1,"PAH",1,1,2,0)
patch PRC*5.1*79 and reported via the Remedy system.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","PRCHAAC4")
0^1^B963460^n/a
"RTN","PRCHAAC4",1,0)
PRCHAAC4 ;WIFO/CR-General Questions Utility ;7/8/05 1:43 PM
"RTN","PRCHAAC4",2,0)
V ;;5.1;IFCAP;**79,100**;Oct 20, 2000
"RTN","PRCHAAC4",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHAAC4",4,0)
 ;
"RTN","PRCHAAC4",5,0)
 ;This routine is called from the input template for Detailed purchase
"RTN","PRCHAAC4",6,0)
 ;card and any other place where the field Federal Supply Classification
"RTN","PRCHAAC4",7,0)
 ;is used. It is also used in combination with tags EN10-EN101 of
"RTN","PRCHAAC4",8,0)
 ;PRCHNPO7. The variable PRCHANS is not killed here. Instead, it is 
"RTN","PRCHAAC4",9,0)
 ;killed within various PO input templates where it is used.
"RTN","PRCHAAC4",10,0)
 N L,M,X
"RTN","PRCHAAC4",11,0)
 S L(1)=$TR($J("",60)," ","-")
"RTN","PRCHAAC4",12,0)
 S L(2)="     Select one Item Type: Goods (G)  or  Services (S)"
"RTN","PRCHAAC4",13,0)
 S L(3)=$TR($J("",60)," ","-")
"RTN","PRCHAAC4",14,0)
 S M(1)="     Answer with G, g, S, s, or '^' to exit"
"RTN","PRCHAAC4",15,0)
 ;
"RTN","PRCHAAC4",16,0)
 D FT^PRC0A(.L,.M,"     Enter an Item Type","","")
"RTN","PRCHAAC4",17,0)
 S X=$E(L,1,1) X "F %=1:1:$L(X) S:$E(X,%)?1L X=$E(X,0,%-1)_$C($A(X,%)-32)_$E(X,%+1,999)" S L=X
"RTN","PRCHAAC4",18,0)
 I "GS^"'[L G V
"RTN","PRCHAAC4",19,0)
 S PRCHANS=L
"RTN","PRCHAAC4",20,0)
 QUIT
"RTN","PRCHAMYB")
0^5^B25029264^B24352836
"RTN","PRCHAMYB",1,0)
PRCHAMYB ;WISC/DJM-MOVING AMENDMENT INFO FROM 443.6 TO 442 ;4/4/95  10:57 AM
"RTN","PRCHAMYB",2,0)
V ;;5.1;IFCAP;**79,100**;Oct 20, 2000
"RTN","PRCHAMYB",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHAMYB",4,0)
 ;
"RTN","PRCHAMYB",5,0)
 N PRCIEN,PRCIEN1,PRCDSL,PAT,PRCDS,PRCDATA,PRCAS,FLAG,DIC,X,DIK,PRCHIEN,LAST,%X,%Y,LOOP,LOOPVAL,DA,MESSG1,CHECKSUM,PRCHPO1,PRCHPOX,PRCHPO2,STATUS,FCP,IMF,O0,O1,PODATE,Y,PRCOPODA
"RTN","PRCHAMYB",6,0)
 S PRCIEN=0 F  S PRCIEN=$O(^PRC(442,PRCHPO,6,PRCHAM,3,PRCIEN)) Q:PRCIEN'>0  D
"RTN","PRCHAMYB",7,0)
 .S PRCIEN1=$G(^PRC(442,PRCHPO,6,PRCHAM,3,PRCIEN,0)) Q:PRCIEN1=""
"RTN","PRCHAMYB",8,0)
 .S PRCDSL=$P(PRCIEN1,U,7) Q:PRCDSL'>0
"RTN","PRCHAMYB",9,0)
 .S ^PRC(442,PRCHPO,6,PRCHAM,3,"AD",PRCDSL,PRCIEN)=""
"RTN","PRCHAMYB",10,0)
 .Q
"RTN","PRCHAMYB",11,0)
 ;
"RTN","PRCHAMYB",12,0)
COPY2 ;NOW TO COPY ANY DELIVERY SCHEDULES FROM 441.7 TO 442.8.
"RTN","PRCHAMYB",13,0)
 S FLAG=0,PAT=$P(^PRC(443.6,PRCHPO,0),U,1),PRCDS=""
"RTN","PRCHAMYB",14,0)
 F  S PRCDS=$O(^PRC(441.7,"AG",PAT,PRCDS)) Q:PRCDS'>0  D  Q:FLAG>0
"RTN","PRCHAMYB",15,0)
 .S PRCDSL="" F  S PRCDSL=$O(^PRC(441.7,"AG",PAT,PRCDS,PRCDSL)) Q:PRCDSL'>0  D  Q:FLAG>0
"RTN","PRCHAMYB",16,0)
 ..S PRCDATA=$G(^PRC(441.7,PRCDSL,0))
"RTN","PRCHAMYB",17,0)
 ..S PRCAS=$P(PRCDATA,U,7)
"RTN","PRCHAMYB",18,0)
 ..S PRCDATA=$P(PRCDATA,U,1,6)
"RTN","PRCHAMYB",19,0)
 ..S PRCDELF=$P(PRCDATA,U,6)
"RTN","PRCHAMYB",20,0)
 ..S:PRCAS>0&(PRCDELF="") ^PRC(442.8,PRCAS,0)=PRCDATA
"RTN","PRCHAMYB",21,0)
 ..I PRCAS>0&(PRCDELF="D") D
"RTN","PRCHAMYB",22,0)
 ...S DIK="^PRC(442.8,"
"RTN","PRCHAMYB",23,0)
 ...S DA=PRCAS
"RTN","PRCHAMYB",24,0)
 ...D ^DIK
"RTN","PRCHAMYB",25,0)
 ...Q
"RTN","PRCHAMYB",26,0)
 ..I PRCAS'>0 D  Q:FLAG>0
"RTN","PRCHAMYB",27,0)
 ...S DIC="^PRC(442.8,",DIC(0)="L",X=PAT K DD,DO D FILE^DICN I Y'>0 W !,"An error has occurred while restoring file 442.8 for "_PAT,!,",item "_PRCDS_"." S FLAG=1 Q
"RTN","PRCHAMYB",28,0)
 ...S PRCAS=$S(PRCAS>0:PRCAS,1:+Y),^PRC(442.8,PRCAS,0)=PRCDATA
"RTN","PRCHAMYB",29,0)
 ..Q:FLAG>0
"RTN","PRCHAMYB",30,0)
 ..S DIK="^PRC(442.8,",DA=$S(PRCAS>0:PRCAS,1:+Y) D IX^DIK
"RTN","PRCHAMYB",31,0)
 ..S PRCHIEN=0 F  S PRCHIEN=$O(^PRC(442,PRCHPO,6,PRCHAM,3,"AD",PRCDSL,PRCHIEN)) Q:PRCHIEN=""  S $P(^PRC(442,PRCHPO,6,PRCHAM,3,PRCHIEN,0),U,7)=PRCAS
"RTN","PRCHAMYB",32,0)
 ..Q
"RTN","PRCHAMYB",33,0)
 .Q
"RTN","PRCHAMYB",34,0)
 Q:FLAG>0
"RTN","PRCHAMYB",35,0)
ROLL ;THIS WILL DO THE LINE ITEM ROLL-UP INTO ALL THE 'BOC's.
"RTN","PRCHAMYB",36,0)
 S LAST=0,%X="^PRC(442,PRCHPO,22,",%Y="^PRC(443.6,PRCHPO,22," D %XY^%RCR
"RTN","PRCHAMYB",37,0)
 S LOOP=0 F  S LOOP=$O(^PRC(442,PRCHPO,22,LOOP)) Q:LOOP'>0  D
"RTN","PRCHAMYB",38,0)
 .S LOOPVAL=$G(^PRC(442,PRCHPO,22,LOOP,0)),$P(LOOPVAL,U,2)=0
"RTN","PRCHAMYB",39,0)
 .S ^PRC(442,PRCHPO,22,LOOP,0)=LOOPVAL I $P(LOOPVAL,U,3)'=991,$P(LOOPVAL,U,3)>LAST S LAST=$P(LOOPVAL,U,3)
"RTN","PRCHAMYB",40,0)
 .Q
"RTN","PRCHAMYB",41,0)
 S DA=PRCHPO D ^PRCHAMYC,^PRCHSF1
"RTN","PRCHAMYB",42,0)
 S (MESSG1,CHECKSUM)="" D RECODE^PRCHES5(PRCHPO,CHECKSUM,.MESSG1)
"RTN","PRCHAMYB",43,0)
 ;
"RTN","PRCHAMYB",44,0)
CLEANUP ;THE CODE FOLLOWING THIS COMMENT WILL DELETE THE TEMPORARY FILE
"RTN","PRCHAMYB",45,0)
 ;ENTRIES IN FILE 443.6 AND 441.7 FOR PRCHPO ENTRY FROM 442 AND 442.8
"RTN","PRCHAMYB",46,0)
 ;FILES.
"RTN","PRCHAMYB",47,0)
 S PRCHPO1=$P($G(^PRC(443.6,PRCHPO,0)),U),PRCHPOX=$P($G(^PRC(443.6,PRCHPO,23)),U,4)
"RTN","PRCHAMYB",48,0)
 I PRCHPOX]"" S PRCHPO2=$P($G(^PRC(443.6,PRCHPOX,0)),U)
"RTN","PRCHAMYB",49,0)
 K ^PRC(443.6,PRCHPO) I PRCHPOX>0 K ^PRC(443.6,PRCHPOX)
"RTN","PRCHAMYB",50,0)
 K ^PRC(443.6,"E",$P(PRCHPO1,"-",2),PRCHPO),^PRC(443.6,"B",PRCHPO1,PRCHPO),^PRC(443.6,"D",PRCHPO),^PRC(443.6,"C",PRCHPO,PRCHAM)
"RTN","PRCHAMYB",51,0)
 I PRCHPOX>0 K ^PRC(443.6,"E",$P(PRCHPO2,"-",2),PRCHPOX),^PRC(443.6,"B",PRCHPO2,PRCHPOX),^PRC(443.6,"D",PRCHPOX),^PRC(443.6,"C",PRCHPOX,PRCHAM)
"RTN","PRCHAMYB",52,0)
 S PRCDS="" F  S PRCDS=$O(^PRC(441.7,"B",PRCHPO1,PRCDS)) Q:PRCDS'>0  D
"RTN","PRCHAMYB",53,0)
 .S DIK="^PRC(441.7,",DA=PRCDS D ^DIK
"RTN","PRCHAMYB",54,0)
 .Q
"RTN","PRCHAMYB",55,0)
 ;
"RTN","PRCHAMYB",56,0)
STATUS ;NOW TO UPDATE THE 'SUPPLY STATUS', FIELD .5.  THIS WILL UPDATE
"RTN","PRCHAMYB",57,0)
 ;THE P.O. STATUS TO EQUAL THE LATEST AMENDMENT STATUS.
"RTN","PRCHAMYB",58,0)
 S STATUS=$P($G(^PRC(442,PRCHPO,6,PRCHAM,1)),U,4),DR=".5////^S X=STATUS",DIE="^PRC(442,",DA=PRCHPO D ^DIE
"RTN","PRCHAMYB",59,0)
 S PRCOPODA=PRCHPO_"^"_1_"^"_PRCHAM
"RTN","PRCHAMYB",60,0)
 ; ...now generating the PHM transaction...
"RTN","PRCHAMYB",61,0)
 D NEW^PRCOEDI ; set up & send PHM
"RTN","PRCHAMYB",62,0)
 ; Create FPDS message for the AAC, PRC*5.1*79. Check if the order was
"RTN","PRCHAMYB",63,0)
 ; amended but the total dollar amount did not. If there is a cancellation, then send the HL7 message.
"RTN","PRCHAMYB",64,0)
 ;PRC*5.1*100: check node 9 and the source code before sending PO to FPDS. Source codes 0,1,3, and 9 not required by FPDS - IEN stored in global.
"RTN","PRCHAMYB",65,0)
 I "1378"[$P(^PRC(442,PRCHPO,1),U,7) G OUT1
"RTN","PRCHAMYB",66,0)
 I $P(^PRC(442,PRCHPO,0),U,15)>0,$D(^PRC(442,PRCHPO,25)),$D(^PRC(442,PRCHPO,9,1,0)) D
"RTN","PRCHAMYB",67,0)
 . I $D(^PRC(442,PRCHPO,6,0)) D
"RTN","PRCHAMYB",68,0)
 .. S PRCMN=$P(^PRC(442,PRCHPO,6,0),U,3)
"RTN","PRCHAMYB",69,0)
 .. I $P(^PRC(442,PRCHPO,6,PRCMN,0),U,3)=0,$P(^PRC(442,PRCHPO,7),U,2)'=45 S PRCQ=1
"RTN","PRCHAMYB",70,0)
 . D:$G(PRCQ)'=1 EN^DDIOL("...now generating the FPDS message for the AAC...","","!!"),EN^DDIOL(" ")
"RTN","PRCHAMYB",71,0)
 . D:$G(PRCQ)'=1 AAC^PRCHAAC
"RTN","PRCHAMYB",72,0)
 ; End of changes for PRC*5.1*79
"RTN","PRCHAMYB",73,0)
OUT1 K PRCOPODA,PRCQ,PRCMN
"RTN","PRCHAMYB",74,0)
 I STATUS'=45 G EXIT
"RTN","PRCHAMYB",75,0)
 S AUTH=$P($G(^PRC(442,PRCHPO,6,PRCHAM,0)),U,4)
"RTN","PRCHAMYB",76,0)
 G:AUTH="" EXIT
"RTN","PRCHAMYB",77,0)
 G:'((AUTH=5)!(AUTH=15)) UPDATE
"RTN","PRCHAMYB",78,0)
 K AUTH,REF,REF1 G EXIT
"RTN","PRCHAMYB",79,0)
 ;
"RTN","PRCHAMYB",80,0)
UPDATE ;UPDATE FILE 410 TO POINT TO THE CORRECT P.O.
"RTN","PRCHAMYB",81,0)
 S O0=$G(^PRC(442,PRCHPO,0))
"RTN","PRCHAMYB",82,0)
 S O1=$G(^PRC(442,PRCHPO,1))
"RTN","PRCHAMYB",83,0)
 S FCP=+$P(O0,U)_+$P(O0,U,3)
"RTN","PRCHAMYB",84,0)
 S PODATE=+$P(O1,U,15)
"RTN","PRCHAMYB",85,0)
 S NEWPO=$P($G(^PRC(442,PRCHPO,23)),U,4)
"RTN","PRCHAMYB",86,0)
 G:NEWPO="" FINI
"RTN","PRCHAMYB",87,0)
 S PRCOPODA=NEWPO_"^"_2_"^"_PRCHAM_"^"_PRCHPO
"RTN","PRCHAMYB",88,0)
 ;...now generating PHA transaction...
"RTN","PRCHAMYB",89,0)
 D NEW^PRCOEDI
"RTN","PRCHAMYB",90,0)
 K PRCOPODA
"RTN","PRCHAMYB",91,0)
 S LOOP=0 F  S LOOP=$O(^PRC(442,NEWPO,2,LOOP)) Q:LOOP'>0  D
"RTN","PRCHAMYB",92,0)
 .S L0=$G(^PRC(442,NEWPO,2,LOOP,0))
"RTN","PRCHAMYB",93,0)
 .S L2=$G(^PRC(442,NEWPO,2,LOOP,2))
"RTN","PRCHAMYB",94,0)
 .S L0=$P(L0,U,10),L2=$P(L2,U,13)
"RTN","PRCHAMYB",95,0)
 .Q:L0=""!(L2="")
"RTN","PRCHAMYB",96,0)
 .I $P(L0,U,5)>0 D
"RTN","PRCHAMYB",97,0)
 ..S IMF=$P(L0,U,5)
"RTN","PRCHAMYB",98,0)
 ..K ^PRC(441,IMF,4,FCP,1,PRCHPO,0)
"RTN","PRCHAMYB",99,0)
 ..S ^PRC(441,IMF,4,FCP,1,NEWPO,0)=NEWPO
"RTN","PRCHAMYB",100,0)
 ..K ^PRC(441,IMF,4,FCP,1,"AC",9999999-PODATE,PRCHPO)
"RTN","PRCHAMYB",101,0)
 ..S ^PRC(441,IMF,4,FCP,1,"AC",9999999-PODATE,NEWPO)=""
"RTN","PRCHAMYB",102,0)
 ..Q
"RTN","PRCHAMYB",103,0)
 .S DA(1)=L0,DA=L2,DIE="^PRCS(410,"_DA(1)_",""IT"",",DR="9///^S X=NEWPO"
"RTN","PRCHAMYB",104,0)
 .D ^DIE
"RTN","PRCHAMYB",105,0)
 .Q
"RTN","PRCHAMYB",106,0)
 S PRC2237=$P($G(^PRC(442,PRCHPO,0)),U,12) G:PRC2237'>0 FINI
"RTN","PRCHAMYB",107,0)
 S PRCCNS=$P($P($G(^PRC(442,NEWPO,0)),U),"-",2)
"RTN","PRCHAMYB",108,0)
 S OLDCNS=$P(^PRCS(410,PRC2237,4),U,5)
"RTN","PRCHAMYB",109,0)
 K ^PRCS(410,"D",OLDCNS,PRC2237)
"RTN","PRCHAMYB",110,0)
 S $P(^PRCS(410,PRC2237,4),U,5)=PRCCNS
"RTN","PRCHAMYB",111,0)
 S ^PRCS(410,"D",PRCCNS,PRC2237)=""
"RTN","PRCHAMYB",112,0)
 S $P(^PRCS(410,PRC2237,10),U,3)=NEWPO
"RTN","PRCHAMYB",113,0)
 S MESSAGE="" D RECODE^PRCSC2(PRC2237,.MESSAGE)
"RTN","PRCHAMYB",114,0)
 I MESSAGE'=1 W !,"An error has occurred while recoding an ESIG.",!
"RTN","PRCHAMYB",115,0)
FINI K NEWPO,LOOP,L0,L2,DIE,DR,PRC2237,OLDCNS,PRCCNS,MESSAGE
"RTN","PRCHAMYB",116,0)
EXIT G OTHER^PRCHAMYD
"RTN","PRCHFPD2")
0^4^B14180601^B13159078
"RTN","PRCHFPD2",1,0)
PRCHFPD2 ;SF/FKV,TKW/RHD-PROMPT WHETHER FPDS DATA IS TO BE ENTERED ;2/9/93  14:54
"RTN","PRCHFPD2",2,0)
V ;;5.1;IFCAP;**79,100**;Oct 20, 2000
"RTN","PRCHFPD2",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHFPD2",4,0)
AMT ;
"RTN","PRCHFPD2",5,0)
 S PRCHY=0 I PRCHEST>0,PRCHEC>0 S PRCHY=PRCHEST/PRCHEC,Y=$P(PRCHY,".",2) I $L(Y)>2 S PRCHY=$P(PRCHY,".",1)+$J("."_Y,2,2)
"RTN","PRCHFPD2",6,0)
 S PRCH=0 F PRCHI=1:1 S PRCH=$O(PRCH("AM",PRCH)) Q:PRCH=""  D CHEC S PRCHAMT=""""_PRCH("AM",PRCH)_"""" K DR S DR="35///"_PRCHAMT,DR(2,442.1)=".01////"_PRCHAMT S:PRCH'=".OM" DR(2,442.1)=DR(2,442.1)_";2////"_PRCH D ^DIE
"RTN","PRCHFPD2",7,0)
 K PRCHI,PRCHY,DR
"RTN","PRCHFPD2",8,0)
 Q
"RTN","PRCHFPD2",9,0)
CHEC ;
"RTN","PRCHFPD2",10,0)
 I PRCHI=PRCHEC,PRCHEST'=(PRCHY*PRCHEC) S PRCHY=PRCHY+(PRCHEST-(PRCHY*PRCHEC))
"RTN","PRCHFPD2",11,0)
 I PRCHY>0 S PRCH("AM",PRCH)=$P(PRCH("AM",PRCH),U,1)_U_($P(PRCH("AM",PRCH),U,2)+PRCHY)_U_$P(PRCH("AM",PRCH),U,3)
"RTN","PRCHFPD2",12,0)
 S PRCH("AM",PRCH)=+$P(PRCH("AM",PRCH),U,2)
"RTN","PRCHFPD2",13,0)
 Q
"RTN","PRCHFPD2",14,0)
FPDS ;
"RTN","PRCHFPD2",15,0)
 ;If source code is not 2, 5, or [4,6,7,B], delivery order from a PA,
"RTN","PRCHFPD2",16,0)
 ;do not ask for any FPDS information and quit.
"RTN","PRCHFPD2",17,0)
 ;If source code is 9, do not ask for any FPDS information
"RTN","PRCHFPD2",18,0)
 I $D(^PRC(442,PRCHPO,14)),$P(^PRC(442,PRCHPO,23),U,11)'="P",$P(^PRC(442,PRCHPO,23),U,11)'="D",PRCHSC=9 S PRCHFPDS=0 D AMT Q
"RTN","PRCHFPD2",19,0)
 ;
"RTN","PRCHFPD2",20,0)
 S PRCHFPDS=0,%B="Specifically excluded from reporting are grants,intragovernmental",%B(1)="procurements,procurements from imprest fund,nonappropriated",%B(2)="(general post,loan guarantee,etc.),SF44s,credit card"
"RTN","PRCHFPD2",21,0)
 S %B(3)="transactions,training authorizations,Government Bills of",%B(4)="Lading (GBL),and Government Transportation Requests (GTR)."
"RTN","PRCHFPD2",22,0)
 S X="",PRCH="" F I=0:0 S PRCH=$O(PRCH("AM",PRCH)) Q:PRCH=""  S X=X+$P(PRCH("AM",PRCH),U,2)
"RTN","PRCHFPD2",23,0)
 ; DON'T ASK FOR FPDS DATA IF TOTAL $>25,000, IF FEDERAL SOURCE, IF IMPREST FUNDS, IF A REQUISITION (FEDERAL SOURCE), OR IF GENERAL POST FUNDS.
"RTN","PRCHFPD2",24,0)
 S X=X+PRCHEST,PRCHTTT=X
"RTN","PRCHFPD2",25,0)
 ; For a delivery PO, forget the 25K limit on the total amount. This is
"RTN","PRCHFPD2",26,0)
 ; intended for Purchasing Agents and Delivery Orders menu users. Now a
"RTN","PRCHFPD2",27,0)
 ; definition for delivery orders is in effect: if the PO uses source
"RTN","PRCHFPD2",28,0)
 ; codes 4, 6, 7, or B, then it is a delivery order (DO).
"RTN","PRCHFPD2",29,0)
 ; Check Detailed PO from a PC user if it has source codes 6 or B.
"RTN","PRCHFPD2",30,0)
 ; PRC*5.1*100: for non-general post funds (GPF), when creating a PO
"RTN","PRCHFPD2",31,0)
 ; PRCHN("SFC")=0. If using a GPF, PRCHN("SFC")=1.
"RTN","PRCHFPD2",32,0)
 I PRCHTTT>25000&($P(^PRC(442,PRCHPO,23),U,11)="P")&($G(PRCHPC)=2)&("6B"[PRCHSC)&($G(PRCHN("SFC"))>1!($G(PRCHN("SFC"))=0)) D PC Q
"RTN","PRCHFPD2",33,0)
 ;
"RTN","PRCHFPD2",34,0)
 ; Check PO from users of the separate Delivery Orders menu
"RTN","PRCHFPD2",35,0)
 I PRCHTTT>25000&(($G(PRCHPHAM)=1)!($G(PRCHDELV)=1))&($G(PRCHN("SFC"))>1!($G(PRCHN("SFC"))=0)) D PC Q
"RTN","PRCHFPD2",36,0)
 ;
"RTN","PRCHFPD2",37,0)
 ; Check PO from the purchasing agent who can use any source code.
"RTN","PRCHFPD2",38,0)
 I PRCHTTT>25000&("467B"[PRCHSC)&($D(^PRC(442,PRCHPO,14)))&($G(PRCHN("SFC"))>1!($G(PRCHN("SFC"))=0)) D DEL Q
"RTN","PRCHFPD2",39,0)
 ;
"RTN","PRCHFPD2",40,0)
 S Y=$S(X>25000:0,"130"[PRCHSC:0,PRCHN("MP")=12:0,PRCHN("MP")=5:0,PRCHN("SFC")=1:0,1:1)
"RTN","PRCHFPD2",41,0)
 I 'Y S X=$S(X>25000:"Total Amount "_$J(X,11,2)_" is greater than $25000.00",1:"") W !!!,"No FPDS Data to be Entered: "_X,!!,%B,!,%B(1),!,%B(2),!,%B(3),!,%B(4),! D AMT K %B Q
"RTN","PRCHFPD2",42,0)
 ; Check below for Delivery or Detailed purchase card orders, PRC*5.1*79
"RTN","PRCHFPD2",43,0)
 I $G(PRCHTTT)'>0 S PRCHFPDS=0 Q  ;don't need $0 orders
"RTN","PRCHFPD2",44,0)
 I $G(PRCHPC)=2!$G(PRCHPHAM)=1!$G(PRCHDELV)=1 D PC Q
"RTN","PRCHFPD2",45,0)
 S %A="Is this P.O. to be reported to the FPDS system (Under $25,000 report)",%=1 D YN^PRCFYN S:%=1 PRCHFPDS=1 K:%=-1 PRCHPO D AMT:$D(PRCHPO)&(%=2)
"RTN","PRCHFPD2",46,0)
 K %B
"RTN","PRCHFPD2",47,0)
 Q
"RTN","PRCHFPD2",48,0)
 ;
"RTN","PRCHFPD2",49,0)
DEL S %A="Is this P.O. to be reported to the FPDS system",%=1 W ! D YN^PRCFYN S:%=1 PRCHFPDS=1 K:%=-1 PRCHPO D AMT:$D(PRCHPO)&(%=2)
"RTN","PRCHFPD2",50,0)
 K %A,%B
"RTN","PRCHFPD2",51,0)
 Q
"RTN","PRCHFPD2",52,0)
 ;
"RTN","PRCHFPD2",53,0)
PC ; Checks below for PRC*5.1*79.
"RTN","PRCHFPD2",54,0)
 S A(1)="This P.O. must be reported to the FPDS system."
"RTN","PRCHFPD2",55,0)
 S A(1,"F")="!!?10"
"RTN","PRCHFPD2",56,0)
 S A(2,"F")="!!"
"RTN","PRCHFPD2",57,0)
 D EN^DDIOL(.A)
"RTN","PRCHFPD2",58,0)
 S PRCHFPDS=1
"RTN","PRCHFPD2",59,0)
 K A,%B
"RTN","PRCHFPD2",60,0)
 Q
"RTN","PRCHFPDE")
0^3^B31116983^B27053598
"RTN","PRCHFPDE",1,0)
PRCHFPDE ;SF-ISC/TKW-EDIT FPDS DATA ON P.O. AFTER SIGNED BY P.A. ;12-6-90/15:48
"RTN","PRCHFPDE",2,0)
V ;;5.1;IFCAP;**79,100**;Oct 20, 2000
"RTN","PRCHFPDE",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHFPDE",4,0)
 ;
"RTN","PRCHFPDE",5,0)
EN1 ;EDIT FPDS DATA ON P.O. AFTER BEING SIGNED BY P.A.
"RTN","PRCHFPDE",6,0)
 I $D(PRCHAM) S PRCHFLG=""
"RTN","PRCHFPDE",7,0)
 N PRCHER,PRCHAM,PRCHAMDA,PRCHAMT,PRCHDUZ ;Newing variables for amends
"RTN","PRCHFPDE",8,0)
 I $D(PRCHPO) S PRCHPOO=PRCHPO N PRCHPO S PRCHPO=PRCHPOO K PRCHPOO
"RTN","PRCHFPDE",9,0)
 D:'$D(PRCHPO) ST^PRCHE Q:'$D(PRC("SITE"))
"RTN","PRCHFPDE",10,0)
EN10 D:'$D(PRCHPO)!'$D(PRCHFLG) LOOK G:'$D(PRCHPO) Q D LCK1^PRCHE G:'$D(DA) EN10 S PRCHEST=$P(^PRC(442,PRCHPO,0),U,13)
"RTN","PRCHFPDE",11,0)
 S X=$G(^PRC(442,PRCHPO,1)),PRCHV=+X,PRCHDT=$S($P(X,U,15)<2881001:0,$P(X,U,15)>2880930:1,1:""),PRCHSC="" I $D(^PRCD(420.8,+$P(X,U,7),0)) S PRCHSC=$P(^(0),U,1)
"RTN","PRCHFPDE",12,0)
 ;
"RTN","PRCHFPDE",13,0)
 ;PRC*5.1*79 - check for canceled orders or ineligible orders, i.e. RMPR
"RTN","PRCHFPDE",14,0)
 I $P(^PRC(442,PRCHPO,7),U,2)=45!($G(PRCHSC)="") D OUT G EN10
"RTN","PRCHFPDE",15,0)
 I $P(^PRC(442,PRCHPO,7),U,2)'>10 D EN^DDIOL("This Purchase Order has not been properly completed.") G EN10
"RTN","PRCHFPDE",16,0)
 I "0139"[PRCHSC D OUT G EN10
"RTN","PRCHFPDE",17,0)
 ;End check for PRC*5.1*79
"RTN","PRCHFPDE",18,0)
 I PRCHDT="" D EN^DDIOL("Purchase Order has no date. ","","!") G EN10
"RTN","PRCHFPDE",19,0)
 I 'PRCHDT W $C(7),!,"This option only available for P.O.'s beyond FY 1988!" G EN10
"RTN","PRCHFPDE",20,0)
 S Y=$G(^PRC(440,PRCHV,2)),PRCHN("LSA")=$P(Y,U,5),PRCHN("MB")=$S(PRCHDT:$P(Y,U,3),1:$P(Y,U,6))
"RTN","PRCHFPDE",21,0)
 S PRCHN("SFC")=$P(^PRC(442,PRCHPO,0),U,19),PRCHN("MP")=$P($G(^PRCD(442.5,+$P(^PRC(442,PRCHPO,0),U,2),0)),U,3) I 'PRCHN("MP") W !,$C(7),"Method of Processing not entered!" G Q
"RTN","PRCHFPDE",22,0)
 S PRCHBO=$S(PRCHDT:1.1,1:1) K PRCHB
"RTN","PRCHFPDE",23,0)
 G:PRCHDT&("013"[PRCHSC) ASK I $O(^PRC(440,PRCHV,PRCHBO,0)) S PRCHB(0)="^442.16PA^"_$P(^(0),U,3,4) F I=0:0 S I=$O(^PRC(440,PRCHV,PRCHBO,I)) Q:'I  S PRCHB(I)=I
"RTN","PRCHFPDE",24,0)
 I PRCHDT,'$D(PRCHB) D ER3^PRCHNPO6 G EN10
"RTN","PRCHFPDE",25,0)
 ;
"RTN","PRCHFPDE",26,0)
ASK W !!,$C(7),"ARE YOU SURE YOU WANT TO RE-ENTER THE FPDS CODES " D YN^DICN Q:($D(PRCHFLG)>0)&(%=-1)  G:($D(PRCHFLG)=0)&(%=-1) EN10
"RTN","PRCHFPDE",27,0)
 D:%=0 W G:%=0 ASK Q:($D(PRCHFLG)>0)&(%'=1)  G:($D(PRCHFLG)=0)&(%'=1) EN10
"RTN","PRCHFPDE",28,0)
 I 'PRCHDT!("013"'[PRCHSC) D EN6^PRCHNPO2 G EN10:'$D(PRCHPO)
"RTN","PRCHFPDE",29,0)
 K PRCH S PRCHEC=0 F I=0:0 S I=$O(^PRC(442,PRCHPO,2,I)) Q:'I  I $D(^(I,0)) S X=^(0),Y=$G(^(2)) D TBL
"RTN","PRCHFPDE",30,0)
 ;
"RTN","PRCHFPDE",31,0)
 ;Clear node 25 of any FPDS data, PRC*5.1*79
"RTN","PRCHFPDE",32,0)
 K ^PRC(442,PRCHPO,9),^PRC(442,PRCHPO,25) S ^(9,0)="^442.1A^^",$P(^PRC(442,PRCHPO,0),U,15)=0
"RTN","PRCHFPDE",33,0)
 W $C(7),!!,"PREVIOUS FPDS CODES HAVE BEEN DELETED!",!!
"RTN","PRCHFPDE",34,0)
 S PRCHY=0 I PRCHEST>0,PRCHEC>0 S PRCHY=PRCHEST/PRCHEC,Y=$P(PRCHY,".",2) I $L(Y)>2 S PRCHY=$P(PRCHY,".",1)+$J("."_Y,2,2)
"RTN","PRCHFPDE",35,0)
 S DIE="^PRC(442,",DR="[PRCHAMT89]",DA=PRCHPO
"RTN","PRCHFPDE",36,0)
 I PRCHDT D FPDS^PRCHFPD2 Q:$D(PRCHFLG)>0&(%=-1)  G:'PRCHFPDS EN10
"RTN","PRCHFPDE",37,0)
 S PRCH="" F PRCHI=1:1 S PRCH=$O(PRCH("AM",PRCH)) Q:PRCH=""  D TYPE^PRCHNPO1 S PRCHAMT=+PRCH("AM",PRCH),PRCHCN=$S(PRCH=".OM":"",1:PRCH) W ?40,"AMOUNT: ",PRCHAMT S PRCHAMT=""""_PRCHAMT_"""",DIE("NO^")="NO" D ^DIE
"RTN","PRCHFPDE",38,0)
 ;PRC*5.1*79 - call new input templates for FPDS data.
"RTN","PRCHFPDE",39,0)
 ;Check a regular PO from a Purchasing Agent.
"RTN","PRCHFPDE",40,0)
 ;PRC*5.1*100 - if the user times out and does not complete the input
"RTN","PRCHFPDE",41,0)
 ;template for the new FPDS, don't allow electronic sig. Check the last
"RTN","PRCHFPDE",42,0)
 ;field required for the PO, based on the source code.
"RTN","PRCHFPDE",43,0)
 ;
"RTN","PRCHFPDE",44,0)
 I ("25"[PRCHSC),$D(^PRC(442,PRCHPO,14)) D  G:$G(PRCHER)=1 Q
"RTN","PRCHFPDE",45,0)
 . S DR="[PRCH NEW PO FPDS]" D ^DIE
"RTN","PRCHFPDE",46,0)
 . I '$D(^PRC(442,PRCHPO,25)) D STOP Q
"RTN","PRCHFPDE",47,0)
 . I $P(^PRC(442,PRCHPO,25),U,6)="" D STOP Q
"RTN","PRCHFPDE",48,0)
 . ;Fund agency code & fund agency office code can be empty in pairs only.
"RTN","PRCHFPDE",49,0)
 . I +$P(^PRC(442,PRCHPO,25),U,7)>0,$P(^PRC(442,PRCHPO,25),U,8)="" D STOP Q
"RTN","PRCHFPDE",50,0)
 ;End of changes for PRC*5.1*100.
"RTN","PRCHFPDE",51,0)
 ;
"RTN","PRCHFPDE",52,0)
 ;For FPDS purposes, consider any PO with any of the following source
"RTN","PRCHFPDE",53,0)
 ;codes as a delivery order:
"RTN","PRCHFPDE",54,0)
 ;PRC*5.1*100 - if the user times out, don't allow electronic sig.
"RTN","PRCHFPDE",55,0)
 I ("467B"[PRCHSC)&($D(^PRC(442,PRCHPO,14))) D  G:$G(PRCHER)=1 Q
"RTN","PRCHFPDE",56,0)
 . S DR="[PRCH NEW PO FPDS]" D ^DIE
"RTN","PRCHFPDE",57,0)
 . I '$D(^PRC(442,PRCHPO,25)) D STOP Q
"RTN","PRCHFPDE",58,0)
 . I $P(^PRC(442,PRCHPO,25),U,15)="" D STOP Q 
"RTN","PRCHFPDE",59,0)
 . E  D POP^PRCHNPO1
"RTN","PRCHFPDE",60,0)
 ;
"RTN","PRCHFPDE",61,0)
 ;Quit if type code, pref, program, etc., are not defined.
"RTN","PRCHFPDE",62,0)
 I '$D(^PRC(442,PRCHPO,9)) D STOP G Q
"RTN","PRCHFPDE",63,0)
 D EN^DDIOL("Ok, let me save your changes.....done!","","!!?3") D ^PRCHSF
"RTN","PRCHFPDE",64,0)
 ;End of changes for PRC*5.1*100.
"RTN","PRCHFPDE",65,0)
 ;
"RTN","PRCHFPDE",66,0)
 ;Send HL7 message to the AAC
"RTN","PRCHFPDE",67,0)
 I $P($G(^PRC(442,PRCHPO,25)),U,17)="YES",$P(^PRC(442,PRCHPO,0),U,15)>0 D EN^DDIOL("...now generating the FPDS message for the AAC","","!") D AAC^PRCHAAC
"RTN","PRCHFPDE",68,0)
 ;End changes for PRC*5.1*79
"RTN","PRCHFPDE",69,0)
 K DIE F I=0:0 Q:'$D(PRCHPO)  S I=$O(^PRC(442,PRCHPO,9,I)) Q:'I  D ER2^PRCHNPO6:$P(^(I,0),U,2)="",ER3^PRCHNPO6:'$O(^(1,0))
"RTN","PRCHFPDE",70,0)
 L  I $D(PRCHFLG) K PRCHFLG Q
"RTN","PRCHFPDE",71,0)
 G EN10
"RTN","PRCHFPDE",72,0)
 ;
"RTN","PRCHFPDE",73,0)
OUT ;Tell the user that the PO is not eligible for FPDS
"RTN","PRCHFPDE",74,0)
 D EN^DDIOL("This PO is not required for FPDS.","","!!?10")
"RTN","PRCHFPDE",75,0)
 Q
"RTN","PRCHFPDE",76,0)
 ;
"RTN","PRCHFPDE",77,0)
STOP ;PRC*5.1*100 - quit if all the FPDS info was not entered.
"RTN","PRCHFPDE",78,0)
 D EN^DDIOL("WARNING: YOU HAVE NOT ENTERED ALL THE FPDS DATA - NO MESSAGE GENERATED.","","!!?5") S PRCHER=1
"RTN","PRCHFPDE",79,0)
 Q
"RTN","PRCHFPDE",80,0)
 ;End of changes for PRC*5.1*100.
"RTN","PRCHFPDE",81,0)
 ;
"RTN","PRCHFPDE",82,0)
TBL ;TABLE LINE/ITEM AMOUNTS MINUS DISCOUNTS BY CONTRACT NO.
"RTN","PRCHFPDE",83,0)
 S PRCHCN=$S($P(Y,U,2)'="":$P(Y,U,2),1:".OM") S:'$D(PRCH("AM",PRCHCN)) PRCH("AM",PRCHCN)="",PRCHEC=PRCHEC+1
"RTN","PRCHFPDE",84,0)
 S PRCH("AM",PRCHCN)=($P(PRCH("AM",PRCHCN),U,1)+1)_"^"_($P(PRCH("AM",PRCHCN),U,2)+Y-$P(Y,U,6))_"^"_($P(PRCH("AM",PRCHCN),U,3))_+X_"," Q:$L(PRCH("AM",PRCHCN))<240
"RTN","PRCHFPDE",85,0)
 ;
"RTN","PRCHFPDE",86,0)
CNDNS N X,Y,I,J,C S C=",",X=$P(PRCH("AM",PRCHCN),U,3)
"RTN","PRCHFPDE",87,0)
 F I=1:1:999 Q:$P(X,C,I)=""  I $P(X,C,I)?.N,$P(X,C,I+1)=($P(X,C,I)+1) F J=I+1:1:999 I ($P(X,C,J+1)'?1N.N)!(($P(X,C,J)+1)'=$P(X,C,J+1)) S Y=C_$P(X,C,I+1,J-1)_C,$P(PRCH("AM",PRCHCN),U,3)=$P(X,Y,1)_":1:"_$P(X,Y,2),I=999,J=999
"RTN","PRCHFPDE",88,0)
 Q
"RTN","PRCHFPDE",89,0)
 ;
"RTN","PRCHFPDE",90,0)
LOOK ;K PRCHPO,PRCHNEW,DA,DIC,D0,DQ S DIC("S")="I +^(0)=PRC(""SITE"") S PRCHX=$S($D(^(7)):+^(7),1:0) I $D(^PRCD(442.3,PRCHX,0)),$P(^(0),U,2)>9"
"RTN","PRCHFPDE",91,0)
 K PRCHPO,PRCHNEW,DA,DIC,D0,DQ S DIC("S")="I +^(0)=PRC(""SITE"") S PRCHX=+$G(^(7)) I $D(^PRCD(442.3,PRCHX,0)),$P(^(0),U,2)>9"
"RTN","PRCHFPDE",92,0)
 S DIC="^PRC(442,",DIC(0)="QEAMZ",D="C",DIC("A")="PURCHASE ORDER: " S:'$D(DIC("S")) DIC("S")="I +$P(^(0),U,1)=PRC(""SITE"")"
"RTN","PRCHFPDE",93,0)
 W !! D IX^DIC K DIC S X="" Q:+Y<0  S (PRCHPO,DA)=+Y
"RTN","PRCHFPDE",94,0)
 Q
"RTN","PRCHFPDE",95,0)
 ;
"RTN","PRCHFPDE",96,0)
ER W !,$S('PRCHDT:" Breakout Code is undefined.",1:" Socioeconomic Group (FY89) not defined in Vendor file."),$C(7) K PRCHPO
"RTN","PRCHFPDE",97,0)
 Q
"RTN","PRCHFPDE",98,0)
 ;
"RTN","PRCHFPDE",99,0)
W W !!,?10," Enter either Yes/No  or  enter ""^"" to exit."
"RTN","PRCHFPDE",100,0)
 W !!,"This option will delete all FPDS codes that were previously entered",!,"for this Purchase Order, then allow you to re-enter them."
"RTN","PRCHFPDE",101,0)
 Q
"RTN","PRCHFPDE",102,0)
 ;
"RTN","PRCHFPDE",103,0)
 ;
"RTN","PRCHFPDE",104,0)
Q L  K PRC,PRCHI,PRCHFLG G Q^PRCHNPO4
"RTN","PRCHMA")
0^7^B77180458^B78026253
"RTN","PRCHMA",1,0)
PRCHMA ;WISC/AKS-Amend to PO, req ;6/10/96  14:07
"RTN","PRCHMA",2,0)
 ;;5.1;IFCAP;**21,79,100**;Oct 20, 2000
"RTN","PRCHMA",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHMA",4,0)
REQ ;Req.
"RTN","PRCHMA",5,0)
 N PRCHREQ
"RTN","PRCHMA",6,0)
 S PRCHREQ=1
"RTN","PRCHMA",7,0)
PO ;PO
"RTN","PRCHMA",8,0)
 N PRCF,RETURN,PRCHAM,PRCHPO,PRCHNEW,OUT,CAN,PRCHAU,PRCHER,PRCHON
"RTN","PRCHMA",9,0)
 N A,B,ER,FL,FIS,DELIVER,PRCHAMDA,PRCHAV,PRCHL1,PRCHLN,PRCHRET,LCNT
"RTN","PRCHMA",10,0)
 N PRCHL2,ROU,DIC,I,PRCHAMT,PRCHAREC,PRCHEDI,X,Y,PRCHN,PRCHO,SFUND
"RTN","PRCHMA",11,0)
 N PRCHX,PRCHIMP,PRCHNRQ,PRCHP,REPO,PRCHNORE,%,%A,%B,D0,D1,J
"RTN","PRCHMA",12,0)
 N PRCFL,MSG
"RTN","PRCHMA",13,0)
LOOP D KILL^PRCHMA1 S PRCHNEW="",PRCHNORE=1,CAN=0
"RTN","PRCHMA",14,0)
 ;
"RTN","PRCHMA",15,0)
 ; See routine PRCHAMXA for information on variable PRCHNORE and for
"RTN","PRCHMA",16,0)
 ; incidence of undefined DIK variable errors.
"RTN","PRCHMA",17,0)
 ; The var PRCHPO is the basic premise of locks applied to amendments.
"RTN","PRCHMA",18,0)
 ; Anytime amend module is accessed add +lock & save po# in PRCENTRY.
"RTN","PRCHMA",19,0)
 ;
"RTN","PRCHMA",20,0)
 S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("SITE"))
"RTN","PRCHMA",21,0)
 ;
"RTN","PRCHMA",22,0)
 ; Lock simultaneous entry of users in amend. module for the same record.
"RTN","PRCHMA",23,0)
 ; Var Y is saved in PRCHPO at the end of GETPO subrtn, when we start
"RTN","PRCHMA",24,0)
 ; the process(AMENDNO) of amending the record we must have var PRCHPO.
"RTN","PRCHMA",25,0)
 ;
"RTN","PRCHMA",26,0)
 S PRCFL=0
"RTN","PRCHMA",27,0)
 W !! D GETPO^PRCHAMU
"RTN","PRCHMA",28,0)
 ; If no record is selected or time-out or up-arrow out then exit
"RTN","PRCHMA",29,0)
 ; without unlocking a record.
"RTN","PRCHMA",30,0)
 I $D(DTOUT)!$D(DUOUT)!$G(OUT)=1 G EXIT1
"RTN","PRCHMA",31,0)
 I PRCFL=1 G LOOP
"RTN","PRCHMA",32,0)
 I '$G(PRCHPO)!$D(FIS) G EXIT
"RTN","PRCHMA",33,0)
 I '$$VERIFY^PRCHES5(PRCHPO) W !!,?5,"This purchase order has been tampered with.",!,?5,"Please notify IFCAP APPLICATION COORDINATOR.",! G EXIT
"RTN","PRCHMA",34,0)
 D AMENDNO^PRCHAMU G:'$G(PRCHAM) EXIT
"RTN","PRCHMA",35,0)
 S PRCHAMT=0,FL=0
"RTN","PRCHMA",36,0)
 D INFO^PRCHAMU G:$D(PRCHAV)!ER EXIT
"RTN","PRCHMA",37,0)
 S X=$P($G(^PRC(443.6,PRCHPO,0)),U,16) D EN2^PRCHAMXB
"RTN","PRCHMA",38,0)
 I PRCHNEW="" S DA(1)=PRCHPO,DA=PRCHAM,PRCHX=X,X=0,PRCHAMDA=34 D EN8^PRCHAMXB S X=PRCHX
"RTN","PRCHMA",39,0)
 I $P(^PRC(443.6,PRCHPO,6,PRCHAM,0),U,4)=5!($P(^(0),U,4)=15) S CAN=1
"RTN","PRCHMA",40,0)
 I PRCHNEW=111&($G(CAN)=0) D REV
"RTN","PRCHMA",41,0)
 I $G(CAN)>0 D ENC G:ER EXIT I $G(NOCAN)=0 S DA(1)=PRCHPO,DA=PRCHAM,PRCHAMDA=34,PRCHX=X,X=0 D EN8^PRCHAMXB S X=PRCHX G CAN1
"RTN","PRCHMA",42,0)
ASK K NOCAN,DTOUT,DUOUT,REPONUM D ASK^PRCHAMU
"RTN","PRCHMA",43,0)
 G:$D(REPONUM)=1 CAN1
"RTN","PRCHMA",44,0)
 I ER=0 D  G:'$D(REPO)&($G(CAN)=0) ASK
"RTN","PRCHMA",45,0)
 . D @ROU
"RTN","PRCHMA",46,0)
 . I $G(PRCHAMDA)=31 D MSG^PRCHAMU Q
"RTN","PRCHMA",47,0)
 . I $G(PRCHAMDA)=24,$G(X)=2 D MSG1^PRCHAMU S SCE=1 Q
"RTN","PRCHMA",48,0)
 ;
"RTN","PRCHMA",49,0)
 I $P(^PRC(443.6,PRCHPO,6,PRCHAM,0),U,4)=5!($P(^(0),U,4)=15) S CAN=1
"RTN","PRCHMA",50,0)
 I $D(DTOUT)!($D(DUOUT)) G EXIT
"RTN","PRCHMA",51,0)
 I $G(NOCAN)=1 G ASK
"RTN","PRCHMA",52,0)
 G:$P($G(^PRC(443.6,PRCHPO,6,PRCHAM,3,0)),U,4)'>1 EXIT
"RTN","PRCHMA",53,0)
CAN1 D UPDATE^PRCHAMU G:$D(Y) EXIT
"RTN","PRCHMA",54,0)
CHK I '$$VERIFY^PRCHES5(PRCHPO) W !!,?5,"This purchase order has been tampered with.",!,?5,"Please notify IFCAP APPLICATION COORDINATOR." G EXIT
"RTN","PRCHMA",55,0)
 I $P($G(^PRC(443.6,PRCHPO,6,PRCHAM,1)),U,4)']"" W !!,?5,"There is no Amendment Status." D
"RTN","PRCHMA",56,0)
 .S POSTAT=+$G(^PRC(443.6,PRCHPO,7))
"RTN","PRCHMA",57,0)
 .S AMSTAT=$S(POSTAT=25:26,POSTAT=30:31,POSTAT=40:71,POSTAT=6:83,POSTAT=84:85,POSTAT=86:87,POSTAT=90:91,POSTAT=92:93,POSTAT=94:95,POSTAT=96:97,POSTAT=45:45,1:POSTAT)
"RTN","PRCHMA",58,0)
 .S AMSTAT=$P(^PRCD(442.3,AMSTAT,0),U)
"RTN","PRCHMA",59,0)
 .S DIE="^PRC(443.6,PRCHPO,6,",DA(1)=PRCHPO,DA=PRCHAM,DR="9//^S X=AMSTAT"
"RTN","PRCHMA",60,0)
 .D ^DIE K DIE,AMSTAT,POSTAT
"RTN","PRCHMA",61,0)
 K PRCHER S LCNT=1 I $P($G(^PRC(443.6,PRCHPO,6,PRCHAM,1)),U,4)']"" W !!,?5,"There is no Amendment Status.",! S PRCHER=""
"RTN","PRCHMA",62,0)
 I $P($G(^PRC(443.6,PRCHPO,2,0)),U,4)>0 D  G:$D(PRCHER) ERR
"RTN","PRCHMA",63,0)
 .N END S END=IOSL-3
"RTN","PRCHMA",64,0)
 .S PRCH=0 F  S PRCH=$O(^PRC(443.6,PRCHPO,2,PRCH)) Q:PRCH=""!(PRCH'>0)  D
"RTN","PRCHMA",65,0)
 ..S PRCHLN=$G(^PRC(443.6,PRCHPO,2,PRCH,0)) D  Q
"RTN","PRCHMA",66,0)
 ...I $P(PRCHLN,U,4)="" D:LCNT>END TOP W !!,?5,"Line item ",+$P(PRCHLN,U)," is missing BOC !",$C(7) S PRCHER="",LCNT=LCNT+2
"RTN","PRCHMA",67,0)
 ...I $G(PRCHAUTH)'=1,$G(PRCHREQ) I $P(PRCHLN,U,13)="" D:LCNT>END TOP W !!,?5,"Line item ",+$P(PRCHLN,U)," is missing NSN!",$C(7) S PRCHER="",LCNT=LCNT+2
"RTN","PRCHMA",68,0)
 ...S J=0 S J=$O(^PRC(443.6,PRCHPO,2,PRCH,1,J)) I J'>0 D:LCNT>END TOP W !!,?5,"Line item ",+$P(PRCHLN,U)," is missing its description!",$C(7) S PRCHER="",LCNT=LCNT+2
"RTN","PRCHMA",69,0)
 ...I $P($G(^PRC(442,PRCHPO,23)),U,11)="D",$P($G(^PRC(443.6,PRCHPO,2,PRCH,2)),U,2)="" D:LCNT>END TOP W !!,?5,"Line item ",+$P(PRCHLN,U)," is missing contract number.",$C(7) S PRCHER="",LCNT=LCNT+2
"RTN","PRCHMA",70,0)
 ...; PRC*5.1*79 - Check line items of PC orders with source code=6 to
"RTN","PRCHMA",71,0)
 ...; make sure that a contract number is entered
"RTN","PRCHMA",72,0)
 ...D PCD^PRCHMA1
"RTN","PRCHMA",73,0)
 ...Q
"RTN","PRCHMA",74,0)
 ..Q
"RTN","PRCHMA",75,0)
 .I $D(PRCHER) I LCNT>END N DIR S DIR(0)="E" D ^DIR S LCNT=1
"RTN","PRCHMA",76,0)
 .Q
"RTN","PRCHMA",77,0)
 ;PRC*5.1*100: check line items without an FSC or PSC
"RTN","PRCHMA",78,0)
 D EN106^PRCHNPO7 I $G(ERROR)=1 G EXIT
"RTN","PRCHMA",79,0)
 I $P($G(^PRC(443.6,PRCHPO,0)),U,13)>0 I $P($G(^PRC(443.6,PRCHPO,23)),U)="" W !!,?5,"This amendment has Est. Shipping and/or Handling charges without any",!,?5,"Est. Shipping BOC." S PRCHER=""
"RTN","PRCHMA",80,0)
 I $P($G(^PRC(443.6,PRCHPO,6,PRCHAM,0)),U,4)=5!($P($G(^(0)),U,4)=15) S CAN=1
"RTN","PRCHMA",81,0)
 I $G(CAN)'=1 D CHECK^PRCHAMDF(PRCHPO,PRCHAM,.PRCHER)
"RTN","PRCHMA",82,0)
 ; 
"RTN","PRCHMA",83,0)
 ; Change below to allow checks for monthly limits in file #440.5 before
"RTN","PRCHMA",84,0)
 ; completion of the amendment.
"RTN","PRCHMA",85,0)
 ;
"RTN","PRCHMA",86,0)
 I $G(PRCHAUTH)=1!($P($G(^PRC(443.6,PRCHPO,0)),U,2)=25) S FILE=443.6 D  I $G(ERROR) S PRCHER="" K ERROR,FILE
"RTN","PRCHMA",87,0)
 .D ^PRCHSF3
"RTN","PRCHMA",88,0)
 .D ADJ1^PRCHCD0
"RTN","PRCHMA",89,0)
 .D LIMIT^PRCHCD0
"RTN","PRCHMA",90,0)
 ;
"RTN","PRCHMA",91,0)
ERR I $D(PRCHER) W !!,?5,"This amendment needs to be re-edited before it can be signed.",!,"**REMINDER** Unsigned amendments are deleted from the system after 7 days." D:LCNT>20  G EXIT
"RTN","PRCHMA",92,0)
 .N DIR S DIR(0)="E" D ^DIR
"RTN","PRCHMA",93,0)
 .Q
"RTN","PRCHMA",94,0)
 D REV:'$G(PRCPROST),APP G:%'=1 EXIT
"RTN","PRCHMA",95,0)
 S PRCHRET=$$ASK^PRCHAM8(PRCHPO,PRCHAM) G:PRCHRET'=1 EXIT
"RTN","PRCHMA",96,0)
 S RETURN="" D COMMIT^PRCHAM8(PRCHPO,PRCHAM,.RETURN)
"RTN","PRCHMA",97,0)
 G:RETURN'=1 EXIT
"RTN","PRCHMA",98,0)
 S DIE="^PRC(443.6,"_PRCHPO_",6,",DA=PRCHAM,DR="15///TODAY+4" D ^DIE
"RTN","PRCHMA",99,0)
 D ^PRCHSF3
"RTN","PRCHMA",100,0)
 I $P(^PRC(443.6,PRCHPO,0),U,2)'=25 S PRCHQ="^PRCHPAM8",PRCHQ("DEST")="F",D0=PRCHPO,D1=PRCHAM D ^PRCHQUE
"RTN","PRCHMA",101,0)
 I '($P(^PRC(443.6,PRCHPO,0),U,2)=25!($P(^PRC(443.6,PRCHPO,0),U,19)=2)) D
"RTN","PRCHMA",102,0)
 . W !?3,"SEND TO SUPPLY " S PRCHQ="^PRCHPAM8",D0=PRCHPO,D1=PRCHAM D ^PRCHQUE
"RTN","PRCHMA",103,0)
 . S FILE=443.6 D:$D(PRCHPO) CHECK^PRCHSWCH
"RTN","PRCHMA",104,0)
 . I $G(PRCHOBL)=1 D SUPP^PRCFFM2M K FILE Q
"RTN","PRCHMA",105,0)
 . I $G(PRCHOBL)=2 S PRCOPODA=PRCHPO D ^PRCOEDI K FILE,PRCOPODA Q
"RTN","PRCHMA",106,0)
 I $P($G(^PRC(443.6,PRCHPO,0)),U,2)=25 D  S:$G(PRCPROST) PRCPROST=PRCPROST+0.9 G EXIT
"RTN","PRCHMA",107,0)
 .S MTOPDA=1
"RTN","PRCHMA",108,0)
 .D SUPP^PRCFFM2M ;I $P($G(^PRC(442,PRCHPO,23)),"^",11)="P" W !!,"...now generating the PHA transaction..." S PRCOPODA=PRCHPO D NEW^PRCOEDI K PRCOPODA W !!
"RTN","PRCHMA",109,0)
 .S PPTEMP=0,PP410=$P($G(^PRC(442,PRCHPO,0)),"^",12),PPAMT=$P($G(^PRC(442,PRCHPO,0)),"^",16) I PP410'="" S PPTEMP=$P($G(^PRCS(410,PP410,4)),"^",8),PPTEMP=-(PPAMT-PPTEMP)
"RTN","PRCHMA",110,0)
 .I $P($G(^PRC(442,PRCHPO,7)),"^",2)=45 S PPTEMP=PPAMT,PPAMT=0
"RTN","PRCHMA",111,0)
 .I PP410'="" S $P(^PRCS(410,PP410,4),"^",3)=0
"RTN","PRCHMA",112,0)
 .I PP410'="" S $P(^PRCS(410,PP410,4),"^",8)=PPAMT
"RTN","PRCHMA",113,0)
 .S A=$$DATE^PRC0C($P(PRCOAMT,"^",3),"I"),$P(PRCOAMT,"^",3,4)=$E(A,3,4)_"^"_$P(A,"^",2),$P(PRCOAMT,"^",5)=PPTEMP D EBAL^PRCSEZ(PRCOAMT,"O")
"RTN","PRCHMA",114,0)
 .I PP410'="",$P($G(^PRC(442,PRCHPO,7)),"^",2)=45 S $P(^PRCS(410,PP410,0),"^",2)="CA" D ERS410^PRC0G(PP410_"^C")
"RTN","PRCHMA",115,0)
 .D REMOVE^PRCSC2(PP410),ENCODE^PRCSC2(PP410,DUZ,.MESSAGE) K MESSAGE
"RTN","PRCHMA",116,0)
 .I '$G(PRCPROST) W !?3,"SEND TO SUPPLY " S PRCHQ="^PRCHPAM",D0=PRCHPO,D1=PRCHAM D ^PRCHQUE
"RTN","PRCHMA",117,0)
 .;
"RTN","PRCHMA",118,0)
 .; Update file #440.5 after amendment has been approved. Consider orders
"RTN","PRCHMA",119,0)
 .; created and amended in the same month and year and the user either
"RTN","PRCHMA",120,0)
 .; cancels the order or enters other type of amendment that changes the
"RTN","PRCHMA",121,0)
 .; final amount of the order. No credit is given for orders from a
"RTN","PRCHMA",122,0)
 .; previous month and year. DT is the current date, system-supplied.
"RTN","PRCHMA",123,0)
 .;
"RTN","PRCHMA",124,0)
 .S PRCHCD=$P($G(^PRC(442,PRCHPO,23)),U,8)
"RTN","PRCHMA",125,0)
 .S PRCNODE=$G(^PRC(442,PRCHPO,6,0)),PRCAMD=$P(PRCNODE,U,3)
"RTN","PRCHMA",126,0)
 .S PRCCHG=$P($G(^PRC(442,PRCHPO,6,PRCAMD,0)),U,3)
"RTN","PRCHMA",127,0)
 .S POSTAT=$P($G(^PRC(442,PRCHPO,7)),"^",2)
"RTN","PRCHMA",128,0)
 .I $E($P(^PRC(442,PRCHPO,1),U,15),1,5)=$E(DT,1,5),POSTAT'=45 D
"RTN","PRCHMA",129,0)
 ..I $G(PPAMT)<0 Q
"RTN","PRCHMA",130,0)
 ..S $P(^PRC(440.5,PRCHCD,2),U)=$P($G(^PRC(440.5,PRCHCD,2)),U)+$G(PRCCHG)
"RTN","PRCHMA",131,0)
 ..I $P($G(^PRC(440.5,PRCHCD,2)),U)<0 S $P(^PRC(440.5,PRCHCD,2),U)=0
"RTN","PRCHMA",132,0)
 .;
"RTN","PRCHMA",133,0)
 .I $E($P(^PRC(442,PRCHPO,1),U,15),1,5)=$E(DT,1,5),POSTAT=45 D
"RTN","PRCHMA",134,0)
 ..I $G(PPTEMP)<0 Q
"RTN","PRCHMA",135,0)
 ..S $P(^PRC(440.5,PRCHCD,2),U)=$P($G(^PRC(440.5,PRCHCD,2)),U)-$G(PPTEMP)
"RTN","PRCHMA",136,0)
 ..I $P($G(^PRC(440.5,PRCHCD,2)),U)<0 S $P(^PRC(440.5,PRCHCD,2),U)=0
"RTN","PRCHMA",137,0)
 .;
"RTN","PRCHMA",138,0)
 .; Update file #440.5 only if the amendment is for non-cancellation
"RTN","PRCHMA",139,0)
 .; of an order from a previous month regardless of the year.
"RTN","PRCHMA",140,0)
 .I $E($P(^PRC(442,PRCHPO,1),U,15),1,5)'=$E(DT,1,5),POSTAT'=45 D
"RTN","PRCHMA",141,0)
 ..I $G(PPAMT)<0 Q
"RTN","PRCHMA",142,0)
 ..S $P(^PRC(440.5,PRCHCD,2),U)=$P($G(^PRC(440.5,PRCHCD,2)),U)+$G(PPAMT)
"RTN","PRCHMA",143,0)
 .K DA,MTOPDA,PRCAMD,PRCHCD,PRCCHG,PRCNODE,POSTAT,PPTEMP,PPAMT,PP410
"RTN","PRCHMA",144,0)
 S SFUND="" I $P($G(^PRC(443.6,PRCHPO,0)),U,19)=2 D SUPP^PRCFFM2M S SFUND=1
"RTN","PRCHMA",145,0)
 I SFUND=1 W !?3,"SEND TO SUPPLY " S PRCHQ="^PRCHPAM",D0=PRCHPO,D1=PRCHAM D ^PRCHQUE
"RTN","PRCHMA",146,0)
 ;
"RTN","PRCHMA",147,0)
 D SOURCE^PRCHAMU:$G(SCE)
"RTN","PRCHMA",148,0)
 G EXIT
"RTN","PRCHMA",149,0)
 ;
"RTN","PRCHMA",150,0)
ENC ;Can
"RTN","PRCHMA",151,0)
 S ER=0
"RTN","PRCHMA",152,0)
 D CAN^PRCHMA3
"RTN","PRCHMA",153,0)
 I $G(NOCAN)=1 W !?5,$S($D(PRCHREQ):"REQUISITION",1:"PURCHASE ORDER")_" HAS BEEN RECEIVED, CANNOT CANCEL !",$C(7) S ER=1 Q
"RTN","PRCHMA",154,0)
 I $G(PRCHAUTH)=1 D PAID^PRCHINQ I $G(PAID)=1 D  S ER=1 Q
"RTN","PRCHMA",155,0)
 . W !,?5,"THERE HAS BEEN PAYMENT MADE FOR THIS PURCHASE CARD ORDER, CANNOT CANCEL !",$C(7)
"RTN","PRCHMA",156,0)
 S %="",%A="     SURE YOU WANT TO CANCEL THIS ORDER ",%B="" D ^PRCFYN
"RTN","PRCHMA",157,0)
 I %'=1 W ?40,"    <NOTHING CANCELLED>" D  Q
"RTN","PRCHMA",158,0)
 .I $D(PRCHAU) D
"RTN","PRCHMA",159,0)
 ..S $P(^PRC(443.6,PRCHPO,6,PRCHAM,0),U,4)=PRCHAU
"RTN","PRCHMA",160,0)
 ..S $P(^PRC(443.6,PRCHPO,6,PRCHAM,1),U,4)=""
"RTN","PRCHMA",161,0)
 .S NOCAN=1
"RTN","PRCHMA",162,0)
 S DA(1)=PRCHPO,DIE="^PRC(443.6,"_DA(1)_",6,",DA=PRCHAM,DR="9////^S X=$O(^PRCD(442.3,""C"",45,0))"
"RTN","PRCHMA",163,0)
 D ^DIE K DIE,DA,DR S CAN=1
"RTN","PRCHMA",164,0)
 S PRCHAMT=-$P(^PRC(443.6,PRCHPO,0),U,15) W !
"RTN","PRCHMA",165,0)
 QUIT
"RTN","PRCHMA",166,0)
APP ;App,pr
"RTN","PRCHMA",167,0)
 S %A="   Approve Amendment number "_PRCHAM_": ",%B="",%=$S($G(PRCPROST):1,1:2) D ^PRCFYN
"RTN","PRCHMA",168,0)
 Q
"RTN","PRCHMA",169,0)
REV ;Rev
"RTN","PRCHMA",170,0)
 N PRCH
"RTN","PRCHMA",171,0)
 S %=1,%B="",%A="   Review Amendment " D ^PRCHSF3 W ! D ^PRCFYN
"RTN","PRCHMA",172,0)
 I %=1 S D0=PRCHPO,D1=PRCHAM,PRCH="^PRC(443.6," D ^PRCHDAM
"RTN","PRCHMA",173,0)
 Q
"RTN","PRCHMA",174,0)
EXIT ;Ex
"RTN","PRCHMA",175,0)
 L -^PRC(442,PRCENTRY)
"RTN","PRCHMA",176,0)
EXIT1 K ERROR,FIS,REPO,DEL
"RTN","PRCHMA",177,0)
 QUIT:$G(PRCPROST)
"RTN","PRCHMA",178,0)
 I $G(OUT)'=1 G LOOP
"RTN","PRCHMA",179,0)
 QUIT
"RTN","PRCHMA",180,0)
 ;
"RTN","PRCHMA",181,0)
FLAG ;
"RTN","PRCHMA",182,0)
 I $G(FLAG)=1 K FLAG Q
"RTN","PRCHMA",183,0)
 Q
"RTN","PRCHMA",184,0)
NOSIGN ;
"RTN","PRCHMA",185,0)
 S $P(^PRC(443.6,PRCHPO,6,PRCHAM,0),U,4)=PRCHAU
"RTN","PRCHMA",186,0)
NOSIGN1 S DA(1)=PRCHPO,DIE="^PRC(443.6,"_DA(1)_",6,",DA=PRCHAM,DR="9///@"
"RTN","PRCHMA",187,0)
 D ^DIE K DIE,DA,DR
"RTN","PRCHMA",188,0)
 Q
"RTN","PRCHMA",189,0)
TOP ;PAUSE AT BOTTOM OF SCREEN
"RTN","PRCHMA",190,0)
 N DIR S DIR(0)="E"
"RTN","PRCHMA",191,0)
 D ^DIR
"RTN","PRCHMA",192,0)
 S LCNT=1
"RTN","PRCHMA",193,0)
 Q
"RTN","PRCHNPO1")
0^2^B54452339^B36217028
"RTN","PRCHNPO1",1,0)
PRCHNPO1 ;SF-ISC/RSD/RHD-CONT. OF NEW PO ;6/9/96  19:48
"RTN","PRCHNPO1",2,0)
V ;;5.1;IFCAP;**16,79,100**;Oct 20, 2000
"RTN","PRCHNPO1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHNPO1",4,0)
 I '$G(PRCHPC),'$G(PRCHPHAM) D
"RTN","PRCHNPO1",5,0)
 .S PRCH=0,DIE="^PRC(442,",DR="[PRCHDISCNT]",(D0,DA,DA(1))=PRCHPO
"RTN","PRCHNPO1",6,0)
 .I $G(PRCHDELV) S DR="[PRCHPROMPT]"
"RTN","PRCHNPO1",7,0)
 .D ^DIE
"RTN","PRCHNPO1",8,0)
 F I=1:1 S PRCH=$O(^PRC(442,PRCHPO,3,PRCH)) Q:PRCH=""!(PRCH'>0)  S PRCHCN=$S($P(^(PRCH,0),U,5)]"":$P(^(0),U,5),1:".OM"),PRCHAC=$P(^(0),U,1),PRCHACT=$P(^(0),U,4),PRCHP=$P(^(0),U,2) D SET Q:'$D(PRCHPO)
"RTN","PRCHNPO1",9,0)
 G ERR^PRCHNPO:'$D(PRCHPO) S $P(^PRC(442,PRCHPO,0),U,14)=$P(^PRC(442,PRCHPO,0),U,14)+I-1,PRCHLCNT=$P(^(0),U,14),Y=$G(^PRC(440,PRCHV,2)),PRCHN("LSA")=$P(Y,U,5),PRCHN("MB")=$S(PRCHDT:$P(Y,U,3),1:$P(Y,U,6))
"RTN","PRCHNPO1",10,0)
 S PRCHBO=$S(PRCHDT:1.1,1:1) K PRCHB
"RTN","PRCHNPO1",11,0)
 S X="",PRCH="" F I=0:0 S PRCH=$O(PRCH("AM",PRCH)) Q:PRCH=""  S X=X+$P(PRCH("AM",PRCH),U,2)
"RTN","PRCHNPO1",12,0)
 ;Comment line below for PRC*5.1*79, new FPDS report for Austin
"RTN","PRCHNPO1",13,0)
 ;G:($G(PRCHPC)!$G(PRCHDELV)) EST
"RTN","PRCHNPO1",14,0)
 I $G(PRCHPC)=1 G EST ;skip for Simplified PC orders, PRC*5.1*79
"RTN","PRCHNPO1",15,0)
 I PRCHDT I (X+PRCHEST>25000&("467B"'[PRCHSC))!("013"[PRCHSC)!(PRCHN("MP")=12)!(PRCHN("MP")=5)!(PRCHN("SFC")=1) G E2
"RTN","PRCHNPO1",16,0)
 I $O(^PRC(440,PRCHV,PRCHBO,0)) S PRCHB(0)="^442.16PA^"_$P(^(0),U,3,4) F I=0:0 S I=$O(^PRC(440,PRCHV,PRCHBO,I)) Q:'I  S:$P(^PRCD(420.6,+I,0),"^",5)'="N" PRCHB(I)=I
"RTN","PRCHNPO1",17,0)
 I PRCHDT,'$D(PRCHB) D ER3^PRCHNPO6 G ERR^PRCHNPO
"RTN","PRCHNPO1",18,0)
 D EN6^PRCHNPO2 G ERR^PRCHNPO:'$D(PRCHPO)
"RTN","PRCHNPO1",19,0)
 ;
"RTN","PRCHNPO1",20,0)
 ;Clean up node 25 to place new FPDS data, PRC*5.1*79.
"RTN","PRCHNPO1",21,0)
E2 S DR=$S($G(PRCHPC)=2:"[PRCHAMT89 NEW]",$D(PRCHDELV):"[PRCHAMT89 NEW]",$D(PRCHPHAM):"[PRCHAMT89 NEW]",PRCHDT:"[PRCHAMT89]",1:"[PRCHAMT]")
"RTN","PRCHNPO1",22,0)
 K ^PRC(442,PRCHPO,9),^PRC(442,PRCHPO,25) S $P(^PRC(442,PRCHPO,0),U,15,16)="0^0"
"RTN","PRCHNPO1",23,0)
 ;
"RTN","PRCHNPO1",24,0)
 I PRCHDT D FPDS^PRCHFPD2 G:'PRCHFPDS EST
"RTN","PRCHNPO1",25,0)
 S PRCHY=0 I PRCHEST>0,PRCHEC>0 S PRCHY=PRCHEST/PRCHEC,Y=$P(PRCHY,".",2) I $L(Y)>2 S PRCHY=$P(PRCHY,".",1)+$J("."_Y,2,2)
"RTN","PRCHNPO1",26,0)
 S PRCH=0 F PRCHI=1:1 S PRCH=$O(PRCH("AM",PRCH)) Q:PRCH=""  D TYPE S PRCHAMT=PRCH("AM",PRCH),PRCHCN=$S(PRCH=".OM":"",1:PRCH),DIE("NO^")="NO" W ?40,"AMOUNT: ",PRCHAMT S PRCHAMT=""""_PRCHAMT_"""" D ^DIE
"RTN","PRCHNPO1",27,0)
 ;New tasks for FPDS data collection, PRC*5.1*79.
"RTN","PRCHNPO1",28,0)
 ;Look at the entry actions for POs created by a Purchasing Agent, a PC
"RTN","PRCHNPO1",29,0)
 ;user and a Delivery Orders user and call the required input template.
"RTN","PRCHNPO1",30,0)
 ;PRC*5.1*100 - If the user times out and does not complete the input
"RTN","PRCHNPO1",31,0)
 ;template for the new FPDS, don't allow electronic sig. Check the last
"RTN","PRCHNPO1",32,0)
 ;field required for the PO, based on the source code and menu.
"RTN","PRCHNPO1",33,0)
 I '$D(PRCHPC)&("25"[PRCHSC) D  G:$G(PRCHER)=1 ERR^PRCHNPO
"RTN","PRCHNPO1",34,0)
 . S DR="[PRCH NEW PO FPDS]" D ^DIE
"RTN","PRCHNPO1",35,0)
 . I '$D(^PRC(442,PRCHPO,25)) S PRCHER=1 Q
"RTN","PRCHNPO1",36,0)
 . I $P(^PRC(442,PRCHPO,25),U,6)="" S PRCHER=1 Q
"RTN","PRCHNPO1",37,0)
 . ;Fund agency code & fund agency office code can be empty in pairs only.
"RTN","PRCHNPO1",38,0)
 . I +$P(^PRC(442,PRCHPO,25),U,7)>0,$P(^PRC(442,PRCHPO,25),U,8)="" S PRCHER=1 Q
"RTN","PRCHNPO1",39,0)
 ;
"RTN","PRCHNPO1",40,0)
 ;For FPDS purposes, consider any PO with any of the following source
"RTN","PRCHNPO1",41,0)
 ;codes as a delivery order (including direct delivery POs)from a PA:
"RTN","PRCHNPO1",42,0)
 ;If the user times out, don't allow electronic sig., PRC*5.1*100.
"RTN","PRCHNPO1",43,0)
 I ("467B"[PRCHSC)&($D(^PRC(442,PRCHPO,14)))!($G(PRCHPC)=3) D  G:$G(PRCHER)=1 ERR^PRCHNPO
"RTN","PRCHNPO1",44,0)
 . S DR="[PRCH NEW PO FPDS]" D ^DIE
"RTN","PRCHNPO1",45,0)
 . I '$D(^PRC(442,PRCHPO,25)) S PRCHER=1 Q
"RTN","PRCHNPO1",46,0)
 . I $P(^PRC(442,PRCHPO,25),U,15)'="" D POP Q
"RTN","PRCHNPO1",47,0)
 . E  S PRCHER=1
"RTN","PRCHNPO1",48,0)
 ;
"RTN","PRCHNPO1",49,0)
 ;Get eligible Detailed purchase card orders. If the user times out,
"RTN","PRCHNPO1",50,0)
 ;don't allow electronic signature, PRC*5.1*100.
"RTN","PRCHNPO1",51,0)
 I $G(PRCHPC)=2 D  G:$G(PRCHER)=1 ERR^PRCHNPO
"RTN","PRCHNPO1",52,0)
 . S DR="[PRCH NEW PC FPDS]" D ^DIE
"RTN","PRCHNPO1",53,0)
 . I '$D(^PRC(442,PRCHPO,25)) S PRCHER=1 Q
"RTN","PRCHNPO1",54,0)
 . S PRCHSC=$P(^PRCD(420.8,+PRCHSC,0),U,1)
"RTN","PRCHNPO1",55,0)
 . I ("2"[PRCHSC)&($P(^PRC(442,PRCHPO,25),U,6)="") S PRCHER=1 Q
"RTN","PRCHNPO1",56,0)
 . ;Fund agency code & fund agency office code can be empty in pairs only.
"RTN","PRCHNPO1",57,0)
 . I ("2"[PRCHSC)&(+$P(^PRC(442,PRCHPO,25),U,7)>0),$P(^PRC(442,PRCHPO,25),U,8)="" S PRCHER=1 Q
"RTN","PRCHNPO1",58,0)
 . I ("6B"[PRCHSC)&($P(^PRC(442,PRCHPO,25),U,13)="") S PRCHER=1 Q
"RTN","PRCHNPO1",59,0)
 ;
"RTN","PRCHNPO1",60,0)
 ;Get delivery orders from the separate Delivery Orders menu. If the
"RTN","PRCHNPO1",61,0)
 ;user times out, don't allow electronic sig.; PRC*5.1*100.
"RTN","PRCHNPO1",62,0)
 I $G(PRCHDELV)=1!($G(PRCHPHAM)=1) D  G:$G(PRCHER)=1 ERR^PRCHNPO
"RTN","PRCHNPO1",63,0)
 . S DR="[PRCH NEW DEL FPDS]" D ^DIE
"RTN","PRCHNPO1",64,0)
 . I '$D(^PRC(442,PRCHPO,25)) S PRCHER=1 Q
"RTN","PRCHNPO1",65,0)
 . I $P(^PRC(442,PRCHPO,25),U,15)'="" D POP Q
"RTN","PRCHNPO1",66,0)
 . E  S PRCHER=1
"RTN","PRCHNPO1",67,0)
 ;
"RTN","PRCHNPO1",68,0)
 ;End of changes for PRC*5.1*79.
"RTN","PRCHNPO1",69,0)
 K DIE F I=0:0 Q:'$D(PRCHPO)  S I=$O(^PRC(442,PRCHPO,9,I)) Q:'I  D ER2^PRCHNPO6:$P(^(I,0),"^",2)="",ER3^PRCHNPO6:'$O(^(1,0))
"RTN","PRCHNPO1",70,0)
 ;PRC*5.1*100 - Quit if user fails to populate any required field in
"RTN","PRCHNPO1",71,0)
 ;node 9 (amount, type code, pref. program, etc.) or just times out.
"RTN","PRCHNPO1",72,0)
 ;
"RTN","PRCHNPO1",73,0)
 N J,K,L S K=+$P(^PRC(442,PRCHPO,9,0),U,3)
"RTN","PRCHNPO1",74,0)
 F L=1:1:K D  G:$G(PRCHER)=1 ERR^PRCHNPO
"RTN","PRCHNPO1",75,0)
 . F J=1,2,4,5 D
"RTN","PRCHNPO1",76,0)
 .. I $P(^PRC(442,PRCHPO,9,L,0),"^",J)="" S PRCHER=1
"RTN","PRCHNPO1",77,0)
 ;End of changes for PRC*5.1*100.
"RTN","PRCHNPO1",78,0)
 ;
"RTN","PRCHNPO1",79,0)
EST G ERR^PRCHNPO:'$D(PRCHPO) I 'PRCHEST,PRCHESTL S $P(^PRC(442,PRCHPO,0),U,18)=""
"RTN","PRCHNPO1",80,0)
 D EN2^PRCHNPO7 I PRCHEST D EST^PRCHNPO6
"RTN","PRCHNPO1",81,0)
 I $P($G(^PRC(442,PRCHPO,23)),U,11)="",PRCHSTAT'=22 S (X,Y)=5,DA=PRCHPO D UPD^PRCHSTAT
"RTN","PRCHNPO1",82,0)
 I $G(PRCHPC)=2!$G(PRCHDELV) S (D0,DA)=PRCHPO D ^PRCHSF
"RTN","PRCHNPO1",83,0)
 I '$G(PRCPROST) S %=1,%B="",%A="     Review "_$S($G(PRCHPC):"Purchase Card",$G(PRCHDELV):"Delivery",1:"Purchase")_" Order " D ^PRCFYN I %=1 S D0=PRCHPO D ^PRCHDP1
"RTN","PRCHNPO1",84,0)
 I PRCHSTAT=22 S (D0,DA)=PRCHPO D ^PRCHSF G Q^PRCHNPO4
"RTN","PRCHNPO1",85,0)
 G ^PRCHNPO4
"RTN","PRCHNPO1",86,0)
 ;
"RTN","PRCHNPO1",87,0)
SET G:PRCHAC="Q" PCTQ
"RTN","PRCHNPO1",88,0)
 I PRCHAC[":" S PRCHAC=$P(PRCHAC,":",1)_":1:"_$P(PRCHAC,":",2)
"RTN","PRCHNPO1",89,0)
 ;
"RTN","PRCHNPO1",90,0)
PCT S PRCHAMT=0,Y="F J="_PRCHAC_" S PRCHN=J D PCT1 G:$D(PRCHER) Q" X Y Q:'$D(PRCHPO)
"RTN","PRCHNPO1",91,0)
 S PRCHAMT=PRCHAMT*100+.5\1/100,$P(PRCH("AM",PRCHCN),U,2)=$P(PRCH("AM",PRCHCN),U,2)-PRCHAMT
"RTN","PRCHNPO1",92,0)
 S $P(^PRC(442,PRCHPO,3,PRCH,0),U,3)=PRCHAMT,$P(^(0),U,6)=I+PRCHLCNT
"RTN","PRCHNPO1",93,0)
 Q
"RTN","PRCHNPO1",94,0)
 ;
"RTN","PRCHNPO1",95,0)
PCT1 I $D(^PRC(442,PRCHPO,2,"B",PRCHN)) S GTFLAG="" D  G:GTFLAG=1 ER^PRCHNPO6 G:GTFLAG=2 ER1^PRCHNPO6
"RTN","PRCHNPO1",96,0)
 .S PRCHN=$O(^PRC(442,PRCHPO,2,"B",PRCHN,0)),PRCHD=+$P($G(^PRC(442,PRCHPO,2,PRCHN,2)),U,1) I PRCHD'>0 S GTFLAG=1 Q
"RTN","PRCHNPO1",97,0)
 .I $S(PRCHCN=".OM"&($P(^(2),U,2)=""):0,PRCHCN=$P(^(2),U,2):0,1:1) S GTFLAG=2 Q
"RTN","PRCHNPO1",98,0)
 .S PRCHDA=0
"RTN","PRCHNPO1",99,0)
 .I $E(PRCHP,1)="$" S PRCHDA=$P(PRCHP,"$",2)/PRCHACT
"RTN","PRCHNPO1",100,0)
 .E  S PRCHDA=$J(PRCHD*(PRCHP/100),0,2)
"RTN","PRCHNPO1",101,0)
 .S PRCHAMT=PRCHAMT+PRCHDA,$P(^PRC(442,PRCHPO,2,PRCHN,2),U,6)=PRCHDA
"RTN","PRCHNPO1",102,0)
 Q
"RTN","PRCHNPO1",103,0)
 ;
"RTN","PRCHNPO1",104,0)
PCTQ S (PRCHAMT,PRCHCN,PRCHX)=0,PRCHACT=PRCHLCNT F K=0:0 S PRCHCN=$O(PRCH("AM",PRCHCN)) Q:PRCHCN=""  S PRCHAC=$E($P(PRCH("AM",PRCHCN),U,3),1,$L($P(PRCH("AM",PRCHCN),U,3))-1) D PCT Q:'$D(PRCHPO)  S PRCHX=PRCHX+PRCHAMT
"RTN","PRCHNPO1",105,0)
 Q:'$D(PRCHPO)  S $P(^PRC(442,PRCHPO,3,PRCH,0),U,3)=PRCHX
"RTN","PRCHNPO1",106,0)
 Q
"RTN","PRCHNPO1",107,0)
 ;
"RTN","PRCHNPO1",108,0)
POP ;Set up place of performance for PRC*5.1*79, new FPDS. If station is the
"RTN","PRCHNPO1",109,0)
 ;place of perf. for PO, send the state abbrev. and zip code, otherwise
"RTN","PRCHNPO1",110,0)
 ;send the vendor's state and zip code. Applies to all Delivery POs.
"RTN","PRCHNPO1",111,0)
 ;For Guaranteed Delivery orders, we have to choose the VAMC since users
"RTN","PRCHNPO1",112,0)
 ;are not asked for a SHIP TO location - PRC*5.1*100.
"RTN","PRCHNPO1",113,0)
 N PRCST,PRCSTL,PRCSZP,PRCPOP,PRCLOC,PRCROOT,PRCVAMC
"RTN","PRCHNPO1",114,0)
 I $P(^PRC(442,PRCHPO,25),"^",15)="Y" D
"RTN","PRCHNPO1",115,0)
 . I $P(^PRC(442,PRCHPO,0),"^",2)=4 D POP1 Q
"RTN","PRCHNPO1",116,0)
 . S PRCLOC=$P(^PRC(442,PRCHPO,1),U,3) ;ship to location
"RTN","PRCHNPO1",117,0)
 . S PRCST=$P(^PRC(411,PRC("SITE"),1,PRCLOC,0),"^",6)  ;station's state
"RTN","PRCHNPO1",118,0)
 . S PRCSTL=$P(^DIC(5,PRCST,0),"^",2)
"RTN","PRCHNPO1",119,0)
 . S PRCSZP=$P(^PRC(411,PRC("SITE"),1,PRCLOC,0),"^",7) ;station's zip
"RTN","PRCHNPO1",120,0)
 . S PRCPOP=PRCSTL_PRCSZP,$P(^PRC(442,PRCHPO,25),"^",16)=PRCPOP
"RTN","PRCHNPO1",121,0)
 . Q
"RTN","PRCHNPO1",122,0)
 I $P(^PRC(442,PRCHPO,25),"^",15)="N" D
"RTN","PRCHNPO1",123,0)
 . S PRCST=$P(^PRC(440,PRCHV,0),"^",7) ;vendor's state
"RTN","PRCHNPO1",124,0)
 . S PRCSTL=$P(^DIC(5,PRCST,0),"^",2)
"RTN","PRCHNPO1",125,0)
 . S PRCSZP=$E($P(^PRC(440,PRCHV,0),"^",8),1,5) ;vendor's zip
"RTN","PRCHNPO1",126,0)
 . S PRCPOP=PRCSTL_PRCSZP,$P(^PRC(442,PRCHPO,25),"^",16)=PRCPOP
"RTN","PRCHNPO1",127,0)
 Q
"RTN","PRCHNPO1",128,0)
 ;
"RTN","PRCHNPO1",129,0)
POP1 ;Set up for Guaranteed Delivery orders - users are not asked for a SHIP
"RTN","PRCHNPO1",130,0)
 ;TO location during PO creation - PRC*5.1*100.
"RTN","PRCHNPO1",131,0)
 S PRCROOT=$G(^PRC(411,PRC("SITE"),0)),PRCVAMC=$G(^(3)) ; local VAMC
"RTN","PRCHNPO1",132,0)
 S PRCST=$P(PRCVAMC,"^",4)
"RTN","PRCHNPO1",133,0)
 S PRCSTL=$P(^DIC(5,PRCST,0),"^",2) ;station's state
"RTN","PRCHNPO1",134,0)
 S PRCSZP=$E($P(PRCVAMC,"^",5),1,5) ;station's zip
"RTN","PRCHNPO1",135,0)
 S PRCPOP=PRCSTL_PRCSZP,$P(^PRC(442,PRCHPO,25),"^",16)=PRCPOP
"RTN","PRCHNPO1",136,0)
 Q
"RTN","PRCHNPO1",137,0)
 ;End of changes for new FPDS
"RTN","PRCHNPO1",138,0)
 ;
"RTN","PRCHNPO1",139,0)
TYPE I PRCHI=PRCHEC,PRCHEST'=(PRCHY*PRCHEC) S PRCHY=PRCHY+(PRCHEST-(PRCHY*PRCHEC))
"RTN","PRCHNPO1",140,0)
 I PRCHY>0 S PRCH("AM",PRCH)=$P(PRCH("AM",PRCH),U,1)_U_($P(PRCH("AM",PRCH),U,2)+PRCHY)_U_$P(PRCH("AM",PRCH),U,3)
"RTN","PRCHNPO1",141,0)
 ;When Source Code is not 5 then display a list of Possible Type Codes
"RTN","PRCHNPO1",142,0)
 I PRCHSC'=5 D
"RTN","PRCHNPO1",143,0)
 . W !,$S(PRCH'=".OM":"CONTRACT/BOA: "_PRCH,1:""),"  Possible ",$S(PRCHDT:"Method/Type Codes: ",1:"Type Codes: ")
"RTN","PRCHNPO1",144,0)
 . I 'PRCHDT S I=0 F Y=0:0 S Y=$O(^PRCD(420.6,Y)) S:Y>100 Y="" Q:'Y  D EN7^PRCHNPO2 I $T W:I "," W $P(^PRCD(420.6,Y,0),"^",1) S I=I+1
"RTN","PRCHNPO1",145,0)
 . I PRCHDT S I=0 F Y=100:0 S Y=$O(^PRCD(420.6,Y)) S:Y>120 Y="" Q:'Y  D PROC^PRCHFPDS I $T W:I "," W $P(^PRCD(420.6,Y,0),U,1) S I=I+1
"RTN","PRCHNPO1",146,0)
 . Q
"RTN","PRCHNPO1",147,0)
 ;
"RTN","PRCHNPO1",148,0)
 S PRCHX=$P(PRCH("AM",PRCH),U,3),K=0
"RTN","PRCHNPO1",149,0)
 I PRCHX]"" W !?1,"ITEM: " W:PRCHX'[":1:" PRCHX I PRCHX[":1:" F J=0:0 S PRCHX=$P(PRCHX,":1:",1)_":"_$P(PRCHX,":1:",2,99) I PRCHX'[":1:" W PRCHX Q
"RTN","PRCHNPO1",150,0)
 S:$P(PRCH("AM",PRCH),U,2)]"" PRCH("AM",PRCH)=$P(PRCH("AM",PRCH),U,2)
"RTN","PRCHNPO1",151,0)
 Q
"RTN","PRCHNPO1",152,0)
 ;
"RTN","PRCHNPO1",153,0)
Q L  K PRCH,PRCHAC,PRCHACT,PRCHAM,PRCHAMT,PRCHB,PRCHBO,PRCHCN,PRCHCNT,PRCHD,PRCHDA,PRCHDT,PRCHEC,PRCHER,PRCHES,PRCHEST,PRCHFPDS,PRCHI,PRCHL0,PRCHL1,PRCHL2,PRCHL3,PRCHLCNT,PRCHLI
"RTN","PRCHNPO1",154,0)
 K PRCHN,PRCHP,PRCHPO,PRCHSC,PRCHV,PRCHX,PRCHY,DIC,DIE,DR,D0,DA,X,Y
"RTN","PRCHNPO1",155,0)
 Q
"RTN","PRCHNPO7")
0^6^B63147574^B58672235
"RTN","PRCHNPO7",1,0)
PRCHNPO7 ;WISC/RHD-MISCELLANEOUS ROUTINES FROM P.O.ADD/EDIT 442 ; 7/27/05 10:16am
"RTN","PRCHNPO7",2,0)
V ;;5.1;IFCAP;**79,100**;Oct 20, 2000
"RTN","PRCHNPO7",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHNPO7",4,0)
 ;
"RTN","PRCHNPO7",5,0)
EN1 ;INPUT TRANSFORM-FILE 442, NSN #9.5
"RTN","PRCHNPO7",6,0)
 I '$D(^PRC(441.2,+X,0)) W !!,$C(7),"Invalid NSN--first 4 characters must be FSC code!!" K X Q
"RTN","PRCHNPO7",7,0)
 S PRCHCI=+$P(^PRC(442,DA(1),2,DA,0),U,5)
"RTN","PRCHNPO7",8,0)
 S Z=$O(^PRC(441,"BB",X,0)) S:Z=PRCHCI Z=$O(^(Z)) I Z W !!,$C(7),"This NSN has already been assigned to item # "_$O(^(0))_"!!" K X Q
"RTN","PRCHNPO7",9,0)
 I $P(^PRC(441.2,+X,0),U,4)="" W $C(7),!,"Commodity Code missing on this FSC--Required for LOG code sheets!" K X Q
"RTN","PRCHNPO7",10,0)
 S $P(^PRC(442,DA(1),2,DA,2),U,3)=+X
"RTN","PRCHNPO7",11,0)
 Q:$P(^PRC(442,DA(1),2,DA,0),U,5)=""
"RTN","PRCHNPO7",12,0)
 S:'$D(PRC("SITE")) PRC("SITE")=+^PRC(442,DA(1),0) S PRCHCPO=DA(1) D EN5^PRCHCRD
"RTN","PRCHNPO7",13,0)
 S PRCHSAVX=X,X=+X
"RTN","PRCHNPO7",14,0)
 G EN11
"RTN","PRCHNPO7",15,0)
 ;
"RTN","PRCHNPO7",16,0)
EN10 ;UPDATE FEDERAL SUPPLY CLASSIFICATION/PRODUCT SERVICE CODE (FSC/PSC), field #8, file #442.
"RTN","PRCHNPO7",17,0)
 ;PRC*5.1*79: if entering a service item, don't check for commodity code.
"RTN","PRCHNPO7",18,0)
 ;The field title is now called 'FSC/PSC' to hold either a Federal Supply
"RTN","PRCHNPO7",19,0)
 ;Classification (FSC) code or a Product Service Code (PSC) to support a
"RTN","PRCHNPO7",20,0)
 ;new FPDS report for the Austin Automation Center (AAC). The variable
"RTN","PRCHNPO7",21,0)
 ;PRCSAVE is killed in various PO input templates where it is used.
"RTN","PRCHNPO7",22,0)
 ;
"RTN","PRCHNPO7",23,0)
 I '$D(PRCSAVE)&(X'=$P(^PRC(441.2,+X,0),U,1))&($P(^PRC(442,DA(1),2,DA,0),U,5)'="") D EN102 K A,X Q
"RTN","PRCHNPO7",24,0)
 ;
"RTN","PRCHNPO7",25,0)
 I ($P(^PRC(441.2,+X,0),U,4)="")&(X=$P(^PRC(441.2,+X,0),U,1)) D EN104 K A,X Q
"RTN","PRCHNPO7",26,0)
 S:'$D(PRC("SITE")) PRC("SITE")=+^PRC(442,DA(1),0)
"RTN","PRCHNPO7",27,0)
 I $G(PRCSAVE)="G"&(X'=$P(^PRC(441.2,+X,0),U,1)) D EN102 K A,X Q
"RTN","PRCHNPO7",28,0)
 ;
"RTN","PRCHNPO7",29,0)
 I $G(PRCSAVE)="S"&(X=$P(^PRC(441.2,+X,0),U,1))&($P(^PRC(442,DA(1),2,DA,0),U,5)="") D EN103 K A,X Q
"RTN","PRCHNPO7",30,0)
 ;
"RTN","PRCHNPO7",31,0)
EN11 S PRCHCI=+$P(^PRC(442,DA(1),2,DA,0),U,5),PRCHCPO=DA(1) I $D(^PRC(441,+PRCHCI,0)) D EN8^PRCHCRD1
"RTN","PRCHNPO7",32,0)
 S:$D(PRCHSAVX) X=PRCHSAVX K PRCHSAVX
"RTN","PRCHNPO7",33,0)
 Q
"RTN","PRCHNPO7",34,0)
 ;
"RTN","PRCHNPO7",35,0)
EN100 ;Come here for amended orders - check FSC/PSC, field #8, file #443.6.
"RTN","PRCHNPO7",36,0)
 ;PRC*5.1*79: if entering a service item, don't check for commodity code
"RTN","PRCHNPO7",37,0)
 I X=""&($P(^PRC(443.6,DA(1),2,DA,2),U,3)="") D EN^DDIOL("This field is Required!!") S Y="@6" Q
"RTN","PRCHNPO7",38,0)
 I '$D(PRCSAVE)&(X'=$P(^PRC(441.2,+X,0),U,1))&($P(^PRC(443.6,DA(1),2,DA,0),U,5)'="") D EN102 K A,X Q
"RTN","PRCHNPO7",39,0)
 ;
"RTN","PRCHNPO7",40,0)
 I ($P(^PRC(441.2,+X,0),U,4)="")&(X=$P(^PRC(441.2,+X,0),U,1)) D EN104 K A,X Q
"RTN","PRCHNPO7",41,0)
 S:'$D(PRC("SITE")) PRC("SITE")=+^PRC(442,DA(1),0)
"RTN","PRCHNPO7",42,0)
 I $G(PRCSAVE)="G"&(X'=$P(^PRC(441.2,+X,0),U,1)) D EN102 K A,X Q
"RTN","PRCHNPO7",43,0)
 ;
"RTN","PRCHNPO7",44,0)
 I $G(PRCSAVE)="S"&(X=$P(^PRC(441.2,+X,0),U,1))&($P(^PRC(443.6,DA(1),2,DA,0),U,5)="") D EN103 K A,X Q
"RTN","PRCHNPO7",45,0)
 ;
"RTN","PRCHNPO7",46,0)
 S PRCHCI=+$P(^PRC(443.6,DA(1),2,DA,0),U,5),PRCHCPO=DA(1) I $D(^PRC(441,+PRCHCI,0)) D EN8^PRCHCRD1
"RTN","PRCHNPO7",47,0)
 S:$D(PRCHSAVX) X=PRCHSAVX K PRCHSAVX
"RTN","PRCHNPO7",48,0)
 Q
"RTN","PRCHNPO7",49,0)
 ;
"RTN","PRCHNPO7",50,0)
EN101 ;Check Request for Quotations - check FSC/PSC, field #4, file #444.
"RTN","PRCHNPO7",51,0)
 I '$D(PRCSAVE)&($P(^PRC(444,DA(1),2,DA,0),U,4)'="")&(X'=$P(^PRC(441.2,+X,0),U,1)) D EN102 K A,X Q
"RTN","PRCHNPO7",52,0)
 ;
"RTN","PRCHNPO7",53,0)
 I ($P(^PRC(441.2,+X,0),U,4)="")&(X=$P(^PRC(441.2,+X,0),U,1)) D EN104 K A,X Q
"RTN","PRCHNPO7",54,0)
 I $G(PRCSAVE)="G"&(X'=$P(^PRC(441.2,+X,0),U,1)) D EN102 K A,X Q
"RTN","PRCHNPO7",55,0)
 ;
"RTN","PRCHNPO7",56,0)
 I $G(PRCSAVE)="S"&(X=$P(^PRC(441.2,+X,0),U,1)) D EN103 K A,X Q
"RTN","PRCHNPO7",57,0)
 ;
"RTN","PRCHNPO7",58,0)
 S PRCHCI=+$P(^PRC(444,DA(1),2,DA,0),U,5),PRCHCPO=DA(1) I $D(^PRC(441,+PRCHCI,0)) D EN8^PRCHCRD1
"RTN","PRCHNPO7",59,0)
 S:$D(PRCHSAVX) X=PRCHSAVX K PRCHSAVX
"RTN","PRCHNPO7",60,0)
 Q
"RTN","PRCHNPO7",61,0)
 ;
"RTN","PRCHNPO7",62,0)
EN102 ;Stop assignment of a PSC to an item.
"RTN","PRCHNPO7",63,0)
 S A(1)="This is a Product Service Code - Not allowed on ITEMS!!"
"RTN","PRCHNPO7",64,0)
 S A(2,"F")="!"
"RTN","PRCHNPO7",65,0)
 D EN^DDIOL(.A)
"RTN","PRCHNPO7",66,0)
 Q
"RTN","PRCHNPO7",67,0)
 ;
"RTN","PRCHNPO7",68,0)
EN103 ;Stop assignment of an FSC to a service.
"RTN","PRCHNPO7",69,0)
 S A(1)="This is a Federal Supply Classification Code - Not allowed on SERVICES!!"
"RTN","PRCHNPO7",70,0)
 S A(2,"F")="!"
"RTN","PRCHNPO7",71,0)
 D EN^DDIOL(.A)
"RTN","PRCHNPO7",72,0)
 Q
"RTN","PRCHNPO7",73,0)
 ;
"RTN","PRCHNPO7",74,0)
EN104 ;Stop user if commodity code is missing.
"RTN","PRCHNPO7",75,0)
 S A(1)="Commodity Code missing on this Federal Supply Classification--Required for LOG code sheets!"
"RTN","PRCHNPO7",76,0)
 S A(2,"F")="!"
"RTN","PRCHNPO7",77,0)
 D EN^DDIOL(.A)
"RTN","PRCHNPO7",78,0)
 Q
"RTN","PRCHNPO7",79,0)
 ;
"RTN","PRCHNPO7",80,0)
EN105 ;Stop a PO if a line item does not contain an FSC or PSC. This tag is
"RTN","PRCHNPO7",81,0)
 ;called from the routine PRCHNP04. Do not clean up variables here.
"RTN","PRCHNPO7",82,0)
 ;This check is for all POs that may be required by FPDS. PRC*5.1*100.
"RTN","PRCHNPO7",83,0)
 I $P(^PRC(442,PRCHPO,1),U,7)]"" D
"RTN","PRCHNPO7",84,0)
 . S PRCHITM=0 F  S PRCHITM=$O(^PRC(442,PRCHPO,2,PRCHITM)) Q:'PRCHITM  I $P($G(^PRC(442,PRCHPO,2,PRCHITM,2)),U,3)="" D EN^DDIOL("Line item "_PRCHITM_" on this PO does not contain an FSC or PSC.","","!!?5") S ERROR=1
"RTN","PRCHNPO7",85,0)
 ;End of changes for PRC*5.1*79
"RTN","PRCHNPO7",86,0)
 Q
"RTN","PRCHNPO7",87,0)
 ;
"RTN","PRCHNPO7",88,0)
EN106 ;PRC*5.1*100: stop amended PO with line items lacking an FSC or PSC.
"RTN","PRCHNPO7",89,0)
 I $P(^PRC(443.6,PRCHPO,1),U,7)]"" D
"RTN","PRCHNPO7",90,0)
 . S PRCHITM=0 F  S PRCHITM=$O(^PRC(443.6,PRCHPO,2,PRCHITM)) Q:'PRCHITM  I $P($G(^PRC(443.6,PRCHPO,2,PRCHITM,2)),U,3)="" D EN^DDIOL("Line item "_PRCHITM_" on this PO does not contain an FSC or PSC.","","!!?5") S ERROR=1
"RTN","PRCHNPO7",91,0)
 Q
"RTN","PRCHNPO7",92,0)
 ;
"RTN","PRCHNPO7",93,0)
EN2 ;IF 'ESTIMATED P.O.' MOVE VERBAGE INTO COMMENTS
"RTN","PRCHNPO7",94,0)
 D EN2A
"RTN","PRCHNPO7",95,0)
 Q:'$D(^PRC(442,PRCHPO,7))  Q:$P(^(7),U,3)'="Y"  S WX="*** ESTIMATED PURCHASE ORDER ***" I $D(^PRC(442,PRCHPO,4,1,0)),^(0)[WX K WX Q
"RTN","PRCHNPO7",96,0)
 S WX=WX_"   ",PRCH="^PRC(442,PRCHPO,4," D WORD^PRCHUTL K PRCH
"RTN","PRCHNPO7",97,0)
 Q
"RTN","PRCHNPO7",98,0)
 ;
"RTN","PRCHNPO7",99,0)
EN2A ;CHECK DELIVERY SCHEDULES-QUANTITY DELIVERED MUST BE >0
"RTN","PRCHNPO7",100,0)
 N NUM,J,K,DA
"RTN","PRCHNPO7",101,0)
 S NUM=$P(^PRC(442,PRCHPO,0),U)
"RTN","PRCHNPO7",102,0)
 I $D(^PRC(442.8,"AC",NUM)) D
"RTN","PRCHNPO7",103,0)
 . F J=0:0 S J=$O(^PRC(442.8,"AC",NUM,J)) Q:J'>0  D
"RTN","PRCHNPO7",104,0)
 . . F K=0:0 S K=$O(^PRC(442.8,"AC",NUM,J,K)) Q:K'>0  D
"RTN","PRCHNPO7",105,0)
 . . . I $P(^PRC(442.8,K,0),U,5)'>0 S DIK="^PRC(442.8,",DA=K D ^DIK K DIK
"RTN","PRCHNPO7",106,0)
 Q
"RTN","PRCHNPO7",107,0)
EN3 ;COMPLETE DEPOT/GSA PUSH ORDERS
"RTN","PRCHNPO7",108,0)
 S I=$P(^PRC(442,PRCHPO,0),U,15)
"RTN","PRCHNPO7",109,0)
 W !!,"Total Dollar Amount: "_I_" //" R X:DTIME S:'$T X="^" S:X="" X=I I X["^" S X=1 G EN31
"RTN","PRCHNPO7",110,0)
 I X=""!(X=0) G EN30
"RTN","PRCHNPO7",111,0)
 I X["?" W !!,"You can either enter the total dollar amount for the entire PUSH, or just the",!,"dollar amount for this part (regular, subsistence or drugs).  This is just",!,"used to update the P.O.register." G EN3
"RTN","PRCHNPO7",112,0)
 S:X["$" X=$P(X,"$",2) I X'?.N.1".".2N!(X>9999999.99)!(X<1) W $C(7),"??" G EN3
"RTN","PRCHNPO7",113,0)
 S $P(^PRC(442,PRCHPO,0),U,15)=X
"RTN","PRCHNPO7",114,0)
 ;
"RTN","PRCHNPO7",115,0)
EN30 S X=1,%A="Complete this Requisition ",%B="This action will change the status to 'Transaction Complete'.",%=1 D ^PRCFYN I %=1 S X=40
"RTN","PRCHNPO7",116,0)
 ;
"RTN","PRCHNPO7",117,0)
EN31 S DA=PRCHPO D ENS^PRCHSTAT
"RTN","PRCHNPO7",118,0)
 Q
"RTN","PRCHNPO7",119,0)
 ;
"RTN","PRCHNPO7",120,0)
EN6 ;FILE 442, SKU #9.4
"RTN","PRCHNPO7",121,0)
 D VEN Q:'$D(X)!($P(^PRC(442,DA(1),2,DA,0),U,5)="")
"RTN","PRCHNPO7",122,0)
 S:'$D(PRC("SITE")) PRC("SITE")=$P($P(^PRC(442,DA(1),0),U,1),"-",1) S PRCHCV=$P(^PRC(442,DA(1),1),U,1),PRCHCI=$P(^(2,DA,0),U,5),PRCHCPO=DA(1) D EN10^PRCHCRD1
"RTN","PRCHNPO7",123,0)
 Q
"RTN","PRCHNPO7",124,0)
 ;
"RTN","PRCHNPO7",125,0)
EN7 ;FILE 442, UNIT CONVERSION FACTOR #9.7
"RTN","PRCHNPO7",126,0)
 D VEN Q:'$D(X)!($P(^PRC(442,DA(1),2,DA,0),U,5)="")
"RTN","PRCHNPO7",127,0)
 S:'$D(PRC("SITE")) PRC("SITE")=+^PRC(442,DA(1),0) S PRCHCV=+$P(^PRC(442,DA(1),1),U,1),PRCHCI=+$P(^(2,DA,0),U,5),PRCHCPO=DA(1) D EN11^PRCHCRD1
"RTN","PRCHNPO7",128,0)
 Q
"RTN","PRCHNPO7",129,0)
 ;
"RTN","PRCHNPO7",130,0)
VEN I $S('$D(^PRC(442,DA(1),1)):1,$P(^(1),U,1)="":1,1:0) W !!,"Vendor must be entered before items ! ",$C(7) K X
"RTN","PRCHNPO7",131,0)
 Q
"RTN","PRCHNPO7",132,0)
 ;
"RTN","PRCHNPO7",133,0)
VENA I $S('$D(^PRC(442,DA,1)):1,$P(^(1),U,1)="":1,1:0) W !!,"Vendor must be entered before items ! ",$C(7) K X
"RTN","PRCHNPO7",134,0)
 Q
"RTN","PRCHNPO7",135,0)
 ;
"RTN","PRCHNPO7",136,0)
VEN1 I $S('$D(^PRC(443.6,DA(1),1)):1,$P(^(1),U,1)="":1,1:0) W !!,"Vendor must be entered before items ! ",$C(7) K X
"RTN","PRCHNPO7",137,0)
 Q
"RTN","PRCHNPO7",138,0)
 ;
"RTN","PRCHNPO7",139,0)
VEN1A I $S('$D(^PRC(443.6,DA,1)):1,$P(^(1),U,1)="":1,1:0) W !!,"Vendor must be entered before items ! ",$C(7) K X
"RTN","PRCHNPO7",140,0)
 Q
"RTN","PRCHNPO7",141,0)
 ;
"RTN","PRCHNPO7",142,0)
 ;
"RTN","PRCHNPO7",143,0)
 ;
"RTN","PRCHNPO7",144,0)
SUPBOC(QUIETLY) ;stmts.to compute pre-implied BOC, moved from template PRCH2138 into this routine and also called in BOC input transform
"RTN","PRCHNPO7",145,0)
 N PRCHIDA,SPFCP,PRCHBOCC,ACCT
"RTN","PRCHNPO7",146,0)
 S:$G(QUIETLY)=-1 X=$P($G(^PRC(442,DA(1),2,DA,0)),U,4)
"RTN","PRCHNPO7",147,0)
 D VEN Q:'$D(X) ""
"RTN","PRCHNPO7",148,0)
 S PRCHIDA=+$P(^PRC(442,DA(1),2,DA,0),U,5),SPFCP=+$P(^PRC(442,DA(1),0),U,19)
"RTN","PRCHNPO7",149,0)
 I SPFCP=2 D
"RTN","PRCHNPO7",150,0)
 . S PRCHN("SFC")=SPFCP,ACCT=$$ACCT^PRCPUX1($E($$NSN^PRCPUX1(PRCHIDA),1,4))
"RTN","PRCHNPO7",151,0)
 . D  ;:$D(ACCT)
"RTN","PRCHNPO7",152,0)
 .  .  S PRCHBOCC=$P($G(^PRCD(420.2,$S(ACCT=1:2697,ACCT=2:2698,ACCT=3:2699,ACCT=6:2699,ACCT=8:2696,1:2699),0)),U)
"RTN","PRCHNPO7",153,0)
 .  .  I PRCHBOCC S $P(^PRC(442,DA(1),2,DA,0),U,4)=PRCHBOCC D
"RTN","PRCHNPO7",154,0)
 .  .  .  I PRCHBOCC'=X,PRCHBOCC W:'$G(QUIETLY) !,?5,"BOC must be ",PRCHBOCC,!,?5,"For a supply fund order, a BOC ",X," is invalid.",! S X=PRCHBOCC
"RTN","PRCHNPO7",155,0)
 Q X
"RTN","PRCHNPO7",156,0)
 ;
"RTN","PRCHNPO7",157,0)
 ;
"RTN","PRCHNPO7",158,0)
 ;
"RTN","PRCHNPO7",159,0)
EN8 ;FILE 442, ITEM #40; BOC #3.5  -- Z0 must = BOC on entry
"RTN","PRCHNPO7",160,0)
 N DIC D VEN Q:'$D(X)
"RTN","PRCHNPO7",161,0)
 S DIC="^PRCD(420.1,"_Z0_",1,",DIC(0)="QEMZ"
"RTN","PRCHNPO7",162,0)
 I $P(^PRC(442,DA(1),0),U,19)'=2 D
"RTN","PRCHNPO7",163,0)
 . D ^DIC K:Y<0 X K Z0
"RTN","PRCHNPO7",164,0)
 . I $D(X) S X=$P(Y(0,0),"^",1) D
"RTN","PRCHNPO7",165,0)
 . . S PRCHBOC=+Y ;D EN2^PRCHNPO8
"RTN","PRCHNPO7",166,0)
 . . W !,X
"RTN","PRCHNPO7",167,0)
 Q
"RTN","PRCHNPO7",168,0)
 ;
"RTN","PRCHNPO7",169,0)
 ;
"RTN","PRCHNPO7",170,0)
EN88 ;FILE 442, EST. SHIPPING BOC #13.05  -- Z0 must = BOC on entry
"RTN","PRCHNPO7",171,0)
 N DIC D VENA Q:'$D(X)
"RTN","PRCHNPO7",172,0)
 S DIC="^PRCD(420.1,"_Z0_",1,",DIC(0)="QEMZ" D ^DIC K:Y<0 X K Z0
"RTN","PRCHNPO7",173,0)
 I $D(X) S X=$P(Y(0,0),"^",1) W !,X
"RTN","PRCHNPO7",174,0)
 Q
"RTN","PRCHNPO7",175,0)
 ;
"RTN","PRCHNPO7",176,0)
EN9 ;CHECK FOR PAYMENT FIELDS AND OTHER FIELDS IN VENDOR FILE
"RTN","PRCHNPO7",177,0)
 ;CALLED FROM FILE 442 INPUT TEMPLATES.
"RTN","PRCHNPO7",178,0)
 ;FLAG --is set to 1 in template when certain VENDOR conditions are met
"RTN","PRCHNPO7",179,0)
 S PRCHOV7=$G(^PRC(440,+^PRC(442,D0,1),7)) G:PRCHOV7="" EXIT
"RTN","PRCHNPO7",180,0)
 I $P(PRCHOV7,U,3)]"",($P(PRCHOV7,U,7)]""),($P(PRCHOV7,U,8)]""),($P(PRCHOV7,U,9)]""),$P(PRCHOV3,U,11)]"",$P(PRCHOV3,U,14)]"",$P(PRCHOV3,U,13)]"",FLAG S Y="@20" G EXIT
"RTN","PRCHNPO7",181,0)
 S VEN=+^PRC(442,D0,1),%X="^PRC(440,VEN,",%Y="^PRC(440.3,VEN," D %XY^%RCR K VEN
"RTN","PRCHNPO7",182,0)
EXIT Q
"RTN","PRCHNPO7",183,0)
 ;
"RTN","PRCHNPO7",184,0)
EN12 ;UPDATE NATIONAL DRUG CODE #9.3
"RTN","PRCHNPO7",185,0)
 D VEN Q:'$D(X)!($P(^PRC(442,DA(1),2,DA,0),U,5)="")
"RTN","PRCHNPO7",186,0)
 S:'$D(PRC("SITE")) PRC("SITE")=$P($P(^PRC(442,DA(1),0),U,1),"-",1) S PRCHCV=$P(^PRC(442,DA(1),1),U,1),PRCHCI=$P(^(2,DA,0),U,5),PRCHCPO=DA(1) D EN12^PRCHCRD1
"RTN","PRCHNPO7",187,0)
 Q
"RTN","PRCHNPO7",188,0)
 ;
"RTN","PRCHNPO7",189,0)
EN13 ;FILE 443.6, ITEM #40;BOC #3.5, EST. SHIPPING BOC #13.05
"RTN","PRCHNPO7",190,0)
 D VEN1 Q:'$D(X)  S DIC="^PRCD(420.1,"_Z0_",1,",DIC(0)="QEMZ" D ^DIC K:Y<0 X K DIC,Z0 I $D(X) S X=$P(Y(0,0),"^",1) W !,X
"RTN","PRCHNPO7",191,0)
 Q
"RTN","PRCHNPO7",192,0)
EN133 ;FILE 443.6, EST. SHIPPING BOC #13.05
"RTN","PRCHNPO7",193,0)
 D VEN1A Q:'$D(X)  S DIC="^PRCD(420.1,"_Z0_",1,",DIC(0)="QEMZ" D ^DIC K:Y<0 X K DIC,Z0 I $D(X) S X=$P(Y(0,0),"^",1) W !,X
"RTN","PRCHNPO7",194,0)
 Q
"VER")
8.0^22.0
"BLD",4973,6)
^84
**END**
**END**
