EMERGENCY Released PRCA*4.5*205 SEQ #178
Extracted from mail message
**KIDS**:PRCA*4.5*205^

**INSTALL NAME**
PRCA*4.5*205
"BLD",5077,0)
PRCA*4.5*205^ACCOUNTS RECEIVABLE^0^3030923^y
"BLD",5077,1,0)
^^7^7^3030923^
"BLD",5077,1,1,0)
This patch creates a header record for the AR electronic message
"BLD",5077,1,2,0)
which gets transmitted to the OIG.
"BLD",5077,1,3,0)
 
"BLD",5077,1,4,0)
The header record will include the following:
"BLD",5077,1,5,0)
1. The total number of extract messages that will be transmitted to Austin.
"BLD",5077,1,6,0)
2. The sequential message number of the message itself
"BLD",5077,1,7,0)
   (i.e., "message 5 of 21").
"BLD",5077,4,0)
^9.64PA^^
"BLD",5077,"KRN",0)
^9.67PA^8989.52^19
"BLD",5077,"KRN",.4,0)
.4
"BLD",5077,"KRN",.401,0)
.401
"BLD",5077,"KRN",.402,0)
.402
"BLD",5077,"KRN",.403,0)
.403
"BLD",5077,"KRN",.5,0)
.5
"BLD",5077,"KRN",.84,0)
.84
"BLD",5077,"KRN",3.6,0)
3.6
"BLD",5077,"KRN",3.8,0)
3.8
"BLD",5077,"KRN",9.2,0)
9.2
"BLD",5077,"KRN",9.8,0)
9.8
"BLD",5077,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5077,"KRN",9.8,"NM",1,0)
RCRJROIG^^0^B25452982
"BLD",5077,"KRN",9.8,"NM","B","RCRJROIG",1)

"BLD",5077,"KRN",19,0)
19
"BLD",5077,"KRN",19.1,0)
19.1
"BLD",5077,"KRN",101,0)
101
"BLD",5077,"KRN",409.61,0)
409.61
"BLD",5077,"KRN",771,0)
771
"BLD",5077,"KRN",870,0)
870
"BLD",5077,"KRN",8989.51,0)
8989.51
"BLD",5077,"KRN",8989.52,0)
8989.52
"BLD",5077,"KRN",8994,0)
8994
"BLD",5077,"KRN","B",.4,.4)

"BLD",5077,"KRN","B",.401,.401)

"BLD",5077,"KRN","B",.402,.402)

"BLD",5077,"KRN","B",.403,.403)

"BLD",5077,"KRN","B",.5,.5)

"BLD",5077,"KRN","B",.84,.84)

"BLD",5077,"KRN","B",3.6,3.6)

"BLD",5077,"KRN","B",3.8,3.8)

"BLD",5077,"KRN","B",9.2,9.2)

"BLD",5077,"KRN","B",9.8,9.8)

"BLD",5077,"KRN","B",19,19)

"BLD",5077,"KRN","B",19.1,19.1)

"BLD",5077,"KRN","B",101,101)

"BLD",5077,"KRN","B",409.61,409.61)

"BLD",5077,"KRN","B",771,771)

"BLD",5077,"KRN","B",870,870)

"BLD",5077,"KRN","B",8989.51,8989.51)

"BLD",5077,"KRN","B",8989.52,8989.52)

"BLD",5077,"KRN","B",8994,8994)

"BLD",5077,"QUES",0)
^9.62^^
"BLD",5077,"REQB",0)
^9.611^1^1
"BLD",5077,"REQB",1,0)
PRCA*4.5*203^1
"BLD",5077,"REQB","B","PRCA*4.5*203",1)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
205^3030923
"PKG",142,22,1,"PAH",1,1,0)
^^7^7^3030923
"PKG",142,22,1,"PAH",1,1,1,0)
This patch creates a header record for the AR electronic message
"PKG",142,22,1,"PAH",1,1,2,0)
which gets transmitted to the OIG.
"PKG",142,22,1,"PAH",1,1,3,0)
 
"PKG",142,22,1,"PAH",1,1,4,0)
The header record will include the following:
"PKG",142,22,1,"PAH",1,1,5,0)
1. The total number of extract messages that will be transmitted to Austin.
"PKG",142,22,1,"PAH",1,1,6,0)
2. The sequential message number of the message itself
"PKG",142,22,1,"PAH",1,1,7,0)
   (i.e., "message 5 of 21").
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","RCRJROIG")
0^1^B25452982
"RTN","RCRJROIG",1,0)
RCRJROIG ;WISC/RFJ-send data for oig extract ;1 Jul 99
"RTN","RCRJROIG",2,0)
 ;;4.5;Accounts Receivable;**103,174,203,205**;Mar 20, 1995
"RTN","RCRJROIG",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJROIG",4,0)
 Q
"RTN","RCRJROIG",5,0)
 ;
"RTN","RCRJROIG",6,0)
 ;
"RTN","RCRJROIG",7,0)
NONMCCF(DATEEND) ;  build the non-mccf bills for user report and submission to oig
"RTN","RCRJROIG",8,0)
 N BILLDA,DATE,DATA7,OTHER,PRINCPAL
"RTN","RCRJROIG",9,0)
 S BILLDA=0 F  S BILLDA=$O(^PRCA(430,BILLDA)) Q:'BILLDA  D
"RTN","RCRJROIG",10,0)
 .   ;  if already stored, then it is a current receivable
"RTN","RCRJROIG",11,0)
 .   I $D(^TMP($J,"RCRJROIG",BILLDA)) Q
"RTN","RCRJROIG",12,0)
 .   ;  calculate principal and other (int + admin) balance
"RTN","RCRJROIG",13,0)
 .   S DATA7=$G(^PRCA(430,BILLDA,7))
"RTN","RCRJROIG",14,0)
 .   S PRINCPAL=+$P(DATA7,"^")
"RTN","RCRJROIG",15,0)
 .   S OTHER=$P(DATA7,"^",2)+$P(DATA7,"^",3)+$P(DATA7,"^",4)+$P(DATA7,"^",5)
"RTN","RCRJROIG",16,0)
 .   ;  in some bills, the principal and other balance may cancel
"RTN","RCRJROIG",17,0)
 .   ;  each other.  for example principal .08 + interest -.08 = 0
"RTN","RCRJROIG",18,0)
 .   I (PRINCPAL+OTHER)'>0 Q
"RTN","RCRJROIG",19,0)
 .   ;  store the data for submission to oig
"RTN","RCRJROIG",20,0)
 .   S ^TMP($J,"RCRJROIG",BILLDA)=PRINCPAL_"^"_OTHER
"RTN","RCRJROIG",21,0)
 .   ;  store the data for the user report (only if bill activated)
"RTN","RCRJROIG",22,0)
 .   S DATE=+$P($P($G(^PRCA(430,BILLDA,6)),"^",21),".") I 'DATE Q
"RTN","RCRJROIG",23,0)
 .   S ^TMP($J,"RCRJRCOLREPORT",DATE,BILLDA)=PRINCPAL_"^"_OTHER
"RTN","RCRJROIG",24,0)
 Q
"RTN","RCRJROIG",25,0)
 ;
"RTN","RCRJROIG",26,0)
 ;
"RTN","RCRJROIG",27,0)
OIG(DATEEND) ;  send data to the OIG
"RTN","RCRJROIG",28,0)
 N BILLDA,COUNT,DATA,DATA0,FUND,FYQ,OIGDATA,SEQUENCE,SITE,TOTALAMT
"RTN","RCRJROIG",29,0)
 N TOTALCNT,TOTALMSG,X,X1
"RTN","RCRJROIG",30,0)
 ;
"RTN","RCRJROIG",31,0)
 ;  get previous fiscal year quarter for mail message header
"RTN","RCRJROIG",32,0)
 S FYQ=$E(DATEEND,4,5),FYQ=$S(FYQ<4:1,FYQ<7:2,FYQ<10:3,1:4)
"RTN","RCRJROIG",33,0)
 S SITE=$$SITE^RCMSITE()
"RTN","RCRJROIG",34,0)
 ;
"RTN","RCRJROIG",35,0)
 ;  calculate the number of messages to be sent
"RTN","RCRJROIG",36,0)
 S (X,X1)=0 F  S X=$O(^TMP($J,"RCRJROIG",X)) Q:'X  S X1=X1+1
"RTN","RCRJROIG",37,0)
 S TOTALMSG=X1\272 I X1#272 S TOTALMSG=TOTALMSG+1
"RTN","RCRJROIG",38,0)
        ;
"RTN","RCRJROIG",39,0)
 ;  build the extract for oig
"RTN","RCRJROIG",40,0)
 S COUNT=0     ;  used to count bills to be sent in a single mail msg
"RTN","RCRJROIG",41,0)
 S SEQUENCE=0  ;  used to count mail messages sent (in mail subject)
"RTN","RCRJROIG",42,0)
 S TOTALCNT=0  ;  used to count total bills sent all mail messages
"RTN","RCRJROIG",43,0)
 S TOTALAMT=0  ;  used to calculate total dollars all mail messages
"RTN","RCRJROIG",44,0)
 K ^TMP($J,"RCRJROIGMM")
"RTN","RCRJROIG",45,0)
 S BILLDA=0 F  S BILLDA=$O(^TMP($J,"RCRJROIG",BILLDA)) Q:'BILLDA  D
"RTN","RCRJROIG",46,0)
 .   S DATA=^TMP($J,"RCRJROIG",BILLDA)
"RTN","RCRJROIG",47,0)
 .   S DATA0=^PRCA(430,BILLDA,0)
"RTN","RCRJROIG",48,0)
 .   ;  bill number, position 1-11
"RTN","RCRJROIG",49,0)
 .   S OIGDATA=$$LJ^XLFSTR($P(DATA0,"^"),11)
"RTN","RCRJROIG",50,0)
 .   ;  category, position 12-36
"RTN","RCRJROIG",51,0)
 .   S OIGDATA=OIGDATA_$$LJ^XLFSTR($E($P($G(^PRCA(430.2,+$P(DATA0,"^",2),0)),"^"),1,25),25)
"RTN","RCRJROIG",52,0)
 .   ;  status, position 37-56
"RTN","RCRJROIG",53,0)
 .   S OIGDATA=OIGDATA_$$LJ^XLFSTR($E($P($G(^PRCA(430.3,+$P(DATA0,"^",8),0)),"^"),1,20),20)
"RTN","RCRJROIG",54,0)
 .   ;  principal balance, position 57-65 (example 000000110 for 1.10)
"RTN","RCRJROIG",55,0)
 .   S OIGDATA=OIGDATA_$TR($J($P(DATA,"^"),10,2)," .","0")
"RTN","RCRJROIG",56,0)
 .   ;  date status last updated, position 66-76 (example APR 08,1999)
"RTN","RCRJROIG",57,0)
 .   S OIGDATA=OIGDATA_$$DATE($P(DATA0,"^",14))
"RTN","RCRJROIG",58,0)
 .   ;  fms fund, position 77-82
"RTN","RCRJROIG",59,0)
 .   S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJROIG",60,0)
 .   S FUND=$$ADJFUND^RCRJRCO(FUND) ; may delete this line after 10/1/03
"RTN","RCRJROIG",61,0)
 .   S OIGDATA=OIGDATA_$J(FUND,6)
"RTN","RCRJROIG",62,0)
 .   ;  revenue source code, position 83-86
"RTN","RCRJROIG",63,0)
 .   S OIGDATA=OIGDATA_$J($$GETRSC(BILLDA,FUND),4)
"RTN","RCRJROIG",64,0)
 .   ;  general ledger account number, position 87-90
"RTN","RCRJROIG",65,0)
 .   S OIGDATA=OIGDATA_$J($P(DATA,"^",3),4)
"RTN","RCRJROIG",66,0)
 .   ;  date bill entered, position 91-101 (example APR 08,1999)
"RTN","RCRJROIG",67,0)
 .   S OIGDATA=OIGDATA_$$DATE($P(DATA0,"^",10))
"RTN","RCRJROIG",68,0)
 .   ;  interest + admin balance, position 102-110
"RTN","RCRJROIG",69,0)
 .   S OIGDATA=OIGDATA_$TR($J($P(DATA,"^",2),10,2)," .","0")_"$"
"RTN","RCRJROIG",70,0)
 .   ;
"RTN","RCRJROIG",71,0)
 .   ;  total count and dollars for bills sent
"RTN","RCRJROIG",72,0)
 .   S TOTALCNT=TOTALCNT+1
"RTN","RCRJROIG",73,0)
 .   S TOTALAMT=TOTALAMT+$P(DATA,"^")
"RTN","RCRJROIG",74,0)
 .   ;
"RTN","RCRJROIG",75,0)
 .   ;  store data for transmission
"RTN","RCRJROIG",76,0)
 .   S COUNT=COUNT+1
"RTN","RCRJROIG",77,0)
 .   S ^TMP($J,"RCRJROIGMM",COUNT)=OIGDATA
"RTN","RCRJROIG",78,0)
 .   ;  only send message with 272 bills
"RTN","RCRJROIG",79,0)
 .   I COUNT'=272 Q
"RTN","RCRJROIG",80,0)
 .   ;  if there are no more bills, do not send message until the
"RTN","RCRJROIG",81,0)
 .   ;  totals are placed at the end
"RTN","RCRJROIG",82,0)
 .   I '$O(^TMP($J,"RCRJROIG",BILLDA)) Q
"RTN","RCRJROIG",83,0)
 .   ;
"RTN","RCRJROIG",84,0)
 .   ;  send current code sheets
"RTN","RCRJROIG",85,0)
 .   S SEQUENCE=SEQUENCE+1
"RTN","RCRJROIG",86,0)
 .   D MAILIT(SITE,FYQ,SEQUENCE)
"RTN","RCRJROIG",87,0)
 .   S COUNT=0
"RTN","RCRJROIG",88,0)
 .   K ^TMP($J,"RCRJROIGMM")
"RTN","RCRJROIG",89,0)
 ;
"RTN","RCRJROIG",90,0)
 ;  mail last message with totals at the end
"RTN","RCRJROIG",91,0)
 S COUNT=COUNT+1
"RTN","RCRJROIG",92,0)
 S ^TMP($J,"RCRJROIGMM",COUNT)="END OF TRANSMISSION FOR SITE# "_SITE_":  TOTAL RECORDS: "_TOTALCNT_"  TOTAL AMOUNT: "_TOTALAMT
"RTN","RCRJROIG",93,0)
 S SEQUENCE=SEQUENCE+1
"RTN","RCRJROIG",94,0)
 D MAILIT(SITE,FYQ,SEQUENCE)
"RTN","RCRJROIG",95,0)
 ;
"RTN","RCRJROIG",96,0)
 K ^TMP($J,"RCRJROIGMM")
"RTN","RCRJROIG",97,0)
 K ^TMP($J,"RCRJROIG")
"RTN","RCRJROIG",98,0)
 Q
"RTN","RCRJROIG",99,0)
 ;
"RTN","RCRJROIG",100,0)
 ;
"RTN","RCRJROIG",101,0)
MAILIT(SITE,FYQ,SEQUENCE) ;  send code sheets to oig
"RTN","RCRJROIG",102,0)
 N %,%H,%Z,X,XCNP,XMDUZ,XMSCR,XMSUB,XMY,XMZ,Y
"RTN","RCRJROIG",103,0)
 ;
"RTN","RCRJROIG",104,0)
 ;  set a header record in each file to be transmitted
"RTN","RCRJROIG",105,0)
 S ^TMP($J,"RCRJROIGMM",.5)="OH$"_$$RJ^XLFSTR(SEQUENCE,5,0)_"$"_$$RJ^XLFSTR(TOTALMSG,5,0)_"$|"
"RTN","RCRJROIG",106,0)
 ;
"RTN","RCRJROIG",107,0)
 I TOTALCNT=0 S XMY("G.RC AR DATA COLLECTOR")=""
"RTN","RCRJROIG",108,0)
 S XMY("XXX@Q-OIG.VA.GOV")=""
"RTN","RCRJROIG",109,0)
 S XMDUZ="AR PACKAGE"
"RTN","RCRJROIG",110,0)
 S %H=$H D YX^%DTC
"RTN","RCRJROIG",111,0)
 S XMSUB=SITE_"/BILL/"_FYQ_"/SEQ#: "_SEQUENCE_"/"_Y
"RTN","RCRJROIG",112,0)
 S XMTEXT="^TMP($J,""RCRJROIGMM"","
"RTN","RCRJROIG",113,0)
 D ^XMD
"RTN","RCRJROIG",114,0)
 Q
"RTN","RCRJROIG",115,0)
 ;
"RTN","RCRJROIG",116,0)
 ;
"RTN","RCRJROIG",117,0)
DATE(DATE) ;  format date
"RTN","RCRJROIG",118,0)
 ;  example input=2990408, output=APR 08,1999
"RTN","RCRJROIG",119,0)
 I DATE D
"RTN","RCRJROIG",120,0)
 .   S Y=DATE D DD^%DT
"RTN","RCRJROIG",121,0)
 .   S DATE=$E(Y,1,3)_" "_$E(DATE,6,7)_","_(1700+$E(DATE,1,3))
"RTN","RCRJROIG",122,0)
 Q $$LJ^XLFSTR(DATE,11)
"RTN","RCRJROIG",123,0)
 ;
"RTN","RCRJROIG",124,0)
 ;
"RTN","RCRJROIG",125,0)
GETRSC(BILLDA,FUND) ;  return the rsc for a bill
"RTN","RCRJROIG",126,0)
 I $P(FUND,".")'=5287,FUND'=4032 Q $P($G(^PRCA(430,BILLDA,11)),"^",6)
"RTN","RCRJROIG",127,0)
 ;  check missing patient for reimbursable health insurance
"RTN","RCRJROIG",128,0)
 I $P(^PRCA(430,BILLDA,0),"^",2)=9,'$P(^PRCA(430,BILLDA,0),"^",7) Q "    "
"RTN","RCRJROIG",129,0)
 Q $$CALCRSC^RCXFMSUR(BILLDA)
"VER")
8.0^22
**END**
**END**
