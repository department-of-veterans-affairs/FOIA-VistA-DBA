Released SD*5.3*357 SEQ #322
Extracted from mail message
**KIDS**:SD*5.3*357^

**INSTALL NAME**
SD*5.3*357
"BLD",5489,0)
SD*5.3*357^SCHEDULING^0^3050110^y
"BLD",5489,1,0)
^^4^4^3040426^
"BLD",5489,1,1,0)
THIS PATCH ADDRESS A PROBLEM WITH THE SCRPW SC VETS AWAITING APPTS 
"BLD",5489,1,2,0)
REPORT. IF A PATIENT HAS NO DATE ENTERED IN THE PATIENT FILE THIS PATIENT 
"BLD",5489,1,3,0)
IS INCORRECTLY BEING REPORTED ON THIS REPORT. A CORRECTION WAS MADE TO 
"BLD",5489,1,4,0)
CORRECT THIS ERROR.
"BLD",5489,4,0)
^9.64PA^^
"BLD",5489,"ABPKG")
n
"BLD",5489,"KRN",0)
^9.67PA^8989.52^19
"BLD",5489,"KRN",.4,0)
.4
"BLD",5489,"KRN",.401,0)
.401
"BLD",5489,"KRN",.402,0)
.402
"BLD",5489,"KRN",.403,0)
.403
"BLD",5489,"KRN",.5,0)
.5
"BLD",5489,"KRN",.84,0)
.84
"BLD",5489,"KRN",3.6,0)
3.6
"BLD",5489,"KRN",3.8,0)
3.8
"BLD",5489,"KRN",9.2,0)
9.2
"BLD",5489,"KRN",9.8,0)
9.8
"BLD",5489,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5489,"KRN",9.8,"NM",1,0)
SCRPW63^^0^B81169858
"BLD",5489,"KRN",9.8,"NM","B","SCRPW63",1)

"BLD",5489,"KRN",19,0)
19
"BLD",5489,"KRN",19.1,0)
19.1
"BLD",5489,"KRN",101,0)
101
"BLD",5489,"KRN",409.61,0)
409.61
"BLD",5489,"KRN",771,0)
771
"BLD",5489,"KRN",870,0)
870
"BLD",5489,"KRN",8989.51,0)
8989.51
"BLD",5489,"KRN",8989.52,0)
8989.52
"BLD",5489,"KRN",8994,0)
8994
"BLD",5489,"KRN","B",.4,.4)

"BLD",5489,"KRN","B",.401,.401)

"BLD",5489,"KRN","B",.402,.402)

"BLD",5489,"KRN","B",.403,.403)

"BLD",5489,"KRN","B",.5,.5)

"BLD",5489,"KRN","B",.84,.84)

"BLD",5489,"KRN","B",3.6,3.6)

"BLD",5489,"KRN","B",3.8,3.8)

"BLD",5489,"KRN","B",9.2,9.2)

"BLD",5489,"KRN","B",9.8,9.8)

"BLD",5489,"KRN","B",19,19)

"BLD",5489,"KRN","B",19.1,19.1)

"BLD",5489,"KRN","B",101,101)

"BLD",5489,"KRN","B",409.61,409.61)

"BLD",5489,"KRN","B",771,771)

"BLD",5489,"KRN","B",870,870)

"BLD",5489,"KRN","B",8989.51,8989.51)

"BLD",5489,"KRN","B",8989.52,8989.52)

"BLD",5489,"KRN","B",8994,8994)

"BLD",5489,"QUES",0)
^9.62^^
"BLD",5489,"REQB",0)
^9.611^1^1
"BLD",5489,"REQB",1,0)
SD*5.3*269^1
"BLD",5489,"REQB","B","SD*5.3*269",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
357^3050110
"PKG",16,22,1,"PAH",1,1,0)
^^4^4^3050110
"PKG",16,22,1,"PAH",1,1,1,0)
THIS PATCH ADDRESS A PROBLEM WITH THE SCRPW SC VETS AWAITING APPTS 
"PKG",16,22,1,"PAH",1,1,2,0)
REPORT. IF A PATIENT HAS NO DATE ENTERED IN THE PATIENT FILE THIS PATIENT 
"PKG",16,22,1,"PAH",1,1,3,0)
IS INCORRECTLY BEING REPORTED ON THIS REPORT. A CORRECTION WAS MADE TO 
"PKG",16,22,1,"PAH",1,1,4,0)
CORRECT THIS ERROR.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SCRPW63")
0^1^B81169858
"RTN","SCRPW63",1,0)
SCRPW63 ;BP-CIOFO/KEITH - SC veterans awaiting appointments (cont.) ; 23 August 2002@20:23
"RTN","SCRPW63",2,0)
 ;;5.3;Scheduling;**267,269,357**;AUG 13, 1993
"RTN","SCRPW63",3,0)
 ;
"RTN","SCRPW63",4,0)
E ;Gather data for patients entered report
"RTN","SCRPW63",5,0)
 N DFN,SDX,SDATE,SD0,SDSCEL,SDEL,SDYR,SDREL,SDTOT,SDSDT,SDLVDT,SDEDT
"RTN","SCRPW63",6,0)
 N SDNAME
"RTN","SCRPW63",7,0)
 D SCEL^SCRPW62(.SDSCEL,SDSCVT)  ;Get eligibility code pointers
"RTN","SCRPW63",8,0)
 S (SDSDT,SDATE)=DT-(10000*SDATES),SDSTOP=0
"RTN","SCRPW63",9,0)
 ;Find the patients entered after date specified
"RTN","SCRPW63",10,0)
 S DFN=0 F  Q:SDSTOP  S DFN=$O(^DPT(DFN)) Q:'DFN  D
"RTN","SCRPW63",11,0)
 .Q:$D(^DPT(DFN,-9))  ;Skip merged records
"RTN","SCRPW63",12,0)
 .I DFN#1000=0 D STOP Q:SDSTOP  ;Check for stop task request
"RTN","SCRPW63",13,0)
 .S SDLVDT=""
"RTN","SCRPW63",14,0)
 .S SD0=$G(^DPT(DFN,0)) Q:'$L(SD0)
"RTN","SCRPW63",15,0)
 .S SDEDT=$P(SD0,U,16) S:SDEDT SDLVDT=SDEDT
"RTN","SCRPW63",16,0)
 .I SDEDT,SDEDT<SDATE Q  ;Date entered < start date
"RTN","SCRPW63",17,0)
 .I 'SDEDT,SDLVDT<SDATE Q  ;No date entered, last valid date < start
"RTN","SCRPW63",18,0)
 .S SDEL=+$G(^DPT(DFN,.36)) Q:'$D(SDSCEL(SDEL))  ;Only SC vets
"RTN","SCRPW63",19,0)
 .Q:+$G(^DPT(DFN,.35))  ;No deceased patients
"RTN","SCRPW63",20,0)
 .Q:$$SCHAPP(DFN)  ;Appointments not cancelled by clinic?
"RTN","SCRPW63",21,0)
 .S SDYR=$$FMDIFF^XLFDT(DT,$S(SDEDT:SDEDT,1:SDLVDT))\365.25  ;Year entered
"RTN","SCRPW63",22,0)
 .S SDEL=SDSCEL(SDEL) D  Q:SDFMT="S"
"RTN","SCRPW63",23,0)
 ..;Record statistics
"RTN","SCRPW63",24,0)
 ..S ^TMP("SCRPW",$J,"STATS",SDYR,SDEL)=$G(^TMP("SCRPW",$J,"STATS",SDYR,SDEL))+1
"RTN","SCRPW63",25,0)
 ..Q
"RTN","SCRPW63",26,0)
 .S SDNAME=$P(SD0,U) Q:'$L(SDNAME)
"RTN","SCRPW63",27,0)
 .S ^TMP("SCRPW",$J,SDEL,SDNAME,DFN)=SD0
"RTN","SCRPW63",28,0)
 .Q
"RTN","SCRPW63",29,0)
 Q:SDSTOP
"RTN","SCRPW63",30,0)
 D:$E(IOST,1,2)="C-" DISP0^SCRPW23
"RTN","SCRPW63",31,0)
 I '$D(^TMP("SCRPW",$J)) D  Q  ;Negative report
"RTN","SCRPW63",32,0)
 .D HDR^SCRPW62 S SDX="No patients found within report parameters!"
"RTN","SCRPW63",33,0)
 .W !!?(132-$L(SDX)\2),SDX
"RTN","SCRPW63",34,0)
 .I $E(IOST)="C",'SDOUT N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW63",35,0)
 .Q
"RTN","SCRPW63",36,0)
 ;Detailed report
"RTN","SCRPW63",37,0)
 I SDFMT="D" D HDR^SCRPW62 S SDEL=0 F  S SDEL=$O(^TMP("SCRPW",$J,SDEL)) Q:'SDEL!SDOUT  D
"RTN","SCRPW63",38,0)
 .S SDNAME="" F  S SDNAME=$O(^TMP("SCRPW",$J,SDEL,SDNAME)) Q:SDNAME=""!SDOUT  S DFN=0 D
"RTN","SCRPW63",39,0)
 ..F  S DFN=$O(^TMP("SCRPW",$J,SDEL,SDNAME,DFN)) Q:'DFN!SDOUT  D
"RTN","SCRPW63",40,0)
 ...S SDREL=$S(SDEL=1:0,1:+$P($G(^DPT(DFN,.372,0)),U,4))
"RTN","SCRPW63",41,0)
 ...D:$Y>(IOSL-(4+SDREL)) HDR^SCRPW62 Q:SDOUT
"RTN","SCRPW63",42,0)
 ...S SDX=^TMP("SCRPW",$J,SDEL,SDNAME,DFN) D PLINE(DFN,SDX,SDEL)
"RTN","SCRPW63",43,0)
 ...Q
"RTN","SCRPW63",44,0)
 .Q
"RTN","SCRPW63",45,0)
 Q:SDOUT
"RTN","SCRPW63",46,0)
ESUM ;Print summary
"RTN","SCRPW63",47,0)
 G:SDELIM EQ
"RTN","SCRPW63",48,0)
 S SDT(3)="STATISTICAL SUMMARY" D HDR^SCRPW62 Q:SDOUT
"RTN","SCRPW63",49,0)
 W !! S SDYR="",SDTOT=0
"RTN","SCRPW63",50,0)
 F  S SDYR=$O(^TMP("SCRPW",$J,"STATS",SDYR)) Q:SDYR=""  D
"RTN","SCRPW63",51,0)
 .S SDEL=0 F  S SDEL=$O(^TMP("SCRPW",$J,"STATS",SDYR,SDEL)) Q:'SDEL  D
"RTN","SCRPW63",52,0)
 ..S SDX=$$CSCEL(SDEL)_" veterans entered "_$S(SDYR=0:"in the past year",SDYR=1:"two years ago",SDYR=2:"three years ago",1:"")_":"
"RTN","SCRPW63",53,0)
 ..W !?36,$J(SDX,45),?83,$J(^TMP("SCRPW",$J,"STATS",SDYR,SDEL),6,0)
"RTN","SCRPW63",54,0)
 ..S SDTOT=SDTOT+^TMP("SCRPW",$J,"STATS",SDYR,SDEL)
"RTN","SCRPW63",55,0)
 ..Q
"RTN","SCRPW63",56,0)
 .Q
"RTN","SCRPW63",57,0)
 W !?36,$E(SDLINE,1,53),!?75,"TOTAL:",?83,$J(SDTOT,6,0)
"RTN","SCRPW63",58,0)
EQ I $E(IOST,1,2)="C-" N DIR S DIR(0)="E" W !! D ^DIR
"RTN","SCRPW63",59,0)
 Q
"RTN","SCRPW63",60,0)
 ;
"RTN","SCRPW63",61,0)
SCHAPP(DFN) ;Look for scheduled appointments not cancelled by clinic
"RTN","SCRPW63",62,0)
 ; Input: DFN=patient ifn
"RTN","SCRPW63",63,0)
 ;Output: '1' if appointments exist, '0' otherwise
"RTN","SCRPW63",64,0)
 N SDI,SDX,SDY
"RTN","SCRPW63",65,0)
 S (SDI,SDY)=0
"RTN","SCRPW63",66,0)
 F  S SDI=$O(^DPT(DFN,"S",SDI)) Q:'SDI!SDY  D
"RTN","SCRPW63",67,0)
 .S SDX=$G(^DPT(DFN,"S",SDI,0)) Q:'$L(SDX)
"RTN","SCRPW63",68,0)
 .S SDX=$P(SDX,U,2) I $L(SDX),"CA"[SDX Q
"RTN","SCRPW63",69,0)
 .S SDY=1
"RTN","SCRPW63",70,0)
 .Q
"RTN","SCRPW63",71,0)
 Q SDY
"RTN","SCRPW63",72,0)
 ;
"RTN","SCRPW63",73,0)
A ;Gather data for future appointments report
"RTN","SCRPW63",74,0)
 N DFN,SDA0,SDX,SDI,SDSCEL,SDEL,SDDATE,SDIFF,SDAPT,SDIVL,SDIVN
"RTN","SCRPW63",75,0)
 N SDREL,SDTOT,SDIV,SD0,SDNAME
"RTN","SCRPW63",76,0)
 D SCEL^SCRPW62(.SDSCEL,SDSCVT)  ;Get eligibility code pointers
"RTN","SCRPW63",77,0)
 S DFN=0 F  S DFN=$O(^DPT(DFN)) Q:'DFN!SDSTOP  D
"RTN","SCRPW63",78,0)
 .I DFN#1000=0 D STOP Q:SDSTOP  ;Check for stop task request
"RTN","SCRPW63",79,0)
 .S SDEL=+$G(^DPT(DFN,.36)) Q:'$D(SDSCEL(SDEL))  ;Only SC vets
"RTN","SCRPW63",80,0)
 .S SDEL=SDSCEL(SDEL)
"RTN","SCRPW63",81,0)
 .Q:+$G(^DPT(DFN,.35))  ;No deceased patients
"RTN","SCRPW63",82,0)
 .S SDI=DT F  S SDI=$O(^DPT(DFN,"S",SDI)) Q:'SDI  D
"RTN","SCRPW63",83,0)
 ..S SDDATE=+$G(^DPT(DFN,"S",SDI,1)) Q:'SDDATE  Q:SDDATE>SDI
"RTN","SCRPW63",84,0)
 ..S SDA0=$G(^DPT(DFN,"S",SDI,0)) Q:'$L(SDA0)
"RTN","SCRPW63",85,0)
 ..S SDIV=$P($G(^SC(+SDA0,0)),U,15) Q:'$$DIV(.SDIV)  ;Division check
"RTN","SCRPW63",86,0)
 ..;Exclude cancelled appointments
"RTN","SCRPW63",87,0)
 ..S SDX=$P(SDA0,U,2) I $L(SDX),"PCA"[SDX Q
"RTN","SCRPW63",88,0)
 ..S SDIFF=$$FMDIFF^XLFDT(SDI,SDDATE) Q:SDIFF'>SDATES
"RTN","SCRPW63",89,0)
 ..S SDNAME=$P($G(^DPT(DFN,0)),U) Q:'$L(SDNAME)
"RTN","SCRPW63",90,0)
 ..;Record detailed information
"RTN","SCRPW63",91,0)
 ..S ^TMP("SCRPW",$J,SDIV,SDEL,SDNAME,DFN,SDI)=SDDATE_U_SDA0
"RTN","SCRPW63",92,0)
 ..S ^TMP("SCRPW",$J,SDIV,SDEL,SDNAME,DFN)=$G(^TMP("SCRPW",$J,SDIV,SDEL,SDNAME,DFN))+1
"RTN","SCRPW63",93,0)
 ..Q
"RTN","SCRPW63",94,0)
 .Q
"RTN","SCRPW63",95,0)
 Q:SDSTOP
"RTN","SCRPW63",96,0)
 ;Tally up statistics
"RTN","SCRPW63",97,0)
 S SDIV=0 F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:'SDIV  D
"RTN","SCRPW63",98,0)
 .S SDEL=0 F  S SDEL=$O(^TMP("SCRPW",$J,SDIV,SDEL)) Q:'SDEL  D
"RTN","SCRPW63",99,0)
 ..S SDNAME="" F  S SDNAME=$O(^TMP("SCRPW",$J,SDIV,SDEL,SDNAME)) Q:SDNAME=""!SDOUT  D
"RTN","SCRPW63",100,0)
 ...S DFN=0 F  S DFN=$O(^TMP("SCRPW",$J,SDIV,SDEL,SDNAME,DFN)) Q:'DFN  D
"RTN","SCRPW63",101,0)
 ....S ^TMP("SCRPW",$J,"STATS",SDIV,SDEL,"PTS")=$G(^TMP("SCRPW",$J,"STATS",SDIV,SDEL,"PTS"))+1
"RTN","SCRPW63",102,0)
 ....S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,SDIV,SDEL,SDNAME,DFN,SDI)) Q:'SDI  D
"RTN","SCRPW63",103,0)
 .....S ^TMP("SCRPW",$J,"STATS",SDIV,SDEL,"APPTS")=$G(^TMP("SCRPW",$J,"STATS",SDIV,SDEL,"APPTS"))+1
"RTN","SCRPW63",104,0)
 .....Q
"RTN","SCRPW63",105,0)
 ....Q
"RTN","SCRPW63",106,0)
 ...Q
"RTN","SCRPW63",107,0)
 ..Q
"RTN","SCRPW63",108,0)
 .Q
"RTN","SCRPW63",109,0)
 Q:SDSTOP
"RTN","SCRPW63",110,0)
 ;Print report
"RTN","SCRPW63",111,0)
 S SDIV="" F  S SDIV=$O(SDDIV(SDIV)) Q:'SDIV  S SDIV(SDDIV(SDIV))=SDIV
"RTN","SCRPW63",112,0)
 I 'SDDIV,$P(SDDIV,U,2)'="ALL DIVISIONS" D
"RTN","SCRPW63",113,0)
 .S SDIV($P(SDDIV,U,2))=$$PRIM^VASITE()
"RTN","SCRPW63",114,0)
 .Q
"RTN","SCRPW63",115,0)
 I $P(SDDIV,U,2)="ALL DIVISIONS" S SDI=0 D
"RTN","SCRPW63",116,0)
 .F  S SDI=$O(^TMP("SCRPW",$J,SDI)) Q:'SDI  D
"RTN","SCRPW63",117,0)
 ..S SDX=$P($G(^DG(40.8,SDI,0)),U) S:$L(SDX) SDIV(SDX)=SDI
"RTN","SCRPW63",118,0)
 ..Q
"RTN","SCRPW63",119,0)
 .Q
"RTN","SCRPW63",120,0)
 D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW63",121,0)
 I '$D(^TMP("SCRPW",$J)) D  Q  ;Negative report
"RTN","SCRPW63",122,0)
 .S SDIV=0 D DHDR^SCRPW40(3,.SDT),HDR^SCRPW62
"RTN","SCRPW63",123,0)
 .S SDX="No appointments found that meet report criteria."
"RTN","SCRPW63",124,0)
 .I SDELIM W !,SDX Q
"RTN","SCRPW63",125,0)
 .W !!?(IOM-$L(SDX)\2),SDX
"RTN","SCRPW63",126,0)
 .I $E(IOST)="C",'SDOUT N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW63",127,0)
 .Q
"RTN","SCRPW63",128,0)
 G:SDFMT="S" ASUM
"RTN","SCRPW63",129,0)
 ;Print detailed report by division
"RTN","SCRPW63",130,0)
 S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  D
"RTN","SCRPW63",131,0)
 .S SDIV=SDIV(SDIVN) D ADPRT(.SDIV)
"RTN","SCRPW63",132,0)
 .Q
"RTN","SCRPW63",133,0)
 Q:SDOUT
"RTN","SCRPW63",134,0)
 ;Print summary
"RTN","SCRPW63",135,0)
ASUM G:SDELIM AQ
"RTN","SCRPW63",136,0)
 S SDT(3)="STATISTICAL SUMMARY" D HDR^SCRPW62 Q:SDOUT
"RTN","SCRPW63",137,0)
 W !! S (SDTOT,SDIV,SDIVL)=0,SDIVN=""
"RTN","SCRPW63",138,0)
 F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""  D
"RTN","SCRPW63",139,0)
 .S SDIVN(SDIV(SDIVN))=SDIVN S:$L(SDIVN)>SDIVL SDIVL=$L(SDIVN)
"RTN","SCRPW63",140,0)
 F  S SDIV=$O(^TMP("SCRPW",$J,"STATS",SDIV)) Q:'SDIV  D
"RTN","SCRPW63",141,0)
 .S SDEL=0 F  S SDEL=$O(^TMP("SCRPW",$J,"STATS",SDIV,SDEL)) Q:'SDEL  D
"RTN","SCRPW63",142,0)
 ..S SDAPT=^TMP("SCRPW",$J,"STATS",SDIV,SDEL,"APPTS"),SDTOT=SDTOT+SDAPT
"RTN","SCRPW63",143,0)
 ..S SDX=$$CSCEL(SDEL)_" appointments at "_SDIVN(SDIV)_":"
"RTN","SCRPW63",144,0)
 ..W !?(50-SDIVL),$J(SDX,(28+SDIVL)),?80,$J(SDAPT,6,0)
"RTN","SCRPW63",145,0)
 ..Q
"RTN","SCRPW63",146,0)
 .Q
"RTN","SCRPW63",147,0)
 W !?(50-SDIVL),$E(SDLINE,1,(36+SDIVL)),!?72,"TOTAL:",?80,$J(SDTOT,6,0)
"RTN","SCRPW63",148,0)
AQ I $E(IOST)="C",'SDOUT N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW63",149,0)
 Q
"RTN","SCRPW63",150,0)
 ;
"RTN","SCRPW63",151,0)
DIV(SDIV) ;Check division
"RTN","SCRPW63",152,0)
 S:'$L(SDIV) SDIV=$$PRIM^VASITE()
"RTN","SCRPW63",153,0)
 Q:'SDDIV 1  Q $D(SDDIV(+SDIV))
"RTN","SCRPW63",154,0)
 ;
"RTN","SCRPW63",155,0)
 ;
"RTN","SCRPW63",156,0)
STOP ;Check for stop task request
"RTN","SCRPW63",157,0)
 S:$G(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW63",158,0)
 ;
"RTN","SCRPW63",159,0)
ADPRT(SDIV) ;Print report for a division
"RTN","SCRPW63",160,0)
 D DHDR^SCRPW40(3,.SDT) S:SDELIM SDPAGE=1
"RTN","SCRPW63",161,0)
 I '$D(^TMP("SCRPW",$J,SDIV)) D HDR^SCRPW62 Q:SDOUT  D  Q
"RTN","SCRPW63",162,0)
 .S SDX="No appointments found for this division within report parameters!"
"RTN","SCRPW63",163,0)
 .I SDELIM W !,SDX Q
"RTN","SCRPW63",164,0)
 .W !!?(132-$L(SDX)\2),SDX Q
"RTN","SCRPW63",165,0)
 D HDR^SCRPW62 Q:SDOUT
"RTN","SCRPW63",166,0)
 S SDEL="" F  S SDEL=$O(^TMP("SCRPW",$J,SDIV,SDEL)) Q:'SDEL!SDOUT  D
"RTN","SCRPW63",167,0)
 .S SDNAME="" F  S SDNAME=$O(^TMP("SCRPW",$J,SDIV,SDEL,SDNAME)) Q:SDNAME=""!SDOUT  D
"RTN","SCRPW63",168,0)
 ..S DFN=0 F  S DFN=$O(^TMP("SCRPW",$J,SDIV,SDEL,SDNAME,DFN)) Q:'DFN!SDOUT  D
"RTN","SCRPW63",169,0)
 ...S SD0=$G(^DPT(DFN,0)) Q:'$L(SD0)
"RTN","SCRPW63",170,0)
 ...S SDREL=$S(SDEL=1:0,1:+$P($G(^DPT(DFN,.372,0)),U,4))
"RTN","SCRPW63",171,0)
 ...S SDREL=SDREL+^TMP("SCRPW",$J,SDIV,SDEL,SDNAME,DFN)
"RTN","SCRPW63",172,0)
 ...D:$Y>(IOSL-(4+SDREL)) HDR^SCRPW62 Q:SDOUT
"RTN","SCRPW63",173,0)
 ...D PLINE(DFN,SD0,SDEL)
"RTN","SCRPW63",174,0)
 ...Q
"RTN","SCRPW63",175,0)
 ..Q
"RTN","SCRPW63",176,0)
 .Q
"RTN","SCRPW63",177,0)
 Q
"RTN","SCRPW63",178,0)
 ;
"RTN","SCRPW63",179,0)
PLINE(DFN,SD0,SDEL) ;Print patient detail line         
"RTN","SCRPW63",180,0)
 ;Input: DFN=patient ifn
"RTN","SCRPW63",181,0)
 ;       SD0=zeroeth node of patient record
"RTN","SCRPW63",182,0)
 ;      SDEL=1 or 3 to denote SC > or < 50%
"RTN","SCRPW63",183,0)
 ;
"RTN","SCRPW63",184,0)
 N SDSSN,SDNAME,SDDTE,SDADD,SDST,SDX,SDI,SDY,SDELN,SDZIP,SDZ,SDZA,SDII
"RTN","SCRPW63",185,0)
 S SDNAME=$P(SD0,U),SDSSN=$P(SD0,U,9),SDDTE=$$FMTE^XLFDT($P(SD0,U,16))
"RTN","SCRPW63",186,0)
 S SDSSN=$E(SDSSN,1,3)_"-"_$E(SDSSN,4,5)_"-"_$E(SDSSN,6,10)
"RTN","SCRPW63",187,0)
 S SDEL=$G(SDEL),SDELN=$$CSCEL(SDEL),SDADD=$G(^DPT(DFN,.11))
"RTN","SCRPW63",188,0)
 S SDST=$P($G(^DIC(5,+$P(SDADD,U,5),0)),U,2),SDZIP=$P(SDADD,U,12)
"RTN","SCRPW63",189,0)
 S:$L(SDZIP)=9 SDZIP=$E(SDZIP,1,5)_"-"_$E(SDZIP,6,9)
"RTN","SCRPW63",190,0)
 I SDELIM D  ;Set up delimited output
"RTN","SCRPW63",191,0)
 .S SDZ=SDNAME_U_SDSSN_U_SDELN_U_SDDTE_U_$P(SDADD,U)_U_$P(SDADD,U,4)
"RTN","SCRPW63",192,0)
 .S SDZ=SDZ_U_SDST_U_SDZIP_U_$P($G(^DPT(DFN,.13)),U)
"RTN","SCRPW63",193,0)
 .Q
"RTN","SCRPW63",194,0)
 I 'SDELIM D
"RTN","SCRPW63",195,0)
 .;Print name, SSN, eligibility, date entered, address and phone number
"RTN","SCRPW63",196,0)
 .W !,"Name: ",SDNAME,?39,"SSN: ",SDSSN,?58,"Prim. Elig.: ",SDELN
"RTN","SCRPW63",197,0)
 .W ?84,"Date entered: ",SDDTE,!?10,"Address: ",$P(SDADD,U)
"RTN","SCRPW63",198,0)
 .W ?55,$P(SDADD,U,4),$S($L($P(SDADD,U,4)):", ",1:""),SDST,"  ",SDZIP
"RTN","SCRPW63",199,0)
 .W ?88,"Phone number: ",$P($G(^DPT(DFN,.13)),U)
"RTN","SCRPW63",200,0)
 .;Print SC disabilities for 0-50% SC veterans
"RTN","SCRPW63",201,0)
 .I SDEL=3 S SDI=0 F  S SDI=$O(^DPT(DFN,.372,SDI)) Q:'SDI  D
"RTN","SCRPW63",202,0)
 ..S SDX=$G(^DPT(DFN,.372,SDI,0)) Q:'$P(SDX,U,3)
"RTN","SCRPW63",203,0)
 ..S SDY=$G(^DIC(31,+SDX,0)) Q:'$L(SDY)
"RTN","SCRPW63",204,0)
 ..W !?20,"SC disability: ",$P(SDY,U,3),"  ",$P(SDY,U)
"RTN","SCRPW63",205,0)
 ..W ?89,"%SC: ",$P(SDX,U,2)
"RTN","SCRPW63",206,0)
 ..Q
"RTN","SCRPW63",207,0)
 .Q
"RTN","SCRPW63",208,0)
 I SDRPT="E" D  Q
"RTN","SCRPW63",209,0)
 .I SDELIM W !,SDZ Q
"RTN","SCRPW63",210,0)
 .W !
"RTN","SCRPW63",211,0)
 .Q
"RTN","SCRPW63",212,0)
 ;Print appointment details for future appointment report
"RTN","SCRPW63",213,0)
 S SDI=0 D
"RTN","SCRPW63",214,0)
 .F  S SDI=$O(^TMP("SCRPW",$J,SDIV,SDEL,SDNAME,DFN,SDI)) Q:'SDI  D
"RTN","SCRPW63",215,0)
 ..S SDA0=^TMP("SCRPW",$J,SDIV,SDEL,SDNAME,DFN,SDI)
"RTN","SCRPW63",216,0)
 ..I 'SDELIM D
"RTN","SCRPW63",217,0)
 ...W !?30,"Appointment: ",$$FMTE^XLFDT(SDI)
"RTN","SCRPW63",218,0)
 ...W ?63,$P($G(^SC(+$P(SDA0,U,2),0)),U),?96,"Desired date: "
"RTN","SCRPW63",219,0)
 ...W $$FMTE^XLFDT(+SDA0),?124,"(",$$FMDIFF^XLFDT(SDI,+SDA0),")"
"RTN","SCRPW63",220,0)
 ...Q
"RTN","SCRPW63",221,0)
 ..I SDELIM D  ;Delimited output
"RTN","SCRPW63",222,0)
 ...N SDC0,SDCP,SDCZ,SDADM,SDADME
"RTN","SCRPW63",223,0)
 ...S SDC0=$G(^SC(+$P(SDA0,U,2),0)),SDCZ=$$CPAIR^SCRPW71(SDC0,.SDCP)
"RTN","SCRPW63",224,0)
 ...S SDII=0,(SDZA,SDADM,SDADME)=""
"RTN","SCRPW63",225,0)
 ...F  S SDII=$O(^SC(+$P(SDA0,U,2),"S",SDI,1,SDII)) D  Q:'SDII
"RTN","SCRPW63",226,0)
 ....Q:+$G(^SC(+$P(SDA0,U,2),"S",SDI,1,+SDII,0))'=DFN
"RTN","SCRPW63",227,0)
 ....S SDADM=$P(^SC(+$P(SDA0,U,2),"S",SDI,1,+SDII,0),U,7)
"RTN","SCRPW63",228,0)
 ....S SDADME=$$FMTE^XLFDT(SDADM),SDII=0
"RTN","SCRPW63",229,0)
 ....Q
"RTN","SCRPW63",230,0)
 ...S SDCZ=SDCP_U_$P($$SITE^VASITE(,$P(SDC0,U,15)),U,2)_U_SDADME
"RTN","SCRPW63",231,0)
 ...S SDZA=SDZA_U_$$FMTE^XLFDT(SDI)_U_$P(SDC0,U)_U_SDCZ
"RTN","SCRPW63",232,0)
 ...S SDZA=SDZA_U_$$FMTE^XLFDT(+SDA0)_U_$$FMDIFF^XLFDT(SDI,+SDA0)
"RTN","SCRPW63",233,0)
 ...S SDZA=SDZA_U_$S(SDADM:$$FMDIFF^XLFDT(+SDA0,SDADM),1:"")
"RTN","SCRPW63",234,0)
 ...W !,SDZ,SDZA
"RTN","SCRPW63",235,0)
 ...Q
"RTN","SCRPW63",236,0)
 ..Q
"RTN","SCRPW63",237,0)
 .Q
"RTN","SCRPW63",238,0)
 W:'SDELIM ! Q
"RTN","SCRPW63",239,0)
 ;
"RTN","SCRPW63",240,0)
CSCEL(SDEL) ;Convert SC elig. to external
"RTN","SCRPW63",241,0)
 Q $S(SDEL=1:"SC 50-100%",SDEL=3:"SC < 50%",1:"")
"VER")
8.0^22.0
**END**
**END**
