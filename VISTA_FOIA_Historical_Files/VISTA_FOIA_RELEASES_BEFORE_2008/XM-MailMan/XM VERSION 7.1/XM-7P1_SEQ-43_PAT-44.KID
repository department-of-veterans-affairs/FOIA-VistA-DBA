Released XM*7.1*44 SEQ #43
Extracted from mail message
**KIDS**:XM*7.1*44^

**INSTALL NAME**
XM*7.1*44
"BLD",27,0)
XM*7.1*44^MAILMAN^0^2970619^n
"BLD",27,1,0)
^^143^143^2970623^^^^
"BLD",27,1,1,0)
MailMan patch XM*7.1*44 contains the following enhancements:
"BLD",27,1,2,0)

"BLD",27,1,3,0)
NOIS:       OKL-0497-70538
"BLD",27,1,4,0)
E3R:        9173,9994
"BLD",27,1,5,0)
Rtns:       ^XMA32A,^XMADJF1,^XMGAPI3,^XMZTERM,^XMZTERM1
"BLD",27,1,6,0)
Options:    XMMGR,XMMGR-TERMINATE-ONE,XMMGR-TERMINATE-MANY,
"BLD",27,1,7,0)
            XMMGR-TERMINATE-SUGGEST,XMMGR-PURGE-MESSAGE
"BLD",27,1,8,0)
Test Sites: Oklahoma City, OK; Prescott, AZ; St. Louis, MO; Houston, TX
"BLD",27,1,9,0)

"BLD",27,1,10,0)
Broadcast mail is now delivered only to users who have an access code, a verify
"BLD",27,1,11,0)
code, a primary menu, and a mail box.
"BLD",27,1,12,0)

"BLD",27,1,13,0)
Four new options have been added to XMMGR-DISK-SPACE-MANAGEMENT menu:
"BLD",27,1,14,0)

"BLD",27,1,15,0)
----------------------------------------------------------------------------
"BLD",27,1,16,0)
NAME: XMMGR-PURGE-MESSAGE               MENU TEXT: Purge a message
"BLD",27,1,17,0)
DESCRIPTION:  This option enables you to purge any message.
"BLD",27,1,18,0)

"BLD",27,1,19,0)
Purge means:
"BLD",27,1,20,0)
-delete the message from all user mailboxes
"BLD",27,1,21,0)
-delete the message from the MESSAGE global ^XMB(3.9
"BLD",27,1,22,0)
-delete all responses from the MESSAGE global ^XMB(3.9
"BLD",27,1,23,0)

"BLD",27,1,24,0)
Purge is not reversible.  The message is gone forever.
"BLD",27,1,25,0)

"BLD",27,1,26,0)
----------------------------------------------------------------------------
"BLD",27,1,27,0)
NAME: XMMGR-TERMINATE-ONE               MENU TEXT: Terminate one mail user
"BLD",27,1,28,0)
DESCRIPTION:   This option lets you remove the mailbox of any user
"BLD",27,1,29,0)
who meets the criteria of either the XMMGR-TERMINATE-MANY option or the
"BLD",27,1,30,0)
XMMGR-TERMINATE-SUGGEST option.
"BLD",27,1,31,0)
As a result, the user will not receive any mail.  
"BLD",27,1,32,0)

"BLD",27,1,33,0)
Remember,
"BLD",27,1,34,0)
-Whenever you give a user a new access code,
"BLD",27,1,35,0)
 the system gives the user a mailbox if he doesn't already have one.
"BLD",27,1,36,0)
-Whenever a user logs on,
"BLD",27,1,37,0)
 the system gives the user a mailbox if he doesn't already have one.
"BLD",27,1,38,0)

"BLD",27,1,39,0)
----------------------------------------------------------------------------
"BLD",27,1,40,0)
NAME: XMMGR-TERMINATE-MANY              MENU TEXT: Terminate many mail users
"BLD",27,1,41,0)
DESCRIPTION:   This option goes through the MAIL BOX global and removes any
"BLD",27,1,42,0)
mailbox if
"BLD",27,1,43,0)
- the user is not in the NEW PERSON file.
"BLD",27,1,44,0)
- the user has no access code and was not terminated.
"BLD",27,1,45,0)
- the user has no access code and was terminated w/o mailbox retention.
"BLD",27,1,46,0)
- the user has an access code and primary menu, but no verify code, AND 
"BLD",27,1,47,0)
  - has never signed on, since being added before a cutoff date.  
"BLD",27,1,48,0)
  OR 
"BLD",27,1,49,0)
  - last signed on before a cutoff date.
"BLD",27,1,50,0)

"BLD",27,1,51,0)
Remove means:
"BLD",27,1,52,0)
- Delete user's private mail groups
"BLD",27,1,53,0)
- Remove user from membership in all groups
"BLD",27,1,54,0)
- Remove user as an authorized sender from all groups 
"BLD",27,1,55,0)
- Remove user from anyone's list of surrogates
"BLD",27,1,56,0)
- Delete user's latered-messages list
"BLD",27,1,57,0)
- Delete user's mail box
"BLD",27,1,58,0)
As a result, the user will not receive any mail.
"BLD",27,1,59,0)

"BLD",27,1,60,0)
This option can be run in 'test' or 'real' mode.  
"BLD",27,1,61,0)

"BLD",27,1,62,0)
The report lists, in DUZ order:
"BLD",27,1,63,0)
-The user's DUZ and name
"BLD",27,1,64,0)
-Whether the user has an access code, verify code, and primary menu
"BLD",27,1,65,0)
-When the user was added to the NEW PERSON file
"BLD",27,1,66,0)
-When the user last signed on
"BLD",27,1,67,0)
-When the user was terminated (if applicable)
"BLD",27,1,68,0)
-If the user was terminated, then whether the site manager chose to delete
"BLD",27,1,69,0)
 the user's mailbox.  (It's generally a good idea to go ahead and delete
"BLD",27,1,70,0)
 the mailbox upon termination.) 
"BLD",27,1,71,0)

"BLD",27,1,72,0)
----------------------------------------------------------------------------
"BLD",27,1,73,0)
NAME: XMMGR-TERMINATE-SUGGEST
"BLD",27,1,74,0)
MENU TEXT: Terminate mail user suggestions
"BLD",27,1,75,0)
DESCRIPTION:   This option goes through the MailBox global and reports on
"BLD",27,1,76,0)
users who perhaps should have their mail access terminated.  
"BLD",27,1,77,0)

"BLD",27,1,78,0)
Users are included in the report if
"BLD",27,1,79,0)
- the user was terminated before a manager-supplied cutoff date
"BLD",27,1,80,0)
  and allowed to keep a mailbox.
"BLD",27,1,81,0)
- the user has an access code, verify code, and primary menu,
"BLD",27,1,82,0)
  but last signed on before a manager-supplied cutoff date.  
"BLD",27,1,83,0)

"BLD",27,1,84,0)
This option does not terminate mail access.  
"BLD",27,1,85,0)

"BLD",27,1,86,0)
The report page breaks on Service/Section and includes the following 
"BLD",27,1,87,0)
information: 
"BLD",27,1,88,0)
-User's DUZ and name
"BLD",27,1,89,0)
-Whether the user has an access code, a verify code, and a primary menu
"BLD",27,1,90,0)
-When the user last signed on
"BLD",27,1,91,0)
-When the user was terminated (if applicable)
"BLD",27,1,92,0)
-If the user was terminated, then whether the site manager chose
"BLD",27,1,93,0)
 to delete the user's mailbox.  (Remember, you should usually answer 'yes'
"BLD",27,1,94,0)
 to this question, unless the user is coming back and needs to have his mail
"BLD",27,1,95,0)
 retained.)
"BLD",27,1,96,0)
-How many new messages the user has.  (New messages are never purged, except 
"BLD",27,1,97,0)
 during purge-by-date purges.) 
"BLD",27,1,98,0)

"BLD",27,1,99,0)
Finally there are two blank columns.  One is headed "Term User Mbox"
"BLD",27,1,100,0)
(Terminate user mailbox), and the other is headed "Deact VISTA Access"
"BLD",27,1,101,0)
(Deactivate VISTA Access).  Besides being of interest to the Site Manager,
"BLD",27,1,102,0)
this report is also designed to be submitted to other services. The intent is
"BLD",27,1,103,0)
that the other services would check one of the columns for each user in the
"BLD",27,1,104,0)
report and return the report to the Site Manager to act on. 
"BLD",27,1,105,0)

"BLD",27,1,106,0)
===========================================================================
"BLD",27,1,107,0)
This patch should be installed after hours, when user activity is at a
"BLD",27,1,108,0)
minimum.  You should put the XMUSER Option out of order.  The filers should
"BLD",27,1,109,0)
be shut down.  ^XMADJF1 is probably mapped on your system.
"BLD",27,1,110,0)
===========================================================================
"BLD",27,1,111,0)
 
"BLD",27,1,112,0)
INSTALLATION:
"BLD",27,1,113,0)
1.  If any of these routines is mapped (on systems which allow mapping),
"BLD",27,1,114,0)
    disable mapping for the affected routine(s).
"BLD",27,1,115,0)
2.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option to load
"BLD",27,1,116,0)
    the patch into a transport global.
"BLD",27,1,117,0)
3.  On the KIDS:Installation menu, use the following options to install the
"BLD",27,1,118,0)
    Transport Global:
"BLD",27,1,119,0)
       Verify Checksums in Transport Global
"BLD",27,1,120,0)
       Print Transport Global
"BLD",27,1,121,0)
       Compare Transport Global to Current System
"BLD",27,1,122,0)
       Backup a Transport Global
"BLD",27,1,123,0)
       Install Package(s)
"BLD",27,1,124,0)
4.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"BLD",27,1,125,0)
    other CPUs?'. Enter the names of your Compute and Print server(s).
"BLD",27,1,126,0)
5.  AXP Sites, after patch has installed, rebuild your map set.
"BLD",27,1,127,0)
============================================================================ 
"BLD",27,1,128,0)
  
"BLD",27,1,129,0)
ROUTINES:
"BLD",27,1,130,0)
The second line of the routine now looks like:
"BLD",27,1,131,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"BLD",27,1,132,0)
 
"BLD",27,1,133,0)
              Before          After
"BLD",27,1,134,0)
Name          Checksum        Checksum        Patch List
"BLD",27,1,135,0)
----------------------------------------------------------
"BLD",27,1,136,0)
XMA32A         9601895        10911370        27,37,44
"BLD",27,1,137,0)
XMADJF1        8481461         8709221        44
"BLD",27,1,138,0)
XMGAPI3        2791662         3149530        29,44
"BLD",27,1,139,0)
XMZTERM        * new *        15108400        44
"BLD",27,1,140,0)
XMZTERM1       * new *        14445630        44
"BLD",27,1,141,0)

"BLD",27,1,142,0)
* Checksums produced by CHECK^XTSUMBLD
"BLD",27,1,143,0)
============================================================================
"BLD",27,4,0)
^9.64PA^^0
"BLD",27,"INI")

"BLD",27,"INIT")

"BLD",27,"KRN",0)
^9.67PA^19^12
"BLD",27,"KRN",.4,0)
.4
"BLD",27,"KRN",.401,0)
.401
"BLD",27,"KRN",.402,0)
.402
"BLD",27,"KRN",.403,0)
.403
"BLD",27,"KRN",.5,0)
.5
"BLD",27,"KRN",.84,0)
.84
"BLD",27,"KRN",3.6,0)
3.6
"BLD",27,"KRN",3.8,0)
3.8
"BLD",27,"KRN",9.2,0)
9.2
"BLD",27,"KRN",9.8,0)
9.8
"BLD",27,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",27,"KRN",9.8,"NM",1,0)
XMGAPI3^^0^B10086211
"BLD",27,"KRN",9.8,"NM",2,0)
XMADJF1^^0^B13649207
"BLD",27,"KRN",9.8,"NM",3,0)
XMZTERM^^0^B57445643
"BLD",27,"KRN",9.8,"NM",4,0)
XMZTERM1^^0^B64954742
"BLD",27,"KRN",9.8,"NM",5,0)
XMA32A^^0^B51302759
"BLD",27,"KRN",9.8,"NM","B","XMA32A",5)

"BLD",27,"KRN",9.8,"NM","B","XMADJF1",2)

"BLD",27,"KRN",9.8,"NM","B","XMGAPI3",1)

"BLD",27,"KRN",9.8,"NM","B","XMZTERM",3)

"BLD",27,"KRN",9.8,"NM","B","XMZTERM1",4)

"BLD",27,"KRN",19,0)
19
"BLD",27,"KRN",19,"NM",0)
^9.68A^6^5
"BLD",27,"KRN",19,"NM",2,0)
XMMGR-TERMINATE-ONE^^0
"BLD",27,"KRN",19,"NM",3,0)
XMMGR-TERMINATE-MANY^^0
"BLD",27,"KRN",19,"NM",4,0)
XMMGR-TERMINATE-SUGGEST^^0
"BLD",27,"KRN",19,"NM",5,0)
XMMGR-PURGE-MESSAGE^^0
"BLD",27,"KRN",19,"NM",6,0)
XMMGR-DISK-SPACE-MANAGEMENT^^2
"BLD",27,"KRN",19,"NM","B","XMMGR-DISK-SPACE-MANAGEMENT",6)

"BLD",27,"KRN",19,"NM","B","XMMGR-PURGE-MESSAGE",5)

"BLD",27,"KRN",19,"NM","B","XMMGR-TERMINATE-MANY",3)

"BLD",27,"KRN",19,"NM","B","XMMGR-TERMINATE-ONE",2)

"BLD",27,"KRN",19,"NM","B","XMMGR-TERMINATE-SUGGEST",4)

"BLD",27,"KRN",19.1,0)
19.1
"BLD",27,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",27,"KRN","B",.4,.4)

"BLD",27,"KRN","B",.401,.401)

"BLD",27,"KRN","B",.402,.402)

"BLD",27,"KRN","B",.403,.403)

"BLD",27,"KRN","B",.5,.5)

"BLD",27,"KRN","B",.84,.84)

"BLD",27,"KRN","B",3.6,3.6)

"BLD",27,"KRN","B",3.8,3.8)

"BLD",27,"KRN","B",9.2,9.2)

"BLD",27,"KRN","B",9.8,9.8)

"BLD",27,"KRN","B",19,19)

"BLD",27,"KRN","B",19.1,19.1)

"BLD",27,"QUES",0)
^9.62^^
"BLD",27,"REQB",0)
^9.611^^
"KRN",19,482,-1)
2^6
"KRN",19,482,0)
XMMGR-DISK-SPACE-MANAGEMENT^Disk Space Management^^M^^^^^^^^MAILMAN
"KRN",19,482,1,0)
^^2^2^2970514^^^^
"KRN",19,482,1,1,0)
 
"KRN",19,482,1,2,0)
This option is a submenu of disk space options.
"KRN",19,482,10,0)
^19.01PI^14^13
"KRN",19,482,10,11,0)
526
"KRN",19,482,10,11,"^")
XMMGR-TERMINATE-ONE
"KRN",19,482,10,12,0)
527
"KRN",19,482,10,12,"^")
XMMGR-TERMINATE-MANY
"KRN",19,482,10,13,0)
528
"KRN",19,482,10,13,"^")
XMMGR-TERMINATE-SUGGEST
"KRN",19,482,10,14,0)
529
"KRN",19,482,10,14,"^")
XMMGR-PURGE-MESSAGE
"KRN",19,482,99)
57112,40171
"KRN",19,482,"U")
DISK SPACE MANAGEMENT
"KRN",19,526,-1)
0^2
"KRN",19,526,0)
XMMGR-TERMINATE-ONE^Terminate one mail user^^R^^^^^^^^MAILMAN
"KRN",19,526,1,0)
^^18^18^2970516^^^^
"KRN",19,526,1,1,0)
This option lets you remove the mailbox of any user who meets the criteria of
"KRN",19,526,1,2,0)
either the XMMGR-TERMINATE-MANY option or the XMMGR-TERMINATE-SUGGEST option. 
"KRN",19,526,1,3,0)

"KRN",19,526,1,4,0)
Remove means:
"KRN",19,526,1,5,0)
- Delete user's private mail groups
"KRN",19,526,1,6,0)
- Remove user from membership in all groups
"KRN",19,526,1,7,0)
- Remove user as an authorized sender from all groups
"KRN",19,526,1,8,0)
- Remove user from anyone's list of surrogates
"KRN",19,526,1,9,0)
- Delete user's latered-messages list
"KRN",19,526,1,10,0)
- Delete user's mail box
"KRN",19,526,1,11,0)

"KRN",19,526,1,12,0)
As a result, the user will not receive any mail.
"KRN",19,526,1,13,0)

"KRN",19,526,1,14,0)
Remember,
"KRN",19,526,1,15,0)
- Whenever you give a user a new access code, the system gives the user a
"KRN",19,526,1,16,0)
mailbox if he doesn't already have one. 
"KRN",19,526,1,17,0)
- Whenever a user logs on, the system gives the user a mailbox if he doesn't
"KRN",19,526,1,18,0)
already have one. 
"KRN",19,526,25)
CHOOSE^XMZTERM
"KRN",19,526,"U")
TERMINATE ONE MAIL USER
"KRN",19,527,-1)
0^3
"KRN",19,527,0)
XMMGR-TERMINATE-MANY^Terminate many mail users^^R^^^^^^^^MAILMAN
"KRN",19,527,1,0)
^^30^30^2970516^^^^
"KRN",19,527,1,1,0)
This option goes through the MAIL BOX global and removes any mailbox if
"KRN",19,527,1,2,0)
- the user is not in the NEW PERSON file.
"KRN",19,527,1,3,0)
- the user has no access code and was not terminated.
"KRN",19,527,1,4,0)
- the user has no access code and was terminated w/o mailbox retention.
"KRN",19,527,1,5,0)
- the user has an access code and primary menu, but no verify code, AND
"KRN",19,527,1,6,0)
  - has never signed on, since being added before a cutoff date.
"KRN",19,527,1,7,0)
  OR
"KRN",19,527,1,8,0)
  - last signed on before a cutoff date.
"KRN",19,527,1,9,0)

"KRN",19,527,1,10,0)
Remove means:
"KRN",19,527,1,11,0)
- Delete user's private mail groups
"KRN",19,527,1,12,0)
- Remove user from membership in all groups
"KRN",19,527,1,13,0)
- Remove user as an authorized sender from all groups
"KRN",19,527,1,14,0)
- Remove user from anyone's list of surrogates
"KRN",19,527,1,15,0)
- Delete user's latered-messages list
"KRN",19,527,1,16,0)
- Delete user's mail box
"KRN",19,527,1,17,0)

"KRN",19,527,1,18,0)
As a result, the user will not receive any mail.
"KRN",19,527,1,19,0)

"KRN",19,527,1,20,0)
This option can be run in 'test' or 'real' mode.
"KRN",19,527,1,21,0)

"KRN",19,527,1,22,0)
The report lists, in DUZ order:
"KRN",19,527,1,23,0)
-The user's DUZ and name
"KRN",19,527,1,24,0)
-Whether the user has an access code, verify code, and primary menu
"KRN",19,527,1,25,0)
-When the user was added to the NEW PERSON file
"KRN",19,527,1,26,0)
-When the user last signed on
"KRN",19,527,1,27,0)
-When the user was terminated (if applicable)
"KRN",19,527,1,28,0)
-If the user was terminated, then whether the site manager chose to delete the
"KRN",19,527,1,29,0)
 user's mailbox.  (It's generally a good idea to go ahead and delete the
"KRN",19,527,1,30,0)
 mailbox upon termination.)
"KRN",19,527,25)
ALL1^XMZTERM
"KRN",19,527,"U")
TERMINATE MANY MAIL USERS
"KRN",19,528,-1)
0^4
"KRN",19,528,0)
XMMGR-TERMINATE-SUGGEST^Terminate mail user suggestions^^R^^^^^^^^MAILMAN
"KRN",19,528,1,0)
^^30^30^2970502^^^
"KRN",19,528,1,1,0)
This option goes through the MailBox global and reports on users who perhaps
"KRN",19,528,1,2,0)
should have their mail access terminated.
"KRN",19,528,1,3,0)

"KRN",19,528,1,4,0)
Users are included in the report if
"KRN",19,528,1,5,0)
- the user was terminated before a manager-supplied cutoff date
"KRN",19,528,1,6,0)
  and allowed to keep a mailbox.
"KRN",19,528,1,7,0)
- the user has an access code, verify code, and primary menu,
"KRN",19,528,1,8,0)
  but last signed on before a manager-supplied cutoff date.
"KRN",19,528,1,9,0)

"KRN",19,528,1,10,0)
This option does not terminate mail access.
"KRN",19,528,1,11,0)

"KRN",19,528,1,12,0)
The report page breaks on Service/Section and includes the following
"KRN",19,528,1,13,0)
information:
"KRN",19,528,1,14,0)

"KRN",19,528,1,15,0)
-User's DUZ and name
"KRN",19,528,1,16,0)
-Whether the user has an access code, a verify code, and a primary menu
"KRN",19,528,1,17,0)
-When the user last signed on
"KRN",19,528,1,18,0)
-When the user was terminated (if applicable)
"KRN",19,528,1,19,0)
-If the user was terminated, then whether the site manager chose to delete
"KRN",19,528,1,20,0)
 the user's mailbox.  (Remember, you should usually answer 'yes' to this
"KRN",19,528,1,21,0)
 question, unless the user is coming back and needs to have his mail retained.)
"KRN",19,528,1,22,0)
-How many new messages the user has.  (New messages are never purged, except
"KRN",19,528,1,23,0)
 during purge-by-date purges.)
"KRN",19,528,1,24,0)

"KRN",19,528,1,25,0)
Finally there are two blank columns.  One is headed "Term User Mbox" (Terminate
"KRN",19,528,1,26,0)
user mailbox), and the other is headed "Deact VISTA Access" (Deactivate VISTA
"KRN",19,528,1,27,0)
Access).  Besides being of interest to the Site Manager, this report is also
"KRN",19,528,1,28,0)
designed to be submitted to other services. The intent is that the other
"KRN",19,528,1,29,0)
services would check one of the columns for each user in the report and return
"KRN",19,528,1,30,0)
the report to the Site Manager to act on. 
"KRN",19,528,25)
ALL2^XMZTERM
"KRN",19,528,"U")
TERMINATE MAIL USER SUGGESTION
"KRN",19,529,-1)
0^5
"KRN",19,529,0)
XMMGR-PURGE-MESSAGE^Purge a message^^R^^^^^^^^MAILMAN
"KRN",19,529,1,0)
^^9^9^2970516^^
"KRN",19,529,1,1,0)
This option enables you to purge any message.
"KRN",19,529,1,2,0)

"KRN",19,529,1,3,0)
Purge means:
"KRN",19,529,1,4,0)
-delete the message from all user mailboxes
"KRN",19,529,1,5,0)
-delete the message from the MESSAGE global ^XMB(3.9
"KRN",19,529,1,6,0)
-delete all responses from the MESSAGE global ^XMB(3.9
"KRN",19,529,1,7,0)
-delete the message from the MESSAGES TO BE NEW AT A LATER DATE file ^XMB(3.73
"KRN",19,529,1,8,0)

"KRN",19,529,1,9,0)
Purge is not reversible.  The message is gone forever.
"KRN",19,529,25)
MESSAGE^XMZTERM
"KRN",19,529,"U")
PURGE A MESSAGE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",6,-1)
1^1
"PKG",6,0)
MAILMAN^XM^Electronic Mail, both local and networked
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.1^2940602^2950925
"PKG",6,22,1,"PAH",1,0)
44^2970619
"PKG",6,22,1,"PAH",1,1,0)
^^143^143^2970623
"PKG",6,22,1,"PAH",1,1,1,0)
MailMan patch XM*7.1*44 contains the following enhancements:
"PKG",6,22,1,"PAH",1,1,2,0)

"PKG",6,22,1,"PAH",1,1,3,0)
NOIS:       OKL-0497-70538
"PKG",6,22,1,"PAH",1,1,4,0)
E3R:        9173,9994
"PKG",6,22,1,"PAH",1,1,5,0)
Rtns:       ^XMA32A,^XMADJF1,^XMGAPI3,^XMZTERM,^XMZTERM1
"PKG",6,22,1,"PAH",1,1,6,0)
Options:    XMMGR,XMMGR-TERMINATE-ONE,XMMGR-TERMINATE-MANY,
"PKG",6,22,1,"PAH",1,1,7,0)
            XMMGR-TERMINATE-SUGGEST,XMMGR-PURGE-MESSAGE
"PKG",6,22,1,"PAH",1,1,8,0)
Test Sites: Oklahoma City, OK; Prescott, AZ; St. Louis, MO; Houston, TX
"PKG",6,22,1,"PAH",1,1,9,0)

"PKG",6,22,1,"PAH",1,1,10,0)
Broadcast mail is now delivered only to users who have an access code, a verify
"PKG",6,22,1,"PAH",1,1,11,0)
code, a primary menu, and a mail box.
"PKG",6,22,1,"PAH",1,1,12,0)

"PKG",6,22,1,"PAH",1,1,13,0)
Four new options have been added to XMMGR-DISK-SPACE-MANAGEMENT menu:
"PKG",6,22,1,"PAH",1,1,14,0)

"PKG",6,22,1,"PAH",1,1,15,0)
----------------------------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,16,0)
NAME: XMMGR-PURGE-MESSAGE               MENU TEXT: Purge a message
"PKG",6,22,1,"PAH",1,1,17,0)
DESCRIPTION:  This option enables you to purge any message.
"PKG",6,22,1,"PAH",1,1,18,0)

"PKG",6,22,1,"PAH",1,1,19,0)
Purge means:
"PKG",6,22,1,"PAH",1,1,20,0)
-delete the message from all user mailboxes
"PKG",6,22,1,"PAH",1,1,21,0)
-delete the message from the MESSAGE global ^XMB(3.9
"PKG",6,22,1,"PAH",1,1,22,0)
-delete all responses from the MESSAGE global ^XMB(3.9
"PKG",6,22,1,"PAH",1,1,23,0)

"PKG",6,22,1,"PAH",1,1,24,0)
Purge is not reversible.  The message is gone forever.
"PKG",6,22,1,"PAH",1,1,25,0)

"PKG",6,22,1,"PAH",1,1,26,0)
----------------------------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,27,0)
NAME: XMMGR-TERMINATE-ONE               MENU TEXT: Terminate one mail user
"PKG",6,22,1,"PAH",1,1,28,0)
DESCRIPTION:   This option lets you remove the mailbox of any user
"PKG",6,22,1,"PAH",1,1,29,0)
who meets the criteria of either the XMMGR-TERMINATE-MANY option or the
"PKG",6,22,1,"PAH",1,1,30,0)
XMMGR-TERMINATE-SUGGEST option.
"PKG",6,22,1,"PAH",1,1,31,0)
As a result, the user will not receive any mail.  
"PKG",6,22,1,"PAH",1,1,32,0)

"PKG",6,22,1,"PAH",1,1,33,0)
Remember,
"PKG",6,22,1,"PAH",1,1,34,0)
-Whenever you give a user a new access code,
"PKG",6,22,1,"PAH",1,1,35,0)
 the system gives the user a mailbox if he doesn't already have one.
"PKG",6,22,1,"PAH",1,1,36,0)
-Whenever a user logs on,
"PKG",6,22,1,"PAH",1,1,37,0)
 the system gives the user a mailbox if he doesn't already have one.
"PKG",6,22,1,"PAH",1,1,38,0)

"PKG",6,22,1,"PAH",1,1,39,0)
----------------------------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,40,0)
NAME: XMMGR-TERMINATE-MANY              MENU TEXT: Terminate many mail users
"PKG",6,22,1,"PAH",1,1,41,0)
DESCRIPTION:   This option goes through the MAIL BOX global and removes any
"PKG",6,22,1,"PAH",1,1,42,0)
mailbox if
"PKG",6,22,1,"PAH",1,1,43,0)
- the user is not in the NEW PERSON file.
"PKG",6,22,1,"PAH",1,1,44,0)
- the user has no access code and was not terminated.
"PKG",6,22,1,"PAH",1,1,45,0)
- the user has no access code and was terminated w/o mailbox retention.
"PKG",6,22,1,"PAH",1,1,46,0)
- the user has an access code and primary menu, but no verify code, AND 
"PKG",6,22,1,"PAH",1,1,47,0)
  - has never signed on, since being added before a cutoff date.  
"PKG",6,22,1,"PAH",1,1,48,0)
  OR 
"PKG",6,22,1,"PAH",1,1,49,0)
  - last signed on before a cutoff date.
"PKG",6,22,1,"PAH",1,1,50,0)

"PKG",6,22,1,"PAH",1,1,51,0)
Remove means:
"PKG",6,22,1,"PAH",1,1,52,0)
- Delete user's private mail groups
"PKG",6,22,1,"PAH",1,1,53,0)
- Remove user from membership in all groups
"PKG",6,22,1,"PAH",1,1,54,0)
- Remove user as an authorized sender from all groups 
"PKG",6,22,1,"PAH",1,1,55,0)
- Remove user from anyone's list of surrogates
"PKG",6,22,1,"PAH",1,1,56,0)
- Delete user's latered-messages list
"PKG",6,22,1,"PAH",1,1,57,0)
- Delete user's mail box
"PKG",6,22,1,"PAH",1,1,58,0)
As a result, the user will not receive any mail.
"PKG",6,22,1,"PAH",1,1,59,0)

"PKG",6,22,1,"PAH",1,1,60,0)
This option can be run in 'test' or 'real' mode.  
"PKG",6,22,1,"PAH",1,1,61,0)

"PKG",6,22,1,"PAH",1,1,62,0)
The report lists, in DUZ order:
"PKG",6,22,1,"PAH",1,1,63,0)
-The user's DUZ and name
"PKG",6,22,1,"PAH",1,1,64,0)
-Whether the user has an access code, verify code, and primary menu
"PKG",6,22,1,"PAH",1,1,65,0)
-When the user was added to the NEW PERSON file
"PKG",6,22,1,"PAH",1,1,66,0)
-When the user last signed on
"PKG",6,22,1,"PAH",1,1,67,0)
-When the user was terminated (if applicable)
"PKG",6,22,1,"PAH",1,1,68,0)
-If the user was terminated, then whether the site manager chose to delete
"PKG",6,22,1,"PAH",1,1,69,0)
 the user's mailbox.  (It's generally a good idea to go ahead and delete
"PKG",6,22,1,"PAH",1,1,70,0)
 the mailbox upon termination.) 
"PKG",6,22,1,"PAH",1,1,71,0)

"PKG",6,22,1,"PAH",1,1,72,0)
----------------------------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,73,0)
NAME: XMMGR-TERMINATE-SUGGEST
"PKG",6,22,1,"PAH",1,1,74,0)
MENU TEXT: Terminate mail user suggestions
"PKG",6,22,1,"PAH",1,1,75,0)
DESCRIPTION:   This option goes through the MailBox global and reports on
"PKG",6,22,1,"PAH",1,1,76,0)
users who perhaps should have their mail access terminated.  
"PKG",6,22,1,"PAH",1,1,77,0)

"PKG",6,22,1,"PAH",1,1,78,0)
Users are included in the report if
"PKG",6,22,1,"PAH",1,1,79,0)
- the user was terminated before a manager-supplied cutoff date
"PKG",6,22,1,"PAH",1,1,80,0)
  and allowed to keep a mailbox.
"PKG",6,22,1,"PAH",1,1,81,0)
- the user has an access code, verify code, and primary menu,
"PKG",6,22,1,"PAH",1,1,82,0)
  but last signed on before a manager-supplied cutoff date.  
"PKG",6,22,1,"PAH",1,1,83,0)

"PKG",6,22,1,"PAH",1,1,84,0)
This option does not terminate mail access.  
"PKG",6,22,1,"PAH",1,1,85,0)

"PKG",6,22,1,"PAH",1,1,86,0)
The report page breaks on Service/Section and includes the following 
"PKG",6,22,1,"PAH",1,1,87,0)
information: 
"PKG",6,22,1,"PAH",1,1,88,0)
-User's DUZ and name
"PKG",6,22,1,"PAH",1,1,89,0)
-Whether the user has an access code, a verify code, and a primary menu
"PKG",6,22,1,"PAH",1,1,90,0)
-When the user last signed on
"PKG",6,22,1,"PAH",1,1,91,0)
-When the user was terminated (if applicable)
"PKG",6,22,1,"PAH",1,1,92,0)
-If the user was terminated, then whether the site manager chose
"PKG",6,22,1,"PAH",1,1,93,0)
 to delete the user's mailbox.  (Remember, you should usually answer 'yes'
"PKG",6,22,1,"PAH",1,1,94,0)
 to this question, unless the user is coming back and needs to have his mail
"PKG",6,22,1,"PAH",1,1,95,0)
 retained.)
"PKG",6,22,1,"PAH",1,1,96,0)
-How many new messages the user has.  (New messages are never purged, except 
"PKG",6,22,1,"PAH",1,1,97,0)
 during purge-by-date purges.) 
"PKG",6,22,1,"PAH",1,1,98,0)

"PKG",6,22,1,"PAH",1,1,99,0)
Finally there are two blank columns.  One is headed "Term User Mbox"
"PKG",6,22,1,"PAH",1,1,100,0)
(Terminate user mailbox), and the other is headed "Deact VISTA Access"
"PKG",6,22,1,"PAH",1,1,101,0)
(Deactivate VISTA Access).  Besides being of interest to the Site Manager,
"PKG",6,22,1,"PAH",1,1,102,0)
this report is also designed to be submitted to other services. The intent is
"PKG",6,22,1,"PAH",1,1,103,0)
that the other services would check one of the columns for each user in the
"PKG",6,22,1,"PAH",1,1,104,0)
report and return the report to the Site Manager to act on. 
"PKG",6,22,1,"PAH",1,1,105,0)

"PKG",6,22,1,"PAH",1,1,106,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,107,0)
This patch should be installed after hours, when user activity is at a
"PKG",6,22,1,"PAH",1,1,108,0)
minimum.  You should put the XMUSER Option out of order.  The filers should
"PKG",6,22,1,"PAH",1,1,109,0)
be shut down.  ^XMADJF1 is probably mapped on your system.
"PKG",6,22,1,"PAH",1,1,110,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,111,0)
 
"PKG",6,22,1,"PAH",1,1,112,0)
INSTALLATION:
"PKG",6,22,1,"PAH",1,1,113,0)
1.  If any of these routines is mapped (on systems which allow mapping),
"PKG",6,22,1,"PAH",1,1,114,0)
    disable mapping for the affected routine(s).
"PKG",6,22,1,"PAH",1,1,115,0)
2.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option to load
"PKG",6,22,1,"PAH",1,1,116,0)
    the patch into a transport global.
"PKG",6,22,1,"PAH",1,1,117,0)
3.  On the KIDS:Installation menu, use the following options to install the
"PKG",6,22,1,"PAH",1,1,118,0)
    Transport Global:
"PKG",6,22,1,"PAH",1,1,119,0)
       Verify Checksums in Transport Global
"PKG",6,22,1,"PAH",1,1,120,0)
       Print Transport Global
"PKG",6,22,1,"PAH",1,1,121,0)
       Compare Transport Global to Current System
"PKG",6,22,1,"PAH",1,1,122,0)
       Backup a Transport Global
"PKG",6,22,1,"PAH",1,1,123,0)
       Install Package(s)
"PKG",6,22,1,"PAH",1,1,124,0)
4.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"PKG",6,22,1,"PAH",1,1,125,0)
    other CPUs?'. Enter the names of your Compute and Print server(s).
"PKG",6,22,1,"PAH",1,1,126,0)
5.  AXP Sites, after patch has installed, rebuild your map set.
"PKG",6,22,1,"PAH",1,1,127,0)
============================================================================ 
"PKG",6,22,1,"PAH",1,1,128,0)
  
"PKG",6,22,1,"PAH",1,1,129,0)
ROUTINES:
"PKG",6,22,1,"PAH",1,1,130,0)
The second line of the routine now looks like:
"PKG",6,22,1,"PAH",1,1,131,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"PKG",6,22,1,"PAH",1,1,132,0)
 
"PKG",6,22,1,"PAH",1,1,133,0)
              Before          After
"PKG",6,22,1,"PAH",1,1,134,0)
Name          Checksum        Checksum        Patch List
"PKG",6,22,1,"PAH",1,1,135,0)
----------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,136,0)
XMA32A         9601895        10911370        27,37,44
"PKG",6,22,1,"PAH",1,1,137,0)
XMADJF1        8481461         8709221        44
"PKG",6,22,1,"PAH",1,1,138,0)
XMGAPI3        2791662         3149530        29,44
"PKG",6,22,1,"PAH",1,1,139,0)
XMZTERM        * new *        15108400        44
"PKG",6,22,1,"PAH",1,1,140,0)
XMZTERM1       * new *        14445630        44
"PKG",6,22,1,"PAH",1,1,141,0)

"PKG",6,22,1,"PAH",1,1,142,0)
* Checksums produced by CHECK^XTSUMBLD
"PKG",6,22,1,"PAH",1,1,143,0)
============================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","XMA32A")
0^5^B51302759
"RTN","XMA32A",1,0)
XMA32A ;(WASH ISC)/CAP - PURGE MESSAGES BY DATE ;05/19/97  15:03
"RTN","XMA32A",2,0)
 ;;7.1;MailMan;**27,37,44**;Jun 02, 1994
"RTN","XMA32A",3,0)
 ; XMPARM("PDATE") Purge all messages older than this date
"RTN","XMA32A",4,0)
 ; XMPARM("START") First message to process
"RTN","XMA32A",5,0)
 ; XMPARM("END")   Last message to process
"RTN","XMA32A",6,0)
 ; XMPARM("STOP ON DATE") =0 Don't stop when we hit the first message
"RTN","XMA32A",7,0)
 ;                           with a date greater than XMPARM("PDATE");
"RTN","XMA32A",8,0)
 ;                           Rather, continue through message number
"RTN","XMA32A",9,0)
 ;                           XMPARM("END")
"RTN","XMA32A",10,0)
 ;                        =1 Stop when we hit the first message with a
"RTN","XMA32A",11,0)
 ;                           date greater than XMPARM("PDATE").
"RTN","XMA32A",12,0)
 ;                           But, don't go past message number XMPARM("END")
"RTN","XMA32A",13,0)
 ; XMCNT           Total messages processed
"RTN","XMA32A",14,0)
 ; XMKILL("MSG")   Messages purged
"RTN","XMA32A",15,0)
 ; XMKILL("RESP")  Responses killed
"RTN","XMA32A",16,0)
 ; XMDUZ           Pointer to mailbox
"RTN","XMA32A",17,0)
 ; XMZTMP          Holder for XMZ
"RTN","XMA32A",18,0)
 ; XMZ             Current message being processed
"RTN","XMA32A",19,0)
 ; XMDATERR        Count of messages with bad dates
"RTN","XMA32A",20,0)
ENT ;
"RTN","XMA32A",21,0)
 N XMIEN,XMPDATE,XMCNT,XMKILL,XMZ,XMNOW,XMABORT,XMFDA,XMPAGE,XMDATERR
"RTN","XMA32A",22,0)
 D INIT
"RTN","XMA32A",23,0)
 D PROCESS
"RTN","XMA32A",24,0)
 D FINISH
"RTN","XMA32A",25,0)
 Q
"RTN","XMA32A",26,0)
INIT ;
"RTN","XMA32A",27,0)
 S (XMPAGE,XMCNT,XMKILL("MSG"),XMKILL("RESP"),XMDATERR,XMABORT)=0
"RTN","XMA32A",28,0)
 D INITAUDT(.XMPARM,.XMIEN,.XMNOW)
"RTN","XMA32A",29,0)
 S XMPDATE=$E(XMPARM("PDATE"),4,5)_"/"_$E(XMPARM("PDATE"),6,7)_"/"_$E(XMPARM("PDATE"),2,3)
"RTN","XMA32A",30,0)
 S XMNOW=$$DOW^XLFDT(XMNOW)_", "_$$FMTE^XLFDT(XMNOW,1)
"RTN","XMA32A",31,0)
 W:IOST["C-" @IOF D PRTHDR
"RTN","XMA32A",32,0)
 Q
"RTN","XMA32A",33,0)
INITAUDT(XMPARM,XMIEN,XMNOW) ;
"RTN","XMA32A",34,0)
 S XMNOW=$$NOW^XLFDT
"RTN","XMA32A",35,0)
 S XMFDA(4.302,"+1,1,",.01)=XMNOW
"RTN","XMA32A",36,0)
 S XMFDA(4.302,"+1,1,",3)=XMPARM("START")
"RTN","XMA32A",37,0)
 S XMFDA(4.302,"+1,1,",4)=XMPARM("END")
"RTN","XMA32A",38,0)
 S XMFDA(4.302,"+1,1,",5)=$S(XMPARM("TYPE")=2:"1TEST",1:XMPARM("TYPE"))
"RTN","XMA32A",39,0)
 S XMFDA(4.302,"+1,1,",6)=XMPARM("PDATE")
"RTN","XMA32A",40,0)
 D UPDATE^DIE("","XMFDA","XMIEN")
"RTN","XMA32A",41,0)
 S XMIEN=XMIEN(1)
"RTN","XMA32A",42,0)
 Q
"RTN","XMA32A",43,0)
PROCESS ;
"RTN","XMA32A",44,0)
 N XMDATE,XMR,XMZO
"RTN","XMA32A",45,0)
 S XMDATE=0
"RTN","XMA32A",46,0)
 S XMZ=XMPARM("START")-1
"RTN","XMA32A",47,0)
 F  S XMZ=$O(^XMB(3.9,XMZ)) Q:XMZ'>0!(XMZ>XMPARM("END"))!XMABORT  D  I XMPARM("STOP ON DATE"),XMDATE'<XMPARM("PDATE") Q
"RTN","XMA32A",48,0)
 . S XMCNT=XMCNT+1 I XMCNT#5000=0 D CHK
"RTN","XMA32A",49,0)
 . S XMR=$G(^XMB(3.9,XMZ,0)) I XMR="" D KILL(XMZ,.XMKILL,.XMPARM) Q
"RTN","XMA32A",50,0)
 . Q:$D(^XMB(3.7,"M",XMZ,.6))  ; Do nothing if owned by SHARED,MAIL
"RTN","XMA32A",51,0)
 . S XMDATE=$P(XMR,U,3) ; Date sent
"RTN","XMA32A",52,0)
 . I XMDATE'?7N1".".N,XMDATE'?7N S XMDATE=$$CONVERT(XMDATE)
"RTN","XMA32A",53,0)
 . I XMDATE<2000000 D  Q
"RTN","XMA32A",54,0)
 . . S XMDATERR=XMDATERR+1
"RTN","XMA32A",55,0)
 . . D HDR(2) Q:XMABORT
"RTN","XMA32A",56,0)
 . . W !,XMZ,?15,"*** Bad date: ",$P(XMR,U,3),?79
"RTN","XMA32A",57,0)
 . ;S XMDATE=$P(XMDATE,".")
"RTN","XMA32A",58,0)
 . Q:XMDATE'<XMPARM("PDATE")
"RTN","XMA32A",59,0)
 . S XMZO=$S($P(XMR,U,8):$P(XMR,U,8),$P(XMR,U)?1"R"1.N:+$E(XMR,2,99),1:"")
"RTN","XMA32A",60,0)
 . I XMZO,XMZO<XMZ,$D(^XMB(3.9,XMZO,0)) Q  ; Response with existing original msg
"RTN","XMA32A",61,0)
 . D KILL(XMZ,.XMKILL,.XMPARM)  ; Old msg; old response without original msg; old msg which thinks it's also a response; old response which thinks it's also the original msg.
"RTN","XMA32A",62,0)
 Q
"RTN","XMA32A",63,0)
KILL(XMZ,XMKILL,XMPARM) ;
"RTN","XMA32A",64,0)
 I $G(XMPARM("TEST")) D  Q:XMABORT
"RTN","XMA32A",65,0)
 . D HDR(2) Q:XMABORT
"RTN","XMA32A",66,0)
 . N X
"RTN","XMA32A",67,0)
 . S X=$P($P(XMR,U,3),".")
"RTN","XMA32A",68,0)
 . W !,XMZ,?20," <<< Purge!  Date = ",$S(X?7N.E:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:X)
"RTN","XMA32A",69,0)
 D KBASKETS Q:XMABORT
"RTN","XMA32A",70,0)
 D KMSG Q:XMABORT
"RTN","XMA32A",71,0)
 D KLATER
"RTN","XMA32A",72,0)
 Q
"RTN","XMA32A",73,0)
KBASKETS ;
"RTN","XMA32A",74,0)
 N XMDUZ,XMK
"RTN","XMA32A",75,0)
 S XMDUZ="",XMKILL("MSG")=XMKILL("MSG")+1
"RTN","XMA32A",76,0)
 F  S XMDUZ=$O(^XMB(3.7,"M",XMZ,XMDUZ)) Q:XMDUZ=""!XMABORT  D
"RTN","XMA32A",77,0)
 . S XMK=$O(^XMB(3.7,"M",XMZ,XMDUZ,0))
"RTN","XMA32A",78,0)
 . Q:'XMK
"RTN","XMA32A",79,0)
 . Q:'$D(^XMB(3.7,XMDUZ,2,XMK,1,XMZ))
"RTN","XMA32A",80,0)
 . I $G(XMPARM("TEST")) D  Q
"RTN","XMA32A",81,0)
 . . D HDR(2) Q:XMABORT
"RTN","XMA32A",82,0)
 . . W !?25,"Message deleted for DUZ:",?50,$J(XMDUZ,12),?79
"RTN","XMA32A",83,0)
 . D KL^XMA1B ; Delete from user's basket
"RTN","XMA32A",84,0)
 Q
"RTN","XMA32A",85,0)
KMSG ;
"RTN","XMA32A",86,0)
 N XMZTMP,XMZO,X
"RTN","XMA32A",87,0)
 S XMZTMP=XMZ,XMZO=0
"RTN","XMA32A",88,0)
 F  S XMZO=$O(^XMB(3.9,XMZTMP,3,XMZO)) Q:XMZO'>0!XMABORT  D
"RTN","XMA32A",89,0)
 . S XMZ=$P($G(^XMB(3.9,XMZTMP,3,XMZO,0)),U)
"RTN","XMA32A",90,0)
 . S XMKILL("RESP")=XMKILL("RESP")+1
"RTN","XMA32A",91,0)
 . I $G(XMPARM("TEST")) D  Q
"RTN","XMA32A",92,0)
 . . D HDR(2) Q:XMABORT
"RTN","XMA32A",93,0)
 . . W !?25,"Response deleted:",?50,$J(XMZ,12),?79
"RTN","XMA32A",94,0)
 . D KILL^XMA3  ; Kill response
"RTN","XMA32A",95,0)
 S XMZ=XMZTMP
"RTN","XMA32A",96,0)
 D:'$G(XMPARM("TEST")) KILL^XMA3  ; Kill original message
"RTN","XMA32A",97,0)
 Q
"RTN","XMA32A",98,0)
KLATER ;
"RTN","XMA32A",99,0)
 Q:$G(XMPARM("TEST"))
"RTN","XMA32A",100,0)
 N DIK,DA,XMDUZ
"RTN","XMA32A",101,0)
 S DIK="^XMB(3.73,"
"RTN","XMA32A",102,0)
 S (XMDUZ,DA)=""
"RTN","XMA32A",103,0)
 F  S XMDUZ=$O(^XMB(3.73,"AC",XMZ,XMDUZ)) Q:'XMDUZ  D
"RTN","XMA32A",104,0)
 . F  S DA=$O(^XMB(3.73,"AC",XMZ,XMDUZ,DA)) Q:'DA  D ^DIK
"RTN","XMA32A",105,0)
 Q
"RTN","XMA32A",106,0)
HDR(XMLINES) ;
"RTN","XMA32A",107,0)
 Q:$Y+XMLINES<IOSL
"RTN","XMA32A",108,0)
 I IOST["C-" D  Q:XMABORT
"RTN","XMA32A",109,0)
 . N DIR
"RTN","XMA32A",110,0)
 . S DIR(0)="E"
"RTN","XMA32A",111,0)
 . D ^DIR S:$D(DIRUT) XMABORT=1
"RTN","XMA32A",112,0)
 W @IOF D PRTHDR
"RTN","XMA32A",113,0)
 Q
"RTN","XMA32A",114,0)
PRTHDR ;
"RTN","XMA32A",115,0)
 S XMPAGE=XMPAGE+1
"RTN","XMA32A",116,0)
 W "Message purge, Origination date < ",XMPDATE
"RTN","XMA32A",117,0)
 W "      From: ",$J(XMPARM("START"),$L(XMPARM("END"))),"   Page: ",XMPAGE
"RTN","XMA32A",118,0)
 W !,"Started: ",XMNOW,?50,"To: ",XMPARM("END"),$S(XMPARM("TEST"):"  *TEST RUN*",1:""),!
"RTN","XMA32A",119,0)
 Q
"RTN","XMA32A",120,0)
FINISH ;
"RTN","XMA32A",121,0)
 I XMABORT W @IOF D PRTHDR
"RTN","XMA32A",122,0)
 D CHK
"RTN","XMA32A",123,0)
 D HDR(5+(2*$G(ZTSTOP)))
"RTN","XMA32A",124,0)
 Q:'XMCNT
"RTN","XMA32A",125,0)
 I $G(ZTSTOP) W !!,"*** Stopping prematurely per user request ***"
"RTN","XMA32A",126,0)
 W !!,"Message purge finished on ",$$FMTE^XLFDT($$NOW^XLFDT,1)
"RTN","XMA32A",127,0)
 W !,XMCNT," messages processed."
"RTN","XMA32A",128,0)
 W !,XMKILL("MSG")," original messages and ",XMKILL("RESP")," responses purged."
"RTN","XMA32A",129,0)
 W !,XMDATERR," messages had indecipherable dates."
"RTN","XMA32A",130,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","XMA32A",131,0)
 Q:XMPARM("TEST")
"RTN","XMA32A",132,0)
 S $P(^(0),U,4)=$P(^XMB(3.9,0),U,4)-XMKILL("MSG")-XMKILL("RESP")
"RTN","XMA32A",133,0)
 Q
"RTN","XMA32A",134,0)
CHK ;
"RTN","XMA32A",135,0)
 D CHKAUDT(XMIEN,XMZ,.XMKILL)
"RTN","XMA32A",136,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S (XMABORT,ZTSTOP)=1  Q  ; User has asked the task to stop
"RTN","XMA32A",137,0)
 Q:IOST'["C-"
"RTN","XMA32A",138,0)
 I $X+$L(XMCNT)+1>IOM D
"RTN","XMA32A",139,0)
 . D HDR(2)
"RTN","XMA32A",140,0)
 . W !
"RTN","XMA32A",141,0)
 E  W " "
"RTN","XMA32A",142,0)
 W XMCNT
"RTN","XMA32A",143,0)
 Q
"RTN","XMA32A",144,0)
CHKAUDT(XMIEN,XMZ,XMKILL) ;
"RTN","XMA32A",145,0)
 S XMFDA(4.302,XMIEN_",1,",1)=$P(^XMB(3.9,0),U,4)-XMKILL("MSG")-XMKILL("RESP")
"RTN","XMA32A",146,0)
 S XMFDA(4.302,XMIEN_",1,",2)=XMKILL("MSG")+XMKILL("RESP")
"RTN","XMA32A",147,0)
 S XMFDA(4.302,XMIEN_",1,",7)=$$NOW^XLFDT
"RTN","XMA32A",148,0)
 S XMFDA(4.302,XMIEN_",1,",8)=XMZ-1
"RTN","XMA32A",149,0)
 D FILE^DIE("","XMFDA")
"RTN","XMA32A",150,0)
 Q
"RTN","XMA32A",151,0)
 ; Formats:  Tuesday, 28 June 1955 17:30:45 PDT
"RTN","XMA32A",152,0)
 ;           Tue, 28 Jun 1955 17:30:45 PDT
"RTN","XMA32A",153,0)
 ;           Tue 28 Jun 1955 17:30:45 PDT
"RTN","XMA32A",154,0)
 ;           28 Jun 55 17:30 PST                 <== MailMan standard
"RTN","XMA32A",155,0)
 ;           Tue Jun 28 17:30:45 PDT 1955
"RTN","XMA32A",156,0)
 ;           28-JUN-1955 17:30:45 -0400
"RTN","XMA32A",157,0)
 ;           6/28/55 17:30
"RTN","XMA32A",158,0)
 ;           JUN 28 17:30 1955
"RTN","XMA32A",159,0)
CONVERT(X,XMTIME) ; Function to convert Internet dates to FM (returns -1 if error)
"RTN","XMA32A",160,0)
 ; X      Internet date
"RTN","XMA32A",161,0)
 ; XMTIME =1 Convert time, too; =0 convert date only
"RTN","XMA32A",162,0)
 N %DT,Y
"RTN","XMA32A",163,0)
 I $E(X)=" "!($E(X)=$C(9)) F  S X=$E(X,2,99) Q:$E(X)'=$C(9)&($E(X)'=" ")  ; remove leading blanks or tabs
"RTN","XMA32A",164,0)
 I X?.E2" ".E D  ; reduce all consecutive blanks to 1 blank
"RTN","XMA32A",165,0)
 . N I S I=1
"RTN","XMA32A",166,0)
 . F  S I=$F(X,"  ",I) Q:I=0  S X=$E(X,1,I-2)_$E(X,I,99),I=I-1
"RTN","XMA32A",167,0)
 I X?3.A.E D
"RTN","XMA32A",168,0)
 . I X?3.A1", ".E!(X?3.A1" "3.A.E)!(X?3.A1" "1.2N1" "3.A.E) S X=$P(X," ",2,99) ; remove leading day of week
"RTN","XMA32A",169,0)
 I $P(X," ",3)[":" D
"RTN","XMA32A",170,0)
 . S XMD=$P(X," ",1,2)_" "_$P(X," ",$L(X," ")) ; time is before year
"RTN","XMA32A",171,0)
 . S XMT=$P(X," ",3,$L(X," ")-1)
"RTN","XMA32A",172,0)
 E  D
"RTN","XMA32A",173,0)
 . S XMD=$P(X," ",1,3) ; year is before time
"RTN","XMA32A",174,0)
 . I XMD[":" D
"RTN","XMA32A",175,0)
 . . S XMD=$P(X," ",1) ; "28-JUN-1955 17:30:45 -0400" or "6/28/55 17:30"
"RTN","XMA32A",176,0)
 . . S XMT=$P(X," ",2,99)
"RTN","XMA32A",177,0)
 . E  S XMT=$P(X," ",4,99)
"RTN","XMA32A",178,0)
 I $G(XMTIME) Q $$TIMETOO(XMD,XMT)
"RTN","XMA32A",179,0)
 S X=XMD
"RTN","XMA32A",180,0)
 S %DT="P" D ^%DT
"RTN","XMA32A",181,0)
 Q Y
"RTN","XMA32A",182,0)
TIMETOO(XMD,XMT) ; Combine date and time, adjusting for difference from GMT.
"RTN","XMA32A",183,0)
 N XMHH,XMMM,X,Y
"RTN","XMA32A",184,0)
 Q:$L(XMT," ")'=2 -1
"RTN","XMA32A",185,0)
 S XMYT=$P(XMT," ",2)
"RTN","XMA32A",186,0)
 D ZONEDIFF(XMYT,.XMHH,.XMMM) Q:XMHH=-1 -1
"RTN","XMA32A",187,0)
 S XMT=$P(XMT," ",1)
"RTN","XMA32A",188,0)
 S:$P(XMT,":")=0 XMT="0"_XMT
"RTN","XMA32A",189,0)
 S XMT=$E(XMT,1,5)  ; FM will only handle hh:mm, not :ss
"RTN","XMA32A",190,0)
 S:XMT="00:00" XMT="00:01" ; if midnight, add a minute
"RTN","XMA32A",191,0)
 S X=XMD_"@"_XMT
"RTN","XMA32A",192,0)
 S %DT="PT" D ^%DT Q:Y=-1 -1
"RTN","XMA32A",193,0)
 I 'XMHH,'XMMM Q Y
"RTN","XMA32A",194,0)
 Q $$FMADD^XLFDT(Y,"",XMHH,XMMM)
"RTN","XMA32A",195,0)
ZONEDIFF(XMYT,XMHH,XMMM) ;
"RTN","XMA32A",196,0)
 ; XMYT  ; Your Time difference from GMT
"RTN","XMA32A",197,0)
 ; XMHH  ; Your Time difference from GMT in hours
"RTN","XMA32A",198,0)
 ; XMTD  ; Time Difference between the two time zones
"RTN","XMA32A",199,0)
 ; XMMM  ; Your Time difference from GMT in minutes
"RTN","XMA32A",200,0)
 ; XMMT  ; My Time difference from GMT
"RTN","XMA32A",201,0)
 N XMMT,XMTD
"RTN","XMA32A",202,0)
 S XMMT=$G(^XMB("GMT"))
"RTN","XMA32A",203,0)
 I XMMT="" D
"RTN","XMA32A",204,0)
 . I '$D(^XMB("TIMEZONE")) S ^XMB("TIMEZONE")=$P(^XMB(1,1,0),U,2)
"RTN","XMA32A",205,0)
 . S XMMT=$P(^XMB(4.4,$O(^XMB(4.4,"B",^XMB("TIMEZONE"),0)),0),U,3)*100
"RTN","XMA32A",206,0)
 I XMYT=^XMB("TIMEZONE")!(+XMYT=XMMT) S (XMHH,XMMM)=0 Q
"RTN","XMA32A",207,0)
 I XMYT?3A D  I XMYT="" S XMHH=-1 Q
"RTN","XMA32A",208,0)
 . S XMYT=$P($G(^XMB(4.4,+$O(^XMB(4.4,"B",XMYT,0)),0)),U,3)*100
"RTN","XMA32A",209,0)
 S XMTD=XMMT-XMYT
"RTN","XMA32A",210,0)
 S XMHH=XMTD\100
"RTN","XMA32A",211,0)
 S XMMM=XMTD-(XMHH*100)
"RTN","XMA32A",212,0)
 Q
"RTN","XMA32A",213,0)
 ; Also, remember, FM will not handle a 1-digit year
"RTN","XMA32A",214,0)
 ; If this becomes a problem:
"RTN","XMA32A",215,0)
 I $L($P(X," ",3))=1 S $P(X," ",3)="0"_$P(X," ",3)
"RTN","XMA32A",216,0)
 ; *****************************************************
"RTN","XMADJF1")
0^2^B13649207
"RTN","XMADJF1",1,0)
XMADJF1 ;(WASH ISC)/CAP-MailMan DELIVER ;04/18/97  09:12
"RTN","XMADJF1",2,0)
 ;;7.1;MailMan;**44**;Jun 02, 1994
"RTN","XMADJF1",3,0)
 ;
"RTN","XMADJF1",4,0)
 ;XMADJF1A is Front-end
"RTN","XMADJF1",5,0)
 ;
"RTN","XMADJF1",6,0)
 D NOW^%DTC
"RTN","XMADJF1",7,0)
 S XMADF=0,%DT=%,(XMC0,XMZ2,V,W)=0,XMA0=$O(^XMBPOST("PGROUP"_$E(XMSTATT),$E(XMSTATT,2),XMTSTAMP,Z,0)),XMB0="^3.9001^^"
"RTN","XMADJF1",8,0)
 K XMD0,XMF0,XMK
"RTN","XMADJF1",9,0)
 I $E(Z)'="R" S J=$S($D(^XMBPOST("PGROUP"_$E(XMSTATT),$E(XMSTATT,2),XMTSTAMP,Z))#10:^(Z),1:""),XMDUZ=+J,XMZ=Z S:$D(^XMB(3.9,XMZ,3,0)) XMB0=^(0) G 1:XMDUZ=J S:$P(J,U,2)="* LOCAL BROADCAST" XMD0=1 S:$L($P(J,U,3)) XMK=$P(J,U,3) G 1
"RTN","XMADJF1",10,0)
 ;
"RTN","XMADJF1",11,0)
 S XMZ2=$P(^XMBPOST("PGROUP"_$E(XMSTATT),$E(XMSTATT,2),XMTSTAMP,Z,XMA0),U,5),XMDUZ=$P(XMA0,":",2) S:$D(^(0)) V=^(0) S XMZ=$E(Z,2,9)
"RTN","XMADJF1",12,0)
 ;
"RTN","XMADJF1",13,0)
 ;RESPONSES
"RTN","XMADJF1",14,0)
 I $D(^XMB(3.9,XMZ2,0)),'$P(^(0),U,3) S $P(^(0),U,3)=%DT
"RTN","XMADJF1",15,0)
 I $D(^XMB(3.9,XMZ,3,0)) S XMB0=^(0)
"RTN","XMADJF1",16,0)
 ;
"RTN","XMADJF1",17,0)
 ;Post responses to message response multiple
"RTN","XMADJF1",18,0)
 ;keeping track of number of deliveries
"RTN","XMADJF1",19,0)
 ;
"RTN","XMADJF1",20,0)
 K XMA0("R")
"RTN","XMADJF1",21,0)
R S XMA0=$O(^XMBPOST("PGROUP"_$E(XMSTATT),$E(XMSTATT,2),XMTSTAMP,Z,0)) G RQ:XMA0="" S %=^(XMA0),XMSTATN=$G(XMSTATN)+1,XMSTATS=$G(XMSTATS)+$P(%,U,8),XMZ2=$P(%,U,5) K ^(XMA0) D STATS^XMADJF0
"RTN","XMADJF1",22,0)
 I '$D(^XMB(3.9,XMZ2)) D ERR^XMAD0 K ^XMBPOST("PGROUP"_$E(XMSTATT),$E(XMSTATT,2),XMTSTAMP,Z,XMA0) G RES^XMAD2
"RTN","XMADJF1",23,0)
 S XMC0=XMC0+1,^XMB(3.9,XMZ,3,XMC0+$P(XMB0,U,3),0)=XMZ2
"RTN","XMADJF1",24,0)
 I $E(XMA0,1,3)="NR:" G R:$D(XMA0("R")),RR
"RTN","XMADJF1",25,0)
 S XMDUZ=$P(XMA0,":",2),XMF0(XMDUZ)="" G R:$D(XMA0("R"))
"RTN","XMADJF1",26,0)
 S %=$O(^XMB(3.9,XMZ,1,"C",XMDUZ,0)) I %,$D(^XMB(3.9,XMZ,1,%,0)) S $P(^(0),U,2)=$P(XMB0,U,3)+1
"RTN","XMADJF1",27,0)
RR S XMA0("R")=1 G R
"RTN","XMADJF1",28,0)
RQ S %=$P(XMB0,U,3)+XMC0,$P(XMB0,U,3,4)=%_U_%,^XMB(3.9,XMZ,3,0)=XMB0
"RTN","XMADJF1",29,0)
 ;
"RTN","XMADJF1",30,0)
1 I '$D(^XMB(3.9,XMZ,0)) D ERR1^XMAD0 K ^XMBPOST("PGROUP"_$E(XMSTATT),$E(XMSTATT,2),XMTSTAMP,Z) D ENTL^XMADGO1 G H^XUS
"RTN","XMADJF1",31,0)
 S XMR=^(0),J=$P(XMR,U,2)
"RTN","XMADJF1",32,0)
 ;
"RTN","XMADJF1",33,0)
 I J,$E(Z)="R",'$D(^XMB(3.9,XMZ,1,"C",J)) S %=$S($D(^XMB(3.9,XMZ,1,0)):^(0),1:"^3.91LA^0^0"),K=$P(%,U,3)+1,$P(%,U,3,4)=K_U_($P(%,U,4)+1),^(0)=%,^("C",J,K)="",^XMB(3.9,XMZ,1,K,0)=J
"RTN","XMADJF1",34,0)
 I $E(Z)'="R",XMA0 S XMDUZ=$S($D(^XMBPOST("PGROUP"_$E(XMSTATT),$E(XMSTATT,2),XMTSTAMP,Z))#10:+^(Z),1:0) G FD
"RTN","XMADJF1",35,0)
 I $D(XMD0) K XMD0 G B
"RTN","XMADJF1",36,0)
 ;
"RTN","XMADJF1",37,0)
 ;TO ALL
"RTN","XMADJF1",38,0)
0 S V=$O(^XMB(3.9,XMZ,1,V)) G E^XMADJF1B:'V
"RTN","XMADJF1",39,0)
 G 0:$D(^XMB(3.9,XMZ,1,V,"D")) S Y=^(0) G 0:+Y'=$P(Y,U) S Y=+Y
"RTN","XMADJF1",40,0)
 I $E(Z)'="R",$D(^XMBPOST("PGROUP"_$E(XMSTATT),$E(XMSTATT,2),XMTSTAMP,XMZ,0,Y)) S %=^(Y),XMK=$P(%,":"),%=$P(%,":",2) I % S XMADEL=%
"RTN","XMADJF1",41,0)
 D OK^XMADJF1B K XMK,XMADEL G 0
"RTN","XMADJF1",42,0)
 ;
"RTN","XMADJF1",43,0)
B ;BROADCAST
"RTN","XMADJF1",44,0)
 F  S V=$O(^XMB(3.7,V)) Q:'V  D
"RTN","XMADJF1",45,0)
 . ; must have access code, verify code, and primary menu
"RTN","XMADJF1",46,0)
 . Q:$P($G(^VA(200,V,0)),U,3)=""!($P($G(^(.1)),U,2)="")!($P($G(^(201)),U)="")
"RTN","XMADJF1",47,0)
 . S Y=V
"RTN","XMADJF1",48,0)
 . D OK^XMADJF1B
"RTN","XMADJF1",49,0)
 G E^XMADJF1B
"RTN","XMADJF1",50,0)
 ;
"RTN","XMADJF1",51,0)
 ;FORWARD
"RTN","XMADJF1",52,0)
FD S V=$O(^XMBPOST("PGROUP"_$E(XMSTATT),$E(XMSTATT,2),XMTSTAMP,Z,0)) G E^XMADJF1B:'V S W=^(V)
"RTN","XMADJF1",53,0)
FD1 S Y=$P(W,U),W=$P(W,U,2,99)
"RTN","XMADJF1",54,0)
 I Y="" G FD1:W'="" K ^XMBPOST("PGROUP"_$E(XMSTATT),$E(XMSTATT,2),XMTSTAMP,Z,V) G FD
"RTN","XMADJF1",55,0)
 S XMK=$P(Y,":",2),%=$P(Y,":",3),Y=+Y S:% XMADEL=% G FDQ:$O(^XMB(3.7,"M",XMZ,Y,.9))
"RTN","XMADJF1",56,0)
 S J=$O(^XMB(3.9,XMZ,1,"C",Y,0)) G FDQ:J<1
"RTN","XMADJF1",57,0)
 S XMDUZ=$S(XMDUZ:XMDUZ,$D(^XMB(3.9,XMZ,1,J,"F")):$P(^("F"),U,2),1:$P(XMR,U,2))
"RTN","XMADJF1",58,0)
 S XMADF=1 D OK^XMADJF1B
"RTN","XMADJF1",59,0)
FDQ K XMK,XMADEL G FD1
"RTN","XMGAPI3")
0^1^B10086211
"RTN","XMGAPI3",1,0)
XMGAPI3 ;WASH ISC/REW/LH - Deliver Broadcast Msg & Mark for Vaporization ;04/18/97  09:31
"RTN","XMGAPI3",2,0)
 ;;7.1;MailMan;**29,44**;Jun 02, 1994
"RTN","XMGAPI3",3,0)
 ;
"RTN","XMGAPI3",4,0)
 ;This routine exists at a site such that messages may be sent to
"RTN","XMGAPI3",5,0)
 ;an option (server) that this routine is the ROUTINE for.
"RTN","XMGAPI3",6,0)
 Q
"RTN","XMGAPI3",7,0)
ENT(XMDUZ) ;XMDUZ = * if to all employees
"RTN","XMGAPI3",8,0)
 ;  = a DUZ value if only to one person -- typically .6 to route to shared mail
"RTN","XMGAPI3",9,0)
 ;    XQMSG and XMFROM are set in the server invoker
"RTN","XMGAPI3",10,0)
 ;The ENT(X) entry point is an extrinsic function that
"RTN","XMGAPI3",11,0)
 ;returns a zero is it worked properly and a 1 if there
"RTN","XMGAPI3",12,0)
 ;was a problem.
"RTN","XMGAPI3",13,0)
 ;
"RTN","XMGAPI3",14,0)
 ;Do not allow use unless the message was sent
"RTN","XMGAPI3",15,0)
 ;from the Postmaster at FORUM.VA.GOV.
"RTN","XMGAPI3",16,0)
P I $P(XMFROM,"@")'["POSTMASTER"!($P(XMFROM,"@",2)'["FORUM.VA.GOV") G ERR1
"RTN","XMGAPI3",17,0)
 ;
"RTN","XMGAPI3",18,0)
 S XMZ=XQMSG
"RTN","XMGAPI3",19,0)
 ;
"RTN","XMGAPI3",20,0)
 ;Set Info Only Status
"RTN","XMGAPI3",21,0)
I Q:$$INFO(XMZ)
"RTN","XMGAPI3",22,0)
 ;
"RTN","XMGAPI3",23,0)
 ; D ^%ZTER ;4 testing / trap symbol table
"RTN","XMGAPI3",24,0)
 ;
"RTN","XMGAPI3",25,0)
 ;Broadcast to all Mail Boxes, 7 days vaporization
"RTN","XMGAPI3",26,0)
 ;
"RTN","XMGAPI3",27,0)
B I XMDUZ="*" D  G Q
"RTN","XMGAPI3",28,0)
 . S XMDT=$$DATE(7),XMDV=0
"RTN","XMGAPI3",29,0)
 . F  S XMDV=$O(^XMB(3.7,XMDV)) Q:'XMDV  D  ;Get next user Mail Box
"RTN","XMGAPI3",30,0)
 . . Q:'$D(^XMB(3.7,XMDV,2))  ; must have mail box
"RTN","XMGAPI3",31,0)
 . . ; must have access code, verify code, and primary menu
"RTN","XMGAPI3",32,0)
 . . Q:$P($G(^VA(200,XMDV,0)),U,3)=""!($P($G(^(.1)),U,2)="")!($P($G(^(201)),U)="")
"RTN","XMGAPI3",33,0)
 . . S Y=XMDV
"RTN","XMGAPI3",34,0)
 . . D OK ;Deliver to user Mail Box
"RTN","XMGAPI3",35,0)
 . . S X=$$VAP(XMDV,XMZ,XMDT,1)
"RTN","XMGAPI3",36,0)
 ;Shared Mail
"RTN","XMGAPI3",37,0)
S G ERR2:'XMDUZ,ERR2:'$D(^XMB(3.7,XMDUZ))
"RTN","XMGAPI3",38,0)
 S XMDT=$$DATE(30) ;30 days vaporization
"RTN","XMGAPI3",39,0)
 D  S XMDUZ=$$VAP(XMDUZ,XMZ,XMDT,1) G Q
"RTN","XMGAPI3",40,0)
 . S Y=+XMDUZ N X D OK
"RTN","XMGAPI3",41,0)
 Q
"RTN","XMGAPI3",42,0)
 ;
"RTN","XMGAPI3",43,0)
VAP(A,B,C,D) ;Mark Message for Vaporization in Mail Box
"RTN","XMGAPI3",44,0)
 ;IN-BASKET-PURGE does actual vaporization on or after date
"RTN","XMGAPI3",45,0)
 ;
"RTN","XMGAPI3",46,0)
 ;A=Mail Box
"RTN","XMGAPI3",47,0)
 ;B=Message #
"RTN","XMGAPI3",48,0)
 ;C=Date to Vaporize on or after
"RTN","XMGAPI3",49,0)
 ;D=Mail Basket
"RTN","XMGAPI3",50,0)
 ;
"RTN","XMGAPI3",51,0)
 ;Set date into field in mail box / message / basket
"RTN","XMGAPI3",52,0)
D S $P(^XMB(3.7,A,2,D,1,B,0),U,5)=C
"RTN","XMGAPI3",53,0)
 ;
"RTN","XMGAPI3",54,0)
 ;Set up x-ref for IN-BASKET-PURGE to use
"RTN","XMGAPI3",55,0)
X S ^XMB(3.7,"AC",C,A,D,B)=""
"RTN","XMGAPI3",56,0)
 Q 0
"RTN","XMGAPI3",57,0)
ERR1 ;Send message back to sender if not POSTMASTER@FORUM
"RTN","XMGAPI3",58,0)
 N XMDUZ,A,XMTEXT,XMY,XMSUB,DIC,DIE
"RTN","XMGAPI3",59,0)
NP S XMY(XMFROM)="",XMSUB="SENDER OF MESSAGE TO SERVER UNACCEPTABLE"
"RTN","XMGAPI3",60,0)
 S XMTEXT="A("
"RTN","XMGAPI3",61,0)
 S A(1)="You may not send a message to the S.XMYB-BROADCAST-VA-WIDE"
"RTN","XMGAPI3",62,0)
 S A(2)="server.  Only the Postmaster at FORUM.VA.GOV has"
"RTN","XMGAPI3",63,0)
 S A(3)="this permission."
"RTN","XMGAPI3",64,0)
 D ^XMD
"RTN","XMGAPI3",65,0)
 Q
"RTN","XMGAPI3",66,0)
 ;
"RTN","XMGAPI3",67,0)
ERR2 ;Send a message back to sender if single recipient is invalid
"RTN","XMGAPI3",68,0)
 N XMDUZ,A,XMTEXT,XMY,XMSUB,DIC,DIE
"RTN","XMGAPI3",69,0)
UR S XMY(XMFROM)="",XMSUB="SERVER RECIPIENT UNKNOWN"
"RTN","XMGAPI3",70,0)
 S XMTEXT="A("
"RTN","XMGAPI3",71,0)
 S A(1)="Your message to the S.XMYB-BROADCAST-VA-WIDE server"
"RTN","XMGAPI3",72,0)
 S A(2)="was not accepted because the recipient specified ("_XMDUZ_")"
"RTN","XMGAPI3",73,0)
 S A(3)="in the server ENTRY EXECUTE did not have a Mail Box"
"RTN","XMGAPI3",74,0)
 S A(4)="(an entry in the Mail Box file [3.7])."
"RTN","XMGAPI3",75,0)
 D ^XMD
"RTN","XMGAPI3",76,0)
 Q  ;Invalid local recipient (no mail box)
"RTN","XMGAPI3",77,0)
 ;
"RTN","XMGAPI3",78,0)
OK N %,A,B,Z 
"RTN","XMGAPI3",79,0)
 S Z=XMZ,%=$G(^XMB(3.9,XMZ,1,0)) I %="" S %="^3.91LA"
"RTN","XMGAPI3",80,0)
 S A=$P(%,U,3)+1,$P(%,U,3,4)=A_"^"_A,^XMB(3.9,XMZ,1,0)=%,^(A,0)=Y
"RTN","XMGAPI3",81,0)
 S ^XMB(3.9,XMZ,1,"C",Y,A)="",XME0=Y,XMA0=XMZ
"RTN","XMGAPI3",82,0)
 D NOW^%DTC S %DT=%,XMR=^XMB(3.9,XMZ,0),XMADF=0 ; y=XMDUZ in XMADJF1B
"RTN","XMGAPI3",83,0)
 D OK^XMADJF1B
"RTN","XMGAPI3",84,0)
 Q
"RTN","XMGAPI3",85,0)
Q ;Successfully delivered the message
"RTN","XMGAPI3",86,0)
 ;
"RTN","XMGAPI3",87,0)
 ;Remove from Postmaster Server Basket
"RTN","XMGAPI3",88,0)
 S XMSER="S."_XQSOP D REMSBMSG^XMA1C
"RTN","XMGAPI3",89,0)
 Q
"RTN","XMGAPI3",90,0)
 ;
"RTN","XMGAPI3",91,0)
INFO(DA) ;Set Info Only & Closed statuses
"RTN","XMGAPI3",92,0)
 N DIE,DR S DIE=3.9,DR="1.95///y;1.97///y" D ^DIE
"RTN","XMGAPI3",93,0)
 Q 0
"RTN","XMGAPI3",94,0)
DATE(X2) ;Calculate date for vaporization (T+30)
"RTN","XMGAPI3",95,0)
 S X1=DT D C^%DTC
"RTN","XMGAPI3",96,0)
 Q X
"RTN","XMZTERM")
0^3^B57445643
"RTN","XMZTERM",1,0)
XMZTERM ;ISC-SF/GMB - Delete Mailbox/Delete Message ;06/23/97  06:39
"RTN","XMZTERM",2,0)
 ;;7.1;MailMan;**44**;Jun 02, 1994
"RTN","XMZTERM",3,0)
 ; Taken from XUSTERM (SEA/AMF/WDE)
"RTN","XMZTERM",4,0)
MESSAGE ; Manager chooses messages to purge
"RTN","XMZTERM",5,0)
 N DIR,XMABORT,XMZ,XMPARM,XMKILL
"RTN","XMZTERM",6,0)
 Q:$$NOTAUTH()
"RTN","XMZTERM",7,0)
 W @IOF,"This option enables you to purge any message."
"RTN","XMZTERM",8,0)
 W !!,"Purge means:"
"RTN","XMZTERM",9,0)
 W !,"-delete the message from all user mailboxes"
"RTN","XMZTERM",10,0)
 W !,"-delete the message from the MESSAGE file ^XMB(3.9"
"RTN","XMZTERM",11,0)
 W !,"-delete all responses from the MESSAGE file ^XMB(3.9"
"RTN","XMZTERM",12,0)
 W !,"-delete the message from the MESSAGES TO BE NEW AT A LATER DATE file ^XMB(3.73"
"RTN","XMZTERM",13,0)
 W !!,"Purge is not reversible.  The message is gone forever."
"RTN","XMZTERM",14,0)
 S (XMABORT,XMPARM("TEST"),XMKILL)=0
"RTN","XMZTERM",15,0)
 F  D  Q:XMABORT
"RTN","XMZTERM",16,0)
 . W !
"RTN","XMZTERM",17,0)
 . S DIR(0)="NO^1:999999999999999:0^D CHKMSG^XMZTERM(Y)",DIR("A")="Purge MESSAGE"
"RTN","XMZTERM",18,0)
 . S DIR("?")="This response must be a message number"
"RTN","XMZTERM",19,0)
 . D ^DIR K DIR I $D(DIRUT) S XMABORT=1 Q
"RTN","XMZTERM",20,0)
 . S XMZ=+Y
"RTN","XMZTERM",21,0)
 . S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="NO"
"RTN","XMZTERM",22,0)
 . D ^DIR K DIR I 'Y!$D(DIRUT) W !,"Message not purged." Q
"RTN","XMZTERM",23,0)
 . S (XMKILL("MSG"),XMKILL("RESP"))=0
"RTN","XMZTERM",24,0)
 . D KILL^XMA32A(XMZ,.XMKILL)
"RTN","XMZTERM",25,0)
 . W !!,XMKILL("MSG")," message" W:XMKILL("RESP") " and ",XMKILL("RESP")," responses" W " purged."
"RTN","XMZTERM",26,0)
 . S XMKILL=XMKILL+XMKILL("MSG")+XMKILL("RESP")
"RTN","XMZTERM",27,0)
 S:XMKILL $P(^(0),U,4)=$P(^XMB(3.9,0),U,4)-XMKILL
"RTN","XMZTERM",28,0)
 Q
"RTN","XMZTERM",29,0)
CHKMSG(XMZ) ;
"RTN","XMZTERM",30,0)
 I '$D(^XMB(3.9,XMZ)) K X Q
"RTN","XMZTERM",31,0)
 W "  ",$P($G(^XMB(3.9,XMZ,0)),U,1)
"RTN","XMZTERM",32,0)
 Q
"RTN","XMZTERM",33,0)
ALL1 ; MailMan chooses users to remove from MailMan
"RTN","XMZTERM",34,0)
 ; (Users who shouldn't have mailboxes.)
"RTN","XMZTERM",35,0)
 N XMTEST,DIR,XMABORT,XMCUTOFF,XMGRACE
"RTN","XMZTERM",36,0)
 Q:$$NOTAUTH()
"RTN","XMZTERM",37,0)
 S XMABORT=0
"RTN","XMZTERM",38,0)
 W @IOF,"This option goes through the MailBox global and deletes the user's mailbox if"
"RTN","XMZTERM",39,0)
 D HELP1
"RTN","XMZTERM",40,0)
 D CUTOFF(1,.XMGRACE,.XMCUTOFF,.XMABORT) Q:XMABORT
"RTN","XMZTERM",41,0)
 S DIR(0)="SO^T:Test Mode only;R:Real Mode"
"RTN","XMZTERM",42,0)
 S DIR("B")="Test Mode only"
"RTN","XMZTERM",43,0)
 S DIR("A")="Select Run Option"
"RTN","XMZTERM",44,0)
 S DIR("?",1)="'Real Mode' will remove qualifying users from MailMan."
"RTN","XMZTERM",45,0)
 S DIR("?",2)="'Test Mode' will not."
"RTN","XMZTERM",46,0)
 S DIR("?",3)="Select 'Test Mode' to see who would be removed."
"RTN","XMZTERM",47,0)
 S DIR("?")="Select 'Real Mode' to remove them."
"RTN","XMZTERM",48,0)
 D ^DIR Q:$D(DIRUT)
"RTN","XMZTERM",49,0)
 S XMTEST=$S(X="R":0,1:1)
"RTN","XMZTERM",50,0)
 S (ZTSAVE("XMTEST"),ZTSAVE("XMCUTOFF"),ZTSAVE("XMGRACE"))=""
"RTN","XMZTERM",51,0)
 W !!,"This report may take a while.  You might consider spooling it."
"RTN","XMZTERM",52,0)
 D EN^XUTMDEVQ("ALL1TASK^XMZTERM1","MailMan: Remove user Mailboxes",.ZTSAVE)
"RTN","XMZTERM",53,0)
 Q
"RTN","XMZTERM",54,0)
ALL2 ; MailMan reports on users who maybe should be removed from MailMan
"RTN","XMZTERM",55,0)
 ; (Users who haven't logged on in a while.)
"RTN","XMZTERM",56,0)
 N XMTEST,DIR,XMABORT,XMCUTOFF,XMGRACE
"RTN","XMZTERM",57,0)
 Q:$$NOTAUTH()
"RTN","XMZTERM",58,0)
 S XMABORT=0
"RTN","XMZTERM",59,0)
 W @IOF,"This option goes through the MailBox global and reports if"
"RTN","XMZTERM",60,0)
 D HELP2
"RTN","XMZTERM",61,0)
 W !!,"This option does not delete any mailboxes.  Use the XM-TERMINATE-ONE-USER"
"RTN","XMZTERM",62,0)
 W !,"option to delete any user mailboxes identified in this report.",!
"RTN","XMZTERM",63,0)
 D CUTOFF(2,.XMGRACE,.XMCUTOFF,.XMABORT) Q:XMABORT
"RTN","XMZTERM",64,0)
 S ZTSAVE("XMCUTOFF")=""
"RTN","XMZTERM",65,0)
 W !!,"This report may take a while.  You might consider spooling it."
"RTN","XMZTERM",66,0)
 D EN^XUTMDEVQ("ALL2TASK^XMZTERM1","MailMan: Remove user Mailboxes",.ZTSAVE)
"RTN","XMZTERM",67,0)
 Q
"RTN","XMZTERM",68,0)
NOTAUTH() ;
"RTN","XMZTERM",69,0)
 Q:$D(^XUSEC("XMMGR",DUZ)) 0
"RTN","XMZTERM",70,0)
 W !!,*7,"You may not run this option.  You do not hold the 'XMMGR' security key!"
"RTN","XMZTERM",71,0)
 Q 1
"RTN","XMZTERM",72,0)
HELP1 ;
"RTN","XMZTERM",73,0)
 W !,"- the user is not in the NEW PERSON file."
"RTN","XMZTERM",74,0)
 W !,"- the user has no access code and was not terminated."
"RTN","XMZTERM",75,0)
 W !,"- the user has no access code and was terminated w/o mailbox retention."
"RTN","XMZTERM",76,0)
 W !,"- the user has an access code, but no primary menu."
"RTN","XMZTERM",77,0)
 W !,"- the user has an access code and primary menu, but no verify code, AND"
"RTN","XMZTERM",78,0)
 W !,"  - has never signed on, since being added before a cutoff date."
"RTN","XMZTERM",79,0)
 W !,"  OR"
"RTN","XMZTERM",80,0)
 W !,"  - last signed on before a cutoff date."
"RTN","XMZTERM",81,0)
 W !!,"'Delete mailbox' includes:"
"RTN","XMZTERM",82,0)
 W !,"- Delete user's private mail groups"
"RTN","XMZTERM",83,0)
 W !,"- Remove user from membership in any group"
"RTN","XMZTERM",84,0)
 W !,"- Remove user as authorized sender from any group"
"RTN","XMZTERM",85,0)
 W !,"- Remove user from anyone's list of surrogates"
"RTN","XMZTERM",86,0)
 W !,"- Delete user's mail box"
"RTN","XMZTERM",87,0)
 W !,"As a result, the user will not receive any mail.",!
"RTN","XMZTERM",88,0)
 Q
"RTN","XMZTERM",89,0)
HELP2 ;
"RTN","XMZTERM",90,0)
 W !,"- the user has an access code, verify code, and primary menu, but"
"RTN","XMZTERM",91,0)
 W !,"  last signed on before a cutoff date."
"RTN","XMZTERM",92,0)
 W !,"- the user was terminated before a cutoff date and allowed to keep a mailbox."
"RTN","XMZTERM",93,0)
 Q
"RTN","XMZTERM",94,0)
CUTOFF(XMWHICH,XMGRACE,XMCUTOFF,XMABORT) ;
"RTN","XMZTERM",95,0)
 N DIR
"RTN","XMZTERM",96,0)
 S XMGRACE=$$FMADD^XLFDT(DT,-30)
"RTN","XMZTERM",97,0)
 S DIR(0)="D^:"_XMGRACE_":EP"
"RTN","XMZTERM",98,0)
 S DIR("A")="Logon cutoff date"
"RTN","XMZTERM",99,0)
 S DIR("B")=$$FMTE^XLFDT(DT-10000)
"RTN","XMZTERM",100,0)
 S DIR("??")="^D HCUTOFF^XMZTERM(XMWHICH)"
"RTN","XMZTERM",101,0)
 D ^DIR I $D(DIRUT) S XMABORT=1 Q
"RTN","XMZTERM",102,0)
 S XMCUTOFF=Y
"RTN","XMZTERM",103,0)
 Q
"RTN","XMZTERM",104,0)
HCUTOFF(XMWHICH) ;
"RTN","XMZTERM",105,0)
 W !,"The cutoff date must be more than 30 days ago."
"RTN","XMZTERM",106,0)
 W !,"It is used during the check to see if"
"RTN","XMZTERM",107,0)
 I XMWHICH="*"!(XMWHICH=1) D
"RTN","XMZTERM",108,0)
 . W !,"- the user has an access code and primary menu, but no verify code, AND"
"RTN","XMZTERM",109,0)
 . W !,"  - has never signed on, since being added before a cutoff date."
"RTN","XMZTERM",110,0)
 . W !,"  OR"
"RTN","XMZTERM",111,0)
 . W !,"  - last signed on before a cutoff date."
"RTN","XMZTERM",112,0)
 I XMWHICH="*"!(XMWHICH=2) D
"RTN","XMZTERM",113,0)
 . W !,"- the user has an access code, verify code, and primary menu, but"
"RTN","XMZTERM",114,0)
 . W !,"  last signed on before a cutoff date."
"RTN","XMZTERM",115,0)
 W !!,"(If you do not wish to check mailboxes based on a cutoff date, enter '1900'.)"
"RTN","XMZTERM",116,0)
 W !!,"Please enter that cutoff date."
"RTN","XMZTERM",117,0)
 Q
"RTN","XMZTERM",118,0)
CHOOSE ; Manager chooses user to remove from MailMan
"RTN","XMZTERM",119,0)
 N XMCUTOFF,XMABORT,XMI,XMGRACE
"RTN","XMZTERM",120,0)
 S XMABORT=0
"RTN","XMZTERM",121,0)
 Q:$$NOTAUTH()
"RTN","XMZTERM",122,0)
 W @IOF,"This option lets you delete the mailbox of a user if"
"RTN","XMZTERM",123,0)
 D HELP2
"RTN","XMZTERM",124,0)
 D HELP1
"RTN","XMZTERM",125,0)
 D CUTOFF("*",.XMGRACE,.XMCUTOFF,.XMABORT) Q:XMABORT
"RTN","XMZTERM",126,0)
 N DIR
"RTN","XMZTERM",127,0)
 S DIR(0)="SO^M:MailMan presents;I:I select"
"RTN","XMZTERM",128,0)
 S DIR("?",1)="Select 'M' if you want MailMan to $order through the MailBox file and"
"RTN","XMZTERM",129,0)
 S DIR("?",2)="present to you candidates for mailbox deletion."
"RTN","XMZTERM",130,0)
 S DIR("?",3)=""
"RTN","XMZTERM",131,0)
 S DIR("?")="Select 'I' if you want to do the selection directly."
"RTN","XMZTERM",132,0)
 D ^DIR Q:$D(DIRUT)
"RTN","XMZTERM",133,0)
 I Y="M" D MMCHOOSE(XMGRACE,XMCUTOFF) Q
"RTN","XMZTERM",134,0)
 D ICHOOSE(XMGRACE,XMCUTOFF)
"RTN","XMZTERM",135,0)
 Q
"RTN","XMZTERM",136,0)
MMCHOOSE(XMGRACE,XMCUTOFF) ;
"RTN","XMZTERM",137,0)
 N XMI,XMABORT,XMTERM
"RTN","XMZTERM",138,0)
 S (XMI,XMABORT)=0
"RTN","XMZTERM",139,0)
 F  S XMI=$O(^XMB(3.7,XMI)) Q:XMI'>0  D  Q:XMABORT
"RTN","XMZTERM",140,0)
 . D CHECK1^XMZTERM1(XMI,XMGRACE,XMCUTOFF,.XMTERM) I XMTERM D DELETE(XMI,.XMABORT) Q
"RTN","XMZTERM",141,0)
 . D CHECK2^XMZTERM1(XMI,XMCUTOFF,.XMTERM) I XMTERM D DELETE(XMI,.XMABORT)
"RTN","XMZTERM",142,0)
 Q
"RTN","XMZTERM",143,0)
ICHOOSE(XMGRACE,XMCUTOFF) ;
"RTN","XMZTERM",144,0)
 F  D  Q:XMABORT
"RTN","XMZTERM",145,0)
 . N DIC,Y
"RTN","XMZTERM",146,0)
 . S DIC="^XMB(3.7,"
"RTN","XMZTERM",147,0)
 . S DIC(0)="AEQM"
"RTN","XMZTERM",148,0)
 . S DIC("S")="N XMTERM,XMFORGET D CHECK1^XMZTERM1(Y,XMGRACE,XMCUTOFF,.XMTERM),CHECK2^XMZTERM1(Y,XMCUTOFF,.XMFORGET) I XMTERM!XMFORGET"
"RTN","XMZTERM",149,0)
 . W ! D ^DIC I Y=-1 S XMABORT=1 Q
"RTN","XMZTERM",150,0)
 . D DELETE(+Y)
"RTN","XMZTERM",151,0)
 Q
"RTN","XMZTERM",152,0)
DELETE(XMI,XMABORT) ;
"RTN","XMZTERM",153,0)
 N XMREC,XMDELETE
"RTN","XMZTERM",154,0)
 S XMREC=$G(^VA(200,XMI,0))
"RTN","XMZTERM",155,0)
 I XMREC'="" D  Q:'XMDELETE
"RTN","XMZTERM",156,0)
 . N DIR,Y
"RTN","XMZTERM",157,0)
 . W !!,$P(XMREC,U)
"RTN","XMZTERM",158,0)
 . W !,"Access Code: ",$S($P(XMREC,U,3)="":"NONE",1:"<Hidden>")
"RTN","XMZTERM",159,0)
 . W ?25,"Verify Code: ",$S($P($G(^VA(200,XMI,.1)),U,2)="":"NONE",1:"<Hidden>")
"RTN","XMZTERM",160,0)
 . W ?50,"Primary Menu: ",$S($P($G(^VA(200,XMI,201)),U,1)="":"NONE",1:$P($G(^DIC(19,$P(^(201),U),0)),U))
"RTN","XMZTERM",161,0)
 . W !,"Date Entered: ",$S($P($G(^VA(200,XMI,1)),U,7)="":"NONE",1:$$FMTE^XLFDT($P(^(1),U,7),"2D"))
"RTN","XMZTERM",162,0)
 . W ?25,"Last Logon: ",$S($P($G(^VA(200,XMI,1.1)),U,1)="":"NONE",1:$$FMTE^XLFDT($P(^(1.1),U,1),"2D"))
"RTN","XMZTERM",163,0)
 . W !,"Term Date: ",$S($P(XMREC,U,11)="":"NONE",1:$$FMTE^XLFDT($P(XMREC,U,11),"2D"))
"RTN","XMZTERM",164,0)
 . W:$P(XMREC,U,11) ?25,"Delete Mail: ",$S($P(XMREC,U,5)="y":"YES",1:"NO")
"RTN","XMZTERM",165,0)
 . W ?50,"New Messages: ",$P(^XMB(3.7,XMI,0),U,6)
"RTN","XMZTERM",166,0)
 . W !
"RTN","XMZTERM",167,0)
 . S DIR(0)="Y"
"RTN","XMZTERM",168,0)
 . S DIR("B")="NO"
"RTN","XMZTERM",169,0)
 . S DIR("A")="Delete this user's mailbox"
"RTN","XMZTERM",170,0)
 . D ^DIR I $D(DIRUT) S XMDELETE=0,XMABORT=1 Q
"RTN","XMZTERM",171,0)
 . I 'Y S XMDELETE=0 Q
"RTN","XMZTERM",172,0)
 . S XMDELETE=1
"RTN","XMZTERM",173,0)
 W !,"Deleting mailbox for user ",XMI," ",$S(XMREC="":"* not in ^VA(200, *",1:$P(XMREC,U))
"RTN","XMZTERM",174,0)
 D TERMINAT^XMZTERM1(XMI)
"RTN","XMZTERM",175,0)
 Q
"RTN","XMZTERM1")
0^4^B64954742
"RTN","XMZTERM1",1,0)
XMZTERM1 ;ISC-SF/GMB - Delete Mailbox (continued) ;06/19/97  14:33
"RTN","XMZTERM1",2,0)
 ;;7.1;MailMan;**44**;Jun 02, 1994
"RTN","XMZTERM1",3,0)
 ; Taken from XUSTERM (SEA/AMF/WDE)
"RTN","XMZTERM1",4,0)
ALL1TASK ;
"RTN","XMZTERM1",5,0)
 N XMI,XMABORT,XMTERM,XMNAME,XMWHY,XMCUTEXT,XMLEN,XMCNT,XMADDED,XMAC,XMVC,XMPM,XMLASTON,XMTDATE,XMDELM,XMTOTAL
"RTN","XMZTERM1",6,0)
 S XMCUTEXT=$$FMTE^XLFDT(XMCUTOFF,"2DF")
"RTN","XMZTERM1",7,0)
 S XMLEN=$L($P(^VA(200,0),U,3))
"RTN","XMZTERM1",8,0)
 S (XMCNT,XMABORT,XMTOTAL)=0
"RTN","XMZTERM1",9,0)
 W:IOST["C-" @IOF D HEADER1
"RTN","XMZTERM1",10,0)
 S XMI=.999
"RTN","XMZTERM1",11,0)
 F  S XMI=$O(^XMB(3.7,XMI)) Q:XMI'>0  D  Q:XMABORT
"RTN","XMZTERM1",12,0)
 . S XMTOTAL=XMTOTAL+1 I '$D(ZTQUEUED) I XMTOTAL\100=0 U IO(0) W:$X>50 ! W "." U IO
"RTN","XMZTERM1",13,0)
 . D CHECK1(XMI,XMGRACE,XMCUTOFF,.XMTERM,.XMNAME,.XMWHY) Q:'XMTERM
"RTN","XMZTERM1",14,0)
 . I $Y+3>IOSL D  Q:XMABORT
"RTN","XMZTERM1",15,0)
 . . I IOST["C-" D  Q:XMABORT
"RTN","XMZTERM1",16,0)
 . . . N DIR
"RTN","XMZTERM1",17,0)
 . . . S DIR(0)="E"
"RTN","XMZTERM1",18,0)
 . . . D ^DIR S:$D(DIRUT) XMABORT=1
"RTN","XMZTERM1",19,0)
 . . W @IOF D HEADER1
"RTN","XMZTERM1",20,0)
 . D GETDATA(XMI,.XMADDED,.XMAC,.XMVC,.XMPM,.XMLASTON,.XMTDATE,.XMDELM)
"RTN","XMZTERM1",21,0)
 . W !,$J(XMI,XMLEN)," ",$E(XMNAME,1,32-XMLEN),?34,XMADDED,?44,XMAC,?47,XMVC,?50,XMPM,?53,XMLASTON,?63,XMTDATE,?76,XMDELM
"RTN","XMZTERM1",22,0)
 . S XMCNT=XMCNT+1
"RTN","XMZTERM1",23,0)
 . D:'XMTEST TERMINAT(XMI)  ; Delete if real mode
"RTN","XMZTERM1",24,0)
 W:XMCNT=0 !!,"No user mailboxes deleted."
"RTN","XMZTERM1",25,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","XMZTERM1",26,0)
 Q
"RTN","XMZTERM1",27,0)
HEADER1 ;
"RTN","XMZTERM1",28,0)
 W $S(XMTEST:"Test: ",1:""),"Delete user mailbox"
"RTN","XMZTERM1",29,0)
 W !,"(Logon cutoff date: ",XMCUTEXT,", AC=Access Code, VC=Verify Code, PM=Primary Menu)"
"RTN","XMZTERM1",30,0)
 ;       " ^VA(200             Last   Terminate  Delete"
"RTN","XMZTERM1",31,0)
 ;       " Created  AC VC PM  Sign on    Date     Mail"
"RTN","XMZTERM1",32,0)
 ;        xx/xx/xx  y  y  y  xx/xx/xx  xx/xx/xx     y
"RTN","XMZTERM1",33,0)
 W !!,?34," ^VA(200             Last   Terminate  Delete"
"RTN","XMZTERM1",34,0)
 W !,?XMLEN+1,"Delete Mailbox",?34," Created  AC VC PM  Sign on    Date     Mail"
"RTN","XMZTERM1",35,0)
 W !,"-------------------------------------------------------------------------------"
"RTN","XMZTERM1",36,0)
 Q
"RTN","XMZTERM1",37,0)
CHECK1(XMI,XMGRACE,XMCUTOFF,XMTERM,XMNAME,XMWHY) ;
"RTN","XMZTERM1",38,0)
 N XMREC,XMADDED
"RTN","XMZTERM1",39,0)
 S XMTERM=0
"RTN","XMZTERM1",40,0)
 Q:XMI<1
"RTN","XMZTERM1",41,0)
 S XMREC=$G(^VA(200,XMI,0))
"RTN","XMZTERM1",42,0)
 I XMREC="" D  Q
"RTN","XMZTERM1",43,0)
 . S XMTERM=1
"RTN","XMZTERM1",44,0)
 . S XMNAME="*No Name*"
"RTN","XMZTERM1",45,0)
 . S XMWHY="Not in NEW PERSON file"
"RTN","XMZTERM1",46,0)
 ; User is in NEW PERSON file
"RTN","XMZTERM1",47,0)
 S XMADDED=$P($G(^VA(200,XMI,1)),U,7)
"RTN","XMZTERM1",48,0)
 Q:XMADDED>XMGRACE
"RTN","XMZTERM1",49,0)
 I $P(XMREC,U,3)="" D  Q  ; if no access code...
"RTN","XMZTERM1",50,0)
 . N XMTDATE
"RTN","XMZTERM1",51,0)
 . S XMTDATE=$P(XMREC,U,11)
"RTN","XMZTERM1",52,0)
 . I XMTDATE="" D  Q
"RTN","XMZTERM1",53,0)
 . . S XMTERM=1
"RTN","XMZTERM1",54,0)
 . . S XMNAME=$P(XMREC,U)
"RTN","XMZTERM1",55,0)
 . . S XMWHY="No AC, no termination date"
"RTN","XMZTERM1",56,0)
 . I XMTDATE'<DT Q  ; To be Terminated in the future
"RTN","XMZTERM1",57,0)
 . I $P(XMREC,U,5)="n" Q  ; Terminated w/mail retention
"RTN","XMZTERM1",58,0)
 . S XMTERM=1
"RTN","XMZTERM1",59,0)
 . S XMNAME=$P(XMREC,U)
"RTN","XMZTERM1",60,0)
 . S XMWHY="No AC, terminated w/o mail retention"
"RTN","XMZTERM1",61,0)
 ; User has access code
"RTN","XMZTERM1",62,0)
 I $P($G(^VA(200,XMI,201)),U,1)="" D  Q  ; if no primary menu...
"RTN","XMZTERM1",63,0)
 . S XMTERM=1
"RTN","XMZTERM1",64,0)
 . S XMNAME=$P(XMREC,U)
"RTN","XMZTERM1",65,0)
 . S XMWHY="AC, but no PM"
"RTN","XMZTERM1",66,0)
 ; User has primary menu
"RTN","XMZTERM1",67,0)
 N XMLASTON  ; last sign on
"RTN","XMZTERM1",68,0)
 S XMLASTON=$P($G(^VA(200,XMI,1.1)),U)
"RTN","XMZTERM1",69,0)
 I $P($G(^VA(200,XMI,.1)),U,2)="" D  Q  ; if no verify code...
"RTN","XMZTERM1",70,0)
 . I XMLASTON="" D  Q
"RTN","XMZTERM1",71,0)
 . . I XMADDED<XMCUTOFF D  Q
"RTN","XMZTERM1",72,0)
 . . . S XMTERM=1
"RTN","XMZTERM1",73,0)
 . . . S XMNAME=$P(XMREC,U)
"RTN","XMZTERM1",74,0)
 . . . S XMWHY="AC & PM, no VC, no logon, added "_$$FMTE^XLFDT(XMADDED,"2DF")
"RTN","XMZTERM1",75,0)
 . I XMLASTON<XMCUTOFF D  Q
"RTN","XMZTERM1",76,0)
 . . S XMTERM=1
"RTN","XMZTERM1",77,0)
 . . S XMNAME=$P(XMREC,U)
"RTN","XMZTERM1",78,0)
 . . S XMWHY="AC & PM, no VC, last logon "_$$FMTE^XLFDT(XMLASTON,"2DF")
"RTN","XMZTERM1",79,0)
 ; User has verify code
"RTN","XMZTERM1",80,0)
 Q
"RTN","XMZTERM1",81,0)
GETDATA(XMI,XMADDED,XMAC,XMVC,XMPM,XMLASTON,XMTDATE,XMDELM,XMNEW) ;
"RTN","XMZTERM1",82,0)
 N XMREC
"RTN","XMZTERM1",83,0)
 S XMREC=$G(^VA(200,XMI,0))
"RTN","XMZTERM1",84,0)
 S XMADDED=$P($G(^VA(200,XMI,1)),U,7)  ; date added to NEW PERSON file
"RTN","XMZTERM1",85,0)
 S XMADDED=$S(XMADDED="":"",1:$$FMTE^XLFDT(XMADDED,"2DF"))
"RTN","XMZTERM1",86,0)
 S XMAC=$S($P(XMREC,U,3)="":"",1:"Y") ; access code
"RTN","XMZTERM1",87,0)
 S XMVC=$S($P($G(^VA(200,XMI,.1)),U,2)="":"",1:"Y") ; verify code
"RTN","XMZTERM1",88,0)
 S XMPM=$S($P($G(^VA(200,XMI,201)),U,1)="":"",1:"Y") ; primary menu
"RTN","XMZTERM1",89,0)
 S XMLASTON=$P($G(^VA(200,XMI,1.1)),U) ; last sign on
"RTN","XMZTERM1",90,0)
 S XMLASTON=$S(XMLASTON="":"",1:$$FMTE^XLFDT(XMLASTON,"2DF"))
"RTN","XMZTERM1",91,0)
 S XMTDATE=$P(XMREC,U,11)              ; termination date
"RTN","XMZTERM1",92,0)
 S XMTDATE=$S(XMTDATE="":"",1:$$FMTE^XLFDT(XMTDATE,"2DF"))
"RTN","XMZTERM1",93,0)
 S XMDELM=$$UP^XLFSTR($P(XMREC,U,5)) ; delete mail on termination
"RTN","XMZTERM1",94,0)
 S XMNEW=$P($G(^XMB(3.7,XMI,0)),U,6)  ; New messages
"RTN","XMZTERM1",95,0)
 Q
"RTN","XMZTERM1",96,0)
ALL2TASK ;
"RTN","XMZTERM1",97,0)
 N XMI,XMABORT,XMTERM,XMNAME,XMWHY,XMCUTEXT,XMSVC,XMLEN,XMCNT,XMADDED,XMAC,XMVC,XMPM,XMLASTON,XMTDATE,XMDELM,XMREC,XMTOTAL,XMNEW,XMFIRST
"RTN","XMZTERM1",98,0)
 K ^TMP("XM",$J)
"RTN","XMZTERM1",99,0)
 S XMCUTEXT=$$FMTE^XLFDT(XMCUTOFF,"2DF")
"RTN","XMZTERM1",100,0)
 S XMLEN=$L($P(^VA(200,0),U,3))
"RTN","XMZTERM1",101,0)
 S (XMCNT,XMABORT,XMTOTAL)=0,XMFIRST=1
"RTN","XMZTERM1",102,0)
 S XMI=.999
"RTN","XMZTERM1",103,0)
 F  S XMI=$O(^XMB(3.7,XMI)) Q:XMI'>0  D  Q:XMABORT
"RTN","XMZTERM1",104,0)
 . S XMTOTAL=XMTOTAL+1 I '$D(ZTQUEUED) I XMTOTAL\100=0 U IO(0) W:$X>50 ! W "." U IO
"RTN","XMZTERM1",105,0)
 . D CHECK2(XMI,XMCUTOFF,.XMTERM,.XMNAME,.XMWHY) Q:'XMTERM
"RTN","XMZTERM1",106,0)
 . S XMCNT=XMCNT+1
"RTN","XMZTERM1",107,0)
 . D GETDATA(XMI,.XMADDED,.XMAC,.XMVC,.XMPM,.XMLASTON,.XMTDATE,.XMDELM,.XMNEW)
"RTN","XMZTERM1",108,0)
 . S XMSVC=$S($P($G(^VA(200,XMI,5)),U,1)="":"*None*",1:$P($G(^DIC(49,$P(^(5),U,1),0),"*None*"),U,1))
"RTN","XMZTERM1",109,0)
 . S ^TMP("XM",$J,XMSVC,$S(XMNAME="":"*No Name*",1:$E(XMNAME,1,25-XMLEN)),XMI)=XMAC_U_XMVC_U_XMPM_U_XMLASTON_U_XMTDATE_U_XMDELM_U_XMNEW
"RTN","XMZTERM1",110,0)
 S (XMSVC,XMNAME,XMI)=""
"RTN","XMZTERM1",111,0)
 F  S XMSVC=$O(^TMP("XM",$J,XMSVC)) Q:XMSVC=""  D  Q:XMABORT
"RTN","XMZTERM1",112,0)
 . I XMFIRST D
"RTN","XMZTERM1",113,0)
 . . S XMFIRST=0
"RTN","XMZTERM1",114,0)
 . . W:IOST["C-" @IOF D HEADER2
"RTN","XMZTERM1",115,0)
 . E  D PAGE2(.XMABORT) Q:XMABORT
"RTN","XMZTERM1",116,0)
 . F  S XMNAME=$O(^TMP("XM",$J,XMSVC,XMNAME)) Q:XMNAME=""  D  Q:XMABORT
"RTN","XMZTERM1",117,0)
 . . F  S XMI=$O(^TMP("XM",$J,XMSVC,XMNAME,XMI)) Q:XMI=""  D  Q:XMABORT
"RTN","XMZTERM1",118,0)
 . . . I $Y+3>IOSL D PAGE2(.XMABORT) Q:XMABORT
"RTN","XMZTERM1",119,0)
 . . . S XMREC=^TMP("XM",$J,XMSVC,XMNAME,XMI)
"RTN","XMZTERM1",120,0)
 . . . W !,$J(XMI,XMLEN)," ",XMNAME,?27,$P(XMREC,U,1),?30,$P(XMREC,U,2),?33,$P(XMREC,U,3),?36,$P(XMREC,U,4),?46,$P(XMREC,U,5),?58,$P(XMREC,U,6),?60,$J($P(XMREC,U,7),6)
"RTN","XMZTERM1",121,0)
 W:XMCNT=0 !!,"No user mailboxes to report."
"RTN","XMZTERM1",122,0)
 K ^TMP("XM",$J)
"RTN","XMZTERM1",123,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","XMZTERM1",124,0)
 Q
"RTN","XMZTERM1",125,0)
PAGE2(XMABORT) ;
"RTN","XMZTERM1",126,0)
 I IOST["C-" D  Q:XMABORT
"RTN","XMZTERM1",127,0)
 . N DIR
"RTN","XMZTERM1",128,0)
 . S DIR(0)="E"
"RTN","XMZTERM1",129,0)
 . D ^DIR S:$D(DIRUT) XMABORT=1
"RTN","XMZTERM1",130,0)
 W @IOF D HEADER2
"RTN","XMZTERM1",131,0)
 Q
"RTN","XMZTERM1",132,0)
HEADER2 ;
"RTN","XMZTERM1",133,0)
 W "Check user mailbox for Service/Section: ",XMSVC
"RTN","XMZTERM1",134,0)
 W !!,"(Logon cutoff date: ",XMCUTEXT,", AC=Access Code, VC=Verify Code, PM=Primary Menu)"
"RTN","XMZTERM1",135,0)
 ;       "                                         Term  Deact"
"RTN","XMZTERM1",136,0)
 ;       "           Last   Terminate  Del   New   User  VISTA"
"RTN","XMZTERM1",137,0)
 ;       "AC VC PM  Sign on    Date    Mail  Msgs  Mbox  Access"
"RTN","XMZTERM1",138,0)
 ;        y  y  y  xx/xx/xx  xx/xx/xx   y  xxxxxx 
"RTN","XMZTERM1",139,0)
 ;
"RTN","XMZTERM1",140,0)
 W !!,?27,"                                         Term  Deact"
"RTN","XMZTERM1",141,0)
 W !,?27,"           Last   Terminate  Del   New   User  VISTA"
"RTN","XMZTERM1",142,0)
 W !,?XMLEN+1,"Check Mailbox",?27,"AC VC PM  Sign on    Date    Mail  Msgs  Mbox  Access"
"RTN","XMZTERM1",143,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","XMZTERM1",144,0)
 Q
"RTN","XMZTERM1",145,0)
CHECK2(XMI,XMCUTOFF,XMTERM,XMNAME,XMWHY) ;
"RTN","XMZTERM1",146,0)
 N XMREC
"RTN","XMZTERM1",147,0)
 S XMTERM=0
"RTN","XMZTERM1",148,0)
 Q:XMI<1
"RTN","XMZTERM1",149,0)
 S XMREC=$G(^VA(200,XMI,0))
"RTN","XMZTERM1",150,0)
 Q:XMREC=""  ; not in NEW PERSON file
"RTN","XMZTERM1",151,0)
 I $P(XMREC,U,3)="" D  Q
"RTN","XMZTERM1",152,0)
 . ; no access code
"RTN","XMZTERM1",153,0)
 . N XMTDATE
"RTN","XMZTERM1",154,0)
 . S XMTDATE=$P(XMREC,U,11)
"RTN","XMZTERM1",155,0)
 . Q:XMTDATE=""  ; not terminated
"RTN","XMZTERM1",156,0)
 . Q:XMTDATE'<XMCUTOFF  ; terminated after cutoff date
"RTN","XMZTERM1",157,0)
 . Q:$P(XMREC,U,5)'="n"  ; Terminated w/o mail retention
"RTN","XMZTERM1",158,0)
 . S XMTERM=1
"RTN","XMZTERM1",159,0)
 . S XMNAME=$P(XMREC,U)
"RTN","XMZTERM1",160,0)
 . S XMWHY="No AC, terminated w/mail retention"
"RTN","XMZTERM1",161,0)
 ; User has access code
"RTN","XMZTERM1",162,0)
 Q:$P($G(^VA(200,XMI,201)),U,1)=""  ; no primary menu
"RTN","XMZTERM1",163,0)
 Q:$P($G(^VA(200,XMI,.1)),U,2)=""   ; no verify code
"RTN","XMZTERM1",164,0)
 ; User has verify code and primary menu
"RTN","XMZTERM1",165,0)
 N XMLASTON  ; last sign on
"RTN","XMZTERM1",166,0)
 S XMLASTON=$P($G(^VA(200,XMI,1.1)),U)
"RTN","XMZTERM1",167,0)
 I XMLASTON<XMCUTOFF D  Q
"RTN","XMZTERM1",168,0)
 . S XMTERM=1
"RTN","XMZTERM1",169,0)
 . S XMNAME=$P(XMREC,U)
"RTN","XMZTERM1",170,0)
 . I XMLASTON="" S XMWHY="AC, VC, & PM, no logon" Q
"RTN","XMZTERM1",171,0)
 . S XMWHY="AC, VC, & PM, last logon "_$$FMTE^XLFDT(XMLASTON,"2DF")
"RTN","XMZTERM1",172,0)
 Q
"RTN","XMZTERM1",173,0)
TERMINAT(XMDUZ) ; Remove user from MailMan
"RTN","XMZTERM1",174,0)
 D GROUP(XMDUZ)
"RTN","XMZTERM1",175,0)
 D SURROGAT(XMDUZ)
"RTN","XMZTERM1",176,0)
 D MAILBOX(XMDUZ)
"RTN","XMZTERM1",177,0)
 D LATERNEW(XMDUZ)
"RTN","XMZTERM1",178,0)
 D LATERSND(XMDUZ)
"RTN","XMZTERM1",179,0)
 Q
"RTN","XMZTERM1",180,0)
GROUP(XMDUZ) ; Remove user from mail groups
"RTN","XMZTERM1",181,0)
 N XMI,XMJ,DIK,DA
"RTN","XMZTERM1",182,0)
 ; Remove user as member from all mail groups
"RTN","XMZTERM1",183,0)
 S XMI=0
"RTN","XMZTERM1",184,0)
 F  S XMI=$O(^XMB(3.8,"AB",XMDUZ,XMI)) Q:XMI'>0  D
"RTN","XMZTERM1",185,0)
 . S DA(1)=XMI,DIK="^XMB(3.8,XMI,1,",XMJ=0
"RTN","XMZTERM1",186,0)
 . F  S XMJ=$O(^XMB(3.8,"AB",XMDUZ,XMI,XMJ)) Q:XMJ'>0  S DA=XMJ D ^DIK
"RTN","XMZTERM1",187,0)
 K ^XMB(3.8,"AB",XMDUZ)
"RTN","XMZTERM1",188,0)
 ; Remove user's personal mail groups
"RTN","XMZTERM1",189,0)
 S XMI=0,DIK="^XMB(3.8,"
"RTN","XMZTERM1",190,0)
 F  S XMI=$O(^XMB(3.8,XMI)) Q:XMI'>0  I $P(^(XMI,0),U,6)=1,$G(^(3))=XMDUZ S DA=XMI D ^DIK
"RTN","XMZTERM1",191,0)
 ; Remove user as authorized sender from all mail groups
"RTN","XMZTERM1",192,0)
 S XMI=0,DIK="^XMB(3.8,XMI,4,"
"RTN","XMZTERM1",193,0)
 F  S XMI=$O(^XMB(3.8,XMI)) Q:XMI'>0  D
"RTN","XMZTERM1",194,0)
 . Q:'$D(^XMB(3.8,XMI,4,"B",XMDUZ))
"RTN","XMZTERM1",195,0)
 . S DA=$O(^XMB(3.8,XMI,4,"B",XMDUZ,0))
"RTN","XMZTERM1",196,0)
 . I '$D(^XMB(3.8,XMI,4,DA,0)) K ^XMB(3.8,XMI,4,"B",XMDUZ) Q
"RTN","XMZTERM1",197,0)
 . S DA(1)=XMI D ^DIK
"RTN","XMZTERM1",198,0)
 Q
"RTN","XMZTERM1",199,0)
SURROGAT(XMDUZ) ; Remove as mail surrogate
"RTN","XMZTERM1",200,0)
 N XMI,DA,DIK
"RTN","XMZTERM1",201,0)
 S XMI=0,DIK="^XMB(3.7,XMI,9,"
"RTN","XMZTERM1",202,0)
 F  S XMI=$O(^XMB(3.7,"AB",XMDUZ,XMI)) Q:XMI'>0  D
"RTN","XMZTERM1",203,0)
 . S DA=$O(^XMB(3.7,"AB",XMDUZ,XMI,0))
"RTN","XMZTERM1",204,0)
 . I '$D(^XMB(3.7,XMI,9,DA,0)) K ^XMB(3.7,"AB",XMDUZ,XMI) Q
"RTN","XMZTERM1",205,0)
 . S DA(1)=XMI D ^DIK
"RTN","XMZTERM1",206,0)
 K ^XMB(3.7,"AB",XMDUZ)
"RTN","XMZTERM1",207,0)
 Q
"RTN","XMZTERM1",208,0)
MAILBOX(XMDUZ) ; Remove user's mail box
"RTN","XMZTERM1",209,0)
 Q:'$D(^XMB(3.7,XMDUZ,0))
"RTN","XMZTERM1",210,0)
 N DIK,DA
"RTN","XMZTERM1",211,0)
 S DIK="^XMB(3.7,",DA=XMDUZ D ^DIK
"RTN","XMZTERM1",212,0)
 Q
"RTN","XMZTERM1",213,0)
LATERNEW(XMDUZ) ; Remove the scheduling of any messages slated to become new for this user
"RTN","XMZTERM1",214,0)
 N DIK,DA
"RTN","XMZTERM1",215,0)
 S DIK="^XMB(3.73,"
"RTN","XMZTERM1",216,0)
 S DA=""
"RTN","XMZTERM1",217,0)
 F  S DA=$O(^XMB(3.73,"C",XMDUZ,DA)) Q:'DA  D ^DIK
"RTN","XMZTERM1",218,0)
 Q
"RTN","XMZTERM1",219,0)
LATERSND(XMDUZ) ; Remove the scheduling of any messages slated to be sent by this user.
"RTN","XMZTERM1",220,0)
 N XMZ,DIK,DA
"RTN","XMZTERM1",221,0)
 S XMZ=0
"RTN","XMZTERM1",222,0)
 F  S XMZ=$O(^XMB(3.9,"AW",XMDUZ,XMZ)) Q:'XMZ  D
"RTN","XMZTERM1",223,0)
 . S DA(1)=XMZ
"RTN","XMZTERM1",224,0)
 . S DIK="^XMB(3.9,"_DA(1)_",7,"
"RTN","XMZTERM1",225,0)
 . S DA=0
"RTN","XMZTERM1",226,0)
 . F  S DA=$O(^XMB(3.9,"AW",XMDUZ,XMZ,DA)) Q:'DA  D ^DIK
"RTN","XMZTERM1",227,0)
 Q
"VER")
8.0^21.0
**END**
**END**
