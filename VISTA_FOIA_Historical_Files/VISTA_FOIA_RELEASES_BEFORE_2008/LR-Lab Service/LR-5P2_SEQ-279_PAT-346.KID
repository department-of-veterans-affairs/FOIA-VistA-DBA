Released LR*5.2*346 SEQ #279
Extracted from mail message
**KIDS**:LR*5.2*346^

**INSTALL NAME**
LR*5.2*346
"BLD",6310,0)
LR*5.2*346^LAB SERVICE^0^3061013^y
"BLD",6310,1,0)
266^9.61A^283^283^3061013^^^^
"BLD",6310,1,1,0)
 Blood Bank Clearance
"BLD",6310,1,2,0)
 ====================
"BLD",6310,1,3,0)
 
"BLD",6310,1,4,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LR*5.2*346 does not
"BLD",6310,1,5,0)
contain any changes to the VISTA BLOOD BANK Software as defined by VHA
"BLD",6310,1,6,0)
DIRECTIVE 2004-058 titled VISTA BLOOD BANK SOFTWARE VERSION 5.2.
"BLD",6310,1,7,0)
 
"BLD",6310,1,8,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LR*5.2*346 does not
"BLD",6310,1,9,0)
alter or modify any software design safeguards or safety critical elements
"BLD",6310,1,10,0)
functions.
"BLD",6310,1,11,0)
 
"BLD",6310,1,12,0)
RISK ANALYSIS: Changes made by patch LR*5.2*346 have no effect on Blood
"BLD",6310,1,13,0)
Bank software functionality, therefore RISK is none.
"BLD",6310,1,14,0)
 
"BLD",6310,1,15,0)
VALIDATION REQUIREMENTS BY OPTION: Because of the nature of the changes
"BLD",6310,1,16,0)
made, no specific validation requirements exist as a result of installation
"BLD",6310,1,17,0)
of this patch.
"BLD",6310,1,18,0)
----------------------------------------------------------------------------
"BLD",6310,1,19,0)
 
"BLD",6310,1,20,0)
As part of the VA/DoD Laboratory Data Sharing Interoperability (LDSI) Phase
"BLD",6310,1,21,0)
2 project supporting the exchange of microbiology and anatomic pathology
"BLD",6310,1,22,0)
laboratory test orders and results, enhancements have been made to the
"BLD",6310,1,23,0)
Laboratory server LRLABSERVER to extract selected VistA Laboratory files
"BLD",6310,1,24,0)
for SNOMED CT mapping.
"BLD",6310,1,25,0)
 
"BLD",6310,1,26,0)
1. The following are new LRLABSERVER server reports made available with
"BLD",6310,1,27,0)
this patch:
"BLD",6310,1,28,0)
 
"BLD",6310,1,29,0)
a. SNOMED
"BLD",6310,1,30,0)
   Send a message to: S.LRLABSERVER@domain name
"BLD",6310,1,31,0)
             Subject: SNOMED
"BLD",6310,1,32,0)
 
"BLD",6310,1,33,0)
   The body of the message will be ignored. The following files are
"BLD",6310,1,34,0)
   scanned and data is extracted and extract data in a format for input
"BLD",6310,1,35,0)
   into Standards and Terminology Service (STS) mapping SNOMED tool:
"BLD",6310,1,36,0)
 
"BLD",6310,1,37,0)
   File #    File Name
"BLD",6310,1,38,0)
   ------    ---------
"BLD",6310,1,39,0)
   61        TOPOGRAPHY FIELD
"BLD",6310,1,40,0)
   61.1      MORPHOLOGY FIELD
"BLD",6310,1,41,0)
   61.2      ETIOLOGY FIELD
"BLD",6310,1,42,0)
   61.3      FUNCTION FIELD
"BLD",6310,1,43,0)
   61.4      DISEASE FIELD
"BLD",6310,1,44,0)
   61.5      PROCEDURE FIELD
"BLD",6310,1,45,0)
   61.6      OCCUPATION FIELD
"BLD",6310,1,46,0)
   62        COLLECTION SAMPLE
"BLD",6310,1,47,0)
 
"BLD",6310,1,48,0)
   Results are returned to the person
"BLD",6310,1,49,0)
   sending the mail message request. The extracted data is returned as an
"BLD",6310,1,50,0)
   attached file in a delimited format using the "|" character as
"BLD",6310,1,51,0)
   the field delimiter.
"BLD",6310,1,52,0)
 
"BLD",6310,1,53,0)
   Record legend for attached file:
"BLD",6310,1,54,0)
    Station #-File #-IEN|Entry Name|SNOMED I|VUID|SNOMED CT|
"BLD",6310,1,55,0)
    SNOMED CT TERM|Mapping Exception|Related Specimen|Related Specimen ID|
"BLD",6310,1,56,0)
    Extract Ver|
"BLD",6310,1,57,0)
 
"BLD",6310,1,58,0)
    Note: the fields RELATED SPECIMEN & RELATED SPECIMEN ID in the
"BLD",6310,1,59,0)
          record are only valued when the record relates to an entry
"BLD",6310,1,60,0)
          in COLLECTION SAMPLE file (#62) and indicates the related
"BLD",6310,1,61,0)
          specimen in TOPOGRAPHY FIELD file (#61).
"BLD",6310,1,62,0)
 
"BLD",6310,1,63,0)
 
"BLD",6310,1,64,0)
b. NLT/CPT
"BLD",6310,1,65,0)
   Send a message to: S.LRLABSERVER@domain name
"BLD",6310,1,66,0)
             Subject: NLT/CPT
"BLD",6310,1,67,0)
 
"BLD",6310,1,68,0)
   The body of the message will be ignored. The database is scanned
"BLD",6310,1,69,0)
   for mapped NLT, LOINC and CPT data. Results are returned to the person
"BLD",6310,1,70,0)
   sending the mail message request. The extracted data is returned as an
"BLD",6310,1,71,0)
   attached file in a delimited format using the "|" character as the field
"BLD",6310,1,72,0)
   delimiter.
"BLD",6310,1,73,0)
 
"BLD",6310,1,74,0)
   Record legend for attached file:
"BLD",6310,1,75,0)
   Station #-NLT IEN-CPT IEN-Spec-Time Aspect|NLT Code|NLT Name|CPT Code|CPT
"BLD",6310,1,76,0)
   Name|Specimen|Time Aspect|LOINC Code|LOINC Short Name|
"BLD",6310,1,77,0)
 
"BLD",6310,1,78,0)
 
"BLD",6310,1,79,0)
2. The existing LRLABSERVER report RELMA has been modified to extract
"BLD",6310,1,80,0)
additional information requested by VA Data Standardization service.
"BLD",6310,1,81,0)
   a. The extract will now include an extract version number. This patch
"BLD",6310,1,82,0)
      will set the version number to 1.1.
"BLD",6310,1,83,0)
   b. Include site's Laboratory Test site notes.
"BLD",6310,1,84,0)
   c. Include laboratory test's synonyms
"BLD",6310,1,85,0)
   d. Include laboratory test's type
"BLD",6310,1,86,0)
   e. Include laboratory test's default LOINC code.
"BLD",6310,1,87,0)
   f. Include mappings to suffixed NLT codes when laboratory code is mapped
"BLD",6310,1,88,0)
      to a generic NLT code and suffixed codes also exist.
"BLD",6310,1,89,0)
 
"BLD",6310,1,90,0)
The modified record layout of the extract is:
"BLD",6310,1,91,0)
 
"BLD",6310,1,92,0)
 Legend:
"BLD",6310,1,93,0)
|           1                   |    2    |  3 |     4     |  5  |   6
"BLD",6310,1,94,0)
|Station #-60 ien-Spec ien-Index|Test Name|Spec|Time Aspect|Units|LOINC
"BLD",6310,1,95,0)
 
"BLD",6310,1,96,0)
|  7  |    8       |     9             |     10    |   11    |   12
"BLD",6310,1,97,0)
|NLT #|Battery Code|Battery Description|Lab Section|Subscript|Comment
"BLD",6310,1,98,0)
 
"BLD",6310,1,99,0)
|    13   |    14       |     15       |      16       |       17
"BLD",6310,1,100,0)
|Data Type|Reference low|Reference high|Therapeutic low|Therapeutic high
"BLD",6310,1,101,0)
 
"BLD",6310,1,102,0)
|     18    |    19      |       20    |    21   |      22     |  23     |
"BLD",6310,1,103,0)
|Use Ref Lab|Site Comment|Test Synonyms|Test Type|Default LOINC|Extract Ver|
"BLD",6310,1,104,0)
 
"BLD",6310,1,105,0)
 
"BLD",6310,1,106,0)
3. Due to migration within Veterans Health Administration from Microsoft
"BLD",6310,1,107,0)
Exchange 2000 to Exchange 2003 the Microsoft Exchange system dropped support
"BLD",6310,1,108,0)
for 4 character Unix file permission which are part of the header used to
"BLD",6310,1,109,0)
uuencode the file attachment. The extract changes the uuencode file header
"BLD",6310,1,110,0)
from "begin 0664 "_filename to "begin 664 "_filename to enable successful
"BLD",6310,1,111,0)
processing of the uuencoded file by Exchange.
"BLD",6310,1,112,0)
 
"BLD",6310,1,113,0)
 
"BLD",6310,1,114,0)
 ASSOCIATED E3R
"BLD",6310,1,115,0)
 --------------
"BLD",6310,1,116,0)
 None
"BLD",6310,1,117,0)
 
"BLD",6310,1,118,0)
 ASSOCIATED REMEDY
"BLD",6310,1,119,0)
 ---------------
"BLD",6310,1,120,0)
 None
"BLD",6310,1,121,0)
 
"BLD",6310,1,122,0)
 
"BLD",6310,1,123,0)
 TEST SITES
"BLD",6310,1,124,0)
 ----------
"BLD",6310,1,125,0)
 Biloxi VAMC
"BLD",6310,1,126,0)
 Boston HCS VAMC
"BLD",6310,1,127,0)
 El Paso VAMC
"BLD",6310,1,128,0)
 Milwaukee VAMC
"BLD",6310,1,129,0)
 San Antonio VAMC
"BLD",6310,1,130,0)
 Upstate New York HCS
"BLD",6310,1,131,0)
 
"BLD",6310,1,132,0)
 
"BLD",6310,1,133,0)
ROUTINE SUMMARY
"BLD",6310,1,134,0)
===============
"BLD",6310,1,135,0)
  The following routines are included in this patch.  The second line
"BLD",6310,1,136,0)
  of each of these routines now looks like:
"BLD",6310,1,137,0)
  <tab> ;;5.2;LAB SERVICE;<patchlist>;Sep 27, 1994
"BLD",6310,1,138,0)
 
"BLD",6310,1,139,0)
                    Checksum       Checksum
"BLD",6310,1,140,0)
   Routine Name     Before Patch   After Patch    Patch List
"BLD",6310,1,141,0)
   ------------     ------------   -----------    ------------
"BLD",6310,1,142,0)
   LR346            N/A            4832883        **346** (Deleted by KIDS)
"BLD",6310,1,143,0)
   LRSRVR           5915085        5140630        **232,303,346**
"BLD",6310,1,144,0)
   LRSRVR2          12542186       9040430        **303,346**
"BLD",6310,1,145,0)
   LRSRVR2A         N/A            6229869        **346**
"BLD",6310,1,146,0)
   LRSRVR3          13571036       13681273       **303,346**
"BLD",6310,1,147,0)
   LRSRVR6          N/A            8991310        **346**
"BLD",6310,1,148,0)
   LRSRVR7          N/A            7316475        **346**
"BLD",6310,1,149,0)
 
"BLD",6310,1,150,0)
 List of preceding patches: 303
"BLD",6310,1,151,0)
 Sites should use CHECK^XTSUMBLD to verify checksums.
"BLD",6310,1,152,0)
 
"BLD",6310,1,153,0)
 
"BLD",6310,1,154,0)
INSTALLATION INSTRUCTIONS
"BLD",6310,1,155,0)
-------------------------
"BLD",6310,1,156,0)
  The install time for this patch is less than 5 minute. This patch
"BLD",6310,1,157,0)
  can be installed when Laboratory users are on the system.
"BLD",6310,1,158,0)
  Suggested time to install: non-peak requirement hours.
"BLD",6310,1,159,0)
 
"BLD",6310,1,160,0)
 
"BLD",6310,1,161,0)
NOTE: Kernel patches must be current on the target system to avoid
"BLD",6310,1,162,0)
      problems loading and/or installing this patch.
"BLD",6310,1,163,0)
 
"BLD",6310,1,164,0)
      Patch installation needs to be coordinated with the Laboratory
"BLD",6310,1,165,0)
      Information Manager (LIM/ADPAC).
"BLD",6310,1,166,0)
 
"BLD",6310,1,167,0)
 
"BLD",6310,1,168,0)
  1.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"BLD",6310,1,169,0)
        option will load the KIDS package onto your system.
"BLD",6310,1,170,0)
 
"BLD",6310,1,171,0)
  2.  On the 'Kernel Installation & Distribution System' Menu (KIDS),
"BLD",6310,1,172,0)
      select the 'Installation' menu.
"BLD",6310,1,173,0)
 
"BLD",6310,1,174,0)
  3.  From this menu, you may then elect to use the following options
"BLD",6310,1,175,0)
      (when prompted for the INSTALL NAME, enter LR*5.2*346):
"BLD",6310,1,176,0)
        a. Print Transport Global
"BLD",6310,1,177,0)
        b. Backup a Transport Global
"BLD",6310,1,178,0)
        c. Compare Transport Global to Current System
"BLD",6310,1,179,0)
        d. Verify Checksums in Transport Global
"BLD",6310,1,180,0)
 
"BLD",6310,1,181,0)
      Use the 'Verify Checksum in Transport Global' option and verify that
"BLD",6310,1,182,0)
      all routines have the correct checksums.
"BLD",6310,1,183,0)
 
"BLD",6310,1,184,0)
   4.  Use the 'Install Package(s)' option under the 'Installation' menu
"BLD",6310,1,185,0)
      and select the package 'LR*5.2*346'.
"BLD",6310,1,186,0)
 
"BLD",6310,1,187,0)
      When prompted 'Want KIDS to Rebuild Menu Trees Upon Completion of
"BLD",6310,1,188,0)
      Install? YES//' choose 'NO'. Responding 'Yes' to the prompt for
"BLD",6310,1,189,0)
      rebuilding menu trees can significantly increase install time.
"BLD",6310,1,190,0)
 
"BLD",6310,1,191,0)
      When prompted 'Want KIDS to INHIBIT LOGONs during the install? YES//
"BLD",6310,1,192,0)
      choose 'NO'.
"BLD",6310,1,193,0)
 
"BLD",6310,1,194,0)
      When prompted 'Want to DISABLE Scheduled Options, Menu Options,
"BLD",6310,1,195,0)
      and Protocols? YES//', choose 'NO'.
"BLD",6310,1,196,0)
 
"BLD",6310,1,197,0)
      During install KIDS will place the LR LAB SERVER option [LRLABSERVER]
"BLD",6310,1,198,0)
      out of order.
"BLD",6310,1,199,0)
 
"BLD",6310,1,200,0)
 Note: Routine LR346 will be deleted after successful patch installation.
"BLD",6310,1,201,0)
 
"BLD",6310,1,202,0)
 
"BLD",6310,1,203,0)
INSTALLATION EXAMPLE
"BLD",6310,1,204,0)
====================
"BLD",6310,1,205,0)
 
"BLD",6310,1,206,0)
Select Kernel Installation & Distribution System Option: Installation
"BLD",6310,1,207,0)
 
"BLD",6310,1,208,0)
Select Installation Option: 6  Install Package(s)
"BLD",6310,1,209,0)
Select INSTALL NAME: LR*5.2*346 Loaded from Distribution  9/16/05@15:38:31
"BLD",6310,1,210,0)
     => LR*5.2*346
"BLD",6310,1,211,0)
 
"BLD",6310,1,212,0)
This Distribution was loaded on Sep 16, 2005@15:38:31 with header of
"BLD",6310,1,213,0)
   LR*5.2*346
"BLD",6310,1,214,0)
   It consisted of the following Install(s):
"BLD",6310,1,215,0)
     LR*5.2*346
"BLD",6310,1,216,0)
Checking Install for Package LR*5.2*346
"BLD",6310,1,217,0)
Will first run the Environment Check Routine, LR346
"BLD",6310,1,218,0)
 
"BLD",6310,1,219,0)
 
"BLD",6310,1,220,0)
               Sending install started alert to mail group G.LMI
"BLD",6310,1,221,0)
 
"BLD",6310,1,222,0)
                        --- Environment Check is Ok ---
"BLD",6310,1,223,0)
 
"BLD",6310,1,224,0)
Install Questions for LR*5.2*346
"BLD",6310,1,225,0)
 
"BLD",6310,1,226,0)
 
"BLD",6310,1,227,0)
Want KIDS to Rebuild Menu Trees Upon Completion of Install? YES// NO
"BLD",6310,1,228,0)
 
"BLD",6310,1,229,0)
 
"BLD",6310,1,230,0)
Want KIDS to INHIBIT LOGONs during the install? YES// NO
"BLD",6310,1,231,0)
Want to DISABLE Scheduled Options, Menu Options, and Protocols? YES// NO
"BLD",6310,1,232,0)
 
"BLD",6310,1,233,0)
Enter the Device you want to print the Install messages.
"BLD",6310,1,234,0)
You can queue the install by enter a 'Q' at the device prompt.
"BLD",6310,1,235,0)
Enter a '^' to abort the install.
"BLD",6310,1,236,0)
 
"BLD",6310,1,237,0)
DEVICE: HOME//  TELNET VIRTUAL
"BLD",6310,1,238,0)
 
"BLD",6310,1,239,0)
 
"BLD",6310,1,240,0)
 
"BLD",6310,1,241,0)
 Install Started for LR*5.2*346 :
"BLD",6310,1,242,0)
               Sep 16, 2005@17:07:36
"BLD",6310,1,243,0)
 
"BLD",6310,1,244,0)
Build Distribution Date: Sep 16, 2005
"BLD",6310,1,245,0)
 
"BLD",6310,1,246,0)
 Installing Routines:
"BLD",6310,1,247,0)
               Sep 16, 2005@17:07:36
"BLD",6310,1,248,0)
 
"BLD",6310,1,249,0)
 Running Pre-Install Routine: PRE^LR346
"BLD",6310,1,250,0)
 
"BLD",6310,1,251,0)
                          *** Pre install started ***
"BLD",6310,1,252,0)
 
"BLD",6310,1,253,0)
                           *** No action required ***
"BLD",6310,1,254,0)
 
"BLD",6310,1,255,0)
                         *** Pre install completed ***
"BLD",6310,1,256,0)
 
"BLD",6310,1,257,0)
 Installing PACKAGE COMPONENTS:
"BLD",6310,1,258,0)
 
"BLD",6310,1,259,0)
 Installing OPTION
"BLD",6310,1,260,0)
               Sep 16, 2005@17:07:36
"BLD",6310,1,261,0)
 
"BLD",6310,1,262,0)
 
"BLD",6310,1,263,0)
 Running Post-Install Routine: POST^LR346
"BLD",6310,1,264,0)
 
"BLD",6310,1,265,0)
                          *** Post install started ***
"BLD",6310,1,266,0)
 
"BLD",6310,1,267,0)
                           *** No action required ***
"BLD",6310,1,268,0)
 
"BLD",6310,1,269,0)
                         *** Post install completed ***
"BLD",6310,1,270,0)
 
"BLD",6310,1,271,0)
              Sending install completion alert to mail group G.LMI
"BLD",6310,1,272,0)
 
"BLD",6310,1,273,0)
 Updating Routine file...
"BLD",6310,1,274,0)
 
"BLD",6310,1,275,0)
 Updating KIDS files...
"BLD",6310,1,276,0)
 
"BLD",6310,1,277,0)
 LR*5.2*346 Installed.
"BLD",6310,1,278,0)
               Sep 16, 2005@17:07:36
"BLD",6310,1,279,0)
 
"BLD",6310,1,280,0)
 Install Message sent #nnnnnn
"BLD",6310,1,281,0)
 
"BLD",6310,1,282,0)
Install Completed
"BLD",6310,1,283,0)

"BLD",6310,4,0)
^9.64PA^^0
"BLD",6310,6.3)
10
"BLD",6310,"ABPKG")
n
"BLD",6310,"INI")
PRE^LR346
"BLD",6310,"INID")
y
"BLD",6310,"INIT")
POST^LR346
"BLD",6310,"KRN",0)
^9.67PA^8989.52^19
"BLD",6310,"KRN",.4,0)
.4
"BLD",6310,"KRN",.401,0)
.401
"BLD",6310,"KRN",.402,0)
.402
"BLD",6310,"KRN",.403,0)
.403
"BLD",6310,"KRN",.5,0)
.5
"BLD",6310,"KRN",.84,0)
.84
"BLD",6310,"KRN",3.6,0)
3.6
"BLD",6310,"KRN",3.8,0)
3.8
"BLD",6310,"KRN",9.2,0)
9.2
"BLD",6310,"KRN",9.8,0)
9.8
"BLD",6310,"KRN",9.8,"NM",0)
^9.68A^8^6
"BLD",6310,"KRN",9.8,"NM",1,0)
LRSRVR^^0^B17596078
"BLD",6310,"KRN",9.8,"NM",4,0)
LRSRVR6^^0^B25592719
"BLD",6310,"KRN",9.8,"NM",5,0)
LRSRVR7^^0^B23564160
"BLD",6310,"KRN",9.8,"NM",6,0)
LRSRVR2^^0^B46042055
"BLD",6310,"KRN",9.8,"NM",7,0)
LRSRVR2A^^0^B11863535
"BLD",6310,"KRN",9.8,"NM",8,0)
LRSRVR3^^0^B41005024
"BLD",6310,"KRN",9.8,"NM","B","LRSRVR",1)

"BLD",6310,"KRN",9.8,"NM","B","LRSRVR2",6)

"BLD",6310,"KRN",9.8,"NM","B","LRSRVR2A",7)

"BLD",6310,"KRN",9.8,"NM","B","LRSRVR3",8)

"BLD",6310,"KRN",9.8,"NM","B","LRSRVR6",4)

"BLD",6310,"KRN",9.8,"NM","B","LRSRVR7",5)

"BLD",6310,"KRN",19,0)
19
"BLD",6310,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",6310,"KRN",19,"NM",1,0)
LRLABSERVER^^5^
"BLD",6310,"KRN",19,"NM","B","LRLABSERVER",1)

"BLD",6310,"KRN",19.1,0)
19.1
"BLD",6310,"KRN",101,0)
101
"BLD",6310,"KRN",409.61,0)
409.61
"BLD",6310,"KRN",771,0)
771
"BLD",6310,"KRN",870,0)
870
"BLD",6310,"KRN",8989.51,0)
8989.51
"BLD",6310,"KRN",8989.52,0)
8989.52
"BLD",6310,"KRN",8994,0)
8994
"BLD",6310,"KRN","B",.4,.4)

"BLD",6310,"KRN","B",.401,.401)

"BLD",6310,"KRN","B",.402,.402)

"BLD",6310,"KRN","B",.403,.403)

"BLD",6310,"KRN","B",.5,.5)

"BLD",6310,"KRN","B",.84,.84)

"BLD",6310,"KRN","B",3.6,3.6)

"BLD",6310,"KRN","B",3.8,3.8)

"BLD",6310,"KRN","B",9.2,9.2)

"BLD",6310,"KRN","B",9.8,9.8)

"BLD",6310,"KRN","B",19,19)

"BLD",6310,"KRN","B",19.1,19.1)

"BLD",6310,"KRN","B",101,101)

"BLD",6310,"KRN","B",409.61,409.61)

"BLD",6310,"KRN","B",771,771)

"BLD",6310,"KRN","B",870,870)

"BLD",6310,"KRN","B",8989.51,8989.51)

"BLD",6310,"KRN","B",8989.52,8989.52)

"BLD",6310,"KRN","B",8994,8994)

"BLD",6310,"PRE")
LR346
"BLD",6310,"QUES",0)
^9.62^^
"BLD",6310,"REQB",0)
^9.611^1^1
"BLD",6310,"REQB",1,0)
LR*5.2*303^2
"BLD",6310,"REQB","B","LR*5.2*303",1)

"INI")
PRE^LR346
"INIT")
POST^LR346
"KRN",19,11320,-1)
5^1
"KRN",19,11320,0)
LRLABSERVER
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2981028^66481
"PKG",26,22,1,"PAH",1,0)
346^3061013
"PKG",26,22,1,"PAH",1,1,0)
^^283^283^3061013
"PKG",26,22,1,"PAH",1,1,1,0)
 Blood Bank Clearance
"PKG",26,22,1,"PAH",1,1,2,0)
 ====================
"PKG",26,22,1,"PAH",1,1,3,0)
 
"PKG",26,22,1,"PAH",1,1,4,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LR*5.2*346 does not
"PKG",26,22,1,"PAH",1,1,5,0)
contain any changes to the VISTA BLOOD BANK Software as defined by VHA
"PKG",26,22,1,"PAH",1,1,6,0)
DIRECTIVE 2004-058 titled VISTA BLOOD BANK SOFTWARE VERSION 5.2.
"PKG",26,22,1,"PAH",1,1,7,0)
 
"PKG",26,22,1,"PAH",1,1,8,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LR*5.2*346 does not
"PKG",26,22,1,"PAH",1,1,9,0)
alter or modify any software design safeguards or safety critical elements
"PKG",26,22,1,"PAH",1,1,10,0)
functions.
"PKG",26,22,1,"PAH",1,1,11,0)
 
"PKG",26,22,1,"PAH",1,1,12,0)
RISK ANALYSIS: Changes made by patch LR*5.2*346 have no effect on Blood
"PKG",26,22,1,"PAH",1,1,13,0)
Bank software functionality, therefore RISK is none.
"PKG",26,22,1,"PAH",1,1,14,0)
 
"PKG",26,22,1,"PAH",1,1,15,0)
VALIDATION REQUIREMENTS BY OPTION: Because of the nature of the changes
"PKG",26,22,1,"PAH",1,1,16,0)
made, no specific validation requirements exist as a result of installation
"PKG",26,22,1,"PAH",1,1,17,0)
of this patch.
"PKG",26,22,1,"PAH",1,1,18,0)
----------------------------------------------------------------------------
"PKG",26,22,1,"PAH",1,1,19,0)
 
"PKG",26,22,1,"PAH",1,1,20,0)
As part of the VA/DoD Laboratory Data Sharing Interoperability (LDSI) Phase
"PKG",26,22,1,"PAH",1,1,21,0)
2 project supporting the exchange of microbiology and anatomic pathology
"PKG",26,22,1,"PAH",1,1,22,0)
laboratory test orders and results, enhancements have been made to the
"PKG",26,22,1,"PAH",1,1,23,0)
Laboratory server LRLABSERVER to extract selected VistA Laboratory files
"PKG",26,22,1,"PAH",1,1,24,0)
for SNOMED CT mapping.
"PKG",26,22,1,"PAH",1,1,25,0)
 
"PKG",26,22,1,"PAH",1,1,26,0)
1. The following are new LRLABSERVER server reports made available with
"PKG",26,22,1,"PAH",1,1,27,0)
this patch:
"PKG",26,22,1,"PAH",1,1,28,0)
 
"PKG",26,22,1,"PAH",1,1,29,0)
a. SNOMED
"PKG",26,22,1,"PAH",1,1,30,0)
   Send a message to: S.LRLABSERVER@domain name
"PKG",26,22,1,"PAH",1,1,31,0)
             Subject: SNOMED
"PKG",26,22,1,"PAH",1,1,32,0)
 
"PKG",26,22,1,"PAH",1,1,33,0)
   The body of the message will be ignored. The following files are
"PKG",26,22,1,"PAH",1,1,34,0)
   scanned and data is extracted and extract data in a format for input
"PKG",26,22,1,"PAH",1,1,35,0)
   into Standards and Terminology Service (STS) mapping SNOMED tool:
"PKG",26,22,1,"PAH",1,1,36,0)
 
"PKG",26,22,1,"PAH",1,1,37,0)
   File #    File Name
"PKG",26,22,1,"PAH",1,1,38,0)
   ------    ---------
"PKG",26,22,1,"PAH",1,1,39,0)
   61        TOPOGRAPHY FIELD
"PKG",26,22,1,"PAH",1,1,40,0)
   61.1      MORPHOLOGY FIELD
"PKG",26,22,1,"PAH",1,1,41,0)
   61.2      ETIOLOGY FIELD
"PKG",26,22,1,"PAH",1,1,42,0)
   61.3      FUNCTION FIELD
"PKG",26,22,1,"PAH",1,1,43,0)
   61.4      DISEASE FIELD
"PKG",26,22,1,"PAH",1,1,44,0)
   61.5      PROCEDURE FIELD
"PKG",26,22,1,"PAH",1,1,45,0)
   61.6      OCCUPATION FIELD
"PKG",26,22,1,"PAH",1,1,46,0)
   62        COLLECTION SAMPLE
"PKG",26,22,1,"PAH",1,1,47,0)
 
"PKG",26,22,1,"PAH",1,1,48,0)
   Results are returned to the person
"PKG",26,22,1,"PAH",1,1,49,0)
   sending the mail message request. The extracted data is returned as an
"PKG",26,22,1,"PAH",1,1,50,0)
   attached file in a delimited format using the "|" character as
"PKG",26,22,1,"PAH",1,1,51,0)
   the field delimiter.
"PKG",26,22,1,"PAH",1,1,52,0)
 
"PKG",26,22,1,"PAH",1,1,53,0)
   Record legend for attached file:
"PKG",26,22,1,"PAH",1,1,54,0)
    Station #-File #-IEN|Entry Name|SNOMED I|VUID|SNOMED CT|
"PKG",26,22,1,"PAH",1,1,55,0)
    SNOMED CT TERM|Mapping Exception|Related Specimen|Related Specimen ID|
"PKG",26,22,1,"PAH",1,1,56,0)
    Extract Ver|
"PKG",26,22,1,"PAH",1,1,57,0)
 
"PKG",26,22,1,"PAH",1,1,58,0)
    Note: the fields RELATED SPECIMEN & RELATED SPECIMEN ID in the
"PKG",26,22,1,"PAH",1,1,59,0)
          record are only valued when the record relates to an entry
"PKG",26,22,1,"PAH",1,1,60,0)
          in COLLECTION SAMPLE file (#62) and indicates the related
"PKG",26,22,1,"PAH",1,1,61,0)
          specimen in TOPOGRAPHY FIELD file (#61).
"PKG",26,22,1,"PAH",1,1,62,0)
 
"PKG",26,22,1,"PAH",1,1,63,0)
 
"PKG",26,22,1,"PAH",1,1,64,0)
b. NLT/CPT
"PKG",26,22,1,"PAH",1,1,65,0)
   Send a message to: S.LRLABSERVER@domain name
"PKG",26,22,1,"PAH",1,1,66,0)
             Subject: NLT/CPT
"PKG",26,22,1,"PAH",1,1,67,0)
 
"PKG",26,22,1,"PAH",1,1,68,0)
   The body of the message will be ignored. The database is scanned
"PKG",26,22,1,"PAH",1,1,69,0)
   for mapped NLT, LOINC and CPT data. Results are returned to the person
"PKG",26,22,1,"PAH",1,1,70,0)
   sending the mail message request. The extracted data is returned as an
"PKG",26,22,1,"PAH",1,1,71,0)
   attached file in a delimited format using the "|" character as the field
"PKG",26,22,1,"PAH",1,1,72,0)
   delimiter.
"PKG",26,22,1,"PAH",1,1,73,0)
 
"PKG",26,22,1,"PAH",1,1,74,0)
   Record legend for attached file:
"PKG",26,22,1,"PAH",1,1,75,0)
   Station #-NLT IEN-CPT IEN-Spec-Time Aspect|NLT Code|NLT Name|CPT Code|CPT
"PKG",26,22,1,"PAH",1,1,76,0)
   Name|Specimen|Time Aspect|LOINC Code|LOINC Short Name|
"PKG",26,22,1,"PAH",1,1,77,0)
 
"PKG",26,22,1,"PAH",1,1,78,0)
 
"PKG",26,22,1,"PAH",1,1,79,0)
2. The existing LRLABSERVER report RELMA has been modified to extract
"PKG",26,22,1,"PAH",1,1,80,0)
additional information requested by VA Data Standardization service.
"PKG",26,22,1,"PAH",1,1,81,0)
   a. The extract will now include an extract version number. This patch
"PKG",26,22,1,"PAH",1,1,82,0)
      will set the version number to 1.1.
"PKG",26,22,1,"PAH",1,1,83,0)
   b. Include site's Laboratory Test site notes.
"PKG",26,22,1,"PAH",1,1,84,0)
   c. Include laboratory test's synonyms
"PKG",26,22,1,"PAH",1,1,85,0)
   d. Include laboratory test's type
"PKG",26,22,1,"PAH",1,1,86,0)
   e. Include laboratory test's default LOINC code.
"PKG",26,22,1,"PAH",1,1,87,0)
   f. Include mappings to suffixed NLT codes when laboratory code is mapped
"PKG",26,22,1,"PAH",1,1,88,0)
      to a generic NLT code and suffixed codes also exist.
"PKG",26,22,1,"PAH",1,1,89,0)
 
"PKG",26,22,1,"PAH",1,1,90,0)
The modified record layout of the extract is:
"PKG",26,22,1,"PAH",1,1,91,0)
 
"PKG",26,22,1,"PAH",1,1,92,0)
 Legend:
"PKG",26,22,1,"PAH",1,1,93,0)
|           1                   |    2    |  3 |     4     |  5  |   6
"PKG",26,22,1,"PAH",1,1,94,0)
|Station #-60 ien-Spec ien-Index|Test Name|Spec|Time Aspect|Units|LOINC
"PKG",26,22,1,"PAH",1,1,95,0)
 
"PKG",26,22,1,"PAH",1,1,96,0)
|  7  |    8       |     9             |     10    |   11    |   12
"PKG",26,22,1,"PAH",1,1,97,0)
|NLT #|Battery Code|Battery Description|Lab Section|Subscript|Comment
"PKG",26,22,1,"PAH",1,1,98,0)
 
"PKG",26,22,1,"PAH",1,1,99,0)
|    13   |    14       |     15       |      16       |       17
"PKG",26,22,1,"PAH",1,1,100,0)
|Data Type|Reference low|Reference high|Therapeutic low|Therapeutic high
"PKG",26,22,1,"PAH",1,1,101,0)
 
"PKG",26,22,1,"PAH",1,1,102,0)
|     18    |    19      |       20    |    21   |      22     |  23     |
"PKG",26,22,1,"PAH",1,1,103,0)
|Use Ref Lab|Site Comment|Test Synonyms|Test Type|Default LOINC|Extract Ver|
"PKG",26,22,1,"PAH",1,1,104,0)
 
"PKG",26,22,1,"PAH",1,1,105,0)
 
"PKG",26,22,1,"PAH",1,1,106,0)
3. Due to migration within Veterans Health Administration from Microsoft
"PKG",26,22,1,"PAH",1,1,107,0)
Exchange 2000 to Exchange 2003 the Microsoft Exchange system dropped support
"PKG",26,22,1,"PAH",1,1,108,0)
for 4 character Unix file permission which are part of the header used to
"PKG",26,22,1,"PAH",1,1,109,0)
uuencode the file attachment. The extract changes the uuencode file header
"PKG",26,22,1,"PAH",1,1,110,0)
from "begin 0664 "_filename to "begin 664 "_filename to enable successful
"PKG",26,22,1,"PAH",1,1,111,0)
processing of the uuencoded file by Exchange.
"PKG",26,22,1,"PAH",1,1,112,0)
 
"PKG",26,22,1,"PAH",1,1,113,0)
 
"PKG",26,22,1,"PAH",1,1,114,0)
 ASSOCIATED E3R
"PKG",26,22,1,"PAH",1,1,115,0)
 --------------
"PKG",26,22,1,"PAH",1,1,116,0)
 None
"PKG",26,22,1,"PAH",1,1,117,0)
 
"PKG",26,22,1,"PAH",1,1,118,0)
 ASSOCIATED REMEDY
"PKG",26,22,1,"PAH",1,1,119,0)
 ---------------
"PKG",26,22,1,"PAH",1,1,120,0)
 None
"PKG",26,22,1,"PAH",1,1,121,0)
 
"PKG",26,22,1,"PAH",1,1,122,0)
 
"PKG",26,22,1,"PAH",1,1,123,0)
 TEST SITES
"PKG",26,22,1,"PAH",1,1,124,0)
 ----------
"PKG",26,22,1,"PAH",1,1,125,0)
 Biloxi VAMC
"PKG",26,22,1,"PAH",1,1,126,0)
 Boston HCS VAMC
"PKG",26,22,1,"PAH",1,1,127,0)
 El Paso VAMC
"PKG",26,22,1,"PAH",1,1,128,0)
 Milwaukee VAMC
"PKG",26,22,1,"PAH",1,1,129,0)
 San Antonio VAMC
"PKG",26,22,1,"PAH",1,1,130,0)
 Upstate New York HCS
"PKG",26,22,1,"PAH",1,1,131,0)
 
"PKG",26,22,1,"PAH",1,1,132,0)
 
"PKG",26,22,1,"PAH",1,1,133,0)
ROUTINE SUMMARY
"PKG",26,22,1,"PAH",1,1,134,0)
===============
"PKG",26,22,1,"PAH",1,1,135,0)
  The following routines are included in this patch.  The second line
"PKG",26,22,1,"PAH",1,1,136,0)
  of each of these routines now looks like:
"PKG",26,22,1,"PAH",1,1,137,0)
  <tab> ;;5.2;LAB SERVICE;<patchlist>;Sep 27, 1994
"PKG",26,22,1,"PAH",1,1,138,0)
 
"PKG",26,22,1,"PAH",1,1,139,0)
                    Checksum       Checksum
"PKG",26,22,1,"PAH",1,1,140,0)
   Routine Name     Before Patch   After Patch    Patch List
"PKG",26,22,1,"PAH",1,1,141,0)
   ------------     ------------   -----------    ------------
"PKG",26,22,1,"PAH",1,1,142,0)
   LR346            N/A            4832883        **346** (Deleted by KIDS)
"PKG",26,22,1,"PAH",1,1,143,0)
   LRSRVR           5915085        5140630        **232,303,346**
"PKG",26,22,1,"PAH",1,1,144,0)
   LRSRVR2          12542186       9040430        **303,346**
"PKG",26,22,1,"PAH",1,1,145,0)
   LRSRVR2A         N/A            6229869        **346**
"PKG",26,22,1,"PAH",1,1,146,0)
   LRSRVR3          13571036       13681273       **303,346**
"PKG",26,22,1,"PAH",1,1,147,0)
   LRSRVR6          N/A            8991310        **346**
"PKG",26,22,1,"PAH",1,1,148,0)
   LRSRVR7          N/A            7316475        **346**
"PKG",26,22,1,"PAH",1,1,149,0)
 
"PKG",26,22,1,"PAH",1,1,150,0)
 List of preceding patches: 303
"PKG",26,22,1,"PAH",1,1,151,0)
 Sites should use CHECK^XTSUMBLD to verify checksums.
"PKG",26,22,1,"PAH",1,1,152,0)
 
"PKG",26,22,1,"PAH",1,1,153,0)
 
"PKG",26,22,1,"PAH",1,1,154,0)
INSTALLATION INSTRUCTIONS
"PKG",26,22,1,"PAH",1,1,155,0)
-------------------------
"PKG",26,22,1,"PAH",1,1,156,0)
  The install time for this patch is less than 5 minute. This patch
"PKG",26,22,1,"PAH",1,1,157,0)
  can be installed when Laboratory users are on the system.
"PKG",26,22,1,"PAH",1,1,158,0)
  Suggested time to install: non-peak requirement hours.
"PKG",26,22,1,"PAH",1,1,159,0)
 
"PKG",26,22,1,"PAH",1,1,160,0)
 
"PKG",26,22,1,"PAH",1,1,161,0)
NOTE: Kernel patches must be current on the target system to avoid
"PKG",26,22,1,"PAH",1,1,162,0)
      problems loading and/or installing this patch.
"PKG",26,22,1,"PAH",1,1,163,0)
 
"PKG",26,22,1,"PAH",1,1,164,0)
      Patch installation needs to be coordinated with the Laboratory
"PKG",26,22,1,"PAH",1,1,165,0)
      Information Manager (LIM/ADPAC).
"PKG",26,22,1,"PAH",1,1,166,0)
 
"PKG",26,22,1,"PAH",1,1,167,0)
 
"PKG",26,22,1,"PAH",1,1,168,0)
  1.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"PKG",26,22,1,"PAH",1,1,169,0)
        option will load the KIDS package onto your system.
"PKG",26,22,1,"PAH",1,1,170,0)
 
"PKG",26,22,1,"PAH",1,1,171,0)
  2.  On the 'Kernel Installation & Distribution System' Menu (KIDS),
"PKG",26,22,1,"PAH",1,1,172,0)
      select the 'Installation' menu.
"PKG",26,22,1,"PAH",1,1,173,0)
 
"PKG",26,22,1,"PAH",1,1,174,0)
  3.  From this menu, you may then elect to use the following options
"PKG",26,22,1,"PAH",1,1,175,0)
      (when prompted for the INSTALL NAME, enter LR*5.2*346):
"PKG",26,22,1,"PAH",1,1,176,0)
        a. Print Transport Global
"PKG",26,22,1,"PAH",1,1,177,0)
        b. Backup a Transport Global
"PKG",26,22,1,"PAH",1,1,178,0)
        c. Compare Transport Global to Current System
"PKG",26,22,1,"PAH",1,1,179,0)
        d. Verify Checksums in Transport Global
"PKG",26,22,1,"PAH",1,1,180,0)
 
"PKG",26,22,1,"PAH",1,1,181,0)
      Use the 'Verify Checksum in Transport Global' option and verify that
"PKG",26,22,1,"PAH",1,1,182,0)
      all routines have the correct checksums.
"PKG",26,22,1,"PAH",1,1,183,0)
 
"PKG",26,22,1,"PAH",1,1,184,0)
   4.  Use the 'Install Package(s)' option under the 'Installation' menu
"PKG",26,22,1,"PAH",1,1,185,0)
      and select the package 'LR*5.2*346'.
"PKG",26,22,1,"PAH",1,1,186,0)
 
"PKG",26,22,1,"PAH",1,1,187,0)
      When prompted 'Want KIDS to Rebuild Menu Trees Upon Completion of
"PKG",26,22,1,"PAH",1,1,188,0)
      Install? YES//' choose 'NO'. Responding 'Yes' to the prompt for
"PKG",26,22,1,"PAH",1,1,189,0)
      rebuilding menu trees can significantly increase install time.
"PKG",26,22,1,"PAH",1,1,190,0)
 
"PKG",26,22,1,"PAH",1,1,191,0)
      When prompted 'Want KIDS to INHIBIT LOGONs during the install? YES//
"PKG",26,22,1,"PAH",1,1,192,0)
      choose 'NO'.
"PKG",26,22,1,"PAH",1,1,193,0)
 
"PKG",26,22,1,"PAH",1,1,194,0)
      When prompted 'Want to DISABLE Scheduled Options, Menu Options,
"PKG",26,22,1,"PAH",1,1,195,0)
      and Protocols? YES//', choose 'NO'.
"PKG",26,22,1,"PAH",1,1,196,0)
 
"PKG",26,22,1,"PAH",1,1,197,0)
      During install KIDS will place the LR LAB SERVER option [LRLABSERVER]
"PKG",26,22,1,"PAH",1,1,198,0)
      out of order.
"PKG",26,22,1,"PAH",1,1,199,0)
 
"PKG",26,22,1,"PAH",1,1,200,0)
 Note: Routine LR346 will be deleted after successful patch installation.
"PKG",26,22,1,"PAH",1,1,201,0)
 
"PKG",26,22,1,"PAH",1,1,202,0)
 
"PKG",26,22,1,"PAH",1,1,203,0)
INSTALLATION EXAMPLE
"PKG",26,22,1,"PAH",1,1,204,0)
====================
"PKG",26,22,1,"PAH",1,1,205,0)
 
"PKG",26,22,1,"PAH",1,1,206,0)
Select Kernel Installation & Distribution System Option: Installation
"PKG",26,22,1,"PAH",1,1,207,0)
 
"PKG",26,22,1,"PAH",1,1,208,0)
Select Installation Option: 6  Install Package(s)
"PKG",26,22,1,"PAH",1,1,209,0)
Select INSTALL NAME: LR*5.2*346 Loaded from Distribution  9/16/05@15:38:31
"PKG",26,22,1,"PAH",1,1,210,0)
     => LR*5.2*346
"PKG",26,22,1,"PAH",1,1,211,0)
 
"PKG",26,22,1,"PAH",1,1,212,0)
This Distribution was loaded on Sep 16, 2005@15:38:31 with header of
"PKG",26,22,1,"PAH",1,1,213,0)
   LR*5.2*346
"PKG",26,22,1,"PAH",1,1,214,0)
   It consisted of the following Install(s):
"PKG",26,22,1,"PAH",1,1,215,0)
     LR*5.2*346
"PKG",26,22,1,"PAH",1,1,216,0)
Checking Install for Package LR*5.2*346
"PKG",26,22,1,"PAH",1,1,217,0)
Will first run the Environment Check Routine, LR346
"PKG",26,22,1,"PAH",1,1,218,0)
 
"PKG",26,22,1,"PAH",1,1,219,0)
 
"PKG",26,22,1,"PAH",1,1,220,0)
               Sending install started alert to mail group G.LMI
"PKG",26,22,1,"PAH",1,1,221,0)
 
"PKG",26,22,1,"PAH",1,1,222,0)
                        --- Environment Check is Ok ---
"PKG",26,22,1,"PAH",1,1,223,0)
 
"PKG",26,22,1,"PAH",1,1,224,0)
Install Questions for LR*5.2*346
"PKG",26,22,1,"PAH",1,1,225,0)
 
"PKG",26,22,1,"PAH",1,1,226,0)
 
"PKG",26,22,1,"PAH",1,1,227,0)
Want KIDS to Rebuild Menu Trees Upon Completion of Install? YES// NO
"PKG",26,22,1,"PAH",1,1,228,0)
 
"PKG",26,22,1,"PAH",1,1,229,0)
 
"PKG",26,22,1,"PAH",1,1,230,0)
Want KIDS to INHIBIT LOGONs during the install? YES// NO
"PKG",26,22,1,"PAH",1,1,231,0)
Want to DISABLE Scheduled Options, Menu Options, and Protocols? YES// NO
"PKG",26,22,1,"PAH",1,1,232,0)
 
"PKG",26,22,1,"PAH",1,1,233,0)
Enter the Device you want to print the Install messages.
"PKG",26,22,1,"PAH",1,1,234,0)
You can queue the install by enter a 'Q' at the device prompt.
"PKG",26,22,1,"PAH",1,1,235,0)
Enter a '^' to abort the install.
"PKG",26,22,1,"PAH",1,1,236,0)
 
"PKG",26,22,1,"PAH",1,1,237,0)
DEVICE: HOME//  TELNET VIRTUAL
"PKG",26,22,1,"PAH",1,1,238,0)
 
"PKG",26,22,1,"PAH",1,1,239,0)
 
"PKG",26,22,1,"PAH",1,1,240,0)
 
"PKG",26,22,1,"PAH",1,1,241,0)
 Install Started for LR*5.2*346 :
"PKG",26,22,1,"PAH",1,1,242,0)
               Sep 16, 2005@17:07:36
"PKG",26,22,1,"PAH",1,1,243,0)
 
"PKG",26,22,1,"PAH",1,1,244,0)
Build Distribution Date: Sep 16, 2005
"PKG",26,22,1,"PAH",1,1,245,0)
 
"PKG",26,22,1,"PAH",1,1,246,0)
 Installing Routines:
"PKG",26,22,1,"PAH",1,1,247,0)
               Sep 16, 2005@17:07:36
"PKG",26,22,1,"PAH",1,1,248,0)
 
"PKG",26,22,1,"PAH",1,1,249,0)
 Running Pre-Install Routine: PRE^LR346
"PKG",26,22,1,"PAH",1,1,250,0)
 
"PKG",26,22,1,"PAH",1,1,251,0)
                          *** Pre install started ***
"PKG",26,22,1,"PAH",1,1,252,0)
 
"PKG",26,22,1,"PAH",1,1,253,0)
                           *** No action required ***
"PKG",26,22,1,"PAH",1,1,254,0)
 
"PKG",26,22,1,"PAH",1,1,255,0)
                         *** Pre install completed ***
"PKG",26,22,1,"PAH",1,1,256,0)
 
"PKG",26,22,1,"PAH",1,1,257,0)
 Installing PACKAGE COMPONENTS:
"PKG",26,22,1,"PAH",1,1,258,0)
 
"PKG",26,22,1,"PAH",1,1,259,0)
 Installing OPTION
"PKG",26,22,1,"PAH",1,1,260,0)
               Sep 16, 2005@17:07:36
"PKG",26,22,1,"PAH",1,1,261,0)
 
"PKG",26,22,1,"PAH",1,1,262,0)
 
"PKG",26,22,1,"PAH",1,1,263,0)
 Running Post-Install Routine: POST^LR346
"PKG",26,22,1,"PAH",1,1,264,0)
 
"PKG",26,22,1,"PAH",1,1,265,0)
                          *** Post install started ***
"PKG",26,22,1,"PAH",1,1,266,0)
 
"PKG",26,22,1,"PAH",1,1,267,0)
                           *** No action required ***
"PKG",26,22,1,"PAH",1,1,268,0)
 
"PKG",26,22,1,"PAH",1,1,269,0)
                         *** Post install completed ***
"PKG",26,22,1,"PAH",1,1,270,0)
 
"PKG",26,22,1,"PAH",1,1,271,0)
              Sending install completion alert to mail group G.LMI
"PKG",26,22,1,"PAH",1,1,272,0)
 
"PKG",26,22,1,"PAH",1,1,273,0)
 Updating Routine file...
"PKG",26,22,1,"PAH",1,1,274,0)
 
"PKG",26,22,1,"PAH",1,1,275,0)
 Updating KIDS files...
"PKG",26,22,1,"PAH",1,1,276,0)
 
"PKG",26,22,1,"PAH",1,1,277,0)
 LR*5.2*346 Installed.
"PKG",26,22,1,"PAH",1,1,278,0)
               Sep 16, 2005@17:07:36
"PKG",26,22,1,"PAH",1,1,279,0)
 
"PKG",26,22,1,"PAH",1,1,280,0)
 Install Message sent #nnnnnn
"PKG",26,22,1,"PAH",1,1,281,0)
 
"PKG",26,22,1,"PAH",1,1,282,0)
Install Completed
"PKG",26,22,1,"PAH",1,1,283,0)

"PRE")
LR346
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","LR346")
0^^B9528998^n/a
"RTN","LR346",1,0)
LR346 ;DALOI/JMC - LR*5.2*346 PATCH ENVIRONMENT CHECK ROUTINE ;Sep 7, 2005
"RTN","LR346",2,0)
 ;;5.2;LAB SERVICE;**346**;Sep 27, 1994;Build 10
"RTN","LR346",3,0)
EN ; Does not prevent loading of the transport global.
"RTN","LR346",4,0)
 ; Environment check is done only during the install.
"RTN","LR346",5,0)
 ;
"RTN","LR346",6,0)
 N XQA,XQAMSG
"RTN","LR346",7,0)
 ;
"RTN","LR346",8,0)
 I '$G(XPDENV) D  Q
"RTN","LR346",9,0)
 . S XQAMSG="Transport global for patch "_$G(XPDNM,"Unknown patch")_" loaded on "_$$HTE^XLFDT($H)
"RTN","LR346",10,0)
 . S XQA("G.LMI")=""
"RTN","LR346",11,0)
 . D SETUP^XQALERT
"RTN","LR346",12,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Sending transport global loaded alert to mail group G.LMI",80))
"RTN","LR346",13,0)
 ;
"RTN","LR346",14,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")_" started on "_$$HTE^XLFDT($H)
"RTN","LR346",15,0)
 S XQA("G.LMI")=""
"RTN","LR346",16,0)
 D SETUP^XQALERT
"RTN","LR346",17,0)
 D BMES^XPDUTL($$CJ^XLFSTR("Sending install started alert to mail group G.LMI",80))
"RTN","LR346",18,0)
 ;
"RTN","LR346",19,0)
 D CHECK
"RTN","LR346",20,0)
 D EXIT
"RTN","LR346",21,0)
 Q
"RTN","LR346",22,0)
 ;
"RTN","LR346",23,0)
CHECK ; Perform environment check
"RTN","LR346",24,0)
 I $S('$G(IOM):1,'$G(IOSL):1,$G(U)'="^":1,1:0) D  Q
"RTN","LR346",25,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Terminal Device is not defined",80))
"RTN","LR346",26,0)
 . S XPDQUIT=2
"RTN","LR346",27,0)
 I $S('$G(DUZ):1,$D(DUZ)[0:1,$D(DUZ(0))[0:1,1:0) D  Q
"RTN","LR346",28,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("Please log in to set local DUZ... variables",80))
"RTN","LR346",29,0)
 . S XPDQUIT=2
"RTN","LR346",30,0)
 I $P($$ACTIVE^XUSER(DUZ),"^")'=1 D  Q
"RTN","LR346",31,0)
 . D BMES^XPDUTL($$CJ^XLFSTR("You are not a valid user on this system",80))
"RTN","LR346",32,0)
 . S XPDQUIT=2
"RTN","LR346",33,0)
 S XPDIQ("XPZ1","B")="NO"
"RTN","LR346",34,0)
 Q
"RTN","LR346",35,0)
 ;
"RTN","LR346",36,0)
EXIT ;
"RTN","LR346",37,0)
 I $G(XPDQUIT) D BMES^XPDUTL($$CJ^XLFSTR("--- Install Environment Check FAILED ---",80))
"RTN","LR346",38,0)
 I '$G(XPDQUIT) D BMES^XPDUTL($$CJ^XLFSTR("--- Environment Check is Ok ---",80))
"RTN","LR346",39,0)
 Q
"RTN","LR346",40,0)
 ;
"RTN","LR346",41,0)
PRE ; KIDS Pre install
"RTN","LR346",42,0)
 ;
"RTN","LR346",43,0)
 N DIU
"RTN","LR346",44,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install started ***",80))
"RTN","LR346",45,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** No action required ***",80))
"RTN","LR346",46,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Pre install completed ***",80))
"RTN","LR346",47,0)
 Q
"RTN","LR346",48,0)
 ;
"RTN","LR346",49,0)
POST ; KIDS Post install
"RTN","LR346",50,0)
 N XQA,XQAMSG
"RTN","LR346",51,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install started ***",80))
"RTN","LR346",52,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** No action required ***",80))
"RTN","LR346",53,0)
 D BMES^XPDUTL($$CJ^XLFSTR("*** Post install completed ***",80))
"RTN","LR346",54,0)
 D BMES^XPDUTL($$CJ^XLFSTR("Sending install completion alert to mail group G.LMI",80))
"RTN","LR346",55,0)
 S XQAMSG="Installation of patch "_$G(XPDNM,"Unknown patch")_" completed on "_$$HTE^XLFDT($H)
"RTN","LR346",56,0)
 S XQA("G.LMI")=""
"RTN","LR346",57,0)
 D SETUP^XQALERT
"RTN","LR346",58,0)
 S XQAMSG="LIM: Review description for "_$G(XPDNM,"Unknown patch")_" use KIDS:Utilities:Build File Print"
"RTN","LR346",59,0)
 S XQA("G.LMI")=""
"RTN","LR346",60,0)
 D SETUP^XQALERT
"RTN","LR346",61,0)
 Q
"RTN","LRSRVR")
0^1^B17596078^B18875049
"RTN","LRSRVR",1,0)
LRSRVR ;DALOI/RLM/JMC - LAB DATA SERVER ; Aug 17, 2006
"RTN","LRSRVR",2,0)
 ;;5.2;LAB SERVICE;**232,303,346**;Sep 27, 1994;Build 10
"RTN","LRSRVR",3,0)
 ; Reference to ^%ZOSF supported by IA #10096
"RTN","LRSRVR",4,0)
 ; Reference to $$SITE^VASITE supported by IA #10112
"RTN","LRSRVR",5,0)
 ;
"RTN","LRSRVR",6,0)
START ;
"RTN","LRSRVR",7,0)
 N LRSITE,LRST,LRSUB,LRXMZ
"RTN","LRSRVR",8,0)
 ;
"RTN","LRSRVR",9,0)
 ; Save incoming server message id for cleanup
"RTN","LRSRVR",10,0)
 S LRXMZ=XMZ
"RTN","LRSRVR",11,0)
 ;
"RTN","LRSRVR",12,0)
 K ^TMP($J,"LRDATA"),^TMP($J,"LRDTERR")
"RTN","LRSRVR",13,0)
 ; Determine station name and number
"RTN","LRSRVR",14,0)
 S LRSITE=$$SITE^VASITE,LRSTN=$P(LRSITE,"^",2),LRST=$P(LRSITE,"^",3)
"RTN","LRSRVR",15,0)
 I LRST="" S LRST="???"
"RTN","LRSRVR",16,0)
 ;
"RTN","LRSRVR",17,0)
 S LRSUB=$$UP^XLFSTR(XQSUB)
"RTN","LRSRVR",18,0)
 ;
"RTN","LRSRVR",19,0)
 ; The first line of the message tells who requested the action and when
"RTN","LRSRVR",20,0)
 ; The second line tells when the server is activated and no data can be
"RTN","LRSRVR",21,0)
 ; gathered from the MailMan message.  This line gets replaced if the
"RTN","LRSRVR",22,0)
 ; server finds something to do.
"RTN","LRSRVR",23,0)
 S ^TMP($J,"LRDATA",1)=LRSUB_" triggered at "_LRSTN_" by "_XMFROM_" on "_XQDATE
"RTN","LRSRVR",24,0)
 S LRACTION=$S(LRSUB["CHECKSUM":"Checksums Generated",1:LRSUB)
"RTN","LRSRVR",25,0)
 S ^TMP($J,"LRDATA",2)="I don't know how to "_LRACTION_" at "_LRSTN
"RTN","LRSRVR",26,0)
 ;
"RTN","LRSRVR",27,0)
 ;
"RTN","LRSRVR",28,0)
 ; If the subject contains "CHECKSUM" send a report of the current checksums to the LABTEAM group on RDMAIL
"RTN","LRSRVR",29,0)
 I LRSUB["CHECKSUM" D CSUM Q
"RTN","LRSRVR",30,0)
 ;
"RTN","LRSRVR",31,0)
 ; If the subject contains "LIST" send a report based on the list of routines in the body of the message back to the original sender.
"RTN","LRSRVR",32,0)
 I LRSUB["LIST" D SUMLST Q
"RTN","LRSRVR",33,0)
 ;
"RTN","LRSRVR",34,0)
 ; If the subject equals "LOINC" send the local LOINC data to the national list.
"RTN","LRSRVR",35,0)
 I LRSUB="LOINC" D LOINC^LRSRVR1 Q
"RTN","LRSRVR",36,0)
 ;
"RTN","LRSRVR",37,0)
 ; If the subject contains "LOCAL REPORT" send the local LOINC data to the sender.
"RTN","LRSRVR",38,0)
 I LRSUB="LOCAL REPORT" D LOINCL^LRSRVR1 Q
"RTN","LRSRVR",39,0)
 I LRSUB="LOCAL REPORT DELIMIT" D LOINCLD^LRSRVR3 Q
"RTN","LRSRVR",40,0)
 ;
"RTN","LRSRVR",41,0)
 ; Send RELMA mapper formatted message
"RTN","LRSRVR",42,0)
 I LRSUB="RELMA" D SERVER^LRSRVR2 Q
"RTN","LRSRVR",43,0)
 ; Process RELMA mapper Packman global message
"RTN","LRSRVR",44,0)
 ;I LRSUB="RELMA MAPPING" D RMAP^LRSRVR5 Q
"RTN","LRSRVR",45,0)
 ;
"RTN","LRSRVR",46,0)
 ; Send SNOMED mapping formatted message
"RTN","LRSRVR",47,0)
 I LRSUB="SNOMED" D SERVER^LRSRVR6 Q
"RTN","LRSRVR",48,0)
 ;
"RTN","LRSRVR",49,0)
 ; Send NLT/CPT mapping formatted message
"RTN","LRSRVR",50,0)
 I LRSUB="NLT/CPT" D SERVER^LRSRVR7 Q
"RTN","LRSRVR",51,0)
 ;
"RTN","LRSRVR",52,0)
 ; If subject not understood by server, send a message to the sender
"RTN","LRSRVR",53,0)
 ;  that the server can't understand their instructions.
"RTN","LRSRVR",54,0)
 K XMY
"RTN","LRSRVR",55,0)
 S XMY(XQSND)=""
"RTN","LRSRVR",56,0)
 ;
"RTN","LRSRVR",57,0)
EXIT ; If all went well, report that too.
"RTN","LRSRVR",58,0)
 ; Mail the errors and successes back to the Roll-Up group at Forum.
"RTN","LRSRVR",59,0)
 N LRNOW
"RTN","LRSRVR",60,0)
 S LRNOW=$$NOW^XLFDT
"RTN","LRSRVR",61,0)
 S XMDUN="Lab Server",XMDUZ=".5",XMSUB=LRSTN_" LAB SERVER ("_LRNOW_")"
"RTN","LRSRVR",62,0)
 S XMTEXT="^TMP($J,""LRDATA"","
"RTN","LRSRVR",63,0)
 I '$D(XMY) S XMY("G.LABTEAM@ISC-DALLAS.VA.GOV")=""
"RTN","LRSRVR",64,0)
 D ^XMD
"RTN","LRSRVR",65,0)
 ;
"RTN","LRSRVR",66,0)
CLEAN ; Cleanup and exit
"RTN","LRSRVR",67,0)
 I $D(^TMP($J,"LRDTERR")) D
"RTN","LRSRVR",68,0)
 . S XMDUN="Lab Server",XMDUZ=".5"
"RTN","LRSRVR",69,0)
 . S XMSUB=LRSTN_" LAB SERVER ERROR ("_LRNOW_")"
"RTN","LRSRVR",70,0)
 . S XMTEXT="^TMP($J,""LRDTERR"","
"RTN","LRSRVR",71,0)
 . S XMY("G.LABTEAM@ISC-DALLAS.VA.GOV")="",XMY(XQSND)=""
"RTN","LRSRVR",72,0)
 . D ^XMD
"RTN","LRSRVR",73,0)
 ;
"RTN","LRSRVR",74,0)
 ; Clean up server message in MailMan
"RTN","LRSRVR",75,0)
 I $G(LRXMZ)>0 D ZAPSERV^XMXAPI("S.LRLABSERVER",LRXMZ)
"RTN","LRSRVR",76,0)
 ;
"RTN","LRSRVR",77,0)
 K %,%DT,%H,D,DD,DIC,DIERR,ERROR,FILL,LINE,LOINCDTA,LOINCDTB,LOINCTAS
"RTN","LRSRVR",78,0)
 K LRA,LRAA,LRACTION,LRB,LRCLST,LRDA,LRERR,LRFOUND,LRFOUND1,LRI,LRLINE
"RTN","LRSRVR",79,0)
 K LRNDE,LROUT,LRPNT,LRPNTA,LRPNTB,LRRDT,LRRN,LRROOT,LRST,LRSTN,LRSUB
"RTN","LRSRVR",80,0)
 K X,XMDUN,XMDUZ,XMER,XMFROM,XMREC,XMRG,XMSUB,XMTEXT,XMY,XMZ,XQDATE
"RTN","LRSRVR",81,0)
 K XQSND,XQSUB,Y,ZTQUEUED,ZTSK
"RTN","LRSRVR",82,0)
 ;
"RTN","LRSRVR",83,0)
 K ^TMP($J,"LRDATA"),^TMP($J,"LRDTERR")
"RTN","LRSRVR",84,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LRSRVR",85,0)
 Q
"RTN","LRSRVR",86,0)
 ;
"RTN","LRSRVR",87,0)
 ;
"RTN","LRSRVR",88,0)
CSUM ;Calculate checksum for routines and transmit errors to LABTEAM group
"RTN","LRSRVR",89,0)
 S X=$T(+0) X ^%ZOSF("RSUM") S ^TMP($J,"LRDATA",2)=X_" at "_LRSTN_" = "_Y
"RTN","LRSRVR",90,0)
 S LRI=0
"RTN","LRSRVR",91,0)
 F  S LRI=$O(^LAB(69.91,1,"ROU",LRI)) Q:'LRI  D
"RTN","LRSRVR",92,0)
 . S X=$P(^LAB(69.91,1,"ROU",LRI,0),"^")
"RTN","LRSRVR",93,0)
 . S LRA=$P(^LAB(69.91,1,"ROU",LRI,0),"^",4)
"RTN","LRSRVR",94,0)
 . X ^%ZOSF("TEST") I '$T S ^TMP($J,"LRDATA",LRI+3)=X_" is missing." Q
"RTN","LRSRVR",95,0)
 . X ^%ZOSF("RSUM") I +$G(Y)'=LRA S ^TMP($J,"LRDATA",LRI+3)=X_" should be "_LRA_" is "_+$G(Y)
"RTN","LRSRVR",96,0)
 S XMSUB="Lab Checksum data at "_LRSTN_" run on "_XQDATE
"RTN","LRSRVR",97,0)
 D EXIT
"RTN","LRSRVR",98,0)
 Q
"RTN","LRSRVR",99,0)
 ;
"RTN","LRSRVR",100,0)
 ;
"RTN","LRSRVR",101,0)
SUMLST ;Calculate checksum for routines and transmit to requestor
"RTN","LRSRVR",102,0)
 K ^TMP($J,"LRDATA"),^TMP($J,"LRDTERR")
"RTN","LRSRVR",103,0)
 S LRCLST=$P($$SITE^VASITE,"^",2),LINE=2,LINR=1,$P(FILL," ",8)=""
"RTN","LRSRVR",104,0)
 S ^TMP($J,"LRDATA",1)="Lab Server triggered at "_LRCLST_" by "_XMFROM_" on "_XQDATE
"RTN","LRSRVR",105,0)
 ;
"RTN","LRSRVR",106,0)
 ; Check for a plus sign in front of the routine name.  Bypass the
"RTN","LRSRVR",107,0)
 ; Test to see if the routine exists if it's there.
"RTN","LRSRVR",108,0)
 ; DSM won't check %routines to make sure they exist, Cache will.
"RTN","LRSRVR",109,0)
 F  X XMREC Q:XMER<0  S X=XMRG D
"RTN","LRSRVR",110,0)
  . I X'?1"+".E X ^%ZOSF("TEST") I '$T S ^TMP($J,"LRDATA",LINE)=X_$E(FILL,$L(X),8)_" is missing.",LINE=LINE+1 Q
"RTN","LRSRVR",111,0)
  . ;Strip off the plus sign so that the checksum routine can find it.
"RTN","LRSRVR",112,0)
  . S X=$TR(X,"+","")
"RTN","LRSRVR",113,0)
  . X ^%ZOSF("RSUM") S ^TMP($J,"LRDATA",LINE)=X_$E(FILL,$L(X),8)_" is "_Y,LINE=LINE+1
"RTN","LRSRVR",114,0)
 S XMSUB="Checksum data at "_LRCLST_" run on "_XQDATE
"RTN","LRSRVR",115,0)
 S XMY(XQSND)=""
"RTN","LRSRVR",116,0)
 D EXIT
"RTN","LRSRVR",117,0)
 Q
"RTN","LRSRVR2")
0^6^B46042055^B60700026
"RTN","LRSRVR2",1,0)
LRSRVR2 ;DALIO/FHS - LAB DATA SERVER CONT'D RELMA EXTRACT ; Jan 9, 2006
"RTN","LRSRVR2",2,0)
 ;;5.2;LAB SERVICE;**303,346**;Sep 27, 1994;Build 10
"RTN","LRSRVR2",3,0)
 ; Produces LOINC RELMA extract - via LRLABSERVER or option
"RTN","LRSRVR2",4,0)
 ;
"RTN","LRSRVR2",5,0)
EN ; Called by option [LR LOINC EXTRACT RELMA FORMAT]
"RTN","LRSRVR2",6,0)
 ; Entry point for the option - user must capture output
"RTN","LRSRVR2",7,0)
 N DIR,DIRUT,LREND,LRCNT,LRSUB,LRVAL,LRST,LRSTN,LRTXT,X,Y
"RTN","LRSRVR2",8,0)
 S DIR(0)="Y",DIR("A")="Ready to Capture",DIR("B")="Yes"
"RTN","LRSRVR2",9,0)
 D ^DIR
"RTN","LRSRVR2",10,0)
 I $D(DIRUT) Q
"RTN","LRSRVR2",11,0)
 D WAIT^DICD
"RTN","LRSRVR2",12,0)
 S LRSUB="RELMA",LRTXT=1
"RTN","LRSRVR2",13,0)
 D BUILD
"RTN","LRSRVR2",14,0)
 W !
"RTN","LRSRVR2",15,0)
 S LRL=0
"RTN","LRSRVR2",16,0)
 F  S LRL=$O(^TMP($J,"LRDATA",LRL)) Q:LRL<1  W !,^(LRL)
"RTN","LRSRVR2",17,0)
 D CLEAN^LRSRVR2A
"RTN","LRSRVR2",18,0)
 Q
"RTN","LRSRVR2",19,0)
 ;
"RTN","LRSRVR2",20,0)
 ;
"RTN","LRSRVR2",21,0)
SERVER ; Server entry Point
"RTN","LRSRVR2",22,0)
 N I,LRCNT,LREND,LRL,LRMSUBJ,LRTXT,LRX,LRY
"RTN","LRSRVR2",23,0)
 S LRTXT=0
"RTN","LRSRVR2",24,0)
 D BUILD
"RTN","LRSRVR2",25,0)
 S LRMSUBJ=LRST_" "_LRSTN_" RELMA EXTRACT "_$$HTE^XLFDT($H,"1M")
"RTN","LRSRVR2",26,0)
 D MAILSEND^LRSRVR6(LRMSUBJ)
"RTN","LRSRVR2",27,0)
 D CLEAN^LRSRVR2A
"RTN","LRSRVR2",28,0)
 Q
"RTN","LRSRVR2",29,0)
 ;
"RTN","LRSRVR2",30,0)
 ;
"RTN","LRSRVR2",31,0)
BUILD ; Build extract
"RTN","LRSRVR2",32,0)
 N I,LR6206,LR64,LRCNT,LRCRLF,LRLEN,LRQUIT,LRROOT,LRSTNOTE,LRSS,LRSTR,LRSTUB,LRVAL
"RTN","LRSRVR2",33,0)
 S LRVAL=$$SITE^VASITE,LRST=$P(LRVAL,"^",3),LRSTN=$P(LRVAL,"^",2)
"RTN","LRSRVR2",34,0)
 I LRST="" S LRST="???"
"RTN","LRSRVR2",35,0)
 K ^TMP($J,"LRDATA"),^TMP($J,"LR60")
"RTN","LRSRVR2",36,0)
 S LRCNT=0,LRCRLF=$C(13,10),LRSTR=""
"RTN","LRSRVR2",37,0)
 F I=0,1,2,3 S LRCNT(I)=0
"RTN","LRSRVR2",38,0)
 D HDR^LRSRVR2A
"RTN","LRSRVR2",39,0)
 ;
"RTN","LRSRVR2",40,0)
 ; Step down the B X-ref - exclude synomyms
"RTN","LRSRVR2",41,0)
 S LRROOT="^LAB(60,""B"")"
"RTN","LRSRVR2",42,0)
 F  S LRROOT=$Q(@LRROOT) Q:LRROOT=""  Q:$QS(LRROOT,2)'="B"  D
"RTN","LRSRVR2",43,0)
 . Q:$G(@LRROOT)
"RTN","LRSRVR2",44,0)
 . D TEST
"RTN","LRSRVR2",45,0)
 ;
"RTN","LRSRVR2",46,0)
 ; Process microbiology antibiotics
"RTN","LRSRVR2",47,0)
 S LR6206=0,LRSS="MI"
"RTN","LRSRVR2",48,0)
 F  S LR6206=$O(^LAB(62.06,LR6206)) Q:'LR6206  D
"RTN","LRSRVR2",49,0)
 . S LR64=$$GET1^DIQ(62.06,LR6206_",",64,"I")
"RTN","LRSRVR2",50,0)
 . S LRX=$$MICRO^LRSRVR3(LR64)
"RTN","LRSRVR2",51,0)
 . S LRSTUB=$P(LRX,"|",5)_"||||"_$P(LRX,"|",3)_"|"_$P(LRX,"|",1)_"|||"_$P(LRX,"|",20)_"|"_$P(LRX,"|",19)_"|||||||||||"
"RTN","LRSRVR2",52,0)
 . I LR64 S LRSTUB=LRSTUB_$$GET1^DIQ(64,LR64_",",25)
"RTN","LRSRVR2",53,0)
 . S LRSTUB=LRSTUB_"|1.1|" ; Set extract version number
"RTN","LRSRVR2",54,0)
 . S LRSTR=LRSTR_LRST_"-"_LR64_"-"_"AB"_LR6206_"|"_LRSTUB
"RTN","LRSRVR2",55,0)
 . I 'LRTXT S LRSTR=LRSTR_LRCRLF
"RTN","LRSRVR2",56,0)
 . D SETDATA S LRCNT=LRCNT+1,LRCNT(3)=LRCNT(3)+1
"RTN","LRSRVR2",57,0)
 ;
"RTN","LRSRVR2",58,0)
 ; Set the final info into the ^TMP message global
"RTN","LRSRVR2",59,0)
 I 'LRTXT D
"RTN","LRSRVR2",60,0)
 . S LRNODE=$O(^TMP($J,"LRDATA",""),-1)
"RTN","LRSRVR2",61,0)
 . I LRSTR'="" S LRNODE=LRNODE+1,^TMP($J,"LRDATA",LRNODE)=$$UUEN^LRSRVR4(LRSTR)
"RTN","LRSRVR2",62,0)
 . S ^TMP($J,"LRDATA",LRNODE+1)=" "
"RTN","LRSRVR2",63,0)
 . S ^TMP($J,"LRDATA",LRNODE+2)="end"
"RTN","LRSRVR2",64,0)
 ;
"RTN","LRSRVR2",65,0)
 S ^TMP($J,"LRDATA",6)="Total number of records: "_$J(LRCNT,5)
"RTN","LRSRVR2",66,0)
 S ^TMP($J,"LRDATA",7)="Total number of tests..: "_$J(LRCNT(0),5)
"RTN","LRSRVR2",67,0)
 S ^TMP($J,"LRDATA",8)="Tests with LOINC code..: "_$J(LRCNT(1),5)
"RTN","LRSRVR2",68,0)
 S ^TMP($J,"LRDATA",9)="Tests with NLT code....: "_$J(LRCNT(2),5)
"RTN","LRSRVR2",69,0)
 S ^TMP($J,"LRDATA",10)="Antimicrobials.........: "_$J(LRCNT(3),5)
"RTN","LRSRVR2",70,0)
 ;
"RTN","LRSRVR2",71,0)
 Q
"RTN","LRSRVR2",72,0)
 ;
"RTN","LRSRVR2",73,0)
 ;
"RTN","LRSRVR2",74,0)
TEST ; Pull out test info
"RTN","LRSRVR2",75,0)
 N LA7TREE,LR60,LRBATTY,LRBATTYN,LRTSTTYP
"RTN","LRSRVR2",76,0)
 K LROUT,LRSPEC,ERR
"RTN","LRSRVR2",77,0)
 S LR60NM=$QS(LRROOT,3),LR60IEN=$QS(LRROOT,4)
"RTN","LRSRVR2",78,0)
 S LR60NM=$$TRIM^XLFSTR(LR60NM,"RL"," ")
"RTN","LRSRVR2",79,0)
 S LRTSTTYP=$P(^LAB(60,LR60IEN,0),"^",3)
"RTN","LRSRVR2",80,0)
 ;
"RTN","LRSRVR2",81,0)
 ; Bypass "neither" type tests.
"RTN","LRSRVR2",82,0)
 I LRTSTTYP="N" Q
"RTN","LRSRVR2",83,0)
 ; Bypass "workload" type tests.
"RTN","LRSRVR2",84,0)
 I $P(^LAB(60,LR60IEN,0),"^",4)="WK" Q
"RTN","LRSRVR2",85,0)
 ;
"RTN","LRSRVR2",86,0)
 S LRBATTY=LRST_"-"_LR60IEN,LRBATTYN=LR60NM
"RTN","LRSRVR2",87,0)
 S LRBATTY=$$TRIM^XLFSTR(LRBATTY,"RL"," ")
"RTN","LRSRVR2",88,0)
 ; Panel test
"RTN","LRSRVR2",89,0)
 ; Bypass "output panel" type tests - usually used for display only.
"RTN","LRSRVR2",90,0)
 I $O(^LAB(60,LR60IEN,2,0)) D  Q
"RTN","LRSRVR2",91,0)
 . I $P(^LAB(60,LR60IEN,0),"^",3)="O" Q
"RTN","LRSRVR2",92,0)
 . D UNWIND^LA7ADL1(LR60IEN,9,0)
"RTN","LRSRVR2",93,0)
 . S LR60=0
"RTN","LRSRVR2",94,0)
 . F  S LR60=$O(LA7TREE(LR60)) Q:'LR60  D
"RTN","LRSRVR2",95,0)
 . . I $D(^TMP($J,"LR60",LR60)) Q
"RTN","LRSRVR2",96,0)
 . . S LR60IEN=LR60,LR60NM=$P(^LAB(60,LR60IEN,0),"^")
"RTN","LRSRVR2",97,0)
 . . S LRTSTTYP=$P(^LAB(60,LR60IEN,0),"^",3)
"RTN","LRSRVR2",98,0)
 . . ; Bypass "neither" type tests.
"RTN","LRSRVR2",99,0)
 . . I LRTSTTYP="N" Q
"RTN","LRSRVR2",100,0)
 . . ; Bypass "workload" type tests.
"RTN","LRSRVR2",101,0)
 . . I $P(^LAB(60,LR60IEN,0),"^",4)="WK" Q
"RTN","LRSRVR2",102,0)
 . . S LRR64=+$P($G(^LAB(60,+LR60IEN,64)),U,2)
"RTN","LRSRVR2",103,0)
 . . D SPEC
"RTN","LRSRVR2",104,0)
 ;
"RTN","LRSRVR2",105,0)
 I $D(^TMP($J,"LR60",LR60IEN)) Q
"RTN","LRSRVR2",106,0)
 ; Not a panel test
"RTN","LRSRVR2",107,0)
 ; Get result NLT code
"RTN","LRSRVR2",108,0)
 S LRR64=+$P($G(^LAB(60,+LR60IEN,64)),U,2)
"RTN","LRSRVR2",109,0)
 D SPEC
"RTN","LRSRVR2",110,0)
 Q
"RTN","LRSRVR2",111,0)
 ;
"RTN","LRSRVR2",112,0)
 ;
"RTN","LRSRVR2",113,0)
SPEC ; Check each specimen for this test
"RTN","LRSRVR2",114,0)
 K LRSPEC,LROUT
"RTN","LRSRVR2",115,0)
 S (LRCDEF,LRSPEC,LRSPECN,LRLNC,LRLNCN,LRLNCX,LRLNC80,LRUNIT,Y)=""
"RTN","LRSRVR2",116,0)
 D SITENOTE^LRSRVR2A
"RTN","LRSRVR2",117,0)
 D SYNNOTE^LRSRVR2A
"RTN","LRSRVR2",118,0)
 S LRSPEC60=0
"RTN","LRSRVR2",119,0)
 F  S LRSPEC60=$O(^LAB(60,+LR60IEN,1,LRSPEC60)) Q:'LRSPEC60  D
"RTN","LRSRVR2",120,0)
 . Q:'($D(^LAB(60,+LR60IEN,1,LRSPEC60,0))#2)
"RTN","LRSRVR2",121,0)
 . S LRUNIT=$P(^LAB(60,+LR60IEN,1,LRSPEC60,0),U,7)
"RTN","LRSRVR2",122,0)
 . S X=$G(^LAB(61,LRSPEC60,0))
"RTN","LRSRVR2",123,0)
 . S LRSPECN=$P(X,"^"),LRSPECTA=$P(X,"^",10)
"RTN","LRSRVR2",124,0)
 . S LRSPEC(LRSPEC60_"-0")=LRSPEC60_U_LRSPECN_U_LRSPECTA_U_LRUNIT_U_LRR64
"RTN","LRSRVR2",125,0)
 . I LRR64,$P($$GET1^DIQ(64,LRR64_",",1,"E"),".",2)="0000" D SUFFIX^LRSRVR2A
"RTN","LRSRVR2",126,0)
 D SPECLOOP
"RTN","LRSRVR2",127,0)
 Q
"RTN","LRSRVR2",128,0)
 ;
"RTN","LRSRVR2",129,0)
 ;
"RTN","LRSRVR2",130,0)
SPECLOOP ; Check to see if specimen has been linked to LOINC
"RTN","LRSRVR2",131,0)
 ;
"RTN","LRSRVR2",132,0)
 N LR64,LR6421,LRINDX,LRLNTA,LRRNLT,LRTA,LRX,X
"RTN","LRSRVR2",133,0)
 S LRINDX=0
"RTN","LRSRVR2",134,0)
 F  S LRINDX=$O(LRSPEC(LRINDX)) Q:'LRINDX  D
"RTN","LRSRVR2",135,0)
 . S X=LRSPEC(LRINDX)
"RTN","LRSRVR2",136,0)
 . S LRSPEC=$P(X,U),LRSPECN=$P(X,U,2),LRLNTA=$P(X,U,3),LR64=$P(X,U,5),LRUNIT=$$TRIM^XLFSTR($P(X,U,4),"RL"," ")
"RTN","LRSRVR2",137,0)
 . S (LR6421,LRLNC,LRRNLT,LRTA)=""
"RTN","LRSRVR2",138,0)
 . I LR64 D
"RTN","LRSRVR2",139,0)
 . . S LRRNLT=$$GET1^DIQ(64,LR64_",",1,"E")
"RTN","LRSRVR2",140,0)
 . . S LR6421=$$GET1^DIQ(64,LR64_",",13,"I")
"RTN","LRSRVR2",141,0)
 . . S LRX=""
"RTN","LRSRVR2",142,0)
 . . I LRSPEC,LRLNTA S LRX=$P($G(^LAM(LR64,5,LRSPEC,1,LRLNTA,1)),"^")
"RTN","LRSRVR2",143,0)
 . . I LRX="",LRSPEC D
"RTN","LRSRVR2",144,0)
 . . . S X=$O(^LAM(LR64,5,LRSPEC,1,0))
"RTN","LRSRVR2",145,0)
 . . . I X S LRLNTA=X,LRX=$P($G(^LAM(LR64,5,LRSPEC,1,X,1)),"^")
"RTN","LRSRVR2",146,0)
 . . I LRX'="" S LRLNC=$$GET1^DIQ(95.3,LRX_",",.01,"E")
"RTN","LRSRVR2",147,0)
 . . I LRLNTA S LRTA=$$GET1^DIQ(64.061,LRLNTA_",",.01,"E")
"RTN","LRSRVR2",148,0)
 . D WRT
"RTN","LRSRVR2",149,0)
 Q
"RTN","LRSRVR2",150,0)
 ;
"RTN","LRSRVR2",151,0)
 ;
"RTN","LRSRVR2",152,0)
WRT ; Set ^TMP( with extracted data
"RTN","LRSRVR2",153,0)
 N LRJ,LREN,LRQUIT,LRSS,X,Y
"RTN","LRSRVR2",154,0)
 ;
"RTN","LRSRVR2",155,0)
 ; Set flag that this file #60 test has been processed - avoid duplicate
"RTN","LRSRVR2",156,0)
 ; processing as component of panel and individual test
"RTN","LRSRVR2",157,0)
 S ^TMP($J,"LR60",LR60IEN)=""
"RTN","LRSRVR2",158,0)
 ;
"RTN","LRSRVR2",159,0)
 S LRSTR=LRSTR_LRST_"-"_LR60IEN_"-"_LRINDX
"RTN","LRSRVR2",160,0)
 S LRSTR=LRSTR_"|"_LR60NM_"|"_LRSPECN_"|"_LRTA_"|"_LRUNIT_"|"_LRLNC_"|"_LRRNLT_"|"_LRBATTY_"|"_LRBATTYN_"|"
"RTN","LRSRVR2",161,0)
 ;
"RTN","LRSRVR2",162,0)
 ; Lab section specified for this NLT code.
"RTN","LRSRVR2",163,0)
 S LRSTR=LRSTR_$S($G(LR6421)>0:$$GET1^DIQ(64.21,LR6421_",",1),1:"")_"|"
"RTN","LRSRVR2",164,0)
 ;
"RTN","LRSRVR2",165,0)
 ; Subscript
"RTN","LRSRVR2",166,0)
 S LRSS=$$GET1^DIQ(60,LR60IEN_",",4,"I")
"RTN","LRSRVR2",167,0)
 S LRSTR=LRSTR_LRSS_"|"
"RTN","LRSRVR2",168,0)
 ; Test info - data type, help prompt
"RTN","LRSRVR2",169,0)
 I LRSS'="CH" S LRSTR=LRSTR_"||"
"RTN","LRSRVR2",170,0)
 I LRSS="CH" S X=$$TSTTYP^LRSRVR3($$GET1^DIQ(60,LR60IEN_",",13)) S LRSTR=LRSTR_$P(X,"|")_"|"_$P(X,"|",2)_"|"
"RTN","LRSRVR2",171,0)
 ;
"RTN","LRSRVR2",172,0)
 ; Test reference low|reference high|therapeutic low|therapeutic high|
"RTN","LRSRVR2",173,0)
 S X=$G(^LAB(60,LR60IEN,1,LRSPEC,0))
"RTN","LRSRVR2",174,0)
 S Y=$P(X,"^",2)_"|"_$P(X,"^",3)_"|"_$P(X,"^",11)_"|"_$P(X,"^",12)
"RTN","LRSRVR2",175,0)
 S LRSTR=LRSTR_$TR(Y,$C(34),"")
"RTN","LRSRVR2",176,0)
 ; Use for reference lab testing
"RTN","LRSRVR2",177,0)
 S X=$G(^LAB(60,LR60IEN,1,LRSPEC,.1))
"RTN","LRSRVR2",178,0)
 S LRSTR=LRSTR_"|"_$S($P(X,"^")=1:"YES",1:"NO")_"|"
"RTN","LRSRVR2",179,0)
 ; 
"RTN","LRSRVR2",180,0)
 ; Send site's test notes on first record for this test.
"RTN","LRSRVR2",181,0)
 I LRSTNOTE D
"RTN","LRSRVR2",182,0)
 . D SETDATA
"RTN","LRSRVR2",183,0)
 . S LRJ="LRSTNOTE"
"RTN","LRSRVR2",184,0)
 . F  S LRJ=$Q(@LRJ) Q:LRJ=""  D
"RTN","LRSRVR2",185,0)
 . . S X=@LRJ I X["|" S X=$TR(X,"|","~")
"RTN","LRSRVR2",186,0)
 . . S LRSTR=LRSTR_X D SETDATA
"RTN","LRSRVR2",187,0)
 . S LRSTNOTE=0
"RTN","LRSRVR2",188,0)
 S LRSTR=LRSTR_"|"
"RTN","LRSRVR2",189,0)
 ;
"RTN","LRSRVR2",190,0)
 ; Send site's test synonym's on first record for this test.
"RTN","LRSRVR2",191,0)
 I LRSTSYN D
"RTN","LRSRVR2",192,0)
 . D SETDATA
"RTN","LRSRVR2",193,0)
 . S LRJ="LRSTSYN"
"RTN","LRSRVR2",194,0)
 . F  S LRJ=$Q(@LRJ) Q:LRJ=""  S LRSTR=LRSTR_@LRJ_"^" D SETDATA
"RTN","LRSRVR2",195,0)
 . S LRSTSYN=0
"RTN","LRSRVR2",196,0)
 ;
"RTN","LRSRVR2",197,0)
 ; Send file #60 test type
"RTN","LRSRVR2",198,0)
 S LRSTR=LRSTR_"|"_LRTSTTYP_"|"
"RTN","LRSRVR2",199,0)
 ;
"RTN","LRSRVR2",200,0)
 ; Send default LOINC code
"RTN","LRSRVR2",201,0)
 I LR64 S LRSTR=LRSTR_$$GET1^DIQ(64,LR64_",",25)
"RTN","LRSRVR2",202,0)
 ;
"RTN","LRSRVR2",203,0)
 ; Set extract version number
"RTN","LRSRVR2",204,0)
 S LRSTR=LRSTR_"|1.1|"
"RTN","LRSRVR2",205,0)
 ;
"RTN","LRSRVR2",206,0)
 I 'LRTXT S LRSTR=LRSTR_LRCRLF
"RTN","LRSRVR2",207,0)
 D SETDATA
"RTN","LRSRVR2",208,0)
 ;
"RTN","LRSRVR2",209,0)
 S LRCNT=LRCNT+1,LRCNT(0)=LRCNT(0)+1
"RTN","LRSRVR2",210,0)
 I LRLNC'="" S LRCNT(1)=LRCNT(1)+1
"RTN","LRSRVR2",211,0)
 I LR64 S LRCNT(2)=LRCNT(2)+1
"RTN","LRSRVR2",212,0)
 Q
"RTN","LRSRVR2",213,0)
 ;
"RTN","LRSRVR2",214,0)
 ;
"RTN","LRSRVR2",215,0)
SETDATA ; Set data into report structure
"RTN","LRSRVR2",216,0)
 S LRNODE=$O(^TMP($J,"LRDATA",""),-1)
"RTN","LRSRVR2",217,0)
 I LRTXT S LRNODE=LRNODE+1,^TMP($J,"LRDATA",LRNODE)=LRSTR,LRSTR="" Q
"RTN","LRSRVR2",218,0)
 I 'LRTXT D ENCODE^LRSRVR4(.LRSTR)
"RTN","LRSRVR2",219,0)
 Q
"RTN","LRSRVR2A")
0^7^B11863535^n/a
"RTN","LRSRVR2A",1,0)
LRSRVR2A ;DALIO/FHS - LAB DATA SERVER CONT'D RELMA EXTRACT ; Aug 17, 2006
"RTN","LRSRVR2A",2,0)
 ;;5.2;LAB SERVICE;**346**;Sep 27, 1994;Build 10
"RTN","LRSRVR2A",3,0)
 ; Called by LRSRVR2
"RTN","LRSRVR2A",4,0)
 ;
"RTN","LRSRVR2A",5,0)
 ;
"RTN","LRSRVR2A",6,0)
CLEAN ;
"RTN","LRSRVR2A",7,0)
 K ^TMP($J,"LR60")
"RTN","LRSRVR2A",8,0)
 K ERR,LA7PCNT,LR60IEN,LR60NM,LR6421,LR64IEN
"RTN","LRSRVR2A",9,0)
 K LRACTION,LRCC,LRCCNX,LOINCDTA,LRRNLT,LRCDEF,LREND
"RTN","LRSRVR2A",10,0)
 K LRL,LRLNC,LRLNC80,LRLNCN,LRLNCX,LRNODE,LROUT,LROUT1,LRR64
"RTN","LRSRVR2A",11,0)
 K LRSPEC,LRSPEC60,LRSPECN,LRSPECTA,LRST,LRSTN,LRSTR,LRSTSYN
"RTN","LRSRVR2A",12,0)
 K LRTA,LRUNIT,LRX,LRY,X,Y
"RTN","LRSRVR2A",13,0)
 D CLEAN^LRSRVR
"RTN","LRSRVR2A",14,0)
 D ^%ZISC
"RTN","LRSRVR2A",15,0)
 Q
"RTN","LRSRVR2A",16,0)
 ;
"RTN","LRSRVR2A",17,0)
 ;
"RTN","LRSRVR2A",18,0)
HDR ; Set the header information
"RTN","LRSRVR2A",19,0)
 S ^TMP($J,"LRDATA",1)="Report Generated.......: "_$$FMTE^XLFDT($$NOW^XLFDT)_" at "_LRSTN
"RTN","LRSRVR2A",20,0)
 S ^TMP($J,"LRDATA",2)="Report requested.......: "_LRSUB
"RTN","LRSRVR2A",21,0)
 S ^TMP($J,"LRDATA",3)="LOINC version..........: "_$$GET1^DID(95.3,"","","PACKAGE REVISION DATA")
"RTN","LRSRVR2A",22,0)
 S ^TMP($J,"LRDATA",4)="VistA File version.....: "_$G(^LAB(95.3,"VR"))
"RTN","LRSRVR2A",23,0)
 S ^TMP($J,"LRDATA",5)="Extract version........: 1.1"
"RTN","LRSRVR2A",24,0)
 F I=6,12,13 S ^TMP($J,"LRDATA",I)=" "
"RTN","LRSRVR2A",25,0)
 S ^TMP($J,"LRDATA",14)="Legend:"
"RTN","LRSRVR2A",26,0)
 S X="Station #-60 ien-Spec ien-Index|Test Name|Spec|Time Aspect|Units|LOINC|NLT #|Battery Code|Battery Description|Lab Section|Subscript|Comment|Data Type|Reference low|Reference high|Therapeutic low|Therapeutic high|"
"RTN","LRSRVR2A",27,0)
 S ^TMP($J,"LRDATA",15)=X
"RTN","LRSRVR2A",28,0)
 ;S X="           1                   |    2    |  3 |     4     |  5  |  6  |  7  |    8       |     9             |     10    |   11    |   12  |    13   |     14      |     15       |      16       |       17       |"
"RTN","LRSRVR2A",29,0)
 ;S ^TMP($J,"LRDATA",16)=X
"RTN","LRSRVR2A",30,0)
 S X="Use Ref Lab|Site Comment|Test Synonyms|Test Type|Default LOINC|Extract Ver|"
"RTN","LRSRVR2A",31,0)
 S ^TMP($J,"LRDATA",16)=X
"RTN","LRSRVR2A",32,0)
 ;S X="      18   |     19     |       20    |    21   |      22     |    23     |"
"RTN","LRSRVR2A",33,0)
 ;S ^TMP($J,"LRDATA",18)=X
"RTN","LRSRVR2A",34,0)
 S ^TMP($J,"LRDATA",17)=$$REPEAT^XLFSTR("-",$L(X))
"RTN","LRSRVR2A",35,0)
 S ^TMP($J,"LRDATA",18)=" "
"RTN","LRSRVR2A",36,0)
 I 'LRTXT D
"RTN","LRSRVR2A",37,0)
 . S LRFILENM=$TR(LRSTN," ","_")_"-"_LRSUB_"-"_$P($$FMTHL7^XLFDT($$NOW^XLFDT),"-")_".TXT"
"RTN","LRSRVR2A",38,0)
 . S ^TMP($J,"LRDATA",12)="Attached LMOF file.....: "_LRFILENM
"RTN","LRSRVR2A",39,0)
 . S ^TMP($J,"LRDATA",19)=$$UUBEGFN(LRFILENM)
"RTN","LRSRVR2A",40,0)
 Q
"RTN","LRSRVR2A",41,0)
 ;
"RTN","LRSRVR2A",42,0)
 ;
"RTN","LRSRVR2A",43,0)
SITENOTE ; Build site's test notes for first record
"RTN","LRSRVR2A",44,0)
 ;
"RTN","LRSRVR2A",45,0)
 N LRI,LRSTNDT
"RTN","LRSRVR2A",46,0)
 K LRSTNOTE
"RTN","LRSRVR2A",47,0)
 S (LRSTNOTE,LRI)=0
"RTN","LRSRVR2A",48,0)
 F  S LRI=$O(^LAB(60,LR60IEN,11,LRI)) Q:'LRI  D
"RTN","LRSRVR2A",49,0)
 . S LRSTNDT=$P($G(^LAB(60,LR60IEN,11,LRI,0)),"^")
"RTN","LRSRVR2A",50,0)
 . M LRSTNOTE(LRI)=^LAB(60,LR60IEN,11,LRI,1)
"RTN","LRSRVR2A",51,0)
 . S LRSTNOTE(LRI,1,0)=$S(LRI>1:"^",1:"")_$$FMTE^XLFDT(LRSTNDT,"1M")_": "_$G(LRSTNOTE(LRI,1,0))
"RTN","LRSRVR2A",52,0)
 . K LRSTNOTE(LRI,0)
"RTN","LRSRVR2A",53,0)
 I $D(LRSTNOTE) S LRSTNOTE=1
"RTN","LRSRVR2A",54,0)
 Q
"RTN","LRSRVR2A",55,0)
 ;
"RTN","LRSRVR2A",56,0)
 ;
"RTN","LRSRVR2A",57,0)
SYNNOTE ; Build site's test synonym's for first record
"RTN","LRSRVR2A",58,0)
 ;
"RTN","LRSRVR2A",59,0)
 K LRSTSYN
"RTN","LRSRVR2A",60,0)
 S LRSTSYN=0
"RTN","LRSRVR2A",61,0)
 M LRSTSYN=^LAB(60,LR60IEN,5)
"RTN","LRSRVR2A",62,0)
 K LRSTSYN(0),LRSTSYN("B")
"RTN","LRSRVR2A",63,0)
 I $D(LRSTSYN) S LRSTSYN=1
"RTN","LRSRVR2A",64,0)
 Q
"RTN","LRSRVR2A",65,0)
 ;
"RTN","LRSRVR2A",66,0)
 ;
"RTN","LRSRVR2A",67,0)
SUFFIX ; If Result NLT does not have a suffix, i.e. it has .0000 then check for suffixed NLT codes which can also be used
"RTN","LRSRVR2A",68,0)
 N LR64,LRRNLT,LRROOT,LRX,LRY
"RTN","LRSRVR2A",69,0)
 S LRRNLT=$$GET1^DIQ(64,LRR64_",",1,"E")
"RTN","LRSRVR2A",70,0)
 S LRROOT="^LAM(""E"","_LRRNLT_")"
"RTN","LRSRVR2A",71,0)
 F  S LRROOT=$Q(@LRROOT) Q:LRROOT=""  Q:$P($QS(LRROOT,2),".")'=$P(LRRNLT,".")  D
"RTN","LRSRVR2A",72,0)
 . S LR64=$QS(LRROOT,3)
"RTN","LRSRVR2A",73,0)
 . I $G(^LAM(LR64,5,LRSPEC60,0)) S LRSPEC(LRSPEC60_"-"_LR64)=LRSPEC60_U_LRSPECN_U_LRSPECTA_U_LRUNIT_U_LR64
"RTN","LRSRVR2A",74,0)
 Q
"RTN","LRSRVR2A",75,0)
 ;
"RTN","LRSRVR2A",76,0)
 ;
"RTN","LRSRVR2A",77,0)
UUBEGFN(LRFILENM) ; Construct uuencode "begin" coding
"RTN","LRSRVR2A",78,0)
 ; Call with LRFILENM = name of uuencoded file attachment
"RTN","LRSRVR2A",79,0)
 ; 
"RTN","LRSRVR2A",80,0)
 ; Returns LRX = string with "begin..."_file name
"RTN","LRSRVR2A",81,0)
 ;
"RTN","LRSRVR2A",82,0)
 N LRX
"RTN","LRSRVR2A",83,0)
 S LRX="begin 644 "_LRFILENM
"RTN","LRSRVR2A",84,0)
 Q LRX
"RTN","LRSRVR3")
0^8^B41005024^B40554780
"RTN","LRSRVR3",1,0)
LRSRVR3 ;DALOI/JMC -LAB DATA SERVER, CONT'D - LOINC SECTION ;Aug 17,2006
"RTN","LRSRVR3",2,0)
 ;;5.2;LAB SERVICE;**303,346**;Sep 27, 1994;Build 10
"RTN","LRSRVR3",3,0)
 ;
"RTN","LRSRVR3",4,0)
 ;
"RTN","LRSRVR3",5,0)
LOINCLD ; Build and send local delimited LOINC report
"RTN","LRSRVR3",6,0)
 N I,LR6206,LR64,LINR,LRA,LRB,LRCNT,LRCRLF,LRMSUBJ,LRNODE,LRSTR,LRTXT,LRXREF,X,Y
"RTN","LRSRVR3",7,0)
 ;
"RTN","LRSRVR3",8,0)
 K ^TMP($J,"LRSERVER","LOINC"),^TMP($J,"LRDATA")
"RTN","LRSRVR3",9,0)
 S ^TMP($J,"LRDATA",1)="Report Generated.......: "_$$FMTE^XLFDT($$NOW^XLFDT)_" at "_LRSTN
"RTN","LRSRVR3",10,0)
 S ^TMP($J,"LRDATA",2)="Report requested.......: "_LRSUB
"RTN","LRSRVR3",11,0)
 S ^TMP($J,"LRDATA",3)="LOINC version..........: "_$$GET1^DID(95.3,"","","PACKAGE REVISION DATA")
"RTN","LRSRVR3",12,0)
 S ^TMP($J,"LRDATA",4)="File version...........: "_$G(^LAB(95.3,"VR"))
"RTN","LRSRVR3",13,0)
 S LRFILENM=$TR(LRSTN," ","_")_"-"_LRSUB_"-"_$P($$FMTHL7^XLFDT($$NOW^XLFDT),"-")_".TXT"
"RTN","LRSRVR3",14,0)
 S ^TMP($J,"LRDATA",5)="Attached file..........: "_LRFILENM
"RTN","LRSRVR3",15,0)
 S ^TMP($J,"LRDATA",7)=" "
"RTN","LRSRVR3",16,0)
 S ^TMP($J,"LRDATA",8)="Legend:"
"RTN","LRSRVR3",17,0)
 S X="Station #-64 ien-61 ien-Time Aspect|NLT Code|NLT Name|Default LOINC Code|Default LOINC Name|Default Test|Time Aspect|Specimen|Data Location|Data Type|Input Transform|Units|Test Name|LOINC Code|LOINC Name"
"RTN","LRSRVR3",18,0)
 S ^TMP($J,"LRDATA",9)=X
"RTN","LRSRVR3",19,0)
 S Y="|Reference Low|Reference High|Therapeutic Low|Therapeutic High|Subscript|Lab Section|"
"RTN","LRSRVR3",20,0)
 S ^TMP($J,"LRDATA",10)=Y
"RTN","LRSRVR3",21,0)
 S ^TMP($J,"LRDATA",11)="                 1                 |    2   |   3    |          4       |        5         |      6     |     7     |   8    |     9       |   10    |       11      |  12 |    13   |    14    |    15    "
"RTN","LRSRVR3",22,0)
 S ^TMP($J,"LRDATA",12)="|     16      |      17      |      18       |     19         |    20   |     21    |"
"RTN","LRSRVR3",23,0)
 S ^TMP($J,"LRDATA",13)=$$REPEAT^XLFSTR("-",$L(X))
"RTN","LRSRVR3",24,0)
 S ^TMP($J,"LRDATA",14)=$$REPEAT^XLFSTR("-",$L(Y))
"RTN","LRSRVR3",25,0)
 S ^TMP($J,"LRDATA",15)=" "
"RTN","LRSRVR3",26,0)
 S ^TMP($J,"LRDATA",16)=$$UUBEGFN^LRSRVR2A(LRFILENM)
"RTN","LRSRVR3",27,0)
 S LINR=1,LRCNT=0,LRSTR="",LRTXT=0,LRCRLF=$C(13,10)
"RTN","LRSRVR3",28,0)
 ;
"RTN","LRSRVR3",29,0)
 F LRXREF="AI","AH" D
"RTN","LRSRVR3",30,0)
 . S LRA=""
"RTN","LRSRVR3",31,0)
 . F  S LRA=$O(^LAM(LRXREF,LRA)) Q:'LRA  D
"RTN","LRSRVR3",32,0)
 . . S LRB=""
"RTN","LRSRVR3",33,0)
 . . F  S LRB=$O(^LAM(LRXREF,LRA,LRB)) Q:LRB=""  S ^TMP($J,"LRSERVER","LOINC",LRB)=""
"RTN","LRSRVR3",34,0)
 ;
"RTN","LRSRVR3",35,0)
 S LR64=""
"RTN","LRSRVR3",36,0)
 F  S LR64=$O(^TMP($J,"LRSERVER","LOINC",LR64)) Q:LR64=""  D LOINCLA
"RTN","LRSRVR3",37,0)
 ;
"RTN","LRSRVR3",38,0)
 S LR6206=0,LRSS="MI"
"RTN","LRSRVR3",39,0)
 F  S LR6206=$O(^LAB(62.06,LR6206)) Q:'LR6206  D
"RTN","LRSRVR3",40,0)
 . S LR64=$$GET1^DIQ(62.06,LR6206_",",64,"I")
"RTN","LRSRVR3",41,0)
 . S LRREC=$$MICRO(LR64)
"RTN","LRSRVR3",42,0)
 . S LRINDX=LRST_"-"_LR64_"-"_"AB"_LR6206
"RTN","LRSRVR3",43,0)
 . S LRSTR=LRSTR_LRINDX_"|"_LRREC_LRCRLF
"RTN","LRSRVR3",44,0)
 . D SETDATA^LRSRVR2
"RTN","LRSRVR3",45,0)
 . S LRCNT=LRCNT+1
"RTN","LRSRVR3",46,0)
 ;
"RTN","LRSRVR3",47,0)
 S ^TMP($J,"LRDATA",6)="Total number of records: "_LRCNT
"RTN","LRSRVR3",48,0)
 I '$O(^TMP($J,"LRDATA",15)) S ^TMP($J,"LRDATA",12)="No LOINC codes mapped at "_LRSTN
"RTN","LRSRVR3",49,0)
 ;
"RTN","LRSRVR3",50,0)
 ; Set the final info into the ^TMP( message global
"RTN","LRSRVR3",51,0)
 S LRNODE=$O(^TMP($J,"LRDATA",""),-1)+1
"RTN","LRSRVR3",52,0)
 I LRSTR'="" S ^TMP($J,"LRDATA",LRNODE)=$$UUEN^LRSRVR4(LRSTR)
"RTN","LRSRVR3",53,0)
 S ^TMP($J,"LRDATA",LRNODE+1)=" "
"RTN","LRSRVR3",54,0)
 S ^TMP($J,"LRDATA",LRNODE+2)="end"
"RTN","LRSRVR3",55,0)
 ;
"RTN","LRSRVR3",56,0)
 S LRMSUBJ=LRST_" "_LRSTN_" LOCAL REPORT DELIMIT "_$$HTE^XLFDT($H,"1M")
"RTN","LRSRVR3",57,0)
 D MAILSEND^LRSRVR6(LRMSUBJ)
"RTN","LRSRVR3",58,0)
 D CLEAN^LRSRVR
"RTN","LRSRVR3",59,0)
 Q
"RTN","LRSRVR3",60,0)
 ;
"RTN","LRSRVR3",61,0)
 ;
"RTN","LRSRVR3",62,0)
LOINCLA ;
"RTN","LRSRVR3",63,0)
 N LR60,LR61,LRAA,LRAA1,LRERR,LRINDX,LOINCDTA,LOINCDTB,LRPNTA,LRPNTB,LRREC,LRSS,LRX
"RTN","LRSRVR3",64,0)
 D GETS^DIQ(64,LR64,".01;1;13;25;25.5","IE","LOINCDTB","LRERR")
"RTN","LRSRVR3",65,0)
 D GETS^DIQ(64,LR64,"20*","IE","LOINCDTA","LRERR")
"RTN","LRSRVR3",66,0)
 S LRPNTB=$O(LOINCDTB(64,"")) Q:LRPNTB=""
"RTN","LRSRVR3",67,0)
 ;
"RTN","LRSRVR3",68,0)
 ; NLT Code/Procedure
"RTN","LRSRVR3",69,0)
 S LRSTUB=$G(LOINCDTB(64,LRPNTB,1,"E"))
"RTN","LRSRVR3",70,0)
 S $P(LRSTUB,"|",2)=$G(LOINCDTB(64,LRPNTB,.01,"I"))
"RTN","LRSRVR3",71,0)
 ;
"RTN","LRSRVR3",72,0)
 ; Default LOINC code/name
"RTN","LRSRVR3",73,0)
 S $P(LRSTUB,"|",3)=$G(LOINCDTB(64,LRPNTB,25,"E"))
"RTN","LRSRVR3",74,0)
 S $P(LRSTUB,"|",4)=$G(^LAB(95.3,+$G(LOINCDTB(64,LRPNTB,25,"I")),81))
"RTN","LRSRVR3",75,0)
 ;
"RTN","LRSRVR3",76,0)
 ; Default LOINC code test (64,25.5)
"RTN","LRSRVR3",77,0)
 S $P(LRSTUB,"|",5)=$G(LOINCDTB(64,LRPNTB,25.5,"I"))
"RTN","LRSRVR3",78,0)
 ;
"RTN","LRSRVR3",79,0)
 ; Look for 64.01 & 64.02 here
"RTN","LRSRVR3",80,0)
 S LRAA1=""
"RTN","LRSRVR3",81,0)
 F  S LRAA1=$O(LOINCDTA(64.01,LRAA1)) Q:LRAA1=""  D
"RTN","LRSRVR3",82,0)
 . I '$D(LOINCDTA(64.01,LRAA1,.01,"I")) D  Q
"RTN","LRSRVR3",83,0)
 . . S $P(LRSTUB,"|",6)="Specimen sub-field error in file 64 - "_LRAA1
"RTN","LRSRVR3",84,0)
 . . S $P(LRSTUB,"|",7)=$G(LRERR("DIERR",1,"TEXT",1))
"RTN","LRSRVR3",85,0)
 . . S LRSTR=LRSTR_LRCRLF
"RTN","LRSRVR3",86,0)
 . . D SETDATA^LRSRVR2
"RTN","LRSRVR3",87,0)
 . . S LRCNT=LRCNT+1
"RTN","LRSRVR3",88,0)
 . S LRPNTA=LOINCDTA(64.01,LRAA1,.01,"I")
"RTN","LRSRVR3",89,0)
 . S $P(LRSTUB,"|",6)=$$GET1^DIQ(61,LRPNTA_",",.0961) ; Time Aspect
"RTN","LRSRVR3",90,0)
 . S $P(LRSTUB,"|",7)=LOINCDTA(64.01,LRAA1,.01,"E") ; Specimen
"RTN","LRSRVR3",91,0)
 . S LRAA=""
"RTN","LRSRVR3",92,0)
 . F  S LRAA=$O(LOINCDTA(64.02,LRAA)) Q:LRAA=""  I LRAA[LRAA1 D
"RTN","LRSRVR3",93,0)
 . . S $P(LRSTUB,"|",8)=$G(LOINCDTA(64.02,LRAA,2,"E")) ; Data location
"RTN","LRSRVR3",94,0)
 . . S LR60=+LOINCDTA(64.02,LRAA,3,"I")
"RTN","LRSRVR3",95,0)
 . . S LR61=+LOINCDTA(64.01,$P(LRAA,",",2,4),.01,"I")
"RTN","LRSRVR3",96,0)
 . . S $P(LRSTUB,"|",9,10)=$$TSTTYP(LOINCDTA(64.02,LRAA,2,"I"))
"RTN","LRSRVR3",97,0)
 . . S LRSS=$$GET1^DIQ(60,LR60_",",4,"I") ; Subscript
"RTN","LRSRVR3",98,0)
 . . S LRX=$$GET1^DIQ(60.01,LR61_","_LR60_",",6) ; Units
"RTN","LRSRVR3",99,0)
 . . S $P(LRSTUB,"|",11)=$$TRIM^XLFSTR(LRX,"LR"," ")
"RTN","LRSRVR3",100,0)
 . . S $P(LRSTUB,"|",12)=LOINCDTA(64.02,LRAA,3,"E") ; Test name
"RTN","LRSRVR3",101,0)
 . . S $P(LRSTUB,"|",13)=$G(LOINCDTA(64.02,LRAA,4,"E")) ; Loinc code
"RTN","LRSRVR3",102,0)
 . . S $P(LRSTUB,"|",14)=$G(^LAB(95.3,+$G(LOINCDTA(64.02,LRAA,4,"E")),81)) ; LOINC code (64.02,4)
"RTN","LRSRVR3",103,0)
 . . S X=$G(^LAB(60,LR60,1,LR61,0))
"RTN","LRSRVR3",104,0)
 . . S $P(LRSTUB,"|",15)=$P(X,"^",2) ; Test reference low
"RTN","LRSRVR3",105,0)
 . . S $P(LRSTUB,"|",16)=$P(X,"^",3) ; Test reference high
"RTN","LRSRVR3",106,0)
 . . S $P(LRSTUB,"|",17)=$P(X,"^",11) ; Test therapeutic low
"RTN","LRSRVR3",107,0)
 . . S $P(LRSTUB,"|",18)=$P(X,"^",12) ; Test therapeutic high
"RTN","LRSRVR3",108,0)
 . . S $P(LRSTUB,"|",19)=LRSS ; Lab subscript
"RTN","LRSRVR3",109,0)
 . . S $P(LRSTUB,"|",20)=$G(LOINCDTB(64,LRPNTB,13,"E")) ; Lab section
"RTN","LRSRVR3",110,0)
 . . S LRINDX=LRST_"-"_LR64_"-"_LR61_"-"_LOINCDTA(64.02,LRAA,.01,"I")
"RTN","LRSRVR3",111,0)
 . . S LRSTR=LRSTR_LRINDX_"|"_LRSTUB_LRCRLF
"RTN","LRSRVR3",112,0)
 . . D SETDATA^LRSRVR2
"RTN","LRSRVR3",113,0)
 . . S LRCNT=LRCNT+1
"RTN","LRSRVR3",114,0)
 Q
"RTN","LRSRVR3",115,0)
 ;
"RTN","LRSRVR3",116,0)
 ;
"RTN","LRSRVR3",117,0)
MICRO(LR64) ;
"RTN","LRSRVR3",118,0)
 N LOINCDTB,LR6421,LRPNTB,LRSTUB
"RTN","LRSRVR3",119,0)
 S LRSTUB=""
"RTN","LRSRVR3",120,0)
 D GETS^DIQ(64,LR64,".01;1;13;25;25.5","IE","LOINCDTB","LRERR")
"RTN","LRSRVR3",121,0)
 D GETS^DIQ(64,LR64,"20*","IE","LOINCDTA","LRERR")
"RTN","LRSRVR3",122,0)
 S LRPNTB=$O(LOINCDTB(64,"")) Q:LRPNTB="" LRSTUB
"RTN","LRSRVR3",123,0)
 ;
"RTN","LRSRVR3",124,0)
 ; NLT Code/Procedure
"RTN","LRSRVR3",125,0)
 S LRSTUB=$G(LOINCDTB(64,LRPNTB,1,"E"))
"RTN","LRSRVR3",126,0)
 S $P(LRSTUB,"|",2)=$G(LOINCDTB(64,LRPNTB,.01,"I"))
"RTN","LRSRVR3",127,0)
 ;
"RTN","LRSRVR3",128,0)
 ; Default LOINC code/name
"RTN","LRSRVR3",129,0)
 S $P(LRSTUB,"|",3)=$G(LOINCDTB(64,LRPNTB,25,"E"))
"RTN","LRSRVR3",130,0)
 S $P(LRSTUB,"|",4)=$G(^LAB(95.3,+$G(LOINCDTB(64,LRPNTB,25,"I")),81))
"RTN","LRSRVR3",131,0)
 ;
"RTN","LRSRVR3",132,0)
 ; Anti-microbial Suscept (62.06,.01)
"RTN","LRSRVR3",133,0)
 S $P(LRSTUB,"|",5)=$$GET1^DIQ(62.06,LR6206_",",.01)
"RTN","LRSRVR3",134,0)
 ;
"RTN","LRSRVR3",135,0)
 ; Lab subscript/section
"RTN","LRSRVR3",136,0)
 S $P(LRSTUB,"|",19)=LRSS
"RTN","LRSRVR3",137,0)
 I $G(LOINCDTB(64,LRPNTB,13,"I")) D  ; Lab section
"RTN","LRSRVR3",138,0)
 . S LR6421=LOINCDTB(64,LRPNTB,13,"I")
"RTN","LRSRVR3",139,0)
 . S $P(LRSTUB,"|",20)=$$GET1^DIQ(64.21,LR6421_",",1)
"RTN","LRSRVR3",140,0)
 ;
"RTN","LRSRVR3",141,0)
 Q LRSTUB
"RTN","LRSRVR3",142,0)
 ;
"RTN","LRSRVR3",143,0)
 ;
"RTN","LRSRVR3",144,0)
TSTTYP(LRX) ; Determine test data type
"RTN","LRSRVR3",145,0)
 N LRSTUB,LRTYPE,LRY
"RTN","LRSRVR3",146,0)
 I LRX="" Q "|"
"RTN","LRSRVR3",147,0)
 S LRX=$P(LRX,"(",2)
"RTN","LRSRVR3",148,0)
 ;
"RTN","LRSRVR3",149,0)
 ; Data type
"RTN","LRSRVR3",150,0)
 S LRTYPE=$$GET1^DID($P(LRX,","),$P(LRX,",",2,99),"","TYPE")
"RTN","LRSRVR3",151,0)
 S $P(LRSTUB,"|",2)=LRTYPE
"RTN","LRSRVR3",152,0)
 ;
"RTN","LRSRVR3",153,0)
 ; Input transform
"RTN","LRSRVR3",154,0)
 S LRY=$$GET1^DID($P(LRX,","),$P(LRX,",",2,99),"",$S(LRTYPE="SET":"POINTER",1:"INPUT TRANSFORM"))
"RTN","LRSRVR3",155,0)
 I LRTYPE="NUMERIC",LRY["LRNUM" D
"RTN","LRSRVR3",156,0)
 . S LRX=$P(LRY,"""",2)
"RTN","LRSRVR3",157,0)
 . I LRX?.1"-".N1","1.N1","1N S LRY="Number from "_$P(LRX,",")_" to "_$P(LRX,",",2)_" with "_$P(LRX,",",3)_" decimal"
"RTN","LRSRVR3",158,0)
 S $P(LRSTUB,"|",1)=LRY
"RTN","LRSRVR3",159,0)
 ; Help prompt
"RTN","LRSRVR3",160,0)
 I LRTYPE="FREE TEXT" D
"RTN","LRSRVR3",161,0)
  . S LRY=$$GET1^DID($P(LRX,","),$P(LRX,",",2,99),"","HELP-PROMPT")
"RTN","LRSRVR3",162,0)
  . S $P(LRSTUB,"|",1)=LRY
"RTN","LRSRVR3",163,0)
 Q LRSTUB
"RTN","LRSRVR6")
0^4^B25592719^n/a
"RTN","LRSRVR6",1,0)
LRSRVR6 ;DALIO/JMC - LAB DATA SERVER CONT'D SNOMED EXTRACT ;Aug 17, 2006
"RTN","LRSRVR6",2,0)
 ;;5.2;LAB SERVICE;**346**;Sep 27, 1994;Build 10
"RTN","LRSRVR6",3,0)
 ; Produces SNOMED extract via LRLABSERVER option
"RTN","LRSRVR6",4,0)
 ;
"RTN","LRSRVR6",5,0)
 Q
"RTN","LRSRVR6",6,0)
 ;
"RTN","LRSRVR6",7,0)
 ;
"RTN","LRSRVR6",8,0)
SERVER ; Server entry Point
"RTN","LRSRVR6",9,0)
 N I,LRCNT,LREND,LRL,LRMSUBJ,LRST,LRSTN,LRTXT,LRX,LRY
"RTN","LRSRVR6",10,0)
 D BUILD
"RTN","LRSRVR6",11,0)
 S LRMSUBJ=LRST_" "_LRSTN_" SNOMED EXTRACT "_$$HTE^XLFDT($H,"1M")
"RTN","LRSRVR6",12,0)
 D MAILSEND(LRMSUBJ)
"RTN","LRSRVR6",13,0)
 D CLEAN
"RTN","LRSRVR6",14,0)
 Q
"RTN","LRSRVR6",15,0)
 ;
"RTN","LRSRVR6",16,0)
 ;
"RTN","LRSRVR6",17,0)
BUILD ; Build extract
"RTN","LRSRVR6",18,0)
 N J,LRCNT,LRCRLF,LRETIME,LRFN,LRLEX,LRNAME,LRQUIT,LRROOT,LRSCT,LRSCTEC,LRSCTVER,LRSCTX,LRSPEC,LRSTIME,LRSTR,LRVAL,LRVUID,LRX,LRY,X,Y
"RTN","LRSRVR6",19,0)
 ;
"RTN","LRSRVR6",20,0)
 S LRSTIME=$$NOW^XLFDT,LRVAL=$$SITE^VASITE,LRST=$P(LRVAL,"^",3),LRSTN=$P(LRVAL,"^",2),LRSCTVER=""
"RTN","LRSRVR6",21,0)
 I LRST="" S LRST="???"
"RTN","LRSRVR6",22,0)
 K ^TMP($J,"LRDATA")
"RTN","LRSRVR6",23,0)
 S (LRCNT,LRCNT("SCT"))=0,LRCRLF=$C(13,10),LRSTR=""
"RTN","LRSRVR6",24,0)
 F I=61,61.1,61.2,61.3,61.4,61.5,61.6,62 S LRCNT(I)=0,LRCNT(I,"SCT")=0
"RTN","LRSRVR6",25,0)
 D HDR
"RTN","LRSRVR6",26,0)
 ;
"RTN","LRSRVR6",27,0)
 ; Flag to indicate if SNOMED CT is available from LEXICON.
"RTN","LRSRVR6",28,0)
 S LRLEX=0
"RTN","LRSRVR6",29,0)
 I $T(CODE^LEXTRAN)'="" S LRLEX=1
"RTN","LRSRVR6",30,0)
 ;
"RTN","LRSRVR6",31,0)
 F LRFN=61,61.1,61.2,61.3,61.4,61.5,61.6,62  D
"RTN","LRSRVR6",32,0)
 . S LRROOT="^LAB("_LRFN_",""B"")"
"RTN","LRSRVR6",33,0)
 . D FILE
"RTN","LRSRVR6",34,0)
 ;
"RTN","LRSRVR6",35,0)
 S LRETIME=$$NOW^XLFDT
"RTN","LRSRVR6",36,0)
 ; Set the final info into the ^TMP message global
"RTN","LRSRVR6",37,0)
 S LRNODE=$O(^TMP($J,"LRDATA",""),-1)
"RTN","LRSRVR6",38,0)
 I LRSTR'="" S LRNODE=LRNODE+1,^TMP($J,"LRDATA",LRNODE)=$$UUEN^LRSRVR4(LRSTR)
"RTN","LRSRVR6",39,0)
 S ^TMP($J,"LRDATA",LRNODE+1)=" "
"RTN","LRSRVR6",40,0)
 S ^TMP($J,"LRDATA",LRNODE+2)="end"
"RTN","LRSRVR6",41,0)
 ;
"RTN","LRSRVR6",42,0)
 S ^TMP($J,"LRDATA",1)=^TMP($J,"LRDATA",1)_" (Run time:"_$$FMDIFF^XLFDT(LRETIME,LRSTIME,3)_")"
"RTN","LRSRVR6",43,0)
 S ^TMP($J,"LRDATA",3)="SNOMED CT version......: "_LRSCTVER
"RTN","LRSRVR6",44,0)
 S J=6
"RTN","LRSRVR6",45,0)
 S ^TMP($J,"LRDATA",J)="Number of records per file:"
"RTN","LRSRVR6",46,0)
 F I=61,61.1,61.2,61.3,61.4,61.5,61.6,62 D
"RTN","LRSRVR6",47,0)
 . S J=J+1
"RTN","LRSRVR6",48,0)
 . S ^TMP($J,"LRDATA",J)=" "_$$LJ^XLFSTR($$GET1^DID(I,"","","NAME")_" File (#"_I_")",32,".")_": "_$J(LRCNT(I),5)_"  ("_LRCNT(I,"SCT")_" mapped)"
"RTN","LRSRVR6",49,0)
 S ^TMP($J,"LRDATA",J+1)=$$LJ^XLFSTR("Total number of records",33,".")_": "_$J(LRCNT,5)_"  ("_LRCNT("SCT")_" mapped)"
"RTN","LRSRVR6",50,0)
 ;
"RTN","LRSRVR6",51,0)
 Q
"RTN","LRSRVR6",52,0)
 ;
"RTN","LRSRVR6",53,0)
 ;
"RTN","LRSRVR6",54,0)
CLEAN ;
"RTN","LRSRVR6",55,0)
 K ^TMP($J,"LR61")
"RTN","LRSRVR6",56,0)
 K LRIEN,LRLEN,LRNODE,LRSNM,LRSPECN
"RTN","LRSRVR6",57,0)
 D CLEAN^LRSRVR
"RTN","LRSRVR6",58,0)
 D ^%ZISC
"RTN","LRSRVR6",59,0)
 Q
"RTN","LRSRVR6",60,0)
 ;
"RTN","LRSRVR6",61,0)
 ;
"RTN","LRSRVR6",62,0)
FILE ; Search file entry and build record.
"RTN","LRSRVR6",63,0)
 ;
"RTN","LRSRVR6",64,0)
 F  S LRROOT=$Q(@LRROOT) Q:LRROOT=""  Q:$QS(LRROOT,2)'="B"  D
"RTN","LRSRVR6",65,0)
 . Q:$G(@LRROOT)
"RTN","LRSRVR6",66,0)
 . S LRIEN=$QS(LRROOT,4),LRSPEC=""
"RTN","LRSRVR6",67,0)
 . S LRNAME=$P($G(^LAB(LRFN,LRIEN,0)),"^"),LRNAME=$$TRIM^XLFSTR(LRNAME,"RL"," ")
"RTN","LRSRVR6",68,0)
 . S X=$P($G(^LAB(LRFN,LRIEN,0)),"^",2)
"RTN","LRSRVR6",69,0)
 . S LRSNM=$S(LRFN'=62:X,1:"")
"RTN","LRSRVR6",70,0)
 . I LRFN=62 S LRSPEC=X
"RTN","LRSRVR6",71,0)
 . I LRSNM'="",LRFN>60.9,LRFN<61.61 S LRX=((LRFN*10)#610)+1,LRSNM=$E("TMEFDPJ",LRX)_"-"_LRSNM
"RTN","LRSRVR6",72,0)
 . S LRSCT=$P($G(^LAB(LRFN,LRIEN,"SCT")),"^"),(LRSCTEC,LRSCTX,LRVUID)=""
"RTN","LRSRVR6",73,0)
 . I LRLEX,LRSCT'="" D
"RTN","LRSRVR6",74,0)
 . . K LRX
"RTN","LRSRVR6",75,0)
 . . S LRX=$$CODE^LEXTRAN(LRSCT,"SCT",DT,"LRX")
"RTN","LRSRVR6",76,0)
 . . S LRSCTX=$G(LRX("F")),LRSCTEC=$S(LRX<1:$P(LRX,"^",2),1:"")
"RTN","LRSRVR6",77,0)
 . . I LRSCTVER="",LRX>0 S LRSCTVER=$P($G(LRX(0)),"^",3)
"RTN","LRSRVR6",78,0)
 . S LRSTR=LRSTR_LRST_"-"_LRFN_"-"_LRIEN_"|"_LRNAME_"|"_LRSNM_"|"_LRVUID_"|"_LRSCT_"|"_LRSCTX_"|"_LRSCTEC_"|"
"RTN","LRSRVR6",79,0)
 . S LRSPECN="|"
"RTN","LRSRVR6",80,0)
 . I LRFN=62,LRSPEC D
"RTN","LRSRVR6",81,0)
 . . S LRSPECN=$P($G(^LAB(61,LRSPEC,0)),"^")
"RTN","LRSRVR6",82,0)
 . . S LRSPECN=LRSPECN_"|"_LRST_"-61-"_LRSPEC
"RTN","LRSRVR6",83,0)
 . S LRSTR=LRSTR_LRSPECN_"|1.1|"
"RTN","LRSRVR6",84,0)
 . S LRCNT=LRCNT+1,LRCNT(LRFN)=LRCNT(LRFN)+1 S:LRSCT LRCNT("SCT")=LRCNT("SCT")+1,LRCNT(LRFN,"SCT")=LRCNT(LRFN,"SCT")+1
"RTN","LRSRVR6",85,0)
 . D SETDATA
"RTN","LRSRVR6",86,0)
 Q
"RTN","LRSRVR6",87,0)
 ;
"RTN","LRSRVR6",88,0)
 ;
"RTN","LRSRVR6",89,0)
SETDATA ; Set data into report structure
"RTN","LRSRVR6",90,0)
 S LRSTR=LRSTR_LRCRLF
"RTN","LRSRVR6",91,0)
 S LRNODE=$O(^TMP($J,"LRDATA",""),-1)
"RTN","LRSRVR6",92,0)
 D ENCODE^LRSRVR4(.LRSTR)
"RTN","LRSRVR6",93,0)
 Q
"RTN","LRSRVR6",94,0)
 ;
"RTN","LRSRVR6",95,0)
 ;
"RTN","LRSRVR6",96,0)
HDR ; Set the header information
"RTN","LRSRVR6",97,0)
 N LRFILENM
"RTN","LRSRVR6",98,0)
 S LRFILENM=$TR(LRSTN," ","_")_"-"_LRSUB_"-"_$P($$FMTHL7^XLFDT(LRSTIME),"-")_".TXT"
"RTN","LRSRVR6",99,0)
 S ^TMP($J,"LRDATA",1)="Report Generated.......: "_$$FMTE^XLFDT(LRSTIME)_" at "_LRSTN
"RTN","LRSRVR6",100,0)
 S ^TMP($J,"LRDATA",2)="Report requested.......: "_LRSUB
"RTN","LRSRVR6",101,0)
 S ^TMP($J,"LRDATA",3)="SNOMED CT version......: "
"RTN","LRSRVR6",102,0)
 S ^TMP($J,"LRDATA",4)="Extract version........: 1.1"
"RTN","LRSRVR6",103,0)
 F I=5,15,16,18,23 S ^TMP($J,"LRDATA",I)=" "
"RTN","LRSRVR6",104,0)
 S ^TMP($J,"LRDATA",17)="Attached file..........: "_LRFILENM
"RTN","LRSRVR6",105,0)
 S ^TMP($J,"LRDATA",19)="Legend:"
"RTN","LRSRVR6",106,0)
 S X="Station #-File #-IEN|Entry Name|SNOMED I|VUID|SNOMED CT|SNOMED CT TERM|Mapping Exception|Related Specimen|Related Specimen ID|Extract Ver|"
"RTN","LRSRVR6",107,0)
 S ^TMP($J,"LRDATA",20)=X
"RTN","LRSRVR6",108,0)
 S X="           1        |     2    |   3    |  4 |    5    |       6      |        7        |        8       |        9          |    10     |"
"RTN","LRSRVR6",109,0)
 S ^TMP($J,"LRDATA",21)=X
"RTN","LRSRVR6",110,0)
 S ^TMP($J,"LRDATA",22)=$$REPEAT^XLFSTR("-",$L(X))
"RTN","LRSRVR6",111,0)
 S ^TMP($J,"LRDATA",24)=$$UUBEGFN^LRSRVR2A(LRFILENM)
"RTN","LRSRVR6",112,0)
 Q
"RTN","LRSRVR6",113,0)
 ;
"RTN","LRSRVR6",114,0)
 ;
"RTN","LRSRVR6",115,0)
MAILSEND(LRMSUBJ) ; Send extract back to requestor.
"RTN","LRSRVR6",116,0)
 ;
"RTN","LRSRVR6",117,0)
 N LRINSTR,LRTASK,LRTO,XMERR,XMZ
"RTN","LRSRVR6",118,0)
 S LRTO(XQSND)=""
"RTN","LRSRVR6",119,0)
 S LRINSTR("ADDR FLAGS")="R"
"RTN","LRSRVR6",120,0)
 S LRINSTR("FROM")="LAB_PACKAGE"
"RTN","LRSRVR6",121,0)
 D SENDMSG^XMXAPI(.5,LRMSUBJ,"^TMP($J,""LRDATA"")",.LRTO,.LRINSTR,.LRTASK)
"RTN","LRSRVR6",122,0)
 Q
"RTN","LRSRVR7")
0^5^B23564160^n/a
"RTN","LRSRVR7",1,0)
LRSRVR7 ;DALIO/JMC - LAB DATA SERVER CONT'D CPT EXTRACT ;Aug 17, 2006
"RTN","LRSRVR7",2,0)
 ;;5.2;LAB SERVICE;**346**;Sep 27, 1994;Build 10
"RTN","LRSRVR7",3,0)
 ; Produces NLT/CPT extract via LRLABSERVER option
"RTN","LRSRVR7",4,0)
 ;
"RTN","LRSRVR7",5,0)
 Q
"RTN","LRSRVR7",6,0)
 ;
"RTN","LRSRVR7",7,0)
 ;
"RTN","LRSRVR7",8,0)
SERVER ; Server entry Point
"RTN","LRSRVR7",9,0)
 N I,LRCNT,LREND,LRL,LRMSUBJ,LRST,LRSTN,LRTXT,LRX,LRY
"RTN","LRSRVR7",10,0)
 D BUILD
"RTN","LRSRVR7",11,0)
 S LRMSUBJ=LRST_" "_LRSTN_" NLT/CPT EXTRACT "_$$HTE^XLFDT($H,"1M")
"RTN","LRSRVR7",12,0)
 D MAILSEND^LRSRVR6(LRMSUBJ)
"RTN","LRSRVR7",13,0)
 D CLEAN
"RTN","LRSRVR7",14,0)
 Q
"RTN","LRSRVR7",15,0)
 ;
"RTN","LRSRVR7",16,0)
 ;
"RTN","LRSRVR7",17,0)
BUILD ; Build extract
"RTN","LRSRVR7",18,0)
 N LRCNT,LRCRLF,LRFN,LRNAME,LRQUIT,LRROOT,LRSCT,LRSTR,LRVAL,LRVUID,X,Y
"RTN","LRSRVR7",19,0)
 ;
"RTN","LRSRVR7",20,0)
 S LRVAL=$$SITE^VASITE,LRST=$P(LRVAL,"^",3),LRSTN=$P(LRVAL,"^",2)
"RTN","LRSRVR7",21,0)
 I LRST="" S LRST="???"
"RTN","LRSRVR7",22,0)
 K ^TMP($J,"LRDATA")
"RTN","LRSRVR7",23,0)
 S (LRCNT,LRCNT(1),LRCNT(2))=0,LRCRLF=$C(13,10),LRSTR=""
"RTN","LRSRVR7",24,0)
 D HDR,FILE
"RTN","LRSRVR7",25,0)
 ;
"RTN","LRSRVR7",26,0)
 ;
"RTN","LRSRVR7",27,0)
 ; Set the final info into the ^TMP message global
"RTN","LRSRVR7",28,0)
 S LRNODE=$O(^TMP($J,"LRDATA",""),-1)+1
"RTN","LRSRVR7",29,0)
 I LRSTR'="" S ^TMP($J,"LRDATA",LRNODE)=$$UUEN^LRSRVR4(LRSTR)
"RTN","LRSRVR7",30,0)
 S ^TMP($J,"LRDATA",LRNODE+1)=" "
"RTN","LRSRVR7",31,0)
 S ^TMP($J,"LRDATA",LRNODE+2)="end"
"RTN","LRSRVR7",32,0)
 ;
"RTN","LRSRVR7",33,0)
 S J=4
"RTN","LRSRVR7",34,0)
 S ^TMP($J,"LRDATA",J)="Number of records per file:"
"RTN","LRSRVR7",35,0)
 S ^TMP($J,"LRDATA",J+1)=$$LJ^XLFSTR("Total number of records",33,".")_": "_$J(LRCNT,5)
"RTN","LRSRVR7",36,0)
 S ^TMP($J,"LRDATA",J+2)=$$LJ^XLFSTR("CPT/LOINC records",33,".")_": "_$J(LRCNT(1),5)
"RTN","LRSRVR7",37,0)
 S ^TMP($J,"LRDATA",J+3)=$$LJ^XLFSTR("CPT/Default LOINC records",33,".")_": "_$J(LRCNT(2),5)
"RTN","LRSRVR7",38,0)
 ;
"RTN","LRSRVR7",39,0)
 Q
"RTN","LRSRVR7",40,0)
 ;
"RTN","LRSRVR7",41,0)
 ;
"RTN","LRSRVR7",42,0)
CLEAN ;
"RTN","LRSRVR7",43,0)
 K ^TMP($J,"LR61")
"RTN","LRSRVR7",44,0)
 K J,LA7PCNT,LR64CODE,LR64NM,LRFILENM,LRLEN,LRLN,LRLNC,LRNODE,LRSTSYN
"RTN","LRSRVR7",45,0)
 D CLEAN^LRSRVR
"RTN","LRSRVR7",46,0)
 D ^%ZISC
"RTN","LRSRVR7",47,0)
 Q
"RTN","LRSRVR7",48,0)
 ;
"RTN","LRSRVR7",49,0)
 ;
"RTN","LRSRVR7",50,0)
FILE ;
"RTN","LRSRVR7",51,0)
 ;
"RTN","LRSRVR7",52,0)
 N LR64,LR64018,LR81,LRCPT,LRCPTNM,LRI,LRXX,LRYY,LRZ
"RTN","LRSRVR7",53,0)
 S LRROOT="^LAM(""AD"")",(LR64,LR64018)=0
"RTN","LRSRVR7",54,0)
 F  S LRROOT=$Q(@LRROOT) Q:LRROOT=""  Q:$QS(LRROOT,1)'="AD"  D
"RTN","LRSRVR7",55,0)
 . I $QS(LRROOT,3)'="CPT" Q
"RTN","LRSRVR7",56,0)
 . I LR64'=$QS(LRROOT,2) D
"RTN","LRSRVR7",57,0)
 . . S LR64=$QS(LRROOT,2)
"RTN","LRSRVR7",58,0)
 . . S X=$G(^LAM(LR64,0))
"RTN","LRSRVR7",59,0)
 . . S LR64NM=$P(X,"^"),LR64CODE=$P(X,"^",2)
"RTN","LRSRVR7",60,0)
 . . D LOINC
"RTN","LRSRVR7",61,0)
 . . S LRCNT=LRCNT+1
"RTN","LRSRVR7",62,0)
 . S LR64018=$QS(LRROOT,4)
"RTN","LRSRVR7",63,0)
 . S LR81=+$P($G(^LAM(LR64,4,LR64018,0)),"^")
"RTN","LRSRVR7",64,0)
 . S X=$$CPT^ICPTCOD(LR81,DT,1)
"RTN","LRSRVR7",65,0)
 . S LRCPT=$S($P(X,"^")>0:$P(X,"^",2),1:"IEN "_LR81)
"RTN","LRSRVR7",66,0)
 . S LRCPTNM=$S($P(X,"^")>0:$P(X,"^",3),1:$P(X,"^",2))
"RTN","LRSRVR7",67,0)
 . ;  File "default" mapping
"RTN","LRSRVR7",68,0)
 . S LRSTR=LRSTR_LRST_"-"_LR64_"-"_LR64018_"|"_LR64CODE_"|"_LR64NM_"|"_LRCPT_"|"_LRCPTNM_"|"_LRLN
"RTN","LRSRVR7",69,0)
 . D SETDATA
"RTN","LRSRVR7",70,0)
 . ; File specific specimen/time aspect LOINC mappings
"RTN","LRSRVR7",71,0)
 . S LRXX=LRST_"-"_LR64_"-"_LR64018_"-"
"RTN","LRSRVR7",72,0)
 . S LRYY="|"_LR64CODE_"|"_LR64NM_"|"_LRCPT_"|"_LRCPTNM_"|"
"RTN","LRSRVR7",73,0)
 . S LRI=""
"RTN","LRSRVR7",74,0)
 . F  S LRI=$O(LRLN(LRI)) Q:LRI=""  D
"RTN","LRSRVR7",75,0)
 . . S LRSTR=LRSTR_LRXX_LRI_LRYY_LRLN(LRI)
"RTN","LRSRVR7",76,0)
 . . D SETDATA
"RTN","LRSRVR7",77,0)
 Q
"RTN","LRSRVR7",78,0)
 ;
"RTN","LRSRVR7",79,0)
 ;
"RTN","LRSRVR7",80,0)
SETDATA ; Set data into report structure
"RTN","LRSRVR7",81,0)
 S LRSTR=LRSTR_LRCRLF
"RTN","LRSRVR7",82,0)
 S LRNODE=$O(^TMP($J,"LRDATA",""),-1)
"RTN","LRSRVR7",83,0)
 D ENCODE^LRSRVR4(.LRSTR)
"RTN","LRSRVR7",84,0)
 Q
"RTN","LRSRVR7",85,0)
 ;
"RTN","LRSRVR7",86,0)
 ;
"RTN","LRSRVR7",87,0)
HDR ; Set the header information
"RTN","LRSRVR7",88,0)
 S LRFILENM=$TR(LRSTN," ","_")_"-"_LRSUB_"-"_$P($$FMTHL7^XLFDT($$NOW^XLFDT),"-")_".TXT"
"RTN","LRSRVR7",89,0)
 S ^TMP($J,"LRDATA",1)="Report generated.......: "_$$FMTE^XLFDT($$NOW^XLFDT)_" at "_LRSTN
"RTN","LRSRVR7",90,0)
 S ^TMP($J,"LRDATA",2)="Report requested.......: "_LRSUB
"RTN","LRSRVR7",91,0)
 F I=3,8,10,15 S ^TMP($J,"LRDATA",I)=" "
"RTN","LRSRVR7",92,0)
 S ^TMP($J,"LRDATA",9)="Attached file..........: "_LRFILENM
"RTN","LRSRVR7",93,0)
 S ^TMP($J,"LRDATA",11)="Legend:"
"RTN","LRSRVR7",94,0)
 S X="Station #-NLT IEN-CPT IEN-Spec-Time Aspect|NLT Code|NLT Name|CPT Code|CPT Name|Specimen|Time Aspect|LOINC Code|LOINC Short Name|"
"RTN","LRSRVR7",95,0)
 S ^TMP($J,"LRDATA",12)=X
"RTN","LRSRVR7",96,0)
 S X="                    1                     |    2   |   3    |    4   |    5   |    6   |     7     |     8     |        9      |"
"RTN","LRSRVR7",97,0)
 S ^TMP($J,"LRDATA",13)=X
"RTN","LRSRVR7",98,0)
 S ^TMP($J,"LRDATA",14)=$$REPEAT^XLFSTR("-",$L(X))
"RTN","LRSRVR7",99,0)
 S ^TMP($J,"LRDATA",16)=$$UUBEGFN^LRSRVR2A(LRFILENM)
"RTN","LRSRVR7",100,0)
 Q
"RTN","LRSRVR7",101,0)
 ;
"RTN","LRSRVR7",102,0)
 ;
"RTN","LRSRVR7",103,0)
LOINC ; Retreive any LOINC codes for the NLT code
"RTN","LRSRVR7",104,0)
 N LR61,LRJ,LRK,LRSPECN,LRTA,LRX
"RTN","LRSRVR7",105,0)
 K LRLN
"RTN","LRSRVR7",106,0)
 ; Default LOINC
"RTN","LRSRVR7",107,0)
 S LRX=$G(^LAM(LR64,9))
"RTN","LRSRVR7",108,0)
 S LRLN="||||"
"RTN","LRSRVR7",109,0)
 I $P(LRX,"^") D
"RTN","LRSRVR7",110,0)
 . S $P(LRLN,"|",3)=$$GET1^DIQ(95.3,$P(LRX,"^")_",",.01)
"RTN","LRSRVR7",111,0)
 . S $P(LRLN,"|",4)=$$GET1^DIQ(95.3,$P(LRX,"^")_",",81)
"RTN","LRSRVR7",112,0)
 . S LRCNT(2)=LRCNT(2)+1
"RTN","LRSRVR7",113,0)
 I $P(LRX,"^",2) S $P(LRLN,"|",2)=$P($G(^LAB(64.061,$P(LRX,"^",2),0)),"^")
"RTN","LRSRVR7",114,0)
 ;
"RTN","LRSRVR7",115,0)
 ; Specimen specific LOINC
"RTN","LRSRVR7",116,0)
 S LRJ=0
"RTN","LRSRVR7",117,0)
 F  S LRJ=$O(^LAM(LR64,5,LRJ)) Q:'LRJ  D
"RTN","LRSRVR7",118,0)
 . S LR61=+$P($G(^LAM(LR64,5,LRJ,0)),"^")
"RTN","LRSRVR7",119,0)
 . S LRSPECN=$P($G(^LAB(61,LR61,0)),"^")
"RTN","LRSRVR7",120,0)
 . S LRK=0
"RTN","LRSRVR7",121,0)
 . F  S LRK=$O(^LAM(LR64,5,LRJ,1,LRK)) Q:'LRK  D
"RTN","LRSRVR7",122,0)
 . . S LRTA=$P($G(^LAM(LR64,5,LRJ,1,LRK,0)),"^")
"RTN","LRSRVR7",123,0)
 . . S LRLNC=$P($G(^LAM(LR64,5,LRJ,1,LRK,1)),"^")
"RTN","LRSRVR7",124,0)
 . . S LRLN(LRJ_"-"_LRK)=LRSPECN_"|"_$P($G(^LAB(64.061,LRTA,0)),"^")_"|"_$$GET1^DIQ(95.3,LRLNC_",",.01)_"|"_$$GET1^DIQ(95.3,LRLNC_",",81)_"|"
"RTN","LRSRVR7",125,0)
 . . S LRCNT(1)=LRCNT(1)+1
"RTN","LRSRVR7",126,0)
 ;
"RTN","LRSRVR7",127,0)
 Q
"VER")
8.0^22.0
"BLD",6310,6)
^279
**END**
**END**
