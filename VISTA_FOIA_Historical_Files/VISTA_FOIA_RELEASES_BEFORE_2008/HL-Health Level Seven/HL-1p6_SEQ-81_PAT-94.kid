Released HL*1.6*94 SEQ #81
Extracted from mail message
**KIDS**:HL*1.6*94^

**INSTALL NAME**
HL*1.6*94
"BLD",579,0)
HL*1.6*94^HEALTH LEVEL SEVEN^0^3020716^y
"BLD",579,1,0)
^9.61A^2^2^3020710^^
"BLD",579,1,1,0)
See the full patch description for HL*1.6*94 on the national Forum patch
"BLD",579,1,2,0)
module system. 
"BLD",579,4,0)
^9.64PA^^
"BLD",579,"ABPKG")
n
"BLD",579,"KRN",0)
^9.67PA^8989.52^20
"BLD",579,"KRN",.4,0)
.4
"BLD",579,"KRN",.401,0)
.401
"BLD",579,"KRN",.402,0)
.402
"BLD",579,"KRN",.403,0)
.403
"BLD",579,"KRN",.5,0)
.5
"BLD",579,"KRN",.84,0)
.84
"BLD",579,"KRN",3.6,0)
3.6
"BLD",579,"KRN",3.8,0)
3.8
"BLD",579,"KRN",9.2,0)
9.2
"BLD",579,"KRN",9.8,0)
9.8
"BLD",579,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",579,"KRN",9.8,"NM",1,0)
HLMA2^^0^B32579157
"BLD",579,"KRN",9.8,"NM","B","HLMA2",1)

"BLD",579,"KRN",19,0)
19
"BLD",579,"KRN",19.1,0)
19.1
"BLD",579,"KRN",101,0)
101
"BLD",579,"KRN",409.61,0)
409.61
"BLD",579,"KRN",771,0)
771
"BLD",579,"KRN",870,0)
870
"BLD",579,"KRN",8989.51,0)
8989.51
"BLD",579,"KRN",8989.52,0)
8989.52
"BLD",579,"KRN",8994,0)
8994
"BLD",579,"KRN",8994.2,0)
8994.2
"BLD",579,"KRN","B",.4,.4)

"BLD",579,"KRN","B",.401,.401)

"BLD",579,"KRN","B",.402,.402)

"BLD",579,"KRN","B",.403,.403)

"BLD",579,"KRN","B",.5,.5)

"BLD",579,"KRN","B",.84,.84)

"BLD",579,"KRN","B",3.6,3.6)

"BLD",579,"KRN","B",3.8,3.8)

"BLD",579,"KRN","B",9.2,9.2)

"BLD",579,"KRN","B",9.8,9.8)

"BLD",579,"KRN","B",19,19)

"BLD",579,"KRN","B",19.1,19.1)

"BLD",579,"KRN","B",101,101)

"BLD",579,"KRN","B",409.61,409.61)

"BLD",579,"KRN","B",771,771)

"BLD",579,"KRN","B",870,870)

"BLD",579,"KRN","B",8989.51,8989.51)

"BLD",579,"KRN","B",8989.52,8989.52)

"BLD",579,"KRN","B",8994,8994)

"BLD",579,"KRN","B",8994.2,8994.2)

"BLD",579,"QUES",0)
^9.62^^
"BLD",579,"REQB",0)
^9.611^1^1
"BLD",579,"REQB",1,0)
HL*1.6*91^0
"BLD",579,"REQB","B","HL*1.6*91",1)

"MBREQ")
0
"PKG",9,-1)
1^1
"PKG",9,0)
HEALTH LEVEL SEVEN^HL^DHCP IMPLEMENTATION OF HEALTH LEVEL SEVEN^
"PKG",9,20,0)
^9.402P^^
"PKG",9,22,0)
^9.49I^1^1
"PKG",9,22,1,0)
1.6^2980130^2980130^6
"PKG",9,22,1,"PAH",1,0)
94^3020716^73
"PKG",9,22,1,"PAH",1,1,0)
^^2^2^3020716
"PKG",9,22,1,"PAH",1,1,1,0)
See the full patch description for HL*1.6*94 on the national Forum patch
"PKG",9,22,1,"PAH",1,1,2,0)
module system. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","HLMA2")
0^1^B32579157
"RTN","HLMA2",1,0)
HLMA2 ;AISC/SAW-Message Administration Module ;09/20/2001  12:35
"RTN","HLMA2",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**19,43,57,58,64,65,76,82,91,94**;Oct 13, 1995
"RTN","HLMA2",3,0)
 ; References to ^ORD(101) supported by IA# 1373.
"RTN","HLMA2",4,0)
 ;
"RTN","HLMA2",5,0)
SEND(EIDS,MTIEN,CLIENT,PRIORITY,MTIENS,LOGLINK) ;
"RTN","HLMA2",6,0)
 ;Entry point to create
"RTN","HLMA2",7,0)
 ;an entry in the Message Administrator and Message Text
"RTN","HLMA2",8,0)
 ;files for a message that is about to be sent to a recipient
"RTN","HLMA2",9,0)
 ;
"RTN","HLMA2",10,0)
 ;This is a subroutine call with parameter passing.  It returns a value
"RTN","HLMA2",11,0)
 ;in the variable MTIENS with 1 to 3 pieces separated by uparrows
"RTN","HLMA2",12,0)
 ;as follows:  MTIENS^error code^error description
"RTN","HLMA2",13,0)
 ;If no error occurs, only the first piece is returned equal to the IEN
"RTN","HLMA2",14,0)
 ;the entry created in the Message Text or Administration file.
"RTN","HLMA2",15,0)
 ;Otherwise, three pieces are returned with the first piece equal to 0
"RTN","HLMA2",16,0)
 ;
"RTN","HLMA2",17,0)
 ;All the following input parameters are required
"RTN","HLMA2",18,0)
 ;    EIDS = The IEN from the Protocol file of the subscriber event
"RTN","HLMA2",19,0)
 ;   MTIEN = The IEN from the Message Text file created when the
"RTN","HLMA2",20,0)
 ;           GENERATE^HLMA or GENACK^HLMA1 entry points were invoked
"RTN","HLMA2",21,0)
 ;  CLIENT = The IEN of the client (subscriber) application from
"RTN","HLMA2",22,0)
 ;             the Application Parameter file
"RTN","HLMA2",23,0)
 ;PRIORITY = I for immediate or D for deferred
"RTN","HLMA2",24,0)
 ;  MTIENS = The variable that will be returned to the calling
"RTN","HLMA2",25,0)
 ;             application as described above
"RTN","HLMA2",26,0)
 ;Optional parameter
"RTN","HLMA2",27,0)
 ; LOGLINK = The IEN of the logical link from the Logical Link file
"RTN","HLMA2",28,0)
 ;
"RTN","HLMA2",29,0)
 ;     ACK = 1 or 0 to indicate if original message or response-passed
"RTN","HLMA2",30,0)
 ;             by ^HLCS
"RTN","HLMA2",31,0)
 ;
"RTN","HLMA2",32,0)
 ; Save passed parameters for restore... HL*1.6*94
"RTN","HLMA2",33,0)
 N HL94P
"RTN","HLMA2",34,0)
 F HL94P="CONTPTR","NAMESPACE","SECURITY","SUBSCRIBER" D
"RTN","HLMA2",35,0)
 .  QUIT:'$D(HLP(HL94P))  ;->
"RTN","HLMA2",36,0)
 .  MERGE HL94P(HL94P)=HLP(HL94P)
"RTN","HLMA2",37,0)
 ;
"RTN","HLMA2",38,0)
 ;Check for required parameters
"RTN","HLMA2",39,0)
 S MTIENS=""
"RTN","HLMA2",40,0)
 I '$G(EIDS)!('$G(MTIEN))!('$G(CLIENT))!("ID"'[$E($G(PRIORITY))) S MTIENS="0^7^"_$G(^HL(771.7,7,0))_" at SEND^HLMA entry point" G EXIT
"RTN","HLMA2",41,0)
 ;Get message ID and Message Text IEN
"RTN","HLMA2",42,0)
 N HLJ,HLHDRBLD,HLMIDS,HLDTS,HLDT1S,HLP,REPLYTO,SERVER,X
"RTN","HLMA2",43,0)
 ;
"RTN","HLMA2",44,0)
 ; Restore parameters if needed... HL*1.6*94
"RTN","HLMA2",45,0)
 S HL94P=""
"RTN","HLMA2",46,0)
 F  S HL94P=$O(HL94P(HL94P)) Q:HL94P']""  D
"RTN","HLMA2",47,0)
 .  MERGE HLP(HL94P)=HL94P(HL94P)
"RTN","HLMA2",48,0)
 ;
"RTN","HLMA2",49,0)
 ;check if LL is TCP
"RTN","HLMA2",50,0)
 I $G(LOGLINK) D  Q:MTIENS!($G(HLERROR)]"")
"RTN","HLMA2",51,0)
 . ;quit if it is not TCP
"RTN","HLMA2",52,0)
 . Q:$P(^HLCS(870,LOGLINK,0),U,3)'=4
"RTN","HLMA2",53,0)
 . ;create client in 773, MTIENS=ien in 773
"RTN","HLMA2",54,0)
 . S (MTIENS,HLTCP)=$$MA^HLTF(MTIEN,.HLMIDS)
"RTN","HLMA2",55,0)
 . F  L +^HLMA(MTIENS):1 Q:$T  H 1
"RTN","HLMA2",56,0)
 . D MIDAR(HLMIDS)
"RTN","HLMA2",57,0)
 . ;get info from parent (772)
"RTN","HLMA2",58,0)
 . S X=^HL(772,MTIEN,0),HLTYPE=$P(X,U,14),SERVER=$P(X,U,2),REPLYTO=$P(X,U,7)
"RTN","HLMA2",59,0)
 . ;get ack timeout override
"RTN","HLMA2",60,0)
 . S:$P($G(^HL(772,MTIEN,"P")),U,7) HLP("ACKTIME")=+$P(^("P"),U,7)
"RTN","HLMA2",61,0)
 . ;get message type and event type from protocol
"RTN","HLMA2",62,0)
 . S X=$G(^ORD(101,EIDS,770)),HLP("MTYPE")=$P(X,U,11),HLP("EVENT")=$P(X,U,4),HLP("HLTCPI")=MTIENS
"RTN","HLMA2",63,0)
 . S:$P(X,U,5) HLP("MTYPE_EVENT")=$P(X,U,5)
"RTN","HLMA2",64,0)
 . ;update date in client (773)
"RTN","HLMA2",65,0)
 . D UPDATE^HLTF0(MTIENS,"","O",EIDS,CLIENT,SERVER,"D",REPLYTO,"",.HLP)
"RTN","HLMA2",66,0)
 . ;create header for message in 773
"RTN","HLMA2",67,0)
 . I (HLTYPE="M") D HEADER^HLCSHDR1(MTIENS,CLIENT,.HLERROR)
"RTN","HLMA2",68,0)
 . I (HLTYPE'="M") D BHSHDR^HLCSHDR1(MTIENS,CLIENT,.HLERROR)
"RTN","HLMA2",69,0)
 . ;if error set status to ERROR DURING TRANSMISSION
"RTN","HLMA2",70,0)
 . I ($G(HLERROR)'="") D  Q
"RTN","HLMA2",71,0)
 .. D STATUS^HLTF0(MTIENS,4,12,HLERROR) L -^HLMA(MTIENS)
"RTN","HLMA2",72,0)
 .. S MTIENS="0^12^"_$G(^HL(771.7,12,0))_" in HLCSHDR1"
"RTN","HLMA2",73,0)
 .. Q
"RTN","HLMA2",74,0)
 . ;do we still need MTIEN=ien of file 772
"RTN","HLMA2",75,0)
 . S MTIEN=""
"RTN","HLMA2",76,0)
 . ;update status of 773 to PENDING TRANSMISSION
"RTN","HLMA2",77,0)
 . D STATUS^HLTF0(MTIENS,1)
"RTN","HLMA2",78,0)
 . ;set header, HLHDR and Logical Link in 773
"RTN","HLMA2",79,0)
 . S X=MTIENS_",",HLJ(773,X,7)=LOGLINK,HLJ(773,X,200)="HLHDR"
"RTN","HLMA2",80,0)
 . D FILE^DIE("","HLJ")
"RTN","HLMA2",81,0)
 . L -^HLMA(MTIENS)
"RTN","HLMA2",82,0)
 ;
"RTN","HLMA2",83,0)
 ;if not TCP get msg. ID
"RTN","HLMA2",84,0)
 S HLMIDS=$P($G(^HL(772,MTIEN,0)),"^",6)
"RTN","HLMA2",85,0)
 ;create child message
"RTN","HLMA2",86,0)
 D CREATE^HLTF(.HLMIDS,.MTIENS,.HLDTS,.HLDT1S),MIDAR(HLMIDS)
"RTN","HLMA2",87,0)
 ;Link new Message Text file entry to MTIENG entry and update fields
"RTN","HLMA2",88,0)
 ;on zero node
"RTN","HLMA2",89,0)
 D UPDATE^HLTF0(MTIENS,MTIEN,"O",EIDS,CLIENT,"",PRIORITY,"",$S($G(LOGLINK):LOGLINK,1:""))
"RTN","HLMA2",90,0)
EXIT Q
"RTN","HLMA2",91,0)
 ;
"RTN","HLMA2",92,0)
MIDAR(X) ;update HLMIDAR array with X=message id
"RTN","HLMA2",93,0)
 Q:$G(X)=""
"RTN","HLMA2",94,0)
 I 'HLMIDAR S HLMIDAR("N")=1,HLMIDAR=X Q
"RTN","HLMA2",95,0)
 S HLMIDAR(HLMIDAR("N"))=X,HLMIDAR("N")=HLMIDAR("N")+1
"RTN","HLMA2",96,0)
 Q
"RTN","HLMA2",97,0)
 ;
"RTN","HLMA2",98,0)
DC ;direct connect
"RTN","HLMA2",99,0)
 N CLIENT,EIDS,HLMIDS,LOGLINK,MTIEN,MTIENS,POP,HLHDR,HLHDRO,HLMSA,REPLYTO,SERVER,X,HLTCPI
"RTN","HLMA2",100,0)
 N HLCSOUT,HLDBACK,HLDBSIZE,HLDP,HLDREAD,HLDRETR,HLDWAIT,HLMSG,HLOS,HLPORT,HLTCPADD,HLTCPCS,HLTCPLNK,HLTCPO,HLTCPORT,HLRESP,HLTYPE,HLRETRA,HLRETRY,HLTCPRET
"RTN","HLMA2",101,0)
 S (EIDS,LOGLINK)="",MTIEN=HLMTIEN
"RTN","HLMA2",102,0)
 I $D(HLL("LINKS")) D
"RTN","HLMA2",103,0)
 . S EIDS=$P(HLL("LINKS",1),U),LOGLINK=$P(HLL("LINKS",1),U,2)
"RTN","HLMA2",104,0)
 . K HLL("LINKS")
"RTN","HLMA2",105,0)
 . Q:EIDS=""  I EIDS<1 S EIDS=$O(^ORD(101,"B",EIDS,0))
"RTN","HLMA2",106,0)
 . Q:LOGLINK=""  I LOGLINK<1 S LOGLINK=$O(^HLCS(870,"B",LOGLINK,0))
"RTN","HLMA2",107,0)
 . S CLIENT=+$$PTR^HLUTIL2(EIDS)
"RTN","HLMA2",108,0)
 I 'LOGLINK!'EIDS D
"RTN","HLMA2",109,0)
 . S EIDS=+$O(^ORD(101,HLEID,775,0)) Q:'EIDS  S EIDS=$P($G(^(EIDS,0)),U)
"RTN","HLMA2",110,0)
 . S X=$$PTR^HLUTIL2(EIDS),CLIENT=$P(X,U),LOGLINK=$P(X,U,2)
"RTN","HLMA2",111,0)
 I 'EIDS S HLERROR="15^Invalid Subscriber for Immediate connection" Q
"RTN","HLMA2",112,0)
 I 'LOGLINK S HLERROR="15^Invalid Logical Link for Immediate connection" Q
"RTN","HLMA2",113,0)
 I CLIENT<0 S HLERROR="15^Invalid Subscriber Protocol for Immediate connection" Q
"RTN","HLMA2",114,0)
 ;open connection
"RTN","HLMA2",115,0)
 I '$$DCOPEN^HLCSTCP(LOGLINK) S HLERROR="15^Connection Failed" Q
"RTN","HLMA2",116,0)
 ;create client in 773
"RTN","HLMA2",117,0)
 S HLDP=LOGLINK,(MTIENS,HLTCP,HLTCPI,HLMSG)=$$MA^HLTF(MTIEN,.HLMIDS)
"RTN","HLMA2",118,0)
 F  L +^HLMA(MTIENS):1 Q:$T  H 1
"RTN","HLMA2",119,0)
 ;get info from parent (772)
"RTN","HLMA2",120,0)
 S X=^HL(772,MTIEN,0),HLTYPE=$P(X,U,14),SERVER=$P(X,U,2),REPLYTO=$P(X,U,7)
"RTN","HLMA2",121,0)
 ;get ack timeout override
"RTN","HLMA2",122,0)
 S:$P($G(^HL(772,MTIEN,"P")),U,7) HLP("ACKTIME")=+$P(^("P"),U,7)
"RTN","HLMA2",123,0)
 ;get message type and event type from protocol
"RTN","HLMA2",124,0)
 S X=$G(^ORD(101,EIDS,770)),HLP("MTYPE")=$P(X,U,11),HLP("EVENT")=$P(X,U,4),HLP("HLTCPI")=MTIENS
"RTN","HLMA2",125,0)
 S:$P(X,U,5) HLP("MTYPE_EVENT")=$P(X,U,5)
"RTN","HLMA2",126,0)
 ;update date in client (773)
"RTN","HLMA2",127,0)
 D UPDATE^HLTF0(MTIENS,"","O",EIDS,CLIENT,SERVER,"I",REPLYTO,"",.HLP)
"RTN","HLMA2",128,0)
 ;create header for message in 773
"RTN","HLMA2",129,0)
 I (HLTYPE="M") D HEADER^HLCSHDR1(MTIENS,CLIENT,.HLERROR)
"RTN","HLMA2",130,0)
 I (HLTYPE'="M") D BHSHDR^HLCSHDR1(MTIENS,CLIENT,.HLERROR)
"RTN","HLMA2",131,0)
 ;if error set status to ERROR DURING TRANSMISSION
"RTN","HLMA2",132,0)
 I ($G(HLERROR)'="") D  Q
"RTN","HLMA2",133,0)
 . D STATUS^HLTF0(MTIENS,4,12,HLERROR) L -^HLMA(MTIENS)
"RTN","HLMA2",134,0)
 . S MTIENS="0^12^"_$G(^HL(771.7,12,0))_" in HLCSHDR1"
"RTN","HLMA2",135,0)
 . L -^HLMA(HLMSG) D MON^HLCSTCP("Idle")
"RTN","HLMA2",136,0)
 . Q
"RTN","HLMA2",137,0)
 ;set header, HLHDR and Logical Link in 773
"RTN","HLMA2",138,0)
 S X=MTIENS_",",HLJ(773,X,7)=LOGLINK,HLJ(773,X,200)="HLHDR"
"RTN","HLMA2",139,0)
 D FILE^DIE("","HLJ")
"RTN","HLMA2",140,0)
 D DCSEND^HLCSTCP2
"RTN","HLMA2",141,0)
 G EXIT2:'$G(HLRESP)
"RTN","HLMA2",142,0)
 ;X=ien in 773^ien in 772 for response
"RTN","HLMA2",143,0)
 S X=HLRESP D INIT^HLTP3
"RTN","HLMA2",144,0)
 D:'$G(HL) STATUS^HLTF0(HLMTIENS,3,,,1)
"RTN","HLMA2",145,0)
 S HLMTIENR=HLMTIEN
"RTN","HLMA2",146,0)
 D EXIT^HLTP3
"RTN","HLMA2",147,0)
EXIT2 L -^HLMA(HLMSG)
"RTN","HLMA2",148,0)
 Q
"VER")
8.0^22.0
**END**
**END**
