Released PPP*1*38 SEQ #33
Extracted from mail message
**KIDS**:PPP*1.0*38^

**INSTALL NAME**
PPP*1.0*38
"BLD",4631,0)
PPP*1.0*38^PHARMACY PRESCRIPTION PRACTICE^0^3030813^y
"BLD",4631,1,0)
^^3^3^3030813^
"BLD",4631,1,1,0)
This patch will modify the routine that does the daily update to the PPP 
"BLD",4631,1,2,0)
FOREIGN FACILITY XREF file (PPP(1020.2)).
"BLD",4631,1,3,0)
This patch will also update the file description for file 1020.2.
"BLD",4631,4,0)
^9.64PA^^0
"BLD",4631,"ABPKG")
n
"BLD",4631,"INIT")
START^PPPDIC
"BLD",4631,"KRN",0)
^9.67PA^8989.52^19
"BLD",4631,"KRN",.4,0)
.4
"BLD",4631,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",4631,"KRN",.401,0)
.401
"BLD",4631,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",4631,"KRN",.402,0)
.402
"BLD",4631,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",4631,"KRN",.403,0)
.403
"BLD",4631,"KRN",.5,0)
.5
"BLD",4631,"KRN",.84,0)
.84
"BLD",4631,"KRN",.84,"NM",0)
^9.68A^^
"BLD",4631,"KRN",3.6,0)
3.6
"BLD",4631,"KRN",3.8,0)
3.8
"BLD",4631,"KRN",9.2,0)
9.2
"BLD",4631,"KRN",9.8,0)
9.8
"BLD",4631,"KRN",9.8,"NM",0)
^9.68A^7^5
"BLD",4631,"KRN",9.8,"NM",1,0)
PPPBTCH^^0^B809467
"BLD",4631,"KRN",9.8,"NM",4,0)
PPPBLD4^^0^B6571176
"BLD",4631,"KRN",9.8,"NM",5,0)
PPPBLD1^^0^B8260541
"BLD",4631,"KRN",9.8,"NM",6,0)
PPPBLD1A^^0^B18553476
"BLD",4631,"KRN",9.8,"NM",7,0)
PPPDIC^^0^B6002056
"BLD",4631,"KRN",9.8,"NM","B","PPPBLD1",5)
 
"BLD",4631,"KRN",9.8,"NM","B","PPPBLD1A",6)
 
"BLD",4631,"KRN",9.8,"NM","B","PPPBLD4",4)
 
"BLD",4631,"KRN",9.8,"NM","B","PPPBTCH",1)
 
"BLD",4631,"KRN",9.8,"NM","B","PPPDIC",7)
 
"BLD",4631,"KRN",19,0)
19
"BLD",4631,"KRN",19,"NM",0)
^9.68A^^0
"BLD",4631,"KRN",19.1,0)
19.1
"BLD",4631,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",4631,"KRN",101,0)
101
"BLD",4631,"KRN",101,"NM",0)
^9.68A^^0
"BLD",4631,"KRN",409.61,0)
409.61
"BLD",4631,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",4631,"KRN",771,0)
771
"BLD",4631,"KRN",870,0)
870
"BLD",4631,"KRN",8989.51,0)
8989.51
"BLD",4631,"KRN",8989.52,0)
8989.52
"BLD",4631,"KRN",8994,0)
8994
"BLD",4631,"KRN","B",.4,.4)
 
"BLD",4631,"KRN","B",.401,.401)
 
"BLD",4631,"KRN","B",.402,.402)
 
"BLD",4631,"KRN","B",.403,.403)
 
"BLD",4631,"KRN","B",.5,.5)
 
"BLD",4631,"KRN","B",.84,.84)
 
"BLD",4631,"KRN","B",3.6,3.6)
 
"BLD",4631,"KRN","B",3.8,3.8)
 
"BLD",4631,"KRN","B",9.2,9.2)
 
"BLD",4631,"KRN","B",9.8,9.8)
 
"BLD",4631,"KRN","B",19,19)
 
"BLD",4631,"KRN","B",19.1,19.1)
 
"BLD",4631,"KRN","B",101,101)
 
"BLD",4631,"KRN","B",409.61,409.61)
 
"BLD",4631,"KRN","B",771,771)
 
"BLD",4631,"KRN","B",870,870)
 
"BLD",4631,"KRN","B",8989.51,8989.51)
 
"BLD",4631,"KRN","B",8989.52,8989.52)
 
"BLD",4631,"KRN","B",8994,8994)
 
"BLD",4631,"QUES",0)
^9.62^^
"BLD",4631,"REQB",0)
^9.611^2^2
"BLD",4631,"REQB",1,0)
PPP*1.0*26^2
"BLD",4631,"REQB",2,0)
PPP*1.0*35^2
"BLD",4631,"REQB","B","PPP*1.0*26",1)
 
"BLD",4631,"REQB","B","PPP*1.0*35",2)
 
"INIT")
START^PPPDIC
"MBREQ")
0
"PKG",400,-1)
1^1
"PKG",400,0)
PHARMACY PRESCRIPTION PRACTICE^PPP^3P
"PKG",400,20,0)
^9.402P^^
"PKG",400,22,0)
^9.49I^1^1
"PKG",400,22,1,0)
1.0^2950407^2950930
"PKG",400,22,1,"PAH",1,0)
38^3030813^8796
"PKG",400,22,1,"PAH",1,1,0)
^^3^3^3030813
"PKG",400,22,1,"PAH",1,1,1,0)
This patch will modify the routine that does the daily update to the PPP 
"PKG",400,22,1,"PAH",1,1,2,0)
FOREIGN FACILITY XREF file (PPP(1020.2)).
"PKG",400,22,1,"PAH",1,1,3,0)
This patch will also update the file description for file 1020.2.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PPPBLD1")
0^5^B8260541
"RTN","PPPBLD1",1,0)
PPPBLD1 ;ALB/DMB - BUILD FFX FROM CDROM : 3/4/92
"RTN","PPPBLD1",2,0)
 ;;1.0;PHARMACY PRESCRIPTION PRACTICE;**38**;APR 7,1995
"RTN","PPPBLD1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PPPBLD1",4,0)
 ;
"RTN","PPPBLD1",5,0)
BFFX(INARRY,OUTARRY,EXCARRY,LSTPROC) ; Build the Foreign Facility Xref
"RTN","PPPBLD1",6,0)
 ;
"RTN","PPPBLD1",7,0)
 N PPPTMP,BFFSEND,BFFSTRT,DA,DIC,DIE,DR,ERR,ERRARY1,ERRARY2,ERRORS
"RTN","PPPBLD1",8,0)
 N ERRTXT,FFXIFN,FFXLDOV,I,LOCKERR,MAXTM,MPDERR,MPDLDOV,PATDFN
"RTN","PPPBLD1",9,0)
 N RTRNSITE,SNIFN,SSN,STANO,STARTTM,STATUS,TEDTENT
"RTN","PPPBLD1",10,0)
 N TMP,TNEWENT,X,Y,MPDSTERR
"RTN","PPPBLD1",11,0)
 N BUFFER,GROUND
"RTN","PPPBLD1",12,0)
 ;
"RTN","PPPBLD1",13,0)
 S LOCKERR=-9004
"RTN","PPPBLD1",14,0)
 S MPDERR=-9014
"RTN","PPPBLD1",15,0)
 S MPDERR2=-9015
"RTN","PPPBLD1",16,0)
 S MPDSTERR=-9018
"RTN","PPPBLD1",17,0)
 S BFFSTRT=1012
"RTN","PPPBLD1",18,0)
 S BFFSEND=1013
"RTN","PPPBLD1",19,0)
 S RTRNSITE=1
"RTN","PPPBLD1",20,0)
 S BUFFER=5
"RTN","PPPBLD1",21,0)
 S GROUND=0
"RTN","PPPBLD1",22,0)
 S ERRARY1="^"_"TMP(""PPP"",$J,""ERR"","
"RTN","PPPBLD1",23,0)
 S ERRARY2="^"_"TMP(""PPP"",$J,""ERR"")"
"RTN","PPPBLD1",24,0)
 S @ERRARY2@(1)="The following errors occurred while running BFFX^PPPBLD1."
"RTN","PPPBLD1",25,0)
 S @ERRARY2@(2)=" "
"RTN","PPPBLD1",26,0)
 S MAXTM=7200
"RTN","PPPBLD1",27,0)
 I '$D(PPPMRT) S PPPMRT="BFFX_PPPBLD1"
"RTN","PPPBLD1",28,0)
 S (ERR,ERRORS,STATUS,TNEWENT,TEDTENT,TSSN)=0
"RTN","PPPBLD1",29,0)
 ;
"RTN","PPPBLD1",30,0)
LOCKFFX ; Attempt to lock the FFX file.  Exit if you can't
"RTN","PPPBLD1",31,0)
 ;
"RTN","PPPBLD1",32,0)
 L +(^PPP(1020.2)):60
"RTN","PPPBLD1",33,0)
 I '$T D  Q LOCKERR
"RTN","PPPBLD1",34,0)
 .S TMP=$$LOGEVNT^PPPMSC1(LOCKERR,PPPMRT)
"RTN","PPPBLD1",35,0)
 .S PPPTMP(1)="BFFX^PPPBLD1 -> FFX locked by another user."
"RTN","PPPBLD1",36,0)
 .S TMP=$$SNDBLTN^PPPMSC1("PPP NOTIFICATION","PRESCRIPTION PRACTICES","PPPTMP(")
"RTN","PPPBLD1",37,0)
 .K PPPTMP
"RTN","PPPBLD1",38,0)
 ;
"RTN","PPPBLD1",39,0)
 D FIND
"RTN","PPPBLD1",40,0)
STRTMPD ;VMP OIFO BAY PINES;ELR;PPP*1*38
"RTN","PPPBLD1",41,0)
 ;REMOVED START MPD PROCESS
"RTN","PPPBLD1",42,0)
 ;
"RTN","PPPBLD1",43,0)
 ;
"RTN","PPPBLD1",44,0)
 D GETDATA^PPPBLD1A
"RTN","PPPBLD1",45,0)
 ;
"RTN","PPPBLD1",46,0)
 K @OUTARRY,@ERRARY2,@EXCARRY
"RTN","PPPBLD1",47,0)
 Q ERR_"^"_TNEWENT_"^"_TEDTENT
"RTN","PPPBLD1",48,0)
 ;
"RTN","PPPBLD1",49,0)
FIND ;VMP OIFO BAY PINES;ELR;PPP*1*38
"RTN","PPPBLD1",50,0)
 ; GET PATIENT/VISIT DATA
"RTN","PPPBLD1",51,0)
 NEW DATA,PPPDA,PPPDATA,PPPDFN,PPPSITE,PPPSSN,PPPVST,PPPX1
"RTN","PPPBLD1",52,0)
 S PPPSSN=0
"RTN","PPPBLD1",53,0)
 F  S PPPSSN=$O(@INARRY@(PPPSSN)) Q:PPPSSN=""  D
"RTN","PPPBLD1",54,0)
 .S PPPDFN=+$$GETDFN^PPPGET1(PPPSSN)
"RTN","PPPBLD1",55,0)
 .I $G(PPPDFN)'>0 S @OUTARRY@("DONE",PPPSSN)="",@OUTARRY@(PPPSSN,"FOUND")="-1^Could not find SSN "_PPPSSN_" in Patient File." Q
"RTN","PPPBLD1",56,0)
 .K PPPDATA D TFL^VAFCTFU1(.PPPDATA,PPPDFN) ;Supported IA #2990
"RTN","PPPBLD1",57,0)
 .S PPPX1=0
"RTN","PPPBLD1",58,0)
 .F  S PPPX1=$O(PPPDATA(PPPX1)) Q:PPPX1'>0  S DATA=PPPDATA(PPPX1) D
"RTN","PPPBLD1",59,0)
 ..Q:$P(DATA,"^",5)'="VAMC"
"RTN","PPPBLD1",60,0)
 ..S PPPSITE=$P(DATA,"^",1)
"RTN","PPPBLD1",61,0)
 ..Q:PPPSITE=$P($G(^PPP(1020.1,1,0)),"^",9)
"RTN","PPPBLD1",62,0)
 ..S PPPVST=$P($P(DATA,"^",3),".")
"RTN","PPPBLD1",63,0)
 ..S @OUTARRY@(PPPSSN,"SITES",PPPSITE)=PPPVST
"RTN","PPPBLD1",64,0)
 .S @OUTARRY@("DONE",PPPSSN)=""
"RTN","PPPBLD1",65,0)
 .S @OUTARRY@(PPPSSN,"FOUND")="1"
"RTN","PPPBLD1",66,0)
 S @OUTARRY@("STATUS")="1^"          ;1 MEANS NO ERRORS (AS THERE IS NO LONGER A CD ROM SERVER) SO NO MSG SENT IN PIECE 2
"RTN","PPPBLD1",67,0)
 Q
"RTN","PPPBLD1A")
0^6^B18553476
"RTN","PPPBLD1A",1,0)
PPPBLD1A ;ALB/DMB - BUILD FFX FROM CDROM - CONTINUED : 3/4/92
"RTN","PPPBLD1A",2,0)
 ;;1.0;PHARMACY PRESCRIPTION PRACTICE;**2,26,38**;APR 7,1995
"RTN","PPPBLD1A",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PPPBLD1A",4,0)
 ;
"RTN","PPPBLD1A",5,0)
GETDATA ;
"RTN","PPPBLD1A",6,0)
 ;
"RTN","PPPBLD1A",7,0)
 S STARTTM=$$NOW^PPPCNV1
"RTN","PPPBLD1A",8,0)
 F I=0:0 D  Q:(STATUS)
"RTN","PPPBLD1A",9,0)
 .;
"RTN","PPPBLD1A",10,0)
 .; 
"RTN","PPPBLD1A",11,0)
 .;
"RTN","PPPBLD1A",12,0)
CHKTM .;VMP OIFO BAY PINES;ELR;PPP*1*38
"RTN","PPPBLD1A",13,0)
 .;REMOVE CHECKING FOR TIMEOUT ON MPD
"RTN","PPPBLD1A",14,0)
GETSSN .S SSN=$O(@OUTARRY@("DONE",""))
"RTN","PPPBLD1A",15,0)
 .I SSN'="" D
"RTN","PPPBLD1A",16,0)
 ..S STARTTM=$$NOW^PPPCNV1
"RTN","PPPBLD1A",17,0)
 ..S TSSN=TSSN+1
"RTN","PPPBLD1A",18,0)
 ..S FOUND=$G(@OUTARRY@(SSN,"FOUND"))
"RTN","PPPBLD1A",19,0)
 ..I FOUND<1 D  Q
"RTN","PPPBLD1A",20,0)
 ...I FOUND<0 D
"RTN","PPPBLD1A",21,0)
 ....S TMP=$$LOGEVNT^PPPMSC1(MPDERR2,PPPMRT,SSN_"/"_+FOUND)
"RTN","PPPBLD1A",22,0)
 ...K @OUTARRY@(SSN)
"RTN","PPPBLD1A",23,0)
 ...K @OUTARRY@("DONE",SSN)
"RTN","PPPBLD1A",24,0)
 ...D DEL
"RTN","PPPBLD1A",25,0)
 ..;
"RTN","PPPBLD1A",26,0)
GETDFN ..; Get the DFN for the SSN.  If we can't then we have an invalid SSN.
"RTN","PPPBLD1A",27,0)
 ..;
"RTN","PPPBLD1A",28,0)
 ..S PATDFN=+$$GETDFN^PPPGET1(SSN)
"RTN","PPPBLD1A",29,0)
 ..I PATDFN<1 D  Q
"RTN","PPPBLD1A",30,0)
 ...S STARTTM=$$NOW^PPPCNV1
"RTN","PPPBLD1A",31,0)
 ...S ERRTXT="Could not find SSN "_SSN_" in Patient File."
"RTN","PPPBLD1A",32,0)
 ...S ERRORS=1
"RTN","PPPBLD1A",33,0)
 ...S TMP=$$ADD2ERR^PPPBLD2(ERRARY2,ERRTXT)
"RTN","PPPBLD1A",34,0)
 ...K @OUTARRY@("DONE",SSN)
"RTN","PPPBLD1A",35,0)
 ...K @OUTARRY@(SSN)
"RTN","PPPBLD1A",36,0)
 ...D DEL
"RTN","PPPBLD1A",37,0)
 ..;
"RTN","PPPBLD1A",38,0)
GETSTA ..; Now get the station number.  If its not in the institution file
"RTN","PPPBLD1A",39,0)
 ..; then reject it.
"RTN","PPPBLD1A",40,0)
 ..;
"RTN","PPPBLD1A",41,0)
 ..S STANO=0
"RTN","PPPBLD1A",42,0)
 ..F  D  Q:STANO=""
"RTN","PPPBLD1A",43,0)
 ...S STANO=$O(@OUTARRY@(SSN,"SITES",STANO)) Q:STANO=""
"RTN","PPPBLD1A",44,0)
 ...;
"RTN","PPPBLD1A",45,0)
 ...; We need the station IFN to look up the entry in the FFX file.
"RTN","PPPBLD1A",46,0)
 ...;
"RTN","PPPBLD1A",47,0)
 ...;S SNIFN=$O(^DIC(4,"D",STANO,""))
"RTN","PPPBLD1A",48,0)
 ...S SNIFN=STANO
"RTN","PPPBLD1A",49,0)
 ...I SNIFN="" D  Q
"RTN","PPPBLD1A",50,0)
 ....S SNIFN=$O(^PPP(1020.128,"AC",STANO,0)) I SNIFN]"" Q
"RTN","PPPBLD1A",51,0)
 ....S STARTTM=$$NOW^PPPCNV1
"RTN","PPPBLD1A",52,0)
 ....S ERRTXT="Could not find station "_STANO_" in Institution File for SSN "_SSN_"."
"RTN","PPPBLD1A",53,0)
 ....S ERRORS=1
"RTN","PPPBLD1A",54,0)
 ....S TMP=$$ADD2ERR^PPPBLD2(ERRARY2,ERRTXT)
"RTN","PPPBLD1A",55,0)
 ...;
"RTN","PPPBLD1A",56,0)
FFXIFN ...; Check to see if the entry already exists.  If it does then update
"RTN","PPPBLD1A",57,0)
 ...; the last date of visit if necessary.  Else create a new entry.
"RTN","PPPBLD1A",58,0)
 ...;
"RTN","PPPBLD1A",59,0)
 ...S FFXIFN=$$GETFFIFN^PPPGET1(PATDFN,SNIFN)
"RTN","PPPBLD1A",60,0)
 ...S MPDLDOV=$G(@OUTARRY@(SSN,"SITES",STANO))
"RTN","PPPBLD1A",61,0)
 ...I FFXIFN>0 D
"RTN","PPPBLD1A",62,0)
 ....S FFXLDOV=$P($G(^PPP(1020.2,FFXIFN,0)),"^",3)
"RTN","PPPBLD1A",63,0)
 ....I MPDLDOV>FFXLDOV D
"RTN","PPPBLD1A",64,0)
 .....S DIE=1020.2
"RTN","PPPBLD1A",65,0)
 .....S DA=FFXIFN
"RTN","PPPBLD1A",66,0)
 .....S DR="2///"_MPDLDOV
"RTN","PPPBLD1A",67,0)
 .....D ^DIE
"RTN","PPPBLD1A",68,0)
 ....S TEDTENT=TEDTENT+1
"RTN","PPPBLD1A",69,0)
 ...E  D
"RTN","PPPBLD1A",70,0)
 ....S X=PATDFN
"RTN","PPPBLD1A",71,0)
 ....S DIC="^PPP(1020.2,"
"RTN","PPPBLD1A",72,0)
 ....S DIC(0)=""
"RTN","PPPBLD1A",73,0)
 ....S DIC("DR")="1////"_SNIFN_";2///"_MPDLDOV_";7///0"
"RTN","PPPBLD1A",74,0)
 ....K DD,DO D FILE^DICN
"RTN","PPPBLD1A",75,0)
 ....S TNEWENT=TNEWENT+1
"RTN","PPPBLD1A",76,0)
 ....I $P(Y,"^",3)'=1 D
"RTN","PPPBLD1A",77,0)
 .....S ERRTXT="Could not add "_SSN_"/"_STANO_" to FFX file."
"RTN","PPPBLD1A",78,0)
 .....S ERRORS=1
"RTN","PPPBLD1A",79,0)
 .....S TMP=$$ADD2ERR^PPPBLD2(ERRARY2,ERRTXT)
"RTN","PPPBLD1A",80,0)
 ....;
"RTN","PPPBLD1A",81,0)
 ....; Make sure the DOMAIN name got resolved.
"RTN","PPPBLD1A",82,0)
 ....;
"RTN","PPPBLD1A",83,0)
 ....I $P($G(^PPP(1020.2,+Y,1)),"^",5)="" D
"RTN","PPPBLD1A",84,0)
 .....S ERRTXT="Could not resolve DOMAIN for "_SSN_"/"_STANO
"RTN","PPPBLD1A",85,0)
 .....S ERRORS=1
"RTN","PPPBLD1A",86,0)
 .....S TMP=$$ADD2ERR^PPPBLD2(ERRARY2,ERRTXT)
"RTN","PPPBLD1A",87,0)
 ..;
"RTN","PPPBLD1A",88,0)
 ..; We're done with that SSN, kill it off and set last SSN processed
"RTN","PPPBLD1A",89,0)
 ..;VMP OIFO BAY PINES;ELR;PPP*1*38
"RTN","PPPBLD1A",90,0)
 ..D DEL
"RTN","PPPBLD1A",91,0)
 ..;
"RTN","PPPBLD1A",92,0)
 ..K @OUTARRY@("DONE",SSN)
"RTN","PPPBLD1A",93,0)
 ..;PPP*1*26 Dave Blocker - remove setting last SSN
"RTN","PPPBLD1A",94,0)
 ..;messes up the build option
"RTN","PPPBLD1A",95,0)
 ..K @OUTARRY@(SSN)
"RTN","PPPBLD1A",96,0)
 ..;S $P(^PPP(1020.1,1,2),"^",1)=SSN
"RTN","PPPBLD1A",97,0)
 ..S STARTTM=$$NOW^PPPCNV1
"RTN","PPPBLD1A",98,0)
 .E  D
"RTN","PPPBLD1A",99,0)
 ..;
"RTN","PPPBLD1A",100,0)
 ..; There was no SSN available.  Check to see if we're done.
"RTN","PPPBLD1A",101,0)
 ..; If not then check again.
"RTN","PPPBLD1A",102,0)
 ..;
"RTN","PPPBLD1A",103,0)
 ..S STATUS=+$G(@OUTARRY@("STATUS"))
"RTN","PPPBLD1A",104,0)
 ..I STATUS<0 D
"RTN","PPPBLD1A",105,0)
 ...S ERR=MPDSTERR
"RTN","PPPBLD1A",106,0)
 ...S TMP=$$LOGEVNT^PPPMSC1(ERR,PPPMRT,"Status = "_$P($G(@OUTARRY@("STATUS")),U,2))
"RTN","PPPBLD1A",107,0)
 ..E  H 1
"RTN","PPPBLD1A",108,0)
 ;
"RTN","PPPBLD1A",109,0)
 ; We're all done.  Check to see if we need to send an error bulletin.
"RTN","PPPBLD1A",110,0)
 ;
"RTN","PPPBLD1A",111,0)
 I ERRORS D
"RTN","PPPBLD1A",112,0)
 .S TMP=$$SNDBLTN^PPPMSC1("PPP FFX BUILD MESSAGES","PRESCRIPTION PRACTICES",ERRARY1)
"RTN","PPPBLD1A",113,0)
 ;
"RTN","PPPBLD1A",114,0)
 Q
"RTN","PPPBLD1A",115,0)
 ;
"RTN","PPPBLD1A",116,0)
DEL ;VMP OIFO BAY PINES;ELR;PPP*1*38
"RTN","PPPBLD1A",117,0)
 NEW PPPDA S PPPDA=0
"RTN","PPPBLD1A",118,0)
 F  S PPPDA=$O(^PPP(1020.7,"B",SSN,PPPDA)) Q:PPPDA=""  D
"RTN","PPPBLD1A",119,0)
 .I PPPDA S DA=PPPDA,DIK="^PPP(1020.7," D ^DIK K DIK
"RTN","PPPBLD1A",120,0)
 Q
"RTN","PPPBLD4")
0^4^B6571176
"RTN","PPPBLD4",1,0)
PPPBLD4 ;ALB/DMB - ADD NEW PATS TO FFX FROM CDROM ; 3/9/92
"RTN","PPPBLD4",2,0)
 ;;1.0;PHARMACY PRESCRIPTION PRACTICE;**38**;APR 7,1995
"RTN","PPPBLD4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PPPBLD4",4,0)
 ;
"RTN","PPPBLD4",5,0)
NEWPAT ;
"RTN","PPPBLD4",6,0)
 ;
"RTN","PPPBLD4",7,0)
 N BFFXEND,BFFXSTRT,EXCARRY,INARRY,OUTARRY,LKUPERR,TMP,RESULT
"RTN","PPPBLD4",8,0)
 N LOGMSG,STANO,UCI,ZERONODE,NOSSNERR
"RTN","PPPBLD4",9,0)
 ;
"RTN","PPPBLD4",10,0)
 S PPPMRT="NEWPAT_PPPBLD4"
"RTN","PPPBLD4",11,0)
 S LKUPERR=-9003
"RTN","PPPBLD4",12,0)
 S NOSSNERR=-9017
"RTN","PPPBLD4",13,0)
 S BFFXSTRT=1012
"RTN","PPPBLD4",14,0)
 S BFFXEND=1013
"RTN","PPPBLD4",15,0)
 ;
"RTN","PPPBLD4",16,0)
 ; Initialize the input, output and exclusion arrays.
"RTN","PPPBLD4",17,0)
 ; Note: Leave off the ^ as we will add it later.
"RTN","PPPBLD4",18,0)
 ;
"RTN","PPPBLD4",19,0)
 S INARRY="TMP(""PPP"","_$J_",""IN"")"
"RTN","PPPBLD4",20,0)
 S OUTARRY="TMP(""PPP"","_$J_",""OUT"")"
"RTN","PPPBLD4",21,0)
 S EXCARRY="TMP(""PPP"","_$J_",""EXC"")"
"RTN","PPPBLD4",22,0)
 S SSNARRY="^PPP(1020.7,""B"")"
"RTN","PPPBLD4",23,0)
 ;
"RTN","PPPBLD4",24,0)
 ; Log start of routine.
"RTN","PPPBLD4",25,0)
 ;
"RTN","PPPBLD4",26,0)
 S TMP=$$LOGEVNT^PPPMSC1(BFFXSTRT,PPPMRT)
"RTN","PPPBLD4",27,0)
 ;
"RTN","PPPBLD4",28,0)
 ;VMP OIFO BAY PINES;ELR;PPP*1*38
"RTN","PPPBLD4",29,0)
 S X="MPIF001" X ^%ZOSF("TEST") I '$T D  Q
"RTN","PPPBLD4",30,0)
 .S TMP=$$LOGEVNT^PPPMSC1(LKUPERR,PPPMRT,"MPI not Installed")
"RTN","PPPBLD4",31,0)
 .S PPPTMP(1)="CDROM^PPPBLD3 -> MPI not installed."
"RTN","PPPBLD4",32,0)
 .S TMP=$$SNDBLTN^PPPMSC1("PPP NOTIFICATION","PRESCRIPTION PRACTICES","PPPTMP(")
"RTN","PPPBLD4",33,0)
 .K PPPMRT,PPPTMP
"RTN","PPPBLD4",34,0)
 ; Get the station number from the parameter file.
"RTN","PPPBLD4",35,0)
 ;
"RTN","PPPBLD4",36,0)
 S STANO=$P($G(^PPP(1020.1,1,0)),"^",9)
"RTN","PPPBLD4",37,0)
 I STANO="" D  Q
"RTN","PPPBLD4",38,0)
 .S TMP=$$LOGEVNT^PPPMSC1(LKUPERR,PPPMRT,"Station Number Not Found")
"RTN","PPPBLD4",39,0)
 .S PPPTMP(1)="CDROM^PPPBLD3 -> Station Number Not In Parameter File"
"RTN","PPPBLD4",40,0)
 .S TMP=$$SNDBLTN^PPPMSC1("PPP NOTIFICATION","PRESCRIPTION PRACTICES","PPPTMP(")
"RTN","PPPBLD4",41,0)
 .K PPPMRT,PPPTMP
"RTN","PPPBLD4",42,0)
 ;
"RTN","PPPBLD4",43,0)
 ; Get the UCI from Kernel.
"RTN","PPPBLD4",44,0)
 ;VMP OIFO BAY PINES;ELR;PPP*1*38
"RTN","PPPBLD4",45,0)
 ;removed getting uci and setting extended reference for "TMP" global
"RTN","PPPBLD4",46,0)
 ;
"RTN","PPPBLD4",47,0)
 ; Build the required variables
"RTN","PPPBLD4",48,0)
 ;
"RTN","PPPBLD4",49,0)
 S INARRY="^"_INARRY
"RTN","PPPBLD4",50,0)
 S OUTARRY="^"_OUTARRY
"RTN","PPPBLD4",51,0)
 S EXCARRY="^"_EXCARRY
"RTN","PPPBLD4",52,0)
 S @EXCARRY@(STANO)=""
"RTN","PPPBLD4",53,0)
 ; Check for SSN's to process
"RTN","PPPBLD4",54,0)
 ;
"RTN","PPPBLD4",55,0)
 I '$D(@SSNARRY) D  Q
"RTN","PPPBLD4",56,0)
 .S TMP=$$LOGEVNT^PPPMSC1(NOSSNERR,PPPMRT)
"RTN","PPPBLD4",57,0)
 .K PPPMRT
"RTN","PPPBLD4",58,0)
 ;
"RTN","PPPBLD4",59,0)
 ; Copy the New SSN File to the inarry.
"RTN","PPPBLD4",60,0)
 ;
"RTN","PPPBLD4",61,0)
 S %X="^PPP(1020.7,""B"","
"RTN","PPPBLD4",62,0)
 S %Y="^TMP(""PPP"","_$J_",""IN"","
"RTN","PPPBLD4",63,0)
 D %XY^%RCR
"RTN","PPPBLD4",64,0)
 ;
"RTN","PPPBLD4",65,0)
 ; Now call the build routine.
"RTN","PPPBLD4",66,0)
 ;
"RTN","PPPBLD4",67,0)
 S RESULT=$$BFFX^PPPBLD1(INARRY,OUTARRY,EXCARRY,"")
"RTN","PPPBLD4",68,0)
 ;
"RTN","PPPBLD4",69,0)
 ;VMP OIFO BAY PINES;ELR;PPP*1*38
"RTN","PPPBLD4",70,0)
 ;removed setting ZERO NODE MANUALLY USE ^DIK IN PPPBLD1A
"RTN","PPPBLD4",71,0)
 ;
"RTN","PPPBLD4",72,0)
 ; Log the end of the routine.
"RTN","PPPBLD4",73,0)
 ;
"RTN","PPPBLD4",74,0)
 S LOGMSG="Result: "_$P(RESULT,"^")_", New Entries: "_$P(RESULT,"^",2)_", Edited Entries: "_$P(RESULT,"^",3)
"RTN","PPPBLD4",75,0)
 S TMP=$$LOGEVNT^PPPMSC1(BFFXEND,PPPMRT,LOGMSG)
"RTN","PPPBLD4",76,0)
 K PPPMRT,PPPTMP,@INARRY,@OUTARRY,@EXCARRY
"RTN","PPPBLD4",77,0)
 Q
"RTN","PPPBTCH")
0^1^B809467
"RTN","PPPBTCH",1,0)
PPPBTCH ;ALB/DMB - DAILY BATCH ROUTINE FOR 3P ; 3/19/92
"RTN","PPPBTCH",2,0)
 ;;1.0;PHARMACY PRESCRIPTION PRACTICE;**2,35,38**;APR 7,1995
"RTN","PPPBTCH",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PPPBTCH",4,0)
 ;
"RTN","PPPBTCH",5,0)
 ; -- This batch job accomplishes the following things
"RTN","PPPBTCH",6,0)
 ;
"RTN","PPPBTCH",7,0)
 ;    0. Logs event in PPP Log file, PPPBTCH STARTED
"RTN","PPPBTCH",8,0)
 ;    1. Scans FFX file for bad PDX results
"RTN","PPPBTCH",9,0)
 ;    2. Scans Clinic for patients to send PDX's for
"RTN","PPPBTCH",10,0)
 ;    3. Adds new patients to FFX file
"RTN","PPPBTCH",11,0)
 ;    4. Prints Clinical Medication Profiles
"RTN","PPPBTCH",12,0)
 ;    5. Logs event in PPP Log file, PPPBTCH Complete 
"RTN","PPPBTCH",13,0)
START ;
"RTN","PPPBTCH",14,0)
 ;
"RTN","PPPBTCH",15,0)
 N TMP
"RTN","PPPBTCH",16,0)
 ;
"RTN","PPPBTCH",17,0)
 ; -- Log event in PPP LOG file (#1020.4)
"RTN","PPPBTCH",18,0)
 K ^TMP($J,"PPPDOUG") S PPPFLAG=1
"RTN","PPPBTCH",19,0)
 S TMP=$$LOGEVNT^PPPMSC1(1023,"_PPPBTCH")
"RTN","PPPBTCH",20,0)
 ; -- Run night jobs
"RTN","PPPBTCH",21,0)
 D XREFSCAN^PPPSCN1
"RTN","PPPBTCH",22,0)
 D FFSCAN^PPPSCN2
"RTN","PPPBTCH",23,0)
 ;PPP*1*35 - Dave B - remove checking for new patients from CD-ROM
"RTN","PPPBTCH",24,0)
 ;since there is no longer a CD, the data can be obtained from
"RTN","PPPBTCH",25,0)
 ;the MPI/PD package
"RTN","PPPBTCH",26,0)
 ;VMP OIFO BAY PINES;ELR;PPP*1*38
"RTN","PPPBTCH",27,0)
 ;PUT CALL BACK IN to PPPBLD4
"RTN","PPPBTCH",28,0)
 D NEWPAT^PPPBLD4
"RTN","PPPBTCH",29,0)
 D START^PPPPRT2
"RTN","PPPBTCH",30,0)
 S TMP=$$LOGEVNT^PPPMSC1(1024,"PPPBTCH")
"RTN","PPPBTCH",31,0)
 K ^TMP($J,"PPPDOUG"),PPPFLAG
"RTN","PPPBTCH",32,0)
 Q
"RTN","PPPDIC")
0^7^B6002056
"RTN","PPPDIC",1,0)
PPPDIC ;;OIFIO BAY PINES/ELR - UPDATE DESCRIPTION OF FILE 1020.2 - 8/11/2003
"RTN","PPPDIC",2,0)
 ;;1.0;PHARMACY PRESCRIPTION PRACTICE;**38**;APR 7,1995
"RTN","PPPDIC",3,0)
 Q
"RTN","PPPDIC",4,0)
START ;
"RTN","PPPDIC",5,0)
 I '$D(^DIC(1020.2)) D ZTQUE Q
"RTN","PPPDIC",6,0)
 K ^XTMP("PPPDIC",$J)
"RTN","PPPDIC",7,0)
 S ^XTMP("PPPDIC",$J,1)=""
"RTN","PPPDIC",8,0)
 S ^XTMP("PPPDIC",$J,2)="This file contains SSN, last date of visit at each facility, and other"
"RTN","PPPDIC",9,0)
 S ^XTMP("PPPDIC",$J,3)="data for patients who have visited other VA facilities. This file is"
"RTN","PPPDIC",10,0)
 S ^XTMP("PPPDIC",$J,4)="created everytime PPP Build FFX is run.  It is updated everytime"
"RTN","PPPDIC",11,0)
 S ^XTMP("PPPDIC",$J,5)="PPP Batch is run. This file contains approximately 10% of the VA"
"RTN","PPPDIC",12,0)
 S ^XTMP("PPPDIC",$J,6)="patient population.  This file excludes local facility data."
"RTN","PPPDIC",13,0)
 S ^XTMP("PPPDIC",$J,7)=""
"RTN","PPPDIC",14,0)
 S ^XTMP("PPPDIC",$J,8)="Per VHA Directive 10-93-142, this file definition should not be modified."
"RTN","PPPDIC",15,0)
 S PPPDA="1020.2"
"RTN","PPPDIC",16,0)
 D FDA
"RTN","PPPDIC",17,0)
 D SET
"RTN","PPPDIC",18,0)
 K ^XTMP("PPPDIC",$J)
"RTN","PPPDIC",19,0)
 K PPPDA,PPPIENS
"RTN","PPPDIC",20,0)
 Q
"RTN","PPPDIC",21,0)
FDA ;
"RTN","PPPDIC",22,0)
 S PPPIENS=$$IENS^DILF(.PPPDA)
"RTN","PPPDIC",23,0)
 D FDA^DILF(1,PPPIENS,4,"","^XTMP(""PPPDIC"",$J)","FDA(1020.2)")
"RTN","PPPDIC",24,0)
 Q
"RTN","PPPDIC",25,0)
SET D UPDATE^DIE("","FDA(1020.2)","PPPIENS")
"RTN","PPPDIC",26,0)
 I $G(^TMP("DIERR",$J,1)) D ZTQUE
"RTN","PPPDIC",27,0)
 Q
"RTN","PPPDIC",28,0)
BULL ; Bulletin for failed update
"RTN","PPPDIC",29,0)
 N PPPLN,PPPMSG S PPPLN=0
"RTN","PPPDIC",30,0)
 K ^TMP("PPPDIC",$J)
"RTN","PPPDIC",31,0)
 S XMSUB="DICITONARY MAINTENANCE (FILE 1020.2) " K XMY
"RTN","PPPDIC",32,0)
 S XMTEXT="^TMP(""PPPDIC"",$J,"
"RTN","PPPDIC",33,0)
 S XMY($S(DUZ:DUZ,1:.5))=""
"RTN","PPPDIC",34,0)
 S XMDUZ=.5 D NOW^%DTC
"RTN","PPPDIC",35,0)
 S PPPMSG=" " D SETLN
"RTN","PPPDIC",36,0)
 S PPPMSG="The update of file PPP FOREIGN FACILITY XREF (1020.2) description failed." D SETLN
"RTN","PPPDIC",37,0)
 S PPPMSG=" " D SETLN
"RTN","PPPDIC",38,0)
 D ^XMD
"RTN","PPPDIC",39,0)
 K ^TMP("PPPDIC",$J),XMY,XMTEXT,XMSUB
"RTN","PPPDIC",40,0)
 Q
"RTN","PPPDIC",41,0)
SETLN ; Setting TMP global for bulletin
"RTN","PPPDIC",42,0)
 S PPPLN=PPPLN+1
"RTN","PPPDIC",43,0)
 S ^TMP("PPPDIC",$J,PPPLN)=PPPMSG
"RTN","PPPDIC",44,0)
 Q
"RTN","PPPDIC",45,0)
ZTQUE   ;
"RTN","PPPDIC",46,0)
 N ZTIO,ZTDTH,ZTDESC,ZTRTN,ZTSAVE
"RTN","PPPDIC",47,0)
 S ZTIO="",ZTDTH=$H,$P(ZTDTH,",",2)=$P(ZTDTH,",",2)+60,ZTDESC="PPPDIC ERROR"
"RTN","PPPDIC",48,0)
 S ZTRTN="BULL^PPPDIC"
"RTN","PPPDIC",49,0)
 D ^%ZTLOAD
"RTN","PPPDIC",50,0)
 Q
"VER")
8.0^22.0
**END**
**END**
