Released IB*2*246 SEQ #212
Extracted from mail message
**KIDS**:IB*2.0*246^

**INSTALL NAME**
IB*2.0*246
"BLD",4845,0)
IB*2.0*246^INTEGRATED BILLING^0^3030924^y
"BLD",4845,1,0)
^^12^12^3030924^
"BLD",4845,1,1,0)
IIV Update for Individually Accept method in the Insurance Buffer 
"BLD",4845,1,2,0)
acceptance process.
"BLD",4845,1,3,0)
 
"BLD",4845,1,4,0)
This patch fixes a problem identified in the IB Insurance Buffer 
"BLD",4845,1,5,0)
Individually Accept action.  Under certain circumstances the problem may 
"BLD",4845,1,6,0)
result in incorrect filing of information from the Insurance Buffer.  
"BLD",4845,1,7,0)
This 
"BLD",4845,1,8,0)
action was released with IB*2*184, therefore this patch should be 
"BLD",4845,1,9,0)
installed as soon after IB*2*184 as is practicable.
"BLD",4845,1,10,0)
            
"BLD",4845,1,11,0)
* NOTE: This patch must be installed by October 7, 2003, in order to meet 
"BLD",4845,1,12,0)
* the HIPAA compliance date for use of the software by October 16, 2003. 
"BLD",4845,4,0)
^9.64PA^^
"BLD",4845,"ABPKG")
n
"BLD",4845,"KRN",0)
^9.67PA^8989.52^19
"BLD",4845,"KRN",.4,0)
.4
"BLD",4845,"KRN",.401,0)
.401
"BLD",4845,"KRN",.402,0)
.402
"BLD",4845,"KRN",.403,0)
.403
"BLD",4845,"KRN",.5,0)
.5
"BLD",4845,"KRN",.84,0)
.84
"BLD",4845,"KRN",3.6,0)
3.6
"BLD",4845,"KRN",3.8,0)
3.8
"BLD",4845,"KRN",9.2,0)
9.2
"BLD",4845,"KRN",9.8,0)
9.8
"BLD",4845,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4845,"KRN",9.8,"NM",1,0)
IBCNBAA^^0^B59752666
"BLD",4845,"KRN",9.8,"NM",2,0)
IBCNBMI^^0^B47417396
"BLD",4845,"KRN",9.8,"NM","B","IBCNBAA",1)

"BLD",4845,"KRN",9.8,"NM","B","IBCNBMI",2)

"BLD",4845,"KRN",19,0)
19
"BLD",4845,"KRN",19.1,0)
19.1
"BLD",4845,"KRN",101,0)
101
"BLD",4845,"KRN",409.61,0)
409.61
"BLD",4845,"KRN",771,0)
771
"BLD",4845,"KRN",870,0)
870
"BLD",4845,"KRN",8989.51,0)
8989.51
"BLD",4845,"KRN",8989.52,0)
8989.52
"BLD",4845,"KRN",8994,0)
8994
"BLD",4845,"KRN","B",.4,.4)

"BLD",4845,"KRN","B",.401,.401)

"BLD",4845,"KRN","B",.402,.402)

"BLD",4845,"KRN","B",.403,.403)

"BLD",4845,"KRN","B",.5,.5)

"BLD",4845,"KRN","B",.84,.84)

"BLD",4845,"KRN","B",3.6,3.6)

"BLD",4845,"KRN","B",3.8,3.8)

"BLD",4845,"KRN","B",9.2,9.2)

"BLD",4845,"KRN","B",9.8,9.8)

"BLD",4845,"KRN","B",19,19)

"BLD",4845,"KRN","B",19.1,19.1)

"BLD",4845,"KRN","B",101,101)

"BLD",4845,"KRN","B",409.61,409.61)

"BLD",4845,"KRN","B",771,771)

"BLD",4845,"KRN","B",870,870)

"BLD",4845,"KRN","B",8989.51,8989.51)

"BLD",4845,"KRN","B",8989.52,8989.52)

"BLD",4845,"KRN","B",8994,8994)

"BLD",4845,"QUES",0)
^9.62^^
"BLD",4845,"REQB",0)
^9.611^1^1
"BLD",4845,"REQB",1,0)
IB*2.0*184^2
"BLD",4845,"REQB","B","IB*2.0*184",1)

"MBREQ")
0
"PKG",248,-1)
1^1
"PKG",248,0)
INTEGRATED BILLING^IB^APP
"PKG",248,20,0)
^9.402P^1^1
"PKG",248,20,1,0)
2^^IBAXDR
"PKG",248,20,1,1)

"PKG",248,20,"B",2,1)

"PKG",248,22,0)
^9.49I^1^1
"PKG",248,22,1,0)
2.0^2940321^2940616
"PKG",248,22,1,"PAH",1,0)
246^3030924
"PKG",248,22,1,"PAH",1,1,0)
^^12^12^3030924
"PKG",248,22,1,"PAH",1,1,1,0)
IIV Update for Individually Accept method in the Insurance Buffer 
"PKG",248,22,1,"PAH",1,1,2,0)
acceptance process.
"PKG",248,22,1,"PAH",1,1,3,0)
 
"PKG",248,22,1,"PAH",1,1,4,0)
This patch fixes a problem identified in the IB Insurance Buffer 
"PKG",248,22,1,"PAH",1,1,5,0)
Individually Accept action.  Under certain circumstances the problem may 
"PKG",248,22,1,"PAH",1,1,6,0)
result in incorrect filing of information from the Insurance Buffer.  
"PKG",248,22,1,"PAH",1,1,7,0)
This 
"PKG",248,22,1,"PAH",1,1,8,0)
action was released with IB*2*184, therefore this patch should be 
"PKG",248,22,1,"PAH",1,1,9,0)
installed as soon after IB*2*184 as is practicable.
"PKG",248,22,1,"PAH",1,1,10,0)
            
"PKG",248,22,1,"PAH",1,1,11,0)
* NOTE: This patch must be installed by October 7, 2003, in order to meet 
"PKG",248,22,1,"PAH",1,1,12,0)
* the HIPAA compliance date for use of the software by October 16, 2003. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IBCNBAA")
0^1^B59752666
"RTN","IBCNBAA",1,0)
IBCNBAA ;ALB/ARH-Ins Buffer: process Accept set-up ;1 Jun 97
"RTN","IBCNBAA",2,0)
 ;;2.0;INTEGRATED BILLING;**82,184,246**;21-MAR-94
"RTN","IBCNBAA",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNBAA",4,0)
 ;
"RTN","IBCNBAA",5,0)
 ;
"RTN","IBCNBAA",6,0)
ACCEPT(IBBUFDA,IBINSDA,IBGRPDA,IBPOLDA) ; process a buffer entry for acceptance then save in Insurance files
"RTN","IBCNBAA",7,0)
 ;    1) for Insurance Company, Group/Plan and Policy sets of data:
"RTN","IBCNBAA",8,0)
 ;        a) display the set of buffer data and corresponding existing selected ins data
"RTN","IBCNBAA",9,0)
 ;        b) if ins record exists confirm with user that it is the correct one to use
"RTN","IBCNBAA",10,0)
 ;        c) if ins record exists user selects method of saving to ins record: Merge/Overwrite/Replace/No Change/Individually Accept(skip blanks)
"RTN","IBCNBAA",11,0)
 ;        d) if new record needs to be created get user confirmation
"RTN","IBCNBAA",12,0)
 ;    2) display the actions that will be taken
"RTN","IBCNBAA",13,0)
 ;    3) user confirms that is correct
"RTN","IBCNBAA",14,0)
 ;    4) data moved into insurance files, new records created if needed or edit existing ones
"RTN","IBCNBAA",15,0)
 ;    5) complete some general functions that are executed whenever insurance is entered/edited
"RTN","IBCNBAA",16,0)
 ;    6) allow user to view buffer entry and new/updated insurance records
"RTN","IBCNBAA",17,0)
 ;    7) buffer ins/group/policy data deleted
"RTN","IBCNBAA",18,0)
 ;    8) buffer entry status updated
"RTN","IBCNBAA",19,0)
 ;
"RTN","IBCNBAA",20,0)
 N DFN,IBX,IBHELP,IBNEWINS,IBNEWGRP,IBNEWPOL,IBMVINS,IBMVGRP,IBMVPOL,IBACCPT,DIR,X,Y,DIRUT,IBDONE S IBDONE=0
"RTN","IBCNBAA",21,0)
 K ^TMP($J,"IB BUFFER SELECTED")  ; initialize selection file
"RTN","IBCNBAA",22,0)
 S IBINSDA=+$G(IBINSDA),IBGRPDA=+$G(IBGRPDA),IBPOLDA=+$G(IBPOLDA),(IBNEWINS,IBNEWGRP,IBNEWPOL,IBMVINS,IBMVGRP,IBMVPOL)=0
"RTN","IBCNBAA",23,0)
 S DFN=+$G(^IBA(355.33,+$G(IBBUFDA),60)) I 'DFN G ACCPTQ
"RTN","IBCNBAA",24,0)
 I +IBINSDA,+IBGRPDA,'IBPOLDA S IBPOLDA=$$PTGRP^IBCNBU1(DFN,IBINSDA,IBGRPDA) ; pateint already member of plan
"RTN","IBCNBAA",25,0)
 ;
"RTN","IBCNBAA",26,0)
 I $P($G(^IBA(355.33,$G(IBBUFDA),0)),U,4)'="E" G ACCPTQ
"RTN","IBCNBAA",27,0)
 I +IBINSDA,$G(^DIC(36,IBINSDA,0))="" G ACCPTQ
"RTN","IBCNBAA",28,0)
 I +IBGRPDA,+$G(^IBA(355.3,IBGRPDA,0))'=IBINSDA G ACCPTQ
"RTN","IBCNBAA",29,0)
 I +IBGRPDA S IBX=$G(^IBA(355.3,IBGRPDA,0)) I $P(IBX,U,2)=0,+$P(IBX,U,10),$P(IBX,U,10)'=DFN G ACCPTQ
"RTN","IBCNBAA",30,0)
 I +IBPOLDA,+$G(^DPT(DFN,.312,IBPOLDA,0))'=IBINSDA G ACCPTQ
"RTN","IBCNBAA",31,0)
 I +IBPOLDA,$P($G(^DPT(DFN,.312,IBPOLDA,0)),U,18)'=IBGRPDA G ACCPTQ
"RTN","IBCNBAA",32,0)
 ;
"RTN","IBCNBAA",33,0)
ACINS ;
"RTN","IBCNBAA",34,0)
 W @IOF S IBHELP=",INS^IBCNBCD("_IBBUFDA_","_IBINSDA_")"
"RTN","IBCNBAA",35,0)
 D INS^IBCNBCD(IBBUFDA,IBINSDA)
"RTN","IBCNBAA",36,0)
 I +IBINSDA S IBACCPT=$$MATCH("INSURANCE COMPANY") S:'IBACCPT (IBINSDA,IBGRPDA,IBPOLDA)=0 I $D(DIRUT) G ACCPTQ
"RTN","IBCNBAA",37,0)
 I +IBINSDA S IBMVINS=$$MOVE("INSURANCE COMPANY",IBHELP) I $D(DIRUT)!(IBMVINS="") G ACCPTQ
"RTN","IBCNBAA",38,0)
 I 'IBINSDA S IBNEWINS=$$NEW("INSURANCE COMPANY"),IBMVINS=3,(IBGRPDA,IBPOLDA)=0 I 'IBNEWINS G ACCPTQ
"RTN","IBCNBAA",39,0)
 ;
"RTN","IBCNBAA",40,0)
 I +IBMVINS=4 D INS^IBCNBAC(IBBUFDA,IBINSDA,1) ; Ind. Accept-Skip Blanks
"RTN","IBCNBAA",41,0)
 ;
"RTN","IBCNBAA",42,0)
ACGRP ;
"RTN","IBCNBAA",43,0)
 W @IOF S IBHELP=",GRP^IBCNBCD("_IBBUFDA_","_IBGRPDA_")"
"RTN","IBCNBAA",44,0)
 I +IBGRPDA W !,?14,"Patient is "_$S(+IBPOLDA:"",1:"NOT ")_"a member of this Insurance Group/Plan",!
"RTN","IBCNBAA",45,0)
 D GRP^IBCNBCD(IBBUFDA,IBGRPDA)
"RTN","IBCNBAA",46,0)
 I +IBGRPDA S IBACCPT=$$MATCH("GROUP/PLAN") S:'IBACCPT (IBGRPDA,IBPOLDA)=0 I $D(DIRUT) G ACCPTQ
"RTN","IBCNBAA",47,0)
 I +IBGRPDA S IBMVGRP=$$MOVE("GROUP/PLAN",IBHELP) I $D(DIRUT)!(IBMVGRP="") G ACCPTQ
"RTN","IBCNBAA",48,0)
 I 'IBGRPDA S IBNEWGRP=$$NEW("GROUP/PLAN"),IBMVGRP=3,IBPOLDA=0 I 'IBNEWGRP G ACCPTQ
"RTN","IBCNBAA",49,0)
 ;
"RTN","IBCNBAA",50,0)
 I +IBMVGRP=4 D GRP^IBCNBAC(IBBUFDA,IBGRPDA,1) ; Ind. Accept-Skip Blanks
"RTN","IBCNBAA",51,0)
 ;
"RTN","IBCNBAA",52,0)
ACPOL ;
"RTN","IBCNBAA",53,0)
 W @IOF S IBHELP=",POLICY^IBCNBCD("_IBBUFDA_","_IBPOLDA_")"
"RTN","IBCNBAA",54,0)
 I 'IBPOLDA W !,"This will be a New policy for this group and patient.",!
"RTN","IBCNBAA",55,0)
 D POLICY^IBCNBCD(IBBUFDA,IBPOLDA)
"RTN","IBCNBAA",56,0)
 I +IBPOLDA S IBACCPT=$$MATCH("PATIENT POLICY") S:'IBACCPT IBPOLDA=0 I $D(DIRUT) G ACCPTQ
"RTN","IBCNBAA",57,0)
 I +IBPOLDA S IBMVPOL=$$MOVE("PATIENT POLICY",IBHELP) I $D(DIRUT)!(IBMVPOL="") G ACCPTQ
"RTN","IBCNBAA",58,0)
 I 'IBPOLDA S IBNEWPOL=$$NEW("PATIENT POLICY"),IBMVPOL=3 I 'IBNEWPOL G ACCPTQ
"RTN","IBCNBAA",59,0)
 ;
"RTN","IBCNBAA",60,0)
 I +IBMVPOL=4 D POLICY^IBCNBAC(IBBUFDA,IBPOLDA,1) ; Ind. Accept-Skip Blanks
"RTN","IBCNBAA",61,0)
 ;
"RTN","IBCNBAA",62,0)
CHECK ; display changes that will be made and ask user for confirmation
"RTN","IBCNBAA",63,0)
 W @IOF
"RTN","IBCNBAA",64,0)
 ;
"RTN","IBCNBAA",65,0)
 I +IBINSDA S IBX="The Buffer data will "_$P(IBMVINS,U,2)_" the existing Insurance Company data."
"RTN","IBCNBAA",66,0)
 I +IBINSDA,'IBMVINS S IBX="There will be "_$P(IBMVINS,U,2)_" to the existing Insurance Company data."
"RTN","IBCNBAA",67,0)
 I 'IBINSDA S IBX=$P(^IBA(355.33,IBBUFDA,20),U,1)_" will be added as a NEW Insurance Company."
"RTN","IBCNBAA",68,0)
 W !!,$G(IORVON)_"STEP 1: Insurance Company"_$J("",55)_$G(IORVOFF) W !,IBX
"RTN","IBCNBAA",69,0)
 ;
"RTN","IBCNBAA",70,0)
 I +IBGRPDA S IBX="The Buffer data will "_$P(IBMVGRP,U,2)_" the existing Group/Plan data."
"RTN","IBCNBAA",71,0)
 I +IBGRPDA,'IBMVGRP S IBX="There will be "_$P(IBMVGRP,U,2)_" to the existing Group/Plan data."
"RTN","IBCNBAA",72,0)
 I 'IBGRPDA S IBX="A NEW Group Plan will be added to this Insurance Company."
"RTN","IBCNBAA",73,0)
 W !!,$G(IORVON)_"STEP 2: Group/Plan"_$J("",62)_$G(IORVOFF) W !,IBX
"RTN","IBCNBAA",74,0)
 ;
"RTN","IBCNBAA",75,0)
 I +IBPOLDA S IBX="The Buffer data will "_$P(IBMVPOL,U,2)_" the existing Policy data."
"RTN","IBCNBAA",76,0)
 I +IBPOLDA,'IBMVPOL S IBX="There will be "_$P(IBMVPOL,U,2)_" to the existing Policy data."
"RTN","IBCNBAA",77,0)
 I 'IBPOLDA S IBX="A NEW Patient Policy will be added for this patient and this Group/Plan."
"RTN","IBCNBAA",78,0)
 W !!,$G(IORVON)_"STEP 3: Patient Policy"_$J("",58)_$G(IORVOFF) W !,IBX
"RTN","IBCNBAA",79,0)
 ;
"RTN","IBCNBAA",80,0)
 I +IBINSDA,$P(IBMVINS,U,1)=0,+IBGRPDA,$P(IBMVGRP,U,1)=0,+IBPOLDA,$P(IBMVPOL,U,1)=0 W !!!,"This would result in No Change to the existing Insurance data.  Process aborted." D WAIT G ACCPTQ
"RTN","IBCNBAA",81,0)
 ;
"RTN","IBCNBAA",82,0)
 I '$$OK G ACCPTQ
"RTN","IBCNBAA",83,0)
 ;
"RTN","IBCNBAA",84,0)
PROCESS ; process all changes selected by user, add/edit insurance files based on buffer data, cleanup, ...
"RTN","IBCNBAA",85,0)
 ;
"RTN","IBCNBAA",86,0)
 D ACCEPT^IBCNBAR(IBBUFDA,DFN,IBINSDA,IBGRPDA,IBPOLDA,IBMVINS,IBMVGRP,IBMVPOL,IBNEWINS,IBNEWGRP,IBNEWPOL)
"RTN","IBCNBAA",87,0)
 S IBDONE=1
"RTN","IBCNBAA",88,0)
 ;
"RTN","IBCNBAA",89,0)
ACCPTQ K ^TMP($J,"IB BUFFER SELECTED")  ; cleanup selection file
"RTN","IBCNBAA",90,0)
 Q IBDONE
"RTN","IBCNBAA",91,0)
 ;
"RTN","IBCNBAA",92,0)
 ;
"RTN","IBCNBAA",93,0)
 ;
"RTN","IBCNBAA",94,0)
MATCH(IBDESC) ; ask the user if the buffer entry is a match with the selected insurance file entry
"RTN","IBCNBAA",95,0)
 ; returns 1 if there is a match, 0 otherwise
"RTN","IBCNBAA",96,0)
 N DIR,X,Y,IBX S IBX=0
"RTN","IBCNBAA",97,0)
 S DIR("?")="Enter Yes if this existing "_IBDESC_" corresponds to the buffer entry "_IBDESC_".  Enter No to add new "_IBDESC_"."
"RTN","IBCNBAA",98,0)
 S DIR("?",1)="Entering Yes will match this existing "_IBDESC_" with the buffer entry,"
"RTN","IBCNBAA",99,0)
 S DIR("?",2)="no new "_IBDESC_" will be created.  Any existing "_IBDESC_" data"
"RTN","IBCNBAA",100,0)
 S DIR("?",3)="changes based on the Buffer data will be applied to this "_IBDESC_"."
"RTN","IBCNBAA",101,0)
 S DIR("?",4)="Enter No to create a new "_IBDESC_" if the Buffer entry's "
"RTN","IBCNBAA",102,0)
 S DIR("?",5)=IBDESC_" data does not match any existing "_IBDESC_".",DIR("?",6)=""
"RTN","IBCNBAA",103,0)
 ;
"RTN","IBCNBAA",104,0)
 W ! S DIR(0)="YO",DIR("A")="Is this the correct "_IBDESC_" to match with this Buffer entry" D ^DIR I Y=1 S IBX=1
"RTN","IBCNBAA",105,0)
 Q IBX
"RTN","IBCNBAA",106,0)
 ;
"RTN","IBCNBAA",107,0)
MOVE(IBDESC,IBHELP) ; ask the user what method they want to use to transfer buffer data to the insurance files
"RTN","IBCNBAA",108,0)
 ; returns 1^merge, 2^overwrite, 3^replace, 4^individually accept (skip blanks),
"RTN","IBCNBAA",109,0)
 ;  0^no change,
"RTN","IBCNBAA",110,0)
 ;  or "" if none of the methods was chosen
"RTN","IBCNBAA",111,0)
 N DIR,X,Y,IBX S IBX=""
"RTN","IBCNBAA",112,0)
 S DIR("?")="^D HELP^IBCNBUH,WAIT^IBCNBAA"_$G(IBHELP),DIR("??")="^D HELP2^IBCNBUH,WAIT^IBCNBAA"_$G(IBHELP)
"RTN","IBCNBAA",113,0)
 S DIR("A")="Select the method to update the "_IBDESC
"RTN","IBCNBAA",114,0)
 ; DAOU/BHS - 08/28/2002 - Added INDIVIDUALLY ACCEPT methods
"RTN","IBCNBAA",115,0)
 W ! S DIR(0)="SOB^M:MERGE;O:OVERWRITE;R:REPLACE;N:NO CHANGE;I:INDIVIDUALLY ACCEPT (SKIP BLANKS)" D ^DIR
"RTN","IBCNBAA",116,0)
 S IBX=$S(Y="M":1,Y="O":2,Y="R":3,Y="I":4,Y="N":0,1:"") I IBX'="" S IBX=IBX_U_$G(Y(0))_$S(+IBX=1:" with",1:"")
"RTN","IBCNBAA",117,0)
 Q IBX
"RTN","IBCNBAA",118,0)
 ;
"RTN","IBCNBAA",119,0)
NEW(IBDESC) ; ask user if they want to add a new entry to the insurance files (36, 355.3, or 2.312)
"RTN","IBCNBAA",120,0)
 ; returns 1 if Yes create a new entry, 0 otherwise
"RTN","IBCNBAA",121,0)
 N DIR,X,Y,IBX S IBX=0
"RTN","IBCNBAA",122,0)
 I IBDESC="INSURANCE COMPANY",'$D(^XUSEC("IB INSURANCE COMPANY ADD",DUZ)) W !!,"Sorry, but you do not have the required privileges to add",!,"new Insurance Companies." D WAIT G NEWQ
"RTN","IBCNBAA",123,0)
 ;
"RTN","IBCNBAA",124,0)
 S DIR("?")="Enter Yes to create a new "_IBDESC_". Enter No to stop this process."
"RTN","IBCNBAA",125,0)
 S DIR("?",1)="Enter Yes to create a new "_IBDESC_" in the Insurance files for"
"RTN","IBCNBAA",126,0)
 S DIR("?",2)="this Buffer entry only if no existing "_IBDESC_" could be found"
"RTN","IBCNBAA",127,0)
 S DIR("?",3)="that matches this buffer entry.",DIR("?",4)=""
"RTN","IBCNBAA",128,0)
 W ! S DIR(0)="YO",DIR("A")="No "_IBDESC_" Selected, Add a New "_IBDESC D ^DIR I +Y=1 S IBX=1
"RTN","IBCNBAA",129,0)
NEWQ Q IBX
"RTN","IBCNBAA",130,0)
 ;
"RTN","IBCNBAA",131,0)
OK() ; ask the user if the buffer data should be moved to the insurance files
"RTN","IBCNBAA",132,0)
 ; returns 1 if yes, 0 otherwise
"RTN","IBCNBAA",133,0)
 N DIR,X,Y,IBX S IBX=0 W !!!
"RTN","IBCNBAA",134,0)
 S DIR("?")="Enter Yes to accept/verify the buffer data and move it to the insurance files.  Enter No to stop this process."
"RTN","IBCNBAA",135,0)
 S DIR("?",1)="Entering Yes will cause several things to happen:"
"RTN","IBCNBAA",136,0)
 S DIR("?",2)="  1 - the above changes will be completed and the Insurance files updated with"
"RTN","IBCNBAA",137,0)
 S DIR("?",3)="      the buffer data."
"RTN","IBCNBAA",138,0)
 S DIR("?",4)="  2 - the Insurance entries modified or added will be flagged as verified."
"RTN","IBCNBAA",139,0)
 S DIR("?",5)="  3 - most of the insurance and patient related information in the buffer entry"
"RTN","IBCNBAA",140,0)
 S DIR("?",6)="      will be deleted, leaving only a stub entry for reporting purposes.",DIR("?",7)=""
"RTN","IBCNBAA",141,0)
 S DIR(0)="YO",DIR("A")="Is this Correct, update the existing Insurance files now" D ^DIR I Y=1 S IBX=1
"RTN","IBCNBAA",142,0)
 Q IBX
"RTN","IBCNBAA",143,0)
 ;
"RTN","IBCNBAA",144,0)
WAIT N DIR,DIRUT,DUOUT,DTOUT,X,Y W !! S DIR(0)="E",DIR("A")="Enter RETURN to continue" D ^DIR W !!
"RTN","IBCNBAA",145,0)
 Q
"RTN","IBCNBMI")
0^2^B47417396
"RTN","IBCNBMI",1,0)
IBCNBMI ;ALB/ARH-Ins Buffer: move buffer data to insurance files ;1 Jun 97
"RTN","IBCNBMI",2,0)
 ;;2.0;INTEGRATED BILLING;**82,184,246**;21-MAR-94
"RTN","IBCNBMI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNBMI",4,0)
 ;
"RTN","IBCNBMI",5,0)
INS(IBBUFDA,IBINSDA,TYPE) ;  move buffer insurance company data (file 355.33) to existing Insurance Company (file 36)
"RTN","IBCNBMI",6,0)
 ;
"RTN","IBCNBMI",7,0)
 S IBBUFDA=IBBUFDA_",",IBINSDA=$G(IBINSDA)_","
"RTN","IBCNBMI",8,0)
 D SET("INS",IBBUFDA,IBINSDA,TYPE)
"RTN","IBCNBMI",9,0)
 Q
"RTN","IBCNBMI",10,0)
 ;
"RTN","IBCNBMI",11,0)
GRP(IBBUFDA,IBGRPDA,TYPE) ;  move buffer insurance group/plan data (file 355.33) to existing Group/Plan (file 355.33)
"RTN","IBCNBMI",12,0)
 ;
"RTN","IBCNBMI",13,0)
 S IBBUFDA=IBBUFDA_",",IBGRPDA=$G(IBGRPDA)_","
"RTN","IBCNBMI",14,0)
 D SET("GRP",IBBUFDA,IBGRPDA,TYPE)
"RTN","IBCNBMI",15,0)
 D STUFF("GRP",IBGRPDA)
"RTN","IBCNBMI",16,0)
 Q
"RTN","IBCNBMI",17,0)
 ;
"RTN","IBCNBMI",18,0)
POLICY(IBBUFDA,IBPOLDA,TYPE) ;  move buffer insurance policy data (file 355.33) to existing Patient Policy (file 2.312)
"RTN","IBCNBMI",19,0)
 ;
"RTN","IBCNBMI",20,0)
 N DFN S DFN=+$G(^IBA(355.33,+$G(IBBUFDA),60)) Q:'DFN
"RTN","IBCNBMI",21,0)
 ;
"RTN","IBCNBMI",22,0)
 S IBBUFDA=IBBUFDA_",",IBPOLDA=$G(IBPOLDA)_","_DFN_","
"RTN","IBCNBMI",23,0)
 D SET("POL",IBBUFDA,IBPOLDA,TYPE)
"RTN","IBCNBMI",24,0)
 D STUFF("POL",IBPOLDA)
"RTN","IBCNBMI",25,0)
 D POLOTH(IBBUFDA,IBPOLDA)
"RTN","IBCNBMI",26,0)
 Q
"RTN","IBCNBMI",27,0)
 ;
"RTN","IBCNBMI",28,0)
SET(SET,IBBUFDA,IBEXTDA,TYPE) ; move buffer data to insurance files
"RTN","IBCNBMI",29,0)
 ; Input:  IBBUFDA - ifn of Buffer File entry to move (#355.33)
"RTN","IBCNBMI",30,0)
 ;         IBEXTDA - ifn of insurance entry to update (#36,355.3,2)
"RTN","IBCNBMI",31,0)
 ;         TYPE    - 1 = Merge     (only buffer data moved to blank fields in ins file, no replace)
"RTN","IBCNBMI",32,0)
 ;                   2 = Overwrite (all buffer data moved to ins file, replace existing data)
"RTN","IBCNBMI",33,0)
 ;                   3 = Replace (all buffer data including null move to ins file)
"RTN","IBCNBMI",34,0)
 ;                   4 = Individually Accept (Skip Blanks) (user accepts
"RTN","IBCNBMI",35,0)
 ;  individual diffs b/w buffer data and existing file data (excl blanks)
"RTN","IBCNBMI",36,0)
 ;  to overwrite flds (or addr grp) in existing file)
"RTN","IBCNBMI",37,0)
 ;
"RTN","IBCNBMI",38,0)
 ;
"RTN","IBCNBMI",39,0)
 N IBX,IBFLDS,EXTFILE,DRBUF,DREXT,BUFARR,EXTARR,IBBUFFLD,IBEXTFLD,IBBUFVAL,IBEXTVAL,IBCHNG,IBCHNGN,IBERR
"RTN","IBCNBMI",40,0)
 ;
"RTN","IBCNBMI",41,0)
 D FIELDS(SET_"FLD")
"RTN","IBCNBMI",42,0)
 S IBX=$P($T(@(SET_"DR")+1),";;",2),EXTFILE=+$P(IBX,U,1),DRBUF=$P(IBX,U,2),DREXT=$P(IBX,U,3)
"RTN","IBCNBMI",43,0)
 ;
"RTN","IBCNBMI",44,0)
 D GETS^DIQ(355.33,IBBUFDA,DRBUF,"E","BUFARR")
"RTN","IBCNBMI",45,0)
 D GETS^DIQ(EXTFILE,IBEXTDA,DREXT,"E","EXTARR")
"RTN","IBCNBMI",46,0)
 ;
"RTN","IBCNBMI",47,0)
 I +$G(TYPE) S IBBUFFLD=0 F  S IBBUFFLD=$O(BUFARR(355.33,IBBUFDA,IBBUFFLD)) Q:'IBBUFFLD  D
"RTN","IBCNBMI",48,0)
 . S IBEXTFLD=$G(IBFLDS(IBBUFFLD)) Q:'IBEXTFLD
"RTN","IBCNBMI",49,0)
 . S IBBUFVAL=BUFARR(355.33,IBBUFDA,IBBUFFLD,"E")
"RTN","IBCNBMI",50,0)
 . S IBEXTVAL=$G(EXTARR(EXTFILE,IBEXTDA,IBEXTFLD,"E"))
"RTN","IBCNBMI",51,0)
 . ;
"RTN","IBCNBMI",52,0)
 . I IBBUFVAL=IBEXTVAL Q
"RTN","IBCNBMI",53,0)
 . I TYPE=1,IBEXTVAL'="" Q
"RTN","IBCNBMI",54,0)
 . I TYPE=2,IBBUFVAL="" Q
"RTN","IBCNBMI",55,0)
 . I TYPE=4,'$D(^TMP($J,"IB BUFFER SELECTED",IBBUFFLD)) Q
"RTN","IBCNBMI",56,0)
 . ;
"RTN","IBCNBMI",57,0)
 . S IBCHNG(EXTFILE,IBEXTDA,IBEXTFLD)=IBBUFVAL
"RTN","IBCNBMI",58,0)
 . S IBCHNGN(EXTFILE,IBEXTDA,IBEXTFLD)=""
"RTN","IBCNBMI",59,0)
 ;
"RTN","IBCNBMI",60,0)
 I $D(IBCHNGN)>9 D FILE^DIE("E","IBCHNGN","IBERR")
"RTN","IBCNBMI",61,0)
 I $D(IBCHNG)>9 D FILE^DIE("E","IBCHNG","IBERR")
"RTN","IBCNBMI",62,0)
 Q
"RTN","IBCNBMI",63,0)
 ;
"RTN","IBCNBMI",64,0)
STUFF(SET,IBEXTDA) ; update fields in insurance files that should be automatically set when an entry is edited
"RTN","IBCNBMI",65,0)
 ; Input:  IBEXTDA - ifn of insurance entry to update (#36,356,2)
"RTN","IBCNBMI",66,0)
 ;
"RTN","IBCNBMI",67,0)
 N IBX,IBFLDS,EXTFILE,IBEXTFLD,IBEXTVAL,IBCHNG,IBCHNGN,IBERR
"RTN","IBCNBMI",68,0)
 ;
"RTN","IBCNBMI",69,0)
 D FIELDS(SET_"A")
"RTN","IBCNBMI",70,0)
 S IBX=$P($T(@(SET_"DR")+1),";;",2),EXTFILE=+$P(IBX,U,1)
"RTN","IBCNBMI",71,0)
 ;
"RTN","IBCNBMI",72,0)
 S IBEXTFLD=0 F  S IBEXTFLD=$O(IBFLDS(IBEXTFLD)) Q:'IBEXTFLD  D
"RTN","IBCNBMI",73,0)
 . S IBEXTVAL=IBFLDS(IBEXTFLD) I IBEXTVAL="DUZ" S IBEXTVAL="`"_DUZ
"RTN","IBCNBMI",74,0)
 . S IBCHNG(EXTFILE,IBEXTDA,IBEXTFLD)=IBEXTVAL
"RTN","IBCNBMI",75,0)
 . S IBCHNGN(EXTFILE,IBEXTDA,IBEXTFLD)=""
"RTN","IBCNBMI",76,0)
 ;
"RTN","IBCNBMI",77,0)
 D FILE^DIE("E","IBCHNGN","IBERR")
"RTN","IBCNBMI",78,0)
 D FILE^DIE("E","IBCHNG","IBERR")
"RTN","IBCNBMI",79,0)
 Q
"RTN","IBCNBMI",80,0)
 ;
"RTN","IBCNBMI",81,0)
FIELDS(SET) ; return array of corresponding fields: IBFLDS(Buffer #)=Ins #
"RTN","IBCNBMI",82,0)
 N IBI,IBLN,IBB,IBE,IBG K IBFLDS,IBADDS,IBLBLS
"RTN","IBCNBMI",83,0)
 F IBI=1:1 S IBLN=$P($T(@(SET)+IBI),";;",2) Q:IBLN=""  I $E(IBLN,1)'=" " D
"RTN","IBCNBMI",84,0)
 . S IBB=$P(IBLN,U,1),IBE=$P(IBLN,U,2),IBG=$P(IBLN,U,4)
"RTN","IBCNBMI",85,0)
 . I IBB'="",IBE'="" D
"RTN","IBCNBMI",86,0)
 .. S IBFLDS(IBB)=IBE
"RTN","IBCNBMI",87,0)
 .. I SET["FLD" S IBLBLS(IBB)=$P(IBLN,U,3) I +IBG S IBADDS(IBB)=IBE
"RTN","IBCNBMI",88,0)
 Q
"RTN","IBCNBMI",89,0)
 ;
"RTN","IBCNBMI",90,0)
INSDR ;
"RTN","IBCNBMI",91,0)
 ;;36^20.02:20.04;21.01:21.06^.131;.132;.133;.111:.116
"RTN","IBCNBMI",92,0)
INSFLD ; corresponding fields:  Buffer File (355.33) and Insurance Company file (36)
"RTN","IBCNBMI",93,0)
 ;;20.02^.131^Phone Number^           ; MM Phone Number
"RTN","IBCNBMI",94,0)
 ;;20.03^.132^Billing Phone^          ; Billing Phone Number
"RTN","IBCNBMI",95,0)
 ;;20.04^.133^Pre-Cert Phone^         ; Pre-Certification Phone Number
"RTN","IBCNBMI",96,0)
 ;;21.01^.111^Street [Line 1]^1       ; MM Street Address [Line 1]
"RTN","IBCNBMI",97,0)
 ;;21.02^.112^Street [Line 2]^1       ; MM Street Address [Line 2]
"RTN","IBCNBMI",98,0)
 ;;21.03^.113^Street [Line 3]^1       ; MM Street Address [Line 3]
"RTN","IBCNBMI",99,0)
 ;;21.04^.114^City^1                  ; MM City
"RTN","IBCNBMI",100,0)
 ;;21.05^.115^State^1                 ; MM State
"RTN","IBCNBMI",101,0)
 ;;21.06^.116^Zip^1                   ; MM Zip Code
"RTN","IBCNBMI",102,0)
 ;
"RTN","IBCNBMI",103,0)
GRPDR ;
"RTN","IBCNBMI",104,0)
 ;;355.3^40.02:40.09^.03:.09;.12
"RTN","IBCNBMI",105,0)
GRPFLD ;corresponding fields:  Buffer File (355.33) and Insurance Group Plan file (355.3)
"RTN","IBCNBMI",106,0)
 ;;40.02^.03^Group Name^              ; Group Name
"RTN","IBCNBMI",107,0)
 ;;40.03^.04^Group Number^            ; Group Number
"RTN","IBCNBMI",108,0)
 ;;40.04^.05^Require UR^              ; Utilization Review Required
"RTN","IBCNBMI",109,0)
 ;;40.05^.06^Require Pre-Cert^        ; Pre-Certification Required
"RTN","IBCNBMI",110,0)
 ;;40.06^.12^Require Amb Cert^        ; Ambulatory Care Certification
"RTN","IBCNBMI",111,0)
 ;;40.07^.07^Exclude Pre-Cond^        ; Exclude Pre-Existing Conditions
"RTN","IBCNBMI",112,0)
 ;;40.08^.08^Benefits Assign^         ; Benefits Assignable
"RTN","IBCNBMI",113,0)
 ;;40.09^.09^Type of Plan^            ; Type of Plan
"RTN","IBCNBMI",114,0)
 ;
"RTN","IBCNBMI",115,0)
GRPA ; auto set fields
"RTN","IBCNBMI",116,0)
 ;;1.05^NOW^                          ; Date Last Edited
"RTN","IBCNBMI",117,0)
 ;;1.06^DUZ^                          ; Last edited By
"RTN","IBCNBMI",118,0)
 ;
"RTN","IBCNBMI",119,0)
POLDR ;
"RTN","IBCNBMI",120,0)
 ;;2.312^60.02:61.12^8;3;1;6;16;17;3.01;3.05;4.01;4.02;.2;2.1;2.015;2.11;2.12;2.01:2.08
"RTN","IBCNBMI",121,0)
POLFLD ; corresponding fields:  Buffer File (355.33) and Insurance Patient Policy file (2.312)
"RTN","IBCNBMI",122,0)
 ;;60.02^8^Effective Date^            ; Effective Date
"RTN","IBCNBMI",123,0)
 ;;60.03^3^Expiration Date^           ; Expiration Date
"RTN","IBCNBMI",124,0)
 ;;60.04^1^Subscriber Id^             ; Subscriber Id
"RTN","IBCNBMI",125,0)
 ;;60.05^6^Whose Insurance^           ; Whose Insurance
"RTN","IBCNBMI",126,0)
 ;;60.06^16^Relationship^             ; Pt. Relationship to Insured
"RTN","IBCNBMI",127,0)
 ;;60.07^17^Name of Insured^          ; Name of Insured
"RTN","IBCNBMI",128,0)
 ;;60.08^3.01^Insured's DOB^          ; Insured's DOB
"RTN","IBCNBMI",129,0)
 ;;60.09^3.05^Insured's SSN^          ; Insured's SSN
"RTN","IBCNBMI",130,0)
 ;;60.1^4.01^Primary Provider^        ; Primary Care Provider
"RTN","IBCNBMI",131,0)
 ;;60.11^4.02^Provider Phone^         ; Primary Care Provider Phone
"RTN","IBCNBMI",132,0)
 ;;60.12^.2^Coor of Benefits^         ; Coordination of Benefits
"RTN","IBCNBMI",133,0)
 ;;  
"RTN","IBCNBMI",134,0)
 ;;61.01^2.1^Emp Sponsored^           ; ESGHP?
"RTN","IBCNBMI",135,0)
 ;;61.02^2.015^Employer Name^         ; Subscriber's Employer Name
"RTN","IBCNBMI",136,0)
 ;;61.03^2.11^Emp Status^             ; Employment Status
"RTN","IBCNBMI",137,0)
 ;;61.04^2.12^Retirement Date^        ; Retirement Date
"RTN","IBCNBMI",138,0)
 ;;61.05^2.01^Send to Employer^       ; Send Bill to Employer?
"RTN","IBCNBMI",139,0)
 ;;61.06^2.02^Emp Street Ln 1^1       ; Employer Claims Street Line 1
"RTN","IBCNBMI",140,0)
 ;;61.07^2.03^Emp Street Ln 2^1       ; Employer Claims Street Line 2
"RTN","IBCNBMI",141,0)
 ;;61.08^2.04^Emp Street Ln 3^1       ; Employer Claims Street Line 3
"RTN","IBCNBMI",142,0)
 ;;61.09^2.05^Emp City^1              ; Employer Claims City
"RTN","IBCNBMI",143,0)
 ;;61.1^2.06^Emp State^1              ; Employer Claims State
"RTN","IBCNBMI",144,0)
 ;;61.11^2.07^Emp Zip Code^1          ; Employer Claims Zip Code
"RTN","IBCNBMI",145,0)
 ;;61.12^2.08^Emp Phone^              ; Employer Claims Phone
"RTN","IBCNBMI",146,0)
 ;
"RTN","IBCNBMI",147,0)
POLA ; auto set fields
"RTN","IBCNBMI",148,0)
 ;;1.03^NOW^                          ; Date Last Verified (default is person that accepts entry)
"RTN","IBCNBMI",149,0)
 ;;1.04^DUZ^                          ; Verified By        (default is person that accepts entry)
"RTN","IBCNBMI",150,0)
 ;;1.05^NOW^                          ; Date Last Edited
"RTN","IBCNBMI",151,0)
 ;;1.06^DUZ^                          ; Last Edited By
"RTN","IBCNBMI",152,0)
 ;
"RTN","IBCNBMI",153,0)
 ;
"RTN","IBCNBMI",154,0)
POLOTH(IBBUFDA,IBPOLDA) ; other special cases that can not be transfered using the genaric code above, usually because of dependencys
"RTN","IBCNBMI",155,0)
 N IB0 S IB0=$G(^IBA(355.33,+IBBUFDA,0))
"RTN","IBCNBMI",156,0)
 ;
"RTN","IBCNBMI",157,0)
 ;  --- if buffer entry was verified before the accept step, then add the correct verifier info to the policy
"RTN","IBCNBMI",158,0)
 I +$P(IB0,U,10) D
"RTN","IBCNBMI",159,0)
 . S IBCHNG(2.312,IBPOLDA,1.03)=$E($P(IB0,U,10),1,12),IBCHNGN(2.312,IBPOLDA,1.03)=""
"RTN","IBCNBMI",160,0)
 . S IBCHNG(2.312,IBPOLDA,1.04)=$P(IB0,U,11),IBCHNGN(2.312,IBPOLDA,1.04)=""
"RTN","IBCNBMI",161,0)
 ;
"RTN","IBCNBMI",162,0)
 I $D(IBCHNGN)>9 D FILE^DIE("I","IBCHNGN","IBERR")
"RTN","IBCNBMI",163,0)
 I $D(IBCHNG)>9 D FILE^DIE("I","IBCHNG","IBERR")
"RTN","IBCNBMI",164,0)
 Q
"VER")
8.0^22.0
**END**
**END**
