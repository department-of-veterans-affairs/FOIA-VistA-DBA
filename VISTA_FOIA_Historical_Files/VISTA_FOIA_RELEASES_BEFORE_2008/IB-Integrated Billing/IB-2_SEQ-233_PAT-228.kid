Released IB*2*228 SEQ #233
Extracted from mail message
**KIDS**:IB*2.0*228^

**INSTALL NAME**
IB*2.0*228
"BLD",4958,0)
IB*2.0*228^INTEGRATED BILLING^0^3040225^y
"BLD",4958,1,0)
^^1^1^3031231^
"BLD",4958,1,1,0)
ENHANCEMENT FOR BILLING AWARENESS PTF
"BLD",4958,4,0)
^9.64PA^^
"BLD",4958,"KRN",0)
^9.67PA^8989.52^19
"BLD",4958,"KRN",.4,0)
.4
"BLD",4958,"KRN",.401,0)
.401
"BLD",4958,"KRN",.402,0)
.402
"BLD",4958,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",4958,"KRN",.402,"NM",1,0)
IB SCREEN4    FILE #399^399^0
"BLD",4958,"KRN",.402,"NM","B","IB SCREEN4    FILE #399",1)

"BLD",4958,"KRN",.403,0)
.403
"BLD",4958,"KRN",.5,0)
.5
"BLD",4958,"KRN",.84,0)
.84
"BLD",4958,"KRN",3.6,0)
3.6
"BLD",4958,"KRN",3.8,0)
3.8
"BLD",4958,"KRN",9.2,0)
9.2
"BLD",4958,"KRN",9.8,0)
9.8
"BLD",4958,"KRN",9.8,"NM",0)
^9.68A^8^5
"BLD",4958,"KRN",9.8,"NM",4,0)
IBCSC4A^^0^B31464103
"BLD",4958,"KRN",9.8,"NM",5,0)
IBCSC4B^^0^B35935966
"BLD",4958,"KRN",9.8,"NM",6,0)
IBCU7^^0^B53606380
"BLD",4958,"KRN",9.8,"NM",7,0)
IBCU74^^0^B12737396
"BLD",4958,"KRN",9.8,"NM",8,0)
IBBAPI^^0^B39569558
"BLD",4958,"KRN",9.8,"NM","B","IBBAPI",8)

"BLD",4958,"KRN",9.8,"NM","B","IBCSC4A",4)

"BLD",4958,"KRN",9.8,"NM","B","IBCSC4B",5)

"BLD",4958,"KRN",9.8,"NM","B","IBCU7",6)

"BLD",4958,"KRN",9.8,"NM","B","IBCU74",7)

"BLD",4958,"KRN",19,0)
19
"BLD",4958,"KRN",19.1,0)
19.1
"BLD",4958,"KRN",101,0)
101
"BLD",4958,"KRN",409.61,0)
409.61
"BLD",4958,"KRN",771,0)
771
"BLD",4958,"KRN",870,0)
870
"BLD",4958,"KRN",8989.51,0)
8989.51
"BLD",4958,"KRN",8989.52,0)
8989.52
"BLD",4958,"KRN",8994,0)
8994
"BLD",4958,"KRN","B",.4,.4)

"BLD",4958,"KRN","B",.401,.401)

"BLD",4958,"KRN","B",.402,.402)

"BLD",4958,"KRN","B",.403,.403)

"BLD",4958,"KRN","B",.5,.5)

"BLD",4958,"KRN","B",.84,.84)

"BLD",4958,"KRN","B",3.6,3.6)

"BLD",4958,"KRN","B",3.8,3.8)

"BLD",4958,"KRN","B",9.2,9.2)

"BLD",4958,"KRN","B",9.8,9.8)

"BLD",4958,"KRN","B",19,19)

"BLD",4958,"KRN","B",19.1,19.1)

"BLD",4958,"KRN","B",101,101)

"BLD",4958,"KRN","B",409.61,409.61)

"BLD",4958,"KRN","B",771,771)

"BLD",4958,"KRN","B",870,870)

"BLD",4958,"KRN","B",8989.51,8989.51)

"BLD",4958,"KRN","B",8989.52,8989.52)

"BLD",4958,"KRN","B",8994,8994)

"BLD",4958,"QUES",0)
^9.62^^
"BLD",4958,"REQB",0)
^9.611^4^3
"BLD",4958,"REQB",2,0)
DG*5.3*517^2
"BLD",4958,"REQB",3,0)
IB*2.0*245^2
"BLD",4958,"REQB",4,0)
IB*2.0*256^2
"BLD",4958,"REQB","B","DG*5.3*517",2)

"BLD",4958,"REQB","B","IB*2.0*245",3)

"BLD",4958,"REQB","B","IB*2.0*256",4)

"KRN",.402,1074,-1)
0^1
"KRN",.402,1074,0)
IB SCREEN4^3040123.2228^@^399^^@^3040224
"KRN",.402,1074,"DIAB",1,1,399.04,0)
ALL
"KRN",.402,1074,"DIAB",1,1,399.048,0)
OTHER CARE;"SNF/SA CARE"
"KRN",.402,1074,"DIAB",8,0,399,0)
OTHER CARE;"SNF/SA CARE"
"KRN",.402,1074,"DR",1,399)
S:IBDR20'["41" Y="@42";I $P($G(^DGCR(399,DA,0)),U,8) S Y="@411";159.5;@411;160;159;158;48SNF/SA CARE~;@42;S:IBDR20'["42" Y="@43";162;@43;@45;@46;S:IBDR20'["46" Y="@47";41;@47;S:IBDR20'["47" Y="@44";40;@44;S:IBDR20'["44" Y="@48";
"KRN",.402,1074,"DR",1,399,1)
S IBZ20=$P(^DGCR(399,DA,0),U,9);.09;S IBPROT=X;D PRO^IBCSC4B;S IBASKCOD=1;@48;S:IBDR20'["48" Y="@49";I $P(^DGCR(399,DA,0),U,19)=2 S Y="@49";47;@49;
"KRN",.402,1074,"DR",2,399.04)
.01
"KRN",.402,1074,"DR",2,399.041)
.01;.02;I $P(^DGCR(399,DA(1),0),U,19)'=2 S Y="@454";.03;S Y="@455";@454;I '$P(^DGCR(399.1,+^DGCR(399,DA(1),"OC",DA,0),0),U,10) S Y="@455";.04;@455;
"KRN",.402,1074,"DR",2,399.047)
.01;.02;
"KRN",.402,1074,"DR",2,399.048)
.01SNF/SA CARE~;.02;.03;S DGRVRCAL=1;
"KRN",.402,1074,"ROU")
^IBXSC4
"KRN",.402,1074,"ROUOLD")
IBXSC4
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)

"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
228^3040225
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3040225
"PKG",200,22,1,"PAH",1,1,1,0)
ENHANCEMENT FOR BILLING AWARENESS PTF
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","IBBAPI")
0^8^B39569558
"RTN","IBBAPI",1,0)
IBBAPI ;OAK/ELZ - APIS FOR OTHER PACKAGES TO QUERY INSURANCE INFO; 6-MAY-2003
"RTN","IBBAPI",2,0)
 ;;2.0;INTEGRATED BILLING;**256,228**;21-MAR-94
"RTN","IBBAPI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBBAPI",4,0)
 ;
"RTN","IBBAPI",5,0)
INSUR(DFN,IBDT,IBSTAT,IBR,IBFLDS) ; Return Patient Insurance Information
"RTN","IBBAPI",6,0)
 ; --Input:
"RTN","IBBAPI",7,0)
 ;   DFN    = patient
"RTN","IBBAPI",8,0)
 ;   IBDT   = date insured (optional - default is today's date)
"RTN","IBBAPI",9,0)
 ;   IBSTAT = Insurance Status filter (combinable based on groups below)
"RTN","IBBAPI",10,0)
 ;      Group 1
"RTN","IBBAPI",11,0)
 ;          A = Inactive included (Default is active only)
"RTN","IBBAPI",12,0)
 ;      Group 2
"RTN","IBBAPI",13,0)
 ;          R = Not reimbursable included (Default is reimbursable only)
"RTN","IBBAPI",14,0)
 ;          B = Indemnity included (Default is not included)
"RTN","IBBAPI",15,0)
 ;      Group 3
"RTN","IBBAPI",16,0)
 ;          P = Prescription coverage required (Default is all coverages)
"RTN","IBBAPI",17,0)
 ;          O = Outpatient coverage reqiured (Default is all coverages)
"RTN","IBBAPI",18,0)
 ;          I = Inpatient coverage only (Default is all coverages)
"RTN","IBBAPI",19,0)
 ;
"RTN","IBBAPI",20,0)
 ;   IBR    = Array to return insurance information - passed by reference
"RTN","IBBAPI",21,0)
 ;   IBFLDS = Lists of fields to return (1-17) in a comma separated list
"RTN","IBBAPI",22,0)
 ;
"RTN","IBBAPI",23,0)
 ; --Output:
"RTN","IBBAPI",24,0)
 ;   -1     = error occurred (error message passed back in
"RTN","IBBAPI",25,0)
 ;            IBR("IBBAPI","INSUR","ERROR",x) where x is error number
"RTN","IBBAPI",26,0)
 ;            between 101 & 111
"RTN","IBBAPI",27,0)
 ;    0     = No insurance found based on parameters
"RTN","IBBAPI",28,0)
 ;    1     = Insurance found
"RTN","IBBAPI",29,0)
 ;
"RTN","IBBAPI",30,0)
 N ERROR,ERRORT,FCNT,ICNT,INSP,N,N1,NOK,PASS,PASS1,X,%
"RTN","IBBAPI",31,0)
 K ERRORT D ERRORLD
"RTN","IBBAPI",32,0)
 S NOK=-1
"RTN","IBBAPI",33,0)
 S DFN=$G(DFN)
"RTN","IBBAPI",34,0)
 S IBSTAT=$G(IBSTAT)
"RTN","IBBAPI",35,0)
 S IBDT=$P($G(IBDT),".")
"RTN","IBBAPI",36,0)
 S IBFLDS=$G(IBFLDS)
"RTN","IBBAPI",37,0)
 I IBDT,IBSTAT["A" S ERROR=107 D ERROR Q NOK
"RTN","IBBAPI",38,0)
 S (ERROR,PASS)=0 K IBR
"RTN","IBBAPI",39,0)
 I 'DFN S ERROR=102 D ERROR Q NOK
"RTN","IBBAPI",40,0)
 I '$D(^DPT(DFN)) S ERROR=106 D ERROR Q NOK
"RTN","IBBAPI",41,0)
 I IBDT]"",IBDT'?7N S ERROR=104 D ERROR Q NOK
"RTN","IBBAPI",42,0)
 I +IBDT=0 D NOW^%DTC S IBDT=$P(%,".",1)
"RTN","IBBAPI",43,0)
 I IBSTAT]"" N Y F X=1:1:$L(IBSTAT) S Y=$E(IBSTAT,X) I '$F("^A^R^P^O^I^B^",(U_Y_U)) S ERROR=105 D ERROR Q
"RTN","IBBAPI",44,0)
 I ERROR=105 Q NOK
"RTN","IBBAPI",45,0)
 I IBFLDS]"",IBFLDS'="*" N Y F X=1:1:$L(IBFLDS,",") D
"RTN","IBBAPI",46,0)
 . S Y=$P(IBFLDS,",",X)
"RTN","IBBAPI",47,0)
 . I Y'?1N.N S ERROR=103
"RTN","IBBAPI",48,0)
 . I Y?1N.N,(Y<1)!(Y>17) S ERROR=103
"RTN","IBBAPI",49,0)
 I ERROR=103 D ERROR Q NOK
"RTN","IBBAPI",50,0)
 K IBR
"RTN","IBBAPI",51,0)
 S (ICNT,N)=0 F  S N=$O(^DPT(DFN,.312,N)) Q:'N  I $D(^(N,0)) D
"RTN","IBBAPI",52,0)
 . S X=^DPT(DFN,.312,N,0)
"RTN","IBBAPI",53,0)
 . N X1
"RTN","IBBAPI",54,0)
 . S X1=$G(^DIC(36,+X,0)) I X1="" Q  ; no insurance company entry
"RTN","IBBAPI",55,0)
 . S INSP=$P(X,U,1)
"RTN","IBBAPI",56,0)
 . I IBSTAT'["R",$P(X1,U,2)="N" Q  ; does not reimburse
"RTN","IBBAPI",57,0)
 . I IBSTAT'["B",$$INDEM^IBCNS1(X) Q  ; indemity policy
"RTN","IBBAPI",58,0)
 . S PASS1=0
"RTN","IBBAPI",59,0)
 . I IBSTAT'["A" D
"RTN","IBBAPI",60,0)
 . . I $P(X,U,8),IBDT<$P(X,U,8) S PASS1=1 Q  ;effective after care date
"RTN","IBBAPI",61,0)
 . . I $P(X,U,4),IBDT>$P(X,U,4) S PASS1=1 Q  ;terminated before care date
"RTN","IBBAPI",62,0)
 . . I $P($G(^IBA(355.3,+$P(X,U,18),0)),U,11) S PASS1=1 Q  ;inactive plan
"RTN","IBBAPI",63,0)
 . Q:PASS1
"RTN","IBBAPI",64,0)
 . S ICNT=ICNT+1
"RTN","IBBAPI",65,0)
 . S FCNT=$S(IBFLDS="*":17,1:$L(IBFLDS,",")) ; number of fields to pull
"RTN","IBBAPI",66,0)
 . I IBFLDS="" S IBR("IBBAPI","INSUR",ICNT)=""  Q  ;no field info to pass
"RTN","IBBAPI",67,0)
 . F N1=1:1:FCNT D
"RTN","IBBAPI",68,0)
 . . N RET,RETVAL
"RTN","IBBAPI",69,0)
 . . S RET=$S(IBFLDS="*":N1,1:$P(IBFLDS,",",N1)),RETVAL="" I RET?1N.N,RET>0,RET<18 D @RET S IBR("IBBAPI","INSUR",ICNT,RET)=RETVAL
"RTN","IBBAPI",70,0)
 . I IBSTAT["P"!(IBSTAT["O")!(IBSTAT["I") D  I PASS1=0 K IBR("IBBAPI","INSUR",ICNT) S ICNT=ICNT-1
"RTN","IBBAPI",71,0)
 . . S PASS1=0
"RTN","IBBAPI",72,0)
 . . I IBSTAT["P",+$$PTCOV(DFN,IBDT,"PHARMACY")>0 S PASS1=1
"RTN","IBBAPI",73,0)
 . . I IBSTAT["O",+$$PTCOV(DFN,IBDT,"OUTPATIENT")>0 S PASS1=1
"RTN","IBBAPI",74,0)
 . . I IBSTAT["I",+$$PTCOV(DFN,IBDT,"INPATIENT")>0 S PASS1=1
"RTN","IBBAPI",75,0)
 I $D(IBR("IBBAPI","INSUR")),$O(IBR("IBBAPI","INSUR",0))'="ERROR" S PASS=1 F X=1:1 Q:'$D(IBR("IBBAPI","INSUR",X))  K:'$O(IBR("IBBAPI","INSUR",X,"")) IBR("IBBAPI","INSUR",X)
"RTN","IBBAPI",76,0)
 Q PASS
"RTN","IBBAPI",77,0)
ERRORLD ;  load error array
"RTN","IBBAPI",78,0)
 F X=1:1:9 S ERRORT(X+100)=$P($T(ERRORLD1+X),";;",2)
"RTN","IBBAPI",79,0)
 Q
"RTN","IBBAPI",80,0)
 ;
"RTN","IBBAPI",81,0)
ERRORLD1 ; error messages
"RTN","IBBAPI",82,0)
 ;;DATABASE IS UNAVAILABLE
"RTN","IBBAPI",83,0)
 ;;PATIENT ID IS REQUIRED
"RTN","IBBAPI",84,0)
 ;;INVALID FIELD LIST
"RTN","IBBAPI",85,0)
 ;;INVALID EFFECTIVE DATE
"RTN","IBBAPI",86,0)
 ;;INVALID INSURANCE STATUS FILTER
"RTN","IBBAPI",87,0)
 ;;INVALID PATIENT ID
"RTN","IBBAPI",88,0)
 ;;INVALID COMBINATION, YOU CANNOT USE ""A"" WITH A DATE
"RTN","IBBAPI",89,0)
 ;;DATA SOURCE IS NOT DEFINED
"RTN","IBBAPI",90,0)
 ;;NO DATA ELEMENTS TO STORE
"RTN","IBBAPI",91,0)
 ;;
"RTN","IBBAPI",92,0)
ERROR ;
"RTN","IBBAPI",93,0)
 K IBR S IBR("IBBAPI","INSUR","ERROR",ERROR)=ERRORT(ERROR)
"RTN","IBBAPI",94,0)
 Q
"RTN","IBBAPI",95,0)
 ;
"RTN","IBBAPI",96,0)
1 ; Ins. Comp. name
"RTN","IBBAPI",97,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",.01,"I")_U_$$GET1^DIQ(2.312,N_","_DFN_",",.01)
"RTN","IBBAPI",98,0)
 Q
"RTN","IBBAPI",99,0)
2 ; Ins. Comp. Street Address Line 1
"RTN","IBBAPI",100,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.111)
"RTN","IBBAPI",101,0)
 Q
"RTN","IBBAPI",102,0)
3 ; Ins. Comp. City
"RTN","IBBAPI",103,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.114)
"RTN","IBBAPI",104,0)
 Q
"RTN","IBBAPI",105,0)
4 ; Ins. Comp. State
"RTN","IBBAPI",106,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.115,"I")_U_$$GET1^DIQ(36,INSP_",",.115)
"RTN","IBBAPI",107,0)
 Q
"RTN","IBBAPI",108,0)
5 ; Ins. Comp. Zip
"RTN","IBBAPI",109,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.116)
"RTN","IBBAPI",110,0)
 Q
"RTN","IBBAPI",111,0)
6 ; Ins. Comp. Phone
"RTN","IBBAPI",112,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.131)
"RTN","IBBAPI",113,0)
 Q
"RTN","IBBAPI",114,0)
7 ; Coordination of Benefits
"RTN","IBBAPI",115,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",.2,"I")_U_$$GET1^DIQ(2.312,N_","_DFN_",",.2)
"RTN","IBBAPI",116,0)
 I RETVAL="^" S RETVAL=""
"RTN","IBBAPI",117,0)
 Q
"RTN","IBBAPI",118,0)
8 ; Policy Name
"RTN","IBBAPI",119,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",.18,"I"),RETVAL=RETVAL_U_$$GET1^DIQ(355.3,RETVAL,.03)
"RTN","IBBAPI",120,0)
 Q
"RTN","IBBAPI",121,0)
9 ; Policy Reimbursable?
"RTN","IBBAPI",122,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",1,"I")
"RTN","IBBAPI",123,0)
 S RETVAL=$S(RETVAL="Y":"1^YES",RETVAL="*":"1^YES",RETVAL="**":"1^YES",RETVAL="":"1^YES",1:"0^NO")
"RTN","IBBAPI",124,0)
 Q
"RTN","IBBAPI",125,0)
10 ; Policy Effective Date
"RTN","IBBAPI",126,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",8,"I")
"RTN","IBBAPI",127,0)
 Q
"RTN","IBBAPI",128,0)
11 ; Policy Expiration Date
"RTN","IBBAPI",129,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",3,"I")
"RTN","IBBAPI",130,0)
 Q
"RTN","IBBAPI",131,0)
12 ; Subscriber Relationship
"RTN","IBBAPI",132,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",16,"I")
"RTN","IBBAPI",133,0)
 S RETVAL=$S(RETVAL="01":"P^PATIENT",RETVAL="02":"S^SPOUSE",1:"O^OTHER")
"RTN","IBBAPI",134,0)
 Q
"RTN","IBBAPI",135,0)
13 ; Subscriber Name
"RTN","IBBAPI",136,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",17)
"RTN","IBBAPI",137,0)
 Q
"RTN","IBBAPI",138,0)
14 ; Subscriber ID
"RTN","IBBAPI",139,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",1)
"RTN","IBBAPI",140,0)
 Q
"RTN","IBBAPI",141,0)
15 ; Pharmacy Coverage?
"RTN","IBBAPI",142,0)
 N IBCOV
"RTN","IBBAPI",143,0)
 S IBCOV=$$PTCOV(DFN,IBDT,"PHARMACY")
"RTN","IBBAPI",144,0)
 S RETVAL=$S(+IBCOV=0:"0^NO",1:"1^YES")
"RTN","IBBAPI",145,0)
 Q
"RTN","IBBAPI",146,0)
16 ; Outpatient Coverage?
"RTN","IBBAPI",147,0)
 N IBCOV
"RTN","IBBAPI",148,0)
 S IBCOV=$$PTCOV(DFN,IBDT,"OUTPATIENT")
"RTN","IBBAPI",149,0)
 S RETVAL=$S(+IBCOV=0:"0^NO",1:"1^YES")
"RTN","IBBAPI",150,0)
 Q
"RTN","IBBAPI",151,0)
17 ; Inpatient Coverage?
"RTN","IBBAPI",152,0)
 N IBCOV
"RTN","IBBAPI",153,0)
 S IBCOV=$$PTCOV(DFN,IBDT,"INPATIENT")
"RTN","IBBAPI",154,0)
 S RETVAL=$S(+IBCOV=0:"0^NO",1:"1^YES")
"RTN","IBBAPI",155,0)
 Q
"RTN","IBBAPI",156,0)
 ; following sub-routines copied from IBCNSU3
"RTN","IBBAPI",157,0)
 ; WLC - 11/26/2003
"RTN","IBBAPI",158,0)
PTCOV(DFN,IBVDT,IBCAT,ANYINS) ; Determine if patient is covered for coverage category on a visit dt
"RTN","IBBAPI",159,0)
 ; Function returns 1 if covered, 0 if not covered
"RTN","IBBAPI",160,0)
 ; DFN - ifn of patient (req)
"RTN","IBBAPI",161,0)
 ; IBVDT - fileman format visit date (req)
"RTN","IBBAPI",162,0)
 ; IBCAT - entry in file 355.31 limitation of coverage category (req)
"RTN","IBBAPI",163,0)
 ; ANYINS - optional parameter, but if passed by reference, returns 0 if
"RTN","IBBAPI",164,0)
 ;         no active insurance at all and 1 if any active insurance found
"RTN","IBBAPI",165,0)
 N IBCOV,IBDD,PLAN,POLCY
"RTN","IBBAPI",166,0)
 S (IBCOV,ANYINS)=0
"RTN","IBBAPI",167,0)
 I $G(DFN)=""!($G(IBCAT)="")!($G(IBVDT)="") G PTCOVQ ; Required fields not present
"RTN","IBBAPI",168,0)
 S IBCAT=$O(^IBE(355.31,"B",IBCAT,"")) G:IBCAT="" PTCOVQ
"RTN","IBBAPI",169,0)
 S IBVDT=IBVDT\1
"RTN","IBBAPI",170,0)
 D ALL^IBCNS1(DFN,"IBDD",1,IBVDT) ;All active ins policies returned in IBDD array
"RTN","IBBAPI",171,0)
 S ANYINS=($O(IBDD(0))'="") ;Set flag for any active insurance found
"RTN","IBBAPI",172,0)
 S POLCY=0 F  S POLCY=$O(IBDD(POLCY)) Q:'POLCY  D  Q:IBCOV
"RTN","IBBAPI",173,0)
 .S PLAN=$P($G(IBDD(POLCY,0)),U,18) Q:PLAN=""
"RTN","IBBAPI",174,0)
 .S IBCOV=$$PLCOV(PLAN,IBVDT,IBCAT)
"RTN","IBBAPI",175,0)
 .I 'IBCOV,$D(^IBA(355.7,"APP",DFN,POLCY,+$P($G(^IBE(355.31,+IBCAT,0)),U,3)))'=0 S IBCOV=1
"RTN","IBBAPI",176,0)
PTCOVQ Q IBCOV
"RTN","IBBAPI",177,0)
 ;
"RTN","IBBAPI",178,0)
PLCOV(IBPL,IBVDT,IBCAT,COMMENT) ; Determine if a specific plan covers a category of coverage as of a date and returns comments
"RTN","IBBAPI",179,0)
 ; IBPL - pointer to file 355.3 group insurance plan (req)
"RTN","IBBAPI",180,0)
 ; IBVDT - fileman format visit date (req)
"RTN","IBBAPI",181,0)
 ; IBCAT -  pointer to file 355.31 limitation of coverage category (req)
"RTN","IBBAPI",182,0)
 ; COMMENT - if passed by reference and the coverage is conditional will contain limitation comments
"RTN","IBBAPI",183,0)
 N CATLIM,X,Y K COMMENT
"RTN","IBBAPI",184,0)
 S CATLIM=$O(^IBA(355.32,"APCD",IBPL,IBCAT,+$O(^IBA(355.32,"APCD",IBPL,IBCAT,-(IBVDT+1))),""))
"RTN","IBBAPI",185,0)
 S X=$S(CATLIM="":1,1:+$P($G(^IBA(355.32,CATLIM,0)),U,4))
"RTN","IBBAPI",186,0)
 I X>1 S COMMENT=CATLIM,Y=0 F  S Y=$O(^IBA(355.32,CATLIM,2,Y)) Q:'Y  S COMMENT(Y)=$G(^IBA(355.32,CATLIM,2,Y,0))
"RTN","IBBAPI",187,0)
 Q X
"RTN","IBBAPI",188,0)
 ;
"RTN","IBCSC4A")
0^4^B31464103
"RTN","IBCSC4A",1,0)
IBCSC4A ;ALB/MJB - MCCR PTF SCREEN  ;24 FEB 89 9:49
"RTN","IBCSC4A",2,0)
 ;;2.0;INTEGRATED BILLING;**106,228**;21-MAR-94
"RTN","IBCSC4A",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCSC4A",4,0)
 ;
"RTN","IBCSC4A",5,0)
 ;MAP TO DGCRSC4A
"RTN","IBCSC4A",6,0)
 ;
"RTN","IBCSC4A",7,0)
DX Q:'$D(^DGPT(+IBPTF,0))  S (IBDXC,IBOPC)=0,IBNC="NO DX CODES ENTERED FOR THIS DATE" K ^UTILITY($J,"IBDX")
"RTN","IBCSC4A",8,0)
 ;F I=0:0 S I=$O(^DGPT(IBPTF,"M","AM",I)) Q:I'>0  S X=$O(^DGPT(IBPTF,"M","AM",I,0)),IBDX((9999999-$P(I,".",1)),X)=""
"RTN","IBCSC4A",9,0)
 ;I '$D(^DGPT(IBPTF,"M","AM")) S IBDX(9999999-DT,1)=""
"RTN","IBCSC4A",10,0)
 ;S IBDIA=0 F I=1:1:26 S IBDIA=$O(IBDX(IBDIA)) Q:IBDIA=""  S X=$O(IBDX(IBDIA,0)),M=$S($D(^DGPT(IBPTF,"M",X,0)):^(0),1:"") I M]"" S IBCT=0 F J=5:1:9 S:$P(M,U,J)]"" IBCT=IBCT+1,^UTILITY($J,"IBDX",I,IBCT)=$P(M,U,J) D:J=5 T
"RTN","IBCSC4A",11,0)
 ;S IBDIA="" F I=1:1:13 S IBDIA=$O(^UTILITY($J,"IBDX",IBDIA)) Q:IBDIA=""  D ODD S IBDIA=$O(^UTILITY($J,"IBDX",IBDIA)) D:IBDIA]"" EVEN D SETD^IBCSC4C Q:IBDIA']""
"RTN","IBCSC4A",12,0)
 ;
"RTN","IBCSC4A",13,0)
PRO S IBNC="NO PRO CODES ENTERED FOR THIS DATE",IBOPC=0 K ^UTILITY($J,"IB"),^TMP("IBTYPE",$J)
"RTN","IBCSC4A",14,0)
 F I=0:0 S I=$O(^DGPT(IBPTF,"S",I)) Q:I'>0  S J=$S($D(^DGPT(IBPTF,"S",I,0)):^(0),1:"") I J]"" S X=+J,X=$S(X[".":9999999-X,1:(9999999_"."_I)-X),IBOP(X)=$P(J,U)_U_$P(J,U,8,12)
"RTN","IBCSC4A",15,0)
 F I=0:0 S I=$O(^DGPT(IBPTF,"P",I)) Q:I'>0  S J=$S($D(^DGPT(IBPTF,"P",I,0)):^(0),1:"") I J]"" S X=+J,X=$S(X[".":9999999-X,1:(9999999_"."_I)-X),IBSP(X)=$P(J,U)_U_$P(J,U,5,9)
"RTN","IBCSC4A",16,0)
 S IBP=0 F I=1:1:26 S IBP=$O(IBOP(IBP)) Q:IBP=""  S M=IBOP(IBP),IBCT=0 F J=2:1:6 Q:IBCT=3  S:$P(M,U,J)]"" IBCT=IBCT+1,^UTILITY($J,"IB",I,IBCT)=$P(M,U,J) D:J=2 TP
"RTN","IBCSC4A",17,0)
 I I<26 S IBP="" F I=I:1:26 S IBP=$O(IBSP(IBP)) Q:IBP=""  S M=IBSP(IBP),IBCT=0 F J=2:1:6 Q:IBCT=3  S:$P(M,U,J)]"" IBCT=IBCT+1 D:$P(M,U,J)]"" T1 D:J=2 T2
"RTN","IBCSC4A",18,0)
 D PTFPS(DFN,IBPTF,+IB("U"),$P(IB("U"),"^",2))
"RTN","IBCSC4A",19,0)
 S IBP="" F I=1:1:13 S IBP=$O(^UTILITY($J,"IB",IBP)) Q:IBP=""  D ODDP S IBP=$O(^UTILITY($J,"IB",IBP)) D:IBP]"" EVENP D SETP^IBCSC4C Q:IBP=""
"RTN","IBCSC4A",20,0)
 Q
"RTN","IBCSC4A",21,0)
 ;
"RTN","IBCSC4A",22,0)
T I IBCT>0 S IBDXC=IBDXC+1,^UTILITY($J,"IBDX",I,IBCT)=^UTILITY($J,"IBDX",I,IBCT)_U_$P($P(M,U,10),".",1)_U_$C(64+IBDXC)_U_$P(M,U,2)_"^"_$S(X'=1:"",'$D(^DGPT(IBPTF,70)):"",1:"D/C")_"^"_$$SC(M) Q
"RTN","IBCSC4A",23,0)
 S ^UTILITY($J,"IBDX",I,1)=IBNC_U_$P($P(M,U,10),".",1)_"^^"_$P(^DGPT(IBPTF,"M",X,0),U,2)_"^^"_$$SC(M) Q
"RTN","IBCSC4A",24,0)
 ;
"RTN","IBCSC4A",25,0)
ODD S X=^UTILITY($J,"IBDX",IBDIA,1),IBWO(0)=$P(X,U,3)_U_$P(X,U,2)_U_$P(X,U,4,6),IBWO(1)=$P(X,U,1) F M=2:1:5 S IBWO(M)=$S($D(^UTILITY($J,"IBDX",IBDIA,M)):^(M),1:"")
"RTN","IBCSC4A",26,0)
 Q
"RTN","IBCSC4A",27,0)
 ;
"RTN","IBCSC4A",28,0)
EVEN S X=^UTILITY($J,"IBDX",IBDIA,1),IBWE(0)=$P(X,U,3)_U_$P(X,U,2)_U_$P(X,U,4,6),IBWE(1)=$P(X,U,1) F M=2:1:5 S IBWE(M)=$S($D(^UTILITY($J,"IBDX",IBDIA,M)):^(M),1:"")
"RTN","IBCSC4A",29,0)
 I $P(IBWE(0),U,1)']"" F M=1:1:5 S IBWE(M)=""
"RTN","IBCSC4A",30,0)
 Q
"RTN","IBCSC4A",31,0)
 ;
"RTN","IBCSC4A",32,0)
TP I IBCT>0 S IBOPC=IBOPC+1,^UTILITY($J,"IB",I,IBCT)=^UTILITY($J,"IB",I,IBCT)_U_$P(+M,".",1)_U_$C(64+IBOPC) Q
"RTN","IBCSC4A",33,0)
 S ^UTILITY($J,"IB",I,1)=IBNC_U_$P(+M,".",1) Q
"RTN","IBCSC4A",34,0)
T1 S ^UTILITY($J,"IB",I,IBCT)=$P(M,U,J) Q
"RTN","IBCSC4A",35,0)
T2 I IBCT>0 S IBOPC=IBOPC+1,^UTILITY($J,"IB",I,IBCT)=^UTILITY($J,"IB",I,IBCT)_U_$P($P(M,U,1),".",1)_U_$C(64+IBOPC)_U_"*" Q
"RTN","IBCSC4A",36,0)
 S ^UTILITY($J,"IB",I,1)=IBNC_U_$P($P(M,U,1),".",1)_"^^*" Q
"RTN","IBCSC4A",37,0)
 ;
"RTN","IBCSC4A",38,0)
ODDP S X=^UTILITY($J,"IB",IBP,1),IBWO(0)=$P(X,U,3)_U_$P(X,U,2)_U_$S($P(X,U,4)="*":"*",$P(X,U,4)="+":"+",1:""),IBWO(1)=$P(X,U,1)_"^"_$P(X,"^",5,13) F M=2:1:5 S IBWO(M)=$S($D(^UTILITY($J,"IB",IBP,M)):^(M),1:"")
"RTN","IBCSC4A",39,0)
 Q
"RTN","IBCSC4A",40,0)
 ;
"RTN","IBCSC4A",41,0)
EVENP S X=^UTILITY($J,"IB",IBP,1),IBWE(0)=$P(X,U,3)_U_$P(X,U,2)_U_$S($P(X,U,4)="*":"*",$P(X,U,4)="+":"+",1:""),IBWE(1)=$P(X,U,1)_"^"_$P(X,"^",5,13) F M=2:1:5 S IBWE(M)=$S($D(^UTILITY($J,"IB",IBP,M)):^(M),1:"")
"RTN","IBCSC4A",42,0)
 Q
"RTN","IBCSC4A",43,0)
 ;
"RTN","IBCSC4A",44,0)
NUL F I=1:1:13 S $P(^DGCR(399,IBIFN,"C"),U,I)=""
"RTN","IBCSC4A",45,0)
 Q
"RTN","IBCSC4A",46,0)
 ;
"RTN","IBCSC4A",47,0)
P S M=($A($E(X,1))-64),S=$E(X,2),IB5=$S($D(^UTILITY($J,"IB",M,S)):^(S),1:"") I IB5]"" Q:$P(^UTILITY($J,"IB",M,1),U,3)=$E(X,1)
"RTN","IBCSC4A",48,0)
 F J=M:1:26 Q:'$D(^UTILITY($J,"IB",J))  I $P(^UTILITY($J,"IB",J,1),U,3)=$E(X,1) S M=J,IBA=1 Q
"RTN","IBCSC4A",49,0)
 S:'$D(IBA) M=0 K IBA Q
"RTN","IBCSC4A",50,0)
D S M=($A($E(X,1))-64),S=$E(X,2),IB4=$S($D(^UTILITY($J,"IBDX",M,S)):^(S),1:"") I IB4]"" Q:$P(^UTILITY($J,"IBDX",M,1),U,3)=$E(X,1)
"RTN","IBCSC4A",51,0)
 F J=M:1:26 Q:'$D(^UTILITY($J,"IBDX",J))  I $P(^UTILITY($J,"IBDX",J,1),U,3)=$E(X,1) S M=J,IBA=1 Q
"RTN","IBCSC4A",52,0)
 S:'$D(IBA) M=0 K IBA Q
"RTN","IBCSC4A",53,0)
 ;
"RTN","IBCSC4A",54,0)
SC(M) ;  - check SC flag of movement
"RTN","IBCSC4A",55,0)
 ;    input movement node
"RTN","IBCSC4A",56,0)
 ;    output flag as to whether sc or not
"RTN","IBCSC4A",57,0)
 I '$D(M) Q ""
"RTN","IBCSC4A",58,0)
 I M="" Q ""
"RTN","IBCSC4A",59,0)
 Q $S($P(M,"^",18)=1:"<SC>",1:"<NSC>")
"RTN","IBCSC4A",60,0)
 ;
"RTN","IBCSC4A",61,0)
PTFPS(DFN,IBPTF,IBFDT,IBTDT) ; this will return a list of professional
"RTN","IBCSC4A",62,0)
 ; services from the ptf records.  If no date range specified, then
"RTN","IBCSC4A",63,0)
 ; it will return all services for that ptf entry.
"RTN","IBCSC4A",64,0)
 ;  return:  ^utility($j,"IB",count for event,count for procedures) =
"RTN","IBCSC4A",65,0)
 ;           pices: 1 = procedure
"RTN","IBCSC4A",66,0)
 ;                  2 = date (only if new date)
"RTN","IBCSC4A",67,0)
 ;                  3 = sequentual grouping letter (only if new date) 
"RTN","IBCSC4A",68,0)
 ;                  4 = "+" to flag as CPT 4 procedure
"RTN","IBCSC4A",69,0)
 ;                  5 = if exemption applicable, info for that
"RTN","IBCSC4A",70,0)
 ;                6-9 = assoc dx in order
"RTN","IBCSC4A",71,0)
 ;                 10 = quantity
"RTN","IBCSC4A",72,0)
 ;              11-12 = modifiers
"RTN","IBCSC4A",73,0)
 ;                 13 = provider
"RTN","IBCSC4A",74,0)
 ;                 14 = location
"RTN","IBCSC4A",75,0)
 ;
"RTN","IBCSC4A",76,0)
 ; the exemption information returned will be first evaluated at the
"RTN","IBCSC4A",77,0)
 ; dx level and if nothing there to exempt, it will be at the procedure
"RTN","IBCSC4A",78,0)
 ; level.
"RTN","IBCSC4A",79,0)
 ;
"RTN","IBCSC4A",80,0)
 N IBX,IBY,IBDT,IBXX,IBP,IBC,IBRMARK,IBDX,IBDXX,IBPP,IB46
"RTN","IBCSC4A",81,0)
 K ^TMP("PTF",$J),^TMP("IBPTFPS",$J)
"RTN","IBCSC4A",82,0)
 S IBFDT=$G(IBFDT),IBTDT=$G(IBTDT,9999999)_".99999"
"RTN","IBCSC4A",83,0)
 ;
"RTN","IBCSC4A",84,0)
 ; get starting place for ^utility global
"RTN","IBCSC4A",85,0)
 S IBC=+$O(^UTILITY($J,"IB",":"),-1)
"RTN","IBCSC4A",86,0)
 ;
"RTN","IBCSC4A",87,0)
 D PTFINFOR^DGAPI(DFN,IBPTF) I '$D(^TMP("PTF",$J)) G PTFPSQ
"RTN","IBCSC4A",88,0)
 ;
"RTN","IBCSC4A",89,0)
 S IBX=0 F  S IBX=$O(^TMP("PTF",$J,IBX)) Q:IBX<1  S IBY=^TMP("PTF",$J,IBX) I $S(IBFDT<+IBY&(IBTDT>+IBY):1,1:0) S ^TMP("IBPTFPS",$J,+IBY)=""
"RTN","IBCSC4A",90,0)
 I '$D(^TMP("IBPTFPS",$J)) G PTFPSQ
"RTN","IBCSC4A",91,0)
 ;
"RTN","IBCSC4A",92,0)
 K ^TMP("PTF",$J)
"RTN","IBCSC4A",93,0)
 D ICDINFO^DGAPI(DFN,IBPTF) ;get the dx's for the ptf
"RTN","IBCSC4A",94,0)
 ;
"RTN","IBCSC4A",95,0)
 S IBDT=0 F  S:'IBC!($D(^UTILITY($J,"IB",IBC))) IBC=IBC+1 S IBDT=$O(^TMP("IBPTFPS",$J,IBDT)) Q:IBDT<1  D
"RTN","IBCSC4A",96,0)
 . ;
"RTN","IBCSC4A",97,0)
 . S IBD=0
"RTN","IBCSC4A",98,0)
 . D CPTINFO^DGAPI(DFN,,IBDT) I '$D(^TMP("PTF",$J,46)) Q
"RTN","IBCSC4A",99,0)
 . S IB46=$P($G(^TMP("PTF",$J,46,0)),"^",2)_"^"_$P($G(^(0)),"^",4)
"RTN","IBCSC4A",100,0)
 . ;
"RTN","IBCSC4A",101,0)
 . S IBX=0 F  S IBX=$O(^TMP("PTF",$J,46,IBX)) Q:IBX<1  S IBY=^TMP("PTF",$J,46,IBX) D
"RTN","IBCSC4A",102,0)
 .. S IBRMARK=""
"RTN","IBCSC4A",103,0)
 .. F IBP=5:1:8,16:1:19 S IBDX=$P(IBY,"^",IBP),IBDXX=0 F  S IBDXX=$O(^TMP("PTF",$J,46.1,IBDXX)) Q:IBDXX<1!(IBRMARK)  I $P(^TMP("PTF",$J,46.1,IBDXX),"^",2)=IBDX D
"RTN","IBCSC4A",104,0)
 ... F IBPP=3:1:9 I $P(^TMP("PTF",$J,46.1,IBDXX),"^",IBPP) S IBRMARK=IBPP Q
"RTN","IBCSC4A",105,0)
 .. S IBD=IBD+1,^UTILITY($J,"IB",IBC,IBD)=$P(IBY,"^",2)_"^"_$S(IBD=1:$P(IBDT,".")_"^"_$C(IBC+64)_"^+^",1:"^^^")_$S(IBRMARK:$P($T(EXEMPT+(IBRMARK-2)),";",3),1:"")_"^"_$P(IBY,"^",5,8)_"^"_$P(IBY,"^",15)_"^"_$P(IBY,"^",3,4)_"^"_IB46
"RTN","IBCSC4A",106,0)
 . S IBD=0
"RTN","IBCSC4A",107,0)
 . K ^TMP("PTF",$J,46)
"RTN","IBCSC4A",108,0)
 ;
"RTN","IBCSC4A",109,0)
 ;
"RTN","IBCSC4A",110,0)
PTFPSQ K ^TMP("PTF",$J),^TMP("IBPTFPS",$J),^TMP("CPT",$J)
"RTN","IBCSC4A",111,0)
 Q
"RTN","IBCSC4A",112,0)
 ;
"RTN","IBCSC4A",113,0)
EXEMPT ; exemption reasons
"RTN","IBCSC4A",114,0)
 ;;SC
"RTN","IBCSC4A",115,0)
 ;;AO
"RTN","IBCSC4A",116,0)
 ;;IR
"RTN","IBCSC4A",117,0)
 ;;EC
"RTN","IBCSC4A",118,0)
 ;;MT
"RTN","IBCSC4A",119,0)
 ;;HC
"RTN","IBCSC4A",120,0)
 ;;CV
"RTN","IBCSC4A",121,0)
 ;
"RTN","IBCSC4B")
0^5^B35935966
"RTN","IBCSC4B",1,0)
IBCSC4B ;ALB/MJB - MCCR PTF SCREEN (CONT.) ;24 FEB 89  9:52
"RTN","IBCSC4B",2,0)
 ;;2.0;INTEGRATED BILLING;**210,228**;21-MAR-94
"RTN","IBCSC4B",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCSC4B",4,0)
 ;
"RTN","IBCSC4B",5,0)
 ;MAP TO DGCRSC4B
"RTN","IBCSC4B",6,0)
 ;
"RTN","IBCSC4B",7,0)
DX Q:$S(IBPTF="":1,'$D(^DGPT(IBPTF,0)):1,1:0)  S IBUC="UNSPECIFIED CODE",IBNC="NO DX CODES ENTERED FOR THIS DATE",IBDXC=0,X="DIAGNOSIS SCREEN" K IBWE,IBWO
"RTN","IBCSC4B",8,0)
 W @IOF,?(40-($L(X)\2)),X,! F I=1:1:79 W "="
"RTN","IBCSC4B",9,0)
 S IBDIA="" I '$D(^UTILITY($J,"IBDX")) W !!," * No DIAGNOSIS CODES in PTF record for this episode of care." D SELD^IBCSC4C G Q
"RTN","IBCSC4B",10,0)
 F I=1:1:13 S IBDIA=$O(^UTILITY($J,"IBDX",IBDIA)) Q:IBDIA=""  D ODD^IBCSC4A S IBDIA=$O(^UTILITY($J,"IBDX",IBDIA)) D:IBDIA]"" EVEN^IBCSC4A D WR D:$Y+6>IOSL ASK Q:IBDIA=""
"RTN","IBCSC4B",11,0)
 S IBDIA="" ; D SELD^IBCSC4C
"RTN","IBCSC4B",12,0)
 G Q
"RTN","IBCSC4B",13,0)
 ;
"RTN","IBCSC4B",14,0)
WR N IBDATE
"RTN","IBCSC4B",15,0)
 S IBDATE=$$PTFDATE^IBACSV(+$G(IBPTF)) ; Date to be used as a "date of service"
"RTN","IBCSC4B",16,0)
 I '$D(IBWE(0)) F B=0:1:5 S IBWE(B)=""
"RTN","IBCSC4B",17,0)
 W !!,"Move: " S Y=$P(IBWO(0),U,2) X ^DD("DD") W $S($P(IBWO(0),U,4)]"":$P(IBWO(0),U,4)_" ",1:""),Y," " W:$P(IBWO(0),"^",3)]"" $E($P(^DIC(42.4,$P(IBWO(0),U,3),0),U),1,12) W " ",$P(IBWO(0),"^",5)
"RTN","IBCSC4B",18,0)
 I IBDIA]"",IBWE(0)]"" W ?43,"Move: " S Y=$P(IBWE(0),U,2) X ^DD("DD") W $S($P(IBWE(0),U,4)]"":$P(IBWE(0),U,4)_" ",1:""),Y," " W:$P(IBWE(0),"^",3)]"" $E($P(^DIC(42.4,$P(IBWE(0),U,3),0),U),1,12) W " ",$P(IBWE(0),"^",5)
"RTN","IBCSC4B",19,0)
 S IBAO=$P(IBWO(0),U,1) I IBAO']"" W:'$D(IBDXY) !,"* ",IBNC S IBDXY=1 F K=1:1:5 S IBWO(K)="" I IBDIA]"" W:K>1 ! D WE Q:IBWO(K)=""&(IBWE(K)="")
"RTN","IBCSC4B",20,0)
 I IBAO]"" F K=1:1:5 Q:IBWO(K)=""&(IBWE(K)="")  D
"RTN","IBCSC4B",21,0)
 . W !
"RTN","IBCSC4B",22,0)
 . I IBWO(K) S X=$S($P(IBWO(0),"^",3)["+":$$CPT^IBACSV(+IBWO(K),IBDATE),1:$$ICD9^IBACSV(+IBWO(K),IBDATE)) D
"RTN","IBCSC4B",23,0)
 .. W IBAO,K," - ",$S(X]"":$J($P(X,U),6)_"  "_$E($S($P(IBWO(0),"^",3)["+":$P(X,U,2),1:$P(X,U,3)),1,24),1:IBUC)
"RTN","IBCSC4B",24,0)
 . I IBDIA'="" D WE
"RTN","IBCSC4B",25,0)
 Q
"RTN","IBCSC4B",26,0)
WE S IBAE=$P(IBWE(0),U)
"RTN","IBCSC4B",27,0)
 I IBAE="",'$D(IBDXX),IBWE(0)]"" W ?43,"* ",IBNC S (IBWE(1),IBWE(2),IBWE(3),IBWE(4),IBWE(5))="",IBDXX=1
"RTN","IBCSC4B",28,0)
 I IBAE]"",IBWE(K)]"" S X=$S($P(IBWE(0),"^",3)["+":$$CPT^IBACSV(+IBWE(K),$G(IBDATE)):1:$$ICD9^IBACSV(+IBWE(K),$G(IBDATE))) D
"RTN","IBCSC4B",29,0)
 . W ?43,IBAE,K," - ",$S(X]"":$J($P(X,U),6)_"  "_$E($S($P(IBWE(0),"^",3)["+":$P(X,U,2),1:$P(X,U,3)),1,24),1:IBUC)
"RTN","IBCSC4B",30,0)
 Q
"RTN","IBCSC4B",31,0)
ASK W !!,"<RETURN> to see more ",$S($D(IBP):"procedure",1:"diagnosis")," codes or '^' to QUIT: " R A:DTIME I '$T!(A["^") S:$D(IBDIA) IBDIA="" S:$D(IBP) IBP="" Q
"RTN","IBCSC4B",32,0)
 I A["?" W !!?4,"Enter <RETURN> to view more ",$S($D(IBP):"operation/procedure",1:"movement dates and diagnosis")," codes",!?4,"or '^' to stop the display." G ASK
"RTN","IBCSC4B",33,0)
 S A=$S($D(IBP):"OPERATION/PROCEDURE",1:"DIAGNOSIS")_" SCREEN (CONT.)" W !,@IOF,?(40-($L(A)\2)),A,! F S=1:1:79 W "="
"RTN","IBCSC4B",34,0)
 Q
"RTN","IBCSC4B",35,0)
PRO Q:'$D(IBPTF)  D TYPE S IBUC="UNSPECIFIED CODE",IBNC="NO PRO CODES ENTERED FOR THIS DATE",IBOPC=0,X="OPERATION/PROCEDURE SCREEN",IBNOR="Non-O/R Procedure Date: ",IBSD="Surgery Date: ",IBPRO="Prof Svc Date: "
"RTN","IBCSC4B",36,0)
 K IBWE,IBWO
"RTN","IBCSC4B",37,0)
 W @IOF,?(40-($L(X)\2)),X,! S X="",$P(X,"=",1,79)="" W X
"RTN","IBCSC4B",38,0)
 S IBP="" I '$D(^UTILITY($J,"IB")) W !!," * No PROCEDURE CODES in PTF record for this episode of care." G Q
"RTN","IBCSC4B",39,0)
 F I=1:1:13 S IBP=$O(^UTILITY($J,"IB",IBP)) Q:IBP=""  D ODDP^IBCSC4A S IBP=$O(^UTILITY($J,"IB",IBP)) D:IBP]"" EVENP^IBCSC4A D WRP D:$Y+6>IOSL ASK Q:IBP=""
"RTN","IBCSC4B",40,0)
 S IBP=""
"RTN","IBCSC4B",41,0)
Q K IB3,IB4,IB5,IB6,IB7,IB8,IB9,IBAE,IBAO,IBCT,IBDIA,IBDP,IBDX,IBDXC,IBDXX,IBDXY,IBI,IBNC,IBNOR,IBP,IBPY,IBOP,IBOPC,IBOPX,IBOPY,IBPP,IBPX,IBSD,IBSP,IBWE,IBWO,IBPRO,IBPROT
"RTN","IBCSC4B",42,0)
 K %DT,A,B,DIC,F,I,J,K,M,S,X,Y
"RTN","IBCSC4B",43,0)
 Q
"RTN","IBCSC4B",44,0)
WRP N IBDATE
"RTN","IBCSC4B",45,0)
 S IBDATE=$$PTFDATE^IBACSV(+$G(IBPTF)) ; Date to be used as a "date of service"
"RTN","IBCSC4B",46,0)
 I '$D(IBWE(0)) F B=0:1:5 S IBWE(B)=""
"RTN","IBCSC4B",47,0)
 W !!,$S($P(IBWO(0),U,3)["*":IBNOR,$P(IBWO(0),U,3)["+":IBPRO,1:IBSD) S Y=$P(IBWO(0),U,2) X ^DD("DD") W Y I IBP]"" W ?43,$S($P(IBWE(0),U,3)["*":IBNOR,$P(IBWO(0),U,3)["+":IBPRO,1:IBSD) S Y=$P(IBWE(0),U,2) X ^DD("DD") W Y
"RTN","IBCSC4B",48,0)
 S IBAO=$P(IBWO(0),U,1) I IBAO']"" W:'$D(IBOPY) !,"* ",IBNC S IBOPY=1 F K=1:1:5 S IBWO(K)="" I IBP]"" W:K>1 ! D WEP
"RTN","IBCSC4B",49,0)
 I IBAO]"" F K=1:1:5 Q:IBWO(K)']""&(IBWE(K)']"")  D
"RTN","IBCSC4B",50,0)
 . S X=$S($P(IBWO(0),U,3)["+":$$CPT^IBACSV(+IBWO(K),IBDATE),1:$$ICD0^IBACSV(+IBWO(K),IBDATE)) S:$P(IBWO(0),U,3)["+"&($L($G(^VA(200,+$P(IBWO(K),U,$S(K=1:10,1:13)),0)))) $P(X,U,2)="PROV-"_$P(^(0),U) D
"RTN","IBCSC4B",51,0)
 .. W:IBWO(K)]"" !,IBAO,K,"-",$S(X]"":$J($P(X,U,1),5)_$S($L($P(IBWO(K),"^",$S(K=1:2,1:5))):"("_$P(IBWO(K),"^",$S(K=1:2,1:5))_")",1:"    ")_$E($S($P(IBWO(0),U,3)["+":$P(X,U,2),1:$P(X,U,4)),1,24),1:IBUC) W:IBWO(K)']"" !,"" D:IBP]"" WEP
"RTN","IBCSC4B",52,0)
 Q
"RTN","IBCSC4B",53,0)
WEP S IBAE=$P(IBWE(0),U,1) I IBAE']"",'$D(IBOPX) W ?43,"* ",IBNC S (IBWE(1),IBWE(2),IBWE(3),IBWE(4),IBWE(5))="",IBOPX=1
"RTN","IBCSC4B",54,0)
 I IBAE]"",IBWE(K)]"" S X=$S($P(IBWE(0),"^",3)["+":$$CPT^IBACSV(+IBWE(K),$G(IBDATE)),1:$$ICD0^IBACSV(+IBWE(K),$G(IBDATE))) S:$P(IBWE(0),U,3)["+"&($L($G(^VA(200,+$P(IBWE(K),U,$S(K=1:10,1:13)),0)))) $P(X,U,2)="PROV-"_$P(^(0),U) D
"RTN","IBCSC4B",55,0)
 . W ?43,IBAE,K,"-",$S(X]"":$J($P(X,U,1),5)_$S($L($P(IBWE(K),"^",$S(K=1:2,1:5))):"("_$P(IBWE(K),"^",$S(K=1:2,1:5))_")",1:"    ")_$E($S($P(IBWE(0),"^",3)["+":$P(X,U,2),1:$P(X,U,4)),1,24),1:IBUC)
"RTN","IBCSC4B",56,0)
 Q
"RTN","IBCSC4B",57,0)
 ;
"RTN","IBCSC4B",58,0)
TYPE ; cleans up the ^utility based on the type of coding
"RTN","IBCSC4B",59,0)
 ; save in ^tmp
"RTN","IBCSC4B",60,0)
 N IBA,IBB,IBC,IBD,IBE
"RTN","IBCSC4B",61,0)
 I '$D(^TMP("IBTYPE",$J)) M ^TMP("IBTYPE",$J)=^UTILITY($J,"IB")
"RTN","IBCSC4B",62,0)
 K ^UTILITY($J,"IB")
"RTN","IBCSC4B",63,0)
 S (IBA,IBB)=0 F  S IBA=$O(^TMP("IBTYPE",$J,IBA)) Q:IBA<1  D
"RTN","IBCSC4B",64,0)
 . I $P($G(^TMP("IBTYPE",$J,IBA,1)),"^",4)["+",IBPROT=5 D  Q
"RTN","IBCSC4B",65,0)
 .. S IBB=IBB+1,(IBC,IBD)=0 F  S IBC=$O(^TMP("IBTYPE",$J,IBA,IBC)) Q:IBC<1  S IBE=^TMP("IBTYPE",$J,IBA,IBC),IBD=IBD+1,^UTILITY($J,"IB",IBB,IBD)=$P(IBE,"^",1,2)_"^"_$C(64+IBB)_"^"_$P(IBE,"^",4,14)
"RTN","IBCSC4B",66,0)
 . I $P($G(^TMP("IBTYPE",$J,IBA,1)),"^",4)["+" Q
"RTN","IBCSC4B",67,0)
 . I IBPROT'=5 S IBB=IBB+1,(IBC,IBD)=0 F  S IBC=$O(^TMP("IBTYPE",$J,IBA,IBC)) Q:IBC<1  D
"RTN","IBCSC4B",68,0)
 .. S IBE=^TMP("IBTYPE",$J,IBA,IBC),IBD=IBD+1,^UTILITY($J,"IB",IBB,IBD)=$P(IBE,"^",1)_$S(IBD=1:"^"_$P(IBE,"^",2)_"^"_$C(64+IBB)_$S($L($P(IBE,"^",4)):"^"_$P(IBE,"^",4),1:""),1:"")
"RTN","IBCSC4B",69,0)
 Q
"RTN","IBCU7")
0^6^B53606380
"RTN","IBCU7",1,0)
IBCU7 ;ALB/AAS - INTERCEPT SCREEN INPUT OF PROCEDURE CODES ;29-OCT-91
"RTN","IBCU7",2,0)
 ;;2.0;INTEGRATED BILLING;**62,52,106,125,51,137,210,245,228**;21-MAR-94
"RTN","IBCU7",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCU7",4,0)
 ;
"RTN","IBCU7",5,0)
 ;MAP TO DGCRU7
"RTN","IBCU7",6,0)
 ;
"RTN","IBCU7",7,0)
CHKX ;  -interception of input x from Additional Procedure input
"RTN","IBCU7",8,0)
 G:X=" " CHKXQ
"RTN","IBCU7",9,0)
 I $$INPAT^IBCEF(DA(1)),'$P($G(^IBE(350.9,1,1)),"^",15),X'?1A1N D  G CHKXQ
"RTN","IBCU7",10,0)
 . K X
"RTN","IBCU7",11,0)
 . D EN^DDIOL("Site param does not allow entry of non-PTF procedures") ;Fileman error here will be: The previous error occurred when performing an action specified in a Pre-lookup transform (7.5 node).
"RTN","IBCU7",12,0)
 G:'$D(^UTILITY($J,"IB")) CHKXQ
"RTN","IBCU7",13,0)
 S M=($A($E(X,1))-64),S=+$E(X,2) Q:'$G(^UTILITY($J,"IB",M,S))  S X="`"_+^(S)
"RTN","IBCU7",14,0)
 I $D(DGPROCDT),DGPROCDT'=$P($G(^UTILITY($J,"IB",M,1)),"^",2) S DGPROCDT=$P(^(1),"^",2) W !!,"Procedure Date: " S Y=DGPROCDT X ^DD("DD") W Y,!
"RTN","IBCU7",15,0)
CHKXQ Q
"RTN","IBCU7",16,0)
 ;
"RTN","IBCU7",17,0)
CODMUL ;Date oriented entry of procedure 
"RTN","IBCU7",18,0)
DELASK I $D(IBZ20),IBZ20,IBZ20'=$P(^DGCR(399,IBIFN,0),U,9) S %=2 W !,"SINCE THE PROCEDURE CODING METHOD HAS BEEN CHANGED, DO YOU WANT TO DELETE ALL",!,"PROCEDURE CODES IN THIS BILL"
"RTN","IBCU7",19,0)
 I  D YN^DICN Q:%=-1  D:%=1 DELADD I %Y?1."?" W !!,"If you answer 'Yes', all procedure codes will be DELETED from this bill.",! G DELASK
"RTN","IBCU7",20,0)
 K %,%Y,DA,IBZ20,DIK ;W !,"Procedure Entry:"
"RTN","IBCU7",21,0)
 ;
"RTN","IBCU7",22,0)
CODDT I $D(IBIFN),$D(^DGCR(399,IBIFN,0)),$P(^(0),U,9) S DIC("V")=$S($P(^(0),U,9)=9:"I +Y(0)=80.1",$P(^(0),U,9)=4!($P(^(0),U,9)=5):"I +Y(0)=81",1:"")
"RTN","IBCU7",23,0)
 I $P($G(^DGCR(399,IBIFN,0)),"^",5)<3 S IBZTYPE=1 I $P($G(^UTILITY($J,"IB",1,1)),"^",2) S DGPROCDT=$P(^(1),"^",2) D ASKCOD
"RTN","IBCU7",24,0)
 S X=$$PRCDIV^IBCU71(IBIFN) I +X W !!,$P(X,U,2),!
"RTN","IBCU7",25,0)
 N Z,Z0 S Z=$G(^DGCR(399,IBIFN,"U")),Z0=$$FMTE^XLFDT($P(Z,U),"2D")_"-"_$$FMTE^XLFDT($P(Z,U,2),"2D")
"RTN","IBCU7",26,0)
 W !,"Select PROCEDURE DATE"_$S($TR(Z0,"-")'="":" ("_Z0_")",1:"")_": " R X:DTIME G:'$T!("^"[X) CODQ D:X["?" CODHLP
"RTN","IBCU7",27,0)
 S IBEX=0 D  ; Get procedure date
"RTN","IBCU7",28,0)
 . I X=" ",$D(DGPROCDT),DGPROCDT?7N S Y=DGPROCDT D D^DIQ W "   (",Y,")" Q
"RTN","IBCU7",29,0)
 . I X=" ",+$P($G(^DGCR(399,IBIFN,"OP",0)),"^",4) S (DGPROCDT,Y)=$O(^DGCR(399,IBIFN,"OP",0)) D D^DIQ W "   (",Y,")" Q
"RTN","IBCU7",30,0)
 . S %DT="EXP",%DT(0)=-DT D ^%DT K %DT I Y<1 S IBEX=1 Q
"RTN","IBCU7",31,0)
 . I '$$OPV2^IBCU41(Y,IBIFN,1) S IBEX=1 Q
"RTN","IBCU7",32,0)
 . S:'$G(IBZTYPE) X=$$OPV^IBCU41(Y,IBIFN) S DGPROCDT=Y
"RTN","IBCU7",33,0)
 I 'IBEX D ASKCOD,ADDCPT^IBCU71:$D(DGCPT)
"RTN","IBCU7",34,0)
 K IBEX
"RTN","IBCU7",35,0)
 G CODDT
"RTN","IBCU7",36,0)
 ;
"RTN","IBCU7",37,0)
ASKCOD N Z,Z0,DA,IBACT,IBQUIT
"RTN","IBCU7",38,0)
 K DGCPT
"RTN","IBCU7",39,0)
 S DGCPT=0,DGCPTUP=$P($G(^IBE(350.9,1,1)),"^",19),DGADDVST=0,IBFT=$P($G(^DGCR(399,IBIFN,0)),"^",19)
"RTN","IBCU7",40,0)
 I '$D(^DGCR(399,IBIFN,"CP",0)) S ^DGCR(399,IBIFN,"CP",0)=U_$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCU7",41,0)
 ;
"RTN","IBCU7",42,0)
 F  S IBQUIT=0 D  Q:IBQUIT
"RTN","IBCU7",43,0)
 . S DIC("A")="   Select PROCEDURE: "
"RTN","IBCU7",44,0)
 . S DIC="^DGCR(399,"_IBIFN_",""CP"","
"RTN","IBCU7",45,0)
 . S DIC(0)="AEQMNL"
"RTN","IBCU7",46,0)
 . S DIC("S")="I '$D(DIV(""S""))&($P(^(0),U,2)=DGPROCDT)"
"RTN","IBCU7",47,0)
 . S DIC("DR")="1///^S X=DGPROCDT"
"RTN","IBCU7",48,0)
 . S DA(1)=IBIFN,DLAYGO=399
"RTN","IBCU7",49,0)
 . W ! D ^DIC I Y<1 S IBQUIT=1 Q
"RTN","IBCU7",50,0)
 . ; If we just added inactive code - it must be deleted.
"RTN","IBCU7",51,0)
 . S IBACT=0 ; Active flag
"RTN","IBCU7",52,0)
 . I Y["ICD0" S IBACT=$$ICD0ACT^IBACSV(+$P(Y,U,2),DGPROCDT)
"RTN","IBCU7",53,0)
 . I Y["ICPT" S IBACT=$$CPTACT^IBACSV(+$P(Y,U,2),DGPROCDT)
"RTN","IBCU7",54,0)
 . S DGCPTNEW=$P(Y,"^",3) ;Was the procedure just added?
"RTN","IBCU7",55,0)
 . I DGCPTNEW,'IBACT D DELPROC Q
"RTN","IBCU7",56,0)
 . I 'IBACT W !,*7,"Warning:  Procedure code is inactive on this date",!
"RTN","IBCU7",57,0)
 . I DGCPTNEW,$D(^UTILITY($J,"IB")),$$INPAT^IBCEF(IBIFN),Y["ICPT(" D DATA^IBCU74(Y)
"RTN","IBCU7",58,0)
 . S DGADDVST=$S(DGCPTNEW:1,$D(DGADDVST):DGADDVST,1:0)
"RTN","IBCU7",59,0)
 . N IBPRV,IBPRVO,IBPRVN
"RTN","IBCU7",60,0)
 . S IBPRVO=$$MAINPRV^IBCEU(IBIFN),IBPRV=$P(IBPRVO,U,3),IBPRVN=(IBPRVO["IBA(355.93,"),IBPRV=$S(IBPRV="":"",'IBPRVN:$P(IBPRVO,U),1:"")
"RTN","IBCU7",61,0)
 . I IBPRV="",'IBPRVN D
"RTN","IBCU7",62,0)
 .. S IBPRV=0 F  S IBPRV=$O(^DGCR(399,IBIFN,"CP",IBPRV)) S:'IBPRV IBPRV="" Q:'IBPRV  S Z=$P($G(^(IBPRV,0)),U,18) I Z S IBPRV=$P($G(^VA(200,Z,0)),U) Q
"RTN","IBCU7",63,0)
 . S DR="" I Y["ICPT" S DR="16"_$S(IBPRVN:";18///@",1:";18//"_IBPRV)_";6;5//"_$$DEFDIV(IBIFN)_";"
"RTN","IBCU7",64,0)
 . S DR=".01;"_DR_$S(IBFT=2:"8;9;17//NO;",1:"")_3,DIE=DIC,(IBPROCP,DA)=+Y D ^DIE Q:'$D(DA)!($E($G(Y))=U)
"RTN","IBCU7",65,0)
 . ;
"RTN","IBCU7",66,0)
 . S DR=$$SPCUNIT(IBIFN,IBPROCP) I DR'="" D ^DIE ; miles/minutes/hours
"RTN","IBCU7",67,0)
 . ;
"RTN","IBCU7",68,0)
 . I IBFT=2 D
"RTN","IBCU7",69,0)
 .. D DX^IBCU72(IBIFN,IBPROCP)
"RTN","IBCU7",70,0)
 .. S X=$$ADDTNL(IBIFN,.DA)
"RTN","IBCU7",71,0)
 . Q:$$INPAT^IBCEF(IBIFN)  ;only outpatient bills
"RTN","IBCU7",72,0)
 . ;add procedures to array for download to PCE: dgcpt(assoc clinic,cpt,'provider^first dx^modifiers',cnt)=""
"RTN","IBCU7",73,0)
 . S DGPROC=$G(^DGCR(399,IBIFN,"CP",+DA,0))
"RTN","IBCU7",74,0)
 . S X=$P(DGPROC,U,18)_U_+$G(^IBA(362.3,+$P(DGPROC,U,11),0))_U_$P(DGPROC,U,15)
"RTN","IBCU7",75,0)
 . I 'DGCPTNEW,$P(DGPROC,"^",7)="" S DGCPTNEW=2
"RTN","IBCU7",76,0)
 . I DGCPTUP,DGCPTNEW S DGCPT=DGCPT+1 I $P(DGPROC,"^",7) S DGCPT($P(DGPROC,"^",7),+DGPROC,X,DGCPT)=""
"RTN","IBCU7",77,0)
 . ; add visit date to bill
"RTN","IBCU7",78,0)
 . I DGADDVST S (X,DINUM)=DGPROCDT D VFILE1^IBCOPV1 K DINUM,X,DGNOADD,DGADDVST
"RTN","IBCU7",79,0)
 ; Delete modifers with only a sequence #, no code
"RTN","IBCU7",80,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  S Z0=0 F  S Z0=$O(^DGCR(399,IBIFN,"CP",Z,"MOD",Z0)) Q:'Z0  I $P($G(^(Z0,0)),U,2)="" S DA(2)=IBIFN,DA(1)=Z,DA=Z0,DIK="^DGCR(399,"_DA(2)_",""CP"","_DA(1)_",""MOD""," D ^DIK
"RTN","IBCU7",81,0)
 Q
"RTN","IBCU7",82,0)
CODQ K %DT,DGPROC,DIC,DIE,DR,DGPROCDT,IBPROCP,DLAYGO
"RTN","IBCU7",83,0)
 K IBFT,DGNOADD,DGADDVST,DGCPT,DGCPTUP,IBZTYPE,DGCPTNEW
"RTN","IBCU7",84,0)
 Q
"RTN","IBCU7",85,0)
 ;
"RTN","IBCU7",86,0)
DELPROC ; Remove the selected procedure, because of inactive status (cancel selection)
"RTN","IBCU7",87,0)
 W !!,*7,"The Procedure code is inactive on ",$$DAT1^IBOUTL(DGPROCDT),"."
"RTN","IBCU7",88,0)
 W !,"Please select another Procedure."
"RTN","IBCU7",89,0)
 S DA(1)=IBIFN,DA=+Y,DIK="^DGCR(399,"_IBIFN_",""CP"","
"RTN","IBCU7",90,0)
 D ^DIK
"RTN","IBCU7",91,0)
 Q
"RTN","IBCU7",92,0)
 ;
"RTN","IBCU7",93,0)
DELADD N Z,Z0,DA,DIK,X,Y
"RTN","IBCU7",94,0)
 S DA(1)=IBIFN
"RTN","IBCU7",95,0)
 ;Delete references to proc on rev codes
"RTN","IBCU7",96,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"RC",Z)) Q:'Z  S Z0=$G(^(Z,0)) I Z0'="",$P(Z0,U,15)!$S($P(Z0,U,10)=3:$P(Z0,U,11),1:0) S DIE="^DGCR(399,"_DA(1)_",""RC"",",DA=Z,DR=".11///@;.15///@"_$S($P(Z0,U,8):"",1:";.08////1") D ^DIE
"RTN","IBCU7",97,0)
 S DIK="^DGCR(399,"_DA(1)_",""CP""," F DA=0:0 S DA=$O(^DGCR(399,DA(1),"CP",DA)) Q:'DA  D ^DIK
"RTN","IBCU7",98,0)
 S DGRVRCAL=1
"RTN","IBCU7",99,0)
 Q
"RTN","IBCU7",100,0)
 ;
"RTN","IBCU7",101,0)
DTMES ;Message if procedure date not in date range
"RTN","IBCU7",102,0)
 Q:'$D(IBIFN)  Q:'$D(^DGCR(399,IBIFN,"U"))  S DGNODUU=^("U")
"RTN","IBCU7",103,0)
 G:X'<$P(DGNODUU,"^")&(X'>$P(DGNODUU,"^",2)) DTMESQ
"RTN","IBCU7",104,0)
 W *7,!!?3,"Date must be within STATEMENT COVERS FROM and STATEMENT COVERS TO period."
"RTN","IBCU7",105,0)
 S Y=$P(DGNODUU,"^") X ^DD("DD")
"RTN","IBCU7",106,0)
 W !?3,"Enter a date between ",Y," and " S Y=$P(DGNODUU,"^",2) X ^DD("DD") W Y,!
"RTN","IBCU7",107,0)
 K X,Y
"RTN","IBCU7",108,0)
DTMESQ K DGNODUU Q
"RTN","IBCU7",109,0)
 ;
"RTN","IBCU7",110,0)
CODHLP ;Display Additional Procedure codes
"RTN","IBCU7",111,0)
 N I,J,Y,IBMOD
"RTN","IBCU7",112,0)
 I '$O(^DGCR(399,IBIFN,"CP",0)) W !!?5,"No Codes Entered!",! Q
"RTN","IBCU7",113,0)
 F I=0:0 S I=$O(^DGCR(399,IBIFN,"CP",I)) Q:'I  S Y=$G(^(I,0)) S Z=$$PRCNM^IBCSCH1($P(Y,"^",1),$P(Y,"^",2)) W !?5,$E($P(Z,"^",2),1,28),?35,"- ",$P(Z,"^") D
"RTN","IBCU7",114,0)
 . N IBY
"RTN","IBCU7",115,0)
 . S IBY=$P(Y,U,2)
"RTN","IBCU7",116,0)
 . S IBMOD=$$GETMOD^IBEFUNC(IBIFN,I,1)
"RTN","IBCU7",117,0)
 . I IBMOD'="" S IBMOD="/"_IBMOD W IBMOD
"RTN","IBCU7",118,0)
 . W ?60,"Date: " S Y=IBY D DT^DIQ
"RTN","IBCU7",119,0)
 ;
"RTN","IBCU7",120,0)
 K Z Q
"RTN","IBCU7",121,0)
 ;
"RTN","IBCU7",122,0)
DICV I $D(IBIFN),$D(^DGCR(399,IBIFN,0)),$P(^(0),U,9) S DIC("V")=$S($P(^(0),U,9)=9:"I +Y(0)=80.1",$P(^(0),U,9)=4!($P(^(0),U,9)=5):"I +Y(0)=81",1:"")
"RTN","IBCU7",123,0)
 Q
"RTN","IBCU7",124,0)
 ;
"RTN","IBCU7",125,0)
DEFDIV(IBIFN) ; Find default division for bill IBIFN
"RTN","IBCU7",126,0)
 Q $P($G(^DG(40.8,+$P($G(^DGCR(399,IBIFN,0)),U,22),0)),U)
"RTN","IBCU7",127,0)
 ;
"RTN","IBCU7",128,0)
ADDTNL(IBIFN,DA) ;
"RTN","IBCU7",129,0)
 N DR,IBOK,X,Y,DIR
"RTN","IBCU7",130,0)
 S IBOK=1
"RTN","IBCU7",131,0)
 ;S DR="19;S:$P($G(^IBE(353.2,+$P($G(^DGCR(399,DA(1),""CP"",DA,0)),U,10),0)),U,2)'=""ANESTHESIA"" Y=""@20"";15;@20;50.01;50.08" D ^DIE
"RTN","IBCU7",132,0)
 S DR="19;50.01;50.08" D ^DIE
"RTN","IBCU7",133,0)
 I $D(Y) S IBOK=0 G ADDTNLQ
"RTN","IBCU7",134,0)
 S DIR("B")="NO",DIR("A")="EDIT HCFA 1500 SPECIAL PROGRAM FIELDS and BOX 19?: ",DIR("A",1)=" ",DIR(0)="YA"
"RTN","IBCU7",135,0)
 S DIR("?",1)="Respond YES only if you need to add/edit data for chiropratic visits,"
"RTN","IBCU7",136,0)
 S DIR("?")="EPSDT care, or if billing for HOSPICE and attending is not a hospice employee."
"RTN","IBCU7",137,0)
 D ^DIR K DIR
"RTN","IBCU7",138,0)
 I Y'=1 S IBOK=0 G ADDTNLQ
"RTN","IBCU7",139,0)
 S DR="W !,""  <<EPSDT>>"";50.07;W !!,""  <<HOSPICE>>"";50.03;W !!,""  <<CHIROPRACTIC>>"";50.04;50.02;50.05;50.06"
"RTN","IBCU7",140,0)
 D ^DIE
"RTN","IBCU7",141,0)
 W !
"RTN","IBCU7",142,0)
ADDTNLQ Q IBOK
"RTN","IBCU7",143,0)
 ;
"RTN","IBCU7",144,0)
XTRA1(Y) ;
"RTN","IBCU7",145,0)
 K Y
"RTN","IBCU7",146,0)
 Q
"RTN","IBCU7",147,0)
 ;
"RTN","IBCU7",148,0)
SPCUNIT(IBIFN,DA) ; return fields for special units if applicable, in DR form
"RTN","IBCU7",149,0)
 N IB0,IBCPT,IBDR,IBCT,IBFT S IBDR=""
"RTN","IBCU7",150,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)),IBCT=$P(IB0,U,27),IBFT=$P(IB0,U,19)
"RTN","IBCU7",151,0)
 S IBCPT=$G(^DGCR(399,+$G(IBIFN),"CP",+$G(DA),0)) I IBCPT'["ICPT" G SPCUNTQ
"RTN","IBCU7",152,0)
 I +$$ITMUNIT^IBCRU4(+IBCPT,5,IBCT) S IBDR="15;" G SPCUNTQ ; minutes
"RTN","IBCU7",153,0)
 I +$$ITMUNIT^IBCRU4(+IBCPT,4,IBCT) S IBDR="21;" G SPCUNTQ ; miles
"RTN","IBCU7",154,0)
 I +$$ITMUNIT^IBCRU4(+IBCPT,6,IBCT) S IBDR="22;" G SPCUNTQ ; hours
"RTN","IBCU7",155,0)
 I +IBFT=2,$P($G(^IBE(353.2,+$P(IBCPT,U,10),0)),U,2)="ANESTHESIA" S IBDR="15;" ; minutes
"RTN","IBCU7",156,0)
SPCUNTQ Q IBDR
"RTN","IBCU74")
0^7^B12737396
"RTN","IBCU74",1,0)
IBCU74 ;OAK/ELZ - INTERCEPT SCREEN INPUT OF PROCEDURE CODES (CONT) ;6-JAN-04
"RTN","IBCU74",2,0)
 ;;2.0;INTEGRATED BILLING;**228**;21-MAR-94
"RTN","IBCU74",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCU74",4,0)
 ;
"RTN","IBCU74",5,0)
 ;
"RTN","IBCU74",6,0)
DATA(IBP) ; this is used to add data when new procedures are added for
"RTN","IBCU74",7,0)
 ; inpatient cases
"RTN","IBCU74",8,0)
 N IBX,IBY,IB1,IB2,IBC,DO,X,DIC,DIE,DA,DR,IB9,Y,IBQ,IBDR,IBZ,IBS
"RTN","IBCU74",9,0)
 S DR="" I '$P(IBP,"^",2)!('DGPROCDT) Q
"RTN","IBCU74",10,0)
 S IB1=0 F  S IB1=$O(^UTILITY($J,"IB",IB1)) Q:IB1<1!(DR)  I $P($G(^UTILITY($J,"IB",IB1,1)),"^",2)=DGPROCDT D
"RTN","IBCU74",11,0)
 . S IB2=0 F  S IB2=$O(^UTILITY($J,"IB",IB1,IB2)) Q:IB2<1!(DR)  S IBY=$G(^UTILITY($J,"IB",IB1,IB2)) I +IBY=+$P(IBP,"^",2) D  Q
"RTN","IBCU74",12,0)
 .. F IBX=6:1:9 I $P(IBY,"^",IBX) D
"RTN","IBCU74",13,0)
 ... F IBC=1:1:4 Q:'$D(^IBA(362.3,"AO",IBIFN,IBC))
"RTN","IBCU74",14,0)
 ... I $D(^IBA(362.3,"AO",IBIFN,IBC)) Q
"RTN","IBCU74",15,0)
 ... S IB9=$$ICD9^IBACSV($P(IBY,"^",IBX),DGPROCDT)
"RTN","IBCU74",16,0)
 ... W !?10,"Adding associated dx: ",$P(IB9,"^"),"  ",$P(IB9,"^",3)
"RTN","IBCU74",17,0)
 ... ; first check to see if dx on bill already
"RTN","IBCU74",18,0)
 ... S Y=$O(^IBA(362.3,"AIFN"_IBIFN,$P(IBY,"^",IBX),0))
"RTN","IBCU74",19,0)
 ... I 'Y S DIC="^IBA(362.3,",DIC(0)="",X=$P(IBY,"^",IBX),DIC("DR")=".02////^S X=IBIFN;.03////^S X=IBC" D FILE^DICN Q:Y<1
"RTN","IBCU74",20,0)
 ... ;need to find what field is not occupied starting with 10
"RTN","IBCU74",21,0)
 ... S IBZ=10 F IBS=1:1 Q:$P(DR,";",IBS)=""  I $P(DR,";",IBS)[IBZ_"////" S IBZ=IBZ+1
"RTN","IBCU74",22,0)
 ... S DR=DR_IBZ_"////"_(+Y)_";"
"RTN","IBCU74",23,0)
 .. I $P(IBY,"^",13) W !!?10,"Associating Provider: ",$P($G(^VA(200,$P(IBY,"^",13),0)),"^") D  S DR=DR_"18////"_$P(IBY,"^",13)_";"
"RTN","IBCU74",24,0)
 ... ;
"RTN","IBCU74",25,0)
 ... ; as requested by users, need to update the last look up value for
"RTN","IBCU74",26,0)
 ... ; the provider
"RTN","IBCU74",27,0)
 ... N DIC,X,DR,Y S DIC="^VA(200,",DIC(0)="INOS",X="`"_$P(IBY,"^",13)
"RTN","IBCU74",28,0)
 ... D ^DIC
"RTN","IBCU74",29,0)
 ... ;
"RTN","IBCU74",30,0)
 .. I $P(IBY,"^",14) W !?10,"Assigning Location: ",$P($G(^SC($P(IBY,"^",14),0)),"^") S DR=DR_"6////"_$P(IBY,"^",14)_";"_$S($P($G(^SC($P(IBY,"^",14),0)),"^",15):"5////"_$P(^(0),"^",15)_";",1:"")
"RTN","IBCU74",31,0)
 .. I $L(DR) S DIE="^DGCR(399,"_IBIFN_",""CP"",",DA(1)=IBIFN,DA=+IBP,IBDR=DR D ^DIE
"RTN","IBCU74",32,0)
 .. S IBC=0 F IBX=11,12 I $P(IBY,"^",IBX) S IB9=$$MOD^ICPTMOD($P(IBY,"^",IBX),"I") W !?10,"Adding Modifier: ",$P(IB9,"^",2)," - ",$P(IB9,"^",3) D
"RTN","IBCU74",33,0)
 ... S IBC=IBC+1,DIC="^DGCR(399,"_IBIFN_",""CP"","_(+IBP)_",""MOD"",",DA(1)=+IBP,DA(2)=IBIFN,X=IBC,DIC("DR")=".02////"_$P(IBY,"^",IBX),DIC(0)="" D FILE^DICN
"RTN","IBCU74",34,0)
 .. ;
"RTN","IBCU74",35,0)
 .. ; need to check for quantity >1 then duplicate entry
"RTN","IBCU74",36,0)
 .. I $P(IBY,"^",10)>1 W !!?10,"Duplicating Procedure for Quantity of ",$P(IBY,"^",10) F IBQ=1:1:$P(IBY,"^",10)-1 D
"RTN","IBCU74",37,0)
 ... K DO S DIC="^DGCR(399,"_IBIFN_",""CP"",",DIC(0)="",X=(+IBY)_";ICPT(",DA(1)=IBIFN,DIC("DR")="1////"_DGPROCDT_";"_$G(IBDR) D FILE^DICN S IBCP=+Y
"RTN","IBCU74",38,0)
 ... S IBC=0 F IBX=11,12 I $P(IBY,"^",IBX) S IB9=$$MOD^ICPTMOD($P(IBY,"^",IBX),"I"),IBC=IBC+1,DIC="^DGCR(399,"_IBIFN_",""CP"","_IBCP_",""MOD"",",DA(1)=IBCP,DA(2)=IBIFN,X=IBC,DIC("DR")=".02////"_$P(IBY,"^",IBX),DIC(0)="" D FILE^DICN
"RTN","IBCU74",39,0)
 .. K IBDR
"RTN","IBCU74",40,0)
 Q
"VER")
8.0^22
**END**
**END**
