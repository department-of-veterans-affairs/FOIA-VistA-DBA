Released PSO*7*219 SEQ #193
Extracted from mail message
**KIDS**:PSO*7.0*219^

**INSTALL NAME**
PSO*7.0*219
"BLD",5925,0)
PSO*7.0*219^OUTPATIENT PHARMACY^0^3051019^y
"BLD",5925,1,0)
^^223^223^3051019^
"BLD",5925,1,1,0)
This patch is a follow up for Outpatient Pharmacy Clinical Indicator Data
"BLD",5925,1,2,0)
Capture (CIDC) patch PSO*7*143.
"BLD",5925,1,3,0)
 
"BLD",5925,1,4,0)
Functional Description:
"BLD",5925,1,5,0)
----------------------
"BLD",5925,1,6,0)
This Outpatient Pharmacy patch PSO*7*219 corrects the following issues:
"BLD",5925,1,7,0)
 
"BLD",5925,1,8,0)
1.  The Application Program Interface (API) that is provided to 
"BLD",5925,1,9,0)
Computerized Patient Record System (CPRS) with the service connection (SC)
"BLD",5925,1,10,0)
and environmental indicator (EI) questions was not set correctly for non
"BLD",5925,1,11,0)
service connected (NSC) patients, as a result the following issues were
"BLD",5925,1,12,0)
reported:
"BLD",5925,1,13,0)
 
"BLD",5925,1,14,0)
a. In CPRS, the SC related questions were incorrectly prompted for NSC
"BLD",5925,1,15,0)
patients, and it should not have done so. It should prompt SC/EI question
"BLD",5925,1,16,0)
only if applicable.(remedy ticket 114219).
"BLD",5925,1,17,0)
 
"BLD",5925,1,18,0)
b. Holders of the PSO COPAY key, the ordering provider, and the finishing
"BLD",5925,1,19,0)
pharmacist were receiving increased volumes of mailman messages in 
"BLD",5925,1,20,0)
Outpatient Pharmacy.  Mailman messages were incorrectly sent for NSC
"BLD",5925,1,21,0)
patients upon refill, new, and renewed orders (remedy ticket 114219).
"BLD",5925,1,22,0)
These messages have been eliminated.  Mailman messages will still be
"BLD",5925,1,23,0)
generated for the following scenarios:
"BLD",5925,1,24,0)
 
"BLD",5925,1,25,0)
                 SC percentage
"BLD",5925,1,26,0)
                 - age changed   E/I question
"BLD",5925,1,27,0)
     Type        to >0%          added?          Mailman Message sent?
"BLD",5925,1,28,0)
     ---------   --------------  -------------   -------------------------
"BLD",5925,1,29,0)
     NSC         N               N               N        
"BLD",5925,1,30,0)
 
"BLD",5925,1,31,0)
     NSC         N               Y               Y only if question was
"BLD",5925,1,32,0)
                                                     not answered before
"BLD",5925,1,33,0)
                                                     the prescription is
"BLD",5925,1,34,0)
                                                     released
"BLD",5925,1,35,0)
 
"BLD",5925,1,36,0)
     NSC         Y               N/A             Y if question was not
"BLD",5925,1,37,0)
                                                     answered before the
"BLD",5925,1,38,0)
                                                     prescription is
"BLD",5925,1,39,0)
                                                     released
"BLD",5925,1,40,0)
 
"BLD",5925,1,41,0)
     SC=>0%<50%  N/A             Y               Y  however, NO mailman
"BLD",5925,1,42,0)
                                                      message will be sent
"BLD",5925,1,43,0)
                                                      if any SC/EI = YES
"BLD",5925,1,44,0)
                                                      on the original
"BLD",5925,1,45,0)
                                                      prescription 
"BLD",5925,1,46,0)
 
"BLD",5925,1,47,0)
     For SC>50% prescriptions and if patient has a new SC/EI added, the
"BLD",5925,1,48,0)
     appropriate questions will be asked upon RENEW or COPY of the
"BLD",5925,1,49,0)
     original prescription. At release, a MailMan message will not be sent
"BLD",5925,1,50,0)
     if the patient, patient status, or drug is exempt from copay.
"BLD",5925,1,51,0)
 
"BLD",5925,1,52,0)
Because the information requested by these Mailman messages are used to 
"BLD",5925,1,53,0)
determine the final VA copay and/or insurance billable status, the text 
"BLD",5925,1,54,0)
and format has changed.  The subject line was changed from "RX COPAY 
"BLD",5925,1,55,0)
STATUS REVIEW NEEDED" to "PRESCRIPTION QUESTIONS REVIEW NEEDED" and the
"BLD",5925,1,56,0)
body of the message has additional information.  Also, the eligibility and
"BLD",5925,1,57,0)
disability information is now included after the patient name. The
"BLD",5925,1,58,0)
following is an example:
"BLD",5925,1,59,0)
 
"BLD",5925,1,60,0)
Subj: PRESCRIPTION QUESTIONS REVIEW NEEDED (800)  [#164897] 10/07/05@13:39
"BLD",5925,1,61,0)
37 lines
"BLD",5925,1,62,0)
From: OUTPATIENT PHARMACY PACKAGE  In 'IN' basket.   Page 1  *New*
"BLD",5925,1,63,0)
-------------------------------------------------------------------------
"BLD",5925,1,64,0)
 
"BLD",5925,1,65,0)
PATIENT,TEST  (XXXX)  
"BLD",5925,1,66,0)
Eligibility: SC LESS THAN 50%     SC%: 10
"BLD",5925,1,67,0)
             REIMBURSABLE INSURANCE
"BLD",5925,1,68,0)
 
"BLD",5925,1,69,0)
Disabilities: ARTHRITIS-10%(SC), FOREARM CONDITION-5%(NSC), 
"BLD",5925,1,70,0)
              FOREARM CONDITION-4%(NSC), BENIGN EYE GROWTH-0%(NSC), 
"BLD",5925,1,71,0)
              LOSS OF FIELD OF VISION-20%(SC), 
"BLD",5925,1,72,0)
 
"BLD",5925,1,73,0)
Rx# #######B (1)    NO COPAY
"BLD",5925,1,74,0)
AMITRIPTYLINE 100MG
"BLD",5925,1,75,0)
 
"BLD",5925,1,76,0)
Due to a change in criteria, additional information listed below is needed
"BLD",5925,1,77,0)
to determine the final VA copay and/or insurance billable status for this 
"BLD",5925,1,78,0)
Rx so that appropriate action can be taken by pharmacy personnel.
"BLD",5925,1,79,0)
 
"BLD",5925,1,80,0)
Is this Rx for a Service Connected Condition?
"BLD",5925,1,81,0)
 
"BLD",5925,1,82,0)
 
"BLD",5925,1,83,0)
Enter RETURN to continue or '^' to exit: 
"BLD",5925,1,84,0)
 
"BLD",5925,1,85,0)
 
"BLD",5925,1,86,0)
Subj: PRESCRIPTION QUESTIONS REVIEW NEEDED (800)  [#164897]   Page 2
"BLD",5925,1,87,0)
--------------------------------------------------------------------------
"BLD",5925,1,88,0)
 
"BLD",5925,1,89,0)
This message has been sent to the provider of record, the pharmacist who
"BLD",5925,1,90,0)
finished the prescription order, and all holders of the PSO COPAY key.
"BLD",5925,1,91,0)
 
"BLD",5925,1,92,0)
Providers:
"BLD",5925,1,93,0)
Please respond with your answer to the question(s) as a reply to this
"BLD",5925,1,94,0)
message. The prescription will be updated by the appropriate staff.
"BLD",5925,1,95,0)
 
"BLD",5925,1,96,0)
Staff assigned to update the Prescription responses:
"BLD",5925,1,97,0)
Please use the RESET COPAY STATUS/CANCEL CHARGES option to enter the 
"BLD",5925,1,98,0)
responses to the questions above, which may result in a Rx copay status
"BLD",5925,1,99,0)
change and/or the need to remove VA copay charges or may result in a
"BLD",5925,1,100,0)
charge to the patient's insurance carrier.
"BLD",5925,1,101,0)
 
"BLD",5925,1,102,0)
Note: The SC question is now asked for Veterans who are SC>49% in order to
"BLD",5925,1,103,0)
determine if the Rx can be billed to a third party insurance. These 
"BLD",5925,1,104,0)
Veterans will NOT be charged a VA copay.
"BLD",5925,1,105,0)
 
"BLD",5925,1,106,0)
Supply and investigational drugs are not charged a VA copay but could be
"BLD",5925,1,107,0)
reimbursable by third party insurance.
"BLD",5925,1,108,0)
 
"BLD",5925,1,109,0)
Enter message action (in IN basket): Ignore// 
"BLD",5925,1,110,0)
 
"BLD",5925,1,111,0)
c.  In CPRS, SC/EI related questions were not asked for supply items 
"BLD",5925,1,112,0)
and investigational drugs (remedy ticket 11421). CPRS and backdoor 
"BLD",5925,1,113,0)
Outpatient Pharmacy users will be required to complete SC/EI questions for
"BLD",5925,1,114,0)
supplies and investigational drugs. Supply items and investigational drugs
"BLD",5925,1,115,0)
could be reimbursable by third party insurance. Also, a VA copay will not
"BLD",5925,1,116,0)
be charged for these.
"BLD",5925,1,117,0)
 
"BLD",5925,1,118,0)
2.  During use of Complete Orders from OERR option [PSO LMOE FINISH], the
"BLD",5925,1,119,0)
default answers for SC/EI's for CPRS SC>50% renewed orders were
"BLD",5925,1,120,0)
occasionally displaying the previous orders answers during the finish
"BLD",5925,1,121,0)
process.  A modification was made to display the SC/EI information entered
"BLD",5925,1,122,0)
during the CPRS renewal process.  This anomaly was encountered during
"BLD",5925,1,123,0)
unit testing, and there is no associated remedy ticket.
"BLD",5925,1,124,0)
 
"BLD",5925,1,125,0)
3.  For renewal orders in Complete Orders from OERR option [PSO LMOE 
"BLD",5925,1,126,0)
FINISH] and Patient Prescription Processing option [PSO LM BACKDOOR 
"BLD",5925,1,127,0)
ORDERS], a message was erroneously displayed after the SC/EI prompts for
"BLD",5925,1,128,0)
SC>50% prescriptions.  The following is an example of the message
"BLD",5925,1,129,0)
displayed when eligibility is changed or the user enters an up arrows (^)
"BLD",5925,1,130,0)
at an outpatient classification prompt.  Note that the bracketed
"BLD",5925,1,131,0)
information can be SERVICE CONNECTED or NON SERVICE CONNECTED depending
"BLD",5925,1,132,0)
upon the user's response to the question.  Or if the user up arrows (^)
"BLD",5925,1,133,0)
out of the prompt, the default answer determines the value.
"BLD",5925,1,134,0)
 
"BLD",5925,1,135,0)
           Was treatment for a Service Connected condition? YES// ^
"BLD",5925,1,136,0)
           This Renewal has been designated as [SERVICE CONNECTED]
"BLD",5925,1,137,0)
           Please use the 'Reset Copay Status/Cancel Charges' option to
"BLD",5925,1,138,0)
           make corrections.
"BLD",5925,1,139,0)
 
"BLD",5925,1,140,0)
The "Please use the 'Reset Copay Status/Cancel Charges' option to make
"BLD",5925,1,141,0)
corrections" sentence will no longer be displayed for supply items,
"BLD",5925,1,142,0)
investigational drugs, and SC>50% patients.  The first sentence will
"BLD",5925,1,143,0)
remain in order to continue to inform the user of the answer stored for
"BLD",5925,1,144,0)
the prompt.  Note that similar messages are displayed for environmental
"BLD",5925,1,145,0)
indicator prompts and this change applies to them. The associated remedy
"BLD",5925,1,146,0)
tickets are 11393 and 113931.
"BLD",5925,1,147,0)
 
"BLD",5925,1,148,0)
4.  For CPRS prescription orders finished using the Complete Orders from
"BLD",5925,1,149,0)
OERR option [PSO LMOE FINISH] or the Patient Prescription Processing
"BLD",5925,1,150,0)
option [PSO LM BACKDOOR ORDERS], a copay related message was displayed for
"BLD",5925,1,151,0)
SC>50% patients, supply items and investigational drugs.  The following is
"BLD",5925,1,152,0)
an example, and please note that bracketed information can be either COPAY
"BLD",5925,1,153,0)
or NO COPAY depending on the providers response to the clinical indicator.
"BLD",5925,1,154,0)
 
"BLD",5925,1,155,0)
     Do you want to enter a Progress Note? No//   NO
"BLD",5925,1,156,0)
 
"BLD",5925,1,157,0)
            SC Percent: 40%
"BLD",5925,1,158,0)
            Disabilities: NONE STATED
"BLD",5925,1,159,0)
 
"BLD",5925,1,160,0)
     This Rx has been flagged by the provider as: [NO COPAY]
"BLD",5925,1,161,0)
 
"BLD",5925,1,162,0)
     Was treatment for Service Connected condition? YES
"BLD",5925,1,163,0)
 
"BLD",5925,1,164,0)
The "This Rx has been flagged by the provider as: [COPAY/NO COPAY]"
"BLD",5925,1,165,0)
message will no longer be displayed for SC>50% patients, supply items, 
"BLD",5925,1,166,0)
and investigational drugs.  There is no associated remedy ticket.
"BLD",5925,1,167,0)
 
"BLD",5925,1,168,0)
5.  When an edit that creates a new order is performed in Outpatient 
"BLD",5925,1,169,0)
Pharmacy, a message is displayed to notate that the orderable item was
"BLD",5925,1,170,0)
changed.  This message is displayed in the Complete Orders from OERR
"BLD",5925,1,171,0)
[PSO LMOE FINISH] option and the Patient Prescription Processing option
"BLD",5925,1,172,0)
[PSO LM BACKDOOR ORDERS]. The following is an example:
"BLD",5925,1,173,0)
 
"BLD",5925,1,174,0)
      CARBAMAZEPINE 100MG TAB
"BLD",5925,1,175,0)
      PROVIDER,NAME           PROVIDER,NAME
"BLD",5925,1,176,0)
      # of Refills: 3
"BLD",5925,1,177,0)
 
"BLD",5925,1,178,0)
      The Pharmacy Orderable Item has changed for this order. Please
"BLD",5925,1,179,0)
      review any existing medication copay exemption defaults carefully
"BLD",5925,1,180,0)
      for appropriateness.
"BLD",5925,1,181,0)
 
"BLD",5925,1,182,0)
      SC Percent: 40%
"BLD",5925,1,183,0)
      Disabilities: NONE STATED
"BLD",5925,1,184,0)
 
"BLD",5925,1,185,0)
      Was treatment for Service Connected condition? YES// 
"BLD",5925,1,186,0)
 
"BLD",5925,1,187,0)
The above message has been modified to the following:
"BLD",5925,1,188,0)
 
"BLD",5925,1,189,0)
      The Pharmacy Orderable Item has changed for this order. Please
"BLD",5925,1,190,0)
      review any existing SC or Environmental Indicator defaults carefully
"BLD",5925,1,191,0)
      for appropriateness.
"BLD",5925,1,192,0)
 
"BLD",5925,1,193,0)
Technical Description:
"BLD",5925,1,194,0)
----------------------
"BLD",5925,1,195,0)
The following correlates to each sequence in the Functional Description 
"BLD",5925,1,196,0)
above and the routines modified are shown in parentheses by each function:
"BLD",5925,1,197,0)
 
"BLD",5925,1,198,0)
1.  The SCNEW^PSOCP API was returning PSOTG("SC")="" variable for NSC
"BLD",5925,1,199,0)
patients which caused CPRS to erroneously prompt for them.  Also due to
"BLD",5925,1,200,0)
this, Mailman messages for "RX COPAY STATUS REVIEW NEEDED" information was
"BLD",5925,1,201,0)
sent in error for NSC prescriptions at release of the prescription. These
"BLD",5925,1,202,0)
issues were corrected, and the PSOCPE routine was modified to show the
"BLD",5925,1,203,0)
patient's eligibilities and disabilities as well as impart more accurate
"BLD",5925,1,204,0)
information.
"BLD",5925,1,205,0)
 
"BLD",5925,1,206,0)
 2.  Modified renewal routines to always pull SC/EI information from the
"BLD",5925,1,207,0)
data passed on the renewed order from CPRS (PSORENW1, PSORN52, PSORN52D).
"BLD",5925,1,208,0)
This change affects renewals from CPRS and backdoor Outpatient Pharmacy
"BLD",5925,1,209,0)
orders.
"BLD",5925,1,210,0)
 
"BLD",5925,1,211,0)
3.  For SC>50% prescriptions, supply items and investigational drugs,
"BLD",5925,1,212,0)
eliminated the display of "Please use the 'Reset Copay Status/Cancel
"BLD",5925,1,213,0)
Charges' option to make corrections." sentence (PSOCPB, PSOMLLD2,
"BLD",5925,1,214,0)
PSOMLLDT), but it will continue to be displayed for SC<50% prescriptions.
"BLD",5925,1,215,0)
 
"BLD",5925,1,216,0)
4.  For SC>50% prescriptions, supply items and investigational drugs,
"BLD",5925,1,217,0)
eliminated the display of "This Rx has been flagged by the provider as:
"BLD",5925,1,218,0)
[COPAY/NO COPAY]" (PSOCPB, PSONEWF, PSORN52).  This message will continue
"BLD",5925,1,219,0)
to be displayed for SC<50% patients.
"BLD",5925,1,220,0)
 
"BLD",5925,1,221,0)
5.  For SC 0-100%, supply items and investigational drugs, modified the 
"BLD",5925,1,222,0)
wording of the message displayed when a prescription edit that creates a 
"BLD",5925,1,223,0)
new order is performed (PSOCPB, PSONEWF, PSONEWG).
"BLD",5925,4,0)
^9.64PA^^
"BLD",5925,6)
3^
"BLD",5925,"ABPKG")
n
"BLD",5925,"KRN",0)
^9.67PA^8989.52^19
"BLD",5925,"KRN",.4,0)
.4
"BLD",5925,"KRN",.401,0)
.401
"BLD",5925,"KRN",.402,0)
.402
"BLD",5925,"KRN",.403,0)
.403
"BLD",5925,"KRN",.5,0)
.5
"BLD",5925,"KRN",.84,0)
.84
"BLD",5925,"KRN",3.6,0)
3.6
"BLD",5925,"KRN",3.8,0)
3.8
"BLD",5925,"KRN",9.2,0)
9.2
"BLD",5925,"KRN",9.8,0)
9.8
"BLD",5925,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",5925,"KRN",9.8,"NM",1,0)
PSOCP^^0^B75128860
"BLD",5925,"KRN",9.8,"NM",2,0)
PSOMLLD2^^0^B22361376
"BLD",5925,"KRN",9.8,"NM",3,0)
PSORENW1^^0^B55639962
"BLD",5925,"KRN",9.8,"NM",4,0)
PSORN52^^0^B69065416
"BLD",5925,"KRN",9.8,"NM",5,0)
PSORN52D^^0^B45252333
"BLD",5925,"KRN",9.8,"NM",6,0)
PSON52^^0^B56762334
"BLD",5925,"KRN",9.8,"NM",7,0)
PSODIAG^^0^B63400905
"BLD",5925,"KRN",9.8,"NM",8,0)
PSOORED6^^0^B51610545
"BLD",5925,"KRN",9.8,"NM",9,0)
PSOCPB^^0^B82075464
"BLD",5925,"KRN",9.8,"NM",10,0)
PSOMLLDT^^0^B88490307
"BLD",5925,"KRN",9.8,"NM",11,0)
PSONEWF^^0^B44037297
"BLD",5925,"KRN",9.8,"NM",12,0)
PSOCPE^^0^B79963827
"BLD",5925,"KRN",9.8,"NM",13,0)
PSONEWG^^0^B21775279
"BLD",5925,"KRN",9.8,"NM","B","PSOCP",1)

"BLD",5925,"KRN",9.8,"NM","B","PSOCPB",9)

"BLD",5925,"KRN",9.8,"NM","B","PSOCPE",12)

"BLD",5925,"KRN",9.8,"NM","B","PSODIAG",7)

"BLD",5925,"KRN",9.8,"NM","B","PSOMLLD2",2)

"BLD",5925,"KRN",9.8,"NM","B","PSOMLLDT",10)

"BLD",5925,"KRN",9.8,"NM","B","PSON52",6)

"BLD",5925,"KRN",9.8,"NM","B","PSONEWF",11)

"BLD",5925,"KRN",9.8,"NM","B","PSONEWG",13)

"BLD",5925,"KRN",9.8,"NM","B","PSOORED6",8)

"BLD",5925,"KRN",9.8,"NM","B","PSORENW1",3)

"BLD",5925,"KRN",9.8,"NM","B","PSORN52",4)

"BLD",5925,"KRN",9.8,"NM","B","PSORN52D",5)

"BLD",5925,"KRN",19,0)
19
"BLD",5925,"KRN",19.1,0)
19.1
"BLD",5925,"KRN",101,0)
101
"BLD",5925,"KRN",409.61,0)
409.61
"BLD",5925,"KRN",771,0)
771
"BLD",5925,"KRN",870,0)
870
"BLD",5925,"KRN",8989.51,0)
8989.51
"BLD",5925,"KRN",8989.52,0)
8989.52
"BLD",5925,"KRN",8994,0)
8994
"BLD",5925,"KRN","B",.4,.4)

"BLD",5925,"KRN","B",.401,.401)

"BLD",5925,"KRN","B",.402,.402)

"BLD",5925,"KRN","B",.403,.403)

"BLD",5925,"KRN","B",.5,.5)

"BLD",5925,"KRN","B",.84,.84)

"BLD",5925,"KRN","B",3.6,3.6)

"BLD",5925,"KRN","B",3.8,3.8)

"BLD",5925,"KRN","B",9.2,9.2)

"BLD",5925,"KRN","B",9.8,9.8)

"BLD",5925,"KRN","B",19,19)

"BLD",5925,"KRN","B",19.1,19.1)

"BLD",5925,"KRN","B",101,101)

"BLD",5925,"KRN","B",409.61,409.61)

"BLD",5925,"KRN","B",771,771)

"BLD",5925,"KRN","B",870,870)

"BLD",5925,"KRN","B",8989.51,8989.51)

"BLD",5925,"KRN","B",8989.52,8989.52)

"BLD",5925,"KRN","B",8994,8994)

"BLD",5925,"QUES",0)
^9.62^^
"BLD",5925,"REQB",0)
^9.611^1^1
"BLD",5925,"REQB",1,0)
PSO*7.0*143^2
"BLD",5925,"REQB","B","PSO*7.0*143",1)

"MBREQ")
0
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,20,0)
^9.402P^^
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
219^3051019^123456821
"PKG",206,22,1,"PAH",1,1,0)
^^223^223^3051019
"PKG",206,22,1,"PAH",1,1,1,0)
This patch is a follow up for Outpatient Pharmacy Clinical Indicator Data
"PKG",206,22,1,"PAH",1,1,2,0)
Capture (CIDC) patch PSO*7*143.
"PKG",206,22,1,"PAH",1,1,3,0)
 
"PKG",206,22,1,"PAH",1,1,4,0)
Functional Description:
"PKG",206,22,1,"PAH",1,1,5,0)
----------------------
"PKG",206,22,1,"PAH",1,1,6,0)
This Outpatient Pharmacy patch PSO*7*219 corrects the following issues:
"PKG",206,22,1,"PAH",1,1,7,0)
 
"PKG",206,22,1,"PAH",1,1,8,0)
1.  The Application Program Interface (API) that is provided to 
"PKG",206,22,1,"PAH",1,1,9,0)
Computerized Patient Record System (CPRS) with the service connection (SC)
"PKG",206,22,1,"PAH",1,1,10,0)
and environmental indicator (EI) questions was not set correctly for non
"PKG",206,22,1,"PAH",1,1,11,0)
service connected (NSC) patients, as a result the following issues were
"PKG",206,22,1,"PAH",1,1,12,0)
reported:
"PKG",206,22,1,"PAH",1,1,13,0)
 
"PKG",206,22,1,"PAH",1,1,14,0)
a. In CPRS, the SC related questions were incorrectly prompted for NSC
"PKG",206,22,1,"PAH",1,1,15,0)
patients, and it should not have done so. It should prompt SC/EI question
"PKG",206,22,1,"PAH",1,1,16,0)
only if applicable.(remedy ticket 114219).
"PKG",206,22,1,"PAH",1,1,17,0)
 
"PKG",206,22,1,"PAH",1,1,18,0)
b. Holders of the PSO COPAY key, the ordering provider, and the finishing
"PKG",206,22,1,"PAH",1,1,19,0)
pharmacist were receiving increased volumes of mailman messages in 
"PKG",206,22,1,"PAH",1,1,20,0)
Outpatient Pharmacy.  Mailman messages were incorrectly sent for NSC
"PKG",206,22,1,"PAH",1,1,21,0)
patients upon refill, new, and renewed orders (remedy ticket 114219).
"PKG",206,22,1,"PAH",1,1,22,0)
These messages have been eliminated.  Mailman messages will still be
"PKG",206,22,1,"PAH",1,1,23,0)
generated for the following scenarios:
"PKG",206,22,1,"PAH",1,1,24,0)
 
"PKG",206,22,1,"PAH",1,1,25,0)
                 SC percentage
"PKG",206,22,1,"PAH",1,1,26,0)
                 - age changed   E/I question
"PKG",206,22,1,"PAH",1,1,27,0)
     Type        to >0%          added?          Mailman Message sent?
"PKG",206,22,1,"PAH",1,1,28,0)
     ---------   --------------  -------------   -------------------------
"PKG",206,22,1,"PAH",1,1,29,0)
     NSC         N               N               N        
"PKG",206,22,1,"PAH",1,1,30,0)
 
"PKG",206,22,1,"PAH",1,1,31,0)
     NSC         N               Y               Y only if question was
"PKG",206,22,1,"PAH",1,1,32,0)
                                                     not answered before
"PKG",206,22,1,"PAH",1,1,33,0)
                                                     the prescription is
"PKG",206,22,1,"PAH",1,1,34,0)
                                                     released
"PKG",206,22,1,"PAH",1,1,35,0)
 
"PKG",206,22,1,"PAH",1,1,36,0)
     NSC         Y               N/A             Y if question was not
"PKG",206,22,1,"PAH",1,1,37,0)
                                                     answered before the
"PKG",206,22,1,"PAH",1,1,38,0)
                                                     prescription is
"PKG",206,22,1,"PAH",1,1,39,0)
                                                     released
"PKG",206,22,1,"PAH",1,1,40,0)
 
"PKG",206,22,1,"PAH",1,1,41,0)
     SC=>0%<50%  N/A             Y               Y  however, NO mailman
"PKG",206,22,1,"PAH",1,1,42,0)
                                                      message will be sent
"PKG",206,22,1,"PAH",1,1,43,0)
                                                      if any SC/EI = YES
"PKG",206,22,1,"PAH",1,1,44,0)
                                                      on the original
"PKG",206,22,1,"PAH",1,1,45,0)
                                                      prescription 
"PKG",206,22,1,"PAH",1,1,46,0)
 
"PKG",206,22,1,"PAH",1,1,47,0)
     For SC>50% prescriptions and if patient has a new SC/EI added, the
"PKG",206,22,1,"PAH",1,1,48,0)
     appropriate questions will be asked upon RENEW or COPY of the
"PKG",206,22,1,"PAH",1,1,49,0)
     original prescription. At release, a MailMan message will not be sent
"PKG",206,22,1,"PAH",1,1,50,0)
     if the patient, patient status, or drug is exempt from copay.
"PKG",206,22,1,"PAH",1,1,51,0)
 
"PKG",206,22,1,"PAH",1,1,52,0)
Because the information requested by these Mailman messages are used to 
"PKG",206,22,1,"PAH",1,1,53,0)
determine the final VA copay and/or insurance billable status, the text 
"PKG",206,22,1,"PAH",1,1,54,0)
and format has changed.  The subject line was changed from "RX COPAY 
"PKG",206,22,1,"PAH",1,1,55,0)
STATUS REVIEW NEEDED" to "PRESCRIPTION QUESTIONS REVIEW NEEDED" and the
"PKG",206,22,1,"PAH",1,1,56,0)
body of the message has additional information.  Also, the eligibility and
"PKG",206,22,1,"PAH",1,1,57,0)
disability information is now included after the patient name. The
"PKG",206,22,1,"PAH",1,1,58,0)
following is an example:
"PKG",206,22,1,"PAH",1,1,59,0)
 
"PKG",206,22,1,"PAH",1,1,60,0)
Subj: PRESCRIPTION QUESTIONS REVIEW NEEDED (800)  [#164897] 10/07/05@13:39
"PKG",206,22,1,"PAH",1,1,61,0)
37 lines
"PKG",206,22,1,"PAH",1,1,62,0)
From: OUTPATIENT PHARMACY PACKAGE  In 'IN' basket.   Page 1  *New*
"PKG",206,22,1,"PAH",1,1,63,0)
-------------------------------------------------------------------------
"PKG",206,22,1,"PAH",1,1,64,0)
 
"PKG",206,22,1,"PAH",1,1,65,0)
PATIENT,TEST  (XXXX)  
"PKG",206,22,1,"PAH",1,1,66,0)
Eligibility: SC LESS THAN 50%     SC%: 10
"PKG",206,22,1,"PAH",1,1,67,0)
             REIMBURSABLE INSURANCE
"PKG",206,22,1,"PAH",1,1,68,0)
 
"PKG",206,22,1,"PAH",1,1,69,0)
Disabilities: ARTHRITIS-10%(SC), FOREARM CONDITION-5%(NSC), 
"PKG",206,22,1,"PAH",1,1,70,0)
              FOREARM CONDITION-4%(NSC), BENIGN EYE GROWTH-0%(NSC), 
"PKG",206,22,1,"PAH",1,1,71,0)
              LOSS OF FIELD OF VISION-20%(SC), 
"PKG",206,22,1,"PAH",1,1,72,0)
 
"PKG",206,22,1,"PAH",1,1,73,0)
Rx# #######B (1)    NO COPAY
"PKG",206,22,1,"PAH",1,1,74,0)
AMITRIPTYLINE 100MG
"PKG",206,22,1,"PAH",1,1,75,0)
 
"PKG",206,22,1,"PAH",1,1,76,0)
Due to a change in criteria, additional information listed below is needed
"PKG",206,22,1,"PAH",1,1,77,0)
to determine the final VA copay and/or insurance billable status for this 
"PKG",206,22,1,"PAH",1,1,78,0)
Rx so that appropriate action can be taken by pharmacy personnel.
"PKG",206,22,1,"PAH",1,1,79,0)
 
"PKG",206,22,1,"PAH",1,1,80,0)
Is this Rx for a Service Connected Condition?
"PKG",206,22,1,"PAH",1,1,81,0)
 
"PKG",206,22,1,"PAH",1,1,82,0)
 
"PKG",206,22,1,"PAH",1,1,83,0)
Enter RETURN to continue or '^' to exit: 
"PKG",206,22,1,"PAH",1,1,84,0)
 
"PKG",206,22,1,"PAH",1,1,85,0)
 
"PKG",206,22,1,"PAH",1,1,86,0)
Subj: PRESCRIPTION QUESTIONS REVIEW NEEDED (800)  [#164897]   Page 2
"PKG",206,22,1,"PAH",1,1,87,0)
--------------------------------------------------------------------------
"PKG",206,22,1,"PAH",1,1,88,0)
 
"PKG",206,22,1,"PAH",1,1,89,0)
This message has been sent to the provider of record, the pharmacist who
"PKG",206,22,1,"PAH",1,1,90,0)
finished the prescription order, and all holders of the PSO COPAY key.
"PKG",206,22,1,"PAH",1,1,91,0)
 
"PKG",206,22,1,"PAH",1,1,92,0)
Providers:
"PKG",206,22,1,"PAH",1,1,93,0)
Please respond with your answer to the question(s) as a reply to this
"PKG",206,22,1,"PAH",1,1,94,0)
message. The prescription will be updated by the appropriate staff.
"PKG",206,22,1,"PAH",1,1,95,0)
 
"PKG",206,22,1,"PAH",1,1,96,0)
Staff assigned to update the Prescription responses:
"PKG",206,22,1,"PAH",1,1,97,0)
Please use the RESET COPAY STATUS/CANCEL CHARGES option to enter the 
"PKG",206,22,1,"PAH",1,1,98,0)
responses to the questions above, which may result in a Rx copay status
"PKG",206,22,1,"PAH",1,1,99,0)
change and/or the need to remove VA copay charges or may result in a
"PKG",206,22,1,"PAH",1,1,100,0)
charge to the patient's insurance carrier.
"PKG",206,22,1,"PAH",1,1,101,0)
 
"PKG",206,22,1,"PAH",1,1,102,0)
Note: The SC question is now asked for Veterans who are SC>49% in order to
"PKG",206,22,1,"PAH",1,1,103,0)
determine if the Rx can be billed to a third party insurance. These 
"PKG",206,22,1,"PAH",1,1,104,0)
Veterans will NOT be charged a VA copay.
"PKG",206,22,1,"PAH",1,1,105,0)
 
"PKG",206,22,1,"PAH",1,1,106,0)
Supply and investigational drugs are not charged a VA copay but could be
"PKG",206,22,1,"PAH",1,1,107,0)
reimbursable by third party insurance.
"PKG",206,22,1,"PAH",1,1,108,0)
 
"PKG",206,22,1,"PAH",1,1,109,0)
Enter message action (in IN basket): Ignore// 
"PKG",206,22,1,"PAH",1,1,110,0)
 
"PKG",206,22,1,"PAH",1,1,111,0)
c.  In CPRS, SC/EI related questions were not asked for supply items 
"PKG",206,22,1,"PAH",1,1,112,0)
and investigational drugs (remedy ticket 11421). CPRS and backdoor 
"PKG",206,22,1,"PAH",1,1,113,0)
Outpatient Pharmacy users will be required to complete SC/EI questions for
"PKG",206,22,1,"PAH",1,1,114,0)
supplies and investigational drugs. Supply items and investigational drugs
"PKG",206,22,1,"PAH",1,1,115,0)
could be reimbursable by third party insurance. Also, a VA copay will not
"PKG",206,22,1,"PAH",1,1,116,0)
be charged for these.
"PKG",206,22,1,"PAH",1,1,117,0)
 
"PKG",206,22,1,"PAH",1,1,118,0)
2.  During use of Complete Orders from OERR option [PSO LMOE FINISH], the
"PKG",206,22,1,"PAH",1,1,119,0)
default answers for SC/EI's for CPRS SC>50% renewed orders were
"PKG",206,22,1,"PAH",1,1,120,0)
occasionally displaying the previous orders answers during the finish
"PKG",206,22,1,"PAH",1,1,121,0)
process.  A modification was made to display the SC/EI information entered
"PKG",206,22,1,"PAH",1,1,122,0)
during the CPRS renewal process.  This anomaly was encountered during
"PKG",206,22,1,"PAH",1,1,123,0)
unit testing, and there is no associated remedy ticket.
"PKG",206,22,1,"PAH",1,1,124,0)
 
"PKG",206,22,1,"PAH",1,1,125,0)
3.  For renewal orders in Complete Orders from OERR option [PSO LMOE 
"PKG",206,22,1,"PAH",1,1,126,0)
FINISH] and Patient Prescription Processing option [PSO LM BACKDOOR 
"PKG",206,22,1,"PAH",1,1,127,0)
ORDERS], a message was erroneously displayed after the SC/EI prompts for
"PKG",206,22,1,"PAH",1,1,128,0)
SC>50% prescriptions.  The following is an example of the message
"PKG",206,22,1,"PAH",1,1,129,0)
displayed when eligibility is changed or the user enters an up arrows (^)
"PKG",206,22,1,"PAH",1,1,130,0)
at an outpatient classification prompt.  Note that the bracketed
"PKG",206,22,1,"PAH",1,1,131,0)
information can be SERVICE CONNECTED or NON SERVICE CONNECTED depending
"PKG",206,22,1,"PAH",1,1,132,0)
upon the user's response to the question.  Or if the user up arrows (^)
"PKG",206,22,1,"PAH",1,1,133,0)
out of the prompt, the default answer determines the value.
"PKG",206,22,1,"PAH",1,1,134,0)
 
"PKG",206,22,1,"PAH",1,1,135,0)
           Was treatment for a Service Connected condition? YES// ^
"PKG",206,22,1,"PAH",1,1,136,0)
           This Renewal has been designated as [SERVICE CONNECTED]
"PKG",206,22,1,"PAH",1,1,137,0)
           Please use the 'Reset Copay Status/Cancel Charges' option to
"PKG",206,22,1,"PAH",1,1,138,0)
           make corrections.
"PKG",206,22,1,"PAH",1,1,139,0)
 
"PKG",206,22,1,"PAH",1,1,140,0)
The "Please use the 'Reset Copay Status/Cancel Charges' option to make
"PKG",206,22,1,"PAH",1,1,141,0)
corrections" sentence will no longer be displayed for supply items,
"PKG",206,22,1,"PAH",1,1,142,0)
investigational drugs, and SC>50% patients.  The first sentence will
"PKG",206,22,1,"PAH",1,1,143,0)
remain in order to continue to inform the user of the answer stored for
"PKG",206,22,1,"PAH",1,1,144,0)
the prompt.  Note that similar messages are displayed for environmental
"PKG",206,22,1,"PAH",1,1,145,0)
indicator prompts and this change applies to them. The associated remedy
"PKG",206,22,1,"PAH",1,1,146,0)
tickets are 11393 and 113931.
"PKG",206,22,1,"PAH",1,1,147,0)
 
"PKG",206,22,1,"PAH",1,1,148,0)
4.  For CPRS prescription orders finished using the Complete Orders from
"PKG",206,22,1,"PAH",1,1,149,0)
OERR option [PSO LMOE FINISH] or the Patient Prescription Processing
"PKG",206,22,1,"PAH",1,1,150,0)
option [PSO LM BACKDOOR ORDERS], a copay related message was displayed for
"PKG",206,22,1,"PAH",1,1,151,0)
SC>50% patients, supply items and investigational drugs.  The following is
"PKG",206,22,1,"PAH",1,1,152,0)
an example, and please note that bracketed information can be either COPAY
"PKG",206,22,1,"PAH",1,1,153,0)
or NO COPAY depending on the providers response to the clinical indicator.
"PKG",206,22,1,"PAH",1,1,154,0)
 
"PKG",206,22,1,"PAH",1,1,155,0)
     Do you want to enter a Progress Note? No//   NO
"PKG",206,22,1,"PAH",1,1,156,0)
 
"PKG",206,22,1,"PAH",1,1,157,0)
            SC Percent: 40%
"PKG",206,22,1,"PAH",1,1,158,0)
            Disabilities: NONE STATED
"PKG",206,22,1,"PAH",1,1,159,0)
 
"PKG",206,22,1,"PAH",1,1,160,0)
     This Rx has been flagged by the provider as: [NO COPAY]
"PKG",206,22,1,"PAH",1,1,161,0)
 
"PKG",206,22,1,"PAH",1,1,162,0)
     Was treatment for Service Connected condition? YES
"PKG",206,22,1,"PAH",1,1,163,0)
 
"PKG",206,22,1,"PAH",1,1,164,0)
The "This Rx has been flagged by the provider as: [COPAY/NO COPAY]"
"PKG",206,22,1,"PAH",1,1,165,0)
message will no longer be displayed for SC>50% patients, supply items, 
"PKG",206,22,1,"PAH",1,1,166,0)
and investigational drugs.  There is no associated remedy ticket.
"PKG",206,22,1,"PAH",1,1,167,0)
 
"PKG",206,22,1,"PAH",1,1,168,0)
5.  When an edit that creates a new order is performed in Outpatient 
"PKG",206,22,1,"PAH",1,1,169,0)
Pharmacy, a message is displayed to notate that the orderable item was
"PKG",206,22,1,"PAH",1,1,170,0)
changed.  This message is displayed in the Complete Orders from OERR
"PKG",206,22,1,"PAH",1,1,171,0)
[PSO LMOE FINISH] option and the Patient Prescription Processing option
"PKG",206,22,1,"PAH",1,1,172,0)
[PSO LM BACKDOOR ORDERS]. The following is an example:
"PKG",206,22,1,"PAH",1,1,173,0)
 
"PKG",206,22,1,"PAH",1,1,174,0)
      CARBAMAZEPINE 100MG TAB
"PKG",206,22,1,"PAH",1,1,175,0)
      PROVIDER,NAME           PROVIDER,NAME
"PKG",206,22,1,"PAH",1,1,176,0)
      # of Refills: 3
"PKG",206,22,1,"PAH",1,1,177,0)
 
"PKG",206,22,1,"PAH",1,1,178,0)
      The Pharmacy Orderable Item has changed for this order. Please
"PKG",206,22,1,"PAH",1,1,179,0)
      review any existing medication copay exemption defaults carefully
"PKG",206,22,1,"PAH",1,1,180,0)
      for appropriateness.
"PKG",206,22,1,"PAH",1,1,181,0)
 
"PKG",206,22,1,"PAH",1,1,182,0)
      SC Percent: 40%
"PKG",206,22,1,"PAH",1,1,183,0)
      Disabilities: NONE STATED
"PKG",206,22,1,"PAH",1,1,184,0)
 
"PKG",206,22,1,"PAH",1,1,185,0)
      Was treatment for Service Connected condition? YES// 
"PKG",206,22,1,"PAH",1,1,186,0)
 
"PKG",206,22,1,"PAH",1,1,187,0)
The above message has been modified to the following:
"PKG",206,22,1,"PAH",1,1,188,0)
 
"PKG",206,22,1,"PAH",1,1,189,0)
      The Pharmacy Orderable Item has changed for this order. Please
"PKG",206,22,1,"PAH",1,1,190,0)
      review any existing SC or Environmental Indicator defaults carefully
"PKG",206,22,1,"PAH",1,1,191,0)
      for appropriateness.
"PKG",206,22,1,"PAH",1,1,192,0)
 
"PKG",206,22,1,"PAH",1,1,193,0)
Technical Description:
"PKG",206,22,1,"PAH",1,1,194,0)
----------------------
"PKG",206,22,1,"PAH",1,1,195,0)
The following correlates to each sequence in the Functional Description 
"PKG",206,22,1,"PAH",1,1,196,0)
above and the routines modified are shown in parentheses by each function:
"PKG",206,22,1,"PAH",1,1,197,0)
 
"PKG",206,22,1,"PAH",1,1,198,0)
1.  The SCNEW^PSOCP API was returning PSOTG("SC")="" variable for NSC
"PKG",206,22,1,"PAH",1,1,199,0)
patients which caused CPRS to erroneously prompt for them.  Also due to
"PKG",206,22,1,"PAH",1,1,200,0)
this, Mailman messages for "RX COPAY STATUS REVIEW NEEDED" information was
"PKG",206,22,1,"PAH",1,1,201,0)
sent in error for NSC prescriptions at release of the prescription. These
"PKG",206,22,1,"PAH",1,1,202,0)
issues were corrected, and the PSOCPE routine was modified to show the
"PKG",206,22,1,"PAH",1,1,203,0)
patient's eligibilities and disabilities as well as impart more accurate
"PKG",206,22,1,"PAH",1,1,204,0)
information.
"PKG",206,22,1,"PAH",1,1,205,0)
 
"PKG",206,22,1,"PAH",1,1,206,0)
 2.  Modified renewal routines to always pull SC/EI information from the
"PKG",206,22,1,"PAH",1,1,207,0)
data passed on the renewed order from CPRS (PSORENW1, PSORN52, PSORN52D).
"PKG",206,22,1,"PAH",1,1,208,0)
This change affects renewals from CPRS and backdoor Outpatient Pharmacy
"PKG",206,22,1,"PAH",1,1,209,0)
orders.
"PKG",206,22,1,"PAH",1,1,210,0)
 
"PKG",206,22,1,"PAH",1,1,211,0)
3.  For SC>50% prescriptions, supply items and investigational drugs,
"PKG",206,22,1,"PAH",1,1,212,0)
eliminated the display of "Please use the 'Reset Copay Status/Cancel
"PKG",206,22,1,"PAH",1,1,213,0)
Charges' option to make corrections." sentence (PSOCPB, PSOMLLD2,
"PKG",206,22,1,"PAH",1,1,214,0)
PSOMLLDT), but it will continue to be displayed for SC<50% prescriptions.
"PKG",206,22,1,"PAH",1,1,215,0)
 
"PKG",206,22,1,"PAH",1,1,216,0)
4.  For SC>50% prescriptions, supply items and investigational drugs,
"PKG",206,22,1,"PAH",1,1,217,0)
eliminated the display of "This Rx has been flagged by the provider as:
"PKG",206,22,1,"PAH",1,1,218,0)
[COPAY/NO COPAY]" (PSOCPB, PSONEWF, PSORN52).  This message will continue
"PKG",206,22,1,"PAH",1,1,219,0)
to be displayed for SC<50% patients.
"PKG",206,22,1,"PAH",1,1,220,0)
 
"PKG",206,22,1,"PAH",1,1,221,0)
5.  For SC 0-100%, supply items and investigational drugs, modified the 
"PKG",206,22,1,"PAH",1,1,222,0)
wording of the message displayed when a prescription edit that creates a 
"PKG",206,22,1,"PAH",1,1,223,0)
new order is performed (PSOCPB, PSONEWF, PSONEWG).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","PSOCP")
0^1^B75128860
"RTN","PSOCP",1,0)
PSOCP ;BIR/BAB - Pharmacy CO-PAY Application Utilities for IB ;02/06/92
"RTN","PSOCP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,46,71,85,137,157,143,219**;DEC 1997
"RTN","PSOCP",3,0)
 ;
"RTN","PSOCP",4,0)
 ;REF/IA
"RTN","PSOCP",5,0)
 ;IBARX/125
"RTN","PSOCP",6,0)
 ;SDCO22/1579
"RTN","PSOCP",7,0)
 ;PS(55/2228
"RTN","PSOCP",8,0)
 ;PSDRUG(/221
"RTN","PSOCP",9,0)
 ;VADPT/10061
"RTN","PSOCP",10,0)
 ;DGMSTAPI/2716
"RTN","PSOCP",11,0)
CP ;Check if COPAY-Requires RXP,PSOSITE7
"RTN","PSOCP",12,0)
 I '$D(PSOPAR) D ^PSOLSET G CP
"RTN","PSOCP",13,0)
 K PSOCP
"RTN","PSOCP",14,0)
 S PSOCPN=$P(^PSRX(RXP,0),"^",2) ; Set COPAY dfn PTR TO PATIENT
"RTN","PSOCP",15,0)
 S PSOCP=$P($G(^PSRX(RXP,"IB")),"^") ; IB action type
"RTN","PSOCP",16,0)
 S PSOSAVE=$S(PSOCP:1,1:"") ; save current copay status
"RTN","PSOCP",17,0)
 ;   Set x=service^dfn^actiontype^user duz
"RTN","PSOCP",18,0)
 I +$G(PSOSITE7)'>0 S PSOSITE7=$P(^PS(59,PSOSITE,"IB"),"^")
"RTN","PSOCP",19,0)
 S X=PSOSITE7_"^"_PSOCPN_"^"_PSOCP_"^"_$P(^PSRX(RXP,0),"^",16)
"RTN","PSOCP",20,0)
 ;
"RTN","PSOCP",21,0)
RX ;Determine Orig or Refill for RX
"RTN","PSOCP",22,0)
 N PSOIB
"RTN","PSOCP",23,0)
 S PSOIB=0
"RTN","PSOCP",24,0)
 S PSOREF=0
"RTN","PSOCP",25,0)
 I $G(^PSRX(RXP,1,+$G(YY),0))]"" S PSOREF=YY
"RTN","PSOCP",26,0)
 ; Check if bill # already exists for this RX or Refill
"RTN","PSOCP",27,0)
 I 'PSOREF,+$P($G(^PSRX(RXP,"IB")),"^",2)>0 D CHKIB^PSOCP1 I PSOIB G QUIT
"RTN","PSOCP",28,0)
 I 'PSOREF,+$P($G(^PSRX(RXP,"IB")),"^",4)>0 G QUIT ; 'POTENTIAL BILL' - ALREADY ATTEMPTED TO BILL, BUT EXCEEDED ANNUAL COPAY CAP
"RTN","PSOCP",29,0)
 I PSOREF,+$G(^PSRX(RXP,1,PSOREF,"IB")) D CHKIB^PSOCP1 I PSOIB G QUIT
"RTN","PSOCP",30,0)
 I PSOREF,+$P($G(^PSRX(RXP,1,PSOREF,"IB")),"^",2) G QUIT ; POTENTIAL BILL
"RTN","PSOCP",31,0)
 S PSOCHG=1 ; set tem variable to copay and then look for exceptions
"RTN","PSOCP",32,0)
 N MAILMSG
"RTN","PSOCP",33,0)
 D COPAYREL
"RTN","PSOCP",34,0)
 I 'PSOCHG D  G QUIT
"RTN","PSOCP",35,0)
 . I PSOSAVE S PSODA=RXP,PREA="R" D ACTLOG^PSOCPA S $P(^PSRX(RXP,"IB"),"^",1)=""
"RTN","PSOCP",36,0)
 I PSOCHG=2 D  I 'PSOCP G QUIT ; IF 'SC' QUESTION APPLIES, BUT HAS NOT BEEN ANSWERED, SEND MAIL MSG AND KEEP COPAY STATUS AS IT WAS
"RTN","PSOCP",37,0)
 . D MAIL2^PSOCPE ; SEND MAIL TO PHARMACIST, PROVIDER, AND HOLDERS OF THE PSO COPAY KEY
"RTN","PSOCP",38,0)
 I PSOCHG=1,PSOSAVE="" D  I PSOREF S PSOCOMM="",PSOOLD="No Copay",PSONW="Copay" S PSODA=RXP,PREA="R" D ACTLOG^PSOCPA
"RTN","PSOCP",39,0)
 . I '$D(^PSRX(RXP,"IB")),'PSOREF S $P(^PSRX(RXP,"IB"),"^",1)=1 Q
"RTN","PSOCP",40,0)
 . S $P(^PSRX(RXP,"IB"),"^",1)=1
"RTN","PSOCP",41,0)
 . S PSOCP=1,$P(X,"^",3)=PSOCP
"RTN","PSOCP",42,0)
 I PSOCHG'=2 I $G(MAILMSG) D MAIL2^PSOCPE ; SEND MAIL TO PHARMACIST, PROVIDER, AND HOLDERS OF PSO COPAY KEY
"RTN","PSOCP",43,0)
 ;         Units for COPAY
"RTN","PSOCP",44,0)
 S PSOCPUN=$P(($P(^PSRX(RXP,0),"^",8)+29)/30,".",1)
"RTN","PSOCP",45,0)
 ;         Build softlink for x(n)=softlink^units
"RTN","PSOCP",46,0)
 S X(1)="52:"_RXP S:PSOREF>0 X(1)=X(1)_";1:"_PSOREF S X(1)=X(1)_"^"_PSOCPUN
"RTN","PSOCP",47,0)
 ;   Set correct user duz if refill
"RTN","PSOCP",48,0)
 I PSOREF S:+$P(^PSRX(RXP,1,PSOREF,0),"^",7)>0 $P(X,"^",4)=$P(^PSRX(RXP,1,PSOREF,0),"^",7)
"RTN","PSOCP",49,0)
 ;
"RTN","PSOCP",50,0)
IBNEW ;  Load ^TMP global for IB call
"RTN","PSOCP",51,0)
 Q:$G(RXP)'>0
"RTN","PSOCP",52,0)
 N D0
"RTN","PSOCP",53,0)
 G QUIT:'$D(X)
"RTN","PSOCP",54,0)
 S XTMP=X,XTMP(1)=X(1)
"RTN","PSOCP",55,0)
 ;
"RTN","PSOCP",56,0)
 ;   Requires x=service^dfn^action type^user duz
"RTN","PSOCP",57,0)
 ;        x(n)=softlink^units 
"RTN","PSOCP",58,0)
 I $P(X,"^",3)="" S $P(X,"^",3)=$P(^PSRX(RXP,"IB"),"^",1)
"RTN","PSOCP",59,0)
 D NEW^IBARX
"RTN","PSOCP",60,0)
 ;         Returns y=1^total charges for this group or Y=-1^error code
"RTN","PSOCP",61,0)
 ;              y(n)=IB number^charge for this Rx^AR bill #^Cap met^Partial or Full charge^Copay Exempt^Number from file 354.71
"RTN","PSOCP",62,0)
 ;                   Cap met ('1' - If patient has met cap amount or 
"RTN","PSOCP",63,0)
 ;                     reached cap with this charge or '0' if not)
"RTN","PSOCP",64,0)
 ;                   Partial or Full ('P' for partial billing, 'F' for
"RTN","PSOCP",65,0)
 ;                     full billing, null for no billing)
"RTN","PSOCP",66,0)
 ;                   Copay Exempt - ('1' for exempt, '0' for non-exempt,
"RTN","PSOCP",67,0)
 ;                     '-1' for copay off (manila))
"RTN","PSOCP",68,0)
 ;                   ('1' - If patient has met cap amount or reach cap with this charge
"RTN","PSOCP",69,0)
 ;                  Entry from file 354.71 will only be saved for fills that met the annual cap and could not be fully billed
"RTN","PSOCP",70,0)
 ;
"RTN","PSOCP",71,0)
 G QUIT:+Y=-1
"RTN","PSOCP",72,0)
 S XTMP=XTMP_"^"_Y,XTMP(1)=XTMP(1)_"^"_Y(1)
"RTN","PSOCP",73,0)
 ;
"RTN","PSOCP",74,0)
 ; see if exempt or copay cap was met for this fill
"RTN","PSOCP",75,0)
 I $P(Y(1),"^",6) D  G QUIT
"RTN","PSOCP",76,0)
 . S PREA="R",PSOOLD="Copay",PSONW="No Copay"
"RTN","PSOCP",77,0)
 . S PSOCOMM="RX COPAY INCOME EXEMPTION" S PSODA=RXP D ACTLOG^PSOCPA
"RTN","PSOCP",78,0)
 . S $P(^PSRX(RXP,"IB"),"^",1)=""
"RTN","PSOCP",79,0)
 I $P(Y(1),"^",4) D
"RTN","PSOCP",80,0)
 . S PSOCOMM=$S($P(Y(1),"^",5)="F":" FULL BILLING FOR THIS FILL",$P(Y(1),"^",5)="P":" PARTIAL BILLING FOR THIS FILL ",1:" NO BILLING FOR THIS FILL")
"RTN","PSOCP",81,0)
 . S PREA="A"
"RTN","PSOCP",82,0)
 . S PSODA=RXP D ACTLOG^PSOCPA
"RTN","PSOCP",83,0)
 . I $P(Y(1),"^",5)'="F" D
"RTN","PSOCP",84,0)
 . . I PSOREF S $P(^PSRX(RXP,1,PSOREF,"IB"),"^",2)=$P(Y(1),"^",7) Q
"RTN","PSOCP",85,0)
 . . S $P(^PSRX(RXP,"IB"),"^",4)=$P(Y(1),"^",7)
"RTN","PSOCP",86,0)
 I $P(Y(1),"^",1)="" G QUIT
"RTN","PSOCP",87,0)
 ;
"RTN","PSOCP",88,0)
FILE ;         File IB number in ^PSRX
"RTN","PSOCP",89,0)
 S PSOCP2=0
"RTN","PSOCP",90,0)
 S PSOCP2=+$P(XTMP(1),":",3)
"RTN","PSOCP",91,0)
 S:PSOCP2>0 ^PSRX(RXP,1,PSOCP2,"IB")=$P(XTMP(1),U,3) ;  Filing in refill node
"RTN","PSOCP",92,0)
 I PSOCP2>0,'$D(^PSRX(RXP,"IB")) S ^PSRX(RXP,"IB")="1^^" ;  If refill "IB" exists, need "IB" entry on original fill node
"RTN","PSOCP",93,0)
 S:PSOCP2=0 $P(^PSRX(RXP,"IB"),"^",2)=$P(XTMP(1),U,3) ;Filing in original fill (zero node)
"RTN","PSOCP",94,0)
QUIT ;
"RTN","PSOCP",95,0)
 K Y,PSOCP1,PSOCP2,QQ,PSOCPN,X,X2,XTMP,PSOCPUN,PSOREF,PSOCHG,PSOSAVE,PSOCOMM,PSOOLD,PSONW,PREA,PSORSN
"RTN","PSOCP",96,0)
 Q
"RTN","PSOCP",97,0)
EN D ^PSOLSET
"RTN","PSOCP",98,0)
EN1 S DIR(0)="NO",DIR("A")="Enter PRESCRIPTION number" D ^DIR K DIR G:$D(DIRUT) EXIT S RXP=X I +$G(^PSRX(RXP,0))'>0!+$P($G(^PSRX(RXP,"IB")),"^",0)>0 W !,?10,"RE-CHECK PRESCRIPTION NUMBER AND RE-ENTER " G EN1
"RTN","PSOCP",99,0)
 S PSOSITE7=$P(^PS(59,PSOSITE,"IB"),"^")
"RTN","PSOCP",100,0)
 S PSODFN=$P(^PSRX(RXP,0),"^",2)
"RTN","PSOCP",101,0)
 D CP G EN1
"RTN","PSOCP",102,0)
EXIT K RXP D FINAL^PSOLSET Q
"RTN","PSOCP",103,0)
 ;
"RTN","PSOCP",104,0)
SC(PSODFN,PSODD) ;supported reference for CPRS, Pre-Copay enhancement
"RTN","PSOCP",105,0)
 N PSOSC
"RTN","PSOCP",106,0)
 I $$DT^PSOMLLDT S PSOSC="" G SCQ
"RTN","PSOCP",107,0)
 I $G(PSODD),($P($G(^PSDRUG(PSODD,0)),"^",3)["S")!($P($G(^(0)),"^",3)["I") S PSOSC=1 G SCQ
"RTN","PSOCP",108,0)
 I $P($G(^PS(55,+$G(PSODFN),"PS")),"^"),$P($G(^PS(53,+$P(^("PS"),"^"),0)),"^",7) S PSOSC=1 G SCQ
"RTN","PSOCP",109,0)
 N I,J,X S (X,PSOSC)=""
"RTN","PSOCP",110,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",111,0)
 G:'X SCQ
"RTN","PSOCP",112,0)
 S X=X_"^"_PSODFN D XTYPE^IBARX
"RTN","PSOCP",113,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSC=I
"RTN","PSOCP",114,0)
SCQ Q $S($G(PSOSC)=2:0,1:1)
"RTN","PSOCP",115,0)
 ;
"RTN","PSOCP",116,0)
COPAYREL ; Recheck copay status at release
"RTN","PSOCP",117,0)
 ;
"RTN","PSOCP",118,0)
 ; check Rx patient status
"RTN","PSOCP",119,0)
 I $P(^PSRX(RXP,0),"^",3)'="",$P($G(^PS(53,$P(^PSRX(RXP,0),"^",3),0)),"^",7)=1 S PSOCHG=0,PSOCOMM="Rx Patient Status Change",PSOOLD="Copay",PSONW="No Copay" Q
"RTN","PSOCP",120,0)
 ; see if drug is investigational or supply
"RTN","PSOCP",121,0)
 N DRG,DRGTYP,X
"RTN","PSOCP",122,0)
 S DRG=+$P(^PSRX(RXP,0),"^",6),DRGTYP=$P($G(^PSDRUG(DRG,0)),"^",3)
"RTN","PSOCP",123,0)
 I DRGTYP["I" S PSOCOMM="Investigational Drug",PSOCHG=0,PSOOLD="Copay",PSONW="No Copay",PSOCHG=0
"RTN","PSOCP",124,0)
 I DRGTYP["S" S PSOCOMM="Supply Item",PSOCHG=0,PSOOLD="Copay",PSONW="No Copay",PSOCHG=0
"RTN","PSOCP",125,0)
 K PSOTG,CHKXTYPE
"RTN","PSOCP",126,0)
 I +$G(^PSRX(RXP,"IBQ")) D XTYPE1^PSOCP1
"RTN","PSOCP",127,0)
 I $G(^PSRX(RXP,"IBQ"))["1" D  S PSOCHG=0,PSOOLD="Copay",PSONW="No Copay" Q  ; COPAY EXEMPT
"RTN","PSOCP",128,0)
 . N EXMT,II,PSOCIBQ
"RTN","PSOCP",129,0)
 . S PSOCIBQ=$G(^PSRX(RXP,"IBQ"))
"RTN","PSOCP",130,0)
 . F II=1,7,3,4,5,6,2 I $P(PSOCIBQ,"^",II)=1 S EXMT=$S(II=1:"SC",II=7:"CV",II=3:"AO",II=4:"IR",II=5:"EC",II=2:"MST",II=6:"HNC",1:"") D:EXMT'="" SETCOMM Q
"RTN","PSOCP",131,0)
 D SCNEW(.PSOTG,PSOCPN,DRG,RXP)
"RTN","PSOCP",132,0)
 N EXMT
"RTN","PSOCP",133,0)
 I '$D(CHKXTYPE) D XTYPE
"RTN","PSOCP",134,0)
 F EXMT="SC","CV","AO","IR","EC","MST","HNC" I $D(PSOTG(EXMT)) D  I 'PSOCHG Q
"RTN","PSOCP",135,0)
 . I PSOTG(EXMT)=1 S PSOCHG=0 D SETCOMM
"RTN","PSOCP",136,0)
 I 'PSOCHG S PSOOLD="Copay",PSONW="No Copay" Q
"RTN","PSOCP",137,0)
 ;
"RTN","PSOCP",138,0)
 ; If any of the applicable exemption questions have never been answered, generate a mail message with all of the questions
"RTN","PSOCP",139,0)
 S EXMT="",MAILMSG=0 F  S EXMT=$O(PSOTG(EXMT)) Q:EXMT=""  I PSOTG(EXMT)="" S MAILMSG=1 Q
"RTN","PSOCP",140,0)
 I MAILMSG,$D(PSOTG("SC")) I $G(PSOTG("SC"))="" S PSOCHG=2 ; 'SC' question not answered, don't reset copay status to 'copay'
"RTN","PSOCP",141,0)
 Q
"RTN","PSOCP",142,0)
 ;
"RTN","PSOCP",143,0)
SCNEW(PSOTG,PSOPT,PSODR,PSORN) ;CPRS supported reference
"RTN","PSOCP",144,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSOCP",145,0)
 I '$G(PSOPT) Q
"RTN","PSOCP",146,0)
 ;I $G(PSODR),($P($G(^PSDRUG(PSODR,0)),"^",3)["S")!($P($G(^(0)),"^",3)["I") Q ;CIDC ALWAYS ASK
"RTN","PSOCP",147,0)
 N PSOCIBQ,PSOQMSH,PSOQVEH,PSOQRQD,PSOQHNC,PSOQPGW,DFN,PSOSCA
"RTN","PSOCP",148,0)
 K PSOSCP,PSOANSQ("SC>50")
"RTN","PSOCP",149,0)
 S DFN=PSOPT D ELIG^VADPT S PSOSCP="",PSOSCP=$P(VAEL(3),U,2) S:PSOSCP=""&($P(VAEL(3),U,1)=1) PSOSCP=0 S:PSOSCP>49 PSOANSQ("SC>50")=1 S PSOSCA=$$SC^SDCO22(DFN) K VAEL
"RTN","PSOCP",150,0)
 I $G(PSORN) S PSOCIBQ=$G(^PSRX(PSORN,"IBQ"))
"RTN","PSOCP",151,0)
 I $G(PSORN)&(PSOSCP>49) D
"RTN","PSOCP",152,0)
 . I $D(^PSRX(PSORN,"ICD",1,0)) N ZXX S ZXX=^PSRX(PSORN,"ICD",1,0) D
"RTN","PSOCP",153,0)
 .. S PSOCIBQ=$P(ZXX,U,4)_"^"_$P(ZXX,U,6)_"^"_$P(ZXX,U,2)_"^"_$P(ZXX,U,3)_"^"_$P(ZXX,U,5)_"^"_$P(ZXX,U,7)_"^"_$P(ZXX,U,8)
"RTN","PSOCP",154,0)
 I '$G(PSORN) S PSOCIBQ=""
"RTN","PSOCP",155,0)
 ;Rx Patient Status check is not being done here
"RTN","PSOCP",156,0)
 N PSOSCMX,Y,I,J,X S (X,PSOSCMX)=""
"RTN","PSOCP",157,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",158,0)
 G:'X SKIP
"RTN","PSOCP",159,0)
 S X=X_"^"_PSOPT D XTYPE^IBARX
"RTN","PSOCP",160,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSCMX=I
"RTN","PSOCP",161,0)
SKIP ;
"RTN","PSOCP",162,0)
 I $G(PSOSCA)!($G(PSOSCP)>49) S PSOTG("SC")=$S($P(PSOCIBQ,"^")=1:1,$P(PSOCIBQ,"^")=0:0,$G(PSORN)&($P($G(^PSRX(+$G(PSORN),"IB")),"^")):0,1:"")
"RTN","PSOCP",163,0)
 S:$$AO^SDCO22(PSOPT) PSOTG("AO")=$S($P(PSOCIBQ,"^",3)=1:1,$P(PSOCIBQ,"^",3)=0:0,1:"")
"RTN","PSOCP",164,0)
 S:$$IR^SDCO22(PSOPT) PSOTG("IR")=$S($P(PSOCIBQ,"^",4)=1:1,$P(PSOCIBQ,"^",4)=0:0,1:"")
"RTN","PSOCP",165,0)
 S:$$EC^SDCO22(PSOPT) PSOTG("EC")=$S($P(PSOCIBQ,"^",5)=1:1,$P(PSOCIBQ,"^",5)=0:0,1:"")
"RTN","PSOCP",166,0)
 S:$P($$GETSTAT^DGMSTAPI(PSOPT),"^",2)="Y" PSOTG("MST")=$S($P(PSOCIBQ,"^",2)=1:1,$P(PSOCIBQ,"^",2)=0:0,1:"")
"RTN","PSOCP",167,0)
 I $T(GETCUR^DGNTAPI)]"" N PSONC,PSONCX S PSONCX=$$GETCUR^DGNTAPI(PSOPT,"PSONC") I $P($G(PSONC("IND")),"^")="Y" S PSOTG("HNC")=$S($P(PSOCIBQ,"^",6)=1:1,$P(PSOCIBQ,"^",6)=0:0,1:"")
"RTN","PSOCP",168,0)
 S:$P($$CVEDT^DGCV(PSOPT),"^",3) PSOTG("CV")=$S($P(PSOCIBQ,"^",7)=1:1,$P(PSOCIBQ,"^",7)=0:0,1:"")
"RTN","PSOCP",169,0)
 Q
"RTN","PSOCP",170,0)
 ;
"RTN","PSOCP",171,0)
XTYPE ;
"RTN","PSOCP",172,0)
 N PSOCIBQ,PSOSCMX,Y,I,J,X,SAVY
"RTN","PSOCP",173,0)
 S (X,PSOSCMX,SAVY)=""
"RTN","PSOCP",174,0)
 S PSOCIBQ=$G(^PSRX(RXP,"IBQ"))
"RTN","PSOCP",175,0)
 I $P(PSOCIBQ,"^",1)'="" S PSOTG("SC")=$P(PSOCIBQ,"^",1)
"RTN","PSOCP",176,0)
 I $D(PSOTG("SC")),$P(PSOCIBQ,"^",1)="" S PSOTG("SC")="" ; USE "CURRENT" SETTING AS ANSWER TO SERVICE CONNECTED QUESTION IF IT APPLIES
"RTN","PSOCP",177,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",178,0)
 I 'X Q
"RTN","PSOCP",179,0)
 S X=X_"^"_PSOCPN D XTYPE^IBARX
"RTN","PSOCP",180,0)
 I $G(Y)'=1 Q
"RTN","PSOCP",181,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S SAVY=I,I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSCMX=I
"RTN","PSOCP",182,0)
 I PSOSCMX="",SAVY=0 S PSOCHG=0 S PSOCOMM="Exempt from copayment" Q  ; INCOME EXEMPT OR SERVICE-CONNECTED
"RTN","PSOCP",183,0)
 I PSOSCMX=2,'$D(PSOTG("SC")) S PSOTG("SC")=$S(($G(RXP)&($P($G(^PSRX(+$G(RXP),"IB")),"^")))!($P(PSOCIBQ,"^")=0):0,$P(PSOCIBQ,"^")=1:1,1:"") Q
"RTN","PSOCP",184,0)
 Q
"RTN","PSOCP",185,0)
 ;
"RTN","PSOCP",186,0)
SETCOMM ;
"RTN","PSOCP",187,0)
 I EXMT="SC" S PSOCOMM="Service Connected" Q
"RTN","PSOCP",188,0)
 I EXMT="CV" S PSOCOMM="COMBAT VETERAN" Q
"RTN","PSOCP",189,0)
 I EXMT="AO" S PSOCOMM="AGENT ORANGE RELATED" Q
"RTN","PSOCP",190,0)
 I EXMT="IR" S PSOCOMM="IONIZING RAD RELATED" Q
"RTN","PSOCP",191,0)
 I EXMT="EC" S PSOCOMM="ENV CONTAMINANTS RELATED" Q
"RTN","PSOCP",192,0)
 I EXMT="MST" S PSOCOMM="MILITARY SEXUAL TRAUMA" Q
"RTN","PSOCP",193,0)
 I EXMT="HNC" S PSOCOMM="Head and/or Neck Cancer" Q
"RTN","PSOCP",194,0)
 Q
"RTN","PSOCP",195,0)
 ;
"RTN","PSOCPB")
0^9^B82075464
"RTN","PSOCPB",1,0)
PSOCPB ;BIR/BaB - pharmacy co-pay application cont'd ; 9/20/96 11:47
"RTN","PSOCPB",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**72,71,85,185,143,219**;DEC 1997
"RTN","PSOCPB",3,0)
 ;
"RTN","PSOCPB",4,0)
 ;REF/IA
"RTN","PSOCPB",5,0)
 ;DIS^SDROUT2/112
"RTN","PSOCPB",6,0)
 ;^IBARX/125
"RTN","PSOCPB",7,0)
 ;VADPT/10061
"RTN","PSOCPB",8,0)
COPAY ;
"RTN","PSOCPB",9,0)
 ; Called by PSON52,PSORN52...Requires PSOCPAY,PSOBILL,DEA=PSDEA,PSOFLAG
"RTN","PSOCPB",10,0)
 ;PSOFLAG=1 NEW, PSOFLAG=0 RENEW
"RTN","PSOCPB",11,0)
 S PSOSAVE=PSOCPAY ; Save original status of PSOCPAY
"RTN","PSOCPB",12,0)
 I $G(PSODRUG("DEA"))["S"!($G(PSODRUG("DEA"))["I") S PSOCPAY=0 G SKP
"RTN","PSOCPB",13,0)
 G:+PSOBILL'=2 COPAY2
"RTN","PSOCPB",14,0)
SKP D FULL^VALM1
"RTN","PSOCPB",15,0)
 ;CIDC:verify in case enrollment changed. Check if SC is marked as yes even if no % is defined
"RTN","PSOCPB",16,0)
 K PSOSCP D ELIG^VADPT S PSOSCP="",PSOSCP=$P(VAEL(3),U,2) S:$P(VAEL(3),U,2)=""&($P(VAEL(3),U,1)=1) PSOSCP=0
"RTN","PSOCPB",17,0)
 I $G(PSOSCP)>49 G COPAY2
"RTN","PSOCPB",18,0)
 I PSOSCP="" S PSOANSQ("SC")="",PSOCPAY=0,PSOSCP=$P(VAEL(3),U,2) G COPAY2  ;don't ask question and return with correct PSOSCP value.
"RTN","PSOCPB",19,0)
 E  S PSOSCP=$P(VAEL(3),U,2)
"RTN","PSOCPB",20,0)
 I $G(PSOMESOI)=1,$G(PSORXED) W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESOI=2
"RTN","PSOCPB",21,0)
 I $G(PSOMESFI)=1 W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESFI=2
"RTN","PSOCPB",22,0)
 S DFN=+$G(PSODFN) D DIS^SDROUT2
"RTN","PSOCPB",23,0)
 K VAEL
"RTN","PSOCPB",24,0)
ASK ;
"RTN","PSOCPB",25,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOCPB",26,0)
 K PSOCPZ("DFLG"),PSONEW("NEWCOPAY")
"RTN","PSOCPB",27,0)
 W ! K DIR,DTOUT,DIRUT,DUOUT
"RTN","PSOCPB",28,0)
 I $G(PSORX("SC"))="SC"!($G(PSORX("SC"))="NSC")!($G(PSOSCOTH)) D
"RTN","PSOCPB",29,0)
 . W:PSOSCP<50&($G(PSODRUG("DEA"))'["S")&($G(PSODRUG("DEA"))'["I") !,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! I $G(PSOSCOTX) S PSOSCOTX=2
"RTN","PSOCPB",30,0)
 S DIR("A")="Was treatment for Service Connected condition",DIR(0)="Y"
"RTN","PSOCPB",31,0)
 S DIR("?")="Enter 'Yes' if this prescription is for a Service Connected condition"
"RTN","PSOCPB",32,0)
 I $G(PSORX("SC"))]""!($G(PSORX(+$G(PSORENW("OIRXN")),"SC"))'="") S DIR("B")=$S($G(PSORX("SC"))="SC":"YES",$G(PSORX("SC"))="NSC":"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=1:"YES",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=0:"NO",1:"")
"RTN","PSOCPB",33,0)
 I $G(PSONEWFF),$G(PSOFLAG) I $G(PSOANSQD("SC"))=0!($G(PSOANSQD("SC"))=1) S DIR("B")=$S($G(PSOANSQD("SC"))=1:"YES",1:"NO")
"RTN","PSOCPB",34,0)
 I $G(DIR("B"))="YES"!($G(DIR("B"))="NO") S PSOUFLAG=$G(DIR("B"))
"RTN","PSOCPB",35,0)
 I $G(DIR("B"))="" K DIR("B")
"RTN","PSOCPB",36,0)
 D ^DIR
"RTN","PSOCPB",37,0)
 I $G(Y)=1!($G(Y)=0) S PSOANSQ("SC")=$G(Y) I $G(PSONEWFF),$G(PSOFLAG) S PSOANSQD("SC")=$G(Y)
"RTN","PSOCPB",38,0)
 I PSOFLAG I Y["^"!($D(DTOUT))!($D(DUOUT)) S PSOCPZ("DFLG")=1
"RTN","PSOCPB",39,0)
 S:Y=0 Y=2
"RTN","PSOCPB",40,0)
 S PSOANSR=+Y I 'PSOANSR,'PSOFLAG D  S $P(PSOCPAY,"^")=$S($G(PSOUFLAG)="NO":1,1:0) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR G COPAY2
"RTN","PSOCPB",41,0)
 .W !!,"This Renewal has been designated as "_$S($G(PSOUFLAG)="YES":"SERVICE CONNECTED",1:"NON-SERVICE CONNECTED.")
"RTN","PSOCPB",42,0)
 .W:PSOSCP<50&($G(PSODRUG("DEA"))'["S")&($G(PSODRUG("DEA"))'["I") !,"Please use the 'Reset Copay Status/Cancel Charges' option to make corrections."
"RTN","PSOCPB",43,0)
 .S PSOANSQ("SC")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOCPB",44,0)
 I $G(PSOFLAG),$G(PSOCPZ("DFLG")) G EXIT
"RTN","PSOCPB",45,0)
 S:PSOANSR=1 PSOCPAY=0 S:PSOANSR=2 $P(PSOCPAY,"^")=1
"RTN","PSOCPB",46,0)
 G COPAY2
"RTN","PSOCPB",47,0)
HELP ;
"RTN","PSOCPB",48,0)
 ;W !!,"You must answer YES or NO to this question to continue."
"RTN","PSOCPB",49,0)
 ;G ASK
"RTN","PSOCPB",50,0)
COPAY2 ;
"RTN","PSOCPB",51,0)
 I +PSOCPAY=1,($P(PSOCPAY,"^",2)=1)!($P(PSOCPAY,"^",2)=2) D
"RTN","PSOCPB",52,0)
 .;set IB node in ^PSRX for copay if xactn type is 1 or 2
"RTN","PSOCPB",53,0)
 .S PSONEW("NEWCOPAY")=$P($G(PSOCPAY),"^",2)_"^^"_$P($G(PSOCPAY),"^",2)
"RTN","PSOCPB",54,0)
EXIT ;
"RTN","PSOCPB",55,0)
 S PSOCPAY=PSOSAVE ; Restore value of PSOCPAY
"RTN","PSOCPB",56,0)
 K PSOSAVE,PSOANSR,DIR,DUOUT,DIRUT,DTOUT,Y,X
"RTN","PSOCPB",57,0)
 Q
"RTN","PSOCPB",58,0)
RESET ; RESET COPAY STATUS
"RTN","PSOCPB",59,0)
 K PSOSUMM
"RTN","PSOCPB",60,0)
 I '$D(PSOPAR) D ^PSOLSET G RESET
"RTN","PSOCPB",61,0)
 W ! S DIC="^PSRX(",DIC(0)="AEQMZ" D ^DIC K DIC G:Y<0 EXT S PSODA=+Y
"RTN","PSOCPB",62,0)
 W !,?17,"PATIENT: ",$P($G(^DPT($P(^PSRX(PSODA,0),"^",2),0)),"^")
"RTN","PSOCPB",63,0)
 D ICN^PSODPT($P(^PSRX(PSODA,0),"^",2))
"RTN","PSOCPB",64,0)
 S PSORXN=$P(^PSRX(PSODA,0),"^"),PREA="R"
"RTN","PSOCPB",65,0)
 S PCOPAY=$G(^PSRX(PSODA,"IB"))
"RTN","PSOCPB",66,0)
 W !!,"Rx # ",PSORXN," is a ",$S(+PCOPAY:"Copay",1:"No Copay")," prescription"
"RTN","PSOCPB",67,0)
 D EXEMCHK^PSOCPC ; CHECK/CHANGE EXEMPTION FLAGS
"RTN","PSOCPB",68,0)
 ;
"RTN","PSOCPB",69,0)
 S PSOIBQ=$G(^PSRX(PSODA,"IBQ"))
"RTN","PSOCPB",70,0)
 I '$G(^PSRX(PSODA,"IB")),PSOIBQ'["1" D  G ASKCAN
"RTN","PSOCPB",71,0)
 . K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Do you want to reset the status to COPAY" D ^DIR K DIR
"RTN","PSOCPB",72,0)
 . I Y'=1 Q
"RTN","PSOCPB",73,0)
 . S DIC="^IBE(350.3,",DIC("S")="I $P(^(0),U,3)'=2",DIC(0)="AEQMZ",DIC("A")="Select Reason for Reset : " D ^DIC K DIC I Y'<0 S PSORSN=+Y
"RTN","PSOCPB",74,0)
 . S PREA="R",PSOOLD="No Copay",PSONW="Copay",PSOCOMM="" D ACTLOG^PSOCPA
"RTN","PSOCPB",75,0)
 . S PSI=0,PSOCOMM="Copay status of this Rx has been reset to COPAY." D SETSUMM^PSOCPC
"RTN","PSOCPB",76,0)
 . S $P(^PSRX(PSODA,"IB"),"^")=1 ; Reset flag to COPAY
"RTN","PSOCPB",77,0)
 ;
"RTN","PSOCPB",78,0)
 I $G(^PSRX(PSODA,"IB")) D  G ASKCAN
"RTN","PSOCPB",79,0)
 . K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Do you want to reset the status to NO COPAYMENT" D ^DIR K DIR
"RTN","PSOCPB",80,0)
 . I Y'=1 Q
"RTN","PSOCPB",81,0)
 . S DIC="^IBE(350.3,",DIC("S")="I $P(^(0),U,3)'=2",DIC(0)="AEQMZ",DIC("A")="Select Reason for Reset : " D ^DIC K DIC I Y'<0 S PSORSN=+Y
"RTN","PSOCPB",82,0)
 . S PREA="R",PSOOLD="Copay",PSONW="No Copay",PSOCOMM="" D ACTLOG^PSOCPA
"RTN","PSOCPB",83,0)
 . S PSI=0,PSOCOMM="Copay status of this Rx has been reset to NO COPAY." D SETSUMM^PSOCPC
"RTN","PSOCPB",84,0)
 . S $P(^PSRX(PSODA,"IB"),"^")="" ; Reset flag to NO COPAY
"RTN","PSOCPB",85,0)
ASKCAN D ASKCAN^PSOCPD
"RTN","PSOCPB",86,0)
 I '$D(PSOSUMM) S PSI=0,PSOCOMM="No action taken" D SETSUMM^PSOCPC
"RTN","PSOCPB",87,0)
 D PRTSUMM
"RTN","PSOCPB",88,0)
RESETE K PSODA,PSORXN,PSORSN,PSOREF,X,Y,PCOPAY,PREA,PSOCOMM,PSI
"RTN","PSOCPB",89,0)
 G RESET
"RTN","PSOCPB",90,0)
EXT K PSODA,PSORXN,PSORSN,PSOREF,X,Y,PCOPAY,PREA,PSOCOPAY
"RTN","PSOCPB",91,0)
 Q
"RTN","PSOCPB",92,0)
BILLED ; Collect IB numbers,cancel chrgs,reset flag.
"RTN","PSOCPB",93,0)
 W !!,"**********Charges are on file for this Rx.**********"
"RTN","PSOCPB",94,0)
 Q
"RTN","PSOCPB",95,0)
BILL2 ;
"RTN","PSOCPB",96,0)
 N PSOPREV ; VARIABLE FOR PREVIOUSLY CANCELLED
"RTN","PSOCPB",97,0)
 S PSOPREV=0
"RTN","PSOCPB",98,0)
 S DIC="^IBE(350.3,",DIC("S")="I $P(^(0),U,3)'=2",DIC(0)="AEQMZ",DIC("A")="Select Reason for Reset or Charge Cancellation : " D ^DIC K DIC G ENDMSG:Y<0 S PSORSN=+Y
"RTN","PSOCPB",99,0)
 S X=PSOPAR7_"^"_+$P(^PSRX(PSODA,0),"^",2)_"^^"_DUZ
"RTN","PSOCPB",100,0)
 S SAVX=X
"RTN","PSOCPB",101,0)
 D POTBILL2
"RTN","PSOCPB",102,0)
 I '$D(PSOCAN) G BILL2END
"RTN","PSOCPB",103,0)
 I $G(CANTYPE) D PREVCAN I $O(X(""))="" Q
"RTN","PSOCPB",104,0)
 I '$G(CANTYPE) S I="" F  S I=$O(PSOCAN(I)) Q:I=""  S X($P(PSOCAN(I),"^",1))=$P(PSOCAN(I),"^",2)_"^"_PSORSN
"RTN","PSOCPB",105,0)
 D CANCEL^IBARX
"RTN","PSOCPB",106,0)
 I $G(CANTYPE) D MSG
"RTN","PSOCPB",107,0)
 I '$D(Y) Q
"RTN","PSOCPB",108,0)
 I +Y=-1 Q
"RTN","PSOCPB",109,0)
 I $D(Y(PSORXN)),+Y(PSORXN)'=-1 S $P(^PSRX(PSODA,"IB"),"^",2)=+Y(PSORXN) K Y(PSORXN) S PREA="C",PSOREF=0,PSOOLD="",PSONW="" D ACTLOG^PSOCPA I '$G(CANTYPE) D MSG
"RTN","PSOCPB",110,0)
 F PSOREF=0:0 S PSOREF=$O(Y(PSOREF)) Q:PSOREF=""  I +Y(PSOREF)'=-1 S ^PSRX(PSODA,1,PSOREF,"IB")=+Y(PSOREF) S PREA="C",PSOOLD="",PSONW="" D ACTLOG^PSOCPA I '$G(CANTYPE) D MSG
"RTN","PSOCPB",111,0)
BILL2END K X,Y,SAVX,PSOREF,PSOCAN
"RTN","PSOCPB",112,0)
 Q
"RTN","PSOCPB",113,0)
 ;
"RTN","PSOCPB",114,0)
POTBILL2 ; see if any potential charges (entries from file 354.71 -- bills that exceeded cap previously) to be cancelled before cancelling regular charges
"RTN","PSOCPB",115,0)
 N X,I
"RTN","PSOCPB",116,0)
 S X=SAVX
"RTN","PSOCPB",117,0)
 I $T(CANIBAM^IBARX)="" Q
"RTN","PSOCPB",118,0)
 S I="" F  S I=$O(PSOCAN(I)) Q:I=""  I PSOCAN(I)["^CAP" S X($P(PSOCAN(I),"^",1))=$P(PSOCAN(I),"^",2)_"^"_PSORSN K PSOCAN(I)
"RTN","PSOCPB",119,0)
 I $O(X(""))="" Q
"RTN","PSOCPB",120,0)
 S PSOPREV=1
"RTN","PSOCPB",121,0)
 D CANIBAM^IBARX
"RTN","PSOCPB",122,0)
 I $D(X(PSORXN)) S $P(^PSRX(PSODA,"IB"),"^",4)="" S PREA="C",PSOREF=0,PSOCOMM="Potential charge cancelled",PSOOLD="",PSONW="" D ACTLOG^PSOCPA D POTMSG K X(PSORXN)
"RTN","PSOCPB",123,0)
 F PSOREF=0:0 S PSOREF=$O(X(PSOREF)) Q:PSOREF=""  Q:PSOREF>11  S $P(^PSRX(PSODA,1,PSOREF,"IB"),"^",2)="" S PREA="C",PSOCOMM="Potential charge cancelled",PSOOLD="",PSONW="" D ACTLOG^PSOCPA D POTMSG
"RTN","PSOCPB",124,0)
 K PSOREF,PREA,PSOCOMM
"RTN","PSOCPB",125,0)
 Q
"RTN","PSOCPB",126,0)
 ;
"RTN","PSOCPB",127,0)
REFILL S PSOREF=0
"RTN","PSOCPB",128,0)
 F  S PSOREF=$O(^PSRX(PSODA,1,PSOREF)) Q:PSOREF'?1N.N  I $D(^PSRX(PSODA,1,PSOREF,"IB")),+^("IB")>0 S X(PSOREF)=+^PSRX(PSODA,1,PSOREF,"IB")_"^"_$G(PSORSN)
"RTN","PSOCPB",129,0)
 S PSOREF=0 F  S PSOREF=$O(^PSRX(PSODA,1,PSOREF)) Q:PSOREF'?1N.N  I '$D(X(PSOREF)),+$P($G(^PSRX(PSODA,1,PSOREF,"IB")),"^",2) S XX(PSOREF)=+$P(^PSRX(PSODA,1,PSOREF,"IB"),"^",2)_"^"_$G(PSORSN) ; IF ONLY ENTRY FROM 354.71 SAVE IT
"RTN","PSOCPB",130,0)
 Q
"RTN","PSOCPB",131,0)
SETCP ; IF NOT COPAY MAKE ELIG CALL/SET FLAG FOR FUTURE
"RTN","PSOCPB",132,0)
 W ! S X=PSOPAR7_"^"_+$P(^PSRX(PSODA,0),"^",2)
"RTN","PSOCPB",133,0)
 D XTYPE^IBARX
"RTN","PSOCPB",134,0)
 I +Y=-1 W !!,"Error in processing Copay eligibility, no action taken." Q
"RTN","PSOCPB",135,0)
 S (ACTYP,BL)="",(PSOBILL,PSOCPAY)=0
"RTN","PSOCPB",136,0)
CP ;
"RTN","PSOCPB",137,0)
 S ACTYP=$O(Y(ACTYP)) G:'ACTYP CP1
"RTN","PSOCPB",138,0)
 F I=0:0 S BL=$O(Y(ACTYP,BL)) Q:BL=""  I BL>0 S PSOBILL=BL,PSOCPAY=ACTYP
"RTN","PSOCPB",139,0)
 G CP
"RTN","PSOCPB",140,0)
CP1 K ACTYP,BL,I
"RTN","PSOCPB",141,0)
 I (PSOBILL'>0)!(PSOCPAY=0) G INELIG
"RTN","PSOCPB",142,0)
 S $P(^PSRX(PSODA,"IB"),"^")=PSOCPAY
"RTN","PSOCPB",143,0)
 W !,"COPAY status on this Rx has been reset.",!,"*** Future refills will be classified as COPAY."
"RTN","PSOCPB",144,0)
 S PREA="R",PSOOLD="No Copay",PSONW="Copay"
"RTN","PSOCPB",145,0)
 D ACTLOG^PSOCPA
"RTN","PSOCPB",146,0)
 Q
"RTN","PSOCPB",147,0)
INELIG W !,"This Rx does not meet patient eligibility requirement for Copay.",!,"****** Status unchanged *******"
"RTN","PSOCPB",148,0)
 S Y=-1
"RTN","PSOCPB",149,0)
 ; K PSOCPAY,PSOBILL,PSODA,PSORXN,PSORSN
"RTN","PSOCPB",150,0)
 Q
"RTN","PSOCPB",151,0)
ENDMSG K X W !,"Unable to process CHARGE REMOVAL without REASON for Reset."
"RTN","PSOCPB",152,0)
 R !,"ENTER a REASON now?  (Y/N) ",X:DTIME Q:'$T
"RTN","PSOCPB",153,0)
 I ($E(X)["?")!("YyNn^"'[$E(X)) W !,"Enter YES to select REASON and RESET STATUS." G ENDMSG
"RTN","PSOCPB",154,0)
 I "Yy"[$E(X) G BILL2
"RTN","PSOCPB",155,0)
 Q
"RTN","PSOCPB",156,0)
 ;
"RTN","PSOCPB",157,0)
MSG ;
"RTN","PSOCPB",158,0)
 S PSI=0
"RTN","PSOCPB",159,0)
 I $G(CANTYPE) S PSOCOMM="Rx # "_PSORXN_" - All copay charges cancelled" D SETSUMM^PSOCPC K PSOCOMM Q
"RTN","PSOCPB",160,0)
 S PSOCOMM="Rx # "_PSORXN_" - "_$S(PSOREF=0:"Original fill",1:"Refill "_PSOREF)_" copay charge cancelled"
"RTN","PSOCPB",161,0)
 D SETSUMM^PSOCPC
"RTN","PSOCPB",162,0)
 K PSOCOMM
"RTN","PSOCPB",163,0)
 Q
"RTN","PSOCPB",164,0)
 ;
"RTN","PSOCPB",165,0)
POTMSG ;
"RTN","PSOCPB",166,0)
 S PSI=0
"RTN","PSOCPB",167,0)
 I $G(CANTYPE) Q  ; (MESSAGE WILL GET SET LATER)
"RTN","PSOCPB",168,0)
 S PSOCOMM="Rx # "_PSORXN_" - "_$S(PSOREF=0:"Original fill",1:"Refill "_PSOREF)_" potential copay charge cancelled"
"RTN","PSOCPB",169,0)
 D SETSUMM^PSOCPC
"RTN","PSOCPB",170,0)
 K PSOCOMM
"RTN","PSOCPB",171,0)
 Q
"RTN","PSOCPB",172,0)
 ;
"RTN","PSOCPB",173,0)
MSGNOCAN ;
"RTN","PSOCPB",174,0)
 S PSI=0
"RTN","PSOCPB",175,0)
 S PSOCOMM="Rx # "_PSORXN_" - All copay charges have already been cancelled." D SETSUMM^PSOCPC K PSOCOMM
"RTN","PSOCPB",176,0)
 Q
"RTN","PSOCPB",177,0)
 ;
"RTN","PSOCPB",178,0)
PRTSUMM ; print summary of actions in reset/cancel
"RTN","PSOCPB",179,0)
 I '$D(PSOSUMM) Q
"RTN","PSOCPB",180,0)
 W !
"RTN","PSOCPB",181,0)
 S PSI=""
"RTN","PSOCPB",182,0)
 F  S PSI=$O(PSOSUMM(PSI)) Q:PSI=""  W !,PSOSUMM(PSI)
"RTN","PSOCPB",183,0)
 K PSOSUMM
"RTN","PSOCPB",184,0)
 Q
"RTN","PSOCPB",185,0)
 ;
"RTN","PSOCPB",186,0)
PREVCAN ; PREVIEW CANCELS IF "ALL" IS SELECTED
"RTN","PSOCPB",187,0)
 N I,PSOBILL
"RTN","PSOCPB",188,0)
 S I="" F  S I=$O(PSOCAN(I)) Q:I=""  D  I PSOBILL S X($P(PSOCAN(I),"^",1))=$P(PSOCAN(I),"^",2)_"^"_PSORSN
"RTN","PSOCPB",189,0)
 . S PSOBILL=1 I $T(STATUS^IBARX)'="" I PSOCAN(I)'["CAP" S PSOBILL=$$STATUS^IBARX($P(PSOCAN(I),"^",2)) S:PSOBILL=2 PSOBILL=0 ; PREVIOUSLY CANCELLED
"RTN","PSOCPB",190,0)
 I $O(X(""))="" D
"RTN","PSOCPB",191,0)
 . I PSOPREV D MSG Q
"RTN","PSOCPB",192,0)
 . D MSGNOCAN
"RTN","PSOCPB",193,0)
 Q
"RTN","PSOCPB",194,0)
 ;
"RTN","PSOCPE")
0^12^B79963827
"RTN","PSOCPE",1,0)
PSOCPE ;BIR/BAB - PHARMACY COPAY APPLICATION UTILITIES FOR IB ;10/26/92
"RTN","PSOCPE",2,0)
 ;;7.0;OUTPATPSOCT PHARMACY;**26,71,85,114,157,219**;DEC 1997
"RTN","PSOCPE",3,0)
 ;
"RTN","PSOCPE",4,0)
 ;REF/IA
"RTN","PSOCPE",5,0)
 ;^XUSEC/10076
"RTN","PSOCPE",6,0)
 ;^PSDRUG(/221
"RTN","PSOCPE",7,0)
 ;Routine initially released as part of the copayment enhancement.
"RTN","PSOCPE",8,0)
 ;called from PSOLBL
"RTN","PSOCPE",9,0)
INV ;         Entry point from PSOCP - Prints one copay invoice
"RTN","PSOCPE",10,0)
 I '$D(PSOCPN)!($G(RXP)) Q
"RTN","PSOCPE",11,0)
 S PSOCPBAR=0
"RTN","PSOCPE",12,0)
 I $D(PSOBARS),PSOBARS S PSOCPBAR=1
"RTN","PSOCPE",13,0)
 D DEM^VADPT S Y=DT X ^DD("DD") S EDT=Y
"RTN","PSOCPE",14,0)
 W ?54,"PRESCRIPTION COPAYMENT INFORMATION"
"RTN","PSOCPE",15,0)
 W !!,?54,VADM(1)," ",VA("PID")," ",EDT
"RTN","PSOCPE",16,0)
 S PSZ1=0,PSZ2="",PSOCPBN=$P(VADM(2),"^"),PSOCPBN=$S(PSOCPBN]"":PSOCPBN,1:"Unavailable")
"RTN","PSOCPE",17,0)
 ;I '$G(PSOCPN) S PSOCPN=$P(^PSRX(RX,0),U,2)
"RTN","PSOCPE",18,0)
 I PSOCPBAR,(PSOCPBN]"") S X="S",X2=PSOCPBN W !,?54,@PSOBAR1,PSOCPBN,@PSOBAR0
"RTN","PSOCPE",19,0)
 E  W !
"RTN","PSOCPE",20,0)
 W !,?54,"The following prescriptions are"
"RTN","PSOCPE",21,0)
 W !,?54,"eligible for prescription copayment.",!!
"RTN","PSOCPE",22,0)
DRUG S PSZ2="" F  S PSZ2=$O(^TMP($J,"PSOCP",PSOCPN,PSZ2)) Q:PSZ2']""  S PSZ=^(PSZ2) D PRT
"RTN","PSOCPE",23,0)
NAR ; Print narrative from site parameter file
"RTN","PSOCPE",24,0)
 K ^UTILITY($J,"W") S DIWL=55,DIWR=99,DIWF="" W !
"RTN","PSOCPE",25,0)
 G:'$D(^PS(59,PSOSITE,4,0)) END
"RTN","PSOCPE",26,0)
 G:$P(^PS(59,PSOSITE,4,0),"^",3)'>0 END
"RTN","PSOCPE",27,0)
 F PSO9=0:0 S PSO9=$O(^PS(59,PSOSITE,4,PSO9)) G:'PSO9 P1 I $D(^PS(59,PSOSITE,4,PSO9,0)) S X=^(0) D ^DIWP
"RTN","PSOCPE",28,0)
P1 D ^DIWW
"RTN","PSOCPE",29,0)
 K DIWF,DIWL,DIWR,PSO9
"RTN","PSOCPE",30,0)
END ;
"RTN","PSOCPE",31,0)
 W @IOF
"RTN","PSOCPE",32,0)
 K ^TMP($J,"PSOCP",PSOCPN),PSOCPBAR,PSOCPBN,PSZ1,PSZ2,PSOCPN,DIWF,DIWL,DIWR,PSO9
"RTN","PSOCPE",33,0)
 Q
"RTN","PSOCPE",34,0)
PRT ;
"RTN","PSOCPE",35,0)
 W ?54,PSZ2
"RTN","PSOCPE",36,0)
 W ?72," ",$P(^TMP($J,"PSOCP",PSOCPN,PSZ2),"^",3)," ","Days Supply",!
"RTN","PSOCPE",37,0)
 W ?56,$E($P(^TMP($J,"PSOCP",PSOCPN,PSZ2),U,2),1,45),!
"RTN","PSOCPE",38,0)
 Q
"RTN","PSOCPE",39,0)
XMPT ;   Entry point for menu option to select copay exemption
"RTN","PSOCPE",40,0)
 N PSORXPNM,PSORXPRE,PSOCPEDA
"RTN","PSOCPE",41,0)
 I '$D(PSOPAR) D ^PSOLSET G XMPT
"RTN","PSOCPE",42,0)
 W ! S (DIC,DIE)="^PS(53,",DIC(0)="AEQMZ" D ^DIC K DIC G:Y<0 QUIT
"RTN","PSOCPE",43,0)
 G:$D(DTOUT) QUIT
"RTN","PSOCPE",44,0)
 S PSORXPRE=$P($G(^PS(53,+$G(Y),0)),"^",7)
"RTN","PSOCPE",45,0)
 S PSORXPNM=$P($G(^PS(53,+$G(Y),0)),"^")
"RTN","PSOCPE",46,0)
 S DA=+Y,DR="15" L +^PS(53,DA):0 I '$T W !!,PSORXPNM_" is locked by another user. Try Later!" W ! D PAGE G QUIT
"RTN","PSOCPE",47,0)
 W ! D ^DIE
"RTN","PSOCPE",48,0)
 I PSORXPRE,$P($G(^PS(53,DA,0)),"^",7) W !!,"All Rx's entered with this Rx Patient Status will be EXEMPT from Copayment.",! D PAGE L -^PS(53,DA) G QUIT
"RTN","PSOCPE",49,0)
 I 'PSORXPRE,'$P($G(^PS(53,DA,0)),"^",7) W !!,"All Rx's entered with this Rx Patient Status will NOT be exempt from Copayment.",! D PAGE L -^PS(53,DA) G QUIT
"RTN","PSOCPE",50,0)
 D WARN L -^PS(53,DA)
"RTN","PSOCPE",51,0)
QUIT K PSORXPRE,DIE,DIC,DA,DR,X,C,Y
"RTN","PSOCPE",52,0)
 Q
"RTN","PSOCPE",53,0)
PAGE ;
"RTN","PSOCPE",54,0)
 I '$G(DUZ("AUTO")) K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOCPE",55,0)
 Q
"RTN","PSOCPE",56,0)
WARN ;
"RTN","PSOCPE",57,0)
 S PSOCPEDA=$G(DA)
"RTN","PSOCPE",58,0)
 W !!?28,"**** WARNING ****",!
"RTN","PSOCPE",59,0)
 I 'PSORXPRE W !,"By setting the Exempt from Copayment for the Rx Patient Status of",!,PSORXPNM," to 'YES', every prescription entered",!,"with this Rx Patient Status will NOT be charged a Copayment.",!
"RTN","PSOCPE",60,0)
 I PSORXPRE W !,"By setting the EXEMPT FROM COPAYMENT for the Rx Patient Status of ",!,PSORXPNM," to 'NO', prescriptions entered with this Rx",!,"Patient Status from this point on will NOT be exempt from Copayment.",!
"RTN","PSOCPE",61,0)
 W !,"A mail message will be sent to PSORPH and PSO COPAY Key holders informing",!,"them of your change."
"RTN","PSOCPE",62,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Are you sure you want to do this",DIR("B")="Y" D ^DIR K DIR
"RTN","PSOCPE",63,0)
 I $G(Y) D  D MAIL G WARNX
"RTN","PSOCPE",64,0)
 .I 'PSORXPRE W !!,"Setting ",PSORXPNM," Rx Patient Status to Exempt from Copayment." Q
"RTN","PSOCPE",65,0)
 .W !!,"Setting Exempt from Copayment to 'NO' for the ",PSORXPNM,!,"Rx Patient Status."
"RTN","PSOCPE",66,0)
 I 'PSORXPRE W !!,"No action taken." S $P(^PS(53,PSOCPEDA,0),"^",7)=0 H 1
"RTN","PSOCPE",67,0)
 I PSORXPRE W !!,"No action taken." S $P(^PS(53,PSOCPEDA,0),"^",7)=1 H 1
"RTN","PSOCPE",68,0)
WARNX W ! D PAGE
"RTN","PSOCPE",69,0)
 S DA=$G(PSOCPEDA) K PSOCPEDA
"RTN","PSOCPE",70,0)
 Q
"RTN","PSOCPE",71,0)
MAIL ;
"RTN","PSOCPE",72,0)
 K PSOTXT,PSOCFN,PSODCPA
"RTN","PSOCPE",73,0)
 I $G(DUZ) S DIC=200,DR=".01",DA=DUZ,DIQ(0)="E",DIQ="PSODCPA(" D EN^DIQ1 S PSOCFN=$G(PSODCPA(200,DA,.01,"E")) K PSODCPA,DIC,DIQ,DR
"RTN","PSOCPE",74,0)
 I 'PSORXPRE S PSOTXT(1,0)="The "_PSORXPNM_" Rx Patient Status has been marked as",PSOTXT(2,0)="Exempt from Copayment by "_$G(PSOCFN)_".",PSOTXT(3,0)="Every prescription with this Rx Patient Status will not be charged a Copayment."
"RTN","PSOCPE",75,0)
 I PSORXPRE S PSOTXT(1,0)="The Exempt from Copayment status has been removed from the",PSOTXT(2,0)=PSORXPNM_" Rx Patient Status by "_$G(PSOCFN)_".",PSOTXT(3,0)="Prescriptions entered with this Rx Patient Status will not be exempt from"
"RTN","PSOCPE",76,0)
 I PSORXPRE S PSOTXT(4,0)="Copayment."
"RTN","PSOCPE",77,0)
 F PSOCXPDA=0:0 S PSOCXPDA=$O(^XUSEC("PSORPH",PSOCXPDA)) Q:'PSOCXPDA  S XMY(PSOCXPDA)=""
"RTN","PSOCPE",78,0)
 F PSOCXPDA=0:0 S PSOCXPDA=$O(^XUSEC("PSO COPAY",PSOCXPDA)) Q:'PSOCXPDA  S XMY(PSOCXPDA)=""
"RTN","PSOCPE",79,0)
 I $G(DUZ) S XMY(DUZ)=""
"RTN","PSOCPE",80,0)
 S XMSUB="Exempt from Copayment",XMTEXT="PSOTXT(",XMDUZ="Outpatient Pharmacy" D ^XMD
"RTN","PSOCPE",81,0)
 K PSOTXT,PSOCXPDA,XMDUZ,PSOCFN,XMTEXT,XMSUB,XMY
"RTN","PSOCPE",82,0)
 Q
"RTN","PSOCPE",83,0)
 ;
"RTN","PSOCPE",84,0)
MAIL2 ; SEND MAIL TO PHARMACIST, PROVIDER, AND HOLDERS OF PSO COPAY KEY
"RTN","PSOCPE",85,0)
 N PSOC,PSOTXT,X
"RTN","PSOCPE",86,0)
 K XMY
"RTN","PSOCPE",87,0)
 S XMSUB="PRESCRIPTION QUESTIONS REVIEW NEEDED"
"RTN","PSOCPE",88,0)
 S XMDUZ="Outpatient Pharmacy Package"
"RTN","PSOCPE",89,0)
 S PSOTXT(1)=" "
"RTN","PSOCPE",90,0)
 S DFN=+$P($G(^PSRX(RXP,0)),"^",2) D PID^VADPT
"RTN","PSOCPE",91,0)
 S PSODIV=$P($G(^PSRX(RXP,2)),"^",9) S:PSODIV'="" XMSUB=XMSUB_" ("_$P($G(^PS(59,PSODIV,0)),"^",6)_")",PSODIV=$P($G(^PS(59,PSODIV,0)),"^",1) ; ADDED DIVISION NUMBER TO SUBJECT LINE - PATCH 85
"RTN","PSOCPE",92,0)
 S PSOTXT(2)=$P($G(^DPT($P(^PSRX(RXP,0),"^",2),0)),"^",1)_"  ("_$G(VA("BID"))_")"_"    "_PSODIV
"RTN","PSOCPE",93,0)
 D ELIG
"RTN","PSOCPE",94,0)
 S PSOTXT(PSOC)="Rx# "_$P(^PSRX(RXP,0),"^",1)_" ("_PSOREF_")    "_$S('$G(^PSRX(RXP,"IB")):"NO COPAY",1:"COPAY")
"RTN","PSOCPE",95,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",96,0)
 S DRG=+$P(^PSRX(RXP,0),"^",6)
"RTN","PSOCPE",97,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",98,0)
 S PSOTXT(PSOC)=$P($G(^PSDRUG(DRG,0)),"^",1)
"RTN","PSOCPE",99,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",100,0)
 S PSOTXT(PSOC)=" "
"RTN","PSOCPE",101,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",102,0)
 S PSOTXT(PSOC)="Due to a change in criteria, additional information listed below is needed"
"RTN","PSOCPE",103,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",104,0)
 S PSOTXT(PSOC)="to determine the final VA copay and/or insurance billable status for this Rx"
"RTN","PSOCPE",105,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",106,0)
 S PSOTXT(PSOC)="so that appropriate action can be taken by pharmacy personnel."
"RTN","PSOCPE",107,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",108,0)
 S PSOTXT(PSOC)=" "
"RTN","PSOCPE",109,0)
 S PSOC=PSOC+1
"RTN","PSOCPE",110,0)
 F EXMT="SC","CV","AO","IR","EC","MST","HNC" I $D(PSOTG(EXMT)) D
"RTN","PSOCPE",111,0)
 . I PSOTG(EXMT)'="" Q
"RTN","PSOCPE",112,0)
 . S PSOLTAG="REL"_EXMT
"RTN","PSOCPE",113,0)
 . S PSOQUES=$P($T(@PSOLTAG),";",2) I PSOQUES="" Q
"RTN","PSOCPE",114,0)
 . S PSOC=PSOC+1,PSOTXT(PSOC)=PSOQUES
"RTN","PSOCPE",115,0)
 . S PSOQUES=$P($T(@PSOLTAG),";",2) I PSOQUES="" Q
"RTN","PSOCPE",116,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)=" "
"RTN","PSOCPE",117,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="This message has been sent to the provider of record, the pharmacist who"
"RTN","PSOCPE",118,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="finished the prescription order, and all holders of the PSO COPAY key."
"RTN","PSOCPE",119,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)=" "
"RTN","PSOCPE",120,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Providers:"
"RTN","PSOCPE",121,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Please respond with your answer to the question(s) as a reply to this"
"RTN","PSOCPE",122,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="message. The prescription will be updated by the appropriate staff."
"RTN","PSOCPE",123,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)=" "
"RTN","PSOCPE",124,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Staff assigned to update the Prescription responses:"
"RTN","PSOCPE",125,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Please use the RESET COPAY STATUS/CANCEL CHARGES option to enter the responses"
"RTN","PSOCPE",126,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="to the questions above, which may result in a Rx copay status change and/or"
"RTN","PSOCPE",127,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="the need to remove VA copay charges or may result in a charge to the patient's"
"RTN","PSOCPE",128,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="insurance carrier."
"RTN","PSOCPE",129,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)=" "
"RTN","PSOCPE",130,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Note: The SC question is now asked for Veterans who are SC>49% in order to"
"RTN","PSOCPE",131,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="determine if the Rx can be billed to a third party insurance. These Veterans"
"RTN","PSOCPE",132,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="will NOT be charged a VA copay."
"RTN","PSOCPE",133,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)=" "
"RTN","PSOCPE",134,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="Supply and investigational drugs are not charged a VA copay but could be"
"RTN","PSOCPE",135,0)
 S PSOC=PSOC+1,PSOTXT(PSOC)="reimbursable by third party insurance."
"RTN","PSOCPE",136,0)
 ; S XMY() TO ALL THE RECIPIENTS
"RTN","PSOCPE",137,0)
 I '$G(PSOREF) S XMY(+$P(^PSRX(RXP,0),"^",4))="" ; ORIGINAL
"RTN","PSOCPE",138,0)
 I $G(PSOREF) S XMY(+$P(^PSRX(RXP,1,PSOREF,0),"^",17))="" ; REFILL
"RTN","PSOCPE",139,0)
 I $G(^PSRX(RXP,"OR1")) I $P(^PSRX(RXP,"OR1"),"^",5)'="" S XMY($P(^PSRX(RXP,"OR1"),"^",5))=""
"RTN","PSOCPE",140,0)
 F PSOCXPDA=0:0 S PSOCXPDA=$O(^XUSEC("PSO COPAY",PSOCXPDA)) Q:'PSOCXPDA  S XMY(PSOCXPDA)=""
"RTN","PSOCPE",141,0)
 S XMTEXT="PSOTXT("
"RTN","PSOCPE",142,0)
 D ^XMD K XMSUB,XMY,XMDUZ,XMTEXT,PSODIV,PSOCXPDA,PSOLTAG,PSOC,PSOQUES,PSOTG
"RTN","PSOCPE",143,0)
 Q
"RTN","PSOCPE",144,0)
 ;
"RTN","PSOCPE",145,0)
ELIG D ELIG^VADPT S PSOC=3,PSOTXT(PSOC)="Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:""),PSOC=PSOC+1
"RTN","PSOCPE",146,0)
 N N,I,I1,PSDIS,PSCNT
"RTN","PSOCPE",147,0)
 S N=0 F  S N=$O(VAEL(1,N)) Q:'N  S $P(PSOTXT(PSOC)," ",14)=$P(VAEL(1,N),"^",2),PSOC=PSOC+1
"RTN","PSOCPE",148,0)
 S PSOTXT(PSOC)=" ",PSOC=PSOC+1,PSOTXT(PSOC)="Disabilities: "
"RTN","PSOCPE",149,0)
 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSOCPE",150,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSOCPE",151,0)
 .S:$L(PSOTXT(PSOC)_PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 PSOC=PSOC+1,$P(PSOTXT(PSOC)," ",14)=" "
"RTN","PSOCPE",152,0)
 .S PSOTXT(PSOC)=$G(PSOTXT(PSOC))_PSDIS_"-"_PSCNT_"%("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSOCPE",153,0)
 S PSOC=PSOC+1 S PSOTXT(PSOC)=" ",PSOC=PSOC+1
"RTN","PSOCPE",154,0)
 Q
"RTN","PSOCPE",155,0)
 ;
"RTN","PSOCPE",156,0)
 ;EXEMPTION QUESTIONS - MAIL MESSAGE POSITION;SUBSCRIPT IN "IBQ" NODE
"RTN","PSOCPE",157,0)
RELSC ;Is this Rx for a Service Connected Condition?;1
"RTN","PSOCPE",158,0)
RELMST ;Is this Rx related to the treatment of Military Sexual Trauma?;2
"RTN","PSOCPE",159,0)
RELAO ;Is this Rx for treatment of Vietnam-Era Herbicide (Agent Orange) exposure?;3
"RTN","PSOCPE",160,0)
RELIR ;Is this Rx for treatment of Ionizing Radiation exposure?;4
"RTN","PSOCPE",161,0)
RELEC ;Is this Rx for treatment of Environmental Contaminants exposure?;5
"RTN","PSOCPE",162,0)
RELHNC ;Is this Rx related to treatment of Head and/or Neck Cancer?;6
"RTN","PSOCPE",163,0)
RELCV ;Is this Rx potentially for treatment related to Combat?;7
"RTN","PSOCPE",164,0)
 ;
"RTN","PSODIAG")
0^7^B63400905
"RTN","PSODIAG",1,0)
PSODIAG ;BIR/LE - Diagnosis code prompts ;02/27/04
"RTN","PSODIAG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143,219**;DEC 1997
"RTN","PSODIAG",3,0)
 ;Ext ref to ^XUSEC sup by DBIA 10076
"RTN","PSODIAG",4,0)
 ;Ext ref to $$ICDDX^ICDCODE sup DBIA 3990
"RTN","PSODIAG",5,0)
 ;Ext ref to $$STATCHK^ICDAPIU sup DBIA 3991
"RTN","PSODIAG",6,0)
EN ;
"RTN","PSODIAG",7,0)
 ;don't ask icd's if user doesn't hold provider key
"RTN","PSODIAG",8,0)
 Q:$T(CIDC^IBBAPI)']""
"RTN","PSODIAG",9,0)
 Q:'$D(^XUSEC("PROVIDER",DUZ))
"RTN","PSODIAG",10,0)
 N PSODDFN S PSODDFN=$S($D(DFN):DFN,$D(PSODFN):PSODFN,1:"")  ;need to do this since PU patient update deletes DFN and in case some other function does
"RTN","PSODIAG",11,0)
 I PSODDFN'="" Q:'$$CIDC^IBBAPI(PSODDFN)  ;is CIDC activated; does patient have insurance
"RTN","PSODIAG",12,0)
 ;new variables and initialize variables based on CPRS or backdoor order.
"RTN","PSODIAG",13,0)
 N DX,POP,I,J,X,Y,Z,OLD,OLDI,SOLDI,NEW,TNEW,RAR,CPRS,FILDAT,STATCHK,STATCHK2
"RTN","PSODIAG",14,0)
 I '$G(PSOX("IRXN")) N PSOX S:$G(PSORXED("IRXN")) PSOX("IRXN")=PSORXED("IRXN")
"RTN","PSODIAG",15,0)
 K DIC
"RTN","PSODIAG",16,0)
 S CPRS=0
"RTN","PSODIAG",17,0)
 I $G(PSORXED) S RAR="PSORXED",@RAR@("DFLG")=0,PSORXED("FLD",39.3)=""
"RTN","PSODIAG",18,0)
 E  S RAR="PSONEW",@RAR@("DFLG")=0 I $G(ORD) D
"RTN","PSODIAG",19,0)
 . I $D(^PS(52.41,ORD)) S CPRS=1 M PSONEW("ICD")=PSORXED("ICD") K PSORXED("ICD"),PSORXED("FLD",39.3)
"RTN","PSODIAG",20,0)
 ;
"RTN","PSODIAG",21,0)
 S FILDAT="",FILDAT=DT I $G(PSOX("IRXN")) S FILDAT=$$GET1^DIQ(52,PSOX("IRXN")_",","22","I")
"RTN","PSODIAG",22,0)
 ;display any previously entered ICD's
"RTN","PSODIAG",23,0)
 W !!,"Previously entered ICD-9 diagnosis codes: "
"RTN","PSODIAG",24,0)
 I 'CPRS D  ;&(RAR="PSORXED"!(RAR="PSONEW")) D
"RTN","PSODIAG",25,0)
 . I $D(PSOX("IRXN")) I '$D(PSORXED("ICD")) I $D(^PSRX(PSOX("IRXN"),"ICD")) F I=1:1:8 Q:'$D(^PSRX(PSOX("IRXN"),"ICD",I,0))  D
"RTN","PSODIAG",26,0)
 .. S OLD(I)=$$GET1^DIQ(52.052311,I_","_PSOX("IRXN")_",",".01")
"RTN","PSODIAG",27,0)
 .. S OLDI(I)=$$GET1^DIQ(52.052311,I_","_PSOX("IRXN")_",",".01","I")
"RTN","PSODIAG",28,0)
 . I ($D(@RAR@("ICD"))&('$D(OLD)))!($G(PSOCOPY)) D
"RTN","PSODIAG",29,0)
 .. F I=1:1:8 Q:'$D(@RAR@("ICD",I))  I @RAR@("ICD",I)'="" S OLDI(I)=@RAR@("ICD",I) D
"RTN","PSODIAG",30,0)
 ... S OLD(I)=$P(^ICD9(OLDI(I),0),"^",1)
"RTN","PSODIAG",31,0)
 ... S J=I-1 I I=1 W OLD(I) Q
"RTN","PSODIAG",32,0)
 . F I=1:1:8 Q:'$D(OLD(I))  D WRITE
"RTN","PSODIAG",33,0)
 E  I CPRS D
"RTN","PSODIAG",34,0)
 . I '$G(PSONEW("ICD")) F I=1:1:8 Q:'$D(^PS(52.41,ORD,"ICD",I,0))  D
"RTN","PSODIAG",35,0)
 .. S OLD(I)=$$GET1^DIQ(52.41311,I_","_ORD_",",".01")
"RTN","PSODIAG",36,0)
 .. S OLDI(I)=$$GET1^DIQ(52.41311,I_","_ORD_",",".01","I")
"RTN","PSODIAG",37,0)
 . I $D(PSONEW("ICD")) K OLD,OLDI D
"RTN","PSODIAG",38,0)
 .. F I=1:1:8 Q:'$D(PSONEW("ICD",I))  S OLDI(I)=PSONEW("ICD",I) D
"RTN","PSODIAG",39,0)
 ... S OLD(I)=$P(^ICD9(OLDI(I),0),"^",1)
"RTN","PSODIAG",40,0)
 . F I=1:1:8 Q:'$D(OLD(I))  D WRITE
"RTN","PSODIAG",41,0)
 M SOLDI=OLDI
"RTN","PSODIAG",42,0)
 ;
"RTN","PSODIAG",43,0)
EN2 ;ask for ICD's or display previously entered ones for editing
"RTN","PSODIAG",44,0)
 ;note: because ICD's are not longer required, could not use standard
"RTN","PSODIAG",45,0)
 ;       FileMan calls everywhere because of need to control deleted
"RTN","PSODIAG",46,0)
 ;       entries and cross-references.
"RTN","PSODIAG",47,0)
 W !
"RTN","PSODIAG",48,0)
 F I=1:1:8 D  Q:+$G(Y)=-1!(@RAR@("DFLG")) 
"RTN","PSODIAG",49,0)
 . I '$G(PSORXED)&('$G(CPRS)) S RAR="PSONEW"
"RTN","PSODIAG",50,0)
 .K DIC S DIC("A")=$S(I=1:"Select Primary ICD-9 Code: ",1:"Select Secondary ICD-9 Code: ")
"RTN","PSODIAG",51,0)
 . I $D(OLD(I)),(OLD(I)'="") S DIC("B")=OLD(I)
"RTN","PSODIAG",52,0)
 . S X="" W !,DIC("A") D  R X:60   ;did this so that I have control of the deletes
"RTN","PSODIAG",53,0)
 .. I $D(OLD(I)),(OLD(I)'="") W OLD(I)_"// "
"RTN","PSODIAG",54,0)
 . I $D(OLD(I)) S:X="" X=OLD(I)
"RTN","PSODIAG",55,0)
 . I X="" S Y=-1 Q
"RTN","PSODIAG",56,0)
 . I X["?" W !,"Enter a valid ICD-9 diagnosis code." S I=1-1 Q
"RTN","PSODIAG",57,0)
 . I X="@" D DELETE Q
"RTN","PSODIAG",58,0)
 . I X="^" S Y=-1 Q
"RTN","PSODIAG",59,0)
 . K DIC S DIC=80,DIC(0)="EMZQ"
"RTN","PSODIAG",60,0)
 . ;S DIC("S")="I $P($$ICDDX^ICDCODE(Y,FILDAT),U,10)&($P($$ICDDX^ICDCODE(Y,FILDAT),U,17)>$P($$ICDDX^ICDCODE(Y,FILDAT),U,12))"
"RTN","PSODIAG",61,0)
 . S DIC("S")="I $$STATCHK^PSODIAG(Y,FILDAT)"
"RTN","PSODIAG",62,0)
 . K DTOUT,DUOUT D ^DIC K DIC
"RTN","PSODIAG",63,0)
 . I X="^" S I=I-1,Y="" Q
"RTN","PSODIAG",64,0)
 . I $G(DUOUT)!($G(DTOUT)) S Y=-1,X="^" Q
"RTN","PSODIAG",65,0)
 . I +Y=-1&(X'=""!(X'="^")) I $D(^ICD9("BA",X)) S I=I-1,(X,Y)="" Q  ;user said No to are you sure ?.
"RTN","PSODIAG",66,0)
 . I Y=-1&(X?1A.A) S I=I-1,Y="" Q  ;user said not to Yes? question.
"RTN","PSODIAG",67,0)
 . I Y'=-1 D  I STATCHK2=1 S I=I-1,Y="" Q
"RTN","PSODIAG",68,0)
 .. S (STATCHK,STATCHK2)="",STATCHK=$$STATCHK^ICDAPIU($P(Y,U,2),FILDAT) D
"RTN","PSODIAG",69,0)
 ... I $P(STATCHK,"^",2)=-1 W !!,"Invalid ICD-9 diagnosis code.  Please choose another.",! S STATCHK2=1 Q
"RTN","PSODIAG",70,0)
 ... I +STATCHK=0 W !!,"Inactivated ICD-9 Diagnosis Code.  Please choose another.",! S STATCHK2=1 Q
"RTN","PSODIAG",71,0)
 . I +Y=-1 S I=I-1,Y="" W !!,"Invalid or inactivated ICD-9 diagnosis code.  Please choose another.",! Q
"RTN","PSODIAG",72,0)
 . S (POP,J)=0 F J=1:1:I D
"RTN","PSODIAG",73,0)
 ..I $G(DX(J))=+Y W $C(7),!," Duplicate entry.  Please select a different ICD-9 diagnosis code.",! S I=I-1,(Y,X)="",POP=1
"RTN","PSODIAG",74,0)
 . Q:POP
"RTN","PSODIAG",75,0)
 . S NEW("ICD",I)=$P(Y,U,1),DX(I)=+Y
"RTN","PSODIAG",76,0)
 ;
"RTN","PSODIAG",77,0)
 ;resequence entered ICD's and removed deleted ones from file
"RTN","PSODIAG",78,0)
 ;I X="^"&(RAR="PSONEW")&('CPRS) S @RAR@("DFLG")=0 K DUOUT,DTOUT,Y,X Q
"RTN","PSODIAG",79,0)
 ;
"RTN","PSODIAG",80,0)
 I '$D(NEW("ICD")) I $D(OLDI) M NEW("ICD")=OLDI ;if user ^ out on first icd
"RTN","PSODIAG",81,0)
 K PSOICDD I '$D(NEW("ICD"))&($G(PSOCOPY)) S PSOICDD=1
"RTN","PSODIAG",82,0)
 ;
"RTN","PSODIAG",83,0)
 S J=0 F I=1:1:8 Q:'$D(NEW("ICD",I))  I NEW("ICD",I)'="" S J=J+1,@RAR@("ICD",J)=NEW("ICD",I)
"RTN","PSODIAG",84,0)
 S TNEW=I
"RTN","PSODIAG",85,0)
 I X="^" D  ;if up arrow out, set all icd's past ^ point into array
"RTN","PSODIAG",86,0)
 . ;S Y=TNEW-1 F  S Y=$O(OLDI(Y)) Q:Y=""  S J=J+1,@RAR@("ICD",J)=OLDI(Y)
"RTN","PSODIAG",87,0)
 . K @RAR@("ICD") S Y="" F  S Y=$O(SOLDI(Y)) Q:Y=""  S @RAR@("ICD",Y)=SOLDI(Y)
"RTN","PSODIAG",88,0)
 . K PSORXED("FLD",39.3)  ;7/12/04
"RTN","PSODIAG",89,0)
 I $G(CPRS) K PSORX("ICD") M PSORXED("ICD")=@RAR@("ICD"),PSORX("ICD")=@RAR@("ICD")
"RTN","PSODIAG",90,0)
 I $G(PSORXED) K PSORX("ICD") M PSORX("ICD")=@RAR@("ICD")
"RTN","PSODIAG",91,0)
 I '$D(@RAR@("ICD"))&(CPRS) S PSONEW("IDFLG")=1 ;user deleted all in finish/complete order
"RTN","PSODIAG",92,0)
 Q:(RAR="PSONEW")
"RTN","PSODIAG",93,0)
 I '$D(@RAR@("ICD"))&('CPRS)&($D(^PSRX(PSOX("IRXN"),"ICD",1,0))) S PSORXED("IDFLG")=1  ;user deleted all
"RTN","PSODIAG",94,0)
 Q
"RTN","PSODIAG",95,0)
 ;
"RTN","PSODIAG",96,0)
 ;called from above to write previously entered ICD's to screen.
"RTN","PSODIAG",97,0)
WRITE S J=I-1 I I=1 W !,?10,"Primary: ",OLD(I),?30,$P($$ICDDX^ICDCODE(OLD(I),FILDAT),U,4) Q
"RTN","PSODIAG",98,0)
WRITE2 I I=2 W !,?3,"Secondaries #"_J_": ",OLD(I),?30,$P($$ICDDX^ICDCODE(OLD(I),FILDAT),U,4) Q
"RTN","PSODIAG",99,0)
 I I>2 W !,?15,"#"_J_": ",OLD(I),?30,$P($$ICDDX^ICDCODE(OLD(I),FILDAT),U,4)
"RTN","PSODIAG",100,0)
 Q
"RTN","PSODIAG",101,0)
STATCHK(ICDIEN,FILDAT) ;called from above to check active/inactive date during FileMan call.
"RTN","PSODIAG",102,0)
 N X S X=""
"RTN","PSODIAG",103,0)
 S ICDIEN=$P(^ICD9(ICDIEN,0),"^",1) S X=$$STATCHK^ICDAPIU(ICDIEN,FILDAT)
"RTN","PSODIAG",104,0)
 Q +X
"RTN","PSODIAG",105,0)
DELETE ;called from above to verify delete with user and to delete said entries
"RTN","PSODIAG",106,0)
 W !,"SURE YOU WANT TO DELETE? " S X="" R X:30 S X=$TR(X,"yn","YN")
"RTN","PSODIAG",107,0)
 I X'="Y"&(X'="N") W !,"Enter Y or N" G DELETE
"RTN","PSODIAG",108,0)
 I X="N" S I=I-1 Q
"RTN","PSODIAG",109,0)
 F J=I:1:8 Q:'$D(OLDI(J))  D
"RTN","PSODIAG",110,0)
 . I $D(OLDI(J+1)) S OLDI(J)=OLDI(J+1),OLD(J)=OLD(J+1) D
"RTN","PSODIAG",111,0)
 .. I CPRS&($D(PSONEW("ICD",J+1))) S PSONEW("ICD",J)=PSONEW("ICD",J+1)
"RTN","PSODIAG",112,0)
 .. E  I CPRS&('$D(PSONEW("ICD",J+1))) S PSONEW("ICD",J)=OLDI(J+1)
"RTN","PSODIAG",113,0)
 .. I $G(PSOCOPY) D
"RTN","PSODIAG",114,0)
 ... I ($D(PSONEW("ICD",J+1))) S PSONEW("ICD",J)=PSONEW("ICD",J+1)
"RTN","PSODIAG",115,0)
 ... I ($D(PSORXED("ICD",J+1))) S PSORXED("ICD",J)=PSORXED("ICD",J+1)
"RTN","PSODIAG",116,0)
 . E  K OLD(J),OLDI(J),PSONEW("ICD",J),PSORXED("ICD",J)
"RTN","PSODIAG",117,0)
 . ;I CPRS!($G(PSOCOPY)) K PSONEW("ICD",J),PSORXED("ICD",J)
"RTN","PSODIAG",118,0)
 S I=I-1,(X,Y)=""
"RTN","PSODIAG",119,0)
 Q
"RTN","PSODIAG",120,0)
 ;
"RTN","PSODIAG",121,0)
ICD ;called from PSON52 cause PSON52'S too large.  Stores ICD info for new Rx's (CPRS and backdoor) using variables from copy function and new order functions.
"RTN","PSODIAG",122,0)
 N D,DDATA,ICD
"RTN","PSODIAG",123,0)
 I $G(PSOCOPY)&('$D(PSOX("ICD")))&('$G(PSOICDD)) D
"RTN","PSODIAG",124,0)
 . S D=0 F D=1:1 Q:'$D(PSOX("ICD",D))
"RTN","PSODIAG",125,0)
 . F D=D:1:8 K ^PSRX(PSOX("IRXN"),"ICD",D,0)  ;remove any icd's del
"RTN","PSODIAG",126,0)
 . I $D(^PSRX(PSOX("OIRXN"),"ICD",0)) F D=1:1:8 Q:'$D(^PSRX(PSOX("OIRXN"),"ICD",D,0))  S PSOX("ICD",D)=$P(^PSRX(PSOX("OIRXN"),"ICD",D,0),U,1)
"RTN","PSODIAG",127,0)
 I $G(ORD) I $D(^PS(52.41,ORD,0))&($D(PSORX("ICD"))) M PSOX("ICD")=PSONEW("ICD")
"RTN","PSODIAG",128,0)
 I $D(PSOX("ICD")) F D=1:1:8 Q:'$D(PSOX("ICD",D))  S ICD=$G(PSOX("ICD",D)) D
"RTN","PSODIAG",129,0)
 . S DDATA="",DDATA=ICD_"^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$S(PSOSCP>49:$G(PSOANSQ("SC>50")),PSOSCP<50&(PSOSCP'=""):$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))
"RTN","PSODIAG",130,0)
 . I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1 I PSOSCP<50&($D(PSOANSQ("SC>50"))) S $P(DDATA,"^",4)=PSOANSQ("SC>50")  ;for times when sc has no % defined.
"RTN","PSODIAG",131,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",D,0)=DDATA
"RTN","PSODIAG",132,0)
 E  S D=1 D  S D=2
"RTN","PSODIAG",133,0)
 . S DDATA="",DDATA="^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$S(PSOSCP>49:$G(PSOANSQ("SC>50")),PSOSCP<50&(PSOSCP'=""):$G(PSOANSQ("SC")),1:"")
"RTN","PSODIAG",134,0)
 . S DDATA=DDATA_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))
"RTN","PSODIAG",135,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",D,0)=DDATA
"RTN","PSODIAG",136,0)
 . I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1 I PSOSCP<50&($D(PSOANSQ("SC>50"))) S $P(^PSRX(PSOX("IRXN"),"ICD",D,0),"^",4)=PSOANSQ("SC>50")
"RTN","PSODIAG",137,0)
 S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311P^"_(D-1)_"^"_(D-1)
"RTN","PSODIAG",138,0)
 K PSOX("ICD"),PSORXED("ICD"),PSONEW("ICD"),PSORX("ICD")
"RTN","PSODIAG",139,0)
 Q
"RTN","PSODIAG",140,0)
 ;
"RTN","PSODIAG",141,0)
UPDATE ;was in PSOORED6; now called from PSOORED6; removes deletes for edits and stores data.
"RTN","PSODIAG",142,0)
 ;
"RTN","PSODIAG",143,0)
 N TNEW,DA,DIK
"RTN","PSODIAG",144,0)
 S DA=PSORXED("IRXN")
"RTN","PSODIAG",145,0)
 ;I $D(PSORXED("FLD",39.3)) D
"RTN","PSODIAG",146,0)
 I '$D(PSORXED("ICD"))&($G(PSORXED("IDFLG"))) D  K PSORXED("IDFLG") Q
"RTN","PSODIAG",147,0)
 . I $D(^PSRX(PSORXED("IRXN"),"ICD",1,0)) D
"RTN","PSODIAG",148,0)
 .. S TNEW=2 K ^PSRX(PSORXED("IRXN"),"ICD","B") S $P(^PSRX(PSORXED("IRXN"),"ICD",1,0),U,1)=""
"RTN","PSODIAG",149,0)
 .. F I=TNEW:1:8 Q:'$D(^PSRX(PSORXED("IRXN"),"ICD",I,0))  S DIK="^PSRX("_PSORXED("IRXN")_","_$C(34)_"ICD"_$C(34)_",",DA=I,DA(1)=PSORXED("IRXN") D ^DIK K DA,DIK
"RTN","PSODIAG",150,0)
 N I,XX,SCEI,J
"RTN","PSODIAG",151,0)
 S SCEI="^^^^^^^",DA=PSORXED("IRXN")
"RTN","PSODIAG",152,0)
 F I=1:1:8 Q:'$D(^PSRX(DA,"ICD",I,0))  S SCEI(I)=^PSRX(DA,"ICD",I,0),SCEI=SCEI(I)
"RTN","PSODIAG",153,0)
 K ^PSRX(DA,"ICD"),^PSRX(DA,"ICD","B")
"RTN","PSODIAG",154,0)
 F I=1:1:8 Q:'$D(PSORXED("ICD",I))
"RTN","PSODIAG",155,0)
 F I=I:1:8 K SCEI(I)  ;remove all icd's past last sequence entered by user
"RTN","PSODIAG",156,0)
 F I=1:1:8 Q:'$D(PSORXED("ICD",I))  S:'$D(SCEI(I)) SCEI(I)=SCEI S $P(SCEI(I),U,1)=PSORXED("ICD",I)
"RTN","PSODIAG",157,0)
 S ^PSRX(DA,"ICD",0)="^52.052311P^"_(I-1)_U_(I-1)
"RTN","PSODIAG",158,0)
 F I=1:1:8 D
"RTN","PSODIAG",159,0)
 . I '$D(SCEI(I)) D  Q
"RTN","PSODIAG",160,0)
 .. I $D(^PSRX(DA,"ICD",I,0)) K ^PSRX(DA,"ICD",I,0) Q
"RTN","PSODIAG",161,0)
 . E  S ^PSRX(DA,"ICD",I,0)=SCEI(I) S:$P(SCEI(I),U,1)'="" ^PSRX(DA,"ICD","B",$P(SCEI(I),U,1),I)=""
"RTN","PSODIAG",162,0)
 K PSORXED("FLD",39.3)
"RTN","PSODIAG",163,0)
 Q
"RTN","PSOMLLD2")
0^2^B22361376
"RTN","PSOMLLD2",1,0)
PSOMLLD2 ;BIR/LE - Service Connection Check for SC>50% ;02/27/04
"RTN","PSOMLLD2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143,219**;DEC 1997
"RTN","PSOMLLD2",3,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSOMLLD2",4,0)
 ;External reference SDC022 supported by DBIA 1579
"RTN","PSOMLLD2",5,0)
 ;External reference DIS^SDROUT2 private by DBIA 112
"RTN","PSOMLLD2",6,0)
SC ;This routine is used for SC>50% - OUTSIDE OF COPAY
"RTN","PSOMLLD2",7,0)
 I $G(PSODFN)&(PSOSCP="") S DFN=PSODFN D ELIG^VADPT Q:$P(VAEL(3),U,1)'=1  G SC2  ;ask sc quest same as legacy copay;ask if sc is flagged yes even though percentage is null
"RTN","PSOMLLD2",8,0)
 I PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1) S DFN=PSODFN D ELIG^VADPT Q:$P(VAEL(3),U,1)'=1  G SC2  ;ask quest same as legacy copay; ask if SC<50 and copay is exempt.
"RTN","PSOMLLD2",9,0)
 I $G(PSODFN) I '$$SC^SDCO22(PSODFN) D  Q  ;if SC>49 don't ask if api says not to
"RTN","PSOMLLD2",10,0)
 . K PSOANSQ("SC>50"),PSOANSQD("SC>50") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"SC>50")
"RTN","PSOMLLD2",11,0)
SC2 I $G(PSOMESOI)=1,$G(PSORXED) W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESOI=2
"RTN","PSOMLLD2",12,0)
 I $G(PSOMESFI)=1 W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESFI=2
"RTN","PSOMLLD2",13,0)
 K VAEL S DFN=+$G(PSODFN) D DIS^SDROUT2
"RTN","PSOMLLD2",14,0)
 N PSOUFLAG S PSOUFLAG=0 K DIR S DIR(0)="Y"
"RTN","PSOMLLD2",15,0)
 S DIR("A")="Was treatment for a Service Connected condition"
"RTN","PSOMLLD2",16,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related",DIR("?",2)="to Service Connected."
"RTN","PSOMLLD2",17,0)
 I '$G(PSOFLAG) D
"RTN","PSOMLLD2",18,0)
 . I PSOSCP<50 S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",19,0)
 . I PSOSCP<50&($D(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=1:"YES",1:"") I DIR("B")=""  K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",20,0)
 . I PSOSCP>49 S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=1:"YES",1:"") I DIR("B")=""  K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",21,0)
 . I '$D(DIR("B"))&($D(PSOANSQD("SC>50"))!($D(PSOANSQD("SC")))) D  I '$D(DIR("B")) K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",22,0)
 .. I $D(PSOANSQD("SC>50")) I $G(PSOANSQD("SC>50"))=0!($G(PSOANSQD("SC>50"))=1) S (PSOUFLAG,DIR("B"))=$S($G(PSOANSQD("SC>50"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",23,0)
 .. I $D(PSOANSQD("SC")) I $G(PSOANSQD("SC"))=0!($G(PSOANSQD("SC"))=1) S (PSOUFLAG,DIR("B"))=$S($G(PSOANSQD("SC"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",24,0)
 I $G(PSORX("SC"))]""!($G(PSORX(+$G(PSORENW("OIRXN")),"SC"))'="") S DIR("B")=$S($G(PSORX("SC"))="SC":"YES",$G(PSORX("SC"))="NSC":"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=1:"YES",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=0:"NO",1:"")
"RTN","PSOMLLD2",25,0)
 ;
"RTN","PSOMLLD2",26,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("SC>50"))=0!($G(PSOANSQD("SC>50"))=1) S DIR("B")=$S($G(PSOANSQD("SC>50"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",27,0)
 I $G(DIR("B"))="YES"!($G(DIR("B"))="NO") S PSOUFLAG=$G(DIR("B"))
"RTN","PSOMLLD2",28,0)
 I $G(DIR("B"))="" K DIR("B")
"RTN","PSOMLLD2",29,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLD2",30,0)
 I $G(Y)=1!($G(Y)=0) D  I $G(PSONEWFF),$G(PSOFLAG) S PSOANSQD("SC>50")=$G(Y)
"RTN","PSOMLLD2",31,0)
 . I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"SC>50")=+Y
"RTN","PSOMLLD2",32,0)
 . S PSOANSQ("SC>50")=+Y
"RTN","PSOMLLD2",33,0)
 I PSOFLAG I Y["^"!($D(DTOUT))!($D(DUOUT)) S PSOCPZ("DFLG")=1
"RTN","PSOMLLD2",34,0)
 S:Y=0 Y=2
"RTN","PSOMLLD2",35,0)
 S PSOANSR=+Y I 'PSOANSR,'PSOFLAG D  S $P(PSOCPAY,"^")=$S($G(PSOUFLAG)="NO":1,1:0) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSOMLLD2",36,0)
 .W !!,"This Renewal has been designated as "_$S($G(PSOUFLAG)="YES":"SERVICE CONNECTED",1:"NON-SERVICE CONNECTED.")
"RTN","PSOMLLD2",37,0)
 .;W !,"Please use the 'Reset Copay Status/Cancel Charges' option to make  corrections."
"RTN","PSOMLLD2",38,0)
 .S PSOANSQ("SC>50")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLD2",39,0)
 I $G(PSOFLAG),$G(PSOCPZ("DFLG")) G EXIT
"RTN","PSOMLLD2",40,0)
 S:PSOANSR=1 PSOCPAY=0 S:PSOANSR=2 $P(PSOCPAY,"^")=1
"RTN","PSOMLLD2",41,0)
EXIT ;
"RTN","PSOMLLD2",42,0)
 K PSOANSR,DIR,DUOUT,DIRUT,DTOUT,Y,X
"RTN","PSOMLLD2",43,0)
 Q
"RTN","PSOMLLD2",44,0)
 ;
"RTN","PSOMLLD2",45,0)
PAUSE K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOMLLD2",46,0)
 Q
"RTN","PSOMLLD2",47,0)
 ;
"RTN","PSOMLLDT")
0^10^B88490307
"RTN","PSOMLLDT",1,0)
PSOMLLDT ;BIR/RTR - Copay date routine ;08/24/01
"RTN","PSOMLLDT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**71,157,143,219**;DEC 1997
"RTN","PSOMLLDT",3,0)
 ;External reference SDC022 supported by DBIA 1579
"RTN","PSOMLLDT",4,0)
 ;External reference DGMSTAPI supported by DBIA2716
"RTN","PSOMLLDT",5,0)
 ;CIDC: Before doing EI question, check to see if should ask ei question 
"RTN","PSOMLLDT",6,0)
 ; because the flag could have changed in enrollment and we shouldn't
"RTN","PSOMLLDT",7,0)
 ; ask if not flagged and should set nulls for answer if Rx is renewed
"RTN","PSOMLLDT",8,0)
 ; or copied when flags changed.  Also, CPRS sometimes sends zeros for
"RTN","PSOMLLDT",9,0)
 ; null answers. 5/12/04
"RTN","PSOMLLDT",10,0)
DT() ;function for Copay date
"RTN","PSOMLLDT",11,0)
 ;0 means Copay not in effect, 1 means Copay in effect
"RTN","PSOMLLDT",12,0)
 N PSOMILDT
"RTN","PSOMLLDT",13,0)
 S PSOMILDT=3020101
"RTN","PSOMLLDT",14,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOMLLDT",15,0)
 Q $S(DT<PSOMILDT:0,1:1)
"RTN","PSOMLLDT",16,0)
 ;
"RTN","PSOMLLDT",17,0)
 Q
"RTN","PSOMLLDT",18,0)
 ;New Copay questions, require if a Renewal
"RTN","PSOMLLDT",19,0)
 ;PSOFLAG=1 for New, PSOFLAG=0 for Renewal
"RTN","PSOMLLDT",20,0)
MST ;Military Sexual Trauma Question
"RTN","PSOMLLDT",21,0)
 I $G(PSODFN) I $P($$GETSTAT^DGMSTAPI(PSODFN),"^",2)'="Y" D  Q
"RTN","PSOMLLDT",22,0)
 . K PSOANSQ("MST"),PSOANSQD("MST") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"MST")
"RTN","PSOMLLDT",23,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",24,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",25,0)
 S DIR("A")="Was treatment related to Military Sexual Trauma"
"RTN","PSOMLLDT",26,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related",DIR("?",2)="to Military Sexual Trauma. This response will be used to determine whether or"
"RTN","PSOMLLDT",27,0)
 S DIR("?",3)="not a copay should be applied to the prescription."
"RTN","PSOMLLDT",28,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"MST"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"MST"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",29,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("MST"))=0!($G(PSOANSQD("MST"))=1) S DIR("B")=$S($G(PSOANSQD("MST"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",30,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",31,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",32,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",33,0)
 .S PSOANSQ("MST")=Y
"RTN","PSOMLLDT",34,0)
 .I $G(PSONEWFF) S PSOANSQD("MST")=Y
"RTN","PSOMLLDT",35,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of Military",!,"Sexual Trauma." D:$G(PSOSCP)<50 MESSM D PAUSE Q
"RTN","PSOMLLDT",36,0)
 .S PSOANSQ(PSOX("IRXN"),"MST")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",37,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"MST")=Y
"RTN","PSOMLLDT",38,0)
 E  S PSOANSQ("MST")=Y
"RTN","PSOMLLDT",39,0)
 Q
"RTN","PSOMLLDT",40,0)
VEH ;Vietnam-Era Herbicide Question
"RTN","PSOMLLDT",41,0)
 I $G(PSODFN) I '$$AO^SDCO22(PSODFN) D  Q
"RTN","PSOMLLDT",42,0)
 . K PSOANSQ("VEH"),PSOANSQD("VEH") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"VEH")
"RTN","PSOMLLDT",43,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",44,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",45,0)
 S DIR("A")="Was treatment related to Agent Orange exposure"
"RTN","PSOMLLDT",46,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="Vietnam-Era Herbicide (Agent Orange) exposure. This response will be used to"
"RTN","PSOMLLDT",47,0)
 S DIR("?",3)="determine whether or not a copay should be applied to the prescription."
"RTN","PSOMLLDT",48,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"VEH"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"VEH"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",49,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("VEH"))=0!($G(PSOANSQD("VEH"))=1) S DIR("B")=$S($G(PSOANSQD("VEH"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",50,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",51,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",52,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",53,0)
 .S PSOANSQ("VEH")=Y
"RTN","PSOMLLDT",54,0)
 .I $G(PSONEWFF) S PSOANSQD("VEH")=Y
"RTN","PSOMLLDT",55,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of Vietnam-Era",!,"Herbicide (Agent Orange) exposure." D:$G(PSOSCP)<50 MESSV D PAUSE Q
"RTN","PSOMLLDT",56,0)
 .S PSOANSQ(PSOX("IRXN"),"VEH")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",57,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"VEH")=Y
"RTN","PSOMLLDT",58,0)
 E  S PSOANSQ("VEH")=Y
"RTN","PSOMLLDT",59,0)
 Q
"RTN","PSOMLLDT",60,0)
RAD ;Radiation question
"RTN","PSOMLLDT",61,0)
 I $G(PSODFN) I '$$IR^SDCO22(PSODFN) D  Q
"RTN","PSOMLLDT",62,0)
 . K PSOANSQ("RAD"),PSOANSQD("RAD") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"RAD")
"RTN","PSOMLLDT",63,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",64,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",65,0)
 S DIR("A")="Was treatment related to Ionizing Radiation exposure"
"RTN","PSOMLLDT",66,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="ionizing radiation exposure during military service. This response will be used"
"RTN","PSOMLLDT",67,0)
 S DIR("?",3)="to determine whether or not a copay should be applied to the prescription."
"RTN","PSOMLLDT",68,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"RAD"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"RAD"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",69,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("RAD"))=0!($G(PSOANSQD("RAD"))=1) S DIR("B")=$S($G(PSOANSQD("RAD"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",70,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",71,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",72,0)
 .I Y["^"!($D(DUOUT))!($G(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",73,0)
 .S PSOANSQ("RAD")=Y
"RTN","PSOMLLDT",74,0)
 .I $G(PSONEWFF) S PSOANSQD("RAD")=Y
"RTN","PSOMLLDT",75,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of ionizing",!,"radiation exposure." D:$G(PSOSCP)<50 MESSM D PAUSE Q
"RTN","PSOMLLDT",76,0)
 .S PSOANSQ(PSOX("IRXN"),"RAD")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",77,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"RAD")=Y
"RTN","PSOMLLDT",78,0)
 E  S PSOANSQ("RAD")=Y
"RTN","PSOMLLDT",79,0)
 Q
"RTN","PSOMLLDT",80,0)
PGW ;Persian Gulf War question
"RTN","PSOMLLDT",81,0)
 I $G(PSODFN) I '$$EC^SDCO22(PSODFN) D  Q
"RTN","PSOMLLDT",82,0)
 . K PSOANSQ("PGW"),PSOANSQD("PGW") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"PGW")
"RTN","PSOMLLDT",83,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",84,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",85,0)
 S DIR("A")="Was treatment related to Environmental Contaminant exposure"
"RTN","PSOMLLDT",86,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="environmental contaminant exposure during the Persian Gulf War. This response"
"RTN","PSOMLLDT",87,0)
 S DIR("?",3)="will be used to determine whether or not a copay should be applied to the",DIR("?",4)="prescription."
"RTN","PSOMLLDT",88,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"PGW"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"PGW"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",89,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("PGW"))=0!($G(PSOANSQD("PGW"))=1) S DIR("B")=$S($G(PSOANSQD("PGW"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",90,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",91,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",92,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",93,0)
 .S PSOANSQ("PGW")=Y
"RTN","PSOMLLDT",94,0)
 .I $G(PSONEWFF) S PSOANSQD("PGW")=Y
"RTN","PSOMLLDT",95,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of",!,"environmental contaminant exposure during the Persian Gulf War." D:$G(PSOSCP)<50 MESS D PAUSE Q
"RTN","PSOMLLDT",96,0)
 .S PSOANSQ(PSOX("IRXN"),"PGW")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",97,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"PGW")=Y
"RTN","PSOMLLDT",98,0)
 E  S PSOANSQ("PGW")=Y
"RTN","PSOMLLDT",99,0)
 Q
"RTN","PSOMLLDT",100,0)
HNC ;Head or Neck Cancer question
"RTN","PSOMLLDT",101,0)
 I $G(PSODFN) I $T(GETCUR^DGNTAPI)]"" N PSONCP,PSONCPX S PSONCPX=$$GETCUR^DGNTAPI(PSODFN,"PSONCP") I $P($G(PSONCP("IND")),"^")'="Y" D  Q
"RTN","PSOMLLDT",102,0)
 . K PSOANSQ("HNC"),PSOANSQD("HNC") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"HNC")
"RTN","PSOMLLDT",103,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",104,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",105,0)
 S DIR("A")="Was treatment related to Head and/or Neck Cancer"
"RTN","PSOMLLDT",106,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat Head and/or Neck Cancer",DIR("?",2)="due to nose or throat radium treatments while in the military. This response"
"RTN","PSOMLLDT",107,0)
 S DIR("?",3)="will be used to determine whether or not a copay should be applied to the",DIR("?",4)="prescription."
"RTN","PSOMLLDT",108,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"HNC"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"HNC"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",109,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("HNC"))=0!($G(PSOANSQD("HNC"))=1) S DIR("B")=$S($G(PSOANSQD("HNC"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",110,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",111,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",112,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",113,0)
 .S PSOANSQ("HNC")=Y
"RTN","PSOMLLDT",114,0)
 .I $G(PSONEWFF) S PSOANSQD("HNC")=Y
"RTN","PSOMLLDT",115,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment related to",!,"Head and/or Neck Cancer." D:$G(PSOSCP)<50 MESSV D PAUSE Q
"RTN","PSOMLLDT",116,0)
 .S PSOANSQ(PSOX("IRXN"),"HNC")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",117,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"HNC")=Y
"RTN","PSOMLLDT",118,0)
 E  S PSOANSQ("HNC")=Y
"RTN","PSOMLLDT",119,0)
 Q
"RTN","PSOMLLDT",120,0)
CV ; Combat Veteran Question
"RTN","PSOMLLDT",121,0)
 I $G(PSODFN) I '(+$P($$CVEDT^DGCV(PSODFN),"^",3)) D  Q
"RTN","PSOMLLDT",122,0)
 . K PSOANSQ("CV"),PSOANSQD("CV") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"CV")
"RTN","PSOMLLDT",123,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",124,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",125,0)
 S DIR("A")="Was treatment related to Combat"
"RTN","PSOMLLDT",126,0)
 S DIR("?")=" "
"RTN","PSOMLLDT",127,0)
 S DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to"
"RTN","PSOMLLDT",128,0)
 S DIR("?",2)="active duty in a theater of combat operations during a period of war after the"
"RTN","PSOMLLDT",129,0)
 S DIR("?",3)="Gulf War. This response will be used to determine whether or not a copay should"
"RTN","PSOMLLDT",130,0)
 S DIR("?",4)="be applied to the prescription."
"RTN","PSOMLLDT",131,0)
 I '$G(PSOFLAG) D
"RTN","PSOMLLDT",132,0)
 .  S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"CV"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"CV"))=1:"YES",1:"")
"RTN","PSOMLLDT",133,0)
 .  I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",134,0)
 I $G(PSOFLAG),$G(PSONEWFF) D
"RTN","PSOMLLDT",135,0)
 .  I $G(PSOANSQD("CV"))=0!($G(PSOANSQD("CV"))=1) D
"RTN","PSOMLLDT",136,0)
 .  .  S DIR("B")=$S($G(PSOANSQD("CV"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",137,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",138,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",139,0)
 .  I Y["^"!($D(DUOUT))!($G(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",140,0)
 .  S PSOANSQ("CV")=Y
"RTN","PSOMLLDT",141,0)
 .  I $G(PSONEWFF) S PSOANSQD("CV")=Y
"RTN","PSOMLLDT",142,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  Q
"RTN","PSOMLLDT",143,0)
 .  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="YES":"",1:" NOT")_" being used for treatment of military"
"RTN","PSOMLLDT",144,0)
 .  W !,"combat service." D:$G(PSOSCP)<50 MESSM D PAUSE
"RTN","PSOMLLDT",145,0)
 .  S PSOANSQ(PSOX("IRXN"),"CV")=$S($G(PSOUFLAG)="YES":1,1:0)
"RTN","PSOMLLDT",146,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"CV")=Y
"RTN","PSOMLLDT",147,0)
 E  S PSOANSQ("CV")=Y
"RTN","PSOMLLDT",148,0)
 Q
"RTN","PSOMLLDT",149,0)
PAUSE ;
"RTN","PSOMLLDT",150,0)
 K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOMLLDT",151,0)
 Q
"RTN","PSOMLLDT",152,0)
MESS ;
"RTN","PSOMLLDT",153,0)
 Q:$G(PSODRUG("DEA"))["S"!($G(PSODRUG("DEA"))["I")
"RTN","PSOMLLDT",154,0)
 W !,"Please use the 'Reset Copay Status/Cancel Charges' option to make corrections.",!
"RTN","PSOMLLDT",155,0)
 Q
"RTN","PSOMLLDT",156,0)
MESSM ;
"RTN","PSOMLLDT",157,0)
 Q:$G(PSODRUG("DEA"))["S"!($G(PSODRUG("DEA"))["I")
"RTN","PSOMLLDT",158,0)
 W " Please use the 'Reset Copay Status/Cancel Charges' option",!,"to make corrections.",!
"RTN","PSOMLLDT",159,0)
 Q
"RTN","PSOMLLDT",160,0)
MESSV ;
"RTN","PSOMLLDT",161,0)
 Q:$G(PSODRUG("DEA"))["S"!($G(PSODRUG("DEA"))["I")
"RTN","PSOMLLDT",162,0)
 W " Please use the 'Reset Copay Status/Cancel",!,"Charges' option to make corrections.",!
"RTN","PSON52")
0^6^B56762334
"RTN","PSON52",1,0)
PSON52 ;BIR/DSD - files new entries in prescription file ;08/09/93
"RTN","PSON52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,16,23,27,32,46,71,111,124,117,131,139,157,143,219**;DEC 1997
"RTN","PSON52",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSON52",4,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSON52",5,0)
 ;External reference to ^XUSEC supported by DBIA 10076
"RTN","PSON52",6,0)
EN(PSOX) ;Entry Point
"RTN","PSON52",7,0)
START ;
"RTN","PSON52",8,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Monitor
"RTN","PSON52",9,0)
 D INIT G:PSON52("QFLG") END D NFILE Q:$G(PSONEW("DFLG"))  D PS55,DIK
"RTN","PSON52",10,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Monitor
"RTN","PSON52",11,0)
 D FINISH
"RTN","PSON52",12,0)
 ;I $P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)'=1,$G(DUZ("AG"))="V" S PSOFLAG=1,DA=PSOX("IRXN") D COPAY^PSOCPB
"RTN","PSON52",13,0)
 I $P(^PSRX(PSOX("IRXN"),0),"^",11)="W",$G(^("IB")) S ^PSRX("ACP",$P(^PSRX(PSOX("IRXN"),0),"^",2),$P(^(2),"^",2),0,PSOX("IRXN"))=""
"RTN","PSON52",14,0)
END D EOJ
"RTN","PSON52",15,0)
 Q
"RTN","PSON52",16,0)
INIT ;
"RTN","PSON52",17,0)
 K X,%DT S:$G(PSOID) PSOX("ISSUE DATE")=PSOID
"RTN","PSON52",18,0)
 S PSOX("CS")=0
"RTN","PSON52",19,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSOX("CS"),"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSOX("CS"),"^",2)=1
"RTN","PSON52",20,0)
 S PSON52("QFLG")=0,X1=PSOX("ISSUE DATE"),X2=PSOX("DAYS SUPPLY")*(PSOX("# OF REFILLS")+1)\1
"RTN","PSON52",21,0)
 I $D(CLOZPAT) S X2=$S(X2=14:14,X2=7:7,1:X2) G DT
"RTN","PSON52",22,0)
 S X2=$S(PSOX("DAYS SUPPLY")=X2:X2,+$G(PSOX("CS")):184,+$G(DEA("CS")):184,1:366)
"RTN","PSON52",23,0)
 I X2<30 D
"RTN","PSON52",24,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSON52",25,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSON52",26,0)
DT D C^%DTC S PSOX("STOP DATE")=$P(X,".") K X
"RTN","PSON52",27,0)
 I PSOX("# OF REFILLS")>0 S X1=PSOX("FILL DATE"),X2=$S((PSOX("DAYS SUPPLY")-10\1)<1:1,1:PSOX("DAYS SUPPLY")-10\1) D C^%DTC S PSOX("NEXT POSSIBLE REFILL")=$P(X,".") K X
"RTN","PSON52",28,0)
 S PSOX("TYPE OF RX")=0,PSOX("DISPENSED DATE")=PSOX("FILL DATE") D NOW^%DTC S PSOX("LOGIN DATE")=$S($P($G(OR0),"^",12):$P($G(OR0),"^",12),1:%) K %,X
"RTN","PSON52",29,0)
 S PSOX("STATUS")=$S($G(PSOX("STATUS"))]"":PSOX("STATUS"),$D(PSORX("VERIFY")):1,1:0)
"RTN","PSON52",30,0)
 S PSOX("COPIES")=$S($G(PSOX("COPIES"))]"":PSOX("COPIES"),1:1)
"RTN","PSON52",31,0)
 I $G(PSORX("PHARM"))]"" S PSOX("PHARMACIST")=PSORX("PHARM") K PSORX("PHARM")
"RTN","PSON52",32,0)
INITX Q
"RTN","PSON52",33,0)
 ;
"RTN","PSON52",34,0)
NFILE I $G(OR0) D  Q:$G(PSONEW("DFLG"))
"RTN","PSON52",35,0)
 .D NOOR^PSONEW Q:$G(PSONEW("DFLG"))
"RTN","PSON52",36,0)
 .I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSONEW("REMARKS")=$G(PSONEW("REMARKS"))_" CPRS Order #"_$P(OR0,"^")_" Edited."
"RTN","PSON52",37,0)
 S DIC="^PSRX(",DLAYGO=52,DIC(0)="L",X=PSOX("RX #") K DD,DO D FILE^DICN S PSOX("IRXN")=+Y K DLAYGO,X,Y,DIC,DD,DO D:+$G(DGI) TECH^PSODGDGI
"RTN","PSON52",38,0)
 F PSOX1=0:1 S PSON52=$P($T(DD+PSOX1),";;",2,4) Q:PSON52=""  K PSOY S PSOY=$P(PSON52,";;") I $G(@PSOY)]"" S $P(PSON52(PSOX("IRXN"),$P(PSON52,";;",2)),"^",$P(PSON52,";;",3))=@PSOY
"RTN","PSON52",39,0)
 F I=1:1:PSOX("ENT") S ^PSRX(PSOX("IRXN"),6,I,0)=PSOX("DOSE",I)_"^"_$G(PSOX("DOSE ORDERED",I))_"^"_$G(PSOX("UNITS",I))_"^"_$G(PSOX("NOUN",I))_"^" D
"RTN","PSON52",40,0)
 .S ^PSRX(PSOX("IRXN"),6,I,0)=^PSRX(PSOX("IRXN"),6,I,0)_$G(PSOX("DURATION",I))_"^"_$G(PSOX("CONJUNCTION",I))_"^"_$G(PSOX("ROUTE",I))_"^"_$G(PSOX("SCHEDULE",I))_"^"_$G(PSOX("VERB",I))
"RTN","PSON52",41,0)
 .I $G(PSOX("ODOSE",I))]"" S ^PSRX(PSOX("IRXN"),6,I,1)=PSOX("ODOSE",I)
"RTN","PSON52",42,0)
 S ^PSRX(PSOX("IRXN"),6,0)="^52.0113^"_PSOX("ENT")_"^"_PSOX("ENT")
"RTN","PSON52",43,0)
 K PSOX1,PSOY
"RTN","PSON52",44,0)
 S PSOX1="" F  S PSOX1=$O(PSON52(PSOX("IRXN"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),PSOX1)=$G(PSON52(PSOX("IRXN"),PSOX1))
"RTN","PSON52",45,0)
 I $O(PSOX("SIG",0)) D
"RTN","PSON52",46,0)
 .S D=0 F  S D=$O(PSOX("SIG",D)) Q:'D  S ^PSRX(PSOX("IRXN"),"INS1",D,0)=PSOX("SIG",D),TP=$G(TP)+1
"RTN","PSON52",47,0)
 .S ^PSRX(PSOX("IRXN"),"INS1",0)="^52.0115^"_TP_"^"_TP_"^"_DT_"^^" K TP,D
"RTN","PSON52",48,0)
 I $G(PSOX("SINS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=PSOX("SINS")
"RTN","PSON52",49,0)
 I $G(SIGOK) D
"RTN","PSON52",50,0)
 .S $P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1,^PSRX(PSOX("IRXN"),"SIG1",0)="^52.04A^^"
"RTN","PSON52",51,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSOX("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSON52",52,0)
 .K SIG
"RTN","PSON52",53,0)
 I $D(PSOINSFL) S ^PSRX(PSOX("IRXN"),"A",0)="^52.3DA^1^1",^PSRX(PSOX("IRXN"),"A",1,0)=DT_"^G^^0^Patient Instructions "_$S(PSOINSFL=1:"",1:"Not ")_"Sent By Provider."
"RTN","PSON52",54,0)
 I $G(OR0) S:$P(OR0,"^",24) ^PSRX(PSOX("IRXN"),"PKI")=1
"RTN","PSON52",55,0)
 K PSOX1,PSOFINFL,HLDSIG,D,PSOINSFL,D
"RTN","PSON52",56,0)
 D:$G(^TMP("PSODAI",$J,0))
"RTN","PSON52",57,0)
 .S $P(^PSRX(PSOX("IRXN"),3),"^",6)=1
"RTN","PSON52",58,0)
 .I $O(^TMP("PSODAI",$J,0)) S DAI=0 F  S DAI=$O(^TMP("PSODAI",$J,DAI)) Q:'DAI  D
"RTN","PSON52",59,0)
 ..S:'$D(^PSRX(PSOX("IRXN"),"DAI",0)) ^PSRX(PSOX("IRXN"),"DAI",0)="^52.03^^" S ^PSRX(PSOX("IRXN"),"DAI",DAI,0)=^TMP("PSODAI",$J,DAI,0)
"RTN","PSON52",60,0)
 ..S $P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1
"RTN","PSON52",61,0)
 .K ^TMP("PSODAI",$J),DAI
"RTN","PSON52",62,0)
 I $G(PSOX("CHCS NUMBER"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^")=$G(PSOX("CHCS NUMBER"))
"RTN","PSON52",63,0)
 I $G(PSOX("EXTERNAL SYSTEM"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^",2)=$G(PSOX("EXTERNAL SYSTEM"))
"RTN","PSON52",64,0)
 I $G(PSOX("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=$G(PSOX("NEWCOPAY"))
"RTN","PSON52",65,0)
 ;Next line, set SC question based on Copay status?
"RTN","PSON52",66,0)
IBQ ;I $G(PSOBILL)=2 S ^PSRX(PSOX("IRXN"),"IBQ")=$S($G(PSOX("NEWCOPAY")):0,1:1)
"RTN","PSON52",67,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))
"RTN","PSON52",68,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="") S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD  ;don't set if SC % is null or 0, just set it in ICD node
"RTN","PSON52",69,0)
 I PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1) S ^PSRX(PSOX("IRXN"),"IBQ")="^^^^^^^"
"RTN","PSON52",70,0)
 D ICD^PSODIAG
"RTN","PSON52",71,0)
 K PSOANSQ,PSOANSQD,PSOX("NEWCOPAY")
"RTN","PSON52",72,0)
 L -^PSRX("B",PSOX("IRXN"))
"RTN","PSON52",73,0)
 Q
"RTN","PSON52",74,0)
 ;
"RTN","PSON52",75,0)
PS55 ;
"RTN","PSON52",76,0)
 L +^PS(55,PSODFN,"P"):0
"RTN","PSON52",77,0)
 S:'$D(^PS(55,PSODFN,"P",0)) ^(0)="^55.03PA^^"
"RTN","PSON52",78,0)
 F PSOX1=$P(^PS(55,PSODFN,"P",0),"^",3):1 Q:'$D(^PS(55,PSODFN,"P",PSOX1))
"RTN","PSON52",79,0)
 S PSOX("55 IEN")=PSOX1
"RTN","PSON52",80,0)
 S ^PS(55,PSODFN,"P",PSOX1,0)=PSOX("IRXN"),$P(^PS(55,PSODFN,"P",0),"^",3,4)=PSOX1_"^"_($P(^PS(55,PSODFN,"P",0),"^",4)+1)
"RTN","PSON52",81,0)
 S ^PS(55,PSODFN,"P","A",PSONEW("STOP DATE"),PSOX("IRXN"))=""
"RTN","PSON52",82,0)
PS55X L -^PS(55,PSODFN,"P")
"RTN","PSON52",83,0)
 K PSOX1
"RTN","PSON52",84,0)
 Q
"RTN","PSON52",85,0)
DIK ;
"RTN","PSON52",86,0)
 I $D(^XUSEC("PSORPH",DUZ)) S DA=PSOX("IRXN"),DIE=52,DR="41////"_PSOCOU_";S:'X Y=""@1"";42////"_PSOCOUU_";@1" D ^DIE K DIE,DR
"RTN","PSON52",87,0)
 K DIK,DA S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSON52",88,0)
 S DA=PSOX("IRXN") D ORC^PSORN52C
"RTN","PSON52",89,0)
 Q
"RTN","PSON52",90,0)
FINISH ;
"RTN","PSON52",91,0)
ANQ I $G(ANQDATA)]"" D NOW^%DTC G:$D(^PS(52.52,"B",%)) ANQ D
"RTN","PSON52",92,0)
 .K DD,DO S DIC="^PS(52.52,",DIC(0)="L",DLAYGO=52.52,X=% D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","PSON52",93,0)
 .S ^PS(52.52,+Y,0)=$P(Y,"^",2)_"^"_PSOX("IRXN")_"^"_ANQDATA,^PS(52.52,"A",PSOX("IRXN"),+Y)="" K ANQDATA,X,Y,%,ANQREM
"RTN","PSON52",94,0)
 G:PSOX("STATUS")=4 FINISHP
"RTN","PSON52",95,0)
 I $D(PSORX("VERIFY")) D  G FINISHX
"RTN","PSON52",96,0)
 .K DIC,DLAYGO,DINUM,DIADD,X,DD,DO S DIC="^PS(52.4,",DLAYGO=52.4,DINUM=PSOX("IRXN"),DIC(0)="ML",X=PSOX("IRXN")
"RTN","PSON52",97,0)
 .D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM S ^PS(52.4,PSOX("IRXN"),0)=PSOX("IRXN")_"^"_PSODFN_"^"_DUZ_"^"_"^"_$E(PSOX("LOGIN DATE"),1,7)_"^"_PSOX("IRXN")_"^"_PSOX("STOP DATE")
"RTN","PSON52",98,0)
 .K DIK,DA S DIK="^PS(52.4,",DA=PSOX("IRXN") D IX^DIK K DIK,DA
"RTN","PSON52",99,0)
 ;
"RTN","PSON52",100,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSON52",101,0)
 ;
"RTN","PSON52",102,0)
FINISHP I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSON52",103,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSON52",104,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSON52",105,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSON52",106,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSON52",107,0)
FINISHX ; 
"RTN","PSON52",108,0)
 ;call to build Rx array for bingo board
"RTN","PSON52",109,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSON52",110,0)
 K PSOX1,PSOX2
"RTN","PSON52",111,0)
 Q
"RTN","PSON52",112,0)
EOJ ;
"RTN","PSON52",113,0)
 ;B xref locked in routine PSONRXN
"RTN","PSON52",114,0)
 L -^PSRX("B",PSOX("IRXN")) K OTHDOS,DA,PSON52,PSOPRC,RTE,SCH,PSOX("INS"),PSONEW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT
"RTN","PSON52",115,0)
 D PSOUL^PSSLOCK(PSOX("IRXN"))
"RTN","PSON52",116,0)
 Q
"RTN","PSON52",117,0)
 ;
"RTN","PSON52",118,0)
 ;;PSOX("SIG");;SIG;;1
"RTN","PSON52",119,0)
DD ;;PSOX("RX #");;0;;1
"RTN","PSON52",120,0)
 ;;PSOX("ISSUE DATE");;0;;13
"RTN","PSON52",121,0)
 ;;PSODFN;;0;;2
"RTN","PSON52",122,0)
 ;;PSOX("PATIENT STATUS");;0;;3
"RTN","PSON52",123,0)
 ;;PSOX("PROVIDER");;0;;4
"RTN","PSON52",124,0)
 ;;PSOX("CLINIC");;0;;5
"RTN","PSON52",125,0)
 ;;PSODRUG("IEN");;0;;6
"RTN","PSON52",126,0)
 ;;PSODRUG("TRADE NAME");;TN;;1
"RTN","PSON52",127,0)
 ;;PSOX("QTY");;0;;7
"RTN","PSON52",128,0)
 ;;PSOX("DAYS SUPPLY");;0;;8
"RTN","PSON52",129,0)
 ;;PSOX("# OF REFILLS");;0;;9
"RTN","PSON52",130,0)
 ;;PSOX("COPIES");;0;;18
"RTN","PSON52",131,0)
 ;;PSOX("MAIL/WINDOW");;0;;11
"RTN","PSON52",132,0)
 ;;PSOX("REMARKS");;3;;7
"RTN","PSON52",133,0)
 ;;PSOX("CLERK CODE");;0;;16
"RTN","PSON52",134,0)
 ;;PSODRUG("COST");;0;;17
"RTN","PSON52",135,0)
 ;;PSOSITE;;2;;9
"RTN","PSON52",136,0)
 ;;PSOX("LOGIN DATE");;2;;1
"RTN","PSON52",137,0)
 ;;PSOX("FILL DATE");;2;;2
"RTN","PSON52",138,0)
 ;;PSOX("PHARMACIST");;2;;3
"RTN","PSON52",139,0)
 ;;PSOX("LOT #");;2;;4
"RTN","PSON52",140,0)
 ;;PSOX("DISPENSED DATE");;2;;5
"RTN","PSON52",141,0)
 ;;PSOX("STOP DATE");;2;;6
"RTN","PSON52",142,0)
 ;;PSODRUG("NDC");;2;;7
"RTN","PSON52",143,0)
 ;;PSODRUG("MANUFACTURER");;2;;8
"RTN","PSON52",144,0)
 ;;PSOX("EXPIRATION DATE");;2;;11
"RTN","PSON52",145,0)
 ;;PSOX("GENERIC PROVIDER");;2;;12
"RTN","PSON52",146,0)
 ;;PSOX("RELEASED DATE/TIME");;2;;13
"RTN","PSON52",147,0)
 ;;PSOX("METHOD OF PICK-UP");;MP;;1
"RTN","PSON52",148,0)
 ;;PSOX("STATUS");;STA;;1
"RTN","PSON52",149,0)
 ;;PSOX("LAST DISPENSED DATE");;3;;1
"RTN","PSON52",150,0)
 ;;PSOX("NEXT POSSIBLE REFILL");;3;;2
"RTN","PSON52",151,0)
 ;;PSOX("COSIGNING PROVIDER");;3;;3
"RTN","PSON52",152,0)
 ;;PSOX("TYPE OF RX");;TYPE;;1
"RTN","PSON52",153,0)
 ;;PSOX("SAND");;SAND;;1
"RTN","PSON52",154,0)
 ;;PSOX("POE");;POE;;1
"RTN","PSON52",155,0)
 ;;PSOX("INS");;INS;;1
"RTN","PSONEWF")
0^11^B44037297
"RTN","PSONEWF",1,0)
PSONEWF ;BIR/RTR - Copay finish questions ;07/26/96
"RTN","PSONEWF",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**71,157,143,219**;DEC 1997
"RTN","PSONEWF",3,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSONEWF",4,0)
START ;
"RTN","PSONEWF",5,0)
 N PSOPENIB,PSOSCOTH,PSOSCOTX,PSOMESFI
"RTN","PSONEWF",6,0)
 S PSOPENIB=$S($G(ORD):$G(^PS(52.41,+$G(ORD),"IBQ")),1:"")
"RTN","PSONEWF",7,0)
 ;set PSOSCOTH for display of Provider Copay intent, used with PSORX(SC)
"RTN","PSONEWF",8,0)
 S PSOSCOTH=0 I $P(PSOPENIB,"^")=1!($P(PSOPENIB,"^",2)=1)!($P(PSOPENIB,"^",3)=1)!($P(PSOPENIB,"^",4)=1)!($P(PSOPENIB,"^",5)=1)!($P(PSOPENIB,"^",6)=1) S PSOSCOTH=1
"RTN","PSONEWF",9,0)
 S PSOSCOTX=0 I $G(PSOSCOTH)!($G(PSORX("SC"))="SC")!($G(PSORX("SC"))="NSC") S PSOSCOTX=1
"RTN","PSONEWF",10,0)
 ;Check for Orderable Item change to display message
"RTN","PSONEWF",11,0)
 S PSOMESFI=0 I $G(OR0),$G(PSODRUG("OI")) D
"RTN","PSONEWF",12,0)
 .I $G(PSODRUG("OI"))'=$P($G(OR0),"^",8) S PSOMESFI=1
"RTN","PSONEWF",13,0)
 S PSONEWFF=1
"RTN","PSONEWF",14,0)
 ;Copay exemption checks
"RTN","PSONEWF",15,0)
 K PSOSCP D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSONEWF",16,0)
 K PSOANSQ D SET S PSOCPZ("DFLG")=0,PSONEW("NEWCOPAY")=0 I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1,$G(DUZ("AG"))="V" S PSOFLAG=1 D COPAY^PSOCPB W !
"RTN","PSONEWF",17,0)
 I $P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1) S PSOANSQ("CV")=$P(PSOPENIB,"^",6)
"RTN","PSONEWF",18,0)
 I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY"),PSONEWFF,PSOSCOTH,PSOSCOTX,PSOMESFI Q
"RTN","PSONEWF",19,0)
 I PSOSCP>49!($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1)!(+PSOBILL=0) D  I $G(PSOCPZ("DFLG")) K PSOANSQ,PSONEW("NEWCOPAY"),PSONEWFF,PSOSCOTH,PSOSCOTX,PSOMESFI Q
"RTN","PSONEWF",20,0)
 . I PSOSCP<50 D MESS S:PSOSCP<50 PSOANSQD("SC>50")=$G(PSOANSQD("SC"))
"RTN","PSONEWF",21,0)
 . S PSOFLAG=1 D SC^PSOMLLD2
"RTN","PSONEWF",22,0)
 . I PSOSCP<50&($D(PSOANSQD("SC"))) S:PSOSCP<50 PSOANSQD("SC")=PSOANSQD("SC>50") K PSOANSQD("SC")
"RTN","PSONEWF",23,0)
 ;IF MILL BILL, AND COPAY (*******TEST THE COPAY CHECK)
"RTN","PSONEWF",24,0)
 I $$DT^PSOMLLDT D  I $G(PSOCPZ("DFLG")) K PSOANSQ,PSONEW("NEWCOPAY"),PSONEWFF,PSOSCOTH,PSOSCOTX,PSOMESFI Q
"RTN","PSONEWF",25,0)
 .;New prompts Quit after first '^'
"RTN","PSONEWF",26,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D  D MESSOI,MESS D CV^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWF",27,0)
 ..I '$D(PSOANSQD("CV")),($P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1)) S PSOANSQD("CV")=$P(PSOPENIB,"^",6)
"RTN","PSONEWF",28,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D  D MESSOI,MESS D VEH^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWF",29,0)
 ..I '$D(PSOANSQD("VEH")),($P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1)) S PSOANSQD("VEH")=$P(PSOPENIB,"^",2)
"RTN","PSONEWF",30,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D  D MESSOI,MESS D RAD^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWF",31,0)
 ..I '$D(PSOANSQD("RAD")),($P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1)) S PSOANSQD("RAD")=$P(PSOPENIB,"^",3)
"RTN","PSONEWF",32,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D  D MESSOI,MESS D PGW^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWF",33,0)
 ..I '$D(PSOANSQD("PGW")),($P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1)) S PSOANSQD("PGW")=$P(PSOPENIB,"^",4)
"RTN","PSONEWF",34,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D  D MESSOI,MESS D MST^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWF",35,0)
 ..I '$D(PSOANSQD("MST")),($P(PSOPENIB,"^")=0!($P(PSOPENIB,"^")=1)) S PSOANSQD("MST")=$P(PSOPENIB,"^")
"RTN","PSONEWF",36,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D  D MESSOI,MESS D HNC^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY")
"RTN","PSONEWF",37,0)
 ..I '$D(PSOANSQD("HNC")),($P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1)) S PSOANSQD("HNC")=$P(PSOPENIB,"^",5)
"RTN","PSONEWF",38,0)
 K PSONEWFF,PSOSCOTH,PSOSCOTX,PSOMESFI
"RTN","PSONEWF",39,0)
 Q
"RTN","PSONEWF",40,0)
SET ;Set original answers that were passed from CPRS
"RTN","PSONEWF",41,0)
 Q:'$G(ORD)
"RTN","PSONEWF",42,0)
 Q:'$G(PSOFDR)
"RTN","PSONEWF",43,0)
 I $P($G(^PS(52.41,ORD,0)),"^",16)="SC"!($P($G(^(0)),"^",16)="NSC") D
"RTN","PSONEWF",44,0)
 . I PSOSCP<50 S PSOANSQ("SC")=$S($P($G(^(0)),"^",16)="SC":1,1:0),PSOANSQD("SC")=PSOANSQ("SC") S:PSOANSQ("SC")'="" PSOIBQS(PSODFN,"SC")=PSOANSQ("SC")
"RTN","PSONEWF",45,0)
 . E  S PSOANSQ("SC>50")=$S($P($G(^(0)),"^",16)="SC":1,1:0),PSOANSQD("SC>50")=PSOANSQ("SC>50") S:PSOANSQ("SC>50")'="" PSOIBQS(PSODFN,"SC>50")=PSOANSQ("SC>50")
"RTN","PSONEWF",46,0)
 I $G(PSOPENIB)="" G ICD1:$D(^PS(52.41,ORD,"ICD")) Q
"RTN","PSONEWF",47,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSONEWF",48,0)
 I $P(PSOPENIB,"^")=0!($P(PSOPENIB,"^")=1) S PSOANSQ("MST")=$P(PSOPENIB,"^")
"RTN","PSONEWF",49,0)
 I $P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1) S PSOANSQ("VEH")=$P(PSOPENIB,"^",2)
"RTN","PSONEWF",50,0)
 I $P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1) S PSOANSQ("RAD")=$P(PSOPENIB,"^",3)
"RTN","PSONEWF",51,0)
 I $P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1) S PSOANSQ("PGW")=$P(PSOPENIB,"^",4)
"RTN","PSONEWF",52,0)
 I $P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1) S PSOANSQ("HNC")=$P(PSOPENIB,"^",5)
"RTN","PSONEWF",53,0)
 I $P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1) S PSOANSQ("CV")=$P(PSOPENIB,"^",6)
"RTN","PSONEWF",54,0)
ICD1 ;
"RTN","PSONEWF",55,0)
 N PSONOCHG S PSONOCHG=0
"RTN","PSONEWF",56,0)
 I ('$D(PSORXED("ICD"))) S PSONOCHG=1
"RTN","PSONEWF",57,0)
 I $D(^PS(52.41,ORD,"ICD",0)) D
"RTN","PSONEWF",58,0)
 . N JJ,ICD,II,FLD,RXN S RXN=ORD
"RTN","PSONEWF",59,0)
 . S II=0 F  S II=$O(^PS(52.41,ORD,"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSONEWF",60,0)
 .. S ICD="",ICD=^PS(52.41,ORD,"ICD",II,0)
"RTN","PSONEWF",61,0)
 .. S JJ="" F JJ=1:1:8 S FLD=$P(ICD,U,JJ) S:$G(PSONEW("IDFLG"))&(JJ=1) FLD=""  D ICD
"RTN","PSONEWF",62,0)
 Q
"RTN","PSONEWF",63,0)
MESS ;
"RTN","PSONEWF",64,0)
 I $G(PSOSCOTX)=1&(PSOSCP<50) W:$G(PSODRUG("DEA"))'["S"&($G(PSODRUG("DEA"))'["I") !,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! S PSOSCOTX=2
"RTN","PSONEWF",65,0)
 Q
"RTN","PSONEWF",66,0)
MESSOI ;
"RTN","PSONEWF",67,0)
 I $G(PSOMESFI)=1 W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESFI=2
"RTN","PSONEWF",68,0)
 Q
"RTN","PSONEWF",69,0)
 ;
"RTN","PSONEWF",70,0)
ICD ;called from PSONEWG and used by PSONEW
"RTN","PSONEWF",71,0)
 I '$D(PSOSCP) D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSONEWF",72,0)
 I JJ=1 D
"RTN","PSONEWF",73,0)
 . I $G(PSOCOPY)&($D(PSORXED("ICD")))&($D(PSONEW("IDFLG"))) Q:'$D(PSORXED("ICD",II))
"RTN","PSONEWF",74,0)
 . I $G(PSOCOPY)&($D(PSORXED("ICD",II))) S PSONEW("ICD",II)=PSORXED("ICD",II) Q
"RTN","PSONEWF",75,0)
 . Q:'$G(PSOCOPY)&('$D(PSORXED("ICD",II)))&('$G(PSONOCHG))  ;don't set deleted ones
"RTN","PSONEWF",76,0)
 . Q:$G(PSONEW("IDFLG"))
"RTN","PSONEWF",77,0)
 . I $D(PSORX("ICD",II)) S PSONEW("ICD",II)=PSORX("ICD",II) Q
"RTN","PSONEWF",78,0)
 . S PSONEW("ICD",II)=FLD
"RTN","PSONEWF",79,0)
 ;
"RTN","PSONEWF",80,0)
 I JJ=2 S:'$G(PSOANSQD("VEH")) PSOANSQD("VEH")="" S:PSOANSQD("VEH")=""!(PSOANSQD("VEH")=0) PSOANSQD("VEH")=FLD,PSORX(RXN,"VEH")=FLD S:FLD'="" PSOIBQS(PSODFN,"VEH")=FLD Q
"RTN","PSONEWF",81,0)
 I JJ=3 S:'$G(PSOANSQD("RAD")) PSOANSQD("RAD")="" S:PSOANSQD("RAD")=""!(PSOANSQD("RAD")=0) PSOANSQD("RAD")=FLD,PSORX(RXN,"RAD")=FLD S:FLD'="" PSOIBQS(PSODFN,"RAD")=FLD Q
"RTN","PSONEWF",82,0)
 I JJ=4 D
"RTN","PSONEWF",83,0)
 . I PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=0) S:'$G(PSOANSQD("SC")) PSOANSQD("SC")="" S:PSOANSQD("SC")=""!(PSOANSQD("SC")="") PSOANSQD("SC")=FLD,PSORX(RXN,"SC")=FLD S:FLD'="" PSOIBQS(PSODFN,"SC")=FLD
"RTN","PSONEWF",84,0)
 . E  S:'$G(PSOANSQD("SC>50")) PSOANSQD("SC>50")="" S:PSOANSQD("SC>50")=""!(PSOANSQD("SC>50")=0) PSOANSQD("SC>50")=FLD,PSORX(RXN,"SC>50")=FLD S:FLD'="" PSOIBQS(PSODFN,"SC>50")=FLD
"RTN","PSONEWF",85,0)
 I JJ=5 S:'$G(PSOANSQD("PGW")) PSOANSQD("PGW")="" S:PSOANSQD("PGW")=""!(PSOANSQD("PGW")=0) PSOANSQD("PGW")=FLD,PSORX(RXN,"PGW")=FLD S:FLD'="" PSOIBQS(PSODFN,"PGW")=FLD Q
"RTN","PSONEWF",86,0)
 I JJ=6 S:'$G(PSOANSQD("MST")) PSOANSQD("MST")="" S:PSOANSQD("MST")=""!(PSOANSQD("MST")=0) PSOANSQD("MST")=FLD,PSORX(RXN,"MST")=FLD S:FLD'="" PSOIBQS(PSODFN,"MST")=FLD Q
"RTN","PSONEWF",87,0)
 I JJ=7 S:'$G(PSOANSQD("HNC")) PSOANSQD("HNC")="" S:PSOANSQD("HNC")=""!(PSOANSQD("HNC")=0) PSOANSQD("HNC")=FLD,PSORX(RXN,"HNC")=FLD S:FLD'="" PSOIBQS(PSODFN,"HNC")=FLD Q
"RTN","PSONEWF",88,0)
 I JJ=8 S:'$G(PSOANSQD("CV")) PSOANSQD("CV")="" S:PSOANSQD("CV")=""!(PSOANSQD("CV")=0) PSOANSQD("CV")=FLD,PSORX(RXN,"CV")=FLD S:FLD'="" PSOIBQS(PSODFN,"CV")=FLD
"RTN","PSONEWF",89,0)
 Q
"RTN","PSONEWG")
0^13^B21775279
"RTN","PSONEWG",1,0)
PSONEWG ;BIR/RTR - Copay copy and edit questions ;07/26/96
"RTN","PSONEWG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**71,157,143,219**;DEC 1997
"RTN","PSONEWG",3,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSONEWG",4,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSONEWG",5,0)
START ;
"RTN","PSONEWG",6,0)
 N PSOPENIB,PSOMESOI
"RTN","PSONEWG",7,0)
 S PSOPENIB="" I $G(PSORXED)!($G(PSOCOPY)) I $G(PSORXED("IRXN")) S PSOPENIB=$G(^PSRX(PSORXED("IRXN"),"IBQ"))
"RTN","PSONEWG",8,0)
 S PSOMESOI=0 I $G(PSORXED) D
"RTN","PSONEWG",9,0)
 .I $G(PSODRUG("OI")),$P($G(PSORXED("RX0")),"^",6) D
"RTN","PSONEWG",10,0)
 ..I $G(PSODRUG("OI"))'=$P($G(^PSDRUG(+$P($G(PSORXED("RX0")),"^",6),2)),"^") S PSOMESOI=1
"RTN","PSONEWG",11,0)
 S PSONEWFF=1
"RTN","PSONEWG",12,0)
 ;Copay exemption checks
"RTN","PSONEWG",13,0)
 K PSOSCP D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSONEWG",14,0)
 K PSOANSQ D SET S PSOCPZ("DFLG")=0,PSONEW("NEWCOPAY")=0 I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1,$G(DUZ("AG"))="V" S PSOFLAG=1 D  D COPAY^PSOCPB W !
"RTN","PSONEWG",15,0)
 .;I $G(PSOANSQD("SC"))=0!($G(PSOANSQD("SC"))=1) Q
"RTN","PSONEWG",16,0)
 .I $G(PSOANSQ("SC"))=0!($G(PSOANSQ("SC"))=1) S PSOANSQD("SC")=$G(PSOANSQ("SC"))
"RTN","PSONEWG",17,0)
 I PSOSCP>49!($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1) S PSOFLAG=1 D SC^PSOMLLD2 I $G(PSOCPZ("DFLG")) K PSOANSQ,PSONEW("NEWCOPAY"),PSONEWFF,PSOMESOI Q
"RTN","PSONEWG",18,0)
 I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY"),PSONEWFF,PSOMESOI Q
"RTN","PSONEWG",19,0)
 ;IF MILL BILL, AND COPAY (*******TEST THE COPAY CHECK)
"RTN","PSONEWG",20,0)
 I $$DT^PSOMLLDT D  I $G(PSOCPZ("DFLG")) K PSOANSQ,PSONEW("NEWCOPAY"),PSONEWFF,PSOMESOI Q
"RTN","PSONEWG",21,0)
 .;New prompts Quit after first '^'
"RTN","PSONEWG",22,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D  D MESS D CV^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWG",23,0)
 ..I '$D(PSOANSQD("CV")),($P(PSOPENIB,"^",7)=0!($P(PSOPENIB,"^",7)=1)) S PSOANSQD("CV")=$P(PSOPENIB,"^",7)
"RTN","PSONEWG",24,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D  D MESS D VEH^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWG",25,0)
 ..I '$D(PSOANSQD("VEH")),($P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1)) S PSOANSQD("VEH")=$P(PSOPENIB,"^",3)
"RTN","PSONEWG",26,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D  D MESS D RAD^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWG",27,0)
 ..I '$D(PSOANSQD("RAD")),($P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1)) S PSOANSQD("RAD")=$P(PSOPENIB,"^",4)
"RTN","PSONEWG",28,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D  D MESS D PGW^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWG",29,0)
 ..I '$D(PSOANSQD("PGW")),($P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1)) S PSOANSQD("PGW")=$P(PSOPENIB,"^",5)
"RTN","PSONEWG",30,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D  D MESS D MST^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWG",31,0)
 ..I '$D(PSOANSQD("MST")),($P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1)) S PSOANSQD("MST")=$P(PSOPENIB,"^",2)
"RTN","PSONEWG",32,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D  D MESS D HNC^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY")
"RTN","PSONEWG",33,0)
 ..I '$D(PSOANSQD("HNC")),($P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1)) S PSOANSQD("HNC")=$P(PSOPENIB,"^",6)
"RTN","PSONEWG",34,0)
 K PSONEWFF,PSOMESOI
"RTN","PSONEWG",35,0)
 Q
"RTN","PSONEWG",36,0)
SET ;Set original answers that were passed from CPRS
"RTN","PSONEWG",37,0)
 Q:'$G(PSORXED("IRXN"))
"RTN","PSONEWG",38,0)
 S PSOANSQ("SC")=$S($P($G(^PSRX(PSORXED("IRXN"),"IBQ")),"^")'="":$P($G(^("IBQ")),"^"),$P($G(^PSRX(PSORXED("IRXN"),"IB")),"^"):0,1:"")
"RTN","PSONEWG",39,0)
 I $G(PSOANSQ("SC"))="" K PSOANSQ("SC")
"RTN","PSONEWG",40,0)
 I $G(PSOPENIB)="" G ICD
"RTN","PSONEWG",41,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSONEWG",42,0)
 I $P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1) S PSOANSQ("MST")=$P(PSOPENIB,"^",2)
"RTN","PSONEWG",43,0)
 I $P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1) S PSOANSQ("VEH")=$P(PSOPENIB,"^",3)
"RTN","PSONEWG",44,0)
 I $P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1) S PSOANSQ("RAD")=$P(PSOPENIB,"^",4)
"RTN","PSONEWG",45,0)
 I $P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1) S PSOANSQ("PGW")=$P(PSOPENIB,"^",5)
"RTN","PSONEWG",46,0)
 I $P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1) S PSOANSQ("HNC")=$P(PSOPENIB,"^",6)
"RTN","PSONEWG",47,0)
 I $P(PSOPENIB,"^",7)=0!($P(PSOPENIB,"^",7)=1) S PSOANSQ("CV")=$P(PSOPENIB,"^",7)
"RTN","PSONEWG",48,0)
ICD ;
"RTN","PSONEWG",49,0)
 N PSONOCHG S PSONOCHG=0
"RTN","PSONEWG",50,0)
 I '$D(PSONEW("ICD"))&('$D(PSORXED("ICD"))) S PSONOCHG=1
"RTN","PSONEWG",51,0)
 I $D(^PSRX(PSORXED("IRXN"),"ICD",0)) D
"RTN","PSONEWG",52,0)
 . N JJ,ICD,II,FLD,RXN,TNEW S RXN=PSORXED("IRXN")
"RTN","PSONEWG",53,0)
 . S II=0 F  S II=$O(^PSRX(RXN,"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSONEWG",54,0)
 .. S ICD="",ICD=^PSRX(RXN,"ICD",II,0)
"RTN","PSONEWG",55,0)
 .. Q:$G(PSOCOPY)&(II>1)&('PSONOCHG)        ;user deleted all after this II or no changes made
"RTN","PSONEWG",56,0)
 .. S JJ="" F JJ=1:1:8 S FLD=$P(ICD,U,JJ) S:$G(PSONEW("IDFLG"))&(JJ=1) FLD="" D ICD^PSONEWF
"RTN","PSONEWG",57,0)
 E  I $G(PSONEW("IDFLG")) K ^PSRX(RXN,"B") S $P(^PSRX(RXN,"ICD",1,0),"^",1)="",TNEW=2 D
"RTN","PSONEWG",58,0)
 . F TNEW=TNEW:1:8 Q:'$D(^PSRX(RXN,"ICD",TNEW,0))  S DIK="^PSRX("_RXN_","_$C(34)_"ICD"_$C(34)_",",DA=TNEW,DA(1)=RXN D ^DIK K DA,DIK ;user deleted all
"RTN","PSONEWG",59,0)
 K PSONEW("IDFLG"),PSORXED("IDFLG")
"RTN","PSONEWG",60,0)
 Q
"RTN","PSONEWG",61,0)
MESS ;
"RTN","PSONEWG",62,0)
 I $G(PSOMESOI)=1,$G(PSORXED) W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing SC or Environmental Indicator defaults carefully for appropriateness.",! S PSOMESOI=2
"RTN","PSONEWG",63,0)
 Q
"RTN","PSOORED6")
0^8^B51610545
"RTN","PSOORED6",1,0)
PSOORED6 ;BIR/SAB - edit orders from backdoor ;03/06/96
"RTN","PSOORED6",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**78,104,117,133,143,219**;DEC 1997
"RTN","PSOORED6",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORED6",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORED6",5,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOORED6",6,0)
DRG ;select drug
"RTN","PSOORED6",7,0)
 S PSORX("EDIT")=1,RX0HLD=RX0
"RTN","PSOORED6",8,0)
 S PSODRUG("IEN")=$S($G(PSODRUG("IEN"))]"":PSODRUG("IEN"),1:$P(RX0,"^",6)),PSODRUG("NAME")=$S($G(PSODRUG("NAME"))]"":PSODRUG("NAME"),1:$P(^PSDRUG($P(RX0,"^",6),0),"^"))
"RTN","PSOORED6",9,0)
 D ^PSODRG I PSODRUG("IEN")=$P(RX0,"^",6) K PSORXED("FLD",6)
"RTN","PSOORED6",10,0)
 D:PSODRUG("IEN")'=$P(RX0,"^",6)  I $G(PSORX("DFLG")) K PSORXED("FLD",6) S PSORXED("DFLG")=1 Q
"RTN","PSOORED6",11,0)
 .D POST^PSODRG
"RTN","PSOORED6",12,0)
 .I '$O(^PSRX(PSORXED("IRXN"),1,0)) S PSORXED("FLD",17)=$G(PSODRUG("COST"))
"RTN","PSOORED6",13,0)
 .I $G(PSORX("DFLG")) K PSORXED("FLD",6),PSODRUG,PSOOIFLG,PSOSIGFL,VALMSG Q
"RTN","PSOORED6",14,0)
 .D KV S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="You have changed the dispense drug from",DIR("A",2)=$P(^PSDRUG($P(PSORXED("RX0"),"^",6),0),"^")_" to "_$P(^PSDRUG(PSODRUG("IEN"),0),"^")_".",DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORED6",15,0)
 .D ^DIR K DIR I $D(DIRUT) S PSORX("DFLG")=1 D M1
"RTN","PSOORED6",16,0)
 .Q:$D(DIRUT)!('Y)
"RTN","PSOORED6",17,0)
 .S PSOREEDQ=1 D DOLST^PSOORED3,DOSE^PSOORED3 K PSOREEDQ
"RTN","PSOORED6",18,0)
 .I '$O(PSORXED("DOSE",0)) S PSORX("DFLG")=1 Q
"RTN","PSOORED6",19,0)
 .D:$G(PSOSIGFL) M2
"RTN","PSOORED6",20,0)
 S RX0=RX0HLD K RX0HLD I $G(PSODRUG("OI"))=$G(PSOI) D  Q
"RTN","PSOORED6",21,0)
 .D:$O(^TMP("PSORXDC",$J,0))
"RTN","PSOORED6",22,0)
 ..W !!,"This edit will discontinue the duplicate Rx & change the dispensed drug!"
"RTN","PSOORED6",23,0)
 ..K DIR,X,Y S DIR("A")="Do You Want to Proceed",DIR("B")="NO",DIR(0)="Y"
"RTN","PSOORED6",24,0)
 ..D ^DIR K DIR S:'Y!($D(DIRUT)) PSORXED("DFLG")=1 D:Y DCORD^PSONEW2
"RTN","PSOORED6",25,0)
 .Q:$G(PSORXED("DFLG"))
"RTN","PSOORED6",26,0)
 .I PSODRUG("IEN")'=$P(RX0,"^",6) D
"RTN","PSOORED6",27,0)
 ..S PSORXED("FLD",6)=PSODRUG("IEN"),PSORXED("FLD",39.2)=PSOI
"RTN","PSOORED6",28,0)
 .S:$G(PSODRUG("TRADE NAME"))]"" PSORXED("FLD",6.5)=PSODRUG("TRADE NAME")
"RTN","PSOORED6",29,0)
 W !!,"New Orderable Item selected. This edit will create a new prescription!",! D PAUSE^VALM1 S VALMSG="New Orderable Item selected. This edit will create a new prescription!" S (PSOOIFLG,PSOSIGFL)=1
"RTN","PSOORED6",30,0)
 Q
"RTN","PSOORED6",31,0)
PSOCOU ;patient counseling
"RTN","PSOORED6",32,0)
 K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED",DR=41 D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED6",33,0)
 D KV S DIR(0)="52,41" S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR) D ^DIR K DIR,PSORXED(52,DA,DR)
"RTN","PSOORED6",34,0)
 I $D(DIRUT) K PSORXED("FLD",41) D KV Q
"RTN","PSOORED6",35,0)
 S PSORXED("FLD",DR)=Y D  K DIRUT
"RTN","PSOORED6",36,0)
 .I Y D  Q
"RTN","PSOORED6",37,0)
 ..K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED",DR=42 D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED6",38,0)
 ..K DIR,DIRUT S DIR(0)="52,42" S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR) D ^DIR K DIR,PSORXED(52,DA,DR)
"RTN","PSOORED6",39,0)
 ..I $D(DIRUT) K PSORXED("FLD",41),DUOUT,DTOUT Q
"RTN","PSOORED6",40,0)
 ..S PSORXED("FLD",42)=Y
"RTN","PSOORED6",41,0)
 .S PSORXED("FLD",41)=0,PSORXED("FLD",42)="@"
"RTN","PSOORED6",42,0)
 Q
"RTN","PSOORED6",43,0)
PSOI ;select orderable item
"RTN","PSOORED6",44,0)
 W !!,"Current Orderable Item: "_$P(^PS(50.7,PSOI,0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSOORED6",45,0)
 S DIC("B")=$P(^PS(50.7,PSOI,0),"^"),DIC="^PS(50.7,",DIC(0)="AEMQZ"
"RTN","PSOORED6",46,0)
 S DIC("S")="I '$P(^PS(50.7,+Y,0),""^"",4)!($P(^(0),""^"",4)'<DT) N PSOF,PSOL S (PSOF,PSOL)=0 F  S PSOL=$O(^PSDRUG(""ASP"",+Y,PSOL)) Q:PSOF!'PSOL  "
"RTN","PSOORED6",47,0)
 S DIC("S")=DIC("S")_"I $P($G(^PSDRUG(PSOL,2)),U,3)[""O"",'$G(^(""I""))!($G(^(""I""))'<DT) S PSOF=1" D ^DIC I "^"[X S PSORXED("DFLG")=1 Q
"RTN","PSOORED6",48,0)
 G:Y<1 PSOI Q:PSOI=+Y
"RTN","PSOORED6",49,0)
 S PSODRUG("OI")=+Y,PSODRUG("OIN")=Y(0,0) K DIC
"RTN","PSOORED6",50,0)
 I PSOI'=PSODRUG("OI") W !!,"New Orderable Item selected. This edit will create a new prescription!",! D  K PSHOLDD Q
"RTN","PSOORED6",51,0)
 .D PAUSE^VALM1,M2
"RTN","PSOORED6",52,0)
 .S PSHOLDD=$G(PSODRUG("IEN")) K PSODRUG("IEN"),PSODRUG("NAME") S PSODRUG("DEA")="",(PSOOIFLG,PSOSIGFL)=1
"RTN","PSOORED6",53,0)
 .D DREN^PSOORNW2
"RTN","PSOORED6",54,0)
 .I $G(PSHOLDD),$G(PSODRUG("IEN")),$G(PSHOLDD)'=$G(PSODRUG("IEN")) D  Q:$G(PSORX("DFLG"))
"RTN","PSOORED6",55,0)
 ..D FULL^VALM1,POST^PSODRG S VALMBCK="R"
"RTN","PSOORED6",56,0)
 ..I $G(PSORX("DFLG")) K PSODRUG S PSODRUG("IEN")=$G(PSHOLDD),PSODRUG("NAME")=$P($G(^PSDRUG(PSODRUG("IEN"),0)),"^") K PSOOIFLG,PSOSIGFL S VALMSG=""
"RTN","PSOORED6",57,0)
 .I '$G(PSODRUG("IEN")) W !!,"DRUG NAME REQUIRED!" D 2^PSOORNW1
"RTN","PSOORED6",58,0)
 .I '$G(PSODRUG("IEN")) K PSORXED("FLD"),INDEL,^TMP($J,"INS1"),PSOSIGFL,VALMSG S PSORXED("DFLG")=1,VALMSG="Dispense Drug NOT Selected!" Q
"RTN","PSOORED6",59,0)
 .D KV S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="You have changed the Orderable Item from",DIR("A",2)=$P(^PS(50.7,PSOI,0),"^")_" to "_PSODRUG("OIN")_".",DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORED6",60,0)
 .D ^DIR K DIR I $D(DIRUT) K PSODRUG("OIN"),PSOOIFLG,PSOSIGFL S PSODRUG("OI")=PSOI,VALMSG="",PSORX("DFLG")=1 Q
"RTN","PSOORED6",61,0)
 .I 'Y S PSORX("DFLG")=1 Q
"RTN","PSOORED6",62,0)
 .S PSOREEDQ=1 D DOLST^PSOORED3,DOSE^PSOORED3 K PSOREEDQ
"RTN","PSOORED6",63,0)
 .I '$O(PSORXED("DOSE",0)) S PSORX("DFLG")=1 Q
"RTN","PSOORED6",64,0)
 .D:$G(PSOSIGFL) M2
"RTN","PSOORED6",65,0)
 S PSORXED("FLD",39.2)=PSOI
"RTN","PSOORED6",66,0)
 Q
"RTN","PSOORED6",67,0)
UPDATE ;add new data to file
"RTN","PSOORED6",68,0)
 N RXREF
"RTN","PSOORED6",69,0)
 Q:'$G(PSORXED("IRXN"))
"RTN","PSOORED6",70,0)
 I $O(PSORXED("FLD",0))!($G(^TMP($J,"INS1",0))]"")!($G(INSDEL))!($O(PSORXED("ODOSE",0))) D  G:'Y UPDX
"RTN","PSOORED6",71,0)
 .K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED6",72,0)
 .S DIR(0)="Y",DIR("A")="Are You Sure You Want to Update Rx "_$P(^PSRX(PSORXED("IRXN"),0),"^"),DIR("B")="Yes"
"RTN","PSOORED6",73,0)
 .D ^DIR K DIR I 'Y D M1 Q
"RTN","PSOORED6",74,0)
 .I $D(^PSRX(PSORXED("IRXN"),1,0))  D
"RTN","PSOORED6",75,0)
 ..S RXREF=$P(^PSRX(PSORXED("IRXN"),0),"^",9)-$P(^PSRX(PSORXED("IRXN"),1,0),"^",4)
"RTN","PSOORED6",76,0)
 .E  S RXREF=0
"RTN","PSOORED6",77,0)
 .K X,DIRUT,DUOUT,DTOUT
"RTN","PSOORED6",78,0)
 I $D(PSORXED("FLD",39.3)) D UPDATE^PSODIAG  ;update ICD's after edit
"RTN","PSOORED6",79,0)
 K Y S DA=PSORXED("IRXN"),DIE="^PSRX(",FLD=0
"RTN","PSOORED6",80,0)
 F  S FLD=$O(PSORXED("FLD",FLD)) Q:'FLD  D
"RTN","PSOORED6",81,0)
 .I FLD=12!(FLD=24)!(FLD=35) D  Q
"RTN","PSOORED6",82,0)
 ..I FLD=12,PSORXED("FLD",12)="@" S $P(^PSRX(DA,3),"^",7)="" Q
"RTN","PSOORED6",83,0)
 ..I FLD=12,PSORXED("FLD",12)]"" S $P(^PSRX(DA,3),"^",7)=PSORXED("FLD",12) Q
"RTN","PSOORED6",84,0)
 ..I FLD=24,PSORXED("FLD",24)="@" S $P(^PSRX(DA,2),"^",4)="" Q
"RTN","PSOORED6",85,0)
 ..I FLD=24,PSORXED("FLD",24)]"" S $P(^PSRX(DA,2),"^",4)=PSORXED("FLD",24) Q
"RTN","PSOORED6",86,0)
 ..I FLD=35,PSORXED("FLD",35)="@" S $P(^PSRX(DA,"MP"),"^")="" Q
"RTN","PSOORED6",87,0)
 ..I FLD=35,PSORXED("FLD",35)]"" S $P(^PSRX(DA,"MP"),"^")=PSORXED("FLD",35) Q
"RTN","PSOORED6",88,0)
 .I FLD=114 D  Q
"RTN","PSOORED6",89,0)
 ..I PSORXED("FLD",114)="@" K ^PSRX(DA,"INS"),^PSRX(DA,"INS1")
"RTN","PSOORED6",90,0)
 ..I PSORXED("FLD",114)'="@" D
"RTN","PSOORED6",91,0)
 ...S ^PSRX(DA,"INS")=PSORXED("FLD",114)
"RTN","PSOORED6",92,0)
 ...S X=PSORXED("FLD",114) D SIG^PSOHELP Q:$G(INS1)']""
"RTN","PSOORED6",93,0)
 ...S PSORXED("SIG",1)=$E(INS1,2,9999999) K ^PSRX(DA,"INS1")
"RTN","PSOORED6",94,0)
 ...S ^PSRX(DA,"INS1",0)="^52.0115^1^1^"_DT_"^^"
"RTN","PSOORED6",95,0)
 ...S ^PSRX(DA,"INS1",1,0)=PSORXED("SIG",1)
"RTN","PSOORED6",96,0)
 ..D DOLST^PSOORED3 K:PSORXED("FLD",114)="@" PSORXED("SIG") D EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3
"RTN","PSOORED6",97,0)
 .S DR=FLD_"////"_PSORXED("FLD",FLD) D ^DIE
"RTN","PSOORED6",98,0)
 .I FLD=4 D UDPROV^PSOOREDT Q
"RTN","PSOORED6",99,0)
 I $G(INSDEL) K ^PSRX(DA,"INS"),^PSRX(DA,"INS1") D DOLST^PSOORED3 K PSORXED("SIG") D EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3 G UPDX
"RTN","PSOORED6",100,0)
 I $O(^TMP($J,"INS1",0)) D
"RTN","PSOORED6",101,0)
 .K ^PSRX(DA,"INS"),^PSRX(DA,"INS1"),DD,PSORXED("SIG")
"RTN","PSOORED6",102,0)
 .F I=0:0 S I=$O(^TMP($J,"INS1",I)) Q:'I  S (PSORXED("SIG",I),^PSRX(DA,"INS1",I,0))=^TMP($J,"INS1",I,0),DD=$G(DD)+1
"RTN","PSOORED6",103,0)
 .S ^PSRX(DA,"INS1",0)=^TMP($J,"INS1",0)
"RTN","PSOORED6",104,0)
 .I DD=1 S ^PSRX(DA,"INS")=^PSRX(DA,"INS1",1,0)
"RTN","PSOORED6",105,0)
 .D DOLST^PSOORED3,EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3
"RTN","PSOORED6",106,0)
 ;
"RTN","PSOORED6",107,0)
UPDX K DIE,DA,DR,FLD,X,Y,PSORXED("FLD"),DD,^TMP($J,"INS1")
"RTN","PSOORED6",108,0)
KV K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED6",109,0)
 Q
"RTN","PSOORED6",110,0)
UPD ;updates dosing array
"RTN","PSOORED6",111,0)
 S HENT=ENT
"RTN","PSOORED6",112,0)
UPD1 ;
"RTN","PSOORED6",113,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD
"RTN","PSOORED6",114,0)
 .K PSORXED("CONJUNCTION",(HENT+1))
"RTN","PSOORED6",115,0)
 .I $D(PSORXED("DOSE",(HENT+2))) D
"RTN","PSOORED6",116,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED6",117,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED6",118,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED6",119,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED6",120,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED6",121,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED6",122,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED6",123,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED6",124,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED6",125,0)
 ..S PSORXED("VERB",(HENT+1))=$G(PSORXED("VERB",(HENT+2)))
"RTN","PSOORED6",126,0)
 ..K PSORXED("DOSE",(HENT+2)),PSORXED("ODOSE",(HENT+2)),PSORXED("DOSE ORDERED",(HENT+2))
"RTN","PSOORED6",127,0)
 ..K PSORXED("UNITS",(HENT+2)),PSORXED("NOUN",(HENT+2)),PSORXED("DURATION",(HENT+2)),PSORXED("ROUTE",(HENT+2)),PSORXED("SCHEDULE",(HENT+2)),PSORXED("VERB",(HENT+2))
"RTN","PSOORED6",128,0)
 .S HENT=HENT+1
"RTN","PSOORED6",129,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S SENT=$G(SENT)+1
"RTN","PSOORED6",130,0)
 Q
"RTN","PSOORED6",131,0)
M1 D M1^PSOOREDX
"RTN","PSOORED6",132,0)
 Q
"RTN","PSOORED6",133,0)
M2 D M2^PSOOREDX
"RTN","PSOORED6",134,0)
 Q
"RTN","PSORENW1")
0^3^B55639962
"RTN","PSORENW1",1,0)
PSORENW1 ;BIR/DSD - Renew Main Driver Continuation ;03/29/93
"RTN","PSORENW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,37,51,46,71,117,157,143,219**;DEC 1997
"RTN","PSORENW1",3,0)
 ;External reference ^VA(200 supported by DBIA 10060
"RTN","PSORENW1",4,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSORENW1",5,0)
 ;
"RTN","PSORENW1",6,0)
START ;
"RTN","PSORENW1",7,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN")),SIGOK=+$P($G(^("SIG")),"^",2)
"RTN","PSORENW1",8,0)
 S PSOIBOLD=$G(PSORENW("OIRXN"))
"RTN","PSORENW1",9,0)
 K PSOSCP,PSOANSQ("SC>50") D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) S:PSOSCP=""&($P(VAEL(3),U,1)=1) PSOSCP=0 K VAEL
"RTN","PSORENW1",10,0)
 D SETIB
"RTN","PSORENW1",11,0)
 S PSORENW("PROVIDER")=$P(PSORENW("RX0"),"^",4)
"RTN","PSORENW1",12,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW1",13,0)
 S PSORENW("CLINIC")=$P(PSORENW("RX0"),"^",5),PSORENW("COPIES")=$P(PSORENW("RX0"),"^",18)
"RTN","PSORENW1",14,0)
 I $G(PSOFDR),$P($G(OR0),"^",13) S PSORENW("CLINIC")=$P($G(OR0),"^",13)
"RTN","PSORENW1",15,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",16,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^")
"RTN","PSORENW1",17,0)
 S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW1",18,0)
 S (PSODFN,PSORENW("PSODFN"))=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW1",19,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",20,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6)
"RTN","PSORENW1",21,0)
 S PSORENW("INS")=$S($G(PSORENW("INS"))]"":PSORENW("INS"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW1",22,0)
 S D=0 F  S D=$O(^PSRX(PSORENW("OIRXN"),"INS1",D)) Q:'D  S PSORENW("SIG",D)=^PSRX(PSORENW("OIRXN"),"INS1",D,0)
"RTN","PSORENW1",23,0)
 I '$O(PSORENW("SIG",0)),$G(PSORENW("INS"))]"" S PSORENW("SIG",1)=PSORENW("INS")
"RTN","PSORENW1",24,0)
 G:$G(PSORENW("ENT")) FDR
"RTN","PSORENW1",25,0)
 I $G(PSORENW("ENT"))'>0,'$O(^PSRX(PSORENW("OIRXN"),6,0)) S PSORENW("ENT")=0 G FDR
"RTN","PSORENW1",26,0)
 F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW1",27,0)
 .S PSORENW("ENT")=$G(PSORENW("ENT"))+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW1",28,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW1",29,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW1",30,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW1",31,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",32,0)
 .K DOSE
"RTN","PSORENW1",33,0)
FDR I $G(PSOFDR) D
"RTN","PSORENW1",34,0)
 .F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",I)=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",35,0)
 .S $P(PSORENW("RX0"),"^",7)=$P(OR0,"^",10),$P(PSORENW("RX0"),"^",11)=$P(OR0,"^",17)
"RTN","PSORENW1",36,0)
 .S (PSORX("PROVIDER NAME"),PSORENW("PROVIDER NAME"))=$P(^VA(200,$P(OR0,"^",5),0),"^"),PSORENW("PROVIDER")=$P(OR0,"^",5)
"RTN","PSORENW1",37,0)
 .K PSORENW("COSIGNING PROVIDER")
"RTN","PSORENW1",38,0)
 .I $G(PSORENW("PROVIDER")),$P($G(^VA(200,PSORENW("PROVIDER"),"PS")),"^",7),$P($G(^("PS")),"^",8) S PSORENW("COSIGNING PROVIDER")=$P($G(^("PS")),"^",8)
"RTN","PSORENW1",39,0)
 .S (PSDY,PSORENW("DAYS SUPPLY"))=$P(PSORENW("RX0"),"^",8)
"RTN","PSORENW1",40,0)
 .S POERR=1,DREN=$P(PSORENW("RX0"),"^",6) D DRG^PSOORDRG K POERR S PSODIR("CS")=0
"RTN","PSORENW1",41,0)
 .F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S PSODIR("CS")=1
"RTN","PSORENW1",42,0)
 .I PSODIR("CS") S RFMX=$S(PSDY<60:5,PSDY'<60&(PSDY'>89):2,PSDY=90:1,1:0)
"RTN","PSORENW1",43,0)
 .E  S RFMX=$S(PSDY<60:11,PSDY'<60&(PSDY'>89):5,PSDY=90:3,1:0)
"RTN","PSORENW1",44,0)
 .S $P(PSORENW("RX0"),"^",9)=$S($P(OR0,"^",11)'>RFMX:$P(OR0,"^",11),1:RFMX),$P(OR0,"^",11)=$P(PSORENW("RX0"),"^",9)
"RTN","PSORENW1",45,0)
 .K RFMX,PSODIR("CS"),PSDY
"RTN","PSORENW1",46,0)
END Q
"RTN","PSORENW1",47,0)
STOP K PSEXDT,X,%DT S PSON52("QFLG")=0,DAYS=$S($G(PSORENW("DAYS SUPPLY")):PSORENW("DAYS SUPPLY"),1:$P(PSORENW("RX0"),"^",8))
"RTN","PSORENW1",48,0)
 S DEA("CS")=0 K DIR,DIC
"RTN","PSORENW1",49,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S DEA("CS")=1
"RTN","PSORENW1",50,0)
 S X1=$S($G(PSORENW("ISSUE DATE")):$G(PSORENW("ISSUE DATE")),1:DT),X2=DAYS*($P(PSORENW("RX0"),"^",9)+1)\1
"RTN","PSORENW1",51,0)
 S X2=$S(DAYS=X2&('DEA("CS")):X2,DEA("CS"):184,1:366) D C^%DTC
"RTN","PSORENW1",52,0)
 I PSORENW("FILL DATE")>$P(X,".") S PSEXDT=1_"^"_$P(X,".")
"RTN","PSORENW1",53,0)
 K X1,X2,X,%DT
"RTN","PSORENW1",54,0)
 Q
"RTN","PSORENW1",55,0)
OERR ;renewal finish from oe/rr
"RTN","PSORENW1",56,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN"))
"RTN","PSORENW1",57,0)
 S $P(PSORENW("RX0"),"^",4)=$P(OR0,"^",5)
"RTN","PSORENW1",58,0)
 S PSORENW("PROVIDER")=$P(OR0,"^",5)
"RTN","PSORENW1",59,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW1",60,0)
 S $P(PSORENW("RX0"),"^",5)=$P(OR0,"^",13)
"RTN","PSORENW1",61,0)
 S PSORENW("CLINIC")=$P(OR0,"^",13)
"RTN","PSORENW1",62,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")_"."_$S($P(OR0,"^",17)="C":" Administered in Clinic.",1:"")
"RTN","PSORENW1",63,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^"),SIGOK=$P(^("SIG"),"^",2) I SIGOK D
"RTN","PSORENW1",64,0)
 .F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORENW("OIRXN"),"SIG1",I,0)
"RTN","PSORENW1",65,0)
 S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW1",66,0)
 S PSORENW("PSODFN")=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW1",67,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",68,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6),$P(PSORENW("RX0"),"^",11)=$P(OR0,"^",17)
"RTN","PSORENW1",69,0)
 S PSORENW("INS")=$S($G(PSORENW("INS"))]"":PSORENW("INS"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW1",70,0)
 Q:$G(PSORENW("ENT"))>0
"RTN","PSORENW1",71,0)
 F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW1",72,0)
 .S PSORENW("ENT")=PSORENW("ENT")+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW1",73,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW1",74,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW1",75,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW1",76,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",77,0)
 .K DOSE
"RTN","PSORENW1",78,0)
 Q
"RTN","PSORENW1",79,0)
SETIB ;Set defaults on Renewals with Copay information
"RTN","PSORENW1",80,0)
 ;If answer is in Pending File, use that, else look in Prescription file
"RTN","PSORENW1",81,0)
 I '$G(PSOIBOLD) Q
"RTN","PSORENW1",82,0)
 I $G(PSOFDR),$G(ORD) D SETIBP Q
"RTN","PSORENW1",83,0)
 ;I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",84,0)
 I $G(PSORX(PSOIBOLD,"SC"))'=0,$G(PSORX(PSOIBOLD,"SC"))'=1 S PSORX(PSOIBOLD,"SC")=$S($P($G(^PSRX(PSOIBOLD,"IBQ")),"^")'="":$P($G(^("IBQ")),"^"),$P($G(^PSRX(PSOIBOLD,"IB")),"^"):0,1:"")
"RTN","PSORENW1",85,0)
 I $G(PSORX(PSOIBOLD,"SC"))="" K PSORX(PSOIBOLD,"SC")
"RTN","PSORENW1",86,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",87,0)
 I $G(PSORX(PSOIBOLD,"MST"))'=0,$G(PSORX(PSOIBOLD,"MST"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",2)'="" S PSORX(PSOIBOLD,"MST")=$P($G(^("IBQ")),"^",2)
"RTN","PSORENW1",88,0)
 I $G(PSORX(PSOIBOLD,"VEH"))'=0,$G(PSORX(PSOIBOLD,"VEH"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",3)'="" S PSORX(PSOIBOLD,"VEH")=$P($G(^("IBQ")),"^",3)
"RTN","PSORENW1",89,0)
 I $G(PSORX(PSOIBOLD,"RAD"))'=0,$G(PSORX(PSOIBOLD,"RAD"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",4)'="" S PSORX(PSOIBOLD,"RAD")=$P($G(^("IBQ")),"^",4)
"RTN","PSORENW1",90,0)
 I $G(PSORX(PSOIBOLD,"PGW"))'=0,$G(PSORX(PSOIBOLD,"PGW"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",5)'="" S PSORX(PSOIBOLD,"PGW")=$P($G(^("IBQ")),"^",5)
"RTN","PSORENW1",91,0)
 I $G(PSORX(PSOIBOLD,"HNC"))'=0,$G(PSORX(PSOIBOLD,"HNC"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",6)'="" S PSORX(PSOIBOLD,"HNC")=$P($G(^("IBQ")),"^",6)
"RTN","PSORENW1",92,0)
 I $G(PSORX(PSOIBOLD,"CV"))'=0,$G(PSORX(PSOIBOLD,"CV"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",7)'="" S PSORX(PSOIBOLD,"CV")=$P($G(^("IBQ")),"^",7)
"RTN","PSORENW1",93,0)
 ;
"RTN","PSORENW1",94,0)
ICD I $D(^PSRX(PSORENW("OIRXN"),"ICD",0)) D
"RTN","PSORENW1",95,0)
 . N JJ,ICD,II,FLD,RXN S RXN=PSOIBOLD
"RTN","PSORENW1",96,0)
 . S II=0 F  S II=$O(^PSRX(PSORENW("OIRXN"),"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSORENW1",97,0)
 .. S ICD="",ICD=^PSRX(PSORENW("OIRXN"),"ICD",II,0)
"RTN","PSORENW1",98,0)
 .. S JJ="" F JJ=1:1:8 S FLD=$P(ICD,U,JJ) D ICD^PSONEWF
"RTN","PSORENW1",99,0)
 Q
"RTN","PSORENW1",100,0)
SETIBP ;
"RTN","PSORENW1",101,0)
 I $P($G(^PS(52.41,ORD,0)),"^",16)="SC"!($P($G(^(0)),"^",16)="NSC") S PSORX(PSOIBOLD,"SC")=$S($P($G(^(0)),"^",16)="SC":1,1:0)
"RTN","PSORENW1",102,0)
 I $G(PSORX(PSOIBOLD,"SC"))="" K PSORX(PSOIBOLD,"SC")
"RTN","PSORENW1",103,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",104,0)
 N PSOIBQFN S PSOIBQFN=$G(^PS(52.41,ORD,"IBQ"))
"RTN","PSORENW1",105,0)
 I $P(PSOIBQFN,"^",1)=0!($P(PSOIBQFN,"^",1)=1) S PSORX(PSOIBOLD,"MST")=$P(PSOIBQFN,"^")
"RTN","PSORENW1",106,0)
 I $P(PSOIBQFN,"^",2)=0!($P(PSOIBQFN,"^",2)=1) S PSORX(PSOIBOLD,"VEH")=$P(PSOIBQFN,"^",2)
"RTN","PSORENW1",107,0)
 I $P(PSOIBQFN,"^",3)=0!($P(PSOIBQFN,"^",3)=1) S PSORX(PSOIBOLD,"RAD")=$P(PSOIBQFN,"^",3)
"RTN","PSORENW1",108,0)
 I $P(PSOIBQFN,"^",4)=0!($P(PSOIBQFN,"^",4)=1) S PSORX(PSOIBOLD,"PGW")=$P(PSOIBQFN,"^",4)
"RTN","PSORENW1",109,0)
 I $P(PSOIBQFN,"^",5)=0!($P(PSOIBQFN,"^",5)=1) S PSORX(PSOIBOLD,"HNC")=$P(PSOIBQFN,"^",5)
"RTN","PSORENW1",110,0)
 I $P(PSOIBQFN,"^",6)=0!($P(PSOIBQFN,"^",6)=1) S PSORX(PSOIBOLD,"CV")=$P(PSOIBQFN,"^",6)
"RTN","PSORENW1",111,0)
 ;
"RTN","PSORENW1",112,0)
ICD2 I $D(^PS(52.41,ORD,"ICD",0)) D
"RTN","PSORENW1",113,0)
 . N JJ,ICD,II,FLD,RXN S RXN=ORD
"RTN","PSORENW1",114,0)
 . S II=0 F  S II=$O(^PS(52.41,ORD,"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSORENW1",115,0)
 .. S ICD="",ICD=^PS(52.41,ORD,"ICD",II,0)
"RTN","PSORENW1",116,0)
 .. I $G(PSOSCP)>49&(II=1) S PSORX(PSOIBOLD,"SC>50")=$P(ICD,"^",4)
"RTN","PSORENW1",117,0)
 .. S JJ="" F JJ=1:1:8 S FLD=$P(ICD,U,JJ) D ICD^PSONEWF
"RTN","PSORENW1",118,0)
 ;
"RTN","PSORENW1",119,0)
 K PSOIBQFN
"RTN","PSORENW1",120,0)
 Q
"RTN","PSORENW1",121,0)
KLIB ;Kill renewal IB array
"RTN","PSORENW1",122,0)
 I '$G(PSOIBOLD) Q
"RTN","PSORENW1",123,0)
 K PSORX(PSOIBOLD,"SC"),PSORX(PSOIBOLD,"MST"),PSORX(PSOIBOLD,"VEH"),PSORX(PSOIBOLD,"RAD"),PSORX(PSOIBOLD,"PGW"),PSORX(PSOIBOLD,"HNC"),PSORX(PSOIBOLD,"CV")
"RTN","PSORENW1",124,0)
 K PSOIBOLD
"RTN","PSORENW1",125,0)
 Q
"RTN","PSORN52")
0^4^B69065416
"RTN","PSORN52",1,0)
PSORN52 ;BIR/DSD - files renewal entries in prescription file ;08/09/93
"RTN","PSORN52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,11,27,37,46,79,71,100,117,157,143,219**;DEC 1997
"RTN","PSORN52",3,0)
 ;Ext ref to ^PS(55 sup by DBIA 2228
"RTN","PSORN52",4,0)
 ;Ext ref to PSOUL^PSSLOCK sup by DBIA 2789
"RTN","PSORN52",5,0)
 ;Ext ref to ^VA(200 sup by DBIA 10060
"RTN","PSORN52",6,0)
EN(PSOX) ;EP
"RTN","PSORN52",7,0)
START ;
"RTN","PSORN52",8,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Mon
"RTN","PSORN52",9,0)
 N PSOIBHLD,PSOSCOTH,PSOSCOTX S (PSOSCOTH,PSOSCOTX)=0 S PSOIBHLD="" I $G(PSOFDR),$G(ORD) D
"RTN","PSORN52",10,0)
 .S PSOIBHLD=$S($P($G(^PS(52.41,ORD,0)),"^",16)="SC":1,$P($G(^(0)),"^",16)="NSC":0,1:"")
"RTN","PSORN52",11,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",12,0)
 .N PSOIBHLX S PSOIBHLX=$G(^PS(52.41,ORD,"IBQ"))
"RTN","PSORN52",13,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^")=1:1,$P(PSOIBHLX,"^")=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",2)=1:1,$P(PSOIBHLX,"^",2)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",3)=1:1,$P(PSOIBHLX,"^",3)=0:0,1:"")
"RTN","PSORN52",14,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^",4)=1:1,$P(PSOIBHLX,"^",4)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",5)=1:1,$P(PSOIBHLX,"^",5)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",6)=1:1,$P(PSOIBHLX,"^",6)=0:0,1:"")
"RTN","PSORN52",15,0)
 .I $P(PSOIBHLX,"^")=1!($P(PSOIBHLX,"^",2)=1)!($P(PSOIBHLX,"^",3)=1)!($P(PSOIBHLX,"^",4)=1)!($P(PSOIBHLX,"^",5)=1) S PSOSCOTH=1
"RTN","PSORN52",16,0)
 I $G(PSOSCOTH)!($G(PSORX("SC"))="SC")!($G(PSORX("SC"))="NSC") S PSOSCOTX=1
"RTN","PSORN52",17,0)
 K PSOSCP D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSORN52",18,0)
 I $G(PSOFDR),$G(ORD) I $D(^PS(52.41,ORD,"ICD")) S FILE=52.41 D GET^PSORN52D
"RTN","PSORN52",19,0)
 ;Set ans to renew from Rx, only if no ans from Pend file
"RTN","PSORN52",20,0)
 I $G(PSORENW("OIRXN")) D
"RTN","PSORN52",21,0)
 .N PSOLDIBQ S PSOLDIBQ=$G(^PSRX(PSORENW("OIRXN"),"IBQ"))
"RTN","PSORN52",22,0)
 .I $P(PSOIBHLD,"^")="" D
"RTN","PSORN52",23,0)
 ..I $P($G(^PSRX(PSORENW("OIRXN"),"IB")),"^")=2 S $P(PSOIBHLD,"^")=0
"RTN","PSORN52",24,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",25,0)
 .I PSOLDIBQ="" Q
"RTN","PSORN52",26,0)
 .D IBHLD^PSORN52A
"RTN","PSORN52",27,0)
 D INIT G:PSORN52("QFLG") END D DATA,FILE,PS55,DIK
"RTN","PSORN52",28,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Mon
"RTN","PSORN52",29,0)
 D FINISH
"RTN","PSORN52",30,0)
 K PSOANSQ,PSOANSQD,PSONEWFF
"RTN","PSORN52",31,0)
 I $G(PSOIBHLD)'="" D
"RTN","PSORN52",32,0)
 .;Set answers based on Pend Renew, prior to Phar call
"RTN","PSORN52",33,0)
 .Q:'$G(PSOX("IRXN"))
"RTN","PSORN52",34,0)
 .I $P(PSOIBHLD,"^")=1!($P(PSOIBHLD,"^")=0) S PSOANSQ("SC")=$P(PSOIBHLD,"^")
"RTN","PSORN52",35,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",36,0)
 .I $P(PSOIBHLD,"^",2)=1!($P(PSOIBHLD,"^",2)=0) S PSOANSQ(PSOX("IRXN"),"MST")=$P(PSOIBHLD,"^",2)
"RTN","PSORN52",37,0)
 .I $P(PSOIBHLD,"^",3)=1!($P(PSOIBHLD,"^",3)=0) S PSOANSQ(PSOX("IRXN"),"VEH")=$P(PSOIBHLD,"^",3)
"RTN","PSORN52",38,0)
 .I $P(PSOIBHLD,"^",4)=1!($P(PSOIBHLD,"^",4)=0) S PSOANSQ(PSOX("IRXN"),"RAD")=$P(PSOIBHLD,"^",4)
"RTN","PSORN52",39,0)
 .I $P(PSOIBHLD,"^",5)=1!($P(PSOIBHLD,"^",5)=0) S PSOANSQ(PSOX("IRXN"),"PGW")=$P(PSOIBHLD,"^",5)
"RTN","PSORN52",40,0)
 .I $P(PSOIBHLD,"^",6)=1!($P(PSOIBHLD,"^",6)=0) S PSOANSQ(PSOX("IRXN"),"HNC")=$P(PSOIBHLD,"^",6)
"RTN","PSORN52",41,0)
 .I $P(PSOIBHLD,"^",7)=1!($P(PSOIBHLD,"^",7)=0) S PSOANSQ(PSOX("IRXN"),"CV")=$P(PSOIBHLD,"^",7)
"RTN","PSORN52",42,0)
 K PSOIBHLD
"RTN","PSORN52",43,0)
 I '$G(PSOFDR) I $G(PSORENW("OIRXN")) S FILE=52 D GET^PSORN52D
"RTN","PSORN52",44,0)
 S PSONEW("NEWCOPAY")="" I PSOSCP<50 I '$P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7),$G(DUZ("AG"))="V" S PSOFLAG=0 D COPAY^PSOCPB
"RTN","PSORN52",45,0)
 I PSOSCP>49!($P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)=1) S PSOFLAG=0 D SC^PSOMLLD2
"RTN","PSORN52",46,0)
 I $$DT^PSOMLLDT D
"RTN","PSORN52",47,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D MESS D CV^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"CV")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",48,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D MESS D VEH^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"VEH")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",49,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D MESS D RAD^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"RAD")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",50,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D MESS D PGW^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"PGW")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",51,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D MESS D MST^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"MST")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",52,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D MESS D HNC^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"HNC")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",53,0)
 K PSOSCOTH,PSOSCOTX
"RTN","PSORN52",54,0)
 I $G(PSONEW("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=PSONEW("NEWCOPAY")
"RTN","PSORN52",55,0)
 D ACP^PSOUTIL
"RTN","PSORN52",56,0)
 N PSOSCFLD S PSOSCFLD=$S(PSOSCP'="":$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ(PSOX("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"RAD"))
"RTN","PSORN52",57,0)
 S PSOSCFLD=PSOSCFLD_"^"_$G(PSOANSQ(PSOX("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"CV"))
"RTN","PSORN52",58,0)
 I PSOSCP<50&($TR(PSOSCFLD,"^")'="") S ^PSRX(PSOX("IRXN"),"IBQ")=PSOSCFLD K PSOSCFLD
"RTN","PSORN52",59,0)
 D FILE2^PSORN52D
"RTN","PSORN52",60,0)
 K PSONEW("NEWCOPAY"),PSOANSQ
"RTN","PSORN52",61,0)
END D EOJ
"RTN","PSORN52",62,0)
 Q
"RTN","PSORN52",63,0)
INIT S PSORN52("QFLG")=0 S:'$D(PSOX("DAYS SUPPLY")) PSOX("DAYS SUPPLY")=$P(PSOX("RX0"),"^",8)
"RTN","PSORN52",64,0)
 S:'$D(PSOX("# OF REFILLS")) PSOX("# OF REFILLS")=$P(PSOX("RX0"),"^",9) S:'$D(PSOX("ISSUE DATE")) PSOX("ISSUE DATE")=DT
"RTN","PSORN52",65,0)
 D INIT^PSON52 K PSON52
"RTN","PSORN52",66,0)
 Q
"RTN","PSORN52",67,0)
DATA ;
"RTN","PSORN52",68,0)
 S PSOX("NRX0")=PSORENW("RX0"),PSOX("NRX2")=PSORENW("RX2"),PSOX("NRX3")=PSORENW("RX3"),$P(PSOX("NRX3"),"^",5)=""
"RTN","PSORN52",69,0)
 S $P(PSOX("NRX0"),"^")=PSOX("NRX #") S:$G(PSOX("PROVIDER"))]"" $P(PSOX("NRX0"),"^",4)=PSOX("PROVIDER")
"RTN","PSORN52",70,0)
 I $G(PSORNSPD),$G(PSOX("PATIENT STATUS")),$G(PSOX("PATIENT STATUS"))?.N S $P(PSOX("NRX0"),"^",3)=PSOX("PATIENT STATUS")
"RTN","PSORN52",71,0)
 S:$G(PSOX("COSIGNING PROVIDER"))]"" $P(PSOX("NRX3"),"^",3)=PSOX("COSIGNING PROVIDER")
"RTN","PSORN52",72,0)
 S $P(PSOX("NRX0"),"^",5)=PSOX("CLINIC"),$P(PSOX("NRX0"),"^",9)=PSOX("# OF REFILLS")
"RTN","PSORN52",73,0)
 I $G(PSOX("DAYS SUPPLY")) S $P(PSOX("NRX0"),"^",8)=PSOX("DAYS SUPPLY")
"RTN","PSORN52",74,0)
 I $G(PSOX("QTY")) S $P(PSOX("NRX0"),"^",7)=PSOX("QTY")
"RTN","PSORN52",75,0)
 S $P(PSOX("NRX0"),"^",11)=$S(PSOX("FILL DATE")>DT&($P(PSOPAR,"^",6)):"M",$D(PSOX("MAIL/WINDOW")):PSOX("MAIL/WINDOW"),1:$P(PSOX("NRX0"),"^",11))
"RTN","PSORN52",76,0)
 S $P(PSOX("NRX0"),"^",13)=PSOX("ISSUE DATE"),$P(PSOX("STA"),"^")=PSOX("STATUS"),$P(PSOX("NRX0"),"^",16)=$S($G(PSOX("CLERK CODE"))]"":PSOX("CLERK CODE"),1:DUZ)
"RTN","PSORN52",77,0)
 S $P(PSOX("NRX0"),"^",17)=$G(PSODRUG("COST"))
"RTN","PSORN52",78,0)
 S $P(PSOX("NRX2"),"^")=PSOX("LOGIN DATE"),$P(PSOX("NRX2"),"^",2)=PSOX("FILL DATE"),$P(PSOX("NRX2"),"^",3)="",$P(PSOX("NRX2"),"^",5)=PSOX("DISPENSED DATE")
"RTN","PSORN52",79,0)
 S $P(PSOX("NRX2"),"^",6)=PSOX("STOP DATE"),$P(PSOX("NRX2"),"^",7)=$S($G(PSOX("NDC"))]"":PSOX("NDC"),1:$G(PSODRUG("NDC")))
"RTN","PSORN52",80,0)
 S $P(PSOX("NRX2"),"^",8)=$S($G(PSOX("MANUFACTURER"))]"":PSOX("MANUFACTURER"),1:$G(PSODRUG("MANUFACTURER")))
"RTN","PSORN52",81,0)
 S $P(PSOX("NRX2"),"^",9)=+PSOSITE,$P(PSOX("NRX2"),"^",10)=""
"RTN","PSORN52",82,0)
 S $P(PSOX("NRX2"),"^",11)=$S($G(PSOX("EXPIRATION DATE"))]"":PSOX("EXPIRATION DATE"),1:$G(PSODRUG("EXPIRATION DATE")))
"RTN","PSORN52",83,0)
 S:$G(PSOX("GENERIC PROVIDER"))]"" $P(PSOX("NRX2"),"^",12)=PSOX("GENERIC PROVIDER")
"RTN","PSORN52",84,0)
 S $P(PSOX("NRX2"),"^",13)="",$P(PSOX("NRX2"),"^",15)="",$P(PSOX("NRX3"),"^",4)=$P(PSOX("NRX3"),"^")
"RTN","PSORN52",85,0)
 ;S PSOX("LAST DISPENSED DATE")=$P(PSOX("NRX3"),"^")
"RTN","PSORN52",86,0)
 S PSOX("LAST DISPENSED DATE")=PSOX("DISPENSED DATE")
"RTN","PSORN52",87,0)
 S $P(PSOX("NRX3"),"^")=PSOX("LAST DISPENSED DATE")
"RTN","PSORN52",88,0)
 S:$G(PSOX("NEXT POSSIBLE REFILL"))]"" $P(PSOX("NRX3"),"^",2)=PSOX("NEXT POSSIBLE REFILL")
"RTN","PSORN52",89,0)
 S:'$P(^VA(200,$P(PSOX("NRX0"),"^",4),"PS"),"^",7) $P(PSOX("NRX3"),"^",3)=""
"RTN","PSORN52",90,0)
 S:$G(PSOX("REMARKS"))']"" PSOX("REMARKS")="RENEWED FROM RX # "_$P(PSOX("RX0"),"^")
"RTN","PSORN52",91,0)
 S $P(PSOX("NRX3"),"^",7)=PSOX("REMARKS"),$P(PSOX("NRX3"),"^",8)=""
"RTN","PSORN52",92,0)
 Q
"RTN","PSORN52",93,0)
FILE I $G(PSOFXRNX) S PSOFXRN=1
"RTN","PSORN52",94,0)
 D ^PSORN52C,FILE^PSORN52D
"RTN","PSORN52",95,0)
 I $G(^PSRX(PSOX("OIRXN"),"INSS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=^PSRX(PSOX("OIRXN"),"INSS") K PSOX1 Q
"RTN","PSORN52",96,0)
 I $G(PSOX("SINS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=PSOX("SINS")
"RTN","PSORN52",97,0)
 K PSOX1
"RTN","PSORN52",98,0)
 Q
"RTN","PSORN52",99,0)
PS55 L +^PS(55,PSODFN,"P"):0 S:'$D(^PS(55,PSODFN,"P",0)) ^(0)="^55.03PA^^"
"RTN","PSORN52",100,0)
 F PSOX1=$P(^PS(55,PSODFN,"P",0),"^",3):1 Q:'$D(^PS(55,PSODFN,"P",PSOX1))
"RTN","PSORN52",101,0)
 S PSOX("55 IEN")=PSOX1
"RTN","PSORN52",102,0)
 S ^PS(55,PSODFN,"P",PSOX1,0)=PSOX("IRXN"),$P(^PS(55,PSODFN,"P",0),"^",3,4)=PSOX1_"^"_($P(^PS(55,PSODFN,"P",0),"^",4)+1)
"RTN","PSORN52",103,0)
 S ^PS(55,PSODFN,"P","A",PSOX("STOP DATE"),PSOX("IRXN"))=""
"RTN","PSORN52",104,0)
PS55X L -^PS(55,PSODFN,"P")
"RTN","PSORN52",105,0)
 K PSOX1
"RTN","PSORN52",106,0)
 Q
"RTN","PSORN52",107,0)
DIK I $G(OR0) D FULL^VALM1,COUN^PSONEW S PSONOOR=""
"RTN","PSORN52",108,0)
 I $D(^XUSEC("PSORPH",DUZ)) S DA=PSOX("IRXN"),DIE=52,DR="41////"_PSOCOU_";S:'X Y=""@1"";42////"_PSOCOUU_";@1" D ^DIE K DIE,DR
"RTN","PSORN52",109,0)
DIKX K DIK,DA S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSORN52",110,0)
 S DA=PSOX("IRXN") D ORC^PSORN52C
"RTN","PSORN52",111,0)
 Q
"RTN","PSORN52",112,0)
FINISH G:PSOX("STATUS")=4 FINISHP
"RTN","PSORN52",113,0)
 I $D(PSORX("VERIFY")) D  G FINISHX
"RTN","PSORN52",114,0)
 .K DIC,DLAYGO,DINUM,DIADD,X,DD,DO S DIC="^PS(52.4,",DLAYGO=52.4,DINUM=PSOX("IRXN"),DIC(0)="ML"
"RTN","PSORN52",115,0)
 .S X=PSOX("IRXN") D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM,X
"RTN","PSORN52",116,0)
 .S ^PS(52.4,PSOX("IRXN"),0)=PSOX("IRXN")_"^"_$P(PSOX("NRX0"),"^",2)_"^"_DUZ_"^"_$G(PSOX("OIRXN"))_"^"_$E(PSOX("LOGIN DATE"),1,7)_"^"_PSOX("IRXN")_"^"_PSOX("STOP DATE")
"RTN","PSORN52",117,0)
 .K DIK,DA S DIK="^PS(52.4,",DA=PSOX("IRXN") D IX^DIK K DIK,DA
"RTN","PSORN52",118,0)
 ;
"RTN","PSORN52",119,0)
 I $G(PSOX("QS"))="S",$G(PSOBARCD) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",120,0)
 ;
"RTN","PSORN52",121,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",122,0)
 ;
"RTN","PSORN52",123,0)
 I $G(PSOX("QS"))="Q",$G(PSOBARCD) D  G FINISHX
"RTN","PSORN52",124,0)
 . N PSOFROM S PSOFROM="BATCH" I $G(PPL),$L(PPL_PSOX("IRXN")_",")>240 D TRI^PSOBBC D Q^PSORXL K PPL,RXFL
"RTN","PSORN52",125,0)
 .S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",126,0)
 . I $G(PPL) S PPL=PPL_PSOX("IRXN")_","
"RTN","PSORN52",127,0)
 . E  S PPL=PSOX("IRXN")_","
"RTN","PSORN52",128,0)
 . Q
"RTN","PSORN52",129,0)
FINISHP I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSORN52",130,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORN52",131,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSORN52",132,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSORN52",133,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",134,0)
FINISHX ;
"RTN","PSORN52",135,0)
 ;call to build bingo board Rx array
"RTN","PSORN52",136,0)
 S:'$G(PSORX("MAIL/WINDOW")) PSORX("MAIL/WINDOW")=$P(PSORENW("NRX0"),"^",11) I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSORN52",137,0)
 K PSOX1,PSOX2
"RTN","PSORN52",138,0)
 Q
"RTN","PSORN52",139,0)
EOJ ;
"RTN","PSORN52",140,0)
 L -^PSRX("B",PSOX("IRXN")) K PSORN52,PSOX("INS"),PSORENW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT,PSOIBHLD,PSOX("SINS"),PSORENW("SINS"),PSORXED("SINS"),FILE
"RTN","PSORN52",141,0)
 D PSOUL^PSSLOCK(PSOX("IRXN")) D PSOUL^PSSLOCK(PSOX("OIRXN"))
"RTN","PSORN52",142,0)
 Q
"RTN","PSORN52",143,0)
MESS ;
"RTN","PSORN52",144,0)
 I $G(PSOSCOTX)=1&(PSOSCP<50) W:$G(PSODRUG("DEA"))'["S"&($G(PSODRUG("DEA"))'["I") !!,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! S PSOSCOTX=2
"RTN","PSORN52",145,0)
 Q
"RTN","PSORN52D")
0^5^B45252333
"RTN","PSORN52D",1,0)
PSORN52D ;BIR/LE - files new and renewal entries con't ;02/27/04
"RTN","PSORN52D",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143,219**;DEC 1997
"RTN","PSORN52D",3,0)
 Q
"RTN","PSORN52D",4,0)
GET ;must have FILE and PSORENW variables to pull default data for ICD and SC/EI for SC>50% Rx's from file 52
"RTN","PSORN52D",5,0)
 N ARRAY,ERR,SUBF,RXN,II,JJ,ORXN,SUBFLD,PENDSC
"RTN","PSORN52D",6,0)
 I FILE=52 S SUBF=52.052311,SUBFLD=52311,RXN=PSORENW("IRXN"),(SRXN,ORXN)=PSORENW("OIRXN")
"RTN","PSORN52D",7,0)
 I FILE=52.41 S SUBF=52.41311,SUBFLD=311,(SRXN,RXN)=ORD,ORXN=PSORENW("OIRXN")
"RTN","PSORN52D",8,0)
 D GETS^DIQ(FILE,SRXN,SUBFLD_"*","I","ARRAY","ERR")
"RTN","PSORN52D",9,0)
 Q:$D(ERR)
"RTN","PSORN52D",10,0)
 K PSORX("ICD"),PSOX("ICD")
"RTN","PSORN52D",11,0)
 I FILE=52.41 S PENDSC=$$GET1^DIQ(52.41,ORD,"17"),PENDSC=$S(PENDSC="SC":1,PENDSC="NSC":0,1:"")
"RTN","PSORN52D",12,0)
 F II=1:1:8 Q:'$D(ARRAY(SUBF,(II_","_SRXN_",")))  D
"RTN","PSORN52D",13,0)
 . S PSORX("ICD",II)=ARRAY(SUBF,(II_","_SRXN_","),.01,"I") S:FILE=52.41 PSONEW("ICD",II)=PSORX("ICD",II)
"RTN","PSORN52D",14,0)
 .; I '$D(PSOSCP2) Q:PSOSCP<50
"RTN","PSORN52D",15,0)
 . F JJ=1:1:7 D
"RTN","PSORN52D",16,0)
 .. I JJ=1 S PSOANSQ(RXN,"VEH")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I"),PSORX(ORXN,"VEH")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",17,0)
 .. I JJ=2 S PSOANSQ(RXN,"RAD")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I"),PSORX(ORXN,"RAD")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",18,0)
 .. I JJ=3 D
"RTN","PSORN52D",19,0)
 ... I PSOSCP>49 D
"RTN","PSORN52D",20,0)
 .... I FILE=52.41 S PSOANSQ(RXN,"SC>50")=PENDSC,PSORX(ORXN,"SC>50")=PENDSC
"RTN","PSORN52D",21,0)
 .... S PSOANSQ(RXN,"SC>50")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I"),PSORX(ORXN,"SC>50")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",22,0)
 ... I PSOSCP<50 D
"RTN","PSORN52D",23,0)
 ...;. I $P($G(^PS(53,+$P(^PSRX($S(FILE=52:RXN,FILE=52.41:ORXN,1:RXN),0),"^",3),0)),"^",7)=1 D  Q
"RTN","PSORN52D",24,0)
 ...;.. S PSOANSQ(RXN,"SC>50")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I"),PSORX(ORXN,"SC>50")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I")
"RTN","PSORN52D",25,0)
 ... I FILE=52.41 S PSOANSQ(RXN,"SC")=PENDSC,PSORX(ORXN,"SC")=PENDSC Q
"RTN","PSORN52D",26,0)
 ... S PSOANSQ(RXN,"SC")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I"),PSORX(ORXN,"SC")=PSOANSQ(RXN,"SC"),PSOANSQ("SC")=PSOANSQ(RXN,"SC")
"RTN","PSORN52D",27,0)
 .. I JJ=4 S PSOANSQ(RXN,"PGW")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I"),PSORX(ORXN,"PGW")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",28,0)
 .. I JJ=5 S PSOANSQ(RXN,"MST")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I"),PSORX(ORXN,"MST")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",29,0)
 .. I JJ=6 S PSOANSQ(RXN,"HNC")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I"),PSORX(ORXN,"HNC")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",30,0)
 .. I JJ=7 S PSOANSQ(RXN,"CV")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I"),PSORX(ORXN,"CV")=ARRAY(SUBF,(II_","_SRXN_","),JJ,"I") Q
"RTN","PSORN52D",31,0)
 Q
"RTN","PSORN52D",32,0)
FILE ;
"RTN","PSORN52D",33,0)
 Q:'$D(^PSRX(PSOX("OIRXN"),"ICD"))
"RTN","PSORN52D",34,0)
 N II F II=1:1:8 Q:$G(^PSRX(PSOX("OIRXN"),"ICD",II,0))=""  D
"RTN","PSORN52D",35,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",II,0)=$G(^PSRX(PSOX("OIRXN"),"ICD",II,0))
"RTN","PSORN52D",36,0)
 . S:$P(^PSRX(PSOX("IRXN"),"ICD",II,0),"^",1)'="" ^PSRX(PSOX("IRXN"),"ICD","B",$P(^PSRX(PSOX("IRXN"),"ICD",II,0),"^",1),II)=""
"RTN","PSORN52D",37,0)
 I II>1 S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311^"_(II-1)_"^"_(II-1)
"RTN","PSORN52D",38,0)
 Q
"RTN","PSORN52D",39,0)
FILE2 ;file ICD's on existing node or build new nodes
"RTN","PSORN52D",40,0)
 ;note: variable PSOSCP2 is only available from CPRS Edit API and MISS
"RTN","PSORN52D",41,0)
 ;        sub-routine below.
"RTN","PSORN52D",42,0)
 N D,RXN
"RTN","PSORN52D",43,0)
 I '$G(PSONEW("PATIENT STATUS")) I $G(PSOX("IRXN")) S PSONEW("PATIENT STATUS")=$$GET1^DIQ(52,PSOX("IRXN")_",",3,"I")
"RTN","PSORN52D",44,0)
 I $G(PSOSCP2)!($G(PSOFDR)&($G(ORD))) D
"RTN","PSORN52D",45,0)
 .;if RX edited in CPRS delete all but what is sent from CPRS
"RTN","PSORN52D",46,0)
 . K ^PSRX(PSOX("IRXN"),"ICD")
"RTN","PSORN52D",47,0)
 I $O(PSORX("ICD","")) D
"RTN","PSORN52D",48,0)
 . F D=1:1:8 Q:'$D(PSORX("ICD",D))  S $P(^PSRX(PSOX("IRXN"),"ICD",D,0),U,1)=PSORX("ICD",D)
"RTN","PSORN52D",49,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311P^"_D-1_"^"_D-1
"RTN","PSORN52D",50,0)
 ;  Set SC/EI's
"RTN","PSORN52D",51,0)
 I $D(^PSRX(PSOX("IRXN"),"ICD",0)) D
"RTN","PSORN52D",52,0)
 . N II,TYPE,DATA
"RTN","PSORN52D",53,0)
 . S II=0 F  S II=$O(^PSRX(PSOX("IRXN"),"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSORN52D",54,0)
 .. S DATA="",DATA=^PSRX(PSOX("IRXN"),"ICD",II,0)
"RTN","PSORN52D",55,0)
 .. I PSOSCP<50&($D(PSOANSQ("SC"))) S:PSOANSQ("SC")'="" $P(DATA,U,4)=PSOANSQ("SC")
"RTN","PSORN52D",56,0)
 .. I PSOSCP<50&($D(PSOANSQ("SC>50"))) I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1 S:PSOANSQ("SC>50")'="" $P(DATA,U,4)=PSOANSQ("SC>50")
"RTN","PSORN52D",57,0)
 .. I PSOSCP=""&($D(PSOANSQ(PSOX("IRXN"),"SC>50"))) S:PSOANSQ(PSOX("IRXN"),"SC>50")'="" $P(DATA,U,4)=PSOANSQ(PSOX("IRXN"),"SC>50")
"RTN","PSORN52D",58,0)
 .. I PSOSCP>49&('$D(PSOANSQ(PSOX("IRXN"),"SC>50")))&($D(PSOANSQ("SC>50"))) S:PSOANSQ("SC>50")'="" $P(DATA,U,4)=PSOANSQ("SC>50")
"RTN","PSORN52D",59,0)
 .. S TYPE="" F  S TYPE=$O(PSOANSQ(PSOX("IRXN"),TYPE)) Q:TYPE=""  D
"RTN","PSORN52D",60,0)
 ... I TYPE="VEH"&($D(PSOANSQ(PSOX("IRXN"),"VEH"))) S:PSOANSQ(PSOX("IRXN"),"VEH")'="" $P(DATA,U,2)=PSOANSQ(PSOX("IRXN"),"VEH")
"RTN","PSORN52D",61,0)
 ... I TYPE="RAD"&($D(PSOANSQ(PSOX("IRXN"),"RAD"))) S:PSOANSQ(PSOX("IRXN"),"RAD")'="" $P(DATA,U,3)=PSOANSQ(PSOX("IRXN"),"RAD")
"RTN","PSORN52D",62,0)
 ... I TYPE="SC>50"&(PSOSCP>49) D
"RTN","PSORN52D",63,0)
 .... I $D(PSOANSQ(PSOX("IRXN"),"SC>50")) S:PSOANSQ(PSOX("IRXN"),"SC>50")'="" $P(DATA,U,4)=PSOANSQ(PSOX("IRXN"),"SC>50")
"RTN","PSORN52D",64,0)
 .... E  I $D(PSOANSQ("SC>50")) S:PSOANSQ("SC>50")'="" $P(DATA,U,4)=PSOANSQ("SC>50")
"RTN","PSORN52D",65,0)
 ... I PSOSCP<50&($D(PSOANSQ("SC"))) S:PSOANSQ("SC")'="" $P(DATA,U,4)=PSOANSQ("SC")
"RTN","PSORN52D",66,0)
 ... I TYPE="PGW"&($D(PSOANSQ(PSOX("IRXN"),"PGW"))) S:PSOANSQ(PSOX("IRXN"),"PGW")'="" $P(DATA,U,5)=PSOANSQ(PSOX("IRXN"),"PGW")
"RTN","PSORN52D",67,0)
 ... I TYPE="MST"&($D(PSOANSQ(PSOX("IRXN"),"MST"))) S:PSOANSQ(PSOX("IRXN"),"MST")'="" $P(DATA,U,6)=PSOANSQ(PSOX("IRXN"),"MST")
"RTN","PSORN52D",68,0)
 ... I TYPE="HNC"&($D(PSOANSQ(PSOX("IRXN"),"HNC"))) S:PSOANSQ(PSOX("IRXN"),"HNC")'="" $P(DATA,U,7)=PSOANSQ(PSOX("IRXN"),"HNC")
"RTN","PSORN52D",69,0)
 ... I TYPE="CV"&($D(PSOANSQ(PSOX("IRXN"),"CV"))) S:PSOANSQ(PSOX("IRXN"),"CV")'="" $P(DATA,U,8)=PSOANSQ(PSOX("IRXN"),"CV")
"RTN","PSORN52D",70,0)
 .. S ^PSRX(PSOX("IRXN"),"ICD",II,0)=DATA
"RTN","PSORN52D",71,0)
 .. S:$P(DATA,U,1)'="" ^PSRX(PSOX("IRXN"),"ICD","B",$P(DATA,U,1),II)=""
"RTN","PSORN52D",72,0)
 .. S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311P^"_II_"^"_II
"RTN","PSORN52D",73,0)
 .. I PSOSCP<50&(PSOSCP'="") D SIBQ
"RTN","PSORN52D",74,0)
 .. I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1&(PSOSCP'="") S ^PSRX(PSOX("IRXN"),"IBQ")="^^^^^^^" Q
"RTN","PSORN52D",75,0)
 E  D
"RTN","PSORN52D",76,0)
 . N DATA S DATA=$S($D(PSORX("ICD",1)):PSORX("ICD",1),1:"")_"^"_$G(PSOANSQ(PSORENW("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSORENW("IRXN"),"RAD"))_"^"_$S(PSOSCP<50:$G(PSOANSQ("SC")),PSOSCP>49:$G(PSOANSQ("SC>50")),1:"")
"RTN","PSORN52D",77,0)
 . S DATA=DATA_"^"_$G(PSOANSQ(PSORENW("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSORENW("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSORENW("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSORENW("IRXN"),"CV"))
"RTN","PSORN52D",78,0)
 . I PSOSCP<50&($D(PSOANSQ("SC>50"))) I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1 S $P(DATA,U,4)=PSOANSQ("SC>50")
"RTN","PSORN52D",79,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",1,0)=DATA S:$P(DATA,"^",1)'="" ^PSRX(PSOX("IRXN"),"ICD","B",$P(DATA,"^",1),1)=""
"RTN","PSORN52D",80,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311P^1^1"
"RTN","PSORN52D",81,0)
 . ; set IBQ NODE
"RTN","PSORN52D",82,0)
 . I PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1)&(PSOSCP'="") S ^PSRX(PSOX("IRXN"),"IBQ")="^^^^^^^" Q
"RTN","PSORN52D",83,0)
 . I PSOSCP<50&(PSOSCP'="") D SIBQ
"RTN","PSORN52D",84,0)
 K PSORX("ICD")
"RTN","PSORN52D",85,0)
 Q
"RTN","PSORN52D",86,0)
 ;
"RTN","PSORN52D",87,0)
SIBQ ;SET IBQ NODE
"RTN","PSORN52D",88,0)
 N DATA1 S DATA1=$G(PSOANSQ("SC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"RAD"))
"RTN","PSORN52D",89,0)
 S DATA1=DATA1_"^"_$G(PSOANSQ(PSOX("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"CV"))
"RTN","PSORN52D",90,0)
 S ^PSRX(PSOX("IRXN"),"IBQ")=DATA1
"RTN","PSORN52D",91,0)
 Q
"RTN","PSORN52D",92,0)
 ;
"RTN","PSORN52D",93,0)
RESET ;called from reset copay status PSOCPC
"RTN","PSORN52D",94,0)
 ;Must be available at this point:  PSODA, PSOIBQ=SC^MST^AO^IR^EC^HNC^CV
"RTN","PSORN52D",95,0)
 Q:'$D(PSODA)!('$D(PSOIBQ))
"RTN","PSORN52D",96,0)
 Q:'$D(^PSRX(PSODA))
"RTN","PSORN52D",97,0)
 Q:'$D(^PSRX(PSODA,"ICD"))  ;if old Rx and no ICD's defined; don't set
"RTN","PSORN52D",98,0)
 N PSOX,PSOANSQ,PSOIND,PSOTYP,PSOSCP
"RTN","PSORN52D",99,0)
 D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSORN52D",100,0)
 S PSOX("IRXN")=PSODA
"RTN","PSORN52D",101,0)
 F PSOTYP=1:1:7 S PSOIND=$P(PSOIBQ,"^",PSOTYP) D
"RTN","PSORN52D",102,0)
 . I PSOTYP=1&(PSOSCP<50) S PSOANSQ(PSOX("IRXN"),"SC")=PSOIND,PSOANSQ("SC")=PSOIND
"RTN","PSORN52D",103,0)
 . I PSOTYP=1&(PSOSCP>49) S PSOANSQ(PSOX("IRXN"),"SC>50")=PSOIND,PSOANSQ("SC>50")=PSOIND
"RTN","PSORN52D",104,0)
 . I PSOTYP=2 S PSOANSQ(PSOX("IRXN"),"MST")=PSOIND
"RTN","PSORN52D",105,0)
 . I PSOTYP=3 S PSOANSQ(PSOX("IRXN"),"VEH")=PSOIND
"RTN","PSORN52D",106,0)
 . I PSOTYP=4 S PSOANSQ(PSOX("IRXN"),"RAD")=PSOIND
"RTN","PSORN52D",107,0)
 . I PSOTYP=5 S PSOANSQ(PSOX("IRXN"),"PGW")=PSOIND
"RTN","PSORN52D",108,0)
 . I PSOTYP=6 S PSOANSQ(PSOX("IRXN"),"HNC")=PSOIND
"RTN","PSORN52D",109,0)
 . I PSOTYP=7 S PSOANSQ(PSOX("IRXN"),"CV")=PSOIND
"RTN","PSORN52D",110,0)
 D FILE2
"RTN","PSORN52D",111,0)
 Q
"VER")
8.0^22.0
"BLD",5925,6)
^SEQ #193
**END**
**END**
