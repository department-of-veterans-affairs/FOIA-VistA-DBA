Released GMTS*2.7*29 SEQ #42
Extracted from mail message
**KIDS**:GMTS*2.7*29^

**INSTALL NAME**
GMTS*2.7*29
"BLD",2195,0)
GMTS*2.7*29^HEALTH SUMMARY^0^3010508^y
"BLD",2195,1,0)
^^2^2^3001127^^^^
"BLD",2195,1,1,0)
The description of this patch may be found on the National Patch Module 
"BLD",2195,1,2,0)
under GMTS*2.7*29.
"BLD",2195,4,0)
^9.64PA^^0
"BLD",2195,"INI")

"BLD",2195,"INID")
y^y^
"BLD",2195,"INIT")
POST^GMTSA29
"BLD",2195,"KRN",0)
^9.67PA^19^17
"BLD",2195,"KRN",.4,0)
.4
"BLD",2195,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",2195,"KRN",.401,0)
.401
"BLD",2195,"KRN",.402,0)
.402
"BLD",2195,"KRN",.403,0)
.403
"BLD",2195,"KRN",.5,0)
.5
"BLD",2195,"KRN",.84,0)
.84
"BLD",2195,"KRN",3.6,0)
3.6
"BLD",2195,"KRN",3.8,0)
3.8
"BLD",2195,"KRN",9.2,0)
9.2
"BLD",2195,"KRN",9.8,0)
9.8
"BLD",2195,"KRN",9.8,"NM",0)
^9.68A^8^7
"BLD",2195,"KRN",9.8,"NM",1,0)
GMTSDEMB^^0^B2831086
"BLD",2195,"KRN",9.8,"NM",2,0)
GMTSU2^^0^B10477757
"BLD",2195,"KRN",9.8,"NM",3,0)
GMTSULT^^0^B66395334
"BLD",2195,"KRN",9.8,"NM",5,0)
GMTSULT2^^0^B36669012
"BLD",2195,"KRN",9.8,"NM",6,0)
GMTSLRCE^^0^B8778244
"BLD",2195,"KRN",9.8,"NM",7,0)
GMTSRM^^0^B21362492
"BLD",2195,"KRN",9.8,"NM",8,0)
GMTSUIX^^0^B17314276
"BLD",2195,"KRN",9.8,"NM","B","GMTSDEMB",1)

"BLD",2195,"KRN",9.8,"NM","B","GMTSLRCE",6)

"BLD",2195,"KRN",9.8,"NM","B","GMTSRM",7)

"BLD",2195,"KRN",9.8,"NM","B","GMTSU2",2)

"BLD",2195,"KRN",9.8,"NM","B","GMTSUIX",8)

"BLD",2195,"KRN",9.8,"NM","B","GMTSULT",3)

"BLD",2195,"KRN",9.8,"NM","B","GMTSULT2",5)

"BLD",2195,"KRN",19,0)
19
"BLD",2195,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",2195,"KRN",19,"NM",1,0)
GMTS TYPE DELETE^^0
"BLD",2195,"KRN",19,"NM","B","GMTS TYPE DELETE",1)

"BLD",2195,"KRN",19.1,0)
19.1
"BLD",2195,"KRN",101,0)
101
"BLD",2195,"KRN",409.61,0)
409.61
"BLD",2195,"KRN",771,0)
771
"BLD",2195,"KRN",870,0)
870
"BLD",2195,"KRN",8994,0)
8994
"BLD",2195,"KRN","B",.4,.4)

"BLD",2195,"KRN","B",.401,.401)

"BLD",2195,"KRN","B",.402,.402)

"BLD",2195,"KRN","B",.403,.403)

"BLD",2195,"KRN","B",.5,.5)

"BLD",2195,"KRN","B",.84,.84)

"BLD",2195,"KRN","B",3.6,3.6)

"BLD",2195,"KRN","B",3.8,3.8)

"BLD",2195,"KRN","B",9.2,9.2)

"BLD",2195,"KRN","B",9.8,9.8)

"BLD",2195,"KRN","B",19,19)

"BLD",2195,"KRN","B",19.1,19.1)

"BLD",2195,"KRN","B",101,101)

"BLD",2195,"KRN","B",409.61,409.61)

"BLD",2195,"KRN","B",771,771)

"BLD",2195,"KRN","B",870,870)

"BLD",2195,"KRN","B",8994,8994)

"BLD",2195,"PRE")
GMTS29E
"BLD",2195,"QUES",0)
^9.62^^
"BLD",2195,"REQB",0)
^9.611^1^1
"BLD",2195,"REQB",1,0)
GMTS*2.7*43^2
"BLD",2195,"REQB","B","GMTS*2.7*43",1)

"INIT")
POST^GMTSA29
"KRN",19,1995,-1)
0^1
"KRN",19,1995,0)
GMTS TYPE DELETE^Delete Health Summary Type^^E^^^^^^^^^^1^1
"KRN",19,1995,1,0)
^19.06^4^4^3001226^^^^
"KRN",19,1995,1,1,0)
This option allows the owner of a Health Summary Type to delete it. In
"KRN",19,1995,1,2,0)
addition anyone who holds the GMTSMGR key may use this option. Also, if a
"KRN",19,1995,1,3,0)
Health Summary Type has a lock, anyone who holds a key with that lock
"KRN",19,1995,1,4,0)
value may delete that Health Summary Type.
"KRN",19,1995,15)
K %,GMTSMGR
"KRN",19,1995,20)
K DA,DIC,DIE,DIK,DR
"KRN",19,1995,30)
GMT(142,
"KRN",19,1995,31)
AEMQ
"KRN",19,1995,32)
Select Health Summary Type:
"KRN",19,1995,34)
I +($$HST^GMTSULT(+($G(Y))))
"KRN",19,1995,50)
GMT(142,
"KRN",19,1995,51)
[GMTS DELETE HLTH SUM TYPE]
"KRN",19,1995,"U")
DELETE HEALTH SUMMARY TYPE
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",126,-1)
1^1
"PKG",126,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools^^^3010208
"PKG",126,20,0)
^9.402P^^
"PKG",126,22,0)
^9.49I^1^1
"PKG",126,22,1,0)
2.7^2951020^2951020^11
"PKG",126,22,1,"PAH",1,0)
29^3010508^1118
"PKG",126,22,1,"PAH",1,1,0)
^^2^2^3010508
"PKG",126,22,1,"PAH",1,1,1,0)
The description of this patch may be found on the National Patch Module 
"PKG",126,22,1,"PAH",1,1,2,0)
under GMTS*2.7*29.
"PRE")
GMTS29E
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","GMTS29E")
0^^B2168799
"RTN","GMTS29E",1,0)
GMTS29E ; SLC/KER - GMTS*2.7*29 Environment Check   ; 05/08/2001
"RTN","GMTS29E",2,0)
 ;;2.7;Health Summary;**29**;Oct 20, 1995
"RTN","GMTS29E",3,0)
 ;
"RTN","GMTS29E",4,0)
ENV ; Environment Check
"RTN","GMTS29E",5,0)
 N GMTS,GMTSI,GMTSO,GMTSRTN,GMTSPCH S GMTSRTN="GMTSU",GMTSPCH=43 G:+($$ROK(GMTSRTN))'>0 ABRT1
"RTN","GMTS29E",6,0)
 S GMTSO=0,GMTS=$T(@("+2^"_GMTSRTN)),GMTS=$P($P(GMTS,"**",2),"**",1)
"RTN","GMTS29E",7,0)
 F GMTSI=1:1:$L(GMTS,",") S:+($P(GMTS,",",GMTSI))=GMTSPCH GMTSO=1 Q:GMTSO=1
"RTN","GMTS29E",8,0)
 G:GMTSO=0 ABRT2 G EXIT
"RTN","GMTS29E",9,0)
ROK(X) ; Routine OK (in UCI)
"RTN","GMTS29E",10,0)
 S X=$G(X) Q:'$L(X) 0  Q:$L(X)>8 0  X ^%ZOSF("TEST") Q:$T 1  Q 0
"RTN","GMTS29E",11,0)
EXIT ;     Quit   Passed Environment Check
"RTN","GMTS29E",12,0)
 W !!,"  Environment is ok",! Q
"RTN","GMTS29E",13,0)
ABRT1 ;     Exit   Failed Environment Check, Keep the Distribution
"RTN","GMTS29E",14,0)
 W !!,"  Could not find routine GMTSU.  Aborting install...",! S XPDQUIT=2 Q
"RTN","GMTS29E",15,0)
ABRT2 ;     Abort  Failed Environment Check, KILL the Distribution
"RTN","GMTS29E",16,0)
 W !!,"  Could not find the current version of GMTSU.  Please install",!,"  patch GMTS*2.7*43 first.  Aborting install...",! S XPDQUIT=2 Q
"RTN","GMTSA29")
0^^B64450718
"RTN","GMTSA29",1,0)
GMTSA29 ; SLC/KER - Health Summary After   (POST)       ; 05/08/2001
"RTN","GMTSA29",2,0)
 ;;2.7;Health Summary;**29**;Oct 20, 1995
"RTN","GMTSA29",3,0)
 Q
"RTN","GMTSA29",4,0)
POST ;
"RTN","GMTSA29",5,0)
 N DA,DIK,GMTSCOMP,GMTSCTR,GMTSHDR,GMTSI,GMTSN,GMTSNC,GMTSNN,GMTSOK,GMTSP,GMTSP3,GMTSP4,GMTSR,GMTSRN,GMTSSTR,GMTST,GMTSTYP
"RTN","GMTSA29",6,0)
 S U="^" D BM("  Remote Health Summary Types"),DELALL,MOV,SET,M("  <Done>") Q
"RTN","GMTSA29",7,0)
SET ;
"RTN","GMTSA29",8,0)
 ;
"RTN","GMTSA29",9,0)
 N GMTSI,X,GMTSCTR S GMTSCTR=1
"RTN","GMTSA29",10,0)
 ;
"RTN","GMTSA29",11,0)
 S GMTSI=5000001,X="REMOTE DEMO/VISITS/PCE (3M)" D PRE(X) S ^GMT(142,5000001,0)=X_"^GMTSMGR",^GMT(142,5000001,1,0)="^142.01IA^55^11"
"RTN","GMTSA29",12,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^1"),ST(GMTSI,15,"15^205^^3M^^^L^^Y"),ST(GMTSI,20,"20^10^^3M")
"RTN","GMTSA29",13,0)
 D ST(GMTSI,25,"25^212^^3M"),ST(GMTSI,30,"30^208"),ST(GMTSI,35,"35^207"),ST(GMTSI,40,"40^230^^3M")
"RTN","GMTSA29",14,0)
 D ST(GMTSI,45,"45^204^^3M"),ST(GMTSI,50,"50^9"),ST(GMTSI,55,"55^14^^3M"),OT(GMTSI,"Demographics/Visits/PCE (3m)"),I(+GMTSI)
"RTN","GMTSA29",15,0)
 ;
"RTN","GMTSA29",16,0)
 S GMTSI=5000002,X="REMOTE MEDS/LABS/ORDERS (3M)" D PRE(X) S ^GMT(142,5000002,0)=X_"^GMTSMGR",^GMT(142,5000002,1,0)="^142.01IA^50^10"
"RTN","GMTSA29",17,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^1"),ST(GMTSI,15,"15^28^^3M"),ST(GMTSI,20,"20^29^^3M")
"RTN","GMTSA29",18,0)
 D ST(GMTSI,25,"25^30^^3M"),ST(GMTSI,30,"30^3^^3M"),ST(GMTSI,35,"35^38^^3M"),ST(GMTSI,40,"40^46^^3M")
"RTN","GMTSA29",19,0)
 D ST(GMTSI,45,"45^48^^3M"),ST(GMTSI,50,"50^54^^3M"),OT(GMTSI,"Meds/Labs/Orders (3m)"),I(+GMTSI)
"RTN","GMTSA29",20,0)
 ;
"RTN","GMTSA29",21,0)
 S GMTSI=5000003,X="REMOTE TEXT REPORTS (3M)" D PRE(X) S ^GMT(142,5000003,0)=X_"^GMTSMGR",^GMT(142,5000003,1,0)="^142.01IA^35^7"
"RTN","GMTSA29",22,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^1"),ST(GMTSI,15,"15^15^^3M"),ST(GMTSI,20,"20^57^^3M")
"RTN","GMTSA29",23,0)
 D ST(GMTSI,25,"25^69^^3M"),ST(GMTSI,30,"30^35^^3M^^^^^Y"),ST(GMTSI,35,"35^23^^3M^^^^^Y"),OT(GMTSI,"Text Reports (3m)"),I(+GMTSI)
"RTN","GMTSA29",24,0)
 ;
"RTN","GMTSA29",25,0)
 S GMTSI=5000004,X="REMOTE CLINICAL DATA (3M)" D PRE(X) S ^GMT(142,5000004,0)=X_"^GMTSMGR",^GMT(142,5000004,1,0)="^142.01IA^130^26"
"RTN","GMTSA29",26,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^73"),ST(GMTSI,15,"15^47^^3M"),ST(GMTSI,20,"20^61^^^^^L")
"RTN","GMTSA29",27,0)
 D ST(GMTSI,25,"25^28^^3M"),ST(GMTSI,30,"30^29^^3M"),ST(GMTSI,35,"35^30^^3M"),ST(GMTSI,40,"40^54^^3M")
"RTN","GMTSA29",28,0)
 D ST(GMTSI,45,"45^15^^3M"),ST(GMTSI,50,"50^57^^3M"),ST(GMTSI,55,"55^3^^3M"),ST(GMTSI,60,"60^38^^3M")
"RTN","GMTSA29",29,0)
 D ST(GMTSI,65,"65^48^^3M"),ST(GMTSI,70,"70^46^^3M"),ST(GMTSI,75,"75^35^^3M^^^^^Y"),ST(GMTSI,80,"80^69^^3M")
"RTN","GMTSA29",30,0)
 D ST(GMTSI,85,"85^23^^3M^^^^^Y"),ST(GMTSI,90,"90^7^^3M"),ST(GMTSI,95,"95^205^^3M^^^L^^Y"),ST(GMTSI,100,"100^208")
"RTN","GMTSA29",31,0)
 D ST(GMTSI,105,"105^207"),ST(GMTSI,110,"110^212^^3M"),ST(GMTSI,115,"115^230^^3M"),ST(GMTSI,120,"120^204^^3M")
"RTN","GMTSA29",32,0)
 D ST(GMTSI,125,"125^9"),ST(GMTSI,130,"130^14^^3M"),OT(GMTSI,"Clinical Data (3m)"),I(+GMTSI)
"RTN","GMTSA29",33,0)
 ;
"RTN","GMTSA29",34,0)
 S GMTSI=5000005,X="REMOTE CLINICAL DATA (1Y)" D PRE(X) S ^GMT(142,5000005,0)=X_"^GMTSMGR",^GMT(142,5000005,1,0)="^142.01IA^130^26"
"RTN","GMTSA29",35,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^73"),ST(GMTSI,15,"15^47^^1Y"),ST(GMTSI,20,"20^61^^^^^L")
"RTN","GMTSA29",36,0)
 D ST(GMTSI,25,"25^28^^1Y"),ST(GMTSI,30,"30^29^^1Y"),ST(GMTSI,35,"35^30^^1Y"),ST(GMTSI,40,"40^54^^1Y")
"RTN","GMTSA29",37,0)
 D ST(GMTSI,45,"45^15^^1Y"),ST(GMTSI,50,"50^57^^1Y"),ST(GMTSI,55,"55^3^^1Y"),ST(GMTSI,60,"60^38^^1Y")
"RTN","GMTSA29",38,0)
 D ST(GMTSI,65,"65^48^^1Y"),ST(GMTSI,70,"70^46^^1Y"),ST(GMTSI,75,"75^35^^1Y^^^^^Y"),ST(GMTSI,80,"80^69^^1Y")
"RTN","GMTSA29",39,0)
 D ST(GMTSI,85,"85^23^^1Y^^^^^Y"),ST(GMTSI,90,"90^7^^1Y"),ST(GMTSI,95,"95^205^^1Y^^^L^^Y"),ST(GMTSI,100,"100^208")
"RTN","GMTSA29",40,0)
 D ST(GMTSI,105,"105^207"),ST(GMTSI,110,"110^212^^1Y"),ST(GMTSI,115,"115^230^^1Y"),ST(GMTSI,120,"120^204^^1Y")
"RTN","GMTSA29",41,0)
 D ST(GMTSI,125,"125^9"),ST(GMTSI,130,"130^14^^1Y"),OT(GMTSI,"Clinical Data (1y)"),I(+GMTSI)
"RTN","GMTSA29",42,0)
 ;
"RTN","GMTSA29",43,0)
 S GMTSI=5000006,X="REMOTE DEMO/VISITS/PCE (1Y)" D PRE(X) S ^GMT(142,5000006,0)=X_"^GMTSMGR",^GMT(142,5000006,1,0)="^142.01IA^55^11"
"RTN","GMTSA29",44,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^1"),ST(GMTSI,15,"15^205^^1Y^^^L^^Y"),ST(GMTSI,20,"20^10^^1Y")
"RTN","GMTSA29",45,0)
 D ST(GMTSI,25,"25^212^^1Y"),ST(GMTSI,30,"30^208"),ST(GMTSI,35,"35^207"),ST(GMTSI,40,"40^230^^1Y")
"RTN","GMTSA29",46,0)
 D ST(GMTSI,45,"45^204^^1Y"),ST(GMTSI,50,"50^9"),ST(GMTSI,55,"55^14^^1Y"),OT(GMTSI,"Demographics/Visits/PCE (1y)"),I(+GMTSI)
"RTN","GMTSA29",47,0)
 ;
"RTN","GMTSA29",48,0)
 S GMTSI=5000007,X="REMOTE MEDS/LABS/ORDERS (1Y)" D PRE(X) S ^GMT(142,5000007,0)=X_"^GMTSMGR",^GMT(142,5000007,1,0)="^142.01IA^50^10"
"RTN","GMTSA29",49,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^1"),ST(GMTSI,15,"15^28^^1Y"),ST(GMTSI,20,"20^29^^1Y")
"RTN","GMTSA29",50,0)
 D ST(GMTSI,25,"25^30^^1Y"),ST(GMTSI,30,"30^3^^1Y"),ST(GMTSI,35,"35^38^^1Y"),ST(GMTSI,40,"40^46^^1Y")
"RTN","GMTSA29",51,0)
 D ST(GMTSI,45,"45^48^^1Y"),ST(GMTSI,50,"50^54^^1Y"),OT(GMTSI,"Meds/Labs/Orders (1y)"),I(+GMTSI)
"RTN","GMTSA29",52,0)
 ;
"RTN","GMTSA29",53,0)
 S GMTSI=5000008,X="REMOTE TEXT REPORTS (1Y)" D PRE(X) S ^GMT(142,5000008,0)=X_"^GMTSMGR",^GMT(142,5000008,1,0)="^142.01IA^35^7"
"RTN","GMTSA29",54,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^1"),ST(GMTSI,15,"15^15^^1Y"),ST(GMTSI,20,"20^57^^1Y")
"RTN","GMTSA29",55,0)
 D ST(GMTSI,25,"25^69^^1Y"),ST(GMTSI,30,"30^35^^1Y^^^^^Y"),ST(GMTSI,35,"35^23^^1Y^^^^^Y"),OT(GMTSI,"Text Reports (1y)"),I(+GMTSI)
"RTN","GMTSA29",56,0)
 ;
"RTN","GMTSA29",57,0)
 S GMTSI=5000009,X="REMOTE CLINICAL DATA (4Y)" D PRE(X) S ^GMT(142,5000009,0)=X_"^GMTSMGR",^GMT(142,5000009,1,0)="^142.01IA^130^26"
"RTN","GMTSA29",58,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^73"),ST(GMTSI,15,"15^47^^4Y"),ST(GMTSI,20,"20^61^^^^^L")
"RTN","GMTSA29",59,0)
 D ST(GMTSI,25,"25^28^^4Y"),ST(GMTSI,30,"30^29^^4Y"),ST(GMTSI,35,"35^30^^4Y"),ST(GMTSI,40,"40^54^^4Y")
"RTN","GMTSA29",60,0)
 D ST(GMTSI,45,"45^15^^4Y"),ST(GMTSI,50,"50^57^^4Y"),ST(GMTSI,55,"55^3^^4Y"),ST(GMTSI,60,"60^38^^4Y")
"RTN","GMTSA29",61,0)
 D ST(GMTSI,65,"65^48^^4Y"),ST(GMTSI,70,"70^46^^4Y"),ST(GMTSI,75,"75^35^^4Y^^^^^Y"),ST(GMTSI,80,"80^69^^4Y")
"RTN","GMTSA29",62,0)
 D ST(GMTSI,85,"85^23^^4Y^^^^^Y"),ST(GMTSI,90,"90^7^^4Y"),ST(GMTSI,95,"95^205^^4Y^^^L^^Y"),ST(GMTSI,100,"100^208")
"RTN","GMTSA29",63,0)
 D ST(GMTSI,105,"105^207"),ST(GMTSI,110,"110^212^^4Y"),ST(GMTSI,115,"115^230^^4Y"),ST(GMTSI,120,"120^204^^4Y")
"RTN","GMTSA29",64,0)
 D ST(GMTSI,125,"125^9"),ST(GMTSI,130,"130^14^^4Y"),OT(GMTSI,"Clinical Data (4y)"),I(+GMTSI)
"RTN","GMTSA29",65,0)
 ;
"RTN","GMTSA29",66,0)
 S GMTSI=5000010,X="REMOTE LABS LONG VIEW (12Y)" D PRE(X) S ^GMT(142,5000010,0)=X_"^GMTSMGR",^GMT(142,5000010,1,0)="^142.01IA^25^5"
"RTN","GMTSA29",67,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^3^^12Y"),ST(GMTSI,15,"15^37^^12Y"),ST(GMTSI,20,"20^48^^12Y")
"RTN","GMTSA29",68,0)
 D ST(GMTSI,25,"25^46^^12Y"),OT(GMTSI,"Labs Long View (12Y)"),I(+GMTSI)
"RTN","GMTSA29",69,0)
 ;
"RTN","GMTSA29",70,0)
 S GMTSI=5000011,X="REMOTE LABS ALL (1Y)" D PRE(X) S ^GMT(142,5000011,0)=X_"^GMTSMGR",^GMT(142,5000011,1,0)="^142.01IA^35^7"
"RTN","GMTSA29",71,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^3^^1Y"),ST(GMTSI,15,"15^38^^1Y"),ST(GMTSI,20,"20^48^^1Y")
"RTN","GMTSA29",72,0)
 D ST(GMTSI,25,"25^46^^1Y"),ST(GMTSI,30,"30^72^^1Y"),ST(GMTSI,35,"35^36^^1Y"),OT(GMTSI,"Labs All (1y)"),I(+GMTSI)
"RTN","GMTSA29",73,0)
 ;
"RTN","GMTSA29",74,0)
 S GMTSI=5000012,X="REMOTE LABS ALL (3M)" D PRE(X) S ^GMT(142,5000012,0)=X_"^GMTSMGR",^GMT(142,5000012,1,0)="^142.01IA^35^7"
"RTN","GMTSA29",75,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^3^^3M"),ST(GMTSI,15,"15^38^^3M"),ST(GMTSI,20,"20^48^^3M")
"RTN","GMTSA29",76,0)
 D ST(GMTSI,25,"25^46^^3M"),ST(GMTSI,30,"30^72^^3M"),ST(GMTSI,35,"35^36^^3M"),OT(GMTSI,"Labs All (3m)"),I(+GMTSI)
"RTN","GMTSA29",77,0)
 ;
"RTN","GMTSA29",78,0)
 S GMTSI=5000013,X="REMOTE DIS SUM/SURG/PROD (12Y)" D PRE(X) S ^GMT(142,5000013,0)=X_"^GMTSMGR",^GMT(142,5000013,1,0)="^142.01IA^25^5"
"RTN","GMTSA29",79,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^57^^12Y"),ST(GMTSI,15,"15^23^^12Y^^^^^Y"),ST(GMTSI,20,"20^50^^12Y")
"RTN","GMTSA29",80,0)
 D ST(GMTSI,25,"25^51^^12Y"),OT(GMTSI,"Discharge Sum/Surg/Prod (12y)"),I(+GMTSI)
"RTN","GMTSA29",81,0)
 ;
"RTN","GMTSA29",82,0)
 S GMTSI=5000014,X="REMOTE OUTPATIENT MEDS (6M)" D PRE(X) S ^GMT(142,5000014,0)=X_"^GMTSMGR",^GMT(142,5000014,1,0)="^142.01IA^10^2"
"RTN","GMTSA29",83,0)
 D ST(GMTSI,5,"5^2"),ST(GMTSI,10,"10^28^^6M") D OT(GMTSI,"Remote Outpatient Meds (6m)"),I(+GMTSI)
"RTN","GMTSA29",84,0)
 ;
"RTN","GMTSA29",85,0)
 Q
"RTN","GMTSA29",86,0)
PRE(X) Q:'$L($G(X))  D:+($G(GMTSCTR))=1 INS1(X) D:+($G(GMTSCTR))'=1 INS(X)
"RTN","GMTSA29",87,0)
 D M0,KC(X) S GMTSCTR=GMTSCTR+1 Q
"RTN","GMTSA29",88,0)
 ;
"RTN","GMTSA29",89,0)
ST(GMTSTYP,GMTSSTR,X) S GMTSTYP=+$G(GMTSTYP),GMTSSTR=+$G(GMTSSTR),X=$G(X)
"RTN","GMTSA29",90,0)
 N GMTSCOMP,GMTSHDR Q:+GMTSTYP=0  Q:+GMTSSTR=0  Q:$L(X)=0
"RTN","GMTSA29",91,0)
 S GMTSCOMP=+($P($G(X),"^",2)),GMTSHDR=$P($G(^GMT(142.1,+GMTSCOMP,0)),"^",9)
"RTN","GMTSA29",92,0)
 S:$L(GMTSHDR)&($P(X,"^",5)="") $P(X,"^",5)=GMTSHDR
"RTN","GMTSA29",93,0)
 S ^GMT(142,GMTSTYP,1,GMTSSTR,0)=X Q
"RTN","GMTSA29",94,0)
OT(GMTST,X) S GMTST=+$G(GMTST),X=$G(X) Q:GMTST=0  Q:$L(X)=0
"RTN","GMTSA29",95,0)
 S ^GMT(142,GMTST,99)=$H,^GMT(142,GMTST,"T")=X,^GMT(142,GMTST,"VA")=2
"RTN","GMTSA29",96,0)
 S $P(^GMT(142,GMTST,0),"^",4)="Y" S:$D(^VA(200,.5,0)) $P(^GMT(142,GMTST,0),"^",3)=.5 Q
"RTN","GMTSA29",97,0)
MOV N GMTSQ,GMTSI,GMTSC S GMTSI=4999999,GMTSC=0
"RTN","GMTSA29",98,0)
 F  S GMTSI=$O(^GMT(142,GMTSI)) Q:+GMTSI=0!(GMTSI>5000999)  D
"RTN","GMTSA29",99,0)
 . Q:+($G(^GMT(142,GMTSI,"VA")))>0  D M0 S GMTSC=GMTSC+1
"RTN","GMTSA29",100,0)
 S GMTSQ="" D:GMTSC>0 RXT^GMTSUIX
"RTN","GMTSA29",101,0)
 Q
"RTN","GMTSA29",102,0)
M0 Q:'$D(^GMT(142,+($G(GMTSI)),0))  N GMTSOK,GMTSNN,GMTSNC,GMTSR,GMTSRN
"RTN","GMTSA29",103,0)
 S GMTSNN="^GMT(142,"_+($G(GMTSI))_")",GMTSNC="^GMT(142,"_+($G(GMTSI))_","
"RTN","GMTSA29",104,0)
M1 S GMTSR=$$DA Q:GMTSR=1
"RTN","GMTSA29",105,0)
M2 Q:$D(^GMT(142,+GMTSR,0))
"RTN","GMTSA29",106,0)
 L +^GMT(142,GMTSR):0 S GMTSOK=$T
"RTN","GMTSA29",107,0)
 I +GMTSOK D
"RTN","GMTSA29",108,0)
 . F  S GMTSNN=$Q(@GMTSNN) Q:GMTSNN=""!(GMTSNN'[GMTSNC)  D
"RTN","GMTSA29",109,0)
 . . S GMTSRN="^GMT(142,"_GMTSR_","_$P(GMTSNN,",",3,299) S @GMTSRN=@GMTSNN
"RTN","GMTSA29",110,0)
 . L -^GMT(142,GMTSRN)
"RTN","GMTSA29",111,0)
 G:'+GMTSOK M2 I $D(^GMT(142,GMTSR)) D I(GMTSR),K(+($G(GMTSI)))
"RTN","GMTSA29",112,0)
 Q
"RTN","GMTSA29",113,0)
DELALL S U="^" N GMTSI,GMTSN S GMTSI=0
"RTN","GMTSA29",114,0)
 F  S GMTSI=$O(^GMT(142,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSA29",115,0)
 . Q:+($G(^GMT(142,GMTSI,"VA")))'>1
"RTN","GMTSA29",116,0)
 . S GMTSN=$P($G(^GMT(142,GMTSI,0)),"^",1)
"RTN","GMTSA29",117,0)
 . Q:GMTSN'["REMOTE"  D KC(GMTSN)
"RTN","GMTSA29",118,0)
 Q
"RTN","GMTSA29",119,0)
KC(X) N GMTSN,DA,DIK S GMTSN=$G(X) Q:'$L(GMTSN)
"RTN","GMTSA29",120,0)
KC2 S DA=0 F  S DA=$O(^GMT(142,"B",$E(GMTSN,1,30),DA)) Q:+DA=0  D K(+DA)
"RTN","GMTSA29",121,0)
 I $E(GMTSN,1,7)="REMOTE " D  G KC2
"RTN","GMTSA29",122,0)
 . S GMTSN=$P(GMTSN,"REMOTE ",2,299)_" REMOTE"
"RTN","GMTSA29",123,0)
 Q
"RTN","GMTSA29",124,0)
K(X) N DA,DIK S DA=+($G(X)),DIK="^GMT(142," Q:+($G(DA))=0  D ^DIK Q
"RTN","GMTSA29",125,0)
IALL K ^GMT(142,"AB"),^GMT(142,"AE"),^GMT(142,"AW"),^GMT(142,"B"),^GMT(142,"C"),^GMT(142,"D"),^GMT(142,"E") S U="^"
"RTN","GMTSA29",126,0)
 N DA S DA=0 F  S DA=$O(^GMT(142,DA)) Q:+DA=0  D I(DA)
"RTN","GMTSA29",127,0)
 Q
"RTN","GMTSA29",128,0)
I(X) N DA,DIK,GMTSP,GMTSP3,GMTSP4 S DA=+($G(X)) D:+DA>0 N0
"RTN","GMTSA29",129,0)
 S DIK="^GMT(142," Q:+($G(DA))=0  D IX1^DIK Q
"RTN","GMTSA29",130,0)
N0 S (GMTSP,GMTSP3,GMTSP4)=0
"RTN","GMTSA29",131,0)
 F  S GMTSP=$O(^GMT(142,DA,1,GMTSP)) Q:+GMTSP=0  D
"RTN","GMTSA29",132,0)
 . S GMTSP3=GMTSP,GMTSP4=GMTSP4+1
"RTN","GMTSA29",133,0)
 S ^GMT(142,DA,1,0)="^142.01IA^"_GMTSP3_"^"_GMTSP4
"RTN","GMTSA29",134,0)
 Q
"RTN","GMTSA29",135,0)
DA(X) S X=$O(^GMT(142,"4999999"),-1) F  Q:'$D(^GMT(142,X))  S X=X+1
"RTN","GMTSA29",136,0)
 Q:X<5000000 X  Q:X>5000999 X
"RTN","GMTSA29",137,0)
 S X=$O(^GMT(142,"!"),-1) F  Q:'$D(^GMT(142,X))  S X=X+1
"RTN","GMTSA29",138,0)
 S:X>4999999&(X<6000000) X=6000000 Q X
"RTN","GMTSA29",139,0)
INS1(X) S X=$G(X) D BM("    Installing:  "_X) Q
"RTN","GMTSA29",140,0)
INS(X) S X=$G(X) Q:'$L(X)  D M("                 "_X) Q
"RTN","GMTSA29",141,0)
BM(X) D:$D(XPDNM) BMES^XPDUTL($G(X)) W:'$D(XPDNM) !!,$G(X) Q
"RTN","GMTSA29",142,0)
M(X) D:$D(XPDNM) MES^XPDUTL($G(X)) W:'$D(XPDNM) !,$G(X) Q
"RTN","GMTSDEMB")
0^1^B2831086
"RTN","GMTSDEMB",1,0)
GMTSDEMB ;SLC/DLT - Brief Demographic Component  ; 05/08/2001
"RTN","GMTSDEMB",2,0)
 ;;2.7;Health Summary;**29**;Oct 20, 1995
"RTN","GMTSDEMB",3,0)
 ;
"RTN","GMTSDEMB",4,0)
DEMOG ; Prints Brief Demographic data from VADPT calls
"RTN","GMTSDEMB",5,0)
 N VAPA,GMTSS,GMTSR D ELIG^VADPT,ADD^VADPT,DEM^VADPT
"RTN","GMTSDEMB",6,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?12,"Address: "_$S($L(VAPA(1)):VAPA(1),1:"Not available"),?53," Phone:",?61,VAPA(8),!
"RTN","GMTSDEMB",7,0)
 I VAPA(2)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(2),!
"RTN","GMTSDEMB",8,0)
 I VAPA(3)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(3),!
"RTN","GMTSDEMB",9,0)
 I VAPA(4)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?21,VAPA(4),", ",$P(VAPA(5),"^",2),"  ",VAPA(6),!
"RTN","GMTSDEMB",10,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?8,"Eligibility: ",?21,$P(VAEL(1),"^",2)
"RTN","GMTSDEMB",11,0)
 I VADM(4)'="" D CKP^GMTSUP Q:$D(GMTSIT)  W ?56,"Age: ",$P(VADM(4),"^",1),!
"RTN","GMTSDEMB",12,0)
 I VAEL(9)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?9,"Means Test: ",$P(VAEL(9),"^",2)
"RTN","GMTSDEMB",13,0)
 I VADM(5)'="" D CKP^GMTSUP Q:$D(GMTSQIT)  W ?56,"Sex: ",$P(VADM(5),"^",2),!
"RTN","GMTSDEMB",14,0)
 S GMTSR=0 S:$G(^GMT(142,+($G(GMTSTYP)),"VA"))>0&($P($G(^GMT(142,+($G(GMTSTYP)),0)),"^",1)["REMOTE") GMTSR=1
"RTN","GMTSDEMB",15,0)
 S GMTSS=$$SITE^GMTSU2
"RTN","GMTSDEMB",16,0)
 I GMTSR>0,$L(GMTSS) D
"RTN","GMTSDEMB",17,0)
 . D CKP^GMTSUP Q:$D(GMTSIT)  W ?5,"Source of Info: ",GMTSS,!
"RTN","GMTSDEMB",18,0)
 ;I $O(VAEL(1,0)) S I=0 F Z=0:0 S I=$O(VAEL(1,I)) Q:I=""  W ?21,$P(VAEL(1,I),"^",2),!
"RTN","GMTSDEMB",19,0)
 K I,IX,VA,VAEL,VAPA Q
"RTN","GMTSLRCE")
0^6^B8778244
"RTN","GMTSLRCE",1,0)
GMTSLRCE ; SLC/JER,KER - Chemistry Extract Routine ; 05/08/2001
"RTN","GMTSLRCE",2,0)
 ;;2.7;Health Summary;**18,28,29**;Oct 20, 1995
"RTN","GMTSLRCE",3,0)
XTRCT ; Call with LRDFN, GMTS1, GMTS2, MAX (#occurrences) & SEX (M or F)
"RTN","GMTSLRCE",4,0)
 N IDT,CNT,AGE
"RTN","GMTSLRCE",5,0)
 I '$D(GMTSAGE) D DEM^GMTSU
"RTN","GMTSLRCE",6,0)
 S AGE=GMTSAGE
"RTN","GMTSLRCE",7,0)
 K ^TMP("LRC",$J)
"RTN","GMTSLRCE",8,0)
 S IDT=GMTS1,CNT=0 F  S IDT=$O(^LR(LRDFN,"CH",IDT)) Q:IDT=""!(IDT>GMTS2)  D:CNT'>MAX CHSET
"RTN","GMTSLRCE",9,0)
 Q
"RTN","GMTSLRCE",10,0)
CHSET ; Sets Chemistry locals for printing
"RTN","GMTSLRCE",11,0)
 N CDT,SITE,SPEC,PTR,ISVALID,GMI,ACC,LOC,COM,RDT,SNOMED
"RTN","GMTSLRCE",12,0)
 S ISVALID=$P(^LR(LRDFN,"CH",IDT,0),U,3) Q:ISVALID=""
"RTN","GMTSLRCE",13,0)
 S SNOMED=""
"RTN","GMTSLRCE",14,0)
 S CDT=+^LR(LRDFN,"CH",IDT,0),SITE=$P(^(0),U,5),SPEC=$P(^LAB(61,SITE,0),U),SNOMED=$P(^(0),U,2),CNT=CNT+1
"RTN","GMTSLRCE",15,0)
 I $D(EXPAND) D
"RTN","GMTSLRCE",16,0)
 . S SPEC=SNOMED_";"_SPEC,RDT=$P(^LR(LRDFN,"CH",IDT,0),U,3)
"RTN","GMTSLRCE",17,0)
 . S ACC=$P(^(0),U,6),ACC=$P(ACC," ",2,3)_" "_$P(ACC," ")
"RTN","GMTSLRCE",18,0)
 . S LOC=$P(^(0),U,11)
"RTN","GMTSLRCE",19,0)
 . S RDT=$$FMTHL7^XLFDT(RDT)
"RTN","GMTSLRCE",20,0)
 S X=CDT D REGDTM4^GMTSU:'$D(EXPAND)
"RTN","GMTSLRCE",21,0)
 S:$D(EXPAND) X=$$FMTHL7^XLFDT(X) S CDT=X K X
"RTN","GMTSLRCE",22,0)
 S PTR=1 F  S PTR=$O(^LR(LRDFN,"CH",IDT,PTR)) Q:PTR<1  D NXTST
"RTN","GMTSLRCE",23,0)
 I $D(^LR(LRDFN,"CH",IDT,1,0)),($D(^TMP("LRC",$J,IDT))) D
"RTN","GMTSLRCE",24,0)
 . S COM=0 F GMI=1:1 S COM=$O(^LR(LRDFN,"CH",IDT,1,COM)) Q:+COM'>0  S ^TMP("LRC",$J,IDT,"C",GMI)=^LR(LRDFN,"CH",IDT,1,COM,0)
"RTN","GMTSLRCE",25,0)
 Q
"RTN","GMTSLRCE",26,0)
NXTST ; Visit next node in ^(PTR) subtree
"RTN","GMTSLRCE",27,0)
 N RESULT,FLAG,TEST,GMPC,GMSQN,TNM,DESCR,THER,UNIT,HI,LO,CIS
"RTN","GMTSLRCE",28,0)
 S RESULT=$P(^LR(LRDFN,"CH",IDT,PTR),U),FLAG=$P(^(PTR),U,2),CIS=""
"RTN","GMTSLRCE",29,0)
 I $D(EXPAND),(FLAG["*") S FLAG=$S(FLAG="L*":"LL",FLAG="H*":"HH",1:FLAG)
"RTN","GMTSLRCE",30,0)
 S TEST=$O(^LAB(60,"C","CH;"_PTR_";1",0)) Q:TEST'>0
"RTN","GMTSLRCE",31,0)
 S TNM=$S($L($P(^LAB(60,TEST,0),U))<19:$P(^(0),U),1:$P(^(.1),U))
"RTN","GMTSLRCE",32,0)
 ; If Test Type field is neither "Output" or "Both" then quit
"RTN","GMTSLRCE",33,0)
 I $S("BO"'[$P(^LAB(60,TEST,0),U,3):1,1:0) Q
"RTN","GMTSLRCE",34,0)
 S GMSQN=$S($P($G(^LAB(60,TEST,.1)),U,6):$P($G(^(.1)),U,6),1:PTR/1000000)
"RTN","GMTSLRCE",35,0)
 I $D(^LAB(60,TEST,10)) S CIS=^(10)
"RTN","GMTSLRCE",36,0)
 I $D(EXPAND),'$L(CIS) Q
"RTN","GMTSLRCE",37,0)
 I $D(EXPAND) S TNM=CIS_";"_TNM
"RTN","GMTSLRCE",38,0)
 ; Execute Print Code from file 60 to evaluate RESULT
"RTN","GMTSLRCE",39,0)
 S RESULT=$$RESULT(TEST,RESULT,$G(RWIDTH))
"RTN","GMTSLRCE",40,0)
 S DESCR=$S($D(^LAB(60,TEST,1,SITE,0)):^(0),1:""),THER=$S($L($P(DESCR,U,11,12))>1:1,1:0)
"RTN","GMTSLRCE",41,0)
 S UNIT=$P(DESCR,U,7),LO=$S(THER:$P(DESCR,U,11),1:$P(DESCR,U,2)),HI=$S(THER:$P(DESCR,U,12),1:$P(DESCR,U,3))
"RTN","GMTSLRCE",42,0)
 S @("LO="_$S($L(LO):LO,1:"""""")),@("HI="_$S($L(HI):HI,1:""""""))
"RTN","GMTSLRCE",43,0)
 I $D(EXPAND),'$L(FLAG),(+$G(HI)'<+$G(RESULT)),(+$G(LO)'>+$G(RESULT)) S FLAG="N"
"RTN","GMTSLRCE",44,0)
 F  Q:'$D(^TMP("LRC",$J,IDT,GMSQN))  Q:TEST=+^(GMSQN)  S GMSQN=GMSQN+1
"RTN","GMTSLRCE",45,0)
 Q:$D(^TMP("LRC",$J,IDT,GMSQN))
"RTN","GMTSLRCE",46,0)
 S ^TMP("LRC",$J,IDT,GMSQN)=CDT_U_SPEC_U_TNM_U_RESULT_U_FLAG_U_UNIT_U_LO_U_HI
"RTN","GMTSLRCE",47,0)
 I $D(EXPAND) D XPND
"RTN","GMTSLRCE",48,0)
 Q
"RTN","GMTSLRCE",49,0)
XPND ; Appends additional data if required
"RTN","GMTSLRCE",50,0)
 S ^TMP("LRC",$J,IDT,GMSQN)=^TMP("LRC",$J,IDT,GMSQN)_U_ACC_U_RDT_U_LOC
"RTN","GMTSLRCE",51,0)
 Q
"RTN","GMTSLRCE",52,0)
RESULT(TEST,RESULT,LRCW) ;Convert result to external format
"RTN","GMTSLRCE",53,0)
 ;TEST=Test ptr to file 60
"RTN","GMTSLRCE",54,0)
 ;RESULT=Test result
"RTN","GMTSLRCE",55,0)
 ;LRCW=Optional width of variable. Default is 0
"RTN","GMTSLRCE",56,0)
 N X,X1
"RTN","GMTSLRCE",57,0)
 I +$G(LRCW)'>0 S LRCW=0
"RTN","GMTSLRCE",58,0)
 S X1=$P($G(^LAB(60,TEST,.1)),"^",3),X1=$S($L(X1):X1,1:"$J(X,LRCW)"),X=RESULT,@("X="_X1)
"RTN","GMTSLRCE",59,0)
 Q X
"RTN","GMTSRM")
0^7^B21362492
"RTN","GMTSRM",1,0)
GMTSRM ; SLC/KER - Create/Modify Health Summary Type ; 05/08/2001
"RTN","GMTSRM",2,0)
 ;;2.7;Health Summary;**30,35,29**;Oct 20, 1995
"RTN","GMTSRM",3,0)
 ;
"RTN","GMTSRM",4,0)
MAIN ;Main loop to modify multiple health summary types
"RTN","GMTSRM",5,0)
 N %,DTOUT,DUOUT,DIRUT,EXISTS,GMTSFUNC,GMTSQIT,P
"RTN","GMTSRM",6,0)
 S GMTSQIT=0 F  S EXISTS=0 D SELTYP Q:GMTSQIT
"RTN","GMTSRM",7,0)
 Q
"RTN","GMTSRM",8,0)
SELTYP ; Select Health Summary Type to Edit
"RTN","GMTSRM",9,0)
 N CHANGE,DA,DIC,DIE,DLAYGO,DR,DUOUT,EXISTS,GMTSUM,GMTSNEW,GMTSMGR
"RTN","GMTSRM",10,0)
 N GMTSEG,GMTSIFN,SELCNT,X,Y
"RTN","GMTSRM",11,0)
 W ! S U="^",DIC="^GMT(142,",DIC(0)="AEMQL"
"RTN","GMTSRM",12,0)
 S DIC("A")="Select Health Summary Type: "
"RTN","GMTSRM",13,0)
 ;S DIC("S")="I $P(^(0),U)'=""GMTS HS ADHOC OPTION"""
"RTN","GMTSRM",14,0)
 S DIC("S")="I +($$AHST^GMTSULT(+($G(Y))))" S DLAYGO=142
"RTN","GMTSRM",15,0)
 S Y=$$TYPE^GMTSULT K DIC S:+Y'>0 GMTSQIT=1 Q:+Y'>0  S (GMTSIFN,DA)=+Y
"RTN","GMTSRM",16,0)
 S GMTSUM=$P(Y,U,2),GMTSNEW=+$P(Y,U,3),GMTSMGR=$S($D(^XUSEC("GMTSMGR",DUZ)):1,1:0)
"RTN","GMTSRM",17,0)
 I 'GMTSMGR,($P(^GMT(142,+DA,0),U,2)]"") D  Q:'GMTSMGR
"RTN","GMTSRM",18,0)
 . S GMTSMGR=$D(^XUSEC($P(^(0),U,2),DUZ))
"RTN","GMTSRM",19,0)
 . W:'GMTSMGR !,$C(7),"This summary report is currently locked to prevent alteration.",!
"RTN","GMTSRM",20,0)
 I 'GMTSMGR,'GMTSNEW,($P(^GMT(142,+DA,0),U,3)'=DUZ) W !,$C(7),"Alteration of this summary report is restricted to its owner.",!,"See the Clinical Coordinator if you need additional help." Q
"RTN","GMTSRM",21,0)
 S DIE="^GMT(142,",(GMTSIFN,DA)=+Y,DR="[GMTS EDIT HLTH SUM TYPE]" D ^DIE
"RTN","GMTSRM",22,0)
 I '$D(^GMT(142,+GMTSIFN,0))!$D(Y)!$D(DUOUT)!$D(DIROUT)!$D(DTOUT) D  Q
"RTN","GMTSRM",23,0)
 . S GMTSQIT=1 D CHKDEL Q
"RTN","GMTSRM",24,0)
 I 'GMTSNEW,($O(^GMT(142,+GMTSIFN,1,0))) S EXISTS=1 D LIST,EXISTS Q
"RTN","GMTSRM",25,0)
 D SELCMP^GMTSRM5 Q:GMTSQIT  D LIST:EXISTS,EXISTS D CHKDEL
"RTN","GMTSRM",26,0)
 Q
"RTN","GMTSRM",27,0)
CHKDEL ; Check for Possible Deletion (New Type without Component)
"RTN","GMTSRM",28,0)
 Q:+($G(GMTSNEW))'>0  Q:+($G(GMTSIFN))'>0  Q:'$D(^GMT(142,+($G(GMTSIFN)),0))
"RTN","GMTSRM",29,0)
 Q:$D(^GMT(142,+($G(GMTSIFN)),1,"B"))  Q:'$L($P($G(^GMT(142,+($G(GMTSIFN)),0)),"^",1))
"RTN","GMTSRM",30,0)
 N DA,GMTSNAM,GMTSH1,GMTSH2,GMTSH3,GMTSH4 S DA=GMTSIFN,GMTSNAM=$P($G(^GMT(142,GMTSIFN,0)),"^",1) Q:'$L(GMTSNAM)
"RTN","GMTSRM",31,0)
 S GMTSH1="  Health Summary Type """_GMTSNAM_""" has no components.",GMTSH2="Enter either 'Y' or 'N' ",GMTSH3="'Y' Delete the Health Summary Type",GMTSH4="'N' Do NOT Delete the Health Summary Type" W !!,GMTSH1
"RTN","GMTSRM",32,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT S DIR(0)="YAO",DIR("A")="    Delete """_GMTSNAM_"""?  (Y/N)  "
"RTN","GMTSRM",33,0)
 S DIR("?")="^W !,?6,GMTSH2",DIR("??")="^W !,?4,GMTSH1,!!,?8,""Enter"",?15,GMTSH3,!,?15,GMTSH4" W ! D ^DIR
"RTN","GMTSRM",34,0)
 I +($G(Y))>0,$G(X)'["^" D
"RTN","GMTSRM",35,0)
 . N DIK S U="^",DIK="^GMT(142," Q:DA'>0  Q:'$D(^GMT(142,DA,0))  Q:$D(^GMT(142,DA,1,"B"))  D ^DIK
"RTN","GMTSRM",36,0)
 W:'$D(^GMT(142,DA,0)) "    < deleted >" W:$D(^GMT(142,DA,0)) "    < not deleted >"
"RTN","GMTSRM",37,0)
 Q
"RTN","GMTSRM",38,0)
ENADHOC ; Entry point for AD HOC edit
"RTN","GMTSRM",39,0)
 N %,C,CHANGE,DA,DIC,DIE,DR,DUOUT,EXISTS,I,GMTSIFN,GMTSN,GMTSNCNT,GMTSNEW
"RTN","GMTSRM",40,0)
 N GMTSIFN,GMTSUM,P,SELCNT
"RTN","GMTSRM",41,0)
 N GMTSQIT,GMTSFUNC,X,Y
"RTN","GMTSRM",42,0)
 W !!,">>> EDITING the GMTS HS ADHOC OPTION Health Summary Type"
"RTN","GMTSRM",43,0)
 S (GMTSNEW,GMTSQIT)=0
"RTN","GMTSRM",44,0)
 S DIC=142,DIC(0)="XZF",X="GMTS HS ADHOC OPTION"
"RTN","GMTSRM",45,0)
 S Y=$$TYPE^GMTSULT I +Y'>0 D ^GMTSLOAD Q:$D(DIRUT)!$D(DIROUT)  G ENADHOC
"RTN","GMTSRM",46,0)
 S GMTSIFN=+Y,GMTSUM=$P(Y,U,2),EXISTS=1
"RTN","GMTSRM",47,0)
 S DIE="^GMT(142,",DA=GMTSIFN,DR=".08T" D ^DIE
"RTN","GMTSRM",48,0)
 Q:$D(Y)
"RTN","GMTSRM",49,0)
 D LIST,EXISTS
"RTN","GMTSRM",50,0)
 Q
"RTN","GMTSRM",51,0)
EXISTS ;Edit an existing health summary type
"RTN","GMTSRM",52,0)
 N CNT,NXTCMP
"RTN","GMTSRM",53,0)
 Q:$D(DUOUT)
"RTN","GMTSRM",54,0)
 S NXTCMP=0 ;NXTCMP tracks whether any component changes may have been made.
"RTN","GMTSRM",55,0)
 S NXTCMP(0)=0 F CNT=$$GETCNT(GMTSIFN):0 D NXTCMP^GMTSRM1,LIST:GMTSQIT Q:GMTSQIT!($D(DUOUT))  K GMTSQIT,GMTSNEW,TWEENER,SOACTION
"RTN","GMTSRM",56,0)
 I NXTCMP>0 W !,"Please hold on while I resequence the summary order" D COPY^GMTSRN,RNMBR^GMTSRN:CHANGE
"RTN","GMTSRM",57,0)
 Q
"RTN","GMTSRM",58,0)
LIST ; Lists existing summary parameters
"RTN","GMTSRM",59,0)
 N B,DIC,DIR,IOP,Y,FR,TO,BY,DHD,FLDS,L
"RTN","GMTSRM",60,0)
 I GMTSQIT'=2 Q:($D(DUOUT)!(GMTSQIT=1))  ;List after return from NXTCMP^GMTSRM1
"RTN","GMTSRM",61,0)
 I GMTSQIT=2,(NXTCMP=0) S GMTSQIT=0 Q
"RTN","GMTSRM",62,0)
 I 'GMTSNEW W ! S DIC=142,DIR(0)="Y",DIR("A")="Do you wish to review the Summary Type structure before continuing",DIR("B")="NO" D ^DIR K DIR I 'Y S:GMTSQIT=2 DUOUT="" S:GMTSQIT=2 GMTSQIT="D" S:$D(DUOUT) GMTSQIT=1 Q
"RTN","GMTSRM",63,0)
 I $D(GMTSQIT),GMTSQIT=2 S GMTSQIT=0 ;Allow for reiterative updates of Components.
"RTN","GMTSRM",64,0)
 S IOP="HOME",DIC=142,(FR,TO)=GMTSUM,BY=".01",DHD="[GMTS TYPE INQ HEADER]-[GMTS TYPE INQ FOOTER]",FLDS="[GMTS TYPE INQ]",L=0 D EN1^DIP
"RTN","GMTSRM",65,0)
 Q
"RTN","GMTSRM",66,0)
GETCNT(GMTSIFN) ; Determine default summary order for new component
"RTN","GMTSRM",67,0)
 N LI,LCNT
"RTN","GMTSRM",68,0)
 S LI=0,LCNT=5 F  S LI=$O(^GMT(142,+GMTSIFN,1,LI)) Q:+LI'>0  S LCNT=$P(LI,".")+5
"RTN","GMTSRM",69,0)
 Q LCNT
"RTN","GMTSU2")
0^2^B10477757
"RTN","GMTSU2",1,0)
GMTSU2 ; SLC/KER - Health Summary Utilities ; 05/08/2001
"RTN","GMTSU2",2,0)
 ;;2.7;Health Summary;**29**;Oct 20, 1995
"RTN","GMTSU2",3,0)
 ;
"RTN","GMTSU2",4,0)
 Q
"RTN","GMTSU2",5,0)
 ; User
"RTN","GMTSU2",6,0)
USER(X) ; Is a user (1 yes 0 no)     0;1    DBIA 10060
"RTN","GMTSU2",7,0)
 N GMTS Q:+($G(X))=0 "" S GMTS=$$UNAM(+($G(X))),X=$S($L(GMTS)>0:1,1:0) Q X
"RTN","GMTSU2",8,0)
UACT(X) ; Active User (1 active)     0;11   DBIA 10060
"RTN","GMTSU2",9,0)
 N GMTS,GMTSN Q:+($G(X))=0 0 S GMTS=$$USER(+($G(X))) Q:+GMTS=0 0
"RTN","GMTSU2",10,0)
 S GMTS=+($$GET1^DIQ(200,+($G(X)),9.2,"I")) S GMTSN=$$NOW^XLFDT Q:GMTS>0&(GMTS<GMTSN) 0 Q 1
"RTN","GMTSU2",11,0)
UNAM(X) ; User Name                  0;1    DBIA 10060
"RTN","GMTSU2",12,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.01)
"RTN","GMTSU2",13,0)
UHPH(X) ; Home Phone               .13;1    DBIA 10060
"RTN","GMTSU2",14,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.132)
"RTN","GMTSU2",15,0)
UOPH(X) ; Office Phone             .13;2    DBIA 10060
"RTN","GMTSU2",16,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.132)
"RTN","GMTSU2",17,0)
UPH3(X) ; Phone Number #3          .13;3    DBIA 10060
"RTN","GMTSU2",18,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.133)
"RTN","GMTSU2",19,0)
UPH4(X) ; Phone Number #4          .13;4    DBIA 10060
"RTN","GMTSU2",20,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.134)
"RTN","GMTSU2",21,0)
UCPH(X) ; Commercial Phone         .13;5    DBIA 10060
"RTN","GMTSU2",22,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.135)
"RTN","GMTSU2",23,0)
UFAX(X) ; Fax Number               .13;6    DBIA 10060
"RTN","GMTSU2",24,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.136)
"RTN","GMTSU2",25,0)
UAPG(X) ; Analog Pager             .13;7    DBIA 10060
"RTN","GMTSU2",26,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.137)
"RTN","GMTSU2",27,0)
UDPG(X) ; Digital Pager            .13;8    DBIA 10060
"RTN","GMTSU2",28,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(200,+($G(X)),.138)
"RTN","GMTSU2",29,0)
 ; Patient
"RTN","GMTSU2",30,0)
PAT(X) ; Is a patient (1 yes 0 no)  0;1    DBIA 10035
"RTN","GMTSU2",31,0)
 N GMTS Q:+($G(X))=0 "" S GMTS=$$PNAM(+($G(X))),X=$S($L(GMTS)>0:1,1:0) Q X
"RTN","GMTSU2",32,0)
PNAM(X) ; Patient Name               0;1    DBIA 10035
"RTN","GMTSU2",33,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(2,+($G(X)),.01)
"RTN","GMTSU2",34,0)
PMAR(X) ; Patient Marital Status     0;5    DBIA 10035
"RTN","GMTSU2",35,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(2,+($G(X)),.05)
"RTN","GMTSU2",36,0)
PWAR(X) ; Patient has a Ward Location
"RTN","GMTSU2",37,0)
 N GMTS Q:+($G(X))=0 "" S GMTS=PWLC(X),X=$S($L(GMTS):1,1:0) Q X
"RTN","GMTSU2",38,0)
PWLC(X) ; Ward Location
"RTN","GMTSU2",39,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(2,+($G(X)),.1)
"RTN","GMTSU2",40,0)
PDIS(X,ARY) ; Rated Disabilties       .372;0    DBIA 10035
"RTN","GMTSU2",41,0)
 Q:+($G(X))=0 "" N GMTSI,GMTSC,GMTSR,GMTSD,GMTSS S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^DPT(+($G(X)),.372,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSU2",42,0)
 . S GMTSR=$$GET1^DIQ(2.04,(GMTSI_","_+($G(X))_","),.01),GMTSD=$$GET1^DIQ(2.04,(GMTSI_","_+($G(X))_","),2),GMTSS=$$GET1^DIQ(2.04,(GMTSI_","_+($G(X))_","),3),GMTSC=GMTSC+1,ARY(GMTSC)=GMTSR_"^"_GMTSD_"^"_GMTSS
"RTN","GMTSU2",43,0)
 S X=+($G(GMTSC)) S:X>0 ARY(0)=X,ARY="Rated Disabilities (VA)^Disability Percent^Service Connected" Q X
"RTN","GMTSU2",44,0)
PLAB(X) ; Lab Patient                      LR;1   DBIA 10035
"RTN","GMTSU2",45,0)
 Q:+($G(X))=0 "" Q $$GET1^DIQ(2,+($G(X)),63)
"RTN","GMTSU2",46,0)
 ; Health Summary
"RTN","GMTSU2",47,0)
MSIT(X) Q $$EN^GMTSUMX($$SITE)
"RTN","GMTSU2",48,0)
SITE(X) ; Site
"RTN","GMTSU2",49,0)
 N SITE,INTG,PRIM S U="^",X="" S SITE=$$KSP^XUPARAM("INST"),SITE=$$UP^XLFSTR($$GET1^DIQ(4,+($G(SITE)),.01)),INTG=$$UP^XLFSTR($$NAME^VASITE($$NOW^XLFDT)),PRIM=$$UP^XLFSTR($P($$SITE^VASITE($$NOW^XLFDT),"^",2))
"RTN","GMTSU2",50,0)
 S:$L(SITE)&(PRIM=SITE) PRIM="" S:'$L(SITE)&($L(PRIM)) SITE=PRIM,PRIM="" I $L(SITE) S X=SITE S:$L(INTG)&(INTG'=SITE) X=INTG_" ("_SITE_")"
"RTN","GMTSU2",51,0)
 S:'$L(SITE)&($L(INTG)) X=INTG
"RTN","GMTSU2",52,0)
 Q X
"RTN","GMTSU2",53,0)
TSIT(X) ; Site
"RTN","GMTSU2",54,0)
 N SITE S U="^",X=""
"RTN","GMTSU2",55,0)
 S SITE=$$KSP^XUPARAM("INST"),SITE=$$UP^XLFSTR($$GET1^DIQ(4,+($G(SITE)),.01))
"RTN","GMTSU2",56,0)
 S X=SITE Q X
"RTN","GMTSUIX")
0^8^B17314276
"RTN","GMTSUIX",1,0)
GMTSUIX ; SLC/KER - Health Summary Set/Kill Indexes        ; 05/08/2001
"RTN","GMTSUIX",2,0)
 ;;2.7;Health Summary;**30,32,29**;Oct 20, 1995
"RTN","GMTSUIX",3,0)
 ;;
"RTN","GMTSUIX",4,0)
 Q
"RTN","GMTSUIX",5,0)
STNT ; Set word indexes for Health Summary Type NAME and TITLE
"RTN","GMTSUIX",6,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD S GMTSTR=$G(X) Q:'$L(GMTSTR)  S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",7,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",8,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",9,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",10,0)
 . . . S @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")=""
"RTN","GMTSUIX",11,0)
 Q
"RTN","GMTSUIX",12,0)
KTNT ; Kill word indexes for Health Summary Type NAME and TITLE
"RTN","GMTSUIX",13,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD S GMTSTR=$G(X) Q:'$L(GMTSTR)  S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",14,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",15,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",16,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",17,0)
 . . . K @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")
"RTN","GMTSUIX",18,0)
 Q
"RTN","GMTSUIX",19,0)
STO ; Set word indexes for Health Summary Type OWNER
"RTN","GMTSUIX",20,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD
"RTN","GMTSUIX",21,0)
 S GMTSTR=+($G(X)) Q:GMTSTR'>0  Q:GMTSTR>0&(GMTSTR<1)  S GMTSTR=$P($G(^VA(200,+GMTSTR,0)),U,1) Q:'$L(GMTSTR)  S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",22,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",23,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",24,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",25,0)
 . . . S @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")=""
"RTN","GMTSUIX",26,0)
 Q
"RTN","GMTSUIX",27,0)
KTO ; Kill word indexes for Health Summary Type OWNER
"RTN","GMTSUIX",28,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD
"RTN","GMTSUIX",29,0)
 S GMTSTR=+($G(X)) Q:GMTSTR'>0  Q:GMTSTR>0&(GMTSTR<1)  S GMTSTR=$P($G(^VA(200,+GMTSTR,0)),U,1) Q:'$L(GMTSTR)  S GMTSIEN=+($G(DA)) Q:+GMTSIEN=0
"RTN","GMTSUIX",30,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",31,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",32,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",33,0)
 . . . K @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN_")")
"RTN","GMTSUIX",34,0)
 Q
"RTN","GMTSUIX",35,0)
STL ; Set word indexes for Health Summary Type LOCATION
"RTN","GMTSUIX",36,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD,GMTSIEN1,GMTSIEN2 S GMTSTR=$P($G(^SC(+($G(X)),0)),U,1) Q:'$L(GMTSTR)  S GMTSIEN1=+($G(DA(1))) Q:+GMTSIEN1=0  S GMTSIEN2=+($G(DA)) Q:+GMTSIEN2=0
"RTN","GMTSUIX",37,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",38,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",39,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",40,0)
 . . .S @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN1_","_GMTSIEN2_")")=""
"RTN","GMTSUIX",41,0)
 Q
"RTN","GMTSUIX",42,0)
KTL ; Kill word indexes for Health Summary Type LOCATION
"RTN","GMTSUIX",43,0)
 N GMTSTR,GMTSIEN,GMTSPSN,GMTSCNT,GMTSWORD,GMTSIEN1,GMTSIEN2 S GMTSTR=$P($G(^SC(+($G(X)),0)),U,1) Q:'$L(GMTSTR)  S GMTSIEN1=+($G(DA(1))) Q:+GMTSIEN1=0  S GMTSIEN2=+($G(DA)) Q:+GMTSIEN2=0
"RTN","GMTSUIX",44,0)
 S GMTSCNT=1 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSUIX",45,0)
 . S GMTSWORD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWORD D
"RTN","GMTSUIX",46,0)
 . . S GMTSWORD=$TR($E($E(GMTSTR,GMTSCNT,GMTSPSN-1),1,30),"""",""),GMTSCNT=GMTSPSN+1 I $L(GMTSWORD)>0 D
"RTN","GMTSUIX",47,0)
 . . . K @("^GMT(142,""AW"","""_$$UP(GMTSWORD)_""","_GMTSIEN1_","_GMTSIEN2_")")
"RTN","GMTSUIX",48,0)
 Q
"RTN","GMTSUIX",49,0)
RXT ; Re-index Health Summary Type file #142
"RTN","GMTSUIX",50,0)
 W:'$D(GMTSQ) !,"Re-indexing Health Summary Type file #142"
"RTN","GMTSUIX",51,0)
 N DIK,DA,IX S DA=0 F  S DA=$O(^GMT(142,DA)) Q:+DA=0  D
"RTN","GMTSUIX",52,0)
 . S IX="~" F  S IX=$O(^GMT(142,DA,1,IX),-1) Q:+IX>0!(IX="")  I IX="0" K:$E(IX,1)?1U!($E(IX,1)?1L) ^GMT(142,DA,1,IX)
"RTN","GMTSUIX",53,0)
 . S IX="~" F  S IX=$O(^GMT(142,DA,20,IX),-1) Q:+IX>0!(IX="")  I IX="0" K:$E(IX,1)?1U!($E(IX,1)?1L) ^GMT(142,DA,20,IX)
"RTN","GMTSUIX",54,0)
 S IX="~" F  S IX=$O(^GMT(142,IX),-1) Q:+IX>0!(IX="")  I IX'="0" K:$E(IX,1)?1U!($E(IX,1)?1L) ^GMT(142,IX)
"RTN","GMTSUIX",55,0)
 W:'$D(GMTSQ) ! S DA=0 F  S DA=$O(^GMT(142,DA)) Q:+DA=0  S DIK="^GMT(142," D IX1^DIK W:'$D(GMTSQ) "."
"RTN","GMTSUIX",56,0)
 Q
"RTN","GMTSUIX",57,0)
UP(X) ; Uppercase
"RTN","GMTSUIX",58,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSUIX",59,0)
TRIM(X) ; Trim Spaces
"RTN","GMTSUIX",60,0)
 S X=$G(X) Q:X="" X F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSUIX",61,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSUIX",62,0)
 F  Q:X'["  "  S X=$P(X,"  ",1)_" "_$P(X,"  ",2,229)
"RTN","GMTSUIX",63,0)
 Q X
"RTN","GMTSULT")
0^3^B66395334
"RTN","GMTSULT",1,0)
GMTSULT ; SLC/KER - HS Type Lookup                      ; 05/08/2001
"RTN","GMTSULT",2,0)
 ;;2.7;Health Summary;**30,35,29**;Oct 20, 1995
"RTN","GMTSULT",3,0)
 ;;
"RTN","GMTSULT",4,0)
 N DIC,DTOUT,DUOUT,DIRUT D DICHK S DIC(0)="AEMQZ" S Y=$$TYPE^GMTSULT Q
"RTN","GMTSULT",5,0)
EN ; Lookup (general)
"RTN","GMTSULT",6,0)
 Q:$G(DIC(0))["I"
"RTN","GMTSULT",7,0)
 K DTOUT,DUOUT N GMTSDICW,GMTSDICS,GMTSDIC,GMTSLGO,GMTSDIC0,GMTSDICB,GMTSDEF,GMTSWY,GMTSDISV,GMTSDICA,GMTSLERR,GMTSE,GMTSQ,GMTSX,DIR,DIRUT,DIROUT,GMTS
"RTN","GMTSULT",8,0)
 S GMTSE=$$ECHO D LD S U="^"
"RTN","GMTSULT",9,0)
 S (GMTSDEF,GMTSQ)=0,GMTSX=$G(X) S:$L(GMTSDIC0)&(GMTSDIC0'["A") GMTSQ=1 K Y
"RTN","GMTSULT",10,0)
 ; Get X
"RTN","GMTSULT",11,0)
 ;   Ask the entry          DIC(0)["A" (INPUT^GMTSULT5)
"RTN","GMTSULT",12,0)
 S:GMTSDIC0'["A"&($L(GMTSX)) X=GMTSX
"RTN","GMTSULT",13,0)
 K GMTSLERR S:GMTSDIC0["A"!('$L(GMTSX)) X=$$INPUT^GMTSULT5
"RTN","GMTSULT",14,0)
 I $D(DTOUT)!($D(DUOUT)) S Y=-1 S:$D(DTOUT) DTOUT=1 S:$D(DUOUT) DUOUT=1 Q
"RTN","GMTSULT",15,0)
 ;   Is X an IEN            From Spacebar-Return
"RTN","GMTSULT",16,0)
 I +($$XIEN(X))>0 D  Q
"RTN","GMTSULT",17,0)
 . K Y S Y=+($$XIEN(X))
"RTN","GMTSULT",18,0)
 . D Y^GMTSULT6(+Y),RD,CLR
"RTN","GMTSULT",19,0)
 . I ($G(GMTSDIC0)["Q"!($G(DIC(0))["Q")),+($G(Y))<0 W " ??"
"RTN","GMTSULT",20,0)
 ;   No Input or Error      X="" or X["^" or '$D(X)
"RTN","GMTSULT",21,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT))!($G(X)="")!($G(X)["^") D  Q
"RTN","GMTSULT",22,0)
 . K Y W !!,?5 W:'$L($G(GMTSLERR)) "No Health Summary Type selected"
"RTN","GMTSULT",23,0)
 . W:$L($G(GMTSLERR)) GMTSLERR W ! S Y=-1 D RD,CLR
"RTN","GMTSULT",24,0)
 ;   Exact Match Required   DIC(0)["X"
"RTN","GMTSULT",25,0)
 I GMTSDIC0["X",$L(X) D  Q
"RTN","GMTSULT",26,0)
 . K Y S Y=-1,GMTSX=$$EM^GMTSULT2(X) D:+GMTSX>0 Y^GMTSULT6(+GMTSX) D RD,CLR
"RTN","GMTSULT",27,0)
 ; Select
"RTN","GMTSULT",28,0)
 ;   Get Selection List
"RTN","GMTSULT",29,0)
 D LIST^GMTSULT2(X)
"RTN","GMTSULT",30,0)
 ;   Select from multiple entries
"RTN","GMTSULT",31,0)
 D:+($G(^TMP("GMTSULT",$J,0)))>1 MULTI^GMTSULT6
"RTN","GMTSULT",32,0)
 ;   Select from one entry
"RTN","GMTSULT",33,0)
 D:+($G(^TMP("GMTSULT",$J,0)))=1 ONE^GMTSULT6
"RTN","GMTSULT",34,0)
 S:'$D(Y)!(+($G(Y))'>0) Y=-1
"RTN","GMTSULT",35,0)
 ; DLAYGO allowed
"RTN","GMTSULT",36,0)
 ;   Add entry
"RTN","GMTSULT",37,0)
 I $L(X),Y=-1,$G(GMTSDIC0)["L",+($G(GMTSLGO))=142 D
"RTN","GMTSULT",38,0)
 . Q:$L(X)<3!($L(X)>30)  K Y(0) N DLAYGO,GMTSOD0,GMTSOX S GMTSOD0=DIC(0),GMTSOX=X
"RTN","GMTSULT",39,0)
 . N X,DA,DIC,DIK S DIC(0)="LM",(DIK,DIC)="^GMT(142,",DLAYGO=142,X=GMTSOX
"RTN","GMTSULT",40,0)
 . L +^GMT(142):2 W:'$T !,"  Can not add Health Summary Type, the file is in ",!,"  use by another user.  Please try again later."
"RTN","GMTSULT",41,0)
 . D:$T ADD L -^GMT(142) S (GMTSDIC0,DIC(0))=GMTSOD0
"RTN","GMTSULT",42,0)
 D RD,CLR
"RTN","GMTSULT",43,0)
 Q
"RTN","GMTSULT",44,0)
ADD ;   Add Health Summary Type
"RTN","GMTSULT",45,0)
 N GMTSOK,GMTSU,GMTSD,GMTSMSG S GMTSMSG=$$MSG
"RTN","GMTSULT",46,0)
 ; DBIA 10060 call $$GET1^DIQ
"RTN","GMTSULT",47,0)
 S GMTSU=$$GET1^DIQ(200,+($G(DUZ)),.01) I '$L(GMTSU) D  S Y=-1 Q
"RTN","GMTSULT",48,0)
 . W !!,"  Undefined/Invalid User",!
"RTN","GMTSULT",49,0)
 ; DBIA 10060 call $$GET1^DIQ
"RTN","GMTSULT",50,0)
 S GMTSU=+($$GET1^DIQ(200,+($G(DUZ)),9.2,"I")),GMTSD=$$NOW^XLFDT
"RTN","GMTSULT",51,0)
 I GMTSU>0&(GMTSU<GMTSD) D  S Y=-1 Q
"RTN","GMTSULT",52,0)
 . W !!,"  Terminated Users may not add a Health Summary",!
"RTN","GMTSULT",53,0)
 S GMTSOK=+($$ASKA(X)) Q:'GMTSOK
"RTN","GMTSULT",54,0)
 S DA=$$DA I DA'>0!($D(^GMT(142,DA))) S Y=-1 Q
"RTN","GMTSULT",55,0)
 S $P(^GMT(142,DA,0),"^",1)=X,$P(^GMT(142,DA,0),"^",3)=+($G(DUZ))
"RTN","GMTSULT",56,0)
 D SI I '$D(^GMT(142,"B",$E(X,1,30),DA)) D KI K ^GMT(142,DA) S Y=-1 Q
"RTN","GMTSULT",57,0)
 S Y=DA_"^"_X_"^1"
"RTN","GMTSULT",58,0)
 Q
"RTN","GMTSULT",59,0)
DA(X) ;    Get IEN
"RTN","GMTSULT",60,0)
 S X=$O(^GMT(142,"4999999"),-1) F  Q:'$D(^GMT(142,X))  S X=X+1
"RTN","GMTSULT",61,0)
 Q:X<5000000 X  Q:X>5000999 X
"RTN","GMTSULT",62,0)
 S X=$O(^GMT(142,"!"),-1) F  Q:'$D(^GMT(142,X))  S X=X+1
"RTN","GMTSULT",63,0)
 S:X>4999999&(X<6000000) X=6000000 Q X
"RTN","GMTSULT",64,0)
ET(T) ;    Error Text
"RTN","GMTSULT",65,0)
 I $D(DIEV0) D  Q:+($G(DIQUIET))>0
"RTN","GMTSULT",66,0)
 . N I,E,A S I=+($G(DIERR)) S:I=0 I=1 S A=$G(GMTSMSG) S:A="" A="GMTSE" S E=$O(@(A_"(""GMTSERR"","_I_","" "")"),-1)+1,@(A_"(""GMTSERR"","_I_","_+E_")")=$G(T),@(A_"(""GMTSENV"")")=1
"RTN","GMTSULT",67,0)
 Q:$D(GMTSETQ)  N %,X,Y,Z,I,DIW,DIWF,DIWL,DIWR,DIWT,DN S X=T,DIWL=6,DIWR=78,DIWF="W" D ^DIWP D:$D(^UTILITY($J)) ^DIWW W ?5 Q
"RTN","GMTSULT",68,0)
BL ; Blank Line
"RTN","GMTSULT",69,0)
 Q:+($G(DIQUIET))>0  Q:$D(GMTSETQ)  W !,?5 Q
"RTN","GMTSULT",70,0)
MSG() ;
"RTN","GMTSULT",71,0)
 Q:$L($G(DIMSG)) $G(DIMSG) Q:$L($G(DIMSGA)) $G(DIMSGA) Q:$L($G(DIOUTAR)) $G(DIOUTAR) Q:$L($G(DIEFOUT)) $G(DIEFOUT) Q:$L($G(GMTSMS)) $G(GMTSMS)
"RTN","GMTSULT",72,0)
 Q "TMP"
"RTN","GMTSULT",73,0)
ASKA(X) ; Ask if adding
"RTN","GMTSULT",74,0)
 N GMTSN,GMTSNX S GMTSN=$G(X) Q:'$L(X) 0
"RTN","GMTSULT",75,0)
 N DIR,DTOUT,DIROUT,DIRUT,DUOUT S GMTSNX=+($$N)+1,GMTSNX=$S(GMTSNX=0:"",GMTSNX=1:(GMTSNX_"st"),GMTSNX=2:(GMTSNX_"nd"),GMTSNX=3:(GMTSNX_"rd"),1:(GMTSNX_"th"))
"RTN","GMTSULT",76,0)
 S DIR(0)="YAO",DIR("A",1)="Are you adding '"_GMTSN_"' as ",DIR("A")="    a new HEALTH SUMMARY TYPE"_$S($L(GMTSNX):(" (the "_GMTSNX_")"),1:"")_"?   ",DIR("B")="No"
"RTN","GMTSULT",77,0)
 W ! D ^DIR S:$D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) X="^" S:X["^" X="^" Q:X="^" 0
"RTN","GMTSULT",78,0)
 S X=+($G(Y)) S:+X'>0 X=0 Q X
"RTN","GMTSULT",79,0)
N(X) ; Number of Types
"RTN","GMTSULT",80,0)
 N I S (I,X)=0 F  S I=$O(^GMT(142,I)) Q:+I=0  S X=X+1
"RTN","GMTSULT",81,0)
 Q X
"RTN","GMTSULT",82,0)
SI ;   Set Indexes
"RTN","GMTSULT",83,0)
 D MS N GMTSIEN,GMTSIX,GMTSOX,GMTSCD S GMTSIEN=+($G(DA)),GMTSOX=$G(X) Q:GMTSIEN'>0  Q:'$D(^GMT(142,GMTSIEN,0))  Q:'$L(X)  N X,DA
"RTN","GMTSULT",84,0)
 S DA=GMTSIEN,GMTSIX=0 F  S GMTSIX=$O(^TMP($J,142,.01,1,GMTSIX)) Q:+GMTSIX=0  D
"RTN","GMTSULT",85,0)
 . S X=$G(^TMP($J,142,.01,1,GMTSIX,1)) D ^DIM Q:'$D(X)  S GMTSCD=X,X=GMTSOX,DA=GMTSIEN X GMTSCD
"RTN","GMTSULT",86,0)
 D MK Q
"RTN","GMTSULT",87,0)
KI ;   Kill Indexes
"RTN","GMTSULT",88,0)
 D MS N GMTSIEN,GMTSIX,GMTSOX,GMTSCD S GMTSIEN=+($G(DA)),GMTSOX=$G(X) N X,DA
"RTN","GMTSULT",89,0)
 S DA=GMTSIEN,GMTSIX=0 F  S GMTSIX=$O(^TMP($J,142,.01,1,GMTSIX)) Q:+GMTSIX=0  D
"RTN","GMTSULT",90,0)
 . S X=$G(^TMP($J,142,.01,1,GMTSIX,2)) D ^DIM Q:'$D(X)
"RTN","GMTSULT",91,0)
 . S GMTSCD=X,X=GMTSOX W !,GMTSCD,?60,X,?70,DA
"RTN","GMTSULT",92,0)
 D MK Q
"RTN","GMTSULT",93,0)
MS ;   Merge Set
"RTN","GMTSULT",94,0)
 M ^TMP($J,142,.01,1)=@("^DD("_142_",.01,1)") Q
"RTN","GMTSULT",95,0)
MK ;   Merge Kill
"RTN","GMTSULT",96,0)
 K ^TMP($J,142,.01,1) Q
"RTN","GMTSULT",97,0)
TYPE(GMTSI) ; Get Health Summary Type
"RTN","GMTSULT",98,0)
 ;  S Y=$$TYPE^GMTSULT
"RTN","GMTSULT",99,0)
 ;  Mandatory Preset Variables DIC(0)
"RTN","GMTSULT",100,0)
 ;  Optional Preset Variables DIC("A"), DIC("B"), DLAYGO
"RTN","GMTSULT",101,0)
 ;  Returns the IEN of the Health Summary Type
"RTN","GMTSULT",102,0)
 K Y S:$L($G(X)) X=$G(X)
"RTN","GMTSULT",103,0)
 D EN^GMTSULT S GMTSI=-1 S:+($G(Y))>0&($D(^GMT(142,+($G(Y)),0))) GMTSI=$G(Y) Q GMTSI
"RTN","GMTSULT",104,0)
XIEN(X) ; Is X in a Y or `IEN format  Quit +IEN
"RTN","GMTSULT",105,0)
 N GMTSX,GMTSL,GMTSI,GMTSNAM,GMTSY,GMTSOK
"RTN","GMTSULT",106,0)
 S GMTSX=$G(X),GMTSL=$E(GMTSX,1),GMTSI=$E(GMTSX,2,$L(GMTSX))
"RTN","GMTSULT",107,0)
 S GMTSOK=$$DICS^GMTSULT2($G(GMTSDICS),$P($G(^GMT(142,+GMTSI,0)),"^",1),+GMTSI) Q:'GMTSOK -1
"RTN","GMTSULT",108,0)
 I GMTSL="`",+GMTSI>0,+GMTSI=GMTSI,$D(^GMT(142,+GMTSI,0)),$L($P($G(^GMT(142,+GMTSI,0)),"^",1)) S X=GMTSI Q X
"RTN","GMTSULT",109,0)
 S GMTSI=$S($D(^GMT(142,+GMTSX,0)):+X,1:-1)
"RTN","GMTSULT",110,0)
 S GMTSNAM=$P($G(^GMT(142,+GMTSX,0)),"^",1)
"RTN","GMTSULT",111,0)
 I GMTSI=+GMTSX&(GMTSNAM=$P(GMTSX,"^",2)) S X=GMTSI Q X
"RTN","GMTSULT",112,0)
 Q 0
"RTN","GMTSULT",113,0)
LD ; Load DIC Variables
"RTN","GMTSULT",114,0)
 D DICHK S (DIC,GMTSDIC)="^GMT(142,",GMTSDIC0="AEM" S:$L($G(DLAYGO)) GMTSLGO=$G(DLAYGO) S GMTSDICA="Select HEALTH SUMMARY TYPE:  " K Y
"RTN","GMTSULT",115,0)
 S:$L($G(DIC("W"))) GMTSDICW=DIC("W") S:$L($G(DIC("S"))) GMTSDICS=DIC("S") S:$L($G(DIC("A"))) GMTSDICA=DIC("A") S:$L($G(DIC("B"))) GMTSDICB=DIC("B") S:$L($G(DIC(0))) GMTSDIC0=DIC(0)
"RTN","GMTSULT",116,0)
 Q
"RTN","GMTSULT",117,0)
 ; Lookup Screens - DIC("S")="I +$$..
"RTN","GMTSULT",118,0)
EOK(X) ;   Edit OK
"RTN","GMTSULT",119,0)
 N OK,GMTS S X=+($G(X)),OK=1 S:'$D(^GMT(142,+X,0)) OK=0 S:$P($G(^GMT(142,+X,"VA")),U)=2 OK=0 S X=OK Q X
"RTN","GMTSULT",120,0)
EST(X) ;   Edit Health Summary Type (other than Adhoc)
"RTN","GMTSULT",121,0)
 N GMTSI,GMTSO,GMTS S X=+($G(X))
"RTN","GMTSULT",122,0)
 ; Invalid User
"RTN","GMTSULT",123,0)
 Q:'$L($P($G(^VA(200,+($G(DUZ)),0)),U)) 0 Q:+($G(DUZ(2)))=0 0
"RTN","GMTSULT",124,0)
 ; Invalid Type
"RTN","GMTSULT",125,0)
 S GMTSI=$P($G(^GMT(142,+X,0)),U) Q:GMTSI="GMTS HS ADHOC OPTION"!(GMTSI="GMTS HS REMOTE ADHOC OPTION") 0
"RTN","GMTSULT",126,0)
 ; National Uneditable/Developer
"RTN","GMTSULT",127,0)
 S GMTSI=+($P($G(^GMT(142,+X,"VA")),U)),GMTSO=$G(^XMB("NETNAME")) Q:GMTSI=2&'(GMTSO["ISC-SLC"&(+($G(DUZ(2)))=5000)) 0 Q:GMTSI=2&(GMTSO["ISC-SLC"&(+($G(DUZ(2)))=5000)) 1
"RTN","GMTSULT",128,0)
 ; Owner
"RTN","GMTSULT",129,0)
 S GMTSI=+($P($G(^GMT(142,+X,0)),U,3)) Q:GMTSI>0&(GMTSI=+($G(DUZ))) 1
"RTN","GMTSULT",130,0)
 ; Locked from Edit
"RTN","GMTSULT",131,0)
 S GMTSI=$P($G(^GMT(142,+X,0)),U,2),GMTSO=0 S:$L(GMTSI) GMTSO=$S(((+($G(DUZ))>0)&('$D(^XUSEC(GMTSI,+($G(DUZ)))))):1,1:0) Q:GMTSO=1 0
"RTN","GMTSULT",132,0)
 ; Not the Owner, but Other Editor
"RTN","GMTSULT",133,0)
 S GMTSI=+($P($G(^GMT(142,+X,0)),U,3)),GMTSO=$D(^GMT(142,+X,2,"B",+($G(DUZ)))) Q:GMTSI>0&(+($G(DUZ))>0)&(GMTSI'=+($G(DUZ)))&(+GMTSO>0) 1
"RTN","GMTSULT",134,0)
 ; Not the Owner
"RTN","GMTSULT",135,0)
 S GMTSI=+($P($G(^GMT(142,+X,0)),U,3)) Q:GMTSI>0&(GMTSI'=+($G(DUZ))) 0
"RTN","GMTSULT",136,0)
 ; Has the Key
"RTN","GMTSULT",137,0)
 S GMTSI=$P($G(^GMT(142,+X,0)),U,2),GMTSO=0 S:$L(GMTSI) GMTSO=$S(((+($G(DUZ))>0)&($D(^XUSEC(GMTSI,+($G(DUZ)))))):1,1:0) Q:GMTSO=1 1
"RTN","GMTSULT",138,0)
 Q 1
"RTN","GMTSULT",139,0)
HST(X) ;   Health Summary Type
"RTN","GMTSULT",140,0)
 N GMTS S X=+($G(X)),GMTS=1 S:$P($G(^GMT(142,+X,0)),U)="GMTS HS ADHOC OPTION" GMTS=0 S:$P($G(^GMT(142,+X,0)),U)="GMTS HS REMOTE ADHOC OPTION" GMTS=0 S:+($G(^GMT(142,+X,"VA")))>0 GMTS=0
"RTN","GMTSULT",141,0)
 S X=GMTS Q X
"RTN","GMTSULT",142,0)
AHST(X) ;   Add Health Summary Type
"RTN","GMTSULT",143,0)
 N GMTS S X=+($G(X)),GMTS=1 S:$P($G(^GMT(142,+X,0)),U)="GMTS HS ADHOC OPTION" GMTS=0 S:$P($G(^GMT(142,+X,0)),U)="GMTS HS REMOTE ADHOC OPTION" GMTS=0
"RTN","GMTSULT",144,0)
 S:((+X>4999999)&(+X<6000000)) GMTS=0 S:+($G(^GMT(142,+X,"VA")))>0 GMTS=0
"RTN","GMTSULT",145,0)
 S X=GMTS Q X
"RTN","GMTSULT",146,0)
ADH(X) ;   Adhoc Health Summary
"RTN","GMTSULT",147,0)
 N GMTS S X=+($G(X)),GMTS=1 S:$P($G(^GMT(142,+X,0)),U)'="GMTS HS ADHOC OPTION" GMTS=0 S X=GMTS Q X
"RTN","GMTSULT",148,0)
REM(X) ;   Remote Adhoc Health Summary
"RTN","GMTSULT",149,0)
 N GMTS S X=+($G(X)),GMTS=1 S:$P($G(^GMT(142,+X,0)),U)'="GMTS HS REMOTE ADHOC OPTION" GMTS=0 S X=GMTS Q X
"RTN","GMTSULT",150,0)
 Q
"RTN","GMTSULT",151,0)
DICHK ; Check DIC variables
"RTN","GMTSULT",152,0)
 N GMTSDISV,GMTSUSR,GMTSB
"RTN","GMTSULT",153,0)
 K DIC("DR"),DIC("P"),DIC("V"),DINUM,DTOUT,DUOUT
"RTN","GMTSULT",154,0)
 S GMTSUSR=+($G(DUZ)),GMTSDISV=+($$RDISV)
"RTN","GMTSULT",155,0)
 S GMTSB=$P($G(^GMT(142,+GMTSDISV,0)),"^",1)
"RTN","GMTSULT",156,0)
 S:'$L($G(DIC(0))) DIC(0)="AEMZB" S:'$L($G(DIC)) DIC="^GMT(142,"
"RTN","GMTSULT",157,0)
 I +($G(GMTSE))=0 F  Q:DIC(0)'["E"  S DIC(0)=$P(DIC(0),"E",1)_$P(DIC(0),"E",2)
"RTN","GMTSULT",158,0)
 S:'$L($G(DIC("A"))) DIC("A")="Select HEALTH SUMMARY TYPE:  "
"RTN","GMTSULT",159,0)
 Q
"RTN","GMTSULT",160,0)
RD ; Restore DIC Variables
"RTN","GMTSULT",161,0)
 S:$L($G(GMTSDIC)) DIC=GMTSDIC S:$L($G(GMTSDICS)) DIC("S")=GMTSDICS
"RTN","GMTSULT",162,0)
 S:$L($G(GMTSDICW)) DIC("W")=GMTSDICW S:$L($G(GMTSDICA)) DIC("A")=GMTSDICA S:$L($G(GMTSDICB)) DIC("B")=GMTSDICB S:$L($G(GMTSDIC0)) DIC(0)=GMTSDIC0
"RTN","GMTSULT",163,0)
 I $L($G(X)),X["`" D
"RTN","GMTSULT",164,0)
 . N GMTSI,GMTSL S GMTSL=$E(X,1),GMTSI=$E(X,2,$L(X))
"RTN","GMTSULT",165,0)
 . I GMTSL="`",+GMTSI>0,$D(^GMT(142,+GMTSI,0)),$L($P($G(^GMT(142,+GMTSI,0)),"^",1)) S X=$P($G(^GMT(142,+GMTSI,0)),"^",1)
"RTN","GMTSULT",166,0)
 K GMTSDICS,GMTSDIC,GMTSDIC0,GMTSDICB,GMTSDISV,GMTSDICA Q
"RTN","GMTSULT",167,0)
ECHO(X) ; Echo Results (writes/reads)
"RTN","GMTSULT",168,0)
 S X=$$ROK("XWBLIB") Q:'X 1 S X=$$BROKER^XWBLIB Q:X 0 Q 1
"RTN","GMTSULT",169,0)
SDISV(Y) ; Set DISV (IEN)
"RTN","GMTSULT",170,0)
 Q:+($G(DUZ))=0!(+($G(Y))=0)
"RTN","GMTSULT",171,0)
 ; DBIA 2055 call RECALL^DILFD
"RTN","GMTSULT",172,0)
 D RECALL^DILFD(142,+($G(Y))_",",+($G(DUZ))) Q
"RTN","GMTSULT",173,0)
RDISV(X) ; Read DISV
"RTN","GMTSULT",174,0)
 Q:+($G(DUZ))=0 ""
"RTN","GMTSULT",175,0)
 N DIC,Y S DIC=142,DIC(0)="Z",X=" " D ^DIC S X=$S(+Y>0:Y,1:"")
"RTN","GMTSULT",176,0)
 Q X
"RTN","GMTSULT",177,0)
ROK(X) ; Routine OK (in UCI)
"RTN","GMTSULT",178,0)
 S X=$G(X) Q:'$L(X) 0 Q:$L(X)>8 0 X ^%ZOSF("TEST") Q:$T 1 Q 0
"RTN","GMTSULT",179,0)
CLR ;   Kill all global arrays used (this session)
"RTN","GMTSULT",180,0)
 K ^TMP("GMTSULT",$J),^TMP("GMTSULT2",$J) Q
"RTN","GMTSULT",181,0)
CLEAN ;   Kill temporary global array used
"RTN","GMTSULT",182,0)
 K ^TMP("GMTSULT2",$J) Q
"RTN","GMTSULT",183,0)
 ; Miscellaneous
"RTN","GMTSULT2")
0^5^B36669012
"RTN","GMTSULT2",1,0)
GMTSULT2 ; SLC/KER - HS Type Lookup (Search/List)   ; 05/08/2001
"RTN","GMTSULT2",2,0)
 ;;2.7;Health Summary;**30,32,35,29**;Oct 20, 1995
"RTN","GMTSULT2",3,0)
 ;
"RTN","GMTSULT2",4,0)
 Q
"RTN","GMTSULT2",5,0)
LIST(X) ; Get global array of Health Summary Types
"RTN","GMTSULT2",6,0)
 ;                      
"RTN","GMTSULT2",7,0)
 ;  LIST^GMTSULT2(<search string>)
"RTN","GMTSULT2",8,0)
 ;                      
"RTN","GMTSULT2",9,0)
 ;  ^TMP("GMTSULT",$J,#)
"RTN","GMTSULT2",10,0)
 ;                    
"RTN","GMTSULT2",11,0)
 ;     Piece 1 =  Internal Entry Number (IEN) in file 142
"RTN","GMTSULT2",12,0)
 ;     Piece 2 =  Health Summary Type Name
"RTN","GMTSULT2",13,0)
 ;     Piece 3 =  Health Summary Type Title
"RTN","GMTSULT2",14,0)
 ;     Piece 4 =  Health Summary Type Owner
"RTN","GMTSULT2",15,0)
 ;     Piece 5 =  Location Using Health Summary Type
"RTN","GMTSULT2",16,0)
 ;     Piece 6 =  Number of Components in Summary Type
"RTN","GMTSULT2",17,0)
 ;     Piece 7 =  Recommended Display Text (for 
"RTN","GMTSULT2",18,0)
 ;                selection or list box)
"RTN","GMTSULT2",19,0)
 ;                      
"RTN","GMTSULT2",20,0)
 ;  List Builder can use variable DIC("S") and DIC(0)
"RTN","GMTSULT2",21,0)
 ;                      
"RTN","GMTSULT2",22,0)
 ;     DIC("S") Screen out entries for selection/list
"RTN","GMTSULT2",23,0)
 ;                      
"RTN","GMTSULT2",24,0)
 ;     Processes DIC(0) N, OE (combination),X or B
"RTN","GMTSULT2",25,0)
 ;                      
"RTN","GMTSULT2",26,0)
 ;     Does not process DIC(0) components C or M.  Cross
"RTN","GMTSULT2",27,0)
 ;     reference suppression (C) is automatic in a multi-
"RTN","GMTSULT2",28,0)
 ;     term lookup, and the use of multiple indexes is
"RTN","GMTSULT2",29,0)
 ;     implied in the lookup and DD file structure.
"RTN","GMTSULT2",30,0)
 ;                      
"RTN","GMTSULT2",31,0)
 D CLR^GMTSULT N GMTSEO,GMTSEQ,GMTSIF,GMTSBI,GMTSIEN,GMTSWRDS,GMTSDS,GMTSD0
"RTN","GMTSULT2",32,0)
 S GMTSEO=+($$EMO),GMTSEQ=+($$EMQ),GMTSIF=+($$IF($G(X))),GMTSBI=+($$BI)
"RTN","GMTSULT2",33,0)
 S:$L($G(DIC("S")))&('$L($G(GMTSDICS))) GMTSDICS=$G(DIC("S")),GMTSDS=1
"RTN","GMTSULT2",34,0)
 S:$L($G(DIC(0)))&('$L($G(GMTSDIC0))) GMTSDIC0=$G(DIC(0)),GMTSD0=1
"RTN","GMTSULT2",35,0)
 I GMTSIF S GMTSIEN=$$IENF(X) I +GMTSIEN>0 D IENS(GMTSIEN) G:$D(^TMP("GMTSULT",$J,1)) LQ
"RTN","GMTSULT2",36,0)
 I GMTSBI D B^GMTSULT7 G LQ
"RTN","GMTSULT2",37,0)
 D PAR,FND,REO^GMTSULT3
"RTN","GMTSULT2",38,0)
 Q
"RTN","GMTSULT2",39,0)
LQ ; Quit List
"RTN","GMTSULT2",40,0)
 K:+($G(GMTSDS))>0 GMTSDICS K:+($G(GMTSD0))>0 GMTSDIC0
"RTN","GMTSULT2",41,0)
 Q
"RTN","GMTSULT2",42,0)
 ;                      
"RTN","GMTSULT2",43,0)
FND ; Find Health Summary Types (word search)
"RTN","GMTSULT2",44,0)
 N GMTSB,GMTSC,GMTSCTL,GMTSFND,GMTSI,GMTSI1,GMTSI2,GMTSI3,GMTSDS,GMTSD0,GMTSLEX,GMTSLEXM,GMTSASM,GMTSCMP,GMTSLOC,GMTSNAM,GMTSOK,GMTSRC,GMTSOW,GMTSTMP,GMTSTTL,GMTSWDS,GMTSRD,GMTSWRD,Y
"RTN","GMTSULT2",45,0)
 ;   Echo             E or broker
"RTN","GMTSULT2",46,0)
 S GMTSTMP=+($G(GMTSE)),GMTSIF=0 S:'$D(GMTSE) GMTSTMP=$$ECHO^GMTSULT N GMTSE S GMTSE=GMTSTMP,U="^"
"RTN","GMTSULT2",47,0)
 ;   Exact Match      X
"RTN","GMTSULT2",48,0)
 S GMTSLEX=$$EM(X) D:$G(GMTSDIC0)["X"&(GMTSLEX'>0) CLR^GMTSULT G:$G(GMTSDIC0)["X"&(GMTSLEX'>0) FNDQ
"RTN","GMTSULT2",49,0)
 S:+GMTSLEX>0 ^TMP("GMTSULT2",$J,"EM")=+GMTSLEX,^TMP("GMTSULT2",$J,"IEN",+GMTSLEX)=""
"RTN","GMTSULT2",50,0)
 ;   One Exact Match  OE
"RTN","GMTSULT2",51,0)
 S GMTSLEXM=0 S:$G(GMTSDIC0)["O"&($G(GMTSDIC0)["E") GMTSLEXM=1
"RTN","GMTSULT2",52,0)
 ;   Word Search
"RTN","GMTSULT2",53,0)
 S GMTSWDS=$O(GMTSWRDS(" "),-1) S GMTSWRD=$G(GMTSWRDS(1))
"RTN","GMTSULT2",54,0)
 G:'$L(GMTSWRD) FNDQ S GMTSCTL=GMTSWRD,GMTSWRD=$E(GMTSWRD,1,($L(GMTSWRD)-1))_$C($A($E(GMTSWRD,$L(GMTSWRD)))-1)_"~"
"RTN","GMTSULT2",55,0)
 S:+GMTSCTL=GMTSCTL GMTSWRD=GMTSCTL-1
"RTN","GMTSULT2",56,0)
 F  S GMTSWRD=$O(^GMT(142,"AW",GMTSWRD)) Q:GMTSWRD=""!($E(GMTSWRD,1,$L(GMTSCTL))'=GMTSCTL)  D
"RTN","GMTSULT2",57,0)
 . S (GMTSC,GMTSI1)=0
"RTN","GMTSULT2",58,0)
 . F  S GMTSI1=$O(^GMT(142,"AW",GMTSWRD,GMTSI1)) Q:+GMTSI1=0  D
"RTN","GMTSULT2",59,0)
 . . N GMTSIEN,GMTSKWRD S GMTSIEN=GMTSI1,GMTSKWRD=GMTSWRD
"RTN","GMTSULT2",60,0)
 . . D SM^GMTSULT3
"RTN","GMTSULT2",61,0)
 ;   Check for exact match in results
"RTN","GMTSULT2",62,0)
 S GMTSI=+($G(^TMP("GMTSULT2",$J,"EMI")))
"RTN","GMTSULT2",63,0)
 S GMTSB=$G(^TMP("GMTSULT2",$J,"EMB")) I GMTSI>0,$L(GMTSB)>0 D
"RTN","GMTSULT2",64,0)
 . S ^TMP("GMTSULT2",$J,"E")=$G(^TMP("GMTSULT2",$J,GMTSI))
"RTN","GMTSULT2",65,0)
 . K ^TMP("GMTSULT2",$J,GMTSI),^TMP("GMTSULT2",$J,"B",GMTSB),^TMP("GMTSULT2",$J,"EMB"),^TMP("GMTSULT2",$J,"EMI"),^TMP("GMTSULT2",$J,"EM")
"RTN","GMTSULT2",66,0)
FNDQ ; Find Quit
"RTN","GMTSULT2",67,0)
 K:+($G(GMTSDS))>0 GMTSDICS K:+($G(GMTSD0))>0 GMTSDIC0
"RTN","GMTSULT2",68,0)
 Q
"RTN","GMTSULT2",69,0)
 ;                      
"RTN","GMTSULT2",70,0)
PAR ; Parse User Input
"RTN","GMTSULT2",71,0)
 K GMTSWRDS N GMTSC,GMTSCT,GMTSPSN,GMTSTR,GMTSWRD
"RTN","GMTSULT2",72,0)
 S U="^",GMTSTR=$G(X) Q:'$L(GMTSTR)  S GMTSC=1,GMTSCT=0 F GMTSPSN=1:1:$L(GMTSTR)+1 D
"RTN","GMTSULT2",73,0)
 . S GMTSWRD=$E(GMTSTR,GMTSPSN) I "(,.?! '-/&:;)"[GMTSWRD D
"RTN","GMTSULT2",74,0)
 . . S GMTSWRD=$TR($E($E(GMTSTR,GMTSC,GMTSPSN-1),1,30),"""",""),GMTSC=GMTSPSN+1
"RTN","GMTSULT2",75,0)
 . . I $L(GMTSWRD)>0 S GMTSCT=GMTSCT+1,GMTSWRDS(GMTSCT)=$$UP(GMTSWRD)
"RTN","GMTSULT2",76,0)
 Q
"RTN","GMTSULT2",77,0)
IENF(X) ; Internal Entry Number Find
"RTN","GMTSULT2",78,0)
 N GMTS0,GMTSI S GMTSI=$G(X),X=$G(X),GMTS0=$G(DIC(0)) S:$E(X,1)="`" GMTSI=$E(GMTSI,2,$L(GMTSI)) S GMTSI=+GMTSI
"RTN","GMTSULT2",79,0)
 I GMTS0["N",+GMTSI>0,$D(^GMT(142,+GMTSI,0)) S X=+GMTSI Q X
"RTN","GMTSULT2",80,0)
 I $E(X,1)="`",+GMTSI>0,$D(^GMT(142,+GMTSI,0)) S X=+GMTSI Q X
"RTN","GMTSULT2",81,0)
 Q -1
"RTN","GMTSULT2",82,0)
IENS(X) ; Internal Entry Number Save
"RTN","GMTSULT2",83,0)
 N GMTSI1,GMTSI2,GMTSI3,GMTSIEN S (GMTSIEN,GMTSI1)=+X Q:+GMTSI1=0  Q:'$D(^GMT(142,+GMTSI1,0))
"RTN","GMTSULT2",84,0)
 D SM^GMTSULT3,REO^GMTSULT3
"RTN","GMTSULT2",85,0)
 Q
"RTN","GMTSULT2",86,0)
CM(X) ; Get Number of Components
"RTN","GMTSULT2",87,0)
 S X=+($G(X)) Q:X=0 "No components" Q:'$D(^GMT(142,+X,1)) "No components"
"RTN","GMTSULT2",88,0)
 N GMTSI,GMTSC S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,+X,1,GMTSI)) Q:+GMTSI=0  S GMTSC=GMTSC+1
"RTN","GMTSULT2",89,0)
 S X=$S(+GMTSC>1:(+GMTSC_" components"),+GMTSC=1:(+GMTSC_" component"),1:"No components")
"RTN","GMTSULT2",90,0)
 Q X
"RTN","GMTSULT2",91,0)
EM(X) ; Exact Match when DIC(0) contains X
"RTN","GMTSULT2",92,0)
 S X=$G(X) Q:'$L(X) -1 N GMTSC,GMTSI,GMTSM,GMTSN,GMTSO,GMTSU S U="^"
"RTN","GMTSULT2",93,0)
 S GMTSU=$$UP(X),(GMTSC,GMTSO)=$$UP($E(X,1,30)),GMTSM=0,GMTSO=$E(GMTSO,1,($L(GMTSO)-1))_$C($A($E(GMTSO,$L(GMTSO)))-1)_"~",GMTSM=0
"RTN","GMTSULT2",94,0)
 F  S GMTSO=$O(^GMT(142,"AB",GMTSO)) Q:GMTSO=""!(GMTSO'[GMTSC)  D  Q:+GMTSM>0
"RTN","GMTSULT2",95,0)
 . S GMTSI=0 F  S GMTSI=$O(^GMT(142,"AB",GMTSO,GMTSI)) Q:+GMTSI=0  D  Q:+GMTSM>0
"RTN","GMTSULT2",96,0)
 . . S GMTSN=$P($G(^GMT(142,+GMTSI,0)),U,1) S:$$UP(GMTSN)=GMTSU GMTSM=GMTSI_U_GMTSN
"RTN","GMTSULT2",97,0)
 S:+GMTSM=0 GMTSM=-1 S X=GMTSM D Y^GMTSULT6(+GMTSM)
"RTN","GMTSULT2",98,0)
 Q X
"RTN","GMTSULT2",99,0)
 ;                      
"RTN","GMTSULT2",100,0)
DICS(S,X,DA) ; Check DIC("S") Screen
"RTN","GMTSULT2",101,0)
 N Y,GMTST,GMTSOX,GMTSDICS,GMTSIEN S (GMTSIEN,Y,DA)=+($G(DA)),GMTSDICS=$G(S),GMTSOX=$G(X) S X=GMTSDICS Q:'$L(GMTSDICS) 1
"RTN","GMTSULT2",102,0)
 D ^DIM Q:'$L($G(X)) 1 S GMTST=$G(^GMT(142,+GMTSIEN,0)) Q:'$D(^GMT(142,+GMTSIEN,0)) 0 S X=GMTSOX,(Y,DA)=GMTSIEN Q:GMTSIEN'>0 0
"RTN","GMTSULT2",103,0)
 X GMTSDICS S X=$T Q X
"RTN","GMTSULT2",104,0)
 ;                      
"RTN","GMTSULT2",105,0)
 ; Processing flags
"RTN","GMTSULT2",106,0)
EMQ(X) ;   Exact match flag
"RTN","GMTSULT2",107,0)
 N GMTS0 S X=0,GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",108,0)
 S:$G(GMTS0)["X" X=1 Q X
"RTN","GMTSULT2",109,0)
EMO(X) ;   Exact match flag, only one
"RTN","GMTSULT2",110,0)
 N GMTS0 S X=0 S GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",111,0)
 S:$G(GMTS0)["O"&($G(GMTS0)["E") X=1 Q X
"RTN","GMTSULT2",112,0)
BI(X) ;   Use the B Index flag
"RTN","GMTSULT2",113,0)
 N GMTS0 S X=0 S GMTS0=$G(DIC(0)) Q:'$L(GMTS0) X
"RTN","GMTSULT2",114,0)
 S:$G(GMTS0)["B" X=1 Q X
"RTN","GMTSULT2",115,0)
IF(X) ;   Internal Entry Number Flag
"RTN","GMTSULT2",116,0)
 N GMTS0,GMTSI S GMTSI=0,GMTS0=$G(DIC(0)) Q:'$L($G(X)) 0
"RTN","GMTSULT2",117,0)
 I $E(X,1)="`",$L($G(^GMT(142,+($E(X,2,$L(X))),0))) S GMTSI=1
"RTN","GMTSULT2",118,0)
 I +X>0,$L($G(^GMT(142,+X,0))),GMTS0["N" S GMTSI=1
"RTN","GMTSULT2",119,0)
 S X=GMTSI Q X
"RTN","GMTSULT2",120,0)
 ;                      
"RTN","GMTSULT2",121,0)
 ; TMP Global
"RTN","GMTSULT2",122,0)
TMP ;   Show first ^TMP Global
"RTN","GMTSULT2",123,0)
 N GMTSND,GMTSNC,GMTSNQ,GMTSC,GMTSTMP
"RTN","GMTSULT2",124,0)
 S GMTSC=0,GMTSTMP="",GMTSNQ="^TMP(""GMTSULT2"","_$J_")",GMTSNC="^TMP(""GMTSULT2"","_$J_","
"RTN","GMTSULT2",125,0)
 F  S GMTSNQ=$Q(@GMTSNQ) Q:GMTSNQ=""!(GMTSNQ'[GMTSNC)  D
"RTN","GMTSULT2",126,0)
 . S GMTSC=GMTSC+1 W:GMTSC=1 ! S GMTSND=@GMTSNQ W !,GMTSNQ,"=",GMTSND
"RTN","GMTSULT2",127,0)
 W:GMTSC>0 !
"RTN","GMTSULT2",128,0)
TMP2 ;   Show second ^TMP Global
"RTN","GMTSULT2",129,0)
 S GMTSC=0,GMTSNQ="^TMP(""GMTSULT"","_$J_")",GMTSNC="^TMP(""GMTSULT"","_$J_","
"RTN","GMTSULT2",130,0)
 F  S GMTSNQ=$Q(@GMTSNQ) Q:GMTSNQ=""!(GMTSNQ'[GMTSNC)  D
"RTN","GMTSULT2",131,0)
 . S GMTSC=GMTSC+1 W:'$D(GMTSTMP)&(GMTSC=1) ! S GMTSND=@GMTSNQ W !,GMTSNQ,"=",GMTSND
"RTN","GMTSULT2",132,0)
 W:GMTSC>0 !
"RTN","GMTSULT2",133,0)
 Q
"RTN","GMTSULT2",134,0)
 ; Miscellaneous
"RTN","GMTSULT2",135,0)
UP(X) ;   Uppercase
"RTN","GMTSULT2",136,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSULT2",137,0)
OW(X) ;   Mix Case (owner name)
"RTN","GMTSULT2",138,0)
 Q:$G(X)'["," $$EN^GMTSUMX($G(X))
"RTN","GMTSULT2",139,0)
 Q $$EN^GMTSUMX(($P($G(X),",",1)_", "_$P($G(X),",",2)))
"RTN","GMTSULT2",140,0)
MX(X) ;   Mix Case
"RTN","GMTSULT2",141,0)
 Q $$EN^GMTSUMX(X)
"VER")
8.0^22.0
**END**
**END**
