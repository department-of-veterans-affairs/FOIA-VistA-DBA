KIDS Distribution saved on Jun 26, 2003@12:26:07
For Patient Record Flags
**KIDS**:TIU*1.0*165^USR*1.0*24^

**INSTALL NAME**
TIU*1.0*165
"BLD",4335,0)
TIU*1.0*165^TEXT INTEGRATION UTILITIES^0^3030626^y
"BLD",4335,1,0)
^^2^2^3030618^
"BLD",4335,1,1,0)
The description of the build for patch TIU*1*165 can be found in the 
"BLD",4335,1,2,0)
National Patch Module.
"BLD",4335,4,0)
^9.64PA^^0
"BLD",4335,"INID")
^
"BLD",4335,"INIT")

"BLD",4335,"KRN",0)
^9.67PA^8989.52^19
"BLD",4335,"KRN",.4,0)
.4
"BLD",4335,"KRN",.401,0)
.401
"BLD",4335,"KRN",.402,0)
.402
"BLD",4335,"KRN",.403,0)
.403
"BLD",4335,"KRN",.5,0)
.5
"BLD",4335,"KRN",.84,0)
.84
"BLD",4335,"KRN",3.6,0)
3.6
"BLD",4335,"KRN",3.8,0)
3.8
"BLD",4335,"KRN",9.2,0)
9.2
"BLD",4335,"KRN",9.8,0)
9.8
"BLD",4335,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4335,"KRN",9.8,"NM",1,0)
TIUPS165^^0^B37881938
"BLD",4335,"KRN",9.8,"NM",2,0)
TIUEN165^^0^B11170045
"BLD",4335,"KRN",9.8,"NM",3,0)
TIU165D^^0^B4010463
"BLD",4335,"KRN",9.8,"NM","B","TIU165D",3)

"BLD",4335,"KRN",9.8,"NM","B","TIUEN165",2)

"BLD",4335,"KRN",9.8,"NM","B","TIUPS165",1)

"BLD",4335,"KRN",19,0)
19
"BLD",4335,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",4335,"KRN",19,"NM",1,0)
TIU165 DDEFS & RULES, PRF^^0
"BLD",4335,"KRN",19,"NM","B","TIU165 DDEFS & RULES, PRF",1)

"BLD",4335,"KRN",19.1,0)
19.1
"BLD",4335,"KRN",101,0)
101
"BLD",4335,"KRN",409.61,0)
409.61
"BLD",4335,"KRN",771,0)
771
"BLD",4335,"KRN",870,0)
870
"BLD",4335,"KRN",8989.51,0)
8989.51
"BLD",4335,"KRN",8989.52,0)
8989.52
"BLD",4335,"KRN",8994,0)
8994
"BLD",4335,"KRN","B",.4,.4)

"BLD",4335,"KRN","B",.401,.401)

"BLD",4335,"KRN","B",.402,.402)

"BLD",4335,"KRN","B",.403,.403)

"BLD",4335,"KRN","B",.5,.5)

"BLD",4335,"KRN","B",.84,.84)

"BLD",4335,"KRN","B",3.6,3.6)

"BLD",4335,"KRN","B",3.8,3.8)

"BLD",4335,"KRN","B",9.2,9.2)

"BLD",4335,"KRN","B",9.8,9.8)

"BLD",4335,"KRN","B",19,19)

"BLD",4335,"KRN","B",19.1,19.1)

"BLD",4335,"KRN","B",101,101)

"BLD",4335,"KRN","B",409.61,409.61)

"BLD",4335,"KRN","B",771,771)

"BLD",4335,"KRN","B",870,870)

"BLD",4335,"KRN","B",8989.51,8989.51)

"BLD",4335,"KRN","B",8989.52,8989.52)

"BLD",4335,"KRN","B",8994,8994)

"BLD",4335,"PRE")
TIUEN165
"BLD",4335,"QUES",0)
^9.62^^
"BLD",4335,"REQB",0)
^9.611^1^1
"BLD",4335,"REQB",1,0)
TIU*1.0*137^2
"BLD",4335,"REQB","B","TIU*1.0*137",1)

"KRN",19,9184,-1)
0^1
"KRN",19,9184,0)
TIU165 DDEFS & RULES, PRF^Create DDEFS, Rules for Patient Record Flags^^A^^^^^^^n^TEXT INTEGRATION UTILITIES^^1
"KRN",19,9184,1,0)
^^13^13^3030616^
"KRN",19,9184,1,1,0)
This option creates new Document Definitions, a User Class, and a Business
"KRN",19,9184,1,2,0)
Rule for Patient Record Flags.  The option is exported with patch
"KRN",19,9184,1,3,0)
TIU*1*165.  It is this option, not the patch itself, which actually 
"KRN",19,9184,1,4,0)
creates the new Document Definitions, User Class, and Business Rule.
"KRN",19,9184,1,5,0)
 
"KRN",19,9184,1,6,0)
This option must be run after the patch is installed.  When the option 
"KRN",19,9184,1,7,0)
has run successfully to the end and messages have indicated that all 
"KRN",19,9184,1,8,0)
items have been created successfully with no problems encountered, this 
"KRN",19,9184,1,9,0)
option may be deleted.
"KRN",19,9184,1,10,0)
 
"KRN",19,9184,1,11,0)
If the patch must be installed over itself, this option may be re-run if
"KRN",19,9184,1,12,0)
desired.  However, the option will not attempt to recreate entries that 
"KRN",19,9184,1,13,0)
were already created successfully the first time the option was run.
"KRN",19,9184,20)
D BEGIN^TIUPS165
"KRN",19,9184,"U")
CREATE DDEFS, RULES FOR PATIEN
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
165^3030626
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3030626
"PKG",193,22,1,"PAH",1,1,1,0)
The description of the build for patch TIU*1*165 can be found in the 
"PKG",193,22,1,"PAH",1,1,2,0)
National Patch Module.
"PRE")
TIUEN165
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","TIU165D")
0^3^B4010463
"RTN","TIU165D",1,0)
TIU165D ; SLC/MAM - Data for Post-Install for TIU*1*165;6/24/03
"RTN","TIU165D",2,0)
 ;;1.0;Text Integration Utilities;**165**;Jun 20, 1997
"RTN","TIU165D",3,0)
 ;
"RTN","TIU165D",4,0)
SETDATA ; Set more data for DDEFS (Basic data set in TIUEN165)
"RTN","TIU165D",5,0)
 ; -- DDEF Number 1: PATIENT RECORD FLAG CAT I DC
"RTN","TIU165D",6,0)
 ; -- DDEF Number 2: PATIENT RECORD FLAG CAT II DC
"RTN","TIU165D",7,0)
 ; -- DDEF Number 3: PATIENT RECORD FLAG CATEGORY I DOC
"RTN","TIU165D",8,0)
 ; -- DDEF Number 4: PATIENT RECORD FLAG CATEGORY II - RISK, FALL DOC
"RTN","TIU165D",9,0)
 ; -- DDEF Number 5: PATIENT RECORD FLAG CATEGORY II - RISK, WANDERING DOC
"RTN","TIU165D",10,0)
 ; -- DDEF Number 6: PATIENT RECORD FLAG CATEGORY II - RESEARCH STUDY DOC
"RTN","TIU165D",11,0)
 ; -- DDEF Number 7: PATIENT RECORD FLAG CATEGORY II - INFECTIOUS DISEASE DOC
"RTN","TIU165D",12,0)
 ; -- Set Print Name, Owner, Status, Exterior Type,
"RTN","TIU165D",13,0)
 ;    National, for call to FILE^DIE:
"RTN","TIU165D",14,0)
 N TIUI S TIUI=0
"RTN","TIU165D",15,0)
 F TIUI=1:1:7 D
"RTN","TIU165D",16,0)
 . S ^XTMP("TIU165","FILEDATA",TIUI,.03)=^XTMP("TIU165","BASICS",TIUI,"NAME")
"RTN","TIU165D",17,0)
 . S ^XTMP("TIU165","FILEDATA",TIUI,.06)="CLINICAL COORDINATOR"
"RTN","TIU165D",18,0)
 . S ^XTMP("TIU165","FILEDATA",TIUI,.07)=$S(TIUI<4:"ACTIVE",1:"TEST")
"RTN","TIU165D",19,0)
 . S ^XTMP("TIU165","FILEDATA",TIUI,.04)=$S(TIUI>2:"TITLE",1:"DOCUMENT CLASS")
"RTN","TIU165D",20,0)
 . S ^XTMP("TIU165","FILEDATA",TIUI,.13)=$S(TIUI>3:"NO",1:"YES")
"RTN","TIU165D",21,0)
 ; -- Set Parent:
"RTN","TIU165D",22,0)
 ; -- Set PIEN node = IEN of parent if known, or if not,
"RTN","TIU165D",23,0)
 ;    set PNUM node = DDEF# of parent                   
"RTN","TIU165D",24,0)
 ;    Parent must exist by the time this DDEF is created:
"RTN","TIU165D",25,0)
 S ^XTMP("TIU165","DATA",1,"PIEN")=3
"RTN","TIU165D",26,0)
 S ^XTMP("TIU165","DATA",1,"MENUTXT")="Pat Record Flag Cat I"
"RTN","TIU165D",27,0)
 S ^XTMP("TIU165","DATA",2,"PIEN")=3
"RTN","TIU165D",28,0)
 S ^XTMP("TIU165","DATA",2,"MENUTXT")="Pat Record Flag Cat II"
"RTN","TIU165D",29,0)
 S ^XTMP("TIU165","DATA",3,"PNUM")=1
"RTN","TIU165D",30,0)
 S ^XTMP("TIU165","DATA",3,"MENUTXT")="Pat Record Flag Cat I"
"RTN","TIU165D",31,0)
 S ^XTMP("TIU165","DATA",4,"PNUM")=2
"RTN","TIU165D",32,0)
 S ^XTMP("TIU165","DATA",4,"MENUTXT")="PRF Cat II Risk, Fall"
"RTN","TIU165D",33,0)
 S ^XTMP("TIU165","DATA",5,"PNUM")=2
"RTN","TIU165D",34,0)
 S ^XTMP("TIU165","DATA",5,"MENUTXT")="PRF Cat II Risk, Wandering"
"RTN","TIU165D",35,0)
 S ^XTMP("TIU165","DATA",6,"PNUM")=2
"RTN","TIU165D",36,0)
 S ^XTMP("TIU165","DATA",6,"MENUTXT")="PRF Cat II Research Study"
"RTN","TIU165D",37,0)
 S ^XTMP("TIU165","DATA",7,"PNUM")=2
"RTN","TIU165D",38,0)
 S ^XTMP("TIU165","DATA",7,"MENUTXT")="PRF Cat II Infectious Disease"
"RTN","TIU165D",39,0)
 Q
"RTN","TIUEN165")
0^2^B11170045
"RTN","TIUEN165",1,0)
TIUEN165 ; SLC/MAM - Environment Check Rtn for TIU*1*165;6/16/03
"RTN","TIUEN165",2,0)
 ;;1.0;Text Integration Utilities;**165**;Jun 20, 1997
"RTN","TIUEN165",3,0)
MAIN ; Check environment
"RTN","TIUEN165",4,0)
 ; -- Set data for DDEFs to export:
"RTN","TIUEN165",5,0)
 D SETXTMP
"RTN","TIUEN165",6,0)
 ; -- Check for potential DDEF duplicates at site:
"RTN","TIUEN165",7,0)
 N TIUDUPS
"RTN","TIUEN165",8,0)
 D TIUDUPS(.TIUDUPS)
"RTN","TIUEN165",9,0)
 ; -- If potential duplicates exist, abort install:
"RTN","TIUEN165",10,0)
 I 'TIUDUPS W !,"Document Definitions look OK." Q
"RTN","TIUEN165",11,0)
 S XPDABORT=1 W !,"Aborting Install..."
"RTN","TIUEN165",12,0)
 Q
"RTN","TIUEN165",13,0)
 ;
"RTN","TIUEN165",14,0)
SETXTMP ; Set up ^XTMP global
"RTN","TIUEN165",15,0)
 S ^XTMP("TIU165",0)=304301_U_DT
"RTN","TIUEN165",16,0)
 ; -- Set basic data for new DDEFS into ^XTMP.
"RTN","TIUEN165",17,0)
 ;    Reference DDEFS by NUMBER.
"RTN","TIUEN165",18,0)
 ;    Number parent-to-be BEFORE child.
"RTN","TIUEN165",19,0)
 ; -- DDEF Number 1:
"RTN","TIUEN165",20,0)
 S ^XTMP("TIU165","BASICS",1,"NAME")="PATIENT RECORD FLAG CAT I"
"RTN","TIUEN165",21,0)
 S ^XTMP("TIU165","BASICS",1,"INTTYPE")="DC"
"RTN","TIUEN165",22,0)
 ; -- DDEF Number 2:
"RTN","TIUEN165",23,0)
 S ^XTMP("TIU165","BASICS",2,"NAME")="PATIENT RECORD FLAG CAT II"
"RTN","TIUEN165",24,0)
 S ^XTMP("TIU165","BASICS",2,"INTTYPE")="DC"
"RTN","TIUEN165",25,0)
 ; -- DDEF Number 3:
"RTN","TIUEN165",26,0)
 S ^XTMP("TIU165","BASICS",3,"NAME")="PATIENT RECORD FLAG CATEGORY I"
"RTN","TIUEN165",27,0)
 S ^XTMP("TIU165","BASICS",3,"INTTYPE")="DOC"
"RTN","TIUEN165",28,0)
 ; -- DDEF Number 4:
"RTN","TIUEN165",29,0)
 S ^XTMP("TIU165","BASICS",4,"NAME")="PATIENT RECORD FLAG CATEGORY II - RISK, FALL"
"RTN","TIUEN165",30,0)
 S ^XTMP("TIU165","BASICS",4,"INTTYPE")="DOC"
"RTN","TIUEN165",31,0)
 ; -- DDEF Number 5:
"RTN","TIUEN165",32,0)
 S ^XTMP("TIU165","BASICS",5,"NAME")="PATIENT RECORD FLAG CATEGORY II - RISK, WANDERING"
"RTN","TIUEN165",33,0)
 S ^XTMP("TIU165","BASICS",5,"INTTYPE")="DOC"
"RTN","TIUEN165",34,0)
 ; -- DDEF Number 6:
"RTN","TIUEN165",35,0)
 S ^XTMP("TIU165","BASICS",6,"NAME")="PATIENT RECORD FLAG CATEGORY II - RESEARCH STUDY"
"RTN","TIUEN165",36,0)
 S ^XTMP("TIU165","BASICS",6,"INTTYPE")="DOC"
"RTN","TIUEN165",37,0)
 ; -- DDEF Number 7:
"RTN","TIUEN165",38,0)
 S ^XTMP("TIU165","BASICS",7,"NAME")="PATIENT RECORD FLAG CATEGORY II - INFECTIOUS DISEASE"
"RTN","TIUEN165",39,0)
 S ^XTMP("TIU165","BASICS",7,"INTTYPE")="DOC"
"RTN","TIUEN165",40,0)
 Q
"RTN","TIUEN165",41,0)
 ;
"RTN","TIUEN165",42,0)
TIUDUPS(TIUDUPS,SILENT) ; Set array of potential duplicates
"RTN","TIUEN165",43,0)
 N NUM S (NUM,TIUDUPS)=0
"RTN","TIUEN165",44,0)
 F  S NUM=$O(^XTMP("TIU165","BASICS",NUM)) Q:'NUM  D
"RTN","TIUEN165",45,0)
 . ; -- When looking for duplicates, ignore DDEF if
"RTN","TIUEN165",46,0)
 . ;      previously created by this patch:
"RTN","TIUEN165",47,0)
 . Q:$G(^XTMP("TIU165","BASICS",NUM,"DONE"))
"RTN","TIUEN165",48,0)
 . ; -- If site already has DDEF w/ same Name & Type as one
"RTN","TIUEN165",49,0)
 . ;    we are exporting, set its number into array TIUDUPS:
"RTN","TIUEN165",50,0)
 . N NAME,TYPE,TIUY S TIUY=0
"RTN","TIUEN165",51,0)
 . S NAME=^XTMP("TIU165","BASICS",NUM,"NAME"),TYPE=^XTMP("TIU165","BASICS",NUM,"INTTYPE")
"RTN","TIUEN165",52,0)
 . F  S TIUY=$O(^TIU(8925.1,"B",NAME,TIUY)) Q:+TIUY'>0  D
"RTN","TIUEN165",53,0)
 . . I $P($G(^TIU(8925.1,+TIUY,0)),U,4)=TYPE S TIUDUPS(NUM)=+TIUY,TIUDUPS=1
"RTN","TIUEN165",54,0)
 ; -- Write list of duplicates:
"RTN","TIUEN165",55,0)
 I +TIUDUPS,'$G(SILENT) D
"RTN","TIUEN165",56,0)
 . W !,"You already have the following Document Definitions exported by this patch."
"RTN","TIUEN165",57,0)
 . W !,"I don't want to overwrite them. Please change their names so they no longer"
"RTN","TIUEN165",58,0)
 . W !,"match the exported ones, or if you are not using them, delete them."
"RTN","TIUEN165",59,0)
 . W !!,"If you change the name of a Document Definition, remember to update its Print"
"RTN","TIUEN165",60,0)
 . W !,"Name, as well. For help, contact National VistA Support."
"RTN","TIUEN165",61,0)
 . N NUM S NUM=0
"RTN","TIUEN165",62,0)
 . F  S NUM=$O(TIUDUPS(NUM)) Q:'NUM  D
"RTN","TIUEN165",63,0)
 . . W !?5,^XTMP("TIU165","BASICS",NUM,"NAME")
"RTN","TIUEN165",64,0)
 Q
"RTN","TIUPS165")
0^1^B37881938
"RTN","TIUPS165",1,0)
TIUPS165 ; SLC/MAM - After installing TIU*1*165;6/26/03
"RTN","TIUPS165",2,0)
 ;;1.0;Text Integration Utilities;**165**;Jun 20, 1997
"RTN","TIUPS165",3,0)
 ; Run this after installing patch 165.
"RTN","TIUPS165",4,0)
 ;Use option: TIU165 DDEFS & RULES, PRF
"RTN","TIUPS165",5,0)
 ; External References
"RTN","TIUPS165",6,0)
 ;   DBIA 4127  MAIN^USRPS24
"RTN","TIUPS165",7,0)
BEGIN ; Create DDEFS
"RTN","TIUPS165",8,0)
 W !!,"This option creates Document Definitions, a User Class, and"
"RTN","TIUPS165",9,0)
 W !,"a Business Rule for Patient Record Flags."
"RTN","TIUPS165",10,0)
 W ! K IOP S %ZIS="Q" D ^%ZIS I POP K POP Q
"RTN","TIUPS165",11,0)
 I $D(IO("Q")) K IO("Q") D  Q
"RTN","TIUPS165",12,0)
 .S ZTRTN="MAIN^TIUPS165"
"RTN","TIUPS165",13,0)
 .S ZTDESC="Create DDefs, User Class, Rules for Patient Record Flags - TIU*1*165"
"RTN","TIUPS165",14,0)
 .D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Canceled!")
"RTN","TIUPS165",15,0)
 .K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","TIUPS165",16,0)
 .D HOME^%ZIS
"RTN","TIUPS165",17,0)
 U IO D MAIN,^%ZISC
"RTN","TIUPS165",18,0)
 Q
"RTN","TIUPS165",19,0)
 ;
"RTN","TIUPS165",20,0)
MAIN ; Create DDEFS for Patient Record Flags
"RTN","TIUPS165",21,0)
 ; -- Check for dups created after the install but before this option:
"RTN","TIUPS165",22,0)
 K ^XTMP("TIU165","DUPS"),^TMP("TIU165",$J)
"RTN","TIUPS165",23,0)
 D SETXTMP^TIUEN165
"RTN","TIUPS165",24,0)
 N TIUDUPS,TMPCNT,SILENT S TMPCNT=0
"RTN","TIUPS165",25,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)=""
"RTN","TIUPS165",26,0)
 S TMPCNT=1,^TMP("TIU165",$J,TMPCNT)="         ***** Document Definitions for PATIENT RECORD FLAGS *****"
"RTN","TIUPS165",27,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)=""
"RTN","TIUPS165",28,0)
 S SILENT=1
"RTN","TIUPS165",29,0)
 D TIUDUPS^TIUEN165(.TIUDUPS,SILENT)
"RTN","TIUPS165",30,0)
 ; -- If potential duplicates exist, quit:
"RTN","TIUPS165",31,0)
 I $G(TIUDUPS) D  G MAINX
"RTN","TIUPS165",32,0)
 . S ^XTMP("TIU165","DUPS")=1
"RTN","TIUPS165",33,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="Duplicate problem.  See description for patch TIU*1*165,"
"RTN","TIUPS165",34,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="in the National Patch Module."
"RTN","TIUPS165",35,0)
 ; -- Set file data, other data for DDEFS: 
"RTN","TIUPS165",36,0)
 D SETDATA^TIU165D
"RTN","TIUPS165",37,0)
 N NUM S NUM=0
"RTN","TIUPS165",38,0)
 F  S NUM=$O(^XTMP("TIU165","BASICS",NUM)) Q:'NUM  D
"RTN","TIUPS165",39,0)
 . N IEN,YDDEF,TIUDA
"RTN","TIUPS165",40,0)
 . ; -- If DDEF was previously created by this patch,
"RTN","TIUPS165",41,0)
 . ;    say so and quit:
"RTN","TIUPS165",42,0)
 . S IEN=+$G(^XTMP("TIU165","BASICS",NUM,"DONE"))
"RTN","TIUPS165",43,0)
 . I IEN D  Q
"RTN","TIUPS165",44,0)
 . . S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)=^XTMP("TIU165","FILEDATA",NUM,.04)_" "_^XTMP("TIU165","BASICS",NUM,"NAME")
"RTN","TIUPS165",45,0)
 . . S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="    was already created in a previous install."
"RTN","TIUPS165",46,0)
 . . K ^XTMP("TIU165","FILEDATA",NUM)
"RTN","TIUPS165",47,0)
 . . K ^XTMP("TIU165","DATA",NUM)
"RTN","TIUPS165",48,0)
 . ; -- If not, create new DDEF:
"RTN","TIUPS165",49,0)
 . S YDDEF=$$CREATE(NUM)
"RTN","TIUPS165",50,0)
 . I +YDDEF'>0!($P(YDDEF,U,3)'=1) D  Q
"RTN","TIUPS165",51,0)
 . . S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="Couldn't create a "_^XTMP("TIU165","FILEDATA",NUM,.04)_" named "_^XTMP("TIU165","BASICS",NUM,"NAME")_".",TMPCNT=TMPCNT+1
"RTN","TIUPS165",52,0)
 . . S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="    Please contact National VistA Support for help."
"RTN","TIUPS165",53,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)=^XTMP("TIU165","FILEDATA",NUM,.04)_" named "_^XTMP("TIU165","BASICS",NUM,"NAME")
"RTN","TIUPS165",54,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="    created successfully."
"RTN","TIUPS165",55,0)
 . S TIUDA=+YDDEF
"RTN","TIUPS165",56,0)
 . ; -- File field data:
"RTN","TIUPS165",57,0)
 . D FILE(NUM,TIUDA,.TMPCNT)
"RTN","TIUPS165",58,0)
 . K ^XTMP("TIU165","FILEDATA",NUM)
"RTN","TIUPS165",59,0)
 . ; -- Add item to parent:
"RTN","TIUPS165",60,0)
 . D ADDITEM(NUM,TIUDA,.TMPCNT)
"RTN","TIUPS165",61,0)
 . K ^XTMP("TIU165","DATA",NUM)
"RTN","TIUPS165",62,0)
MAINX ;Exit
"RTN","TIUPS165",63,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)=""
"RTN","TIUPS165",64,0)
 S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="                           *************"
"RTN","TIUPS165",65,0)
 I '$G(^XTMP("TIU165","DUPS")) D MAIN^USRPS24
"RTN","TIUPS165",66,0)
 D PRINT
"RTN","TIUPS165",67,0)
 K ^TMP("TIU165",$J),^TMP("USR24",$J)
"RTN","TIUPS165",68,0)
 Q
"RTN","TIUPS165",69,0)
 ;
"RTN","TIUPS165",70,0)
PRINT ; Print out results
"RTN","TIUPS165",71,0)
 N TIUCNT,TIUCONT
"RTN","TIUPS165",72,0)
 I $D(ZTQUEUED) S ZTREQ="@" ; Tell TaskMan to delete Task log entry
"RTN","TIUPS165",73,0)
 I $E(IOST)="C" W @IOF,!
"RTN","TIUPS165",74,0)
 S TIUCNT="",TIUCONT=1
"RTN","TIUPS165",75,0)
 F  S TIUCNT=$O(^TMP("TIU165",$J,TIUCNT)) Q:TIUCNT=""  D  Q:'TIUCONT
"RTN","TIUPS165",76,0)
 . S TIUCONT=$$SETCONT Q:'TIUCONT
"RTN","TIUPS165",77,0)
 . W ^TMP("TIU165",$J,TIUCNT),!
"RTN","TIUPS165",78,0)
 Q:'TIUCONT
"RTN","TIUPS165",79,0)
 S TIUCNT=""
"RTN","TIUPS165",80,0)
 F  S TIUCNT=$O(^TMP("USR24",$J,TIUCNT)) Q:TIUCNT=""  D  Q:'TIUCONT
"RTN","TIUPS165",81,0)
 . S TIUCONT=$$SETCONT Q:'TIUCONT
"RTN","TIUPS165",82,0)
 . W ^TMP("USR24",$J,TIUCNT),!
"RTN","TIUPS165",83,0)
PRINTX Q
"RTN","TIUPS165",84,0)
 ;
"RTN","TIUPS165",85,0)
STOP() ;on screen paging check
"RTN","TIUPS165",86,0)
 ; quits TIUCONT=1 if cont. ELSE quits TIUCONT=0
"RTN","TIUPS165",87,0)
 N DIR,Y,TIUCONT
"RTN","TIUPS165",88,0)
 S DIR(0)="E" D ^DIR
"RTN","TIUPS165",89,0)
 S TIUCONT=Y
"RTN","TIUPS165",90,0)
 I TIUCONT W @IOF,!
"RTN","TIUPS165",91,0)
 Q TIUCONT
"RTN","TIUPS165",92,0)
 ;
"RTN","TIUPS165",93,0)
SETCONT() ; D form feed, Set TIUCONT
"RTN","TIUPS165",94,0)
 N TIUCONT
"RTN","TIUPS165",95,0)
 S TIUCONT=1
"RTN","TIUPS165",96,0)
 I $E(IOST)="C" G SETX:$Y+5<IOSL
"RTN","TIUPS165",97,0)
 I $E(IOST)="C" S TIUCONT=$$STOP G SETX
"RTN","TIUPS165",98,0)
 G:$Y+8<IOSL SETX
"RTN","TIUPS165",99,0)
 W @IOF
"RTN","TIUPS165",100,0)
SETX Q TIUCONT
"RTN","TIUPS165",101,0)
 ;
"RTN","TIUPS165",102,0)
PARENT(NUM) ; Return IEN of parent new DDEF should be added to
"RTN","TIUPS165",103,0)
 N PIEN,PNUM
"RTN","TIUPS165",104,0)
 ; Parent node has form:
"RTN","TIUPS165",105,0)
 ; -- PIEN node = IEN of parent if known, or if not,
"RTN","TIUPS165",106,0)
 ;    PNUM node = DDEF# of parent
"RTN","TIUPS165",107,0)
 S PIEN=$G(^XTMP("TIU165","DATA",NUM,"PIEN"))
"RTN","TIUPS165",108,0)
 ; -- If parent IEN is known, we're done:
"RTN","TIUPS165",109,0)
 I +PIEN G PARENTX
"RTN","TIUPS165",110,0)
 ; -- If not, get DDEF# of parent
"RTN","TIUPS165",111,0)
 S PNUM=$G(^XTMP("TIU165","DATA",NUM,"PNUM"))
"RTN","TIUPS165",112,0)
 I 'PNUM Q 0
"RTN","TIUPS165",113,0)
 ; -- Get Parent IEN from "DONE" node, which was set
"RTN","TIUPS165",114,0)
 ;    when parent was created:
"RTN","TIUPS165",115,0)
 S PIEN=+$G(^XTMP("TIU165","BASICS",PNUM,"DONE"))
"RTN","TIUPS165",116,0)
PARENTX Q PIEN
"RTN","TIUPS165",117,0)
 ;
"RTN","TIUPS165",118,0)
ADDITEM(NUM,TIUDA,TMPCNT)  ; Add DDEF to Parent; Set item fields
"RTN","TIUPS165",119,0)
 N PIEN,MENUTXT,TIUFPRIV,TIUFISCR
"RTN","TIUPS165",120,0)
 N DIE,DR
"RTN","TIUPS165",121,0)
 S TIUFPRIV=1
"RTN","TIUPS165",122,0)
 S PIEN=$$PARENT(NUM)
"RTN","TIUPS165",123,0)
 I 'PIEN!'$D(^TIU(8925.1,PIEN,0))!'$D(^TIU(8925.1,TIUDA,0)) K PIEN G ADDX
"RTN","TIUPS165",124,0)
 N DA,DIC,DLAYGO,X,Y
"RTN","TIUPS165",125,0)
 N I,DIY
"RTN","TIUPS165",126,0)
 S DA(1)=PIEN
"RTN","TIUPS165",127,0)
 S DIC="^TIU(8925.1,"_DA(1)_",10,",DIC(0)="LX"
"RTN","TIUPS165",128,0)
 S DLAYGO=8925.14
"RTN","TIUPS165",129,0)
 ;S X="`"_TIUDA
"RTN","TIUPS165",130,0)
 ; -- If TIUDA is say, x, and Parent has x as IFN in Item subfile,
"RTN","TIUPS165",131,0)
 ;    code finds item x under parent instead of creating a new item,
"RTN","TIUPS165",132,0)
 ;    so don't use "`"_TIUDA:
"RTN","TIUPS165",133,0)
 S X=^XTMP("TIU165","BASICS",NUM,"NAME")
"RTN","TIUPS165",134,0)
 ; -- Make sure the DDEF it adds is TIUDA and not another w same name:
"RTN","TIUPS165",135,0)
 S TIUFISCR=TIUDA ; activates screen on fld 10, Subfld .01 in DD
"RTN","TIUPS165",136,0)
 D ^DIC I Y'>0!($P(Y,U,3)'=1) K PIEN G ADDX
"RTN","TIUPS165",137,0)
 ; -- Set Menu Text:
"RTN","TIUPS165",138,0)
 S MENUTXT=$G(^XTMP("TIU165","DATA",NUM,"MENUTXT"))
"RTN","TIUPS165",139,0)
 I $L(MENUTXT) D
"RTN","TIUPS165",140,0)
 . N DA,DIE,DR
"RTN","TIUPS165",141,0)
 . N D,D0,DI,DQ
"RTN","TIUPS165",142,0)
 . S DA(1)=PIEN
"RTN","TIUPS165",143,0)
 . S DA=+Y,DIE=DIC
"RTN","TIUPS165",144,0)
 . S DR="4////^S X=MENUTXT"
"RTN","TIUPS165",145,0)
 . D ^DIE
"RTN","TIUPS165",146,0)
ADDX ; -- Tell user about adding to parent:
"RTN","TIUPS165",147,0)
 I '$G(PIEN) D
"RTN","TIUPS165",148,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="  Couldn't add entry to parent.  Please contact National VistA Support"
"RTN","TIUPS165",149,0)
 . S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="    for help."
"RTN","TIUPS165",150,0)
 E  S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="  Entry added to parent."
"RTN","TIUPS165",151,0)
 Q
"RTN","TIUPS165",152,0)
 ;
"RTN","TIUPS165",153,0)
FILE(NUM,TIUDA,TMPCNT) ; File fields for new entry TIUDA
"RTN","TIUPS165",154,0)
 ; Files ALL FIELDS set in "FILEDATA" nodes of ^XTMP:
"RTN","TIUPS165",155,0)
 ;   ^XTMP("TIU165","FILEDATA",NUM,Field#)
"RTN","TIUPS165",156,0)
 N TIUFPRIV,FDA,TIUERR
"RTN","TIUPS165",157,0)
 S TIUFPRIV=1
"RTN","TIUPS165",158,0)
 M FDA(8925.1,TIUDA_",")=^XTMP("TIU165","FILEDATA",NUM)
"RTN","TIUPS165",159,0)
 D FILE^DIE("TE","FDA","TIUERR")
"RTN","TIUPS165",160,0)
 I $D(TIUERR) S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="  Problem filing data for entry. Please contact National VistA Support."
"RTN","TIUPS165",161,0)
 E  S TMPCNT=TMPCNT+1,^TMP("TIU165",$J,TMPCNT)="  Data for entry filed successfully."
"RTN","TIUPS165",162,0)
 Q
"RTN","TIUPS165",163,0)
 ;
"RTN","TIUPS165",164,0)
CREATE(NUM) ; Create new DDEF entry
"RTN","TIUPS165",165,0)
 N DIC,DLAYGO,DA,X,Y,TIUFPRIV
"RTN","TIUPS165",166,0)
 S TIUFPRIV=1
"RTN","TIUPS165",167,0)
 ;S (DIC,DLAYGO)="^TIU(8925.1,"
"RTN","TIUPS165",168,0)
 ;CACHE won't take global root for DLAYGO; use file number:
"RTN","TIUPS165",169,0)
 S DIC="^TIU(8925.1,",DLAYGO=8925.1
"RTN","TIUPS165",170,0)
 S DIC(0)="LX",X=^XTMP("TIU165","BASICS",NUM,"NAME")
"RTN","TIUPS165",171,0)
 S DIC("S")="I $P(^(0),U,4)="_""""_^XTMP("TIU165","BASICS",NUM,"INTTYPE")_""""
"RTN","TIUPS165",172,0)
 D ^DIC
"RTN","TIUPS165",173,0)
 ; -- If DDEF was just created, set "DONE" node = IEN
"RTN","TIUPS165",174,0)
 I $P(Y,U,3)=1 S ^XTMP("TIU165","BASICS",NUM,"DONE")=+$G(Y)
"RTN","TIUPS165",175,0)
 Q $G(Y)
"VER")
8.0^22.0
**INSTALL NAME**
USR*1.0*24
"BLD",4461,0)
USR*1.0*24^AUTHORIZATION/SUBSCRIPTION^0^3030626^y
"BLD",4461,1,0)
^^2^2^3030618^
"BLD",4461,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",4461,1,2,0)
under patch USR*1*24.
"BLD",4461,4,0)
^9.64PA^^
"BLD",4461,"KRN",0)
^9.67PA^8989.52^19
"BLD",4461,"KRN",.4,0)
.4
"BLD",4461,"KRN",.401,0)
.401
"BLD",4461,"KRN",.402,0)
.402
"BLD",4461,"KRN",.403,0)
.403
"BLD",4461,"KRN",.5,0)
.5
"BLD",4461,"KRN",.84,0)
.84
"BLD",4461,"KRN",3.6,0)
3.6
"BLD",4461,"KRN",3.8,0)
3.8
"BLD",4461,"KRN",9.2,0)
9.2
"BLD",4461,"KRN",9.8,0)
9.8
"BLD",4461,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4461,"KRN",9.8,"NM",1,0)
USREN24^^0^B3224708
"BLD",4461,"KRN",9.8,"NM",2,0)
USRPS24^^0^B22317652
"BLD",4461,"KRN",9.8,"NM","B","USREN24",1)

"BLD",4461,"KRN",9.8,"NM","B","USRPS24",2)

"BLD",4461,"KRN",19,0)
19
"BLD",4461,"KRN",19.1,0)
19.1
"BLD",4461,"KRN",101,0)
101
"BLD",4461,"KRN",409.61,0)
409.61
"BLD",4461,"KRN",771,0)
771
"BLD",4461,"KRN",870,0)
870
"BLD",4461,"KRN",8989.51,0)
8989.51
"BLD",4461,"KRN",8989.52,0)
8989.52
"BLD",4461,"KRN",8994,0)
8994
"BLD",4461,"KRN","B",.4,.4)

"BLD",4461,"KRN","B",.401,.401)

"BLD",4461,"KRN","B",.402,.402)

"BLD",4461,"KRN","B",.403,.403)

"BLD",4461,"KRN","B",.5,.5)

"BLD",4461,"KRN","B",.84,.84)

"BLD",4461,"KRN","B",3.6,3.6)

"BLD",4461,"KRN","B",3.8,3.8)

"BLD",4461,"KRN","B",9.2,9.2)

"BLD",4461,"KRN","B",9.8,9.8)

"BLD",4461,"KRN","B",19,19)

"BLD",4461,"KRN","B",19.1,19.1)

"BLD",4461,"KRN","B",101,101)

"BLD",4461,"KRN","B",409.61,409.61)

"BLD",4461,"KRN","B",771,771)

"BLD",4461,"KRN","B",870,870)

"BLD",4461,"KRN","B",8989.51,8989.51)

"BLD",4461,"KRN","B",8989.52,8989.52)

"BLD",4461,"KRN","B",8994,8994)

"BLD",4461,"PRE")
USREN24
"BLD",4461,"QUES",0)
^9.62^^
"BLD",4461,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",194,-1)
1^1
"PKG",194,0)
AUTHORIZATION/SUBSCRIPTION^USR^User Authorization
"PKG",194,20,0)
^9.402P^^
"PKG",194,22,0)
^9.49I^1^1
"PKG",194,22,1,0)
1.0^2970620
"PKG",194,22,1,"PAH",1,0)
24^3030626
"PKG",194,22,1,"PAH",1,1,0)
^^2^2^3030626
"PKG",194,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",194,22,1,"PAH",1,1,2,0)
under patch USR*1*24.
"PRE")
USREN24
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","USREN24")
0^1^B3224708
"RTN","USREN24",1,0)
USREN24 ; SLC/MAM - Environment Check Rtn for USR*1*24;6/19/03
"RTN","USREN24",2,0)
 ;;1.0;AUTHORIZATION/SUBSCRIPTION;**24**;Jun 20, 1997
"RTN","USREN24",3,0)
MAIN ; Check environment
"RTN","USREN24",4,0)
 ; -- Set data for User Class to export:
"RTN","USREN24",5,0)
 D SETXTMP
"RTN","USREN24",6,0)
 ; -- Check for potential duplicate User Class at site:
"RTN","USREN24",7,0)
 N USRDUPS
"RTN","USREN24",8,0)
 S USRDUPS=$$USRDUPS
"RTN","USREN24",9,0)
 I +USRDUPS S XPDABORT=1 W !,"Aborting Install..." Q
"RTN","USREN24",10,0)
 W !,"User Classes look OK."
"RTN","USREN24",11,0)
 Q
"RTN","USREN24",12,0)
 ;
"RTN","USREN24",13,0)
SETXTMP ; Set data for new User Class into ^XTMP:
"RTN","USREN24",14,0)
 ;    Use exterior data:
"RTN","USREN24",15,0)
 S ^XTMP("USR24",0)=304301_U_DT
"RTN","USREN24",16,0)
 ; -- Use only 30 chars for User Class Name because of B XREF:
"RTN","USREN24",17,0)
 S ^XTMP("USR24","USRCLAS",.01)="DGPF PATIENT RECORD FLAGS MGR"
"RTN","USREN24",18,0)
 S ^XTMP("USR24","USRCLAS",.02)="PRFM"
"RTN","USREN24",19,0)
 S ^XTMP("USR24","USRCLAS",.03)="Active"
"RTN","USREN24",20,0)
 S ^XTMP("USR24","USRCLAS",.04)="DGPF Patient Record Flags Mgr"
"RTN","USREN24",21,0)
 Q
"RTN","USREN24",22,0)
 ;
"RTN","USREN24",23,0)
USRDUPS(SILENT) ; Return IEN if site already has User Class
"RTN","USREN24",24,0)
 ; If not, return 0
"RTN","USREN24",25,0)
 N NAME,USRDUPS,USRY
"RTN","USREN24",26,0)
 ; -- When looking for duplicates, ignore User Class if created
"RTN","USREN24",27,0)
 ;    by this patch:
"RTN","USREN24",28,0)
 I $G(^XTMP("USR24","DONE")) Q 0
"RTN","USREN24",29,0)
 ; -- If site already has User Class w/ same name as the one we
"RTN","USREN24",30,0)
 ;    export, set USRDUPS=1:
"RTN","USREN24",31,0)
 S USRDUPS=0,NAME=^XTMP("USR24","USRCLAS",.01)
"RTN","USREN24",32,0)
 S USRY=$O(^USR(8930,"B",NAME,0))
"RTN","USREN24",33,0)
 I +USRY'>0 Q 0
"RTN","USREN24",34,0)
 S USRDUPS=+USRY
"RTN","USREN24",35,0)
 I '$G(SILENT) D
"RTN","USREN24",36,0)
 . W !,"You already have the User Class exported by this patch. I don't want"
"RTN","USREN24",37,0)
 . W !,"to overwrite it. Please change its name so it no longer matches the"
"RTN","USREN24",38,0)
 . W !,"exported one, or if you are not using it, delete it.  For help, contact"
"RTN","USREN24",39,0)
 . W !,"National VistA Support."
"RTN","USREN24",40,0)
 Q USRDUPS
"RTN","USRPS24")
0^2^B22317652
"RTN","USRPS24",1,0)
USRPS24 ; SLC/MAM -  After installing TIU*1.0*165;6/18/03
"RTN","USRPS24",2,0)
 ;;1.0;AUTHORIZATION/SUBSCRIPTION;**24**;Jun 20, 1997
"RTN","USRPS24",3,0)
 ; Run this after installing patch 165.
"RTN","USRPS24",4,0)
 ;Use option: TIU165 DDEFS & RULES, PRF
"RTN","USRPS24",5,0)
 ;
"RTN","USRPS24",6,0)
MAIN ; Create new User Class & new Business Rules
"RTN","USRPS24",7,0)
 ; -- Check for potential dup User Class created after install
"RTN","USRPS24",8,0)
 ;    but before option:
"RTN","USRPS24",9,0)
 K ^TMP("USR24",$J)
"RTN","USRPS24",10,0)
 D SETXTMP^USREN24
"RTN","USRPS24",11,0)
 N USRDUPS,TMPCNT,SILENT
"RTN","USRPS24",12,0)
 S TMPCNT=0
"RTN","USRPS24",13,0)
 S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)=""
"RTN","USRPS24",14,0)
 S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="        ***** User Class and Rules for PATIENT RECORD FLAGS *****"
"RTN","USRPS24",15,0)
 S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)=""
"RTN","USRPS24",16,0)
 S SILENT=1
"RTN","USRPS24",17,0)
 S USRDUPS=$$USRDUPS^USREN24(SILENT)
"RTN","USRPS24",18,0)
 I $G(USRDUPS) D  G MAINX
"RTN","USRPS24",19,0)
 . S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="Duplicate problem.  See description for patch TIU*1*165,"
"RTN","USRPS24",20,0)
 . S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="in the National Patch Module."
"RTN","USRPS24",21,0)
 N DONE,SUCCESS
"RTN","USRPS24",22,0)
 ; -- If User Class previously created by this patch,
"RTN","USRPS24",23,0)
 ;    say so and quit:
"RTN","USRPS24",24,0)
 S DONE=+$G(^XTMP("USR24","DONE"))
"RTN","USRPS24",25,0)
 I DONE>0 D  G MAINX
"RTN","USRPS24",26,0)
 . S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="User Class and, presumably, Business Rules"
"RTN","USRPS24",27,0)
 . S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="    were already created in a previous install."
"RTN","USRPS24",28,0)
 ; -- Create new User Class:
"RTN","USRPS24",29,0)
 D NEWCLASS(.SUCCESS,.TMPCNT)
"RTN","USRPS24",30,0)
 ; -- Create new Business Rules:
"RTN","USRPS24",31,0)
 I SUCCESS D NEWRULES(.TMPCNT)
"RTN","USRPS24",32,0)
MAINX ; Exit
"RTN","USRPS24",33,0)
 S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)=""
"RTN","USRPS24",34,0)
 S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="                             *********"
"RTN","USRPS24",35,0)
 Q
"RTN","USRPS24",36,0)
 ;
"RTN","USRPS24",37,0)
NEWCLASS(SUCCESS,TMPCNT) ; Create one new User Class in file 8930
"RTN","USRPS24",38,0)
 N FDA,USRIEN,CLASSDA
"RTN","USRPS24",39,0)
 S SUCCESS=1
"RTN","USRPS24",40,0)
 ; -- Create new User Class:
"RTN","USRPS24",41,0)
 M FDA(8930,"+1,")=^XTMP("USR24","USRCLAS")
"RTN","USRPS24",42,0)
 D UPDATE^DIE("E","FDA","USRIEN")
"RTN","USRPS24",43,0)
 S CLASSDA=+$G(USRIEN(1))
"RTN","USRPS24",44,0)
 I CLASSDA'>0 D  Q
"RTN","USRPS24",45,0)
 . S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="Couldn't create a User Class named "_^XTMP("USR24","USRCLAS",.01)_"."
"RTN","USRPS24",46,0)
 . S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="    Please contact National VistA Support."
"RTN","USRPS24",47,0)
 . S SUCCESS=0
"RTN","USRPS24",48,0)
 S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="User Class named "_^XTMP("USR24","USRCLAS",.01)
"RTN","USRPS24",49,0)
 S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="    created successfully."
"RTN","USRPS24",50,0)
 ; -- Set "DONE" node to IEN:
"RTN","USRPS24",51,0)
 S ^XTMP("USR24","DONE")=CLASSDA
"RTN","USRPS24",52,0)
 Q
"RTN","USRPS24",53,0)
 ;
"RTN","USRPS24",54,0)
NEWRULES(TMPCNT) ; Create new Business Rule
"RTN","USRPS24",55,0)
 ; Create rule for ONE User Class & ONE DDEF
"RTN","USRPS24",56,0)
 ; -- Set data for rule:
"RTN","USRPS24",57,0)
 D SETDATA(.TMPCNT)
"RTN","USRPS24",58,0)
 N NUM,SUCCESS
"RTN","USRPS24",59,0)
 S SUCCESS=1,NUM=0
"RTN","USRPS24",60,0)
 ; -- Loop through numbered list of rules (one, in this case):
"RTN","USRPS24",61,0)
 I '$O(^XTMP("USR24","RULES",0)) S SUCCESS=0 Q
"RTN","USRPS24",62,0)
 F  S NUM=$O(^XTMP("USR24","RULES",NUM)) Q:'NUM  D
"RTN","USRPS24",63,0)
 . N USRERR,FDA,DESC
"RTN","USRPS24",64,0)
 . M FDA(8930.1,"+1,")=^XTMP("USR24","RULES",NUM)
"RTN","USRPS24",65,0)
 . M DESC=^XTMP("USR24","RULESDESC")
"RTN","USRPS24",66,0)
 . S FDA(8930.1,"+1,",1)="DESC"
"RTN","USRPS24",67,0)
 . D UPDATE^DIE("","FDA","","USRERR")
"RTN","USRPS24",68,0)
 . I $D(USRERR) S SUCCESS=0 Q
"RTN","USRPS24",69,0)
 . K ^XTMP("USR24","RULES",NUM)
"RTN","USRPS24",70,0)
 K ^XTMP("USR24","RULESDESC")
"RTN","USRPS24",71,0)
 I '$G(SUCCESS) D  Q
"RTN","USRPS24",72,0)
 . S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)=""
"RTN","USRPS24",73,0)
 . S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="Problem creating Business Rule. Please contact National VistA Support."
"RTN","USRPS24",74,0)
 S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)=""
"RTN","USRPS24",75,0)
 S TMPCNT=TMPCNT+1,^TMP("USR24",$J,TMPCNT)="Business Rule created successfully."
"RTN","USRPS24",76,0)
 Q
"RTN","USRPS24",77,0)
 ;
"RTN","USRPS24",78,0)
SETDATA(TMPCNT) ; Set data for rule
"RTN","USRPS24",79,0)
 ; -- Set data for exported Rule into Rule node of ^XTMP.
"RTN","USRPS24",80,0)
 ;    Use interior data since there may be dup DDEF names.
"RTN","USRPS24",81,0)
 ;    Must set AFTER User Class is created:
"RTN","USRPS24",82,0)
 N DDEFIEN,USRCLASS,EXACTION,INACTION,EXSTATUS,INSTATUS
"RTN","USRPS24",83,0)
 ; -- Get IEN of DDEF Number 1. (DDEF Number 1 is DC,
"RTN","USRPS24",84,0)
 ;    PATIENT RECORD FLAG CAT I.  See ^TIUEN165.)
"RTN","USRPS24",85,0)
 S DDEFIEN=$G(^XTMP("TIU165","BASICS",1,"DONE"))
"RTN","USRPS24",86,0)
 I DDEFIEN'>0 D  G SETX
"RTN","USRPS24",87,0)
 . S TMPCNT=TMPCNT+1,^TMP("USR23",$J,TMPCNT)=""
"RTN","USRPS24",88,0)
 . S TMPCNT=TMPCNT+1,^TMP("USR23",$J,TMPCNT)="Can't find Document Definition for rules. Contact National VistA Support."
"RTN","USRPS24",89,0)
 ; -- Get IEN of User Class created earlier:
"RTN","USRPS24",90,0)
 S USRCLASS=+$G(^XTMP("USR24","DONE"))
"RTN","USRPS24",91,0)
 ; -- Set data for flds .01 (DDEF) and .04 (User Class) for rule:
"RTN","USRPS24",92,0)
 S ^XTMP("USR24","RULES",1,.01)=DDEFIEN
"RTN","USRPS24",93,0)
 S ^XTMP("USR24","RULES",1,.04)=USRCLASS
"RTN","USRPS24",94,0)
 ; -- Set rule desc data:
"RTN","USRPS24",95,0)
 S ^XTMP("USR24","RULESDESC",1)="This rule limits note entry to persons specially trained to assign and"
"RTN","USRPS24",96,0)
 S ^XTMP("USR24","RULESDESC",2)="document the assignment of Category I Patient Record Flags."
"RTN","USRPS24",97,0)
 S ^XTMP("USR24","RULESDESC",3)="Sites must not alter or delete this User Class."
"RTN","USRPS24",98,0)
 S ^XTMP("USR24","RULESDESC",4)="Sites must not alter, delete, or override this rule."
"RTN","USRPS24",99,0)
 S ^XTMP("USR24","RULESDESC",5)="Rule created by patch USR*1*24."
"RTN","USRPS24",100,0)
 ; -- Set action and status data for rule:
"RTN","USRPS24",101,0)
 S EXACTION="ENTRY"
"RTN","USRPS24",102,0)
 S INACTION=$O(^USR(8930.8,"B",EXACTION,0))
"RTN","USRPS24",103,0)
 S ^XTMP("USR24","RULES",1,.03)=INACTION
"RTN","USRPS24",104,0)
 S EXSTATUS="UNTRANSCRIBED"
"RTN","USRPS24",105,0)
 S INSTATUS=$O(^USR(8930.6,"B",EXSTATUS,0))
"RTN","USRPS24",106,0)
 S ^XTMP("USR24","RULES",1,.02)=INSTATUS
"RTN","USRPS24",107,0)
SETX ;
"RTN","USRPS24",108,0)
 Q
"VER")
8.0^22.0
**END**
**END**
