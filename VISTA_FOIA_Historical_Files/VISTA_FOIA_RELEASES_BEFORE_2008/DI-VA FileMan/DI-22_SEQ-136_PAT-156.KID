Released DI*22*156 SEQ #136
Extracted from mail message
**KIDS**:DI*22.0*156^

**INSTALL NAME**
DI*22.0*156
"BLD",730,0)
DI*22.0*156^VA FILEMAN^0^3070608^y
"BLD",730,1,0)
^^2^2^3070608^
"BLD",730,1,1,0)
See patch DI*22*156 in the National Patch Module on FORUM for complete
"BLD",730,1,2,0)
information on this patch.
"BLD",730,4,0)
^9.64PA^^
"BLD",730,6.3)
1
"BLD",730,"KRN",0)
^9.67PA^8989.52^19
"BLD",730,"KRN",.4,0)
.4
"BLD",730,"KRN",.401,0)
.401
"BLD",730,"KRN",.402,0)
.402
"BLD",730,"KRN",.403,0)
.403
"BLD",730,"KRN",.5,0)
.5
"BLD",730,"KRN",.84,0)
.84
"BLD",730,"KRN",3.6,0)
3.6
"BLD",730,"KRN",3.8,0)
3.8
"BLD",730,"KRN",9.2,0)
9.2
"BLD",730,"KRN",9.8,0)
9.8
"BLD",730,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",730,"KRN",9.8,"NM",1,0)
DIR1^^0^B25120452
"BLD",730,"KRN",9.8,"NM","B","DIR1",1)

"BLD",730,"KRN",19,0)
19
"BLD",730,"KRN",19.1,0)
19.1
"BLD",730,"KRN",101,0)
101
"BLD",730,"KRN",409.61,0)
409.61
"BLD",730,"KRN",771,0)
771
"BLD",730,"KRN",870,0)
870
"BLD",730,"KRN",8989.51,0)
8989.51
"BLD",730,"KRN",8989.52,0)
8989.52
"BLD",730,"KRN",8994,0)
8994
"BLD",730,"KRN","B",.4,.4)

"BLD",730,"KRN","B",.401,.401)

"BLD",730,"KRN","B",.402,.402)

"BLD",730,"KRN","B",.403,.403)

"BLD",730,"KRN","B",.5,.5)

"BLD",730,"KRN","B",.84,.84)

"BLD",730,"KRN","B",3.6,3.6)

"BLD",730,"KRN","B",3.8,3.8)

"BLD",730,"KRN","B",9.2,9.2)

"BLD",730,"KRN","B",9.8,9.8)

"BLD",730,"KRN","B",19,19)

"BLD",730,"KRN","B",19.1,19.1)

"BLD",730,"KRN","B",101,101)

"BLD",730,"KRN","B",409.61,409.61)

"BLD",730,"KRN","B",771,771)

"BLD",730,"KRN","B",870,870)

"BLD",730,"KRN","B",8989.51,8989.51)

"BLD",730,"KRN","B",8989.52,8989.52)

"BLD",730,"KRN","B",8994,8994)

"BLD",730,"PRE")
DI156ENV
"BLD",730,"QUES",0)
^9.62^^
"BLD",730,"REQB",0)
^9.611^1^1
"BLD",730,"REQB",1,0)
DI*22.0*73^2
"BLD",730,"REQB","B","DI*22.0*73",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
VA FILEMAN^DI^FM INIT
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
22.0^2990330^3051028^41
"PKG",5,22,1,"PAH",1,0)
156^3070608
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3070608
"PKG",5,22,1,"PAH",1,1,1,0)
See patch DI*22*156 in the National Patch Module on FORUM for complete
"PKG",5,22,1,"PAH",1,1,2,0)
information on this patch.
"PRE")
DI156ENV
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DI156ENV")
0^^B3758519^n/a
"RTN","DI156ENV",1,0)
DI156ENV ;IRMFO-SF/FM STAFF-ENVIRONMENT CHECK ROUTINE ;12:08 PM  8 Jun 2007
"RTN","DI156ENV",2,0)
 ;;22.0;VA FileMan;**156**;Mar 30, 1999;Build 1
"RTN","DI156ENV",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DI156ENV",4,0)
 ;
"RTN","DI156ENV",5,0)
 ; Check XPDENV 0 = Loading; 1 = Installing
"RTN","DI156ENV",6,0)
 I 'XPDENV D  Q  ; Loading Distribution - No Check
"RTN","DI156ENV",7,0)
 . Q
"RTN","DI156ENV",8,0)
 ;
"RTN","DI156ENV",9,0)
INSCHK ; Do Checks During Install Only
"RTN","DI156ENV",10,0)
 W $C(7)
"RTN","DI156ENV",11,0)
 D MES^XPDUTL("** Although Queuing is allowed - it is HIGHLY recommended that ALL Users and")
"RTN","DI156ENV",12,0)
 D MES^XPDUTL("VISTA Background jobs be STOPPED before installation of this patch.  Failure")
"RTN","DI156ENV",13,0)
 D MES^XPDUTL("to do so may result in 'source routine edited' error(s). Edits will be")
"RTN","DI156ENV",14,0)
 D MES^XPDUTL("lost and record(s) may be left in an inconsistent state, for example,")
"RTN","DI156ENV",15,0)
 D MES^XPDUTL("not all Cross-Referencing completed; which in turn may cause FUTURE")
"RTN","DI156ENV",16,0)
 D MES^XPDUTL("VistA/FileMan Hard Errors or corrupted Data. **")
"RTN","DI156ENV",17,0)
 ;
"RTN","DI156ENV",18,0)
TMCHK ; Check to see if TaskMan is still running
"RTN","DI156ENV",19,0)
 S X=$$TM^%ZTLOAD
"RTN","DI156ENV",20,0)
 I X,'$D(^%ZTSCH("WAIT")) D
"RTN","DI156ENV",21,0)
 . W $C(7)
"RTN","DI156ENV",22,0)
 . D BMES^XPDUTL("* Warning TaskMan Has NOT Been Stopped or Placed in a WAIT State!")
"RTN","DI156ENV",23,0)
 ;
"RTN","DI156ENV",24,0)
LINH ; Check to see if Logons are Inhibited
"RTN","DI156ENV",25,0)
 D GETENV^%ZOSV  ; $P(Y,"^",2) = Installing Volume
"RTN","DI156ENV",26,0)
 S X=+$G(^%ZIS(14.5,"LOGON",$P(Y,"^",2)))
"RTN","DI156ENV",27,0)
 I 'X D
"RTN","DI156ENV",28,0)
 . W $C(7)
"RTN","DI156ENV",29,0)
 . D BMES^XPDUTL("* Warning Logons are NOT Inhibited!")
"RTN","DI156ENV",30,0)
 Q
"RTN","DIR1")
0^1^B25120452^B25092531
"RTN","DIR1",1,0)
DIR1 ;SFISC/XAK-READER-MAID (PROCESS DATATYPE) ;11:41 AM  8 Jun 2007
"RTN","DIR1",2,0)
 ;;22.0;VA FileMan;**1,5,73,156**;Mar 30, 1999;Build 1
"RTN","DIR1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIR1",4,0)
 S %E=0 D @%T S:X?.E1C.E %E=1 Q:'%E!(X'?.E1L.E)!(%A["S")!(%A["Y")!((%T=1)&(%B["P"))!(%A["P")
"RTN","DIR1",5,0)
 F %Y=1:1:$L(X) I $E(X,%Y)?1L S X=$E(X,1,%Y-1)_$C($A(X,%Y)-32)_$E(X,%Y+1,999)
"RTN","DIR1",6,0)
 G DIR1
"RTN","DIR1",7,0)
Y ; YES/NO
"RTN","DIR1",8,0)
S ; SET
"RTN","DIR1",9,0)
 N %BU,%K,%M,%J,DDH
"RTN","DIR1",10,0)
 I $L(X)>245 S %E=1,Y="" Q  ;DI*156
"RTN","DIR1",11,0)
 I %T="S",$D(DIR("S"))#2 S DIC("S")=DIR("S")
"RTN","DIR1",12,0)
 S %BA=$S($D(DIC("S")):DIC("S"),1:"I 1")
"RTN","DIR1",13,0)
 S (%J,%K,DDH)=0
"RTN","DIR1",14,0)
 I %B'[":",$O(DIR("C",""))]"" D
"RTN","DIR1",15,0)
 . ;Look for match on internal code
"RTN","DIR1",16,0)
 . S %I="" F  S %I=$O(DIR("C",%I)) Q:%I=""  S %J=DIR("C",%I) I X=$P(%J,":") S Y=X,Y(0)=$P(%J,":",2) X %BA S:'$T %I="" Q
"RTN","DIR1",17,0)
 . ;If not found, look for match on external code
"RTN","DIR1",18,0)
 . I %I="" F  S %I=$O(DIR("C",%I)) Q:%I=""  S %J=DIR("C",%I) I $F(%J,":"_X) S Y=$P(%J,":") X %BA I  S %K=%K+1,%K(%K)=%J Q:%A["o"  I $D(DIQUIET),X=$P(%J,":",2) Q
"RTN","DIR1",19,0)
 . ;If still no match, convert X and choices to uppercase, search again
"RTN","DIR1",20,0)
 . I %I="",%A'["X",'%K D
"RTN","DIR1",21,0)
 .. S %M=X N X S X=$$UP^DILIBF(%M)
"RTN","DIR1",22,0)
 .. F  S %I=$O(DIR("C",%I)) Q:%I=""  S %J1=DIR("C",%I),%J=$$UP^DILIBF(%J1) I X=$P(%J,":") S Y=$P(%J1,":"),Y(0)=$P(%J1,":",2) X %BA S:'$T %I="" Q
"RTN","DIR1",23,0)
 .. I %I="" F  S %I=$O(DIR("C",%I)) Q:%I=""  S %J1=DIR("C",%I),%J=$$UP^DILIBF(%J1) I $F(%J,":"_X) S Y=$P(%J1,":") X %BA I  S %K=%K+1,%K(%K)=%J1 Q:%A["o"  I $D(DIQUIET),X=$P(%J,":",2) Q
"RTN","DIR1",24,0)
 . S %J=%I
"RTN","DIR1",25,0)
 E  D
"RTN","DIR1",26,0)
 . S Y(0)=$P($P(";"_%B,";"_X_":",2),";") I Y(0)]"" S Y=X X %BA I  S %J=1
"RTN","DIR1",27,0)
 . I '%J F %I=1:1 S %J=$P(%B,";",%I) Q:%J=""  S Y=$F(%J,":"_X) I Y S Y=$P(%J,":") X %BA I  S %K=%K+1,%K(%K)=%J Q:%A["o"  I $D(DIQUIET),X=$P(%J,":",2) Q
"RTN","DIR1",28,0)
 . I %J="",%A'["X",'%K D
"RTN","DIR1",29,0)
 .. S %BU=$$UP^DILIBF(%B),%M=X N X S X=$$UP^DILIBF(%M)
"RTN","DIR1",30,0)
 .. S Y=$F(";"_%BU,";"_X_":") I Y D  X %BA I  S %J=1 Q
"RTN","DIR1",31,0)
 ... S Y(0)=$P($E(";"_%B,Y,999),";")
"RTN","DIR1",32,0)
 ... S Y=$L($E(";"_%B,1,Y-1),";"),Y=$P($P(";"_%B,";",Y),":")
"RTN","DIR1",33,0)
 .. F %I=1:1 S %J=$P(%BU,";",%I),%J1=$P(%B,";",%I) Q:%J=""  S Y=$F(%J,":"_X) I Y S Y=$P(%J1,":") X %BA I  S %K=%K+1,%K(%K)=%J1 Q:%A["o"  I $D(DIQUIET),X=$P(%J,":",2) Q
"RTN","DIR1",34,0)
 I %K=1 S Y=$P(%K(1),":"),Y(0)=$P(%K(1),":",2)
"RTN","DIR1",35,0)
 I %K>1,$G(DIQUIET) S %E=1 Q
"RTN","DIR1",36,0)
 I %K>1 D CH Q:%E=1  I '$D(%K(%I)) S X=%I G S
"RTN","DIR1",37,0)
 I %J="",'%K S %E=1 Q
"RTN","DIR1",38,0)
 I %A'["V",$D(DDS)[0 W $S((%K=1!('%K))&($P(Y(0),X)=""):$E(Y(0),$L(X)+1,99),1:"  "_Y(0))
"RTN","DIR1",39,0)
 I %T="Y" S (%,Y)=+$$PRS^DIALOGU(7001,$E(X)) S:%<0 (%,Y)="" S:%=2 Y=0
"RTN","DIR1",40,0)
 Q
"RTN","DIR1",41,0)
 ;
"RTN","DIR1",42,0)
CH ;
"RTN","DIR1",43,0)
 N DIY,DDD,DDC,DS,DD
"RTN","DIR1",44,0)
 F %I=1:1:%K S A0="     "_%I_"   "_$P(%K(%I),":",2) D MSG
"RTN","DIR1",45,0)
 I '$D(DDS) S A0="Choose 1-"_%K_": " D MSG R %I:$S($D(DIR("T")):DIR("T"),'$D(DTIME):300,1:DTIME)
"RTN","DIR1",46,0)
 I $D(DDS) S DDD=2,DDC=5,(DS,DD)=%K D LIST^DDSU S %I=DIY
"RTN","DIR1",47,0)
 I U[%I!(%I?1."?") S X="?",%E=1 Q
"RTN","DIR1",48,0)
 I $D(%K(%I)) S Y=$P(%K(%I),":"),Y(0)=$P(%K(%I),":",2)
"RTN","DIR1",49,0)
 Q
"RTN","DIR1",50,0)
 ;
"RTN","DIR1",51,0)
MSG ;
"RTN","DIR1",52,0)
 I $D(DDS),A0]"" S DDH=$G(DDH)+1,DS(DDH)=$P(%K(%I),":"),DDH(DDH,DDH)=$P(%K(%I),":",2)
"RTN","DIR1",53,0)
 I '$D(DDS) W !,A0
"RTN","DIR1",54,0)
 K A0
"RTN","DIR1",55,0)
 Q
"RTN","DIR1",56,0)
 ;
"RTN","DIR1",57,0)
L ; LIST OR RANGE
"RTN","DIR1",58,0)
 D L^DIR3
"RTN","DIR1",59,0)
 Q
"RTN","DIR1",60,0)
D ; DATE
"RTN","DIR1",61,0)
 D ^%DT I Y<0 S %E=1 Q
"RTN","DIR1",62,0)
 I %D1["NOW"!(%D2["NOW")&($P("NOW",$$UP^DILIBF(X))="") S:%D1["NOW" %B1=Y S:%D2["NOW" %B2=Y
"RTN","DIR1",63,0)
 I %B1,Y<%B1 S %E=1 S:'%N %W="Response must not precede "_+$E(%B1,4,5)_"/"_+$E(%B1,6,7)_"/"_(1700+$E(%B1,1,3)) Q
"RTN","DIR1",64,0)
 I Y>%B2 S %E=1 S:'%N %W="Response must not follow "_+$E(%B2,4,5)_"/"_+$E(%B2,6,7)_"/"_(1700+$E(%B2,1,3))
"RTN","DIR1",65,0)
 S Y(1)=Y X ^DD("DD") S Y(0)=Y,Y=Y(1) K Y(1)
"RTN","DIR1",66,0)
 Q
"RTN","DIR1",67,0)
 ;
"RTN","DIR1",68,0)
N ; NUMERIC
"RTN","DIR1",69,0)
 I $L($P(X,"."))>24 S %E=1 Q
"RTN","DIR1",70,0)
 I X'?.1"-".N.1".".N S %E=1 Q
"RTN","DIR1",71,0)
 I X>%B2!(X<%B1) S %E=1 S:'%N %W="Response must be no "_$S(X>%B2:"greater",1:"less")_" than "_$S(X>%B2:%B2,1:+%B1) Q
"RTN","DIR1",72,0)
 I '%E,($L($P(+X,".",2))>%B3) S %E=1 S:'%N %W="Response must be with no more than "_+%B3_" decimal digit"_$S(%B3>1:"s",1:"") Q
"RTN","DIR1",73,0)
 S Y=+X
"RTN","DIR1",74,0)
 Q
"RTN","DIR1",75,0)
 ;
"RTN","DIR1",76,0)
F ; FREETEXT
"RTN","DIR1",77,0)
 S Y=X I X[U,%A'["U" S %E=1
"RTN","DIR1",78,0)
 S:'%N %W="This response must have at least "_+%B1_" character"_$S(+%B1>1:"s",1:"")_" and no more than "_%B2_" characters"_$S(%A'["U":" and must not contain embedded uparrow",1:"")
"RTN","DIR1",79,0)
 I $L(X)<%B1!($L(X)>%B2) S %E=1
"RTN","DIR1",80,0)
 Q
"RTN","DIR1",81,0)
 ;
"RTN","DIR1",82,0)
E ; END-OF-PAGE
"RTN","DIR1",83,0)
 S Y=X="" S:X=U (DUOUT,DIRUT)=1 I $L(X),X'=U S %E=1
"RTN","DIR1",84,0)
 Q
"RTN","DIR1",85,0)
 ;
"RTN","DIR1",86,0)
P ; POINTER
"RTN","DIR1",87,0)
 S:'$D(DDS) %B2=$P(%B2,"L")_$P(%B2,"L",2)
"RTN","DIR1",88,0)
 I %B2["A" S %B2=$P(%B2,"A")_$P(%B2,"A",2)
"RTN","DIR1",89,0)
 S:$D(DIR("S"))#2 DIC("S")=DIR("S")
"RTN","DIR1",90,0)
 S DIC=%B1,DIC(0)=%B2,%C=X D P1
"RTN","DIR1",91,0)
 I $D(X)#2,X="",Y<0 S %E=-1
"RTN","DIR1",92,0)
 E  S %E=Y<0
"RTN","DIR1",93,0)
 S X=%C
"RTN","DIR1",94,0)
 Q
"RTN","DIR1",95,0)
P1 N %A,%B,%C,%N,%P,%T,%W D ^DIC
"RTN","DIR1",96,0)
 Q
"RTN","DIR1",97,0)
 ;
"RTN","DIR1",98,0)
1 ; DD
"RTN","DIR1",99,0)
 S %C=X N %W I %B["P"!(%B["V") N DIE
"RTN","DIR1",100,0)
 I %B["F" S Y=X I X[U,$P($P(%B3,U,4),";",2)'?1"E"1.N1","1.N S %E=1 Q
"RTN","DIR1",101,0)
 I %B["S" S %B=$P(%B3,U,3),%BU=$$UP^DILIBF(%B) X:$D(^DD(%B1,%B2,12.1)) ^(12.1) D S S X=Y,%B=$P(%B3,U,2) G R
"RTN","DIR1",102,0)
 I %B["P" S DIC=U_$P(%B3,U,3),DIE=DIC,DIC(0)=$E("L",%B'["'"&$D(DDS))_$E("E",$D(DIR("V"))[0)_"MZ" I %B'["*" D P1 S X=+Y,%E=Y<0
"RTN","DIR1",103,0)
 I %B["V" D
"RTN","DIR1",104,0)
 . N %A,%B,%C,%N,%P,%T,%W
"RTN","DIR1",105,0)
 . S (DIE,DP)=%B1,DIFLD=%B2,DQ=1
"RTN","DIR1",106,0)
 . D ^DIE3
"RTN","DIR1",107,0)
 . S %E=Y'>0 S:Y>0 Y(0)=$P(Y,U,2)
"RTN","DIR1",108,0)
R D IT:'%E S X=%C
"RTN","DIR1",109,0)
 Q
"RTN","DIR1",110,0)
IT D
"RTN","DIR1",111,0)
 . N %A,%B,%C,%N,%P,%T,%W N:'$G(DIRDINUM) DINUM
"RTN","DIR1",112,0)
 . I $P(%B3,U,2)["N",$P(%B3,U,5,99)'["$",X?.1"-".N.1".".N,$P(%B3,U,5,99)["+X'=X" S X=+X
"RTN","DIR1",113,0)
 . X $P(%B3,U,5,99)
"RTN","DIR1",114,0)
 S %E='$D(X)
"RTN","DIR1",115,0)
 I '%E,%B'["P" S Y=X
"RTN","DIR1",116,0)
 I '%E,%B["D" X ^DD("DD") S Y(0)=Y,Y=X
"RTN","DIR1",117,0)
 Q
"RTN","DIR1",118,0)
 ;
"RTN","DIR1",119,0)
 ;#7001  Yes/No question
"VER")
8^22.0
"BLD",730,6)
^136
**END**
**END**
