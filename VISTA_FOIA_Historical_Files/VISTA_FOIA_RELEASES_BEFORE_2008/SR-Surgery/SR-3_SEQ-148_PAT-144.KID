Released SR*3*144 SEQ #148
Extracted from mail message
**KIDS**:SR*3.0*144^

**INSTALL NAME**
SR*3.0*144
"BLD",5296,0)
SR*3.0*144^SURGERY^0^3060406^y
"BLD",5296,1,0)
^^48^48^3060403^
"BLD",5296,1,1,0)
This patch is part of the Patient Financial Services System (PFSS) 
"BLD",5296,1,2,0)
project. PFSS patches are being released on various schedules. Some patch
"BLD",5296,1,3,0)
functionality will not be active until a new PFSS switch is activated
"BLD",5296,1,4,0)
during final implementation. PFSS will initially be implemented at select
"BLD",5296,1,5,0)
pilot sites ONLY.
"BLD",5296,1,6,0)
 
"BLD",5296,1,7,0)
The purpose of the PFSS project is to prepare the Veterans Health 
"BLD",5296,1,8,0)
Information Systems and Technology Architecture (VistA) environment for 
"BLD",5296,1,9,0)
the implementation of a Commercial Off-The-Shelf (COTS) billing 
"BLD",5296,1,10,0)
replacement system. The project consists of the implementation of the 
"BLD",5296,1,11,0)
billing replacement system, business process improvements, and 
"BLD",5296,1,12,0)
enhancements to VistA to support integration with the COTS billing 
"BLD",5296,1,13,0)
replacement system. Significant changes to VistA legacy systems and 
"BLD",5296,1,14,0)
ancillary packages are necessary.
"BLD",5296,1,15,0)
 
"BLD",5296,1,16,0)
Some of the PFSS software components are not operational until the PFSS 
"BLD",5296,1,17,0)
On/Off Switch, distributed with patch IB*2*260, is set to "ON". The 
"BLD",5296,1,18,0)
ability for the local site to set the switch to "ON" will be provided at 
"BLD",5296,1,19,0)
the appropriate time with the release of a subsequent Integrated Billing 
"BLD",5296,1,20,0)
patch.
"BLD",5296,1,21,0)
 
"BLD",5296,1,22,0)
For more information about the PFSS project, review the documentation 
"BLD",5296,1,23,0)
accompanying this patch and refer to the following website: 
"BLD",5296,1,24,0)
http://vista.med.va.gov/billreplace/
"BLD",5296,1,25,0)
 
"BLD",5296,1,26,0)
Features of patch SR*3*144 are listed below:
"BLD",5296,1,27,0)
 
"BLD",5296,1,28,0)
1. The VistA Surgery software will be enhanced to request an account
"BLD",5296,1,29,0)
   number for every Surgery Request Consult. This activity will support
"BLD",5296,1,30,0)
   the Revenue Office's need to pre-certify with insurance companies the
"BLD",5296,1,31,0)
   requested Surgery. A national guideline will be issued defining the
"BLD",5296,1,32,0)
   minimum format for creating a Surgery Request Consult within the VistA
"BLD",5296,1,33,0)
   Consults package that will collect the data required by PFSS. The
"BLD",5296,1,34,0)
   Surgery Request Consult will not create a Surgery case. This guideline
"BLD",5296,1,35,0)
   does not require that sites use the Consults package for creating
"BLD",5296,1,36,0)
   Surgery requests. Sites using VistA Surgery Request options can
"BLD",5296,1,37,0)
   continue to use that approach.
"BLD",5296,1,38,0)
 
"BLD",5296,1,39,0)
   VistA Surgery will be enhanced to also request a PFSS ACCOUNT
"BLD",5296,1,40,0)
   REFERENCE, and it will be stored in the PFSS ACCOUNT REFERENCE field
"BLD",5296,1,41,0)
   (#500) of the SURGERY file (#130). The association to a PFSS ACCOUNT
"BLD",5296,1,42,0)
   REFERENCE is obtained when the Surgery case is created and is sent to
"BLD",5296,1,43,0)
   the PATIENT CARE ENCOUNTER (PCE) application upon completion of coding.
"BLD",5296,1,44,0)
 
"BLD",5296,1,45,0)
2. This patch changes the List Completed Cases Missing CPT Codes [SRSCPT]
"BLD",5296,1,46,0)
   option to list only those completed cases that do not have a final CPT 
"BLD",5296,1,47,0)
   code entered in the PRINCIPAL PROCEDURE CODE field (#.02) of the
"BLD",5296,1,48,0)
   SURGERY PROCEDURE/DIAGNOSIS CODES file (#136).
"BLD",5296,4,0)
^9.64PA^130^1
"BLD",5296,4,130,0)
130
"BLD",5296,4,130,2,0)
^9.641^130^1
"BLD",5296,4,130,2,130,0)
SURGERY  (File-top level)
"BLD",5296,4,130,2,130,1,0)
^9.6411^32^3
"BLD",5296,4,130,2,130,1,.09,0)
DATE OF OPERATION
"BLD",5296,4,130,2,130,1,32,0)
PRINCIPAL PRE-OP DIAGNOSIS
"BLD",5296,4,130,2,130,1,500,0)
PFSS ACCOUNT REFERENCE
"BLD",5296,4,130,222)
y^y^p^^^^n^^n
"BLD",5296,4,130,224)

"BLD",5296,4,"APDD",130,130)

"BLD",5296,4,"APDD",130,130,.09)

"BLD",5296,4,"APDD",130,130,32)

"BLD",5296,4,"APDD",130,130,500)

"BLD",5296,4,"B",130,130)

"BLD",5296,6)
5^
"BLD",5296,"KRN",0)
^9.67PA^8989.52^19
"BLD",5296,"KRN",.4,0)
.4
"BLD",5296,"KRN",.401,0)
.401
"BLD",5296,"KRN",.402,0)
.402
"BLD",5296,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",5296,"KRN",.403,0)
.403
"BLD",5296,"KRN",.5,0)
.5
"BLD",5296,"KRN",.84,0)
.84
"BLD",5296,"KRN",3.6,0)
3.6
"BLD",5296,"KRN",3.8,0)
3.8
"BLD",5296,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",5296,"KRN",3.8,"NM",1,0)
SR CONSULT^^0
"BLD",5296,"KRN",3.8,"NM","B","SR CONSULT",1)

"BLD",5296,"KRN",9.2,0)
9.2
"BLD",5296,"KRN",9.8,0)
9.8
"BLD",5296,"KRN",9.8,"NM",0)
^9.68A^15^14
"BLD",5296,"KRN",9.8,"NM",1,0)
SRCHL7A^^0^B18837235
"BLD",5296,"KRN",9.8,"NM",2,0)
SRCHL7U^^0^B3165191
"BLD",5296,"KRN",9.8,"NM",3,0)
SROERR^^0^B34000236
"BLD",5296,"KRN",9.8,"NM",4,0)
SROERR0^^0^B18120820
"BLD",5296,"KRN",9.8,"NM",6,0)
SROVAR^^0^B31317243
"BLD",5296,"KRN",9.8,"NM",7,0)
SRSCAN0^^0^B15578926
"BLD",5296,"KRN",9.8,"NM",8,0)
SRONEW^^0^B31106190
"BLD",5296,"KRN",9.8,"NM",9,0)
SROPFSS^^0^B8994664
"BLD",5296,"KRN",9.8,"NM",10,0)
SRSCHUN^^0^B27018282
"BLD",5296,"KRN",9.8,"NM",11,0)
SRSRQST^^0^B26274386
"BLD",5296,"KRN",9.8,"NM",12,0)
SROPCEP^^0^B79067516
"BLD",5296,"KRN",9.8,"NM",13,0)
SRSCAN2^^0^B12532535
"BLD",5296,"KRN",9.8,"NM",14,0)
SRSCPT1^^0^B14019263
"BLD",5296,"KRN",9.8,"NM",15,0)
SRSCPT2^^0^B15586528
"BLD",5296,"KRN",9.8,"NM","B","SRCHL7A",1)

"BLD",5296,"KRN",9.8,"NM","B","SRCHL7U",2)

"BLD",5296,"KRN",9.8,"NM","B","SROERR",3)

"BLD",5296,"KRN",9.8,"NM","B","SROERR0",4)

"BLD",5296,"KRN",9.8,"NM","B","SRONEW",8)

"BLD",5296,"KRN",9.8,"NM","B","SROPCEP",12)

"BLD",5296,"KRN",9.8,"NM","B","SROPFSS",9)

"BLD",5296,"KRN",9.8,"NM","B","SROVAR",6)

"BLD",5296,"KRN",9.8,"NM","B","SRSCAN0",7)

"BLD",5296,"KRN",9.8,"NM","B","SRSCAN2",13)

"BLD",5296,"KRN",9.8,"NM","B","SRSCHUN",10)

"BLD",5296,"KRN",9.8,"NM","B","SRSCPT1",14)

"BLD",5296,"KRN",9.8,"NM","B","SRSCPT2",15)

"BLD",5296,"KRN",9.8,"NM","B","SRSRQST",11)

"BLD",5296,"KRN",19,0)
19
"BLD",5296,"KRN",19.1,0)
19.1
"BLD",5296,"KRN",101,0)
101
"BLD",5296,"KRN",101,"NM",0)
^9.68A^1^1
"BLD",5296,"KRN",101,"NM",1,0)
SR RECEIVE^^0
"BLD",5296,"KRN",101,"NM","B","SR RECEIVE",1)

"BLD",5296,"KRN",409.61,0)
409.61
"BLD",5296,"KRN",771,0)
771
"BLD",5296,"KRN",870,0)
870
"BLD",5296,"KRN",8989.51,0)
8989.51
"BLD",5296,"KRN",8989.52,0)
8989.52
"BLD",5296,"KRN",8994,0)
8994
"BLD",5296,"KRN","B",.4,.4)

"BLD",5296,"KRN","B",.401,.401)

"BLD",5296,"KRN","B",.402,.402)

"BLD",5296,"KRN","B",.403,.403)

"BLD",5296,"KRN","B",.5,.5)

"BLD",5296,"KRN","B",.84,.84)

"BLD",5296,"KRN","B",3.6,3.6)

"BLD",5296,"KRN","B",3.8,3.8)

"BLD",5296,"KRN","B",9.2,9.2)

"BLD",5296,"KRN","B",9.8,9.8)

"BLD",5296,"KRN","B",19,19)

"BLD",5296,"KRN","B",19.1,19.1)

"BLD",5296,"KRN","B",101,101)

"BLD",5296,"KRN","B",409.61,409.61)

"BLD",5296,"KRN","B",771,771)

"BLD",5296,"KRN","B",870,870)

"BLD",5296,"KRN","B",8989.51,8989.51)

"BLD",5296,"KRN","B",8989.52,8989.52)

"BLD",5296,"KRN","B",8994,8994)

"BLD",5296,"QUES",0)
^9.62^^
"BLD",5296,"REQB",0)
^9.611^5^3
"BLD",5296,"REQB",3,0)
IB*2.0*315^2
"BLD",5296,"REQB",4,0)
SR*3.0*147^2
"BLD",5296,"REQB",5,0)
SR*3.0*152^2
"BLD",5296,"REQB","B","IB*2.0*315",3)

"BLD",5296,"REQB","B","SR*3.0*147",4)

"BLD",5296,"REQB","B","SR*3.0*152",5)

"FIA",130)
SURGERY
"FIA",130,0)
^SRF(
"FIA",130,0,0)
130IP
"FIA",130,0,1)
y^y^p^^^^n^^n
"FIA",130,0,10)

"FIA",130,0,11)

"FIA",130,0,"RLRO")

"FIA",130,0,"VR")
3.0^SR
"FIA",130,130)
1
"FIA",130,130,.09)

"FIA",130,130,32)

"FIA",130,130,500)

"IX",130,130,"AD",0)
130^AD^CoreFLS fields monitor flag.^MU^^R^IR^I^130^^^^^A
"IX",130,130,"AD",.1,0)
^^2^2^3020822^
"IX",130,130,"AD",.1,1,0)
This cross-reference will be checked before sending a notification to
"IX",130,130,"AD",.1,2,0)
the CoreFLS software after editing any of these fields.
"IX",130,130,"AD",1)
S ^TMP("CSLSUR1",$J)="" Q
"IX",130,130,"AD",1.4)
N I S (X,I)=0 F  S I=$O(X1(I)) Q:'I  I X1(I)'=X2(I) S X=1 Q
"IX",130,130,"AD",2)
S ^TMP("CSLSUR1",$J)="" Q
"IX",130,130,"AD",2.4)
N I S (X,I)=0 F  S I=$O(X1(I)) Q:'I  I X1(I)'=X2(I) S X=1 Q
"IX",130,130,"AD",2.5)
Q
"IX",130,130,"AD",11.1,0)
^.114IA^11^11
"IX",130,130,"AD",11.1,1,0)
1^F^130^.14^^^F
"IX",130,130,"AD",11.1,2,0)
2^F^130^27^^^F
"IX",130,130,"AD",11.1,3,0)
3^F^130^.02^^^F
"IX",130,130,"AD",11.1,4,0)
4^F^130^.04^^^F
"IX",130,130,"AD",11.1,5,0)
5^F^130^10^^^F
"IX",130,130,"AD",11.1,6,0)
6^F^130^11^^^F
"IX",130,130,"AD",11.1,7,0)
7^F^130^26^^^F
"IX",130,130,"AD",11.1,8,0)
8^F^130^.011^^^F
"IX",130,130,"AD",11.1,9,0)
9^F^130^.09^^^F
"IX",130,130,"AD",11.1,10,0)
10^F^130^35^^^F
"IX",130,130,"AD",11.1,11,0)
11^F^130^.164^^^F
"IX",130,130,"AES8",0)
130^AES8^Update TIU when Date of Operation is changed.^MU^^F^IR^I^130^^^^^A
"IX",130,130,"AES8",.1,0)
^^3^3^3020729^^
"IX",130,130,"AES8",.1,1,0)
This cross-reference is responsible for updating the REFERENCE DATE field 
"IX",130,130,"AES8",.1,2,0)
(#1301) in the TIU DOCUMENT file (#8925) for all Reports when the 
"IX",130,130,"AES8",.1,3,0)
DATE OF OPERATION field (#9) in the SURGERY file (#130) is edited.
"IX",130,130,"AES8",1)
D AES8^SROESX0 Q
"IX",130,130,"AES8",1.4)
S X=((X1(1)'=X2(1))&(X2(1)'=""))
"IX",130,130,"AES8",2)
Q
"IX",130,130,"AES8",11.1,0)
^.114IA^1^1
"IX",130,130,"AES8",11.1,1,0)
1^F^130^.09^^^F
"IX",130,130,"AK",0)
130^AK^PFSS field monitor flag.^MU^^F^IR^I^130^^^^^A
"IX",130,130,"AK",.1,0)
^^2^2^3051020^
"IX",130,130,"AK",.1,1,0)
This cross-reference will be checked before sending a notification to the
"IX",130,130,"AK",.1,2,0)
PFSS after editing the Date Of Operation field.
"IX",130,130,"AK",1)
I ($P(X1(1),".")'=$P(X2(1),"."))&(X2(1)'="") S ^TMP("SRPFSS",$J)="" Q
"IX",130,130,"AK",1.4)
Q
"IX",130,130,"AK",2)
I ($P(X1(1),".")'=$P(X2(1),"."))&(X1(1)'="") S ^TMP("SRPFSS",$J)="" Q
"IX",130,130,"AK",2.4)
Q
"IX",130,130,"AK",11.1,0)
^.114IA^1^1
"IX",130,130,"AK",11.1,1,0)
1^F^130^.09^^^F
"KRN",3.8,315,-1)
0^1
"KRN",3.8,315,0)
SR CONSULT^PU^^^^^
"KRN",3.8,315,2,0)
^3.801^3^3^3051028^^^^
"KRN",3.8,315,2,1,0)
This mail group is intended to alert Surgery personnel that a Surgery 
"KRN",3.8,315,2,2,0)
Request Consultation has been entered and does not contain the minimum 
"KRN",3.8,315,2,3,0)
required elements to initiate a pre-certification.
"KRN",3.8,315,3)

"KRN",101,5213,-1)
0^1
"KRN",101,5213,0)
SR RECEIVE^Surgery receives HL7 msgs^^A^^^^^^^^
"KRN",101,5213,20)
D EN^SRCHL7A(.XQORMSG)
"KRN",101,5213,99)
60312,45030
"MBREQ")
0
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",167,-1)
1^1
"PKG",167,0)
SURGERY^SR^SURGICAL DATA COLLECTION AND OPERATIONS SCHEDULING
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2930624^2930811
"PKG",167,22,1,"PAH",1,0)
144^3060406^100000000031
"PKG",167,22,1,"PAH",1,1,0)
^^48^48^3060406
"PKG",167,22,1,"PAH",1,1,1,0)
This patch is part of the Patient Financial Services System (PFSS) 
"PKG",167,22,1,"PAH",1,1,2,0)
project. PFSS patches are being released on various schedules. Some patch
"PKG",167,22,1,"PAH",1,1,3,0)
functionality will not be active until a new PFSS switch is activated
"PKG",167,22,1,"PAH",1,1,4,0)
during final implementation. PFSS will initially be implemented at select
"PKG",167,22,1,"PAH",1,1,5,0)
pilot sites ONLY.
"PKG",167,22,1,"PAH",1,1,6,0)
 
"PKG",167,22,1,"PAH",1,1,7,0)
The purpose of the PFSS project is to prepare the Veterans Health 
"PKG",167,22,1,"PAH",1,1,8,0)
Information Systems and Technology Architecture (VistA) environment for 
"PKG",167,22,1,"PAH",1,1,9,0)
the implementation of a Commercial Off-The-Shelf (COTS) billing 
"PKG",167,22,1,"PAH",1,1,10,0)
replacement system. The project consists of the implementation of the 
"PKG",167,22,1,"PAH",1,1,11,0)
billing replacement system, business process improvements, and 
"PKG",167,22,1,"PAH",1,1,12,0)
enhancements to VistA to support integration with the COTS billing 
"PKG",167,22,1,"PAH",1,1,13,0)
replacement system. Significant changes to VistA legacy systems and 
"PKG",167,22,1,"PAH",1,1,14,0)
ancillary packages are necessary.
"PKG",167,22,1,"PAH",1,1,15,0)
 
"PKG",167,22,1,"PAH",1,1,16,0)
Some of the PFSS software components are not operational until the PFSS 
"PKG",167,22,1,"PAH",1,1,17,0)
On/Off Switch, distributed with patch IB*2*260, is set to "ON". The 
"PKG",167,22,1,"PAH",1,1,18,0)
ability for the local site to set the switch to "ON" will be provided at 
"PKG",167,22,1,"PAH",1,1,19,0)
the appropriate time with the release of a subsequent Integrated Billing 
"PKG",167,22,1,"PAH",1,1,20,0)
patch.
"PKG",167,22,1,"PAH",1,1,21,0)
 
"PKG",167,22,1,"PAH",1,1,22,0)
For more information about the PFSS project, review the documentation 
"PKG",167,22,1,"PAH",1,1,23,0)
accompanying this patch and refer to the following website: 
"PKG",167,22,1,"PAH",1,1,24,0)
http://vista.med.va.gov/billreplace/
"PKG",167,22,1,"PAH",1,1,25,0)
 
"PKG",167,22,1,"PAH",1,1,26,0)
Features of patch SR*3*144 are listed below:
"PKG",167,22,1,"PAH",1,1,27,0)
 
"PKG",167,22,1,"PAH",1,1,28,0)
1. The VistA Surgery software will be enhanced to request an account
"PKG",167,22,1,"PAH",1,1,29,0)
   number for every Surgery Request Consult. This activity will support
"PKG",167,22,1,"PAH",1,1,30,0)
   the Revenue Office's need to pre-certify with insurance companies the
"PKG",167,22,1,"PAH",1,1,31,0)
   requested Surgery. A national guideline will be issued defining the
"PKG",167,22,1,"PAH",1,1,32,0)
   minimum format for creating a Surgery Request Consult within the VistA
"PKG",167,22,1,"PAH",1,1,33,0)
   Consults package that will collect the data required by PFSS. The
"PKG",167,22,1,"PAH",1,1,34,0)
   Surgery Request Consult will not create a Surgery case. This guideline
"PKG",167,22,1,"PAH",1,1,35,0)
   does not require that sites use the Consults package for creating
"PKG",167,22,1,"PAH",1,1,36,0)
   Surgery requests. Sites using VistA Surgery Request options can
"PKG",167,22,1,"PAH",1,1,37,0)
   continue to use that approach.
"PKG",167,22,1,"PAH",1,1,38,0)
 
"PKG",167,22,1,"PAH",1,1,39,0)
   VistA Surgery will be enhanced to also request a PFSS ACCOUNT
"PKG",167,22,1,"PAH",1,1,40,0)
   REFERENCE, and it will be stored in the PFSS ACCOUNT REFERENCE field
"PKG",167,22,1,"PAH",1,1,41,0)
   (#500) of the SURGERY file (#130). The association to a PFSS ACCOUNT
"PKG",167,22,1,"PAH",1,1,42,0)
   REFERENCE is obtained when the Surgery case is created and is sent to
"PKG",167,22,1,"PAH",1,1,43,0)
   the PATIENT CARE ENCOUNTER (PCE) application upon completion of coding.
"PKG",167,22,1,"PAH",1,1,44,0)
 
"PKG",167,22,1,"PAH",1,1,45,0)
2. This patch changes the List Completed Cases Missing CPT Codes [SRSCPT]
"PKG",167,22,1,"PAH",1,1,46,0)
   option to list only those completed cases that do not have a final CPT 
"PKG",167,22,1,"PAH",1,1,47,0)
   code entered in the PRINCIPAL PROCEDURE CODE field (#.02) of the
"PKG",167,22,1,"PAH",1,1,48,0)
   SURGERY PROCEDURE/DIAGNOSIS CODES file (#136).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","SRCHL7A")
0^1^B18837235
"RTN","SRCHL7A",1,0)
SRCHL7A ;BIR/SJA - RECEIVE HL-7 CONSULTS MESSAGE, PARSE INTO COMPONENTS AND CALL PFSS GET ACCOUNT API ;12/17/04  05:10 PM
"RTN","SRCHL7A",2,0)
 ;;3.0; Surgery ;**144**;24 Jun 93
"RTN","SRCHL7A",3,0)
 ;
"RTN","SRCHL7A",4,0)
 ; Reference to $$GETACCT^IBBAPI() is supported by DBIA #4664
"RTN","SRCHL7A",5,0)
 ; Reference to ^GMR(123.5 is supported by DBIA #3861
"RTN","SRCHL7A",6,0)
 ; Reference to ^DIC(40.7 is supported by DBIA #557
"RTN","SRCHL7A",7,0)
 ; Reference to ^DG(40.8 is supported by DBIA #2817
"RTN","SRCHL7A",8,0)
 Q
"RTN","SRCHL7A",9,0)
ORC(SRCORC) ;Get fields from ORC segment.
"RTN","SRCHL7A",10,0)
 ;SRCTRLC=ORC control code
"RTN","SRCHL7A",11,0)
 ;SRCORNP=provider
"RTN","SRCHL7A",12,0)
 I $E(SRCMSG,1,6)'="ORC|NW" S SRCQT=1 Q
"RTN","SRCHL7A",13,0)
 S SRCTRLC=$P(SRCORC,"|",2)
"RTN","SRCHL7A",14,0)
 S SRCORNP=$P(SRCORC,"|",13)
"RTN","SRCHL7A",15,0)
 S SRCODT=$P(SRCORC,"|",16)
"RTN","SRCHL7A",16,0)
 Q
"RTN","SRCHL7A",17,0)
OBR(SRCOBR) ;Get fields from OBR segment.
"RTN","SRCHL7A",18,0)
 ;SRCSS=type of consult, field 9, 1-4 if NO, then not surgery
"RTN","SRCHL7A",19,0)
 ;Must have 99CON in SRC99C.
"RTN","SRCHL7A",20,0)
 ;SRCODT=observation date/time
"RTN","SRCHL7A",21,0)
 S SRC99C=$P($P(SRCOBR,"|",5),"^",6)
"RTN","SRCHL7A",22,0)
 I SRC99C'="99CON" S SRCSS="NO",SRCQT=1 Q
"RTN","SRCHL7A",23,0)
 S SRCSST=$P($P(SRCOBR,"|",5),"^",4)
"RTN","SRCHL7A",24,0)
 S SRCSS=$$GET1^DIQ(123.5,SRCSST,.01) D
"RTN","SRCHL7A",25,0)
 .I SRCSS["SURGERY REQUEST" S SRCSS=1 Q
"RTN","SRCHL7A",26,0)
 .;then not surgery
"RTN","SRCHL7A",27,0)
 .S SRCSS="NO"
"RTN","SRCHL7A",28,0)
 I SRCSS="NO" S SRCQT=1 Q
"RTN","SRCHL7A",29,0)
 S SRCODT=$P(SRCOBR,"|",7)
"RTN","SRCHL7A",30,0)
 I SRCODT]"" S SRCODT=$$FMDATE^SRCHL7U(SRCODT)
"RTN","SRCHL7A",31,0)
 S SRCATN=$P(SRCOBR,"|",20)
"RTN","SRCHL7A",32,0)
 S SRCSTDT=$P(SRCOBR,"|",23)
"RTN","SRCHL7A",33,0)
 I SRCSTDT]"" S SRCSTDT=$$FMDATE^SRCHL7U(SRCSTDT)
"RTN","SRCHL7A",34,0)
 S SRCINTR=$P(SRCOBR,"|",33)
"RTN","SRCHL7A",35,0)
 Q
"RTN","SRCHL7A",36,0)
ZSV(SRCZSV) ;Get service from ZSV segment
"RTN","SRCHL7A",37,0)
 S SRCZSS=$P($P(SRCZSV,"|",2),"^",4)
"RTN","SRCHL7A",38,0)
 ;Set the service if ZSV provided
"RTN","SRCHL7A",39,0)
 I $L($P(SRCZSV,"|",3)) S SRCOTXT=$P(SRCZSV,"|",3) ;consult type
"RTN","SRCHL7A",40,0)
 Q
"RTN","SRCHL7A",41,0)
OBX(SRCOBX) ;Get fields from OBX segment and set into SRC variables
"RTN","SRCHL7A",42,0)
 ;SRCOID=observation id identifying value in seg. 5
"RTN","SRCHL7A",43,0)
 ;free text or code^free text^I9C
"RTN","SRCHL7A",44,0)
 S SRCMSG=MSG(SRCOBX)
"RTN","SRCHL7A",45,0)
 S SRCOID=$P($P(SRCMSG,"|",4),"^",2)
"RTN","SRCHL7A",46,0)
 I SRCOID="REASON FOR REQUEST" D
"RTN","SRCHL7A",47,0)
 .S LN=0 F  S LN=$O(MSG(SRCOBX,LN)) Q:LN=""  S SRCRF(LN+1)=$G(MSG(SRCOBX,LN)),SRCRFL=SRCRF(LN+1),SRCRF=$$UP^XLFSTR($G(SRCRF(LN+1))) D
"RTN","SRCHL7A",48,0)
 ..I SRCRF["DATE OF OPERATION:" S (SRDOP,X)=$P(SRCRFL,": ",2),%DT="XT" D ^%DT S:Y>0 SRCPV2(8)=Y I Y'>0 D NOW^%DTC S SRCPV2(8)=X Q
"RTN","SRCHL7A",49,0)
 ..I $P(SRCRF,":")="SURGEON" S SRCPV1(17)=$$FN($P(SRCRFL,": ",2)) Q
"RTN","SRCHL7A",50,0)
 ..I SRCRF["ATTENDING SURGEON:" S SRCPV1(7)=$$FN($P(SRCRFL,": ",2)) Q
"RTN","SRCHL7A",51,0)
 ..I SRCRF["SURGICAL SPECIALTY:" S SRX=$O(^SRO(137.45,"B1",$P(SRCRFL,": ",2),0)) Q
"RTN","SRCHL7A",52,0)
 ..I SRCRF["PRINCIPAL PREOPERATIVE DIAGNOSIS:" D
"RTN","SRCHL7A",53,0)
 ...S II=LN F  S II=$O(MSG(SRCOBX,II)) Q:MSG(SRCOBX,II)=""!($L(SRCRF)>70)  S SRCRFL=SRCRFL_" "_$G(MSG(SRCOBX,II))
"RTN","SRCHL7A",54,0)
 ...S SRCDG1(1,4)=$E($P(SRCRFL,": ",2),1,40) Q
"RTN","SRCHL7A",55,0)
 ..I SRCRF["PRINCIPAL OPERATIVE PROCEDURE:" D
"RTN","SRCHL7A",56,0)
 ...S II=LN F  S II=$O(MSG(SRCOBX,II)) Q:MSG(SRCOBX,II)=""!($L(SRCRF)>90)  S SRCRFL=SRCRFL_" "_$G(MSG(SRCOBX,II))
"RTN","SRCHL7A",57,0)
 ...S SRCPR1(4)=$E($P(SRCRFL,": ",2),1,60) Q
"RTN","SRCHL7A",58,0)
 S SRCPV1(18)=$O(^DIC(40.7,"C",429,0)) I SRX S SRCSURG(2)=$P($G(^SRO(137.45,SRX,0)),"^",2),SRCPV1(3)=$P($G(^SRO(137.45,SRX,0)),"^",5)
"RTN","SRCHL7A",59,0)
 S SRCPV1(2)="O"
"RTN","SRCHL7A",60,0)
 Q
"RTN","SRCHL7A",61,0)
EN(MSG) ;Entry point from protocol SR RECEIVE
"RTN","SRCHL7A",62,0)
 Q:'+$$SWSTAT^IBBAPI()
"RTN","SRCHL7A",63,0)
 ;MSG = local array which contains the HL7 segments
"RTN","SRCHL7A",64,0)
 N LN,SRC99C,SRCARFN,SRCATN,SRCDG1,SRCDIV,SRCINTR,SRCMSG,SRCNOD
"RTN","SRCHL7A",65,0)
 N SRCOBR,SRCOBX,SRCODT,SRCOID,SRCORNP,SRCOTXT,SRCPNM,SRCPR1,SRCPV2,SRCQT
"RTN","SRCHL7A",66,0)
 N SRCRATSN,SRCRB,SRCRF,SRCRFL,SRCSEND,SRCSS,SRCSST,SRCSTDT,SRCSURG,SRX
"RTN","SRCHL7A",67,0)
 N SRCTRLC,SRCZSS,SRDFN,SRDOP,Y
"RTN","SRCHL7A",68,0)
 S SRCMSG="",SRCNOD=0,SRCPV2(8)=0,(SRCPV1(7),SRCPV1(17),SRCSURG(2),SRCDG1(1,4),SRCPR1(4))=""
"RTN","SRCHL7A",69,0)
 F  S SRCNOD=$O(MSG(SRCNOD)) Q:SRCNOD=""  S SRCMSG=$G(MSG(SRCNOD)) I $E(SRCMSG,1,3)="MSH" D  Q
"RTN","SRCHL7A",70,0)
 .S SRCSEND=$P(SRCMSG,"|",3),SRCDIV=$O(^DG(40.8,"AD",$P(SRCMSG,"|",4),0))
"RTN","SRCHL7A",71,0)
 ;SRCQT, stop flag in loop
"RTN","SRCHL7A",72,0)
 S SRCMSG="",SRCNOD=0,SRCQT=0
"RTN","SRCHL7A",73,0)
 F  S SRCNOD=$O(MSG(SRCNOD)) Q:SRCNOD=""  Q:SRCQT=1  S SRCMSG=$G(MSG(SRCNOD)) D
"RTN","SRCHL7A",74,0)
 .I $E(SRCMSG,1,3)="PID" D PID^SRCHL7U(SRCMSG) Q
"RTN","SRCHL7A",75,0)
 .;look at ORC|NW for new order
"RTN","SRCHL7A",76,0)
 .I $E(SRCMSG,1,3)="ORC" D ORC(SRCMSG) Q
"RTN","SRCHL7A",77,0)
 .I SRCQT=1 Q
"RTN","SRCHL7A",78,0)
 .I $E(SRCMSG,1,3)="OBR" D OBR(SRCMSG) I SRCSS="NO" S SRCQT=1 Q
"RTN","SRCHL7A",79,0)
 .I SRCQT=1 Q
"RTN","SRCHL7A",80,0)
 .;look at ZSV for surgery (4)
"RTN","SRCHL7A",81,0)
 .I $E(SRCMSG,1,3)="ZSV" D ZSV(SRCMSG) Q
"RTN","SRCHL7A",82,0)
 .I $E(SRCMSG,1,3)="OBX" D OBX(SRCNOD) Q
"RTN","SRCHL7A",83,0)
 I SRCSS="NO" Q  ;not surgery request
"RTN","SRCHL7A",84,0)
 I SRCPV2(8)'>0!(SRCSURG(2)="")!(SRCDG1(1,4)="")!(SRCPR1(4)="") D REJECT^SRCHL7U Q
"RTN","SRCHL7A",85,0)
 ;check for new order, NW, and a surgery consult in SRCSS
"RTN","SRCHL7A",86,0)
 I '$D(SRCTRLC)!(SRCTRLC'="NW")!('$D(SRCSS))!(SRCSS="NO") D EXIT^SRCHL7U Q
"RTN","SRCHL7A",87,0)
ACCT S SRCARFN=+$$GETACCT^IBBAPI(SRDFN,"","A05","ACCT;SRCHL7A",.SRCPV1,.SRCPV2,.SRCPR1,.SRCDG1,"",SRCDIV,"",.SRCSURG)
"RTN","SRCHL7A",88,0)
 I '$G(SRCARFN) D REJECT^SRCHL7U Q
"RTN","SRCHL7A",89,0)
 D EXIT^SRCHL7U
"RTN","SRCHL7A",90,0)
 Q
"RTN","SRCHL7A",91,0)
FN(X) ;Return New Person Code give Name from HL-7 segment
"RTN","SRCHL7A",92,0)
 I X["(" Q +$P(X,"(",2)
"RTN","SRCHL7A",93,0)
 K DIC S DIC="^VA(200,",DIC(0)="XM" D ^DIC K DIC
"RTN","SRCHL7A",94,0)
 Q $S(Y'=-1:+Y,1:"")
"RTN","SRCHL7U")
0^2^B3165191
"RTN","SRCHL7U",1,0)
SRCHL7U ;BIR/SJA - Receive HL-7 Surgery Request Consults Message (continued) ;12/27/04  11:41 AM
"RTN","SRCHL7U",2,0)
 ;;3.0; Surgery ;**144**;24 Jun 93
"RTN","SRCHL7U",3,0)
 ;
"RTN","SRCHL7U",4,0)
 Q
"RTN","SRCHL7U",5,0)
PID(SRCPID) ;Get fields from PID segment.
"RTN","SRCHL7U",6,0)
 S SRDFN=$P(SRCPID,"|",4),SRCPNM=$P(SRCPID,"|",6)
"RTN","SRCHL7U",7,0)
 Q
"RTN","SRCHL7U",8,0)
REJECT ;can't be filed send reject message
"RTN","SRCHL7U",9,0)
 ;send message to mail group SR CONSULT
"RTN","SRCHL7U",10,0)
 S DFN=SRDFN D DEM^VADPT
"RTN","SRCHL7U",11,0)
 K XMY S XMDUZ="SURGERY PACKAGE" D NOW^%DTC S Y=% X ^DD("DD")
"RTN","SRCHL7U",12,0)
 S SRM(1)="The Surgery Request Consult could not be processed for pre-certification."
"RTN","SRCHL7U",13,0)
 S SRM(2)=""
"RTN","SRCHL7U",14,0)
 S SRM(3)="Patient: "_$E(VADM(1),1,20)
"RTN","SRCHL7U",15,0)
 S SRM(4)="Date of Operation: "_SRDOP
"RTN","SRCHL7U",16,0)
 S SRM(5)="Surgeon ID: "_SRCPV1(17)
"RTN","SRCHL7U",17,0)
 S SRM(6)="Attending Surgeon ID: "_SRCPV1(7)
"RTN","SRCHL7U",18,0)
 S SRM(7)="Surgical Specialty: "_SRCSURG(2)
"RTN","SRCHL7U",19,0)
 S SRM(8)="Principal Pre-Op Diagnosis: "_SRCDG1(1,4)
"RTN","SRCHL7U",20,0)
 S SRM(9)="Principal Operative Procedure: "_SRCPR1(4)
"RTN","SRCHL7U",21,0)
 S XMTEXT="SRM(",XMSUB="Surgery Consult Error Log"
"RTN","SRCHL7U",22,0)
 S XMY("G.SR CONSULT")=""
"RTN","SRCHL7U",23,0)
 D ^XMD K XMTEXT,XMY,XMSUB,SRM
"RTN","SRCHL7U",24,0)
EXIT ;Kill variables and exit
"RTN","SRCHL7U",25,0)
 K Y,SRDOP,SRCZSS,SRCTRLC,SRCSURG,SRCSTDT,SRCSST,SRCSS,SRCSEND
"RTN","SRCHL7U",26,0)
 K SRX,SRCRF,SRCRFL,SRCRB,SRCRATSN,SRCQT,SRCPV2,SRCPR1,SRCPNM,SRCOTXT
"RTN","SRCHL7U",27,0)
 K SRCORNP,SRCOID,SRCODT,SRCOCR,SRCOBX,SRCOBR,SRCNOD,SRCMSG,SRCINTR,SRCDIV
"RTN","SRCHL7U",28,0)
 K SRCDG1,SRCATN,SRCARFN,SRC99C,SRDFN,LN
"RTN","SRCHL7U",29,0)
 Q
"RTN","SRCHL7U",30,0)
FMDATE(DATE) ;Convert HL-7 formatted date to a Fileman formatted date
"RTN","SRCHL7U",31,0)
 N X S X=$$HL7TFM^XLFDT(DATE)
"RTN","SRCHL7U",32,0)
 Q X
"RTN","SROERR")
0^3^B34000236^B33489403
"RTN","SROERR",1,0)
SROERR ;B'HAM ISC/MAM,ADM - ORDER ENTRY ROUTINE ;01/22/99  9:47 AM
"RTN","SROERR",2,0)
 ;;3.0; Surgery ;**14,67,73,41,80,86,107,147,144**;24 Jun 93
"RTN","SROERR",3,0)
 ;
"RTN","SROERR",4,0)
 ; Reference to ^ORD(100.99 supported by DBIA #874
"RTN","SROERR",5,0)
 ; Reference to FILE^ORX supported by DBIA #866
"RTN","SROERR",6,0)
 ; Reference to ST^ORX supported by DBIA #866
"RTN","SROERR",7,0)
 ; Reference to NEW^VPRSR supported by DBIA #4750
"RTN","SROERR",8,0)
 ; Reference to DEL^VPRSR supported by DBIA #4750
"RTN","SROERR",9,0)
 ;
"RTN","SROERR",10,0)
CREATE ; create order in ORDER file (100)
"RTN","SROERR",11,0)
 I $P($G(^SRO(133,SRSITE,0)),"^",22)="Y" D
"RTN","SROERR",12,0)
 .N SROP,SROPER,SRTYPE,DYNOTE
"RTN","SROERR",13,0)
 .S SROP=SRTN,SROPER="" D ^SROP1 S SRTYPE=1
"RTN","SROERR",14,0)
 .I SROPER["REQUESTED" Q
"RTN","SROERR",15,0)
 .I $P($G(^SRF(SRTN,"OP")),"^",2)']"" D
"RTN","SROERR",16,0)
 ..W !!,"  This Surgery case does not have a Planned Principal CPT Code entered. The ",!,"  information sent to SPD for creation of a case cart may not contain ",!,"  enough information for processing."
"RTN","SROERR",17,0)
 .I SROPER["SCHEDULED" S SRTYPE=1
"RTN","SROERR",18,0)
 .I SROPER["NOT COMPLETE",$P($G(^SRF(SRTN,.2)),"^",10) S SRTYPE=1
"RTN","SROERR",19,0)
 .D ST^SRSCOR(SRTN)
"RTN","SROERR",20,0)
 D SERR^SROPFSS(SRTN,"SROERR")
"RTN","SROERR",21,0)
 N SREVENT S SREVENT="S12",SROERR=SRTN D STATUS^SROERR0,MSG^SRHLZIU(SRTN,SRSTATUS,SREVENT)
"RTN","SROERR",22,0)
 I $L($T(NEW^VPRSR)) D NEW^VPRSR(SROERR,$G(DFN),SRSTATUS) Q  ;CPRS-R
"RTN","SROERR",23,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 K SROERR Q
"RTN","SROERR",24,0)
 I '$D(^ORD(100.99)) Q
"RTN","SROERR",25,0)
 I '$D(ORPCL) K DIC S DIC="^DIC(19,",X="SR SURGERY REQUEST",DIC(0)="" D ^DIC I Y'=-1 S ORPCL=+Y_";DIC(19,"
"RTN","SROERR",26,0)
REQ S ORNP=SRSDOC,ORPK=SRTN,ORSTRT=SRSDATE S:'$D(ORVP) ORVP=DFN_";DPT(" D:'$D(ORL) LOC
"RTN","SROERR",27,0)
 S:'$D(SROERR) SROERR=SRTN D STATUS^SROERR0 S ORTX=SRSOP_"|>> Case #"_SRTN_" "_SRSTATUS
"RTN","SROERR",28,0)
 I DT<$E(ORSTRT,1,7) S X1=ORSTRT,X2=DT D ^%DTC S ORPURG=X+30
"RTN","SROERR",29,0)
 D FILE^ORX K DIE,DA,DR S DA=SRTN,DIE=130,DR="100////"_ORIFN D ^DIE K DA,DR,DIE,ORIFN,SROERR
"RTN","SROERR",30,0)
 Q
"RTN","SROERR",31,0)
LOC S SRL=$P($G(^DPT(DFN,.1)),"^") I SRL'="" K DIC S DIC="^DIC(42,",X=SRL D ^DIC K DIC S SRL=$S(Y'=-1:+Y,1:"") S:SRL SRL=$P($G(^DIC(42,SRL,44)),"^")
"RTN","SROERR",32,0)
 S ORL=$S(SRL:SRL_";SC(",1:"")
"RTN","SROERR",33,0)
 Q
"RTN","SROERR",34,0)
EN ; entry for OE/RR, process order actions
"RTN","SROERR",35,0)
 S:'$D(ORGY) ORGY="" Q:'$D(ORACTION)!(ORGY=9)  I ORGY=10 S SROERR=ORPK D ^SROERR0 Q
"RTN","SROERR",36,0)
 I ORACTION=7 D PURGE Q
"RTN","SROERR",37,0)
8 I ORACTION=8 D DETAIL S:'$O(ORSLST(ORNXT)) OREND=1 Q
"RTN","SROERR",38,0)
 I "2345"[ORACTION W !!,"Not allowed on Surgical Requests !" Q
"RTN","SROERR",39,0)
 I ORACTION,ORSTS'=5 W !!,"Cannot update/delete case not in 'REQUESTED' status !" Q
"RTN","SROERR",40,0)
 I '$D(^XUSEC("SROREQ",DUZ)) W !!,"You must hold the 'SROREQ' key to perform this function !" G PRESS
"RTN","SROERR",41,0)
 D:'$D(SRSITE) ^SROVAR S DFN=+ORVP D DEM^VADPT I ORACTION=0 S ORPCL=XQORNOD D ADD Q
"RTN","SROERR",42,0)
 I ORACTION=1 D DISPLAY,EDIT Q
"RTN","SROERR",43,0)
 I ORACTION=6 D DISPLAY D DEL^SRSUPRQ G END
"RTN","SROERR",44,0)
 Q
"RTN","SROERR",45,0)
EDIT ; edit requested case
"RTN","SROERR",46,0)
 W !!,"1. Delete",!,"2. Update Request Information",!,"3. Change the Request Date",!!,"Select Number: " R Z:DTIME S:'$T Z="" G:"^"[Z END S:Z["?" Z=4
"RTN","SROERR",47,0)
 I Z<1!(Z>3)!(+Z\1'=Z) W !!,"If you want to delete this request, enter '1'.  Enter '2' if you only want",!,"to update the general information about this case, or '3' to change the date",!,"for which this case is requested." G EDIT
"RTN","SROERR",48,0)
 I Z=1 D DEL^SRSUPRQ G END
"RTN","SROERR",49,0)
 I Z=2 D UPDATE^SRSUPRQ G END
"RTN","SROERR",50,0)
 I Z=3 D CHANGE^SRSDT
"RTN","SROERR",51,0)
END K SRTN D ^SRSKILL
"RTN","SROERR",52,0)
 Q
"RTN","SROERR",53,0)
DISPLAY S SRDFN=+ORVP,SRNM=VADM(1),SRTN=ORPK,SRSDATE=$P(^SRF(SRTN,0),"^",9)
"RTN","SROERR",54,0)
 W @IOF,!,SRNM," (",VA("PID"),")" I $P($G(^DPT(DFN,.35)),"^")'="" S Y=$P(^(.35),"^") D D^DIQ W "   ** DIED: "_Y_" **" G END
"RTN","SROERR",55,0)
 S SRSDT=$E(SRSDATE,4,5)_"/"_$E(SRSDATE,6,7)_"/"_$E(SRSDATE,2,3) S SROPER=$P(^SRF(SRTN,"OP"),"^")_" (#"_SRTN_")"
"RTN","SROERR",56,0)
 K SROPS,MM,MMM S:$L(SROPER)<71 SROPS(1)=SROPER I $L(SROPER)>70 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROERR",57,0)
 W !!,SRSDT,?11,SROPS(1) I $D(SROPS(2)) W !,?11,SROPS(2) I $D(SROPS(3)) W !,?11,SROPS(3)
"RTN","SROERR",58,0)
 Q
"RTN","SROERR",59,0)
LOOP ; break case information if longer than 70 characters
"RTN","SROERR",60,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<70  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROERR",61,0)
 Q
"RTN","SROERR",62,0)
PRESS W !!,"Press RETURN to continue  " R X:DTIME G:'$T END
"RTN","SROERR",63,0)
 Q
"RTN","SROERR",64,0)
DETAIL I $E(IOST)="C" W !!,"Press RETURN to review case information, or '^' to quit.  " R X:DTIME I '$T!(X["^") S OREND=1 Q
"RTN","SROERR",65,0)
 S SRTN=ORPK I $P($G(^SRF(SRTN,"NON")),"^")="Y" D ^SROERR2 G END
"RTN","SROERR",66,0)
 D ^SROERR1,END
"RTN","SROERR",67,0)
 Q
"RTN","SROERR",68,0)
ADD ; add new requests to ORDER file (100)
"RTN","SROERR",69,0)
 W @IOF,!,VADM(1)," (",VA("PID"),")" I $P($G(^DPT(+ORVP,.35)),"^")'="" S Y=$P(^(.35),"^") D D^DIQ W "   ** DIED: "_Y_" **"
"RTN","SROERR",70,0)
 W !!,"Add New Surgery Requests",!!!,"1. Make Operation Requests",!,"2. Make a Request from the Waiting List",!,"3. Make a Request for Concurrent Cases"
"RTN","SROERR",71,0)
 W !!,"Select Number: " R Z:DTIME S:'$T Z="" G:"^"[Z END S:Z["?" Z=4
"RTN","SROERR",72,0)
 I Z<1!(Z>3)!(+Z\1'=Z) W !!,"If you want to make a new operation request, enter '1'.  Enter '2' if you want",!,"to make a request from the surgery waiting list, or '3' to make a request for",!,"concurrent cases." D PRESS G ADD
"RTN","SROERR",73,0)
 I Z=1 D ^SRSMREQ G END
"RTN","SROERR",74,0)
 I Z=2 D ^SRSWREQ G END
"RTN","SROERR",75,0)
 I Z=3 D ^SRSCONR G END
"RTN","SROERR",76,0)
 Q
"RTN","SROERR",77,0)
PURGE ; purge order from ORDER file
"RTN","SROERR",78,0)
 N SREVENT,SRSTATUS S SREVENT="S17",SRSTATUS="(DELETED)" D MSG^SRHLZIU(ORPK,SRSTATUS,SREVENT)
"RTN","SROERR",79,0)
 I $L($T(DEL^VPRSR)) D DEL^VPRSR(ORPK,$G(DFN)) Q  ;CPRS-R
"RTN","SROERR",80,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 Q
"RTN","SROERR",81,0)
 I "589"'[ORSTS S:$D(^SRF(ORPK,0)) $P(^(0),"^",14)="" S ORSTS="K" D ST^ORX
"RTN","SROERR",82,0)
 Q
"RTN","SROERR",83,0)
DEL ; delete from ORDER file (100) and call CoreFLS API
"RTN","SROERR",84,0)
 I $P($G(^SRO(133,SRSITE,0)),"^",22)="Y" D
"RTN","SROERR",85,0)
 .N SRDYNOTE,SRTYPE
"RTN","SROERR",86,0)
 .S SRDYNOTE=$P($G(^SRF(SRTN,31)),"^",10) Q:'SRDYNOTE
"RTN","SROERR",87,0)
 .I SRDYNOTE S SRTYPE=4 D ST^SRSCOR(SRTN)
"RTN","SROERR",88,0)
 N SREVENT,SRSTATUS S SREVENT="S17",SRSTATUS="(DELETED)" D MSG^SRHLZIU(SRTN,SRSTATUS,SREVENT)
"RTN","SROERR",89,0)
 I $L($T(DEL^VPRSR)) D DEL^VPRSR(SRTN,$G(DFN)) Q  ;CPRS-R
"RTN","SROERR",90,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 Q
"RTN","SROERR",91,0)
 S:'$D(ORIFN) ORIFN=$P(^SRF(SRTN,0),"^",14) I $D(ORIFN) S ORSTS="K" D ST^ORX K ORIFN
"RTN","SROERR",92,0)
 Q
"RTN","SROERR0")
0^4^B18120820^B17879401
"RTN","SROERR0",1,0)
SROERR0 ;B'HAM ISC/ADM - ORDER ENTRY ROUTINE ;02/03/05
"RTN","SROERR0",2,0)
 ;;3.0; Surgery ;**4,67,73,41,86,107,147,144**;24 Jun 93
"RTN","SROERR0",3,0)
 ;
"RTN","SROERR0",4,0)
 ; Reference to RETURN^ORX supported by DBIA #866
"RTN","SROERR0",5,0)
 ; Reference to ^TMP("CSLSUR1" supported by DBIA #3498
"RTN","SROERR0",6,0)
 ; Reference to UPD^VPRSR supported by DBIA #4750
"RTN","SROERR0",7,0)
 ;
"RTN","SROERR0",8,0)
 N SROP,SROPER,SRDYNOTE,SRTYPE S SRTYPE=0
"RTN","SROERR0",9,0)
 I $P($G(^SRO(133,SRSITE,0)),"^",22)="Y",$D(^TMP("CSLSUR1",$J)) D
"RTN","SROERR0",10,0)
 .S SROP=SROERR,SROPER="" D ^SROP1 S SRDYNOTE=$P($G(^SRF(SROERR,31)),"^",10)
"RTN","SROERR0",11,0)
 .I SROPER["REQUESTED",'SRDYNOTE Q
"RTN","SROERR0",12,0)
 .I SROPER["CANCELLED"!(SROPER["ABORTED") S SRTYPE=3
"RTN","SROERR0",13,0)
 .I 'SRTYPE,'SRDYNOTE S SRTYPE=1
"RTN","SROERR0",14,0)
 .I 'SRTYPE,SRDYNOTE=1 S SRTYPE=2
"RTN","SROERR0",15,0)
 .I '$P($G(^SRF(SROERR,.2)),"^",10),'$P($G(^SRF(SROERR,"OP")),"^",2) D
"RTN","SROERR0",16,0)
 ..W !!,"  This Surgery case does not have a Principal CPT Code entered. The ",!,"  information sent to SPD for creation of a case cart may not contain ",!,"  enough information for processing."
"RTN","SROERR0",17,0)
 .D ST^SRSCOR(SROERR)
"RTN","SROERR0",18,0)
 D SERR^SROPFSS(SROERR,"SROERR0")
"RTN","SROERR0",19,0)
 D STATUS
"RTN","SROERR0",20,0)
 I '$D(SREVENT) N SREVENT S SREVENT=$S(SRSTATUS="(CANCELLED)":"S15",1:"S14")
"RTN","SROERR0",21,0)
 D MSG^SRHLZIU(SROERR,SRSTATUS,SREVENT)
"RTN","SROERR0",22,0)
 I SRSTATUS="(COMPLETED)"!(SRSTATUS="(NOT COMPLETE)")!(SRSTATUS="(ABORTED)") D MSG^SRHLOORU(SROERR,SRSTATUS,SREVENT)
"RTN","SROERR0",23,0)
 I $L($T(UPD^VPRSR)) D UPD^VPRSR(SROERR,$G(DFN),SRSTATUS) Q  ;CPRS-R
"RTN","SROERR0",24,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 D END Q
"RTN","SROERR0",25,0)
 S:'$G(ORIFN) ORIFN=$P(^SRF(SROERR,0),"^",14) I 'ORIFN K ORIFN D END Q
"RTN","SROERR0",26,0)
 S ORNP=$S($P($G(^SRF(SROERR,"NON")),"^")="Y":$P(^("NON"),"^",6),1:$P(^(.1),"^",4)),SRSOP=$P(^("OP"),"^")
"RTN","SROERR0",27,0)
 S ORTX=SRSOP_"|>> Case #"_SROERR_" "_SRSTATUS,ORSTRT=$P(^SRF(SROERR,0),"^",9)
"RTN","SROERR0",28,0)
 I DT<$E(ORSTRT,1,7) S X1=ORSTRT,X2=DT D ^%DTC S ORPURG=X+30
"RTN","SROERR0",29,0)
 D RETURN^ORX
"RTN","SROERR0",30,0)
END K SROERR
"RTN","SROERR0",31,0)
 Q
"RTN","SROERR0",32,0)
STATUS ; case status
"RTN","SROERR0",33,0)
 I $P($G(^SRF(SROERR,"NON")),"^")="Y" S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=2 S SRSTATUS=$S($P($G(^(30)),"^"):"(ABORTED)",$P($G(^("NON")),"^",5):"(COMPLETED)",1:"(NOT COMPLETE)") Q
"RTN","SROERR0",34,0)
 I $P($G(^SRF(SROERR,30)),"^")'="" D CAN Q
"RTN","SROERR0",35,0)
 I $P($G(^SRF(SROERR,31)),"^",8)'="" D CAN Q
"RTN","SROERR0",36,0)
 I $P($G(^SRF(SROERR,.2)),"^",12) S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=2 S SRSTATUS="(COMPLETED)" Q
"RTN","SROERR0",37,0)
 I $D(^SRF(SROERR,.2)),$P(^(.2),"^",12)="" S SRSTAT=0 D SCH I SRST=0 D REQ Q:SRST  G NO
"RTN","SROERR0",38,0)
 I '$D(^SRF(SROERR,.2)) S SRSTAT=0 D SCH I SRST=0 D REQ Q:SRST=1  G NO
"RTN","SROERR0",39,0)
 Q
"RTN","SROERR0",40,0)
NO ; not requested or scheduled
"RTN","SROERR0",41,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 S ORSTS=9
"RTN","SROERR0",42,0)
 S SRSTATUS="(NOT COMPLETE)"
"RTN","SROERR0",43,0)
 Q
"RTN","SROERR0",44,0)
CAN ; cancelled or aborted
"RTN","SROERR0",45,0)
 I +$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 S ORSTS=1
"RTN","SROERR0",46,0)
 S SR(.2)=$G(^SRF(SROERR,.2)) I $P(SR(.2),"^")!($P(SR(.2),"^",10)) S SRSTATUS="(ABORTED)" Q
"RTN","SROERR0",47,0)
 S SRSTATUS="(CANCELLED)"
"RTN","SROERR0",48,0)
 Q
"RTN","SROERR0",49,0)
SCH ; check to see if case is scheduled
"RTN","SROERR0",50,0)
 I '$D(^SRF(SROERR,31)) S SRST=0 Q
"RTN","SROERR0",51,0)
 I $P($G(^SRF(SROERR,31)),"^",4)="" S SRST=0 Q
"RTN","SROERR0",52,0)
 I $P($G(^SRF(SROERR,31)),"^",4) D:SRSTAT=0 TIM0 D:SRSTAT=1 TIM1 S SRST=1 Q
"RTN","SROERR0",53,0)
 Q
"RTN","SROERR0",54,0)
TIM0 I '$D(^SRF(SROERR,.2)) S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=8 S SRSTATUS="(SCHEDULED)" Q
"RTN","SROERR0",55,0)
 I $P(^SRF(SROERR,.2),"^",2) S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=9 S SRSTATUS="(NOT COMPLETE)" Q
"RTN","SROERR0",56,0)
 I $P(^SRF(SROERR,.2),"^",2)="" S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=8 S SRSTATUS="(SCHEDULED)"
"RTN","SROERR0",57,0)
 Q
"RTN","SROERR0",58,0)
TIM1 S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=8 S SRSTATUS="(SCHEDULED)" Q
"RTN","SROERR0",59,0)
REQ ; check to see if case has been requested
"RTN","SROERR0",60,0)
 I $P($G(^SRF(SROERR,"REQ")),"^")=1,'$D(^SRF(SROERR,.2)) S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=5 S SRSTATUS="(REQUESTED)",SRST=1 Q
"RTN","SROERR0",61,0)
 I $P($G(^SRF(SROERR,"REQ")),"^")=1,$P($G(^(.2)),"^",2)="" S:+$$VERSION^XPDUTL("ORDER ENTRY/RESULTS REPORTING")>2.5 ORSTS=5 S SRSTATUS="(REQUESTED)",SRST=1
"RTN","SROERR0",62,0)
 Q
"RTN","SRONEW")
0^8^B31106190^B19521613
"RTN","SRONEW",1,0)
SRONEW ;B'HAM ISC/MAM - ENTER A NEW CASE ;01/29/01  1:09 PM
"RTN","SRONEW",2,0)
 ;;3.0; Surgery ;**3,23,26,30,47,58,48,67,107,100,144**;24 Jun 93
"RTN","SRONEW",3,0)
 ;
"RTN","SRONEW",4,0)
 ; Reference to ^TMP("CSLSUR1" supported by DBIA #3498
"RTN","SRONEW",5,0)
 ;
"RTN","SRONEW",6,0)
DEAD S SRSOUT=0,X=$P($G(VADM(6)),"^") I X D  I SRSOUT D ^SRSKILL G ^SROP
"RTN","SRONEW",7,0)
 .S SRDEATH=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W @IOF,!,?1,VADM(1)_"   "_VA("PID")_"        * Died "_SRDEATH_" *"
"RTN","SRONEW",8,0)
 .W !!,$C(7) K DIR S DIR("A",1)=">>> The patient you have selected died on "_SRDEATH_"."
"RTN","SRONEW",9,0)
 .S DIR("A")="    Are you sure this is the correct patient ? ",DIR("B")="NO",DIR(0)="YA" D ^DIR K DIR
"RTN","SRONEW",10,0)
 .W @IOF I 'Y!$D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SRONEW",11,0)
 .W !,"Entering a new surgical case for "_VADM(1)_".",!!
"RTN","SRONEW",12,0)
DATE K %DT W ! S %DT("A")="Select the Date of Operation: ",%DT="AEX" D ^%DT I Y<0 W !!,"When entering a new surgery case, a date MUST be entered.  If you do not",!,"know the date of operation, enter this patient on the Waiting List."
"RTN","SRONEW",13,0)
 I Y<0 D CONT G:"Yy"'[SRYN END G DATE
"RTN","SRONEW",14,0)
 G:Y'>0 END S SRSDATE=Y
"RTN","SRONEW",15,0)
 S SRSC1=1 K SRCTN S SRSDPT=DFN,SRSCC="" D CON G:SRSCC="^" END
"RTN","SRONEW",16,0)
OP D ^SROPROC I SRSOUT G END
"RTN","SRONEW",17,0)
 S SRPRIN=SRSOP
"RTN","SRONEW",18,0)
OPD ; Principal Preoperative Diagnosis
"RTN","SRONEW",19,0)
 K DIR S DIR(0)="130,32",DIR("A")="Principal Preoperative Diagnosis" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G END
"RTN","SRONEW",20,0)
 I Y=""!(X["^") W !!,"A Principal Preoperative Diagnosis must be entered",!,"when creating a new case. Enter '^' to exit.",! G OPD
"RTN","SRONEW",21,0)
 I X[";" W !,"The Principal Preoperative Diagnosis cannot contain a semicolon (;).",!,"Please re-enter the Diagnosis, using commas in place of the semicolons." G OPD
"RTN","SRONEW",22,0)
 S SRSOPD=Y
"RTN","SRONEW",23,0)
 W !!,"The information entered into the Principal Preoperative Diagnosis field",!,"has been transferred into the Indications for Operation field.",!,"The Indications for Operation field can be updated later if necessary.",!
"RTN","SRONEW",24,0)
DOC W ! S DIC("A")="Select Surgeon: ",DIC=200,DIC(0)="QEAM",SRSDOC="" D ^DIC K DIC("A") I $D(DTOUT)!(X="^") S SRSOUT=1 G END
"RTN","SRONEW",25,0)
 I Y<0!(X["^") W !!,"A Surgeon must be entered when creating a case.  Enter '^' to exit.",! G DOC
"RTN","SRONEW",26,0)
 S (DA,SRSDOC)=+Y
"RTN","SRONEW",27,0)
 S RESTRICT="130,.14",Y=SRSDOC K SROK D KEY^SROXPR I '$D(SROK) W !!,"The person you selected does not have the appropriate keys necessary to be",!,"entered as a surgeon.  Please make another selection.",! K SRSDOC,DA,DIC G DOC
"RTN","SRONEW",28,0)
CASE ; create case in SURGERY file
"RTN","SRONEW",29,0)
 K DA,DIC,DD,DO,DINUM,SRTN S X=DFN,DIC="^SRF(",DIC(0)="L" D FILE^DICN K DIC S SRTN=+Y G:'$$LOCK^SROUTL(SRTN) DEL
"RTN","SRONEW",30,0)
 S ^SRF(SRTN,8)=SRSITE("DIV"),^SRF(SRTN,"OP")=""
"RTN","SRONEW",31,0)
 K DIE,DR S DA=SRTN,DIE=130,DR=".09////"_SRSDATE_";26////"_SRPRIN_";68////"_SRPRIN_";.14////"_SRSDOC D ^DIE K DR
"RTN","SRONEW",32,0)
ASURG ; attending surgeon
"RTN","SRONEW",33,0)
 K DIR S DIR(0)="130,.164",DIR("A")="Attending Surgeon" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRONEW",34,0)
 I Y=""!(X["^") W !!,"An Attending Surgeon must be entered when creating a case. Enter '^' to exit.",! G ASURG
"RTN","SRONEW",35,0)
 S SRATTND=+Y
"RTN","SRONEW",36,0)
SPEC W ! K DIC S DIC=137.45,DIC(0)="QEAMZ",DIC("A")="Select Surgical Specialty: ",DIC("S")="I '$P(^(0),""^"",3)" D ^DIC I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRONEW",37,0)
 I Y<0!(X["^") W !!,"To create a surgical case, a Surgical Specialty MUST be selected.  Enter '^'",!,"to exit.",! G SPEC
"RTN","SRONEW",38,0)
 S SRSS=+Y
"RTN","SRONEW",39,0)
UPDATE ; update case in SURGERY file
"RTN","SRONEW",40,0)
 S DA=SRTN,DIE=130,DR=".04////"_SRSS_";.164////"_SRATTND_";32////"_SRSOPD D ^DIE K DR
"RTN","SRONEW",41,0)
 S SRSOPD(1)=SRSOPD D WP^DIE(130,SRTN_",",55,"A","SRSOPD")
"RTN","SRONEW",42,0)
 ; Brief Clinical History
"RTN","SRONEW",43,0)
 K DR S DR="60T",DA=SRTN,DIE=130 W ! D ^DIE
"RTN","SRONEW",44,0)
 K DR,DA S DR="[SRO-NOCOMP]",DA=SRTN,DIE=130 D ^DIE K DR
"RTN","SRONEW",45,0)
 S ^SRF(SRTN,8)=SRSITE("DIV") D ^SROXRET
"RTN","SRONEW",46,0)
DIE D ^SROBLOD K DR,DIE,DA S DR="38////"_BLOOD_";40////"_CROSSM,DA=SRTN,DIE=130 D ^DIE K DR,DA,DIE
"RTN","SRONEW",47,0)
 S DR="[SRSRES1]",DIE=130,DA=SRTN D ^DIE,RT S ST="NEW SURGERY" D EN2^SROVAR
"RTN","SRONEW",48,0)
 S SPD=$$CHKS^SRSCOR(SRTN)
"RTN","SRONEW",49,0)
 K DR S DR="[SRSRES-ENTRY]",DIE=130,DA=SRTN D ^SRCUSS,RISK^SROAUTL3,^SROPCE1
"RTN","SRONEW",50,0)
 I SPD'=$$CHKS^SRSCOR(SRTN) S ^TMP("CSLSUR1",$J)=""
"RTN","SRONEW",51,0)
 I $D(SRCTN) D
"RTN","SRONEW",52,0)
 .S SRCTN(.02)=$P(^SRF(SRCTN,0),"^",2),SRCTN(10)=$P($G(^SRF(SRCTN,31)),"^",4),SRCTN(11)=$P($G(^SRF(SRCTN,31)),"^",5)
"RTN","SRONEW",53,0)
 .S DIE=130,DR=".02////"_SRCTN(.02)_";10////"_SRCTN(10)_";11////"_SRCTN(11)_";35////"_SRCTN,DA=SRTN D ^DIE
"RTN","SRONEW",54,0)
 .S DR="35////"_SRTN,DA=SRCTN,DIE=130 D ^DIE
"RTN","SRONEW",55,0)
 D UNLOCK^SROUTL(SRTN),^SROERR
"RTN","SRONEW",56,0)
 Q
"RTN","SRONEW",57,0)
DEL S DA=SRTN,DIK="^SRF(" D ^DIK
"RTN","SRONEW",58,0)
END K SRTN D ^SRSKILL
"RTN","SRONEW",59,0)
 Q
"RTN","SRONEW",60,0)
CONT ; continue new entry ?
"RTN","SRONEW",61,0)
 W !!,"Do you want to continue  ?  YES//  " R SRYN:DTIME I '$T S SRYN="N" Q
"RTN","SRONEW",62,0)
 S SRYN=$E(SRYN) S:SRYN="" SRYN="Y" I "YyNn"'[SRYN W !!,"Enter RETURN if you want to re-enter a date and continue creating a new",!,"case, or 'NO' to leave this option." G CONT
"RTN","SRONEW",63,0)
 Q
"RTN","SRONEW",64,0)
RT ;start RT logging
"RTN","SRONEW",65,0)
 I $D(XRTL) S XRTN="SRONEW" D T0^%ZOSV
"RTN","SRONEW",66,0)
 Q
"RTN","SRONEW",67,0)
CON ; check for concurrent case
"RTN","SRONEW",68,0)
 S SRSCON=0,SRDT=SRSDATE-.0001 F  S SRDT=$O(^SRF("AC",SRDT)) Q:'SRDT!($E(SRDT,1,7)'=SRSDATE)!(SRSCON)  S (SRSCC,SRSCON)=0 F  S SRSCC=$O(^SRF("AC",SRDT,SRSCC)) Q:'SRSCC  D  Q:SRSCON
"RTN","SRONEW",69,0)
 .I ^(SRSCC)=SRSDPT,'$P($G(^SRF(SRSCC,"CON")),"^"),$P($G(^SRF(SRSCC,"NON")),"^")'="Y",'$P($G(^SRF(SRSCC,30)),"^"),'$P($G(^SRF(SRSCC,.2)),"^",12),'$P($G(^SRF(SRSCC,"LOCK")),"^") S SRSCON=1
"RTN","SRONEW",70,0)
 .I SRSCON D CC^SRSREQ I '$D(SRCTN) S SRSCON=0
"RTN","SRONEW",71,0)
 Q
"RTN","SROPCEP")
0^12^B79067516^B73728943
"RTN","SROPCEP",1,0)
SROPCEP ;BIR/TJH - PCE UPDATES ;04/26/05  9:28 AM
"RTN","SROPCEP",2,0)
 ;;3.0; Surgery ;**142,152,144**;24 Jun 93
"RTN","SROPCEP",3,0)
 ;
"RTN","SROPCEP",4,0)
 ; Reference to $$DATA2PCE^PXAPI supported by DBIA #1889
"RTN","SROPCEP",5,0)
 ; Reference to $$DELVFILE^PXAPI supported by DBIA #1890
"RTN","SROPCEP",6,0)
 ; Reference to ^DIC(45.3 is supported by DBIA #218
"RTN","SROPCEP",7,0)
 ;
"RTN","SROPCEP",8,0)
 Q
"RTN","SROPCEP",9,0)
START ; entry for update to PCE with surgery & non-OR procedure data
"RTN","SROPCEP",10,0)
 I '$D(SRTN) S SRTN=$G(DA)
"RTN","SROPCEP",11,0)
 I SRTN="" Q
"RTN","SROPCEP",12,0)
 N DFN,SR,SRAO,SRATT,SRCHK,SRCPT,SRDATE,SRDIAG,SREC,SRHNC,SRIR,SRCV,SRPRJ,SRK,SRLOC,SRMST,SRNON,SROTH,SRPKG,SRPROV,SRS,SRSC,SRV,SRVSIT,SRX,SRX2
"RTN","SROPCEP",13,0)
 N SRPLSC,SRPLAO,SRPLIR,SRPLEC,SRPLMST,SRPLHNC,SRPLCV,SRPLPRJ,SRADX,SRCNT,SRD,SRDX,SRRPROV,SRUP,SRINOUT,SRO,SRDEPC,SRPFSSAR
"RTN","SROPCEP",14,0)
 N SRDP,SRDC,SRDI,SRDL,SRDIE,SRDG,SRDM,SRDR,SRDH,SRDK,SRDA,SRD0,SRDDER,SRDG,SRDIC,SRDIC1,SRDICRRE,SRDIEDA,SRDIG,SRDIH,SRDIIENS,SRDISL,SRDISYS,SRDIU,SRDIV,SRDIWT,SRDN,SRDQ,SRDX,SRDY
"RTN","SROPCEP",15,0)
 D FM1 K DIC S DIC=9.4,DIC(0)="XM",X="SURGERY" D ^DIC K DIC D FM2 Q:Y=-1  S SRPKG=+Y
"RTN","SROPCEP",16,0)
 S SRS="SURGERY DATA" K ^TMP("SRPXAPI",$J)
"RTN","SROPCEP",17,0)
 D UTIL I 'SRK D PCE
"RTN","SROPCEP",18,0)
 Q
"RTN","SROPCEP",19,0)
DEL ; delete data from the Visit file and V files
"RTN","SROPCEP",20,0)
 D FM1 K DA,DIE,DR S DA=SRTN,DIE=130,DR=".015///@" D ^DIE K DA,DIE,DR D FM2
"RTN","SROPCEP",21,0)
 D FM1 S SRV=$$DELVFILE^PXAPI("ALL",SRVSIT) K SRVSIT D FM2
"RTN","SROPCEP",22,0)
 Q
"RTN","SROPCEP",23,0)
UTIL ; set procedure variables
"RTN","SROPCEP",24,0)
 N SRDIV,SRSITE,SRSR
"RTN","SROPCEP",25,0)
 S SRSR="",SRK=0,SRDIV=$P($G(^SRF(SRTN,8)),"^") I SRDIV S SRSITE=$O(^SRO(133,"B",SRDIV,0)),X=^SRO(133,SRSITE,0),SRUP=$P(X,"^",15),SRSR=$P(X,"^",19) I SRUP=""!(SRUP="N") S SRK=1 Q
"RTN","SROPCEP",26,0)
 S SRX=$P($G(^SRF(SRTN,0)),"^",15) I SRX S SRVSIT=SRX D DEL I '$D(^SRF(SRTN,0)) S SRK=1 Q
"RTN","SROPCEP",27,0)
 S SR(0)=$G(^SRF(SRTN,0)) I SR(0)=""!$P($G(^SRF(SRTN,30)),"^") S SRK=1 Q
"RTN","SROPCEP",28,0)
 S DFN=$P(SR(0),"^")
"RTN","SROPCEP",29,0)
 S SRNON=$S($P($G(^SRF(SRTN,"NON")),"^")="Y":1,1:0),SRCPT=$P($G(^SRO(136,SRTN,0)),"^",2) I 'SRCPT S SRK=1 Q
"RTN","SROPCEP",30,0)
 Q:SRK  S SRDIAG=$P($G(^SRO(136,SRTN,0)),"^",3) I 'SRDIAG S SRK=1 Q
"RTN","SROPCEP",31,0)
 I 'SRNON D  I SRK Q
"RTN","SROPCEP",32,0)
 .S SRX=$P(SR(0),"^",21) I SRX S SRLOC=SRX
"RTN","SROPCEP",33,0)
 .I 'SRX S SRX=$P(^SRO(137.45,$P(SR(0),"^",4),0),"^",5) I SRX S SRLOC=SRX
"RTN","SROPCEP",34,0)
 .I 'SRX S SRX=$P(SR(0),"^",2) S:SRX SRLOC=$P(^SRS(SRX,0),"^") I 'SRX S SRK=1 Q
"RTN","SROPCEP",35,0)
 .S SRX=$G(^SRF(SRTN,.2)),SRCHK=$P(SRX,"^",12) I 'SRCHK S SRK=1 Q
"RTN","SROPCEP",36,0)
 .S SRDATE=$P(SRX,"^",10) I 'SRDATE S SRK=1 Q
"RTN","SROPCEP",37,0)
 .S SRX=$G(^SRF(SRTN,.1)),SRPROV=$P(SRX,"^",4),SRATT=$P(SRX,"^",13) I 'SRPROV S SRK=1 Q
"RTN","SROPCEP",38,0)
 .I SRSR'=0,'SRATT S SRK=1 Q
"RTN","SROPCEP",39,0)
 I SRNON D  I SRK Q
"RTN","SROPCEP",40,0)
 .S SRLOC=$P(SR(0),"^",21)
"RTN","SROPCEP",41,0)
 .S SRX=^SRF(SRTN,"NON"),SRCHK=$P(SRX,"^",5) I 'SRCHK S SRK=1 Q
"RTN","SROPCEP",42,0)
 .S SRDATE=$P(SRX,"^",4) I 'SRDATE S SRK=1 Q
"RTN","SROPCEP",43,0)
 .I 'SRLOC S SRLOC=$P(SRX,"^",2) I 'SRLOC S SRK=1 Q
"RTN","SROPCEP",44,0)
 .S SRPROV=$P(SRX,"^",6),SRATT=$P(SRX,"^",7) I 'SRPROV S SRK=1
"RTN","SROPCEP",45,0)
 .I SRSR'=0,'SRATT S SRK=1
"RTN","SROPCEP",46,0)
 S VAINDT=SRDATE
"RTN","SROPCEP",47,0)
 D INP^VADPT
"RTN","SROPCEP",48,0)
 I VAIN(1) S SRINOUT="I"
"RTN","SROPCEP",49,0)
 I 'VAIN(1) S SRINOUT="O"
"RTN","SROPCEP",50,0)
 K VAINDT,VAIN
"RTN","SROPCEP",51,0)
 I '$$CLINIC^SROUTL(SRLOC,SRTN) S SRK=1 Q
"RTN","SROPCEP",52,0)
 S SRX=0,SRX=$O(^SRO(136,SRTN,2,SRX)) I SRX="" S SRK=1 Q
"RTN","SROPCEP",53,0)
 S SRX=0 F  S SRX=$O(^SRO(136,SRTN,3,SRX)) Q:'SRX  S SRX2=0,SRX2=$O(^SRO(136,SRTN,3,SRX,2,SRX2)) I $D(^SRO(136,SRTN,3,SRX,0)),(SRX2="") S SRK=1  Q:SRK
"RTN","SROPCEP",54,0)
 S SRRPROV="" I $D(^SRF(SRTN,18)) S SRX=0,SRX=$O(^SRF(SRTN,18,SRX)) I SRX S SRRPROV=$P($G(^SRF(SRTN,18,SRX,0)),"^",7)
"RTN","SROPCEP",55,0)
 S SRO(0)=$G(^SRO(136,SRTN,0))
"RTN","SROPCEP",56,0)
 S (SRSC,SRAO,SREC,SRHNC,SRIR,SRMST,SRCV,SRPRJ)=0,SRSC=$P(SRO(0),"^",4),SRAO=$P(SRO(0),"^",5),SRIR=$P(SRO(0),"^",6),SREC=$P(SRO(0),"^",7),SRMST=$P(SRO(0),"^",8),SRHNC=$P(SRO(0),"^",9),SRCV=$P(SRO(0),"^",10),SRPRJ=$P(SRO(0),"^",11)
"RTN","SROPCEP",57,0)
 I $$SWSTAT^IBBAPI(),'SRNON D
"RTN","SROPCEP",58,0)
 .S SRX=$P(^SRO(137.45,$P(SR(0),"^",4),0),"^",2)
"RTN","SROPCEP",59,0)
 .I SRX S SRDEPC=$$GET1^DIQ(45.3,SRX,2)
"RTN","SROPCEP",60,0)
 Q
"RTN","SROPCEP",61,0)
PCE ;
"RTN","SROPCEP",62,0)
 N SRI,SRJ,SRCODE,SROTH D TMP
"RTN","SROPCEP",63,0)
D2PCE ;
"RTN","SROPCEP",64,0)
 S SRPFSSAR=$P($G(^SRF(SRTN,"PFSS")),"^")
"RTN","SROPCEP",65,0)
 I $$SWSTAT^IBBAPI() D FM1 S SRV=$$DATA2PCE^PXAPI("^TMP(""SRPXAPI"",$J)",SRPKG,SRS,.SRVSIT,,,,,,.SRPFSSAR) D FM2
"RTN","SROPCEP",66,0)
 I '$$SWSTAT^IBBAPI() D FM1 S SRV=$$DATA2PCE^PXAPI("^TMP(""SRPXAPI"",$J)",SRPKG,SRS,.SRVSIT) D FM2
"RTN","SROPCEP",67,0)
 I SRVSIT D FM1 K DA,DIE,DR S DA=SRTN,DIE=130,DR=".015////"_SRVSIT D ^DIE K DA,DIE,DR D FM2
"RTN","SROPCEP",68,0)
 K ^TMP("SRPXAPI",$J),SRVSIT
"RTN","SROPCEP",69,0)
 Q
"RTN","SROPCEP",70,0)
TMP ;
"RTN","SROPCEP",71,0)
ENC S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"ENC D/T")=SRDATE
"RTN","SROPCEP",72,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"PATIENT")=DFN
"RTN","SROPCEP",73,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"HOS LOC")=SRLOC
"RTN","SROPCEP",74,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"CHECKOUT D/T")=SRCHK
"RTN","SROPCEP",75,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"SERVICE CATEGORY")="S"
"RTN","SROPCEP",76,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"ENCOUNTER TYPE")="P"
"RTN","SROPCEP",77,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"APPT")=9
"RTN","SROPCEP",78,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"SC")=SRSC
"RTN","SROPCEP",79,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"AO")=SRAO
"RTN","SROPCEP",80,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"IR")=SRIR
"RTN","SROPCEP",81,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"EC")=SREC
"RTN","SROPCEP",82,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"MST")=SRMST
"RTN","SROPCEP",83,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"HNC")=SRHNC
"RTN","SROPCEP",84,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"CV")=SRCV
"RTN","SROPCEP",85,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"SHAD")=SRPRJ
"RTN","SROPCEP",86,0)
PROC S SRI=1,SRCODE=SRCPT D PMOD,CPT
"RTN","SROPCEP",87,0)
 S SROTH=0 F  S SROTH=$O(^SRO(136,SRTN,3,SROTH)) Q:'SROTH  S SRCODE=$P($G(^SRO(136,SRTN,3,SROTH,0)),"^") I SRCODE S SRI=SRI+1 D OMOD,CPT
"RTN","SROPCEP",88,0)
PROV S ^TMP("SRPXAPI",$J,"PROVIDER",1,"NAME")=SRPROV
"RTN","SROPCEP",89,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",1,"PRIMARY")=1
"RTN","SROPCEP",90,0)
 I 'SRNON S ^TMP("SRPXAPI",$J,"PROVIDER",1,"COMMENT")="Surgeon"
"RTN","SROPCEP",91,0)
 I SRPROV=SRATT!'SRATT S ^TMP("SRPXAPI",$J,"PROVIDER",1,"ATTENDING")=1 G DIAG
"RTN","SROPCEP",92,0)
 I 'SRATT G DIAG
"RTN","SROPCEP",93,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",2,"NAME")=SRATT
"RTN","SROPCEP",94,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",2,"ATTENDING")=1
"RTN","SROPCEP",95,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",2,"PRIMARY")=0
"RTN","SROPCEP",96,0)
 I 'SRNON S ^TMP("SRPXAPI",$J,"PROVIDER",2,"COMMENT")="Attending Surgeon"
"RTN","SROPCEP",97,0)
DIAG S SRI=1,SRDX=SRDIAG D DX
"RTN","SROPCEP",98,0)
 S SRD=0 F  S SRD=$O(^SRO(136,SRTN,4,SRD)) Q:'SRD  S SRDX=$P(^SRO(136,SRTN,4,SRD,0),"^") I SRDX D DX
"RTN","SROPCEP",99,0)
 Q
"RTN","SROPCEP",100,0)
DX S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"DIAGNOSIS")=SRDX
"RTN","SROPCEP",101,0)
 I SRI=1 D
"RTN","SROPCEP",102,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PRIMARY")=1
"RTN","SROPCEP",103,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"ORD/RES")="R"
"RTN","SROPCEP",104,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL SC")=SRSC
"RTN","SROPCEP",105,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL AO")=SRAO
"RTN","SROPCEP",106,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL IR")=SRIR
"RTN","SROPCEP",107,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL EC")=SREC
"RTN","SROPCEP",108,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL MST")=SRMST
"RTN","SROPCEP",109,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL HNC")=SRHNC
"RTN","SROPCEP",110,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL CV")=SRCV
"RTN","SROPCEP",111,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL SHAD")=SRPRJ
"RTN","SROPCEP",112,0)
 I SRI'=1 D
"RTN","SROPCEP",113,0)
 .S SR(4)=$G(^SRO(136,SRTN,4,SRD,0))
"RTN","SROPCEP",114,0)
 .S (SRPLSC,SRPLAO,SRPLIR,SRPLEC,SRPLMST,SRPLHNC,SRPLCV,SRPLPRJ)=0,SRPLSC=$P(SR(4),"^",2),SRPLAO=$P(SR(4),"^",3)
"RTN","SROPCEP",115,0)
 .S SRPLIR=$P(SR(4),"^",4),SRPLMST=$P(SR(4),"^",5),SRPLHNC=$P(SR(4),"^",6),SRPLEC=$P(SR(4),"^",7),SRPLCV=$P(SR(4),"^",8),SRPLPRJ=$P(SR(4),"^",9)
"RTN","SROPCEP",116,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"ORD/RES")="R"
"RTN","SROPCEP",117,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL SC")=SRPLSC
"RTN","SROPCEP",118,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL AO")=SRPLAO
"RTN","SROPCEP",119,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL IR")=SRPLIR
"RTN","SROPCEP",120,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL EC")=SRPLEC
"RTN","SROPCEP",121,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL MST")=SRPLMST
"RTN","SROPCEP",122,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL HNC")=SRPLHNC
"RTN","SROPCEP",123,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL CV")=SRPLCV
"RTN","SROPCEP",124,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL SHAD")=SRPLPRJ
"RTN","SROPCEP",125,0)
 S SRI=SRI+1
"RTN","SROPCEP",126,0)
 Q
"RTN","SROPCEP",127,0)
CPT S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"ENC PROVIDER")=SRPROV
"RTN","SROPCEP",128,0)
 S:SRRPROV'="" ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"ORD PROVIDER")=SRRPROV
"RTN","SROPCEP",129,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"EVENT D/T")=SRDATE
"RTN","SROPCEP",130,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"PROCEDURE")=SRCODE
"RTN","SROPCEP",131,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"QTY")=1
"RTN","SROPCEP",132,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"COMMENT")=$S(SRI=1:"Principal Procedure",1:"Other Procedure")
"RTN","SROPCEP",133,0)
 I $G(SRDEPC) S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DEPARTMENT")=SRDEPC
"RTN","SROPCEP",134,0)
 I SRI=1 D
"RTN","SROPCEP",135,0)
 .S SRCNT=1,SRX=0 F  S SRX=$O(^SRO(136,SRTN,2,SRX)) Q:'SRX  D
"RTN","SROPCEP",136,0)
 ..S SRADX=$P(^SRO(136,SRTN,2,SRX,0),"^")
"RTN","SROPCEP",137,0)
 ..I SRCNT=1 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS")=SRADX
"RTN","SROPCEP",138,0)
 ..I SRCNT=2 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 2")=SRADX
"RTN","SROPCEP",139,0)
 ..I SRCNT=3 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 3")=SRADX
"RTN","SROPCEP",140,0)
 ..I SRCNT=4 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 4")=SRADX
"RTN","SROPCEP",141,0)
 ..I SRCNT=5 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 5")=SRADX
"RTN","SROPCEP",142,0)
 ..I SRCNT=6 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 6")=SRADX
"RTN","SROPCEP",143,0)
 ..I SRCNT=7 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 7")=SRADX
"RTN","SROPCEP",144,0)
 ..I SRCNT=8 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 8")=SRADX
"RTN","SROPCEP",145,0)
 ..S SRCNT=SRCNT+1
"RTN","SROPCEP",146,0)
 I SRI'=1 D
"RTN","SROPCEP",147,0)
 .S SRCNT=1,SRX=0 F  S SRX=$O(^SRO(136,SRTN,3,SROTH,2,SRX)) Q:'SRX  D
"RTN","SROPCEP",148,0)
 ..S SRADX=$P(^SRO(136,SRTN,3,SROTH,2,SRX,0),"^")
"RTN","SROPCEP",149,0)
 ..I SRCNT=1 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS")=SRADX
"RTN","SROPCEP",150,0)
 ..I SRCNT=2 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 2")=SRADX
"RTN","SROPCEP",151,0)
 ..I SRCNT=3 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 3")=SRADX
"RTN","SROPCEP",152,0)
 ..I SRCNT=4 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 4")=SRADX
"RTN","SROPCEP",153,0)
 ..I SRCNT=5 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 5")=SRADX
"RTN","SROPCEP",154,0)
 ..I SRCNT=6 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 6")=SRADX
"RTN","SROPCEP",155,0)
 ..I SRCNT=7 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 7")=SRADX
"RTN","SROPCEP",156,0)
 ..I SRCNT=8 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 8")=SRADX
"RTN","SROPCEP",157,0)
 ..S SRCNT=SRCNT+1
"RTN","SROPCEP",158,0)
 Q
"RTN","SROPCEP",159,0)
PMOD ;
"RTN","SROPCEP",160,0)
 N SRM,SRMOD,X
"RTN","SROPCEP",161,0)
 S SRM=0 F  S SRM=$O(^SRO(136,SRTN,1,SRM)) Q:'SRM  S X=$P(^SRO(136,SRTN,1,SRM,0),"^"),SRMOD=$P($$MOD^ICPTMOD(X,"I"),"^",2),^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"MODIFIERS",SRMOD)=""
"RTN","SROPCEP",162,0)
 Q
"RTN","SROPCEP",163,0)
OMOD ;
"RTN","SROPCEP",164,0)
 N SRM,SRMOD,X
"RTN","SROPCEP",165,0)
 S SRM=0 F  S SRM=$O(^SRO(136,SRTN,3,SROTH,1,SRM)) Q:'SRM  S X=$P(^SRO(136,SRTN,3,SROTH,1,SRM,0),"^"),SRMOD=$P($$MOD^ICPTMOD(X,"I"),"^",2),^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"MODIFIERS",SRMOD)=""
"RTN","SROPCEP",166,0)
 Q
"RTN","SROPCEP",167,0)
FM1 M SRDA=DA,SRDP=DP,SRDC=DC,SRDI=DI,SRDL=DL,SRDIE=DIE,SRDG=DG,SRDM=DM,SRDR=DR,SRDH=DH,SRDK=DK,SRD0=D0,SRDDER=DDER,SRDG=DG,SRDIC=DIC,SRDIC1=DIC1,SRDICRRE=DICRREC
"RTN","SROPCEP",168,0)
 M SRDIEDA=DIEDA,SRDIG=DIG,SRDIH=DIH,SRDIIENS=DIIENS,SRDISL=DISL,SRDISYS=DISYS,SRDIU=DIU,SRDIV=DIV,SRDIWT=DIWT,SRDN=DN,SRDQ=DQ,SRDX=DX,SRDY=DY
"RTN","SROPCEP",169,0)
FM2 M DA=SRDA,DP=SRDP,DC=SRDC,DI=SRDI,DL=SRDL,DIE=SRDIE,DG=SRDG,DM=SRDM,DR=SRDR,DH=SRDH,DK=SRDK,D0=SRD0,DDER=SRDDER,DG=SRDG,DIC=SRDIC,DIC1=SRDIC1,DICRREC=SRDICRRE
"RTN","SROPCEP",170,0)
 M DIEDA=SRDIEDA,DIG=SRDIG,DIH=SRDIH,DIIENS=SRDIIENS,DISL=SRDISL,DISYS=SRDISYS,DIU=SRDIU,DIV=SRDIV,DIWT=SRDIWT,DN=SRDN,DQ=SRDQ,DX=SRDX,DY=SRDY
"RTN","SROPFSS")
0^9^B8994664
"RTN","SROPFSS",1,0)
SROPFSS ;BIR/SJA - Surgery/IBB GETACCOUNT API ;01/13/05  9:31 AM
"RTN","SROPFSS",2,0)
 ;;3.0; Surgery ;**144**;24 Jun 93
"RTN","SROPFSS",3,0)
 ;
"RTN","SROPFSS",4,0)
 ; Reference to $$GETACCT^IBBAPI is supported by DBIA #4664
"RTN","SROPFSS",5,0)
 ; Reference to ^DIC(40.7 is supported by DBIA #557
"RTN","SROPFSS",6,0)
 ; Reference to ^DG(40.8 is supported by DBIA #2817
"RTN","SROPFSS",7,0)
 ;
"RTN","SROPFSS",8,0)
SERR(SRCASE,SRY) ; entry point for routine SROERR & SROERR0.
"RTN","SROPFSS",9,0)
 I 'SRCASE!('+$$SWSTAT^IBBAPI())!($P($G(^SRF(SRCASE,"NON")),"^")="Y") K ^TMP("SRPFSS",$J) Q
"RTN","SROPFSS",10,0)
 S SROP=SRCASE,SROPER="" D ^SROP1
"RTN","SROPFSS",11,0)
 N SRCARFN,SRAPLR,SRDFN,SRDG1,SRDIV,SRGETACC,SRII,SRNODE0,SRPR1,SRPV1,SRPV2,SRRARFN,SRLSS,SRLSSC,SRSURG,SRTMP,SRTP,SRX
"RTN","SROPFSS",12,0)
 S SRTP="",SRGETACC=$P($G(^SRF(SRCASE,"PFSS")),"^"),SRTMP=$D(^TMP("SRPFSS",$J)) D
"RTN","SROPFSS",13,0)
 .I SRY="SROERR0" D
"RTN","SROPFSS",14,0)
 ..I SROPER["(REQUESTED)",SRTMP S SRTP=$S(SRGETACC&$D(SRSCHST):"A11",SRGETACC:"A08",'SRGETACC:"A04",1:"") Q
"RTN","SROPFSS",15,0)
 ..I SROPER["(SCHEDULED)"!(SROPER["(NOT COMPLETE)")!(SROPER["(COMPLETED)"),SRTMP S SRTP=$S('SRGETACC:"A04",1:"A08") Q
"RTN","SROPFSS",16,0)
 ..I SROPER["(CANCELLED)",SRGETACC S SRTP="A11" Q
"RTN","SROPFSS",17,0)
 .I SRY="SROERR" D
"RTN","SROPFSS",18,0)
 ..I SROPER["(SCHEDULED)" S SRTP=$S('SRGETACC:"A04",1:"A08") Q
"RTN","SROPFSS",19,0)
 ..I SROPER["(REQUESTED)" S SRTP=$S(SRGETACC:"A08",'SRGETACC:"A04",1:"") Q
"RTN","SROPFSS",20,0)
 ..I SROPER["NOT COMPLETE",'SRGETACC,SRTMP S SRTP="A04" Q  ;New case
"RTN","SROPFSS",21,0)
 ;;;I SRY["DEL"!(SROPER["CANCELLED")!(SROPER["ABORTED") S SRTP="A11" ;cancel
"RTN","SROPFSS",22,0)
ST K ^TMP("SRPFSS",$J) I SRTP']"" Q
"RTN","SROPFSS",23,0)
 S SRNODE0=$G(^SRF(SRCASE,0))
"RTN","SROPFSS",24,0)
 S SRDFN=$S($D(DFN):DFN,1:$P(SRNODE0,"^")) ;Patient ID (DFN)
"RTN","SROPFSS",25,0)
 S SRRARFN=$S((SRTP="A11"!(SRTP="A08")):SRGETACC,1:"") ;Account Reference Number 
"RTN","SROPFSS",26,0)
 S SRLSSC=+$P(SRNODE0,"^",4),SRLSS=$G(^SRO(137.45,SRLSSC,0))
"RTN","SROPFSS",27,0)
 S SRPV1(2)=$S($P(SRNODE0,"^",12)="I":"I",1:"O") ;Patient Class; I(npatient) or O(utpatient)
"RTN","SROPFSS",28,0)
 S SRPV1(3)=$S($P(SRNODE0,"^",21)]"":$P(SRNODE0,"^",21),1:$P(SRLSS,"^",5)) ;Patient Location
"RTN","SROPFSS",29,0)
 S SRPV1(7)=$P($G(^SRF(SRCASE,.1)),"^",13) ;Attending Surgeon
"RTN","SROPFSS",30,0)
 S (SRPR1(11),SRPV1(17))=$P($G(^SRF(SRCASE,.1)),"^",4) ;Surgeon
"RTN","SROPFSS",31,0)
 S SRPV1(18)=$O(^DIC(40.7,"C",429,0))
"RTN","SROPFSS",32,0)
 S (SRPV1(44),SRPV2(8))=$P(SRNODE0,"^",9) ;Admit Date/Time
"RTN","SROPFSS",33,0)
 S SRPR1(4)=$E($P(^SRF(SRCASE,"OP"),"^"),1,60) ;Principal Procedure (free text)
"RTN","SROPFSS",34,0)
 S SRSURG(1)=SRCASE
"RTN","SROPFSS",35,0)
 S SRSURG(2)=$P(SRLSS,"^",2)
"RTN","SROPFSS",36,0)
 S SRDG1(1,4)=$E($P($G(^SRF(SRCASE,33)),"^"),1,40) ;Principal Pre-Op Diagnosis
"RTN","SROPFSS",37,0)
 S SRII=$P($G(^SRF(SRCASE,8)),"^"),SRDIV=$O(^DG(40.8,"AD",SRII,0)) ;Medical Center Division/Facility
"RTN","SROPFSS",38,0)
 S SRAPLR=$S(SRTP="A04":"ACCT;SROPFSS",1:"")
"RTN","SROPFSS",39,0)
 ;
"RTN","SROPFSS",40,0)
ACCT ; Call IBB GETACCOUNT API to get a new Account Reference Number
"RTN","SROPFSS",41,0)
 S SRCARFN=+$$GETACCT^IBBAPI(SRDFN,SRRARFN,SRTP,SRAPLR,.SRPV1,.SRPV2,.SRPR1,.SRDG1,"",SRDIV,"",.SRSURG)
"RTN","SROPFSS",42,0)
 I $G(SRCARFN) S $P(^SRF(SRCASE,"PFSS"),"^")=SRCARFN
"RTN","SROPFSS",43,0)
EXIT K SRCARFN
"RTN","SROPFSS",44,0)
 Q
"RTN","SROVAR")
0^6^B31317243^B31841040
"RTN","SROVAR",1,0)
SROVAR ;BIR/MAM,ADM - SITE PARAMETERS ;10/04/05
"RTN","SROVAR",2,0)
 ;;3.0; Surgery ;**17,38,48,67,77,50,87,88,102,107,100,134,144**;24 Jun 93
"RTN","SROVAR",3,0)
 ;
"RTN","SROVAR",4,0)
 ; Reference to ^TMP("CSLSUR1" supported by DBIA #3498
"RTN","SROVAR",5,0)
 ;
"RTN","SROVAR",6,0)
 K ^TMP("CSLSUR1",$J),^TMP("SRPFSS",$J) D CLEAR
"RTN","SROVAR",7,0)
 I $D(SRSITE) Q
"RTN","SROVAR",8,0)
 D CPT
"RTN","SROVAR",9,0)
 K SRL S (SRCNT,X)=0 F  S X=$O(^SRO(133,X)) Q:'X  I '$P($G(^SRO(133,X,0)),"^",21) S SRCNT=SRCNT+1,SRL(SRCNT)=X
"RTN","SROVAR",10,0)
 I SRCNT=1 S SRSITE=SRL(1) G SET
"RTN","SROVAR",11,0)
 K XQUIT,DIR W ! I SRCNT>1 S DIR("?",1)="  Because there is more than one division in the SURGERY SITE PARAMETERS",DIR("?")="  file, a division must be selected."
"RTN","SROVAR",12,0)
 S DIR(0)="P^133:EM",DIR("A")="Select Division",DIR("S")="I '$P(^SRO(133,+Y,0),U,21)" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) D ^SRSKILL S XQUIT="" Q
"RTN","SROVAR",13,0)
 S SRSITE=+Y
"RTN","SROVAR",14,0)
SET ; set site parameters
"RTN","SROVAR",15,0)
 S S(0)=^SRO(133,SRSITE,0),SRSITE("AML")=$P(S(0),"^",4),SRSITE("REQ")=$P(S(0),"^",2) K:SRSITE("REQ")="" SRSITE("REQ")
"RTN","SROVAR",16,0)
 S SRSITE("IV")=$P(S(0),"^",7) K:SRSITE("IV")="" SRSITE("IV")
"RTN","SROVAR",17,0)
 S SRSITE("DIV")=$P(S(0),"^"),SRSITE("SITE")=$$GET1^DIQ(4,SRSITE("DIV"),.01)
"RTN","SROVAR",18,0)
 S SRSITE("NRPT")=$P(S(0),"^",6) I SRSITE("NRPT")="" S SRSITE("NRPT")=1
"RTN","SROVAR",19,0)
 I '$D(SRSITE("OPTION")),$D(XQY) S SRSITE("OPTION")=XQY
"RTN","SROVAR",20,0)
 K S
"RTN","SROVAR",21,0)
 Q
"RTN","SROVAR",22,0)
CPT ; display CPT copyright notice
"RTN","SROVAR",23,0)
 N SRCPT,SRDIV S (SRCPT,SRDIV)=0 F  S SRDIV=$O(^SRO(133,SRDIV)) Q:'SRDIV  I $D(^SRO(133,SRDIV,6,DT,1,DUZ)) S SRCPT=1 Q
"RTN","SROVAR",24,0)
 Q:SRCPT  D COPY^ICPTAPIU I $G(IOST)'["P-" W ! K DIR S DIR("A")="Press the 'Return' key to continue",DIR(0)="FOA" D ^DIR K DIR
"RTN","SROVAR",25,0)
 K DD,DO,DA,DIC S SRDIV=$O(^SRO(133,0))
"RTN","SROVAR",26,0)
 I '$D(^SRO(133,SRDIV,6,DT,0)) S X=DT,DA(1)=SRDIV,DIC="^SRO(133,SRDIV,6,",DIC("P")=$P(^DD(133,36,0),"^",2),DIC(0)="L",DINUM=X D FILE^DICN K DD,DO,DA,DIC I Y=-1 Q
"RTN","SROVAR",27,0)
 S X=DUZ,DA(2)=SRDIV,DA(1)=DT,DIC="^SRO(133,SRDIV,6,DT,1,",DIC("P")=$P(^DD(133.036,1,0),"^",2),DIC(0)="L",DINUM=X D FILE^DICN K DA,DD,DIC,DO
"RTN","SROVAR",28,0)
 Q
"RTN","SROVAR",29,0)
EN2 ; set view only and titles for screens
"RTN","SROVAR",30,0)
 I '$D(^XUSEC("SROEDIT",DUZ)) S Q3("VIEW")=""
"RTN","SROVAR",31,0)
 Q:'$D(SRTN)  Q:SRTN<1  S:'$D(ST) ST="SCHEDULING" S DFN=$P(^SRF(SRTN,0),"^") D DEM^VADPT S SRN=$E(VADM(1),1,20),Q3(1)="** "_ST_" **   CASE #"_SRTN_"  "_SRN_" "
"RTN","SROVAR",32,0)
 Q
"RTN","SROVAR",33,0)
DEV S SRION=$S($D(ION):ION,1:"HOME") K %ZIS S %ZIS="QN",IOP=X D ^%ZIS I POP S IOP=SRION D ^%ZIS K %ZIS,IOP,SRION,X Q
"RTN","SROVAR",34,0)
 W $S(X=$E(ION,1,$L(X)):$E(ION,$L(X)+1,$L(ION)),1:"  "_ION) S X=ION D ^%ZISC K %ZIS,SRION,IOP Q
"RTN","SROVAR",35,0)
 Q
"RTN","SROVAR",36,0)
TIME ; transform time to date of operation at that time
"RTN","SROVAR",37,0)
 I $D(SRSMED) S DA=SRTN
"RTN","SROVAR",38,0)
 S:$D(SRTN) SRTDA=DA,DA=SRTN S X=$S(X?1.4N.A!(X?1.2N1":"2N.A):Z_"@"_X,1:X)
"RTN","SROVAR",39,0)
 S %DT="EPTXR" D ^%DT S X=Y G:'$D(^SRF(DA,.2)) RESET I X>0 S SRSTART=$P(^SRF($S($D(SRTN):SRTN,1:DA),.2),"^",15) I SRSTART'="" D BEFORE
"RTN","SROVAR",40,0)
 S:$D(SRTDA) DA=SRTDA Q
"RTN","SROVAR",41,0)
BEFORE W:X<SRSTART !!,"The time entered is before the 'TIME PAT IN HOLD AREA'.  Please check the",!,"DATE/TIME entered for this field." H 2
"RTN","SROVAR",42,0)
 Q
"RTN","SROVAR",43,0)
RESET S:$D(SRTDA) DA=SRTDA Q
"RTN","SROVAR",44,0)
INPUT ; input transfor for ASA CLASS
"RTN","SROVAR",45,0)
 S:'$D(DA) DA=SRTN S SRFLD=1.13 I $D(^SRF(DA,"CON")),$P(^("CON"),"^") D ^SROCON Q
"RTN","SROVAR",46,0)
 Q
"RTN","SROVAR",47,0)
PARAM ; enter/edit site parameters
"RTN","SROVAR",48,0)
 W @IOF K DIC,DINUM S DIC=133,DIC(0)="QEAMZL",DLAYGO=133,DIC("A")="Edit Parameters for which Surgery Site: " D ^DIC K DIC I Y<0 W @IOF Q
"RTN","SROVAR",49,0)
 N SRDIV,SRN,SRNAME,SRNUM S SRDIV=+Y,SRN=+Y(0),SRNAME=Y(0,0),SRNUM=$$GET1^DIQ(4,SRN,99),Q3(1)=" "_SRNAME_"  ("_SRNUM_") "
"RTN","SROVAR",50,0)
 K DIE,DR,DA,Y S DA=SRDIV,DR="[SRPARAM]",DIE=133 D ^SRCUSS K DR,DIE,DA,ST W @IOF I $D(SRSITE) D SET
"RTN","SROVAR",51,0)
 Q
"RTN","SROVAR",52,0)
EXIT ; exit action for all Surgery options
"RTN","SROVAR",53,0)
 I $D(XQY),$G(SRSITE("OPTION"))=XQY K SRSITE,SRTN,^TMP("SRCUSS",$J)
"RTN","SROVAR",54,0)
 D CLEAR
"RTN","SROVAR",55,0)
 Q
"RTN","SROVAR",56,0)
SITE() ; extrinsic call to output Institution file pointer (from Default Institution field in file 4.3)^Institution name^Station number
"RTN","SROVAR",57,0)
 N SITE,SRI,SRX,SRY
"RTN","SROVAR",58,0)
 S SITE=$$KSP^XUPARAM("INST") I 'SITE Q SITE
"RTN","SROVAR",59,0)
 S SRX=SITE F SRI=.01,99 S SRY=$$GET1^DIQ(4,SRX,SRI),SITE=SITE_"^"_SRY
"RTN","SROVAR",60,0)
 Q SITE
"RTN","SROVAR",61,0)
OFF1 ; compare time off with time on
"RTN","SROVAR",62,0)
 S Z=$E($P(^SRF($S($D(SRTN):SRTN,1:DA(1)),0),"^",9),1,7),X=$S(X?1.4N.A!(X?1.2N1":"2N.A):Z_"@"_X,1:X) K %DT,Z S %DT="PTXR" D ^%DT S X=Y I Y<1 D OUT Q
"RTN","SROVAR",63,0)
 S SRSTART=$P(^SRF(DA(1),SRSUB,DA,0),"^",SRP) D COMP
"RTN","SROVAR",64,0)
 Q
"RTN","SROVAR",65,0)
OFF2 ; compare time off with time on
"RTN","SROVAR",66,0)
 S Z=$E($P(^SRF($S($D(SRTN):SRTN,1:DA(2)),0),"^",9),1,7),X=$S(X?1.4N.A!(X?1.2N1":"2N.A):Z_"@"_X,1:X) K %DT,Z S %DT="PTXR" D ^%DT S X=Y I Y<1 D OUT Q
"RTN","SROVAR",67,0)
 S SRSTART=$P(^SRF(DA(2),SRSUB,DA(1),1,DA,0),"^",SRP)
"RTN","SROVAR",68,0)
COMP I X<SRSTART W !!,"Time Off should be later than Time On.",! S X=-1
"RTN","SROVAR",69,0)
OUT K %DT,SR130,SRN,SRP,SRSTART,SRSUB
"RTN","SROVAR",70,0)
 Q
"RTN","SROVAR",71,0)
TERM ; compare stop time with start time
"RTN","SROVAR",72,0)
 N SRINOR,SRSTART,SRV,SRY,T,Z
"RTN","SROVAR",73,0)
 I $D(DA) S SRINOR=$S($P($G(^SRF(DA,"NON")),"^")="Y":$P($G(^SRF(DA,"NON")),"^",4),1:$P($G(^SRF(DA,.2)),"^",10)) I 'SRINOR D  K X D OUT Q
"RTN","SROVAR",74,0)
 .D EN^DDIOL(">>> Please enter 'TIME "_$S($P($G(^SRF(DA,"NON")),"^")="Y":"PROCEDURE BEGAN",1:"PAT IN OR")_"' first !! <<<","","!!?5")
"RTN","SROVAR",75,0)
 .D EN^DDIOL("","","!")
"RTN","SROVAR",76,0)
 S Z=$E(SRINOR,1,7),X=$S(X?1.4N.A!(X?1.2N1":"2N.A):Z_"@"_X,1:X)
"RTN","SROVAR",77,0)
 K %DT,Z S %DT="PTXR" D ^%DT S X=Y I Y<1 D OUT Q
"RTN","SROVAR",78,0)
 I $D(DA) S Z=$P($G(^SRF(DA,SRN)),"^",SRP),SRSTART=$S(Z:Z,1:SRINOR),SRNULL=$S(Z:0,1:1) I X<SRSTART S Z=$P(SRINOR,"."),T=$P(X,".",2),X1=Z_"."_T,X2=1 D C^%DTC D PLUS24 I '$D(X) D OUT Q
"RTN","SROVAR",79,0)
 K %DT S %DT="EPTXR" D ^%DT S X=Y D OUT
"RTN","SROVAR",80,0)
 Q
"RTN","SROVAR",81,0)
PLUS24 S:SRNULL SR130="TIME PAT IN OR" S (SRV,Y)=X X ^DD("DD") S SRY=Y
"RTN","SROVAR",82,0)
 K DIR S DIR("A",1)="",DIR("A",2)="The time you have entered is earlier than "_SR130_".",DIR("A")="Do you mean "_SRY_" (Y/N) ? ",DIR(0)="YA" D ^DIR K DIR I 'Y!$D(DTOUT)!$D(DUOUT) K X Q
"RTN","SROVAR",83,0)
 S X=SRV
"RTN","SROVAR",84,0)
 Q
"RTN","SROVAR",85,0)
CLEAR ; clean-up case edit/lock flags in ^XTMP
"RTN","SROVAR",86,0)
 N SRC,SRJ,SRL,SRNOW,SRNOW1,SRZ S SRNOW=$$NOW^XLFDT
"RTN","SROVAR",87,0)
 S SRC="SRLOCK-0" F  S SRC=$O(^XTMP(SRC)) Q:SRC'["SRLOCK-"  D
"RTN","SROVAR",88,0)
 .S SRJ=0 F  S SRJ=$O(^XTMP(SRC,DUZ,SRJ)) Q:'SRJ  D
"RTN","SROVAR",89,0)
 ..I SRJ=$J L -^XTMP(SRC,DUZ,SRJ) K ^XTMP(SRC,DUZ,SRJ) I '$O(^XTMP(SRC,0)) L -^XTMP(SRC) K ^XTMP(SRC) Q
"RTN","SROVAR",90,0)
 ..S SRNOW1=$P($G(^XTMP(SRC,0)),"^") I SRNOW>SRNOW1 L -^XTMP(SRC) K ^XTMP(SRC)
"RTN","SROVAR",91,0)
 Q
"RTN","SRSCAN0")
0^7^B15578926^B15413492
"RTN","SRSCAN0",1,0)
SRSCAN0 ;B'HAM ISC/MAM - CANCEL SCHEDULED OPERATIONS (CONT) ;03/21/02  10:24 PM
"RTN","SRSCAN0",2,0)
 ;;3.0; Surgery ;**34,42,67,103,107,114,100,144**;24 Jun 93
"RTN","SRSCAN0",3,0)
 ;
"RTN","SRSCAN0",4,0)
 ; Reference to ^TMP("CSLSUR1" supported by DBIA #3498
"RTN","SRSCAN0",5,0)
 ;
"RTN","SRSCAN0",6,0)
CUT S X1=SRSDATE,X2=-1 D C^%DTC S SRSDT=X,X=$P($G(^SRO(133,SRSITE,0)),"^",12) S SRTIME=SRSDT_"."_$S(X'="":X,1:1500)
"RTN","SRSCAN0",7,0)
 S SRTYPE=$P(^SRF(SRTN,0),"^",10) I SRTYPE="S" W !!,"Case schedule type is STANDBY. "
"RTN","SRSCAN0",8,0)
 D NOW^%DTC S SRN=+$E(%,1,12) I SRTYPE'="S",SRN'<SRTIME G SWAP
"RTN","SRSCAN0",9,0)
 S SRBOTH=0 I $P($G(^SRF(SRTN,"CON")),"^") S SRBOTH=1
"RTN","SRSCAN0",10,0)
REQ I 'SRBOTH D ^SRSCG
"RTN","SRSCAN0",11,0)
 S SRSCHST=$P($G(^SRF(SRTN,31)),"^",4) K:SRSCHST&SRSOR ^SRF("AMM",SRSOR,SRSCHST,SRTN)
"RTN","SRSCAN0",12,0)
 S $P(^SRF(SRTN,31),"^",4)="",$P(^SRF(SRTN,31),"^",5)="",^SRF(SRTN,"REQ")=1,^SRF("AR",SRSDATE,DFN,SRTN)="",^TMP("SRPFSS",$J)=""
"RTN","SRSCAN0",13,0)
 K DR S DA=SRTN,DR=".02///@",DIE=130 D ^DIE K DR D OERR
"RTN","SRSCAN0",14,0)
 I '$P($G(^SRF(SRTN,"1.0")),"^",11) D
"RTN","SRSCAN0",15,0)
 .N SREQ
"RTN","SRSCAN0",16,0)
 .S SREQ(130,SRTN_",",1.098)=+SRN,SREQ(130,SRTN_",",1.099)=DUZ
"RTN","SRSCAN0",17,0)
 .D FILE^DIE("","SREQ","^TMP(""SR"",$J)")
"RTN","SRSCAN0",18,0)
 W !!,"Case #"_SRTN_" has been removed from the schedule and changed to a request."
"RTN","SRSCAN0",19,0)
 I SRBOTH G ASK
"RTN","SRSCAN0",20,0)
PRESS W ! K DIR S DIR(0)="E" D ^DIR
"RTN","SRSCAN0",21,0)
 Q
"RTN","SRSCAN0",22,0)
ASK S SRBOTH=0 W !!,"There is a concurrent case associated with this operation.  Do you want to",!,"remove it from the schedule also ? YES// " R SRYN:DTIME I '$T!(SRYN["^") S SRYN="N"
"RTN","SRSCAN0",23,0)
 S SRYN=$E(SRYN) S:SRYN="" SRYN="Y"
"RTN","SRSCAN0",24,0)
 I "YyNn"'[SRYN W !!,"If you want to remove both cases from the schedule, enter 'YES'.  If you",!,"answer 'NO', the cases will no longer be associated with each other." G ASK
"RTN","SRSCAN0",25,0)
 I "Yy"[SRYN S SRTN=$P(^SRF(SRTN,"CON"),"^") G REQ
"RTN","SRSCAN0",26,0)
NOCC ; no longer concurrent cases
"RTN","SRSCAN0",27,0)
 S DA=$P(^SRF(SRTN,"CON"),"^"),DIE=130,DR="35///@" D ^DIE S SROERR=DA D ^SROERR0 S DA=SRTN D ^DIE,OERR,UNLOCK^SROUTL(DA)
"RTN","SRSCAN0",28,0)
 Q
"RTN","SRSCAN0",29,0)
SWAP ; move data into a new entry and set up the cancel date in the old
"RTN","SRSCAN0",30,0)
 W ! K DIR S DIR(0)="130,18",DIR("A")="Cancellation Reason" D ^DIR S SRSCAN=$P(Y,"^") I $D(DIRUT) W !!,"Case NOT cancelled." D PRESS G END
"RTN","SRSCAN0",31,0)
 K DR S SRCON=0,DA=SRTN,DR=".02///@;102///@;235///@;284///@;323///@;18////"_SRSCAN_";67T;70////"_DUZ,DIE=130 D ^DIE S:$D(DTOUT)!$D(DUOUT) SRSOUT=1
"RTN","SRSCAN0",32,0)
 S SRSCHST=$P($G(^SRF(SRTN,31)),"^",4),AVOID=$P(^(30),"^",2)
"RTN","SRSCAN0",33,0)
 I '$P($G(^SRF(SRTN,"CON")),"^") D ^SRSCG
"RTN","SRSCAN0",34,0)
 S SRSDPT=$P(^SRF(SRTN,0),"^"),SRSOP=$P(^SRF(SRTN,"OP"),"^")
"RTN","SRSCAN0",35,0)
 S SRSSET=$P(^SRF(SRTN,31),"^",5),$P(^SRF(SRTN,31),"^",4)="",$P(^SRF(SRTN,31),"^",5)=""
"RTN","SRSCAN0",36,0)
SWAP2 K:SRSCHST&SRSOR ^SRF("AMM",SRSOR,SRSCHST,SRTN) D NOW^%DTC S $P(^SRF(SRTN,30),"^")=$E(%,1,12)
"RTN","SRSCAN0",37,0)
 I '$P($G(^SRF(SRTN,"CON")),"^") D OERR
"RTN","SRSCAN0",38,0)
 I SRSCAN'="" G:$P(^SRO(135,SRSCAN,0),"^",2)="D" CON
"RTN","SRSCAN0",39,0)
 D:'SRSOUT ^SRSCAN2
"RTN","SRSCAN0",40,0)
CON I '$D(SRSCC),$D(^SRF(SRTN,"CON")),$P(^("CON"),"^")'="" D CANCC^SRSUTL2 Q:SRBOTH="^"!SRSOUT  I SRBOTH=1 G CON1
"RTN","SRSCAN0",41,0)
 I SRCON'=0,SRTNEW'=SRCON K DR S DA=SRTNEW,DIE=130,DR="35////"_SRCON D ^DIE S DA=SRCON,DR="35////"_SRTNEW D ^DIE K DR S SROERR=SRCON D ^SROERR0
"RTN","SRSCAN0",42,0)
 I $G(SRDEAD)=0,$G(SRBOTH)=1,$G(SRSCC)=1 S SROERR=$P(^SRF(SRTN,"CON"),"^") D ^SROERR0 S SROERR=SRTN,^TMP("CSLSUR1",$J)="" D ^SROERR0
"RTN","SRSCAN0",43,0)
END D UNLOCK^SROUTL(SRTN),^SRSKILL K SRTN W @IOF
"RTN","SRSCAN0",44,0)
 Q
"RTN","SRSCAN0",45,0)
CON1 I SRDEAD=0 G SWAP2
"RTN","SRSCAN0",46,0)
 K DR S DA=SRTN,DR=".02///@;102///@;235///@;284///@;323///@;18///"_$P(^SRO(135,SRSCAN,0),"^")_";67///"_AVOID_";70////"_DUZ,DIE=130 D ^DIE
"RTN","SRSCAN0",47,0)
 D NOW^%DTC S $P(^SRF(SRTN,30),"^")=$E(%,1,12),$P(^SRF(SRTN,31),"^",4)="",$P(^SRF(SRTN,31),"^",5)=""
"RTN","SRSCAN0",48,0)
OERR ; update ORDER file (100)
"RTN","SRSCAN0",49,0)
 S SROERR=SRTN K SRTX D ^SROERR0
"RTN","SRSCAN0",50,0)
 Q
"RTN","SRSCAN2")
0^13^B12532535^B12416665
"RTN","SRSCAN2",1,0)
SRSCAN2 ;BIR/MAM - MAKE NEW REQUEST WHEN CANCELLED ; [ 06/14/01  9:57 AM ]
"RTN","SRSCAN2",2,0)
 ;;3.0; Surgery ;**3,16,34,67,77,88,92,103,144**;24 Jun 93
"RTN","SRSCAN2",3,0)
START W !!,"Do you want to create a new request for this cancelled case ??  YES// " R SRYN:DTIME I '$T!(SRYN["^") Q
"RTN","SRSCAN2",4,0)
 S SRYN=$E(SRYN) S:SRYN="" SRYN="Y"
"RTN","SRSCAN2",5,0)
 I "YyNn"'[SRYN W !!,"Enter 'YES' to automatically move the information contained in this scheduled",!,"case to a new request, or 'NO' to not create a new request." G START
"RTN","SRSCAN2",6,0)
 I "Yy"'[SRYN Q
"RTN","SRSCAN2",7,0)
 D NEWDT
"RTN","SRSCAN2",8,0)
DATE W ! K %DT S %DT="AEFX",%DT("A")="Make the new request for which Date ?  ",%DT("B")=SRY D ^%DT I Y<0 S OK=1 D HELP Q:'OK  G DATE
"RTN","SRSCAN2",9,0)
 S SRX=+Y D CHK G:$D(SRLATE) DATE S SRNEWDT=SRX W !!,"Creating the new request..."
"RTN","SRSCAN2",10,0)
 K DA,DIC,DD,DO,DINUM S X=SRSDPT,DIC="^SRF(",DIC(0)="L",DLAYGO=130 D FILE^DICN K DD,DO,DIC,DLAYGO S SRTNEW=+Y
"RTN","SRSCAN2",11,0)
 S %X="^SRF("_SRTOLD_",",%Y="^SRF("_SRTNEW_"," D %XY^%RCR K ^SRF(SRTNEW,"PFSS")
"RTN","SRSCAN2",12,0)
 S SRSOP=$P(^SRF(SRTNEW,"OP"),"^"),SRSCPT=$P(^SRF(SRTNEW,"OP"),"^",2),SRSDOC=$S($D(^SRF(SRTNEW,.1)):$P(^(.1),"^",4),1:"")
"RTN","SRSCAN2",13,0)
 K ^SRF(SRTNEW,31),^SRF(SRTNEW,30) S $P(^SRF(SRTNEW,0),"^",2)=""
"RTN","SRSCAN2",14,0)
 N SREQ D NOW^%DTC S SREQ(130,SRTNEW_",",1.098)=+$E(%,1,12),SREQ(130,SRTNEW_",",1.099)=DUZ D FILE^DIE("","SREQ","^TMP(""SR"",$J)")
"RTN","SRSCAN2",15,0)
 S DR="36////1;Q;.09////"_SRNEWDT_";26////"_SRSOP,DA=SRTNEW,DIE=130 D ^DIE
"RTN","SRSCAN2",16,0)
 K DR,DA S DR="[SRO-NOCOMP]",DA=SRTNEW,DIE=130 D ^DIE K DR
"RTN","SRSCAN2",17,0)
 K DR S DIE=130,DA=SRTNEW,DR="68////"_SRSOP D ^DIE K DR
"RTN","SRSCAN2",18,0)
 S SRATT=$P($G(^SRF(SRTN,.1)),"^",13)
"RTN","SRSCAN2",19,0)
 K DIE,DR,DA S DIE=130,DA=SRTNEW,DR=".14////"_SRSDOC_";.164////"_SRATT_";.04////"_$P(^SRF(SRTN,0),"^",4) D ^DIE K DR S SRTN=SRTNEW D ^SROXRET
"RTN","SRSCAN2",20,0)
 I $D(^SRF(SRTNEW,"CON")) S DA=SRTNEW,DIE=130,DR="35///@" D ^DIE K DR,DA
"RTN","SRSCAN2",21,0)
 D NOW^%DTC S SRCAN=+$E(%,1,12),DA=SRTOLD,DIE=130,DR=".02///@;17////"_SRCAN D ^DIE K DR
"RTN","SRSCAN2",22,0)
 S $P(^SRF(SRTOLD,31),"^",4)="",$P(^(31),"^",5)=""
"RTN","SRSCAN2",23,0)
 S SRTN=SRTNEW D ^SROERR S SRTN=SRTOLD
"RTN","SRSCAN2",24,0)
 Q
"RTN","SRSCAN2",25,0)
HELP W !!,"To make a new request, you must select a future date.  Do you want to select",!,"another date ?  YES// " R X:DTIME I '$T!(X["^") S OK=0 Q
"RTN","SRSCAN2",26,0)
 S X=$E(X) I "YyNn"'[X W !!,"Enter 'YES' to select another date, or 'NO' to bypass making a new request." G HELP
"RTN","SRSCAN2",27,0)
 I "Yy"'[X S OK=0
"RTN","SRSCAN2",28,0)
 Q
"RTN","SRSCAN2",29,0)
NEWDT ; get six month default date for new request
"RTN","SRSCAN2",30,0)
 S SRX1=$E($P(^SRF(SRTOLD,0),"^",9),1,7),SRX2=182 K SRCHK D DAY S Y=SRX D D^DIQ S SRY=Y
"RTN","SRSCAN2",31,0)
 Q
"RTN","SRSCAN2",32,0)
CHK ; check for valid request date
"RTN","SRSCAN2",33,0)
 N SRSDATE S SRSDATE=SRX K SRLATE D LATE^SRSREQ
"RTN","SRSCAN2",34,0)
 Q
"RTN","SRSCAN2",35,0)
DAY ; get valid default request date
"RTN","SRSCAN2",36,0)
 S X1=SRX1,X2=SRX2 D C^%DTC I X<DT S SRX1=DT,SRX2=1 G DAY
"RTN","SRSCAN2",37,0)
 S SRX=X K DIC S DIC=40.5,DIC(0)="XM" D ^DIC K DIC
"RTN","SRSCAN2",38,0)
 I Y'=-1,'$D(^SRO(133,SRSITE,3,X,0)) S SRX2=SRX2+1 G DAY
"RTN","SRSCAN2",39,0)
 S X=SRX D H^%DTC S SRDAY=%Y+1 S SRDL=$P($G(^SRO(133,SRSITE,2)),"^",SRDAY) S:SRDL="" SRDL=1 I 'SRDL S SRX2=SRX2+1 G DAY
"RTN","SRSCAN2",40,0)
 Q:'$D(SRSITE("REQ"))  S X1=SRX,X2=-SRDL D C^%DTC S SRDTL=X S DIC=40.5,DIC(0)="XM" D ^DIC K DIC I Y'=-1,'$D(^SRO(133,SRSITE,3,X,0)) S SRX2=SRX2+1 G DAY
"RTN","SRSCAN2",41,0)
 S SRTCHK=SRDTL_"."_SRSITE("REQ") D NOW^%DTC I %>SRTCHK S SRX2=SRX2+1 G DAY
"RTN","SRSCAN2",42,0)
 Q
"RTN","SRSCHUN")
0^10^B27018282^B18782437
"RTN","SRSCHUN",1,0)
SRSCHUN ;BIR/ADM - MAKE UNREQUESTED OPERATION ;02/07/05
"RTN","SRSCHUN",2,0)
 ;;3.0; Surgery ;**3,67,68,88,103,100,144**;24 Jun 93
"RTN","SRSCHUN",3,0)
MUST S SRLINE="" F I=1:1:80 S SRLINE=SRLINE_"="
"RTN","SRSCHUN",4,0)
 W @IOF W:$D(SRCC) !,?29,$S(SRSCON=1:"FIRST",1:"SECOND")_" CONCURRENT CASE" W !,?14,"SCHEDULE UNREQUESTED OPERATION: REQUIRED INFORMATION",!!,SRNM_" ("_$G(SRSSN)_")",?65,SREQDT,!,SRLINE,!
"RTN","SRSCHUN",5,0)
SURG ; surgeon
"RTN","SRSCHUN",6,0)
 K DIR S DIR(0)="130,.14",DIR("A")="Surgeon" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G END
"RTN","SRSCHUN",7,0)
 I Y=""!(X["^") W !!,"To create a surgical case, a surgeon MUST be selected.  Enter '^' to exit.",! G SURG
"RTN","SRSCHUN",8,0)
 S SRSDOC=+Y
"RTN","SRSCHUN",9,0)
CASE ; create case in SURGERY file
"RTN","SRSCHUN",10,0)
 K DA,DIC,DD,DO,DINUM,SRTN S X=SRSDPT,DIC="^SRF(",DIC(0)="L",DLAYGO=130 D FILE^DICN K DD,DO,DIC,DLAYGO S SRTN=+Y,SRLCK=$$LOCK^SROUTL(SRTN)
"RTN","SRSCHUN",11,0)
 S ^SRF(SRTN,8)=SRSITE("DIV"),^SRF(SRTN,"OP")=""
"RTN","SRSCHUN",12,0)
 D NOW^%DTC S SREQDAY=+$E(%,1,12),SRNOCON=1 K DR,DIE
"RTN","SRSCHUN",13,0)
 S DA=SRTN,DIE=130,DR=".09////"_SRSDATE_";.14////"_SRSDOC_";1.098////"_+SREQDAY_";1.099////"_DUZ_";Q;.02////"_SRSOR_";10////"_SRSDT1_";11////"_SRSDT2 D ^DIE K DR
"RTN","SRSCHUN",14,0)
ASURG ; attending surgeon
"RTN","SRSCHUN",15,0)
 K DA,DIC,DIQ,DR,SRY S DIC="^SRF(",DA=SRTN,DIQ="SRY",DIQ(0)="E",DR=.164 D EN^DIQ1 K DA,DIC,DIQ,DR
"RTN","SRSCHUN",16,0)
 I $G(SRY(130,SRTN,.164,"E"))'="" S SRATTND=SRY(130,SRTN,.164,"E") W !,"Attending Surgeon: "_SRATTND,! G SPEC
"RTN","SRSCHUN",17,0)
 K DIR S DIR(0)="130,.164",DIR("A")="Attending Surgeon" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSCHUN",18,0)
 I Y=""!(X["^") W !!,"An Attending Surgeon must be entered when creating a case. Enter '^' to exit.",! G ASURG
"RTN","SRSCHUN",19,0)
 S SRATTND=+Y
"RTN","SRSCHUN",20,0)
SPEC ; surgical specialty
"RTN","SRSCHUN",21,0)
 K DIR S DIR(0)="130,.04",DIR("A")="Surgical Specialty" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSCHUN",22,0)
 I Y=""!(X["^") W !!,"To create a surgical case, a surgical specialty MUST be selected.  Enter '^'",!,"to exit.",! G SPEC
"RTN","SRSCHUN",23,0)
 S SRSS=+Y
"RTN","SRSCHUN",24,0)
OP ; principal operative procedure
"RTN","SRSCHUN",25,0)
 K DIR S DIR(0)="130,26",DIR("A")="Principal Operative Procedure" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSCHUN",26,0)
 I X["^" W !!,"Principal procedure must not contain an up-arrow (^).",! G OP
"RTN","SRSCHUN",27,0)
 S SRSOP=Y I SRSOP="" G OP
"RTN","SRSCHUN",28,0)
OPD ; Principal Preoperative Diagnosis
"RTN","SRSCHUN",29,0)
 K DIR S DIR(0)="130,32",DIR("A")="Principal Preoperative Diagnosis" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSCHUN",30,0)
 I Y=""!(X["^") W !!,"A Principal Preoperative Diagnosis must be entered",!,"when creating a new case. Enter '^' to exit.",! G OPD
"RTN","SRSCHUN",31,0)
 I X[";" W !,"The Principal Preoperative Diagnosis cannot contain a semicolon (;).",!,"Please re-enter the Diagnosis, using commas in place of the semicolons." G OPD
"RTN","SRSCHUN",32,0)
 S SRSOPD=Y
"RTN","SRSCHUN",33,0)
 W !!,"The information entered into the Principal Preoperative Diagnosis field",!,"has been transferred into the Indications for Operation field.",!,"The Indications for Operation field can be updated later if necessary.",!
"RTN","SRSCHUN",34,0)
 W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SRSCHUN",35,0)
UPDATE ; update case in SURGERY file
"RTN","SRSCHUN",36,0)
 S DA=SRTN,DIE=130,DR="26////"_SRSOP_";68////"_SRSOP_";36////0;Q;.04////"_SRSS_";.164////"_SRATTND_";32////"_SRSOPD D ^DIE
"RTN","SRSCHUN",37,0)
 K DR,DA S DR="[SRO-NOCOMP]",DA=SRTN,DIE=130 D ^DIE K DR
"RTN","SRSCHUN",38,0)
 D ^SROXRET K SRNOCON
"RTN","SRSCHUN",39,0)
OTHER ; other required fields
"RTN","SRSCHUN",40,0)
 S SRFLD=0 F  S SRFLD=$O(^SRO(133,SRSITE,4,SRFLD)) Q:'SRFLD!(SRSOUT)  D OTHDIR Q:SRSOUT
"RTN","SRSCHUN",41,0)
 I SRSOUT G DEL
"RTN","SRSCHUN",42,0)
 S SRSOPD(1)=SRSOPD D WP^DIE(130,SRTN_",",55,"A","SRSOPD")
"RTN","SRSCHUN",43,0)
 D:$G(SRLCK) UNLOCK^SROUTL(SRTN)
"RTN","SRSCHUN",44,0)
 S SROERR=SRTN D ^SROERR I $D(SRDUOUT) S SRSOUT=1
"RTN","SRSCHUN",45,0)
 I $D(SRCC),SRSCON=2 S DIE=130,DR="35////"_SRSCON(1),DA=SRTN D ^DIE K DR S DR="35////"_SRTN,DA=SRSCON(1),DIE=130 D ^DIE K DR,DA S SROERR=SRSCON(1) D ^SROERR0
"RTN","SRSCHUN",46,0)
 Q
"RTN","SRSCHUN",47,0)
DEL S DA=SRTN,DIK="^SRF(" D ^DIK G END
"RTN","SRSCHUN",48,0)
CON ; request concurrent case
"RTN","SRSCHUN",49,0)
 D MUST Q:SRSOUT  S SRSCON(SRSCON,"DOC")=$P(^VA(200,SRSDOC,0),"^"),SRSCON(SRSCON,"SS")=$P(^SRO(137.45,SRSS,0),"^"),SRSCON(SRSCON,"OP")=$P(^SRF(SRTN,"OP"),"^"),SRSCON(SRSCON)=SRTN K DA
"RTN","SRSCHUN",50,0)
 Q
"RTN","SRSCHUN",51,0)
OTHDIR ; call to reader for site specific required fields
"RTN","SRSCHUN",52,0)
 K DIR,SREQ,SRY S FLD=$P(^SRO(133,SRSITE,4,SRFLD,0),"^") D FIELD^DID(130,FLD,"","TITLE","SRY") S DIR(0)="130,"_FLD,DIR("A")=SRY("TITLE") D ^DIR I $D(DTOUT)!(X="^") S SRSOUT=1 Q
"RTN","SRSCHUN",53,0)
 I Y=""!(X["^") W !!,"It is mandatory that you provide this information before proceeding with this",!,"option.",! D ASK Q:SRSOUT  G OTHDIR
"RTN","SRSCHUN",54,0)
 S SREQ(130,SRTN_",",FLD)=$P(Y,"^") D FILE^DIE("","SREQ","^TMP(""SR"",$J)")
"RTN","SRSCHUN",55,0)
 Q
"RTN","SRSCHUN",56,0)
ASK K DIR S DIR(0)="Y",DIR("A")="Do you want to continue with this option ",DIR("B")="YES"
"RTN","SRSCHUN",57,0)
 S DIR("?")="Enter RETURN to continue with this option, or 'NO' to discontinue this option." D ^DIR S:'Y SRSOUT=1
"RTN","SRSCHUN",58,0)
 Q
"RTN","SRSCHUN",59,0)
END D:$G(SRLCK) UNLOCK^SROUTL(SRTN)
"RTN","SRSCHUN",60,0)
 I '$D(SRCC),SRSOUT W !!,"No surgical case has been scheduled.",! S SRTN("OR")=SRSOR,SRTN("START")=SRSDT1,SRTN("END")=SRSDT2,SRSEDT=$E(SRSDT2,1,7) D ^SRSCG
"RTN","SRSCHUN",61,0)
 Q
"RTN","SRSCPT1")
0^14^B14019263^B15065442
"RTN","SRSCPT1",1,0)
SRSCPT1 ;BIR/MAM - MISSING CPTS (1 SPECIALTY) ;03/29/06
"RTN","SRSCPT1",2,0)
 ;;3.0; Surgery ;**59,50,88,142,144**;24 Jun 93
"RTN","SRSCPT1",3,0)
 F  S SRSDT=$O(^SRF("AC",SRSDT)) Q:'SRSDT!(SRSDT>SRSEDT)  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDT,SRTN)) Q:'SRTN  I $P($G(^SRF(SRTN,30)),"^")="",$D(^SRF(SRTN,0)),$$DIV^SROUTL0(SRTN) D UTIL
"RTN","SRSCPT1",4,0)
 S STARTDT=$E(SDATE,4,5)_"/"_$E(SDATE,6,7)_"/"_$E(SDATE,2,3),ENDATE=$E(EDATE,4,5)_"/"_$E(EDATE,6,7)_"/"_$E(EDATE,2,3)
"RTN","SRSCPT1",5,0)
 S (SRHDR,SRSOUT)=0 D HDR S SRHDR=1,SRSDT=0 F  S SRSDT=$O(^TMP("SR",$J,SRSDT)) Q:'SRSDT!(SRSOUT)  S SRTN=0 F  S SRTN=$O(^TMP("SR",$J,SRSDT,SRTN)) Q:'SRTN!(SRSOUT)  K SR,SROP D SET
"RTN","SRSCPT1",6,0)
 I '$D(^TMP("SR",$J)) W $$NODATA^SROUTL0()
"RTN","SRSCPT1",7,0)
 Q
"RTN","SRSCPT1",8,0)
SET ; set variables & print info
"RTN","SRSCPT1",9,0)
 I $Y+8>IOSL D HDR I SRSOUT Q
"RTN","SRSCPT1",10,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SRSCPT1",11,0)
 S SR(0)=^SRF(SRTN,0)
"RTN","SRSCPT1",12,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:$P(SR(0),"^",4)'=SRSPEC
"RTN","SRSCPT1",13,0)
 I SRFLG=2!(SRFLG=3&(SRNON)) Q:$P($G(^SRF(SRTN,"NON")),"^",8)'=SRSPEC
"RTN","SRSCPT1",14,0)
 S DFN=+SR(0) D DEM^VADPT S SRSNM=VADM(1),SRSSN=VA("PID"),Y=$P(SR(0),"^",9) D D^DIQ S SRSDATE=$E(Y,1,12) I $L(SRSNM)>23 S SRSNM=$P(VADM(1),",")_","_$E($P(VADM(1),",",2))_"."
"RTN","SRSCPT1",15,0)
 S SROP(1)=$P(^SRF(SRTN,"OP"),"^")
"RTN","SRSCPT1",16,0)
 S CNT=1,OP=0 F  S OP=$O(^SRF(SRTN,13,OP)) Q:'OP  D
"RTN","SRSCPT1",17,0)
 .S CNT=CNT+1,SROP(CNT)=$P(^SRF(SRTN,13,OP,0),"^")
"RTN","SRSCPT1",18,0)
 S SR(.1)=$S($D(^SRF(SRTN,.1)):^(.1),1:"")
"RTN","SRSCPT1",19,0)
 S SRSUR=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",6),1:$P(SR(.1),"^",4)) S:SRSUR="" SRSUR="NOT ENTERED" I SRSUR S SRSUR=$P(^VA(200,SRSUR,0),"^") I $L(SRSUR)>19 S SRSUR=$P(SRSUR,",")_","_$E($P(SRSUR,",",2))_"."
"RTN","SRSCPT1",20,0)
 W !,SRSDATE,?18,SRSNM_" ("_VA("PID")_")",?60,SRSUR,!,SRTN W:SRFLG=3&(SRNON) !,"NON-O.R."
"RTN","SRSCPT1",21,0)
 S CNT=0 F  S CNT=$O(SROP(CNT)) Q:'CNT  S SROPER="* "_SROP(CNT) D OPS
"RTN","SRSCPT1",22,0)
 W ! F LINE=1:1:80 W "-"
"RTN","SRSCPT1",23,0)
 Q
"RTN","SRSCPT1",24,0)
UTIL ; set ^TMP("SR",$J)
"RTN","SRSCPT1",25,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SRSCPT1",26,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:$P($G(^SRF(SRTN,.2)),"^",12)=""
"RTN","SRSCPT1",27,0)
 I SRFLG=2 Q:'SRNON
"RTN","SRSCPT1",28,0)
 S SRMISS=0 I '$P($G(^SRO(136,SRTN,0)),"^",2) S SRMISS=1
"RTN","SRSCPT1",29,0)
 I 'SRMISS Q
"RTN","SRSCPT1",30,0)
UT S ^TMP("SR",$J,SRSDT,SRTN)=""
"RTN","SRSCPT1",31,0)
 Q
"RTN","SRSCPT1",32,0)
HDR ; print heading
"RTN","SRSCPT1",33,0)
 I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRSOUT=1 Q
"RTN","SRSCPT1",34,0)
 I SRHDR,$E(IOST)'="P" W !!,"Press RETURN to continue, or '^' to quit:.  " R X:DTIME I '$T!(X["^") S SRSOUT=1 Q
"RTN","SRSCPT1",35,0)
 S SRTITLE=$S(SRFLG=1:"O.R. Surgical Procedures",SRFLG=2:"Non-O.R. Procedures",1:"O.R. Surgical and Non-O.R. Procedures")
"RTN","SRSCPT1",36,0)
 W:$Y @IOF W !,?(80-$L(SRINST)\2),SRINST,!,?23,"Completed Cases Missing CPT Codes",!,?(80-$L(SRTITLE)\2),SRTITLE,!,?(80-$L(SRFRTO)\2),SRFRTO
"RTN","SRSCPT1",37,0)
 W !,?(80-$L("Specialty: "_SRSPECN)\2),"Specialty: "_SRSPECN,!!,"Operation Date",?18,"Patient (ID#)",?60,"Surgeon/Provider",!,"Case #",! F LINE=1:1:80 W "="
"RTN","SRSCPT1",38,0)
 Q
"RTN","SRSCPT1",39,0)
OPS ; print operations
"RTN","SRSCPT1",40,0)
 K SROPS,MM,MMM S:$L(SROPER)<60 SROPS(1)=SROPER I $L(SROPER)>59 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SRSCPT1",41,0)
 W !,?18,SROPS(1) I $D(SROPS(2)) W !,?18,SROPS(2) I $D(SROPS(3)) W !,?18,SROPS(3) I $D(SROPS(4)) W !,?18,SROPS(4)
"RTN","SRSCPT1",42,0)
 Q
"RTN","SRSCPT1",43,0)
LOOP ; break procedure if greater than 59 characters
"RTN","SRSCPT1",44,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<60  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SRSCPT1",45,0)
 Q
"RTN","SRSCPT2")
0^15^B15586528^B16666832
"RTN","SRSCPT2",1,0)
SRSCPT2 ;BIR/MAM - MISSING CPTS (ALL SPECIALTIES) ;03/29/06
"RTN","SRSCPT2",2,0)
 ;;3.0; Surgery ;**59,50,88,142,144**;24 Jun 93
"RTN","SRSCPT2",3,0)
 ;
"RTN","SRSCPT2",4,0)
 ; Reference to ^ECC(723 supported by DBIA #205
"RTN","SRSCPT2",5,0)
 ;
"RTN","SRSCPT2",6,0)
 F  S SRSDT=$O(^SRF("AC",SRSDT)) Q:'SRSDT!(SRSDT>SRSEDT)  S SRTN=0 F  S SRTN=$O(^SRF("AC",SRSDT,SRTN)) Q:'SRTN  I $P($G(^SRF(SRTN,30)),"^")="",$D(^SRF(SRTN,0)),$$DIV^SROUTL0(SRTN) D UTIL
"RTN","SRSCPT2",7,0)
 S (SRSPEC,SRHDR,SRSOUT)=0 F  S SRSPEC=$O(^TMP("SR",$J,SRSPEC)) Q:SRSPEC=""!(SRSOUT)  D HDR S SRHDR=1 S SRSDT=0 F  S SRSDT=$O(^TMP("SR",$J,SRSPEC,SRSDT)) Q:'SRSDT!(SRSOUT)  D CASE
"RTN","SRSCPT2",8,0)
 I '$D(^TMP("SR",$J)) S SRSPEC="" D HDR W $$NODATA^SROUTL0()
"RTN","SRSCPT2",9,0)
 Q
"RTN","SRSCPT2",10,0)
CASE ; get case number
"RTN","SRSCPT2",11,0)
 S SRTN=0 F  S SRTN=$O(^TMP("SR",$J,SRSPEC,SRSDT,SRTN)) Q:'SRTN!(SRSOUT)  K SR,SROP D SET
"RTN","SRSCPT2",12,0)
 Q
"RTN","SRSCPT2",13,0)
SET ; set variables & print info
"RTN","SRSCPT2",14,0)
 I $Y+8>IOSL D HDR I SRSOUT Q
"RTN","SRSCPT2",15,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SRSCPT2",16,0)
 S SR(0)=^SRF(SRTN,0),DFN=+SR(0) D DEM^VADPT S SRSNM=VADM(1),SRSSN=VA("PID"),Y=$P(SR(0),"^",9) D D^DIQ S SRSDATE=$E(Y,1,12) I $L(SRSNM)>23 S SRSNM=$P(VADM(1),",")_","_$E($P(VADM(1),",",2))_"."
"RTN","SRSCPT2",17,0)
 S SROP(1)=$P(^SRF(SRTN,"OP"),"^")
"RTN","SRSCPT2",18,0)
 S CNT=1,OP=0 F  S OP=$O(^SRF(SRTN,13,OP)) Q:'OP  D
"RTN","SRSCPT2",19,0)
 .S CNT=CNT+1,SROP(CNT)=$P(^SRF(SRTN,13,OP,0),"^")
"RTN","SRSCPT2",20,0)
 S SR(.1)=$S($D(^SRF(SRTN,.1)):^(.1),1:"")
"RTN","SRSCPT2",21,0)
 S SRSUR=$S(SRNON:$P(^SRF(SRTN,"NON"),"^",6),1:$P(SR(.1),"^",4)) S:SRSUR="" SRSUR="NOT ENTERED" I SRSUR S SRSUR=$P(^VA(200,SRSUR,0),"^") I $L(SRSUR)>19 S SRSUR=$P(SRSUR,",")_","_$E($P(SRSUR,",",2))_"."
"RTN","SRSCPT2",22,0)
 W !,SRSDATE,?18,SRSNM_" ("_VA("PID")_")",?60,SRSUR,!,SRTN W:SRFLG=3&(SRNON) !,"NON-O.R."
"RTN","SRSCPT2",23,0)
 S CNT=0 F  S CNT=$O(SROP(CNT)) Q:'CNT  S SROPER="* "_SROP(CNT) D OPS
"RTN","SRSCPT2",24,0)
 W ! F LINE=1:1:80 W "-"
"RTN","SRSCPT2",25,0)
 Q
"RTN","SRSCPT2",26,0)
UTIL ; set ^TMP("SR",$J)
"RTN","SRSCPT2",27,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SRSCPT2",28,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:$P($G(^SRF(SRTN,.2)),"^",12)=""
"RTN","SRSCPT2",29,0)
 I SRFLG=2 Q:'SRNON
"RTN","SRSCPT2",30,0)
 S SRMISS=0 I '$P($G(^SRO(136,SRTN,0)),"^",2) S SRMISS=1
"RTN","SRSCPT2",31,0)
 I 'SRMISS Q
"RTN","SRSCPT2",32,0)
UT I SRNON S SRSPEC=$P(^SRF(SRTN,"NON"),"^",8),SRSPECN=$S(SRSPEC:$P(^ECC(723,SRSPEC,0),"^"),1:"UNKNOWN")
"RTN","SRSCPT2",33,0)
 I 'SRNON S SRSPEC=$P(^SRF(SRTN,0),"^",4),SRSPECN=$S('SRSPEC:"UNKNOWN",1:$P(^SRO(137.45,SRSPEC,0),"^"))
"RTN","SRSCPT2",34,0)
 S ^TMP("SR",$J,SRSPECN,SRSDT,SRTN)=""
"RTN","SRSCPT2",35,0)
 Q
"RTN","SRSCPT2",36,0)
HDR ; print heading
"RTN","SRSCPT2",37,0)
 I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRSOUT=1 Q
"RTN","SRSCPT2",38,0)
 I SRHDR,$E(IOST)'="P" W !!,"Press RETURN to continue, or '^' to quit:.  " R X:DTIME I '$T!(X["^") S SRSOUT=1 Q
"RTN","SRSCPT2",39,0)
 S SRTITLE=$S(SRFLG=1:"O.R. Surgical Procedures",SRFLG=2:"Non-O.R. Procedures",1:"O.R. Surgical and Non-O.R. Procedures")
"RTN","SRSCPT2",40,0)
 W:$Y @IOF W !,?(80-$L(SRINST)\2),SRINST,!,?23,"Completed Cases Missing CPT Codes",!,?(80-$L(SRTITLE)\2),SRTITLE,!,?(80-$L(SRFRTO)\2),SRFRTO
"RTN","SRSCPT2",41,0)
 W:SRSPEC'="" !,?(80-$L("Specialty: "_SRSPEC)\2),"Specialty: "_SRSPEC W !!,"Operation Date",?18,"Patient (ID#)",?60,"Surgeon/Provider",!,"Case #",! F LINE=1:1:80 W "="
"RTN","SRSCPT2",42,0)
 Q
"RTN","SRSCPT2",43,0)
OPS ; print operations
"RTN","SRSCPT2",44,0)
 K SROPS,MM,MMM S:$L(SROPER)<60 SROPS(1)=SROPER I $L(SROPER)>59 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SRSCPT2",45,0)
 W !,?18,SROPS(1) I $D(SROPS(2)) W !,?18,SROPS(2) I $D(SROPS(3)) W !,?18,SROPS(3) I $D(SROPS(4)) W !,?18,SROPS(4)
"RTN","SRSCPT2",46,0)
 Q
"RTN","SRSCPT2",47,0)
LOOP ; break procedure if greater than 59 characters
"RTN","SRSCPT2",48,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<60  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SRSCPT2",49,0)
 Q
"RTN","SRSRQST")
0^11^B26274386^B18734684
"RTN","SRSRQST",1,0)
SRSRQST ;BIR/MAM,ADM - MAKE OPERATION REQUESTS ;11/01/01  9:40 AM
"RTN","SRSRQST",2,0)
 ;;3.0; Surgery ;**3,58,67,88,103,105,100,144**;24 Jun 93
"RTN","SRSRQST",3,0)
MUST S SRLINE="" F I=1:1:80 S SRLINE=SRLINE_"="
"RTN","SRSRQST",4,0)
 W @IOF W:$D(SRCC) !,?29,$S(SRSCON=1:"FIRST",1:"SECOND")_" CONCURRENT CASE" W !,?20,"OPERATION REQUEST: REQUIRED INFORMATION",!!,SRNM_" ("_SRSSN_")",?65,SREQDT,!,SRLINE,!
"RTN","SRSRQST",5,0)
SURG ; surgeon
"RTN","SRSRQST",6,0)
 K DIR S DIR(0)="130,.14",DIR("A")="Surgeon" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G END
"RTN","SRSRQST",7,0)
 I Y=""!(X["^") W !!,"To make an operation request, a Surgeon MUST be selected.  Enter '^' to exit.",! G SURG
"RTN","SRSRQST",8,0)
 S SRSDOC=+Y
"RTN","SRSRQST",9,0)
CASE K DA,DIC,DD,DO,DINUM,SRTN S X=SRSDPT,DIC="^SRF(",DIC(0)="L",DLAYGO=130 D FILE^DICN K DD,DO,DIC,DLAYGO S SRTN=+Y
"RTN","SRSRQST",10,0)
 N SRLCK S SRLCK=$$LOCK^SROUTL(SRTN)
"RTN","SRSRQST",11,0)
 S ^SRF(SRTN,8)=SRSITE("DIV"),^SRF(SRTN,"OP")=""
"RTN","SRSRQST",12,0)
 D NOW^%DTC S SREQDAY=+$E(%,1,12),SRNOCON=1 K DR,DIE
"RTN","SRSRQST",13,0)
 S DA=SRTN,DIE=130,DR="36////1;Q;.09////"_SRSDATE_";.14////"_SRSDOC_";1.098////"_+SREQDAY_";1.099////"_DUZ_";Q" D ^DIE K DR
"RTN","SRSRQST",14,0)
ASURG ; attending surgeon
"RTN","SRSRQST",15,0)
 K DIR S DIR(0)="130,.164",DIR("A")="Attending Surgeon" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSRQST",16,0)
 I Y=""!(X["^") W !!,"To make an operation request, Attending Surgeon MUST be selected.  Enter '^' to exit.",! G ASURG
"RTN","SRSRQST",17,0)
 S SRATTND=+Y
"RTN","SRSRQST",18,0)
SPEC ; surgical specialty
"RTN","SRSRQST",19,0)
 I SRWL W !,"Surgical Specialty: "_$P(^SRO(137.45,SRSS,0),"^") G OP
"RTN","SRSRQST",20,0)
 K DIR S DIR(0)="130,.04",DIR("A")="Surgical Specialty" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSRQST",21,0)
 I Y=""!(X["^") W !!,"To make an operation request, a Surgical Specialty MUST be selected.  Enter '^'",!,"to exit.",! G SPEC
"RTN","SRSRQST",22,0)
 S SRSS=+Y
"RTN","SRSRQST",23,0)
OP ; principal operative procedure
"RTN","SRSRQST",24,0)
 I SRWL W !,"Principal Operative Procedure: "_SRSOP G OPD
"RTN","SRSRQST",25,0)
 K DIR S DIR(0)="130,26",DIR("A")="Principal Operative Procedure" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSRQST",26,0)
 I X["^" W !!,"Principal procedure must not contain an up-arrow (^).",! G OP
"RTN","SRSRQST",27,0)
 S SRSOP=Y
"RTN","SRSRQST",28,0)
OPD ; Principal Preoperative Diagnosis
"RTN","SRSRQST",29,0)
 K DIR S DIR(0)="130,32",DIR("A")="Principal Preoperative Diagnosis" D ^DIR K DIR I $D(DTOUT)!(X="^") S SRSOUT=1 G DEL
"RTN","SRSRQST",30,0)
 I Y=""!(X["^") W !,"Principal Preoperative Diagnosis MUST be entered",!,"before proceeding with this request. Enter '^' to exit.",! G OPD
"RTN","SRSRQST",31,0)
 I X[";" W !!,"The Principal Preoperative Diagnosis cannot contain a semicolon (;).",!,"Please re-enter the Diagnosis, using commas in place of the semicolons." G OPD
"RTN","SRSRQST",32,0)
 S SRSOPD=Y
"RTN","SRSRQST",33,0)
 W !!,"The information entered into the Principal Preoperative Diagnosis field",!,"has been transferred into the Indications for Operation field.",!,"The Indications for Operation field can be updated later if necessary.",!
"RTN","SRSRQST",34,0)
 W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SRSRQST",35,0)
UPDATE S DA=SRTN,DIE=130,DR="26////"_SRSOP_";68////"_SRSOP_";.04////"_SRSS_";.164////"_SRATTND_";32////"_SRSOPD D ^DIE
"RTN","SRSRQST",36,0)
 I SRWL K DA,DIE,DR S DA=SRTN,DIE=130,DR=".016////"_SRCL(16)_";.017////"_SRCL(17)_";.018////"_SRCL(18)_";.019////"_SRCL(19)_";.0155////"_SRCL(20)_";.022////"_SRCL(21)_";.023////"_SRCL(22) D ^DIE
"RTN","SRSRQST",37,0)
 K DR,DA S DR="[SRO-NOCOMP]",DA=SRTN,DIE=130 D ^DIE K DR
"RTN","SRSRQST",38,0)
 S ^SRF(SRTN,8)=SRSITE("DIV") D ^SROXRET K SRNOCON
"RTN","SRSRQST",39,0)
OTHER ; other required fields
"RTN","SRSRQST",40,0)
 S SRFLD=0 F  S SRFLD=$O(^SRO(133,SRSITE,4,SRFLD)) Q:'SRFLD!(SRSOUT)  D OTHDIR Q:SRSOUT
"RTN","SRSRQST",41,0)
 I SRSOUT G DEL
"RTN","SRSRQST",42,0)
 S SRSOPD(1)=SRSOPD D WP^DIE(130,SRTN_",",55,"A","SRSOPD")
"RTN","SRSRQST",43,0)
 I $D(SRCC),SRSCON=2 S DIE=130,DR="35////"_SRSCON(1),DA=SRTN D ^DIE K DR S DR="35////"_SRTN,DA=SRSCON(1),DIE=130 D ^DIE K DR,DA
"RTN","SRSRQST",44,0)
 D ^SROERR I $D(SRDUOUT) S SRSOUT=1 Q
"RTN","SRSRQST",45,0)
 I '$D(SRCC) D ^SRSRQST1
"RTN","SRSRQST",46,0)
 D:$G(SRLCK) UNLOCK^SROUTL(SRTN)
"RTN","SRSRQST",47,0)
 Q
"RTN","SRSRQST",48,0)
DEL I SRSOUT S DA=SRTN,DIK="^SRF(" D ^DIK
"RTN","SRSRQST",49,0)
END D:$G(SRLCK) UNLOCK^SROUTL(SRTN)
"RTN","SRSRQST",50,0)
 I SRSOUT W !!,"No request has been entered.",! S:'$D(SRCC) SRSOUT=0
"RTN","SRSRQST",51,0)
 Q
"RTN","SRSRQST",52,0)
CON ; request concurrent case
"RTN","SRSRQST",53,0)
 D MUST Q:SRSOUT  S SRSCON(SRSCON,"DOC")=$P(^VA(200,SRSDOC,0),"^"),SRSCON(SRSCON,"SS")=$P(^SRO(137.45,SRSS,0),"^"),SRSCON(SRSCON,"OP")=SRSOP,SRSCON(SRSCON)=SRTN K DA
"RTN","SRSRQST",54,0)
 Q
"RTN","SRSRQST",55,0)
OTHDIR ; call to reader for site specific required fields
"RTN","SRSRQST",56,0)
 K DIR,SREQ,SRY S FLD=$P(^SRO(133,SRSITE,4,SRFLD,0),"^") D FIELD^DID(130,FLD,"","TITLE","SRY") S DIR(0)="130,"_FLD,DIR("A")=SRY("TITLE") D ^DIR I $D(DTOUT)!(X="^") S SRSOUT=1 Q
"RTN","SRSRQST",57,0)
 I Y=""!(X["^") W !!,"It is mandatory that you provide this information before proceeding with this",!,"request.",! D ASK Q:SRSOUT  G OTHDIR
"RTN","SRSRQST",58,0)
 S SREQ(130,SRTN_",",FLD)=$P(Y,"^") D FILE^DIE("","SREQ","^TMP(""SR"",$J)")
"RTN","SRSRQST",59,0)
 Q
"RTN","SRSRQST",60,0)
ASK K DIR S DIR(0)="Y",DIR("A")="Do you want to continue with this request ",DIR("B")="YES"
"RTN","SRSRQST",61,0)
 S DIR("?")="Enter RETURN to continue with this request, or 'NO' to discontinue this request." D ^DIR S:'Y SRSOUT=1
"RTN","SRSRQST",62,0)
 Q
"VER")
8.0^22.0
"^DD",130,130,.09,0)
DATE OF OPERATION^RDX^^0;9^S %DT="ETX" D ^%DT S X=Y K:Y<1 X I $D(X) D SCH^SRODATE
"^DD",130,130,.09,.1)
Date of Operation
"^DD",130,130,.09,1,0)
^.1
"^DD",130,130,.09,1,1,0)
130^AC^MUMPS
"^DD",130,130,.09,1,1,1)
S ^SRF("AC",X,DA)=$P(^SRF(DA,0),"^")
"^DD",130,130,.09,1,1,2)
K ^SRF("AC",X,DA)
"^DD",130,130,.09,1,1,"%D",0)
^^2^2^2930128^
"^DD",130,130,.09,1,1,"%D",1,0)
The AC cross reference on the DATE OF OPERATION field is used to sort
"^DD",130,130,.09,1,1,"%D",2,0)
entries by date of operation for reports.
"^DD",130,130,.09,1,2,0)
130^ADT^MUMPS
"^DD",130,130,.09,1,2,1)
D ADT^SROXR2
"^DD",130,130,.09,1,2,2)
D KADT^SROXR2
"^DD",130,130,.09,1,2,"%D",0)
^^3^3^2930128^^^
"^DD",130,130,.09,1,2,"%D",1,0)
The ADT cross reference on the DATE OF OPERATION field uses the 'inverse'
"^DD",130,130,.09,1,2,"%D",2,0)
date/time format to sort and to display cases by inverse chronological
"^DD",130,130,.09,1,2,"%D",3,0)
order.
"^DD",130,130,.09,1,3,0)
130^ASP1^MUMPS
"^DD",130,130,.09,1,3,1)
D SP^SROXR1
"^DD",130,130,.09,1,3,2)
D KSP^SROXR1
"^DD",130,130,.09,1,3,"%D",0)
^^2^2^2930128^^
"^DD",130,130,.09,1,3,"%D",1,0)
The ASP1 cross reference on the DATE OF OPERATION field updates the
"^DD",130,130,.09,1,3,"%D",2,0)
ASP and the AOR cross references when the date of operation is changed.
"^DD",130,130,.09,1,4,0)
130^AR^MUMPS
"^DD",130,130,.09,1,4,1)
D AR^SROXR1
"^DD",130,130,.09,1,4,2)
D KAR^SROXR1
"^DD",130,130,.09,1,4,"%D",0)
^^4^4^2930128^^^
"^DD",130,130,.09,1,4,"%D",1,0)
The AR cross reference on the DATE OF OPERATION field is used to sort
"^DD",130,130,.09,1,4,"%D",2,0)
and display requested cases.  This cross reference is created when a
"^DD",130,130,.09,1,4,"%D",3,0)
case is requested or when the request date is changed.  Upon scheduling
"^DD",130,130,.09,1,4,"%D",4,0)
the request, the AR cross reference for the case is deleted.
"^DD",130,130,.09,1,4,"DT")
2911002
"^DD",130,130,.09,3)
Enter the date that the principal operation was performed.  The patient may have more than principal operation (and operative record) on the same day.
"^DD",130,130,.09,5,1,0)
130^.205^1
"^DD",130,130,.09,5,2,0)
130^120^1
"^DD",130,130,.09,21,0)
^^2^2^2900104^
"^DD",130,130,.09,21,1,0)
This is the date that the case was performed.  The date of operation
"^DD",130,130,.09,21,2,0)
must be entered for all cases.
"^DD",130,130,.09,"DT")
3051020
"^DD",130,130,32,0)
PRINCIPAL PRE-OP DIAGNOSIS^FX^^33;1^K:$L(X)>40!($L(X)<1) X D:$D(X) DIAG^SROUTL,PRINASO^SROADX2(0)
"^DD",130,130,32,.1)
Principal Preoperative Diagnosis
"^DD",130,130,32,1,0)
^.1
"^DD",130,130,32,1,1,0)
^^TRIGGER^130^34
"^DD",130,130,32,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^SRF(D0,34)):^(34),1:"") S X=$P(Y(1),U,1),X=X S DIU=X K Y S X=DIV S X=DIV X ^DD(130,32,1,1,1.4)
"^DD",130,130,32,1,1,1.4)
S DIH=$S($D(^SRF(DIV(0),34)):^(34),1:""),DIV=X S %=$P(DIH,U,2,999),DIU=$P(DIH,U,1),^(34)=DIV_$S(%]"":U_%,1:""),DIH=130,DIG=34 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",130,130,32,1,1,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^SRF(D0,34)):^(34),1:"") S X=$P(Y(1),U,1),X=X S DIU=X K Y X ^DD(130,32,1,1,2.1) X ^DD(130,32,1,1,2.4)
"^DD",130,130,32,1,1,2.1)
S X=DIV S Y(1)=$S($D(^SRF(D0,33)):^(33),1:"") S X=$P(Y(1),U,1)
"^DD",130,130,32,1,1,2.4)
S DIH=$S($D(^SRF(DIV(0),34)):^(34),1:""),DIV=X S %=$P(DIH,U,2,999),DIU=$P(DIH,U,1),^(34)=DIV_$S(%]"":U_%,1:""),DIH=130,DIG=34 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",130,130,32,1,1,"%D",0)
^.101^3^3^3031002^^^
"^DD",130,130,32,1,1,"%D",1,0)
This trigger on the PRINCIPAL PRE-OP DIAGNOSIS field stuffs the PRINCIPAL
"^DD",130,130,32,1,1,"%D",2,0)
POST-OP DIAGNOSIS field with what is entered as the PRINCIPAL PRE-OP
"^DD",130,130,32,1,1,"%D",3,0)
DIAGNOSIS.
"^DD",130,130,32,1,1,"CREATE VALUE")
PRINCIPAL PRE
"^DD",130,130,32,1,1,"DELETE VALUE")
PRINCIPAL PRE
"^DD",130,130,32,1,1,"FIELD")
PRINCIPAL PO
"^DD",130,130,32,1,2,0)
130^DADX1^MUMPS
"^DD",130,130,32,1,2,1)
Q
"^DD",130,130,32,1,2,2)
D DELASOC^SROADX2
"^DD",130,130,32,1,2,"%D",0)
^.101^1^1^3031014^^
"^DD",130,130,32,1,2,"%D",1,0)
This cross reference removes associations from diagnosis being deleted.
"^DD",130,130,32,1,2,"DT")
3031001
"^DD",130,130,32,3)
Your answer must be 1 to 40 characters in length.
"^DD",130,130,32,21,0)
^.001^2^2^3031014^^^^
"^DD",130,130,32,21,1,0)
This is the preoperative diagnosis for which the surgical procedure
"^DD",130,130,32,21,2,0)
is being performed.
"^DD",130,130,32,"DEL",1,0)
I 1 D EN^DDIOL("The PRINCIPAL PRE-OP DIAGNOSIS can't be deleted.",,"!!,?2")
"^DD",130,130,32,"DT")
3031006
"^DD",130,130,500,0)
PFSS ACCOUNT REFERENCE^P375'^IBBAA(375,^PFSS;1^Q
"^DD",130,130,500,.1)
PFSS Account Reference
"^DD",130,130,500,3)
Enter the PFSS Account Reference associated with this case.
"^DD",130,130,500,8.5)
^
"^DD",130,130,500,9)
^
"^DD",130,130,500,21,0)
^^3^3^3050606^^
"^DD",130,130,500,21,1,0)
This is the PFSS Account Reference number by which Surgery will reference
"^DD",130,130,500,21,2,0)
an external account number for purposes of attaching charges for 1st or
"^DD",130,130,500,21,3,0)
3rd party billing.
"^DD",130,130,500,"DT")
3050608
"BLD",5296,6)
^148
**END**
**END**
