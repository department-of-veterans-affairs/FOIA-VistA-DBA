Released PSJ*5*154 SEQ #152
Extracted from mail message
**KIDS**:PSJ*5.0*154^

**INSTALL NAME**
PSJ*5.0*154
"BLD",5988,0)
PSJ*5.0*154^INPATIENT MEDICATIONS^0^3051213^y
"BLD",5988,1,0)
^^15^15^3050810^
"BLD",5988,1,1,0)
 1. PSI-05-051:  A priority status of ASAP is not easily seen by the 
"BLD",5988,1,2,0)
    finishing pharmacist.  A STAT order is displayed as blinking and 
"BLD",5988,1,3,0)
    highlighted, but a ASAP order does not have any special visual
"BLD",5988,1,4,0)
    effects.  
"BLD",5988,1,5,0)
 
"BLD",5988,1,6,0)
    In order to avoid adding more special visual effects to the screen 
"BLD",5988,1,7,0)
    this patch is designed to offer a Site Ward Parameter that will allow
"BLD",5988,1,8,0)
    the site a choice of what orders are sent to the STAT NOW MAIL GROUP.
"BLD",5988,1,9,0)
    The site can select STAT, ASAP, or NOW orders, or any combination of 
"BLD",5988,1,10,0)
    the three for notification via the STAT NOW MAIL GROUP functionality.
"BLD",5988,1,11,0)
 
"BLD",5988,1,12,0)
 2. Remedy Ticket #106018:  Stat IV orders are not highlighted and 
"BLD",5988,1,13,0)
    flashing like Stat Unit Dose orders.  This patch adds the code
"BLD",5988,1,14,0)
    required to make Stat IV orders highlighted and flash like Stat Unit
"BLD",5988,1,15,0)
    Dose orders.
"BLD",5988,4,0)
^9.64PA^59.6^1
"BLD",5988,4,59.6,0)
59.6
"BLD",5988,4,59.6,2,0)
^9.641^59.6^1
"BLD",5988,4,59.6,2,59.6,0)
INPATIENT WARD PARAMETERS  (File-top level)
"BLD",5988,4,59.6,2,59.6,1,0)
^9.6411^6^1
"BLD",5988,4,59.6,2,59.6,1,6,0)
PRIORITIES FOR NOTIFICATION
"BLD",5988,4,59.6,222)
y^y^p^^^^n^^n
"BLD",5988,4,59.6,224)

"BLD",5988,4,"APDD",59.6,59.6)

"BLD",5988,4,"APDD",59.6,59.6,6)

"BLD",5988,4,"B",59.6,59.6)

"BLD",5988,6)
4^
"BLD",5988,"KRN",0)
^9.67PA^8989.52^19
"BLD",5988,"KRN",.4,0)
.4
"BLD",5988,"KRN",.401,0)
.401
"BLD",5988,"KRN",.402,0)
.402
"BLD",5988,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",5988,"KRN",.402,"NM",1,0)
PSJ IWP EDIT    FILE #59.6^59.6^0
"BLD",5988,"KRN",.402,"NM","B","PSJ IWP EDIT    FILE #59.6",1)

"BLD",5988,"KRN",.403,0)
.403
"BLD",5988,"KRN",.403,"NM",0)
^9.68A^^
"BLD",5988,"KRN",.5,0)
.5
"BLD",5988,"KRN",.84,0)
.84
"BLD",5988,"KRN",3.6,0)
3.6
"BLD",5988,"KRN",3.8,0)
3.8
"BLD",5988,"KRN",9.2,0)
9.2
"BLD",5988,"KRN",9.8,0)
9.8
"BLD",5988,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",5988,"KRN",9.8,"NM",1,0)
PSJHL4^^0^B75218206
"BLD",5988,"KRN",9.8,"NM",2,0)
PSJLMPRI^^0^B18941536
"BLD",5988,"KRN",9.8,"NM",3,0)
PSGFILED^^0^B24370324
"BLD",5988,"KRN",9.8,"NM",4,0)
PSJHL4A^^0^B36548779
"BLD",5988,"KRN",9.8,"NM","B","PSGFILED",3)

"BLD",5988,"KRN",9.8,"NM","B","PSJHL4",1)

"BLD",5988,"KRN",9.8,"NM","B","PSJHL4A",4)

"BLD",5988,"KRN",9.8,"NM","B","PSJLMPRI",2)

"BLD",5988,"KRN",19,0)
19
"BLD",5988,"KRN",19.1,0)
19.1
"BLD",5988,"KRN",101,0)
101
"BLD",5988,"KRN",409.61,0)
409.61
"BLD",5988,"KRN",771,0)
771
"BLD",5988,"KRN",870,0)
870
"BLD",5988,"KRN",8989.51,0)
8989.51
"BLD",5988,"KRN",8989.52,0)
8989.52
"BLD",5988,"KRN",8994,0)
8994
"BLD",5988,"KRN","B",.4,.4)

"BLD",5988,"KRN","B",.401,.401)

"BLD",5988,"KRN","B",.402,.402)

"BLD",5988,"KRN","B",.403,.403)

"BLD",5988,"KRN","B",.5,.5)

"BLD",5988,"KRN","B",.84,.84)

"BLD",5988,"KRN","B",3.6,3.6)

"BLD",5988,"KRN","B",3.8,3.8)

"BLD",5988,"KRN","B",9.2,9.2)

"BLD",5988,"KRN","B",9.8,9.8)

"BLD",5988,"KRN","B",19,19)

"BLD",5988,"KRN","B",19.1,19.1)

"BLD",5988,"KRN","B",101,101)

"BLD",5988,"KRN","B",409.61,409.61)

"BLD",5988,"KRN","B",771,771)

"BLD",5988,"KRN","B",870,870)

"BLD",5988,"KRN","B",8989.51,8989.51)

"BLD",5988,"KRN","B",8989.52,8989.52)

"BLD",5988,"KRN","B",8994,8994)

"BLD",5988,"QUES",0)
^9.62^^
"BLD",5988,"REQB",0)
^9.611^3^3
"BLD",5988,"REQB",1,0)
PSJ*5.0*112^2
"BLD",5988,"REQB",2,0)
PSJ*5.0*133^2
"BLD",5988,"REQB",3,0)
PSS*1.0*103^2
"BLD",5988,"REQB","B","PSJ*5.0*112",1)

"BLD",5988,"REQB","B","PSJ*5.0*133",2)

"BLD",5988,"REQB","B","PSS*1.0*103",3)

"FIA",59.6)
INPATIENT WARD PARAMETERS
"FIA",59.6,0)
^PS(59.6,
"FIA",59.6,0,0)
59.6P
"FIA",59.6,0,1)
y^y^p^^^^n^^n
"FIA",59.6,0,10)

"FIA",59.6,0,11)

"FIA",59.6,0,"RLRO")

"FIA",59.6,0,"VR")
5.0^PSJ
"FIA",59.6,59.6)
1
"FIA",59.6,59.6,6)

"KRN",.402,1792,-1)
0^1
"KRN",.402,1792,0)
PSJ IWP EDIT^3050727.1635^ ^59.6^^^3051213
"KRN",.402,1792,"%D",0)
^.4021^3^3^3040617^^^^
"KRN",.402,1792,"%D",1,0)
  Used by the Inpatient Medications package t allow the Inpatient
"KRN",.402,1792,"%D",2,0)
Supervisor to tailor various aspects of the package on a ward-by-ward
"KRN",.402,1792,"%D",3,0)
basis.
"KRN",.402,1792,"DR",1,59.6)
.03;S X="";3;.04;.07;.05;.08;.12;.19;.16;.2;.15;.18;.11;1;2;.24;4;5;6;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",221,-1)
1^1
"PKG",221,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",221,20,0)
^9.402P^^
"PKG",221,22,0)
^9.49I^1^1
"PKG",221,22,1,0)
5.0^2971215^2981113^1
"PKG",221,22,1,"PAH",1,0)
154^3051213^520645566
"PKG",221,22,1,"PAH",1,1,0)
^^15^15^3051213
"PKG",221,22,1,"PAH",1,1,1,0)
 1. PSI-05-051:  A priority status of ASAP is not easily seen by the 
"PKG",221,22,1,"PAH",1,1,2,0)
    finishing pharmacist.  A STAT order is displayed as blinking and 
"PKG",221,22,1,"PAH",1,1,3,0)
    highlighted, but a ASAP order does not have any special visual
"PKG",221,22,1,"PAH",1,1,4,0)
    effects.  
"PKG",221,22,1,"PAH",1,1,5,0)
 
"PKG",221,22,1,"PAH",1,1,6,0)
    In order to avoid adding more special visual effects to the screen 
"PKG",221,22,1,"PAH",1,1,7,0)
    this patch is designed to offer a Site Ward Parameter that will allow
"PKG",221,22,1,"PAH",1,1,8,0)
    the site a choice of what orders are sent to the STAT NOW MAIL GROUP.
"PKG",221,22,1,"PAH",1,1,9,0)
    The site can select STAT, ASAP, or NOW orders, or any combination of 
"PKG",221,22,1,"PAH",1,1,10,0)
    the three for notification via the STAT NOW MAIL GROUP functionality.
"PKG",221,22,1,"PAH",1,1,11,0)
 
"PKG",221,22,1,"PAH",1,1,12,0)
 2. Remedy Ticket #106018:  Stat IV orders are not highlighted and 
"PKG",221,22,1,"PAH",1,1,13,0)
    flashing like Stat Unit Dose orders.  This patch adds the code
"PKG",221,22,1,"PAH",1,1,14,0)
    required to make Stat IV orders highlighted and flash like Stat Unit
"PKG",221,22,1,"PAH",1,1,15,0)
    Dose orders.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","PSGFILED")
0^3^B24370324^B24308978
"RTN","PSGFILED",1,0)
PSGFILED ;BIR/CML3-VARIOUS FILES' UPKEEP ;16 Mar 99 / 10:22 AM
"RTN","PSGFILED",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,50,63,119,110,111,112,154**;16 DEC 97
"RTN","PSGFILED",3,0)
 ;
"RTN","PSGFILED",4,0)
 ; Reference to ^PS(50.606 supported by DBIA# 2174.
"RTN","PSGFILED",5,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192.
"RTN","PSGFILED",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSGFILED",7,0)
 ; Reference to ^PS(51 is supported by DBIA# 2176.
"RTN","PSGFILED",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSGFILED",9,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGFILED",10,0)
 ;
"RTN","PSGFILED",11,0)
DONE D ENKV^PSGSETU K D0,D1,D2,PSGRBS Q
"RTN","PSGFILED",12,0)
 ;
"RTN","PSGFILED",13,0)
GED ; generic edit
"RTN","PSGFILED",14,0)
 S DA=+Y,DR=".01;1" W ! D ^DIE Q
"RTN","PSGFILED",15,0)
 ;
"RTN","PSGFILED",16,0)
ENAT ; team file
"RTN","PSGFILED",17,0)
 F  S DIC="^PS(57.7,",DIC(0)="QEAMIL",DLAYGO=57.7,DIC("A")="Select WARD: " W ! D ^DIC K DIC,DLAYGO Q:Y'>0  S DA=+Y,DIE="^PS(57.7,",DR="[PSJUMATE]" D ^DIE
"RTN","PSGFILED",18,0)
 G DONE
"RTN","PSGFILED",19,0)
 ;
"RTN","PSGFILED",20,0)
ENAS ; schedules file - no longer used
"RTN","PSGFILED",21,0)
 ;
"RTN","PSGFILED",22,0)
ENMR ; med route file
"RTN","PSGFILED",23,0)
 NEW MRNO,MR K DIE,DIC,DR,Y
"RTN","PSGFILED",24,0)
 F  S DIC="^PS(51.2,",DIC(0)="QEAMIL",DLAYGO=51.2 W ! D ^DIC K DIC,DLAYGO Q:+Y'>0  S MRNO=+Y,MR=$P(Y,U,2),DA=+Y,DIE="^PS(51.2,",DR=".01;1;3;4" D ^DIE D DF
"RTN","PSGFILED",25,0)
 G DONE
"RTN","PSGFILED",26,0)
 ;
"RTN","PSGFILED",27,0)
ENWG ; ward group file
"RTN","PSGFILED",28,0)
 F  S DIC="^PS(57.5,",DIC(0)="QEAMIL",DLAYGO=57.5 W ! D ^DIC K DA,DIC,DR Q:+Y'>0  S DA=+Y,DIE="^PS(57.5,",DR="[PSJU WG]" D ^DIE
"RTN","PSGFILED",29,0)
 G DONE
"RTN","PSGFILED",30,0)
 ;
"RTN","PSGFILED",31,0)
ENMI ; medication instruction file
"RTN","PSGFILED",32,0)
 F  S DIC="^PS(51,",DIC(0)="QEAMIL",DLAYGO=51 W ! D ^DIC K DIC Q:+Y'>0  S DIE="^PS(51,",DA=+Y,DR=".01;1;30" D ^DIE
"RTN","PSGFILED",33,0)
 G DONE
"RTN","PSGFILED",34,0)
 ;
"RTN","PSGFILED",35,0)
ENDRG ; standard drug fields
"RTN","PSGFILED",36,0)
 D NOW^%DTC S PSGDT=% F  S DIC="^PSDRUG(",DIC(0)="AEIMOQ",DIC("A")="Select DISPENSE DRUG: " W ! D ^DIC K DIC Q:+Y'>0  D DE
"RTN","PSGFILED",37,0)
 K PSIUA,PSIUDA,PSIUX G DONE
"RTN","PSGFILED",38,0)
 ;
"RTN","PSGFILED",39,0)
DE ;
"RTN","PSGFILED",40,0)
 I $D(^PSDRUG(+Y,"I")),^("I"),^("I")<PSGDT W $C(7),$C(7),!!?3,"*** WARNING, THIS DRUG IS INACTIVE. ***",!
"RTN","PSGFILED",41,0)
 W ! S DIE="^PSDRUG(",(DA,PSIUDA)=+Y,DR="[PSJ FILED]"
"RTN","PSGFILED",42,0)
 S PSIUX="U^UNIT DOSE PHARMACY^1" D ^PSGIU,^DIE:PSIUA'["^" K DA,DIE,DR Q
"RTN","PSGFILED",43,0)
 ;
"RTN","PSGFILED",44,0)
ENOSE ; order set enter/edit
"RTN","PSGFILED",45,0)
 K DIC F  S DLAYGO=53.2,DIC="^PS(53.2,",DIC(0)="QEAML",DIC("A")="Select ORDER SET: " W ! D ^DIC K DIC Q:Y'>0  S DA=+Y S DIE="^PS(53.2,",DR="[PSJUOSE]" D ^DIE K D0,D1,DA,DIE,DR,PSGNEDFD,PSGS0XT,PSGS0Y
"RTN","PSGFILED",46,0)
 G DONE
"RTN","PSGFILED",47,0)
 ;
"RTN","PSGFILED",48,0)
RBCHK ; used to validate room-bed
"RTN","PSGFILED",49,0)
 ;No longer used.
"RTN","PSGFILED",50,0)
 ;F Z0=0:0 S Z0=$O(^PS(57.7,DA(2),1,Z0)) Q:'Z0  I Z0'=DA(1),$D(^(Z0,1,"B",X)) W !?19,X," is already under ",$S('$D(^PS(57.7,DA(2),1,Z0,0)):"another team ("_Z0_")!",$P(^(0),"^")]"":$P(^(0),"^")_"!",1:"another team ("_Z0_")!") Q
"RTN","PSGFILED",51,0)
 ;I 'Z0,$D(^DIC(42,DA(2),2,+$O(^DIC(42,DA(2),2,"B",$P(X,"-"),0)),1,"B",$P(X,"-",2))) K Z0 Q
"RTN","PSGFILED",52,0)
 ;K X,Z0 Q
"RTN","PSGFILED",53,0)
 ;
"RTN","PSGFILED",54,0)
RBQ ; show room-beds for a ward
"RTN","PSGFILED",55,0)
 ;No longer used.
"RTN","PSGFILED",56,0)
 Q
"RTN","PSGFILED",57,0)
 ;
"RTN","PSGFILED",58,0)
RBNP W """^"" TO STOP: " R Z3:DTIME W:'$T $C(7) S:'$T Z3="^" W $C(13),"            ",$C(13) Q
"RTN","PSGFILED",59,0)
 ;
"RTN","PSGFILED",60,0)
ENPPD ; edit pharmacy patient data
"RTN","PSGFILED",61,0)
 ; W !!?3,"...This option is still under development...",! Q
"RTN","PSGFILED",62,0)
 ;
"RTN","PSGFILED",63,0)
ENCPDD ; edit patient's default stop date (wall)
"RTN","PSGFILED",64,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGFILED",65,0)
 F  D ENAO^PSGGAO Q:PSGP'>0  D
"RTN","PSGFILED",66,0)
 .S WDN=$P($G(^DPT(PSGP,.1)),"^") W:WDN="" !!?2,"The patient is not currently on a ward."
"RTN","PSGFILED",67,0)
 .I WDN]"" S WD=$O(^DIC(42,"B",WDN,0)),WD=$O(^PS(59.6,"B",+WD,0)) I $S('WD:1,1:'$P($G(^PS(59.6,WD,0)),"^",4)) S X="PLEASE NOTE: The 'SAME STOP DATE' parameter for the ward ("_WDN_") is not turned on.  Any date entered here will be ignored "
"RTN","PSGFILED",68,0)
 .I  S X=X_"until the parameter is turned on for this ward." W $C(7),!!?2 F Y=1:1:$L(X," ") S X(1)=$P(X," ",Y) W:$L(X(1))+$X>78 ! W X(1)," "
"RTN","PSGFILED",69,0)
 .S DA=PSGP,DR="62.01T",DIE="^PS(55," W !! D ^DIE
"RTN","PSGFILED",70,0)
 K WD,WDN G DONE
"RTN","PSGFILED",71,0)
 ;
"RTN","PSGFILED",72,0)
ENSYS ; edit system file
"RTN","PSGFILED",73,0)
 ;/S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;20.412ALLOW THE CHANGE OF ORDER TYPES ON ORDERS FROM OERR;32"
"RTN","PSGFILED",74,0)
 S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;26.5;26.6;26.7;34;27;27.1"
"RTN","PSGFILED",75,0)
 W ! D ^DIE K DIE,DA,DR Q
"RTN","PSGFILED",76,0)
 ;
"RTN","PSGFILED",77,0)
ENPLSP ; edit pick list site parameters
"RTN","PSGFILED",78,0)
 ;
"RTN","PSGFILED",79,0)
ENCS ; change current site & parameters
"RTN","PSGFILED",80,0)
 I $D(PSJSYSW0)#2 W !!,"Current site: ",$P(PSJSYSW0,"^")
"RTN","PSGFILED",81,0)
 S PSGCSF=1 D ^PSGSET,ENKV^PSGSETU W:$D(XQUIT) !!?5,"(The Inpatient site you are currently working under has not changed.)" K PSGCSF,PSGORSET,XQUIT Q
"RTN","PSGFILED",82,0)
 ;
"RTN","PSGFILED",83,0)
DF ; Add/edit Med route, instruction... to the Dosage form file.
"RTN","PSGFILED",84,0)
 S DIR("A")="Would you like to update the Dosage Form file"
"RTN","PSGFILED",85,0)
 S DIR("?")="If your answer is Yes, you will be able to Add/edit the Med routes, Instructions, Verb, Noun and Preposition that associate with this Dosage form."
"RTN","PSGFILED",86,0)
 S DIR(0)="Y",DIR("B")="Y" D ^DIR Q:Y'=1
"RTN","PSGFILED",87,0)
 NEW Y,DFNO K DIE,DIC,DA,DR
"RTN","PSGFILED",88,0)
 F  S DIC="^PS(50.606,",DIC(0)="QEAMI" D ^DIC Q:+Y'>0  S DFNO=+Y D
"RTN","PSGFILED",89,0)
 . I $G(MR)]"",'$D(^PS(50.606,DFNO,"MR","B",MRNO)) S DIE="^PS(50.606,",DR="1///"_MR,DA=DFNO D ^DIE
"RTN","PSGFILED",90,0)
 . K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",91,0)
 ;. K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;2;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",92,0)
 Q
"RTN","PSGFILED",93,0)
ENCD ;edit Clinic Definitions file
"RTN","PSGFILED",94,0)
 F  K DIC S DIC="^PS(53.46,",DIC(0)="AELMQ",DIC("A")="Select CLINIC: ",DLAYGO=53.46 D ^DIC K DIC Q:Y<0  D
"RTN","PSGFILED",95,0)
 . S DIE="^PS(53.46,",DA=+Y,DR="1;2;3" D ^DIE K DIE,DA,DR Q
"RTN","PSGFILED",96,0)
ENCG ; ward group file0
"RTN","PSGFILED",97,0)
 F  S DIC="^PS(57.8,",DIC(0)="QEAMIL",DLAYGO=57.8 W ! D ^DIC K DA,DIC,DR Q:+Y'>0  S DA=+Y,DIE="^PS(57.8,",DR=".01;1" D ^DIE
"RTN","PSGFILED",98,0)
 G DONE
"RTN","PSGFILED",99,0)
 ;
"RTN","PSJHL4")
0^1^B75218206^B64911264
"RTN","PSJHL4",1,0)
PSJHL4 ;BIR/RLW-DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,12,27,34,40,42,55,47,50,56,58,98,85,105,107,110,111,154**;16 DEC 97
"RTN","PSJHL4",3,0)
 ;
"RTN","PSJHL4",4,0)
 ; Reference to $$EN^PSOHLNEW is supported by DBIA# 2188.
"RTN","PSJHL4",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL4",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL4",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL4",8,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSJHL4",9,0)
 ;
"RTN","PSJHL4",10,0)
EN(PSJMSG) ; start here
"RTN","PSJHL4",11,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",12,0)
 N ADCNT,SOLCNT,OCCNT
"RTN","PSJHL4",13,0)
 N ACKDATE,ADDITIVE,ADMINSTR,APPL,COMMENT,PSJHLDFN,DISPENSE,DOSE,DURATION,II,INSTR,J,JJ,JJJ,K,LOGIN,NEWORDER,NURSEACK,OBXFL,OCNARR,OCPROV,OCRSN,ORDER,PRIORITY,PSITEM,ORDCON,PROCOM,PSJORDER,PSREASON
"RTN","PSJHL4",14,0)
 N LOC,PROVIDER,PSPR,PSOC,PTR,QQ,REQST,ROUTE,RXON,RXORDER,SCHEDULE,SEGMENT,SOLUTION,STPDT,STRENGTH,TEXT,CLERK,INFRT,IVTYP,SCHTYP,PREON,NOO,ROC,FREQ,CLASS,PSJHLMTN,UNIT,UNITS,QFLG,VOLUME,TVOLUME,PSGP
"RTN","PSJHL4",15,0)
 N PSJASTP,FLDATE,FLCMNT,PSJFLAG,PSJYN,PRNTON,APPT,IVLIMIT
"RTN","PSJHL4",16,0)
 S (ADCNT,SOLCNT,OCCNT,II,TVOLUME)="",(OBXFL,QFLG)=0,PSJHLMTN="ORR" F  S II=$O(PSJMSG(II)) Q:'II  D DECODE Q:QFLG  D @FIELD(0) Q:$G(CLASS)="O"  Q:QFLG
"RTN","PSJHL4",17,0)
 I ($G(CLASS)'="I")!(QFLG) G END
"RTN","PSJHL4",18,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") N DIK,DA S DIK="^PS(53.1,",DA=NEWORDER D EN1^DIK L -^PS(53.1,NEWORDER)
"RTN","PSJHL4",19,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") D EN1^PSJHL2(PSJHLDFN,$S(PSOC="NW":"OK",1:"XR"),NEWORDER_"P")
"RTN","PSJHL4",20,0)
END ;
"RTN","PSJHL4",21,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",22,0)
 I (",S,A,")[(","_$G(PRIORITY)_",")!($G(SCHEDULE)="NOW")!($G(SCHEDULE)["STAT") D
"RTN","PSJHL4",23,0)
 . I $G(PRIORITY)="ZD",$G(PSGORD) D NOTIFY(PSGORD_$S(PSGORD["V":"V",PSGORD["U":"U",1:""),PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",24,0)
 . I $G(NEWORDER) D NOTIFY(NEWORDER_"P",PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",25,0)
 Q
"RTN","PSJHL4",26,0)
 ;
"RTN","PSJHL4",27,0)
DECODE ;break segment down into fields 
"RTN","PSJHL4",28,0)
 K FIELD
"RTN","PSJHL4",29,0)
 S SEGMENT=$G(PSJMSG(II))
"RTN","PSJHL4",30,0)
 S J=0
"RTN","PSJHL4",31,0)
 F  Q:$G(SEGMENT)=""  D
"RTN","PSJHL4",32,0)
 .;get fields from segment
"RTN","PSJHL4",33,0)
 .I SEGMENT["|" S FIELD(J)=$P(SEGMENT,"|"),SEGMENT=$E(SEGMENT,$L(FIELD(J))+2,$L(SEGMENT)),J=J+1 Q
"RTN","PSJHL4",34,0)
 .I SEGMENT'["|" S FIELD(J)=SEGMENT,SEGMENT="" Q
"RTN","PSJHL4",35,0)
 Q
"RTN","PSJHL4",36,0)
 ;
"RTN","PSJHL4",37,0)
NOTIFY(ORDER,PSJHLDFN,PRIO,PSJSCHED) ;
"RTN","PSJHL4",38,0)
 N NTFYREAS,WARD,MGROUP,NTFSTAT,DRUG,DRIEN,PNAME,ORDATE,DO,PSG,XMY,VADPT,LASTFOUR,PSJSOK
"RTN","PSJHL4",39,0)
 Q:($G(PRIO)=""&($G(PSJSCHED)=""))
"RTN","PSJHL4",40,0)
 S DFN=PSJHLDFN D DEM^VADPT S LASTFOUR=$P($P(VADM(2),"^",2),"-",3)
"RTN","PSJHL4",41,0)
 S NTFYREAS=$S((",S,A,")[(","_PRIO_","):1,($G(PSJSCHED)="NOW"):2,($G(PSJSCHED)="STAT"):3,1:0) Q:'NTFYREAS
"RTN","PSJHL4",42,0)
 S PSJSOK=1
"RTN","PSJHL4",43,0)
 I ORDER["P" D PND
"RTN","PSJHL4",44,0)
 I ORDER["U" D UD
"RTN","PSJHL4",45,0)
 I ORDER["V" D IV
"RTN","PSJHL4",46,0)
 Q:PSJSOK=1
"RTN","PSJHL4",47,0)
 S PNAME=$P($G(^DPT(+PSJHLDFN,0)),"^") S:$G(RTE) RTE=$P(^PS(51.2,+RTE,0),"^",3)
"RTN","PSJHL4",48,0)
 S DRUG=$S(DRIEN:$P($G(^PS(50.7,+DRIEN,0)),"^"),1:""),WARD=$G(^DPT(PSJHLDFN,.1))
"RTN","PSJHL4",49,0)
 S XMDUZ="MEDICATIONS,INPATIENT",XMSUB=$G(WARD)
"RTN","PSJHL4",50,0)
 S XMSUB=XMSUB_"-"_NTFSTAT_" "_$S($G(PRIO)="A":"ASAP",$G(PRIO)="S":"STAT",$G(NTFYREAS)=2:"NOW",$G(NTFYREAS)=3:"STAT",1:"")_"-"
"RTN","PSJHL4",51,0)
 S XMSUB=XMSUB_$E(PNAME,1,65-$L(XMSUB))
"RTN","PSJHL4",52,0)
 S XMTEXT="PSG("
"RTN","PSJHL4",53,0)
 S PSG(1,0)="Inpatient Medications has received the following "_$S($G(PRIO)="A":"ASAP",$G(PRIO)="S":"STAT",$G(NTFYREAS)=2:"NOW",1:"")_" order ("_NTFSTAT_")"
"RTN","PSJHL4",54,0)
 S PSG(2,0)=""
"RTN","PSJHL4",55,0)
 S PSG(3,0)="          Patient:     "_PNAME I $G(LASTFOUR) S PSG(3,0)=PSG(3,0)_"  ("_LASTFOUR_")"
"RTN","PSJHL4",56,0)
 S PSG(4,0)="Order Information:     "_DRUG_" "_DO_" "_RTE_" "_$G(PSJSCHED)
"RTN","PSJHL4",57,0)
 S PSG(5,0)="       Order Date:     "_$$ENDTC^PSGMI(ORDATE)
"RTN","PSJHL4",58,0)
 D ^XMD
"RTN","PSJHL4",59,0)
 Q
"RTN","PSJHL4",60,0)
 ;
"RTN","PSJHL4",61,0)
PND ;
"RTN","PSJHL4",62,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",63,0)
 Q:'$D(^PS(53.1,+ORDER,0))
"RTN","PSJHL4",64,0)
 S WARD=$G(^DPT(PSJHLDFN,.1)) I WARD]"" D
"RTN","PSJHL4",65,0)
 .N DIC,X,Y S DIC="^DIC(42,",DIC(0)="BOXZ",X=WARD D ^DIC S WARD=+Y Q:WARD=0
"RTN","PSJHL4",66,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",67,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",68,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",69,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",70,0)
 S:'$$SNDTSTP^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW PENDING ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",71,0)
 S NTFSTAT="PENDING"
"RTN","PSJHL4",72,0)
 N NDP2,ND0 S NDP2=$G(^PS(53.1,+ORDER,.2)),ND0=$G(^PS(53.1,+ORDER,0))
"RTN","PSJHL4",73,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",74,0)
 S SCHED=$P($G(^PS(53.1,+ORDER,2)),"^")
"RTN","PSJHL4",75,0)
 Q
"RTN","PSJHL4",76,0)
 ;
"RTN","PSJHL4",77,0)
UD ;
"RTN","PSJHL4",78,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",79,0)
 Q:'$D(^PS(55,PSJHLDFN,5,+ORDER,0))
"RTN","PSJHL4",80,0)
 S WARD=$P($G(^PS(55,PSJHLDFN,5,+ORDER,0)),"^",23) I +WARD D
"RTN","PSJHL4",81,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",82,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",83,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",84,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",85,0)
 S:'$$SNDTSTA^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW ACTIVE ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",86,0)
 S NTFSTAT="ACTIVE"
"RTN","PSJHL4",87,0)
 N ND2,ND0 S ND0=$G(^PS(55,PSJHLDFN,5,+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,5,+ORDER,2)),NDP2=$G(^PS(55,PSJHLDFN,5,+ORDER,.2))
"RTN","PSJHL4",88,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",89,0)
 S SCHED=$P(ND2,"^")
"RTN","PSJHL4",90,0)
 Q
"RTN","PSJHL4",91,0)
 ;
"RTN","PSJHL4",92,0)
IV ;
"RTN","PSJHL4",93,0)
 N WARD,WDPARM,MGRP
"RTN","PSJHL4",94,0)
 Q:'$D(^PS(55,PSJHLDFN,"IV",+ORDER,0))
"RTN","PSJHL4",95,0)
 S WARD=$P($G(^PS(55,PSJHLDFN,"IV",+ORDER,0)),"^",22) I +WARD D
"RTN","PSJHL4",96,0)
 .S WARD=$O(^PS(59.6,"B",WARD,0)) Q:+WARD=0
"RTN","PSJHL4",97,0)
 .Q:$$SNDTSTW^PSJHL4A(PRIO,PSJSCHED,WARD)
"RTN","PSJHL4",98,0)
 .S WDPARM=$G(^PS(59.6,+WARD,0)),MGRP=$P(WDPARM,"^",30) Q:+MGRP=0
"RTN","PSJHL4",99,0)
 .S MGRP=$$GET1^DIQ(3.8,MGRP,.01) I MGRP]"" S XMY("G."_MGRP_"@"_$G(^XMB("NETNAME")))="",PSJSOK=0
"RTN","PSJHL4",100,0)
 S:'$$SNDTSTA^PSJHL4A(PRIO,PSJSCHED) MGROUP="G.PSJ STAT NOW ACTIVE ORDER@"_$G(^XMB("NETNAME")),XMY(MGROUP)="",PSJSOK=0
"RTN","PSJHL4",101,0)
 S NTFSTAT="ACTIVE"
"RTN","PSJHL4",102,0)
 N ND2,NDP2,ND0 S ND0=$G(^PS(55,PSJHLDFN,"IV",+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,2))
"RTN","PSJHL4",103,0)
 S NDP2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,.2))
"RTN","PSJHL4",104,0)
 S DRIEN=$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(NDP2,"^",3)
"RTN","PSJHL4",105,0)
 S ORDATE=$P(ND2,"^"),SCHED=$P(ND0,"^",9)
"RTN","PSJHL4",106,0)
 Q
"RTN","PSJHL4",107,0)
 ;
"RTN","PSJHL4",108,0)
MSH ;
"RTN","PSJHL4",109,0)
 S PSOC=FIELD(8)
"RTN","PSJHL4",110,0)
 Q
"RTN","PSJHL4",111,0)
 ;
"RTN","PSJHL4",112,0)
PID ;
"RTN","PSJHL4",113,0)
 S PSJHLDFN=FIELD(3)
"RTN","PSJHL4",114,0)
 Q
"RTN","PSJHL4",115,0)
 ;
"RTN","PSJHL4",116,0)
PV1 ;
"RTN","PSJHL4",117,0)
 N A
"RTN","PSJHL4",118,0)
 S CLASS=FIELD(2),LOC=$P(FIELD(3),"^"),APPT="" I $G(FIELD(44))]"" S APPT=+$$HL7TFM^XLFDT(FIELD(44))
"RTN","PSJHL4",119,0)
 I "IO"'[CLASS S PSREASON="Invalid patient class" Q
"RTN","PSJHL4",120,0)
 ;N II K PSJNVA S II="" F  S II=$O(PSJMSG(II)) Q:'II  D  Q:CLASS="O"
"RTN","PSJHL4",121,0)
 N QQ K PSJNVA S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  D  Q:$G(PSJNVA)
"RTN","PSJHL4",122,0)
 .S X=$G(PSJMSG(QQ))
"RTN","PSJHL4",123,0)
 .I $P(X,"|")="ZRN" S PSJNVA=1,CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",124,0)
 .;I $P(X,"|")="ZRN" S PSJNVA=1 D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",125,0)
 ; OBR check - enable outpatient flagging from backdoor
"RTN","PSJHL4",126,0)
 I $G(PSJNVA) K PSJNVA Q
"RTN","PSJHL4",127,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="OBR" D  Q:$P(PSJMSG(QQ),"|")="OBR"
"RTN","PSJHL4",128,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",129,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="ORC" D  Q:$P(PSJMSG(QQ),"|")="ORC"
"RTN","PSJHL4",130,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",131,0)
 I CLASS="O" N CHK,QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="RXO" D  Q:$P(PSJMSG(QQ),"|")="RXO"
"RTN","PSJHL4",132,0)
 .S CHK=$P(PSJMSG(QQ),"|",2),CHK=$S($P(CHK,"^",5)="IV":"IV",1:$P(CHK,"^",4))
"RTN","PSJHL4",133,0)
 .I CHK="IV" S CLASS="I" Q
"RTN","PSJHL4",134,0)
 .I 'CHK S PSREASON="Missing or Invalid Orderable Item",CLASS="I" Q
"RTN","PSJHL4",135,0)
 .I $P($G(^PS(50.7,CHK,0)),"^",3)=1 S CLASS="I" Q
"RTN","PSJHL4",136,0)
 D:CLASS="O" EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",137,0)
 Q
"RTN","PSJHL4",138,0)
 ;
"RTN","PSJHL4",139,0)
ORC ;
"RTN","PSJHL4",140,0)
 S PSOC=FIELD(1)
"RTN","PSJHL4",141,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",142,0)
 I $G(PSREASON)]"" D ERROR^PSJHL9 Q
"RTN","PSJHL4",143,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",144,0)
 I PSOC="NA" D ASSIGN^PSJHL5 Q
"RTN","PSJHL4",145,0)
 S CLERK=+$G(FIELD(10))
"RTN","PSJHL4",146,0)
 S PROVIDER=+$G(FIELD(12)) D:PSOC="NW"
"RTN","PSJHL4",147,0)
 .I PROVIDER=0 S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q 
"RTN","PSJHL4",148,0)
 .I PROVIDER>0 S PSPR=$G(^VA(200,+PROVIDER,"PS")) I '$D(PSPR)!'(PSPR)!$S($P(PSPR,"^",4)="":0,1:$P(PSPR,"^",4)'>DT) S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q
"RTN","PSJHL4",149,0)
 S UNITS=$P(FIELD(7),"^"),INSTR=$P(FIELD(7),"^",8)
"RTN","PSJHL4",150,0)
 S:UNITS["&" DOSE=$P(UNITS,"&"),UNIT=$P(UNITS,"&",2),UNITS=$P(UNITS,"&",3)
"RTN","PSJHL4",151,0)
 S SCHEDULE=$P(FIELD(7),"^",2),PRIORITY=$P(FIELD(7),"^",6) S:SCHEDULE["PRN" SCHTYP="P"
"RTN","PSJHL4",152,0)
 S DURATION=$P(FIELD(7),"^",3),REQST=$P(FIELD(7),"^",4) S:REQST'="" REQST=+$E(+$$HL7TFM^XLFDT(REQST),1,12) S REQST=$$DATE2^PSJUTL2(REQST)
"RTN","PSJHL4",153,0)
 S PRIORITY=$S($G(PRIORITY)]"":PRIORITY,1:"R")
"RTN","PSJHL4",154,0)
 I $E(SCHEDULE,1)=" " S:$TR(SCHEDULE," ")="PRN" SCHEDULE="PRN" I '(SCHEDULE="PRN")  S PSREASON="Invalid Schedule" D ERROR^PSJHL9 Q
"RTN","PSJHL4",155,0)
 S PRNTON=$P(FIELD(8),"^")
"RTN","PSJHL4",156,0)
 S NURSEACK=$G(FIELD(11))
"RTN","PSJHL4",157,0)
 S LOGIN=$G(FIELD(15)) S:LOGIN'="" LOGIN=+$E(+$$HL7TFM^XLFDT(FIELD(15)),1,12) S LOGIN=$$DATE2^PSJUTL2(LOGIN)
"RTN","PSJHL4",158,0)
 S:$G(NURSEACK)]"" ACKDATE=LOGIN
"RTN","PSJHL4",159,0)
 S ORDCON=$P($G(FIELD(16)),U) I ORDCON="A" S PSJASTP=$G(FIELD(9)) S:$G(PSJASTP)'="" PSJASTP=+$E(+$$HL7TFM^XLFDT(PSJASTP),1,12) S PSJASTP=$$DATE2^PSJUTL2(PSJASTP)
"RTN","PSJHL4",160,0)
 I (PSOC="CA")!(PSOC="DC") D CANCEL^PSJHL6 Q
"RTN","PSJHL4",161,0)
 I PSOC="HD" D HOLD^PSJHL6 Q
"RTN","PSJHL4",162,0)
 I PSOC="RL" D UNHOLD^PSJHL6 Q
"RTN","PSJHL4",163,0)
 I PSOC="ZV" D NURSEACK^PSJHL5 Q
"RTN","PSJHL4",164,0)
 I PSOC="SS" D STATUS^PSJHL5 Q
"RTN","PSJHL4",165,0)
 I PSOC="Z@" N X S X="PSJHL8" X ^%ZOSF("TEST") I  D PURGE^PSJHL8 Q
"RTN","PSJHL4",166,0)
 I PSOC="DE" S QFLG=1 Q
"RTN","PSJHL4",167,0)
 Q
"RTN","PSJHL4",168,0)
OBR ; This segment is used to pass flagging information from CPRS.
"RTN","PSJHL4",169,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",170,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",171,0)
 S PSJFLAG=FIELD(4)
"RTN","PSJHL4",172,0)
 S FLDATE=$G(FIELD(7)) S:FLDATE'="" FLDATE=+$E(+$$HL7TFM^XLFDT(FIELD(7)),1,12) S FLDATE=$$DATE2^PSJUTL2(FLDATE)
"RTN","PSJHL4",173,0)
 S CLERK=+$G(FIELD(16))
"RTN","PSJHL4",174,0)
 S PSJYN=$G(FIELD(24))
"RTN","PSJHL4",175,0)
 S FLCMNT=$G(FIELD(13))
"RTN","PSJHL4",176,0)
 I PSOC="ORU" D FLAG^PSJHL5
"RTN","PSJHL4",177,0)
 Q
"RTN","PSJHL4",178,0)
RXC ; IV order
"RTN","PSJHL4",179,0)
 D RXC^PSJHL4A
"RTN","PSJHL4",180,0)
 Q
"RTN","PSJHL4",181,0)
 ;
"RTN","PSJHL4",182,0)
RXO ;
"RTN","PSJHL4",183,0)
 D RXO^PSJHL4A
"RTN","PSJHL4",184,0)
 Q
"RTN","PSJHL4",185,0)
 ;
"RTN","PSJHL4",186,0)
RXR ;
"RTN","PSJHL4",187,0)
 S ROUTE=$P(FIELD(1),"^",4)
"RTN","PSJHL4",188,0)
 Q
"RTN","PSJHL4",189,0)
 ;
"RTN","PSJHL4",190,0)
OBX ;
"RTN","PSJHL4",191,0)
 D OBX^PSJHL4A
"RTN","PSJHL4",192,0)
 Q
"RTN","PSJHL4",193,0)
 ;
"RTN","PSJHL4",194,0)
NTE ;
"RTN","PSJHL4",195,0)
 D NTE^PSJHL4A
"RTN","PSJHL4",196,0)
 Q
"RTN","PSJHL4",197,0)
 ;
"RTN","PSJHL4",198,0)
ZRX ;
"RTN","PSJHL4",199,0)
 D ZRX^PSJHL4A
"RTN","PSJHL4",200,0)
 Q
"RTN","PSJHL4",201,0)
 ;
"RTN","PSJHL4",202,0)
ZSC ;Service Connected - Not Used by Inpatient
"RTN","PSJHL4",203,0)
 Q
"RTN","PSJHL4",204,0)
 ;
"RTN","PSJHL4",205,0)
ZRN ;Non-VA Med (Herbal/OTC)
"RTN","PSJHL4",206,0)
 S CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",207,0)
 Q
"RTN","PSJHL4",208,0)
DG1 ;Billing Awareness - Not used by Inpatient
"RTN","PSJHL4",209,0)
 Q
"RTN","PSJHL4A")
0^4^B36548779^B30067390
"RTN","PSJHL4A",1,0)
PSJHL4A ;BIR/RLW-CONTINUE DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4A",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**105,111,154**;16 DEC 97
"RTN","PSJHL4A",3,0)
 ;
"RTN","PSJHL4A",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL4A",5,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL4A",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL4A",7,0)
 ; Reference to ^PS(59.7 supported by DBIA #2181.
"RTN","PSJHL4A",8,0)
 ;
"RTN","PSJHL4A",9,0)
RXC ; IV order
"RTN","PSJHL4A",10,0)
 S APPL=FIELD(1)
"RTN","PSJHL4A",11,0)
 I APPL["B" S SOLCNT=SOLCNT+1,PTR=$P(FIELD(2),"^",4) Q:'PTR  S VOLUME=+FIELD(3)_" ML" D  I '$D(^TMP("PSJNVO",$J,"SOL",SOLCNT,0)) D SOLSRCH
"RTN","PSJHL4A",12,0)
 .S SOLUTION="" F  S SOLUTION=$O(^PS(52.7,"AOI",PTR,SOLUTION)) Q:'SOLUTION  S INACT=$G(^PS(52.7,SOLUTION,"I")) I 'INACT!(INACT>DT) I VOLUME=$P(^PS(52.7,SOLUTION,0),U,3) D
"RTN","PSJHL4A",13,0)
 ..S ^TMP("PSJNVO",$J,"SOL",0)=SOLCNT
"RTN","PSJHL4A",14,0)
 ..S ^TMP("PSJNVO",$J,"SOL",SOLCNT,0)=SOLUTION_"^"_VOLUME,TVOLUME=TVOLUME+(+VOLUME)
"RTN","PSJHL4A",15,0)
 I $G(INFRT)]"" S X=INFRT D ENI^PSJHLU S INFRT=$G(X)
"RTN","PSJHL4A",16,0)
 I APPL="A" S ADCNT=ADCNT+1,PTR=$P(FIELD(2),"^",4) Q:'PTR  S STRENGTH=$G(FIELD(3))_" "_$P($G(FIELD(4)),"^",5) D  I '$D(^TMP("PSJNVO",$J,"AD",ADCNT,0)) S PSREASON="Can't find matching additive" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",17,0)
 .S ADDITIVE="" F  S ADDITIVE=$O(^PS(52.6,"AOI",PTR,ADDITIVE)) Q:'ADDITIVE  S INACT=$G(^PS(52.6,ADDITIVE,"I")) I 'INACT!(INACT>DT)  Q:$G(^PS(52.6,ADDITIVE,0))']""  D  Q:ADDITIVE
"RTN","PSJHL4A",18,0)
 ..I $G(PSITEM)="" S PSITEM=PTR
"RTN","PSJHL4A",19,0)
 ..S ^TMP("PSJNVO",$J,"AD",0)=ADCNT
"RTN","PSJHL4A",20,0)
 ..S ^TMP("PSJNVO",$J,"AD",ADCNT,0)=ADDITIVE_"^"_STRENGTH
"RTN","PSJHL4A",21,0)
 Q
"RTN","PSJHL4A",22,0)
 ;
"RTN","PSJHL4A",23,0)
RXO ;
"RTN","PSJHL4A",24,0)
 I $O(PSJMSG(II,0)) D
"RTN","PSJHL4A",25,0)
 .K SEGMENT
"RTN","PSJHL4A",26,0)
 .N KK,JJ,XX
"RTN","PSJHL4A",27,0)
 .S SEGMENT(1)=$G(PSJMSG(II))
"RTN","PSJHL4A",28,0)
 .S KK=1,JJ="" F  S JJ=$O(PSJMSG(II,JJ)) Q:'JJ  S KK=KK+1,SEGMENT(KK)=$G(PSJMSG(II,JJ))
"RTN","PSJHL4A",29,0)
 .S KK=1,JJ=0
"RTN","PSJHL4A",30,0)
 .F  Q:'$D(SEGMENT(KK))  D
"RTN","PSJHL4A",31,0)
 ..I SEGMENT(KK)["|" S FIELD(JJ)=$P(SEGMENT(KK),"|"),SEGMENT(KK)=$E(SEGMENT(KK),$L(FIELD(JJ))+2,$L(SEGMENT(KK))),JJ=JJ+1 Q
"RTN","PSJHL4A",32,0)
 ..I SEGMENT(KK)'["|" S FIELD(JJ)=SEGMENT(KK),KK=KK+1 Q:'$D(SEGMENT(KK))  D
"RTN","PSJHL4A",33,0)
 ...S XX=$P(SEGMENT(KK),"|"),SEGMENT(KK)=$E(SEGMENT(KK),$L(X)+2,$L(SEGMENT(KK))),FIELD(JJ)=FIELD(JJ)_XX,JJ=JJ+1
"RTN","PSJHL4A",34,0)
 S APPL="",PSITEM=$S($P(FIELD(1),"^",5)="IV":"",1:$P(FIELD(1),"^",4))
"RTN","PSJHL4A",35,0)
 S:$P(FIELD(1),"^",6)="ORD" PSITEM=""
"RTN","PSJHL4A",36,0)
 S:$P(FIELD(1),"^",5)="IV" IVTYP="A",SCHTYP="C",INFRT=$G(FIELD(2))
"RTN","PSJHL4A",37,0)
 S DISPENSE=$P($G(FIELD(10)),"^",4)
"RTN","PSJHL4A",38,0)
 S IVLIMIT=$P($G(PSJMSG(II)),"^",3)
"RTN","PSJHL4A",39,0)
 Q
"RTN","PSJHL4A",40,0)
 ;
"RTN","PSJHL4A",41,0)
OBX ;
"RTN","PSJHL4A",42,0)
 S OBXFL=1,OCNARR=FIELD(5),OCPROV=CLERK,OCCNT=OCCNT+1
"RTN","PSJHL4A",43,0)
 S ^TMP("PSJNVO",$J,10,0)=OCCNT
"RTN","PSJHL4A",44,0)
 S ^TMP("PSJNVO",$J,10,OCCNT,0)=OCNARR
"RTN","PSJHL4A",45,0)
 S ^TMP("PSJNVO",$J,10,OCCNT,1)=$P($G(^VA(200,+OCPROV,0)),"^")
"RTN","PSJHL4A",46,0)
 Q
"RTN","PSJHL4A",47,0)
 ;
"RTN","PSJHL4A",48,0)
NTE ;
"RTN","PSJHL4A",49,0)
 S TEXT=$S((FIELD(1)=6)&('OBXFL):"PROCOM",(FIELD(1)=7)&('OBXFL):"ADMINSTR",1:"OCRSN")
"RTN","PSJHL4A",50,0)
 S @TEXT@(1)=$G(FIELD(3))
"RTN","PSJHL4A",51,0)
 S K=1,J="" F  S J=$O(PSJMSG(II,J)) Q:'J  S K=K+1,@TEXT@(K)=$G(PSJMSG(II,J))
"RTN","PSJHL4A",52,0)
 D:$D(OCRSN)
"RTN","PSJHL4A",53,0)
 .S QQ=0 F  S QQ=$O(OCRSN(QQ)) Q:'QQ  S ^TMP("PSJNVO",$J,10,OCCNT,2,QQ,0)=OCRSN(QQ)
"RTN","PSJHL4A",54,0)
 S OBXFL=0
"RTN","PSJHL4A",55,0)
 Q
"RTN","PSJHL4A",56,0)
 ;
"RTN","PSJHL4A",57,0)
ZRX ;
"RTN","PSJHL4A",58,0)
 N ND,ND2,CHK,FOLOR,STDT
"RTN","PSJHL4A",59,0)
 S PREON=$G(FIELD(1)),ROC=$G(FIELD(3))
"RTN","PSJHL4A",60,0)
 S ND=$S((PREON["N")!(PREON["P"):$G(^PS(53.1,+PREON,0)),PREON["V":$G(^PS(55,PSJHLDFN,"IV",+PREON,0)),1:$G(^PS(55,PSJHLDFN,5,+PREON,0)))
"RTN","PSJHL4A",61,0)
 S ND2=$S((PREON["N")!(PREON["P"):$G(^PS(53.1,+PREON,2)),PREON["V":$G(^PS(55,PSJHLDFN,"IV",+PREON,2)),1:$G(^PS(55,PSJHLDFN,5,+PREON,2)))
"RTN","PSJHL4A",62,0)
 I 'ND I ROC'="N" S PSREASON="Invalid Pharmacy order number" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",63,0)
 I ND I ROC="R" S FOLOR=$S(PREON["V":$P(ND2,U,6),1:$P(ND,U,26)) I FOLOR S PSREASON="Duplicate Renewal Request" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",64,0)
 I ND I ROC="R" S CHK=$S(PREON["V":$P(ND,U,17),1:$P(ND,U,9)) I "AE"'[CHK S PSREASON="Pharmacy orders with a status of "_CHK_" may not be renewed" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",65,0)
 I $G(CHK)="E" I PREON'["V" D NOW^%DTC S X1=+$E(%,1,12),X2=-4 D C^%DTC S STDT=$S(PREON["V":$P(ND,U,3),1:$P(ND2,U,4)) I STDT'>X S PSREASON="Pharmacy orders expired longer than 4 days may not be renewed" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",66,0)
 I ND I ROC="E" S FOLOR=$S(PREON["V":$P(ND2,U,6),1:$P(ND,U,26)) I FOLOR S PSREASON="Pharmacy orders may only be edited ONCE" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",67,0)
 I ND I ROC="E" S CHK=$S(PREON["V":$P(ND,U,17),1:$P(ND,U,9)) I "DEHO"[CHK N CHKRTN S CHKRTN=CHK_"^PSJHL6" D @CHKRTN S PSREASON=PSREASON_" orders may not be edited" D ERROR^PSJHL9 Q
"RTN","PSJHL4A",68,0)
 D:ROC'="R" VALID^PSJHL9 Q:QFLG
"RTN","PSJHL4A",69,0)
 I $G(PSITEM)="",$D(^TMP("PSJNVO",$J,"SOL",1,0)) S PSITEM=$P($G(^PS(52.7,+^TMP("PSJNVO",$J,"SOL",1,0),0)),"^",11)
"RTN","PSJHL4A",70,0)
 I PRIORITY="ZD" D VALID^PSJHL10 S QFLG=1 Q
"RTN","PSJHL4A",71,0)
 I (PREON]"")&(ROC="E") D EDITCK^PSJHL5 Q:QFLG
"RTN","PSJHL4A",72,0)
 D NVO^PSJHL9
"RTN","PSJHL4A",73,0)
 I (PREON]"")&(ROC="R") D RENEW^PSJHL7 Q
"RTN","PSJHL4A",74,0)
 I (PREON]"")&(ROC="E") D EDIT^PSJHL5
"RTN","PSJHL4A",75,0)
 Q
"RTN","PSJHL4A",76,0)
 ;
"RTN","PSJHL4A",77,0)
SOLSRCH ;Find solution
"RTN","PSJHL4A",78,0)
 N SSSS,SEG,ON,ROC,SOL,SOL2
"RTN","PSJHL4A",79,0)
 F SSSS=II:0 S SSSS=$O(PSJMSG(SSSS)) Q:'SSSS  I $P(PSJMSG(SSSS),"|")="ZRX" D  Q
"RTN","PSJHL4A",80,0)
 .S SEG=$G(PSJMSG(SSSS)),ON=$P(SEG,"|",2),ROC=$P(SEG,"|",4)
"RTN","PSJHL4A",81,0)
 I $G(ROC)'="N" F SOL=0:0 S SOL=$O(^PS(55,PSJHLDFN,"IV",+ON,"SOL",SOL)) Q:'SOL  S SOL2=$G(^PS(55,PSJHLDFN,"IV",+ON,"SOL",SOL,0)) I $D(^PS(52.7,"AOI",PTR,+SOL2))&($P(SOL2,U,2)=VOLUME) S SOLUTION=+SOL2 D SET Q
"RTN","PSJHL4A",82,0)
 I 'SOLUTION S SOLUTION=$O(^PS(52.7,"AOI",PTR,SOLUTION)) D SET
"RTN","PSJHL4A",83,0)
 Q
"RTN","PSJHL4A",84,0)
SET ;Set solution tmp nodes
"RTN","PSJHL4A",85,0)
 Q:'+SOLUTION
"RTN","PSJHL4A",86,0)
 S ^TMP("PSJNVO",$J,"SOL",0)=SOLCNT
"RTN","PSJHL4A",87,0)
 S ^TMP("PSJNVO",$J,"SOL",SOLCNT,0)=SOLUTION_"^"_VOLUME,TVOLUME=TVOLUME+(+VOLUME)
"RTN","PSJHL4A",88,0)
 Q
"RTN","PSJHL4A",89,0)
 ;
"RTN","PSJHL4A",90,0)
SNDTSTW(PRIO,PSJSCHED,WARD) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",91,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",92,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",93,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",94,0)
 S SNOPT=$P($G(^PS(59.6,WARD,0)),"^",32)
"RTN","PSJHL4A",95,0)
 S:SNOPT="" SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",96,0)
 Q:SNOPT="" 0
"RTN","PSJHL4A",97,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",98,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",99,0)
 Q 1
"RTN","PSJHL4A",100,0)
 ;
"RTN","PSJHL4A",101,0)
SNDTSTP(PRIO,PSJSCHED) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",102,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",103,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",104,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",105,0)
 S SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",106,0)
 Q:SNOPT="" 0
"RTN","PSJHL4A",107,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",108,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",109,0)
 Q 1
"RTN","PSJHL4A",110,0)
 ;
"RTN","PSJHL4A",111,0)
SNDTSTA(PRIO,PSJSCHED) ; Test to determine if mail message should be sent.
"RTN","PSJHL4A",112,0)
 N SNPRIO,SNSCHD,SNOPT
"RTN","PSJHL4A",113,0)
 S SNPRIO=$S(PRIO="S":"S",PRIO="A":"A",1:"R")
"RTN","PSJHL4A",114,0)
 S SNSCHD=$S(PSJSCHED="STAT":"S",PSJSCHED="NOW":"N",1:"R")
"RTN","PSJHL4A",115,0)
 S SNOPT=$P($G(^PS(59.7,1,27)),"^",2)
"RTN","PSJHL4A",116,0)
 S:SNOPT="" SNOPT=$P($G(^PS(59.7,1,27)),"^",1)
"RTN","PSJHL4A",117,0)
 Q:SNOPT="" 0
"RTN","PSJHL4A",118,0)
 Q:SNOPT[SNPRIO 0
"RTN","PSJHL4A",119,0)
 Q:SNOPT[SNSCHD 0
"RTN","PSJHL4A",120,0)
 Q 1
"RTN","PSJLMPRI")
0^2^B18941536^B17650009
"RTN","PSJLMPRI",1,0)
PSJLMPRI ;BIR/MLM-INPATIENT LISTMAN IV PROFILE UTILITIES ;01 JUL 96 / 2:24 PM
"RTN","PSJLMPRI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,85,118,110,133,154**;16 DEC 97
"RTN","PSJLMPRI",3,0)
 ;
"RTN","PSJLMPRI",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMPRI",5,0)
 ;
"RTN","PSJLMPRI",6,0)
PIV(DFN,ON,PSJF,DN)       ;Setup LM display for IV order. 
"RTN","PSJLMPRI",7,0)
 N ND14,DRG,ON55,P,PSJORIFN,TYP,V,X,Y,PSJFLAG S TYP="?" I ON["V" D
"RTN","PSJLMPRI",8,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSJLMPRI",9,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJLMPRI",10,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJLMPRI",11,0)
 .S P("PRY")=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,4),PSJFLAG=$P($G(^(.2)),U,7)
"RTN","PSJLMPRI",12,0)
 .S ND4=$G(^PS(55,DFN,"IV",+ON,4)),V=$S(P("PRY")="D":"d",1:" ")_$S((+PSJSYSU=1&'+$P(ND4,U)):"->",(+PSJSYSU=3&'+$P(ND4,U,4)):"->",1:"") I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRI",13,0)
 .S PSJL=$$SETSTR^VALM1(V,PSJL,6,3)
"RTN","PSJLMPRI",14,0)
 .S ND14=$G(^PS(55,DFN,"IV",+ON,14,0)),ND14=$P(ND14,U,3) S:ND14 ND14=+$G(^(ND14,0))
"RTN","PSJLMPRI",15,0)
 I ON=+ON N PSJEN2,O S PSJEN2=PSJEN,O="" F  S O=$O(^PS(53.1,"ACX",ON,O)) Q:O=""  D
"RTN","PSJLMPRI",16,0)
 .I PSJEN2'=PSJEN S PSJL=$J(PSJEN2,4)
"RTN","PSJLMPRI",17,0)
 .S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+O,O)),U,9),Y=+$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U),PSJFLAG=$P($G(^(.2)),U,7)
"RTN","PSJLMPRI",18,0)
 .D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) D @$S($E(P("OT"))'="F":"PUD^PSJLMPRU(DFN,O_""P"",PSJF,DN)",1:"PIV^PSJLMPRI(DFN,O_""P"",PSJF,DN)") S PSJEN2=""
"RTN","PSJLMPRI",19,0)
 I ON["P" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U),PSJFLAG=$P($G(^(.2)),U,7) D  I $E(P("OT"))'="F" D PUD^PSJLMPRU(DFN,ON,PSJF,DN) Q
"RTN","PSJLMPRI",20,0)
 . D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJLMPRI",21,0)
 . S ND14=$G(^PS(53.1,+ON,14,0)),ND14=$P(ND14,U,3) S:ND14 ND14=+$G(^(ND14,0))
"RTN","PSJLMPRI",22,0)
 I $G(PSJFLAG) D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRI",23,0)
 NEW PSJIVFLG S PSJIVFLG=1
"RTN","PSJLMPRI",24,0)
 S DRG=+$O(DRG("AD",0)) D:DRG PIVAD F  S DRG=$O(DRG("AD",DRG)) Q:'DRG  S PSJL="" D PIVAD
"RTN","PSJLMPRI",25,0)
SOL ;
"RTN","PSJLMPRI",26,0)
 S PSJL=$S($G(PSJIVFLG):PSJL_$S(ON["V":"in",1:"    in"),1:"        in")
"RTN","PSJLMPRI",27,0)
 NEW DRGX,NAME
"RTN","PSJLMPRI",28,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP,SETSTAT S PSJL="      "
"RTN","PSJLMPRI",29,0)
 ;S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:'$G(PSJIVFLG) SETTMP D:$G(PSJIVFLG) PIV1 S PSJL="      "
"RTN","PSJLMPRI",30,0)
 Q
"RTN","PSJLMPRI",31,0)
PIVAD ; Print IV Additives.
"RTN","PSJLMPRI",32,0)
 NEW NAME
"RTN","PSJLMPRI",33,0)
 D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1)
"RTN","PSJLMPRI",34,0)
 I $D(NAME(2)) S PSJL=$$SETSTR^VALM1(NAME(1),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP,SETSTAT S PSJL="",PSJL=$$SETSTR^VALM1(NAME(2),PSJL,9,60) D SETTMP,SETSTAT
"RTN","PSJLMPRI",35,0)
 I '$D(NAME(2)) S PSJL=$$SETSTR^VALM1(NAME(1),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP,SETSTAT
"RTN","PSJLMPRI",36,0)
 Q
"RTN","PSJLMPRI",37,0)
 ;
"RTN","PSJLMPRI",38,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJLMPRI",39,0)
 K PSJIVFLG
"RTN","PSJLMPRI",40,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJLMPRI",41,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,67,1)
"RTN","PSJLMPRI",42,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,73,1)
"RTN","PSJLMPRI",43,0)
 I $G(ND14) S ND14=$$ENDTC^PSGMI((ND14)) S PSJL=$$SETSTR^VALM1(ND14,PSJL,$S($D(PSJEXTP):75,1:72),5) K ND14
"RTN","PSJLMPRI",44,0)
 ;* D SETTMP
"RTN","PSJLMPRI",45,0)
 Q
"RTN","PSJLMPRI",46,0)
SETTMP ;
"RTN","PSJLMPRI",47,0)
 S ^TMP($S($G(PSIVLBNM)]"":PSIVLBNM,1:"PSJPRO"),$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1
"RTN","PSJLMPRI",48,0)
 Q
"RTN","PSJLMPRI",49,0)
 ;
"RTN","PSJLMPRI",50,0)
SETSTAT ;
"RTN","PSJLMPRI",51,0)
 I ON["P",$P($G(^PS(53.1,+ON,.2)),"^",4)="S" D CNTRL^VALM10((PSJLN-1),9,9+$L(PSJL),IOINHI_IOBON,IOINORM,0)
"RTN","PSJLMPRI",52,0)
 Q
"RTN","PSJLMPRI",53,0)
 ; 
"RTN","PSJLMPRI",54,0)
LASTREN(DFN,ON) ;
"RTN","PSJLMPRI",55,0)
 N FIL,RNDT,ND0,ND14 S ND14="" I '$G(ON)!'$G(DFN) Q 0
"RTN","PSJLMPRI",56,0)
 S FIL=$S(ON["P":"^PS(53.1,"_+ON_",14,0)",ON["V":"^PS(55,"_DFN_",""IV"","_+ON_",14,0)",ON["U":"^PS(55,"_DFN_",5,"_+ON_",14,0)",1:"")
"RTN","PSJLMPRI",57,0)
 ; Naked reference below refers to either ^PS(53.1,+ON,14,0), ^PS(55,+ON,5,14,0), or ^PS(55,+ON,5,14,0) created using indirection in variable FIL.
"RTN","PSJLMPRI",58,0)
 Q:FIL="" 0
"RTN","PSJLMPRI",59,0)
 S ND14=$G(@(FIL)) I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0))
"RTN","PSJLMPRI",60,0)
 Q ND14
"RTN","PSJLMPRI",61,0)
 ;
"RTN","PSJLMPRI",62,0)
LASTRNBY(DFN,ON) ;
"RTN","PSJLMPRI",63,0)
 N FIL,RNBY,ND0,ND14 S RNBY=""
"RTN","PSJLMPRI",64,0)
 S FIL=$S(ON["P":"^PS(53.1,"_+ON_",14,0)",ON["V":"^PS(55,"_DFN_",""IV"","_+ON_",14,0)",ON["U":"^PS(55,"_DFN_",5,"_+ON_",14,0)",1:"")
"RTN","PSJLMPRI",65,0)
 ; Naked reference below refers to either ^PS(53.1,+ON,14,0), ^PS(55,+ON,5,14,0), or ^PS(55,+ON,5,14,0) created using indirection in variable FIL.
"RTN","PSJLMPRI",66,0)
 Q:FIL="" 0
"RTN","PSJLMPRI",67,0)
 S ND14=$G(@(FIL)) I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0)),RNBY=$P(ND14,"^",2)
"RTN","PSJLMPRI",68,0)
 Q RNBY
"VER")
8.0^22.0
"^DD",59.6,59.6,6,0)
PRIORITIES FOR NOTIFICATION^S^S:STAT;SA:STAT/ASAP;SAN:STAT/ASAP/NOW;A:ASAP;AN:ASAP/NOW;N:NOW;SN:STAT/NOW;^0;32^Q
"^DD",59.6,59.6,6,21,0)
^.001^4^4^3050727^^^
"^DD",59.6,59.6,6,21,1,0)
Enter the priorities of STAT, ASAP, or the schedule of NOW, or any 
"^DD",59.6,59.6,6,21,2,0)
combination the three to be used to send a notification of orders with 
"^DD",59.6,59.6,6,21,3,0)
these priorities to the mail group defined in the STAT NOW MAIL GROUP 
"^DD",59.6,59.6,6,21,4,0)
parameter.
"^DD",59.6,59.6,6,"DT")
3050727
"BLD",5988,6)
^152
**END**
**END**
