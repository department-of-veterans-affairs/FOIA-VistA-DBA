Released IB*2*336 SEQ #302
Extracted from mail message
**KIDS**:IB*2.0*336^

**INSTALL NAME**
IB*2.0*336
"BLD",6573,0)
IB*2.0*336^INTEGRATED BILLING^0^3060309^y
"BLD",6573,1,0)
^^3^3^3060309^^
"BLD",6573,1,1,0)
Pharmacy Claims Tracking fix related to CIDC (patch IB*2.0*260)
"BLD",6573,1,2,0)
Reason Not Billable will now be assigned appropriately for items
"BLD",6573,1,3,0)
entered prior to the CIDC patch.
"BLD",6573,4,0)
^9.64PA^^
"BLD",6573,6)
3^
"BLD",6573,"INID")
^n
"BLD",6573,"INIT")
IB20P336
"BLD",6573,"KRN",0)
^9.67PA^8989.52^19
"BLD",6573,"KRN",.4,0)
.4
"BLD",6573,"KRN",.401,0)
.401
"BLD",6573,"KRN",.402,0)
.402
"BLD",6573,"KRN",.403,0)
.403
"BLD",6573,"KRN",.5,0)
.5
"BLD",6573,"KRN",.84,0)
.84
"BLD",6573,"KRN",3.6,0)
3.6
"BLD",6573,"KRN",3.8,0)
3.8
"BLD",6573,"KRN",9.2,0)
9.2
"BLD",6573,"KRN",9.8,0)
9.8
"BLD",6573,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6573,"KRN",9.8,"NM",1,0)
IB20P336^^0^B28791862
"BLD",6573,"KRN",9.8,"NM",2,0)
IBTRKR3^^0^B39212949
"BLD",6573,"KRN",9.8,"NM","B","IB20P336",1)

"BLD",6573,"KRN",9.8,"NM","B","IBTRKR3",2)

"BLD",6573,"KRN",19,0)
19
"BLD",6573,"KRN",19.1,0)
19.1
"BLD",6573,"KRN",101,0)
101
"BLD",6573,"KRN",409.61,0)
409.61
"BLD",6573,"KRN",771,0)
771
"BLD",6573,"KRN",870,0)
870
"BLD",6573,"KRN",8989.51,0)
8989.51
"BLD",6573,"KRN",8989.52,0)
8989.52
"BLD",6573,"KRN",8994,0)
8994
"BLD",6573,"KRN","B",.4,.4)

"BLD",6573,"KRN","B",.401,.401)

"BLD",6573,"KRN","B",.402,.402)

"BLD",6573,"KRN","B",.403,.403)

"BLD",6573,"KRN","B",.5,.5)

"BLD",6573,"KRN","B",.84,.84)

"BLD",6573,"KRN","B",3.6,3.6)

"BLD",6573,"KRN","B",3.8,3.8)

"BLD",6573,"KRN","B",9.2,9.2)

"BLD",6573,"KRN","B",9.8,9.8)

"BLD",6573,"KRN","B",19,19)

"BLD",6573,"KRN","B",19.1,19.1)

"BLD",6573,"KRN","B",101,101)

"BLD",6573,"KRN","B",409.61,409.61)

"BLD",6573,"KRN","B",771,771)

"BLD",6573,"KRN","B",870,870)

"BLD",6573,"KRN","B",8989.51,8989.51)

"BLD",6573,"KRN","B",8989.52,8989.52)

"BLD",6573,"KRN","B",8994,8994)

"BLD",6573,"QUES",0)
^9.62^^
"BLD",6573,"REQB",0)
^9.611^1^1
"BLD",6573,"REQB",1,0)
IB*2.0*309^2
"BLD",6573,"REQB","B","IB*2.0*309",1)

"INIT")
IB20P336
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
336^3060309^101005
"PKG",200,22,1,"PAH",1,1,0)
^^3^3^3060309
"PKG",200,22,1,"PAH",1,1,1,0)
Pharmacy Claims Tracking fix related to CIDC (patch IB*2.0*260)
"PKG",200,22,1,"PAH",1,1,2,0)
Reason Not Billable will now be assigned appropriately for items
"PKG",200,22,1,"PAH",1,1,3,0)
entered prior to the CIDC patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IB20P336")
0^1^B28791862
"RTN","IB20P336",1,0)
IB20P336 ;OAK/ELZ - IB*2*336 POST INIT TO REPORT CLAIMS TRACKING PROBLEMS ;15-DEC-2005
"RTN","IB20P336",2,0)
 ;;2.0;INTEGRATED BILLING;**336**;21-MAR-94
"RTN","IB20P336",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IB20P336",4,0)
 ;
"RTN","IB20P336",5,0)
 ; With the release of CIDC (IB*2*260), PSO added a new node for storage of SC/EI determinations.  However it turns
"RTN","IB20P336",6,0)
 ; out this new node is not always there.  If the node is there the data contained in that node is correct for SC/EI
"RTN","IB20P336",7,0)
 ; determination.  But if the node was not there IB needed to revert back to its original process for marking CT
"RTN","IB20P336",8,0)
 ; entries.  That reversion was not included in IB*2*260, but is included in this IB*2*336 patch.  This post init
"RTN","IB20P336",9,0)
 ; routine will look through CT entries for Pharmacy that were created after IB*2*260 was installed and evaluate
"RTN","IB20P336",10,0)
 ; those CT entries.  Since some sites spend time manually reviewing these entries the entries cannot be auto-
"RTN","IB20P336",11,0)
 ; matically marked and bills cannot be automatically cancelled.  So this post init routine will provide an e-mail
"RTN","IB20P336",12,0)
 ; report of CT entries that should be reviewed by the site.  Also as a note the PSO IBQ node is not a reliable
"RTN","IB20P336",13,0)
 ; node to look at for patients >49% SC, in fact should not ever be populated for these patients.  So if anyone
"RTN","IB20P336",14,0)
 ; does a comparison they are likely to find invalid data.  PSO stopped populating IBQ for >49% SC with the
"RTN","IB20P336",15,0)
 ; release of PSO*7*219.
"RTN","IB20P336",16,0)
 ; 
"RTN","IB20P336",17,0)
 ; 
"RTN","IB20P336",18,0)
POST ; post init entry point
"RTN","IB20P336",19,0)
 ;
"RTN","IB20P336",20,0)
 N IBIDT,IBX,IBSTOP,IBDATA,IBDPT,IBL,IBPNM,IBZ,XMDUZ,XMSUB,XMY,XMZ
"RTN","IB20P336",21,0)
 ;
"RTN","IB20P336",22,0)
 D BMES^XPDUTL("Starting Post Install to evaluate CT entries...")
"RTN","IB20P336",23,0)
 ;
"RTN","IB20P336",24,0)
 K ^TMP("IB20P336",$J)
"RTN","IB20P336",25,0)
 ;
"RTN","IB20P336",26,0)
 ; dbia #2197
"RTN","IB20P336",27,0)
 S IBIDT=$P($G(^XPD(9.7,+$O(^XPD(9.7,"B","IB*2.0*260",0)),1)),"^")
"RTN","IB20P336",28,0)
 I 'IBIDT D BMES^XPDUTL("Cannot find first install of IB*2*260!!!  LOG A REMEDY TICKET") Q
"RTN","IB20P336",29,0)
 ;
"RTN","IB20P336",30,0)
 ; start at end of CT file and work backwards to beginning
"RTN","IB20P336",31,0)
 S IBSTOP=0,IBX=":" F  S IBX=$O(^IBT(356,IBX),-1) Q:'IBX!(IBSTOP)  D
"RTN","IB20P336",32,0)
 . S IBZ=$G(^IBT(356,IBX,0))
"RTN","IB20P336",33,0)
 . Q:'$P(IBZ,"^",8)
"RTN","IB20P336",34,0)
 . ;
"RTN","IB20P336",35,0)
 . ; can i end?
"RTN","IB20P336",36,0)
 . S IBDT=+$G(^IBT(356,IBX,1)) I IBDT,IBDT<IBIDT S IBSTOP=1 Q
"RTN","IB20P336",37,0)
 . ;
"RTN","IB20P336",38,0)
 . ; entry has a RNB no need to check out
"RTN","IB20P336",39,0)
 . Q:$P(IBZ,"^",19)
"RTN","IB20P336",40,0)
 . ;
"RTN","IB20P336",41,0)
 . ; PSO has an ICD node so it was done right
"RTN","IB20P336",42,0)
 . Q:$D(^PSRX($P(IBZ,"^",8),"ICD"))
"RTN","IB20P336",43,0)
 . ;
"RTN","IB20P336",44,0)
 . ;determine RNB would have been had CIDC not been installed, if none quit
"RTN","IB20P336",45,0)
 . S IBRMARK=$$RNB($P(IBZ,"^",2),$P(IBZ,"^",6),$P(IBZ,"^",8),$G(^PSRX($P(IBZ,"^",8),0)))
"RTN","IB20P336",46,0)
 . I IBRMARK="" Q
"RTN","IB20P336",47,0)
 . ;
"RTN","IB20P336",48,0)
 . S IBDPT=$G(^DPT(+$P(IBZ,"^",2),0)) Q:'$L(IBDPT)
"RTN","IB20P336",49,0)
 . S IBDATA=$$TXT($P(IBDPT,"^"),15)_$$TXT($E($P(IBDPT,"^",9),6,9),4)
"RTN","IB20P336",50,0)
 . S IBDATA=IBDATA_$$TXT($$FMTE^XLFDT($P(IBZ,"^",6),"2DZ"),8)_$$TXT($P($G(^PSRX($P(IBZ,"^",8),0)),"^"),10)
"RTN","IB20P336",51,0)
 . S IBDATA=IBDATA_$$TXT($P($G(^DGCR(399,+$P(IBZ,"^",11),0)),"^"),10)_$$TXT(IBRMARK,14)
"RTN","IB20P336",52,0)
 . ;
"RTN","IB20P336",53,0)
 . ; get AR status
"RTN","IB20P336",54,0)
 . S:$P(IBZ,"^",11) IBDATA=IBDATA_$E($P($$STA^PRCAFN(+$P(IBZ,"^",11)),"^",2),1,4)
"RTN","IB20P336",55,0)
 . ; 
"RTN","IB20P336",56,0)
 . S ^TMP("IB20P336",$J,$P(IBDPT,"^"),IBX)=IBDATA
"RTN","IB20P336",57,0)
 ;
"RTN","IB20P336",58,0)
 D BMES^XPDUTL("Sending report message...")
"RTN","IB20P336",59,0)
 ;
"RTN","IB20P336",60,0)
 ; get message and send
"RTN","IB20P336",61,0)
RETRY ;
"RTN","IB20P336",62,0)
 S XMSUB="CLAIMS TRACKING PHARMACY IB*2*336"
"RTN","IB20P336",63,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE"
"RTN","IB20P336",64,0)
 D XMZ^XMA2
"RTN","IB20P336",65,0)
 I XMZ<1 G RETRY
"RTN","IB20P336",66,0)
 ;
"RTN","IB20P336",67,0)
 ;set priority on message
"RTN","IB20P336",68,0)
 S DIE=3.9,DA=XMZ,DR="1.7////P" D ^DIE
"RTN","IB20P336",69,0)
 ;
"RTN","IB20P336",70,0)
 S ^XMB(3.9,XMZ,2,1,0)="With the install of the CIDC software (IB*2*260) some pharmacy related"
"RTN","IB20P336",71,0)
 S ^XMB(3.9,XMZ,2,2,0)="Claims Tracking (CT) entries may not have been assigned a Reason Not"
"RTN","IB20P336",72,0)
 S ^XMB(3.9,XMZ,2,3,0)="Billable (RNB).  Below is a list of CT entries that do not have a RNB"
"RTN","IB20P336",73,0)
 S ^XMB(3.9,XMZ,2,4,0)="with a RNB that should have been originally assigned to them.  Please"
"RTN","IB20P336",74,0)
 S ^XMB(3.9,XMZ,2,5,0)="review the list below and assign a RNB if appropriate."
"RTN","IB20P336",75,0)
 S ^XMB(3.9,XMZ,2,6,0)=" "
"RTN","IB20P336",76,0)
 S ^XMB(3.9,XMZ,2,7,0)="Name             SSN   Date      Rx#         Bill#       RNB             AR"
"RTN","IB20P336",77,0)
 S ^XMB(3.9,XMZ,2,8,0)="---------------  ----  --------  ----------  ----------  --------------  ----"
"RTN","IB20P336",78,0)
 S IBL=8
"RTN","IB20P336",79,0)
 S IBPNM="" F  S IBPNM=$O(^TMP("IB20P336",$J,IBPNM)) Q:IBPNM=""  S IBX=0 F  S IBX=$O(^TMP("IB20P336",$J,IBPNM,IBX)) Q:'IBX  D
"RTN","IB20P336",80,0)
 . S IBL=IBL+1
"RTN","IB20P336",81,0)
 . S ^XMB(3.9,XMZ,2,IBL,0)=^TMP("IB20P336",$J,IBPNM,IBX)
"RTN","IB20P336",82,0)
 I '$D(^TMP("IB20P336",$J)) S ^XMB(3.9,XMZ,2,IBL+1,0)="    <None Found>"
"RTN","IB20P336",83,0)
 S ^XMB(3.9,XMZ,2,0)="^3.92^"_IBL_"^"_IBL_"^"_DT
"RTN","IB20P336",84,0)
 ;
"RTN","IB20P336",85,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE"
"RTN","IB20P336",86,0)
 S XMY(DUZ)="" ; Individual as a recipient
"RTN","IB20P336",87,0)
 F IBX="IB SUPERVISOR","IB CLAIMS SUPERVISOR" S IBZ=0 F  S IBZ=$O(^XUSEC(IBX,IBZ)) Q:'IBZ  S XMY(IBZ)=""
"RTN","IB20P336",88,0)
 ;
"RTN","IB20P336",89,0)
 D ENT1^XMD
"RTN","IB20P336",90,0)
 ;
"RTN","IB20P336",91,0)
 D BMES^XPDUTL("Message number "_XMZ_" sent...")
"RTN","IB20P336",92,0)
 ;
"RTN","IB20P336",93,0)
 K ^TMP("IB20P336",$J)
"RTN","IB20P336",94,0)
 ;
"RTN","IB20P336",95,0)
 D BMES^XPDUTL("Post Install Complete...")
"RTN","IB20P336",96,0)
 ;
"RTN","IB20P336",97,0)
 Q
"RTN","IB20P336",98,0)
 ;
"RTN","IB20P336",99,0)
 ;
"RTN","IB20P336",100,0)
RNB(DFN,IBDT,IBRXN,IBRXDATA) ; determines what the RNB would have been had the new ICD node not been checked
"RTN","IB20P336",101,0)
 ;
"RTN","IB20P336",102,0)
 N VAEL,IBRMARK,VA,IBPOWUNV,IBAUTRET
"RTN","IB20P336",103,0)
 ;
"RTN","IB20P336",104,0)
 D ELIG^VADPT
"RTN","IB20P336",105,0)
 ;if the patient is covered by insurance for pharmacy ($G(IBRMARK)="")
"RTN","IB20P336",106,0)
 ;AND if no copay in #350
"RTN","IB20P336",107,0)
 ;then we need to determine the non billable reason and set IBRMARK
"RTN","IB20P336",108,0)
 ;
"RTN","IB20P336",109,0)
 ;IF VAEL(3) -- if this is a veteran with SC(service connection) status
"RTN","IB20P336",110,0)
 I VAEL(3),'$G(^PSRX(IBRXN,"IB")) D
"RTN","IB20P336",111,0)
 . I $P(VAEL(3),"^",2)>49 S IBRMARK="NEEDS SC DETERMINATION"
"RTN","IB20P336",112,0)
 . ;in case of POW and Unempl. vet we cannot decide if the 3rd party should be exempt
"RTN","IB20P336",113,0)
 . S IBAUTRET=$$AUTOINFO^DGMTCOU1(DFN),IBPOWUNV=$S($P(IBAUTRET,U,8):1,$P(IBAUTRET,U,9):1,1:0)
"RTN","IB20P336",114,0)
 . I $P(VAEL(3),"^",2)<50 S IBRMARK=$S(IBPOWUNV:"NEEDS SC DETERMINATION",1:"SC TREATMENT")
"RTN","IB20P336",115,0)
 . I $$RXST^IBARXEU(DFN,$P(IBRXDATA,U,13))>0 S IBRMARK="NEEDS SC DETERMINATION"
"RTN","IB20P336",116,0)
 ;
"RTN","IB20P336",117,0)
 ;IF +VAEL(3)=0 if the veteran doesn't have SC status, but
"RTN","IB20P336",118,0)
 ;the veteran still may have CV status active
"RTN","IB20P336",119,0)
 I $G(IBRMARK)="",+VAEL(3)=0,'$G(^PSRX(IBRXN,"IB")) D
"RTN","IB20P336",120,0)
 . I $$CVEDT^IBACV(DFN,IBDT) S IBRMARK="NEEDS SC DETERMINATION" ;SC-because IB staff usually is using this reason to search for cases that need to be reviewed. COMBAT VETERAN reason will be used after review if this was the case
"RTN","IB20P336",121,0)
 ;
"RTN","IB20P336",122,0)
 ;
"RTN","IB20P336",123,0)
 Q $G(IBRMARK)
"RTN","IB20P336",124,0)
 ;
"RTN","IB20P336",125,0)
 ;
"RTN","IB20P336",126,0)
TXT(X,Y) ; make text Y characters long adding 2 spaces
"RTN","IB20P336",127,0)
 Q $$LJ^XLFSTR($E(X,1,Y),Y+2)
"RTN","IB20P336",128,0)
 ;
"RTN","IBTRKR3")
0^2^B39212949^B23758062
"RTN","IBTRKR3",1,0)
IBTRKR3 ;ALB/AAS - CLAIMS TRACKING - ADD/TRACK RX FILLS ;13-AUG-93
"RTN","IBTRKR3",2,0)
 ;;2.0;INTEGRATED BILLING;**13,43,121,160,247,275,260,309,336**;21-MAR-94
"RTN","IBTRKR3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRKR3",4,0)
 ;
"RTN","IBTRKR3",5,0)
% ; -- entry point for nightly background job
"RTN","IBTRKR3",6,0)
 N IBTSBDT,IBTSEDT
"RTN","IBTRKR3",7,0)
 S IBTSBDT=$$FMADD^XLFDT(DT,-14)-.1
"RTN","IBTRKR3",8,0)
 S IBTSEDT=$$FMADD^XLFDT(DT,-7)+.9
"RTN","IBTRKR3",9,0)
 D EN1
"RTN","IBTRKR3",10,0)
 Q
"RTN","IBTRKR3",11,0)
 ;
"RTN","IBTRKR3",12,0)
EN ; -- entry point to ask date range
"RTN","IBTRKR3",13,0)
 N IBBDT,IBEDT,IBTSBDT,IBTSEDT,IBTALK,IBMESS
"RTN","IBTRKR3",14,0)
 S IBTALK=1
"RTN","IBTRKR3",15,0)
 I '$P($G(^IBE(350.9,1,6)),"^",4) W !!,"I'm sorry, Tracking of Prescription Refills is currently turned off." G ENQ
"RTN","IBTRKR3",16,0)
 W !!!,"Select the Date Range of Rx Refills to Add to Claims Tracking.",!
"RTN","IBTRKR3",17,0)
 D DATE^IBOUTL
"RTN","IBTRKR3",18,0)
 I IBBDT<1!(IBEDT<1) G ENQ
"RTN","IBTRKR3",19,0)
 S IBTSBDT=IBBDT,IBTSEDT=IBEDT
"RTN","IBTRKR3",20,0)
 ;
"RTN","IBTRKR3",21,0)
 ; -- check selected dates
"RTN","IBTRKR3",22,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR3",23,0)
 ; start date can't be before parameters
"RTN","IBTRKR3",24,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR W !!,"Begin date is before Claims Tracking Start Date, changed to ",$$DAT1^IBOUTL(IBTSBDT)
"RTN","IBTRKR3",25,0)
 ; -- end date into future
"RTN","IBTRKR3",26,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-3) W !!,"I'll automatically change the end date to 3 days prior to the date queued to run."
"RTN","IBTRKR3",27,0)
 ;
"RTN","IBTRKR3",28,0)
 W !!!,"I'm going to automatically queue this off and send you a"
"RTN","IBTRKR3",29,0)
 W !,"mail message when complete.",!
"RTN","IBTRKR3",30,0)
 S ZTIO="",ZTRTN="EN1^IBTRKR3",ZTSAVE("IB*")="",ZTDESC="IB - Add Rx Refills to Claims Tracking"
"RTN","IBTRKR3",31,0)
 D ^%ZTLOAD I $G(ZTSK) K ZTSK W !,"Request Queued"
"RTN","IBTRKR3",32,0)
ENQ K ZTSK,ZTIO,ZTSAVE,ZTDESC,ZTRTN
"RTN","IBTRKR3",33,0)
 D HOME^%ZIS
"RTN","IBTRKR3",34,0)
 Q
"RTN","IBTRKR3",35,0)
 ;
"RTN","IBTRKR3",36,0)
EN1 ; -- add rx refills to claims tracking file
"RTN","IBTRKR3",37,0)
 N I,J,X,Y,IBTRKR,IBDT,IBRXN,IBFILL,DFN,IBDATA,IBCNT,IBCNT1,IBCNT2
"RTN","IBTRKR3",38,0)
 ;
"RTN","IBTRKR3",39,0)
 ; -- check parameters
"RTN","IBTRKR3",40,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR3",41,0)
 G:'$P(IBTRKR,"^",4) EN1Q ; quit if rx tracking off
"RTN","IBTRKR3",42,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR ; start date can't be before parameters
"RTN","IBTRKR3",43,0)
 ;
"RTN","IBTRKR3",44,0)
 ; -- users can queue into future, make sure dates not after date run
"RTN","IBTRKR3",45,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-3) S IBMESS="(Selected end date of "_$$DAT1^IBOUTL(IBTSEDT)_" automatically changed to "_$$DAT1^IBOUTL($$FMADD^XLFDT(DT,-3))_".)",IBTSEDT=$$FMADD^XLFDT(DT,-3)
"RTN","IBTRKR3",46,0)
 ;
"RTN","IBTRKR3",47,0)
 S IBRXTYP=$O(^IBE(356.6,"AC",4,0)) ; event type pointer for rx billing
"RTN","IBTRKR3",48,0)
 ;
"RTN","IBTRKR3",49,0)
 ; -- cnt= total count, cnt1=count added nsc, cnt2=count of pending
"RTN","IBTRKR3",50,0)
 S (IBCNT,IBCNT1,IBCNT2)=0
"RTN","IBTRKR3",51,0)
 S IBDT=IBTSBDT-.0001
"RTN","IBTRKR3",52,0)
 F  S IBDT=$O(^PSRX("AD",IBDT)) Q:'IBDT!(IBDT>IBTSEDT)  S IBRXN="" F  S IBRXN=$O(^PSRX("AD",IBDT,IBRXN)) Q:'IBRXN  S IBFILL="" F  S IBFILL=$O(^PSRX("AD",IBDT,IBRXN,IBFILL)) Q:IBFILL=""  D RXCHK
"RTN","IBTRKR3",53,0)
 ;
"RTN","IBTRKR3",54,0)
 I $G(IBTALK) D BULL^IBTRKR31
"RTN","IBTRKR3",55,0)
EN1Q I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBTRKR3",56,0)
 Q
"RTN","IBTRKR3",57,0)
 ;
"RTN","IBTRKR3",58,0)
RXCHK ; -- check and add rx
"RTN","IBTRKR3",59,0)
 S IBCNT=IBCNT+1
"RTN","IBTRKR3",60,0)
 ;I IBFILL<1 G RXCHKQ ;       original fill
"RTN","IBTRKR3",61,0)
 I IBDT>(DT+.24) G RXCHKQ ;  future fill
"RTN","IBTRKR3",62,0)
 I '$D(ZTQUEUED),($G(IBTALK)) W "."
"RTN","IBTRKR3",63,0)
 ;
"RTN","IBTRKR3",64,0)
 S IBRXDATA=$G(^PSRX(IBRXN,0)),IBRXSTAT=$P(IBRXDATA,"^",15)
"RTN","IBTRKR3",65,0)
 S DFN=$P(IBRXDATA,"^",2)
"RTN","IBTRKR3",66,0)
 ;I IBDT=$P($O(^DPT(DFN,"S",(IBDT-.00001))),".") G RXCHKQ ;scheduled appointment on same day as fill date
"RTN","IBTRKR3",67,0)
 ;I $$BABCSC^IBEFUNC(DFN,$P(IBDT,".",1)) G RXCHKQ ; is billable clinic stop in encounter file for data (allows telephone stops on same day, but not others) (P121 - RC, can now bill Rx if on same day as opt visit)
"RTN","IBTRKR3",68,0)
 ;
"RTN","IBTRKR3",69,0)
 ; -- not already in claims tracking
"RTN","IBTRKR3",70,0)
 I $O(^IBT(356,"ARXFL",IBRXN,IBFILL,0)) G RXCHKQ ; already in claims tracking
"RTN","IBTRKR3",71,0)
 ;
"RTN","IBTRKR3",72,0)
 ; -- see if tracking only insured and pt is insured
"RTN","IBTRKR3",73,0)
 I $P(IBTRKR,"^",4)=1,'$$INSURED^IBCNS1(DFN,IBDT) G RXCHKQ ; patient not insure
"RTN","IBTRKR3",74,0)
 ;
"RTN","IBTRKR3",75,0)
 ; -- check rx status (not deleted)
"RTN","IBTRKR3",76,0)
 I IBRXSTAT=13 G RXCHKQ
"RTN","IBTRKR3",77,0)
 ;
"RTN","IBTRKR3",78,0)
 ; -- original fill not released or returned to stock
"RTN","IBTRKR3",79,0)
 I 'IBFILL,'$P($G(^PSRX(IBRXN,2)),"^",13) G RXCHKQ
"RTN","IBTRKR3",80,0)
 I 'IBFILL,$P($G(^PSRX(IBRXN,2)),"^",15) G RXCHKQ
"RTN","IBTRKR3",81,0)
 ;
"RTN","IBTRKR3",82,0)
 ; -- refill not released or returned to stock
"RTN","IBTRKR3",83,0)
 I +IBFILL,'$P($G(^PSRX(IBRXN,1,IBFILL,0)),"^",18) G RXCHKQ
"RTN","IBTRKR3",84,0)
 I +IBFILL,$P($G(^PSRX(IBRXN,1,IBFILL,0)),"^",16) G RXCHKQ
"RTN","IBTRKR3",85,0)
 ;
"RTN","IBTRKR3",86,0)
 ; -- check drug (not investigational, supply, or over the counter drug
"RTN","IBTRKR3",87,0)
 S IBDRUG=$P(IBRXDATA,"^",6)
"RTN","IBTRKR3",88,0)
 D ZERO^IBRXUTL(IBDRUG)
"RTN","IBTRKR3",89,0)
 S IBDEA=$G(^TMP($J,"IBDRUG",+IBDRUG,3))
"RTN","IBTRKR3",90,0)
 K ^TMP($J,"IBDRUG")
"RTN","IBTRKR3",91,0)
 I IBDEA["I"!(IBDEA["S")!(IBDEA["9") G RXCHKQ ; investigational drug, supply or otc
"RTN","IBTRKR3",92,0)
 ;
"RTN","IBTRKR3",93,0)
 ; -- see if insured for prescriptions
"RTN","IBTRKR3",94,0)
 I '$$PTCOV^IBCNSU3(DFN,IBDT,"PHARMACY",.IBANY) S IBRMARK=$S($G(IBANY):"SERVICE NOT COVERED",1:"NOT INSURED")
"RTN","IBTRKR3",95,0)
 ;
"RTN","IBTRKR3",96,0)
 ; -- check sc status and others
"RTN","IBTRKR3",97,0)
 ; -- new ICD node in PSO with CIDC, if it exists use this for determination
"RTN","IBTRKR3",98,0)
 I $G(IBRMARK)="",$D(^PSRX(IBRXN,"ICD")) D CL^SDCO21(DFN,IBDT,"",.IBARR) I $D(IBARR) D
"RTN","IBTRKR3",99,0)
 . S IBM=0 F  S IBM=$O(^PSRX(IBRXN,"ICD",IBM)) Q:'IBM!($G(IBRMARK)'="")  S IBZ=$G(^PSRX(IBRXN,"ICD",IBM,0)) F IBP=1:1:7 Q:$G(IBRMARK)'=""  I $D(IBARR(IBP)) D
"RTN","IBTRKR3",100,0)
 .. S IBRMARK=$S($P(IBZ,"^",IBP+1):$P($T(EXEMPT+IBP),";",3),$P(IBZ,"^",IBP+1)=0:"",1:"NEEDS SC DETERMINATION")
"RTN","IBTRKR3",101,0)
 ;
"RTN","IBTRKR3",102,0)
 ; -- no new ICD node in PSO, use old method of determining status
"RTN","IBTRKR3",103,0)
 I $G(IBRMARK)="",'$D(^PSRX(IBRXN,"ICD")) D
"RTN","IBTRKR3",104,0)
 . D ELIG^VADPT
"RTN","IBTRKR3",105,0)
 . ;if the patient is covered by insurance for pharmacy ($G(IBRMARK)="")
"RTN","IBTRKR3",106,0)
 . ;AND if no copay in #350
"RTN","IBTRKR3",107,0)
 . ;then we need to determine the non billable reason and set IBRMARK
"RTN","IBTRKR3",108,0)
 . ;
"RTN","IBTRKR3",109,0)
 . ;IF VAEL(3) -- if this is a veteran with SC(service connection) status
"RTN","IBTRKR3",110,0)
 . I VAEL(3),'$G(^PSRX(IBRXN,"IB")) D
"RTN","IBTRKR3",111,0)
 . . I $P(VAEL(3),"^",2)>49 S IBRMARK="NEEDS SC DETERMINATION"
"RTN","IBTRKR3",112,0)
 . . ;in case of POW and Unempl.vet we cannot decide if the 3rd party should be exempt
"RTN","IBTRKR3",113,0)
 . . N IBPOWUNV,IBAUTRET S IBAUTRET=$$AUTOINFO^DGMTCOU1(DFN),IBPOWUNV=$S($P(IBAUTRET,U,8):1,$P(IBAUTRET,U,9):1,1:0)
"RTN","IBTRKR3",114,0)
 . . I $P(VAEL(3),"^",2)<50 S IBRMARK=$S(IBPOWUNV:"NEEDS SC DETERMINATION",1:"SC TREATMENT")
"RTN","IBTRKR3",115,0)
 . . I $$RXST^IBARXEU(DFN,$P(IBRXDATA,U,13))>0 S IBRMARK="NEEDS SC DETERMINATION"
"RTN","IBTRKR3",116,0)
 . ;
"RTN","IBTRKR3",117,0)
 . ;IF +VAEL(3)=0 if the veteran doesn't have SC status, but
"RTN","IBTRKR3",118,0)
 . ;the veteran still may have CV status active
"RTN","IBTRKR3",119,0)
 . I $G(IBRMARK)="",+VAEL(3)=0,'$G(^PSRX(IBRXN,"IB")) D
"RTN","IBTRKR3",120,0)
 . . I $$CVEDT^IBACV(DFN,IBDT) S IBRMARK="NEEDS SC DETERMINATION" ;SC-because IB staff usually is using this reason to search for cases that need to be reviewed. COMBAT VETERAN reason will be used after review if this was a case
"RTN","IBTRKR3",121,0)
 ;
"RTN","IBTRKR3",122,0)
 ;
"RTN","IBTRKR3",123,0)
 ; -- ok to add to tracking module
"RTN","IBTRKR3",124,0)
 D REFILL^IBTUTL1(DFN,IBRXTYP,IBDT,IBRXN,IBFILL,$G(IBRMARK)) I '$D(ZTQUEUED),$G(IBTALK) W "+"
"RTN","IBTRKR3",125,0)
 I $G(IBRMARK)'="" S IBCNT2=IBCNT2+1
"RTN","IBTRKR3",126,0)
 I $G(IBRMARK)="" S IBCNT1=IBCNT1+1
"RTN","IBTRKR3",127,0)
 K IBANY,IBRMARK,VAEL,VA,IBDEA,IBDRUG,IBRXSTAT,IBRXDATA,DFN,X,Y
"RTN","IBTRKR3",128,0)
 K IBARR,IBM,IBZ,IBP
"RTN","IBTRKR3",129,0)
RXCHKQ Q
"RTN","IBTRKR3",130,0)
 ;
"RTN","IBTRKR3",131,0)
EXEMPT ; exemption reasons
"RTN","IBTRKR3",132,0)
 ;;AGENT ORANGE
"RTN","IBTRKR3",133,0)
 ;;IONIZING RADIATION
"RTN","IBTRKR3",134,0)
 ;;SC TREATMENT
"RTN","IBTRKR3",135,0)
 ;;ENV. CONTAM.
"RTN","IBTRKR3",136,0)
 ;;MILITARY SEXUAL TRAUMA
"RTN","IBTRKR3",137,0)
 ;;HEAD/NECK CANCER
"RTN","IBTRKR3",138,0)
 ;;COMBAT VETERAN
"RTN","IBTRKR3",139,0)
 ;;
"VER")
8.0^22.0
"BLD",6573,6)
^302
**END**
**END**
