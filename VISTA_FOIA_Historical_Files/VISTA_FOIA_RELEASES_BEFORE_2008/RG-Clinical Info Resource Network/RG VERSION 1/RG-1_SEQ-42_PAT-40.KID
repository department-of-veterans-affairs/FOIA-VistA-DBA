Released RG*1*40 SEQ #42
Extracted from mail message
**KIDS**:RG*1.0*40^

**INSTALL NAME**
RG*1.0*40
"BLD",2178,0)
RG*1.0*40^CLINICAL INFO RESOURCE NETWORK^0^3060104^y
"BLD",2178,1,0)
^^3^3^3050214^
"BLD",2178,1,1,0)
POPULATING MORE FIELDS IN ZEL SEGMENT
"BLD",2178,1,2,0)
Refer to patch RG*1*40 in the FORUM Patch Module for a complete
"BLD",2178,1,3,0)
description.
"BLD",2178,4,0)
^9.64PA^^
"BLD",2178,"ABNS",0)
^9.66A^^
"BLD",2178,"ABPKG")
n^n^
"BLD",2178,"KRN",0)
^9.67PA^8989.52^19
"BLD",2178,"KRN",.4,0)
.4
"BLD",2178,"KRN",.401,0)
.401
"BLD",2178,"KRN",.402,0)
.402
"BLD",2178,"KRN",.403,0)
.403
"BLD",2178,"KRN",.5,0)
.5
"BLD",2178,"KRN",.84,0)
.84
"BLD",2178,"KRN",3.6,0)
3.6
"BLD",2178,"KRN",3.8,0)
3.8
"BLD",2178,"KRN",9.2,0)
9.2
"BLD",2178,"KRN",9.8,0)
9.8
"BLD",2178,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",2178,"KRN",9.8,"NM",1,0)
RGADTP^^0^B52218482
"BLD",2178,"KRN",9.8,"NM","B","RGADTP",1)

"BLD",2178,"KRN",19,0)
19
"BLD",2178,"KRN",19.1,0)
19.1
"BLD",2178,"KRN",101,0)
101
"BLD",2178,"KRN",409.61,0)
409.61
"BLD",2178,"KRN",771,0)
771
"BLD",2178,"KRN",870,0)
870
"BLD",2178,"KRN",8989.51,0)
8989.51
"BLD",2178,"KRN",8989.52,0)
8989.52
"BLD",2178,"KRN",8994,0)
8994
"BLD",2178,"KRN","B",.4,.4)

"BLD",2178,"KRN","B",.401,.401)

"BLD",2178,"KRN","B",.402,.402)

"BLD",2178,"KRN","B",.403,.403)

"BLD",2178,"KRN","B",.5,.5)

"BLD",2178,"KRN","B",.84,.84)

"BLD",2178,"KRN","B",3.6,3.6)

"BLD",2178,"KRN","B",3.8,3.8)

"BLD",2178,"KRN","B",9.2,9.2)

"BLD",2178,"KRN","B",9.8,9.8)

"BLD",2178,"KRN","B",19,19)

"BLD",2178,"KRN","B",19.1,19.1)

"BLD",2178,"KRN","B",101,101)

"BLD",2178,"KRN","B",409.61,409.61)

"BLD",2178,"KRN","B",771,771)

"BLD",2178,"KRN","B",870,870)

"BLD",2178,"KRN","B",8989.51,8989.51)

"BLD",2178,"KRN","B",8989.52,8989.52)

"BLD",2178,"KRN","B",8994,8994)

"BLD",2178,"QUES",0)
^9.62^^
"BLD",2178,"REQB",0)
^9.611^1^1
"BLD",2178,"REQB",1,0)
RG*1.0*35^1
"BLD",2178,"REQB","B","RG*1.0*35",1)

"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
40^3060104
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3060104
"PKG",272,22,1,"PAH",1,1,1,0)
POPULATING MORE FIELDS IN ZEL SEGMENT
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*40 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","RGADTP")
0^1^B52218482
"RTN","RGADTP",1,0)
RGADTP ;BIR/DLR-ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS ;5/28/02
"RTN","RGADTP",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**26,27,20,34,35,40**;30 Apr 99
"RTN","RGADTP",3,0)
 ;
"RTN","RGADTP",4,0)
 ;Reference to BLDEVN^VAFCQRY and BLDPID^VAFCQRY supported by IA #3630
"RTN","RGADTP",5,0)
 ;Reference to EN1^VAFHLZEL is supported by IA #752
"RTN","RGADTP",6,0)
 ;
"RTN","RGADTP",7,0)
INIT ;
"RTN","RGADTP",8,0)
 N RGER,RGSITE,ARRAY,MSH,RGLOCAL,RGEVNT,REP,DIC,DR,DIE,DA,DLAYGO
"RTN","RGADTP",9,0)
 S RGER=""
"RTN","RGADTP",10,0)
 D IN
"RTN","RGADTP",11,0)
 D PROCIN
"RTN","RGADTP",12,0)
 D GENACK
"RTN","RGADTP",13,0)
 Q
"RTN","RGADTP",14,0)
PROC ;processing entry point
"RTN","RGADTP",15,0)
 N HLA,RGADT,PV1,DIC,ARRAY,RGEVNT,RGLOCAL,REP,ICN,RGSITE
"RTN","RGADTP",16,0)
 S RGEVNT=HL("ETN")
"RTN","RGADTP",17,0)
 I $G(HL("MID"))'="" S RGADT=HL("MID")
"RTN","RGADTP",18,0)
 I $G(HL("MID"))="" S RGADT=999
"RTN","RGADTP",19,0)
 D IN
"RTN","RGADTP",20,0)
 ;**35 removed reference to stop process if patient is "test" pt
"RTN","RGADTP",21,0)
 S ICN=$G(ARRAY("ICN"))
"RTN","RGADTP",22,0)
 ;S ICN=$$GETICN^MPIF001(DFN)
"RTN","RGADTP",23,0)
 I +$G(ICN)<1 Q  ;quit if no ICN
"RTN","RGADTP",24,0)
 I $E($G(ICN),1,3)=$P($$SITE^VASITE,"^",3) Q  ;quit if ICN is a local
"RTN","RGADTP",25,0)
 S ZTSAVE("DFN")="",ZTSAVE("RGEVNT")="",ZTSAVE("HLA(""HLS"",")="",ZTRTN="SEND^RGADTPC",ZTDESC="Sending HL7 Patient Update...",ZTIO="RG QUEUE",ZTDTH=$H D ^%ZTLOAD
"RTN","RGADTP",26,0)
 K ZTSAVE,ZTRTN,ZTDESC,ZTIO,ZTDTH
"RTN","RGADTP",27,0)
 Q
"RTN","RGADTP",28,0)
IN ;Process in the ADT A04/A08 (routing logic)
"RTN","RGADTP",29,0)
 N RGI,MSG,RG,SG,DFN,EVN,SITE,RGC,RGJ,DIC,PV1,PID,COMP
"RTN","RGADTP",30,0)
 ;set local flag to indicate the processing of an outbound for reformatting
"RTN","RGADTP",31,0)
 S REP=$E(HL("ECH"),2)
"RTN","RGADTP",32,0)
 S COMP=$E(HL("ECH"),1)
"RTN","RGADTP",33,0)
 I $P($G(HL("SAF")),COMP)=$P($$SITE^VASITE,"^",3) S RGLOCAL=1
"RTN","RGADTP",34,0)
 I $P($G(HL("SAF")),COMP)'=$P($$SITE^VASITE,"^",3) S RGLOCAL=0
"RTN","RGADTP",35,0)
 S RGC=$E($G(HL("ECH")),1)
"RTN","RGADTP",36,0)
 F RGI=1:1 X HLNEXT Q:HLQUIT'>0  S MSG=HLNODE,SG=$E(HLNODE,1,3) D
"RTN","RGADTP",37,0)
 . S RGJ=0 F  S RGJ=$O(HLNODE(RGJ)) Q:'RGJ  S MSG(RGJ)=HLNODE(RGJ)
"RTN","RGADTP",38,0)
 . D:SG?2A1(1A,1N) PICK
"RTN","RGADTP",39,0)
 ;if message MSH sending facility matches the PID assigning authority update
"RTN","RGADTP",40,0)
QUIT Q
"RTN","RGADTP",41,0)
ROUTE ;
"RTN","RGADTP",42,0)
 N RGERR
"RTN","RGADTP",43,0)
 I $G(RGEVNT)="" S RGEVNT=$G(HL("ETN"))
"RTN","RGADTP",44,0)
 N MPI S MPI=$$MPILINK^MPIFAPI() D
"RTN","RGADTP",45,0)
 . I $P($G(MPI),U)'=-1 S HLL("LINKS",1)="RG ADT-"_HL("ETN")_" 2.4 CLIENT^"_MPI
"RTN","RGADTP",46,0)
 . I $P($G(MPI),U)=-1 D
"RTN","RGADTP",47,0)
 .. N RGLOG,RGMTXT
"RTN","RGADTP",48,0)
 .. D START^RGHLLOG(HLMTIEN,"","")
"RTN","RGADTP",49,0)
 .. S RGMTXT="for DFN#"_$G(DFN)
"RTN","RGADTP",50,0)
 .. D EXC^RGHLLOG(224,"No MPI link identified"_RGMTXT,$G(DFN)) S RGERR=1
"RTN","RGADTP",51,0)
 I $G(RGERR)'=1 S ^XTMP("RG"_HL("ETN")_"%"_DFN,0)=$$FMADD^XLFDT(DT,5)_"^"_DT_"^"_"RG"_HL("ETN")_" msg to MPI for DFN "_DFN S ^XTMP("RG"_HL("ETN")_"%"_DFN,"MPI",0)="A"
"RTN","RGADTP",52,0)
 Q
"RTN","RGADTP",53,0)
RESP ;
"RTN","RGADTP",54,0)
 N RGER,RGSITE,ARRAY,MSH,RGLOCAL,RGEVNT
"RTN","RGADTP",55,0)
 N RGI,MSG,RG,SG,DFN,EVN,SITE,RGC,RGJ,DIC,PV1,PID
"RTN","RGADTP",56,0)
 D IN
"RTN","RGADTP",57,0)
 Q
"RTN","RGADTP",58,0)
PICK ;check routine for segment entry point
"RTN","RGADTP",59,0)
 I $T(@SG)]"" D @SG
"RTN","RGADTP",60,0)
 I $T(@SG)="" Q
"RTN","RGADTP",61,0)
 Q
"RTN","RGADTP",62,0)
MSA ;;
"RTN","RGADTP",63,0)
 ;process the MSA segment
"RTN","RGADTP",64,0)
 N ARRAY,CNT,DFN,EXIT,HLCOMP,RGAA,RGERR,RGEVNT,RGMSG,RETURN,RGX,RGY
"RTN","RGADTP",65,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",66,0)
 S RGAA=MSG
"RTN","RGADTP",67,0)
 S EXIT=0
"RTN","RGADTP",68,0)
 S RGMSG=$P(RGAA,HL("FS"),3)
"RTN","RGADTP",69,0)
 S RGERR=$P(RGAA,HL("FS"),4)
"RTN","RGADTP",70,0)
 S RGMSG=$$MSG^HLCSUTL(RGMSG,"RETURN(1)")
"RTN","RGADTP",71,0)
 K RGMSG
"RTN","RGADTP",72,0)
 S CNT=1,RGX=0 F  S RGX=$O(RETURN(1,RGX)) Q:'RGX!(EXIT=1)  D
"RTN","RGADTP",73,0)
 . I RETURN(1,RGX)'="" D
"RTN","RGADTP",74,0)
 .. I $D(RGMSG) S RGMSG(CNT)=RETURN(1,RGX),CNT=CNT+1
"RTN","RGADTP",75,0)
 .. I '$D(RGMSG) S RGMSG=RETURN(1,RGX),RGY=RGX
"RTN","RGADTP",76,0)
 . I RETURN(1,RGX)="" D  S CNT=1 K RGMSG
"RTN","RGADTP",77,0)
 .. I $E(RETURN(1,RGY),1,3)="MSH" D MSH
"RTN","RGADTP",78,0)
 .. I $E(RETURN(1,RGY),1,3)="PID" D PIDP^RGADTP1(.RGMSG,.ARRAY,.HL) S EXIT=1
"RTN","RGADTP",79,0)
 S DFN=$G(ARRAY("DFN"))
"RTN","RGADTP",80,0)
 I $D(^XTMP("RG"_HL("ETN")_"%"_DFN,0)) K ^XTMP("RG"_HL("ETN")_"%"_DFN)
"RTN","RGADTP",81,0)
 Q
"RTN","RGADTP",82,0)
MSH ;;
"RTN","RGADTP",83,0)
 S MSH=1
"RTN","RGADTP",84,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",85,0)
 I 'RGLOCAL S RGC=$E(HL("ECH"),1)
"RTN","RGADTP",86,0)
 S RGSITE=$P($P(MSG,HL("FS"),4),RGC)
"RTN","RGADTP",87,0)
 S RGEVNT=$P($P(MSG,HL("FS"),9),RGC,2)
"RTN","RGADTP",88,0)
 Q
"RTN","RGADTP",89,0)
EVN ;;
"RTN","RGADTP",90,0)
 N CNT,ERR
"RTN","RGADTP",91,0)
 S EVN=RGI
"RTN","RGADTP",92,0)
 I RGLOCAL S (EVN(1),HLA("HLS",RGI))=MSG
"RTN","RGADTP",93,0)
 I 'RGLOCAL D
"RTN","RGADTP",94,0)
 .S ARRAY("EVR")=$P(MSG,HL("FS"),2)
"RTN","RGADTP",95,0)
 .S ARRAY("DLT")=$$FMDATE^HLFNC($P(MSG,HL("FS"),3))
"RTN","RGADTP",96,0)
 .S ARRAY("EVNAME")=$$FMNAME^XLFNAME($P(MSG,HL("FS"),2),"",$E(HL("ECH"),1))
"RTN","RGADTP",97,0)
 .S ARRAY("SENDING SITE")=$P(MSG,HL("FS"),8)
"RTN","RGADTP",98,0)
 Q
"RTN","RGADTP",99,0)
EVNP ;
"RTN","RGADTP",100,0)
 N EVNX
"RTN","RGADTP",101,0)
 I $G(DFN)'="" D BLDEVN^VAFCQRY(DFN,"1,2,4,5,6,7",.EVN,.HL,$G(HL("ETN")),.ERR) S CNT=0,EVNX=0 F  S EVNX=$O(EVN(EVNX)) Q:'EVNX  D
"RTN","RGADTP",102,0)
 . I CNT>0 S HLA("HLS",EVN,CNT)=EVN(EVNX),CNT=CNT+1
"RTN","RGADTP",103,0)
 . I CNT'>0 S HLA("HLS",EVN)=EVN(EVNX),CNT=CNT+1
"RTN","RGADTP",104,0)
 Q
"RTN","RGADTP",105,0)
PID ;;
"RTN","RGADTP",106,0)
 N CNT,PIDX
"RTN","RGADTP",107,0)
 I RGLOCAL D
"RTN","RGADTP",108,0)
 .N HLCOMP S HLCOMP=$E(HL("ECH"),1)
"RTN","RGADTP",109,0)
 .S HLA("HLS",RGI)=MSG
"RTN","RGADTP",110,0)
 .S DFN=+$P(MSG,HL("FS"),4)
"RTN","RGADTP",111,0)
 .D EVNP
"RTN","RGADTP",112,0)
 .D BLDPID^VAFCQRY(DFN,1,"ALL",.PID,.HL)
"RTN","RGADTP",113,0)
 .;get Primary ICN value in the PID segment
"RTN","RGADTP",114,0)
 .S ARRAY("ICN")=+$P($P(PID(1),HL("FS"),4),HLCOMP)
"RTN","RGADTP",115,0)
 .S CNT=0,PIDX=0 F  S PIDX=$O(PID(PIDX)) Q:'PIDX  D
"RTN","RGADTP",116,0)
 .. I CNT>0 S HLA("HLS",RGI,CNT)=PID(PIDX),CNT=CNT+1
"RTN","RGADTP",117,0)
 .. I CNT'>0 S HLA("HLS",RGI)=PID(PIDX),CNT=CNT+1
"RTN","RGADTP",118,0)
 I 'RGLOCAL D PIDP^RGADTP1(.MSG,.ARRAY,.HL)
"RTN","RGADTP",119,0)
 Q
"RTN","RGADTP",120,0)
PD1 ;;
"RTN","RGADTP",121,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",122,0)
 I 'RGLOCAL S (ARRAY(991.03),ARRAY("CMOR"))=$P($P(MSG,HL("FS"),4),RGC)
"RTN","RGADTP",123,0)
 Q
"RTN","RGADTP",124,0)
PV1 ;;
"RTN","RGADTP",125,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",126,0)
 Q
"RTN","RGADTP",127,0)
OBX ;;
"RTN","RGADTP",128,0)
 N COMP S COMP=$E(HL("ECH"),1)
"RTN","RGADTP",129,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",130,0)
 I 'RGLOCAL D:$$FREE^RGRSPARS($P($P(MSG,HL("FS"),4),RGC,2))="SECURITY LEVEL"
"RTN","RGADTP",131,0)
 . S ARRAY("SENSITIVITY")=$$SENSTIVE^RGRSPARS($P(MSG,HL("FS"),6),COMP)
"RTN","RGADTP",132,0)
 . S ARRAY("SENSITIVITY USER")=$$FREE^RGRSPARS($P($P(MSG,HL("FS"),17),RGC,2))_","_$$FREE^RGRSPARS($P($P(MSG,HL("FS"),17),RGC,3))
"RTN","RGADTP",133,0)
 . S ARRAY("SENSITIVITY DATE")=$$FREE^RGRSPARS($$FMDATE^HLFNC($P(MSG,HL("FS"),15)))
"RTN","RGADTP",134,0)
 Q
"RTN","RGADTP",135,0)
ZPD ;;
"RTN","RGADTP",136,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",137,0)
 ;I 'RGLOCAL S ARRAY(.351)=$$FREE^RGRSPARS($P(MSG,HL("FS"),5))
"RTN","RGADTP",138,0)
 Q
"RTN","RGADTP",139,0)
ZSP ;;
"RTN","RGADTP",140,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",141,0)
 I 'RGLOCAL D
"RTN","RGADTP",142,0)
 . S ARRAY(.301)=$$YESNO^RGRSPARS($P(MSG,HL("FS"),3))
"RTN","RGADTP",143,0)
 . S ARRAY(.302)=$$FREE^RGRSPARS($P(MSG,HL("FS"),4))
"RTN","RGADTP",144,0)
 . S ARRAY(.323)=$$POS^RGRSPARS($P(MSG,HL("FS"),5))
"RTN","RGADTP",145,0)
 Q
"RTN","RGADTP",146,0)
ZEL ;;
"RTN","RGADTP",147,0)
 I RGLOCAL D
"RTN","RGADTP",148,0)
 .;**40 to rebuild ZEL segment
"RTN","RGADTP",149,0)
 .I '$D(DFN) S HLA("HLS",RGI)=MSG Q
"RTN","RGADTP",150,0)
 .; ^ if don't know DFN pass back original ZEL segment
"RTN","RGADTP",151,0)
 .N VAFZEL
"RTN","RGADTP",152,0)
 .D EN1^VAFHLZEL(DFN,"1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22",2,.VAFZEL) ;build a complete ZEL segment
"RTN","RGADTP",153,0)
 .;need to take into account may be more than 1 array entry and that each entry could go over 245 so there would be another subscript
"RTN","RGADTP",154,0)
 .N CNT,ZELX
"RTN","RGADTP",155,0)
 .S (CNT,ZELX)=0 F  S ZELX=$O(VAFZEL(ZELX)) Q:'ZELX  D
"RTN","RGADTP",156,0)
 ..I CNT>0 S HLA("HLS",RGI,CNT)=VAFZEL(ZELX),CNT=CNT+1
"RTN","RGADTP",157,0)
 ..I CNT'>0 S HLA("HLS",RGI)=VAFZEL(ZELX),RGI=RGI+2
"RTN","RGADTP",158,0)
 .S RGI=RGI-2 ;reset to not end up wih 2 "" entries before next segment
"RTN","RGADTP",159,0)
 I 'RGLOCAL D
"RTN","RGADTP",160,0)
 . S ARRAY(.361)=$$ELIG^RGRSPARS($P(MSG,HL("FS"),3))
"RTN","RGADTP",161,0)
 . S ARRAY(.3612)=$$FREE^RGRSPARS($P(MSG,HL("FS"),12))
"RTN","RGADTP",162,0)
 . S ARRAY(.3615)=$$FREE^RGRSPARS($P(MSG,HL("FS"),14))
"RTN","RGADTP",163,0)
 . S ARRAY(391)=$$TYPE^RGRSPARS($P(MSG,HL("FS"),10))
"RTN","RGADTP",164,0)
 . S ARRAY(1901)=$$VETERAN^RGRSPARS($P(MSG,HL("FS"),9))
"RTN","RGADTP",165,0)
 Q
"RTN","RGADTP",166,0)
ZCT ;;
"RTN","RGADTP",167,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",168,0)
 I 'RGLOCAL D
"RTN","RGADTP",169,0)
 . S ARRAY(.211)=$$FREE^RGRSPARS($P(MSG,HL("FS"),4))
"RTN","RGADTP",170,0)
 . S ARRAY(.219)=$$FREE^RGRSPARS($P(MSG,HL("FS"),7))
"RTN","RGADTP",171,0)
 Q
"RTN","RGADTP",172,0)
ZEM ;;
"RTN","RGADTP",173,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",174,0)
 I 'RGLOCAL D
"RTN","RGADTP",175,0)
 . S ARRAY(.31115)=$$EMP^RGRSPARS($P(MSG,HL("FS"),4))
"RTN","RGADTP",176,0)
 Q
"RTN","RGADTP",177,0)
ZFF ;;
"RTN","RGADTP",178,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",179,0)
 I 'RGLOCAL S ARRAY("FLD")=$P(MSG,HL("FS"),3)
"RTN","RGADTP",180,0)
 Q
"RTN","RGADTP",181,0)
PROCIN ;
"RTN","RGADTP",182,0)
 D PROCIN^RGADTP2(.ARRAY,.RGLOCAL,.RGER,.DFN,.HL)
"RTN","RGADTP",183,0)
 Q
"RTN","RGADTP",184,0)
GENACK ;
"RTN","RGADTP",185,0)
 N RGCNT,IEN,RG
"RTN","RGADTP",186,0)
 I $G(ARRAY("DFN"))'>0 S RGER="-1^Unknown ICN#"_$G(ARRAY("ICN"))_" and SSN#"_$G(ARRAY(.09))
"RTN","RGADTP",187,0)
 S RGCNT=1
"RTN","RGADTP",188,0)
 S HLA("HLA",RGCNT)="MSA"_HL("FS")_"AA"_HL("FS")_HL("MID")_HL("FS")_$S(+$G(RGER)<0:$P(RGER,"^",2,3),1:""),RGCNT=RGCNT+1
"RTN","RGADTP",189,0)
 S RGSITE=$$LKUP^XUAF4(RGSITE)
"RTN","RGADTP",190,0)
 D LINK^HLUTIL3(RGSITE,.RG) S IEN=$O(RG(0)) S HLL("LINKS",1)="^"_RG(IEN)
"RTN","RGADTP",191,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"LM",1,.HLRESLTA,"",.HL)
"RTN","RGADTP",192,0)
 K HLA
"RTN","RGADTP",193,0)
 Q
"RTN","RGADTP",194,0)
RSP ;
"RTN","RGADTP",195,0)
 Q
"VER")
8.0^22.0
"BLD",2178,6)
^42
**END**
**END**
