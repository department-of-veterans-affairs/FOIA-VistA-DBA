$TXT Created by MCCLENAHAN,MARGARET E E at DEVCUR.FO-SLC.MED.VA.GOV  (KIDS) on Tuesday, 01/04/05 at 15:45
=============================================================================
Run Date: JUL 21, 2005                     Designation: TIU*1*182
Package : TIU - TEXT INTEGRATION UTILITIES    Priority: Mandatory
Version : 1       SEQ #182                      Status: Released
                  Compliance Date: AUG 21, 2005
=============================================================================

Associated patches: (v)TIU*1*109   <<= must be installed BEFORE `TIU*1*182'
                    (v)TIU*1*112   <<= must be installed BEFORE `TIU*1*182'
                    (v)TIU*1*121   <<= must be installed BEFORE `TIU*1*182'
                    (v)TIU*1*157   <<= must be installed BEFORE `TIU*1*182'
                    (v)TIU*1*175   <<= must be installed BEFORE `TIU*1*182'
                    (v)TIU*1*176   <<= must be installed BEFORE `TIU*1*182'

Subject: CP/MEDICINE CONVERSION - DDEFS, FIXES

Category: 
  - Routine
  - Other
  - Data Dictionary

Description:
============

  
 I. DESCRIPTION:
    ============
  
               ****** Important Note ********
 Although this patch was written for the Medicine Package Conversion, it
 contains fixes and changes which apply to all types of documents. The
 patch MUST BE INSTALLED by ALL sites, not just sites doing the conversion.
              ********************************
  
 This patch supports the Medicine Conversion patch, MD*1*5, Medicine 
 Report Conversion. The Clinical Procedure/Medicine Conversion
 requires a new Historical Procedures (HP) document class and new titles
 for converting existing Medicine Reports to TIU documents under class
 Clinical Procedures (CP). This patch contains an option which creates the
 new document class and titles.  Sites not doing the conversion need not
 run this option.
  
 Converted Medicine Reports are non-standard CP documents.  They may
 lack Consult Requests (new CP documents ARE linked to requests) and may
 lack other fields as well. This patch contains fixes required to handle
 these unique characteristics.  Since some of these fixes apply to all
 types of documents, the patch MUST BE INSTALLED by all sites, not just
 sites doing the conversion.
  
 New functionality:
 ==================
 A new module determines whether or not a given title is a HP.  The 
 Medicine Conversion uses this module to limit title selection when
 converting Medicine Reports.
  
 Remedy Tickets, NOIS, and E3RS:
 ===============================
 Most problems fixed in this patch were discovered by developers testing
 the use of HP documents.  The patch does fix the following Remedy Tickets:
 ID HD0000000007094 RIC-0804-21493 PRINT+40^TIUPRPN1 error
 ID HD0000000007070 HUN-0404-22031 PRINT+40^TIUPRPN1 error
 ID HD0000000006977 SBY-0602-31937 PRINT+40^TIUPRPN1 undefined variable 
                      TIUMISC
 The following NOIS is also fixed by this patch.  There is no 
 corresponding Remedy Ticket since the NOIS was closed long ago.
 NOL-0199-72134   undef PRINT+23^TIUPRPN1:2 
  
 There are no known E3RS for this patch.
  
  
  
 Problems:
 ========= 
 1. When a Historical Procedure document is printed from List Manager (LM)
 options, a null subscript error occurs. (Problem occurs for any document
 whose title lacks certain Print Fields such as Print Group and which uses
 the Progress Notes Print Method.)
  
 Solution: Documents now print without error. 
  
 2. If an administratively closed document is selected for printing, the
 printout contains the warning:
 **DRAFT COPY - DRAFT COPY -- ABOVE NOTE IS UNSIGNED-- DRAFT COPY - DRAFT 
 COPY**
  
 Solution: Warning no longer appears.
  
 3. If an unsigned document is printed, the printout includes a "for" block,
 as if the note had been signed by someone other than the 
 author:
  
                                   for MCCLENAHAN,MARGARET E
                                   MARGARET A. MCCLENAHAN
  
 Solution: "For" block no longer appears.
  
 4. If several documents are selected for printing in LM options and one of
 them (not the last one) is a HP without a Request, then that document and all
 selected documents following it are printed as Progress Notes, even if some
 are Consults.
  
 Solution: Documents now print correctly according to their document type.
  
 5. In LM options, if two consult documents for the same request are selected
 and printed, then that request prints twice, along with all of its
 documents.
  
 Solution: The request now prints only once.
  
 6. User is permitted to make an addendum to an HP.  This is not 
 appropriate since these documents are auto-generated from a previous 
 package.
  
 Solution: Code now prevents addending an HP.
  
 7. User is permitted to identify signers for an HP, which is not
 appropriate since these documents are auto-generated from a previous 
 package.
  
 Solution: Code now prevents identifying signers for an HP.
  
 8. User is permitted to change the title of an HP to a non-HP 
 title (which requires a consult).
  
 Solution: Code now prevents changing the title of an HP.
  
 9. User is permitted to reassign an HP to a different
 patient/visit. This creates new unsigned documents for which no signer may
 be available if the document was written some time ago.
  
 Solution: Code now prevents reassigning an HP. 
  
 10. User is permitted to link an HP to a request, which is not 
 appropriate since HP documents may not have procedure requests to link to.
  
 Solution: Code now prevents linking an HP to a request.
  
 11. User is allowed to verify/unverify an administratively closed
 document.
  
 Solution: User is no longer permitted to verify/unverify an
 administratively closed document.  The following message is displayed:
    This [HISTORICAL PROCEDURE] is already closed.
  
 12. In certain cases, LM action Print does not handle documents lacking a 
 Print Method and generates an error.
  
 Solution: Action quits without attempting to print the document and
 displays an explanatory message.
  
 13. Message says status is INCOMPLETE when reassigning an administratively
 closed (i.e., completed) document.
  
 Solution: Message now says COMPLETED.
  
 14. Several Print Fields for class Clinical Procedures are not
 appropriate.
  
 Solution: A Post-Install routine changes the CP Print Form Header from
 "Progress Notes" to "Clinical Procedures". Print Form Number "Vice SF
 509" is deleted.
  
 15. If a document is printed but is then deleted while printing, an 
 Undefined error occurs: ^TIU(8925,IEN,0) is undefined at PRINTN+8^TIURA.
  
 Solution: User now receives message:
         Item #[whatever] no longer exists.
  
 16. If a document is printed from the CPRS GUI but is then deleted while
 printing, an error sometimes occurs, with TIUMISC undefined.
  
 Solution: TIUMISC is no longer undefined.
  
 II. TECHNICAL COMPONENTS:
     =====================
  
 File ^TIU(8925.1, TIU DOCUMENT DEFINITION:
 ==========================================
  
 1. If the site has Medicine Reports to convert to TIU documents, the site 
 should run option Create DDEFS for Med Conversion [TIU182 DDEFS, MED
 CONVERSION] after installing patch TIU*1*182 and PRIOR to running the 
 conversion.
  
 The option creates 1 new document class named Historical Procedures, and
 12 new HP titles.  They are created under class Clinical Procedures, with
 the following hierarchical structure:
  
 CLINICAL PROCEDURES                                          CL
   HISTORICAL PROCEDURES                                      DC
     HISTORICAL CARDIAC CATHETERIZATION PROCEDURE             TL
     HISTORICAL ECHOCARDIOGRAM PROCEDURE                      TL
     HISTORICAL ELECTROCARDIOGRAM PROCEDURE                   TL
     HISTORICAL ELECTROPHYSIOLOGY PROCEDURE                   TL
     HISTORICAL ENDOSCOPIC PROCEDURE                          TL
     HISTORICAL EXERCISE TOLERANCE TEST PROCEDURE             TL
     HISTORICAL HEMATOLOGY PROCEDURE                          TL
     HISTORICAL HOLTER PROCEDURE                              TL
     HISTORICAL PACEMAKER IMPLANTATION PROCEDURE              TL
     HISTORICAL PRE/POST SURGERY RISK NOTE                    TL
     HISTORICAL PULMONARY FUNCTION TEST PROCEDURE             TL
     HISTORICAL RHEUMATOLOGY PROCEDURE                        TL
  
 The document class and the titles are NATIONAL STANDARD.  The document
 class is created with status ACTIVE. The titles are created with status
 INACTIVE.  The status of these titles MUST REMAIN inactive in order to 
 prevent users from entering notes on these titles.  All notes on these 
 titles are auto-generated by the Medicine Conversion.
  
    Note on Generalized Procedures and Non-Endoscopic Procedures
 These two Medicine Modules are site-specific, and this patch does not 
 export titles to be used for converting these procedures. Sites should 
 create their own titles for these procedures as necessary.  The titles 
 must be in the Historical Procedure Document Class.  They must follow the 
 pattern of the exported titles, with "HISTORICAL" at the beginning and
 with "PROCEDURE" at the end.
  
 File ^TIU(8925, TIU DOCUMENT:
 =============================
 This change is only incidentally related to the Medicine Conversion:
 A new value, 'Machine Resulted' has been added to the Set of Codes for 
 field PROCEDURE SUMMARY CODE [#70201] in the TIU DOCUMENT file.
  
 This new code will be entered as a default value when a stub CP document
 is created by CP. Essentially, this makes it optional to enter Normal,
 Abnormal, or Borderline when interpreting the document, easing the burden 
 on high-volume sites.
  
 8925,70201    PROCEDURE SUMMARY CODE 702;1 SET
  
                                 '1' FOR Normal; 
                                 '2' FOR Abnormal; 
                                 '3' FOR Borderline; 
                                 '4' FOR Incomplete; 
                                 '5' FOR Machine Resulted; 
               HELP-PROMPT:      Indicate the summary code for this 
                                 procedure once it is complete.
               DESCRIPTION:      This field contains the summary code for 
                                 this procedure once it is complete.
                                 'Machine Resulted' is the initial,
                                 default code.
  
  
  ROUTINE SUMMARY:                                                  
  ================
  The following is a list of the routine(s) included in this patch.  The
  second line of each of these routine(s) will look like:
  
  <tab>;;1.0;Text Integration Utilities;**[patch list]**;Jun 20, 1997
  
                             CHECK^XTSUMBLD results
  Routine name  Before Patch   After Patch          Patch List
  ============  ============   ===========          ==========
  TIU182D              N/A       2787654             182
  TIU182D1             N/A       2299421             182
  TIU182DF             N/A      15338825            182
  TIUCP             379387       2477243           109,182
  TIUEN182             N/A      14965979             182
  TIUEPRNT         2763939       2291226        20,100,182
  TIULC            9482922       9594102    3,9,19,23,53,93,109,182
  TIULP           12490902      12967495 98,100,116,109,138,152,175,157,182
  TIUPD            7891780       7607443         7,89,100,182
  TIUPRCN          2234569       3775987            4,182
  TIUPRD           4677514       5450576       1,100,121,182
  TIUPRDS          2346057       2393121             182
  TIUPRPN1        10857319      12301238    45,52,87,100,162,182
  TIUPRPN8        10821573      11019005         100,176,157,182
  TIUPS182             N/A       1468325             182
  TIURA           12885891      13738314 1,10,20,79,88,58,100,109,182
  TIURA2           8344398       8385491     88,58,100,123,112,182
  TIURC            6600177       6887310  1,4,36,48,67,79,58,100,182
  
  
 OPTIONS:
 ========
 This patch exports option Create DDEFS for Med Conversion [TIU182 DDEFS,
 MED CONVERSION] It is this option, not the patch itself, which creates the
 new standard TIU Document Definitions.
  
 The option creates global ^XTMP("TIU1182") to track which DDEFS it has
 created. The global is small. When the option is run, the deletion date
 for the global is set to 2 years from the date the option is run. The
 global is automatically deleted according to its deletion date by Option
 Clean old Job Nodes in XUTL [XQ XUTL $J NODES].
  
 For more information on this option, see Section V, POST-INSTALLATION 
 INSTRUCTIONS, below.
  
  
 III. INTERFACES AND DEPENDENCIES:
      ===========================
 Although this patch was written for the Medicine Package Conversion, it
 contains fixes and changes which apply to all types of documents. The
 patch MUST BE INSTALLED by all sites, not just sites with Medicine 
 Reports to convert.
  
 This patch contains an option which creates a new TIU document class and
 new titles for converted Medicine Reports. Sites which do not have 
 Medicine Reports to convert need NOT run this option.
  
 Sites with Medicine Reports to convert should examine Business Rules 
 after running the option but before running the conversion.  See section
 VII., BUSINESS RULES.
  
 The Medicine Conversion Patch MD*1*5 requires this patch.  The new
 document definitions created by the option in this patch must be in place
 BEFORE running the conversion.
  
  
 IV. DOCUMENTATION RETRIEVAL:
     ========================
         
 The TIU User Manual has been updated to include the new HP document class 
 and titles.
  
 It is available in the form of a (.PDF) file, as follows:
  
    TIUUM.PDF       TIU User Manual
  
 This file can be retrieved in BINARY format by FTP. The preferred method
 is to FTP the file from
  
     download.vista.med.va.gov    
  
 which will transmit the file from the first available FTP server.
  
 The file may also be downloaded directly from a particular FTP location
 at the following locations.
  
         Albany                  ftp.fo-albany.med.va.gov
         Hines                   ftp.fo-hines.med.va.gov
         Salt Lake City          ftp.fo-slc.med.va.gov
  
  The file is available in the ANONYMOUS.SOFTWARE directory.
  
 TIU documentation for this patch can also be found using the following
 Web address:
  
    http://vista.med.va.gov/tiu/html/documentation.html
  
  
 V. INSTALLATION INSTRUCTIONS:
    ==========================
  
  Installation of this patch will take less than 2 minutes. Users need not
  be off the system when applying this patch, but it should be installed 
  during non-peak hours to minimize disruption to users.
  
  
  1. Use the LOAD A DISTRIBUTION OPTION on the KIDS INSTALLATION Menu, and 
     enter TIU*1.0*182.
  
     The environment check looks for user class CLINICAL COORDINATOR.
     This user class was exported with the original release of TIU, and TIU
     expects to find it there.  Ownership of the new Document Definitions
     is assigned to this user class.
  
     The environment check also looks for DDEF class CLINICAL PROCEDURES.
     This DDEF was exported with patch TIU*1*109, which this patch 
     requires.
  
     If the environment check fails to find these elements, it will post a
     warning. Although the patch will go ahead and install, the option to
     create the DDEFS will not run until the elements are present.
  
     Since some sites may already have Document Definitions with the same
     names as those created by this patch, the environment check also
     checks for potential duplicates to prevent possible overwriting of
     existing entries.
  
     If the site already has Document Definitions with names matching the
     13 DDEFS exported in this patch, the environment check will display
     the matches, with a dialogue similar to the following:
  
                         ------------------- 
 Want to Continue with Load? YES// 
 Loading Distribution...
  
    TIU*1.0*182
 Will first run the Environment Check Routine, TIUEN182
  
 Checking for potential duplicate Document Definitions...
 You already have the following Document Definitions exported by this 
 patch. I don't want to overwrite them. Please change their names so they
 no longer match the exported ones, or if you are not using them, delete
 them. If you change the name of a Document Definition you plan to continue
 using, remember to update its Print Name, as well. For help, contact
 Enterprise VistA Support.
  
 You will not be able to run option TIU182 DDEFS, MED CONVERSION to create 
 the DDEFS until these matches are eliminated.
     HISTORICAL EXERCISE TOLERANCE TEST PROCEDURE
     HISTORICAL HEMATOLOGY PROCEDURE     
                        -------------------
  
     If the environment check finds matches and your site plans to run 
     the option and use the new DDEFS, please follow instructions in the
     above dialogue.  Although the patch will go ahead and install, the
     option to create the DDEFS will not run until matches are changed or
     deleted.
  
     If there are no matches, or if matching entries were created by a 
     previous install of this patch and can be ignored, the above dialogue
     reads:
  
                         ------------------- 
 Want to Continue with Load? YES// 
 Loading Distribution...
  
    TIU*1.0*182
 Will first run the Environment Check Routine, TIUEN182
  
 Checking for potential duplicate Document Definitions...
      No potential duplicates found.
 Remember to run option TIU182 DDEFS, MED CONVERSION after installing the 
 patch.
                         -------------------  
  
  2. On the KIDS menu under the 'INSTALLATION' menu, use the following
     options as desired:
        Print Transport Global
        Compare Transport Global to Current System
        Verify Checksums in Transport Global
        Backup a Transport Global
  
  3. On the KIDS menu under the 'INSTALLATION' menu, use the following
     option to install the patch:
        Install Package(s) (TIU*1.0*182)
  
  4. When prompted "Want KIDS to Rebuild Menu Trees Upon Completion of 
     Install? YES//", respond 'NO'.
  
  5. When prompted "Want KIDS to INHIBIT LOGONs during the install? YES//",
     respond 'NO'.
  
  6. When prompted 'Want to DISABLE Scheduled Options, Menu Options, and 
     Protocols? YES//', respond 'YES', and DISABLE the TIU* Options and
     Protocols.
  
  7. When prompted 'Delay Install (Minutes):  (0-60): 0//; respond '0'.
  
  8. After installing the patch, sites who wish to convert Medicine 
     Reports must run option TIU182 DDEFS, MED CONVERSION. See
     Section V, POST-INSTALLATION INSTRUCTIONS.
  
     Sites who do not have Medicine Reports to convert should delete the
     option, as well as routines TIUEN182, TIUPS182, and TIU182D after the
     released patch has been installed successfully. Please verify
     checksums before deleting the routines.
  
  9. We do not anticipate any need to reinstall this patch. However, it
     may be reinstalled if necessary.
  
 10. Sites who choose to create the new DDEFS should delete the option, as
     well as routines TIUEN182, TIUPS182, and TIU182D after the released
     patch has been installed and after option TIU182 DDEFS, MED CONVERSION
     has successfully created all 13 Document Definitions. Please verify
     checksums before deleting the routines.
  
  
 VI. POST-INSTALLATION INSTRUCTIONS:
     ===============================
  
 NOTE: Sites not running the Medicine Conversion may ignore these  
 POST-INSTALLATION INSTRUCTIONS.
  
 Option TIU182 DDEFS, MED CONVERSION is exported with the patch.  It is run
 after the patch is installed. It is this option, not the patch itself,
 which actually creates the new HP Document Definitions.
  
 RUNNING OPTION TIU182 DDEFS, MED CONVERSION:                             
 ============================================
 The option should take one or two minutes to run and will not disrupt
 users, so it can be run at any time of day.
  
 The option is run from programmer mode.
  
 There are several different dialogues that may be displayed when the
 option is run, depending on the scenario.
  
 Scenario 1, Missing User Class or Missing DDEF
 If the option fails to find user class CLINICAL COORDINATOR or DDEF class
 CLINICAL PROCEDURES, it will inform the user and quit.  It will not
 proceed to create DDEFS.
  
 Scenario 2, Duplicate DDEFS
 If the option finds Document Definitions matching those exported by this
 patch but which were not created by this patch, the user will see a 
 dialogue similar to the dialogue that displays during installation if
 potential duplicates are found. (See number 1 of Section IV, INSTALLATION
 INSTRUCTIONS.) The option will quit; it will not proceed to create DDEFS.
  
 Scenario 3, Success
 If the option is successful in creating all of the Document Definitions,
 it displays the following dialogue:
  
                         ------------------- 
 >D ^XUP
  
 Setting up programmer environment
 Terminal Type set to: C-VT220
 Select OPTION NAME: TIU182 DDEFS, MED CONVERSION       Create DDEFS for 
 Med Conversion
  
 This option creates Historical Procedure Document Definitions (DDEFS) for
 the Medicine Package conversion.
 It may take one or two minutes to run.  It will tell you whether or not
 it is successful.
  
 DEVICE: HOME//   ANYWHERE
  
  
 * Historical Procedure Document Definitions for the Medicine Conversion *
 Environment looks OK.
 Creating the Document Definitions...
 All Document Definitions have now been created successfully.
  
                            *************
  
  
 Scenario 4, Problems Creating DDEFS
 If any DDEF encounters problems in any phase of its creation by the 
 option, it is deleted and an error message is posted for that DDEF.  The
 option proceeds, however, and creates the rest of the DDEFS if possible.  
 If the option is rerun in this situation, it will attempt to create only
 those DDEFS not successfully created previously.
  
  
 * Historical Procedure Document Definitions for the Medicine Conversion *
 Environment looks OK.
 Some of the Document Definitions exported for the conversion have already 
 been created by this option. I will now create the others... 
 All Document Definitions have now been created successfully.
  
                            *************
  
 AFTER RUNNING OPTION TIU182 DDEFS, MED CONVERSION 
 ================================================= 
 Scenario 3 from above, Success
 When the option has run successfully to the end and messages have
 indicated that all Document Definitions have been created successfully
 with no problems encountered, the option should be deleted, along with
 routines TIUEN182, TIUPS182, and TIU182D, after verifying the
 checksums.
  
 **EDIT LATER** TEST SITES: Test sites should NOT DELETE the option or the
 routines until they have installed the RELEASED version of the patch and
 all DDEFS have been created successfully.
  
 Scenario 4 from above, Problems Creating DDEFS
 If problems are encountered creating one or more DDEFS, sites may contact
 EVS for help.  Once the problem has been resolved, the option should be
 run again until all DDEFS have been created. It will attempt to create
 only those DDEFS not successfully created previously.
  
 Scenario 5, Rerunning the Option when All DDEFS have already been Created:
 If the option is run again after Document Definitions have already been
 created successfully, no harm is done. The user is simply informed that
 the entries were already created successfully.
  
 NOTE: This assumes that the option and routines have not been deleted, and
 that the XTMP global has not yet been deleted. (It should not auto-delete
 until at least 2 years after the option was last run.) If the XTMP global
 HAS been deleted, the option will consider that DDEFS exported by this
 patch are duplicates, and will not run.
  
 VII. BUSINESS RULES:
      ===============
  
 Before running the conversion, sites should examine the Business Rules 
 which document class HP inherits from class CP and make sure they are 
 appropriate.  Actions which are never appropriate for HPs have been 
 prohibited outright in code.  Many actions are non-applicable since HP
 titles are Inactive and since HPs are auto-generated with status complete.
 Actions AMENDMENT, DELETE RECORD, PRINT RECORD, and VIEW may be 
 appropriate under certain circumstances; rules for these actions should be
 reviewed. Persons permitted to DELETE HPs must be aware of proper
 procedures for correcting HP documents.  See below.
  
 VIII. CORRECTING HP DOCUMENTS:
       ========================
 If corrections to HP documents are needed, they should be made soon after 
 the conversion, while Medicine Report files are still available.
 If the wrong title was selected for a document during the conversion, the 
 title can be changed (within the HP document class only) using FileMan.
 Other corrections such as reassigning to a different patient must be
 handled by deleting the incorrect document and generating a new correct
 document using conversion options. When a document is deleted and a new
 one is generated, the RETRACTED ORIGINAL field [#1406] in the TIU 
 DOCUMENT FILE [#8925.1] for the new document must be edited using FileMan
 to refer to the original, incorrect "deleted" document.

Routine Information:
====================

Routine Name:
  - TIUPRPN1


Routine Checksum:

Routine Name:
  - TIUPRCN


Routine Checksum:

Routine Name:
  - TIUPRDS


Routine Checksum:

Routine Name:
  - TIURC


Routine Checksum:

Routine Name:
  - TIUCP


Routine Checksum:

Routine Name:
  - TIULC


Routine Checksum:

Routine Name:
  - TIURA2


Routine Checksum:

Routine Name:
  - TIUPRD


Routine Checksum:

Routine Name:
  - TIU182D


Routine Checksum:

Routine Name:
  - TIUEN182


Routine Checksum:

Routine Name:
  - TIUEPRNT


Routine Checksum:

Routine Name:
  - TIUPD


Routine Checksum:

Routine Name:
  - TIUPRPN8


Routine Checksum:

Routine Name:
  - TIUPS182


Routine Checksum:

Routine Name:
  - TIU182D1


Routine Checksum:

Routine Name:
  - TIU182DF


Routine Checksum:

Routine Name:
  - TIURA


Routine Checksum:

Routine Name:
  - TIULP


Routine Checksum:

=============================================================================
User Information:
Entered By  : MCCLENAHAN,MARGARET           Date Entered  : FEB 05, 2004
Completed By: MERRILL,DAVID P               Date Completed: JUL 14, 2005
Released By : THORNTON,NANCY                Date Released : JUL 21, 2005
=============================================================================


Packman Mail Message:
=====================

$END TXT
