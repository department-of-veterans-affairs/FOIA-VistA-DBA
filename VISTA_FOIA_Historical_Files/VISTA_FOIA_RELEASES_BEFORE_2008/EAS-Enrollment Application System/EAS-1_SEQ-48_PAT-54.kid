Released EAS*1*54 SEQ #48
Extracted from mail message
**KIDS**:EAS*1.0*54^

**INSTALL NAME**
EAS*1.0*54
"BLD",4803,0)
EAS*1.0*54^ENROLLMENT APPLICATION SYSTEM^0^3040819^y
"BLD",4803,4,0)
^9.64PA^^
"BLD",4803,"INID")
n^n^n
"BLD",4803,"KRN",0)
^9.67PA^8989.52^19
"BLD",4803,"KRN",.4,0)
.4
"BLD",4803,"KRN",.401,0)
.401
"BLD",4803,"KRN",.402,0)
.402
"BLD",4803,"KRN",.403,0)
.403
"BLD",4803,"KRN",.5,0)
.5
"BLD",4803,"KRN",.84,0)
.84
"BLD",4803,"KRN",3.6,0)
3.6
"BLD",4803,"KRN",3.8,0)
3.8
"BLD",4803,"KRN",9.2,0)
9.2
"BLD",4803,"KRN",9.8,0)
9.8
"BLD",4803,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",4803,"KRN",9.8,"NM",1,0)
EASMTL1^^0^B27599338
"BLD",4803,"KRN",9.8,"NM",2,0)
EASMTL6^^0^B66842537
"BLD",4803,"KRN",9.8,"NM",3,0)
EASMTL6A^^0^B21531838
"BLD",4803,"KRN",9.8,"NM",4,0)
EASMTL8^^0^B21583313
"BLD",4803,"KRN",9.8,"NM",5,0)
EASMTUTL^^0^B67554126
"BLD",4803,"KRN",9.8,"NM","B","EASMTL1",1)

"BLD",4803,"KRN",9.8,"NM","B","EASMTL6",2)

"BLD",4803,"KRN",9.8,"NM","B","EASMTL6A",3)

"BLD",4803,"KRN",9.8,"NM","B","EASMTL8",4)

"BLD",4803,"KRN",9.8,"NM","B","EASMTUTL",5)

"BLD",4803,"KRN",19,0)
19
"BLD",4803,"KRN",19.1,0)
19.1
"BLD",4803,"KRN",101,0)
101
"BLD",4803,"KRN",409.61,0)
409.61
"BLD",4803,"KRN",771,0)
771
"BLD",4803,"KRN",870,0)
870
"BLD",4803,"KRN",8989.51,0)
8989.51
"BLD",4803,"KRN",8989.52,0)
8989.52
"BLD",4803,"KRN",8994,0)
8994
"BLD",4803,"KRN","B",.4,.4)

"BLD",4803,"KRN","B",.401,.401)

"BLD",4803,"KRN","B",.402,.402)

"BLD",4803,"KRN","B",.403,.403)

"BLD",4803,"KRN","B",.5,.5)

"BLD",4803,"KRN","B",.84,.84)

"BLD",4803,"KRN","B",3.6,3.6)

"BLD",4803,"KRN","B",3.8,3.8)

"BLD",4803,"KRN","B",9.2,9.2)

"BLD",4803,"KRN","B",9.8,9.8)

"BLD",4803,"KRN","B",19,19)

"BLD",4803,"KRN","B",19.1,19.1)

"BLD",4803,"KRN","B",101,101)

"BLD",4803,"KRN","B",409.61,409.61)

"BLD",4803,"KRN","B",771,771)

"BLD",4803,"KRN","B",870,870)

"BLD",4803,"KRN","B",8989.51,8989.51)

"BLD",4803,"KRN","B",8989.52,8989.52)

"BLD",4803,"KRN","B",8994,8994)

"BLD",4803,"QUES",0)
^9.62^^
"BLD",4803,"REQB",0)
^9.611^3^3
"BLD",4803,"REQB",1,0)
EAS*1.0*22^2
"BLD",4803,"REQB",2,0)
EAS*1.0*25^2
"BLD",4803,"REQB",3,0)
EAS*1.0*28^2
"BLD",4803,"REQB","B","EAS*1.0*22",1)

"BLD",4803,"REQB","B","EAS*1.0*25",2)

"BLD",4803,"REQB","B","EAS*1.0*28",3)

"MBREQ")
0
"PKG",552,-1)
1^1
"PKG",552,0)
ENROLLMENT APPLICATION SYSTEM^EAS^ENROLLMENT
"PKG",552,20,0)
^9.402P^1^1
"PKG",552,20,1,0)
2^^EASXDR
"PKG",552,20,1,1)
 
"PKG",552,20,"B",2,1)

"PKG",552,22,0)
^9.49I^1^1
"PKG",552,22,1,0)
1.0^3010315^3010410^66481
"PKG",552,22,1,"PAH",1,0)
54^3040819
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","EASMTL1")
0^1^B27599338
"RTN","EASMTL1",1,0)
EASMTL1 ;MIN/TCM ALB/SCK/AEG/PHH - AUTOMATED MEANS TEST LETTER - PATIENT SEARCH ; 07/2/01
"RTN","EASMTL1",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,12,20,54**;MAR 15,2001
"RTN","EASMTL1",3,0)
 ; Conversion from class III software
"RTN","EASMTL1",4,0)
 ;
"RTN","EASMTL1",5,0)
QUEUE ; Main entry point for tasked (background) letter search
"RTN","EASMTL1",6,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSK,ZDATE
"RTN","EASMTL1",7,0)
 ;
"RTN","EASMTL1",8,0)
 S ZTRTN="EN^EASMTL1"
"RTN","EASMTL1",9,0)
 S ZTDESC="AUTOMATED MT LETTERS GENERATOR"
"RTN","EASMTL1",10,0)
 S (ZTDTH,ZDATE)=$$NOW^XLFDT
"RTN","EASMTL1",11,0)
 S ZTIO=""
"RTN","EASMTL1",12,0)
 D ^%ZTLOAD
"RTN","EASMTL1",13,0)
 Q
"RTN","EASMTL1",14,0)
 ;
"RTN","EASMTL1",15,0)
SETDT(EASRUN) ;
"RTN","EASMTL1",16,0)
 ; Input
"RTN","EASMTL1",17,0)
 ;    EASRUN   - Default start date for processing
"RTN","EASMTL1",18,0)
 ;
"RTN","EASMTL1",19,0)
 ; Output
"RTN","EASMTL1",20,0)
 ;    1 - Ok
"RTN","EASMTL1",21,0)
 ;    0 - Quit
"RTN","EASMTL1",22,0)
 ;    EASRUN - Accepted start date for processing
"RTN","EASMTL1",23,0)
 ;
"RTN","EASMTL1",24,0)
 N DIR,DIRUT,RSLT
"RTN","EASMTL1",25,0)
 ;
"RTN","EASMTL1",26,0)
 S DIR("A",1)="The prior processing date is not available.  A default date"
"RTN","EASMTL1",27,0)
 S DIR("A",2)="of "_$$FMTE^XLFDT(EASRUN)_" will be used."
"RTN","EASMTL1",28,0)
 S DIR("A")="Ok to continue? "
"RTN","EASMTL1",29,0)
 S DIR(0)="YAO",DIR("B")="YES"
"RTN","EASMTL1",30,0)
 D ^DIR K DIR
"RTN","EASMTL1",31,0)
 I $D(DIRUT) Q 0
"RTN","EASMTL1",32,0)
 Q:Y Y
"RTN","EASMTL1",33,0)
 ;
"RTN","EASMTL1",34,0)
 S DIR(0)="DAO^:DT:EX",DIR("B")=$$FMTE^XLFDT(EASRUN)
"RTN","EASMTL1",35,0)
 S DIR("?")="^D HELP^%DTC"
"RTN","EASMTL1",36,0)
 S DIR("A",1)=""
"RTN","EASMTL1",37,0)
 S DIR("A")="Select new start date: "
"RTN","EASMTL1",38,0)
 D ^DIR K DIR
"RTN","EASMTL1",39,0)
 I $D(DIRUT) Q 0
"RTN","EASMTL1",40,0)
 S EASRUN=Y
"RTN","EASMTL1",41,0)
 Q 1
"RTN","EASMTL1",42,0)
 ;
"RTN","EASMTL1",43,0)
EN ; Main entry point for processing
"RTN","EASMTL1",44,0)
 N EASLAST,X,EASLST,EASABRT,EASN,EAS6CNT,EAS3CNT,EAS0CNT,EASDT,EASDTFLG,EADT,MSG,EASX
"RTN","EASMTL1",45,0)
 ;
"RTN","EASMTL1",46,0)
 ; Get last processing date, default to TODAY - 30 if date not available
"RTN","EASMTL1",47,0)
 S EASX=$$GET1^DIQ(713,1,2,"I")
"RTN","EASMTL1",48,0)
 S EADT=$$DT^XLFDT
"RTN","EASMTL1",49,0)
 ; If letter search has already been run for TODAY, quit
"RTN","EASMTL1",50,0)
 I EASX=EADT D  Q
"RTN","EASMTL1",51,0)
 . I '$D(ZTQUEUED) D
"RTN","EASMTL1",52,0)
 . . W !!,$CHAR(7),">> The Means Test Letter search has been run for today.",!
"RTN","EASMTL1",53,0)
 . . D PAUSE^EASMTUTL
"RTN","EASMTL1",54,0)
 ;
"RTN","EASMTL1",55,0)
 I EASX S EASLAST=$$FMADD^XLFDT(EASX,1)
"RTN","EASMTL1",56,0)
 I '$G(EASX) D  Q:$G(EASABRT)
"RTN","EASMTL1",57,0)
 . S EASLAST=$$FMADD^XLFDT(DT,-30)
"RTN","EASMTL1",58,0)
 . I '$D(ZTQUEUED) S:'$$SETDT(.EASLAST) EASABRT=1
"RTN","EASMTL1",59,0)
 ;
"RTN","EASMTL1",60,0)
 ; Check lock on parameter file, one process at a time, quit if locked
"RTN","EASMTL1",61,0)
 I '$$LOCK^EASMTUTL(1) D  Q
"RTN","EASMTL1",62,0)
 . I $D(ZTQUEUED) D  Q
"RTN","EASMTL1",63,0)
 . . D ALERT^EASMTUTL("Auto MT Letters: This process is already running, "_$$FMTE^XLFDT(EADT,"2D"))
"RTN","EASMTL1",64,0)
 . W !!,$CHAR(7),"This process is already running, please try again later"
"RTN","EASMTL1",65,0)
 . D PAUSE^EASMTUTL
"RTN","EASMTL1",66,0)
 ;
"RTN","EASMTL1",67,0)
 D BLDLST(EASLAST,EADT)    ; Build processing date list
"RTN","EASMTL1",68,0)
 D PROCESS                 ; Process dates
"RTN","EASMTL1",69,0)
 S EASX=$$LOCK^EASMTUTL(0)
"RTN","EASMTL1",70,0)
 D UPDPARAM(EADT)
"RTN","EASMTL1",71,0)
 D STATS(EASLAST,.EAS6CNT,EADT)
"RTN","EASMTL1",72,0)
 ;
"RTN","EASMTL1",73,0)
 I $D(ZTQUEUED) D
"RTN","EASMTL1",74,0)
 . S MSG="Auto-Letters Search completed: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","EASMTL1",75,0)
 . D ALERT^EASMTUTL(MSG)
"RTN","EASMTL1",76,0)
 Q
"RTN","EASMTL1",77,0)
 ;
"RTN","EASMTL1",78,0)
BLDLST(FRDT,TODT) ; Build processing date list
"RTN","EASMTL1",79,0)
 ; Input
"RTN","EASMTL1",80,0)
 ;   FRDT - Beginning date for processing list
"RTN","EASMTL1",81,0)
 ;   TODT - Ending date for processing list
"RTN","EASMTL1",82,0)
 ;
"RTN","EASMTL1",83,0)
 N EASN
"RTN","EASMTL1",84,0)
 ;
"RTN","EASMTL1",85,0)
 S EASN=FRDT,EASLST(FRDT)="",EASLST(TODT)=""
"RTN","EASMTL1",86,0)
 F  S EASN=$$FMADD^XLFDT(EASN,1) Q:EASN>TODT  S EASLST(EASN)=""
"RTN","EASMTL1",87,0)
 Q
"RTN","EASMTL1",88,0)
 ;
"RTN","EASMTL1",89,0)
PROCESS ;  Get anniversary and threshold dates
"RTN","EASMTL1",90,0)
 N EASPRCDT
"RTN","EASMTL1",91,0)
 ;
"RTN","EASMTL1",92,0)
 S (EAS0CNT,EAS3CNT,EAS6CNT)=0
"RTN","EASMTL1",93,0)
 ; Calculate Anniverary date and 60/30/0 dates based on the Anniverary date
"RTN","EASMTL1",94,0)
 S EASPRCDT=0 ; Begin loop through processing dates
"RTN","EASMTL1",95,0)
 F  S EASPRCDT=$O(EASLST(EASPRCDT)) Q:EASPRCDT'>0  D  Q:$G(ZTSTOP)  ; Quit if stop request
"RTN","EASMTL1",96,0)
 . K EASDT
"RTN","EASMTL1",97,0)
 . I '$D(ZTQUEUED) W !?5,">> Processing date  "_$$FMTE^XLFDT(EASPRCDT)_"  in progress <<",!
"RTN","EASMTL1",98,0)
 . ; Anniversary date is processing date minus one year plus sixty days
"RTN","EASMTL1",99,0)
 . ;
"RTN","EASMTL1",100,0)
 . S EASDT("ANV")=$$FMADD^XLFDT($$SUBLEAP^EASMTUTL(EASPRCDT),60) ; Anv date: 1 Year - 60 days
"RTN","EASMTL1",101,0)
 . S EASDT("60")=$$FMADD^XLFDT(EASDT("ANV"),(365-60)) ; Define 60 day letter print date
"RTN","EASMTL1",102,0)
 . S EASDT("30")=$$FMADD^XLFDT(EASDT("ANV"),(365-30)) ; Define 30 day letter print date
"RTN","EASMTL1",103,0)
 . S EASDT("0")=$$FMADD^XLFDT(EASDT("ANV"),365) ; Define 0 day letter print date
"RTN","EASMTL1",104,0)
 . ;
"RTN","EASMTL1",105,0)
 . ; Call the threshold date search
"RTN","EASMTL1",106,0)
 . D EN60^EASMTL2
"RTN","EASMTL1",107,0)
 . ; Check for stop request if queued
"RTN","EASMTL1",108,0)
 . I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1
"RTN","EASMTL1",109,0)
 Q
"RTN","EASMTL1",110,0)
 ;
"RTN","EASMTL1",111,0)
UPDPARAM(EASDT) ; Update the EAS Parameter file, #713
"RTN","EASMTL1",112,0)
 ; Input
"RTN","EASMTL1",113,0)
 ;   EASDT - Today's date
"RTN","EASMTL1",114,0)
 ;
"RTN","EASMTL1",115,0)
 N DIE,DA,DR
"RTN","EASMTL1",116,0)
 ;
"RTN","EASMTL1",117,0)
 S DIE="^EAS(713,",DA=1,DR="2////^S X=EASDT"
"RTN","EASMTL1",118,0)
 S:'$D(ZTQUEUED) DR=DR_";3////^S X=DUZ;4////^S X=EASDT"
"RTN","EASMTL1",119,0)
 D ^DIE K DIE
"RTN","EASMTL1",120,0)
 Q
"RTN","EASMTL1",121,0)
 ;
"RTN","EASMTL1",122,0)
STATS(EASLAST,EAS6CNT,EASDT) ;Gather and print statistics
"RTN","EASMTL1",123,0)
 ; Input
"RTN","EASMTL1",124,0)
 ;    EASLAST  - Last date processed (Beginning date)
"RTN","EASMTL1",125,0)
 ;    EAS6CNT  - Array of 60 day letters
"RTN","EASMTL1",126,0)
 ;    EASDT    - Ending date of processing
"RTN","EASMTL1",127,0)
 ;
"RTN","EASMTL1",128,0)
 N MSG,EASD,LINE,TOT,XMSUB,XMY,XMTEXT,XMDUZ,ZDCD
"RTN","EASMTL1",129,0)
 ;
"RTN","EASMTL1",130,0)
 ; EAS*1*12 modification
"RTN","EASMTL1",131,0)
 S ZDCD=$S($$VERSION^XPDUTL("IVMC"):0,1:60)
"RTN","EASMTL1",132,0)
 ; ** 
"RTN","EASMTL1",133,0)
 ; EAS*1*20 modification
"RTN","EASMTL1",134,0)
 I $G(ZDCD)'>0,$G(DT)>3021014 S ZDCD=60
"RTN","EASMTL1",135,0)
 ;
"RTN","EASMTL1",136,0)
 S MSG(.1)="Automated Means Test Letter Generator Statistics"
"RTN","EASMTL1",137,0)
 S MSG(.2)="------------------------------------------------"
"RTN","EASMTL1",138,0)
 S MSG(.3)=""
"RTN","EASMTL1",139,0)
 S MSG(.4)="Beginning Processing Date: "_$$FMTE^XLFDT(EASLAST)
"RTN","EASMTL1",140,0)
 S MSG(.5)="Ending Processing Date:    "_$$FMTE^XLFDT(EASDT)
"RTN","EASMTL1",141,0)
 S MSG(.6)=""
"RTN","EASMTL1",142,0)
 S MSG(11)="  "_ZDCD_"-day Letters: "_EAS6CNT
"RTN","EASMTL1",143,0)
 S MSG(16)=""
"RTN","EASMTL1",144,0)
 S LINE=18
"RTN","EASMTL1",145,0)
 ;
"RTN","EASMTL1",146,0)
 S LINE=LINE+1
"RTN","EASMTL1",147,0)
 S MSG(LINE)=ZDCD_" Day Letter Totals:    "
"RTN","EASMTL1",148,0)
 S EASD=0
"RTN","EASMTL1",149,0)
 F  S EASD=$O(EAS6CNT(EASD)) Q:'EASD  D
"RTN","EASMTL1",150,0)
 . I +$G(EAS6CNT(EASD)) D
"RTN","EASMTL1",151,0)
 . . S LINE=LINE+1
"RTN","EASMTL1",152,0)
 . . S MSG(LINE)="  "_$$FMTE^XLFDT(EASD)_" : "_EAS6CNT(EASD)
"RTN","EASMTL1",153,0)
 ;
"RTN","EASMTL1",154,0)
 S XMSUB="AUTO MT LETTER RESULTS - "_$$FMTE^XLFDT(EASDT)
"RTN","EASMTL1",155,0)
 S XMTEXT="MSG("
"RTN","EASMTL1",156,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTL1",157,0)
 S XMDUZ="AUTOMATED MT LETTERS"
"RTN","EASMTL1",158,0)
 D ^XMD
"RTN","EASMTL1",159,0)
 Q
"RTN","EASMTL6")
0^2^B66842537
"RTN","EASMTL6",1,0)
EASMTL6 ; ALB/SCK,BRM,LBD,PHH - AUTOMATED MEANS TEST LETTER-INTERACTIVE PRINT ; 5/22/03 9:52am
"RTN","EASMTL6",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,14,15,29,25,22,54**;MAR 15,2001
"RTN","EASMTL6",3,0)
 ;
"RTN","EASMTL6",4,0)
EN ; Main entry point
"RTN","EASMTL6",5,0)
 ; Input, set in option call, if not passed in, or called interactively, user is asked to specify.
"RTN","EASMTL6",6,0)
 ;    EATYP - Used for selective printing of letters and forms
"RTN","EASMTL6",7,0)
 ;         1 : 60-Day
"RTN","EASMTL6",8,0)
 ;         2 : 30-Day
"RTN","EASMTL6",9,0)
 ;         4 :  0-Day
"RTN","EASMTL6",10,0)
 ;
"RTN","EASMTL6",11,0)
 N DIR,DIRUT,POP,EASLOC,Y
"RTN","EASMTL6",12,0)
 ;
"RTN","EASMTL6",13,0)
 ;; Select type of letter to print
"RTN","EASMTL6",14,0)
 I '$G(EATYP) D  Q:$D(DIRUT)
"RTN","EASMTL6",15,0)
 . S DIR(0)="SO^1:60-Day;2:30-Day;4:0-Day"
"RTN","EASMTL6",16,0)
 . S DIR("?")="Select the type of letter to print"
"RTN","EASMTL6",17,0)
 . D ^DIR K DIR
"RTN","EASMTL6",18,0)
 . S EATYP=+Y
"RTN","EASMTL6",19,0)
 ;
"RTN","EASMTL6",20,0)
 ;; Select facility filter if appropriate
"RTN","EASMTL6",21,0)
 S EASLOC=-1
"RTN","EASMTL6",22,0)
 I $$GET1^DIQ(713,1,8,"I") D  Q:$D(DIRUT)
"RTN","EASMTL6",23,0)
 . S DIR(0)="YAO",DIR("A")="Filter letters by Preferred Facility? "
"RTN","EASMTL6",24,0)
 . S DIR("B")="NO"
"RTN","EASMTL6",25,0)
 . S DIR("?")="Enter 'YES' to limit letters to a specific Facility or 'NO' to print all letters."
"RTN","EASMTL6",26,0)
 . D ^DIR K DIR
"RTN","EASMTL6",27,0)
 . Q:$D(DIRUT)!('Y)
"RTN","EASMTL6",28,0)
 . S EASLOC=$$FACNUM
"RTN","EASMTL6",29,0)
 ;
"RTN","EASMTL6",30,0)
 K IOP,IO("Q")
"RTN","EASMTL6",31,0)
 ;
"RTN","EASMTL6",32,0)
 S %ZIS="QP",%ZIS("B")=$$GET1^DIQ(713,1,5)
"RTN","EASMTL6",33,0)
 D ^%ZIS K %ZIS
"RTN","EASMTL6",34,0)
 Q:POP
"RTN","EASMTL6",35,0)
 I $D(IO("Q")) D QUE Q
"RTN","EASMTL6",36,0)
 D LTR
"RTN","EASMTL6",37,0)
 D ^%ZISC
"RTN","EASMTL6",38,0)
 K EATYP
"RTN","EASMTL6",39,0)
 Q
"RTN","EASMTL6",40,0)
 ;
"RTN","EASMTL6",41,0)
QUE ; Queue the report
"RTN","EASMTL6",42,0)
 N ZTRTN,ZTDESC,ZTSAVE,ZTSK,ZTDTH,ZTQUEUED
"RTN","EASMTL6",43,0)
 ;
"RTN","EASMTL6",44,0)
 S ZTRTN="LTR^EASMTL6"
"RTN","EASMTL6",45,0)
 S ZTDESC="EAS MT LETTERS PRINT JOB"
"RTN","EASMTL6",46,0)
 S ZTSAVE("EATYP")="",ZTSAVE("EASLOC")=""
"RTN","EASMTL6",47,0)
 S ZTDTH="NOW"
"RTN","EASMTL6",48,0)
 ;
"RTN","EASMTL6",49,0)
 D ^%ZTLOAD
"RTN","EASMTL6",50,0)
 I $D(ZTSK)[0 W !!?5,"Letters canceled!"
"RTN","EASMTL6",51,0)
 E  W !!?5,"Letters queued! [ ",ZTSK," ]"
"RTN","EASMTL6",52,0)
 D HOME^%ZIS
"RTN","EASMTL6",53,0)
 Q
"RTN","EASMTL6",54,0)
 ;
"RTN","EASMTL6",55,0)
LTR ; Main entry point
"RTN","EASMTL6",56,0)
 N EASTMP,EASKP
"RTN","EASMTL6",57,0)
 ;
"RTN","EASMTL6",58,0)
 S EASTMP="^TMP(""EASMT"",$J)"
"RTN","EASMTL6",59,0)
 K @EASTMP
"RTN","EASMTL6",60,0)
 ;
"RTN","EASMTL6",61,0)
 I '$D(ZTQUEUED) W !,"...Gathering letters to print...Please wait"
"RTN","EASMTL6",62,0)
 D BLD(EATYP,EASLOC,EASTMP,.EASKP)
"RTN","EASMTL6",63,0)
 D RESULT(.EASKP,EATYP)
"RTN","EASMTL6",64,0)
 I '$D(ZTQUEUED) W !,"...Printing letters..."
"RTN","EASMTL6",65,0)
 D PRINT(EASTMP,EATYP)
"RTN","EASMTL6",66,0)
 K @EASTMP,EATYP
"RTN","EASMTL6",67,0)
 Q
"RTN","EASMTL6",68,0)
 ;
"RTN","EASMTL6",69,0)
RESULT(EASKP,EATYP) ; Send results of letter printing to mail group
"RTN","EASMTL6",70,0)
 N MSG,XMSUB,XMY,XMTEXT,XMDUZ,TOT,X1
"RTN","EASMTL6",71,0)
 ;
"RTN","EASMTL6",72,0)
 S MSG(1)="Letters to print: "_$J($FN(EASKP("CNT"),","),8)
"RTN","EASMTL6",73,0)
 S MSG(2)="Letters where the print date has not reached: "_$J($FN(EASKP("T"),","),8)
"RTN","EASMTL6",74,0)
 S MSG(2.5)=""
"RTN","EASMTL6",75,0)
 S MSG(3)="The following letters were found but not printed for the following reasons:"
"RTN","EASMTL6",76,0)
 S MSG(4)="Incomplete/Bad Addr :                 "_$J($FN(EASKP("I"),","),8)
"RTN","EASMTL6",77,0)
 S MSG(5)="Deceased :                            "_$J($FN(EASKP("D"),","),8)
"RTN","EASMTL6",78,0)
 S MSG(6)="MT Changed:                           "_$J($FN(EASKP("C"),","),8)
"RTN","EASMTL6",79,0)
 S MSG(7)="Prohibit flag set:                    "_$J($FN(EASKP("P"),","),8)
"RTN","EASMTL6",80,0)
 S MSG(8)="Not a User Enrollee:                  "_$J($FN(EASKP("U"),","),8)
"RTN","EASMTL6",81,0)
 S MSG(8.5)="Not a User Enrollee of this facility: "_$J($FN(EASKP("O"),","),8)
"RTN","EASMTL6",82,0)
 S MSG(9)=""
"RTN","EASMTL6",83,0)
 S TOT=0 F X1="I","D","C","P","O","T","U","CNT" S TOT=TOT+EASKP(X1)
"RTN","EASMTL6",84,0)
 S MSG(10)="Total Letters Processed: "_$J($FN(TOT,","),8)_" (MT not returned)"
"RTN","EASMTL6",85,0)
 ;
"RTN","EASMTL6",86,0)
 S XMSUB=$S(EATYP=1:"60-Day",EATYP=2:"30-Day",1:"0-Day")_" Print Letter Results"
"RTN","EASMTL6",87,0)
 S XMTEXT="MSG("
"RTN","EASMTL6",88,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTL6",89,0)
 S XMDUZ="AUTOMATED MT LETTERS"
"RTN","EASMTL6",90,0)
 D ^XMD
"RTN","EASMTL6",91,0)
 Q
"RTN","EASMTL6",92,0)
 ;
"RTN","EASMTL6",93,0)
BLD(EATYP,EASLOC,EASTMP,EASKP) ; Build TMP array of letters to print
"RTN","EASMTL6",94,0)
 N DFN,EASIEN,COUNT,EAX2,EASPTR,EASABRT,EASUE
"RTN","EASMTL6",95,0)
 ;
"RTN","EASMTL6",96,0)
 F EAX2="P","D","C","F","T","I","O","U","CNT" S EASKP(EAX2)=0
"RTN","EASMTL6",97,0)
 S COUNT=0
"RTN","EASMTL6",98,0)
 ;
"RTN","EASMTL6",99,0)
 S EASIEN=0 ; Begin loop through un-returned means tests
"RTN","EASMTL6",100,0)
 F  S EASIEN=$O(^EAS(713.2,"AC",0,EASIEN)) Q:'EASIEN  D  Q:$G(EASABRT)
"RTN","EASMTL6",101,0)
 . S EASPTR=$$GET1^DIQ(713.2,EASIEN,2,"I") ; Pointer to File 713.1
"RTN","EASMTL6",102,0)
 . ; begin checks
"RTN","EASMTL6",103,0)
 . Q:EASPTR<0  ; SAFETY CHECK
"RTN","EASMTL6",104,0)
 . Q:$$LTRTYP^EASMTL6B(EASIEN)'=EATYP  ;  Check for appropriate letter type
"RTN","EASMTL6",105,0)
 . S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I") Q:'DFN
"RTN","EASMTL6",106,0)
 . ;; Filter by site, quit if filter not met
"RTN","EASMTL6",107,0)
 . I +$G(EASLOC)>0 Q:$$GET1^DIQ(2,DFN,27.02,"I")'=+EASLOC
"RTN","EASMTL6",108,0)
 . I $D(^EAS(713.1,"AP",1,EASPTR)) D  Q  ; Check Prohibit letter
"RTN","EASMTL6",109,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",110,0)
 . . S EASKP("P")=EASKP("P")+1
"RTN","EASMTL6",111,0)
 . I $$DECEASED^EASMTUTL(EASIEN) D  Q  ; Check Deceased
"RTN","EASMTL6",112,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",113,0)
 . . S EASKP("D")=EASKP("D")+1
"RTN","EASMTL6",114,0)
 . I $$CHECKMT^EASMTUTL(EASPTR,EASIEN) D  Q  ; Check MT changed?
"RTN","EASMTL6",115,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",116,0)
 . . S EASKP("C")=EASKP("C")+1 Q
"RTN","EASMTL6",117,0)
 . I $$FUTMT^EASMTUTL(EASIEN) D  Q  ; Check for a Future MT
"RTN","EASMTL6",118,0)
 . . D CLRFLG^EASMTUTL(0,EASIEN)
"RTN","EASMTL6",119,0)
 . . S EASKP("F")=EASKP("F")+1
"RTN","EASMTL6",120,0)
 . I '$$THRSHLD(EATYP,EASIEN) D  Q  ; Quit if letter threshold not reached
"RTN","EASMTL6",121,0)
 . . S EASKP("T")=EASKP("T")+1
"RTN","EASMTL6",122,0)
 . ; Get User Enrollee status (0=not UE; 1=UE; 2=UE, not this site)
"RTN","EASMTL6",123,0)
 . S EASUE=$$UESTAT^EASUER(DFN)
"RTN","EASMTL6",124,0)
 . I 'EASUE D  Q     ; Quit if not User Enrollee
"RTN","EASMTL6",125,0)
 . . D NOPRT(EATYP,EASIEN)
"RTN","EASMTL6",126,0)
 . . S EASKP("U")=EASKP("U")+1
"RTN","EASMTL6",127,0)
 . I EASUE'=1 D  Q   ; Quit if User Enrollee site is not this facility
"RTN","EASMTL6",128,0)
 . . D NOPRT(EATYP,EASIEN)
"RTN","EASMTL6",129,0)
 . . S EASKP("O")=EASKP("O")+1
"RTN","EASMTL6",130,0)
 . I $$CHKADR^EASMTL6A(EASPTR) D  Q  ; Check for valid address
"RTN","EASMTL6",131,0)
 . . S EASKP("I")=EASKP("I")+1
"RTN","EASMTL6",132,0)
 . S @EASTMP@(EASIEN)=EATYP ; Build entry
"RTN","EASMTL6",133,0)
 . S EASKP("CNT")=EASKP("CNT")+1
"RTN","EASMTL6",134,0)
 . I $D(IO("Q")),$$S^%ZTLOAD("STOPPED BY USER") S EASABRT=1
"RTN","EASMTL6",135,0)
 Q
"RTN","EASMTL6",136,0)
 ;
"RTN","EASMTL6",137,0)
OWNED(PTR1,EAIEN) ;  Check - Does this facility "own" this means test
"RTN","EASMTL6",138,0)
 ;  Returns '1' if means test 'owned' by facility
"RTN","EASMTL6",139,0)
 ;          '0' if not owned
"RTN","EASMTL6",140,0)
 ;
"RTN","EASMTL6",141,0)
 N MTNODE,MTLST,MTOWN,RSLT
"RTN","EASMTL6",142,0)
 ;
"RTN","EASMTL6",143,0)
 S RSLT=0
"RTN","EASMTL6",144,0)
 S MTLST=$$LST^DGMTU(PTR1)
"RTN","EASMTL6",145,0)
 I $P(MTLST,U,1)>0 D
"RTN","EASMTL6",146,0)
 . S MTNODE=$G(^DGMT(408.31,$P(MTLST,U,1),0))
"RTN","EASMTL6",147,0)
 . S MTOWN=$$GET1^DIQ(408.34,$P(MTNODE,U,23),.01)
"RTN","EASMTL6",148,0)
 . I MTOWN="VAMC" S RSLT=1 Q
"RTN","EASMTL6",149,0)
 . I MTOWN="DCD",$$VERSION^XPDUTL("IVMC") S RSLT=1
"RTN","EASMTL6",150,0)
 ;
"RTN","EASMTL6",151,0)
 ;; If another facility 'owns' this MT, update MT Status information
"RTN","EASMTL6",152,0)
 I 'RSLT D
"RTN","EASMTL6",153,0)
 . Q:'EAIEN
"RTN","EASMTL6",154,0)
 . S DIE="^EAS(713.2,",DA=EAIEN
"RTN","EASMTL6",155,0)
 . S DR="4///YES;5///TODAY;7///MT 'OWNED' BY ANOTHER FACILITY;9///NO;12///NO;18///NO"
"RTN","EASMTL6",156,0)
 . D ^DIE K DIE
"RTN","EASMTL6",157,0)
 ;
"RTN","EASMTL6",158,0)
 Q RSLT
"RTN","EASMTL6",159,0)
 ;
"RTN","EASMTL6",160,0)
PRINT(EASTMP,EATYP) ; Print letters
"RTN","EASMTL6",161,0)
 N EASIEN,EASABRT,Y
"RTN","EASMTL6",162,0)
 ;
"RTN","EASMTL6",163,0)
 U IO
"RTN","EASMTL6",164,0)
 S EASIEN=0
"RTN","EASMTL6",165,0)
 F  S EASIEN=$O(@EASTMP@(EASIEN)) Q:'EASIEN  D  Q:$G(EASABRT)
"RTN","EASMTL6",166,0)
 . D LETTER^EASMTL6A(EASIEN,EATYP) ; Print letter
"RTN","EASMTL6",167,0)
 . D UPDSTAT(EASIEN,EATYP) ; Update Letter status file, #713.2
"RTN","EASMTL6",168,0)
 . I $D(IO("Q")),$$S^%ZTLOAD("STOPPED BY USER") S EASABRT=1 Q
"RTN","EASMTL6",169,0)
 . I '$D(IO("Q")),$E(IOST,1,2)="C-" D
"RTN","EASMTL6",170,0)
 . . S DIR(0)="E"
"RTN","EASMTL6",171,0)
 . . D ^DIR K DIR
"RTN","EASMTL6",172,0)
 . . S:'Y EASABRT=1
"RTN","EASMTL6",173,0)
 Q
"RTN","EASMTL6",174,0)
 ;
"RTN","EASMTL6",175,0)
THRSHLD(EATYP,EASIEN) ; Check threshold for letter types
"RTN","EASMTL6",176,0)
 ; Input
"RTN","EASMTL6",177,0)
 ;    EATYP  - Letter type to print
"RTN","EASMTL6",178,0)
 ;    EASIEN - IEN for file #713.2
"RTN","EASMTL6",179,0)
 ;
"RTN","EASMTL6",180,0)
 ; Output
"RTN","EASMTL6",181,0)
 ;    RSLT = 1: Letter is inside threshold to print
"RTN","EASMTL6",182,0)
 ;           0: Letter is outside threshold (Don't print)
"RTN","EASMTL6",183,0)
 ;
"RTN","EASMTL6",184,0)
 N DIFF,THRESH,RSLT,ANVDT,MTDT
"RTN","EASMTL6",185,0)
 ;
"RTN","EASMTL6",186,0)
 S RSLT=1
"RTN","EASMTL6",187,0)
 Q:'$G(EATYP)
"RTN","EASMTL6",188,0)
 S THRESH=$S(EATYP=1:60,EATYP=2:30,1:0)
"RTN","EASMTL6",189,0)
 S MTDT=$$GET1^DIQ(713.2,EASIEN,3,"I")
"RTN","EASMTL6",190,0)
 S ANVDT=$$ADDLEAP^EASMTUTL(MTDT)
"RTN","EASMTL6",191,0)
 S DIFF=$$FMDIFF^XLFDT(ANVDT,$$DT^XLFDT)
"RTN","EASMTL6",192,0)
 I DIFF>THRESH S RSLT=0
"RTN","EASMTL6",193,0)
 Q RSLT
"RTN","EASMTL6",194,0)
 ;
"RTN","EASMTL6",195,0)
NOPRT(EATYP,EASIEN) ; Letter not printed, update Letter Status file #713.2
"RTN","EASMTL6",196,0)
 ; Input
"RTN","EASMTL6",197,0)
 ;    EATYP  - Letter type to print
"RTN","EASMTL6",198,0)
 ;    EASIEN - IEN for file #713.2
"RTN","EASMTL6",199,0)
 ;
"RTN","EASMTL6",200,0)
 N DIE,DR,DA,LTR
"RTN","EASMTL6",201,0)
 Q:'$G(EATYP)  Q:'$G(EASIEN)
"RTN","EASMTL6",202,0)
 S DIE="^EAS(713.2,",DA=EASIEN
"RTN","EASMTL6",203,0)
 S LTR=$S(EATYP=1:9,EATYP=2:12,EATYP=4:18,1:0)
"RTN","EASMTL6",204,0)
 Q:'LTR
"RTN","EASMTL6",205,0)
 ; Set current letter print statuses = "N"
"RTN","EASMTL6",206,0)
 S DR=LTR_"///0;"_(LTR+1)_"///0"
"RTN","EASMTL6",207,0)
 ; If current letter is not 0-day letter, set next letter print = "Y"
"RTN","EASMTL6",208,0)
 S:LTR'=18 DR=DR_";"_$S(LTR=9:12,1:18)_"///1"
"RTN","EASMTL6",209,0)
 D ^DIE
"RTN","EASMTL6",210,0)
 Q
"RTN","EASMTL6",211,0)
 ;
"RTN","EASMTL6",212,0)
UPDSTAT(EASN,EAX) ; Update Letter status file, #713.2
"RTN","EASMTL6",213,0)
 N DIE,DR,DA,EAPD,EAFLG,NXTFLG
"RTN","EASMTL6",214,0)
 ;
"RTN","EASMTL6",215,0)
 S DIE="^EAS(713.2,",DA=EASN
"RTN","EASMTL6",216,0)
 S DR=$S(EAX=1:10,EAX=2:13,EAX=4:19,1:0)
"RTN","EASMTL6",217,0)
 Q:'DR
"RTN","EASMTL6",218,0)
 S EAPD=DR_".5",EAFLG=DR-1
"RTN","EASMTL6",219,0)
 S DR=DR_"///1;"_EAPD_"///^S X=$$DT^XLFDT;"_EAFLG_"///0"
"RTN","EASMTL6",220,0)
 S NXTFLG=$S(EAFLG=9:12,EAFLG=12:18,1:0)
"RTN","EASMTL6",221,0)
 S:NXTFLG>0 DR=DR_";"_NXTFLG_"///1"
"RTN","EASMTL6",222,0)
 D ^DIE K DIE
"RTN","EASMTL6",223,0)
 D CLRFLG^EASMTUTL(EAX,EASN)
"RTN","EASMTL6",224,0)
 Q
"RTN","EASMTL6",225,0)
 ;
"RTN","EASMTL6",226,0)
FACNUM() ;  Get facility number
"RTN","EASMTL6",227,0)
 N RSLT,DIR,Y
"RTN","EASMTL6",228,0)
 ;
"RTN","EASMTL6",229,0)
 S DIR(0)="P^4:EMZ"
"RTN","EASMTL6",230,0)
 S DIR("S")="I '$P($G(^DIC(4,Y,99)),U,4)"
"RTN","EASMTL6",231,0)
 D ^DIR K DIR
"RTN","EASMTL6",232,0)
 I $D(DIRUT) S RSLT=0
"RTN","EASMTL6",233,0)
 E  S RSLT=+Y_"^"_$P($G(^DIC(4,+Y,99)),U,1)
"RTN","EASMTL6",234,0)
 ;
"RTN","EASMTL6",235,0)
 Q RSLT
"RTN","EASMTL6",236,0)
 ;
"RTN","EASMTL6",237,0)
GETFAC(EADFN,EASARY) ;  set facility return address information
"RTN","EASMTL6",238,0)
 N EASFAC,EAX,EASF,EAS4
"RTN","EASMTL6",239,0)
 ;
"RTN","EASMTL6",240,0)
 I $$GET1^DIQ(713,1,9,"I") D
"RTN","EASMTL6",241,0)
 . S EASFAC=$$GET1^DIQ(2,EADFN,27.02,"I")
"RTN","EASMTL6",242,0)
 . Q:'EASFAC
"RTN","EASMTL6",243,0)
 . ;; Check for inactive flag
"RTN","EASMTL6",244,0)
 . Q:$$GET1^DIQ(4,EASFAC,101,"I")
"RTN","EASMTL6",245,0)
 . D GETS^DIQ(4,EASFAC,".01;1.01;1.02;1.03;1.04;.02;100","EI","EAS4")
"RTN","EASMTL6",246,0)
 . S EASF=EASFAC_","
"RTN","EASMTL6",247,0)
 . ;; Check for valid address information
"RTN","EASMTL6",248,0)
 . I EAS4(4,EASF,1.01,"E")]"",EAS4(4,EASF,1.03,"E")]"",EAS4(4,EASF,.02,"E")]"" S EASARY("TYP")="P"
"RTN","EASMTL6",249,0)
 ;
"RTN","EASMTL6",250,0)
 I $G(EASARY("TYP"))'="P" D
"RTN","EASMTL6",251,0)
 . S EASFAC=$$SITE^VASITE
"RTN","EASMTL6",252,0)
 . D GETS^DIQ(4,+EASFAC,".01;1.01;1.02;1.03;1.04;.02;100","EI","EAS4")
"RTN","EASMTL6",253,0)
 . S EASARY("TYP")="F"
"RTN","EASMTL6",254,0)
 ;
"RTN","EASMTL6",255,0)
 S EASARY("FACNUM")=+EASFAC
"RTN","EASMTL6",256,0)
 S EASARY("FAC")=$$GET1^DIQ(4,+EASFAC,.01,"I")
"RTN","EASMTL6",257,0)
 F EAX=1.01,1.02,1.03,1.04,100 D
"RTN","EASMTL6",258,0)
 .  S EASARY(EAX)=EAS4(4,+EASFAC_",",EAX,"E")
"RTN","EASMTL6",259,0)
 S EASARY(.02)=EAS4(4,+EASFAC_",",.02,"E")_"^"_$$GET1^DIQ(5,EAS4(4,+EASFAC_",",.02,"I"),1)
"RTN","EASMTL6",260,0)
 Q
"RTN","EASMTL6A")
0^3^B21531838
"RTN","EASMTL6A",1,0)
EASMTL6A ; MIN/TCM ALB/SCK/PHH - AUTOMATED MEANS TEST LETTER-PRINT LETTERS CONT ; 3/10/03 4:07pm
"RTN","EASMTL6A",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,14,15,29,28,54**;MAR 15,2001
"RTN","EASMTL6A",3,0)
 ;
"RTN","EASMTL6A",4,0)
LETTER(EASN,TYPE) ;Print letter
"RTN","EASMTL6A",5,0)
 ; Input
"RTN","EASMTL6A",6,0)
 ;     EASN    - File #713.2 IEN
"RTN","EASMTL6A",7,0)
 ;     TYPE    - Letter type
"RTN","EASMTL6A",8,0)
 ;
"RTN","EASMTL6A",9,0)
 N DFN,EASADD,EASIN,EASNME,EALNE,EASFAC,MSG,TAB,EAFIEN,EAX,LINE,EASANV,EASX,VADM,VAROOT,OFFSET,EASPTR,EASLIEN,EASITE,EASRTE,EASDEM,POP
"RTN","EASMTL6A",10,0)
 ;
"RTN","EASMTL6A",11,0)
 S TAB=3 ; Tab spacing for letters
"RTN","EASMTL6A",12,0)
 S OFFSET=+$$GET1^DIQ(713,1,10) ; Get print offset for address
"RTN","EASMTL6A",13,0)
 ;
"RTN","EASMTL6A",14,0)
 ;  Get patient data for letter
"RTN","EASMTL6A",15,0)
 S EASPTR=$$GET1^DIQ(713.2,EASN,2,"I")
"RTN","EASMTL6A",16,0)
 I EASPTR]"" S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTL6A",17,0)
 E  S DFN=-1
"RTN","EASMTL6A",18,0)
 ; Get patient mailing information
"RTN","EASMTL6A",19,0)
 D GETPAT(DFN,.EASDEM,.EASADD)
"RTN","EASMTL6A",20,0)
 ;  Get return address info
"RTN","EASMTL6A",21,0)
 D GETFAC^EASMTL6(DFN,.EASFAC)
"RTN","EASMTL6A",22,0)
 ;
"RTN","EASMTL6A",23,0)
 W @IOF
"RTN","EASMTL6A",24,0)
 I EASFAC(100)]"" D
"RTN","EASMTL6A",25,0)
 . W !!?TAB+OFFSET,EASFAC(100)
"RTN","EASMTL6A",26,0)
 E  D
"RTN","EASMTL6A",27,0)
 . W !!?TAB+OFFSET,"VA MEDICAL CENTER"
"RTN","EASMTL6A",28,0)
 W ?(IOM-10),$E(EASDEM(1),1,1),EASDEM(2)
"RTN","EASMTL6A",29,0)
 ;
"RTN","EASMTL6A",30,0)
 W !?TAB+OFFSET,EASFAC(1.01)
"RTN","EASMTL6A",31,0)
 I EASFAC(1.02)]"" W !?TAB+OFFSET,EASFAC(1.02)
"RTN","EASMTL6A",32,0)
 W !?TAB+OFFSET,EASFAC(1.03)_" "_$P(EASFAC(.02),U,2)_" "_EASFAC(1.04)
"RTN","EASMTL6A",33,0)
 W !!!?TAB+OFFSET,$$FMTE^XLFDT(DT,1)
"RTN","EASMTL6A",34,0)
 ;
"RTN","EASMTL6A",35,0)
 ;; generic test letter setup
"RTN","EASMTL6A",36,0)
 I DFN>0 D
"RTN","EASMTL6A",37,0)
 . S EASNME("FILE")=2,EASNME("IENS")=DFN,EASNME("FIELD")=.01
"RTN","EASMTL6A",38,0)
 . W !!!!?TAB+OFFSET,$$NAMEFMT^XLFNAME(.EASNME,"G")
"RTN","EASMTL6A",39,0)
 E  D
"RTN","EASMTL6A",40,0)
 . W !!!!?TAB+OFFSET,EASDEM(1)
"RTN","EASMTL6A",41,0)
 ;;
"RTN","EASMTL6A",42,0)
 W !?TAB+OFFSET,EASADD(1)
"RTN","EASMTL6A",43,0)
 ;
"RTN","EASMTL6A",44,0)
 I EASADD(2)]"" W !?TAB+OFFSET,EASADD(2)
"RTN","EASMTL6A",45,0)
 W !?TAB+OFFSET,EASADD(4)
"RTN","EASMTL6A",46,0)
 I +EASADD(5) W " ",$$GET1^DIQ(5,$P(EASADD(5),U),1)
"RTN","EASMTL6A",47,0)
 W " ",$P(EASADD(11),U,2)
"RTN","EASMTL6A",48,0)
 ;
"RTN","EASMTL6A",49,0)
 S EASANV=$$GET1^DIQ(713.2,EASN,3,"I")
"RTN","EASMTL6A",50,0)
 W !!!!,?TAB,"MEANS TEST ANNIVERSARY DATE: ",$$FMTE^XLFDT($$ADDLEAP^EASMTUTL(EASANV))
"RTN","EASMTL6A",51,0)
 ;
"RTN","EASMTL6A",52,0)
 S EASX=$P(EASDEM(5),U)
"RTN","EASMTL6A",53,0)
 ;; Patch 15
"RTN","EASMTL6A",54,0)
 W !!,?TAB,"Dear ",$S(EASX="M":"Mr. ",EASX="F":"Ms. ",1:"Mr./Ms. ")
"RTN","EASMTL6A",55,0)
 W $S(DFN>0:$$NAMEFMT^XLFNAME(.EASNME,"O","M"),1:"TEST"),":"
"RTN","EASMTL6A",56,0)
 ;;
"RTN","EASMTL6A",57,0)
 ;  Print letter body
"RTN","EASMTL6A",58,0)
 S EASLIEN=$O(^EAS(713.3,"C",TYPE,0))
"RTN","EASMTL6A",59,0)
 Q:'EASLIEN
"RTN","EASMTL6A",60,0)
 S EALNE=0
"RTN","EASMTL6A",61,0)
 ;
"RTN","EASMTL6A",62,0)
 W !
"RTN","EASMTL6A",63,0)
 F  S EALNE=$O(^EAS(713.3,EASLIEN,1,EALNE)) Q:'EALNE  D
"RTN","EASMTL6A",64,0)
 . S LINE=^EAS(713.3,EASLIEN,1,EALNE,0)
"RTN","EASMTL6A",65,0)
 . I LINE["|ANNVDT|" W !?TAB,$P(LINE,"|ANNVDT|",1),$$FMTE^XLFDT($$ADDLEAP^EASMTUTL(EASANV)),$P(LINE,"|ANNVDT|",2) Q
"RTN","EASMTL6A",66,0)
 . W !?TAB,LINE
"RTN","EASMTL6A",67,0)
 ;
"RTN","EASMTL6A",68,0)
 ; Retrieve division section of letter
"RTN","EASMTL6A",69,0)
 S EAFIEN=$O(^EAS(713.3,EASLIEN,2,"B",+EASFAC("FACNUM"),0))
"RTN","EASMTL6A",70,0)
 ;
"RTN","EASMTL6A",71,0)
 I 'EAFIEN D  ; Print default signature block
"RTN","EASMTL6A",72,0)
 . N EAX,LINE
"RTN","EASMTL6A",73,0)
 . F EAX=1:1:9  D
"RTN","EASMTL6A",74,0)
 . . S LINE=$P($T(DEFSIG+EAX),";;",2)
"RTN","EASMTL6A",75,0)
 . . I LINE["|FAC|" W !?TAB,$P(LINE,"|FAC|",1),$S(EASFAC(100)]"":EASFAC(100),1:"VA Medical Center"),$P(LINE,"|FAC|",2) Q
"RTN","EASMTL6A",76,0)
 . . W !?TAB,LINE
"RTN","EASMTL6A",77,0)
 ;
"RTN","EASMTL6A",78,0)
 I EAFIEN D  ; Print division/facility signature block
"RTN","EASMTL6A",79,0)
 . S EALNE=0
"RTN","EASMTL6A",80,0)
 . F  S EALNE=$O(^EAS(713.3,EASLIEN,2,EAFIEN,1,EALNE)) Q:'EALNE  D
"RTN","EASMTL6A",81,0)
 . . W !?TAB,^EAS(713.3,EASLIEN,2,EAFIEN,1,EALNE,0)
"RTN","EASMTL6A",82,0)
 ;
"RTN","EASMTL6A",83,0)
 W !!?TAB,"Enclosure"
"RTN","EASMTL6A",84,0)
 Q
"RTN","EASMTL6A",85,0)
 ;
"RTN","EASMTL6A",86,0)
GETPAT(DFN,EASDEM,EASADD) ; Get patient information
"RTN","EASMTL6A",87,0)
 N VAROOT,VA
"RTN","EASMTL6A",88,0)
 ;
"RTN","EASMTL6A",89,0)
 ;; Patch 15, Generic test letter
"RTN","EASMTL6A",90,0)
 I DFN<0 D  Q
"RTN","EASMTL6A",91,0)
 . S EASDEM(1)="TEST LETTER (DO NOT MAIL!)"
"RTN","EASMTL6A",92,0)
 . S EASDEM(2)="6789"
"RTN","EASMTL6A",93,0)
 . S EASDEM(5)="M"
"RTN","EASMTL6A",94,0)
 . S EASADD(1)="THIS IS A TEST LETTER STREET ADDRESS"
"RTN","EASMTL6A",95,0)
 . S EASADD(2)=""
"RTN","EASMTL6A",96,0)
 . S EASADD(4)="ANYTOWN"
"RTN","EASMTL6A",97,0)
 . S EASADD(5)="36^NEW YORK"
"RTN","EASMTL6A",98,0)
 . S EASADD(11)="111110000^11111-0000"
"RTN","EASMTL6A",99,0)
 ;; End patch 15
"RTN","EASMTL6A",100,0)
 ;
"RTN","EASMTL6A",101,0)
 S VAROOT="EASADD"
"RTN","EASMTL6A",102,0)
 D ADD^VADPT
"RTN","EASMTL6A",103,0)
 ;
"RTN","EASMTL6A",104,0)
 S VAROOT="EASDEM"
"RTN","EASMTL6A",105,0)
 D DEM^VADPT
"RTN","EASMTL6A",106,0)
 ;
"RTN","EASMTL6A",107,0)
 D PID^VADPT6
"RTN","EASMTL6A",108,0)
 S EASDEM(2)=VA("BID")
"RTN","EASMTL6A",109,0)
 Q
"RTN","EASMTL6A",110,0)
 ;
"RTN","EASMTL6A",111,0)
CHKADR(EASPTR) ; Check for valid address
"RTN","EASMTL6A",112,0)
 N EASADD,RSLT,DFN,VAROOT
"RTN","EASMTL6A",113,0)
 ;
"RTN","EASMTL6A",114,0)
 S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTL6A",115,0)
 S RSLT=1
"RTN","EASMTL6A",116,0)
 S VAROOT="EASADD"
"RTN","EASMTL6A",117,0)
 D ADD^VADPT
"RTN","EASMTL6A",118,0)
 ;; Check for valid mailing address
"RTN","EASMTL6A",119,0)
 I EASADD(1)]"",EASADD(4)]"",EASADD(5)]"",EASADD(11)]"" S RSLT=0
"RTN","EASMTL6A",120,0)
 ;; Check for Bad Address Indicator
"RTN","EASMTL6A",121,0)
 S EASADD("BAI")=$$BADADR^DGUTL3(DFN),$P(EASADD("BAI"),U,2)=$$EXTERNAL^DILFD(2,.121,"",+EASADD("BAI"))
"RTN","EASMTL6A",122,0)
 S:'RSLT&(EASADD("BAI")) RSLT=1
"RTN","EASMTL6A",123,0)
 D:RSLT ADRERR^EASMTUTL(.EASADD,DFN)
"RTN","EASMTL6A",124,0)
 Q $G(RSLT)
"RTN","EASMTL6A",125,0)
 ;
"RTN","EASMTL6A",126,0)
DEFSIG ; Default closing and signature block
"RTN","EASMTL6A",127,0)
 ;;Thank you for your assistance and cooperation.  If you have any
"RTN","EASMTL6A",128,0)
 ;;questions or need assistance in the completion of the information
"RTN","EASMTL6A",129,0)
 ;;requested, please contact the |FAC| Business 
"RTN","EASMTL6A",130,0)
 ;;Office between 8:00am and 4:00pm Monday through Friday.
"RTN","EASMTL6A",131,0)
 ;;
"RTN","EASMTL6A",132,0)
 ;;Sincerely,
"RTN","EASMTL6A",133,0)
 ;;
"RTN","EASMTL6A",134,0)
 ;;
"RTN","EASMTL6A",135,0)
 ;;
"RTN","EASMTL8")
0^4^B21583313
"RTN","EASMTL8",1,0)
EASMTL8 ;618/TCM ALB/SCK/PHH - AUTOMATED MEANS TEST LETTER, 20-DAY REPORT OF CONTACT FORM ; 07/17/01
"RTN","EASMTL8",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,54**;MAR 15,2001
"RTN","EASMTL8",3,0)
 ;
"RTN","EASMTL8",4,0)
QUE ;
"RTN","EASMTL8",5,0)
 N EASTMP,DIR,DUOUT,DTOUT,DIRUT
"RTN","EASMTL8",6,0)
 ;
"RTN","EASMTL8",7,0)
 S EASTMP="^TMP(""EASROC"",$J)"
"RTN","EASMTL8",8,0)
 K @EASTMP
"RTN","EASMTL8",9,0)
 ;
"RTN","EASMTL8",10,0)
START ;
"RTN","EASMTL8",11,0)
 S DIR(0)="PAO^713.2:EMZ",DIR("A")="Select Patient: "
"RTN","EASMTL8",12,0)
 S DIR("?")="Select patient or press ENTER when finished"
"RTN","EASMTL8",13,0)
 D ^DIR K DIR
"RTN","EASMTL8",14,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","EASMTL8",15,0)
 S @EASTMP@(+Y)=""
"RTN","EASMTL8",16,0)
 I '$D(DIRUT) G START
"RTN","EASMTL8",17,0)
END ;
"RTN","EASMTL8",18,0)
 S ZTSAVE("EASTMP")=""
"RTN","EASMTL8",19,0)
 D EN^XUTMDEVQ("PRINT^EASMTL8","EAS MT REPORT OF CONTACTS",.ZTSAVE)
"RTN","EASMTL8",20,0)
 Q
"RTN","EASMTL8",21,0)
 ;
"RTN","EASMTL8",22,0)
PRINT ;
"RTN","EASMTL8",23,0)
 N EASIEN
"RTN","EASMTL8",24,0)
 ;
"RTN","EASMTL8",25,0)
 S EASIEN=0
"RTN","EASMTL8",26,0)
 F  S EASIEN=$O(@EASTMP@(EASIEN)) Q:'EASIEN  D  Q:$D(DIRUT)
"RTN","EASMTL8",27,0)
 . D FORM(EASIEN)
"RTN","EASMTL8",28,0)
 . I $E(IOST,1,2)="C-" D
"RTN","EASMTL8",29,0)
 . . S DIR(0)="E"
"RTN","EASMTL8",30,0)
 . . D ^DIR K DIR
"RTN","EASMTL8",31,0)
 . . I 'Y S DIRUT=1
"RTN","EASMTL8",32,0)
 . . W @IOF
"RTN","EASMTL8",33,0)
 K @EASTMP
"RTN","EASMTL8",34,0)
 Q
"RTN","EASMTL8",35,0)
 ;
"RTN","EASMTL8",36,0)
FORM(EASIEN) ; Print 20 day form
"RTN","EASMTL8",37,0)
 N DFN,EASDEM,EASADD,EASHDR,EASFAC,EASLIEN,ULC,ULNE,EASANV,LINE,EASOK,EASDEV,XL,EAX,EASPTR
"RTN","EASMTL8",38,0)
 ;
"RTN","EASMTL8",39,0)
 S EASANV=$$GET1^DIQ(713.2,EASIEN,3,"I")
"RTN","EASMTL8",40,0)
 S EASPTR=$$GET1^DIQ(713.2,EASIEN,2,"I")
"RTN","EASMTL8",41,0)
 S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTL8",42,0)
 D GETPAT^EASMTL6A(DFN,.EASDEM,.EASADD)
"RTN","EASMTL8",43,0)
 D GETFAC^EASMTL6(DFN,.EASFAC)
"RTN","EASMTL8",44,0)
 ;
"RTN","EASMTL8",45,0)
 ;  Merge FileMan data arrays into more usable formats
"RTN","EASMTL8",46,0)
 M EASHDR("F")=EASFAC
"RTN","EASMTL8",47,0)
 M EASHDR("D")=EASDEM
"RTN","EASMTL8",48,0)
 M EASHDR("A")=EASADD
"RTN","EASMTL8",49,0)
 ;
"RTN","EASMTL8",50,0)
 D HDR(.EASHDR)
"RTN","EASMTL8",51,0)
 ;
"RTN","EASMTL8",52,0)
 W !?5,"Means Test Anniversary Date: ",$$FMTE^XLFDT($$ADDLEAP^EASMTUTL(EASANV),"D")
"RTN","EASMTL8",53,0)
 ;
"RTN","EASMTL8",54,0)
 S EASLIEN=$O(^EAS(713.3,"C",3,0))
"RTN","EASMTL8",55,0)
 Q:'EASLIEN
"RTN","EASMTL8",56,0)
 S EALNE=0
"RTN","EASMTL8",57,0)
 I $D(^EAS(713.3,EASLIEN,1)) D  S EASOK=1
"RTN","EASMTL8",58,0)
 . F  S EALNE=$O(^EAS(713.3,EASLIEN,1,EALNE)) Q:'EALNE  D
"RTN","EASMTL8",59,0)
 . . S LINE=^EAS(713.3,EASLIEN,1,EALNE,0)
"RTN","EASMTL8",60,0)
 . . I LINE["|ANNVDT|" W !?6,$P(LINE,"|ANNVDT|",1)," ",$$FMTE^XLFDT(EASANV,"D"),$P(LINE,"|ANNVDT|",2) Q
"RTN","EASMTL8",61,0)
 . . W !?6,LINE
"RTN","EASMTL8",62,0)
 ;
"RTN","EASMTL8",63,0)
 I $D(^EAS(713.3,EASLIEN,2)) D  S EASOK=1
"RTN","EASMTL8",64,0)
 . S EALNE=0
"RTN","EASMTL8",65,0)
 . F  S EALNE=$O(^EAS(713.3,EASLIEN,2,EALNE)) Q:'EALNE  D
"RTN","EASMTL8",66,0)
 . . S LINE=^EAS(713.3,EASLIEN,2,EALNE,0)
"RTN","EASMTL8",67,0)
 . . W !,LINE
"RTN","EASMTL8",68,0)
 ;
"RTN","EASMTL8",69,0)
 F EAX=0:0 Q:($Y+8)>IOSL  W !
"RTN","EASMTL8",70,0)
 W ! F XL=1:1:IOM-1 W "-"
"RTN","EASMTL8",71,0)
 W !,"| Division or Section",?40,"| Executed By (signature and title)",?(IOM-1),"|"
"RTN","EASMTL8",72,0)
 W !,"|",?40,"|",?(IOM-1),"|"
"RTN","EASMTL8",73,0)
 W !,"|",?40,"|",?(IOM-1),"|"
"RTN","EASMTL8",74,0)
 W ! F XL=1:1:IOM-1 W "-"
"RTN","EASMTL8",75,0)
 W !,?40,"PRINTED: ",$$FMTE^XLFDT($$NOW^XLFDT,"P")
"RTN","EASMTL8",76,0)
 Q
"RTN","EASMTL8",77,0)
 ;
"RTN","EASMTL8",78,0)
HDR(EASHDR) ; Print form header for report of contact
"RTN","EASMTL8",79,0)
 ; Input
"RTN","EASMTL8",80,0)
 ;    EASHDR - Header information array
"RTN","EASMTL8",81,0)
 ;
"RTN","EASMTL8",82,0)
 N EALNE,EAX,TS1,TS2,TS3,TS4
"RTN","EASMTL8",83,0)
 ;
"RTN","EASMTL8",84,0)
 Q:'$D(EASHDR)
"RTN","EASMTL8",85,0)
 D SETLNE(.EALNE)
"RTN","EASMTL8",86,0)
 ;
"RTN","EASMTL8",87,0)
 S TS2=40,TS3=58,TS4=$G(IOM)-1
"RTN","EASMTL8",88,0)
 ;W $E(EALNE("DD"),1,IOM)
"RTN","EASMTL8",89,0)
 W !,"D E P A R T M E N T  O F  V E T E R A N  A F F A I R S"
"RTN","EASMTL8",90,0)
 W !,$E(EALNE("DD"),1,IOM)
"RTN","EASMTL8",91,0)
 W !,"| REPORT OF CONTACT",?TS2,"| VA Office",?TS3,"| Identification No.",?TS4,"|"
"RTN","EASMTL8",92,0)
 W !,"| Note: This form must be filled out in",?TS2,"|",?TS3,"| ",?TS4,"|"
"RTN","EASMTL8",93,0)
 W !,"| ink or on typewriter as it becomes a"
"RTN","EASMTL8",94,0)
 W ?TS2,"| ",?TS3,"| ",$P(EASHDR("D",2),U,2),?TS4,"|"
"RTN","EASMTL8",95,0)
 W !,"| permanent record in veterans' folders.",?TS2,"|",?TS3,"|",?TS4,"|"
"RTN","EASMTL8",96,0)
 W !,$E(EALNE("D"),1,TS4)
"RTN","EASMTL8",97,0)
 W !,"| Last Name-First Name-Middle Name (Type or print)",?TS3,"| Date of Contact",?TS4,"|"
"RTN","EASMTL8",98,0)
 W !,"|",?TS3,"|",?TS4,"|"
"RTN","EASMTL8",99,0)
 W !,"| ",EASHDR("D",1),?TS3,"|",?TS4,"|"
"RTN","EASMTL8",100,0)
 W !,$E(EALNE("D"),1,TS4)
"RTN","EASMTL8",101,0)
 W !,"| Address of Veteran",?TS3,"| Telephone",?TS4,"|"
"RTN","EASMTL8",102,0)
 W !,"| ",EASHDR("A",1),?TS3,"| ",EASHDR("A",8),?TS4,"|"
"RTN","EASMTL8",103,0)
 I EASHDR("A",2)]"" W !,"| ",EASHDR("A",2),?TS3,"|",?TS4,"|"
"RTN","EASMTL8",104,0)
 I EASHDR("A",3)]"" W !,"| ",EASHDR("A",3),?TS3,"|",?TS4,"|"
"RTN","EASMTL8",105,0)
 W !,"| ",EASHDR("A",4)_", "_$P(EASHDR("A",5),U,2)_"  "_$P(EASHDR("A",11),U,2),?TS3,"|",?TS4,"|"
"RTN","EASMTL8",106,0)
 W !,$E(EALNE("D"),1,TS4)
"RTN","EASMTL8",107,0)
 W !,"| Person Contacted",?TS3,"| Type of Contact",?TS4,"|"
"RTN","EASMTL8",108,0)
 W !,"|",?TS3,"| Personal/Telephone",?TS4,"|"
"RTN","EASMTL8",109,0)
 W !,"|",?TS3,"|",?TS4,"|"
"RTN","EASMTL8",110,0)
 W !,$E(EALNE("D"),1,TS4)
"RTN","EASMTL8",111,0)
 W !,"| Address of Person Contacted",?TS3,"| Telephone",?TS4,"|"
"RTN","EASMTL8",112,0)
 W !,"|",?TS3,"|",?TS4,"|"
"RTN","EASMTL8",113,0)
 W !,"|",?TS3,"|",?TS4,"|"
"RTN","EASMTL8",114,0)
 W !,"|",?TS3,"|",?TS4,"|"
"RTN","EASMTL8",115,0)
 W !,$E(EALNE("D"),1,TS4)
"RTN","EASMTL8",116,0)
 W !,"  Brief statement of information requested and given",!
"RTN","EASMTL8",117,0)
EXIT Q
"RTN","EASMTL8",118,0)
 ;
"RTN","EASMTL8",119,0)
 ;
"RTN","EASMTL8",120,0)
SETLNE(EALNE) ;
"RTN","EASMTL8",121,0)
 N RMAR
"RTN","EASMTL8",122,0)
 ;
"RTN","EASMTL8",123,0)
 S RMAR=$G(IOM) S:'RMAR RMAR=80
"RTN","EASMTL8",124,0)
 S EALNE("D")="",EALNE("DD")="",EALNE("UL")=""
"RTN","EASMTL8",125,0)
 S $P(EALNE("D"),"-",RMAR)=""
"RTN","EASMTL8",126,0)
 S $P(EALNE("DD"),"=",RMAR)=""
"RTN","EASMTL8",127,0)
 Q
"RTN","EASMTUTL")
0^5^B67554126
"RTN","EASMTUTL",1,0)
EASMTUTL ; ALB/SCK/BRM/PHH - AUTOMATED MEANS TEST LETTERS UTILITIES ; 7/2/01
"RTN","EASMTUTL",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**3,14,15,29,22,54**;MAR 15,2001
"RTN","EASMTUTL",3,0)
 ;
"RTN","EASMTUTL",4,0)
 ;
"RTN","EASMTUTL",5,0)
PAUSE ;  Screen pause, user must press key to continue
"RTN","EASMTUTL",6,0)
 S DIR(0)="FAO",DIR("A")="Press any key to continue..."
"RTN","EASMTUTL",7,0)
 D ^DIR K DIR
"RTN","EASMTUTL",8,0)
 Q
"RTN","EASMTUTL",9,0)
 ;
"RTN","EASMTUTL",10,0)
CLRFLG(EAX,DA) ; Clears flags in File #713.2, For development
"RTN","EASMTUTL",11,0)
 N DIE,DR
"RTN","EASMTUTL",12,0)
 ;
"RTN","EASMTUTL",13,0)
 Q:EAX=1
"RTN","EASMTUTL",14,0)
 S:EAX=2 DR="9///0"
"RTN","EASMTUTL",15,0)
 S:EAX=3 DR="9///0;12///0"
"RTN","EASMTUTL",16,0)
 S:EAX=4 DR="9///0;12///0"
"RTN","EASMTUTL",17,0)
 S:EAX=0 DR="9///0;12///0;18///0"
"RTN","EASMTUTL",18,0)
 S DIE="^EAS(713.2,"
"RTN","EASMTUTL",19,0)
 D ^DIE K DIE
"RTN","EASMTUTL",20,0)
 Q
"RTN","EASMTUTL",21,0)
 ;
"RTN","EASMTUTL",22,0)
LOCK(ACTION) ; Flag IN USE field in EAS Parameters file, #713
"RTN","EASMTUTL",23,0)
 ; Input
"RTN","EASMTUTL",24,0)
 ;   ACTION - Locking action
"RTN","EASMTUTL",25,0)
 ;            1 = Flag IN USE for Automated Generator is running
"RTN","EASMTUTL",26,0)
 ;            0 = Flag IN USE for Automated Generator is not running
"RTN","EASMTUTL",27,0)
 ; Output
"RTN","EASMTUTL",28,0)
 ;        1 if action was successful
"RTN","EASMTUTL",29,0)
 ;        0 if action was not successful
"RTN","EASMTUTL",30,0)
 N RSLT
"RTN","EASMTUTL",31,0)
 ;
"RTN","EASMTUTL",32,0)
 I ACTION,$D(^EAS(713,"ALOCK",1)) Q $G(RSLT)
"RTN","EASMTUTL",33,0)
 ;
"RTN","EASMTUTL",34,0)
 S DIE="^EAS(713,",DA=1,DR="30////^S X=ACTION"
"RTN","EASMTUTL",35,0)
 D ^DIE K DIE
"RTN","EASMTUTL",36,0)
 S RSLT=1
"RTN","EASMTUTL",37,0)
 Q +$G(RSLT)
"RTN","EASMTUTL",38,0)
 ;
"RTN","EASMTUTL",39,0)
ALERT(ERRMSG) ; Post an alert message to the EAS Letters Mail group
"RTN","EASMTUTL",40,0)
 N XMY,XMTEXT,XMDUZ,XMSUB,MSG
"RTN","EASMTUTL",41,0)
 ;
"RTN","EASMTUTL",42,0)
 S MSG(1)="Notification:"
"RTN","EASMTUTL",43,0)
 S MSG(2)=ERRMSG
"RTN","EASMTUTL",44,0)
 ;
"RTN","EASMTUTL",45,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTUTL",46,0)
 S XMTEXT="MSG("
"RTN","EASMTUTL",47,0)
 S XMDUZ="EAS Auto MT Letters"
"RTN","EASMTUTL",48,0)
 S XMSUB="EAS Means Test Letter's Notice"
"RTN","EASMTUTL",49,0)
 D ^XMD
"RTN","EASMTUTL",50,0)
 Q
"RTN","EASMTUTL",51,0)
 ;
"RTN","EASMTUTL",52,0)
ADRERR(EASADD,DFN) ; Error notification for missing or invalid patient address
"RTN","EASMTUTL",53,0)
 N MSG,XMY,XMTEXT,XMDUZ,XMSUB,VAROOT,EASDEM,VA,EASPRF
"RTN","EASMTUTL",54,0)
 ;
"RTN","EASMTUTL",55,0)
 S VAROOT="EASDEM"
"RTN","EASMTUTL",56,0)
 D DEM^VADPT
"RTN","EASMTUTL",57,0)
 D PID^VADPT6
"RTN","EASMTUTL",58,0)
 S EASPRF=$$GET1^DIQ(2,DFN,27.02)
"RTN","EASMTUTL",59,0)
 I EASPRF']"" S EASPRF="No Preferred Facility"
"RTN","EASMTUTL",60,0)
 ;
"RTN","EASMTUTL",61,0)
 S MSG(1)="The following patient does not have a complete permanent mailing"
"RTN","EASMTUTL",62,0)
 S MSG(2)="address.  A means test reminder letter could not be mailed."
"RTN","EASMTUTL",63,0)
 S MSG(3)=" "
"RTN","EASMTUTL",64,0)
 S MSG(4)="       Patient : "_EASDEM(1)
"RTN","EASMTUTL",65,0)
 S MSG(5)="        Last 4 : "_VA("BID")
"RTN","EASMTUTL",66,0)
 S MSG(6)="Address Line 1 : "_EASADD(1)
"RTN","EASMTUTL",67,0)
 S MSG(7)="          City : "_EASADD(4)
"RTN","EASMTUTL",68,0)
 S MSG(8)="         State : "_$P(EASADD(5),U,2)
"RTN","EASMTUTL",69,0)
 S MSG(9)="       Zipcode : "_$P(EASADD(11),U,2)
"RTN","EASMTUTL",70,0)
 S MSG(9.5)="      Bad Addr : "_$P(EASADD("BAI"),U,2)
"RTN","EASMTUTL",71,0)
 S MSG(10)=""
"RTN","EASMTUTL",72,0)
 S MSG(11)="           DFN : "_$G(DFN)
"RTN","EASMTUTL",73,0)
 S MSG(13)=""
"RTN","EASMTUTL",74,0)
 S MSG(14)="This patient's letter entry will stay in 'FLAGGED-TO-PRINT' status until"
"RTN","EASMTUTL",75,0)
 S MSG(15)="the address is corrected."
"RTN","EASMTUTL",76,0)
 ;
"RTN","EASMTUTL",77,0)
 I +EASADD(9)>0!(+EASADD(10)>0) D
"RTN","EASMTUTL",78,0)
 . S MSG(5.5)="** Temporary Address in effect **"
"RTN","EASMTUTL",79,0)
 S XMY("G.EAS MTLETTERS")=""
"RTN","EASMTUTL",80,0)
 S XMTEXT="MSG("
"RTN","EASMTUTL",81,0)
 S XMDUZ="EAS Auto MT Letters"
"RTN","EASMTUTL",82,0)
 S XMSUB="Incomplete/Bad Addr: "_EASPRF
"RTN","EASMTUTL",83,0)
 D ^XMD
"RTN","EASMTUTL",84,0)
 Q
"RTN","EASMTUTL",85,0)
 ;
"RTN","EASMTUTL",86,0)
CLRLCK ;  Clears IN USE field of the EAS MT PARAMETERS if an error occurs and locks the field
"RTN","EASMTUTL",87,0)
 N DIE,DR,DA
"RTN","EASMTUTL",88,0)
 ;
"RTN","EASMTUTL",89,0)
 S DA=1,DIE="^EAS(713,",DR="30///0"
"RTN","EASMTUTL",90,0)
 D ^DIE
"RTN","EASMTUTL",91,0)
 Q
"RTN","EASMTUTL",92,0)
 ;
"RTN","EASMTUTL",93,0)
PROHBIT ; Set or delete the Prohibit fields in the Patient Status file, #713.1
"RTN","EASMTUTL",94,0)
 N DIR,DIRUT,EASF,Y,X,EASIEN,DFN,DGFDA,FDAIEN,ERRMSG
"RTN","EASMTUTL",95,0)
 ;
"RTN","EASMTUTL",96,0)
 S DIR(0)="S^S:Set Prohibit Flag;R:Remove Prohibit Flag"
"RTN","EASMTUTL",97,0)
 S DIR("A")="Set or remove the MT Prohibit flag"
"RTN","EASMTUTL",98,0)
 S DIR("?")="Select 'S' to set flag, 'R' to remove the flag"
"RTN","EASMTUTL",99,0)
 D ^DIR K DIR
"RTN","EASMTUTL",100,0)
 Q:$D(DIRUT)
"RTN","EASMTUTL",101,0)
 S EASF=Y
"RTN","EASMTUTL",102,0)
 ;
"RTN","EASMTUTL",103,0)
 I EASF="R"!(EASF="r") D  Q:$D(DIRUT) 
"RTN","EASMTUTL",104,0)
 . S DIR(0)="PAO^713.1:EMZ"
"RTN","EASMTUTL",105,0)
 . S DIR("A")="Select Patient: "
"RTN","EASMTUTL",106,0)
 . D ^DIR K DIR
"RTN","EASMTUTL",107,0)
 . S EASIEN=+Y
"RTN","EASMTUTL",108,0)
 ;
"RTN","EASMTUTL",109,0)
 I EASF="S"!(EASF="s") D  Q:$D(DIRUT)
"RTN","EASMTUTL",110,0)
 . S DIR(0)="PAO^2:EMZ"
"RTN","EASMTUTL",111,0)
 . S DIR("A")="Select Patient: "
"RTN","EASMTUTL",112,0)
 . D ^DIR K DIR
"RTN","EASMTUTL",113,0)
 . Q:$D(DIRUT)
"RTN","EASMTUTL",114,0)
 . S DFN=+Y
"RTN","EASMTUTL",115,0)
 . I '$D(^EAS(713.1,"B",DFN)) D  Q:$D(DIRUT)
"RTN","EASMTUTL",116,0)
 . . S DIR(0)="Y",DIR("B")="YES"
"RTN","EASMTUTL",117,0)
 . . S DIR("A")="Add patient to the Patient Status File"
"RTN","EASMTUTL",118,0)
 . . D ^DIR K DIR
"RTN","EASMTUTL",119,0)
 . . Q:$D(DIRUT)
"RTN","EASMTUTL",120,0)
 . . I 'Y S DIRUT=1 Q
"RTN","EASMTUTL",121,0)
 . . S DGFDA(1,713.1,"+1,",.01)=DFN
"RTN","EASMTUTL",122,0)
 . . D UPDATE^DIE("","DGFDA(1)","FDAIEN","ERRMSG")
"RTN","EASMTUTL",123,0)
 . . S EASIEN=FDAIEN(1)
"RTN","EASMTUTL",124,0)
 . I $D(^EAS(713.1,"B",DFN)) S EASIEN=$O(^EAS(713.1,"B",DFN,0))
"RTN","EASMTUTL",125,0)
 ;
"RTN","EASMTUTL",126,0)
 Q:'$G(EASIEN)
"RTN","EASMTUTL",127,0)
 ;
"RTN","EASMTUTL",128,0)
 N DGFDA,DGIEN,DGEFF,DIR,DIRUT,DGERR,DIE
"RTN","EASMTUTL",129,0)
 ;
"RTN","EASMTUTL",130,0)
 S DGIEN=EASIEN_","
"RTN","EASMTUTL",131,0)
 I EASF="S" D
"RTN","EASMTUTL",132,0)
 . S DIR(0)="DAO^"_$$DT^XLFDT_"::EX"
"RTN","EASMTUTL",133,0)
 . S DIR("A")="Effective Date: "
"RTN","EASMTUTL",134,0)
 . D ^DIR K DIR
"RTN","EASMTUTL",135,0)
 . Q:$G(DIRUT)
"RTN","EASMTUTL",136,0)
 . S DGFDA(1,713.1,DGIEN,3)=Y
"RTN","EASMTUTL",137,0)
 . S DGFDA(1,713.1,DGIEN,2)=1
"RTN","EASMTUTL",138,0)
 . S DGFDA(1,713.1,DGIEN,5)=$$NOW^XLFDT
"RTN","EASMTUTL",139,0)
 . S DGFDA(1,713.1,DGIEN,4)=DUZ
"RTN","EASMTUTL",140,0)
 . D:$D(DGFDA) FILE^DIE("","DGFDA(1)","DGERR")
"RTN","EASMTUTL",141,0)
 . I $D(DGERR) D  Q
"RTN","EASMTUTL",142,0)
 . . D DSPLYER(.DGERR)
"RTN","EASMTUTL",143,0)
 . S DIE="^EAS(713.1,",DA=EASIEN,DR="10"
"RTN","EASMTUTL",144,0)
 . D ^DIE K DIE
"RTN","EASMTUTL",145,0)
 ;
"RTN","EASMTUTL",146,0)
 I EASF="R" D
"RTN","EASMTUTL",147,0)
 . S DGFDA(1,713.1,DGIEN,2)=0
"RTN","EASMTUTL",148,0)
 . S DGFDA(1,713.1,DGIEN,3)="@"
"RTN","EASMTUTL",149,0)
 . S DGFDA(1,713.1,DGIEN,5)="@"
"RTN","EASMTUTL",150,0)
 . S DGFDA(1,713.1,DGIEN,4)="@"
"RTN","EASMTUTL",151,0)
 . S DGFDA(1,713.1,DGIEN,10)="@"
"RTN","EASMTUTL",152,0)
 . D:$D(DGFDA) FILE^DIE("","DGFDA(1)","DGERR")
"RTN","EASMTUTL",153,0)
 . I $D(DGERR) D
"RTN","EASMTUTL",154,0)
 . . D DSPLYER(.DGERR)
"RTN","EASMTUTL",155,0)
 . E  W !!?3,"Prohibit Flag Removed from Patient.",!
"RTN","EASMTUTL",156,0)
 ;
"RTN","EASMTUTL",157,0)
 Q
"RTN","EASMTUTL",158,0)
 ;
"RTN","EASMTUTL",159,0)
DSPLYER(ERRARY) ;
"RTN","EASMTUTL",160,0)
 N DGER
"RTN","EASMTUTL",161,0)
 ;
"RTN","EASMTUTL",162,0)
 W !!?3,"The following error(s) occurred:"
"RTN","EASMTUTL",163,0)
 S DGER=0
"RTN","EASMTUTL",164,0)
 F  S DGER=$O(ERRARY("DIERR",DGER)) Q:'DGER  D
"RTN","EASMTUTL",165,0)
 . W !?3,ERRARY("DIERR",DGER)," - ",ERRARY("DIERR",DGER,"TEXT",1)
"RTN","EASMTUTL",166,0)
 W !?3,"Please check, this record update may not have processed completely."
"RTN","EASMTUTL",167,0)
 Q
"RTN","EASMTUTL",168,0)
 ;
"RTN","EASMTUTL",169,0)
EDTLTRS ;
"RTN","EASMTUTL",170,0)
 N DIR,EASIEN
"RTN","EASMTUTL",171,0)
 ;
"RTN","EASMTUTL",172,0)
 S DIR(0)="P^713.3:EMZ"
"RTN","EASMTUTL",173,0)
 S DIR("A")="Select Letter"
"RTN","EASMTUTL",174,0)
 D ^DIR K DIR
"RTN","EASMTUTL",175,0)
 Q:$D(DIRUT)
"RTN","EASMTUTL",176,0)
 S EASIEN=+Y
"RTN","EASMTUTL",177,0)
 ;
"RTN","EASMTUTL",178,0)
 S DIE="^EAS(713.3,",DA=EASIEN,DR="4"
"RTN","EASMTUTL",179,0)
 D ^DIE
"RTN","EASMTUTL",180,0)
 Q
"RTN","EASMTUTL",181,0)
 ;
"RTN","EASMTUTL",182,0)
MTRTN ; Update the letter status file, #713.2, with returned Means Test information
"RTN","EASMTUTL",183,0)
 N DIE,DIC,EASIEN,DR,DA,Y
"RTN","EASMTUTL",184,0)
 ;
"RTN","EASMTUTL",185,0)
 S DIC="^EAS(713.2,",DIC(0)="AEQM",DIC("A")="Select the Letter Status entry to update: "
"RTN","EASMTUTL",186,0)
 D ^DIC K DIC
"RTN","EASMTUTL",187,0)
 Q:Y<0
"RTN","EASMTUTL",188,0)
 S EASIEN=+Y
"RTN","EASMTUTL",189,0)
 ;
"RTN","EASMTUTL",190,0)
 S DIE="^EAS(713.2,",DA=EASIEN
"RTN","EASMTUTL",191,0)
 S DR="4;I X=0 S Y=0;5;7;6////^S X=DUZ;9///0;12///0;18///0"
"RTN","EASMTUTL",192,0)
 L +^EAS(713.2,EASIEN):0 I $T D 
"RTN","EASMTUTL",193,0)
 . D ^DIE K DIE
"RTN","EASMTUTL",194,0)
 E  W !,$CHAR(7),"Entry is being edited by another user."
"RTN","EASMTUTL",195,0)
 L -^EAS(713.2,EASIEN)
"RTN","EASMTUTL",196,0)
 ;
"RTN","EASMTUTL",197,0)
 Q
"RTN","EASMTUTL",198,0)
 ;
"RTN","EASMTUTL",199,0)
DECEASED(EASIEN,DFN) ;  Check deceased status for patient
"RTN","EASMTUTL",200,0)
 N RSLT,EADEM,EAS1,VAROOT
"RTN","EASMTUTL",201,0)
 ;
"RTN","EASMTUTL",202,0)
 S EASIEN=$G(EASIEN)
"RTN","EASMTUTL",203,0)
 S DFN=$G(DFN)
"RTN","EASMTUTL",204,0)
 I EASIEN>0 D
"RTN","EASMTUTL",205,0)
 . S EAS1=$$GET1^DIQ(713.2,EASIEN,2,"I")
"RTN","EASMTUTL",206,0)
 . S DFN=$$GET1^DIQ(713.1,EAS1,.01,"I")
"RTN","EASMTUTL",207,0)
 Q:'DFN 0
"RTN","EASMTUTL",208,0)
 S RSLT=0
"RTN","EASMTUTL",209,0)
 ;
"RTN","EASMTUTL",210,0)
 S VAROOT="EADEM"
"RTN","EASMTUTL",211,0)
 D DEM^VADPT
"RTN","EASMTUTL",212,0)
 S:+EADEM(6) RSLT=1
"RTN","EASMTUTL",213,0)
 D KVA^VADPT
"RTN","EASMTUTL",214,0)
 Q RSLT
"RTN","EASMTUTL",215,0)
 ;
"RTN","EASMTUTL",216,0)
CHECKMT(EASPT,EAIEN) ; Check current MT status
"RTN","EASMTUTL",217,0)
 N DFN,RTN,EACHK,DIE,DR,DA
"RTN","EASMTUTL",218,0)
 ;
"RTN","EASMTUTL",219,0)
 S RTN=0
"RTN","EASMTUTL",220,0)
 I '$G(EASPT) S RTN=1 G CHKQ ; Safety check
"RTN","EASMTUTL",221,0)
 S DFN=$$GET1^DIQ(713.1,EASPT,.01,"I") ; Get DFN
"RTN","EASMTUTL",222,0)
 I '$G(DFN) S RTN=1 G CHKQ ; Safety check
"RTN","EASMTUTL",223,0)
 ;
"RTN","EASMTUTL",224,0)
 S EACHK=$$MTCHK^EASMTCHK(DFN,"L") ; Check current MT to see if it's changed
"RTN","EASMTUTL",225,0)
 I 'EACHK D  ; If MT no longer required, update letter status file
"RTN","EASMTUTL",226,0)
 . S DIE="^EAS(713.2,",DA=EAIEN
"RTN","EASMTUTL",227,0)
 . S DR="4///YES;5///TODAY;7///AUTO-GENERATED;9///NO;12///NO;18///NO"
"RTN","EASMTUTL",228,0)
 . D ^DIE K DIE ;; Remove before release
"RTN","EASMTUTL",229,0)
 . S RTN=1
"RTN","EASMTUTL",230,0)
 ;
"RTN","EASMTUTL",231,0)
CHKQ Q RTN
"RTN","EASMTUTL",232,0)
 ;
"RTN","EASMTUTL",233,0)
FUTMT(EASIEN) ; Check for a future MT
"RTN","EASMTUTL",234,0)
 ;  Input
"RTN","EASMTUTL",235,0)
 ;    EASIEN - IEN for record in Letter Status file
"RTN","EASMTUTL",236,0)
 ;
"RTN","EASMTUTL",237,0)
 ;  Output
"RTN","EASMTUTL",238,0)
 ;     1 - Future MT exist's (API call)
"RTN","EASMTUTL",239,0)
 ;     0 - Future MT does not exist
"RTN","EASMTUTL",240,0)
 ;
"RTN","EASMTUTL",241,0)
 N EASPTR,DFN,EASFUT
"RTN","EASMTUTL",242,0)
 ;
"RTN","EASMTUTL",243,0)
 S RTN=0
"RTN","EASMTUTL",244,0)
 S EASPTR=$$GET1^DIQ(713.2,EASIEN,2,"I")
"RTN","EASMTUTL",245,0)
 S DFN=$$GET1^DIQ(713.1,EASPTR,.01,"I")
"RTN","EASMTUTL",246,0)
 ;
"RTN","EASMTUTL",247,0)
 ;; Call API for future MT check
"RTN","EASMTUTL",248,0)
 S EASFUT=$$FUT^DGMTU(DFN)
"RTN","EASMTUTL",249,0)
 ;
"RTN","EASMTUTL",250,0)
 I +$G(EASFUT) D  ; Turn off letters if future MT present
"RTN","EASMTUTL",251,0)
 . Q:'EASIEN
"RTN","EASMTUTL",252,0)
 . S DIE="^EAS(713.2,",DA=EASIEN
"RTN","EASMTUTL",253,0)
 . S DR="4///YES;5///TODAY;7///FUTURE MEANS TEST;9///NO;12///NO;18///NO"
"RTN","EASMTUTL",254,0)
 . D ^DIE K DIE
"RTN","EASMTUTL",255,0)
 . S RTN=1
"RTN","EASMTUTL",256,0)
 Q RTN
"RTN","EASMTUTL",257,0)
 ;
"RTN","EASMTUTL",258,0)
TESTLTR ;
"RTN","EASMTUTL",259,0)
 N EASIEN,EATYP,DIR,DIRUT,ZTSAVE
"RTN","EASMTUTL",260,0)
 ;
"RTN","EASMTUTL",261,0)
 S DIR(0)="SO^1:60-Day;2:30-Day;4:0-Day"
"RTN","EASMTUTL",262,0)
 S DIR("A")="Select letter type to test"
"RTN","EASMTUTL",263,0)
 S DIR("?")="Select the type of letter to print a test output of"
"RTN","EASMTUTL",264,0)
 D ^DIR K DIR
"RTN","EASMTUTL",265,0)
 Q:$D(DIRUT)
"RTN","EASMTUTL",266,0)
 S EATYP=+Y
"RTN","EASMTUTL",267,0)
 S EASIEN=-1
"RTN","EASMTUTL",268,0)
 S ZTSAVE("EASIEN")="",ZTSAVE("EATYP")=""
"RTN","EASMTUTL",269,0)
 D EN^XUTMDEVQ("ZTEST^EASMTUTL","EAS MT TEST LETTER",.ZTSAVE)
"RTN","EASMTUTL",270,0)
 Q
"RTN","EASMTUTL",271,0)
 ;
"RTN","EASMTUTL",272,0)
TESTIT ;
"RTN","EASMTUTL",273,0)
 D LETTER^EASMTL6A(EASIEN,EATYP)
"RTN","EASMTUTL",274,0)
 Q
"RTN","EASMTUTL",275,0)
 ;
"RTN","EASMTUTL",276,0)
ZTEST ;
"RTN","EASMTUTL",277,0)
 D LETTER^EASMTL6A(EASIEN,EATYP)
"RTN","EASMTUTL",278,0)
 Q
"RTN","EASMTUTL",279,0)
ADDLEAP(DATE) ; Adding a year with Leap Year checking
"RTN","EASMTUTL",280,0)
 ; Input:
"RTN","EASMTUTL",281,0)
 ;       DATE   -  Date passed in.
"RTN","EASMTUTL",282,0)
 ;
"RTN","EASMTUTL",283,0)
 ; Output:
"RTN","EASMTUTL",284,0)
 ;       Date passed in plus one year (with leap year ck/adj).
"RTN","EASMTUTL",285,0)
 ;
"RTN","EASMTUTL",286,0)
 N YEAR
"RTN","EASMTUTL",287,0)
 S YEAR=$E($$FMTHL7^XLFDT(DATE),1,4)
"RTN","EASMTUTL",288,0)
 I $E(DATE,4,7)="0229",'$$LEAP^XLFDT3(YEAR+1) D
"RTN","EASMTUTL",289,0)
 .S DATE=$$FMADD^XLFDT(DATE,-1)
"RTN","EASMTUTL",290,0)
 Q $E(DATE,1,3)+1_$E(DATE,4,7)
"RTN","EASMTUTL",291,0)
 ;
"RTN","EASMTUTL",292,0)
SUBLEAP(DATE) ; Subtracting a year with Leap Year checking
"RTN","EASMTUTL",293,0)
 ; Input:
"RTN","EASMTUTL",294,0)
 ;       DATE   -  Date passed in.
"RTN","EASMTUTL",295,0)
 ;
"RTN","EASMTUTL",296,0)
 ; Output:
"RTN","EASMTUTL",297,0)
 ;       Date passed in minus one year (with leap year ck/adj).
"RTN","EASMTUTL",298,0)
 ;
"RTN","EASMTUTL",299,0)
 N YEAR
"RTN","EASMTUTL",300,0)
 S YEAR=$E($$FMTHL7^XLFDT(DATE),1,4)
"RTN","EASMTUTL",301,0)
 I $E(DATE,4,7)="0229",'$$LEAP^XLFDT3(YEAR-1) D
"RTN","EASMTUTL",302,0)
 .S DATE=$$FMADD^XLFDT(DATE,-1)
"RTN","EASMTUTL",303,0)
 Q $E(DATE,1,3)-1_$E(DATE,4,7)
"VER")
8.0^22
**END**
**END**
