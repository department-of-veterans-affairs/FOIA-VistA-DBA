Released FB*3.5*76 SEQ #67
Extracted from mail message
**KIDS**:FB*3.5*76^

**INSTALL NAME**
FB*3.5*76
"BLD",4879,0)
FB*3.5*76^FEE BASIS^0^3040401^y
"BLD",4879,1,0)
^^1^1^3040325^^
"BLD",4879,1,1,0)
MODIFY POTENTIAL COST RECOVERY REPORT
"BLD",4879,4,0)
^9.64PA^^
"BLD",4879,"KRN",0)
^9.67PA^8989.52^19
"BLD",4879,"KRN",.4,0)
.4
"BLD",4879,"KRN",.401,0)
.401
"BLD",4879,"KRN",.402,0)
.402
"BLD",4879,"KRN",.403,0)
.403
"BLD",4879,"KRN",.5,0)
.5
"BLD",4879,"KRN",.84,0)
.84
"BLD",4879,"KRN",3.6,0)
3.6
"BLD",4879,"KRN",3.8,0)
3.8
"BLD",4879,"KRN",9.2,0)
9.2
"BLD",4879,"KRN",9.8,0)
9.8
"BLD",4879,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4879,"KRN",9.8,"NM",1,0)
FBPCR^^0^B60871910
"BLD",4879,"KRN",9.8,"NM",2,0)
FBPCR2^^0^B34437431
"BLD",4879,"KRN",9.8,"NM",3,0)
FBPCR4^^0^B10705492
"BLD",4879,"KRN",9.8,"NM",4,0)
FBPCR671^^0^B24387802
"BLD",4879,"KRN",9.8,"NM","B","FBPCR",1)

"BLD",4879,"KRN",9.8,"NM","B","FBPCR2",2)

"BLD",4879,"KRN",9.8,"NM","B","FBPCR4",3)

"BLD",4879,"KRN",9.8,"NM","B","FBPCR671",4)

"BLD",4879,"KRN",19,0)
19
"BLD",4879,"KRN",19.1,0)
19.1
"BLD",4879,"KRN",101,0)
101
"BLD",4879,"KRN",409.61,0)
409.61
"BLD",4879,"KRN",771,0)
771
"BLD",4879,"KRN",870,0)
870
"BLD",4879,"KRN",8989.51,0)
8989.51
"BLD",4879,"KRN",8989.52,0)
8989.52
"BLD",4879,"KRN",8994,0)
8994
"BLD",4879,"KRN","B",.4,.4)

"BLD",4879,"KRN","B",.401,.401)

"BLD",4879,"KRN","B",.402,.402)

"BLD",4879,"KRN","B",.403,.403)

"BLD",4879,"KRN","B",.5,.5)

"BLD",4879,"KRN","B",.84,.84)

"BLD",4879,"KRN","B",3.6,3.6)

"BLD",4879,"KRN","B",3.8,3.8)

"BLD",4879,"KRN","B",9.2,9.2)

"BLD",4879,"KRN","B",9.8,9.8)

"BLD",4879,"KRN","B",19,19)

"BLD",4879,"KRN","B",19.1,19.1)

"BLD",4879,"KRN","B",101,101)

"BLD",4879,"KRN","B",409.61,409.61)

"BLD",4879,"KRN","B",771,771)

"BLD",4879,"KRN","B",870,870)

"BLD",4879,"KRN","B",8989.51,8989.51)

"BLD",4879,"KRN","B",8989.52,8989.52)

"BLD",4879,"KRN","B",8994,8994)

"BLD",4879,"PRE")
FBXIP76E
"BLD",4879,"QUES",0)
^9.62^^
"BLD",4879,"REQB",0)
^9.611^2^2
"BLD",4879,"REQB",1,0)
FB*3.5*69^2
"BLD",4879,"REQB",2,0)
IB*2.0*228^2
"BLD",4879,"REQB","B","FB*3.5*69",1)

"BLD",4879,"REQB","B","IB*2.0*228",2)

"MBREQ")
0
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950605
"PKG",60,22,1,"PAH",1,0)
76^3040401^100920
"PKG",60,22,1,"PAH",1,1,0)
^^1^1^3040401
"PKG",60,22,1,"PAH",1,1,1,0)
MODIFY POTENTIAL COST RECOVERY REPORT
"PRE")
FBXIP76E
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","FBPCR")
0^1^B60871910
"RTN","FBPCR",1,0)
FBPCR ;AISC/DMK,GRR,TET-POTENTIAL COST RECOVERY OUTPUT DRIVER ;03/17/04
"RTN","FBPCR",2,0)
 ;;3.5;FEE BASIS;**12,48,76**;JAN 30, 1995
"RTN","FBPCR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR",4,0)
DOC ;Refer to fbdoc, tag fbpcr, for documentation of fbpcr* routines
"RTN","FBPCR",5,0)
PSF ;select one/many/all primary service failities
"RTN","FBPCR",6,0)
 S FBARRLTC=""
"RTN","FBPCR",7,0)
 W !! S DIC="^DIC(4,",VAUTSTR="Primary Service Facility",VAUTNI=2,VAUTVB="FBPSV" D FIRST^VAUTOMA K DIC I Y=-1 G EXIT
"RTN","FBPCR",8,0)
ARRAY ;set fee program array for all programs
"RTN","FBPCR",9,0)
 S FBPI=0 F  S FBPI=$O(^FBAA(161.8,FBPI)) Q:'FBPI  S FBPIN=$G(^(FBPI,0)) I $P(FBPIN,U,3) S FBPROG(FBPI)=$P(FBPIN,U)
"RTN","FBPCR",10,0)
 I '$D(FBPROG) G EXIT
"RTN","FBPCR",11,0)
 ;prepare array with LTC POV codes
"RTN","FBPCR",12,0)
 D MKARRLTC^FBPCR4
"RTN","FBPCR",13,0)
 ;what party to include
"RTN","FBPCR",14,0)
 K DIR
"RTN","FBPCR",15,0)
 S DIR(0)="SO^P:Patient;I:Insurance;B:Both",DIR("A")="Include (P)atient Co-pays / (I)nsurance / (B)oth",DIR("B")="Both"
"RTN","FBPCR",16,0)
 S DIR("?")=" Select type of recover to include",DIR("?",1)=" P - include only recover from patient copays",DIR("?",2)=" I - include only recover from insurance",DIR("?",3)=" B - include both",DIR("L")=""
"RTN","FBPCR",17,0)
 D ^DIR S FBPARTY=$S($G(Y(0))="Patient":1,$G(Y(0))="Insurance":2,$G(Y(0))="Both":3,X="Both":3,1:0)
"RTN","FBPCR",18,0)
 K DIR
"RTN","FBPCR",19,0)
 G:FBPARTY=0 EXIT
"RTN","FBPCR",20,0)
 ;what type of copay to include
"RTN","FBPCR",21,0)
 S FBCOPAY=3
"RTN","FBPCR",22,0)
 I FBPARTY'=2 D
"RTN","FBPCR",23,0)
 . S DIR(0)="SO^M:MeansTest;L:LTC;B:Both",DIR("A")="Include (M)eans Test Co-pays /(L)TC Co-pays /(B)oth",DIR("B")="Both"
"RTN","FBPCR",24,0)
 . S DIR("?")=" Select services to include",DIR("?",1)=" M - include only Means Test copays",DIR("?",2)=" L - include only LTC copays",DIR("?",3)=" B - include both",DIR("L")=""
"RTN","FBPCR",25,0)
 . D ^DIR S FBCOPAY=$S($G(Y(0))="LTC":1,$G(Y(0))="MeansTest":2,$G(Y(0))="Both":3,X="Both":3,1:0)
"RTN","FBPCR",26,0)
 . K DIR
"RTN","FBPCR",27,0)
 G:FBCOPAY=0 EXIT
"RTN","FBPCR",28,0)
 ;
"RTN","FBPCR",29,0)
 ;include patients if their insurance informations is unavailable?
"RTN","FBPCR",30,0)
 S FBINCUNK=0
"RTN","FBPCR",31,0)
 I FBPARTY=2!(FBPARTY=3) D
"RTN","FBPCR",32,0)
 . S FBINCUNK=1
"RTN","FBPCR",33,0)
 . N Y,X
"RTN","FBPCR",34,0)
 . W !!
"RTN","FBPCR",35,0)
 . S DIR("A")="Do you want to include patients whose insurance status is unavailable? "
"RTN","FBPCR",36,0)
 . S DIR("?")="Please answer Yes or No."
"RTN","FBPCR",37,0)
 . S DIR("B")="YES",DIR(0)="YA^^"
"RTN","FBPCR",38,0)
 . D ^DIR K DIR
"RTN","FBPCR",39,0)
 . I $G(DIRUT) S FBINCUNK=-1 Q
"RTN","FBPCR",40,0)
 . I $G(Y)=0 S FBINCUNK=0
"RTN","FBPCR",41,0)
 I FBINCUNK=-1 G EXIT ;uparrow - exit
"RTN","FBPCR",42,0)
 ;
"RTN","FBPCR",43,0)
DATE ;select date range
"RTN","FBPCR",44,0)
 D DATE^FBAAUTL I FBPOP G PSF
"RTN","FBPCR",45,0)
 S FBBDATE=BEGDATE,FBEDATE=ENDDATE
"RTN","FBPCR",46,0)
 S Z=9999999.9999,FBBEG=Z-FBEDATE,FBEND=Z-FBBDATE
"RTN","FBPCR",47,0)
Q K ^TMP($J,"FB"),^TMP($J,"FBINSIBAPI"),DIC
"RTN","FBPCR",48,0)
 ;
"RTN","FBPCR",49,0)
 S VAR="FBINCUNK^FBARRLTC^FBARRLTC(^FBPARTY^FBCOPAY^FBNAME^FBIEN^FBID^FBBEG^FBEND^FBBDATE^FBEDATE^FBPSV^FBPSV(^FBPROG(",VAL=VAR,PGM="DQ^FBPCR",IOP="Q" D ZIS^FBAAUTL G:FBPOP EXIT
"RTN","FBPCR",50,0)
DQ S $P(FBDASH,"=",80)="",$P(FBDASH1,"-",80)="",FBPG=0,FBCRT=$S($E(IOST,1,2)="C-":1,1:0),FBOUT=0,FBBEG=FBBEG-.9 U IO
"RTN","FBPCR",51,0)
SORT ;sort driver for payment output(s)
"RTN","FBPCR",52,0)
 S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D
"RTN","FBPCR",53,0)
 .I FBPI=2 D EN^FBPCR2 ;outpatient payments
"RTN","FBPCR",54,0)
 .I FBPI=3 D EN^FBPCR3 ;pharmacy payments
"RTN","FBPCR",55,0)
 .I FBPI=6!(FBPI=7) S:FBPI=6&($D(FBPROG(7))) FBPI=67 D EN^FBPCR67 S:FBPI=67 FBPI=7 ;civil hospital/cnh payments
"RTN","FBPCR",56,0)
PRINT ;print driver for payment output(s)
"RTN","FBPCR",57,0)
 I $G(^TMP($J,"FBINSIBAPI"))>0 D HDRUNK
"RTN","FBPCR",58,0)
 S FBPI=$O(^TMP($J,"FB",0)) I FBPI']"" D WMSG G OUT
"RTN","FBPCR",59,0)
 S FBSTA=0
"RTN","FBPCR",60,0)
 S FBPSF=0 F  S FBPSF=$O(^TMP($J,"FB",FBPSF)) Q:'FBPSF!FBOUT  D STA S FBPT="" F  S FBPT=$O(^TMP($J,"FB",FBPSF,FBPT)) Q:FBPT']""!FBOUT  S DFN=$P(FBPT,";",2) D VET S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D  Q:FBOUT
"RTN","FBPCR",61,0)
 .I FBPSF_FBPT'=FBSTA D HDR Q:FBOUT
"RTN","FBPCR",62,0)
 .I FBPI=2,$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) D PRINT^FBPCR2 Q
"RTN","FBPCR",63,0)
 .I FBPI=3 D:$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) PRINT^FBPCR3 Q
"RTN","FBPCR",64,0)
 .I FBPI=6!(FBPI=7) D:$D(^TMP($J,"FB",FBPSF,FBPT,FBPI)) PRINT^FBPCR671 Q
"RTN","FBPCR",65,0)
OUT I $G(^TMP($J,"FBINSIBAPI"))>0 D ERRHDL^FBPCR4
"RTN","FBPCR",66,0)
 I FBOUT!$D(ZTQUEUED) G EXIT
"RTN","FBPCR",67,0)
 D EXIT G PSF
"RTN","FBPCR",68,0)
 Q
"RTN","FBPCR",69,0)
EXIT ;kill and quit
"RTN","FBPCR",70,0)
KILL ;kill all variables set in the FBPCR* routines, other than fbx
"RTN","FBPCR",71,0)
 D CLOSE^FBAAUTL K ^TMP($J,"FB")
"RTN","FBPCR",72,0)
 K A1,A2,A3,BEGDATE,C,D,D2,DFN,DIC,DIR,DTOUT,DUOUT,ENDDATE,FBPDXC,FBPARTY,FBCOPAY,FBARRLTC,FBINCUNK
"RTN","FBPCR",73,0)
 K FBAAA,FBAACPTC,FBAC,FBAP,FBBATCH,FBBDATE,FBBEG,FBBN,FBCATC,FBCNT,FBCP,FBCRT,FBDA1,FBDASH,FBDASH1,FBDATA,FBDOB,FBDRUG,FBDT,FBDT1,FBDOS,FBDX,FBDX1,FBEDATE,FBEND,FBERR,FBFD,FBFD1,FBHEAD
"RTN","FBPCR",74,0)
 K FBI,FBID,FBIEN,FBIN,FBINS,FBINVN,FBIX,FBJ,FBLOC,FBM,FBNAME,FBOB,FBOPI,FBOUT,FBOV,FBP,FBPAT,FBPD,FBPDX,FBPG,FBPI,FBPID,FBPIN,FBPNAME,FBPROC,FBPROC1,FBPROG,FBPSF,FBPSFNAM,FBPSFNUM,FBPSV,FBPT,FBPV,FBQTY,FBREIM,FBRX
"RTN","FBPCR",75,0)
 K FBSC,FBSL,FBSTA,FBSTR,FBSUSP,FBTA,FBTYPE,FBV,FBVCHAIN,FBVEN,FBVENID,FBVNAME,FBVI,FBVID,FBVP,FBXPROG,FBY,FBZ,I,IOP,J,K,L,M,N,PGM,T,V,VA,VAERR,VAL,VAR,VAUTNI,VAUTSTR,VAUTVB,X,Y,Z
"RTN","FBPCR",76,0)
 Q
"RTN","FBPCR",77,0)
WMSG ;write message if no matches found
"RTN","FBPCR",78,0)
 D HDR W !!?3,"There are no potential cost recoveries on file"
"RTN","FBPCR",79,0)
 W !?5,"for specified date range:  ",$$DATX^FBAAUTL(FBBDATE)," through ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",80,0)
 I 'FBPSV D
"RTN","FBPCR",81,0)
 .W ",",!?5,"and selected Primary Service Area(s):"
"RTN","FBPCR",82,0)
 .S FBPSF=0 F  S FBPSF=$O(FBPSV(FBPSF)) Q:'FBPSF  W !?31,$G(FBPSV(FBPSF))
"RTN","FBPCR",83,0)
 E  W !?5,"and ALL Primary Service Areas "
"RTN","FBPCR",84,0)
 W ".",*7,!!
"RTN","FBPCR",85,0)
 Q
"RTN","FBPCR",86,0)
 ;
"RTN","FBPCR",87,0)
CATC(DFN,FBDT,FBPOV) ;
"RTN","FBPCR",88,0)
 ;treats all copays as Means test for date < 3020705 (JULY 5,2002)
"RTN","FBPCR",89,0)
 ;check if patient is liable for copay
"RTN","FBPCR",90,0)
 ;INPUT:  
"RTN","FBPCR",91,0)
 ; DFN = IEN of Patient file
"RTN","FBPCR",92,0)
 ; FBDT= Date
"RTN","FBPCR",93,0)
 ; FBPOV = POV code (for LTC determination)
"RTN","FBPCR",94,0)
 ;OUTPUT:  
"RTN","FBPCR",95,0)
 ;0 - the patient is not liable for any co-pay;
"RTN","FBPCR",96,0)
 ;1 - if Means test catc or pending adjudication and agree to pay deduc
"RTN","FBPCR",97,0)
 ;2 - the patient is liable for LTC co-pay;
"RTN","FBPCR",98,0)
 ;3 - no 1010EC on file
"RTN","FBPCR",99,0)
 ;4 - more analysis is needed to determine the patient liability
"RTN","FBPCR",100,0)
 N FBLTC,FBISLTC
"RTN","FBPCR",101,0)
 S FBCATC=$$BIL^DGMTUB(DFN,FBDT)
"RTN","FBPCR",102,0)
 I '$D(FBPOV)!(FBDT<3020705) Q $S(FBCATC:1,1:0)
"RTN","FBPCR",103,0)
 S FBISLTC=$$ISLTC^FBPCR4(FBPOV)
"RTN","FBPCR",104,0)
 I FBISLTC=0 Q $S(FBCATC:1,1:0)  ;Means test
"RTN","FBPCR",105,0)
 I FBISLTC=2 Q 0  ;LTC-service, but LTC-copay is not applicable
"RTN","FBPCR",106,0)
 S FBLTC=$$LTCST^FBPCR4(DFN,FBDT)
"RTN","FBPCR",107,0)
 I FBLTC=2 Q 2  ;LTC copay
"RTN","FBPCR",108,0)
 I FBLTC=0 Q 3  ;no 1010EC on file
"RTN","FBPCR",109,0)
 I FBLTC=4 Q 4  ;more info needed
"RTN","FBPCR",110,0)
 Q 0  ;exemption from LTC -copay
"RTN","FBPCR",111,0)
 ;
"RTN","FBPCR",112,0)
VET ;set vet name/ssn/dob info
"RTN","FBPCR",113,0)
 ;INPUT:  DFN  = IEN of Patient file
"RTN","FBPCR",114,0)
 ;      FBPI = IEN of fee program (optional)
"RTN","FBPCR",115,0)
 ;OUTPUT:  FBPNAME = Patient's name
"RTN","FBPCR",116,0)
 ;      FBPID   = Patient's pid
"RTN","FBPCR",117,0)
 ;      FBDOB   = Patient's dob (if pharmacy fee program)
"RTN","FBPCR",118,0)
 N N
"RTN","FBPCR",119,0)
 S N=$G(^DPT(DFN,0)),FBPNAME=$P(N,U),FBPID=$$SSN^FBAAUTL(DFN),FBDOB=$$FMTE^XLFDT($P(N,U,3))
"RTN","FBPCR",120,0)
 Q
"RTN","FBPCR",121,0)
STA ;set station name & number
"RTN","FBPCR",122,0)
 ;INPUT = FBPSF - IEN to institution file
"RTN","FBPCR",123,0)
 ;OUTPUT = FBPSFNAM = station name
"RTN","FBPCR",124,0)
 ;      FBPSFNUM = station number
"RTN","FBPCR",125,0)
 S FBPSFNAM=$P($G(^DIC(4,FBPSF,0)),U),FBPSFNUM=$P($G(^DIC(4,FBPSF,99)),U)
"RTN","FBPCR",126,0)
 S:FBPSFNAM=+FBPSFNAM FBPSFNAM="UNKNOWN"
"RTN","FBPCR",127,0)
 Q
"RTN","FBPCR",128,0)
PAGE ;form feed when new station/patient
"RTN","FBPCR",129,0)
 S FBSTA=$G(FBPSF)_$G(FBPT)
"RTN","FBPCR",130,0)
 I FBCRT&(FBPG'=0) D CR Q:FBOUT
"RTN","FBPCR",131,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPCR",132,0)
 S FBPG=FBPG+1
"RTN","FBPCR",133,0)
 Q
"RTN","FBPCR",134,0)
CR ;read for display
"RTN","FBPCR",135,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR",136,0)
 Q
"RTN","FBPCR",137,0)
HDR ;general header for potential recoveries
"RTN","FBPCR",138,0)
 D PAGE Q:FBOUT
"RTN","FBPCR",139,0)
 W !?(IOM-30/2),"POTENTIAL COST RECOVERY REPORT"
"RTN","FBPCR",140,0)
 W !?(IOM-(11+$L($G(FBPSFNAM))+$L($G(FBPSFNUM)))/2),"Division: ",$G(FBPSFNUM)," ",$G(FBPSFNAM)
"RTN","FBPCR",141,0)
 W !?(IOM-19/2),$$DATX^FBAAUTL(FBBDATE)," - ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",142,0)
 W !?71,"Page: ",FBPG
"RTN","FBPCR",143,0)
 W !,"Patient: ",$G(FBPNAME),?40,"Pat. ID: ",$G(FBPID),?62,"DOB: ",$G(FBDOB)
"RTN","FBPCR",144,0)
 W !
"RTN","FBPCR",145,0)
 I FBINCUNK=1,$D(^TMP($J,"FBINSIBAPI",+$G(DFN))) W ">> Warning: accurate insurance information for the patient is unavailable"
"RTN","FBPCR",146,0)
 W !?3,"('*' Represents Reimbursement to Patient",?50,"'#' Represents Voided Payment)"
"RTN","FBPCR",147,0)
 W !,FBDASH
"RTN","FBPCR",148,0)
 W ! D:$D(DFN) INS^DGRPDB
"RTN","FBPCR",149,0)
 Q
"RTN","FBPCR",150,0)
HDRUNK ;Warning message if patient's insurance status is unknown
"RTN","FBPCR",151,0)
 D PAGE Q:FBOUT
"RTN","FBPCR",152,0)
 W !?(IOM-30/2),"POTENTIAL COST RECOVERY REPORT"
"RTN","FBPCR",153,0)
 W !?(IOM-(11+$L($G(FBPSFNAM))+$L($G(FBPSFNUM)))/2),"Division: ",$G(FBPSFNUM)," ",$G(FBPSFNAM)
"RTN","FBPCR",154,0)
 W !?(IOM-19/2),$$DATX^FBAAUTL(FBBDATE)," - ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPCR",155,0)
 W !?71,"Page: ",FBPG
"RTN","FBPCR",156,0)
 W !,"------------------------------ !!! WARNING !!! --------------------------------"
"RTN","FBPCR",157,0)
 W !,"This report is incomplete due to problems with obtaining insurance information"
"RTN","FBPCR",158,0)
 W !,"for those patients listed in a separate section in the end of the report. You"
"RTN","FBPCR",159,0)
 W !,"may want to rerun the report again to get more accurate results."
"RTN","FBPCR",160,0)
 W !,FBDASH
"RTN","FBPCR",161,0)
 I FBINCUNK=1 D
"RTN","FBPCR",162,0)
 . W !,"Note: You have chosen to include patients with unknown insurance status in"
"RTN","FBPCR",163,0)
 . W !,"this report. Please be aware that these patients will be treated as if they"
"RTN","FBPCR",164,0)
 . W !,"have billable insurance and their treatment details will be marked accordingly."
"RTN","FBPCR",165,0)
 . W !,"The names of these patients will be accompanied with the following message"
"RTN","FBPCR",166,0)
 . W !,"to order to identify them:"
"RTN","FBPCR",167,0)
 . W !,">> Warning: accurate insurance information for the patient is unavailable"
"RTN","FBPCR",168,0)
 . W !,FBDASH
"RTN","FBPCR",169,0)
 Q
"RTN","FBPCR2")
0^2^B34437431
"RTN","FBPCR2",1,0)
FBPCR2 ;ALBISC/DMK,GRR,TET-OUTPATIENT POTENTIAL COST RECOVERY SORT/PRINT ;5/12/1999
"RTN","FBPCR2",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,76**;JAN 30, 1995
"RTN","FBPCR2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR2",4,0)
EN ;entry point
"RTN","FBPCR2",5,0)
 S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR2",6,0)
SORT ;sort by date finalized, patient, vendor, treatment ien, service ien
"RTN","FBPCR2",7,0)
 S I=FBBDATE-.1 F  S I=$O(^FBAAC("AK",I)) Q:'I!(I>FBEDATE)  S J=0 F  S J=$O(^FBAAC("AK",I,J)) Q:'J  D
"RTN","FBPCR2",8,0)
 .S DFN=J D VET^FBPCR
"RTN","FBPCR2",9,0)
 .S K=0  F  S K=$O(^FBAAC("AK",I,J,K)) Q:'K  S L=0 F  S L=$O(^FBAAC("AK",I,J,K,L)) Q:'L  D SETTR S M=0 F  S M=$O(^FBAAC("AK",I,J,K,L,M)) Q:'M  D  S (FBCATC,FBINS,FBPSF)=0
"RTN","FBPCR2",10,0)
 ..D SET Q:'FBPSV&('$D(FBPSV(FBPSF)))  I FBCATC!FBINS D SETTMP
"RTN","FBPCR2",11,0)
KILL ;kill variables set in this routine
"RTN","FBPCR2",12,0)
 K A1,A2,A3,D,D2,DFN,FBAACPTC,FBBN,FBCATC,FBCP,FBDOB,FBDOS,FBDT,FBDT1,FBIN,FBINS,FBOB,FBP,FBPAT,FBPCR,FBPDX,FBPDXC,FBPID,FBPNAME,FBPSF,FBSC,FBTA,FBTYPE,FBVEN,FBVID,FBVNAME,FBVP,I,J,K,L,M,T,Y,FBMODLE
"RTN","FBPCR2",13,0)
 K FBCSID,FBADJLA,FBADJLR,FBRRMKL,FBUNITS,TAMT,T,FBADJ
"RTN","FBPCR2",14,0)
 Q
"RTN","FBPCR2",15,0)
SET ;set variables - also entry point from FBPCR67
"RTN","FBPCR2",16,0)
 N FBPCR,FBX
"RTN","FBPCR2",17,0)
 S Y=$G(^FBAAC(J,1,K,1,L,1,M,0)) Q:'+$P(Y,U,9)!($G(^FBAAC(J,1,K,1,L,1,M,"FBREJ"))]"")
"RTN","FBPCR2",18,0)
 S FBY=$G(^FBAAC(J,1,K,1,L,1,M,2))
"RTN","FBPCR2",19,0)
 S FBVNAME=$E($P($G(^FBAAV(K,0)),U),1,23),FBVID=$S(FBVNAME]"":$P(^(0),U,2),1:"")
"RTN","FBPCR2",20,0)
 S FBP=+$P(Y,U,9),FBSC=$P(Y,U,27),FBPDX=+$P(Y,U,23),FBPSF=+$P(Y,U,12)
"RTN","FBPCR2",21,0)
 S FBSC=$S(FBSC="Y":"YES",FBSC="N":"NO",1:"-")
"RTN","FBPCR2",22,0)
 S T=$P(Y,U,5),D2=$P(Y,U,6),FBDOS=D2,D2=$$DATX^FBAAUTL(D2),FBCP=$P(Y,U,18),FBCP=$S(FBCP=1:"(C&P)",1:"")
"RTN","FBPCR2",23,0)
 Q:FBCP]""!('FBPSV&('$D(FBPSV(FBPSF))))  S FBPCR=+$G(^FBAAC(J,1,K,1,L,0)),FBCATC=$$CATC^FBPCR(DFN,FBPCR,+$P(Y,U,18)),FBINS=$S(FBSC["N":$$INSURED^FBPCR4(DFN,FBPCR),1:0) Q:'FBCATC&'FBINS
"RTN","FBPCR2",24,0)
 S FBAACPTC=$$CPT^FBAAUTL4($P(Y,U))
"RTN","FBPCR2",25,0)
 S FBOB=$P(Y,U,10)
"RTN","FBPCR2",26,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBPCR2",27,0)
 S FBTYPE=$P(Y,U,20),FBVP=$P(Y,U,21),FBIN=$P(Y,U,16),FBBN=$P(Y,U,8),FBBN=$S(FBBN']"":"",$D(^FBAA(161.7,FBBN,0)):$P(^(0),U),1:""),FBBN=$S(FBBN="":"",1:$E("00000",$L(FBBN)+1,5)_FBBN)
"RTN","FBPCR2",28,0)
 S FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPCR2",29,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBPCR2",30,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U) ;suspend code
"RTN","FBPCR2",31,0)
 S TAMT=$FN($P(Y,U,4),"",2) ;suspend amount
"RTN","FBPCR2",32,0)
 S FBUNITS=$P(FBY,U,14) ;units paid
"RTN","FBPCR2",33,0)
 S FBCSID=$P(FBY,U,16) ;patient account number
"RTN","FBPCR2",34,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBPCR2",35,0)
 S FBADJLR=$P(FBX,U) ;adjustment codes
"RTN","FBPCR2",36,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amounts
"RTN","FBPCR2",37,0)
 S FBRRMKL=$$RRL^FBAAFR(M_","_L_","_K_","_J_",") ;remit remarks
"RTN","FBPCR2",38,0)
 ;output format
"RTN","FBPCR2",39,0)
 S A1=$J($P(Y,U,2),6,2),A2=$J($P(Y,U,3),6,2),A3=$J(A3,6,2),FBIN=$J(FBIN,7)
"RTN","FBPCR2",40,0)
 S FBDT1=$S(FBVP="VP":"#",1:"")_$S(FBTYPE="R":"*",1:" ")_FBDT
"RTN","FBPCR2",41,0)
 Q
"RTN","FBPCR2",42,0)
SETTMP ;sort data by primary service facility, patient, fee program, vendor, date
"RTN","FBPCR2",43,0)
 Q:$$FILTER^FBPCR4()=0
"RTN","FBPCR2",44,0)
 I $P(Y,U,9)'=FBPI Q
"RTN","FBPCR2",45,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M)=FBDT1_U_FBAACPTC_FBCP_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")_U_A1_U_A2_U_T_U_FBBN_U_FBIN_U_D2_U_FBSC_U_FBPDX_U_FBOB_U_FBPI_U_FBCATC_U_FBINS
"RTN","FBPCR2",46,0)
 S ^TMP($J,"FB",FBPSF,FBPAT,FBP,FBVEN,I,L_M,"FBADJ")=TAMT_U_FBUNITS_U_FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBCSID
"RTN","FBPCR2",47,0)
 Q
"RTN","FBPCR2",48,0)
SETTR S D=$S($D(^FBAAC(J,1,K,1,L,0)):$P(^(0),"^",1),1:""),A3=".00"
"RTN","FBPCR2",49,0)
 I D]"",$D(^FBAAC(J,3,"AB",D)) S FBTA=$O(^FBAAC(J,3,"AB",D,0)),A3=$S($P(^FBAAC(J,3,FBTA,0),"^",3)]"":$P(^(0),"^",3),1:.0001)
"RTN","FBPCR2",50,0)
 S FBDT=$$DATX^FBAAUTL(D)
"RTN","FBPCR2",51,0)
 Q
"RTN","FBPCR2",52,0)
EN1 ;entry point to set variables, called by fbpcr67, anc
"RTN","FBPCR2",53,0)
 N FBVEN,FBPAT,FBDT1
"RTN","FBPCR2",54,0)
 D SETTR,SET
"RTN","FBPCR2",55,0)
 Q
"RTN","FBPCR2",56,0)
PRINT ;write output
"RTN","FBPCR2",57,0)
 D HDR1 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR2",58,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S M=0 F  S M=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M)) Q:'M  D  Q:FBOUT
"RTN","FBPCR2",59,0)
 ..I ($Y+4)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR2",60,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M),FBCATC=$P(FBDATA,U,13),FBINS=$P(FBDATA,U,14)
"RTN","FBPCR2",61,0)
 ..S FBADJ=$G(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,M,"FBADJ"))
"RTN","FBPCR2",62,0)
 ..;S FBLOC=1_U_12_U_23_U_33_U_47_U_57_U_63_U_71
"RTN","FBPCR2",63,0)
 ..W !
"RTN","FBPCR2",64,0)
 ..;S I=1 W ?$P(FBLOC,U,I),$P(FBDATA,U,I)
"RTN","FBPCR2",65,0)
 ..W ?1,$P(FBDATA,U,1)
"RTN","FBPCR2",66,0)
 ..;S I=2 W ?$P(FBLOC,U,I),$P($P(FBDATA,U,I),",")
"RTN","FBPCR2",67,0)
 ..W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPCR2",68,0)
 ..;F I=3:1:8 W ?$P(FBLOC,U,I),$P(FBDATA,U,I)
"RTN","FBPCR2",69,0)
 ..W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPCR2",70,0)
 ..W ?43,$P(FBDATA,U,6)
"RTN","FBPCR2",71,0)
 ..W ?54,$P(FBDATA,U,7)
"RTN","FBPCR2",72,0)
 ..W ?64,$P(FBDATA,U,8)
"RTN","FBPCR2",73,0)
 ..I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPCR2",74,0)
 ...N FBI,FBMOD
"RTN","FBPCR2",75,0)
 ...F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPCR2",76,0)
 ....I $Y+7>IOSL D PAGE Q:FBOUT  W !,"  (continued)"
"RTN","FBPCR2",77,0)
 ....W !,?16,"-",FBMOD
"RTN","FBPCR2",78,0)
 ..W !,$P(FBDATA,U,3)
"RTN","FBPCR2",79,0)
 ..W ?13,$P(FBDATA,U,4)
"RTN","FBPCR2",80,0)
 ..W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPCR2",81,0)
 ..W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPCR2",82,0)
 ..W ?48,$P(FBADJ,U,5)
"RTN","FBPCR2",83,0)
 ..W ?60,$P(FBADJ,U,6)
"RTN","FBPCR2",84,0)
 ..S FBPDX=$P(FBDATA,U,10),FBPDXC=$$ICD9^FBCSV1(FBPDX,$$DT2FMDT^FBCSV1($P(FBDATA,U))),$P(FBDATA,U,10)=$E($$ICD9P^FBCSV1(FBPDX,3,$$DT2FMDT^FBCSV1($P(FBDATA,U))),1,19),FBPDXC=$S(FBPDXC="":"",1:" ("_FBPDXC_")")
"RTN","FBPCR2",85,0)
 ..W !?3,"Primary Dx: ",$P(FBDATA,U,10),FBPDXC,?45,"S/C Condition? ",$P(FBDATA,U,9) W ?66,"Obl.#: ",$P(FBDATA,U,11)
"RTN","FBPCR2",86,0)
 ..I FBCATC!FBINS D
"RTN","FBPCR2",87,0)
 ...W !?5,">>>"
"RTN","FBPCR2",88,0)
 ...I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR2",89,0)
 ...I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR2",90,0)
 ...I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR2",91,0)
 ...I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR2",92,0)
 ...I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR2",93,0)
 ..S A3=".00"
"RTN","FBPCR2",94,0)
 Q
"RTN","FBPCR2",95,0)
HDR ;main header
"RTN","FBPCR2",96,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR2",97,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"FEE PROGRAM: ",FBXPROG
"RTN","FBPCR2",98,0)
 ;W !!,?2,"Svc Date",?11,"CPT-MOD",?23,"Amount",?33," Amount",?42,"Susp",?49,"Travel",?57,"Batch",?63,"Invoice",?71,"Voucher"
"RTN","FBPCR2",99,0)
 ;W !,?23,"Claimed",?35,"Paid",?42,"Code",?50,"Paid",?58,"Num",?64,"Num",?72,"Date",!,FBDASH
"RTN","FBPCR2",100,0)
 W !!,?1,"Svc Date",?11,"CPT-MOD ",?19,"Travel Paid",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPCR2",101,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPCR2",102,0)
 Q
"RTN","FBPCR2",103,0)
SH ;subheader - vendor, prints when name changed
"RTN","FBPCR2",104,0)
 I ($Y+6)>IOSL D HDR Q:FBOUT
"RTN","FBPCR2",105,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2)
"RTN","FBPCR2",106,0)
 Q
"RTN","FBPCR2",107,0)
CR ;read for display
"RTN","FBPCR2",108,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR2",109,0)
 Q
"RTN","FBPCR2",110,0)
PAGE ;new page
"RTN","FBPCR2",111,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR2",112,0)
 Q
"RTN","FBPCR4")
0^3^B10705492
"RTN","FBPCR4",1,0)
FBPCR4 ;WOIFO/SS-LTC PHASE 3 UTILITIES ;03/17/04
"RTN","FBPCR4",2,0)
 ;;3.5;FEE BASIS;**48,76**;JAN 30, 1995
"RTN","FBPCR4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR4",4,0)
 ;
"RTN","FBPCR4",5,0)
 Q
"RTN","FBPCR4",6,0)
 ;
"RTN","FBPCR4",7,0)
INSURED(FBDFN,FBINDT1,FBINDT2) ;check if the patient has insurance
"RTN","FBPCR4",8,0)
 ;FBDFN - patient DFN
"RTN","FBPCR4",9,0)
 ;FBINDT1 - the treatment date - for outpatients,
"RTN","FBPCR4",10,0)
 ;    FROM date - for inpatients,
"RTN","FBPCR4",11,0)
 ;    certified date  - for Pharmacy
"RTN","FBPCR4",12,0)
 ;FBINDT2 (optional) - TO date for inpatients
"RTN","FBPCR4",13,0)
 N FBINS1
"RTN","FBPCR4",14,0)
 S FBINS1=+$$INSUR^IBBAPI(FBDFN,FBINDT1)
"RTN","FBPCR4",15,0)
 I FBINS1<0 D ADDERR(DFN) Q FBINCUNK  ;error handling
"RTN","FBPCR4",16,0)
 Q:'$D(FBINDT2) FBINS1
"RTN","FBPCR4",17,0)
 Q:FBINS1=1 1  ;if was insured for FROM date - don't check TO date
"RTN","FBPCR4",18,0)
 S FBINS1=+$$INSUR^IBBAPI(FBDFN,FBINDT2) ;otherwise return the state on TO date
"RTN","FBPCR4",19,0)
 I FBINS1<0 D ADDERR(DFN) Q FBINCUNK  ;error handling
"RTN","FBPCR4",20,0)
 Q FBINS1
"RTN","FBPCR4",21,0)
 ;
"RTN","FBPCR4",22,0)
ADDERR(FBDFN) ;add error to ^TMP, FBDFN - patient DFN
"RTN","FBPCR4",23,0)
 I FBPARTY=1 Q
"RTN","FBPCR4",24,0)
 N DFN,FBPNAME,FBPID,FBDOB,FBPI
"RTN","FBPCR4",25,0)
 S DFN=FBDFN
"RTN","FBPCR4",26,0)
 D VET^FBPCR
"RTN","FBPCR4",27,0)
 S ^TMP($J,"FBINSIBAPI")=$G(^TMP($J,"FBINSIBAPI"))+1
"RTN","FBPCR4",28,0)
 S ^TMP($J,"FBINSIBAPI",DFN)=FBPID_"^"_FBDOB_"^"_FBPNAME
"RTN","FBPCR4",29,0)
 Q
"RTN","FBPCR4",30,0)
 ;
"RTN","FBPCR4",31,0)
ERRHDL ;Error handler called from FBPCR
"RTN","FBPCR4",32,0)
 I +$G(^TMP($J,"FBINSIBAPI"))=0 Q  ;no errors
"RTN","FBPCR4",33,0)
 D PRNUNKN
"RTN","FBPCR4",34,0)
 Q
"RTN","FBPCR4",35,0)
 ;
"RTN","FBPCR4",36,0)
PRNUNKN ;write output
"RTN","FBPCR4",37,0)
 N FBDFN,FBDATA
"RTN","FBPCR4",38,0)
 D PAGEINS
"RTN","FBPCR4",39,0)
 I FBPG>1&(($Y+15)>IOSL) D HEADER Q:FBOUT
"RTN","FBPCR4",40,0)
 S FBDFN=0 F  S FBDFN=$O(^TMP($J,"FBINSIBAPI",FBDFN)) Q:FBDFN']""!(FBOUT)  D  Q:FBOUT
"RTN","FBPCR4",41,0)
 . I ($Y+6)>IOSL D PAGEINS Q:FBOUT
"RTN","FBPCR4",42,0)
 . S FBDATA=$G(^TMP($J,"FBINSIBAPI",FBDFN))
"RTN","FBPCR4",43,0)
 . W !,$P(FBDATA,"^",3),?40,$P(FBDATA,"^",1),?62,$P(FBDATA,"^",2)
"RTN","FBPCR4",44,0)
 Q
"RTN","FBPCR4",45,0)
PAGEINS ;new page
"RTN","FBPCR4",46,0)
 D CHKPAGE Q:FBOUT
"RTN","FBPCR4",47,0)
 D HEADER Q:FBOUT
"RTN","FBPCR4",48,0)
 Q
"RTN","FBPCR4",49,0)
CHKPAGE ;form feed when new station/patient
"RTN","FBPCR4",50,0)
 S FBSTA=$G(FBPSF)_$G(FBPT)
"RTN","FBPCR4",51,0)
 I FBCRT&(FBPG'=0) D CR^FBPCR Q:FBOUT
"RTN","FBPCR4",52,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPCR4",53,0)
 S FBPG=FBPG+1
"RTN","FBPCR4",54,0)
 Q
"RTN","FBPCR4",55,0)
HEADER ;main header
"RTN","FBPCR4",56,0)
 N FBSTR1 S FBSTR1="List of the patients whose insurance information is currently unavailable"
"RTN","FBPCR4",57,0)
 W !?(IOM-30/2),"POTENTIAL COST RECOVERY REPORT"
"RTN","FBPCR4",58,0)
 W !?(IOM-$L(FBSTR1)/2),FBSTR1
"RTN","FBPCR4",59,0)
 W !?71,"Page: ",FBPG
"RTN","FBPCR4",60,0)
 W !,"Patient",?40,"Pat. ID",?62,"DOB"
"RTN","FBPCR4",61,0)
 W !,FBDASH
"RTN","FBPCR4",62,0)
 Q
"RTN","FBPCR4",63,0)
 ;/**filtering logic
"RTN","FBPCR4",64,0)
 ;input:
"RTN","FBPCR4",65,0)
 ; FBPARTY: 1-Patient copay only,2-Insurance only,3-Both
"RTN","FBPCR4",66,0)
 ; FBCOPAY: 1-LTC copays only,2-MT copays only,3-Both
"RTN","FBPCR4",67,0)
 ; FBINS:   1- has insurance,0-none
"RTN","FBPCR4",68,0)
 ; FBCATC:  0 - no copay,1- MT copay,2-LTC copay,3-no 1010EC,4-more analysis is needed
"RTN","FBPCR4",69,0)
 ;output:
"RTN","FBPCR4",70,0)
 ; 1 - include to report
"RTN","FBPCR4",71,0)
 ; 0 - exclude from report
"RTN","FBPCR4",72,0)
FILTER() ;*/
"RTN","FBPCR4",73,0)
 I FBPARTY=1,FBCATC=0 Q 0
"RTN","FBPCR4",74,0)
 I FBPARTY=2,FBINS=0 Q 0
"RTN","FBPCR4",75,0)
 I FBPARTY=3,FBINS=1 Q 1
"RTN","FBPCR4",76,0)
 I FBCOPAY=1,FBCATC<2 Q 0
"RTN","FBPCR4",77,0)
 I FBCOPAY=2,FBCATC'=1 Q 0
"RTN","FBPCR4",78,0)
 Q 1
"RTN","FBPCR4",79,0)
 ;
"RTN","FBPCR4",80,0)
 ;/**
"RTN","FBPCR4",81,0)
 ; returns LTC status
"RTN","FBPCR4",82,0)
 ; input:  Patient's DFN, Date of Care
"RTN","FBPCR4",83,0)
 ;
"RTN","FBPCR4",84,0)
 ; return values: 
"RTN","FBPCR4",85,0)
 ; 0 - no1010EC
"RTN","FBPCR4",86,0)
 ; 1 - exemption from LTC copay
"RTN","FBPCR4",87,0)
 ; 2 - LTC copay
"RTN","FBPCR4",88,0)
LTCST(DFN,FBDT) ;*/
"RTN","FBPCR4",89,0)
 Q +$$COPAY^EASECCAL(DFN,$$LASTDT(FBDT),1)
"RTN","FBPCR4",90,0)
 ;
"RTN","FBPCR4",91,0)
LASTDT(X) ; compute the last day of the month in X
"RTN","FBPCR4",92,0)
 N XM,X1,X2
"RTN","FBPCR4",93,0)
 I $E(X,4,5)=12 Q $E(X,1,5)_"31"
"RTN","FBPCR4",94,0)
 S XM=$E(X,4,5)+1
"RTN","FBPCR4",95,0)
 S:XM<10 XM="0"_XM
"RTN","FBPCR4",96,0)
 S X1=$E(X,1,3)_XM_"01"
"RTN","FBPCR4",97,0)
 S X2=-1
"RTN","FBPCR4",98,0)
 D C^%DTC
"RTN","FBPCR4",99,0)
 Q X
"RTN","FBPCR4",100,0)
 ;
"RTN","FBPCR4",101,0)
 ;
"RTN","FBPCR4",102,0)
 ;prepares local array with LTC POV codes
"RTN","FBPCR4",103,0)
 ;input: FBARRLTC must be defined
"RTN","FBPCR4",104,0)
 ;output: FBARRLTC with POV codes
"RTN","FBPCR4",105,0)
MKARRLTC ;
"RTN","FBPCR4",106,0)
 N FBPOV,FBIEN,FBLTCTYP
"RTN","FBPCR4",107,0)
 S FBPOV="" F  S FBPOV=$O(^FBAA(161.82,"C",FBPOV)) Q:'FBPOV  S FBIEN=+$O(^FBAA(161.82,"C",FBPOV,0)),FBLTCTYP=+$P($G(^FBAA(161.82,FBIEN,0)),"^",4) S:FBLTCTYP=1!(FBLTCTYP=2) FBARRLTC(FBPOV)=FBLTCTYP
"RTN","FBPCR4",108,0)
 Q
"RTN","FBPCR4",109,0)
 ;/**
"RTN","FBPCR4",110,0)
 ; Determine if POV code is related to LTC.
"RTN","FBPCR4",111,0)
 ;Input:
"RTN","FBPCR4",112,0)
 ; FBPOV - POV code, pointer to #161.82
"RTN","FBPCR4",113,0)
 ; FBARRLTC must be defined and populated - array with LTC POV codes (see MKARRLTC) 
"RTN","FBPCR4",114,0)
 ;Output:
"RTN","FBPCR4",115,0)
 ; returns 
"RTN","FBPCR4",116,0)
 ; 0 - it is not LTC service
"RTN","FBPCR4",117,0)
 ; 1 - this POV code is for LTC and recoverable from LTC copayment 
"RTN","FBPCR4",118,0)
 ; 2 - this POV code is for LTC but it is not a subject of LTC copayment
"RTN","FBPCR4",119,0)
ISLTC(FBPOV) ;*/
"RTN","FBPCR4",120,0)
 Q +$G(FBARRLTC(FBPOV))
"RTN","FBPCR4",121,0)
 ;
"RTN","FBPCR671")
0^4^B24387802
"RTN","FBPCR671",1,0)
FBPCR671 ;AISC/DMK,TET-CH/CNH POTENTIAL COST RECOVERY PRINT ;5/12/1999
"RTN","FBPCR671",2,0)
 ;;3.5;FEE BASIS;**4,48,55,69,76**;JAN 30, 1995
"RTN","FBPCR671",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBPCR671",4,0)
PRINT ;print data from tmp global
"RTN","FBPCR671",5,0)
 I FBPG>1&(($Y+12)>IOSL) D HDR Q:FBOUT
"RTN","FBPCR671",6,0)
 E  D HDR1
"RTN","FBPCR671",7,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D SH Q:FBOUT  D  Q:FBOUT
"RTN","FBPCR671",8,0)
 .S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT)) Q:'FBDT  S FBI=0 F  S FBI=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI)) Q:'FBI  D  Q:FBOUT
"RTN","FBPCR671",9,0)
 ..I ($Y+5)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",10,0)
 ..S FBDATA=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI),FBCATC=$P(FBDATA,U,9),FBINS=$P(FBDATA,U,10)
"RTN","FBPCR671",11,0)
 ..S FBINV=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"FBINV")
"RTN","FBPCR671",12,0)
 ..W ! W:$P(FBDATA,U,8)["R" "*" W:$P(FBDATA,U,9)]"" "#"
"RTN","FBPCR671",13,0)
 ..W ?2,$P(FBDATA,U,1),?15,$P(FBDATA,U,5),?31,$P(FBDATA,U,6)
"RTN","FBPCR671",14,0)
 ..W ?47,$P(FBDATA,U,7),?57,$P(FBINV,U,2)
"RTN","FBPCR671",15,0)
 ..W !?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?25,$P(FBINV,U,1)
"RTN","FBPCR671",16,0)
 .. ;Print adj reasons, if null then print suspend code
"RTN","FBPCR671",17,0)
 ..W ?36,$S($P(FBINV,U,3)]"":$P(FBINV,U,3),1:$P(FBDATA,U,4))
"RTN","FBPCR671",18,0)
 ..W ?46,$S($P(FBINV,U,3)]"":$J($P(FBINV,U,4),14),1:$J($P(FBDATA,U,10),14))
"RTN","FBPCR671",19,0)
 ..W ?63,$P(FBINV,U,5)
"RTN","FBPCR671",20,0)
 ..F FBY="DX","PROC" I $D(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,FBY)) S FBDATA=^(FBY),FBSL=$L(FBDATA,"^") W !?2,FBY,": " F I=1:1:FBSL W $P(FBDATA,U,I),"    "
"RTN","FBPCR671",21,0)
 ..I FBCATC!FBINS D
"RTN","FBPCR671",22,0)
 ...W !?5,">>>"
"RTN","FBPCR671",23,0)
 ...I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",24,0)
 ...I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",25,0)
 ...I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",26,0)
 ...I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",27,0)
 ...I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",28,0)
 ..;
"RTN","FBPCR671",29,0)
 ..I +$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",0)) D  Q:FBOUT  W !,FBDASH1
"RTN","FBPCR671",30,0)
 ...S (FBOV,FBCNT)=0,FBSL=7 D SHA Q:FBOUT
"RTN","FBPCR671",31,0)
 ...F  S FBCNT=$O(^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT)) Q:'FBCNT  S FBDATA=^(FBCNT),FBV=$P(FBDATA,U,11)_";"_$P(FBDATA,U,12) D WRT Q:FBOUT
"RTN","FBPCR671",32,0)
 Q
"RTN","FBPCR671",33,0)
WRT ;write ancillary info
"RTN","FBPCR671",34,0)
 N FBCATC,FBINS,FBADJ I ($Y+4)>IOSL D PAGE Q:FBOUT  D SHA,SHA2
"RTN","FBPCR671",35,0)
 D:FBOV'=FBV SHA2
"RTN","FBPCR671",36,0)
 S FBADJ=^TMP($J,"FB",FBPSF,FBPT,FBPI,FBVI,FBDT,FBI,"A",FBCNT,"FBADJ")
"RTN","FBPCR671",37,0)
 S FBCATC=$P(FBDATA,U,14),FBINS=$P(FBDATA,U,15)
"RTN","FBPCR671",38,0)
 W !
"RTN","FBPCR671",39,0)
 W ?1,$P(FBDATA,U,1)
"RTN","FBPCR671",40,0)
 W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPCR671",41,0)
 W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPCR671",42,0)
 W ?43,$P(FBDATA,U,6)
"RTN","FBPCR671",43,0)
 W ?54,$P(FBDATA,U,7)
"RTN","FBPCR671",44,0)
 W ?64,$P(FBDATA,U,8)
"RTN","FBPCR671",45,0)
 I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPCR671",46,0)
 . N FBI,FBMOD
"RTN","FBPCR671",47,0)
 . F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPCR671",48,0)
 . . I $Y+6>IOSL D PAGE Q:FBOUT  D SHA,SHA2 W !,"  (continued)"
"RTN","FBPCR671",49,0)
 . . W !,?16,"-",FBMOD
"RTN","FBPCR671",50,0)
 W !,$P(FBDATA,U,3)
"RTN","FBPCR671",51,0)
 W ?13,$P(FBDATA,U,4)
"RTN","FBPCR671",52,0)
 W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPCR671",53,0)
 W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPCR671",54,0)
 W ?48,$P(FBADJ,U,5)
"RTN","FBPCR671",55,0)
 W ?60,$P(FBADJ,U,6)
"RTN","FBPCR671",56,0)
 W !?5,"Primary Dx: ",$P(FBDATA,U,9),?40,"S/C Condition? ",$P(FBDATA,U,8),?66,"Obl.#: ",$P(FBDATA,U,10)
"RTN","FBPCR671",57,0)
 I FBCATC!FBINS D
"RTN","FBPCR671",58,0)
 .W !?5,">>>"
"RTN","FBPCR671",59,0)
 .I FBCATC=0 W "Cost recover from insurance."
"RTN","FBPCR671",60,0)
 .I FBCATC=1 W "Cost recover from means testing"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",61,0)
 .I FBCATC=2 W "Cost recover from LTC co-pay"_$S(FBINS:" and insurance.",1:".")
"RTN","FBPCR671",62,0)
 .I FBCATC=3 W $S(FBINS:"Cost recover from insurance, ",1:"")_"1010EC Missing for LTC Patient."
"RTN","FBPCR671",63,0)
 .I FBCATC=4 W $S(FBINS:"Cost Recover from insurance and ",1:"")_"Potential Cost Recover from LTC co-pay."
"RTN","FBPCR671",64,0)
 ;
"RTN","FBPCR671",65,0)
 Q
"RTN","FBPCR671",66,0)
HDR ;main header
"RTN","FBPCR671",67,0)
 D HDR^FBPCR Q:FBOUT
"RTN","FBPCR671",68,0)
HDR1 W !!?(IOM-(13+$L(FBXPROG))/2),"FEE PROGRAM: ",FBXPROG
"RTN","FBPCR671",69,0)
 W !?1,"Invoice Date",?15,"Invoice No.",?31,"From Date",?48,"To Date",?57,"Patient Control #"
"RTN","FBPCR671",70,0)
 W !?1,"Amt Claimed",?15,"Amt Paid",?25,"Cov Days",?36,"Adj Codes",?49,"Adj Amounts",?63,"Remit Remarks",!,FBDASH
"RTN","FBPCR671",71,0)
 Q
"RTN","FBPCR671",72,0)
SH ;subheader - vendor, prints when name changed
"RTN","FBPCR671",73,0)
 I ($Y+7)>IOSL D HDR Q:FBOUT
"RTN","FBPCR671",74,0)
 W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2)
"RTN","FBPCR671",75,0)
 Q
"RTN","FBPCR671",76,0)
SHA ;ancillary subheader
"RTN","FBPCR671",77,0)
 I ($Y+16)>IOSL D PAGE Q:FBOUT
"RTN","FBPCR671",78,0)
 W !?20,">>> ANCILLARY SERVICE PAYMENTS <<<",!
"RTN","FBPCR671",79,0)
SHA1 ;subheader for ancillary data
"RTN","FBPCR671",80,0)
 W !!,?1,"Svc Date",?11,"CPT-MOD ",?19,"Travel Paid",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPCR671",81,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPCR671",82,0)
 Q
"RTN","FBPCR671",83,0)
SHA2 ;subheader for vendor name
"RTN","FBPCR671",84,0)
 I ($Y+9)>IOSL D HDR Q:FBOUT  D SH,SHA
"RTN","FBPCR671",85,0)
 I FBOV'=FBV S FBOV=FBV
"RTN","FBPCR671",86,0)
 W !!,"Vendor: ",$P(FBV,";"),?41,"Vendor ID: ",$P(FBV,";",2)
"RTN","FBPCR671",87,0)
 Q
"RTN","FBPCR671",88,0)
CR ;read for display
"RTN","FBPCR671",89,0)
 Q:'FBPG  S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPCR671",90,0)
 Q
"RTN","FBPCR671",91,0)
PAGE ;new page
"RTN","FBPCR671",92,0)
 D HDR Q:FBOUT  D SH
"RTN","FBPCR671",93,0)
 Q
"RTN","FBPCR671",94,0)
WRTDX I $P(FBDX,"^",K)]"" W ?4,"Dx: ",$$ICD9^FBCSV1($P(FBDX,"^",K)),"  " Q
"RTN","FBPCR671",95,0)
 Q
"RTN","FBPCR671",96,0)
WRTPC I $P(FBPROC,"^",L)]"" W ?4,"Proc: ",$$ICD0^FBCSV1($P(FBPROC,"^",L)),"   " Q
"RTN","FBPCR671",97,0)
 Q
"RTN","FBPCR671",98,0)
WRTSC ;write service connected
"RTN","FBPCR671",99,0)
 W !,"SERVICE CONNECTED? ",$S(+VAEL(3):"YES",1:"NO"),!
"RTN","FBPCR671",100,0)
 Q
"RTN","FBXIP76E")
0^^B3917070
"RTN","FBXIP76E",1,0)
FBXIP76E ;AISC/SS - PATCH FB*3.5*76 ENVIRONMENT CHECK ;03/25/04
"RTN","FBXIP76E",2,0)
 ;;3.5;Fee Basis;**76**;JAN 30, 1995
"RTN","FBXIP76E",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","FBXIP76E",4,0)
ENV ;
"RTN","FBXIP76E",5,0)
 ;this is the environment check pre-init routine
"RTN","FBXIP76E",6,0)
 I $$PATCH^XPDUTL("FB*3.5*42") D
"RTN","FBXIP76E",7,0)
 .N X,Y,DTOUT,DUOUT
"RTN","FBXIP76E",8,0)
 .W !,"You are a test site for a CoreFLS version (patch FB*3.5*42) of Fee Basis"
"RTN","FBXIP76E",9,0)
 .W !,"This patch has a conflict with the FB-CoreFLS test software."
"RTN","FBXIP76E",10,0)
 .W !,"It must NOT be installed unless an accompanying update is made to the"
"RTN","FBXIP76E",11,0)
 .W !,"FB-CoreFLS software immediately after installation of this patch."
"RTN","FBXIP76E",12,0)
 .W !
"RTN","FBXIP76E",13,0)
 .K DIR S DIR(0)="YA"
"RTN","FBXIP76E",14,0)
 .S DIR("A")="Do you have the corresponding update to the FB-CoreFLS software that is associated with this patch? (Note: Entering ""No"" here will stop the installation of this patch) Y/N//"
"RTN","FBXIP76E",15,0)
 .D ^DIR K DIR
"RTN","FBXIP76E",16,0)
 .I $D(DTOUT)!$D(DUOUT)!(Y'=1) W !,"Installation of this patch has been stopped!" S XPDQUIT=2 Q
"RTN","FBXIP76E",17,0)
 .W !,"OK to install!"
"RTN","FBXIP76E",18,0)
 Q
"VER")
8.0^22.0
**END**
**END**
